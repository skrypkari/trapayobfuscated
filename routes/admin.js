'use strict';function a19_0x4b1f(_0x287a78,_0x2bd0bc){const _0x18c8c6=a19_0x18c8();return a19_0x4b1f=function(_0x4b1fc1,_0x1e6f80){_0x4b1fc1=_0x4b1fc1-0xa7;let _0x3c67b5=_0x18c8c6[_0x4b1fc1];return _0x3c67b5;},a19_0x4b1f(_0x287a78,_0x2bd0bc);}const a19_0x3230fe=a19_0x4b1f;(function(_0x528a89,_0x4cc4c5){const _0x343be0=a19_0x4b1f,_0x2f873b=_0x528a89();while(!![]){try{const _0x539e9e=parseInt(_0x343be0(0x109))/0x1+-parseInt(_0x343be0(0xc8))/0x2+parseInt(_0x343be0(0x114))/0x3+-parseInt(_0x343be0(0xe4))/0x4*(parseInt(_0x343be0(0xd6))/0x5)+-parseInt(_0x343be0(0xbd))/0x6+parseInt(_0x343be0(0x10f))/0x7*(-parseInt(_0x343be0(0xe9))/0x8)+parseInt(_0x343be0(0x10d))/0x9;if(_0x539e9e===_0x4cc4c5)break;else _0x2f873b['push'](_0x2f873b['shift']());}catch(_0x56bbe7){_0x2f873b['push'](_0x2f873b['shift']());}}}(a19_0x18c8,0xc75ef));var __createBinding=this&&this[a19_0x3230fe(0xc4)]||(Object['create']?function(_0x44eb9f,_0x1744f9,_0x3f4c94,_0x99a0a6){const _0x5b5462=a19_0x3230fe;if(_0x99a0a6===undefined)_0x99a0a6=_0x3f4c94;var _0x2be1c5=Object['getOwnPropertyDescriptor'](_0x1744f9,_0x3f4c94);(!_0x2be1c5||(_0x5b5462(0xb6)in _0x2be1c5?!_0x1744f9[_0x5b5462(0xdc)]:_0x2be1c5['writable']||_0x2be1c5[_0x5b5462(0xab)]))&&(_0x2be1c5={'enumerable':!![],'get':function(){return _0x1744f9[_0x3f4c94];}}),Object['defineProperty'](_0x44eb9f,_0x99a0a6,_0x2be1c5);}:function(_0x24c09c,_0x52428b,_0x111d5c,_0x340cc2){if(_0x340cc2===undefined)_0x340cc2=_0x111d5c;_0x24c09c[_0x340cc2]=_0x52428b[_0x111d5c];}),__setModuleDefault=this&&this[a19_0x3230fe(0xdb)]||(Object['create']?function(_0x35777d,_0x5c3aee){const _0x5f06e1=a19_0x3230fe;Object['defineProperty'](_0x35777d,_0x5f06e1(0x11e),{'enumerable':!![],'value':_0x5c3aee});}:function(_0x557924,_0x5e3970){_0x557924['default']=_0x5e3970;}),__importStar=this&&this[a19_0x3230fe(0xb2)]||(function(){var _0x143bb4=function(_0x4395de){const _0x1ee5b4=a19_0x4b1f;return _0x143bb4=Object[_0x1ee5b4(0xfd)]||function(_0xfe627f){const _0x52577e=_0x1ee5b4;var _0x20f514=[];for(var _0x232967 in _0xfe627f)if(Object['prototype'][_0x52577e(0x11b)][_0x52577e(0x121)](_0xfe627f,_0x232967))_0x20f514[_0x20f514['length']]=_0x232967;return _0x20f514;},_0x143bb4(_0x4395de);};return function(_0x587779){const _0x5b06a8=a19_0x4b1f;if(_0x587779&&_0x587779[_0x5b06a8(0xdc)])return _0x587779;var _0x4925a2={};if(_0x587779!=null){for(var _0x55bc26=_0x143bb4(_0x587779),_0x28b145=0x0;_0x28b145<_0x55bc26[_0x5b06a8(0xcc)];_0x28b145++)if(_0x55bc26[_0x28b145]!==_0x5b06a8(0x11e))__createBinding(_0x4925a2,_0x587779,_0x55bc26[_0x28b145]);}return __setModuleDefault(_0x4925a2,_0x587779),_0x4925a2;};}()),__importDefault=this&&this[a19_0x3230fe(0x115)]||function(_0x345afd){const _0x2543b1=a19_0x3230fe;return _0x345afd&&_0x345afd[_0x2543b1(0xdc)]?_0x345afd:{'default':_0x345afd};};function a19_0x18c8(){const _0x1e7a34=['createPayout','default','error','Server\x20crashes\x20if\x20domain\x20is\x20not\x20responding\x20after\x20consecutive\x20failures','call','findUnique','Failed\x20to\x20perform\x20manual\x20domain\x20check','Payments\x20are\x20checked\x20after\x2030\x20minutes\x20and\x2060\x20minutes,\x20then\x20forgotten','getUserById','FAILED','Only\x20checks\x20payments\x20with\x20status\x20PENDING\x20at\x20check\x20time','authenticateToken','../middleware/validation','getStatistics','expiryDays','getServiceStats','payment','createdAt','Failed\x20to\x20get\x20Rapyd\x20service\x20statistics','configurable','/cointopay/stats','express','delete','🔍\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20requested\x20for\x20payment:\x20','../middleware/auth','Rapyd\x20payment\x20status\x20checked\x20successfully','__importStar','loggerService','❌\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20failed\x20for\x20payment\x20','cleanOldLogs','get','\x20days)','rapyd','now','/users/:id/activate','activateUser','Failed\x20to\x20get\x20payment\x20information','6483708WkCNSD','getPayoutById','EXPIRED','checkPaymentById','❌\x20[ADMIN]\x20Manual\x20Rapyd\x20check\x20failed\x20for\x20payment\x20','updateUserSchema','getMerchantsSelection','__createBinding','gatewayPaymentId','../controllers/adminController','\x20minutes','1480200LrnDdf','status','paymentId','../config/database','length','../services/domainMonitoringService','/users/:id','getLogStats','/users','/cointopay/payment/:paymentId','getMerchantsAwaitingPayout','suspendUser','resolve','Router','3917020QXltgS','json','Rapyd\x20automatic\x20status\x20checking\x20service','getTime','/logs/clean','__setModuleDefault','__esModule','/rapyd/stats','Payment\x20not\x20found','getPaymentTimerInfo','put','/merchants/selection','/payouts/:id','Domain\x20is\x20responding\x20correctly','4sWFXHP','coinToPayStatusService','CoinToPay\x20automatic\x20status\x20checking\x20service','Failed\x20to\x20check\x20Rapyd\x20payment\x20status','../services/loggerService','1952MPABvj','Payments\x20automatically\x20expire\x20after\x20','requireAdmin','/payout/merchants','/users/:id/suspend','CoinToPay\x20payment\x20status\x20checked\x20successfully','updateUser','manualCheck','../services/coinToPayStatusService','/rapyd/check/:paymentId','defineProperty','/cointopay/check/:paymentId','log','validate','shop','No\x20checks\x20scheduled','toISOString','\x20days\x20if\x20not\x20paid','AdminController','updateCustomerDataSchema','getOwnPropertyNames','createPayoutSchema','message','post','cointopay','/logs/stats','../services/rapydStatusService','Failed\x20to\x20get\x20log\x20statistics','/payouts','PAID','/domain-monitoring/stats','/statistics','1265552OWOKgU','Requests\x20are\x20made\x20with\x20base64\x20encoded\x20URLs','hasTimers','gateway','21974931nOjjSd','/payments','22316FpAPBl','amount','floor','createUserSchema','rapydStatusService','1474218OXyyaT','__importDefault','PENDING','createUser','params','updateCustomerData','currency','hasOwnProperty','getPayouts'];a19_0x18c8=function(){return _0x1e7a34;};return a19_0x18c8();}Object[a19_0x3230fe(0xf3)](exports,a19_0x3230fe(0xdc),{'value':!![]});const express_1=require(a19_0x3230fe(0xad)),adminController_1=require(a19_0x3230fe(0xc6)),validation_1=require(a19_0x3230fe(0x129)),auth_1=require(a19_0x3230fe(0xb0)),loggerService_1=require(a19_0x3230fe(0xe8)),coinToPayStatusService_1=require(a19_0x3230fe(0xf1)),rapydStatusService_1=require(a19_0x3230fe(0x103)),domainMonitoringService_1=require(a19_0x3230fe(0xcd)),database_1=__importDefault(require(a19_0x3230fe(0xcb))),router=(0x0,express_1[a19_0x3230fe(0xd5)])(),adminController=new adminController_1[(a19_0x3230fe(0xfb))]();router['use'](auth_1[a19_0x3230fe(0x128)],auth_1[a19_0x3230fe(0xeb)]),router['get']('/auth',adminController['checkAuth']),router['get'](a19_0x3230fe(0x108),adminController[a19_0x3230fe(0x12a)]),router[a19_0x3230fe(0xb6)]('/merchant-statistics',adminController['getMerchantStatistics']),router[a19_0x3230fe(0xb6)](a19_0x3230fe(0xe1),adminController[a19_0x3230fe(0xc3)]),router[a19_0x3230fe(0xb6)]('/payout/stats',adminController['getPayoutStats']),router['get'](a19_0x3230fe(0xec),adminController[a19_0x3230fe(0xd2)]),router[a19_0x3230fe(0x100)]('/payout',(0x0,validation_1['validate'])(validation_1[a19_0x3230fe(0xfe)]),adminController[a19_0x3230fe(0x11d)]),router[a19_0x3230fe(0xb6)](a19_0x3230fe(0x105),adminController[a19_0x3230fe(0x11c)]),router[a19_0x3230fe(0xb6)](a19_0x3230fe(0xe2),adminController[a19_0x3230fe(0xbe)]),router[a19_0x3230fe(0xae)](a19_0x3230fe(0xe2),adminController['deletePayout']),router[a19_0x3230fe(0xb6)](a19_0x3230fe(0x10e),adminController['getPayments']),router['get']('/payments/:id',adminController['getPaymentById']),router[a19_0x3230fe(0xe0)]('/payments/:id',adminController['updatePayment']),router['put']('/payments/:id/customer',(0x0,validation_1[a19_0x3230fe(0xf6)])(validation_1[a19_0x3230fe(0xfc)]),adminController[a19_0x3230fe(0x119)]),router[a19_0x3230fe(0xb6)](a19_0x3230fe(0xd0),adminController['getUsers']),router[a19_0x3230fe(0xb6)](a19_0x3230fe(0xce),adminController[a19_0x3230fe(0x125)]),router[a19_0x3230fe(0x100)](a19_0x3230fe(0xd0),(0x0,validation_1['validate'])(validation_1[a19_0x3230fe(0x112)]),adminController[a19_0x3230fe(0x117)]),router[a19_0x3230fe(0xe0)](a19_0x3230fe(0xce),(0x0,validation_1['validate'])(validation_1[a19_0x3230fe(0xc2)]),adminController[a19_0x3230fe(0xef)]),router[a19_0x3230fe(0xae)](a19_0x3230fe(0xce),adminController['deleteUser']),router['post'](a19_0x3230fe(0xed),adminController[a19_0x3230fe(0xd3)]),router[a19_0x3230fe(0x100)](a19_0x3230fe(0xba),adminController[a19_0x3230fe(0xbb)]),router[a19_0x3230fe(0xb6)](a19_0x3230fe(0x102),(_0x5532f2,_0xee1c15)=>{const _0x25edd5=a19_0x3230fe;try{const _0x450aa4=loggerService_1[_0x25edd5(0xb3)][_0x25edd5(0xcf)]();_0xee1c15[_0x25edd5(0xd7)]({'success':!![],'result':_0x450aa4});}catch(_0x6d58a8){_0xee1c15['status'](0x1f4)[_0x25edd5(0xd7)]({'success':![],'message':_0x25edd5(0x104)});}}),router['post'](a19_0x3230fe(0xda),(_0x514c9d,_0x51c58e)=>{const _0x39ea47=a19_0x3230fe;try{const {daysToKeep:daysToKeep=0x1e}=_0x514c9d['body'];loggerService_1[_0x39ea47(0xb3)][_0x39ea47(0xb5)](daysToKeep),_0x51c58e[_0x39ea47(0xd7)]({'success':!![],'message':'Old\x20logs\x20cleaned\x20(kept\x20last\x20'+daysToKeep+_0x39ea47(0xb7)});}catch(_0xd498dc){_0x51c58e[_0x39ea47(0xc9)](0x1f4)['json']({'success':![],'message':'Failed\x20to\x20clean\x20old\x20logs'});}}),router[a19_0x3230fe(0x100)](a19_0x3230fe(0xf4),async(_0x3101c4,_0x8d705a)=>{const _0x2fd211=a19_0x3230fe;try{const {paymentId:_0x1737fd}=_0x3101c4[_0x2fd211(0x118)];console[_0x2fd211(0xf5)](_0x2fd211(0xaf)+_0x1737fd),await coinToPayStatusService_1['coinToPayStatusService']['checkPaymentById'](_0x1737fd),_0x8d705a[_0x2fd211(0xd7)]({'success':!![],'message':_0x2fd211(0xee)});}catch(_0x6b64e0){console[_0x2fd211(0x11f)](_0x2fd211(0xb4)+_0x3101c4[_0x2fd211(0x118)]['paymentId']+':',_0x6b64e0),_0x8d705a['status'](0x1f4)['json']({'success':![],'message':_0x6b64e0 instanceof Error?_0x6b64e0[_0x2fd211(0xff)]:'Failed\x20to\x20check\x20CoinToPay\x20payment\x20status'});}}),router['get'](a19_0x3230fe(0xac),(_0x2e2fe6,_0x173507)=>{const _0x6ac938=a19_0x3230fe;try{const _0x34acd4=coinToPayStatusService_1[_0x6ac938(0xe5)]['getServiceStats']();_0x173507[_0x6ac938(0xd7)]({'success':!![],'result':{..._0x34acd4,'description':_0x6ac938(0xe6),'statusMapping':{'Paid':_0x6ac938(0x106),'Awaiting\x20Fiat':_0x6ac938(0x116),'waiting':_0x6ac938(0x116),'expired':_0x6ac938(0xbf),'failed':_0x6ac938(0x126)},'autoExpiryNote':_0x6ac938(0xea)+_0x34acd4[_0x6ac938(0x12b)]+_0x6ac938(0xfa),'individualTimersNote':'Each\x20new\x20payment\x20gets\x20individual\x20timers:\x201min,\x202min,\x207min,\x2012min,\x20then\x20hourly'}});}catch(_0x35adbb){_0x173507['status'](0x1f4)[_0x6ac938(0xd7)]({'success':![],'message':'Failed\x20to\x20get\x20CoinToPay\x20service\x20statistics'});}}),router[a19_0x3230fe(0xb6)](a19_0x3230fe(0xd1),async(_0x8e2283,_0x1e17ec)=>{const _0x4965e5=a19_0x3230fe;try{const {paymentId:_0xec9572}=_0x8e2283[_0x4965e5(0x118)],_0x2f2cba=coinToPayStatusService_1[_0x4965e5(0xe5)][_0x4965e5(0xdf)](_0xec9572),_0x39a010=(await Promise[_0x4965e5(0xd4)]()['then'](()=>__importStar(require('../config/database'))))[_0x4965e5(0x11e)],_0x2f111d=await _0x39a010[_0x4965e5(0xa8)]['findUnique']({'where':{'id':_0xec9572},'select':{'id':!![],'gateway':!![],'gatewayPaymentId':!![],'status':!![],'amount':!![],'currency':!![],'createdAt':!![],'updatedAt':!![],'shopId':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2f111d)return _0x1e17ec[_0x4965e5(0xc9)](0x194)['json']({'success':![],'message':_0x4965e5(0xde)});_0x1e17ec[_0x4965e5(0xd7)]({'success':!![],'result':{'payment':{'id':_0x2f111d['id'],'gateway':_0x2f111d[_0x4965e5(0x10c)],'gatewayPaymentId':_0x2f111d[_0x4965e5(0xc5)],'status':_0x2f111d[_0x4965e5(0xc9)],'amount':_0x2f111d[_0x4965e5(0x110)],'currency':_0x2f111d[_0x4965e5(0x11a)],'createdAt':_0x2f111d['createdAt'],'updatedAt':_0x2f111d['updatedAt'],'shop':_0x2f111d[_0x4965e5(0xf7)]},'timers':_0x2f2cba,'isCoinToPay':_0x2f111d['gateway']===_0x4965e5(0x101),'ageInMinutes':Math['floor']((Date[_0x4965e5(0xb9)]()-_0x2f111d['createdAt'][_0x4965e5(0xd9)]())/(0x3e8*0x3c))}});}catch(_0x5b233e){_0x1e17ec[_0x4965e5(0xc9)](0x1f4)[_0x4965e5(0xd7)]({'success':![],'message':_0x5b233e instanceof Error?_0x5b233e[_0x4965e5(0xff)]:_0x4965e5(0xbc)});}}),router[a19_0x3230fe(0x100)](a19_0x3230fe(0xf2),async(_0x359db9,_0x21b433)=>{const _0x31cf96=a19_0x3230fe;try{const {paymentId:_0x589286}=_0x359db9[_0x31cf96(0x118)];console['log']('🔍\x20[ADMIN]\x20Manual\x20Rapyd\x20check\x20requested\x20for\x20payment:\x20'+_0x589286),await rapydStatusService_1[_0x31cf96(0x113)][_0x31cf96(0xc0)](_0x589286),_0x21b433[_0x31cf96(0xd7)]({'success':!![],'message':_0x31cf96(0xb1)});}catch(_0x4f2e13){console['error'](_0x31cf96(0xc1)+_0x359db9['params'][_0x31cf96(0xca)]+':',_0x4f2e13),_0x21b433[_0x31cf96(0xc9)](0x1f4)['json']({'success':![],'message':_0x4f2e13 instanceof Error?_0x4f2e13[_0x31cf96(0xff)]:_0x31cf96(0xe7)});}}),router[a19_0x3230fe(0xb6)](a19_0x3230fe(0xdd),(_0x2e8797,_0x2c391e)=>{const _0x4f13f7=a19_0x3230fe;try{const _0xb797a4=rapydStatusService_1[_0x4f13f7(0x113)][_0x4f13f7(0xa7)]();_0x2c391e[_0x4f13f7(0xd7)]({'success':!![],'result':{..._0xb797a4,'description':_0x4f13f7(0xd8),'statusMapping':{'paid:\x20true':_0x4f13f7(0x106),'paid:\x20false\x20+\x20CAN':_0x4f13f7(0x126),'paid:\x20false\x20+\x20ERR':_0x4f13f7(0x126),'paid:\x20false\x20+\x20EXP':_0x4f13f7(0xbf),'paid:\x20false\x20+\x20other':_0x4f13f7(0x116)},'checkSchedule':_0x4f13f7(0x124),'note':_0x4f13f7(0x127)}});}catch(_0x4dd630){_0x2c391e[_0x4f13f7(0xc9)](0x1f4)[_0x4f13f7(0xd7)]({'success':![],'message':_0x4f13f7(0xaa)});}}),router[a19_0x3230fe(0xb6)]('/rapyd/payment/:paymentId',async(_0x501098,_0x33ca47)=>{const _0x61e8c7=a19_0x3230fe;try{const {paymentId:_0x1474e1}=_0x501098[_0x61e8c7(0x118)],_0x2e9e8=await database_1[_0x61e8c7(0x11e)][_0x61e8c7(0xa8)][_0x61e8c7(0x122)]({'where':{'id':_0x1474e1},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x2e9e8)return _0x33ca47['status'](0x194)[_0x61e8c7(0xd7)]({'success':![],'message':_0x61e8c7(0xde)});const _0x23fcae=rapydStatusService_1[_0x61e8c7(0x113)][_0x61e8c7(0xdf)](_0x1474e1);_0x33ca47[_0x61e8c7(0xd7)]({'success':!![],'result':{'payment':{'id':_0x2e9e8['id'],'gateway':_0x2e9e8[_0x61e8c7(0x10c)],'gatewayPaymentId':_0x2e9e8[_0x61e8c7(0xc5)],'status':_0x2e9e8[_0x61e8c7(0xc9)],'amount':_0x2e9e8['amount'],'currency':_0x2e9e8['currency'],'createdAt':_0x2e9e8[_0x61e8c7(0xa9)],'updatedAt':_0x2e9e8['updatedAt'],'shop':_0x2e9e8[_0x61e8c7(0xf7)]},'timers':_0x23fcae,'isRapyd':_0x2e9e8[_0x61e8c7(0x10c)]===_0x61e8c7(0xb8),'ageInMinutes':Math[_0x61e8c7(0x111)]((Date['now']()-_0x2e9e8[_0x61e8c7(0xa9)][_0x61e8c7(0xd9)]())/(0x3e8*0x3c)),'nextCheck':_0x23fcae[_0x61e8c7(0x10b)]?Math[_0x61e8c7(0x111)]((Date[_0x61e8c7(0xb9)]()-_0x2e9e8[_0x61e8c7(0xa9)][_0x61e8c7(0xd9)]())/(0x3e8*0x3c))<0x1e?0x1e-Math[_0x61e8c7(0x111)]((Date['now']()-_0x2e9e8[_0x61e8c7(0xa9)][_0x61e8c7(0xd9)]())/(0x3e8*0x3c))+'\x20minutes':Math['floor']((Date[_0x61e8c7(0xb9)]()-_0x2e9e8[_0x61e8c7(0xa9)]['getTime']())/(0x3e8*0x3c))<0x3c?0x3c-Math[_0x61e8c7(0x111)]((Date['now']()-_0x2e9e8[_0x61e8c7(0xa9)][_0x61e8c7(0xd9)]())/(0x3e8*0x3c))+_0x61e8c7(0xc7):'No\x20more\x20checks\x20scheduled':_0x61e8c7(0xf8)}});}catch(_0x35ac78){_0x33ca47[_0x61e8c7(0xc9)](0x1f4)['json']({'success':![],'message':_0x35ac78 instanceof Error?_0x35ac78[_0x61e8c7(0xff)]:'Failed\x20to\x20get\x20payment\x20information'});}}),router['get'](a19_0x3230fe(0x107),(_0x24ef26,_0x28f162)=>{const _0x4a0b30=a19_0x3230fe;try{const _0x5ee4d9=domainMonitoringService_1['domainMonitoringService']['getMonitoringStats']();_0x28f162['json']({'success':!![],'result':{..._0x5ee4d9,'description':'Domain\x20monitoring\x20service\x20for\x20amaterasy884.icu','behavior':_0x4a0b30(0x120),'encoding':_0x4a0b30(0x10a)}});}catch(_0x5cfd5d){_0x28f162['status'](0x1f4)[_0x4a0b30(0xd7)]({'success':![],'message':'Failed\x20to\x20get\x20domain\x20monitoring\x20statistics'});}}),router[a19_0x3230fe(0x100)]('/domain-monitoring/check',async(_0x36e370,_0x5be620)=>{const _0x24461e=a19_0x3230fe;try{const _0x3b970a=await domainMonitoringService_1['domainMonitoringService'][_0x24461e(0xf0)]();_0x5be620[_0x24461e(0xd7)]({'success':!![],'result':{'domainAvailable':_0x3b970a,'message':_0x3b970a?_0x24461e(0xe3):'Domain\x20check\x20failed','timestamp':new Date()[_0x24461e(0xf9)]()}});}catch(_0x5ce0ba){_0x5be620[_0x24461e(0xc9)](0x1f4)['json']({'success':![],'message':_0x5ce0ba instanceof Error?_0x5ce0ba['message']:_0x24461e(0x123)});}}),exports[a19_0x3230fe(0x11e)]=router;