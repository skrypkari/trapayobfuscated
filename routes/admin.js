'use strict';const a19_0x3e2364=a19_0x7792;(function(_0x53c1cd,_0xc73c7f){const _0x5f0a28=a19_0x7792,_0x141222=_0x53c1cd();while(!![]){try{const _0x23b0f9=-parseInt(_0x5f0a28(0x1e1))/0x1*(-parseInt(_0x5f0a28(0x245))/0x2)+parseInt(_0x5f0a28(0x1e3))/0x3+-parseInt(_0x5f0a28(0x22f))/0x4*(parseInt(_0x5f0a28(0x20a))/0x5)+-parseInt(_0x5f0a28(0x21c))/0x6*(-parseInt(_0x5f0a28(0x228))/0x7)+parseInt(_0x5f0a28(0x204))/0x8+-parseInt(_0x5f0a28(0x206))/0x9+-parseInt(_0x5f0a28(0x250))/0xa;if(_0x23b0f9===_0xc73c7f)break;else _0x141222['push'](_0x141222['shift']());}catch(_0x498e67){_0x141222['push'](_0x141222['shift']());}}}(a19_0x373f,0x25834));function a19_0x7792(_0x552cf1,_0x51cf02){const _0x373f70=a19_0x373f();return a19_0x7792=function(_0x779257,_0x297910){_0x779257=_0x779257-0x1da;let _0x8c6b9f=_0x373f70[_0x779257];return _0x8c6b9f;},a19_0x7792(_0x552cf1,_0x51cf02);}var __createBinding=this&&this['__createBinding']||(Object[a19_0x3e2364(0x224)]?function(_0xec7ebc,_0x46f0a2,_0x11b670,_0x2760ff){const _0x5c8a24=a19_0x3e2364;if(_0x2760ff===undefined)_0x2760ff=_0x11b670;var _0x4d8f13=Object['getOwnPropertyDescriptor'](_0x46f0a2,_0x11b670);(!_0x4d8f13||(_0x5c8a24(0x21a)in _0x4d8f13?!_0x46f0a2['__esModule']:_0x4d8f13[_0x5c8a24(0x1e4)]||_0x4d8f13[_0x5c8a24(0x22d)]))&&(_0x4d8f13={'enumerable':!![],'get':function(){return _0x46f0a2[_0x11b670];}}),Object[_0x5c8a24(0x23e)](_0xec7ebc,_0x2760ff,_0x4d8f13);}:function(_0x49e822,_0x2ad827,_0x150435,_0x245a0d){if(_0x245a0d===undefined)_0x245a0d=_0x150435;_0x49e822[_0x245a0d]=_0x2ad827[_0x150435];}),__setModuleDefault=this&&this[a19_0x3e2364(0x23c)]||(Object['create']?function(_0x482cf9,_0x3b032b){const _0x4003eb=a19_0x3e2364;Object[_0x4003eb(0x23e)](_0x482cf9,'default',{'enumerable':!![],'value':_0x3b032b});}:function(_0x57a1f8,_0x2abd2c){const _0x497552=a19_0x3e2364;_0x57a1f8[_0x497552(0x1fd)]=_0x2abd2c;}),__importStar=this&&this[a19_0x3e2364(0x256)]||(function(){var _0x1cb0c4=function(_0x3253cc){const _0x5f1a6a=a19_0x7792;return _0x1cb0c4=Object[_0x5f1a6a(0x1dd)]||function(_0x2f5587){const _0x2bcbe1=_0x5f1a6a;var _0x310775=[];for(var _0x3d00c8 in _0x2f5587)if(Object[_0x2bcbe1(0x1da)][_0x2bcbe1(0x261)][_0x2bcbe1(0x211)](_0x2f5587,_0x3d00c8))_0x310775[_0x310775['length']]=_0x3d00c8;return _0x310775;},_0x1cb0c4(_0x3253cc);};return function(_0x172d46){const _0x1babbf=a19_0x7792;if(_0x172d46&&_0x172d46[_0x1babbf(0x258)])return _0x172d46;var _0x27883b={};if(_0x172d46!=null){for(var _0x403575=_0x1cb0c4(_0x172d46),_0x458030=0x0;_0x458030<_0x403575['length'];_0x458030++)if(_0x403575[_0x458030]!=='default')__createBinding(_0x27883b,_0x172d46,_0x403575[_0x458030]);}return __setModuleDefault(_0x27883b,_0x172d46),_0x27883b;};}()),__importDefault=this&&this['__importDefault']||function(_0x3d50ac){const _0x170b1a=a19_0x3e2364;return _0x3d50ac&&_0x3d50ac[_0x170b1a(0x258)]?_0x3d50ac:{'default':_0x3d50ac};};Object['defineProperty'](exports,a19_0x3e2364(0x258),{'value':!![]});function a19_0x373f(){const _0x19855e=['Rapyd\x20automatic\x20status\x20checking\x20service','Domain\x20is\x20responding\x20correctly','getPaymentById','updatedAt','/logs/clean','PENDING','/payments/:id','amount','post','/cointopay/payment/:paymentId','No\x20checks\x20scheduled','rapydStatusService','/payments/:id/customer','message','floor','getUsers','/logs/stats','createPayoutSchema','getMerchantsAwaitingPayout','default','then','activateUser','findUnique','\x20days)','suspendUser','getPaymentTimerInfo','1554296qPRZsL','❌\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20failed\x20for\x20payment\x20','2577996cogAIk','validate','loggerService','Failed\x20to\x20clean\x20old\x20logs','20yOUgID','put','createdAt','body','coinToPayStatusService','updateUserSchema','/rapyd/stats','call','currency','EXPIRED','Old\x20logs\x20cleaned\x20(kept\x20last\x20','Payments\x20automatically\x20expire\x20after\x20','rapyd','../controllers/adminController','CoinToPay\x20automatic\x20status\x20checking\x20service','/payouts/:id','get','updateCustomerDataSchema','564RHPWWj','getMonitoringStats','🔍\x20[ADMIN]\x20Manual\x20Rapyd\x20check\x20requested\x20for\x20payment:\x20','getStatistics','getPayments','gateway','status','authenticateToken','create','getUserById','delete','expiryDays','10423wZpjgN','/rapyd/payment/:paymentId','checkPaymentById','gatewayPaymentId','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status','configurable','Failed\x20to\x20get\x20CoinToPay\x20service\x20statistics','60140lHWRSD','/users/:id/suspend','/domain-monitoring/check','Failed\x20to\x20check\x20Rapyd\x20payment\x20status','/users','CoinToPay\x20payment\x20status\x20checked\x20successfully','/rapyd/check/:paymentId','/users/:id/activate','use','PAID','No\x20more\x20checks\x20scheduled','manualCheck','/merchant-statistics','__setModuleDefault','../config/database','defineProperty','/domain-monitoring/stats','Only\x20checks\x20payments\x20with\x20status\x20PENDING\x20at\x20check\x20time','🔍\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20requested\x20for\x20payment:\x20','createUserSchema','../services/rapydStatusService','Failed\x20to\x20perform\x20manual\x20domain\x20check','3012AdRFmN','../middleware/auth','Failed\x20to\x20get\x20payment\x20information','FAILED','updatePayment','now','❌\x20[ADMIN]\x20Manual\x20Rapyd\x20check\x20failed\x20for\x20payment\x20','../middleware/validation','/merchants/selection','checkAuth','paymentId','1928400vhijIH','getTime','getServiceStats','../services/loggerService','updateUser','/cointopay/check/:paymentId','__importStar','hasTimers','__esModule','express','resolve','Payments\x20are\x20checked\x20after\x2030\x20minutes\x20and\x2060\x20minutes,\x20then\x20forgotten','/cointopay/stats','/auth','Server\x20crashes\x20if\x20domain\x20is\x20not\x20responding\x20after\x20consecutive\x20failures','Domain\x20check\x20failed','deletePayout','hasOwnProperty','cointopay','getLogStats','/statistics','Failed\x20to\x20get\x20log\x20statistics','shop','json','AdminController','domainMonitoringService','prototype','/users/:id','\x20minutes','getOwnPropertyNames','error','toISOString','Domain\x20monitoring\x20service\x20for\x20amaterasy884.icu','123dspCbC','createUser','520755yYjARJ','writable','getPayoutStats','params','getMerchantsSelection','/payouts','Each\x20new\x20payment\x20gets\x20individual\x20timers:\x201min,\x202min,\x207min,\x2012min,\x20then\x20hourly'];a19_0x373f=function(){return _0x19855e;};return a19_0x373f();}const express_1=require(a19_0x3e2364(0x259)),adminController_1=require(a19_0x3e2364(0x217)),validation_1=require(a19_0x3e2364(0x24c)),auth_1=require(a19_0x3e2364(0x246)),loggerService_1=require(a19_0x3e2364(0x253)),coinToPayStatusService_1=require('../services/coinToPayStatusService'),rapydStatusService_1=require(a19_0x3e2364(0x243)),domainMonitoringService_1=require('../services/domainMonitoringService'),database_1=__importDefault(require(a19_0x3e2364(0x23d))),router=(0x0,express_1['Router'])(),adminController=new adminController_1[(a19_0x3e2364(0x268))]();router[a19_0x3e2364(0x237)](auth_1[a19_0x3e2364(0x223)],auth_1['requireAdmin']),router[a19_0x3e2364(0x21a)](a19_0x3e2364(0x25d),adminController[a19_0x3e2364(0x24e)]),router['get'](a19_0x3e2364(0x264),adminController[a19_0x3e2364(0x21f)]),router[a19_0x3e2364(0x21a)](a19_0x3e2364(0x23b),adminController['getMerchantStatistics']),router[a19_0x3e2364(0x21a)](a19_0x3e2364(0x24d),adminController[a19_0x3e2364(0x1e7)]),router[a19_0x3e2364(0x21a)]('/payout/stats',adminController[a19_0x3e2364(0x1e5)]),router[a19_0x3e2364(0x21a)]('/payout/merchants',adminController[a19_0x3e2364(0x1fc)]),router[a19_0x3e2364(0x1f2)]('/payout',(0x0,validation_1[a19_0x3e2364(0x207)])(validation_1[a19_0x3e2364(0x1fb)]),adminController['createPayout']),router['get'](a19_0x3e2364(0x1e8),adminController['getPayouts']),router[a19_0x3e2364(0x21a)](a19_0x3e2364(0x219),adminController['getPayoutById']),router['delete'](a19_0x3e2364(0x219),adminController[a19_0x3e2364(0x260)]),router[a19_0x3e2364(0x21a)]('/payments',adminController[a19_0x3e2364(0x220)]),router[a19_0x3e2364(0x21a)](a19_0x3e2364(0x1f0),adminController[a19_0x3e2364(0x1ec)]),router['put'](a19_0x3e2364(0x1f0),adminController[a19_0x3e2364(0x249)]),router['put'](a19_0x3e2364(0x1f6),(0x0,validation_1['validate'])(validation_1[a19_0x3e2364(0x21b)]),adminController['updateCustomerData']),router[a19_0x3e2364(0x21a)]('/users',adminController[a19_0x3e2364(0x1f9)]),router[a19_0x3e2364(0x21a)](a19_0x3e2364(0x1db),adminController[a19_0x3e2364(0x225)]),router[a19_0x3e2364(0x1f2)](a19_0x3e2364(0x233),(0x0,validation_1['validate'])(validation_1[a19_0x3e2364(0x242)]),adminController[a19_0x3e2364(0x1e2)]),router[a19_0x3e2364(0x20b)](a19_0x3e2364(0x1db),(0x0,validation_1['validate'])(validation_1[a19_0x3e2364(0x20f)]),adminController[a19_0x3e2364(0x254)]),router[a19_0x3e2364(0x226)](a19_0x3e2364(0x1db),adminController['deleteUser']),router[a19_0x3e2364(0x1f2)](a19_0x3e2364(0x230),adminController[a19_0x3e2364(0x202)]),router['post'](a19_0x3e2364(0x236),adminController[a19_0x3e2364(0x1ff)]),router['get'](a19_0x3e2364(0x1fa),(_0x13b924,_0xcd2c01)=>{const _0x504ec2=a19_0x3e2364;try{const _0x166c1f=loggerService_1[_0x504ec2(0x208)][_0x504ec2(0x263)]();_0xcd2c01[_0x504ec2(0x267)]({'success':!![],'result':_0x166c1f});}catch(_0x5b8d40){_0xcd2c01['status'](0x1f4)[_0x504ec2(0x267)]({'success':![],'message':_0x504ec2(0x265)});}}),router[a19_0x3e2364(0x1f2)](a19_0x3e2364(0x1ee),(_0x2e2443,_0x2e1e7f)=>{const _0x59b127=a19_0x3e2364;try{const {daysToKeep:daysToKeep=0x1e}=_0x2e2443[_0x59b127(0x20d)];loggerService_1[_0x59b127(0x208)]['cleanOldLogs'](daysToKeep),_0x2e1e7f[_0x59b127(0x267)]({'success':!![],'message':_0x59b127(0x214)+daysToKeep+_0x59b127(0x201)});}catch(_0x5f53c6){_0x2e1e7f[_0x59b127(0x222)](0x1f4)[_0x59b127(0x267)]({'success':![],'message':_0x59b127(0x209)});}}),router[a19_0x3e2364(0x1f2)](a19_0x3e2364(0x255),async(_0x41bf29,_0x155eb7)=>{const _0x11e33b=a19_0x3e2364;try{const {paymentId:_0x3f1085}=_0x41bf29['params'];console['log'](_0x11e33b(0x241)+_0x3f1085),await coinToPayStatusService_1[_0x11e33b(0x20e)]['checkPaymentById'](_0x3f1085),_0x155eb7[_0x11e33b(0x267)]({'success':!![],'message':_0x11e33b(0x234)});}catch(_0x5c5d4b){console['error'](_0x11e33b(0x205)+_0x41bf29[_0x11e33b(0x1e6)]['paymentId']+':',_0x5c5d4b),_0x155eb7[_0x11e33b(0x222)](0x1f4)[_0x11e33b(0x267)]({'success':![],'message':_0x5c5d4b instanceof Error?_0x5c5d4b[_0x11e33b(0x1f7)]:_0x11e33b(0x22c)});}}),router[a19_0x3e2364(0x21a)](a19_0x3e2364(0x25c),(_0x352e3b,_0xf79e7d)=>{const _0x56092f=a19_0x3e2364;try{const _0x111c0e=coinToPayStatusService_1[_0x56092f(0x20e)][_0x56092f(0x252)]();_0xf79e7d[_0x56092f(0x267)]({'success':!![],'result':{..._0x111c0e,'description':_0x56092f(0x218),'statusMapping':{'Paid':_0x56092f(0x238),'Awaiting\x20Fiat':_0x56092f(0x1ef),'waiting':_0x56092f(0x1ef),'expired':_0x56092f(0x213),'failed':'FAILED'},'autoExpiryNote':_0x56092f(0x215)+_0x111c0e[_0x56092f(0x227)]+'\x20days\x20if\x20not\x20paid','individualTimersNote':_0x56092f(0x1e9)}});}catch(_0x5d1b5e){_0xf79e7d['status'](0x1f4)['json']({'success':![],'message':_0x56092f(0x22e)});}}),router['get'](a19_0x3e2364(0x1f3),async(_0xda7c37,_0x38400a)=>{const _0x549397=a19_0x3e2364;try{const {paymentId:_0x2a32a2}=_0xda7c37[_0x549397(0x1e6)],_0x2237b4=coinToPayStatusService_1['coinToPayStatusService'][_0x549397(0x203)](_0x2a32a2),_0x1df2d3=(await Promise[_0x549397(0x25a)]()[_0x549397(0x1fe)](()=>__importStar(require(_0x549397(0x23d)))))[_0x549397(0x1fd)],_0x31db49=await _0x1df2d3['payment'][_0x549397(0x200)]({'where':{'id':_0x2a32a2},'select':{'id':!![],'gateway':!![],'gatewayPaymentId':!![],'status':!![],'amount':!![],'currency':!![],'createdAt':!![],'updatedAt':!![],'shopId':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x31db49)return _0x38400a[_0x549397(0x222)](0x194)[_0x549397(0x267)]({'success':![],'message':'Payment\x20not\x20found'});_0x38400a[_0x549397(0x267)]({'success':!![],'result':{'payment':{'id':_0x31db49['id'],'gateway':_0x31db49[_0x549397(0x221)],'gatewayPaymentId':_0x31db49[_0x549397(0x22b)],'status':_0x31db49[_0x549397(0x222)],'amount':_0x31db49[_0x549397(0x1f1)],'currency':_0x31db49['currency'],'createdAt':_0x31db49[_0x549397(0x20c)],'updatedAt':_0x31db49['updatedAt'],'shop':_0x31db49[_0x549397(0x266)]},'timers':_0x2237b4,'isCoinToPay':_0x31db49[_0x549397(0x221)]===_0x549397(0x262),'ageInMinutes':Math[_0x549397(0x1f8)]((Date[_0x549397(0x24a)]()-_0x31db49[_0x549397(0x20c)][_0x549397(0x251)]())/(0x3e8*0x3c))}});}catch(_0xd5972e){_0x38400a['status'](0x1f4)[_0x549397(0x267)]({'success':![],'message':_0xd5972e instanceof Error?_0xd5972e[_0x549397(0x1f7)]:_0x549397(0x247)});}}),router[a19_0x3e2364(0x1f2)](a19_0x3e2364(0x235),async(_0x404ab3,_0x3db817)=>{const _0x471dc8=a19_0x3e2364;try{const {paymentId:_0x108e05}=_0x404ab3[_0x471dc8(0x1e6)];console['log'](_0x471dc8(0x21e)+_0x108e05),await rapydStatusService_1[_0x471dc8(0x1f5)][_0x471dc8(0x22a)](_0x108e05),_0x3db817[_0x471dc8(0x267)]({'success':!![],'message':'Rapyd\x20payment\x20status\x20checked\x20successfully'});}catch(_0x41c4c5){console[_0x471dc8(0x1de)](_0x471dc8(0x24b)+_0x404ab3[_0x471dc8(0x1e6)][_0x471dc8(0x24f)]+':',_0x41c4c5),_0x3db817['status'](0x1f4)[_0x471dc8(0x267)]({'success':![],'message':_0x41c4c5 instanceof Error?_0x41c4c5[_0x471dc8(0x1f7)]:_0x471dc8(0x232)});}}),router[a19_0x3e2364(0x21a)](a19_0x3e2364(0x210),(_0xf4df76,_0x2c6196)=>{const _0x2d412c=a19_0x3e2364;try{const _0x3d7fa5=rapydStatusService_1[_0x2d412c(0x1f5)][_0x2d412c(0x252)]();_0x2c6196[_0x2d412c(0x267)]({'success':!![],'result':{..._0x3d7fa5,'description':_0x2d412c(0x1ea),'statusMapping':{'paid:\x20true':_0x2d412c(0x238),'paid:\x20false\x20+\x20CAN':_0x2d412c(0x248),'paid:\x20false\x20+\x20ERR':_0x2d412c(0x248),'paid:\x20false\x20+\x20EXP':_0x2d412c(0x213),'paid:\x20false\x20+\x20other':_0x2d412c(0x1ef)},'checkSchedule':_0x2d412c(0x25b),'note':_0x2d412c(0x240)}});}catch(_0x47528b){_0x2c6196[_0x2d412c(0x222)](0x1f4)['json']({'success':![],'message':'Failed\x20to\x20get\x20Rapyd\x20service\x20statistics'});}}),router[a19_0x3e2364(0x21a)](a19_0x3e2364(0x229),async(_0x2820ae,_0x3d25a2)=>{const _0x56c174=a19_0x3e2364;try{const {paymentId:_0x1ad72b}=_0x2820ae['params'],_0x3170ea=await database_1[_0x56c174(0x1fd)]['payment'][_0x56c174(0x200)]({'where':{'id':_0x1ad72b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x3170ea)return _0x3d25a2['status'](0x194)[_0x56c174(0x267)]({'success':![],'message':'Payment\x20not\x20found'});const _0x3c7e01=rapydStatusService_1[_0x56c174(0x1f5)]['getPaymentTimerInfo'](_0x1ad72b);_0x3d25a2[_0x56c174(0x267)]({'success':!![],'result':{'payment':{'id':_0x3170ea['id'],'gateway':_0x3170ea[_0x56c174(0x221)],'gatewayPaymentId':_0x3170ea[_0x56c174(0x22b)],'status':_0x3170ea['status'],'amount':_0x3170ea['amount'],'currency':_0x3170ea[_0x56c174(0x212)],'createdAt':_0x3170ea[_0x56c174(0x20c)],'updatedAt':_0x3170ea[_0x56c174(0x1ed)],'shop':_0x3170ea[_0x56c174(0x266)]},'timers':_0x3c7e01,'isRapyd':_0x3170ea['gateway']===_0x56c174(0x216),'ageInMinutes':Math[_0x56c174(0x1f8)]((Date[_0x56c174(0x24a)]()-_0x3170ea[_0x56c174(0x20c)]['getTime']())/(0x3e8*0x3c)),'nextCheck':_0x3c7e01[_0x56c174(0x257)]?Math[_0x56c174(0x1f8)]((Date[_0x56c174(0x24a)]()-_0x3170ea[_0x56c174(0x20c)][_0x56c174(0x251)]())/(0x3e8*0x3c))<0x1e?0x1e-Math[_0x56c174(0x1f8)]((Date[_0x56c174(0x24a)]()-_0x3170ea[_0x56c174(0x20c)][_0x56c174(0x251)]())/(0x3e8*0x3c))+_0x56c174(0x1dc):Math[_0x56c174(0x1f8)]((Date[_0x56c174(0x24a)]()-_0x3170ea[_0x56c174(0x20c)][_0x56c174(0x251)]())/(0x3e8*0x3c))<0x3c?0x3c-Math['floor']((Date[_0x56c174(0x24a)]()-_0x3170ea[_0x56c174(0x20c)][_0x56c174(0x251)]())/(0x3e8*0x3c))+_0x56c174(0x1dc):_0x56c174(0x239):_0x56c174(0x1f4)}});}catch(_0x2e710e){_0x3d25a2[_0x56c174(0x222)](0x1f4)[_0x56c174(0x267)]({'success':![],'message':_0x2e710e instanceof Error?_0x2e710e[_0x56c174(0x1f7)]:_0x56c174(0x247)});}}),router[a19_0x3e2364(0x21a)](a19_0x3e2364(0x23f),(_0x364d53,_0x4f1833)=>{const _0x57a037=a19_0x3e2364;try{const _0x2474f5=domainMonitoringService_1['domainMonitoringService'][_0x57a037(0x21d)]();_0x4f1833['json']({'success':!![],'result':{..._0x2474f5,'description':_0x57a037(0x1e0),'behavior':_0x57a037(0x25e),'encoding':'Requests\x20are\x20made\x20with\x20base64\x20encoded\x20URLs'}});}catch(_0x2f51aa){_0x4f1833['status'](0x1f4)[_0x57a037(0x267)]({'success':![],'message':'Failed\x20to\x20get\x20domain\x20monitoring\x20statistics'});}}),router[a19_0x3e2364(0x1f2)](a19_0x3e2364(0x231),async(_0x56a7dd,_0x22b6ea)=>{const _0x1c0e0d=a19_0x3e2364;try{const _0x16180a=await domainMonitoringService_1[_0x1c0e0d(0x269)][_0x1c0e0d(0x23a)]();_0x22b6ea['json']({'success':!![],'result':{'domainAvailable':_0x16180a,'message':_0x16180a?_0x1c0e0d(0x1eb):_0x1c0e0d(0x25f),'timestamp':new Date()[_0x1c0e0d(0x1df)]()}});}catch(_0x2c2e32){_0x22b6ea['status'](0x1f4)[_0x1c0e0d(0x267)]({'success':![],'message':_0x2c2e32 instanceof Error?_0x2c2e32[_0x1c0e0d(0x1f7)]:_0x1c0e0d(0x244)});}}),exports[a19_0x3e2364(0x1fd)]=router;