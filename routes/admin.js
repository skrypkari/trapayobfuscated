'use strict';const a19_0x359fa9=a19_0x5b68;(function(_0x57ab82,_0xa2d367){const _0x2c34e4=a19_0x5b68,_0xa711bd=_0x57ab82();while(!![]){try{const _0x6d94cd=parseInt(_0x2c34e4(0x13e))/0x1*(parseInt(_0x2c34e4(0x14d))/0x2)+parseInt(_0x2c34e4(0x142))/0x3*(parseInt(_0x2c34e4(0x151))/0x4)+-parseInt(_0x2c34e4(0x157))/0x5+parseInt(_0x2c34e4(0x19e))/0x6+parseInt(_0x2c34e4(0x19c))/0x7+-parseInt(_0x2c34e4(0x14b))/0x8+parseInt(_0x2c34e4(0x169))/0x9*(-parseInt(_0x2c34e4(0x181))/0xa);if(_0x6d94cd===_0xa2d367)break;else _0xa711bd['push'](_0xa711bd['shift']());}catch(_0x5f273b){_0xa711bd['push'](_0xa711bd['shift']());}}}(a19_0x4cda,0x89de1));function a19_0x5b68(_0x676693,_0x4d7f37){const _0x4cdaa2=a19_0x4cda();return a19_0x5b68=function(_0x5b684b,_0x1b3113){_0x5b684b=_0x5b684b-0x139;let _0x3d55c4=_0x4cdaa2[_0x5b684b];return _0x3d55c4;},a19_0x5b68(_0x676693,_0x4d7f37);}function a19_0x4cda(){const _0x4feee5=['amount','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status','Failed\x20to\x20check\x20Rapyd\x20payment\x20status','547910ptgxLN','post','createPayout','/cointopay/check/:paymentId','Failed\x20to\x20perform\x20manual\x20domain\x20check','__importDefault','domainMonitoringService','now','‚ùå\x20[ADMIN]\x20Manual\x20Rapyd\x20check\x20failed\x20for\x20payment\x20','createUser','Each\x20new\x20payment\x20gets\x20individual\x20timers:\x201min,\x202min,\x207min,\x2012min,\x20then\x20hourly','/rapyd/payment/:paymentId','getTime','body','getMerchantsSelection','authenticateToken','/users','Failed\x20to\x20get\x20CoinToPay\x20service\x20statistics','suspendUser','getOwnPropertyDescriptor','resolve','getPaymentById','updateCustomerDataSchema','Requests\x20are\x20made\x20with\x20base64\x20encoded\x20URLs','No\x20more\x20checks\x20scheduled','findUnique','/payouts/:id','6342098kFlMOM','hasOwnProperty','2040642RLsQRe','PAID','getMerchantStatistics','/cointopay/stats','\x20days\x20if\x20not\x20paid','deletePayout','json','getPayouts','currency','log','status','/payments/:id/customer','updatePayment','Domain\x20check\x20failed','payment','default','/domain-monitoring/check','getServiceStats','Router','../config/database','rapyd','createPayoutSchema','writable','/payout/stats','getPayoutById','gatewayPaymentId','create','/merchant-statistics','../services/domainMonitoringService','AdminController','PENDING','Rapyd\x20payment\x20status\x20checked\x20successfully','/payout','Failed\x20to\x20get\x20Rapyd\x20service\x20statistics','No\x20checks\x20scheduled','params','Server\x20crashes\x20if\x20domain\x20is\x20not\x20responding\x20after\x20consecutive\x20failures','delete','1wqImSB','FAILED','__esModule','gateway','2317149TmuWqq','getPaymentTimerInfo','express','CoinToPay\x20automatic\x20status\x20checking\x20service','/payout/merchants','loggerService','\x20minutes','/users/:id/suspend','Domain\x20monitoring\x20service\x20for\x20amaterasy884.icu','23616fenjxO','cleanOldLogs','622814fFqkSb','../middleware/auth','__setModuleDefault','../services/loggerService','4gbWznT','coinToPayStatusService','getPayments','activateUser','use','getMerchantsAwaitingPayout','4427990BAOxXy','checkPaymentById','Old\x20logs\x20cleaned\x20(kept\x20last\x20','Rapyd\x20automatic\x20status\x20checking\x20service','deleteUser','/merchants/selection','updateCustomerData','get','toISOString','updateUserSchema','expiryDays','Domain\x20is\x20responding\x20correctly','floor','put','__importStar','Failed\x20to\x20clean\x20old\x20logs','getOwnPropertyNames','getUsers','144xVsriB','message','/cointopay/payment/:paymentId','getUserById','EXPIRED','configurable','getPayoutStats','validate','../controllers/adminController','Failed\x20to\x20get\x20log\x20statistics','Failed\x20to\x20get\x20payment\x20information','paymentId','CoinToPay\x20payment\x20status\x20checked\x20successfully','Failed\x20to\x20get\x20domain\x20monitoring\x20statistics','rapydStatusService','/users/:id','shop','getMonitoringStats','createdAt','/payments/:id','Payment\x20not\x20found'];a19_0x4cda=function(){return _0x4feee5;};return a19_0x4cda();}var __createBinding=this&&this['__createBinding']||(Object[a19_0x359fa9(0x1b8)]?function(_0x47b19c,_0x254d8a,_0x2b726e,_0x3ff5fb){const _0x1b21e4=a19_0x359fa9;if(_0x3ff5fb===undefined)_0x3ff5fb=_0x2b726e;var _0x5232b5=Object[_0x1b21e4(0x194)](_0x254d8a,_0x2b726e);(!_0x5232b5||(_0x1b21e4(0x15e)in _0x5232b5?!_0x254d8a[_0x1b21e4(0x140)]:_0x5232b5[_0x1b21e4(0x1b4)]||_0x5232b5[_0x1b21e4(0x16e)]))&&(_0x5232b5={'enumerable':!![],'get':function(){return _0x254d8a[_0x2b726e];}}),Object['defineProperty'](_0x47b19c,_0x3ff5fb,_0x5232b5);}:function(_0x4567fe,_0x264f11,_0x1fddf3,_0x53c4ef){if(_0x53c4ef===undefined)_0x53c4ef=_0x1fddf3;_0x4567fe[_0x53c4ef]=_0x264f11[_0x1fddf3];}),__setModuleDefault=this&&this[a19_0x359fa9(0x14f)]||(Object[a19_0x359fa9(0x1b8)]?function(_0x3969b5,_0x446ada){Object['defineProperty'](_0x3969b5,'default',{'enumerable':!![],'value':_0x446ada});}:function(_0x55877c,_0x5e9ca1){const _0x48d456=a19_0x359fa9;_0x55877c[_0x48d456(0x1ad)]=_0x5e9ca1;}),__importStar=this&&this[a19_0x359fa9(0x165)]||(function(){var _0x335ebf=function(_0x2ba08e){const _0x1d4c0d=a19_0x5b68;return _0x335ebf=Object[_0x1d4c0d(0x167)]||function(_0x47c8db){const _0x54d1bd=_0x1d4c0d;var _0xfba2b5=[];for(var _0x1a37f0 in _0x47c8db)if(Object['prototype'][_0x54d1bd(0x19d)]['call'](_0x47c8db,_0x1a37f0))_0xfba2b5[_0xfba2b5['length']]=_0x1a37f0;return _0xfba2b5;},_0x335ebf(_0x2ba08e);};return function(_0x5cd950){const _0x11c616=a19_0x5b68;if(_0x5cd950&&_0x5cd950[_0x11c616(0x140)])return _0x5cd950;var _0x431470={};if(_0x5cd950!=null){for(var _0x4a7bdf=_0x335ebf(_0x5cd950),_0x1fcc62=0x0;_0x1fcc62<_0x4a7bdf['length'];_0x1fcc62++)if(_0x4a7bdf[_0x1fcc62]!==_0x11c616(0x1ad))__createBinding(_0x431470,_0x5cd950,_0x4a7bdf[_0x1fcc62]);}return __setModuleDefault(_0x431470,_0x5cd950),_0x431470;};}()),__importDefault=this&&this[a19_0x359fa9(0x186)]||function(_0x509e6b){const _0x227187=a19_0x359fa9;return _0x509e6b&&_0x509e6b[_0x227187(0x140)]?_0x509e6b:{'default':_0x509e6b};};Object['defineProperty'](exports,a19_0x359fa9(0x140),{'value':!![]});const express_1=require(a19_0x359fa9(0x144)),adminController_1=require(a19_0x359fa9(0x171)),validation_1=require('../middleware/validation'),auth_1=require(a19_0x359fa9(0x14e)),loggerService_1=require(a19_0x359fa9(0x150)),coinToPayStatusService_1=require('../services/coinToPayStatusService'),rapydStatusService_1=require('../services/rapydStatusService'),domainMonitoringService_1=require(a19_0x359fa9(0x1ba)),database_1=__importDefault(require(a19_0x359fa9(0x1b1))),router=(0x0,express_1[a19_0x359fa9(0x1b0)])(),adminController=new adminController_1[(a19_0x359fa9(0x1bb))]();router[a19_0x359fa9(0x155)](auth_1[a19_0x359fa9(0x190)],auth_1['requireAdmin']),router['get']('/auth',adminController['checkAuth']),router['get']('/statistics',adminController['getStatistics']),router[a19_0x359fa9(0x15e)](a19_0x359fa9(0x1b9),adminController[a19_0x359fa9(0x1a0)]),router[a19_0x359fa9(0x15e)](a19_0x359fa9(0x15c),adminController[a19_0x359fa9(0x18f)]),router[a19_0x359fa9(0x15e)](a19_0x359fa9(0x1b5),adminController[a19_0x359fa9(0x16f)]),router[a19_0x359fa9(0x15e)](a19_0x359fa9(0x146),adminController[a19_0x359fa9(0x156)]),router[a19_0x359fa9(0x182)](a19_0x359fa9(0x1be),(0x0,validation_1['validate'])(validation_1[a19_0x359fa9(0x1b3)]),adminController[a19_0x359fa9(0x183)]),router[a19_0x359fa9(0x15e)]('/payouts',adminController[a19_0x359fa9(0x1a5)]),router['get'](a19_0x359fa9(0x19b),adminController[a19_0x359fa9(0x1b6)]),router[a19_0x359fa9(0x13d)](a19_0x359fa9(0x19b),adminController[a19_0x359fa9(0x1a3)]),router[a19_0x359fa9(0x15e)]('/payments',adminController[a19_0x359fa9(0x153)]),router[a19_0x359fa9(0x15e)]('/payments/:id',adminController[a19_0x359fa9(0x196)]),router[a19_0x359fa9(0x164)](a19_0x359fa9(0x17c),adminController[a19_0x359fa9(0x1aa)]),router['put'](a19_0x359fa9(0x1a9),(0x0,validation_1[a19_0x359fa9(0x170)])(validation_1[a19_0x359fa9(0x197)]),adminController[a19_0x359fa9(0x15d)]),router[a19_0x359fa9(0x15e)](a19_0x359fa9(0x191),adminController[a19_0x359fa9(0x168)]),router['get'](a19_0x359fa9(0x178),adminController[a19_0x359fa9(0x16c)]),router[a19_0x359fa9(0x182)]('/users',(0x0,validation_1[a19_0x359fa9(0x170)])(validation_1['createUserSchema']),adminController[a19_0x359fa9(0x18a)]),router[a19_0x359fa9(0x164)]('/users/:id',(0x0,validation_1[a19_0x359fa9(0x170)])(validation_1[a19_0x359fa9(0x160)]),adminController['updateUser']),router['delete'](a19_0x359fa9(0x178),adminController[a19_0x359fa9(0x15b)]),router[a19_0x359fa9(0x182)](a19_0x359fa9(0x149),adminController[a19_0x359fa9(0x193)]),router['post']('/users/:id/activate',adminController[a19_0x359fa9(0x154)]),router['get']('/logs/stats',(_0x2edf08,_0x17825b)=>{const _0xcc85fc=a19_0x359fa9;try{const _0x4f9374=loggerService_1[_0xcc85fc(0x147)]['getLogStats']();_0x17825b['json']({'success':!![],'result':_0x4f9374});}catch(_0x541805){_0x17825b[_0xcc85fc(0x1a8)](0x1f4)[_0xcc85fc(0x1a4)]({'success':![],'message':_0xcc85fc(0x172)});}}),router['post']('/logs/clean',(_0x2f83d0,_0x18216a)=>{const _0xa82be4=a19_0x359fa9;try{const {daysToKeep:daysToKeep=0x1e}=_0x2f83d0[_0xa82be4(0x18e)];loggerService_1[_0xa82be4(0x147)][_0xa82be4(0x14c)](daysToKeep),_0x18216a['json']({'success':!![],'message':_0xa82be4(0x159)+daysToKeep+'\x20days)'});}catch(_0x5d1adf){_0x18216a[_0xa82be4(0x1a8)](0x1f4)['json']({'success':![],'message':_0xa82be4(0x166)});}}),router[a19_0x359fa9(0x182)](a19_0x359fa9(0x184),async(_0x3c03ab,_0x45e95a)=>{const _0x3f0b53=a19_0x359fa9;try{const {paymentId:_0x1df68b}=_0x3c03ab[_0x3f0b53(0x13b)];console[_0x3f0b53(0x1a7)]('üîç\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20requested\x20for\x20payment:\x20'+_0x1df68b),await coinToPayStatusService_1[_0x3f0b53(0x152)][_0x3f0b53(0x158)](_0x1df68b),_0x45e95a['json']({'success':!![],'message':_0x3f0b53(0x175)});}catch(_0xb609c7){console['error']('‚ùå\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20failed\x20for\x20payment\x20'+_0x3c03ab[_0x3f0b53(0x13b)][_0x3f0b53(0x174)]+':',_0xb609c7),_0x45e95a[_0x3f0b53(0x1a8)](0x1f4)['json']({'success':![],'message':_0xb609c7 instanceof Error?_0xb609c7['message']:_0x3f0b53(0x17f)});}}),router[a19_0x359fa9(0x15e)](a19_0x359fa9(0x1a1),(_0x337df4,_0x51e554)=>{const _0x49e435=a19_0x359fa9;try{const _0x221376=coinToPayStatusService_1[_0x49e435(0x152)][_0x49e435(0x1af)]();_0x51e554[_0x49e435(0x1a4)]({'success':!![],'result':{..._0x221376,'description':_0x49e435(0x145),'statusMapping':{'Paid':_0x49e435(0x19f),'Awaiting\x20Fiat':_0x49e435(0x1bc),'waiting':_0x49e435(0x1bc),'expired':_0x49e435(0x16d),'failed':_0x49e435(0x13f)},'autoExpiryNote':'Payments\x20automatically\x20expire\x20after\x20'+_0x221376[_0x49e435(0x161)]+_0x49e435(0x1a2),'individualTimersNote':_0x49e435(0x18b)}});}catch(_0x1a54bc){_0x51e554[_0x49e435(0x1a8)](0x1f4)[_0x49e435(0x1a4)]({'success':![],'message':_0x49e435(0x192)});}}),router[a19_0x359fa9(0x15e)](a19_0x359fa9(0x16b),async(_0x3eb8f9,_0x51e27f)=>{const _0x11f6e3=a19_0x359fa9;try{const {paymentId:_0x51c566}=_0x3eb8f9['params'],_0x5beb8d=coinToPayStatusService_1[_0x11f6e3(0x152)][_0x11f6e3(0x143)](_0x51c566),_0x5403c7=(await Promise[_0x11f6e3(0x195)]()['then'](()=>__importStar(require(_0x11f6e3(0x1b1)))))[_0x11f6e3(0x1ad)],_0x302236=await _0x5403c7[_0x11f6e3(0x1ac)]['findUnique']({'where':{'id':_0x51c566},'select':{'id':!![],'gateway':!![],'gatewayPaymentId':!![],'status':!![],'amount':!![],'currency':!![],'createdAt':!![],'updatedAt':!![],'shopId':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x302236)return _0x51e27f[_0x11f6e3(0x1a8)](0x194)[_0x11f6e3(0x1a4)]({'success':![],'message':_0x11f6e3(0x17d)});_0x51e27f['json']({'success':!![],'result':{'payment':{'id':_0x302236['id'],'gateway':_0x302236[_0x11f6e3(0x141)],'gatewayPaymentId':_0x302236[_0x11f6e3(0x1b7)],'status':_0x302236[_0x11f6e3(0x1a8)],'amount':_0x302236[_0x11f6e3(0x17e)],'currency':_0x302236[_0x11f6e3(0x1a6)],'createdAt':_0x302236[_0x11f6e3(0x17b)],'updatedAt':_0x302236['updatedAt'],'shop':_0x302236[_0x11f6e3(0x179)]},'timers':_0x5beb8d,'isCoinToPay':_0x302236[_0x11f6e3(0x141)]==='cointopay','ageInMinutes':Math['floor']((Date['now']()-_0x302236[_0x11f6e3(0x17b)]['getTime']())/(0x3e8*0x3c))}});}catch(_0x49f818){_0x51e27f['status'](0x1f4)[_0x11f6e3(0x1a4)]({'success':![],'message':_0x49f818 instanceof Error?_0x49f818[_0x11f6e3(0x16a)]:'Failed\x20to\x20get\x20payment\x20information'});}}),router[a19_0x359fa9(0x182)]('/rapyd/check/:paymentId',async(_0x5a08d0,_0x2b0b24)=>{const _0x9b0473=a19_0x359fa9;try{const {paymentId:_0x425762}=_0x5a08d0[_0x9b0473(0x13b)];console[_0x9b0473(0x1a7)]('üîç\x20[ADMIN]\x20Manual\x20Rapyd\x20check\x20requested\x20for\x20payment:\x20'+_0x425762),await rapydStatusService_1[_0x9b0473(0x177)][_0x9b0473(0x158)](_0x425762),_0x2b0b24[_0x9b0473(0x1a4)]({'success':!![],'message':_0x9b0473(0x1bd)});}catch(_0xec881b){console['error'](_0x9b0473(0x189)+_0x5a08d0['params']['paymentId']+':',_0xec881b),_0x2b0b24[_0x9b0473(0x1a8)](0x1f4)[_0x9b0473(0x1a4)]({'success':![],'message':_0xec881b instanceof Error?_0xec881b[_0x9b0473(0x16a)]:_0x9b0473(0x180)});}}),router['get']('/rapyd/stats',(_0x518718,_0x1c3312)=>{const _0x1431f4=a19_0x359fa9;try{const _0x3d5470=rapydStatusService_1[_0x1431f4(0x177)]['getServiceStats']();_0x1c3312[_0x1431f4(0x1a4)]({'success':!![],'result':{..._0x3d5470,'description':_0x1431f4(0x15a),'statusMapping':{'paid:\x20true':_0x1431f4(0x19f),'paid:\x20false\x20+\x20CAN':_0x1431f4(0x13f),'paid:\x20false\x20+\x20ERR':_0x1431f4(0x13f),'paid:\x20false\x20+\x20EXP':_0x1431f4(0x16d),'paid:\x20false\x20+\x20other':_0x1431f4(0x1bc)},'checkSchedule':'Payments\x20are\x20checked\x20after\x2030\x20minutes\x20and\x2060\x20minutes,\x20then\x20forgotten','note':'Only\x20checks\x20payments\x20with\x20status\x20PENDING\x20at\x20check\x20time'}});}catch(_0x57d3ec){_0x1c3312[_0x1431f4(0x1a8)](0x1f4)[_0x1431f4(0x1a4)]({'success':![],'message':_0x1431f4(0x139)});}}),router['get'](a19_0x359fa9(0x18c),async(_0x192d20,_0x2fc688)=>{const _0x21b24b=a19_0x359fa9;try{const {paymentId:_0x1642ef}=_0x192d20[_0x21b24b(0x13b)],_0x1618d5=await database_1[_0x21b24b(0x1ad)]['payment'][_0x21b24b(0x19a)]({'where':{'id':_0x1642ef},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x1618d5)return _0x2fc688['status'](0x194)[_0x21b24b(0x1a4)]({'success':![],'message':_0x21b24b(0x17d)});const _0x18a31f=rapydStatusService_1[_0x21b24b(0x177)]['getPaymentTimerInfo'](_0x1642ef);_0x2fc688[_0x21b24b(0x1a4)]({'success':!![],'result':{'payment':{'id':_0x1618d5['id'],'gateway':_0x1618d5[_0x21b24b(0x141)],'gatewayPaymentId':_0x1618d5['gatewayPaymentId'],'status':_0x1618d5[_0x21b24b(0x1a8)],'amount':_0x1618d5[_0x21b24b(0x17e)],'currency':_0x1618d5[_0x21b24b(0x1a6)],'createdAt':_0x1618d5[_0x21b24b(0x17b)],'updatedAt':_0x1618d5['updatedAt'],'shop':_0x1618d5[_0x21b24b(0x179)]},'timers':_0x18a31f,'isRapyd':_0x1618d5['gateway']===_0x21b24b(0x1b2),'ageInMinutes':Math['floor']((Date[_0x21b24b(0x188)]()-_0x1618d5['createdAt'][_0x21b24b(0x18d)]())/(0x3e8*0x3c)),'nextCheck':_0x18a31f['hasTimers']?Math[_0x21b24b(0x163)]((Date[_0x21b24b(0x188)]()-_0x1618d5['createdAt'][_0x21b24b(0x18d)]())/(0x3e8*0x3c))<0x1e?0x1e-Math[_0x21b24b(0x163)]((Date[_0x21b24b(0x188)]()-_0x1618d5[_0x21b24b(0x17b)][_0x21b24b(0x18d)]())/(0x3e8*0x3c))+'\x20minutes':Math[_0x21b24b(0x163)]((Date['now']()-_0x1618d5[_0x21b24b(0x17b)][_0x21b24b(0x18d)]())/(0x3e8*0x3c))<0x3c?0x3c-Math[_0x21b24b(0x163)]((Date[_0x21b24b(0x188)]()-_0x1618d5[_0x21b24b(0x17b)][_0x21b24b(0x18d)]())/(0x3e8*0x3c))+_0x21b24b(0x148):_0x21b24b(0x199):_0x21b24b(0x13a)}});}catch(_0x103135){_0x2fc688[_0x21b24b(0x1a8)](0x1f4)['json']({'success':![],'message':_0x103135 instanceof Error?_0x103135['message']:_0x21b24b(0x173)});}}),router['get']('/domain-monitoring/stats',(_0x2d35fd,_0x31da67)=>{const _0x373fe5=a19_0x359fa9;try{const _0x1a0701=domainMonitoringService_1['domainMonitoringService'][_0x373fe5(0x17a)]();_0x31da67[_0x373fe5(0x1a4)]({'success':!![],'result':{..._0x1a0701,'description':_0x373fe5(0x14a),'behavior':_0x373fe5(0x13c),'encoding':_0x373fe5(0x198)}});}catch(_0x2eaf3c){_0x31da67[_0x373fe5(0x1a8)](0x1f4)['json']({'success':![],'message':_0x373fe5(0x176)});}}),router['post'](a19_0x359fa9(0x1ae),async(_0x3682de,_0x58d83d)=>{const _0x476787=a19_0x359fa9;try{const _0xb0b032=await domainMonitoringService_1[_0x476787(0x187)]['manualCheck']();_0x58d83d['json']({'success':!![],'result':{'domainAvailable':_0xb0b032,'message':_0xb0b032?_0x476787(0x162):_0x476787(0x1ab),'timestamp':new Date()[_0x476787(0x15f)]()}});}catch(_0x54ba27){_0x58d83d[_0x476787(0x1a8)](0x1f4)[_0x476787(0x1a4)]({'success':![],'message':_0x54ba27 instanceof Error?_0x54ba27['message']:_0x476787(0x185)});}}),exports['default']=router;