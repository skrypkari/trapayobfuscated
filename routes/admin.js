'use strict';const a19_0x2d1d17=a19_0x4e91;function a19_0x1fb5(){const _0x5ea3d0=['deleteUser','PENDING','put','manualCheck','expiryDays','/payments/:id','resolve','Rapyd\x20automatic\x20status\x20checking\x20service','shop','validate','domainMonitoringService','1323801ACBtzO','/merchant-statistics','No\x20checks\x20scheduled','3JlbbQG','getPayoutById','rapyd','body','createUser','40544uZjAjq','get','../services/coinToPayStatusService','../services/rapydStatusService','getUsers','payment','/payout','Domain\x20is\x20responding\x20correctly','gatewayPaymentId','params','createdAt','FAILED','default','../config/database','use','12KqiROr','length','getPaymentById','getServiceStats','60NKhLnp','updatedAt','requireAdmin','updateCustomerData','456wceuBr','Failed\x20to\x20get\x20domain\x20monitoring\x20statistics','hasOwnProperty','EXPIRED','coinToPayStatusService','Failed\x20to\x20clean\x20old\x20logs','authenticateToken','then','toISOString','Payments\x20automatically\x20expire\x20after\x20','Server\x20crashes\x20if\x20domain\x20is\x20not\x20responding\x20after\x20consecutive\x20failures','Failed\x20to\x20get\x20payment\x20information','amount','loggerService','writable','getPayouts','create','rapydStatusService','__importDefault','Payment\x20not\x20found','CoinToPay\x20payment\x20status\x20checked\x20successfully','defineProperty','getPayoutStats','getTime','call','/payments','31596LaCztL','/statistics','309903TUimCZ','../middleware/validation','status','/domain-monitoring/check','50392ryDzTJ','floor','/users/:id/suspend','117wXuRVo','/payments/:id/customer','../middleware/auth','hasTimers','json','No\x20more\x20checks\x20scheduled','Only\x20checks\x20payments\x20with\x20status\x20PENDING\x20at\x20check\x20time','__setModuleDefault','now','/users/:id','/rapyd/stats','message','üîç\x20[ADMIN]\x20Manual\x20Rapyd\x20check\x20requested\x20for\x20payment:\x20','deletePayout','log','/cointopay/payment/:paymentId','updateCustomerDataSchema','241934RnBjND','Domain\x20check\x20failed','\x20minutes','üîç\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20requested\x20for\x20payment:\x20','Failed\x20to\x20get\x20CoinToPay\x20service\x20statistics','checkPaymentById','updateUserSchema','Failed\x20to\x20check\x20Rapyd\x20payment\x20status','CoinToPay\x20automatic\x20status\x20checking\x20service','/payouts/:id','currency','../controllers/adminController','/users','findUnique','paymentId','__esModule','20477379umLRZz','Requests\x20are\x20made\x20with\x20base64\x20encoded\x20URLs','getOwnPropertyDescriptor','/rapyd/check/:paymentId','getMerchantStatistics','\x20days\x20if\x20not\x20paid','Router','/logs/clean','delete','cleanOldLogs','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status','AdminController','/auth','getMerchantsAwaitingPayout','__importStar','gateway','updatePayment','/payout/merchants','error','suspendUser','/merchants/selection','Payments\x20are\x20checked\x20after\x2030\x20minutes\x20and\x2060\x20minutes,\x20then\x20forgotten','PAID','‚ùå\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20failed\x20for\x20payment\x20','updateUser','express','515pASNvi','/users/:id/activate','createPayoutSchema','getPaymentTimerInfo','post'];a19_0x1fb5=function(){return _0x5ea3d0;};return a19_0x1fb5();}(function(_0x1bfd01,_0x475ebc){const _0x5038d2=a19_0x4e91,_0x1ac543=_0x1bfd01();while(!![]){try{const _0x2d78c5=parseInt(_0x5038d2(0x11c))/0x1*(-parseInt(_0x5038d2(0x16c))/0x2)+parseInt(_0x5038d2(0x15b))/0x3*(parseInt(_0x5038d2(0x158))/0x4)+parseInt(_0x5038d2(0x109))/0x5*(-parseInt(_0x5038d2(0x152))/0x6)+parseInt(_0x5038d2(0x121))/0x7*(parseInt(_0x5038d2(0x138))/0x8)+-parseInt(_0x5038d2(0x119))/0x9*(parseInt(_0x5038d2(0x134))/0xa)+parseInt(_0x5038d2(0x154))/0xb*(-parseInt(_0x5038d2(0x130))/0xc)+parseInt(_0x5038d2(0x17c))/0xd;if(_0x2d78c5===_0x475ebc)break;else _0x1ac543['push'](_0x1ac543['shift']());}catch(_0x18272){_0x1ac543['push'](_0x1ac543['shift']());}}}(a19_0x1fb5,0x8dc23));function a19_0x4e91(_0x293c07,_0x1f0a4a){const _0x1fb5f4=a19_0x1fb5();return a19_0x4e91=function(_0x4e91be,_0x2bff2d){_0x4e91be=_0x4e91be-0x108;let _0x57bc11=_0x1fb5f4[_0x4e91be];return _0x57bc11;},a19_0x4e91(_0x293c07,_0x1f0a4a);}var __createBinding=this&&this['__createBinding']||(Object[a19_0x2d1d17(0x148)]?function(_0x32b56b,_0x2409f9,_0x32277f,_0xb5a280){const _0x57a24a=a19_0x2d1d17;if(_0xb5a280===undefined)_0xb5a280=_0x32277f;var _0x25659a=Object[_0x57a24a(0x17e)](_0x2409f9,_0x32277f);(!_0x25659a||('get'in _0x25659a?!_0x2409f9[_0x57a24a(0x17b)]:_0x25659a[_0x57a24a(0x146)]||_0x25659a['configurable']))&&(_0x25659a={'enumerable':!![],'get':function(){return _0x2409f9[_0x32277f];}}),Object['defineProperty'](_0x32b56b,_0xb5a280,_0x25659a);}:function(_0x50f9eb,_0x3384b1,_0x1b1d90,_0xb2f830){if(_0xb2f830===undefined)_0xb2f830=_0x1b1d90;_0x50f9eb[_0xb2f830]=_0x3384b1[_0x1b1d90];}),__setModuleDefault=this&&this[a19_0x2d1d17(0x162)]||(Object[a19_0x2d1d17(0x148)]?function(_0x52959e,_0x1be689){const _0x3fe5b6=a19_0x2d1d17;Object[_0x3fe5b6(0x14d)](_0x52959e,_0x3fe5b6(0x12d),{'enumerable':!![],'value':_0x1be689});}:function(_0x3c5526,_0xa8cfcf){_0x3c5526['default']=_0xa8cfcf;}),__importStar=this&&this[a19_0x2d1d17(0x18a)]||(function(){var _0x386e12=function(_0x14ca52){return _0x386e12=Object['getOwnPropertyNames']||function(_0x5e2d4c){const _0x31b1f7=a19_0x4e91;var _0x2304e5=[];for(var _0x4401f2 in _0x5e2d4c)if(Object['prototype'][_0x31b1f7(0x13a)][_0x31b1f7(0x150)](_0x5e2d4c,_0x4401f2))_0x2304e5[_0x2304e5['length']]=_0x4401f2;return _0x2304e5;},_0x386e12(_0x14ca52);};return function(_0x1fea56){const _0x2c4003=a19_0x4e91;if(_0x1fea56&&_0x1fea56[_0x2c4003(0x17b)])return _0x1fea56;var _0x38823a={};if(_0x1fea56!=null){for(var _0x2ba139=_0x386e12(_0x1fea56),_0x381ab8=0x0;_0x381ab8<_0x2ba139[_0x2c4003(0x131)];_0x381ab8++)if(_0x2ba139[_0x381ab8]!==_0x2c4003(0x12d))__createBinding(_0x38823a,_0x1fea56,_0x2ba139[_0x381ab8]);}return __setModuleDefault(_0x38823a,_0x1fea56),_0x38823a;};}()),__importDefault=this&&this[a19_0x2d1d17(0x14a)]||function(_0x569d69){const _0xfab51b=a19_0x2d1d17;return _0x569d69&&_0x569d69[_0xfab51b(0x17b)]?_0x569d69:{'default':_0x569d69};};Object[a19_0x2d1d17(0x14d)](exports,a19_0x2d1d17(0x17b),{'value':!![]});const express_1=require(a19_0x2d1d17(0x108)),adminController_1=require(a19_0x2d1d17(0x177)),validation_1=require(a19_0x2d1d17(0x155)),auth_1=require(a19_0x2d1d17(0x15d)),loggerService_1=require('../services/loggerService'),coinToPayStatusService_1=require(a19_0x2d1d17(0x123)),rapydStatusService_1=require(a19_0x2d1d17(0x124)),domainMonitoringService_1=require('../services/domainMonitoringService'),database_1=__importDefault(require(a19_0x2d1d17(0x12e))),router=(0x0,express_1[a19_0x2d1d17(0x182)])(),adminController=new adminController_1[(a19_0x2d1d17(0x187))]();router[a19_0x2d1d17(0x12f)](auth_1[a19_0x2d1d17(0x13e)],auth_1[a19_0x2d1d17(0x136)]),router['get'](a19_0x2d1d17(0x188),adminController['checkAuth']),router[a19_0x2d1d17(0x122)](a19_0x2d1d17(0x153),adminController['getStatistics']),router[a19_0x2d1d17(0x122)](a19_0x2d1d17(0x11a),adminController[a19_0x2d1d17(0x180)]),router['get'](a19_0x2d1d17(0x190),adminController['getMerchantsSelection']),router[a19_0x2d1d17(0x122)]('/payout/stats',adminController[a19_0x2d1d17(0x14e)]),router['get'](a19_0x2d1d17(0x18d),adminController[a19_0x2d1d17(0x189)]),router['post'](a19_0x2d1d17(0x127),(0x0,validation_1[a19_0x2d1d17(0x117)])(validation_1[a19_0x2d1d17(0x10b)]),adminController['createPayout']),router[a19_0x2d1d17(0x122)]('/payouts',adminController[a19_0x2d1d17(0x147)]),router[a19_0x2d1d17(0x122)](a19_0x2d1d17(0x175),adminController[a19_0x2d1d17(0x11d)]),router['delete'](a19_0x2d1d17(0x175),adminController[a19_0x2d1d17(0x168)]),router['get'](a19_0x2d1d17(0x151),adminController['getPayments']),router['get'](a19_0x2d1d17(0x113),adminController[a19_0x2d1d17(0x132)]),router[a19_0x2d1d17(0x110)](a19_0x2d1d17(0x113),adminController[a19_0x2d1d17(0x18c)]),router[a19_0x2d1d17(0x110)](a19_0x2d1d17(0x15c),(0x0,validation_1[a19_0x2d1d17(0x117)])(validation_1[a19_0x2d1d17(0x16b)]),adminController[a19_0x2d1d17(0x137)]),router['get'](a19_0x2d1d17(0x178),adminController[a19_0x2d1d17(0x125)]),router['get'](a19_0x2d1d17(0x164),adminController['getUserById']),router['post'](a19_0x2d1d17(0x178),(0x0,validation_1['validate'])(validation_1['createUserSchema']),adminController[a19_0x2d1d17(0x120)]),router[a19_0x2d1d17(0x110)](a19_0x2d1d17(0x164),(0x0,validation_1[a19_0x2d1d17(0x117)])(validation_1[a19_0x2d1d17(0x172)]),adminController[a19_0x2d1d17(0x194)]),router[a19_0x2d1d17(0x184)](a19_0x2d1d17(0x164),adminController[a19_0x2d1d17(0x10e)]),router[a19_0x2d1d17(0x10d)](a19_0x2d1d17(0x15a),adminController[a19_0x2d1d17(0x18f)]),router[a19_0x2d1d17(0x10d)](a19_0x2d1d17(0x10a),adminController['activateUser']),router[a19_0x2d1d17(0x122)]('/logs/stats',(_0x1a7c0c,_0x28bd8b)=>{const _0x29e0bd=a19_0x2d1d17;try{const _0x594fbb=loggerService_1[_0x29e0bd(0x145)]['getLogStats']();_0x28bd8b[_0x29e0bd(0x15f)]({'success':!![],'result':_0x594fbb});}catch(_0x1b24c2){_0x28bd8b[_0x29e0bd(0x156)](0x1f4)['json']({'success':![],'message':'Failed\x20to\x20get\x20log\x20statistics'});}}),router[a19_0x2d1d17(0x10d)](a19_0x2d1d17(0x183),(_0x5e8b6a,_0x4ffe07)=>{const _0x3b1de8=a19_0x2d1d17;try{const {daysToKeep:daysToKeep=0x1e}=_0x5e8b6a[_0x3b1de8(0x11f)];loggerService_1[_0x3b1de8(0x145)][_0x3b1de8(0x185)](daysToKeep),_0x4ffe07[_0x3b1de8(0x15f)]({'success':!![],'message':'Old\x20logs\x20cleaned\x20(kept\x20last\x20'+daysToKeep+'\x20days)'});}catch(_0x248ce8){_0x4ffe07['status'](0x1f4)[_0x3b1de8(0x15f)]({'success':![],'message':_0x3b1de8(0x13d)});}}),router['post']('/cointopay/check/:paymentId',async(_0x335909,_0x26c0cc)=>{const _0x29cdd1=a19_0x2d1d17;try{const {paymentId:_0x2723aa}=_0x335909['params'];console[_0x29cdd1(0x169)](_0x29cdd1(0x16f)+_0x2723aa),await coinToPayStatusService_1[_0x29cdd1(0x13c)][_0x29cdd1(0x171)](_0x2723aa),_0x26c0cc[_0x29cdd1(0x15f)]({'success':!![],'message':_0x29cdd1(0x14c)});}catch(_0x3c3e75){console[_0x29cdd1(0x18e)](_0x29cdd1(0x193)+_0x335909['params'][_0x29cdd1(0x17a)]+':',_0x3c3e75),_0x26c0cc['status'](0x1f4)[_0x29cdd1(0x15f)]({'success':![],'message':_0x3c3e75 instanceof Error?_0x3c3e75['message']:_0x29cdd1(0x186)});}}),router[a19_0x2d1d17(0x122)]('/cointopay/stats',(_0x3f8313,_0x20441d)=>{const _0x3ff88f=a19_0x2d1d17;try{const _0x4f23a4=coinToPayStatusService_1[_0x3ff88f(0x13c)][_0x3ff88f(0x133)]();_0x20441d[_0x3ff88f(0x15f)]({'success':!![],'result':{..._0x4f23a4,'description':_0x3ff88f(0x174),'statusMapping':{'Paid':_0x3ff88f(0x192),'Awaiting\x20Fiat':_0x3ff88f(0x10f),'waiting':_0x3ff88f(0x10f),'expired':_0x3ff88f(0x13b),'failed':'FAILED'},'autoExpiryNote':_0x3ff88f(0x141)+_0x4f23a4[_0x3ff88f(0x112)]+_0x3ff88f(0x181),'individualTimersNote':'Each\x20new\x20payment\x20gets\x20individual\x20timers:\x201min,\x202min,\x207min,\x2012min,\x20then\x20hourly'}});}catch(_0x44761b){_0x20441d[_0x3ff88f(0x156)](0x1f4)[_0x3ff88f(0x15f)]({'success':![],'message':_0x3ff88f(0x170)});}}),router[a19_0x2d1d17(0x122)](a19_0x2d1d17(0x16a),async(_0x582b0c,_0x15a744)=>{const _0x227d6c=a19_0x2d1d17;try{const {paymentId:_0x254257}=_0x582b0c[_0x227d6c(0x12a)],_0x3b6c40=coinToPayStatusService_1[_0x227d6c(0x13c)][_0x227d6c(0x10c)](_0x254257),_0x553376=(await Promise[_0x227d6c(0x114)]()[_0x227d6c(0x13f)](()=>__importStar(require('../config/database'))))[_0x227d6c(0x12d)],_0x2b37db=await _0x553376[_0x227d6c(0x126)][_0x227d6c(0x179)]({'where':{'id':_0x254257},'select':{'id':!![],'gateway':!![],'gatewayPaymentId':!![],'status':!![],'amount':!![],'currency':!![],'createdAt':!![],'updatedAt':!![],'shopId':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2b37db)return _0x15a744['status'](0x194)[_0x227d6c(0x15f)]({'success':![],'message':_0x227d6c(0x14b)});_0x15a744['json']({'success':!![],'result':{'payment':{'id':_0x2b37db['id'],'gateway':_0x2b37db['gateway'],'gatewayPaymentId':_0x2b37db[_0x227d6c(0x129)],'status':_0x2b37db[_0x227d6c(0x156)],'amount':_0x2b37db[_0x227d6c(0x144)],'currency':_0x2b37db[_0x227d6c(0x176)],'createdAt':_0x2b37db[_0x227d6c(0x12b)],'updatedAt':_0x2b37db[_0x227d6c(0x135)],'shop':_0x2b37db[_0x227d6c(0x116)]},'timers':_0x3b6c40,'isCoinToPay':_0x2b37db[_0x227d6c(0x18b)]==='cointopay','ageInMinutes':Math[_0x227d6c(0x159)]((Date['now']()-_0x2b37db[_0x227d6c(0x12b)][_0x227d6c(0x14f)]())/(0x3e8*0x3c))}});}catch(_0xdb4a0){_0x15a744[_0x227d6c(0x156)](0x1f4)[_0x227d6c(0x15f)]({'success':![],'message':_0xdb4a0 instanceof Error?_0xdb4a0[_0x227d6c(0x166)]:_0x227d6c(0x143)});}}),router[a19_0x2d1d17(0x10d)](a19_0x2d1d17(0x17f),async(_0x5494a5,_0x15197d)=>{const _0x3667ec=a19_0x2d1d17;try{const {paymentId:_0x9e514f}=_0x5494a5['params'];console[_0x3667ec(0x169)](_0x3667ec(0x167)+_0x9e514f),await rapydStatusService_1[_0x3667ec(0x149)][_0x3667ec(0x171)](_0x9e514f),_0x15197d['json']({'success':!![],'message':'Rapyd\x20payment\x20status\x20checked\x20successfully'});}catch(_0x13d2ee){console[_0x3667ec(0x18e)]('‚ùå\x20[ADMIN]\x20Manual\x20Rapyd\x20check\x20failed\x20for\x20payment\x20'+_0x5494a5['params'][_0x3667ec(0x17a)]+':',_0x13d2ee),_0x15197d[_0x3667ec(0x156)](0x1f4)[_0x3667ec(0x15f)]({'success':![],'message':_0x13d2ee instanceof Error?_0x13d2ee['message']:_0x3667ec(0x173)});}}),router[a19_0x2d1d17(0x122)](a19_0x2d1d17(0x165),(_0x25f4a2,_0x2f15b9)=>{const _0x3b08a5=a19_0x2d1d17;try{const _0xc270c4=rapydStatusService_1[_0x3b08a5(0x149)][_0x3b08a5(0x133)]();_0x2f15b9[_0x3b08a5(0x15f)]({'success':!![],'result':{..._0xc270c4,'description':_0x3b08a5(0x115),'statusMapping':{'paid:\x20true':'PAID','paid:\x20false\x20+\x20CAN':_0x3b08a5(0x12c),'paid:\x20false\x20+\x20ERR':_0x3b08a5(0x12c),'paid:\x20false\x20+\x20EXP':_0x3b08a5(0x13b),'paid:\x20false\x20+\x20other':_0x3b08a5(0x10f)},'checkSchedule':_0x3b08a5(0x191),'note':_0x3b08a5(0x161)}});}catch(_0x2bdb15){_0x2f15b9[_0x3b08a5(0x156)](0x1f4)[_0x3b08a5(0x15f)]({'success':![],'message':'Failed\x20to\x20get\x20Rapyd\x20service\x20statistics'});}}),router[a19_0x2d1d17(0x122)]('/rapyd/payment/:paymentId',async(_0x42a0a9,_0x57b29b)=>{const _0x457342=a19_0x2d1d17;try{const {paymentId:_0x3b5c42}=_0x42a0a9[_0x457342(0x12a)],_0x1f7685=await database_1[_0x457342(0x12d)][_0x457342(0x126)][_0x457342(0x179)]({'where':{'id':_0x3b5c42},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x1f7685)return _0x57b29b['status'](0x194)[_0x457342(0x15f)]({'success':![],'message':_0x457342(0x14b)});const _0x1f8649=rapydStatusService_1[_0x457342(0x149)][_0x457342(0x10c)](_0x3b5c42);_0x57b29b[_0x457342(0x15f)]({'success':!![],'result':{'payment':{'id':_0x1f7685['id'],'gateway':_0x1f7685[_0x457342(0x18b)],'gatewayPaymentId':_0x1f7685[_0x457342(0x129)],'status':_0x1f7685['status'],'amount':_0x1f7685['amount'],'currency':_0x1f7685['currency'],'createdAt':_0x1f7685[_0x457342(0x12b)],'updatedAt':_0x1f7685[_0x457342(0x135)],'shop':_0x1f7685[_0x457342(0x116)]},'timers':_0x1f8649,'isRapyd':_0x1f7685[_0x457342(0x18b)]===_0x457342(0x11e),'ageInMinutes':Math['floor']((Date[_0x457342(0x163)]()-_0x1f7685['createdAt']['getTime']())/(0x3e8*0x3c)),'nextCheck':_0x1f8649[_0x457342(0x15e)]?Math[_0x457342(0x159)]((Date[_0x457342(0x163)]()-_0x1f7685[_0x457342(0x12b)]['getTime']())/(0x3e8*0x3c))<0x1e?0x1e-Math[_0x457342(0x159)]((Date[_0x457342(0x163)]()-_0x1f7685['createdAt'][_0x457342(0x14f)]())/(0x3e8*0x3c))+_0x457342(0x16e):Math[_0x457342(0x159)]((Date[_0x457342(0x163)]()-_0x1f7685[_0x457342(0x12b)][_0x457342(0x14f)]())/(0x3e8*0x3c))<0x3c?0x3c-Math[_0x457342(0x159)]((Date[_0x457342(0x163)]()-_0x1f7685['createdAt'][_0x457342(0x14f)]())/(0x3e8*0x3c))+_0x457342(0x16e):_0x457342(0x160):_0x457342(0x11b)}});}catch(_0x4e0098){_0x57b29b[_0x457342(0x156)](0x1f4)[_0x457342(0x15f)]({'success':![],'message':_0x4e0098 instanceof Error?_0x4e0098[_0x457342(0x166)]:_0x457342(0x143)});}}),router[a19_0x2d1d17(0x122)]('/domain-monitoring/stats',(_0x550291,_0x53b3bc)=>{const _0x5c80e6=a19_0x2d1d17;try{const _0x1d62ea=domainMonitoringService_1[_0x5c80e6(0x118)]['getMonitoringStats']();_0x53b3bc[_0x5c80e6(0x15f)]({'success':!![],'result':{..._0x1d62ea,'description':'Domain\x20monitoring\x20service\x20for\x20amaterasy884.icu','behavior':_0x5c80e6(0x142),'encoding':_0x5c80e6(0x17d)}});}catch(_0x92d92a){_0x53b3bc['status'](0x1f4)[_0x5c80e6(0x15f)]({'success':![],'message':_0x5c80e6(0x139)});}}),router[a19_0x2d1d17(0x10d)](a19_0x2d1d17(0x157),async(_0x1ce097,_0x12b24a)=>{const _0x1e2ffa=a19_0x2d1d17;try{const _0x398225=await domainMonitoringService_1[_0x1e2ffa(0x118)][_0x1e2ffa(0x111)]();_0x12b24a[_0x1e2ffa(0x15f)]({'success':!![],'result':{'domainAvailable':_0x398225,'message':_0x398225?_0x1e2ffa(0x128):_0x1e2ffa(0x16d),'timestamp':new Date()[_0x1e2ffa(0x140)]()}});}catch(_0x3270c6){_0x12b24a[_0x1e2ffa(0x156)](0x1f4)[_0x1e2ffa(0x15f)]({'success':![],'message':_0x3270c6 instanceof Error?_0x3270c6[_0x1e2ffa(0x166)]:'Failed\x20to\x20perform\x20manual\x20domain\x20check'});}}),exports[a19_0x2d1d17(0x12d)]=router;