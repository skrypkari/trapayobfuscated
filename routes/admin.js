'use strict';const a19_0x512a94=a19_0x79ef;(function(_0x534f43,_0x42be0f){const _0x39fd7d=a19_0x79ef,_0x9ef205=_0x534f43();while(!![]){try{const _0x4d15ef=parseInt(_0x39fd7d(0x207))/0x1+parseInt(_0x39fd7d(0x20d))/0x2+parseInt(_0x39fd7d(0x1fa))/0x3+-parseInt(_0x39fd7d(0x242))/0x4*(-parseInt(_0x39fd7d(0x220))/0x5)+parseInt(_0x39fd7d(0x258))/0x6+-parseInt(_0x39fd7d(0x1f2))/0x7+parseInt(_0x39fd7d(0x1f0))/0x8*(-parseInt(_0x39fd7d(0x256))/0x9);if(_0x4d15ef===_0x42be0f)break;else _0x9ef205['push'](_0x9ef205['shift']());}catch(_0x25b24b){_0x9ef205['push'](_0x9ef205['shift']());}}}(a19_0x4e6a,0x9f97b));var __createBinding=this&&this[a19_0x512a94(0x227)]||(Object[a19_0x512a94(0x1f4)]?function(_0x2bc2c2,_0x299fba,_0x588027,_0x29cade){const _0x158c85=a19_0x512a94;if(_0x29cade===undefined)_0x29cade=_0x588027;var _0x4d17d5=Object['getOwnPropertyDescriptor'](_0x299fba,_0x588027);(!_0x4d17d5||(_0x158c85(0x1e5)in _0x4d17d5?!_0x299fba[_0x158c85(0x209)]:_0x4d17d5[_0x158c85(0x240)]||_0x4d17d5['configurable']))&&(_0x4d17d5={'enumerable':!![],'get':function(){return _0x299fba[_0x588027];}}),Object[_0x158c85(0x21f)](_0x2bc2c2,_0x29cade,_0x4d17d5);}:function(_0x5cf2d2,_0x1020b5,_0x27dd4b,_0xb4bc1){if(_0xb4bc1===undefined)_0xb4bc1=_0x27dd4b;_0x5cf2d2[_0xb4bc1]=_0x1020b5[_0x27dd4b];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x46e84a,_0x114d3a){const _0x4c613a=a19_0x512a94;Object[_0x4c613a(0x21f)](_0x46e84a,_0x4c613a(0x234),{'enumerable':!![],'value':_0x114d3a});}:function(_0x312240,_0x5755f4){_0x312240['default']=_0x5755f4;}),__importStar=this&&this[a19_0x512a94(0x255)]||(function(){var _0x31b610=function(_0x180ebe){const _0x3ba1bb=a19_0x79ef;return _0x31b610=Object[_0x3ba1bb(0x1dc)]||function(_0x2120f8){const _0x2eac1c=_0x3ba1bb;var _0x23b688=[];for(var _0x5438f4 in _0x2120f8)if(Object[_0x2eac1c(0x1e2)][_0x2eac1c(0x24d)][_0x2eac1c(0x215)](_0x2120f8,_0x5438f4))_0x23b688[_0x23b688[_0x2eac1c(0x216)]]=_0x5438f4;return _0x23b688;},_0x31b610(_0x180ebe);};return function(_0x25fb20){const _0x2bb2f1=a19_0x79ef;if(_0x25fb20&&_0x25fb20[_0x2bb2f1(0x209)])return _0x25fb20;var _0x5a0a9f={};if(_0x25fb20!=null){for(var _0x4633d9=_0x31b610(_0x25fb20),_0x41b7e1=0x0;_0x41b7e1<_0x4633d9[_0x2bb2f1(0x216)];_0x41b7e1++)if(_0x4633d9[_0x41b7e1]!==_0x2bb2f1(0x234))__createBinding(_0x5a0a9f,_0x25fb20,_0x4633d9[_0x41b7e1]);}return __setModuleDefault(_0x5a0a9f,_0x25fb20),_0x5a0a9f;};}()),__importDefault=this&&this['__importDefault']||function(_0x29195b){const _0x5f4a13=a19_0x512a94;return _0x29195b&&_0x29195b[_0x5f4a13(0x209)]?_0x29195b:{'default':_0x29195b};};function a19_0x4e6a(){const _0x487b4c=['getMerchantsSelection','cointopay','/payments/:id/customer','../middleware/auth','Domain\x20check\x20failed','rapydStatusService','Server\x20crashes\x20if\x20domain\x20is\x20not\x20responding\x20after\x20consecutive\x20failures','writable','requireAdmin','80392bAathU','No\x20more\x20checks\x20scheduled','\x20minutes','Requests\x20are\x20made\x20with\x20base64\x20encoded\x20URLs','/domain-monitoring/check','/logs/clean','../services/coinToPayStatusService','status','deleteUser','createUserSchema','getPayoutStats','hasOwnProperty','createdAt','/auth','/domain-monitoring/stats','/rapyd/stats','Each\x20new\x20payment\x20gets\x20individual\x20timers:\x201min,\x202min,\x207min,\x2012min,\x20then\x20hourly','domainMonitoringService','createUser','__importStar','8205309vSUVWn','PAID','1717692sjgHLB','json','PENDING','put','toISOString','\x20days\x20if\x20not\x20paid','gatewayPaymentId','params','updatedAt','gateway','CoinToPay\x20payment\x20status\x20checked\x20successfully','getMerchantStatistics','getOwnPropertyNames','expiryDays','Failed\x20to\x20clean\x20old\x20logs','Failed\x20to\x20get\x20payment\x20information','createPayout','Payments\x20are\x20checked\x20after\x2030\x20minutes\x20and\x2060\x20minutes,\x20then\x20forgotten','prototype','getPayments','EXPIRED','get','AdminController','\x20days)','payment','../middleware/validation','hasTimers','/merchants/selection','validate','currency','Domain\x20is\x20responding\x20correctly','/cointopay/check/:paymentId','8cZMziP','post','6725117HaREmL','getUserById','create','cleanOldLogs','now','checkPaymentById','getTime','updateUserSchema','3885891jeSlQJ','message','Only\x20checks\x20payments\x20with\x20status\x20PENDING\x20at\x20check\x20time','../services/rapydStatusService','Rapyd\x20payment\x20status\x20checked\x20successfully','Payment\x20not\x20found','getPaymentTimerInfo','use','FAILED','delete','deletePayout','loggerService','Failed\x20to\x20perform\x20manual\x20domain\x20check','620152yMvJnD','Failed\x20to\x20get\x20log\x20statistics','__esModule','updatePayment','checkAuth','coinToPayStatusService','608588lSdBdX','Payments\x20automatically\x20expire\x20after\x20','then','Domain\x20monitoring\x20service\x20for\x20amaterasy884.icu','suspendUser','error','rapyd','createPayoutSchema','call','length','/payouts/:id','shop','../controllers/adminController','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status','/users/:id/suspend','❌\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20failed\x20for\x20payment\x20','/users/:id','findUnique','defineProperty','5omzPuG','/payments/:id','getMerchantsAwaitingPayout','amount','getUsers','manualCheck','Failed\x20to\x20get\x20CoinToPay\x20service\x20statistics','__createBinding','../config/database','floor','/merchant-statistics','🔍\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20requested\x20for\x20payment:\x20','getPaymentById','log','getMonitoringStats','authenticateToken','/payouts','/users/:id/activate','/users','🔍\x20[ADMIN]\x20Manual\x20Rapyd\x20check\x20requested\x20for\x20payment:\x20','default','/rapyd/payment/:paymentId','express','Failed\x20to\x20get\x20Rapyd\x20service\x20statistics','paymentId'];a19_0x4e6a=function(){return _0x487b4c;};return a19_0x4e6a();}function a19_0x79ef(_0xef7e54,_0x31adc0){const _0x4e6a13=a19_0x4e6a();return a19_0x79ef=function(_0x79ef25,_0x260a43){_0x79ef25=_0x79ef25-0x1db;let _0x5b6fe8=_0x4e6a13[_0x79ef25];return _0x5b6fe8;},a19_0x79ef(_0xef7e54,_0x31adc0);}Object['defineProperty'](exports,'__esModule',{'value':!![]});const express_1=require(a19_0x512a94(0x236)),adminController_1=require(a19_0x512a94(0x219)),validation_1=require(a19_0x512a94(0x1e9)),auth_1=require(a19_0x512a94(0x23c)),loggerService_1=require('../services/loggerService'),coinToPayStatusService_1=require(a19_0x512a94(0x248)),rapydStatusService_1=require(a19_0x512a94(0x1fd)),domainMonitoringService_1=require('../services/domainMonitoringService'),database_1=__importDefault(require(a19_0x512a94(0x228))),router=(0x0,express_1['Router'])(),adminController=new adminController_1[(a19_0x512a94(0x1e6))]();router[a19_0x512a94(0x201)](auth_1[a19_0x512a94(0x22f)],auth_1[a19_0x512a94(0x241)]),router[a19_0x512a94(0x1e5)](a19_0x512a94(0x24f),adminController[a19_0x512a94(0x20b)]),router[a19_0x512a94(0x1e5)]('/statistics',adminController['getStatistics']),router['get'](a19_0x512a94(0x22a),adminController[a19_0x512a94(0x1db)]),router[a19_0x512a94(0x1e5)](a19_0x512a94(0x1eb),adminController[a19_0x512a94(0x239)]),router['get']('/payout/stats',adminController[a19_0x512a94(0x24c)]),router[a19_0x512a94(0x1e5)]('/payout/merchants',adminController[a19_0x512a94(0x222)]),router['post']('/payout',(0x0,validation_1[a19_0x512a94(0x1ec)])(validation_1[a19_0x512a94(0x214)]),adminController[a19_0x512a94(0x1e0)]),router[a19_0x512a94(0x1e5)](a19_0x512a94(0x230),adminController['getPayouts']),router[a19_0x512a94(0x1e5)](a19_0x512a94(0x217),adminController['getPayoutById']),router[a19_0x512a94(0x203)](a19_0x512a94(0x217),adminController[a19_0x512a94(0x204)]),router[a19_0x512a94(0x1e5)]('/payments',adminController[a19_0x512a94(0x1e3)]),router[a19_0x512a94(0x1e5)](a19_0x512a94(0x221),adminController[a19_0x512a94(0x22c)]),router[a19_0x512a94(0x25b)](a19_0x512a94(0x221),adminController[a19_0x512a94(0x20a)]),router['put'](a19_0x512a94(0x23b),(0x0,validation_1[a19_0x512a94(0x1ec)])(validation_1['updateCustomerDataSchema']),adminController['updateCustomerData']),router[a19_0x512a94(0x1e5)]('/users',adminController[a19_0x512a94(0x224)]),router[a19_0x512a94(0x1e5)](a19_0x512a94(0x21d),adminController[a19_0x512a94(0x1f3)]),router[a19_0x512a94(0x1f1)](a19_0x512a94(0x232),(0x0,validation_1['validate'])(validation_1[a19_0x512a94(0x24b)]),adminController[a19_0x512a94(0x254)]),router[a19_0x512a94(0x25b)](a19_0x512a94(0x21d),(0x0,validation_1[a19_0x512a94(0x1ec)])(validation_1[a19_0x512a94(0x1f9)]),adminController['updateUser']),router[a19_0x512a94(0x203)]('/users/:id',adminController[a19_0x512a94(0x24a)]),router[a19_0x512a94(0x1f1)](a19_0x512a94(0x21b),adminController[a19_0x512a94(0x211)]),router['post'](a19_0x512a94(0x231),adminController['activateUser']),router[a19_0x512a94(0x1e5)]('/logs/stats',(_0x4011d5,_0x3fb9af)=>{const _0x4ea5b7=a19_0x512a94;try{const _0x210663=loggerService_1[_0x4ea5b7(0x205)]['getLogStats']();_0x3fb9af[_0x4ea5b7(0x259)]({'success':!![],'result':_0x210663});}catch(_0x546835){_0x3fb9af[_0x4ea5b7(0x249)](0x1f4)[_0x4ea5b7(0x259)]({'success':![],'message':_0x4ea5b7(0x208)});}}),router[a19_0x512a94(0x1f1)](a19_0x512a94(0x247),(_0x452edc,_0x15537e)=>{const _0x1185ba=a19_0x512a94;try{const {daysToKeep:daysToKeep=0x1e}=_0x452edc['body'];loggerService_1[_0x1185ba(0x205)][_0x1185ba(0x1f5)](daysToKeep),_0x15537e['json']({'success':!![],'message':'Old\x20logs\x20cleaned\x20(kept\x20last\x20'+daysToKeep+_0x1185ba(0x1e7)});}catch(_0x1bb4e4){_0x15537e['status'](0x1f4)[_0x1185ba(0x259)]({'success':![],'message':_0x1185ba(0x1de)});}}),router['post'](a19_0x512a94(0x1ef),async(_0x15dd8c,_0xab60e6)=>{const _0x2f1b7f=a19_0x512a94;try{const {paymentId:_0x306406}=_0x15dd8c[_0x2f1b7f(0x25f)];console[_0x2f1b7f(0x22d)](_0x2f1b7f(0x22b)+_0x306406),await coinToPayStatusService_1[_0x2f1b7f(0x20c)][_0x2f1b7f(0x1f7)](_0x306406),_0xab60e6['json']({'success':!![],'message':_0x2f1b7f(0x262)});}catch(_0x258ec8){console[_0x2f1b7f(0x212)](_0x2f1b7f(0x21c)+_0x15dd8c[_0x2f1b7f(0x25f)]['paymentId']+':',_0x258ec8),_0xab60e6[_0x2f1b7f(0x249)](0x1f4)[_0x2f1b7f(0x259)]({'success':![],'message':_0x258ec8 instanceof Error?_0x258ec8[_0x2f1b7f(0x1fb)]:_0x2f1b7f(0x21a)});}}),router['get']('/cointopay/stats',(_0x4ea73d,_0x99c19a)=>{const _0x42d68a=a19_0x512a94;try{const _0x3fad65=coinToPayStatusService_1[_0x42d68a(0x20c)]['getServiceStats']();_0x99c19a[_0x42d68a(0x259)]({'success':!![],'result':{..._0x3fad65,'description':'CoinToPay\x20automatic\x20status\x20checking\x20service','statusMapping':{'Paid':_0x42d68a(0x257),'Awaiting\x20Fiat':_0x42d68a(0x25a),'waiting':'PENDING','expired':_0x42d68a(0x1e4),'failed':_0x42d68a(0x202)},'autoExpiryNote':_0x42d68a(0x20e)+_0x3fad65[_0x42d68a(0x1dd)]+_0x42d68a(0x25d),'individualTimersNote':_0x42d68a(0x252)}});}catch(_0x1147f1){_0x99c19a[_0x42d68a(0x249)](0x1f4)[_0x42d68a(0x259)]({'success':![],'message':_0x42d68a(0x226)});}}),router[a19_0x512a94(0x1e5)]('/cointopay/payment/:paymentId',async(_0x38daf8,_0x5a9308)=>{const _0x3a541c=a19_0x512a94;try{const {paymentId:_0x4a92b2}=_0x38daf8['params'],_0x42a470=coinToPayStatusService_1[_0x3a541c(0x20c)][_0x3a541c(0x200)](_0x4a92b2),_0x34842c=(await Promise['resolve']()[_0x3a541c(0x20f)](()=>__importStar(require('../config/database'))))[_0x3a541c(0x234)],_0x5e91e4=await _0x34842c[_0x3a541c(0x1e8)][_0x3a541c(0x21e)]({'where':{'id':_0x4a92b2},'select':{'id':!![],'gateway':!![],'gatewayPaymentId':!![],'status':!![],'amount':!![],'currency':!![],'createdAt':!![],'updatedAt':!![],'shopId':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5e91e4)return _0x5a9308[_0x3a541c(0x249)](0x194)[_0x3a541c(0x259)]({'success':![],'message':'Payment\x20not\x20found'});_0x5a9308[_0x3a541c(0x259)]({'success':!![],'result':{'payment':{'id':_0x5e91e4['id'],'gateway':_0x5e91e4[_0x3a541c(0x261)],'gatewayPaymentId':_0x5e91e4[_0x3a541c(0x25e)],'status':_0x5e91e4[_0x3a541c(0x249)],'amount':_0x5e91e4[_0x3a541c(0x223)],'currency':_0x5e91e4[_0x3a541c(0x1ed)],'createdAt':_0x5e91e4[_0x3a541c(0x24e)],'updatedAt':_0x5e91e4['updatedAt'],'shop':_0x5e91e4['shop']},'timers':_0x42a470,'isCoinToPay':_0x5e91e4[_0x3a541c(0x261)]===_0x3a541c(0x23a),'ageInMinutes':Math[_0x3a541c(0x229)]((Date[_0x3a541c(0x1f6)]()-_0x5e91e4['createdAt']['getTime']())/(0x3e8*0x3c))}});}catch(_0x4c8037){_0x5a9308[_0x3a541c(0x249)](0x1f4)[_0x3a541c(0x259)]({'success':![],'message':_0x4c8037 instanceof Error?_0x4c8037[_0x3a541c(0x1fb)]:'Failed\x20to\x20get\x20payment\x20information'});}}),router[a19_0x512a94(0x1f1)]('/rapyd/check/:paymentId',async(_0x389c58,_0x38e23a)=>{const _0x2a3106=a19_0x512a94;try{const {paymentId:_0x24f4b1}=_0x389c58[_0x2a3106(0x25f)];console['log'](_0x2a3106(0x233)+_0x24f4b1),await rapydStatusService_1['rapydStatusService'][_0x2a3106(0x1f7)](_0x24f4b1),_0x38e23a[_0x2a3106(0x259)]({'success':!![],'message':_0x2a3106(0x1fe)});}catch(_0x2dc43e){console['error']('❌\x20[ADMIN]\x20Manual\x20Rapyd\x20check\x20failed\x20for\x20payment\x20'+_0x389c58['params'][_0x2a3106(0x238)]+':',_0x2dc43e),_0x38e23a[_0x2a3106(0x249)](0x1f4)[_0x2a3106(0x259)]({'success':![],'message':_0x2dc43e instanceof Error?_0x2dc43e[_0x2a3106(0x1fb)]:'Failed\x20to\x20check\x20Rapyd\x20payment\x20status'});}}),router[a19_0x512a94(0x1e5)](a19_0x512a94(0x251),(_0x10b16f,_0x32b317)=>{const _0x2d299c=a19_0x512a94;try{const _0x54f37b=rapydStatusService_1['rapydStatusService']['getServiceStats']();_0x32b317[_0x2d299c(0x259)]({'success':!![],'result':{..._0x54f37b,'description':'Rapyd\x20automatic\x20status\x20checking\x20service','statusMapping':{'paid:\x20true':_0x2d299c(0x257),'paid:\x20false\x20+\x20CAN':'FAILED','paid:\x20false\x20+\x20ERR':_0x2d299c(0x202),'paid:\x20false\x20+\x20EXP':_0x2d299c(0x1e4),'paid:\x20false\x20+\x20other':_0x2d299c(0x25a)},'checkSchedule':_0x2d299c(0x1e1),'note':_0x2d299c(0x1fc)}});}catch(_0x2e6f0a){_0x32b317[_0x2d299c(0x249)](0x1f4)[_0x2d299c(0x259)]({'success':![],'message':_0x2d299c(0x237)});}}),router[a19_0x512a94(0x1e5)](a19_0x512a94(0x235),async(_0x13ff53,_0x455000)=>{const _0x5037a3=a19_0x512a94;try{const {paymentId:_0x5d7b5f}=_0x13ff53[_0x5037a3(0x25f)],_0x31bcc7=await database_1[_0x5037a3(0x234)][_0x5037a3(0x1e8)][_0x5037a3(0x21e)]({'where':{'id':_0x5d7b5f},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x31bcc7)return _0x455000[_0x5037a3(0x249)](0x194)[_0x5037a3(0x259)]({'success':![],'message':_0x5037a3(0x1ff)});const _0x308cdb=rapydStatusService_1[_0x5037a3(0x23e)][_0x5037a3(0x200)](_0x5d7b5f);_0x455000['json']({'success':!![],'result':{'payment':{'id':_0x31bcc7['id'],'gateway':_0x31bcc7[_0x5037a3(0x261)],'gatewayPaymentId':_0x31bcc7[_0x5037a3(0x25e)],'status':_0x31bcc7[_0x5037a3(0x249)],'amount':_0x31bcc7[_0x5037a3(0x223)],'currency':_0x31bcc7[_0x5037a3(0x1ed)],'createdAt':_0x31bcc7[_0x5037a3(0x24e)],'updatedAt':_0x31bcc7[_0x5037a3(0x260)],'shop':_0x31bcc7[_0x5037a3(0x218)]},'timers':_0x308cdb,'isRapyd':_0x31bcc7[_0x5037a3(0x261)]===_0x5037a3(0x213),'ageInMinutes':Math[_0x5037a3(0x229)]((Date[_0x5037a3(0x1f6)]()-_0x31bcc7['createdAt'][_0x5037a3(0x1f8)]())/(0x3e8*0x3c)),'nextCheck':_0x308cdb[_0x5037a3(0x1ea)]?Math[_0x5037a3(0x229)]((Date[_0x5037a3(0x1f6)]()-_0x31bcc7[_0x5037a3(0x24e)][_0x5037a3(0x1f8)]())/(0x3e8*0x3c))<0x1e?0x1e-Math[_0x5037a3(0x229)]((Date[_0x5037a3(0x1f6)]()-_0x31bcc7[_0x5037a3(0x24e)][_0x5037a3(0x1f8)]())/(0x3e8*0x3c))+'\x20minutes':Math['floor']((Date[_0x5037a3(0x1f6)]()-_0x31bcc7[_0x5037a3(0x24e)]['getTime']())/(0x3e8*0x3c))<0x3c?0x3c-Math[_0x5037a3(0x229)]((Date['now']()-_0x31bcc7[_0x5037a3(0x24e)][_0x5037a3(0x1f8)]())/(0x3e8*0x3c))+_0x5037a3(0x244):_0x5037a3(0x243):'No\x20checks\x20scheduled'}});}catch(_0x44bf03){_0x455000[_0x5037a3(0x249)](0x1f4)[_0x5037a3(0x259)]({'success':![],'message':_0x44bf03 instanceof Error?_0x44bf03[_0x5037a3(0x1fb)]:_0x5037a3(0x1df)});}}),router[a19_0x512a94(0x1e5)](a19_0x512a94(0x250),(_0x167e89,_0x3a6f8b)=>{const _0x4fe3d2=a19_0x512a94;try{const _0x5b62c3=domainMonitoringService_1['domainMonitoringService'][_0x4fe3d2(0x22e)]();_0x3a6f8b['json']({'success':!![],'result':{..._0x5b62c3,'description':_0x4fe3d2(0x210),'behavior':_0x4fe3d2(0x23f),'encoding':_0x4fe3d2(0x245)}});}catch(_0x22d8ab){_0x3a6f8b['status'](0x1f4)[_0x4fe3d2(0x259)]({'success':![],'message':'Failed\x20to\x20get\x20domain\x20monitoring\x20statistics'});}}),router[a19_0x512a94(0x1f1)](a19_0x512a94(0x246),async(_0x520661,_0x3e0b39)=>{const _0x402b0a=a19_0x512a94;try{const _0x5e77ba=await domainMonitoringService_1[_0x402b0a(0x253)][_0x402b0a(0x225)]();_0x3e0b39[_0x402b0a(0x259)]({'success':!![],'result':{'domainAvailable':_0x5e77ba,'message':_0x5e77ba?_0x402b0a(0x1ee):_0x402b0a(0x23d),'timestamp':new Date()[_0x402b0a(0x25c)]()}});}catch(_0x4f2a5c){_0x3e0b39['status'](0x1f4)[_0x402b0a(0x259)]({'success':![],'message':_0x4f2a5c instanceof Error?_0x4f2a5c[_0x402b0a(0x1fb)]:_0x402b0a(0x206)});}}),exports[a19_0x512a94(0x234)]=router;