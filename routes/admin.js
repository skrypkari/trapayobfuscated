'use strict';const a25_0x4fe06b=a25_0x2d78;(function(_0x41ece1,_0x4a2599){const _0x49e5a7=a25_0x2d78,_0x46212d=_0x41ece1();while(!![]){try{const _0x4378b6=-parseInt(_0x49e5a7(0x162))/0x1+-parseInt(_0x49e5a7(0x163))/0x2*(parseInt(_0x49e5a7(0x16f))/0x3)+-parseInt(_0x49e5a7(0x193))/0x4*(parseInt(_0x49e5a7(0x192))/0x5)+parseInt(_0x49e5a7(0x188))/0x6*(-parseInt(_0x49e5a7(0x15b))/0x7)+parseInt(_0x49e5a7(0x16c))/0x8*(-parseInt(_0x49e5a7(0x126))/0x9)+-parseInt(_0x49e5a7(0x14b))/0xa+parseInt(_0x49e5a7(0x180))/0xb;if(_0x4378b6===_0x4a2599)break;else _0x46212d['push'](_0x46212d['shift']());}catch(_0x109dc6){_0x46212d['push'](_0x46212d['shift']());}}}(a25_0x5d4d,0x454d6));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x34dae5,_0x4dfd38,_0x3cd1c6,_0x1bb321){const _0x42a2cf=a25_0x2d78;if(_0x1bb321===undefined)_0x1bb321=_0x3cd1c6;var _0x2d1569=Object[_0x42a2cf(0x197)](_0x4dfd38,_0x3cd1c6);(!_0x2d1569||(_0x42a2cf(0x187)in _0x2d1569?!_0x4dfd38[_0x42a2cf(0x14e)]:_0x2d1569[_0x42a2cf(0x176)]||_0x2d1569['configurable']))&&(_0x2d1569={'enumerable':!![],'get':function(){return _0x4dfd38[_0x3cd1c6];}}),Object[_0x42a2cf(0x157)](_0x34dae5,_0x1bb321,_0x2d1569);}:function(_0x44149a,_0x2e9ae7,_0x38c180,_0xf461c5){if(_0xf461c5===undefined)_0xf461c5=_0x38c180;_0x44149a[_0xf461c5]=_0x2e9ae7[_0x38c180];}),__setModuleDefault=this&&this[a25_0x4fe06b(0x146)]||(Object[a25_0x4fe06b(0x17f)]?function(_0x1758a3,_0x5aa26f){const _0x4c3549=a25_0x4fe06b;Object[_0x4c3549(0x157)](_0x1758a3,'default',{'enumerable':!![],'value':_0x5aa26f});}:function(_0x161410,_0xda3221){_0x161410['default']=_0xda3221;}),__importStar=this&&this[a25_0x4fe06b(0x154)]||(function(){var _0x25fb42=function(_0x245afa){const _0x322001=a25_0x2d78;return _0x25fb42=Object[_0x322001(0x17c)]||function(_0x146066){const _0x5e7a34=_0x322001;var _0x2b72a8=[];for(var _0x1f3e6f in _0x146066)if(Object[_0x5e7a34(0x131)]['hasOwnProperty']['call'](_0x146066,_0x1f3e6f))_0x2b72a8[_0x2b72a8['length']]=_0x1f3e6f;return _0x2b72a8;},_0x25fb42(_0x245afa);};return function(_0x130680){const _0xc1efe2=a25_0x2d78;if(_0x130680&&_0x130680[_0xc1efe2(0x14e)])return _0x130680;var _0x2fc955={};if(_0x130680!=null){for(var _0x111dac=_0x25fb42(_0x130680),_0x22b5a3=0x0;_0x22b5a3<_0x111dac[_0xc1efe2(0x15f)];_0x22b5a3++)if(_0x111dac[_0x22b5a3]!=='default')__createBinding(_0x2fc955,_0x130680,_0x111dac[_0x22b5a3]);}return __setModuleDefault(_0x2fc955,_0x130680),_0x2fc955;};}());Object[a25_0x4fe06b(0x157)](exports,a25_0x4fe06b(0x14e),{'value':!![]});const express_1=require(a25_0x4fe06b(0x196)),adminController_1=require(a25_0x4fe06b(0x128)),validation_1=require(a25_0x4fe06b(0x164)),auth_1=require('../middleware/auth'),loggerService_1=require('../services/loggerService'),coinToPayStatusService_1=require(a25_0x4fe06b(0x186)),domainMonitoringService_1=require('../services/domainMonitoringService'),router=(0x0,express_1[a25_0x4fe06b(0x130)])(),adminController=new adminController_1[(a25_0x4fe06b(0x178))]();function a25_0x2d78(_0x2a8ef9,_0x45c353){_0x2a8ef9=_0x2a8ef9-0x125;const _0x5d4dca=a25_0x5d4d();let _0x2d7826=_0x5d4dca[_0x2a8ef9];return _0x2d7826;}function a25_0x5d4d(){const _0x553dee=['createdAt','__setModuleDefault','updateUserSchema','Each\x20new\x20payment\x20gets\x20individual\x20timers:\x201min,\x202min,\x207min,\x2012min,\x20then\x20hourly','/cointopay/check/:paymentId','Old\x20logs\x20cleaned\x20(kept\x20last\x20','1691630wBYDzR','/merchant-statistics','getLogStats','__esModule','log','status','coinToPayStatusService','getStatistics','body','__importStar','/payouts','params','defineProperty','paymentId','getUsers','gateway','3868004YJAxcF','/payments/processing-stats','/auth','createUserSchema','length','/payments/cleanup','../config/database','272781vWJVQS','142kUINSi','../middleware/validation','getMerchantStatistics','suspendUser','/cointopay/payment/:paymentId','/payments','delete','EXPIRED','json','178312mIzMVM','PENDING','domainMonitoringService','9906gKBmUT','now','createUser','getPayoutById','Domain\x20is\x20responding\x20correctly','/payments/:id/customer','getTime','writable','/users/:id','AdminController','/payments/cleanup-pending','Failed\x20to\x20get\x20log\x20statistics','shop','getOwnPropertyNames','CoinToPay\x20automatic\x20status\x20checking\x20service','deleteUser','create','17991919pZIfzn','/logs/stats','/payout/stats','updatePayment','resolve','then','../services/coinToPayStatusService','get','6vxBLpj','/users','currency','Failed\x20to\x20clean\x20old\x20logs','Server\x20crashes\x20if\x20domain\x20is\x20not\x20responding\x20after\x20consecutive\x20failures','Failed\x20to\x20perform\x20manual\x20domain\x20check','floor','post','gatewayPaymentId','expirePaymentLinks','830hBfoKE','1348VCyirM','cleanupStalePayments','createPayout','express','getOwnPropertyDescriptor','put','validate','/payout/merchants','loggerService','message','deletePayout','error','27oeRDHO','/statistics','../controllers/adminController','default','/payments/cleanup-with-report','/logs/clean','Failed\x20to\x20get\x20CoinToPay\x20service\x20statistics','getPayoutStats','/payouts/:id','amount','Router','prototype','getServiceStats','updatedAt','cointopay','getPayments','createPayoutSchema','CoinToPay\x20payment\x20status\x20checked\x20successfully','/users/:id/activate','updateCustomerData','/payment-links/expire','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status','getMonitoringStats','findUnique','\x20days)','getUserById','Payment\x20not\x20found','/payout','activateUser','PAID','/merchants/selection'];a25_0x5d4d=function(){return _0x553dee;};return a25_0x5d4d();}router['use'](auth_1['authenticateToken'],auth_1['requireAdmin']),router[a25_0x4fe06b(0x187)](a25_0x4fe06b(0x15d),adminController['checkAuth']),router[a25_0x4fe06b(0x187)](a25_0x4fe06b(0x127),adminController[a25_0x4fe06b(0x152)]),router[a25_0x4fe06b(0x187)](a25_0x4fe06b(0x14c),adminController[a25_0x4fe06b(0x165)]),router['get'](a25_0x4fe06b(0x182),adminController[a25_0x4fe06b(0x12d)]),router['get'](a25_0x4fe06b(0x19a),adminController['getMerchantsAwaitingPayout']),router[a25_0x4fe06b(0x187)](a25_0x4fe06b(0x144),adminController['getMerchantsSelection']),router[a25_0x4fe06b(0x18f)](a25_0x4fe06b(0x141),(0x0,validation_1[a25_0x4fe06b(0x199)])(validation_1[a25_0x4fe06b(0x136)]),adminController[a25_0x4fe06b(0x195)]),router[a25_0x4fe06b(0x187)](a25_0x4fe06b(0x155),adminController['getPayouts']),router['get'](a25_0x4fe06b(0x12e),adminController[a25_0x4fe06b(0x172)]),router[a25_0x4fe06b(0x169)]('/payouts/:id',adminController[a25_0x4fe06b(0x19d)]),router[a25_0x4fe06b(0x187)](a25_0x4fe06b(0x168),adminController[a25_0x4fe06b(0x135)]),router['get']('/payments/:id',adminController['getPaymentById']),router[a25_0x4fe06b(0x198)]('/payments/:id',adminController[a25_0x4fe06b(0x183)]),router['put'](a25_0x4fe06b(0x174),(0x0,validation_1[a25_0x4fe06b(0x199)])(validation_1['updateCustomerDataSchema']),adminController[a25_0x4fe06b(0x139)]),router[a25_0x4fe06b(0x187)](a25_0x4fe06b(0x15c),adminController['getProcessingPaymentsStats']),router['post'](a25_0x4fe06b(0x160),adminController[a25_0x4fe06b(0x194)]),router['post'](a25_0x4fe06b(0x179),adminController['cleanupStalePendingPayments']),router[a25_0x4fe06b(0x18f)](a25_0x4fe06b(0x12a),adminController['cleanupStalePaymentsWithReport']),router['post'](a25_0x4fe06b(0x13a),adminController[a25_0x4fe06b(0x191)]),router[a25_0x4fe06b(0x187)](a25_0x4fe06b(0x189),adminController[a25_0x4fe06b(0x159)]),router[a25_0x4fe06b(0x187)](a25_0x4fe06b(0x177),adminController[a25_0x4fe06b(0x13f)]),router['post'](a25_0x4fe06b(0x189),(0x0,validation_1['validate'])(validation_1[a25_0x4fe06b(0x15e)]),adminController[a25_0x4fe06b(0x171)]),router[a25_0x4fe06b(0x198)](a25_0x4fe06b(0x177),(0x0,validation_1[a25_0x4fe06b(0x199)])(validation_1[a25_0x4fe06b(0x147)]),adminController['updateUser']),router[a25_0x4fe06b(0x169)](a25_0x4fe06b(0x177),adminController[a25_0x4fe06b(0x17e)]),router[a25_0x4fe06b(0x18f)]('/users/:id/suspend',adminController[a25_0x4fe06b(0x166)]),router[a25_0x4fe06b(0x18f)](a25_0x4fe06b(0x138),adminController[a25_0x4fe06b(0x142)]),router['get'](a25_0x4fe06b(0x181),(_0x1c2b4e,_0xe9884f)=>{const _0x483ae8=a25_0x4fe06b;try{const _0x305e92=loggerService_1[_0x483ae8(0x19b)][_0x483ae8(0x14d)]();_0xe9884f[_0x483ae8(0x16b)]({'success':!![],'result':_0x305e92});}catch(_0x1b65c6){_0xe9884f[_0x483ae8(0x150)](0x1f4)[_0x483ae8(0x16b)]({'success':![],'message':_0x483ae8(0x17a)});}}),router['post'](a25_0x4fe06b(0x12b),(_0x21cc42,_0x17cc2a)=>{const _0x52ae46=a25_0x4fe06b;try{const {daysToKeep:daysToKeep=0x1e}=_0x21cc42[_0x52ae46(0x153)];loggerService_1[_0x52ae46(0x19b)]['cleanOldLogs'](daysToKeep),_0x17cc2a[_0x52ae46(0x16b)]({'success':!![],'message':_0x52ae46(0x14a)+daysToKeep+_0x52ae46(0x13e)});}catch(_0x782683){_0x17cc2a[_0x52ae46(0x150)](0x1f4)[_0x52ae46(0x16b)]({'success':![],'message':_0x52ae46(0x18b)});}}),router[a25_0x4fe06b(0x18f)](a25_0x4fe06b(0x149),async(_0x514747,_0x228a4a)=>{const _0x5e8c46=a25_0x4fe06b;try{const {paymentId:_0x2e980f}=_0x514747[_0x5e8c46(0x156)];console[_0x5e8c46(0x14f)]('ðŸ”\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20requested\x20for\x20payment:\x20'+_0x2e980f),await coinToPayStatusService_1[_0x5e8c46(0x151)]['checkPaymentById'](_0x2e980f),_0x228a4a['json']({'success':!![],'message':_0x5e8c46(0x137)});}catch(_0x22c0c0){console[_0x5e8c46(0x125)]('âŒ\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20failed\x20for\x20payment\x20'+_0x514747[_0x5e8c46(0x156)][_0x5e8c46(0x158)]+':',_0x22c0c0),_0x228a4a[_0x5e8c46(0x150)](0x1f4)['json']({'success':![],'message':_0x22c0c0 instanceof Error?_0x22c0c0[_0x5e8c46(0x19c)]:_0x5e8c46(0x13b)});}}),router[a25_0x4fe06b(0x187)]('/cointopay/stats',(_0x165acf,_0x4c1da5)=>{const _0x1d83fe=a25_0x4fe06b;try{const _0x1b6dea=coinToPayStatusService_1[_0x1d83fe(0x151)][_0x1d83fe(0x132)]();_0x4c1da5['json']({'success':!![],'result':{..._0x1b6dea,'description':_0x1d83fe(0x17d),'statusMapping':{'Paid':_0x1d83fe(0x143),'Awaiting\x20Fiat':_0x1d83fe(0x16d),'waiting':'PENDING','expired':_0x1d83fe(0x16a),'failed':'FAILED'},'autoExpiryNote':'Payments\x20automatically\x20expire\x20after\x20'+_0x1b6dea['expiryDays']+'\x20days\x20if\x20not\x20paid','individualTimersNote':_0x1d83fe(0x148)}});}catch(_0x17c0e6){_0x4c1da5['status'](0x1f4)[_0x1d83fe(0x16b)]({'success':![],'message':_0x1d83fe(0x12c)});}}),router[a25_0x4fe06b(0x187)](a25_0x4fe06b(0x167),async(_0x1d7f65,_0x17c211)=>{const _0x1ffdea=a25_0x4fe06b;try{const {paymentId:_0x460430}=_0x1d7f65[_0x1ffdea(0x156)],_0x178080=coinToPayStatusService_1[_0x1ffdea(0x151)]['getPaymentTimerInfo'](_0x460430),_0xe86398=(await Promise[_0x1ffdea(0x184)]()[_0x1ffdea(0x185)](()=>__importStar(require(_0x1ffdea(0x161)))))[_0x1ffdea(0x129)],_0x264be3=await _0xe86398['payment'][_0x1ffdea(0x13d)]({'where':{'id':_0x460430},'select':{'id':!![],'gateway':!![],'gatewayPaymentId':!![],'status':!![],'amount':!![],'currency':!![],'createdAt':!![],'updatedAt':!![],'shopId':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x264be3)return _0x17c211[_0x1ffdea(0x150)](0x194)['json']({'success':![],'message':_0x1ffdea(0x140)});_0x17c211[_0x1ffdea(0x16b)]({'success':!![],'result':{'payment':{'id':_0x264be3['id'],'gateway':_0x264be3[_0x1ffdea(0x15a)],'gatewayPaymentId':_0x264be3[_0x1ffdea(0x190)],'status':_0x264be3[_0x1ffdea(0x150)],'amount':_0x264be3[_0x1ffdea(0x12f)],'currency':_0x264be3[_0x1ffdea(0x18a)],'createdAt':_0x264be3[_0x1ffdea(0x145)],'updatedAt':_0x264be3[_0x1ffdea(0x133)],'shop':_0x264be3[_0x1ffdea(0x17b)]},'timers':_0x178080,'isCoinToPay':_0x264be3[_0x1ffdea(0x15a)]===_0x1ffdea(0x134),'ageInMinutes':Math[_0x1ffdea(0x18e)]((Date[_0x1ffdea(0x170)]()-_0x264be3[_0x1ffdea(0x145)][_0x1ffdea(0x175)]())/(0x3e8*0x3c))}});}catch(_0x2b3473){_0x17c211[_0x1ffdea(0x150)](0x1f4)[_0x1ffdea(0x16b)]({'success':![],'message':_0x2b3473 instanceof Error?_0x2b3473['message']:'Failed\x20to\x20get\x20payment\x20information'});}}),router[a25_0x4fe06b(0x187)]('/domain-monitoring/stats',(_0x1bacfa,_0x32121f)=>{const _0x12a5ac=a25_0x4fe06b;try{const _0x1b53f3=domainMonitoringService_1[_0x12a5ac(0x16e)][_0x12a5ac(0x13c)]();_0x32121f['json']({'success':!![],'result':{..._0x1b53f3,'description':'Domain\x20monitoring\x20service\x20for\x20amaterasy884.icu','behavior':_0x12a5ac(0x18c),'encoding':'Requests\x20are\x20made\x20with\x20base64\x20encoded\x20URLs'}});}catch(_0x2f70b5){_0x32121f['status'](0x1f4)['json']({'success':![],'message':'Failed\x20to\x20get\x20domain\x20monitoring\x20statistics'});}}),router['post']('/domain-monitoring/check',async(_0x45ee9b,_0x45dd91)=>{const _0x4f0b4d=a25_0x4fe06b;try{const _0xcd7d1e=await domainMonitoringService_1[_0x4f0b4d(0x16e)]['manualCheck']();_0x45dd91[_0x4f0b4d(0x16b)]({'success':!![],'result':{'domainAvailable':_0xcd7d1e,'message':_0xcd7d1e?_0x4f0b4d(0x173):'Domain\x20check\x20failed','timestamp':new Date()['toISOString']()}});}catch(_0x1adc8d){_0x45dd91[_0x4f0b4d(0x150)](0x1f4)[_0x4f0b4d(0x16b)]({'success':![],'message':_0x1adc8d instanceof Error?_0x1adc8d['message']:_0x4f0b4d(0x18d)});}}),exports[a25_0x4fe06b(0x129)]=router;