'use strict';const a19_0x86422a=a19_0x3451;function a19_0x3ea6(){const _0x4d9f02=['length','getUserById','FAILED','/rapyd/payment/:paymentId','params','/merchants/selection','checkAuth','updatedAt','getPaymentTimerInfo','payment','Rapyd\x20automatic\x20status\x20checking\x20service','defineProperty','json','Domain\x20monitoring\x20service\x20for\x20amaterasy884.icu','getPayoutStats','Server\x20crashes\x20if\x20domain\x20is\x20not\x20responding\x20after\x20consecutive\x20failures','authenticateToken','/payments/:id/customer','Payments\x20are\x20checked\x20after\x2030\x20minutes\x20and\x2060\x20minutes,\x20then\x20forgotten','getUsers','/cointopay/payment/:paymentId','Domain\x20is\x20responding\x20correctly','adminPaymentsQuerySchema','getServiceStats','resolve','758zLAinp','updateUserSchema','log','validateQuery','/rapyd/stats','hasOwnProperty','now','loggerService','Payments\x20automatically\x20expire\x20after\x20','PENDING','Domain\x20check\x20failed','error','updateUser','/merchant-statistics','getMerchantsAwaitingPayout','getMerchantsSelection','activateUser','rapydStatusService','/payments/:id','../config/database','cleanOldLogs','CoinToPay\x20payment\x20status\x20checked\x20successfully','Failed\x20to\x20check\x20Rapyd\x20payment\x20status','validate','/users','üîç\x20[ADMIN]\x20Manual\x20Rapyd\x20check\x20requested\x20for\x20payment:\x20','/payout/stats','gateway','status','__createBinding','/domain-monitoring/stats','create','‚ùå\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20failed\x20for\x20payment\x20','../services/loggerService','../services/domainMonitoringService','../middleware/auth','get','No\x20checks\x20scheduled','/users/:id','CoinToPay\x20automatic\x20status\x20checking\x20service','/payout','EXPIRED','getPayoutById','‚ùå\x20[ADMIN]\x20Manual\x20Rapyd\x20check\x20failed\x20for\x20payment\x20','deletePayout','4290356hreaDl','prototype','writable','/domain-monitoring/check','createdAt','put','configurable','9997610BRipXt','hasTimers','getTime','__importStar','updatePayment','5410280RxlWSV','checkPaymentById','üîç\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20requested\x20for\x20payment:\x20','getStatistics','Requests\x20are\x20made\x20with\x20base64\x20encoded\x20URLs','toISOString','Failed\x20to\x20get\x20log\x20statistics','coinToPayStatusService','__setModuleDefault','findUnique','\x20minutes','createPayout','getMonitoringStats','getMerchantStatistics','manualCheck','/users/:id/activate','1399NbRPDu','amount','/payout/merchants','/statistics','/payouts/:id','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status','then','cointopay','/logs/clean','No\x20more\x20checks\x20scheduled','call','express','../controllers/adminController','20JgnZgh','/payments','floor','currency','567bEHxEO','__esModule','\x20days)','517008HIIOfq','../services/rapydStatusService','delete','updateCustomerData','Failed\x20to\x20get\x20payment\x20information','Payment\x20not\x20found','post','domainMonitoringService','2147445zQLZGw','/rapyd/check/:paymentId','Failed\x20to\x20get\x20Rapyd\x20service\x20statistics','message','createUserSchema','createPayoutSchema','default','use','getPayments','/cointopay/check/:paymentId','Failed\x20to\x20get\x20domain\x20monitoring\x20statistics','deleteUser','shop','rapyd','../services/coinToPayStatusService','getPaymentById','Failed\x20to\x20get\x20CoinToPay\x20service\x20statistics','gatewayPaymentId','11852gPttcu'];a19_0x3ea6=function(){return _0x4d9f02;};return a19_0x3ea6();}(function(_0x966a9f,_0x411c41){const _0x192c15=a19_0x3451,_0x2ab4fb=_0x966a9f();while(!![]){try{const _0x19c5dc=-parseInt(_0x192c15(0x134))/0x1*(-parseInt(_0x192c15(0xeb))/0x2)+parseInt(_0x192c15(0x145))/0x3*(-parseInt(_0x192c15(0xd1))/0x4)+-parseInt(_0x192c15(0x141))/0x5*(-parseInt(_0x192c15(0x148))/0x6)+parseInt(_0x192c15(0x118))/0x7+parseInt(_0x192c15(0x124))/0x8+-parseInt(_0x192c15(0x150))/0x9+-parseInt(_0x192c15(0x11f))/0xa;if(_0x19c5dc===_0x411c41)break;else _0x2ab4fb['push'](_0x2ab4fb['shift']());}catch(_0x4bfddf){_0x2ab4fb['push'](_0x2ab4fb['shift']());}}}(a19_0x3ea6,0x59491));var __createBinding=this&&this[a19_0x86422a(0x108)]||(Object[a19_0x86422a(0x10a)]?function(_0x1e1077,_0x15b15e,_0x5d3cf7,_0x3d7f9e){const _0x33f86c=a19_0x86422a;if(_0x3d7f9e===undefined)_0x3d7f9e=_0x5d3cf7;var _0x595a66=Object['getOwnPropertyDescriptor'](_0x15b15e,_0x5d3cf7);(!_0x595a66||(_0x33f86c(0x10f)in _0x595a66?!_0x15b15e[_0x33f86c(0x146)]:_0x595a66[_0x33f86c(0x11a)]||_0x595a66[_0x33f86c(0x11e)]))&&(_0x595a66={'enumerable':!![],'get':function(){return _0x15b15e[_0x5d3cf7];}}),Object[_0x33f86c(0xdd)](_0x1e1077,_0x3d7f9e,_0x595a66);}:function(_0xdee339,_0x19e7de,_0x25f084,_0x3c420a){if(_0x3c420a===undefined)_0x3c420a=_0x25f084;_0xdee339[_0x3c420a]=_0x19e7de[_0x25f084];}),__setModuleDefault=this&&this[a19_0x86422a(0x12c)]||(Object[a19_0x86422a(0x10a)]?function(_0x337e42,_0x24ce7c){const _0x5da31a=a19_0x86422a;Object[_0x5da31a(0xdd)](_0x337e42,_0x5da31a(0x156),{'enumerable':!![],'value':_0x24ce7c});}:function(_0x1f84a8,_0x519649){const _0x28907b=a19_0x86422a;_0x1f84a8[_0x28907b(0x156)]=_0x519649;}),__importStar=this&&this[a19_0x86422a(0x122)]||(function(){var _0x530a1b=function(_0x1d26f9){return _0x530a1b=Object['getOwnPropertyNames']||function(_0x38236a){const _0xf90188=a19_0x3451;var _0x34ac90=[];for(var _0x476022 in _0x38236a)if(Object[_0xf90188(0x119)][_0xf90188(0xf0)][_0xf90188(0x13e)](_0x38236a,_0x476022))_0x34ac90[_0x34ac90[_0xf90188(0xd2)]]=_0x476022;return _0x34ac90;},_0x530a1b(_0x1d26f9);};return function(_0x50693a){const _0x1bd54c=a19_0x3451;if(_0x50693a&&_0x50693a[_0x1bd54c(0x146)])return _0x50693a;var _0x4e79a3={};if(_0x50693a!=null){for(var _0x29a743=_0x530a1b(_0x50693a),_0x145d6c=0x0;_0x145d6c<_0x29a743['length'];_0x145d6c++)if(_0x29a743[_0x145d6c]!==_0x1bd54c(0x156))__createBinding(_0x4e79a3,_0x50693a,_0x29a743[_0x145d6c]);}return __setModuleDefault(_0x4e79a3,_0x50693a),_0x4e79a3;};}()),__importDefault=this&&this['__importDefault']||function(_0x4e98c3){return _0x4e98c3&&_0x4e98c3['__esModule']?_0x4e98c3:{'default':_0x4e98c3};};function a19_0x3451(_0x327ab3,_0x443453){const _0x3ea6a4=a19_0x3ea6();return a19_0x3451=function(_0x345197,_0x44869e){_0x345197=_0x345197-0xcd;let _0x356c3e=_0x3ea6a4[_0x345197];return _0x356c3e;},a19_0x3451(_0x327ab3,_0x443453);}Object[a19_0x86422a(0xdd)](exports,a19_0x86422a(0x146),{'value':!![]});const express_1=require(a19_0x86422a(0x13f)),adminController_1=require(a19_0x86422a(0x140)),validation_1=require('../middleware/validation'),auth_1=require(a19_0x86422a(0x10e)),loggerService_1=require(a19_0x86422a(0x10c)),coinToPayStatusService_1=require(a19_0x86422a(0xcd)),rapydStatusService_1=require(a19_0x86422a(0x149)),domainMonitoringService_1=require(a19_0x86422a(0x10d)),database_1=__importDefault(require(a19_0x86422a(0xfe))),router=(0x0,express_1['Router'])(),adminController=new adminController_1['AdminController']();router[a19_0x86422a(0x157)](auth_1[a19_0x86422a(0xe2)],auth_1['requireAdmin']),router[a19_0x86422a(0x10f)]('/auth',adminController[a19_0x86422a(0xd8)]),router['get'](a19_0x86422a(0x137),adminController[a19_0x86422a(0x127)]),router[a19_0x86422a(0x10f)](a19_0x86422a(0xf8),adminController[a19_0x86422a(0x131)]),router[a19_0x86422a(0x10f)](a19_0x86422a(0xd7),adminController[a19_0x86422a(0xfa)]),router['get'](a19_0x86422a(0x105),adminController[a19_0x86422a(0xe0)]),router['get'](a19_0x86422a(0x136),adminController[a19_0x86422a(0xf9)]),router[a19_0x86422a(0x14e)](a19_0x86422a(0x113),(0x0,validation_1[a19_0x86422a(0x102)])(validation_1[a19_0x86422a(0x155)]),adminController[a19_0x86422a(0x12f)]),router['get']('/payouts',adminController['getPayouts']),router[a19_0x86422a(0x10f)]('/payouts/:id',adminController[a19_0x86422a(0x115)]),router['delete'](a19_0x86422a(0x138),adminController[a19_0x86422a(0x117)]),router[a19_0x86422a(0x10f)](a19_0x86422a(0x142),(0x0,validation_1[a19_0x86422a(0xee)])(validation_1[a19_0x86422a(0xe8)]),adminController[a19_0x86422a(0x158)]),router[a19_0x86422a(0x10f)](a19_0x86422a(0xfd),adminController[a19_0x86422a(0xce)]),router[a19_0x86422a(0x11d)](a19_0x86422a(0xfd),adminController[a19_0x86422a(0x123)]),router[a19_0x86422a(0x11d)](a19_0x86422a(0xe3),(0x0,validation_1[a19_0x86422a(0x102)])(validation_1['updateCustomerDataSchema']),adminController[a19_0x86422a(0x14b)]),router[a19_0x86422a(0x10f)](a19_0x86422a(0x103),adminController[a19_0x86422a(0xe5)]),router[a19_0x86422a(0x10f)](a19_0x86422a(0x111),adminController[a19_0x86422a(0xd3)]),router[a19_0x86422a(0x14e)](a19_0x86422a(0x103),(0x0,validation_1[a19_0x86422a(0x102)])(validation_1[a19_0x86422a(0x154)]),adminController['createUser']),router['put'](a19_0x86422a(0x111),(0x0,validation_1['validate'])(validation_1[a19_0x86422a(0xec)]),adminController[a19_0x86422a(0xf7)]),router[a19_0x86422a(0x14a)]('/users/:id',adminController[a19_0x86422a(0x15b)]),router[a19_0x86422a(0x14e)]('/users/:id/suspend',adminController['suspendUser']),router['post'](a19_0x86422a(0x133),adminController[a19_0x86422a(0xfb)]),router[a19_0x86422a(0x10f)]('/logs/stats',(_0x569349,_0x5d3df7)=>{const _0x3cd594=a19_0x86422a;try{const _0x3382c0=loggerService_1[_0x3cd594(0xf2)]['getLogStats']();_0x5d3df7[_0x3cd594(0xde)]({'success':!![],'result':_0x3382c0});}catch(_0x433f0b){_0x5d3df7['status'](0x1f4)[_0x3cd594(0xde)]({'success':![],'message':_0x3cd594(0x12a)});}}),router[a19_0x86422a(0x14e)](a19_0x86422a(0x13c),(_0x1c75fb,_0xb1c567)=>{const _0x41c3ed=a19_0x86422a;try{const {daysToKeep:daysToKeep=0x1e}=_0x1c75fb['body'];loggerService_1['loggerService'][_0x41c3ed(0xff)](daysToKeep),_0xb1c567['json']({'success':!![],'message':'Old\x20logs\x20cleaned\x20(kept\x20last\x20'+daysToKeep+_0x41c3ed(0x147)});}catch(_0x985c70){_0xb1c567['status'](0x1f4)[_0x41c3ed(0xde)]({'success':![],'message':'Failed\x20to\x20clean\x20old\x20logs'});}}),router['post'](a19_0x86422a(0x159),async(_0x37bae9,_0x354824)=>{const _0x47acff=a19_0x86422a;try{const {paymentId:_0x4ebeac}=_0x37bae9[_0x47acff(0xd6)];console[_0x47acff(0xed)](_0x47acff(0x126)+_0x4ebeac),await coinToPayStatusService_1[_0x47acff(0x12b)]['checkPaymentById'](_0x4ebeac),_0x354824['json']({'success':!![],'message':_0x47acff(0x100)});}catch(_0x3963b5){console[_0x47acff(0xf6)](_0x47acff(0x10b)+_0x37bae9[_0x47acff(0xd6)]['paymentId']+':',_0x3963b5),_0x354824[_0x47acff(0x107)](0x1f4)['json']({'success':![],'message':_0x3963b5 instanceof Error?_0x3963b5[_0x47acff(0x153)]:_0x47acff(0x139)});}}),router[a19_0x86422a(0x10f)]('/cointopay/stats',(_0x4356b5,_0x1a9f5f)=>{const _0xd919a7=a19_0x86422a;try{const _0x6b95b8=coinToPayStatusService_1[_0xd919a7(0x12b)][_0xd919a7(0xe9)]();_0x1a9f5f[_0xd919a7(0xde)]({'success':!![],'result':{..._0x6b95b8,'description':_0xd919a7(0x112),'statusMapping':{'Paid':'PAID','Awaiting\x20Fiat':'PENDING','waiting':'PENDING','expired':_0xd919a7(0x114),'failed':_0xd919a7(0xd4)},'autoExpiryNote':_0xd919a7(0xf3)+_0x6b95b8['expiryDays']+'\x20days\x20if\x20not\x20paid','individualTimersNote':'Each\x20new\x20payment\x20gets\x20individual\x20timers:\x201min,\x202min,\x207min,\x2012min,\x20then\x20hourly'}});}catch(_0x15f645){_0x1a9f5f[_0xd919a7(0x107)](0x1f4)[_0xd919a7(0xde)]({'success':![],'message':_0xd919a7(0xcf)});}}),router[a19_0x86422a(0x10f)](a19_0x86422a(0xe6),async(_0x46dc60,_0x475c8e)=>{const _0xfac4b6=a19_0x86422a;try{const {paymentId:_0x5f4408}=_0x46dc60[_0xfac4b6(0xd6)],_0x450371=coinToPayStatusService_1[_0xfac4b6(0x12b)][_0xfac4b6(0xda)](_0x5f4408),_0x2351b7=(await Promise[_0xfac4b6(0xea)]()[_0xfac4b6(0x13a)](()=>__importStar(require(_0xfac4b6(0xfe)))))[_0xfac4b6(0x156)],_0x523d92=await _0x2351b7[_0xfac4b6(0xdb)]['findUnique']({'where':{'id':_0x5f4408},'select':{'id':!![],'gateway':!![],'gatewayPaymentId':!![],'status':!![],'amount':!![],'currency':!![],'createdAt':!![],'updatedAt':!![],'shopId':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x523d92)return _0x475c8e[_0xfac4b6(0x107)](0x194)['json']({'success':![],'message':_0xfac4b6(0x14d)});_0x475c8e['json']({'success':!![],'result':{'payment':{'id':_0x523d92['id'],'gateway':_0x523d92['gateway'],'gatewayPaymentId':_0x523d92[_0xfac4b6(0xd0)],'status':_0x523d92['status'],'amount':_0x523d92[_0xfac4b6(0x135)],'currency':_0x523d92[_0xfac4b6(0x144)],'createdAt':_0x523d92['createdAt'],'updatedAt':_0x523d92[_0xfac4b6(0xd9)],'shop':_0x523d92[_0xfac4b6(0x15c)]},'timers':_0x450371,'isCoinToPay':_0x523d92[_0xfac4b6(0x106)]===_0xfac4b6(0x13b),'ageInMinutes':Math[_0xfac4b6(0x143)]((Date[_0xfac4b6(0xf1)]()-_0x523d92[_0xfac4b6(0x11c)]['getTime']())/(0x3e8*0x3c))}});}catch(_0x15ec2c){_0x475c8e[_0xfac4b6(0x107)](0x1f4)['json']({'success':![],'message':_0x15ec2c instanceof Error?_0x15ec2c[_0xfac4b6(0x153)]:_0xfac4b6(0x14c)});}}),router['post'](a19_0x86422a(0x151),async(_0x59fd68,_0x2c40ed)=>{const _0x842b1f=a19_0x86422a;try{const {paymentId:_0x37c2b0}=_0x59fd68['params'];console[_0x842b1f(0xed)](_0x842b1f(0x104)+_0x37c2b0),await rapydStatusService_1[_0x842b1f(0xfc)][_0x842b1f(0x125)](_0x37c2b0),_0x2c40ed[_0x842b1f(0xde)]({'success':!![],'message':'Rapyd\x20payment\x20status\x20checked\x20successfully'});}catch(_0x485ab0){console[_0x842b1f(0xf6)](_0x842b1f(0x116)+_0x59fd68[_0x842b1f(0xd6)]['paymentId']+':',_0x485ab0),_0x2c40ed[_0x842b1f(0x107)](0x1f4)[_0x842b1f(0xde)]({'success':![],'message':_0x485ab0 instanceof Error?_0x485ab0[_0x842b1f(0x153)]:_0x842b1f(0x101)});}}),router[a19_0x86422a(0x10f)](a19_0x86422a(0xef),(_0x357a42,_0x4a7d44)=>{const _0x474868=a19_0x86422a;try{const _0x44b845=rapydStatusService_1[_0x474868(0xfc)][_0x474868(0xe9)]();_0x4a7d44[_0x474868(0xde)]({'success':!![],'result':{..._0x44b845,'description':_0x474868(0xdc),'statusMapping':{'paid:\x20true':'PAID','paid:\x20false\x20+\x20CAN':_0x474868(0xd4),'paid:\x20false\x20+\x20ERR':_0x474868(0xd4),'paid:\x20false\x20+\x20EXP':_0x474868(0x114),'paid:\x20false\x20+\x20other':_0x474868(0xf4)},'checkSchedule':_0x474868(0xe4),'note':'Only\x20checks\x20payments\x20with\x20status\x20PENDING\x20at\x20check\x20time'}});}catch(_0x32c77f){_0x4a7d44[_0x474868(0x107)](0x1f4)[_0x474868(0xde)]({'success':![],'message':_0x474868(0x152)});}}),router[a19_0x86422a(0x10f)](a19_0x86422a(0xd5),async(_0x1630dc,_0x2fcaf1)=>{const _0x255dce=a19_0x86422a;try{const {paymentId:_0x4f0fe2}=_0x1630dc['params'],_0x2d2bf0=await database_1['default'][_0x255dce(0xdb)][_0x255dce(0x12d)]({'where':{'id':_0x4f0fe2},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x2d2bf0)return _0x2fcaf1[_0x255dce(0x107)](0x194)['json']({'success':![],'message':_0x255dce(0x14d)});const _0x4b99c0=rapydStatusService_1[_0x255dce(0xfc)]['getPaymentTimerInfo'](_0x4f0fe2);_0x2fcaf1[_0x255dce(0xde)]({'success':!![],'result':{'payment':{'id':_0x2d2bf0['id'],'gateway':_0x2d2bf0[_0x255dce(0x106)],'gatewayPaymentId':_0x2d2bf0['gatewayPaymentId'],'status':_0x2d2bf0[_0x255dce(0x107)],'amount':_0x2d2bf0['amount'],'currency':_0x2d2bf0['currency'],'createdAt':_0x2d2bf0[_0x255dce(0x11c)],'updatedAt':_0x2d2bf0[_0x255dce(0xd9)],'shop':_0x2d2bf0['shop']},'timers':_0x4b99c0,'isRapyd':_0x2d2bf0['gateway']===_0x255dce(0x15d),'ageInMinutes':Math[_0x255dce(0x143)]((Date[_0x255dce(0xf1)]()-_0x2d2bf0[_0x255dce(0x11c)]['getTime']())/(0x3e8*0x3c)),'nextCheck':_0x4b99c0[_0x255dce(0x120)]?Math[_0x255dce(0x143)]((Date['now']()-_0x2d2bf0[_0x255dce(0x11c)][_0x255dce(0x121)]())/(0x3e8*0x3c))<0x1e?0x1e-Math[_0x255dce(0x143)]((Date[_0x255dce(0xf1)]()-_0x2d2bf0[_0x255dce(0x11c)][_0x255dce(0x121)]())/(0x3e8*0x3c))+'\x20minutes':Math['floor']((Date[_0x255dce(0xf1)]()-_0x2d2bf0[_0x255dce(0x11c)][_0x255dce(0x121)]())/(0x3e8*0x3c))<0x3c?0x3c-Math[_0x255dce(0x143)]((Date[_0x255dce(0xf1)]()-_0x2d2bf0[_0x255dce(0x11c)][_0x255dce(0x121)]())/(0x3e8*0x3c))+_0x255dce(0x12e):_0x255dce(0x13d):_0x255dce(0x110)}});}catch(_0x4e7995){_0x2fcaf1[_0x255dce(0x107)](0x1f4)[_0x255dce(0xde)]({'success':![],'message':_0x4e7995 instanceof Error?_0x4e7995['message']:_0x255dce(0x14c)});}}),router[a19_0x86422a(0x10f)](a19_0x86422a(0x109),(_0x1a798b,_0x32d1d1)=>{const _0x33903a=a19_0x86422a;try{const _0x670f00=domainMonitoringService_1[_0x33903a(0x14f)][_0x33903a(0x130)]();_0x32d1d1[_0x33903a(0xde)]({'success':!![],'result':{..._0x670f00,'description':_0x33903a(0xdf),'behavior':_0x33903a(0xe1),'encoding':_0x33903a(0x128)}});}catch(_0x35b082){_0x32d1d1[_0x33903a(0x107)](0x1f4)[_0x33903a(0xde)]({'success':![],'message':_0x33903a(0x15a)});}}),router['post'](a19_0x86422a(0x11b),async(_0x2cb17b,_0x578bbc)=>{const _0x3de753=a19_0x86422a;try{const _0xf1c0f6=await domainMonitoringService_1[_0x3de753(0x14f)][_0x3de753(0x132)]();_0x578bbc[_0x3de753(0xde)]({'success':!![],'result':{'domainAvailable':_0xf1c0f6,'message':_0xf1c0f6?_0x3de753(0xe7):_0x3de753(0xf5),'timestamp':new Date()[_0x3de753(0x129)]()}});}catch(_0x4d4d68){_0x578bbc[_0x3de753(0x107)](0x1f4)[_0x3de753(0xde)]({'success':![],'message':_0x4d4d68 instanceof Error?_0x4d4d68['message']:'Failed\x20to\x20perform\x20manual\x20domain\x20check'});}}),exports['default']=router;