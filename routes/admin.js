'use strict';const a20_0x40c3f8=a20_0x5db8;(function(_0x246cbf,_0x2cf5c4){const _0x40f868=a20_0x5db8,_0x4ebb11=_0x246cbf();while(!![]){try{const _0x367290=-parseInt(_0x40f868(0x156))/0x1+parseInt(_0x40f868(0x18e))/0x2+parseInt(_0x40f868(0x16e))/0x3*(-parseInt(_0x40f868(0x165))/0x4)+-parseInt(_0x40f868(0x187))/0x5+parseInt(_0x40f868(0x12d))/0x6+parseInt(_0x40f868(0x143))/0x7+parseInt(_0x40f868(0x183))/0x8*(parseInt(_0x40f868(0x12f))/0x9);if(_0x367290===_0x2cf5c4)break;else _0x4ebb11['push'](_0x4ebb11['shift']());}catch(_0x2efb94){_0x4ebb11['push'](_0x4ebb11['shift']());}}}(a20_0x4bfe,0x1beb9));var __createBinding=this&&this[a20_0x40c3f8(0x14a)]||(Object[a20_0x40c3f8(0x17d)]?function(_0x38ced0,_0x47247b,_0x285657,_0x525015){const _0x107990=a20_0x40c3f8;if(_0x525015===undefined)_0x525015=_0x285657;var _0x1eed9b=Object[_0x107990(0x185)](_0x47247b,_0x285657);(!_0x1eed9b||(_0x107990(0x186)in _0x1eed9b?!_0x47247b[_0x107990(0x168)]:_0x1eed9b[_0x107990(0x13f)]||_0x1eed9b[_0x107990(0x146)]))&&(_0x1eed9b={'enumerable':!![],'get':function(){return _0x47247b[_0x285657];}}),Object[_0x107990(0x14f)](_0x38ced0,_0x525015,_0x1eed9b);}:function(_0x4c6522,_0x29f926,_0x3e8c3a,_0x16131b){if(_0x16131b===undefined)_0x16131b=_0x3e8c3a;_0x4c6522[_0x16131b]=_0x29f926[_0x3e8c3a];}),__setModuleDefault=this&&this[a20_0x40c3f8(0x121)]||(Object['create']?function(_0x27b18a,_0x3a9b94){const _0x220189=a20_0x40c3f8;Object[_0x220189(0x14f)](_0x27b18a,_0x220189(0x16f),{'enumerable':!![],'value':_0x3a9b94});}:function(_0x2d1338,_0x4425a9){_0x2d1338['default']=_0x4425a9;}),__importStar=this&&this['__importStar']||(function(){var _0x44b101=function(_0x4dccb8){const _0x116eb8=a20_0x5db8;return _0x44b101=Object[_0x116eb8(0x134)]||function(_0x577f78){const _0x508a42=_0x116eb8;var _0x3f5e18=[];for(var _0x21916f in _0x577f78)if(Object[_0x508a42(0x14b)][_0x508a42(0x16c)][_0x508a42(0x190)](_0x577f78,_0x21916f))_0x3f5e18[_0x3f5e18['length']]=_0x21916f;return _0x3f5e18;},_0x44b101(_0x4dccb8);};return function(_0x2b6a8d){const _0x418ab5=a20_0x5db8;if(_0x2b6a8d&&_0x2b6a8d[_0x418ab5(0x168)])return _0x2b6a8d;var _0x1b24c1={};if(_0x2b6a8d!=null){for(var _0x59cbd1=_0x44b101(_0x2b6a8d),_0x2d9608=0x0;_0x2d9608<_0x59cbd1[_0x418ab5(0x130)];_0x2d9608++)if(_0x59cbd1[_0x2d9608]!==_0x418ab5(0x16f))__createBinding(_0x1b24c1,_0x2b6a8d,_0x59cbd1[_0x2d9608]);}return __setModuleDefault(_0x1b24c1,_0x2b6a8d),_0x1b24c1;};}());function a20_0x4bfe(){const _0x548e67=['default','/payouts/:id','coinToPayStatusService','getLogStats','updateCustomerData','/cointopay/payment/:paymentId','\x20days)','authenticateToken','/payout/stats','/merchant-statistics','now','updateCustomerDataSchema','Domain\x20is\x20responding\x20correctly','payment','create','suspendUser','toISOString','/cointopay/stats','/payout/merchants','EXPIRED','237256RiQMKK','updateUserSchema','getOwnPropertyDescriptor','get','296860mrMXDC','../middleware/auth','manualCheck','/statistics','createPayoutSchema','/payments/:id','currency','163168mNqMMk','getPaymentById','call','json','cleanOldLogs','getStatistics','CoinToPay\x20payment\x20status\x20checked\x20successfully','PENDING','shop','status','../services/domainMonitoringService','getServiceStats','Each\x20new\x20payment\x20gets\x20individual\x20timers:\x201min,\x202min,\x207min,\x2012min,\x20then\x20hourly','getMonitoringStats','floor','__setModuleDefault','Failed\x20to\x20get\x20CoinToPay\x20service\x20statistics','../services/coinToPayStatusService','Old\x20logs\x20cleaned\x20(kept\x20last\x20','put','/logs/stats','../config/database','gatewayPaymentId','/payments/:id/customer','/cointopay/check/:paymentId','cointopay','getMerchantStatistics','1134660QJwSnO','createUserSchema','9IjXufC','length','post','/users/:id/suspend','requireAdmin','getOwnPropertyNames','../controllers/adminController','message','deletePayout','Requests\x20are\x20made\x20with\x20base64\x20encoded\x20URLs','FAILED','Router','findUnique','updatedAt','gateway','\x20days\x20if\x20not\x20paid','writable','getPayoutStats','domainMonitoringService','createdAt','1173655WQdUsa','getMerchantsAwaitingPayout','PAID','configurable','Failed\x20to\x20get\x20domain\x20monitoring\x20statistics','body','Payments\x20automatically\x20expire\x20after\x20','__createBinding','prototype','/users/:id','AdminController','checkPaymentById','defineProperty','express','amount','loggerService','getPayouts','params','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status','177953lVHGmn','/users','validate','delete','getPaymentTimerInfo','Domain\x20monitoring\x20service\x20for\x20amaterasy884.icu','getTime','CoinToPay\x20automatic\x20status\x20checking\x20service','../middleware/validation','createUser','log','/payouts','❌\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20failed\x20for\x20payment\x20','activateUser','Failed\x20to\x20perform\x20manual\x20domain\x20check','4CzBxBk','/logs/clean','/payments','__esModule','updateUser','/merchants/selection','checkAuth','hasOwnProperty','Failed\x20to\x20get\x20log\x20statistics','348990LFxjgq'];a20_0x4bfe=function(){return _0x548e67;};return a20_0x4bfe();}Object[a20_0x40c3f8(0x14f)](exports,a20_0x40c3f8(0x168),{'value':!![]});const express_1=require(a20_0x40c3f8(0x150)),adminController_1=require(a20_0x40c3f8(0x135)),validation_1=require(a20_0x40c3f8(0x15e)),auth_1=require(a20_0x40c3f8(0x188)),loggerService_1=require('../services/loggerService'),coinToPayStatusService_1=require(a20_0x40c3f8(0x123)),domainMonitoringService_1=require(a20_0x40c3f8(0x11c)),router=(0x0,express_1[a20_0x40c3f8(0x13a)])(),adminController=new adminController_1[(a20_0x40c3f8(0x14d))]();function a20_0x5db8(_0x4bc095,_0x26839c){const _0x4bfe20=a20_0x4bfe();return a20_0x5db8=function(_0x5db84a,_0x42f3e7){_0x5db84a=_0x5db84a-0x11b;let _0x1881d9=_0x4bfe20[_0x5db84a];return _0x1881d9;},a20_0x5db8(_0x4bc095,_0x26839c);}router['use'](auth_1[a20_0x40c3f8(0x176)],auth_1[a20_0x40c3f8(0x133)]),router[a20_0x40c3f8(0x186)]('/auth',adminController[a20_0x40c3f8(0x16b)]),router[a20_0x40c3f8(0x186)](a20_0x40c3f8(0x18a),adminController[a20_0x40c3f8(0x193)]),router[a20_0x40c3f8(0x186)](a20_0x40c3f8(0x178),adminController[a20_0x40c3f8(0x12c)]),router[a20_0x40c3f8(0x186)](a20_0x40c3f8(0x177),adminController[a20_0x40c3f8(0x140)]),router[a20_0x40c3f8(0x186)](a20_0x40c3f8(0x181),adminController[a20_0x40c3f8(0x144)]),router[a20_0x40c3f8(0x186)](a20_0x40c3f8(0x16a),adminController['getMerchantsSelection']),router[a20_0x40c3f8(0x131)]('/payout',(0x0,validation_1['validate'])(validation_1[a20_0x40c3f8(0x18b)]),adminController['createPayout']),router[a20_0x40c3f8(0x186)](a20_0x40c3f8(0x161),adminController[a20_0x40c3f8(0x153)]),router['get'](a20_0x40c3f8(0x170),adminController['getPayoutById']),router[a20_0x40c3f8(0x159)](a20_0x40c3f8(0x170),adminController[a20_0x40c3f8(0x137)]),router[a20_0x40c3f8(0x186)](a20_0x40c3f8(0x167),adminController['getPayments']),router[a20_0x40c3f8(0x186)](a20_0x40c3f8(0x18c),adminController[a20_0x40c3f8(0x18f)]),router[a20_0x40c3f8(0x125)](a20_0x40c3f8(0x18c),adminController['updatePayment']),router['put'](a20_0x40c3f8(0x129),(0x0,validation_1[a20_0x40c3f8(0x158)])(validation_1[a20_0x40c3f8(0x17a)]),adminController[a20_0x40c3f8(0x173)]),router[a20_0x40c3f8(0x186)](a20_0x40c3f8(0x157),adminController['getUsers']),router[a20_0x40c3f8(0x186)]('/users/:id',adminController['getUserById']),router[a20_0x40c3f8(0x131)]('/users',(0x0,validation_1[a20_0x40c3f8(0x158)])(validation_1[a20_0x40c3f8(0x12e)]),adminController[a20_0x40c3f8(0x15f)]),router[a20_0x40c3f8(0x125)](a20_0x40c3f8(0x14c),(0x0,validation_1[a20_0x40c3f8(0x158)])(validation_1[a20_0x40c3f8(0x184)]),adminController[a20_0x40c3f8(0x169)]),router['delete']('/users/:id',adminController['deleteUser']),router['post'](a20_0x40c3f8(0x132),adminController[a20_0x40c3f8(0x17e)]),router[a20_0x40c3f8(0x131)]('/users/:id/activate',adminController[a20_0x40c3f8(0x163)]),router[a20_0x40c3f8(0x186)](a20_0x40c3f8(0x126),(_0x2af2f7,_0x597104)=>{const _0x2cfd9c=a20_0x40c3f8;try{const _0x2cead1=loggerService_1[_0x2cfd9c(0x152)][_0x2cfd9c(0x172)]();_0x597104['json']({'success':!![],'result':_0x2cead1});}catch(_0x10c0e6){_0x597104['status'](0x1f4)[_0x2cfd9c(0x191)]({'success':![],'message':_0x2cfd9c(0x16d)});}}),router[a20_0x40c3f8(0x131)](a20_0x40c3f8(0x166),(_0x59cb1c,_0x14ddce)=>{const _0x1e6d4f=a20_0x40c3f8;try{const {daysToKeep:daysToKeep=0x1e}=_0x59cb1c[_0x1e6d4f(0x148)];loggerService_1[_0x1e6d4f(0x152)][_0x1e6d4f(0x192)](daysToKeep),_0x14ddce[_0x1e6d4f(0x191)]({'success':!![],'message':_0x1e6d4f(0x124)+daysToKeep+_0x1e6d4f(0x175)});}catch(_0xcd4af1){_0x14ddce['status'](0x1f4)[_0x1e6d4f(0x191)]({'success':![],'message':'Failed\x20to\x20clean\x20old\x20logs'});}}),router[a20_0x40c3f8(0x131)](a20_0x40c3f8(0x12a),async(_0x53ec1e,_0x272f6b)=>{const _0x561bec=a20_0x40c3f8;try{const {paymentId:_0x5a1987}=_0x53ec1e[_0x561bec(0x154)];console[_0x561bec(0x160)]('🔍\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20requested\x20for\x20payment:\x20'+_0x5a1987),await coinToPayStatusService_1[_0x561bec(0x171)][_0x561bec(0x14e)](_0x5a1987),_0x272f6b[_0x561bec(0x191)]({'success':!![],'message':_0x561bec(0x194)});}catch(_0x334934){console['error'](_0x561bec(0x162)+_0x53ec1e['params']['paymentId']+':',_0x334934),_0x272f6b['status'](0x1f4)[_0x561bec(0x191)]({'success':![],'message':_0x334934 instanceof Error?_0x334934[_0x561bec(0x136)]:_0x561bec(0x155)});}}),router[a20_0x40c3f8(0x186)](a20_0x40c3f8(0x180),(_0x4a3127,_0x2095af)=>{const _0x5ac4e7=a20_0x40c3f8;try{const _0x51b02a=coinToPayStatusService_1[_0x5ac4e7(0x171)][_0x5ac4e7(0x11d)]();_0x2095af[_0x5ac4e7(0x191)]({'success':!![],'result':{..._0x51b02a,'description':_0x5ac4e7(0x15d),'statusMapping':{'Paid':_0x5ac4e7(0x145),'Awaiting\x20Fiat':'PENDING','waiting':_0x5ac4e7(0x195),'expired':_0x5ac4e7(0x182),'failed':_0x5ac4e7(0x139)},'autoExpiryNote':_0x5ac4e7(0x149)+_0x51b02a['expiryDays']+_0x5ac4e7(0x13e),'individualTimersNote':_0x5ac4e7(0x11e)}});}catch(_0x3d665d){_0x2095af['status'](0x1f4)['json']({'success':![],'message':_0x5ac4e7(0x122)});}}),router[a20_0x40c3f8(0x186)](a20_0x40c3f8(0x174),async(_0x39f426,_0x5760ed)=>{const _0x251aa8=a20_0x40c3f8;try{const {paymentId:_0x964534}=_0x39f426['params'],_0x18d3a8=coinToPayStatusService_1[_0x251aa8(0x171)][_0x251aa8(0x15a)](_0x964534),_0x28a7d4=(await Promise['resolve']()['then'](()=>__importStar(require(_0x251aa8(0x127)))))[_0x251aa8(0x16f)],_0x52f829=await _0x28a7d4[_0x251aa8(0x17c)][_0x251aa8(0x13b)]({'where':{'id':_0x964534},'select':{'id':!![],'gateway':!![],'gatewayPaymentId':!![],'status':!![],'amount':!![],'currency':!![],'createdAt':!![],'updatedAt':!![],'shopId':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x52f829)return _0x5760ed['status'](0x194)[_0x251aa8(0x191)]({'success':![],'message':'Payment\x20not\x20found'});_0x5760ed['json']({'success':!![],'result':{'payment':{'id':_0x52f829['id'],'gateway':_0x52f829[_0x251aa8(0x13d)],'gatewayPaymentId':_0x52f829[_0x251aa8(0x128)],'status':_0x52f829[_0x251aa8(0x11b)],'amount':_0x52f829[_0x251aa8(0x151)],'currency':_0x52f829[_0x251aa8(0x18d)],'createdAt':_0x52f829[_0x251aa8(0x142)],'updatedAt':_0x52f829[_0x251aa8(0x13c)],'shop':_0x52f829[_0x251aa8(0x196)]},'timers':_0x18d3a8,'isCoinToPay':_0x52f829['gateway']===_0x251aa8(0x12b),'ageInMinutes':Math[_0x251aa8(0x120)]((Date[_0x251aa8(0x179)]()-_0x52f829[_0x251aa8(0x142)][_0x251aa8(0x15c)]())/(0x3e8*0x3c))}});}catch(_0x3c0ad2){_0x5760ed[_0x251aa8(0x11b)](0x1f4)[_0x251aa8(0x191)]({'success':![],'message':_0x3c0ad2 instanceof Error?_0x3c0ad2[_0x251aa8(0x136)]:'Failed\x20to\x20get\x20payment\x20information'});}}),router[a20_0x40c3f8(0x186)]('/domain-monitoring/stats',(_0x5bbe7d,_0x1cbcd5)=>{const _0x237389=a20_0x40c3f8;try{const _0x3f4b92=domainMonitoringService_1[_0x237389(0x141)][_0x237389(0x11f)]();_0x1cbcd5[_0x237389(0x191)]({'success':!![],'result':{..._0x3f4b92,'description':_0x237389(0x15b),'behavior':'Server\x20crashes\x20if\x20domain\x20is\x20not\x20responding\x20after\x20consecutive\x20failures','encoding':_0x237389(0x138)}});}catch(_0x2e17ea){_0x1cbcd5[_0x237389(0x11b)](0x1f4)[_0x237389(0x191)]({'success':![],'message':_0x237389(0x147)});}}),router['post']('/domain-monitoring/check',async(_0x1751eb,_0x17d5fd)=>{const _0x5bec27=a20_0x40c3f8;try{const _0x193666=await domainMonitoringService_1['domainMonitoringService'][_0x5bec27(0x189)]();_0x17d5fd['json']({'success':!![],'result':{'domainAvailable':_0x193666,'message':_0x193666?_0x5bec27(0x17b):'Domain\x20check\x20failed','timestamp':new Date()[_0x5bec27(0x17f)]()}});}catch(_0x22ad86){_0x17d5fd[_0x5bec27(0x11b)](0x1f4)[_0x5bec27(0x191)]({'success':![],'message':_0x22ad86 instanceof Error?_0x22ad86[_0x5bec27(0x136)]:_0x5bec27(0x164)});}}),exports[a20_0x40c3f8(0x16f)]=router;