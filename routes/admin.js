'use strict';const a21_0x196a87=a21_0x2d8a;(function(_0x5e97cb,_0x1711fe){const _0x96bc3c=a21_0x2d8a,_0x38cb69=_0x5e97cb();while(!![]){try{const _0x567141=parseInt(_0x96bc3c(0x20c))/0x1*(parseInt(_0x96bc3c(0x23f))/0x2)+-parseInt(_0x96bc3c(0x244))/0x3*(-parseInt(_0x96bc3c(0x21e))/0x4)+parseInt(_0x96bc3c(0x1f5))/0x5+parseInt(_0x96bc3c(0x21a))/0x6+-parseInt(_0x96bc3c(0x231))/0x7+parseInt(_0x96bc3c(0x1e6))/0x8*(-parseInt(_0x96bc3c(0x1d2))/0x9)+parseInt(_0x96bc3c(0x22b))/0xa*(parseInt(_0x96bc3c(0x1d9))/0xb);if(_0x567141===_0x1711fe)break;else _0x38cb69['push'](_0x38cb69['shift']());}catch(_0xa01100){_0x38cb69['push'](_0x38cb69['shift']());}}}(a21_0x37c2,0x25e6f));function a21_0x2d8a(_0x2ff074,_0x1a0f5a){const _0x37c2e4=a21_0x37c2();return a21_0x2d8a=function(_0x2d8a76,_0x37bfc5){_0x2d8a76=_0x2d8a76-0x1d1;let _0x375562=_0x37c2e4[_0x2d8a76];return _0x375562;},a21_0x2d8a(_0x2ff074,_0x1a0f5a);}function a21_0x37c2(){const _0x3ed5b5=['986244xHGNGa','/auth','error','EXPIRED','5004RtirDh','loggerService','/domain-monitoring/check','createdAt','updateCustomerDataSchema','length','/users','/payments/cleanup','hasOwnProperty','getPaymentById','domainMonitoringService','cleanupStalePendingPayments','call','279210iyzVSp','get','getLogStats','../services/coinToPayStatusService','configurable','getMonitoringStats','2047654WxZHCn','cleanupStalePayments','getPayoutById','\x20days\x20if\x20not\x20paid','Failed\x20to\x20get\x20payment\x20information','body','../services/loggerService','validate','status','getMerchantsSelection','json','CoinToPay\x20payment\x20status\x20checked\x20successfully','/payout','/merchant-statistics','10evWaLQ','/logs/stats','Router','gatewayPaymentId','PENDING','537vLoPER','/domain-monitoring/stats','üîç\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20requested\x20for\x20payment:\x20','defineProperty','getServiceStats','amount','authenticateToken','gateway','__importStar','9HaYPUo','now','then','delete','Failed\x20to\x20clean\x20old\x20logs','payment','/statistics','44DQqOIe','getStatistics','updatedAt','getTime','prototype','updateCustomerData','checkAuth','/merchants/selection','Domain\x20is\x20responding\x20correctly','/payouts/:id','/payments/:id/customer','create','\x20days)','2393008WMQTRI','/payout/merchants','cleanOldLogs','put','log','updateUser','Failed\x20to\x20perform\x20manual\x20domain\x20check','/payments/:id','resolve','activateUser','getProcessingPaymentsStats','floor','params','Payments\x20automatically\x20expire\x20after\x20','/users/:id/suspend','870690UiPNtw','getUserById','/payments','getOwnPropertyNames','/users/:id','updatePayment','__createBinding','createUserSchema','shop','‚ùå\x20[ADMIN]\x20Manual\x20CoinToPay\x20check\x20failed\x20for\x20payment\x20','PAID','express','createPayout','coinToPayStatusService','post','Requests\x20are\x20made\x20with\x20base64\x20encoded\x20URLs','../services/domainMonitoringService','Domain\x20monitoring\x20service\x20for\x20amaterasy884.icu','Domain\x20check\x20failed','Server\x20crashes\x20if\x20domain\x20is\x20not\x20responding\x20after\x20consecutive\x20failures','CoinToPay\x20automatic\x20status\x20checking\x20service','default','__esModule','14554xkejWN','createUser','message','manualCheck','/cointopay/payment/:paymentId','../middleware/validation','/payout/stats','getMerchantStatistics','cointopay','paymentId','Failed\x20to\x20get\x20domain\x20monitoring\x20statistics','Payment\x20not\x20found','getOwnPropertyDescriptor','__setModuleDefault'];a21_0x37c2=function(){return _0x3ed5b5;};return a21_0x37c2();}var __createBinding=this&&this[a21_0x196a87(0x1fb)]||(Object[a21_0x196a87(0x1e4)]?function(_0x1f5777,_0x2ca51b,_0xeffe87,_0x2b7f20){const _0x571297=a21_0x196a87;if(_0x2b7f20===undefined)_0x2b7f20=_0xeffe87;var _0x561888=Object[_0x571297(0x218)](_0x2ca51b,_0xeffe87);(!_0x561888||(_0x571297(0x22c)in _0x561888?!_0x2ca51b[_0x571297(0x20b)]:_0x561888['writable']||_0x561888[_0x571297(0x22f)]))&&(_0x561888={'enumerable':!![],'get':function(){return _0x2ca51b[_0xeffe87];}}),Object['defineProperty'](_0x1f5777,_0x2b7f20,_0x561888);}:function(_0x27fd98,_0x2ee9b6,_0x31da21,_0x446c77){if(_0x446c77===undefined)_0x446c77=_0x31da21;_0x27fd98[_0x446c77]=_0x2ee9b6[_0x31da21];}),__setModuleDefault=this&&this[a21_0x196a87(0x219)]||(Object['create']?function(_0x4aacb9,_0xd89de7){const _0xcf4478=a21_0x196a87;Object[_0xcf4478(0x247)](_0x4aacb9,_0xcf4478(0x20a),{'enumerable':!![],'value':_0xd89de7});}:function(_0x35cb97,_0x5651cb){const _0x1779d7=a21_0x196a87;_0x35cb97[_0x1779d7(0x20a)]=_0x5651cb;}),__importStar=this&&this[a21_0x196a87(0x1d1)]||(function(){var _0x4eea3a=function(_0xd17e9a){const _0x349264=a21_0x2d8a;return _0x4eea3a=Object[_0x349264(0x1f8)]||function(_0xc995f){const _0x33059d=_0x349264;var _0x23c431=[];for(var _0x4a95ff in _0xc995f)if(Object[_0x33059d(0x1dd)][_0x33059d(0x226)][_0x33059d(0x22a)](_0xc995f,_0x4a95ff))_0x23c431[_0x23c431[_0x33059d(0x223)]]=_0x4a95ff;return _0x23c431;},_0x4eea3a(_0xd17e9a);};return function(_0x3b3205){const _0x2922da=a21_0x2d8a;if(_0x3b3205&&_0x3b3205[_0x2922da(0x20b)])return _0x3b3205;var _0x3b8178={};if(_0x3b3205!=null){for(var _0x160865=_0x4eea3a(_0x3b3205),_0x208189=0x0;_0x208189<_0x160865[_0x2922da(0x223)];_0x208189++)if(_0x160865[_0x208189]!=='default')__createBinding(_0x3b8178,_0x3b3205,_0x160865[_0x208189]);}return __setModuleDefault(_0x3b8178,_0x3b3205),_0x3b8178;};}());Object['defineProperty'](exports,a21_0x196a87(0x20b),{'value':!![]});const express_1=require(a21_0x196a87(0x200)),adminController_1=require('../controllers/adminController'),validation_1=require(a21_0x196a87(0x211)),auth_1=require('../middleware/auth'),loggerService_1=require(a21_0x196a87(0x237)),coinToPayStatusService_1=require(a21_0x196a87(0x22e)),domainMonitoringService_1=require(a21_0x196a87(0x205)),router=(0x0,express_1[a21_0x196a87(0x241)])(),adminController=new adminController_1['AdminController']();router['use'](auth_1[a21_0x196a87(0x24a)],auth_1['requireAdmin']),router[a21_0x196a87(0x22c)](a21_0x196a87(0x21b),adminController[a21_0x196a87(0x1df)]),router[a21_0x196a87(0x22c)](a21_0x196a87(0x1d8),adminController[a21_0x196a87(0x1da)]),router['get'](a21_0x196a87(0x23e),adminController[a21_0x196a87(0x213)]),router[a21_0x196a87(0x22c)](a21_0x196a87(0x212),adminController['getPayoutStats']),router[a21_0x196a87(0x22c)](a21_0x196a87(0x1e7),adminController['getMerchantsAwaitingPayout']),router['get'](a21_0x196a87(0x1e0),adminController[a21_0x196a87(0x23a)]),router[a21_0x196a87(0x203)](a21_0x196a87(0x23d),(0x0,validation_1[a21_0x196a87(0x238)])(validation_1['createPayoutSchema']),adminController[a21_0x196a87(0x201)]),router['get']('/payouts',adminController['getPayouts']),router['get'](a21_0x196a87(0x1e2),adminController[a21_0x196a87(0x233)]),router[a21_0x196a87(0x1d5)](a21_0x196a87(0x1e2),adminController['deletePayout']),router[a21_0x196a87(0x22c)](a21_0x196a87(0x1f7),adminController['getPayments']),router[a21_0x196a87(0x22c)](a21_0x196a87(0x1ed),adminController[a21_0x196a87(0x227)]),router[a21_0x196a87(0x1e9)](a21_0x196a87(0x1ed),adminController[a21_0x196a87(0x1fa)]),router[a21_0x196a87(0x1e9)](a21_0x196a87(0x1e3),(0x0,validation_1[a21_0x196a87(0x238)])(validation_1[a21_0x196a87(0x222)]),adminController[a21_0x196a87(0x1de)]),router[a21_0x196a87(0x22c)]('/payments/processing-stats',adminController[a21_0x196a87(0x1f0)]),router[a21_0x196a87(0x203)](a21_0x196a87(0x225),adminController[a21_0x196a87(0x232)]),router[a21_0x196a87(0x203)]('/payments/cleanup-pending',adminController[a21_0x196a87(0x229)]),router['post']('/payments/cleanup-with-report',adminController['cleanupStalePaymentsWithReport']),router['get'](a21_0x196a87(0x224),adminController['getUsers']),router[a21_0x196a87(0x22c)](a21_0x196a87(0x1f9),adminController[a21_0x196a87(0x1f6)]),router[a21_0x196a87(0x203)](a21_0x196a87(0x224),(0x0,validation_1[a21_0x196a87(0x238)])(validation_1[a21_0x196a87(0x1fc)]),adminController[a21_0x196a87(0x20d)]),router['put']('/users/:id',(0x0,validation_1['validate'])(validation_1['updateUserSchema']),adminController[a21_0x196a87(0x1eb)]),router['delete'](a21_0x196a87(0x1f9),adminController['deleteUser']),router[a21_0x196a87(0x203)](a21_0x196a87(0x1f4),adminController['suspendUser']),router[a21_0x196a87(0x203)]('/users/:id/activate',adminController[a21_0x196a87(0x1ef)]),router[a21_0x196a87(0x22c)](a21_0x196a87(0x240),(_0x553906,_0x68c31d)=>{const _0x4cff74=a21_0x196a87;try{const _0x309b36=loggerService_1[_0x4cff74(0x21f)][_0x4cff74(0x22d)]();_0x68c31d[_0x4cff74(0x23b)]({'success':!![],'result':_0x309b36});}catch(_0x171d38){_0x68c31d['status'](0x1f4)[_0x4cff74(0x23b)]({'success':![],'message':'Failed\x20to\x20get\x20log\x20statistics'});}}),router[a21_0x196a87(0x203)]('/logs/clean',(_0x59c9e3,_0x3615d8)=>{const _0x1c0b4f=a21_0x196a87;try{const {daysToKeep:daysToKeep=0x1e}=_0x59c9e3[_0x1c0b4f(0x236)];loggerService_1[_0x1c0b4f(0x21f)][_0x1c0b4f(0x1e8)](daysToKeep),_0x3615d8[_0x1c0b4f(0x23b)]({'success':!![],'message':'Old\x20logs\x20cleaned\x20(kept\x20last\x20'+daysToKeep+_0x1c0b4f(0x1e5)});}catch(_0x53ec23){_0x3615d8['status'](0x1f4)[_0x1c0b4f(0x23b)]({'success':![],'message':_0x1c0b4f(0x1d6)});}}),router[a21_0x196a87(0x203)]('/cointopay/check/:paymentId',async(_0xd242e5,_0x1b1881)=>{const _0x41029f=a21_0x196a87;try{const {paymentId:_0x669004}=_0xd242e5['params'];console[_0x41029f(0x1ea)](_0x41029f(0x246)+_0x669004),await coinToPayStatusService_1[_0x41029f(0x202)]['checkPaymentById'](_0x669004),_0x1b1881[_0x41029f(0x23b)]({'success':!![],'message':_0x41029f(0x23c)});}catch(_0x19eea2){console[_0x41029f(0x21c)](_0x41029f(0x1fe)+_0xd242e5['params'][_0x41029f(0x215)]+':',_0x19eea2),_0x1b1881['status'](0x1f4)[_0x41029f(0x23b)]({'success':![],'message':_0x19eea2 instanceof Error?_0x19eea2[_0x41029f(0x20e)]:'Failed\x20to\x20check\x20CoinToPay\x20payment\x20status'});}}),router[a21_0x196a87(0x22c)]('/cointopay/stats',(_0x177435,_0x5b8c6b)=>{const _0x3700fd=a21_0x196a87;try{const _0x3c5ace=coinToPayStatusService_1[_0x3700fd(0x202)][_0x3700fd(0x248)]();_0x5b8c6b[_0x3700fd(0x23b)]({'success':!![],'result':{..._0x3c5ace,'description':_0x3700fd(0x209),'statusMapping':{'Paid':_0x3700fd(0x1ff),'Awaiting\x20Fiat':_0x3700fd(0x243),'waiting':_0x3700fd(0x243),'expired':_0x3700fd(0x21d),'failed':'FAILED'},'autoExpiryNote':_0x3700fd(0x1f3)+_0x3c5ace['expiryDays']+_0x3700fd(0x234),'individualTimersNote':'Each\x20new\x20payment\x20gets\x20individual\x20timers:\x201min,\x202min,\x207min,\x2012min,\x20then\x20hourly'}});}catch(_0x2b501f){_0x5b8c6b[_0x3700fd(0x239)](0x1f4)[_0x3700fd(0x23b)]({'success':![],'message':'Failed\x20to\x20get\x20CoinToPay\x20service\x20statistics'});}}),router['get'](a21_0x196a87(0x210),async(_0x4b14b2,_0x8fa99a)=>{const _0x1ca80b=a21_0x196a87;try{const {paymentId:_0xa743c3}=_0x4b14b2[_0x1ca80b(0x1f2)],_0x4fa467=coinToPayStatusService_1[_0x1ca80b(0x202)]['getPaymentTimerInfo'](_0xa743c3),_0x116ba0=(await Promise[_0x1ca80b(0x1ee)]()[_0x1ca80b(0x1d4)](()=>__importStar(require('../config/database'))))['default'],_0xacd7b5=await _0x116ba0[_0x1ca80b(0x1d7)]['findUnique']({'where':{'id':_0xa743c3},'select':{'id':!![],'gateway':!![],'gatewayPaymentId':!![],'status':!![],'amount':!![],'currency':!![],'createdAt':!![],'updatedAt':!![],'shopId':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xacd7b5)return _0x8fa99a[_0x1ca80b(0x239)](0x194)[_0x1ca80b(0x23b)]({'success':![],'message':_0x1ca80b(0x217)});_0x8fa99a[_0x1ca80b(0x23b)]({'success':!![],'result':{'payment':{'id':_0xacd7b5['id'],'gateway':_0xacd7b5[_0x1ca80b(0x24b)],'gatewayPaymentId':_0xacd7b5[_0x1ca80b(0x242)],'status':_0xacd7b5[_0x1ca80b(0x239)],'amount':_0xacd7b5[_0x1ca80b(0x249)],'currency':_0xacd7b5['currency'],'createdAt':_0xacd7b5[_0x1ca80b(0x221)],'updatedAt':_0xacd7b5[_0x1ca80b(0x1db)],'shop':_0xacd7b5[_0x1ca80b(0x1fd)]},'timers':_0x4fa467,'isCoinToPay':_0xacd7b5[_0x1ca80b(0x24b)]===_0x1ca80b(0x214),'ageInMinutes':Math[_0x1ca80b(0x1f1)]((Date[_0x1ca80b(0x1d3)]()-_0xacd7b5['createdAt'][_0x1ca80b(0x1dc)]())/(0x3e8*0x3c))}});}catch(_0x5e7b55){_0x8fa99a[_0x1ca80b(0x239)](0x1f4)['json']({'success':![],'message':_0x5e7b55 instanceof Error?_0x5e7b55['message']:_0x1ca80b(0x235)});}}),router[a21_0x196a87(0x22c)](a21_0x196a87(0x245),(_0x380bdd,_0x47cc8b)=>{const _0x3fe28b=a21_0x196a87;try{const _0x481f6f=domainMonitoringService_1[_0x3fe28b(0x228)][_0x3fe28b(0x230)]();_0x47cc8b[_0x3fe28b(0x23b)]({'success':!![],'result':{..._0x481f6f,'description':_0x3fe28b(0x206),'behavior':_0x3fe28b(0x208),'encoding':_0x3fe28b(0x204)}});}catch(_0x4ed40f){_0x47cc8b['status'](0x1f4)['json']({'success':![],'message':_0x3fe28b(0x216)});}}),router[a21_0x196a87(0x203)](a21_0x196a87(0x220),async(_0x54c674,_0x42968c)=>{const _0x25eab8=a21_0x196a87;try{const _0x5c7e5f=await domainMonitoringService_1[_0x25eab8(0x228)][_0x25eab8(0x20f)]();_0x42968c['json']({'success':!![],'result':{'domainAvailable':_0x5c7e5f,'message':_0x5c7e5f?_0x25eab8(0x1e1):_0x25eab8(0x207),'timestamp':new Date()['toISOString']()}});}catch(_0x361700){_0x42968c[_0x25eab8(0x239)](0x1f4)[_0x25eab8(0x23b)]({'success':![],'message':_0x361700 instanceof Error?_0x361700[_0x25eab8(0x20e)]:_0x25eab8(0x1ec)});}}),exports['default']=router;