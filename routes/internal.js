'use strict';function a27_0x301a(_0x4792d3,_0x4c56e6){const _0x58ec30=a27_0x58ec();return a27_0x301a=function(_0x301aa7,_0x29f254){_0x301aa7=_0x301aa7-0xe0;let _0x20e5af=_0x58ec30[_0x301aa7];return _0x20e5af;},a27_0x301a(_0x4792d3,_0x4c56e6);}const a27_0x36699c=a27_0x301a;function a27_0x58ec(){const _0xfb266c=['get','substring','1371503gnOASM','findUnique','payment','includes','Bearer\x20','then','defineProperty','headers','__setModuleDefault','json','shop','paid_at','\x20with\x20gateway\x20settings','entries','failureMessage','error','configurable','internal-api-key','305gszpAt','780624aUofyW','status','patch','PAID','Error\x20sending\x20webhook\x20notification:','default','__esModule','173270Ryikek','prototype','card_last4','2NmUbXZ','params','gateway_payment_id','failure_message','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20','getOwnPropertyNames','express','string','/payments/:id/gateway-settings','username','call','10214875tuhlOC','startsWith','Router','body','12972gPzcwf','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','99LYaqTR','create','Invalid\x20internal\x20API\x20key','length','keys','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','/payments/:id/update','Internal\x20server\x20error','writable','log','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','Internal\x20API\x20error\x20getting\x20payment:','Payment\x20not\x20found','cardLast4','paymentMethod','gatewayPaymentId','hasOwnProperty','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','169699FsjPYR','update','‚úÖ\x20Internal\x20API:\x20Payment\x20','__importDefault','6YwhPAU','getOwnPropertyDescriptor','859803PWVlvq','/health','paidAt','amount'];a27_0x58ec=function(){return _0xfb266c;};return a27_0x58ec();}(function(_0x532022,_0xdb1543){const _0x3a1922=a27_0x301a,_0x2607b3=_0x532022();while(!![]){try{const _0x5b9af4=parseInt(_0x3a1922(0x109))/0x1*(-parseInt(_0x3a1922(0xe6))/0x2)+-parseInt(_0x3a1922(0x10f))/0x3+parseInt(_0x3a1922(0xf5))/0x4*(-parseInt(_0x3a1922(0x127))/0x5)+parseInt(_0x3a1922(0x10d))/0x6*(-parseInt(_0x3a1922(0x115))/0x7)+-parseInt(_0x3a1922(0x128))/0x8+-parseInt(_0x3a1922(0xf7))/0x9*(-parseInt(_0x3a1922(0xe3))/0xa)+parseInt(_0x3a1922(0xf1))/0xb;if(_0x5b9af4===_0xdb1543)break;else _0x2607b3['push'](_0x2607b3['shift']());}catch(_0x3f6dc0){_0x2607b3['push'](_0x2607b3['shift']());}}}(a27_0x58ec,0x29e48));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x7d88e6,_0x5de092,_0x2e22e6,_0x33240c){const _0x5b1c4d=a27_0x301a;if(_0x33240c===undefined)_0x33240c=_0x2e22e6;var _0x41a451=Object[_0x5b1c4d(0x10e)](_0x5de092,_0x2e22e6);(!_0x41a451||(_0x5b1c4d(0x113)in _0x41a451?!_0x5de092[_0x5b1c4d(0xe2)]:_0x41a451[_0x5b1c4d(0xff)]||_0x41a451[_0x5b1c4d(0x125)]))&&(_0x41a451={'enumerable':!![],'get':function(){return _0x5de092[_0x2e22e6];}}),Object[_0x5b1c4d(0x11b)](_0x7d88e6,_0x33240c,_0x41a451);}:function(_0x4ac830,_0xc3a95,_0x5df446,_0xe77b07){if(_0xe77b07===undefined)_0xe77b07=_0x5df446;_0x4ac830[_0xe77b07]=_0xc3a95[_0x5df446];}),__setModuleDefault=this&&this[a27_0x36699c(0x11d)]||(Object[a27_0x36699c(0xf8)]?function(_0x138531,_0x2e104c){const _0x42abb7=a27_0x36699c;Object[_0x42abb7(0x11b)](_0x138531,_0x42abb7(0xe1),{'enumerable':!![],'value':_0x2e104c});}:function(_0x45871e,_0x36dd58){_0x45871e['default']=_0x36dd58;}),__importStar=this&&this['__importStar']||(function(){var _0x4d298e=function(_0x20bc27){const _0x5788a3=a27_0x301a;return _0x4d298e=Object[_0x5788a3(0xeb)]||function(_0x1cacd4){const _0x1d6f36=_0x5788a3;var _0x5445ae=[];for(var _0xa28368 in _0x1cacd4)if(Object[_0x1d6f36(0xe4)][_0x1d6f36(0x107)][_0x1d6f36(0xf0)](_0x1cacd4,_0xa28368))_0x5445ae[_0x5445ae['length']]=_0xa28368;return _0x5445ae;},_0x4d298e(_0x20bc27);};return function(_0x92fae7){const _0x5775a0=a27_0x301a;if(_0x92fae7&&_0x92fae7['__esModule'])return _0x92fae7;var _0x3d4ac9={};if(_0x92fae7!=null){for(var _0x31326f=_0x4d298e(_0x92fae7),_0x23e0a1=0x0;_0x23e0a1<_0x31326f[_0x5775a0(0xfa)];_0x23e0a1++)if(_0x31326f[_0x23e0a1]!==_0x5775a0(0xe1))__createBinding(_0x3d4ac9,_0x92fae7,_0x31326f[_0x23e0a1]);}return __setModuleDefault(_0x3d4ac9,_0x92fae7),_0x3d4ac9;};}()),__importDefault=this&&this[a27_0x36699c(0x10c)]||function(_0x1fae64){const _0x17f40=a27_0x36699c;return _0x1fae64&&_0x1fae64[_0x17f40(0xe2)]?_0x1fae64:{'default':_0x1fae64};};Object[a27_0x36699c(0x11b)](exports,a27_0x36699c(0xe2),{'value':!![]});const express_1=require(a27_0x36699c(0xec)),database_1=__importDefault(require('../config/database')),router=(0x0,express_1[a27_0x36699c(0xf3)])(),verifyInternalApiKey=(_0x235cf8,_0x40e4da,_0x29c171)=>{const _0x500983=a27_0x36699c,_0x5b5bf=_0x235cf8[_0x500983(0x11c)]['authorization'];if(!_0x5b5bf||!_0x5b5bf[_0x500983(0xf2)](_0x500983(0x119)))return _0x40e4da[_0x500983(0x129)](0x191)[_0x500983(0x11e)]({'error':'Missing\x20or\x20invalid\x20authorization\x20header'});const _0x2022a8=_0x5b5bf[_0x500983(0x114)](0x7);if(_0x2022a8!==_0x500983(0x126))return _0x40e4da['status'](0x191)[_0x500983(0x11e)]({'error':_0x500983(0xf9)});_0x29c171();};router[a27_0x36699c(0x113)](a27_0x36699c(0xee),verifyInternalApiKey,async(_0xac814e,_0x219d4b)=>{const _0x5886c5=a27_0x36699c;try{const {id:_0x4f720}=_0xac814e['params'];console[_0x5886c5(0x100)](_0x5886c5(0xfc)+_0x4f720+_0x5886c5(0x121));const _0x2133ab=await database_1['default'][_0x5886c5(0x117)][_0x5886c5(0x116)]({'where':{'id':_0x4f720},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x2133ab)return _0x219d4b[_0x5886c5(0x129)](0x194)[_0x5886c5(0x11e)]({'error':_0x5886c5(0x103)});console[_0x5886c5(0x100)](_0x5886c5(0x108)+_0x2133ab[_0x5886c5(0x11f)][_0x5886c5(0xef)]),_0x219d4b[_0x5886c5(0x11e)]({'id':_0x2133ab['id'],'amount':_0x2133ab[_0x5886c5(0x112)],'currency':_0x2133ab['currency'],'status':_0x2133ab[_0x5886c5(0x129)],'orderId':_0x2133ab['orderId'],'shop':_0x2133ab[_0x5886c5(0x11f)]});}catch(_0xe9c29f){console[_0x5886c5(0x124)](_0x5886c5(0x102),_0xe9c29f),_0x219d4b[_0x5886c5(0x129)](0x1f4)['json']({'error':_0x5886c5(0xfe)});}}),router[a27_0x36699c(0x12a)](a27_0x36699c(0xfd),verifyInternalApiKey,async(_0x31a205,_0x388a85)=>{const _0x34636d=a27_0x36699c;try{const {id:_0x37ddd4}=_0x31a205[_0x34636d(0xe7)],_0x2a4552=_0x31a205[_0x34636d(0xf4)];console[_0x34636d(0x100)](_0x34636d(0xea)+_0x37ddd4,_0x2a4552);const _0x1778a5=[_0x34636d(0x129),_0x34636d(0xe8),'gatewayPaymentId','card_last4','cardLast4','payment_method',_0x34636d(0x105),_0x34636d(0x120),'paidAt',_0x34636d(0xe9),_0x34636d(0x123)],_0x2e592a={};for(const [_0x2f238e,_0x33040d]of Object[_0x34636d(0x122)](_0x2a4552)){if(_0x1778a5[_0x34636d(0x118)](_0x2f238e)){let _0x56bb82=_0x2f238e;if(_0x2f238e===_0x34636d(0xe8)||_0x2f238e==='gatewayPaymentId')_0x56bb82=_0x34636d(0x106);else{if(_0x2f238e===_0x34636d(0xe5)||_0x2f238e===_0x34636d(0x104))_0x56bb82=_0x34636d(0x104);else{if(_0x2f238e==='payment_method'||_0x2f238e===_0x34636d(0x105))_0x56bb82='paymentMethod';else{if(_0x2f238e===_0x34636d(0x120)||_0x2f238e===_0x34636d(0x111))_0x56bb82=_0x34636d(0x111);else(_0x2f238e==='failure_message'||_0x2f238e===_0x34636d(0x123))&&(_0x56bb82=_0x34636d(0x123));}}}_0x56bb82===_0x34636d(0x111)&&typeof _0x33040d===_0x34636d(0xed)?_0x2e592a[_0x56bb82]=new Date(_0x33040d):_0x2e592a[_0x56bb82]=_0x33040d;}}if(Object[_0x34636d(0xfb)](_0x2e592a)[_0x34636d(0xfa)]===0x0)return _0x388a85[_0x34636d(0x129)](0x190)[_0x34636d(0x11e)]({'error':'No\x20valid\x20fields\x20to\x20update'});const _0x4d0dca=await database_1[_0x34636d(0xe1)][_0x34636d(0x117)][_0x34636d(0x10a)]({'where':{'id':_0x37ddd4},'data':_0x2e592a});console[_0x34636d(0x100)](_0x34636d(0x10b)+_0x37ddd4+'\x20updated\x20successfully');if(_0x2e592a[_0x34636d(0x129)]===_0x34636d(0x12b)){console[_0x34636d(0x100)]('üéâ\x20Payment\x20'+_0x37ddd4+_0x34636d(0x101));try{const {WebhookService:_0x125ebc}=await Promise['resolve']()[_0x34636d(0x11a)](()=>__importStar(require('../services/webhookService'))),_0x612da=new _0x125ebc(),_0x105e1e=await database_1[_0x34636d(0xe1)][_0x34636d(0x117)][_0x34636d(0x116)]({'where':{'id':_0x37ddd4},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x105e1e&&console[_0x34636d(0x100)](_0x34636d(0xf6)+_0x37ddd4);}catch(_0x3edc5a){console[_0x34636d(0x124)](_0x34636d(0xe0),_0x3edc5a);}}_0x388a85[_0x34636d(0x11e)]({'success':!![],'payment':{'id':_0x4d0dca['id'],'status':_0x4d0dca[_0x34636d(0x129)]}});}catch(_0xd434ec){console[_0x34636d(0x124)]('Internal\x20API\x20error\x20updating\x20payment:',_0xd434ec),_0x388a85['status'](0x1f4)['json']({'error':_0x34636d(0xfe)});}}),router['get'](a27_0x36699c(0x110),(_0x2c65e9,_0x384938)=>{_0x384938['json']({'status':'ok','timestamp':new Date()['toISOString']()});}),exports[a27_0x36699c(0xe1)]=router;