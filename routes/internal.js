'use strict';const a33_0x283d3a=a33_0x5d99;function a33_0x5d99(_0x52a10f,_0x42da61){_0x52a10f=_0x52a10f-0xce;const _0x11e229=a33_0x11e2();let _0x5d9999=_0x11e229[_0x52a10f];return _0x5d9999;}(function(_0x4eeca6,_0x22d886){const _0x28fb3c=a33_0x5d99,_0x23ee66=_0x4eeca6();while(!![]){try{const _0x5998b3=-parseInt(_0x28fb3c(0xf2))/0x1*(parseInt(_0x28fb3c(0x112))/0x2)+parseInt(_0x28fb3c(0x115))/0x3+parseInt(_0x28fb3c(0xe1))/0x4+-parseInt(_0x28fb3c(0xde))/0x5+-parseInt(_0x28fb3c(0xe2))/0x6*(-parseInt(_0x28fb3c(0x107))/0x7)+-parseInt(_0x28fb3c(0xfe))/0x8+-parseInt(_0x28fb3c(0xd9))/0x9;if(_0x5998b3===_0x22d886)break;else _0x23ee66['push'](_0x23ee66['shift']());}catch(_0x4baa89){_0x23ee66['push'](_0x23ee66['shift']());}}}(a33_0x11e2,0x7d8a4));function a33_0x11e2(){const _0x3b94b7=['paidAt','payment','gatewayPaymentId','getOwnPropertyDescriptor','Invalid\x20internal\x20API\x20key','substring','startsWith','30xprsuY','username','patch','internal-api-key','body','paymentMethod','get','shop','üéâ\x20Payment\x20','getOwnPropertyNames','create','call','2848184sYjEwX','includes','cardLast4','defineProperty','log','update','/payments/:id/gateway-settings','Internal\x20API\x20error\x20getting\x20payment:','params','701113HtlvBP','../services/webhookService','failure_message','currency','Router','failureMessage','json','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20','then','Internal\x20server\x20error','length','22500EuXpfB','paid_at','error','1286229jxnZAH','Internal\x20API\x20error\x20updating\x20payment:','__createBinding','../config/database','\x20updated\x20successfully','__setModuleDefault','__importDefault','status','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','__importStar','No\x20valid\x20fields\x20to\x20update','writable','headers','\x20with\x20gateway\x20settings','gateway_payment_id','PAID','payment_method','findUnique','765027wIIHyF','toISOString','‚úÖ\x20Internal\x20API:\x20Payment\x20','string','__esModule','467910smzcuy','hasOwnProperty','configurable','3429672vkApzQ','6kvXbLq','Payment\x20not\x20found','default','card_last4','Bearer\x20','Error\x20sending\x20webhook\x20notification:','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','authorization','/health'];a33_0x11e2=function(){return _0x3b94b7;};return a33_0x11e2();}var __createBinding=this&&this[a33_0x283d3a(0x117)]||(Object[a33_0x283d3a(0xfc)]?function(_0x2d4bb0,_0x3699d8,_0x4b1827,_0x2405eb){const _0x96d032=a33_0x283d3a;if(_0x2405eb===undefined)_0x2405eb=_0x4b1827;var _0x5f05af=Object[_0x96d032(0xee)](_0x3699d8,_0x4b1827);(!_0x5f05af||(_0x96d032(0xf8)in _0x5f05af?!_0x3699d8[_0x96d032(0xdd)]:_0x5f05af[_0x96d032(0xd2)]||_0x5f05af[_0x96d032(0xe0)]))&&(_0x5f05af={'enumerable':!![],'get':function(){return _0x3699d8[_0x4b1827];}}),Object[_0x96d032(0x101)](_0x2d4bb0,_0x2405eb,_0x5f05af);}:function(_0x21db41,_0x263834,_0x283328,_0x327cb2){if(_0x327cb2===undefined)_0x327cb2=_0x283328;_0x21db41[_0x327cb2]=_0x263834[_0x283328];}),__setModuleDefault=this&&this[a33_0x283d3a(0x11a)]||(Object[a33_0x283d3a(0xfc)]?function(_0x381309,_0xa10da8){Object['defineProperty'](_0x381309,'default',{'enumerable':!![],'value':_0xa10da8});}:function(_0x1488e0,_0x1976e7){const _0x1b5d07=a33_0x283d3a;_0x1488e0[_0x1b5d07(0xe4)]=_0x1976e7;}),__importStar=this&&this[a33_0x283d3a(0xd0)]||(function(){var _0x36a1f6=function(_0x576abe){const _0x22ebf3=a33_0x5d99;return _0x36a1f6=Object[_0x22ebf3(0xfb)]||function(_0x4b7194){const _0x383810=_0x22ebf3;var _0x2f858b=[];for(var _0x503ef0 in _0x4b7194)if(Object['prototype'][_0x383810(0xdf)][_0x383810(0xfd)](_0x4b7194,_0x503ef0))_0x2f858b[_0x2f858b['length']]=_0x503ef0;return _0x2f858b;},_0x36a1f6(_0x576abe);};return function(_0x1e9c48){const _0x3e23eb=a33_0x5d99;if(_0x1e9c48&&_0x1e9c48['__esModule'])return _0x1e9c48;var _0x3bb863={};if(_0x1e9c48!=null){for(var _0x1f5025=_0x36a1f6(_0x1e9c48),_0x5aaace=0x0;_0x5aaace<_0x1f5025[_0x3e23eb(0x111)];_0x5aaace++)if(_0x1f5025[_0x5aaace]!==_0x3e23eb(0xe4))__createBinding(_0x3bb863,_0x1e9c48,_0x1f5025[_0x5aaace]);}return __setModuleDefault(_0x3bb863,_0x1e9c48),_0x3bb863;};}()),__importDefault=this&&this[a33_0x283d3a(0x11b)]||function(_0x315ffd){const _0x3d9075=a33_0x283d3a;return _0x315ffd&&_0x315ffd[_0x3d9075(0xdd)]?_0x315ffd:{'default':_0x315ffd};};Object['defineProperty'](exports,a33_0x283d3a(0xdd),{'value':!![]});const express_1=require('express'),database_1=__importDefault(require(a33_0x283d3a(0x118))),router=(0x0,express_1[a33_0x283d3a(0x10b)])(),verifyInternalApiKey=(_0x1f519a,_0x149e10,_0x46cf8f)=>{const _0x10353c=a33_0x283d3a,_0x36b690=_0x1f519a[_0x10353c(0xd3)][_0x10353c(0xe9)];if(!_0x36b690||!_0x36b690[_0x10353c(0xf1)](_0x10353c(0xe6)))return _0x149e10[_0x10353c(0xce)](0x191)[_0x10353c(0x10d)]({'error':'Missing\x20or\x20invalid\x20authorization\x20header'});const _0x67a958=_0x36b690[_0x10353c(0xf0)](0x7);if(_0x67a958!==_0x10353c(0xf5))return _0x149e10[_0x10353c(0xce)](0x191)[_0x10353c(0x10d)]({'error':_0x10353c(0xef)});_0x46cf8f();};router[a33_0x283d3a(0xf8)](a33_0x283d3a(0x104),verifyInternalApiKey,async(_0x27b783,_0x64d859)=>{const _0x4ebfc8=a33_0x283d3a;try{const {id:_0x52d5f0}=_0x27b783['params'];console[_0x4ebfc8(0x102)](_0x4ebfc8(0xe8)+_0x52d5f0+_0x4ebfc8(0xd4));const _0x7e3988=await database_1[_0x4ebfc8(0xe4)][_0x4ebfc8(0xec)][_0x4ebfc8(0xd8)]({'where':{'id':_0x52d5f0},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x7e3988)return _0x64d859[_0x4ebfc8(0xce)](0x194)['json']({'error':_0x4ebfc8(0xe3)});console[_0x4ebfc8(0x102)](_0x4ebfc8(0xcf)+_0x7e3988[_0x4ebfc8(0xf9)][_0x4ebfc8(0xf3)]),_0x64d859['json']({'id':_0x7e3988['id'],'amount':_0x7e3988['amount'],'currency':_0x7e3988[_0x4ebfc8(0x10a)],'status':_0x7e3988[_0x4ebfc8(0xce)],'orderId':_0x7e3988['orderId'],'shop':_0x7e3988[_0x4ebfc8(0xf9)]});}catch(_0x10c862){console[_0x4ebfc8(0x114)](_0x4ebfc8(0x105),_0x10c862),_0x64d859[_0x4ebfc8(0xce)](0x1f4)[_0x4ebfc8(0x10d)]({'error':_0x4ebfc8(0x110)});}}),router[a33_0x283d3a(0xf4)]('/payments/:id/update',verifyInternalApiKey,async(_0x51bd8b,_0xa26b49)=>{const _0x7dd444=a33_0x283d3a;try{const {id:_0x103650}=_0x51bd8b[_0x7dd444(0x106)],_0x1ca1a7=_0x51bd8b[_0x7dd444(0xf6)];console[_0x7dd444(0x102)](_0x7dd444(0x10e)+_0x103650,_0x1ca1a7);const _0xa159b7=['status',_0x7dd444(0xd5),_0x7dd444(0xed),_0x7dd444(0xe5),_0x7dd444(0x100),_0x7dd444(0xd7),_0x7dd444(0xf7),_0x7dd444(0x113),_0x7dd444(0xeb),'failure_message',_0x7dd444(0x10c)],_0x26436d={};for(const [_0x5aeae1,_0xaf404e]of Object['entries'](_0x1ca1a7)){if(_0xa159b7[_0x7dd444(0xff)](_0x5aeae1)){let _0x14e922=_0x5aeae1;if(_0x5aeae1===_0x7dd444(0xd5)||_0x5aeae1===_0x7dd444(0xed))_0x14e922=_0x7dd444(0xed);else{if(_0x5aeae1===_0x7dd444(0xe5)||_0x5aeae1==='cardLast4')_0x14e922='cardLast4';else{if(_0x5aeae1===_0x7dd444(0xd7)||_0x5aeae1===_0x7dd444(0xf7))_0x14e922=_0x7dd444(0xf7);else{if(_0x5aeae1==='paid_at'||_0x5aeae1===_0x7dd444(0xeb))_0x14e922=_0x7dd444(0xeb);else(_0x5aeae1===_0x7dd444(0x109)||_0x5aeae1===_0x7dd444(0x10c))&&(_0x14e922=_0x7dd444(0x10c));}}}_0x14e922===_0x7dd444(0xeb)&&typeof _0xaf404e===_0x7dd444(0xdc)?_0x26436d[_0x14e922]=new Date(_0xaf404e):_0x26436d[_0x14e922]=_0xaf404e;}}if(Object['keys'](_0x26436d)[_0x7dd444(0x111)]===0x0)return _0xa26b49['status'](0x190)['json']({'error':_0x7dd444(0xd1)});const _0x4eee1c=await database_1['default'][_0x7dd444(0xec)][_0x7dd444(0x103)]({'where':{'id':_0x103650},'data':_0x26436d});console[_0x7dd444(0x102)](_0x7dd444(0xdb)+_0x103650+_0x7dd444(0x119));if(_0x26436d[_0x7dd444(0xce)]===_0x7dd444(0xd6)){console[_0x7dd444(0x102)](_0x7dd444(0xfa)+_0x103650+'\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing');try{const {WebhookService:_0x19c994}=await Promise['resolve']()[_0x7dd444(0x10f)](()=>__importStar(require(_0x7dd444(0x108)))),_0x21c50f=new _0x19c994(),_0x4a0a2c=await database_1[_0x7dd444(0xe4)]['payment'][_0x7dd444(0xd8)]({'where':{'id':_0x103650},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x4a0a2c&&console[_0x7dd444(0x102)]('üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20'+_0x103650);}catch(_0x5602bd){console[_0x7dd444(0x114)](_0x7dd444(0xe7),_0x5602bd);}}_0xa26b49[_0x7dd444(0x10d)]({'success':!![],'payment':{'id':_0x4eee1c['id'],'status':_0x4eee1c['status']}});}catch(_0x498496){console[_0x7dd444(0x114)](_0x7dd444(0x116),_0x498496),_0xa26b49['status'](0x1f4)[_0x7dd444(0x10d)]({'error':_0x7dd444(0x110)});}}),router[a33_0x283d3a(0xf8)](a33_0x283d3a(0xea),(_0x6c55af,_0x6a70c7)=>{const _0x119bf9=a33_0x283d3a;_0x6a70c7[_0x119bf9(0x10d)]({'status':'ok','timestamp':new Date()[_0x119bf9(0xda)]()});}),exports[a33_0x283d3a(0xe4)]=router;