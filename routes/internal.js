'use strict';const a25_0xe71bf2=a25_0x40de;function a25_0x40de(_0x51cdcc,_0x107dd6){const _0x106cec=a25_0x106c();return a25_0x40de=function(_0x40de34,_0x219b31){_0x40de34=_0x40de34-0x13a;let _0x5415e6=_0x106cec[_0x40de34];return _0x5415e6;},a25_0x40de(_0x51cdcc,_0x107dd6);}(function(_0x2166f5,_0x7d32db){const _0x48ac0a=a25_0x40de,_0x6efb54=_0x2166f5();while(!![]){try{const _0x36c691=parseInt(_0x48ac0a(0x15c))/0x1+parseInt(_0x48ac0a(0x150))/0x2*(parseInt(_0x48ac0a(0x16c))/0x3)+-parseInt(_0x48ac0a(0x161))/0x4+-parseInt(_0x48ac0a(0x14c))/0x5+parseInt(_0x48ac0a(0x147))/0x6*(parseInt(_0x48ac0a(0x15a))/0x7)+parseInt(_0x48ac0a(0x14b))/0x8*(-parseInt(_0x48ac0a(0x163))/0x9)+-parseInt(_0x48ac0a(0x153))/0xa*(-parseInt(_0x48ac0a(0x13c))/0xb);if(_0x36c691===_0x7d32db)break;else _0x6efb54['push'](_0x6efb54['shift']());}catch(_0x246583){_0x6efb54['push'](_0x6efb54['shift']());}}}(a25_0x106c,0xaf0d7));function a25_0x106c(){const _0x1edd48=['toISOString','card_last4','payment','toUpperCase','params','81saaLtl','orderId','json','patch','Missing\x20or\x20invalid\x20authorization\x20header','length','44HzoxGG','✅\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','error','✅\x20Internal\x20API:\x20Payment\x20','get','string','includes','🎉\x20Payment\x20','paid_at','🔄\x20Internal\x20API:\x20Updating\x20payment\x20','authorization','396zujdTe','/payments/:id/gateway-settings','gateway_response','No\x20valid\x20fields\x20to\x20update','8841832vPoXgC','4882470JWVxmw','substring','../config/database','default','44312lKHAbZ','Payment\x20not\x20found','update','4301300QuMCgC','status','currency','payment_method','PAID','Router','internal-api-key','1533RJOYLj','shop','875205KtEgwL','paidAt','keys','gateway_payment_id','log','1638612aAHHoF','__esModule','9pWsWbi','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','/payments/:id/update','Internal\x20server\x20error'];a25_0x106c=function(){return _0x1edd48;};return a25_0x106c();}var __importDefault=this&&this['__importDefault']||function(_0x40a034){const _0x1533a0=a25_0x40de;return _0x40a034&&_0x40a034[_0x1533a0(0x162)]?_0x40a034:{'default':_0x40a034};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const express_1=require('express'),database_1=__importDefault(require(a25_0xe71bf2(0x14e))),router=(0x0,express_1[a25_0xe71bf2(0x158)])(),verifyInternalApiKey=(_0x23275d,_0x56ef47,_0x7d9923)=>{const _0x5af90d=a25_0xe71bf2,_0x5765f5=_0x23275d['headers'][_0x5af90d(0x146)];if(!_0x5765f5||!_0x5765f5['startsWith']('Bearer\x20'))return _0x56ef47[_0x5af90d(0x154)](0x191)['json']({'error':_0x5af90d(0x13a)});const _0x456f96=_0x5765f5[_0x5af90d(0x14d)](0x7);if(_0x456f96!==_0x5af90d(0x159))return _0x56ef47[_0x5af90d(0x154)](0x191)['json']({'error':'Invalid\x20internal\x20API\x20key'});_0x7d9923();};router[a25_0xe71bf2(0x140)](a25_0xe71bf2(0x148),verifyInternalApiKey,async(_0x2e7f67,_0x4a5edc)=>{const _0x3da6f8=a25_0xe71bf2;try{const {id:_0x5decf7}=_0x2e7f67['params'];console[_0x3da6f8(0x160)]('🔍\x20Internal\x20API:\x20Getting\x20payment\x20'+_0x5decf7+'\x20with\x20gateway\x20settings');const _0x30f9a7=await database_1[_0x3da6f8(0x14f)][_0x3da6f8(0x169)]['findUnique']({'where':{'id':_0x5decf7},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x30f9a7)return _0x4a5edc[_0x3da6f8(0x154)](0x194)[_0x3da6f8(0x16e)]({'error':_0x3da6f8(0x151)});console[_0x3da6f8(0x160)](_0x3da6f8(0x13d)+_0x30f9a7['shop']['username']),_0x4a5edc[_0x3da6f8(0x16e)]({'id':_0x30f9a7['id'],'amount':_0x30f9a7['amount'],'currency':_0x30f9a7[_0x3da6f8(0x155)],'status':_0x30f9a7[_0x3da6f8(0x154)],'orderId':_0x30f9a7[_0x3da6f8(0x16d)],'shop':_0x30f9a7[_0x3da6f8(0x15b)]});}catch(_0x41c791){console[_0x3da6f8(0x13e)]('Internal\x20API\x20error\x20getting\x20payment:',_0x41c791),_0x4a5edc['status'](0x1f4)[_0x3da6f8(0x16e)]({'error':_0x3da6f8(0x166)});}}),router[a25_0xe71bf2(0x16f)](a25_0xe71bf2(0x165),verifyInternalApiKey,async(_0x2133d4,_0x13c65b)=>{const _0x2a115a=a25_0xe71bf2;try{const {id:_0x2b4674}=_0x2133d4[_0x2a115a(0x16b)],_0x1b7173=_0x2133d4['body'];console[_0x2a115a(0x160)](_0x2a115a(0x145)+_0x2b4674,_0x1b7173);const _0x3405e8=[_0x2a115a(0x154),_0x2a115a(0x15f),_0x2a115a(0x168),_0x2a115a(0x156),_0x2a115a(0x144),_0x2a115a(0x149),'failure_message'],_0x51e04f={};for(const [_0x5b5995,_0x3c4082]of Object['entries'](_0x1b7173)){if(_0x3405e8[_0x2a115a(0x142)](_0x5b5995)){const _0x1e2ad8=_0x5b5995['replace'](/_([a-z])/g,(_0x5f0983,_0x59ec8d)=>_0x59ec8d[_0x2a115a(0x16a)]());_0x1e2ad8===_0x2a115a(0x15d)&&typeof _0x3c4082===_0x2a115a(0x141)?_0x51e04f[_0x1e2ad8]=new Date(_0x3c4082):_0x51e04f[_0x1e2ad8]=_0x3c4082;}}if(Object[_0x2a115a(0x15e)](_0x51e04f)[_0x2a115a(0x13b)]===0x0)return _0x13c65b[_0x2a115a(0x154)](0x190)['json']({'error':_0x2a115a(0x14a)});const _0x2461f2=await database_1[_0x2a115a(0x14f)][_0x2a115a(0x169)][_0x2a115a(0x152)]({'where':{'id':_0x2b4674},'data':_0x51e04f});console['log'](_0x2a115a(0x13f)+_0x2b4674+'\x20updated\x20successfully'),_0x51e04f[_0x2a115a(0x154)]===_0x2a115a(0x157)&&console[_0x2a115a(0x160)](_0x2a115a(0x143)+_0x2b4674+_0x2a115a(0x164)),_0x13c65b[_0x2a115a(0x16e)]({'success':!![],'payment':{'id':_0x2461f2['id'],'status':_0x2461f2[_0x2a115a(0x154)]}});}catch(_0x14a5c3){console[_0x2a115a(0x13e)]('Internal\x20API\x20error\x20updating\x20payment:',_0x14a5c3),_0x13c65b['status'](0x1f4)[_0x2a115a(0x16e)]({'error':'Internal\x20server\x20error'});}}),router[a25_0xe71bf2(0x140)]('/health',(_0x2673bd,_0x5b733c)=>{const _0x44541f=a25_0xe71bf2;_0x5b733c[_0x44541f(0x16e)]({'status':'ok','timestamp':new Date()[_0x44541f(0x167)]()});}),exports['default']=router;