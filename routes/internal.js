'use strict';const a26_0x542a27=a26_0x28b2;(function(_0x3d9d05,_0x4e5392){const _0x4adeb9=a26_0x28b2,_0x2947a4=_0x3d9d05();while(!![]){try{const _0x140371=-parseInt(_0x4adeb9(0x19a))/0x1+parseInt(_0x4adeb9(0x1b7))/0x2*(-parseInt(_0x4adeb9(0x186))/0x3)+parseInt(_0x4adeb9(0x187))/0x4*(-parseInt(_0x4adeb9(0x1a4))/0x5)+-parseInt(_0x4adeb9(0x16a))/0x6*(-parseInt(_0x4adeb9(0x18b))/0x7)+-parseInt(_0x4adeb9(0x1b4))/0x8*(parseInt(_0x4adeb9(0x191))/0x9)+parseInt(_0x4adeb9(0x189))/0xa*(parseInt(_0x4adeb9(0x1b8))/0xb)+parseInt(_0x4adeb9(0x1a8))/0xc*(parseInt(_0x4adeb9(0x1a7))/0xd);if(_0x140371===_0x4e5392)break;else _0x2947a4['push'](_0x2947a4['shift']());}catch(_0x475e5f){_0x2947a4['push'](_0x2947a4['shift']());}}}(a26_0x5e58,0x33d0b));function a26_0x5e58(){const _0x855b27=['length','__importDefault','paidAt','paid_at','/health','365300noChIl','call','cardLast4','../services/webhookService','internal-api-key','defineProperty','__setModuleDefault','json','__createBinding','shop','92570fGUNTq','create','Bearer\x20','10894ttcXqw','10884SsAciK','PAID','Router','payment','prototype','log','gateway_payment_id','/payments/:id/gateway-settings','keys','Invalid\x20internal\x20API\x20key','__esModule','default','3928iZwGAj','payment_method','resolve','546HfMNnO','121nBBrRU','942qGymtK','‚úÖ\x20Internal\x20API:\x20Payment\x20','express','Payment\x20not\x20found','paymentMethod','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','\x20updated\x20successfully','Missing\x20or\x20invalid\x20authorization\x20header','Internal\x20server\x20error','substring','error','Internal\x20API\x20error\x20updating\x20payment:','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','params','writable','authorization','üéâ\x20Payment\x20','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','findUnique','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','body','includes','status','patch','headers','then','\x20with\x20gateway\x20settings','hasOwnProperty','669auUdge','44uLEfcQ','get','170770UjsiCK','getOwnPropertyNames','294gxeNfx','orderId','/payments/:id/update','failure_message','entries','gatewayPaymentId','2061vrZTdy','string','update','__importStar'];a26_0x5e58=function(){return _0x855b27;};return a26_0x5e58();}var __createBinding=this&&this[a26_0x542a27(0x1a2)]||(Object[a26_0x542a27(0x1a5)]?function(_0x2cdc5a,_0x360986,_0x347136,_0x5cd16e){const _0x5c376f=a26_0x542a27;if(_0x5cd16e===undefined)_0x5cd16e=_0x347136;var _0x18ebed=Object['getOwnPropertyDescriptor'](_0x360986,_0x347136);(!_0x18ebed||(_0x5c376f(0x188)in _0x18ebed?!_0x360986[_0x5c376f(0x1b2)]:_0x18ebed[_0x5c376f(0x178)]||_0x18ebed['configurable']))&&(_0x18ebed={'enumerable':!![],'get':function(){return _0x360986[_0x347136];}}),Object[_0x5c376f(0x19f)](_0x2cdc5a,_0x5cd16e,_0x18ebed);}:function(_0x1e8fde,_0x2b49c7,_0x2b84f3,_0x1aa5b0){if(_0x1aa5b0===undefined)_0x1aa5b0=_0x2b84f3;_0x1e8fde[_0x1aa5b0]=_0x2b49c7[_0x2b84f3];}),__setModuleDefault=this&&this[a26_0x542a27(0x1a0)]||(Object[a26_0x542a27(0x1a5)]?function(_0x1b414b,_0x47051e){const _0x4ffca6=a26_0x542a27;Object[_0x4ffca6(0x19f)](_0x1b414b,'default',{'enumerable':!![],'value':_0x47051e});}:function(_0x44c77c,_0x59cf9b){const _0x5c5c62=a26_0x542a27;_0x44c77c[_0x5c5c62(0x1b3)]=_0x59cf9b;}),__importStar=this&&this[a26_0x542a27(0x194)]||(function(){var _0x889aab=function(_0x20c673){const _0x1341c6=a26_0x28b2;return _0x889aab=Object[_0x1341c6(0x18a)]||function(_0x575adb){const _0xbb407a=_0x1341c6;var _0xea5a5c=[];for(var _0x413b3e in _0x575adb)if(Object[_0xbb407a(0x1ac)][_0xbb407a(0x185)][_0xbb407a(0x19b)](_0x575adb,_0x413b3e))_0xea5a5c[_0xea5a5c[_0xbb407a(0x195)]]=_0x413b3e;return _0xea5a5c;},_0x889aab(_0x20c673);};return function(_0x12319a){const _0x4d9efa=a26_0x28b2;if(_0x12319a&&_0x12319a['__esModule'])return _0x12319a;var _0x5b7e49={};if(_0x12319a!=null){for(var _0x34ad13=_0x889aab(_0x12319a),_0x58c013=0x0;_0x58c013<_0x34ad13[_0x4d9efa(0x195)];_0x58c013++)if(_0x34ad13[_0x58c013]!==_0x4d9efa(0x1b3))__createBinding(_0x5b7e49,_0x12319a,_0x34ad13[_0x58c013]);}return __setModuleDefault(_0x5b7e49,_0x12319a),_0x5b7e49;};}()),__importDefault=this&&this[a26_0x542a27(0x196)]||function(_0x3b0d92){const _0x2e49da=a26_0x542a27;return _0x3b0d92&&_0x3b0d92[_0x2e49da(0x1b2)]?_0x3b0d92:{'default':_0x3b0d92};};Object[a26_0x542a27(0x19f)](exports,a26_0x542a27(0x1b2),{'value':!![]});const express_1=require(a26_0x542a27(0x16c)),database_1=__importDefault(require('../config/database')),router=(0x0,express_1[a26_0x542a27(0x1aa)])(),verifyInternalApiKey=(_0xd8ede6,_0x5459fa,_0xfab011)=>{const _0xe5c4a0=a26_0x542a27,_0x25d205=_0xd8ede6[_0xe5c4a0(0x182)][_0xe5c4a0(0x179)];if(!_0x25d205||!_0x25d205['startsWith'](_0xe5c4a0(0x1a6)))return _0x5459fa['status'](0x191)[_0xe5c4a0(0x1a1)]({'error':_0xe5c4a0(0x171)});const _0x27831a=_0x25d205[_0xe5c4a0(0x173)](0x7);if(_0x27831a!==_0xe5c4a0(0x19e))return _0x5459fa[_0xe5c4a0(0x180)](0x191)[_0xe5c4a0(0x1a1)]({'error':_0xe5c4a0(0x1b1)});_0xfab011();};function a26_0x28b2(_0x51667a,_0x48c1b4){const _0x5e580f=a26_0x5e58();return a26_0x28b2=function(_0x28b290,_0x4ded25){_0x28b290=_0x28b290-0x16a;let _0x274301=_0x5e580f[_0x28b290];return _0x274301;},a26_0x28b2(_0x51667a,_0x48c1b4);}router[a26_0x542a27(0x188)](a26_0x542a27(0x1af),verifyInternalApiKey,async(_0x1cebdf,_0x344743)=>{const _0x424cab=a26_0x542a27;try{const {id:_0x3e1bf2}=_0x1cebdf[_0x424cab(0x177)];console[_0x424cab(0x1ad)](_0x424cab(0x17d)+_0x3e1bf2+_0x424cab(0x184));const _0x4b008b=await database_1['default'][_0x424cab(0x1ab)][_0x424cab(0x17c)]({'where':{'id':_0x3e1bf2},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x4b008b)return _0x344743[_0x424cab(0x180)](0x194)['json']({'error':_0x424cab(0x16d)});console[_0x424cab(0x1ad)](_0x424cab(0x176)+_0x4b008b[_0x424cab(0x1a3)]['username']),_0x344743['json']({'id':_0x4b008b['id'],'amount':_0x4b008b['amount'],'currency':_0x4b008b['currency'],'status':_0x4b008b[_0x424cab(0x180)],'orderId':_0x4b008b[_0x424cab(0x18c)],'shop':_0x4b008b[_0x424cab(0x1a3)]});}catch(_0x2e07ff){console['error']('Internal\x20API\x20error\x20getting\x20payment:',_0x2e07ff),_0x344743['status'](0x1f4)[_0x424cab(0x1a1)]({'error':_0x424cab(0x172)});}}),router[a26_0x542a27(0x181)](a26_0x542a27(0x18d),verifyInternalApiKey,async(_0x319f1a,_0x448531)=>{const _0xe686fb=a26_0x542a27;try{const {id:_0x33ce1f}=_0x319f1a['params'],_0x245e8e=_0x319f1a[_0xe686fb(0x17e)];console[_0xe686fb(0x1ad)]('üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20'+_0x33ce1f,_0x245e8e);const _0x209636=[_0xe686fb(0x180),'gateway_payment_id',_0xe686fb(0x190),'card_last4','cardLast4',_0xe686fb(0x1b5),_0xe686fb(0x16e),'paid_at',_0xe686fb(0x197),_0xe686fb(0x18e),'failureMessage'],_0x4cf1f3={};for(const [_0x379181,_0x38a496]of Object[_0xe686fb(0x18f)](_0x245e8e)){if(_0x209636[_0xe686fb(0x17f)](_0x379181)){let _0x1b302e=_0x379181;if(_0x379181===_0xe686fb(0x1ae)||_0x379181==='gatewayPaymentId')_0x1b302e='gatewayPaymentId';else{if(_0x379181==='card_last4'||_0x379181===_0xe686fb(0x19c))_0x1b302e=_0xe686fb(0x19c);else{if(_0x379181===_0xe686fb(0x1b5)||_0x379181===_0xe686fb(0x16e))_0x1b302e=_0xe686fb(0x16e);else{if(_0x379181===_0xe686fb(0x198)||_0x379181===_0xe686fb(0x197))_0x1b302e=_0xe686fb(0x197);else(_0x379181==='failure_message'||_0x379181==='failureMessage')&&(_0x1b302e='failureMessage');}}}_0x1b302e===_0xe686fb(0x197)&&typeof _0x38a496===_0xe686fb(0x192)?_0x4cf1f3[_0x1b302e]=new Date(_0x38a496):_0x4cf1f3[_0x1b302e]=_0x38a496;}}if(Object[_0xe686fb(0x1b0)](_0x4cf1f3)[_0xe686fb(0x195)]===0x0)return _0x448531['status'](0x190)['json']({'error':'No\x20valid\x20fields\x20to\x20update'});const _0x22fee6=await database_1[_0xe686fb(0x1b3)][_0xe686fb(0x1ab)][_0xe686fb(0x193)]({'where':{'id':_0x33ce1f},'data':_0x4cf1f3});console['log'](_0xe686fb(0x16b)+_0x33ce1f+_0xe686fb(0x170));if(_0x4cf1f3[_0xe686fb(0x180)]===_0xe686fb(0x1a9)){console[_0xe686fb(0x1ad)](_0xe686fb(0x17a)+_0x33ce1f+_0xe686fb(0x16f));try{const {WebhookService:_0x2f9767}=await Promise[_0xe686fb(0x1b6)]()[_0xe686fb(0x183)](()=>__importStar(require(_0xe686fb(0x19d)))),_0x32d240=new _0x2f9767(),_0x2bf2c0=await database_1['default'][_0xe686fb(0x1ab)]['findUnique']({'where':{'id':_0x33ce1f},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x2bf2c0&&console['log'](_0xe686fb(0x17b)+_0x33ce1f);}catch(_0x28eb40){console[_0xe686fb(0x174)]('Error\x20sending\x20webhook\x20notification:',_0x28eb40);}}_0x448531[_0xe686fb(0x1a1)]({'success':!![],'payment':{'id':_0x22fee6['id'],'status':_0x22fee6['status']}});}catch(_0x272fb9){console['error'](_0xe686fb(0x175),_0x272fb9),_0x448531['status'](0x1f4)[_0xe686fb(0x1a1)]({'error':_0xe686fb(0x172)});}}),router[a26_0x542a27(0x188)](a26_0x542a27(0x199),(_0x375f0b,_0x2cfe0e)=>{const _0x99b03b=a26_0x542a27;_0x2cfe0e[_0x99b03b(0x1a1)]({'status':'ok','timestamp':new Date()['toISOString']()});}),exports[a26_0x542a27(0x1b3)]=router;