'use strict';const a25_0x3f1be3=a25_0x3401;(function(_0x1232cc,_0x33fd10){const _0x31b0b8=a25_0x3401,_0xe61c80=_0x1232cc();while(!![]){try{const _0x210c83=parseInt(_0x31b0b8(0x80))/0x1+-parseInt(_0x31b0b8(0x6b))/0x2*(-parseInt(_0x31b0b8(0xa9))/0x3)+parseInt(_0x31b0b8(0x6f))/0x4+-parseInt(_0x31b0b8(0x8e))/0x5*(-parseInt(_0x31b0b8(0x83))/0x6)+parseInt(_0x31b0b8(0x79))/0x7+parseInt(_0x31b0b8(0x86))/0x8+-parseInt(_0x31b0b8(0x9f))/0x9;if(_0x210c83===_0x33fd10)break;else _0xe61c80['push'](_0xe61c80['shift']());}catch(_0x1b2601){_0xe61c80['push'](_0xe61c80['shift']());}}}(a25_0x8b20,0xbefa4));var __createBinding=this&&this[a25_0x3f1be3(0xaa)]||(Object[a25_0x3f1be3(0x93)]?function(_0x3967ae,_0x281dfa,_0x398227,_0x3ba3f4){const _0x492b45=a25_0x3f1be3;if(_0x3ba3f4===undefined)_0x3ba3f4=_0x398227;var _0x293372=Object[_0x492b45(0xa6)](_0x281dfa,_0x398227);(!_0x293372||(_0x492b45(0x88)in _0x293372?!_0x281dfa[_0x492b45(0x9a)]:_0x293372[_0x492b45(0xa4)]||_0x293372[_0x492b45(0xa2)]))&&(_0x293372={'enumerable':!![],'get':function(){return _0x281dfa[_0x398227];}}),Object[_0x492b45(0x94)](_0x3967ae,_0x3ba3f4,_0x293372);}:function(_0x36bcb8,_0x5747dd,_0x20bd4f,_0xb56e78){if(_0xb56e78===undefined)_0xb56e78=_0x20bd4f;_0x36bcb8[_0xb56e78]=_0x5747dd[_0x20bd4f];}),__setModuleDefault=this&&this[a25_0x3f1be3(0xa5)]||(Object['create']?function(_0x56deec,_0x2dcd35){const _0x259629=a25_0x3f1be3;Object[_0x259629(0x94)](_0x56deec,_0x259629(0x84),{'enumerable':!![],'value':_0x2dcd35});}:function(_0x338f35,_0x995ee0){_0x338f35['default']=_0x995ee0;}),__importStar=this&&this[a25_0x3f1be3(0x7c)]||(function(){var _0x3d4160=function(_0x5b2bc4){const _0xbb1188=a25_0x3401;return _0x3d4160=Object[_0xbb1188(0x7a)]||function(_0x1e6276){const _0x39b379=_0xbb1188;var _0x4336f4=[];for(var _0x453cf1 in _0x1e6276)if(Object['prototype'][_0x39b379(0x6e)][_0x39b379(0xa1)](_0x1e6276,_0x453cf1))_0x4336f4[_0x4336f4[_0x39b379(0x87)]]=_0x453cf1;return _0x4336f4;},_0x3d4160(_0x5b2bc4);};return function(_0x5c1d79){const _0x241311=a25_0x3401;if(_0x5c1d79&&_0x5c1d79[_0x241311(0x9a)])return _0x5c1d79;var _0x56d038={};if(_0x5c1d79!=null){for(var _0x8cd681=_0x3d4160(_0x5c1d79),_0x16f231=0x0;_0x16f231<_0x8cd681[_0x241311(0x87)];_0x16f231++)if(_0x8cd681[_0x16f231]!=='default')__createBinding(_0x56d038,_0x5c1d79,_0x8cd681[_0x16f231]);}return __setModuleDefault(_0x56d038,_0x5c1d79),_0x56d038;};}()),__importDefault=this&&this[a25_0x3f1be3(0x98)]||function(_0x9bd825){return _0x9bd825&&_0x9bd825['__esModule']?_0x9bd825:{'default':_0x9bd825};};function a25_0x3401(_0x30a8b9,_0x55eca9){const _0x8b2060=a25_0x8b20();return a25_0x3401=function(_0x340142,_0x590a48){_0x340142=_0x340142-0x6a;let _0x2be559=_0x8b2060[_0x340142];return _0x2be559;},a25_0x3401(_0x30a8b9,_0x55eca9);}Object['defineProperty'](exports,a25_0x3f1be3(0x9a),{'value':!![]});const express_1=require(a25_0x3f1be3(0x74)),database_1=__importDefault(require(a25_0x3f1be3(0x8b))),router=(0x0,express_1['Router'])(),verifyInternalApiKey=(_0x275f82,_0x3e91a2,_0x2239a8)=>{const _0x2b034a=a25_0x3f1be3,_0x2f7e3b=_0x275f82['headers']['authorization'];if(!_0x2f7e3b||!_0x2f7e3b[_0x2b034a(0xa8)]('Bearer\x20'))return _0x3e91a2[_0x2b034a(0xae)](0x191)[_0x2b034a(0x97)]({'error':'Missing\x20or\x20invalid\x20authorization\x20header'});const _0x50fb51=_0x2f7e3b['substring'](0x7);if(_0x50fb51!==_0x2b034a(0xad))return _0x3e91a2[_0x2b034a(0xae)](0x191)[_0x2b034a(0x97)]({'error':_0x2b034a(0x75)});_0x2239a8();};function a25_0x8b20(){const _0x1f5de3=['toISOString','hasOwnProperty','3023940TLfSPi','\x20with\x20gateway\x20settings','error','params','findUnique','express','Invalid\x20internal\x20API\x20key','\x20updated\x20successfully','paymentMethod','update','5628693MPxuYN','getOwnPropertyNames','shop','__importStar','cardLast4','keys','resolve','841955GBHhDj','paid_at','failure_message','257334UMjvNj','default','/payments/:id/gateway-settings','11706328AVwqOH','length','get','body','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','../config/database','patch','Payment\x20not\x20found','25xgenkw','log','gateway_payment_id','payment','string','create','defineProperty','gatewayPaymentId','amount','json','__importDefault','📤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','__esModule','payment_method','PAID','paidAt','/payments/:id/update','42279201yavWGX','entries','call','configurable','card_last4','writable','__setModuleDefault','getOwnPropertyDescriptor','🔄\x20Internal\x20API:\x20Updating\x20payment\x20','startsWith','3VEhjIT','__createBinding','🔍\x20Internal\x20API:\x20Getting\x20payment\x20','Internal\x20server\x20error','internal-api-key','status','🎉\x20Payment\x20','2800316Hkbucl','failureMessage'];a25_0x8b20=function(){return _0x1f5de3;};return a25_0x8b20();}router[a25_0x3f1be3(0x88)](a25_0x3f1be3(0x85),verifyInternalApiKey,async(_0x33ef8f,_0x59eb4b)=>{const _0x42c7e2=a25_0x3f1be3;try{const {id:_0x1ac612}=_0x33ef8f[_0x42c7e2(0x72)];console['log'](_0x42c7e2(0xab)+_0x1ac612+_0x42c7e2(0x70));const _0x2a9433=await database_1[_0x42c7e2(0x84)][_0x42c7e2(0x91)][_0x42c7e2(0x73)]({'where':{'id':_0x1ac612},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x2a9433)return _0x59eb4b['status'](0x194)[_0x42c7e2(0x97)]({'error':_0x42c7e2(0x8d)});console[_0x42c7e2(0x8f)]('✅\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20'+_0x2a9433[_0x42c7e2(0x7b)]['username']),_0x59eb4b[_0x42c7e2(0x97)]({'id':_0x2a9433['id'],'amount':_0x2a9433[_0x42c7e2(0x96)],'currency':_0x2a9433['currency'],'status':_0x2a9433[_0x42c7e2(0xae)],'orderId':_0x2a9433['orderId'],'shop':_0x2a9433[_0x42c7e2(0x7b)]});}catch(_0xf5c73a){console[_0x42c7e2(0x71)]('Internal\x20API\x20error\x20getting\x20payment:',_0xf5c73a),_0x59eb4b[_0x42c7e2(0xae)](0x1f4)[_0x42c7e2(0x97)]({'error':_0x42c7e2(0xac)});}}),router[a25_0x3f1be3(0x8c)](a25_0x3f1be3(0x9e),verifyInternalApiKey,async(_0x20441d,_0x2d2ccd)=>{const _0x416779=a25_0x3f1be3;try{const {id:_0x2a3fcf}=_0x20441d[_0x416779(0x72)],_0x238739=_0x20441d[_0x416779(0x89)];console[_0x416779(0x8f)](_0x416779(0xa7)+_0x2a3fcf,_0x238739);const _0x343d0b=[_0x416779(0xae),_0x416779(0x90),'gatewayPaymentId',_0x416779(0xa3),_0x416779(0x7d),_0x416779(0x9b),_0x416779(0x77),'paid_at',_0x416779(0x9d),_0x416779(0x82),'failureMessage'],_0x503641={};for(const [_0x21a50a,_0x22fcbf]of Object[_0x416779(0xa0)](_0x238739)){if(_0x343d0b['includes'](_0x21a50a)){let _0x3025e8=_0x21a50a;if(_0x21a50a===_0x416779(0x90)||_0x21a50a===_0x416779(0x95))_0x3025e8=_0x416779(0x95);else{if(_0x21a50a===_0x416779(0xa3)||_0x21a50a==='cardLast4')_0x3025e8='cardLast4';else{if(_0x21a50a===_0x416779(0x9b)||_0x21a50a===_0x416779(0x77))_0x3025e8=_0x416779(0x77);else{if(_0x21a50a===_0x416779(0x81)||_0x21a50a===_0x416779(0x9d))_0x3025e8=_0x416779(0x9d);else(_0x21a50a==='failure_message'||_0x21a50a===_0x416779(0x6c))&&(_0x3025e8=_0x416779(0x6c));}}}_0x3025e8===_0x416779(0x9d)&&typeof _0x22fcbf===_0x416779(0x92)?_0x503641[_0x3025e8]=new Date(_0x22fcbf):_0x503641[_0x3025e8]=_0x22fcbf;}}if(Object[_0x416779(0x7e)](_0x503641)['length']===0x0)return _0x2d2ccd[_0x416779(0xae)](0x190)[_0x416779(0x97)]({'error':'No\x20valid\x20fields\x20to\x20update'});const _0x4662f9=await database_1[_0x416779(0x84)][_0x416779(0x91)][_0x416779(0x78)]({'where':{'id':_0x2a3fcf},'data':_0x503641});console[_0x416779(0x8f)]('✅\x20Internal\x20API:\x20Payment\x20'+_0x2a3fcf+_0x416779(0x76));if(_0x503641[_0x416779(0xae)]===_0x416779(0x9c)){console[_0x416779(0x8f)](_0x416779(0x6a)+_0x2a3fcf+_0x416779(0x8a));try{const {WebhookService:_0xaa86c4}=await Promise[_0x416779(0x7f)]()['then'](()=>__importStar(require('../services/webhookService'))),_0x4f2443=new _0xaa86c4(),_0x3b1ab0=await database_1[_0x416779(0x84)]['payment']['findUnique']({'where':{'id':_0x2a3fcf},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x3b1ab0&&console['log'](_0x416779(0x99)+_0x2a3fcf);}catch(_0xdd022f){console[_0x416779(0x71)]('Error\x20sending\x20webhook\x20notification:',_0xdd022f);}}_0x2d2ccd[_0x416779(0x97)]({'success':!![],'payment':{'id':_0x4662f9['id'],'status':_0x4662f9[_0x416779(0xae)]}});}catch(_0xa88c6e){console['error']('Internal\x20API\x20error\x20updating\x20payment:',_0xa88c6e),_0x2d2ccd[_0x416779(0xae)](0x1f4)['json']({'error':_0x416779(0xac)});}}),router[a25_0x3f1be3(0x88)]('/health',(_0x476dac,_0x493d99)=>{const _0x339b16=a25_0x3f1be3;_0x493d99['json']({'status':'ok','timestamp':new Date()[_0x339b16(0x6d)]()});}),exports['default']=router;