'use strict';function a25_0x3030(){const _0x5e1966=['card_last4','payment','resolve','PAID','gateway_payment_id','getOwnPropertyNames','writable','log','Internal\x20API\x20error\x20getting\x20payment:','607614hJUlai','paymentMethod','cardLast4','findUnique','entries','failureMessage','error','currency','express','then','failure_message','paidAt','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','__setModuleDefault','50841egxtws','hasOwnProperty','defineProperty','payment_method','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','keys','üéâ\x20Payment\x20','params','/payments/:id/update','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','\x20updated\x20successfully','configurable','json','31340PaSfRH','Missing\x20or\x20invalid\x20authorization\x20header','string','gatewayPaymentId','409112Aehges','substring','\x20with\x20gateway\x20settings','8zMqQgg','/health','call','Bearer\x20','status','shop','1185678nwvrIY','../config/database','Internal\x20API\x20error\x20updating\x20payment:','Invalid\x20internal\x20API\x20key','Internal\x20server\x20error','20jZaihO','Payment\x20not\x20found','includes','__esModule','__importDefault','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','prototype','Error\x20sending\x20webhook\x20notification:','create','patch','6426510xjEtmU','get','Router','/payments/:id/gateway-settings','35RJeSdZ','getOwnPropertyDescriptor','No\x20valid\x20fields\x20to\x20update','body','12910DgvwZr','default','__importStar','length','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20'];a25_0x3030=function(){return _0x5e1966;};return a25_0x3030();}const a25_0x519a57=a25_0xb50b;(function(_0x2b763a,_0x3f2624){const _0x5cfd7c=a25_0xb50b,_0x3a4860=_0x2b763a();while(!![]){try{const _0x320ba5=parseInt(_0x5cfd7c(0x14f))/0x1*(parseInt(_0x5cfd7c(0x13d))/0x2)+parseInt(_0x5cfd7c(0x15d))/0x3+-parseInt(_0x5cfd7c(0x132))/0x4*(parseInt(_0x5cfd7c(0x178))/0x5)+parseInt(_0x5cfd7c(0x138))/0x6+parseInt(_0x5cfd7c(0x14b))/0x7*(parseInt(_0x5cfd7c(0x17c))/0x8)+parseInt(_0x5cfd7c(0x16b))/0x9+-parseInt(_0x5cfd7c(0x147))/0xa;if(_0x320ba5===_0x3f2624)break;else _0x3a4860['push'](_0x3a4860['shift']());}catch(_0x1d3b22){_0x3a4860['push'](_0x3a4860['shift']());}}}(a25_0x3030,0x210f0));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x2930ba,_0x1ab7f6,_0x2a017d,_0x24de06){const _0x2c239f=a25_0xb50b;if(_0x24de06===undefined)_0x24de06=_0x2a017d;var _0x539858=Object[_0x2c239f(0x14c)](_0x1ab7f6,_0x2a017d);(!_0x539858||(_0x2c239f(0x148)in _0x539858?!_0x1ab7f6[_0x2c239f(0x140)]:_0x539858[_0x2c239f(0x15a)]||_0x539858[_0x2c239f(0x176)]))&&(_0x539858={'enumerable':!![],'get':function(){return _0x1ab7f6[_0x2a017d];}}),Object[_0x2c239f(0x16d)](_0x2930ba,_0x24de06,_0x539858);}:function(_0x178ce6,_0x26c741,_0xe65ead,_0x97485c){if(_0x97485c===undefined)_0x97485c=_0xe65ead;_0x178ce6[_0x97485c]=_0x26c741[_0xe65ead];}),__setModuleDefault=this&&this[a25_0x519a57(0x16a)]||(Object[a25_0x519a57(0x145)]?function(_0x2a3e98,_0x5a5911){const _0x2407be=a25_0x519a57;Object['defineProperty'](_0x2a3e98,_0x2407be(0x150),{'enumerable':!![],'value':_0x5a5911});}:function(_0x2fcbd1,_0x2bf417){const _0x48b028=a25_0x519a57;_0x2fcbd1[_0x48b028(0x150)]=_0x2bf417;}),__importStar=this&&this[a25_0x519a57(0x151)]||(function(){var _0x11e654=function(_0x30b44f){const _0x10aa44=a25_0xb50b;return _0x11e654=Object[_0x10aa44(0x159)]||function(_0x16f2bd){const _0x432f08=_0x10aa44;var _0x196450=[];for(var _0x16034a in _0x16f2bd)if(Object[_0x432f08(0x143)][_0x432f08(0x16c)][_0x432f08(0x134)](_0x16f2bd,_0x16034a))_0x196450[_0x196450[_0x432f08(0x152)]]=_0x16034a;return _0x196450;},_0x11e654(_0x30b44f);};return function(_0x56e716){const _0x3c5e1a=a25_0xb50b;if(_0x56e716&&_0x56e716[_0x3c5e1a(0x140)])return _0x56e716;var _0xfbb48f={};if(_0x56e716!=null){for(var _0x471f8b=_0x11e654(_0x56e716),_0x29685b=0x0;_0x29685b<_0x471f8b['length'];_0x29685b++)if(_0x471f8b[_0x29685b]!==_0x3c5e1a(0x150))__createBinding(_0xfbb48f,_0x56e716,_0x471f8b[_0x29685b]);}return __setModuleDefault(_0xfbb48f,_0x56e716),_0xfbb48f;};}()),__importDefault=this&&this[a25_0x519a57(0x141)]||function(_0xe5d27f){return _0xe5d27f&&_0xe5d27f['__esModule']?_0xe5d27f:{'default':_0xe5d27f};};Object[a25_0x519a57(0x16d)](exports,a25_0x519a57(0x140),{'value':!![]});function a25_0xb50b(_0x2f5e32,_0x1d0b14){const _0x303015=a25_0x3030();return a25_0xb50b=function(_0xb50b05,_0x41434b){_0xb50b05=_0xb50b05-0x131;let _0x4db43e=_0x303015[_0xb50b05];return _0x4db43e;},a25_0xb50b(_0x2f5e32,_0x1d0b14);}const express_1=require(a25_0x519a57(0x165)),database_1=__importDefault(require(a25_0x519a57(0x139))),router=(0x0,express_1[a25_0x519a57(0x149)])(),verifyInternalApiKey=(_0x2e67da,_0x1ad1bc,_0x528bb4)=>{const _0x1819dd=a25_0x519a57,_0x3944a7=_0x2e67da['headers']['authorization'];if(!_0x3944a7||!_0x3944a7['startsWith'](_0x1819dd(0x135)))return _0x1ad1bc['status'](0x191)[_0x1819dd(0x177)]({'error':_0x1819dd(0x179)});const _0x18df67=_0x3944a7[_0x1819dd(0x17d)](0x7);if(_0x18df67!=='internal-api-key')return _0x1ad1bc['status'](0x191)[_0x1819dd(0x177)]({'error':_0x1819dd(0x13b)});_0x528bb4();};router[a25_0x519a57(0x148)](a25_0x519a57(0x14a),verifyInternalApiKey,async(_0x1a8857,_0x3d8e35)=>{const _0x13cac6=a25_0x519a57;try{const {id:_0x18e5a5}=_0x1a8857[_0x13cac6(0x172)];console['log'](_0x13cac6(0x142)+_0x18e5a5+_0x13cac6(0x131));const _0x33d87e=await database_1[_0x13cac6(0x150)][_0x13cac6(0x155)][_0x13cac6(0x160)]({'where':{'id':_0x18e5a5},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x33d87e)return _0x3d8e35[_0x13cac6(0x136)](0x194)[_0x13cac6(0x177)]({'error':_0x13cac6(0x13e)});console['log'](_0x13cac6(0x174)+_0x33d87e['shop']['username']),_0x3d8e35[_0x13cac6(0x177)]({'id':_0x33d87e['id'],'amount':_0x33d87e['amount'],'currency':_0x33d87e[_0x13cac6(0x164)],'status':_0x33d87e[_0x13cac6(0x136)],'orderId':_0x33d87e['orderId'],'shop':_0x33d87e[_0x13cac6(0x137)]});}catch(_0x40068f){console[_0x13cac6(0x163)](_0x13cac6(0x15c),_0x40068f),_0x3d8e35[_0x13cac6(0x136)](0x1f4)['json']({'error':_0x13cac6(0x13c)});}}),router[a25_0x519a57(0x146)](a25_0x519a57(0x173),verifyInternalApiKey,async(_0x278c31,_0x357d69)=>{const _0x23508e=a25_0x519a57;try{const {id:_0x489c1d}=_0x278c31[_0x23508e(0x172)],_0x240d4f=_0x278c31[_0x23508e(0x14e)];console[_0x23508e(0x15b)](_0x23508e(0x153)+_0x489c1d,_0x240d4f);const _0x3e411e=[_0x23508e(0x136),_0x23508e(0x158),_0x23508e(0x17b),_0x23508e(0x154),_0x23508e(0x15f),_0x23508e(0x16e),_0x23508e(0x15e),'paid_at',_0x23508e(0x168),_0x23508e(0x167),_0x23508e(0x162)],_0x45e291={};for(const [_0x6f2d1d,_0x323842]of Object[_0x23508e(0x161)](_0x240d4f)){if(_0x3e411e[_0x23508e(0x13f)](_0x6f2d1d)){let _0x3ba4d7=_0x6f2d1d;if(_0x6f2d1d===_0x23508e(0x158)||_0x6f2d1d==='gatewayPaymentId')_0x3ba4d7=_0x23508e(0x17b);else{if(_0x6f2d1d==='card_last4'||_0x6f2d1d===_0x23508e(0x15f))_0x3ba4d7=_0x23508e(0x15f);else{if(_0x6f2d1d===_0x23508e(0x16e)||_0x6f2d1d===_0x23508e(0x15e))_0x3ba4d7='paymentMethod';else{if(_0x6f2d1d==='paid_at'||_0x6f2d1d==='paidAt')_0x3ba4d7=_0x23508e(0x168);else(_0x6f2d1d===_0x23508e(0x167)||_0x6f2d1d===_0x23508e(0x162))&&(_0x3ba4d7=_0x23508e(0x162));}}}_0x3ba4d7===_0x23508e(0x168)&&typeof _0x323842===_0x23508e(0x17a)?_0x45e291[_0x3ba4d7]=new Date(_0x323842):_0x45e291[_0x3ba4d7]=_0x323842;}}if(Object[_0x23508e(0x170)](_0x45e291)['length']===0x0)return _0x357d69[_0x23508e(0x136)](0x190)[_0x23508e(0x177)]({'error':_0x23508e(0x14d)});const _0x4d3cc2=await database_1[_0x23508e(0x150)]['payment']['update']({'where':{'id':_0x489c1d},'data':_0x45e291});console[_0x23508e(0x15b)]('‚úÖ\x20Internal\x20API:\x20Payment\x20'+_0x489c1d+_0x23508e(0x175));if(_0x45e291[_0x23508e(0x136)]===_0x23508e(0x157)){console[_0x23508e(0x15b)](_0x23508e(0x171)+_0x489c1d+_0x23508e(0x16f));try{const {WebhookService:_0x4e812d}=await Promise[_0x23508e(0x156)]()[_0x23508e(0x166)](()=>__importStar(require('../services/webhookService'))),_0x54977f=new _0x4e812d(),_0x590ea0=await database_1[_0x23508e(0x150)]['payment'][_0x23508e(0x160)]({'where':{'id':_0x489c1d},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x590ea0&&console[_0x23508e(0x15b)](_0x23508e(0x169)+_0x489c1d);}catch(_0x449895){console[_0x23508e(0x163)](_0x23508e(0x144),_0x449895);}}_0x357d69['json']({'success':!![],'payment':{'id':_0x4d3cc2['id'],'status':_0x4d3cc2[_0x23508e(0x136)]}});}catch(_0x367f80){console[_0x23508e(0x163)](_0x23508e(0x13a),_0x367f80),_0x357d69[_0x23508e(0x136)](0x1f4)['json']({'error':_0x23508e(0x13c)});}}),router[a25_0x519a57(0x148)](a25_0x519a57(0x133),(_0x1b1316,_0x402190)=>{const _0x5503f1=a25_0x519a57;_0x402190[_0x5503f1(0x177)]({'status':'ok','timestamp':new Date()['toISOString']()});}),exports[a25_0x519a57(0x150)]=router;