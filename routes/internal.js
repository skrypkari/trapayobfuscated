'use strict';const a26_0x27a370=a26_0x1d8f;(function(_0x4ea008,_0x172198){const _0x3a1cf7=a26_0x1d8f,_0x2e7a54=_0x4ea008();while(!![]){try{const _0x231f81=-parseInt(_0x3a1cf7(0x1d1))/0x1+parseInt(_0x3a1cf7(0x1e2))/0x2*(parseInt(_0x3a1cf7(0x1d5))/0x3)+parseInt(_0x3a1cf7(0x20e))/0x4*(-parseInt(_0x3a1cf7(0x1e4))/0x5)+-parseInt(_0x3a1cf7(0x1e5))/0x6+-parseInt(_0x3a1cf7(0x20c))/0x7+parseInt(_0x3a1cf7(0x208))/0x8+parseInt(_0x3a1cf7(0x1db))/0x9;if(_0x231f81===_0x172198)break;else _0x2e7a54['push'](_0x2e7a54['shift']());}catch(_0x4a9b25){_0x2e7a54['push'](_0x2e7a54['shift']());}}}(a26_0x257b,0x69083));function a26_0x1d8f(_0x1c2058,_0x87894d){const _0x257ba6=a26_0x257b();return a26_0x1d8f=function(_0x1d8f52,_0x20e586){_0x1d8f52=_0x1d8f52-0x1cd;let _0x2fe89f=_0x257ba6[_0x1d8f52];return _0x2fe89f;},a26_0x1d8f(_0x1c2058,_0x87894d);}function a26_0x257b(){const _0x550279=['/health','paidAt','../config/database','toISOString','getOwnPropertyDescriptor','payment','string','gateway_payment_id','status','No\x20valid\x20fields\x20to\x20update','getOwnPropertyNames','error','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','Payment\x20not\x20found','paymentMethod','prototype','username','Internal\x20API\x20error\x20updating\x20payment:','findUnique','__importDefault','Bearer\x20','\x20updated\x20successfully','startsWith','__setModuleDefault','create','Invalid\x20internal\x20API\x20key','cardLast4','Internal\x20server\x20error','params','payment_method','__createBinding','3432192jAjNCi','call','then','get','5436886gakHxy','gatewayPaymentId','1688DtkKHy','default','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','writable','authorization','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','length','keys','failure_message','82453cqwTDP','json','update','amount','114swupqR','defineProperty','configurable','__esModule','log','currency','9220716avUokq','patch','resolve','PAID','failureMessage','../services/webhookService','paid_at','18120sFSXTf','express','5930zZCMSs','47844VIQzvr','Internal\x20API\x20error\x20getting\x20payment:','card_last4','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20'];a26_0x257b=function(){return _0x550279;};return a26_0x257b();}var __createBinding=this&&this[a26_0x27a370(0x207)]||(Object[a26_0x27a370(0x201)]?function(_0x3bea7b,_0x2e3049,_0xe997a9,_0x4f6be3){const _0x1a61ed=a26_0x27a370;if(_0x4f6be3===undefined)_0x4f6be3=_0xe997a9;var _0x202ced=Object[_0x1a61ed(0x1ed)](_0x2e3049,_0xe997a9);(!_0x202ced||(_0x1a61ed(0x20b)in _0x202ced?!_0x2e3049['__esModule']:_0x202ced[_0x1a61ed(0x211)]||_0x202ced[_0x1a61ed(0x1d7)]))&&(_0x202ced={'enumerable':!![],'get':function(){return _0x2e3049[_0xe997a9];}}),Object[_0x1a61ed(0x1d6)](_0x3bea7b,_0x4f6be3,_0x202ced);}:function(_0x30ae49,_0x4f2761,_0x5b7602,_0x52bf9f){if(_0x52bf9f===undefined)_0x52bf9f=_0x5b7602;_0x30ae49[_0x52bf9f]=_0x4f2761[_0x5b7602];}),__setModuleDefault=this&&this[a26_0x27a370(0x200)]||(Object[a26_0x27a370(0x201)]?function(_0x93d38c,_0x298ffc){const _0x1b42f6=a26_0x27a370;Object[_0x1b42f6(0x1d6)](_0x93d38c,'default',{'enumerable':!![],'value':_0x298ffc});}:function(_0xed70d0,_0x1b9155){_0xed70d0['default']=_0x1b9155;}),__importStar=this&&this['__importStar']||(function(){var _0x469d67=function(_0x4ea2a1){const _0x168c92=a26_0x1d8f;return _0x469d67=Object[_0x168c92(0x1f3)]||function(_0x2afedd){const _0x1edfef=_0x168c92;var _0x23b56f=[];for(var _0x1f7d2a in _0x2afedd)if(Object[_0x1edfef(0x1f8)]['hasOwnProperty'][_0x1edfef(0x209)](_0x2afedd,_0x1f7d2a))_0x23b56f[_0x23b56f[_0x1edfef(0x1ce)]]=_0x1f7d2a;return _0x23b56f;},_0x469d67(_0x4ea2a1);};return function(_0x4fb041){const _0x29eb4f=a26_0x1d8f;if(_0x4fb041&&_0x4fb041[_0x29eb4f(0x1d8)])return _0x4fb041;var _0x3e987a={};if(_0x4fb041!=null){for(var _0x306811=_0x469d67(_0x4fb041),_0x306c70=0x0;_0x306c70<_0x306811[_0x29eb4f(0x1ce)];_0x306c70++)if(_0x306811[_0x306c70]!==_0x29eb4f(0x20f))__createBinding(_0x3e987a,_0x4fb041,_0x306811[_0x306c70]);}return __setModuleDefault(_0x3e987a,_0x4fb041),_0x3e987a;};}()),__importDefault=this&&this[a26_0x27a370(0x1fc)]||function(_0x17dd9a){const _0x47e37f=a26_0x27a370;return _0x17dd9a&&_0x17dd9a[_0x47e37f(0x1d8)]?_0x17dd9a:{'default':_0x17dd9a};};Object[a26_0x27a370(0x1d6)](exports,'__esModule',{'value':!![]});const express_1=require(a26_0x27a370(0x1e3)),database_1=__importDefault(require(a26_0x27a370(0x1eb))),router=(0x0,express_1['Router'])(),verifyInternalApiKey=(_0x2fd31d,_0x3ab51f,_0x4d3d2a)=>{const _0x1c6c88=a26_0x27a370,_0x315708=_0x2fd31d['headers'][_0x1c6c88(0x212)];if(!_0x315708||!_0x315708[_0x1c6c88(0x1ff)](_0x1c6c88(0x1fd)))return _0x3ab51f['status'](0x191)[_0x1c6c88(0x1d2)]({'error':'Missing\x20or\x20invalid\x20authorization\x20header'});const _0x5f5566=_0x315708['substring'](0x7);if(_0x5f5566!=='internal-api-key')return _0x3ab51f['status'](0x191)[_0x1c6c88(0x1d2)]({'error':_0x1c6c88(0x202)});_0x4d3d2a();};router[a26_0x27a370(0x20b)]('/payments/:id/gateway-settings',verifyInternalApiKey,async(_0x48234f,_0x2b0d9f)=>{const _0xf7d91e=a26_0x27a370;try{const {id:_0x16d45e}=_0x48234f[_0xf7d91e(0x205)];console['log'](_0xf7d91e(0x210)+_0x16d45e+'\x20with\x20gateway\x20settings');const _0x396a35=await database_1[_0xf7d91e(0x20f)][_0xf7d91e(0x1ee)][_0xf7d91e(0x1fb)]({'where':{'id':_0x16d45e},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x396a35)return _0x2b0d9f[_0xf7d91e(0x1f1)](0x194)[_0xf7d91e(0x1d2)]({'error':_0xf7d91e(0x1f6)});console[_0xf7d91e(0x1d9)]('‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20'+_0x396a35['shop'][_0xf7d91e(0x1f9)]),_0x2b0d9f[_0xf7d91e(0x1d2)]({'id':_0x396a35['id'],'amount':_0x396a35[_0xf7d91e(0x1d4)],'currency':_0x396a35[_0xf7d91e(0x1da)],'status':_0x396a35[_0xf7d91e(0x1f1)],'orderId':_0x396a35['orderId'],'shop':_0x396a35['shop']});}catch(_0x49649b){console[_0xf7d91e(0x1f4)](_0xf7d91e(0x1e6),_0x49649b),_0x2b0d9f['status'](0x1f4)[_0xf7d91e(0x1d2)]({'error':'Internal\x20server\x20error'});}}),router[a26_0x27a370(0x1dc)]('/payments/:id/update',verifyInternalApiKey,async(_0x522c73,_0x2db835)=>{const _0xd8c478=a26_0x27a370;try{const {id:_0x2b9ea4}=_0x522c73[_0xd8c478(0x205)],_0x51c2dc=_0x522c73['body'];console['log'](_0xd8c478(0x1e8)+_0x2b9ea4,_0x51c2dc);const _0x5e1136=[_0xd8c478(0x1f1),'gateway_payment_id',_0xd8c478(0x20d),_0xd8c478(0x1e7),_0xd8c478(0x203),_0xd8c478(0x206),_0xd8c478(0x1f7),_0xd8c478(0x1e1),'paidAt',_0xd8c478(0x1d0),_0xd8c478(0x1df)],_0xbcf7f3={};for(const [_0x24da4c,_0x481273]of Object['entries'](_0x51c2dc)){if(_0x5e1136['includes'](_0x24da4c)){let _0x585e04=_0x24da4c;if(_0x24da4c===_0xd8c478(0x1f0)||_0x24da4c==='gatewayPaymentId')_0x585e04=_0xd8c478(0x20d);else{if(_0x24da4c==='card_last4'||_0x24da4c==='cardLast4')_0x585e04='cardLast4';else{if(_0x24da4c===_0xd8c478(0x206)||_0x24da4c===_0xd8c478(0x1f7))_0x585e04=_0xd8c478(0x1f7);else{if(_0x24da4c==='paid_at'||_0x24da4c===_0xd8c478(0x1ea))_0x585e04=_0xd8c478(0x1ea);else(_0x24da4c===_0xd8c478(0x1d0)||_0x24da4c===_0xd8c478(0x1df))&&(_0x585e04=_0xd8c478(0x1df));}}}_0x585e04===_0xd8c478(0x1ea)&&typeof _0x481273===_0xd8c478(0x1ef)?_0xbcf7f3[_0x585e04]=new Date(_0x481273):_0xbcf7f3[_0x585e04]=_0x481273;}}if(Object[_0xd8c478(0x1cf)](_0xbcf7f3)[_0xd8c478(0x1ce)]===0x0)return _0x2db835[_0xd8c478(0x1f1)](0x190)[_0xd8c478(0x1d2)]({'error':_0xd8c478(0x1f2)});const _0x2d9444=await database_1['default'][_0xd8c478(0x1ee)][_0xd8c478(0x1d3)]({'where':{'id':_0x2b9ea4},'data':_0xbcf7f3});console['log']('‚úÖ\x20Internal\x20API:\x20Payment\x20'+_0x2b9ea4+_0xd8c478(0x1fe));if(_0xbcf7f3[_0xd8c478(0x1f1)]===_0xd8c478(0x1de)){console['log']('üéâ\x20Payment\x20'+_0x2b9ea4+_0xd8c478(0x1f5));try{const {WebhookService:_0x496f12}=await Promise[_0xd8c478(0x1dd)]()[_0xd8c478(0x20a)](()=>__importStar(require(_0xd8c478(0x1e0)))),_0x4c8c5f=new _0x496f12(),_0x547501=await database_1['default'][_0xd8c478(0x1ee)][_0xd8c478(0x1fb)]({'where':{'id':_0x2b9ea4},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x547501&&console['log'](_0xd8c478(0x1cd)+_0x2b9ea4);}catch(_0x1181c9){console[_0xd8c478(0x1f4)]('Error\x20sending\x20webhook\x20notification:',_0x1181c9);}}_0x2db835[_0xd8c478(0x1d2)]({'success':!![],'payment':{'id':_0x2d9444['id'],'status':_0x2d9444['status']}});}catch(_0x5a4342){console[_0xd8c478(0x1f4)](_0xd8c478(0x1fa),_0x5a4342),_0x2db835[_0xd8c478(0x1f1)](0x1f4)['json']({'error':_0xd8c478(0x204)});}}),router[a26_0x27a370(0x20b)](a26_0x27a370(0x1e9),(_0x1c3fac,_0x28a282)=>{const _0x564365=a26_0x27a370;_0x28a282[_0x564365(0x1d2)]({'status':'ok','timestamp':new Date()[_0x564365(0x1ec)]()});}),exports[a26_0x27a370(0x20f)]=router;