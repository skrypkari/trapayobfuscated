'use strict';const a25_0x3535b0=a25_0x329b;(function(_0x397818,_0x5a9060){const _0x44250f=a25_0x329b,_0x391a3e=_0x397818();while(!![]){try{const _0x43eb6d=-parseInt(_0x44250f(0x182))/0x1*(parseInt(_0x44250f(0x17a))/0x2)+parseInt(_0x44250f(0x151))/0x3*(-parseInt(_0x44250f(0x196))/0x4)+-parseInt(_0x44250f(0x165))/0x5*(-parseInt(_0x44250f(0x175))/0x6)+-parseInt(_0x44250f(0x180))/0x7*(parseInt(_0x44250f(0x188))/0x8)+-parseInt(_0x44250f(0x15d))/0x9*(-parseInt(_0x44250f(0x170))/0xa)+-parseInt(_0x44250f(0x152))/0xb+parseInt(_0x44250f(0x155))/0xc*(parseInt(_0x44250f(0x189))/0xd);if(_0x43eb6d===_0x5a9060)break;else _0x391a3e['push'](_0x391a3e['shift']());}catch(_0x295e1a){_0x391a3e['push'](_0x391a3e['shift']());}}}(a25_0x2bd5,0x41188));function a25_0x2bd5(){const _0x1b862e=['üéâ\x20Payment\x20','params','426CiRBia','‚úÖ\x20Internal\x20API:\x20Payment\x20','payment_method','failure_message','length','toISOString','70mCfXQm','patch','1897CRNjyC','Missing\x20or\x20invalid\x20authorization\x20header','includes','log','Error\x20sending\x20webhook\x20notification:','headers','166072xgaaNZ','6955VIZKmi','getOwnPropertyNames','__importStar','json','substring','PAID','Internal\x20server\x20error','__createBinding','gateway_payment_id','payment','defineProperty','then','default','8NEpOvV','paymentMethod','cardLast4','express','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','get','../services/webhookService','__importDefault','389040QvfRLE','4499385IYYRYY','/payments/:id/gateway-settings','paidAt','23916EEzzar','entries','gatewayPaymentId','configurable','resolve','No\x20valid\x20fields\x20to\x20update','card_last4','amount','504WbiCwt','__setModuleDefault','status','error','findUnique','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','paid_at','445rXOoxy','update','Invalid\x20internal\x20API\x20key','authorization','__esModule','shop','hasOwnProperty','orderId','body','../config/database','failureMessage','68260JnYyIw','keys','startsWith','create','getOwnPropertyDescriptor','6618IwBoYQ','Router','\x20updated\x20successfully'];a25_0x2bd5=function(){return _0x1b862e;};return a25_0x2bd5();}function a25_0x329b(_0x323b93,_0x4eac65){const _0x2bd569=a25_0x2bd5();return a25_0x329b=function(_0x329b1a,_0x1af64f){_0x329b1a=_0x329b1a-0x151;let _0x4b3733=_0x2bd569[_0x329b1a];return _0x4b3733;},a25_0x329b(_0x323b93,_0x4eac65);}var __createBinding=this&&this[a25_0x3535b0(0x190)]||(Object[a25_0x3535b0(0x173)]?function(_0x31d3ec,_0xd62e8f,_0x43752e,_0x10f275){const _0x4104c6=a25_0x3535b0;if(_0x10f275===undefined)_0x10f275=_0x43752e;var _0x4f4001=Object[_0x4104c6(0x174)](_0xd62e8f,_0x43752e);(!_0x4f4001||(_0x4104c6(0x19b)in _0x4f4001?!_0xd62e8f[_0x4104c6(0x169)]:_0x4f4001['writable']||_0x4f4001[_0x4104c6(0x158)]))&&(_0x4f4001={'enumerable':!![],'get':function(){return _0xd62e8f[_0x43752e];}}),Object[_0x4104c6(0x193)](_0x31d3ec,_0x10f275,_0x4f4001);}:function(_0x153a1c,_0xb749a7,_0xb3b5e6,_0x2b2a52){if(_0x2b2a52===undefined)_0x2b2a52=_0xb3b5e6;_0x153a1c[_0x2b2a52]=_0xb749a7[_0xb3b5e6];}),__setModuleDefault=this&&this[a25_0x3535b0(0x15e)]||(Object[a25_0x3535b0(0x173)]?function(_0x5c8f50,_0x5dc1b0){const _0x138884=a25_0x3535b0;Object[_0x138884(0x193)](_0x5c8f50,'default',{'enumerable':!![],'value':_0x5dc1b0});}:function(_0x5ff5e9,_0x43c2c6){const _0x1794d=a25_0x3535b0;_0x5ff5e9[_0x1794d(0x195)]=_0x43c2c6;}),__importStar=this&&this[a25_0x3535b0(0x18b)]||(function(){var _0x5079be=function(_0x3f9913){const _0xbe10fa=a25_0x329b;return _0x5079be=Object[_0xbe10fa(0x18a)]||function(_0x5bed9c){const _0x228e57=_0xbe10fa;var _0x3b714d=[];for(var _0x1ca9c0 in _0x5bed9c)if(Object['prototype'][_0x228e57(0x16b)]['call'](_0x5bed9c,_0x1ca9c0))_0x3b714d[_0x3b714d[_0x228e57(0x17e)]]=_0x1ca9c0;return _0x3b714d;},_0x5079be(_0x3f9913);};return function(_0x2c808b){const _0x3e97dc=a25_0x329b;if(_0x2c808b&&_0x2c808b[_0x3e97dc(0x169)])return _0x2c808b;var _0x1f9f95={};if(_0x2c808b!=null){for(var _0x4bbee2=_0x5079be(_0x2c808b),_0x1d3855=0x0;_0x1d3855<_0x4bbee2[_0x3e97dc(0x17e)];_0x1d3855++)if(_0x4bbee2[_0x1d3855]!=='default')__createBinding(_0x1f9f95,_0x2c808b,_0x4bbee2[_0x1d3855]);}return __setModuleDefault(_0x1f9f95,_0x2c808b),_0x1f9f95;};}()),__importDefault=this&&this[a25_0x3535b0(0x19d)]||function(_0x5c8c2b){const _0x1534b1=a25_0x3535b0;return _0x5c8c2b&&_0x5c8c2b[_0x1534b1(0x169)]?_0x5c8c2b:{'default':_0x5c8c2b};};Object['defineProperty'](exports,a25_0x3535b0(0x169),{'value':!![]});const express_1=require(a25_0x3535b0(0x199)),database_1=__importDefault(require(a25_0x3535b0(0x16e))),router=(0x0,express_1[a25_0x3535b0(0x176)])(),verifyInternalApiKey=(_0x1b088e,_0x500aab,_0x3d8244)=>{const _0x2b9355=a25_0x3535b0,_0x1c16f2=_0x1b088e[_0x2b9355(0x187)][_0x2b9355(0x168)];if(!_0x1c16f2||!_0x1c16f2[_0x2b9355(0x172)]('Bearer\x20'))return _0x500aab[_0x2b9355(0x15f)](0x191)[_0x2b9355(0x18c)]({'error':_0x2b9355(0x183)});const _0x15a97a=_0x1c16f2[_0x2b9355(0x18d)](0x7);if(_0x15a97a!=='internal-api-key')return _0x500aab[_0x2b9355(0x15f)](0x191)['json']({'error':_0x2b9355(0x167)});_0x3d8244();};router[a25_0x3535b0(0x19b)](a25_0x3535b0(0x153),verifyInternalApiKey,async(_0x369d28,_0x506bca)=>{const _0x97ffbf=a25_0x3535b0;try{const {id:_0x249ccf}=_0x369d28[_0x97ffbf(0x179)];console['log'](_0x97ffbf(0x163)+_0x249ccf+'\x20with\x20gateway\x20settings');const _0x3249ba=await database_1[_0x97ffbf(0x195)][_0x97ffbf(0x192)][_0x97ffbf(0x161)]({'where':{'id':_0x249ccf},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x3249ba)return _0x506bca['status'](0x194)['json']({'error':'Payment\x20not\x20found'});console[_0x97ffbf(0x185)](_0x97ffbf(0x19a)+_0x3249ba[_0x97ffbf(0x16a)]['username']),_0x506bca[_0x97ffbf(0x18c)]({'id':_0x3249ba['id'],'amount':_0x3249ba[_0x97ffbf(0x15c)],'currency':_0x3249ba['currency'],'status':_0x3249ba['status'],'orderId':_0x3249ba[_0x97ffbf(0x16c)],'shop':_0x3249ba['shop']});}catch(_0x37298c){console[_0x97ffbf(0x160)]('Internal\x20API\x20error\x20getting\x20payment:',_0x37298c),_0x506bca[_0x97ffbf(0x15f)](0x1f4)[_0x97ffbf(0x18c)]({'error':_0x97ffbf(0x18f)});}}),router[a25_0x3535b0(0x181)]('/payments/:id/update',verifyInternalApiKey,async(_0x48b64c,_0x1d8b41)=>{const _0x1cdbd3=a25_0x3535b0;try{const {id:_0x139147}=_0x48b64c[_0x1cdbd3(0x179)],_0x5e0246=_0x48b64c[_0x1cdbd3(0x16d)];console[_0x1cdbd3(0x185)]('üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20'+_0x139147,_0x5e0246);const _0x362645=[_0x1cdbd3(0x15f),_0x1cdbd3(0x191),_0x1cdbd3(0x157),_0x1cdbd3(0x15b),_0x1cdbd3(0x198),_0x1cdbd3(0x17c),'paymentMethod',_0x1cdbd3(0x164),_0x1cdbd3(0x154),_0x1cdbd3(0x17d),'failureMessage'],_0x2e68c4={};for(const [_0x23b08b,_0x983bc9]of Object[_0x1cdbd3(0x156)](_0x5e0246)){if(_0x362645[_0x1cdbd3(0x184)](_0x23b08b)){let _0x4f5bb3=_0x23b08b;if(_0x23b08b===_0x1cdbd3(0x191)||_0x23b08b==='gatewayPaymentId')_0x4f5bb3=_0x1cdbd3(0x157);else{if(_0x23b08b==='card_last4'||_0x23b08b==='cardLast4')_0x4f5bb3=_0x1cdbd3(0x198);else{if(_0x23b08b==='payment_method'||_0x23b08b===_0x1cdbd3(0x197))_0x4f5bb3=_0x1cdbd3(0x197);else{if(_0x23b08b==='paid_at'||_0x23b08b===_0x1cdbd3(0x154))_0x4f5bb3=_0x1cdbd3(0x154);else(_0x23b08b===_0x1cdbd3(0x17d)||_0x23b08b===_0x1cdbd3(0x16f))&&(_0x4f5bb3=_0x1cdbd3(0x16f));}}}_0x4f5bb3===_0x1cdbd3(0x154)&&typeof _0x983bc9==='string'?_0x2e68c4[_0x4f5bb3]=new Date(_0x983bc9):_0x2e68c4[_0x4f5bb3]=_0x983bc9;}}if(Object[_0x1cdbd3(0x171)](_0x2e68c4)[_0x1cdbd3(0x17e)]===0x0)return _0x1d8b41['status'](0x190)['json']({'error':_0x1cdbd3(0x15a)});const _0x28ba67=await database_1[_0x1cdbd3(0x195)]['payment'][_0x1cdbd3(0x166)]({'where':{'id':_0x139147},'data':_0x2e68c4});console[_0x1cdbd3(0x185)](_0x1cdbd3(0x17b)+_0x139147+_0x1cdbd3(0x177));if(_0x2e68c4[_0x1cdbd3(0x15f)]===_0x1cdbd3(0x18e)){console[_0x1cdbd3(0x185)](_0x1cdbd3(0x178)+_0x139147+'\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing');try{const {WebhookService:_0x4bfcf2}=await Promise[_0x1cdbd3(0x159)]()[_0x1cdbd3(0x194)](()=>__importStar(require(_0x1cdbd3(0x19c)))),_0x427c97=new _0x4bfcf2(),_0x425aa2=await database_1[_0x1cdbd3(0x195)][_0x1cdbd3(0x192)][_0x1cdbd3(0x161)]({'where':{'id':_0x139147},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x425aa2&&console[_0x1cdbd3(0x185)](_0x1cdbd3(0x162)+_0x139147);}catch(_0x58d044){console[_0x1cdbd3(0x160)](_0x1cdbd3(0x186),_0x58d044);}}_0x1d8b41[_0x1cdbd3(0x18c)]({'success':!![],'payment':{'id':_0x28ba67['id'],'status':_0x28ba67['status']}});}catch(_0x40a90d){console['error']('Internal\x20API\x20error\x20updating\x20payment:',_0x40a90d),_0x1d8b41[_0x1cdbd3(0x15f)](0x1f4)[_0x1cdbd3(0x18c)]({'error':_0x1cdbd3(0x18f)});}}),router[a25_0x3535b0(0x19b)]('/health',(_0x544ebf,_0x5ec6d0)=>{const _0x4386=a25_0x3535b0;_0x5ec6d0[_0x4386(0x18c)]({'status':'ok','timestamp':new Date()[_0x4386(0x17f)]()});}),exports[a25_0x3535b0(0x195)]=router;