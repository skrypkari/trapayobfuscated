'use strict';const a35_0x115ade=a35_0x5eb3;(function(_0x263d9b,_0x46c35d){const _0x255ac8=a35_0x5eb3,_0x5d396c=_0x263d9b();while(!![]){try{const _0x8480e3=-parseInt(_0x255ac8(0x17f))/0x1*(parseInt(_0x255ac8(0x16e))/0x2)+parseInt(_0x255ac8(0x181))/0x3*(parseInt(_0x255ac8(0x167))/0x4)+-parseInt(_0x255ac8(0x142))/0x5*(parseInt(_0x255ac8(0x149))/0x6)+parseInt(_0x255ac8(0x17e))/0x7+parseInt(_0x255ac8(0x13a))/0x8+parseInt(_0x255ac8(0x138))/0x9*(parseInt(_0x255ac8(0x15d))/0xa)+parseInt(_0x255ac8(0x166))/0xb*(-parseInt(_0x255ac8(0x179))/0xc);if(_0x8480e3===_0x46c35d)break;else _0x5d396c['push'](_0x5d396c['shift']());}catch(_0x300627){_0x5d396c['push'](_0x5d396c['shift']());}}}(a35_0x159a,0x45356));var __createBinding=this&&this[a35_0x115ade(0x177)]||(Object['create']?function(_0x30a1d7,_0x6d319c,_0x605add,_0x1b2402){const _0x279bca=a35_0x115ade;if(_0x1b2402===undefined)_0x1b2402=_0x605add;var _0x47695c=Object[_0x279bca(0x16f)](_0x6d319c,_0x605add);(!_0x47695c||(_0x279bca(0x182)in _0x47695c?!_0x6d319c[_0x279bca(0x151)]:_0x47695c[_0x279bca(0x16c)]||_0x47695c['configurable']))&&(_0x47695c={'enumerable':!![],'get':function(){return _0x6d319c[_0x605add];}}),Object[_0x279bca(0x172)](_0x30a1d7,_0x1b2402,_0x47695c);}:function(_0x19f1c5,_0x37aa58,_0x17d51f,_0x5d2c81){if(_0x5d2c81===undefined)_0x5d2c81=_0x17d51f;_0x19f1c5[_0x5d2c81]=_0x37aa58[_0x17d51f];}),__setModuleDefault=this&&this[a35_0x115ade(0x14c)]||(Object['create']?function(_0x1bc418,_0x6e683a){const _0x40a3a5=a35_0x115ade;Object[_0x40a3a5(0x172)](_0x1bc418,_0x40a3a5(0x158),{'enumerable':!![],'value':_0x6e683a});}:function(_0x95ea3d,_0x249095){_0x95ea3d['default']=_0x249095;}),__importStar=this&&this[a35_0x115ade(0x184)]||(function(){var _0x10013e=function(_0x2e4f09){const _0x50287f=a35_0x5eb3;return _0x10013e=Object[_0x50287f(0x170)]||function(_0x18ea0f){const _0x33caa4=_0x50287f;var _0x42049b=[];for(var _0x2fe0a4 in _0x18ea0f)if(Object[_0x33caa4(0x140)][_0x33caa4(0x175)][_0x33caa4(0x153)](_0x18ea0f,_0x2fe0a4))_0x42049b[_0x42049b[_0x33caa4(0x164)]]=_0x2fe0a4;return _0x42049b;},_0x10013e(_0x2e4f09);};return function(_0x41a8ec){const _0xdb6a72=a35_0x5eb3;if(_0x41a8ec&&_0x41a8ec['__esModule'])return _0x41a8ec;var _0x4c6da5={};if(_0x41a8ec!=null){for(var _0x3ccee3=_0x10013e(_0x41a8ec),_0x19b482=0x0;_0x19b482<_0x3ccee3['length'];_0x19b482++)if(_0x3ccee3[_0x19b482]!==_0xdb6a72(0x158))__createBinding(_0x4c6da5,_0x41a8ec,_0x3ccee3[_0x19b482]);}return __setModuleDefault(_0x4c6da5,_0x41a8ec),_0x4c6da5;};}()),__importDefault=this&&this[a35_0x115ade(0x145)]||function(_0xd68184){const _0x166bef=a35_0x115ade;return _0xd68184&&_0xd68184[_0x166bef(0x151)]?_0xd68184:{'default':_0xd68184};};Object[a35_0x115ade(0x172)](exports,a35_0x115ade(0x151),{'value':!![]});function a35_0x159a(){const _0xa315a6=['gatewayPaymentId','startsWith','writable','card_last4','32024Agvfyw','getOwnPropertyDescriptor','getOwnPropertyNames','then','defineProperty','ðŸ”„\x20Internal\x20API:\x20Updating\x20payment\x20','Payment\x20not\x20found','hasOwnProperty','ðŸ“¤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','__createBinding','headers','48glDiJu','log','Internal\x20API\x20error\x20updating\x20payment:','paidAt','Internal\x20server\x20error','1900766veXJwf','11eezOQu','string','108246fiZFvq','get','amount','__importStar','../config/database','payment','ðŸ”\x20Internal\x20API:\x20Getting\x20payment\x20','keys','99RPKXpJ','express','3954856sCWqqC','findUnique','../services/webhookService','body','entries','error','prototype','Missing\x20or\x20invalid\x20authorization\x20header','810555mrkFtn','Internal\x20API\x20error\x20getting\x20payment:','substring','__importDefault','username','âœ…\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','authorization','6VtsuDe','PAID','cardLast4','__setModuleDefault','params','resolve','gateway_payment_id','failure_message','__esModule','toISOString','call','shop','json','payment_method','No\x20valid\x20fields\x20to\x20update','default','includes','failureMessage','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','Error\x20sending\x20webhook\x20notification:','384840qRyTZO','Bearer\x20','paid_at','status','paymentMethod','patch','Router','length','internal-api-key','2056747njhcJf','20atGxVl','Invalid\x20internal\x20API\x20key','\x20updated\x20successfully'];a35_0x159a=function(){return _0xa315a6;};return a35_0x159a();}const express_1=require(a35_0x115ade(0x139)),database_1=__importDefault(require(a35_0x115ade(0x134))),router=(0x0,express_1[a35_0x115ade(0x163)])(),verifyInternalApiKey=(_0x4d7cb2,_0xdb6ce8,_0xe0539f)=>{const _0x3aabdc=a35_0x115ade,_0x518e93=_0x4d7cb2[_0x3aabdc(0x178)][_0x3aabdc(0x148)];if(!_0x518e93||!_0x518e93[_0x3aabdc(0x16b)](_0x3aabdc(0x15e)))return _0xdb6ce8[_0x3aabdc(0x160)](0x191)[_0x3aabdc(0x155)]({'error':_0x3aabdc(0x141)});const _0x1ee1bf=_0x518e93[_0x3aabdc(0x144)](0x7);if(_0x1ee1bf!==_0x3aabdc(0x165))return _0xdb6ce8['status'](0x191)[_0x3aabdc(0x155)]({'error':_0x3aabdc(0x168)});_0xe0539f();};function a35_0x5eb3(_0x1b4aa7,_0x508aeb){_0x1b4aa7=_0x1b4aa7-0x134;const _0x159a87=a35_0x159a();let _0x5eb3d3=_0x159a87[_0x1b4aa7];return _0x5eb3d3;}router[a35_0x115ade(0x182)]('/payments/:id/gateway-settings',verifyInternalApiKey,async(_0x2d61c3,_0xe68dd1)=>{const _0x322321=a35_0x115ade;try{const {id:_0x55792b}=_0x2d61c3[_0x322321(0x14d)];console['log'](_0x322321(0x136)+_0x55792b+'\x20with\x20gateway\x20settings');const _0x10c27c=await database_1['default'][_0x322321(0x135)][_0x322321(0x13b)]({'where':{'id':_0x55792b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x10c27c)return _0xe68dd1[_0x322321(0x160)](0x194)[_0x322321(0x155)]({'error':_0x322321(0x174)});console[_0x322321(0x17a)](_0x322321(0x147)+_0x10c27c['shop'][_0x322321(0x146)]),_0xe68dd1[_0x322321(0x155)]({'id':_0x10c27c['id'],'amount':_0x10c27c[_0x322321(0x183)],'currency':_0x10c27c['currency'],'status':_0x10c27c[_0x322321(0x160)],'orderId':_0x10c27c['orderId'],'shop':_0x10c27c[_0x322321(0x154)]});}catch(_0x5b8cec){console[_0x322321(0x13f)](_0x322321(0x143),_0x5b8cec),_0xe68dd1[_0x322321(0x160)](0x1f4)[_0x322321(0x155)]({'error':_0x322321(0x17d)});}}),router[a35_0x115ade(0x162)]('/payments/:id/update',verifyInternalApiKey,async(_0x250f18,_0x4f7e86)=>{const _0x56b394=a35_0x115ade;try{const {id:_0x1fc2b0}=_0x250f18[_0x56b394(0x14d)],_0x1e34ce=_0x250f18[_0x56b394(0x13d)];console[_0x56b394(0x17a)](_0x56b394(0x173)+_0x1fc2b0,_0x1e34ce);const _0x953907=[_0x56b394(0x160),'gateway_payment_id','gatewayPaymentId',_0x56b394(0x16d),_0x56b394(0x14b),_0x56b394(0x156),_0x56b394(0x161),'paid_at',_0x56b394(0x17c),_0x56b394(0x150),'failureMessage'],_0x350094={};for(const [_0x49306b,_0x26a01e]of Object[_0x56b394(0x13e)](_0x1e34ce)){if(_0x953907[_0x56b394(0x159)](_0x49306b)){let _0x2116ba=_0x49306b;if(_0x49306b===_0x56b394(0x14f)||_0x49306b==='gatewayPaymentId')_0x2116ba=_0x56b394(0x16a);else{if(_0x49306b===_0x56b394(0x16d)||_0x49306b===_0x56b394(0x14b))_0x2116ba=_0x56b394(0x14b);else{if(_0x49306b===_0x56b394(0x156)||_0x49306b===_0x56b394(0x161))_0x2116ba=_0x56b394(0x161);else{if(_0x49306b===_0x56b394(0x15f)||_0x49306b===_0x56b394(0x17c))_0x2116ba=_0x56b394(0x17c);else(_0x49306b==='failure_message'||_0x49306b===_0x56b394(0x15a))&&(_0x2116ba='failureMessage');}}}_0x2116ba===_0x56b394(0x17c)&&typeof _0x26a01e===_0x56b394(0x180)?_0x350094[_0x2116ba]=new Date(_0x26a01e):_0x350094[_0x2116ba]=_0x26a01e;}}if(Object[_0x56b394(0x137)](_0x350094)[_0x56b394(0x164)]===0x0)return _0x4f7e86[_0x56b394(0x160)](0x190)[_0x56b394(0x155)]({'error':_0x56b394(0x157)});const _0x48b7e4=await database_1[_0x56b394(0x158)][_0x56b394(0x135)]['update']({'where':{'id':_0x1fc2b0},'data':_0x350094});console[_0x56b394(0x17a)]('âœ…\x20Internal\x20API:\x20Payment\x20'+_0x1fc2b0+_0x56b394(0x169));if(_0x350094[_0x56b394(0x160)]===_0x56b394(0x14a)){console[_0x56b394(0x17a)]('ðŸŽ‰\x20Payment\x20'+_0x1fc2b0+_0x56b394(0x15b));try{const {WebhookService:_0x20392c}=await Promise[_0x56b394(0x14e)]()[_0x56b394(0x171)](()=>__importStar(require(_0x56b394(0x13c)))),_0x20c4de=new _0x20392c(),_0xbd5bc0=await database_1[_0x56b394(0x158)]['payment'][_0x56b394(0x13b)]({'where':{'id':_0x1fc2b0},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0xbd5bc0&&console[_0x56b394(0x17a)](_0x56b394(0x176)+_0x1fc2b0);}catch(_0x518c2c){console['error'](_0x56b394(0x15c),_0x518c2c);}}_0x4f7e86['json']({'success':!![],'payment':{'id':_0x48b7e4['id'],'status':_0x48b7e4[_0x56b394(0x160)]}});}catch(_0x5051e8){console[_0x56b394(0x13f)](_0x56b394(0x17b),_0x5051e8),_0x4f7e86[_0x56b394(0x160)](0x1f4)[_0x56b394(0x155)]({'error':_0x56b394(0x17d)});}}),router[a35_0x115ade(0x182)]('/health',(_0x162e31,_0x5a5ce5)=>{const _0x3e71e4=a35_0x115ade;_0x5a5ce5[_0x3e71e4(0x155)]({'status':'ok','timestamp':new Date()[_0x3e71e4(0x152)]()});}),exports[a35_0x115ade(0x158)]=router;