'use strict';function a30_0x5906(){const _0x93bbce=['paid_at','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','defineProperty','paymentMethod','status','error','failureMessage','321350EJsUcB','__createBinding','length','4239151kjNXDB','../services/webhookService','846832CeevCL','cardLast4','__importDefault','authorization','internal-api-key','15xCfMmz','389692EdRqEp','28061WpEofj','prototype','98bqGmAX','toISOString','log','json','Bearer\x20','6XKqvZM','writable','__esModule','update','gatewayPaymentId','shop','substring','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','/payments/:id/update','card_last4','getOwnPropertyDescriptor','\x20with\x20gateway\x20settings','30425844HtbQEK','params','failure_message','startsWith','506pVIEMA','/health','then','Missing\x20or\x20invalid\x20authorization\x20header','payment','express','Router','paidAt','‚úÖ\x20Internal\x20API:\x20Payment\x20','PAID','findUnique','92000ICZgXG','Internal\x20server\x20error','create','No\x20valid\x20fields\x20to\x20update','13zmPCHB','keys','Internal\x20API\x20error\x20getting\x20payment:','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','../config/database','body','Invalid\x20internal\x20API\x20key','gateway_payment_id','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20','45HZFUjU','string','get','\x20updated\x20successfully','username','default','orderId','includes','patch','currency','call','entries','payment_method','__setModuleDefault','/payments/:id/gateway-settings'];a30_0x5906=function(){return _0x93bbce;};return a30_0x5906();}const a30_0x3881f0=a30_0x294a;function a30_0x294a(_0x162d98,_0x5c9ccd){_0x162d98=_0x162d98-0x184;const _0x5906d6=a30_0x5906();let _0x294acc=_0x5906d6[_0x162d98];return _0x294acc;}(function(_0x59a58b,_0x33815d){const _0x1cfc36=a30_0x294a,_0x1e999d=_0x59a58b();while(!![]){try{const _0x22eade=parseInt(_0x1cfc36(0x1d4))/0x1*(-parseInt(_0x1cfc36(0x185))/0x2)+-parseInt(_0x1cfc36(0x1d2))/0x3*(parseInt(_0x1cfc36(0x1d3))/0x4)+-parseInt(_0x1cfc36(0x1a5))/0x5+parseInt(_0x1cfc36(0x18a))/0x6*(-parseInt(_0x1cfc36(0x1cb))/0x7)+-parseInt(_0x1cfc36(0x1cd))/0x8*(parseInt(_0x1cfc36(0x1b2))/0x9)+parseInt(_0x1cfc36(0x1c8))/0xa*(parseInt(_0x1cfc36(0x19a))/0xb)+-parseInt(_0x1cfc36(0x196))/0xc*(-parseInt(_0x1cfc36(0x1a9))/0xd);if(_0x22eade===_0x33815d)break;else _0x1e999d['push'](_0x1e999d['shift']());}catch(_0x3b4ee2){_0x1e999d['push'](_0x1e999d['shift']());}}}(a30_0x5906,0xf3bba));var __createBinding=this&&this[a30_0x3881f0(0x1c9)]||(Object[a30_0x3881f0(0x1a7)]?function(_0x59389e,_0x4f7db6,_0x384c85,_0x42f3d4){const _0x220ad6=a30_0x3881f0;if(_0x42f3d4===undefined)_0x42f3d4=_0x384c85;var _0x5bb57f=Object[_0x220ad6(0x194)](_0x4f7db6,_0x384c85);(!_0x5bb57f||(_0x220ad6(0x1b4)in _0x5bb57f?!_0x4f7db6[_0x220ad6(0x18c)]:_0x5bb57f[_0x220ad6(0x18b)]||_0x5bb57f['configurable']))&&(_0x5bb57f={'enumerable':!![],'get':function(){return _0x4f7db6[_0x384c85];}}),Object[_0x220ad6(0x1c3)](_0x59389e,_0x42f3d4,_0x5bb57f);}:function(_0xbb15ef,_0x96d37c,_0x5a927f,_0x567ed0){if(_0x567ed0===undefined)_0x567ed0=_0x5a927f;_0xbb15ef[_0x567ed0]=_0x96d37c[_0x5a927f];}),__setModuleDefault=this&&this[a30_0x3881f0(0x1bf)]||(Object['create']?function(_0x450233,_0x756658){const _0x4f15d0=a30_0x3881f0;Object[_0x4f15d0(0x1c3)](_0x450233,_0x4f15d0(0x1b7),{'enumerable':!![],'value':_0x756658});}:function(_0xb7dd9d,_0x4dec4b){const _0x50358c=a30_0x3881f0;_0xb7dd9d[_0x50358c(0x1b7)]=_0x4dec4b;}),__importStar=this&&this['__importStar']||(function(){var _0x257c1e=function(_0x1570c5){return _0x257c1e=Object['getOwnPropertyNames']||function(_0x25cf21){const _0x17738c=a30_0x294a;var _0x206934=[];for(var _0x44c73d in _0x25cf21)if(Object[_0x17738c(0x184)]['hasOwnProperty'][_0x17738c(0x1bc)](_0x25cf21,_0x44c73d))_0x206934[_0x206934[_0x17738c(0x1ca)]]=_0x44c73d;return _0x206934;},_0x257c1e(_0x1570c5);};return function(_0x34af2c){const _0x245051=a30_0x294a;if(_0x34af2c&&_0x34af2c[_0x245051(0x18c)])return _0x34af2c;var _0x3f4a6f={};if(_0x34af2c!=null){for(var _0x513fd7=_0x257c1e(_0x34af2c),_0x10d937=0x0;_0x10d937<_0x513fd7['length'];_0x10d937++)if(_0x513fd7[_0x10d937]!==_0x245051(0x1b7))__createBinding(_0x3f4a6f,_0x34af2c,_0x513fd7[_0x10d937]);}return __setModuleDefault(_0x3f4a6f,_0x34af2c),_0x3f4a6f;};}()),__importDefault=this&&this[a30_0x3881f0(0x1cf)]||function(_0x5ca46b){return _0x5ca46b&&_0x5ca46b['__esModule']?_0x5ca46b:{'default':_0x5ca46b};};Object[a30_0x3881f0(0x1c3)](exports,a30_0x3881f0(0x18c),{'value':!![]});const express_1=require(a30_0x3881f0(0x19f)),database_1=__importDefault(require(a30_0x3881f0(0x1ad))),router=(0x0,express_1[a30_0x3881f0(0x1a0)])(),verifyInternalApiKey=(_0x597f72,_0x4255c8,_0x41120e)=>{const _0x566f4a=a30_0x3881f0,_0x17476b=_0x597f72['headers'][_0x566f4a(0x1d0)];if(!_0x17476b||!_0x17476b[_0x566f4a(0x199)](_0x566f4a(0x189)))return _0x4255c8[_0x566f4a(0x1c5)](0x191)[_0x566f4a(0x188)]({'error':_0x566f4a(0x19d)});const _0x4b0905=_0x17476b[_0x566f4a(0x190)](0x7);if(_0x4b0905!==_0x566f4a(0x1d1))return _0x4255c8[_0x566f4a(0x1c5)](0x191)['json']({'error':_0x566f4a(0x1af)});_0x41120e();};router[a30_0x3881f0(0x1b4)](a30_0x3881f0(0x1c0),verifyInternalApiKey,async(_0x73ada1,_0x2afb5b)=>{const _0x550d72=a30_0x3881f0;try{const {id:_0x579bd3}=_0x73ada1[_0x550d72(0x197)];console[_0x550d72(0x187)](_0x550d72(0x191)+_0x579bd3+_0x550d72(0x195));const _0x57b45b=await database_1[_0x550d72(0x1b7)][_0x550d72(0x19e)][_0x550d72(0x1a4)]({'where':{'id':_0x579bd3},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x57b45b)return _0x2afb5b['status'](0x194)['json']({'error':'Payment\x20not\x20found'});console[_0x550d72(0x187)](_0x550d72(0x1c2)+_0x57b45b['shop'][_0x550d72(0x1b6)]),_0x2afb5b[_0x550d72(0x188)]({'id':_0x57b45b['id'],'amount':_0x57b45b['amount'],'currency':_0x57b45b[_0x550d72(0x1bb)],'status':_0x57b45b['status'],'orderId':_0x57b45b[_0x550d72(0x1b8)],'shop':_0x57b45b[_0x550d72(0x18f)]});}catch(_0x1a8777){console['error'](_0x550d72(0x1ab),_0x1a8777),_0x2afb5b['status'](0x1f4)[_0x550d72(0x188)]({'error':'Internal\x20server\x20error'});}}),router[a30_0x3881f0(0x1ba)](a30_0x3881f0(0x192),verifyInternalApiKey,async(_0x3c9e27,_0x2fa377)=>{const _0x84fd35=a30_0x3881f0;try{const {id:_0x1af35a}=_0x3c9e27[_0x84fd35(0x197)],_0x4eeb4e=_0x3c9e27[_0x84fd35(0x1ae)];console[_0x84fd35(0x187)](_0x84fd35(0x1b1)+_0x1af35a,_0x4eeb4e);const _0x4f90a6=['status','gateway_payment_id','gatewayPaymentId',_0x84fd35(0x193),_0x84fd35(0x1ce),_0x84fd35(0x1be),_0x84fd35(0x1c4),_0x84fd35(0x1c1),_0x84fd35(0x1a1),_0x84fd35(0x198),'failureMessage'],_0x1aa0ff={};for(const [_0x324ff3,_0xcee9f3]of Object[_0x84fd35(0x1bd)](_0x4eeb4e)){if(_0x4f90a6[_0x84fd35(0x1b9)](_0x324ff3)){let _0x1f9cfe=_0x324ff3;if(_0x324ff3===_0x84fd35(0x1b0)||_0x324ff3==='gatewayPaymentId')_0x1f9cfe=_0x84fd35(0x18e);else{if(_0x324ff3===_0x84fd35(0x193)||_0x324ff3===_0x84fd35(0x1ce))_0x1f9cfe=_0x84fd35(0x1ce);else{if(_0x324ff3===_0x84fd35(0x1be)||_0x324ff3===_0x84fd35(0x1c4))_0x1f9cfe=_0x84fd35(0x1c4);else{if(_0x324ff3===_0x84fd35(0x1c1)||_0x324ff3==='paidAt')_0x1f9cfe=_0x84fd35(0x1a1);else(_0x324ff3===_0x84fd35(0x198)||_0x324ff3===_0x84fd35(0x1c7))&&(_0x1f9cfe='failureMessage');}}}_0x1f9cfe===_0x84fd35(0x1a1)&&typeof _0xcee9f3===_0x84fd35(0x1b3)?_0x1aa0ff[_0x1f9cfe]=new Date(_0xcee9f3):_0x1aa0ff[_0x1f9cfe]=_0xcee9f3;}}if(Object[_0x84fd35(0x1aa)](_0x1aa0ff)[_0x84fd35(0x1ca)]===0x0)return _0x2fa377[_0x84fd35(0x1c5)](0x190)[_0x84fd35(0x188)]({'error':_0x84fd35(0x1a8)});const _0x5dac15=await database_1[_0x84fd35(0x1b7)][_0x84fd35(0x19e)][_0x84fd35(0x18d)]({'where':{'id':_0x1af35a},'data':_0x1aa0ff});console['log'](_0x84fd35(0x1a2)+_0x1af35a+_0x84fd35(0x1b5));if(_0x1aa0ff[_0x84fd35(0x1c5)]===_0x84fd35(0x1a3)){console[_0x84fd35(0x187)]('üéâ\x20Payment\x20'+_0x1af35a+'\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing');try{const {WebhookService:_0x266454}=await Promise['resolve']()[_0x84fd35(0x19c)](()=>__importStar(require(_0x84fd35(0x1cc)))),_0x41be61=new _0x266454(),_0x15a3a4=await database_1['default'][_0x84fd35(0x19e)][_0x84fd35(0x1a4)]({'where':{'id':_0x1af35a},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x15a3a4&&console[_0x84fd35(0x187)](_0x84fd35(0x1ac)+_0x1af35a);}catch(_0x4a1651){console['error']('Error\x20sending\x20webhook\x20notification:',_0x4a1651);}}_0x2fa377[_0x84fd35(0x188)]({'success':!![],'payment':{'id':_0x5dac15['id'],'status':_0x5dac15['status']}});}catch(_0x52b7a6){console[_0x84fd35(0x1c6)]('Internal\x20API\x20error\x20updating\x20payment:',_0x52b7a6),_0x2fa377[_0x84fd35(0x1c5)](0x1f4)[_0x84fd35(0x188)]({'error':_0x84fd35(0x1a6)});}}),router[a30_0x3881f0(0x1b4)](a30_0x3881f0(0x19b),(_0x658df0,_0x5aed99)=>{const _0x4db039=a30_0x3881f0;_0x5aed99['json']({'status':'ok','timestamp':new Date()[_0x4db039(0x186)]()});}),exports[a30_0x3881f0(0x1b7)]=router;