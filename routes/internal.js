'use strict';function a26_0x365f(){const _0x14315=['failureMessage','🎉\x20Payment\x20','31124040jobkbo','819475guQNtd','patch','paidAt','string','shop','6898955LoaaHC','payment','No\x20valid\x20fields\x20to\x20update','466090hNdcQr','writable','Error\x20sending\x20webhook\x20notification:','log','__createBinding','__importStar','card_last4','error','update','12gyBouW','get','create','Internal\x20API\x20error\x20updating\x20payment:','startsWith','paid_at','username','624SCoFeS','params','payment_method','65043Czeswc','📤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','status','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','46668gePFFc','configurable','Internal\x20server\x20error','Missing\x20or\x20invalid\x20authorization\x20header','express','PAID','Invalid\x20internal\x20API\x20key','cardLast4','600332agRYTB','defineProperty','\x20updated\x20successfully','gateway_payment_id','entries','length','🔄\x20Internal\x20API:\x20Updating\x20payment\x20','hasOwnProperty','orderId','Internal\x20API\x20error\x20getting\x20payment:','165yYNNmG','failure_message','__setModuleDefault','default','gatewayPaymentId','getOwnPropertyDescriptor','__esModule','json','Router','paymentMethod','Bearer\x20','../services/webhookService','/health','call','✅\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','/payments/:id/gateway-settings','findUnique','✅\x20Internal\x20API:\x20Payment\x20','../config/database','authorization'];a26_0x365f=function(){return _0x14315;};return a26_0x365f();}function a26_0x3e93(_0x42c0a0,_0x214ebd){const _0x365f4f=a26_0x365f();return a26_0x3e93=function(_0x3e9399,_0x232973){_0x3e9399=_0x3e9399-0x108;let _0x1d81c9=_0x365f4f[_0x3e9399];return _0x1d81c9;},a26_0x3e93(_0x42c0a0,_0x214ebd);}const a26_0x590782=a26_0x3e93;(function(_0x3b9e37,_0x4c1cb8){const _0x19fa24=a26_0x3e93,_0x48c3a7=_0x3b9e37();while(!![]){try{const _0x9afed2=-parseInt(_0x19fa24(0x11b))/0x1+parseInt(_0x19fa24(0x13a))/0x2*(-parseInt(_0x19fa24(0x14c))/0x3)+parseInt(_0x19fa24(0x142))/0x4+-parseInt(_0x19fa24(0x123))/0x5*(-parseInt(_0x19fa24(0x12c))/0x6)+-parseInt(_0x19fa24(0x120))/0x7+-parseInt(_0x19fa24(0x133))/0x8*(-parseInt(_0x19fa24(0x136))/0x9)+parseInt(_0x19fa24(0x11a))/0xa;if(_0x9afed2===_0x4c1cb8)break;else _0x48c3a7['push'](_0x48c3a7['shift']());}catch(_0x3e0a78){_0x48c3a7['push'](_0x48c3a7['shift']());}}}(a26_0x365f,0xe1a3b));var __createBinding=this&&this[a26_0x590782(0x127)]||(Object[a26_0x590782(0x12e)]?function(_0x37909e,_0xb41acf,_0x53bf83,_0x2117c3){const _0x438c68=a26_0x590782;if(_0x2117c3===undefined)_0x2117c3=_0x53bf83;var _0x376bfc=Object[_0x438c68(0x109)](_0xb41acf,_0x53bf83);(!_0x376bfc||('get'in _0x376bfc?!_0xb41acf[_0x438c68(0x10a)]:_0x376bfc[_0x438c68(0x124)]||_0x376bfc[_0x438c68(0x13b)]))&&(_0x376bfc={'enumerable':!![],'get':function(){return _0xb41acf[_0x53bf83];}}),Object['defineProperty'](_0x37909e,_0x2117c3,_0x376bfc);}:function(_0x3c1ca8,_0x40c4d6,_0x5abda,_0x5747a8){if(_0x5747a8===undefined)_0x5747a8=_0x5abda;_0x3c1ca8[_0x5747a8]=_0x40c4d6[_0x5abda];}),__setModuleDefault=this&&this[a26_0x590782(0x14e)]||(Object[a26_0x590782(0x12e)]?function(_0x4766e0,_0x50b1e5){const _0x48936a=a26_0x590782;Object[_0x48936a(0x143)](_0x4766e0,_0x48936a(0x14f),{'enumerable':!![],'value':_0x50b1e5});}:function(_0x5ecc8d,_0x7b3abe){const _0x3bd51b=a26_0x590782;_0x5ecc8d[_0x3bd51b(0x14f)]=_0x7b3abe;}),__importStar=this&&this[a26_0x590782(0x128)]||(function(){var _0x5e81d3=function(_0x3a0928){return _0x5e81d3=Object['getOwnPropertyNames']||function(_0x149dc8){const _0x2f57a3=a26_0x3e93;var _0x1d0f2a=[];for(var _0x40d95e in _0x149dc8)if(Object['prototype'][_0x2f57a3(0x149)][_0x2f57a3(0x111)](_0x149dc8,_0x40d95e))_0x1d0f2a[_0x1d0f2a['length']]=_0x40d95e;return _0x1d0f2a;},_0x5e81d3(_0x3a0928);};return function(_0x16ce7f){const _0x36f538=a26_0x3e93;if(_0x16ce7f&&_0x16ce7f[_0x36f538(0x10a)])return _0x16ce7f;var _0x6a545f={};if(_0x16ce7f!=null){for(var _0x164651=_0x5e81d3(_0x16ce7f),_0x4c0fcc=0x0;_0x4c0fcc<_0x164651[_0x36f538(0x147)];_0x4c0fcc++)if(_0x164651[_0x4c0fcc]!=='default')__createBinding(_0x6a545f,_0x16ce7f,_0x164651[_0x4c0fcc]);}return __setModuleDefault(_0x6a545f,_0x16ce7f),_0x6a545f;};}()),__importDefault=this&&this['__importDefault']||function(_0x46ed5a){const _0x21de68=a26_0x590782;return _0x46ed5a&&_0x46ed5a[_0x21de68(0x10a)]?_0x46ed5a:{'default':_0x46ed5a};};Object[a26_0x590782(0x143)](exports,a26_0x590782(0x10a),{'value':!![]});const express_1=require(a26_0x590782(0x13e)),database_1=__importDefault(require(a26_0x590782(0x116))),router=(0x0,express_1[a26_0x590782(0x10c)])(),verifyInternalApiKey=(_0x2971c3,_0x1b3585,_0x4a9be9)=>{const _0x3a4e43=a26_0x590782,_0xb3600f=_0x2971c3['headers'][_0x3a4e43(0x117)];if(!_0xb3600f||!_0xb3600f[_0x3a4e43(0x130)](_0x3a4e43(0x10e)))return _0x1b3585[_0x3a4e43(0x138)](0x191)[_0x3a4e43(0x10b)]({'error':_0x3a4e43(0x13d)});const _0x5aeba6=_0xb3600f['substring'](0x7);if(_0x5aeba6!=='internal-api-key')return _0x1b3585['status'](0x191)['json']({'error':_0x3a4e43(0x140)});_0x4a9be9();};router[a26_0x590782(0x12d)](a26_0x590782(0x113),verifyInternalApiKey,async(_0x2f5829,_0x4506d9)=>{const _0x3be202=a26_0x590782;try{const {id:_0x4d1a67}=_0x2f5829[_0x3be202(0x134)];console[_0x3be202(0x126)]('🔍\x20Internal\x20API:\x20Getting\x20payment\x20'+_0x4d1a67+'\x20with\x20gateway\x20settings');const _0xf6f83a=await database_1[_0x3be202(0x14f)][_0x3be202(0x121)][_0x3be202(0x114)]({'where':{'id':_0x4d1a67},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0xf6f83a)return _0x4506d9['status'](0x194)[_0x3be202(0x10b)]({'error':'Payment\x20not\x20found'});console[_0x3be202(0x126)](_0x3be202(0x112)+_0xf6f83a['shop'][_0x3be202(0x132)]),_0x4506d9[_0x3be202(0x10b)]({'id':_0xf6f83a['id'],'amount':_0xf6f83a['amount'],'currency':_0xf6f83a['currency'],'status':_0xf6f83a[_0x3be202(0x138)],'orderId':_0xf6f83a[_0x3be202(0x14a)],'shop':_0xf6f83a[_0x3be202(0x11f)]});}catch(_0x2ad3b0){console[_0x3be202(0x12a)](_0x3be202(0x14b),_0x2ad3b0),_0x4506d9[_0x3be202(0x138)](0x1f4)['json']({'error':'Internal\x20server\x20error'});}}),router[a26_0x590782(0x11c)]('/payments/:id/update',verifyInternalApiKey,async(_0x4dd187,_0x3066fd)=>{const _0x3b15e7=a26_0x590782;try{const {id:_0x3b0920}=_0x4dd187[_0x3b15e7(0x134)],_0x50dd0f=_0x4dd187['body'];console['log'](_0x3b15e7(0x148)+_0x3b0920,_0x50dd0f);const _0x2f820e=['status','gateway_payment_id',_0x3b15e7(0x108),_0x3b15e7(0x129),_0x3b15e7(0x141),_0x3b15e7(0x135),_0x3b15e7(0x10d),_0x3b15e7(0x131),_0x3b15e7(0x11d),_0x3b15e7(0x14d),_0x3b15e7(0x118)],_0x40e9ba={};for(const [_0x4956e7,_0x4eb4e0]of Object[_0x3b15e7(0x146)](_0x50dd0f)){if(_0x2f820e['includes'](_0x4956e7)){let _0x222431=_0x4956e7;if(_0x4956e7===_0x3b15e7(0x145)||_0x4956e7===_0x3b15e7(0x108))_0x222431='gatewayPaymentId';else{if(_0x4956e7===_0x3b15e7(0x129)||_0x4956e7==='cardLast4')_0x222431=_0x3b15e7(0x141);else{if(_0x4956e7===_0x3b15e7(0x135)||_0x4956e7===_0x3b15e7(0x10d))_0x222431='paymentMethod';else{if(_0x4956e7===_0x3b15e7(0x131)||_0x4956e7==='paidAt')_0x222431='paidAt';else(_0x4956e7===_0x3b15e7(0x14d)||_0x4956e7===_0x3b15e7(0x118))&&(_0x222431=_0x3b15e7(0x118));}}}_0x222431===_0x3b15e7(0x11d)&&typeof _0x4eb4e0===_0x3b15e7(0x11e)?_0x40e9ba[_0x222431]=new Date(_0x4eb4e0):_0x40e9ba[_0x222431]=_0x4eb4e0;}}if(Object['keys'](_0x40e9ba)[_0x3b15e7(0x147)]===0x0)return _0x3066fd[_0x3b15e7(0x138)](0x190)['json']({'error':_0x3b15e7(0x122)});const _0x31de0a=await database_1[_0x3b15e7(0x14f)][_0x3b15e7(0x121)][_0x3b15e7(0x12b)]({'where':{'id':_0x3b0920},'data':_0x40e9ba});console['log'](_0x3b15e7(0x115)+_0x3b0920+_0x3b15e7(0x144));if(_0x40e9ba['status']===_0x3b15e7(0x13f)){console[_0x3b15e7(0x126)](_0x3b15e7(0x119)+_0x3b0920+_0x3b15e7(0x139));try{const {WebhookService:_0x29db64}=await Promise['resolve']()['then'](()=>__importStar(require(_0x3b15e7(0x10f)))),_0x99ad8c=new _0x29db64(),_0x317835=await database_1[_0x3b15e7(0x14f)][_0x3b15e7(0x121)][_0x3b15e7(0x114)]({'where':{'id':_0x3b0920},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x317835&&console[_0x3b15e7(0x126)](_0x3b15e7(0x137)+_0x3b0920);}catch(_0x411220){console['error'](_0x3b15e7(0x125),_0x411220);}}_0x3066fd[_0x3b15e7(0x10b)]({'success':!![],'payment':{'id':_0x31de0a['id'],'status':_0x31de0a[_0x3b15e7(0x138)]}});}catch(_0x50c0ed){console['error'](_0x3b15e7(0x12f),_0x50c0ed),_0x3066fd[_0x3b15e7(0x138)](0x1f4)[_0x3b15e7(0x10b)]({'error':_0x3b15e7(0x13c)});}}),router[a26_0x590782(0x12d)](a26_0x590782(0x110),(_0x120010,_0x546816)=>{const _0x52c3e1=a26_0x590782;_0x546816[_0x52c3e1(0x10b)]({'status':'ok','timestamp':new Date()['toISOString']()});}),exports[a26_0x590782(0x14f)]=router;