'use strict';function a30_0x3ba8(){const _0x359370=['card_last4','prototype','126Mlphqj','‚úÖ\x20Internal\x20API:\x20Payment\x20','\x20updated\x20successfully','headers','Internal\x20server\x20error','status','../services/webhookService','__setModuleDefault','paidAt','Internal\x20API\x20error\x20getting\x20payment:','toISOString','default','express','762BlLdCA','__esModule','failureMessage','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20','currency','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','/payments/:id/update','length','Bearer\x20','paymentMethod','/payments/:id/gateway-settings','call','authorization','log','error','PAID','1832tQlaIO','payment','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','entries','keys','substring','patch','967435buHoSU','shop','writable','gatewayPaymentId','defineProperty','Invalid\x20internal\x20API\x20key','includes','failure_message','getOwnPropertyNames','startsWith','15354pttRdD','configurable','üéâ\x20Payment\x20','string','844011lFKwfO','hasOwnProperty','params','14956ivWsEq','payment_method','update','amount','/health','resolve','gateway_payment_id','paid_at','__createBinding','body','\x20with\x20gateway\x20settings','create','Router','get','Internal\x20API\x20error\x20updating\x20payment:','json','findUnique','__importDefault','internal-api-key','936208xRFhrs'];a30_0x3ba8=function(){return _0x359370;};return a30_0x3ba8();}const a30_0x3e60a9=a30_0x4f5c;function a30_0x4f5c(_0x3700f3,_0x111569){_0x3700f3=_0x3700f3-0xd4;const _0x3ba8f4=a30_0x3ba8();let _0x4f5c2b=_0x3ba8f4[_0x3700f3];return _0x4f5c2b;}(function(_0x40ddef,_0x226a9c){const _0x49f332=a30_0x4f5c,_0x3e9c5c=_0x40ddef();while(!![]){try{const _0x423599=-parseInt(_0x49f332(0xfc))/0x1+parseInt(_0x49f332(0xec))/0x2+-parseInt(_0x49f332(0xdf))/0x3*(-parseInt(_0x49f332(0x114))/0x4)+parseInt(_0x49f332(0x103))/0x5+-parseInt(_0x49f332(0x10d))/0x6+-parseInt(_0x49f332(0x111))/0x7+-parseInt(_0x49f332(0xdc))/0x8;if(_0x423599===_0x226a9c)break;else _0x3e9c5c['push'](_0x3e9c5c['shift']());}catch(_0x3091a6){_0x3e9c5c['push'](_0x3e9c5c['shift']());}}}(a30_0x3ba8,0x1a974));var __createBinding=this&&this[a30_0x3e60a9(0x11c)]||(Object['create']?function(_0x4ebe1a,_0xa3f6d2,_0x5e8049,_0x2f66c6){const _0x1b5149=a30_0x3e60a9;if(_0x2f66c6===undefined)_0x2f66c6=_0x5e8049;var _0xc416af=Object['getOwnPropertyDescriptor'](_0xa3f6d2,_0x5e8049);(!_0xc416af||(_0x1b5149(0xd6)in _0xc416af?!_0xa3f6d2[_0x1b5149(0xed)]:_0xc416af[_0x1b5149(0x105)]||_0xc416af[_0x1b5149(0x10e)]))&&(_0xc416af={'enumerable':!![],'get':function(){return _0xa3f6d2[_0x5e8049];}}),Object[_0x1b5149(0x107)](_0x4ebe1a,_0x2f66c6,_0xc416af);}:function(_0x40915a,_0x1d5d74,_0x203a54,_0x4ee216){if(_0x4ee216===undefined)_0x4ee216=_0x203a54;_0x40915a[_0x4ee216]=_0x1d5d74[_0x203a54];}),__setModuleDefault=this&&this[a30_0x3e60a9(0xe6)]||(Object[a30_0x3e60a9(0xd4)]?function(_0x1d8a50,_0x9e7110){const _0x3b65fd=a30_0x3e60a9;Object[_0x3b65fd(0x107)](_0x1d8a50,_0x3b65fd(0xea),{'enumerable':!![],'value':_0x9e7110});}:function(_0x5bd6e2,_0x25e4fe){_0x5bd6e2['default']=_0x25e4fe;}),__importStar=this&&this['__importStar']||(function(){var _0x4e9067=function(_0x282b21){const _0x402be3=a30_0x4f5c;return _0x4e9067=Object[_0x402be3(0x10b)]||function(_0x2deb94){const _0x3e4961=_0x402be3;var _0x359bc6=[];for(var _0x570b6e in _0x2deb94)if(Object[_0x3e4961(0xde)][_0x3e4961(0x112)][_0x3e4961(0xf7)](_0x2deb94,_0x570b6e))_0x359bc6[_0x359bc6[_0x3e4961(0xf3)]]=_0x570b6e;return _0x359bc6;},_0x4e9067(_0x282b21);};return function(_0x55db58){const _0x21f1e8=a30_0x4f5c;if(_0x55db58&&_0x55db58[_0x21f1e8(0xed)])return _0x55db58;var _0x5d05a1={};if(_0x55db58!=null){for(var _0xe6c05d=_0x4e9067(_0x55db58),_0x4e8965=0x0;_0x4e8965<_0xe6c05d[_0x21f1e8(0xf3)];_0x4e8965++)if(_0xe6c05d[_0x4e8965]!==_0x21f1e8(0xea))__createBinding(_0x5d05a1,_0x55db58,_0xe6c05d[_0x4e8965]);}return __setModuleDefault(_0x5d05a1,_0x55db58),_0x5d05a1;};}()),__importDefault=this&&this[a30_0x3e60a9(0xda)]||function(_0x1fb2d4){const _0x78ba59=a30_0x3e60a9;return _0x1fb2d4&&_0x1fb2d4[_0x78ba59(0xed)]?_0x1fb2d4:{'default':_0x1fb2d4};};Object[a30_0x3e60a9(0x107)](exports,a30_0x3e60a9(0xed),{'value':!![]});const express_1=require(a30_0x3e60a9(0xeb)),database_1=__importDefault(require('../config/database')),router=(0x0,express_1[a30_0x3e60a9(0xd5)])(),verifyInternalApiKey=(_0x245f93,_0x4fd6a2,_0x6b94b5)=>{const _0x4acaf6=a30_0x3e60a9,_0x11951b=_0x245f93[_0x4acaf6(0xe2)][_0x4acaf6(0xf8)];if(!_0x11951b||!_0x11951b[_0x4acaf6(0x10c)](_0x4acaf6(0xf4)))return _0x4fd6a2[_0x4acaf6(0xe4)](0x191)[_0x4acaf6(0xd8)]({'error':'Missing\x20or\x20invalid\x20authorization\x20header'});const _0x4751ab=_0x11951b[_0x4acaf6(0x101)](0x7);if(_0x4751ab!==_0x4acaf6(0xdb))return _0x4fd6a2[_0x4acaf6(0xe4)](0x191)[_0x4acaf6(0xd8)]({'error':_0x4acaf6(0x108)});_0x6b94b5();};router[a30_0x3e60a9(0xd6)](a30_0x3e60a9(0xf6),verifyInternalApiKey,async(_0x204a38,_0x14bc0c)=>{const _0x3dffbb=a30_0x3e60a9;try{const {id:_0x17a68f}=_0x204a38[_0x3dffbb(0x113)];console[_0x3dffbb(0xf9)](_0x3dffbb(0xfe)+_0x17a68f+_0x3dffbb(0x11e));const _0x3341df=await database_1[_0x3dffbb(0xea)][_0x3dffbb(0xfd)][_0x3dffbb(0xd9)]({'where':{'id':_0x17a68f},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x3341df)return _0x14bc0c[_0x3dffbb(0xe4)](0x194)[_0x3dffbb(0xd8)]({'error':'Payment\x20not\x20found'});console[_0x3dffbb(0xf9)](_0x3dffbb(0xf1)+_0x3341df[_0x3dffbb(0x104)]['username']),_0x14bc0c['json']({'id':_0x3341df['id'],'amount':_0x3341df[_0x3dffbb(0x117)],'currency':_0x3341df[_0x3dffbb(0xf0)],'status':_0x3341df[_0x3dffbb(0xe4)],'orderId':_0x3341df['orderId'],'shop':_0x3341df[_0x3dffbb(0x104)]});}catch(_0x582ded){console[_0x3dffbb(0xfa)](_0x3dffbb(0xe8),_0x582ded),_0x14bc0c[_0x3dffbb(0xe4)](0x1f4)[_0x3dffbb(0xd8)]({'error':'Internal\x20server\x20error'});}}),router[a30_0x3e60a9(0x102)](a30_0x3e60a9(0xf2),verifyInternalApiKey,async(_0x42dddb,_0x1746f6)=>{const _0xc2063b=a30_0x3e60a9;try{const {id:_0x46ad41}=_0x42dddb[_0xc2063b(0x113)],_0x84ad60=_0x42dddb[_0xc2063b(0x11d)];console['log'](_0xc2063b(0xef)+_0x46ad41,_0x84ad60);const _0x3ccb50=[_0xc2063b(0xe4),_0xc2063b(0x11a),_0xc2063b(0x106),_0xc2063b(0xdd),'cardLast4',_0xc2063b(0x115),_0xc2063b(0xf5),_0xc2063b(0x11b),_0xc2063b(0xe7),_0xc2063b(0x10a),_0xc2063b(0xee)],_0x173cad={};for(const [_0x26faa6,_0x5a555c]of Object[_0xc2063b(0xff)](_0x84ad60)){if(_0x3ccb50[_0xc2063b(0x109)](_0x26faa6)){let _0x5579a7=_0x26faa6;if(_0x26faa6==='gateway_payment_id'||_0x26faa6===_0xc2063b(0x106))_0x5579a7=_0xc2063b(0x106);else{if(_0x26faa6===_0xc2063b(0xdd)||_0x26faa6==='cardLast4')_0x5579a7='cardLast4';else{if(_0x26faa6===_0xc2063b(0x115)||_0x26faa6===_0xc2063b(0xf5))_0x5579a7=_0xc2063b(0xf5);else{if(_0x26faa6===_0xc2063b(0x11b)||_0x26faa6===_0xc2063b(0xe7))_0x5579a7='paidAt';else(_0x26faa6===_0xc2063b(0x10a)||_0x26faa6==='failureMessage')&&(_0x5579a7='failureMessage');}}}_0x5579a7===_0xc2063b(0xe7)&&typeof _0x5a555c===_0xc2063b(0x110)?_0x173cad[_0x5579a7]=new Date(_0x5a555c):_0x173cad[_0x5579a7]=_0x5a555c;}}if(Object[_0xc2063b(0x100)](_0x173cad)[_0xc2063b(0xf3)]===0x0)return _0x1746f6['status'](0x190)[_0xc2063b(0xd8)]({'error':'No\x20valid\x20fields\x20to\x20update'});const _0x311949=await database_1['default'][_0xc2063b(0xfd)][_0xc2063b(0x116)]({'where':{'id':_0x46ad41},'data':_0x173cad});console[_0xc2063b(0xf9)](_0xc2063b(0xe0)+_0x46ad41+_0xc2063b(0xe1));if(_0x173cad[_0xc2063b(0xe4)]===_0xc2063b(0xfb)){console['log'](_0xc2063b(0x10f)+_0x46ad41+'\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing');try{const {WebhookService:_0x273e10}=await Promise[_0xc2063b(0x119)]()['then'](()=>__importStar(require(_0xc2063b(0xe5)))),_0x11fecc=new _0x273e10(),_0x23c638=await database_1[_0xc2063b(0xea)][_0xc2063b(0xfd)]['findUnique']({'where':{'id':_0x46ad41},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x23c638&&console[_0xc2063b(0xf9)]('üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20'+_0x46ad41);}catch(_0x1f1cc3){console['error']('Error\x20sending\x20webhook\x20notification:',_0x1f1cc3);}}_0x1746f6[_0xc2063b(0xd8)]({'success':!![],'payment':{'id':_0x311949['id'],'status':_0x311949[_0xc2063b(0xe4)]}});}catch(_0x4dec09){console[_0xc2063b(0xfa)](_0xc2063b(0xd7),_0x4dec09),_0x1746f6[_0xc2063b(0xe4)](0x1f4)[_0xc2063b(0xd8)]({'error':_0xc2063b(0xe3)});}}),router['get'](a30_0x3e60a9(0x118),(_0x2f4657,_0x15a3bb)=>{const _0x43fb16=a30_0x3e60a9;_0x15a3bb[_0x43fb16(0xd8)]({'status':'ok','timestamp':new Date()[_0x43fb16(0xe9)]()});}),exports[a30_0x3e60a9(0xea)]=router;