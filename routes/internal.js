'use strict';const a35_0x27b09a=a35_0x39f2;(function(_0x5f3768,_0x54b652){const _0x50ff43=a35_0x39f2,_0x1066bc=_0x5f3768();while(!![]){try{const _0x1f309f=-parseInt(_0x50ff43(0x159))/0x1+parseInt(_0x50ff43(0x178))/0x2+-parseInt(_0x50ff43(0x180))/0x3+parseInt(_0x50ff43(0x154))/0x4+-parseInt(_0x50ff43(0x15f))/0x5+-parseInt(_0x50ff43(0x14a))/0x6*(-parseInt(_0x50ff43(0x150))/0x7)+-parseInt(_0x50ff43(0x162))/0x8*(-parseInt(_0x50ff43(0x17e))/0x9);if(_0x1f309f===_0x54b652)break;else _0x1066bc['push'](_0x1066bc['shift']());}catch(_0x155c4c){_0x1066bc['push'](_0x1066bc['shift']());}}}(a35_0x1531,0xbae84));var __createBinding=this&&this[a35_0x27b09a(0x14f)]||(Object[a35_0x27b09a(0x15d)]?function(_0x306adb,_0x130498,_0x191ee9,_0x3fd548){const _0xd4300e=a35_0x27b09a;if(_0x3fd548===undefined)_0x3fd548=_0x191ee9;var _0x590623=Object[_0xd4300e(0x15b)](_0x130498,_0x191ee9);(!_0x590623||(_0xd4300e(0x151)in _0x590623?!_0x130498[_0xd4300e(0x16f)]:_0x590623[_0xd4300e(0x17a)]||_0x590623[_0xd4300e(0x173)]))&&(_0x590623={'enumerable':!![],'get':function(){return _0x130498[_0x191ee9];}}),Object[_0xd4300e(0x17c)](_0x306adb,_0x3fd548,_0x590623);}:function(_0xf6adbd,_0x36be5d,_0x512ec1,_0x43447d){if(_0x43447d===undefined)_0x43447d=_0x512ec1;_0xf6adbd[_0x43447d]=_0x36be5d[_0x512ec1];}),__setModuleDefault=this&&this[a35_0x27b09a(0x145)]||(Object[a35_0x27b09a(0x15d)]?function(_0x573fae,_0x15c0e9){const _0x27e6b5=a35_0x27b09a;Object[_0x27e6b5(0x17c)](_0x573fae,_0x27e6b5(0x146),{'enumerable':!![],'value':_0x15c0e9});}:function(_0x24aa3d,_0x5e8b9b){const _0x6b0687=a35_0x27b09a;_0x24aa3d[_0x6b0687(0x146)]=_0x5e8b9b;}),__importStar=this&&this[a35_0x27b09a(0x175)]||(function(){var _0xf31917=function(_0x3d6906){const _0x2c91f8=a35_0x39f2;return _0xf31917=Object[_0x2c91f8(0x171)]||function(_0x313a58){const _0x37cb88=_0x2c91f8;var _0x2700e6=[];for(var _0x491cc3 in _0x313a58)if(Object['prototype'][_0x37cb88(0x142)][_0x37cb88(0x186)](_0x313a58,_0x491cc3))_0x2700e6[_0x2700e6[_0x37cb88(0x17f)]]=_0x491cc3;return _0x2700e6;},_0xf31917(_0x3d6906);};return function(_0xb021f3){const _0x518e01=a35_0x39f2;if(_0xb021f3&&_0xb021f3['__esModule'])return _0xb021f3;var _0x20a056={};if(_0xb021f3!=null){for(var _0x1b4b5d=_0xf31917(_0xb021f3),_0x5a16dc=0x0;_0x5a16dc<_0x1b4b5d[_0x518e01(0x17f)];_0x5a16dc++)if(_0x1b4b5d[_0x5a16dc]!==_0x518e01(0x146))__createBinding(_0x20a056,_0xb021f3,_0x1b4b5d[_0x5a16dc]);}return __setModuleDefault(_0x20a056,_0xb021f3),_0x20a056;};}()),__importDefault=this&&this['__importDefault']||function(_0x89287e){const _0x1ed302=a35_0x27b09a;return _0x89287e&&_0x89287e[_0x1ed302(0x16f)]?_0x89287e:{'default':_0x89287e};};Object[a35_0x27b09a(0x17c)](exports,a35_0x27b09a(0x16f),{'value':!![]});function a35_0x39f2(_0x192976,_0x2ad312){_0x192976=_0x192976-0x13e;const _0x1531df=a35_0x1531();let _0x39f2a9=_0x1531df[_0x192976];return _0x39f2a9;}const express_1=require(a35_0x27b09a(0x16b)),database_1=__importDefault(require('../config/database')),router=(0x0,express_1[a35_0x27b09a(0x15c)])(),verifyInternalApiKey=(_0x35c612,_0x390d4c,_0x25b533)=>{const _0x2adf04=a35_0x27b09a,_0x4ca768=_0x35c612[_0x2adf04(0x149)]['authorization'];if(!_0x4ca768||!_0x4ca768[_0x2adf04(0x168)](_0x2adf04(0x160)))return _0x390d4c[_0x2adf04(0x179)](0x191)[_0x2adf04(0x140)]({'error':_0x2adf04(0x185)});const _0x36c345=_0x4ca768['substring'](0x7);if(_0x36c345!==_0x2adf04(0x13e))return _0x390d4c[_0x2adf04(0x179)](0x191)[_0x2adf04(0x140)]({'error':_0x2adf04(0x172)});_0x25b533();};function a35_0x1531(){const _0x493ffe=['paymentMethod','âœ…\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','1031576dhpqZw','entries','keys','log','payment_method','275709NfoPMQ','then','getOwnPropertyDescriptor','Router','create','\x20with\x20gateway\x20settings','6148645GETeQg','Bearer\x20','payment','1232eWaszY','âœ…\x20Internal\x20API:\x20Payment\x20','paid_at','toISOString','resolve','currency','startsWith','/health','ðŸ”„\x20Internal\x20API:\x20Updating\x20payment\x20','express','Internal\x20API\x20error\x20updating\x20payment:','card_last4','error','__esModule','username','getOwnPropertyNames','Invalid\x20internal\x20API\x20key','configurable','Internal\x20server\x20error','__importStar','ðŸ”\x20Internal\x20API:\x20Getting\x20payment\x20','Internal\x20API\x20error\x20getting\x20payment:','1589532ZswYcP','status','writable','failureMessage','defineProperty','gateway_payment_id','24705azJokt','length','1492506gNwytC','/payments/:id/gateway-settings','cardLast4','PAID','failure_message','Missing\x20or\x20invalid\x20authorization\x20header','call','internal-api-key','Error\x20sending\x20webhook\x20notification:','json','shop','hasOwnProperty','patch','gatewayPaymentId','__setModuleDefault','default','ðŸŽ‰\x20Payment\x20','string','headers','12KOiYgH','Payment\x20not\x20found','paidAt','findUnique','No\x20valid\x20fields\x20to\x20update','__createBinding','4525927yZCjEh','get'];a35_0x1531=function(){return _0x493ffe;};return a35_0x1531();}router['get'](a35_0x27b09a(0x181),verifyInternalApiKey,async(_0xd4c5ee,_0x40d6e3)=>{const _0x303cd6=a35_0x27b09a;try{const {id:_0x4e3aa8}=_0xd4c5ee['params'];console[_0x303cd6(0x157)](_0x303cd6(0x176)+_0x4e3aa8+_0x303cd6(0x15e));const _0x54f8bb=await database_1['default'][_0x303cd6(0x161)][_0x303cd6(0x14d)]({'where':{'id':_0x4e3aa8},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x54f8bb)return _0x40d6e3['status'](0x194)[_0x303cd6(0x140)]({'error':_0x303cd6(0x14b)});console[_0x303cd6(0x157)](_0x303cd6(0x153)+_0x54f8bb[_0x303cd6(0x141)][_0x303cd6(0x170)]),_0x40d6e3[_0x303cd6(0x140)]({'id':_0x54f8bb['id'],'amount':_0x54f8bb['amount'],'currency':_0x54f8bb[_0x303cd6(0x167)],'status':_0x54f8bb[_0x303cd6(0x179)],'orderId':_0x54f8bb['orderId'],'shop':_0x54f8bb[_0x303cd6(0x141)]});}catch(_0xbbbcf5){console[_0x303cd6(0x16e)](_0x303cd6(0x177),_0xbbbcf5),_0x40d6e3[_0x303cd6(0x179)](0x1f4)[_0x303cd6(0x140)]({'error':_0x303cd6(0x174)});}}),router[a35_0x27b09a(0x143)]('/payments/:id/update',verifyInternalApiKey,async(_0x2b222c,_0x2639f4)=>{const _0x44df28=a35_0x27b09a;try{const {id:_0x3db193}=_0x2b222c['params'],_0x3513c4=_0x2b222c['body'];console[_0x44df28(0x157)](_0x44df28(0x16a)+_0x3db193,_0x3513c4);const _0x158edc=[_0x44df28(0x179),'gateway_payment_id',_0x44df28(0x144),_0x44df28(0x16d),_0x44df28(0x182),_0x44df28(0x158),_0x44df28(0x152),_0x44df28(0x164),_0x44df28(0x14c),_0x44df28(0x184),_0x44df28(0x17b)],_0xcb5f56={};for(const [_0x15157e,_0x58cbab]of Object[_0x44df28(0x155)](_0x3513c4)){if(_0x158edc['includes'](_0x15157e)){let _0x31615d=_0x15157e;if(_0x15157e===_0x44df28(0x17d)||_0x15157e===_0x44df28(0x144))_0x31615d=_0x44df28(0x144);else{if(_0x15157e==='card_last4'||_0x15157e===_0x44df28(0x182))_0x31615d='cardLast4';else{if(_0x15157e===_0x44df28(0x158)||_0x15157e==='paymentMethod')_0x31615d='paymentMethod';else{if(_0x15157e===_0x44df28(0x164)||_0x15157e==='paidAt')_0x31615d=_0x44df28(0x14c);else(_0x15157e==='failure_message'||_0x15157e==='failureMessage')&&(_0x31615d=_0x44df28(0x17b));}}}_0x31615d===_0x44df28(0x14c)&&typeof _0x58cbab===_0x44df28(0x148)?_0xcb5f56[_0x31615d]=new Date(_0x58cbab):_0xcb5f56[_0x31615d]=_0x58cbab;}}if(Object[_0x44df28(0x156)](_0xcb5f56)[_0x44df28(0x17f)]===0x0)return _0x2639f4[_0x44df28(0x179)](0x190)['json']({'error':_0x44df28(0x14e)});const _0x297a7e=await database_1[_0x44df28(0x146)][_0x44df28(0x161)]['update']({'where':{'id':_0x3db193},'data':_0xcb5f56});console[_0x44df28(0x157)](_0x44df28(0x163)+_0x3db193+'\x20updated\x20successfully');if(_0xcb5f56[_0x44df28(0x179)]===_0x44df28(0x183)){console[_0x44df28(0x157)](_0x44df28(0x147)+_0x3db193+'\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing');try{const {WebhookService:_0x315087}=await Promise[_0x44df28(0x166)]()[_0x44df28(0x15a)](()=>__importStar(require('../services/webhookService'))),_0x2c8ec4=new _0x315087(),_0xc64429=await database_1[_0x44df28(0x146)][_0x44df28(0x161)]['findUnique']({'where':{'id':_0x3db193},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0xc64429&&console[_0x44df28(0x157)]('ðŸ“¤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20'+_0x3db193);}catch(_0x562e67){console['error'](_0x44df28(0x13f),_0x562e67);}}_0x2639f4[_0x44df28(0x140)]({'success':!![],'payment':{'id':_0x297a7e['id'],'status':_0x297a7e['status']}});}catch(_0x2ff09d){console[_0x44df28(0x16e)](_0x44df28(0x16c),_0x2ff09d),_0x2639f4[_0x44df28(0x179)](0x1f4)[_0x44df28(0x140)]({'error':'Internal\x20server\x20error'});}}),router[a35_0x27b09a(0x151)](a35_0x27b09a(0x169),(_0x78de89,_0x462ad8)=>{const _0x5b5ad9=a35_0x27b09a;_0x462ad8[_0x5b5ad9(0x140)]({'status':'ok','timestamp':new Date()[_0x5b5ad9(0x165)]()});}),exports['default']=router;