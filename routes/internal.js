'use strict';const a25_0x450117=a25_0xdf4d;function a25_0xdf4d(_0x2c10ee,_0x423673){const _0x2fbfea=a25_0x2fbf();return a25_0xdf4d=function(_0xdf4d62,_0x78d098){_0xdf4d62=_0xdf4d62-0x111;let _0x20db1b=_0x2fbfea[_0xdf4d62];return _0x20db1b;},a25_0xdf4d(_0x2c10ee,_0x423673);}(function(_0x418e2e,_0x36377a){const _0x1d0f90=a25_0xdf4d,_0x429b4c=_0x418e2e();while(!![]){try{const _0x5700b8=-parseInt(_0x1d0f90(0x11d))/0x1*(-parseInt(_0x1d0f90(0x117))/0x2)+parseInt(_0x1d0f90(0x114))/0x3+parseInt(_0x1d0f90(0x153))/0x4*(parseInt(_0x1d0f90(0x141))/0x5)+-parseInt(_0x1d0f90(0x136))/0x6*(-parseInt(_0x1d0f90(0x14e))/0x7)+parseInt(_0x1d0f90(0x152))/0x8+parseInt(_0x1d0f90(0x111))/0x9*(parseInt(_0x1d0f90(0x13c))/0xa)+-parseInt(_0x1d0f90(0x12f))/0xb*(parseInt(_0x1d0f90(0x128))/0xc);if(_0x5700b8===_0x36377a)break;else _0x429b4c['push'](_0x429b4c['shift']());}catch(_0x3120d6){_0x429b4c['push'](_0x429b4c['shift']());}}}(a25_0x2fbf,0x40605));function a25_0x2fbf(){const _0x47ea22=['12tJtWlm','body','resolve','hasOwnProperty','3015LkZqlM','__setModuleDefault','patch','49686PpcNXd','configurable','\x20updated\x20successfully','168NKRmqB','toISOString','currency','✅\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','__createBinding','paidAt','177HSFYpi','log','__esModule','prototype','/payments/:id/update','express','card_last4','Router','create','Missing\x20or\x20invalid\x20authorization\x20header','shop','89772uxedrb','params','payment_method','payment','error','json','paymentMethod','704MFqOuc','failureMessage','paid_at','Invalid\x20internal\x20API\x20key','string','status','length','4386YdTmGg','getOwnPropertyDescriptor','__importDefault','internal-api-key','No\x20valid\x20fields\x20to\x20update','orderId','3830XMcbxV','entries','Internal\x20server\x20error','gateway_payment_id','username','119680YQBdfV','startsWith','✅\x20Internal\x20API:\x20Payment\x20','keys','defineProperty','failure_message','Bearer\x20','cardLast4','substring','get','findUnique','default','\x20with\x20gateway\x20settings','3115AujwoP','gatewayPaymentId','update','PAID','1485048tVutXN'];a25_0x2fbf=function(){return _0x47ea22;};return a25_0x2fbf();}var __createBinding=this&&this[a25_0x450117(0x11b)]||(Object[a25_0x450117(0x125)]?function(_0x4f467d,_0x829591,_0x2d7645,_0x311013){const _0x585137=a25_0x450117;if(_0x311013===undefined)_0x311013=_0x2d7645;var _0x2b069a=Object[_0x585137(0x137)](_0x829591,_0x2d7645);(!_0x2b069a||(_0x585137(0x14a)in _0x2b069a?!_0x829591['__esModule']:_0x2b069a['writable']||_0x2b069a[_0x585137(0x115)]))&&(_0x2b069a={'enumerable':!![],'get':function(){return _0x829591[_0x2d7645];}}),Object[_0x585137(0x145)](_0x4f467d,_0x311013,_0x2b069a);}:function(_0x51bf58,_0x536401,_0x1074bd,_0x5d3ba9){if(_0x5d3ba9===undefined)_0x5d3ba9=_0x1074bd;_0x51bf58[_0x5d3ba9]=_0x536401[_0x1074bd];}),__setModuleDefault=this&&this[a25_0x450117(0x112)]||(Object[a25_0x450117(0x125)]?function(_0x559b8e,_0x4cf9eb){const _0x45c34a=a25_0x450117;Object[_0x45c34a(0x145)](_0x559b8e,_0x45c34a(0x14c),{'enumerable':!![],'value':_0x4cf9eb});}:function(_0x103b54,_0x1a9b93){const _0x570f7a=a25_0x450117;_0x103b54[_0x570f7a(0x14c)]=_0x1a9b93;}),__importStar=this&&this['__importStar']||(function(){var _0x200c21=function(_0x3ec476){return _0x200c21=Object['getOwnPropertyNames']||function(_0x1436d3){const _0x357ec5=a25_0xdf4d;var _0x36d179=[];for(var _0x3bf91f in _0x1436d3)if(Object[_0x357ec5(0x120)][_0x357ec5(0x156)]['call'](_0x1436d3,_0x3bf91f))_0x36d179[_0x36d179[_0x357ec5(0x135)]]=_0x3bf91f;return _0x36d179;},_0x200c21(_0x3ec476);};return function(_0x4a59f2){const _0x2dd103=a25_0xdf4d;if(_0x4a59f2&&_0x4a59f2['__esModule'])return _0x4a59f2;var _0x5ca556={};if(_0x4a59f2!=null){for(var _0x19a22b=_0x200c21(_0x4a59f2),_0x27cd5e=0x0;_0x27cd5e<_0x19a22b[_0x2dd103(0x135)];_0x27cd5e++)if(_0x19a22b[_0x27cd5e]!=='default')__createBinding(_0x5ca556,_0x4a59f2,_0x19a22b[_0x27cd5e]);}return __setModuleDefault(_0x5ca556,_0x4a59f2),_0x5ca556;};}()),__importDefault=this&&this[a25_0x450117(0x138)]||function(_0x2ef5c6){const _0x28ca4e=a25_0x450117;return _0x2ef5c6&&_0x2ef5c6[_0x28ca4e(0x11f)]?_0x2ef5c6:{'default':_0x2ef5c6};};Object[a25_0x450117(0x145)](exports,'__esModule',{'value':!![]});const express_1=require(a25_0x450117(0x122)),database_1=__importDefault(require('../config/database')),router=(0x0,express_1[a25_0x450117(0x124)])(),verifyInternalApiKey=(_0x46b470,_0x4518bd,_0x568f84)=>{const _0x1c7b10=a25_0x450117,_0x7dc84b=_0x46b470['headers']['authorization'];if(!_0x7dc84b||!_0x7dc84b[_0x1c7b10(0x142)](_0x1c7b10(0x147)))return _0x4518bd[_0x1c7b10(0x134)](0x191)['json']({'error':_0x1c7b10(0x126)});const _0x9e879b=_0x7dc84b[_0x1c7b10(0x149)](0x7);if(_0x9e879b!==_0x1c7b10(0x139))return _0x4518bd[_0x1c7b10(0x134)](0x191)['json']({'error':_0x1c7b10(0x132)});_0x568f84();};router[a25_0x450117(0x14a)]('/payments/:id/gateway-settings',verifyInternalApiKey,async(_0x199a66,_0x48985b)=>{const _0x518827=a25_0x450117;try{const {id:_0x2b320c}=_0x199a66[_0x518827(0x129)];console['log']('🔍\x20Internal\x20API:\x20Getting\x20payment\x20'+_0x2b320c+_0x518827(0x14d));const _0x19e893=await database_1[_0x518827(0x14c)][_0x518827(0x12b)]['findUnique']({'where':{'id':_0x2b320c},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x19e893)return _0x48985b[_0x518827(0x134)](0x194)[_0x518827(0x12d)]({'error':'Payment\x20not\x20found'});console[_0x518827(0x11e)](_0x518827(0x11a)+_0x19e893[_0x518827(0x127)][_0x518827(0x140)]),_0x48985b['json']({'id':_0x19e893['id'],'amount':_0x19e893['amount'],'currency':_0x19e893[_0x518827(0x119)],'status':_0x19e893['status'],'orderId':_0x19e893[_0x518827(0x13b)],'shop':_0x19e893[_0x518827(0x127)]});}catch(_0x974354){console['error']('Internal\x20API\x20error\x20getting\x20payment:',_0x974354),_0x48985b['status'](0x1f4)[_0x518827(0x12d)]({'error':_0x518827(0x13e)});}}),router[a25_0x450117(0x113)](a25_0x450117(0x121),verifyInternalApiKey,async(_0x97a894,_0x1b6688)=>{const _0x4e1827=a25_0x450117;try{const {id:_0x8040d2}=_0x97a894[_0x4e1827(0x129)],_0x273e18=_0x97a894[_0x4e1827(0x154)];console['log']('🔄\x20Internal\x20API:\x20Updating\x20payment\x20'+_0x8040d2,_0x273e18);const _0x20aaa7=[_0x4e1827(0x134),_0x4e1827(0x13f),_0x4e1827(0x14f),'card_last4','cardLast4',_0x4e1827(0x12a),_0x4e1827(0x12e),_0x4e1827(0x131),_0x4e1827(0x11c),'failure_message',_0x4e1827(0x130)],_0x2b8bfc={};for(const [_0x1fe2c0,_0x3f6ea4]of Object[_0x4e1827(0x13d)](_0x273e18)){if(_0x20aaa7['includes'](_0x1fe2c0)){let _0x4b54be=_0x1fe2c0;if(_0x1fe2c0===_0x4e1827(0x13f)||_0x1fe2c0===_0x4e1827(0x14f))_0x4b54be=_0x4e1827(0x14f);else{if(_0x1fe2c0===_0x4e1827(0x123)||_0x1fe2c0===_0x4e1827(0x148))_0x4b54be=_0x4e1827(0x148);else{if(_0x1fe2c0==='payment_method'||_0x1fe2c0==='paymentMethod')_0x4b54be=_0x4e1827(0x12e);else{if(_0x1fe2c0===_0x4e1827(0x131)||_0x1fe2c0==='paidAt')_0x4b54be=_0x4e1827(0x11c);else(_0x1fe2c0===_0x4e1827(0x146)||_0x1fe2c0===_0x4e1827(0x130))&&(_0x4b54be=_0x4e1827(0x130));}}}_0x4b54be==='paidAt'&&typeof _0x3f6ea4===_0x4e1827(0x133)?_0x2b8bfc[_0x4b54be]=new Date(_0x3f6ea4):_0x2b8bfc[_0x4b54be]=_0x3f6ea4;}}if(Object[_0x4e1827(0x144)](_0x2b8bfc)['length']===0x0)return _0x1b6688[_0x4e1827(0x134)](0x190)[_0x4e1827(0x12d)]({'error':_0x4e1827(0x13a)});const _0x2ae299=await database_1[_0x4e1827(0x14c)][_0x4e1827(0x12b)][_0x4e1827(0x150)]({'where':{'id':_0x8040d2},'data':_0x2b8bfc});console[_0x4e1827(0x11e)](_0x4e1827(0x143)+_0x8040d2+_0x4e1827(0x116));if(_0x2b8bfc[_0x4e1827(0x134)]===_0x4e1827(0x151)){console[_0x4e1827(0x11e)]('🎉\x20Payment\x20'+_0x8040d2+'\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing');try{const {WebhookService:_0x38990e}=await Promise[_0x4e1827(0x155)]()['then'](()=>__importStar(require('../services/webhookService'))),_0x5aac28=new _0x38990e(),_0x2d6120=await database_1[_0x4e1827(0x14c)][_0x4e1827(0x12b)][_0x4e1827(0x14b)]({'where':{'id':_0x8040d2},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x2d6120&&console[_0x4e1827(0x11e)]('📤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20'+_0x8040d2);}catch(_0x58d0e2){console[_0x4e1827(0x12c)]('Error\x20sending\x20webhook\x20notification:',_0x58d0e2);}}_0x1b6688[_0x4e1827(0x12d)]({'success':!![],'payment':{'id':_0x2ae299['id'],'status':_0x2ae299[_0x4e1827(0x134)]}});}catch(_0x899bcc){console[_0x4e1827(0x12c)]('Internal\x20API\x20error\x20updating\x20payment:',_0x899bcc),_0x1b6688[_0x4e1827(0x134)](0x1f4)[_0x4e1827(0x12d)]({'error':_0x4e1827(0x13e)});}}),router[a25_0x450117(0x14a)]('/health',(_0x266655,_0x95cf78)=>{const _0x16498e=a25_0x450117;_0x95cf78['json']({'status':'ok','timestamp':new Date()[_0x16498e(0x118)]()});}),exports[a25_0x450117(0x14c)]=router;