'use strict';function a32_0x3f2b(_0x41d46f,_0x47332d){_0x41d46f=_0x41d46f-0x92;const _0x5140cc=a32_0x5140();let _0x3f2be8=_0x5140cc[_0x41d46f];return _0x3f2be8;}const a32_0x293f7a=a32_0x3f2b;(function(_0x524682,_0x5c7864){const _0x1d5b63=a32_0x3f2b,_0x318688=_0x524682();while(!![]){try{const _0x34f380=-parseInt(_0x1d5b63(0xa4))/0x1+parseInt(_0x1d5b63(0xaf))/0x2*(-parseInt(_0x1d5b63(0xac))/0x3)+-parseInt(_0x1d5b63(0xb9))/0x4+parseInt(_0x1d5b63(0x9b))/0x5*(-parseInt(_0x1d5b63(0xb7))/0x6)+parseInt(_0x1d5b63(0xd3))/0x7*(-parseInt(_0x1d5b63(0xcb))/0x8)+-parseInt(_0x1d5b63(0xab))/0x9*(parseInt(_0x1d5b63(0xd7))/0xa)+parseInt(_0x1d5b63(0xd8))/0xb;if(_0x34f380===_0x5c7864)break;else _0x318688['push'](_0x318688['shift']());}catch(_0x41b2a5){_0x318688['push'](_0x318688['shift']());}}}(a32_0x5140,0x82070));var __createBinding=this&&this[a32_0x293f7a(0xbf)]||(Object['create']?function(_0x1bd8e9,_0x13c6f0,_0x53796c,_0x9015fd){const _0x28d8a0=a32_0x293f7a;if(_0x9015fd===undefined)_0x9015fd=_0x53796c;var _0x401aa9=Object[_0x28d8a0(0x9a)](_0x13c6f0,_0x53796c);(!_0x401aa9||(_0x28d8a0(0x9f)in _0x401aa9?!_0x13c6f0[_0x28d8a0(0xc1)]:_0x401aa9[_0x28d8a0(0xb3)]||_0x401aa9[_0x28d8a0(0xd6)]))&&(_0x401aa9={'enumerable':!![],'get':function(){return _0x13c6f0[_0x53796c];}}),Object[_0x28d8a0(0xbc)](_0x1bd8e9,_0x9015fd,_0x401aa9);}:function(_0x355808,_0x3f73f6,_0x422c0d,_0x52eb15){if(_0x52eb15===undefined)_0x52eb15=_0x422c0d;_0x355808[_0x52eb15]=_0x3f73f6[_0x422c0d];}),__setModuleDefault=this&&this[a32_0x293f7a(0xca)]||(Object[a32_0x293f7a(0xdd)]?function(_0xc303f7,_0x2f3d81){Object['defineProperty'](_0xc303f7,'default',{'enumerable':!![],'value':_0x2f3d81});}:function(_0x39a6f1,_0x2a02d7){const _0x49f752=a32_0x293f7a;_0x39a6f1[_0x49f752(0xd1)]=_0x2a02d7;}),__importStar=this&&this['__importStar']||(function(){var _0x506e1b=function(_0x4782eb){return _0x506e1b=Object['getOwnPropertyNames']||function(_0x3ed27b){const _0x3d91a8=a32_0x3f2b;var _0x3aa5a6=[];for(var _0x2dc6b7 in _0x3ed27b)if(Object[_0x3d91a8(0x93)]['hasOwnProperty']['call'](_0x3ed27b,_0x2dc6b7))_0x3aa5a6[_0x3aa5a6[_0x3d91a8(0xc9)]]=_0x2dc6b7;return _0x3aa5a6;},_0x506e1b(_0x4782eb);};return function(_0x325375){const _0x5096bb=a32_0x3f2b;if(_0x325375&&_0x325375['__esModule'])return _0x325375;var _0x49d3b4={};if(_0x325375!=null){for(var _0x32b1f2=_0x506e1b(_0x325375),_0x22e9fb=0x0;_0x22e9fb<_0x32b1f2['length'];_0x22e9fb++)if(_0x32b1f2[_0x22e9fb]!==_0x5096bb(0xd1))__createBinding(_0x49d3b4,_0x325375,_0x32b1f2[_0x22e9fb]);}return __setModuleDefault(_0x49d3b4,_0x325375),_0x49d3b4;};}()),__importDefault=this&&this[a32_0x293f7a(0xcc)]||function(_0x40fd01){const _0x4c6206=a32_0x293f7a;return _0x40fd01&&_0x40fd01[_0x4c6206(0xc1)]?_0x40fd01:{'default':_0x40fd01};};function a32_0x5140(){const _0x1dd6a5=['\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','Internal\x20server\x20error','269953EZtLMU','patch','shop','toISOString','/payments/:id/gateway-settings','body','Missing\x20or\x20invalid\x20authorization\x20header','12357saXYuT','3lhlgvH','startsWith','entries','1716606YhEqTg','failureMessage','PAID','No\x20valid\x20fields\x20to\x20update','writable','internal-api-key','gateway_payment_id','/health','6uVTAtR','ðŸ”„\x20Internal\x20API:\x20Updating\x20payment\x20','316272Hfzonh','status','Internal\x20API\x20error\x20updating\x20payment:','defineProperty','../config/database','findUnique','__createBinding','log','__esModule','ðŸ”\x20Internal\x20API:\x20Getting\x20payment\x20','authorization','failure_message','express','cardLast4','username','âœ…\x20Internal\x20API:\x20Payment\x20','length','__setModuleDefault','624792xplzpJ','__importDefault','substring','âœ…\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','paidAt','Internal\x20API\x20error\x20getting\x20payment:','default','\x20updated\x20successfully','28MgknHh','Bearer\x20','Router','configurable','6230oFTdtd','43221354PwXBPh','currency','resolve','json','string','create','payment','prototype','Payment\x20not\x20found','../services/webhookService','headers','Error\x20sending\x20webhook\x20notification:','ðŸ“¤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','error','getOwnPropertyDescriptor','5107615nUUqyW','then','paid_at','paymentMethod','get','ðŸŽ‰\x20Payment\x20','update'];a32_0x5140=function(){return _0x1dd6a5;};return a32_0x5140();}Object['defineProperty'](exports,'__esModule',{'value':!![]});const express_1=require(a32_0x293f7a(0xc5)),database_1=__importDefault(require(a32_0x293f7a(0xbd))),router=(0x0,express_1[a32_0x293f7a(0xd5)])(),verifyInternalApiKey=(_0x48fada,_0x2c0ffe,_0x139001)=>{const _0x3f9e61=a32_0x293f7a,_0x2ac4c2=_0x48fada[_0x3f9e61(0x96)][_0x3f9e61(0xc3)];if(!_0x2ac4c2||!_0x2ac4c2[_0x3f9e61(0xad)](_0x3f9e61(0xd4)))return _0x2c0ffe[_0x3f9e61(0xba)](0x191)[_0x3f9e61(0xdb)]({'error':_0x3f9e61(0xaa)});const _0x53433d=_0x2ac4c2[_0x3f9e61(0xcd)](0x7);if(_0x53433d!==_0x3f9e61(0xb4))return _0x2c0ffe[_0x3f9e61(0xba)](0x191)[_0x3f9e61(0xdb)]({'error':'Invalid\x20internal\x20API\x20key'});_0x139001();};router['get'](a32_0x293f7a(0xa8),verifyInternalApiKey,async(_0x572fe7,_0xfbe9a)=>{const _0x4630d4=a32_0x293f7a;try{const {id:_0x5eebc6}=_0x572fe7['params'];console[_0x4630d4(0xc0)](_0x4630d4(0xc2)+_0x5eebc6+'\x20with\x20gateway\x20settings');const _0x13d2d6=await database_1[_0x4630d4(0xd1)]['payment'][_0x4630d4(0xbe)]({'where':{'id':_0x5eebc6},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x13d2d6)return _0xfbe9a[_0x4630d4(0xba)](0x194)[_0x4630d4(0xdb)]({'error':_0x4630d4(0x94)});console['log'](_0x4630d4(0xce)+_0x13d2d6[_0x4630d4(0xa6)][_0x4630d4(0xc7)]),_0xfbe9a[_0x4630d4(0xdb)]({'id':_0x13d2d6['id'],'amount':_0x13d2d6['amount'],'currency':_0x13d2d6[_0x4630d4(0xd9)],'status':_0x13d2d6[_0x4630d4(0xba)],'orderId':_0x13d2d6['orderId'],'shop':_0x13d2d6['shop']});}catch(_0x11ed4f){console[_0x4630d4(0x99)](_0x4630d4(0xd0),_0x11ed4f),_0xfbe9a['status'](0x1f4)[_0x4630d4(0xdb)]({'error':_0x4630d4(0xa3)});}}),router[a32_0x293f7a(0xa5)]('/payments/:id/update',verifyInternalApiKey,async(_0x97bdbd,_0x1c394b)=>{const _0x1792b8=a32_0x293f7a;try{const {id:_0x287d52}=_0x97bdbd['params'],_0x2a3089=_0x97bdbd[_0x1792b8(0xa9)];console[_0x1792b8(0xc0)](_0x1792b8(0xb8)+_0x287d52,_0x2a3089);const _0x3faf8c=['status',_0x1792b8(0xb5),'gatewayPaymentId','card_last4',_0x1792b8(0xc6),'payment_method',_0x1792b8(0x9e),_0x1792b8(0x9d),_0x1792b8(0xcf),_0x1792b8(0xc4),_0x1792b8(0xb0)],_0x16bdeb={};for(const [_0x1225c5,_0x1781fb]of Object[_0x1792b8(0xae)](_0x2a3089)){if(_0x3faf8c['includes'](_0x1225c5)){let _0x1677e1=_0x1225c5;if(_0x1225c5===_0x1792b8(0xb5)||_0x1225c5==='gatewayPaymentId')_0x1677e1='gatewayPaymentId';else{if(_0x1225c5==='card_last4'||_0x1225c5===_0x1792b8(0xc6))_0x1677e1=_0x1792b8(0xc6);else{if(_0x1225c5==='payment_method'||_0x1225c5===_0x1792b8(0x9e))_0x1677e1=_0x1792b8(0x9e);else{if(_0x1225c5===_0x1792b8(0x9d)||_0x1225c5===_0x1792b8(0xcf))_0x1677e1=_0x1792b8(0xcf);else(_0x1225c5===_0x1792b8(0xc4)||_0x1225c5===_0x1792b8(0xb0))&&(_0x1677e1=_0x1792b8(0xb0));}}}_0x1677e1===_0x1792b8(0xcf)&&typeof _0x1781fb===_0x1792b8(0xdc)?_0x16bdeb[_0x1677e1]=new Date(_0x1781fb):_0x16bdeb[_0x1677e1]=_0x1781fb;}}if(Object['keys'](_0x16bdeb)[_0x1792b8(0xc9)]===0x0)return _0x1c394b['status'](0x190)[_0x1792b8(0xdb)]({'error':_0x1792b8(0xb2)});const _0x22492d=await database_1[_0x1792b8(0xd1)]['payment'][_0x1792b8(0xa1)]({'where':{'id':_0x287d52},'data':_0x16bdeb});console[_0x1792b8(0xc0)](_0x1792b8(0xc8)+_0x287d52+_0x1792b8(0xd2));if(_0x16bdeb['status']===_0x1792b8(0xb1)){console[_0x1792b8(0xc0)](_0x1792b8(0xa0)+_0x287d52+_0x1792b8(0xa2));try{const {WebhookService:_0x1dde70}=await Promise[_0x1792b8(0xda)]()[_0x1792b8(0x9c)](()=>__importStar(require(_0x1792b8(0x95)))),_0x53e235=new _0x1dde70(),_0xdf5c9d=await database_1[_0x1792b8(0xd1)][_0x1792b8(0x92)]['findUnique']({'where':{'id':_0x287d52},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0xdf5c9d&&console['log'](_0x1792b8(0x98)+_0x287d52);}catch(_0x983598){console[_0x1792b8(0x99)](_0x1792b8(0x97),_0x983598);}}_0x1c394b[_0x1792b8(0xdb)]({'success':!![],'payment':{'id':_0x22492d['id'],'status':_0x22492d['status']}});}catch(_0x378ed9){console['error'](_0x1792b8(0xbb),_0x378ed9),_0x1c394b['status'](0x1f4)[_0x1792b8(0xdb)]({'error':_0x1792b8(0xa3)});}}),router['get'](a32_0x293f7a(0xb6),(_0x58dfcb,_0x39bde2)=>{const _0x5b08a4=a32_0x293f7a;_0x39bde2[_0x5b08a4(0xdb)]({'status':'ok','timestamp':new Date()[_0x5b08a4(0xa7)]()});}),exports[a32_0x293f7a(0xd1)]=router;