'use strict';const a27_0x20414d=a27_0x3273;(function(_0x992932,_0x3f4342){const _0x2893ea=a27_0x3273,_0x4d99e3=_0x992932();while(!![]){try{const _0x507f19=-parseInt(_0x2893ea(0x142))/0x1+parseInt(_0x2893ea(0x12c))/0x2+parseInt(_0x2893ea(0x123))/0x3*(-parseInt(_0x2893ea(0x125))/0x4)+-parseInt(_0x2893ea(0x12d))/0x5*(-parseInt(_0x2893ea(0x14c))/0x6)+parseInt(_0x2893ea(0x124))/0x7*(-parseInt(_0x2893ea(0x129))/0x8)+parseInt(_0x2893ea(0x13f))/0x9*(-parseInt(_0x2893ea(0x140))/0xa)+parseInt(_0x2893ea(0x166))/0xb;if(_0x507f19===_0x3f4342)break;else _0x4d99e3['push'](_0x4d99e3['shift']());}catch(_0xd02674){_0x4d99e3['push'](_0x4d99e3['shift']());}}}(a27_0x5e09,0xaebf5));function a27_0x3273(_0x4cbde2,_0x396b89){const _0x5e0927=a27_0x5e09();return a27_0x3273=function(_0x327359,_0xe52700){_0x327359=_0x327359-0x120;let _0x54fd8e=_0x5e0927[_0x327359];return _0x54fd8e;},a27_0x3273(_0x4cbde2,_0x396b89);}var __createBinding=this&&this[a27_0x20414d(0x165)]||(Object['create']?function(_0x2722d2,_0xf5059e,_0x50c628,_0x35b54b){const _0x45d559=a27_0x20414d;if(_0x35b54b===undefined)_0x35b54b=_0x50c628;var _0x5bca7f=Object['getOwnPropertyDescriptor'](_0xf5059e,_0x50c628);(!_0x5bca7f||('get'in _0x5bca7f?!_0xf5059e[_0x45d559(0x126)]:_0x5bca7f[_0x45d559(0x161)]||_0x5bca7f[_0x45d559(0x168)]))&&(_0x5bca7f={'enumerable':!![],'get':function(){return _0xf5059e[_0x50c628];}}),Object[_0x45d559(0x137)](_0x2722d2,_0x35b54b,_0x5bca7f);}:function(_0x20cf8d,_0x1d4e94,_0x5eea31,_0x3d9106){if(_0x3d9106===undefined)_0x3d9106=_0x5eea31;_0x20cf8d[_0x3d9106]=_0x1d4e94[_0x5eea31];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x2a40af,_0x523cd9){const _0x25ecc8=a27_0x20414d;Object[_0x25ecc8(0x137)](_0x2a40af,_0x25ecc8(0x14d),{'enumerable':!![],'value':_0x523cd9});}:function(_0x41033a,_0x88026){const _0x1497d4=a27_0x20414d;_0x41033a[_0x1497d4(0x14d)]=_0x88026;}),__importStar=this&&this['__importStar']||(function(){var _0x174f0c=function(_0x44abcb){const _0x4ec3a4=a27_0x3273;return _0x174f0c=Object[_0x4ec3a4(0x147)]||function(_0x3b7c58){const _0x5146cc=_0x4ec3a4;var _0x8c02ed=[];for(var _0x3492e2 in _0x3b7c58)if(Object[_0x5146cc(0x13c)]['hasOwnProperty']['call'](_0x3b7c58,_0x3492e2))_0x8c02ed[_0x8c02ed[_0x5146cc(0x128)]]=_0x3492e2;return _0x8c02ed;},_0x174f0c(_0x44abcb);};return function(_0x2b0ed4){const _0x3d20b2=a27_0x3273;if(_0x2b0ed4&&_0x2b0ed4['__esModule'])return _0x2b0ed4;var _0x3ac253={};if(_0x2b0ed4!=null){for(var _0x56612e=_0x174f0c(_0x2b0ed4),_0x279cd4=0x0;_0x279cd4<_0x56612e[_0x3d20b2(0x128)];_0x279cd4++)if(_0x56612e[_0x279cd4]!==_0x3d20b2(0x14d))__createBinding(_0x3ac253,_0x2b0ed4,_0x56612e[_0x279cd4]);}return __setModuleDefault(_0x3ac253,_0x2b0ed4),_0x3ac253;};}()),__importDefault=this&&this['__importDefault']||function(_0x32f731){return _0x32f731&&_0x32f731['__esModule']?_0x32f731:{'default':_0x32f731};};function a27_0x5e09(){const _0x3b6be0=['PAID','9VVLGBs','13707410KqrrTp','authorization','942325WFCWBl','/health','\x20with\x20gateway\x20settings','card_last4','paid_at','getOwnPropertyNames','resolve','json','substring','entries','174ZFrmUM','default','Payment\x20not\x20found','/payments/:id/update','Internal\x20server\x20error','\x20updated\x20successfully','headers','🔍\x20Internal\x20API:\x20Getting\x20payment\x20','patch','startsWith','error','internal-api-key','then','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','toISOString','update','shop','🔄\x20Internal\x20API:\x20Updating\x20payment\x20','Router','gateway_payment_id','params','writable','paidAt','includes','username','__createBinding','32821008yKYSNg','express','configurable','cardLast4','payment','body','2316ABgVBt','17521HvrtiB','128IKcsrb','__esModule','log','length','4104pJwTkt','failure_message','findUnique','1682078XxzURR','88415iYqsSe','currency','../services/webhookService','keys','No\x20valid\x20fields\x20to\x20update','Error\x20sending\x20webhook\x20notification:','string','📤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','Internal\x20API\x20error\x20getting\x20payment:','status','defineProperty','paymentMethod','Missing\x20or\x20invalid\x20authorization\x20header','failureMessage','payment_method','prototype','gatewayPaymentId'];a27_0x5e09=function(){return _0x3b6be0;};return a27_0x5e09();}Object[a27_0x20414d(0x137)](exports,'__esModule',{'value':!![]});const express_1=require(a27_0x20414d(0x167)),database_1=__importDefault(require('../config/database')),router=(0x0,express_1[a27_0x20414d(0x15e)])(),verifyInternalApiKey=(_0x51b6d,_0x237691,_0x36aaf1)=>{const _0x1fbfab=a27_0x20414d,_0x269f93=_0x51b6d[_0x1fbfab(0x152)][_0x1fbfab(0x141)];if(!_0x269f93||!_0x269f93[_0x1fbfab(0x155)]('Bearer\x20'))return _0x237691[_0x1fbfab(0x136)](0x191)[_0x1fbfab(0x149)]({'error':_0x1fbfab(0x139)});const _0x988ee3=_0x269f93[_0x1fbfab(0x14a)](0x7);if(_0x988ee3!==_0x1fbfab(0x157))return _0x237691['status'](0x191)[_0x1fbfab(0x149)]({'error':'Invalid\x20internal\x20API\x20key'});_0x36aaf1();};router['get']('/payments/:id/gateway-settings',verifyInternalApiKey,async(_0x460777,_0x33d0e8)=>{const _0x482c78=a27_0x20414d;try{const {id:_0x50e6de}=_0x460777['params'];console[_0x482c78(0x127)](_0x482c78(0x153)+_0x50e6de+_0x482c78(0x144));const _0x3cd95d=await database_1['default'][_0x482c78(0x121)][_0x482c78(0x12b)]({'where':{'id':_0x50e6de},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x3cd95d)return _0x33d0e8[_0x482c78(0x136)](0x194)[_0x482c78(0x149)]({'error':_0x482c78(0x14e)});console[_0x482c78(0x127)]('✅\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20'+_0x3cd95d[_0x482c78(0x15c)][_0x482c78(0x164)]),_0x33d0e8[_0x482c78(0x149)]({'id':_0x3cd95d['id'],'amount':_0x3cd95d['amount'],'currency':_0x3cd95d[_0x482c78(0x12e)],'status':_0x3cd95d[_0x482c78(0x136)],'orderId':_0x3cd95d['orderId'],'shop':_0x3cd95d[_0x482c78(0x15c)]});}catch(_0x310d90){console['error'](_0x482c78(0x135),_0x310d90),_0x33d0e8[_0x482c78(0x136)](0x1f4)['json']({'error':_0x482c78(0x150)});}}),router[a27_0x20414d(0x154)](a27_0x20414d(0x14f),verifyInternalApiKey,async(_0x426eef,_0x19916a)=>{const _0x450bd8=a27_0x20414d;try{const {id:_0x135751}=_0x426eef[_0x450bd8(0x160)],_0x3f28a2=_0x426eef[_0x450bd8(0x122)];console[_0x450bd8(0x127)](_0x450bd8(0x15d)+_0x135751,_0x3f28a2);const _0x90a79a=['status',_0x450bd8(0x15f),_0x450bd8(0x13d),'card_last4',_0x450bd8(0x120),_0x450bd8(0x13b),_0x450bd8(0x138),_0x450bd8(0x146),_0x450bd8(0x162),_0x450bd8(0x12a),_0x450bd8(0x13a)],_0x36b65b={};for(const [_0xce20d6,_0x528e9f]of Object[_0x450bd8(0x14b)](_0x3f28a2)){if(_0x90a79a[_0x450bd8(0x163)](_0xce20d6)){let _0x113741=_0xce20d6;if(_0xce20d6==='gateway_payment_id'||_0xce20d6===_0x450bd8(0x13d))_0x113741='gatewayPaymentId';else{if(_0xce20d6===_0x450bd8(0x145)||_0xce20d6===_0x450bd8(0x120))_0x113741=_0x450bd8(0x120);else{if(_0xce20d6===_0x450bd8(0x13b)||_0xce20d6===_0x450bd8(0x138))_0x113741=_0x450bd8(0x138);else{if(_0xce20d6===_0x450bd8(0x146)||_0xce20d6===_0x450bd8(0x162))_0x113741=_0x450bd8(0x162);else(_0xce20d6===_0x450bd8(0x12a)||_0xce20d6===_0x450bd8(0x13a))&&(_0x113741='failureMessage');}}}_0x113741===_0x450bd8(0x162)&&typeof _0x528e9f===_0x450bd8(0x133)?_0x36b65b[_0x113741]=new Date(_0x528e9f):_0x36b65b[_0x113741]=_0x528e9f;}}if(Object[_0x450bd8(0x130)](_0x36b65b)[_0x450bd8(0x128)]===0x0)return _0x19916a[_0x450bd8(0x136)](0x190)['json']({'error':_0x450bd8(0x131)});const _0x487fdb=await database_1[_0x450bd8(0x14d)][_0x450bd8(0x121)][_0x450bd8(0x15b)]({'where':{'id':_0x135751},'data':_0x36b65b});console[_0x450bd8(0x127)]('✅\x20Internal\x20API:\x20Payment\x20'+_0x135751+_0x450bd8(0x151));if(_0x36b65b[_0x450bd8(0x136)]===_0x450bd8(0x13e)){console['log']('🎉\x20Payment\x20'+_0x135751+_0x450bd8(0x159));try{const {WebhookService:_0x517df8}=await Promise[_0x450bd8(0x148)]()[_0x450bd8(0x158)](()=>__importStar(require(_0x450bd8(0x12f)))),_0x211f99=new _0x517df8(),_0x35a27b=await database_1['default'][_0x450bd8(0x121)][_0x450bd8(0x12b)]({'where':{'id':_0x135751},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x35a27b&&console[_0x450bd8(0x127)](_0x450bd8(0x134)+_0x135751);}catch(_0x14f723){console['error'](_0x450bd8(0x132),_0x14f723);}}_0x19916a[_0x450bd8(0x149)]({'success':!![],'payment':{'id':_0x487fdb['id'],'status':_0x487fdb[_0x450bd8(0x136)]}});}catch(_0x2bdc11){console[_0x450bd8(0x156)]('Internal\x20API\x20error\x20updating\x20payment:',_0x2bdc11),_0x19916a['status'](0x1f4)[_0x450bd8(0x149)]({'error':_0x450bd8(0x150)});}}),router['get'](a27_0x20414d(0x143),(_0x2f7ead,_0xa6fcdd)=>{const _0x47dcb0=a27_0x20414d;_0xa6fcdd['json']({'status':'ok','timestamp':new Date()[_0x47dcb0(0x15a)]()});}),exports[a27_0x20414d(0x14d)]=router;