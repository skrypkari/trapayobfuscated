'use strict';const a25_0x7129ed=a25_0x3b40;function a25_0x37c6(){const _0x11c7a7=['update','toISOString','failure_message','Internal\x20server\x20error','params','patch','8370054ECqGcL','paidAt','express','authorization','get','amount','paid_at','15312150CNyDzu','prototype','paymentMethod','1HtfCZU','Error\x20sending\x20webhook\x20notification:','/payments/:id/update','../services/webhookService','username','hasOwnProperty','Missing\x20or\x20invalid\x20authorization\x20header','__esModule','__importDefault','gatewayPaymentId','error','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','824624bwTZkv','getOwnPropertyDescriptor','includes','\x20updated\x20successfully','gateway_payment_id','__setModuleDefault','cardLast4','findUnique','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','status','resolve','No\x20valid\x20fields\x20to\x20update','36VpyocG','Bearer\x20','2576CKINRl','startsWith','orderId','entries','shop','3008136YWDzZO','getOwnPropertyNames','headers','Router','8283010fYlUti','configurable','__createBinding','json','length','payment','default','writable','payment_method','log','üéâ\x20Payment\x20','63142zuGrpE','defineProperty','/health','internal-api-key','5937YKYkJR','create','keys','Internal\x20API\x20error\x20getting\x20payment:','failureMessage','Payment\x20not\x20found','then'];a25_0x37c6=function(){return _0x11c7a7;};return a25_0x37c6();}(function(_0x22689d,_0x821821){const _0x5c5220=a25_0x3b40,_0x39e74c=_0x22689d();while(!![]){try{const _0x361540=-parseInt(_0x5c5220(0x1a5))/0x1*(-parseInt(_0x5c5220(0x1d4))/0x2)+parseInt(_0x5c5220(0x18e))/0x3*(-parseInt(_0x5c5220(0x1c0))/0x4)+parseInt(_0x5c5220(0x1c9))/0x5+parseInt(_0x5c5220(0x1c5))/0x6+-parseInt(_0x5c5220(0x19b))/0x7+-parseInt(_0x5c5220(0x1b1))/0x8*(parseInt(_0x5c5220(0x1be))/0x9)+parseInt(_0x5c5220(0x1a2))/0xa;if(_0x361540===_0x821821)break;else _0x39e74c['push'](_0x39e74c['shift']());}catch(_0x3d7758){_0x39e74c['push'](_0x39e74c['shift']());}}}(a25_0x37c6,0xcca5a));function a25_0x3b40(_0x3635bc,_0x79401f){const _0x37c6b8=a25_0x37c6();return a25_0x3b40=function(_0x3b40fd,_0x23a407){_0x3b40fd=_0x3b40fd-0x18b;let _0x4384e3=_0x37c6b8[_0x3b40fd];return _0x4384e3;},a25_0x3b40(_0x3635bc,_0x79401f);}var __createBinding=this&&this[a25_0x7129ed(0x1cb)]||(Object[a25_0x7129ed(0x18f)]?function(_0x31f844,_0x3473fc,_0x18aa12,_0x37c63b){const _0x50641d=a25_0x7129ed;if(_0x37c63b===undefined)_0x37c63b=_0x18aa12;var _0x2d733f=Object[_0x50641d(0x1b2)](_0x3473fc,_0x18aa12);(!_0x2d733f||(_0x50641d(0x19f)in _0x2d733f?!_0x3473fc[_0x50641d(0x1ac)]:_0x2d733f[_0x50641d(0x1d0)]||_0x2d733f[_0x50641d(0x1ca)]))&&(_0x2d733f={'enumerable':!![],'get':function(){return _0x3473fc[_0x18aa12];}}),Object['defineProperty'](_0x31f844,_0x37c63b,_0x2d733f);}:function(_0x3aff2c,_0x4a40dd,_0x50fc1b,_0x326913){if(_0x326913===undefined)_0x326913=_0x50fc1b;_0x3aff2c[_0x326913]=_0x4a40dd[_0x50fc1b];}),__setModuleDefault=this&&this[a25_0x7129ed(0x1b6)]||(Object[a25_0x7129ed(0x18f)]?function(_0x5216be,_0x5062dc){const _0x1e43b9=a25_0x7129ed;Object[_0x1e43b9(0x18b)](_0x5216be,_0x1e43b9(0x1cf),{'enumerable':!![],'value':_0x5062dc});}:function(_0x3a98ae,_0x18cf1e){const _0x37c497=a25_0x7129ed;_0x3a98ae[_0x37c497(0x1cf)]=_0x18cf1e;}),__importStar=this&&this['__importStar']||(function(){var _0x5a3725=function(_0x8e3f50){const _0x116eb7=a25_0x3b40;return _0x5a3725=Object[_0x116eb7(0x1c6)]||function(_0x32c054){const _0x3e00e5=_0x116eb7;var _0x493d2c=[];for(var _0xc118e6 in _0x32c054)if(Object[_0x3e00e5(0x1a3)][_0x3e00e5(0x1aa)]['call'](_0x32c054,_0xc118e6))_0x493d2c[_0x493d2c[_0x3e00e5(0x1cd)]]=_0xc118e6;return _0x493d2c;},_0x5a3725(_0x8e3f50);};return function(_0x326f22){const _0x33fb7f=a25_0x3b40;if(_0x326f22&&_0x326f22[_0x33fb7f(0x1ac)])return _0x326f22;var _0x16ede8={};if(_0x326f22!=null){for(var _0x5dc0c8=_0x5a3725(_0x326f22),_0x390fb5=0x0;_0x390fb5<_0x5dc0c8['length'];_0x390fb5++)if(_0x5dc0c8[_0x390fb5]!==_0x33fb7f(0x1cf))__createBinding(_0x16ede8,_0x326f22,_0x5dc0c8[_0x390fb5]);}return __setModuleDefault(_0x16ede8,_0x326f22),_0x16ede8;};}()),__importDefault=this&&this[a25_0x7129ed(0x1ad)]||function(_0xefbc4c){const _0x53f1e5=a25_0x7129ed;return _0xefbc4c&&_0xefbc4c[_0x53f1e5(0x1ac)]?_0xefbc4c:{'default':_0xefbc4c};};Object[a25_0x7129ed(0x18b)](exports,a25_0x7129ed(0x1ac),{'value':!![]});const express_1=require(a25_0x7129ed(0x19d)),database_1=__importDefault(require('../config/database')),router=(0x0,express_1[a25_0x7129ed(0x1c8)])(),verifyInternalApiKey=(_0x44b77d,_0x449872,_0x3a1b7c)=>{const _0x494ab9=a25_0x7129ed,_0x155d20=_0x44b77d[_0x494ab9(0x1c7)][_0x494ab9(0x19e)];if(!_0x155d20||!_0x155d20[_0x494ab9(0x1c1)](_0x494ab9(0x1bf)))return _0x449872[_0x494ab9(0x1bb)](0x191)[_0x494ab9(0x1cc)]({'error':_0x494ab9(0x1ab)});const _0x399b1b=_0x155d20['substring'](0x7);if(_0x399b1b!==_0x494ab9(0x18d))return _0x449872[_0x494ab9(0x1bb)](0x191)[_0x494ab9(0x1cc)]({'error':'Invalid\x20internal\x20API\x20key'});_0x3a1b7c();};router['get']('/payments/:id/gateway-settings',verifyInternalApiKey,async(_0x282fd1,_0x22481a)=>{const _0x5be4d3=a25_0x7129ed;try{const {id:_0x68c295}=_0x282fd1[_0x5be4d3(0x199)];console['log'](_0x5be4d3(0x1b0)+_0x68c295+'\x20with\x20gateway\x20settings');const _0x57a835=await database_1['default'][_0x5be4d3(0x1ce)][_0x5be4d3(0x1b8)]({'where':{'id':_0x68c295},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x57a835)return _0x22481a[_0x5be4d3(0x1bb)](0x194)['json']({'error':_0x5be4d3(0x193)});console[_0x5be4d3(0x1d2)]('‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20'+_0x57a835['shop'][_0x5be4d3(0x1a9)]),_0x22481a['json']({'id':_0x57a835['id'],'amount':_0x57a835[_0x5be4d3(0x1a0)],'currency':_0x57a835['currency'],'status':_0x57a835[_0x5be4d3(0x1bb)],'orderId':_0x57a835[_0x5be4d3(0x1c2)],'shop':_0x57a835[_0x5be4d3(0x1c4)]});}catch(_0x1c1563){console['error'](_0x5be4d3(0x191),_0x1c1563),_0x22481a[_0x5be4d3(0x1bb)](0x1f4)[_0x5be4d3(0x1cc)]({'error':_0x5be4d3(0x198)});}}),router[a25_0x7129ed(0x19a)](a25_0x7129ed(0x1a7),verifyInternalApiKey,async(_0x540780,_0x39425b)=>{const _0x5c8a38=a25_0x7129ed;try{const {id:_0x2dc0a0}=_0x540780[_0x5c8a38(0x199)],_0x30ef24=_0x540780['body'];console['log'](_0x5c8a38(0x1b9)+_0x2dc0a0,_0x30ef24);const _0x196b35=['status',_0x5c8a38(0x1b5),_0x5c8a38(0x1ae),'card_last4','cardLast4',_0x5c8a38(0x1d1),_0x5c8a38(0x1a4),_0x5c8a38(0x1a1),_0x5c8a38(0x19c),_0x5c8a38(0x197),_0x5c8a38(0x192)],_0x2276a0={};for(const [_0x24c790,_0x307a21]of Object[_0x5c8a38(0x1c3)](_0x30ef24)){if(_0x196b35[_0x5c8a38(0x1b3)](_0x24c790)){let _0x3777ce=_0x24c790;if(_0x24c790===_0x5c8a38(0x1b5)||_0x24c790===_0x5c8a38(0x1ae))_0x3777ce=_0x5c8a38(0x1ae);else{if(_0x24c790==='card_last4'||_0x24c790===_0x5c8a38(0x1b7))_0x3777ce=_0x5c8a38(0x1b7);else{if(_0x24c790===_0x5c8a38(0x1d1)||_0x24c790===_0x5c8a38(0x1a4))_0x3777ce=_0x5c8a38(0x1a4);else{if(_0x24c790==='paid_at'||_0x24c790===_0x5c8a38(0x19c))_0x3777ce=_0x5c8a38(0x19c);else(_0x24c790===_0x5c8a38(0x197)||_0x24c790==='failureMessage')&&(_0x3777ce='failureMessage');}}}_0x3777ce===_0x5c8a38(0x19c)&&typeof _0x307a21==='string'?_0x2276a0[_0x3777ce]=new Date(_0x307a21):_0x2276a0[_0x3777ce]=_0x307a21;}}if(Object[_0x5c8a38(0x190)](_0x2276a0)[_0x5c8a38(0x1cd)]===0x0)return _0x39425b['status'](0x190)[_0x5c8a38(0x1cc)]({'error':_0x5c8a38(0x1bd)});const _0x4425e4=await database_1[_0x5c8a38(0x1cf)][_0x5c8a38(0x1ce)][_0x5c8a38(0x195)]({'where':{'id':_0x2dc0a0},'data':_0x2276a0});console[_0x5c8a38(0x1d2)]('‚úÖ\x20Internal\x20API:\x20Payment\x20'+_0x2dc0a0+_0x5c8a38(0x1b4));if(_0x2276a0['status']==='PAID'){console[_0x5c8a38(0x1d2)](_0x5c8a38(0x1d3)+_0x2dc0a0+'\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing');try{const {WebhookService:_0x258e73}=await Promise[_0x5c8a38(0x1bc)]()[_0x5c8a38(0x194)](()=>__importStar(require(_0x5c8a38(0x1a8)))),_0x3a23af=new _0x258e73(),_0x35f474=await database_1['default']['payment'][_0x5c8a38(0x1b8)]({'where':{'id':_0x2dc0a0},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x35f474&&console[_0x5c8a38(0x1d2)](_0x5c8a38(0x1ba)+_0x2dc0a0);}catch(_0x3cf7fb){console['error'](_0x5c8a38(0x1a6),_0x3cf7fb);}}_0x39425b['json']({'success':!![],'payment':{'id':_0x4425e4['id'],'status':_0x4425e4['status']}});}catch(_0x47aeb7){console[_0x5c8a38(0x1af)]('Internal\x20API\x20error\x20updating\x20payment:',_0x47aeb7),_0x39425b[_0x5c8a38(0x1bb)](0x1f4)[_0x5c8a38(0x1cc)]({'error':_0x5c8a38(0x198)});}}),router[a25_0x7129ed(0x19f)](a25_0x7129ed(0x18c),(_0xd019cd,_0x1511f7)=>{const _0x213167=a25_0x7129ed;_0x1511f7[_0x213167(0x1cc)]({'status':'ok','timestamp':new Date()[_0x213167(0x196)]()});}),exports['default']=router;