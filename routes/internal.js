'use strict';const a35_0x26c6ea=a35_0x221f;(function(_0x2cbc01,_0x41334c){const _0x473038=a35_0x221f,_0x3c0456=_0x2cbc01();while(!![]){try{const _0xe34a74=parseInt(_0x473038(0x136))/0x1*(parseInt(_0x473038(0x13f))/0x2)+-parseInt(_0x473038(0x124))/0x3*(-parseInt(_0x473038(0x138))/0x4)+-parseInt(_0x473038(0x150))/0x5*(-parseInt(_0x473038(0x158))/0x6)+parseInt(_0x473038(0x123))/0x7*(-parseInt(_0x473038(0x133))/0x8)+parseInt(_0x473038(0x11e))/0x9*(-parseInt(_0x473038(0x15d))/0xa)+parseInt(_0x473038(0x148))/0xb+-parseInt(_0x473038(0x125))/0xc;if(_0xe34a74===_0x41334c)break;else _0x3c0456['push'](_0x3c0456['shift']());}catch(_0x45f676){_0x3c0456['push'](_0x3c0456['shift']());}}}(a35_0x212e,0x472e2));var __createBinding=this&&this[a35_0x26c6ea(0x14a)]||(Object[a35_0x26c6ea(0x157)]?function(_0x46df85,_0x529d56,_0x2fcd30,_0x43efe4){const _0x3b9fdb=a35_0x26c6ea;if(_0x43efe4===undefined)_0x43efe4=_0x2fcd30;var _0x3ca1f6=Object['getOwnPropertyDescriptor'](_0x529d56,_0x2fcd30);(!_0x3ca1f6||('get'in _0x3ca1f6?!_0x529d56['__esModule']:_0x3ca1f6[_0x3b9fdb(0x147)]||_0x3ca1f6['configurable']))&&(_0x3ca1f6={'enumerable':!![],'get':function(){return _0x529d56[_0x2fcd30];}}),Object['defineProperty'](_0x46df85,_0x43efe4,_0x3ca1f6);}:function(_0x432228,_0x3cbb1b,_0x10a44a,_0x373c57){if(_0x373c57===undefined)_0x373c57=_0x10a44a;_0x432228[_0x373c57]=_0x3cbb1b[_0x10a44a];}),__setModuleDefault=this&&this[a35_0x26c6ea(0x144)]||(Object[a35_0x26c6ea(0x157)]?function(_0x172423,_0x5d3c07){const _0x339cbf=a35_0x26c6ea;Object['defineProperty'](_0x172423,_0x339cbf(0x13b),{'enumerable':!![],'value':_0x5d3c07});}:function(_0x154590,_0x9a6745){const _0x36bbd0=a35_0x26c6ea;_0x154590[_0x36bbd0(0x13b)]=_0x9a6745;}),__importStar=this&&this['__importStar']||(function(){var _0x177e09=function(_0xc423bb){const _0x50bef6=a35_0x221f;return _0x177e09=Object[_0x50bef6(0x13d)]||function(_0x2f4de6){const _0x14334=_0x50bef6;var _0x2ac3ef=[];for(var _0xecbcde in _0x2f4de6)if(Object['prototype']['hasOwnProperty'][_0x14334(0x11d)](_0x2f4de6,_0xecbcde))_0x2ac3ef[_0x2ac3ef['length']]=_0xecbcde;return _0x2ac3ef;},_0x177e09(_0xc423bb);};return function(_0xbf1c86){const _0x47b109=a35_0x221f;if(_0xbf1c86&&_0xbf1c86[_0x47b109(0x162)])return _0xbf1c86;var _0x5ca45f={};if(_0xbf1c86!=null){for(var _0x2be0c6=_0x177e09(_0xbf1c86),_0x16cfa0=0x0;_0x16cfa0<_0x2be0c6[_0x47b109(0x153)];_0x16cfa0++)if(_0x2be0c6[_0x16cfa0]!=='default')__createBinding(_0x5ca45f,_0xbf1c86,_0x2be0c6[_0x16cfa0]);}return __setModuleDefault(_0x5ca45f,_0xbf1c86),_0x5ca45f;};}()),__importDefault=this&&this[a35_0x26c6ea(0x15f)]||function(_0x56f290){return _0x56f290&&_0x56f290['__esModule']?_0x56f290:{'default':_0x56f290};};function a35_0x212e(){const _0x5f023b=['headers','__createBinding','failureMessage','Internal\x20server\x20error','ðŸ”„\x20Internal\x20API:\x20Updating\x20payment\x20','Invalid\x20internal\x20API\x20key','startsWith','275285KxNZlU','currency','âœ…\x20Internal\x20API:\x20Payment\x20','length','paymentMethod','cardLast4','body','create','18oYmilu','No\x20valid\x20fields\x20to\x20update','Payment\x20not\x20found','includes','card_last4','2233090qcbYQv','../config/database','__importDefault','paidAt','keys','__esModule','resolve','log','gateway_payment_id','payment','json','amount','patch','update','shop','Internal\x20API\x20error\x20updating\x20payment:','âœ…\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','call','9jjBQyD','gatewayPaymentId','params','Error\x20sending\x20webhook\x20notification:','Missing\x20or\x20invalid\x20authorization\x20header','1745779bgWqNU','7041rjTsrP','9557412grvXyx','entries','findUnique','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','\x20with\x20gateway\x20settings','status','/payments/:id/update','get','Internal\x20API\x20error\x20getting\x20payment:','Router','payment_method','error','PAID','../services/webhookService','8yvpJpP','express','defineProperty','4ZggjWt','orderId','852eAWgMK','ðŸ“¤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','toISOString','default','\x20updated\x20successfully','getOwnPropertyNames','username','221306zaRJTI','failure_message','paid_at','ðŸ”\x20Internal\x20API:\x20Getting\x20payment\x20','authorization','__setModuleDefault','/payments/:id/gateway-settings','Bearer\x20','writable','4983187mwmVSW'];a35_0x212e=function(){return _0x5f023b;};return a35_0x212e();}Object[a35_0x26c6ea(0x135)](exports,'__esModule',{'value':!![]});const express_1=require(a35_0x26c6ea(0x134)),database_1=__importDefault(require(a35_0x26c6ea(0x15e))),router=(0x0,express_1[a35_0x26c6ea(0x12e)])(),verifyInternalApiKey=(_0x42bc66,_0x2eb2e1,_0x4518da)=>{const _0x7fd9f3=a35_0x26c6ea,_0x16c9d9=_0x42bc66[_0x7fd9f3(0x149)][_0x7fd9f3(0x143)];if(!_0x16c9d9||!_0x16c9d9[_0x7fd9f3(0x14f)](_0x7fd9f3(0x146)))return _0x2eb2e1[_0x7fd9f3(0x12a)](0x191)['json']({'error':_0x7fd9f3(0x122)});const _0x37e1b1=_0x16c9d9['substring'](0x7);if(_0x37e1b1!=='internal-api-key')return _0x2eb2e1['status'](0x191)[_0x7fd9f3(0x167)]({'error':_0x7fd9f3(0x14e)});_0x4518da();};function a35_0x221f(_0x54d9ef,_0x28e239){_0x54d9ef=_0x54d9ef-0x11b;const _0x212e13=a35_0x212e();let _0x221f34=_0x212e13[_0x54d9ef];return _0x221f34;}router[a35_0x26c6ea(0x12c)](a35_0x26c6ea(0x145),verifyInternalApiKey,async(_0x10f1c8,_0x2ce1f3)=>{const _0x4ff8e5=a35_0x26c6ea;try{const {id:_0x2b89f3}=_0x10f1c8['params'];console[_0x4ff8e5(0x164)](_0x4ff8e5(0x142)+_0x2b89f3+_0x4ff8e5(0x129));const _0x57b3df=await database_1['default']['payment'][_0x4ff8e5(0x127)]({'where':{'id':_0x2b89f3},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x57b3df)return _0x2ce1f3['status'](0x194)['json']({'error':_0x4ff8e5(0x15a)});console[_0x4ff8e5(0x164)](_0x4ff8e5(0x11c)+_0x57b3df[_0x4ff8e5(0x16b)][_0x4ff8e5(0x13e)]),_0x2ce1f3['json']({'id':_0x57b3df['id'],'amount':_0x57b3df[_0x4ff8e5(0x168)],'currency':_0x57b3df[_0x4ff8e5(0x151)],'status':_0x57b3df[_0x4ff8e5(0x12a)],'orderId':_0x57b3df[_0x4ff8e5(0x137)],'shop':_0x57b3df[_0x4ff8e5(0x16b)]});}catch(_0x2a3304){console['error'](_0x4ff8e5(0x12d),_0x2a3304),_0x2ce1f3[_0x4ff8e5(0x12a)](0x1f4)[_0x4ff8e5(0x167)]({'error':_0x4ff8e5(0x14c)});}}),router[a35_0x26c6ea(0x169)](a35_0x26c6ea(0x12b),verifyInternalApiKey,async(_0x2f8ac5,_0x3954e1)=>{const _0x45d642=a35_0x26c6ea;try{const {id:_0x217ada}=_0x2f8ac5[_0x45d642(0x120)],_0x37b448=_0x2f8ac5[_0x45d642(0x156)];console[_0x45d642(0x164)](_0x45d642(0x14d)+_0x217ada,_0x37b448);const _0x45e8f7=[_0x45d642(0x12a),_0x45d642(0x165),'gatewayPaymentId',_0x45d642(0x15c),_0x45d642(0x155),_0x45d642(0x12f),_0x45d642(0x154),_0x45d642(0x141),_0x45d642(0x160),_0x45d642(0x140),_0x45d642(0x14b)],_0x567139={};for(const [_0x13e22b,_0x27291e]of Object[_0x45d642(0x126)](_0x37b448)){if(_0x45e8f7[_0x45d642(0x15b)](_0x13e22b)){let _0x150da8=_0x13e22b;if(_0x13e22b==='gateway_payment_id'||_0x13e22b===_0x45d642(0x11f))_0x150da8='gatewayPaymentId';else{if(_0x13e22b==='card_last4'||_0x13e22b===_0x45d642(0x155))_0x150da8='cardLast4';else{if(_0x13e22b==='payment_method'||_0x13e22b==='paymentMethod')_0x150da8='paymentMethod';else{if(_0x13e22b===_0x45d642(0x141)||_0x13e22b===_0x45d642(0x160))_0x150da8=_0x45d642(0x160);else(_0x13e22b===_0x45d642(0x140)||_0x13e22b===_0x45d642(0x14b))&&(_0x150da8=_0x45d642(0x14b));}}}_0x150da8===_0x45d642(0x160)&&typeof _0x27291e==='string'?_0x567139[_0x150da8]=new Date(_0x27291e):_0x567139[_0x150da8]=_0x27291e;}}if(Object[_0x45d642(0x161)](_0x567139)[_0x45d642(0x153)]===0x0)return _0x3954e1['status'](0x190)[_0x45d642(0x167)]({'error':_0x45d642(0x159)});const _0x15078d=await database_1['default'][_0x45d642(0x166)][_0x45d642(0x16a)]({'where':{'id':_0x217ada},'data':_0x567139});console['log'](_0x45d642(0x152)+_0x217ada+_0x45d642(0x13c));if(_0x567139[_0x45d642(0x12a)]===_0x45d642(0x131)){console[_0x45d642(0x164)]('ðŸŽ‰\x20Payment\x20'+_0x217ada+_0x45d642(0x128));try{const {WebhookService:_0x18fbbe}=await Promise[_0x45d642(0x163)]()['then'](()=>__importStar(require(_0x45d642(0x132)))),_0x18563b=new _0x18fbbe(),_0x25c32f=await database_1[_0x45d642(0x13b)][_0x45d642(0x166)]['findUnique']({'where':{'id':_0x217ada},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x25c32f&&console['log'](_0x45d642(0x139)+_0x217ada);}catch(_0x514184){console[_0x45d642(0x130)](_0x45d642(0x121),_0x514184);}}_0x3954e1[_0x45d642(0x167)]({'success':!![],'payment':{'id':_0x15078d['id'],'status':_0x15078d['status']}});}catch(_0x5d5d50){console['error'](_0x45d642(0x11b),_0x5d5d50),_0x3954e1[_0x45d642(0x12a)](0x1f4)[_0x45d642(0x167)]({'error':_0x45d642(0x14c)});}}),router['get']('/health',(_0x310e5c,_0x2a0311)=>{const _0xde226b=a35_0x26c6ea;_0x2a0311[_0xde226b(0x167)]({'status':'ok','timestamp':new Date()[_0xde226b(0x13a)]()});}),exports['default']=router;