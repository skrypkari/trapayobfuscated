'use strict';const a35_0x2c8ba7=a35_0x2701;(function(_0x1c6a78,_0x3770ef){const _0x33405a=a35_0x2701,_0x28dce8=_0x1c6a78();while(!![]){try{const _0x3b17e5=parseInt(_0x33405a(0xed))/0x1+parseInt(_0x33405a(0xe4))/0x2*(parseInt(_0x33405a(0xd7))/0x3)+parseInt(_0x33405a(0xd8))/0x4*(parseInt(_0x33405a(0xff))/0x5)+parseInt(_0x33405a(0xd9))/0x6+parseInt(_0x33405a(0xc1))/0x7+-parseInt(_0x33405a(0xc2))/0x8+-parseInt(_0x33405a(0xdc))/0x9;if(_0x3b17e5===_0x3770ef)break;else _0x28dce8['push'](_0x28dce8['shift']());}catch(_0x2acfd2){_0x28dce8['push'](_0x28dce8['shift']());}}}(a35_0x1808,0xd87ee));function a35_0x2701(_0x2814d8,_0x270f76){_0x2814d8=_0x2814d8-0xbd;const _0x180880=a35_0x1808();let _0x27017b=_0x180880[_0x2814d8];return _0x27017b;}var __createBinding=this&&this[a35_0x2c8ba7(0x10c)]||(Object[a35_0x2c8ba7(0xc6)]?function(_0x23cd34,_0x104b57,_0xbe899d,_0x38cf10){const _0x24d224=a35_0x2c8ba7;if(_0x38cf10===undefined)_0x38cf10=_0xbe899d;var _0x531ad1=Object['getOwnPropertyDescriptor'](_0x104b57,_0xbe899d);(!_0x531ad1||(_0x24d224(0xd0)in _0x531ad1?!_0x104b57[_0x24d224(0xec)]:_0x531ad1[_0x24d224(0xf4)]||_0x531ad1[_0x24d224(0xce)]))&&(_0x531ad1={'enumerable':!![],'get':function(){return _0x104b57[_0xbe899d];}}),Object[_0x24d224(0xf1)](_0x23cd34,_0x38cf10,_0x531ad1);}:function(_0x146381,_0x4c7569,_0x4bfad9,_0x1b189a){if(_0x1b189a===undefined)_0x1b189a=_0x4bfad9;_0x146381[_0x1b189a]=_0x4c7569[_0x4bfad9];}),__setModuleDefault=this&&this[a35_0x2c8ba7(0xc9)]||(Object[a35_0x2c8ba7(0xc6)]?function(_0x4411b4,_0x54a10b){const _0x2eb804=a35_0x2c8ba7;Object[_0x2eb804(0xf1)](_0x4411b4,_0x2eb804(0xfd),{'enumerable':!![],'value':_0x54a10b});}:function(_0x229d13,_0x34da73){const _0x1c1021=a35_0x2c8ba7;_0x229d13[_0x1c1021(0xfd)]=_0x34da73;}),__importStar=this&&this[a35_0x2c8ba7(0x103)]||(function(){var _0x392a86=function(_0x5d931c){const _0x5450ff=a35_0x2701;return _0x392a86=Object[_0x5450ff(0xc8)]||function(_0x4ae2e){const _0x48ec13=_0x5450ff;var _0x4c3ae0=[];for(var _0x557b9e in _0x4ae2e)if(Object[_0x48ec13(0xbf)][_0x48ec13(0xf6)][_0x48ec13(0x100)](_0x4ae2e,_0x557b9e))_0x4c3ae0[_0x4c3ae0[_0x48ec13(0x108)]]=_0x557b9e;return _0x4c3ae0;},_0x392a86(_0x5d931c);};return function(_0x51ad97){const _0xde5246=a35_0x2701;if(_0x51ad97&&_0x51ad97[_0xde5246(0xec)])return _0x51ad97;var _0x38b51e={};if(_0x51ad97!=null){for(var _0x18e9aa=_0x392a86(_0x51ad97),_0x331d52=0x0;_0x331d52<_0x18e9aa['length'];_0x331d52++)if(_0x18e9aa[_0x331d52]!==_0xde5246(0xfd))__createBinding(_0x38b51e,_0x51ad97,_0x18e9aa[_0x331d52]);}return __setModuleDefault(_0x38b51e,_0x51ad97),_0x38b51e;};}()),__importDefault=this&&this[a35_0x2c8ba7(0xbd)]||function(_0x5cc97b){return _0x5cc97b&&_0x5cc97b['__esModule']?_0x5cc97b:{'default':_0x5cc97b};};Object[a35_0x2c8ba7(0xf1)](exports,a35_0x2c8ba7(0xec),{'value':!![]});const express_1=require(a35_0x2c8ba7(0xf8)),database_1=__importDefault(require(a35_0x2c8ba7(0xc7))),router=(0x0,express_1[a35_0x2c8ba7(0xc5)])(),verifyInternalApiKey=(_0x3c7f36,_0x4130fe,_0xd7fc3c)=>{const _0x8ff0d2=a35_0x2c8ba7,_0x2d539c=_0x3c7f36[_0x8ff0d2(0xfb)][_0x8ff0d2(0xdf)];if(!_0x2d539c||!_0x2d539c[_0x8ff0d2(0xf9)](_0x8ff0d2(0x105)))return _0x4130fe[_0x8ff0d2(0xf0)](0x191)[_0x8ff0d2(0x106)]({'error':_0x8ff0d2(0xd6)});const _0x289b1c=_0x2d539c[_0x8ff0d2(0xef)](0x7);if(_0x289b1c!==_0x8ff0d2(0x102))return _0x4130fe[_0x8ff0d2(0xf0)](0x191)['json']({'error':_0x8ff0d2(0x107)});_0xd7fc3c();};function a35_0x1808(){const _0x213629=['\x20with\x20gateway\x20settings','ðŸ”„\x20Internal\x20API:\x20Updating\x20payment\x20','__createBinding','gateway_payment_id','__importDefault','string','prototype','Payment\x20not\x20found','6566105JgtQoS','3409176sSWYsQ','currency','Internal\x20server\x20error','Router','create','../config/database','getOwnPropertyNames','__setModuleDefault','findUnique','entries','paidAt','ðŸŽ‰\x20Payment\x20','configurable','username','get','resolve','../services/webhookService','ðŸ“¤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','includes','update','Missing\x20or\x20invalid\x20authorization\x20header','9KsHphZ','2945888SvyAQp','5178252BnBvVy','patch','payment','23069358ksxoLu','ðŸ”\x20Internal\x20API:\x20Getting\x20payment\x20','No\x20valid\x20fields\x20to\x20update','authorization','params','shop','toISOString','payment_method','7748otVLqS','body','failure_message','failureMessage','âœ…\x20Internal\x20API:\x20Payment\x20','paymentMethod','\x20updated\x20successfully','gatewayPaymentId','__esModule','1327024yukuCI','log','substring','status','defineProperty','paid_at','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','writable','PAID','hasOwnProperty','then','express','startsWith','/payments/:id/update','headers','orderId','default','Internal\x20API\x20error\x20getting\x20payment:','5RCppKr','call','card_last4','internal-api-key','__importStar','cardLast4','Bearer\x20','json','Invalid\x20internal\x20API\x20key','length','error'];a35_0x1808=function(){return _0x213629;};return a35_0x1808();}router[a35_0x2c8ba7(0xd0)]('/payments/:id/gateway-settings',verifyInternalApiKey,async(_0x199f33,_0x3a39ef)=>{const _0x286539=a35_0x2c8ba7;try{const {id:_0xa7135e}=_0x199f33[_0x286539(0xe0)];console[_0x286539(0xee)](_0x286539(0xdd)+_0xa7135e+_0x286539(0x10a));const _0x42b5a1=await database_1['default']['payment']['findUnique']({'where':{'id':_0xa7135e},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x42b5a1)return _0x3a39ef[_0x286539(0xf0)](0x194)[_0x286539(0x106)]({'error':_0x286539(0xc0)});console[_0x286539(0xee)]('âœ…\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20'+_0x42b5a1[_0x286539(0xe1)][_0x286539(0xcf)]),_0x3a39ef[_0x286539(0x106)]({'id':_0x42b5a1['id'],'amount':_0x42b5a1['amount'],'currency':_0x42b5a1[_0x286539(0xc3)],'status':_0x42b5a1[_0x286539(0xf0)],'orderId':_0x42b5a1[_0x286539(0xfc)],'shop':_0x42b5a1[_0x286539(0xe1)]});}catch(_0x123b37){console['error'](_0x286539(0xfe),_0x123b37),_0x3a39ef[_0x286539(0xf0)](0x1f4)[_0x286539(0x106)]({'error':_0x286539(0xc4)});}}),router[a35_0x2c8ba7(0xda)](a35_0x2c8ba7(0xfa),verifyInternalApiKey,async(_0x103959,_0x6d53ea)=>{const _0x1cfbf3=a35_0x2c8ba7;try{const {id:_0x632234}=_0x103959[_0x1cfbf3(0xe0)],_0x10d31f=_0x103959[_0x1cfbf3(0xe5)];console[_0x1cfbf3(0xee)](_0x1cfbf3(0x10b)+_0x632234,_0x10d31f);const _0x1964b5=['status','gateway_payment_id',_0x1cfbf3(0xeb),_0x1cfbf3(0x101),_0x1cfbf3(0x104),_0x1cfbf3(0xe3),_0x1cfbf3(0xe9),'paid_at',_0x1cfbf3(0xcc),_0x1cfbf3(0xe6),_0x1cfbf3(0xe7)],_0x1e5c44={};for(const [_0x240832,_0x1d0568]of Object[_0x1cfbf3(0xcb)](_0x10d31f)){if(_0x1964b5[_0x1cfbf3(0xd4)](_0x240832)){let _0x438931=_0x240832;if(_0x240832===_0x1cfbf3(0x10d)||_0x240832===_0x1cfbf3(0xeb))_0x438931=_0x1cfbf3(0xeb);else{if(_0x240832===_0x1cfbf3(0x101)||_0x240832===_0x1cfbf3(0x104))_0x438931=_0x1cfbf3(0x104);else{if(_0x240832===_0x1cfbf3(0xe3)||_0x240832===_0x1cfbf3(0xe9))_0x438931='paymentMethod';else{if(_0x240832===_0x1cfbf3(0xf2)||_0x240832===_0x1cfbf3(0xcc))_0x438931=_0x1cfbf3(0xcc);else(_0x240832==='failure_message'||_0x240832==='failureMessage')&&(_0x438931=_0x1cfbf3(0xe7));}}}_0x438931==='paidAt'&&typeof _0x1d0568===_0x1cfbf3(0xbe)?_0x1e5c44[_0x438931]=new Date(_0x1d0568):_0x1e5c44[_0x438931]=_0x1d0568;}}if(Object['keys'](_0x1e5c44)[_0x1cfbf3(0x108)]===0x0)return _0x6d53ea[_0x1cfbf3(0xf0)](0x190)['json']({'error':_0x1cfbf3(0xde)});const _0x329c40=await database_1[_0x1cfbf3(0xfd)][_0x1cfbf3(0xdb)][_0x1cfbf3(0xd5)]({'where':{'id':_0x632234},'data':_0x1e5c44});console[_0x1cfbf3(0xee)](_0x1cfbf3(0xe8)+_0x632234+_0x1cfbf3(0xea));if(_0x1e5c44[_0x1cfbf3(0xf0)]===_0x1cfbf3(0xf5)){console[_0x1cfbf3(0xee)](_0x1cfbf3(0xcd)+_0x632234+_0x1cfbf3(0xf3));try{const {WebhookService:_0x387fa7}=await Promise[_0x1cfbf3(0xd1)]()[_0x1cfbf3(0xf7)](()=>__importStar(require(_0x1cfbf3(0xd2)))),_0x17c29e=new _0x387fa7(),_0x177666=await database_1[_0x1cfbf3(0xfd)][_0x1cfbf3(0xdb)][_0x1cfbf3(0xca)]({'where':{'id':_0x632234},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x177666&&console[_0x1cfbf3(0xee)](_0x1cfbf3(0xd3)+_0x632234);}catch(_0x5c86f7){console[_0x1cfbf3(0x109)]('Error\x20sending\x20webhook\x20notification:',_0x5c86f7);}}_0x6d53ea['json']({'success':!![],'payment':{'id':_0x329c40['id'],'status':_0x329c40[_0x1cfbf3(0xf0)]}});}catch(_0x1735f4){console['error']('Internal\x20API\x20error\x20updating\x20payment:',_0x1735f4),_0x6d53ea[_0x1cfbf3(0xf0)](0x1f4)[_0x1cfbf3(0x106)]({'error':_0x1cfbf3(0xc4)});}}),router['get']('/health',(_0x3384d1,_0x4b8540)=>{const _0x46ba3f=a35_0x2c8ba7;_0x4b8540[_0x46ba3f(0x106)]({'status':'ok','timestamp':new Date()[_0x46ba3f(0xe2)]()});}),exports['default']=router;