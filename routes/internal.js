'use strict';const a32_0x483fcc=a32_0x4725;(function(_0x34b8c7,_0x4b9b5f){const _0x2b627a=a32_0x4725,_0x178e3c=_0x34b8c7();while(!![]){try{const _0x4451db=parseInt(_0x2b627a(0x1b7))/0x1*(-parseInt(_0x2b627a(0x1ab))/0x2)+-parseInt(_0x2b627a(0x1b9))/0x3+-parseInt(_0x2b627a(0x188))/0x4*(-parseInt(_0x2b627a(0x1ae))/0x5)+-parseInt(_0x2b627a(0x199))/0x6*(parseInt(_0x2b627a(0x193))/0x7)+-parseInt(_0x2b627a(0x1a3))/0x8+parseInt(_0x2b627a(0x1ac))/0x9*(parseInt(_0x2b627a(0x1cd))/0xa)+-parseInt(_0x2b627a(0x191))/0xb*(-parseInt(_0x2b627a(0x1bf))/0xc);if(_0x4451db===_0x4b9b5f)break;else _0x178e3c['push'](_0x178e3c['shift']());}catch(_0x5ac66f){_0x178e3c['push'](_0x178e3c['shift']());}}}(a32_0x228c,0x1fa67));function a32_0x228c(){const _0xd8f2a0=['__createBinding','10yGLDwO','defineProperty','failure_message','configurable','‚úÖ\x20Internal\x20API:\x20Payment\x20','Missing\x20or\x20invalid\x20authorization\x20header','../services/webhookService','get','getOwnPropertyDescriptor','241270JiTQYK','express','404256DULwxV','paymentMethod','failureMessage','__importDefault','substring','patch','9069756KDOYVY','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','hasOwnProperty','headers','toISOString','../config/database','currency','includes','status','log','paidAt','findUnique','gateway_payment_id','Internal\x20server\x20error','1082450ILCFRq','then','üéâ\x20Payment\x20','__importStar','129392TnoFvC','orderId','getOwnPropertyNames','json','default','entries','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','gatewayPaymentId','keys','11deSfOS','error','21OfJqmu','call','string','Bearer\x20','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','\x20with\x20gateway\x20settings','388914lGlhvU','__setModuleDefault','username','payment_method','paid_at','body','Payment\x20not\x20found','params','cardLast4','/payments/:id/gateway-settings','1829088ocTgip','__esModule','shop','Invalid\x20internal\x20API\x20key','/payments/:id/update','amount','startsWith','internal-api-key','2JXjYRo','9QAlCMj'];a32_0x228c=function(){return _0xd8f2a0;};return a32_0x228c();}var __createBinding=this&&this[a32_0x483fcc(0x1ad)]||(Object['create']?function(_0x1af492,_0x42fea6,_0x493643,_0x4bc8d7){const _0x1ca598=a32_0x483fcc;if(_0x4bc8d7===undefined)_0x4bc8d7=_0x493643;var _0x113496=Object[_0x1ca598(0x1b6)](_0x42fea6,_0x493643);(!_0x113496||(_0x1ca598(0x1b5)in _0x113496?!_0x42fea6[_0x1ca598(0x1a4)]:_0x113496['writable']||_0x113496[_0x1ca598(0x1b1)]))&&(_0x113496={'enumerable':!![],'get':function(){return _0x42fea6[_0x493643];}}),Object[_0x1ca598(0x1af)](_0x1af492,_0x4bc8d7,_0x113496);}:function(_0x360190,_0x5a2886,_0x14745e,_0x3865d5){if(_0x3865d5===undefined)_0x3865d5=_0x14745e;_0x360190[_0x3865d5]=_0x5a2886[_0x14745e];}),__setModuleDefault=this&&this[a32_0x483fcc(0x19a)]||(Object['create']?function(_0x416468,_0x1a7728){const _0x3d7696=a32_0x483fcc;Object[_0x3d7696(0x1af)](_0x416468,_0x3d7696(0x18c),{'enumerable':!![],'value':_0x1a7728});}:function(_0x202a7c,_0x1d9af5){const _0x255841=a32_0x483fcc;_0x202a7c[_0x255841(0x18c)]=_0x1d9af5;}),__importStar=this&&this[a32_0x483fcc(0x187)]||(function(){var _0x4dfff8=function(_0x30761d){const _0x4a1ed3=a32_0x4725;return _0x4dfff8=Object[_0x4a1ed3(0x18a)]||function(_0x3dd733){const _0x381016=_0x4a1ed3;var _0xf3104b=[];for(var _0x50af90 in _0x3dd733)if(Object['prototype'][_0x381016(0x1c1)][_0x381016(0x194)](_0x3dd733,_0x50af90))_0xf3104b[_0xf3104b['length']]=_0x50af90;return _0xf3104b;},_0x4dfff8(_0x30761d);};return function(_0x262d87){const _0x13d210=a32_0x4725;if(_0x262d87&&_0x262d87[_0x13d210(0x1a4)])return _0x262d87;var _0x96e295={};if(_0x262d87!=null){for(var _0x22eb2d=_0x4dfff8(_0x262d87),_0x2b3ff0=0x0;_0x2b3ff0<_0x22eb2d['length'];_0x2b3ff0++)if(_0x22eb2d[_0x2b3ff0]!==_0x13d210(0x18c))__createBinding(_0x96e295,_0x262d87,_0x22eb2d[_0x2b3ff0]);}return __setModuleDefault(_0x96e295,_0x262d87),_0x96e295;};}()),__importDefault=this&&this[a32_0x483fcc(0x1bc)]||function(_0x17f3fb){const _0x27bf3e=a32_0x483fcc;return _0x17f3fb&&_0x17f3fb[_0x27bf3e(0x1a4)]?_0x17f3fb:{'default':_0x17f3fb};};Object[a32_0x483fcc(0x1af)](exports,'__esModule',{'value':!![]});const express_1=require(a32_0x483fcc(0x1b8)),database_1=__importDefault(require(a32_0x483fcc(0x1c4))),router=(0x0,express_1['Router'])(),verifyInternalApiKey=(_0x5c070b,_0x1da0e1,_0x4b8b92)=>{const _0x30be0e=a32_0x483fcc,_0x4df350=_0x5c070b[_0x30be0e(0x1c2)]['authorization'];if(!_0x4df350||!_0x4df350[_0x30be0e(0x1a9)](_0x30be0e(0x196)))return _0x1da0e1[_0x30be0e(0x1c7)](0x191)[_0x30be0e(0x18b)]({'error':_0x30be0e(0x1b3)});const _0xcc5547=_0x4df350[_0x30be0e(0x1bd)](0x7);if(_0xcc5547!==_0x30be0e(0x1aa))return _0x1da0e1[_0x30be0e(0x1c7)](0x191)[_0x30be0e(0x18b)]({'error':_0x30be0e(0x1a6)});_0x4b8b92();};function a32_0x4725(_0x33e1f0,_0x3059ae){_0x33e1f0=_0x33e1f0-0x185;const _0x228c63=a32_0x228c();let _0x472582=_0x228c63[_0x33e1f0];return _0x472582;}router[a32_0x483fcc(0x1b5)](a32_0x483fcc(0x1a2),verifyInternalApiKey,async(_0x52b967,_0x25785a)=>{const _0x186954=a32_0x483fcc;try{const {id:_0x295481}=_0x52b967[_0x186954(0x1a0)];console[_0x186954(0x1c8)](_0x186954(0x1c0)+_0x295481+_0x186954(0x198));const _0x383b3a=await database_1[_0x186954(0x18c)]['payment']['findUnique']({'where':{'id':_0x295481},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x383b3a)return _0x25785a[_0x186954(0x1c7)](0x194)[_0x186954(0x18b)]({'error':_0x186954(0x19f)});console[_0x186954(0x1c8)](_0x186954(0x197)+_0x383b3a[_0x186954(0x1a5)][_0x186954(0x19b)]),_0x25785a[_0x186954(0x18b)]({'id':_0x383b3a['id'],'amount':_0x383b3a[_0x186954(0x1a8)],'currency':_0x383b3a[_0x186954(0x1c5)],'status':_0x383b3a[_0x186954(0x1c7)],'orderId':_0x383b3a[_0x186954(0x189)],'shop':_0x383b3a[_0x186954(0x1a5)]});}catch(_0x70409f){console[_0x186954(0x192)]('Internal\x20API\x20error\x20getting\x20payment:',_0x70409f),_0x25785a['status'](0x1f4)[_0x186954(0x18b)]({'error':_0x186954(0x1cc)});}}),router[a32_0x483fcc(0x1be)](a32_0x483fcc(0x1a7),verifyInternalApiKey,async(_0x1af1df,_0x2e2396)=>{const _0x38a217=a32_0x483fcc;try{const {id:_0x50a587}=_0x1af1df[_0x38a217(0x1a0)],_0x31193c=_0x1af1df[_0x38a217(0x19e)];console['log']('üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20'+_0x50a587,_0x31193c);const _0x1b9f4f=[_0x38a217(0x1c7),_0x38a217(0x1cb),_0x38a217(0x18f),'card_last4','cardLast4',_0x38a217(0x19c),_0x38a217(0x1ba),'paid_at','paidAt',_0x38a217(0x1b0),_0x38a217(0x1bb)],_0x346bc7={};for(const [_0x335709,_0x79ab92]of Object[_0x38a217(0x18d)](_0x31193c)){if(_0x1b9f4f[_0x38a217(0x1c6)](_0x335709)){let _0x2cd208=_0x335709;if(_0x335709===_0x38a217(0x1cb)||_0x335709==='gatewayPaymentId')_0x2cd208=_0x38a217(0x18f);else{if(_0x335709==='card_last4'||_0x335709===_0x38a217(0x1a1))_0x2cd208=_0x38a217(0x1a1);else{if(_0x335709===_0x38a217(0x19c)||_0x335709===_0x38a217(0x1ba))_0x2cd208=_0x38a217(0x1ba);else{if(_0x335709===_0x38a217(0x19d)||_0x335709==='paidAt')_0x2cd208=_0x38a217(0x1c9);else(_0x335709===_0x38a217(0x1b0)||_0x335709===_0x38a217(0x1bb))&&(_0x2cd208=_0x38a217(0x1bb));}}}_0x2cd208===_0x38a217(0x1c9)&&typeof _0x79ab92===_0x38a217(0x195)?_0x346bc7[_0x2cd208]=new Date(_0x79ab92):_0x346bc7[_0x2cd208]=_0x79ab92;}}if(Object[_0x38a217(0x190)](_0x346bc7)['length']===0x0)return _0x2e2396[_0x38a217(0x1c7)](0x190)[_0x38a217(0x18b)]({'error':'No\x20valid\x20fields\x20to\x20update'});const _0x1ac074=await database_1[_0x38a217(0x18c)]['payment']['update']({'where':{'id':_0x50a587},'data':_0x346bc7});console[_0x38a217(0x1c8)](_0x38a217(0x1b2)+_0x50a587+'\x20updated\x20successfully');if(_0x346bc7[_0x38a217(0x1c7)]==='PAID'){console[_0x38a217(0x1c8)](_0x38a217(0x186)+_0x50a587+_0x38a217(0x18e));try{const {WebhookService:_0x53bd8e}=await Promise['resolve']()[_0x38a217(0x185)](()=>__importStar(require(_0x38a217(0x1b4)))),_0x2e8219=new _0x53bd8e(),_0x58fe25=await database_1[_0x38a217(0x18c)]['payment'][_0x38a217(0x1ca)]({'where':{'id':_0x50a587},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x58fe25&&console[_0x38a217(0x1c8)]('üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20'+_0x50a587);}catch(_0x466731){console[_0x38a217(0x192)]('Error\x20sending\x20webhook\x20notification:',_0x466731);}}_0x2e2396[_0x38a217(0x18b)]({'success':!![],'payment':{'id':_0x1ac074['id'],'status':_0x1ac074[_0x38a217(0x1c7)]}});}catch(_0x19da4a){console['error']('Internal\x20API\x20error\x20updating\x20payment:',_0x19da4a),_0x2e2396['status'](0x1f4)[_0x38a217(0x18b)]({'error':_0x38a217(0x1cc)});}}),router[a32_0x483fcc(0x1b5)]('/health',(_0x56bdf6,_0x40cd10)=>{const _0x5d6868=a32_0x483fcc;_0x40cd10['json']({'status':'ok','timestamp':new Date()[_0x5d6868(0x1c3)]()});}),exports['default']=router;