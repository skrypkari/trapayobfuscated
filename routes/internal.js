'use strict';function a26_0x49ed(){const _0x203e64=['create','gatewayPaymentId','__createBinding','authorization','configurable','40540DHdLxO','internal-api-key','üéâ\x20Payment\x20','body','findUnique','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','log','9246ARzBLI','includes','Invalid\x20internal\x20API\x20key','params','No\x20valid\x20fields\x20to\x20update','9kJvvtC','paidAt','gateway_payment_id','shop','8742769lHTQhu','error','__setModuleDefault','toISOString','3046570qteojW','PAID','Router','cardLast4','\x20with\x20gateway\x20settings','Missing\x20or\x20invalid\x20authorization\x20header','keys','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','patch','then','failure_message','paid_at','16EfIgWI','Payment\x20not\x20found','paymentMethod','/payments/:id/update','Internal\x20server\x20error','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','username','get','defineProperty','7dTyEdK','hasOwnProperty','headers','orderId','getOwnPropertyDescriptor','/payments/:id/gateway-settings','../config/database','Error\x20sending\x20webhook\x20notification:','amount','41893203BzrQwD','resolve','prototype','default','‚úÖ\x20Internal\x20API:\x20Payment\x20','9369248WrEjqV','Internal\x20API\x20error\x20updating\x20payment:','\x20updated\x20successfully','writable','entries','card_last4','getOwnPropertyNames','failureMessage','currency','payment','__importDefault','status','length','payment_method','__esModule','express','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','/health','json','1047747ehwJYk','call','5265mSYxZX'];a26_0x49ed=function(){return _0x203e64;};return a26_0x49ed();}const a26_0x12669b=a26_0x4a4d;(function(_0x186823,_0x3a0d63){const _0x3e4996=a26_0x4a4d,_0x4b419f=_0x186823();while(!![]){try{const _0x3aa0eb=-parseInt(_0x3e4996(0x15a))/0x1*(parseInt(_0x3e4996(0x183))/0x2)+-parseInt(_0x3e4996(0x17b))/0x3*(parseInt(_0x3e4996(0x151))/0x4)+-parseInt(_0x3e4996(0x17d))/0x5*(parseInt(_0x3e4996(0x18a))/0x6)+-parseInt(_0x3e4996(0x141))/0x7+parseInt(_0x3e4996(0x168))/0x8+-parseInt(_0x3e4996(0x18f))/0x9*(-parseInt(_0x3e4996(0x145))/0xa)+parseInt(_0x3e4996(0x163))/0xb;if(_0x3aa0eb===_0x3a0d63)break;else _0x4b419f['push'](_0x4b419f['shift']());}catch(_0x49e705){_0x4b419f['push'](_0x4b419f['shift']());}}}(a26_0x49ed,0xd5520));var __createBinding=this&&this[a26_0x12669b(0x180)]||(Object[a26_0x12669b(0x17e)]?function(_0x4feebf,_0x27722f,_0xa165ef,_0x1bdf57){const _0x3024e1=a26_0x12669b;if(_0x1bdf57===undefined)_0x1bdf57=_0xa165ef;var _0x2b1806=Object[_0x3024e1(0x15e)](_0x27722f,_0xa165ef);(!_0x2b1806||(_0x3024e1(0x158)in _0x2b1806?!_0x27722f['__esModule']:_0x2b1806[_0x3024e1(0x16b)]||_0x2b1806[_0x3024e1(0x182)]))&&(_0x2b1806={'enumerable':!![],'get':function(){return _0x27722f[_0xa165ef];}}),Object['defineProperty'](_0x4feebf,_0x1bdf57,_0x2b1806);}:function(_0x31e007,_0x28df3f,_0x2426fa,_0x3012e4){if(_0x3012e4===undefined)_0x3012e4=_0x2426fa;_0x31e007[_0x3012e4]=_0x28df3f[_0x2426fa];}),__setModuleDefault=this&&this[a26_0x12669b(0x143)]||(Object[a26_0x12669b(0x17e)]?function(_0x2555e7,_0x56615b){const _0x3b7ace=a26_0x12669b;Object[_0x3b7ace(0x159)](_0x2555e7,_0x3b7ace(0x166),{'enumerable':!![],'value':_0x56615b});}:function(_0x2ed205,_0x58dadb){const _0x26e19f=a26_0x12669b;_0x2ed205[_0x26e19f(0x166)]=_0x58dadb;}),__importStar=this&&this['__importStar']||(function(){var _0x6775bf=function(_0x25c056){const _0x4ea662=a26_0x4a4d;return _0x6775bf=Object[_0x4ea662(0x16e)]||function(_0x1a8c6c){const _0x34c819=_0x4ea662;var _0x3fbfea=[];for(var _0x4a98dd in _0x1a8c6c)if(Object[_0x34c819(0x165)][_0x34c819(0x15b)][_0x34c819(0x17c)](_0x1a8c6c,_0x4a98dd))_0x3fbfea[_0x3fbfea[_0x34c819(0x174)]]=_0x4a98dd;return _0x3fbfea;},_0x6775bf(_0x25c056);};return function(_0x59641c){const _0x2db217=a26_0x4a4d;if(_0x59641c&&_0x59641c['__esModule'])return _0x59641c;var _0x540ea2={};if(_0x59641c!=null){for(var _0xcc2d69=_0x6775bf(_0x59641c),_0x4255a9=0x0;_0x4255a9<_0xcc2d69['length'];_0x4255a9++)if(_0xcc2d69[_0x4255a9]!==_0x2db217(0x166))__createBinding(_0x540ea2,_0x59641c,_0xcc2d69[_0x4255a9]);}return __setModuleDefault(_0x540ea2,_0x59641c),_0x540ea2;};}()),__importDefault=this&&this[a26_0x12669b(0x172)]||function(_0x1e8ed0){const _0x25e526=a26_0x12669b;return _0x1e8ed0&&_0x1e8ed0[_0x25e526(0x176)]?_0x1e8ed0:{'default':_0x1e8ed0};};function a26_0x4a4d(_0x5262d9,_0x76b635){const _0x49edf8=a26_0x49ed();return a26_0x4a4d=function(_0x4a4de2,_0x4f0c53){_0x4a4de2=_0x4a4de2-0x13f;let _0x36bb46=_0x49edf8[_0x4a4de2];return _0x36bb46;},a26_0x4a4d(_0x5262d9,_0x76b635);}Object['defineProperty'](exports,a26_0x12669b(0x176),{'value':!![]});const express_1=require(a26_0x12669b(0x177)),database_1=__importDefault(require(a26_0x12669b(0x160))),router=(0x0,express_1[a26_0x12669b(0x147)])(),verifyInternalApiKey=(_0x250943,_0x5ad5fc,_0x4247dc)=>{const _0xed45cc=a26_0x12669b,_0xe16cf7=_0x250943[_0xed45cc(0x15c)][_0xed45cc(0x181)];if(!_0xe16cf7||!_0xe16cf7['startsWith']('Bearer\x20'))return _0x5ad5fc[_0xed45cc(0x173)](0x191)[_0xed45cc(0x17a)]({'error':_0xed45cc(0x14a)});const _0x1881d5=_0xe16cf7['substring'](0x7);if(_0x1881d5!==_0xed45cc(0x184))return _0x5ad5fc[_0xed45cc(0x173)](0x191)[_0xed45cc(0x17a)]({'error':_0xed45cc(0x18c)});_0x4247dc();};router[a26_0x12669b(0x158)](a26_0x12669b(0x15f),verifyInternalApiKey,async(_0x4c2826,_0x5bc1d2)=>{const _0xc2f484=a26_0x12669b;try{const {id:_0x2bbf8d}=_0x4c2826[_0xc2f484(0x18d)];console[_0xc2f484(0x189)](_0xc2f484(0x156)+_0x2bbf8d+_0xc2f484(0x149));const _0x4ab616=await database_1['default'][_0xc2f484(0x171)][_0xc2f484(0x187)]({'where':{'id':_0x2bbf8d},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x4ab616)return _0x5bc1d2[_0xc2f484(0x173)](0x194)['json']({'error':_0xc2f484(0x152)});console[_0xc2f484(0x189)](_0xc2f484(0x178)+_0x4ab616[_0xc2f484(0x140)][_0xc2f484(0x157)]),_0x5bc1d2[_0xc2f484(0x17a)]({'id':_0x4ab616['id'],'amount':_0x4ab616[_0xc2f484(0x162)],'currency':_0x4ab616[_0xc2f484(0x170)],'status':_0x4ab616[_0xc2f484(0x173)],'orderId':_0x4ab616[_0xc2f484(0x15d)],'shop':_0x4ab616[_0xc2f484(0x140)]});}catch(_0x99fdda){console['error']('Internal\x20API\x20error\x20getting\x20payment:',_0x99fdda),_0x5bc1d2['status'](0x1f4)[_0xc2f484(0x17a)]({'error':_0xc2f484(0x155)});}}),router[a26_0x12669b(0x14d)](a26_0x12669b(0x154),verifyInternalApiKey,async(_0x41fb29,_0x3a2b16)=>{const _0x3b2c03=a26_0x12669b;try{const {id:_0xacce35}=_0x41fb29['params'],_0x57aa61=_0x41fb29[_0x3b2c03(0x186)];console['log']('üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20'+_0xacce35,_0x57aa61);const _0x5880c6=[_0x3b2c03(0x173),_0x3b2c03(0x13f),'gatewayPaymentId','card_last4',_0x3b2c03(0x148),_0x3b2c03(0x175),_0x3b2c03(0x153),_0x3b2c03(0x150),_0x3b2c03(0x190),_0x3b2c03(0x14f),_0x3b2c03(0x16f)],_0x3aac17={};for(const [_0x228690,_0xbe2420]of Object[_0x3b2c03(0x16c)](_0x57aa61)){if(_0x5880c6[_0x3b2c03(0x18b)](_0x228690)){let _0xf86906=_0x228690;if(_0x228690===_0x3b2c03(0x13f)||_0x228690===_0x3b2c03(0x17f))_0xf86906=_0x3b2c03(0x17f);else{if(_0x228690===_0x3b2c03(0x16d)||_0x228690==='cardLast4')_0xf86906=_0x3b2c03(0x148);else{if(_0x228690===_0x3b2c03(0x175)||_0x228690===_0x3b2c03(0x153))_0xf86906='paymentMethod';else{if(_0x228690===_0x3b2c03(0x150)||_0x228690===_0x3b2c03(0x190))_0xf86906=_0x3b2c03(0x190);else(_0x228690==='failure_message'||_0x228690==='failureMessage')&&(_0xf86906=_0x3b2c03(0x16f));}}}_0xf86906==='paidAt'&&typeof _0xbe2420==='string'?_0x3aac17[_0xf86906]=new Date(_0xbe2420):_0x3aac17[_0xf86906]=_0xbe2420;}}if(Object[_0x3b2c03(0x14b)](_0x3aac17)[_0x3b2c03(0x174)]===0x0)return _0x3a2b16[_0x3b2c03(0x173)](0x190)[_0x3b2c03(0x17a)]({'error':_0x3b2c03(0x18e)});const _0x4fb597=await database_1[_0x3b2c03(0x166)]['payment']['update']({'where':{'id':_0xacce35},'data':_0x3aac17});console[_0x3b2c03(0x189)](_0x3b2c03(0x167)+_0xacce35+_0x3b2c03(0x16a));if(_0x3aac17[_0x3b2c03(0x173)]===_0x3b2c03(0x146)){console[_0x3b2c03(0x189)](_0x3b2c03(0x185)+_0xacce35+_0x3b2c03(0x14c));try{const {WebhookService:_0x2388d6}=await Promise[_0x3b2c03(0x164)]()[_0x3b2c03(0x14e)](()=>__importStar(require('../services/webhookService'))),_0x14ab45=new _0x2388d6(),_0x8bbf46=await database_1[_0x3b2c03(0x166)][_0x3b2c03(0x171)][_0x3b2c03(0x187)]({'where':{'id':_0xacce35},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x8bbf46&&console[_0x3b2c03(0x189)](_0x3b2c03(0x188)+_0xacce35);}catch(_0x490b1d){console[_0x3b2c03(0x142)](_0x3b2c03(0x161),_0x490b1d);}}_0x3a2b16[_0x3b2c03(0x17a)]({'success':!![],'payment':{'id':_0x4fb597['id'],'status':_0x4fb597[_0x3b2c03(0x173)]}});}catch(_0x3e189a){console[_0x3b2c03(0x142)](_0x3b2c03(0x169),_0x3e189a),_0x3a2b16[_0x3b2c03(0x173)](0x1f4)[_0x3b2c03(0x17a)]({'error':_0x3b2c03(0x155)});}}),router[a26_0x12669b(0x158)](a26_0x12669b(0x179),(_0x49d583,_0x2e4269)=>{const _0xe042b0=a26_0x12669b;_0x2e4269[_0xe042b0(0x17a)]({'status':'ok','timestamp':new Date()[_0xe042b0(0x144)]()});}),exports['default']=router;