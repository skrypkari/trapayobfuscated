'use strict';const a32_0x54dc0a=a32_0x5830;function a32_0x23ab(){const _0x273a56=['gatewayPaymentId','payment_method','internal-api-key','Bearer\x20','4753896ZxNksL','currency','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20','then','toISOString','Error\x20sending\x20webhook\x20notification:','keys','headers','__esModule','findUnique','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','shop','payment','entries','failureMessage','get','hasOwnProperty','prototype','__createBinding','defineProperty','card_last4','amount','configurable','\x20updated\x20successfully','6knnzxr','getOwnPropertyDescriptor','238395WTiaNz','paymentMethod','20544062zJbhIX','params','writable','call','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','length','default','/payments/:id/update','/payments/:id/gateway-settings','orderId','cardLast4','Internal\x20API\x20error\x20updating\x20payment:','39vEMoXm','89063nzQqbS','__setModuleDefault','patch','Invalid\x20internal\x20API\x20key','status','create','üéâ\x20Payment\x20','body','No\x20valid\x20fields\x20to\x20update','Internal\x20server\x20error','__importDefault','4870061GAMtVo','10DrLwio','error','18BFPQCU','\x20with\x20gateway\x20settings','startsWith','paidAt','log','resolve','json','paid_at','includes','username','353828TRrzUY','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','7110342fpsExu','failure_message','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','../services/webhookService'];a32_0x23ab=function(){return _0x273a56;};return a32_0x23ab();}(function(_0x283033,_0x396ff8){const _0xb17d8d=a32_0x5830,_0x2a2f44=_0x283033();while(!![]){try{const _0x498e4c=-parseInt(_0xb17d8d(0x149))/0x1*(-parseInt(_0xb17d8d(0x10c))/0x2)+-parseInt(_0xb17d8d(0x148))/0x3*(parseInt(_0xb17d8d(0x116))/0x4)+-parseInt(_0xb17d8d(0x13a))/0x5+-parseInt(_0xb17d8d(0x138))/0x6*(parseInt(_0xb17d8d(0x109))/0x7)+parseInt(_0xb17d8d(0x120))/0x8+parseInt(_0xb17d8d(0x118))/0x9*(-parseInt(_0xb17d8d(0x10a))/0xa)+parseInt(_0xb17d8d(0x13c))/0xb;if(_0x498e4c===_0x396ff8)break;else _0x2a2f44['push'](_0x2a2f44['shift']());}catch(_0x4d3130){_0x2a2f44['push'](_0x2a2f44['shift']());}}}(a32_0x23ab,0x8d9e1));function a32_0x5830(_0x35432a,_0x1f86f1){_0x35432a=_0x35432a-0x108;const _0x23ab73=a32_0x23ab();let _0x583088=_0x23ab73[_0x35432a];return _0x583088;}var __createBinding=this&&this[a32_0x54dc0a(0x132)]||(Object[a32_0x54dc0a(0x14e)]?function(_0x3e829e,_0xe136fa,_0x2037c5,_0x42a750){const _0x5c8ab8=a32_0x54dc0a;if(_0x42a750===undefined)_0x42a750=_0x2037c5;var _0x48ce69=Object[_0x5c8ab8(0x139)](_0xe136fa,_0x2037c5);(!_0x48ce69||(_0x5c8ab8(0x12f)in _0x48ce69?!_0xe136fa[_0x5c8ab8(0x128)]:_0x48ce69[_0x5c8ab8(0x13e)]||_0x48ce69[_0x5c8ab8(0x136)]))&&(_0x48ce69={'enumerable':!![],'get':function(){return _0xe136fa[_0x2037c5];}}),Object[_0x5c8ab8(0x133)](_0x3e829e,_0x42a750,_0x48ce69);}:function(_0x1cc2fc,_0x23601d,_0x4a9c0b,_0x2ac465){if(_0x2ac465===undefined)_0x2ac465=_0x4a9c0b;_0x1cc2fc[_0x2ac465]=_0x23601d[_0x4a9c0b];}),__setModuleDefault=this&&this[a32_0x54dc0a(0x14a)]||(Object[a32_0x54dc0a(0x14e)]?function(_0x16ccbd,_0x1bbfc3){const _0x32c0e8=a32_0x54dc0a;Object['defineProperty'](_0x16ccbd,_0x32c0e8(0x142),{'enumerable':!![],'value':_0x1bbfc3});}:function(_0x170c8d,_0x4d2780){const _0xb4a4cb=a32_0x54dc0a;_0x170c8d[_0xb4a4cb(0x142)]=_0x4d2780;}),__importStar=this&&this['__importStar']||(function(){var _0x16536c=function(_0x1a9173){return _0x16536c=Object['getOwnPropertyNames']||function(_0x255dc9){const _0x5cc235=a32_0x5830;var _0x26aca3=[];for(var _0x21cd0b in _0x255dc9)if(Object[_0x5cc235(0x131)][_0x5cc235(0x130)][_0x5cc235(0x13f)](_0x255dc9,_0x21cd0b))_0x26aca3[_0x26aca3[_0x5cc235(0x141)]]=_0x21cd0b;return _0x26aca3;},_0x16536c(_0x1a9173);};return function(_0x4cceda){const _0x354403=a32_0x5830;if(_0x4cceda&&_0x4cceda[_0x354403(0x128)])return _0x4cceda;var _0x272d6d={};if(_0x4cceda!=null){for(var _0x386b9f=_0x16536c(_0x4cceda),_0x26ed09=0x0;_0x26ed09<_0x386b9f['length'];_0x26ed09++)if(_0x386b9f[_0x26ed09]!==_0x354403(0x142))__createBinding(_0x272d6d,_0x4cceda,_0x386b9f[_0x26ed09]);}return __setModuleDefault(_0x272d6d,_0x4cceda),_0x272d6d;};}()),__importDefault=this&&this[a32_0x54dc0a(0x108)]||function(_0x2649ae){const _0x1c175a=a32_0x54dc0a;return _0x2649ae&&_0x2649ae[_0x1c175a(0x128)]?_0x2649ae:{'default':_0x2649ae};};Object[a32_0x54dc0a(0x133)](exports,a32_0x54dc0a(0x128),{'value':!![]});const express_1=require('express'),database_1=__importDefault(require('../config/database')),router=(0x0,express_1['Router'])(),verifyInternalApiKey=(_0x13a1d3,_0x2092d8,_0x1b3a0f)=>{const _0x13b728=a32_0x54dc0a,_0x462686=_0x13a1d3[_0x13b728(0x127)]['authorization'];if(!_0x462686||!_0x462686[_0x13b728(0x10e)](_0x13b728(0x11f)))return _0x2092d8[_0x13b728(0x14d)](0x191)[_0x13b728(0x112)]({'error':'Missing\x20or\x20invalid\x20authorization\x20header'});const _0x4ec062=_0x462686['substring'](0x7);if(_0x4ec062!==_0x13b728(0x11e))return _0x2092d8['status'](0x191)['json']({'error':_0x13b728(0x14c)});_0x1b3a0f();};router[a32_0x54dc0a(0x12f)](a32_0x54dc0a(0x144),verifyInternalApiKey,async(_0x1e46f3,_0xcbcff8)=>{const _0x4f659a=a32_0x54dc0a;try{const {id:_0x5d3f15}=_0x1e46f3[_0x4f659a(0x13d)];console[_0x4f659a(0x110)](_0x4f659a(0x11a)+_0x5d3f15+_0x4f659a(0x10d));const _0x467c59=await database_1[_0x4f659a(0x142)][_0x4f659a(0x12c)][_0x4f659a(0x129)]({'where':{'id':_0x5d3f15},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x467c59)return _0xcbcff8[_0x4f659a(0x14d)](0x194)[_0x4f659a(0x112)]({'error':'Payment\x20not\x20found'});console[_0x4f659a(0x110)](_0x4f659a(0x12a)+_0x467c59['shop'][_0x4f659a(0x115)]),_0xcbcff8[_0x4f659a(0x112)]({'id':_0x467c59['id'],'amount':_0x467c59[_0x4f659a(0x135)],'currency':_0x467c59[_0x4f659a(0x121)],'status':_0x467c59['status'],'orderId':_0x467c59[_0x4f659a(0x145)],'shop':_0x467c59[_0x4f659a(0x12b)]});}catch(_0x520058){console[_0x4f659a(0x10b)]('Internal\x20API\x20error\x20getting\x20payment:',_0x520058),_0xcbcff8[_0x4f659a(0x14d)](0x1f4)['json']({'error':_0x4f659a(0x152)});}}),router[a32_0x54dc0a(0x14b)](a32_0x54dc0a(0x143),verifyInternalApiKey,async(_0x4f198d,_0x1857c8)=>{const _0x3bd776=a32_0x54dc0a;try{const {id:_0x1087c5}=_0x4f198d[_0x3bd776(0x13d)],_0x1c51e0=_0x4f198d[_0x3bd776(0x150)];console[_0x3bd776(0x110)](_0x3bd776(0x122)+_0x1087c5,_0x1c51e0);const _0x32ad41=[_0x3bd776(0x14d),'gateway_payment_id','gatewayPaymentId',_0x3bd776(0x134),'cardLast4',_0x3bd776(0x11d),_0x3bd776(0x13b),_0x3bd776(0x113),_0x3bd776(0x10f),_0x3bd776(0x119),'failureMessage'],_0x2b6125={};for(const [_0x4e39f5,_0x4641b4]of Object[_0x3bd776(0x12d)](_0x1c51e0)){if(_0x32ad41[_0x3bd776(0x114)](_0x4e39f5)){let _0x33d8d6=_0x4e39f5;if(_0x4e39f5==='gateway_payment_id'||_0x4e39f5===_0x3bd776(0x11c))_0x33d8d6='gatewayPaymentId';else{if(_0x4e39f5===_0x3bd776(0x134)||_0x4e39f5===_0x3bd776(0x146))_0x33d8d6=_0x3bd776(0x146);else{if(_0x4e39f5===_0x3bd776(0x11d)||_0x4e39f5===_0x3bd776(0x13b))_0x33d8d6='paymentMethod';else{if(_0x4e39f5===_0x3bd776(0x113)||_0x4e39f5===_0x3bd776(0x10f))_0x33d8d6=_0x3bd776(0x10f);else(_0x4e39f5===_0x3bd776(0x119)||_0x4e39f5==='failureMessage')&&(_0x33d8d6=_0x3bd776(0x12e));}}}_0x33d8d6===_0x3bd776(0x10f)&&typeof _0x4641b4==='string'?_0x2b6125[_0x33d8d6]=new Date(_0x4641b4):_0x2b6125[_0x33d8d6]=_0x4641b4;}}if(Object[_0x3bd776(0x126)](_0x2b6125)[_0x3bd776(0x141)]===0x0)return _0x1857c8[_0x3bd776(0x14d)](0x190)[_0x3bd776(0x112)]({'error':_0x3bd776(0x151)});const _0x48fe23=await database_1['default'][_0x3bd776(0x12c)]['update']({'where':{'id':_0x1087c5},'data':_0x2b6125});console[_0x3bd776(0x110)]('‚úÖ\x20Internal\x20API:\x20Payment\x20'+_0x1087c5+_0x3bd776(0x137));if(_0x2b6125[_0x3bd776(0x14d)]==='PAID'){console[_0x3bd776(0x110)](_0x3bd776(0x14f)+_0x1087c5+_0x3bd776(0x117));try{const {WebhookService:_0x343909}=await Promise[_0x3bd776(0x111)]()[_0x3bd776(0x123)](()=>__importStar(require(_0x3bd776(0x11b)))),_0xa23943=new _0x343909(),_0x400807=await database_1[_0x3bd776(0x142)][_0x3bd776(0x12c)]['findUnique']({'where':{'id':_0x1087c5},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x400807&&console['log'](_0x3bd776(0x140)+_0x1087c5);}catch(_0x2d535b){console[_0x3bd776(0x10b)](_0x3bd776(0x125),_0x2d535b);}}_0x1857c8[_0x3bd776(0x112)]({'success':!![],'payment':{'id':_0x48fe23['id'],'status':_0x48fe23[_0x3bd776(0x14d)]}});}catch(_0x4fe2ca){console[_0x3bd776(0x10b)](_0x3bd776(0x147),_0x4fe2ca),_0x1857c8['status'](0x1f4)[_0x3bd776(0x112)]({'error':'Internal\x20server\x20error'});}}),router['get']('/health',(_0x35f8a8,_0x51cd27)=>{const _0x38df3a=a32_0x54dc0a;_0x51cd27[_0x38df3a(0x112)]({'status':'ok','timestamp':new Date()[_0x38df3a(0x124)]()});}),exports[a32_0x54dc0a(0x142)]=router;