'use strict';function a35_0xa414(){const _0x51e6e3=['__importStar','patch','getOwnPropertyNames','failureMessage','1837266TmszJw','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','paymentMethod','üéâ\x20Payment\x20','Router','create','internal-api-key','__setModuleDefault','__importDefault','payment_method','Missing\x20or\x20invalid\x20authorization\x20header','Bearer\x20','card_last4','‚úÖ\x20Internal\x20API:\x20Payment\x20','__createBinding','Payment\x20not\x20found','configurable','197328bOWLRb','authorization','/payments/:id/gateway-settings','Internal\x20server\x20error','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20','writable','getOwnPropertyDescriptor','\x20updated\x20successfully','paidAt','call','1514636MaiKLQ','json','gateway_payment_id','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','default','4866220OBBjWy','cardLast4','includes','5045845GtkORY','gatewayPaymentId','then','findUnique','PAID','status','../services/webhookService','Internal\x20API\x20error\x20getting\x20payment:','__esModule','amount','get','220KxmfEe','1295687WXJPgF','failure_message','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','Error\x20sending\x20webhook\x20notification:','payment','headers','length','body','params','shop','defineProperty','4521760aQpDMP','Internal\x20API\x20error\x20updating\x20payment:','keys','paid_at','error','log','../config/database','orderId','update'];a35_0xa414=function(){return _0x51e6e3;};return a35_0xa414();}const a35_0x39876=a35_0x4c14;(function(_0x200bd3,_0x4a9703){const _0x5b37b7=a35_0x4c14,_0xbdcec1=_0x200bd3();while(!![]){try{const _0x2932bd=parseInt(_0x5b37b7(0x20c))/0x1+-parseInt(_0x5b37b7(0x1f8))/0x2+-parseInt(_0x5b37b7(0x1dd))/0x3+parseInt(_0x5b37b7(0x1fd))/0x4+parseInt(_0x5b37b7(0x20b))/0x5*(-parseInt(_0x5b37b7(0x1ee))/0x6)+parseInt(_0x5b37b7(0x200))/0x7+parseInt(_0x5b37b7(0x217))/0x8;if(_0x2932bd===_0x4a9703)break;else _0xbdcec1['push'](_0xbdcec1['shift']());}catch(_0x5d1305){_0xbdcec1['push'](_0xbdcec1['shift']());}}}(a35_0xa414,0xef9ed));function a35_0x4c14(_0x4758de,_0x3fd3b9){_0x4758de=_0x4758de-0x1d8;const _0xa4142=a35_0xa414();let _0x4c146b=_0xa4142[_0x4758de];return _0x4c146b;}var __createBinding=this&&this[a35_0x39876(0x1eb)]||(Object[a35_0x39876(0x1e2)]?function(_0x47538d,_0x59f08b,_0x4f874f,_0x5d6410){const _0x5f53ba=a35_0x39876;if(_0x5d6410===undefined)_0x5d6410=_0x4f874f;var _0x227c74=Object[_0x5f53ba(0x1f4)](_0x59f08b,_0x4f874f);(!_0x227c74||(_0x5f53ba(0x20a)in _0x227c74?!_0x59f08b[_0x5f53ba(0x208)]:_0x227c74[_0x5f53ba(0x1f3)]||_0x227c74[_0x5f53ba(0x1ed)]))&&(_0x227c74={'enumerable':!![],'get':function(){return _0x59f08b[_0x4f874f];}}),Object[_0x5f53ba(0x216)](_0x47538d,_0x5d6410,_0x227c74);}:function(_0x5183a3,_0x494a85,_0x54aac6,_0x18755d){if(_0x18755d===undefined)_0x18755d=_0x54aac6;_0x5183a3[_0x18755d]=_0x494a85[_0x54aac6];}),__setModuleDefault=this&&this[a35_0x39876(0x1e4)]||(Object[a35_0x39876(0x1e2)]?function(_0x17e000,_0x304355){Object['defineProperty'](_0x17e000,'default',{'enumerable':!![],'value':_0x304355});}:function(_0x1b939e,_0x12366d){const _0x2367b1=a35_0x39876;_0x1b939e[_0x2367b1(0x1fc)]=_0x12366d;}),__importStar=this&&this[a35_0x39876(0x1d9)]||(function(){var _0x3ad4f1=function(_0x4efa0a){const _0x2523da=a35_0x4c14;return _0x3ad4f1=Object[_0x2523da(0x1db)]||function(_0x876aeb){const _0x39d8d6=_0x2523da;var _0x48f48c=[];for(var _0x32be5a in _0x876aeb)if(Object['prototype']['hasOwnProperty'][_0x39d8d6(0x1f7)](_0x876aeb,_0x32be5a))_0x48f48c[_0x48f48c[_0x39d8d6(0x212)]]=_0x32be5a;return _0x48f48c;},_0x3ad4f1(_0x4efa0a);};return function(_0x19f15c){const _0xbd62cf=a35_0x4c14;if(_0x19f15c&&_0x19f15c['__esModule'])return _0x19f15c;var _0x293844={};if(_0x19f15c!=null){for(var _0x1621cb=_0x3ad4f1(_0x19f15c),_0x316653=0x0;_0x316653<_0x1621cb['length'];_0x316653++)if(_0x1621cb[_0x316653]!==_0xbd62cf(0x1fc))__createBinding(_0x293844,_0x19f15c,_0x1621cb[_0x316653]);}return __setModuleDefault(_0x293844,_0x19f15c),_0x293844;};}()),__importDefault=this&&this[a35_0x39876(0x1e5)]||function(_0x370f59){return _0x370f59&&_0x370f59['__esModule']?_0x370f59:{'default':_0x370f59};};Object[a35_0x39876(0x216)](exports,'__esModule',{'value':!![]});const express_1=require('express'),database_1=__importDefault(require(a35_0x39876(0x21d))),router=(0x0,express_1[a35_0x39876(0x1e1)])(),verifyInternalApiKey=(_0x2b4381,_0x5ec4dd,_0x18c49e)=>{const _0x56f320=a35_0x39876,_0x47fadf=_0x2b4381[_0x56f320(0x211)][_0x56f320(0x1ef)];if(!_0x47fadf||!_0x47fadf['startsWith'](_0x56f320(0x1e8)))return _0x5ec4dd[_0x56f320(0x205)](0x191)[_0x56f320(0x1f9)]({'error':_0x56f320(0x1e7)});const _0x3bf1ca=_0x47fadf['substring'](0x7);if(_0x3bf1ca!==_0x56f320(0x1e3))return _0x5ec4dd[_0x56f320(0x205)](0x191)[_0x56f320(0x1f9)]({'error':'Invalid\x20internal\x20API\x20key'});_0x18c49e();};router[a35_0x39876(0x20a)](a35_0x39876(0x1f0),verifyInternalApiKey,async(_0x5eb253,_0x1302de)=>{const _0x128f84=a35_0x39876;try{const {id:_0xc2db74}=_0x5eb253[_0x128f84(0x214)];console['log'](_0x128f84(0x20e)+_0xc2db74+'\x20with\x20gateway\x20settings');const _0x3b6a1e=await database_1[_0x128f84(0x1fc)]['payment'][_0x128f84(0x203)]({'where':{'id':_0xc2db74},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x3b6a1e)return _0x1302de['status'](0x194)[_0x128f84(0x1f9)]({'error':_0x128f84(0x1ec)});console['log'](_0x128f84(0x1fb)+_0x3b6a1e[_0x128f84(0x215)]['username']),_0x1302de[_0x128f84(0x1f9)]({'id':_0x3b6a1e['id'],'amount':_0x3b6a1e[_0x128f84(0x209)],'currency':_0x3b6a1e['currency'],'status':_0x3b6a1e[_0x128f84(0x205)],'orderId':_0x3b6a1e[_0x128f84(0x21e)],'shop':_0x3b6a1e['shop']});}catch(_0x30b077){console[_0x128f84(0x21b)](_0x128f84(0x207),_0x30b077),_0x1302de[_0x128f84(0x205)](0x1f4)[_0x128f84(0x1f9)]({'error':_0x128f84(0x1f1)});}}),router[a35_0x39876(0x1da)]('/payments/:id/update',verifyInternalApiKey,async(_0x573faa,_0x2ff8a0)=>{const _0x54079f=a35_0x39876;try{const {id:_0xc1ce43}=_0x573faa[_0x54079f(0x214)],_0x2e9a12=_0x573faa[_0x54079f(0x213)];console[_0x54079f(0x21c)](_0x54079f(0x1f2)+_0xc1ce43,_0x2e9a12);const _0x48d183=[_0x54079f(0x205),'gateway_payment_id',_0x54079f(0x201),'card_last4',_0x54079f(0x1fe),_0x54079f(0x1e6),_0x54079f(0x1df),_0x54079f(0x21a),_0x54079f(0x1f6),'failure_message',_0x54079f(0x1dc)],_0x5d7334={};for(const [_0x1543b5,_0x112d4e]of Object['entries'](_0x2e9a12)){if(_0x48d183[_0x54079f(0x1ff)](_0x1543b5)){let _0x166319=_0x1543b5;if(_0x1543b5===_0x54079f(0x1fa)||_0x1543b5===_0x54079f(0x201))_0x166319=_0x54079f(0x201);else{if(_0x1543b5===_0x54079f(0x1e9)||_0x1543b5===_0x54079f(0x1fe))_0x166319=_0x54079f(0x1fe);else{if(_0x1543b5==='payment_method'||_0x1543b5===_0x54079f(0x1df))_0x166319='paymentMethod';else{if(_0x1543b5===_0x54079f(0x21a)||_0x1543b5==='paidAt')_0x166319=_0x54079f(0x1f6);else(_0x1543b5===_0x54079f(0x20d)||_0x1543b5==='failureMessage')&&(_0x166319=_0x54079f(0x1dc));}}}_0x166319===_0x54079f(0x1f6)&&typeof _0x112d4e==='string'?_0x5d7334[_0x166319]=new Date(_0x112d4e):_0x5d7334[_0x166319]=_0x112d4e;}}if(Object[_0x54079f(0x219)](_0x5d7334)[_0x54079f(0x212)]===0x0)return _0x2ff8a0[_0x54079f(0x205)](0x190)['json']({'error':'No\x20valid\x20fields\x20to\x20update'});const _0x1fafb8=await database_1[_0x54079f(0x1fc)][_0x54079f(0x210)][_0x54079f(0x1d8)]({'where':{'id':_0xc1ce43},'data':_0x5d7334});console[_0x54079f(0x21c)](_0x54079f(0x1ea)+_0xc1ce43+_0x54079f(0x1f5));if(_0x5d7334[_0x54079f(0x205)]===_0x54079f(0x204)){console['log'](_0x54079f(0x1e0)+_0xc1ce43+_0x54079f(0x1de));try{const {WebhookService:_0x138f22}=await Promise['resolve']()[_0x54079f(0x202)](()=>__importStar(require(_0x54079f(0x206)))),_0x1d4e66=new _0x138f22(),_0x241705=await database_1[_0x54079f(0x1fc)]['payment']['findUnique']({'where':{'id':_0xc1ce43},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x241705&&console[_0x54079f(0x21c)]('üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20'+_0xc1ce43);}catch(_0x20a95f){console[_0x54079f(0x21b)](_0x54079f(0x20f),_0x20a95f);}}_0x2ff8a0[_0x54079f(0x1f9)]({'success':!![],'payment':{'id':_0x1fafb8['id'],'status':_0x1fafb8[_0x54079f(0x205)]}});}catch(_0x325793){console[_0x54079f(0x21b)](_0x54079f(0x218),_0x325793),_0x2ff8a0[_0x54079f(0x205)](0x1f4)['json']({'error':_0x54079f(0x1f1)});}}),router['get']('/health',(_0x336401,_0x299665)=>{const _0x2ec0b6=a35_0x39876;_0x299665[_0x2ec0b6(0x1f9)]({'status':'ok','timestamp':new Date()['toISOString']()});}),exports[a35_0x39876(0x1fc)]=router;