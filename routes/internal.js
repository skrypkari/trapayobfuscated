'use strict';function a27_0x2964(_0x189205,_0xca34ea){const _0x1cd9e3=a27_0x1cd9();return a27_0x2964=function(_0x2964ac,_0xa075ce){_0x2964ac=_0x2964ac-0x182;let _0x44c255=_0x1cd9e3[_0x2964ac];return _0x44c255;},a27_0x2964(_0x189205,_0xca34ea);}function a27_0x1cd9(){const _0x67a558=['defineProperty','__esModule','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','failure_message','startsWith','log','1339210bZsXii','orderId','__createBinding','/health','findUnique','hasOwnProperty','‚úÖ\x20Internal\x20API:\x20Payment\x20','/payments/:id/gateway-settings','paidAt','Router','\x20with\x20gateway\x20settings','7QhGOTt','shop','../services/webhookService','cardLast4','gateway_payment_id','paid_at','payment','username','120715FrYcNh','call','paymentMethod','authorization','keys','gatewayPaymentId','__setModuleDefault','PAID','282RYCSKn','Invalid\x20internal\x20API\x20key','/payments/:id/update','create','json','1413172dBWFdF','üéâ\x20Payment\x20','getOwnPropertyDescriptor','96356ZspjJh','amount','Error\x20sending\x20webhook\x20notification:','7823384jWsrUy','../config/database','Internal\x20server\x20error','toISOString','default','11qpjQiF','includes','card_last4','payment_method','error','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','Missing\x20or\x20invalid\x20authorization\x20header','express','substring','prototype','71804010RhCVmU','params','then','failureMessage','12552687onSDvc','configurable','108YAUQwW','status','internal-api-key','get','Bearer\x20','length','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20'];a27_0x1cd9=function(){return _0x67a558;};return a27_0x1cd9();}const a27_0x9900da=a27_0x2964;(function(_0x3ad6a6,_0x118878){const _0x17195a=a27_0x2964,_0x45d038=_0x3ad6a6();while(!![]){try{const _0x3a9909=-parseInt(_0x17195a(0x1b3))/0x1+-parseInt(_0x17195a(0x18a))/0x2+parseInt(_0x17195a(0x1a6))/0x3*(-parseInt(_0x17195a(0x18d))/0x4)+parseInt(_0x17195a(0x1c6))/0x5*(-parseInt(_0x17195a(0x185))/0x6)+-parseInt(_0x17195a(0x1be))/0x7*(parseInt(_0x17195a(0x190))/0x8)+-parseInt(_0x17195a(0x1a4))/0x9+parseInt(_0x17195a(0x1a0))/0xa*(parseInt(_0x17195a(0x195))/0xb);if(_0x3a9909===_0x118878)break;else _0x45d038['push'](_0x45d038['shift']());}catch(_0x405b68){_0x45d038['push'](_0x45d038['shift']());}}}(a27_0x1cd9,0xb98ce));var __createBinding=this&&this[a27_0x9900da(0x1b5)]||(Object[a27_0x9900da(0x188)]?function(_0x5905d6,_0x5801f6,_0x34d555,_0x18647e){const _0x5c55cb=a27_0x9900da;if(_0x18647e===undefined)_0x18647e=_0x34d555;var _0x306774=Object[_0x5c55cb(0x18c)](_0x5801f6,_0x34d555);(!_0x306774||(_0x5c55cb(0x1a9)in _0x306774?!_0x5801f6[_0x5c55cb(0x1ae)]:_0x306774['writable']||_0x306774[_0x5c55cb(0x1a5)]))&&(_0x306774={'enumerable':!![],'get':function(){return _0x5801f6[_0x34d555];}}),Object[_0x5c55cb(0x1ad)](_0x5905d6,_0x18647e,_0x306774);}:function(_0x2b5181,_0x7212cd,_0x11438c,_0xfe93b6){if(_0xfe93b6===undefined)_0xfe93b6=_0x11438c;_0x2b5181[_0xfe93b6]=_0x7212cd[_0x11438c];}),__setModuleDefault=this&&this[a27_0x9900da(0x183)]||(Object[a27_0x9900da(0x188)]?function(_0x1c49e8,_0x1c4f4f){const _0x1bc9c6=a27_0x9900da;Object[_0x1bc9c6(0x1ad)](_0x1c49e8,'default',{'enumerable':!![],'value':_0x1c4f4f});}:function(_0x269e3c,_0x3f2bce){_0x269e3c['default']=_0x3f2bce;}),__importStar=this&&this['__importStar']||(function(){var _0x449a2e=function(_0x1e2d78){return _0x449a2e=Object['getOwnPropertyNames']||function(_0x53f252){const _0x4d7e85=a27_0x2964;var _0x4781f5=[];for(var _0x581428 in _0x53f252)if(Object[_0x4d7e85(0x19f)][_0x4d7e85(0x1b8)][_0x4d7e85(0x1c7)](_0x53f252,_0x581428))_0x4781f5[_0x4781f5['length']]=_0x581428;return _0x4781f5;},_0x449a2e(_0x1e2d78);};return function(_0x5ee024){const _0x4a96fe=a27_0x2964;if(_0x5ee024&&_0x5ee024['__esModule'])return _0x5ee024;var _0x8b2c8f={};if(_0x5ee024!=null){for(var _0x2fe06b=_0x449a2e(_0x5ee024),_0x4d0e59=0x0;_0x4d0e59<_0x2fe06b[_0x4a96fe(0x1ab)];_0x4d0e59++)if(_0x2fe06b[_0x4d0e59]!=='default')__createBinding(_0x8b2c8f,_0x5ee024,_0x2fe06b[_0x4d0e59]);}return __setModuleDefault(_0x8b2c8f,_0x5ee024),_0x8b2c8f;};}()),__importDefault=this&&this['__importDefault']||function(_0x499238){const _0x4f97e4=a27_0x9900da;return _0x499238&&_0x499238[_0x4f97e4(0x1ae)]?_0x499238:{'default':_0x499238};};Object[a27_0x9900da(0x1ad)](exports,a27_0x9900da(0x1ae),{'value':!![]});const express_1=require(a27_0x9900da(0x19d)),database_1=__importDefault(require(a27_0x9900da(0x191))),router=(0x0,express_1[a27_0x9900da(0x1bc)])(),verifyInternalApiKey=(_0x9ec0b1,_0x4f3e36,_0x320c9c)=>{const _0x4ba38b=a27_0x9900da,_0x543c35=_0x9ec0b1['headers'][_0x4ba38b(0x1c9)];if(!_0x543c35||!_0x543c35[_0x4ba38b(0x1b1)](_0x4ba38b(0x1aa)))return _0x4f3e36[_0x4ba38b(0x1a7)](0x191)['json']({'error':_0x4ba38b(0x19c)});const _0x3745a7=_0x543c35[_0x4ba38b(0x19e)](0x7);if(_0x3745a7!==_0x4ba38b(0x1a8))return _0x4f3e36[_0x4ba38b(0x1a7)](0x191)[_0x4ba38b(0x189)]({'error':_0x4ba38b(0x186)});_0x320c9c();};router[a27_0x9900da(0x1a9)](a27_0x9900da(0x1ba),verifyInternalApiKey,async(_0x5008f3,_0x574962)=>{const _0x36f1df=a27_0x9900da;try{const {id:_0x97767e}=_0x5008f3[_0x36f1df(0x1a1)];console[_0x36f1df(0x1b2)](_0x36f1df(0x1af)+_0x97767e+_0x36f1df(0x1bd));const _0x2f4fd4=await database_1[_0x36f1df(0x194)]['payment'][_0x36f1df(0x1b7)]({'where':{'id':_0x97767e},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x2f4fd4)return _0x574962[_0x36f1df(0x1a7)](0x194)[_0x36f1df(0x189)]({'error':'Payment\x20not\x20found'});console[_0x36f1df(0x1b2)](_0x36f1df(0x19a)+_0x2f4fd4['shop'][_0x36f1df(0x1c5)]),_0x574962[_0x36f1df(0x189)]({'id':_0x2f4fd4['id'],'amount':_0x2f4fd4[_0x36f1df(0x18e)],'currency':_0x2f4fd4['currency'],'status':_0x2f4fd4[_0x36f1df(0x1a7)],'orderId':_0x2f4fd4[_0x36f1df(0x1b4)],'shop':_0x2f4fd4[_0x36f1df(0x1bf)]});}catch(_0x42620b){console[_0x36f1df(0x199)]('Internal\x20API\x20error\x20getting\x20payment:',_0x42620b),_0x574962[_0x36f1df(0x1a7)](0x1f4)['json']({'error':_0x36f1df(0x192)});}}),router['patch'](a27_0x9900da(0x187),verifyInternalApiKey,async(_0x2ac9d7,_0x3dc40f)=>{const _0x427faa=a27_0x9900da;try{const {id:_0x4008ae}=_0x2ac9d7[_0x427faa(0x1a1)],_0x141cf1=_0x2ac9d7['body'];console['log'](_0x427faa(0x1ac)+_0x4008ae,_0x141cf1);const _0x307795=[_0x427faa(0x1a7),_0x427faa(0x1c2),_0x427faa(0x182),_0x427faa(0x197),'cardLast4',_0x427faa(0x198),_0x427faa(0x1c8),_0x427faa(0x1c3),_0x427faa(0x1bb),_0x427faa(0x1b0),_0x427faa(0x1a3)],_0x9c5799={};for(const [_0x432f65,_0x2564a5]of Object['entries'](_0x141cf1)){if(_0x307795[_0x427faa(0x196)](_0x432f65)){let _0x3cb4ab=_0x432f65;if(_0x432f65===_0x427faa(0x1c2)||_0x432f65==='gatewayPaymentId')_0x3cb4ab=_0x427faa(0x182);else{if(_0x432f65==='card_last4'||_0x432f65==='cardLast4')_0x3cb4ab=_0x427faa(0x1c1);else{if(_0x432f65===_0x427faa(0x198)||_0x432f65===_0x427faa(0x1c8))_0x3cb4ab=_0x427faa(0x1c8);else{if(_0x432f65===_0x427faa(0x1c3)||_0x432f65===_0x427faa(0x1bb))_0x3cb4ab='paidAt';else(_0x432f65===_0x427faa(0x1b0)||_0x432f65==='failureMessage')&&(_0x3cb4ab='failureMessage');}}}_0x3cb4ab==='paidAt'&&typeof _0x2564a5==='string'?_0x9c5799[_0x3cb4ab]=new Date(_0x2564a5):_0x9c5799[_0x3cb4ab]=_0x2564a5;}}if(Object[_0x427faa(0x1ca)](_0x9c5799)['length']===0x0)return _0x3dc40f[_0x427faa(0x1a7)](0x190)['json']({'error':'No\x20valid\x20fields\x20to\x20update'});const _0x331bfe=await database_1[_0x427faa(0x194)][_0x427faa(0x1c4)]['update']({'where':{'id':_0x4008ae},'data':_0x9c5799});console[_0x427faa(0x1b2)](_0x427faa(0x1b9)+_0x4008ae+'\x20updated\x20successfully');if(_0x9c5799[_0x427faa(0x1a7)]===_0x427faa(0x184)){console[_0x427faa(0x1b2)](_0x427faa(0x18b)+_0x4008ae+'\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing');try{const {WebhookService:_0x524747}=await Promise['resolve']()[_0x427faa(0x1a2)](()=>__importStar(require(_0x427faa(0x1c0)))),_0x341ac1=new _0x524747(),_0x1d2b4c=await database_1[_0x427faa(0x194)][_0x427faa(0x1c4)][_0x427faa(0x1b7)]({'where':{'id':_0x4008ae},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x1d2b4c&&console['log'](_0x427faa(0x19b)+_0x4008ae);}catch(_0x346c7d){console[_0x427faa(0x199)](_0x427faa(0x18f),_0x346c7d);}}_0x3dc40f[_0x427faa(0x189)]({'success':!![],'payment':{'id':_0x331bfe['id'],'status':_0x331bfe['status']}});}catch(_0x27c121){console[_0x427faa(0x199)]('Internal\x20API\x20error\x20updating\x20payment:',_0x27c121),_0x3dc40f[_0x427faa(0x1a7)](0x1f4)[_0x427faa(0x189)]({'error':_0x427faa(0x192)});}}),router[a27_0x9900da(0x1a9)](a27_0x9900da(0x1b6),(_0x569027,_0xc99660)=>{const _0x1894f6=a27_0x9900da;_0xc99660[_0x1894f6(0x189)]({'status':'ok','timestamp':new Date()[_0x1894f6(0x193)]()});}),exports[a27_0x9900da(0x194)]=router;