'use strict';const a26_0x1ae081=a26_0x225c;(function(_0x3dd8f7,_0x39d8ca){const _0x1d8758=a26_0x225c,_0x2dc0b1=_0x3dd8f7();while(!![]){try{const _0x6d0be0=-parseInt(_0x1d8758(0x1c0))/0x1*(-parseInt(_0x1d8758(0x196))/0x2)+-parseInt(_0x1d8758(0x199))/0x3+parseInt(_0x1d8758(0x1a9))/0x4+parseInt(_0x1d8758(0x1a5))/0x5+-parseInt(_0x1d8758(0x1bd))/0x6+-parseInt(_0x1d8758(0x18a))/0x7*(parseInt(_0x1d8758(0x18b))/0x8)+parseInt(_0x1d8758(0x1c5))/0x9;if(_0x6d0be0===_0x39d8ca)break;else _0x2dc0b1['push'](_0x2dc0b1['shift']());}catch(_0x1f9ac3){_0x2dc0b1['push'](_0x2dc0b1['shift']());}}}(a26_0x21a4,0x33042));var __createBinding=this&&this[a26_0x1ae081(0x1a0)]||(Object[a26_0x1ae081(0x18e)]?function(_0x312870,_0x4f308a,_0x171e1a,_0x123442){const _0x23b3a6=a26_0x1ae081;if(_0x123442===undefined)_0x123442=_0x171e1a;var _0x2cfaa3=Object[_0x23b3a6(0x1aa)](_0x4f308a,_0x171e1a);(!_0x2cfaa3||(_0x23b3a6(0x184)in _0x2cfaa3?!_0x4f308a[_0x23b3a6(0x187)]:_0x2cfaa3[_0x23b3a6(0x19f)]||_0x2cfaa3[_0x23b3a6(0x1a6)]))&&(_0x2cfaa3={'enumerable':!![],'get':function(){return _0x4f308a[_0x171e1a];}}),Object[_0x23b3a6(0x194)](_0x312870,_0x123442,_0x2cfaa3);}:function(_0x12b6af,_0x3940ee,_0x521358,_0x402764){if(_0x402764===undefined)_0x402764=_0x521358;_0x12b6af[_0x402764]=_0x3940ee[_0x521358];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a26_0x1ae081(0x18e)]?function(_0x992795,_0x5a9a03){const _0x315917=a26_0x1ae081;Object[_0x315917(0x194)](_0x992795,_0x315917(0x1ae),{'enumerable':!![],'value':_0x5a9a03});}:function(_0x112f4c,_0x1a937b){_0x112f4c['default']=_0x1a937b;}),__importStar=this&&this['__importStar']||(function(){var _0x145839=function(_0x5ef860){const _0x2b7466=a26_0x225c;return _0x145839=Object[_0x2b7466(0x183)]||function(_0x524dad){const _0x4f0b42=_0x2b7466;var _0x513838=[];for(var _0x2eed02 in _0x524dad)if(Object[_0x4f0b42(0x1c4)][_0x4f0b42(0x1af)]['call'](_0x524dad,_0x2eed02))_0x513838[_0x513838[_0x4f0b42(0x1bf)]]=_0x2eed02;return _0x513838;},_0x145839(_0x5ef860);};return function(_0x188aac){const _0x1b69c3=a26_0x225c;if(_0x188aac&&_0x188aac[_0x1b69c3(0x187)])return _0x188aac;var _0x5a0c59={};if(_0x188aac!=null){for(var _0x30f85a=_0x145839(_0x188aac),_0xe3b605=0x0;_0xe3b605<_0x30f85a[_0x1b69c3(0x1bf)];_0xe3b605++)if(_0x30f85a[_0xe3b605]!==_0x1b69c3(0x1ae))__createBinding(_0x5a0c59,_0x188aac,_0x30f85a[_0xe3b605]);}return __setModuleDefault(_0x5a0c59,_0x188aac),_0x5a0c59;};}()),__importDefault=this&&this[a26_0x1ae081(0x1c3)]||function(_0x2f09b6){const _0x17d751=a26_0x1ae081;return _0x2f09b6&&_0x2f09b6[_0x17d751(0x187)]?_0x2f09b6:{'default':_0x2f09b6};};function a26_0x21a4(){const _0x290723=['configurable','Missing\x20or\x20invalid\x20authorization\x20header','Internal\x20API\x20error\x20getting\x20payment:','224304kVNxWE','getOwnPropertyDescriptor','substring','Payment\x20not\x20found','Internal\x20server\x20error','default','hasOwnProperty','log','gatewayPaymentId','paid_at','authorization','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','\x20with\x20gateway\x20settings','failure_message','paymentMethod','✅\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','Router','body','No\x20valid\x20fields\x20to\x20update','Internal\x20API\x20error\x20updating\x20payment:','1472514tRDEYn','failureMessage','length','2831WkOPDY','status','Error\x20sending\x20webhook\x20notification:','__importDefault','prototype','3449466XNGaHE','payment','startsWith','/health','findUnique','paidAt','internal-api-key','username','update','payment_method','card_last4','✅\x20Internal\x20API:\x20Payment\x20','getOwnPropertyNames','get','../config/database','📤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','__esModule','amount','headers','7bNvwaY','1900664GAIpBK','shop','patch','create','🔄\x20Internal\x20API:\x20Updating\x20payment\x20','/payments/:id/update','cardLast4','params','error','defineProperty','json','124PCGTuc','currency','keys','676011bVjpZI','orderId','PAID','/payments/:id/gateway-settings','🎉\x20Payment\x20','string','writable','__createBinding','../services/webhookService','Bearer\x20','Invalid\x20internal\x20API\x20key','entries','1512145wbiXMB'];a26_0x21a4=function(){return _0x290723;};return a26_0x21a4();}Object[a26_0x1ae081(0x194)](exports,'__esModule',{'value':!![]});const express_1=require('express'),database_1=__importDefault(require(a26_0x1ae081(0x185))),router=(0x0,express_1[a26_0x1ae081(0x1b9)])(),verifyInternalApiKey=(_0x562739,_0x53b9a6,_0x410242)=>{const _0xef08fb=a26_0x1ae081,_0x53bfc6=_0x562739[_0xef08fb(0x189)][_0xef08fb(0x1b3)];if(!_0x53bfc6||!_0x53bfc6[_0xef08fb(0x179)](_0xef08fb(0x1a2)))return _0x53b9a6['status'](0x191)[_0xef08fb(0x195)]({'error':_0xef08fb(0x1a7)});const _0x56f044=_0x53bfc6[_0xef08fb(0x1ab)](0x7);if(_0x56f044!==_0xef08fb(0x17d))return _0x53b9a6[_0xef08fb(0x1c1)](0x191)[_0xef08fb(0x195)]({'error':_0xef08fb(0x1a3)});_0x410242();};function a26_0x225c(_0x200325,_0x38b6ca){const _0x21a42a=a26_0x21a4();return a26_0x225c=function(_0x225c83,_0x65ea2d){_0x225c83=_0x225c83-0x178;let _0x3e8e19=_0x21a42a[_0x225c83];return _0x3e8e19;},a26_0x225c(_0x200325,_0x38b6ca);}router[a26_0x1ae081(0x184)](a26_0x1ae081(0x19c),verifyInternalApiKey,async(_0x32371f,_0x184b6d)=>{const _0xbb4b28=a26_0x1ae081;try{const {id:_0xc761eb}=_0x32371f[_0xbb4b28(0x192)];console[_0xbb4b28(0x1b0)]('🔍\x20Internal\x20API:\x20Getting\x20payment\x20'+_0xc761eb+_0xbb4b28(0x1b5));const _0x52ab0c=await database_1['default'][_0xbb4b28(0x178)][_0xbb4b28(0x17b)]({'where':{'id':_0xc761eb},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x52ab0c)return _0x184b6d[_0xbb4b28(0x1c1)](0x194)['json']({'error':_0xbb4b28(0x1ac)});console[_0xbb4b28(0x1b0)](_0xbb4b28(0x1b8)+_0x52ab0c['shop'][_0xbb4b28(0x17e)]),_0x184b6d[_0xbb4b28(0x195)]({'id':_0x52ab0c['id'],'amount':_0x52ab0c[_0xbb4b28(0x188)],'currency':_0x52ab0c[_0xbb4b28(0x197)],'status':_0x52ab0c[_0xbb4b28(0x1c1)],'orderId':_0x52ab0c[_0xbb4b28(0x19a)],'shop':_0x52ab0c[_0xbb4b28(0x18c)]});}catch(_0xbafbe4){console[_0xbb4b28(0x193)](_0xbb4b28(0x1a8),_0xbafbe4),_0x184b6d[_0xbb4b28(0x1c1)](0x1f4)[_0xbb4b28(0x195)]({'error':_0xbb4b28(0x1ad)});}}),router[a26_0x1ae081(0x18d)](a26_0x1ae081(0x190),verifyInternalApiKey,async(_0x361bef,_0x296653)=>{const _0x5e467e=a26_0x1ae081;try{const {id:_0x164fb5}=_0x361bef[_0x5e467e(0x192)],_0x2f7e94=_0x361bef[_0x5e467e(0x1ba)];console[_0x5e467e(0x1b0)](_0x5e467e(0x18f)+_0x164fb5,_0x2f7e94);const _0x4078d8=[_0x5e467e(0x1c1),'gateway_payment_id','gatewayPaymentId',_0x5e467e(0x181),'cardLast4','payment_method','paymentMethod','paid_at',_0x5e467e(0x17c),_0x5e467e(0x1b6),_0x5e467e(0x1be)],_0x4966c1={};for(const [_0x3b1410,_0xbd8b9a]of Object[_0x5e467e(0x1a4)](_0x2f7e94)){if(_0x4078d8['includes'](_0x3b1410)){let _0x514bfb=_0x3b1410;if(_0x3b1410==='gateway_payment_id'||_0x3b1410===_0x5e467e(0x1b1))_0x514bfb=_0x5e467e(0x1b1);else{if(_0x3b1410==='card_last4'||_0x3b1410===_0x5e467e(0x191))_0x514bfb='cardLast4';else{if(_0x3b1410===_0x5e467e(0x180)||_0x3b1410===_0x5e467e(0x1b7))_0x514bfb='paymentMethod';else{if(_0x3b1410===_0x5e467e(0x1b2)||_0x3b1410===_0x5e467e(0x17c))_0x514bfb=_0x5e467e(0x17c);else(_0x3b1410===_0x5e467e(0x1b6)||_0x3b1410==='failureMessage')&&(_0x514bfb=_0x5e467e(0x1be));}}}_0x514bfb===_0x5e467e(0x17c)&&typeof _0xbd8b9a===_0x5e467e(0x19e)?_0x4966c1[_0x514bfb]=new Date(_0xbd8b9a):_0x4966c1[_0x514bfb]=_0xbd8b9a;}}if(Object[_0x5e467e(0x198)](_0x4966c1)[_0x5e467e(0x1bf)]===0x0)return _0x296653[_0x5e467e(0x1c1)](0x190)['json']({'error':_0x5e467e(0x1bb)});const _0x594668=await database_1[_0x5e467e(0x1ae)][_0x5e467e(0x178)][_0x5e467e(0x17f)]({'where':{'id':_0x164fb5},'data':_0x4966c1});console['log'](_0x5e467e(0x182)+_0x164fb5+'\x20updated\x20successfully');if(_0x4966c1[_0x5e467e(0x1c1)]===_0x5e467e(0x19b)){console[_0x5e467e(0x1b0)](_0x5e467e(0x19d)+_0x164fb5+_0x5e467e(0x1b4));try{const {WebhookService:_0x9c59be}=await Promise['resolve']()['then'](()=>__importStar(require(_0x5e467e(0x1a1)))),_0x237ad2=new _0x9c59be(),_0x3344b6=await database_1['default'][_0x5e467e(0x178)][_0x5e467e(0x17b)]({'where':{'id':_0x164fb5},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x3344b6&&console[_0x5e467e(0x1b0)](_0x5e467e(0x186)+_0x164fb5);}catch(_0x202068){console['error'](_0x5e467e(0x1c2),_0x202068);}}_0x296653['json']({'success':!![],'payment':{'id':_0x594668['id'],'status':_0x594668[_0x5e467e(0x1c1)]}});}catch(_0x411647){console[_0x5e467e(0x193)](_0x5e467e(0x1bc),_0x411647),_0x296653[_0x5e467e(0x1c1)](0x1f4)[_0x5e467e(0x195)]({'error':_0x5e467e(0x1ad)});}}),router[a26_0x1ae081(0x184)](a26_0x1ae081(0x17a),(_0x29302f,_0x1a027f)=>{const _0x41bde7=a26_0x1ae081;_0x1a027f[_0x41bde7(0x195)]({'status':'ok','timestamp':new Date()['toISOString']()});}),exports[a26_0x1ae081(0x1ae)]=router;