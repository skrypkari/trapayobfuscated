'use strict';const a32_0x3afb0a=a32_0x45b7;(function(_0x2739ca,_0x504a49){const _0x123e9b=a32_0x45b7,_0x563de0=_0x2739ca();while(!![]){try{const _0x355bb1=-parseInt(_0x123e9b(0x1f3))/0x1+-parseInt(_0x123e9b(0x228))/0x2+parseInt(_0x123e9b(0x213))/0x3*(-parseInt(_0x123e9b(0x1ef))/0x4)+-parseInt(_0x123e9b(0x1eb))/0x5*(-parseInt(_0x123e9b(0x202))/0x6)+-parseInt(_0x123e9b(0x1f4))/0x7+parseInt(_0x123e9b(0x1fd))/0x8*(-parseInt(_0x123e9b(0x215))/0x9)+parseInt(_0x123e9b(0x1f7))/0xa;if(_0x355bb1===_0x504a49)break;else _0x563de0['push'](_0x563de0['shift']());}catch(_0x1eb621){_0x563de0['push'](_0x563de0['shift']());}}}(a32_0x18e4,0x365d5));function a32_0x45b7(_0x366eaa,_0x47a052){_0x366eaa=_0x366eaa-0x1e7;const _0x18e4b7=a32_0x18e4();let _0x45b7b9=_0x18e4b7[_0x366eaa];return _0x45b7b9;}var __createBinding=this&&this[a32_0x3afb0a(0x1f6)]||(Object['create']?function(_0x344925,_0x5882d4,_0x31e9e0,_0x3c15d4){const _0x3e744d=a32_0x3afb0a;if(_0x3c15d4===undefined)_0x3c15d4=_0x31e9e0;var _0x4e3ba9=Object[_0x3e744d(0x201)](_0x5882d4,_0x31e9e0);(!_0x4e3ba9||(_0x3e744d(0x1e8)in _0x4e3ba9?!_0x5882d4[_0x3e744d(0x21a)]:_0x4e3ba9[_0x3e744d(0x214)]||_0x4e3ba9[_0x3e744d(0x21c)]))&&(_0x4e3ba9={'enumerable':!![],'get':function(){return _0x5882d4[_0x31e9e0];}}),Object[_0x3e744d(0x226)](_0x344925,_0x3c15d4,_0x4e3ba9);}:function(_0x5a80e0,_0x54cbe3,_0x49b9a1,_0x430fe8){if(_0x430fe8===undefined)_0x430fe8=_0x49b9a1;_0x5a80e0[_0x430fe8]=_0x54cbe3[_0x49b9a1];}),__setModuleDefault=this&&this[a32_0x3afb0a(0x224)]||(Object[a32_0x3afb0a(0x206)]?function(_0x7e397,_0xa857de){const _0x20e9a7=a32_0x3afb0a;Object[_0x20e9a7(0x226)](_0x7e397,_0x20e9a7(0x21b),{'enumerable':!![],'value':_0xa857de});}:function(_0x38c2c9,_0x5e304b){const _0x5e0daa=a32_0x3afb0a;_0x38c2c9[_0x5e0daa(0x21b)]=_0x5e304b;}),__importStar=this&&this[a32_0x3afb0a(0x225)]||(function(){var _0x1213d6=function(_0x21f7f8){return _0x1213d6=Object['getOwnPropertyNames']||function(_0x400899){const _0xf842c=a32_0x45b7;var _0x2896aa=[];for(var _0x480b61 in _0x400899)if(Object['prototype']['hasOwnProperty'][_0xf842c(0x1ea)](_0x400899,_0x480b61))_0x2896aa[_0x2896aa[_0xf842c(0x1ff)]]=_0x480b61;return _0x2896aa;},_0x1213d6(_0x21f7f8);};return function(_0x5cc1ba){const _0x2fa2d5=a32_0x45b7;if(_0x5cc1ba&&_0x5cc1ba[_0x2fa2d5(0x21a)])return _0x5cc1ba;var _0x21c26f={};if(_0x5cc1ba!=null){for(var _0x430f78=_0x1213d6(_0x5cc1ba),_0x353e73=0x0;_0x353e73<_0x430f78[_0x2fa2d5(0x1ff)];_0x353e73++)if(_0x430f78[_0x353e73]!=='default')__createBinding(_0x21c26f,_0x5cc1ba,_0x430f78[_0x353e73]);}return __setModuleDefault(_0x21c26f,_0x5cc1ba),_0x21c26f;};}()),__importDefault=this&&this['__importDefault']||function(_0x7639d8){const _0x4f21ed=a32_0x3afb0a;return _0x7639d8&&_0x7639d8[_0x4f21ed(0x21a)]?_0x7639d8:{'default':_0x7639d8};};Object[a32_0x3afb0a(0x226)](exports,a32_0x3afb0a(0x21a),{'value':!![]});const express_1=require('express'),database_1=__importDefault(require(a32_0x3afb0a(0x208))),router=(0x0,express_1['Router'])(),verifyInternalApiKey=(_0x1a3dd7,_0x4d9721,_0x3bb8f7)=>{const _0x5567d6=a32_0x3afb0a,_0xe0a642=_0x1a3dd7[_0x5567d6(0x218)][_0x5567d6(0x1f8)];if(!_0xe0a642||!_0xe0a642[_0x5567d6(0x1f2)](_0x5567d6(0x227)))return _0x4d9721[_0x5567d6(0x20a)](0x191)['json']({'error':_0x5567d6(0x1f5)});const _0x3fb899=_0xe0a642[_0x5567d6(0x22b)](0x7);if(_0x3fb899!==_0x5567d6(0x1fc))return _0x4d9721[_0x5567d6(0x20a)](0x191)[_0x5567d6(0x205)]({'error':_0x5567d6(0x1f0)});_0x3bb8f7();};router[a32_0x3afb0a(0x1e8)]('/payments/:id/gateway-settings',verifyInternalApiKey,async(_0x162ab8,_0x2e0d9d)=>{const _0x5b5143=a32_0x3afb0a;try{const {id:_0x2726e6}=_0x162ab8['params'];console[_0x5b5143(0x1f1)]('ðŸ”\x20Internal\x20API:\x20Getting\x20payment\x20'+_0x2726e6+'\x20with\x20gateway\x20settings');const _0x1e4021=await database_1[_0x5b5143(0x21b)][_0x5b5143(0x212)][_0x5b5143(0x1fa)]({'where':{'id':_0x2726e6},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x1e4021)return _0x2e0d9d[_0x5b5143(0x20a)](0x194)[_0x5b5143(0x205)]({'error':_0x5b5143(0x1ee)});console[_0x5b5143(0x1f1)](_0x5b5143(0x1e9)+_0x1e4021['shop'][_0x5b5143(0x1ed)]),_0x2e0d9d['json']({'id':_0x1e4021['id'],'amount':_0x1e4021[_0x5b5143(0x1ec)],'currency':_0x1e4021[_0x5b5143(0x210)],'status':_0x1e4021[_0x5b5143(0x20a)],'orderId':_0x1e4021['orderId'],'shop':_0x1e4021['shop']});}catch(_0x1b4990){console[_0x5b5143(0x21f)](_0x5b5143(0x200),_0x1b4990),_0x2e0d9d[_0x5b5143(0x20a)](0x1f4)['json']({'error':_0x5b5143(0x1f9)});}}),router['patch'](a32_0x3afb0a(0x21e),verifyInternalApiKey,async(_0x32827a,_0x4335ef)=>{const _0x4ce38f=a32_0x3afb0a;try{const {id:_0x501e68}=_0x32827a[_0x4ce38f(0x221)],_0x56f3ee=_0x32827a[_0x4ce38f(0x20e)];console['log']('ðŸ”„\x20Internal\x20API:\x20Updating\x20payment\x20'+_0x501e68,_0x56f3ee);const _0x2ac262=['status',_0x4ce38f(0x223),_0x4ce38f(0x20c),_0x4ce38f(0x217),_0x4ce38f(0x1fb),'payment_method',_0x4ce38f(0x1e7),_0x4ce38f(0x20b),'paidAt',_0x4ce38f(0x220),'failureMessage'],_0x4099b9={};for(const [_0x45f09c,_0x2c2874]of Object[_0x4ce38f(0x216)](_0x56f3ee)){if(_0x2ac262[_0x4ce38f(0x229)](_0x45f09c)){let _0x1d42c2=_0x45f09c;if(_0x45f09c===_0x4ce38f(0x223)||_0x45f09c===_0x4ce38f(0x20c))_0x1d42c2='gatewayPaymentId';else{if(_0x45f09c==='card_last4'||_0x45f09c===_0x4ce38f(0x1fb))_0x1d42c2=_0x4ce38f(0x1fb);else{if(_0x45f09c===_0x4ce38f(0x203)||_0x45f09c===_0x4ce38f(0x1e7))_0x1d42c2=_0x4ce38f(0x1e7);else{if(_0x45f09c===_0x4ce38f(0x20b)||_0x45f09c===_0x4ce38f(0x21d))_0x1d42c2=_0x4ce38f(0x21d);else(_0x45f09c==='failure_message'||_0x45f09c===_0x4ce38f(0x20f))&&(_0x1d42c2='failureMessage');}}}_0x1d42c2==='paidAt'&&typeof _0x2c2874===_0x4ce38f(0x22c)?_0x4099b9[_0x1d42c2]=new Date(_0x2c2874):_0x4099b9[_0x1d42c2]=_0x2c2874;}}if(Object[_0x4ce38f(0x209)](_0x4099b9)[_0x4ce38f(0x1ff)]===0x0)return _0x4335ef[_0x4ce38f(0x20a)](0x190)[_0x4ce38f(0x205)]({'error':'No\x20valid\x20fields\x20to\x20update'});const _0x5e9b26=await database_1[_0x4ce38f(0x21b)][_0x4ce38f(0x212)][_0x4ce38f(0x207)]({'where':{'id':_0x501e68},'data':_0x4099b9});console[_0x4ce38f(0x1f1)](_0x4ce38f(0x211)+_0x501e68+_0x4ce38f(0x20d));if(_0x4099b9[_0x4ce38f(0x20a)]==='PAID'){console[_0x4ce38f(0x1f1)]('ðŸŽ‰\x20Payment\x20'+_0x501e68+'\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing');try{const {WebhookService:_0x2e65d2}=await Promise[_0x4ce38f(0x204)]()[_0x4ce38f(0x22a)](()=>__importStar(require('../services/webhookService'))),_0x212772=new _0x2e65d2(),_0x2f8dbe=await database_1['default'][_0x4ce38f(0x212)]['findUnique']({'where':{'id':_0x501e68},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x2f8dbe&&console['log'](_0x4ce38f(0x219)+_0x501e68);}catch(_0x587d13){console[_0x4ce38f(0x21f)](_0x4ce38f(0x22d),_0x587d13);}}_0x4335ef['json']({'success':!![],'payment':{'id':_0x5e9b26['id'],'status':_0x5e9b26['status']}});}catch(_0xd471dd){console[_0x4ce38f(0x21f)](_0x4ce38f(0x222),_0xd471dd),_0x4335ef[_0x4ce38f(0x20a)](0x1f4)[_0x4ce38f(0x205)]({'error':_0x4ce38f(0x1f9)});}}),router[a32_0x3afb0a(0x1e8)](a32_0x3afb0a(0x1fe),(_0x4faead,_0x58987c)=>{const _0x41d5f4=a32_0x3afb0a;_0x58987c[_0x41d5f4(0x205)]({'status':'ok','timestamp':new Date()['toISOString']()});}),exports['default']=router;function a32_0x18e4(){const _0x9061a8=['payment_method','resolve','json','create','update','../config/database','keys','status','paid_at','gatewayPaymentId','\x20updated\x20successfully','body','failureMessage','currency','âœ…\x20Internal\x20API:\x20Payment\x20','payment','204825SWdIIi','writable','9oolVNb','entries','card_last4','headers','ðŸ“¤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','__esModule','default','configurable','paidAt','/payments/:id/update','error','failure_message','params','Internal\x20API\x20error\x20updating\x20payment:','gateway_payment_id','__setModuleDefault','__importStar','defineProperty','Bearer\x20','679586MXRUfG','includes','then','substring','string','Error\x20sending\x20webhook\x20notification:','paymentMethod','get','âœ…\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','call','145qRGbfl','amount','username','Payment\x20not\x20found','20GUNWdF','Invalid\x20internal\x20API\x20key','log','startsWith','332282hbswrt','811993ZCZYZy','Missing\x20or\x20invalid\x20authorization\x20header','__createBinding','15496650NxxcDt','authorization','Internal\x20server\x20error','findUnique','cardLast4','internal-api-key','3410328WHwCmj','/health','length','Internal\x20API\x20error\x20getting\x20payment:','getOwnPropertyDescriptor','47328aunqVY'];a32_0x18e4=function(){return _0x9061a8;};return a32_0x18e4();}