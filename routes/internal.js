'use strict';const a30_0x297c51=a30_0x24c0;(function(_0x2a1127,_0x7d09da){const _0x4ceece=a30_0x24c0,_0x3c5b69=_0x2a1127();while(!![]){try{const _0x3fe638=parseInt(_0x4ceece(0x126))/0x1*(-parseInt(_0x4ceece(0x141))/0x2)+parseInt(_0x4ceece(0x12b))/0x3+parseInt(_0x4ceece(0x118))/0x4*(parseInt(_0x4ceece(0x15d))/0x5)+parseInt(_0x4ceece(0x12a))/0x6*(parseInt(_0x4ceece(0x143))/0x7)+parseInt(_0x4ceece(0x119))/0x8+-parseInt(_0x4ceece(0x135))/0x9*(parseInt(_0x4ceece(0x12c))/0xa)+-parseInt(_0x4ceece(0x149))/0xb;if(_0x3fe638===_0x7d09da)break;else _0x3c5b69['push'](_0x3c5b69['shift']());}catch(_0x5155ec){_0x3c5b69['push'](_0x3c5b69['shift']());}}}(a30_0x3fbb,0xd0529));function a30_0x3fbb(){const _0x2b0a87=['37924efLLnV','3856536lQewPw','default','paidAt','log','paymentMethod','\x20with\x20gateway\x20settings','payment_method','entries','Router','resolve','defineProperty','__importDefault','amount','4KTsHPp','Missing\x20or\x20invalid\x20authorization\x20header','update','express','4428HCJctX','1112199vJuFdh','16504370XcCnYt','payment','internal-api-key','create','body','cardLast4','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20','gatewayPaymentId','call','9hGXAsP','string','Internal\x20API\x20error\x20updating\x20payment:','__esModule','username','Internal\x20API\x20error\x20getting\x20payment:','Internal\x20server\x20error','get','üéâ\x20Payment\x20','failure_message','/payments/:id/update','length','456368uNhjno','findUnique','9961fvpQfB','shop','failureMessage','../services/webhookService','../config/database','json','1185393PLdyLh','configurable','gateway_payment_id','params','hasOwnProperty','includes','Invalid\x20internal\x20API\x20key','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','keys','patch','card_last4','\x20updated\x20successfully','__setModuleDefault','paid_at','error','getOwnPropertyNames','No\x20valid\x20fields\x20to\x20update','authorization','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','855LmmtjF','substring','status'];a30_0x3fbb=function(){return _0x2b0a87;};return a30_0x3fbb();}function a30_0x24c0(_0x4a623b,_0x56cb05){_0x4a623b=_0x4a623b-0x116;const _0x3fbb40=a30_0x3fbb();let _0x24c006=_0x3fbb40[_0x4a623b];return _0x24c006;}var __createBinding=this&&this['__createBinding']||(Object[a30_0x297c51(0x12f)]?function(_0x1c420b,_0x58eda5,_0x2fbafd,_0x30ecc1){const _0x261a04=a30_0x297c51;if(_0x30ecc1===undefined)_0x30ecc1=_0x2fbafd;var _0x5d3fb4=Object['getOwnPropertyDescriptor'](_0x58eda5,_0x2fbafd);(!_0x5d3fb4||(_0x261a04(0x13c)in _0x5d3fb4?!_0x58eda5[_0x261a04(0x138)]:_0x5d3fb4['writable']||_0x5d3fb4[_0x261a04(0x14a)]))&&(_0x5d3fb4={'enumerable':!![],'get':function(){return _0x58eda5[_0x2fbafd];}}),Object[_0x261a04(0x123)](_0x1c420b,_0x30ecc1,_0x5d3fb4);}:function(_0x5621d2,_0x56e6e3,_0x2344fe,_0x5a9345){if(_0x5a9345===undefined)_0x5a9345=_0x2344fe;_0x5621d2[_0x5a9345]=_0x56e6e3[_0x2344fe];}),__setModuleDefault=this&&this[a30_0x297c51(0x155)]||(Object[a30_0x297c51(0x12f)]?function(_0x40e15e,_0x5d2c06){const _0x4609a2=a30_0x297c51;Object['defineProperty'](_0x40e15e,_0x4609a2(0x11a),{'enumerable':!![],'value':_0x5d2c06});}:function(_0xab7121,_0x293324){const _0x5c2860=a30_0x297c51;_0xab7121[_0x5c2860(0x11a)]=_0x293324;}),__importStar=this&&this['__importStar']||(function(){var _0x45e490=function(_0x5a585f){const _0x26626e=a30_0x24c0;return _0x45e490=Object[_0x26626e(0x158)]||function(_0x39599b){const _0x5a06fb=_0x26626e;var _0x1ba81d=[];for(var _0x3c1cba in _0x39599b)if(Object['prototype'][_0x5a06fb(0x14d)][_0x5a06fb(0x134)](_0x39599b,_0x3c1cba))_0x1ba81d[_0x1ba81d[_0x5a06fb(0x140)]]=_0x3c1cba;return _0x1ba81d;},_0x45e490(_0x5a585f);};return function(_0x5e9cef){const _0x4a969e=a30_0x24c0;if(_0x5e9cef&&_0x5e9cef[_0x4a969e(0x138)])return _0x5e9cef;var _0x33d7e7={};if(_0x5e9cef!=null){for(var _0x132398=_0x45e490(_0x5e9cef),_0x2b1102=0x0;_0x2b1102<_0x132398[_0x4a969e(0x140)];_0x2b1102++)if(_0x132398[_0x2b1102]!==_0x4a969e(0x11a))__createBinding(_0x33d7e7,_0x5e9cef,_0x132398[_0x2b1102]);}return __setModuleDefault(_0x33d7e7,_0x5e9cef),_0x33d7e7;};}()),__importDefault=this&&this[a30_0x297c51(0x124)]||function(_0x5034ea){const _0xde4d38=a30_0x297c51;return _0x5034ea&&_0x5034ea[_0xde4d38(0x138)]?_0x5034ea:{'default':_0x5034ea};};Object['defineProperty'](exports,a30_0x297c51(0x138),{'value':!![]});const express_1=require(a30_0x297c51(0x129)),database_1=__importDefault(require(a30_0x297c51(0x147))),router=(0x0,express_1[a30_0x297c51(0x121)])(),verifyInternalApiKey=(_0xab87,_0x418f5b,_0x32ca6b)=>{const _0x643554=a30_0x297c51,_0x26547f=_0xab87['headers'][_0x643554(0x15a)];if(!_0x26547f||!_0x26547f['startsWith']('Bearer\x20'))return _0x418f5b['status'](0x191)['json']({'error':_0x643554(0x127)});const _0x127a4f=_0x26547f[_0x643554(0x116)](0x7);if(_0x127a4f!==_0x643554(0x12e))return _0x418f5b[_0x643554(0x117)](0x191)[_0x643554(0x148)]({'error':_0x643554(0x14f)});_0x32ca6b();};router[a30_0x297c51(0x13c)]('/payments/:id/gateway-settings',verifyInternalApiKey,async(_0x190c3d,_0x1eb60d)=>{const _0x2ef1b9=a30_0x297c51;try{const {id:_0x30e4b5}=_0x190c3d[_0x2ef1b9(0x14c)];console[_0x2ef1b9(0x11c)](_0x2ef1b9(0x15b)+_0x30e4b5+_0x2ef1b9(0x11e));const _0x307db7=await database_1[_0x2ef1b9(0x11a)][_0x2ef1b9(0x12d)][_0x2ef1b9(0x142)]({'where':{'id':_0x30e4b5},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x307db7)return _0x1eb60d['status'](0x194)[_0x2ef1b9(0x148)]({'error':'Payment\x20not\x20found'});console['log'](_0x2ef1b9(0x150)+_0x307db7[_0x2ef1b9(0x144)][_0x2ef1b9(0x139)]),_0x1eb60d[_0x2ef1b9(0x148)]({'id':_0x307db7['id'],'amount':_0x307db7[_0x2ef1b9(0x125)],'currency':_0x307db7['currency'],'status':_0x307db7['status'],'orderId':_0x307db7['orderId'],'shop':_0x307db7['shop']});}catch(_0x5e8812){console[_0x2ef1b9(0x157)](_0x2ef1b9(0x13a),_0x5e8812),_0x1eb60d[_0x2ef1b9(0x117)](0x1f4)[_0x2ef1b9(0x148)]({'error':'Internal\x20server\x20error'});}}),router[a30_0x297c51(0x152)](a30_0x297c51(0x13f),verifyInternalApiKey,async(_0x38e3e3,_0x5f4591)=>{const _0x299bab=a30_0x297c51;try{const {id:_0x44afcb}=_0x38e3e3[_0x299bab(0x14c)],_0x280ca0=_0x38e3e3[_0x299bab(0x130)];console[_0x299bab(0x11c)](_0x299bab(0x132)+_0x44afcb,_0x280ca0);const _0x3af527=[_0x299bab(0x117),_0x299bab(0x14b),_0x299bab(0x133),'card_last4',_0x299bab(0x131),_0x299bab(0x11f),'paymentMethod',_0x299bab(0x156),'paidAt',_0x299bab(0x13e),_0x299bab(0x145)],_0x2916b0={};for(const [_0x581949,_0x5b5e66]of Object[_0x299bab(0x120)](_0x280ca0)){if(_0x3af527[_0x299bab(0x14e)](_0x581949)){let _0x11f3e8=_0x581949;if(_0x581949==='gateway_payment_id'||_0x581949===_0x299bab(0x133))_0x11f3e8=_0x299bab(0x133);else{if(_0x581949===_0x299bab(0x153)||_0x581949===_0x299bab(0x131))_0x11f3e8=_0x299bab(0x131);else{if(_0x581949===_0x299bab(0x11f)||_0x581949===_0x299bab(0x11d))_0x11f3e8=_0x299bab(0x11d);else{if(_0x581949==='paid_at'||_0x581949===_0x299bab(0x11b))_0x11f3e8=_0x299bab(0x11b);else(_0x581949===_0x299bab(0x13e)||_0x581949===_0x299bab(0x145))&&(_0x11f3e8=_0x299bab(0x145));}}}_0x11f3e8===_0x299bab(0x11b)&&typeof _0x5b5e66===_0x299bab(0x136)?_0x2916b0[_0x11f3e8]=new Date(_0x5b5e66):_0x2916b0[_0x11f3e8]=_0x5b5e66;}}if(Object[_0x299bab(0x151)](_0x2916b0)['length']===0x0)return _0x5f4591[_0x299bab(0x117)](0x190)[_0x299bab(0x148)]({'error':_0x299bab(0x159)});const _0x1ddd8b=await database_1[_0x299bab(0x11a)]['payment'][_0x299bab(0x128)]({'where':{'id':_0x44afcb},'data':_0x2916b0});console[_0x299bab(0x11c)]('‚úÖ\x20Internal\x20API:\x20Payment\x20'+_0x44afcb+_0x299bab(0x154));if(_0x2916b0[_0x299bab(0x117)]==='PAID'){console[_0x299bab(0x11c)](_0x299bab(0x13d)+_0x44afcb+'\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing');try{const {WebhookService:_0x55afb0}=await Promise[_0x299bab(0x122)]()['then'](()=>__importStar(require(_0x299bab(0x146)))),_0x5b6352=new _0x55afb0(),_0x403b73=await database_1[_0x299bab(0x11a)][_0x299bab(0x12d)][_0x299bab(0x142)]({'where':{'id':_0x44afcb},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x403b73&&console[_0x299bab(0x11c)](_0x299bab(0x15c)+_0x44afcb);}catch(_0xf7a8ea){console[_0x299bab(0x157)]('Error\x20sending\x20webhook\x20notification:',_0xf7a8ea);}}_0x5f4591['json']({'success':!![],'payment':{'id':_0x1ddd8b['id'],'status':_0x1ddd8b[_0x299bab(0x117)]}});}catch(_0x66be19){console[_0x299bab(0x157)](_0x299bab(0x137),_0x66be19),_0x5f4591[_0x299bab(0x117)](0x1f4)[_0x299bab(0x148)]({'error':_0x299bab(0x13b)});}}),router[a30_0x297c51(0x13c)]('/health',(_0x44688d,_0x2a0ce5)=>{_0x2a0ce5['json']({'status':'ok','timestamp':new Date()['toISOString']()});}),exports[a30_0x297c51(0x11a)]=router;