'use strict';const a25_0x3b59a4=a25_0x486b;(function(_0x442f0b,_0x12c1b3){const _0x4f0abf=a25_0x486b,_0x49c858=_0x442f0b();while(!![]){try{const _0x580791=-parseInt(_0x4f0abf(0xe0))/0x1+-parseInt(_0x4f0abf(0xf1))/0x2*(parseInt(_0x4f0abf(0xdb))/0x3)+-parseInt(_0x4f0abf(0xd8))/0x4*(-parseInt(_0x4f0abf(0xe5))/0x5)+parseInt(_0x4f0abf(0xda))/0x6*(-parseInt(_0x4f0abf(0xeb))/0x7)+parseInt(_0x4f0abf(0x108))/0x8+-parseInt(_0x4f0abf(0xd0))/0x9+parseInt(_0x4f0abf(0x10c))/0xa*(parseInt(_0x4f0abf(0xd6))/0xb);if(_0x580791===_0x12c1b3)break;else _0x49c858['push'](_0x49c858['shift']());}catch(_0x4367b7){_0x49c858['push'](_0x49c858['shift']());}}}(a25_0x47d3,0xd2902));function a25_0x486b(_0x51dbfc,_0x1683a6){const _0x47d3b2=a25_0x47d3();return a25_0x486b=function(_0x486b20,_0x4e6a17){_0x486b20=_0x486b20-0xc6;let _0x306124=_0x47d3b2[_0x486b20];return _0x306124;},a25_0x486b(_0x51dbfc,_0x1683a6);}var __createBinding=this&&this[a25_0x3b59a4(0xd1)]||(Object['create']?function(_0x42d5b7,_0x44a332,_0x212eb7,_0x298d25){const _0x17b18b=a25_0x3b59a4;if(_0x298d25===undefined)_0x298d25=_0x212eb7;var _0xba1434=Object['getOwnPropertyDescriptor'](_0x44a332,_0x212eb7);(!_0xba1434||('get'in _0xba1434?!_0x44a332[_0x17b18b(0xde)]:_0xba1434[_0x17b18b(0xea)]||_0xba1434[_0x17b18b(0xd3)]))&&(_0xba1434={'enumerable':!![],'get':function(){return _0x44a332[_0x212eb7];}}),Object['defineProperty'](_0x42d5b7,_0x298d25,_0xba1434);}:function(_0x3d3063,_0x1b0578,_0x58943a,_0x3da7d4){if(_0x3da7d4===undefined)_0x3da7d4=_0x58943a;_0x3d3063[_0x3da7d4]=_0x1b0578[_0x58943a];}),__setModuleDefault=this&&this[a25_0x3b59a4(0xed)]||(Object[a25_0x3b59a4(0xca)]?function(_0x57bd56,_0x2be3c7){const _0x22f65a=a25_0x3b59a4;Object[_0x22f65a(0xcf)](_0x57bd56,'default',{'enumerable':!![],'value':_0x2be3c7});}:function(_0x4015cd,_0x148555){_0x4015cd['default']=_0x148555;}),__importStar=this&&this[a25_0x3b59a4(0xc8)]||(function(){var _0x3a8a57=function(_0x4ad3c6){const _0x281166=a25_0x486b;return _0x3a8a57=Object[_0x281166(0xce)]||function(_0x51aef1){const _0x5d6b55=_0x281166;var _0x14b3b4=[];for(var _0x1874e7 in _0x51aef1)if(Object[_0x5d6b55(0xc9)][_0x5d6b55(0xf7)]['call'](_0x51aef1,_0x1874e7))_0x14b3b4[_0x14b3b4['length']]=_0x1874e7;return _0x14b3b4;},_0x3a8a57(_0x4ad3c6);};return function(_0xc5a277){const _0xc765c=a25_0x486b;if(_0xc5a277&&_0xc5a277[_0xc765c(0xde)])return _0xc5a277;var _0x243369={};if(_0xc5a277!=null){for(var _0x1974c0=_0x3a8a57(_0xc5a277),_0x7b3989=0x0;_0x7b3989<_0x1974c0[_0xc765c(0xfe)];_0x7b3989++)if(_0x1974c0[_0x7b3989]!==_0xc765c(0xe4))__createBinding(_0x243369,_0xc5a277,_0x1974c0[_0x7b3989]);}return __setModuleDefault(_0x243369,_0xc5a277),_0x243369;};}()),__importDefault=this&&this[a25_0x3b59a4(0xf6)]||function(_0x5b394a){const _0x57b01b=a25_0x3b59a4;return _0x5b394a&&_0x5b394a[_0x57b01b(0xde)]?_0x5b394a:{'default':_0x5b394a};};Object[a25_0x3b59a4(0xcf)](exports,a25_0x3b59a4(0xde),{'value':!![]});const express_1=require(a25_0x3b59a4(0xf3)),database_1=__importDefault(require(a25_0x3b59a4(0xd4))),router=(0x0,express_1[a25_0x3b59a4(0xf0)])(),verifyInternalApiKey=(_0x3f4de1,_0x3ffe04,_0x21c845)=>{const _0x238df8=a25_0x3b59a4,_0x132e2a=_0x3f4de1['headers']['authorization'];if(!_0x132e2a||!_0x132e2a[_0x238df8(0x10a)](_0x238df8(0x10f)))return _0x3ffe04['status'](0x191)[_0x238df8(0xfd)]({'error':'Missing\x20or\x20invalid\x20authorization\x20header'});const _0x2f704d=_0x132e2a[_0x238df8(0xfb)](0x7);if(_0x2f704d!==_0x238df8(0x102))return _0x3ffe04[_0x238df8(0xe6)](0x191)[_0x238df8(0xfd)]({'error':'Invalid\x20internal\x20API\x20key'});_0x21c845();};function a25_0x47d3(){const _0x4dfea8=['✅\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','🔄\x20Internal\x20API:\x20Updating\x20payment\x20','__esModule','paidAt','672305RjqNBu','PAID','update','Error\x20sending\x20webhook\x20notification:','default','4026570KkHUSp','status','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','Internal\x20API\x20error\x20updating\x20payment:','card_last4','writable','8527169LruLWh','Payment\x20not\x20found','__setModuleDefault','No\x20valid\x20fields\x20to\x20update','failureMessage','Router','2YnGrgp','gateway_payment_id','express','paid_at','Internal\x20API\x20error\x20getting\x20payment:','__importDefault','hasOwnProperty','toISOString','\x20updated\x20successfully','includes','substring','\x20with\x20gateway\x20settings','json','length','cardLast4','findUnique','payment','internal-api-key','/payments/:id/update','paymentMethod','🔍\x20Internal\x20API:\x20Getting\x20payment\x20','Internal\x20server\x20error','📤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','8744032vsgZpV','then','startsWith','amount','920nuafpV','shop','params','Bearer\x20','log','✅\x20Internal\x20API:\x20Payment\x20','resolve','username','orderId','payment_method','failure_message','__importStar','prototype','create','error','/payments/:id/gateway-settings','get','getOwnPropertyNames','defineProperty','9811539aqaoaF','__createBinding','patch','configurable','../config/database','🎉\x20Payment\x20','311487KjHQKX','string','8GMOAkJ','gatewayPaymentId','6TvPMjq','4397061mwYDTx'];a25_0x47d3=function(){return _0x4dfea8;};return a25_0x47d3();}router[a25_0x3b59a4(0xcd)](a25_0x3b59a4(0xcc),verifyInternalApiKey,async(_0x34f2aa,_0x5ccf8f)=>{const _0x34758c=a25_0x3b59a4;try{const {id:_0x517b1e}=_0x34f2aa[_0x34758c(0x10e)];console[_0x34758c(0x110)](_0x34758c(0x105)+_0x517b1e+_0x34758c(0xfc));const _0x256a81=await database_1[_0x34758c(0xe4)][_0x34758c(0x101)][_0x34758c(0x100)]({'where':{'id':_0x517b1e},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x256a81)return _0x5ccf8f[_0x34758c(0xe6)](0x194)[_0x34758c(0xfd)]({'error':_0x34758c(0xec)});console[_0x34758c(0x110)](_0x34758c(0xdc)+_0x256a81[_0x34758c(0x10d)][_0x34758c(0x113)]),_0x5ccf8f[_0x34758c(0xfd)]({'id':_0x256a81['id'],'amount':_0x256a81[_0x34758c(0x10b)],'currency':_0x256a81['currency'],'status':_0x256a81[_0x34758c(0xe6)],'orderId':_0x256a81[_0x34758c(0x114)],'shop':_0x256a81[_0x34758c(0x10d)]});}catch(_0x561ccf){console[_0x34758c(0xcb)](_0x34758c(0xf5),_0x561ccf),_0x5ccf8f[_0x34758c(0xe6)](0x1f4)[_0x34758c(0xfd)]({'error':_0x34758c(0x106)});}}),router[a25_0x3b59a4(0xd2)](a25_0x3b59a4(0x103),verifyInternalApiKey,async(_0x1a6036,_0x480d21)=>{const _0x5f0288=a25_0x3b59a4;try{const {id:_0x936d60}=_0x1a6036[_0x5f0288(0x10e)],_0x501d2b=_0x1a6036['body'];console['log'](_0x5f0288(0xdd)+_0x936d60,_0x501d2b);const _0x186a9d=[_0x5f0288(0xe6),_0x5f0288(0xf2),_0x5f0288(0xd9),_0x5f0288(0xe9),_0x5f0288(0xff),_0x5f0288(0xc6),_0x5f0288(0x104),_0x5f0288(0xf4),'paidAt',_0x5f0288(0xc7),_0x5f0288(0xef)],_0x13916e={};for(const [_0x3bf5e0,_0x559c68]of Object['entries'](_0x501d2b)){if(_0x186a9d[_0x5f0288(0xfa)](_0x3bf5e0)){let _0x4800ff=_0x3bf5e0;if(_0x3bf5e0==='gateway_payment_id'||_0x3bf5e0===_0x5f0288(0xd9))_0x4800ff='gatewayPaymentId';else{if(_0x3bf5e0===_0x5f0288(0xe9)||_0x3bf5e0===_0x5f0288(0xff))_0x4800ff=_0x5f0288(0xff);else{if(_0x3bf5e0===_0x5f0288(0xc6)||_0x3bf5e0===_0x5f0288(0x104))_0x4800ff=_0x5f0288(0x104);else{if(_0x3bf5e0===_0x5f0288(0xf4)||_0x3bf5e0===_0x5f0288(0xdf))_0x4800ff=_0x5f0288(0xdf);else(_0x3bf5e0===_0x5f0288(0xc7)||_0x3bf5e0===_0x5f0288(0xef))&&(_0x4800ff=_0x5f0288(0xef));}}}_0x4800ff===_0x5f0288(0xdf)&&typeof _0x559c68===_0x5f0288(0xd7)?_0x13916e[_0x4800ff]=new Date(_0x559c68):_0x13916e[_0x4800ff]=_0x559c68;}}if(Object['keys'](_0x13916e)[_0x5f0288(0xfe)]===0x0)return _0x480d21[_0x5f0288(0xe6)](0x190)[_0x5f0288(0xfd)]({'error':_0x5f0288(0xee)});const _0x129ac1=await database_1['default']['payment'][_0x5f0288(0xe2)]({'where':{'id':_0x936d60},'data':_0x13916e});console[_0x5f0288(0x110)](_0x5f0288(0x111)+_0x936d60+_0x5f0288(0xf9));if(_0x13916e[_0x5f0288(0xe6)]===_0x5f0288(0xe1)){console[_0x5f0288(0x110)](_0x5f0288(0xd5)+_0x936d60+_0x5f0288(0xe7));try{const {WebhookService:_0x209c09}=await Promise[_0x5f0288(0x112)]()[_0x5f0288(0x109)](()=>__importStar(require('../services/webhookService'))),_0x438e50=new _0x209c09(),_0x2172c1=await database_1[_0x5f0288(0xe4)][_0x5f0288(0x101)][_0x5f0288(0x100)]({'where':{'id':_0x936d60},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x2172c1&&console['log'](_0x5f0288(0x107)+_0x936d60);}catch(_0x1e0eec){console['error'](_0x5f0288(0xe3),_0x1e0eec);}}_0x480d21[_0x5f0288(0xfd)]({'success':!![],'payment':{'id':_0x129ac1['id'],'status':_0x129ac1['status']}});}catch(_0x3b0f2c){console['error'](_0x5f0288(0xe8),_0x3b0f2c),_0x480d21[_0x5f0288(0xe6)](0x1f4)[_0x5f0288(0xfd)]({'error':_0x5f0288(0x106)});}}),router['get']('/health',(_0x5623cd,_0x254245)=>{const _0x3c72aa=a25_0x3b59a4;_0x254245[_0x3c72aa(0xfd)]({'status':'ok','timestamp':new Date()[_0x3c72aa(0xf8)]()});}),exports['default']=router;