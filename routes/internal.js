'use strict';function a25_0x447e(){const _0x105a5f=['currency','hasOwnProperty','resolve','20841705hiKhAM','findUnique','1702296ZQjvLW','446428HRxeDb','startsWith','8FohJss','payment','../config/database','gatewayPaymentId','includes','headers','1290095PLMMuN','__setModuleDefault','paymentMethod','prototype','/payments/:id/update','error','create','username','status','get','substring','12NtwpFB','patch','\x20with\x20gateway\x20settings','1023104IcNTaB','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','2834671dTLlIr','log','__importStar','default','failureMessage','__esModule','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','cardLast4','Error\x20sending\x20webhook\x20notification:','card_last4','2410304EYiaOA','gateway_payment_id','configurable','\x20updated\x20successfully','params','Internal\x20API\x20error\x20updating\x20payment:','Invalid\x20internal\x20API\x20key','../services/webhookService','PAID','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20','getOwnPropertyNames','Missing\x20or\x20invalid\x20authorization\x20header','shop','Internal\x20server\x20error','update','length','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','paidAt','amount','defineProperty','No\x20valid\x20fields\x20to\x20update','/health','string','payment_method','getOwnPropertyDescriptor','json','keys','paid_at','call','orderId','üéâ\x20Payment\x20','authorization','/payments/:id/gateway-settings','toISOString','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing'];a25_0x447e=function(){return _0x105a5f;};return a25_0x447e();}const a25_0x3965bb=a25_0x5786;function a25_0x5786(_0x169a98,_0x76651){const _0x447ee0=a25_0x447e();return a25_0x5786=function(_0x5786ec,_0x42c5a8){_0x5786ec=_0x5786ec-0xf0;let _0x3cf5e8=_0x447ee0[_0x5786ec];return _0x3cf5e8;},a25_0x5786(_0x169a98,_0x76651);}(function(_0x50cf08,_0x2089f9){const _0x3f6629=a25_0x5786,_0x249faa=_0x50cf08();while(!![]){try{const _0x3312b9=-parseInt(_0x3f6629(0x113))/0x1+parseInt(_0x3f6629(0xfd))/0x2+parseInt(_0x3f6629(0xfc))/0x3*(-parseInt(_0x3f6629(0xff))/0x4)+-parseInt(_0x3f6629(0x105))/0x5*(parseInt(_0x3f6629(0x110))/0x6)+parseInt(_0x3f6629(0x115))/0x7+parseInt(_0x3f6629(0x11f))/0x8+parseInt(_0x3f6629(0xfa))/0x9;if(_0x3312b9===_0x2089f9)break;else _0x249faa['push'](_0x249faa['shift']());}catch(_0x1dc630){_0x249faa['push'](_0x249faa['shift']());}}}(a25_0x447e,0x8b73a));var __createBinding=this&&this['__createBinding']||(Object[a25_0x3965bb(0x10b)]?function(_0x3d5214,_0x2eefe6,_0x3195a4,_0x2354e){const _0x326deb=a25_0x3965bb;if(_0x2354e===undefined)_0x2354e=_0x3195a4;var _0x41dc33=Object[_0x326deb(0x137)](_0x2eefe6,_0x3195a4);(!_0x41dc33||(_0x326deb(0x10e)in _0x41dc33?!_0x2eefe6[_0x326deb(0x11a)]:_0x41dc33['writable']||_0x41dc33[_0x326deb(0x121)]))&&(_0x41dc33={'enumerable':!![],'get':function(){return _0x2eefe6[_0x3195a4];}}),Object[_0x326deb(0x132)](_0x3d5214,_0x2354e,_0x41dc33);}:function(_0x107f1c,_0x415dc0,_0x383da4,_0x20c33a){if(_0x20c33a===undefined)_0x20c33a=_0x383da4;_0x107f1c[_0x20c33a]=_0x415dc0[_0x383da4];}),__setModuleDefault=this&&this[a25_0x3965bb(0x106)]||(Object[a25_0x3965bb(0x10b)]?function(_0x36eb4a,_0x102953){Object['defineProperty'](_0x36eb4a,'default',{'enumerable':!![],'value':_0x102953});}:function(_0x129a16,_0x584418){const _0x47edea=a25_0x3965bb;_0x129a16[_0x47edea(0x118)]=_0x584418;}),__importStar=this&&this[a25_0x3965bb(0x117)]||(function(){var _0x3e99f0=function(_0x399cff){const _0x2a6ddb=a25_0x5786;return _0x3e99f0=Object[_0x2a6ddb(0x129)]||function(_0x153273){const _0x246192=_0x2a6ddb;var _0x18dad0=[];for(var _0xafd05e in _0x153273)if(Object[_0x246192(0x108)][_0x246192(0xf8)][_0x246192(0xf0)](_0x153273,_0xafd05e))_0x18dad0[_0x18dad0[_0x246192(0x12e)]]=_0xafd05e;return _0x18dad0;},_0x3e99f0(_0x399cff);};return function(_0x43e3e3){const _0x50cbcd=a25_0x5786;if(_0x43e3e3&&_0x43e3e3[_0x50cbcd(0x11a)])return _0x43e3e3;var _0x568654={};if(_0x43e3e3!=null){for(var _0xf0fd48=_0x3e99f0(_0x43e3e3),_0x3a1d58=0x0;_0x3a1d58<_0xf0fd48[_0x50cbcd(0x12e)];_0x3a1d58++)if(_0xf0fd48[_0x3a1d58]!=='default')__createBinding(_0x568654,_0x43e3e3,_0xf0fd48[_0x3a1d58]);}return __setModuleDefault(_0x568654,_0x43e3e3),_0x568654;};}()),__importDefault=this&&this['__importDefault']||function(_0x45a08e){const _0x26c820=a25_0x3965bb;return _0x45a08e&&_0x45a08e[_0x26c820(0x11a)]?_0x45a08e:{'default':_0x45a08e};};Object['defineProperty'](exports,a25_0x3965bb(0x11a),{'value':!![]});const express_1=require('express'),database_1=__importDefault(require(a25_0x3965bb(0x101))),router=(0x0,express_1['Router'])(),verifyInternalApiKey=(_0x51a494,_0x198726,_0x29cdc8)=>{const _0x16ad1f=a25_0x3965bb,_0x584aca=_0x51a494[_0x16ad1f(0x104)][_0x16ad1f(0xf3)];if(!_0x584aca||!_0x584aca[_0x16ad1f(0xfe)]('Bearer\x20'))return _0x198726[_0x16ad1f(0x10d)](0x191)[_0x16ad1f(0x138)]({'error':_0x16ad1f(0x12a)});const _0x225507=_0x584aca[_0x16ad1f(0x10f)](0x7);if(_0x225507!=='internal-api-key')return _0x198726[_0x16ad1f(0x10d)](0x191)[_0x16ad1f(0x138)]({'error':_0x16ad1f(0x125)});_0x29cdc8();};router[a25_0x3965bb(0x10e)](a25_0x3965bb(0xf4),verifyInternalApiKey,async(_0x109473,_0x30af44)=>{const _0xfb5f61=a25_0x3965bb;try{const {id:_0x3b0d70}=_0x109473['params'];console[_0xfb5f61(0x116)](_0xfb5f61(0x12f)+_0x3b0d70+_0xfb5f61(0x112));const _0x4a522e=await database_1[_0xfb5f61(0x118)][_0xfb5f61(0x100)][_0xfb5f61(0xfb)]({'where':{'id':_0x3b0d70},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x4a522e)return _0x30af44[_0xfb5f61(0x10d)](0x194)[_0xfb5f61(0x138)]({'error':'Payment\x20not\x20found'});console[_0xfb5f61(0x116)](_0xfb5f61(0x114)+_0x4a522e[_0xfb5f61(0x12b)][_0xfb5f61(0x10c)]),_0x30af44[_0xfb5f61(0x138)]({'id':_0x4a522e['id'],'amount':_0x4a522e[_0xfb5f61(0x131)],'currency':_0x4a522e[_0xfb5f61(0xf7)],'status':_0x4a522e[_0xfb5f61(0x10d)],'orderId':_0x4a522e[_0xfb5f61(0xf1)],'shop':_0x4a522e['shop']});}catch(_0x34171e){console[_0xfb5f61(0x10a)]('Internal\x20API\x20error\x20getting\x20payment:',_0x34171e),_0x30af44[_0xfb5f61(0x10d)](0x1f4)[_0xfb5f61(0x138)]({'error':_0xfb5f61(0x12c)});}}),router[a25_0x3965bb(0x111)](a25_0x3965bb(0x109),verifyInternalApiKey,async(_0x418258,_0x161995)=>{const _0x230a31=a25_0x3965bb;try{const {id:_0xcb2e3d}=_0x418258[_0x230a31(0x123)],_0x2db049=_0x418258['body'];console['log'](_0x230a31(0x128)+_0xcb2e3d,_0x2db049);const _0x2b8cf7=[_0x230a31(0x10d),_0x230a31(0x120),_0x230a31(0x102),'card_last4',_0x230a31(0x11c),'payment_method',_0x230a31(0x107),'paid_at',_0x230a31(0x130),'failure_message',_0x230a31(0x119)],_0x75c58={};for(const [_0xd33f02,_0x422fe6]of Object['entries'](_0x2db049)){if(_0x2b8cf7[_0x230a31(0x103)](_0xd33f02)){let _0x2b8c6b=_0xd33f02;if(_0xd33f02==='gateway_payment_id'||_0xd33f02===_0x230a31(0x102))_0x2b8c6b=_0x230a31(0x102);else{if(_0xd33f02===_0x230a31(0x11e)||_0xd33f02===_0x230a31(0x11c))_0x2b8c6b=_0x230a31(0x11c);else{if(_0xd33f02===_0x230a31(0x136)||_0xd33f02==='paymentMethod')_0x2b8c6b='paymentMethod';else{if(_0xd33f02===_0x230a31(0x13a)||_0xd33f02===_0x230a31(0x130))_0x2b8c6b=_0x230a31(0x130);else(_0xd33f02==='failure_message'||_0xd33f02===_0x230a31(0x119))&&(_0x2b8c6b=_0x230a31(0x119));}}}_0x2b8c6b==='paidAt'&&typeof _0x422fe6===_0x230a31(0x135)?_0x75c58[_0x2b8c6b]=new Date(_0x422fe6):_0x75c58[_0x2b8c6b]=_0x422fe6;}}if(Object[_0x230a31(0x139)](_0x75c58)[_0x230a31(0x12e)]===0x0)return _0x161995[_0x230a31(0x10d)](0x190)[_0x230a31(0x138)]({'error':_0x230a31(0x133)});const _0x8691da=await database_1[_0x230a31(0x118)]['payment'][_0x230a31(0x12d)]({'where':{'id':_0xcb2e3d},'data':_0x75c58});console[_0x230a31(0x116)]('‚úÖ\x20Internal\x20API:\x20Payment\x20'+_0xcb2e3d+_0x230a31(0x122));if(_0x75c58[_0x230a31(0x10d)]===_0x230a31(0x127)){console[_0x230a31(0x116)](_0x230a31(0xf2)+_0xcb2e3d+_0x230a31(0xf6));try{const {WebhookService:_0x1b4376}=await Promise[_0x230a31(0xf9)]()['then'](()=>__importStar(require(_0x230a31(0x126)))),_0x8484ba=new _0x1b4376(),_0x1db1e0=await database_1[_0x230a31(0x118)][_0x230a31(0x100)]['findUnique']({'where':{'id':_0xcb2e3d},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x1db1e0&&console['log'](_0x230a31(0x11b)+_0xcb2e3d);}catch(_0x300a41){console[_0x230a31(0x10a)](_0x230a31(0x11d),_0x300a41);}}_0x161995[_0x230a31(0x138)]({'success':!![],'payment':{'id':_0x8691da['id'],'status':_0x8691da[_0x230a31(0x10d)]}});}catch(_0x43015f){console[_0x230a31(0x10a)](_0x230a31(0x124),_0x43015f),_0x161995[_0x230a31(0x10d)](0x1f4)[_0x230a31(0x138)]({'error':_0x230a31(0x12c)});}}),router['get'](a25_0x3965bb(0x134),(_0x4e495e,_0x34b0a1)=>{const _0x420852=a25_0x3965bb;_0x34b0a1[_0x420852(0x138)]({'status':'ok','timestamp':new Date()[_0x420852(0xf5)]()});}),exports['default']=router;