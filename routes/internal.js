'use strict';function a25_0x124f(_0x17d12c,_0x40341f){const _0x230b77=a25_0x230b();return a25_0x124f=function(_0x124f90,_0x2d6528){_0x124f90=_0x124f90-0xb5;let _0x1743e7=_0x230b77[_0x124f90];return _0x1743e7;},a25_0x124f(_0x17d12c,_0x40341f);}function a25_0x230b(){const _0x3bb215=['defineProperty','update','‚úÖ\x20Internal\x20API:\x20Payment\x20','471939fbuSHw','internal-api-key','1246120lRhqKK','length','PAID','168957ozsQTl','card_last4','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','Internal\x20API\x20error\x20getting\x20payment:','create','amount','Invalid\x20internal\x20API\x20key','payment','get','default','substring','payment_method','paymentMethod','entries','42CLKiDS','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','username','then','log','/payments/:id/update','__importStar','startsWith','4398846hUOMjD','findUnique','No\x20valid\x20fields\x20to\x20update','status','hasOwnProperty','Payment\x20not\x20found','__esModule','includes','__setModuleDefault','resolve','currency','params','configurable','getOwnPropertyNames','orderId','failure_message','headers','Error\x20sending\x20webhook\x20notification:','authorization','json','9444213KIguzk','40yqcaWa','error','\x20updated\x20successfully','cardLast4','string','paidAt','1023328qNVipn','4960244LYfFTL','Internal\x20server\x20error','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20','paid_at','gateway_payment_id','writable','Bearer\x20','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','toISOString','failureMessage','call','express','keys','shop','gatewayPaymentId'];a25_0x230b=function(){return _0x3bb215;};return a25_0x230b();}const a25_0xd43af5=a25_0x124f;(function(_0x18a7ca,_0x18ff80){const _0x5b103e=a25_0x124f,_0x241bca=_0x18a7ca();while(!![]){try{const _0x4a43f6=-parseInt(_0x5b103e(0xf6))/0x1+-parseInt(_0x5b103e(0xdd))/0x2*(-parseInt(_0x5b103e(0xfb))/0x3)+parseInt(_0x5b103e(0xe4))/0x4+-parseInt(_0x5b103e(0xf8))/0x5+-parseInt(_0x5b103e(0xc8))/0x6+parseInt(_0x5b103e(0xc0))/0x7*(parseInt(_0x5b103e(0xe3))/0x8)+-parseInt(_0x5b103e(0xdc))/0x9;if(_0x4a43f6===_0x18ff80)break;else _0x241bca['push'](_0x241bca['shift']());}catch(_0x27f2ef){_0x241bca['push'](_0x241bca['shift']());}}}(a25_0x230b,0x99e04));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x2df4ab,_0x23f30a,_0x579b05,_0x5cb4bd){const _0x4cfb7a=a25_0x124f;if(_0x5cb4bd===undefined)_0x5cb4bd=_0x579b05;var _0x50d26f=Object['getOwnPropertyDescriptor'](_0x23f30a,_0x579b05);(!_0x50d26f||(_0x4cfb7a(0xba)in _0x50d26f?!_0x23f30a[_0x4cfb7a(0xce)]:_0x50d26f[_0x4cfb7a(0xe9)]||_0x50d26f[_0x4cfb7a(0xd4)]))&&(_0x50d26f={'enumerable':!![],'get':function(){return _0x23f30a[_0x579b05];}}),Object[_0x4cfb7a(0xf3)](_0x2df4ab,_0x5cb4bd,_0x50d26f);}:function(_0x266fd4,_0x19299b,_0x5191e7,_0x5457d9){if(_0x5457d9===undefined)_0x5457d9=_0x5191e7;_0x266fd4[_0x5457d9]=_0x19299b[_0x5191e7];}),__setModuleDefault=this&&this[a25_0xd43af5(0xd0)]||(Object[a25_0xd43af5(0xb6)]?function(_0x34cf4c,_0x483ca5){const _0x593571=a25_0xd43af5;Object['defineProperty'](_0x34cf4c,_0x593571(0xbb),{'enumerable':!![],'value':_0x483ca5});}:function(_0x4b3ced,_0x5269ff){const _0x3bc8a1=a25_0xd43af5;_0x4b3ced[_0x3bc8a1(0xbb)]=_0x5269ff;}),__importStar=this&&this[a25_0xd43af5(0xc6)]||(function(){var _0xb86f0c=function(_0x525156){const _0x4c4711=a25_0x124f;return _0xb86f0c=Object[_0x4c4711(0xd5)]||function(_0x588fcb){const _0x3eb250=_0x4c4711;var _0x276b99=[];for(var _0x3d71ea in _0x588fcb)if(Object['prototype'][_0x3eb250(0xcc)][_0x3eb250(0xee)](_0x588fcb,_0x3d71ea))_0x276b99[_0x276b99['length']]=_0x3d71ea;return _0x276b99;},_0xb86f0c(_0x525156);};return function(_0x2a58ab){const _0x511e32=a25_0x124f;if(_0x2a58ab&&_0x2a58ab['__esModule'])return _0x2a58ab;var _0x2e14ff={};if(_0x2a58ab!=null){for(var _0x45753f=_0xb86f0c(_0x2a58ab),_0x28b403=0x0;_0x28b403<_0x45753f[_0x511e32(0xf9)];_0x28b403++)if(_0x45753f[_0x28b403]!==_0x511e32(0xbb))__createBinding(_0x2e14ff,_0x2a58ab,_0x45753f[_0x28b403]);}return __setModuleDefault(_0x2e14ff,_0x2a58ab),_0x2e14ff;};}()),__importDefault=this&&this['__importDefault']||function(_0x963b44){const _0x5da6d4=a25_0xd43af5;return _0x963b44&&_0x963b44[_0x5da6d4(0xce)]?_0x963b44:{'default':_0x963b44};};Object['defineProperty'](exports,'__esModule',{'value':!![]});const express_1=require(a25_0xd43af5(0xef)),database_1=__importDefault(require('../config/database')),router=(0x0,express_1['Router'])(),verifyInternalApiKey=(_0x2f47ca,_0x34f50f,_0x16001a)=>{const _0x2756d4=a25_0xd43af5,_0x1d8477=_0x2f47ca[_0x2756d4(0xd8)][_0x2756d4(0xda)];if(!_0x1d8477||!_0x1d8477[_0x2756d4(0xc7)](_0x2756d4(0xea)))return _0x34f50f[_0x2756d4(0xcb)](0x191)[_0x2756d4(0xdb)]({'error':'Missing\x20or\x20invalid\x20authorization\x20header'});const _0x225434=_0x1d8477[_0x2756d4(0xbc)](0x7);if(_0x225434!==_0x2756d4(0xf7))return _0x34f50f[_0x2756d4(0xcb)](0x191)['json']({'error':_0x2756d4(0xb8)});_0x16001a();};router[a25_0xd43af5(0xba)]('/payments/:id/gateway-settings',verifyInternalApiKey,async(_0x4f14d7,_0x363237)=>{const _0x50f655=a25_0xd43af5;try{const {id:_0xfd7525}=_0x4f14d7[_0x50f655(0xd3)];console[_0x50f655(0xc4)](_0x50f655(0xeb)+_0xfd7525+'\x20with\x20gateway\x20settings');const _0x5cc51a=await database_1['default'][_0x50f655(0xb9)][_0x50f655(0xc9)]({'where':{'id':_0xfd7525},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x5cc51a)return _0x363237['status'](0x194)[_0x50f655(0xdb)]({'error':_0x50f655(0xcd)});console[_0x50f655(0xc4)]('‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20'+_0x5cc51a[_0x50f655(0xf1)][_0x50f655(0xc2)]),_0x363237[_0x50f655(0xdb)]({'id':_0x5cc51a['id'],'amount':_0x5cc51a[_0x50f655(0xb7)],'currency':_0x5cc51a[_0x50f655(0xd2)],'status':_0x5cc51a[_0x50f655(0xcb)],'orderId':_0x5cc51a[_0x50f655(0xd6)],'shop':_0x5cc51a[_0x50f655(0xf1)]});}catch(_0x5f528e){console[_0x50f655(0xde)](_0x50f655(0xb5),_0x5f528e),_0x363237['status'](0x1f4)['json']({'error':_0x50f655(0xe5)});}}),router['patch'](a25_0xd43af5(0xc5),verifyInternalApiKey,async(_0x4481cd,_0x2d4262)=>{const _0x586ee6=a25_0xd43af5;try{const {id:_0xa1b26c}=_0x4481cd[_0x586ee6(0xd3)],_0x37c781=_0x4481cd['body'];console['log'](_0x586ee6(0xe6)+_0xa1b26c,_0x37c781);const _0x8d04de=[_0x586ee6(0xcb),_0x586ee6(0xe8),_0x586ee6(0xf2),_0x586ee6(0xfc),'cardLast4',_0x586ee6(0xbd),_0x586ee6(0xbe),_0x586ee6(0xe7),_0x586ee6(0xe2),'failure_message',_0x586ee6(0xed)],_0x44a903={};for(const [_0x466319,_0x53053]of Object[_0x586ee6(0xbf)](_0x37c781)){if(_0x8d04de[_0x586ee6(0xcf)](_0x466319)){let _0x105920=_0x466319;if(_0x466319==='gateway_payment_id'||_0x466319==='gatewayPaymentId')_0x105920=_0x586ee6(0xf2);else{if(_0x466319===_0x586ee6(0xfc)||_0x466319===_0x586ee6(0xe0))_0x105920=_0x586ee6(0xe0);else{if(_0x466319==='payment_method'||_0x466319===_0x586ee6(0xbe))_0x105920=_0x586ee6(0xbe);else{if(_0x466319==='paid_at'||_0x466319===_0x586ee6(0xe2))_0x105920=_0x586ee6(0xe2);else(_0x466319===_0x586ee6(0xd7)||_0x466319==='failureMessage')&&(_0x105920='failureMessage');}}}_0x105920===_0x586ee6(0xe2)&&typeof _0x53053===_0x586ee6(0xe1)?_0x44a903[_0x105920]=new Date(_0x53053):_0x44a903[_0x105920]=_0x53053;}}if(Object[_0x586ee6(0xf0)](_0x44a903)[_0x586ee6(0xf9)]===0x0)return _0x2d4262[_0x586ee6(0xcb)](0x190)[_0x586ee6(0xdb)]({'error':_0x586ee6(0xca)});const _0x427641=await database_1[_0x586ee6(0xbb)]['payment'][_0x586ee6(0xf4)]({'where':{'id':_0xa1b26c},'data':_0x44a903});console[_0x586ee6(0xc4)](_0x586ee6(0xf5)+_0xa1b26c+_0x586ee6(0xdf));if(_0x44a903['status']===_0x586ee6(0xfa)){console['log']('üéâ\x20Payment\x20'+_0xa1b26c+_0x586ee6(0xfd));try{const {WebhookService:_0x5c7577}=await Promise[_0x586ee6(0xd1)]()[_0x586ee6(0xc3)](()=>__importStar(require('../services/webhookService'))),_0x342294=new _0x5c7577(),_0x5dd389=await database_1[_0x586ee6(0xbb)][_0x586ee6(0xb9)]['findUnique']({'where':{'id':_0xa1b26c},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x5dd389&&console['log'](_0x586ee6(0xc1)+_0xa1b26c);}catch(_0x55089e){console[_0x586ee6(0xde)](_0x586ee6(0xd9),_0x55089e);}}_0x2d4262[_0x586ee6(0xdb)]({'success':!![],'payment':{'id':_0x427641['id'],'status':_0x427641[_0x586ee6(0xcb)]}});}catch(_0x319d07){console[_0x586ee6(0xde)]('Internal\x20API\x20error\x20updating\x20payment:',_0x319d07),_0x2d4262[_0x586ee6(0xcb)](0x1f4)[_0x586ee6(0xdb)]({'error':_0x586ee6(0xe5)});}}),router[a25_0xd43af5(0xba)]('/health',(_0x470ef6,_0x177759)=>{const _0x4e24a6=a25_0xd43af5;_0x177759['json']({'status':'ok','timestamp':new Date()[_0x4e24a6(0xec)]()});}),exports[a25_0xd43af5(0xbb)]=router;