'use strict';const a25_0x269225=a25_0x2b6d;(function(_0x2b8cf5,_0x2be268){const _0x232307=a25_0x2b6d,_0x173f74=_0x2b8cf5();while(!![]){try{const _0x1964f9=parseInt(_0x232307(0x9e))/0x1*(-parseInt(_0x232307(0x94))/0x2)+-parseInt(_0x232307(0x98))/0x3*(-parseInt(_0x232307(0xb3))/0x4)+parseInt(_0x232307(0xc8))/0x5*(-parseInt(_0x232307(0xd0))/0x6)+-parseInt(_0x232307(0xaa))/0x7*(-parseInt(_0x232307(0xb8))/0x8)+-parseInt(_0x232307(0x8d))/0x9*(parseInt(_0x232307(0xbb))/0xa)+parseInt(_0x232307(0xc5))/0xb*(parseInt(_0x232307(0xb4))/0xc)+parseInt(_0x232307(0xb2))/0xd;if(_0x1964f9===_0x2be268)break;else _0x173f74['push'](_0x173f74['shift']());}catch(_0x3ab2e3){_0x173f74['push'](_0x173f74['shift']());}}}(a25_0x56d0,0x72e72));function a25_0x2b6d(_0x1ab8d6,_0x44a09d){const _0x56d007=a25_0x56d0();return a25_0x2b6d=function(_0x2b6de0,_0x554133){_0x2b6de0=_0x2b6de0-0x82;let _0xe833c=_0x56d007[_0x2b6de0];return _0xe833c;},a25_0x2b6d(_0x1ab8d6,_0x44a09d);}var __createBinding=this&&this[a25_0x269225(0x99)]||(Object[a25_0x269225(0x83)]?function(_0x4bb81c,_0x40786c,_0x132ba3,_0xe227de){const _0x13e450=a25_0x269225;if(_0xe227de===undefined)_0xe227de=_0x132ba3;var _0x27c879=Object[_0x13e450(0xca)](_0x40786c,_0x132ba3);(!_0x27c879||(_0x13e450(0xcb)in _0x27c879?!_0x40786c['__esModule']:_0x27c879[_0x13e450(0xc0)]||_0x27c879[_0x13e450(0xd1)]))&&(_0x27c879={'enumerable':!![],'get':function(){return _0x40786c[_0x132ba3];}}),Object[_0x13e450(0xa3)](_0x4bb81c,_0xe227de,_0x27c879);}:function(_0x2fad36,_0x1351c5,_0x130c61,_0x274831){if(_0x274831===undefined)_0x274831=_0x130c61;_0x2fad36[_0x274831]=_0x1351c5[_0x130c61];}),__setModuleDefault=this&&this[a25_0x269225(0x8b)]||(Object[a25_0x269225(0x83)]?function(_0x404bee,_0x2fa66b){const _0x434884=a25_0x269225;Object[_0x434884(0xa3)](_0x404bee,'default',{'enumerable':!![],'value':_0x2fa66b});}:function(_0x3cc1d6,_0x45ca29){const _0x28ae69=a25_0x269225;_0x3cc1d6[_0x28ae69(0x9b)]=_0x45ca29;}),__importStar=this&&this[a25_0x269225(0xa8)]||(function(){var _0xd2748c=function(_0x20f966){const _0x445fde=a25_0x2b6d;return _0xd2748c=Object[_0x445fde(0xac)]||function(_0x22b25f){const _0x1db080=_0x445fde;var _0x4820f5=[];for(var _0x190e6d in _0x22b25f)if(Object[_0x1db080(0x97)]['hasOwnProperty'][_0x1db080(0xcf)](_0x22b25f,_0x190e6d))_0x4820f5[_0x4820f5['length']]=_0x190e6d;return _0x4820f5;},_0xd2748c(_0x20f966);};return function(_0x4b7a17){const _0x152f0f=a25_0x2b6d;if(_0x4b7a17&&_0x4b7a17[_0x152f0f(0x9d)])return _0x4b7a17;var _0x51e43c={};if(_0x4b7a17!=null){for(var _0x3fcee5=_0xd2748c(_0x4b7a17),_0x4e524d=0x0;_0x4e524d<_0x3fcee5[_0x152f0f(0x9a)];_0x4e524d++)if(_0x3fcee5[_0x4e524d]!==_0x152f0f(0x9b))__createBinding(_0x51e43c,_0x4b7a17,_0x3fcee5[_0x4e524d]);}return __setModuleDefault(_0x51e43c,_0x4b7a17),_0x51e43c;};}()),__importDefault=this&&this[a25_0x269225(0xa1)]||function(_0x13452c){const _0x107543=a25_0x269225;return _0x13452c&&_0x13452c[_0x107543(0x9d)]?_0x13452c:{'default':_0x13452c};};Object[a25_0x269225(0xa3)](exports,'__esModule',{'value':!![]});const express_1=require(a25_0x269225(0xaf)),database_1=__importDefault(require('../config/database')),router=(0x0,express_1[a25_0x269225(0xa6)])(),verifyInternalApiKey=(_0x549374,_0x220f2e,_0x3960c2)=>{const _0x5a014b=a25_0x269225,_0x3236b8=_0x549374[_0x5a014b(0xa0)][_0x5a014b(0xbf)];if(!_0x3236b8||!_0x3236b8['startsWith']('Bearer\x20'))return _0x220f2e[_0x5a014b(0x84)](0x191)[_0x5a014b(0xa5)]({'error':_0x5a014b(0xc1)});const _0x217093=_0x3236b8['substring'](0x7);if(_0x217093!==_0x5a014b(0xa7))return _0x220f2e['status'](0x191)[_0x5a014b(0xa5)]({'error':_0x5a014b(0x89)});_0x3960c2();};function a25_0x56d0(){const _0x3f79e0=['gateway_payment_id','🎉\x20Payment\x20','prototype','42519Ozsmvp','__createBinding','length','default','cardLast4','__esModule','45Hhddyl','params','headers','__importDefault','username','defineProperty','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','json','Router','internal-api-key','__importStar','then','18158QJLeOk','body','getOwnPropertyNames','Internal\x20server\x20error','card_last4','express','PAID','\x20updated\x20successfully','11349429NALBVi','184uDrQgY','11040Frvvpd','paidAt','toISOString','No\x20valid\x20fields\x20to\x20update','224sQCccd','payment','payment_method','2657310vDRJPh','entries','\x20with\x20gateway\x20settings','✅\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','authorization','writable','Missing\x20or\x20invalid\x20authorization\x20header','findUnique','✅\x20Internal\x20API:\x20Payment\x20','string','9108wrnhKp','Error\x20sending\x20webhook\x20notification:','🔄\x20Internal\x20API:\x20Updating\x20payment\x20','85ULLpaq','keys','getOwnPropertyDescriptor','get','🔍\x20Internal\x20API:\x20Getting\x20payment\x20','📤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','patch','call','268410OmycyB','configurable','currency','failureMessage','create','status','paid_at','error','log','Internal\x20API\x20error\x20updating\x20payment:','Invalid\x20internal\x20API\x20key','includes','__setModuleDefault','gatewayPaymentId','9LeAOjf','shop','/payments/:id/update','orderId','paymentMethod','Payment\x20not\x20found','resolve','38334IbKcaI'];a25_0x56d0=function(){return _0x3f79e0;};return a25_0x56d0();}router[a25_0x269225(0xcb)]('/payments/:id/gateway-settings',verifyInternalApiKey,async(_0x485a49,_0xf6cf54)=>{const _0x4825e6=a25_0x269225;try{const {id:_0x480ac4}=_0x485a49['params'];console[_0x4825e6(0x87)](_0x4825e6(0xcc)+_0x480ac4+_0x4825e6(0xbd));const _0x216b34=await database_1[_0x4825e6(0x9b)][_0x4825e6(0xb9)][_0x4825e6(0xc2)]({'where':{'id':_0x480ac4},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x216b34)return _0xf6cf54[_0x4825e6(0x84)](0x194)[_0x4825e6(0xa5)]({'error':_0x4825e6(0x92)});console[_0x4825e6(0x87)](_0x4825e6(0xbe)+_0x216b34[_0x4825e6(0x8e)][_0x4825e6(0xa2)]),_0xf6cf54[_0x4825e6(0xa5)]({'id':_0x216b34['id'],'amount':_0x216b34['amount'],'currency':_0x216b34[_0x4825e6(0xd2)],'status':_0x216b34['status'],'orderId':_0x216b34[_0x4825e6(0x90)],'shop':_0x216b34[_0x4825e6(0x8e)]});}catch(_0x1e5aca){console[_0x4825e6(0x86)]('Internal\x20API\x20error\x20getting\x20payment:',_0x1e5aca),_0xf6cf54[_0x4825e6(0x84)](0x1f4)[_0x4825e6(0xa5)]({'error':_0x4825e6(0xad)});}}),router[a25_0x269225(0xce)](a25_0x269225(0x8f),verifyInternalApiKey,async(_0x1c08f1,_0x2a36af)=>{const _0x5643ba=a25_0x269225;try{const {id:_0x4b5b7f}=_0x1c08f1[_0x5643ba(0x9f)],_0x34c21a=_0x1c08f1[_0x5643ba(0xab)];console[_0x5643ba(0x87)](_0x5643ba(0xc7)+_0x4b5b7f,_0x34c21a);const _0x54257e=['status',_0x5643ba(0x95),'gatewayPaymentId',_0x5643ba(0xae),_0x5643ba(0x9c),_0x5643ba(0xba),'paymentMethod',_0x5643ba(0x85),_0x5643ba(0xb5),'failure_message',_0x5643ba(0x82)],_0x3a661d={};for(const [_0xa2a541,_0x4d856b]of Object[_0x5643ba(0xbc)](_0x34c21a)){if(_0x54257e[_0x5643ba(0x8a)](_0xa2a541)){let _0x3a2812=_0xa2a541;if(_0xa2a541===_0x5643ba(0x95)||_0xa2a541===_0x5643ba(0x8c))_0x3a2812='gatewayPaymentId';else{if(_0xa2a541==='card_last4'||_0xa2a541===_0x5643ba(0x9c))_0x3a2812=_0x5643ba(0x9c);else{if(_0xa2a541===_0x5643ba(0xba)||_0xa2a541==='paymentMethod')_0x3a2812=_0x5643ba(0x91);else{if(_0xa2a541===_0x5643ba(0x85)||_0xa2a541===_0x5643ba(0xb5))_0x3a2812='paidAt';else(_0xa2a541==='failure_message'||_0xa2a541===_0x5643ba(0x82))&&(_0x3a2812=_0x5643ba(0x82));}}}_0x3a2812===_0x5643ba(0xb5)&&typeof _0x4d856b===_0x5643ba(0xc4)?_0x3a661d[_0x3a2812]=new Date(_0x4d856b):_0x3a661d[_0x3a2812]=_0x4d856b;}}if(Object[_0x5643ba(0xc9)](_0x3a661d)[_0x5643ba(0x9a)]===0x0)return _0x2a36af[_0x5643ba(0x84)](0x190)[_0x5643ba(0xa5)]({'error':_0x5643ba(0xb7)});const _0x3a63f5=await database_1[_0x5643ba(0x9b)][_0x5643ba(0xb9)]['update']({'where':{'id':_0x4b5b7f},'data':_0x3a661d});console['log'](_0x5643ba(0xc3)+_0x4b5b7f+_0x5643ba(0xb1));if(_0x3a661d[_0x5643ba(0x84)]===_0x5643ba(0xb0)){console[_0x5643ba(0x87)](_0x5643ba(0x96)+_0x4b5b7f+_0x5643ba(0xa4));try{const {WebhookService:_0x20e3bc}=await Promise[_0x5643ba(0x93)]()[_0x5643ba(0xa9)](()=>__importStar(require('../services/webhookService'))),_0x17be11=new _0x20e3bc(),_0xb9aa73=await database_1['default'][_0x5643ba(0xb9)][_0x5643ba(0xc2)]({'where':{'id':_0x4b5b7f},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0xb9aa73&&console['log'](_0x5643ba(0xcd)+_0x4b5b7f);}catch(_0x31bc93){console[_0x5643ba(0x86)](_0x5643ba(0xc6),_0x31bc93);}}_0x2a36af[_0x5643ba(0xa5)]({'success':!![],'payment':{'id':_0x3a63f5['id'],'status':_0x3a63f5[_0x5643ba(0x84)]}});}catch(_0x3d4e89){console[_0x5643ba(0x86)](_0x5643ba(0x88),_0x3d4e89),_0x2a36af[_0x5643ba(0x84)](0x1f4)[_0x5643ba(0xa5)]({'error':_0x5643ba(0xad)});}}),router[a25_0x269225(0xcb)]('/health',(_0x2d329f,_0x366539)=>{const _0x2837b2=a25_0x269225;_0x366539[_0x2837b2(0xa5)]({'status':'ok','timestamp':new Date()[_0x2837b2(0xb6)]()});}),exports[a25_0x269225(0x9b)]=router;