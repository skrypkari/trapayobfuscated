'use strict';const a30_0x49198c=a30_0x505f;function a30_0x505f(_0x4a2ecc,_0x5b1d37){_0x4a2ecc=_0x4a2ecc-0x163;const _0x5d5f21=a30_0x5d5f();let _0x505fd2=_0x5d5f21[_0x4a2ecc];return _0x505fd2;}(function(_0x2d5935,_0x3dee61){const _0x596a83=a30_0x505f,_0x4910bd=_0x2d5935();while(!![]){try{const _0x305351=-parseInt(_0x596a83(0x173))/0x1*(-parseInt(_0x596a83(0x17b))/0x2)+-parseInt(_0x596a83(0x187))/0x3*(parseInt(_0x596a83(0x19d))/0x4)+parseInt(_0x596a83(0x195))/0x5+-parseInt(_0x596a83(0x18e))/0x6+-parseInt(_0x596a83(0x174))/0x7*(-parseInt(_0x596a83(0x19f))/0x8)+parseInt(_0x596a83(0x16d))/0x9+-parseInt(_0x596a83(0x19e))/0xa;if(_0x305351===_0x3dee61)break;else _0x4910bd['push'](_0x4910bd['shift']());}catch(_0x40cc21){_0x4910bd['push'](_0x4910bd['shift']());}}}(a30_0x5d5f,0xb15fe));var __createBinding=this&&this['__createBinding']||(Object[a30_0x49198c(0x172)]?function(_0x3f289f,_0x3d093a,_0x23fc4f,_0x2c8c42){const _0x5adaa4=a30_0x49198c;if(_0x2c8c42===undefined)_0x2c8c42=_0x23fc4f;var _0x567d93=Object['getOwnPropertyDescriptor'](_0x3d093a,_0x23fc4f);(!_0x567d93||('get'in _0x567d93?!_0x3d093a[_0x5adaa4(0x17f)]:_0x567d93[_0x5adaa4(0x17c)]||_0x567d93[_0x5adaa4(0x193)]))&&(_0x567d93={'enumerable':!![],'get':function(){return _0x3d093a[_0x23fc4f];}}),Object[_0x5adaa4(0x17a)](_0x3f289f,_0x2c8c42,_0x567d93);}:function(_0x5f3f7e,_0x56f88b,_0x2c4fc2,_0x52c935){if(_0x52c935===undefined)_0x52c935=_0x2c4fc2;_0x5f3f7e[_0x52c935]=_0x56f88b[_0x2c4fc2];}),__setModuleDefault=this&&this[a30_0x49198c(0x183)]||(Object[a30_0x49198c(0x172)]?function(_0xefb937,_0xfc004d){const _0x3dc5b3=a30_0x49198c;Object[_0x3dc5b3(0x17a)](_0xefb937,_0x3dc5b3(0x1a9),{'enumerable':!![],'value':_0xfc004d});}:function(_0xee1c58,_0x12882d){const _0x258de5=a30_0x49198c;_0xee1c58[_0x258de5(0x1a9)]=_0x12882d;}),__importStar=this&&this['__importStar']||(function(){var _0x53b647=function(_0x4a3d00){const _0x28bd41=a30_0x505f;return _0x53b647=Object[_0x28bd41(0x1a3)]||function(_0x240ad7){const _0x389e1e=_0x28bd41;var _0x30c280=[];for(var _0x26fc7f in _0x240ad7)if(Object['prototype'][_0x389e1e(0x166)]['call'](_0x240ad7,_0x26fc7f))_0x30c280[_0x30c280[_0x389e1e(0x181)]]=_0x26fc7f;return _0x30c280;},_0x53b647(_0x4a3d00);};return function(_0x235859){const _0x104a46=a30_0x505f;if(_0x235859&&_0x235859[_0x104a46(0x17f)])return _0x235859;var _0x575bfb={};if(_0x235859!=null){for(var _0x181a67=_0x53b647(_0x235859),_0x1c9348=0x0;_0x1c9348<_0x181a67[_0x104a46(0x181)];_0x1c9348++)if(_0x181a67[_0x1c9348]!==_0x104a46(0x1a9))__createBinding(_0x575bfb,_0x235859,_0x181a67[_0x1c9348]);}return __setModuleDefault(_0x575bfb,_0x235859),_0x575bfb;};}()),__importDefault=this&&this['__importDefault']||function(_0x59faa7){const _0xb86d5e=a30_0x49198c;return _0x59faa7&&_0x59faa7[_0xb86d5e(0x17f)]?_0x59faa7:{'default':_0x59faa7};};Object[a30_0x49198c(0x17a)](exports,a30_0x49198c(0x17f),{'value':!![]});const express_1=require('express'),database_1=__importDefault(require(a30_0x49198c(0x19a))),router=(0x0,express_1[a30_0x49198c(0x1a0)])(),verifyInternalApiKey=(_0x1a95f7,_0x4a9d59,_0x2c4b8c)=>{const _0x58364a=a30_0x49198c,_0x19e273=_0x1a95f7[_0x58364a(0x177)][_0x58364a(0x18c)];if(!_0x19e273||!_0x19e273[_0x58364a(0x176)](_0x58364a(0x182)))return _0x4a9d59[_0x58364a(0x16c)](0x191)[_0x58364a(0x19c)]({'error':_0x58364a(0x194)});const _0x48f8a7=_0x19e273['substring'](0x7);if(_0x48f8a7!=='internal-api-key')return _0x4a9d59[_0x58364a(0x16c)](0x191)[_0x58364a(0x19c)]({'error':_0x58364a(0x18f)});_0x2c4b8c();};function a30_0x5d5f(){const _0x1766a3=['entries','\x20with\x20gateway\x20settings','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','hasOwnProperty','resolve','Internal\x20API\x20error\x20updating\x20payment:','cardLast4','ðŸ”\x20Internal\x20API:\x20Getting\x20payment\x20','update','status','9023679oLjjBI','PAID','paid_at','/payments/:id/update','Internal\x20server\x20error','create','449893JYbGtj','196tfkfcN','/payments/:id/gateway-settings','startsWith','headers','âœ…\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','No\x20valid\x20fields\x20to\x20update','defineProperty','2MSwmKL','writable','ðŸ“¤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','gatewayPaymentId','__esModule','paymentMethod','length','Bearer\x20','__setModuleDefault','body','orderId','card_last4','4124991xSJmNN','gateway_payment_id','keys','payment','error','authorization','\x20updated\x20successfully','1206294wWTOBX','Invalid\x20internal\x20API\x20key','ðŸ”„\x20Internal\x20API:\x20Updating\x20payment\x20','failure_message','log','configurable','Missing\x20or\x20invalid\x20authorization\x20header','5882795VYLlWX','../services/webhookService','paidAt','get','ðŸŽ‰\x20Payment\x20','../config/database','string','json','4UsrwoC','7025230JlFSeQ','107432YiswMt','Router','includes','params','getOwnPropertyNames','then','Error\x20sending\x20webhook\x20notification:','findUnique','/health','failureMessage','default','âœ…\x20Internal\x20API:\x20Payment\x20','payment_method','amount'];a30_0x5d5f=function(){return _0x1766a3;};return a30_0x5d5f();}router[a30_0x49198c(0x198)](a30_0x49198c(0x175),verifyInternalApiKey,async(_0x16db7c,_0x361f54)=>{const _0x37595d=a30_0x49198c;try{const {id:_0x5a8a74}=_0x16db7c[_0x37595d(0x1a2)];console[_0x37595d(0x192)](_0x37595d(0x16a)+_0x5a8a74+_0x37595d(0x164));const _0x2b7bd4=await database_1[_0x37595d(0x1a9)][_0x37595d(0x18a)][_0x37595d(0x1a6)]({'where':{'id':_0x5a8a74},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x2b7bd4)return _0x361f54['status'](0x194)[_0x37595d(0x19c)]({'error':'Payment\x20not\x20found'});console[_0x37595d(0x192)](_0x37595d(0x178)+_0x2b7bd4['shop']['username']),_0x361f54['json']({'id':_0x2b7bd4['id'],'amount':_0x2b7bd4[_0x37595d(0x1ac)],'currency':_0x2b7bd4['currency'],'status':_0x2b7bd4[_0x37595d(0x16c)],'orderId':_0x2b7bd4[_0x37595d(0x185)],'shop':_0x2b7bd4['shop']});}catch(_0x4a260c){console[_0x37595d(0x18b)]('Internal\x20API\x20error\x20getting\x20payment:',_0x4a260c),_0x361f54[_0x37595d(0x16c)](0x1f4)[_0x37595d(0x19c)]({'error':_0x37595d(0x171)});}}),router['patch'](a30_0x49198c(0x170),verifyInternalApiKey,async(_0x2c44af,_0x49cbc2)=>{const _0x551117=a30_0x49198c;try{const {id:_0x17b568}=_0x2c44af['params'],_0x4f76f0=_0x2c44af[_0x551117(0x184)];console[_0x551117(0x192)](_0x551117(0x190)+_0x17b568,_0x4f76f0);const _0x1e942d=[_0x551117(0x16c),'gateway_payment_id',_0x551117(0x17e),'card_last4',_0x551117(0x169),'payment_method',_0x551117(0x180),_0x551117(0x16f),_0x551117(0x197),_0x551117(0x191),_0x551117(0x1a8)],_0x207951={};for(const [_0x18ee87,_0x1f1d63]of Object[_0x551117(0x163)](_0x4f76f0)){if(_0x1e942d[_0x551117(0x1a1)](_0x18ee87)){let _0xed72be=_0x18ee87;if(_0x18ee87===_0x551117(0x188)||_0x18ee87===_0x551117(0x17e))_0xed72be=_0x551117(0x17e);else{if(_0x18ee87===_0x551117(0x186)||_0x18ee87===_0x551117(0x169))_0xed72be='cardLast4';else{if(_0x18ee87===_0x551117(0x1ab)||_0x18ee87===_0x551117(0x180))_0xed72be=_0x551117(0x180);else{if(_0x18ee87==='paid_at'||_0x18ee87===_0x551117(0x197))_0xed72be=_0x551117(0x197);else(_0x18ee87===_0x551117(0x191)||_0x18ee87===_0x551117(0x1a8))&&(_0xed72be=_0x551117(0x1a8));}}}_0xed72be===_0x551117(0x197)&&typeof _0x1f1d63===_0x551117(0x19b)?_0x207951[_0xed72be]=new Date(_0x1f1d63):_0x207951[_0xed72be]=_0x1f1d63;}}if(Object[_0x551117(0x189)](_0x207951)[_0x551117(0x181)]===0x0)return _0x49cbc2[_0x551117(0x16c)](0x190)[_0x551117(0x19c)]({'error':_0x551117(0x179)});const _0x1ebfa9=await database_1[_0x551117(0x1a9)][_0x551117(0x18a)][_0x551117(0x16b)]({'where':{'id':_0x17b568},'data':_0x207951});console['log'](_0x551117(0x1aa)+_0x17b568+_0x551117(0x18d));if(_0x207951['status']===_0x551117(0x16e)){console[_0x551117(0x192)](_0x551117(0x199)+_0x17b568+_0x551117(0x165));try{const {WebhookService:_0x215f9f}=await Promise[_0x551117(0x167)]()[_0x551117(0x1a4)](()=>__importStar(require(_0x551117(0x196)))),_0x17d394=new _0x215f9f(),_0x55df17=await database_1['default'][_0x551117(0x18a)][_0x551117(0x1a6)]({'where':{'id':_0x17b568},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x55df17&&console[_0x551117(0x192)](_0x551117(0x17d)+_0x17b568);}catch(_0x14baf7){console[_0x551117(0x18b)](_0x551117(0x1a5),_0x14baf7);}}_0x49cbc2['json']({'success':!![],'payment':{'id':_0x1ebfa9['id'],'status':_0x1ebfa9[_0x551117(0x16c)]}});}catch(_0x40a977){console['error'](_0x551117(0x168),_0x40a977),_0x49cbc2[_0x551117(0x16c)](0x1f4)[_0x551117(0x19c)]({'error':'Internal\x20server\x20error'});}}),router[a30_0x49198c(0x198)](a30_0x49198c(0x1a7),(_0x2547b3,_0x4578fc)=>{const _0x3351d1=a30_0x49198c;_0x4578fc[_0x3351d1(0x19c)]({'status':'ok','timestamp':new Date()['toISOString']()});}),exports[a30_0x49198c(0x1a9)]=router;