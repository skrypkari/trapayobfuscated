'use strict';const a32_0x2dc579=a32_0x146a;(function(_0x49f800,_0x51979b){const _0x1eeadb=a32_0x146a,_0x2e26e4=_0x49f800();while(!![]){try{const _0x2969f8=parseInt(_0x1eeadb(0xe0))/0x1*(parseInt(_0x1eeadb(0xde))/0x2)+parseInt(_0x1eeadb(0x118))/0x3+parseInt(_0x1eeadb(0xe9))/0x4*(-parseInt(_0x1eeadb(0x117))/0x5)+-parseInt(_0x1eeadb(0x11a))/0x6*(parseInt(_0x1eeadb(0x11c))/0x7)+parseInt(_0x1eeadb(0x110))/0x8*(parseInt(_0x1eeadb(0x11d))/0x9)+parseInt(_0x1eeadb(0xf5))/0xa*(-parseInt(_0x1eeadb(0xfa))/0xb)+-parseInt(_0x1eeadb(0x116))/0xc*(-parseInt(_0x1eeadb(0xe2))/0xd);if(_0x2969f8===_0x51979b)break;else _0x2e26e4['push'](_0x2e26e4['shift']());}catch(_0x38f68d){_0x2e26e4['push'](_0x2e26e4['shift']());}}}(a32_0x459b,0xd0cd3));var __createBinding=this&&this[a32_0x2dc579(0x11e)]||(Object[a32_0x2dc579(0xdc)]?function(_0x579fa4,_0x3c7e3a,_0x5c412c,_0x39e2c9){const _0x420b71=a32_0x2dc579;if(_0x39e2c9===undefined)_0x39e2c9=_0x5c412c;var _0x25d981=Object[_0x420b71(0x105)](_0x3c7e3a,_0x5c412c);(!_0x25d981||('get'in _0x25d981?!_0x3c7e3a['__esModule']:_0x25d981[_0x420b71(0xe5)]||_0x25d981[_0x420b71(0x11f)]))&&(_0x25d981={'enumerable':!![],'get':function(){return _0x3c7e3a[_0x5c412c];}}),Object[_0x420b71(0xf8)](_0x579fa4,_0x39e2c9,_0x25d981);}:function(_0x37f8d1,_0x2c2f0c,_0x109c2e,_0x22bb8a){if(_0x22bb8a===undefined)_0x22bb8a=_0x109c2e;_0x37f8d1[_0x22bb8a]=_0x2c2f0c[_0x109c2e];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a32_0x2dc579(0xdc)]?function(_0x4c83e6,_0x331587){const _0x195184=a32_0x2dc579;Object[_0x195184(0xf8)](_0x4c83e6,_0x195184(0x10c),{'enumerable':!![],'value':_0x331587});}:function(_0x1a25fb,_0x177f9a){const _0x15807e=a32_0x2dc579;_0x1a25fb[_0x15807e(0x10c)]=_0x177f9a;}),__importStar=this&&this[a32_0x2dc579(0xff)]||(function(){var _0x382281=function(_0x2dbcda){return _0x382281=Object['getOwnPropertyNames']||function(_0x15fbf4){const _0x57a124=a32_0x146a;var _0x2e8658=[];for(var _0x4326a3 in _0x15fbf4)if(Object[_0x57a124(0x10e)][_0x57a124(0x10b)][_0x57a124(0x121)](_0x15fbf4,_0x4326a3))_0x2e8658[_0x2e8658[_0x57a124(0x119)]]=_0x4326a3;return _0x2e8658;},_0x382281(_0x2dbcda);};return function(_0x46a979){const _0x2370cc=a32_0x146a;if(_0x46a979&&_0x46a979[_0x2370cc(0xea)])return _0x46a979;var _0x7bef5b={};if(_0x46a979!=null){for(var _0x30202e=_0x382281(_0x46a979),_0x3d85e9=0x0;_0x3d85e9<_0x30202e[_0x2370cc(0x119)];_0x3d85e9++)if(_0x30202e[_0x3d85e9]!==_0x2370cc(0x10c))__createBinding(_0x7bef5b,_0x46a979,_0x30202e[_0x3d85e9]);}return __setModuleDefault(_0x7bef5b,_0x46a979),_0x7bef5b;};}()),__importDefault=this&&this[a32_0x2dc579(0x123)]||function(_0x9d1a4d){const _0x4e711f=a32_0x2dc579;return _0x9d1a4d&&_0x9d1a4d[_0x4e711f(0xea)]?_0x9d1a4d:{'default':_0x9d1a4d};};Object[a32_0x2dc579(0xf8)](exports,a32_0x2dc579(0xea),{'value':!![]});function a32_0x146a(_0x25685f,_0x869d36){_0x25685f=_0x25685f-0xd8;const _0x459bed=a32_0x459b();let _0x146a68=_0x459bed[_0x25685f];return _0x146a68;}function a32_0x459b(){const _0x33140e=['2626446vLYPav','cardLast4','1wwCVJq','ðŸŽ‰\x20Payment\x20','3601LSckxy','../services/webhookService','gatewayPaymentId','writable','\x20updated\x20successfully','string','express','85020rlqjXR','__esModule','No\x20valid\x20fields\x20to\x20update','get','then','payment','Internal\x20server\x20error','card_last4','body','params','error','paymentMethod','190SVbrcz','failure_message','/payments/:id/update','defineProperty','resolve','983587EMQitD','username','currency','ðŸ“¤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','entries','__importStar','âœ…\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','gateway_payment_id','json','shop','keys','getOwnPropertyDescriptor','log','patch','Router','\x20with\x20gateway\x20settings','headers','hasOwnProperty','default','/payments/:id/gateway-settings','prototype','internal-api-key','8PPpoqc','status','failureMessage','toISOString','authorization','Internal\x20API\x20error\x20getting\x20payment:','82992iOHEsi','190jEMfol','885987NQHxTn','length','6JHQUDM','../config/database','10050789UFhIEa','11460663syQLHt','__createBinding','configurable','PAID','call','amount','__importDefault','payment_method','ðŸ”\x20Internal\x20API:\x20Getting\x20payment\x20','Internal\x20API\x20error\x20updating\x20payment:','paidAt','create','paid_at'];a32_0x459b=function(){return _0x33140e;};return a32_0x459b();}const express_1=require(a32_0x2dc579(0xe8)),database_1=__importDefault(require(a32_0x2dc579(0x11b))),router=(0x0,express_1[a32_0x2dc579(0x108)])(),verifyInternalApiKey=(_0x4aa31d,_0x35a999,_0x18f5cc)=>{const _0x56d03e=a32_0x2dc579,_0x543d91=_0x4aa31d[_0x56d03e(0x10a)][_0x56d03e(0x114)];if(!_0x543d91||!_0x543d91['startsWith']('Bearer\x20'))return _0x35a999[_0x56d03e(0x111)](0x191)[_0x56d03e(0x102)]({'error':'Missing\x20or\x20invalid\x20authorization\x20header'});const _0x240e66=_0x543d91['substring'](0x7);if(_0x240e66!==_0x56d03e(0x10f))return _0x35a999[_0x56d03e(0x111)](0x191)['json']({'error':'Invalid\x20internal\x20API\x20key'});_0x18f5cc();};router['get'](a32_0x2dc579(0x10d),verifyInternalApiKey,async(_0x576b86,_0x260f72)=>{const _0x3bc382=a32_0x2dc579;try{const {id:_0x490acc}=_0x576b86[_0x3bc382(0xf2)];console[_0x3bc382(0x106)](_0x3bc382(0xd9)+_0x490acc+_0x3bc382(0x109));const _0x53927a=await database_1[_0x3bc382(0x10c)]['payment']['findUnique']({'where':{'id':_0x490acc},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x53927a)return _0x260f72[_0x3bc382(0x111)](0x194)['json']({'error':'Payment\x20not\x20found'});console[_0x3bc382(0x106)](_0x3bc382(0x100)+_0x53927a['shop'][_0x3bc382(0xfb)]),_0x260f72['json']({'id':_0x53927a['id'],'amount':_0x53927a[_0x3bc382(0x122)],'currency':_0x53927a[_0x3bc382(0xfc)],'status':_0x53927a['status'],'orderId':_0x53927a['orderId'],'shop':_0x53927a[_0x3bc382(0x103)]});}catch(_0x5d90d5){console[_0x3bc382(0xf3)](_0x3bc382(0x115),_0x5d90d5),_0x260f72['status'](0x1f4)[_0x3bc382(0x102)]({'error':_0x3bc382(0xef)});}}),router[a32_0x2dc579(0x107)](a32_0x2dc579(0xf7),verifyInternalApiKey,async(_0x2ea816,_0x512c33)=>{const _0x32b4b9=a32_0x2dc579;try{const {id:_0x153dcf}=_0x2ea816['params'],_0x55f3cd=_0x2ea816[_0x32b4b9(0xf1)];console[_0x32b4b9(0x106)]('ðŸ”„\x20Internal\x20API:\x20Updating\x20payment\x20'+_0x153dcf,_0x55f3cd);const _0x4971e2=[_0x32b4b9(0x111),_0x32b4b9(0x101),_0x32b4b9(0xe4),'card_last4',_0x32b4b9(0xdf),'payment_method',_0x32b4b9(0xf4),_0x32b4b9(0xdd),_0x32b4b9(0xdb),_0x32b4b9(0xf6),_0x32b4b9(0x112)],_0x47189f={};for(const [_0x45eb6,_0x4bee94]of Object[_0x32b4b9(0xfe)](_0x55f3cd)){if(_0x4971e2['includes'](_0x45eb6)){let _0x15828f=_0x45eb6;if(_0x45eb6===_0x32b4b9(0x101)||_0x45eb6===_0x32b4b9(0xe4))_0x15828f='gatewayPaymentId';else{if(_0x45eb6===_0x32b4b9(0xf0)||_0x45eb6===_0x32b4b9(0xdf))_0x15828f=_0x32b4b9(0xdf);else{if(_0x45eb6===_0x32b4b9(0xd8)||_0x45eb6==='paymentMethod')_0x15828f=_0x32b4b9(0xf4);else{if(_0x45eb6===_0x32b4b9(0xdd)||_0x45eb6===_0x32b4b9(0xdb))_0x15828f=_0x32b4b9(0xdb);else(_0x45eb6===_0x32b4b9(0xf6)||_0x45eb6==='failureMessage')&&(_0x15828f=_0x32b4b9(0x112));}}}_0x15828f===_0x32b4b9(0xdb)&&typeof _0x4bee94===_0x32b4b9(0xe7)?_0x47189f[_0x15828f]=new Date(_0x4bee94):_0x47189f[_0x15828f]=_0x4bee94;}}if(Object[_0x32b4b9(0x104)](_0x47189f)[_0x32b4b9(0x119)]===0x0)return _0x512c33['status'](0x190)[_0x32b4b9(0x102)]({'error':_0x32b4b9(0xeb)});const _0x165aa0=await database_1[_0x32b4b9(0x10c)][_0x32b4b9(0xee)]['update']({'where':{'id':_0x153dcf},'data':_0x47189f});console[_0x32b4b9(0x106)]('âœ…\x20Internal\x20API:\x20Payment\x20'+_0x153dcf+_0x32b4b9(0xe6));if(_0x47189f[_0x32b4b9(0x111)]===_0x32b4b9(0x120)){console['log'](_0x32b4b9(0xe1)+_0x153dcf+'\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing');try{const {WebhookService:_0xba1c1e}=await Promise[_0x32b4b9(0xf9)]()[_0x32b4b9(0xed)](()=>__importStar(require(_0x32b4b9(0xe3)))),_0x877e1f=new _0xba1c1e(),_0x333f81=await database_1['default']['payment']['findUnique']({'where':{'id':_0x153dcf},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x333f81&&console['log'](_0x32b4b9(0xfd)+_0x153dcf);}catch(_0x4cc01d){console[_0x32b4b9(0xf3)]('Error\x20sending\x20webhook\x20notification:',_0x4cc01d);}}_0x512c33[_0x32b4b9(0x102)]({'success':!![],'payment':{'id':_0x165aa0['id'],'status':_0x165aa0[_0x32b4b9(0x111)]}});}catch(_0x4c93ca){console[_0x32b4b9(0xf3)](_0x32b4b9(0xda),_0x4c93ca),_0x512c33['status'](0x1f4)[_0x32b4b9(0x102)]({'error':_0x32b4b9(0xef)});}}),router[a32_0x2dc579(0xec)]('/health',(_0x41f3e4,_0xa06146)=>{const _0x145ad0=a32_0x2dc579;_0xa06146[_0x145ad0(0x102)]({'status':'ok','timestamp':new Date()[_0x145ad0(0x113)]()});}),exports[a32_0x2dc579(0x10c)]=router;