'use strict';const a25_0x1443d3=a25_0x88c6;function a25_0x88c6(_0x59bce7,_0x587fad){const _0x349a38=a25_0x349a();return a25_0x88c6=function(_0x88c633,_0x5ef092){_0x88c633=_0x88c633-0x18a;let _0x17b3a1=_0x349a38[_0x88c633];return _0x17b3a1;},a25_0x88c6(_0x59bce7,_0x587fad);}(function(_0x5a2919,_0x2b5de6){const _0x2bb093=a25_0x88c6,_0x5ca75d=_0x5a2919();while(!![]){try{const _0x21f24a=parseInt(_0x2bb093(0x1be))/0x1*(parseInt(_0x2bb093(0x1ab))/0x2)+-parseInt(_0x2bb093(0x199))/0x3+-parseInt(_0x2bb093(0x1a9))/0x4*(parseInt(_0x2bb093(0x1bc))/0x5)+-parseInt(_0x2bb093(0x1b2))/0x6*(-parseInt(_0x2bb093(0x196))/0x7)+parseInt(_0x2bb093(0x1ac))/0x8*(-parseInt(_0x2bb093(0x1a7))/0x9)+-parseInt(_0x2bb093(0x1a4))/0xa*(-parseInt(_0x2bb093(0x194))/0xb)+parseInt(_0x2bb093(0x1bd))/0xc;if(_0x21f24a===_0x2b5de6)break;else _0x5ca75d['push'](_0x5ca75d['shift']());}catch(_0x28f60f){_0x5ca75d['push'](_0x5ca75d['shift']());}}}(a25_0x349a,0x39b9f));var __importDefault=this&&this[a25_0x1443d3(0x1c5)]||function(_0x5fbed3){return _0x5fbed3&&_0x5fbed3['__esModule']?_0x5fbed3:{'default':_0x5fbed3};};function a25_0x349a(){const _0x8a9f4d=['payment_method','6jBlwTA','Internal\x20server\x20error','username','status','toUpperCase','paid_at','Invalid\x20internal\x20API\x20key','headers','body','log','47155xDetLY','4126188QIPEjU','1202cVaoGD','defineProperty','length','shop','🎉\x20Payment\x20','amount','authorization','__importDefault','Internal\x20API\x20error\x20getting\x20payment:','No\x20valid\x20fields\x20to\x20update','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','default','Router','\x20with\x20gateway\x20settings','get','toISOString','findUnique','🔄\x20Internal\x20API:\x20Updating\x20payment\x20','json','308tmydPO','substring','612983ZIWiFy','../config/database','Missing\x20or\x20invalid\x20authorization\x20header','791568crLXtE','gateway_payment_id','express','🔍\x20Internal\x20API:\x20Getting\x20payment\x20','\x20updated\x20successfully','params','Payment\x20not\x20found','Internal\x20API\x20error\x20updating\x20payment:','/health','PAID','✅\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','70090ziryaC','includes','entries','315828qsNVOW','payment','84VDCGGw','gateway_response','176jXouWr','8iuUWry','replace','patch','string','currency'];a25_0x349a=function(){return _0x8a9f4d;};return a25_0x349a();}Object[a25_0x1443d3(0x1bf)](exports,'__esModule',{'value':!![]});const express_1=require(a25_0x1443d3(0x19b)),database_1=__importDefault(require(a25_0x1443d3(0x197))),router=(0x0,express_1[a25_0x1443d3(0x18d)])(),verifyInternalApiKey=(_0x1bea54,_0x2b8ebb,_0x34d609)=>{const _0x596e8e=a25_0x1443d3,_0x74ce1a=_0x1bea54[_0x596e8e(0x1b9)][_0x596e8e(0x1c4)];if(!_0x74ce1a||!_0x74ce1a['startsWith']('Bearer\x20'))return _0x2b8ebb[_0x596e8e(0x1b5)](0x191)[_0x596e8e(0x193)]({'error':_0x596e8e(0x198)});const _0x55f05f=_0x74ce1a[_0x596e8e(0x195)](0x7);if(_0x55f05f!=='internal-api-key')return _0x2b8ebb[_0x596e8e(0x1b5)](0x191)[_0x596e8e(0x193)]({'error':_0x596e8e(0x1b8)});_0x34d609();};router[a25_0x1443d3(0x18f)]('/payments/:id/gateway-settings',verifyInternalApiKey,async(_0x2dd830,_0x5e02ab)=>{const _0x4219b1=a25_0x1443d3;try{const {id:_0x166b69}=_0x2dd830[_0x4219b1(0x19e)];console[_0x4219b1(0x1bb)](_0x4219b1(0x19c)+_0x166b69+_0x4219b1(0x18e));const _0x258eab=await database_1[_0x4219b1(0x18c)][_0x4219b1(0x1a8)][_0x4219b1(0x191)]({'where':{'id':_0x166b69},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x258eab)return _0x5e02ab[_0x4219b1(0x1b5)](0x194)['json']({'error':_0x4219b1(0x19f)});console[_0x4219b1(0x1bb)](_0x4219b1(0x1a3)+_0x258eab['shop'][_0x4219b1(0x1b4)]),_0x5e02ab[_0x4219b1(0x193)]({'id':_0x258eab['id'],'amount':_0x258eab[_0x4219b1(0x1c3)],'currency':_0x258eab[_0x4219b1(0x1b0)],'status':_0x258eab['status'],'orderId':_0x258eab['orderId'],'shop':_0x258eab[_0x4219b1(0x1c1)]});}catch(_0x302d80){console['error'](_0x4219b1(0x1c6),_0x302d80),_0x5e02ab['status'](0x1f4)[_0x4219b1(0x193)]({'error':_0x4219b1(0x1b3)});}}),router[a25_0x1443d3(0x1ae)]('/payments/:id/update',verifyInternalApiKey,async(_0x5275f3,_0x5f0c76)=>{const _0x296137=a25_0x1443d3;try{const {id:_0x481060}=_0x5275f3[_0x296137(0x19e)],_0x245b96=_0x5275f3[_0x296137(0x1ba)];console[_0x296137(0x1bb)](_0x296137(0x192)+_0x481060,_0x245b96);const _0x1eda2d=['status',_0x296137(0x19a),'card_last4',_0x296137(0x1b1),_0x296137(0x1b7),_0x296137(0x1aa),'failure_message'],_0xda4710={};for(const [_0x5c4c5c,_0x5b6f7c]of Object[_0x296137(0x1a6)](_0x245b96)){if(_0x1eda2d[_0x296137(0x1a5)](_0x5c4c5c)){const _0x55c062=_0x5c4c5c[_0x296137(0x1ad)](/_([a-z])/g,(_0x4fd705,_0x3d9f8b)=>_0x3d9f8b[_0x296137(0x1b6)]());_0x55c062==='paidAt'&&typeof _0x5b6f7c===_0x296137(0x1af)?_0xda4710[_0x55c062]=new Date(_0x5b6f7c):_0xda4710[_0x55c062]=_0x5b6f7c;}}if(Object['keys'](_0xda4710)[_0x296137(0x1c0)]===0x0)return _0x5f0c76['status'](0x190)[_0x296137(0x193)]({'error':_0x296137(0x18a)});const _0x3d4ada=await database_1['default'][_0x296137(0x1a8)]['update']({'where':{'id':_0x481060},'data':_0xda4710});console[_0x296137(0x1bb)]('✅\x20Internal\x20API:\x20Payment\x20'+_0x481060+_0x296137(0x19d)),_0xda4710[_0x296137(0x1b5)]===_0x296137(0x1a2)&&console[_0x296137(0x1bb)](_0x296137(0x1c2)+_0x481060+_0x296137(0x18b)),_0x5f0c76[_0x296137(0x193)]({'success':!![],'payment':{'id':_0x3d4ada['id'],'status':_0x3d4ada['status']}});}catch(_0x2d37f7){console['error'](_0x296137(0x1a0),_0x2d37f7),_0x5f0c76[_0x296137(0x1b5)](0x1f4)[_0x296137(0x193)]({'error':_0x296137(0x1b3)});}}),router['get'](a25_0x1443d3(0x1a1),(_0x5ac95e,_0x351562)=>{const _0x46bfa6=a25_0x1443d3;_0x351562[_0x46bfa6(0x193)]({'status':'ok','timestamp':new Date()[_0x46bfa6(0x190)]()});}),exports[a25_0x1443d3(0x18c)]=router;