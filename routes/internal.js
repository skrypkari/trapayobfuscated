'use strict';const a25_0x163fe=a25_0x293e;(function(_0x4275c9,_0x2bb289){const _0x483140=a25_0x293e,_0x2d9c68=_0x4275c9();while(!![]){try{const _0x14e139=-parseInt(_0x483140(0x207))/0x1+parseInt(_0x483140(0x1e9))/0x2+parseInt(_0x483140(0x205))/0x3+parseInt(_0x483140(0x208))/0x4*(-parseInt(_0x483140(0x1d9))/0x5)+parseInt(_0x483140(0x1ce))/0x6*(-parseInt(_0x483140(0x202))/0x7)+-parseInt(_0x483140(0x210))/0x8+-parseInt(_0x483140(0x1d7))/0x9*(-parseInt(_0x483140(0x1fe))/0xa);if(_0x14e139===_0x2bb289)break;else _0x2d9c68['push'](_0x2d9c68['shift']());}catch(_0x6853b6){_0x2d9c68['push'](_0x2d9c68['shift']());}}}(a25_0x22ad,0xee4d5));var __importDefault=this&&this[a25_0x163fe(0x1e4)]||function(_0x1acf55){const _0x437207=a25_0x163fe;return _0x1acf55&&_0x1acf55[_0x437207(0x20e)]?_0x1acf55:{'default':_0x1acf55};};Object[a25_0x163fe(0x1ed)](exports,a25_0x163fe(0x20e),{'value':!![]});const express_1=require(a25_0x163fe(0x1de)),database_1=__importDefault(require(a25_0x163fe(0x1e2))),router=(0x0,express_1[a25_0x163fe(0x1f3)])(),verifyInternalApiKey=(_0x5152e5,_0x47f90e,_0x568906)=>{const _0x2fef1f=a25_0x163fe,_0x44055d=_0x5152e5[_0x2fef1f(0x200)][_0x2fef1f(0x1d1)];if(!_0x44055d||!_0x44055d['startsWith'](_0x2fef1f(0x1da)))return _0x47f90e[_0x2fef1f(0x1e3)](0x191)[_0x2fef1f(0x1cf)]({'error':_0x2fef1f(0x20f)});const _0x54febd=_0x44055d[_0x2fef1f(0x1f1)](0x7);if(_0x54febd!=='internal-api-key')return _0x47f90e[_0x2fef1f(0x1e3)](0x191)['json']({'error':'Invalid\x20internal\x20API\x20key'});_0x568906();};function a25_0x293e(_0x4867aa,_0x4707ce){const _0x22ade9=a25_0x22ad();return a25_0x293e=function(_0x293e7c,_0x9a84f8){_0x293e7c=_0x293e7c-0x1ce;let _0x42f3dd=_0x22ade9[_0x293e7c];return _0x42f3dd;},a25_0x293e(_0x4867aa,_0x4707ce);}function a25_0x22ad(){const _0x2ac62d=['defineProperty','payment','Payment\x20not\x20found','orderId','substring','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','Router','keys','shop','gateway_payment_id','🎉\x20Payment\x20','patch','✅\x20Internal\x20API:\x20Payment\x20','username','update','default','✅\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','990TiHsRw','/payments/:id/gateway-settings','headers','/health','1022iHGiYr','PAID','paid_at','2109060RoQITw','card_last4','1357106CAZAsE','121136WKcigX','toUpperCase','failure_message','log','replace','body','__esModule','Missing\x20or\x20invalid\x20authorization\x20header','11656720iMVtgq','36462REmVQv','json','toISOString','authorization','payment_method','params','entries','Internal\x20server\x20error','error','403119EaPPPQ','🔄\x20Internal\x20API:\x20Updating\x20payment\x20','260kHZgfv','Bearer\x20','\x20updated\x20successfully','get','Internal\x20API\x20error\x20updating\x20payment:','express','No\x20valid\x20fields\x20to\x20update','paidAt','includes','../config/database','status','__importDefault','\x20with\x20gateway\x20settings','Internal\x20API\x20error\x20getting\x20payment:','/payments/:id/update','findUnique','2229924GCYyFa','gateway_response','string','currency'];a25_0x22ad=function(){return _0x2ac62d;};return a25_0x22ad();}router[a25_0x163fe(0x1dc)](a25_0x163fe(0x1ff),verifyInternalApiKey,async(_0x3cb754,_0x3eb1bb)=>{const _0x51f0cb=a25_0x163fe;try{const {id:_0x51430b}=_0x3cb754[_0x51f0cb(0x1d3)];console[_0x51f0cb(0x20b)]('🔍\x20Internal\x20API:\x20Getting\x20payment\x20'+_0x51430b+_0x51f0cb(0x1e5));const _0x11387e=await database_1[_0x51f0cb(0x1fc)][_0x51f0cb(0x1ee)][_0x51f0cb(0x1e8)]({'where':{'id':_0x51430b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x11387e)return _0x3eb1bb[_0x51f0cb(0x1e3)](0x194)['json']({'error':_0x51f0cb(0x1ef)});console[_0x51f0cb(0x20b)](_0x51f0cb(0x1fd)+_0x11387e['shop'][_0x51f0cb(0x1fa)]),_0x3eb1bb[_0x51f0cb(0x1cf)]({'id':_0x11387e['id'],'amount':_0x11387e['amount'],'currency':_0x11387e[_0x51f0cb(0x1ec)],'status':_0x11387e[_0x51f0cb(0x1e3)],'orderId':_0x11387e[_0x51f0cb(0x1f0)],'shop':_0x11387e[_0x51f0cb(0x1f5)]});}catch(_0x9a47ab){console[_0x51f0cb(0x1d6)](_0x51f0cb(0x1e6),_0x9a47ab),_0x3eb1bb[_0x51f0cb(0x1e3)](0x1f4)[_0x51f0cb(0x1cf)]({'error':_0x51f0cb(0x1d5)});}}),router[a25_0x163fe(0x1f8)](a25_0x163fe(0x1e7),verifyInternalApiKey,async(_0xd2e752,_0x2a14ab)=>{const _0x34c4fe=a25_0x163fe;try{const {id:_0x1a5c4b}=_0xd2e752[_0x34c4fe(0x1d3)],_0x243448=_0xd2e752[_0x34c4fe(0x20d)];console[_0x34c4fe(0x20b)](_0x34c4fe(0x1d8)+_0x1a5c4b,_0x243448);const _0xe8f066=['status',_0x34c4fe(0x1f6),_0x34c4fe(0x206),_0x34c4fe(0x1d2),_0x34c4fe(0x204),_0x34c4fe(0x1ea),_0x34c4fe(0x20a)],_0x580a46={};for(const [_0x356eb2,_0x39eecf]of Object[_0x34c4fe(0x1d4)](_0x243448)){if(_0xe8f066[_0x34c4fe(0x1e1)](_0x356eb2)){const _0x563e98=_0x356eb2[_0x34c4fe(0x20c)](/_([a-z])/g,(_0x514a92,_0x59aa04)=>_0x59aa04[_0x34c4fe(0x209)]());_0x563e98===_0x34c4fe(0x1e0)&&typeof _0x39eecf===_0x34c4fe(0x1eb)?_0x580a46[_0x563e98]=new Date(_0x39eecf):_0x580a46[_0x563e98]=_0x39eecf;}}if(Object[_0x34c4fe(0x1f4)](_0x580a46)['length']===0x0)return _0x2a14ab[_0x34c4fe(0x1e3)](0x190)[_0x34c4fe(0x1cf)]({'error':_0x34c4fe(0x1df)});const _0x1f0946=await database_1['default']['payment'][_0x34c4fe(0x1fb)]({'where':{'id':_0x1a5c4b},'data':_0x580a46});console['log'](_0x34c4fe(0x1f9)+_0x1a5c4b+_0x34c4fe(0x1db)),_0x580a46['status']===_0x34c4fe(0x203)&&console[_0x34c4fe(0x20b)](_0x34c4fe(0x1f7)+_0x1a5c4b+_0x34c4fe(0x1f2)),_0x2a14ab[_0x34c4fe(0x1cf)]({'success':!![],'payment':{'id':_0x1f0946['id'],'status':_0x1f0946[_0x34c4fe(0x1e3)]}});}catch(_0x1610ba){console[_0x34c4fe(0x1d6)](_0x34c4fe(0x1dd),_0x1610ba),_0x2a14ab['status'](0x1f4)[_0x34c4fe(0x1cf)]({'error':_0x34c4fe(0x1d5)});}}),router[a25_0x163fe(0x1dc)](a25_0x163fe(0x201),(_0x28b9b1,_0x4e9713)=>{const _0x2014f1=a25_0x163fe;_0x4e9713['json']({'status':'ok','timestamp':new Date()[_0x2014f1(0x1d0)]()});}),exports[a25_0x163fe(0x1fc)]=router;