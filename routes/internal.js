'use strict';const a35_0x5b0e55=a35_0x236d;(function(_0x2f9919,_0x5e3363){const _0x5c4149=a35_0x236d,_0x6e3735=_0x2f9919();while(!![]){try{const _0x772a9c=-parseInt(_0x5c4149(0xb9))/0x1*(parseInt(_0x5c4149(0xc1))/0x2)+-parseInt(_0x5c4149(0x94))/0x3+-parseInt(_0x5c4149(0xd5))/0x4*(-parseInt(_0x5c4149(0xb8))/0x5)+-parseInt(_0x5c4149(0x93))/0x6*(-parseInt(_0x5c4149(0xbc))/0x7)+parseInt(_0x5c4149(0xc9))/0x8+-parseInt(_0x5c4149(0x9f))/0x9*(-parseInt(_0x5c4149(0xb5))/0xa)+parseInt(_0x5c4149(0xd0))/0xb*(-parseInt(_0x5c4149(0xc0))/0xc);if(_0x772a9c===_0x5e3363)break;else _0x6e3735['push'](_0x6e3735['shift']());}catch(_0x593a9e){_0x6e3735['push'](_0x6e3735['shift']());}}}(a35_0x1ae3,0x62587));function a35_0x1ae3(){const _0x3ad4de=['card_last4','Internal\x20server\x20error','48NtgeAR','shop','__createBinding','paymentMethod','get','Internal\x20API\x20error\x20getting\x20payment:','üéâ\x20Payment\x20','__importDefault','status','substring','60GTUOnp','583704juTuuF','orderId','Payment\x20not\x20found','defineProperty','../services/webhookService','prototype','amount','json','__esModule','‚úÖ\x20Internal\x20API:\x20Payment\x20','gatewayPaymentId','1160550NsJhwf','create','paid_at','Router','default','call','/health','getOwnPropertyDescriptor','internal-api-key','gateway_payment_id','__setModuleDefault','authorization','payment_method','üì§\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','failure_message','keys','length','string','findUnique','PAID','patch','No\x20valid\x20fields\x20to\x20update','10BydhPS','\x20with\x20gateway\x20settings','toISOString','187375riQIpP','13JeTuNz','‚úÖ\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','failureMessage','41230AUekKZ','üîç\x20Internal\x20API:\x20Getting\x20payment\x20','cardLast4','entries','4908pnShHR','42934RKBVNn','Error\x20sending\x20webhook\x20notification:','configurable','error','update','currency','params','startsWith','5585752CQErEC','headers','writable','log','payment','paidAt','express','12353SOaMRv','includes','üîÑ\x20Internal\x20API:\x20Updating\x20payment\x20'];a35_0x1ae3=function(){return _0x3ad4de;};return a35_0x1ae3();}function a35_0x236d(_0x1dd6c0,_0x121725){_0x1dd6c0=_0x1dd6c0-0x8a;const _0x1ae36d=a35_0x1ae3();let _0x236dba=_0x1ae36d[_0x1dd6c0];return _0x236dba;}var __createBinding=this&&this[a35_0x5b0e55(0x8b)]||(Object['create']?function(_0x261a46,_0x24e697,_0x2380c5,_0x46f395){const _0x100dcd=a35_0x5b0e55;if(_0x46f395===undefined)_0x46f395=_0x2380c5;var _0x13a6d9=Object[_0x100dcd(0xa6)](_0x24e697,_0x2380c5);(!_0x13a6d9||('get'in _0x13a6d9?!_0x24e697[_0x100dcd(0x9c)]:_0x13a6d9[_0x100dcd(0xcb)]||_0x13a6d9[_0x100dcd(0xc3)]))&&(_0x13a6d9={'enumerable':!![],'get':function(){return _0x24e697[_0x2380c5];}}),Object[_0x100dcd(0x97)](_0x261a46,_0x46f395,_0x13a6d9);}:function(_0x40783c,_0x25debb,_0x39d203,_0x2e08e8){if(_0x2e08e8===undefined)_0x2e08e8=_0x39d203;_0x40783c[_0x2e08e8]=_0x25debb[_0x39d203];}),__setModuleDefault=this&&this[a35_0x5b0e55(0xa9)]||(Object[a35_0x5b0e55(0xa0)]?function(_0x341151,_0x192dca){const _0x110775=a35_0x5b0e55;Object['defineProperty'](_0x341151,_0x110775(0xa3),{'enumerable':!![],'value':_0x192dca});}:function(_0xa8f3fb,_0xe876c4){_0xa8f3fb['default']=_0xe876c4;}),__importStar=this&&this['__importStar']||(function(){var _0x41a534=function(_0x406818){return _0x41a534=Object['getOwnPropertyNames']||function(_0x7bb1af){const _0x35883a=a35_0x236d;var _0x1c45fc=[];for(var _0x1316a8 in _0x7bb1af)if(Object[_0x35883a(0x99)]['hasOwnProperty'][_0x35883a(0xa4)](_0x7bb1af,_0x1316a8))_0x1c45fc[_0x1c45fc['length']]=_0x1316a8;return _0x1c45fc;},_0x41a534(_0x406818);};return function(_0x3aa418){const _0x56ac84=a35_0x236d;if(_0x3aa418&&_0x3aa418['__esModule'])return _0x3aa418;var _0xeac617={};if(_0x3aa418!=null){for(var _0x4606d3=_0x41a534(_0x3aa418),_0x9c0798=0x0;_0x9c0798<_0x4606d3[_0x56ac84(0xaf)];_0x9c0798++)if(_0x4606d3[_0x9c0798]!==_0x56ac84(0xa3))__createBinding(_0xeac617,_0x3aa418,_0x4606d3[_0x9c0798]);}return __setModuleDefault(_0xeac617,_0x3aa418),_0xeac617;};}()),__importDefault=this&&this[a35_0x5b0e55(0x90)]||function(_0x188dbe){const _0x15c06f=a35_0x5b0e55;return _0x188dbe&&_0x188dbe[_0x15c06f(0x9c)]?_0x188dbe:{'default':_0x188dbe};};Object['defineProperty'](exports,a35_0x5b0e55(0x9c),{'value':!![]});const express_1=require(a35_0x5b0e55(0xcf)),database_1=__importDefault(require('../config/database')),router=(0x0,express_1[a35_0x5b0e55(0xa2)])(),verifyInternalApiKey=(_0xb6c033,_0x239a3c,_0xb22fd7)=>{const _0x114fdb=a35_0x5b0e55,_0x3d7025=_0xb6c033[_0x114fdb(0xca)][_0x114fdb(0xaa)];if(!_0x3d7025||!_0x3d7025[_0x114fdb(0xc8)]('Bearer\x20'))return _0x239a3c[_0x114fdb(0x91)](0x191)[_0x114fdb(0x9b)]({'error':'Missing\x20or\x20invalid\x20authorization\x20header'});const _0x2267f0=_0x3d7025[_0x114fdb(0x92)](0x7);if(_0x2267f0!==_0x114fdb(0xa7))return _0x239a3c[_0x114fdb(0x91)](0x191)[_0x114fdb(0x9b)]({'error':'Invalid\x20internal\x20API\x20key'});_0xb22fd7();};router[a35_0x5b0e55(0x8d)]('/payments/:id/gateway-settings',verifyInternalApiKey,async(_0x122f90,_0x46ffad)=>{const _0x280bb9=a35_0x5b0e55;try{const {id:_0x3fb69b}=_0x122f90[_0x280bb9(0xc7)];console[_0x280bb9(0xcc)](_0x280bb9(0xbd)+_0x3fb69b+_0x280bb9(0xb6));const _0x3f2a75=await database_1[_0x280bb9(0xa3)][_0x280bb9(0xcd)][_0x280bb9(0xb1)]({'where':{'id':_0x3fb69b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x3f2a75)return _0x46ffad[_0x280bb9(0x91)](0x194)[_0x280bb9(0x9b)]({'error':_0x280bb9(0x96)});console[_0x280bb9(0xcc)](_0x280bb9(0xba)+_0x3f2a75[_0x280bb9(0x8a)]['username']),_0x46ffad[_0x280bb9(0x9b)]({'id':_0x3f2a75['id'],'amount':_0x3f2a75[_0x280bb9(0x9a)],'currency':_0x3f2a75[_0x280bb9(0xc6)],'status':_0x3f2a75['status'],'orderId':_0x3f2a75[_0x280bb9(0x95)],'shop':_0x3f2a75[_0x280bb9(0x8a)]});}catch(_0x389f88){console[_0x280bb9(0xc4)](_0x280bb9(0x8e),_0x389f88),_0x46ffad[_0x280bb9(0x91)](0x1f4)[_0x280bb9(0x9b)]({'error':_0x280bb9(0xd4)});}}),router[a35_0x5b0e55(0xb3)]('/payments/:id/update',verifyInternalApiKey,async(_0x15a68e,_0x16de4b)=>{const _0x5c653b=a35_0x5b0e55;try{const {id:_0x591d17}=_0x15a68e[_0x5c653b(0xc7)],_0x3a92e0=_0x15a68e['body'];console['log'](_0x5c653b(0xd2)+_0x591d17,_0x3a92e0);const _0x30ab4e=[_0x5c653b(0x91),_0x5c653b(0xa8),_0x5c653b(0x9e),'card_last4',_0x5c653b(0xbe),_0x5c653b(0xab),'paymentMethod',_0x5c653b(0xa1),_0x5c653b(0xce),_0x5c653b(0xad),_0x5c653b(0xbb)],_0x2eaff4={};for(const [_0x26d1d4,_0x2b4d4f]of Object[_0x5c653b(0xbf)](_0x3a92e0)){if(_0x30ab4e[_0x5c653b(0xd1)](_0x26d1d4)){let _0x1fa74d=_0x26d1d4;if(_0x26d1d4===_0x5c653b(0xa8)||_0x26d1d4==='gatewayPaymentId')_0x1fa74d=_0x5c653b(0x9e);else{if(_0x26d1d4===_0x5c653b(0xd3)||_0x26d1d4===_0x5c653b(0xbe))_0x1fa74d=_0x5c653b(0xbe);else{if(_0x26d1d4===_0x5c653b(0xab)||_0x26d1d4===_0x5c653b(0x8c))_0x1fa74d=_0x5c653b(0x8c);else{if(_0x26d1d4===_0x5c653b(0xa1)||_0x26d1d4===_0x5c653b(0xce))_0x1fa74d='paidAt';else(_0x26d1d4===_0x5c653b(0xad)||_0x26d1d4===_0x5c653b(0xbb))&&(_0x1fa74d=_0x5c653b(0xbb));}}}_0x1fa74d===_0x5c653b(0xce)&&typeof _0x2b4d4f===_0x5c653b(0xb0)?_0x2eaff4[_0x1fa74d]=new Date(_0x2b4d4f):_0x2eaff4[_0x1fa74d]=_0x2b4d4f;}}if(Object[_0x5c653b(0xae)](_0x2eaff4)[_0x5c653b(0xaf)]===0x0)return _0x16de4b['status'](0x190)[_0x5c653b(0x9b)]({'error':_0x5c653b(0xb4)});const _0xd2a984=await database_1[_0x5c653b(0xa3)][_0x5c653b(0xcd)][_0x5c653b(0xc5)]({'where':{'id':_0x591d17},'data':_0x2eaff4});console[_0x5c653b(0xcc)](_0x5c653b(0x9d)+_0x591d17+'\x20updated\x20successfully');if(_0x2eaff4[_0x5c653b(0x91)]===_0x5c653b(0xb2)){console[_0x5c653b(0xcc)](_0x5c653b(0x8f)+_0x591d17+'\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing');try{const {WebhookService:_0x3443ac}=await Promise['resolve']()['then'](()=>__importStar(require(_0x5c653b(0x98)))),_0x39384d=new _0x3443ac(),_0x1f688e=await database_1[_0x5c653b(0xa3)][_0x5c653b(0xcd)][_0x5c653b(0xb1)]({'where':{'id':_0x591d17},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x1f688e&&console['log'](_0x5c653b(0xac)+_0x591d17);}catch(_0x377185){console[_0x5c653b(0xc4)](_0x5c653b(0xc2),_0x377185);}}_0x16de4b[_0x5c653b(0x9b)]({'success':!![],'payment':{'id':_0xd2a984['id'],'status':_0xd2a984[_0x5c653b(0x91)]}});}catch(_0x3d7a1e){console[_0x5c653b(0xc4)]('Internal\x20API\x20error\x20updating\x20payment:',_0x3d7a1e),_0x16de4b[_0x5c653b(0x91)](0x1f4)[_0x5c653b(0x9b)]({'error':_0x5c653b(0xd4)});}}),router[a35_0x5b0e55(0x8d)](a35_0x5b0e55(0xa5),(_0x3edf9f,_0x142972)=>{const _0x4d5cc9=a35_0x5b0e55;_0x142972['json']({'status':'ok','timestamp':new Date()[_0x4d5cc9(0xb7)]()});}),exports['default']=router;