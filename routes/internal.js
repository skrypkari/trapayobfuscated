'use strict';const a30_0x238777=a30_0x565f;function a30_0x565f(_0x33357f,_0x2fec23){_0x33357f=_0x33357f-0x173;const _0x207a6d=a30_0x207a();let _0x565fbd=_0x207a6d[_0x33357f];return _0x565fbd;}(function(_0x130079,_0x568d37){const _0x4d5a96=a30_0x565f,_0xc33729=_0x130079();while(!![]){try{const _0x1127b9=parseInt(_0x4d5a96(0x19b))/0x1*(parseInt(_0x4d5a96(0x18d))/0x2)+parseInt(_0x4d5a96(0x187))/0x3*(parseInt(_0x4d5a96(0x19f))/0x4)+-parseInt(_0x4d5a96(0x189))/0x5+-parseInt(_0x4d5a96(0x177))/0x6+-parseInt(_0x4d5a96(0x1ab))/0x7*(-parseInt(_0x4d5a96(0x19e))/0x8)+-parseInt(_0x4d5a96(0x18f))/0x9*(-parseInt(_0x4d5a96(0x1b0))/0xa)+-parseInt(_0x4d5a96(0x19c))/0xb*(parseInt(_0x4d5a96(0x179))/0xc);if(_0x1127b9===_0x568d37)break;else _0xc33729['push'](_0xc33729['shift']());}catch(_0x5be6d6){_0xc33729['push'](_0xc33729['shift']());}}}(a30_0x207a,0x58471));var __createBinding=this&&this[a30_0x238777(0x18a)]||(Object[a30_0x238777(0x175)]?function(_0x3cf024,_0x433f72,_0x523dc3,_0x113926){const _0x4bbe4a=a30_0x238777;if(_0x113926===undefined)_0x113926=_0x523dc3;var _0x579791=Object[_0x4bbe4a(0x176)](_0x433f72,_0x523dc3);(!_0x579791||(_0x4bbe4a(0x17d)in _0x579791?!_0x433f72[_0x4bbe4a(0x1b6)]:_0x579791['writable']||_0x579791[_0x4bbe4a(0x1be)]))&&(_0x579791={'enumerable':!![],'get':function(){return _0x433f72[_0x523dc3];}}),Object[_0x4bbe4a(0x1ae)](_0x3cf024,_0x113926,_0x579791);}:function(_0xbe7bb2,_0x32e88e,_0x269114,_0x1f563e){if(_0x1f563e===undefined)_0x1f563e=_0x269114;_0xbe7bb2[_0x1f563e]=_0x32e88e[_0x269114];}),__setModuleDefault=this&&this[a30_0x238777(0x173)]||(Object[a30_0x238777(0x175)]?function(_0xfe900e,_0x46d6c4){const _0x12e76b=a30_0x238777;Object['defineProperty'](_0xfe900e,_0x12e76b(0x195),{'enumerable':!![],'value':_0x46d6c4});}:function(_0x34bb02,_0x12aa2a){const _0xdfe9e9=a30_0x238777;_0x34bb02[_0xdfe9e9(0x195)]=_0x12aa2a;}),__importStar=this&&this[a30_0x238777(0x1af)]||(function(){var _0x169197=function(_0x41ac90){return _0x169197=Object['getOwnPropertyNames']||function(_0xb2265f){const _0x2c4062=a30_0x565f;var _0xd21627=[];for(var _0x59bbe1 in _0xb2265f)if(Object[_0x2c4062(0x1b9)]['hasOwnProperty']['call'](_0xb2265f,_0x59bbe1))_0xd21627[_0xd21627[_0x2c4062(0x1bd)]]=_0x59bbe1;return _0xd21627;},_0x169197(_0x41ac90);};return function(_0x2a37f7){const _0x39758f=a30_0x565f;if(_0x2a37f7&&_0x2a37f7[_0x39758f(0x1b6)])return _0x2a37f7;var _0x25953e={};if(_0x2a37f7!=null){for(var _0x446606=_0x169197(_0x2a37f7),_0x4a85d0=0x0;_0x4a85d0<_0x446606['length'];_0x4a85d0++)if(_0x446606[_0x4a85d0]!==_0x39758f(0x195))__createBinding(_0x25953e,_0x2a37f7,_0x446606[_0x4a85d0]);}return __setModuleDefault(_0x25953e,_0x2a37f7),_0x25953e;};}()),__importDefault=this&&this['__importDefault']||function(_0x109b0c){const _0x16e630=a30_0x238777;return _0x109b0c&&_0x109b0c[_0x16e630(0x1b6)]?_0x109b0c:{'default':_0x109b0c};};Object[a30_0x238777(0x1ae)](exports,a30_0x238777(0x1b6),{'value':!![]});function a30_0x207a(){const _0x19e6aa=['error','patch','ðŸ”„\x20Internal\x20API:\x20Updating\x20payment\x20','\x20marked\x20as\x20PAID,\x20triggering\x20webhook\x20processing','672kBHMEY','cardLast4','2519635RAFHIh','__createBinding','Router','log','20TwzvEK','currency','4872492vNtZJg','amount','gateway_payment_id','internal-api-key','../services/webhookService','../config/database','default','âœ…\x20Internal\x20API:\x20Payment\x20','paymentMethod','Invalid\x20internal\x20API\x20key','payment','ðŸ“¤\x20Sending\x20webhook\x20notification\x20to\x20merchant\x20for\x20payment\x20','10636ndWpQr','80498WFjoFR','startsWith','46792MyXLmV','4456OSeQFp','payment_method','findUnique','express','keys','PAID','entries','paid_at','failureMessage','includes','authorization','Missing\x20or\x20invalid\x20authorization\x20header','294ybFrMb','headers','ðŸŽ‰\x20Payment\x20','defineProperty','__importStar','10jsjDsH','orderId','\x20with\x20gateway\x20settings','Internal\x20server\x20error','json','update','__esModule','Bearer\x20','shop','prototype','username','No\x20valid\x20fields\x20to\x20update','failure_message','length','configurable','__setModuleDefault','/payments/:id/gateway-settings','create','getOwnPropertyDescriptor','1137684FePZrA','ðŸ”\x20Internal\x20API:\x20Getting\x20payment\x20','144kdyUhs','paidAt','gatewayPaymentId','\x20updated\x20successfully','get','substring','âœ…\x20Internal\x20API:\x20Payment\x20found\x20for\x20shop\x20','status','toISOString','card_last4'];a30_0x207a=function(){return _0x19e6aa;};return a30_0x207a();}const express_1=require(a30_0x238777(0x1a2)),database_1=__importDefault(require(a30_0x238777(0x194))),router=(0x0,express_1[a30_0x238777(0x18b)])(),verifyInternalApiKey=(_0x2b8c85,_0x25b9e6,_0x1d2bd7)=>{const _0x6dce3f=a30_0x238777,_0x5d5eba=_0x2b8c85[_0x6dce3f(0x1ac)][_0x6dce3f(0x1a9)];if(!_0x5d5eba||!_0x5d5eba[_0x6dce3f(0x19d)](_0x6dce3f(0x1b7)))return _0x25b9e6['status'](0x191)['json']({'error':_0x6dce3f(0x1aa)});const _0x2d2a97=_0x5d5eba[_0x6dce3f(0x17e)](0x7);if(_0x2d2a97!==_0x6dce3f(0x192))return _0x25b9e6['status'](0x191)['json']({'error':_0x6dce3f(0x198)});_0x1d2bd7();};router[a30_0x238777(0x17d)](a30_0x238777(0x174),verifyInternalApiKey,async(_0x5d5418,_0x359695)=>{const _0x16e166=a30_0x238777;try{const {id:_0x3fd63f}=_0x5d5418['params'];console[_0x16e166(0x18c)](_0x16e166(0x178)+_0x3fd63f+_0x16e166(0x1b2));const _0x57595f=await database_1[_0x16e166(0x195)][_0x16e166(0x199)][_0x16e166(0x1a1)]({'where':{'id':_0x3fd63f},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});if(!_0x57595f)return _0x359695[_0x16e166(0x180)](0x194)['json']({'error':'Payment\x20not\x20found'});console[_0x16e166(0x18c)](_0x16e166(0x17f)+_0x57595f[_0x16e166(0x1b8)][_0x16e166(0x1ba)]),_0x359695['json']({'id':_0x57595f['id'],'amount':_0x57595f[_0x16e166(0x190)],'currency':_0x57595f[_0x16e166(0x18e)],'status':_0x57595f[_0x16e166(0x180)],'orderId':_0x57595f[_0x16e166(0x1b1)],'shop':_0x57595f['shop']});}catch(_0x2facfb){console[_0x16e166(0x183)]('Internal\x20API\x20error\x20getting\x20payment:',_0x2facfb),_0x359695['status'](0x1f4)[_0x16e166(0x1b4)]({'error':_0x16e166(0x1b3)});}}),router[a30_0x238777(0x184)]('/payments/:id/update',verifyInternalApiKey,async(_0x5ec35a,_0x5436f1)=>{const _0x3693dd=a30_0x238777;try{const {id:_0x3c869c}=_0x5ec35a['params'],_0x2aee6=_0x5ec35a['body'];console['log'](_0x3693dd(0x185)+_0x3c869c,_0x2aee6);const _0x3ba25b=['status',_0x3693dd(0x191),'gatewayPaymentId',_0x3693dd(0x182),_0x3693dd(0x188),_0x3693dd(0x1a0),_0x3693dd(0x197),_0x3693dd(0x1a6),_0x3693dd(0x17a),_0x3693dd(0x1bc),_0x3693dd(0x1a7)],_0x4a87c4={};for(const [_0xfc5944,_0x10973e]of Object[_0x3693dd(0x1a5)](_0x2aee6)){if(_0x3ba25b[_0x3693dd(0x1a8)](_0xfc5944)){let _0x3f83a3=_0xfc5944;if(_0xfc5944===_0x3693dd(0x191)||_0xfc5944===_0x3693dd(0x17b))_0x3f83a3='gatewayPaymentId';else{if(_0xfc5944===_0x3693dd(0x182)||_0xfc5944===_0x3693dd(0x188))_0x3f83a3=_0x3693dd(0x188);else{if(_0xfc5944===_0x3693dd(0x1a0)||_0xfc5944===_0x3693dd(0x197))_0x3f83a3=_0x3693dd(0x197);else{if(_0xfc5944==='paid_at'||_0xfc5944===_0x3693dd(0x17a))_0x3f83a3=_0x3693dd(0x17a);else(_0xfc5944==='failure_message'||_0xfc5944==='failureMessage')&&(_0x3f83a3=_0x3693dd(0x1a7));}}}_0x3f83a3===_0x3693dd(0x17a)&&typeof _0x10973e==='string'?_0x4a87c4[_0x3f83a3]=new Date(_0x10973e):_0x4a87c4[_0x3f83a3]=_0x10973e;}}if(Object[_0x3693dd(0x1a3)](_0x4a87c4)[_0x3693dd(0x1bd)]===0x0)return _0x5436f1[_0x3693dd(0x180)](0x190)[_0x3693dd(0x1b4)]({'error':_0x3693dd(0x1bb)});const _0x26b83a=await database_1[_0x3693dd(0x195)][_0x3693dd(0x199)][_0x3693dd(0x1b5)]({'where':{'id':_0x3c869c},'data':_0x4a87c4});console[_0x3693dd(0x18c)](_0x3693dd(0x196)+_0x3c869c+_0x3693dd(0x17c));if(_0x4a87c4[_0x3693dd(0x180)]===_0x3693dd(0x1a4)){console['log'](_0x3693dd(0x1ad)+_0x3c869c+_0x3693dd(0x186));try{const {WebhookService:_0x57955b}=await Promise['resolve']()['then'](()=>__importStar(require(_0x3693dd(0x193)))),_0x4c1527=new _0x57955b(),_0x2e89aa=await database_1[_0x3693dd(0x195)]['payment'][_0x3693dd(0x1a1)]({'where':{'id':_0x3c869c},'include':{'shop':{'select':{'id':!![],'username':!![],'settings':!![]}}}});_0x2e89aa&&console[_0x3693dd(0x18c)](_0x3693dd(0x19a)+_0x3c869c);}catch(_0x2d99e1){console['error']('Error\x20sending\x20webhook\x20notification:',_0x2d99e1);}}_0x5436f1[_0x3693dd(0x1b4)]({'success':!![],'payment':{'id':_0x26b83a['id'],'status':_0x26b83a[_0x3693dd(0x180)]}});}catch(_0x3d567f){console[_0x3693dd(0x183)]('Internal\x20API\x20error\x20updating\x20payment:',_0x3d567f),_0x5436f1[_0x3693dd(0x180)](0x1f4)['json']({'error':_0x3693dd(0x1b3)});}}),router['get']('/health',(_0x3d1f39,_0x1d9f61)=>{const _0x513321=a30_0x238777;_0x1d9f61[_0x513321(0x1b4)]({'status':'ok','timestamp':new Date()[_0x513321(0x181)]()});}),exports['default']=router;