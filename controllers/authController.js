'use strict';const a5_0x46a4fa=a5_0x4399;(function(_0x1c543d,_0x9f7a3b){const _0x152363=a5_0x4399,_0x53ebbb=_0x1c543d();while(!![]){try{const _0x4b9ab9=-parseInt(_0x152363(0x1a2))/0x1*(parseInt(_0x152363(0x1d4))/0x2)+-parseInt(_0x152363(0x1db))/0x3+parseInt(_0x152363(0x1d9))/0x4+-parseInt(_0x152363(0x1ab))/0x5*(-parseInt(_0x152363(0x1dc))/0x6)+parseInt(_0x152363(0x1b6))/0x7+-parseInt(_0x152363(0x1bc))/0x8*(-parseInt(_0x152363(0x1dd))/0x9)+parseInt(_0x152363(0x1b4))/0xa;if(_0x4b9ab9===_0x9f7a3b)break;else _0x53ebbb['push'](_0x53ebbb['shift']());}catch(_0x5edc05){_0x53ebbb['push'](_0x53ebbb['shift']());}}}(a5_0x597d,0x20c91));var __createBinding=this&&this['__createBinding']||(Object[a5_0x46a4fa(0x1a9)]?function(_0x1ba7ed,_0x5a1341,_0x46e4b0,_0x5ee437){const _0x5363f6=a5_0x46a4fa;if(_0x5ee437===undefined)_0x5ee437=_0x46e4b0;var _0x4d46a8=Object[_0x5363f6(0x1d6)](_0x5a1341,_0x46e4b0);(!_0x4d46a8||(_0x5363f6(0x1a6)in _0x4d46a8?!_0x5a1341[_0x5363f6(0x1c7)]:_0x4d46a8[_0x5363f6(0x1c3)]||_0x4d46a8[_0x5363f6(0x1c0)]))&&(_0x4d46a8={'enumerable':!![],'get':function(){return _0x5a1341[_0x46e4b0];}}),Object[_0x5363f6(0x1d1)](_0x1ba7ed,_0x5ee437,_0x4d46a8);}:function(_0x14e464,_0x25dec0,_0x341b17,_0x30606a){if(_0x30606a===undefined)_0x30606a=_0x341b17;_0x14e464[_0x30606a]=_0x25dec0[_0x341b17];}),__setModuleDefault=this&&this[a5_0x46a4fa(0x1bf)]||(Object[a5_0x46a4fa(0x1a9)]?function(_0x98b046,_0x14dcb7){const _0x1ebe67=a5_0x46a4fa;Object[_0x1ebe67(0x1d1)](_0x98b046,_0x1ebe67(0x19f),{'enumerable':!![],'value':_0x14dcb7});}:function(_0x14b1f7,_0x36640c){const _0x2e4b96=a5_0x46a4fa;_0x14b1f7[_0x2e4b96(0x19f)]=_0x36640c;}),__importStar=this&&this['__importStar']||(function(){var _0x4b62a6=function(_0x314824){return _0x4b62a6=Object['getOwnPropertyNames']||function(_0x287d2b){const _0x116981=a5_0x4399;var _0x438441=[];for(var _0x39c331 in _0x287d2b)if(Object[_0x116981(0x1a7)]['hasOwnProperty'][_0x116981(0x1d2)](_0x287d2b,_0x39c331))_0x438441[_0x438441['length']]=_0x39c331;return _0x438441;},_0x4b62a6(_0x314824);};return function(_0x16c26b){const _0x2ac4e2=a5_0x4399;if(_0x16c26b&&_0x16c26b[_0x2ac4e2(0x1c7)])return _0x16c26b;var _0x313364={};if(_0x16c26b!=null){for(var _0x1ae408=_0x4b62a6(_0x16c26b),_0x1249de=0x0;_0x1249de<_0x1ae408[_0x2ac4e2(0x1d5)];_0x1249de++)if(_0x1ae408[_0x1249de]!==_0x2ac4e2(0x19f))__createBinding(_0x313364,_0x16c26b,_0x1ae408[_0x1249de]);}return __setModuleDefault(_0x313364,_0x16c26b),_0x313364;};}());function a5_0x597d(){const _0xc05c05=['application/json','sendLoginNotification','resolve','tokenBlacklistService','role','telegramBotService','defineProperty','call','setDate','6LGTruX','length','getOwnPropertyDescriptor','loginLog','logout','229624kYzCcA','country','722838lAGwan','6DScETF','886887QCPUoL','body','Failed\x20to\x20fetch\x20fingerprint\x20data:','../services/telegramBotService','string','getDate','default','anJngmXQVawz37L0S21u','../config/database','7867DZmogs','requestId\x20query\x20parameter\x20is\x20required','getBlacklistStats','ipInfo','get','prototype','findUnique','create','address','54630FBCTHX','../services/authService','ipAddress','error','shop','https://eu.api.fpjs.io/events/','status','data','geolocation','2016970HKafyN','then','211848jgqNmU','remoteAddress','user','token','getStats','blacklistToken','8hUZlIA','products','fingerprintRequestId','__setModuleDefault','configurable','unknown','authService','writable','login','getFingerprintInfo','json','__esModule','AuthController','userAgent','username'];a5_0x597d=function(){return _0xc05c05;};return a5_0x597d();}function a5_0x4399(_0x36ca2f,_0x3482e9){_0x36ca2f=_0x36ca2f-0x19e;const _0x597de7=a5_0x597d();let _0x4399da=_0x597de7[_0x36ca2f];return _0x4399da;}Object['defineProperty'](exports,a5_0x46a4fa(0x1c7),{'value':!![]}),exports['AuthController']=void 0x0;const authService_1=require(a5_0x46a4fa(0x1ac)),tokenBlacklistService_1=require('../services/tokenBlacklistService'),telegramBotService_1=require(a5_0x46a4fa(0x1e0));class AuthController{constructor(){const _0x177242=a5_0x46a4fa;this[_0x177242(0x1c4)]=async(_0x5571cd,_0xc2865d,_0x491dd6)=>{const _0x2d52ba=_0x177242;try{const _0x4ce832=_0x5571cd[_0x2d52ba(0x1de)],_0x590464=_0x4ce832[_0x2d52ba(0x1ad)]||_0x5571cd['ip']||_0x5571cd['connection'][_0x2d52ba(0x1b7)]||_0x2d52ba(0x1c1),_0x48333c=_0x4ce832[_0x2d52ba(0x1c9)]||_0x5571cd[_0x2d52ba(0x1a6)]('User-Agent')||_0x2d52ba(0x1c1),_0x51e7c6=_0x4ce832['geo'],_0x57806c=_0x4ce832[_0x2d52ba(0x1be)];let _0x30dedb=![],_0x35957a=null,_0x52942e=null;if(_0x57806c)try{const _0x1494b7=_0x2d52ba(0x1b0)+_0x57806c,_0x36fc5f=await fetch(_0x1494b7,{'method':'GET','headers':{'Content-Type':_0x2d52ba(0x1cb),'Auth-API-Key':_0x2d52ba(0x1a0)}});_0x36fc5f['ok']&&(_0x52942e=await _0x36fc5f[_0x2d52ba(0x1c6)]());}catch(_0xadc801){console[_0x2d52ba(0x1ae)](_0x2d52ba(0x1df),_0xadc801);}try{const _0x28909d=await this[_0x2d52ba(0x1c2)]['login'](_0x4ce832);_0x30dedb=!![];_0x28909d[_0x2d52ba(0x1cf)]===_0x2d52ba(0x1af)&&_0x28909d[_0x2d52ba(0x1b8)]?.['id']&&(_0x35957a=_0x28909d['user']['id']);if(_0x35957a){const _0x149f3e=(await Promise[_0x2d52ba(0x1cd)]()[_0x2d52ba(0x1b5)](()=>__importStar(require(_0x2d52ba(0x1a1)))))[_0x2d52ba(0x19f)],_0xdb4634=new Date(),_0x422a00=new Date(_0xdb4634);_0x422a00[_0x2d52ba(0x1d3)](_0x422a00[_0x2d52ba(0x19e)]()+0x16d),await _0x149f3e[_0x2d52ba(0x1d7)][_0x2d52ba(0x1a9)]({'data':{'shopId':_0x35957a,'username':_0x4ce832[_0x2d52ba(0x1ca)],'fingerprintRequestId':_0x57806c,'fingerprintData':_0x52942e,'ipAddress':_0x590464,'userAgent':_0x48333c,'geo':_0x51e7c6,'success':!![],'expiresAt':_0x422a00}}),await telegramBotService_1[_0x2d52ba(0x1d0)][_0x2d52ba(0x1cc)](_0x35957a,{'username':_0x4ce832[_0x2d52ba(0x1ca)],'ipAddress':_0x590464,'userAgent':_0x48333c,'geo':_0x51e7c6,'timestamp':new Date(),'success':!![]});}_0xc2865d[_0x2d52ba(0x1c6)]({'success':!![],'result':_0x28909d});}catch(_0x4ca210){try{const _0x5f4499=(await Promise[_0x2d52ba(0x1cd)]()[_0x2d52ba(0x1b5)](()=>__importStar(require(_0x2d52ba(0x1a1)))))[_0x2d52ba(0x19f)],_0x5ad4d3=await _0x5f4499[_0x2d52ba(0x1af)][_0x2d52ba(0x1a8)]({'where':{'username':_0x4ce832[_0x2d52ba(0x1ca)]},'select':{'id':!![]}});if(_0x5ad4d3){const _0x263e4a=new Date(),_0x388999=new Date(_0x263e4a);_0x388999[_0x2d52ba(0x1d3)](_0x388999['getDate']()+0x16d),await _0x5f4499['loginLog'][_0x2d52ba(0x1a9)]({'data':{'shopId':_0x5ad4d3['id'],'username':_0x4ce832[_0x2d52ba(0x1ca)],'fingerprintRequestId':_0x57806c,'fingerprintData':_0x52942e,'ipAddress':_0x590464,'userAgent':_0x48333c,'geo':_0x51e7c6,'success':![],'expiresAt':_0x388999}}),await telegramBotService_1[_0x2d52ba(0x1d0)]['sendLoginNotification'](_0x5ad4d3['id'],{'username':_0x4ce832[_0x2d52ba(0x1ca)],'ipAddress':_0x590464,'userAgent':_0x48333c,'geo':_0x51e7c6,'timestamp':new Date(),'success':![]});}}catch(_0x1791f7){console['error']('Failed\x20to\x20send\x20failed\x20login\x20notification:',_0x1791f7);}throw _0x4ca210;}}catch(_0x36559b){_0x491dd6(_0x36559b);}},this['me']=async(_0x3d421b,_0x3791c8,_0x57fec0)=>{const _0x825039=_0x177242;try{const _0x1da776=_0x3d421b[_0x825039(0x1b8)];_0x3791c8[_0x825039(0x1c6)]({'success':!![],'result':{'id':_0x1da776?.['id'],'username':_0x1da776?.[_0x825039(0x1ca)],'role':_0x1da776?.[_0x825039(0x1cf)]}});}catch(_0x97ada5){_0x57fec0(_0x97ada5);}},this[_0x177242(0x1d8)]=async(_0x59b0d7,_0x229b40,_0x125eb0)=>{const _0x356702=_0x177242;try{const _0x3bf5d8=_0x59b0d7[_0x356702(0x1b9)],_0x530ef5=_0x59b0d7[_0x356702(0x1b8)];_0x3bf5d8&&_0x530ef5?.['exp']&&tokenBlacklistService_1[_0x356702(0x1ce)][_0x356702(0x1bb)](_0x3bf5d8,_0x530ef5['exp']),_0x229b40['json']({'success':!![],'message':'Logged\x20out\x20successfully'});}catch(_0x1e64f5){_0x125eb0(_0x1e64f5);}},this[_0x177242(0x1a4)]=async(_0x27d46d,_0x2a1499,_0x1c40df)=>{const _0x2b946b=_0x177242;try{const _0x5d6bf5=tokenBlacklistService_1['tokenBlacklistService'][_0x2b946b(0x1ba)]();_0x2a1499[_0x2b946b(0x1c6)]({'success':!![],'result':_0x5d6bf5});}catch(_0x5ad3f8){_0x1c40df(_0x5ad3f8);}},this[_0x177242(0x1c5)]=async(_0x2e3c08,_0x2fa37d,_0x48d40c)=>{const _0x26988a=_0x177242;try{const {requestId:_0x58a5df}=_0x2e3c08['query'];if(typeof _0x58a5df!==_0x26988a(0x1e1))return _0x2fa37d[_0x26988a(0x1b1)](0x190)[_0x26988a(0x1c6)]({'success':![],'message':_0x26988a(0x1a3)});const _0x5298dd=_0x26988a(0x1b0)+_0x58a5df,_0x4da82a=await fetch(_0x5298dd,{'method':'GET','headers':{'Content-Type':_0x26988a(0x1cb),'Auth-API-Key':'anJngmXQVawz37L0S21u'}});if(!_0x4da82a['ok'])return _0x2fa37d['status'](_0x4da82a[_0x26988a(0x1b1)])[_0x26988a(0x1c6)]({'success':![],'message':'Failed\x20to\x20retrieve\x20fingerprint\x20data'});const _0x2710a8=await _0x4da82a[_0x26988a(0x1c6)](),_0x643d0f=_0x2710a8['products']?.[_0x26988a(0x1a5)]?.[_0x26988a(0x1b2)]?.['v4']?.[_0x26988a(0x1aa)]||_0x2710a8[_0x26988a(0x1bd)]?.[_0x26988a(0x1a5)]?.['data']?.['v6']?.[_0x26988a(0x1aa)]||'',_0x323a75=_0x2710a8[_0x26988a(0x1bd)]?.[_0x26988a(0x1a5)]?.['data']?.['v4']?.[_0x26988a(0x1b3)]?.[_0x26988a(0x1da)]?.['code']||_0x2710a8[_0x26988a(0x1bd)]?.[_0x26988a(0x1a5)]?.['data']?.['v6']?.[_0x26988a(0x1b3)]?.[_0x26988a(0x1da)]?.['code']||'';_0x2fa37d['json']({'success':!![],'result':{'ipAddress':_0x643d0f,'countryCode':_0x323a75}});}catch(_0xe5d6c6){_0x48d40c(_0xe5d6c6);}},this[_0x177242(0x1c2)]=new authService_1['AuthService']();}}exports[a5_0x46a4fa(0x1c8)]=AuthController;