'use strict';function a4_0x1f95(){const _0x27a7df=['body','authService','getOwnPropertyDescriptor','blacklistToken','tokenBlacklistService','__createBinding','remoteAddress','33eBUSGn','logout','../services/tokenBlacklistService','ACTIVE','prototype','../services/authService','217954rgJQwI','findUnique','username','unknown','getBlacklistStats','$disconnect','resolve','configurable','445838XMEdck','user','sendLoginNotification','writable','call','1994616KGizZn','7292736FhxDtx','error','1226916popUwv','then','defineProperty','connection','__importStar','Shop\x20not\x20found','token','create','316092mdFTBC','../config/database','@prisma/client','role','8bBLWKF','status','User-Agent','get','shop','default','login','2100485trlJRG','AuthService','json','Failed\x20to\x20send\x20failed\x20login\x20notification:','length','telegramBotService','SUSPENDED','AuthController','getAccountStatus','getStats','Shop\x20access\x20required','__esModule'];a4_0x1f95=function(){return _0x27a7df;};return a4_0x1f95();}const a4_0x1d3673=a4_0x30f9;function a4_0x30f9(_0xa1176c,_0x166e18){const _0x1f95f1=a4_0x1f95();return a4_0x30f9=function(_0x30f9c3,_0x41aaf5){_0x30f9c3=_0x30f9c3-0x1db;let _0x3c7c75=_0x1f95f1[_0x30f9c3];return _0x3c7c75;},a4_0x30f9(_0xa1176c,_0x166e18);}(function(_0x217cd0,_0xc5a9e3){const _0x435af8=a4_0x30f9,_0x1bbaf2=_0x217cd0();while(!![]){try{const _0x435b9d=parseInt(_0x435af8(0x1de))/0x1+-parseInt(_0x435af8(0x212))/0x2*(parseInt(_0x435af8(0x20c))/0x3)+parseInt(_0x435af8(0x1e3))/0x4+parseInt(_0x435af8(0x1f9))/0x5+-parseInt(_0x435af8(0x1e6))/0x6+-parseInt(_0x435af8(0x1ee))/0x7*(-parseInt(_0x435af8(0x1f2))/0x8)+parseInt(_0x435af8(0x1e4))/0x9;if(_0x435b9d===_0xc5a9e3)break;else _0x1bbaf2['push'](_0x1bbaf2['shift']());}catch(_0x15e8d7){_0x1bbaf2['push'](_0x1bbaf2['shift']());}}}(a4_0x1f95,0xc76b0));var __createBinding=this&&this[a4_0x1d3673(0x20a)]||(Object[a4_0x1d3673(0x1ed)]?function(_0x4f1938,_0x39c1bc,_0x3aeac2,_0x3665cb){const _0x583552=a4_0x1d3673;if(_0x3665cb===undefined)_0x3665cb=_0x3aeac2;var _0x535c1c=Object[_0x583552(0x207)](_0x39c1bc,_0x3aeac2);(!_0x535c1c||(_0x583552(0x1f5)in _0x535c1c?!_0x39c1bc['__esModule']:_0x535c1c[_0x583552(0x1e1)]||_0x535c1c[_0x583552(0x1dd)]))&&(_0x535c1c={'enumerable':!![],'get':function(){return _0x39c1bc[_0x3aeac2];}}),Object[_0x583552(0x1e8)](_0x4f1938,_0x3665cb,_0x535c1c);}:function(_0x52ac95,_0x3acad2,_0x160d60,_0x22ea12){if(_0x22ea12===undefined)_0x22ea12=_0x160d60;_0x52ac95[_0x22ea12]=_0x3acad2[_0x160d60];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a4_0x1d3673(0x1ed)]?function(_0x4cf03f,_0x461326){const _0x2d9c1b=a4_0x1d3673;Object[_0x2d9c1b(0x1e8)](_0x4cf03f,'default',{'enumerable':!![],'value':_0x461326});}:function(_0x5c0143,_0x21ab53){const _0x3ff7ee=a4_0x1d3673;_0x5c0143[_0x3ff7ee(0x1f7)]=_0x21ab53;}),__importStar=this&&this[a4_0x1d3673(0x1ea)]||(function(){var _0x198801=function(_0x17c200){return _0x198801=Object['getOwnPropertyNames']||function(_0x370d09){const _0x2ab9de=a4_0x30f9;var _0x149877=[];for(var _0x1b1e94 in _0x370d09)if(Object[_0x2ab9de(0x210)]['hasOwnProperty'][_0x2ab9de(0x1e2)](_0x370d09,_0x1b1e94))_0x149877[_0x149877[_0x2ab9de(0x1fd)]]=_0x1b1e94;return _0x149877;},_0x198801(_0x17c200);};return function(_0x2b37f3){const _0xee2fd7=a4_0x30f9;if(_0x2b37f3&&_0x2b37f3[_0xee2fd7(0x204)])return _0x2b37f3;var _0x45a808={};if(_0x2b37f3!=null){for(var _0x1205a4=_0x198801(_0x2b37f3),_0x4597c5=0x0;_0x4597c5<_0x1205a4[_0xee2fd7(0x1fd)];_0x4597c5++)if(_0x1205a4[_0x4597c5]!=='default')__createBinding(_0x45a808,_0x2b37f3,_0x1205a4[_0x4597c5]);}return __setModuleDefault(_0x45a808,_0x2b37f3),_0x45a808;};}());Object[a4_0x1d3673(0x1e8)](exports,'__esModule',{'value':!![]}),exports[a4_0x1d3673(0x200)]=void 0x0;const authService_1=require(a4_0x1d3673(0x211)),tokenBlacklistService_1=require(a4_0x1d3673(0x20e)),telegramBotService_1=require('../services/telegramBotService');class AuthController{constructor(){const _0x3acafe=a4_0x1d3673;this[_0x3acafe(0x1f8)]=async(_0x872a97,_0x2c5c37,_0x30b8ca)=>{const _0x5b6d72=_0x3acafe;try{const _0x4df11d=_0x872a97[_0x5b6d72(0x205)],_0x3c596d=_0x872a97['ip']||_0x872a97[_0x5b6d72(0x1e9)][_0x5b6d72(0x20b)]||_0x5b6d72(0x215),_0x3dce1a=_0x872a97[_0x5b6d72(0x1f5)](_0x5b6d72(0x1f4))||_0x5b6d72(0x215);let _0x142b28=![],_0x2045d3=null;try{const _0x474e92=await this[_0x5b6d72(0x206)][_0x5b6d72(0x1f8)](_0x4df11d);_0x142b28=!![],_0x474e92[_0x5b6d72(0x1f1)]==='shop'&&_0x474e92[_0x5b6d72(0x1df)]?.['id']&&(_0x2045d3=_0x474e92[_0x5b6d72(0x1df)]['id']),_0x2045d3&&await telegramBotService_1[_0x5b6d72(0x1fe)][_0x5b6d72(0x1e0)](_0x2045d3,{'username':_0x4df11d[_0x5b6d72(0x214)],'ipAddress':_0x3c596d,'userAgent':_0x3dce1a,'timestamp':new Date(),'success':!![]}),_0x2c5c37[_0x5b6d72(0x1fb)]({'success':!![],'result':_0x474e92});}catch(_0x3edaaf){try{const _0x1c2943=(await Promise[_0x5b6d72(0x1dc)]()[_0x5b6d72(0x1e7)](()=>__importStar(require(_0x5b6d72(0x1ef)))))['default'],_0x379ecd=await _0x1c2943[_0x5b6d72(0x1f6)][_0x5b6d72(0x213)]({'where':{'username':_0x4df11d[_0x5b6d72(0x214)]},'select':{'id':!![]}});_0x379ecd&&await telegramBotService_1[_0x5b6d72(0x1fe)][_0x5b6d72(0x1e0)](_0x379ecd['id'],{'username':_0x4df11d[_0x5b6d72(0x214)],'ipAddress':_0x3c596d,'userAgent':_0x3dce1a,'timestamp':new Date(),'success':![]});}catch(_0x5700da){console[_0x5b6d72(0x1e5)](_0x5b6d72(0x1fc),_0x5700da);}throw _0x3edaaf;}}catch(_0x1e2cca){_0x30b8ca(_0x1e2cca);}},this['me']=async(_0x4d5dca,_0x1b692c,_0x58c7b9)=>{const _0x5b4212=_0x3acafe;try{const _0x19a4eb=_0x4d5dca[_0x5b4212(0x1df)];_0x1b692c[_0x5b4212(0x1fb)]({'success':!![],'result':{'id':_0x19a4eb?.['id'],'username':_0x19a4eb?.[_0x5b4212(0x214)],'role':_0x19a4eb?.['role']}});}catch(_0x42bf3c){_0x58c7b9(_0x42bf3c);}},this[_0x3acafe(0x20d)]=async(_0x27deec,_0x3a7148,_0x42f377)=>{const _0x18a55b=_0x3acafe;try{const _0x593446=_0x27deec[_0x18a55b(0x1ec)],_0x5ebe48=_0x27deec[_0x18a55b(0x1df)];_0x593446&&_0x5ebe48?.['exp']&&tokenBlacklistService_1['tokenBlacklistService'][_0x18a55b(0x208)](_0x593446,_0x5ebe48['exp']),_0x3a7148[_0x18a55b(0x1fb)]({'success':!![],'message':'Logged\x20out\x20successfully'});}catch(_0x4c08cc){_0x42f377(_0x4c08cc);}},this[_0x3acafe(0x216)]=async(_0xbfb4df,_0x11b97e,_0x588ccf)=>{const _0x27c3eb=_0x3acafe;try{const _0x511e77=tokenBlacklistService_1[_0x27c3eb(0x209)][_0x27c3eb(0x202)]();_0x11b97e[_0x27c3eb(0x1fb)]({'success':!![],'result':_0x511e77});}catch(_0x330b44){_0x588ccf(_0x330b44);}},this[_0x3acafe(0x201)]=async(_0x17a1b2,_0x48d404,_0x34e914)=>{const _0x19c9d5=_0x3acafe;try{if(!_0x17a1b2['user']||_0x17a1b2['user']['role']!=='shop')return _0x48d404[_0x19c9d5(0x1f3)](0x193)['json']({'success':![],'message':_0x19c9d5(0x203)});const {PrismaClient:_0x22b58b}=require(_0x19c9d5(0x1f0)),_0x2bb32b=new _0x22b58b(),_0xd0f518=await _0x2bb32b['shop']['findUnique']({'where':{'id':_0x17a1b2['user']['id']},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0xd0f518)return _0x48d404[_0x19c9d5(0x1f3)](0x194)[_0x19c9d5(0x1fb)]({'success':![],'message':_0x19c9d5(0x1eb)});await _0x2bb32b[_0x19c9d5(0x1db)](),_0x48d404['json']({'success':!![],'result':{'id':_0xd0f518['id'],'name':_0xd0f518['name'],'username':_0xd0f518[_0x19c9d5(0x214)],'status':_0xd0f518['status'],'suspended':_0xd0f518['status']===_0x19c9d5(0x1ff),'active':_0xd0f518[_0x19c9d5(0x1f3)]==='ACTIVE','canCreatePayments':_0xd0f518[_0x19c9d5(0x1f3)]===_0x19c9d5(0x20f)}});}catch(_0xdc13f9){_0x34e914(_0xdc13f9);}},this[_0x3acafe(0x206)]=new authService_1[(_0x3acafe(0x1fa))]();}}exports[a4_0x1d3673(0x200)]=AuthController;