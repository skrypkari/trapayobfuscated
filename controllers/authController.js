'use strict';const a4_0x5b8051=a4_0x39cd;(function(_0x36bee8,_0xed25cd){const _0x5dccb8=a4_0x39cd,_0x226466=_0x36bee8();while(!![]){try{const _0x5f03c8=-parseInt(_0x5dccb8(0xa6))/0x1+-parseInt(_0x5dccb8(0xad))/0x2+-parseInt(_0x5dccb8(0x98))/0x3*(-parseInt(_0x5dccb8(0x8d))/0x4)+parseInt(_0x5dccb8(0xae))/0x5*(-parseInt(_0x5dccb8(0xb0))/0x6)+parseInt(_0x5dccb8(0x94))/0x7*(-parseInt(_0x5dccb8(0x99))/0x8)+-parseInt(_0x5dccb8(0xb6))/0x9*(parseInt(_0x5dccb8(0xa8))/0xa)+parseInt(_0x5dccb8(0xa9))/0xb*(parseInt(_0x5dccb8(0xb1))/0xc);if(_0x5f03c8===_0xed25cd)break;else _0x226466['push'](_0x226466['shift']());}catch(_0x2f448f){_0x226466['push'](_0x226466['shift']());}}}(a4_0x5915,0xb7c6a));function a4_0x5915(){const _0x179d0d=['user','get','6SMJLUx','424qBbZuP','__setModuleDefault','configurable','AuthController','remoteAddress','resolve','login','call','tokenBlacklistService','unknown','getBlacklistStats','exp','authService','227992eUwZpj','then','21020awPCZx','44NPPUjI','__esModule','json','blacklistToken','58962wTKiLu','270MIvCFL','hasOwnProperty','37314surZFi','9172464mbWTkr','shop','getOwnPropertyDescriptor','getOwnPropertyNames','role','6273dBIPYH','telegramBotService','default','connection','create','findUnique','sendLoginNotification','User-Agent','AuthService','defineProperty','length','writable','736796KmRzYP','../services/authService','username','__importStar','token','../config/database','prototype','81193DHnWtk','../services/tokenBlacklistService'];a4_0x5915=function(){return _0x179d0d;};return a4_0x5915();}function a4_0x39cd(_0x21e4ed,_0x5ad50e){const _0x591595=a4_0x5915();return a4_0x39cd=function(_0x39cd60,_0x1461ee){_0x39cd60=_0x39cd60-0x8b;let _0x48b57a=_0x591595[_0x39cd60];return _0x48b57a;},a4_0x39cd(_0x21e4ed,_0x5ad50e);}var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x2f5653,_0x513fba,_0x51a41c,_0x17841d){const _0x18003c=a4_0x39cd;if(_0x17841d===undefined)_0x17841d=_0x51a41c;var _0x316a56=Object[_0x18003c(0xb3)](_0x513fba,_0x51a41c);(!_0x316a56||(_0x18003c(0x97)in _0x316a56?!_0x513fba[_0x18003c(0xaa)]:_0x316a56[_0x18003c(0x8c)]||_0x316a56[_0x18003c(0x9b)]))&&(_0x316a56={'enumerable':!![],'get':function(){return _0x513fba[_0x51a41c];}}),Object[_0x18003c(0xbf)](_0x2f5653,_0x17841d,_0x316a56);}:function(_0x55401a,_0x580fa5,_0x1e2e7b,_0x121ed1){if(_0x121ed1===undefined)_0x121ed1=_0x1e2e7b;_0x55401a[_0x121ed1]=_0x580fa5[_0x1e2e7b];}),__setModuleDefault=this&&this[a4_0x5b8051(0x9a)]||(Object[a4_0x5b8051(0xba)]?function(_0x122896,_0x262d52){const _0x2bb817=a4_0x5b8051;Object['defineProperty'](_0x122896,_0x2bb817(0xb8),{'enumerable':!![],'value':_0x262d52});}:function(_0x52f002,_0x21f454){const _0x1d08f0=a4_0x5b8051;_0x52f002[_0x1d08f0(0xb8)]=_0x21f454;}),__importStar=this&&this[a4_0x5b8051(0x90)]||(function(){var _0x25f7f9=function(_0x3b8331){const _0x24102c=a4_0x39cd;return _0x25f7f9=Object[_0x24102c(0xb4)]||function(_0x709b64){const _0x40fa74=_0x24102c;var _0x3a96bd=[];for(var _0x2dac18 in _0x709b64)if(Object[_0x40fa74(0x93)][_0x40fa74(0xaf)][_0x40fa74(0xa0)](_0x709b64,_0x2dac18))_0x3a96bd[_0x3a96bd[_0x40fa74(0x8b)]]=_0x2dac18;return _0x3a96bd;},_0x25f7f9(_0x3b8331);};return function(_0x16b4ae){const _0x55607f=a4_0x39cd;if(_0x16b4ae&&_0x16b4ae['__esModule'])return _0x16b4ae;var _0x2cd7c3={};if(_0x16b4ae!=null){for(var _0x23d4ac=_0x25f7f9(_0x16b4ae),_0x34cc97=0x0;_0x34cc97<_0x23d4ac[_0x55607f(0x8b)];_0x34cc97++)if(_0x23d4ac[_0x34cc97]!==_0x55607f(0xb8))__createBinding(_0x2cd7c3,_0x16b4ae,_0x23d4ac[_0x34cc97]);}return __setModuleDefault(_0x2cd7c3,_0x16b4ae),_0x2cd7c3;};}());Object['defineProperty'](exports,a4_0x5b8051(0xaa),{'value':!![]}),exports[a4_0x5b8051(0x9c)]=void 0x0;const authService_1=require(a4_0x5b8051(0x8e)),tokenBlacklistService_1=require(a4_0x5b8051(0x95)),telegramBotService_1=require('../services/telegramBotService');class AuthController{constructor(){const _0x55f4cd=a4_0x5b8051;this[_0x55f4cd(0x9f)]=async(_0x4d0f0e,_0x15b4c6,_0x17f92c)=>{const _0x39a9f0=_0x55f4cd;try{const _0x2e3800=_0x4d0f0e['body'],_0x2a3b55=_0x4d0f0e['ip']||_0x4d0f0e[_0x39a9f0(0xb9)][_0x39a9f0(0x9d)]||_0x39a9f0(0xa2),_0xe85427=_0x4d0f0e[_0x39a9f0(0x97)](_0x39a9f0(0xbd))||_0x39a9f0(0xa2);let _0x31c648=![],_0x490f70=null;try{const _0x47f2ad=await this[_0x39a9f0(0xa5)][_0x39a9f0(0x9f)](_0x2e3800);_0x31c648=!![],_0x47f2ad['role']==='shop'&&_0x47f2ad[_0x39a9f0(0x96)]?.['id']&&(_0x490f70=_0x47f2ad[_0x39a9f0(0x96)]['id']),_0x490f70&&await telegramBotService_1['telegramBotService'][_0x39a9f0(0xbc)](_0x490f70,{'username':_0x2e3800[_0x39a9f0(0x8f)],'ipAddress':_0x2a3b55,'userAgent':_0xe85427,'timestamp':new Date(),'success':!![]}),_0x15b4c6['json']({'success':!![],'result':_0x47f2ad});}catch(_0x495e9a){try{const _0x598e5=(await Promise[_0x39a9f0(0x9e)]()[_0x39a9f0(0xa7)](()=>__importStar(require(_0x39a9f0(0x92)))))[_0x39a9f0(0xb8)],_0x4f20b0=await _0x598e5[_0x39a9f0(0xb2)][_0x39a9f0(0xbb)]({'where':{'username':_0x2e3800['username']},'select':{'id':!![]}});_0x4f20b0&&await telegramBotService_1[_0x39a9f0(0xb7)][_0x39a9f0(0xbc)](_0x4f20b0['id'],{'username':_0x2e3800[_0x39a9f0(0x8f)],'ipAddress':_0x2a3b55,'userAgent':_0xe85427,'timestamp':new Date(),'success':![]});}catch(_0x41ecc2){console['error']('Failed\x20to\x20send\x20failed\x20login\x20notification:',_0x41ecc2);}throw _0x495e9a;}}catch(_0x2363c1){_0x17f92c(_0x2363c1);}},this['me']=async(_0x2b5ea9,_0x5721f0,_0x3c7e7e)=>{const _0x2f748c=_0x55f4cd;try{const _0x5920dc=_0x2b5ea9[_0x2f748c(0x96)];_0x5721f0[_0x2f748c(0xab)]({'success':!![],'result':{'id':_0x5920dc?.['id'],'username':_0x5920dc?.[_0x2f748c(0x8f)],'role':_0x5920dc?.[_0x2f748c(0xb5)]}});}catch(_0x52029a){_0x3c7e7e(_0x52029a);}},this['logout']=async(_0x2c305c,_0x1aff51,_0x16bd9b)=>{const _0x6fcd14=_0x55f4cd;try{const _0x2dff17=_0x2c305c[_0x6fcd14(0x91)],_0x6db174=_0x2c305c[_0x6fcd14(0x96)];_0x2dff17&&_0x6db174?.[_0x6fcd14(0xa4)]&&tokenBlacklistService_1[_0x6fcd14(0xa1)][_0x6fcd14(0xac)](_0x2dff17,_0x6db174['exp']),_0x1aff51[_0x6fcd14(0xab)]({'success':!![],'message':'Logged\x20out\x20successfully'});}catch(_0x160b31){_0x16bd9b(_0x160b31);}},this[_0x55f4cd(0xa3)]=async(_0x4a6ca4,_0x5d64d5,_0x34a874)=>{const _0x5ee3fa=_0x55f4cd;try{const _0x16e546=tokenBlacklistService_1[_0x5ee3fa(0xa1)]['getStats']();_0x5d64d5[_0x5ee3fa(0xab)]({'success':!![],'result':_0x16e546});}catch(_0x497d54){_0x34a874(_0x497d54);}},this[_0x55f4cd(0xa5)]=new authService_1[(_0x55f4cd(0xbe))]();}}exports[a4_0x5b8051(0x9c)]=AuthController;