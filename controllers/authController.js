'use strict';function a5_0x2689(_0x1a6c4b,_0x2026e8){_0x1a6c4b=_0x1a6c4b-0x182;const _0x5a414d=a5_0x5a41();let _0x268937=_0x5a414d[_0x1a6c4b];return _0x268937;}const a5_0x3eac39=a5_0x2689;(function(_0x37812d,_0x582838){const _0x18c088=a5_0x2689,_0x39492e=_0x37812d();while(!![]){try{const _0x3bd150=-parseInt(_0x18c088(0x1a7))/0x1*(-parseInt(_0x18c088(0x18c))/0x2)+parseInt(_0x18c088(0x190))/0x3*(-parseInt(_0x18c088(0x182))/0x4)+parseInt(_0x18c088(0x1be))/0x5+-parseInt(_0x18c088(0x191))/0x6*(parseInt(_0x18c088(0x1bb))/0x7)+parseInt(_0x18c088(0x1b3))/0x8*(parseInt(_0x18c088(0x19c))/0x9)+parseInt(_0x18c088(0x1a2))/0xa*(-parseInt(_0x18c088(0x1c4))/0xb)+parseInt(_0x18c088(0x194))/0xc*(parseInt(_0x18c088(0x1b2))/0xd);if(_0x3bd150===_0x582838)break;else _0x39492e['push'](_0x39492e['shift']());}catch(_0x1cc7a9){_0x39492e['push'](_0x39492e['shift']());}}}(a5_0x5a41,0x1d255));var __createBinding=this&&this[a5_0x3eac39(0x18e)]||(Object[a5_0x3eac39(0x199)]?function(_0x925786,_0x2c82be,_0x4016ab,_0x5d1030){const _0x113093=a5_0x3eac39;if(_0x5d1030===undefined)_0x5d1030=_0x4016ab;var _0x54b922=Object['getOwnPropertyDescriptor'](_0x2c82be,_0x4016ab);(!_0x54b922||(_0x113093(0x19e)in _0x54b922?!_0x2c82be[_0x113093(0x1a0)]:_0x54b922[_0x113093(0x18a)]||_0x54b922[_0x113093(0x1cb)]))&&(_0x54b922={'enumerable':!![],'get':function(){return _0x2c82be[_0x4016ab];}}),Object[_0x113093(0x1c3)](_0x925786,_0x5d1030,_0x54b922);}:function(_0x667ac7,_0x4c62a1,_0x26698a,_0x569710){if(_0x569710===undefined)_0x569710=_0x26698a;_0x667ac7[_0x569710]=_0x4c62a1[_0x26698a];}),__setModuleDefault=this&&this[a5_0x3eac39(0x1b9)]||(Object[a5_0x3eac39(0x199)]?function(_0x2015be,_0x6654f5){const _0x403aeb=a5_0x3eac39;Object[_0x403aeb(0x1c3)](_0x2015be,_0x403aeb(0x1c8),{'enumerable':!![],'value':_0x6654f5});}:function(_0x1109dd,_0x4e59b6){const _0x28c6fc=a5_0x3eac39;_0x1109dd[_0x28c6fc(0x1c8)]=_0x4e59b6;}),__importStar=this&&this[a5_0x3eac39(0x1a4)]||(function(){var _0x2f352d=function(_0x42fd06){const _0x1f3678=a5_0x2689;return _0x2f352d=Object[_0x1f3678(0x189)]||function(_0x5a0745){const _0x1f14ee=_0x1f3678;var _0x221c07=[];for(var _0x56e4d2 in _0x5a0745)if(Object[_0x1f14ee(0x1bd)]['hasOwnProperty'][_0x1f14ee(0x18f)](_0x5a0745,_0x56e4d2))_0x221c07[_0x221c07[_0x1f14ee(0x1b0)]]=_0x56e4d2;return _0x221c07;},_0x2f352d(_0x42fd06);};return function(_0x5aec5a){const _0xc54a3c=a5_0x2689;if(_0x5aec5a&&_0x5aec5a[_0xc54a3c(0x1a0)])return _0x5aec5a;var _0x5b52c6={};if(_0x5aec5a!=null){for(var _0x5c3029=_0x2f352d(_0x5aec5a),_0x445df0=0x0;_0x445df0<_0x5c3029[_0xc54a3c(0x1b0)];_0x445df0++)if(_0x5c3029[_0x445df0]!==_0xc54a3c(0x1c8))__createBinding(_0x5b52c6,_0x5aec5a,_0x5c3029[_0x445df0]);}return __setModuleDefault(_0x5b52c6,_0x5aec5a),_0x5b52c6;};}());function a5_0x5a41(){const _0x1f68e8=['1087okVyTt','status','AuthController','GET','AuthService','role','Failed\x20to\x20retrieve\x20fingerprint\x20data','geo','user','length','getBlacklistStats','611AFiimZ','60296GdLxwk','ipAddress','address','../services/tokenBlacklistService','getStats','query','__setModuleDefault','sendLoginNotification','14pyUczA','blacklistToken','prototype','360515BLfcXQ','Failed\x20to\x20send\x20failed\x20login\x20notification:','geolocation','error','https://eu.api.fpjs.io/events/','defineProperty','22429YCtQbl','getDate','authService','tokenBlacklistService','default','application/json','json','configurable','Failed\x20to\x20fetch\x20fingerprint\x20data:','connection','132gToSed','../services/telegramBotService','shop','unknown','userAgent','telegramBotService','exp','getOwnPropertyNames','writable','username','2CxIFYS','setDate','__createBinding','call','2439WwDHWn','416022tsBWQl','resolve','findUnique','5532PARDvh','products','string','ipInfo','data','create','body','country','261DXCtHn','getFingerprintInfo','get','anJngmXQVawz37L0S21u','__esModule','../config/database','140MVkCVb','requestId\x20query\x20parameter\x20is\x20required','__importStar','code','then'];a5_0x5a41=function(){return _0x1f68e8;};return a5_0x5a41();}Object[a5_0x3eac39(0x1c3)](exports,a5_0x3eac39(0x1a0),{'value':!![]}),exports[a5_0x3eac39(0x1a9)]=void 0x0;const authService_1=require('../services/authService'),tokenBlacklistService_1=require(a5_0x3eac39(0x1b6)),telegramBotService_1=require(a5_0x3eac39(0x183));class AuthController{constructor(){const _0xe8d0ac=a5_0x3eac39;this['login']=async(_0x54e9dd,_0xc19ef8,_0xde7ae3)=>{const _0x1cac1f=a5_0x2689;try{const _0x3b4d09=_0x54e9dd[_0x1cac1f(0x19a)],_0x169a50=_0x3b4d09[_0x1cac1f(0x1b4)]||_0x54e9dd['ip']||_0x54e9dd[_0x1cac1f(0x1cd)]['remoteAddress']||_0x1cac1f(0x185),_0x19c3c9=_0x3b4d09[_0x1cac1f(0x186)]||_0x54e9dd['get']('User-Agent')||_0x1cac1f(0x185),_0x31d24f=_0x3b4d09[_0x1cac1f(0x1ae)],_0x37ef2f=_0x3b4d09['fingerprintRequestId'];let _0x5848f2=![],_0x5910bc=null,_0x43f1e7=null;if(_0x37ef2f)try{const _0x381c81=_0x1cac1f(0x1c2)+_0x37ef2f,_0x310887=await fetch(_0x381c81,{'method':_0x1cac1f(0x1aa),'headers':{'Content-Type':_0x1cac1f(0x1c9),'Auth-API-Key':_0x1cac1f(0x19f)}});_0x310887['ok']&&(_0x43f1e7=await _0x310887[_0x1cac1f(0x1ca)]());}catch(_0x3a7b7b){console[_0x1cac1f(0x1c1)](_0x1cac1f(0x1cc),_0x3a7b7b);}try{const _0x5f0b45=await this[_0x1cac1f(0x1c6)]['login'](_0x3b4d09);_0x5848f2=!![];_0x5f0b45[_0x1cac1f(0x1ac)]===_0x1cac1f(0x184)&&_0x5f0b45[_0x1cac1f(0x1af)]?.['id']&&(_0x5910bc=_0x5f0b45['user']['id']);if(_0x5910bc){const _0x3d8e84=(await Promise[_0x1cac1f(0x192)]()[_0x1cac1f(0x1a6)](()=>__importStar(require(_0x1cac1f(0x1a1)))))['default'],_0x390a74=new Date(),_0x11c984=new Date(_0x390a74);_0x11c984[_0x1cac1f(0x18d)](_0x11c984['getDate']()+0x16d),await _0x3d8e84['loginLog'][_0x1cac1f(0x199)]({'data':{'shopId':_0x5910bc,'username':_0x3b4d09[_0x1cac1f(0x18b)],'fingerprintRequestId':_0x37ef2f,'fingerprintData':_0x43f1e7,'ipAddress':_0x169a50,'userAgent':_0x19c3c9,'geo':_0x31d24f,'success':!![],'expiresAt':_0x11c984}}),await telegramBotService_1[_0x1cac1f(0x187)][_0x1cac1f(0x1ba)](_0x5910bc,{'username':_0x3b4d09[_0x1cac1f(0x18b)],'ipAddress':_0x169a50,'userAgent':_0x19c3c9,'geo':_0x31d24f,'timestamp':new Date(),'success':!![]});}_0xc19ef8[_0x1cac1f(0x1ca)]({'success':!![],'result':_0x5f0b45});}catch(_0x4d59d2){try{const _0x1a4410=(await Promise['resolve']()[_0x1cac1f(0x1a6)](()=>__importStar(require(_0x1cac1f(0x1a1)))))['default'],_0x2a05e4=await _0x1a4410[_0x1cac1f(0x184)][_0x1cac1f(0x193)]({'where':{'username':_0x3b4d09[_0x1cac1f(0x18b)]},'select':{'id':!![]}});if(_0x2a05e4){const _0x266e28=new Date(),_0xbbc543=new Date(_0x266e28);_0xbbc543[_0x1cac1f(0x18d)](_0xbbc543[_0x1cac1f(0x1c5)]()+0x16d),await _0x1a4410['loginLog'][_0x1cac1f(0x199)]({'data':{'shopId':_0x2a05e4['id'],'username':_0x3b4d09['username'],'fingerprintRequestId':_0x37ef2f,'fingerprintData':_0x43f1e7,'ipAddress':_0x169a50,'userAgent':_0x19c3c9,'geo':_0x31d24f,'success':![],'expiresAt':_0xbbc543}}),await telegramBotService_1[_0x1cac1f(0x187)][_0x1cac1f(0x1ba)](_0x2a05e4['id'],{'username':_0x3b4d09['username'],'ipAddress':_0x169a50,'userAgent':_0x19c3c9,'geo':_0x31d24f,'timestamp':new Date(),'success':![]});}}catch(_0x22fd0f){console[_0x1cac1f(0x1c1)](_0x1cac1f(0x1bf),_0x22fd0f);}throw _0x4d59d2;}}catch(_0x2ba1e3){_0xde7ae3(_0x2ba1e3);}},this['me']=async(_0x3c4834,_0x19f329,_0x1d704d)=>{const _0x4c7db5=a5_0x2689;try{const _0x257218=_0x3c4834[_0x4c7db5(0x1af)];_0x19f329[_0x4c7db5(0x1ca)]({'success':!![],'result':{'id':_0x257218?.['id'],'username':_0x257218?.[_0x4c7db5(0x18b)],'role':_0x257218?.[_0x4c7db5(0x1ac)]}});}catch(_0x521d17){_0x1d704d(_0x521d17);}},this['logout']=async(_0x1943d0,_0x390c1f,_0x51f5da)=>{const _0xe61c4c=a5_0x2689;try{const _0x1a6cb0=_0x1943d0['token'],_0x35d20f=_0x1943d0[_0xe61c4c(0x1af)];_0x1a6cb0&&_0x35d20f?.[_0xe61c4c(0x188)]&&tokenBlacklistService_1['tokenBlacklistService'][_0xe61c4c(0x1bc)](_0x1a6cb0,_0x35d20f[_0xe61c4c(0x188)]),_0x390c1f[_0xe61c4c(0x1ca)]({'success':!![],'message':'Logged\x20out\x20successfully'});}catch(_0x5c8493){_0x51f5da(_0x5c8493);}},this[_0xe8d0ac(0x1b1)]=async(_0x329550,_0x589bb1,_0x4a0666)=>{const _0x90568a=_0xe8d0ac;try{const _0x13d272=tokenBlacklistService_1[_0x90568a(0x1c7)][_0x90568a(0x1b7)]();_0x589bb1[_0x90568a(0x1ca)]({'success':!![],'result':_0x13d272});}catch(_0x144c90){_0x4a0666(_0x144c90);}},this[_0xe8d0ac(0x19d)]=async(_0x1a66e6,_0x133f4f,_0x56919f)=>{const _0x37f997=_0xe8d0ac;try{const {requestId:_0x5f4f0a}=_0x1a66e6[_0x37f997(0x1b8)];if(typeof _0x5f4f0a!==_0x37f997(0x196))return _0x133f4f[_0x37f997(0x1a8)](0x190)['json']({'success':![],'message':_0x37f997(0x1a3)});const _0xa798c3=_0x37f997(0x1c2)+_0x5f4f0a,_0x229ec0=await fetch(_0xa798c3,{'method':_0x37f997(0x1aa),'headers':{'Content-Type':_0x37f997(0x1c9),'Auth-API-Key':_0x37f997(0x19f)}});if(!_0x229ec0['ok'])return _0x133f4f[_0x37f997(0x1a8)](_0x229ec0[_0x37f997(0x1a8)])['json']({'success':![],'message':_0x37f997(0x1ad)});const _0x139a28=await _0x229ec0[_0x37f997(0x1ca)](),_0x2b7def=_0x139a28['products']?.[_0x37f997(0x197)]?.[_0x37f997(0x198)]?.['v4']?.['address']||_0x139a28[_0x37f997(0x195)]?.[_0x37f997(0x197)]?.[_0x37f997(0x198)]?.['v6']?.[_0x37f997(0x1b5)]||'',_0x980e6a=_0x139a28[_0x37f997(0x195)]?.['ipInfo']?.[_0x37f997(0x198)]?.['v4']?.[_0x37f997(0x1c0)]?.['country']?.[_0x37f997(0x1a5)]||_0x139a28[_0x37f997(0x195)]?.[_0x37f997(0x197)]?.[_0x37f997(0x198)]?.['v6']?.['geolocation']?.[_0x37f997(0x19b)]?.[_0x37f997(0x1a5)]||'';_0x133f4f[_0x37f997(0x1ca)]({'success':!![],'result':{'ipAddress':_0x2b7def,'countryCode':_0x980e6a}});}catch(_0x4ed4be){_0x56919f(_0x4ed4be);}},this[_0xe8d0ac(0x1c6)]=new authService_1[(_0xe8d0ac(0x1ab))]();}}exports[a5_0x3eac39(0x1a9)]=AuthController;