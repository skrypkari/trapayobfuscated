'use strict';function a4_0x151d(){const _0x21cad4=['getStats','1363645fslKbZ','../config/database','default','user','../services/tokenBlacklistService','call','configurable','__importStar','defineProperty','getOwnPropertyDescriptor','118464nRNjLs','telegramBotService','__createBinding','__setModuleDefault','exp','length','3Ftiodz','then','147667UcDewO','2306248YVvHZK','498646rGlXmC','AuthController','sendLoginNotification','getBlacklistStats','authService','blacklistToken','logout','role','6500571ZVZoLV','json','prototype','__esModule','3022088yIubSE','tokenBlacklistService','login','body','get','username','unknown','connection','create','findUnique','User-Agent','error','remoteAddress','../services/authService','resolve'];a4_0x151d=function(){return _0x21cad4;};return a4_0x151d();}const a4_0x14bfc9=a4_0x3366;(function(_0x37ca37,_0x52b41b){const _0x159993=a4_0x3366,_0x46e39f=_0x37ca37();while(!![]){try{const _0x1b43fb=-parseInt(_0x159993(0x190))/0x1+parseInt(_0x159993(0x192))/0x2+-parseInt(_0x159993(0x18e))/0x3*(parseInt(_0x159993(0x191))/0x4)+-parseInt(_0x159993(0x17e))/0x5+-parseInt(_0x159993(0x188))/0x6+parseInt(_0x159993(0x19a))/0x7+parseInt(_0x159993(0x19e))/0x8;if(_0x1b43fb===_0x52b41b)break;else _0x46e39f['push'](_0x46e39f['shift']());}catch(_0x25cfcb){_0x46e39f['push'](_0x46e39f['shift']());}}}(a4_0x151d,0x8399b));function a4_0x3366(_0xfd2496,_0x16c974){const _0x151d21=a4_0x151d();return a4_0x3366=function(_0x336607,_0x1dab39){_0x336607=_0x336607-0x176;let _0x553c17=_0x151d21[_0x336607];return _0x553c17;},a4_0x3366(_0xfd2496,_0x16c974);}var __createBinding=this&&this[a4_0x14bfc9(0x18a)]||(Object['create']?function(_0x377abb,_0x43a8ff,_0xa1b46a,_0x3df3e1){const _0x40ad9a=a4_0x14bfc9;if(_0x3df3e1===undefined)_0x3df3e1=_0xa1b46a;var _0x5aaecb=Object[_0x40ad9a(0x187)](_0x43a8ff,_0xa1b46a);(!_0x5aaecb||(_0x40ad9a(0x1a2)in _0x5aaecb?!_0x43a8ff['__esModule']:_0x5aaecb['writable']||_0x5aaecb[_0x40ad9a(0x184)]))&&(_0x5aaecb={'enumerable':!![],'get':function(){return _0x43a8ff[_0xa1b46a];}}),Object[_0x40ad9a(0x186)](_0x377abb,_0x3df3e1,_0x5aaecb);}:function(_0x11b1f9,_0x4c6d25,_0x3acb6f,_0x18cecb){if(_0x18cecb===undefined)_0x18cecb=_0x3acb6f;_0x11b1f9[_0x18cecb]=_0x4c6d25[_0x3acb6f];}),__setModuleDefault=this&&this[a4_0x14bfc9(0x18b)]||(Object[a4_0x14bfc9(0x176)]?function(_0x24ce4e,_0x58fe02){const _0x43084c=a4_0x14bfc9;Object[_0x43084c(0x186)](_0x24ce4e,_0x43084c(0x180),{'enumerable':!![],'value':_0x58fe02});}:function(_0x19dd6e,_0x1cf105){_0x19dd6e['default']=_0x1cf105;}),__importStar=this&&this[a4_0x14bfc9(0x185)]||(function(){var _0x1879cc=function(_0x1114f8){return _0x1879cc=Object['getOwnPropertyNames']||function(_0x2721ed){const _0x2a762c=a4_0x3366;var _0xfb6321=[];for(var _0x1974ac in _0x2721ed)if(Object[_0x2a762c(0x19c)]['hasOwnProperty'][_0x2a762c(0x183)](_0x2721ed,_0x1974ac))_0xfb6321[_0xfb6321[_0x2a762c(0x18d)]]=_0x1974ac;return _0xfb6321;},_0x1879cc(_0x1114f8);};return function(_0x576fe3){const _0x19f4af=a4_0x3366;if(_0x576fe3&&_0x576fe3[_0x19f4af(0x19d)])return _0x576fe3;var _0x18e2bb={};if(_0x576fe3!=null){for(var _0x3dd169=_0x1879cc(_0x576fe3),_0x439b32=0x0;_0x439b32<_0x3dd169[_0x19f4af(0x18d)];_0x439b32++)if(_0x3dd169[_0x439b32]!=='default')__createBinding(_0x18e2bb,_0x576fe3,_0x3dd169[_0x439b32]);}return __setModuleDefault(_0x18e2bb,_0x576fe3),_0x18e2bb;};}());Object[a4_0x14bfc9(0x186)](exports,'__esModule',{'value':!![]}),exports[a4_0x14bfc9(0x193)]=void 0x0;const authService_1=require(a4_0x14bfc9(0x17b)),tokenBlacklistService_1=require(a4_0x14bfc9(0x182)),telegramBotService_1=require('../services/telegramBotService');class AuthController{constructor(){const _0x4aa167=a4_0x14bfc9;this[_0x4aa167(0x1a0)]=async(_0x43e4ac,_0xd78e7b,_0x130cf0)=>{const _0x4e53b3=_0x4aa167;try{const _0x561f32=_0x43e4ac[_0x4e53b3(0x1a1)],_0x254df8=_0x43e4ac['ip']||_0x43e4ac[_0x4e53b3(0x1a5)][_0x4e53b3(0x17a)]||_0x4e53b3(0x1a4),_0x4b54f5=_0x43e4ac[_0x4e53b3(0x1a2)](_0x4e53b3(0x178))||_0x4e53b3(0x1a4);let _0x34c68b=![],_0x2c6f30=null;try{const _0x559330=await this['authService'][_0x4e53b3(0x1a0)](_0x561f32);_0x34c68b=!![],_0x559330[_0x4e53b3(0x199)]==='shop'&&_0x559330[_0x4e53b3(0x181)]?.['id']&&(_0x2c6f30=_0x559330[_0x4e53b3(0x181)]['id']),_0x2c6f30&&await telegramBotService_1[_0x4e53b3(0x189)]['sendLoginNotification'](_0x2c6f30,{'username':_0x561f32['username'],'ipAddress':_0x254df8,'userAgent':_0x4b54f5,'timestamp':new Date(),'success':!![]}),_0xd78e7b[_0x4e53b3(0x19b)]({'success':!![],'result':_0x559330});}catch(_0x33be66){try{const _0x595027=(await Promise[_0x4e53b3(0x17c)]()[_0x4e53b3(0x18f)](()=>__importStar(require(_0x4e53b3(0x17f)))))[_0x4e53b3(0x180)],_0x80baf4=await _0x595027['shop'][_0x4e53b3(0x177)]({'where':{'username':_0x561f32['username']},'select':{'id':!![]}});_0x80baf4&&await telegramBotService_1['telegramBotService'][_0x4e53b3(0x194)](_0x80baf4['id'],{'username':_0x561f32[_0x4e53b3(0x1a3)],'ipAddress':_0x254df8,'userAgent':_0x4b54f5,'timestamp':new Date(),'success':![]});}catch(_0x265d40){console[_0x4e53b3(0x179)]('Failed\x20to\x20send\x20failed\x20login\x20notification:',_0x265d40);}throw _0x33be66;}}catch(_0x15f1c3){_0x130cf0(_0x15f1c3);}},this['me']=async(_0x2a6567,_0x1c118d,_0x11a17b)=>{const _0x212d80=_0x4aa167;try{const _0x1b7e09=_0x2a6567['user'];_0x1c118d[_0x212d80(0x19b)]({'success':!![],'result':{'id':_0x1b7e09?.['id'],'username':_0x1b7e09?.['username'],'role':_0x1b7e09?.[_0x212d80(0x199)]}});}catch(_0x12baa2){_0x11a17b(_0x12baa2);}},this[_0x4aa167(0x198)]=async(_0x343740,_0x56f0bb,_0x6ae460)=>{const _0x6c82b3=_0x4aa167;try{const _0x40f758=_0x343740['token'],_0x410eca=_0x343740['user'];_0x40f758&&_0x410eca?.[_0x6c82b3(0x18c)]&&tokenBlacklistService_1[_0x6c82b3(0x19f)][_0x6c82b3(0x197)](_0x40f758,_0x410eca[_0x6c82b3(0x18c)]),_0x56f0bb[_0x6c82b3(0x19b)]({'success':!![],'message':'Logged\x20out\x20successfully'});}catch(_0xd789cf){_0x6ae460(_0xd789cf);}},this[_0x4aa167(0x195)]=async(_0x26ffe1,_0x36a880,_0x26bf38)=>{const _0x5e9d3d=_0x4aa167;try{const _0x442f87=tokenBlacklistService_1[_0x5e9d3d(0x19f)][_0x5e9d3d(0x17d)]();_0x36a880[_0x5e9d3d(0x19b)]({'success':!![],'result':_0x442f87});}catch(_0x2d81dd){_0x26bf38(_0x2d81dd);}},this[_0x4aa167(0x196)]=new authService_1['AuthService']();}}exports[a4_0x14bfc9(0x193)]=AuthController;