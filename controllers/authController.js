'use strict';const a4_0x277f40=a4_0xa747;function a4_0x5a05(){const _0x3c392b=['shop','../services/tokenBlacklistService','../config/database','connection','18eGYRzG','role','prototype','get','json','__esModule','authService','hasOwnProperty','5305761umjywj','AuthController','user','default','token','../services/telegramBotService','../services/authService','getBlacklistStats','create','tokenBlacklistService','getOwnPropertyDescriptor','10kwYykd','2YTODzX','writable','unknown','sendLoginNotification','Failed\x20to\x20send\x20failed\x20login\x20notification:','__importStar','blacklistToken','3141296BWItYJ','exp','remoteAddress','findUnique','2765920ePtCyF','defineProperty','username','length','body','then','2071221qqGSEc','Logged\x20out\x20successfully','404355zuNDUT','login','AuthService','257905NkANGq','__setModuleDefault','403395QiGadW','telegramBotService'];a4_0x5a05=function(){return _0x3c392b;};return a4_0x5a05();}(function(_0x4161e9,_0x1071f4){const _0x4de8fd=a4_0xa747,_0x4e3bed=_0x4161e9();while(!![]){try{const _0x7d0e9d=-parseInt(_0x4de8fd(0x114))/0x1+-parseInt(_0x4de8fd(0x12e))/0x2*(parseInt(_0x4de8fd(0x10d))/0x3)+parseInt(_0x4de8fd(0x107))/0x4+-parseInt(_0x4de8fd(0x112))/0x5*(parseInt(_0x4de8fd(0x11a))/0x6)+-parseInt(_0x4de8fd(0x10f))/0x7+parseInt(_0x4de8fd(0x135))/0x8+-parseInt(_0x4de8fd(0x122))/0x9*(-parseInt(_0x4de8fd(0x12d))/0xa);if(_0x7d0e9d===_0x1071f4)break;else _0x4e3bed['push'](_0x4e3bed['shift']());}catch(_0x171c3d){_0x4e3bed['push'](_0x4e3bed['shift']());}}}(a4_0x5a05,0x59b01));function a4_0xa747(_0x1a3322,_0x955c4d){const _0x5a0510=a4_0x5a05();return a4_0xa747=function(_0xa7471,_0x52f54b){_0xa7471=_0xa7471-0x106;let _0x2ddfe8=_0x5a0510[_0xa7471];return _0x2ddfe8;},a4_0xa747(_0x1a3322,_0x955c4d);}var __createBinding=this&&this['__createBinding']||(Object[a4_0x277f40(0x12a)]?function(_0x36d55b,_0x57c4d3,_0x2f6224,_0x41f315){const _0x407de6=a4_0x277f40;if(_0x41f315===undefined)_0x41f315=_0x2f6224;var _0x28b3c5=Object[_0x407de6(0x12c)](_0x57c4d3,_0x2f6224);(!_0x28b3c5||(_0x407de6(0x11d)in _0x28b3c5?!_0x57c4d3[_0x407de6(0x11f)]:_0x28b3c5[_0x407de6(0x12f)]||_0x28b3c5['configurable']))&&(_0x28b3c5={'enumerable':!![],'get':function(){return _0x57c4d3[_0x2f6224];}}),Object[_0x407de6(0x108)](_0x36d55b,_0x41f315,_0x28b3c5);}:function(_0x44fba5,_0x5a5fd7,_0x364df7,_0xf51fc6){if(_0xf51fc6===undefined)_0xf51fc6=_0x364df7;_0x44fba5[_0xf51fc6]=_0x5a5fd7[_0x364df7];}),__setModuleDefault=this&&this[a4_0x277f40(0x113)]||(Object[a4_0x277f40(0x12a)]?function(_0x20842d,_0x43216a){const _0xb34e48=a4_0x277f40;Object[_0xb34e48(0x108)](_0x20842d,_0xb34e48(0x125),{'enumerable':!![],'value':_0x43216a});}:function(_0x34ac08,_0x470785){const _0x1adcf6=a4_0x277f40;_0x34ac08[_0x1adcf6(0x125)]=_0x470785;}),__importStar=this&&this[a4_0x277f40(0x133)]||(function(){var _0xc7c654=function(_0xe0e7ba){return _0xc7c654=Object['getOwnPropertyNames']||function(_0x19baa7){const _0x403c89=a4_0xa747;var _0x31316f=[];for(var _0x2349a5 in _0x19baa7)if(Object[_0x403c89(0x11c)][_0x403c89(0x121)]['call'](_0x19baa7,_0x2349a5))_0x31316f[_0x31316f[_0x403c89(0x10a)]]=_0x2349a5;return _0x31316f;},_0xc7c654(_0xe0e7ba);};return function(_0x1004ab){if(_0x1004ab&&_0x1004ab['__esModule'])return _0x1004ab;var _0x4fb961={};if(_0x1004ab!=null){for(var _0x31c6fb=_0xc7c654(_0x1004ab),_0x2419dd=0x0;_0x2419dd<_0x31c6fb['length'];_0x2419dd++)if(_0x31c6fb[_0x2419dd]!=='default')__createBinding(_0x4fb961,_0x1004ab,_0x31c6fb[_0x2419dd]);}return __setModuleDefault(_0x4fb961,_0x1004ab),_0x4fb961;};}());Object[a4_0x277f40(0x108)](exports,a4_0x277f40(0x11f),{'value':!![]}),exports[a4_0x277f40(0x123)]=void 0x0;const authService_1=require(a4_0x277f40(0x128)),tokenBlacklistService_1=require(a4_0x277f40(0x117)),telegramBotService_1=require(a4_0x277f40(0x127));class AuthController{constructor(){const _0x20d8f8=a4_0x277f40;this['login']=async(_0x569210,_0x5ebb50,_0x3680eb)=>{const _0x5670ab=a4_0xa747;try{const _0x818626=_0x569210[_0x5670ab(0x10b)],_0x1d469d=_0x569210['ip']||_0x569210[_0x5670ab(0x119)][_0x5670ab(0x137)]||_0x5670ab(0x130),_0x2e35bc=_0x569210['get']('User-Agent')||'unknown';let _0x50bb7f=![],_0x2ee84d=null;try{const _0x5f5278=await this['authService'][_0x5670ab(0x110)](_0x818626);_0x50bb7f=!![],_0x5f5278[_0x5670ab(0x11b)]==='shop'&&_0x5f5278['user']?.['id']&&(_0x2ee84d=_0x5f5278['user']['id']),_0x2ee84d&&await telegramBotService_1[_0x5670ab(0x115)][_0x5670ab(0x131)](_0x2ee84d,{'username':_0x818626[_0x5670ab(0x109)],'ipAddress':_0x1d469d,'userAgent':_0x2e35bc,'timestamp':new Date(),'success':!![]}),_0x5ebb50[_0x5670ab(0x11e)]({'success':!![],'result':_0x5f5278});}catch(_0x14790f){try{const _0x2965ff=(await Promise['resolve']()[_0x5670ab(0x10c)](()=>__importStar(require(_0x5670ab(0x118)))))[_0x5670ab(0x125)],_0xa9e107=await _0x2965ff[_0x5670ab(0x116)][_0x5670ab(0x106)]({'where':{'username':_0x818626[_0x5670ab(0x109)]},'select':{'id':!![]}});_0xa9e107&&await telegramBotService_1[_0x5670ab(0x115)][_0x5670ab(0x131)](_0xa9e107['id'],{'username':_0x818626[_0x5670ab(0x109)],'ipAddress':_0x1d469d,'userAgent':_0x2e35bc,'timestamp':new Date(),'success':![]});}catch(_0x4c1040){console['error'](_0x5670ab(0x132),_0x4c1040);}throw _0x14790f;}}catch(_0x45d12a){_0x3680eb(_0x45d12a);}},this['me']=async(_0x1128c1,_0x228390,_0x7b0951)=>{const _0x5bfa85=a4_0xa747;try{const _0xc61b76=_0x1128c1['user'];_0x228390[_0x5bfa85(0x11e)]({'success':!![],'result':{'id':_0xc61b76?.['id'],'username':_0xc61b76?.['username'],'role':_0xc61b76?.[_0x5bfa85(0x11b)]}});}catch(_0x199d80){_0x7b0951(_0x199d80);}},this['logout']=async(_0xc62af5,_0x11a5f9,_0x1e60a6)=>{const _0x239f42=a4_0xa747;try{const _0x348339=_0xc62af5[_0x239f42(0x126)],_0x47de84=_0xc62af5[_0x239f42(0x124)];_0x348339&&_0x47de84?.['exp']&&tokenBlacklistService_1[_0x239f42(0x12b)][_0x239f42(0x134)](_0x348339,_0x47de84[_0x239f42(0x136)]),_0x11a5f9['json']({'success':!![],'message':_0x239f42(0x10e)});}catch(_0x2ca1ad){_0x1e60a6(_0x2ca1ad);}},this[_0x20d8f8(0x129)]=async(_0x44da9d,_0x157f89,_0x267f18)=>{const _0x45e3ac=_0x20d8f8;try{const _0x564735=tokenBlacklistService_1[_0x45e3ac(0x12b)]['getStats']();_0x157f89['json']({'success':!![],'result':_0x564735});}catch(_0x3b250c){_0x267f18(_0x3b250c);}},this[_0x20d8f8(0x120)]=new authService_1[(_0x20d8f8(0x111))]();}}exports[a4_0x277f40(0x123)]=AuthController;