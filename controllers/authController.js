'use strict';const a5_0x1a4c79=a5_0x55c8;(function(_0xb9b1a5,_0x2bc770){const _0xe987c5=a5_0x55c8,_0xafe9b9=_0xb9b1a5();while(!![]){try{const _0x118b7f=-parseInt(_0xe987c5(0x107))/0x1*(-parseInt(_0xe987c5(0x11c))/0x2)+parseInt(_0xe987c5(0x13a))/0x3+-parseInt(_0xe987c5(0x10e))/0x4*(parseInt(_0xe987c5(0x113))/0x5)+parseInt(_0xe987c5(0x132))/0x6*(-parseInt(_0xe987c5(0x10c))/0x7)+-parseInt(_0xe987c5(0x12d))/0x8*(-parseInt(_0xe987c5(0x138))/0x9)+parseInt(_0xe987c5(0x110))/0xa+parseInt(_0xe987c5(0xf8))/0xb*(-parseInt(_0xe987c5(0xfd))/0xc);if(_0x118b7f===_0x2bc770)break;else _0xafe9b9['push'](_0xafe9b9['shift']());}catch(_0x221d5d){_0xafe9b9['push'](_0xafe9b9['shift']());}}}(a5_0xacd8,0xaed1a));var __createBinding=this&&this[a5_0x1a4c79(0x103)]||(Object['create']?function(_0x278b8c,_0x1ab672,_0x203e14,_0x763095){const _0x1c6858=a5_0x1a4c79;if(_0x763095===undefined)_0x763095=_0x203e14;var _0x1b96be=Object[_0x1c6858(0x112)](_0x1ab672,_0x203e14);(!_0x1b96be||(_0x1c6858(0x12a)in _0x1b96be?!_0x1ab672['__esModule']:_0x1b96be[_0x1c6858(0xf9)]||_0x1b96be[_0x1c6858(0x104)]))&&(_0x1b96be={'enumerable':!![],'get':function(){return _0x1ab672[_0x203e14];}}),Object[_0x1c6858(0x121)](_0x278b8c,_0x763095,_0x1b96be);}:function(_0x58667c,_0x1174f9,_0x456b92,_0x4d545b){if(_0x4d545b===undefined)_0x4d545b=_0x456b92;_0x58667c[_0x4d545b]=_0x1174f9[_0x456b92];}),__setModuleDefault=this&&this[a5_0x1a4c79(0x13c)]||(Object[a5_0x1a4c79(0x13e)]?function(_0x530f3a,_0x4c5594){const _0x22ac40=a5_0x1a4c79;Object[_0x22ac40(0x121)](_0x530f3a,'default',{'enumerable':!![],'value':_0x4c5594});}:function(_0xad57ac,_0x44ba3f){const _0x599d8e=a5_0x1a4c79;_0xad57ac[_0x599d8e(0xfb)]=_0x44ba3f;}),__importStar=this&&this[a5_0x1a4c79(0x117)]||(function(){var _0x18b5dd=function(_0x2d5b82){const _0x5b7e88=a5_0x55c8;return _0x18b5dd=Object[_0x5b7e88(0x128)]||function(_0x365d79){const _0x36a2a5=_0x5b7e88;var _0x14682e=[];for(var _0x39afb3 in _0x365d79)if(Object[_0x36a2a5(0x125)][_0x36a2a5(0x13b)][_0x36a2a5(0x11d)](_0x365d79,_0x39afb3))_0x14682e[_0x14682e[_0x36a2a5(0x122)]]=_0x39afb3;return _0x14682e;},_0x18b5dd(_0x2d5b82);};return function(_0x20080b){const _0xcb5dcd=a5_0x55c8;if(_0x20080b&&_0x20080b['__esModule'])return _0x20080b;var _0xf10c05={};if(_0x20080b!=null){for(var _0x3f3177=_0x18b5dd(_0x20080b),_0x1ded9e=0x0;_0x1ded9e<_0x3f3177[_0xcb5dcd(0x122)];_0x1ded9e++)if(_0x3f3177[_0x1ded9e]!==_0xcb5dcd(0xfb))__createBinding(_0xf10c05,_0x20080b,_0x3f3177[_0x1ded9e]);}return __setModuleDefault(_0xf10c05,_0x20080b),_0xf10c05;};}());Object[a5_0x1a4c79(0x121)](exports,a5_0x1a4c79(0x11a),{'value':!![]}),exports['AuthController']=void 0x0;const authService_1=require(a5_0x1a4c79(0x130)),tokenBlacklistService_1=require(a5_0x1a4c79(0x11e)),telegramBotService_1=require(a5_0x1a4c79(0x12b));function a5_0xacd8(){const _0x84887c=['Failed\x20to\x20fetch\x20fingerprint\x20data:','fingerprintRequestId','telegramBotService','707036ZKOhgb','writable','user','default','geolocation','12HIilAZ','Logged\x20out\x20successfully','token','country','connection','ipInfo','__createBinding','configurable','application/json','loginLog','617jOyMHJ','username','Failed\x20to\x20retrieve\x20fingerprint\x20data','getStats','remoteAddress','7636671bRBhEg','login','31572ypXBEY','role','5863950GlJQgm','exp','getOwnPropertyDescriptor','85qDgPcO','GET','getDate','resolve','__importStar','blacklistToken','ipAddress','__esModule','https://eu.api.fpjs.io/events/','3442zTudcD','call','../services/tokenBlacklistService','userAgent','code','defineProperty','length','../config/database','string','prototype','then','geo','getOwnPropertyNames','address','get','../services/telegramBotService','unknown','6304MtCtgd','json','shop','../services/authService','AuthController','6pZdjHW','data','setDate','query','tokenBlacklistService','error','1962RHHvrW','products','556296jXKTbb','hasOwnProperty','__setModuleDefault','anJngmXQVawz37L0S21u','create','requestId\x20query\x20parameter\x20is\x20required'];a5_0xacd8=function(){return _0x84887c;};return a5_0xacd8();}function a5_0x55c8(_0x1b48f9,_0x54368c){_0x1b48f9=_0x1b48f9-0xf8;const _0xacd89a=a5_0xacd8();let _0x55c8cc=_0xacd89a[_0x1b48f9];return _0x55c8cc;}class AuthController{constructor(){this['login']=async(_0x4e802c,_0x71bce8,_0x517bfa)=>{const _0x3a7e98=a5_0x55c8;try{const _0x5e1ea9=_0x4e802c['body'],_0x121f00=_0x5e1ea9[_0x3a7e98(0x119)]||_0x4e802c['ip']||_0x4e802c[_0x3a7e98(0x101)][_0x3a7e98(0x10b)]||_0x3a7e98(0x12c),_0x45a084=_0x5e1ea9[_0x3a7e98(0x11f)]||_0x4e802c[_0x3a7e98(0x12a)]('User-Agent')||_0x3a7e98(0x12c),_0x3db7ca=_0x5e1ea9[_0x3a7e98(0x127)],_0x1f7eb4=_0x5e1ea9[_0x3a7e98(0x141)];let _0x432dba=![],_0x4e42ff=null,_0x2d398a=null;if(_0x1f7eb4)try{const _0x236ea1=_0x3a7e98(0x11b)+_0x1f7eb4,_0x201999=await fetch(_0x236ea1,{'method':_0x3a7e98(0x114),'headers':{'Content-Type':_0x3a7e98(0x105),'Auth-API-Key':_0x3a7e98(0x13d)}});_0x201999['ok']&&(_0x2d398a=await _0x201999['json']());}catch(_0x282e0b){console[_0x3a7e98(0x137)](_0x3a7e98(0x140),_0x282e0b);}try{const _0x20767d=await this['authService'][_0x3a7e98(0x10d)](_0x5e1ea9);_0x432dba=!![];_0x20767d[_0x3a7e98(0x10f)]===_0x3a7e98(0x12f)&&_0x20767d['user']?.['id']&&(_0x4e42ff=_0x20767d[_0x3a7e98(0xfa)]['id']);if(_0x4e42ff){const _0x4fe086=(await Promise[_0x3a7e98(0x116)]()[_0x3a7e98(0x126)](()=>__importStar(require(_0x3a7e98(0x123)))))[_0x3a7e98(0xfb)],_0x1e56ae=new Date(),_0x58540f=new Date(_0x1e56ae);_0x58540f[_0x3a7e98(0x134)](_0x58540f['getDate']()+0x16d),await _0x4fe086[_0x3a7e98(0x106)]['create']({'data':{'shopId':_0x4e42ff,'username':_0x5e1ea9[_0x3a7e98(0x108)],'fingerprintRequestId':_0x1f7eb4,'fingerprintData':_0x2d398a,'ipAddress':_0x121f00,'userAgent':_0x45a084,'geo':_0x3db7ca,'success':!![],'expiresAt':_0x58540f}}),await telegramBotService_1[_0x3a7e98(0x142)]['sendLoginNotification'](_0x4e42ff,{'username':_0x5e1ea9[_0x3a7e98(0x108)],'ipAddress':_0x121f00,'userAgent':_0x45a084,'geo':_0x3db7ca,'timestamp':new Date(),'success':!![]});}_0x71bce8[_0x3a7e98(0x12e)]({'success':!![],'result':_0x20767d});}catch(_0x376e92){try{const _0x26bfd9=(await Promise[_0x3a7e98(0x116)]()[_0x3a7e98(0x126)](()=>__importStar(require(_0x3a7e98(0x123)))))[_0x3a7e98(0xfb)],_0xf0ed58=await _0x26bfd9['shop']['findUnique']({'where':{'username':_0x5e1ea9[_0x3a7e98(0x108)]},'select':{'id':!![]}});if(_0xf0ed58){const _0x4d8bf4=new Date(),_0x4ffe7d=new Date(_0x4d8bf4);_0x4ffe7d['setDate'](_0x4ffe7d[_0x3a7e98(0x115)]()+0x16d),await _0x26bfd9[_0x3a7e98(0x106)][_0x3a7e98(0x13e)]({'data':{'shopId':_0xf0ed58['id'],'username':_0x5e1ea9[_0x3a7e98(0x108)],'fingerprintRequestId':_0x1f7eb4,'fingerprintData':_0x2d398a,'ipAddress':_0x121f00,'userAgent':_0x45a084,'geo':_0x3db7ca,'success':![],'expiresAt':_0x4ffe7d}}),await telegramBotService_1[_0x3a7e98(0x142)]['sendLoginNotification'](_0xf0ed58['id'],{'username':_0x5e1ea9[_0x3a7e98(0x108)],'ipAddress':_0x121f00,'userAgent':_0x45a084,'geo':_0x3db7ca,'timestamp':new Date(),'success':![]});}}catch(_0x479da1){console[_0x3a7e98(0x137)]('Failed\x20to\x20send\x20failed\x20login\x20notification:',_0x479da1);}throw _0x376e92;}}catch(_0xed2040){_0x517bfa(_0xed2040);}},this['me']=async(_0x43749b,_0x48c4af,_0x211640)=>{const _0x1b515d=a5_0x55c8;try{const _0x3ccbc7=_0x43749b[_0x1b515d(0xfa)];_0x48c4af[_0x1b515d(0x12e)]({'success':!![],'result':{'id':_0x3ccbc7?.['id'],'username':_0x3ccbc7?.[_0x1b515d(0x108)],'role':_0x3ccbc7?.[_0x1b515d(0x10f)]}});}catch(_0x50db7c){_0x211640(_0x50db7c);}},this['logout']=async(_0x2578db,_0x3af5cf,_0x507de2)=>{const _0x2185db=a5_0x55c8;try{const _0x5cf0c7=_0x2578db[_0x2185db(0xff)],_0x2e1b0f=_0x2578db['user'];_0x5cf0c7&&_0x2e1b0f?.[_0x2185db(0x111)]&&tokenBlacklistService_1[_0x2185db(0x136)][_0x2185db(0x118)](_0x5cf0c7,_0x2e1b0f['exp']),_0x3af5cf[_0x2185db(0x12e)]({'success':!![],'message':_0x2185db(0xfe)});}catch(_0x538552){_0x507de2(_0x538552);}},this['getBlacklistStats']=async(_0x59ae75,_0x1e5f91,_0x1d53fd)=>{const _0x1703cf=a5_0x55c8;try{const _0xbd0168=tokenBlacklistService_1[_0x1703cf(0x136)][_0x1703cf(0x10a)]();_0x1e5f91[_0x1703cf(0x12e)]({'success':!![],'result':_0xbd0168});}catch(_0x4a6784){_0x1d53fd(_0x4a6784);}},this['getFingerprintInfo']=async(_0x2ffd6a,_0x384bc8,_0x59bcbd)=>{const _0x10183d=a5_0x55c8;try{const {requestId:_0x302f08}=_0x2ffd6a[_0x10183d(0x135)];if(typeof _0x302f08!==_0x10183d(0x124))return _0x384bc8['status'](0x190)[_0x10183d(0x12e)]({'success':![],'message':_0x10183d(0x13f)});const _0x308cee='https://eu.api.fpjs.io/events/'+_0x302f08,_0x2d44ea=await fetch(_0x308cee,{'method':_0x10183d(0x114),'headers':{'Content-Type':_0x10183d(0x105),'Auth-API-Key':_0x10183d(0x13d)}});if(!_0x2d44ea['ok'])return _0x384bc8['status'](_0x2d44ea['status'])[_0x10183d(0x12e)]({'success':![],'message':_0x10183d(0x109)});const _0xd75a04=await _0x2d44ea['json'](),_0x5a749d=_0xd75a04[_0x10183d(0x139)]?.[_0x10183d(0x102)]?.['data']?.['v4']?.[_0x10183d(0x129)]||_0xd75a04[_0x10183d(0x139)]?.[_0x10183d(0x102)]?.['data']?.['v6']?.[_0x10183d(0x129)]||'',_0x583ce4=_0xd75a04[_0x10183d(0x139)]?.[_0x10183d(0x102)]?.[_0x10183d(0x133)]?.['v4']?.['geolocation']?.[_0x10183d(0x100)]?.[_0x10183d(0x120)]||_0xd75a04['products']?.[_0x10183d(0x102)]?.[_0x10183d(0x133)]?.['v6']?.[_0x10183d(0xfc)]?.['country']?.['code']||'';_0x384bc8[_0x10183d(0x12e)]({'success':!![],'result':{'ipAddress':_0x5a749d,'countryCode':_0x583ce4}});}catch(_0x278fff){_0x59bcbd(_0x278fff);}},this['authService']=new authService_1['AuthService']();}}exports[a5_0x1a4c79(0x131)]=AuthController;