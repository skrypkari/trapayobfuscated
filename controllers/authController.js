'use strict';const a5_0x44bcce=a5_0x1b74;(function(_0x36f48f,_0x434902){const _0x5a0e45=a5_0x1b74,_0x2232aa=_0x36f48f();while(!![]){try{const _0x4f8a76=parseInt(_0x5a0e45(0x87))/0x1+-parseInt(_0x5a0e45(0xb0))/0x2*(-parseInt(_0x5a0e45(0xa0))/0x3)+-parseInt(_0x5a0e45(0xa9))/0x4+parseInt(_0x5a0e45(0x84))/0x5*(-parseInt(_0x5a0e45(0xa2))/0x6)+parseInt(_0x5a0e45(0x82))/0x7+parseInt(_0x5a0e45(0x85))/0x8*(-parseInt(_0x5a0e45(0xa4))/0x9)+parseInt(_0x5a0e45(0xa7))/0xa;if(_0x4f8a76===_0x434902)break;else _0x2232aa['push'](_0x2232aa['shift']());}catch(_0x310aac){_0x2232aa['push'](_0x2232aa['shift']());}}}(a5_0x1617,0x9eda8));var __createBinding=this&&this[a5_0x44bcce(0x94)]||(Object[a5_0x44bcce(0x68)]?function(_0x24ef52,_0x5ae4ad,_0x51ce9f,_0x1cf428){const _0x3cba7e=a5_0x44bcce;if(_0x1cf428===undefined)_0x1cf428=_0x51ce9f;var _0x1902d0=Object[_0x3cba7e(0x93)](_0x5ae4ad,_0x51ce9f);(!_0x1902d0||('get'in _0x1902d0?!_0x5ae4ad[_0x3cba7e(0x88)]:_0x1902d0['writable']||_0x1902d0[_0x3cba7e(0x7a)]))&&(_0x1902d0={'enumerable':!![],'get':function(){return _0x5ae4ad[_0x51ce9f];}}),Object[_0x3cba7e(0x98)](_0x24ef52,_0x1cf428,_0x1902d0);}:function(_0x3fd4b1,_0x1ff90f,_0x244a7d,_0x18c807){if(_0x18c807===undefined)_0x18c807=_0x244a7d;_0x3fd4b1[_0x18c807]=_0x1ff90f[_0x244a7d];}),__setModuleDefault=this&&this[a5_0x44bcce(0x6b)]||(Object[a5_0x44bcce(0x68)]?function(_0x3b58b1,_0x7c4625){const _0xf2ea85=a5_0x44bcce;Object[_0xf2ea85(0x98)](_0x3b58b1,_0xf2ea85(0x8f),{'enumerable':!![],'value':_0x7c4625});}:function(_0x131dde,_0x6fee2c){const _0x484224=a5_0x44bcce;_0x131dde[_0x484224(0x8f)]=_0x6fee2c;}),__importStar=this&&this[a5_0x44bcce(0x8e)]||(function(){var _0x357e20=function(_0x4a9187){const _0x4d66c5=a5_0x1b74;return _0x357e20=Object[_0x4d66c5(0xae)]||function(_0x15fba6){const _0xdb7a3d=_0x4d66c5;var _0x286be7=[];for(var _0x1f05cb in _0x15fba6)if(Object[_0xdb7a3d(0x9a)][_0xdb7a3d(0x8d)][_0xdb7a3d(0xaf)](_0x15fba6,_0x1f05cb))_0x286be7[_0x286be7['length']]=_0x1f05cb;return _0x286be7;},_0x357e20(_0x4a9187);};return function(_0x4766a4){const _0x5094d8=a5_0x1b74;if(_0x4766a4&&_0x4766a4[_0x5094d8(0x88)])return _0x4766a4;var _0x3812af={};if(_0x4766a4!=null){for(var _0x864dd8=_0x357e20(_0x4766a4),_0x155ddf=0x0;_0x155ddf<_0x864dd8['length'];_0x155ddf++)if(_0x864dd8[_0x155ddf]!==_0x5094d8(0x8f))__createBinding(_0x3812af,_0x4766a4,_0x864dd8[_0x155ddf]);}return __setModuleDefault(_0x3812af,_0x4766a4),_0x3812af;};}());Object[a5_0x44bcce(0x98)](exports,'__esModule',{'value':!![]}),exports[a5_0x44bcce(0x76)]=void 0x0;function a5_0x1b74(_0x144403,_0x2c9c4e){_0x144403=_0x144403-0x68;const _0x161746=a5_0x1617();let _0x1b7414=_0x161746[_0x144403];return _0x1b7414;}const authService_1=require('../services/authService'),tokenBlacklistService_1=require(a5_0x44bcce(0x7e)),telegramBotService_1=require('../services/telegramBotService');class AuthController{constructor(){const _0x137d4c=a5_0x44bcce;this[_0x137d4c(0x92)]=async(_0x2c2448,_0x3e740e,_0x19c691)=>{const _0x4c1386=_0x137d4c;try{const _0x2a7e05=_0x2c2448[_0x4c1386(0x7b)],_0x483e92=_0x2a7e05[_0x4c1386(0x75)]||_0x2c2448['ip']||_0x2c2448[_0x4c1386(0x96)]['remoteAddress']||_0x4c1386(0x91),_0x1763aa=_0x2a7e05[_0x4c1386(0x97)]||_0x2c2448[_0x4c1386(0x7d)](_0x4c1386(0xb1))||_0x4c1386(0x91),_0x263001=_0x2a7e05[_0x4c1386(0xac)],_0x27da1e=_0x2a7e05[_0x4c1386(0x6a)];let _0x554cf5=![],_0x22e331=null,_0x5e31d7=null;if(_0x27da1e)try{const _0x3ece3a=_0x4c1386(0x79)+_0x27da1e,_0x5aea65=await fetch(_0x3ece3a,{'method':'GET','headers':{'Content-Type':_0x4c1386(0xab),'Auth-API-Key':_0x4c1386(0x72)}});_0x5aea65['ok']&&(_0x5e31d7=await _0x5aea65[_0x4c1386(0xaa)]());}catch(_0x46d034){console[_0x4c1386(0x9c)](_0x4c1386(0xa1),_0x46d034);}try{const _0x577ec0=await this[_0x4c1386(0x6d)][_0x4c1386(0x92)](_0x2a7e05);_0x554cf5=!![];_0x577ec0[_0x4c1386(0x8b)]===_0x4c1386(0xad)&&_0x577ec0[_0x4c1386(0x78)]?.['id']&&(_0x22e331=_0x577ec0[_0x4c1386(0x78)]['id']);if(_0x22e331){const _0x2151f5=(await Promise[_0x4c1386(0x95)]()[_0x4c1386(0x8a)](()=>__importStar(require('../config/database'))))['default'],_0x18b02c=new Date(),_0x4347b3=new Date(_0x18b02c);_0x4347b3[_0x4c1386(0x9d)](_0x4347b3[_0x4c1386(0xa6)]()+0x16d),await _0x2151f5[_0x4c1386(0x8c)][_0x4c1386(0x68)]({'data':{'shopId':_0x22e331,'username':_0x2a7e05['username'],'fingerprintRequestId':_0x27da1e,'fingerprintData':_0x5e31d7,'ipAddress':_0x483e92,'userAgent':_0x1763aa,'geo':_0x263001,'success':!![],'expiresAt':_0x4347b3}}),await telegramBotService_1[_0x4c1386(0x9f)][_0x4c1386(0x83)](_0x22e331,{'username':_0x2a7e05[_0x4c1386(0x81)],'ipAddress':_0x483e92,'userAgent':_0x1763aa,'geo':_0x263001,'timestamp':new Date(),'success':!![]});}_0x3e740e[_0x4c1386(0xaa)]({'success':!![],'result':_0x577ec0});}catch(_0x345100){try{const _0x150cc7=(await Promise[_0x4c1386(0x95)]()[_0x4c1386(0x8a)](()=>__importStar(require(_0x4c1386(0xa5)))))[_0x4c1386(0x8f)],_0x517d21=await _0x150cc7[_0x4c1386(0xad)][_0x4c1386(0x77)]({'where':{'username':_0x2a7e05[_0x4c1386(0x81)]},'select':{'id':!![]}});if(_0x517d21){const _0x1fb5ba=new Date(),_0x3cbf3d=new Date(_0x1fb5ba);_0x3cbf3d[_0x4c1386(0x9d)](_0x3cbf3d[_0x4c1386(0xa6)]()+0x16d),await _0x150cc7[_0x4c1386(0x8c)]['create']({'data':{'shopId':_0x517d21['id'],'username':_0x2a7e05['username'],'fingerprintRequestId':_0x27da1e,'fingerprintData':_0x5e31d7,'ipAddress':_0x483e92,'userAgent':_0x1763aa,'geo':_0x263001,'success':![],'expiresAt':_0x3cbf3d}}),await telegramBotService_1[_0x4c1386(0x9f)][_0x4c1386(0x83)](_0x517d21['id'],{'username':_0x2a7e05['username'],'ipAddress':_0x483e92,'userAgent':_0x1763aa,'geo':_0x263001,'timestamp':new Date(),'success':![]});}}catch(_0x3eed78){console[_0x4c1386(0x9c)](_0x4c1386(0x73),_0x3eed78);}throw _0x345100;}}catch(_0x10d3ef){_0x19c691(_0x10d3ef);}},this['me']=async(_0xe6e2d1,_0xc91b89,_0x33f186)=>{const _0x1ad35b=_0x137d4c;try{const _0x3873d5=_0xe6e2d1[_0x1ad35b(0x78)];_0xc91b89[_0x1ad35b(0xaa)]({'success':!![],'result':{'id':_0x3873d5?.['id'],'username':_0x3873d5?.[_0x1ad35b(0x81)],'role':_0x3873d5?.['role']}});}catch(_0x51300f){_0x33f186(_0x51300f);}},this[_0x137d4c(0xa8)]=async(_0x5e2149,_0x24d59f,_0x198d09)=>{const _0x10680d=_0x137d4c;try{const _0x2e38d1=_0x5e2149['token'],_0x47d02b=_0x5e2149[_0x10680d(0x78)];_0x2e38d1&&_0x47d02b?.[_0x10680d(0x99)]&&tokenBlacklistService_1['tokenBlacklistService']['blacklistToken'](_0x2e38d1,_0x47d02b[_0x10680d(0x99)]),_0x24d59f[_0x10680d(0xaa)]({'success':!![],'message':_0x10680d(0x69)});}catch(_0x37346a){_0x198d09(_0x37346a);}},this[_0x137d4c(0x71)]=async(_0x271ad8,_0x2f1d41,_0x1aa73f)=>{const _0x3287fa=_0x137d4c;try{const _0x45c206=tokenBlacklistService_1[_0x3287fa(0x70)]['getStats']();_0x2f1d41[_0x3287fa(0xaa)]({'success':!![],'result':_0x45c206});}catch(_0x359f19){_0x1aa73f(_0x359f19);}},this[_0x137d4c(0x7f)]=async(_0x1b6b11,_0x4c7833,_0x712ebd)=>{const _0x3d92ef=_0x137d4c;try{const {requestId:_0xfe8716}=_0x1b6b11[_0x3d92ef(0x80)];if(typeof _0xfe8716!==_0x3d92ef(0xa3))return _0x4c7833[_0x3d92ef(0x7c)](0x190)[_0x3d92ef(0xaa)]({'success':![],'message':_0x3d92ef(0x86)});const _0xb1f11d=_0x3d92ef(0x79)+_0xfe8716,_0x28fc4a=await fetch(_0xb1f11d,{'method':_0x3d92ef(0x89),'headers':{'Content-Type':_0x3d92ef(0xab),'Auth-API-Key':_0x3d92ef(0x72)}});if(!_0x28fc4a['ok'])return _0x4c7833['status'](_0x28fc4a[_0x3d92ef(0x7c)])[_0x3d92ef(0xaa)]({'success':![],'message':_0x3d92ef(0x6c)});const _0x4da940=await _0x28fc4a[_0x3d92ef(0xaa)](),_0x93c8a7=_0x4da940[_0x3d92ef(0x9b)]?.['ipInfo']?.[_0x3d92ef(0x74)]?.['v4']?.[_0x3d92ef(0x9e)]||_0x4da940[_0x3d92ef(0x9b)]?.[_0x3d92ef(0x90)]?.[_0x3d92ef(0x74)]?.['v6']?.['address']||'',_0x2cfee5=_0x4da940[_0x3d92ef(0x9b)]?.[_0x3d92ef(0x90)]?.[_0x3d92ef(0x74)]?.['v4']?.['geolocation']?.['country']?.[_0x3d92ef(0x6f)]||_0x4da940[_0x3d92ef(0x9b)]?.[_0x3d92ef(0x90)]?.[_0x3d92ef(0x74)]?.['v6']?.['geolocation']?.[_0x3d92ef(0x6e)]?.['code']||'';_0x4c7833[_0x3d92ef(0xaa)]({'success':!![],'result':{'ipAddress':_0x93c8a7,'countryCode':_0x2cfee5}});}catch(_0x2eae3d){_0x712ebd(_0x2eae3d);}},this[_0x137d4c(0x6d)]=new authService_1['AuthService']();}}function a5_0x1617(){const _0x10a201=['user','https://eu.api.fpjs.io/events/','configurable','body','status','get','../services/tokenBlacklistService','getFingerprintInfo','query','username','8662612BvLeiK','sendLoginNotification','166795fWmxgu','8FMLofe','requestId\x20query\x20parameter\x20is\x20required','42102QpMrnr','__esModule','GET','then','role','loginLog','hasOwnProperty','__importStar','default','ipInfo','unknown','login','getOwnPropertyDescriptor','__createBinding','resolve','connection','userAgent','defineProperty','exp','prototype','products','error','setDate','address','telegramBotService','3hrBXhE','Failed\x20to\x20fetch\x20fingerprint\x20data:','114UjABeX','string','6396345OCCPWz','../config/database','getDate','11238600ebVdXi','logout','1909260UFdrAU','json','application/json','geo','shop','getOwnPropertyNames','call','138054iDCNRG','User-Agent','create','Logged\x20out\x20successfully','fingerprintRequestId','__setModuleDefault','Failed\x20to\x20retrieve\x20fingerprint\x20data','authService','country','code','tokenBlacklistService','getBlacklistStats','anJngmXQVawz37L0S21u','Failed\x20to\x20send\x20failed\x20login\x20notification:','data','ipAddress','AuthController','findUnique'];a5_0x1617=function(){return _0x10a201;};return a5_0x1617();}exports[a5_0x44bcce(0x76)]=AuthController;