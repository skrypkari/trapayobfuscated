'use strict';function a5_0x2a5c(){const _0x2b3f1e=['../services/tokenBlacklistService','logout','8HrORcN','prototype','products','default','resolve','getFingerprintInfo','1803408gpzJrq','body','token','../config/database','__setModuleDefault','hasOwnProperty','address','fingerprintRequestId','findUnique','10KgPZFu','GET','1475181AZiRcD','__importStar','https://eu.api.fpjs.io/events/','application/json','anJngmXQVawz37L0S21u','defineProperty','getDate','getOwnPropertyDescriptor','shop','create','loginLog','username','AuthController','geolocation','16843068jNWwWw','1990290BpHmmx','ipAddress','sendLoginNotification','country','string','query','__esModule','__createBinding','ipInfo','writable','2405244XcrKEG','data','User-Agent','../services/authService','connection','role','status','Failed\x20to\x20fetch\x20fingerprint\x20data:','unknown','getBlacklistStats','getStats','json','telegramBotService','blacklistToken','2440115iODItf','setDate','authService','4quyRwr','then','configurable','user','tokenBlacklistService','2326219klfCbx','code','exp','error'];a5_0x2a5c=function(){return _0x2b3f1e;};return a5_0x2a5c();}const a5_0x109e7e=a5_0x408e;function a5_0x408e(_0x1f29cf,_0x27274e){_0x1f29cf=_0x1f29cf-0x189;const _0x2a5c83=a5_0x2a5c();let _0x408eca=_0x2a5c83[_0x1f29cf];return _0x408eca;}(function(_0x29b122,_0xb532a0){const _0xfb19fb=a5_0x408e,_0x31c804=_0x29b122();while(!![]){try{const _0x5a68ff=-parseInt(_0xfb19fb(0x1bc))/0x1+-parseInt(_0xfb19fb(0x1a0))/0x2*(-parseInt(_0xfb19fb(0x1b1))/0x3)+-parseInt(_0xfb19fb(0x18f))/0x4+parseInt(_0xfb19fb(0x19d))/0x5+-parseInt(_0xfb19fb(0x1cb))/0x6+parseInt(_0xfb19fb(0x1a5))/0x7*(-parseInt(_0xfb19fb(0x1ab))/0x8)+parseInt(_0xfb19fb(0x1ca))/0x9*(parseInt(_0xfb19fb(0x1ba))/0xa);if(_0x5a68ff===_0xb532a0)break;else _0x31c804['push'](_0x31c804['shift']());}catch(_0x286644){_0x31c804['push'](_0x31c804['shift']());}}}(a5_0x2a5c,0xc87e7));var __createBinding=this&&this[a5_0x109e7e(0x18c)]||(Object[a5_0x109e7e(0x1c5)]?function(_0x5b3b46,_0x22e929,_0x265ccf,_0x20b864){const _0x508a4b=a5_0x109e7e;if(_0x20b864===undefined)_0x20b864=_0x265ccf;var _0x44c412=Object[_0x508a4b(0x1c3)](_0x22e929,_0x265ccf);(!_0x44c412||('get'in _0x44c412?!_0x22e929[_0x508a4b(0x18b)]:_0x44c412[_0x508a4b(0x18e)]||_0x44c412[_0x508a4b(0x1a2)]))&&(_0x44c412={'enumerable':!![],'get':function(){return _0x22e929[_0x265ccf];}}),Object['defineProperty'](_0x5b3b46,_0x20b864,_0x44c412);}:function(_0x4155ec,_0x1b2be1,_0x48c363,_0x413788){if(_0x413788===undefined)_0x413788=_0x48c363;_0x4155ec[_0x413788]=_0x1b2be1[_0x48c363];}),__setModuleDefault=this&&this[a5_0x109e7e(0x1b5)]||(Object[a5_0x109e7e(0x1c5)]?function(_0x531483,_0x110e7e){const _0x24c727=a5_0x109e7e;Object[_0x24c727(0x1c1)](_0x531483,_0x24c727(0x1ae),{'enumerable':!![],'value':_0x110e7e});}:function(_0x789dd7,_0x1fa4f2){const _0x16151b=a5_0x109e7e;_0x789dd7[_0x16151b(0x1ae)]=_0x1fa4f2;}),__importStar=this&&this[a5_0x109e7e(0x1bd)]||(function(){var _0x2e86f8=function(_0x28f0fe){return _0x2e86f8=Object['getOwnPropertyNames']||function(_0xe22513){const _0x378025=a5_0x408e;var _0x42c990=[];for(var _0x2810b7 in _0xe22513)if(Object[_0x378025(0x1ac)][_0x378025(0x1b6)]['call'](_0xe22513,_0x2810b7))_0x42c990[_0x42c990['length']]=_0x2810b7;return _0x42c990;},_0x2e86f8(_0x28f0fe);};return function(_0x1d9471){const _0x5cf8fa=a5_0x408e;if(_0x1d9471&&_0x1d9471['__esModule'])return _0x1d9471;var _0x105908={};if(_0x1d9471!=null){for(var _0x305e93=_0x2e86f8(_0x1d9471),_0x424367=0x0;_0x424367<_0x305e93['length'];_0x424367++)if(_0x305e93[_0x424367]!==_0x5cf8fa(0x1ae))__createBinding(_0x105908,_0x1d9471,_0x305e93[_0x424367]);}return __setModuleDefault(_0x105908,_0x1d9471),_0x105908;};}());Object[a5_0x109e7e(0x1c1)](exports,a5_0x109e7e(0x18b),{'value':!![]}),exports[a5_0x109e7e(0x1c8)]=void 0x0;const authService_1=require(a5_0x109e7e(0x192)),tokenBlacklistService_1=require(a5_0x109e7e(0x1a9)),telegramBotService_1=require('../services/telegramBotService');class AuthController{constructor(){const _0x59b638=a5_0x109e7e;this['login']=async(_0x4bdb9c,_0x470de3,_0x58ab65)=>{const _0x2240a2=a5_0x408e;try{const _0x8ac65c=_0x4bdb9c[_0x2240a2(0x1b2)],_0x336c60=_0x8ac65c[_0x2240a2(0x1cc)]||_0x4bdb9c['ip']||_0x4bdb9c[_0x2240a2(0x193)]['remoteAddress']||_0x2240a2(0x197),_0x413009=_0x8ac65c['userAgent']||_0x4bdb9c['get'](_0x2240a2(0x191))||_0x2240a2(0x197),_0x2fe8ec=_0x8ac65c['geo'],_0x47c52d=_0x8ac65c[_0x2240a2(0x1b8)];let _0x48504d=![],_0x1b8d92=null,_0x20d88a=null;if(_0x47c52d)try{const _0x3564fa=_0x2240a2(0x1be)+_0x47c52d,_0x210054=await fetch(_0x3564fa,{'method':_0x2240a2(0x1bb),'headers':{'Content-Type':_0x2240a2(0x1bf),'Auth-API-Key':_0x2240a2(0x1c0)}});_0x210054['ok']&&(_0x20d88a=await _0x210054[_0x2240a2(0x19a)]());}catch(_0x2c95aa){console[_0x2240a2(0x1a8)](_0x2240a2(0x196),_0x2c95aa);}try{const _0x471a87=await this[_0x2240a2(0x19f)]['login'](_0x8ac65c);_0x48504d=!![];_0x471a87['role']===_0x2240a2(0x1c4)&&_0x471a87['user']?.['id']&&(_0x1b8d92=_0x471a87[_0x2240a2(0x1a3)]['id']);if(_0x1b8d92){const _0x51a864=(await Promise[_0x2240a2(0x1af)]()[_0x2240a2(0x1a1)](()=>__importStar(require(_0x2240a2(0x1b4)))))[_0x2240a2(0x1ae)],_0x2c6d4d=new Date(),_0xccbcc7=new Date(_0x2c6d4d);_0xccbcc7['setDate'](_0xccbcc7[_0x2240a2(0x1c2)]()+0x16d),await _0x51a864[_0x2240a2(0x1c6)][_0x2240a2(0x1c5)]({'data':{'shopId':_0x1b8d92,'username':_0x8ac65c[_0x2240a2(0x1c7)],'fingerprintRequestId':_0x47c52d,'fingerprintData':_0x20d88a,'ipAddress':_0x336c60,'userAgent':_0x413009,'geo':_0x2fe8ec,'success':!![],'expiresAt':_0xccbcc7}}),await telegramBotService_1['telegramBotService'][_0x2240a2(0x1cd)](_0x1b8d92,{'username':_0x8ac65c[_0x2240a2(0x1c7)],'ipAddress':_0x336c60,'userAgent':_0x413009,'geo':_0x2fe8ec,'timestamp':new Date(),'success':!![]});}_0x470de3[_0x2240a2(0x19a)]({'success':!![],'result':_0x471a87});}catch(_0x1263b0){try{const _0xe94664=(await Promise['resolve']()['then'](()=>__importStar(require('../config/database'))))['default'],_0x45ad62=await _0xe94664[_0x2240a2(0x1c4)][_0x2240a2(0x1b9)]({'where':{'username':_0x8ac65c['username']},'select':{'id':!![]}});if(_0x45ad62){const _0xc18f90=new Date(),_0x5aec5a=new Date(_0xc18f90);_0x5aec5a[_0x2240a2(0x19e)](_0x5aec5a['getDate']()+0x16d),await _0xe94664[_0x2240a2(0x1c6)][_0x2240a2(0x1c5)]({'data':{'shopId':_0x45ad62['id'],'username':_0x8ac65c[_0x2240a2(0x1c7)],'fingerprintRequestId':_0x47c52d,'fingerprintData':_0x20d88a,'ipAddress':_0x336c60,'userAgent':_0x413009,'geo':_0x2fe8ec,'success':![],'expiresAt':_0x5aec5a}}),await telegramBotService_1[_0x2240a2(0x19b)][_0x2240a2(0x1cd)](_0x45ad62['id'],{'username':_0x8ac65c[_0x2240a2(0x1c7)],'ipAddress':_0x336c60,'userAgent':_0x413009,'geo':_0x2fe8ec,'timestamp':new Date(),'success':![]});}}catch(_0x19dc8c){console[_0x2240a2(0x1a8)]('Failed\x20to\x20send\x20failed\x20login\x20notification:',_0x19dc8c);}throw _0x1263b0;}}catch(_0x198201){_0x58ab65(_0x198201);}},this['me']=async(_0x14a102,_0x405c39,_0x2a29ee)=>{const _0x45267f=a5_0x408e;try{const _0x5c0dc7=_0x14a102[_0x45267f(0x1a3)];_0x405c39[_0x45267f(0x19a)]({'success':!![],'result':{'id':_0x5c0dc7?.['id'],'username':_0x5c0dc7?.[_0x45267f(0x1c7)],'role':_0x5c0dc7?.[_0x45267f(0x194)]}});}catch(_0x34751f){_0x2a29ee(_0x34751f);}},this[_0x59b638(0x1aa)]=async(_0x134d3f,_0x391d38,_0x564c54)=>{const _0x399647=_0x59b638;try{const _0xe41607=_0x134d3f[_0x399647(0x1b3)],_0x5ce6ef=_0x134d3f[_0x399647(0x1a3)];_0xe41607&&_0x5ce6ef?.[_0x399647(0x1a7)]&&tokenBlacklistService_1[_0x399647(0x1a4)][_0x399647(0x19c)](_0xe41607,_0x5ce6ef['exp']),_0x391d38[_0x399647(0x19a)]({'success':!![],'message':'Logged\x20out\x20successfully'});}catch(_0x204cb8){_0x564c54(_0x204cb8);}},this[_0x59b638(0x198)]=async(_0x2ea8eb,_0x183faa,_0x47b759)=>{const _0x1eec66=_0x59b638;try{const _0x5244da=tokenBlacklistService_1['tokenBlacklistService'][_0x1eec66(0x199)]();_0x183faa[_0x1eec66(0x19a)]({'success':!![],'result':_0x5244da});}catch(_0x52f493){_0x47b759(_0x52f493);}},this[_0x59b638(0x1b0)]=async(_0x2e4f88,_0x19cdcd,_0x2a10e7)=>{const _0x4a1b83=_0x59b638;try{const {requestId:_0x4e18c4}=_0x2e4f88[_0x4a1b83(0x18a)];if(typeof _0x4e18c4!==_0x4a1b83(0x189))return _0x19cdcd[_0x4a1b83(0x195)](0x190)[_0x4a1b83(0x19a)]({'success':![],'message':'requestId\x20query\x20parameter\x20is\x20required'});const _0x1a263a='https://eu.api.fpjs.io/events/'+_0x4e18c4,_0x489a9f=await fetch(_0x1a263a,{'method':'GET','headers':{'Content-Type':_0x4a1b83(0x1bf),'Auth-API-Key':_0x4a1b83(0x1c0)}});if(!_0x489a9f['ok'])return _0x19cdcd['status'](_0x489a9f[_0x4a1b83(0x195)])[_0x4a1b83(0x19a)]({'success':![],'message':'Failed\x20to\x20retrieve\x20fingerprint\x20data'});const _0x1a26cb=await _0x489a9f[_0x4a1b83(0x19a)](),_0x4c7961=_0x1a26cb[_0x4a1b83(0x1ad)]?.[_0x4a1b83(0x18d)]?.[_0x4a1b83(0x190)]?.['v4']?.[_0x4a1b83(0x1b7)]||_0x1a26cb[_0x4a1b83(0x1ad)]?.[_0x4a1b83(0x18d)]?.[_0x4a1b83(0x190)]?.['v6']?.[_0x4a1b83(0x1b7)]||'',_0xb73ba5=_0x1a26cb[_0x4a1b83(0x1ad)]?.['ipInfo']?.[_0x4a1b83(0x190)]?.['v4']?.['geolocation']?.[_0x4a1b83(0x1ce)]?.[_0x4a1b83(0x1a6)]||_0x1a26cb['products']?.[_0x4a1b83(0x18d)]?.[_0x4a1b83(0x190)]?.['v6']?.[_0x4a1b83(0x1c9)]?.['country']?.['code']||'';_0x19cdcd[_0x4a1b83(0x19a)]({'success':!![],'result':{'ipAddress':_0x4c7961,'countryCode':_0xb73ba5}});}catch(_0x56dc16){_0x2a10e7(_0x56dc16);}},this[_0x59b638(0x19f)]=new authService_1['AuthService']();}}exports[a5_0x109e7e(0x1c8)]=AuthController;