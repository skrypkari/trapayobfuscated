'use strict';const a5_0x431198=a5_0x4c50;function a5_0x4130(){const _0x3fb098=['application/json','call','status','logout','token','error','country','__createBinding','then','__esModule','sendLoginNotification','GET','User-Agent','username','products','length','geo','code','blacklistToken','../services/telegramBotService','role','tokenBlacklistService','connection','remoteAddress','geolocation','default','getDate','data','get','address','create','Failed\x20to\x20fetch\x20fingerprint\x20data:','fingerprintRequestId','configurable','exp','user','shop','userAgent','Failed\x20to\x20send\x20failed\x20login\x20notification:','getFingerprintInfo','findUnique','loginLog','__importStar','Logged\x20out\x20successfully','unknown','https://eu.api.fpjs.io/events/','AuthController','3042200lDzrMt','AuthService','148vScAAY','anJngmXQVawz37L0S21u','5965040DWYKvV','2031585ynYJsY','hasOwnProperty','requestId\x20query\x20parameter\x20is\x20required','253224OGbWde','30hbimQU','getOwnPropertyNames','login','Failed\x20to\x20retrieve\x20fingerprint\x20data','setDate','getBlacklistStats','12925260MbxoJB','defineProperty','telegramBotService','json','../config/database','10zDcfHj','__setModuleDefault','body','../services/authService','ipInfo','11633IMbPXR','2374757uOAHWB','authService','query','getStats'];a5_0x4130=function(){return _0x3fb098;};return a5_0x4130();}(function(_0x18066a,_0x51c9cf){const _0x21574a=a5_0x4c50,_0x5cea93=_0x18066a();while(!![]){try{const _0x177283=parseInt(_0x21574a(0xe9))/0x1*(parseInt(_0x21574a(0xd2))/0x2)+parseInt(_0x21574a(0xd5))/0x3+parseInt(_0x21574a(0xd8))/0x4*(parseInt(_0x21574a(0xe4))/0x5)+-parseInt(_0x21574a(0xd9))/0x6*(parseInt(_0x21574a(0xea))/0x7)+-parseInt(_0x21574a(0xd4))/0x8+parseInt(_0x21574a(0xdf))/0x9+parseInt(_0x21574a(0xd0))/0xa;if(_0x177283===_0x51c9cf)break;else _0x5cea93['push'](_0x5cea93['shift']());}catch(_0x34c624){_0x5cea93['push'](_0x5cea93['shift']());}}}(a5_0x4130,0xeb234));var __createBinding=this&&this[a5_0x431198(0xa8)]||(Object[a5_0x431198(0xbf)]?function(_0x40d126,_0x4334ad,_0x5292a0,_0x4fec1e){const _0x18651e=a5_0x431198;if(_0x4fec1e===undefined)_0x4fec1e=_0x5292a0;var _0x4929d5=Object['getOwnPropertyDescriptor'](_0x4334ad,_0x5292a0);(!_0x4929d5||(_0x18651e(0xbd)in _0x4929d5?!_0x4334ad[_0x18651e(0xaa)]:_0x4929d5['writable']||_0x4929d5[_0x18651e(0xc2)]))&&(_0x4929d5={'enumerable':!![],'get':function(){return _0x4334ad[_0x5292a0];}}),Object[_0x18651e(0xe0)](_0x40d126,_0x4fec1e,_0x4929d5);}:function(_0x23d605,_0x5b47f9,_0x54a580,_0x2f7d6c){if(_0x2f7d6c===undefined)_0x2f7d6c=_0x54a580;_0x23d605[_0x2f7d6c]=_0x5b47f9[_0x54a580];}),__setModuleDefault=this&&this[a5_0x431198(0xe5)]||(Object['create']?function(_0x501879,_0x3be749){const _0x5db62a=a5_0x431198;Object[_0x5db62a(0xe0)](_0x501879,_0x5db62a(0xba),{'enumerable':!![],'value':_0x3be749});}:function(_0x334412,_0xb793af){const _0x3cc562=a5_0x431198;_0x334412[_0x3cc562(0xba)]=_0xb793af;}),__importStar=this&&this[a5_0x431198(0xcb)]||(function(){var _0x36d23f=function(_0x3d0051){const _0x4b0bd4=a5_0x4c50;return _0x36d23f=Object[_0x4b0bd4(0xda)]||function(_0x3fca6a){const _0x92c49b=_0x4b0bd4;var _0x2912ab=[];for(var _0x289e79 in _0x3fca6a)if(Object['prototype'][_0x92c49b(0xd6)][_0x92c49b(0xef)](_0x3fca6a,_0x289e79))_0x2912ab[_0x2912ab[_0x92c49b(0xb0)]]=_0x289e79;return _0x2912ab;},_0x36d23f(_0x3d0051);};return function(_0x15d641){const _0xdc4438=a5_0x4c50;if(_0x15d641&&_0x15d641[_0xdc4438(0xaa)])return _0x15d641;var _0x45214d={};if(_0x15d641!=null){for(var _0x11ce89=_0x36d23f(_0x15d641),_0x306108=0x0;_0x306108<_0x11ce89[_0xdc4438(0xb0)];_0x306108++)if(_0x11ce89[_0x306108]!==_0xdc4438(0xba))__createBinding(_0x45214d,_0x15d641,_0x11ce89[_0x306108]);}return __setModuleDefault(_0x45214d,_0x15d641),_0x45214d;};}());Object[a5_0x431198(0xe0)](exports,a5_0x431198(0xaa),{'value':!![]}),exports[a5_0x431198(0xcf)]=void 0x0;const authService_1=require(a5_0x431198(0xe7)),tokenBlacklistService_1=require('../services/tokenBlacklistService'),telegramBotService_1=require(a5_0x431198(0xb4));class AuthController{constructor(){const _0x4f6be6=a5_0x431198;this['login']=async(_0x507056,_0x4b6441,_0x5a26d6)=>{const _0xd2e922=a5_0x4c50;try{const _0x1e73a6=_0x507056[_0xd2e922(0xe6)],_0x65788f=_0x1e73a6['ipAddress']||_0x507056['ip']||_0x507056[_0xd2e922(0xb7)][_0xd2e922(0xb8)]||_0xd2e922(0xcd),_0x5d8cfc=_0x1e73a6[_0xd2e922(0xc6)]||_0x507056[_0xd2e922(0xbd)](_0xd2e922(0xad))||_0xd2e922(0xcd),_0xf586d6=_0x1e73a6[_0xd2e922(0xb1)],_0x5b5498=_0x1e73a6[_0xd2e922(0xc1)];let _0x26e62b=![],_0x721b0a=null,_0x44447b=null;if(_0x5b5498)try{const _0x31a327=_0xd2e922(0xce)+_0x5b5498,_0x470ec9=await fetch(_0x31a327,{'method':_0xd2e922(0xac),'headers':{'Content-Type':_0xd2e922(0xee),'Auth-API-Key':_0xd2e922(0xd3)}});_0x470ec9['ok']&&(_0x44447b=await _0x470ec9[_0xd2e922(0xe2)]());}catch(_0x5966eb){console[_0xd2e922(0xa6)](_0xd2e922(0xc0),_0x5966eb);}try{const _0x26a94a=await this['authService'][_0xd2e922(0xdb)](_0x1e73a6);_0x26e62b=!![];_0x26a94a['role']===_0xd2e922(0xc5)&&_0x26a94a['user']?.['id']&&(_0x721b0a=_0x26a94a[_0xd2e922(0xc4)]['id']);if(_0x721b0a){const _0xef9f76=(await Promise['resolve']()[_0xd2e922(0xa9)](()=>__importStar(require(_0xd2e922(0xe3)))))['default'],_0x1df36a=new Date(),_0x3ca316=new Date(_0x1df36a);_0x3ca316[_0xd2e922(0xdd)](_0x3ca316['getDate']()+0x16d),await _0xef9f76[_0xd2e922(0xca)][_0xd2e922(0xbf)]({'data':{'shopId':_0x721b0a,'username':_0x1e73a6[_0xd2e922(0xae)],'fingerprintRequestId':_0x5b5498,'fingerprintData':_0x44447b,'ipAddress':_0x65788f,'userAgent':_0x5d8cfc,'geo':_0xf586d6,'success':!![],'expiresAt':_0x3ca316}}),await telegramBotService_1[_0xd2e922(0xe1)][_0xd2e922(0xab)](_0x721b0a,{'username':_0x1e73a6[_0xd2e922(0xae)],'ipAddress':_0x65788f,'userAgent':_0x5d8cfc,'geo':_0xf586d6,'timestamp':new Date(),'success':!![]});}_0x4b6441[_0xd2e922(0xe2)]({'success':!![],'result':_0x26a94a});}catch(_0x21c865){try{const _0x470b7a=(await Promise['resolve']()[_0xd2e922(0xa9)](()=>__importStar(require(_0xd2e922(0xe3)))))[_0xd2e922(0xba)],_0x47992c=await _0x470b7a[_0xd2e922(0xc5)][_0xd2e922(0xc9)]({'where':{'username':_0x1e73a6['username']},'select':{'id':!![]}});if(_0x47992c){const _0x242455=new Date(),_0x42c5ae=new Date(_0x242455);_0x42c5ae[_0xd2e922(0xdd)](_0x42c5ae[_0xd2e922(0xbb)]()+0x16d),await _0x470b7a[_0xd2e922(0xca)]['create']({'data':{'shopId':_0x47992c['id'],'username':_0x1e73a6[_0xd2e922(0xae)],'fingerprintRequestId':_0x5b5498,'fingerprintData':_0x44447b,'ipAddress':_0x65788f,'userAgent':_0x5d8cfc,'geo':_0xf586d6,'success':![],'expiresAt':_0x42c5ae}}),await telegramBotService_1[_0xd2e922(0xe1)][_0xd2e922(0xab)](_0x47992c['id'],{'username':_0x1e73a6[_0xd2e922(0xae)],'ipAddress':_0x65788f,'userAgent':_0x5d8cfc,'geo':_0xf586d6,'timestamp':new Date(),'success':![]});}}catch(_0x2e11a7){console[_0xd2e922(0xa6)](_0xd2e922(0xc7),_0x2e11a7);}throw _0x21c865;}}catch(_0x92de59){_0x5a26d6(_0x92de59);}},this['me']=async(_0x1ebdc4,_0x1b4225,_0x51e684)=>{const _0x2a201e=a5_0x4c50;try{const _0x1767c2=_0x1ebdc4[_0x2a201e(0xc4)];_0x1b4225['json']({'success':!![],'result':{'id':_0x1767c2?.['id'],'username':_0x1767c2?.[_0x2a201e(0xae)],'role':_0x1767c2?.[_0x2a201e(0xb5)]}});}catch(_0x8aab63){_0x51e684(_0x8aab63);}},this[_0x4f6be6(0xa4)]=async(_0x22b110,_0x5f4055,_0x562499)=>{const _0x536283=_0x4f6be6;try{const _0x1570b6=_0x22b110[_0x536283(0xa5)],_0x233c0c=_0x22b110[_0x536283(0xc4)];_0x1570b6&&_0x233c0c?.['exp']&&tokenBlacklistService_1[_0x536283(0xb6)][_0x536283(0xb3)](_0x1570b6,_0x233c0c[_0x536283(0xc3)]),_0x5f4055[_0x536283(0xe2)]({'success':!![],'message':_0x536283(0xcc)});}catch(_0x37ad64){_0x562499(_0x37ad64);}},this[_0x4f6be6(0xde)]=async(_0x250e80,_0x15c8dd,_0x4cbdff)=>{const _0x9866b5=_0x4f6be6;try{const _0x53c5e0=tokenBlacklistService_1[_0x9866b5(0xb6)][_0x9866b5(0xed)]();_0x15c8dd[_0x9866b5(0xe2)]({'success':!![],'result':_0x53c5e0});}catch(_0x578e0b){_0x4cbdff(_0x578e0b);}},this[_0x4f6be6(0xc8)]=async(_0x46a71e,_0x97924a,_0x2d6ed3)=>{const _0xb01f80=_0x4f6be6;try{const {requestId:_0x4142da}=_0x46a71e[_0xb01f80(0xec)];if(typeof _0x4142da!=='string')return _0x97924a[_0xb01f80(0xf0)](0x190)[_0xb01f80(0xe2)]({'success':![],'message':_0xb01f80(0xd7)});const _0x3ab9d3='https://eu.api.fpjs.io/events/'+_0x4142da,_0x42e146=await fetch(_0x3ab9d3,{'method':_0xb01f80(0xac),'headers':{'Content-Type':_0xb01f80(0xee),'Auth-API-Key':_0xb01f80(0xd3)}});if(!_0x42e146['ok'])return _0x97924a[_0xb01f80(0xf0)](_0x42e146[_0xb01f80(0xf0)])[_0xb01f80(0xe2)]({'success':![],'message':_0xb01f80(0xdc)});const _0x3d65e4=await _0x42e146[_0xb01f80(0xe2)](),_0xf46bb3=_0x3d65e4[_0xb01f80(0xaf)]?.['ipInfo']?.[_0xb01f80(0xbc)]?.['v4']?.[_0xb01f80(0xbe)]||_0x3d65e4[_0xb01f80(0xaf)]?.['ipInfo']?.[_0xb01f80(0xbc)]?.['v6']?.[_0xb01f80(0xbe)]||'',_0x3c07e8=_0x3d65e4[_0xb01f80(0xaf)]?.[_0xb01f80(0xe8)]?.[_0xb01f80(0xbc)]?.['v4']?.[_0xb01f80(0xb9)]?.[_0xb01f80(0xa7)]?.[_0xb01f80(0xb2)]||_0x3d65e4['products']?.[_0xb01f80(0xe8)]?.['data']?.['v6']?.[_0xb01f80(0xb9)]?.[_0xb01f80(0xa7)]?.['code']||'';_0x97924a[_0xb01f80(0xe2)]({'success':!![],'result':{'ipAddress':_0xf46bb3,'countryCode':_0x3c07e8}});}catch(_0x21d706){_0x2d6ed3(_0x21d706);}},this[_0x4f6be6(0xeb)]=new authService_1[(_0x4f6be6(0xd1))]();}}function a5_0x4c50(_0x448bf2,_0x30b4bc){_0x448bf2=_0x448bf2-0xa4;const _0x4130da=a5_0x4130();let _0x4c5004=_0x4130da[_0x448bf2];return _0x4c5004;}exports[a5_0x431198(0xcf)]=AuthController;