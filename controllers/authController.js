'use strict';function a4_0x5916(){const _0x567403=['get','json','tokenBlacklistService','3481092ZyBWUv','username','../services/telegramBotService','length','Logged\x20out\x20successfully','user','AuthController','3939957lWFMZD','shop','__importStar','writable','__esModule','prototype','telegramBotService','1941sYsXkA','1HadUKj','8ttmytB','1497474udQoHW','then','unknown','429HzRlAK','sendLoginNotification','227798tcelBh','create','../config/database','default','3116eOnGWD','148470lieSKu','token','getBlacklistStats','resolve','getOwnPropertyNames','error','AuthService','User-Agent','defineProperty','role','../services/authService','2018385igfnHe'];a4_0x5916=function(){return _0x567403;};return a4_0x5916();}const a4_0x2ef5c0=a4_0x5f01;(function(_0x12a05f,_0x20076f){const _0x1d900f=a4_0x5f01,_0x45a0b5=_0x12a05f();while(!![]){try{const _0x269c6d=-parseInt(_0x1d900f(0x1e7))/0x1*(-parseInt(_0x1d900f(0x1ee))/0x2)+parseInt(_0x1d900f(0x1e6))/0x3*(parseInt(_0x1d900f(0x1f2))/0x4)+parseInt(_0x1d900f(0x1fe))/0x5+-parseInt(_0x1d900f(0x202))/0x6+parseInt(_0x1d900f(0x1df))/0x7*(-parseInt(_0x1d900f(0x1e8))/0x8)+-parseInt(_0x1d900f(0x1e9))/0x9+-parseInt(_0x1d900f(0x1f3))/0xa*(-parseInt(_0x1d900f(0x1ec))/0xb);if(_0x269c6d===_0x20076f)break;else _0x45a0b5['push'](_0x45a0b5['shift']());}catch(_0x396906){_0x45a0b5['push'](_0x45a0b5['shift']());}}}(a4_0x5916,0x47183));function a4_0x5f01(_0x5ef984,_0x6579e0){const _0x591624=a4_0x5916();return a4_0x5f01=function(_0x5f0175,_0x475cfc){_0x5f0175=_0x5f0175-0x1da;let _0x141d7f=_0x591624[_0x5f0175];return _0x141d7f;},a4_0x5f01(_0x5ef984,_0x6579e0);}var __createBinding=this&&this['__createBinding']||(Object[a4_0x2ef5c0(0x1ef)]?function(_0x11a346,_0x3a1e66,_0x281a12,_0x3ddf19){const _0x1ab281=a4_0x2ef5c0;if(_0x3ddf19===undefined)_0x3ddf19=_0x281a12;var _0x26e144=Object['getOwnPropertyDescriptor'](_0x3a1e66,_0x281a12);(!_0x26e144||(_0x1ab281(0x1ff)in _0x26e144?!_0x3a1e66[_0x1ab281(0x1e3)]:_0x26e144[_0x1ab281(0x1e2)]||_0x26e144['configurable']))&&(_0x26e144={'enumerable':!![],'get':function(){return _0x3a1e66[_0x281a12];}}),Object['defineProperty'](_0x11a346,_0x3ddf19,_0x26e144);}:function(_0x2ab949,_0x28b7e0,_0x5f0cdb,_0x269098){if(_0x269098===undefined)_0x269098=_0x5f0cdb;_0x2ab949[_0x269098]=_0x28b7e0[_0x5f0cdb];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a4_0x2ef5c0(0x1ef)]?function(_0x1ad823,_0x3ad518){const _0x53c627=a4_0x2ef5c0;Object[_0x53c627(0x1fb)](_0x1ad823,_0x53c627(0x1f1),{'enumerable':!![],'value':_0x3ad518});}:function(_0x388df7,_0x5beee0){_0x388df7['default']=_0x5beee0;}),__importStar=this&&this[a4_0x2ef5c0(0x1e1)]||(function(){var _0x3c7e5f=function(_0x3fdf04){const _0x218ee6=a4_0x5f01;return _0x3c7e5f=Object[_0x218ee6(0x1f7)]||function(_0x4ffa22){const _0x28646c=_0x218ee6;var _0x4ecea8=[];for(var _0x391b2b in _0x4ffa22)if(Object[_0x28646c(0x1e4)]['hasOwnProperty']['call'](_0x4ffa22,_0x391b2b))_0x4ecea8[_0x4ecea8['length']]=_0x391b2b;return _0x4ecea8;},_0x3c7e5f(_0x3fdf04);};return function(_0x54a021){const _0x41d77c=a4_0x5f01;if(_0x54a021&&_0x54a021['__esModule'])return _0x54a021;var _0x1daffe={};if(_0x54a021!=null){for(var _0x5bf7b3=_0x3c7e5f(_0x54a021),_0x1cbb3a=0x0;_0x1cbb3a<_0x5bf7b3[_0x41d77c(0x1db)];_0x1cbb3a++)if(_0x5bf7b3[_0x1cbb3a]!==_0x41d77c(0x1f1))__createBinding(_0x1daffe,_0x54a021,_0x5bf7b3[_0x1cbb3a]);}return __setModuleDefault(_0x1daffe,_0x54a021),_0x1daffe;};}());Object[a4_0x2ef5c0(0x1fb)](exports,a4_0x2ef5c0(0x1e3),{'value':!![]}),exports[a4_0x2ef5c0(0x1de)]=void 0x0;const authService_1=require(a4_0x2ef5c0(0x1fd)),tokenBlacklistService_1=require('../services/tokenBlacklistService'),telegramBotService_1=require(a4_0x2ef5c0(0x1da));class AuthController{constructor(){const _0x51a58a=a4_0x2ef5c0;this['login']=async(_0xe585c,_0x1af4b2,_0x87c8fb)=>{const _0xfae562=a4_0x5f01;try{const _0x1dd885=_0xe585c['body'],_0x45cb2e=_0xe585c['ip']||_0xe585c['connection']['remoteAddress']||_0xfae562(0x1eb),_0x3bbc38=_0xe585c[_0xfae562(0x1ff)](_0xfae562(0x1fa))||_0xfae562(0x1eb);let _0x1f50f5=![],_0x222691=null;try{const _0x51aaf2=await this['authService']['login'](_0x1dd885);_0x1f50f5=!![],_0x51aaf2['role']===_0xfae562(0x1e0)&&_0x51aaf2['user']?.['id']&&(_0x222691=_0x51aaf2[_0xfae562(0x1dd)]['id']),_0x222691&&await telegramBotService_1[_0xfae562(0x1e5)][_0xfae562(0x1ed)](_0x222691,{'username':_0x1dd885[_0xfae562(0x203)],'ipAddress':_0x45cb2e,'userAgent':_0x3bbc38,'timestamp':new Date(),'success':!![]}),_0x1af4b2[_0xfae562(0x200)]({'success':!![],'result':_0x51aaf2});}catch(_0x4b567){try{const _0x38a701=(await Promise[_0xfae562(0x1f6)]()[_0xfae562(0x1ea)](()=>__importStar(require(_0xfae562(0x1f0)))))[_0xfae562(0x1f1)],_0x326822=await _0x38a701[_0xfae562(0x1e0)]['findUnique']({'where':{'username':_0x1dd885[_0xfae562(0x203)]},'select':{'id':!![]}});_0x326822&&await telegramBotService_1['telegramBotService'][_0xfae562(0x1ed)](_0x326822['id'],{'username':_0x1dd885[_0xfae562(0x203)],'ipAddress':_0x45cb2e,'userAgent':_0x3bbc38,'timestamp':new Date(),'success':![]});}catch(_0x34d1b6){console[_0xfae562(0x1f8)]('Failed\x20to\x20send\x20failed\x20login\x20notification:',_0x34d1b6);}throw _0x4b567;}}catch(_0xbe9840){_0x87c8fb(_0xbe9840);}},this['me']=async(_0x32f855,_0x3589c8,_0x2fffb3)=>{const _0x9e8230=a4_0x5f01;try{const _0x4cd42f=_0x32f855[_0x9e8230(0x1dd)];_0x3589c8['json']({'success':!![],'result':{'id':_0x4cd42f?.['id'],'username':_0x4cd42f?.[_0x9e8230(0x203)],'role':_0x4cd42f?.[_0x9e8230(0x1fc)]}});}catch(_0x458ac8){_0x2fffb3(_0x458ac8);}},this['logout']=async(_0x1dcc3e,_0x5adb5c,_0x2021c8)=>{const _0xd58bf8=a4_0x5f01;try{const _0x5933ce=_0x1dcc3e[_0xd58bf8(0x1f4)],_0x2867ad=_0x1dcc3e['user'];_0x5933ce&&_0x2867ad?.['exp']&&tokenBlacklistService_1['tokenBlacklistService']['blacklistToken'](_0x5933ce,_0x2867ad['exp']),_0x5adb5c[_0xd58bf8(0x200)]({'success':!![],'message':_0xd58bf8(0x1dc)});}catch(_0x1128b7){_0x2021c8(_0x1128b7);}},this[_0x51a58a(0x1f5)]=async(_0x59b7ff,_0x140f88,_0x337cd4)=>{const _0x1584ce=_0x51a58a;try{const _0x363896=tokenBlacklistService_1[_0x1584ce(0x201)]['getStats']();_0x140f88[_0x1584ce(0x200)]({'success':!![],'result':_0x363896});}catch(_0x51c009){_0x337cd4(_0x51c009);}},this['authService']=new authService_1[(_0x51a58a(0x1f9))]();}}exports[a4_0x2ef5c0(0x1de)]=AuthController;