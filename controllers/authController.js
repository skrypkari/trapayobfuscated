'use strict';const a4_0x530eef=a4_0x13cd;function a4_0x13cd(_0x17fdc3,_0x165fb0){const _0x363014=a4_0x3630();return a4_0x13cd=function(_0x13cd25,_0x25492d){_0x13cd25=_0x13cd25-0xca;let _0x1ee9e5=_0x363014[_0x13cd25];return _0x1ee9e5;},a4_0x13cd(_0x17fdc3,_0x165fb0);}(function(_0x4bf579,_0x12bffc){const _0x44656c=a4_0x13cd,_0x2f4b73=_0x4bf579();while(!![]){try{const _0x37ab14=-parseInt(_0x44656c(0xe8))/0x1*(-parseInt(_0x44656c(0xef))/0x2)+-parseInt(_0x44656c(0xf5))/0x3+-parseInt(_0x44656c(0xe3))/0x4*(parseInt(_0x44656c(0xf4))/0x5)+-parseInt(_0x44656c(0xd6))/0x6+parseInt(_0x44656c(0xea))/0x7+parseInt(_0x44656c(0xcf))/0x8*(-parseInt(_0x44656c(0xe4))/0x9)+parseInt(_0x44656c(0xed))/0xa;if(_0x37ab14===_0x12bffc)break;else _0x2f4b73['push'](_0x2f4b73['shift']());}catch(_0x1a8fdd){_0x2f4b73['push'](_0x2f4b73['shift']());}}}(a4_0x3630,0x2979d));var __createBinding=this&&this[a4_0x530eef(0xdd)]||(Object[a4_0x530eef(0xde)]?function(_0x1c2391,_0x26ffaf,_0x13f4c5,_0x2243c6){const _0x4341d7=a4_0x530eef;if(_0x2243c6===undefined)_0x2243c6=_0x13f4c5;var _0x1672f0=Object[_0x4341d7(0xe6)](_0x26ffaf,_0x13f4c5);(!_0x1672f0||('get'in _0x1672f0?!_0x26ffaf[_0x4341d7(0xf3)]:_0x1672f0['writable']||_0x1672f0[_0x4341d7(0xcb)]))&&(_0x1672f0={'enumerable':!![],'get':function(){return _0x26ffaf[_0x13f4c5];}}),Object[_0x4341d7(0xe7)](_0x1c2391,_0x2243c6,_0x1672f0);}:function(_0x2d2596,_0xcf8671,_0x5a2863,_0x5971f0){if(_0x5971f0===undefined)_0x5971f0=_0x5a2863;_0x2d2596[_0x5971f0]=_0xcf8671[_0x5a2863];}),__setModuleDefault=this&&this[a4_0x530eef(0xdb)]||(Object[a4_0x530eef(0xde)]?function(_0x49cd69,_0x31082d){const _0x4edcd3=a4_0x530eef;Object[_0x4edcd3(0xe7)](_0x49cd69,_0x4edcd3(0xce),{'enumerable':!![],'value':_0x31082d});}:function(_0x48f0cb,_0x29f86b){const _0x44c22f=a4_0x530eef;_0x48f0cb[_0x44c22f(0xce)]=_0x29f86b;}),__importStar=this&&this[a4_0x530eef(0xf1)]||(function(){var _0x53088f=function(_0x188c84){const _0x5b1199=a4_0x13cd;return _0x53088f=Object[_0x5b1199(0xf7)]||function(_0x370e74){const _0x1f4dab=_0x5b1199;var _0x1e3286=[];for(var _0x908a90 in _0x370e74)if(Object[_0x1f4dab(0xd7)][_0x1f4dab(0xd8)][_0x1f4dab(0xf8)](_0x370e74,_0x908a90))_0x1e3286[_0x1e3286[_0x1f4dab(0xdf)]]=_0x908a90;return _0x1e3286;},_0x53088f(_0x188c84);};return function(_0x2749d9){const _0x5d4ee3=a4_0x13cd;if(_0x2749d9&&_0x2749d9[_0x5d4ee3(0xf3)])return _0x2749d9;var _0x44f22b={};if(_0x2749d9!=null){for(var _0x1c7210=_0x53088f(_0x2749d9),_0x4a354b=0x0;_0x4a354b<_0x1c7210[_0x5d4ee3(0xdf)];_0x4a354b++)if(_0x1c7210[_0x4a354b]!==_0x5d4ee3(0xce))__createBinding(_0x44f22b,_0x2749d9,_0x1c7210[_0x4a354b]);}return __setModuleDefault(_0x44f22b,_0x2749d9),_0x44f22b;};}());Object[a4_0x530eef(0xe7)](exports,a4_0x530eef(0xf3),{'value':!![]}),exports[a4_0x530eef(0xd4)]=void 0x0;function a4_0x3630(){const _0xc028a6=['remoteAddress','login','configurable','json','shop','default','16qlbDuh','../services/telegramBotService','AuthService','body','blacklistToken','AuthController','../config/database','1369194fUqsLE','prototype','hasOwnProperty','sendLoginNotification','unknown','__setModuleDefault','getBlacklistStats','__createBinding','create','length','resolve','authService','user','8ZzHUZR','683406KuaIkC','role','getOwnPropertyDescriptor','defineProperty','3ATFcBC','username','1240372WABurb','tokenBlacklistService','getStats','6307930bHjIYK','token','4426HNwGuf','connection','__importStar','../services/authService','__esModule','585215vEpjdN','91770SvkckH','logout','getOwnPropertyNames','call','telegramBotService'];a4_0x3630=function(){return _0xc028a6;};return a4_0x3630();}const authService_1=require(a4_0x530eef(0xf2)),tokenBlacklistService_1=require('../services/tokenBlacklistService'),telegramBotService_1=require(a4_0x530eef(0xd0));class AuthController{constructor(){const _0x27f3f1=a4_0x530eef;this[_0x27f3f1(0xca)]=async(_0x291e1a,_0xa62881,_0x48c948)=>{const _0x467bf5=_0x27f3f1;try{const _0x2350e0=_0x291e1a[_0x467bf5(0xd2)],_0xa173ee=_0x291e1a['ip']||_0x291e1a[_0x467bf5(0xf0)][_0x467bf5(0xfa)]||_0x467bf5(0xda),_0x3ff3fb=_0x291e1a['get']('User-Agent')||'unknown';let _0x4e5cb2=![],_0x54f177=null;try{const _0x15ffba=await this[_0x467bf5(0xe1)]['login'](_0x2350e0);_0x4e5cb2=!![],_0x15ffba[_0x467bf5(0xe5)]==='shop'&&_0x15ffba['user']?.['id']&&(_0x54f177=_0x15ffba['user']['id']),_0x54f177&&await telegramBotService_1[_0x467bf5(0xf9)][_0x467bf5(0xd9)](_0x54f177,{'username':_0x2350e0[_0x467bf5(0xe9)],'ipAddress':_0xa173ee,'userAgent':_0x3ff3fb,'timestamp':new Date(),'success':!![]}),_0xa62881['json']({'success':!![],'result':_0x15ffba});}catch(_0x30a08f){try{const _0x4e0f61=(await Promise[_0x467bf5(0xe0)]()['then'](()=>__importStar(require(_0x467bf5(0xd5)))))[_0x467bf5(0xce)],_0x5e0994=await _0x4e0f61[_0x467bf5(0xcd)]['findUnique']({'where':{'username':_0x2350e0[_0x467bf5(0xe9)]},'select':{'id':!![]}});_0x5e0994&&await telegramBotService_1[_0x467bf5(0xf9)][_0x467bf5(0xd9)](_0x5e0994['id'],{'username':_0x2350e0['username'],'ipAddress':_0xa173ee,'userAgent':_0x3ff3fb,'timestamp':new Date(),'success':![]});}catch(_0x3f13f9){console['error']('Failed\x20to\x20send\x20failed\x20login\x20notification:',_0x3f13f9);}throw _0x30a08f;}}catch(_0x340064){_0x48c948(_0x340064);}},this['me']=async(_0x59a9ad,_0x25bcb2,_0x188654)=>{const _0x46e739=_0x27f3f1;try{const _0x39c1de=_0x59a9ad[_0x46e739(0xe2)];_0x25bcb2[_0x46e739(0xcc)]({'success':!![],'result':{'id':_0x39c1de?.['id'],'username':_0x39c1de?.[_0x46e739(0xe9)],'role':_0x39c1de?.['role']}});}catch(_0xc2b585){_0x188654(_0xc2b585);}},this[_0x27f3f1(0xf6)]=async(_0x36a8b5,_0xf6dd6e,_0x55c36a)=>{const _0x5f0392=_0x27f3f1;try{const _0x4c4396=_0x36a8b5[_0x5f0392(0xee)],_0x56f75b=_0x36a8b5[_0x5f0392(0xe2)];_0x4c4396&&_0x56f75b?.['exp']&&tokenBlacklistService_1[_0x5f0392(0xeb)][_0x5f0392(0xd3)](_0x4c4396,_0x56f75b['exp']),_0xf6dd6e[_0x5f0392(0xcc)]({'success':!![],'message':'Logged\x20out\x20successfully'});}catch(_0x25dafa){_0x55c36a(_0x25dafa);}},this[_0x27f3f1(0xdc)]=async(_0x374b27,_0x5868df,_0x2af9c6)=>{const _0x56922d=_0x27f3f1;try{const _0x32b229=tokenBlacklistService_1['tokenBlacklistService'][_0x56922d(0xec)]();_0x5868df[_0x56922d(0xcc)]({'success':!![],'result':_0x32b229});}catch(_0x1f3976){_0x2af9c6(_0x1f3976);}},this[_0x27f3f1(0xe1)]=new authService_1[(_0x27f3f1(0xd1))]();}}exports[a4_0x530eef(0xd4)]=AuthController;