'use strict';const a4_0x4886fb=a4_0x43c9;(function(_0x4242fa,_0x905037){const _0x167f19=a4_0x43c9,_0x5e8feb=_0x4242fa();while(!![]){try{const _0x288dfe=parseInt(_0x167f19(0x88))/0x1+-parseInt(_0x167f19(0x76))/0x2*(parseInt(_0x167f19(0xaa))/0x3)+parseInt(_0x167f19(0x75))/0x4*(parseInt(_0x167f19(0x85))/0x5)+parseInt(_0x167f19(0x99))/0x6+parseInt(_0x167f19(0x7a))/0x7+parseInt(_0x167f19(0x95))/0x8+-parseInt(_0x167f19(0x8a))/0x9*(parseInt(_0x167f19(0x6b))/0xa);if(_0x288dfe===_0x905037)break;else _0x5e8feb['push'](_0x5e8feb['shift']());}catch(_0x2c2910){_0x5e8feb['push'](_0x5e8feb['shift']());}}}(a4_0x3575,0x74580));var __createBinding=this&&this[a4_0x4886fb(0x8c)]||(Object[a4_0x4886fb(0x8d)]?function(_0x1fb6eb,_0x3803ed,_0x5ae41c,_0x3942e7){const _0x1aefbf=a4_0x4886fb;if(_0x3942e7===undefined)_0x3942e7=_0x5ae41c;var _0x380901=Object[_0x1aefbf(0x7b)](_0x3803ed,_0x5ae41c);(!_0x380901||(_0x1aefbf(0x71)in _0x380901?!_0x3803ed[_0x1aefbf(0xa6)]:_0x380901[_0x1aefbf(0x9d)]||_0x380901[_0x1aefbf(0xa2)]))&&(_0x380901={'enumerable':!![],'get':function(){return _0x3803ed[_0x5ae41c];}}),Object['defineProperty'](_0x1fb6eb,_0x3942e7,_0x380901);}:function(_0x8557a4,_0x5fe4ae,_0x42a632,_0x27e9ed){if(_0x27e9ed===undefined)_0x27e9ed=_0x42a632;_0x8557a4[_0x27e9ed]=_0x5fe4ae[_0x42a632];}),__setModuleDefault=this&&this[a4_0x4886fb(0x9f)]||(Object[a4_0x4886fb(0x8d)]?function(_0x4f6cc1,_0x4eaacd){const _0x4977dc=a4_0x4886fb;Object[_0x4977dc(0x6c)](_0x4f6cc1,'default',{'enumerable':!![],'value':_0x4eaacd});}:function(_0x4bbfb5,_0x67eb4f){const _0x3fcffb=a4_0x4886fb;_0x4bbfb5[_0x3fcffb(0x8f)]=_0x67eb4f;}),__importStar=this&&this['__importStar']||(function(){var _0x5ef96e=function(_0x2d0a48){const _0x5ac38a=a4_0x43c9;return _0x5ef96e=Object[_0x5ac38a(0x78)]||function(_0x31a72d){const _0x4659f7=_0x5ac38a;var _0x950c63=[];for(var _0x27cf4e in _0x31a72d)if(Object[_0x4659f7(0xa3)][_0x4659f7(0x84)]['call'](_0x31a72d,_0x27cf4e))_0x950c63[_0x950c63[_0x4659f7(0x90)]]=_0x27cf4e;return _0x950c63;},_0x5ef96e(_0x2d0a48);};return function(_0x460f39){const _0x530006=a4_0x43c9;if(_0x460f39&&_0x460f39[_0x530006(0xa6)])return _0x460f39;var _0x338b7a={};if(_0x460f39!=null){for(var _0x1afca2=_0x5ef96e(_0x460f39),_0x1631d4=0x0;_0x1631d4<_0x1afca2[_0x530006(0x90)];_0x1631d4++)if(_0x1afca2[_0x1631d4]!==_0x530006(0x8f))__createBinding(_0x338b7a,_0x460f39,_0x1afca2[_0x1631d4]);}return __setModuleDefault(_0x338b7a,_0x460f39),_0x338b7a;};}());function a4_0x43c9(_0x4cd72f,_0x2a736c){_0x4cd72f=_0x4cd72f-0x65;const _0x3575b6=a4_0x3575();let _0x43c9a9=_0x3575b6[_0x4cd72f];return _0x43c9a9;}function a4_0x3575(){const _0x167607=['length','AuthController','country','geolocation','findUnique','1192800sXLIEM','geo','user','Failed\x20to\x20send\x20failed\x20login\x20notification:','1560558CnezvJ','../config/database','code','AuthService','writable','../services/telegramBotService','__setModuleDefault','Failed\x20to\x20retrieve\x20fingerprint\x20data','sendLoginNotification','configurable','prototype','https://eu.api.fpjs.io/events/','address','__esModule','connection','telegramBotService','token','63039UOBnfK','blacklistToken','role','application/json','status','tokenBlacklistService','body','10tsGiOU','defineProperty','username','json','data','userAgent','get','getBlacklistStats','User-Agent','exp','127172CrqdbX','50WOelvd','login','getOwnPropertyNames','products','3184202jhjIoB','getOwnPropertyDescriptor','authService','ipAddress','requestId\x20query\x20parameter\x20is\x20required','getStats','anJngmXQVawz37L0S21u','unknown','remoteAddress','ipInfo','hasOwnProperty','65eacbZg','Logged\x20out\x20successfully','query','175962HclfiY','getFingerprintInfo','4063329wZfLkp','../services/tokenBlacklistService','__createBinding','create','logout','default'];a4_0x3575=function(){return _0x167607;};return a4_0x3575();}Object[a4_0x4886fb(0x6c)](exports,a4_0x4886fb(0xa6),{'value':!![]}),exports[a4_0x4886fb(0x91)]=void 0x0;const authService_1=require('../services/authService'),tokenBlacklistService_1=require(a4_0x4886fb(0x8b)),telegramBotService_1=require(a4_0x4886fb(0x9e));class AuthController{constructor(){const _0xd823c1=a4_0x4886fb;this[_0xd823c1(0x77)]=async(_0x3a5392,_0xe8537a,_0x180c4f)=>{const _0xa3f02f=_0xd823c1;try{const _0x174239=_0x3a5392[_0xa3f02f(0x6a)],_0x12e1bd=_0x174239[_0xa3f02f(0x7d)]||_0x3a5392['ip']||_0x3a5392[_0xa3f02f(0xa7)][_0xa3f02f(0x82)]||_0xa3f02f(0x81),_0x18d374=_0x174239[_0xa3f02f(0x70)]||_0x3a5392['get'](_0xa3f02f(0x73))||'unknown',_0xc72d66=_0x174239[_0xa3f02f(0x96)];let _0x29daec=![],_0x3919d0=null;try{const _0x3d8c49=await this['authService'][_0xa3f02f(0x77)](_0x174239);_0x29daec=!![],_0x3d8c49['role']==='shop'&&_0x3d8c49[_0xa3f02f(0x97)]?.['id']&&(_0x3919d0=_0x3d8c49['user']['id']),_0x3919d0&&await telegramBotService_1[_0xa3f02f(0xa8)][_0xa3f02f(0xa1)](_0x3919d0,{'username':_0x174239[_0xa3f02f(0x6d)],'ipAddress':_0x12e1bd,'userAgent':_0x18d374,'geo':_0xc72d66,'timestamp':new Date(),'success':!![]}),_0xe8537a['json']({'success':!![],'result':_0x3d8c49});}catch(_0x530b2b){try{const _0x351705=(await Promise['resolve']()['then'](()=>__importStar(require(_0xa3f02f(0x9a)))))[_0xa3f02f(0x8f)],_0x5b2e40=await _0x351705['shop'][_0xa3f02f(0x94)]({'where':{'username':_0x174239[_0xa3f02f(0x6d)]},'select':{'id':!![]}});_0x5b2e40&&await telegramBotService_1['telegramBotService']['sendLoginNotification'](_0x5b2e40['id'],{'username':_0x174239[_0xa3f02f(0x6d)],'ipAddress':_0x12e1bd,'userAgent':_0x18d374,'geo':_0xc72d66,'timestamp':new Date(),'success':![]});}catch(_0x49a032){console['error'](_0xa3f02f(0x98),_0x49a032);}throw _0x530b2b;}}catch(_0x1e22ad){_0x180c4f(_0x1e22ad);}},this['me']=async(_0x4e4d23,_0x557db9,_0x5c9553)=>{const _0x6dbbb6=_0xd823c1;try{const _0x65aba3=_0x4e4d23['user'];_0x557db9[_0x6dbbb6(0x6e)]({'success':!![],'result':{'id':_0x65aba3?.['id'],'username':_0x65aba3?.[_0x6dbbb6(0x6d)],'role':_0x65aba3?.[_0x6dbbb6(0x66)]}});}catch(_0x42e6be){_0x5c9553(_0x42e6be);}},this[_0xd823c1(0x8e)]=async(_0x2c3ed5,_0x203e3e,_0x39d45f)=>{const _0x164e4d=_0xd823c1;try{const _0x10bb3a=_0x2c3ed5[_0x164e4d(0xa9)],_0x377f79=_0x2c3ed5[_0x164e4d(0x97)];_0x10bb3a&&_0x377f79?.[_0x164e4d(0x74)]&&tokenBlacklistService_1[_0x164e4d(0x69)][_0x164e4d(0x65)](_0x10bb3a,_0x377f79['exp']),_0x203e3e[_0x164e4d(0x6e)]({'success':!![],'message':_0x164e4d(0x86)});}catch(_0xeacbb0){_0x39d45f(_0xeacbb0);}},this[_0xd823c1(0x72)]=async(_0x2cbb05,_0x3a096e,_0x5099e1)=>{const _0x534f6f=_0xd823c1;try{const _0x4b34c5=tokenBlacklistService_1[_0x534f6f(0x69)][_0x534f6f(0x7f)]();_0x3a096e[_0x534f6f(0x6e)]({'success':!![],'result':_0x4b34c5});}catch(_0x559c97){_0x5099e1(_0x559c97);}},this[_0xd823c1(0x89)]=async(_0x334dbf,_0x357f9f,_0x50ed8c)=>{const _0x4baa4a=_0xd823c1;try{const {requestId:_0x1931ca}=_0x334dbf[_0x4baa4a(0x87)];if(typeof _0x1931ca!=='string')return _0x357f9f[_0x4baa4a(0x68)](0x190)['json']({'success':![],'message':_0x4baa4a(0x7e)});const _0x5ea1c6=_0x4baa4a(0xa4)+_0x1931ca,_0x387577=await fetch(_0x5ea1c6,{'method':'GET','headers':{'Content-Type':_0x4baa4a(0x67),'Auth-API-Key':_0x4baa4a(0x80)}});if(!_0x387577['ok'])return _0x357f9f[_0x4baa4a(0x68)](_0x387577[_0x4baa4a(0x68)])[_0x4baa4a(0x6e)]({'success':![],'message':_0x4baa4a(0xa0)});const _0x40e002=await _0x387577[_0x4baa4a(0x6e)](),_0x2c7427=_0x40e002[_0x4baa4a(0x79)]?.['ipInfo']?.[_0x4baa4a(0x6f)]?.['v4']?.[_0x4baa4a(0xa5)]||_0x40e002[_0x4baa4a(0x79)]?.['ipInfo']?.[_0x4baa4a(0x6f)]?.['v6']?.[_0x4baa4a(0xa5)]||'',_0x14bd62=_0x40e002[_0x4baa4a(0x79)]?.['ipInfo']?.[_0x4baa4a(0x6f)]?.['v4']?.[_0x4baa4a(0x93)]?.[_0x4baa4a(0x92)]?.[_0x4baa4a(0x9b)]||_0x40e002[_0x4baa4a(0x79)]?.[_0x4baa4a(0x83)]?.[_0x4baa4a(0x6f)]?.['v6']?.[_0x4baa4a(0x93)]?.[_0x4baa4a(0x92)]?.[_0x4baa4a(0x9b)]||'';_0x357f9f[_0x4baa4a(0x6e)]({'success':!![],'result':{'ipAddress':_0x2c7427,'countryCode':_0x14bd62}});}catch(_0xe9b82e){_0x50ed8c(_0xe9b82e);}},this[_0xd823c1(0x7c)]=new authService_1[(_0xd823c1(0x9c))]();}}exports[a4_0x4886fb(0x91)]=AuthController;