'use strict';const a5_0x53124d=a5_0x57f8;(function(_0x519ca4,_0x13bbdd){const _0x3a830a=a5_0x57f8,_0x360883=_0x519ca4();while(!![]){try{const _0x10b6c0=parseInt(_0x3a830a(0xe4))/0x1+-parseInt(_0x3a830a(0x113))/0x2+-parseInt(_0x3a830a(0x10c))/0x3*(parseInt(_0x3a830a(0x109))/0x4)+-parseInt(_0x3a830a(0x10e))/0x5*(parseInt(_0x3a830a(0x11a))/0x6)+-parseInt(_0x3a830a(0xfc))/0x7+parseInt(_0x3a830a(0x120))/0x8*(-parseInt(_0x3a830a(0x122))/0x9)+parseInt(_0x3a830a(0x125))/0xa;if(_0x10b6c0===_0x13bbdd)break;else _0x360883['push'](_0x360883['shift']());}catch(_0x4e1be1){_0x360883['push'](_0x360883['shift']());}}}(a5_0x1aa2,0x3ef39));function a5_0x57f8(_0xfa4815,_0x11f0d6){_0xfa4815=_0xfa4815-0xe3;const _0x1aa2fe=a5_0x1aa2();let _0x57f813=_0x1aa2fe[_0xfa4815];return _0x57f813;}var __createBinding=this&&this['__createBinding']||(Object[a5_0x53124d(0x103)]?function(_0x5c5fa0,_0x293413,_0x3c579a,_0x16d0d4){const _0x8d452c=a5_0x53124d;if(_0x16d0d4===undefined)_0x16d0d4=_0x3c579a;var _0x41796c=Object[_0x8d452c(0xe8)](_0x293413,_0x3c579a);(!_0x41796c||(_0x8d452c(0xfe)in _0x41796c?!_0x293413[_0x8d452c(0x12b)]:_0x41796c[_0x8d452c(0x112)]||_0x41796c['configurable']))&&(_0x41796c={'enumerable':!![],'get':function(){return _0x293413[_0x3c579a];}}),Object[_0x8d452c(0xec)](_0x5c5fa0,_0x16d0d4,_0x41796c);}:function(_0x5c0749,_0x54b427,_0x2d5ee6,_0x56ad60){if(_0x56ad60===undefined)_0x56ad60=_0x2d5ee6;_0x5c0749[_0x56ad60]=_0x54b427[_0x2d5ee6];}),__setModuleDefault=this&&this[a5_0x53124d(0xfd)]||(Object[a5_0x53124d(0x103)]?function(_0x376e1b,_0x5d0192){const _0x49e385=a5_0x53124d;Object[_0x49e385(0xec)](_0x376e1b,_0x49e385(0xed),{'enumerable':!![],'value':_0x5d0192});}:function(_0x3a2e70,_0xd0b830){const _0x19cd72=a5_0x53124d;_0x3a2e70[_0x19cd72(0xed)]=_0xd0b830;}),__importStar=this&&this['__importStar']||(function(){var _0x5d8c20=function(_0xd0c2c3){const _0x5c71f4=a5_0x57f8;return _0x5d8c20=Object[_0x5c71f4(0x124)]||function(_0x2410dc){const _0x345183=_0x5c71f4;var _0x4c4e7a=[];for(var _0x5c1292 in _0x2410dc)if(Object['prototype'][_0x345183(0xf9)][_0x345183(0xf1)](_0x2410dc,_0x5c1292))_0x4c4e7a[_0x4c4e7a['length']]=_0x5c1292;return _0x4c4e7a;},_0x5d8c20(_0xd0c2c3);};return function(_0x454b72){const _0x5585c7=a5_0x57f8;if(_0x454b72&&_0x454b72[_0x5585c7(0x12b)])return _0x454b72;var _0x2c2abb={};if(_0x454b72!=null){for(var _0x6c1b14=_0x5d8c20(_0x454b72),_0x146fed=0x0;_0x146fed<_0x6c1b14[_0x5585c7(0x107)];_0x146fed++)if(_0x6c1b14[_0x146fed]!==_0x5585c7(0xed))__createBinding(_0x2c2abb,_0x454b72,_0x6c1b14[_0x146fed]);}return __setModuleDefault(_0x2c2abb,_0x454b72),_0x2c2abb;};}());Object[a5_0x53124d(0xec)](exports,a5_0x53124d(0x12b),{'value':!![]}),exports['AuthController']=void 0x0;const authService_1=require(a5_0x53124d(0xf0)),tokenBlacklistService_1=require(a5_0x53124d(0x129)),telegramBotService_1=require(a5_0x53124d(0xfb));class AuthController{constructor(){const _0x29eba2=a5_0x53124d;this[_0x29eba2(0x110)]=async(_0x5b2f61,_0x1945b7,_0x51fde9)=>{const _0x242dba=_0x29eba2;try{const _0x59ac42=_0x5b2f61[_0x242dba(0x105)],_0x335bd3=_0x59ac42[_0x242dba(0x128)]||_0x5b2f61['ip']||_0x5b2f61[_0x242dba(0xff)][_0x242dba(0x126)]||_0x242dba(0x11e),_0x36c308=_0x59ac42[_0x242dba(0x118)]||_0x5b2f61['get'](_0x242dba(0x10a))||'unknown',_0x3858ec=_0x59ac42[_0x242dba(0xfa)],_0x52c2ec=_0x59ac42['fingerprintRequestId'];let _0x30fc22=![],_0x56f679=null,_0x21c994=null;if(_0x52c2ec)try{const _0x405aa5='https://eu.api.fpjs.io/events/'+_0x52c2ec,_0x50b49c=await fetch(_0x405aa5,{'method':'GET','headers':{'Content-Type':_0x242dba(0x121),'Auth-API-Key':_0x242dba(0x11d)}});_0x50b49c['ok']&&(_0x21c994=await _0x50b49c[_0x242dba(0x115)]());}catch(_0x32e871){console[_0x242dba(0x100)](_0x242dba(0x119),_0x32e871);}try{const _0x4478f4=await this[_0x242dba(0xe3)][_0x242dba(0x110)](_0x59ac42);_0x30fc22=!![];_0x4478f4[_0x242dba(0x108)]===_0x242dba(0xee)&&_0x4478f4[_0x242dba(0xf6)]?.['id']&&(_0x56f679=_0x4478f4[_0x242dba(0xf6)]['id']);if(_0x56f679){const _0x35170d=(await Promise['resolve']()['then'](()=>__importStar(require(_0x242dba(0xe6)))))['default'],_0x4fb628=new Date(),_0x3e52dc=new Date(_0x4fb628);_0x3e52dc['setDate'](_0x3e52dc[_0x242dba(0x114)]()+0x16d),await _0x35170d[_0x242dba(0x102)][_0x242dba(0x103)]({'data':{'shopId':_0x56f679,'username':_0x59ac42[_0x242dba(0xeb)],'fingerprintRequestId':_0x52c2ec,'fingerprintData':_0x21c994,'ipAddress':_0x335bd3,'userAgent':_0x36c308,'geo':_0x3858ec,'success':!![],'expiresAt':_0x3e52dc}}),await telegramBotService_1[_0x242dba(0xe9)][_0x242dba(0xe7)](_0x56f679,{'username':_0x59ac42[_0x242dba(0xeb)],'ipAddress':_0x335bd3,'userAgent':_0x36c308,'geo':_0x3858ec,'timestamp':new Date(),'success':!![]});}_0x1945b7[_0x242dba(0x115)]({'success':!![],'result':_0x4478f4});}catch(_0x58a5db){try{const _0x363c7c=(await Promise[_0x242dba(0x117)]()[_0x242dba(0x111)](()=>__importStar(require(_0x242dba(0xe6)))))[_0x242dba(0xed)],_0x186994=await _0x363c7c[_0x242dba(0xee)][_0x242dba(0xea)]({'where':{'username':_0x59ac42[_0x242dba(0xeb)]},'select':{'id':!![]}});if(_0x186994){const _0x1d5c7e=new Date(),_0x2e9d67=new Date(_0x1d5c7e);_0x2e9d67['setDate'](_0x2e9d67['getDate']()+0x16d),await _0x363c7c[_0x242dba(0x102)][_0x242dba(0x103)]({'data':{'shopId':_0x186994['id'],'username':_0x59ac42[_0x242dba(0xeb)],'fingerprintRequestId':_0x52c2ec,'fingerprintData':_0x21c994,'ipAddress':_0x335bd3,'userAgent':_0x36c308,'geo':_0x3858ec,'success':![],'expiresAt':_0x2e9d67}}),await telegramBotService_1[_0x242dba(0xe9)]['sendLoginNotification'](_0x186994['id'],{'username':_0x59ac42[_0x242dba(0xeb)],'ipAddress':_0x335bd3,'userAgent':_0x36c308,'geo':_0x3858ec,'timestamp':new Date(),'success':![]});}}catch(_0x517dee){console[_0x242dba(0x100)](_0x242dba(0x104),_0x517dee);}throw _0x58a5db;}}catch(_0x488de4){_0x51fde9(_0x488de4);}},this['me']=async(_0x4f0dd8,_0xec0698,_0x144f6e)=>{const _0x3db772=_0x29eba2;try{const _0x33d406=_0x4f0dd8['user'];_0xec0698[_0x3db772(0x115)]({'success':!![],'result':{'id':_0x33d406?.['id'],'username':_0x33d406?.['username'],'role':_0x33d406?.[_0x3db772(0x108)]}});}catch(_0x442e19){_0x144f6e(_0x442e19);}},this[_0x29eba2(0xf7)]=async(_0x5dba59,_0x3b7ba2,_0x530713)=>{const _0x304bad=_0x29eba2;try{const _0x3cd6fe=_0x5dba59['token'],_0x5e7f20=_0x5dba59['user'];_0x3cd6fe&&_0x5e7f20?.[_0x304bad(0x12c)]&&tokenBlacklistService_1[_0x304bad(0x10d)][_0x304bad(0x12d)](_0x3cd6fe,_0x5e7f20['exp']),_0x3b7ba2[_0x304bad(0x115)]({'success':!![],'message':_0x304bad(0x12a)});}catch(_0x167ecd){_0x530713(_0x167ecd);}},this[_0x29eba2(0x11f)]=async(_0x27015b,_0x121b2e,_0x163d85)=>{const _0x4ced40=_0x29eba2;try{const _0x3a0011=tokenBlacklistService_1[_0x4ced40(0x10d)][_0x4ced40(0xf2)]();_0x121b2e[_0x4ced40(0x115)]({'success':!![],'result':_0x3a0011});}catch(_0x3e6764){_0x163d85(_0x3e6764);}},this[_0x29eba2(0xf5)]=async(_0xac3afd,_0x1a4a2b,_0x274ff9)=>{const _0x2e075f=_0x29eba2;try{const {requestId:_0x118668}=_0xac3afd[_0x2e075f(0x123)];if(typeof _0x118668!==_0x2e075f(0x10b))return _0x1a4a2b[_0x2e075f(0xf3)](0x190)[_0x2e075f(0x115)]({'success':![],'message':'requestId\x20query\x20parameter\x20is\x20required'});const _0x537e6c=_0x2e075f(0x127)+_0x118668,_0x4c60f5=await fetch(_0x537e6c,{'method':_0x2e075f(0xf8),'headers':{'Content-Type':_0x2e075f(0x121),'Auth-API-Key':_0x2e075f(0x11d)}});if(!_0x4c60f5['ok'])return _0x1a4a2b[_0x2e075f(0xf3)](_0x4c60f5[_0x2e075f(0xf3)])[_0x2e075f(0x115)]({'success':![],'message':_0x2e075f(0x10f)});const _0x2ad848=await _0x4c60f5['json'](),_0x53590c=_0x2ad848[_0x2e075f(0x101)]?.['ipInfo']?.[_0x2e075f(0x116)]?.['v4']?.['address']||_0x2ad848['products']?.[_0x2e075f(0xef)]?.[_0x2e075f(0x116)]?.['v6']?.[_0x2e075f(0xf4)]||'',_0xf386e0=_0x2ad848[_0x2e075f(0x101)]?.[_0x2e075f(0xef)]?.[_0x2e075f(0x116)]?.['v4']?.['geolocation']?.[_0x2e075f(0x11c)]?.[_0x2e075f(0xe5)]||_0x2ad848[_0x2e075f(0x101)]?.['ipInfo']?.['data']?.['v6']?.[_0x2e075f(0x11b)]?.[_0x2e075f(0x11c)]?.[_0x2e075f(0xe5)]||'';_0x1a4a2b[_0x2e075f(0x115)]({'success':!![],'result':{'ipAddress':_0x53590c,'countryCode':_0xf386e0}});}catch(_0x3a2af3){_0x274ff9(_0x3a2af3);}},this[_0x29eba2(0xe3)]=new authService_1['AuthService']();}}function a5_0x1aa2(){const _0x2698ec=['telegramBotService','findUnique','username','defineProperty','default','shop','ipInfo','../services/authService','call','getStats','status','address','getFingerprintInfo','user','logout','GET','hasOwnProperty','geo','../services/telegramBotService','216671XdAwyA','__setModuleDefault','get','connection','error','products','loginLog','create','Failed\x20to\x20send\x20failed\x20login\x20notification:','body','AuthController','length','role','4ReWFbo','User-Agent','string','1102245ursnds','tokenBlacklistService','640qcBnCU','Failed\x20to\x20retrieve\x20fingerprint\x20data','login','then','writable','861670faPIWs','getDate','json','data','resolve','userAgent','Failed\x20to\x20fetch\x20fingerprint\x20data:','2100ccPdob','geolocation','country','anJngmXQVawz37L0S21u','unknown','getBlacklistStats','8DeNOPL','application/json','776619aZLtZB','query','getOwnPropertyNames','10699430nwNdrK','remoteAddress','https://eu.api.fpjs.io/events/','ipAddress','../services/tokenBlacklistService','Logged\x20out\x20successfully','__esModule','exp','blacklistToken','authService','148200zqSVrR','code','../config/database','sendLoginNotification','getOwnPropertyDescriptor'];a5_0x1aa2=function(){return _0x2698ec;};return a5_0x1aa2();}exports[a5_0x53124d(0x106)]=AuthController;