'use strict';const a4_0x41fb78=a4_0x3c60;function a4_0x1d2c(){const _0x270ddc=['exp','8745012AelBKE','491454IwFTlZ','logout','getOwnPropertyDescriptor','prototype','6520360lwcNNX','19177390UQkAEz','__importStar','length','authService','role','9AfapoE','user','3115609uGoirz','defineProperty','error','20351FZWWqh','__setModuleDefault','connection','AuthController','tokenBlacklistService','create','get','login','default','writable','AuthService','telegramBotService','Failed\x20to\x20send\x20failed\x20login\x20notification:','blacklistToken','User-Agent','../config/database','findUnique','hasOwnProperty','json','getBlacklistStats','10sbMaxG','98924kCEwmt','getOwnPropertyNames','configurable','__esModule','body','../services/authService','shop','then','__createBinding','26MACLRN'];a4_0x1d2c=function(){return _0x270ddc;};return a4_0x1d2c();}(function(_0x2d9998,_0x320b40){const _0x452873=a4_0x3c60,_0x27cad8=_0x2d9998();while(!![]){try{const _0x395397=-parseInt(_0x452873(0xbf))/0x1*(parseInt(_0x452873(0xdd))/0x2)+parseInt(_0x452873(0xe0))/0x3+-parseInt(_0x452873(0xd4))/0x4*(-parseInt(_0x452873(0xd3))/0x5)+parseInt(_0x452873(0xdf))/0x6+parseInt(_0x452873(0xbc))/0x7+parseInt(_0x452873(0xe4))/0x8+-parseInt(_0x452873(0xba))/0x9*(parseInt(_0x452873(0xe5))/0xa);if(_0x395397===_0x320b40)break;else _0x27cad8['push'](_0x27cad8['shift']());}catch(_0x10e5a1){_0x27cad8['push'](_0x27cad8['shift']());}}}(a4_0x1d2c,0xb6c44));function a4_0x3c60(_0x16dd1b,_0x58e6c8){const _0x1d2c10=a4_0x1d2c();return a4_0x3c60=function(_0x3c60ab,_0x1277d3){_0x3c60ab=_0x3c60ab-0xb6;let _0x96b9f8=_0x1d2c10[_0x3c60ab];return _0x96b9f8;},a4_0x3c60(_0x16dd1b,_0x58e6c8);}var __createBinding=this&&this[a4_0x41fb78(0xdc)]||(Object['create']?function(_0x31866b,_0x2505e5,_0x4cc4d1,_0x4aab93){const _0x226f8e=a4_0x41fb78;if(_0x4aab93===undefined)_0x4aab93=_0x4cc4d1;var _0x293dc8=Object[_0x226f8e(0xe2)](_0x2505e5,_0x4cc4d1);(!_0x293dc8||(_0x226f8e(0xc5)in _0x293dc8?!_0x2505e5[_0x226f8e(0xd7)]:_0x293dc8[_0x226f8e(0xc8)]||_0x293dc8[_0x226f8e(0xd6)]))&&(_0x293dc8={'enumerable':!![],'get':function(){return _0x2505e5[_0x4cc4d1];}}),Object[_0x226f8e(0xbd)](_0x31866b,_0x4aab93,_0x293dc8);}:function(_0x411959,_0x3d9898,_0x489d0b,_0x2e3cbd){if(_0x2e3cbd===undefined)_0x2e3cbd=_0x489d0b;_0x411959[_0x2e3cbd]=_0x3d9898[_0x489d0b];}),__setModuleDefault=this&&this[a4_0x41fb78(0xc0)]||(Object[a4_0x41fb78(0xc4)]?function(_0x4af3e4,_0x47514c){const _0xdcf474=a4_0x41fb78;Object['defineProperty'](_0x4af3e4,_0xdcf474(0xc7),{'enumerable':!![],'value':_0x47514c});}:function(_0x575e6d,_0x2a99de){const _0x3a2af6=a4_0x41fb78;_0x575e6d[_0x3a2af6(0xc7)]=_0x2a99de;}),__importStar=this&&this[a4_0x41fb78(0xb6)]||(function(){var _0x17dc86=function(_0x22822f){const _0x42d2fe=a4_0x3c60;return _0x17dc86=Object[_0x42d2fe(0xd5)]||function(_0x266632){const _0x5da8af=_0x42d2fe;var _0x3b11c2=[];for(var _0x344b84 in _0x266632)if(Object[_0x5da8af(0xe3)][_0x5da8af(0xd0)]['call'](_0x266632,_0x344b84))_0x3b11c2[_0x3b11c2['length']]=_0x344b84;return _0x3b11c2;},_0x17dc86(_0x22822f);};return function(_0x1d81ab){const _0x15101a=a4_0x3c60;if(_0x1d81ab&&_0x1d81ab[_0x15101a(0xd7)])return _0x1d81ab;var _0x123509={};if(_0x1d81ab!=null){for(var _0x3a9d40=_0x17dc86(_0x1d81ab),_0x1d583b=0x0;_0x1d583b<_0x3a9d40[_0x15101a(0xb7)];_0x1d583b++)if(_0x3a9d40[_0x1d583b]!==_0x15101a(0xc7))__createBinding(_0x123509,_0x1d81ab,_0x3a9d40[_0x1d583b]);}return __setModuleDefault(_0x123509,_0x1d81ab),_0x123509;};}());Object['defineProperty'](exports,a4_0x41fb78(0xd7),{'value':!![]}),exports['AuthController']=void 0x0;const authService_1=require(a4_0x41fb78(0xd9)),tokenBlacklistService_1=require('../services/tokenBlacklistService'),telegramBotService_1=require('../services/telegramBotService');class AuthController{constructor(){const _0x267ad7=a4_0x41fb78;this[_0x267ad7(0xc6)]=async(_0x4b7588,_0x472b85,_0x4c2532)=>{const _0x54c5e3=_0x267ad7;try{const _0x1f9e1f=_0x4b7588[_0x54c5e3(0xd8)],_0x4a6232=_0x4b7588['ip']||_0x4b7588[_0x54c5e3(0xc1)]['remoteAddress']||'unknown',_0x27a387=_0x4b7588['get'](_0x54c5e3(0xcd))||'unknown';let _0x1a56ab=![],_0x22d30e=null;try{const _0x1c840a=await this['authService'][_0x54c5e3(0xc6)](_0x1f9e1f);_0x1a56ab=!![],_0x1c840a[_0x54c5e3(0xb9)]===_0x54c5e3(0xda)&&_0x1c840a['user']?.['id']&&(_0x22d30e=_0x1c840a['user']['id']),_0x22d30e&&await telegramBotService_1[_0x54c5e3(0xca)]['sendLoginNotification'](_0x22d30e,{'username':_0x1f9e1f['username'],'ipAddress':_0x4a6232,'userAgent':_0x27a387,'timestamp':new Date(),'success':!![]}),_0x472b85['json']({'success':!![],'result':_0x1c840a});}catch(_0x52c2e6){try{const _0x50e883=(await Promise['resolve']()[_0x54c5e3(0xdb)](()=>__importStar(require(_0x54c5e3(0xce)))))['default'],_0x49d35e=await _0x50e883[_0x54c5e3(0xda)][_0x54c5e3(0xcf)]({'where':{'username':_0x1f9e1f['username']},'select':{'id':!![]}});_0x49d35e&&await telegramBotService_1[_0x54c5e3(0xca)]['sendLoginNotification'](_0x49d35e['id'],{'username':_0x1f9e1f['username'],'ipAddress':_0x4a6232,'userAgent':_0x27a387,'timestamp':new Date(),'success':![]});}catch(_0x2032f1){console[_0x54c5e3(0xbe)](_0x54c5e3(0xcb),_0x2032f1);}throw _0x52c2e6;}}catch(_0x2e1405){_0x4c2532(_0x2e1405);}},this['me']=async(_0x535c5b,_0x2def68,_0x290ffc)=>{const _0x158e0f=_0x267ad7;try{const _0x2a5f1d=_0x535c5b[_0x158e0f(0xbb)];_0x2def68[_0x158e0f(0xd1)]({'success':!![],'result':{'id':_0x2a5f1d?.['id'],'username':_0x2a5f1d?.['username'],'role':_0x2a5f1d?.[_0x158e0f(0xb9)]}});}catch(_0x464a66){_0x290ffc(_0x464a66);}},this[_0x267ad7(0xe1)]=async(_0x2897f4,_0x1f1bf2,_0x1e37b9)=>{const _0x3a53a6=_0x267ad7;try{const _0x425c9b=_0x2897f4['token'],_0x1cfc5a=_0x2897f4['user'];_0x425c9b&&_0x1cfc5a?.[_0x3a53a6(0xde)]&&tokenBlacklistService_1[_0x3a53a6(0xc3)][_0x3a53a6(0xcc)](_0x425c9b,_0x1cfc5a[_0x3a53a6(0xde)]),_0x1f1bf2['json']({'success':!![],'message':'Logged\x20out\x20successfully'});}catch(_0x2dfea4){_0x1e37b9(_0x2dfea4);}},this[_0x267ad7(0xd2)]=async(_0x486d9f,_0x23e33a,_0x13bc7e)=>{const _0x5cc845=_0x267ad7;try{const _0x36c024=tokenBlacklistService_1[_0x5cc845(0xc3)]['getStats']();_0x23e33a[_0x5cc845(0xd1)]({'success':!![],'result':_0x36c024});}catch(_0x2455a3){_0x13bc7e(_0x2455a3);}},this[_0x267ad7(0xb8)]=new authService_1[(_0x267ad7(0xc9))]();}}exports[a4_0x41fb78(0xc2)]=AuthController;