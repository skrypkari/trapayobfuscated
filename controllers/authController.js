'use strict';function a5_0x4304(_0x1d5a60,_0x442119){_0x1d5a60=_0x1d5a60-0xa0;const _0x46af10=a5_0x46af();let _0x43049f=_0x46af10[_0x1d5a60];return _0x43049f;}const a5_0x2ef342=a5_0x4304;(function(_0x27c4f1,_0x11d4fd){const _0x423ac9=a5_0x4304,_0x38d3bc=_0x27c4f1();while(!![]){try{const _0x4fef32=parseInt(_0x423ac9(0xe0))/0x1*(-parseInt(_0x423ac9(0xce))/0x2)+-parseInt(_0x423ac9(0xd3))/0x3*(-parseInt(_0x423ac9(0xda))/0x4)+parseInt(_0x423ac9(0xc2))/0x5+-parseInt(_0x423ac9(0xdb))/0x6+parseInt(_0x423ac9(0xa0))/0x7+parseInt(_0x423ac9(0xb9))/0x8*(-parseInt(_0x423ac9(0xbc))/0x9)+-parseInt(_0x423ac9(0xb5))/0xa*(parseInt(_0x423ac9(0xd7))/0xb);if(_0x4fef32===_0x11d4fd)break;else _0x38d3bc['push'](_0x38d3bc['shift']());}catch(_0x241578){_0x38d3bc['push'](_0x38d3bc['shift']());}}}(a5_0x46af,0x3441a));function a5_0x46af(){const _0x1a3063=['shop','hasOwnProperty','Logged\x20out\x20successfully','26560sDqARj','connection','getFingerprintInfo','getStats','800LENIKi','get','defineProperty','23445aBCgUL','loginLog','getBlacklistStats','__setModuleDefault','query','username','1089915SnZqby','prototype','unknown','user','exp','__importStar','requestId\x20query\x20parameter\x20is\x20required','products','__esModule','../services/telegramBotService','blacklistToken','create','11596pyhQnX','code','ipInfo','geolocation','sendLoginNotification','623754LWHlxJ','resolve','data','User-Agent','649EFYEaR','writable','ipAddress','4OQnWEk','161496PPrWhC','token','../services/authService','telegramBotService','remoteAddress','8eMSvsm','setDate','GET','tokenBlacklistService','default','userAgent','status','error','AuthController','json','length','address','login','geo','1950515oKEibK','anJngmXQVawz37L0S21u','../services/tokenBlacklistService','role','logout','application/json','__createBinding','https://eu.api.fpjs.io/events/','getDate','string','fingerprintRequestId','Failed\x20to\x20retrieve\x20fingerprint\x20data','../config/database','then','Failed\x20to\x20send\x20failed\x20login\x20notification:','call','authService','findUnique'];a5_0x46af=function(){return _0x1a3063;};return a5_0x46af();}var __createBinding=this&&this[a5_0x2ef342(0xa6)]||(Object[a5_0x2ef342(0xcd)]?function(_0x52b953,_0x3cb816,_0x399a85,_0x473841){const _0xf27717=a5_0x2ef342;if(_0x473841===undefined)_0x473841=_0x399a85;var _0x23d2c1=Object['getOwnPropertyDescriptor'](_0x3cb816,_0x399a85);(!_0x23d2c1||(_0xf27717(0xba)in _0x23d2c1?!_0x3cb816[_0xf27717(0xca)]:_0x23d2c1[_0xf27717(0xd8)]||_0x23d2c1['configurable']))&&(_0x23d2c1={'enumerable':!![],'get':function(){return _0x3cb816[_0x399a85];}}),Object[_0xf27717(0xbb)](_0x52b953,_0x473841,_0x23d2c1);}:function(_0x1445c5,_0x407d82,_0x403df4,_0x262cff){if(_0x262cff===undefined)_0x262cff=_0x403df4;_0x1445c5[_0x262cff]=_0x407d82[_0x403df4];}),__setModuleDefault=this&&this[a5_0x2ef342(0xbf)]||(Object[a5_0x2ef342(0xcd)]?function(_0xe89958,_0x5d4abc){const _0x67069e=a5_0x2ef342;Object[_0x67069e(0xbb)](_0xe89958,_0x67069e(0xe4),{'enumerable':!![],'value':_0x5d4abc});}:function(_0x3c6f62,_0x5da023){const _0x6a6b4=a5_0x2ef342;_0x3c6f62[_0x6a6b4(0xe4)]=_0x5da023;}),__importStar=this&&this[a5_0x2ef342(0xc7)]||(function(){var _0x335538=function(_0x352063){return _0x335538=Object['getOwnPropertyNames']||function(_0x1d3d4a){const _0x2812a5=a5_0x4304;var _0x215bb8=[];for(var _0x4d9937 in _0x1d3d4a)if(Object[_0x2812a5(0xc3)][_0x2812a5(0xb3)][_0x2812a5(0xaf)](_0x1d3d4a,_0x4d9937))_0x215bb8[_0x215bb8[_0x2812a5(0xea)]]=_0x4d9937;return _0x215bb8;},_0x335538(_0x352063);};return function(_0x33324f){const _0x4846b9=a5_0x4304;if(_0x33324f&&_0x33324f[_0x4846b9(0xca)])return _0x33324f;var _0x4c21e9={};if(_0x33324f!=null){for(var _0x59a6c9=_0x335538(_0x33324f),_0x49ec62=0x0;_0x49ec62<_0x59a6c9['length'];_0x49ec62++)if(_0x59a6c9[_0x49ec62]!=='default')__createBinding(_0x4c21e9,_0x33324f,_0x59a6c9[_0x49ec62]);}return __setModuleDefault(_0x4c21e9,_0x33324f),_0x4c21e9;};}());Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['AuthController']=void 0x0;const authService_1=require(a5_0x2ef342(0xdd)),tokenBlacklistService_1=require(a5_0x2ef342(0xa2)),telegramBotService_1=require(a5_0x2ef342(0xcb));class AuthController{constructor(){const _0x14779c=a5_0x2ef342;this[_0x14779c(0xec)]=async(_0x5df59d,_0x3fad12,_0x4932a0)=>{const _0x197955=_0x14779c;try{const _0x87f22e=_0x5df59d['body'],_0x4b5939=_0x87f22e[_0x197955(0xd9)]||_0x5df59d['ip']||_0x5df59d[_0x197955(0xb6)][_0x197955(0xdf)]||_0x197955(0xc4),_0x38c5a6=_0x87f22e[_0x197955(0xe5)]||_0x5df59d['get'](_0x197955(0xd6))||_0x197955(0xc4),_0x49c520=_0x87f22e[_0x197955(0xed)],_0x214d28=_0x87f22e[_0x197955(0xaa)];let _0x850686=![],_0x3ea23b=null,_0x35df16=null;if(_0x214d28)try{const _0x1dc241=_0x197955(0xa7)+_0x214d28,_0x22a6b9=await fetch(_0x1dc241,{'method':_0x197955(0xe2),'headers':{'Content-Type':_0x197955(0xa5),'Auth-API-Key':_0x197955(0xa1)}});_0x22a6b9['ok']&&(_0x35df16=await _0x22a6b9[_0x197955(0xe9)]());}catch(_0x18aa6d){console[_0x197955(0xe7)]('Failed\x20to\x20fetch\x20fingerprint\x20data:',_0x18aa6d);}try{const _0x44583a=await this[_0x197955(0xb0)][_0x197955(0xec)](_0x87f22e);_0x850686=!![];_0x44583a[_0x197955(0xa3)]===_0x197955(0xb2)&&_0x44583a[_0x197955(0xc5)]?.['id']&&(_0x3ea23b=_0x44583a[_0x197955(0xc5)]['id']);if(_0x3ea23b){const _0x57878c=(await Promise[_0x197955(0xd4)]()[_0x197955(0xad)](()=>__importStar(require(_0x197955(0xac)))))[_0x197955(0xe4)],_0xdc6058=new Date(),_0x142496=new Date(_0xdc6058);_0x142496[_0x197955(0xe1)](_0x142496[_0x197955(0xa8)]()+0x16d),await _0x57878c[_0x197955(0xbd)]['create']({'data':{'shopId':_0x3ea23b,'username':_0x87f22e['username'],'fingerprintRequestId':_0x214d28,'fingerprintData':_0x35df16,'ipAddress':_0x4b5939,'userAgent':_0x38c5a6,'geo':_0x49c520,'success':!![],'expiresAt':_0x142496}}),await telegramBotService_1[_0x197955(0xde)][_0x197955(0xd2)](_0x3ea23b,{'username':_0x87f22e[_0x197955(0xc1)],'ipAddress':_0x4b5939,'userAgent':_0x38c5a6,'geo':_0x49c520,'timestamp':new Date(),'success':!![]});}_0x3fad12[_0x197955(0xe9)]({'success':!![],'result':_0x44583a});}catch(_0x419ffd){try{const _0x2852eb=(await Promise[_0x197955(0xd4)]()[_0x197955(0xad)](()=>__importStar(require(_0x197955(0xac)))))[_0x197955(0xe4)],_0x50a6b0=await _0x2852eb[_0x197955(0xb2)][_0x197955(0xb1)]({'where':{'username':_0x87f22e[_0x197955(0xc1)]},'select':{'id':!![]}});if(_0x50a6b0){const _0x91be58=new Date(),_0x26c65a=new Date(_0x91be58);_0x26c65a[_0x197955(0xe1)](_0x26c65a['getDate']()+0x16d),await _0x2852eb[_0x197955(0xbd)]['create']({'data':{'shopId':_0x50a6b0['id'],'username':_0x87f22e['username'],'fingerprintRequestId':_0x214d28,'fingerprintData':_0x35df16,'ipAddress':_0x4b5939,'userAgent':_0x38c5a6,'geo':_0x49c520,'success':![],'expiresAt':_0x26c65a}}),await telegramBotService_1[_0x197955(0xde)][_0x197955(0xd2)](_0x50a6b0['id'],{'username':_0x87f22e[_0x197955(0xc1)],'ipAddress':_0x4b5939,'userAgent':_0x38c5a6,'geo':_0x49c520,'timestamp':new Date(),'success':![]});}}catch(_0x5e10bd){console['error'](_0x197955(0xae),_0x5e10bd);}throw _0x419ffd;}}catch(_0x3b7b65){_0x4932a0(_0x3b7b65);}},this['me']=async(_0x55fa03,_0x4521f2,_0x21a687)=>{const _0x5cdf2b=_0x14779c;try{const _0x2df026=_0x55fa03[_0x5cdf2b(0xc5)];_0x4521f2[_0x5cdf2b(0xe9)]({'success':!![],'result':{'id':_0x2df026?.['id'],'username':_0x2df026?.[_0x5cdf2b(0xc1)],'role':_0x2df026?.[_0x5cdf2b(0xa3)]}});}catch(_0x5ba0bf){_0x21a687(_0x5ba0bf);}},this[_0x14779c(0xa4)]=async(_0x183c52,_0x36855d,_0x5c726a)=>{const _0x419d85=_0x14779c;try{const _0x53dda8=_0x183c52[_0x419d85(0xdc)],_0x48fe46=_0x183c52[_0x419d85(0xc5)];_0x53dda8&&_0x48fe46?.[_0x419d85(0xc6)]&&tokenBlacklistService_1[_0x419d85(0xe3)][_0x419d85(0xcc)](_0x53dda8,_0x48fe46['exp']),_0x36855d[_0x419d85(0xe9)]({'success':!![],'message':_0x419d85(0xb4)});}catch(_0x438374){_0x5c726a(_0x438374);}},this[_0x14779c(0xbe)]=async(_0x3d9db7,_0x389470,_0x4fc9bb)=>{const _0x31a39c=_0x14779c;try{const _0xce3b24=tokenBlacklistService_1[_0x31a39c(0xe3)][_0x31a39c(0xb8)]();_0x389470['json']({'success':!![],'result':_0xce3b24});}catch(_0x106398){_0x4fc9bb(_0x106398);}},this[_0x14779c(0xb7)]=async(_0x282927,_0x51c655,_0x4dbb08)=>{const _0x19b91f=_0x14779c;try{const {requestId:_0x36fd65}=_0x282927[_0x19b91f(0xc0)];if(typeof _0x36fd65!==_0x19b91f(0xa9))return _0x51c655[_0x19b91f(0xe6)](0x190)['json']({'success':![],'message':_0x19b91f(0xc8)});const _0x2823fd=_0x19b91f(0xa7)+_0x36fd65,_0x31112f=await fetch(_0x2823fd,{'method':'GET','headers':{'Content-Type':_0x19b91f(0xa5),'Auth-API-Key':_0x19b91f(0xa1)}});if(!_0x31112f['ok'])return _0x51c655[_0x19b91f(0xe6)](_0x31112f[_0x19b91f(0xe6)])[_0x19b91f(0xe9)]({'success':![],'message':_0x19b91f(0xab)});const _0x17b98e=await _0x31112f[_0x19b91f(0xe9)](),_0x4e918e=_0x17b98e['products']?.[_0x19b91f(0xd0)]?.[_0x19b91f(0xd5)]?.['v4']?.['address']||_0x17b98e['products']?.[_0x19b91f(0xd0)]?.[_0x19b91f(0xd5)]?.['v6']?.[_0x19b91f(0xeb)]||'',_0x18779d=_0x17b98e['products']?.[_0x19b91f(0xd0)]?.[_0x19b91f(0xd5)]?.['v4']?.[_0x19b91f(0xd1)]?.['country']?.[_0x19b91f(0xcf)]||_0x17b98e[_0x19b91f(0xc9)]?.[_0x19b91f(0xd0)]?.[_0x19b91f(0xd5)]?.['v6']?.['geolocation']?.['country']?.['code']||'';_0x51c655['json']({'success':!![],'result':{'ipAddress':_0x4e918e,'countryCode':_0x18779d}});}catch(_0x3830fd){_0x4dbb08(_0x3830fd);}},this[_0x14779c(0xb0)]=new authService_1['AuthService']();}}exports[a5_0x2ef342(0xe8)]=AuthController;