'use strict';const a4_0x4ad71c=a4_0x2e95;function a4_0x39d6(){const _0x1d3fdd=['status','4mbDpob','sendLoginNotification','login','AuthService','10679170ftVixk','defineProperty','telegramBotService','findUnique','exp','../services/authService','Failed\x20to\x20send\x20failed\x20login\x20notification:','2635030rktVxf','AuthController','blacklistToken','logout','2166940gONdIL','5126072TWsowp','get','getStats','authService','error','tokenBlacklistService','__setModuleDefault','user','27HsunsK','__esModule','$disconnect','role','shop','resolve','7044636bKDmbI','getAccountStatus','ACTIVE','Shop\x20not\x20found','token','writable','create','getOwnPropertyNames','default','Logged\x20out\x20successfully','name','../services/telegramBotService','2538256wfYPQL','configurable','getOwnPropertyDescriptor','length','json','User-Agent','prototype','unknown','SUSPENDED','username','1wgzmJa','hasOwnProperty','Shop\x20access\x20required','2648553kcEkok'];a4_0x39d6=function(){return _0x1d3fdd;};return a4_0x39d6();}(function(_0x2bf28c,_0x3544af){const _0x36940b=a4_0x2e95,_0x453600=_0x2bf28c();while(!![]){try{const _0x270f00=parseInt(_0x36940b(0x1e9))/0x1*(parseInt(_0x36940b(0x1fd))/0x2)+parseInt(_0x36940b(0x1ec))/0x3*(-parseInt(_0x36940b(0x1ee))/0x4)+-parseInt(_0x36940b(0x1f9))/0x5+-parseInt(_0x36940b(0x20c))/0x6+-parseInt(_0x36940b(0x1fe))/0x7+-parseInt(_0x36940b(0x218))/0x8+parseInt(_0x36940b(0x206))/0x9*(parseInt(_0x36940b(0x1f2))/0xa);if(_0x270f00===_0x3544af)break;else _0x453600['push'](_0x453600['shift']());}catch(_0x569d30){_0x453600['push'](_0x453600['shift']());}}}(a4_0x39d6,0x9f970));function a4_0x2e95(_0x2ae468,_0x42d32b){const _0x39d6aa=a4_0x39d6();return a4_0x2e95=function(_0x2e95af,_0x56db6b){_0x2e95af=_0x2e95af-0x1e7;let _0x64f68f=_0x39d6aa[_0x2e95af];return _0x64f68f;},a4_0x2e95(_0x2ae468,_0x42d32b);}var __createBinding=this&&this['__createBinding']||(Object[a4_0x4ad71c(0x212)]?function(_0x5d6bfc,_0x58fbdf,_0x4ffd09,_0x5f261d){const _0x30af38=a4_0x4ad71c;if(_0x5f261d===undefined)_0x5f261d=_0x4ffd09;var _0x151aa9=Object[_0x30af38(0x21a)](_0x58fbdf,_0x4ffd09);(!_0x151aa9||(_0x30af38(0x1ff)in _0x151aa9?!_0x58fbdf['__esModule']:_0x151aa9[_0x30af38(0x211)]||_0x151aa9[_0x30af38(0x219)]))&&(_0x151aa9={'enumerable':!![],'get':function(){return _0x58fbdf[_0x4ffd09];}}),Object[_0x30af38(0x1f3)](_0x5d6bfc,_0x5f261d,_0x151aa9);}:function(_0x676838,_0x590913,_0x3d8c71,_0x3b88be){if(_0x3b88be===undefined)_0x3b88be=_0x3d8c71;_0x676838[_0x3b88be]=_0x590913[_0x3d8c71];}),__setModuleDefault=this&&this[a4_0x4ad71c(0x204)]||(Object['create']?function(_0x200170,_0x524389){const _0x4c7561=a4_0x4ad71c;Object[_0x4c7561(0x1f3)](_0x200170,'default',{'enumerable':!![],'value':_0x524389});}:function(_0x52c39b,_0x86d330){_0x52c39b['default']=_0x86d330;}),__importStar=this&&this['__importStar']||(function(){var _0x291ffd=function(_0x5dda10){const _0x4cfb8b=a4_0x2e95;return _0x291ffd=Object[_0x4cfb8b(0x213)]||function(_0x563863){const _0x3d2ff8=_0x4cfb8b;var _0x2384a4=[];for(var _0x1621ff in _0x563863)if(Object[_0x3d2ff8(0x21e)][_0x3d2ff8(0x1ea)]['call'](_0x563863,_0x1621ff))_0x2384a4[_0x2384a4[_0x3d2ff8(0x21b)]]=_0x1621ff;return _0x2384a4;},_0x291ffd(_0x5dda10);};return function(_0x26dadd){const _0x12c75d=a4_0x2e95;if(_0x26dadd&&_0x26dadd[_0x12c75d(0x207)])return _0x26dadd;var _0x2646b0={};if(_0x26dadd!=null){for(var _0x273655=_0x291ffd(_0x26dadd),_0x413543=0x0;_0x413543<_0x273655[_0x12c75d(0x21b)];_0x413543++)if(_0x273655[_0x413543]!==_0x12c75d(0x214))__createBinding(_0x2646b0,_0x26dadd,_0x273655[_0x413543]);}return __setModuleDefault(_0x2646b0,_0x26dadd),_0x2646b0;};}());Object[a4_0x4ad71c(0x1f3)](exports,a4_0x4ad71c(0x207),{'value':!![]}),exports[a4_0x4ad71c(0x1fa)]=void 0x0;const authService_1=require(a4_0x4ad71c(0x1f7)),tokenBlacklistService_1=require('../services/tokenBlacklistService'),telegramBotService_1=require(a4_0x4ad71c(0x217));class AuthController{constructor(){const _0x4998c8=a4_0x4ad71c;this[_0x4998c8(0x1f0)]=async(_0x97c8ad,_0x4a835b,_0x427945)=>{const _0x1e511a=_0x4998c8;try{const _0x3d3c8d=_0x97c8ad['body'],_0x2c1506=_0x97c8ad['ip']||_0x97c8ad['connection']['remoteAddress']||'unknown',_0x9883bc=_0x97c8ad[_0x1e511a(0x1ff)](_0x1e511a(0x21d))||_0x1e511a(0x21f);let _0x11598d=![],_0x5e8acd=null;try{const _0x4cac67=await this['authService']['login'](_0x3d3c8d);_0x11598d=!![],_0x4cac67[_0x1e511a(0x209)]===_0x1e511a(0x20a)&&_0x4cac67[_0x1e511a(0x205)]?.['id']&&(_0x5e8acd=_0x4cac67[_0x1e511a(0x205)]['id']),_0x5e8acd&&await telegramBotService_1[_0x1e511a(0x1f4)][_0x1e511a(0x1ef)](_0x5e8acd,{'username':_0x3d3c8d[_0x1e511a(0x1e8)],'ipAddress':_0x2c1506,'userAgent':_0x9883bc,'timestamp':new Date(),'success':!![]}),_0x4a835b[_0x1e511a(0x21c)]({'success':!![],'result':_0x4cac67});}catch(_0x72ed0a){try{const _0x17855b=(await Promise[_0x1e511a(0x20b)]()['then'](()=>__importStar(require('../config/database'))))[_0x1e511a(0x214)],_0x5c535a=await _0x17855b[_0x1e511a(0x20a)][_0x1e511a(0x1f5)]({'where':{'username':_0x3d3c8d[_0x1e511a(0x1e8)]},'select':{'id':!![]}});_0x5c535a&&await telegramBotService_1[_0x1e511a(0x1f4)][_0x1e511a(0x1ef)](_0x5c535a['id'],{'username':_0x3d3c8d[_0x1e511a(0x1e8)],'ipAddress':_0x2c1506,'userAgent':_0x9883bc,'timestamp':new Date(),'success':![]});}catch(_0x14e744){console[_0x1e511a(0x202)](_0x1e511a(0x1f8),_0x14e744);}throw _0x72ed0a;}}catch(_0x5cc69){_0x427945(_0x5cc69);}},this['me']=async(_0x542f83,_0x521ffd,_0x516894)=>{const _0x37aad9=_0x4998c8;try{const _0x2462db=_0x542f83['user'];_0x521ffd['json']({'success':!![],'result':{'id':_0x2462db?.['id'],'username':_0x2462db?.[_0x37aad9(0x1e8)],'role':_0x2462db?.['role']}});}catch(_0x285ea9){_0x516894(_0x285ea9);}},this[_0x4998c8(0x1fc)]=async(_0x524d5f,_0x149d5b,_0x583098)=>{const _0x484db7=_0x4998c8;try{const _0x7c2e15=_0x524d5f[_0x484db7(0x210)],_0x12bdef=_0x524d5f[_0x484db7(0x205)];_0x7c2e15&&_0x12bdef?.['exp']&&tokenBlacklistService_1['tokenBlacklistService'][_0x484db7(0x1fb)](_0x7c2e15,_0x12bdef[_0x484db7(0x1f6)]),_0x149d5b[_0x484db7(0x21c)]({'success':!![],'message':_0x484db7(0x215)});}catch(_0x159973){_0x583098(_0x159973);}},this['getBlacklistStats']=async(_0x46118b,_0xfbf20a,_0x4d87aa)=>{const _0xfbbbb9=_0x4998c8;try{const _0x21e762=tokenBlacklistService_1[_0xfbbbb9(0x203)][_0xfbbbb9(0x200)]();_0xfbf20a[_0xfbbbb9(0x21c)]({'success':!![],'result':_0x21e762});}catch(_0x4a8857){_0x4d87aa(_0x4a8857);}},this[_0x4998c8(0x20d)]=async(_0x37d605,_0x4ee1d4,_0x2265e4)=>{const _0x24bd4b=_0x4998c8;try{if(!_0x37d605[_0x24bd4b(0x205)]||_0x37d605[_0x24bd4b(0x205)]['role']!==_0x24bd4b(0x20a))return _0x4ee1d4[_0x24bd4b(0x1ed)](0x193)[_0x24bd4b(0x21c)]({'success':![],'message':_0x24bd4b(0x1eb)});const {PrismaClient:_0x48d912}=require('@prisma/client'),_0x3e93c9=new _0x48d912(),_0x49de8c=await _0x3e93c9['shop'][_0x24bd4b(0x1f5)]({'where':{'id':_0x37d605[_0x24bd4b(0x205)]['id']},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x49de8c)return _0x4ee1d4['status'](0x194)[_0x24bd4b(0x21c)]({'success':![],'message':_0x24bd4b(0x20f)});await _0x3e93c9[_0x24bd4b(0x208)](),_0x4ee1d4[_0x24bd4b(0x21c)]({'success':!![],'result':{'id':_0x49de8c['id'],'name':_0x49de8c[_0x24bd4b(0x216)],'username':_0x49de8c[_0x24bd4b(0x1e8)],'status':_0x49de8c[_0x24bd4b(0x1ed)],'suspended':_0x49de8c[_0x24bd4b(0x1ed)]===_0x24bd4b(0x1e7),'active':_0x49de8c[_0x24bd4b(0x1ed)]===_0x24bd4b(0x20e),'canCreatePayments':_0x49de8c[_0x24bd4b(0x1ed)]==='ACTIVE'}});}catch(_0x5974d0){_0x2265e4(_0x5974d0);}},this[_0x4998c8(0x201)]=new authService_1[(_0x4998c8(0x1f1))]();}}exports['AuthController']=AuthController;