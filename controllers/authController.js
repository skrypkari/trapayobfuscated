'use strict';const a5_0x28be7e=a5_0x2a9e;(function(_0x231729,_0x4a823e){const _0x276954=a5_0x2a9e,_0x237396=_0x231729();while(!![]){try{const _0x469670=parseInt(_0x276954(0x1ca))/0x1*(parseInt(_0x276954(0x1ef))/0x2)+-parseInt(_0x276954(0x1ce))/0x3+parseInt(_0x276954(0x1f0))/0x4*(parseInt(_0x276954(0x1db))/0x5)+parseInt(_0x276954(0x1e6))/0x6*(-parseInt(_0x276954(0x1f5))/0x7)+-parseInt(_0x276954(0x1f8))/0x8*(-parseInt(_0x276954(0x20c))/0x9)+-parseInt(_0x276954(0x1d1))/0xa*(-parseInt(_0x276954(0x1c5))/0xb)+parseInt(_0x276954(0x1d5))/0xc;if(_0x469670===_0x4a823e)break;else _0x237396['push'](_0x237396['shift']());}catch(_0x3d162d){_0x237396['push'](_0x237396['shift']());}}}(a5_0x2aa5,0xdc280));function a5_0x2aa5(){const _0x3a574c=['query','8RRqNYO','getFingerprintInfo','country','code','loginLog','getStats','__importStar','__createBinding','configurable','geo','Failed\x20to\x20retrieve\x20fingerprint\x20data','telegramBotService','https://eu.api.fpjs.io/events/','then','Failed\x20to\x20send\x20failed\x20login\x20notification:','logout','__esModule','blacklistToken','shop','data','14307831nZmJdc','username','status','getOwnPropertyNames','../services/authService','length','create','GET','exp','1591909rSDDql','login','anJngmXQVawz37L0S21u','error','products','132151jmJmWL','getOwnPropertyDescriptor','User-Agent','AuthService','4387959VakssL','tokenBlacklistService','json','30Phboez','string','../config/database','fingerprintRequestId','14653680AfzfbK','AuthController','application/json','unknown','hasOwnProperty','role','156425PHoGMP','resolve','userAgent','connection','address','__setModuleDefault','findUnique','ipInfo','geolocation','default','getDate','15942rZAKer','call','defineProperty','setDate','sendLoginNotification','get','Failed\x20to\x20fetch\x20fingerprint\x20data:','ipAddress','prototype','10lXoaWm','20IHJvtB','user','authService','getBlacklistStats','token','4473ROkCOg','body'];a5_0x2aa5=function(){return _0x3a574c;};return a5_0x2aa5();}var __createBinding=this&&this[a5_0x28be7e(0x1ff)]||(Object[a5_0x28be7e(0x212)]?function(_0x267da9,_0xd3cdb8,_0x2c142f,_0x486393){const _0x5632eb=a5_0x28be7e;if(_0x486393===undefined)_0x486393=_0x2c142f;var _0x1b133b=Object[_0x5632eb(0x1cb)](_0xd3cdb8,_0x2c142f);(!_0x1b133b||(_0x5632eb(0x1eb)in _0x1b133b?!_0xd3cdb8[_0x5632eb(0x208)]:_0x1b133b['writable']||_0x1b133b[_0x5632eb(0x200)]))&&(_0x1b133b={'enumerable':!![],'get':function(){return _0xd3cdb8[_0x2c142f];}}),Object['defineProperty'](_0x267da9,_0x486393,_0x1b133b);}:function(_0x3502f9,_0x562776,_0x28cf81,_0x15cfee){if(_0x15cfee===undefined)_0x15cfee=_0x28cf81;_0x3502f9[_0x15cfee]=_0x562776[_0x28cf81];}),__setModuleDefault=this&&this[a5_0x28be7e(0x1e0)]||(Object[a5_0x28be7e(0x212)]?function(_0x43a37d,_0x3d0b58){const _0x3015=a5_0x28be7e;Object[_0x3015(0x1e8)](_0x43a37d,'default',{'enumerable':!![],'value':_0x3d0b58});}:function(_0x1b14bc,_0x4009cc){const _0x561f7a=a5_0x28be7e;_0x1b14bc[_0x561f7a(0x1e4)]=_0x4009cc;}),__importStar=this&&this[a5_0x28be7e(0x1fe)]||(function(){var _0x217a7b=function(_0x1861a0){const _0x23bece=a5_0x2a9e;return _0x217a7b=Object[_0x23bece(0x20f)]||function(_0xbc77ff){const _0x53bc6d=_0x23bece;var _0x13b62a=[];for(var _0xf2a754 in _0xbc77ff)if(Object[_0x53bc6d(0x1ee)][_0x53bc6d(0x1d9)][_0x53bc6d(0x1e7)](_0xbc77ff,_0xf2a754))_0x13b62a[_0x13b62a[_0x53bc6d(0x211)]]=_0xf2a754;return _0x13b62a;},_0x217a7b(_0x1861a0);};return function(_0x4f0ca7){const _0x582fd1=a5_0x2a9e;if(_0x4f0ca7&&_0x4f0ca7[_0x582fd1(0x208)])return _0x4f0ca7;var _0x56be62={};if(_0x4f0ca7!=null){for(var _0x17bbf8=_0x217a7b(_0x4f0ca7),_0x213312=0x0;_0x213312<_0x17bbf8['length'];_0x213312++)if(_0x17bbf8[_0x213312]!==_0x582fd1(0x1e4))__createBinding(_0x56be62,_0x4f0ca7,_0x17bbf8[_0x213312]);}return __setModuleDefault(_0x56be62,_0x4f0ca7),_0x56be62;};}());Object[a5_0x28be7e(0x1e8)](exports,'__esModule',{'value':!![]}),exports[a5_0x28be7e(0x1d6)]=void 0x0;function a5_0x2a9e(_0x25b8a6,_0xe6244a){_0x25b8a6=_0x25b8a6-0x1c3;const _0x2aa552=a5_0x2aa5();let _0x2a9eea=_0x2aa552[_0x25b8a6];return _0x2a9eea;}const authService_1=require(a5_0x28be7e(0x210)),tokenBlacklistService_1=require('../services/tokenBlacklistService'),telegramBotService_1=require('../services/telegramBotService');class AuthController{constructor(){const _0x3ed8cd=a5_0x28be7e;this[_0x3ed8cd(0x1c6)]=async(_0x5b2cac,_0x2bffc0,_0x11d891)=>{const _0x4b1ae2=_0x3ed8cd;try{const _0x2c48ed=_0x5b2cac[_0x4b1ae2(0x1f6)],_0x17e62f=_0x2c48ed[_0x4b1ae2(0x1ed)]||_0x5b2cac['ip']||_0x5b2cac[_0x4b1ae2(0x1de)]['remoteAddress']||_0x4b1ae2(0x1d8),_0x506b2b=_0x2c48ed[_0x4b1ae2(0x1dd)]||_0x5b2cac[_0x4b1ae2(0x1eb)](_0x4b1ae2(0x1cc))||_0x4b1ae2(0x1d8),_0x2ed5b4=_0x2c48ed[_0x4b1ae2(0x201)],_0x5e0e46=_0x2c48ed[_0x4b1ae2(0x1d4)];let _0x41a21f=![],_0x487554=null,_0x3d70ab=null;if(_0x5e0e46)try{const _0x487572=_0x4b1ae2(0x204)+_0x5e0e46,_0x453408=await fetch(_0x487572,{'method':_0x4b1ae2(0x1c3),'headers':{'Content-Type':_0x4b1ae2(0x1d7),'Auth-API-Key':_0x4b1ae2(0x1c7)}});_0x453408['ok']&&(_0x3d70ab=await _0x453408[_0x4b1ae2(0x1d0)]());}catch(_0x4ef7fe){console[_0x4b1ae2(0x1c8)](_0x4b1ae2(0x1ec),_0x4ef7fe);}try{const _0x5997ad=await this[_0x4b1ae2(0x1f2)]['login'](_0x2c48ed);_0x41a21f=!![];_0x5997ad[_0x4b1ae2(0x1da)]==='shop'&&_0x5997ad[_0x4b1ae2(0x1f1)]?.['id']&&(_0x487554=_0x5997ad[_0x4b1ae2(0x1f1)]['id']);if(_0x487554){const _0x2fe09a=(await Promise['resolve']()[_0x4b1ae2(0x205)](()=>__importStar(require('../config/database'))))[_0x4b1ae2(0x1e4)],_0x57bef7=new Date(),_0x5035ad=new Date(_0x57bef7);_0x5035ad[_0x4b1ae2(0x1e9)](_0x5035ad['getDate']()+0x16d),await _0x2fe09a[_0x4b1ae2(0x1fc)][_0x4b1ae2(0x212)]({'data':{'shopId':_0x487554,'username':_0x2c48ed['username'],'fingerprintRequestId':_0x5e0e46,'fingerprintData':_0x3d70ab,'ipAddress':_0x17e62f,'userAgent':_0x506b2b,'geo':_0x2ed5b4,'success':!![],'expiresAt':_0x5035ad}}),await telegramBotService_1[_0x4b1ae2(0x203)][_0x4b1ae2(0x1ea)](_0x487554,{'username':_0x2c48ed[_0x4b1ae2(0x20d)],'ipAddress':_0x17e62f,'userAgent':_0x506b2b,'geo':_0x2ed5b4,'timestamp':new Date(),'success':!![]});}_0x2bffc0['json']({'success':!![],'result':_0x5997ad});}catch(_0x3c487e){try{const _0x34dc99=(await Promise[_0x4b1ae2(0x1dc)]()['then'](()=>__importStar(require(_0x4b1ae2(0x1d3)))))['default'],_0xbfda27=await _0x34dc99[_0x4b1ae2(0x20a)][_0x4b1ae2(0x1e1)]({'where':{'username':_0x2c48ed[_0x4b1ae2(0x20d)]},'select':{'id':!![]}});if(_0xbfda27){const _0x2169f7=new Date(),_0xafa131=new Date(_0x2169f7);_0xafa131['setDate'](_0xafa131[_0x4b1ae2(0x1e5)]()+0x16d),await _0x34dc99[_0x4b1ae2(0x1fc)][_0x4b1ae2(0x212)]({'data':{'shopId':_0xbfda27['id'],'username':_0x2c48ed['username'],'fingerprintRequestId':_0x5e0e46,'fingerprintData':_0x3d70ab,'ipAddress':_0x17e62f,'userAgent':_0x506b2b,'geo':_0x2ed5b4,'success':![],'expiresAt':_0xafa131}}),await telegramBotService_1['telegramBotService'][_0x4b1ae2(0x1ea)](_0xbfda27['id'],{'username':_0x2c48ed[_0x4b1ae2(0x20d)],'ipAddress':_0x17e62f,'userAgent':_0x506b2b,'geo':_0x2ed5b4,'timestamp':new Date(),'success':![]});}}catch(_0x430e43){console[_0x4b1ae2(0x1c8)](_0x4b1ae2(0x206),_0x430e43);}throw _0x3c487e;}}catch(_0x2b2e00){_0x11d891(_0x2b2e00);}},this['me']=async(_0x25f7d1,_0x317203,_0x4663e2)=>{const _0x54432a=_0x3ed8cd;try{const _0x3f9e94=_0x25f7d1[_0x54432a(0x1f1)];_0x317203[_0x54432a(0x1d0)]({'success':!![],'result':{'id':_0x3f9e94?.['id'],'username':_0x3f9e94?.['username'],'role':_0x3f9e94?.[_0x54432a(0x1da)]}});}catch(_0x2bf3e3){_0x4663e2(_0x2bf3e3);}},this[_0x3ed8cd(0x207)]=async(_0x4249be,_0xe194f2,_0x599475)=>{const _0x42bd54=_0x3ed8cd;try{const _0x32d207=_0x4249be[_0x42bd54(0x1f4)],_0xf9b73a=_0x4249be[_0x42bd54(0x1f1)];_0x32d207&&_0xf9b73a?.[_0x42bd54(0x1c4)]&&tokenBlacklistService_1[_0x42bd54(0x1cf)][_0x42bd54(0x209)](_0x32d207,_0xf9b73a[_0x42bd54(0x1c4)]),_0xe194f2[_0x42bd54(0x1d0)]({'success':!![],'message':'Logged\x20out\x20successfully'});}catch(_0x5729ad){_0x599475(_0x5729ad);}},this[_0x3ed8cd(0x1f3)]=async(_0x45034a,_0x492340,_0x16d3b7)=>{const _0x5720f5=_0x3ed8cd;try{const _0x496ad0=tokenBlacklistService_1['tokenBlacklistService'][_0x5720f5(0x1fd)]();_0x492340['json']({'success':!![],'result':_0x496ad0});}catch(_0x139038){_0x16d3b7(_0x139038);}},this[_0x3ed8cd(0x1f9)]=async(_0x47d0c4,_0x50e180,_0x154de6)=>{const _0x26559a=_0x3ed8cd;try{const {requestId:_0x4de098}=_0x47d0c4[_0x26559a(0x1f7)];if(typeof _0x4de098!==_0x26559a(0x1d2))return _0x50e180['status'](0x190)['json']({'success':![],'message':'requestId\x20query\x20parameter\x20is\x20required'});const _0xd1ec04=_0x26559a(0x204)+_0x4de098,_0x4becd8=await fetch(_0xd1ec04,{'method':'GET','headers':{'Content-Type':_0x26559a(0x1d7),'Auth-API-Key':_0x26559a(0x1c7)}});if(!_0x4becd8['ok'])return _0x50e180[_0x26559a(0x20e)](_0x4becd8['status'])[_0x26559a(0x1d0)]({'success':![],'message':_0x26559a(0x202)});const _0x1e293d=await _0x4becd8[_0x26559a(0x1d0)](),_0x598765=_0x1e293d['products']?.[_0x26559a(0x1e2)]?.[_0x26559a(0x20b)]?.['v4']?.['address']||_0x1e293d[_0x26559a(0x1c9)]?.['ipInfo']?.[_0x26559a(0x20b)]?.['v6']?.[_0x26559a(0x1df)]||'',_0x11db23=_0x1e293d[_0x26559a(0x1c9)]?.[_0x26559a(0x1e2)]?.[_0x26559a(0x20b)]?.['v4']?.[_0x26559a(0x1e3)]?.[_0x26559a(0x1fa)]?.[_0x26559a(0x1fb)]||_0x1e293d[_0x26559a(0x1c9)]?.[_0x26559a(0x1e2)]?.['data']?.['v6']?.[_0x26559a(0x1e3)]?.[_0x26559a(0x1fa)]?.[_0x26559a(0x1fb)]||'';_0x50e180['json']({'success':!![],'result':{'ipAddress':_0x598765,'countryCode':_0x11db23}});}catch(_0x3c2433){_0x154de6(_0x3c2433);}},this[_0x3ed8cd(0x1f2)]=new authService_1[(_0x3ed8cd(0x1cd))]();}}exports[a5_0x28be7e(0x1d6)]=AuthController;