'use strict';const a5_0x6d4ca0=a5_0x2e98;function a5_0x2e98(_0x2a24b5,_0x10e680){_0x2a24b5=_0x2a24b5-0x1df;const _0x4ea727=a5_0x4ea7();let _0x2e98ee=_0x4ea727[_0x2a24b5];return _0x2e98ee;}(function(_0x1a85d2,_0x5482f3){const _0x16aeae=a5_0x2e98,_0x58b5c4=_0x1a85d2();while(!![]){try{const _0x44bc2e=-parseInt(_0x16aeae(0x214))/0x1+-parseInt(_0x16aeae(0x1fb))/0x2*(-parseInt(_0x16aeae(0x1eb))/0x3)+parseInt(_0x16aeae(0x1df))/0x4*(-parseInt(_0x16aeae(0x1ef))/0x5)+-parseInt(_0x16aeae(0x1ff))/0x6+parseInt(_0x16aeae(0x224))/0x7+parseInt(_0x16aeae(0x20e))/0x8*(parseInt(_0x16aeae(0x203))/0x9)+parseInt(_0x16aeae(0x20c))/0xa;if(_0x44bc2e===_0x5482f3)break;else _0x58b5c4['push'](_0x58b5c4['shift']());}catch(_0x473e75){_0x58b5c4['push'](_0x58b5c4['shift']());}}}(a5_0x4ea7,0x6758a));function a5_0x4ea7(){const _0x2699a5=['body','anJngmXQVawz37L0S21u','128RLbyBo','loginLog','../config/database','__esModule','get','getStats','default','exp','data','authService','address','token','369039vQPWoj','shop','prototype','findUnique','70685jXcAmA','userAgent','status','Failed\x20to\x20retrieve\x20fingerprint\x20data','sendLoginNotification','Failed\x20to\x20fetch\x20fingerprint\x20data:','tokenBlacklistService','login','user','products','username','call','6JYADqb','requestId\x20query\x20parameter\x20is\x20required','../services/authService','length','102036Zqbzpo','__setModuleDefault','json','AuthController','9dCzNlU','role','Logged\x20out\x20successfully','ipAddress','unknown','ipInfo','defineProperty','telegramBotService','setDate','1987060FMgvWT','AuthService','2059368BdHFkS','remoteAddress','User-Agent','geolocation','application/json','create','422088pzVZmO','connection','blacklistToken','string','__createBinding','getBlacklistStats','getOwnPropertyDescriptor','logout','getOwnPropertyNames','https://eu.api.fpjs.io/events/','GET','../services/telegramBotService','hasOwnProperty','Failed\x20to\x20send\x20failed\x20login\x20notification:','code','then','3427326OLLjPh','fingerprintRequestId'];a5_0x4ea7=function(){return _0x2699a5;};return a5_0x4ea7();}var __createBinding=this&&this[a5_0x6d4ca0(0x218)]||(Object['create']?function(_0x46a7ae,_0x2b5f6d,_0x48373a,_0xe9fa69){const _0xb89ad5=a5_0x6d4ca0;if(_0xe9fa69===undefined)_0xe9fa69=_0x48373a;var _0x4e9848=Object[_0xb89ad5(0x21a)](_0x2b5f6d,_0x48373a);(!_0x4e9848||(_0xb89ad5(0x1e3)in _0x4e9848?!_0x2b5f6d[_0xb89ad5(0x1e2)]:_0x4e9848['writable']||_0x4e9848['configurable']))&&(_0x4e9848={'enumerable':!![],'get':function(){return _0x2b5f6d[_0x48373a];}}),Object[_0xb89ad5(0x209)](_0x46a7ae,_0xe9fa69,_0x4e9848);}:function(_0x30930a,_0x46edce,_0x149a71,_0x3ebbfa){if(_0x3ebbfa===undefined)_0x3ebbfa=_0x149a71;_0x30930a[_0x3ebbfa]=_0x46edce[_0x149a71];}),__setModuleDefault=this&&this[a5_0x6d4ca0(0x200)]||(Object['create']?function(_0xc1885a,_0x1a853f){const _0x1bd5a4=a5_0x6d4ca0;Object['defineProperty'](_0xc1885a,_0x1bd5a4(0x1e5),{'enumerable':!![],'value':_0x1a853f});}:function(_0x1a71f2,_0x3a43af){const _0x4f87f1=a5_0x6d4ca0;_0x1a71f2[_0x4f87f1(0x1e5)]=_0x3a43af;}),__importStar=this&&this['__importStar']||(function(){var _0x1c2abb=function(_0x1daac4){const _0x54d072=a5_0x2e98;return _0x1c2abb=Object[_0x54d072(0x21c)]||function(_0x152b8c){const _0x3e57b5=_0x54d072;var _0x440d88=[];for(var _0x4056cc in _0x152b8c)if(Object[_0x3e57b5(0x1ed)][_0x3e57b5(0x220)][_0x3e57b5(0x1fa)](_0x152b8c,_0x4056cc))_0x440d88[_0x440d88[_0x3e57b5(0x1fe)]]=_0x4056cc;return _0x440d88;},_0x1c2abb(_0x1daac4);};return function(_0x58d6c7){const _0x2890a3=a5_0x2e98;if(_0x58d6c7&&_0x58d6c7[_0x2890a3(0x1e2)])return _0x58d6c7;var _0x10a1e1={};if(_0x58d6c7!=null){for(var _0x2dd47e=_0x1c2abb(_0x58d6c7),_0x167712=0x0;_0x167712<_0x2dd47e[_0x2890a3(0x1fe)];_0x167712++)if(_0x2dd47e[_0x167712]!==_0x2890a3(0x1e5))__createBinding(_0x10a1e1,_0x58d6c7,_0x2dd47e[_0x167712]);}return __setModuleDefault(_0x10a1e1,_0x58d6c7),_0x10a1e1;};}());Object['defineProperty'](exports,a5_0x6d4ca0(0x1e2),{'value':!![]}),exports[a5_0x6d4ca0(0x202)]=void 0x0;const authService_1=require(a5_0x6d4ca0(0x1fd)),tokenBlacklistService_1=require('../services/tokenBlacklistService'),telegramBotService_1=require(a5_0x6d4ca0(0x21f));class AuthController{constructor(){const _0x1827f8=a5_0x6d4ca0;this[_0x1827f8(0x1f6)]=async(_0x3de8ed,_0x16866d,_0x22cb8f)=>{const _0x36dd9c=_0x1827f8;try{const _0x185844=_0x3de8ed[_0x36dd9c(0x226)],_0x114866=_0x185844[_0x36dd9c(0x206)]||_0x3de8ed['ip']||_0x3de8ed[_0x36dd9c(0x215)][_0x36dd9c(0x20f)]||_0x36dd9c(0x207),_0x138c4c=_0x185844[_0x36dd9c(0x1f0)]||_0x3de8ed[_0x36dd9c(0x1e3)](_0x36dd9c(0x210))||_0x36dd9c(0x207),_0x5b3f07=_0x185844['geo'],_0x305d3a=_0x185844[_0x36dd9c(0x225)];let _0x431392=![],_0x3c6f87=null,_0x2b3b2a=null;if(_0x305d3a)try{const _0x526565='https://eu.api.fpjs.io/events/'+_0x305d3a,_0x78b3d7=await fetch(_0x526565,{'method':'GET','headers':{'Content-Type':_0x36dd9c(0x212),'Auth-API-Key':_0x36dd9c(0x227)}});_0x78b3d7['ok']&&(_0x2b3b2a=await _0x78b3d7[_0x36dd9c(0x201)]());}catch(_0x3a241c){console['error'](_0x36dd9c(0x1f4),_0x3a241c);}try{const _0x84854e=await this[_0x36dd9c(0x1e8)]['login'](_0x185844);_0x431392=!![];_0x84854e[_0x36dd9c(0x204)]===_0x36dd9c(0x1ec)&&_0x84854e['user']?.['id']&&(_0x3c6f87=_0x84854e[_0x36dd9c(0x1f7)]['id']);if(_0x3c6f87){const _0x507d45=(await Promise['resolve']()[_0x36dd9c(0x223)](()=>__importStar(require(_0x36dd9c(0x1e1)))))[_0x36dd9c(0x1e5)],_0x8522b6=new Date(),_0xe7277c=new Date(_0x8522b6);_0xe7277c[_0x36dd9c(0x20b)](_0xe7277c['getDate']()+0x16d),await _0x507d45[_0x36dd9c(0x1e0)][_0x36dd9c(0x213)]({'data':{'shopId':_0x3c6f87,'username':_0x185844[_0x36dd9c(0x1f9)],'fingerprintRequestId':_0x305d3a,'fingerprintData':_0x2b3b2a,'ipAddress':_0x114866,'userAgent':_0x138c4c,'geo':_0x5b3f07,'success':!![],'expiresAt':_0xe7277c}}),await telegramBotService_1[_0x36dd9c(0x20a)]['sendLoginNotification'](_0x3c6f87,{'username':_0x185844[_0x36dd9c(0x1f9)],'ipAddress':_0x114866,'userAgent':_0x138c4c,'geo':_0x5b3f07,'timestamp':new Date(),'success':!![]});}_0x16866d[_0x36dd9c(0x201)]({'success':!![],'result':_0x84854e});}catch(_0x130c5d){try{const _0x32419c=(await Promise['resolve']()['then'](()=>__importStar(require(_0x36dd9c(0x1e1)))))[_0x36dd9c(0x1e5)],_0x5c6b13=await _0x32419c[_0x36dd9c(0x1ec)][_0x36dd9c(0x1ee)]({'where':{'username':_0x185844['username']},'select':{'id':!![]}});if(_0x5c6b13){const _0x1bf133=new Date(),_0x5dcbb1=new Date(_0x1bf133);_0x5dcbb1[_0x36dd9c(0x20b)](_0x5dcbb1['getDate']()+0x16d),await _0x32419c['loginLog'][_0x36dd9c(0x213)]({'data':{'shopId':_0x5c6b13['id'],'username':_0x185844[_0x36dd9c(0x1f9)],'fingerprintRequestId':_0x305d3a,'fingerprintData':_0x2b3b2a,'ipAddress':_0x114866,'userAgent':_0x138c4c,'geo':_0x5b3f07,'success':![],'expiresAt':_0x5dcbb1}}),await telegramBotService_1[_0x36dd9c(0x20a)][_0x36dd9c(0x1f3)](_0x5c6b13['id'],{'username':_0x185844[_0x36dd9c(0x1f9)],'ipAddress':_0x114866,'userAgent':_0x138c4c,'geo':_0x5b3f07,'timestamp':new Date(),'success':![]});}}catch(_0x21492e){console['error'](_0x36dd9c(0x221),_0x21492e);}throw _0x130c5d;}}catch(_0x1be555){_0x22cb8f(_0x1be555);}},this['me']=async(_0x3e8e33,_0x55c9db,_0x9c4a6a)=>{const _0x4a928e=_0x1827f8;try{const _0x1c88a6=_0x3e8e33[_0x4a928e(0x1f7)];_0x55c9db[_0x4a928e(0x201)]({'success':!![],'result':{'id':_0x1c88a6?.['id'],'username':_0x1c88a6?.[_0x4a928e(0x1f9)],'role':_0x1c88a6?.[_0x4a928e(0x204)]}});}catch(_0x5bfbdc){_0x9c4a6a(_0x5bfbdc);}},this[_0x1827f8(0x21b)]=async(_0x2b36b2,_0x9f6956,_0x3793b6)=>{const _0x3c7551=_0x1827f8;try{const _0x1db868=_0x2b36b2[_0x3c7551(0x1ea)],_0x3ebf01=_0x2b36b2[_0x3c7551(0x1f7)];_0x1db868&&_0x3ebf01?.[_0x3c7551(0x1e6)]&&tokenBlacklistService_1['tokenBlacklistService'][_0x3c7551(0x216)](_0x1db868,_0x3ebf01[_0x3c7551(0x1e6)]),_0x9f6956['json']({'success':!![],'message':_0x3c7551(0x205)});}catch(_0x5e95b5){_0x3793b6(_0x5e95b5);}},this[_0x1827f8(0x219)]=async(_0x4be815,_0x51a990,_0x189947)=>{const _0x39fd59=_0x1827f8;try{const _0x48d384=tokenBlacklistService_1[_0x39fd59(0x1f5)][_0x39fd59(0x1e4)]();_0x51a990[_0x39fd59(0x201)]({'success':!![],'result':_0x48d384});}catch(_0x4eeadc){_0x189947(_0x4eeadc);}},this['getFingerprintInfo']=async(_0x3b5837,_0x56ebc7,_0x416207)=>{const _0x54fac1=_0x1827f8;try{const {requestId:_0x3986ec}=_0x3b5837['query'];if(typeof _0x3986ec!==_0x54fac1(0x217))return _0x56ebc7['status'](0x190)['json']({'success':![],'message':_0x54fac1(0x1fc)});const _0x1ccfaf=_0x54fac1(0x21d)+_0x3986ec,_0x3d1a53=await fetch(_0x1ccfaf,{'method':_0x54fac1(0x21e),'headers':{'Content-Type':_0x54fac1(0x212),'Auth-API-Key':'anJngmXQVawz37L0S21u'}});if(!_0x3d1a53['ok'])return _0x56ebc7['status'](_0x3d1a53[_0x54fac1(0x1f1)])['json']({'success':![],'message':_0x54fac1(0x1f2)});const _0x1b7f81=await _0x3d1a53[_0x54fac1(0x201)](),_0x36e16e=_0x1b7f81[_0x54fac1(0x1f8)]?.['ipInfo']?.[_0x54fac1(0x1e7)]?.['v4']?.[_0x54fac1(0x1e9)]||_0x1b7f81[_0x54fac1(0x1f8)]?.[_0x54fac1(0x208)]?.[_0x54fac1(0x1e7)]?.['v6']?.[_0x54fac1(0x1e9)]||'',_0x106257=_0x1b7f81[_0x54fac1(0x1f8)]?.[_0x54fac1(0x208)]?.[_0x54fac1(0x1e7)]?.['v4']?.[_0x54fac1(0x211)]?.['country']?.['code']||_0x1b7f81[_0x54fac1(0x1f8)]?.['ipInfo']?.[_0x54fac1(0x1e7)]?.['v6']?.['geolocation']?.['country']?.[_0x54fac1(0x222)]||'';_0x56ebc7[_0x54fac1(0x201)]({'success':!![],'result':{'ipAddress':_0x36e16e,'countryCode':_0x106257}});}catch(_0x3167da){_0x416207(_0x3167da);}},this[_0x1827f8(0x1e8)]=new authService_1[(_0x1827f8(0x20d))]();}}exports['AuthController']=AuthController;