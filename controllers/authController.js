'use strict';const a5_0x23b209=a5_0x5b58;function a5_0x5b58(_0x681fb0,_0x295ad0){_0x681fb0=_0x681fb0-0x17a;const _0x2542c3=a5_0x2542();let _0x5b589f=_0x2542c3[_0x681fb0];return _0x5b589f;}(function(_0x2c3f28,_0x1e605a){const _0x3511c3=a5_0x5b58,_0x2d2bfc=_0x2c3f28();while(!![]){try{const _0x2b5539=-parseInt(_0x3511c3(0x1be))/0x1*(-parseInt(_0x3511c3(0x182))/0x2)+-parseInt(_0x3511c3(0x18c))/0x3*(parseInt(_0x3511c3(0x1b8))/0x4)+parseInt(_0x3511c3(0x1aa))/0x5+parseInt(_0x3511c3(0x192))/0x6+parseInt(_0x3511c3(0x1a1))/0x7*(parseInt(_0x3511c3(0x196))/0x8)+-parseInt(_0x3511c3(0x184))/0x9+-parseInt(_0x3511c3(0x187))/0xa;if(_0x2b5539===_0x1e605a)break;else _0x2d2bfc['push'](_0x2d2bfc['shift']());}catch(_0x3ac2e8){_0x2d2bfc['push'](_0x2d2bfc['shift']());}}}(a5_0x2542,0xaa10e));var __createBinding=this&&this[a5_0x23b209(0x1b9)]||(Object[a5_0x23b209(0x199)]?function(_0x57ca84,_0x5484ea,_0x357163,_0x5aecf0){const _0x1cc8e5=a5_0x23b209;if(_0x5aecf0===undefined)_0x5aecf0=_0x357163;var _0xda6330=Object[_0x1cc8e5(0x190)](_0x5484ea,_0x357163);(!_0xda6330||(_0x1cc8e5(0x19f)in _0xda6330?!_0x5484ea['__esModule']:_0xda6330['writable']||_0xda6330[_0x1cc8e5(0x17c)]))&&(_0xda6330={'enumerable':!![],'get':function(){return _0x5484ea[_0x357163];}}),Object[_0x1cc8e5(0x1bb)](_0x57ca84,_0x5aecf0,_0xda6330);}:function(_0x26badb,_0x2c13f1,_0x5898c5,_0x129ec3){if(_0x129ec3===undefined)_0x129ec3=_0x5898c5;_0x26badb[_0x129ec3]=_0x2c13f1[_0x5898c5];}),__setModuleDefault=this&&this[a5_0x23b209(0x1ab)]||(Object[a5_0x23b209(0x199)]?function(_0x45bbd1,_0x823066){const _0x20c7f8=a5_0x23b209;Object[_0x20c7f8(0x1bb)](_0x45bbd1,_0x20c7f8(0x1b5),{'enumerable':!![],'value':_0x823066});}:function(_0x593b8c,_0x59e0ba){const _0x2eb80c=a5_0x23b209;_0x593b8c[_0x2eb80c(0x1b5)]=_0x59e0ba;}),__importStar=this&&this[a5_0x23b209(0x17d)]||(function(){var _0x1600c0=function(_0x508244){return _0x1600c0=Object['getOwnPropertyNames']||function(_0x401f03){const _0x3a90c5=a5_0x5b58;var _0x159473=[];for(var _0x16b26 in _0x401f03)if(Object['prototype'][_0x3a90c5(0x197)]['call'](_0x401f03,_0x16b26))_0x159473[_0x159473[_0x3a90c5(0x1a8)]]=_0x16b26;return _0x159473;},_0x1600c0(_0x508244);};return function(_0x462bb6){const _0x416327=a5_0x5b58;if(_0x462bb6&&_0x462bb6['__esModule'])return _0x462bb6;var _0x5e11cb={};if(_0x462bb6!=null){for(var _0x634b80=_0x1600c0(_0x462bb6),_0x3640ff=0x0;_0x3640ff<_0x634b80['length'];_0x3640ff++)if(_0x634b80[_0x3640ff]!==_0x416327(0x1b5))__createBinding(_0x5e11cb,_0x462bb6,_0x634b80[_0x3640ff]);}return __setModuleDefault(_0x5e11cb,_0x462bb6),_0x5e11cb;};}());Object['defineProperty'](exports,a5_0x23b209(0x185),{'value':!![]}),exports[a5_0x23b209(0x1a4)]=void 0x0;function a5_0x2542(){const _0x57ca45=['status','blacklistToken','getOwnPropertyDescriptor','Failed\x20to\x20send\x20failed\x20login\x20notification:','3329058RBoQCl','products','then','getStats','4240OPKRfW','hasOwnProperty','code','create','query','sendLoginNotification','tokenBlacklistService','data','connection','get','requestId\x20query\x20parameter\x20is\x20required','13916VFFOGd','country','token','AuthController','../services/tokenBlacklistService','telegramBotService','logout','length','body','4627650JvugOG','__setModuleDefault','unknown','Failed\x20to\x20retrieve\x20fingerprint\x20data','Failed\x20to\x20fetch\x20fingerprint\x20data:','getDate','https://eu.api.fpjs.io/events/','geolocation','authService','ipInfo','user','default','User-Agent','username','80neKRfU','__createBinding','loginLog','defineProperty','string','anJngmXQVawz37L0S21u','19tYpwlu','application/json','geo','getFingerprintInfo','error','Logged\x20out\x20successfully','findUnique','GET','configurable','__importStar','exp','userAgent','resolve','json','27340VlItou','AuthService','6503814okbbYs','__esModule','shop','7335070UMlffz','role','address','login','../services/telegramBotService','96150WySwbQ','setDate'];a5_0x2542=function(){return _0x57ca45;};return a5_0x2542();}const authService_1=require('../services/authService'),tokenBlacklistService_1=require(a5_0x23b209(0x1a5)),telegramBotService_1=require(a5_0x23b209(0x18b));class AuthController{constructor(){const _0x38ca5d=a5_0x23b209;this['login']=async(_0x2a7990,_0x42a20b,_0x84776a)=>{const _0x5e3af8=a5_0x5b58;try{const _0x58ccce=_0x2a7990[_0x5e3af8(0x1a9)],_0x1c2165=_0x58ccce['ipAddress']||_0x2a7990['ip']||_0x2a7990[_0x5e3af8(0x19e)]['remoteAddress']||_0x5e3af8(0x1ac),_0x4c61e7=_0x58ccce[_0x5e3af8(0x17f)]||_0x2a7990[_0x5e3af8(0x19f)](_0x5e3af8(0x1b6))||_0x5e3af8(0x1ac),_0x4d32a0=_0x58ccce[_0x5e3af8(0x1c0)],_0x43225d=_0x58ccce['fingerprintRequestId'];let _0x184b0f=![],_0x32ed81=null,_0x537b24=null;if(_0x43225d)try{const _0x2f662e='https://eu.api.fpjs.io/events/'+_0x43225d,_0xcb6db3=await fetch(_0x2f662e,{'method':_0x5e3af8(0x17b),'headers':{'Content-Type':_0x5e3af8(0x1bf),'Auth-API-Key':_0x5e3af8(0x1bd)}});_0xcb6db3['ok']&&(_0x537b24=await _0xcb6db3[_0x5e3af8(0x181)]());}catch(_0x1f1c4c){console[_0x5e3af8(0x1c2)](_0x5e3af8(0x1ae),_0x1f1c4c);}try{const _0x3b1816=await this[_0x5e3af8(0x1b2)][_0x5e3af8(0x18a)](_0x58ccce);_0x184b0f=!![];_0x3b1816[_0x5e3af8(0x188)]===_0x5e3af8(0x186)&&_0x3b1816[_0x5e3af8(0x1b4)]?.['id']&&(_0x32ed81=_0x3b1816[_0x5e3af8(0x1b4)]['id']);if(_0x32ed81){const _0x39fcac=(await Promise[_0x5e3af8(0x180)]()[_0x5e3af8(0x194)](()=>__importStar(require('../config/database'))))[_0x5e3af8(0x1b5)],_0x76caad=new Date(),_0x6206b2=new Date(_0x76caad);_0x6206b2['setDate'](_0x6206b2[_0x5e3af8(0x1af)]()+0x16d),await _0x39fcac[_0x5e3af8(0x1ba)][_0x5e3af8(0x199)]({'data':{'shopId':_0x32ed81,'username':_0x58ccce[_0x5e3af8(0x1b7)],'fingerprintRequestId':_0x43225d,'fingerprintData':_0x537b24,'ipAddress':_0x1c2165,'userAgent':_0x4c61e7,'geo':_0x4d32a0,'success':!![],'expiresAt':_0x6206b2}}),await telegramBotService_1['telegramBotService'][_0x5e3af8(0x19b)](_0x32ed81,{'username':_0x58ccce[_0x5e3af8(0x1b7)],'ipAddress':_0x1c2165,'userAgent':_0x4c61e7,'geo':_0x4d32a0,'timestamp':new Date(),'success':!![]});}_0x42a20b[_0x5e3af8(0x181)]({'success':!![],'result':_0x3b1816});}catch(_0x574197){try{const _0x107186=(await Promise[_0x5e3af8(0x180)]()[_0x5e3af8(0x194)](()=>__importStar(require('../config/database'))))[_0x5e3af8(0x1b5)],_0x4882db=await _0x107186[_0x5e3af8(0x186)][_0x5e3af8(0x17a)]({'where':{'username':_0x58ccce[_0x5e3af8(0x1b7)]},'select':{'id':!![]}});if(_0x4882db){const _0x2b2d87=new Date(),_0x47b9cc=new Date(_0x2b2d87);_0x47b9cc[_0x5e3af8(0x18d)](_0x47b9cc[_0x5e3af8(0x1af)]()+0x16d),await _0x107186[_0x5e3af8(0x1ba)]['create']({'data':{'shopId':_0x4882db['id'],'username':_0x58ccce[_0x5e3af8(0x1b7)],'fingerprintRequestId':_0x43225d,'fingerprintData':_0x537b24,'ipAddress':_0x1c2165,'userAgent':_0x4c61e7,'geo':_0x4d32a0,'success':![],'expiresAt':_0x47b9cc}}),await telegramBotService_1[_0x5e3af8(0x1a6)]['sendLoginNotification'](_0x4882db['id'],{'username':_0x58ccce[_0x5e3af8(0x1b7)],'ipAddress':_0x1c2165,'userAgent':_0x4c61e7,'geo':_0x4d32a0,'timestamp':new Date(),'success':![]});}}catch(_0x31a6b6){console['error'](_0x5e3af8(0x191),_0x31a6b6);}throw _0x574197;}}catch(_0x927054){_0x84776a(_0x927054);}},this['me']=async(_0x2b1ae7,_0x40b860,_0x22462b)=>{const _0x3e2997=a5_0x5b58;try{const _0x1400da=_0x2b1ae7['user'];_0x40b860['json']({'success':!![],'result':{'id':_0x1400da?.['id'],'username':_0x1400da?.[_0x3e2997(0x1b7)],'role':_0x1400da?.['role']}});}catch(_0x174e71){_0x22462b(_0x174e71);}},this[_0x38ca5d(0x1a7)]=async(_0x2db69f,_0x5b574c,_0xd5f677)=>{const _0x5939d4=_0x38ca5d;try{const _0x1b4e23=_0x2db69f[_0x5939d4(0x1a3)],_0x22840e=_0x2db69f['user'];_0x1b4e23&&_0x22840e?.[_0x5939d4(0x17e)]&&tokenBlacklistService_1[_0x5939d4(0x19c)][_0x5939d4(0x18f)](_0x1b4e23,_0x22840e[_0x5939d4(0x17e)]),_0x5b574c[_0x5939d4(0x181)]({'success':!![],'message':_0x5939d4(0x1c3)});}catch(_0x23ecb9){_0xd5f677(_0x23ecb9);}},this['getBlacklistStats']=async(_0x4618dd,_0xcae4f6,_0x3d8f2d)=>{const _0x46ff2f=_0x38ca5d;try{const _0x1b765b=tokenBlacklistService_1[_0x46ff2f(0x19c)][_0x46ff2f(0x195)]();_0xcae4f6[_0x46ff2f(0x181)]({'success':!![],'result':_0x1b765b});}catch(_0x2312f1){_0x3d8f2d(_0x2312f1);}},this[_0x38ca5d(0x1c1)]=async(_0x3f1981,_0x3f6411,_0x200e2c)=>{const _0x3218bb=_0x38ca5d;try{const {requestId:_0x4b6357}=_0x3f1981[_0x3218bb(0x19a)];if(typeof _0x4b6357!==_0x3218bb(0x1bc))return _0x3f6411['status'](0x190)[_0x3218bb(0x181)]({'success':![],'message':_0x3218bb(0x1a0)});const _0x2e4d82=_0x3218bb(0x1b0)+_0x4b6357,_0xacf8c5=await fetch(_0x2e4d82,{'method':_0x3218bb(0x17b),'headers':{'Content-Type':'application/json','Auth-API-Key':_0x3218bb(0x1bd)}});if(!_0xacf8c5['ok'])return _0x3f6411[_0x3218bb(0x18e)](_0xacf8c5[_0x3218bb(0x18e)])[_0x3218bb(0x181)]({'success':![],'message':_0x3218bb(0x1ad)});const _0x4aea77=await _0xacf8c5[_0x3218bb(0x181)](),_0x3fa494=_0x4aea77[_0x3218bb(0x193)]?.[_0x3218bb(0x1b3)]?.[_0x3218bb(0x19d)]?.['v4']?.['address']||_0x4aea77[_0x3218bb(0x193)]?.[_0x3218bb(0x1b3)]?.[_0x3218bb(0x19d)]?.['v6']?.[_0x3218bb(0x189)]||'',_0x5e1e47=_0x4aea77[_0x3218bb(0x193)]?.['ipInfo']?.[_0x3218bb(0x19d)]?.['v4']?.[_0x3218bb(0x1b1)]?.[_0x3218bb(0x1a2)]?.[_0x3218bb(0x198)]||_0x4aea77[_0x3218bb(0x193)]?.[_0x3218bb(0x1b3)]?.['data']?.['v6']?.[_0x3218bb(0x1b1)]?.['country']?.[_0x3218bb(0x198)]||'';_0x3f6411[_0x3218bb(0x181)]({'success':!![],'result':{'ipAddress':_0x3fa494,'countryCode':_0x5e1e47}});}catch(_0x11bb97){_0x200e2c(_0x11bb97);}},this[_0x38ca5d(0x1b2)]=new authService_1[(_0x38ca5d(0x183))]();}}exports['AuthController']=AuthController;