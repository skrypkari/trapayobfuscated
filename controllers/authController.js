'use strict';const a4_0xcf9b21=a4_0x56d6;function a4_0x56d6(_0x37bfb3,_0x39495c){const _0x32528d=a4_0x3252();return a4_0x56d6=function(_0x56d660,_0x55c527){_0x56d660=_0x56d660-0x9f;let _0x1ca720=_0x32528d[_0x56d660];return _0x1ca720;},a4_0x56d6(_0x37bfb3,_0x39495c);}(function(_0x54d198,_0x4bc04e){const _0x22b23a=a4_0x56d6,_0x58bc28=_0x54d198();while(!![]){try{const _0x32c2a8=-parseInt(_0x22b23a(0xc4))/0x1*(parseInt(_0x22b23a(0xbf))/0x2)+-parseInt(_0x22b23a(0xb3))/0x3+-parseInt(_0x22b23a(0xc9))/0x4*(parseInt(_0x22b23a(0xac))/0x5)+parseInt(_0x22b23a(0xa5))/0x6*(parseInt(_0x22b23a(0xa6))/0x7)+-parseInt(_0x22b23a(0xd0))/0x8*(-parseInt(_0x22b23a(0xcc))/0x9)+-parseInt(_0x22b23a(0xcd))/0xa+parseInt(_0x22b23a(0xc5))/0xb;if(_0x32c2a8===_0x4bc04e)break;else _0x58bc28['push'](_0x58bc28['shift']());}catch(_0x4bd554){_0x58bc28['push'](_0x58bc28['shift']());}}}(a4_0x3252,0x60f4d));var __createBinding=this&&this[a4_0xcf9b21(0xb6)]||(Object['create']?function(_0x2e7618,_0x5a0eba,_0x308911,_0x47b4fc){const _0x2a4305=a4_0xcf9b21;if(_0x47b4fc===undefined)_0x47b4fc=_0x308911;var _0x112623=Object[_0x2a4305(0xb7)](_0x5a0eba,_0x308911);(!_0x112623||('get'in _0x112623?!_0x5a0eba[_0x2a4305(0xa7)]:_0x112623[_0x2a4305(0xce)]||_0x112623[_0x2a4305(0xb8)]))&&(_0x112623={'enumerable':!![],'get':function(){return _0x5a0eba[_0x308911];}}),Object[_0x2a4305(0xd1)](_0x2e7618,_0x47b4fc,_0x112623);}:function(_0x27e44e,_0x40fe22,_0x2953a2,_0x2c62f2){if(_0x2c62f2===undefined)_0x2c62f2=_0x2953a2;_0x27e44e[_0x2c62f2]=_0x40fe22[_0x2953a2];}),__setModuleDefault=this&&this[a4_0xcf9b21(0xaf)]||(Object['create']?function(_0x5ba13c,_0x23b194){const _0x482c03=a4_0xcf9b21;Object['defineProperty'](_0x5ba13c,_0x482c03(0xc6),{'enumerable':!![],'value':_0x23b194});}:function(_0x5eac7c,_0x20a9ea){const _0x17d44f=a4_0xcf9b21;_0x5eac7c[_0x17d44f(0xc6)]=_0x20a9ea;}),__importStar=this&&this[a4_0xcf9b21(0x9f)]||(function(){var _0x3e513a=function(_0x4b1e6b){const _0x45fc61=a4_0x56d6;return _0x3e513a=Object[_0x45fc61(0xb1)]||function(_0x38bf3e){const _0x12cb7d=_0x45fc61;var _0x29bcbb=[];for(var _0x74d4af in _0x38bf3e)if(Object['prototype'][_0x12cb7d(0xcf)][_0x12cb7d(0xa2)](_0x38bf3e,_0x74d4af))_0x29bcbb[_0x29bcbb['length']]=_0x74d4af;return _0x29bcbb;},_0x3e513a(_0x4b1e6b);};return function(_0x306462){const _0x52c0ef=a4_0x56d6;if(_0x306462&&_0x306462[_0x52c0ef(0xa7)])return _0x306462;var _0x10502e={};if(_0x306462!=null){for(var _0x16384c=_0x3e513a(_0x306462),_0x457555=0x0;_0x457555<_0x16384c[_0x52c0ef(0xae)];_0x457555++)if(_0x16384c[_0x457555]!==_0x52c0ef(0xc6))__createBinding(_0x10502e,_0x306462,_0x16384c[_0x457555]);}return __setModuleDefault(_0x10502e,_0x306462),_0x10502e;};}());Object[a4_0xcf9b21(0xd1)](exports,a4_0xcf9b21(0xa7),{'value':!![]}),exports[a4_0xcf9b21(0xc1)]=void 0x0;const authService_1=require(a4_0xcf9b21(0xc7)),tokenBlacklistService_1=require(a4_0xcf9b21(0xca)),telegramBotService_1=require(a4_0xcf9b21(0xa8));function a4_0x3252(){const _0x26a32a=['configurable','getBlacklistStats','body','exp','username','token','getStats','1086KGEkxl','AuthService','AuthController','telegramBotService','user','443JlkKBF','8309444hroxCO','default','../services/authService','sendLoginNotification','64lrUIVV','../services/tokenBlacklistService','tokenBlacklistService','27aYcNKn','4906970VGYkwS','writable','hasOwnProperty','761576HDYoys','defineProperty','remoteAddress','authService','__importStar','connection','User-Agent','call','json','unknown','6hVQqAz','1202621ZAvZZY','__esModule','../services/telegramBotService','blacklistToken','login','get','17720vjmuLM','../config/database','length','__setModuleDefault','findUnique','getOwnPropertyNames','role','83145iLknlf','resolve','error','__createBinding','getOwnPropertyDescriptor'];a4_0x3252=function(){return _0x26a32a;};return a4_0x3252();}class AuthController{constructor(){const _0x50839c=a4_0xcf9b21;this[_0x50839c(0xaa)]=async(_0xc8eec,_0xd1aa0b,_0x56eb1c)=>{const _0x2cf4d4=_0x50839c;try{const _0xbd1ca1=_0xc8eec[_0x2cf4d4(0xba)],_0x48eca7=_0xc8eec['ip']||_0xc8eec[_0x2cf4d4(0xa0)][_0x2cf4d4(0xd2)]||_0x2cf4d4(0xa4),_0x1cd342=_0xc8eec[_0x2cf4d4(0xab)](_0x2cf4d4(0xa1))||_0x2cf4d4(0xa4);let _0x20be2b=![],_0x219abd=null;try{const _0x85c402=await this['authService']['login'](_0xbd1ca1);_0x20be2b=!![],_0x85c402['role']==='shop'&&_0x85c402[_0x2cf4d4(0xc3)]?.['id']&&(_0x219abd=_0x85c402['user']['id']),_0x219abd&&await telegramBotService_1['telegramBotService'][_0x2cf4d4(0xc8)](_0x219abd,{'username':_0xbd1ca1[_0x2cf4d4(0xbc)],'ipAddress':_0x48eca7,'userAgent':_0x1cd342,'timestamp':new Date(),'success':!![]}),_0xd1aa0b[_0x2cf4d4(0xa3)]({'success':!![],'result':_0x85c402});}catch(_0x509462){try{const _0x56a42b=(await Promise[_0x2cf4d4(0xb4)]()['then'](()=>__importStar(require(_0x2cf4d4(0xad)))))[_0x2cf4d4(0xc6)],_0x1029f1=await _0x56a42b['shop'][_0x2cf4d4(0xb0)]({'where':{'username':_0xbd1ca1['username']},'select':{'id':!![]}});_0x1029f1&&await telegramBotService_1[_0x2cf4d4(0xc2)][_0x2cf4d4(0xc8)](_0x1029f1['id'],{'username':_0xbd1ca1[_0x2cf4d4(0xbc)],'ipAddress':_0x48eca7,'userAgent':_0x1cd342,'timestamp':new Date(),'success':![]});}catch(_0x38df9e){console[_0x2cf4d4(0xb5)]('Failed\x20to\x20send\x20failed\x20login\x20notification:',_0x38df9e);}throw _0x509462;}}catch(_0x3e236e){_0x56eb1c(_0x3e236e);}},this['me']=async(_0x314b7b,_0x53826a,_0x285269)=>{const _0x24e907=_0x50839c;try{const _0x4c700e=_0x314b7b[_0x24e907(0xc3)];_0x53826a[_0x24e907(0xa3)]({'success':!![],'result':{'id':_0x4c700e?.['id'],'username':_0x4c700e?.[_0x24e907(0xbc)],'role':_0x4c700e?.[_0x24e907(0xb2)]}});}catch(_0x49df40){_0x285269(_0x49df40);}},this['logout']=async(_0x4df789,_0x2395f2,_0x428ab0)=>{const _0x29e330=_0x50839c;try{const _0x2127e0=_0x4df789[_0x29e330(0xbd)],_0x9cdba6=_0x4df789[_0x29e330(0xc3)];_0x2127e0&&_0x9cdba6?.[_0x29e330(0xbb)]&&tokenBlacklistService_1[_0x29e330(0xcb)][_0x29e330(0xa9)](_0x2127e0,_0x9cdba6[_0x29e330(0xbb)]),_0x2395f2[_0x29e330(0xa3)]({'success':!![],'message':'Logged\x20out\x20successfully'});}catch(_0x149dd1){_0x428ab0(_0x149dd1);}},this[_0x50839c(0xb9)]=async(_0x48ec88,_0x597b68,_0x9f3f5b)=>{const _0x5460ae=_0x50839c;try{const _0x3c593f=tokenBlacklistService_1[_0x5460ae(0xcb)][_0x5460ae(0xbe)]();_0x597b68[_0x5460ae(0xa3)]({'success':!![],'result':_0x3c593f});}catch(_0x440247){_0x9f3f5b(_0x440247);}},this[_0x50839c(0xd3)]=new authService_1[(_0x50839c(0xc0))]();}}exports[a4_0xcf9b21(0xc1)]=AuthController;