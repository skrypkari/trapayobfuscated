'use strict';function a5_0xed05(){const _0x3b5a27=['../config/database','application/json','getOwnPropertyDescriptor','then','country','getBlacklistStats','configurable','status','ipAddress','user','349787hhYZWO','ipInfo','25112btlnrN','getDate','body','prototype','Failed\x20to\x20retrieve\x20fingerprint\x20data','Failed\x20to\x20fetch\x20fingerprint\x20data:','resolve','products','AuthController','remoteAddress','__esModule','tokenBlacklistService','anJngmXQVawz37L0S21u','call','telegramBotService','get','AuthService','../services/telegramBotService','authService','create','exp','__createBinding','role','code','getOwnPropertyNames','Failed\x20to\x20send\x20failed\x20login\x20notification:','length','findUnique','setDate','error','411308xkInIH','974605NhUoXt','shop','3299016lHodnA','loginLog','getFingerprintInfo','unknown','geo','GET','Logged\x20out\x20successfully','359432fsskVO','14JJXpJl','login','User-Agent','data','default','https://eu.api.fpjs.io/events/','json','../services/authService','1856778gAvbvJ','defineProperty','fingerprintRequestId','writable','string','geolocation','address','2727BweVEs','username','requestId\x20query\x20parameter\x20is\x20required'];a5_0xed05=function(){return _0x3b5a27;};return a5_0xed05();}const a5_0x40bc1d=a5_0x2ea1;(function(_0x108fc2,_0x5d230d){const _0x3d89db=a5_0x2ea1,_0x57c6b9=_0x108fc2();while(!![]){try{const _0x50154f=parseInt(_0x3d89db(0xca))/0x1+parseInt(_0x3d89db(0xad))/0x2+-parseInt(_0x3d89db(0xa6))/0x3+-parseInt(_0x3d89db(0xa3))/0x4+-parseInt(_0x3d89db(0xa4))/0x5+-parseInt(_0x3d89db(0xb6))/0x6*(-parseInt(_0x3d89db(0xae))/0x7)+-parseInt(_0x3d89db(0xcc))/0x8*(-parseInt(_0x3d89db(0xbd))/0x9);if(_0x50154f===_0x5d230d)break;else _0x57c6b9['push'](_0x57c6b9['shift']());}catch(_0x5c919b){_0x57c6b9['push'](_0x57c6b9['shift']());}}}(a5_0xed05,0xab6ae));var __createBinding=this&&this[a5_0x40bc1d(0x9a)]||(Object[a5_0x40bc1d(0x98)]?function(_0x569b5e,_0x5e28c6,_0x35a51b,_0x540cbc){const _0x4106c0=a5_0x40bc1d;if(_0x540cbc===undefined)_0x540cbc=_0x35a51b;var _0x141f76=Object[_0x4106c0(0xc2)](_0x5e28c6,_0x35a51b);(!_0x141f76||(_0x4106c0(0xdb)in _0x141f76?!_0x5e28c6[_0x4106c0(0xd6)]:_0x141f76[_0x4106c0(0xb9)]||_0x141f76[_0x4106c0(0xc6)]))&&(_0x141f76={'enumerable':!![],'get':function(){return _0x5e28c6[_0x35a51b];}}),Object[_0x4106c0(0xb7)](_0x569b5e,_0x540cbc,_0x141f76);}:function(_0x348ab7,_0x455175,_0x27b609,_0x35a5e8){if(_0x35a5e8===undefined)_0x35a5e8=_0x27b609;_0x348ab7[_0x35a5e8]=_0x455175[_0x27b609];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a5_0x40bc1d(0x98)]?function(_0x456e7e,_0x1473a2){const _0x334cc1=a5_0x40bc1d;Object[_0x334cc1(0xb7)](_0x456e7e,'default',{'enumerable':!![],'value':_0x1473a2});}:function(_0x98eba4,_0x1a380f){const _0x11ab0d=a5_0x40bc1d;_0x98eba4[_0x11ab0d(0xb2)]=_0x1a380f;}),__importStar=this&&this['__importStar']||(function(){var _0x335a2b=function(_0x24f70a){const _0xdf438e=a5_0x2ea1;return _0x335a2b=Object[_0xdf438e(0x9d)]||function(_0x433926){const _0x3ae404=_0xdf438e;var _0x29a4b6=[];for(var _0x275429 in _0x433926)if(Object[_0x3ae404(0xcf)]['hasOwnProperty'][_0x3ae404(0xd9)](_0x433926,_0x275429))_0x29a4b6[_0x29a4b6[_0x3ae404(0x9f)]]=_0x275429;return _0x29a4b6;},_0x335a2b(_0x24f70a);};return function(_0x1f121e){if(_0x1f121e&&_0x1f121e['__esModule'])return _0x1f121e;var _0x13c318={};if(_0x1f121e!=null){for(var _0x14e6a5=_0x335a2b(_0x1f121e),_0x495d2d=0x0;_0x495d2d<_0x14e6a5['length'];_0x495d2d++)if(_0x14e6a5[_0x495d2d]!=='default')__createBinding(_0x13c318,_0x1f121e,_0x14e6a5[_0x495d2d]);}return __setModuleDefault(_0x13c318,_0x1f121e),_0x13c318;};}());Object[a5_0x40bc1d(0xb7)](exports,a5_0x40bc1d(0xd6),{'value':!![]}),exports[a5_0x40bc1d(0xd4)]=void 0x0;function a5_0x2ea1(_0x37436a,_0x17265a){_0x37436a=_0x37436a-0x95;const _0xed05ce=a5_0xed05();let _0x2ea196=_0xed05ce[_0x37436a];return _0x2ea196;}const authService_1=require(a5_0x40bc1d(0xb5)),tokenBlacklistService_1=require('../services/tokenBlacklistService'),telegramBotService_1=require(a5_0x40bc1d(0x96));class AuthController{constructor(){const _0x17e7e8=a5_0x40bc1d;this[_0x17e7e8(0xaf)]=async(_0x4f7b4b,_0x4d258c,_0x4a6243)=>{const _0x3a17a4=_0x17e7e8;try{const _0x27f898=_0x4f7b4b[_0x3a17a4(0xce)],_0x506c51=_0x27f898[_0x3a17a4(0xc8)]||_0x4f7b4b['ip']||_0x4f7b4b['connection'][_0x3a17a4(0xd5)]||_0x3a17a4(0xa9),_0x549dd0=_0x27f898['userAgent']||_0x4f7b4b['get'](_0x3a17a4(0xb0))||_0x3a17a4(0xa9),_0x2d5ff9=_0x27f898[_0x3a17a4(0xaa)],_0x16af4c=_0x27f898[_0x3a17a4(0xb8)];let _0x2bd512=![],_0x14d6d3=null,_0x3a132c=null;if(_0x16af4c)try{const _0x3f0114=_0x3a17a4(0xb3)+_0x16af4c,_0x47a1f5=await fetch(_0x3f0114,{'method':_0x3a17a4(0xab),'headers':{'Content-Type':'application/json','Auth-API-Key':_0x3a17a4(0xd8)}});_0x47a1f5['ok']&&(_0x3a132c=await _0x47a1f5[_0x3a17a4(0xb4)]());}catch(_0x55520e){console[_0x3a17a4(0xa2)](_0x3a17a4(0xd1),_0x55520e);}try{const _0xe9fb78=await this['authService'][_0x3a17a4(0xaf)](_0x27f898);_0x2bd512=!![];_0xe9fb78[_0x3a17a4(0x9b)]===_0x3a17a4(0xa5)&&_0xe9fb78[_0x3a17a4(0xc9)]?.['id']&&(_0x14d6d3=_0xe9fb78['user']['id']);if(_0x14d6d3){const _0x3c95d7=(await Promise[_0x3a17a4(0xd2)]()[_0x3a17a4(0xc3)](()=>__importStar(require('../config/database'))))['default'],_0x36655d=new Date(),_0x21cedf=new Date(_0x36655d);_0x21cedf[_0x3a17a4(0xa1)](_0x21cedf[_0x3a17a4(0xcd)]()+0x16d),await _0x3c95d7['loginLog'][_0x3a17a4(0x98)]({'data':{'shopId':_0x14d6d3,'username':_0x27f898[_0x3a17a4(0xbe)],'fingerprintRequestId':_0x16af4c,'fingerprintData':_0x3a132c,'ipAddress':_0x506c51,'userAgent':_0x549dd0,'geo':_0x2d5ff9,'success':!![],'expiresAt':_0x21cedf}}),await telegramBotService_1['telegramBotService']['sendLoginNotification'](_0x14d6d3,{'username':_0x27f898[_0x3a17a4(0xbe)],'ipAddress':_0x506c51,'userAgent':_0x549dd0,'geo':_0x2d5ff9,'timestamp':new Date(),'success':!![]});}_0x4d258c[_0x3a17a4(0xb4)]({'success':!![],'result':_0xe9fb78});}catch(_0x891308){try{const _0x28b94a=(await Promise[_0x3a17a4(0xd2)]()[_0x3a17a4(0xc3)](()=>__importStar(require(_0x3a17a4(0xc0)))))[_0x3a17a4(0xb2)],_0x7abb84=await _0x28b94a[_0x3a17a4(0xa5)][_0x3a17a4(0xa0)]({'where':{'username':_0x27f898[_0x3a17a4(0xbe)]},'select':{'id':!![]}});if(_0x7abb84){const _0xd6ac75=new Date(),_0x30e3de=new Date(_0xd6ac75);_0x30e3de[_0x3a17a4(0xa1)](_0x30e3de[_0x3a17a4(0xcd)]()+0x16d),await _0x28b94a[_0x3a17a4(0xa7)]['create']({'data':{'shopId':_0x7abb84['id'],'username':_0x27f898[_0x3a17a4(0xbe)],'fingerprintRequestId':_0x16af4c,'fingerprintData':_0x3a132c,'ipAddress':_0x506c51,'userAgent':_0x549dd0,'geo':_0x2d5ff9,'success':![],'expiresAt':_0x30e3de}}),await telegramBotService_1[_0x3a17a4(0xda)]['sendLoginNotification'](_0x7abb84['id'],{'username':_0x27f898[_0x3a17a4(0xbe)],'ipAddress':_0x506c51,'userAgent':_0x549dd0,'geo':_0x2d5ff9,'timestamp':new Date(),'success':![]});}}catch(_0x1c09d0){console['error'](_0x3a17a4(0x9e),_0x1c09d0);}throw _0x891308;}}catch(_0x1e28c5){_0x4a6243(_0x1e28c5);}},this['me']=async(_0x329af8,_0x3b1235,_0x3c4725)=>{const _0x39b412=_0x17e7e8;try{const _0x7ad63f=_0x329af8[_0x39b412(0xc9)];_0x3b1235[_0x39b412(0xb4)]({'success':!![],'result':{'id':_0x7ad63f?.['id'],'username':_0x7ad63f?.['username'],'role':_0x7ad63f?.['role']}});}catch(_0x2db958){_0x3c4725(_0x2db958);}},this['logout']=async(_0x184134,_0x419ae1,_0x4436b7)=>{const _0x5663fc=_0x17e7e8;try{const _0x597b3e=_0x184134['token'],_0x196118=_0x184134[_0x5663fc(0xc9)];_0x597b3e&&_0x196118?.['exp']&&tokenBlacklistService_1[_0x5663fc(0xd7)]['blacklistToken'](_0x597b3e,_0x196118[_0x5663fc(0x99)]),_0x419ae1['json']({'success':!![],'message':_0x5663fc(0xac)});}catch(_0x27d082){_0x4436b7(_0x27d082);}},this[_0x17e7e8(0xc5)]=async(_0x5643c5,_0x641f22,_0x1102ad)=>{const _0x42a7fe=_0x17e7e8;try{const _0x4f6d9a=tokenBlacklistService_1[_0x42a7fe(0xd7)]['getStats']();_0x641f22[_0x42a7fe(0xb4)]({'success':!![],'result':_0x4f6d9a});}catch(_0x597394){_0x1102ad(_0x597394);}},this[_0x17e7e8(0xa8)]=async(_0x32f411,_0x37d8d5,_0x158f87)=>{const _0x177187=_0x17e7e8;try{const {requestId:_0x46ad36}=_0x32f411['query'];if(typeof _0x46ad36!==_0x177187(0xba))return _0x37d8d5['status'](0x190)['json']({'success':![],'message':_0x177187(0xbf)});const _0x5bd0f2=_0x177187(0xb3)+_0x46ad36,_0x1a50cb=await fetch(_0x5bd0f2,{'method':'GET','headers':{'Content-Type':_0x177187(0xc1),'Auth-API-Key':_0x177187(0xd8)}});if(!_0x1a50cb['ok'])return _0x37d8d5[_0x177187(0xc7)](_0x1a50cb['status'])[_0x177187(0xb4)]({'success':![],'message':_0x177187(0xd0)});const _0x36ce68=await _0x1a50cb[_0x177187(0xb4)](),_0x501844=_0x36ce68[_0x177187(0xd3)]?.[_0x177187(0xcb)]?.[_0x177187(0xb1)]?.['v4']?.[_0x177187(0xbc)]||_0x36ce68['products']?.[_0x177187(0xcb)]?.[_0x177187(0xb1)]?.['v6']?.[_0x177187(0xbc)]||'',_0x301c4f=_0x36ce68['products']?.[_0x177187(0xcb)]?.[_0x177187(0xb1)]?.['v4']?.[_0x177187(0xbb)]?.[_0x177187(0xc4)]?.['code']||_0x36ce68['products']?.[_0x177187(0xcb)]?.[_0x177187(0xb1)]?.['v6']?.[_0x177187(0xbb)]?.[_0x177187(0xc4)]?.[_0x177187(0x9c)]||'';_0x37d8d5[_0x177187(0xb4)]({'success':!![],'result':{'ipAddress':_0x501844,'countryCode':_0x301c4f}});}catch(_0x2ac439){_0x158f87(_0x2ac439);}},this[_0x17e7e8(0x97)]=new authService_1[(_0x17e7e8(0x95))]();}}exports['AuthController']=AuthController;