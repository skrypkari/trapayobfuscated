'use strict';function a16_0x391e(){const _0x499ffc=['customerEmail','payment_url','customerName','sourceCurrency','__esModule','network','country','prePayment','175847UdURvM','12210237EUfXSK','cointopay2','update','prePaymentService','payment','2476UtMJTG','getPaymentFingerprint','__importDefault','2864096tBhXpn','getPrePaymentByCode','findUnique','cointopay','../services/prePaymentService','confirmPrePayment','pendingUrl','../services/paymentService','error','noda','66nlsvAQ','PrePaymentController','getGatewayIdFromName','json','https://app.trapay.uk','258048lwlCoW','Failed\x20to\x20fetch\x20pre-payment','instaxchange','maxpara','âœ…\x20Fingerprint\x20saved\x20for\x20payment\x20','log','defineProperty','shop','getPrePayment','createPublicPayment','3375vjbvfP','paymentService','Failed\x20to\x20save\x20fingerprint:','status','isDisposable','Customer\x20email\x20and\x20name\x20are\x20required','currency','gateway','prePaymentId','../config/database','language','/payment/','PaymentService','default','shopId','deliverabilityStatus','173718ZqBZPJ','publicKey','successUrl','body','failUrl','Shop\x20not\x20found','90752EctRAV'];a16_0x391e=function(){return _0x499ffc;};return a16_0x391e();}const a16_0x3859c3=a16_0x31c7;(function(_0x271f96,_0x5b4459){const _0x47da75=a16_0x31c7,_0xab2dd9=_0x271f96();while(!![]){try{const _0x420594=-parseInt(_0x47da75(0xd5))/0x1+parseInt(_0x47da75(0xcf))/0x2+-parseInt(_0x47da75(0xf6))/0x3+-parseInt(_0x47da75(0xe4))/0x4*(parseInt(_0x47da75(0x100))/0x5)+parseInt(_0x47da75(0xf1))/0x6*(-parseInt(_0x47da75(0xde))/0x7)+-parseInt(_0x47da75(0xe7))/0x8+parseInt(_0x47da75(0xdf))/0x9;if(_0x420594===_0x5b4459)break;else _0xab2dd9['push'](_0xab2dd9['shift']());}catch(_0x47ddf6){_0xab2dd9['push'](_0xab2dd9['shift']());}}}(a16_0x391e,0x34658));function a16_0x31c7(_0x334ba0,_0x5ac146){_0x334ba0=_0x334ba0-0xcd;const _0x391e09=a16_0x391e();let _0x31c728=_0x391e09[_0x334ba0];return _0x31c728;}var __importDefault=this&&this[a16_0x3859c3(0xe6)]||function(_0x57165c){const _0x412e95=a16_0x3859c3;return _0x57165c&&_0x57165c[_0x412e95(0xda)]?_0x57165c:{'default':_0x57165c};};Object[a16_0x3859c3(0xfc)](exports,'__esModule',{'value':!![]}),exports['prePaymentController']=exports[a16_0x3859c3(0xf2)]=void 0x0;const database_1=__importDefault(require(a16_0x3859c3(0x109))),prePaymentService_1=require(a16_0x3859c3(0xeb)),paymentService_1=require(a16_0x3859c3(0xee));class PrePaymentController{constructor(){const _0x5703dd=a16_0x3859c3;this[_0x5703dd(0x101)]=new paymentService_1[(_0x5703dd(0x10c))]();}async[a16_0x3859c3(0xfe)](_0x149eeb,_0x2a4a45){const _0x9b6fe5=a16_0x3859c3;try{const {code:_0x5d1dca}=_0x149eeb['params'],_0x43f7a6=await prePaymentService_1[_0x9b6fe5(0xe2)][_0x9b6fe5(0xe8)](_0x5d1dca);_0x2a4a45[_0x9b6fe5(0xf4)]({'success':!![],'result':_0x43f7a6});}catch(_0x261e2c){console[_0x9b6fe5(0xef)]('Get\x20pre-payment\x20error:',_0x261e2c),_0x2a4a45[_0x9b6fe5(0x103)](0x190)['json']({'success':![],'error':_0x261e2c['message']||_0x9b6fe5(0xf7)});}}async[a16_0x3859c3(0xec)](_0x5d4832,_0x1678c3){const _0x239ac8=a16_0x3859c3;try{const {code:_0x3c41ba}=_0x5d4832['params'],{customerEmail:_0x318e48,customerName:_0x29951a,customerIp:_0x5d5470,customerUa:_0x2d0ce5,customerCountry:_0x1d5743,requestId:_0x1f2cfd,emailValidation:_0x331e7d}=_0x5d4832[_0x239ac8(0xd2)];if(!_0x318e48||!_0x29951a)return _0x1678c3['status'](0x190)[_0x239ac8(0xf4)]({'success':![],'error':_0x239ac8(0x105)});const _0xbc9fa2=await prePaymentService_1[_0x239ac8(0xe2)]['confirmPrePayment'](_0x3c41ba,{'customerEmail':_0x318e48,'customerName':_0x29951a,'customerIp':_0x5d5470,'customerUa':_0x2d0ce5,'customerCountry':_0x1d5743}),_0xb3e1c3=await database_1['default'][_0x239ac8(0xfd)][_0x239ac8(0xe9)]({'where':{'id':_0xbc9fa2[_0x239ac8(0xcd)]},'select':{'publicKey':!![]}});if(!_0xb3e1c3)throw new Error(_0x239ac8(0xd4));const _0x2444e4=this['paymentService'][_0x239ac8(0xf3)](_0xbc9fa2[_0x239ac8(0x107)]),_0x315ee0=await this[_0x239ac8(0x101)][_0x239ac8(0xff)]({'public_key':_0xb3e1c3[_0x239ac8(0xd0)],'gateway':String(_0x2444e4),'order_id':_0xbc9fa2['orderId']||undefined,'amount':Number(_0xbc9fa2['amount']),'currency':_0xbc9fa2[_0x239ac8(0x106)],'source_currency':_0xbc9fa2[_0x239ac8(0xd9)]||undefined,'network':_0xbc9fa2[_0x239ac8(0xdb)]||undefined,'success_url':_0xbc9fa2[_0x239ac8(0xd1)]||undefined,'fail_url':_0xbc9fa2[_0x239ac8(0xd3)]||undefined,'pending_url':_0xbc9fa2[_0x239ac8(0xed)]||undefined,'customer_email':_0xbc9fa2[_0x239ac8(0xd6)],'customer_name':_0xbc9fa2[_0x239ac8(0xd8)],'customer_country':_0x1d5743,'customer_ip':_0x5d5470,'customer_ua':_0x2d0ce5,'country':_0xbc9fa2[_0x239ac8(0xdc)]||undefined,'language':_0xbc9fa2[_0x239ac8(0x10a)]||undefined});await database_1[_0x239ac8(0x10d)][_0x239ac8(0xdd)]['update']({'where':{'id':_0xbc9fa2[_0x239ac8(0x108)]},'data':{'paymentId':_0x315ee0['id']}});_0x331e7d&&await database_1[_0x239ac8(0x10d)][_0x239ac8(0xe3)][_0x239ac8(0xe1)]({'where':{'id':_0x315ee0['id']},'data':{'emailDeliverabilityStatus':_0x331e7d[_0x239ac8(0xce)],'emailIsDisposable':_0x331e7d[_0x239ac8(0x104)],'emailRiskLevel':_0x331e7d['riskLevel']}});if(_0x1f2cfd)try{await this[_0x239ac8(0x101)][_0x239ac8(0xe5)](_0x315ee0['id'],_0x1f2cfd),console[_0x239ac8(0xfb)](_0x239ac8(0xfa)+_0x315ee0['id']);}catch(_0x2bd5e5){console[_0x239ac8(0xef)](_0x239ac8(0x102),_0x2bd5e5);}const _0x22e4f0=['rapyd',_0x239ac8(0xf9),_0x239ac8(0xf8),_0x239ac8(0xf0),_0x239ac8(0xea),_0x239ac8(0xe0)],_0x45a81c=_0x22e4f0['includes'](_0xbc9fa2[_0x239ac8(0x107)])&&_0x315ee0[_0x239ac8(0xd7)],_0x128765=process.env.FRONTEND_URL||_0x239ac8(0xf5),_0x2324a1=_0x45a81c?_0x315ee0['payment_url']:_0x128765+_0x239ac8(0x10b)+_0x315ee0['id'];_0x1678c3[_0x239ac8(0xf4)]({'success':!![],'result':{'paymentId':_0x315ee0['id'],'paymentUrl':_0x2324a1}});}catch(_0x30b23a){console['error']('Confirm\x20pre-payment\x20error:',_0x30b23a),_0x1678c3['status'](0x190)[_0x239ac8(0xf4)]({'success':![],'error':_0x30b23a['message']||'Failed\x20to\x20confirm\x20pre-payment'});}}}exports[a16_0x3859c3(0xf2)]=PrePaymentController,exports['prePaymentController']=new PrePaymentController();