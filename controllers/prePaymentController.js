'use strict';const a16_0x27ad68=a16_0x4973;(function(_0x1aef3f,_0x4eba4a){const _0x2c041a=a16_0x4973,_0x210f9f=_0x1aef3f();while(!![]){try{const _0x31cc0f=parseInt(_0x2c041a(0x152))/0x1+parseInt(_0x2c041a(0x172))/0x2+-parseInt(_0x2c041a(0x15b))/0x3+parseInt(_0x2c041a(0x150))/0x4*(-parseInt(_0x2c041a(0x164))/0x5)+-parseInt(_0x2c041a(0x14a))/0x6*(-parseInt(_0x2c041a(0x141))/0x7)+-parseInt(_0x2c041a(0x175))/0x8+parseInt(_0x2c041a(0x168))/0x9*(parseInt(_0x2c041a(0x159))/0xa);if(_0x31cc0f===_0x4eba4a)break;else _0x210f9f['push'](_0x210f9f['shift']());}catch(_0x3a2817){_0x210f9f['push'](_0x210f9f['shift']());}}}(a16_0x1202,0x2aa44));function a16_0x4973(_0x622ed0,_0x111beb){_0x622ed0=_0x622ed0-0x13f;const _0x1202ee=a16_0x1202();let _0x4973bd=_0x1202ee[_0x622ed0];return _0x4973bd;}var __importDefault=this&&this[a16_0x27ad68(0x153)]||function(_0x266a3f){return _0x266a3f&&_0x266a3f['__esModule']?_0x266a3f:{'default':_0x266a3f};};Object[a16_0x27ad68(0x176)](exports,a16_0x27ad68(0x177),{'value':!![]}),exports[a16_0x27ad68(0x160)]=exports['PrePaymentController']=void 0x0;const database_1=__importDefault(require(a16_0x27ad68(0x144))),prePaymentService_1=require(a16_0x27ad68(0x15c)),paymentService_1=require(a16_0x27ad68(0x142));class PrePaymentController{constructor(){const _0x3d266d=a16_0x27ad68;this[_0x3d266d(0x16d)]=new paymentService_1[(_0x3d266d(0x16f))]();}async[a16_0x27ad68(0x169)](_0x2cec2e,_0x2e33bb){const _0x30df3e=a16_0x27ad68;try{const {code:_0x250874}=_0x2cec2e['params'],_0x124c6c=await prePaymentService_1[_0x30df3e(0x16e)]['getPrePaymentByCode'](_0x250874);_0x2e33bb[_0x30df3e(0x166)]({'success':!![],'result':_0x124c6c});}catch(_0x316c9c){console[_0x30df3e(0x15f)](_0x30df3e(0x145),_0x316c9c),_0x2e33bb[_0x30df3e(0x149)](0x190)[_0x30df3e(0x166)]({'success':![],'error':_0x316c9c[_0x30df3e(0x161)]||_0x30df3e(0x151)});}}async[a16_0x27ad68(0x154)](_0xb1aa2a,_0x4dae1a){const _0x47d829=a16_0x27ad68;try{const {code:_0x36fe7f}=_0xb1aa2a[_0x47d829(0x167)],{customerEmail:_0x2b73fc,customerName:_0x6e84ca,customerIp:_0xf5f445,customerUa:_0xc405c9,customerCountry:_0x1d8713,requestId:_0x31a67f,emailValidation:_0x5c6c1d}=_0xb1aa2a['body'];if(!_0x2b73fc||!_0x6e84ca)return _0x4dae1a[_0x47d829(0x149)](0x190)[_0x47d829(0x166)]({'success':![],'error':_0x47d829(0x171)});const _0x4235cd=await prePaymentService_1['prePaymentService'][_0x47d829(0x154)](_0x36fe7f,{'customerEmail':_0x2b73fc,'customerName':_0x6e84ca,'customerIp':_0xf5f445,'customerUa':_0xc405c9,'customerCountry':_0x1d8713}),_0x39a732=await database_1[_0x47d829(0x13f)]['shop']['findUnique']({'where':{'id':_0x4235cd['shopId']},'select':{'publicKey':!![]}});if(!_0x39a732)throw new Error(_0x47d829(0x155));const _0x1ff6d2=this['paymentService'][_0x47d829(0x14c)](_0x4235cd['gateway']),_0x102746=await this['paymentService']['createPublicPayment']({'public_key':_0x39a732['publicKey'],'gateway':String(_0x1ff6d2),'order_id':_0x4235cd[_0x47d829(0x157)]||undefined,'amount':Number(_0x4235cd['amount']),'currency':_0x4235cd[_0x47d829(0x146)],'source_currency':_0x4235cd['sourceCurrency']||undefined,'network':_0x4235cd['network']||undefined,'success_url':_0x4235cd['successUrl']||undefined,'fail_url':_0x4235cd[_0x47d829(0x165)]||undefined,'pending_url':_0x4235cd[_0x47d829(0x16b)]||undefined,'customer_email':_0x4235cd['customerEmail'],'customer_name':_0x4235cd[_0x47d829(0x163)],'customer_country':_0x1d8713,'customer_ip':_0xf5f445,'customer_ua':_0xc405c9,'country':_0x4235cd[_0x47d829(0x143)]||undefined,'language':_0x4235cd[_0x47d829(0x148)]||undefined});await database_1[_0x47d829(0x13f)][_0x47d829(0x14e)]['update']({'where':{'id':_0x4235cd[_0x47d829(0x15d)]},'data':{'paymentId':_0x102746['id']}});_0x5c6c1d&&await database_1[_0x47d829(0x13f)]['payment'][_0x47d829(0x16a)]({'where':{'id':_0x102746['id']},'data':{'emailDeliverabilityStatus':_0x5c6c1d[_0x47d829(0x170)],'emailIsDisposable':_0x5c6c1d['isDisposable'],'emailRiskLevel':_0x5c6c1d['riskLevel']}});if(_0x31a67f)try{await this[_0x47d829(0x16d)]['getPaymentFingerprint'](_0x102746['id'],_0x31a67f),console[_0x47d829(0x173)]('âœ…\x20Fingerprint\x20saved\x20for\x20payment\x20'+_0x102746['id']);}catch(_0x55260d){console[_0x47d829(0x15f)](_0x47d829(0x14d),_0x55260d);}const _0x1a0fb5=[_0x47d829(0x162),_0x47d829(0x147),'instaxchange','noda',_0x47d829(0x14b),'cointopay2'],_0x2dd943=_0x1a0fb5[_0x47d829(0x174)](_0x4235cd[_0x47d829(0x14f)])&&_0x102746[_0x47d829(0x15a)],_0x47ade0=process.env.FRONTEND_URL||_0x47d829(0x158),_0x5c1d75=_0x2dd943?_0x102746[_0x47d829(0x15a)]:_0x47ade0+_0x47d829(0x156)+_0x102746['id'];_0x4dae1a[_0x47d829(0x166)]({'success':!![],'result':{'paymentId':_0x102746['id'],'paymentUrl':_0x5c1d75}});}catch(_0x3e228d){console[_0x47d829(0x15f)](_0x47d829(0x15e),_0x3e228d),_0x4dae1a['status'](0x190)[_0x47d829(0x166)]({'success':![],'error':_0x3e228d['message']||_0x47d829(0x140)});}}}function a16_0x1202(){const _0x1e318c=['6hwkjqq','cointopay','getGatewayIdFromName','Failed\x20to\x20save\x20fingerprint:','prePayment','gateway','651928gDLGJz','Failed\x20to\x20fetch\x20pre-payment','296812jfkdir','__importDefault','confirmPrePayment','Shop\x20not\x20found','/payment/','orderId','https://app.trapay.uk','100IOtPKN','payment_url','730824FUptZr','../services/prePaymentService','prePaymentId','Confirm\x20pre-payment\x20error:','error','prePaymentController','message','rapyd','customerName','5gyKoms','failUrl','json','params','172224wBqKLO','getPrePayment','update','pendingUrl','PrePaymentController','paymentService','prePaymentService','PaymentService','deliverabilityStatus','Customer\x20email\x20and\x20name\x20are\x20required','85478WGjxPr','log','includes','1437792fnjidS','defineProperty','__esModule','default','Failed\x20to\x20confirm\x20pre-payment','1610441EMrhdo','../services/paymentService','country','../config/database','Get\x20pre-payment\x20error:','currency','maxpara','language','status'];a16_0x1202=function(){return _0x1e318c;};return a16_0x1202();}exports[a16_0x27ad68(0x16c)]=PrePaymentController,exports[a16_0x27ad68(0x160)]=new PrePaymentController();