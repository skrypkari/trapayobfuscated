'use strict';const a16_0x27f432=a16_0x1e92;(function(_0x5c4261,_0x43c4dd){const _0xa08f63=a16_0x1e92,_0x5df5f0=_0x5c4261();while(!![]){try{const _0x391978=-parseInt(_0xa08f63(0x189))/0x1*(parseInt(_0xa08f63(0x180))/0x2)+parseInt(_0xa08f63(0x179))/0x3+-parseInt(_0xa08f63(0x19e))/0x4+-parseInt(_0xa08f63(0x1a5))/0x5*(-parseInt(_0xa08f63(0x1a7))/0x6)+-parseInt(_0xa08f63(0x1b1))/0x7*(parseInt(_0xa08f63(0x17b))/0x8)+-parseInt(_0xa08f63(0x1a3))/0x9+parseInt(_0xa08f63(0x19b))/0xa;if(_0x391978===_0x43c4dd)break;else _0x5df5f0['push'](_0x5df5f0['shift']());}catch(_0x1092c1){_0x5df5f0['push'](_0x5df5f0['shift']());}}}(a16_0x4bd4,0xbd4c5));var __importDefault=this&&this[a16_0x27f432(0x1a6)]||function(_0x2ef2bf){const _0x1657f7=a16_0x27f432;return _0x2ef2bf&&_0x2ef2bf[_0x1657f7(0x184)]?_0x2ef2bf:{'default':_0x2ef2bf};};Object[a16_0x27f432(0x1af)](exports,a16_0x27f432(0x184),{'value':!![]}),exports[a16_0x27f432(0x19f)]=exports[a16_0x27f432(0x181)]=void 0x0;const database_1=__importDefault(require(a16_0x27f432(0x1aa))),prePaymentService_1=require(a16_0x27f432(0x1b6)),paymentService_1=require(a16_0x27f432(0x1b7));function a16_0x1e92(_0x31706b,_0x479026){_0x31706b=_0x31706b-0x179;const _0x4bd46f=a16_0x4bd4();let _0x1e9263=_0x4bd46f[_0x31706b];return _0x1e9263;}function a16_0x4bd4(){const _0x40468a=['publicKey','Customer\x20email\x20and\x20name\x20are\x20required','getPrePayment','payment_url','shopId','successUrl','gateway','getGatewayIdFromName','failUrl','json','prePaymentId','language','deliverabilityStatus','body','getPaymentFingerprint','10291530yHEPXn','Failed\x20to\x20confirm\x20pre-payment','Get\x20pre-payment\x20error:','5359204PfFQAa','prePaymentController','default','orderId','sourceCurrency','4650201RdKPki','confirmPrePayment','295175loitLF','__importDefault','102QDLDqU','cointopay','currency','../config/database','cointopay2','Confirm\x20pre-payment\x20error:','status','includes','defineProperty','prePaymentService','16436FwvywA','params','PaymentService','update','findUnique','../services/prePaymentService','../services/paymentService','prePayment','3366450pVoCXG','instaxchange','512vgOPLr','âœ…\x20Fingerprint\x20saved\x20for\x20payment\x20','network','paymentService','customerEmail','12222CmgxNA','PrePaymentController','error','riskLevel','__esModule','maxpara','pendingUrl','Shop\x20not\x20found','isDisposable','61OVnhXD','Failed\x20to\x20save\x20fingerprint:','payment'];a16_0x4bd4=function(){return _0x40468a;};return a16_0x4bd4();}class PrePaymentController{constructor(){const _0x154c30=a16_0x27f432;this[_0x154c30(0x17e)]=new paymentService_1[(_0x154c30(0x1b3))]();}async[a16_0x27f432(0x18e)](_0x336bff,_0x524ab5){const _0x2eeca4=a16_0x27f432;try{const {code:_0x106ce2}=_0x336bff[_0x2eeca4(0x1b2)],_0x4638d4=await prePaymentService_1[_0x2eeca4(0x1b0)]['getPrePaymentByCode'](_0x106ce2);_0x524ab5[_0x2eeca4(0x195)]({'success':!![],'result':_0x4638d4});}catch(_0x57833f){console[_0x2eeca4(0x182)](_0x2eeca4(0x19d),_0x57833f),_0x524ab5[_0x2eeca4(0x1ad)](0x190)[_0x2eeca4(0x195)]({'success':![],'error':_0x57833f['message']||'Failed\x20to\x20fetch\x20pre-payment'});}}async[a16_0x27f432(0x1a4)](_0x36602b,_0xd1d4f){const _0x1330aa=a16_0x27f432;try{const {code:_0xb9c7a4}=_0x36602b[_0x1330aa(0x1b2)],{customerEmail:_0x198dd4,customerName:_0xf6378d,customerIp:_0x5a98cb,customerUa:_0x93fa37,customerCountry:_0x974812,requestId:_0x3793a4,emailValidation:_0x35680c}=_0x36602b[_0x1330aa(0x199)];if(!_0x198dd4||!_0xf6378d)return _0xd1d4f[_0x1330aa(0x1ad)](0x190)[_0x1330aa(0x195)]({'success':![],'error':_0x1330aa(0x18d)});const _0x260629=await prePaymentService_1['prePaymentService']['confirmPrePayment'](_0xb9c7a4,{'customerEmail':_0x198dd4,'customerName':_0xf6378d,'customerIp':_0x5a98cb,'customerUa':_0x93fa37,'customerCountry':_0x974812}),_0x127037=await database_1[_0x1330aa(0x1a0)]['shop'][_0x1330aa(0x1b5)]({'where':{'id':_0x260629[_0x1330aa(0x190)]},'select':{'publicKey':!![]}});if(!_0x127037)throw new Error(_0x1330aa(0x187));const _0x10f377=this[_0x1330aa(0x17e)][_0x1330aa(0x193)](_0x260629[_0x1330aa(0x192)]),_0x19c9fa=await this[_0x1330aa(0x17e)]['createPublicPayment']({'public_key':_0x127037[_0x1330aa(0x18c)],'gateway':String(_0x10f377),'order_id':_0x260629[_0x1330aa(0x1a1)]||undefined,'amount':Number(_0x260629['amount']),'currency':_0x260629[_0x1330aa(0x1a9)],'source_currency':_0x260629[_0x1330aa(0x1a2)]||undefined,'network':_0x260629[_0x1330aa(0x17d)]||undefined,'success_url':_0x260629[_0x1330aa(0x191)]||undefined,'fail_url':_0x260629[_0x1330aa(0x194)]||undefined,'pending_url':_0x260629[_0x1330aa(0x186)]||undefined,'customer_email':_0x260629[_0x1330aa(0x17f)],'customer_name':_0x260629['customerName'],'customer_country':_0x974812,'customer_ip':_0x5a98cb,'customer_ua':_0x93fa37,'country':_0x260629['country']||undefined,'language':_0x260629[_0x1330aa(0x197)]||undefined});await database_1['default'][_0x1330aa(0x1b8)][_0x1330aa(0x1b4)]({'where':{'id':_0x260629[_0x1330aa(0x196)]},'data':{'paymentId':_0x19c9fa['id']}});_0x35680c&&await database_1[_0x1330aa(0x1a0)][_0x1330aa(0x18b)][_0x1330aa(0x1b4)]({'where':{'id':_0x19c9fa['id']},'data':{'emailDeliverabilityStatus':_0x35680c[_0x1330aa(0x198)],'emailIsDisposable':_0x35680c[_0x1330aa(0x188)],'emailRiskLevel':_0x35680c[_0x1330aa(0x183)]}});if(_0x3793a4)try{await this['paymentService'][_0x1330aa(0x19a)](_0x19c9fa['id'],_0x3793a4),console['log'](_0x1330aa(0x17c)+_0x19c9fa['id']);}catch(_0x4bd523){console[_0x1330aa(0x182)](_0x1330aa(0x18a),_0x4bd523);}const _0x736e8e=['rapyd',_0x1330aa(0x185),_0x1330aa(0x17a),'noda',_0x1330aa(0x1a8),_0x1330aa(0x1ab)],_0x430e1a=_0x736e8e[_0x1330aa(0x1ae)](_0x260629[_0x1330aa(0x192)])&&_0x19c9fa[_0x1330aa(0x18f)],_0x144dac=process.env.FRONTEND_URL||'https://app.trapay.uk',_0x3be6cb=_0x430e1a?_0x19c9fa[_0x1330aa(0x18f)]:_0x144dac+'/payment/'+_0x19c9fa['id'];_0xd1d4f['json']({'success':!![],'result':{'paymentId':_0x19c9fa['id'],'paymentUrl':_0x3be6cb}});}catch(_0x4e0b79){console[_0x1330aa(0x182)](_0x1330aa(0x1ac),_0x4e0b79),_0xd1d4f['status'](0x190)[_0x1330aa(0x195)]({'success':![],'error':_0x4e0b79['message']||_0x1330aa(0x19c)});}}}exports[a16_0x27f432(0x181)]=PrePaymentController,exports['prePaymentController']=new PrePaymentController();