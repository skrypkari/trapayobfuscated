'use strict';const a16_0x11d300=a16_0x40ef;(function(_0xabb5a3,_0x54eb12){const _0x40ed08=a16_0x40ef,_0x15ba03=_0xabb5a3();while(!![]){try{const _0x5848eb=-parseInt(_0x40ed08(0x1df))/0x1*(parseInt(_0x40ed08(0x1c7))/0x2)+-parseInt(_0x40ed08(0x200))/0x3*(-parseInt(_0x40ed08(0x1e7))/0x4)+parseInt(_0x40ed08(0x1ed))/0x5+parseInt(_0x40ed08(0x1d3))/0x6*(parseInt(_0x40ed08(0x201))/0x7)+-parseInt(_0x40ed08(0x1fb))/0x8*(parseInt(_0x40ed08(0x1cc))/0x9)+-parseInt(_0x40ed08(0x1c9))/0xa*(parseInt(_0x40ed08(0x1c6))/0xb)+-parseInt(_0x40ed08(0x1fe))/0xc*(-parseInt(_0x40ed08(0x1dc))/0xd);if(_0x5848eb===_0x54eb12)break;else _0x15ba03['push'](_0x15ba03['shift']());}catch(_0x2f1cfe){_0x15ba03['push'](_0x15ba03['shift']());}}}(a16_0x4b68,0x56b6e));function a16_0x4b68(){const _0x5a4c29=['noda','sourceCurrency','1287132dFHdTS','error','69VwxGWM','21KtUKPK','prePaymentController','getPrePayment','customerName','payment','Failed\x20to\x20fetch\x20pre-payment','publicKey','getPrePaymentByCode','confirmPrePayment','successUrl','amount','2266xAxZjY','2ULuOjB','prePaymentService','10570nWoZbx','default','Get\x20pre-payment\x20error:','9CYFORD','PaymentService','json','https://app.trapay.uk','payment_url','Failed\x20to\x20save\x20fingerprint:','__esModule','444342StSZlt','isDisposable','PrePaymentController','shop','customerEmail','instaxchange','Customer\x20email\x20and\x20name\x20are\x20required','prePayment','prePaymentId','91rfmINc','../config/database','failUrl','180123mbqlGI','orderId','gateway','currency','defineProperty','cointopay','Failed\x20to\x20confirm\x20pre-payment','status','27388ZAMPWP','cointopay2','riskLevel','update','../services/paymentService','Confirm\x20pre-payment\x20error:','240465qeBTSX','deliverabilityStatus','country','params','language','createPublicPayment','Shop\x20not\x20found','../services/prePaymentService','__importDefault','rapyd','paymentService','message','includes','pendingUrl','3404200LUKBlr'];a16_0x4b68=function(){return _0x5a4c29;};return a16_0x4b68();}function a16_0x40ef(_0x2cba24,_0x35081e){_0x2cba24=_0x2cba24-0x1c2;const _0x4b6836=a16_0x4b68();let _0x40efaa=_0x4b6836[_0x2cba24];return _0x40efaa;}var __importDefault=this&&this[a16_0x11d300(0x1f5)]||function(_0x4be855){return _0x4be855&&_0x4be855['__esModule']?_0x4be855:{'default':_0x4be855};};Object[a16_0x11d300(0x1e3)](exports,a16_0x11d300(0x1d2),{'value':!![]}),exports[a16_0x11d300(0x202)]=exports[a16_0x11d300(0x1d5)]=void 0x0;const database_1=__importDefault(require(a16_0x11d300(0x1dd))),prePaymentService_1=require(a16_0x11d300(0x1f4)),paymentService_1=require(a16_0x11d300(0x1eb));class PrePaymentController{constructor(){const _0x55e3e2=a16_0x11d300;this[_0x55e3e2(0x1f7)]=new paymentService_1[(_0x55e3e2(0x1cd))]();}async[a16_0x11d300(0x203)](_0x2182e3,_0x1fd1e8){const _0x4e1af5=a16_0x11d300;try{const {code:_0x2906bf}=_0x2182e3[_0x4e1af5(0x1f0)],_0xb56198=await prePaymentService_1[_0x4e1af5(0x1c8)][_0x4e1af5(0x1c2)](_0x2906bf);_0x1fd1e8['json']({'success':!![],'result':_0xb56198});}catch(_0x7f437f){console['error'](_0x4e1af5(0x1cb),_0x7f437f),_0x1fd1e8[_0x4e1af5(0x1e6)](0x190)[_0x4e1af5(0x1ce)]({'success':![],'error':_0x7f437f[_0x4e1af5(0x1f8)]||_0x4e1af5(0x206)});}}async['confirmPrePayment'](_0xbd69e6,_0x17695c){const _0x5591d3=a16_0x11d300;try{const {code:_0x5c190b}=_0xbd69e6[_0x5591d3(0x1f0)],{customerEmail:_0x14d30b,customerName:_0x115da8,customerIp:_0x268949,customerUa:_0xe835af,customerCountry:_0x294e8d,requestId:_0x4d052e,emailValidation:_0x1eb1ac}=_0xbd69e6['body'];if(!_0x14d30b||!_0x115da8)return _0x17695c[_0x5591d3(0x1e6)](0x190)[_0x5591d3(0x1ce)]({'success':![],'error':_0x5591d3(0x1d9)});const _0xfe16c2=await prePaymentService_1[_0x5591d3(0x1c8)][_0x5591d3(0x1c3)](_0x5c190b,{'customerEmail':_0x14d30b,'customerName':_0x115da8,'customerIp':_0x268949,'customerUa':_0xe835af,'customerCountry':_0x294e8d}),_0x4b75e7=await database_1[_0x5591d3(0x1ca)][_0x5591d3(0x1d6)]['findUnique']({'where':{'id':_0xfe16c2['shopId']},'select':{'publicKey':!![]}});if(!_0x4b75e7)throw new Error(_0x5591d3(0x1f3));const _0x1be7e0=this[_0x5591d3(0x1f7)]['getGatewayIdFromName'](_0xfe16c2[_0x5591d3(0x1e1)]),_0x412d21=await this[_0x5591d3(0x1f7)][_0x5591d3(0x1f2)]({'public_key':_0x4b75e7[_0x5591d3(0x207)],'gateway':String(_0x1be7e0),'order_id':_0xfe16c2[_0x5591d3(0x1e0)]||undefined,'amount':Number(_0xfe16c2[_0x5591d3(0x1c5)]),'currency':_0xfe16c2[_0x5591d3(0x1e2)],'source_currency':_0xfe16c2[_0x5591d3(0x1fd)]||undefined,'network':_0xfe16c2['network']||undefined,'success_url':_0xfe16c2[_0x5591d3(0x1c4)]||undefined,'fail_url':_0xfe16c2[_0x5591d3(0x1de)]||undefined,'pending_url':_0xfe16c2[_0x5591d3(0x1fa)]||undefined,'customer_email':_0xfe16c2[_0x5591d3(0x1d7)],'customer_name':_0xfe16c2[_0x5591d3(0x204)],'customer_country':_0x294e8d,'customer_ip':_0x268949,'customer_ua':_0xe835af,'country':_0xfe16c2[_0x5591d3(0x1ef)]||undefined,'language':_0xfe16c2[_0x5591d3(0x1f1)]||undefined});await database_1[_0x5591d3(0x1ca)][_0x5591d3(0x1da)][_0x5591d3(0x1ea)]({'where':{'id':_0xfe16c2[_0x5591d3(0x1db)]},'data':{'paymentId':_0x412d21['id']}});_0x1eb1ac&&await database_1[_0x5591d3(0x1ca)][_0x5591d3(0x205)][_0x5591d3(0x1ea)]({'where':{'id':_0x412d21['id']},'data':{'emailDeliverabilityStatus':_0x1eb1ac[_0x5591d3(0x1ee)],'emailIsDisposable':_0x1eb1ac[_0x5591d3(0x1d4)],'emailRiskLevel':_0x1eb1ac[_0x5591d3(0x1e9)]}});if(_0x4d052e)try{await this[_0x5591d3(0x1f7)]['getPaymentFingerprint'](_0x412d21['id'],_0x4d052e),console['log']('âœ…\x20Fingerprint\x20saved\x20for\x20payment\x20'+_0x412d21['id']);}catch(_0xe453){console[_0x5591d3(0x1ff)](_0x5591d3(0x1d1),_0xe453);}const _0x220691=[_0x5591d3(0x1f6),'maxpara',_0x5591d3(0x1d8),_0x5591d3(0x1fc),_0x5591d3(0x1e4),_0x5591d3(0x1e8)],_0x1c628f=_0x220691[_0x5591d3(0x1f9)](_0xfe16c2[_0x5591d3(0x1e1)])&&_0x412d21[_0x5591d3(0x1d0)],_0x762f70=process.env.FRONTEND_URL||_0x5591d3(0x1cf),_0x5079f8=_0x1c628f?_0x412d21[_0x5591d3(0x1d0)]:_0x762f70+'/payment/'+_0x412d21['id'];_0x17695c[_0x5591d3(0x1ce)]({'success':!![],'result':{'paymentId':_0x412d21['id'],'paymentUrl':_0x5079f8}});}catch(_0x5bcbf7){console[_0x5591d3(0x1ff)](_0x5591d3(0x1ec),_0x5bcbf7),_0x17695c[_0x5591d3(0x1e6)](0x190)[_0x5591d3(0x1ce)]({'success':![],'error':_0x5bcbf7[_0x5591d3(0x1f8)]||_0x5591d3(0x1e5)});}}}exports['PrePaymentController']=PrePaymentController,exports[a16_0x11d300(0x202)]=new PrePaymentController();