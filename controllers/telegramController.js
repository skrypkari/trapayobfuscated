'use strict';const a12_0x196eec=a12_0x1f86;(function(_0x4d4ee6,_0x2d9b00){const _0x405369=a12_0x1f86,_0x1cc655=_0x4d4ee6();while(!![]){try{const _0x1bc5ec=parseInt(_0x405369(0x1c9))/0x1+-parseInt(_0x405369(0x1bd))/0x2+parseInt(_0x405369(0x1e2))/0x3+-parseInt(_0x405369(0x1ea))/0x4*(-parseInt(_0x405369(0x1f4))/0x5)+-parseInt(_0x405369(0x1d4))/0x6*(parseInt(_0x405369(0x1d0))/0x7)+parseInt(_0x405369(0x1da))/0x8+-parseInt(_0x405369(0x1be))/0x9*(-parseInt(_0x405369(0x1eb))/0xa);if(_0x1bc5ec===_0x2d9b00)break;else _0x1cc655['push'](_0x1cc655['shift']());}catch(_0x3604f7){_0x1cc655['push'](_0x1cc655['shift']());}}}(a12_0x3518,0x77ffa));function a12_0x1f86(_0x319175,_0x4f350d){const _0x35181c=a12_0x3518();return a12_0x1f86=function(_0x1f868e,_0xa08564){_0x1f868e=_0x1f868e-0x1b6;let _0x37a282=_0x35181c[_0x1f868e];return _0x37a282;},a12_0x1f86(_0x319175,_0x4f350d);}var __importDefault=this&&this['__importDefault']||function(_0x35f5cd){return _0x35f5cd&&_0x35f5cd['__esModule']?_0x35f5cd:{'default':_0x35f5cd};};function a12_0x3518(){const _0x751009=['Shop\x20not\x20found','title','sendBroadcast','plisio','Shop\x20ID\x20is\x20required','Test\x20Notification','Markdown','length','productName','769042LIfOnG','body','gateway','payout','count','Test\x20','payment','140OZTGSL','\x20notification\x20sent\x20successfully','updatedAt','isActive','251214SEOlyO','findMany','json','completed','desc','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','132624bKCEox','bank_transfer','currency','params','paid','telegramUser','telegramBotService','findUnique','1701636SAonMz','custom','USD','getBotStatus','username','TelegramController','telegramId','amount','8420RzGXKy','11030CyCQvF','firstName','test_payout_123','shop','sendShopNotification','map','sendTestNotification','filter','sendPayoutNotification','550BipXyt','sendCustomNotification','groupBy','Broadcast\x20message\x20sent\x20successfully','User\x20disconnected\x20successfully','update','Telegram\x20user\x20not\x20found','default','query','createdAt','shopId','status','isVerified','getTelegramUsers','getBotInfo','all','sendPaymentNotification','details','1294106yikqnE','3195FwBZEe','../services/telegramBotService'];a12_0x3518=function(){return _0x751009;};return a12_0x3518();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a12_0x196eec(0x1e7)]=void 0x0;const telegramBotService_1=require(a12_0x196eec(0x1bf)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x136358=a12_0x196eec;this[_0x136358(0x1e5)]=async(_0x537b25,_0x1a5cbe,_0x3c3620)=>{const _0x57d58f=_0x136358;try{const _0x31b60d=telegramBotService_1['telegramBotService'][_0x57d58f(0x1b9)](),_0xb01c36=await database_1[_0x57d58f(0x1fb)][_0x57d58f(0x1df)][_0x57d58f(0x1cd)](),_0x478e97=await database_1['default'][_0x57d58f(0x1df)][_0x57d58f(0x1cd)]({'where':{'isVerified':!![]}}),_0x315794=await database_1['default']['telegramUser'][_0x57d58f(0x1f6)]({'by':[_0x57d58f(0x1fe)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1a5cbe[_0x57d58f(0x1d6)]({'success':!![],'result':{'bot':{'isActive':_0x31b60d[_0x57d58f(0x1d3)],'username':_0x31b60d[_0x57d58f(0x1e6)]},'statistics':{'totalUsers':_0xb01c36,'verifiedUsers':_0x478e97,'unverifiedUsers':_0xb01c36-_0x478e97,'connectedShops':_0x315794[_0x57d58f(0x1c7)]}}});}catch(_0x1664a4){_0x3c3620(_0x1664a4);}},this[_0x136358(0x1b8)]=async(_0x2ceb1c,_0x5e278a,_0x1a496e)=>{const _0x1ce1f7=_0x136358;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1270cb}=_0x2ceb1c[_0x1ce1f7(0x1fc)],_0x443859=(Number(page)-0x1)*Number(limit),_0x2cb3da={};_0x1270cb!==undefined&&(_0x2cb3da[_0x1ce1f7(0x1b7)]=_0x1270cb==='true');const [_0x20f6b7,_0x967a95]=await Promise[_0x1ce1f7(0x1ba)]([database_1[_0x1ce1f7(0x1fb)][_0x1ce1f7(0x1df)][_0x1ce1f7(0x1d5)]({'where':_0x2cb3da,'skip':_0x443859,'take':Number(limit),'orderBy':{'createdAt':_0x1ce1f7(0x1d8)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1ce1f7(0x1fb)][_0x1ce1f7(0x1df)][_0x1ce1f7(0x1cd)]({'where':_0x2cb3da})]);_0x5e278a[_0x1ce1f7(0x1d6)]({'success':!![],'users':_0x20f6b7[_0x1ce1f7(0x1f0)](_0x5c1082=>({'id':_0x5c1082['id'],'telegramId':_0x5c1082[_0x1ce1f7(0x1e8)],'username':_0x5c1082[_0x1ce1f7(0x1e6)],'firstName':_0x5c1082[_0x1ce1f7(0x1ec)],'lastName':_0x5c1082['lastName'],'isVerified':_0x5c1082['isVerified'],'shop':_0x5c1082[_0x1ce1f7(0x1ee)],'createdAt':_0x5c1082[_0x1ce1f7(0x1fd)],'updatedAt':_0x5c1082[_0x1ce1f7(0x1d2)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x967a95,'totalPages':Math['ceil'](_0x967a95/Number(limit))}});}catch(_0x2c2ee7){_0x1a496e(_0x2c2ee7);}},this[_0x136358(0x1c2)]=async(_0x4ae393,_0x5d22c1,_0x2db572)=>{const _0x1f7536=_0x136358;try{const {message:_0x2d26e3,shopId:_0x49adf1}=_0x4ae393[_0x1f7536(0x1ca)];if(!_0x2d26e3)return _0x5d22c1[_0x1f7536(0x1b6)](0x190)[_0x1f7536(0x1d6)]({'success':![],'message':'Message\x20is\x20required'});if(_0x49adf1)await telegramBotService_1['telegramBotService'][_0x1f7536(0x1ef)](_0x49adf1,_0x2d26e3,{'parse_mode':_0x1f7536(0x1c6)});else{const _0x302275=await database_1[_0x1f7536(0x1fb)][_0x1f7536(0x1df)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x17d89a=[...new Set(_0x302275[_0x1f7536(0x1f0)](_0x22793b=>_0x22793b[_0x1f7536(0x1fe)])[_0x1f7536(0x1f2)](Boolean))];for(const _0x54adf8 of _0x17d89a){_0x54adf8&&await telegramBotService_1[_0x1f7536(0x1e0)][_0x1f7536(0x1ef)](_0x54adf8,_0x2d26e3,{'parse_mode':_0x1f7536(0x1c6)});}}_0x5d22c1['json']({'success':!![],'message':_0x1f7536(0x1f7)});}catch(_0x3309f1){_0x2db572(_0x3309f1);}},this['disconnectUser']=async(_0x203905,_0x2c3a08,_0x32b916)=>{const _0x93d6fd=_0x136358;try{const {telegramId:_0x2d8d20}=_0x203905[_0x93d6fd(0x1dd)],_0x1e303e=await database_1[_0x93d6fd(0x1fb)][_0x93d6fd(0x1df)][_0x93d6fd(0x1e1)]({'where':{'telegramId':_0x2d8d20},'include':{'shop':!![]}});if(!_0x1e303e)return _0x2c3a08[_0x93d6fd(0x1b6)](0x194)[_0x93d6fd(0x1d6)]({'success':![],'message':_0x93d6fd(0x1fa)});await database_1[_0x93d6fd(0x1fb)][_0x93d6fd(0x1df)][_0x93d6fd(0x1f9)]({'where':{'telegramId':_0x2d8d20},'data':{'shopId':null,'isVerified':![]}}),_0x2c3a08[_0x93d6fd(0x1d6)]({'success':!![],'message':_0x93d6fd(0x1f8)});}catch(_0x38a737){_0x32b916(_0x38a737);}},this[_0x136358(0x1f1)]=async(_0x65fe12,_0x350b9f,_0x4ef541)=>{const _0x38a322=_0x136358;try{const {shopId:_0x1773f4,type:type=_0x38a322(0x1cf),testData:_0x189975}=_0x65fe12['body'];if(!_0x1773f4)return _0x350b9f[_0x38a322(0x1b6)](0x190)[_0x38a322(0x1d6)]({'success':![],'message':_0x38a322(0x1c4)});const _0x3872bd=await database_1['default'][_0x38a322(0x1ee)][_0x38a322(0x1e1)]({'where':{'id':_0x1773f4},'select':{'id':!![],'name':!![]}});if(!_0x3872bd)return _0x350b9f[_0x38a322(0x1b6)](0x194)['json']({'success':![],'message':_0x38a322(0x1c0)});switch(type){case _0x38a322(0x1cf):const _0x275cff={'id':'test_payment_123','amount':_0x189975?.[_0x38a322(0x1e9)]||0x64,'currency':_0x189975?.[_0x38a322(0x1dc)]||_0x38a322(0x1e4),'productName':_0x189975?.[_0x38a322(0x1c8)]||'Test\x20Product','gateway':_0x189975?.[_0x38a322(0x1cb)]||_0x38a322(0x1c3),'createdAt':new Date(),..._0x189975};await telegramBotService_1[_0x38a322(0x1e0)][_0x38a322(0x1bb)](_0x1773f4,_0x275cff,_0x38a322(0x1de));break;case _0x38a322(0x1cc):const _0x519c60={'id':_0x38a322(0x1ed),'amount':_0x189975?.['amount']||0x1f4,'method':_0x189975?.['method']||_0x38a322(0x1db),'createdAt':new Date(),..._0x189975};await telegramBotService_1[_0x38a322(0x1e0)][_0x38a322(0x1f3)](_0x1773f4,_0x519c60,_0x38a322(0x1d7));break;case _0x38a322(0x1e3):await telegramBotService_1['telegramBotService'][_0x38a322(0x1f5)](_0x1773f4,_0x189975?.[_0x38a322(0x1c1)]||_0x38a322(0x1c5),_0x189975?.[_0x38a322(0x1bc)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x350b9f[_0x38a322(0x1b6)](0x190)['json']({'success':![],'message':_0x38a322(0x1d9)});}_0x350b9f[_0x38a322(0x1d6)]({'success':!![],'message':_0x38a322(0x1ce)+type+_0x38a322(0x1d1)});}catch(_0x583c0f){_0x4ef541(_0x583c0f);}};}}exports[a12_0x196eec(0x1e7)]=TelegramController;