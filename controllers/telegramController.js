'use strict';const a12_0x5eb809=a12_0x1141;(function(_0x582ca9,_0x377410){const _0x1d121a=a12_0x1141,_0x5e4e05=_0x582ca9();while(!![]){try{const _0x49a963=-parseInt(_0x1d121a(0xbe))/0x1+-parseInt(_0x1d121a(0xc2))/0x2+parseInt(_0x1d121a(0x9e))/0x3*(parseInt(_0x1d121a(0xa9))/0x4)+parseInt(_0x1d121a(0x9c))/0x5+parseInt(_0x1d121a(0xbc))/0x6*(-parseInt(_0x1d121a(0xb5))/0x7)+-parseInt(_0x1d121a(0xca))/0x8*(-parseInt(_0x1d121a(0xc5))/0x9)+parseInt(_0x1d121a(0xcc))/0xa;if(_0x49a963===_0x377410)break;else _0x5e4e05['push'](_0x5e4e05['shift']());}catch(_0x1cadc5){_0x5e4e05['push'](_0x5e4e05['shift']());}}}(a12_0x4ac3,0xd8960));function a12_0x4ac3(){const _0xdc9a0c=['1833672qUEJen','map','sendShopNotification','findUnique','sendTestNotification','sendBroadcast','disconnectUser','TelegramController','telegramBotService','default','isVerified','telegramUser','161zTjVkJ','length','username','Broadcast\x20message\x20sent\x20successfully','all','test_payment_123','isActive','5802gHwQGH','sendCustomNotification','1077983jaHzEZ','../config/database','../services/telegramBotService','paid','2627832YpvyGj','payout','test_payout_123','10179LDsjCH','true','User\x20disconnected\x20successfully','USD','query','3608WCqcMt','productName','9869070bdsraG','json','status','amount','sendPaymentNotification','\x20notification\x20sent\x20successfully','findMany','count','currency','filter','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Telegram\x20user\x20not\x20found','updatedAt','Markdown','firstName','defineProperty','Test\x20','title','plisio','4437260rOpyNL','ceil','6BJkgmt','desc','createdAt','payment','update','shop','lastName','method','getTelegramUsers','getBotInfo','Shop\x20not\x20found'];a12_0x4ac3=function(){return _0xdc9a0c;};return a12_0x4ac3();}var __importDefault=this&&this['__importDefault']||function(_0x9dc62f){return _0x9dc62f&&_0x9dc62f['__esModule']?_0x9dc62f:{'default':_0x9dc62f};};Object[a12_0x5eb809(0x98)](exports,'__esModule',{'value':!![]}),exports[a12_0x5eb809(0xb0)]=void 0x0;function a12_0x1141(_0x1535a2,_0x23dba6){const _0x4ac3e2=a12_0x4ac3();return a12_0x1141=function(_0x1141ae,_0x45b6ff){_0x1141ae=_0x1141ae-0x90;let _0x18157c=_0x4ac3e2[_0x1141ae];return _0x18157c;},a12_0x1141(_0x1535a2,_0x23dba6);}const telegramBotService_1=require(a12_0x5eb809(0xc0)),database_1=__importDefault(require(a12_0x5eb809(0xbf)));class TelegramController{constructor(){const _0x497254=a12_0x5eb809;this['getBotStatus']=async(_0x4db86c,_0x90f6eb,_0x3b0bd1)=>{const _0x3dd790=a12_0x1141;try{const _0x152811=telegramBotService_1[_0x3dd790(0xb1)][_0x3dd790(0xa7)](),_0x1c8e5b=await database_1[_0x3dd790(0xb2)][_0x3dd790(0xb4)][_0x3dd790(0x90)](),_0x9c47c3=await database_1[_0x3dd790(0xb2)][_0x3dd790(0xb4)][_0x3dd790(0x90)]({'where':{'isVerified':!![]}}),_0x1fc9a2=await database_1['default'][_0x3dd790(0xb4)]['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x90f6eb[_0x3dd790(0xcd)]({'success':!![],'result':{'bot':{'isActive':_0x152811[_0x3dd790(0xbb)],'username':_0x152811[_0x3dd790(0xb7)]},'statistics':{'totalUsers':_0x1c8e5b,'verifiedUsers':_0x9c47c3,'unverifiedUsers':_0x1c8e5b-_0x9c47c3,'connectedShops':_0x1fc9a2[_0x3dd790(0xb6)]}}});}catch(_0x32b46a){_0x3b0bd1(_0x32b46a);}},this[_0x497254(0xa6)]=async(_0x2fbb7d,_0x57dee3,_0x2ab833)=>{const _0x198faf=_0x497254;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2c77d4}=_0x2fbb7d[_0x198faf(0xc9)],_0x155b0f=(Number(page)-0x1)*Number(limit),_0x40dae3={};_0x2c77d4!==undefined&&(_0x40dae3['isVerified']=_0x2c77d4===_0x198faf(0xc6));const [_0x225939,_0x5faceb]=await Promise[_0x198faf(0xb9)]([database_1['default']['telegramUser']['findMany']({'where':_0x40dae3,'skip':_0x155b0f,'take':Number(limit),'orderBy':{'createdAt':_0x198faf(0x9f)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x198faf(0xb2)][_0x198faf(0xb4)][_0x198faf(0x90)]({'where':_0x40dae3})]);_0x57dee3[_0x198faf(0xcd)]({'success':!![],'users':_0x225939[_0x198faf(0xaa)](_0xcce2af=>({'id':_0xcce2af['id'],'telegramId':_0xcce2af['telegramId'],'username':_0xcce2af[_0x198faf(0xb7)],'firstName':_0xcce2af[_0x198faf(0x97)],'lastName':_0xcce2af[_0x198faf(0xa4)],'isVerified':_0xcce2af[_0x198faf(0xb3)],'shop':_0xcce2af[_0x198faf(0xa3)],'createdAt':_0xcce2af[_0x198faf(0xa0)],'updatedAt':_0xcce2af[_0x198faf(0x95)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5faceb,'totalPages':Math[_0x198faf(0x9d)](_0x5faceb/Number(limit))}});}catch(_0x596102){_0x2ab833(_0x596102);}},this[_0x497254(0xae)]=async(_0x55b203,_0x400ccd,_0x3ba70d)=>{const _0x275872=_0x497254;try{const {message:_0x2b256e,shopId:_0x1104f6}=_0x55b203['body'];if(!_0x2b256e)return _0x400ccd[_0x275872(0xce)](0x190)['json']({'success':![],'message':'Message\x20is\x20required'});if(_0x1104f6)await telegramBotService_1[_0x275872(0xb1)][_0x275872(0xab)](_0x1104f6,_0x2b256e,{'parse_mode':'Markdown'});else{const _0xf24d33=await database_1[_0x275872(0xb2)][_0x275872(0xb4)][_0x275872(0xd2)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4751a1=[...new Set(_0xf24d33[_0x275872(0xaa)](_0x5f32f4=>_0x5f32f4['shopId'])[_0x275872(0x92)](Boolean))];for(const _0x3703c4 of _0x4751a1){_0x3703c4&&await telegramBotService_1['telegramBotService'][_0x275872(0xab)](_0x3703c4,_0x2b256e,{'parse_mode':_0x275872(0x96)});}}_0x400ccd[_0x275872(0xcd)]({'success':!![],'message':_0x275872(0xb8)});}catch(_0x5c3892){_0x3ba70d(_0x5c3892);}},this[_0x497254(0xaf)]=async(_0x463c19,_0x271387,_0x388e56)=>{const _0x563d22=_0x497254;try{const {telegramId:_0x1665e5}=_0x463c19['params'],_0x280f0b=await database_1['default']['telegramUser'][_0x563d22(0xac)]({'where':{'telegramId':_0x1665e5},'include':{'shop':!![]}});if(!_0x280f0b)return _0x271387[_0x563d22(0xce)](0x194)[_0x563d22(0xcd)]({'success':![],'message':_0x563d22(0x94)});await database_1[_0x563d22(0xb2)][_0x563d22(0xb4)][_0x563d22(0xa2)]({'where':{'telegramId':_0x1665e5},'data':{'shopId':null,'isVerified':![]}}),_0x271387[_0x563d22(0xcd)]({'success':!![],'message':_0x563d22(0xc7)});}catch(_0x586272){_0x388e56(_0x586272);}},this[_0x497254(0xad)]=async(_0x12306b,_0x2cf536,_0x2d60d4)=>{const _0x117aff=_0x497254;try{const {shopId:_0x2a9dc6,type:type=_0x117aff(0xa1),testData:_0x47f1ef}=_0x12306b['body'];if(!_0x2a9dc6)return _0x2cf536[_0x117aff(0xce)](0x190)[_0x117aff(0xcd)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x44b601=await database_1[_0x117aff(0xb2)]['shop'][_0x117aff(0xac)]({'where':{'id':_0x2a9dc6},'select':{'id':!![],'name':!![]}});if(!_0x44b601)return _0x2cf536[_0x117aff(0xce)](0x194)[_0x117aff(0xcd)]({'success':![],'message':_0x117aff(0xa8)});switch(type){case'payment':const _0x5d64d1={'id':_0x117aff(0xba),'amount':_0x47f1ef?.[_0x117aff(0xcf)]||0x64,'currency':_0x47f1ef?.[_0x117aff(0x91)]||_0x117aff(0xc8),'productName':_0x47f1ef?.[_0x117aff(0xcb)]||'Test\x20Product','gateway':_0x47f1ef?.['gateway']||_0x117aff(0x9b),'createdAt':new Date(),..._0x47f1ef};await telegramBotService_1[_0x117aff(0xb1)][_0x117aff(0xd0)](_0x2a9dc6,_0x5d64d1,_0x117aff(0xc1));break;case _0x117aff(0xc3):const _0xdf0c84={'id':_0x117aff(0xc4),'amount':_0x47f1ef?.[_0x117aff(0xcf)]||0x1f4,'method':_0x47f1ef?.[_0x117aff(0xa5)]||'bank_transfer','createdAt':new Date(),..._0x47f1ef};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x2a9dc6,_0xdf0c84,'completed');break;case'custom':await telegramBotService_1[_0x117aff(0xb1)][_0x117aff(0xbd)](_0x2a9dc6,_0x47f1ef?.[_0x117aff(0x9a)]||'Test\x20Notification',_0x47f1ef?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x2cf536[_0x117aff(0xce)](0x190)[_0x117aff(0xcd)]({'success':![],'message':_0x117aff(0x93)});}_0x2cf536[_0x117aff(0xcd)]({'success':!![],'message':_0x117aff(0x99)+type+_0x117aff(0xd1)});}catch(_0x3bc68a){_0x2d60d4(_0x3bc68a);}};}}exports[a12_0x5eb809(0xb0)]=TelegramController;