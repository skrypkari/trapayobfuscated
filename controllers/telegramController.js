'use strict';const a12_0x56f4e0=a12_0x5897;(function(_0x33e014,_0xcb41f8){const _0x44e64a=a12_0x5897,_0xa69537=_0x33e014();while(!![]){try{const _0x3b6970=-parseInt(_0x44e64a(0x1ff))/0x1+-parseInt(_0x44e64a(0x1ef))/0x2+-parseInt(_0x44e64a(0x20b))/0x3*(-parseInt(_0x44e64a(0x1ee))/0x4)+-parseInt(_0x44e64a(0x1f9))/0x5*(-parseInt(_0x44e64a(0x212))/0x6)+parseInt(_0x44e64a(0x1e2))/0x7*(parseInt(_0x44e64a(0x1da))/0x8)+parseInt(_0x44e64a(0x1e1))/0x9+-parseInt(_0x44e64a(0x21d))/0xa*(parseInt(_0x44e64a(0x21f))/0xb);if(_0x3b6970===_0xcb41f8)break;else _0xa69537['push'](_0xa69537['shift']());}catch(_0x30fcb4){_0xa69537['push'](_0xa69537['shift']());}}}(a12_0x3cf3,0x96587));function a12_0x3cf3(){const _0x20f925=['Shop\x20not\x20found','telegramUser','query','3MaIvfE','desc','This\x20is\x20a\x20test\x20notification','bank_transfer','Broadcast\x20message\x20sent\x20successfully','currency','sendBroadcast','45642bTrIvG','details','plisio','\x20notification\x20sent\x20successfully','username','json','completed','test_payment_123','filter','updatedAt','true','9097490UoppSQ','createdAt','11mUXiPu','findUnique','sendPayoutNotification','shop','lastName','Markdown','9525136VgAWeH','telegramBotService','length','title','default','__importDefault','paid','8214705gTMdIi','7LSBjRb','all','sendCustomNotification','custom','getBotInfo','shopId','payout','map','isVerified','Shop\x20ID\x20is\x20required','update','count','2957636MyCWlq','2130122JnczTO','getTelegramUsers','params','payment','gateway','TelegramController','status','Test\x20Product','defineProperty','Test\x20Notification','85ORknWU','ceil','isActive','firstName','../services/telegramBotService','Telegram\x20user\x20not\x20found','381490ndqkFi','../config/database','Message\x20is\x20required','body','test_payout_123','sendPaymentNotification','sendShopNotification','amount','User\x20disconnected\x20successfully'];a12_0x3cf3=function(){return _0x20f925;};return a12_0x3cf3();}var __importDefault=this&&this[a12_0x56f4e0(0x1df)]||function(_0x4131a6){return _0x4131a6&&_0x4131a6['__esModule']?_0x4131a6:{'default':_0x4131a6};};Object[a12_0x56f4e0(0x1f7)](exports,'__esModule',{'value':!![]}),exports[a12_0x56f4e0(0x1f4)]=void 0x0;const telegramBotService_1=require(a12_0x56f4e0(0x1fd)),database_1=__importDefault(require(a12_0x56f4e0(0x200)));class TelegramController{constructor(){const _0x51fcc6=a12_0x56f4e0;this['getBotStatus']=async(_0x111491,_0x13e591,_0x4c852d)=>{const _0x4d1fcf=a12_0x5897;try{const _0x111f2c=telegramBotService_1['telegramBotService'][_0x4d1fcf(0x1e6)](),_0x3f1eac=await database_1['default'][_0x4d1fcf(0x209)][_0x4d1fcf(0x1ed)](),_0x173836=await database_1[_0x4d1fcf(0x1de)][_0x4d1fcf(0x209)][_0x4d1fcf(0x1ed)]({'where':{'isVerified':!![]}}),_0x5835ee=await database_1[_0x4d1fcf(0x1de)][_0x4d1fcf(0x209)]['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x13e591['json']({'success':!![],'result':{'bot':{'isActive':_0x111f2c[_0x4d1fcf(0x1fb)],'username':_0x111f2c[_0x4d1fcf(0x216)]},'statistics':{'totalUsers':_0x3f1eac,'verifiedUsers':_0x173836,'unverifiedUsers':_0x3f1eac-_0x173836,'connectedShops':_0x5835ee[_0x4d1fcf(0x1dc)]}}});}catch(_0x6e00d6){_0x4c852d(_0x6e00d6);}},this[_0x51fcc6(0x1f0)]=async(_0x11272f,_0x3ca50c,_0x115133)=>{const _0x3347b3=_0x51fcc6;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1a3004}=_0x11272f[_0x3347b3(0x20a)],_0x319823=(Number(page)-0x1)*Number(limit),_0x3db69e={};_0x1a3004!==undefined&&(_0x3db69e['isVerified']=_0x1a3004===_0x3347b3(0x21c));const [_0x4ac123,_0x3df5fb]=await Promise[_0x3347b3(0x1e3)]([database_1[_0x3347b3(0x1de)][_0x3347b3(0x209)]['findMany']({'where':_0x3db69e,'skip':_0x319823,'take':Number(limit),'orderBy':{'createdAt':_0x3347b3(0x20c)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['telegramUser']['count']({'where':_0x3db69e})]);_0x3ca50c[_0x3347b3(0x217)]({'success':!![],'users':_0x4ac123[_0x3347b3(0x1e9)](_0x4fc5dc=>({'id':_0x4fc5dc['id'],'telegramId':_0x4fc5dc['telegramId'],'username':_0x4fc5dc[_0x3347b3(0x216)],'firstName':_0x4fc5dc[_0x3347b3(0x1fc)],'lastName':_0x4fc5dc[_0x3347b3(0x223)],'isVerified':_0x4fc5dc[_0x3347b3(0x1ea)],'shop':_0x4fc5dc[_0x3347b3(0x222)],'createdAt':_0x4fc5dc[_0x3347b3(0x21e)],'updatedAt':_0x4fc5dc[_0x3347b3(0x21b)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3df5fb,'totalPages':Math[_0x3347b3(0x1fa)](_0x3df5fb/Number(limit))}});}catch(_0x2edf91){_0x115133(_0x2edf91);}},this[_0x51fcc6(0x211)]=async(_0x414054,_0x5ca6f2,_0x45e763)=>{const _0x2cc2e2=_0x51fcc6;try{const {message:_0x402b36,shopId:_0x492487}=_0x414054['body'];if(!_0x402b36)return _0x5ca6f2[_0x2cc2e2(0x1f5)](0x190)[_0x2cc2e2(0x217)]({'success':![],'message':_0x2cc2e2(0x201)});if(_0x492487)await telegramBotService_1['telegramBotService'][_0x2cc2e2(0x205)](_0x492487,_0x402b36,{'parse_mode':_0x2cc2e2(0x224)});else{const _0x40473c=await database_1['default']['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xc51c21=[...new Set(_0x40473c[_0x2cc2e2(0x1e9)](_0x30f17d=>_0x30f17d[_0x2cc2e2(0x1e7)])[_0x2cc2e2(0x21a)](Boolean))];for(const _0x59cbfa of _0xc51c21){_0x59cbfa&&await telegramBotService_1[_0x2cc2e2(0x1db)][_0x2cc2e2(0x205)](_0x59cbfa,_0x402b36,{'parse_mode':'Markdown'});}}_0x5ca6f2['json']({'success':!![],'message':_0x2cc2e2(0x20f)});}catch(_0x6db5e5){_0x45e763(_0x6db5e5);}},this['disconnectUser']=async(_0xe328c5,_0xa4463c,_0x1746bc)=>{const _0x3880bd=_0x51fcc6;try{const {telegramId:_0x1a86a7}=_0xe328c5[_0x3880bd(0x1f1)],_0x53768f=await database_1[_0x3880bd(0x1de)]['telegramUser'][_0x3880bd(0x220)]({'where':{'telegramId':_0x1a86a7},'include':{'shop':!![]}});if(!_0x53768f)return _0xa4463c[_0x3880bd(0x1f5)](0x194)[_0x3880bd(0x217)]({'success':![],'message':_0x3880bd(0x1fe)});await database_1[_0x3880bd(0x1de)]['telegramUser'][_0x3880bd(0x1ec)]({'where':{'telegramId':_0x1a86a7},'data':{'shopId':null,'isVerified':![]}}),_0xa4463c[_0x3880bd(0x217)]({'success':!![],'message':_0x3880bd(0x207)});}catch(_0x3be713){_0x1746bc(_0x3be713);}},this['sendTestNotification']=async(_0x2688af,_0x3d6a06,_0x95b0d9)=>{const _0x508110=_0x51fcc6;try{const {shopId:_0x59e55d,type:type=_0x508110(0x1f2),testData:_0xc30d91}=_0x2688af[_0x508110(0x202)];if(!_0x59e55d)return _0x3d6a06[_0x508110(0x1f5)](0x190)[_0x508110(0x217)]({'success':![],'message':_0x508110(0x1eb)});const _0xd9818e=await database_1[_0x508110(0x1de)][_0x508110(0x222)][_0x508110(0x220)]({'where':{'id':_0x59e55d},'select':{'id':!![],'name':!![]}});if(!_0xd9818e)return _0x3d6a06[_0x508110(0x1f5)](0x194)[_0x508110(0x217)]({'success':![],'message':_0x508110(0x208)});switch(type){case _0x508110(0x1f2):const _0x2b0d1f={'id':_0x508110(0x219),'amount':_0xc30d91?.['amount']||0x64,'currency':_0xc30d91?.[_0x508110(0x210)]||'USD','productName':_0xc30d91?.['productName']||_0x508110(0x1f6),'gateway':_0xc30d91?.[_0x508110(0x1f3)]||_0x508110(0x214),'createdAt':new Date(),..._0xc30d91};await telegramBotService_1[_0x508110(0x1db)][_0x508110(0x204)](_0x59e55d,_0x2b0d1f,_0x508110(0x1e0));break;case _0x508110(0x1e8):const _0x2f6e6e={'id':_0x508110(0x203),'amount':_0xc30d91?.[_0x508110(0x206)]||0x1f4,'method':_0xc30d91?.['method']||_0x508110(0x20e),'createdAt':new Date(),..._0xc30d91};await telegramBotService_1[_0x508110(0x1db)][_0x508110(0x221)](_0x59e55d,_0x2f6e6e,_0x508110(0x218));break;case _0x508110(0x1e5):await telegramBotService_1[_0x508110(0x1db)][_0x508110(0x1e4)](_0x59e55d,_0xc30d91?.[_0x508110(0x1dd)]||_0x508110(0x1f8),_0xc30d91?.[_0x508110(0x213)]||{'message':_0x508110(0x20d)});break;default:return _0x3d6a06[_0x508110(0x1f5)](0x190)[_0x508110(0x217)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x3d6a06['json']({'success':!![],'message':'Test\x20'+type+_0x508110(0x215)});}catch(_0x1d1f55){_0x95b0d9(_0x1d1f55);}};}}function a12_0x5897(_0x5847eb,_0x48e30a){const _0x3cf330=a12_0x3cf3();return a12_0x5897=function(_0x5897f0,_0x3bbf43){_0x5897f0=_0x5897f0-0x1da;let _0x2dc65e=_0x3cf330[_0x5897f0];return _0x2dc65e;},a12_0x5897(_0x5847eb,_0x48e30a);}exports[a12_0x56f4e0(0x1f4)]=TelegramController;