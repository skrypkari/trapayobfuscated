'use strict';function a12_0x308a(_0x134b9c,_0x3bb271){const _0x34b2d0=a12_0x34b2();return a12_0x308a=function(_0x308ac6,_0x1a143b){_0x308ac6=_0x308ac6-0x178;let _0x4812c3=_0x34b2d0[_0x308ac6];return _0x4812c3;},a12_0x308a(_0x134b9c,_0x3bb271);}const a12_0x23530a=a12_0x308a;(function(_0x2f9eb7,_0x68c801){const _0x1b3f95=a12_0x308a,_0x19d3d3=_0x2f9eb7();while(!![]){try{const _0x47ad3b=-parseInt(_0x1b3f95(0x1ba))/0x1+parseInt(_0x1b3f95(0x196))/0x2*(-parseInt(_0x1b3f95(0x19f))/0x3)+-parseInt(_0x1b3f95(0x1a8))/0x4*(parseInt(_0x1b3f95(0x192))/0x5)+parseInt(_0x1b3f95(0x178))/0x6+-parseInt(_0x1b3f95(0x19d))/0x7*(-parseInt(_0x1b3f95(0x1a4))/0x8)+parseInt(_0x1b3f95(0x1aa))/0x9*(parseInt(_0x1b3f95(0x184))/0xa)+-parseInt(_0x1b3f95(0x18f))/0xb*(-parseInt(_0x1b3f95(0x181))/0xc);if(_0x47ad3b===_0x68c801)break;else _0x19d3d3['push'](_0x19d3d3['shift']());}catch(_0x1a9cd3){_0x19d3d3['push'](_0x19d3d3['shift']());}}}(a12_0x34b2,0xa44e1));function a12_0x34b2(){const _0x273bae=['isVerified','9rryXXG','getBotStatus','Broadcast\x20message\x20sent\x20successfully','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','username','216FISOPl','shop','createdAt','Message\x20is\x20required','1428psHEgz','update','882zDPrng','User\x20disconnected\x20successfully','../config/database','json','Telegram\x20user\x20not\x20found','body','getBotInfo','map','bank_transfer','plisio','test_payment_123','amount','shopId','USD','telegramBotService','payment','1064878xyYWva','payout','Test\x20Notification','findUnique','completed','paid','getTelegramUsers','all','true','lastName','Test\x20Product','findMany','3867234UWOHat','disconnectUser','Markdown','__esModule','desc','firstName','telegramUser','groupBy','sendShopNotification','24jPLmBE','sendPaymentNotification','productName','128230gTTUqN','title','TelegramController','length','test_payout_123','method','query','\x20notification\x20sent\x20successfully','params','__importDefault','defineProperty','6903226ucxpEQ','../services/telegramBotService','custom','14295kkTkju','telegramId','count','filter','627678eJPlMv','sendPayoutNotification','default','currency','isActive','ceil','status','140966xZYCOZ'];a12_0x34b2=function(){return _0x273bae;};return a12_0x34b2();}var __importDefault=this&&this[a12_0x23530a(0x18d)]||function(_0x1c1e26){return _0x1c1e26&&_0x1c1e26['__esModule']?_0x1c1e26:{'default':_0x1c1e26};};Object[a12_0x23530a(0x18e)](exports,a12_0x23530a(0x17b),{'value':!![]}),exports[a12_0x23530a(0x186)]=void 0x0;const telegramBotService_1=require(a12_0x23530a(0x190)),database_1=__importDefault(require(a12_0x23530a(0x1ac)));class TelegramController{constructor(){const _0x36364f=a12_0x23530a;this[_0x36364f(0x1a0)]=async(_0x30018e,_0x5ade8a,_0x45a1d9)=>{const _0x13a406=_0x36364f;try{const _0xaf804a=telegramBotService_1[_0x13a406(0x1b8)][_0x13a406(0x1b0)](),_0x279c4f=await database_1['default'][_0x13a406(0x17e)]['count'](),_0x1e5d99=await database_1[_0x13a406(0x198)][_0x13a406(0x17e)][_0x13a406(0x194)]({'where':{'isVerified':!![]}}),_0x1c106a=await database_1['default']['telegramUser'][_0x13a406(0x17f)]({'by':[_0x13a406(0x1b6)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5ade8a['json']({'success':!![],'result':{'bot':{'isActive':_0xaf804a[_0x13a406(0x19a)],'username':_0xaf804a['username']},'statistics':{'totalUsers':_0x279c4f,'verifiedUsers':_0x1e5d99,'unverifiedUsers':_0x279c4f-_0x1e5d99,'connectedShops':_0x1c106a[_0x13a406(0x187)]}}});}catch(_0x3fdd70){_0x45a1d9(_0x3fdd70);}},this[_0x36364f(0x1c0)]=async(_0x565bb3,_0x327da4,_0x261ed9)=>{const _0x55a5ff=_0x36364f;try{const {page:page=0x1,limit:limit=0x14,verified:_0xb4cfd7}=_0x565bb3[_0x55a5ff(0x18a)],_0x1a57b7=(Number(page)-0x1)*Number(limit),_0x5fa54e={};_0xb4cfd7!==undefined&&(_0x5fa54e[_0x55a5ff(0x19e)]=_0xb4cfd7===_0x55a5ff(0x1c2));const [_0x358b67,_0x2658c9]=await Promise[_0x55a5ff(0x1c1)]([database_1[_0x55a5ff(0x198)][_0x55a5ff(0x17e)][_0x55a5ff(0x1c5)]({'where':_0x5fa54e,'skip':_0x1a57b7,'take':Number(limit),'orderBy':{'createdAt':_0x55a5ff(0x17c)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x55a5ff(0x198)]['telegramUser'][_0x55a5ff(0x194)]({'where':_0x5fa54e})]);_0x327da4[_0x55a5ff(0x1ad)]({'success':!![],'users':_0x358b67[_0x55a5ff(0x1b1)](_0xc68bf7=>({'id':_0xc68bf7['id'],'telegramId':_0xc68bf7[_0x55a5ff(0x193)],'username':_0xc68bf7[_0x55a5ff(0x1a3)],'firstName':_0xc68bf7[_0x55a5ff(0x17d)],'lastName':_0xc68bf7[_0x55a5ff(0x1c3)],'isVerified':_0xc68bf7[_0x55a5ff(0x19e)],'shop':_0xc68bf7[_0x55a5ff(0x1a5)],'createdAt':_0xc68bf7[_0x55a5ff(0x1a6)],'updatedAt':_0xc68bf7['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2658c9,'totalPages':Math[_0x55a5ff(0x19b)](_0x2658c9/Number(limit))}});}catch(_0x29f3f7){_0x261ed9(_0x29f3f7);}},this['sendBroadcast']=async(_0x1d5ada,_0x48f40e,_0x143187)=>{const _0x40abdb=_0x36364f;try{const {message:_0x12b8f4,shopId:_0x4289fe}=_0x1d5ada[_0x40abdb(0x1af)];if(!_0x12b8f4)return _0x48f40e[_0x40abdb(0x19c)](0x190)[_0x40abdb(0x1ad)]({'success':![],'message':_0x40abdb(0x1a7)});if(_0x4289fe)await telegramBotService_1[_0x40abdb(0x1b8)][_0x40abdb(0x180)](_0x4289fe,_0x12b8f4,{'parse_mode':_0x40abdb(0x17a)});else{const _0x2c2bd6=await database_1['default'][_0x40abdb(0x17e)][_0x40abdb(0x1c5)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x309b50=[...new Set(_0x2c2bd6[_0x40abdb(0x1b1)](_0x5927ed=>_0x5927ed[_0x40abdb(0x1b6)])[_0x40abdb(0x195)](Boolean))];for(const _0x5db452 of _0x309b50){_0x5db452&&await telegramBotService_1[_0x40abdb(0x1b8)][_0x40abdb(0x180)](_0x5db452,_0x12b8f4,{'parse_mode':_0x40abdb(0x17a)});}}_0x48f40e[_0x40abdb(0x1ad)]({'success':!![],'message':_0x40abdb(0x1a1)});}catch(_0x2775ee){_0x143187(_0x2775ee);}},this[_0x36364f(0x179)]=async(_0x330d94,_0xf872d1,_0x5910c0)=>{const _0xa1bb94=_0x36364f;try{const {telegramId:_0x2cd240}=_0x330d94[_0xa1bb94(0x18c)],_0x50f3b2=await database_1[_0xa1bb94(0x198)]['telegramUser'][_0xa1bb94(0x1bd)]({'where':{'telegramId':_0x2cd240},'include':{'shop':!![]}});if(!_0x50f3b2)return _0xf872d1[_0xa1bb94(0x19c)](0x194)['json']({'success':![],'message':_0xa1bb94(0x1ae)});await database_1['default'][_0xa1bb94(0x17e)][_0xa1bb94(0x1a9)]({'where':{'telegramId':_0x2cd240},'data':{'shopId':null,'isVerified':![]}}),_0xf872d1[_0xa1bb94(0x1ad)]({'success':!![],'message':_0xa1bb94(0x1ab)});}catch(_0xafd69a){_0x5910c0(_0xafd69a);}},this['sendTestNotification']=async(_0xa3c778,_0x573815,_0x4a068d)=>{const _0x56fd19=_0x36364f;try{const {shopId:_0x461af9,type:type=_0x56fd19(0x1b9),testData:_0x1dfd0e}=_0xa3c778[_0x56fd19(0x1af)];if(!_0x461af9)return _0x573815['status'](0x190)[_0x56fd19(0x1ad)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0xc6277b=await database_1['default'][_0x56fd19(0x1a5)][_0x56fd19(0x1bd)]({'where':{'id':_0x461af9},'select':{'id':!![],'name':!![]}});if(!_0xc6277b)return _0x573815[_0x56fd19(0x19c)](0x194)[_0x56fd19(0x1ad)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x56fd19(0x1b9):const _0x150a04={'id':_0x56fd19(0x1b4),'amount':_0x1dfd0e?.[_0x56fd19(0x1b5)]||0x64,'currency':_0x1dfd0e?.[_0x56fd19(0x199)]||_0x56fd19(0x1b7),'productName':_0x1dfd0e?.[_0x56fd19(0x183)]||_0x56fd19(0x1c4),'gateway':_0x1dfd0e?.['gateway']||_0x56fd19(0x1b3),'createdAt':new Date(),..._0x1dfd0e};await telegramBotService_1[_0x56fd19(0x1b8)][_0x56fd19(0x182)](_0x461af9,_0x150a04,_0x56fd19(0x1bf));break;case _0x56fd19(0x1bb):const _0x4146af={'id':_0x56fd19(0x188),'amount':_0x1dfd0e?.['amount']||0x1f4,'method':_0x1dfd0e?.[_0x56fd19(0x189)]||_0x56fd19(0x1b2),'createdAt':new Date(),..._0x1dfd0e};await telegramBotService_1[_0x56fd19(0x1b8)][_0x56fd19(0x197)](_0x461af9,_0x4146af,_0x56fd19(0x1be));break;case _0x56fd19(0x191):await telegramBotService_1[_0x56fd19(0x1b8)]['sendCustomNotification'](_0x461af9,_0x1dfd0e?.[_0x56fd19(0x185)]||_0x56fd19(0x1bc),_0x1dfd0e?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x573815[_0x56fd19(0x19c)](0x190)[_0x56fd19(0x1ad)]({'success':![],'message':_0x56fd19(0x1a2)});}_0x573815['json']({'success':!![],'message':'Test\x20'+type+_0x56fd19(0x18b)});}catch(_0x16c218){_0x4a068d(_0x16c218);}};}}exports[a12_0x23530a(0x186)]=TelegramController;