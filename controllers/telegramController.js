'use strict';function a14_0x434e(){const _0x2fade8=['sendPayoutNotification','payout','TRC20','This\x20is\x20a\x20test\x20notification','txid','Message\x20is\x20required','getTelegramUsers','json','getBotStatus','4101zdGvJx','14680431UcQoBE','7458PiwnQT','TelegramController','../services/telegramBotService','plisio','length','body','username','defineProperty','Shop\x20not\x20found','716hCtClY','telegramBotService','__esModule','Test\x20Notification','isVerified','sendTestNotification','all','sendShopNotification','filter','createdAt','7qnYIuW','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','paid','query','Telegram\x20user\x20not\x20found','shopId','groupBy','ceil','sendBroadcast','findUnique','26700IfyXJi','10LxrjDm','isActive','689582YnqOiQ','gateway','672kWKxiP','\x20notification\x20sent\x20successfully','sendPaymentNotification','updatedAt','payment','11375IIGjfF','Test\x20Product','test_payout_123','true','test_payment_123','9491416GJZWQH','USD','title','Test\x20','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','update','User\x20disconnected\x20successfully','getBotInfo','details','custom','findMany','telegramUser','wallet','params','amount','Shop\x20ID\x20is\x20required','count','Тестовый\x20период','4540184xdtZTE','shop','Markdown','lastName','map','default','status','currency'];a14_0x434e=function(){return _0x2fade8;};return a14_0x434e();}const a14_0xaddaee=a14_0x4b0b;(function(_0x3efd86,_0x1b1d01){const _0x39089c=a14_0x4b0b,_0x3e4845=_0x3efd86();while(!![]){try{const _0xece54a=-parseInt(_0x39089c(0x1b1))/0x1+parseInt(_0x39089c(0x19a))/0x2*(parseInt(_0x39089c(0x18f))/0x3)+-parseInt(_0x39089c(0x17e))/0x4+-parseInt(_0x39089c(0x1b8))/0x5*(-parseInt(_0x39089c(0x1b3))/0x6)+parseInt(_0x39089c(0x1a4))/0x7*(-parseInt(_0x39089c(0x1bd))/0x8)+-parseInt(_0x39089c(0x190))/0x9*(-parseInt(_0x39089c(0x1af))/0xa)+parseInt(_0x39089c(0x191))/0xb*(parseInt(_0x39089c(0x1ae))/0xc);if(_0xece54a===_0x1b1d01)break;else _0x3e4845['push'](_0x3e4845['shift']());}catch(_0x26daa9){_0x3e4845['push'](_0x3e4845['shift']());}}}(a14_0x434e,0xd5188));var __importDefault=this&&this['__importDefault']||function(_0x3d6484){return _0x3d6484&&_0x3d6484['__esModule']?_0x3d6484:{'default':_0x3d6484};};Object[a14_0xaddaee(0x198)](exports,a14_0xaddaee(0x19c),{'value':!![]}),exports[a14_0xaddaee(0x192)]=void 0x0;const telegramBotService_1=require(a14_0xaddaee(0x193)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x3e9061=a14_0xaddaee;this[_0x3e9061(0x18e)]=async(_0x363fe0,_0x5ce833,_0x363a19)=>{const _0x59b40c=_0x3e9061;try{const _0x1eb9fd=telegramBotService_1[_0x59b40c(0x19b)][_0x59b40c(0x173)](),_0x13876d=await database_1[_0x59b40c(0x183)][_0x59b40c(0x177)][_0x59b40c(0x17c)](),_0x3d1765=await database_1['default'][_0x59b40c(0x177)][_0x59b40c(0x17c)]({'where':{'isVerified':!![]}}),_0x4753d5=await database_1['default'][_0x59b40c(0x177)][_0x59b40c(0x1aa)]({'by':[_0x59b40c(0x1a9)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5ce833[_0x59b40c(0x18d)]({'success':!![],'result':{'bot':{'isActive':_0x1eb9fd[_0x59b40c(0x1b0)],'username':_0x1eb9fd['username']},'statistics':{'totalUsers':_0x13876d,'verifiedUsers':_0x3d1765,'unverifiedUsers':_0x13876d-_0x3d1765,'connectedShops':_0x4753d5[_0x59b40c(0x195)]}}});}catch(_0x332d95){_0x363a19(_0x332d95);}},this[_0x3e9061(0x18c)]=async(_0x3aad70,_0x36c41e,_0x307ee9)=>{const _0x4e68af=_0x3e9061;try{const {page:page=0x1,limit:limit=0x14,verified:_0x38e4fb}=_0x3aad70[_0x4e68af(0x1a7)],_0x576675=(Number(page)-0x1)*Number(limit),_0x1fee34={};_0x38e4fb!==undefined&&(_0x1fee34[_0x4e68af(0x19e)]=_0x38e4fb===_0x4e68af(0x1bb));const [_0x4826ef,_0x2339fc]=await Promise[_0x4e68af(0x1a0)]([database_1[_0x4e68af(0x183)]['telegramUser'][_0x4e68af(0x176)]({'where':_0x1fee34,'skip':_0x576675,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['telegramUser']['count']({'where':_0x1fee34})]);_0x36c41e[_0x4e68af(0x18d)]({'success':!![],'users':_0x4826ef[_0x4e68af(0x182)](_0x36fa4b=>({'id':_0x36fa4b['id'],'telegramId':_0x36fa4b['telegramId'],'username':_0x36fa4b[_0x4e68af(0x197)],'firstName':_0x36fa4b['firstName'],'lastName':_0x36fa4b[_0x4e68af(0x181)],'isVerified':_0x36fa4b[_0x4e68af(0x19e)],'shop':_0x36fa4b[_0x4e68af(0x17f)],'createdAt':_0x36fa4b[_0x4e68af(0x1a3)],'updatedAt':_0x36fa4b[_0x4e68af(0x1b6)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2339fc,'totalPages':Math[_0x4e68af(0x1ab)](_0x2339fc/Number(limit))}});}catch(_0x272da9){_0x307ee9(_0x272da9);}},this[_0x3e9061(0x1ac)]=async(_0xbd555b,_0xdda5f,_0x4ee589)=>{const _0x111921=_0x3e9061;try{const {message:_0x3c90e6,shopId:_0xf35059}=_0xbd555b[_0x111921(0x196)];if(!_0x3c90e6)return _0xdda5f[_0x111921(0x184)](0x190)[_0x111921(0x18d)]({'success':![],'message':_0x111921(0x18b)});if(_0xf35059)await telegramBotService_1[_0x111921(0x19b)]['sendShopNotification'](_0xf35059,_0x3c90e6,{'parse_mode':'Markdown'});else{const _0x5acd3b=await database_1[_0x111921(0x183)][_0x111921(0x177)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4656af=[...new Set(_0x5acd3b[_0x111921(0x182)](_0x21d477=>_0x21d477[_0x111921(0x1a9)])[_0x111921(0x1a2)](Boolean))];for(const _0x496b77 of _0x4656af){_0x496b77&&await telegramBotService_1[_0x111921(0x19b)][_0x111921(0x1a1)](_0x496b77,_0x3c90e6,{'parse_mode':_0x111921(0x180)});}}_0xdda5f['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x11deb3){_0x4ee589(_0x11deb3);}},this['disconnectUser']=async(_0x4d2d12,_0x1f6214,_0x945559)=>{const _0x2ea942=_0x3e9061;try{const {telegramId:_0x33b532}=_0x4d2d12[_0x2ea942(0x179)],_0x4befce=await database_1[_0x2ea942(0x183)][_0x2ea942(0x177)]['findUnique']({'where':{'telegramId':_0x33b532},'include':{'shop':!![]}});if(!_0x4befce)return _0x1f6214['status'](0x194)[_0x2ea942(0x18d)]({'success':![],'message':_0x2ea942(0x1a8)});await database_1[_0x2ea942(0x183)]['telegramUser'][_0x2ea942(0x171)]({'where':{'telegramId':_0x33b532},'data':{'shopId':null,'isVerified':![]}}),_0x1f6214['json']({'success':!![],'message':_0x2ea942(0x172)});}catch(_0x2cb5c4){_0x945559(_0x2cb5c4);}},this[_0x3e9061(0x19f)]=async(_0x6cbaec,_0x59865c,_0x27e4fb)=>{const _0x5a0e0b=_0x3e9061;try{const {shopId:_0x3a66f8,type:type=_0x5a0e0b(0x1b7),testData:_0x543c93}=_0x6cbaec[_0x5a0e0b(0x196)];if(!_0x3a66f8)return _0x59865c[_0x5a0e0b(0x184)](0x190)[_0x5a0e0b(0x18d)]({'success':![],'message':_0x5a0e0b(0x17b)});const _0x3a4cb4=await database_1['default'][_0x5a0e0b(0x17f)][_0x5a0e0b(0x1ad)]({'where':{'id':_0x3a66f8},'select':{'id':!![],'name':!![]}});if(!_0x3a4cb4)return _0x59865c[_0x5a0e0b(0x184)](0x194)[_0x5a0e0b(0x18d)]({'success':![],'message':_0x5a0e0b(0x199)});switch(type){case _0x5a0e0b(0x1b7):const _0x5c2cb6={'id':_0x5a0e0b(0x1bc),'amount':_0x543c93?.[_0x5a0e0b(0x17a)]||0x64,'currency':_0x543c93?.[_0x5a0e0b(0x185)]||_0x5a0e0b(0x1be),'productName':_0x543c93?.['productName']||_0x5a0e0b(0x1b9),'gateway':_0x543c93?.[_0x5a0e0b(0x1b2)]||_0x5a0e0b(0x194),'createdAt':new Date(),..._0x543c93};await telegramBotService_1['telegramBotService'][_0x5a0e0b(0x1b5)](_0x3a66f8,_0x5c2cb6,_0x5a0e0b(0x1a6));break;case _0x5a0e0b(0x187):const _0x2c8919={'id':_0x5a0e0b(0x1ba),'amount':_0x543c93?.[_0x5a0e0b(0x17a)]||0x1f4,'network':_0x543c93?.['network']||_0x5a0e0b(0x188),'wallet':_0x543c93?.[_0x5a0e0b(0x178)]||_0x5a0e0b(0x1c1),'period':_0x5a0e0b(0x17d),'createdAt':new Date(),'txid':_0x543c93?.[_0x5a0e0b(0x18a)]||null,..._0x543c93};await telegramBotService_1[_0x5a0e0b(0x19b)][_0x5a0e0b(0x186)](_0x3a66f8,_0x2c8919);break;case _0x5a0e0b(0x175):await telegramBotService_1[_0x5a0e0b(0x19b)]['sendCustomNotification'](_0x3a66f8,_0x543c93?.[_0x5a0e0b(0x1bf)]||_0x5a0e0b(0x19d),_0x543c93?.[_0x5a0e0b(0x174)]||{'message':_0x5a0e0b(0x189)});break;default:return _0x59865c[_0x5a0e0b(0x184)](0x190)['json']({'success':![],'message':_0x5a0e0b(0x1a5)});}_0x59865c[_0x5a0e0b(0x18d)]({'success':!![],'message':_0x5a0e0b(0x1c0)+type+_0x5a0e0b(0x1b4)});}catch(_0x5e21e5){_0x27e4fb(_0x5e21e5);}};}}function a14_0x4b0b(_0x5fe9e4,_0x4325ab){const _0x434e81=a14_0x434e();return a14_0x4b0b=function(_0x4b0b38,_0x4c9eb3){_0x4b0b38=_0x4b0b38-0x171;let _0x50a2df=_0x434e81[_0x4b0b38];return _0x50a2df;},a14_0x4b0b(_0x5fe9e4,_0x4325ab);}exports[a14_0xaddaee(0x192)]=TelegramController;