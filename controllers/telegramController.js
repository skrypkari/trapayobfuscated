'use strict';function a20_0x5029(_0x54b3e3,_0x1831d9){_0x54b3e3=_0x54b3e3-0x66;const _0x27cec7=a20_0x27ce();let _0x502926=_0x27cec7[_0x54b3e3];return _0x502926;}const a20_0x48dfc4=a20_0x5029;(function(_0x319266,_0x18348d){const _0x4609e4=a20_0x5029,_0xa0f72a=_0x319266();while(!![]){try{const _0x376204=-parseInt(_0x4609e4(0x77))/0x1*(-parseInt(_0x4609e4(0x6c))/0x2)+parseInt(_0x4609e4(0xa4))/0x3*(parseInt(_0x4609e4(0x7e))/0x4)+-parseInt(_0x4609e4(0x6f))/0x5*(-parseInt(_0x4609e4(0xa0))/0x6)+parseInt(_0x4609e4(0x71))/0x7*(-parseInt(_0x4609e4(0x9b))/0x8)+parseInt(_0x4609e4(0x67))/0x9*(parseInt(_0x4609e4(0x87))/0xa)+-parseInt(_0x4609e4(0x89))/0xb*(parseInt(_0x4609e4(0x8f))/0xc)+-parseInt(_0x4609e4(0xa3))/0xd;if(_0x376204===_0x18348d)break;else _0xa0f72a['push'](_0xa0f72a['shift']());}catch(_0x244abf){_0xa0f72a['push'](_0xa0f72a['shift']());}}}(a20_0x27ce,0xdeeaf));var __importDefault=this&&this['__importDefault']||function(_0x3eebc4){const _0x53f757=a20_0x5029;return _0x3eebc4&&_0x3eebc4[_0x53f757(0x8e)]?_0x3eebc4:{'default':_0x3eebc4};};Object[a20_0x48dfc4(0x72)](exports,a20_0x48dfc4(0x8e),{'value':!![]}),exports[a20_0x48dfc4(0xa7)]=void 0x0;function a20_0x27ce(){const _0x1c8296=['4044012wzTLDt','User\x20disconnected\x20successfully','disconnectUser','getTelegramUsers','updatedAt','getBotInfo','isActive','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','telegramId','plisio','Test\x20Product','map','3003384fSZfjP','findUnique','Shop\x20not\x20found','lastName','createdAt','473580MyTvzf','isVerified','txid','11103456XffuIw','15AxVgdw','username','TRC20','TelegramController','Test\x20Notification','99aSJGFN','amount','update','sendShopNotification','network','2wlHQAS','USD','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','65OolvLz','true','7GjeiAn','defineProperty','Тестовый\x20период','telegramBotService','Markdown','desc','1093136hJxwFG','test_payout_123','sendTestNotification','Message\x20is\x20required','wallet','details','Broadcast\x20message\x20sent\x20successfully','33716thTOke','count','all','json','shop','default','telegramUser','sendBroadcast','productName','595670gTsfyw','ceil','22vmMvkW','body','gateway','Shop\x20ID\x20is\x20required','status','__esModule'];a20_0x27ce=function(){return _0x1c8296;};return a20_0x27ce();}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x15720e=a20_0x48dfc4;this['getBotStatus']=async(_0x50ce68,_0x246216,_0x2f259b)=>{const _0x44b699=a20_0x5029;try{const _0x52a8bd=telegramBotService_1[_0x44b699(0x74)][_0x44b699(0x94)](),_0x57b6ba=await database_1['default'][_0x44b699(0x84)][_0x44b699(0x7f)](),_0xbfcfc2=await database_1[_0x44b699(0x83)][_0x44b699(0x84)][_0x44b699(0x7f)]({'where':{'isVerified':!![]}}),_0x5ed986=await database_1[_0x44b699(0x83)][_0x44b699(0x84)]['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x246216[_0x44b699(0x81)]({'success':!![],'result':{'bot':{'isActive':_0x52a8bd[_0x44b699(0x95)],'username':_0x52a8bd[_0x44b699(0xa5)]},'statistics':{'totalUsers':_0x57b6ba,'verifiedUsers':_0xbfcfc2,'unverifiedUsers':_0x57b6ba-_0xbfcfc2,'connectedShops':_0x5ed986['length']}}});}catch(_0x576748){_0x2f259b(_0x576748);}},this[_0x15720e(0x92)]=async(_0x4bfdc5,_0x44a208,_0x598033)=>{const _0x480320=_0x15720e;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2e4bb1}=_0x4bfdc5['query'],_0x401572=(Number(page)-0x1)*Number(limit),_0x28eab2={};_0x2e4bb1!==undefined&&(_0x28eab2[_0x480320(0xa1)]=_0x2e4bb1===_0x480320(0x70));const [_0x23c468,_0x59b361]=await Promise[_0x480320(0x80)]([database_1[_0x480320(0x83)][_0x480320(0x84)]['findMany']({'where':_0x28eab2,'skip':_0x401572,'take':Number(limit),'orderBy':{'createdAt':_0x480320(0x76)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x480320(0x83)][_0x480320(0x84)][_0x480320(0x7f)]({'where':_0x28eab2})]);_0x44a208[_0x480320(0x81)]({'success':!![],'users':_0x23c468[_0x480320(0x9a)](_0xbcd291=>({'id':_0xbcd291['id'],'telegramId':_0xbcd291[_0x480320(0x97)],'username':_0xbcd291[_0x480320(0xa5)],'firstName':_0xbcd291['firstName'],'lastName':_0xbcd291[_0x480320(0x9e)],'isVerified':_0xbcd291['isVerified'],'shop':_0xbcd291['shop'],'createdAt':_0xbcd291[_0x480320(0x9f)],'updatedAt':_0xbcd291[_0x480320(0x93)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x59b361,'totalPages':Math[_0x480320(0x88)](_0x59b361/Number(limit))}});}catch(_0x5c043c){_0x598033(_0x5c043c);}},this[_0x15720e(0x85)]=async(_0x379af6,_0x314c7b,_0x1450bd)=>{const _0x3fb1ed=_0x15720e;try{const {message:_0x421137,shopId:_0x43af68}=_0x379af6[_0x3fb1ed(0x8a)];if(!_0x421137)return _0x314c7b[_0x3fb1ed(0x8d)](0x190)[_0x3fb1ed(0x81)]({'success':![],'message':_0x3fb1ed(0x7a)});if(_0x43af68)await telegramBotService_1[_0x3fb1ed(0x74)][_0x3fb1ed(0x6a)](_0x43af68,_0x421137,{'parse_mode':_0x3fb1ed(0x75)});else{const _0x486373=await database_1['default']['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x46eb79=[...new Set(_0x486373[_0x3fb1ed(0x9a)](_0x5384ba=>_0x5384ba['shopId'])['filter'](Boolean))];for(const _0x47c848 of _0x46eb79){_0x47c848&&await telegramBotService_1[_0x3fb1ed(0x74)][_0x3fb1ed(0x6a)](_0x47c848,_0x421137,{'parse_mode':_0x3fb1ed(0x75)});}}_0x314c7b[_0x3fb1ed(0x81)]({'success':!![],'message':_0x3fb1ed(0x7d)});}catch(_0x383de6){_0x1450bd(_0x383de6);}},this[_0x15720e(0x91)]=async(_0x753742,_0x2b026f,_0x226da0)=>{const _0x3a24e0=_0x15720e;try{const {telegramId:_0x1b16d4}=_0x753742['params'],_0x5cc096=await database_1[_0x3a24e0(0x83)][_0x3a24e0(0x84)][_0x3a24e0(0x9c)]({'where':{'telegramId':_0x1b16d4},'include':{'shop':!![]}});if(!_0x5cc096)return _0x2b026f[_0x3a24e0(0x8d)](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x3a24e0(0x83)][_0x3a24e0(0x84)][_0x3a24e0(0x69)]({'where':{'telegramId':_0x1b16d4},'data':{'shopId':null,'isVerified':![]}}),_0x2b026f[_0x3a24e0(0x81)]({'success':!![],'message':_0x3a24e0(0x90)});}catch(_0x150e05){_0x226da0(_0x150e05);}},this[_0x15720e(0x79)]=async(_0x2efac6,_0x9fda6c,_0xc81083)=>{const _0x2c1097=_0x15720e;try{const {shopId:_0x19f1f4,type:type='payment',testData:_0x54bd63}=_0x2efac6[_0x2c1097(0x8a)];if(!_0x19f1f4)return _0x9fda6c[_0x2c1097(0x8d)](0x190)[_0x2c1097(0x81)]({'success':![],'message':_0x2c1097(0x8c)});const _0x5bb10a=await database_1['default'][_0x2c1097(0x82)]['findUnique']({'where':{'id':_0x19f1f4},'select':{'id':!![],'name':!![]}});if(!_0x5bb10a)return _0x9fda6c[_0x2c1097(0x8d)](0x194)[_0x2c1097(0x81)]({'success':![],'message':_0x2c1097(0x9d)});switch(type){case'payment':const _0x3f8a45={'id':'test_payment_123','amount':_0x54bd63?.['amount']||0x64,'currency':_0x54bd63?.['currency']||_0x2c1097(0x6d),'productName':_0x54bd63?.[_0x2c1097(0x86)]||_0x2c1097(0x99),'gateway':_0x54bd63?.[_0x2c1097(0x8b)]||_0x2c1097(0x98),'createdAt':new Date(),..._0x54bd63};await telegramBotService_1[_0x2c1097(0x74)]['sendPaymentNotification'](_0x19f1f4,_0x3f8a45,'paid');break;case'payout':const _0x44e40c={'id':_0x2c1097(0x78),'amount':_0x54bd63?.[_0x2c1097(0x68)]||0x1f4,'network':_0x54bd63?.[_0x2c1097(0x6b)]||_0x2c1097(0xa6),'wallet':_0x54bd63?.[_0x2c1097(0x7b)]||_0x2c1097(0x96),'period':_0x2c1097(0x73),'createdAt':new Date(),'txid':_0x54bd63?.[_0x2c1097(0xa2)]||null,..._0x54bd63};await telegramBotService_1[_0x2c1097(0x74)]['sendPayoutNotification'](_0x19f1f4,_0x44e40c);break;case'custom':await telegramBotService_1[_0x2c1097(0x74)]['sendCustomNotification'](_0x19f1f4,_0x54bd63?.['title']||_0x2c1097(0x66),_0x54bd63?.[_0x2c1097(0x7c)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x9fda6c['status'](0x190)[_0x2c1097(0x81)]({'success':![],'message':_0x2c1097(0x6e)});}_0x9fda6c['json']({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x526e30){_0xc81083(_0x526e30);}};}}exports['TelegramController']=TelegramController;