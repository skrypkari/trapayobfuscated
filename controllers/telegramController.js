'use strict';const a12_0x51decf=a12_0x19ed;(function(_0x359cdb,_0x509732){const _0x9dd9de=a12_0x19ed,_0x53b70c=_0x359cdb();while(!![]){try{const _0x1ff255=-parseInt(_0x9dd9de(0x1d2))/0x1*(parseInt(_0x9dd9de(0x1c7))/0x2)+-parseInt(_0x9dd9de(0x1c3))/0x3*(parseInt(_0x9dd9de(0x1ea))/0x4)+parseInt(_0x9dd9de(0x1c5))/0x5*(parseInt(_0x9dd9de(0x1fa))/0x6)+-parseInt(_0x9dd9de(0x1f8))/0x7*(parseInt(_0x9dd9de(0x1e3))/0x8)+parseInt(_0x9dd9de(0x1dd))/0x9*(parseInt(_0x9dd9de(0x1f1))/0xa)+parseInt(_0x9dd9de(0x1d4))/0xb*(-parseInt(_0x9dd9de(0x1ee))/0xc)+parseInt(_0x9dd9de(0x20a))/0xd*(parseInt(_0x9dd9de(0x1cc))/0xe);if(_0x1ff255===_0x509732)break;else _0x53b70c['push'](_0x53b70c['shift']());}catch(_0x558495){_0x53b70c['push'](_0x53b70c['shift']());}}}(a12_0x2a80,0x94b6d));var __importDefault=this&&this[a12_0x51decf(0x1d8)]||function(_0x1ab202){const _0x4d1c35=a12_0x51decf;return _0x1ab202&&_0x1ab202[_0x4d1c35(0x201)]?_0x1ab202:{'default':_0x1ab202};};Object['defineProperty'](exports,a12_0x51decf(0x201),{'value':!![]}),exports[a12_0x51decf(0x1c8)]=void 0x0;const telegramBotService_1=require(a12_0x51decf(0x1e4)),database_1=__importDefault(require(a12_0x51decf(0x1d9)));function a12_0x19ed(_0x524703,_0x1c49e7){const _0x2a80f2=a12_0x2a80();return a12_0x19ed=function(_0x19ed98,_0x46b040){_0x19ed98=_0x19ed98-0x1bf;let _0x2fcd39=_0x2a80f2[_0x19ed98];return _0x2fcd39;},a12_0x19ed(_0x524703,_0x1c49e7);}class TelegramController{constructor(){const _0x114352=a12_0x51decf;this[_0x114352(0x1fb)]=async(_0x499923,_0x5b026e,_0x2f6464)=>{const _0x57aa80=_0x114352;try{const _0x22fd9f=telegramBotService_1[_0x57aa80(0x1cb)]['getBotInfo'](),_0x274f0d=await database_1[_0x57aa80(0x203)][_0x57aa80(0x1e0)][_0x57aa80(0x1c2)](),_0x2f728b=await database_1[_0x57aa80(0x203)]['telegramUser'][_0x57aa80(0x1c2)]({'where':{'isVerified':!![]}}),_0x5d96dc=await database_1['default']['telegramUser']['groupBy']({'by':[_0x57aa80(0x1db)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5b026e['json']({'success':!![],'result':{'bot':{'isActive':_0x22fd9f['isActive'],'username':_0x22fd9f[_0x57aa80(0x1e8)]},'statistics':{'totalUsers':_0x274f0d,'verifiedUsers':_0x2f728b,'unverifiedUsers':_0x274f0d-_0x2f728b,'connectedShops':_0x5d96dc[_0x57aa80(0x1e1)]}}});}catch(_0x3f06a3){_0x2f6464(_0x3f06a3);}},this['getTelegramUsers']=async(_0x52f463,_0x1d0474,_0x54ef56)=>{const _0x5581cd=_0x114352;try{const {page:page=0x1,limit:limit=0x14,verified:_0x446d3b}=_0x52f463[_0x5581cd(0x205)],_0x57dddd=(Number(page)-0x1)*Number(limit),_0x23cf63={};_0x446d3b!==undefined&&(_0x23cf63[_0x5581cd(0x1fc)]=_0x446d3b===_0x5581cd(0x1f7));const [_0x46ffa8,_0x583fd7]=await Promise[_0x5581cd(0x1e9)]([database_1[_0x5581cd(0x203)]['telegramUser']['findMany']({'where':_0x23cf63,'skip':_0x57dddd,'take':Number(limit),'orderBy':{'createdAt':_0x5581cd(0x1d5)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5581cd(0x203)][_0x5581cd(0x1e0)][_0x5581cd(0x1c2)]({'where':_0x23cf63})]);_0x1d0474[_0x5581cd(0x1f2)]({'success':!![],'users':_0x46ffa8['map'](_0x35b6d3=>({'id':_0x35b6d3['id'],'telegramId':_0x35b6d3[_0x5581cd(0x1cd)],'username':_0x35b6d3[_0x5581cd(0x1e8)],'firstName':_0x35b6d3[_0x5581cd(0x200)],'lastName':_0x35b6d3[_0x5581cd(0x202)],'isVerified':_0x35b6d3[_0x5581cd(0x1fc)],'shop':_0x35b6d3[_0x5581cd(0x1d0)],'createdAt':_0x35b6d3[_0x5581cd(0x1fe)],'updatedAt':_0x35b6d3[_0x5581cd(0x1ff)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x583fd7,'totalPages':Math[_0x5581cd(0x1ef)](_0x583fd7/Number(limit))}});}catch(_0xd3b101){_0x54ef56(_0xd3b101);}},this['sendBroadcast']=async(_0x187f69,_0x5188b6,_0x2f520a)=>{const _0x3e196e=_0x114352;try{const {message:_0x26873e,shopId:_0x1219e3}=_0x187f69[_0x3e196e(0x1f4)];if(!_0x26873e)return _0x5188b6[_0x3e196e(0x1ca)](0x190)[_0x3e196e(0x1f2)]({'success':![],'message':_0x3e196e(0x1bf)});if(_0x1219e3)await telegramBotService_1[_0x3e196e(0x1cb)]['sendShopNotification'](_0x1219e3,_0x26873e,{'parse_mode':_0x3e196e(0x1c6)});else{const _0x408465=await database_1[_0x3e196e(0x203)]['telegramUser'][_0x3e196e(0x1de)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x376082=[...new Set(_0x408465['map'](_0x358d98=>_0x358d98[_0x3e196e(0x1db)])[_0x3e196e(0x1e2)](Boolean))];for(const _0x31d110 of _0x376082){_0x31d110&&await telegramBotService_1[_0x3e196e(0x1cb)][_0x3e196e(0x1ec)](_0x31d110,_0x26873e,{'parse_mode':_0x3e196e(0x1c6)});}}_0x5188b6[_0x3e196e(0x1f2)]({'success':!![],'message':_0x3e196e(0x20c)});}catch(_0x2c2ccb){_0x2f520a(_0x2c2ccb);}},this[_0x114352(0x1c1)]=async(_0x209137,_0x589529,_0x353e86)=>{const _0x4888ef=_0x114352;try{const {telegramId:_0x3e0bec}=_0x209137[_0x4888ef(0x1f6)],_0x4c04f0=await database_1[_0x4888ef(0x203)][_0x4888ef(0x1e0)][_0x4888ef(0x1f9)]({'where':{'telegramId':_0x3e0bec},'include':{'shop':!![]}});if(!_0x4c04f0)return _0x589529[_0x4888ef(0x1ca)](0x194)[_0x4888ef(0x1f2)]({'success':![],'message':_0x4888ef(0x1f0)});await database_1[_0x4888ef(0x203)][_0x4888ef(0x1e0)][_0x4888ef(0x1eb)]({'where':{'telegramId':_0x3e0bec},'data':{'shopId':null,'isVerified':![]}}),_0x589529[_0x4888ef(0x1f2)]({'success':!![],'message':_0x4888ef(0x1d3)});}catch(_0x3c6df1){_0x353e86(_0x3c6df1);}},this[_0x114352(0x204)]=async(_0x3cdfa4,_0x47ff69,_0x21ba20)=>{const _0x2e8737=_0x114352;try{const {shopId:_0x56401a,type:type='payment',testData:_0xb588ef}=_0x3cdfa4[_0x2e8737(0x1f4)];if(!_0x56401a)return _0x47ff69['status'](0x190)[_0x2e8737(0x1f2)]({'success':![],'message':_0x2e8737(0x1f3)});const _0x59d4f4=await database_1[_0x2e8737(0x203)][_0x2e8737(0x1d0)][_0x2e8737(0x1f9)]({'where':{'id':_0x56401a},'select':{'id':!![],'name':!![]}});if(!_0x59d4f4)return _0x47ff69[_0x2e8737(0x1ca)](0x194)[_0x2e8737(0x1f2)]({'success':![],'message':_0x2e8737(0x1fd)});switch(type){case _0x2e8737(0x1dc):const _0x3a118b={'id':_0x2e8737(0x20b),'amount':_0xb588ef?.['amount']||0x64,'currency':_0xb588ef?.[_0x2e8737(0x1ed)]||_0x2e8737(0x1df),'productName':_0xb588ef?.[_0x2e8737(0x1d6)]||_0x2e8737(0x1cf),'gateway':_0xb588ef?.[_0x2e8737(0x1d1)]||_0x2e8737(0x1c4),'createdAt':new Date(),..._0xb588ef};await telegramBotService_1[_0x2e8737(0x1cb)][_0x2e8737(0x1e5)](_0x56401a,_0x3a118b,'paid');break;case _0x2e8737(0x1e6):const _0x4452f9={'id':_0x2e8737(0x208),'amount':_0xb588ef?.[_0x2e8737(0x1c0)]||0x1f4,'method':_0xb588ef?.[_0x2e8737(0x1d7)]||_0x2e8737(0x1e7),'createdAt':new Date(),..._0xb588ef};await telegramBotService_1[_0x2e8737(0x1cb)][_0x2e8737(0x1f5)](_0x56401a,_0x4452f9,_0x2e8737(0x1da));break;case _0x2e8737(0x207):await telegramBotService_1[_0x2e8737(0x1cb)][_0x2e8737(0x209)](_0x56401a,_0xb588ef?.[_0x2e8737(0x1c9)]||_0x2e8737(0x1ce),_0xb588ef?.['details']||{'message':_0x2e8737(0x206)});break;default:return _0x47ff69[_0x2e8737(0x1ca)](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x47ff69[_0x2e8737(0x1f2)]({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x5b0141){_0x21ba20(_0x5b0141);}};}}function a12_0x2a80(){const _0x59de4e=['USD','telegramUser','length','filter','662576OBZeXS','../services/telegramBotService','sendPaymentNotification','payout','bank_transfer','username','all','7744vHajxd','update','sendShopNotification','currency','732waYuyk','ceil','Telegram\x20user\x20not\x20found','7570RykOyq','json','Shop\x20ID\x20is\x20required','body','sendPayoutNotification','params','true','28isnOii','findUnique','312jmLbMD','getBotStatus','isVerified','Shop\x20not\x20found','createdAt','updatedAt','firstName','__esModule','lastName','default','sendTestNotification','query','This\x20is\x20a\x20test\x20notification','custom','test_payout_123','sendCustomNotification','1677dCNVft','test_payment_123','Broadcast\x20message\x20sent\x20successfully','Message\x20is\x20required','amount','disconnectUser','count','1269ZZOzfk','plisio','72145osBERA','Markdown','9314GWhVFq','TelegramController','title','status','telegramBotService','276822INFoGm','telegramId','Test\x20Notification','Test\x20Product','shop','gateway','261VWEgFi','User\x20disconnected\x20successfully','112607sSukBV','desc','productName','method','__importDefault','../config/database','completed','shopId','payment','3546HgneWL','findMany'];a12_0x2a80=function(){return _0x59de4e;};return a12_0x2a80();}exports[a12_0x51decf(0x1c8)]=TelegramController;