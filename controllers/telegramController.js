'use strict';const a14_0x5b9716=a14_0x3cf3;(function(_0xf553b,_0x5180ab){const _0x4e3dfe=a14_0x3cf3,_0x4034f3=_0xf553b();while(!![]){try{const _0xb87e93=-parseInt(_0x4e3dfe(0x19d))/0x1*(-parseInt(_0x4e3dfe(0x1a0))/0x2)+-parseInt(_0x4e3dfe(0x1c6))/0x3*(-parseInt(_0x4e3dfe(0x1ae))/0x4)+-parseInt(_0x4e3dfe(0x181))/0x5+parseInt(_0x4e3dfe(0x1b7))/0x6+parseInt(_0x4e3dfe(0x194))/0x7+parseInt(_0x4e3dfe(0x18a))/0x8+parseInt(_0x4e3dfe(0x190))/0x9*(-parseInt(_0x4e3dfe(0x1b4))/0xa);if(_0xb87e93===_0x5180ab)break;else _0x4034f3['push'](_0x4034f3['shift']());}catch(_0x1cb17f){_0x4034f3['push'](_0x4034f3['shift']());}}}(a14_0x524b,0x9b5fe));function a14_0x3cf3(_0x4cdf21,_0x1133f3){const _0x524be6=a14_0x524b();return a14_0x3cf3=function(_0x3cf331,_0xf365f8){_0x3cf331=_0x3cf331-0x17d;let _0x2f2910=_0x524be6[_0x3cf331];return _0x2f2910;},a14_0x3cf3(_0x4cdf21,_0x1133f3);}var __importDefault=this&&this[a14_0x5b9716(0x1b8)]||function(_0x52edf2){const _0x57e164=a14_0x5b9716;return _0x52edf2&&_0x52edf2[_0x57e164(0x1b5)]?_0x52edf2:{'default':_0x52edf2};};Object[a14_0x5b9716(0x1ad)](exports,'__esModule',{'value':!![]}),exports[a14_0x5b9716(0x193)]=void 0x0;const telegramBotService_1=require(a14_0x5b9716(0x19c)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x4c770e=a14_0x5b9716;this['getBotStatus']=async(_0x3d703e,_0x2811d4,_0x209a5d)=>{const _0x525611=a14_0x3cf3;try{const _0x561066=telegramBotService_1[_0x525611(0x1a9)][_0x525611(0x186)](),_0x3ed7ab=await database_1['default'][_0x525611(0x1bf)][_0x525611(0x1a8)](),_0x22d240=await database_1[_0x525611(0x1ac)]['telegramUser'][_0x525611(0x1a8)]({'where':{'isVerified':!![]}}),_0x4597e6=await database_1[_0x525611(0x1ac)][_0x525611(0x1bf)][_0x525611(0x184)]({'by':[_0x525611(0x1ab)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2811d4['json']({'success':!![],'result':{'bot':{'isActive':_0x561066[_0x525611(0x1b2)],'username':_0x561066[_0x525611(0x1c3)]},'statistics':{'totalUsers':_0x3ed7ab,'verifiedUsers':_0x22d240,'unverifiedUsers':_0x3ed7ab-_0x22d240,'connectedShops':_0x4597e6['length']}}});}catch(_0x2d9277){_0x209a5d(_0x2d9277);}},this[_0x4c770e(0x1af)]=async(_0xf9ce98,_0x536aac,_0x22b338)=>{const _0x2a9e33=_0x4c770e;try{const {page:page=0x1,limit:limit=0x14,verified:_0x927547}=_0xf9ce98[_0x2a9e33(0x195)],_0xa6181c=(Number(page)-0x1)*Number(limit),_0x128bda={};_0x927547!==undefined&&(_0x128bda[_0x2a9e33(0x1b0)]=_0x927547===_0x2a9e33(0x189));const [_0x2ee386,_0xc70836]=await Promise[_0x2a9e33(0x1ba)]([database_1['default'][_0x2a9e33(0x1bf)][_0x2a9e33(0x1c0)]({'where':_0x128bda,'skip':_0xa6181c,'take':Number(limit),'orderBy':{'createdAt':_0x2a9e33(0x17f)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['telegramUser'][_0x2a9e33(0x1a8)]({'where':_0x128bda})]);_0x536aac[_0x2a9e33(0x182)]({'success':!![],'users':_0x2ee386['map'](_0x13dab7=>({'id':_0x13dab7['id'],'telegramId':_0x13dab7[_0x2a9e33(0x1c5)],'username':_0x13dab7[_0x2a9e33(0x1c3)],'firstName':_0x13dab7[_0x2a9e33(0x1a5)],'lastName':_0x13dab7['lastName'],'isVerified':_0x13dab7[_0x2a9e33(0x1b0)],'shop':_0x13dab7[_0x2a9e33(0x198)],'createdAt':_0x13dab7[_0x2a9e33(0x1bc)],'updatedAt':_0x13dab7[_0x2a9e33(0x1a4)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xc70836,'totalPages':Math['ceil'](_0xc70836/Number(limit))}});}catch(_0xc992ad){_0x22b338(_0xc992ad);}},this[_0x4c770e(0x17e)]=async(_0x1b8f38,_0x52e0a9,_0x5069d8)=>{const _0x197c1b=_0x4c770e;try{const {message:_0x167582,shopId:_0x44e001}=_0x1b8f38[_0x197c1b(0x191)];if(!_0x167582)return _0x52e0a9[_0x197c1b(0x1b3)](0x190)[_0x197c1b(0x182)]({'success':![],'message':_0x197c1b(0x18e)});if(_0x44e001)await telegramBotService_1[_0x197c1b(0x1a9)]['sendShopNotification'](_0x44e001,_0x167582,{'parse_mode':_0x197c1b(0x1c7)});else{const _0xb877d2=await database_1[_0x197c1b(0x1ac)][_0x197c1b(0x1bf)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3eed72=[...new Set(_0xb877d2[_0x197c1b(0x1c1)](_0x39cb8c=>_0x39cb8c[_0x197c1b(0x1ab)])['filter'](Boolean))];for(const _0x282059 of _0x3eed72){_0x282059&&await telegramBotService_1['telegramBotService'][_0x197c1b(0x192)](_0x282059,_0x167582,{'parse_mode':_0x197c1b(0x1c7)});}}_0x52e0a9[_0x197c1b(0x182)]({'success':!![],'message':_0x197c1b(0x18d)});}catch(_0x4a0d79){_0x5069d8(_0x4a0d79);}},this[_0x4c770e(0x1a1)]=async(_0x410809,_0x265b21,_0x2228e7)=>{const _0x21ad24=_0x4c770e;try{const {telegramId:_0x2c73c7}=_0x410809[_0x21ad24(0x1a6)],_0x31fb8c=await database_1[_0x21ad24(0x1ac)][_0x21ad24(0x1bf)][_0x21ad24(0x199)]({'where':{'telegramId':_0x2c73c7},'include':{'shop':!![]}});if(!_0x31fb8c)return _0x265b21['status'](0x194)[_0x21ad24(0x182)]({'success':![],'message':_0x21ad24(0x188)});await database_1[_0x21ad24(0x1ac)]['telegramUser']['update']({'where':{'telegramId':_0x2c73c7},'data':{'shopId':null,'isVerified':![]}}),_0x265b21[_0x21ad24(0x182)]({'success':!![],'message':_0x21ad24(0x180)});}catch(_0x60aba4){_0x2228e7(_0x60aba4);}},this[_0x4c770e(0x1c2)]=async(_0x322887,_0x3f4355,_0x56d956)=>{const _0x134a31=_0x4c770e;try{const {shopId:_0x502cc4,type:type=_0x134a31(0x17d),testData:_0x303582}=_0x322887[_0x134a31(0x191)];if(!_0x502cc4)return _0x3f4355[_0x134a31(0x1b3)](0x190)[_0x134a31(0x182)]({'success':![],'message':_0x134a31(0x1bd)});const _0x3fad9f=await database_1[_0x134a31(0x1ac)][_0x134a31(0x198)][_0x134a31(0x199)]({'where':{'id':_0x502cc4},'select':{'id':!![],'name':!![]}});if(!_0x3fad9f)return _0x3f4355[_0x134a31(0x1b3)](0x194)[_0x134a31(0x182)]({'success':![],'message':_0x134a31(0x185)});switch(type){case _0x134a31(0x17d):const _0x4e219c={'id':_0x134a31(0x1bb),'amount':_0x303582?.[_0x134a31(0x197)]||0x64,'currency':_0x303582?.[_0x134a31(0x19a)]||'USD','productName':_0x303582?.[_0x134a31(0x19e)]||_0x134a31(0x19b),'gateway':_0x303582?.['gateway']||'plisio','createdAt':new Date(),..._0x303582};await telegramBotService_1[_0x134a31(0x1a9)][_0x134a31(0x1b9)](_0x502cc4,_0x4e219c,'paid');break;case _0x134a31(0x18c):const _0x5e1d96={'id':_0x134a31(0x1b1),'amount':_0x303582?.[_0x134a31(0x197)]||0x1f4,'network':_0x303582?.[_0x134a31(0x1be)]||_0x134a31(0x1b6),'wallet':_0x303582?.[_0x134a31(0x1a2)]||'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','period':_0x134a31(0x18b),'createdAt':new Date(),'txid':_0x303582?.[_0x134a31(0x1c4)]||null,..._0x303582};await telegramBotService_1[_0x134a31(0x1a9)][_0x134a31(0x196)](_0x502cc4,_0x5e1d96);break;case _0x134a31(0x18f):await telegramBotService_1['telegramBotService'][_0x134a31(0x183)](_0x502cc4,_0x303582?.[_0x134a31(0x1a7)]||_0x134a31(0x19f),_0x303582?.['details']||{'message':_0x134a31(0x1a3)});break;default:return _0x3f4355[_0x134a31(0x1b3)](0x190)[_0x134a31(0x182)]({'success':![],'message':_0x134a31(0x187)});}_0x3f4355[_0x134a31(0x182)]({'success':!![],'message':_0x134a31(0x1aa)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x59219b){_0x56d956(_0x59219b);}};}}exports['TelegramController']=TelegramController;function a14_0x524b(){const _0x5621f3=['query','sendPayoutNotification','amount','shop','findUnique','currency','Test\x20Product','../services/telegramBotService','4OxftPK','productName','Test\x20Notification','358060tJWkiM','disconnectUser','wallet','This\x20is\x20a\x20test\x20notification','updatedAt','firstName','params','title','count','telegramBotService','Test\x20','shopId','default','defineProperty','52BzDJnL','getTelegramUsers','isVerified','test_payout_123','isActive','status','7749890DuZyXD','__esModule','TRC20','1190064sHshQa','__importDefault','sendPaymentNotification','all','test_payment_123','createdAt','Shop\x20ID\x20is\x20required','network','telegramUser','findMany','map','sendTestNotification','username','txid','telegramId','158241eqsRKY','Markdown','payment','sendBroadcast','desc','User\x20disconnected\x20successfully','4741530ynvAcS','json','sendCustomNotification','groupBy','Shop\x20not\x20found','getBotInfo','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Telegram\x20user\x20not\x20found','true','7012816xwRcke','Тестовый\x20период','payout','Broadcast\x20message\x20sent\x20successfully','Message\x20is\x20required','custom','18GStWKd','body','sendShopNotification','TelegramController','4605447ZTkDlz'];a14_0x524b=function(){return _0x5621f3;};return a14_0x524b();}