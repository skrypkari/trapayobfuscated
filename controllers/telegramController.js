'use strict';const a17_0x5d58ad=a17_0x52a8;(function(_0x44563c,_0x26862c){const _0x24f6ef=a17_0x52a8,_0x212828=_0x44563c();while(!![]){try{const _0x1db302=parseInt(_0x24f6ef(0x1d7))/0x1*(parseInt(_0x24f6ef(0x1b2))/0x2)+parseInt(_0x24f6ef(0x1ce))/0x3*(-parseInt(_0x24f6ef(0x1c6))/0x4)+parseInt(_0x24f6ef(0x1de))/0x5+-parseInt(_0x24f6ef(0x1d8))/0x6+parseInt(_0x24f6ef(0x1b3))/0x7*(-parseInt(_0x24f6ef(0x1d3))/0x8)+-parseInt(_0x24f6ef(0x1b0))/0x9*(-parseInt(_0x24f6ef(0x1f5))/0xa)+parseInt(_0x24f6ef(0x1ef))/0xb*(parseInt(_0x24f6ef(0x1c9))/0xc);if(_0x1db302===_0x26862c)break;else _0x212828['push'](_0x212828['shift']());}catch(_0x42f25a){_0x212828['push'](_0x212828['shift']());}}}(a17_0x3c2a,0xec846));var __importDefault=this&&this['__importDefault']||function(_0x816c42){const _0x31cbd4=a17_0x52a8;return _0x816c42&&_0x816c42[_0x31cbd4(0x1e4)]?_0x816c42:{'default':_0x816c42};};Object[a17_0x5d58ad(0x1eb)](exports,a17_0x5d58ad(0x1e4),{'value':!![]}),exports[a17_0x5d58ad(0x1c4)]=void 0x0;function a17_0x3c2a(){const _0x513db9=['__esModule','title','status','test_payout_123','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','telegramBotService','username','defineProperty','sendBroadcast','Test\x20','Тестовый\x20период','192643ndDudb','filter','json','User\x20disconnected\x20successfully','groupBy','network','10FOPQvZ','count','details','payout','default','findMany','telegramId','3021021GoOUEa','body','236vrFgWX','6757835CVbWeS','findUnique','Test\x20Notification','getTelegramUsers','isVerified','plisio','payment','USD','\x20notification\x20sent\x20successfully','map','telegramUser','getBotStatus','desc','Test\x20Product','disconnectUser','sendCustomNotification','createdAt','TelegramController','currency','4LgDmxW','shop','shopId','1608dmTjRQ','wallet','sendTestNotification','sendShopNotification','../config/database','5446500nBQbDz','params','test_payment_123','Message\x20is\x20required','Markdown','8JeAzRk','isActive','updatedAt','txid','2891vWwGvb','1908510uOTQAI','gateway','Shop\x20ID\x20is\x20required','all','sendPaymentNotification','sendPayoutNotification','5221075LcoXpt','TRC20','amount','custom','Telegram\x20user\x20not\x20found','lastName'];a17_0x3c2a=function(){return _0x513db9;};return a17_0x3c2a();}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a17_0x5d58ad(0x1cd)));function a17_0x52a8(_0x422395,_0x390851){_0x422395=_0x422395-0x1b0;const _0x3c2a93=a17_0x3c2a();let _0x52a852=_0x3c2a93[_0x422395];return _0x52a852;}class TelegramController{constructor(){const _0x33bbc3=a17_0x5d58ad;this[_0x33bbc3(0x1be)]=async(_0xf67e86,_0x17950d,_0xf65b86)=>{const _0xc8d6d8=_0x33bbc3;try{const _0x389f61=telegramBotService_1[_0xc8d6d8(0x1e9)]['getBotInfo'](),_0x154d76=await database_1[_0xc8d6d8(0x1f9)][_0xc8d6d8(0x1bd)][_0xc8d6d8(0x1f6)](),_0x335460=await database_1['default'][_0xc8d6d8(0x1bd)][_0xc8d6d8(0x1f6)]({'where':{'isVerified':!![]}}),_0x4472d1=await database_1['default'][_0xc8d6d8(0x1bd)][_0xc8d6d8(0x1f3)]({'by':[_0xc8d6d8(0x1c8)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x17950d[_0xc8d6d8(0x1f1)]({'success':!![],'result':{'bot':{'isActive':_0x389f61[_0xc8d6d8(0x1d4)],'username':_0x389f61[_0xc8d6d8(0x1ea)]},'statistics':{'totalUsers':_0x154d76,'verifiedUsers':_0x335460,'unverifiedUsers':_0x154d76-_0x335460,'connectedShops':_0x4472d1['length']}}});}catch(_0x453312){_0xf65b86(_0x453312);}},this[_0x33bbc3(0x1b6)]=async(_0x388f19,_0x5ec7f3,_0xfbf185)=>{const _0x3e6d56=_0x33bbc3;try{const {page:page=0x1,limit:limit=0x14,verified:_0x318453}=_0x388f19['query'],_0x506164=(Number(page)-0x1)*Number(limit),_0x1c0f1e={};_0x318453!==undefined&&(_0x1c0f1e['isVerified']=_0x318453==='true');const [_0x330ec9,_0x181b21]=await Promise[_0x3e6d56(0x1db)]([database_1[_0x3e6d56(0x1f9)][_0x3e6d56(0x1bd)][_0x3e6d56(0x1fa)]({'where':_0x1c0f1e,'skip':_0x506164,'take':Number(limit),'orderBy':{'createdAt':_0x3e6d56(0x1bf)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x3e6d56(0x1f9)][_0x3e6d56(0x1bd)][_0x3e6d56(0x1f6)]({'where':_0x1c0f1e})]);_0x5ec7f3[_0x3e6d56(0x1f1)]({'success':!![],'users':_0x330ec9[_0x3e6d56(0x1bc)](_0x3694f1=>({'id':_0x3694f1['id'],'telegramId':_0x3694f1[_0x3e6d56(0x1fb)],'username':_0x3694f1[_0x3e6d56(0x1ea)],'firstName':_0x3694f1['firstName'],'lastName':_0x3694f1[_0x3e6d56(0x1e3)],'isVerified':_0x3694f1[_0x3e6d56(0x1b7)],'shop':_0x3694f1[_0x3e6d56(0x1c7)],'createdAt':_0x3694f1[_0x3e6d56(0x1c3)],'updatedAt':_0x3694f1[_0x3e6d56(0x1d5)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x181b21,'totalPages':Math['ceil'](_0x181b21/Number(limit))}});}catch(_0x2e18bb){_0xfbf185(_0x2e18bb);}},this[_0x33bbc3(0x1ec)]=async(_0x5c7021,_0xe26d7b,_0x2a53ee)=>{const _0x39a81c=_0x33bbc3;try{const {message:_0x33c247,shopId:_0x1e70ed}=_0x5c7021[_0x39a81c(0x1b1)];if(!_0x33c247)return _0xe26d7b['status'](0x190)[_0x39a81c(0x1f1)]({'success':![],'message':_0x39a81c(0x1d1)});if(_0x1e70ed)await telegramBotService_1[_0x39a81c(0x1e9)]['sendShopNotification'](_0x1e70ed,_0x33c247,{'parse_mode':'Markdown'});else{const _0x6bbd72=await database_1['default']['telegramUser'][_0x39a81c(0x1fa)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x26561c=[...new Set(_0x6bbd72['map'](_0x77841b=>_0x77841b[_0x39a81c(0x1c8)])[_0x39a81c(0x1f0)](Boolean))];for(const _0x54bd01 of _0x26561c){_0x54bd01&&await telegramBotService_1[_0x39a81c(0x1e9)][_0x39a81c(0x1cc)](_0x54bd01,_0x33c247,{'parse_mode':_0x39a81c(0x1d2)});}}_0xe26d7b[_0x39a81c(0x1f1)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x1a4f84){_0x2a53ee(_0x1a4f84);}},this[_0x33bbc3(0x1c1)]=async(_0x6454f7,_0x363f8b,_0x164d78)=>{const _0x20ace9=_0x33bbc3;try{const {telegramId:_0x5e346f}=_0x6454f7[_0x20ace9(0x1cf)],_0xb58a6=await database_1[_0x20ace9(0x1f9)]['telegramUser']['findUnique']({'where':{'telegramId':_0x5e346f},'include':{'shop':!![]}});if(!_0xb58a6)return _0x363f8b[_0x20ace9(0x1e6)](0x194)[_0x20ace9(0x1f1)]({'success':![],'message':_0x20ace9(0x1e2)});await database_1[_0x20ace9(0x1f9)][_0x20ace9(0x1bd)]['update']({'where':{'telegramId':_0x5e346f},'data':{'shopId':null,'isVerified':![]}}),_0x363f8b[_0x20ace9(0x1f1)]({'success':!![],'message':_0x20ace9(0x1f2)});}catch(_0x1e6bba){_0x164d78(_0x1e6bba);}},this[_0x33bbc3(0x1cb)]=async(_0x25d4f1,_0x3bac24,_0x2069b8)=>{const _0x10af80=_0x33bbc3;try{const {shopId:_0x59dad0,type:type=_0x10af80(0x1b9),testData:_0x6ce47b}=_0x25d4f1[_0x10af80(0x1b1)];if(!_0x59dad0)return _0x3bac24[_0x10af80(0x1e6)](0x190)[_0x10af80(0x1f1)]({'success':![],'message':_0x10af80(0x1da)});const _0x491d64=await database_1['default'][_0x10af80(0x1c7)][_0x10af80(0x1b4)]({'where':{'id':_0x59dad0},'select':{'id':!![],'name':!![]}});if(!_0x491d64)return _0x3bac24['status'](0x194)[_0x10af80(0x1f1)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0x4e6c60={'id':_0x10af80(0x1d0),'amount':_0x6ce47b?.[_0x10af80(0x1e0)]||0x64,'currency':_0x6ce47b?.[_0x10af80(0x1c5)]||_0x10af80(0x1ba),'productName':_0x6ce47b?.['productName']||_0x10af80(0x1c0),'gateway':_0x6ce47b?.[_0x10af80(0x1d9)]||_0x10af80(0x1b8),'createdAt':new Date(),..._0x6ce47b};await telegramBotService_1[_0x10af80(0x1e9)][_0x10af80(0x1dc)](_0x59dad0,_0x4e6c60,'paid');break;case _0x10af80(0x1f8):const _0x33d73d={'id':_0x10af80(0x1e7),'amount':_0x6ce47b?.[_0x10af80(0x1e0)]||0x1f4,'network':_0x6ce47b?.[_0x10af80(0x1f4)]||_0x10af80(0x1df),'wallet':_0x6ce47b?.[_0x10af80(0x1ca)]||'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','period':_0x10af80(0x1ee),'createdAt':new Date(),'txid':_0x6ce47b?.[_0x10af80(0x1d6)]||null,..._0x6ce47b};await telegramBotService_1[_0x10af80(0x1e9)][_0x10af80(0x1dd)](_0x59dad0,_0x33d73d);break;case _0x10af80(0x1e1):await telegramBotService_1[_0x10af80(0x1e9)][_0x10af80(0x1c2)](_0x59dad0,_0x6ce47b?.[_0x10af80(0x1e5)]||_0x10af80(0x1b5),_0x6ce47b?.[_0x10af80(0x1f7)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x3bac24[_0x10af80(0x1e6)](0x190)[_0x10af80(0x1f1)]({'success':![],'message':_0x10af80(0x1e8)});}_0x3bac24[_0x10af80(0x1f1)]({'success':!![],'message':_0x10af80(0x1ed)+type+_0x10af80(0x1bb)});}catch(_0x4ea87f){_0x2069b8(_0x4ea87f);}};}}exports[a17_0x5d58ad(0x1c4)]=TelegramController;