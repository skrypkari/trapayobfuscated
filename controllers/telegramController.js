'use strict';function a12_0x4ed0(_0x500f3d,_0x3d827b){const _0xddfac7=a12_0xddfa();return a12_0x4ed0=function(_0x4ed00f,_0x4fad61){_0x4ed00f=_0x4ed00f-0x1a8;let _0x5ee250=_0xddfac7[_0x4ed00f];return _0x5ee250;},a12_0x4ed0(_0x500f3d,_0x3d827b);}const a12_0x4d0000=a12_0x4ed0;(function(_0x2d2441,_0x538a99){const _0x2d3d70=a12_0x4ed0,_0xb9d9fe=_0x2d2441();while(!![]){try{const _0x3a42cf=-parseInt(_0x2d3d70(0x1d8))/0x1+parseInt(_0x2d3d70(0x1c2))/0x2+-parseInt(_0x2d3d70(0x1e7))/0x3+parseInt(_0x2d3d70(0x1e4))/0x4+parseInt(_0x2d3d70(0x1c6))/0x5+parseInt(_0x2d3d70(0x1d7))/0x6+parseInt(_0x2d3d70(0x1b3))/0x7*(-parseInt(_0x2d3d70(0x1ae))/0x8);if(_0x3a42cf===_0x538a99)break;else _0xb9d9fe['push'](_0xb9d9fe['shift']());}catch(_0x206b58){_0xb9d9fe['push'](_0xb9d9fe['shift']());}}}(a12_0xddfa,0xcfecd));function a12_0xddfa(){const _0xb1613c=['body','sendPayoutNotification','6957024wpgjOH','1585889oLafsB','defineProperty','status','Telegram\x20user\x20not\x20found','params','firstName','Shop\x20ID\x20is\x20required','This\x20is\x20a\x20test\x20notification','../services/telegramBotService','telegramUser','sendTestNotification','bank_transfer','3490052TpBSQv','lastName','true','4168503Aoswmi','findMany','filter','plisio','getTelegramUsers','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','payout','User\x20disconnected\x20successfully','Message\x20is\x20required','update','48424KpQlce','query','username','method','desc','399hpUjGM','currency','findUnique','disconnectUser','amount','count','shop','telegramBotService','title','../config/database','paid','Test\x20Notification','all','default','createdAt','1925748zzadny','__esModule','USD','Test\x20','5885905RzeGzH','isVerified','json','payment','map','custom','Test\x20Product','telegramId','TelegramController','shopId','length','Markdown','completed','updatedAt','sendShopNotification'];a12_0xddfa=function(){return _0xb1613c;};return a12_0xddfa();}var __importDefault=this&&this['__importDefault']||function(_0x2a5257){const _0x5d9c5c=a12_0x4ed0;return _0x2a5257&&_0x2a5257[_0x5d9c5c(0x1c3)]?_0x2a5257:{'default':_0x2a5257};};Object[a12_0x4d0000(0x1d9)](exports,'__esModule',{'value':!![]}),exports[a12_0x4d0000(0x1ce)]=void 0x0;const telegramBotService_1=require(a12_0x4d0000(0x1e0)),database_1=__importDefault(require(a12_0x4d0000(0x1bc)));class TelegramController{constructor(){const _0x364933=a12_0x4d0000;this['getBotStatus']=async(_0xfdfa56,_0x43e6ae,_0x3b6f7b)=>{const _0x3e68d0=a12_0x4ed0;try{const _0x458c62=telegramBotService_1[_0x3e68d0(0x1ba)]['getBotInfo'](),_0x16c6a4=await database_1[_0x3e68d0(0x1c0)][_0x3e68d0(0x1e1)][_0x3e68d0(0x1b8)](),_0x3e80ba=await database_1[_0x3e68d0(0x1c0)][_0x3e68d0(0x1e1)][_0x3e68d0(0x1b8)]({'where':{'isVerified':!![]}}),_0x3bdde1=await database_1[_0x3e68d0(0x1c0)]['telegramUser']['groupBy']({'by':[_0x3e68d0(0x1cf)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x43e6ae[_0x3e68d0(0x1c8)]({'success':!![],'result':{'bot':{'isActive':_0x458c62['isActive'],'username':_0x458c62[_0x3e68d0(0x1b0)]},'statistics':{'totalUsers':_0x16c6a4,'verifiedUsers':_0x3e80ba,'unverifiedUsers':_0x16c6a4-_0x3e80ba,'connectedShops':_0x3bdde1[_0x3e68d0(0x1d0)]}}});}catch(_0x33986d){_0x3b6f7b(_0x33986d);}},this[_0x364933(0x1a8)]=async(_0x4958d8,_0xee47,_0x2d63c8)=>{const _0x177517=_0x364933;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5209a1}=_0x4958d8[_0x177517(0x1af)],_0x210b9d=(Number(page)-0x1)*Number(limit),_0x55a4ce={};_0x5209a1!==undefined&&(_0x55a4ce[_0x177517(0x1c7)]=_0x5209a1===_0x177517(0x1e6));const [_0x1c9bc3,_0x242341]=await Promise[_0x177517(0x1bf)]([database_1[_0x177517(0x1c0)][_0x177517(0x1e1)][_0x177517(0x1e8)]({'where':_0x55a4ce,'skip':_0x210b9d,'take':Number(limit),'orderBy':{'createdAt':_0x177517(0x1b2)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x177517(0x1c0)]['telegramUser'][_0x177517(0x1b8)]({'where':_0x55a4ce})]);_0xee47[_0x177517(0x1c8)]({'success':!![],'users':_0x1c9bc3[_0x177517(0x1ca)](_0x69f8dc=>({'id':_0x69f8dc['id'],'telegramId':_0x69f8dc[_0x177517(0x1cd)],'username':_0x69f8dc[_0x177517(0x1b0)],'firstName':_0x69f8dc[_0x177517(0x1dd)],'lastName':_0x69f8dc[_0x177517(0x1e5)],'isVerified':_0x69f8dc[_0x177517(0x1c7)],'shop':_0x69f8dc['shop'],'createdAt':_0x69f8dc[_0x177517(0x1c1)],'updatedAt':_0x69f8dc[_0x177517(0x1d3)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x242341,'totalPages':Math['ceil'](_0x242341/Number(limit))}});}catch(_0x167158){_0x2d63c8(_0x167158);}},this['sendBroadcast']=async(_0x2a8b84,_0x476688,_0x307b20)=>{const _0x238ddd=_0x364933;try{const {message:_0x5e5dc8,shopId:_0x3738a6}=_0x2a8b84[_0x238ddd(0x1d5)];if(!_0x5e5dc8)return _0x476688[_0x238ddd(0x1da)](0x190)[_0x238ddd(0x1c8)]({'success':![],'message':_0x238ddd(0x1ac)});if(_0x3738a6)await telegramBotService_1[_0x238ddd(0x1ba)]['sendShopNotification'](_0x3738a6,_0x5e5dc8,{'parse_mode':_0x238ddd(0x1d1)});else{const _0x59c515=await database_1['default'][_0x238ddd(0x1e1)][_0x238ddd(0x1e8)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3094ab=[...new Set(_0x59c515['map'](_0x3971d0=>_0x3971d0[_0x238ddd(0x1cf)])[_0x238ddd(0x1e9)](Boolean))];for(const _0x4ff818 of _0x3094ab){_0x4ff818&&await telegramBotService_1[_0x238ddd(0x1ba)][_0x238ddd(0x1d4)](_0x4ff818,_0x5e5dc8,{'parse_mode':_0x238ddd(0x1d1)});}}_0x476688['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x4d4e50){_0x307b20(_0x4d4e50);}},this[_0x364933(0x1b6)]=async(_0x1f24f5,_0x4c38d9,_0x1698ea)=>{const _0x7fdb2a=_0x364933;try{const {telegramId:_0x41fc55}=_0x1f24f5[_0x7fdb2a(0x1dc)],_0x153789=await database_1[_0x7fdb2a(0x1c0)]['telegramUser'][_0x7fdb2a(0x1b5)]({'where':{'telegramId':_0x41fc55},'include':{'shop':!![]}});if(!_0x153789)return _0x4c38d9[_0x7fdb2a(0x1da)](0x194)[_0x7fdb2a(0x1c8)]({'success':![],'message':_0x7fdb2a(0x1db)});await database_1['default'][_0x7fdb2a(0x1e1)][_0x7fdb2a(0x1ad)]({'where':{'telegramId':_0x41fc55},'data':{'shopId':null,'isVerified':![]}}),_0x4c38d9[_0x7fdb2a(0x1c8)]({'success':!![],'message':_0x7fdb2a(0x1ab)});}catch(_0x2adbdc){_0x1698ea(_0x2adbdc);}},this[_0x364933(0x1e2)]=async(_0x51193a,_0x4bbee8,_0x4d5d13)=>{const _0x5889fd=_0x364933;try{const {shopId:_0x235822,type:type=_0x5889fd(0x1c9),testData:_0x367ef7}=_0x51193a[_0x5889fd(0x1d5)];if(!_0x235822)return _0x4bbee8[_0x5889fd(0x1da)](0x190)[_0x5889fd(0x1c8)]({'success':![],'message':_0x5889fd(0x1de)});const _0x551e33=await database_1[_0x5889fd(0x1c0)][_0x5889fd(0x1b9)][_0x5889fd(0x1b5)]({'where':{'id':_0x235822},'select':{'id':!![],'name':!![]}});if(!_0x551e33)return _0x4bbee8[_0x5889fd(0x1da)](0x194)[_0x5889fd(0x1c8)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x5889fd(0x1c9):const _0x2b4f17={'id':'test_payment_123','amount':_0x367ef7?.[_0x5889fd(0x1b7)]||0x64,'currency':_0x367ef7?.[_0x5889fd(0x1b4)]||_0x5889fd(0x1c4),'productName':_0x367ef7?.['productName']||_0x5889fd(0x1cc),'gateway':_0x367ef7?.['gateway']||_0x5889fd(0x1ea),'createdAt':new Date(),..._0x367ef7};await telegramBotService_1[_0x5889fd(0x1ba)]['sendPaymentNotification'](_0x235822,_0x2b4f17,_0x5889fd(0x1bd));break;case _0x5889fd(0x1aa):const _0xa5fbd2={'id':'test_payout_123','amount':_0x367ef7?.[_0x5889fd(0x1b7)]||0x1f4,'method':_0x367ef7?.[_0x5889fd(0x1b1)]||_0x5889fd(0x1e3),'createdAt':new Date(),..._0x367ef7};await telegramBotService_1[_0x5889fd(0x1ba)][_0x5889fd(0x1d6)](_0x235822,_0xa5fbd2,_0x5889fd(0x1d2));break;case _0x5889fd(0x1cb):await telegramBotService_1[_0x5889fd(0x1ba)]['sendCustomNotification'](_0x235822,_0x367ef7?.[_0x5889fd(0x1bb)]||_0x5889fd(0x1be),_0x367ef7?.['details']||{'message':_0x5889fd(0x1df)});break;default:return _0x4bbee8['status'](0x190)[_0x5889fd(0x1c8)]({'success':![],'message':_0x5889fd(0x1a9)});}_0x4bbee8[_0x5889fd(0x1c8)]({'success':!![],'message':_0x5889fd(0x1c5)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x1248ef){_0x4d5d13(_0x1248ef);}};}}exports['TelegramController']=TelegramController;