'use strict';function a13_0x126f(_0x7d2867,_0x1e83a2){const _0x3f291d=a13_0x3f29();return a13_0x126f=function(_0x126fde,_0x5239ad){_0x126fde=_0x126fde-0xea;let _0x34732a=_0x3f291d[_0x126fde];return _0x34732a;},a13_0x126f(_0x7d2867,_0x1e83a2);}const a13_0x7e71e8=a13_0x126f;(function(_0x3eefda,_0x1db4e6){const _0x2c4f9c=a13_0x126f,_0x467c7b=_0x3eefda();while(!![]){try{const _0x3e5987=parseInt(_0x2c4f9c(0xff))/0x1*(-parseInt(_0x2c4f9c(0x119))/0x2)+parseInt(_0x2c4f9c(0x11d))/0x3*(-parseInt(_0x2c4f9c(0xf6))/0x4)+-parseInt(_0x2c4f9c(0xf9))/0x5*(-parseInt(_0x2c4f9c(0x118))/0x6)+-parseInt(_0x2c4f9c(0x108))/0x7*(-parseInt(_0x2c4f9c(0x12e))/0x8)+-parseInt(_0x2c4f9c(0xf8))/0x9*(-parseInt(_0x2c4f9c(0x102))/0xa)+parseInt(_0x2c4f9c(0xfa))/0xb+-parseInt(_0x2c4f9c(0x123))/0xc*(parseInt(_0x2c4f9c(0xef))/0xd);if(_0x3e5987===_0x1db4e6)break;else _0x467c7b['push'](_0x467c7b['shift']());}catch(_0x672e25){_0x467c7b['push'](_0x467c7b['shift']());}}}(a13_0x3f29,0xcca5e));var __importDefault=this&&this[a13_0x7e71e8(0x105)]||function(_0x492d7b){const _0x72614c=a13_0x7e71e8;return _0x492d7b&&_0x492d7b[_0x72614c(0x10e)]?_0x492d7b:{'default':_0x492d7b};};Object[a13_0x7e71e8(0x101)](exports,'__esModule',{'value':!![]}),exports[a13_0x7e71e8(0x10d)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x3ce11f=a13_0x7e71e8;this[_0x3ce11f(0x106)]=async(_0x314738,_0x3b5347,_0x291fd3)=>{const _0x58a862=_0x3ce11f;try{const _0x45dac6=telegramBotService_1['telegramBotService'][_0x58a862(0x10a)](),_0xca92f3=await database_1[_0x58a862(0x115)][_0x58a862(0x11f)]['count'](),_0x3c65ef=await database_1[_0x58a862(0x115)]['telegramUser'][_0x58a862(0xf3)]({'where':{'isVerified':!![]}}),_0x34e69d=await database_1[_0x58a862(0x115)][_0x58a862(0x11f)]['groupBy']({'by':[_0x58a862(0x121)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3b5347[_0x58a862(0xfc)]({'success':!![],'result':{'bot':{'isActive':_0x45dac6[_0x58a862(0x116)],'username':_0x45dac6['username']},'statistics':{'totalUsers':_0xca92f3,'verifiedUsers':_0x3c65ef,'unverifiedUsers':_0xca92f3-_0x3c65ef,'connectedShops':_0x34e69d['length']}}});}catch(_0x4a8f8c){_0x291fd3(_0x4a8f8c);}},this['getTelegramUsers']=async(_0x4e4487,_0x2e0277,_0x5d1e14)=>{const _0x129d89=_0x3ce11f;try{const {page:page=0x1,limit:limit=0x14,verified:_0xa66050}=_0x4e4487['query'],_0x4d55b3=(Number(page)-0x1)*Number(limit),_0x2e9d8b={};_0xa66050!==undefined&&(_0x2e9d8b[_0x129d89(0x125)]=_0xa66050===_0x129d89(0x10c));const [_0x56188b,_0x21caac]=await Promise[_0x129d89(0x126)]([database_1['default'][_0x129d89(0x11f)][_0x129d89(0x124)]({'where':_0x2e9d8b,'skip':_0x4d55b3,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x129d89(0x115)][_0x129d89(0x11f)][_0x129d89(0xf3)]({'where':_0x2e9d8b})]);_0x2e0277[_0x129d89(0xfc)]({'success':!![],'users':_0x56188b[_0x129d89(0xea)](_0x5b7f03=>({'id':_0x5b7f03['id'],'telegramId':_0x5b7f03[_0x129d89(0x122)],'username':_0x5b7f03[_0x129d89(0x12a)],'firstName':_0x5b7f03[_0x129d89(0x120)],'lastName':_0x5b7f03['lastName'],'isVerified':_0x5b7f03['isVerified'],'shop':_0x5b7f03['shop'],'createdAt':_0x5b7f03[_0x129d89(0x113)],'updatedAt':_0x5b7f03[_0x129d89(0xf7)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x21caac,'totalPages':Math['ceil'](_0x21caac/Number(limit))}});}catch(_0x47429a){_0x5d1e14(_0x47429a);}},this[_0x3ce11f(0xed)]=async(_0xa7b585,_0x394682,_0x4ba710)=>{const _0x12b0bd=_0x3ce11f;try{const {message:_0x108d39,shopId:_0x1a198e}=_0xa7b585[_0x12b0bd(0xfd)];if(!_0x108d39)return _0x394682[_0x12b0bd(0xeb)](0x190)[_0x12b0bd(0xfc)]({'success':![],'message':_0x12b0bd(0xfe)});if(_0x1a198e)await telegramBotService_1[_0x12b0bd(0xee)][_0x12b0bd(0x12f)](_0x1a198e,_0x108d39,{'parse_mode':'Markdown'});else{const _0x5c99f6=await database_1[_0x12b0bd(0x115)][_0x12b0bd(0x11f)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5ce051=[...new Set(_0x5c99f6[_0x12b0bd(0xea)](_0x50f70b=>_0x50f70b['shopId'])[_0x12b0bd(0x11e)](Boolean))];for(const _0x16246d of _0x5ce051){_0x16246d&&await telegramBotService_1['telegramBotService'][_0x12b0bd(0x12f)](_0x16246d,_0x108d39,{'parse_mode':_0x12b0bd(0x129)});}}_0x394682[_0x12b0bd(0xfc)]({'success':!![],'message':_0x12b0bd(0x12b)});}catch(_0x1d91b1){_0x4ba710(_0x1d91b1);}},this['disconnectUser']=async(_0x5d421a,_0x1f2250,_0x406e08)=>{const _0x2d334d=_0x3ce11f;try{const {telegramId:_0x27bc40}=_0x5d421a[_0x2d334d(0xf1)],_0x3cd23a=await database_1[_0x2d334d(0x115)][_0x2d334d(0x11f)][_0x2d334d(0x104)]({'where':{'telegramId':_0x27bc40},'include':{'shop':!![]}});if(!_0x3cd23a)return _0x1f2250[_0x2d334d(0xeb)](0x194)[_0x2d334d(0xfc)]({'success':![],'message':_0x2d334d(0x10f)});await database_1[_0x2d334d(0x115)][_0x2d334d(0x11f)]['update']({'where':{'telegramId':_0x27bc40},'data':{'shopId':null,'isVerified':![]}}),_0x1f2250[_0x2d334d(0xfc)]({'success':!![],'message':_0x2d334d(0x117)});}catch(_0x5524d3){_0x406e08(_0x5524d3);}},this[_0x3ce11f(0x11a)]=async(_0x201d62,_0x3fbe48,_0x71d363)=>{const _0x2171cf=_0x3ce11f;try{const {shopId:_0x1e3a3e,type:type=_0x2171cf(0x109),testData:_0x26ef91}=_0x201d62[_0x2171cf(0xfd)];if(!_0x1e3a3e)return _0x3fbe48['status'](0x190)[_0x2171cf(0xfc)]({'success':![],'message':_0x2171cf(0x100)});const _0x1e5fd8=await database_1['default']['shop']['findUnique']({'where':{'id':_0x1e3a3e},'select':{'id':!![],'name':!![]}});if(!_0x1e5fd8)return _0x3fbe48[_0x2171cf(0xeb)](0x194)[_0x2171cf(0xfc)]({'success':![],'message':_0x2171cf(0x112)});switch(type){case _0x2171cf(0x109):const _0x1e25ce={'id':_0x2171cf(0x11b),'amount':_0x26ef91?.[_0x2171cf(0x110)]||0x64,'currency':_0x26ef91?.[_0x2171cf(0xfb)]||_0x2171cf(0xf4),'productName':_0x26ef91?.[_0x2171cf(0x114)]||'Test\x20Product','gateway':_0x26ef91?.[_0x2171cf(0x107)]||'plisio','createdAt':new Date(),..._0x26ef91};await telegramBotService_1[_0x2171cf(0xee)]['sendPaymentNotification'](_0x1e3a3e,_0x1e25ce,_0x2171cf(0xf2));break;case _0x2171cf(0x11c):const _0x1dad7b={'id':'test_payout_123','amount':_0x26ef91?.[_0x2171cf(0x110)]||0x1f4,'method':_0x26ef91?.[_0x2171cf(0x111)]||_0x2171cf(0x127),'createdAt':new Date(),..._0x26ef91};await telegramBotService_1[_0x2171cf(0xee)]['sendPayoutNotification'](_0x1e3a3e,_0x1dad7b,_0x2171cf(0x103));break;case _0x2171cf(0x10b):await telegramBotService_1[_0x2171cf(0xee)][_0x2171cf(0x128)](_0x1e3a3e,_0x26ef91?.[_0x2171cf(0xf0)]||_0x2171cf(0x12c),_0x26ef91?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x3fbe48[_0x2171cf(0xeb)](0x190)[_0x2171cf(0xfc)]({'success':![],'message':_0x2171cf(0xec)});}_0x3fbe48[_0x2171cf(0xfc)]({'success':!![],'message':_0x2171cf(0x12d)+type+_0x2171cf(0xf5)});}catch(_0x57a2fa){_0x71d363(_0x57a2fa);}};}}exports['TelegramController']=TelegramController;function a13_0x3f29(){const _0x4db5dc=['telegramUser','firstName','shopId','telegramId','204mAviRs','findMany','isVerified','all','bank_transfer','sendCustomNotification','Markdown','username','Broadcast\x20message\x20sent\x20successfully','Test\x20Notification','Test\x20','16TISPsF','sendShopNotification','map','status','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','sendBroadcast','telegramBotService','1247857RSaqdl','title','params','paid','count','USD','\x20notification\x20sent\x20successfully','4tFFgYb','updatedAt','344268RxCRXL','65lhusZs','3394446YHWpGR','currency','json','body','Message\x20is\x20required','48813ykKxhX','Shop\x20ID\x20is\x20required','defineProperty','350dqeyOe','completed','findUnique','__importDefault','getBotStatus','gateway','5285560oSuzuS','payment','getBotInfo','custom','true','TelegramController','__esModule','Telegram\x20user\x20not\x20found','amount','method','Shop\x20not\x20found','createdAt','productName','default','isActive','User\x20disconnected\x20successfully','535962izstSz','22UZFkZw','sendTestNotification','test_payment_123','payout','3935469FdAYzH','filter'];a13_0x3f29=function(){return _0x4db5dc;};return a13_0x3f29();}