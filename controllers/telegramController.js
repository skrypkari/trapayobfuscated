'use strict';const a12_0xf945c7=a12_0x5594;(function(_0x574a59,_0x915635){const _0xa27898=a12_0x5594,_0x418acf=_0x574a59();while(!![]){try{const _0x4e190f=-parseInt(_0xa27898(0x1e4))/0x1*(parseInt(_0xa27898(0x1e2))/0x2)+parseInt(_0xa27898(0x1fe))/0x3*(-parseInt(_0xa27898(0x20f))/0x4)+parseInt(_0xa27898(0x212))/0x5+parseInt(_0xa27898(0x1dd))/0x6+-parseInt(_0xa27898(0x1f3))/0x7*(-parseInt(_0xa27898(0x201))/0x8)+-parseInt(_0xa27898(0x214))/0x9*(-parseInt(_0xa27898(0x209))/0xa)+-parseInt(_0xa27898(0x1de))/0xb;if(_0x4e190f===_0x915635)break;else _0x418acf['push'](_0x418acf['shift']());}catch(_0xf3f052){_0x418acf['push'](_0x418acf['shift']());}}}(a12_0x526a,0x7421f));var __importDefault=this&&this[a12_0xf945c7(0x200)]||function(_0x565a49){const _0x1b284=a12_0xf945c7;return _0x565a49&&_0x565a49[_0x1b284(0x204)]?_0x565a49:{'default':_0x565a49};};function a12_0x5594(_0x46d79c,_0xe60acf){const _0x526a7f=a12_0x526a();return a12_0x5594=function(_0x55947b,_0x27857c){_0x55947b=_0x55947b-0x1d0;let _0x400c48=_0x526a7f[_0x55947b];return _0x400c48;},a12_0x5594(_0x46d79c,_0xe60acf);}Object[a12_0xf945c7(0x1fb)](exports,'__esModule',{'value':!![]}),exports[a12_0xf945c7(0x1d5)]=void 0x0;const telegramBotService_1=require(a12_0xf945c7(0x1d3)),database_1=__importDefault(require('../config/database'));function a12_0x526a(){const _0x5ed320=['findMany','findUnique','4IdoQNP','test_payment_123','115903UzdONM','firstName','sendCustomNotification','desc','gateway','map','length','isVerified','payment','Shop\x20not\x20found','sendPayoutNotification','update','paid','getTelegramUsers','shopId','3591FViMjx','Markdown','Message\x20is\x20required','currency','\x20notification\x20sent\x20successfully','Shop\x20ID\x20is\x20required','lastName','custom','defineProperty','shop','sendShopNotification','231tofXok','User\x20disconnected\x20successfully','__importDefault','6824cPTOng','method','sendBroadcast','__esModule','bank_transfer','amount','body','getBotInfo','22800LCGmuT','createdAt','Telegram\x20user\x20not\x20found','USD','params','default','41332wyqITu','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','test_payout_123','2923760ngkFLB','Broadcast\x20message\x20sent\x20successfully','3285zlmFIr','Test\x20Product','telegramBotService','Test\x20','title','username','isActive','productName','../services/telegramBotService','status','TelegramController','completed','json','sendTestNotification','count','filter','disconnectUser','query','1021632qARZPC','5738557UHkyfE','telegramUser'];a12_0x526a=function(){return _0x5ed320;};return a12_0x526a();}class TelegramController{constructor(){const _0x2fb5b8=a12_0xf945c7;this['getBotStatus']=async(_0x4b7f62,_0x1c8dbd,_0x1f1d88)=>{const _0x35462c=a12_0x5594;try{const _0x34ce82=telegramBotService_1['telegramBotService'][_0x35462c(0x208)](),_0x34028e=await database_1[_0x35462c(0x20e)][_0x35462c(0x1df)][_0x35462c(0x1d9)](),_0x4596cb=await database_1['default'][_0x35462c(0x1df)]['count']({'where':{'isVerified':!![]}}),_0x37fa78=await database_1[_0x35462c(0x20e)][_0x35462c(0x1df)]['groupBy']({'by':[_0x35462c(0x1f2)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1c8dbd['json']({'success':!![],'result':{'bot':{'isActive':_0x34ce82[_0x35462c(0x1d1)],'username':_0x34ce82[_0x35462c(0x1d0)]},'statistics':{'totalUsers':_0x34028e,'verifiedUsers':_0x4596cb,'unverifiedUsers':_0x34028e-_0x4596cb,'connectedShops':_0x37fa78[_0x35462c(0x1ea)]}}});}catch(_0x58b41c){_0x1f1d88(_0x58b41c);}},this[_0x2fb5b8(0x1f1)]=async(_0x32d848,_0x4e6906,_0x2d3940)=>{const _0x360bc2=_0x2fb5b8;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1d4a89}=_0x32d848[_0x360bc2(0x1dc)],_0x278626=(Number(page)-0x1)*Number(limit),_0x91f058={};_0x1d4a89!==undefined&&(_0x91f058[_0x360bc2(0x1eb)]=_0x1d4a89==='true');const [_0x4c0366,_0x5dea33]=await Promise['all']([database_1[_0x360bc2(0x20e)][_0x360bc2(0x1df)][_0x360bc2(0x1e0)]({'where':_0x91f058,'skip':_0x278626,'take':Number(limit),'orderBy':{'createdAt':_0x360bc2(0x1e7)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x360bc2(0x20e)][_0x360bc2(0x1df)][_0x360bc2(0x1d9)]({'where':_0x91f058})]);_0x4e6906['json']({'success':!![],'users':_0x4c0366[_0x360bc2(0x1e9)](_0x7ef289=>({'id':_0x7ef289['id'],'telegramId':_0x7ef289['telegramId'],'username':_0x7ef289[_0x360bc2(0x1d0)],'firstName':_0x7ef289[_0x360bc2(0x1e5)],'lastName':_0x7ef289[_0x360bc2(0x1f9)],'isVerified':_0x7ef289[_0x360bc2(0x1eb)],'shop':_0x7ef289[_0x360bc2(0x1fc)],'createdAt':_0x7ef289[_0x360bc2(0x20a)],'updatedAt':_0x7ef289['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5dea33,'totalPages':Math['ceil'](_0x5dea33/Number(limit))}});}catch(_0x1605de){_0x2d3940(_0x1605de);}},this[_0x2fb5b8(0x203)]=async(_0x23b21b,_0x3c9658,_0x35162a)=>{const _0x532b1c=_0x2fb5b8;try{const {message:_0x58d717,shopId:_0x351ece}=_0x23b21b['body'];if(!_0x58d717)return _0x3c9658['status'](0x190)[_0x532b1c(0x1d7)]({'success':![],'message':_0x532b1c(0x1f5)});if(_0x351ece)await telegramBotService_1[_0x532b1c(0x216)][_0x532b1c(0x1fd)](_0x351ece,_0x58d717,{'parse_mode':_0x532b1c(0x1f4)});else{const _0x1a79b3=await database_1[_0x532b1c(0x20e)]['telegramUser'][_0x532b1c(0x1e0)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x17614d=[...new Set(_0x1a79b3[_0x532b1c(0x1e9)](_0x4b1977=>_0x4b1977['shopId'])[_0x532b1c(0x1da)](Boolean))];for(const _0x3ade65 of _0x17614d){_0x3ade65&&await telegramBotService_1['telegramBotService'][_0x532b1c(0x1fd)](_0x3ade65,_0x58d717,{'parse_mode':_0x532b1c(0x1f4)});}}_0x3c9658[_0x532b1c(0x1d7)]({'success':!![],'message':_0x532b1c(0x213)});}catch(_0x4cd9ab){_0x35162a(_0x4cd9ab);}},this[_0x2fb5b8(0x1db)]=async(_0x9ae4f5,_0x547571,_0x349b35)=>{const _0x2348af=_0x2fb5b8;try{const {telegramId:_0x5700ca}=_0x9ae4f5[_0x2348af(0x20d)],_0x307f91=await database_1[_0x2348af(0x20e)][_0x2348af(0x1df)][_0x2348af(0x1e1)]({'where':{'telegramId':_0x5700ca},'include':{'shop':!![]}});if(!_0x307f91)return _0x547571[_0x2348af(0x1d4)](0x194)[_0x2348af(0x1d7)]({'success':![],'message':_0x2348af(0x20b)});await database_1[_0x2348af(0x20e)][_0x2348af(0x1df)][_0x2348af(0x1ef)]({'where':{'telegramId':_0x5700ca},'data':{'shopId':null,'isVerified':![]}}),_0x547571[_0x2348af(0x1d7)]({'success':!![],'message':_0x2348af(0x1ff)});}catch(_0xe4ee66){_0x349b35(_0xe4ee66);}},this[_0x2fb5b8(0x1d8)]=async(_0x3d910f,_0x593f83,_0x5ecccd)=>{const _0x29ab4e=_0x2fb5b8;try{const {shopId:_0x37a0e8,type:type='payment',testData:_0x1dea04}=_0x3d910f[_0x29ab4e(0x207)];if(!_0x37a0e8)return _0x593f83[_0x29ab4e(0x1d4)](0x190)['json']({'success':![],'message':_0x29ab4e(0x1f8)});const _0x29c121=await database_1['default'][_0x29ab4e(0x1fc)][_0x29ab4e(0x1e1)]({'where':{'id':_0x37a0e8},'select':{'id':!![],'name':!![]}});if(!_0x29c121)return _0x593f83['status'](0x194)[_0x29ab4e(0x1d7)]({'success':![],'message':_0x29ab4e(0x1ed)});switch(type){case _0x29ab4e(0x1ec):const _0x20f3dd={'id':_0x29ab4e(0x1e3),'amount':_0x1dea04?.[_0x29ab4e(0x206)]||0x64,'currency':_0x1dea04?.[_0x29ab4e(0x1f6)]||_0x29ab4e(0x20c),'productName':_0x1dea04?.[_0x29ab4e(0x1d2)]||_0x29ab4e(0x215),'gateway':_0x1dea04?.[_0x29ab4e(0x1e8)]||'plisio','createdAt':new Date(),..._0x1dea04};await telegramBotService_1[_0x29ab4e(0x216)]['sendPaymentNotification'](_0x37a0e8,_0x20f3dd,_0x29ab4e(0x1f0));break;case'payout':const _0x421016={'id':_0x29ab4e(0x211),'amount':_0x1dea04?.[_0x29ab4e(0x206)]||0x1f4,'method':_0x1dea04?.[_0x29ab4e(0x202)]||_0x29ab4e(0x205),'createdAt':new Date(),..._0x1dea04};await telegramBotService_1[_0x29ab4e(0x216)][_0x29ab4e(0x1ee)](_0x37a0e8,_0x421016,_0x29ab4e(0x1d6));break;case _0x29ab4e(0x1fa):await telegramBotService_1[_0x29ab4e(0x216)][_0x29ab4e(0x1e6)](_0x37a0e8,_0x1dea04?.[_0x29ab4e(0x218)]||'Test\x20Notification',_0x1dea04?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x593f83[_0x29ab4e(0x1d4)](0x190)['json']({'success':![],'message':_0x29ab4e(0x210)});}_0x593f83[_0x29ab4e(0x1d7)]({'success':!![],'message':_0x29ab4e(0x217)+type+_0x29ab4e(0x1f7)});}catch(_0x1f58a5){_0x5ecccd(_0x1f58a5);}};}}exports['TelegramController']=TelegramController;