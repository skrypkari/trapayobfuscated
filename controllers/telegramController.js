'use strict';const a12_0x293318=a12_0x4f00;(function(_0x1d8c6a,_0x4d55e2){const _0x495ced=a12_0x4f00,_0x668c75=_0x1d8c6a();while(!![]){try{const _0x37dea1=parseInt(_0x495ced(0x1cc))/0x1+parseInt(_0x495ced(0x1c1))/0x2*(parseInt(_0x495ced(0x1b0))/0x3)+-parseInt(_0x495ced(0x1cb))/0x4+parseInt(_0x495ced(0x19c))/0x5+-parseInt(_0x495ced(0x1db))/0x6+-parseInt(_0x495ced(0x1a2))/0x7*(-parseInt(_0x495ced(0x1a3))/0x8)+-parseInt(_0x495ced(0x1c8))/0x9;if(_0x37dea1===_0x4d55e2)break;else _0x668c75['push'](_0x668c75['shift']());}catch(_0x214816){_0x668c75['push'](_0x668c75['shift']());}}}(a12_0x7c7a,0x4bd3e));var __importDefault=this&&this[a12_0x293318(0x1c3)]||function(_0x5bb75d){return _0x5bb75d&&_0x5bb75d['__esModule']?_0x5bb75d:{'default':_0x5bb75d};};function a12_0x4f00(_0x1441e9,_0x37a503){const _0x7c7a81=a12_0x7c7a();return a12_0x4f00=function(_0x4f0023,_0x3ccc04){_0x4f0023=_0x4f0023-0x19b;let _0x420fe9=_0x7c7a81[_0x4f0023];return _0x420fe9;},a12_0x4f00(_0x1441e9,_0x37a503);}Object['defineProperty'](exports,a12_0x293318(0x1cd),{'value':!![]}),exports[a12_0x293318(0x1da)]=void 0x0;const telegramBotService_1=require(a12_0x293318(0x1b1)),database_1=__importDefault(require(a12_0x293318(0x1ae)));class TelegramController{constructor(){const _0x1145b6=a12_0x293318;this[_0x1145b6(0x1a0)]=async(_0x4a98e0,_0x2f796a,_0xe5f7c4)=>{const _0x54596e=_0x1145b6;try{const _0x3a5577=telegramBotService_1[_0x54596e(0x1b4)][_0x54596e(0x1c2)](),_0x2a5873=await database_1[_0x54596e(0x1ad)][_0x54596e(0x19f)][_0x54596e(0x1aa)](),_0x590816=await database_1[_0x54596e(0x1ad)][_0x54596e(0x19f)][_0x54596e(0x1aa)]({'where':{'isVerified':!![]}}),_0x5578b1=await database_1[_0x54596e(0x1ad)][_0x54596e(0x19f)][_0x54596e(0x1b9)]({'by':[_0x54596e(0x1ac)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2f796a[_0x54596e(0x1d1)]({'success':!![],'result':{'bot':{'isActive':_0x3a5577[_0x54596e(0x1be)],'username':_0x3a5577['username']},'statistics':{'totalUsers':_0x2a5873,'verifiedUsers':_0x590816,'unverifiedUsers':_0x2a5873-_0x590816,'connectedShops':_0x5578b1['length']}}});}catch(_0x122fe6){_0xe5f7c4(_0x122fe6);}},this[_0x1145b6(0x1d8)]=async(_0x2770a0,_0x5a6f1c,_0x16a970)=>{const _0x22248e=_0x1145b6;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3157c4}=_0x2770a0[_0x22248e(0x1d0)],_0x360688=(Number(page)-0x1)*Number(limit),_0x4c5508={};_0x3157c4!==undefined&&(_0x4c5508[_0x22248e(0x1bb)]=_0x3157c4===_0x22248e(0x1dc));const [_0x5c8318,_0x18f5b9]=await Promise[_0x22248e(0x1ca)]([database_1[_0x22248e(0x1ad)][_0x22248e(0x19f)][_0x22248e(0x1d6)]({'where':_0x4c5508,'skip':_0x360688,'take':Number(limit),'orderBy':{'createdAt':_0x22248e(0x1bd)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x22248e(0x1ad)][_0x22248e(0x19f)][_0x22248e(0x1aa)]({'where':_0x4c5508})]);_0x5a6f1c[_0x22248e(0x1d1)]({'success':!![],'users':_0x5c8318[_0x22248e(0x19e)](_0x2ff64b=>({'id':_0x2ff64b['id'],'telegramId':_0x2ff64b[_0x22248e(0x1d4)],'username':_0x2ff64b[_0x22248e(0x1c0)],'firstName':_0x2ff64b[_0x22248e(0x1c5)],'lastName':_0x2ff64b['lastName'],'isVerified':_0x2ff64b['isVerified'],'shop':_0x2ff64b['shop'],'createdAt':_0x2ff64b[_0x22248e(0x1b5)],'updatedAt':_0x2ff64b[_0x22248e(0x1a7)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x18f5b9,'totalPages':Math[_0x22248e(0x1a5)](_0x18f5b9/Number(limit))}});}catch(_0x4088af){_0x16a970(_0x4088af);}},this[_0x1145b6(0x19b)]=async(_0x199a14,_0x598c10,_0x10d726)=>{const _0x15da47=_0x1145b6;try{const {message:_0x3b39ca,shopId:_0x25eae1}=_0x199a14[_0x15da47(0x1a1)];if(!_0x3b39ca)return _0x598c10['status'](0x190)[_0x15da47(0x1d1)]({'success':![],'message':_0x15da47(0x1a6)});if(_0x25eae1)await telegramBotService_1[_0x15da47(0x1b4)]['sendShopNotification'](_0x25eae1,_0x3b39ca,{'parse_mode':_0x15da47(0x1d7)});else{const _0x3ace8b=await database_1[_0x15da47(0x1ad)][_0x15da47(0x19f)][_0x15da47(0x1d6)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xffab45=[...new Set(_0x3ace8b[_0x15da47(0x19e)](_0x2c8537=>_0x2c8537[_0x15da47(0x1ac)])['filter'](Boolean))];for(const _0x189ea6 of _0xffab45){_0x189ea6&&await telegramBotService_1[_0x15da47(0x1b4)][_0x15da47(0x1c4)](_0x189ea6,_0x3b39ca,{'parse_mode':_0x15da47(0x1d7)});}}_0x598c10[_0x15da47(0x1d1)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x36be6c){_0x10d726(_0x36be6c);}},this[_0x1145b6(0x1b2)]=async(_0x4b0c9e,_0x48bc2d,_0x3a2071)=>{const _0xdc958=_0x1145b6;try{const {telegramId:_0x4f2053}=_0x4b0c9e[_0xdc958(0x1a8)],_0x1e6339=await database_1[_0xdc958(0x1ad)]['telegramUser']['findUnique']({'where':{'telegramId':_0x4f2053},'include':{'shop':!![]}});if(!_0x1e6339)return _0x48bc2d[_0xdc958(0x1dd)](0x194)[_0xdc958(0x1d1)]({'success':![],'message':_0xdc958(0x1a9)});await database_1[_0xdc958(0x1ad)][_0xdc958(0x19f)][_0xdc958(0x1a4)]({'where':{'telegramId':_0x4f2053},'data':{'shopId':null,'isVerified':![]}}),_0x48bc2d['json']({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x49d6d7){_0x3a2071(_0x49d6d7);}},this['sendTestNotification']=async(_0x6c45e0,_0x7aa3fe,_0x5229d7)=>{const _0xe569db=_0x1145b6;try{const {shopId:_0x47d8d2,type:type=_0xe569db(0x1b8),testData:_0x35fa29}=_0x6c45e0[_0xe569db(0x1a1)];if(!_0x47d8d2)return _0x7aa3fe[_0xe569db(0x1dd)](0x190)[_0xe569db(0x1d1)]({'success':![],'message':_0xe569db(0x1c6)});const _0x4d2ca9=await database_1[_0xe569db(0x1ad)][_0xe569db(0x1ba)][_0xe569db(0x1b7)]({'where':{'id':_0x47d8d2},'select':{'id':!![],'name':!![]}});if(!_0x4d2ca9)return _0x7aa3fe[_0xe569db(0x1dd)](0x194)['json']({'success':![],'message':_0xe569db(0x1de)});switch(type){case _0xe569db(0x1b8):const _0x1130fe={'id':_0xe569db(0x1af),'amount':_0x35fa29?.[_0xe569db(0x1ab)]||0x64,'currency':_0x35fa29?.['currency']||'USD','productName':_0x35fa29?.['productName']||'Test\x20Product','gateway':_0x35fa29?.['gateway']||_0xe569db(0x1c7),'createdAt':new Date(),..._0x35fa29};await telegramBotService_1[_0xe569db(0x1b4)][_0xe569db(0x1d3)](_0x47d8d2,_0x1130fe,_0xe569db(0x1c9));break;case _0xe569db(0x1d5):const _0x350c21={'id':'test_payout_123','amount':_0x35fa29?.['amount']||0x1f4,'method':_0x35fa29?.[_0xe569db(0x1b3)]||_0xe569db(0x19d),'createdAt':new Date(),..._0x35fa29};await telegramBotService_1[_0xe569db(0x1b4)][_0xe569db(0x1d2)](_0x47d8d2,_0x350c21,_0xe569db(0x1cf));break;case _0xe569db(0x1bc):await telegramBotService_1[_0xe569db(0x1b4)]['sendCustomNotification'](_0x47d8d2,_0x35fa29?.[_0xe569db(0x1ce)]||'Test\x20Notification',_0x35fa29?.['details']||{'message':_0xe569db(0x1d9)});break;default:return _0x7aa3fe[_0xe569db(0x1dd)](0x190)[_0xe569db(0x1d1)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x7aa3fe[_0xe569db(0x1d1)]({'success':!![],'message':_0xe569db(0x1b6)+type+_0xe569db(0x1bf)});}catch(_0x124158){_0x5229d7(_0x124158);}};}}function a12_0x7c7a(){const _0x1358b6=['payout','findMany','Markdown','getTelegramUsers','This\x20is\x20a\x20test\x20notification','TelegramController','3572142pTCLsg','true','status','Shop\x20not\x20found','sendBroadcast','2879360qFpxCk','bank_transfer','map','telegramUser','getBotStatus','body','1833167BmzWTp','8rhCaSW','update','ceil','Message\x20is\x20required','updatedAt','params','Telegram\x20user\x20not\x20found','count','amount','shopId','default','../config/database','test_payment_123','15oZlFmO','../services/telegramBotService','disconnectUser','method','telegramBotService','createdAt','Test\x20','findUnique','payment','groupBy','shop','isVerified','custom','desc','isActive','\x20notification\x20sent\x20successfully','username','207926IWRKar','getBotInfo','__importDefault','sendShopNotification','firstName','Shop\x20ID\x20is\x20required','plisio','5234391vrLsJS','paid','all','1098564sIVnod','404619rhBgYI','__esModule','title','completed','query','json','sendPayoutNotification','sendPaymentNotification','telegramId'];a12_0x7c7a=function(){return _0x1358b6;};return a12_0x7c7a();}exports[a12_0x293318(0x1da)]=TelegramController;