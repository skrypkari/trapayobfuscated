'use strict';const a12_0x625941=a12_0x37b2;(function(_0x30a587,_0x299f15){const _0x4c440b=a12_0x37b2,_0x832321=_0x30a587();while(!![]){try{const _0x36c8c7=parseInt(_0x4c440b(0x1fe))/0x1+parseInt(_0x4c440b(0x1de))/0x2+parseInt(_0x4c440b(0x211))/0x3+-parseInt(_0x4c440b(0x1e2))/0x4*(parseInt(_0x4c440b(0x1f2))/0x5)+-parseInt(_0x4c440b(0x1d4))/0x6*(parseInt(_0x4c440b(0x1f7))/0x7)+parseInt(_0x4c440b(0x1e3))/0x8+parseInt(_0x4c440b(0x1f4))/0x9*(-parseInt(_0x4c440b(0x205))/0xa);if(_0x36c8c7===_0x299f15)break;else _0x832321['push'](_0x832321['shift']());}catch(_0x1fd8c6){_0x832321['push'](_0x832321['shift']());}}}(a12_0x4ea4,0xc551e));function a12_0x4ea4(){const _0x1885c9=['2800524AXoKkP','length','filter','telegramBotService','3596fYRMVx','7646216Piaiue','findMany','../services/telegramBotService','gateway','paid','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Shop\x20not\x20found','plisio','findUnique','isVerified','test_payout_123','amount','../config/database','Broadcast\x20message\x20sent\x20successfully','method','8055efYrxN','getBotInfo','54SaWBAL','status','true','434vxXihO','Test\x20','all','currency','shopId','createdAt','details','445906jYQwbf','__importDefault','groupBy','count','getTelegramUsers','payout','completed','1848430mayOXp','getBotStatus','payment','custom','This\x20is\x20a\x20test\x20notification','body','USD','telegramUser','defineProperty','json','sendCustomNotification','telegramId','4828878OwIkqN','update','Test\x20Product','test_payment_123','title','default','bank_transfer','__esModule','disconnectUser','desc','101226ppDRTZ','sendShopNotification','params','TelegramController','Shop\x20ID\x20is\x20required','sendBroadcast','map','username','shop','query'];a12_0x4ea4=function(){return _0x1885c9;};return a12_0x4ea4();}var __importDefault=this&&this[a12_0x625941(0x1ff)]||function(_0x400e96){const _0x392425=a12_0x625941;return _0x400e96&&_0x400e96[_0x392425(0x1d1)]?_0x400e96:{'default':_0x400e96};};function a12_0x37b2(_0x39a997,_0x3f8643){const _0x4ea45b=a12_0x4ea4();return a12_0x37b2=function(_0x37b212,_0x7542f4){_0x37b212=_0x37b212-0x1d1;let _0x318d03=_0x4ea45b[_0x37b212];return _0x318d03;},a12_0x37b2(_0x39a997,_0x3f8643);}Object[a12_0x625941(0x20d)](exports,'__esModule',{'value':!![]}),exports[a12_0x625941(0x1d7)]=void 0x0;const telegramBotService_1=require(a12_0x625941(0x1e5)),database_1=__importDefault(require(a12_0x625941(0x1ef)));class TelegramController{constructor(){const _0x59c233=a12_0x625941;this[_0x59c233(0x206)]=async(_0x8b861c,_0x307f81,_0x399db9)=>{const _0xcada2c=_0x59c233;try{const _0x495e7f=telegramBotService_1[_0xcada2c(0x1e1)][_0xcada2c(0x1f3)](),_0x383ebc=await database_1[_0xcada2c(0x216)][_0xcada2c(0x20c)][_0xcada2c(0x201)](),_0x5f16e3=await database_1[_0xcada2c(0x216)][_0xcada2c(0x20c)]['count']({'where':{'isVerified':!![]}}),_0x519e46=await database_1['default'][_0xcada2c(0x20c)][_0xcada2c(0x200)]({'by':[_0xcada2c(0x1fb)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x307f81[_0xcada2c(0x20e)]({'success':!![],'result':{'bot':{'isActive':_0x495e7f['isActive'],'username':_0x495e7f[_0xcada2c(0x1db)]},'statistics':{'totalUsers':_0x383ebc,'verifiedUsers':_0x5f16e3,'unverifiedUsers':_0x383ebc-_0x5f16e3,'connectedShops':_0x519e46[_0xcada2c(0x1df)]}}});}catch(_0x40eae2){_0x399db9(_0x40eae2);}},this[_0x59c233(0x202)]=async(_0x410770,_0x1fa7e4,_0x2579b4)=>{const _0x5f8195=_0x59c233;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3e7b5d}=_0x410770[_0x5f8195(0x1dd)],_0x84e504=(Number(page)-0x1)*Number(limit),_0xaf914={};_0x3e7b5d!==undefined&&(_0xaf914[_0x5f8195(0x1ec)]=_0x3e7b5d===_0x5f8195(0x1f6));const [_0x2949db,_0x13b613]=await Promise[_0x5f8195(0x1f9)]([database_1[_0x5f8195(0x216)][_0x5f8195(0x20c)][_0x5f8195(0x1e4)]({'where':_0xaf914,'skip':_0x84e504,'take':Number(limit),'orderBy':{'createdAt':_0x5f8195(0x1d3)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5f8195(0x216)][_0x5f8195(0x20c)][_0x5f8195(0x201)]({'where':_0xaf914})]);_0x1fa7e4['json']({'success':!![],'users':_0x2949db[_0x5f8195(0x1da)](_0x1a56e8=>({'id':_0x1a56e8['id'],'telegramId':_0x1a56e8[_0x5f8195(0x210)],'username':_0x1a56e8[_0x5f8195(0x1db)],'firstName':_0x1a56e8['firstName'],'lastName':_0x1a56e8['lastName'],'isVerified':_0x1a56e8[_0x5f8195(0x1ec)],'shop':_0x1a56e8['shop'],'createdAt':_0x1a56e8[_0x5f8195(0x1fc)],'updatedAt':_0x1a56e8['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x13b613,'totalPages':Math['ceil'](_0x13b613/Number(limit))}});}catch(_0x349ca9){_0x2579b4(_0x349ca9);}},this[_0x59c233(0x1d9)]=async(_0x5465a8,_0x315aaf,_0x442864)=>{const _0xfbcf94=_0x59c233;try{const {message:_0x1e57e0,shopId:_0x385be5}=_0x5465a8['body'];if(!_0x1e57e0)return _0x315aaf[_0xfbcf94(0x1f5)](0x190)[_0xfbcf94(0x20e)]({'success':![],'message':'Message\x20is\x20required'});if(_0x385be5)await telegramBotService_1['telegramBotService'][_0xfbcf94(0x1d5)](_0x385be5,_0x1e57e0,{'parse_mode':'Markdown'});else{const _0x1de504=await database_1[_0xfbcf94(0x216)][_0xfbcf94(0x20c)][_0xfbcf94(0x1e4)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3d27ef=[...new Set(_0x1de504[_0xfbcf94(0x1da)](_0xcbfd1=>_0xcbfd1['shopId'])[_0xfbcf94(0x1e0)](Boolean))];for(const _0x4f51cb of _0x3d27ef){_0x4f51cb&&await telegramBotService_1[_0xfbcf94(0x1e1)][_0xfbcf94(0x1d5)](_0x4f51cb,_0x1e57e0,{'parse_mode':'Markdown'});}}_0x315aaf[_0xfbcf94(0x20e)]({'success':!![],'message':_0xfbcf94(0x1f0)});}catch(_0x82e9ae){_0x442864(_0x82e9ae);}},this[_0x59c233(0x1d2)]=async(_0x5e9f2a,_0x506c6f,_0x29aa82)=>{const _0x270a9d=_0x59c233;try{const {telegramId:_0x3934f4}=_0x5e9f2a[_0x270a9d(0x1d6)],_0x34c7ba=await database_1['default'][_0x270a9d(0x20c)][_0x270a9d(0x1eb)]({'where':{'telegramId':_0x3934f4},'include':{'shop':!![]}});if(!_0x34c7ba)return _0x506c6f[_0x270a9d(0x1f5)](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x270a9d(0x20c)][_0x270a9d(0x212)]({'where':{'telegramId':_0x3934f4},'data':{'shopId':null,'isVerified':![]}}),_0x506c6f[_0x270a9d(0x20e)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x116e00){_0x29aa82(_0x116e00);}},this['sendTestNotification']=async(_0x1fc177,_0x124a47,_0x286007)=>{const _0x3a3a47=_0x59c233;try{const {shopId:_0x205d95,type:type=_0x3a3a47(0x207),testData:_0x477f1e}=_0x1fc177[_0x3a3a47(0x20a)];if(!_0x205d95)return _0x124a47[_0x3a3a47(0x1f5)](0x190)[_0x3a3a47(0x20e)]({'success':![],'message':_0x3a3a47(0x1d8)});const _0xdaf60e=await database_1[_0x3a3a47(0x216)][_0x3a3a47(0x1dc)]['findUnique']({'where':{'id':_0x205d95},'select':{'id':!![],'name':!![]}});if(!_0xdaf60e)return _0x124a47['status'](0x194)['json']({'success':![],'message':_0x3a3a47(0x1e9)});switch(type){case _0x3a3a47(0x207):const _0x22e6e5={'id':_0x3a3a47(0x214),'amount':_0x477f1e?.[_0x3a3a47(0x1ee)]||0x64,'currency':_0x477f1e?.[_0x3a3a47(0x1fa)]||_0x3a3a47(0x20b),'productName':_0x477f1e?.['productName']||_0x3a3a47(0x213),'gateway':_0x477f1e?.[_0x3a3a47(0x1e6)]||_0x3a3a47(0x1ea),'createdAt':new Date(),..._0x477f1e};await telegramBotService_1[_0x3a3a47(0x1e1)]['sendPaymentNotification'](_0x205d95,_0x22e6e5,_0x3a3a47(0x1e7));break;case _0x3a3a47(0x203):const _0xac862b={'id':_0x3a3a47(0x1ed),'amount':_0x477f1e?.['amount']||0x1f4,'method':_0x477f1e?.[_0x3a3a47(0x1f1)]||_0x3a3a47(0x217),'createdAt':new Date(),..._0x477f1e};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x205d95,_0xac862b,_0x3a3a47(0x204));break;case _0x3a3a47(0x208):await telegramBotService_1[_0x3a3a47(0x1e1)][_0x3a3a47(0x20f)](_0x205d95,_0x477f1e?.[_0x3a3a47(0x215)]||'Test\x20Notification',_0x477f1e?.[_0x3a3a47(0x1fd)]||{'message':_0x3a3a47(0x209)});break;default:return _0x124a47[_0x3a3a47(0x1f5)](0x190)['json']({'success':![],'message':_0x3a3a47(0x1e8)});}_0x124a47['json']({'success':!![],'message':_0x3a3a47(0x1f8)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x44ff01){_0x286007(_0x44ff01);}};}}exports[a12_0x625941(0x1d7)]=TelegramController;