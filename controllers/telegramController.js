'use strict';const a12_0x468a9e=a12_0x5e1e;(function(_0x13c2e0,_0x5b83b3){const _0x49dd3d=a12_0x5e1e,_0x561a81=_0x13c2e0();while(!![]){try{const _0x979897=parseInt(_0x49dd3d(0x133))/0x1+-parseInt(_0x49dd3d(0x143))/0x2*(parseInt(_0x49dd3d(0x123))/0x3)+parseInt(_0x49dd3d(0x105))/0x4*(parseInt(_0x49dd3d(0x101))/0x5)+parseInt(_0x49dd3d(0x144))/0x6+parseInt(_0x49dd3d(0x126))/0x7*(parseInt(_0x49dd3d(0x12b))/0x8)+-parseInt(_0x49dd3d(0x112))/0x9+parseInt(_0x49dd3d(0x141))/0xa*(-parseInt(_0x49dd3d(0x115))/0xb);if(_0x979897===_0x5b83b3)break;else _0x561a81['push'](_0x561a81['shift']());}catch(_0x3dc53c){_0x561a81['push'](_0x561a81['shift']());}}}(a12_0x4dae,0x64296));var __importDefault=this&&this[a12_0x468a9e(0x131)]||function(_0x2ff56d){const _0x49aecd=a12_0x468a9e;return _0x2ff56d&&_0x2ff56d[_0x49aecd(0x137)]?_0x2ff56d:{'default':_0x2ff56d};};Object[a12_0x468a9e(0x10b)](exports,a12_0x468a9e(0x137),{'value':!![]}),exports[a12_0x468a9e(0x11e)]=void 0x0;function a12_0x5e1e(_0x4c870c,_0x2b35f9){const _0x4daee1=a12_0x4dae();return a12_0x5e1e=function(_0x5e1ee3,_0x52fef3){_0x5e1ee3=_0x5e1ee3-0xfa;let _0x28f3a5=_0x4daee1[_0x5e1ee3];return _0x28f3a5;},a12_0x5e1e(_0x4c870c,_0x2b35f9);}function a12_0x4dae(){const _0x1a8fbf=['telegramBotService','User\x20disconnected\x20successfully','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','username','741JDoYim','sendShopNotification','isActive','358841WWKblI','sendPaymentNotification','../services/telegramBotService','sendPayoutNotification','sendCustomNotification','120QxVHuf','title','test_payment_123','Test\x20Notification','length','desc','__importDefault','findUnique','191261CdyPQE','true','Shop\x20ID\x20is\x20required','Telegram\x20user\x20not\x20found','__esModule','getTelegramUsers','bank_transfer','ceil','body','query','update','createdAt','telegramUser','This\x20is\x20a\x20test\x20notification','410LeBVQA','Markdown','4514AbkcOR','1992294LLsNya','payout','json','getBotStatus','USD','isVerified','findMany','map','../config/database','5BMfxIN','telegramId','\x20notification\x20sent\x20successfully','Test\x20','3136504eupamN','method','shopId','filter','shop','updatedAt','defineProperty','status','amount','paid','completed','details','count','3037239pkhFDv','productName','plisio','206899OOXDzF','gateway','payment','currency','Test\x20Product','Broadcast\x20message\x20sent\x20successfully','lastName','Shop\x20not\x20found','default','TelegramController'];a12_0x4dae=function(){return _0x1a8fbf;};return a12_0x4dae();}const telegramBotService_1=require(a12_0x468a9e(0x128)),database_1=__importDefault(require(a12_0x468a9e(0x100)));class TelegramController{constructor(){const _0x12ad31=a12_0x468a9e;this[_0x12ad31(0xfb)]=async(_0x3433d9,_0x196f09,_0x368abd)=>{const _0x2afbc8=_0x12ad31;try{const _0x2de87c=telegramBotService_1['telegramBotService']['getBotInfo'](),_0x37f38f=await database_1[_0x2afbc8(0x11d)]['telegramUser'][_0x2afbc8(0x111)](),_0x24461b=await database_1[_0x2afbc8(0x11d)]['telegramUser'][_0x2afbc8(0x111)]({'where':{'isVerified':!![]}}),_0x1fc03e=await database_1[_0x2afbc8(0x11d)]['telegramUser']['groupBy']({'by':[_0x2afbc8(0x107)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x196f09[_0x2afbc8(0xfa)]({'success':!![],'result':{'bot':{'isActive':_0x2de87c[_0x2afbc8(0x125)],'username':_0x2de87c[_0x2afbc8(0x122)]},'statistics':{'totalUsers':_0x37f38f,'verifiedUsers':_0x24461b,'unverifiedUsers':_0x37f38f-_0x24461b,'connectedShops':_0x1fc03e[_0x2afbc8(0x12f)]}}});}catch(_0x3eebc8){_0x368abd(_0x3eebc8);}},this[_0x12ad31(0x138)]=async(_0x33139c,_0x4203ac,_0x4385e1)=>{const _0x1c24e6=_0x12ad31;try{const {page:page=0x1,limit:limit=0x14,verified:_0x15a96e}=_0x33139c[_0x1c24e6(0x13c)],_0x4960aa=(Number(page)-0x1)*Number(limit),_0x120e32={};_0x15a96e!==undefined&&(_0x120e32[_0x1c24e6(0xfd)]=_0x15a96e===_0x1c24e6(0x134));const [_0x46165d,_0x568486]=await Promise['all']([database_1['default'][_0x1c24e6(0x13f)][_0x1c24e6(0xfe)]({'where':_0x120e32,'skip':_0x4960aa,'take':Number(limit),'orderBy':{'createdAt':_0x1c24e6(0x130)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x1c24e6(0x13f)]['count']({'where':_0x120e32})]);_0x4203ac[_0x1c24e6(0xfa)]({'success':!![],'users':_0x46165d['map'](_0x3456db=>({'id':_0x3456db['id'],'telegramId':_0x3456db[_0x1c24e6(0x102)],'username':_0x3456db['username'],'firstName':_0x3456db['firstName'],'lastName':_0x3456db[_0x1c24e6(0x11b)],'isVerified':_0x3456db['isVerified'],'shop':_0x3456db[_0x1c24e6(0x109)],'createdAt':_0x3456db[_0x1c24e6(0x13e)],'updatedAt':_0x3456db[_0x1c24e6(0x10a)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x568486,'totalPages':Math[_0x1c24e6(0x13a)](_0x568486/Number(limit))}});}catch(_0x282aef){_0x4385e1(_0x282aef);}},this['sendBroadcast']=async(_0x2e065d,_0x14760b,_0x1f69e2)=>{const _0x2d28d6=_0x12ad31;try{const {message:_0x459c23,shopId:_0x4983ac}=_0x2e065d[_0x2d28d6(0x13b)];if(!_0x459c23)return _0x14760b['status'](0x190)[_0x2d28d6(0xfa)]({'success':![],'message':'Message\x20is\x20required'});if(_0x4983ac)await telegramBotService_1[_0x2d28d6(0x11f)][_0x2d28d6(0x124)](_0x4983ac,_0x459c23,{'parse_mode':_0x2d28d6(0x142)});else{const _0x47b21a=await database_1[_0x2d28d6(0x11d)][_0x2d28d6(0x13f)][_0x2d28d6(0xfe)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x24b2d0=[...new Set(_0x47b21a[_0x2d28d6(0xff)](_0x1e1372=>_0x1e1372[_0x2d28d6(0x107)])[_0x2d28d6(0x108)](Boolean))];for(const _0x100724 of _0x24b2d0){_0x100724&&await telegramBotService_1[_0x2d28d6(0x11f)][_0x2d28d6(0x124)](_0x100724,_0x459c23,{'parse_mode':'Markdown'});}}_0x14760b[_0x2d28d6(0xfa)]({'success':!![],'message':_0x2d28d6(0x11a)});}catch(_0x451492){_0x1f69e2(_0x451492);}},this['disconnectUser']=async(_0x8c0f1f,_0x5ca92f,_0x30dfb6)=>{const _0x3b6766=_0x12ad31;try{const {telegramId:_0x1b6dc3}=_0x8c0f1f['params'],_0x5348fc=await database_1[_0x3b6766(0x11d)][_0x3b6766(0x13f)]['findUnique']({'where':{'telegramId':_0x1b6dc3},'include':{'shop':!![]}});if(!_0x5348fc)return _0x5ca92f['status'](0x194)[_0x3b6766(0xfa)]({'success':![],'message':_0x3b6766(0x136)});await database_1['default'][_0x3b6766(0x13f)][_0x3b6766(0x13d)]({'where':{'telegramId':_0x1b6dc3},'data':{'shopId':null,'isVerified':![]}}),_0x5ca92f[_0x3b6766(0xfa)]({'success':!![],'message':_0x3b6766(0x120)});}catch(_0x4c66e9){_0x30dfb6(_0x4c66e9);}},this['sendTestNotification']=async(_0x136831,_0x26e3bd,_0x42d726)=>{const _0x51a683=_0x12ad31;try{const {shopId:_0x124a61,type:type=_0x51a683(0x117),testData:_0x794ebc}=_0x136831[_0x51a683(0x13b)];if(!_0x124a61)return _0x26e3bd[_0x51a683(0x10c)](0x190)[_0x51a683(0xfa)]({'success':![],'message':_0x51a683(0x135)});const _0x55467f=await database_1[_0x51a683(0x11d)][_0x51a683(0x109)][_0x51a683(0x132)]({'where':{'id':_0x124a61},'select':{'id':!![],'name':!![]}});if(!_0x55467f)return _0x26e3bd[_0x51a683(0x10c)](0x194)[_0x51a683(0xfa)]({'success':![],'message':_0x51a683(0x11c)});switch(type){case'payment':const _0x410b64={'id':_0x51a683(0x12d),'amount':_0x794ebc?.[_0x51a683(0x10d)]||0x64,'currency':_0x794ebc?.[_0x51a683(0x118)]||_0x51a683(0xfc),'productName':_0x794ebc?.[_0x51a683(0x113)]||_0x51a683(0x119),'gateway':_0x794ebc?.[_0x51a683(0x116)]||_0x51a683(0x114),'createdAt':new Date(),..._0x794ebc};await telegramBotService_1[_0x51a683(0x11f)][_0x51a683(0x127)](_0x124a61,_0x410b64,_0x51a683(0x10e));break;case _0x51a683(0x145):const _0x542107={'id':'test_payout_123','amount':_0x794ebc?.[_0x51a683(0x10d)]||0x1f4,'method':_0x794ebc?.[_0x51a683(0x106)]||_0x51a683(0x139),'createdAt':new Date(),..._0x794ebc};await telegramBotService_1[_0x51a683(0x11f)][_0x51a683(0x129)](_0x124a61,_0x542107,_0x51a683(0x10f));break;case'custom':await telegramBotService_1[_0x51a683(0x11f)][_0x51a683(0x12a)](_0x124a61,_0x794ebc?.[_0x51a683(0x12c)]||_0x51a683(0x12e),_0x794ebc?.[_0x51a683(0x110)]||{'message':_0x51a683(0x140)});break;default:return _0x26e3bd[_0x51a683(0x10c)](0x190)[_0x51a683(0xfa)]({'success':![],'message':_0x51a683(0x121)});}_0x26e3bd[_0x51a683(0xfa)]({'success':!![],'message':_0x51a683(0x104)+type+_0x51a683(0x103)});}catch(_0x4f05e5){_0x42d726(_0x4f05e5);}};}}exports[a12_0x468a9e(0x11e)]=TelegramController;