'use strict';const a20_0x3ca1a3=a20_0x1b06;(function(_0x44415d,_0x529479){const _0x5f33ff=a20_0x1b06,_0x400b28=_0x44415d();while(!![]){try{const _0x2b5147=-parseInt(_0x5f33ff(0x11c))/0x1*(-parseInt(_0x5f33ff(0xdb))/0x2)+-parseInt(_0x5f33ff(0x106))/0x3+-parseInt(_0x5f33ff(0xf2))/0x4+-parseInt(_0x5f33ff(0x116))/0x5+parseInt(_0x5f33ff(0xe1))/0x6*(-parseInt(_0x5f33ff(0x111))/0x7)+parseInt(_0x5f33ff(0x10b))/0x8+parseInt(_0x5f33ff(0xde))/0x9;if(_0x2b5147===_0x529479)break;else _0x400b28['push'](_0x400b28['shift']());}catch(_0x226e84){_0x400b28['push'](_0x400b28['shift']());}}}(a20_0x1a40,0x4cc39));function a20_0x1b06(_0x5af9f2,_0x4949a7){_0x5af9f2=_0x5af9f2-0xd9;const _0x1a4053=a20_0x1a40();let _0x1b06a8=_0x1a4053[_0x5af9f2];return _0x1b06a8;}var __importDefault=this&&this[a20_0x3ca1a3(0xf8)]||function(_0x1bd1e5){const _0x3c131f=a20_0x3ca1a3;return _0x1bd1e5&&_0x1bd1e5[_0x3c131f(0xf0)]?_0x1bd1e5:{'default':_0x1bd1e5};};Object[a20_0x3ca1a3(0x10f)](exports,a20_0x3ca1a3(0xf0),{'value':!![]}),exports[a20_0x3ca1a3(0xe2)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a20_0x3ca1a3(0x10a)));function a20_0x1a40(){const _0x547041=['857064XfShYJ','Shop\x20not\x20found','telegramBotService','all','defineProperty','sendBroadcast','973gbItbp','firstName','telegramUser','sendPaymentNotification','findUnique','373430xSSJif','json','shopId','Message\x20is\x20required','Test\x20Product','lastName','689XSKRUB','Markdown','map','334OpLsrE','default','TRC20','10431207OMlgiF','USD','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','25014IVfvHS','TelegramController','count','telegramId','details','amount','custom','Telegram\x20user\x20not\x20found','createdAt','username','params','sendCustomNotification','query','shop','Test\x20Notification','__esModule','update','858248szAcny','isVerified','\x20notification\x20sent\x20successfully','sendShopNotification','length','txid','__importDefault','productName','updatedAt','User\x20disconnected\x20successfully','groupBy','payment','findMany','sendTestNotification','getBotInfo','getTelegramUsers','status','gateway','desc','test_payout_123','594165XaXZVm','body','Test\x20','sendPayoutNotification','../config/database'];a20_0x1a40=function(){return _0x547041;};return a20_0x1a40();}class TelegramController{constructor(){const _0x11660b=a20_0x3ca1a3;this['getBotStatus']=async(_0x449e39,_0x22c668,_0x161993)=>{const _0x20a0cb=a20_0x1b06;try{const _0x348d9a=telegramBotService_1[_0x20a0cb(0x10d)][_0x20a0cb(0x100)](),_0x248e18=await database_1[_0x20a0cb(0xdc)][_0x20a0cb(0x113)][_0x20a0cb(0xe3)](),_0x101eff=await database_1[_0x20a0cb(0xdc)][_0x20a0cb(0x113)][_0x20a0cb(0xe3)]({'where':{'isVerified':!![]}}),_0x337847=await database_1[_0x20a0cb(0xdc)]['telegramUser'][_0x20a0cb(0xfc)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x22c668[_0x20a0cb(0x117)]({'success':!![],'result':{'bot':{'isActive':_0x348d9a['isActive'],'username':_0x348d9a[_0x20a0cb(0xea)]},'statistics':{'totalUsers':_0x248e18,'verifiedUsers':_0x101eff,'unverifiedUsers':_0x248e18-_0x101eff,'connectedShops':_0x337847[_0x20a0cb(0xf6)]}}});}catch(_0x37f785){_0x161993(_0x37f785);}},this[_0x11660b(0x101)]=async(_0x4e827a,_0x34feac,_0x68b927)=>{const _0x15f23e=_0x11660b;try{const {page:page=0x1,limit:limit=0x14,verified:_0x52c3a4}=_0x4e827a[_0x15f23e(0xed)],_0x13dc62=(Number(page)-0x1)*Number(limit),_0x508eb3={};_0x52c3a4!==undefined&&(_0x508eb3[_0x15f23e(0xf3)]=_0x52c3a4==='true');const [_0x6bbe11,_0x256ee8]=await Promise[_0x15f23e(0x10e)]([database_1[_0x15f23e(0xdc)][_0x15f23e(0x113)][_0x15f23e(0xfe)]({'where':_0x508eb3,'skip':_0x13dc62,'take':Number(limit),'orderBy':{'createdAt':_0x15f23e(0x104)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x15f23e(0xdc)]['telegramUser'][_0x15f23e(0xe3)]({'where':_0x508eb3})]);_0x34feac[_0x15f23e(0x117)]({'success':!![],'users':_0x6bbe11[_0x15f23e(0xda)](_0x39b8f3=>({'id':_0x39b8f3['id'],'telegramId':_0x39b8f3[_0x15f23e(0xe4)],'username':_0x39b8f3['username'],'firstName':_0x39b8f3[_0x15f23e(0x112)],'lastName':_0x39b8f3[_0x15f23e(0x11b)],'isVerified':_0x39b8f3[_0x15f23e(0xf3)],'shop':_0x39b8f3[_0x15f23e(0xee)],'createdAt':_0x39b8f3[_0x15f23e(0xe9)],'updatedAt':_0x39b8f3[_0x15f23e(0xfa)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x256ee8,'totalPages':Math['ceil'](_0x256ee8/Number(limit))}});}catch(_0x26dee0){_0x68b927(_0x26dee0);}},this[_0x11660b(0x110)]=async(_0x5289f0,_0xaaeb5,_0x128aaa)=>{const _0x2d748c=_0x11660b;try{const {message:_0x52fbcc,shopId:_0x11a0d5}=_0x5289f0[_0x2d748c(0x107)];if(!_0x52fbcc)return _0xaaeb5[_0x2d748c(0x102)](0x190)[_0x2d748c(0x117)]({'success':![],'message':_0x2d748c(0x119)});if(_0x11a0d5)await telegramBotService_1[_0x2d748c(0x10d)][_0x2d748c(0xf5)](_0x11a0d5,_0x52fbcc,{'parse_mode':_0x2d748c(0xd9)});else{const _0x176fcf=await database_1[_0x2d748c(0xdc)][_0x2d748c(0x113)][_0x2d748c(0xfe)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x211516=[...new Set(_0x176fcf[_0x2d748c(0xda)](_0xe39cd3=>_0xe39cd3[_0x2d748c(0x118)])['filter'](Boolean))];for(const _0x32f31f of _0x211516){_0x32f31f&&await telegramBotService_1[_0x2d748c(0x10d)][_0x2d748c(0xf5)](_0x32f31f,_0x52fbcc,{'parse_mode':_0x2d748c(0xd9)});}}_0xaaeb5['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x511280){_0x128aaa(_0x511280);}},this['disconnectUser']=async(_0x53c9b6,_0x38468f,_0x402789)=>{const _0x15359b=_0x11660b;try{const {telegramId:_0xa8ad6c}=_0x53c9b6[_0x15359b(0xeb)],_0x6a1a04=await database_1['default'][_0x15359b(0x113)][_0x15359b(0x115)]({'where':{'telegramId':_0xa8ad6c},'include':{'shop':!![]}});if(!_0x6a1a04)return _0x38468f[_0x15359b(0x102)](0x194)[_0x15359b(0x117)]({'success':![],'message':_0x15359b(0xe8)});await database_1['default'][_0x15359b(0x113)][_0x15359b(0xf1)]({'where':{'telegramId':_0xa8ad6c},'data':{'shopId':null,'isVerified':![]}}),_0x38468f['json']({'success':!![],'message':_0x15359b(0xfb)});}catch(_0x50a69d){_0x402789(_0x50a69d);}},this[_0x11660b(0xff)]=async(_0x52f2d5,_0x3a17fe,_0x58654e)=>{const _0x194be0=_0x11660b;try{const {shopId:_0xc3b126,type:type=_0x194be0(0xfd),testData:_0x346fc9}=_0x52f2d5['body'];if(!_0xc3b126)return _0x3a17fe['status'](0x190)[_0x194be0(0x117)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x8818c3=await database_1[_0x194be0(0xdc)][_0x194be0(0xee)][_0x194be0(0x115)]({'where':{'id':_0xc3b126},'select':{'id':!![],'name':!![]}});if(!_0x8818c3)return _0x3a17fe['status'](0x194)['json']({'success':![],'message':_0x194be0(0x10c)});switch(type){case'payment':const _0x33a078={'id':'test_payment_123','amount':_0x346fc9?.[_0x194be0(0xe6)]||0x64,'currency':_0x346fc9?.['currency']||_0x194be0(0xdf),'productName':_0x346fc9?.[_0x194be0(0xf9)]||_0x194be0(0x11a),'gateway':_0x346fc9?.[_0x194be0(0x103)]||'plisio','createdAt':new Date(),..._0x346fc9};await telegramBotService_1[_0x194be0(0x10d)][_0x194be0(0x114)](_0xc3b126,_0x33a078,'paid');break;case'payout':const _0x5070c2={'id':_0x194be0(0x105),'amount':_0x346fc9?.[_0x194be0(0xe6)]||0x1f4,'network':_0x346fc9?.['network']||_0x194be0(0xdd),'wallet':_0x346fc9?.['wallet']||_0x194be0(0xe0),'period':'Тестовый\x20период','createdAt':new Date(),'txid':_0x346fc9?.[_0x194be0(0xf7)]||null,..._0x346fc9};await telegramBotService_1[_0x194be0(0x10d)][_0x194be0(0x109)](_0xc3b126,_0x5070c2);break;case _0x194be0(0xe7):await telegramBotService_1[_0x194be0(0x10d)][_0x194be0(0xec)](_0xc3b126,_0x346fc9?.['title']||_0x194be0(0xef),_0x346fc9?.[_0x194be0(0xe5)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x3a17fe[_0x194be0(0x102)](0x190)[_0x194be0(0x117)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x3a17fe['json']({'success':!![],'message':_0x194be0(0x108)+type+_0x194be0(0xf4)});}catch(_0x1de2bc){_0x58654e(_0x1de2bc);}};}}exports[a20_0x3ca1a3(0xe2)]=TelegramController;