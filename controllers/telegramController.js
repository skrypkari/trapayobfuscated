'use strict';const a12_0x3f9a3f=a12_0x3caf;function a12_0xa03a(){const _0x3587c6=['title','createdAt','../config/database','completed','productName','sendPayoutNotification','Message\x20is\x20required','desc','test_payment_123','method','json','11MxaHBy','groupBy','6eazJbZ','gateway','999367jMZZQP','1655437zBOlFP','test_payout_123','804zfXRbR','Telegram\x20user\x20not\x20found','664NyvYhD','TelegramController','plisio','User\x20disconnected\x20successfully','payment','body','default','42410AeLuKZ','map','sendTestNotification','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Test\x20','949712uLtBrJ','getBotStatus','__importDefault','Markdown','custom','disconnectUser','5045180RnLEso','length','7123779mZwNJB','120573vNzyFm','username','count','details','shop','paid','Shop\x20ID\x20is\x20required','sendShopNotification','filter','firstName','true','amount','84RlRjmH','defineProperty','sendPaymentNotification','telegramBotService','shopId','2GSOjoz','lastName','bank_transfer','__esModule','Test\x20Product','sendBroadcast','Test\x20Notification','updatedAt','telegramUser','findMany','status','This\x20is\x20a\x20test\x20notification','params','USD','update','Broadcast\x20message\x20sent\x20successfully','isVerified','getTelegramUsers'];a12_0xa03a=function(){return _0x3587c6;};return a12_0xa03a();}function a12_0x3caf(_0x5ed821,_0x4c036a){const _0xa03abe=a12_0xa03a();return a12_0x3caf=function(_0x3caf91,_0xc6d4a3){_0x3caf91=_0x3caf91-0x167;let _0x3b87d6=_0xa03abe[_0x3caf91];return _0x3b87d6;},a12_0x3caf(_0x5ed821,_0x4c036a);}(function(_0x130bc9,_0x371d7b){const _0x4abf1c=a12_0x3caf,_0x43a0ab=_0x130bc9();while(!![]){try{const _0x4f5760=-parseInt(_0x4abf1c(0x17e))/0x1*(-parseInt(_0x4abf1c(0x1a9))/0x2)+parseInt(_0x4abf1c(0x17c))/0x3*(parseInt(_0x4abf1c(0x18f))/0x4)+parseInt(_0x4abf1c(0x18a))/0x5*(parseInt(_0x4abf1c(0x181))/0x6)+parseInt(_0x4abf1c(0x17f))/0x7+-parseInt(_0x4abf1c(0x183))/0x8*(-parseInt(_0x4abf1c(0x198))/0x9)+-parseInt(_0x4abf1c(0x195))/0xa*(-parseInt(_0x4abf1c(0x17a))/0xb)+parseInt(_0x4abf1c(0x1a4))/0xc*(-parseInt(_0x4abf1c(0x197))/0xd);if(_0x4f5760===_0x371d7b)break;else _0x43a0ab['push'](_0x43a0ab['shift']());}catch(_0x5c8488){_0x43a0ab['push'](_0x43a0ab['shift']());}}}(a12_0xa03a,0x994b2));var __importDefault=this&&this[a12_0x3f9a3f(0x191)]||function(_0x4b689d){const _0xbb067b=a12_0x3f9a3f;return _0x4b689d&&_0x4b689d[_0xbb067b(0x1ac)]?_0x4b689d:{'default':_0x4b689d};};Object[a12_0x3f9a3f(0x1a5)](exports,a12_0x3f9a3f(0x1ac),{'value':!![]}),exports[a12_0x3f9a3f(0x184)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x3f9a3f(0x171)));class TelegramController{constructor(){const _0x4c6320=a12_0x3f9a3f;this[_0x4c6320(0x190)]=async(_0x4a1b48,_0x3df60a,_0x3992e2)=>{const _0x4f5070=_0x4c6320;try{const _0x1c9ff8=telegramBotService_1['telegramBotService']['getBotInfo'](),_0x398e75=await database_1[_0x4f5070(0x189)][_0x4f5070(0x1b1)][_0x4f5070(0x19a)](),_0x2d2325=await database_1[_0x4f5070(0x189)]['telegramUser'][_0x4f5070(0x19a)]({'where':{'isVerified':!![]}}),_0x1da088=await database_1['default'][_0x4f5070(0x1b1)][_0x4f5070(0x17b)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3df60a[_0x4f5070(0x179)]({'success':!![],'result':{'bot':{'isActive':_0x1c9ff8['isActive'],'username':_0x1c9ff8['username']},'statistics':{'totalUsers':_0x398e75,'verifiedUsers':_0x2d2325,'unverifiedUsers':_0x398e75-_0x2d2325,'connectedShops':_0x1da088[_0x4f5070(0x196)]}}});}catch(_0xd6208){_0x3992e2(_0xd6208);}},this[_0x4c6320(0x16e)]=async(_0x298f83,_0x5a9fc3,_0x3ba442)=>{const _0xec4a6e=_0x4c6320;try{const {page:page=0x1,limit:limit=0x14,verified:_0x591c11}=_0x298f83['query'],_0x380cb9=(Number(page)-0x1)*Number(limit),_0x200395={};_0x591c11!==undefined&&(_0x200395['isVerified']=_0x591c11===_0xec4a6e(0x1a2));const [_0x29f462,_0x28cdfa]=await Promise['all']([database_1[_0xec4a6e(0x189)][_0xec4a6e(0x1b1)][_0xec4a6e(0x1b2)]({'where':_0x200395,'skip':_0x380cb9,'take':Number(limit),'orderBy':{'createdAt':_0xec4a6e(0x176)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0xec4a6e(0x189)]['telegramUser'][_0xec4a6e(0x19a)]({'where':_0x200395})]);_0x5a9fc3['json']({'success':!![],'users':_0x29f462[_0xec4a6e(0x18b)](_0x44a73e=>({'id':_0x44a73e['id'],'telegramId':_0x44a73e['telegramId'],'username':_0x44a73e[_0xec4a6e(0x199)],'firstName':_0x44a73e[_0xec4a6e(0x1a1)],'lastName':_0x44a73e[_0xec4a6e(0x1aa)],'isVerified':_0x44a73e[_0xec4a6e(0x16d)],'shop':_0x44a73e['shop'],'createdAt':_0x44a73e[_0xec4a6e(0x170)],'updatedAt':_0x44a73e[_0xec4a6e(0x1b0)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x28cdfa,'totalPages':Math['ceil'](_0x28cdfa/Number(limit))}});}catch(_0x305c5e){_0x3ba442(_0x305c5e);}},this[_0x4c6320(0x1ae)]=async(_0x5a87d3,_0x37364e,_0x4338b2)=>{const _0x3544eb=_0x4c6320;try{const {message:_0x3f28a7,shopId:_0x2faca9}=_0x5a87d3[_0x3544eb(0x188)];if(!_0x3f28a7)return _0x37364e[_0x3544eb(0x167)](0x190)[_0x3544eb(0x179)]({'success':![],'message':_0x3544eb(0x175)});if(_0x2faca9)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x2faca9,_0x3f28a7,{'parse_mode':_0x3544eb(0x192)});else{const _0x2bb256=await database_1['default'][_0x3544eb(0x1b1)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x53abf2=[...new Set(_0x2bb256[_0x3544eb(0x18b)](_0x98d225=>_0x98d225[_0x3544eb(0x1a8)])[_0x3544eb(0x1a0)](Boolean))];for(const _0x2e90ec of _0x53abf2){_0x2e90ec&&await telegramBotService_1[_0x3544eb(0x1a7)][_0x3544eb(0x19f)](_0x2e90ec,_0x3f28a7,{'parse_mode':_0x3544eb(0x192)});}}_0x37364e['json']({'success':!![],'message':_0x3544eb(0x16c)});}catch(_0x826002){_0x4338b2(_0x826002);}},this[_0x4c6320(0x194)]=async(_0x1ad2ed,_0x1d4e1f,_0x29e76b)=>{const _0x325e31=_0x4c6320;try{const {telegramId:_0x489e13}=_0x1ad2ed[_0x325e31(0x169)],_0x58f580=await database_1[_0x325e31(0x189)][_0x325e31(0x1b1)]['findUnique']({'where':{'telegramId':_0x489e13},'include':{'shop':!![]}});if(!_0x58f580)return _0x1d4e1f['status'](0x194)[_0x325e31(0x179)]({'success':![],'message':_0x325e31(0x182)});await database_1[_0x325e31(0x189)][_0x325e31(0x1b1)][_0x325e31(0x16b)]({'where':{'telegramId':_0x489e13},'data':{'shopId':null,'isVerified':![]}}),_0x1d4e1f['json']({'success':!![],'message':_0x325e31(0x186)});}catch(_0x170f68){_0x29e76b(_0x170f68);}},this[_0x4c6320(0x18c)]=async(_0x39b61a,_0x4025e2,_0x422da5)=>{const _0x2d6332=_0x4c6320;try{const {shopId:_0x2ca5c5,type:type=_0x2d6332(0x187),testData:_0x4e311a}=_0x39b61a['body'];if(!_0x2ca5c5)return _0x4025e2[_0x2d6332(0x167)](0x190)['json']({'success':![],'message':_0x2d6332(0x19e)});const _0x38ebc7=await database_1[_0x2d6332(0x189)][_0x2d6332(0x19c)]['findUnique']({'where':{'id':_0x2ca5c5},'select':{'id':!![],'name':!![]}});if(!_0x38ebc7)return _0x4025e2[_0x2d6332(0x167)](0x194)[_0x2d6332(0x179)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x2d6332(0x187):const _0xebfba2={'id':_0x2d6332(0x177),'amount':_0x4e311a?.[_0x2d6332(0x1a3)]||0x64,'currency':_0x4e311a?.['currency']||_0x2d6332(0x16a),'productName':_0x4e311a?.[_0x2d6332(0x173)]||_0x2d6332(0x1ad),'gateway':_0x4e311a?.[_0x2d6332(0x17d)]||_0x2d6332(0x185),'createdAt':new Date(),..._0x4e311a};await telegramBotService_1[_0x2d6332(0x1a7)][_0x2d6332(0x1a6)](_0x2ca5c5,_0xebfba2,_0x2d6332(0x19d));break;case'payout':const _0xf5f865={'id':_0x2d6332(0x180),'amount':_0x4e311a?.[_0x2d6332(0x1a3)]||0x1f4,'method':_0x4e311a?.[_0x2d6332(0x178)]||_0x2d6332(0x1ab),'createdAt':new Date(),..._0x4e311a};await telegramBotService_1[_0x2d6332(0x1a7)][_0x2d6332(0x174)](_0x2ca5c5,_0xf5f865,_0x2d6332(0x172));break;case _0x2d6332(0x193):await telegramBotService_1['telegramBotService']['sendCustomNotification'](_0x2ca5c5,_0x4e311a?.[_0x2d6332(0x16f)]||_0x2d6332(0x1af),_0x4e311a?.[_0x2d6332(0x19b)]||{'message':_0x2d6332(0x168)});break;default:return _0x4025e2[_0x2d6332(0x167)](0x190)[_0x2d6332(0x179)]({'success':![],'message':_0x2d6332(0x18d)});}_0x4025e2['json']({'success':!![],'message':_0x2d6332(0x18e)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x2388c9){_0x422da5(_0x2388c9);}};}}exports[a12_0x3f9a3f(0x184)]=TelegramController;