'use strict';function a12_0xc92f(_0x951d9f,_0x3b0a4e){const _0x13ab86=a12_0x13ab();return a12_0xc92f=function(_0xc92fb1,_0x1c4648){_0xc92fb1=_0xc92fb1-0x17f;let _0x23fef5=_0x13ab86[_0xc92fb1];return _0x23fef5;},a12_0xc92f(_0x951d9f,_0x3b0a4e);}const a12_0x18b839=a12_0xc92f;function a12_0x13ab(){const _0x139fa7=['3165VGlcom','sendBroadcast','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Test\x20Notification','sendPayoutNotification','Markdown','status','isActive','1967889ycIEDB','createdAt','filter','Shop\x20not\x20found','body','payout','plisio','findMany','telegramBotService','sendPaymentNotification','amount','telegramId','json','476eBzjdF','shopId','method','Test\x20Product','sendTestNotification','findUnique','details','lastName','USD','update','1566tsTrFA','length','__esModule','__importDefault','username','Message\x20is\x20required','Shop\x20ID\x20is\x20required','Telegram\x20user\x20not\x20found','params','../config/database','title','query','Test\x20','default','shop','completed','custom','Broadcast\x20message\x20sent\x20successfully','updatedAt','58wjwjio','124204oxQVaT','37368JiamzF','bank_transfer','../services/telegramBotService','telegramUser','getBotStatus','count','\x20notification\x20sent\x20successfully','ceil','test_payment_123','sendShopNotification','all','paid','4292181tPguuz','map','productName','isVerified','payment','22598MYKLci','13584720bSmKLF','groupBy','sendCustomNotification','TelegramController','getTelegramUsers'];a12_0x13ab=function(){return _0x139fa7;};return a12_0x13ab();}(function(_0x1acf6e,_0x58be04){const _0x43835d=a12_0xc92f,_0x1d09be=_0x1acf6e();while(!![]){try{const _0x1a4003=parseInt(_0x43835d(0x1bc))/0x1*(-parseInt(_0x43835d(0x1a9))/0x2)+-parseInt(_0x43835d(0x17f))/0x3+parseInt(_0x43835d(0x1aa))/0x4+parseInt(_0x43835d(0x1c2))/0x5*(parseInt(_0x43835d(0x196))/0x6)+parseInt(_0x43835d(0x18c))/0x7*(-parseInt(_0x43835d(0x1ab))/0x8)+parseInt(_0x43835d(0x1b7))/0x9+parseInt(_0x43835d(0x1bd))/0xa;if(_0x1a4003===_0x58be04)break;else _0x1d09be['push'](_0x1d09be['shift']());}catch(_0x261c86){_0x1d09be['push'](_0x1d09be['shift']());}}}(a12_0x13ab,0x62518));var __importDefault=this&&this[a12_0x18b839(0x199)]||function(_0x2ff048){const _0x32c511=a12_0x18b839;return _0x2ff048&&_0x2ff048[_0x32c511(0x198)]?_0x2ff048:{'default':_0x2ff048};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a12_0x18b839(0x1c0)]=void 0x0;const telegramBotService_1=require(a12_0x18b839(0x1ad)),database_1=__importDefault(require(a12_0x18b839(0x19f)));class TelegramController{constructor(){const _0x40dce5=a12_0x18b839;this[_0x40dce5(0x1af)]=async(_0xaee975,_0x319360,_0xdf25cf)=>{const _0x288679=_0x40dce5;try{const _0x5bfe2d=telegramBotService_1[_0x288679(0x187)]['getBotInfo'](),_0x506c23=await database_1[_0x288679(0x1a3)][_0x288679(0x1ae)]['count'](),_0xa3a83c=await database_1['default'][_0x288679(0x1ae)]['count']({'where':{'isVerified':!![]}}),_0x5723bf=await database_1[_0x288679(0x1a3)]['telegramUser'][_0x288679(0x1be)]({'by':[_0x288679(0x18d)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x319360['json']({'success':!![],'result':{'bot':{'isActive':_0x5bfe2d[_0x288679(0x1c9)],'username':_0x5bfe2d[_0x288679(0x19a)]},'statistics':{'totalUsers':_0x506c23,'verifiedUsers':_0xa3a83c,'unverifiedUsers':_0x506c23-_0xa3a83c,'connectedShops':_0x5723bf[_0x288679(0x197)]}}});}catch(_0xe0d039){_0xdf25cf(_0xe0d039);}},this[_0x40dce5(0x1c1)]=async(_0x21376d,_0x1ddf27,_0x2ef306)=>{const _0x4f61e4=_0x40dce5;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2b0cda}=_0x21376d[_0x4f61e4(0x1a1)],_0x1168ef=(Number(page)-0x1)*Number(limit),_0x4b9d65={};_0x2b0cda!==undefined&&(_0x4b9d65['isVerified']=_0x2b0cda==='true');const [_0x484c93,_0x330745]=await Promise[_0x4f61e4(0x1b5)]([database_1[_0x4f61e4(0x1a3)][_0x4f61e4(0x1ae)][_0x4f61e4(0x186)]({'where':_0x4b9d65,'skip':_0x1168ef,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4f61e4(0x1a3)]['telegramUser'][_0x4f61e4(0x1b0)]({'where':_0x4b9d65})]);_0x1ddf27[_0x4f61e4(0x18b)]({'success':!![],'users':_0x484c93[_0x4f61e4(0x1b8)](_0x3010e6=>({'id':_0x3010e6['id'],'telegramId':_0x3010e6[_0x4f61e4(0x18a)],'username':_0x3010e6[_0x4f61e4(0x19a)],'firstName':_0x3010e6['firstName'],'lastName':_0x3010e6[_0x4f61e4(0x193)],'isVerified':_0x3010e6[_0x4f61e4(0x1ba)],'shop':_0x3010e6[_0x4f61e4(0x1a4)],'createdAt':_0x3010e6[_0x4f61e4(0x180)],'updatedAt':_0x3010e6[_0x4f61e4(0x1a8)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x330745,'totalPages':Math[_0x4f61e4(0x1b2)](_0x330745/Number(limit))}});}catch(_0x4ffb0b){_0x2ef306(_0x4ffb0b);}},this[_0x40dce5(0x1c3)]=async(_0x300688,_0x4b9723,_0x4fca1e)=>{const _0x4c45bc=_0x40dce5;try{const {message:_0x2fd392,shopId:_0x594200}=_0x300688[_0x4c45bc(0x183)];if(!_0x2fd392)return _0x4b9723['status'](0x190)['json']({'success':![],'message':_0x4c45bc(0x19b)});if(_0x594200)await telegramBotService_1[_0x4c45bc(0x187)][_0x4c45bc(0x1b4)](_0x594200,_0x2fd392,{'parse_mode':_0x4c45bc(0x1c7)});else{const _0x3d0809=await database_1['default'][_0x4c45bc(0x1ae)][_0x4c45bc(0x186)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x103b99=[...new Set(_0x3d0809[_0x4c45bc(0x1b8)](_0x940220=>_0x940220[_0x4c45bc(0x18d)])[_0x4c45bc(0x181)](Boolean))];for(const _0x341bc3 of _0x103b99){_0x341bc3&&await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x341bc3,_0x2fd392,{'parse_mode':'Markdown'});}}_0x4b9723['json']({'success':!![],'message':_0x4c45bc(0x1a7)});}catch(_0x43fd00){_0x4fca1e(_0x43fd00);}},this['disconnectUser']=async(_0x52f910,_0x48a42c,_0x18056d)=>{const _0x75eb08=_0x40dce5;try{const {telegramId:_0x389004}=_0x52f910[_0x75eb08(0x19e)],_0x26c631=await database_1[_0x75eb08(0x1a3)]['telegramUser'][_0x75eb08(0x191)]({'where':{'telegramId':_0x389004},'include':{'shop':!![]}});if(!_0x26c631)return _0x48a42c[_0x75eb08(0x1c8)](0x194)[_0x75eb08(0x18b)]({'success':![],'message':_0x75eb08(0x19d)});await database_1[_0x75eb08(0x1a3)][_0x75eb08(0x1ae)][_0x75eb08(0x195)]({'where':{'telegramId':_0x389004},'data':{'shopId':null,'isVerified':![]}}),_0x48a42c['json']({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x33ac69){_0x18056d(_0x33ac69);}},this[_0x40dce5(0x190)]=async(_0x5d1242,_0x34119a,_0x5e8a00)=>{const _0x3f4393=_0x40dce5;try{const {shopId:_0x593524,type:type=_0x3f4393(0x1bb),testData:_0x2d935c}=_0x5d1242[_0x3f4393(0x183)];if(!_0x593524)return _0x34119a['status'](0x190)[_0x3f4393(0x18b)]({'success':![],'message':_0x3f4393(0x19c)});const _0x7bef3f=await database_1[_0x3f4393(0x1a3)][_0x3f4393(0x1a4)]['findUnique']({'where':{'id':_0x593524},'select':{'id':!![],'name':!![]}});if(!_0x7bef3f)return _0x34119a['status'](0x194)[_0x3f4393(0x18b)]({'success':![],'message':_0x3f4393(0x182)});switch(type){case _0x3f4393(0x1bb):const _0x2107bb={'id':_0x3f4393(0x1b3),'amount':_0x2d935c?.['amount']||0x64,'currency':_0x2d935c?.['currency']||_0x3f4393(0x194),'productName':_0x2d935c?.[_0x3f4393(0x1b9)]||_0x3f4393(0x18f),'gateway':_0x2d935c?.['gateway']||_0x3f4393(0x185),'createdAt':new Date(),..._0x2d935c};await telegramBotService_1[_0x3f4393(0x187)][_0x3f4393(0x188)](_0x593524,_0x2107bb,_0x3f4393(0x1b6));break;case _0x3f4393(0x184):const _0x32e5c5={'id':'test_payout_123','amount':_0x2d935c?.[_0x3f4393(0x189)]||0x1f4,'method':_0x2d935c?.[_0x3f4393(0x18e)]||_0x3f4393(0x1ac),'createdAt':new Date(),..._0x2d935c};await telegramBotService_1[_0x3f4393(0x187)][_0x3f4393(0x1c6)](_0x593524,_0x32e5c5,_0x3f4393(0x1a5));break;case _0x3f4393(0x1a6):await telegramBotService_1[_0x3f4393(0x187)][_0x3f4393(0x1bf)](_0x593524,_0x2d935c?.[_0x3f4393(0x1a0)]||_0x3f4393(0x1c5),_0x2d935c?.[_0x3f4393(0x192)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x34119a['status'](0x190)[_0x3f4393(0x18b)]({'success':![],'message':_0x3f4393(0x1c4)});}_0x34119a[_0x3f4393(0x18b)]({'success':!![],'message':_0x3f4393(0x1a2)+type+_0x3f4393(0x1b1)});}catch(_0xe20699){_0x5e8a00(_0xe20699);}};}}exports[a12_0x18b839(0x1c0)]=TelegramController;