'use strict';const a12_0x5df1bc=a12_0x3ef6;(function(_0x450954,_0x4291f3){const _0x2a471f=a12_0x3ef6,_0x206140=_0x450954();while(!![]){try{const _0x2b4f9d=parseInt(_0x2a471f(0x172))/0x1*(parseInt(_0x2a471f(0x16c))/0x2)+-parseInt(_0x2a471f(0x1a4))/0x3*(-parseInt(_0x2a471f(0x164))/0x4)+parseInt(_0x2a471f(0x17f))/0x5*(parseInt(_0x2a471f(0x187))/0x6)+-parseInt(_0x2a471f(0x188))/0x7+parseInt(_0x2a471f(0x1a8))/0x8*(-parseInt(_0x2a471f(0x1a6))/0x9)+-parseInt(_0x2a471f(0x197))/0xa*(-parseInt(_0x2a471f(0x176))/0xb)+-parseInt(_0x2a471f(0x163))/0xc;if(_0x2b4f9d===_0x4291f3)break;else _0x206140['push'](_0x206140['shift']());}catch(_0x5a99c3){_0x206140['push'](_0x206140['shift']());}}}(a12_0x346d,0x57513));function a12_0x346d(){const _0x40ed14=['658110jscRZf','productName','length','Telegram\x20user\x20not\x20found','isVerified','custom','sendPayoutNotification','shopId','12jROGXU','2128280asbTBc','User\x20disconnected\x20successfully','amount','groupBy','disconnectUser','status','method','title','createdAt','findUnique','defineProperty','telegramBotService','json','filter','true','152210flpQtm','all','isActive','Markdown','Shop\x20ID\x20is\x20required','\x20notification\x20sent\x20successfully','test_payout_123','__esModule','Test\x20','getTelegramUsers','username','lastName','payout','54RSXSYU','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','9ueIbKJ','query','503728kaZJnK','TelegramController','sendTestNotification','telegramUser','count','3121956YNSzQD','25052YkItDR','map','paid','findMany','Test\x20Product','This\x20is\x20a\x20test\x20notification','ceil','../config/database','4OgnZpj','sendCustomNotification','payment','bank_transfer','test_payment_123','update','273979oYDtbU','default','firstName','telegramId','44MRcTYa','Test\x20Notification','body','plisio','Message\x20is\x20required','updatedAt','currency','sendPaymentNotification','shop'];a12_0x346d=function(){return _0x40ed14;};return a12_0x346d();}var __importDefault=this&&this['__importDefault']||function(_0x525a3f){return _0x525a3f&&_0x525a3f['__esModule']?_0x525a3f:{'default':_0x525a3f};};Object[a12_0x5df1bc(0x192)](exports,a12_0x5df1bc(0x19e),{'value':!![]}),exports['TelegramController']=void 0x0;function a12_0x3ef6(_0x59d47d,_0xb51b67){const _0x346d8d=a12_0x346d();return a12_0x3ef6=function(_0x3ef6d8,_0x2f2b63){_0x3ef6d8=_0x3ef6d8-0x163;let _0x1885a0=_0x346d8d[_0x3ef6d8];return _0x1885a0;},a12_0x3ef6(_0x59d47d,_0xb51b67);}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x5df1bc(0x16b)));class TelegramController{constructor(){const _0x1f46b7=a12_0x5df1bc;this['getBotStatus']=async(_0x363fb5,_0x2cf512,_0x47d7ae)=>{const _0x54363e=a12_0x3ef6;try{const _0x10341e=telegramBotService_1['telegramBotService']['getBotInfo'](),_0x179f98=await database_1[_0x54363e(0x173)][_0x54363e(0x1ab)]['count'](),_0x543e66=await database_1[_0x54363e(0x173)][_0x54363e(0x1ab)][_0x54363e(0x1ac)]({'where':{'isVerified':!![]}}),_0x7a062f=await database_1[_0x54363e(0x173)][_0x54363e(0x1ab)][_0x54363e(0x18b)]({'by':[_0x54363e(0x186)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2cf512[_0x54363e(0x194)]({'success':!![],'result':{'bot':{'isActive':_0x10341e[_0x54363e(0x199)],'username':_0x10341e['username']},'statistics':{'totalUsers':_0x179f98,'verifiedUsers':_0x543e66,'unverifiedUsers':_0x179f98-_0x543e66,'connectedShops':_0x7a062f[_0x54363e(0x181)]}}});}catch(_0x5df677){_0x47d7ae(_0x5df677);}},this[_0x1f46b7(0x1a0)]=async(_0x113a7e,_0x569dac,_0x62ca98)=>{const _0x1ab7f7=_0x1f46b7;try{const {page:page=0x1,limit:limit=0x14,verified:_0x741839}=_0x113a7e[_0x1ab7f7(0x1a7)],_0x59dc89=(Number(page)-0x1)*Number(limit),_0x366bd8={};_0x741839!==undefined&&(_0x366bd8['isVerified']=_0x741839===_0x1ab7f7(0x196));const [_0x3263f6,_0x4240b7]=await Promise[_0x1ab7f7(0x198)]([database_1[_0x1ab7f7(0x173)][_0x1ab7f7(0x1ab)][_0x1ab7f7(0x167)]({'where':_0x366bd8,'skip':_0x59dc89,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['telegramUser'][_0x1ab7f7(0x1ac)]({'where':_0x366bd8})]);_0x569dac['json']({'success':!![],'users':_0x3263f6['map'](_0x54bde2=>({'id':_0x54bde2['id'],'telegramId':_0x54bde2[_0x1ab7f7(0x175)],'username':_0x54bde2[_0x1ab7f7(0x1a1)],'firstName':_0x54bde2[_0x1ab7f7(0x174)],'lastName':_0x54bde2[_0x1ab7f7(0x1a2)],'isVerified':_0x54bde2[_0x1ab7f7(0x183)],'shop':_0x54bde2['shop'],'createdAt':_0x54bde2[_0x1ab7f7(0x190)],'updatedAt':_0x54bde2[_0x1ab7f7(0x17b)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x4240b7,'totalPages':Math[_0x1ab7f7(0x16a)](_0x4240b7/Number(limit))}});}catch(_0x4362a4){_0x62ca98(_0x4362a4);}},this['sendBroadcast']=async(_0x7e4fee,_0xc07edd,_0x52385b)=>{const _0x11ee8d=_0x1f46b7;try{const {message:_0x2f51a7,shopId:_0x32024f}=_0x7e4fee[_0x11ee8d(0x178)];if(!_0x2f51a7)return _0xc07edd[_0x11ee8d(0x18d)](0x190)['json']({'success':![],'message':_0x11ee8d(0x17a)});if(_0x32024f)await telegramBotService_1[_0x11ee8d(0x193)]['sendShopNotification'](_0x32024f,_0x2f51a7,{'parse_mode':'Markdown'});else{const _0x2eabcb=await database_1['default'][_0x11ee8d(0x1ab)][_0x11ee8d(0x167)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xbcb2bf=[...new Set(_0x2eabcb[_0x11ee8d(0x165)](_0x19096f=>_0x19096f[_0x11ee8d(0x186)])[_0x11ee8d(0x195)](Boolean))];for(const _0x4226ef of _0xbcb2bf){_0x4226ef&&await telegramBotService_1[_0x11ee8d(0x193)]['sendShopNotification'](_0x4226ef,_0x2f51a7,{'parse_mode':_0x11ee8d(0x19a)});}}_0xc07edd[_0x11ee8d(0x194)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x4a69d4){_0x52385b(_0x4a69d4);}},this[_0x1f46b7(0x18c)]=async(_0x1985a5,_0x41badf,_0x12db6a)=>{const _0x1eaf18=_0x1f46b7;try{const {telegramId:_0x1d3066}=_0x1985a5['params'],_0x17da55=await database_1[_0x1eaf18(0x173)][_0x1eaf18(0x1ab)]['findUnique']({'where':{'telegramId':_0x1d3066},'include':{'shop':!![]}});if(!_0x17da55)return _0x41badf[_0x1eaf18(0x18d)](0x194)[_0x1eaf18(0x194)]({'success':![],'message':_0x1eaf18(0x182)});await database_1[_0x1eaf18(0x173)]['telegramUser'][_0x1eaf18(0x171)]({'where':{'telegramId':_0x1d3066},'data':{'shopId':null,'isVerified':![]}}),_0x41badf['json']({'success':!![],'message':_0x1eaf18(0x189)});}catch(_0x44aeb0){_0x12db6a(_0x44aeb0);}},this[_0x1f46b7(0x1aa)]=async(_0x52f9f9,_0x3b7763,_0x247fed)=>{const _0x5599db=_0x1f46b7;try{const {shopId:_0x43fe09,type:type=_0x5599db(0x16e),testData:_0x5b706b}=_0x52f9f9[_0x5599db(0x178)];if(!_0x43fe09)return _0x3b7763[_0x5599db(0x18d)](0x190)[_0x5599db(0x194)]({'success':![],'message':_0x5599db(0x19b)});const _0x4d5395=await database_1[_0x5599db(0x173)][_0x5599db(0x17e)][_0x5599db(0x191)]({'where':{'id':_0x43fe09},'select':{'id':!![],'name':!![]}});if(!_0x4d5395)return _0x3b7763['status'](0x194)[_0x5599db(0x194)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x5599db(0x16e):const _0x5036c4={'id':_0x5599db(0x170),'amount':_0x5b706b?.[_0x5599db(0x18a)]||0x64,'currency':_0x5b706b?.[_0x5599db(0x17c)]||'USD','productName':_0x5b706b?.[_0x5599db(0x180)]||_0x5599db(0x168),'gateway':_0x5b706b?.['gateway']||_0x5599db(0x179),'createdAt':new Date(),..._0x5b706b};await telegramBotService_1['telegramBotService'][_0x5599db(0x17d)](_0x43fe09,_0x5036c4,_0x5599db(0x166));break;case _0x5599db(0x1a3):const _0x51b644={'id':_0x5599db(0x19d),'amount':_0x5b706b?.['amount']||0x1f4,'method':_0x5b706b?.[_0x5599db(0x18e)]||_0x5599db(0x16f),'createdAt':new Date(),..._0x5b706b};await telegramBotService_1[_0x5599db(0x193)][_0x5599db(0x185)](_0x43fe09,_0x51b644,'completed');break;case _0x5599db(0x184):await telegramBotService_1[_0x5599db(0x193)][_0x5599db(0x16d)](_0x43fe09,_0x5b706b?.[_0x5599db(0x18f)]||_0x5599db(0x177),_0x5b706b?.['details']||{'message':_0x5599db(0x169)});break;default:return _0x3b7763[_0x5599db(0x18d)](0x190)[_0x5599db(0x194)]({'success':![],'message':_0x5599db(0x1a5)});}_0x3b7763['json']({'success':!![],'message':_0x5599db(0x19f)+type+_0x5599db(0x19c)});}catch(_0x24f1ec){_0x247fed(_0x24f1ec);}};}}exports[a12_0x5df1bc(0x1a9)]=TelegramController;