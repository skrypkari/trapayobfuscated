'use strict';const a12_0x157216=a12_0x3b1b;(function(_0x38bb37,_0x1b43d9){const _0x153314=a12_0x3b1b,_0x284c8a=_0x38bb37();while(!![]){try{const _0x454a6e=-parseInt(_0x153314(0x199))/0x1*(parseInt(_0x153314(0x1bd))/0x2)+parseInt(_0x153314(0x1d6))/0x3+-parseInt(_0x153314(0x1b0))/0x4*(parseInt(_0x153314(0x19e))/0x5)+parseInt(_0x153314(0x1cd))/0x6*(parseInt(_0x153314(0x1a0))/0x7)+-parseInt(_0x153314(0x1ba))/0x8*(-parseInt(_0x153314(0x1db))/0x9)+-parseInt(_0x153314(0x195))/0xa*(parseInt(_0x153314(0x1af))/0xb)+parseInt(_0x153314(0x1df))/0xc;if(_0x454a6e===_0x1b43d9)break;else _0x284c8a['push'](_0x284c8a['shift']());}catch(_0x32165a){_0x284c8a['push'](_0x284c8a['shift']());}}}(a12_0x3cf5,0x838ea));function a12_0x3cf5(){const _0x42907f=['paid','default','amount','payment','desc','Test\x20Product','bank_transfer','productName','gateway','4960gTCcxh','payout','__importDefault','1558tFIOUM','params','firstName','count','TelegramController','\x20notification\x20sent\x20successfully','createdAt','completed','This\x20is\x20a\x20test\x20notification','details','../services/telegramBotService','telegramBotService','body','username','isActive','method','246lWDcwM','shop','lastName','plisio','findMany','Test\x20Notification','disconnectUser','../config/database','custom','799416bQyFXy','all','telegramUser','defineProperty','__esModule','8334UTiBRA','title','Markdown','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','7547676lPlmUB','10bZjlCp','isVerified','Broadcast\x20message\x20sent\x20successfully','true','211WYEdzY','Shop\x20ID\x20is\x20required','shopId','sendPayoutNotification','sendShopNotification','33775KgbvGI','Message\x20is\x20required','10654wBTcsv','update','test_payout_123','length','ceil','sendBroadcast','Telegram\x20user\x20not\x20found','User\x20disconnected\x20successfully','test_payment_123','USD','status','json','getBotStatus','updatedAt','map','6515465GOqlcz','140hTkpdR'];a12_0x3cf5=function(){return _0x42907f;};return a12_0x3cf5();}function a12_0x3b1b(_0x68d9d4,_0x269d01){const _0x3cf5f5=a12_0x3cf5();return a12_0x3b1b=function(_0x3b1bea,_0x5218c8){_0x3b1bea=_0x3b1bea-0x195;let _0x17599f=_0x3cf5f5[_0x3b1bea];return _0x17599f;},a12_0x3b1b(_0x68d9d4,_0x269d01);}var __importDefault=this&&this[a12_0x157216(0x1bc)]||function(_0x6aba9d){const _0xe0ba14=a12_0x157216;return _0x6aba9d&&_0x6aba9d[_0xe0ba14(0x1da)]?_0x6aba9d:{'default':_0x6aba9d};};Object[a12_0x157216(0x1d9)](exports,a12_0x157216(0x1da),{'value':!![]}),exports[a12_0x157216(0x1c1)]=void 0x0;const telegramBotService_1=require(a12_0x157216(0x1c7)),database_1=__importDefault(require(a12_0x157216(0x1d4)));class TelegramController{constructor(){const _0x63c058=a12_0x157216;this[_0x63c058(0x1ac)]=async(_0x2eeca3,_0x2a9a25,_0x4db78f)=>{const _0x4b41bb=_0x63c058;try{const _0x543a10=telegramBotService_1['telegramBotService']['getBotInfo'](),_0x5353bc=await database_1[_0x4b41bb(0x1b2)][_0x4b41bb(0x1d8)][_0x4b41bb(0x1c0)](),_0x3abb8c=await database_1['default'][_0x4b41bb(0x1d8)][_0x4b41bb(0x1c0)]({'where':{'isVerified':!![]}}),_0x13e4a7=await database_1[_0x4b41bb(0x1b2)]['telegramUser']['groupBy']({'by':[_0x4b41bb(0x19b)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2a9a25[_0x4b41bb(0x1ab)]({'success':!![],'result':{'bot':{'isActive':_0x543a10[_0x4b41bb(0x1cb)],'username':_0x543a10[_0x4b41bb(0x1ca)]},'statistics':{'totalUsers':_0x5353bc,'verifiedUsers':_0x3abb8c,'unverifiedUsers':_0x5353bc-_0x3abb8c,'connectedShops':_0x13e4a7[_0x4b41bb(0x1a3)]}}});}catch(_0x1ababa){_0x4db78f(_0x1ababa);}},this['getTelegramUsers']=async(_0x4a745b,_0x504497,_0x3f20d1)=>{const _0x2ad7d2=_0x63c058;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2b446b}=_0x4a745b['query'],_0x5c48a4=(Number(page)-0x1)*Number(limit),_0x26ae8d={};_0x2b446b!==undefined&&(_0x26ae8d[_0x2ad7d2(0x196)]=_0x2b446b===_0x2ad7d2(0x198));const [_0x17b075,_0x5af22d]=await Promise[_0x2ad7d2(0x1d7)]([database_1[_0x2ad7d2(0x1b2)][_0x2ad7d2(0x1d8)][_0x2ad7d2(0x1d1)]({'where':_0x26ae8d,'skip':_0x5c48a4,'take':Number(limit),'orderBy':{'createdAt':_0x2ad7d2(0x1b5)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x2ad7d2(0x1d8)]['count']({'where':_0x26ae8d})]);_0x504497[_0x2ad7d2(0x1ab)]({'success':!![],'users':_0x17b075[_0x2ad7d2(0x1ae)](_0x103aa9=>({'id':_0x103aa9['id'],'telegramId':_0x103aa9['telegramId'],'username':_0x103aa9['username'],'firstName':_0x103aa9[_0x2ad7d2(0x1bf)],'lastName':_0x103aa9[_0x2ad7d2(0x1cf)],'isVerified':_0x103aa9['isVerified'],'shop':_0x103aa9['shop'],'createdAt':_0x103aa9[_0x2ad7d2(0x1c3)],'updatedAt':_0x103aa9[_0x2ad7d2(0x1ad)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5af22d,'totalPages':Math[_0x2ad7d2(0x1a4)](_0x5af22d/Number(limit))}});}catch(_0x5d43b6){_0x3f20d1(_0x5d43b6);}},this[_0x63c058(0x1a5)]=async(_0x43ca39,_0x2b5f01,_0x43f7b1)=>{const _0x94afe2=_0x63c058;try{const {message:_0x558ed6,shopId:_0x30d0d3}=_0x43ca39[_0x94afe2(0x1c9)];if(!_0x558ed6)return _0x2b5f01[_0x94afe2(0x1aa)](0x190)[_0x94afe2(0x1ab)]({'success':![],'message':_0x94afe2(0x19f)});if(_0x30d0d3)await telegramBotService_1[_0x94afe2(0x1c8)][_0x94afe2(0x19d)](_0x30d0d3,_0x558ed6,{'parse_mode':_0x94afe2(0x1dd)});else{const _0x1462d4=await database_1[_0x94afe2(0x1b2)][_0x94afe2(0x1d8)][_0x94afe2(0x1d1)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3df524=[...new Set(_0x1462d4[_0x94afe2(0x1ae)](_0x5375b7=>_0x5375b7[_0x94afe2(0x19b)])['filter'](Boolean))];for(const _0x4562b5 of _0x3df524){_0x4562b5&&await telegramBotService_1['telegramBotService'][_0x94afe2(0x19d)](_0x4562b5,_0x558ed6,{'parse_mode':_0x94afe2(0x1dd)});}}_0x2b5f01['json']({'success':!![],'message':_0x94afe2(0x197)});}catch(_0x481d85){_0x43f7b1(_0x481d85);}},this[_0x63c058(0x1d3)]=async(_0x41a267,_0x39a137,_0x1a4b5e)=>{const _0x2aca31=_0x63c058;try{const {telegramId:_0x432794}=_0x41a267[_0x2aca31(0x1be)],_0x507034=await database_1[_0x2aca31(0x1b2)][_0x2aca31(0x1d8)]['findUnique']({'where':{'telegramId':_0x432794},'include':{'shop':!![]}});if(!_0x507034)return _0x39a137[_0x2aca31(0x1aa)](0x194)[_0x2aca31(0x1ab)]({'success':![],'message':_0x2aca31(0x1a6)});await database_1[_0x2aca31(0x1b2)][_0x2aca31(0x1d8)][_0x2aca31(0x1a1)]({'where':{'telegramId':_0x432794},'data':{'shopId':null,'isVerified':![]}}),_0x39a137[_0x2aca31(0x1ab)]({'success':!![],'message':_0x2aca31(0x1a7)});}catch(_0x232acf){_0x1a4b5e(_0x232acf);}},this['sendTestNotification']=async(_0x332359,_0x15c27f,_0x51f36b)=>{const _0x1d863a=_0x63c058;try{const {shopId:_0x47a2ad,type:type=_0x1d863a(0x1b4),testData:_0x250e5c}=_0x332359['body'];if(!_0x47a2ad)return _0x15c27f[_0x1d863a(0x1aa)](0x190)['json']({'success':![],'message':_0x1d863a(0x19a)});const _0x4312f0=await database_1[_0x1d863a(0x1b2)][_0x1d863a(0x1ce)]['findUnique']({'where':{'id':_0x47a2ad},'select':{'id':!![],'name':!![]}});if(!_0x4312f0)return _0x15c27f[_0x1d863a(0x1aa)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x1d863a(0x1b4):const _0x1c66d3={'id':_0x1d863a(0x1a8),'amount':_0x250e5c?.[_0x1d863a(0x1b3)]||0x64,'currency':_0x250e5c?.['currency']||_0x1d863a(0x1a9),'productName':_0x250e5c?.[_0x1d863a(0x1b8)]||_0x1d863a(0x1b6),'gateway':_0x250e5c?.[_0x1d863a(0x1b9)]||_0x1d863a(0x1d0),'createdAt':new Date(),..._0x250e5c};await telegramBotService_1[_0x1d863a(0x1c8)]['sendPaymentNotification'](_0x47a2ad,_0x1c66d3,_0x1d863a(0x1b1));break;case _0x1d863a(0x1bb):const _0x4f28c0={'id':_0x1d863a(0x1a2),'amount':_0x250e5c?.[_0x1d863a(0x1b3)]||0x1f4,'method':_0x250e5c?.[_0x1d863a(0x1cc)]||_0x1d863a(0x1b7),'createdAt':new Date(),..._0x250e5c};await telegramBotService_1[_0x1d863a(0x1c8)][_0x1d863a(0x19c)](_0x47a2ad,_0x4f28c0,_0x1d863a(0x1c4));break;case _0x1d863a(0x1d5):await telegramBotService_1[_0x1d863a(0x1c8)]['sendCustomNotification'](_0x47a2ad,_0x250e5c?.[_0x1d863a(0x1dc)]||_0x1d863a(0x1d2),_0x250e5c?.[_0x1d863a(0x1c6)]||{'message':_0x1d863a(0x1c5)});break;default:return _0x15c27f[_0x1d863a(0x1aa)](0x190)[_0x1d863a(0x1ab)]({'success':![],'message':_0x1d863a(0x1de)});}_0x15c27f[_0x1d863a(0x1ab)]({'success':!![],'message':'Test\x20'+type+_0x1d863a(0x1c2)});}catch(_0x3f81ea){_0x51f36b(_0x3f81ea);}};}}exports[a12_0x157216(0x1c1)]=TelegramController;