'use strict';const a18_0x3f56a3=a18_0x34ac;(function(_0x4a42c,_0x21f0e3){const _0x46b6a0=a18_0x34ac,_0x4a6053=_0x4a42c();while(!![]){try{const _0x2d39cf=-parseInt(_0x46b6a0(0x19e))/0x1*(-parseInt(_0x46b6a0(0x172))/0x2)+-parseInt(_0x46b6a0(0x1a4))/0x3*(-parseInt(_0x46b6a0(0x191))/0x4)+parseInt(_0x46b6a0(0x19f))/0x5*(-parseInt(_0x46b6a0(0x17d))/0x6)+-parseInt(_0x46b6a0(0x181))/0x7+parseInt(_0x46b6a0(0x167))/0x8*(-parseInt(_0x46b6a0(0x1a0))/0x9)+parseInt(_0x46b6a0(0x179))/0xa*(parseInt(_0x46b6a0(0x193))/0xb)+parseInt(_0x46b6a0(0x196))/0xc;if(_0x2d39cf===_0x21f0e3)break;else _0x4a6053['push'](_0x4a6053['shift']());}catch(_0x5a5aff){_0x4a6053['push'](_0x4a6053['shift']());}}}(a18_0x356d,0x80f53));var __importDefault=this&&this[a18_0x3f56a3(0x1a6)]||function(_0x37ab25){const _0x5562bc=a18_0x3f56a3;return _0x37ab25&&_0x37ab25[_0x5562bc(0x1a7)]?_0x37ab25:{'default':_0x37ab25};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a18_0x3f56a3(0x18e)]=void 0x0;const telegramBotService_1=require(a18_0x3f56a3(0x17c)),database_1=__importDefault(require(a18_0x3f56a3(0x16e)));class TelegramController{constructor(){const _0x39b60e=a18_0x3f56a3;this['getBotStatus']=async(_0x29585f,_0x5785f4,_0x3916ea)=>{const _0x10dda9=a18_0x34ac;try{const _0x3cd70b=telegramBotService_1[_0x10dda9(0x16f)][_0x10dda9(0x190)](),_0x3d6a70=await database_1[_0x10dda9(0x174)]['telegramUser'][_0x10dda9(0x198)](),_0x1118dd=await database_1[_0x10dda9(0x174)][_0x10dda9(0x182)][_0x10dda9(0x198)]({'where':{'isVerified':!![]}}),_0x2cf7f1=await database_1[_0x10dda9(0x174)]['telegramUser'][_0x10dda9(0x17a)]({'by':[_0x10dda9(0x192)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5785f4[_0x10dda9(0x168)]({'success':!![],'result':{'bot':{'isActive':_0x3cd70b['isActive'],'username':_0x3cd70b[_0x10dda9(0x1ab)]},'statistics':{'totalUsers':_0x3d6a70,'verifiedUsers':_0x1118dd,'unverifiedUsers':_0x3d6a70-_0x1118dd,'connectedShops':_0x2cf7f1[_0x10dda9(0x1ae)]}}});}catch(_0x448b7a){_0x3916ea(_0x448b7a);}},this['getTelegramUsers']=async(_0x1a50da,_0x11d9a8,_0x17ba6f)=>{const _0x294d87=a18_0x34ac;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5390df}=_0x1a50da[_0x294d87(0x176)],_0x377b83=(Number(page)-0x1)*Number(limit),_0x309d66={};_0x5390df!==undefined&&(_0x309d66[_0x294d87(0x18b)]=_0x5390df==='true');const [_0x2b8df6,_0x50a6a2]=await Promise['all']([database_1[_0x294d87(0x174)][_0x294d87(0x182)][_0x294d87(0x194)]({'where':_0x309d66,'skip':_0x377b83,'take':Number(limit),'orderBy':{'createdAt':_0x294d87(0x188)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x294d87(0x174)]['telegramUser'][_0x294d87(0x198)]({'where':_0x309d66})]);_0x11d9a8['json']({'success':!![],'users':_0x2b8df6[_0x294d87(0x178)](_0x3cdbda=>({'id':_0x3cdbda['id'],'telegramId':_0x3cdbda[_0x294d87(0x1aa)],'username':_0x3cdbda[_0x294d87(0x1ab)],'firstName':_0x3cdbda[_0x294d87(0x195)],'lastName':_0x3cdbda[_0x294d87(0x1ad)],'isVerified':_0x3cdbda[_0x294d87(0x18b)],'shop':_0x3cdbda[_0x294d87(0x173)],'createdAt':_0x3cdbda[_0x294d87(0x18f)],'updatedAt':_0x3cdbda[_0x294d87(0x169)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x50a6a2,'totalPages':Math[_0x294d87(0x185)](_0x50a6a2/Number(limit))}});}catch(_0x268a84){_0x17ba6f(_0x268a84);}},this['sendBroadcast']=async(_0x2b3f80,_0x766a21,_0x5720ab)=>{const _0x208424=a18_0x34ac;try{const {message:_0x3ae8d1,shopId:_0x5b5083}=_0x2b3f80[_0x208424(0x166)];if(!_0x3ae8d1)return _0x766a21[_0x208424(0x1a3)](0x190)[_0x208424(0x168)]({'success':![],'message':_0x208424(0x1a5)});if(_0x5b5083)await telegramBotService_1[_0x208424(0x16f)][_0x208424(0x183)](_0x5b5083,_0x3ae8d1,{'parse_mode':_0x208424(0x18c)});else{const _0x3e26d0=await database_1[_0x208424(0x174)][_0x208424(0x182)][_0x208424(0x194)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x19b784=[...new Set(_0x3e26d0[_0x208424(0x178)](_0x155261=>_0x155261[_0x208424(0x192)])[_0x208424(0x1af)](Boolean))];for(const _0x199e3c of _0x19b784){_0x199e3c&&await telegramBotService_1['telegramBotService'][_0x208424(0x183)](_0x199e3c,_0x3ae8d1,{'parse_mode':_0x208424(0x18c)});}}_0x766a21[_0x208424(0x168)]({'success':!![],'message':_0x208424(0x170)});}catch(_0xee0fe5){_0x5720ab(_0xee0fe5);}},this[_0x39b60e(0x189)]=async(_0x4330d3,_0x321deb,_0x334802)=>{const _0x3a2274=_0x39b60e;try{const {telegramId:_0x4cad03}=_0x4330d3[_0x3a2274(0x1ac)],_0x343bc7=await database_1[_0x3a2274(0x174)][_0x3a2274(0x182)]['findUnique']({'where':{'telegramId':_0x4cad03},'include':{'shop':!![]}});if(!_0x343bc7)return _0x321deb['status'](0x194)[_0x3a2274(0x168)]({'success':![],'message':_0x3a2274(0x17e)});await database_1[_0x3a2274(0x174)]['telegramUser'][_0x3a2274(0x1a9)]({'where':{'telegramId':_0x4cad03},'data':{'shopId':null,'isVerified':![]}}),_0x321deb[_0x3a2274(0x168)]({'success':!![],'message':_0x3a2274(0x16d)});}catch(_0x439886){_0x334802(_0x439886);}},this[_0x39b60e(0x199)]=async(_0x1d2224,_0x27e36a,_0x5b1093)=>{const _0x433ce2=_0x39b60e;try{const {shopId:_0x27e668,type:type=_0x433ce2(0x177),testData:_0x2d5eca}=_0x1d2224[_0x433ce2(0x166)];if(!_0x27e668)return _0x27e36a[_0x433ce2(0x1a3)](0x190)[_0x433ce2(0x168)]({'success':![],'message':_0x433ce2(0x1a1)});const _0x5659e7=await database_1['default'][_0x433ce2(0x173)]['findUnique']({'where':{'id':_0x27e668},'select':{'id':!![],'name':!![]}});if(!_0x5659e7)return _0x27e36a[_0x433ce2(0x1a3)](0x194)[_0x433ce2(0x168)]({'success':![],'message':_0x433ce2(0x19c)});switch(type){case _0x433ce2(0x177):const _0x113e56={'id':'test_payment_123','amount':_0x2d5eca?.[_0x433ce2(0x165)]||0x64,'currency':_0x2d5eca?.[_0x433ce2(0x184)]||_0x433ce2(0x17b),'productName':_0x2d5eca?.[_0x433ce2(0x18a)]||_0x433ce2(0x19b),'gateway':_0x2d5eca?.[_0x433ce2(0x171)]||_0x433ce2(0x180),'createdAt':new Date(),..._0x2d5eca};await telegramBotService_1[_0x433ce2(0x16f)][_0x433ce2(0x19d)](_0x27e668,_0x113e56,_0x433ce2(0x197));break;case _0x433ce2(0x18d):const _0xd194d8={'id':'test_payout_123','amount':_0x2d5eca?.[_0x433ce2(0x165)]||0x1f4,'network':_0x2d5eca?.[_0x433ce2(0x16c)]||_0x433ce2(0x19a),'wallet':_0x2d5eca?.[_0x433ce2(0x186)]||_0x433ce2(0x187),'period':'Тестовый\x20период','createdAt':new Date(),'txid':_0x2d5eca?.[_0x433ce2(0x1a2)]||null,..._0x2d5eca};await telegramBotService_1['telegramBotService'][_0x433ce2(0x16b)](_0x27e668,_0xd194d8);break;case _0x433ce2(0x17f):await telegramBotService_1[_0x433ce2(0x16f)]['sendCustomNotification'](_0x27e668,_0x2d5eca?.[_0x433ce2(0x1a8)]||_0x433ce2(0x16a),_0x2d5eca?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x27e36a[_0x433ce2(0x1a3)](0x190)[_0x433ce2(0x168)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x27e36a[_0x433ce2(0x168)]({'success':!![],'message':_0x433ce2(0x175)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x56736d){_0x5b1093(_0x56736d);}};}}function a18_0x34ac(_0x13cd00,_0x5f493f){_0x13cd00=_0x13cd00-0x165;const _0x356db9=a18_0x356d();let _0x34acf3=_0x356db9[_0x13cd00];return _0x34acf3;}exports['TelegramController']=TelegramController;function a18_0x356d(){const _0x283035=['getBotInfo','128836YehNXv','shopId','991694auZCLL','findMany','firstName','5300208czFYyK','paid','count','sendTestNotification','TRC20','Test\x20Product','Shop\x20not\x20found','sendPaymentNotification','7SFrlPA','10kEhrgc','164853FeVjlu','Shop\x20ID\x20is\x20required','txid','status','84hWjaus','Message\x20is\x20required','__importDefault','__esModule','title','update','telegramId','username','params','lastName','length','filter','amount','body','208jhdyES','json','updatedAt','Test\x20Notification','sendPayoutNotification','network','User\x20disconnected\x20successfully','../config/database','telegramBotService','Broadcast\x20message\x20sent\x20successfully','gateway','111914MBwVms','shop','default','Test\x20','query','payment','map','10IpurVI','groupBy','USD','../services/telegramBotService','1434714YdreQm','Telegram\x20user\x20not\x20found','custom','plisio','2398886WwToRg','telegramUser','sendShopNotification','currency','ceil','wallet','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','desc','disconnectUser','productName','isVerified','Markdown','payout','TelegramController','createdAt'];a18_0x356d=function(){return _0x283035;};return a18_0x356d();}