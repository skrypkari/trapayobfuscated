'use strict';function a12_0xee59(_0x21f9b9,_0x4216c7){const _0xd2d087=a12_0xd2d0();return a12_0xee59=function(_0xee59d8,_0xaf2574){_0xee59d8=_0xee59d8-0x149;let _0x6c4d8c=_0xd2d087[_0xee59d8];return _0x6c4d8c;},a12_0xee59(_0x21f9b9,_0x4216c7);}const a12_0x3c3a71=a12_0xee59;(function(_0x13f13d,_0x540f06){const _0x26de81=a12_0xee59,_0x12d2f0=_0x13f13d();while(!![]){try{const _0x2fe59f=-parseInt(_0x26de81(0x16f))/0x1*(-parseInt(_0x26de81(0x153))/0x2)+-parseInt(_0x26de81(0x176))/0x3*(parseInt(_0x26de81(0x182))/0x4)+-parseInt(_0x26de81(0x160))/0x5+-parseInt(_0x26de81(0x189))/0x6*(parseInt(_0x26de81(0x164))/0x7)+parseInt(_0x26de81(0x18b))/0x8+parseInt(_0x26de81(0x156))/0x9*(parseInt(_0x26de81(0x179))/0xa)+parseInt(_0x26de81(0x14c))/0xb;if(_0x2fe59f===_0x540f06)break;else _0x12d2f0['push'](_0x12d2f0['shift']());}catch(_0x3ddf55){_0x12d2f0['push'](_0x12d2f0['shift']());}}}(a12_0xd2d0,0x492bd));var __importDefault=this&&this[a12_0x3c3a71(0x161)]||function(_0xd4ea58){return _0xd4ea58&&_0xd4ea58['__esModule']?_0xd4ea58:{'default':_0xd4ea58};};function a12_0xd2d0(){const _0x58bb0c=['sendPaymentNotification','getBotInfo','../config/database','custom','Test\x20Notification','1152DIJFIW','all','../services/telegramBotService','10hgpjUK','findMany','true','update','telegramId','default','map','paid','isActive','5908ayoJDj','method','filter','completed','User\x20disconnected\x20successfully','findUnique','query','42bsVBRK','telegramUser','4622272vkXPET','lastName','isVerified','\x20notification\x20sent\x20successfully','sendCustomNotification','firstName','sendBroadcast','body','productName','sendTestNotification','3215355LBmlQc','disconnectUser','defineProperty','Telegram\x20user\x20not\x20found','Shop\x20not\x20found','length','createdAt','4hEEHIE','params','ceil','2072259fFNbLu','gateway','payout','Markdown','Test\x20Product','status','Broadcast\x20message\x20sent\x20successfully','updatedAt','getBotStatus','Test\x20','1195790mieoAC','__importDefault','groupBy','username','181741ZgDXvf','shop','shopId','Message\x20is\x20required','count','USD','payment','details','json','telegramBotService','bank_transfer','93718xISwhe','desc'];a12_0xd2d0=function(){return _0x58bb0c;};return a12_0xd2d0();}Object[a12_0x3c3a71(0x14e)](exports,'__esModule',{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x3c3a71(0x178)),database_1=__importDefault(require(a12_0x3c3a71(0x173)));class TelegramController{constructor(){const _0x58a7b3=a12_0x3c3a71;this[_0x58a7b3(0x15e)]=async(_0x484eef,_0x2838fa,_0xb53447)=>{const _0x3895ad=_0x58a7b3;try{const _0x20361a=telegramBotService_1[_0x3895ad(0x16d)][_0x3895ad(0x172)](),_0x531220=await database_1['default'][_0x3895ad(0x18a)][_0x3895ad(0x168)](),_0x5879cd=await database_1[_0x3895ad(0x17e)]['telegramUser']['count']({'where':{'isVerified':!![]}}),_0xefef47=await database_1['default'][_0x3895ad(0x18a)][_0x3895ad(0x162)]({'by':[_0x3895ad(0x166)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2838fa[_0x3895ad(0x16c)]({'success':!![],'result':{'bot':{'isActive':_0x20361a[_0x3895ad(0x181)],'username':_0x20361a[_0x3895ad(0x163)]},'statistics':{'totalUsers':_0x531220,'verifiedUsers':_0x5879cd,'unverifiedUsers':_0x531220-_0x5879cd,'connectedShops':_0xefef47[_0x3895ad(0x151)]}}});}catch(_0x2548b3){_0xb53447(_0x2548b3);}},this['getTelegramUsers']=async(_0x348027,_0x294b89,_0x2df68e)=>{const _0x54f9b0=_0x58a7b3;try{const {page:page=0x1,limit:limit=0x14,verified:_0x437ec5}=_0x348027[_0x54f9b0(0x188)],_0x400005=(Number(page)-0x1)*Number(limit),_0x17a723={};_0x437ec5!==undefined&&(_0x17a723[_0x54f9b0(0x18d)]=_0x437ec5===_0x54f9b0(0x17b));const [_0x573e97,_0x366299]=await Promise[_0x54f9b0(0x177)]([database_1['default']['telegramUser'][_0x54f9b0(0x17a)]({'where':_0x17a723,'skip':_0x400005,'take':Number(limit),'orderBy':{'createdAt':_0x54f9b0(0x170)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x54f9b0(0x18a)][_0x54f9b0(0x168)]({'where':_0x17a723})]);_0x294b89[_0x54f9b0(0x16c)]({'success':!![],'users':_0x573e97[_0x54f9b0(0x17f)](_0x2bb4cb=>({'id':_0x2bb4cb['id'],'telegramId':_0x2bb4cb[_0x54f9b0(0x17d)],'username':_0x2bb4cb['username'],'firstName':_0x2bb4cb[_0x54f9b0(0x190)],'lastName':_0x2bb4cb[_0x54f9b0(0x18c)],'isVerified':_0x2bb4cb[_0x54f9b0(0x18d)],'shop':_0x2bb4cb[_0x54f9b0(0x165)],'createdAt':_0x2bb4cb[_0x54f9b0(0x152)],'updatedAt':_0x2bb4cb[_0x54f9b0(0x15d)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x366299,'totalPages':Math[_0x54f9b0(0x155)](_0x366299/Number(limit))}});}catch(_0x49cc8a){_0x2df68e(_0x49cc8a);}},this[_0x58a7b3(0x191)]=async(_0x3254dc,_0x36ba22,_0x39d6f0)=>{const _0xe81812=_0x58a7b3;try{const {message:_0x24c4b8,shopId:_0x1f77a1}=_0x3254dc[_0xe81812(0x149)];if(!_0x24c4b8)return _0x36ba22['status'](0x190)[_0xe81812(0x16c)]({'success':![],'message':_0xe81812(0x167)});if(_0x1f77a1)await telegramBotService_1[_0xe81812(0x16d)]['sendShopNotification'](_0x1f77a1,_0x24c4b8,{'parse_mode':_0xe81812(0x159)});else{const _0x338a85=await database_1[_0xe81812(0x17e)]['telegramUser'][_0xe81812(0x17a)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x20621f=[...new Set(_0x338a85['map'](_0x236115=>_0x236115['shopId'])[_0xe81812(0x184)](Boolean))];for(const _0x40cd66 of _0x20621f){_0x40cd66&&await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x40cd66,_0x24c4b8,{'parse_mode':_0xe81812(0x159)});}}_0x36ba22[_0xe81812(0x16c)]({'success':!![],'message':_0xe81812(0x15c)});}catch(_0x515ce5){_0x39d6f0(_0x515ce5);}},this[_0x58a7b3(0x14d)]=async(_0x5a5165,_0x15e6a8,_0x32279c)=>{const _0x4727a4=_0x58a7b3;try{const {telegramId:_0x109004}=_0x5a5165[_0x4727a4(0x154)],_0x70b5f3=await database_1[_0x4727a4(0x17e)][_0x4727a4(0x18a)][_0x4727a4(0x187)]({'where':{'telegramId':_0x109004},'include':{'shop':!![]}});if(!_0x70b5f3)return _0x15e6a8[_0x4727a4(0x15b)](0x194)[_0x4727a4(0x16c)]({'success':![],'message':_0x4727a4(0x14f)});await database_1[_0x4727a4(0x17e)][_0x4727a4(0x18a)][_0x4727a4(0x17c)]({'where':{'telegramId':_0x109004},'data':{'shopId':null,'isVerified':![]}}),_0x15e6a8[_0x4727a4(0x16c)]({'success':!![],'message':_0x4727a4(0x186)});}catch(_0x32d82b){_0x32279c(_0x32d82b);}},this[_0x58a7b3(0x14b)]=async(_0x1b34d6,_0x41f1f5,_0x56073a)=>{const _0x11af58=_0x58a7b3;try{const {shopId:_0x1b58e8,type:type='payment',testData:_0x372202}=_0x1b34d6[_0x11af58(0x149)];if(!_0x1b58e8)return _0x41f1f5[_0x11af58(0x15b)](0x190)[_0x11af58(0x16c)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x5d6b81=await database_1['default']['shop'][_0x11af58(0x187)]({'where':{'id':_0x1b58e8},'select':{'id':!![],'name':!![]}});if(!_0x5d6b81)return _0x41f1f5['status'](0x194)['json']({'success':![],'message':_0x11af58(0x150)});switch(type){case _0x11af58(0x16a):const _0x3e208d={'id':'test_payment_123','amount':_0x372202?.['amount']||0x64,'currency':_0x372202?.['currency']||_0x11af58(0x169),'productName':_0x372202?.[_0x11af58(0x14a)]||_0x11af58(0x15a),'gateway':_0x372202?.[_0x11af58(0x157)]||'plisio','createdAt':new Date(),..._0x372202};await telegramBotService_1['telegramBotService'][_0x11af58(0x171)](_0x1b58e8,_0x3e208d,_0x11af58(0x180));break;case _0x11af58(0x158):const _0x1f0353={'id':'test_payout_123','amount':_0x372202?.['amount']||0x1f4,'method':_0x372202?.[_0x11af58(0x183)]||_0x11af58(0x16e),'createdAt':new Date(),..._0x372202};await telegramBotService_1[_0x11af58(0x16d)]['sendPayoutNotification'](_0x1b58e8,_0x1f0353,_0x11af58(0x185));break;case _0x11af58(0x174):await telegramBotService_1[_0x11af58(0x16d)][_0x11af58(0x18f)](_0x1b58e8,_0x372202?.['title']||_0x11af58(0x175),_0x372202?.[_0x11af58(0x16b)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x41f1f5[_0x11af58(0x15b)](0x190)[_0x11af58(0x16c)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x41f1f5[_0x11af58(0x16c)]({'success':!![],'message':_0x11af58(0x15f)+type+_0x11af58(0x18e)});}catch(_0x53bd1d){_0x56073a(_0x53bd1d);}};}}exports['TelegramController']=TelegramController;