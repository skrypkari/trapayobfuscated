'use strict';const a13_0x58c844=a13_0x584a;(function(_0xca3ba7,_0x8601f2){const _0x80775d=a13_0x584a,_0x4f5c49=_0xca3ba7();while(!![]){try{const _0x5dead3=parseInt(_0x80775d(0x138))/0x1+-parseInt(_0x80775d(0x134))/0x2+-parseInt(_0x80775d(0x13a))/0x3+parseInt(_0x80775d(0x140))/0x4*(parseInt(_0x80775d(0x151))/0x5)+-parseInt(_0x80775d(0x145))/0x6+parseInt(_0x80775d(0x12f))/0x7+parseInt(_0x80775d(0x15d))/0x8;if(_0x5dead3===_0x8601f2)break;else _0x4f5c49['push'](_0x4f5c49['shift']());}catch(_0x2b8c4b){_0x4f5c49['push'](_0x4f5c49['shift']());}}}(a13_0x59b9,0x7c2a1));function a13_0x59b9(){const _0x2192f8=['true','1814868JfdpBL','getTelegramUsers','Shop\x20ID\x20is\x20required','details','996012XRcKKQ','amount','1759965SnGRkF','Broadcast\x20message\x20sent\x20successfully','telegramUser','findMany','Shop\x20not\x20found','length','8sLyLmt','Test\x20','USD','shopId','disconnectUser','2579352HHhhWg','filter','update','json','payment','updatedAt','../config/database','sendTestNotification','currency','completed','../services/telegramBotService','test_payout_123','2075890aXdaox','TelegramController','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','telegramBotService','groupBy','method','User\x20disconnected\x20successfully','telegramId','\x20notification\x20sent\x20successfully','isActive','defineProperty','body','1230632VtYkPo','status','sendBroadcast','Test\x20Notification','createdAt','firstName','sendShopNotification','test_payment_123','lastName','__esModule','Markdown','shop','This\x20is\x20a\x20test\x20notification','isVerified','__importDefault','count','Test\x20Product','custom','3166527DLmGhp','username','paid','default'];a13_0x59b9=function(){return _0x2192f8;};return a13_0x59b9();}function a13_0x584a(_0x420905,_0x1e8243){const _0x59b97a=a13_0x59b9();return a13_0x584a=function(_0x584a3d,_0x3f3f5e){_0x584a3d=_0x584a3d-0x126;let _0x54f2ff=_0x59b97a[_0x584a3d];return _0x54f2ff;},a13_0x584a(_0x420905,_0x1e8243);}var __importDefault=this&&this[a13_0x58c844(0x12b)]||function(_0x252993){const _0x7805a9=a13_0x58c844;return _0x252993&&_0x252993[_0x7805a9(0x126)]?_0x252993:{'default':_0x252993};};Object[a13_0x58c844(0x15b)](exports,a13_0x58c844(0x126),{'value':!![]}),exports[a13_0x58c844(0x152)]=void 0x0;const telegramBotService_1=require(a13_0x58c844(0x14f)),database_1=__importDefault(require(a13_0x58c844(0x14b)));class TelegramController{constructor(){const _0x368adb=a13_0x58c844;this['getBotStatus']=async(_0x138e71,_0x194b18,_0x4ae25d)=>{const _0x523500=a13_0x584a;try{const _0x4dc8af=telegramBotService_1['telegramBotService']['getBotInfo'](),_0x3ddebd=await database_1['default'][_0x523500(0x13c)][_0x523500(0x12c)](),_0x4978a5=await database_1['default'][_0x523500(0x13c)][_0x523500(0x12c)]({'where':{'isVerified':!![]}}),_0x1b81a7=await database_1[_0x523500(0x132)][_0x523500(0x13c)][_0x523500(0x155)]({'by':[_0x523500(0x143)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x194b18[_0x523500(0x148)]({'success':!![],'result':{'bot':{'isActive':_0x4dc8af[_0x523500(0x15a)],'username':_0x4dc8af[_0x523500(0x130)]},'statistics':{'totalUsers':_0x3ddebd,'verifiedUsers':_0x4978a5,'unverifiedUsers':_0x3ddebd-_0x4978a5,'connectedShops':_0x1b81a7[_0x523500(0x13f)]}}});}catch(_0x194cc3){_0x4ae25d(_0x194cc3);}},this[_0x368adb(0x135)]=async(_0x510c3e,_0x4ac5b9,_0x223799)=>{const _0x3b2598=_0x368adb;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3f1a85}=_0x510c3e['query'],_0xb9b9ab=(Number(page)-0x1)*Number(limit),_0x37e414={};_0x3f1a85!==undefined&&(_0x37e414[_0x3b2598(0x12a)]=_0x3f1a85===_0x3b2598(0x133));const [_0x127b47,_0x18e519]=await Promise['all']([database_1['default'][_0x3b2598(0x13c)]['findMany']({'where':_0x37e414,'skip':_0xb9b9ab,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x3b2598(0x13c)][_0x3b2598(0x12c)]({'where':_0x37e414})]);_0x4ac5b9[_0x3b2598(0x148)]({'success':!![],'users':_0x127b47['map'](_0x5c30a0=>({'id':_0x5c30a0['id'],'telegramId':_0x5c30a0[_0x3b2598(0x158)],'username':_0x5c30a0[_0x3b2598(0x130)],'firstName':_0x5c30a0[_0x3b2598(0x162)],'lastName':_0x5c30a0[_0x3b2598(0x165)],'isVerified':_0x5c30a0[_0x3b2598(0x12a)],'shop':_0x5c30a0[_0x3b2598(0x128)],'createdAt':_0x5c30a0[_0x3b2598(0x161)],'updatedAt':_0x5c30a0[_0x3b2598(0x14a)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x18e519,'totalPages':Math['ceil'](_0x18e519/Number(limit))}});}catch(_0x5eebac){_0x223799(_0x5eebac);}},this[_0x368adb(0x15f)]=async(_0x16b444,_0x46f2b8,_0xca7da2)=>{const _0x399efb=_0x368adb;try{const {message:_0x374f60,shopId:_0x1ed291}=_0x16b444[_0x399efb(0x15c)];if(!_0x374f60)return _0x46f2b8[_0x399efb(0x15e)](0x190)['json']({'success':![],'message':'Message\x20is\x20required'});if(_0x1ed291)await telegramBotService_1[_0x399efb(0x154)][_0x399efb(0x163)](_0x1ed291,_0x374f60,{'parse_mode':_0x399efb(0x127)});else{const _0x5880d2=await database_1[_0x399efb(0x132)][_0x399efb(0x13c)][_0x399efb(0x13d)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3b4be4=[...new Set(_0x5880d2['map'](_0x35c99a=>_0x35c99a[_0x399efb(0x143)])[_0x399efb(0x146)](Boolean))];for(const _0x46445e of _0x3b4be4){_0x46445e&&await telegramBotService_1[_0x399efb(0x154)][_0x399efb(0x163)](_0x46445e,_0x374f60,{'parse_mode':_0x399efb(0x127)});}}_0x46f2b8[_0x399efb(0x148)]({'success':!![],'message':_0x399efb(0x13b)});}catch(_0x25ec98){_0xca7da2(_0x25ec98);}},this[_0x368adb(0x144)]=async(_0x307031,_0x3666a6,_0x3f0cb6)=>{const _0x3cb3d6=_0x368adb;try{const {telegramId:_0x55c456}=_0x307031['params'],_0x5de88f=await database_1[_0x3cb3d6(0x132)][_0x3cb3d6(0x13c)]['findUnique']({'where':{'telegramId':_0x55c456},'include':{'shop':!![]}});if(!_0x5de88f)return _0x3666a6[_0x3cb3d6(0x15e)](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x3cb3d6(0x132)][_0x3cb3d6(0x13c)][_0x3cb3d6(0x147)]({'where':{'telegramId':_0x55c456},'data':{'shopId':null,'isVerified':![]}}),_0x3666a6[_0x3cb3d6(0x148)]({'success':!![],'message':_0x3cb3d6(0x157)});}catch(_0x566d24){_0x3f0cb6(_0x566d24);}},this[_0x368adb(0x14c)]=async(_0x114c8b,_0x5e9330,_0x4191fd)=>{const _0xbb0b8f=_0x368adb;try{const {shopId:_0xfd4f8f,type:type=_0xbb0b8f(0x149),testData:_0x45b5ef}=_0x114c8b[_0xbb0b8f(0x15c)];if(!_0xfd4f8f)return _0x5e9330[_0xbb0b8f(0x15e)](0x190)[_0xbb0b8f(0x148)]({'success':![],'message':_0xbb0b8f(0x136)});const _0x289544=await database_1[_0xbb0b8f(0x132)]['shop']['findUnique']({'where':{'id':_0xfd4f8f},'select':{'id':!![],'name':!![]}});if(!_0x289544)return _0x5e9330['status'](0x194)['json']({'success':![],'message':_0xbb0b8f(0x13e)});switch(type){case _0xbb0b8f(0x149):const _0x3a1160={'id':_0xbb0b8f(0x164),'amount':_0x45b5ef?.[_0xbb0b8f(0x139)]||0x64,'currency':_0x45b5ef?.[_0xbb0b8f(0x14d)]||_0xbb0b8f(0x142),'productName':_0x45b5ef?.['productName']||_0xbb0b8f(0x12d),'gateway':_0x45b5ef?.['gateway']||'plisio','createdAt':new Date(),..._0x45b5ef};await telegramBotService_1[_0xbb0b8f(0x154)]['sendPaymentNotification'](_0xfd4f8f,_0x3a1160,_0xbb0b8f(0x131));break;case'payout':const _0x32a457={'id':_0xbb0b8f(0x150),'amount':_0x45b5ef?.['amount']||0x1f4,'method':_0x45b5ef?.[_0xbb0b8f(0x156)]||'bank_transfer','createdAt':new Date(),..._0x45b5ef};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0xfd4f8f,_0x32a457,_0xbb0b8f(0x14e));break;case _0xbb0b8f(0x12e):await telegramBotService_1[_0xbb0b8f(0x154)]['sendCustomNotification'](_0xfd4f8f,_0x45b5ef?.['title']||_0xbb0b8f(0x160),_0x45b5ef?.[_0xbb0b8f(0x137)]||{'message':_0xbb0b8f(0x129)});break;default:return _0x5e9330[_0xbb0b8f(0x15e)](0x190)[_0xbb0b8f(0x148)]({'success':![],'message':_0xbb0b8f(0x153)});}_0x5e9330[_0xbb0b8f(0x148)]({'success':!![],'message':_0xbb0b8f(0x141)+type+_0xbb0b8f(0x159)});}catch(_0x431fe1){_0x4191fd(_0x431fe1);}};}}exports[a13_0x58c844(0x152)]=TelegramController;