'use strict';const a12_0x4a0c80=a12_0x4a42;function a12_0x5369(){const _0x324268=['228OaaQIm','length','isVerified','findUnique','telegramId','findMany','lastName','username','799677zxYYpK','199172dVdBBE','completed','title','Shop\x20ID\x20is\x20required','55794wBHNYA','telegramBotService','215000qRzxuB','sendTestNotification','isActive','../config/database','shop','Test\x20Product','getBotInfo','custom','true','paid','bank_transfer','json','259hJZKdd','plisio','25EogKCa','sendShopNotification','User\x20disconnected\x20successfully','default','Message\x20is\x20required','test_payment_123','942UpEsus','amount','Markdown','status','createdAt','shopId','8QRqeJm','count','params','sendBroadcast','test_payout_123','sendPaymentNotification','query','firstName','Shop\x20not\x20found','payout','currency','Test\x20Notification','Broadcast\x20message\x20sent\x20successfully','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','5092ZlAeXS','defineProperty','productName','telegramUser','319kgCVsX','58656CpojaK','__importDefault','253942duDoFu','details','Telegram\x20user\x20not\x20found','body','filter','getTelegramUsers','payment','desc','groupBy','disconnectUser','update','map'];a12_0x5369=function(){return _0x324268;};return a12_0x5369();}(function(_0x1a3a15,_0x10a93b){const _0x21a949=a12_0x4a42,_0x29a099=_0x1a3a15();while(!![]){try{const _0x4c2787=parseInt(_0x21a949(0x1b0))/0x1+-parseInt(_0x21a949(0x1ab))/0x2*(parseInt(_0x21a949(0x197))/0x3)+-parseInt(_0x21a949(0x1c7))/0x4*(parseInt(_0x21a949(0x191))/0x5)+-parseInt(_0x21a949(0x1cb))/0x6*(-parseInt(_0x21a949(0x18f))/0x7)+-parseInt(_0x21a949(0x19d))/0x8*(-parseInt(_0x21a949(0x1c6))/0x9)+parseInt(_0x21a949(0x1cd))/0xa*(parseInt(_0x21a949(0x1af))/0xb)+-parseInt(_0x21a949(0x1be))/0xc*(-parseInt(_0x21a949(0x1b2))/0xd);if(_0x4c2787===_0x10a93b)break;else _0x29a099['push'](_0x29a099['shift']());}catch(_0x175d43){_0x29a099['push'](_0x29a099['shift']());}}}(a12_0x5369,0x6ae31));var __importDefault=this&&this[a12_0x4a0c80(0x1b1)]||function(_0x257d80){return _0x257d80&&_0x257d80['__esModule']?_0x257d80:{'default':_0x257d80};};function a12_0x4a42(_0xce54df,_0x3a5255){const _0x5369dc=a12_0x5369();return a12_0x4a42=function(_0x4a42a0,_0xc4ab7e){_0x4a42a0=_0x4a42a0-0x184;let _0x3a3258=_0x5369dc[_0x4a42a0];return _0x3a3258;},a12_0x4a42(_0xce54df,_0x3a5255);}Object[a12_0x4a0c80(0x1ac)](exports,'__esModule',{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x4a0c80(0x186)));class TelegramController{constructor(){const _0x4d487e=a12_0x4a0c80;this['getBotStatus']=async(_0x11d8f4,_0x25e43c,_0x47bb94)=>{const _0x4bf46b=a12_0x4a42;try{const _0x41e3ef=telegramBotService_1[_0x4bf46b(0x1cc)][_0x4bf46b(0x189)](),_0x40d97d=await database_1['default'][_0x4bf46b(0x1ae)]['count'](),_0x4e6913=await database_1['default'][_0x4bf46b(0x1ae)][_0x4bf46b(0x19e)]({'where':{'isVerified':!![]}}),_0x35e1d2=await database_1[_0x4bf46b(0x194)][_0x4bf46b(0x1ae)][_0x4bf46b(0x1ba)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x25e43c[_0x4bf46b(0x18e)]({'success':!![],'result':{'bot':{'isActive':_0x41e3ef[_0x4bf46b(0x185)],'username':_0x41e3ef[_0x4bf46b(0x1c5)]},'statistics':{'totalUsers':_0x40d97d,'verifiedUsers':_0x4e6913,'unverifiedUsers':_0x40d97d-_0x4e6913,'connectedShops':_0x35e1d2[_0x4bf46b(0x1bf)]}}});}catch(_0x40e770){_0x47bb94(_0x40e770);}},this[_0x4d487e(0x1b7)]=async(_0x1939db,_0x27ae33,_0x4b4784)=>{const _0x5110fe=_0x4d487e;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2ffe2e}=_0x1939db[_0x5110fe(0x1a3)],_0x13fe9f=(Number(page)-0x1)*Number(limit),_0x47cbba={};_0x2ffe2e!==undefined&&(_0x47cbba[_0x5110fe(0x1c0)]=_0x2ffe2e===_0x5110fe(0x18b));const [_0x15a796,_0x65e76e]=await Promise['all']([database_1[_0x5110fe(0x194)]['telegramUser']['findMany']({'where':_0x47cbba,'skip':_0x13fe9f,'take':Number(limit),'orderBy':{'createdAt':_0x5110fe(0x1b9)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5110fe(0x194)][_0x5110fe(0x1ae)][_0x5110fe(0x19e)]({'where':_0x47cbba})]);_0x27ae33['json']({'success':!![],'users':_0x15a796['map'](_0x40e7f1=>({'id':_0x40e7f1['id'],'telegramId':_0x40e7f1[_0x5110fe(0x1c2)],'username':_0x40e7f1[_0x5110fe(0x1c5)],'firstName':_0x40e7f1[_0x5110fe(0x1a4)],'lastName':_0x40e7f1[_0x5110fe(0x1c4)],'isVerified':_0x40e7f1[_0x5110fe(0x1c0)],'shop':_0x40e7f1[_0x5110fe(0x187)],'createdAt':_0x40e7f1[_0x5110fe(0x19b)],'updatedAt':_0x40e7f1['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x65e76e,'totalPages':Math['ceil'](_0x65e76e/Number(limit))}});}catch(_0xe96364){_0x4b4784(_0xe96364);}},this[_0x4d487e(0x1a0)]=async(_0x258105,_0xa3e846,_0x2bb466)=>{const _0x5159c6=_0x4d487e;try{const {message:_0x95cefe,shopId:_0x55ff27}=_0x258105[_0x5159c6(0x1b5)];if(!_0x95cefe)return _0xa3e846[_0x5159c6(0x19a)](0x190)[_0x5159c6(0x18e)]({'success':![],'message':_0x5159c6(0x195)});if(_0x55ff27)await telegramBotService_1[_0x5159c6(0x1cc)]['sendShopNotification'](_0x55ff27,_0x95cefe,{'parse_mode':_0x5159c6(0x199)});else{const _0x1219e6=await database_1[_0x5159c6(0x194)][_0x5159c6(0x1ae)][_0x5159c6(0x1c3)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4ca8c9=[...new Set(_0x1219e6[_0x5159c6(0x1bd)](_0x5ee512=>_0x5ee512[_0x5159c6(0x19c)])[_0x5159c6(0x1b6)](Boolean))];for(const _0x3b5ae0 of _0x4ca8c9){_0x3b5ae0&&await telegramBotService_1[_0x5159c6(0x1cc)][_0x5159c6(0x192)](_0x3b5ae0,_0x95cefe,{'parse_mode':'Markdown'});}}_0xa3e846[_0x5159c6(0x18e)]({'success':!![],'message':_0x5159c6(0x1a9)});}catch(_0x3fd7eb){_0x2bb466(_0x3fd7eb);}},this[_0x4d487e(0x1bb)]=async(_0x7578dd,_0x3235b1,_0x7ba87a)=>{const _0x4dc979=_0x4d487e;try{const {telegramId:_0x4a308c}=_0x7578dd[_0x4dc979(0x19f)],_0x4496bc=await database_1['default'][_0x4dc979(0x1ae)][_0x4dc979(0x1c1)]({'where':{'telegramId':_0x4a308c},'include':{'shop':!![]}});if(!_0x4496bc)return _0x3235b1[_0x4dc979(0x19a)](0x194)[_0x4dc979(0x18e)]({'success':![],'message':_0x4dc979(0x1b4)});await database_1[_0x4dc979(0x194)][_0x4dc979(0x1ae)][_0x4dc979(0x1bc)]({'where':{'telegramId':_0x4a308c},'data':{'shopId':null,'isVerified':![]}}),_0x3235b1[_0x4dc979(0x18e)]({'success':!![],'message':_0x4dc979(0x193)});}catch(_0x4390ef){_0x7ba87a(_0x4390ef);}},this[_0x4d487e(0x184)]=async(_0x278a60,_0x25ae51,_0x347f40)=>{const _0xeff355=_0x4d487e;try{const {shopId:_0x32f02c,type:type=_0xeff355(0x1b8),testData:_0x202fa3}=_0x278a60[_0xeff355(0x1b5)];if(!_0x32f02c)return _0x25ae51[_0xeff355(0x19a)](0x190)[_0xeff355(0x18e)]({'success':![],'message':_0xeff355(0x1ca)});const _0x1adf14=await database_1[_0xeff355(0x194)][_0xeff355(0x187)][_0xeff355(0x1c1)]({'where':{'id':_0x32f02c},'select':{'id':!![],'name':!![]}});if(!_0x1adf14)return _0x25ae51[_0xeff355(0x19a)](0x194)[_0xeff355(0x18e)]({'success':![],'message':_0xeff355(0x1a5)});switch(type){case'payment':const _0x1d5c2d={'id':_0xeff355(0x196),'amount':_0x202fa3?.[_0xeff355(0x198)]||0x64,'currency':_0x202fa3?.[_0xeff355(0x1a7)]||'USD','productName':_0x202fa3?.[_0xeff355(0x1ad)]||_0xeff355(0x188),'gateway':_0x202fa3?.['gateway']||_0xeff355(0x190),'createdAt':new Date(),..._0x202fa3};await telegramBotService_1[_0xeff355(0x1cc)][_0xeff355(0x1a2)](_0x32f02c,_0x1d5c2d,_0xeff355(0x18c));break;case _0xeff355(0x1a6):const _0x7ee52c={'id':_0xeff355(0x1a1),'amount':_0x202fa3?.[_0xeff355(0x198)]||0x1f4,'method':_0x202fa3?.['method']||_0xeff355(0x18d),'createdAt':new Date(),..._0x202fa3};await telegramBotService_1[_0xeff355(0x1cc)]['sendPayoutNotification'](_0x32f02c,_0x7ee52c,_0xeff355(0x1c8));break;case _0xeff355(0x18a):await telegramBotService_1[_0xeff355(0x1cc)]['sendCustomNotification'](_0x32f02c,_0x202fa3?.[_0xeff355(0x1c9)]||_0xeff355(0x1a8),_0x202fa3?.[_0xeff355(0x1b3)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x25ae51['status'](0x190)[_0xeff355(0x18e)]({'success':![],'message':_0xeff355(0x1aa)});}_0x25ae51['json']({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x3eb8d0){_0x347f40(_0x3eb8d0);}};}}exports['TelegramController']=TelegramController;