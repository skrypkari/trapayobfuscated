'use strict';const a12_0x778c26=a12_0x62b4;(function(_0x18c38a,_0x2b28d0){const _0x329811=a12_0x62b4,_0x71e6a1=_0x18c38a();while(!![]){try{const _0x253cd4=parseInt(_0x329811(0x161))/0x1*(parseInt(_0x329811(0x155))/0x2)+parseInt(_0x329811(0x17b))/0x3*(parseInt(_0x329811(0x197))/0x4)+parseInt(_0x329811(0x179))/0x5*(parseInt(_0x329811(0x17f))/0x6)+-parseInt(_0x329811(0x180))/0x7+-parseInt(_0x329811(0x181))/0x8*(parseInt(_0x329811(0x177))/0x9)+parseInt(_0x329811(0x18f))/0xa+-parseInt(_0x329811(0x16b))/0xb;if(_0x253cd4===_0x2b28d0)break;else _0x71e6a1['push'](_0x71e6a1['shift']());}catch(_0x156843){_0x71e6a1['push'](_0x71e6a1['shift']());}}}(a12_0x51f2,0x4c457));var __importDefault=this&&this['__importDefault']||function(_0x26e76c){const _0x569310=a12_0x62b4;return _0x26e76c&&_0x26e76c[_0x569310(0x185)]?_0x26e76c:{'default':_0x26e76c};};Object[a12_0x778c26(0x16f)](exports,a12_0x778c26(0x185),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x778c26(0x15f)),database_1=__importDefault(require('../config/database'));function a12_0x62b4(_0x370a83,_0x114f6c){const _0x51f211=a12_0x51f2();return a12_0x62b4=function(_0x62b4f9,_0x35a8e9){_0x62b4f9=_0x62b4f9-0x154;let _0x4cf8c8=_0x51f211[_0x62b4f9];return _0x4cf8c8;},a12_0x62b4(_0x370a83,_0x114f6c);}class TelegramController{constructor(){const _0x349445=a12_0x778c26;this[_0x349445(0x156)]=async(_0x263fab,_0x5400f8,_0x1224df)=>{const _0x4ef832=_0x349445;try{const _0x1f5cf5=telegramBotService_1[_0x4ef832(0x19a)][_0x4ef832(0x16e)](),_0x398582=await database_1['default'][_0x4ef832(0x176)][_0x4ef832(0x163)](),_0xf818f7=await database_1[_0x4ef832(0x195)][_0x4ef832(0x176)][_0x4ef832(0x163)]({'where':{'isVerified':!![]}}),_0x31b727=await database_1[_0x4ef832(0x195)]['telegramUser'][_0x4ef832(0x16a)]({'by':[_0x4ef832(0x159)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5400f8['json']({'success':!![],'result':{'bot':{'isActive':_0x1f5cf5[_0x4ef832(0x196)],'username':_0x1f5cf5[_0x4ef832(0x15b)]},'statistics':{'totalUsers':_0x398582,'verifiedUsers':_0xf818f7,'unverifiedUsers':_0x398582-_0xf818f7,'connectedShops':_0x31b727['length']}}});}catch(_0x58653b){_0x1224df(_0x58653b);}},this[_0x349445(0x174)]=async(_0x19a404,_0x1d1a34,_0x374ca7)=>{const _0x318de7=_0x349445;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5e85d1}=_0x19a404[_0x318de7(0x160)],_0x2295a8=(Number(page)-0x1)*Number(limit),_0x511e85={};_0x5e85d1!==undefined&&(_0x511e85['isVerified']=_0x5e85d1===_0x318de7(0x158));const [_0x28c07b,_0xa46f43]=await Promise[_0x318de7(0x17d)]([database_1[_0x318de7(0x195)]['telegramUser']['findMany']({'where':_0x511e85,'skip':_0x2295a8,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x318de7(0x195)][_0x318de7(0x176)][_0x318de7(0x163)]({'where':_0x511e85})]);_0x1d1a34['json']({'success':!![],'users':_0x28c07b[_0x318de7(0x15d)](_0x244cf7=>({'id':_0x244cf7['id'],'telegramId':_0x244cf7[_0x318de7(0x191)],'username':_0x244cf7[_0x318de7(0x15b)],'firstName':_0x244cf7[_0x318de7(0x17c)],'lastName':_0x244cf7[_0x318de7(0x171)],'isVerified':_0x244cf7[_0x318de7(0x164)],'shop':_0x244cf7[_0x318de7(0x198)],'createdAt':_0x244cf7['createdAt'],'updatedAt':_0x244cf7[_0x318de7(0x165)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xa46f43,'totalPages':Math[_0x318de7(0x16d)](_0xa46f43/Number(limit))}});}catch(_0x1859f5){_0x374ca7(_0x1859f5);}},this[_0x349445(0x18a)]=async(_0x59b369,_0x27e11f,_0xc03e9a)=>{const _0x2618c9=_0x349445;try{const {message:_0x4486c5,shopId:_0x465c83}=_0x59b369[_0x2618c9(0x189)];if(!_0x4486c5)return _0x27e11f['status'](0x190)[_0x2618c9(0x178)]({'success':![],'message':_0x2618c9(0x18e)});if(_0x465c83)await telegramBotService_1[_0x2618c9(0x19a)][_0x2618c9(0x173)](_0x465c83,_0x4486c5,{'parse_mode':_0x2618c9(0x182)});else{const _0x10538d=await database_1[_0x2618c9(0x195)]['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5459df=[...new Set(_0x10538d['map'](_0x12a713=>_0x12a713['shopId'])[_0x2618c9(0x192)](Boolean))];for(const _0x37fb97 of _0x5459df){_0x37fb97&&await telegramBotService_1[_0x2618c9(0x19a)]['sendShopNotification'](_0x37fb97,_0x4486c5,{'parse_mode':_0x2618c9(0x182)});}}_0x27e11f[_0x2618c9(0x178)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x17e466){_0xc03e9a(_0x17e466);}},this[_0x349445(0x186)]=async(_0x26066f,_0x3c7140,_0x20429a)=>{const _0x27a7ee=_0x349445;try{const {telegramId:_0x93c2f0}=_0x26066f[_0x27a7ee(0x17a)],_0x2e83f0=await database_1[_0x27a7ee(0x195)]['telegramUser']['findUnique']({'where':{'telegramId':_0x93c2f0},'include':{'shop':!![]}});if(!_0x2e83f0)return _0x3c7140[_0x27a7ee(0x18b)](0x194)[_0x27a7ee(0x178)]({'success':![],'message':_0x27a7ee(0x169)});await database_1[_0x27a7ee(0x195)]['telegramUser']['update']({'where':{'telegramId':_0x93c2f0},'data':{'shopId':null,'isVerified':![]}}),_0x3c7140[_0x27a7ee(0x178)]({'success':!![],'message':_0x27a7ee(0x17e)});}catch(_0x3708a2){_0x20429a(_0x3708a2);}},this[_0x349445(0x167)]=async(_0x2ee5b3,_0x2b70ae,_0x30415f)=>{const _0x3d6230=_0x349445;try{const {shopId:_0x126053,type:type=_0x3d6230(0x154),testData:_0x50954b}=_0x2ee5b3[_0x3d6230(0x189)];if(!_0x126053)return _0x2b70ae[_0x3d6230(0x18b)](0x190)[_0x3d6230(0x178)]({'success':![],'message':_0x3d6230(0x183)});const _0x35037e=await database_1['default'][_0x3d6230(0x198)][_0x3d6230(0x15a)]({'where':{'id':_0x126053},'select':{'id':!![],'name':!![]}});if(!_0x35037e)return _0x2b70ae[_0x3d6230(0x18b)](0x194)['json']({'success':![],'message':_0x3d6230(0x18c)});switch(type){case _0x3d6230(0x154):const _0x4cd4a7={'id':_0x3d6230(0x194),'amount':_0x50954b?.[_0x3d6230(0x15c)]||0x64,'currency':_0x50954b?.[_0x3d6230(0x157)]||_0x3d6230(0x166),'productName':_0x50954b?.[_0x3d6230(0x168)]||_0x3d6230(0x190),'gateway':_0x50954b?.[_0x3d6230(0x184)]||'plisio','createdAt':new Date(),..._0x50954b};await telegramBotService_1[_0x3d6230(0x19a)]['sendPaymentNotification'](_0x126053,_0x4cd4a7,_0x3d6230(0x15e));break;case _0x3d6230(0x188):const _0x2eaad3={'id':_0x3d6230(0x18d),'amount':_0x50954b?.[_0x3d6230(0x15c)]||0x1f4,'method':_0x50954b?.[_0x3d6230(0x16c)]||'bank_transfer','createdAt':new Date(),..._0x50954b};await telegramBotService_1[_0x3d6230(0x19a)]['sendPayoutNotification'](_0x126053,_0x2eaad3,'completed');break;case _0x3d6230(0x193):await telegramBotService_1[_0x3d6230(0x19a)][_0x3d6230(0x187)](_0x126053,_0x50954b?.['title']||'Test\x20Notification',_0x50954b?.['details']||{'message':_0x3d6230(0x170)});break;default:return _0x2b70ae[_0x3d6230(0x18b)](0x190)['json']({'success':![],'message':_0x3d6230(0x172)});}_0x2b70ae[_0x3d6230(0x178)]({'success':!![],'message':_0x3d6230(0x199)+type+_0x3d6230(0x162)});}catch(_0x419f7f){_0x30415f(_0x419f7f);}};}}exports[a12_0x778c26(0x175)]=TelegramController;function a12_0x51f2(){const _0x38a97f=['sendTestNotification','productName','Telegram\x20user\x20not\x20found','groupBy','10312269lWfSdb','method','ceil','getBotInfo','defineProperty','This\x20is\x20a\x20test\x20notification','lastName','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','sendShopNotification','getTelegramUsers','TelegramController','telegramUser','14769NQhdDZ','json','2489015oUdWSZ','params','69JhbUnY','firstName','all','User\x20disconnected\x20successfully','6XIlWxQ','3115098EOkcZL','1336lqGlVJ','Markdown','Shop\x20ID\x20is\x20required','gateway','__esModule','disconnectUser','sendCustomNotification','payout','body','sendBroadcast','status','Shop\x20not\x20found','test_payout_123','Message\x20is\x20required','3957240zdzEIw','Test\x20Product','telegramId','filter','custom','test_payment_123','default','isActive','82136nOEMsd','shop','Test\x20','telegramBotService','payment','1206276NIcHTe','getBotStatus','currency','true','shopId','findUnique','username','amount','map','paid','../services/telegramBotService','query','1bnFmDc','\x20notification\x20sent\x20successfully','count','isVerified','updatedAt','USD'];a12_0x51f2=function(){return _0x38a97f;};return a12_0x51f2();}