'use strict';const a14_0x54e2d8=a14_0x4891;(function(_0x58db30,_0x28a8e0){const _0x5674aa=a14_0x4891,_0x3ab47f=_0x58db30();while(!![]){try{const _0x3d0530=-parseInt(_0x5674aa(0x178))/0x1*(-parseInt(_0x5674aa(0x139))/0x2)+parseInt(_0x5674aa(0x17e))/0x3*(-parseInt(_0x5674aa(0x17a))/0x4)+parseInt(_0x5674aa(0x169))/0x5+parseInt(_0x5674aa(0x16b))/0x6*(parseInt(_0x5674aa(0x158))/0x7)+-parseInt(_0x5674aa(0x155))/0x8*(parseInt(_0x5674aa(0x15e))/0x9)+parseInt(_0x5674aa(0x134))/0xa*(parseInt(_0x5674aa(0x172))/0xb)+-parseInt(_0x5674aa(0x133))/0xc;if(_0x3d0530===_0x28a8e0)break;else _0x3ab47f['push'](_0x3ab47f['shift']());}catch(_0x194f1d){_0x3ab47f['push'](_0x3ab47f['shift']());}}}(a14_0x38a7,0x490b6));function a14_0x4891(_0x22b6fc,_0x385c29){const _0x38a716=a14_0x38a7();return a14_0x4891=function(_0x48912a,_0x57a77c){_0x48912a=_0x48912a-0x133;let _0x25bed1=_0x38a716[_0x48912a];return _0x25bed1;},a14_0x4891(_0x22b6fc,_0x385c29);}function a14_0x38a7(){const _0x56482b=['../services/telegramBotService','sendShopNotification','firstName','Markdown','shop','2052567DqxYIP','sendTestNotification','isActive','true','User\x20disconnected\x20successfully','username','2927aslWYT','paid','8OGEVEl','payout','telegramBotService','sendPaymentNotification','95142zqxOpT','USD','getBotStatus','8539296ZCRMIZ','30jTkAhL','Broadcast\x20message\x20sent\x20successfully','details','telegramUser','lastName','164XcXVbn','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','params','Test\x20Product','Shop\x20ID\x20is\x20required','amount','all','findUnique','length','isVerified','currency','\x20notification\x20sent\x20successfully','__esModule','default','gateway','defineProperty','../config/database','findMany','count','method','telegramId','ceil','query','groupBy','plisio','disconnectUser','productName','update','107576fYAaRC','status','map','28777RaBNUP','bank_transfer','custom','body','Shop\x20not\x20found','shopId','153TgEzoJ','sendCustomNotification','__importDefault','filter','json','TelegramController','Test\x20Notification','sendBroadcast','getTelegramUsers','payment','desc','2494545unidjC','title','6TPMClp','Message\x20is\x20required'];a14_0x38a7=function(){return _0x56482b;};return a14_0x38a7();}var __importDefault=this&&this[a14_0x54e2d8(0x160)]||function(_0xcfa944){const _0x8fd301=a14_0x54e2d8;return _0xcfa944&&_0xcfa944[_0x8fd301(0x145)]?_0xcfa944:{'default':_0xcfa944};};Object[a14_0x54e2d8(0x148)](exports,a14_0x54e2d8(0x145),{'value':!![]}),exports[a14_0x54e2d8(0x163)]=void 0x0;const telegramBotService_1=require(a14_0x54e2d8(0x16d)),database_1=__importDefault(require(a14_0x54e2d8(0x149)));class TelegramController{constructor(){const _0x83e042=a14_0x54e2d8;this[_0x83e042(0x180)]=async(_0x5c0156,_0x1278a0,_0x3fc679)=>{const _0x41a3fe=_0x83e042;try{const _0x7f209=telegramBotService_1[_0x41a3fe(0x17c)]['getBotInfo'](),_0x14d362=await database_1[_0x41a3fe(0x146)][_0x41a3fe(0x137)][_0x41a3fe(0x14b)](),_0x295704=await database_1[_0x41a3fe(0x146)][_0x41a3fe(0x137)][_0x41a3fe(0x14b)]({'where':{'isVerified':!![]}}),_0x5a634d=await database_1['default'][_0x41a3fe(0x137)][_0x41a3fe(0x150)]({'by':[_0x41a3fe(0x15d)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1278a0['json']({'success':!![],'result':{'bot':{'isActive':_0x7f209[_0x41a3fe(0x174)],'username':_0x7f209[_0x41a3fe(0x177)]},'statistics':{'totalUsers':_0x14d362,'verifiedUsers':_0x295704,'unverifiedUsers':_0x14d362-_0x295704,'connectedShops':_0x5a634d[_0x41a3fe(0x141)]}}});}catch(_0x1ba540){_0x3fc679(_0x1ba540);}},this[_0x83e042(0x166)]=async(_0x34cf98,_0x535202,_0x165d11)=>{const _0x233095=_0x83e042;try{const {page:page=0x1,limit:limit=0x14,verified:_0x49c3b7}=_0x34cf98[_0x233095(0x14f)],_0x1677ef=(Number(page)-0x1)*Number(limit),_0x5ca342={};_0x49c3b7!==undefined&&(_0x5ca342[_0x233095(0x142)]=_0x49c3b7===_0x233095(0x175));const [_0xab6913,_0x9f493c]=await Promise[_0x233095(0x13f)]([database_1[_0x233095(0x146)][_0x233095(0x137)][_0x233095(0x14a)]({'where':_0x5ca342,'skip':_0x1677ef,'take':Number(limit),'orderBy':{'createdAt':_0x233095(0x168)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x233095(0x146)][_0x233095(0x137)][_0x233095(0x14b)]({'where':_0x5ca342})]);_0x535202[_0x233095(0x162)]({'success':!![],'users':_0xab6913[_0x233095(0x157)](_0x2dd23f=>({'id':_0x2dd23f['id'],'telegramId':_0x2dd23f[_0x233095(0x14d)],'username':_0x2dd23f[_0x233095(0x177)],'firstName':_0x2dd23f[_0x233095(0x16f)],'lastName':_0x2dd23f[_0x233095(0x138)],'isVerified':_0x2dd23f[_0x233095(0x142)],'shop':_0x2dd23f[_0x233095(0x171)],'createdAt':_0x2dd23f['createdAt'],'updatedAt':_0x2dd23f['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x9f493c,'totalPages':Math[_0x233095(0x14e)](_0x9f493c/Number(limit))}});}catch(_0x177ce0){_0x165d11(_0x177ce0);}},this[_0x83e042(0x165)]=async(_0x36dc39,_0x7d4887,_0xd427fa)=>{const _0xea0ac1=_0x83e042;try{const {message:_0x1b82a1,shopId:_0x320f76}=_0x36dc39[_0xea0ac1(0x15b)];if(!_0x1b82a1)return _0x7d4887[_0xea0ac1(0x156)](0x190)[_0xea0ac1(0x162)]({'success':![],'message':_0xea0ac1(0x16c)});if(_0x320f76)await telegramBotService_1[_0xea0ac1(0x17c)][_0xea0ac1(0x16e)](_0x320f76,_0x1b82a1,{'parse_mode':'Markdown'});else{const _0x5c366e=await database_1[_0xea0ac1(0x146)][_0xea0ac1(0x137)][_0xea0ac1(0x14a)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x21351d=[...new Set(_0x5c366e['map'](_0x36319c=>_0x36319c['shopId'])[_0xea0ac1(0x161)](Boolean))];for(const _0x4988fc of _0x21351d){_0x4988fc&&await telegramBotService_1[_0xea0ac1(0x17c)][_0xea0ac1(0x16e)](_0x4988fc,_0x1b82a1,{'parse_mode':_0xea0ac1(0x170)});}}_0x7d4887[_0xea0ac1(0x162)]({'success':!![],'message':_0xea0ac1(0x135)});}catch(_0x1ab4cc){_0xd427fa(_0x1ab4cc);}},this[_0x83e042(0x152)]=async(_0x58da1f,_0x1d3e58,_0x219053)=>{const _0x1dc44e=_0x83e042;try{const {telegramId:_0x4b6326}=_0x58da1f[_0x1dc44e(0x13b)],_0x2c665e=await database_1[_0x1dc44e(0x146)][_0x1dc44e(0x137)][_0x1dc44e(0x140)]({'where':{'telegramId':_0x4b6326},'include':{'shop':!![]}});if(!_0x2c665e)return _0x1d3e58[_0x1dc44e(0x156)](0x194)[_0x1dc44e(0x162)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x1dc44e(0x146)][_0x1dc44e(0x137)][_0x1dc44e(0x154)]({'where':{'telegramId':_0x4b6326},'data':{'shopId':null,'isVerified':![]}}),_0x1d3e58[_0x1dc44e(0x162)]({'success':!![],'message':_0x1dc44e(0x176)});}catch(_0x5dd46e){_0x219053(_0x5dd46e);}},this[_0x83e042(0x173)]=async(_0xd582d0,_0x55cc83,_0x223adc)=>{const _0x54cbb8=_0x83e042;try{const {shopId:_0x167457,type:type=_0x54cbb8(0x167),testData:_0x10f5fb}=_0xd582d0['body'];if(!_0x167457)return _0x55cc83['status'](0x190)[_0x54cbb8(0x162)]({'success':![],'message':_0x54cbb8(0x13d)});const _0x874426=await database_1[_0x54cbb8(0x146)][_0x54cbb8(0x171)]['findUnique']({'where':{'id':_0x167457},'select':{'id':!![],'name':!![]}});if(!_0x874426)return _0x55cc83['status'](0x194)[_0x54cbb8(0x162)]({'success':![],'message':_0x54cbb8(0x15c)});switch(type){case _0x54cbb8(0x167):const _0x3f81e6={'id':'test_payment_123','amount':_0x10f5fb?.[_0x54cbb8(0x13e)]||0x64,'currency':_0x10f5fb?.[_0x54cbb8(0x143)]||_0x54cbb8(0x17f),'productName':_0x10f5fb?.[_0x54cbb8(0x153)]||_0x54cbb8(0x13c),'gateway':_0x10f5fb?.[_0x54cbb8(0x147)]||_0x54cbb8(0x151),'createdAt':new Date(),..._0x10f5fb};await telegramBotService_1[_0x54cbb8(0x17c)][_0x54cbb8(0x17d)](_0x167457,_0x3f81e6,_0x54cbb8(0x179));break;case _0x54cbb8(0x17b):const _0x5a219f={'id':'test_payout_123','amount':_0x10f5fb?.[_0x54cbb8(0x13e)]||0x1f4,'method':_0x10f5fb?.[_0x54cbb8(0x14c)]||_0x54cbb8(0x159),'createdAt':new Date(),..._0x10f5fb};await telegramBotService_1[_0x54cbb8(0x17c)]['sendPayoutNotification'](_0x167457,_0x5a219f,'completed');break;case _0x54cbb8(0x15a):await telegramBotService_1[_0x54cbb8(0x17c)][_0x54cbb8(0x15f)](_0x167457,_0x10f5fb?.[_0x54cbb8(0x16a)]||_0x54cbb8(0x164),_0x10f5fb?.[_0x54cbb8(0x136)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x55cc83[_0x54cbb8(0x156)](0x190)[_0x54cbb8(0x162)]({'success':![],'message':_0x54cbb8(0x13a)});}_0x55cc83[_0x54cbb8(0x162)]({'success':!![],'message':'Test\x20'+type+_0x54cbb8(0x144)});}catch(_0x44d857){_0x223adc(_0x44d857);}};}}exports[a14_0x54e2d8(0x163)]=TelegramController;