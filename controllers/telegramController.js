'use strict';const a14_0x17485d=a14_0x15e2;(function(_0x5ac4b2,_0x928877){const _0x57de2f=a14_0x15e2,_0x391db2=_0x5ac4b2();while(!![]){try{const _0x520c8c=parseInt(_0x57de2f(0xfe))/0x1+parseInt(_0x57de2f(0xf8))/0x2+-parseInt(_0x57de2f(0x106))/0x3*(-parseInt(_0x57de2f(0xf6))/0x4)+parseInt(_0x57de2f(0xcf))/0x5*(parseInt(_0x57de2f(0x10b))/0x6)+-parseInt(_0x57de2f(0xd7))/0x7*(-parseInt(_0x57de2f(0xee))/0x8)+parseInt(_0x57de2f(0xde))/0x9*(parseInt(_0x57de2f(0xd3))/0xa)+-parseInt(_0x57de2f(0xe3))/0xb;if(_0x520c8c===_0x928877)break;else _0x391db2['push'](_0x391db2['shift']());}catch(_0x5a54a1){_0x391db2['push'](_0x391db2['shift']());}}}(a14_0x2e1a,0x2a6ac));function a14_0x2e1a(){const _0x503363=['groupBy','currency','sendTestNotification','gateway','1816OpITrV','isActive','../config/database','__importDefault','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','shop','method','length','436VBCBRb','Telegram\x20user\x20not\x20found','391600SwcUPK','User\x20disconnected\x20successfully','filter','custom','Message\x20is\x20required','Test\x20','202014zFBdnv','payout','findUnique','status','defineProperty','telegramUser','default','test_payment_123','6081nDxVNE','Test\x20Notification','Test\x20Product','__esModule','amount','144AFhuOc','getBotStatus','createdAt','telegramBotService','shopId','lastName','sendShopNotification','sendPaymentNotification','Markdown','5645ZUJQWv','json','This\x20is\x20a\x20test\x20notification','findMany','4150lElyNf','\x20notification\x20sent\x20successfully','update','../services/telegramBotService','4179aVfTQU','bank_transfer','Broadcast\x20message\x20sent\x20successfully','sendPayoutNotification','title','count','isVerified','2538xgIFup','details','true','updatedAt','map','7971282ClMhCs','payment','TelegramController','completed','Shop\x20not\x20found','Shop\x20ID\x20is\x20required','test_payout_123'];a14_0x2e1a=function(){return _0x503363;};return a14_0x2e1a();}var __importDefault=this&&this[a14_0x17485d(0xf1)]||function(_0x136c91){const _0x5de8b5=a14_0x17485d;return _0x136c91&&_0x136c91[_0x5de8b5(0x109)]?_0x136c91:{'default':_0x136c91};};Object[a14_0x17485d(0x102)](exports,a14_0x17485d(0x109),{'value':!![]}),exports[a14_0x17485d(0xe5)]=void 0x0;function a14_0x15e2(_0x550d3d,_0x39b245){const _0x2e1a20=a14_0x2e1a();return a14_0x15e2=function(_0x15e20a,_0xbb3546){_0x15e20a=_0x15e20a-0xcd;let _0x4e44c8=_0x2e1a20[_0x15e20a];return _0x4e44c8;},a14_0x15e2(_0x550d3d,_0x39b245);}const telegramBotService_1=require(a14_0x17485d(0xd6)),database_1=__importDefault(require(a14_0x17485d(0xf0)));class TelegramController{constructor(){const _0x5e942f=a14_0x17485d;this[_0x5e942f(0x10c)]=async(_0x14efe6,_0x74cc6d,_0x2b9953)=>{const _0x3a6003=_0x5e942f;try{const _0x586836=telegramBotService_1[_0x3a6003(0x10e)]['getBotInfo'](),_0x558b4d=await database_1[_0x3a6003(0x104)][_0x3a6003(0x103)][_0x3a6003(0xdc)](),_0x477db5=await database_1['default']['telegramUser'][_0x3a6003(0xdc)]({'where':{'isVerified':!![]}}),_0x53b29c=await database_1[_0x3a6003(0x104)]['telegramUser'][_0x3a6003(0xea)]({'by':[_0x3a6003(0x10f)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x74cc6d['json']({'success':!![],'result':{'bot':{'isActive':_0x586836[_0x3a6003(0xef)],'username':_0x586836['username']},'statistics':{'totalUsers':_0x558b4d,'verifiedUsers':_0x477db5,'unverifiedUsers':_0x558b4d-_0x477db5,'connectedShops':_0x53b29c[_0x3a6003(0xf5)]}}});}catch(_0x8f1fa6){_0x2b9953(_0x8f1fa6);}},this['getTelegramUsers']=async(_0x51cfed,_0x425075,_0x3bad85)=>{const _0x277f27=_0x5e942f;try{const {page:page=0x1,limit:limit=0x14,verified:_0x16267c}=_0x51cfed['query'],_0x27703e=(Number(page)-0x1)*Number(limit),_0x49619c={};_0x16267c!==undefined&&(_0x49619c[_0x277f27(0xdd)]=_0x16267c===_0x277f27(0xe0));const [_0x36752f,_0x326d12]=await Promise['all']([database_1[_0x277f27(0x104)][_0x277f27(0x103)][_0x277f27(0xd2)]({'where':_0x49619c,'skip':_0x27703e,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x277f27(0x103)][_0x277f27(0xdc)]({'where':_0x49619c})]);_0x425075[_0x277f27(0xd0)]({'success':!![],'users':_0x36752f['map'](_0x532762=>({'id':_0x532762['id'],'telegramId':_0x532762['telegramId'],'username':_0x532762['username'],'firstName':_0x532762['firstName'],'lastName':_0x532762[_0x277f27(0x110)],'isVerified':_0x532762[_0x277f27(0xdd)],'shop':_0x532762[_0x277f27(0xf3)],'createdAt':_0x532762[_0x277f27(0x10d)],'updatedAt':_0x532762[_0x277f27(0xe1)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x326d12,'totalPages':Math['ceil'](_0x326d12/Number(limit))}});}catch(_0x1e5e50){_0x3bad85(_0x1e5e50);}},this['sendBroadcast']=async(_0x19ae74,_0x360abe,_0x3775c1)=>{const _0x1ffaff=_0x5e942f;try{const {message:_0x4b5ff6,shopId:_0x4a2111}=_0x19ae74['body'];if(!_0x4b5ff6)return _0x360abe[_0x1ffaff(0x101)](0x190)[_0x1ffaff(0xd0)]({'success':![],'message':_0x1ffaff(0xfc)});if(_0x4a2111)await telegramBotService_1[_0x1ffaff(0x10e)][_0x1ffaff(0x111)](_0x4a2111,_0x4b5ff6,{'parse_mode':'Markdown'});else{const _0x23c4cb=await database_1[_0x1ffaff(0x104)]['telegramUser'][_0x1ffaff(0xd2)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5a2990=[...new Set(_0x23c4cb[_0x1ffaff(0xe2)](_0xfa2d89=>_0xfa2d89[_0x1ffaff(0x10f)])[_0x1ffaff(0xfa)](Boolean))];for(const _0x1dabb0 of _0x5a2990){_0x1dabb0&&await telegramBotService_1['telegramBotService'][_0x1ffaff(0x111)](_0x1dabb0,_0x4b5ff6,{'parse_mode':_0x1ffaff(0xce)});}}_0x360abe[_0x1ffaff(0xd0)]({'success':!![],'message':_0x1ffaff(0xd9)});}catch(_0x2b2cb0){_0x3775c1(_0x2b2cb0);}},this['disconnectUser']=async(_0xe33d2a,_0x483635,_0x2ae9cb)=>{const _0x6456b7=_0x5e942f;try{const {telegramId:_0x2b2d2a}=_0xe33d2a['params'],_0x2e7596=await database_1[_0x6456b7(0x104)][_0x6456b7(0x103)][_0x6456b7(0x100)]({'where':{'telegramId':_0x2b2d2a},'include':{'shop':!![]}});if(!_0x2e7596)return _0x483635[_0x6456b7(0x101)](0x194)[_0x6456b7(0xd0)]({'success':![],'message':_0x6456b7(0xf7)});await database_1['default']['telegramUser'][_0x6456b7(0xd5)]({'where':{'telegramId':_0x2b2d2a},'data':{'shopId':null,'isVerified':![]}}),_0x483635[_0x6456b7(0xd0)]({'success':!![],'message':_0x6456b7(0xf9)});}catch(_0x3a0ad6){_0x2ae9cb(_0x3a0ad6);}},this[_0x5e942f(0xec)]=async(_0x23f9f9,_0x5155ac,_0x237a6a)=>{const _0x410f24=_0x5e942f;try{const {shopId:_0xdd7d8c,type:type='payment',testData:_0x22688f}=_0x23f9f9['body'];if(!_0xdd7d8c)return _0x5155ac[_0x410f24(0x101)](0x190)[_0x410f24(0xd0)]({'success':![],'message':_0x410f24(0xe8)});const _0x5a0a3c=await database_1[_0x410f24(0x104)][_0x410f24(0xf3)][_0x410f24(0x100)]({'where':{'id':_0xdd7d8c},'select':{'id':!![],'name':!![]}});if(!_0x5a0a3c)return _0x5155ac[_0x410f24(0x101)](0x194)[_0x410f24(0xd0)]({'success':![],'message':_0x410f24(0xe7)});switch(type){case _0x410f24(0xe4):const _0x22a5a1={'id':_0x410f24(0x105),'amount':_0x22688f?.[_0x410f24(0x10a)]||0x64,'currency':_0x22688f?.[_0x410f24(0xeb)]||'USD','productName':_0x22688f?.['productName']||_0x410f24(0x108),'gateway':_0x22688f?.[_0x410f24(0xed)]||'plisio','createdAt':new Date(),..._0x22688f};await telegramBotService_1[_0x410f24(0x10e)][_0x410f24(0xcd)](_0xdd7d8c,_0x22a5a1,'paid');break;case _0x410f24(0xff):const _0x1134c0={'id':_0x410f24(0xe9),'amount':_0x22688f?.[_0x410f24(0x10a)]||0x1f4,'method':_0x22688f?.[_0x410f24(0xf4)]||_0x410f24(0xd8),'createdAt':new Date(),..._0x22688f};await telegramBotService_1['telegramBotService'][_0x410f24(0xda)](_0xdd7d8c,_0x1134c0,_0x410f24(0xe6));break;case _0x410f24(0xfb):await telegramBotService_1['telegramBotService']['sendCustomNotification'](_0xdd7d8c,_0x22688f?.[_0x410f24(0xdb)]||_0x410f24(0x107),_0x22688f?.[_0x410f24(0xdf)]||{'message':_0x410f24(0xd1)});break;default:return _0x5155ac[_0x410f24(0x101)](0x190)['json']({'success':![],'message':_0x410f24(0xf2)});}_0x5155ac[_0x410f24(0xd0)]({'success':!![],'message':_0x410f24(0xfd)+type+_0x410f24(0xd4)});}catch(_0x443bdb){_0x237a6a(_0x443bdb);}};}}exports[a14_0x17485d(0xe5)]=TelegramController;