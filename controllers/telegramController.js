'use strict';function a12_0x5ea3(){const _0xd7d3c5=['lastName','Broadcast\x20message\x20sent\x20successfully','3XgHFCb','findUnique','body','shopId','297598osuDfI','../services/telegramBotService','amount','params','bank_transfer','\x20notification\x20sent\x20successfully','Test\x20','createdAt','__esModule','Test\x20Notification','getTelegramUsers','json','Markdown','isActive','filter','plisio','354286hPuixJ','map','sendBroadcast','default','getBotInfo','details','true','test_payout_123','__importDefault','getBotStatus','gateway','title','sendPaymentNotification','Test\x20Product','296lglXHr','payment','count','firstName','isVerified','sendTestNotification','User\x20disconnected\x20successfully','updatedAt','defineProperty','4760916DqOYqf','update','custom','USD','sendCustomNotification','11009424BXSJEO','test_payment_123','shop','findMany','../config/database','status','groupBy','145269YJnltc','all','telegramUser','Message\x20is\x20required','11cYlOYD','12KCeztd','Telegram\x20user\x20not\x20found','disconnectUser','paid','10452740nGdLJF','TelegramController','completed','1749358OurrDx','Shop\x20ID\x20is\x20required','telegramBotService','5nLOuBe','username','method'];a12_0x5ea3=function(){return _0xd7d3c5;};return a12_0x5ea3();}const a12_0x3fafc6=a12_0x4844;function a12_0x4844(_0x2ad2f4,_0x1f07fc){const _0x5ea388=a12_0x5ea3();return a12_0x4844=function(_0x48440e,_0x8d175a){_0x48440e=_0x48440e-0x70;let _0x2882d7=_0x5ea388[_0x48440e];return _0x2882d7;},a12_0x4844(_0x2ad2f4,_0x1f07fc);}(function(_0x2031dd,_0x4f627f){const _0x25ae0c=a12_0x4844,_0x567a50=_0x2031dd();while(!![]){try{const _0x562d0a=-parseInt(_0x25ae0c(0xac))/0x1+parseInt(_0x25ae0c(0x90))/0x2*(-parseInt(_0x25ae0c(0x98))/0x3)+parseInt(_0x25ae0c(0x78))/0x4*(parseInt(_0x25ae0c(0x93))/0x5)+parseInt(_0x25ae0c(0x89))/0x6*(parseInt(_0x25ae0c(0x9c))/0x7)+parseInt(_0x25ae0c(0xba))/0x8*(parseInt(_0x25ae0c(0x84))/0x9)+-parseInt(_0x25ae0c(0x8d))/0xa*(-parseInt(_0x25ae0c(0x88))/0xb)+-parseInt(_0x25ae0c(0x7d))/0xc;if(_0x562d0a===_0x4f627f)break;else _0x567a50['push'](_0x567a50['shift']());}catch(_0xb9fbc){_0x567a50['push'](_0x567a50['shift']());}}}(a12_0x5ea3,0xbc503));var __importDefault=this&&this[a12_0x3fafc6(0xb4)]||function(_0x52d245){const _0x1acd64=a12_0x3fafc6;return _0x52d245&&_0x52d245[_0x1acd64(0xa4)]?_0x52d245:{'default':_0x52d245};};Object[a12_0x3fafc6(0x77)](exports,a12_0x3fafc6(0xa4),{'value':!![]}),exports[a12_0x3fafc6(0x8e)]=void 0x0;const telegramBotService_1=require(a12_0x3fafc6(0x9d)),database_1=__importDefault(require(a12_0x3fafc6(0x81)));class TelegramController{constructor(){const _0x70fb9c=a12_0x3fafc6;this[_0x70fb9c(0xb5)]=async(_0x4ddaa8,_0x10cd9d,_0x426225)=>{const _0x22b11c=_0x70fb9c;try{const _0x2e36bf=telegramBotService_1[_0x22b11c(0x92)][_0x22b11c(0xb0)](),_0x1ec9bb=await database_1['default'][_0x22b11c(0x86)][_0x22b11c(0x71)](),_0x38e59f=await database_1[_0x22b11c(0xaf)][_0x22b11c(0x86)][_0x22b11c(0x71)]({'where':{'isVerified':!![]}}),_0x5b34cb=await database_1['default'][_0x22b11c(0x86)][_0x22b11c(0x83)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x10cd9d[_0x22b11c(0xa7)]({'success':!![],'result':{'bot':{'isActive':_0x2e36bf[_0x22b11c(0xa9)],'username':_0x2e36bf[_0x22b11c(0x94)]},'statistics':{'totalUsers':_0x1ec9bb,'verifiedUsers':_0x38e59f,'unverifiedUsers':_0x1ec9bb-_0x38e59f,'connectedShops':_0x5b34cb['length']}}});}catch(_0x277155){_0x426225(_0x277155);}},this[_0x70fb9c(0xa6)]=async(_0x2a4a87,_0x5775f6,_0x1b776d)=>{const _0x379854=_0x70fb9c;try{const {page:page=0x1,limit:limit=0x14,verified:_0x393a3b}=_0x2a4a87['query'],_0x24c65d=(Number(page)-0x1)*Number(limit),_0x48aff7={};_0x393a3b!==undefined&&(_0x48aff7['isVerified']=_0x393a3b===_0x379854(0xb2));const [_0x262a84,_0x4e72d4]=await Promise[_0x379854(0x85)]([database_1['default'][_0x379854(0x86)][_0x379854(0x80)]({'where':_0x48aff7,'skip':_0x24c65d,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x379854(0xaf)]['telegramUser']['count']({'where':_0x48aff7})]);_0x5775f6['json']({'success':!![],'users':_0x262a84[_0x379854(0xad)](_0x3d0d50=>({'id':_0x3d0d50['id'],'telegramId':_0x3d0d50['telegramId'],'username':_0x3d0d50[_0x379854(0x94)],'firstName':_0x3d0d50[_0x379854(0x72)],'lastName':_0x3d0d50[_0x379854(0x96)],'isVerified':_0x3d0d50[_0x379854(0x73)],'shop':_0x3d0d50[_0x379854(0x7f)],'createdAt':_0x3d0d50[_0x379854(0xa3)],'updatedAt':_0x3d0d50[_0x379854(0x76)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x4e72d4,'totalPages':Math['ceil'](_0x4e72d4/Number(limit))}});}catch(_0x282681){_0x1b776d(_0x282681);}},this[_0x70fb9c(0xae)]=async(_0x1d5d26,_0x1ce016,_0x43d01b)=>{const _0x3cc5a1=_0x70fb9c;try{const {message:_0xfd0a4b,shopId:_0x58af2a}=_0x1d5d26[_0x3cc5a1(0x9a)];if(!_0xfd0a4b)return _0x1ce016[_0x3cc5a1(0x82)](0x190)['json']({'success':![],'message':_0x3cc5a1(0x87)});if(_0x58af2a)await telegramBotService_1[_0x3cc5a1(0x92)]['sendShopNotification'](_0x58af2a,_0xfd0a4b,{'parse_mode':_0x3cc5a1(0xa8)});else{const _0x318f19=await database_1[_0x3cc5a1(0xaf)][_0x3cc5a1(0x86)][_0x3cc5a1(0x80)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2669fa=[...new Set(_0x318f19[_0x3cc5a1(0xad)](_0x1a3074=>_0x1a3074[_0x3cc5a1(0x9b)])[_0x3cc5a1(0xaa)](Boolean))];for(const _0x498331 of _0x2669fa){_0x498331&&await telegramBotService_1[_0x3cc5a1(0x92)]['sendShopNotification'](_0x498331,_0xfd0a4b,{'parse_mode':_0x3cc5a1(0xa8)});}}_0x1ce016[_0x3cc5a1(0xa7)]({'success':!![],'message':_0x3cc5a1(0x97)});}catch(_0x28c9e3){_0x43d01b(_0x28c9e3);}},this[_0x70fb9c(0x8b)]=async(_0xa36d15,_0x40b11a,_0x330046)=>{const _0x26ff3=_0x70fb9c;try{const {telegramId:_0x40cdb4}=_0xa36d15[_0x26ff3(0x9f)],_0x17b3fc=await database_1[_0x26ff3(0xaf)][_0x26ff3(0x86)][_0x26ff3(0x99)]({'where':{'telegramId':_0x40cdb4},'include':{'shop':!![]}});if(!_0x17b3fc)return _0x40b11a[_0x26ff3(0x82)](0x194)[_0x26ff3(0xa7)]({'success':![],'message':_0x26ff3(0x8a)});await database_1[_0x26ff3(0xaf)]['telegramUser'][_0x26ff3(0x79)]({'where':{'telegramId':_0x40cdb4},'data':{'shopId':null,'isVerified':![]}}),_0x40b11a[_0x26ff3(0xa7)]({'success':!![],'message':_0x26ff3(0x75)});}catch(_0x204a81){_0x330046(_0x204a81);}},this[_0x70fb9c(0x74)]=async(_0x208e88,_0x4b5923,_0x518373)=>{const _0x3a0c44=_0x70fb9c;try{const {shopId:_0x537b82,type:type=_0x3a0c44(0x70),testData:_0x2d9585}=_0x208e88[_0x3a0c44(0x9a)];if(!_0x537b82)return _0x4b5923[_0x3a0c44(0x82)](0x190)[_0x3a0c44(0xa7)]({'success':![],'message':_0x3a0c44(0x91)});const _0x1d1bb7=await database_1['default'][_0x3a0c44(0x7f)]['findUnique']({'where':{'id':_0x537b82},'select':{'id':!![],'name':!![]}});if(!_0x1d1bb7)return _0x4b5923['status'](0x194)[_0x3a0c44(0xa7)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0xeb5c35={'id':_0x3a0c44(0x7e),'amount':_0x2d9585?.[_0x3a0c44(0x9e)]||0x64,'currency':_0x2d9585?.['currency']||_0x3a0c44(0x7b),'productName':_0x2d9585?.['productName']||_0x3a0c44(0xb9),'gateway':_0x2d9585?.[_0x3a0c44(0xb6)]||_0x3a0c44(0xab),'createdAt':new Date(),..._0x2d9585};await telegramBotService_1['telegramBotService'][_0x3a0c44(0xb8)](_0x537b82,_0xeb5c35,_0x3a0c44(0x8c));break;case'payout':const _0x27b00b={'id':_0x3a0c44(0xb3),'amount':_0x2d9585?.[_0x3a0c44(0x9e)]||0x1f4,'method':_0x2d9585?.[_0x3a0c44(0x95)]||_0x3a0c44(0xa0),'createdAt':new Date(),..._0x2d9585};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x537b82,_0x27b00b,_0x3a0c44(0x8f));break;case _0x3a0c44(0x7a):await telegramBotService_1[_0x3a0c44(0x92)][_0x3a0c44(0x7c)](_0x537b82,_0x2d9585?.[_0x3a0c44(0xb7)]||_0x3a0c44(0xa5),_0x2d9585?.[_0x3a0c44(0xb1)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x4b5923[_0x3a0c44(0x82)](0x190)[_0x3a0c44(0xa7)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x4b5923[_0x3a0c44(0xa7)]({'success':!![],'message':_0x3a0c44(0xa2)+type+_0x3a0c44(0xa1)});}catch(_0x416856){_0x518373(_0x416856);}};}}exports['TelegramController']=TelegramController;