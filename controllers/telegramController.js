'use strict';function a14_0x13b0(_0x2adfe6,_0x4ee1af){const _0x5079d5=a14_0x5079();return a14_0x13b0=function(_0x13b0a7,_0x59775e){_0x13b0a7=_0x13b0a7-0x1be;let _0x46250d=_0x5079d5[_0x13b0a7];return _0x46250d;},a14_0x13b0(_0x2adfe6,_0x4ee1af);}const a14_0x2ad396=a14_0x13b0;(function(_0x214d44,_0x4b2180){const _0x22242b=a14_0x13b0,_0x527cf7=_0x214d44();while(!![]){try{const _0x25ded2=parseInt(_0x22242b(0x1d5))/0x1+parseInt(_0x22242b(0x1c8))/0x2+parseInt(_0x22242b(0x1f5))/0x3+parseInt(_0x22242b(0x1dc))/0x4+parseInt(_0x22242b(0x1e2))/0x5*(parseInt(_0x22242b(0x1ca))/0x6)+-parseInt(_0x22242b(0x1dd))/0x7*(parseInt(_0x22242b(0x1f7))/0x8)+-parseInt(_0x22242b(0x1ee))/0x9;if(_0x25ded2===_0x4b2180)break;else _0x527cf7['push'](_0x527cf7['shift']());}catch(_0x58aba1){_0x527cf7['push'](_0x527cf7['shift']());}}}(a14_0x5079,0xc3fda));function a14_0x5079(){const _0x57e608=['getTelegramUsers','filter','update','json','isVerified','findUnique','196490jXXTrr','telegramBotService','all','query','network','Broadcast\x20message\x20sent\x20successfully','sendPaymentNotification','5483376HklWTq','21fowrXB','sendBroadcast','sendCustomNotification','This\x20is\x20a\x20test\x20notification','amount','115FHxpjt','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','getBotInfo','__esModule','map','status','telegramUser','paid','custom','Message\x20is\x20required','groupBy','productName','11178612unTNMO','shopId','payout','lastName','\x20notification\x20sent\x20successfully','../config/database','length','714456yofvih','TelegramController','2132968ADOEaU','firstName','findMany','sendPayoutNotification','true','username','telegramId','wallet','Markdown','currency','defineProperty','getBotStatus','Telegram\x20user\x20not\x20found','Shop\x20ID\x20is\x20required','payment','default','Test\x20Notification','../services/telegramBotService','test_payment_123','__importDefault','Test\x20','isActive','shop','txid','Shop\x20not\x20found','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','1662284NscIfy','count','54282QsZJdH','params','createdAt','plisio','desc'];a14_0x5079=function(){return _0x57e608;};return a14_0x5079();}var __importDefault=this&&this[a14_0x2ad396(0x1c1)]||function(_0x3ec081){const _0x486013=a14_0x2ad396;return _0x3ec081&&_0x3ec081[_0x486013(0x1e5)]?_0x3ec081:{'default':_0x3ec081};};Object[a14_0x2ad396(0x201)](exports,a14_0x2ad396(0x1e5),{'value':!![]}),exports[a14_0x2ad396(0x1f6)]=void 0x0;const telegramBotService_1=require(a14_0x2ad396(0x1bf)),database_1=__importDefault(require(a14_0x2ad396(0x1f3)));class TelegramController{constructor(){const _0x3a7bf5=a14_0x2ad396;this[_0x3a7bf5(0x202)]=async(_0x2db778,_0x9ad5f4,_0x327495)=>{const _0x26e664=_0x3a7bf5;try{const _0x356cf3=telegramBotService_1[_0x26e664(0x1d6)][_0x26e664(0x1e4)](),_0x3d36da=await database_1[_0x26e664(0x206)][_0x26e664(0x1e8)][_0x26e664(0x1c9)](),_0x11d2ba=await database_1['default'][_0x26e664(0x1e8)][_0x26e664(0x1c9)]({'where':{'isVerified':!![]}}),_0x504145=await database_1['default']['telegramUser'][_0x26e664(0x1ec)]({'by':[_0x26e664(0x1ef)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x9ad5f4[_0x26e664(0x1d2)]({'success':!![],'result':{'bot':{'isActive':_0x356cf3[_0x26e664(0x1c3)],'username':_0x356cf3['username']},'statistics':{'totalUsers':_0x3d36da,'verifiedUsers':_0x11d2ba,'unverifiedUsers':_0x3d36da-_0x11d2ba,'connectedShops':_0x504145[_0x26e664(0x1f4)]}}});}catch(_0x4bdb07){_0x327495(_0x4bdb07);}},this[_0x3a7bf5(0x1cf)]=async(_0x133370,_0x349773,_0x2a4c9d)=>{const _0x558233=_0x3a7bf5;try{const {page:page=0x1,limit:limit=0x14,verified:_0x207347}=_0x133370[_0x558233(0x1d8)],_0x3bff00=(Number(page)-0x1)*Number(limit),_0x519945={};_0x207347!==undefined&&(_0x519945[_0x558233(0x1d3)]=_0x207347===_0x558233(0x1fb));const [_0x2138d0,_0x475e9c]=await Promise[_0x558233(0x1d7)]([database_1[_0x558233(0x206)]['telegramUser'][_0x558233(0x1f9)]({'where':_0x519945,'skip':_0x3bff00,'take':Number(limit),'orderBy':{'createdAt':_0x558233(0x1ce)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['telegramUser'][_0x558233(0x1c9)]({'where':_0x519945})]);_0x349773[_0x558233(0x1d2)]({'success':!![],'users':_0x2138d0['map'](_0x17b356=>({'id':_0x17b356['id'],'telegramId':_0x17b356[_0x558233(0x1fd)],'username':_0x17b356[_0x558233(0x1fc)],'firstName':_0x17b356[_0x558233(0x1f8)],'lastName':_0x17b356[_0x558233(0x1f1)],'isVerified':_0x17b356[_0x558233(0x1d3)],'shop':_0x17b356[_0x558233(0x1c4)],'createdAt':_0x17b356[_0x558233(0x1cc)],'updatedAt':_0x17b356['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x475e9c,'totalPages':Math['ceil'](_0x475e9c/Number(limit))}});}catch(_0x4a9851){_0x2a4c9d(_0x4a9851);}},this[_0x3a7bf5(0x1de)]=async(_0xbccd72,_0x3e7097,_0x2e0a17)=>{const _0x940cd2=_0x3a7bf5;try{const {message:_0x2a4c81,shopId:_0x5dcf19}=_0xbccd72['body'];if(!_0x2a4c81)return _0x3e7097[_0x940cd2(0x1e7)](0x190)[_0x940cd2(0x1d2)]({'success':![],'message':_0x940cd2(0x1eb)});if(_0x5dcf19)await telegramBotService_1[_0x940cd2(0x1d6)]['sendShopNotification'](_0x5dcf19,_0x2a4c81,{'parse_mode':_0x940cd2(0x1ff)});else{const _0x105d92=await database_1[_0x940cd2(0x206)][_0x940cd2(0x1e8)][_0x940cd2(0x1f9)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1759c1=[...new Set(_0x105d92[_0x940cd2(0x1e6)](_0x2dac55=>_0x2dac55[_0x940cd2(0x1ef)])[_0x940cd2(0x1d0)](Boolean))];for(const _0x36606d of _0x1759c1){_0x36606d&&await telegramBotService_1[_0x940cd2(0x1d6)]['sendShopNotification'](_0x36606d,_0x2a4c81,{'parse_mode':_0x940cd2(0x1ff)});}}_0x3e7097[_0x940cd2(0x1d2)]({'success':!![],'message':_0x940cd2(0x1da)});}catch(_0x5dc760){_0x2e0a17(_0x5dc760);}},this['disconnectUser']=async(_0x18ff72,_0x5d1c36,_0x582b3b)=>{const _0x968d9c=_0x3a7bf5;try{const {telegramId:_0x2d15c0}=_0x18ff72[_0x968d9c(0x1cb)],_0x48334c=await database_1[_0x968d9c(0x206)]['telegramUser'][_0x968d9c(0x1d4)]({'where':{'telegramId':_0x2d15c0},'include':{'shop':!![]}});if(!_0x48334c)return _0x5d1c36[_0x968d9c(0x1e7)](0x194)['json']({'success':![],'message':_0x968d9c(0x203)});await database_1[_0x968d9c(0x206)][_0x968d9c(0x1e8)][_0x968d9c(0x1d1)]({'where':{'telegramId':_0x2d15c0},'data':{'shopId':null,'isVerified':![]}}),_0x5d1c36[_0x968d9c(0x1d2)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x1ae9e5){_0x582b3b(_0x1ae9e5);}},this['sendTestNotification']=async(_0x539aa2,_0x432b0e,_0x54ed0f)=>{const _0x3fd797=_0x3a7bf5;try{const {shopId:_0x340ba3,type:type=_0x3fd797(0x205),testData:_0x18398d}=_0x539aa2['body'];if(!_0x340ba3)return _0x432b0e['status'](0x190)['json']({'success':![],'message':_0x3fd797(0x204)});const _0x50a9f6=await database_1[_0x3fd797(0x206)]['shop'][_0x3fd797(0x1d4)]({'where':{'id':_0x340ba3},'select':{'id':!![],'name':!![]}});if(!_0x50a9f6)return _0x432b0e[_0x3fd797(0x1e7)](0x194)['json']({'success':![],'message':_0x3fd797(0x1c6)});switch(type){case _0x3fd797(0x205):const _0x1fa785={'id':_0x3fd797(0x1c0),'amount':_0x18398d?.['amount']||0x64,'currency':_0x18398d?.[_0x3fd797(0x200)]||'USD','productName':_0x18398d?.[_0x3fd797(0x1ed)]||'Test\x20Product','gateway':_0x18398d?.['gateway']||_0x3fd797(0x1cd),'createdAt':new Date(),..._0x18398d};await telegramBotService_1['telegramBotService'][_0x3fd797(0x1db)](_0x340ba3,_0x1fa785,_0x3fd797(0x1e9));break;case _0x3fd797(0x1f0):const _0x559d49={'id':'test_payout_123','amount':_0x18398d?.[_0x3fd797(0x1e1)]||0x1f4,'network':_0x18398d?.[_0x3fd797(0x1d9)]||'TRC20','wallet':_0x18398d?.[_0x3fd797(0x1fe)]||_0x3fd797(0x1c7),'period':'Тестовый\x20период','createdAt':new Date(),'txid':_0x18398d?.[_0x3fd797(0x1c5)]||null,..._0x18398d};await telegramBotService_1[_0x3fd797(0x1d6)][_0x3fd797(0x1fa)](_0x340ba3,_0x559d49);break;case _0x3fd797(0x1ea):await telegramBotService_1[_0x3fd797(0x1d6)][_0x3fd797(0x1df)](_0x340ba3,_0x18398d?.['title']||_0x3fd797(0x1be),_0x18398d?.['details']||{'message':_0x3fd797(0x1e0)});break;default:return _0x432b0e[_0x3fd797(0x1e7)](0x190)[_0x3fd797(0x1d2)]({'success':![],'message':_0x3fd797(0x1e3)});}_0x432b0e[_0x3fd797(0x1d2)]({'success':!![],'message':_0x3fd797(0x1c2)+type+_0x3fd797(0x1f2)});}catch(_0x514138){_0x54ed0f(_0x514138);}};}}exports[a14_0x2ad396(0x1f6)]=TelegramController;