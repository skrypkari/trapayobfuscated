'use strict';const a13_0x632f0a=a13_0x118a;(function(_0x2a8870,_0x5aa257){const _0x3a1e06=a13_0x118a,_0x4ac2bc=_0x2a8870();while(!![]){try{const _0x61fc59=parseInt(_0x3a1e06(0x18b))/0x1*(-parseInt(_0x3a1e06(0x1a7))/0x2)+parseInt(_0x3a1e06(0x198))/0x3+-parseInt(_0x3a1e06(0x1c6))/0x4+-parseInt(_0x3a1e06(0x1ba))/0x5+parseInt(_0x3a1e06(0x1b5))/0x6*(-parseInt(_0x3a1e06(0x1b7))/0x7)+-parseInt(_0x3a1e06(0x1a9))/0x8*(-parseInt(_0x3a1e06(0x18a))/0x9)+-parseInt(_0x3a1e06(0x18d))/0xa*(-parseInt(_0x3a1e06(0x1ca))/0xb);if(_0x61fc59===_0x5aa257)break;else _0x4ac2bc['push'](_0x4ac2bc['shift']());}catch(_0x3ef958){_0x4ac2bc['push'](_0x4ac2bc['shift']());}}}(a13_0x41a4,0xcc087));function a13_0x41a4(){const _0x59f6a0=['Markdown','paid','sendShopNotification','title','182peRpdl','This\x20is\x20a\x20test\x20notification','8vXquZD','telegramId','ceil','update','findMany','Shop\x20not\x20found','currency','completed','shop','../config/database','../services/telegramBotService','telegramBotService','2956902tDVjrN','isActive','7HStOUV','getBotInfo','payment','2856620WlrScB','true','map','USD','filter','username','Telegram\x20user\x20not\x20found','telegramUser','disconnectUser','status','shopId','TelegramController','3887316UXNWnN','groupBy','count','details','2189XLITgA','sendBroadcast','length','plisio','custom','desc','updatedAt','sendPaymentNotification','isVerified','14769675xxBTHb','3652Pitxdq','Test\x20Product','13170AwNRaU','Test\x20','__importDefault','bank_transfer','body','test_payment_123','query','getBotStatus','params','amount','test_payout_123','3902589YWLSkD','\x20notification\x20sent\x20successfully','Test\x20Notification','sendCustomNotification','defineProperty','gateway','__esModule','Broadcast\x20message\x20sent\x20successfully','json','default','findUnique'];a13_0x41a4=function(){return _0x59f6a0;};return a13_0x41a4();}var __importDefault=this&&this[a13_0x632f0a(0x18f)]||function(_0x5bd397){return _0x5bd397&&_0x5bd397['__esModule']?_0x5bd397:{'default':_0x5bd397};};Object[a13_0x632f0a(0x19c)](exports,a13_0x632f0a(0x19e),{'value':!![]}),exports[a13_0x632f0a(0x1c5)]=void 0x0;const telegramBotService_1=require(a13_0x632f0a(0x1b3)),database_1=__importDefault(require(a13_0x632f0a(0x1b2)));class TelegramController{constructor(){const _0x309bb0=a13_0x632f0a;this[_0x309bb0(0x194)]=async(_0x5898ad,_0xb42f39,_0x54685f)=>{const _0x4cb0cd=_0x309bb0;try{const _0x84b7f6=telegramBotService_1[_0x4cb0cd(0x1b4)][_0x4cb0cd(0x1b8)](),_0xd1e56f=await database_1['default'][_0x4cb0cd(0x1c1)][_0x4cb0cd(0x1c8)](),_0x1ce0c1=await database_1[_0x4cb0cd(0x1a1)][_0x4cb0cd(0x1c1)][_0x4cb0cd(0x1c8)]({'where':{'isVerified':!![]}}),_0x298d38=await database_1['default'][_0x4cb0cd(0x1c1)][_0x4cb0cd(0x1c7)]({'by':[_0x4cb0cd(0x1c4)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xb42f39[_0x4cb0cd(0x1a0)]({'success':!![],'result':{'bot':{'isActive':_0x84b7f6[_0x4cb0cd(0x1b6)],'username':_0x84b7f6[_0x4cb0cd(0x1bf)]},'statistics':{'totalUsers':_0xd1e56f,'verifiedUsers':_0x1ce0c1,'unverifiedUsers':_0xd1e56f-_0x1ce0c1,'connectedShops':_0x298d38[_0x4cb0cd(0x1cc)]}}});}catch(_0x16cad8){_0x54685f(_0x16cad8);}},this['getTelegramUsers']=async(_0x1ab391,_0x312d3c,_0x537516)=>{const _0x4c9f6b=_0x309bb0;try{const {page:page=0x1,limit:limit=0x14,verified:_0x596e62}=_0x1ab391[_0x4c9f6b(0x193)],_0x4c8353=(Number(page)-0x1)*Number(limit),_0x366349={};_0x596e62!==undefined&&(_0x366349[_0x4c9f6b(0x189)]=_0x596e62===_0x4c9f6b(0x1bb));const [_0x402254,_0x3d84ee]=await Promise['all']([database_1['default'][_0x4c9f6b(0x1c1)][_0x4c9f6b(0x1ad)]({'where':_0x366349,'skip':_0x4c8353,'take':Number(limit),'orderBy':{'createdAt':_0x4c9f6b(0x1cf)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4c9f6b(0x1a1)][_0x4c9f6b(0x1c1)]['count']({'where':_0x366349})]);_0x312d3c['json']({'success':!![],'users':_0x402254[_0x4c9f6b(0x1bc)](_0x28d092=>({'id':_0x28d092['id'],'telegramId':_0x28d092[_0x4c9f6b(0x1aa)],'username':_0x28d092['username'],'firstName':_0x28d092['firstName'],'lastName':_0x28d092['lastName'],'isVerified':_0x28d092['isVerified'],'shop':_0x28d092['shop'],'createdAt':_0x28d092['createdAt'],'updatedAt':_0x28d092[_0x4c9f6b(0x1d0)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3d84ee,'totalPages':Math[_0x4c9f6b(0x1ab)](_0x3d84ee/Number(limit))}});}catch(_0x1ea7a7){_0x537516(_0x1ea7a7);}},this[_0x309bb0(0x1cb)]=async(_0x1f1477,_0x1fefad,_0x412757)=>{const _0xa22b1e=_0x309bb0;try{const {message:_0x13feea,shopId:_0x39f5f1}=_0x1f1477[_0xa22b1e(0x191)];if(!_0x13feea)return _0x1fefad[_0xa22b1e(0x1c3)](0x190)['json']({'success':![],'message':'Message\x20is\x20required'});if(_0x39f5f1)await telegramBotService_1[_0xa22b1e(0x1b4)][_0xa22b1e(0x1a5)](_0x39f5f1,_0x13feea,{'parse_mode':_0xa22b1e(0x1a3)});else{const _0x1c7218=await database_1[_0xa22b1e(0x1a1)]['telegramUser'][_0xa22b1e(0x1ad)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5debd2=[...new Set(_0x1c7218[_0xa22b1e(0x1bc)](_0x42e2c0=>_0x42e2c0[_0xa22b1e(0x1c4)])[_0xa22b1e(0x1be)](Boolean))];for(const _0x1b13f2 of _0x5debd2){_0x1b13f2&&await telegramBotService_1[_0xa22b1e(0x1b4)]['sendShopNotification'](_0x1b13f2,_0x13feea,{'parse_mode':_0xa22b1e(0x1a3)});}}_0x1fefad['json']({'success':!![],'message':_0xa22b1e(0x19f)});}catch(_0x3ddf83){_0x412757(_0x3ddf83);}},this[_0x309bb0(0x1c2)]=async(_0x2cf0c1,_0x5c4dac,_0xae44ae)=>{const _0x1b8ce7=_0x309bb0;try{const {telegramId:_0x1f5d01}=_0x2cf0c1[_0x1b8ce7(0x195)],_0x50a3c6=await database_1[_0x1b8ce7(0x1a1)][_0x1b8ce7(0x1c1)][_0x1b8ce7(0x1a2)]({'where':{'telegramId':_0x1f5d01},'include':{'shop':!![]}});if(!_0x50a3c6)return _0x5c4dac[_0x1b8ce7(0x1c3)](0x194)[_0x1b8ce7(0x1a0)]({'success':![],'message':_0x1b8ce7(0x1c0)});await database_1['default']['telegramUser'][_0x1b8ce7(0x1ac)]({'where':{'telegramId':_0x1f5d01},'data':{'shopId':null,'isVerified':![]}}),_0x5c4dac[_0x1b8ce7(0x1a0)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x33dcde){_0xae44ae(_0x33dcde);}},this['sendTestNotification']=async(_0x432faa,_0x16712b,_0x11be6b)=>{const _0x41ad33=_0x309bb0;try{const {shopId:_0x3f914e,type:type=_0x41ad33(0x1b9),testData:_0x48564a}=_0x432faa[_0x41ad33(0x191)];if(!_0x3f914e)return _0x16712b['status'](0x190)[_0x41ad33(0x1a0)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0xeee26b=await database_1[_0x41ad33(0x1a1)][_0x41ad33(0x1b1)][_0x41ad33(0x1a2)]({'where':{'id':_0x3f914e},'select':{'id':!![],'name':!![]}});if(!_0xeee26b)return _0x16712b[_0x41ad33(0x1c3)](0x194)[_0x41ad33(0x1a0)]({'success':![],'message':_0x41ad33(0x1ae)});switch(type){case _0x41ad33(0x1b9):const _0x4b4dd8={'id':_0x41ad33(0x192),'amount':_0x48564a?.[_0x41ad33(0x196)]||0x64,'currency':_0x48564a?.[_0x41ad33(0x1af)]||_0x41ad33(0x1bd),'productName':_0x48564a?.['productName']||_0x41ad33(0x18c),'gateway':_0x48564a?.[_0x41ad33(0x19d)]||_0x41ad33(0x1cd),'createdAt':new Date(),..._0x48564a};await telegramBotService_1[_0x41ad33(0x1b4)][_0x41ad33(0x1d1)](_0x3f914e,_0x4b4dd8,_0x41ad33(0x1a4));break;case'payout':const _0x251b0d={'id':_0x41ad33(0x197),'amount':_0x48564a?.['amount']||0x1f4,'method':_0x48564a?.['method']||_0x41ad33(0x190),'createdAt':new Date(),..._0x48564a};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x3f914e,_0x251b0d,_0x41ad33(0x1b0));break;case _0x41ad33(0x1ce):await telegramBotService_1[_0x41ad33(0x1b4)][_0x41ad33(0x19b)](_0x3f914e,_0x48564a?.[_0x41ad33(0x1a6)]||_0x41ad33(0x19a),_0x48564a?.[_0x41ad33(0x1c9)]||{'message':_0x41ad33(0x1a8)});break;default:return _0x16712b[_0x41ad33(0x1c3)](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x16712b['json']({'success':!![],'message':_0x41ad33(0x18e)+type+_0x41ad33(0x199)});}catch(_0xc13e33){_0x11be6b(_0xc13e33);}};}}function a13_0x118a(_0x37901a,_0x2ca4dc){const _0x41a488=a13_0x41a4();return a13_0x118a=function(_0x118a2d,_0x5be11b){_0x118a2d=_0x118a2d-0x189;let _0x38afc4=_0x41a488[_0x118a2d];return _0x38afc4;},a13_0x118a(_0x37901a,_0x2ca4dc);}exports['TelegramController']=TelegramController;