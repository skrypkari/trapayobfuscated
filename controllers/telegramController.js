'use strict';function a12_0x9080(){const _0x2352d9=['title','getTelegramUsers','all','Message\x20is\x20required','count','amount','__importDefault','status','Markdown','Telegram\x20user\x20not\x20found','Test\x20','sendPayoutNotification','test_payout_123','Shop\x20ID\x20is\x20required','telegramUser','getBotStatus','payout','telegramBotService','shop','User\x20disconnected\x20successfully','This\x20is\x20a\x20test\x20notification','true','435768FHgQgY','telegramId','__esModule','paid','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','desc','disconnectUser','default','groupBy','firstName','10872960nkOYOe','Test\x20Notification','sendTestNotification','sendPaymentNotification','3951tIsBCI','TelegramController','map','491035ELqoLi','lastName','Broadcast\x20message\x20sent\x20successfully','body','filter','query','3RsJAmv','28FgjvsX','json','bank_transfer','sendShopNotification','87570BWBilO','findUnique','isVerified','301844GqTrfg','findMany','updatedAt','params','custom','26639459rjbnqQ','defineProperty','Test\x20Product','USD','update','sendBroadcast','10ZvwxHY','gateway','ceil','getBotInfo','11880GSNEJf','username','shopId','payment','../services/telegramBotService'];a12_0x9080=function(){return _0x2352d9;};return a12_0x9080();}const a12_0xe640db=a12_0x9c71;(function(_0x5afdec,_0x3ee531){const _0x3c7e44=a12_0x9c71,_0x42997b=_0x5afdec();while(!![]){try{const _0x23c007=-parseInt(_0x3c7e44(0x1fb))/0x1*(-parseInt(_0x3c7e44(0x1ed))/0x2)+-parseInt(_0x3c7e44(0x1e8))/0x3*(parseInt(_0x3c7e44(0x1f0))/0x4)+parseInt(_0x3c7e44(0x22b))/0x5+parseInt(_0x3c7e44(0x21a))/0x6*(-parseInt(_0x3c7e44(0x1e9))/0x7)+-parseInt(_0x3c7e44(0x224))/0x8+parseInt(_0x3c7e44(0x228))/0x9*(-parseInt(_0x3c7e44(0x1ff))/0xa)+parseInt(_0x3c7e44(0x1f5))/0xb;if(_0x23c007===_0x3ee531)break;else _0x42997b['push'](_0x42997b['shift']());}catch(_0x219bc0){_0x42997b['push'](_0x42997b['shift']());}}}(a12_0x9080,0xada21));function a12_0x9c71(_0x556c69,_0x190a01){const _0x9080d9=a12_0x9080();return a12_0x9c71=function(_0x9c71dc,_0x9dece4){_0x9c71dc=_0x9c71dc-0x1e7;let _0x4838e2=_0x9080d9[_0x9c71dc];return _0x4838e2;},a12_0x9c71(_0x556c69,_0x190a01);}var __importDefault=this&&this[a12_0xe640db(0x20a)]||function(_0x280768){const _0xd11c18=a12_0xe640db;return _0x280768&&_0x280768[_0xd11c18(0x21c)]?_0x280768:{'default':_0x280768};};Object[a12_0xe640db(0x1f6)](exports,a12_0xe640db(0x21c),{'value':!![]}),exports[a12_0xe640db(0x229)]=void 0x0;const telegramBotService_1=require(a12_0xe640db(0x203)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x3320fc=a12_0xe640db;this[_0x3320fc(0x213)]=async(_0x3c2e0a,_0x542306,_0x2b1d7a)=>{const _0x38c94c=_0x3320fc;try{const _0x59d63c=telegramBotService_1[_0x38c94c(0x215)][_0x38c94c(0x1fe)](),_0x2e0b04=await database_1[_0x38c94c(0x221)][_0x38c94c(0x212)][_0x38c94c(0x208)](),_0x347794=await database_1[_0x38c94c(0x221)]['telegramUser'][_0x38c94c(0x208)]({'where':{'isVerified':!![]}}),_0x28aa6b=await database_1[_0x38c94c(0x221)][_0x38c94c(0x212)][_0x38c94c(0x222)]({'by':[_0x38c94c(0x201)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x542306['json']({'success':!![],'result':{'bot':{'isActive':_0x59d63c['isActive'],'username':_0x59d63c[_0x38c94c(0x200)]},'statistics':{'totalUsers':_0x2e0b04,'verifiedUsers':_0x347794,'unverifiedUsers':_0x2e0b04-_0x347794,'connectedShops':_0x28aa6b['length']}}});}catch(_0x1885a2){_0x2b1d7a(_0x1885a2);}},this[_0x3320fc(0x205)]=async(_0x158b3e,_0x3bb11c,_0xb90fbd)=>{const _0x169630=_0x3320fc;try{const {page:page=0x1,limit:limit=0x14,verified:_0x489d97}=_0x158b3e[_0x169630(0x1e7)],_0x5dafcd=(Number(page)-0x1)*Number(limit),_0x3984e7={};_0x489d97!==undefined&&(_0x3984e7[_0x169630(0x1ef)]=_0x489d97===_0x169630(0x219));const [_0xe620e1,_0x1d0f4e]=await Promise[_0x169630(0x206)]([database_1[_0x169630(0x221)][_0x169630(0x212)][_0x169630(0x1f1)]({'where':_0x3984e7,'skip':_0x5dafcd,'take':Number(limit),'orderBy':{'createdAt':_0x169630(0x21f)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x169630(0x221)][_0x169630(0x212)][_0x169630(0x208)]({'where':_0x3984e7})]);_0x3bb11c[_0x169630(0x1ea)]({'success':!![],'users':_0xe620e1[_0x169630(0x22a)](_0x276041=>({'id':_0x276041['id'],'telegramId':_0x276041[_0x169630(0x21b)],'username':_0x276041[_0x169630(0x200)],'firstName':_0x276041[_0x169630(0x223)],'lastName':_0x276041[_0x169630(0x22c)],'isVerified':_0x276041[_0x169630(0x1ef)],'shop':_0x276041[_0x169630(0x216)],'createdAt':_0x276041['createdAt'],'updatedAt':_0x276041[_0x169630(0x1f2)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1d0f4e,'totalPages':Math[_0x169630(0x1fd)](_0x1d0f4e/Number(limit))}});}catch(_0x1ed84f){_0xb90fbd(_0x1ed84f);}},this[_0x3320fc(0x1fa)]=async(_0x1ee33a,_0x5eae97,_0x65db97)=>{const _0x51661c=_0x3320fc;try{const {message:_0x1ccf0b,shopId:_0x3dd60f}=_0x1ee33a[_0x51661c(0x22e)];if(!_0x1ccf0b)return _0x5eae97[_0x51661c(0x20b)](0x190)[_0x51661c(0x1ea)]({'success':![],'message':_0x51661c(0x207)});if(_0x3dd60f)await telegramBotService_1[_0x51661c(0x215)][_0x51661c(0x1ec)](_0x3dd60f,_0x1ccf0b,{'parse_mode':'Markdown'});else{const _0x371e6b=await database_1[_0x51661c(0x221)][_0x51661c(0x212)][_0x51661c(0x1f1)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1f3c00=[...new Set(_0x371e6b[_0x51661c(0x22a)](_0x22f4e9=>_0x22f4e9[_0x51661c(0x201)])[_0x51661c(0x22f)](Boolean))];for(const _0x486c20 of _0x1f3c00){_0x486c20&&await telegramBotService_1[_0x51661c(0x215)][_0x51661c(0x1ec)](_0x486c20,_0x1ccf0b,{'parse_mode':_0x51661c(0x20c)});}}_0x5eae97[_0x51661c(0x1ea)]({'success':!![],'message':_0x51661c(0x22d)});}catch(_0x16bd20){_0x65db97(_0x16bd20);}},this[_0x3320fc(0x220)]=async(_0x2d4ab8,_0x21f5ee,_0x550559)=>{const _0x228613=_0x3320fc;try{const {telegramId:_0x5d06c6}=_0x2d4ab8[_0x228613(0x1f3)],_0x4604bf=await database_1[_0x228613(0x221)]['telegramUser'][_0x228613(0x1ee)]({'where':{'telegramId':_0x5d06c6},'include':{'shop':!![]}});if(!_0x4604bf)return _0x21f5ee[_0x228613(0x20b)](0x194)[_0x228613(0x1ea)]({'success':![],'message':_0x228613(0x20d)});await database_1[_0x228613(0x221)][_0x228613(0x212)][_0x228613(0x1f9)]({'where':{'telegramId':_0x5d06c6},'data':{'shopId':null,'isVerified':![]}}),_0x21f5ee[_0x228613(0x1ea)]({'success':!![],'message':_0x228613(0x217)});}catch(_0x58a74c){_0x550559(_0x58a74c);}},this[_0x3320fc(0x226)]=async(_0x16cb10,_0x144f5e,_0x528c59)=>{const _0x2fe030=_0x3320fc;try{const {shopId:_0x57fbee,type:type=_0x2fe030(0x202),testData:_0x4cee11}=_0x16cb10[_0x2fe030(0x22e)];if(!_0x57fbee)return _0x144f5e[_0x2fe030(0x20b)](0x190)['json']({'success':![],'message':_0x2fe030(0x211)});const _0x2b00cb=await database_1[_0x2fe030(0x221)]['shop'][_0x2fe030(0x1ee)]({'where':{'id':_0x57fbee},'select':{'id':!![],'name':!![]}});if(!_0x2b00cb)return _0x144f5e[_0x2fe030(0x20b)](0x194)[_0x2fe030(0x1ea)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x2fe030(0x202):const _0x5eb353={'id':'test_payment_123','amount':_0x4cee11?.[_0x2fe030(0x209)]||0x64,'currency':_0x4cee11?.['currency']||_0x2fe030(0x1f8),'productName':_0x4cee11?.['productName']||_0x2fe030(0x1f7),'gateway':_0x4cee11?.[_0x2fe030(0x1fc)]||'plisio','createdAt':new Date(),..._0x4cee11};await telegramBotService_1[_0x2fe030(0x215)][_0x2fe030(0x227)](_0x57fbee,_0x5eb353,_0x2fe030(0x21d));break;case _0x2fe030(0x214):const _0x4c45a9={'id':_0x2fe030(0x210),'amount':_0x4cee11?.[_0x2fe030(0x209)]||0x1f4,'method':_0x4cee11?.['method']||_0x2fe030(0x1eb),'createdAt':new Date(),..._0x4cee11};await telegramBotService_1[_0x2fe030(0x215)][_0x2fe030(0x20f)](_0x57fbee,_0x4c45a9,'completed');break;case _0x2fe030(0x1f4):await telegramBotService_1[_0x2fe030(0x215)]['sendCustomNotification'](_0x57fbee,_0x4cee11?.[_0x2fe030(0x204)]||_0x2fe030(0x225),_0x4cee11?.['details']||{'message':_0x2fe030(0x218)});break;default:return _0x144f5e['status'](0x190)[_0x2fe030(0x1ea)]({'success':![],'message':_0x2fe030(0x21e)});}_0x144f5e[_0x2fe030(0x1ea)]({'success':!![],'message':_0x2fe030(0x20e)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x71641b){_0x528c59(_0x71641b);}};}}exports[a12_0xe640db(0x229)]=TelegramController;