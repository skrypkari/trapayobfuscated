'use strict';const a12_0x1c6a54=a12_0x42dd;function a12_0x42dd(_0x3e5f8d,_0x1aada6){const _0x27a2f6=a12_0x27a2();return a12_0x42dd=function(_0x42dd09,_0x4137f1){_0x42dd09=_0x42dd09-0x12f;let _0xc4d9e3=_0x27a2f6[_0x42dd09];return _0xc4d9e3;},a12_0x42dd(_0x3e5f8d,_0x1aada6);}(function(_0x1ac376,_0x577eaa){const _0x4caa07=a12_0x42dd,_0x32f1e4=_0x1ac376();while(!![]){try{const _0x18cb39=-parseInt(_0x4caa07(0x153))/0x1*(parseInt(_0x4caa07(0x144))/0x2)+-parseInt(_0x4caa07(0x174))/0x3*(-parseInt(_0x4caa07(0x169))/0x4)+-parseInt(_0x4caa07(0x16f))/0x5*(-parseInt(_0x4caa07(0x147))/0x6)+parseInt(_0x4caa07(0x138))/0x7+-parseInt(_0x4caa07(0x156))/0x8+parseInt(_0x4caa07(0x137))/0x9+parseInt(_0x4caa07(0x134))/0xa*(-parseInt(_0x4caa07(0x136))/0xb);if(_0x18cb39===_0x577eaa)break;else _0x32f1e4['push'](_0x32f1e4['shift']());}catch(_0x2c74e4){_0x32f1e4['push'](_0x32f1e4['shift']());}}}(a12_0x27a2,0x6c6f6));var __importDefault=this&&this[a12_0x1c6a54(0x15d)]||function(_0x5e03c8){return _0x5e03c8&&_0x5e03c8['__esModule']?_0x5e03c8:{'default':_0x5e03c8};};function a12_0x27a2(){const _0x3d8f8f=['Shop\x20not\x20found','374121CNTrLX','firstName','createdAt','Markdown','telegramUser','User\x20disconnected\x20successfully','40piEMAj','gateway','1869604YnvSkq','2513601KVdhYl','4180295xlLDDz','shopId','../services/telegramBotService','username','params','Test\x20Notification','isVerified','all','TelegramController','length','Telegram\x20user\x20not\x20found','plisio','224722DVhRwH','sendCustomNotification','test_payout_123','150HkVtlt','status','update','sendTestNotification','shop','body','map','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','json','USD','method','paid','1oKumTy','telegramId','ceil','5836080QTxOnF','Test\x20Product','Shop\x20ID\x20is\x20required','title','sendBroadcast','bank_transfer','isActive','__importDefault','payment','desc','amount','query','count','getBotInfo','sendPayoutNotification','Message\x20is\x20required','telegramBotService','Test\x20','default','16WgXitS','completed','details','This\x20is\x20a\x20test\x20notification','defineProperty','sendShopNotification','118115JzstYA','findUnique','currency','findMany'];a12_0x27a2=function(){return _0x3d8f8f;};return a12_0x27a2();}Object[a12_0x1c6a54(0x16d)](exports,'__esModule',{'value':!![]}),exports[a12_0x1c6a54(0x140)]=void 0x0;const telegramBotService_1=require(a12_0x1c6a54(0x13a)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x225fa9=a12_0x1c6a54;this['getBotStatus']=async(_0x28f8c8,_0xcf3766,_0x2de71d)=>{const _0x470e06=a12_0x42dd;try{const _0x5e05ce=telegramBotService_1[_0x470e06(0x166)][_0x470e06(0x163)](),_0xe6fe9b=await database_1[_0x470e06(0x168)]['telegramUser'][_0x470e06(0x162)](),_0x53a2a9=await database_1[_0x470e06(0x168)][_0x470e06(0x132)]['count']({'where':{'isVerified':!![]}}),_0x5d1404=await database_1[_0x470e06(0x168)][_0x470e06(0x132)]['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xcf3766[_0x470e06(0x14f)]({'success':!![],'result':{'bot':{'isActive':_0x5e05ce[_0x470e06(0x15c)],'username':_0x5e05ce[_0x470e06(0x13b)]},'statistics':{'totalUsers':_0xe6fe9b,'verifiedUsers':_0x53a2a9,'unverifiedUsers':_0xe6fe9b-_0x53a2a9,'connectedShops':_0x5d1404[_0x470e06(0x141)]}}});}catch(_0x42dad9){_0x2de71d(_0x42dad9);}},this['getTelegramUsers']=async(_0x390cc1,_0xa1ef0a,_0x1445de)=>{const _0x49ce8e=a12_0x42dd;try{const {page:page=0x1,limit:limit=0x14,verified:_0x36b6a2}=_0x390cc1[_0x49ce8e(0x161)],_0x48927c=(Number(page)-0x1)*Number(limit),_0x240712={};_0x36b6a2!==undefined&&(_0x240712[_0x49ce8e(0x13e)]=_0x36b6a2==='true');const [_0x138a27,_0x483bbe]=await Promise[_0x49ce8e(0x13f)]([database_1['default'][_0x49ce8e(0x132)][_0x49ce8e(0x172)]({'where':_0x240712,'skip':_0x48927c,'take':Number(limit),'orderBy':{'createdAt':_0x49ce8e(0x15f)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x49ce8e(0x168)]['telegramUser'][_0x49ce8e(0x162)]({'where':_0x240712})]);_0xa1ef0a[_0x49ce8e(0x14f)]({'success':!![],'users':_0x138a27['map'](_0x263ebe=>({'id':_0x263ebe['id'],'telegramId':_0x263ebe[_0x49ce8e(0x154)],'username':_0x263ebe[_0x49ce8e(0x13b)],'firstName':_0x263ebe[_0x49ce8e(0x12f)],'lastName':_0x263ebe['lastName'],'isVerified':_0x263ebe[_0x49ce8e(0x13e)],'shop':_0x263ebe[_0x49ce8e(0x14b)],'createdAt':_0x263ebe[_0x49ce8e(0x130)],'updatedAt':_0x263ebe['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x483bbe,'totalPages':Math[_0x49ce8e(0x155)](_0x483bbe/Number(limit))}});}catch(_0x2675c2){_0x1445de(_0x2675c2);}},this[_0x225fa9(0x15a)]=async(_0x276f78,_0x2cc478,_0x23034d)=>{const _0x517f65=_0x225fa9;try{const {message:_0x5b6c58,shopId:_0x391995}=_0x276f78[_0x517f65(0x14c)];if(!_0x5b6c58)return _0x2cc478['status'](0x190)[_0x517f65(0x14f)]({'success':![],'message':_0x517f65(0x165)});if(_0x391995)await telegramBotService_1[_0x517f65(0x166)][_0x517f65(0x16e)](_0x391995,_0x5b6c58,{'parse_mode':_0x517f65(0x131)});else{const _0x176859=await database_1[_0x517f65(0x168)][_0x517f65(0x132)][_0x517f65(0x172)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x22256f=[...new Set(_0x176859[_0x517f65(0x14d)](_0x5eef73=>_0x5eef73[_0x517f65(0x139)])['filter'](Boolean))];for(const _0x310f54 of _0x22256f){_0x310f54&&await telegramBotService_1[_0x517f65(0x166)]['sendShopNotification'](_0x310f54,_0x5b6c58,{'parse_mode':'Markdown'});}}_0x2cc478[_0x517f65(0x14f)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x4c0e0e){_0x23034d(_0x4c0e0e);}},this['disconnectUser']=async(_0x5ea0a8,_0x5818e9,_0x5f2122)=>{const _0x2176a7=_0x225fa9;try{const {telegramId:_0x1dc57b}=_0x5ea0a8[_0x2176a7(0x13c)],_0x2ad569=await database_1[_0x2176a7(0x168)][_0x2176a7(0x132)][_0x2176a7(0x170)]({'where':{'telegramId':_0x1dc57b},'include':{'shop':!![]}});if(!_0x2ad569)return _0x5818e9['status'](0x194)[_0x2176a7(0x14f)]({'success':![],'message':_0x2176a7(0x142)});await database_1[_0x2176a7(0x168)][_0x2176a7(0x132)][_0x2176a7(0x149)]({'where':{'telegramId':_0x1dc57b},'data':{'shopId':null,'isVerified':![]}}),_0x5818e9[_0x2176a7(0x14f)]({'success':!![],'message':_0x2176a7(0x133)});}catch(_0x3b2ed8){_0x5f2122(_0x3b2ed8);}},this[_0x225fa9(0x14a)]=async(_0x199352,_0x1fcec7,_0x2dc35a)=>{const _0xfa02ee=_0x225fa9;try{const {shopId:_0x4e62e2,type:type=_0xfa02ee(0x15e),testData:_0x2a5af4}=_0x199352[_0xfa02ee(0x14c)];if(!_0x4e62e2)return _0x1fcec7[_0xfa02ee(0x148)](0x190)[_0xfa02ee(0x14f)]({'success':![],'message':_0xfa02ee(0x158)});const _0x55d6ac=await database_1[_0xfa02ee(0x168)][_0xfa02ee(0x14b)]['findUnique']({'where':{'id':_0x4e62e2},'select':{'id':!![],'name':!![]}});if(!_0x55d6ac)return _0x1fcec7[_0xfa02ee(0x148)](0x194)['json']({'success':![],'message':_0xfa02ee(0x173)});switch(type){case _0xfa02ee(0x15e):const _0x501759={'id':'test_payment_123','amount':_0x2a5af4?.[_0xfa02ee(0x160)]||0x64,'currency':_0x2a5af4?.[_0xfa02ee(0x171)]||_0xfa02ee(0x150),'productName':_0x2a5af4?.['productName']||_0xfa02ee(0x157),'gateway':_0x2a5af4?.[_0xfa02ee(0x135)]||_0xfa02ee(0x143),'createdAt':new Date(),..._0x2a5af4};await telegramBotService_1[_0xfa02ee(0x166)]['sendPaymentNotification'](_0x4e62e2,_0x501759,_0xfa02ee(0x152));break;case'payout':const _0x3cbdd4={'id':_0xfa02ee(0x146),'amount':_0x2a5af4?.[_0xfa02ee(0x160)]||0x1f4,'method':_0x2a5af4?.[_0xfa02ee(0x151)]||_0xfa02ee(0x15b),'createdAt':new Date(),..._0x2a5af4};await telegramBotService_1['telegramBotService'][_0xfa02ee(0x164)](_0x4e62e2,_0x3cbdd4,_0xfa02ee(0x16a));break;case'custom':await telegramBotService_1['telegramBotService'][_0xfa02ee(0x145)](_0x4e62e2,_0x2a5af4?.[_0xfa02ee(0x159)]||_0xfa02ee(0x13d),_0x2a5af4?.[_0xfa02ee(0x16b)]||{'message':_0xfa02ee(0x16c)});break;default:return _0x1fcec7[_0xfa02ee(0x148)](0x190)[_0xfa02ee(0x14f)]({'success':![],'message':_0xfa02ee(0x14e)});}_0x1fcec7['json']({'success':!![],'message':_0xfa02ee(0x167)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x151238){_0x2dc35a(_0x151238);}};}}exports[a12_0x1c6a54(0x140)]=TelegramController;