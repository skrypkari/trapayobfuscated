'use strict';const a12_0xd17904=a12_0xd8b8;(function(_0x173cb9,_0x40b12e){const _0x3cc01f=a12_0xd8b8,_0xb64285=_0x173cb9();while(!![]){try{const _0x4877d2=-parseInt(_0x3cc01f(0xa9))/0x1+parseInt(_0x3cc01f(0xc6))/0x2+-parseInt(_0x3cc01f(0xcc))/0x3*(-parseInt(_0x3cc01f(0xda))/0x4)+-parseInt(_0x3cc01f(0xcd))/0x5+-parseInt(_0x3cc01f(0xd4))/0x6*(parseInt(_0x3cc01f(0xa3))/0x7)+parseInt(_0x3cc01f(0xa2))/0x8+-parseInt(_0x3cc01f(0xdb))/0x9*(-parseInt(_0x3cc01f(0xd0))/0xa);if(_0x4877d2===_0x40b12e)break;else _0xb64285['push'](_0xb64285['shift']());}catch(_0xa9d29){_0xb64285['push'](_0xb64285['shift']());}}}(a12_0x229b,0x85d97));var __importDefault=this&&this[a12_0xd17904(0x9e)]||function(_0x1516fc){return _0x1516fc&&_0x1516fc['__esModule']?_0x1516fc:{'default':_0x1516fc};};function a12_0x229b(){const _0x5a1ca3=['isActive','User\x20disconnected\x20successfully','json','Test\x20Notification','test_payment_123','ceil','findUnique','\x20notification\x20sent\x20successfully','title','lastName','getBotInfo','payment','Markdown','sendShopNotification','sendPayoutNotification','username','This\x20is\x20a\x20test\x20notification','findMany','length','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','telegramBotService','634344afLroP','updatedAt','test_payout_123','desc','Shop\x20not\x20found','true','6XYiHAZ','4715740PBUwHt','map','custom','3490SNhCGQ','amount','Broadcast\x20message\x20sent\x20successfully','shopId','3554898ivWXmg','payout','completed','sendCustomNotification','__esModule','method','1296388pothWi','32283ettekv','Shop\x20ID\x20is\x20required','isVerified','getBotStatus','Message\x20is\x20required','telegramId','plisio','default','gateway','__importDefault','sendPaymentNotification','shop','TelegramController','5793768PDbxvR','7zPXAxb','body','count','groupBy','createdAt','query','857572yGvblW','telegramUser','currency','details','getTelegramUsers','disconnectUser','status','bank_transfer'];a12_0x229b=function(){return _0x5a1ca3;};return a12_0x229b();}Object['defineProperty'](exports,a12_0xd17904(0xd8),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require('../config/database'));function a12_0xd8b8(_0x17922d,_0xc54bc4){const _0x229bad=a12_0x229b();return a12_0xd8b8=function(_0xd8b8f1,_0x5e61f5){_0xd8b8f1=_0xd8b8f1-0x9c;let _0x103385=_0x229bad[_0xd8b8f1];return _0x103385;},a12_0xd8b8(_0x17922d,_0xc54bc4);}class TelegramController{constructor(){const _0x3b79cb=a12_0xd17904;this[_0x3b79cb(0xde)]=async(_0x1bfbb3,_0x130487,_0x58c045)=>{const _0x5bb3c2=_0x3b79cb;try{const _0x2a2c22=telegramBotService_1[_0x5bb3c2(0xc5)][_0x5bb3c2(0xbb)](),_0x23d97e=await database_1['default'][_0x5bb3c2(0xaa)][_0x5bb3c2(0xa5)](),_0x4d15c9=await database_1[_0x5bb3c2(0x9c)][_0x5bb3c2(0xaa)][_0x5bb3c2(0xa5)]({'where':{'isVerified':!![]}}),_0x32e7bb=await database_1[_0x5bb3c2(0x9c)]['telegramUser'][_0x5bb3c2(0xa6)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x130487[_0x5bb3c2(0xb3)]({'success':!![],'result':{'bot':{'isActive':_0x2a2c22[_0x5bb3c2(0xb1)],'username':_0x2a2c22[_0x5bb3c2(0xc0)]},'statistics':{'totalUsers':_0x23d97e,'verifiedUsers':_0x4d15c9,'unverifiedUsers':_0x23d97e-_0x4d15c9,'connectedShops':_0x32e7bb[_0x5bb3c2(0xc3)]}}});}catch(_0x44c4b6){_0x58c045(_0x44c4b6);}},this[_0x3b79cb(0xad)]=async(_0xa37d93,_0x2048c0,_0x2adb23)=>{const _0x2bce98=_0x3b79cb;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2789ba}=_0xa37d93[_0x2bce98(0xa8)],_0x9c74e=(Number(page)-0x1)*Number(limit),_0xcdd447={};_0x2789ba!==undefined&&(_0xcdd447[_0x2bce98(0xdd)]=_0x2789ba===_0x2bce98(0xcb));const [_0x2faea0,_0x72380a]=await Promise['all']([database_1['default'][_0x2bce98(0xaa)][_0x2bce98(0xc2)]({'where':_0xcdd447,'skip':_0x9c74e,'take':Number(limit),'orderBy':{'createdAt':_0x2bce98(0xc9)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2bce98(0x9c)]['telegramUser'][_0x2bce98(0xa5)]({'where':_0xcdd447})]);_0x2048c0[_0x2bce98(0xb3)]({'success':!![],'users':_0x2faea0[_0x2bce98(0xce)](_0x505428=>({'id':_0x505428['id'],'telegramId':_0x505428[_0x2bce98(0xe0)],'username':_0x505428[_0x2bce98(0xc0)],'firstName':_0x505428['firstName'],'lastName':_0x505428[_0x2bce98(0xba)],'isVerified':_0x505428['isVerified'],'shop':_0x505428['shop'],'createdAt':_0x505428[_0x2bce98(0xa7)],'updatedAt':_0x505428[_0x2bce98(0xc7)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x72380a,'totalPages':Math[_0x2bce98(0xb6)](_0x72380a/Number(limit))}});}catch(_0x34ac7a){_0x2adb23(_0x34ac7a);}},this['sendBroadcast']=async(_0x2f7b16,_0x2fe874,_0x3b331e)=>{const _0x3765d9=_0x3b79cb;try{const {message:_0x8a94b8,shopId:_0x5dc7b9}=_0x2f7b16[_0x3765d9(0xa4)];if(!_0x8a94b8)return _0x2fe874[_0x3765d9(0xaf)](0x190)['json']({'success':![],'message':_0x3765d9(0xdf)});if(_0x5dc7b9)await telegramBotService_1[_0x3765d9(0xc5)][_0x3765d9(0xbe)](_0x5dc7b9,_0x8a94b8,{'parse_mode':_0x3765d9(0xbd)});else{const _0x3a15c7=await database_1[_0x3765d9(0x9c)][_0x3765d9(0xaa)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2fddf3=[...new Set(_0x3a15c7[_0x3765d9(0xce)](_0x3f0059=>_0x3f0059[_0x3765d9(0xd3)])['filter'](Boolean))];for(const _0x1d34f8 of _0x2fddf3){_0x1d34f8&&await telegramBotService_1[_0x3765d9(0xc5)][_0x3765d9(0xbe)](_0x1d34f8,_0x8a94b8,{'parse_mode':_0x3765d9(0xbd)});}}_0x2fe874['json']({'success':!![],'message':_0x3765d9(0xd2)});}catch(_0x16a817){_0x3b331e(_0x16a817);}},this[_0x3b79cb(0xae)]=async(_0x548be6,_0xe7ba71,_0x3972d8)=>{const _0x17ff99=_0x3b79cb;try{const {telegramId:_0x507c43}=_0x548be6['params'],_0x4e8432=await database_1[_0x17ff99(0x9c)][_0x17ff99(0xaa)][_0x17ff99(0xb7)]({'where':{'telegramId':_0x507c43},'include':{'shop':!![]}});if(!_0x4e8432)return _0xe7ba71[_0x17ff99(0xaf)](0x194)[_0x17ff99(0xb3)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x17ff99(0xaa)]['update']({'where':{'telegramId':_0x507c43},'data':{'shopId':null,'isVerified':![]}}),_0xe7ba71[_0x17ff99(0xb3)]({'success':!![],'message':_0x17ff99(0xb2)});}catch(_0x4a1761){_0x3972d8(_0x4a1761);}},this['sendTestNotification']=async(_0x3d48eb,_0x489cc8,_0x5c3ab3)=>{const _0x3c11ba=_0x3b79cb;try{const {shopId:_0x4f15f1,type:type=_0x3c11ba(0xbc),testData:_0x595bc3}=_0x3d48eb[_0x3c11ba(0xa4)];if(!_0x4f15f1)return _0x489cc8[_0x3c11ba(0xaf)](0x190)[_0x3c11ba(0xb3)]({'success':![],'message':_0x3c11ba(0xdc)});const _0x5c9934=await database_1['default'][_0x3c11ba(0xa0)][_0x3c11ba(0xb7)]({'where':{'id':_0x4f15f1},'select':{'id':!![],'name':!![]}});if(!_0x5c9934)return _0x489cc8[_0x3c11ba(0xaf)](0x194)[_0x3c11ba(0xb3)]({'success':![],'message':_0x3c11ba(0xca)});switch(type){case _0x3c11ba(0xbc):const _0x3f9789={'id':_0x3c11ba(0xb5),'amount':_0x595bc3?.[_0x3c11ba(0xd1)]||0x64,'currency':_0x595bc3?.[_0x3c11ba(0xab)]||'USD','productName':_0x595bc3?.['productName']||'Test\x20Product','gateway':_0x595bc3?.[_0x3c11ba(0x9d)]||_0x3c11ba(0xe1),'createdAt':new Date(),..._0x595bc3};await telegramBotService_1['telegramBotService'][_0x3c11ba(0x9f)](_0x4f15f1,_0x3f9789,'paid');break;case _0x3c11ba(0xd5):const _0x5200e0={'id':_0x3c11ba(0xc8),'amount':_0x595bc3?.[_0x3c11ba(0xd1)]||0x1f4,'method':_0x595bc3?.[_0x3c11ba(0xd9)]||_0x3c11ba(0xb0),'createdAt':new Date(),..._0x595bc3};await telegramBotService_1[_0x3c11ba(0xc5)][_0x3c11ba(0xbf)](_0x4f15f1,_0x5200e0,_0x3c11ba(0xd6));break;case _0x3c11ba(0xcf):await telegramBotService_1[_0x3c11ba(0xc5)][_0x3c11ba(0xd7)](_0x4f15f1,_0x595bc3?.[_0x3c11ba(0xb9)]||_0x3c11ba(0xb4),_0x595bc3?.[_0x3c11ba(0xac)]||{'message':_0x3c11ba(0xc1)});break;default:return _0x489cc8['status'](0x190)[_0x3c11ba(0xb3)]({'success':![],'message':_0x3c11ba(0xc4)});}_0x489cc8[_0x3c11ba(0xb3)]({'success':!![],'message':'Test\x20'+type+_0x3c11ba(0xb8)});}catch(_0x1f251a){_0x5c3ab3(_0x1f251a);}};}}exports[a12_0xd17904(0xa1)]=TelegramController;