'use strict';const a17_0x1371f4=a17_0x2c8c;function a17_0x154f(){const _0x407dcc=['network','2114130qofjkd','20583984tKJEMw','__esModule','true','count','45026HeQWhj','getTelegramUsers','Telegram\x20user\x20not\x20found','1355350nQeuzA','../config/database','\x20notification\x20sent\x20successfully','desc','telegramBotService','sendPaymentNotification','isVerified','payment','sendBroadcast','wallet','paid','sendTestNotification','json','shopId','telegramUser','createdAt','shop','defineProperty','27675yPUjEl','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','Test\x20Notification','Broadcast\x20message\x20sent\x20successfully','status','Message\x20is\x20required','length','default','groupBy','findUnique','title','body','findMany','../services/telegramBotService','payout','username','productName','filter','sendCustomNotification','updatedAt','all','map','150tqELXp','3399008iIvXKf','1831067xLATfO','__importDefault','Тестовый\x20период','getBotStatus','Test\x20','test_payout_123','update','txid','Markdown','details','amount','Test\x20Product','query','Shop\x20ID\x20is\x20required','isActive','TRC20','TelegramController','custom','test_payment_123','currency','lastName','disconnectUser'];a17_0x154f=function(){return _0x407dcc;};return a17_0x154f();}(function(_0x5372b4,_0x46599b){const _0x2f55ae=a17_0x2c8c,_0x13a277=_0x5372b4();while(!![]){try{const _0x2a2946=parseInt(_0x2f55ae(0x13e))/0x1+-parseInt(_0x2f55ae(0x141))/0x2+-parseInt(_0x2f55ae(0x139))/0x3+-parseInt(_0x2f55ae(0x121))/0x4+parseInt(_0x2f55ae(0x153))/0x5*(-parseInt(_0x2f55ae(0x120))/0x6)+parseInt(_0x2f55ae(0x122))/0x7+parseInt(_0x2f55ae(0x13a))/0x8;if(_0x2a2946===_0x46599b)break;else _0x13a277['push'](_0x13a277['shift']());}catch(_0x4dffe5){_0x13a277['push'](_0x13a277['shift']());}}}(a17_0x154f,0x7c4a5));var __importDefault=this&&this[a17_0x1371f4(0x123)]||function(_0x17cb1a){const _0x52e4f5=a17_0x1371f4;return _0x17cb1a&&_0x17cb1a[_0x52e4f5(0x13b)]?_0x17cb1a:{'default':_0x17cb1a};};Object[a17_0x1371f4(0x152)](exports,'__esModule',{'value':!![]}),exports[a17_0x1371f4(0x132)]=void 0x0;const telegramBotService_1=require(a17_0x1371f4(0x160)),database_1=__importDefault(require(a17_0x1371f4(0x142)));function a17_0x2c8c(_0x57feef,_0x10bb50){_0x57feef=_0x57feef-0x11f;const _0x154fd1=a17_0x154f();let _0x2c8c07=_0x154fd1[_0x57feef];return _0x2c8c07;}class TelegramController{constructor(){const _0x5863cb=a17_0x1371f4;this[_0x5863cb(0x125)]=async(_0x4868a4,_0x3d8dc2,_0x2ae5d3)=>{const _0x5c55d2=_0x5863cb;try{const _0x222ce3=telegramBotService_1[_0x5c55d2(0x145)]['getBotInfo'](),_0x5d1eef=await database_1[_0x5c55d2(0x15a)][_0x5c55d2(0x14f)][_0x5c55d2(0x13d)](),_0x3d11e8=await database_1[_0x5c55d2(0x15a)][_0x5c55d2(0x14f)][_0x5c55d2(0x13d)]({'where':{'isVerified':!![]}}),_0x436b28=await database_1[_0x5c55d2(0x15a)][_0x5c55d2(0x14f)][_0x5c55d2(0x15b)]({'by':[_0x5c55d2(0x14e)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3d8dc2[_0x5c55d2(0x14d)]({'success':!![],'result':{'bot':{'isActive':_0x222ce3[_0x5c55d2(0x130)],'username':_0x222ce3[_0x5c55d2(0x162)]},'statistics':{'totalUsers':_0x5d1eef,'verifiedUsers':_0x3d11e8,'unverifiedUsers':_0x5d1eef-_0x3d11e8,'connectedShops':_0x436b28[_0x5c55d2(0x159)]}}});}catch(_0x2d25e9){_0x2ae5d3(_0x2d25e9);}},this[_0x5863cb(0x13f)]=async(_0x4b96b6,_0x1b192f,_0x46c9ea)=>{const _0x136c86=_0x5863cb;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5b4a96}=_0x4b96b6[_0x136c86(0x12e)],_0x369c6a=(Number(page)-0x1)*Number(limit),_0x43f2f0={};_0x5b4a96!==undefined&&(_0x43f2f0['isVerified']=_0x5b4a96===_0x136c86(0x13c));const [_0x3d867c,_0x3f0f93]=await Promise[_0x136c86(0x167)]([database_1[_0x136c86(0x15a)][_0x136c86(0x14f)][_0x136c86(0x15f)]({'where':_0x43f2f0,'skip':_0x369c6a,'take':Number(limit),'orderBy':{'createdAt':_0x136c86(0x144)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x136c86(0x15a)]['telegramUser'][_0x136c86(0x13d)]({'where':_0x43f2f0})]);_0x1b192f[_0x136c86(0x14d)]({'success':!![],'users':_0x3d867c[_0x136c86(0x11f)](_0x25ec2a=>({'id':_0x25ec2a['id'],'telegramId':_0x25ec2a['telegramId'],'username':_0x25ec2a[_0x136c86(0x162)],'firstName':_0x25ec2a['firstName'],'lastName':_0x25ec2a[_0x136c86(0x136)],'isVerified':_0x25ec2a[_0x136c86(0x147)],'shop':_0x25ec2a[_0x136c86(0x151)],'createdAt':_0x25ec2a[_0x136c86(0x150)],'updatedAt':_0x25ec2a[_0x136c86(0x166)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3f0f93,'totalPages':Math['ceil'](_0x3f0f93/Number(limit))}});}catch(_0x20d861){_0x46c9ea(_0x20d861);}},this[_0x5863cb(0x149)]=async(_0x2ad3e3,_0xc6a631,_0x3b93f6)=>{const _0x3a48a3=_0x5863cb;try{const {message:_0x284e16,shopId:_0x1c5191}=_0x2ad3e3['body'];if(!_0x284e16)return _0xc6a631[_0x3a48a3(0x157)](0x190)[_0x3a48a3(0x14d)]({'success':![],'message':_0x3a48a3(0x158)});if(_0x1c5191)await telegramBotService_1[_0x3a48a3(0x145)]['sendShopNotification'](_0x1c5191,_0x284e16,{'parse_mode':_0x3a48a3(0x12a)});else{const _0x22fa15=await database_1[_0x3a48a3(0x15a)]['telegramUser'][_0x3a48a3(0x15f)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x477de2=[...new Set(_0x22fa15[_0x3a48a3(0x11f)](_0x38ffbe=>_0x38ffbe[_0x3a48a3(0x14e)])[_0x3a48a3(0x164)](Boolean))];for(const _0x1bb982 of _0x477de2){_0x1bb982&&await telegramBotService_1[_0x3a48a3(0x145)]['sendShopNotification'](_0x1bb982,_0x284e16,{'parse_mode':_0x3a48a3(0x12a)});}}_0xc6a631['json']({'success':!![],'message':_0x3a48a3(0x156)});}catch(_0x24afff){_0x3b93f6(_0x24afff);}},this[_0x5863cb(0x137)]=async(_0x35fc64,_0x1c12e1,_0x4c1a95)=>{const _0x28cd73=_0x5863cb;try{const {telegramId:_0x4bdd45}=_0x35fc64['params'],_0x49a273=await database_1[_0x28cd73(0x15a)][_0x28cd73(0x14f)][_0x28cd73(0x15c)]({'where':{'telegramId':_0x4bdd45},'include':{'shop':!![]}});if(!_0x49a273)return _0x1c12e1['status'](0x194)[_0x28cd73(0x14d)]({'success':![],'message':_0x28cd73(0x140)});await database_1[_0x28cd73(0x15a)][_0x28cd73(0x14f)][_0x28cd73(0x128)]({'where':{'telegramId':_0x4bdd45},'data':{'shopId':null,'isVerified':![]}}),_0x1c12e1[_0x28cd73(0x14d)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0xb2691f){_0x4c1a95(_0xb2691f);}},this[_0x5863cb(0x14c)]=async(_0x5733d3,_0x1628de,_0x5fcf49)=>{const _0x503378=_0x5863cb;try{const {shopId:_0x4a811f,type:type=_0x503378(0x148),testData:_0x3c621a}=_0x5733d3[_0x503378(0x15e)];if(!_0x4a811f)return _0x1628de[_0x503378(0x157)](0x190)[_0x503378(0x14d)]({'success':![],'message':_0x503378(0x12f)});const _0x300d4c=await database_1[_0x503378(0x15a)][_0x503378(0x151)][_0x503378(0x15c)]({'where':{'id':_0x4a811f},'select':{'id':!![],'name':!![]}});if(!_0x300d4c)return _0x1628de[_0x503378(0x157)](0x194)[_0x503378(0x14d)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x503378(0x148):const _0x537c39={'id':_0x503378(0x134),'amount':_0x3c621a?.['amount']||0x64,'currency':_0x3c621a?.[_0x503378(0x135)]||'USD','productName':_0x3c621a?.[_0x503378(0x163)]||_0x503378(0x12d),'gateway':_0x3c621a?.['gateway']||'plisio','createdAt':new Date(),..._0x3c621a};await telegramBotService_1[_0x503378(0x145)][_0x503378(0x146)](_0x4a811f,_0x537c39,_0x503378(0x14b));break;case _0x503378(0x161):const _0x2a2108={'id':_0x503378(0x127),'amount':_0x3c621a?.[_0x503378(0x12c)]||0x1f4,'network':_0x3c621a?.[_0x503378(0x138)]||_0x503378(0x131),'wallet':_0x3c621a?.[_0x503378(0x14a)]||_0x503378(0x154),'period':_0x503378(0x124),'createdAt':new Date(),'txid':_0x3c621a?.[_0x503378(0x129)]||null,..._0x3c621a};await telegramBotService_1[_0x503378(0x145)]['sendPayoutNotification'](_0x4a811f,_0x2a2108);break;case _0x503378(0x133):await telegramBotService_1[_0x503378(0x145)][_0x503378(0x165)](_0x4a811f,_0x3c621a?.[_0x503378(0x15d)]||_0x503378(0x155),_0x3c621a?.[_0x503378(0x12b)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x1628de[_0x503378(0x157)](0x190)[_0x503378(0x14d)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x1628de[_0x503378(0x14d)]({'success':!![],'message':_0x503378(0x126)+type+_0x503378(0x143)});}catch(_0x58f39a){_0x5fcf49(_0x58f39a);}};}}exports[a17_0x1371f4(0x132)]=TelegramController;