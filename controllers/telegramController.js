'use strict';const a17_0x17457e=a17_0x4bef;(function(_0x7e08aa,_0x467f47){const _0x1a68b9=a17_0x4bef,_0x15647d=_0x7e08aa();while(!![]){try{const _0x318af8=parseInt(_0x1a68b9(0x1a8))/0x1+-parseInt(_0x1a68b9(0x1cd))/0x2+parseInt(_0x1a68b9(0x18b))/0x3+-parseInt(_0x1a68b9(0x191))/0x4*(parseInt(_0x1a68b9(0x197))/0x5)+-parseInt(_0x1a68b9(0x1a0))/0x6*(-parseInt(_0x1a68b9(0x1af))/0x7)+-parseInt(_0x1a68b9(0x184))/0x8+parseInt(_0x1a68b9(0x1b7))/0x9;if(_0x318af8===_0x467f47)break;else _0x15647d['push'](_0x15647d['shift']());}catch(_0x4eebbc){_0x15647d['push'](_0x15647d['shift']());}}}(a17_0x31b1,0x47fed));function a17_0x4bef(_0x2f4827,_0x4b08e6){_0x2f4827=_0x2f4827-0x184;const _0x31b1bf=a17_0x31b1();let _0x4befa9=_0x31b1bf[_0x2f4827];return _0x4befa9;}var __importDefault=this&&this[a17_0x17457e(0x1a3)]||function(_0x5ce5aa){return _0x5ce5aa&&_0x5ce5aa['__esModule']?_0x5ce5aa:{'default':_0x5ce5aa};};function a17_0x31b1(){const _0x87a58a=['TRC20','../config/database','USD','841214IIalMj','3954552tanKup','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','count','username','TelegramController','telegramId','This\x20is\x20a\x20test\x20notification','1553829BzmnoE','disconnectUser','ceil','paid','query','Test\x20','1220BKysoe','shopId','wallet','shop','update','body','4225UCBfAp','amount','filter','Broadcast\x20message\x20sent\x20successfully','network','sendShopNotification','test_payment_123','gateway','payment','1458372HoMxBg','telegramBotService','updatedAt','__importDefault','Shop\x20not\x20found','getBotInfo','groupBy','sendPayoutNotification','298860fnVTFn','findMany','defineProperty','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','default','map','payout','14RBzzWF','getTelegramUsers','findUnique','details','plisio','status','createdAt','lastName','1481553uqYyuC','sendPaymentNotification','all','Markdown','title','Тестовый\x20период','User\x20disconnected\x20successfully','json','__esModule','Test\x20Product','custom','telegramUser','txid','Message\x20is\x20required','\x20notification\x20sent\x20successfully','params','isVerified','../services/telegramBotService','productName'];a17_0x31b1=function(){return _0x87a58a;};return a17_0x31b1();}Object[a17_0x17457e(0x1aa)](exports,a17_0x17457e(0x1bf),{'value':!![]}),exports[a17_0x17457e(0x188)]=void 0x0;const telegramBotService_1=require(a17_0x17457e(0x1c8)),database_1=__importDefault(require(a17_0x17457e(0x1cb)));class TelegramController{constructor(){const _0xb706a=a17_0x17457e;this['getBotStatus']=async(_0x10d3b4,_0x25beba,_0x58dd91)=>{const _0x4d194a=a17_0x4bef;try{const _0x42bd02=telegramBotService_1[_0x4d194a(0x1a1)][_0x4d194a(0x1a5)](),_0x76139f=await database_1['default'][_0x4d194a(0x1c2)][_0x4d194a(0x186)](),_0x17efd0=await database_1[_0x4d194a(0x1ac)][_0x4d194a(0x1c2)]['count']({'where':{'isVerified':!![]}}),_0x313328=await database_1[_0x4d194a(0x1ac)][_0x4d194a(0x1c2)][_0x4d194a(0x1a6)]({'by':[_0x4d194a(0x192)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x25beba[_0x4d194a(0x1be)]({'success':!![],'result':{'bot':{'isActive':_0x42bd02['isActive'],'username':_0x42bd02[_0x4d194a(0x187)]},'statistics':{'totalUsers':_0x76139f,'verifiedUsers':_0x17efd0,'unverifiedUsers':_0x76139f-_0x17efd0,'connectedShops':_0x313328['length']}}});}catch(_0x38e767){_0x58dd91(_0x38e767);}},this[_0xb706a(0x1b0)]=async(_0xbb9b48,_0x38668d,_0x38b9ab)=>{const _0x304a29=_0xb706a;try{const {page:page=0x1,limit:limit=0x14,verified:_0x40c37c}=_0xbb9b48[_0x304a29(0x18f)],_0x537f82=(Number(page)-0x1)*Number(limit),_0x287688={};_0x40c37c!==undefined&&(_0x287688['isVerified']=_0x40c37c==='true');const [_0x464881,_0x136131]=await Promise[_0x304a29(0x1b9)]([database_1['default'][_0x304a29(0x1c2)][_0x304a29(0x1a9)]({'where':_0x287688,'skip':_0x537f82,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x304a29(0x1ac)][_0x304a29(0x1c2)][_0x304a29(0x186)]({'where':_0x287688})]);_0x38668d['json']({'success':!![],'users':_0x464881[_0x304a29(0x1ad)](_0x2a1384=>({'id':_0x2a1384['id'],'telegramId':_0x2a1384[_0x304a29(0x189)],'username':_0x2a1384[_0x304a29(0x187)],'firstName':_0x2a1384['firstName'],'lastName':_0x2a1384[_0x304a29(0x1b6)],'isVerified':_0x2a1384[_0x304a29(0x1c7)],'shop':_0x2a1384[_0x304a29(0x194)],'createdAt':_0x2a1384[_0x304a29(0x1b5)],'updatedAt':_0x2a1384[_0x304a29(0x1a2)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x136131,'totalPages':Math[_0x304a29(0x18d)](_0x136131/Number(limit))}});}catch(_0x3bfde3){_0x38b9ab(_0x3bfde3);}},this['sendBroadcast']=async(_0x171e2d,_0x344141,_0x18b3b7)=>{const _0x187bfe=_0xb706a;try{const {message:_0x44d2fe,shopId:_0x48ac0a}=_0x171e2d['body'];if(!_0x44d2fe)return _0x344141['status'](0x190)[_0x187bfe(0x1be)]({'success':![],'message':_0x187bfe(0x1c4)});if(_0x48ac0a)await telegramBotService_1['telegramBotService'][_0x187bfe(0x19c)](_0x48ac0a,_0x44d2fe,{'parse_mode':_0x187bfe(0x1ba)});else{const _0x24b1d3=await database_1[_0x187bfe(0x1ac)][_0x187bfe(0x1c2)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1df353=[...new Set(_0x24b1d3[_0x187bfe(0x1ad)](_0x47c38d=>_0x47c38d[_0x187bfe(0x192)])[_0x187bfe(0x199)](Boolean))];for(const _0x568a89 of _0x1df353){_0x568a89&&await telegramBotService_1[_0x187bfe(0x1a1)][_0x187bfe(0x19c)](_0x568a89,_0x44d2fe,{'parse_mode':_0x187bfe(0x1ba)});}}_0x344141[_0x187bfe(0x1be)]({'success':!![],'message':_0x187bfe(0x19a)});}catch(_0x477edc){_0x18b3b7(_0x477edc);}},this[_0xb706a(0x18c)]=async(_0x94e570,_0x1ebe1b,_0x2d5c7b)=>{const _0x4b1b46=_0xb706a;try{const {telegramId:_0x430dd1}=_0x94e570[_0x4b1b46(0x1c6)],_0x67cb09=await database_1[_0x4b1b46(0x1ac)][_0x4b1b46(0x1c2)]['findUnique']({'where':{'telegramId':_0x430dd1},'include':{'shop':!![]}});if(!_0x67cb09)return _0x1ebe1b[_0x4b1b46(0x1b4)](0x194)[_0x4b1b46(0x1be)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x4b1b46(0x1ac)][_0x4b1b46(0x1c2)][_0x4b1b46(0x195)]({'where':{'telegramId':_0x430dd1},'data':{'shopId':null,'isVerified':![]}}),_0x1ebe1b['json']({'success':!![],'message':_0x4b1b46(0x1bd)});}catch(_0x3031e6){_0x2d5c7b(_0x3031e6);}},this['sendTestNotification']=async(_0x29cb67,_0x2d5c40,_0x21e9ed)=>{const _0x1b3ef2=_0xb706a;try{const {shopId:_0x2a1e9d,type:type=_0x1b3ef2(0x19f),testData:_0x4e8dba}=_0x29cb67[_0x1b3ef2(0x196)];if(!_0x2a1e9d)return _0x2d5c40[_0x1b3ef2(0x1b4)](0x190)[_0x1b3ef2(0x1be)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x47c53d=await database_1[_0x1b3ef2(0x1ac)][_0x1b3ef2(0x194)][_0x1b3ef2(0x1b1)]({'where':{'id':_0x2a1e9d},'select':{'id':!![],'name':!![]}});if(!_0x47c53d)return _0x2d5c40['status'](0x194)[_0x1b3ef2(0x1be)]({'success':![],'message':_0x1b3ef2(0x1a4)});switch(type){case _0x1b3ef2(0x19f):const _0x7dd174={'id':_0x1b3ef2(0x19d),'amount':_0x4e8dba?.['amount']||0x64,'currency':_0x4e8dba?.['currency']||_0x1b3ef2(0x1cc),'productName':_0x4e8dba?.[_0x1b3ef2(0x1c9)]||_0x1b3ef2(0x1c0),'gateway':_0x4e8dba?.[_0x1b3ef2(0x19e)]||_0x1b3ef2(0x1b3),'createdAt':new Date(),..._0x4e8dba};await telegramBotService_1['telegramBotService'][_0x1b3ef2(0x1b8)](_0x2a1e9d,_0x7dd174,_0x1b3ef2(0x18e));break;case _0x1b3ef2(0x1ae):const _0x2bff05={'id':'test_payout_123','amount':_0x4e8dba?.[_0x1b3ef2(0x198)]||0x1f4,'network':_0x4e8dba?.[_0x1b3ef2(0x19b)]||_0x1b3ef2(0x1ca),'wallet':_0x4e8dba?.[_0x1b3ef2(0x193)]||_0x1b3ef2(0x185),'period':_0x1b3ef2(0x1bc),'createdAt':new Date(),'txid':_0x4e8dba?.[_0x1b3ef2(0x1c3)]||null,..._0x4e8dba};await telegramBotService_1['telegramBotService'][_0x1b3ef2(0x1a7)](_0x2a1e9d,_0x2bff05);break;case _0x1b3ef2(0x1c1):await telegramBotService_1['telegramBotService']['sendCustomNotification'](_0x2a1e9d,_0x4e8dba?.[_0x1b3ef2(0x1bb)]||'Test\x20Notification',_0x4e8dba?.[_0x1b3ef2(0x1b2)]||{'message':_0x1b3ef2(0x18a)});break;default:return _0x2d5c40[_0x1b3ef2(0x1b4)](0x190)[_0x1b3ef2(0x1be)]({'success':![],'message':_0x1b3ef2(0x1ab)});}_0x2d5c40[_0x1b3ef2(0x1be)]({'success':!![],'message':_0x1b3ef2(0x190)+type+_0x1b3ef2(0x1c5)});}catch(_0x1821c2){_0x21e9ed(_0x1821c2);}};}}exports[a17_0x17457e(0x188)]=TelegramController;