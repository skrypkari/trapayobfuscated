'use strict';const a12_0x5cdd4c=a12_0x2edd;function a12_0x2edd(_0x236e6f,_0x62352c){const _0x61d9c2=a12_0x61d9();return a12_0x2edd=function(_0x2eddd7,_0xab7faf){_0x2eddd7=_0x2eddd7-0x84;let _0x491658=_0x61d9c2[_0x2eddd7];return _0x491658;},a12_0x2edd(_0x236e6f,_0x62352c);}(function(_0x407f80,_0x1b5f6b){const _0x63edb8=a12_0x2edd,_0x4552ad=_0x407f80();while(!![]){try{const _0x7dc2bb=parseInt(_0x63edb8(0xb7))/0x1+-parseInt(_0x63edb8(0x9b))/0x2*(-parseInt(_0x63edb8(0xb2))/0x3)+parseInt(_0x63edb8(0xa8))/0x4*(-parseInt(_0x63edb8(0xa3))/0x5)+-parseInt(_0x63edb8(0x9e))/0x6+-parseInt(_0x63edb8(0x8c))/0x7*(parseInt(_0x63edb8(0xbd))/0x8)+-parseInt(_0x63edb8(0x99))/0x9+parseInt(_0x63edb8(0xad))/0xa*(parseInt(_0x63edb8(0xc8))/0xb);if(_0x7dc2bb===_0x1b5f6b)break;else _0x4552ad['push'](_0x4552ad['shift']());}catch(_0x4af37c){_0x4552ad['push'](_0x4552ad['shift']());}}}(a12_0x61d9,0xd0741));var __importDefault=this&&this[a12_0x5cdd4c(0x98)]||function(_0x364095){const _0x419cf8=a12_0x5cdd4c;return _0x364095&&_0x364095[_0x419cf8(0x96)]?_0x364095:{'default':_0x364095};};Object[a12_0x5cdd4c(0xb9)](exports,'__esModule',{'value':!![]}),exports['TelegramController']=void 0x0;function a12_0x61d9(){const _0x22b495=['true','default','createdAt','getBotStatus','7Bbyxsz','update','disconnectUser','params','payment','map','shop','status','User\x20disconnected\x20successfully','sendShopNotification','__esModule','title','__importDefault','5231115xxolng','count','724830SyPPla','firstName','gateway','5848602BSviVz','sendCustomNotification','query','sendPayoutNotification','isActive','155425MdTrQC','Shop\x20ID\x20is\x20required','Markdown','isVerified','telegramId','8mlPNtx','Broadcast\x20message\x20sent\x20successfully','desc','TelegramController','This\x20is\x20a\x20test\x20notification','10PBeQae','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','telegramUser','sendBroadcast','paid','9JckQHE','Test\x20Product','shopId','body','getBotInfo','331542cxbxEF','completed','defineProperty','details','json','\x20notification\x20sent\x20successfully','8163304eieigO','groupBy','telegramBotService','ceil','sendTestNotification','username','findMany','length','USD','Test\x20Notification','updatedAt','22809853omZdNU','../config/database','amount','plisio','payout','bank_transfer','currency'];a12_0x61d9=function(){return _0x22b495;};return a12_0x61d9();}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x5cdd4c(0xc9)));class TelegramController{constructor(){const _0x15817b=a12_0x5cdd4c;this[_0x15817b(0x8b)]=async(_0x104f74,_0xd844c4,_0x1a25b7)=>{const _0x19670f=_0x15817b;try{const _0x428f08=telegramBotService_1['telegramBotService'][_0x19670f(0xb6)](),_0x1a1544=await database_1[_0x19670f(0x89)][_0x19670f(0xaf)]['count'](),_0x10c3c5=await database_1[_0x19670f(0x89)][_0x19670f(0xaf)]['count']({'where':{'isVerified':!![]}}),_0x1a2f68=await database_1[_0x19670f(0x89)][_0x19670f(0xaf)][_0x19670f(0xbe)]({'by':[_0x19670f(0xb4)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xd844c4[_0x19670f(0xbb)]({'success':!![],'result':{'bot':{'isActive':_0x428f08[_0x19670f(0xa2)],'username':_0x428f08[_0x19670f(0xc2)]},'statistics':{'totalUsers':_0x1a1544,'verifiedUsers':_0x10c3c5,'unverifiedUsers':_0x1a1544-_0x10c3c5,'connectedShops':_0x1a2f68[_0x19670f(0xc4)]}}});}catch(_0x33a981){_0x1a25b7(_0x33a981);}},this['getTelegramUsers']=async(_0x427fdc,_0x9c9cfa,_0xbd83ac)=>{const _0x266f31=_0x15817b;try{const {page:page=0x1,limit:limit=0x14,verified:_0x52f113}=_0x427fdc[_0x266f31(0xa0)],_0x45c59a=(Number(page)-0x1)*Number(limit),_0x5eecb2={};_0x52f113!==undefined&&(_0x5eecb2[_0x266f31(0xa6)]=_0x52f113===_0x266f31(0x88));const [_0x4e1509,_0x4c3ad3]=await Promise['all']([database_1[_0x266f31(0x89)][_0x266f31(0xaf)]['findMany']({'where':_0x5eecb2,'skip':_0x45c59a,'take':Number(limit),'orderBy':{'createdAt':_0x266f31(0xaa)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x266f31(0x89)][_0x266f31(0xaf)][_0x266f31(0x9a)]({'where':_0x5eecb2})]);_0x9c9cfa[_0x266f31(0xbb)]({'success':!![],'users':_0x4e1509[_0x266f31(0x91)](_0x45cb67=>({'id':_0x45cb67['id'],'telegramId':_0x45cb67[_0x266f31(0xa7)],'username':_0x45cb67['username'],'firstName':_0x45cb67[_0x266f31(0x9c)],'lastName':_0x45cb67['lastName'],'isVerified':_0x45cb67[_0x266f31(0xa6)],'shop':_0x45cb67[_0x266f31(0x92)],'createdAt':_0x45cb67[_0x266f31(0x8a)],'updatedAt':_0x45cb67[_0x266f31(0xc7)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x4c3ad3,'totalPages':Math[_0x266f31(0xc0)](_0x4c3ad3/Number(limit))}});}catch(_0x1ed61c){_0xbd83ac(_0x1ed61c);}},this[_0x15817b(0xb0)]=async(_0x2c7785,_0x21e107,_0x322d13)=>{const _0x28ace9=_0x15817b;try{const {message:_0x1f9c6c,shopId:_0x1eff30}=_0x2c7785['body'];if(!_0x1f9c6c)return _0x21e107['status'](0x190)['json']({'success':![],'message':'Message\x20is\x20required'});if(_0x1eff30)await telegramBotService_1[_0x28ace9(0xbf)][_0x28ace9(0x95)](_0x1eff30,_0x1f9c6c,{'parse_mode':_0x28ace9(0xa5)});else{const _0x5866d4=await database_1['default'][_0x28ace9(0xaf)][_0x28ace9(0xc3)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xded230=[...new Set(_0x5866d4[_0x28ace9(0x91)](_0x877067=>_0x877067[_0x28ace9(0xb4)])['filter'](Boolean))];for(const _0x3ab283 of _0xded230){_0x3ab283&&await telegramBotService_1[_0x28ace9(0xbf)][_0x28ace9(0x95)](_0x3ab283,_0x1f9c6c,{'parse_mode':_0x28ace9(0xa5)});}}_0x21e107['json']({'success':!![],'message':_0x28ace9(0xa9)});}catch(_0x116d2e){_0x322d13(_0x116d2e);}},this[_0x15817b(0x8e)]=async(_0x404342,_0x1f0783,_0x1fb0f0)=>{const _0x58f9e2=_0x15817b;try{const {telegramId:_0x339b22}=_0x404342[_0x58f9e2(0x8f)],_0x2da02e=await database_1[_0x58f9e2(0x89)][_0x58f9e2(0xaf)]['findUnique']({'where':{'telegramId':_0x339b22},'include':{'shop':!![]}});if(!_0x2da02e)return _0x1f0783['status'](0x194)[_0x58f9e2(0xbb)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x58f9e2(0xaf)][_0x58f9e2(0x8d)]({'where':{'telegramId':_0x339b22},'data':{'shopId':null,'isVerified':![]}}),_0x1f0783[_0x58f9e2(0xbb)]({'success':!![],'message':_0x58f9e2(0x94)});}catch(_0x584eda){_0x1fb0f0(_0x584eda);}},this[_0x15817b(0xc1)]=async(_0x192e17,_0x5c92c0,_0x4eacc1)=>{const _0x14aa76=_0x15817b;try{const {shopId:_0xa2ed66,type:type=_0x14aa76(0x90),testData:_0x2dbfe3}=_0x192e17[_0x14aa76(0xb5)];if(!_0xa2ed66)return _0x5c92c0[_0x14aa76(0x93)](0x190)[_0x14aa76(0xbb)]({'success':![],'message':_0x14aa76(0xa4)});const _0x39fff7=await database_1[_0x14aa76(0x89)][_0x14aa76(0x92)]['findUnique']({'where':{'id':_0xa2ed66},'select':{'id':!![],'name':!![]}});if(!_0x39fff7)return _0x5c92c0['status'](0x194)[_0x14aa76(0xbb)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x14aa76(0x90):const _0x396151={'id':'test_payment_123','amount':_0x2dbfe3?.[_0x14aa76(0xca)]||0x64,'currency':_0x2dbfe3?.[_0x14aa76(0x87)]||_0x14aa76(0xc5),'productName':_0x2dbfe3?.['productName']||_0x14aa76(0xb3),'gateway':_0x2dbfe3?.[_0x14aa76(0x9d)]||_0x14aa76(0x84),'createdAt':new Date(),..._0x2dbfe3};await telegramBotService_1[_0x14aa76(0xbf)]['sendPaymentNotification'](_0xa2ed66,_0x396151,_0x14aa76(0xb1));break;case _0x14aa76(0x85):const _0x32faf8={'id':'test_payout_123','amount':_0x2dbfe3?.[_0x14aa76(0xca)]||0x1f4,'method':_0x2dbfe3?.['method']||_0x14aa76(0x86),'createdAt':new Date(),..._0x2dbfe3};await telegramBotService_1['telegramBotService'][_0x14aa76(0xa1)](_0xa2ed66,_0x32faf8,_0x14aa76(0xb8));break;case'custom':await telegramBotService_1[_0x14aa76(0xbf)][_0x14aa76(0x9f)](_0xa2ed66,_0x2dbfe3?.[_0x14aa76(0x97)]||_0x14aa76(0xc6),_0x2dbfe3?.[_0x14aa76(0xba)]||{'message':_0x14aa76(0xac)});break;default:return _0x5c92c0[_0x14aa76(0x93)](0x190)[_0x14aa76(0xbb)]({'success':![],'message':_0x14aa76(0xae)});}_0x5c92c0['json']({'success':!![],'message':'Test\x20'+type+_0x14aa76(0xbc)});}catch(_0x200b4d){_0x4eacc1(_0x200b4d);}};}}exports[a12_0x5cdd4c(0xab)]=TelegramController;