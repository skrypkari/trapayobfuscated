'use strict';const a20_0x47ec5a=a20_0x2df4;(function(_0xfb630c,_0x33bd20){const _0x13806a=a20_0x2df4,_0x1b40e5=_0xfb630c();while(!![]){try{const _0x5877cb=parseInt(_0x13806a(0x1c7))/0x1+parseInt(_0x13806a(0x1cf))/0x2*(parseInt(_0x13806a(0x1a6))/0x3)+-parseInt(_0x13806a(0x1d9))/0x4*(-parseInt(_0x13806a(0x1e2))/0x5)+parseInt(_0x13806a(0x1cd))/0x6*(-parseInt(_0x13806a(0x1bf))/0x7)+-parseInt(_0x13806a(0x1cb))/0x8*(parseInt(_0x13806a(0x1e1))/0x9)+parseInt(_0x13806a(0x1b8))/0xa+-parseInt(_0x13806a(0x1c1))/0xb;if(_0x5877cb===_0x33bd20)break;else _0x1b40e5['push'](_0x1b40e5['shift']());}catch(_0x3955ba){_0x1b40e5['push'](_0x1b40e5['shift']());}}}(a20_0x8b28,0x7f577));var __importDefault=this&&this[a20_0x47ec5a(0x1c6)]||function(_0x206839){const _0x572d29=a20_0x47ec5a;return _0x206839&&_0x206839[_0x572d29(0x1ca)]?_0x206839:{'default':_0x206839};};function a20_0x8b28(){const _0x193e5c=['shopId','json','isVerified','count','groupBy','3dyBxDE','Telegram\x20user\x20not\x20found','sendShopNotification','USD','plisio','firstName','telegramId','findUnique','isActive','TRC20','disconnectUser','title','Markdown','shop','productName','payment','TelegramController','payout','4658660ZkeXqI','getBotInfo','network','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','\x20notification\x20sent\x20successfully','body','map','161Ljpxmf','sendTestNotification','16740042HoNWyT','Test\x20Product','amount','Shop\x20ID\x20is\x20required','true','__importDefault','159096LuvgmE','updatedAt','update','__esModule','32BgKJTi','test_payment_123','20718HqRbbK','query','1947884Mrvxfb','custom','gateway','status','getBotStatus','currency','params','sendPayoutNotification','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','default','96NpuLyL','all','Broadcast\x20message\x20sent\x20successfully','wallet','desc','txid','../config/database','sendBroadcast','167868ALtqvG','124695YImqCS','details','Test\x20Notification','telegramBotService','telegramUser'];a20_0x8b28=function(){return _0x193e5c;};return a20_0x8b28();}function a20_0x2df4(_0x5ab4f4,_0x1b7234){_0x5ab4f4=_0x5ab4f4-0x1a0;const _0x8b2811=a20_0x8b28();let _0x2df41f=_0x8b2811[_0x5ab4f4];return _0x2df41f;}Object['defineProperty'](exports,a20_0x47ec5a(0x1ca),{'value':!![]}),exports[a20_0x47ec5a(0x1b6)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a20_0x47ec5a(0x1df)));class TelegramController{constructor(){const _0xdbb9f4=a20_0x47ec5a;this[_0xdbb9f4(0x1d3)]=async(_0x5f27d7,_0x320c95,_0x390818)=>{const _0x24deb9=_0xdbb9f4;try{const _0x216aaf=telegramBotService_1[_0x24deb9(0x1e5)][_0x24deb9(0x1b9)](),_0x1f704a=await database_1[_0x24deb9(0x1d8)][_0x24deb9(0x1a0)][_0x24deb9(0x1a4)](),_0x7ca0b3=await database_1['default'][_0x24deb9(0x1a0)][_0x24deb9(0x1a4)]({'where':{'isVerified':!![]}}),_0x159a64=await database_1[_0x24deb9(0x1d8)]['telegramUser'][_0x24deb9(0x1a5)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x320c95['json']({'success':!![],'result':{'bot':{'isActive':_0x216aaf[_0x24deb9(0x1ae)],'username':_0x216aaf['username']},'statistics':{'totalUsers':_0x1f704a,'verifiedUsers':_0x7ca0b3,'unverifiedUsers':_0x1f704a-_0x7ca0b3,'connectedShops':_0x159a64['length']}}});}catch(_0x1c7dbe){_0x390818(_0x1c7dbe);}},this['getTelegramUsers']=async(_0xd9ff9c,_0x277b42,_0x468aa7)=>{const _0x1daa9b=_0xdbb9f4;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2111ce}=_0xd9ff9c[_0x1daa9b(0x1ce)],_0x597827=(Number(page)-0x1)*Number(limit),_0x3536df={};_0x2111ce!==undefined&&(_0x3536df[_0x1daa9b(0x1a3)]=_0x2111ce===_0x1daa9b(0x1c5));const [_0x2074a0,_0x5024ab]=await Promise[_0x1daa9b(0x1da)]([database_1[_0x1daa9b(0x1d8)][_0x1daa9b(0x1a0)]['findMany']({'where':_0x3536df,'skip':_0x597827,'take':Number(limit),'orderBy':{'createdAt':_0x1daa9b(0x1dd)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1daa9b(0x1d8)][_0x1daa9b(0x1a0)][_0x1daa9b(0x1a4)]({'where':_0x3536df})]);_0x277b42[_0x1daa9b(0x1a2)]({'success':!![],'users':_0x2074a0[_0x1daa9b(0x1be)](_0x3a19e5=>({'id':_0x3a19e5['id'],'telegramId':_0x3a19e5[_0x1daa9b(0x1ac)],'username':_0x3a19e5['username'],'firstName':_0x3a19e5[_0x1daa9b(0x1ab)],'lastName':_0x3a19e5['lastName'],'isVerified':_0x3a19e5[_0x1daa9b(0x1a3)],'shop':_0x3a19e5[_0x1daa9b(0x1b3)],'createdAt':_0x3a19e5['createdAt'],'updatedAt':_0x3a19e5[_0x1daa9b(0x1c8)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5024ab,'totalPages':Math['ceil'](_0x5024ab/Number(limit))}});}catch(_0x13f4a4){_0x468aa7(_0x13f4a4);}},this[_0xdbb9f4(0x1e0)]=async(_0x3ca3a6,_0x541a40,_0x27c332)=>{const _0x260e97=_0xdbb9f4;try{const {message:_0x365b39,shopId:_0x198c48}=_0x3ca3a6['body'];if(!_0x365b39)return _0x541a40['status'](0x190)[_0x260e97(0x1a2)]({'success':![],'message':'Message\x20is\x20required'});if(_0x198c48)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x198c48,_0x365b39,{'parse_mode':_0x260e97(0x1b2)});else{const _0x3c0a50=await database_1['default']['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1c942b=[...new Set(_0x3c0a50[_0x260e97(0x1be)](_0x482406=>_0x482406[_0x260e97(0x1a1)])['filter'](Boolean))];for(const _0x21f7d7 of _0x1c942b){_0x21f7d7&&await telegramBotService_1[_0x260e97(0x1e5)][_0x260e97(0x1a8)](_0x21f7d7,_0x365b39,{'parse_mode':_0x260e97(0x1b2)});}}_0x541a40[_0x260e97(0x1a2)]({'success':!![],'message':_0x260e97(0x1db)});}catch(_0x4bb858){_0x27c332(_0x4bb858);}},this[_0xdbb9f4(0x1b0)]=async(_0x41e1fd,_0x145f92,_0x34aaa8)=>{const _0x4f33bd=_0xdbb9f4;try{const {telegramId:_0x3bec28}=_0x41e1fd[_0x4f33bd(0x1d5)],_0x1dd780=await database_1[_0x4f33bd(0x1d8)][_0x4f33bd(0x1a0)]['findUnique']({'where':{'telegramId':_0x3bec28},'include':{'shop':!![]}});if(!_0x1dd780)return _0x145f92['status'](0x194)[_0x4f33bd(0x1a2)]({'success':![],'message':_0x4f33bd(0x1a7)});await database_1[_0x4f33bd(0x1d8)][_0x4f33bd(0x1a0)][_0x4f33bd(0x1c9)]({'where':{'telegramId':_0x3bec28},'data':{'shopId':null,'isVerified':![]}}),_0x145f92[_0x4f33bd(0x1a2)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x1a38e7){_0x34aaa8(_0x1a38e7);}},this[_0xdbb9f4(0x1c0)]=async(_0x1b27ae,_0x450297,_0x1fd035)=>{const _0x54fd33=_0xdbb9f4;try{const {shopId:_0x105249,type:type=_0x54fd33(0x1b5),testData:_0x5a1d27}=_0x1b27ae[_0x54fd33(0x1bd)];if(!_0x105249)return _0x450297[_0x54fd33(0x1d2)](0x190)['json']({'success':![],'message':_0x54fd33(0x1c4)});const _0x32f125=await database_1[_0x54fd33(0x1d8)]['shop'][_0x54fd33(0x1ad)]({'where':{'id':_0x105249},'select':{'id':!![],'name':!![]}});if(!_0x32f125)return _0x450297[_0x54fd33(0x1d2)](0x194)[_0x54fd33(0x1a2)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x54fd33(0x1b5):const _0x23dbdf={'id':_0x54fd33(0x1cc),'amount':_0x5a1d27?.[_0x54fd33(0x1c3)]||0x64,'currency':_0x5a1d27?.[_0x54fd33(0x1d4)]||_0x54fd33(0x1a9),'productName':_0x5a1d27?.[_0x54fd33(0x1b4)]||_0x54fd33(0x1c2),'gateway':_0x5a1d27?.[_0x54fd33(0x1d1)]||_0x54fd33(0x1aa),'createdAt':new Date(),..._0x5a1d27};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x105249,_0x23dbdf,'paid');break;case _0x54fd33(0x1b7):const _0x1ac558={'id':'test_payout_123','amount':_0x5a1d27?.['amount']||0x1f4,'network':_0x5a1d27?.[_0x54fd33(0x1ba)]||_0x54fd33(0x1af),'wallet':_0x5a1d27?.[_0x54fd33(0x1dc)]||_0x54fd33(0x1d7),'period':'Тестовый\x20период','createdAt':new Date(),'txid':_0x5a1d27?.[_0x54fd33(0x1de)]||null,..._0x5a1d27};await telegramBotService_1[_0x54fd33(0x1e5)][_0x54fd33(0x1d6)](_0x105249,_0x1ac558);break;case _0x54fd33(0x1d0):await telegramBotService_1[_0x54fd33(0x1e5)]['sendCustomNotification'](_0x105249,_0x5a1d27?.[_0x54fd33(0x1b1)]||_0x54fd33(0x1e4),_0x5a1d27?.[_0x54fd33(0x1e3)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x450297[_0x54fd33(0x1d2)](0x190)[_0x54fd33(0x1a2)]({'success':![],'message':_0x54fd33(0x1bb)});}_0x450297[_0x54fd33(0x1a2)]({'success':!![],'message':'Test\x20'+type+_0x54fd33(0x1bc)});}catch(_0x2cf428){_0x1fd035(_0x2cf428);}};}}exports['TelegramController']=TelegramController;