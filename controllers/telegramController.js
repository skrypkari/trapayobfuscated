'use strict';const a18_0x460f1=a18_0x5e25;(function(_0x4d095f,_0x56fd02){const _0x5b60f9=a18_0x5e25,_0x429933=_0x4d095f();while(!![]){try{const _0x4e3c85=-parseInt(_0x5b60f9(0x88))/0x1+parseInt(_0x5b60f9(0xbf))/0x2*(parseInt(_0x5b60f9(0xaa))/0x3)+-parseInt(_0x5b60f9(0x97))/0x4+-parseInt(_0x5b60f9(0xa0))/0x5+parseInt(_0x5b60f9(0xbc))/0x6+-parseInt(_0x5b60f9(0xad))/0x7*(parseInt(_0x5b60f9(0x95))/0x8)+parseInt(_0x5b60f9(0x92))/0x9*(parseInt(_0x5b60f9(0xa8))/0xa);if(_0x4e3c85===_0x56fd02)break;else _0x429933['push'](_0x429933['shift']());}catch(_0x21c712){_0x429933['push'](_0x429933['shift']());}}}(a18_0x5c4c,0xa3c60));var __importDefault=this&&this[a18_0x460f1(0x83)]||function(_0x2e7e93){return _0x2e7e93&&_0x2e7e93['__esModule']?_0x2e7e93:{'default':_0x2e7e93};};function a18_0x5c4c(){const _0x58b2a0=['Test\x20','45304YOPePc','default','productName','telegramId','Broadcast\x20message\x20sent\x20successfully','username','getBotStatus','sendShopNotification','test_payment_123','status','Test\x20Product','json','custom','This\x20is\x20a\x20test\x20notification','network','3504084ZMflNP','payment','getBotInfo','2gmQgSj','Test\x20Notification','isVerified','disconnectUser','sendBroadcast','amount','telegramUser','shop','defineProperty','plisio','createdAt','ceil','wallet','details','Shop\x20ID\x20is\x20required','__importDefault','USD','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','filter','isActive','808968BVazUW','../config/database','../services/telegramBotService','sendTestNotification','true','body','map','Message\x20is\x20required','update','telegramBotService','561141WfFffC','shopId','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','296ZnbBwa','findMany','4257280Eubkrl','TelegramController','all','findUnique','groupBy','sendPayoutNotification','query','Тестовый\x20период','test_payout_123','1107085QNqKdu','Markdown','sendPaymentNotification','desc','params','getTelegramUsers','firstName','Telegram\x20user\x20not\x20found','330fPbYQi','count','1090362exZktQ','gateway'];a18_0x5c4c=function(){return _0x58b2a0;};return a18_0x5c4c();}Object[a18_0x460f1(0xc7)](exports,'__esModule',{'value':!![]}),exports['TelegramController']=void 0x0;function a18_0x5e25(_0x13c0f5,_0x473993){_0x13c0f5=_0x13c0f5-0x82;const _0x5c4c36=a18_0x5c4c();let _0x5e2582=_0x5c4c36[_0x13c0f5];return _0x5e2582;}const telegramBotService_1=require(a18_0x460f1(0x8a)),database_1=__importDefault(require(a18_0x460f1(0x89)));class TelegramController{constructor(){const _0x2a5358=a18_0x460f1;this[_0x2a5358(0xb3)]=async(_0x36154a,_0x13143e,_0x5e5d70)=>{const _0x3fdf29=_0x2a5358;try{const _0x30ad15=telegramBotService_1[_0x3fdf29(0x91)][_0x3fdf29(0xbe)](),_0x4ea8ce=await database_1['default']['telegramUser'][_0x3fdf29(0xa9)](),_0x2eb8d1=await database_1[_0x3fdf29(0xae)]['telegramUser'][_0x3fdf29(0xa9)]({'where':{'isVerified':!![]}}),_0x406a63=await database_1[_0x3fdf29(0xae)][_0x3fdf29(0xc5)][_0x3fdf29(0x9b)]({'by':[_0x3fdf29(0x93)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x13143e[_0x3fdf29(0xb8)]({'success':!![],'result':{'bot':{'isActive':_0x30ad15[_0x3fdf29(0x87)],'username':_0x30ad15[_0x3fdf29(0xb2)]},'statistics':{'totalUsers':_0x4ea8ce,'verifiedUsers':_0x2eb8d1,'unverifiedUsers':_0x4ea8ce-_0x2eb8d1,'connectedShops':_0x406a63['length']}}});}catch(_0x10c33b){_0x5e5d70(_0x10c33b);}},this[_0x2a5358(0xa5)]=async(_0x1f01cc,_0x2b1694,_0x40c1c0)=>{const _0x8252f5=_0x2a5358;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4aebc4}=_0x1f01cc[_0x8252f5(0x9d)],_0x4c0830=(Number(page)-0x1)*Number(limit),_0x129d32={};_0x4aebc4!==undefined&&(_0x129d32[_0x8252f5(0xc1)]=_0x4aebc4===_0x8252f5(0x8c));const [_0x5b55ee,_0x4ad176]=await Promise[_0x8252f5(0x99)]([database_1[_0x8252f5(0xae)][_0x8252f5(0xc5)][_0x8252f5(0x96)]({'where':_0x129d32,'skip':_0x4c0830,'take':Number(limit),'orderBy':{'createdAt':_0x8252f5(0xa3)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x8252f5(0xae)]['telegramUser'][_0x8252f5(0xa9)]({'where':_0x129d32})]);_0x2b1694[_0x8252f5(0xb8)]({'success':!![],'users':_0x5b55ee[_0x8252f5(0x8e)](_0x157f6c=>({'id':_0x157f6c['id'],'telegramId':_0x157f6c[_0x8252f5(0xb0)],'username':_0x157f6c[_0x8252f5(0xb2)],'firstName':_0x157f6c[_0x8252f5(0xa6)],'lastName':_0x157f6c['lastName'],'isVerified':_0x157f6c[_0x8252f5(0xc1)],'shop':_0x157f6c[_0x8252f5(0xc6)],'createdAt':_0x157f6c[_0x8252f5(0xc9)],'updatedAt':_0x157f6c['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x4ad176,'totalPages':Math[_0x8252f5(0xca)](_0x4ad176/Number(limit))}});}catch(_0xc5cae9){_0x40c1c0(_0xc5cae9);}},this[_0x2a5358(0xc3)]=async(_0x56109e,_0x38139f,_0x4adfa0)=>{const _0x44d30e=_0x2a5358;try{const {message:_0x2fea75,shopId:_0x49614d}=_0x56109e[_0x44d30e(0x8d)];if(!_0x2fea75)return _0x38139f[_0x44d30e(0xb6)](0x190)['json']({'success':![],'message':_0x44d30e(0x8f)});if(_0x49614d)await telegramBotService_1[_0x44d30e(0x91)][_0x44d30e(0xb4)](_0x49614d,_0x2fea75,{'parse_mode':_0x44d30e(0xa1)});else{const _0x2c79d0=await database_1[_0x44d30e(0xae)][_0x44d30e(0xc5)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x262939=[...new Set(_0x2c79d0[_0x44d30e(0x8e)](_0x3626fb=>_0x3626fb['shopId'])[_0x44d30e(0x86)](Boolean))];for(const _0x3c765b of _0x262939){_0x3c765b&&await telegramBotService_1[_0x44d30e(0x91)]['sendShopNotification'](_0x3c765b,_0x2fea75,{'parse_mode':_0x44d30e(0xa1)});}}_0x38139f[_0x44d30e(0xb8)]({'success':!![],'message':_0x44d30e(0xb1)});}catch(_0x1e9903){_0x4adfa0(_0x1e9903);}},this[_0x2a5358(0xc2)]=async(_0x4a0ad7,_0x480cda,_0x1d1d9f)=>{const _0x1f807b=_0x2a5358;try{const {telegramId:_0x1bf731}=_0x4a0ad7[_0x1f807b(0xa4)],_0x65c61f=await database_1[_0x1f807b(0xae)][_0x1f807b(0xc5)]['findUnique']({'where':{'telegramId':_0x1bf731},'include':{'shop':!![]}});if(!_0x65c61f)return _0x480cda['status'](0x194)[_0x1f807b(0xb8)]({'success':![],'message':_0x1f807b(0xa7)});await database_1[_0x1f807b(0xae)]['telegramUser'][_0x1f807b(0x90)]({'where':{'telegramId':_0x1bf731},'data':{'shopId':null,'isVerified':![]}}),_0x480cda[_0x1f807b(0xb8)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x53429c){_0x1d1d9f(_0x53429c);}},this[_0x2a5358(0x8b)]=async(_0x306fb5,_0x5e656a,_0x4995d8)=>{const _0x2fa3b9=_0x2a5358;try{const {shopId:_0xc5d48b,type:type=_0x2fa3b9(0xbd),testData:_0x278ece}=_0x306fb5['body'];if(!_0xc5d48b)return _0x5e656a[_0x2fa3b9(0xb6)](0x190)[_0x2fa3b9(0xb8)]({'success':![],'message':_0x2fa3b9(0x82)});const _0x284267=await database_1['default'][_0x2fa3b9(0xc6)][_0x2fa3b9(0x9a)]({'where':{'id':_0xc5d48b},'select':{'id':!![],'name':!![]}});if(!_0x284267)return _0x5e656a['status'](0x194)[_0x2fa3b9(0xb8)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0x276093={'id':_0x2fa3b9(0xb5),'amount':_0x278ece?.[_0x2fa3b9(0xc4)]||0x64,'currency':_0x278ece?.['currency']||_0x2fa3b9(0x84),'productName':_0x278ece?.[_0x2fa3b9(0xaf)]||_0x2fa3b9(0xb7),'gateway':_0x278ece?.[_0x2fa3b9(0xab)]||_0x2fa3b9(0xc8),'createdAt':new Date(),..._0x278ece};await telegramBotService_1[_0x2fa3b9(0x91)][_0x2fa3b9(0xa2)](_0xc5d48b,_0x276093,'paid');break;case'payout':const _0x10ce2f={'id':_0x2fa3b9(0x9f),'amount':_0x278ece?.[_0x2fa3b9(0xc4)]||0x1f4,'network':_0x278ece?.[_0x2fa3b9(0xbb)]||'TRC20','wallet':_0x278ece?.[_0x2fa3b9(0xcb)]||_0x2fa3b9(0x94),'period':_0x2fa3b9(0x9e),'createdAt':new Date(),'txid':_0x278ece?.['txid']||null,..._0x278ece};await telegramBotService_1[_0x2fa3b9(0x91)][_0x2fa3b9(0x9c)](_0xc5d48b,_0x10ce2f);break;case _0x2fa3b9(0xb9):await telegramBotService_1[_0x2fa3b9(0x91)]['sendCustomNotification'](_0xc5d48b,_0x278ece?.['title']||_0x2fa3b9(0xc0),_0x278ece?.[_0x2fa3b9(0xcc)]||{'message':_0x2fa3b9(0xba)});break;default:return _0x5e656a[_0x2fa3b9(0xb6)](0x190)[_0x2fa3b9(0xb8)]({'success':![],'message':_0x2fa3b9(0x85)});}_0x5e656a[_0x2fa3b9(0xb8)]({'success':!![],'message':_0x2fa3b9(0xac)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x5ecb9d){_0x4995d8(_0x5ecb9d);}};}}exports[a18_0x460f1(0x98)]=TelegramController;