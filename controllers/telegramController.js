'use strict';const a12_0x2d267a=a12_0x1a55;(function(_0x41e274,_0x46e2f7){const _0x53cde6=a12_0x1a55,_0x560d96=_0x41e274();while(!![]){try{const _0x2f01a8=parseInt(_0x53cde6(0x18d))/0x1*(parseInt(_0x53cde6(0x1aa))/0x2)+parseInt(_0x53cde6(0x18b))/0x3*(-parseInt(_0x53cde6(0x1c1))/0x4)+parseInt(_0x53cde6(0x1c5))/0x5+-parseInt(_0x53cde6(0x192))/0x6+parseInt(_0x53cde6(0x1c9))/0x7+-parseInt(_0x53cde6(0x197))/0x8*(parseInt(_0x53cde6(0x19e))/0x9)+-parseInt(_0x53cde6(0x18e))/0xa*(-parseInt(_0x53cde6(0x187))/0xb);if(_0x2f01a8===_0x46e2f7)break;else _0x560d96['push'](_0x560d96['shift']());}catch(_0x77a8a){_0x560d96['push'](_0x560d96['shift']());}}}(a12_0x26ec,0x4f660));function a12_0x26ec(){const _0x26f7a2=['626171ScIkDK','json','currency','Test\x20Notification','paid','getTelegramUsers','961972oLzcja','telegramBotService','Test\x20','sendPayoutNotification','3ShEYJj','desc','591719nTQIbg','10qVKqVS','Broadcast\x20message\x20sent\x20successfully','query','ceil','1509912LLdOtt','\x20notification\x20sent\x20successfully','title','bank_transfer','../services/telegramBotService','515320gLrxye','update','plisio','true','body','sendCustomNotification','productName','9MRyNkk','isVerified','getBotInfo','count','createdAt','__esModule','test_payment_123','USD','disconnectUser','sendPaymentNotification','findMany','Test\x20Product','2UowEFa','shopId','firstName','Markdown','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Telegram\x20user\x20not\x20found','groupBy','username','status','shop','Shop\x20not\x20found','amount','User\x20disconnected\x20successfully','sendShopNotification','getBotStatus','updatedAt','payment','findUnique','default','method','completed','test_payout_123','telegramUser','1563940AjTCnk','../config/database','lastName','Shop\x20ID\x20is\x20required','1318220ujxNKz','filter','payout','all'];a12_0x26ec=function(){return _0x26f7a2;};return a12_0x26ec();}var __importDefault=this&&this['__importDefault']||function(_0x20e778){const _0x36b015=a12_0x1a55;return _0x20e778&&_0x20e778[_0x36b015(0x1a3)]?_0x20e778:{'default':_0x20e778};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x2d267a(0x196)),database_1=__importDefault(require(a12_0x2d267a(0x1c2)));function a12_0x1a55(_0x16d222,_0x346f04){const _0x26ec15=a12_0x26ec();return a12_0x1a55=function(_0x1a55ee,_0x43681c){_0x1a55ee=_0x1a55ee-0x185;let _0x5bf785=_0x26ec15[_0x1a55ee];return _0x5bf785;},a12_0x1a55(_0x16d222,_0x346f04);}class TelegramController{constructor(){const _0x2a28df=a12_0x2d267a;this[_0x2a28df(0x1b8)]=async(_0x55fc46,_0x241291,_0x28fdfe)=>{const _0x68d0a8=_0x2a28df;try{const _0x270c34=telegramBotService_1[_0x68d0a8(0x188)][_0x68d0a8(0x1a0)](),_0x266733=await database_1[_0x68d0a8(0x1bc)]['telegramUser']['count'](),_0x271e5d=await database_1[_0x68d0a8(0x1bc)]['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x58a2a2=await database_1['default']['telegramUser'][_0x68d0a8(0x1b0)]({'by':[_0x68d0a8(0x1ab)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x241291['json']({'success':!![],'result':{'bot':{'isActive':_0x270c34['isActive'],'username':_0x270c34['username']},'statistics':{'totalUsers':_0x266733,'verifiedUsers':_0x271e5d,'unverifiedUsers':_0x266733-_0x271e5d,'connectedShops':_0x58a2a2['length']}}});}catch(_0x48eceb){_0x28fdfe(_0x48eceb);}},this[_0x2a28df(0x186)]=async(_0x45f5a8,_0x55783f,_0x19de50)=>{const _0x2489bf=_0x2a28df;try{const {page:page=0x1,limit:limit=0x14,verified:_0x461a15}=_0x45f5a8[_0x2489bf(0x190)],_0xc4589=(Number(page)-0x1)*Number(limit),_0x5b8c32={};_0x461a15!==undefined&&(_0x5b8c32['isVerified']=_0x461a15===_0x2489bf(0x19a));const [_0x59ec68,_0x500e9c]=await Promise[_0x2489bf(0x1c8)]([database_1['default'][_0x2489bf(0x1c0)][_0x2489bf(0x1a8)]({'where':_0x5b8c32,'skip':_0xc4589,'take':Number(limit),'orderBy':{'createdAt':_0x2489bf(0x18c)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2489bf(0x1bc)][_0x2489bf(0x1c0)][_0x2489bf(0x1a1)]({'where':_0x5b8c32})]);_0x55783f[_0x2489bf(0x1ca)]({'success':!![],'users':_0x59ec68['map'](_0x3567a4=>({'id':_0x3567a4['id'],'telegramId':_0x3567a4['telegramId'],'username':_0x3567a4[_0x2489bf(0x1b1)],'firstName':_0x3567a4[_0x2489bf(0x1ac)],'lastName':_0x3567a4[_0x2489bf(0x1c3)],'isVerified':_0x3567a4[_0x2489bf(0x19f)],'shop':_0x3567a4[_0x2489bf(0x1b3)],'createdAt':_0x3567a4[_0x2489bf(0x1a2)],'updatedAt':_0x3567a4[_0x2489bf(0x1b9)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x500e9c,'totalPages':Math[_0x2489bf(0x191)](_0x500e9c/Number(limit))}});}catch(_0x35684f){_0x19de50(_0x35684f);}},this['sendBroadcast']=async(_0x52a6cb,_0x2cb834,_0x21281e)=>{const _0x589ec2=_0x2a28df;try{const {message:_0x257b21,shopId:_0x1639c0}=_0x52a6cb[_0x589ec2(0x19b)];if(!_0x257b21)return _0x2cb834[_0x589ec2(0x1b2)](0x190)['json']({'success':![],'message':'Message\x20is\x20required'});if(_0x1639c0)await telegramBotService_1[_0x589ec2(0x188)][_0x589ec2(0x1b7)](_0x1639c0,_0x257b21,{'parse_mode':_0x589ec2(0x1ad)});else{const _0x274c7c=await database_1[_0x589ec2(0x1bc)][_0x589ec2(0x1c0)][_0x589ec2(0x1a8)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xa6df1d=[...new Set(_0x274c7c['map'](_0x1f6ed8=>_0x1f6ed8[_0x589ec2(0x1ab)])[_0x589ec2(0x1c6)](Boolean))];for(const _0xea9e49 of _0xa6df1d){_0xea9e49&&await telegramBotService_1[_0x589ec2(0x188)]['sendShopNotification'](_0xea9e49,_0x257b21,{'parse_mode':_0x589ec2(0x1ad)});}}_0x2cb834['json']({'success':!![],'message':_0x589ec2(0x18f)});}catch(_0xc4d7af){_0x21281e(_0xc4d7af);}},this[_0x2a28df(0x1a6)]=async(_0x162e0f,_0x1eb329,_0x19f428)=>{const _0x5b5cba=_0x2a28df;try{const {telegramId:_0x394a51}=_0x162e0f['params'],_0x588f7b=await database_1[_0x5b5cba(0x1bc)][_0x5b5cba(0x1c0)]['findUnique']({'where':{'telegramId':_0x394a51},'include':{'shop':!![]}});if(!_0x588f7b)return _0x1eb329[_0x5b5cba(0x1b2)](0x194)[_0x5b5cba(0x1ca)]({'success':![],'message':_0x5b5cba(0x1af)});await database_1[_0x5b5cba(0x1bc)][_0x5b5cba(0x1c0)][_0x5b5cba(0x198)]({'where':{'telegramId':_0x394a51},'data':{'shopId':null,'isVerified':![]}}),_0x1eb329['json']({'success':!![],'message':_0x5b5cba(0x1b6)});}catch(_0x640915){_0x19f428(_0x640915);}},this['sendTestNotification']=async(_0x21e361,_0x1e59de,_0x920bdb)=>{const _0x16702c=_0x2a28df;try{const {shopId:_0x400a4b,type:type=_0x16702c(0x1ba),testData:_0x5d95e7}=_0x21e361[_0x16702c(0x19b)];if(!_0x400a4b)return _0x1e59de[_0x16702c(0x1b2)](0x190)[_0x16702c(0x1ca)]({'success':![],'message':_0x16702c(0x1c4)});const _0x920aa7=await database_1[_0x16702c(0x1bc)][_0x16702c(0x1b3)][_0x16702c(0x1bb)]({'where':{'id':_0x400a4b},'select':{'id':!![],'name':!![]}});if(!_0x920aa7)return _0x1e59de[_0x16702c(0x1b2)](0x194)[_0x16702c(0x1ca)]({'success':![],'message':_0x16702c(0x1b4)});switch(type){case _0x16702c(0x1ba):const _0x34362d={'id':_0x16702c(0x1a4),'amount':_0x5d95e7?.[_0x16702c(0x1b5)]||0x64,'currency':_0x5d95e7?.[_0x16702c(0x1cb)]||_0x16702c(0x1a5),'productName':_0x5d95e7?.[_0x16702c(0x19d)]||_0x16702c(0x1a9),'gateway':_0x5d95e7?.['gateway']||_0x16702c(0x199),'createdAt':new Date(),..._0x5d95e7};await telegramBotService_1[_0x16702c(0x188)][_0x16702c(0x1a7)](_0x400a4b,_0x34362d,_0x16702c(0x185));break;case _0x16702c(0x1c7):const _0x2566cd={'id':_0x16702c(0x1bf),'amount':_0x5d95e7?.[_0x16702c(0x1b5)]||0x1f4,'method':_0x5d95e7?.[_0x16702c(0x1bd)]||_0x16702c(0x195),'createdAt':new Date(),..._0x5d95e7};await telegramBotService_1[_0x16702c(0x188)][_0x16702c(0x18a)](_0x400a4b,_0x2566cd,_0x16702c(0x1be));break;case'custom':await telegramBotService_1['telegramBotService'][_0x16702c(0x19c)](_0x400a4b,_0x5d95e7?.[_0x16702c(0x194)]||_0x16702c(0x1cc),_0x5d95e7?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x1e59de[_0x16702c(0x1b2)](0x190)[_0x16702c(0x1ca)]({'success':![],'message':_0x16702c(0x1ae)});}_0x1e59de[_0x16702c(0x1ca)]({'success':!![],'message':_0x16702c(0x189)+type+_0x16702c(0x193)});}catch(_0x27e1cf){_0x920bdb(_0x27e1cf);}};}}exports['TelegramController']=TelegramController;