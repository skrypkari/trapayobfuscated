'use strict';const a12_0x4219df=a12_0x3497;(function(_0xb56bc0,_0x11621c){const _0x15cff2=a12_0x3497,_0x12edb9=_0xb56bc0();while(!![]){try{const _0x5d0063=-parseInt(_0x15cff2(0x13b))/0x1*(parseInt(_0x15cff2(0x134))/0x2)+-parseInt(_0x15cff2(0x128))/0x3+parseInt(_0x15cff2(0x106))/0x4+-parseInt(_0x15cff2(0x13a))/0x5*(parseInt(_0x15cff2(0x133))/0x6)+-parseInt(_0x15cff2(0x137))/0x7*(-parseInt(_0x15cff2(0x105))/0x8)+-parseInt(_0x15cff2(0x100))/0x9+parseInt(_0x15cff2(0x11e))/0xa*(parseInt(_0x15cff2(0x12c))/0xb);if(_0x5d0063===_0x11621c)break;else _0x12edb9['push'](_0x12edb9['shift']());}catch(_0x14b208){_0x12edb9['push'](_0x12edb9['shift']());}}}(a12_0x5af8,0xc91da));function a12_0x3497(_0x37108d,_0x9b1224){const _0x5af882=a12_0x5af8();return a12_0x3497=function(_0x34978f,_0x2112e1){_0x34978f=_0x34978f-0xfb;let _0x14e7c5=_0x5af882[_0x34978f];return _0x14e7c5;},a12_0x3497(_0x37108d,_0x9b1224);}var __importDefault=this&&this[a12_0x4219df(0xfd)]||function(_0x77b53d){return _0x77b53d&&_0x77b53d['__esModule']?_0x77b53d:{'default':_0x77b53d};};Object[a12_0x4219df(0x10b)](exports,a12_0x4219df(0x12a),{'value':!![]}),exports[a12_0x4219df(0x12e)]=void 0x0;function a12_0x5af8(){const _0xd48ecd=['payout','3297507oVDECr','sendShopNotification','__esModule','Shop\x20not\x20found','473oogDpu','title','TelegramController','telegramUser','count','getTelegramUsers','telegramBotService','6YOxShk','2174zDFaiv','This\x20is\x20a\x20test\x20notification','Broadcast\x20message\x20sent\x20successfully','70qodEdJ','../services/telegramBotService','telegramId','6209135Cvmjsq','1509GDvJVW','Message\x20is\x20required','gateway','body','payment','User\x20disconnected\x20successfully','sendPaymentNotification','USD','__importDefault','lastName','bank_transfer','3398994AOMmWC','status','params','Test\x20Product','groupBy','680896MHxSZs','2933076pvfahG','true','\x20notification\x20sent\x20successfully','paid','desc','defineProperty','default','currency','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','sendBroadcast','productName','filter','plisio','sendPayoutNotification','updatedAt','username','findUnique','shopId','isVerified','findMany','map','getBotInfo','Markdown','method','836820omxNqn','custom','amount','isActive','getBotStatus','update','json','shop','sendTestNotification'];a12_0x5af8=function(){return _0xd48ecd;};return a12_0x5af8();}const telegramBotService_1=require(a12_0x4219df(0x138)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x42f894=a12_0x4219df;this[_0x42f894(0x122)]=async(_0x1c6f62,_0x2da398,_0xf3bea)=>{const _0x490c47=_0x42f894;try{const _0x185b59=telegramBotService_1[_0x490c47(0x132)][_0x490c47(0x11b)](),_0x5e7cb3=await database_1[_0x490c47(0x10c)]['telegramUser'][_0x490c47(0x130)](),_0x297d57=await database_1[_0x490c47(0x10c)]['telegramUser'][_0x490c47(0x130)]({'where':{'isVerified':!![]}}),_0x5b6f51=await database_1[_0x490c47(0x10c)]['telegramUser'][_0x490c47(0x104)]({'by':[_0x490c47(0x117)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2da398[_0x490c47(0x124)]({'success':!![],'result':{'bot':{'isActive':_0x185b59[_0x490c47(0x121)],'username':_0x185b59[_0x490c47(0x115)]},'statistics':{'totalUsers':_0x5e7cb3,'verifiedUsers':_0x297d57,'unverifiedUsers':_0x5e7cb3-_0x297d57,'connectedShops':_0x5b6f51['length']}}});}catch(_0xa7b5cd){_0xf3bea(_0xa7b5cd);}},this[_0x42f894(0x131)]=async(_0x2a6dbb,_0x182f4d,_0x5220e1)=>{const _0x378233=_0x42f894;try{const {page:page=0x1,limit:limit=0x14,verified:_0x399d96}=_0x2a6dbb['query'],_0x512464=(Number(page)-0x1)*Number(limit),_0x52a3dd={};_0x399d96!==undefined&&(_0x52a3dd[_0x378233(0x118)]=_0x399d96===_0x378233(0x107));const [_0xc02498,_0x4951e6]=await Promise['all']([database_1['default'][_0x378233(0x12f)]['findMany']({'where':_0x52a3dd,'skip':_0x512464,'take':Number(limit),'orderBy':{'createdAt':_0x378233(0x10a)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['telegramUser']['count']({'where':_0x52a3dd})]);_0x182f4d[_0x378233(0x124)]({'success':!![],'users':_0xc02498['map'](_0x4b2614=>({'id':_0x4b2614['id'],'telegramId':_0x4b2614[_0x378233(0x139)],'username':_0x4b2614[_0x378233(0x115)],'firstName':_0x4b2614['firstName'],'lastName':_0x4b2614[_0x378233(0xfe)],'isVerified':_0x4b2614['isVerified'],'shop':_0x4b2614[_0x378233(0x125)],'createdAt':_0x4b2614['createdAt'],'updatedAt':_0x4b2614[_0x378233(0x114)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x4951e6,'totalPages':Math['ceil'](_0x4951e6/Number(limit))}});}catch(_0x39defa){_0x5220e1(_0x39defa);}},this[_0x42f894(0x10f)]=async(_0x3cc33c,_0x22c5a5,_0x26d04e)=>{const _0x290d44=_0x42f894;try{const {message:_0x58bc6b,shopId:_0x3423f8}=_0x3cc33c[_0x290d44(0x13e)];if(!_0x58bc6b)return _0x22c5a5[_0x290d44(0x101)](0x190)[_0x290d44(0x124)]({'success':![],'message':_0x290d44(0x13c)});if(_0x3423f8)await telegramBotService_1['telegramBotService'][_0x290d44(0x129)](_0x3423f8,_0x58bc6b,{'parse_mode':_0x290d44(0x11c)});else{const _0x389258=await database_1[_0x290d44(0x10c)][_0x290d44(0x12f)][_0x290d44(0x119)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x58b1c6=[...new Set(_0x389258[_0x290d44(0x11a)](_0x560d91=>_0x560d91[_0x290d44(0x117)])[_0x290d44(0x111)](Boolean))];for(const _0x250f12 of _0x58b1c6){_0x250f12&&await telegramBotService_1[_0x290d44(0x132)]['sendShopNotification'](_0x250f12,_0x58bc6b,{'parse_mode':'Markdown'});}}_0x22c5a5[_0x290d44(0x124)]({'success':!![],'message':_0x290d44(0x136)});}catch(_0x12bb8d){_0x26d04e(_0x12bb8d);}},this['disconnectUser']=async(_0x5b7923,_0x1b6ccc,_0x39473a)=>{const _0x4bf661=_0x42f894;try{const {telegramId:_0x5b378d}=_0x5b7923[_0x4bf661(0x102)],_0x2e3c35=await database_1[_0x4bf661(0x10c)][_0x4bf661(0x12f)][_0x4bf661(0x116)]({'where':{'telegramId':_0x5b378d},'include':{'shop':!![]}});if(!_0x2e3c35)return _0x1b6ccc[_0x4bf661(0x101)](0x194)[_0x4bf661(0x124)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x4bf661(0x10c)]['telegramUser'][_0x4bf661(0x123)]({'where':{'telegramId':_0x5b378d},'data':{'shopId':null,'isVerified':![]}}),_0x1b6ccc[_0x4bf661(0x124)]({'success':!![],'message':_0x4bf661(0x140)});}catch(_0x14ebb2){_0x39473a(_0x14ebb2);}},this[_0x42f894(0x126)]=async(_0x5c01b8,_0x33195f,_0x214497)=>{const _0x34a3f1=_0x42f894;try{const {shopId:_0x42c5ce,type:type=_0x34a3f1(0x13f),testData:_0x1b1818}=_0x5c01b8['body'];if(!_0x42c5ce)return _0x33195f[_0x34a3f1(0x101)](0x190)[_0x34a3f1(0x124)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x4dd3f0=await database_1['default'][_0x34a3f1(0x125)][_0x34a3f1(0x116)]({'where':{'id':_0x42c5ce},'select':{'id':!![],'name':!![]}});if(!_0x4dd3f0)return _0x33195f[_0x34a3f1(0x101)](0x194)['json']({'success':![],'message':_0x34a3f1(0x12b)});switch(type){case _0x34a3f1(0x13f):const _0x101300={'id':'test_payment_123','amount':_0x1b1818?.[_0x34a3f1(0x120)]||0x64,'currency':_0x1b1818?.[_0x34a3f1(0x10d)]||_0x34a3f1(0xfc),'productName':_0x1b1818?.[_0x34a3f1(0x110)]||_0x34a3f1(0x103),'gateway':_0x1b1818?.[_0x34a3f1(0x13d)]||_0x34a3f1(0x112),'createdAt':new Date(),..._0x1b1818};await telegramBotService_1[_0x34a3f1(0x132)][_0x34a3f1(0xfb)](_0x42c5ce,_0x101300,_0x34a3f1(0x109));break;case _0x34a3f1(0x127):const _0x59a894={'id':'test_payout_123','amount':_0x1b1818?.['amount']||0x1f4,'method':_0x1b1818?.[_0x34a3f1(0x11d)]||_0x34a3f1(0xff),'createdAt':new Date(),..._0x1b1818};await telegramBotService_1['telegramBotService'][_0x34a3f1(0x113)](_0x42c5ce,_0x59a894,'completed');break;case _0x34a3f1(0x11f):await telegramBotService_1[_0x34a3f1(0x132)]['sendCustomNotification'](_0x42c5ce,_0x1b1818?.[_0x34a3f1(0x12d)]||'Test\x20Notification',_0x1b1818?.['details']||{'message':_0x34a3f1(0x135)});break;default:return _0x33195f[_0x34a3f1(0x101)](0x190)[_0x34a3f1(0x124)]({'success':![],'message':_0x34a3f1(0x10e)});}_0x33195f['json']({'success':!![],'message':'Test\x20'+type+_0x34a3f1(0x108)});}catch(_0x3a15d3){_0x214497(_0x3a15d3);}};}}exports[a12_0x4219df(0x12e)]=TelegramController;