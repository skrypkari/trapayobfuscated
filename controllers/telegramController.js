'use strict';const a19_0x1efe9a=a19_0x18ff;(function(_0x512501,_0x2b4801){const _0x34094f=a19_0x18ff,_0x281c13=_0x512501();while(!![]){try{const _0x20bb81=parseInt(_0x34094f(0x1a6))/0x1+parseInt(_0x34094f(0x1c3))/0x2*(parseInt(_0x34094f(0x1cb))/0x3)+parseInt(_0x34094f(0x1b2))/0x4+-parseInt(_0x34094f(0x1da))/0x5*(-parseInt(_0x34094f(0x1b1))/0x6)+parseInt(_0x34094f(0x1b8))/0x7*(parseInt(_0x34094f(0x1ab))/0x8)+parseInt(_0x34094f(0x1dc))/0x9+-parseInt(_0x34094f(0x19c))/0xa*(parseInt(_0x34094f(0x1ce))/0xb);if(_0x20bb81===_0x2b4801)break;else _0x281c13['push'](_0x281c13['shift']());}catch(_0x2975dd){_0x281c13['push'](_0x281c13['shift']());}}}(a19_0x179f,0xbf737));function a19_0x179f(){const _0xfc6832=['getBotStatus','This\x20is\x20a\x20test\x20notification','81dBOYgL','sendShopNotification','Markdown','22NBopAF','length','details','findUnique','body','gateway','groupBy','custom','sendBroadcast','lastName','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Shop\x20ID\x20is\x20required','20bzKRXF','telegramBotService','12910419rrkccy','payment','firstName','amount','sendCustomNotification','status','Shop\x20not\x20found','productName','isVerified','Тестовый\x20период','count','../config/database','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','USD','28811860JbgVus','Test\x20Product','Test\x20Notification','query','network','\x20notification\x20sent\x20successfully','shopId','update','desc','sendPaymentNotification','452525AZSXcN','Test\x20','disconnectUser','paid','map','17048zwnlGk','isActive','shop','wallet','username','TRC20','1229454zMtZjR','5247136sxOlgD','Broadcast\x20message\x20sent\x20successfully','defineProperty','payout','getBotInfo','__esModule','3682CaTUnj','true','params','default','../services/telegramBotService','all','test_payout_123','__importDefault','telegramUser','title','currency','104238hZETYN','json','sendPayoutNotification','createdAt','test_payment_123','TelegramController'];a19_0x179f=function(){return _0xfc6832;};return a19_0x179f();}function a19_0x18ff(_0x50dcf2,_0x20b9cb){_0x50dcf2=_0x50dcf2-0x18f;const _0x179f6b=a19_0x179f();let _0x18ff82=_0x179f6b[_0x50dcf2];return _0x18ff82;}var __importDefault=this&&this[a19_0x1efe9a(0x1bf)]||function(_0x34fbe7){const _0x204e4c=a19_0x1efe9a;return _0x34fbe7&&_0x34fbe7[_0x204e4c(0x1b7)]?_0x34fbe7:{'default':_0x34fbe7};};Object[a19_0x1efe9a(0x1b4)](exports,a19_0x1efe9a(0x1b7),{'value':!![]}),exports[a19_0x1efe9a(0x1c8)]=void 0x0;const telegramBotService_1=require(a19_0x1efe9a(0x1bc)),database_1=__importDefault(require(a19_0x1efe9a(0x199)));class TelegramController{constructor(){const _0x9e9c27=a19_0x1efe9a;this[_0x9e9c27(0x1c9)]=async(_0x414f2b,_0x37ef5f,_0x584186)=>{const _0xe9bcb7=_0x9e9c27;try{const _0x2ec6e9=telegramBotService_1[_0xe9bcb7(0x1db)][_0xe9bcb7(0x1b6)](),_0x43166e=await database_1[_0xe9bcb7(0x1bb)][_0xe9bcb7(0x1c0)][_0xe9bcb7(0x198)](),_0x4b1577=await database_1[_0xe9bcb7(0x1bb)][_0xe9bcb7(0x1c0)][_0xe9bcb7(0x198)]({'where':{'isVerified':!![]}}),_0x19143b=await database_1[_0xe9bcb7(0x1bb)]['telegramUser'][_0xe9bcb7(0x1d4)]({'by':[_0xe9bcb7(0x1a2)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x37ef5f[_0xe9bcb7(0x1c4)]({'success':!![],'result':{'bot':{'isActive':_0x2ec6e9[_0xe9bcb7(0x1ac)],'username':_0x2ec6e9['username']},'statistics':{'totalUsers':_0x43166e,'verifiedUsers':_0x4b1577,'unverifiedUsers':_0x43166e-_0x4b1577,'connectedShops':_0x19143b[_0xe9bcb7(0x1cf)]}}});}catch(_0x405fc7){_0x584186(_0x405fc7);}},this['getTelegramUsers']=async(_0x55ee36,_0xa00eb,_0x28f4fe)=>{const _0x31a5b9=_0x9e9c27;try{const {page:page=0x1,limit:limit=0x14,verified:_0xac62d0}=_0x55ee36[_0x31a5b9(0x19f)],_0x9977b0=(Number(page)-0x1)*Number(limit),_0x38bf56={};_0xac62d0!==undefined&&(_0x38bf56[_0x31a5b9(0x196)]=_0xac62d0===_0x31a5b9(0x1b9));const [_0x479009,_0x31a6fc]=await Promise[_0x31a5b9(0x1bd)]([database_1[_0x31a5b9(0x1bb)]['telegramUser']['findMany']({'where':_0x38bf56,'skip':_0x9977b0,'take':Number(limit),'orderBy':{'createdAt':_0x31a5b9(0x1a4)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x31a5b9(0x1bb)][_0x31a5b9(0x1c0)][_0x31a5b9(0x198)]({'where':_0x38bf56})]);_0xa00eb[_0x31a5b9(0x1c4)]({'success':!![],'users':_0x479009[_0x31a5b9(0x1aa)](_0x48832f=>({'id':_0x48832f['id'],'telegramId':_0x48832f['telegramId'],'username':_0x48832f[_0x31a5b9(0x1af)],'firstName':_0x48832f[_0x31a5b9(0x190)],'lastName':_0x48832f[_0x31a5b9(0x1d7)],'isVerified':_0x48832f[_0x31a5b9(0x196)],'shop':_0x48832f[_0x31a5b9(0x1ad)],'createdAt':_0x48832f[_0x31a5b9(0x1c6)],'updatedAt':_0x48832f['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x31a6fc,'totalPages':Math['ceil'](_0x31a6fc/Number(limit))}});}catch(_0x280a5d){_0x28f4fe(_0x280a5d);}},this[_0x9e9c27(0x1d6)]=async(_0x5cc64c,_0x711223,_0x47690c)=>{const _0x27b632=_0x9e9c27;try{const {message:_0x368ec8,shopId:_0x197043}=_0x5cc64c[_0x27b632(0x1d2)];if(!_0x368ec8)return _0x711223[_0x27b632(0x193)](0x190)[_0x27b632(0x1c4)]({'success':![],'message':'Message\x20is\x20required'});if(_0x197043)await telegramBotService_1[_0x27b632(0x1db)][_0x27b632(0x1cc)](_0x197043,_0x368ec8,{'parse_mode':_0x27b632(0x1cd)});else{const _0x2788ef=await database_1[_0x27b632(0x1bb)][_0x27b632(0x1c0)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x425376=[...new Set(_0x2788ef['map'](_0x571e1b=>_0x571e1b['shopId'])['filter'](Boolean))];for(const _0x3e29fc of _0x425376){_0x3e29fc&&await telegramBotService_1[_0x27b632(0x1db)]['sendShopNotification'](_0x3e29fc,_0x368ec8,{'parse_mode':'Markdown'});}}_0x711223[_0x27b632(0x1c4)]({'success':!![],'message':_0x27b632(0x1b3)});}catch(_0x1a9f4e){_0x47690c(_0x1a9f4e);}},this[_0x9e9c27(0x1a8)]=async(_0x481a91,_0x56e809,_0x5d0d5c)=>{const _0x5538c5=_0x9e9c27;try{const {telegramId:_0x5c54f9}=_0x481a91[_0x5538c5(0x1ba)],_0x233034=await database_1['default'][_0x5538c5(0x1c0)]['findUnique']({'where':{'telegramId':_0x5c54f9},'include':{'shop':!![]}});if(!_0x233034)return _0x56e809[_0x5538c5(0x193)](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x5538c5(0x1bb)]['telegramUser'][_0x5538c5(0x1a3)]({'where':{'telegramId':_0x5c54f9},'data':{'shopId':null,'isVerified':![]}}),_0x56e809['json']({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x3e1467){_0x5d0d5c(_0x3e1467);}},this['sendTestNotification']=async(_0x56b50f,_0xf3eb03,_0x2d18c0)=>{const _0x2a5232=_0x9e9c27;try{const {shopId:_0x3c955c,type:type=_0x2a5232(0x18f),testData:_0x420cfa}=_0x56b50f[_0x2a5232(0x1d2)];if(!_0x3c955c)return _0xf3eb03[_0x2a5232(0x193)](0x190)[_0x2a5232(0x1c4)]({'success':![],'message':_0x2a5232(0x1d9)});const _0x1edec9=await database_1['default'][_0x2a5232(0x1ad)][_0x2a5232(0x1d1)]({'where':{'id':_0x3c955c},'select':{'id':!![],'name':!![]}});if(!_0x1edec9)return _0xf3eb03[_0x2a5232(0x193)](0x194)[_0x2a5232(0x1c4)]({'success':![],'message':_0x2a5232(0x194)});switch(type){case _0x2a5232(0x18f):const _0x54d7d8={'id':_0x2a5232(0x1c7),'amount':_0x420cfa?.[_0x2a5232(0x191)]||0x64,'currency':_0x420cfa?.[_0x2a5232(0x1c2)]||_0x2a5232(0x19b),'productName':_0x420cfa?.[_0x2a5232(0x195)]||_0x2a5232(0x19d),'gateway':_0x420cfa?.[_0x2a5232(0x1d3)]||'plisio','createdAt':new Date(),..._0x420cfa};await telegramBotService_1[_0x2a5232(0x1db)][_0x2a5232(0x1a5)](_0x3c955c,_0x54d7d8,_0x2a5232(0x1a9));break;case _0x2a5232(0x1b5):const _0x176893={'id':_0x2a5232(0x1be),'amount':_0x420cfa?.[_0x2a5232(0x191)]||0x1f4,'network':_0x420cfa?.[_0x2a5232(0x1a0)]||_0x2a5232(0x1b0),'wallet':_0x420cfa?.[_0x2a5232(0x1ae)]||_0x2a5232(0x19a),'period':_0x2a5232(0x197),'createdAt':new Date(),'txid':_0x420cfa?.['txid']||null,..._0x420cfa};await telegramBotService_1[_0x2a5232(0x1db)][_0x2a5232(0x1c5)](_0x3c955c,_0x176893);break;case _0x2a5232(0x1d5):await telegramBotService_1[_0x2a5232(0x1db)][_0x2a5232(0x192)](_0x3c955c,_0x420cfa?.[_0x2a5232(0x1c1)]||_0x2a5232(0x19e),_0x420cfa?.[_0x2a5232(0x1d0)]||{'message':_0x2a5232(0x1ca)});break;default:return _0xf3eb03[_0x2a5232(0x193)](0x190)[_0x2a5232(0x1c4)]({'success':![],'message':_0x2a5232(0x1d8)});}_0xf3eb03[_0x2a5232(0x1c4)]({'success':!![],'message':_0x2a5232(0x1a7)+type+_0x2a5232(0x1a1)});}catch(_0x141e26){_0x2d18c0(_0x141e26);}};}}exports[a19_0x1efe9a(0x1c8)]=TelegramController;