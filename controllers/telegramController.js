'use strict';const a12_0x4eded5=a12_0xe70c;(function(_0x30ef13,_0x20efa2){const _0x2c4c80=a12_0xe70c,_0x4d3486=_0x30ef13();while(!![]){try{const _0x5324ee=parseInt(_0x2c4c80(0x77))/0x1+-parseInt(_0x2c4c80(0x9f))/0x2+parseInt(_0x2c4c80(0x93))/0x3+parseInt(_0x2c4c80(0xa8))/0x4*(-parseInt(_0x2c4c80(0x68))/0x5)+-parseInt(_0x2c4c80(0x69))/0x6*(parseInt(_0x2c4c80(0xb0))/0x7)+-parseInt(_0x2c4c80(0x8d))/0x8*(-parseInt(_0x2c4c80(0xaa))/0x9)+-parseInt(_0x2c4c80(0x8a))/0xa*(-parseInt(_0x2c4c80(0x81))/0xb);if(_0x5324ee===_0x20efa2)break;else _0x4d3486['push'](_0x4d3486['shift']());}catch(_0x2ab9ee){_0x4d3486['push'](_0x4d3486['shift']());}}}(a12_0x4d3f,0xb15f9));var __importDefault=this&&this['__importDefault']||function(_0x384e7e){return _0x384e7e&&_0x384e7e['__esModule']?_0x384e7e:{'default':_0x384e7e};};function a12_0xe70c(_0x12ddb0,_0x4691f8){const _0x4d3f1e=a12_0x4d3f();return a12_0xe70c=function(_0xe70c39,_0x3e5791){_0xe70c39=_0xe70c39-0x68;let _0x140944=_0x4d3f1e[_0xe70c39];return _0x140944;},a12_0xe70c(_0x12ddb0,_0x4691f8);}Object[a12_0x4eded5(0x7d)](exports,a12_0x4eded5(0x78),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x4eded5(0xa1)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x1c4784=a12_0x4eded5;this[_0x1c4784(0x7f)]=async(_0x560ff4,_0x45a869,_0x1386c1)=>{const _0x1aea68=_0x1c4784;try{const _0x5350c3=telegramBotService_1[_0x1aea68(0x92)][_0x1aea68(0x9c)](),_0x1c92bd=await database_1['default'][_0x1aea68(0x96)][_0x1aea68(0x9e)](),_0x598605=await database_1[_0x1aea68(0x6d)][_0x1aea68(0x96)][_0x1aea68(0x9e)]({'where':{'isVerified':!![]}}),_0x5ad78f=await database_1[_0x1aea68(0x6d)][_0x1aea68(0x96)]['groupBy']({'by':[_0x1aea68(0x87)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x45a869[_0x1aea68(0x79)]({'success':!![],'result':{'bot':{'isActive':_0x5350c3['isActive'],'username':_0x5350c3[_0x1aea68(0xa2)]},'statistics':{'totalUsers':_0x1c92bd,'verifiedUsers':_0x598605,'unverifiedUsers':_0x1c92bd-_0x598605,'connectedShops':_0x5ad78f[_0x1aea68(0x7c)]}}});}catch(_0x90b92e){_0x1386c1(_0x90b92e);}},this[_0x1c4784(0x74)]=async(_0x22900e,_0x553399,_0x4112c0)=>{const _0xfe4e5f=_0x1c4784;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3fe91f}=_0x22900e['query'],_0x4e7ea3=(Number(page)-0x1)*Number(limit),_0x1ca028={};_0x3fe91f!==undefined&&(_0x1ca028['isVerified']=_0x3fe91f==='true');const [_0x1943c9,_0x4f416a]=await Promise[_0xfe4e5f(0x9d)]([database_1[_0xfe4e5f(0x6d)][_0xfe4e5f(0x96)][_0xfe4e5f(0x98)]({'where':_0x1ca028,'skip':_0x4e7ea3,'take':Number(limit),'orderBy':{'createdAt':_0xfe4e5f(0x8e)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0xfe4e5f(0x6d)][_0xfe4e5f(0x96)][_0xfe4e5f(0x9e)]({'where':_0x1ca028})]);_0x553399[_0xfe4e5f(0x79)]({'success':!![],'users':_0x1943c9[_0xfe4e5f(0x70)](_0x46f486=>({'id':_0x46f486['id'],'telegramId':_0x46f486[_0xfe4e5f(0x6f)],'username':_0x46f486[_0xfe4e5f(0xa2)],'firstName':_0x46f486[_0xfe4e5f(0x73)],'lastName':_0x46f486[_0xfe4e5f(0xab)],'isVerified':_0x46f486[_0xfe4e5f(0x72)],'shop':_0x46f486[_0xfe4e5f(0xae)],'createdAt':_0x46f486[_0xfe4e5f(0x7b)],'updatedAt':_0x46f486[_0xfe4e5f(0x9a)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x4f416a,'totalPages':Math['ceil'](_0x4f416a/Number(limit))}});}catch(_0x85aa7e){_0x4112c0(_0x85aa7e);}},this[_0x1c4784(0x91)]=async(_0x188109,_0x2a99c0,_0x3f4dea)=>{const _0x303807=_0x1c4784;try{const {message:_0x3a72e0,shopId:_0x5d401e}=_0x188109[_0x303807(0x94)];if(!_0x3a72e0)return _0x2a99c0['status'](0x190)[_0x303807(0x79)]({'success':![],'message':_0x303807(0x95)});if(_0x5d401e)await telegramBotService_1[_0x303807(0x92)][_0x303807(0x9b)](_0x5d401e,_0x3a72e0,{'parse_mode':'Markdown'});else{const _0x3ddf65=await database_1['default']['telegramUser'][_0x303807(0x98)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x38fb03=[...new Set(_0x3ddf65[_0x303807(0x70)](_0x25b81c=>_0x25b81c[_0x303807(0x87)])[_0x303807(0xad)](Boolean))];for(const _0x3c34e4 of _0x38fb03){_0x3c34e4&&await telegramBotService_1[_0x303807(0x92)][_0x303807(0x9b)](_0x3c34e4,_0x3a72e0,{'parse_mode':_0x303807(0x8f)});}}_0x2a99c0[_0x303807(0x79)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x170544){_0x3f4dea(_0x170544);}},this[_0x1c4784(0xac)]=async(_0x103e55,_0x3de2a4,_0x5135aa)=>{const _0x584e9a=_0x1c4784;try{const {telegramId:_0x1a7c88}=_0x103e55[_0x584e9a(0x86)],_0x4d7ddc=await database_1[_0x584e9a(0x6d)][_0x584e9a(0x96)][_0x584e9a(0x76)]({'where':{'telegramId':_0x1a7c88},'include':{'shop':!![]}});if(!_0x4d7ddc)return _0x3de2a4[_0x584e9a(0x6e)](0x194)['json']({'success':![],'message':_0x584e9a(0x97)});await database_1[_0x584e9a(0x6d)][_0x584e9a(0x96)][_0x584e9a(0x7e)]({'where':{'telegramId':_0x1a7c88},'data':{'shopId':null,'isVerified':![]}}),_0x3de2a4[_0x584e9a(0x79)]({'success':!![],'message':_0x584e9a(0x83)});}catch(_0x396c2a){_0x5135aa(_0x396c2a);}},this[_0x1c4784(0x6c)]=async(_0x26b0bc,_0x431b26,_0x52447c)=>{const _0xe6b2eb=_0x1c4784;try{const {shopId:_0x58051d,type:type='payment',testData:_0x9e73d5}=_0x26b0bc['body'];if(!_0x58051d)return _0x431b26['status'](0x190)[_0xe6b2eb(0x79)]({'success':![],'message':_0xe6b2eb(0xa9)});const _0x2b1a38=await database_1[_0xe6b2eb(0x6d)][_0xe6b2eb(0xae)][_0xe6b2eb(0x76)]({'where':{'id':_0x58051d},'select':{'id':!![],'name':!![]}});if(!_0x2b1a38)return _0x431b26[_0xe6b2eb(0x6e)](0x194)[_0xe6b2eb(0x79)]({'success':![],'message':_0xe6b2eb(0x85)});switch(type){case _0xe6b2eb(0x90):const _0x38c0b9={'id':_0xe6b2eb(0xa5),'amount':_0x9e73d5?.['amount']||0x64,'currency':_0x9e73d5?.[_0xe6b2eb(0x82)]||_0xe6b2eb(0x6a),'productName':_0x9e73d5?.[_0xe6b2eb(0x8c)]||'Test\x20Product','gateway':_0x9e73d5?.[_0xe6b2eb(0x88)]||_0xe6b2eb(0x75),'createdAt':new Date(),..._0x9e73d5};await telegramBotService_1[_0xe6b2eb(0x92)]['sendPaymentNotification'](_0x58051d,_0x38c0b9,_0xe6b2eb(0xa0));break;case'payout':const _0xba4936={'id':_0xe6b2eb(0xa7),'amount':_0x9e73d5?.['amount']||0x1f4,'method':_0x9e73d5?.['method']||_0xe6b2eb(0x6b),'createdAt':new Date(),..._0x9e73d5};await telegramBotService_1[_0xe6b2eb(0x92)]['sendPayoutNotification'](_0x58051d,_0xba4936,_0xe6b2eb(0x7a));break;case _0xe6b2eb(0xa6):await telegramBotService_1[_0xe6b2eb(0x92)][_0xe6b2eb(0xa4)](_0x58051d,_0x9e73d5?.[_0xe6b2eb(0x89)]||_0xe6b2eb(0x8b),_0x9e73d5?.[_0xe6b2eb(0x99)]||{'message':_0xe6b2eb(0x80)});break;default:return _0x431b26[_0xe6b2eb(0x6e)](0x190)[_0xe6b2eb(0x79)]({'success':![],'message':_0xe6b2eb(0xa3)});}_0x431b26[_0xe6b2eb(0x79)]({'success':!![],'message':_0xe6b2eb(0x84)+type+_0xe6b2eb(0x71)});}catch(_0x342d09){_0x52447c(_0x342d09);}};}}exports[a12_0x4eded5(0xaf)]=TelegramController;function a12_0x4d3f(){const _0x54de53=['Shop\x20ID\x20is\x20required','12632265cSxIvU','lastName','disconnectUser','filter','shop','TelegramController','1447201ILZzoy','158745jXoqyA','6gzdsKE','USD','bank_transfer','sendTestNotification','default','status','telegramId','map','\x20notification\x20sent\x20successfully','isVerified','firstName','getTelegramUsers','plisio','findUnique','213284ScRxju','__esModule','json','completed','createdAt','length','defineProperty','update','getBotStatus','This\x20is\x20a\x20test\x20notification','44wgTilN','currency','User\x20disconnected\x20successfully','Test\x20','Shop\x20not\x20found','params','shopId','gateway','title','3102250JCHUiM','Test\x20Notification','productName','8yvZqpx','desc','Markdown','payment','sendBroadcast','telegramBotService','1014498EcBAcw','body','Message\x20is\x20required','telegramUser','Telegram\x20user\x20not\x20found','findMany','details','updatedAt','sendShopNotification','getBotInfo','all','count','2429908KGjnud','paid','../services/telegramBotService','username','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','sendCustomNotification','test_payment_123','custom','test_payout_123','132FUThCr'];a12_0x4d3f=function(){return _0x54de53;};return a12_0x4d3f();}