'use strict';const a12_0x55db88=a12_0x251e;(function(_0xcc8129,_0x52f727){const _0x11cee3=a12_0x251e,_0x4f1ffb=_0xcc8129();while(!![]){try{const _0x38839c=-parseInt(_0x11cee3(0x167))/0x1+-parseInt(_0x11cee3(0x174))/0x2+parseInt(_0x11cee3(0x16b))/0x3*(-parseInt(_0x11cee3(0x16d))/0x4)+parseInt(_0x11cee3(0x160))/0x5+-parseInt(_0x11cee3(0x13e))/0x6+parseInt(_0x11cee3(0x158))/0x7+parseInt(_0x11cee3(0x139))/0x8;if(_0x38839c===_0x52f727)break;else _0x4f1ffb['push'](_0x4f1ffb['shift']());}catch(_0x3fa211){_0x4f1ffb['push'](_0x4f1ffb['shift']());}}}(a12_0x8cc1,0x26308));var __importDefault=this&&this['__importDefault']||function(_0xf7ef3d){const _0x204c60=a12_0x251e;return _0xf7ef3d&&_0xf7ef3d[_0x204c60(0x141)]?_0xf7ef3d:{'default':_0xf7ef3d};};Object[a12_0x55db88(0x177)](exports,a12_0x55db88(0x141),{'value':!![]}),exports[a12_0x55db88(0x168)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x55db88(0x135)));class TelegramController{constructor(){const _0x3963dd=a12_0x55db88;this['getBotStatus']=async(_0x46b3f8,_0x25924d,_0x4abced)=>{const _0x277758=a12_0x251e;try{const _0x172a2a=telegramBotService_1[_0x277758(0x13b)][_0x277758(0x161)](),_0x579ef6=await database_1[_0x277758(0x144)][_0x277758(0x175)][_0x277758(0x159)](),_0x420870=await database_1[_0x277758(0x144)][_0x277758(0x175)][_0x277758(0x159)]({'where':{'isVerified':!![]}}),_0x2a8fa6=await database_1['default'][_0x277758(0x175)][_0x277758(0x132)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x25924d[_0x277758(0x13f)]({'success':!![],'result':{'bot':{'isActive':_0x172a2a[_0x277758(0x143)],'username':_0x172a2a[_0x277758(0x131)]},'statistics':{'totalUsers':_0x579ef6,'verifiedUsers':_0x420870,'unverifiedUsers':_0x579ef6-_0x420870,'connectedShops':_0x2a8fa6[_0x277758(0x16f)]}}});}catch(_0x472b2a){_0x4abced(_0x472b2a);}},this['getTelegramUsers']=async(_0x59b089,_0x44aaae,_0x53456e)=>{const _0x21a725=a12_0x251e;try{const {page:page=0x1,limit:limit=0x14,verified:_0x44d13a}=_0x59b089[_0x21a725(0x170)],_0x4a07c0=(Number(page)-0x1)*Number(limit),_0x6328ce={};_0x44d13a!==undefined&&(_0x6328ce[_0x21a725(0x162)]=_0x44d13a===_0x21a725(0x151));const [_0x546d73,_0x294a46]=await Promise[_0x21a725(0x157)]([database_1[_0x21a725(0x144)][_0x21a725(0x175)][_0x21a725(0x15c)]({'where':_0x6328ce,'skip':_0x4a07c0,'take':Number(limit),'orderBy':{'createdAt':_0x21a725(0x154)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x21a725(0x175)][_0x21a725(0x159)]({'where':_0x6328ce})]);_0x44aaae['json']({'success':!![],'users':_0x546d73[_0x21a725(0x147)](_0xb2ccf3=>({'id':_0xb2ccf3['id'],'telegramId':_0xb2ccf3[_0x21a725(0x165)],'username':_0xb2ccf3[_0x21a725(0x131)],'firstName':_0xb2ccf3[_0x21a725(0x14c)],'lastName':_0xb2ccf3[_0x21a725(0x166)],'isVerified':_0xb2ccf3[_0x21a725(0x162)],'shop':_0xb2ccf3[_0x21a725(0x153)],'createdAt':_0xb2ccf3[_0x21a725(0x14e)],'updatedAt':_0xb2ccf3[_0x21a725(0x145)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x294a46,'totalPages':Math[_0x21a725(0x133)](_0x294a46/Number(limit))}});}catch(_0x2ec29a){_0x53456e(_0x2ec29a);}},this[_0x3963dd(0x137)]=async(_0x30e508,_0x249442,_0x5262b6)=>{const _0x27d605=_0x3963dd;try{const {message:_0x3e1d98,shopId:_0x113a84}=_0x30e508['body'];if(!_0x3e1d98)return _0x249442['status'](0x190)[_0x27d605(0x13f)]({'success':![],'message':_0x27d605(0x142)});if(_0x113a84)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x113a84,_0x3e1d98,{'parse_mode':_0x27d605(0x155)});else{const _0x44d4bc=await database_1[_0x27d605(0x144)]['telegramUser'][_0x27d605(0x15c)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2ab149=[...new Set(_0x44d4bc[_0x27d605(0x147)](_0x27aa7c=>_0x27aa7c[_0x27d605(0x176)])[_0x27d605(0x13c)](Boolean))];for(const _0x54f03a of _0x2ab149){_0x54f03a&&await telegramBotService_1[_0x27d605(0x13b)][_0x27d605(0x152)](_0x54f03a,_0x3e1d98,{'parse_mode':_0x27d605(0x155)});}}_0x249442[_0x27d605(0x13f)]({'success':!![],'message':_0x27d605(0x15d)});}catch(_0x20490a){_0x5262b6(_0x20490a);}},this[_0x3963dd(0x14d)]=async(_0x73e77f,_0x2d15b7,_0xb2172c)=>{const _0x2a5253=_0x3963dd;try{const {telegramId:_0x1d405f}=_0x73e77f[_0x2a5253(0x13a)],_0x3124d7=await database_1[_0x2a5253(0x144)][_0x2a5253(0x175)][_0x2a5253(0x178)]({'where':{'telegramId':_0x1d405f},'include':{'shop':!![]}});if(!_0x3124d7)return _0x2d15b7[_0x2a5253(0x169)](0x194)[_0x2a5253(0x13f)]({'success':![],'message':_0x2a5253(0x14f)});await database_1[_0x2a5253(0x144)][_0x2a5253(0x175)][_0x2a5253(0x16a)]({'where':{'telegramId':_0x1d405f},'data':{'shopId':null,'isVerified':![]}}),_0x2d15b7[_0x2a5253(0x13f)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x509ba1){_0xb2172c(_0x509ba1);}},this[_0x3963dd(0x15b)]=async(_0x35a9d1,_0x45419e,_0x4ea266)=>{const _0x23fb7a=_0x3963dd;try{const {shopId:_0x43627c,type:type=_0x23fb7a(0x173),testData:_0x4e263e}=_0x35a9d1[_0x23fb7a(0x14a)];if(!_0x43627c)return _0x45419e[_0x23fb7a(0x169)](0x190)[_0x23fb7a(0x13f)]({'success':![],'message':_0x23fb7a(0x15a)});const _0x111334=await database_1['default']['shop'][_0x23fb7a(0x178)]({'where':{'id':_0x43627c},'select':{'id':!![],'name':!![]}});if(!_0x111334)return _0x45419e['status'](0x194)[_0x23fb7a(0x13f)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0x6d21c7={'id':_0x23fb7a(0x163),'amount':_0x4e263e?.['amount']||0x64,'currency':_0x4e263e?.[_0x23fb7a(0x136)]||_0x23fb7a(0x16e),'productName':_0x4e263e?.[_0x23fb7a(0x179)]||_0x23fb7a(0x149),'gateway':_0x4e263e?.[_0x23fb7a(0x15f)]||_0x23fb7a(0x146),'createdAt':new Date(),..._0x4e263e};await telegramBotService_1[_0x23fb7a(0x13b)][_0x23fb7a(0x16c)](_0x43627c,_0x6d21c7,_0x23fb7a(0x134));break;case'payout':const _0x303520={'id':_0x23fb7a(0x172),'amount':_0x4e263e?.[_0x23fb7a(0x140)]||0x1f4,'method':_0x4e263e?.[_0x23fb7a(0x15e)]||_0x23fb7a(0x156),'createdAt':new Date(),..._0x4e263e};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x43627c,_0x303520,_0x23fb7a(0x164));break;case _0x23fb7a(0x171):await telegramBotService_1[_0x23fb7a(0x13b)]['sendCustomNotification'](_0x43627c,_0x4e263e?.[_0x23fb7a(0x13d)]||_0x23fb7a(0x14b),_0x4e263e?.[_0x23fb7a(0x150)]||{'message':_0x23fb7a(0x138)});break;default:return _0x45419e[_0x23fb7a(0x169)](0x190)[_0x23fb7a(0x13f)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x45419e[_0x23fb7a(0x13f)]({'success':!![],'message':_0x23fb7a(0x148)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x4bb6ab){_0x4ea266(_0x4bb6ab);}};}}function a12_0x251e(_0x1a97ae,_0x575024){const _0x8cc101=a12_0x8cc1();return a12_0x251e=function(_0x251e98,_0x442ae5){_0x251e98=_0x251e98-0x131;let _0x9a152b=_0x8cc101[_0x251e98];return _0x9a152b;},a12_0x251e(_0x1a97ae,_0x575024);}function a12_0x8cc1(){const _0x59d114=['currency','sendBroadcast','This\x20is\x20a\x20test\x20notification','3786184zMuEyU','params','telegramBotService','filter','title','1358760vpsVUF','json','amount','__esModule','Message\x20is\x20required','isActive','default','updatedAt','plisio','map','Test\x20','Test\x20Product','body','Test\x20Notification','firstName','disconnectUser','createdAt','Telegram\x20user\x20not\x20found','details','true','sendShopNotification','shop','desc','Markdown','bank_transfer','all','1470833DNeYGu','count','Shop\x20ID\x20is\x20required','sendTestNotification','findMany','Broadcast\x20message\x20sent\x20successfully','method','gateway','938615dxBdEt','getBotInfo','isVerified','test_payment_123','completed','telegramId','lastName','103959gaBCxJ','TelegramController','status','update','193326ubPehl','sendPaymentNotification','8IXVlrw','USD','length','query','custom','test_payout_123','payment','510776TbCxPC','telegramUser','shopId','defineProperty','findUnique','productName','username','groupBy','ceil','paid','../config/database'];a12_0x8cc1=function(){return _0x59d114;};return a12_0x8cc1();}exports['TelegramController']=TelegramController;