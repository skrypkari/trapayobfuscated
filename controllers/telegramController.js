'use strict';const a12_0x1a4b92=a12_0x4b85;(function(_0xe13073,_0x1a6247){const _0x4794f3=a12_0x4b85,_0x58b260=_0xe13073();while(!![]){try{const _0x3ac40f=-parseInt(_0x4794f3(0xd3))/0x1*(-parseInt(_0x4794f3(0xea))/0x2)+parseInt(_0x4794f3(0xb6))/0x3*(-parseInt(_0x4794f3(0xdf))/0x4)+parseInt(_0x4794f3(0xc4))/0x5+parseInt(_0x4794f3(0xc9))/0x6*(-parseInt(_0x4794f3(0xe9))/0x7)+-parseInt(_0x4794f3(0xce))/0x8+parseInt(_0x4794f3(0xe6))/0x9+parseInt(_0x4794f3(0xd9))/0xa*(parseInt(_0x4794f3(0xaf))/0xb);if(_0x3ac40f===_0x1a6247)break;else _0x58b260['push'](_0x58b260['shift']());}catch(_0x3b6478){_0x58b260['push'](_0x58b260['shift']());}}}(a12_0x432c,0x1b074));var __importDefault=this&&this[a12_0x1a4b92(0xc6)]||function(_0x1d2e77){const _0x186326=a12_0x1a4b92;return _0x1d2e77&&_0x1d2e77[_0x186326(0xb5)]?_0x1d2e77:{'default':_0x1d2e77};};Object[a12_0x1a4b92(0xd7)](exports,a12_0x1a4b92(0xb5),{'value':!![]}),exports['TelegramController']=void 0x0;function a12_0x4b85(_0x370bcd,_0x209832){const _0x432cdd=a12_0x432c();return a12_0x4b85=function(_0x4b85be,_0x14e9a0){_0x4b85be=_0x4b85be-0xaf;let _0x2ec516=_0x432cdd[_0x4b85be];return _0x2ec516;},a12_0x4b85(_0x370bcd,_0x209832);}const telegramBotService_1=require(a12_0x1a4b92(0xb0)),database_1=__importDefault(require(a12_0x1a4b92(0xe3)));class TelegramController{constructor(){const _0x5cde16=a12_0x1a4b92;this['getBotStatus']=async(_0x1fda19,_0x4d8d3d,_0x24d417)=>{const _0x555a93=a12_0x4b85;try{const _0x278065=telegramBotService_1[_0x555a93(0xb4)][_0x555a93(0xf1)](),_0x206817=await database_1['default'][_0x555a93(0xe8)][_0x555a93(0xe0)](),_0x2427b6=await database_1[_0x555a93(0xb1)][_0x555a93(0xe8)][_0x555a93(0xe0)]({'where':{'isVerified':!![]}}),_0x460b21=await database_1['default'][_0x555a93(0xe8)][_0x555a93(0xc0)]({'by':[_0x555a93(0xd2)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4d8d3d[_0x555a93(0xdc)]({'success':!![],'result':{'bot':{'isActive':_0x278065[_0x555a93(0xeb)],'username':_0x278065[_0x555a93(0xcd)]},'statistics':{'totalUsers':_0x206817,'verifiedUsers':_0x2427b6,'unverifiedUsers':_0x206817-_0x2427b6,'connectedShops':_0x460b21[_0x555a93(0xb9)]}}});}catch(_0x3c2b3a){_0x24d417(_0x3c2b3a);}},this[_0x5cde16(0xe5)]=async(_0x467f18,_0xe106db,_0x1f0d7a)=>{const _0x453cea=_0x5cde16;try{const {page:page=0x1,limit:limit=0x14,verified:_0x54a17d}=_0x467f18['query'],_0x5897c0=(Number(page)-0x1)*Number(limit),_0x1b1f45={};_0x54a17d!==undefined&&(_0x1b1f45[_0x453cea(0xc3)]=_0x54a17d==='true');const [_0x4000cd,_0x37b03a]=await Promise[_0x453cea(0xc7)]([database_1[_0x453cea(0xb1)][_0x453cea(0xe8)][_0x453cea(0xc1)]({'where':_0x1b1f45,'skip':_0x5897c0,'take':Number(limit),'orderBy':{'createdAt':_0x453cea(0xd5)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x453cea(0xb1)][_0x453cea(0xe8)]['count']({'where':_0x1b1f45})]);_0xe106db[_0x453cea(0xdc)]({'success':!![],'users':_0x4000cd['map'](_0x2637a7=>({'id':_0x2637a7['id'],'telegramId':_0x2637a7['telegramId'],'username':_0x2637a7[_0x453cea(0xcd)],'firstName':_0x2637a7['firstName'],'lastName':_0x2637a7[_0x453cea(0xe1)],'isVerified':_0x2637a7[_0x453cea(0xc3)],'shop':_0x2637a7[_0x453cea(0xd8)],'createdAt':_0x2637a7[_0x453cea(0xcb)],'updatedAt':_0x2637a7[_0x453cea(0xbc)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x37b03a,'totalPages':Math[_0x453cea(0xb7)](_0x37b03a/Number(limit))}});}catch(_0x5030c6){_0x1f0d7a(_0x5030c6);}},this[_0x5cde16(0xd0)]=async(_0xba0af1,_0x28cb32,_0xd8a520)=>{const _0x25a4aa=_0x5cde16;try{const {message:_0x154781,shopId:_0xcee42c}=_0xba0af1['body'];if(!_0x154781)return _0x28cb32[_0x25a4aa(0xcc)](0x190)[_0x25a4aa(0xdc)]({'success':![],'message':'Message\x20is\x20required'});if(_0xcee42c)await telegramBotService_1[_0x25a4aa(0xb4)]['sendShopNotification'](_0xcee42c,_0x154781,{'parse_mode':'Markdown'});else{const _0x4f0e17=await database_1[_0x25a4aa(0xb1)]['telegramUser'][_0x25a4aa(0xc1)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x356459=[...new Set(_0x4f0e17['map'](_0x36ff0c=>_0x36ff0c['shopId'])[_0x25a4aa(0xd1)](Boolean))];for(const _0x3a791c of _0x356459){_0x3a791c&&await telegramBotService_1['telegramBotService'][_0x25a4aa(0xbb)](_0x3a791c,_0x154781,{'parse_mode':_0x25a4aa(0xbd)});}}_0x28cb32['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x2f7b7c){_0xd8a520(_0x2f7b7c);}},this[_0x5cde16(0xed)]=async(_0x4c461c,_0x36ca1a,_0x466404)=>{const _0x10ab24=_0x5cde16;try{const {telegramId:_0x546ffe}=_0x4c461c[_0x10ab24(0xee)],_0x3d4874=await database_1[_0x10ab24(0xb1)]['telegramUser']['findUnique']({'where':{'telegramId':_0x546ffe},'include':{'shop':!![]}});if(!_0x3d4874)return _0x36ca1a['status'](0x194)[_0x10ab24(0xdc)]({'success':![],'message':_0x10ab24(0xdd)});await database_1['default'][_0x10ab24(0xe8)][_0x10ab24(0xf5)]({'where':{'telegramId':_0x546ffe},'data':{'shopId':null,'isVerified':![]}}),_0x36ca1a['json']({'success':!![],'message':_0x10ab24(0xb2)});}catch(_0x2ebdad){_0x466404(_0x2ebdad);}},this[_0x5cde16(0xf2)]=async(_0x43e608,_0x3b1a00,_0xdb69c1)=>{const _0xf21d17=_0x5cde16;try{const {shopId:_0x3cfbb6,type:type=_0xf21d17(0xde),testData:_0x43721c}=_0x43e608['body'];if(!_0x3cfbb6)return _0x3b1a00[_0xf21d17(0xcc)](0x190)[_0xf21d17(0xdc)]({'success':![],'message':_0xf21d17(0xcf)});const _0x2548a6=await database_1['default'][_0xf21d17(0xd8)][_0xf21d17(0xb3)]({'where':{'id':_0x3cfbb6},'select':{'id':!![],'name':!![]}});if(!_0x2548a6)return _0x3b1a00['status'](0x194)['json']({'success':![],'message':_0xf21d17(0xec)});switch(type){case'payment':const _0x57dfcd={'id':'test_payment_123','amount':_0x43721c?.[_0xf21d17(0xd4)]||0x64,'currency':_0x43721c?.[_0xf21d17(0xba)]||_0xf21d17(0xef),'productName':_0x43721c?.['productName']||_0xf21d17(0xca),'gateway':_0x43721c?.[_0xf21d17(0xe4)]||_0xf21d17(0xc5),'createdAt':new Date(),..._0x43721c};await telegramBotService_1[_0xf21d17(0xb4)][_0xf21d17(0xe2)](_0x3cfbb6,_0x57dfcd,'paid');break;case _0xf21d17(0xf4):const _0x2f56ec={'id':_0xf21d17(0xb8),'amount':_0x43721c?.[_0xf21d17(0xd4)]||0x1f4,'method':_0x43721c?.[_0xf21d17(0xdb)]||_0xf21d17(0xbe),'createdAt':new Date(),..._0x43721c};await telegramBotService_1[_0xf21d17(0xb4)][_0xf21d17(0xf3)](_0x3cfbb6,_0x2f56ec,_0xf21d17(0xda));break;case _0xf21d17(0xe7):await telegramBotService_1[_0xf21d17(0xb4)]['sendCustomNotification'](_0x3cfbb6,_0x43721c?.[_0xf21d17(0xc2)]||_0xf21d17(0xf0),_0x43721c?.[_0xf21d17(0xc8)]||{'message':_0xf21d17(0xd6)});break;default:return _0x3b1a00['status'](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x3b1a00[_0xf21d17(0xdc)]({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x3217ee){_0xdb69c1(_0x3217ee);}};}}function a12_0x432c(){const _0x3cbb8f=['amount','desc','This\x20is\x20a\x20test\x20notification','defineProperty','shop','10DEhsAh','completed','method','json','Telegram\x20user\x20not\x20found','payment','28CrZNHd','count','lastName','sendPaymentNotification','../config/database','gateway','getTelegramUsers','830997uKCXdJ','custom','telegramUser','7Kurmxv','126956sqoxer','isActive','Shop\x20not\x20found','disconnectUser','params','USD','Test\x20Notification','getBotInfo','sendTestNotification','sendPayoutNotification','payout','update','1228007aytJxG','../services/telegramBotService','default','User\x20disconnected\x20successfully','findUnique','telegramBotService','__esModule','53124ZRkRau','ceil','test_payout_123','length','currency','sendShopNotification','updatedAt','Markdown','bank_transfer','TelegramController','groupBy','findMany','title','isVerified','870245cupBlI','plisio','__importDefault','all','details','497310ZtJMIr','Test\x20Product','createdAt','status','username','1499408EWTTwG','Shop\x20ID\x20is\x20required','sendBroadcast','filter','shopId','2hspQYz'];a12_0x432c=function(){return _0x3cbb8f;};return a12_0x432c();}exports[a12_0x1a4b92(0xbf)]=TelegramController;