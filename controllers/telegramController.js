'use strict';const a20_0x5975dd=a20_0x1350;(function(_0x3fc6ae,_0x366fa8){const _0x3cf218=a20_0x1350,_0x2257af=_0x3fc6ae();while(!![]){try{const _0x21e2fe=-parseInt(_0x3cf218(0xce))/0x1*(parseInt(_0x3cf218(0xda))/0x2)+-parseInt(_0x3cf218(0x96))/0x3+-parseInt(_0x3cf218(0xa9))/0x4+parseInt(_0x3cf218(0xd2))/0x5+parseInt(_0x3cf218(0xc4))/0x6*(-parseInt(_0x3cf218(0x98))/0x7)+parseInt(_0x3cf218(0xa6))/0x8*(-parseInt(_0x3cf218(0x93))/0x9)+-parseInt(_0x3cf218(0x9c))/0xa*(-parseInt(_0x3cf218(0xab))/0xb);if(_0x21e2fe===_0x366fa8)break;else _0x2257af['push'](_0x2257af['shift']());}catch(_0xac298e){_0x2257af['push'](_0x2257af['shift']());}}}(a20_0x4a08,0xa1517));var __importDefault=this&&this[a20_0x5975dd(0x9d)]||function(_0x1fa4bf){const _0x237152=a20_0x5975dd;return _0x1fa4bf&&_0x1fa4bf[_0x237152(0xca)]?_0x1fa4bf:{'default':_0x1fa4bf};};function a20_0x1350(_0x4ac8cd,_0xf64f93){_0x4ac8cd=_0x4ac8cd-0x91;const _0x4a0849=a20_0x4a08();let _0x13503f=_0x4a0849[_0x4ac8cd];return _0x13503f;}Object[a20_0x5975dd(0xbc)](exports,a20_0x5975dd(0xca),{'value':!![]}),exports[a20_0x5975dd(0xbe)]=void 0x0;function a20_0x4a08(){const _0x299675=['test_payout_123','map','updatedAt','15963QpMeEk','TRC20','amount','telegramBotService','719030gnJsVb','sendPaymentNotification','length','telegramUser','Markdown','Test\x20','count','all','60kbCycd','productName','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','params','406665bnzvlK','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Shop\x20not\x20found','3029292fMbdgS','test_payment_123','14TTYCBQ','details','payout','ceil','6372290qUXzwn','__importDefault','findUnique','Broadcast\x20message\x20sent\x20successfully','Test\x20Product','username','title','findMany','getBotStatus','Тестовый\x20период','168CkMJWt','shop','currency','109964efBSlO','desc','55jgSzCP','sendTestNotification','getTelegramUsers','custom','network','lastName','getBotInfo','Message\x20is\x20required','status','firstName','sendShopNotification','../config/database','groupBy','Telegram\x20user\x20not\x20found','json','payment','sendPayoutNotification','defineProperty','\x20notification\x20sent\x20successfully','TelegramController','body','filter','shopId','default','query','612486lvZimv','plisio','isActive','sendCustomNotification','true','isVerified','__esModule'];a20_0x4a08=function(){return _0x299675;};return a20_0x4a08();}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a20_0x5975dd(0xb6)));class TelegramController{constructor(){const _0x4edd04=a20_0x5975dd;this[_0x4edd04(0xa4)]=async(_0x507f37,_0x5220f5,_0x5c7c87)=>{const _0xc066c5=_0x4edd04;try{const _0x58a6b3=telegramBotService_1[_0xc066c5(0xd1)][_0xc066c5(0xb1)](),_0x3e5323=await database_1['default'][_0xc066c5(0xd5)][_0xc066c5(0xd8)](),_0x4b211a=await database_1['default'][_0xc066c5(0xd5)][_0xc066c5(0xd8)]({'where':{'isVerified':!![]}}),_0x945b15=await database_1[_0xc066c5(0xc2)][_0xc066c5(0xd5)][_0xc066c5(0xb7)]({'by':[_0xc066c5(0xc1)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5220f5[_0xc066c5(0xb9)]({'success':!![],'result':{'bot':{'isActive':_0x58a6b3[_0xc066c5(0xc6)],'username':_0x58a6b3[_0xc066c5(0xa1)]},'statistics':{'totalUsers':_0x3e5323,'verifiedUsers':_0x4b211a,'unverifiedUsers':_0x3e5323-_0x4b211a,'connectedShops':_0x945b15[_0xc066c5(0xd4)]}}});}catch(_0x2f2a3d){_0x5c7c87(_0x2f2a3d);}},this[_0x4edd04(0xad)]=async(_0x3b9ba3,_0x46457f,_0x4bf76f)=>{const _0xd23362=_0x4edd04;try{const {page:page=0x1,limit:limit=0x14,verified:_0x12c64f}=_0x3b9ba3[_0xd23362(0xc3)],_0x447ff7=(Number(page)-0x1)*Number(limit),_0x28d528={};_0x12c64f!==undefined&&(_0x28d528[_0xd23362(0xc9)]=_0x12c64f===_0xd23362(0xc8));const [_0x5c76cc,_0x17064f]=await Promise[_0xd23362(0xd9)]([database_1[_0xd23362(0xc2)][_0xd23362(0xd5)][_0xd23362(0xa3)]({'where':_0x28d528,'skip':_0x447ff7,'take':Number(limit),'orderBy':{'createdAt':_0xd23362(0xaa)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0xd23362(0xd5)][_0xd23362(0xd8)]({'where':_0x28d528})]);_0x46457f[_0xd23362(0xb9)]({'success':!![],'users':_0x5c76cc[_0xd23362(0xcc)](_0x530321=>({'id':_0x530321['id'],'telegramId':_0x530321['telegramId'],'username':_0x530321[_0xd23362(0xa1)],'firstName':_0x530321[_0xd23362(0xb4)],'lastName':_0x530321[_0xd23362(0xb0)],'isVerified':_0x530321[_0xd23362(0xc9)],'shop':_0x530321[_0xd23362(0xa7)],'createdAt':_0x530321['createdAt'],'updatedAt':_0x530321[_0xd23362(0xcd)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x17064f,'totalPages':Math[_0xd23362(0x9b)](_0x17064f/Number(limit))}});}catch(_0x3fa025){_0x4bf76f(_0x3fa025);}},this['sendBroadcast']=async(_0x2cc3dd,_0x5c7a47,_0x216f37)=>{const _0x52ab4e=_0x4edd04;try{const {message:_0x5fd964,shopId:_0x2bdb95}=_0x2cc3dd['body'];if(!_0x5fd964)return _0x5c7a47[_0x52ab4e(0xb3)](0x190)[_0x52ab4e(0xb9)]({'success':![],'message':_0x52ab4e(0xb2)});if(_0x2bdb95)await telegramBotService_1[_0x52ab4e(0xd1)][_0x52ab4e(0xb5)](_0x2bdb95,_0x5fd964,{'parse_mode':_0x52ab4e(0xd6)});else{const _0x5a777d=await database_1[_0x52ab4e(0xc2)][_0x52ab4e(0xd5)][_0x52ab4e(0xa3)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x858ad7=[...new Set(_0x5a777d[_0x52ab4e(0xcc)](_0x4fdb52=>_0x4fdb52[_0x52ab4e(0xc1)])[_0x52ab4e(0xc0)](Boolean))];for(const _0x22dc2c of _0x858ad7){_0x22dc2c&&await telegramBotService_1[_0x52ab4e(0xd1)][_0x52ab4e(0xb5)](_0x22dc2c,_0x5fd964,{'parse_mode':_0x52ab4e(0xd6)});}}_0x5c7a47['json']({'success':!![],'message':_0x52ab4e(0x9f)});}catch(_0x277c13){_0x216f37(_0x277c13);}},this['disconnectUser']=async(_0x127352,_0x54a2f8,_0x42e262)=>{const _0x3a627d=_0x4edd04;try{const {telegramId:_0x58cf32}=_0x127352[_0x3a627d(0x92)],_0x106a8f=await database_1[_0x3a627d(0xc2)]['telegramUser'][_0x3a627d(0x9e)]({'where':{'telegramId':_0x58cf32},'include':{'shop':!![]}});if(!_0x106a8f)return _0x54a2f8[_0x3a627d(0xb3)](0x194)[_0x3a627d(0xb9)]({'success':![],'message':_0x3a627d(0xb8)});await database_1[_0x3a627d(0xc2)][_0x3a627d(0xd5)]['update']({'where':{'telegramId':_0x58cf32},'data':{'shopId':null,'isVerified':![]}}),_0x54a2f8[_0x3a627d(0xb9)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x58acb8){_0x42e262(_0x58acb8);}},this[_0x4edd04(0xac)]=async(_0x470654,_0x706c14,_0x222787)=>{const _0xa9cbca=_0x4edd04;try{const {shopId:_0xe3c633,type:type=_0xa9cbca(0xba),testData:_0x5eb8ad}=_0x470654[_0xa9cbca(0xbf)];if(!_0xe3c633)return _0x706c14[_0xa9cbca(0xb3)](0x190)['json']({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x2a5f58=await database_1[_0xa9cbca(0xc2)]['shop'][_0xa9cbca(0x9e)]({'where':{'id':_0xe3c633},'select':{'id':!![],'name':!![]}});if(!_0x2a5f58)return _0x706c14['status'](0x194)[_0xa9cbca(0xb9)]({'success':![],'message':_0xa9cbca(0x95)});switch(type){case _0xa9cbca(0xba):const _0x4d757c={'id':_0xa9cbca(0x97),'amount':_0x5eb8ad?.[_0xa9cbca(0xd0)]||0x64,'currency':_0x5eb8ad?.[_0xa9cbca(0xa8)]||'USD','productName':_0x5eb8ad?.[_0xa9cbca(0xdb)]||_0xa9cbca(0xa0),'gateway':_0x5eb8ad?.['gateway']||_0xa9cbca(0xc5),'createdAt':new Date(),..._0x5eb8ad};await telegramBotService_1[_0xa9cbca(0xd1)][_0xa9cbca(0xd3)](_0xe3c633,_0x4d757c,'paid');break;case _0xa9cbca(0x9a):const _0x41832e={'id':_0xa9cbca(0xcb),'amount':_0x5eb8ad?.[_0xa9cbca(0xd0)]||0x1f4,'network':_0x5eb8ad?.[_0xa9cbca(0xaf)]||_0xa9cbca(0xcf),'wallet':_0x5eb8ad?.['wallet']||_0xa9cbca(0x91),'period':_0xa9cbca(0xa5),'createdAt':new Date(),'txid':_0x5eb8ad?.['txid']||null,..._0x5eb8ad};await telegramBotService_1[_0xa9cbca(0xd1)][_0xa9cbca(0xbb)](_0xe3c633,_0x41832e);break;case _0xa9cbca(0xae):await telegramBotService_1[_0xa9cbca(0xd1)][_0xa9cbca(0xc7)](_0xe3c633,_0x5eb8ad?.[_0xa9cbca(0xa2)]||'Test\x20Notification',_0x5eb8ad?.[_0xa9cbca(0x99)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x706c14[_0xa9cbca(0xb3)](0x190)[_0xa9cbca(0xb9)]({'success':![],'message':_0xa9cbca(0x94)});}_0x706c14[_0xa9cbca(0xb9)]({'success':!![],'message':_0xa9cbca(0xd7)+type+_0xa9cbca(0xbd)});}catch(_0x2fddc8){_0x222787(_0x2fddc8);}};}}exports[a20_0x5975dd(0xbe)]=TelegramController;