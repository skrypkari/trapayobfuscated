'use strict';const a20_0x20916b=a20_0x3581;function a20_0x5199(){const _0x1cc30e=['TelegramController','amount','network','desc','body','update','Test\x20Product','User\x20disconnected\x20successfully','Message\x20is\x20required','sendShopNotification','\x20notification\x20sent\x20successfully','662889VtOPzA','Broadcast\x20message\x20sent\x20successfully','isActive','default','groupBy','count','3481610UQiXcK','3132mUWXBE','397944UweVOR','wallet','getTelegramUsers','14ByOrcp','params','length','txid','filter','details','__esModule','sendCustomNotification','telegramBotService','isVerified','status','Markdown','71037nSTOAN','firstName','telegramId','815515luemhr','shop','sendPaymentNotification','username','createdAt','title','paid','plisio','Test\x20Notification','updatedAt','true','5247WJmUtH','88ofevfZ','payout','custom','Shop\x20ID\x20is\x20required','100KejGHQ','shopId','ceil','json','currency','disconnectUser','query','payment','map','TRC20','findMany','telegramUser','lastName','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','defineProperty','USD','test_payment_123','sendPayoutNotification','sendBroadcast','../services/telegramBotService','findUnique'];a20_0x5199=function(){return _0x1cc30e;};return a20_0x5199();}(function(_0x50c1a9,_0x379c1e){const _0x2f456e=a20_0x3581,_0x38930d=_0x50c1a9();while(!![]){try{const _0x10b963=-parseInt(_0x2f456e(0x17e))/0x1*(parseInt(_0x2f456e(0x139))/0x2)+parseInt(_0x2f456e(0x159))/0x3+-parseInt(_0x2f456e(0x161))/0x4+-parseInt(_0x2f456e(0x173))/0x5+-parseInt(_0x2f456e(0x160))/0x6*(-parseInt(_0x2f456e(0x164))/0x7)+-parseInt(_0x2f456e(0x17f))/0x8*(-parseInt(_0x2f456e(0x170))/0x9)+parseInt(_0x2f456e(0x15f))/0xa;if(_0x10b963===_0x379c1e)break;else _0x38930d['push'](_0x38930d['shift']());}catch(_0x47e268){_0x38930d['push'](_0x38930d['shift']());}}}(a20_0x5199,0x203d4));var __importDefault=this&&this['__importDefault']||function(_0x55761c){const _0xbbecc1=a20_0x3581;return _0x55761c&&_0x55761c[_0xbbecc1(0x16a)]?_0x55761c:{'default':_0x55761c};};Object[a20_0x20916b(0x147)](exports,a20_0x20916b(0x16a),{'value':!![]}),exports[a20_0x20916b(0x14e)]=void 0x0;function a20_0x3581(_0x274652,_0xa3b906){_0x274652=_0x274652-0x136;const _0x5199de=a20_0x5199();let _0x358167=_0x5199de[_0x274652];return _0x358167;}const telegramBotService_1=require(a20_0x20916b(0x14c)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0xcc2da1=a20_0x20916b;this['getBotStatus']=async(_0x4dff15,_0xf82411,_0x213341)=>{const _0xb8eb41=a20_0x3581;try{const _0x2c3dce=telegramBotService_1[_0xb8eb41(0x16c)]['getBotInfo'](),_0xeea0d3=await database_1[_0xb8eb41(0x15c)][_0xb8eb41(0x144)][_0xb8eb41(0x15e)](),_0x4b3072=await database_1['default'][_0xb8eb41(0x144)][_0xb8eb41(0x15e)]({'where':{'isVerified':!![]}}),_0x217721=await database_1['default'][_0xb8eb41(0x144)][_0xb8eb41(0x15d)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xf82411[_0xb8eb41(0x13c)]({'success':!![],'result':{'bot':{'isActive':_0x2c3dce[_0xb8eb41(0x15b)],'username':_0x2c3dce['username']},'statistics':{'totalUsers':_0xeea0d3,'verifiedUsers':_0x4b3072,'unverifiedUsers':_0xeea0d3-_0x4b3072,'connectedShops':_0x217721[_0xb8eb41(0x166)]}}});}catch(_0x21bb8e){_0x213341(_0x21bb8e);}},this[_0xcc2da1(0x163)]=async(_0x1479f7,_0x36a400,_0x13759f)=>{const _0x2ad634=_0xcc2da1;try{const {page:page=0x1,limit:limit=0x14,verified:_0x52e0bf}=_0x1479f7[_0x2ad634(0x13f)],_0x594c5a=(Number(page)-0x1)*Number(limit),_0x1cf60c={};_0x52e0bf!==undefined&&(_0x1cf60c[_0x2ad634(0x16d)]=_0x52e0bf===_0x2ad634(0x17d));const [_0x33e0c1,_0x4eadb5]=await Promise['all']([database_1[_0x2ad634(0x15c)][_0x2ad634(0x144)][_0x2ad634(0x143)]({'where':_0x1cf60c,'skip':_0x594c5a,'take':Number(limit),'orderBy':{'createdAt':_0x2ad634(0x151)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2ad634(0x15c)]['telegramUser'][_0x2ad634(0x15e)]({'where':_0x1cf60c})]);_0x36a400[_0x2ad634(0x13c)]({'success':!![],'users':_0x33e0c1[_0x2ad634(0x141)](_0x45544f=>({'id':_0x45544f['id'],'telegramId':_0x45544f[_0x2ad634(0x172)],'username':_0x45544f[_0x2ad634(0x176)],'firstName':_0x45544f[_0x2ad634(0x171)],'lastName':_0x45544f[_0x2ad634(0x145)],'isVerified':_0x45544f['isVerified'],'shop':_0x45544f[_0x2ad634(0x174)],'createdAt':_0x45544f[_0x2ad634(0x177)],'updatedAt':_0x45544f[_0x2ad634(0x17c)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x4eadb5,'totalPages':Math[_0x2ad634(0x13b)](_0x4eadb5/Number(limit))}});}catch(_0x2c2c93){_0x13759f(_0x2c2c93);}},this[_0xcc2da1(0x14b)]=async(_0x2f6f22,_0xe06f0b,_0x2c59d4)=>{const _0x114b3f=_0xcc2da1;try{const {message:_0x260864,shopId:_0x59b89c}=_0x2f6f22[_0x114b3f(0x152)];if(!_0x260864)return _0xe06f0b[_0x114b3f(0x16e)](0x190)['json']({'success':![],'message':_0x114b3f(0x156)});if(_0x59b89c)await telegramBotService_1['telegramBotService'][_0x114b3f(0x157)](_0x59b89c,_0x260864,{'parse_mode':_0x114b3f(0x16f)});else{const _0xabadf4=await database_1[_0x114b3f(0x15c)][_0x114b3f(0x144)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3eded6=[...new Set(_0xabadf4[_0x114b3f(0x141)](_0x3a223f=>_0x3a223f[_0x114b3f(0x13a)])[_0x114b3f(0x168)](Boolean))];for(const _0x4d423d of _0x3eded6){_0x4d423d&&await telegramBotService_1[_0x114b3f(0x16c)][_0x114b3f(0x157)](_0x4d423d,_0x260864,{'parse_mode':'Markdown'});}}_0xe06f0b[_0x114b3f(0x13c)]({'success':!![],'message':_0x114b3f(0x15a)});}catch(_0x3128a2){_0x2c59d4(_0x3128a2);}},this[_0xcc2da1(0x13e)]=async(_0x35a718,_0x1b7bdf,_0x31f683)=>{const _0x3a27c9=_0xcc2da1;try{const {telegramId:_0xe7f8f8}=_0x35a718[_0x3a27c9(0x165)],_0x1d7691=await database_1[_0x3a27c9(0x15c)][_0x3a27c9(0x144)][_0x3a27c9(0x14d)]({'where':{'telegramId':_0xe7f8f8},'include':{'shop':!![]}});if(!_0x1d7691)return _0x1b7bdf[_0x3a27c9(0x16e)](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x3a27c9(0x144)][_0x3a27c9(0x153)]({'where':{'telegramId':_0xe7f8f8},'data':{'shopId':null,'isVerified':![]}}),_0x1b7bdf[_0x3a27c9(0x13c)]({'success':!![],'message':_0x3a27c9(0x155)});}catch(_0xe5ffa9){_0x31f683(_0xe5ffa9);}},this['sendTestNotification']=async(_0x42bfd3,_0x30fdf2,_0x15ef0a)=>{const _0x24b687=_0xcc2da1;try{const {shopId:_0x563322,type:type='payment',testData:_0x55a2ef}=_0x42bfd3['body'];if(!_0x563322)return _0x30fdf2[_0x24b687(0x16e)](0x190)[_0x24b687(0x13c)]({'success':![],'message':_0x24b687(0x138)});const _0x163ddb=await database_1[_0x24b687(0x15c)][_0x24b687(0x174)][_0x24b687(0x14d)]({'where':{'id':_0x563322},'select':{'id':!![],'name':!![]}});if(!_0x163ddb)return _0x30fdf2[_0x24b687(0x16e)](0x194)[_0x24b687(0x13c)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x24b687(0x140):const _0x3398c4={'id':_0x24b687(0x149),'amount':_0x55a2ef?.['amount']||0x64,'currency':_0x55a2ef?.[_0x24b687(0x13d)]||_0x24b687(0x148),'productName':_0x55a2ef?.['productName']||_0x24b687(0x154),'gateway':_0x55a2ef?.['gateway']||_0x24b687(0x17a),'createdAt':new Date(),..._0x55a2ef};await telegramBotService_1['telegramBotService'][_0x24b687(0x175)](_0x563322,_0x3398c4,_0x24b687(0x179));break;case _0x24b687(0x136):const _0x328c29={'id':'test_payout_123','amount':_0x55a2ef?.[_0x24b687(0x14f)]||0x1f4,'network':_0x55a2ef?.[_0x24b687(0x150)]||_0x24b687(0x142),'wallet':_0x55a2ef?.[_0x24b687(0x162)]||_0x24b687(0x146),'period':'Тестовый\x20период','createdAt':new Date(),'txid':_0x55a2ef?.[_0x24b687(0x167)]||null,..._0x55a2ef};await telegramBotService_1[_0x24b687(0x16c)][_0x24b687(0x14a)](_0x563322,_0x328c29);break;case _0x24b687(0x137):await telegramBotService_1[_0x24b687(0x16c)][_0x24b687(0x16b)](_0x563322,_0x55a2ef?.[_0x24b687(0x178)]||_0x24b687(0x17b),_0x55a2ef?.[_0x24b687(0x169)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x30fdf2[_0x24b687(0x16e)](0x190)[_0x24b687(0x13c)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x30fdf2['json']({'success':!![],'message':'Test\x20'+type+_0x24b687(0x158)});}catch(_0x1197ed){_0x15ef0a(_0x1197ed);}};}}exports[a20_0x20916b(0x14e)]=TelegramController;