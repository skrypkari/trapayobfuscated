'use strict';function a12_0x88ef(){const _0x1525bb=['payment','9353871ETIXWb','Telegram\x20user\x20not\x20found','test_payment_123','__esModule','findUnique','Shop\x20not\x20found','getBotInfo','groupBy','username','telegramBotService','amount','shopId','7SxyMoT','bank_transfer','sendCustomNotification','default','6090536jFCccW','This\x20is\x20a\x20test\x20notification','defineProperty','currency','Test\x20Product','json','completed','User\x20disconnected\x20successfully','\x20notification\x20sent\x20successfully','plisio','sendPaymentNotification','query','telegramUser','4977534QzvJlf','Shop\x20ID\x20is\x20required','TelegramController','2749395CsfUJs','shop','createdAt','51975090WXbRbb','Markdown','__importDefault','details','sendBroadcast','disconnectUser','40834hquDYY','getTelegramUsers','lastName','true','7915UEZpMG','length','312NStQib','payout','isVerified','Test\x20','USD','Broadcast\x20message\x20sent\x20successfully','sendTestNotification','paid','count','productName','isActive','45oANaXR','status','update','map','firstName','../services/telegramBotService','body','sendShopNotification','getBotStatus'];a12_0x88ef=function(){return _0x1525bb;};return a12_0x88ef();}const a12_0x3fdf39=a12_0x5463;(function(_0x3b722d,_0x112dbb){const _0xc1ee38=a12_0x5463,_0x4be2fd=_0x3b722d();while(!![]){try{const _0x16e17a=-parseInt(_0xc1ee38(0xa2))/0x1*(parseInt(_0xc1ee38(0x91))/0x2)+-parseInt(_0xc1ee38(0xcc))/0x3+parseInt(_0xc1ee38(0x97))/0x4*(parseInt(_0xc1ee38(0x95))/0x5)+-parseInt(_0xc1ee38(0xc9))/0x6+parseInt(_0xc1ee38(0xb8))/0x7*(-parseInt(_0xc1ee38(0xbc))/0x8)+-parseInt(_0xc1ee38(0xac))/0x9+parseInt(_0xc1ee38(0xcf))/0xa;if(_0x16e17a===_0x112dbb)break;else _0x4be2fd['push'](_0x4be2fd['shift']());}catch(_0x17310b){_0x4be2fd['push'](_0x4be2fd['shift']());}}}(a12_0x88ef,0xd0de8));var __importDefault=this&&this[a12_0x3fdf39(0x8d)]||function(_0x1c8870){const _0x3b8e83=a12_0x3fdf39;return _0x1c8870&&_0x1c8870[_0x3b8e83(0xaf)]?_0x1c8870:{'default':_0x1c8870};};Object[a12_0x3fdf39(0xbe)](exports,a12_0x3fdf39(0xaf),{'value':!![]}),exports[a12_0x3fdf39(0xcb)]=void 0x0;function a12_0x5463(_0x49f837,_0x29c683){const _0x88efbe=a12_0x88ef();return a12_0x5463=function(_0x5463da,_0x1c75ca){_0x5463da=_0x5463da-0x8d;let _0x5052e7=_0x88efbe[_0x5463da];return _0x5052e7;},a12_0x5463(_0x49f837,_0x29c683);}const telegramBotService_1=require(a12_0x3fdf39(0xa7)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x5ae1cc=a12_0x3fdf39;this[_0x5ae1cc(0xaa)]=async(_0x2aed98,_0x5552c8,_0x403cf3)=>{const _0x308713=_0x5ae1cc;try{const _0x164187=telegramBotService_1['telegramBotService'][_0x308713(0xb2)](),_0x4bee3f=await database_1[_0x308713(0xbb)][_0x308713(0xc8)][_0x308713(0x9f)](),_0x5810e4=await database_1[_0x308713(0xbb)][_0x308713(0xc8)][_0x308713(0x9f)]({'where':{'isVerified':!![]}}),_0x286db4=await database_1[_0x308713(0xbb)][_0x308713(0xc8)][_0x308713(0xb3)]({'by':[_0x308713(0xb7)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5552c8[_0x308713(0xc1)]({'success':!![],'result':{'bot':{'isActive':_0x164187[_0x308713(0xa1)],'username':_0x164187[_0x308713(0xb4)]},'statistics':{'totalUsers':_0x4bee3f,'verifiedUsers':_0x5810e4,'unverifiedUsers':_0x4bee3f-_0x5810e4,'connectedShops':_0x286db4[_0x308713(0x96)]}}});}catch(_0x41fc06){_0x403cf3(_0x41fc06);}},this[_0x5ae1cc(0x92)]=async(_0x51cf96,_0x389a65,_0x2846ca)=>{const _0x5be68a=_0x5ae1cc;try{const {page:page=0x1,limit:limit=0x14,verified:_0x25076c}=_0x51cf96[_0x5be68a(0xc7)],_0x38db27=(Number(page)-0x1)*Number(limit),_0x4c856f={};_0x25076c!==undefined&&(_0x4c856f[_0x5be68a(0x99)]=_0x25076c===_0x5be68a(0x94));const [_0x49dad2,_0x53bf3e]=await Promise['all']([database_1[_0x5be68a(0xbb)][_0x5be68a(0xc8)]['findMany']({'where':_0x4c856f,'skip':_0x38db27,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5be68a(0xbb)][_0x5be68a(0xc8)][_0x5be68a(0x9f)]({'where':_0x4c856f})]);_0x389a65[_0x5be68a(0xc1)]({'success':!![],'users':_0x49dad2[_0x5be68a(0xa5)](_0x2719bd=>({'id':_0x2719bd['id'],'telegramId':_0x2719bd['telegramId'],'username':_0x2719bd['username'],'firstName':_0x2719bd[_0x5be68a(0xa6)],'lastName':_0x2719bd[_0x5be68a(0x93)],'isVerified':_0x2719bd['isVerified'],'shop':_0x2719bd[_0x5be68a(0xcd)],'createdAt':_0x2719bd[_0x5be68a(0xce)],'updatedAt':_0x2719bd['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x53bf3e,'totalPages':Math['ceil'](_0x53bf3e/Number(limit))}});}catch(_0x14e3cd){_0x2846ca(_0x14e3cd);}},this[_0x5ae1cc(0x8f)]=async(_0x182695,_0x3ce681,_0x2b865f)=>{const _0x1a978d=_0x5ae1cc;try{const {message:_0xa243ea,shopId:_0x2a7e1}=_0x182695[_0x1a978d(0xa8)];if(!_0xa243ea)return _0x3ce681[_0x1a978d(0xa3)](0x190)[_0x1a978d(0xc1)]({'success':![],'message':'Message\x20is\x20required'});if(_0x2a7e1)await telegramBotService_1[_0x1a978d(0xb5)][_0x1a978d(0xa9)](_0x2a7e1,_0xa243ea,{'parse_mode':_0x1a978d(0xd0)});else{const _0xf8fb0d=await database_1['default'][_0x1a978d(0xc8)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2f62d5=[...new Set(_0xf8fb0d[_0x1a978d(0xa5)](_0x59516e=>_0x59516e['shopId'])['filter'](Boolean))];for(const _0x6f7917 of _0x2f62d5){_0x6f7917&&await telegramBotService_1[_0x1a978d(0xb5)][_0x1a978d(0xa9)](_0x6f7917,_0xa243ea,{'parse_mode':_0x1a978d(0xd0)});}}_0x3ce681[_0x1a978d(0xc1)]({'success':!![],'message':_0x1a978d(0x9c)});}catch(_0x4550b2){_0x2b865f(_0x4550b2);}},this[_0x5ae1cc(0x90)]=async(_0x4b9bb2,_0x59a48f,_0x2eb9e6)=>{const _0xeabaab=_0x5ae1cc;try{const {telegramId:_0x172072}=_0x4b9bb2['params'],_0x2fa07f=await database_1[_0xeabaab(0xbb)][_0xeabaab(0xc8)][_0xeabaab(0xb0)]({'where':{'telegramId':_0x172072},'include':{'shop':!![]}});if(!_0x2fa07f)return _0x59a48f[_0xeabaab(0xa3)](0x194)[_0xeabaab(0xc1)]({'success':![],'message':_0xeabaab(0xad)});await database_1[_0xeabaab(0xbb)][_0xeabaab(0xc8)][_0xeabaab(0xa4)]({'where':{'telegramId':_0x172072},'data':{'shopId':null,'isVerified':![]}}),_0x59a48f[_0xeabaab(0xc1)]({'success':!![],'message':_0xeabaab(0xc3)});}catch(_0x3ac0e2){_0x2eb9e6(_0x3ac0e2);}},this[_0x5ae1cc(0x9d)]=async(_0x32d93a,_0x2ef0ad,_0x24ae6c)=>{const _0x5a8428=_0x5ae1cc;try{const {shopId:_0x5254e9,type:type='payment',testData:_0x52b43a}=_0x32d93a[_0x5a8428(0xa8)];if(!_0x5254e9)return _0x2ef0ad[_0x5a8428(0xa3)](0x190)['json']({'success':![],'message':_0x5a8428(0xca)});const _0x505127=await database_1[_0x5a8428(0xbb)][_0x5a8428(0xcd)][_0x5a8428(0xb0)]({'where':{'id':_0x5254e9},'select':{'id':!![],'name':!![]}});if(!_0x505127)return _0x2ef0ad['status'](0x194)[_0x5a8428(0xc1)]({'success':![],'message':_0x5a8428(0xb1)});switch(type){case _0x5a8428(0xab):const _0x1c2be4={'id':_0x5a8428(0xae),'amount':_0x52b43a?.[_0x5a8428(0xb6)]||0x64,'currency':_0x52b43a?.[_0x5a8428(0xbf)]||_0x5a8428(0x9b),'productName':_0x52b43a?.[_0x5a8428(0xa0)]||_0x5a8428(0xc0),'gateway':_0x52b43a?.['gateway']||_0x5a8428(0xc5),'createdAt':new Date(),..._0x52b43a};await telegramBotService_1[_0x5a8428(0xb5)][_0x5a8428(0xc6)](_0x5254e9,_0x1c2be4,_0x5a8428(0x9e));break;case _0x5a8428(0x98):const _0x1333eb={'id':'test_payout_123','amount':_0x52b43a?.[_0x5a8428(0xb6)]||0x1f4,'method':_0x52b43a?.['method']||_0x5a8428(0xb9),'createdAt':new Date(),..._0x52b43a};await telegramBotService_1[_0x5a8428(0xb5)]['sendPayoutNotification'](_0x5254e9,_0x1333eb,_0x5a8428(0xc2));break;case'custom':await telegramBotService_1[_0x5a8428(0xb5)][_0x5a8428(0xba)](_0x5254e9,_0x52b43a?.['title']||'Test\x20Notification',_0x52b43a?.[_0x5a8428(0x8e)]||{'message':_0x5a8428(0xbd)});break;default:return _0x2ef0ad[_0x5a8428(0xa3)](0x190)[_0x5a8428(0xc1)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x2ef0ad['json']({'success':!![],'message':_0x5a8428(0x9a)+type+_0x5a8428(0xc4)});}catch(_0x281935){_0x24ae6c(_0x281935);}};}}exports[a12_0x3fdf39(0xcb)]=TelegramController;