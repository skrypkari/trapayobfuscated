'use strict';function a12_0x4f6c(){const _0x2691aa=['details','amount','205218pODsdH','method','groupBy','Markdown','736060GNbcoY','__importDefault','isVerified','556158OublMi','This\x20is\x20a\x20test\x20notification','TelegramController','filter','15348108qcKbXD','sendShopNotification','7lBpYSu','1723498GzmIPt','params','plisio','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','11IdBARn','defineProperty','16aJUTne','lastName','firstName','Shop\x20not\x20found','shopId','createdAt','isActive','update','USD','4333712pDpYIt','updatedAt','telegramUser','__esModule','title','desc','1158042TIfJbG','currency','sendPayoutNotification','User\x20disconnected\x20successfully','\x20notification\x20sent\x20successfully','Test\x20Notification','custom','count','sendCustomNotification','Telegram\x20user\x20not\x20found','status','Test\x20Product','15GMERaw','map','sendPaymentNotification','../services/telegramBotService','Test\x20','json','gateway','productName','true','Message\x20is\x20required','telegramBotService','9TsvuJR','default','getBotStatus','findMany','bank_transfer','../config/database','paid','body','payment'];a12_0x4f6c=function(){return _0x2691aa;};return a12_0x4f6c();}const a12_0x4ec1d3=a12_0x4388;(function(_0x146e1f,_0x42e00f){const _0x562604=a12_0x4388,_0x25b192=_0x146e1f();while(!![]){try{const _0x21ec81=-parseInt(_0x562604(0x17b))/0x1*(-parseInt(_0x562604(0x16e))/0x2)+-parseInt(_0x562604(0x175))/0x3*(-parseInt(_0x562604(0x182))/0x4)+parseInt(_0x562604(0x158))/0x5*(parseInt(_0x562604(0x191))/0x6)+parseInt(_0x562604(0x17c))/0x7+parseInt(_0x562604(0x18b))/0x8*(-parseInt(_0x562604(0x163))/0x9)+-parseInt(_0x562604(0x172))/0xa+parseInt(_0x562604(0x180))/0xb*(-parseInt(_0x562604(0x179))/0xc);if(_0x21ec81===_0x42e00f)break;else _0x25b192['push'](_0x25b192['shift']());}catch(_0x453bc0){_0x25b192['push'](_0x25b192['shift']());}}}(a12_0x4f6c,0x5f639));var __importDefault=this&&this[a12_0x4ec1d3(0x173)]||function(_0x38497){const _0x16dc83=a12_0x4ec1d3;return _0x38497&&_0x38497[_0x16dc83(0x18e)]?_0x38497:{'default':_0x38497};};Object[a12_0x4ec1d3(0x181)](exports,a12_0x4ec1d3(0x18e),{'value':!![]}),exports[a12_0x4ec1d3(0x177)]=void 0x0;const telegramBotService_1=require(a12_0x4ec1d3(0x15b)),database_1=__importDefault(require(a12_0x4ec1d3(0x168)));function a12_0x4388(_0x55e5f6,_0x48fb45){const _0x4f6cda=a12_0x4f6c();return a12_0x4388=function(_0x438883,_0x16bbdd){_0x438883=_0x438883-0x154;let _0x3a9654=_0x4f6cda[_0x438883];return _0x3a9654;},a12_0x4388(_0x55e5f6,_0x48fb45);}class TelegramController{constructor(){const _0x33c4a9=a12_0x4ec1d3;this[_0x33c4a9(0x165)]=async(_0x4b58d0,_0x2ea09c,_0x132639)=>{const _0x3f2e6d=_0x33c4a9;try{const _0x1796e9=telegramBotService_1['telegramBotService']['getBotInfo'](),_0xe673e4=await database_1['default'][_0x3f2e6d(0x18d)][_0x3f2e6d(0x198)](),_0x5b8f66=await database_1[_0x3f2e6d(0x164)][_0x3f2e6d(0x18d)][_0x3f2e6d(0x198)]({'where':{'isVerified':!![]}}),_0x3c6ece=await database_1[_0x3f2e6d(0x164)][_0x3f2e6d(0x18d)][_0x3f2e6d(0x170)]({'by':[_0x3f2e6d(0x186)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2ea09c[_0x3f2e6d(0x15d)]({'success':!![],'result':{'bot':{'isActive':_0x1796e9[_0x3f2e6d(0x188)],'username':_0x1796e9['username']},'statistics':{'totalUsers':_0xe673e4,'verifiedUsers':_0x5b8f66,'unverifiedUsers':_0xe673e4-_0x5b8f66,'connectedShops':_0x3c6ece['length']}}});}catch(_0xd84c00){_0x132639(_0xd84c00);}},this['getTelegramUsers']=async(_0x311f75,_0x4c62ff,_0x264aa7)=>{const _0x5b73ce=_0x33c4a9;try{const {page:page=0x1,limit:limit=0x14,verified:_0x462739}=_0x311f75['query'],_0xb32a0d=(Number(page)-0x1)*Number(limit),_0x7d9159={};_0x462739!==undefined&&(_0x7d9159[_0x5b73ce(0x174)]=_0x462739===_0x5b73ce(0x160));const [_0x1dd2d0,_0x2db652]=await Promise['all']([database_1[_0x5b73ce(0x164)]['telegramUser'][_0x5b73ce(0x166)]({'where':_0x7d9159,'skip':_0xb32a0d,'take':Number(limit),'orderBy':{'createdAt':_0x5b73ce(0x190)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5b73ce(0x164)]['telegramUser'][_0x5b73ce(0x198)]({'where':_0x7d9159})]);_0x4c62ff[_0x5b73ce(0x15d)]({'success':!![],'users':_0x1dd2d0[_0x5b73ce(0x159)](_0x19bf4c=>({'id':_0x19bf4c['id'],'telegramId':_0x19bf4c['telegramId'],'username':_0x19bf4c['username'],'firstName':_0x19bf4c[_0x5b73ce(0x184)],'lastName':_0x19bf4c[_0x5b73ce(0x183)],'isVerified':_0x19bf4c[_0x5b73ce(0x174)],'shop':_0x19bf4c['shop'],'createdAt':_0x19bf4c[_0x5b73ce(0x187)],'updatedAt':_0x19bf4c[_0x5b73ce(0x18c)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2db652,'totalPages':Math['ceil'](_0x2db652/Number(limit))}});}catch(_0x363a3a){_0x264aa7(_0x363a3a);}},this['sendBroadcast']=async(_0x484b49,_0x4083ab,_0x5acf89)=>{const _0x349c01=_0x33c4a9;try{const {message:_0x474a82,shopId:_0x30bd01}=_0x484b49['body'];if(!_0x474a82)return _0x4083ab[_0x349c01(0x156)](0x190)[_0x349c01(0x15d)]({'success':![],'message':_0x349c01(0x161)});if(_0x30bd01)await telegramBotService_1[_0x349c01(0x162)]['sendShopNotification'](_0x30bd01,_0x474a82,{'parse_mode':_0x349c01(0x171)});else{const _0x5481cc=await database_1['default'][_0x349c01(0x18d)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1268eb=[...new Set(_0x5481cc[_0x349c01(0x159)](_0x278598=>_0x278598[_0x349c01(0x186)])[_0x349c01(0x178)](Boolean))];for(const _0x11367b of _0x1268eb){_0x11367b&&await telegramBotService_1['telegramBotService'][_0x349c01(0x17a)](_0x11367b,_0x474a82,{'parse_mode':_0x349c01(0x171)});}}_0x4083ab[_0x349c01(0x15d)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x1a9508){_0x5acf89(_0x1a9508);}},this['disconnectUser']=async(_0x2eb552,_0x39b458,_0x3073e9)=>{const _0x23106e=_0x33c4a9;try{const {telegramId:_0x4c3173}=_0x2eb552[_0x23106e(0x17d)],_0xe6ccc2=await database_1['default'][_0x23106e(0x18d)]['findUnique']({'where':{'telegramId':_0x4c3173},'include':{'shop':!![]}});if(!_0xe6ccc2)return _0x39b458['status'](0x194)['json']({'success':![],'message':_0x23106e(0x155)});await database_1[_0x23106e(0x164)][_0x23106e(0x18d)][_0x23106e(0x189)]({'where':{'telegramId':_0x4c3173},'data':{'shopId':null,'isVerified':![]}}),_0x39b458[_0x23106e(0x15d)]({'success':!![],'message':_0x23106e(0x194)});}catch(_0x4d0e52){_0x3073e9(_0x4d0e52);}},this['sendTestNotification']=async(_0xa5657e,_0x237afb,_0x176fbb)=>{const _0x3af147=_0x33c4a9;try{const {shopId:_0x57e73d,type:type='payment',testData:_0x160246}=_0xa5657e[_0x3af147(0x16a)];if(!_0x57e73d)return _0x237afb[_0x3af147(0x156)](0x190)[_0x3af147(0x15d)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x457d8c=await database_1[_0x3af147(0x164)]['shop']['findUnique']({'where':{'id':_0x57e73d},'select':{'id':!![],'name':!![]}});if(!_0x457d8c)return _0x237afb['status'](0x194)[_0x3af147(0x15d)]({'success':![],'message':_0x3af147(0x185)});switch(type){case _0x3af147(0x16b):const _0x491b68={'id':'test_payment_123','amount':_0x160246?.[_0x3af147(0x16d)]||0x64,'currency':_0x160246?.[_0x3af147(0x192)]||_0x3af147(0x18a),'productName':_0x160246?.[_0x3af147(0x15f)]||_0x3af147(0x157),'gateway':_0x160246?.[_0x3af147(0x15e)]||_0x3af147(0x17e),'createdAt':new Date(),..._0x160246};await telegramBotService_1[_0x3af147(0x162)][_0x3af147(0x15a)](_0x57e73d,_0x491b68,_0x3af147(0x169));break;case'payout':const _0x255319={'id':'test_payout_123','amount':_0x160246?.[_0x3af147(0x16d)]||0x1f4,'method':_0x160246?.[_0x3af147(0x16f)]||_0x3af147(0x167),'createdAt':new Date(),..._0x160246};await telegramBotService_1[_0x3af147(0x162)][_0x3af147(0x193)](_0x57e73d,_0x255319,'completed');break;case _0x3af147(0x197):await telegramBotService_1[_0x3af147(0x162)][_0x3af147(0x154)](_0x57e73d,_0x160246?.[_0x3af147(0x18f)]||_0x3af147(0x196),_0x160246?.[_0x3af147(0x16c)]||{'message':_0x3af147(0x176)});break;default:return _0x237afb['status'](0x190)[_0x3af147(0x15d)]({'success':![],'message':_0x3af147(0x17f)});}_0x237afb['json']({'success':!![],'message':_0x3af147(0x15c)+type+_0x3af147(0x195)});}catch(_0x5ab35){_0x176fbb(_0x5ab35);}};}}exports[a12_0x4ec1d3(0x177)]=TelegramController;