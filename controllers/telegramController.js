'use strict';const a12_0xa30a85=a12_0x3077;function a12_0x3077(_0x4f4b0a,_0x1f719a){const _0xc67836=a12_0xc678();return a12_0x3077=function(_0x3077a2,_0x558dba){_0x3077a2=_0x3077a2-0x106;let _0x14d6c6=_0xc67836[_0x3077a2];return _0x14d6c6;},a12_0x3077(_0x4f4b0a,_0x1f719a);}(function(_0x46ca2e,_0x1b462d){const _0x4e3232=a12_0x3077,_0x26597e=_0x46ca2e();while(!![]){try{const _0x1b040a=parseInt(_0x4e3232(0x138))/0x1*(-parseInt(_0x4e3232(0x108))/0x2)+-parseInt(_0x4e3232(0x115))/0x3+parseInt(_0x4e3232(0x147))/0x4+-parseInt(_0x4e3232(0x10e))/0x5*(-parseInt(_0x4e3232(0x136))/0x6)+parseInt(_0x4e3232(0x130))/0x7+-parseInt(_0x4e3232(0x14c))/0x8*(-parseInt(_0x4e3232(0x11b))/0x9)+-parseInt(_0x4e3232(0x10b))/0xa*(parseInt(_0x4e3232(0x121))/0xb);if(_0x1b040a===_0x1b462d)break;else _0x26597e['push'](_0x26597e['shift']());}catch(_0x157c6c){_0x26597e['push'](_0x26597e['shift']());}}}(a12_0xc678,0x49f49));function a12_0xc678(){const _0x142170=['test_payment_123','custom','all','defineProperty','paid','true','body','telegramBotService','sendCustomNotification','../services/telegramBotService','productName','bank_transfer','3795022YbJYTI','findUnique','telegramId','updatedAt','currency','plisio','6VXgbEN','Telegram\x20user\x20not\x20found','265cCXjjs','lastName','gateway','desc','disconnectUser','getTelegramUsers','Test\x20Notification','amount','map','sendShopNotification','count','query','params','USD','status','284792ZFCdXo','length','firstName','findMany','json','151848ykFxfg','isActive','__esModule','groupBy','shop','\x20notification\x20sent\x20successfully','sendPaymentNotification','TelegramController','778UXUOZD','createdAt','default','10264010RDnMQc','telegramUser','This\x20is\x20a\x20test\x20notification','2365270RVaZqr','payout','username','ceil','Message\x20is\x20required','payment','Shop\x20ID\x20is\x20required','271662gjdIjy','sendPayoutNotification','__importDefault','sendBroadcast','Markdown','title','207ZZjxTD','isVerified','Shop\x20not\x20found','User\x20disconnected\x20successfully','filter','method','11oyoDCH','getBotInfo','shopId'];a12_0xc678=function(){return _0x142170;};return a12_0xc678();}var __importDefault=this&&this[a12_0xa30a85(0x117)]||function(_0x32592a){const _0x45b09f=a12_0xa30a85;return _0x32592a&&_0x32592a[_0x45b09f(0x14e)]?_0x32592a:{'default':_0x32592a};};Object[a12_0xa30a85(0x127)](exports,a12_0xa30a85(0x14e),{'value':!![]}),exports[a12_0xa30a85(0x107)]=void 0x0;const telegramBotService_1=require(a12_0xa30a85(0x12d)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0xf4e20b=a12_0xa30a85;this['getBotStatus']=async(_0x4285f8,_0x192976,_0x34d61d)=>{const _0x8f5398=a12_0x3077;try{const _0x4166be=telegramBotService_1[_0x8f5398(0x12b)][_0x8f5398(0x122)](),_0x88d4b7=await database_1[_0x8f5398(0x10a)][_0x8f5398(0x10c)][_0x8f5398(0x142)](),_0x20a860=await database_1['default'][_0x8f5398(0x10c)][_0x8f5398(0x142)]({'where':{'isVerified':!![]}}),_0x15c7a2=await database_1[_0x8f5398(0x10a)][_0x8f5398(0x10c)][_0x8f5398(0x14f)]({'by':[_0x8f5398(0x123)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x192976[_0x8f5398(0x14b)]({'success':!![],'result':{'bot':{'isActive':_0x4166be[_0x8f5398(0x14d)],'username':_0x4166be[_0x8f5398(0x110)]},'statistics':{'totalUsers':_0x88d4b7,'verifiedUsers':_0x20a860,'unverifiedUsers':_0x88d4b7-_0x20a860,'connectedShops':_0x15c7a2[_0x8f5398(0x148)]}}});}catch(_0x46fdfd){_0x34d61d(_0x46fdfd);}},this[_0xf4e20b(0x13d)]=async(_0x9a8eca,_0x492a3d,_0x59c8d1)=>{const _0x23239d=_0xf4e20b;try{const {page:page=0x1,limit:limit=0x14,verified:_0x33d6d9}=_0x9a8eca[_0x23239d(0x143)],_0x17935c=(Number(page)-0x1)*Number(limit),_0x629581={};_0x33d6d9!==undefined&&(_0x629581['isVerified']=_0x33d6d9===_0x23239d(0x129));const [_0x18c2e5,_0x2cd44d]=await Promise[_0x23239d(0x126)]([database_1[_0x23239d(0x10a)][_0x23239d(0x10c)][_0x23239d(0x14a)]({'where':_0x629581,'skip':_0x17935c,'take':Number(limit),'orderBy':{'createdAt':_0x23239d(0x13b)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x23239d(0x10c)][_0x23239d(0x142)]({'where':_0x629581})]);_0x492a3d['json']({'success':!![],'users':_0x18c2e5[_0x23239d(0x140)](_0x1091ca=>({'id':_0x1091ca['id'],'telegramId':_0x1091ca[_0x23239d(0x132)],'username':_0x1091ca[_0x23239d(0x110)],'firstName':_0x1091ca[_0x23239d(0x149)],'lastName':_0x1091ca[_0x23239d(0x139)],'isVerified':_0x1091ca[_0x23239d(0x11c)],'shop':_0x1091ca[_0x23239d(0x150)],'createdAt':_0x1091ca[_0x23239d(0x109)],'updatedAt':_0x1091ca[_0x23239d(0x133)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2cd44d,'totalPages':Math[_0x23239d(0x111)](_0x2cd44d/Number(limit))}});}catch(_0x268926){_0x59c8d1(_0x268926);}},this[_0xf4e20b(0x118)]=async(_0x1986a3,_0x2b19e4,_0x10a7b2)=>{const _0x54eca2=_0xf4e20b;try{const {message:_0x44e1b4,shopId:_0x42025d}=_0x1986a3[_0x54eca2(0x12a)];if(!_0x44e1b4)return _0x2b19e4[_0x54eca2(0x146)](0x190)[_0x54eca2(0x14b)]({'success':![],'message':_0x54eca2(0x112)});if(_0x42025d)await telegramBotService_1['telegramBotService'][_0x54eca2(0x141)](_0x42025d,_0x44e1b4,{'parse_mode':'Markdown'});else{const _0x1ea700=await database_1[_0x54eca2(0x10a)]['telegramUser'][_0x54eca2(0x14a)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5e2353=[...new Set(_0x1ea700[_0x54eca2(0x140)](_0x1690f5=>_0x1690f5[_0x54eca2(0x123)])[_0x54eca2(0x11f)](Boolean))];for(const _0x2b9d56 of _0x5e2353){_0x2b9d56&&await telegramBotService_1[_0x54eca2(0x12b)][_0x54eca2(0x141)](_0x2b9d56,_0x44e1b4,{'parse_mode':_0x54eca2(0x119)});}}_0x2b19e4[_0x54eca2(0x14b)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x52adf2){_0x10a7b2(_0x52adf2);}},this[_0xf4e20b(0x13c)]=async(_0x4d6b97,_0x555b51,_0x2d50de)=>{const _0x425884=_0xf4e20b;try{const {telegramId:_0x2059ed}=_0x4d6b97[_0x425884(0x144)],_0x4a2d55=await database_1['default'][_0x425884(0x10c)][_0x425884(0x131)]({'where':{'telegramId':_0x2059ed},'include':{'shop':!![]}});if(!_0x4a2d55)return _0x555b51[_0x425884(0x146)](0x194)['json']({'success':![],'message':_0x425884(0x137)});await database_1[_0x425884(0x10a)][_0x425884(0x10c)]['update']({'where':{'telegramId':_0x2059ed},'data':{'shopId':null,'isVerified':![]}}),_0x555b51[_0x425884(0x14b)]({'success':!![],'message':_0x425884(0x11e)});}catch(_0x1b534f){_0x2d50de(_0x1b534f);}},this['sendTestNotification']=async(_0x598e65,_0x4628fd,_0x41698c)=>{const _0x1bc02f=_0xf4e20b;try{const {shopId:_0x2607f2,type:type=_0x1bc02f(0x113),testData:_0x42a441}=_0x598e65[_0x1bc02f(0x12a)];if(!_0x2607f2)return _0x4628fd['status'](0x190)['json']({'success':![],'message':_0x1bc02f(0x114)});const _0x8d3d56=await database_1[_0x1bc02f(0x10a)][_0x1bc02f(0x150)][_0x1bc02f(0x131)]({'where':{'id':_0x2607f2},'select':{'id':!![],'name':!![]}});if(!_0x8d3d56)return _0x4628fd[_0x1bc02f(0x146)](0x194)['json']({'success':![],'message':_0x1bc02f(0x11d)});switch(type){case'payment':const _0x262c2e={'id':_0x1bc02f(0x124),'amount':_0x42a441?.[_0x1bc02f(0x13f)]||0x64,'currency':_0x42a441?.[_0x1bc02f(0x134)]||_0x1bc02f(0x145),'productName':_0x42a441?.[_0x1bc02f(0x12e)]||'Test\x20Product','gateway':_0x42a441?.[_0x1bc02f(0x13a)]||_0x1bc02f(0x135),'createdAt':new Date(),..._0x42a441};await telegramBotService_1[_0x1bc02f(0x12b)][_0x1bc02f(0x106)](_0x2607f2,_0x262c2e,_0x1bc02f(0x128));break;case _0x1bc02f(0x10f):const _0x3ac7fb={'id':'test_payout_123','amount':_0x42a441?.[_0x1bc02f(0x13f)]||0x1f4,'method':_0x42a441?.[_0x1bc02f(0x120)]||_0x1bc02f(0x12f),'createdAt':new Date(),..._0x42a441};await telegramBotService_1[_0x1bc02f(0x12b)][_0x1bc02f(0x116)](_0x2607f2,_0x3ac7fb,'completed');break;case _0x1bc02f(0x125):await telegramBotService_1[_0x1bc02f(0x12b)][_0x1bc02f(0x12c)](_0x2607f2,_0x42a441?.[_0x1bc02f(0x11a)]||_0x1bc02f(0x13e),_0x42a441?.['details']||{'message':_0x1bc02f(0x10d)});break;default:return _0x4628fd[_0x1bc02f(0x146)](0x190)[_0x1bc02f(0x14b)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x4628fd[_0x1bc02f(0x14b)]({'success':!![],'message':'Test\x20'+type+_0x1bc02f(0x151)});}catch(_0x1b1460){_0x41698c(_0x1b1460);}};}}exports[a12_0xa30a85(0x107)]=TelegramController;