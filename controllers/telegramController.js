'use strict';const a13_0x712f99=a13_0x5172;(function(_0x1f1d11,_0x206984){const _0x35470f=a13_0x5172,_0x4b35a0=_0x1f1d11();while(!![]){try{const _0x44ddfd=-parseInt(_0x35470f(0x1bc))/0x1+-parseInt(_0x35470f(0x1b3))/0x2+parseInt(_0x35470f(0x1cf))/0x3+-parseInt(_0x35470f(0x1c2))/0x4+parseInt(_0x35470f(0x1cc))/0x5*(parseInt(_0x35470f(0x1f0))/0x6)+parseInt(_0x35470f(0x1bf))/0x7+parseInt(_0x35470f(0x1d6))/0x8;if(_0x44ddfd===_0x206984)break;else _0x4b35a0['push'](_0x4b35a0['shift']());}catch(_0x43845d){_0x4b35a0['push'](_0x4b35a0['shift']());}}}(a13_0x1ca3,0x29f1d));function a13_0x5172(_0x29d608,_0x16d089){const _0x1ca305=a13_0x1ca3();return a13_0x5172=function(_0x517231,_0x179aba){_0x517231=_0x517231-0x1b0;let _0x553081=_0x1ca305[_0x517231];return _0x553081;},a13_0x5172(_0x29d608,_0x16d089);}function a13_0x1ca3(){const _0x3029d6=['status','length','paid','102715ZjaFxj','Shop\x20ID\x20is\x20required','sendShopNotification','829872LSVDQA','sendPayoutNotification','Telegram\x20user\x20not\x20found','__importDefault','payment','telegramBotService','defineProperty','2948384cAQgEf','Shop\x20not\x20found','getBotInfo','json','count','Test\x20Notification','sendPaymentNotification','body','__esModule','telegramId','updatedAt','test_payment_123','lastName','update','getTelegramUsers','telegramUser','shopId','Broadcast\x20message\x20sent\x20successfully','../config/database','User\x20disconnected\x20successfully','details','disconnectUser','TelegramController','ceil','findMany','../services/telegramBotService','78fdLQie','Message\x20is\x20required','bank_transfer','createdAt','sendCustomNotification','method','findUnique','This\x20is\x20a\x20test\x20notification','527964mwpMwy','amount','desc','title','plisio','firstName','isActive','isVerified','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','157872bvnGDi','sendTestNotification','Markdown','127757OdOgMt','custom','groupBy','1347292kNwUDG','username','sendBroadcast','test_payout_123','shop','default','map'];a13_0x1ca3=function(){return _0x3029d6;};return a13_0x1ca3();}var __importDefault=this&&this[a13_0x712f99(0x1d2)]||function(_0x4a8f90){return _0x4a8f90&&_0x4a8f90['__esModule']?_0x4a8f90:{'default':_0x4a8f90};};Object[a13_0x712f99(0x1d5)](exports,a13_0x712f99(0x1de),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a13_0x712f99(0x1ef)),database_1=__importDefault(require(a13_0x712f99(0x1e8)));class TelegramController{constructor(){const _0x419eac=a13_0x712f99;this['getBotStatus']=async(_0x41fcd0,_0xa7616e,_0x57bebe)=>{const _0x4a878e=a13_0x5172;try{const _0x48f87a=telegramBotService_1[_0x4a878e(0x1d4)][_0x4a878e(0x1d8)](),_0x59d03e=await database_1['default'][_0x4a878e(0x1e5)]['count'](),_0xb33e0f=await database_1[_0x4a878e(0x1c7)][_0x4a878e(0x1e5)][_0x4a878e(0x1da)]({'where':{'isVerified':!![]}}),_0x5c28d9=await database_1[_0x4a878e(0x1c7)]['telegramUser'][_0x4a878e(0x1c1)]({'by':[_0x4a878e(0x1e6)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xa7616e['json']({'success':!![],'result':{'bot':{'isActive':_0x48f87a[_0x4a878e(0x1b9)],'username':_0x48f87a[_0x4a878e(0x1c3)]},'statistics':{'totalUsers':_0x59d03e,'verifiedUsers':_0xb33e0f,'unverifiedUsers':_0x59d03e-_0xb33e0f,'connectedShops':_0x5c28d9[_0x4a878e(0x1ca)]}}});}catch(_0x57dec0){_0x57bebe(_0x57dec0);}},this[_0x419eac(0x1e4)]=async(_0xc87383,_0x17c3a7,_0x42c790)=>{const _0x2afd90=_0x419eac;try{const {page:page=0x1,limit:limit=0x14,verified:_0x113916}=_0xc87383['query'],_0x50da6f=(Number(page)-0x1)*Number(limit),_0x30f562={};_0x113916!==undefined&&(_0x30f562[_0x2afd90(0x1ba)]=_0x113916==='true');const [_0x2537bf,_0x6c4032]=await Promise['all']([database_1['default']['telegramUser']['findMany']({'where':_0x30f562,'skip':_0x50da6f,'take':Number(limit),'orderBy':{'createdAt':_0x2afd90(0x1b5)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2afd90(0x1c7)][_0x2afd90(0x1e5)][_0x2afd90(0x1da)]({'where':_0x30f562})]);_0x17c3a7['json']({'success':!![],'users':_0x2537bf[_0x2afd90(0x1c8)](_0x48ec59=>({'id':_0x48ec59['id'],'telegramId':_0x48ec59[_0x2afd90(0x1df)],'username':_0x48ec59[_0x2afd90(0x1c3)],'firstName':_0x48ec59[_0x2afd90(0x1b8)],'lastName':_0x48ec59[_0x2afd90(0x1e2)],'isVerified':_0x48ec59[_0x2afd90(0x1ba)],'shop':_0x48ec59[_0x2afd90(0x1c6)],'createdAt':_0x48ec59[_0x2afd90(0x1f3)],'updatedAt':_0x48ec59[_0x2afd90(0x1e0)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x6c4032,'totalPages':Math[_0x2afd90(0x1ed)](_0x6c4032/Number(limit))}});}catch(_0x48df0b){_0x42c790(_0x48df0b);}},this[_0x419eac(0x1c4)]=async(_0xb41d18,_0x30c95f,_0x19d948)=>{const _0x50d468=_0x419eac;try{const {message:_0x55de24,shopId:_0x34467a}=_0xb41d18[_0x50d468(0x1dd)];if(!_0x55de24)return _0x30c95f[_0x50d468(0x1c9)](0x190)[_0x50d468(0x1d9)]({'success':![],'message':_0x50d468(0x1f1)});if(_0x34467a)await telegramBotService_1[_0x50d468(0x1d4)][_0x50d468(0x1ce)](_0x34467a,_0x55de24,{'parse_mode':_0x50d468(0x1be)});else{const _0x5e6cb9=await database_1[_0x50d468(0x1c7)][_0x50d468(0x1e5)][_0x50d468(0x1ee)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4064a3=[...new Set(_0x5e6cb9[_0x50d468(0x1c8)](_0x2dc1bc=>_0x2dc1bc[_0x50d468(0x1e6)])['filter'](Boolean))];for(const _0x431b63 of _0x4064a3){_0x431b63&&await telegramBotService_1[_0x50d468(0x1d4)][_0x50d468(0x1ce)](_0x431b63,_0x55de24,{'parse_mode':_0x50d468(0x1be)});}}_0x30c95f['json']({'success':!![],'message':_0x50d468(0x1e7)});}catch(_0x4717c9){_0x19d948(_0x4717c9);}},this[_0x419eac(0x1eb)]=async(_0x509702,_0xa05ea5,_0x13d37b)=>{const _0x3ac5b4=_0x419eac;try{const {telegramId:_0x2e2d6a}=_0x509702['params'],_0x1c051b=await database_1[_0x3ac5b4(0x1c7)]['telegramUser'][_0x3ac5b4(0x1b1)]({'where':{'telegramId':_0x2e2d6a},'include':{'shop':!![]}});if(!_0x1c051b)return _0xa05ea5['status'](0x194)[_0x3ac5b4(0x1d9)]({'success':![],'message':_0x3ac5b4(0x1d1)});await database_1['default'][_0x3ac5b4(0x1e5)][_0x3ac5b4(0x1e3)]({'where':{'telegramId':_0x2e2d6a},'data':{'shopId':null,'isVerified':![]}}),_0xa05ea5['json']({'success':!![],'message':_0x3ac5b4(0x1e9)});}catch(_0x50f125){_0x13d37b(_0x50f125);}},this[_0x419eac(0x1bd)]=async(_0x50e0c7,_0x197ab5,_0x129607)=>{const _0x29fd70=_0x419eac;try{const {shopId:_0x412886,type:type=_0x29fd70(0x1d3),testData:_0x5c67ea}=_0x50e0c7[_0x29fd70(0x1dd)];if(!_0x412886)return _0x197ab5['status'](0x190)[_0x29fd70(0x1d9)]({'success':![],'message':_0x29fd70(0x1cd)});const _0x3b0bff=await database_1[_0x29fd70(0x1c7)][_0x29fd70(0x1c6)][_0x29fd70(0x1b1)]({'where':{'id':_0x412886},'select':{'id':!![],'name':!![]}});if(!_0x3b0bff)return _0x197ab5['status'](0x194)[_0x29fd70(0x1d9)]({'success':![],'message':_0x29fd70(0x1d7)});switch(type){case _0x29fd70(0x1d3):const _0x478411={'id':_0x29fd70(0x1e1),'amount':_0x5c67ea?.['amount']||0x64,'currency':_0x5c67ea?.['currency']||'USD','productName':_0x5c67ea?.['productName']||'Test\x20Product','gateway':_0x5c67ea?.['gateway']||_0x29fd70(0x1b7),'createdAt':new Date(),..._0x5c67ea};await telegramBotService_1[_0x29fd70(0x1d4)][_0x29fd70(0x1dc)](_0x412886,_0x478411,_0x29fd70(0x1cb));break;case'payout':const _0x1df4e5={'id':_0x29fd70(0x1c5),'amount':_0x5c67ea?.[_0x29fd70(0x1b4)]||0x1f4,'method':_0x5c67ea?.[_0x29fd70(0x1b0)]||_0x29fd70(0x1f2),'createdAt':new Date(),..._0x5c67ea};await telegramBotService_1[_0x29fd70(0x1d4)][_0x29fd70(0x1d0)](_0x412886,_0x1df4e5,'completed');break;case _0x29fd70(0x1c0):await telegramBotService_1[_0x29fd70(0x1d4)][_0x29fd70(0x1f4)](_0x412886,_0x5c67ea?.[_0x29fd70(0x1b6)]||_0x29fd70(0x1db),_0x5c67ea?.[_0x29fd70(0x1ea)]||{'message':_0x29fd70(0x1b2)});break;default:return _0x197ab5[_0x29fd70(0x1c9)](0x190)[_0x29fd70(0x1d9)]({'success':![],'message':_0x29fd70(0x1bb)});}_0x197ab5[_0x29fd70(0x1d9)]({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x58b9e8){_0x129607(_0x58b9e8);}};}}exports[a13_0x712f99(0x1ec)]=TelegramController;