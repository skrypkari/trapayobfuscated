'use strict';const a18_0x1e9f2f=a18_0x3fb2;function a18_0x3fb2(_0x518342,_0x1755d5){_0x518342=_0x518342-0x78;const _0x202570=a18_0x2025();let _0x3fb245=_0x202570[_0x518342];return _0x3fb245;}function a18_0x2025(){const _0xacff33=['updatedAt','sendShopNotification','sendCustomNotification','firstName','Message\x20is\x20required','isVerified','sendBroadcast','TRC20','test_payout_123','groupBy','Тестовый\x20период','createdAt','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','USD','136DOxbZj','disconnectUser','update','shopId','body','gateway','productName','../config/database','This\x20is\x20a\x20test\x20notification','payout','desc','1947176TBIjWt','8IiyXCV','map','Shop\x20ID\x20is\x20required','getBotInfo','amount','Markdown','title','58035iWwOPM','\x20notification\x20sent\x20successfully','count','4819425HEWEYW','1106RblaaQ','length','username','all','telegramUser','findMany','Test\x20Product','json','sendPaymentNotification','txid','Broadcast\x20message\x20sent\x20successfully','currency','lastName','isActive','__importDefault','Test\x20','__esModule','shop','24DIirHt','status','findUnique','Test\x20Notification','486531moEcAz','27969936inbQYR','wallet','18420puhzJJ','filter','telegramBotService','getTelegramUsers','2447vahOek','4158hTfROf','paid','payment','getBotStatus','User\x20disconnected\x20successfully','TelegramController','default','details','params','custom','test_payment_123','sendTestNotification','Shop\x20not\x20found'];a18_0x2025=function(){return _0xacff33;};return a18_0x2025();}(function(_0x47dc6f,_0x592c07){const _0x54fe94=a18_0x3fb2,_0x2fa989=_0x47dc6f();while(!![]){try{const _0x58bada=-parseInt(_0x54fe94(0xc1))/0x1*(parseInt(_0x54fe94(0xa4))/0x2)+parseInt(_0x54fe94(0xa0))/0x3*(parseInt(_0x54fe94(0x8d))/0x4)+parseInt(_0x54fe94(0xa3))/0x5+-parseInt(_0x54fe94(0xb6))/0x6*(parseInt(_0x54fe94(0x98))/0x7)+parseInt(_0x54fe94(0x99))/0x8*(-parseInt(_0x54fe94(0xba))/0x9)+-parseInt(_0x54fe94(0xbd))/0xa*(parseInt(_0x54fe94(0xc2))/0xb)+parseInt(_0x54fe94(0xbb))/0xc;if(_0x58bada===_0x592c07)break;else _0x2fa989['push'](_0x2fa989['shift']());}catch(_0x3c972b){_0x2fa989['push'](_0x2fa989['shift']());}}}(a18_0x2025,0xb3bf5));var __importDefault=this&&this[a18_0x1e9f2f(0xb2)]||function(_0xfe9a8a){return _0xfe9a8a&&_0xfe9a8a['__esModule']?_0xfe9a8a:{'default':_0xfe9a8a};};Object['defineProperty'](exports,a18_0x1e9f2f(0xb4),{'value':!![]}),exports[a18_0x1e9f2f(0xc7)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a18_0x1e9f2f(0x94)));class TelegramController{constructor(){const _0x3759a7=a18_0x1e9f2f;this[_0x3759a7(0xc5)]=async(_0x3e9557,_0xd4f22a,_0x269538)=>{const _0x4672f1=_0x3759a7;try{const _0x4b7d38=telegramBotService_1[_0x4672f1(0xbf)][_0x4672f1(0x9c)](),_0x1ad075=await database_1[_0x4672f1(0x78)][_0x4672f1(0xa8)][_0x4672f1(0xa2)](),_0x1262fc=await database_1[_0x4672f1(0x78)][_0x4672f1(0xa8)][_0x4672f1(0xa2)]({'where':{'isVerified':!![]}}),_0x598579=await database_1[_0x4672f1(0x78)][_0x4672f1(0xa8)][_0x4672f1(0x88)]({'by':[_0x4672f1(0x90)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xd4f22a[_0x4672f1(0xab)]({'success':!![],'result':{'bot':{'isActive':_0x4b7d38[_0x4672f1(0xb1)],'username':_0x4b7d38['username']},'statistics':{'totalUsers':_0x1ad075,'verifiedUsers':_0x1262fc,'unverifiedUsers':_0x1ad075-_0x1262fc,'connectedShops':_0x598579[_0x4672f1(0xa5)]}}});}catch(_0x387361){_0x269538(_0x387361);}},this[_0x3759a7(0xc0)]=async(_0x5b8790,_0x478909,_0x55bcab)=>{const _0xb582ae=_0x3759a7;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3c40d4}=_0x5b8790['query'],_0x1a5071=(Number(page)-0x1)*Number(limit),_0x467f55={};_0x3c40d4!==undefined&&(_0x467f55[_0xb582ae(0x84)]=_0x3c40d4==='true');const [_0xd38b19,_0x2aed07]=await Promise[_0xb582ae(0xa7)]([database_1[_0xb582ae(0x78)][_0xb582ae(0xa8)][_0xb582ae(0xa9)]({'where':_0x467f55,'skip':_0x1a5071,'take':Number(limit),'orderBy':{'createdAt':_0xb582ae(0x97)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0xb582ae(0xa8)]['count']({'where':_0x467f55})]);_0x478909[_0xb582ae(0xab)]({'success':!![],'users':_0xd38b19[_0xb582ae(0x9a)](_0x70c60d=>({'id':_0x70c60d['id'],'telegramId':_0x70c60d['telegramId'],'username':_0x70c60d[_0xb582ae(0xa6)],'firstName':_0x70c60d[_0xb582ae(0x82)],'lastName':_0x70c60d[_0xb582ae(0xb0)],'isVerified':_0x70c60d[_0xb582ae(0x84)],'shop':_0x70c60d['shop'],'createdAt':_0x70c60d[_0xb582ae(0x8a)],'updatedAt':_0x70c60d[_0xb582ae(0x7f)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2aed07,'totalPages':Math['ceil'](_0x2aed07/Number(limit))}});}catch(_0x377402){_0x55bcab(_0x377402);}},this[_0x3759a7(0x85)]=async(_0x39bfcc,_0x1ece37,_0x37ed51)=>{const _0x1bc191=_0x3759a7;try{const {message:_0x153867,shopId:_0x56712b}=_0x39bfcc['body'];if(!_0x153867)return _0x1ece37[_0x1bc191(0xb7)](0x190)[_0x1bc191(0xab)]({'success':![],'message':_0x1bc191(0x83)});if(_0x56712b)await telegramBotService_1[_0x1bc191(0xbf)][_0x1bc191(0x80)](_0x56712b,_0x153867,{'parse_mode':_0x1bc191(0x9e)});else{const _0x1c39c4=await database_1[_0x1bc191(0x78)][_0x1bc191(0xa8)][_0x1bc191(0xa9)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4f89db=[...new Set(_0x1c39c4[_0x1bc191(0x9a)](_0x57e12e=>_0x57e12e[_0x1bc191(0x90)])[_0x1bc191(0xbe)](Boolean))];for(const _0x2b5a20 of _0x4f89db){_0x2b5a20&&await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x2b5a20,_0x153867,{'parse_mode':_0x1bc191(0x9e)});}}_0x1ece37['json']({'success':!![],'message':_0x1bc191(0xae)});}catch(_0x3a8b65){_0x37ed51(_0x3a8b65);}},this[_0x3759a7(0x8e)]=async(_0x46b509,_0x117267,_0x5e31bf)=>{const _0x53e8fd=_0x3759a7;try{const {telegramId:_0x1c8e80}=_0x46b509[_0x53e8fd(0x7a)],_0x5dbe62=await database_1[_0x53e8fd(0x78)][_0x53e8fd(0xa8)][_0x53e8fd(0xb8)]({'where':{'telegramId':_0x1c8e80},'include':{'shop':!![]}});if(!_0x5dbe62)return _0x117267['status'](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x53e8fd(0x78)][_0x53e8fd(0xa8)][_0x53e8fd(0x8f)]({'where':{'telegramId':_0x1c8e80},'data':{'shopId':null,'isVerified':![]}}),_0x117267[_0x53e8fd(0xab)]({'success':!![],'message':_0x53e8fd(0xc6)});}catch(_0x4bb00f){_0x5e31bf(_0x4bb00f);}},this[_0x3759a7(0x7d)]=async(_0x52c661,_0x2425eb,_0x31173d)=>{const _0x2d16a5=_0x3759a7;try{const {shopId:_0x432f7a,type:type=_0x2d16a5(0xc4),testData:_0x3490d9}=_0x52c661[_0x2d16a5(0x91)];if(!_0x432f7a)return _0x2425eb[_0x2d16a5(0xb7)](0x190)[_0x2d16a5(0xab)]({'success':![],'message':_0x2d16a5(0x9b)});const _0x5b4eaf=await database_1[_0x2d16a5(0x78)][_0x2d16a5(0xb5)]['findUnique']({'where':{'id':_0x432f7a},'select':{'id':!![],'name':!![]}});if(!_0x5b4eaf)return _0x2425eb[_0x2d16a5(0xb7)](0x194)[_0x2d16a5(0xab)]({'success':![],'message':_0x2d16a5(0x7e)});switch(type){case _0x2d16a5(0xc4):const _0x1c62cf={'id':_0x2d16a5(0x7c),'amount':_0x3490d9?.[_0x2d16a5(0x9d)]||0x64,'currency':_0x3490d9?.[_0x2d16a5(0xaf)]||_0x2d16a5(0x8c),'productName':_0x3490d9?.[_0x2d16a5(0x93)]||_0x2d16a5(0xaa),'gateway':_0x3490d9?.[_0x2d16a5(0x92)]||'plisio','createdAt':new Date(),..._0x3490d9};await telegramBotService_1[_0x2d16a5(0xbf)][_0x2d16a5(0xac)](_0x432f7a,_0x1c62cf,_0x2d16a5(0xc3));break;case _0x2d16a5(0x96):const _0xc11cae={'id':_0x2d16a5(0x87),'amount':_0x3490d9?.[_0x2d16a5(0x9d)]||0x1f4,'network':_0x3490d9?.['network']||_0x2d16a5(0x86),'wallet':_0x3490d9?.[_0x2d16a5(0xbc)]||_0x2d16a5(0x8b),'period':_0x2d16a5(0x89),'createdAt':new Date(),'txid':_0x3490d9?.[_0x2d16a5(0xad)]||null,..._0x3490d9};await telegramBotService_1[_0x2d16a5(0xbf)]['sendPayoutNotification'](_0x432f7a,_0xc11cae);break;case _0x2d16a5(0x7b):await telegramBotService_1[_0x2d16a5(0xbf)][_0x2d16a5(0x81)](_0x432f7a,_0x3490d9?.[_0x2d16a5(0x9f)]||_0x2d16a5(0xb9),_0x3490d9?.[_0x2d16a5(0x79)]||{'message':_0x2d16a5(0x95)});break;default:return _0x2425eb[_0x2d16a5(0xb7)](0x190)[_0x2d16a5(0xab)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x2425eb[_0x2d16a5(0xab)]({'success':!![],'message':_0x2d16a5(0xb3)+type+_0x2d16a5(0xa1)});}catch(_0x59eef7){_0x31173d(_0x59eef7);}};}}exports[a18_0x1e9f2f(0xc7)]=TelegramController;