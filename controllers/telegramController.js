'use strict';const a12_0x39ae8b=a12_0x14e5;(function(_0x32e6c5,_0x42de89){const _0x47d00f=a12_0x14e5,_0x44aeb2=_0x32e6c5();while(!![]){try{const _0x571371=parseInt(_0x47d00f(0x12d))/0x1*(-parseInt(_0x47d00f(0x150))/0x2)+parseInt(_0x47d00f(0x138))/0x3+-parseInt(_0x47d00f(0x139))/0x4+parseInt(_0x47d00f(0x11c))/0x5+-parseInt(_0x47d00f(0x131))/0x6+parseInt(_0x47d00f(0x125))/0x7+-parseInt(_0x47d00f(0x14a))/0x8;if(_0x571371===_0x42de89)break;else _0x44aeb2['push'](_0x44aeb2['shift']());}catch(_0x5d188d){_0x44aeb2['push'](_0x44aeb2['shift']());}}}(a12_0x4950,0xf11b7));function a12_0x4950(){const _0x3b83df=['10246200CVTwEY','filter','Test\x20Notification','Shop\x20not\x20found','USD','Test\x20Product','172610WjcsOR','test_payment_123','This\x20is\x20a\x20test\x20notification','getBotInfo','findMany','TelegramController','plisio','map','desc','getBotStatus','disconnectUser','Broadcast\x20message\x20sent\x20successfully','params','test_payout_123','default','json','7301670OPTHao','isActive','__esModule','productName','username','findUnique','../services/telegramBotService','sendPayoutNotification','amount','12125638UZcOsp','method','Shop\x20ID\x20is\x20required','shopId','custom','telegramUser','update','query','3CgHOVi','body','currency','Message\x20is\x20required','4843470txdHDu','sendShopNotification','telegramBotService','User\x20disconnected\x20successfully','length','\x20notification\x20sent\x20successfully','getTelegramUsers','4603542HDNUoM','5570288isODnb','__importDefault','paid','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','sendTestNotification','Markdown','gateway','isVerified','all','shop','count','completed','telegramId','details','status','firstName','defineProperty'];a12_0x4950=function(){return _0x3b83df;};return a12_0x4950();}var __importDefault=this&&this[a12_0x39ae8b(0x13a)]||function(_0x2930b6){const _0x242caa=a12_0x39ae8b;return _0x2930b6&&_0x2930b6[_0x242caa(0x11e)]?_0x2930b6:{'default':_0x2930b6};};Object[a12_0x39ae8b(0x149)](exports,a12_0x39ae8b(0x11e),{'value':!![]}),exports[a12_0x39ae8b(0x155)]=void 0x0;const telegramBotService_1=require(a12_0x39ae8b(0x122)),database_1=__importDefault(require('../config/database'));function a12_0x14e5(_0x2578e1,_0x50b830){const _0x4950fc=a12_0x4950();return a12_0x14e5=function(_0x14e585,_0x9f35d3){_0x14e585=_0x14e585-0x115;let _0x984cf0=_0x4950fc[_0x14e585];return _0x984cf0;},a12_0x14e5(_0x2578e1,_0x50b830);}class TelegramController{constructor(){const _0x4135f9=a12_0x39ae8b;this[_0x4135f9(0x115)]=async(_0x3a3bc5,_0x3db324,_0x46c99b)=>{const _0x106c1d=_0x4135f9;try{const _0x1f45a1=telegramBotService_1[_0x106c1d(0x133)][_0x106c1d(0x153)](),_0x5d1674=await database_1[_0x106c1d(0x11a)]['telegramUser']['count'](),_0xfdad67=await database_1[_0x106c1d(0x11a)][_0x106c1d(0x12a)][_0x106c1d(0x143)]({'where':{'isVerified':!![]}}),_0x167cd5=await database_1[_0x106c1d(0x11a)][_0x106c1d(0x12a)]['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3db324[_0x106c1d(0x11b)]({'success':!![],'result':{'bot':{'isActive':_0x1f45a1[_0x106c1d(0x11d)],'username':_0x1f45a1[_0x106c1d(0x120)]},'statistics':{'totalUsers':_0x5d1674,'verifiedUsers':_0xfdad67,'unverifiedUsers':_0x5d1674-_0xfdad67,'connectedShops':_0x167cd5[_0x106c1d(0x135)]}}});}catch(_0x4ee7e3){_0x46c99b(_0x4ee7e3);}},this[_0x4135f9(0x137)]=async(_0xb3bc9e,_0x4f17af,_0xd74dbe)=>{const _0x52a7c0=_0x4135f9;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5b6390}=_0xb3bc9e[_0x52a7c0(0x12c)],_0x2159b1=(Number(page)-0x1)*Number(limit),_0x6fc208={};_0x5b6390!==undefined&&(_0x6fc208[_0x52a7c0(0x140)]=_0x5b6390==='true');const [_0x1d2e33,_0x453840]=await Promise[_0x52a7c0(0x141)]([database_1['default'][_0x52a7c0(0x12a)][_0x52a7c0(0x154)]({'where':_0x6fc208,'skip':_0x2159b1,'take':Number(limit),'orderBy':{'createdAt':_0x52a7c0(0x158)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x52a7c0(0x11a)]['telegramUser'][_0x52a7c0(0x143)]({'where':_0x6fc208})]);_0x4f17af[_0x52a7c0(0x11b)]({'success':!![],'users':_0x1d2e33[_0x52a7c0(0x157)](_0x544817=>({'id':_0x544817['id'],'telegramId':_0x544817[_0x52a7c0(0x145)],'username':_0x544817[_0x52a7c0(0x120)],'firstName':_0x544817[_0x52a7c0(0x148)],'lastName':_0x544817['lastName'],'isVerified':_0x544817[_0x52a7c0(0x140)],'shop':_0x544817[_0x52a7c0(0x142)],'createdAt':_0x544817['createdAt'],'updatedAt':_0x544817['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x453840,'totalPages':Math['ceil'](_0x453840/Number(limit))}});}catch(_0x12cd42){_0xd74dbe(_0x12cd42);}},this['sendBroadcast']=async(_0x59d86a,_0x36e3f0,_0x49f7c6)=>{const _0x49cebc=_0x4135f9;try{const {message:_0x35b262,shopId:_0x4b57a5}=_0x59d86a[_0x49cebc(0x12e)];if(!_0x35b262)return _0x36e3f0[_0x49cebc(0x147)](0x190)[_0x49cebc(0x11b)]({'success':![],'message':_0x49cebc(0x130)});if(_0x4b57a5)await telegramBotService_1[_0x49cebc(0x133)][_0x49cebc(0x132)](_0x4b57a5,_0x35b262,{'parse_mode':'Markdown'});else{const _0x461294=await database_1[_0x49cebc(0x11a)]['telegramUser'][_0x49cebc(0x154)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x472832=[...new Set(_0x461294[_0x49cebc(0x157)](_0xb2ba4a=>_0xb2ba4a[_0x49cebc(0x128)])[_0x49cebc(0x14b)](Boolean))];for(const _0x498c57 of _0x472832){_0x498c57&&await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x498c57,_0x35b262,{'parse_mode':_0x49cebc(0x13e)});}}_0x36e3f0['json']({'success':!![],'message':_0x49cebc(0x117)});}catch(_0x4ced06){_0x49f7c6(_0x4ced06);}},this[_0x4135f9(0x116)]=async(_0x133f0f,_0x50e91d,_0x301fe6)=>{const _0x556540=_0x4135f9;try{const {telegramId:_0x868c76}=_0x133f0f[_0x556540(0x118)],_0x3797a2=await database_1[_0x556540(0x11a)][_0x556540(0x12a)][_0x556540(0x121)]({'where':{'telegramId':_0x868c76},'include':{'shop':!![]}});if(!_0x3797a2)return _0x50e91d[_0x556540(0x147)](0x194)[_0x556540(0x11b)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x556540(0x12a)][_0x556540(0x12b)]({'where':{'telegramId':_0x868c76},'data':{'shopId':null,'isVerified':![]}}),_0x50e91d['json']({'success':!![],'message':_0x556540(0x134)});}catch(_0x21a521){_0x301fe6(_0x21a521);}},this[_0x4135f9(0x13d)]=async(_0x4c190d,_0x511baf,_0x320b49)=>{const _0x361ceb=_0x4135f9;try{const {shopId:_0x10d56e,type:type='payment',testData:_0x484b5a}=_0x4c190d[_0x361ceb(0x12e)];if(!_0x10d56e)return _0x511baf[_0x361ceb(0x147)](0x190)[_0x361ceb(0x11b)]({'success':![],'message':_0x361ceb(0x127)});const _0x6cd2f5=await database_1[_0x361ceb(0x11a)][_0x361ceb(0x142)][_0x361ceb(0x121)]({'where':{'id':_0x10d56e},'select':{'id':!![],'name':!![]}});if(!_0x6cd2f5)return _0x511baf[_0x361ceb(0x147)](0x194)[_0x361ceb(0x11b)]({'success':![],'message':_0x361ceb(0x14d)});switch(type){case'payment':const _0x185632={'id':_0x361ceb(0x151),'amount':_0x484b5a?.[_0x361ceb(0x124)]||0x64,'currency':_0x484b5a?.[_0x361ceb(0x12f)]||_0x361ceb(0x14e),'productName':_0x484b5a?.[_0x361ceb(0x11f)]||_0x361ceb(0x14f),'gateway':_0x484b5a?.[_0x361ceb(0x13f)]||_0x361ceb(0x156),'createdAt':new Date(),..._0x484b5a};await telegramBotService_1[_0x361ceb(0x133)]['sendPaymentNotification'](_0x10d56e,_0x185632,_0x361ceb(0x13b));break;case'payout':const _0x4d43ea={'id':_0x361ceb(0x119),'amount':_0x484b5a?.[_0x361ceb(0x124)]||0x1f4,'method':_0x484b5a?.[_0x361ceb(0x126)]||'bank_transfer','createdAt':new Date(),..._0x484b5a};await telegramBotService_1['telegramBotService'][_0x361ceb(0x123)](_0x10d56e,_0x4d43ea,_0x361ceb(0x144));break;case _0x361ceb(0x129):await telegramBotService_1[_0x361ceb(0x133)]['sendCustomNotification'](_0x10d56e,_0x484b5a?.['title']||_0x361ceb(0x14c),_0x484b5a?.[_0x361ceb(0x146)]||{'message':_0x361ceb(0x152)});break;default:return _0x511baf[_0x361ceb(0x147)](0x190)['json']({'success':![],'message':_0x361ceb(0x13c)});}_0x511baf[_0x361ceb(0x11b)]({'success':!![],'message':'Test\x20'+type+_0x361ceb(0x136)});}catch(_0x2e3426){_0x320b49(_0x2e3426);}};}}exports[a12_0x39ae8b(0x155)]=TelegramController;