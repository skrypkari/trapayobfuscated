'use strict';const a12_0x3c1bad=a12_0x3251;(function(_0x434a8e,_0x3522a9){const _0x50ec29=a12_0x3251,_0x506826=_0x434a8e();while(!![]){try{const _0x14c955=-parseInt(_0x50ec29(0x1cd))/0x1+parseInt(_0x50ec29(0x1c3))/0x2*(-parseInt(_0x50ec29(0x1b4))/0x3)+-parseInt(_0x50ec29(0x1e9))/0x4*(-parseInt(_0x50ec29(0x1a8))/0x5)+-parseInt(_0x50ec29(0x1a6))/0x6*(parseInt(_0x50ec29(0x1e1))/0x7)+parseInt(_0x50ec29(0x1ad))/0x8*(parseInt(_0x50ec29(0x1bd))/0x9)+-parseInt(_0x50ec29(0x1af))/0xa*(-parseInt(_0x50ec29(0x1ab))/0xb)+parseInt(_0x50ec29(0x1d6))/0xc;if(_0x14c955===_0x3522a9)break;else _0x506826['push'](_0x506826['shift']());}catch(_0x1b8883){_0x506826['push'](_0x506826['shift']());}}}(a12_0x1036,0xf0257));function a12_0x1036(){const _0x31e93e=['test_payout_123','length','Broadcast\x20message\x20sent\x20successfully','all','944150oGIYVR','plisio','gateway','defineProperty','desc','disconnectUser','shopId','count','test_payment_123','8975700pIrDjN','getBotInfo','sendTestNotification','USD','telegramUser','\x20notification\x20sent\x20successfully','details','groupBy','isVerified','isActive','Telegram\x20user\x20not\x20found','651xTxCfg','Test\x20','map','status','Shop\x20not\x20found','amount','body','productName','4VvKYXH','shop','69978nIOtHU','default','6927690cvYaxR','bank_transfer','telegramBotService','13113485hKyFcU','findMany','410456CHGECE','__esModule','10DFEtKJ','sendPaymentNotification','Message\x20is\x20required','payment','ceil','3UcxjpT','username','json','query','filter','Test\x20Product','findUnique','This\x20is\x20a\x20test\x20notification','Test\x20Notification','27XSVPcC','completed','firstName','Markdown','sendBroadcast','update','934242HoUltF','TelegramController','true','getBotStatus','createdAt','sendShopNotification'];a12_0x1036=function(){return _0x31e93e;};return a12_0x1036();}var __importDefault=this&&this['__importDefault']||function(_0x18baac){return _0x18baac&&_0x18baac['__esModule']?_0x18baac:{'default':_0x18baac};};Object[a12_0x3c1bad(0x1d0)](exports,a12_0x3c1bad(0x1ae),{'value':!![]}),exports[a12_0x3c1bad(0x1c4)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require('../config/database'));function a12_0x3251(_0x4df2e8,_0x7c75ca){const _0x1036a1=a12_0x1036();return a12_0x3251=function(_0x32516e,_0x296f67){_0x32516e=_0x32516e-0x1a5;let _0x23f14f=_0x1036a1[_0x32516e];return _0x23f14f;},a12_0x3251(_0x4df2e8,_0x7c75ca);}class TelegramController{constructor(){const _0x28238f=a12_0x3c1bad;this[_0x28238f(0x1c6)]=async(_0x958b1,_0x1ad339,_0x356105)=>{const _0x409ce0=_0x28238f;try{const _0x3ee5e9=telegramBotService_1[_0x409ce0(0x1aa)][_0x409ce0(0x1d7)](),_0x505192=await database_1[_0x409ce0(0x1a7)][_0x409ce0(0x1da)]['count'](),_0x374b3f=await database_1[_0x409ce0(0x1a7)]['telegramUser'][_0x409ce0(0x1d4)]({'where':{'isVerified':!![]}}),_0x1ee00f=await database_1[_0x409ce0(0x1a7)][_0x409ce0(0x1da)][_0x409ce0(0x1dd)]({'by':[_0x409ce0(0x1d3)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1ad339['json']({'success':!![],'result':{'bot':{'isActive':_0x3ee5e9[_0x409ce0(0x1df)],'username':_0x3ee5e9[_0x409ce0(0x1b5)]},'statistics':{'totalUsers':_0x505192,'verifiedUsers':_0x374b3f,'unverifiedUsers':_0x505192-_0x374b3f,'connectedShops':_0x1ee00f[_0x409ce0(0x1ca)]}}});}catch(_0x569c18){_0x356105(_0x569c18);}},this['getTelegramUsers']=async(_0x4ec38d,_0x1a0c69,_0x30899a)=>{const _0xbaff76=_0x28238f;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1e1093}=_0x4ec38d[_0xbaff76(0x1b7)],_0x3c4966=(Number(page)-0x1)*Number(limit),_0x3cf8f1={};_0x1e1093!==undefined&&(_0x3cf8f1[_0xbaff76(0x1de)]=_0x1e1093===_0xbaff76(0x1c5));const [_0xe3a35,_0x3ca8e4]=await Promise[_0xbaff76(0x1cc)]([database_1[_0xbaff76(0x1a7)][_0xbaff76(0x1da)][_0xbaff76(0x1ac)]({'where':_0x3cf8f1,'skip':_0x3c4966,'take':Number(limit),'orderBy':{'createdAt':_0xbaff76(0x1d1)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0xbaff76(0x1a7)][_0xbaff76(0x1da)][_0xbaff76(0x1d4)]({'where':_0x3cf8f1})]);_0x1a0c69[_0xbaff76(0x1b6)]({'success':!![],'users':_0xe3a35['map'](_0x13dff5=>({'id':_0x13dff5['id'],'telegramId':_0x13dff5['telegramId'],'username':_0x13dff5[_0xbaff76(0x1b5)],'firstName':_0x13dff5[_0xbaff76(0x1bf)],'lastName':_0x13dff5['lastName'],'isVerified':_0x13dff5['isVerified'],'shop':_0x13dff5[_0xbaff76(0x1a5)],'createdAt':_0x13dff5[_0xbaff76(0x1c7)],'updatedAt':_0x13dff5['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3ca8e4,'totalPages':Math[_0xbaff76(0x1b3)](_0x3ca8e4/Number(limit))}});}catch(_0x2e220a){_0x30899a(_0x2e220a);}},this[_0x28238f(0x1c1)]=async(_0x52f324,_0x50aabd,_0x5bba03)=>{const _0x41e1af=_0x28238f;try{const {message:_0x344e9e,shopId:_0x33cfc0}=_0x52f324[_0x41e1af(0x1e7)];if(!_0x344e9e)return _0x50aabd[_0x41e1af(0x1e4)](0x190)[_0x41e1af(0x1b6)]({'success':![],'message':_0x41e1af(0x1b1)});if(_0x33cfc0)await telegramBotService_1[_0x41e1af(0x1aa)][_0x41e1af(0x1c8)](_0x33cfc0,_0x344e9e,{'parse_mode':_0x41e1af(0x1c0)});else{const _0x4b6b89=await database_1[_0x41e1af(0x1a7)]['telegramUser'][_0x41e1af(0x1ac)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4bdd80=[...new Set(_0x4b6b89[_0x41e1af(0x1e3)](_0x12da76=>_0x12da76['shopId'])[_0x41e1af(0x1b8)](Boolean))];for(const _0x214363 of _0x4bdd80){_0x214363&&await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x214363,_0x344e9e,{'parse_mode':'Markdown'});}}_0x50aabd[_0x41e1af(0x1b6)]({'success':!![],'message':_0x41e1af(0x1cb)});}catch(_0xd1da12){_0x5bba03(_0xd1da12);}},this[_0x28238f(0x1d2)]=async(_0x1287c4,_0xb95083,_0x124555)=>{const _0x3ffa8d=_0x28238f;try{const {telegramId:_0x4ffc60}=_0x1287c4['params'],_0x3c1d32=await database_1[_0x3ffa8d(0x1a7)][_0x3ffa8d(0x1da)]['findUnique']({'where':{'telegramId':_0x4ffc60},'include':{'shop':!![]}});if(!_0x3c1d32)return _0xb95083[_0x3ffa8d(0x1e4)](0x194)['json']({'success':![],'message':_0x3ffa8d(0x1e0)});await database_1[_0x3ffa8d(0x1a7)][_0x3ffa8d(0x1da)][_0x3ffa8d(0x1c2)]({'where':{'telegramId':_0x4ffc60},'data':{'shopId':null,'isVerified':![]}}),_0xb95083[_0x3ffa8d(0x1b6)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x2f7092){_0x124555(_0x2f7092);}},this[_0x28238f(0x1d8)]=async(_0x28a473,_0xb7467,_0x497456)=>{const _0xa24f14=_0x28238f;try{const {shopId:_0x5b9fd2,type:type=_0xa24f14(0x1b2),testData:_0x185884}=_0x28a473[_0xa24f14(0x1e7)];if(!_0x5b9fd2)return _0xb7467[_0xa24f14(0x1e4)](0x190)[_0xa24f14(0x1b6)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x4269f7=await database_1[_0xa24f14(0x1a7)][_0xa24f14(0x1a5)][_0xa24f14(0x1ba)]({'where':{'id':_0x5b9fd2},'select':{'id':!![],'name':!![]}});if(!_0x4269f7)return _0xb7467['status'](0x194)[_0xa24f14(0x1b6)]({'success':![],'message':_0xa24f14(0x1e5)});switch(type){case _0xa24f14(0x1b2):const _0x47029e={'id':_0xa24f14(0x1d5),'amount':_0x185884?.[_0xa24f14(0x1e6)]||0x64,'currency':_0x185884?.['currency']||_0xa24f14(0x1d9),'productName':_0x185884?.[_0xa24f14(0x1e8)]||_0xa24f14(0x1b9),'gateway':_0x185884?.[_0xa24f14(0x1cf)]||_0xa24f14(0x1ce),'createdAt':new Date(),..._0x185884};await telegramBotService_1[_0xa24f14(0x1aa)][_0xa24f14(0x1b0)](_0x5b9fd2,_0x47029e,'paid');break;case'payout':const _0x2d0e56={'id':_0xa24f14(0x1c9),'amount':_0x185884?.[_0xa24f14(0x1e6)]||0x1f4,'method':_0x185884?.['method']||_0xa24f14(0x1a9),'createdAt':new Date(),..._0x185884};await telegramBotService_1[_0xa24f14(0x1aa)]['sendPayoutNotification'](_0x5b9fd2,_0x2d0e56,_0xa24f14(0x1be));break;case'custom':await telegramBotService_1[_0xa24f14(0x1aa)]['sendCustomNotification'](_0x5b9fd2,_0x185884?.['title']||_0xa24f14(0x1bc),_0x185884?.[_0xa24f14(0x1dc)]||{'message':_0xa24f14(0x1bb)});break;default:return _0xb7467[_0xa24f14(0x1e4)](0x190)[_0xa24f14(0x1b6)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0xb7467['json']({'success':!![],'message':_0xa24f14(0x1e2)+type+_0xa24f14(0x1db)});}catch(_0x22a9d3){_0x497456(_0x22a9d3);}};}}exports[a12_0x3c1bad(0x1c4)]=TelegramController;