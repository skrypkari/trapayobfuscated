'use strict';const a13_0x1f0090=a13_0x44ff;(function(_0x4ad032,_0x15b16f){const _0x400fe6=a13_0x44ff,_0x1ad9b6=_0x4ad032();while(!![]){try{const _0x52b21a=-parseInt(_0x400fe6(0x103))/0x1+parseInt(_0x400fe6(0xcf))/0x2*(-parseInt(_0x400fe6(0xe6))/0x3)+-parseInt(_0x400fe6(0xde))/0x4+parseInt(_0x400fe6(0xdd))/0x5*(-parseInt(_0x400fe6(0xfa))/0x6)+parseInt(_0x400fe6(0xdf))/0x7+-parseInt(_0x400fe6(0xf3))/0x8+parseInt(_0x400fe6(0xd6))/0x9;if(_0x52b21a===_0x15b16f)break;else _0x1ad9b6['push'](_0x1ad9b6['shift']());}catch(_0xeff4ab){_0x1ad9b6['push'](_0x1ad9b6['shift']());}}}(a13_0x1f74,0x2edb1));var __importDefault=this&&this[a13_0x1f0090(0xfc)]||function(_0x48d0a7){const _0x3b9231=a13_0x1f0090;return _0x48d0a7&&_0x48d0a7[_0x3b9231(0xed)]?_0x48d0a7:{'default':_0x48d0a7};};function a13_0x1f74(){const _0x115f06=['Broadcast\x20message\x20sent\x20successfully','query','84qmijvU','amount','__importDefault','getBotStatus','sendShopNotification','count','This\x20is\x20a\x20test\x20notification','Telegram\x20user\x20not\x20found','Markdown','146024VqjNqE','getTelegramUsers','findUnique','lastName','ceil','desc','USD','disconnectUser','productName','method','Test\x20','plisio','title','Test\x20Product','telegramBotService','isActive','currency','isVerified','2GITQkM','body','sendPaymentNotification','getBotInfo','true','shop','sendPayoutNotification','8884242HjzDzZ','TelegramController','all','map','telegramUser','User\x20disconnected\x20successfully','findMany','131225UffWDo','1414564VjJMUa','1696058geYgaa','payout','filter','payment','../services/telegramBotService','sendCustomNotification','firstName','407316ddyNnL','default','json','details','status','telegramId','Message\x20is\x20required','__esModule','username','../config/database','gateway','Test\x20Notification','Shop\x20not\x20found','277152FsiQyB','sendTestNotification','defineProperty','shopId','test_payout_123'];a13_0x1f74=function(){return _0x115f06;};return a13_0x1f74();}Object[a13_0x1f0090(0xf5)](exports,a13_0x1f0090(0xed),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a13_0x1f0090(0xe3)),database_1=__importDefault(require(a13_0x1f0090(0xef)));class TelegramController{constructor(){const _0x3967e7=a13_0x1f0090;this[_0x3967e7(0xfd)]=async(_0x271227,_0x1679ff,_0x36c440)=>{const _0x5d4b30=_0x3967e7;try{const _0x59f298=telegramBotService_1['telegramBotService'][_0x5d4b30(0xd2)](),_0x4040b9=await database_1[_0x5d4b30(0xe7)]['telegramUser']['count'](),_0x222a9a=await database_1['default'][_0x5d4b30(0xda)][_0x5d4b30(0xff)]({'where':{'isVerified':!![]}}),_0x35b8de=await database_1['default'][_0x5d4b30(0xda)]['groupBy']({'by':[_0x5d4b30(0xf6)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1679ff[_0x5d4b30(0xe8)]({'success':!![],'result':{'bot':{'isActive':_0x59f298[_0x5d4b30(0xcc)],'username':_0x59f298[_0x5d4b30(0xee)]},'statistics':{'totalUsers':_0x4040b9,'verifiedUsers':_0x222a9a,'unverifiedUsers':_0x4040b9-_0x222a9a,'connectedShops':_0x35b8de['length']}}});}catch(_0x47681d){_0x36c440(_0x47681d);}},this[_0x3967e7(0x104)]=async(_0x643ed2,_0x1eaab5,_0x30bd87)=>{const _0x4dca62=_0x3967e7;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5dabcf}=_0x643ed2[_0x4dca62(0xf9)],_0x2319d4=(Number(page)-0x1)*Number(limit),_0x4b917b={};_0x5dabcf!==undefined&&(_0x4b917b['isVerified']=_0x5dabcf===_0x4dca62(0xd3));const [_0x3a9059,_0x5c42bf]=await Promise[_0x4dca62(0xd8)]([database_1[_0x4dca62(0xe7)][_0x4dca62(0xda)][_0x4dca62(0xdc)]({'where':_0x4b917b,'skip':_0x2319d4,'take':Number(limit),'orderBy':{'createdAt':_0x4dca62(0x108)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4dca62(0xe7)][_0x4dca62(0xda)][_0x4dca62(0xff)]({'where':_0x4b917b})]);_0x1eaab5[_0x4dca62(0xe8)]({'success':!![],'users':_0x3a9059[_0x4dca62(0xd9)](_0xbba75c=>({'id':_0xbba75c['id'],'telegramId':_0xbba75c[_0x4dca62(0xeb)],'username':_0xbba75c['username'],'firstName':_0xbba75c[_0x4dca62(0xe5)],'lastName':_0xbba75c[_0x4dca62(0x106)],'isVerified':_0xbba75c[_0x4dca62(0xce)],'shop':_0xbba75c['shop'],'createdAt':_0xbba75c['createdAt'],'updatedAt':_0xbba75c['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5c42bf,'totalPages':Math[_0x4dca62(0x107)](_0x5c42bf/Number(limit))}});}catch(_0x5e054d){_0x30bd87(_0x5e054d);}},this['sendBroadcast']=async(_0x3fa306,_0x2f4990,_0x1d6749)=>{const _0x1b0c80=_0x3967e7;try{const {message:_0x1da43b,shopId:_0xe6abc8}=_0x3fa306[_0x1b0c80(0xd0)];if(!_0x1da43b)return _0x2f4990['status'](0x190)[_0x1b0c80(0xe8)]({'success':![],'message':_0x1b0c80(0xec)});if(_0xe6abc8)await telegramBotService_1[_0x1b0c80(0xcb)][_0x1b0c80(0xfe)](_0xe6abc8,_0x1da43b,{'parse_mode':_0x1b0c80(0x102)});else{const _0x17c4f7=await database_1['default']['telegramUser'][_0x1b0c80(0xdc)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xa60c47=[...new Set(_0x17c4f7['map'](_0x3d9baa=>_0x3d9baa[_0x1b0c80(0xf6)])[_0x1b0c80(0xe1)](Boolean))];for(const _0x2a5afe of _0xa60c47){_0x2a5afe&&await telegramBotService_1['telegramBotService'][_0x1b0c80(0xfe)](_0x2a5afe,_0x1da43b,{'parse_mode':'Markdown'});}}_0x2f4990[_0x1b0c80(0xe8)]({'success':!![],'message':_0x1b0c80(0xf8)});}catch(_0x3763fb){_0x1d6749(_0x3763fb);}},this[_0x3967e7(0x10a)]=async(_0x3dbf4a,_0x48cf4d,_0x1fe9e2)=>{const _0x40bf5a=_0x3967e7;try{const {telegramId:_0x488aae}=_0x3dbf4a['params'],_0x4191d5=await database_1[_0x40bf5a(0xe7)][_0x40bf5a(0xda)]['findUnique']({'where':{'telegramId':_0x488aae},'include':{'shop':!![]}});if(!_0x4191d5)return _0x48cf4d[_0x40bf5a(0xea)](0x194)[_0x40bf5a(0xe8)]({'success':![],'message':_0x40bf5a(0x101)});await database_1[_0x40bf5a(0xe7)][_0x40bf5a(0xda)]['update']({'where':{'telegramId':_0x488aae},'data':{'shopId':null,'isVerified':![]}}),_0x48cf4d['json']({'success':!![],'message':_0x40bf5a(0xdb)});}catch(_0x3fd45b){_0x1fe9e2(_0x3fd45b);}},this[_0x3967e7(0xf4)]=async(_0x2e02a0,_0x2d57f9,_0xa60541)=>{const _0x2150fa=_0x3967e7;try{const {shopId:_0x27d055,type:type=_0x2150fa(0xe2),testData:_0x2aa574}=_0x2e02a0[_0x2150fa(0xd0)];if(!_0x27d055)return _0x2d57f9[_0x2150fa(0xea)](0x190)[_0x2150fa(0xe8)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x29c133=await database_1[_0x2150fa(0xe7)][_0x2150fa(0xd4)][_0x2150fa(0x105)]({'where':{'id':_0x27d055},'select':{'id':!![],'name':!![]}});if(!_0x29c133)return _0x2d57f9[_0x2150fa(0xea)](0x194)[_0x2150fa(0xe8)]({'success':![],'message':_0x2150fa(0xf2)});switch(type){case _0x2150fa(0xe2):const _0x16b9f9={'id':'test_payment_123','amount':_0x2aa574?.['amount']||0x64,'currency':_0x2aa574?.[_0x2150fa(0xcd)]||_0x2150fa(0x109),'productName':_0x2aa574?.[_0x2150fa(0x10b)]||_0x2150fa(0x110),'gateway':_0x2aa574?.[_0x2150fa(0xf0)]||_0x2150fa(0x10e),'createdAt':new Date(),..._0x2aa574};await telegramBotService_1[_0x2150fa(0xcb)][_0x2150fa(0xd1)](_0x27d055,_0x16b9f9,'paid');break;case _0x2150fa(0xe0):const _0x3d81cd={'id':_0x2150fa(0xf7),'amount':_0x2aa574?.[_0x2150fa(0xfb)]||0x1f4,'method':_0x2aa574?.[_0x2150fa(0x10c)]||'bank_transfer','createdAt':new Date(),..._0x2aa574};await telegramBotService_1[_0x2150fa(0xcb)][_0x2150fa(0xd5)](_0x27d055,_0x3d81cd,'completed');break;case'custom':await telegramBotService_1[_0x2150fa(0xcb)][_0x2150fa(0xe4)](_0x27d055,_0x2aa574?.[_0x2150fa(0x10f)]||_0x2150fa(0xf1),_0x2aa574?.[_0x2150fa(0xe9)]||{'message':_0x2150fa(0x100)});break;default:return _0x2d57f9[_0x2150fa(0xea)](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x2d57f9[_0x2150fa(0xe8)]({'success':!![],'message':_0x2150fa(0x10d)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x400917){_0xa60541(_0x400917);}};}}function a13_0x44ff(_0x41de40,_0x356e2a){const _0x1f74a2=a13_0x1f74();return a13_0x44ff=function(_0x44ffaa,_0x1fb8c2){_0x44ffaa=_0x44ffaa-0xcb;let _0x4082b1=_0x1f74a2[_0x44ffaa];return _0x4082b1;},a13_0x44ff(_0x41de40,_0x356e2a);}exports[a13_0x1f0090(0xd7)]=TelegramController;