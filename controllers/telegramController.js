'use strict';const a12_0x34e7d6=a12_0x4ffd;function a12_0x4ffd(_0x15845b,_0x135c0e){const _0x281bb3=a12_0x281b();return a12_0x4ffd=function(_0x4ffd51,_0x296ad6){_0x4ffd51=_0x4ffd51-0xfa;let _0x1ce0a1=_0x281bb3[_0x4ffd51];return _0x1ce0a1;},a12_0x4ffd(_0x15845b,_0x135c0e);}(function(_0x4e26ff,_0x37c226){const _0x421ff8=a12_0x4ffd,_0x45a69f=_0x4e26ff();while(!![]){try{const _0x14cdfe=-parseInt(_0x421ff8(0xff))/0x1*(-parseInt(_0x421ff8(0x114))/0x2)+parseInt(_0x421ff8(0xfe))/0x3+-parseInt(_0x421ff8(0xfb))/0x4*(-parseInt(_0x421ff8(0x112))/0x5)+-parseInt(_0x421ff8(0x11e))/0x6+-parseInt(_0x421ff8(0x126))/0x7*(parseInt(_0x421ff8(0x108))/0x8)+-parseInt(_0x421ff8(0x12c))/0x9+parseInt(_0x421ff8(0x125))/0xa;if(_0x14cdfe===_0x37c226)break;else _0x45a69f['push'](_0x45a69f['shift']());}catch(_0x558250){_0x45a69f['push'](_0x45a69f['shift']());}}}(a12_0x281b,0x5223d));var __importDefault=this&&this[a12_0x34e7d6(0x106)]||function(_0x20d565){const _0x5ea64a=a12_0x34e7d6;return _0x20d565&&_0x20d565[_0x5ea64a(0x123)]?_0x20d565:{'default':_0x20d565};};Object[a12_0x34e7d6(0x13d)](exports,a12_0x34e7d6(0x123),{'value':!![]}),exports[a12_0x34e7d6(0x10c)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x34e7d6(0x13a)));function a12_0x281b(){const _0x1e4fe2=['body','sendPayoutNotification','132696cYqEcd','disconnectUser','json','USD','getBotInfo','completed','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','telegramId','details','isVerified','telegramBotService','bank_transfer','payment','status','../config/database','username','groupBy','defineProperty','test_payout_123','gateway','plisio','shop','ceil','productName','firstName','Message\x20is\x20required','map','194092KWjQOv','sendTestNotification','createdAt','899382NLsQOQ','10ECHgzq','\x20notification\x20sent\x20successfully','Markdown','desc','Shop\x20not\x20found','update','title','__importDefault','User\x20disconnected\x20successfully','256GqLjeA','query','getTelegramUsers','length','TelegramController','currency','Telegram\x20user\x20not\x20found','default','updatedAt','sendCustomNotification','5FHvvLB','sendShopNotification','44606ltLRED','findMany','sendBroadcast','isActive','Shop\x20ID\x20is\x20required','telegramUser','Test\x20Notification','sendPaymentNotification','custom','test_payment_123','3620538BkVVvH','payout','count','amount','shopId','__esModule','lastName','7789450HaQSOG','86555KpXUrW','This\x20is\x20a\x20test\x20notification','true','findUnique'];a12_0x281b=function(){return _0x1e4fe2;};return a12_0x281b();}class TelegramController{constructor(){const _0x272856=a12_0x34e7d6;this['getBotStatus']=async(_0x3e212d,_0x5a0a7c,_0x1a2f87)=>{const _0x410d78=a12_0x4ffd;try{const _0x4a0839=telegramBotService_1[_0x410d78(0x136)][_0x410d78(0x130)](),_0x2471d2=await database_1['default'][_0x410d78(0x119)][_0x410d78(0x120)](),_0x491094=await database_1[_0x410d78(0x10f)][_0x410d78(0x119)][_0x410d78(0x120)]({'where':{'isVerified':!![]}}),_0x16f52d=await database_1[_0x410d78(0x10f)][_0x410d78(0x119)][_0x410d78(0x13c)]({'by':[_0x410d78(0x122)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5a0a7c[_0x410d78(0x12e)]({'success':!![],'result':{'bot':{'isActive':_0x4a0839[_0x410d78(0x117)],'username':_0x4a0839[_0x410d78(0x13b)]},'statistics':{'totalUsers':_0x2471d2,'verifiedUsers':_0x491094,'unverifiedUsers':_0x2471d2-_0x491094,'connectedShops':_0x16f52d[_0x410d78(0x10b)]}}});}catch(_0x22108c){_0x1a2f87(_0x22108c);}},this[_0x272856(0x10a)]=async(_0x47cb9c,_0x1b66a3,_0x21546f)=>{const _0x268947=_0x272856;try{const {page:page=0x1,limit:limit=0x14,verified:_0x56e5d2}=_0x47cb9c[_0x268947(0x109)],_0x596381=(Number(page)-0x1)*Number(limit),_0x9146df={};_0x56e5d2!==undefined&&(_0x9146df['isVerified']=_0x56e5d2===_0x268947(0x128));const [_0x350175,_0x30705e]=await Promise['all']([database_1[_0x268947(0x10f)][_0x268947(0x119)][_0x268947(0x115)]({'where':_0x9146df,'skip':_0x596381,'take':Number(limit),'orderBy':{'createdAt':_0x268947(0x102)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x268947(0x10f)][_0x268947(0x119)][_0x268947(0x120)]({'where':_0x9146df})]);_0x1b66a3[_0x268947(0x12e)]({'success':!![],'users':_0x350175['map'](_0x3f456e=>({'id':_0x3f456e['id'],'telegramId':_0x3f456e[_0x268947(0x133)],'username':_0x3f456e[_0x268947(0x13b)],'firstName':_0x3f456e[_0x268947(0x144)],'lastName':_0x3f456e[_0x268947(0x124)],'isVerified':_0x3f456e[_0x268947(0x135)],'shop':_0x3f456e['shop'],'createdAt':_0x3f456e[_0x268947(0xfd)],'updatedAt':_0x3f456e[_0x268947(0x110)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x30705e,'totalPages':Math[_0x268947(0x142)](_0x30705e/Number(limit))}});}catch(_0x53de5f){_0x21546f(_0x53de5f);}},this[_0x272856(0x116)]=async(_0x2e58f8,_0x44271d,_0x4f4744)=>{const _0x1b3b13=_0x272856;try{const {message:_0x3e4a20,shopId:_0x29b1f3}=_0x2e58f8['body'];if(!_0x3e4a20)return _0x44271d[_0x1b3b13(0x139)](0x190)[_0x1b3b13(0x12e)]({'success':![],'message':_0x1b3b13(0x145)});if(_0x29b1f3)await telegramBotService_1[_0x1b3b13(0x136)][_0x1b3b13(0x113)](_0x29b1f3,_0x3e4a20,{'parse_mode':'Markdown'});else{const _0xcd7bd5=await database_1[_0x1b3b13(0x10f)][_0x1b3b13(0x119)][_0x1b3b13(0x115)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xa0a1a3=[...new Set(_0xcd7bd5[_0x1b3b13(0xfa)](_0x59b1db=>_0x59b1db[_0x1b3b13(0x122)])['filter'](Boolean))];for(const _0x2c26b4 of _0xa0a1a3){_0x2c26b4&&await telegramBotService_1[_0x1b3b13(0x136)]['sendShopNotification'](_0x2c26b4,_0x3e4a20,{'parse_mode':_0x1b3b13(0x101)});}}_0x44271d[_0x1b3b13(0x12e)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x4902a2){_0x4f4744(_0x4902a2);}},this[_0x272856(0x12d)]=async(_0x5ad229,_0x36b953,_0x4ca541)=>{const _0x253f2e=_0x272856;try{const {telegramId:_0x132595}=_0x5ad229['params'],_0x4e2c6a=await database_1[_0x253f2e(0x10f)][_0x253f2e(0x119)][_0x253f2e(0x129)]({'where':{'telegramId':_0x132595},'include':{'shop':!![]}});if(!_0x4e2c6a)return _0x36b953[_0x253f2e(0x139)](0x194)[_0x253f2e(0x12e)]({'success':![],'message':_0x253f2e(0x10e)});await database_1[_0x253f2e(0x10f)][_0x253f2e(0x119)][_0x253f2e(0x104)]({'where':{'telegramId':_0x132595},'data':{'shopId':null,'isVerified':![]}}),_0x36b953[_0x253f2e(0x12e)]({'success':!![],'message':_0x253f2e(0x107)});}catch(_0x41b4e9){_0x4ca541(_0x41b4e9);}},this[_0x272856(0xfc)]=async(_0x5e2e8e,_0x23e264,_0xf995c0)=>{const _0x2b4c4c=_0x272856;try{const {shopId:_0x215e4a,type:type=_0x2b4c4c(0x138),testData:_0x36f55d}=_0x5e2e8e[_0x2b4c4c(0x12a)];if(!_0x215e4a)return _0x23e264[_0x2b4c4c(0x139)](0x190)[_0x2b4c4c(0x12e)]({'success':![],'message':_0x2b4c4c(0x118)});const _0x80b1a0=await database_1[_0x2b4c4c(0x10f)][_0x2b4c4c(0x141)][_0x2b4c4c(0x129)]({'where':{'id':_0x215e4a},'select':{'id':!![],'name':!![]}});if(!_0x80b1a0)return _0x23e264[_0x2b4c4c(0x139)](0x194)[_0x2b4c4c(0x12e)]({'success':![],'message':_0x2b4c4c(0x103)});switch(type){case _0x2b4c4c(0x138):const _0x1d3d04={'id':_0x2b4c4c(0x11d),'amount':_0x36f55d?.[_0x2b4c4c(0x121)]||0x64,'currency':_0x36f55d?.[_0x2b4c4c(0x10d)]||_0x2b4c4c(0x12f),'productName':_0x36f55d?.[_0x2b4c4c(0x143)]||'Test\x20Product','gateway':_0x36f55d?.[_0x2b4c4c(0x13f)]||_0x2b4c4c(0x140),'createdAt':new Date(),..._0x36f55d};await telegramBotService_1[_0x2b4c4c(0x136)][_0x2b4c4c(0x11b)](_0x215e4a,_0x1d3d04,'paid');break;case _0x2b4c4c(0x11f):const _0x41ade8={'id':_0x2b4c4c(0x13e),'amount':_0x36f55d?.[_0x2b4c4c(0x121)]||0x1f4,'method':_0x36f55d?.['method']||_0x2b4c4c(0x137),'createdAt':new Date(),..._0x36f55d};await telegramBotService_1[_0x2b4c4c(0x136)][_0x2b4c4c(0x12b)](_0x215e4a,_0x41ade8,_0x2b4c4c(0x131));break;case _0x2b4c4c(0x11c):await telegramBotService_1[_0x2b4c4c(0x136)][_0x2b4c4c(0x111)](_0x215e4a,_0x36f55d?.[_0x2b4c4c(0x105)]||_0x2b4c4c(0x11a),_0x36f55d?.[_0x2b4c4c(0x134)]||{'message':_0x2b4c4c(0x127)});break;default:return _0x23e264[_0x2b4c4c(0x139)](0x190)[_0x2b4c4c(0x12e)]({'success':![],'message':_0x2b4c4c(0x132)});}_0x23e264[_0x2b4c4c(0x12e)]({'success':!![],'message':'Test\x20'+type+_0x2b4c4c(0x100)});}catch(_0x536f58){_0xf995c0(_0x536f58);}};}}exports[a12_0x34e7d6(0x10c)]=TelegramController;