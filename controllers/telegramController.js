'use strict';const a17_0x300622=a17_0x4106;(function(_0x3dbfbe,_0x539db5){const _0x2cd79b=a17_0x4106,_0x4e64d4=_0x3dbfbe();while(!![]){try{const _0x408748=parseInt(_0x2cd79b(0x13e))/0x1*(parseInt(_0x2cd79b(0x13d))/0x2)+-parseInt(_0x2cd79b(0x124))/0x3+-parseInt(_0x2cd79b(0x12f))/0x4+parseInt(_0x2cd79b(0x147))/0x5+-parseInt(_0x2cd79b(0x13f))/0x6+parseInt(_0x2cd79b(0x14e))/0x7*(parseInt(_0x2cd79b(0x11b))/0x8)+parseInt(_0x2cd79b(0x148))/0x9;if(_0x408748===_0x539db5)break;else _0x4e64d4['push'](_0x4e64d4['shift']());}catch(_0x20c3be){_0x4e64d4['push'](_0x4e64d4['shift']());}}}(a17_0x5171,0xcfb9b));function a17_0x5171(){const _0x2dbbc9=['amount','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','all','wallet','Test\x20Product','Test\x20Notification','telegramUser','details','Test\x20','sendBroadcast','firstName','findMany','1128154nfoOqQ','1vYKRHm','7570458LNCyFK','This\x20is\x20a\x20test\x20notification','username','json','Message\x20is\x20required','productName','Markdown','getBotInfo','5553335OgbGEw','4079916fcgucO','getBotStatus','TelegramController','default','createdAt','Broadcast\x20message\x20sent\x20successfully','35hJvJbQ','Shop\x20ID\x20is\x20required','params','__esModule','body','TRC20','Telegram\x20user\x20not\x20found','test_payout_123','isActive','sendTestNotification','test_payment_123','sendCustomNotification','updatedAt','\x20notification\x20sent\x20successfully','telegramBotService','disconnectUser','desc','sendPaymentNotification','filter','Shop\x20not\x20found','payment','true','2706184uvyJcT','getTelegramUsers','custom','sendShopNotification','count','shop','findUnique','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','map','1365762pTTVnG','defineProperty','status','update','telegramId','lastName','__importDefault','../services/telegramBotService','query','payout','title','5006372ZSNVYy','shopId'];a17_0x5171=function(){return _0x2dbbc9;};return a17_0x5171();}var __importDefault=this&&this[a17_0x300622(0x12a)]||function(_0x1b0b8c){const _0x8b9ecf=a17_0x300622;return _0x1b0b8c&&_0x1b0b8c[_0x8b9ecf(0x151)]?_0x1b0b8c:{'default':_0x1b0b8c};};function a17_0x4106(_0x1352a7,_0x92830b){_0x1352a7=_0x1352a7-0x110;const _0x51712e=a17_0x5171();let _0x41061c=_0x51712e[_0x1352a7];return _0x41061c;}Object[a17_0x300622(0x125)](exports,a17_0x300622(0x151),{'value':!![]}),exports[a17_0x300622(0x14a)]=void 0x0;const telegramBotService_1=require(a17_0x300622(0x12b)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x22e316=a17_0x300622;this[_0x22e316(0x149)]=async(_0x2f5065,_0x145a15,_0x21deff)=>{const _0x3a66e0=_0x22e316;try{const _0x5eaedc=telegramBotService_1[_0x3a66e0(0x113)][_0x3a66e0(0x146)](),_0x3809c9=await database_1['default'][_0x3a66e0(0x137)][_0x3a66e0(0x11f)](),_0x42a9e9=await database_1[_0x3a66e0(0x14b)][_0x3a66e0(0x137)][_0x3a66e0(0x11f)]({'where':{'isVerified':!![]}}),_0x1e0c37=await database_1[_0x3a66e0(0x14b)][_0x3a66e0(0x137)]['groupBy']({'by':[_0x3a66e0(0x130)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x145a15[_0x3a66e0(0x142)]({'success':!![],'result':{'bot':{'isActive':_0x5eaedc[_0x3a66e0(0x156)],'username':_0x5eaedc['username']},'statistics':{'totalUsers':_0x3809c9,'verifiedUsers':_0x42a9e9,'unverifiedUsers':_0x3809c9-_0x42a9e9,'connectedShops':_0x1e0c37['length']}}});}catch(_0x1ff21d){_0x21deff(_0x1ff21d);}},this[_0x22e316(0x11c)]=async(_0x46c7ee,_0x365d8d,_0x560d99)=>{const _0x2ad212=_0x22e316;try{const {page:page=0x1,limit:limit=0x14,verified:_0x246edb}=_0x46c7ee[_0x2ad212(0x12c)],_0x41b08a=(Number(page)-0x1)*Number(limit),_0x2ff833={};_0x246edb!==undefined&&(_0x2ff833['isVerified']=_0x246edb===_0x2ad212(0x11a));const [_0x5d2c1c,_0x3aefdb]=await Promise[_0x2ad212(0x133)]([database_1[_0x2ad212(0x14b)]['telegramUser'][_0x2ad212(0x13c)]({'where':_0x2ff833,'skip':_0x41b08a,'take':Number(limit),'orderBy':{'createdAt':_0x2ad212(0x115)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2ad212(0x14b)][_0x2ad212(0x137)][_0x2ad212(0x11f)]({'where':_0x2ff833})]);_0x365d8d['json']({'success':!![],'users':_0x5d2c1c[_0x2ad212(0x123)](_0x252cb2=>({'id':_0x252cb2['id'],'telegramId':_0x252cb2[_0x2ad212(0x128)],'username':_0x252cb2[_0x2ad212(0x141)],'firstName':_0x252cb2[_0x2ad212(0x13b)],'lastName':_0x252cb2[_0x2ad212(0x129)],'isVerified':_0x252cb2['isVerified'],'shop':_0x252cb2[_0x2ad212(0x120)],'createdAt':_0x252cb2[_0x2ad212(0x14c)],'updatedAt':_0x252cb2[_0x2ad212(0x111)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3aefdb,'totalPages':Math['ceil'](_0x3aefdb/Number(limit))}});}catch(_0x3b26e1){_0x560d99(_0x3b26e1);}},this[_0x22e316(0x13a)]=async(_0x18050e,_0x11112b,_0x56e0e7)=>{const _0x5a13be=_0x22e316;try{const {message:_0x244745,shopId:_0x1211c3}=_0x18050e[_0x5a13be(0x152)];if(!_0x244745)return _0x11112b[_0x5a13be(0x126)](0x190)['json']({'success':![],'message':_0x5a13be(0x143)});if(_0x1211c3)await telegramBotService_1[_0x5a13be(0x113)][_0x5a13be(0x11e)](_0x1211c3,_0x244745,{'parse_mode':_0x5a13be(0x145)});else{const _0x2aa1d5=await database_1['default'][_0x5a13be(0x137)][_0x5a13be(0x13c)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xd99fb0=[...new Set(_0x2aa1d5[_0x5a13be(0x123)](_0x11f4d9=>_0x11f4d9[_0x5a13be(0x130)])[_0x5a13be(0x117)](Boolean))];for(const _0x333b81 of _0xd99fb0){_0x333b81&&await telegramBotService_1[_0x5a13be(0x113)][_0x5a13be(0x11e)](_0x333b81,_0x244745,{'parse_mode':_0x5a13be(0x145)});}}_0x11112b[_0x5a13be(0x142)]({'success':!![],'message':_0x5a13be(0x14d)});}catch(_0x259317){_0x56e0e7(_0x259317);}},this[_0x22e316(0x114)]=async(_0x2d8fd2,_0x551087,_0x975eb2)=>{const _0x4984fa=_0x22e316;try{const {telegramId:_0x3d4b37}=_0x2d8fd2[_0x4984fa(0x150)],_0x41aefe=await database_1[_0x4984fa(0x14b)][_0x4984fa(0x137)][_0x4984fa(0x121)]({'where':{'telegramId':_0x3d4b37},'include':{'shop':!![]}});if(!_0x41aefe)return _0x551087[_0x4984fa(0x126)](0x194)[_0x4984fa(0x142)]({'success':![],'message':_0x4984fa(0x154)});await database_1['default'][_0x4984fa(0x137)][_0x4984fa(0x127)]({'where':{'telegramId':_0x3d4b37},'data':{'shopId':null,'isVerified':![]}}),_0x551087[_0x4984fa(0x142)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x231084){_0x975eb2(_0x231084);}},this[_0x22e316(0x157)]=async(_0x151210,_0x4bb436,_0x5e2208)=>{const _0x3ec784=_0x22e316;try{const {shopId:_0x54b5e3,type:type='payment',testData:_0x57ea5e}=_0x151210[_0x3ec784(0x152)];if(!_0x54b5e3)return _0x4bb436[_0x3ec784(0x126)](0x190)[_0x3ec784(0x142)]({'success':![],'message':_0x3ec784(0x14f)});const _0x233930=await database_1[_0x3ec784(0x14b)][_0x3ec784(0x120)][_0x3ec784(0x121)]({'where':{'id':_0x54b5e3},'select':{'id':!![],'name':!![]}});if(!_0x233930)return _0x4bb436[_0x3ec784(0x126)](0x194)[_0x3ec784(0x142)]({'success':![],'message':_0x3ec784(0x118)});switch(type){case _0x3ec784(0x119):const _0x8ca25e={'id':_0x3ec784(0x158),'amount':_0x57ea5e?.[_0x3ec784(0x131)]||0x64,'currency':_0x57ea5e?.['currency']||'USD','productName':_0x57ea5e?.[_0x3ec784(0x144)]||_0x3ec784(0x135),'gateway':_0x57ea5e?.['gateway']||'plisio','createdAt':new Date(),..._0x57ea5e};await telegramBotService_1[_0x3ec784(0x113)][_0x3ec784(0x116)](_0x54b5e3,_0x8ca25e,'paid');break;case _0x3ec784(0x12d):const _0x4f42bb={'id':_0x3ec784(0x155),'amount':_0x57ea5e?.[_0x3ec784(0x131)]||0x1f4,'network':_0x57ea5e?.['network']||_0x3ec784(0x153),'wallet':_0x57ea5e?.[_0x3ec784(0x134)]||_0x3ec784(0x132),'period':'Тестовый\x20период','createdAt':new Date(),'txid':_0x57ea5e?.['txid']||null,..._0x57ea5e};await telegramBotService_1[_0x3ec784(0x113)]['sendPayoutNotification'](_0x54b5e3,_0x4f42bb);break;case _0x3ec784(0x11d):await telegramBotService_1[_0x3ec784(0x113)][_0x3ec784(0x110)](_0x54b5e3,_0x57ea5e?.[_0x3ec784(0x12e)]||_0x3ec784(0x136),_0x57ea5e?.[_0x3ec784(0x138)]||{'message':_0x3ec784(0x140)});break;default:return _0x4bb436[_0x3ec784(0x126)](0x190)[_0x3ec784(0x142)]({'success':![],'message':_0x3ec784(0x122)});}_0x4bb436['json']({'success':!![],'message':_0x3ec784(0x139)+type+_0x3ec784(0x112)});}catch(_0x22d1f5){_0x5e2208(_0x22d1f5);}};}}exports[a17_0x300622(0x14a)]=TelegramController;