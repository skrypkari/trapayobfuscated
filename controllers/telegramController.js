'use strict';const a12_0x438f84=a12_0x39fd;(function(_0x303a3e,_0x5e7e2f){const _0x3a14f3=a12_0x39fd,_0x203124=_0x303a3e();while(!![]){try{const _0x22d43e=parseInt(_0x3a14f3(0xb9))/0x1*(parseInt(_0x3a14f3(0xc2))/0x2)+-parseInt(_0x3a14f3(0x95))/0x3*(-parseInt(_0x3a14f3(0x8c))/0x4)+parseInt(_0x3a14f3(0xaa))/0x5+-parseInt(_0x3a14f3(0x8d))/0x6+-parseInt(_0x3a14f3(0xb7))/0x7+-parseInt(_0x3a14f3(0xa2))/0x8*(-parseInt(_0x3a14f3(0xc6))/0x9)+-parseInt(_0x3a14f3(0xad))/0xa*(parseInt(_0x3a14f3(0x86))/0xb);if(_0x22d43e===_0x5e7e2f)break;else _0x203124['push'](_0x203124['shift']());}catch(_0x1c9b56){_0x203124['push'](_0x203124['shift']());}}}(a12_0x3ada,0xa79bd));function a12_0x3ada(){const _0x38141e=['disconnectUser','createdAt','bank_transfer','Shop\x20ID\x20is\x20required','shop','sendBroadcast','findMany','2mKJWIw','body','isVerified','__esModule','81RhKDYA','amount','This\x20is\x20a\x20test\x20notification','telegramUser','plisio','29768805jOvDbZ','details','firstName','username','telegramBotService','method','344SAmWiB','3389862CBeEUE','payout','true','sendTestNotification','params','count','TelegramController','test_payout_123','28881ffuhaI','sendPaymentNotification','Markdown','sendShopNotification','title','Test\x20Notification','getBotInfo','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','filter','status','json','default','map','1171304xREvkd','isActive','query','ceil','Shop\x20not\x20found','test_payment_123','lastName','Telegram\x20user\x20not\x20found','6798515IthNrR','currency','payment','10woalnq','paid','Message\x20is\x20required','findUnique','Broadcast\x20message\x20sent\x20successfully','../config/database','defineProperty','getTelegramUsers','gateway','User\x20disconnected\x20successfully','5892418mqtMwa','sendPayoutNotification','1294189YsYLLo','shopId'];a12_0x3ada=function(){return _0x38141e;};return a12_0x3ada();}function a12_0x39fd(_0x37a682,_0x571fc5){const _0x3ada60=a12_0x3ada();return a12_0x39fd=function(_0x39fdcc,_0x5546bb){_0x39fdcc=_0x39fdcc-0x85;let _0x3f89ff=_0x3ada60[_0x39fdcc];return _0x3f89ff;},a12_0x39fd(_0x37a682,_0x571fc5);}var __importDefault=this&&this['__importDefault']||function(_0x46a978){const _0x43ecd7=a12_0x39fd;return _0x46a978&&_0x46a978[_0x43ecd7(0xc5)]?_0x46a978:{'default':_0x46a978};};Object[a12_0x438f84(0xb3)](exports,a12_0x438f84(0xc5),{'value':!![]}),exports[a12_0x438f84(0x93)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x438f84(0xb2)));class TelegramController{constructor(){const _0x568e9a=a12_0x438f84;this['getBotStatus']=async(_0x4c801a,_0x16230d,_0x2abc3e)=>{const _0x4b8bf0=a12_0x39fd;try{const _0x5ef0d4=telegramBotService_1[_0x4b8bf0(0x8a)][_0x4b8bf0(0x9b)](),_0x22000f=await database_1[_0x4b8bf0(0xa0)]['telegramUser'][_0x4b8bf0(0x92)](),_0x2eed88=await database_1['default'][_0x4b8bf0(0xc9)][_0x4b8bf0(0x92)]({'where':{'isVerified':!![]}}),_0x1d038c=await database_1[_0x4b8bf0(0xa0)][_0x4b8bf0(0xc9)]['groupBy']({'by':[_0x4b8bf0(0xba)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x16230d[_0x4b8bf0(0x9f)]({'success':!![],'result':{'bot':{'isActive':_0x5ef0d4[_0x4b8bf0(0xa3)],'username':_0x5ef0d4[_0x4b8bf0(0x89)]},'statistics':{'totalUsers':_0x22000f,'verifiedUsers':_0x2eed88,'unverifiedUsers':_0x22000f-_0x2eed88,'connectedShops':_0x1d038c['length']}}});}catch(_0x32812b){_0x2abc3e(_0x32812b);}},this[_0x568e9a(0xb4)]=async(_0x1b0331,_0x478d41,_0x3b80e3)=>{const _0x292238=_0x568e9a;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4d73f6}=_0x1b0331[_0x292238(0xa4)],_0x4aaa12=(Number(page)-0x1)*Number(limit),_0x122484={};_0x4d73f6!==undefined&&(_0x122484[_0x292238(0xc4)]=_0x4d73f6===_0x292238(0x8f));const [_0x82834d,_0x3a5abc]=await Promise['all']([database_1[_0x292238(0xa0)][_0x292238(0xc9)][_0x292238(0xc1)]({'where':_0x122484,'skip':_0x4aaa12,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x292238(0xa0)][_0x292238(0xc9)]['count']({'where':_0x122484})]);_0x478d41['json']({'success':!![],'users':_0x82834d[_0x292238(0xa1)](_0x28fed6=>({'id':_0x28fed6['id'],'telegramId':_0x28fed6['telegramId'],'username':_0x28fed6['username'],'firstName':_0x28fed6[_0x292238(0x88)],'lastName':_0x28fed6[_0x292238(0xa8)],'isVerified':_0x28fed6[_0x292238(0xc4)],'shop':_0x28fed6[_0x292238(0xbf)],'createdAt':_0x28fed6[_0x292238(0xbc)],'updatedAt':_0x28fed6['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3a5abc,'totalPages':Math[_0x292238(0xa5)](_0x3a5abc/Number(limit))}});}catch(_0x2ee7d7){_0x3b80e3(_0x2ee7d7);}},this[_0x568e9a(0xc0)]=async(_0x1f24c5,_0x5e7a85,_0x4b178e)=>{const _0x32ed7c=_0x568e9a;try{const {message:_0x3f1bb3,shopId:_0x593830}=_0x1f24c5['body'];if(!_0x3f1bb3)return _0x5e7a85[_0x32ed7c(0x9e)](0x190)[_0x32ed7c(0x9f)]({'success':![],'message':_0x32ed7c(0xaf)});if(_0x593830)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x593830,_0x3f1bb3,{'parse_mode':'Markdown'});else{const _0x165a47=await database_1[_0x32ed7c(0xa0)][_0x32ed7c(0xc9)][_0x32ed7c(0xc1)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x292072=[...new Set(_0x165a47[_0x32ed7c(0xa1)](_0x34e7bf=>_0x34e7bf[_0x32ed7c(0xba)])[_0x32ed7c(0x9d)](Boolean))];for(const _0x4bfbd9 of _0x292072){_0x4bfbd9&&await telegramBotService_1[_0x32ed7c(0x8a)][_0x32ed7c(0x98)](_0x4bfbd9,_0x3f1bb3,{'parse_mode':_0x32ed7c(0x97)});}}_0x5e7a85[_0x32ed7c(0x9f)]({'success':!![],'message':_0x32ed7c(0xb1)});}catch(_0x55fcdc){_0x4b178e(_0x55fcdc);}},this[_0x568e9a(0xbb)]=async(_0x570c80,_0x421be7,_0x1930dd)=>{const _0x53230e=_0x568e9a;try{const {telegramId:_0x2d3460}=_0x570c80[_0x53230e(0x91)],_0x244acb=await database_1[_0x53230e(0xa0)]['telegramUser'][_0x53230e(0xb0)]({'where':{'telegramId':_0x2d3460},'include':{'shop':!![]}});if(!_0x244acb)return _0x421be7['status'](0x194)[_0x53230e(0x9f)]({'success':![],'message':_0x53230e(0xa9)});await database_1['default'][_0x53230e(0xc9)]['update']({'where':{'telegramId':_0x2d3460},'data':{'shopId':null,'isVerified':![]}}),_0x421be7[_0x53230e(0x9f)]({'success':!![],'message':_0x53230e(0xb6)});}catch(_0x45ee56){_0x1930dd(_0x45ee56);}},this[_0x568e9a(0x90)]=async(_0x5d25e7,_0x127d23,_0x8b1e23)=>{const _0x475444=_0x568e9a;try{const {shopId:_0x1403b4,type:type='payment',testData:_0x57f114}=_0x5d25e7[_0x475444(0xc3)];if(!_0x1403b4)return _0x127d23[_0x475444(0x9e)](0x190)[_0x475444(0x9f)]({'success':![],'message':_0x475444(0xbe)});const _0x507721=await database_1[_0x475444(0xa0)]['shop'][_0x475444(0xb0)]({'where':{'id':_0x1403b4},'select':{'id':!![],'name':!![]}});if(!_0x507721)return _0x127d23[_0x475444(0x9e)](0x194)['json']({'success':![],'message':_0x475444(0xa6)});switch(type){case _0x475444(0xac):const _0x352653={'id':_0x475444(0xa7),'amount':_0x57f114?.[_0x475444(0xc7)]||0x64,'currency':_0x57f114?.[_0x475444(0xab)]||'USD','productName':_0x57f114?.['productName']||'Test\x20Product','gateway':_0x57f114?.[_0x475444(0xb5)]||_0x475444(0x85),'createdAt':new Date(),..._0x57f114};await telegramBotService_1[_0x475444(0x8a)][_0x475444(0x96)](_0x1403b4,_0x352653,_0x475444(0xae));break;case _0x475444(0x8e):const _0x5e8b43={'id':_0x475444(0x94),'amount':_0x57f114?.[_0x475444(0xc7)]||0x1f4,'method':_0x57f114?.[_0x475444(0x8b)]||_0x475444(0xbd),'createdAt':new Date(),..._0x57f114};await telegramBotService_1[_0x475444(0x8a)][_0x475444(0xb8)](_0x1403b4,_0x5e8b43,'completed');break;case'custom':await telegramBotService_1[_0x475444(0x8a)]['sendCustomNotification'](_0x1403b4,_0x57f114?.[_0x475444(0x99)]||_0x475444(0x9a),_0x57f114?.[_0x475444(0x87)]||{'message':_0x475444(0xc8)});break;default:return _0x127d23[_0x475444(0x9e)](0x190)[_0x475444(0x9f)]({'success':![],'message':_0x475444(0x9c)});}_0x127d23[_0x475444(0x9f)]({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x104c05){_0x8b1e23(_0x104c05);}};}}exports['TelegramController']=TelegramController;