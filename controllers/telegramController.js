'use strict';function a18_0x1e1a(){const _0x29a59a=['Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','map','status','__importDefault','sendBroadcast','Broadcast\x20message\x20sent\x20successfully','sendPaymentNotification','count','416563rdlztx','txid','Test\x20Notification','832868Bakfok','getTelegramUsers','all','groupBy','sendTestNotification','TRC20','6AEqJfd','135rROYBN','custom','firstName','desc','query','Shop\x20ID\x20is\x20required','amount','Shop\x20not\x20found','Message\x20is\x20required','update','isVerified','Test\x20Product','telegramBotService','../config/database','length','Test\x20','plisio','default','json','sendPayoutNotification','defineProperty','gateway','createdAt','body','152488vrZdwb','Тестовый\x20период','shop','disconnectUser','payout','sendShopNotification','getBotStatus','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','2471920cuAdBf','Markdown','getBotInfo','This\x20is\x20a\x20test\x20notification','isActive','TelegramController','details','__esModule','productName','findMany','updatedAt','USD','\x20notification\x20sent\x20successfully','paid','shopId','username','test_payout_123','569278AeJMpf','125970nNRpqU','172694HrkRHz','telegramUser','sendCustomNotification','true','findUnique','5PRnMJu','payment','Telegram\x20user\x20not\x20found'];a18_0x1e1a=function(){return _0x29a59a;};return a18_0x1e1a();}function a18_0x21a5(_0x4d8a80,_0x10c1cd){_0x4d8a80=_0x4d8a80-0x1db;const _0x1e1a66=a18_0x1e1a();let _0x21a552=_0x1e1a66[_0x4d8a80];return _0x21a552;}const a18_0x102a69=a18_0x21a5;(function(_0x117181,_0x3a0424){const _0x81d390=a18_0x21a5,_0x374970=_0x117181();while(!![]){try{const _0x4ea252=parseInt(_0x81d390(0x1ed))/0x1+-parseInt(_0x81d390(0x1eb))/0x2+parseInt(_0x81d390(0x1ec))/0x3+-parseInt(_0x81d390(0x200))/0x4*(-parseInt(_0x81d390(0x1f2))/0x5)+parseInt(_0x81d390(0x206))/0x6*(parseInt(_0x81d390(0x1fd))/0x7)+-parseInt(_0x81d390(0x21f))/0x8*(parseInt(_0x81d390(0x207))/0x9)+parseInt(_0x81d390(0x227))/0xa;if(_0x4ea252===_0x3a0424)break;else _0x374970['push'](_0x374970['shift']());}catch(_0x1e6794){_0x374970['push'](_0x374970['shift']());}}}(a18_0x1e1a,0x26d48));var __importDefault=this&&this[a18_0x102a69(0x1f8)]||function(_0x2b1fc1){const _0x316494=a18_0x102a69;return _0x2b1fc1&&_0x2b1fc1[_0x316494(0x1e1)]?_0x2b1fc1:{'default':_0x2b1fc1};};Object[a18_0x102a69(0x21b)](exports,a18_0x102a69(0x1e1),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a18_0x102a69(0x214)));class TelegramController{constructor(){const _0x4ef129=a18_0x102a69;this[_0x4ef129(0x225)]=async(_0x34fae4,_0x2d4850,_0x3b9dec)=>{const _0x155e56=_0x4ef129;try{const _0x356eae=telegramBotService_1[_0x155e56(0x213)][_0x155e56(0x1dc)](),_0x50852d=await database_1[_0x155e56(0x218)][_0x155e56(0x1ee)][_0x155e56(0x1fc)](),_0x5129f9=await database_1['default'][_0x155e56(0x1ee)]['count']({'where':{'isVerified':!![]}}),_0xba7ca1=await database_1['default'][_0x155e56(0x1ee)][_0x155e56(0x203)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2d4850[_0x155e56(0x219)]({'success':!![],'result':{'bot':{'isActive':_0x356eae[_0x155e56(0x1de)],'username':_0x356eae['username']},'statistics':{'totalUsers':_0x50852d,'verifiedUsers':_0x5129f9,'unverifiedUsers':_0x50852d-_0x5129f9,'connectedShops':_0xba7ca1[_0x155e56(0x215)]}}});}catch(_0x34a5f3){_0x3b9dec(_0x34a5f3);}},this[_0x4ef129(0x201)]=async(_0x324767,_0xfe0d47,_0x860eaf)=>{const _0x222a6a=_0x4ef129;try{const {page:page=0x1,limit:limit=0x14,verified:_0xbc5b03}=_0x324767[_0x222a6a(0x20b)],_0x4b5d98=(Number(page)-0x1)*Number(limit),_0x2847b7={};_0xbc5b03!==undefined&&(_0x2847b7[_0x222a6a(0x211)]=_0xbc5b03===_0x222a6a(0x1f0));const [_0x21f049,_0x5acf6d]=await Promise[_0x222a6a(0x202)]([database_1['default'][_0x222a6a(0x1ee)][_0x222a6a(0x1e3)]({'where':_0x2847b7,'skip':_0x4b5d98,'take':Number(limit),'orderBy':{'createdAt':_0x222a6a(0x20a)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x222a6a(0x218)][_0x222a6a(0x1ee)][_0x222a6a(0x1fc)]({'where':_0x2847b7})]);_0xfe0d47[_0x222a6a(0x219)]({'success':!![],'users':_0x21f049['map'](_0x3cb2af=>({'id':_0x3cb2af['id'],'telegramId':_0x3cb2af['telegramId'],'username':_0x3cb2af[_0x222a6a(0x1e9)],'firstName':_0x3cb2af[_0x222a6a(0x209)],'lastName':_0x3cb2af['lastName'],'isVerified':_0x3cb2af[_0x222a6a(0x211)],'shop':_0x3cb2af[_0x222a6a(0x221)],'createdAt':_0x3cb2af[_0x222a6a(0x21d)],'updatedAt':_0x3cb2af[_0x222a6a(0x1e4)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5acf6d,'totalPages':Math['ceil'](_0x5acf6d/Number(limit))}});}catch(_0x5b0861){_0x860eaf(_0x5b0861);}},this[_0x4ef129(0x1f9)]=async(_0x352a11,_0x190b3a,_0x3053d7)=>{const _0x451fce=_0x4ef129;try{const {message:_0x4037f4,shopId:_0x9e9051}=_0x352a11[_0x451fce(0x21e)];if(!_0x4037f4)return _0x190b3a[_0x451fce(0x1f7)](0x190)[_0x451fce(0x219)]({'success':![],'message':_0x451fce(0x20f)});if(_0x9e9051)await telegramBotService_1[_0x451fce(0x213)][_0x451fce(0x224)](_0x9e9051,_0x4037f4,{'parse_mode':_0x451fce(0x1db)});else{const _0x484c6d=await database_1[_0x451fce(0x218)]['telegramUser'][_0x451fce(0x1e3)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5eb428=[...new Set(_0x484c6d[_0x451fce(0x1f6)](_0x3802ff=>_0x3802ff[_0x451fce(0x1e8)])['filter'](Boolean))];for(const _0xa6f90a of _0x5eb428){_0xa6f90a&&await telegramBotService_1[_0x451fce(0x213)][_0x451fce(0x224)](_0xa6f90a,_0x4037f4,{'parse_mode':_0x451fce(0x1db)});}}_0x190b3a[_0x451fce(0x219)]({'success':!![],'message':_0x451fce(0x1fa)});}catch(_0x18a5e9){_0x3053d7(_0x18a5e9);}},this[_0x4ef129(0x222)]=async(_0x28359a,_0x4f94ac,_0x58d953)=>{const _0x546d08=_0x4ef129;try{const {telegramId:_0x4e5afc}=_0x28359a['params'],_0x29bef9=await database_1['default'][_0x546d08(0x1ee)]['findUnique']({'where':{'telegramId':_0x4e5afc},'include':{'shop':!![]}});if(!_0x29bef9)return _0x4f94ac[_0x546d08(0x1f7)](0x194)[_0x546d08(0x219)]({'success':![],'message':_0x546d08(0x1f4)});await database_1[_0x546d08(0x218)]['telegramUser'][_0x546d08(0x210)]({'where':{'telegramId':_0x4e5afc},'data':{'shopId':null,'isVerified':![]}}),_0x4f94ac[_0x546d08(0x219)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x173eb7){_0x58d953(_0x173eb7);}},this[_0x4ef129(0x204)]=async(_0x5d9268,_0xa1ca1f,_0x21360d)=>{const _0x302e09=_0x4ef129;try{const {shopId:_0x392dfa,type:type='payment',testData:_0x3f0c72}=_0x5d9268[_0x302e09(0x21e)];if(!_0x392dfa)return _0xa1ca1f[_0x302e09(0x1f7)](0x190)[_0x302e09(0x219)]({'success':![],'message':_0x302e09(0x20c)});const _0x5700e2=await database_1['default'][_0x302e09(0x221)][_0x302e09(0x1f1)]({'where':{'id':_0x392dfa},'select':{'id':!![],'name':!![]}});if(!_0x5700e2)return _0xa1ca1f[_0x302e09(0x1f7)](0x194)[_0x302e09(0x219)]({'success':![],'message':_0x302e09(0x20e)});switch(type){case _0x302e09(0x1f3):const _0x520f25={'id':'test_payment_123','amount':_0x3f0c72?.[_0x302e09(0x20d)]||0x64,'currency':_0x3f0c72?.['currency']||_0x302e09(0x1e5),'productName':_0x3f0c72?.[_0x302e09(0x1e2)]||_0x302e09(0x212),'gateway':_0x3f0c72?.[_0x302e09(0x21c)]||_0x302e09(0x217),'createdAt':new Date(),..._0x3f0c72};await telegramBotService_1[_0x302e09(0x213)][_0x302e09(0x1fb)](_0x392dfa,_0x520f25,_0x302e09(0x1e7));break;case _0x302e09(0x223):const _0x4307fa={'id':_0x302e09(0x1ea),'amount':_0x3f0c72?.['amount']||0x1f4,'network':_0x3f0c72?.['network']||_0x302e09(0x205),'wallet':_0x3f0c72?.['wallet']||_0x302e09(0x226),'period':_0x302e09(0x220),'createdAt':new Date(),'txid':_0x3f0c72?.[_0x302e09(0x1fe)]||null,..._0x3f0c72};await telegramBotService_1['telegramBotService'][_0x302e09(0x21a)](_0x392dfa,_0x4307fa);break;case _0x302e09(0x208):await telegramBotService_1[_0x302e09(0x213)][_0x302e09(0x1ef)](_0x392dfa,_0x3f0c72?.['title']||_0x302e09(0x1ff),_0x3f0c72?.[_0x302e09(0x1e0)]||{'message':_0x302e09(0x1dd)});break;default:return _0xa1ca1f[_0x302e09(0x1f7)](0x190)['json']({'success':![],'message':_0x302e09(0x1f5)});}_0xa1ca1f['json']({'success':!![],'message':_0x302e09(0x216)+type+_0x302e09(0x1e6)});}catch(_0x39c2ac){_0x21360d(_0x39c2ac);}};}}exports[a18_0x102a69(0x1df)]=TelegramController;