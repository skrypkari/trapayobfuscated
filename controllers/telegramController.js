'use strict';function a12_0xd637(){const _0x122eb4=['USD','default','status','sendShopNotification','shopId','125044fFIFgX','6769ZsbUzS','sendPaymentNotification','lastName','updatedAt','json','count','firstName','method','length','getBotStatus','title','findUnique','isActive','../services/telegramBotService','Shop\x20not\x20found','User\x20disconnected\x20successfully','sendTestNotification','isVerified','30tDkvTW','query','../config/database','Test\x20Product','gateway','This\x20is\x20a\x20test\x20notification','sendBroadcast','plisio','payment','telegramUser','518073ZUxwTZ','shop','Message\x20is\x20required','18781ponaeV','details','groupBy','completed','disconnectUser','test_payment_123','261488sgeKNv','desc','params','TelegramController','486431kChwzu','productName','defineProperty','custom','map','username','6durSEL','telegramBotService','getBotInfo','test_payout_123','Markdown','all','Broadcast\x20message\x20sent\x20successfully','Telegram\x20user\x20not\x20found','amount','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Shop\x20ID\x20is\x20required','107838FQUTHw','54TGgBce','sendCustomNotification','body','bank_transfer','__esModule','\x20notification\x20sent\x20successfully','update','5LorGuS','payout','getTelegramUsers'];a12_0xd637=function(){return _0x122eb4;};return a12_0xd637();}const a12_0x3cbf9f=a12_0x4b25;(function(_0x3d4443,_0x2fdc3c){const _0x2458fd=a12_0x4b25,_0x1f5b22=_0x3d4443();while(!![]){try{const _0x15dd6d=parseInt(_0x2458fd(0x124))/0x1*(parseInt(_0x2458fd(0x134))/0x2)+parseInt(_0x2458fd(0x121))/0x3+parseInt(_0x2458fd(0x104))/0x4*(-parseInt(_0x2458fd(0xfc))/0x5)+-parseInt(_0x2458fd(0xf5))/0x6*(parseInt(_0x2458fd(0x105))/0x7)+parseInt(_0x2458fd(0x12a))/0x8+parseInt(_0x2458fd(0xf4))/0x9+parseInt(_0x2458fd(0x117))/0xa*(-parseInt(_0x2458fd(0x12e))/0xb);if(_0x15dd6d===_0x2fdc3c)break;else _0x1f5b22['push'](_0x1f5b22['shift']());}catch(_0x30c160){_0x1f5b22['push'](_0x1f5b22['shift']());}}}(a12_0xd637,0x18ad3));function a12_0x4b25(_0x46f380,_0x24e731){const _0xd63779=a12_0xd637();return a12_0x4b25=function(_0x4b25ed,_0x564312){_0x4b25ed=_0x4b25ed-0xf0;let _0x2c6b38=_0xd63779[_0x4b25ed];return _0x2c6b38;},a12_0x4b25(_0x46f380,_0x24e731);}var __importDefault=this&&this['__importDefault']||function(_0x141d2f){const _0x2b964b=a12_0x4b25;return _0x141d2f&&_0x141d2f[_0x2b964b(0xf9)]?_0x141d2f:{'default':_0x141d2f};};Object[a12_0x3cbf9f(0x130)](exports,'__esModule',{'value':!![]}),exports[a12_0x3cbf9f(0x12d)]=void 0x0;const telegramBotService_1=require(a12_0x3cbf9f(0x112)),database_1=__importDefault(require(a12_0x3cbf9f(0x119)));class TelegramController{constructor(){const _0x521074=a12_0x3cbf9f;this[_0x521074(0x10e)]=async(_0x19176d,_0x2ae5cb,_0x3b635f)=>{const _0x4d2fc5=_0x521074;try{const _0x2eca02=telegramBotService_1[_0x4d2fc5(0x135)][_0x4d2fc5(0x136)](),_0x41d473=await database_1[_0x4d2fc5(0x100)]['telegramUser'][_0x4d2fc5(0x10a)](),_0xb79b85=await database_1['default'][_0x4d2fc5(0x120)]['count']({'where':{'isVerified':!![]}}),_0x549ba1=await database_1[_0x4d2fc5(0x100)]['telegramUser'][_0x4d2fc5(0x126)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2ae5cb[_0x4d2fc5(0x109)]({'success':!![],'result':{'bot':{'isActive':_0x2eca02[_0x4d2fc5(0x111)],'username':_0x2eca02['username']},'statistics':{'totalUsers':_0x41d473,'verifiedUsers':_0xb79b85,'unverifiedUsers':_0x41d473-_0xb79b85,'connectedShops':_0x549ba1[_0x4d2fc5(0x10d)]}}});}catch(_0x2b78d8){_0x3b635f(_0x2b78d8);}},this[_0x521074(0xfe)]=async(_0x48a25a,_0x93f46e,_0x59885e)=>{const _0x37102c=_0x521074;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5171a4}=_0x48a25a[_0x37102c(0x118)],_0x25c0a2=(Number(page)-0x1)*Number(limit),_0x3e03b4={};_0x5171a4!==undefined&&(_0x3e03b4['isVerified']=_0x5171a4==='true');const [_0x336270,_0x1a9bf4]=await Promise[_0x37102c(0x139)]([database_1[_0x37102c(0x100)][_0x37102c(0x120)]['findMany']({'where':_0x3e03b4,'skip':_0x25c0a2,'take':Number(limit),'orderBy':{'createdAt':_0x37102c(0x12b)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x37102c(0x120)][_0x37102c(0x10a)]({'where':_0x3e03b4})]);_0x93f46e[_0x37102c(0x109)]({'success':!![],'users':_0x336270[_0x37102c(0x132)](_0x101606=>({'id':_0x101606['id'],'telegramId':_0x101606['telegramId'],'username':_0x101606[_0x37102c(0x133)],'firstName':_0x101606[_0x37102c(0x10b)],'lastName':_0x101606[_0x37102c(0x107)],'isVerified':_0x101606[_0x37102c(0x116)],'shop':_0x101606[_0x37102c(0x122)],'createdAt':_0x101606['createdAt'],'updatedAt':_0x101606[_0x37102c(0x108)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1a9bf4,'totalPages':Math['ceil'](_0x1a9bf4/Number(limit))}});}catch(_0xde0256){_0x59885e(_0xde0256);}},this[_0x521074(0x11d)]=async(_0x47fb6e,_0x5e8d75,_0x81e553)=>{const _0x4744fc=_0x521074;try{const {message:_0x571086,shopId:_0x575625}=_0x47fb6e[_0x4744fc(0xf7)];if(!_0x571086)return _0x5e8d75[_0x4744fc(0x101)](0x190)[_0x4744fc(0x109)]({'success':![],'message':_0x4744fc(0x123)});if(_0x575625)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x575625,_0x571086,{'parse_mode':_0x4744fc(0x138)});else{const _0xb696aa=await database_1['default']['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3afc51=[...new Set(_0xb696aa['map'](_0x4f074a=>_0x4f074a[_0x4744fc(0x103)])['filter'](Boolean))];for(const _0x408d41 of _0x3afc51){_0x408d41&&await telegramBotService_1['telegramBotService'][_0x4744fc(0x102)](_0x408d41,_0x571086,{'parse_mode':_0x4744fc(0x138)});}}_0x5e8d75['json']({'success':!![],'message':_0x4744fc(0x13a)});}catch(_0x4c3744){_0x81e553(_0x4c3744);}},this[_0x521074(0x128)]=async(_0x1db2ae,_0x40b31e,_0x135241)=>{const _0x150691=_0x521074;try{const {telegramId:_0x2fdfeb}=_0x1db2ae[_0x150691(0x12c)],_0x4af3b7=await database_1['default'][_0x150691(0x120)][_0x150691(0x110)]({'where':{'telegramId':_0x2fdfeb},'include':{'shop':!![]}});if(!_0x4af3b7)return _0x40b31e[_0x150691(0x101)](0x194)[_0x150691(0x109)]({'success':![],'message':_0x150691(0xf0)});await database_1['default'][_0x150691(0x120)][_0x150691(0xfb)]({'where':{'telegramId':_0x2fdfeb},'data':{'shopId':null,'isVerified':![]}}),_0x40b31e['json']({'success':!![],'message':_0x150691(0x114)});}catch(_0x42487e){_0x135241(_0x42487e);}},this[_0x521074(0x115)]=async(_0x21899f,_0x3476ae,_0x5bec19)=>{const _0x4f2762=_0x521074;try{const {shopId:_0x3c4cb6,type:type=_0x4f2762(0x11f),testData:_0x2d138c}=_0x21899f[_0x4f2762(0xf7)];if(!_0x3c4cb6)return _0x3476ae[_0x4f2762(0x101)](0x190)[_0x4f2762(0x109)]({'success':![],'message':_0x4f2762(0xf3)});const _0x51e1c6=await database_1[_0x4f2762(0x100)][_0x4f2762(0x122)][_0x4f2762(0x110)]({'where':{'id':_0x3c4cb6},'select':{'id':!![],'name':!![]}});if(!_0x51e1c6)return _0x3476ae[_0x4f2762(0x101)](0x194)[_0x4f2762(0x109)]({'success':![],'message':_0x4f2762(0x113)});switch(type){case _0x4f2762(0x11f):const _0x46dd4f={'id':_0x4f2762(0x129),'amount':_0x2d138c?.[_0x4f2762(0xf1)]||0x64,'currency':_0x2d138c?.['currency']||_0x4f2762(0xff),'productName':_0x2d138c?.[_0x4f2762(0x12f)]||_0x4f2762(0x11a),'gateway':_0x2d138c?.[_0x4f2762(0x11b)]||_0x4f2762(0x11e),'createdAt':new Date(),..._0x2d138c};await telegramBotService_1[_0x4f2762(0x135)][_0x4f2762(0x106)](_0x3c4cb6,_0x46dd4f,'paid');break;case _0x4f2762(0xfd):const _0x358c5d={'id':_0x4f2762(0x137),'amount':_0x2d138c?.['amount']||0x1f4,'method':_0x2d138c?.[_0x4f2762(0x10c)]||_0x4f2762(0xf8),'createdAt':new Date(),..._0x2d138c};await telegramBotService_1[_0x4f2762(0x135)]['sendPayoutNotification'](_0x3c4cb6,_0x358c5d,_0x4f2762(0x127));break;case _0x4f2762(0x131):await telegramBotService_1[_0x4f2762(0x135)][_0x4f2762(0xf6)](_0x3c4cb6,_0x2d138c?.[_0x4f2762(0x10f)]||'Test\x20Notification',_0x2d138c?.[_0x4f2762(0x125)]||{'message':_0x4f2762(0x11c)});break;default:return _0x3476ae['status'](0x190)[_0x4f2762(0x109)]({'success':![],'message':_0x4f2762(0xf2)});}_0x3476ae['json']({'success':!![],'message':'Test\x20'+type+_0x4f2762(0xfa)});}catch(_0x1b7481){_0x5bec19(_0x1b7481);}};}}exports[a12_0x3cbf9f(0x12d)]=TelegramController;