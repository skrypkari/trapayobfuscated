'use strict';function a14_0x14ca(){const _0x244071=['sendBroadcast','getTelegramUsers','title','json','gateway','length','136EQlWzw','30VqdfFC','63099FuFMPc','currency','telegramBotService','User\x20disconnected\x20successfully','USD','bank_transfer','desc','default','Telegram\x20user\x20not\x20found','test_payment_123','TelegramController','firstName','findMany','updatedAt','test_payout_123','3254995OvNyBH','paid','3044448DwfSSV','../config/database','lastName','defineProperty','params','981456ktWzwB','telegramId','isVerified','2052237WlbNGt','isActive','1343321KeGerz','108sNvdfT','telegramUser','__esModule','completed','count','map','getBotInfo','amount','sendPayoutNotification','sendPaymentNotification','plisio','getBotStatus','sendShopNotification','username','Markdown','disconnectUser','filter','Test\x20Product','Test\x20','payment','method','body','createdAt','24YWdpTC','details','all','payout','Shop\x20not\x20found','update','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','query','898609NJaZdW','Test\x20Notification','ceil','shopId','status','This\x20is\x20a\x20test\x20notification','__importDefault'];a14_0x14ca=function(){return _0x244071;};return a14_0x14ca();}function a14_0x1a54(_0x296b35,_0x383a0a){const _0x14ca5c=a14_0x14ca();return a14_0x1a54=function(_0x1a5438,_0x1ecbe1){_0x1a5438=_0x1a5438-0x146;let _0xf88684=_0x14ca5c[_0x1a5438];return _0xf88684;},a14_0x1a54(_0x296b35,_0x383a0a);}const a14_0x4bfdbc=a14_0x1a54;(function(_0x3847e2,_0x22f2cb){const _0x3fce31=a14_0x1a54,_0x4aa50d=_0x3847e2();while(!![]){try{const _0x3a749e=-parseInt(_0x3fce31(0x153))/0x1+parseInt(_0x3fce31(0x173))/0x2+parseInt(_0x3fce31(0x162))/0x3*(parseInt(_0x3fce31(0x160))/0x4)+-parseInt(_0x3fce31(0x171))/0x5+parseInt(_0x3fce31(0x14b))/0x6*(-parseInt(_0x3fce31(0x17d))/0x7)+-parseInt(_0x3fce31(0x178))/0x8*(-parseInt(_0x3fce31(0x17e))/0x9)+-parseInt(_0x3fce31(0x161))/0xa*(parseInt(_0x3fce31(0x17b))/0xb);if(_0x3a749e===_0x22f2cb)break;else _0x4aa50d['push'](_0x4aa50d['shift']());}catch(_0x162fa5){_0x4aa50d['push'](_0x4aa50d['shift']());}}}(a14_0x14ca,0xcb461));var __importDefault=this&&this[a14_0x4bfdbc(0x159)]||function(_0x2936fb){const _0xf679e7=a14_0x4bfdbc;return _0x2936fb&&_0x2936fb[_0xf679e7(0x180)]?_0x2936fb:{'default':_0x2936fb};};Object[a14_0x4bfdbc(0x176)](exports,a14_0x4bfdbc(0x180),{'value':!![]}),exports[a14_0x4bfdbc(0x16c)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a14_0x4bfdbc(0x174)));class TelegramController{constructor(){const _0x10dc26=a14_0x4bfdbc;this[_0x10dc26(0x189)]=async(_0x36fa4e,_0x530186,_0x3cef84)=>{const _0x4fa2c3=_0x10dc26;try{const _0xf6f201=telegramBotService_1['telegramBotService'][_0x4fa2c3(0x184)](),_0x3812f3=await database_1['default'][_0x4fa2c3(0x17f)][_0x4fa2c3(0x182)](),_0x358892=await database_1[_0x4fa2c3(0x169)][_0x4fa2c3(0x17f)]['count']({'where':{'isVerified':!![]}}),_0x3d3003=await database_1[_0x4fa2c3(0x169)][_0x4fa2c3(0x17f)]['groupBy']({'by':[_0x4fa2c3(0x156)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x530186[_0x4fa2c3(0x15d)]({'success':!![],'result':{'bot':{'isActive':_0xf6f201[_0x4fa2c3(0x17c)],'username':_0xf6f201[_0x4fa2c3(0x18b)]},'statistics':{'totalUsers':_0x3812f3,'verifiedUsers':_0x358892,'unverifiedUsers':_0x3812f3-_0x358892,'connectedShops':_0x3d3003[_0x4fa2c3(0x15f)]}}});}catch(_0x46af49){_0x3cef84(_0x46af49);}},this[_0x10dc26(0x15b)]=async(_0x35cda3,_0x4d9b55,_0x1b5f49)=>{const _0x5e9107=_0x10dc26;try{const {page:page=0x1,limit:limit=0x14,verified:_0x31c548}=_0x35cda3[_0x5e9107(0x152)],_0x45b7bf=(Number(page)-0x1)*Number(limit),_0xa36f10={};_0x31c548!==undefined&&(_0xa36f10[_0x5e9107(0x17a)]=_0x31c548==='true');const [_0x456d25,_0x215fae]=await Promise[_0x5e9107(0x14d)]([database_1[_0x5e9107(0x169)][_0x5e9107(0x17f)]['findMany']({'where':_0xa36f10,'skip':_0x45b7bf,'take':Number(limit),'orderBy':{'createdAt':_0x5e9107(0x168)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x5e9107(0x17f)][_0x5e9107(0x182)]({'where':_0xa36f10})]);_0x4d9b55[_0x5e9107(0x15d)]({'success':!![],'users':_0x456d25[_0x5e9107(0x183)](_0x576558=>({'id':_0x576558['id'],'telegramId':_0x576558[_0x5e9107(0x179)],'username':_0x576558[_0x5e9107(0x18b)],'firstName':_0x576558[_0x5e9107(0x16d)],'lastName':_0x576558[_0x5e9107(0x175)],'isVerified':_0x576558[_0x5e9107(0x17a)],'shop':_0x576558['shop'],'createdAt':_0x576558[_0x5e9107(0x14a)],'updatedAt':_0x576558[_0x5e9107(0x16f)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x215fae,'totalPages':Math[_0x5e9107(0x155)](_0x215fae/Number(limit))}});}catch(_0x5e2e3b){_0x1b5f49(_0x5e2e3b);}},this[_0x10dc26(0x15a)]=async(_0x340503,_0x5b5cb3,_0x163737)=>{const _0x519357=_0x10dc26;try{const {message:_0x12d440,shopId:_0x297f86}=_0x340503[_0x519357(0x149)];if(!_0x12d440)return _0x5b5cb3['status'](0x190)[_0x519357(0x15d)]({'success':![],'message':'Message\x20is\x20required'});if(_0x297f86)await telegramBotService_1[_0x519357(0x164)][_0x519357(0x18a)](_0x297f86,_0x12d440,{'parse_mode':_0x519357(0x18c)});else{const _0x52c927=await database_1[_0x519357(0x169)][_0x519357(0x17f)][_0x519357(0x16e)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4eb659=[...new Set(_0x52c927[_0x519357(0x183)](_0x54dbca=>_0x54dbca[_0x519357(0x156)])[_0x519357(0x18e)](Boolean))];for(const _0x571d46 of _0x4eb659){_0x571d46&&await telegramBotService_1[_0x519357(0x164)][_0x519357(0x18a)](_0x571d46,_0x12d440,{'parse_mode':'Markdown'});}}_0x5b5cb3[_0x519357(0x15d)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x5770c9){_0x163737(_0x5770c9);}},this[_0x10dc26(0x18d)]=async(_0x579354,_0x15d3b2,_0x28d83f)=>{const _0x287ee9=_0x10dc26;try{const {telegramId:_0x21d99c}=_0x579354[_0x287ee9(0x177)],_0x38bd65=await database_1[_0x287ee9(0x169)][_0x287ee9(0x17f)]['findUnique']({'where':{'telegramId':_0x21d99c},'include':{'shop':!![]}});if(!_0x38bd65)return _0x15d3b2[_0x287ee9(0x157)](0x194)['json']({'success':![],'message':_0x287ee9(0x16a)});await database_1['default'][_0x287ee9(0x17f)][_0x287ee9(0x150)]({'where':{'telegramId':_0x21d99c},'data':{'shopId':null,'isVerified':![]}}),_0x15d3b2[_0x287ee9(0x15d)]({'success':!![],'message':_0x287ee9(0x165)});}catch(_0x5634eb){_0x28d83f(_0x5634eb);}},this['sendTestNotification']=async(_0x4327f7,_0x526cfd,_0x356236)=>{const _0x206dcd=_0x10dc26;try{const {shopId:_0xbcdb47,type:type='payment',testData:_0x8b3105}=_0x4327f7['body'];if(!_0xbcdb47)return _0x526cfd[_0x206dcd(0x157)](0x190)['json']({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x51326e=await database_1[_0x206dcd(0x169)]['shop']['findUnique']({'where':{'id':_0xbcdb47},'select':{'id':!![],'name':!![]}});if(!_0x51326e)return _0x526cfd['status'](0x194)[_0x206dcd(0x15d)]({'success':![],'message':_0x206dcd(0x14f)});switch(type){case _0x206dcd(0x147):const _0x10be4e={'id':_0x206dcd(0x16b),'amount':_0x8b3105?.[_0x206dcd(0x185)]||0x64,'currency':_0x8b3105?.[_0x206dcd(0x163)]||_0x206dcd(0x166),'productName':_0x8b3105?.['productName']||_0x206dcd(0x18f),'gateway':_0x8b3105?.[_0x206dcd(0x15e)]||_0x206dcd(0x188),'createdAt':new Date(),..._0x8b3105};await telegramBotService_1[_0x206dcd(0x164)][_0x206dcd(0x187)](_0xbcdb47,_0x10be4e,_0x206dcd(0x172));break;case _0x206dcd(0x14e):const _0x116bbe={'id':_0x206dcd(0x170),'amount':_0x8b3105?.[_0x206dcd(0x185)]||0x1f4,'method':_0x8b3105?.[_0x206dcd(0x148)]||_0x206dcd(0x167),'createdAt':new Date(),..._0x8b3105};await telegramBotService_1[_0x206dcd(0x164)][_0x206dcd(0x186)](_0xbcdb47,_0x116bbe,_0x206dcd(0x181));break;case'custom':await telegramBotService_1['telegramBotService']['sendCustomNotification'](_0xbcdb47,_0x8b3105?.[_0x206dcd(0x15c)]||_0x206dcd(0x154),_0x8b3105?.[_0x206dcd(0x14c)]||{'message':_0x206dcd(0x158)});break;default:return _0x526cfd[_0x206dcd(0x157)](0x190)[_0x206dcd(0x15d)]({'success':![],'message':_0x206dcd(0x151)});}_0x526cfd[_0x206dcd(0x15d)]({'success':!![],'message':_0x206dcd(0x146)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x54a1be){_0x356236(_0x54a1be);}};}}exports[a14_0x4bfdbc(0x16c)]=TelegramController;