'use strict';const a12_0x5bda06=a12_0x57fe;function a12_0x57fe(_0xc4f725,_0x4cd04a){const _0x322531=a12_0x3225();return a12_0x57fe=function(_0x57fe83,_0x5bb9f8){_0x57fe83=_0x57fe83-0x9d;let _0x585f93=_0x322531[_0x57fe83];return _0x585f93;},a12_0x57fe(_0xc4f725,_0x4cd04a);}(function(_0x1da1a2,_0x583c93){const _0x7e9b96=a12_0x57fe,_0x45b430=_0x1da1a2();while(!![]){try{const _0x54ea6a=parseInt(_0x7e9b96(0xcf))/0x1*(parseInt(_0x7e9b96(0xcc))/0x2)+-parseInt(_0x7e9b96(0xe3))/0x3+parseInt(_0x7e9b96(0xb9))/0x4*(-parseInt(_0x7e9b96(0xe6))/0x5)+-parseInt(_0x7e9b96(0xc4))/0x6*(parseInt(_0x7e9b96(0xe0))/0x7)+-parseInt(_0x7e9b96(0xd9))/0x8*(-parseInt(_0x7e9b96(0xc0))/0x9)+parseInt(_0x7e9b96(0xa4))/0xa*(parseInt(_0x7e9b96(0xe2))/0xb)+-parseInt(_0x7e9b96(0xdb))/0xc;if(_0x54ea6a===_0x583c93)break;else _0x45b430['push'](_0x45b430['shift']());}catch(_0x3eec10){_0x45b430['push'](_0x45b430['shift']());}}}(a12_0x3225,0x8c797));function a12_0x3225(){const _0x59a606=['createdAt','Broadcast\x20message\x20sent\x20successfully','method','getBotInfo','1519726LRdBzN','all','sendShopNotification','1JdyeQM','groupBy','body','update','telegramUser','Test\x20','username','__importDefault','desc','isVerified','5137472yqdMZE','lastName','115332atqiVx','productName','Telegram\x20user\x20not\x20found','TelegramController','filter','14hiRWQJ','defineProperty','12562JJixtP','5259fPjwom','Markdown','amount','155iEitPZ','\x20notification\x20sent\x20successfully','test_payment_123','completed','../config/database','true','count','gateway','User\x20disconnected\x20successfully','params','2330yhFQTh','sendPaymentNotification','default','isActive','test_payout_123','Message\x20is\x20required','sendPayoutNotification','USD','ceil','sendCustomNotification','disconnectUser','plisio','telegramId','payment','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','findMany','map','json','shop','sendBroadcast','getBotStatus','76840ZgbfsT','Shop\x20ID\x20is\x20required','Shop\x20not\x20found','__esModule','shopId','Test\x20Product','query','9ksLNYe','status','../services/telegramBotService','details','1457628lywvhL','telegramBotService','findUnique','currency'];a12_0x3225=function(){return _0x59a606;};return a12_0x3225();}var __importDefault=this&&this[a12_0x5bda06(0xd6)]||function(_0x54d944){return _0x54d944&&_0x54d944['__esModule']?_0x54d944:{'default':_0x54d944};};Object[a12_0x5bda06(0xe1)](exports,a12_0x5bda06(0xbc),{'value':!![]}),exports[a12_0x5bda06(0xde)]=void 0x0;const telegramBotService_1=require(a12_0x5bda06(0xc2)),database_1=__importDefault(require(a12_0x5bda06(0x9e)));class TelegramController{constructor(){const _0x48a66e=a12_0x5bda06;this[_0x48a66e(0xb8)]=async(_0x400adf,_0x5601ad,_0x18bb61)=>{const _0x416bf7=_0x48a66e;try{const _0x2060ed=telegramBotService_1['telegramBotService'][_0x416bf7(0xcb)](),_0x112e82=await database_1[_0x416bf7(0xa6)][_0x416bf7(0xd3)][_0x416bf7(0xa0)](),_0x2cdab2=await database_1[_0x416bf7(0xa6)][_0x416bf7(0xd3)]['count']({'where':{'isVerified':!![]}}),_0x10ba80=await database_1[_0x416bf7(0xa6)][_0x416bf7(0xd3)][_0x416bf7(0xd0)]({'by':[_0x416bf7(0xbd)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5601ad[_0x416bf7(0xb5)]({'success':!![],'result':{'bot':{'isActive':_0x2060ed[_0x416bf7(0xa7)],'username':_0x2060ed[_0x416bf7(0xd5)]},'statistics':{'totalUsers':_0x112e82,'verifiedUsers':_0x2cdab2,'unverifiedUsers':_0x112e82-_0x2cdab2,'connectedShops':_0x10ba80['length']}}});}catch(_0x2e254e){_0x18bb61(_0x2e254e);}},this['getTelegramUsers']=async(_0x29bd4b,_0xbd9b6d,_0x1d9e50)=>{const _0x554c51=_0x48a66e;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3b4842}=_0x29bd4b[_0x554c51(0xbf)],_0x4675e8=(Number(page)-0x1)*Number(limit),_0x397e20={};_0x3b4842!==undefined&&(_0x397e20['isVerified']=_0x3b4842===_0x554c51(0x9f));const [_0x5edaf8,_0x1acd97]=await Promise[_0x554c51(0xcd)]([database_1[_0x554c51(0xa6)][_0x554c51(0xd3)][_0x554c51(0xb3)]({'where':_0x397e20,'skip':_0x4675e8,'take':Number(limit),'orderBy':{'createdAt':_0x554c51(0xd7)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x554c51(0xa6)]['telegramUser'][_0x554c51(0xa0)]({'where':_0x397e20})]);_0xbd9b6d[_0x554c51(0xb5)]({'success':!![],'users':_0x5edaf8['map'](_0x1e7773=>({'id':_0x1e7773['id'],'telegramId':_0x1e7773[_0x554c51(0xb0)],'username':_0x1e7773[_0x554c51(0xd5)],'firstName':_0x1e7773['firstName'],'lastName':_0x1e7773[_0x554c51(0xda)],'isVerified':_0x1e7773[_0x554c51(0xd8)],'shop':_0x1e7773[_0x554c51(0xb6)],'createdAt':_0x1e7773[_0x554c51(0xc8)],'updatedAt':_0x1e7773['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1acd97,'totalPages':Math[_0x554c51(0xac)](_0x1acd97/Number(limit))}});}catch(_0x2909d8){_0x1d9e50(_0x2909d8);}},this[_0x48a66e(0xb7)]=async(_0x35db2b,_0x15960c,_0x3fdaa4)=>{const _0x4e683b=_0x48a66e;try{const {message:_0x374967,shopId:_0x4971c3}=_0x35db2b[_0x4e683b(0xd1)];if(!_0x374967)return _0x15960c[_0x4e683b(0xc1)](0x190)[_0x4e683b(0xb5)]({'success':![],'message':_0x4e683b(0xa9)});if(_0x4971c3)await telegramBotService_1[_0x4e683b(0xc5)][_0x4e683b(0xce)](_0x4971c3,_0x374967,{'parse_mode':_0x4e683b(0xe4)});else{const _0x55a3e6=await database_1[_0x4e683b(0xa6)][_0x4e683b(0xd3)][_0x4e683b(0xb3)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1f236d=[...new Set(_0x55a3e6[_0x4e683b(0xb4)](_0x40e9bf=>_0x40e9bf[_0x4e683b(0xbd)])[_0x4e683b(0xdf)](Boolean))];for(const _0x287c77 of _0x1f236d){_0x287c77&&await telegramBotService_1[_0x4e683b(0xc5)][_0x4e683b(0xce)](_0x287c77,_0x374967,{'parse_mode':_0x4e683b(0xe4)});}}_0x15960c['json']({'success':!![],'message':_0x4e683b(0xc9)});}catch(_0x467f69){_0x3fdaa4(_0x467f69);}},this[_0x48a66e(0xae)]=async(_0x305748,_0x4fdbf2,_0x11215f)=>{const _0x2264e3=_0x48a66e;try{const {telegramId:_0x24b760}=_0x305748[_0x2264e3(0xa3)],_0x412146=await database_1[_0x2264e3(0xa6)][_0x2264e3(0xd3)][_0x2264e3(0xc6)]({'where':{'telegramId':_0x24b760},'include':{'shop':!![]}});if(!_0x412146)return _0x4fdbf2['status'](0x194)[_0x2264e3(0xb5)]({'success':![],'message':_0x2264e3(0xdd)});await database_1[_0x2264e3(0xa6)][_0x2264e3(0xd3)][_0x2264e3(0xd2)]({'where':{'telegramId':_0x24b760},'data':{'shopId':null,'isVerified':![]}}),_0x4fdbf2[_0x2264e3(0xb5)]({'success':!![],'message':_0x2264e3(0xa2)});}catch(_0x872beb){_0x11215f(_0x872beb);}},this['sendTestNotification']=async(_0x390a63,_0x91f191,_0x4908c5)=>{const _0x2eb407=_0x48a66e;try{const {shopId:_0x46e681,type:type=_0x2eb407(0xb1),testData:_0x578b35}=_0x390a63[_0x2eb407(0xd1)];if(!_0x46e681)return _0x91f191[_0x2eb407(0xc1)](0x190)[_0x2eb407(0xb5)]({'success':![],'message':_0x2eb407(0xba)});const _0x523934=await database_1[_0x2eb407(0xa6)]['shop'][_0x2eb407(0xc6)]({'where':{'id':_0x46e681},'select':{'id':!![],'name':!![]}});if(!_0x523934)return _0x91f191['status'](0x194)['json']({'success':![],'message':_0x2eb407(0xbb)});switch(type){case _0x2eb407(0xb1):const _0x40be89={'id':_0x2eb407(0xe8),'amount':_0x578b35?.[_0x2eb407(0xe5)]||0x64,'currency':_0x578b35?.[_0x2eb407(0xc7)]||_0x2eb407(0xab),'productName':_0x578b35?.[_0x2eb407(0xdc)]||_0x2eb407(0xbe),'gateway':_0x578b35?.[_0x2eb407(0xa1)]||_0x2eb407(0xaf),'createdAt':new Date(),..._0x578b35};await telegramBotService_1[_0x2eb407(0xc5)][_0x2eb407(0xa5)](_0x46e681,_0x40be89,'paid');break;case'payout':const _0x37f090={'id':_0x2eb407(0xa8),'amount':_0x578b35?.['amount']||0x1f4,'method':_0x578b35?.[_0x2eb407(0xca)]||'bank_transfer','createdAt':new Date(),..._0x578b35};await telegramBotService_1[_0x2eb407(0xc5)][_0x2eb407(0xaa)](_0x46e681,_0x37f090,_0x2eb407(0x9d));break;case'custom':await telegramBotService_1[_0x2eb407(0xc5)][_0x2eb407(0xad)](_0x46e681,_0x578b35?.['title']||'Test\x20Notification',_0x578b35?.[_0x2eb407(0xc3)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x91f191[_0x2eb407(0xc1)](0x190)['json']({'success':![],'message':_0x2eb407(0xb2)});}_0x91f191['json']({'success':!![],'message':_0x2eb407(0xd4)+type+_0x2eb407(0xe7)});}catch(_0x1af904){_0x4908c5(_0x1af904);}};}}exports[a12_0x5bda06(0xde)]=TelegramController;