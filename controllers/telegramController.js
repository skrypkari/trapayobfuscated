'use strict';function a12_0x1ed2(){const _0x5dea15=['test_payment_123','custom','USD','User\x20disconnected\x20successfully','shopId','json','sendTestNotification','query','383467YBKrEM','sendPayoutNotification','plisio','808984iPZvvv','payment','status','defineProperty','18HwwzlQ','disconnectUser','map','true','1106248BnHiZn','body','Shop\x20ID\x20is\x20required','../services/telegramBotService','Telegram\x20user\x20not\x20found','amount','update','lastName','details','\x20notification\x20sent\x20successfully','Test\x20','getTelegramUsers','30QZrYvU','156635yIupUn','9bRnQGf','updatedAt','createdAt','gateway','telegramUser','Message\x20is\x20required','bank_transfer','telegramBotService','__importDefault','__esModule','params','test_payout_123','currency','sendBroadcast','shop','isVerified','count','isActive','groupBy','username','37274lfJmBK','Broadcast\x20message\x20sent\x20successfully','findMany','258194SavdVQ','Test\x20Notification','12XVWbzi','findUnique','title','Markdown','sendShopNotification','completed','getBotInfo','all','2659250uzynUO','default','ceil'];a12_0x1ed2=function(){return _0x5dea15;};return a12_0x1ed2();}const a12_0x3b4fbc=a12_0x116d;(function(_0x3a1de1,_0x4bbb1b){const _0x32b2f4=a12_0x116d,_0x900f20=_0x3a1de1();while(!![]){try{const _0x29508b=parseInt(_0x32b2f4(0xcd))/0x1+parseInt(_0x32b2f4(0xca))/0x2*(parseInt(_0x32b2f4(0xfb))/0x3)+parseInt(_0x32b2f4(0xed))/0x4+-parseInt(_0x32b2f4(0xfa))/0x5+-parseInt(_0x32b2f4(0xcf))/0x6*(-parseInt(_0x32b2f4(0xe2))/0x7)+-parseInt(_0x32b2f4(0xe5))/0x8*(-parseInt(_0x32b2f4(0xe9))/0x9)+-parseInt(_0x32b2f4(0xf9))/0xa*(parseInt(_0x32b2f4(0xd7))/0xb);if(_0x29508b===_0x4bbb1b)break;else _0x900f20['push'](_0x900f20['shift']());}catch(_0x8a06be){_0x900f20['push'](_0x900f20['shift']());}}}(a12_0x1ed2,0x239ea));function a12_0x116d(_0x51913d,_0x243d9f){const _0x1ed2e7=a12_0x1ed2();return a12_0x116d=function(_0x116dfc,_0x4284a4){_0x116dfc=_0x116dfc-0xbb;let _0x149347=_0x1ed2e7[_0x116dfc];return _0x149347;},a12_0x116d(_0x51913d,_0x243d9f);}var __importDefault=this&&this[a12_0x3b4fbc(0xbe)]||function(_0x29c315){const _0xc3d751=a12_0x3b4fbc;return _0x29c315&&_0x29c315[_0xc3d751(0xbf)]?_0x29c315:{'default':_0x29c315};};Object[a12_0x3b4fbc(0xe8)](exports,a12_0x3b4fbc(0xbf),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x3b4fbc(0xf0)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x2aee53=a12_0x3b4fbc;this['getBotStatus']=async(_0x1e760b,_0x15e39a,_0x2de112)=>{const _0x1f5d1f=a12_0x116d;try{const _0x2602ea=telegramBotService_1[_0x1f5d1f(0xbd)][_0x1f5d1f(0xd5)](),_0x3b8a08=await database_1['default'][_0x1f5d1f(0xff)]['count'](),_0x4913e0=await database_1[_0x1f5d1f(0xd8)]['telegramUser'][_0x1f5d1f(0xc6)]({'where':{'isVerified':!![]}}),_0x2e5a0f=await database_1['default']['telegramUser'][_0x1f5d1f(0xc8)]({'by':[_0x1f5d1f(0xde)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x15e39a['json']({'success':!![],'result':{'bot':{'isActive':_0x2602ea[_0x1f5d1f(0xc7)],'username':_0x2602ea[_0x1f5d1f(0xc9)]},'statistics':{'totalUsers':_0x3b8a08,'verifiedUsers':_0x4913e0,'unverifiedUsers':_0x3b8a08-_0x4913e0,'connectedShops':_0x2e5a0f['length']}}});}catch(_0x3ee8f1){_0x2de112(_0x3ee8f1);}},this[_0x2aee53(0xf8)]=async(_0x90f051,_0x1e4bda,_0x156fa7)=>{const _0x2071d8=_0x2aee53;try{const {page:page=0x1,limit:limit=0x14,verified:_0x16cdf0}=_0x90f051[_0x2071d8(0xe1)],_0x3da4b9=(Number(page)-0x1)*Number(limit),_0x33bee8={};_0x16cdf0!==undefined&&(_0x33bee8[_0x2071d8(0xc5)]=_0x16cdf0===_0x2071d8(0xec));const [_0x24f2d9,_0x56b61c]=await Promise[_0x2071d8(0xd6)]([database_1[_0x2071d8(0xd8)]['telegramUser'][_0x2071d8(0xcc)]({'where':_0x33bee8,'skip':_0x3da4b9,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2071d8(0xd8)][_0x2071d8(0xff)][_0x2071d8(0xc6)]({'where':_0x33bee8})]);_0x1e4bda[_0x2071d8(0xdf)]({'success':!![],'users':_0x24f2d9[_0x2071d8(0xeb)](_0x2c682a=>({'id':_0x2c682a['id'],'telegramId':_0x2c682a['telegramId'],'username':_0x2c682a[_0x2071d8(0xc9)],'firstName':_0x2c682a['firstName'],'lastName':_0x2c682a[_0x2071d8(0xf4)],'isVerified':_0x2c682a[_0x2071d8(0xc5)],'shop':_0x2c682a[_0x2071d8(0xc4)],'createdAt':_0x2c682a[_0x2071d8(0xfd)],'updatedAt':_0x2c682a[_0x2071d8(0xfc)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x56b61c,'totalPages':Math[_0x2071d8(0xd9)](_0x56b61c/Number(limit))}});}catch(_0xcd69ae){_0x156fa7(_0xcd69ae);}},this[_0x2aee53(0xc3)]=async(_0x4d42f2,_0x233762,_0x5906b6)=>{const _0x455f94=_0x2aee53;try{const {message:_0x549ebf,shopId:_0x31cc64}=_0x4d42f2[_0x455f94(0xee)];if(!_0x549ebf)return _0x233762['status'](0x190)[_0x455f94(0xdf)]({'success':![],'message':_0x455f94(0xbb)});if(_0x31cc64)await telegramBotService_1[_0x455f94(0xbd)]['sendShopNotification'](_0x31cc64,_0x549ebf,{'parse_mode':'Markdown'});else{const _0x1c6f04=await database_1['default']['telegramUser'][_0x455f94(0xcc)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xd90d50=[...new Set(_0x1c6f04['map'](_0x197356=>_0x197356['shopId'])['filter'](Boolean))];for(const _0x566617 of _0xd90d50){_0x566617&&await telegramBotService_1[_0x455f94(0xbd)][_0x455f94(0xd3)](_0x566617,_0x549ebf,{'parse_mode':_0x455f94(0xd2)});}}_0x233762[_0x455f94(0xdf)]({'success':!![],'message':_0x455f94(0xcb)});}catch(_0x156739){_0x5906b6(_0x156739);}},this[_0x2aee53(0xea)]=async(_0xfb0bdd,_0x8ef6ab,_0x40da44)=>{const _0x42e642=_0x2aee53;try{const {telegramId:_0xd15f55}=_0xfb0bdd[_0x42e642(0xc0)],_0x5dc5bf=await database_1[_0x42e642(0xd8)]['telegramUser'][_0x42e642(0xd0)]({'where':{'telegramId':_0xd15f55},'include':{'shop':!![]}});if(!_0x5dc5bf)return _0x8ef6ab[_0x42e642(0xe7)](0x194)[_0x42e642(0xdf)]({'success':![],'message':_0x42e642(0xf1)});await database_1[_0x42e642(0xd8)]['telegramUser'][_0x42e642(0xf3)]({'where':{'telegramId':_0xd15f55},'data':{'shopId':null,'isVerified':![]}}),_0x8ef6ab[_0x42e642(0xdf)]({'success':!![],'message':_0x42e642(0xdd)});}catch(_0x238024){_0x40da44(_0x238024);}},this[_0x2aee53(0xe0)]=async(_0x364327,_0x157f27,_0x4b7b19)=>{const _0x43c08d=_0x2aee53;try{const {shopId:_0x5c0b03,type:type=_0x43c08d(0xe6),testData:_0x521ee7}=_0x364327[_0x43c08d(0xee)];if(!_0x5c0b03)return _0x157f27[_0x43c08d(0xe7)](0x190)[_0x43c08d(0xdf)]({'success':![],'message':_0x43c08d(0xef)});const _0x5aef5b=await database_1[_0x43c08d(0xd8)][_0x43c08d(0xc4)][_0x43c08d(0xd0)]({'where':{'id':_0x5c0b03},'select':{'id':!![],'name':!![]}});if(!_0x5aef5b)return _0x157f27[_0x43c08d(0xe7)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0x7b8cf3={'id':_0x43c08d(0xda),'amount':_0x521ee7?.[_0x43c08d(0xf2)]||0x64,'currency':_0x521ee7?.[_0x43c08d(0xc2)]||_0x43c08d(0xdc),'productName':_0x521ee7?.['productName']||'Test\x20Product','gateway':_0x521ee7?.[_0x43c08d(0xfe)]||_0x43c08d(0xe4),'createdAt':new Date(),..._0x521ee7};await telegramBotService_1[_0x43c08d(0xbd)]['sendPaymentNotification'](_0x5c0b03,_0x7b8cf3,'paid');break;case'payout':const _0x546f23={'id':_0x43c08d(0xc1),'amount':_0x521ee7?.[_0x43c08d(0xf2)]||0x1f4,'method':_0x521ee7?.['method']||_0x43c08d(0xbc),'createdAt':new Date(),..._0x521ee7};await telegramBotService_1['telegramBotService'][_0x43c08d(0xe3)](_0x5c0b03,_0x546f23,_0x43c08d(0xd4));break;case _0x43c08d(0xdb):await telegramBotService_1[_0x43c08d(0xbd)]['sendCustomNotification'](_0x5c0b03,_0x521ee7?.[_0x43c08d(0xd1)]||_0x43c08d(0xce),_0x521ee7?.[_0x43c08d(0xf5)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x157f27[_0x43c08d(0xe7)](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x157f27['json']({'success':!![],'message':_0x43c08d(0xf7)+type+_0x43c08d(0xf6)});}catch(_0x9d3d6a){_0x4b7b19(_0x9d3d6a);}};}}exports['TelegramController']=TelegramController;