'use strict';const a12_0x5207e1=a12_0x56d8;(function(_0x457bb4,_0x122816){const _0x4913d7=a12_0x56d8,_0x3600a7=_0x457bb4();while(!![]){try{const _0x9568b7=parseInt(_0x4913d7(0xe2))/0x1+-parseInt(_0x4913d7(0xd4))/0x2+-parseInt(_0x4913d7(0x100))/0x3*(parseInt(_0x4913d7(0xf3))/0x4)+parseInt(_0x4913d7(0xcc))/0x5+-parseInt(_0x4913d7(0xce))/0x6+parseInt(_0x4913d7(0xf6))/0x7*(-parseInt(_0x4913d7(0x10b))/0x8)+parseInt(_0x4913d7(0xe3))/0x9*(parseInt(_0x4913d7(0x10f))/0xa);if(_0x9568b7===_0x122816)break;else _0x3600a7['push'](_0x3600a7['shift']());}catch(_0x6a425f){_0x3600a7['push'](_0x3600a7['shift']());}}}(a12_0x5a39,0x8b270));function a12_0x5a39(){const _0x34467b=['417403YtovSV','__importDefault','sendTestNotification','Message\x20is\x20required','paid','sendPaymentNotification','\x20notification\x20sent\x20successfully','sendPayoutNotification','status','json','186hyKiYh','sendShopNotification','isVerified','createdAt','params','defineProperty','map','lastName','plisio','findUnique','firstName','136jVUmUX','User\x20disconnected\x20successfully','../services/telegramBotService','findMany','8114810bVcfmq','disconnectUser','body','shop','isActive','Markdown','744595uiUqPk','currency','4573722mtmuBR','filter','length','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','test_payment_123','getTelegramUsers','1013500ITXtbq','true','update','custom','sendBroadcast','telegramUser','getBotInfo','method','__esModule','amount','title','payment','query','Test\x20Product','289920pHQLhZ','27SDtmdJ','telegramBotService','groupBy','Broadcast\x20message\x20sent\x20successfully','telegramId','updatedAt','Test\x20Notification','count','Telegram\x20user\x20not\x20found','TelegramController','desc','shopId','default','productName','username','getBotStatus','1328ebdxBA','gateway','all'];a12_0x5a39=function(){return _0x34467b;};return a12_0x5a39();}var __importDefault=this&&this[a12_0x5207e1(0xf7)]||function(_0x7f60e){const _0x224061=a12_0x5207e1;return _0x7f60e&&_0x7f60e[_0x224061(0xdc)]?_0x7f60e:{'default':_0x7f60e};};function a12_0x56d8(_0x56e486,_0x51a463){const _0x5a390d=a12_0x5a39();return a12_0x56d8=function(_0x56d8f3,_0x17a8f4){_0x56d8f3=_0x56d8f3-0xcc;let _0x1cf555=_0x5a390d[_0x56d8f3];return _0x1cf555;},a12_0x56d8(_0x56e486,_0x51a463);}Object[a12_0x5207e1(0x105)](exports,a12_0x5207e1(0xdc),{'value':!![]}),exports[a12_0x5207e1(0xec)]=void 0x0;const telegramBotService_1=require(a12_0x5207e1(0x10d)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x19e634=a12_0x5207e1;this[_0x19e634(0xf2)]=async(_0x30986a,_0x8b125e,_0x2a1f5c)=>{const _0x1e1231=_0x19e634;try{const _0x202e57=telegramBotService_1[_0x1e1231(0xe4)][_0x1e1231(0xda)](),_0x427903=await database_1[_0x1e1231(0xef)][_0x1e1231(0xd9)]['count'](),_0x36c50c=await database_1[_0x1e1231(0xef)][_0x1e1231(0xd9)][_0x1e1231(0xea)]({'where':{'isVerified':!![]}}),_0x28f871=await database_1[_0x1e1231(0xef)][_0x1e1231(0xd9)][_0x1e1231(0xe5)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x8b125e[_0x1e1231(0xff)]({'success':!![],'result':{'bot':{'isActive':_0x202e57[_0x1e1231(0x113)],'username':_0x202e57[_0x1e1231(0xf1)]},'statistics':{'totalUsers':_0x427903,'verifiedUsers':_0x36c50c,'unverifiedUsers':_0x427903-_0x36c50c,'connectedShops':_0x28f871[_0x1e1231(0xd0)]}}});}catch(_0x10badd){_0x2a1f5c(_0x10badd);}},this[_0x19e634(0xd3)]=async(_0x3dc68b,_0x715d6a,_0x37e07b)=>{const _0x2f1159=_0x19e634;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1ea269}=_0x3dc68b[_0x2f1159(0xe0)],_0x305c43=(Number(page)-0x1)*Number(limit),_0xdfa5c8={};_0x1ea269!==undefined&&(_0xdfa5c8['isVerified']=_0x1ea269===_0x2f1159(0xd5));const [_0x3f3b88,_0x633a06]=await Promise[_0x2f1159(0xf5)]([database_1[_0x2f1159(0xef)][_0x2f1159(0xd9)][_0x2f1159(0x10e)]({'where':_0xdfa5c8,'skip':_0x305c43,'take':Number(limit),'orderBy':{'createdAt':_0x2f1159(0xed)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2f1159(0xef)][_0x2f1159(0xd9)][_0x2f1159(0xea)]({'where':_0xdfa5c8})]);_0x715d6a[_0x2f1159(0xff)]({'success':!![],'users':_0x3f3b88[_0x2f1159(0x106)](_0x4be1f6=>({'id':_0x4be1f6['id'],'telegramId':_0x4be1f6[_0x2f1159(0xe7)],'username':_0x4be1f6[_0x2f1159(0xf1)],'firstName':_0x4be1f6[_0x2f1159(0x10a)],'lastName':_0x4be1f6[_0x2f1159(0x107)],'isVerified':_0x4be1f6[_0x2f1159(0x102)],'shop':_0x4be1f6['shop'],'createdAt':_0x4be1f6[_0x2f1159(0x103)],'updatedAt':_0x4be1f6[_0x2f1159(0xe8)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x633a06,'totalPages':Math['ceil'](_0x633a06/Number(limit))}});}catch(_0x4fb15d){_0x37e07b(_0x4fb15d);}},this[_0x19e634(0xd8)]=async(_0x365651,_0x368869,_0x5e696c)=>{const _0xf7b209=_0x19e634;try{const {message:_0x1bbcb8,shopId:_0x51996c}=_0x365651[_0xf7b209(0x111)];if(!_0x1bbcb8)return _0x368869[_0xf7b209(0xfe)](0x190)[_0xf7b209(0xff)]({'success':![],'message':_0xf7b209(0xf9)});if(_0x51996c)await telegramBotService_1[_0xf7b209(0xe4)][_0xf7b209(0x101)](_0x51996c,_0x1bbcb8,{'parse_mode':'Markdown'});else{const _0x54f62e=await database_1[_0xf7b209(0xef)][_0xf7b209(0xd9)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x19a900=[...new Set(_0x54f62e[_0xf7b209(0x106)](_0x388366=>_0x388366[_0xf7b209(0xee)])[_0xf7b209(0xcf)](Boolean))];for(const _0x50b457 of _0x19a900){_0x50b457&&await telegramBotService_1[_0xf7b209(0xe4)][_0xf7b209(0x101)](_0x50b457,_0x1bbcb8,{'parse_mode':_0xf7b209(0x114)});}}_0x368869[_0xf7b209(0xff)]({'success':!![],'message':_0xf7b209(0xe6)});}catch(_0x1e561f){_0x5e696c(_0x1e561f);}},this[_0x19e634(0x110)]=async(_0x4ced99,_0x16c66f,_0x6a5436)=>{const _0x5c2fdb=_0x19e634;try{const {telegramId:_0x10c607}=_0x4ced99[_0x5c2fdb(0x104)],_0xffb27a=await database_1[_0x5c2fdb(0xef)][_0x5c2fdb(0xd9)][_0x5c2fdb(0x109)]({'where':{'telegramId':_0x10c607},'include':{'shop':!![]}});if(!_0xffb27a)return _0x16c66f[_0x5c2fdb(0xfe)](0x194)[_0x5c2fdb(0xff)]({'success':![],'message':_0x5c2fdb(0xeb)});await database_1[_0x5c2fdb(0xef)][_0x5c2fdb(0xd9)][_0x5c2fdb(0xd6)]({'where':{'telegramId':_0x10c607},'data':{'shopId':null,'isVerified':![]}}),_0x16c66f[_0x5c2fdb(0xff)]({'success':!![],'message':_0x5c2fdb(0x10c)});}catch(_0x187ece){_0x6a5436(_0x187ece);}},this[_0x19e634(0xf8)]=async(_0x42b77f,_0x4eb374,_0x3e3f12)=>{const _0x5ac0f2=_0x19e634;try{const {shopId:_0x14e12b,type:type='payment',testData:_0xc4a036}=_0x42b77f[_0x5ac0f2(0x111)];if(!_0x14e12b)return _0x4eb374[_0x5ac0f2(0xfe)](0x190)[_0x5ac0f2(0xff)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0xc2461b=await database_1[_0x5ac0f2(0xef)][_0x5ac0f2(0x112)][_0x5ac0f2(0x109)]({'where':{'id':_0x14e12b},'select':{'id':!![],'name':!![]}});if(!_0xc2461b)return _0x4eb374[_0x5ac0f2(0xfe)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x5ac0f2(0xdf):const _0x454505={'id':_0x5ac0f2(0xd2),'amount':_0xc4a036?.['amount']||0x64,'currency':_0xc4a036?.[_0x5ac0f2(0xcd)]||'USD','productName':_0xc4a036?.[_0x5ac0f2(0xf0)]||_0x5ac0f2(0xe1),'gateway':_0xc4a036?.[_0x5ac0f2(0xf4)]||_0x5ac0f2(0x108),'createdAt':new Date(),..._0xc4a036};await telegramBotService_1['telegramBotService'][_0x5ac0f2(0xfb)](_0x14e12b,_0x454505,_0x5ac0f2(0xfa));break;case'payout':const _0x428246={'id':'test_payout_123','amount':_0xc4a036?.[_0x5ac0f2(0xdd)]||0x1f4,'method':_0xc4a036?.[_0x5ac0f2(0xdb)]||'bank_transfer','createdAt':new Date(),..._0xc4a036};await telegramBotService_1[_0x5ac0f2(0xe4)][_0x5ac0f2(0xfd)](_0x14e12b,_0x428246,'completed');break;case _0x5ac0f2(0xd7):await telegramBotService_1[_0x5ac0f2(0xe4)]['sendCustomNotification'](_0x14e12b,_0xc4a036?.[_0x5ac0f2(0xde)]||_0x5ac0f2(0xe9),_0xc4a036?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x4eb374[_0x5ac0f2(0xfe)](0x190)['json']({'success':![],'message':_0x5ac0f2(0xd1)});}_0x4eb374['json']({'success':!![],'message':'Test\x20'+type+_0x5ac0f2(0xfc)});}catch(_0x1a040f){_0x3e3f12(_0x1a040f);}};}}exports['TelegramController']=TelegramController;