'use strict';const a12_0x52ac1e=a12_0xc818;(function(_0x4c2785,_0xacadd3){const _0x1ad804=a12_0xc818,_0x2a7c50=_0x4c2785();while(!![]){try{const _0x353834=-parseInt(_0x1ad804(0x15a))/0x1+-parseInt(_0x1ad804(0x163))/0x2*(-parseInt(_0x1ad804(0x16a))/0x3)+-parseInt(_0x1ad804(0x133))/0x4+parseInt(_0x1ad804(0x15c))/0x5+-parseInt(_0x1ad804(0x13f))/0x6+-parseInt(_0x1ad804(0x152))/0x7+-parseInt(_0x1ad804(0x16d))/0x8*(-parseInt(_0x1ad804(0x12c))/0x9);if(_0x353834===_0xacadd3)break;else _0x2a7c50['push'](_0x2a7c50['shift']());}catch(_0x5a22d4){_0x2a7c50['push'](_0x2a7c50['shift']());}}}(a12_0x296d,0xf11ba));function a12_0xc818(_0x537eb3,_0x565b68){const _0x296d42=a12_0x296d();return a12_0xc818=function(_0xc81863,_0x69a604){_0xc81863=_0xc81863-0x12b;let _0x376ed5=_0x296d42[_0xc81863];return _0x376ed5;},a12_0xc818(_0x537eb3,_0x565b68);}function a12_0x296d(){const _0x5d6190=['getBotInfo','groupBy','This\x20is\x20a\x20test\x20notification','default','findUnique','telegramUser','payment','lastName','12274955eUBXHC','firstName','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','title','../config/database','__esModule','shopId','isActive','630160gbXToq','test_payment_123','6033830QIGlFF','Test\x20','Markdown','count','gateway','payout','shop','2dxBPZf','sendCustomNotification','\x20notification\x20sent\x20successfully','body','TelegramController','../services/telegramBotService','isVerified','3679449vGEqsa','test_payout_123','findMany','6792784PpDScr','__importDefault','sendTestNotification','status','Broadcast\x20message\x20sent\x20successfully','username','custom','Shop\x20not\x20found','json','map','36NBmQOh','getTelegramUsers','amount','USD','Shop\x20ID\x20is\x20required','sendBroadcast','filter','3675880SMDRHI','true','all','sendPaymentNotification','details','telegramBotService','desc','completed','telegramId','createdAt','getBotStatus','User\x20disconnected\x20successfully','9236208NtpcmS','Test\x20Product','plisio','sendShopNotification','ceil','params','update','updatedAt','Message\x20is\x20required','Telegram\x20user\x20not\x20found','length'];a12_0x296d=function(){return _0x5d6190;};return a12_0x296d();}var __importDefault=this&&this[a12_0x52ac1e(0x16e)]||function(_0x312ec0){const _0xe79e5=a12_0x52ac1e;return _0x312ec0&&_0x312ec0[_0xe79e5(0x157)]?_0x312ec0:{'default':_0x312ec0};};Object['defineProperty'](exports,a12_0x52ac1e(0x157),{'value':!![]}),exports[a12_0x52ac1e(0x167)]=void 0x0;const telegramBotService_1=require(a12_0x52ac1e(0x168)),database_1=__importDefault(require(a12_0x52ac1e(0x156)));class TelegramController{constructor(){const _0x4ae4e2=a12_0x52ac1e;this[_0x4ae4e2(0x13d)]=async(_0x341597,_0x13c496,_0x19d79c)=>{const _0x1f0c53=_0x4ae4e2;try{const _0x546b26=telegramBotService_1[_0x1f0c53(0x138)][_0x1f0c53(0x14a)](),_0x30dd5f=await database_1[_0x1f0c53(0x14d)][_0x1f0c53(0x14f)][_0x1f0c53(0x15f)](),_0x610d24=await database_1['default'][_0x1f0c53(0x14f)]['count']({'where':{'isVerified':!![]}}),_0x5b935a=await database_1['default'][_0x1f0c53(0x14f)][_0x1f0c53(0x14b)]({'by':[_0x1f0c53(0x158)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x13c496[_0x1f0c53(0x175)]({'success':!![],'result':{'bot':{'isActive':_0x546b26[_0x1f0c53(0x159)],'username':_0x546b26[_0x1f0c53(0x172)]},'statistics':{'totalUsers':_0x30dd5f,'verifiedUsers':_0x610d24,'unverifiedUsers':_0x30dd5f-_0x610d24,'connectedShops':_0x5b935a[_0x1f0c53(0x149)]}}});}catch(_0x22188b){_0x19d79c(_0x22188b);}},this[_0x4ae4e2(0x12d)]=async(_0x5d1e3f,_0x291724,_0x3e5393)=>{const _0x3ce51b=_0x4ae4e2;try{const {page:page=0x1,limit:limit=0x14,verified:_0x182016}=_0x5d1e3f['query'],_0x18d9ac=(Number(page)-0x1)*Number(limit),_0x473747={};_0x182016!==undefined&&(_0x473747[_0x3ce51b(0x169)]=_0x182016===_0x3ce51b(0x134));const [_0x2f4fd8,_0x281ac4]=await Promise[_0x3ce51b(0x135)]([database_1['default'][_0x3ce51b(0x14f)][_0x3ce51b(0x16c)]({'where':_0x473747,'skip':_0x18d9ac,'take':Number(limit),'orderBy':{'createdAt':_0x3ce51b(0x139)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x3ce51b(0x14d)][_0x3ce51b(0x14f)][_0x3ce51b(0x15f)]({'where':_0x473747})]);_0x291724[_0x3ce51b(0x175)]({'success':!![],'users':_0x2f4fd8[_0x3ce51b(0x12b)](_0x2eb93e=>({'id':_0x2eb93e['id'],'telegramId':_0x2eb93e[_0x3ce51b(0x13b)],'username':_0x2eb93e[_0x3ce51b(0x172)],'firstName':_0x2eb93e[_0x3ce51b(0x153)],'lastName':_0x2eb93e[_0x3ce51b(0x151)],'isVerified':_0x2eb93e[_0x3ce51b(0x169)],'shop':_0x2eb93e[_0x3ce51b(0x162)],'createdAt':_0x2eb93e[_0x3ce51b(0x13c)],'updatedAt':_0x2eb93e[_0x3ce51b(0x146)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x281ac4,'totalPages':Math[_0x3ce51b(0x143)](_0x281ac4/Number(limit))}});}catch(_0x2a64e6){_0x3e5393(_0x2a64e6);}},this[_0x4ae4e2(0x131)]=async(_0xedf04e,_0x4c8d19,_0x26f3c3)=>{const _0x2d8c38=_0x4ae4e2;try{const {message:_0x9953b1,shopId:_0x264a96}=_0xedf04e[_0x2d8c38(0x166)];if(!_0x9953b1)return _0x4c8d19['status'](0x190)[_0x2d8c38(0x175)]({'success':![],'message':_0x2d8c38(0x147)});if(_0x264a96)await telegramBotService_1[_0x2d8c38(0x138)]['sendShopNotification'](_0x264a96,_0x9953b1,{'parse_mode':_0x2d8c38(0x15e)});else{const _0x2bd14e=await database_1[_0x2d8c38(0x14d)][_0x2d8c38(0x14f)][_0x2d8c38(0x16c)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5b18dd=[...new Set(_0x2bd14e[_0x2d8c38(0x12b)](_0x22d9c6=>_0x22d9c6[_0x2d8c38(0x158)])[_0x2d8c38(0x132)](Boolean))];for(const _0x5f5a4a of _0x5b18dd){_0x5f5a4a&&await telegramBotService_1[_0x2d8c38(0x138)][_0x2d8c38(0x142)](_0x5f5a4a,_0x9953b1,{'parse_mode':_0x2d8c38(0x15e)});}}_0x4c8d19['json']({'success':!![],'message':_0x2d8c38(0x171)});}catch(_0x588ed8){_0x26f3c3(_0x588ed8);}},this['disconnectUser']=async(_0x1ddd8b,_0x5312a0,_0x33915d)=>{const _0x2110ab=_0x4ae4e2;try{const {telegramId:_0x315882}=_0x1ddd8b[_0x2110ab(0x144)],_0x538ea9=await database_1[_0x2110ab(0x14d)][_0x2110ab(0x14f)][_0x2110ab(0x14e)]({'where':{'telegramId':_0x315882},'include':{'shop':!![]}});if(!_0x538ea9)return _0x5312a0['status'](0x194)[_0x2110ab(0x175)]({'success':![],'message':_0x2110ab(0x148)});await database_1['default']['telegramUser'][_0x2110ab(0x145)]({'where':{'telegramId':_0x315882},'data':{'shopId':null,'isVerified':![]}}),_0x5312a0[_0x2110ab(0x175)]({'success':!![],'message':_0x2110ab(0x13e)});}catch(_0xb0aafb){_0x33915d(_0xb0aafb);}},this[_0x4ae4e2(0x16f)]=async(_0x4cd461,_0x352545,_0x28b2b8)=>{const _0x27f37e=_0x4ae4e2;try{const {shopId:_0x326a7a,type:type=_0x27f37e(0x150),testData:_0x49cd1}=_0x4cd461[_0x27f37e(0x166)];if(!_0x326a7a)return _0x352545[_0x27f37e(0x170)](0x190)[_0x27f37e(0x175)]({'success':![],'message':_0x27f37e(0x130)});const _0x281244=await database_1[_0x27f37e(0x14d)][_0x27f37e(0x162)]['findUnique']({'where':{'id':_0x326a7a},'select':{'id':!![],'name':!![]}});if(!_0x281244)return _0x352545['status'](0x194)[_0x27f37e(0x175)]({'success':![],'message':_0x27f37e(0x174)});switch(type){case _0x27f37e(0x150):const _0x2da40e={'id':_0x27f37e(0x15b),'amount':_0x49cd1?.['amount']||0x64,'currency':_0x49cd1?.['currency']||_0x27f37e(0x12f),'productName':_0x49cd1?.['productName']||_0x27f37e(0x140),'gateway':_0x49cd1?.[_0x27f37e(0x160)]||_0x27f37e(0x141),'createdAt':new Date(),..._0x49cd1};await telegramBotService_1[_0x27f37e(0x138)][_0x27f37e(0x136)](_0x326a7a,_0x2da40e,'paid');break;case _0x27f37e(0x161):const _0x108639={'id':_0x27f37e(0x16b),'amount':_0x49cd1?.[_0x27f37e(0x12e)]||0x1f4,'method':_0x49cd1?.['method']||'bank_transfer','createdAt':new Date(),..._0x49cd1};await telegramBotService_1[_0x27f37e(0x138)]['sendPayoutNotification'](_0x326a7a,_0x108639,_0x27f37e(0x13a));break;case _0x27f37e(0x173):await telegramBotService_1[_0x27f37e(0x138)][_0x27f37e(0x164)](_0x326a7a,_0x49cd1?.[_0x27f37e(0x155)]||'Test\x20Notification',_0x49cd1?.[_0x27f37e(0x137)]||{'message':_0x27f37e(0x14c)});break;default:return _0x352545[_0x27f37e(0x170)](0x190)[_0x27f37e(0x175)]({'success':![],'message':_0x27f37e(0x154)});}_0x352545['json']({'success':!![],'message':_0x27f37e(0x15d)+type+_0x27f37e(0x165)});}catch(_0x33c756){_0x28b2b8(_0x33c756);}};}}exports[a12_0x52ac1e(0x167)]=TelegramController;