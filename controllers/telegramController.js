'use strict';const a12_0x21aba0=a12_0x23fe;(function(_0x428a9e,_0x527174){const _0xc879e1=a12_0x23fe,_0x22a566=_0x428a9e();while(!![]){try{const _0xa8fe88=parseInt(_0xc879e1(0x8a))/0x1+parseInt(_0xc879e1(0xc0))/0x2+parseInt(_0xc879e1(0x9e))/0x3*(parseInt(_0xc879e1(0xae))/0x4)+-parseInt(_0xc879e1(0xb3))/0x5+parseInt(_0xc879e1(0xb5))/0x6*(-parseInt(_0xc879e1(0xc6))/0x7)+parseInt(_0xc879e1(0xb7))/0x8*(parseInt(_0xc879e1(0x96))/0x9)+-parseInt(_0xc879e1(0xc1))/0xa*(-parseInt(_0xc879e1(0x95))/0xb);if(_0xa8fe88===_0x527174)break;else _0x22a566['push'](_0x22a566['shift']());}catch(_0x375853){_0x22a566['push'](_0x22a566['shift']());}}}(a12_0x75b8,0xab829));var __importDefault=this&&this[a12_0x21aba0(0xbd)]||function(_0x4bc70b){const _0x4e706e=a12_0x21aba0;return _0x4bc70b&&_0x4bc70b[_0x4e706e(0x92)]?_0x4bc70b:{'default':_0x4bc70b};};function a12_0x75b8(){const _0x67cb8=['params','413ynpvnE','telegramId','default','sendCustomNotification','json','Test\x20Product','paid','count','desc','lastName','617103gsJCpH','status','User\x20disconnected\x20successfully','\x20notification\x20sent\x20successfully','Broadcast\x20message\x20sent\x20successfully','getBotStatus','telegramUser','sendTestNotification','__esModule','amount','Telegram\x20user\x20not\x20found','6160264EgeqHu','24273cgDAor','firstName','query','Markdown','method','username','map','payment','2487jPfgou','findUnique','isVerified','custom','shop','Test\x20','productName','disconnectUser','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','title','TelegramController','telegramBotService','details','sendShopNotification','currency','isActive','2672qvqtLN','getTelegramUsers','test_payment_123','body','update','5935435khjuWg','true','134298TmtGPh','updatedAt','2032DVhBPD','completed','../services/telegramBotService','bank_transfer','shopId','filter','__importDefault','length','groupBy','468456LTHyJK','20TuIZnK','USD','test_payout_123','defineProperty'];a12_0x75b8=function(){return _0x67cb8;};return a12_0x75b8();}Object[a12_0x21aba0(0xc4)](exports,a12_0x21aba0(0x92),{'value':!![]}),exports[a12_0x21aba0(0xa8)]=void 0x0;const telegramBotService_1=require(a12_0x21aba0(0xb9)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x28c68b=a12_0x21aba0;this[_0x28c68b(0x8f)]=async(_0x3f2f8c,_0x449635,_0xd93b43)=>{const _0x13236f=_0x28c68b;try{const _0x21bdb1=telegramBotService_1['telegramBotService']['getBotInfo'](),_0x1d26cf=await database_1[_0x13236f(0xc8)][_0x13236f(0x90)][_0x13236f(0x87)](),_0x5c03c3=await database_1['default']['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x27871f=await database_1['default']['telegramUser'][_0x13236f(0xbf)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x449635[_0x13236f(0x84)]({'success':!![],'result':{'bot':{'isActive':_0x21bdb1[_0x13236f(0xad)],'username':_0x21bdb1[_0x13236f(0x9b)]},'statistics':{'totalUsers':_0x1d26cf,'verifiedUsers':_0x5c03c3,'unverifiedUsers':_0x1d26cf-_0x5c03c3,'connectedShops':_0x27871f[_0x13236f(0xbe)]}}});}catch(_0xd1292d){_0xd93b43(_0xd1292d);}},this[_0x28c68b(0xaf)]=async(_0x1fc501,_0xe9bb7,_0x587d98)=>{const _0x4bc91d=_0x28c68b;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1744ee}=_0x1fc501[_0x4bc91d(0x98)],_0x40023a=(Number(page)-0x1)*Number(limit),_0x1bcf17={};_0x1744ee!==undefined&&(_0x1bcf17['isVerified']=_0x1744ee===_0x4bc91d(0xb4));const [_0x1c5535,_0x402cc4]=await Promise['all']([database_1[_0x4bc91d(0xc8)][_0x4bc91d(0x90)]['findMany']({'where':_0x1bcf17,'skip':_0x40023a,'take':Number(limit),'orderBy':{'createdAt':_0x4bc91d(0x88)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4bc91d(0xc8)]['telegramUser'][_0x4bc91d(0x87)]({'where':_0x1bcf17})]);_0xe9bb7[_0x4bc91d(0x84)]({'success':!![],'users':_0x1c5535['map'](_0x2ab501=>({'id':_0x2ab501['id'],'telegramId':_0x2ab501[_0x4bc91d(0xc7)],'username':_0x2ab501['username'],'firstName':_0x2ab501[_0x4bc91d(0x97)],'lastName':_0x2ab501[_0x4bc91d(0x89)],'isVerified':_0x2ab501[_0x4bc91d(0xa0)],'shop':_0x2ab501['shop'],'createdAt':_0x2ab501['createdAt'],'updatedAt':_0x2ab501[_0x4bc91d(0xb6)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x402cc4,'totalPages':Math['ceil'](_0x402cc4/Number(limit))}});}catch(_0x33a533){_0x587d98(_0x33a533);}},this['sendBroadcast']=async(_0x31f6c0,_0x4a64ac,_0xa2f8d7)=>{const _0x4ea0af=_0x28c68b;try{const {message:_0x3c270b,shopId:_0x2fb2b1}=_0x31f6c0[_0x4ea0af(0xb1)];if(!_0x3c270b)return _0x4a64ac[_0x4ea0af(0x8b)](0x190)[_0x4ea0af(0x84)]({'success':![],'message':'Message\x20is\x20required'});if(_0x2fb2b1)await telegramBotService_1[_0x4ea0af(0xa9)][_0x4ea0af(0xab)](_0x2fb2b1,_0x3c270b,{'parse_mode':_0x4ea0af(0x99)});else{const _0xc65f3d=await database_1[_0x4ea0af(0xc8)][_0x4ea0af(0x90)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5abf78=[...new Set(_0xc65f3d[_0x4ea0af(0x9c)](_0x1e0b1a=>_0x1e0b1a[_0x4ea0af(0xbb)])[_0x4ea0af(0xbc)](Boolean))];for(const _0x32d896 of _0x5abf78){_0x32d896&&await telegramBotService_1[_0x4ea0af(0xa9)][_0x4ea0af(0xab)](_0x32d896,_0x3c270b,{'parse_mode':_0x4ea0af(0x99)});}}_0x4a64ac[_0x4ea0af(0x84)]({'success':!![],'message':_0x4ea0af(0x8e)});}catch(_0x5427c6){_0xa2f8d7(_0x5427c6);}},this[_0x28c68b(0xa5)]=async(_0x29fefb,_0x4cb1c9,_0x1b70e2)=>{const _0x186e5a=_0x28c68b;try{const {telegramId:_0x280f50}=_0x29fefb[_0x186e5a(0xc5)],_0x6b1e22=await database_1[_0x186e5a(0xc8)][_0x186e5a(0x90)][_0x186e5a(0x9f)]({'where':{'telegramId':_0x280f50},'include':{'shop':!![]}});if(!_0x6b1e22)return _0x4cb1c9['status'](0x194)[_0x186e5a(0x84)]({'success':![],'message':_0x186e5a(0x94)});await database_1[_0x186e5a(0xc8)][_0x186e5a(0x90)][_0x186e5a(0xb2)]({'where':{'telegramId':_0x280f50},'data':{'shopId':null,'isVerified':![]}}),_0x4cb1c9[_0x186e5a(0x84)]({'success':!![],'message':_0x186e5a(0x8c)});}catch(_0x3e6386){_0x1b70e2(_0x3e6386);}},this[_0x28c68b(0x91)]=async(_0x47b9ea,_0x534e8c,_0x4e19c3)=>{const _0x48dbfb=_0x28c68b;try{const {shopId:_0x761fa8,type:type=_0x48dbfb(0x9d),testData:_0x282e61}=_0x47b9ea['body'];if(!_0x761fa8)return _0x534e8c['status'](0x190)['json']({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x2c7b99=await database_1[_0x48dbfb(0xc8)][_0x48dbfb(0xa2)]['findUnique']({'where':{'id':_0x761fa8},'select':{'id':!![],'name':!![]}});if(!_0x2c7b99)return _0x534e8c[_0x48dbfb(0x8b)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x48dbfb(0x9d):const _0x48da6e={'id':_0x48dbfb(0xb0),'amount':_0x282e61?.[_0x48dbfb(0x93)]||0x64,'currency':_0x282e61?.[_0x48dbfb(0xac)]||_0x48dbfb(0xc2),'productName':_0x282e61?.[_0x48dbfb(0xa4)]||_0x48dbfb(0x85),'gateway':_0x282e61?.['gateway']||'plisio','createdAt':new Date(),..._0x282e61};await telegramBotService_1[_0x48dbfb(0xa9)]['sendPaymentNotification'](_0x761fa8,_0x48da6e,_0x48dbfb(0x86));break;case'payout':const _0x5b48b5={'id':_0x48dbfb(0xc3),'amount':_0x282e61?.[_0x48dbfb(0x93)]||0x1f4,'method':_0x282e61?.[_0x48dbfb(0x9a)]||_0x48dbfb(0xba),'createdAt':new Date(),..._0x282e61};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x761fa8,_0x5b48b5,_0x48dbfb(0xb8));break;case _0x48dbfb(0xa1):await telegramBotService_1[_0x48dbfb(0xa9)][_0x48dbfb(0xc9)](_0x761fa8,_0x282e61?.[_0x48dbfb(0xa7)]||'Test\x20Notification',_0x282e61?.[_0x48dbfb(0xaa)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x534e8c[_0x48dbfb(0x8b)](0x190)[_0x48dbfb(0x84)]({'success':![],'message':_0x48dbfb(0xa6)});}_0x534e8c[_0x48dbfb(0x84)]({'success':!![],'message':_0x48dbfb(0xa3)+type+_0x48dbfb(0x8d)});}catch(_0x1e09be){_0x4e19c3(_0x1e09be);}};}}function a12_0x23fe(_0x4fc999,_0x1a88c0){const _0x75b888=a12_0x75b8();return a12_0x23fe=function(_0x23fe05,_0x183cc2){_0x23fe05=_0x23fe05-0x84;let _0xe796f9=_0x75b888[_0x23fe05];return _0xe796f9;},a12_0x23fe(_0x4fc999,_0x1a88c0);}exports['TelegramController']=TelegramController;