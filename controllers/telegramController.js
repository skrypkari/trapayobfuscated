'use strict';const a12_0x584f21=a12_0x29a8;(function(_0x5d4327,_0xe916a8){const _0x596fdd=a12_0x29a8,_0x9a3cd8=_0x5d4327();while(!![]){try{const _0xa696f9=parseInt(_0x596fdd(0x179))/0x1+-parseInt(_0x596fdd(0x15d))/0x2*(parseInt(_0x596fdd(0x194))/0x3)+parseInt(_0x596fdd(0x14e))/0x4*(parseInt(_0x596fdd(0x176))/0x5)+-parseInt(_0x596fdd(0x16c))/0x6+-parseInt(_0x596fdd(0x191))/0x7*(parseInt(_0x596fdd(0x14d))/0x8)+parseInt(_0x596fdd(0x16b))/0x9*(parseInt(_0x596fdd(0x17b))/0xa)+-parseInt(_0x596fdd(0x154))/0xb*(parseInt(_0x596fdd(0x17e))/0xc);if(_0xa696f9===_0xe916a8)break;else _0x9a3cd8['push'](_0x9a3cd8['shift']());}catch(_0x2e646f){_0x9a3cd8['push'](_0x9a3cd8['shift']());}}}(a12_0xd25c,0x685c8));function a12_0x29a8(_0xc9161a,_0x3da829){const _0xd25c5d=a12_0xd25c();return a12_0x29a8=function(_0x29a859,_0x29d2c6){_0x29a859=_0x29a859-0x14d;let _0x8abd25=_0xd25c5d[_0x29a859];return _0x8abd25;},a12_0x29a8(_0xc9161a,_0x3da829);}var __importDefault=this&&this[a12_0x584f21(0x18c)]||function(_0x32e3f3){const _0x47395a=a12_0x584f21;return _0x32e3f3&&_0x32e3f3[_0x47395a(0x180)]?_0x32e3f3:{'default':_0x32e3f3};};Object[a12_0x584f21(0x17c)](exports,a12_0x584f21(0x180),{'value':!![]}),exports[a12_0x584f21(0x169)]=void 0x0;function a12_0xd25c(){const _0x5a03e2=['User\x20disconnected\x20successfully','5RNvxgU','amount','custom','126316NVaQaw','paid','10soEAId','defineProperty','body','57012ZOzzhw','sendTestNotification','__esModule','title','ceil','../config/database','desc','query','payout','default','Test\x20Product','getBotStatus','createdAt','Telegram\x20user\x20not\x20found','__importDefault','updatedAt','status','isVerified','payment','863527FfMLSt','sendPaymentNotification','filter','18xXjsYJ','16mkmmoV','2220844mCugBP','productName','map','count','\x20notification\x20sent\x20successfully','plisio','605POHegj','method','length','Broadcast\x20message\x20sent\x20successfully','Test\x20','telegramUser','findMany','findUnique','sendBroadcast','54492ywRiPm','username','details','update','sendPayoutNotification','sendCustomNotification','telegramBotService','completed','../services/telegramBotService','groupBy','Shop\x20not\x20found','Message\x20is\x20required','TelegramController','shop','7039161thadNf','2188134UIaKKo','Markdown','json','true','test_payout_123','shopId','This\x20is\x20a\x20test\x20notification','sendShopNotification','getBotInfo'];a12_0xd25c=function(){return _0x5a03e2;};return a12_0xd25c();}const telegramBotService_1=require(a12_0x584f21(0x165)),database_1=__importDefault(require(a12_0x584f21(0x183)));class TelegramController{constructor(){const _0x3443a5=a12_0x584f21;this[_0x3443a5(0x189)]=async(_0x488e42,_0x2e9bdd,_0x40ea03)=>{const _0x514dc0=_0x3443a5;try{const _0x54a059=telegramBotService_1[_0x514dc0(0x163)][_0x514dc0(0x174)](),_0x488324=await database_1[_0x514dc0(0x187)][_0x514dc0(0x159)][_0x514dc0(0x151)](),_0x27e168=await database_1[_0x514dc0(0x187)][_0x514dc0(0x159)][_0x514dc0(0x151)]({'where':{'isVerified':!![]}}),_0x24402f=await database_1[_0x514dc0(0x187)][_0x514dc0(0x159)][_0x514dc0(0x166)]({'by':[_0x514dc0(0x171)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2e9bdd[_0x514dc0(0x16e)]({'success':!![],'result':{'bot':{'isActive':_0x54a059['isActive'],'username':_0x54a059[_0x514dc0(0x15e)]},'statistics':{'totalUsers':_0x488324,'verifiedUsers':_0x27e168,'unverifiedUsers':_0x488324-_0x27e168,'connectedShops':_0x24402f[_0x514dc0(0x156)]}}});}catch(_0x235d3f){_0x40ea03(_0x235d3f);}},this['getTelegramUsers']=async(_0x520e7e,_0x33b7be,_0x277367)=>{const _0x33e041=_0x3443a5;try{const {page:page=0x1,limit:limit=0x14,verified:_0x386be0}=_0x520e7e[_0x33e041(0x185)],_0x3d9214=(Number(page)-0x1)*Number(limit),_0x408a69={};_0x386be0!==undefined&&(_0x408a69[_0x33e041(0x18f)]=_0x386be0===_0x33e041(0x16f));const [_0x218e35,_0x34d168]=await Promise['all']([database_1[_0x33e041(0x187)][_0x33e041(0x159)][_0x33e041(0x15a)]({'where':_0x408a69,'skip':_0x3d9214,'take':Number(limit),'orderBy':{'createdAt':_0x33e041(0x184)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x33e041(0x159)]['count']({'where':_0x408a69})]);_0x33b7be[_0x33e041(0x16e)]({'success':!![],'users':_0x218e35[_0x33e041(0x150)](_0x472e28=>({'id':_0x472e28['id'],'telegramId':_0x472e28['telegramId'],'username':_0x472e28[_0x33e041(0x15e)],'firstName':_0x472e28['firstName'],'lastName':_0x472e28['lastName'],'isVerified':_0x472e28[_0x33e041(0x18f)],'shop':_0x472e28[_0x33e041(0x16a)],'createdAt':_0x472e28[_0x33e041(0x18a)],'updatedAt':_0x472e28[_0x33e041(0x18d)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x34d168,'totalPages':Math[_0x33e041(0x182)](_0x34d168/Number(limit))}});}catch(_0x1611bc){_0x277367(_0x1611bc);}},this[_0x3443a5(0x15c)]=async(_0x5cc769,_0x55d89f,_0x5c5525)=>{const _0x4780f1=_0x3443a5;try{const {message:_0x153ecb,shopId:_0xc3d048}=_0x5cc769[_0x4780f1(0x17d)];if(!_0x153ecb)return _0x55d89f['status'](0x190)['json']({'success':![],'message':_0x4780f1(0x168)});if(_0xc3d048)await telegramBotService_1[_0x4780f1(0x163)][_0x4780f1(0x173)](_0xc3d048,_0x153ecb,{'parse_mode':_0x4780f1(0x16d)});else{const _0x5256a7=await database_1['default'][_0x4780f1(0x159)][_0x4780f1(0x15a)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x58bb02=[...new Set(_0x5256a7[_0x4780f1(0x150)](_0x484648=>_0x484648['shopId'])[_0x4780f1(0x193)](Boolean))];for(const _0x2466fd of _0x58bb02){_0x2466fd&&await telegramBotService_1[_0x4780f1(0x163)][_0x4780f1(0x173)](_0x2466fd,_0x153ecb,{'parse_mode':'Markdown'});}}_0x55d89f[_0x4780f1(0x16e)]({'success':!![],'message':_0x4780f1(0x157)});}catch(_0x30db3f){_0x5c5525(_0x30db3f);}},this['disconnectUser']=async(_0x3982b1,_0x2bff25,_0x1c2b27)=>{const _0x53b3eb=_0x3443a5;try{const {telegramId:_0x17d896}=_0x3982b1['params'],_0x42f5ad=await database_1[_0x53b3eb(0x187)][_0x53b3eb(0x159)][_0x53b3eb(0x15b)]({'where':{'telegramId':_0x17d896},'include':{'shop':!![]}});if(!_0x42f5ad)return _0x2bff25['status'](0x194)['json']({'success':![],'message':_0x53b3eb(0x18b)});await database_1['default'][_0x53b3eb(0x159)][_0x53b3eb(0x160)]({'where':{'telegramId':_0x17d896},'data':{'shopId':null,'isVerified':![]}}),_0x2bff25['json']({'success':!![],'message':_0x53b3eb(0x175)});}catch(_0x1aaa69){_0x1c2b27(_0x1aaa69);}},this[_0x3443a5(0x17f)]=async(_0x4b76a9,_0x3c4abc,_0x1219b4)=>{const _0x37b55d=_0x3443a5;try{const {shopId:_0x53975a,type:type=_0x37b55d(0x190),testData:_0x2c8a3a}=_0x4b76a9[_0x37b55d(0x17d)];if(!_0x53975a)return _0x3c4abc[_0x37b55d(0x18e)](0x190)[_0x37b55d(0x16e)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x5bec54=await database_1[_0x37b55d(0x187)]['shop']['findUnique']({'where':{'id':_0x53975a},'select':{'id':!![],'name':!![]}});if(!_0x5bec54)return _0x3c4abc[_0x37b55d(0x18e)](0x194)[_0x37b55d(0x16e)]({'success':![],'message':_0x37b55d(0x167)});switch(type){case _0x37b55d(0x190):const _0x45055f={'id':'test_payment_123','amount':_0x2c8a3a?.[_0x37b55d(0x177)]||0x64,'currency':_0x2c8a3a?.['currency']||'USD','productName':_0x2c8a3a?.[_0x37b55d(0x14f)]||_0x37b55d(0x188),'gateway':_0x2c8a3a?.['gateway']||_0x37b55d(0x153),'createdAt':new Date(),..._0x2c8a3a};await telegramBotService_1['telegramBotService'][_0x37b55d(0x192)](_0x53975a,_0x45055f,_0x37b55d(0x17a));break;case _0x37b55d(0x186):const _0x1ad5bc={'id':_0x37b55d(0x170),'amount':_0x2c8a3a?.[_0x37b55d(0x177)]||0x1f4,'method':_0x2c8a3a?.[_0x37b55d(0x155)]||'bank_transfer','createdAt':new Date(),..._0x2c8a3a};await telegramBotService_1[_0x37b55d(0x163)][_0x37b55d(0x161)](_0x53975a,_0x1ad5bc,_0x37b55d(0x164));break;case _0x37b55d(0x178):await telegramBotService_1[_0x37b55d(0x163)][_0x37b55d(0x162)](_0x53975a,_0x2c8a3a?.[_0x37b55d(0x181)]||'Test\x20Notification',_0x2c8a3a?.[_0x37b55d(0x15f)]||{'message':_0x37b55d(0x172)});break;default:return _0x3c4abc['status'](0x190)[_0x37b55d(0x16e)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x3c4abc['json']({'success':!![],'message':_0x37b55d(0x158)+type+_0x37b55d(0x152)});}catch(_0x27809d){_0x1219b4(_0x27809d);}};}}exports[a12_0x584f21(0x169)]=TelegramController;