'use strict';function a12_0x57ff(_0x28a4d7,_0x4e69a5){const _0x3e9103=a12_0x3e91();return a12_0x57ff=function(_0x57ff27,_0x4256a2){_0x57ff27=_0x57ff27-0x165;let _0x1ee38e=_0x3e9103[_0x57ff27];return _0x1ee38e;},a12_0x57ff(_0x28a4d7,_0x4e69a5);}const a12_0x499326=a12_0x57ff;(function(_0x2ae51f,_0x2b9769){const _0x59d7a0=a12_0x57ff,_0x361ee5=_0x2ae51f();while(!![]){try{const _0x328485=-parseInt(_0x59d7a0(0x18c))/0x1+parseInt(_0x59d7a0(0x18e))/0x2*(-parseInt(_0x59d7a0(0x18d))/0x3)+parseInt(_0x59d7a0(0x16b))/0x4+parseInt(_0x59d7a0(0x171))/0x5+parseInt(_0x59d7a0(0x167))/0x6*(parseInt(_0x59d7a0(0x180))/0x7)+-parseInt(_0x59d7a0(0x198))/0x8+-parseInt(_0x59d7a0(0x17a))/0x9;if(_0x328485===_0x2b9769)break;else _0x361ee5['push'](_0x361ee5['shift']());}catch(_0x54f7ed){_0x361ee5['push'](_0x361ee5['shift']());}}}(a12_0x3e91,0xae7f4));var __importDefault=this&&this['__importDefault']||function(_0x4ebf86){const _0x240b27=a12_0x57ff;return _0x4ebf86&&_0x4ebf86[_0x240b27(0x17e)]?_0x4ebf86:{'default':_0x4ebf86};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a12_0x499326(0x194)]=void 0x0;const telegramBotService_1=require(a12_0x499326(0x1a4)),database_1=__importDefault(require(a12_0x499326(0x1a7)));class TelegramController{constructor(){const _0x476d06=a12_0x499326;this['getBotStatus']=async(_0x3e4a76,_0x27887e,_0x5c9606)=>{const _0x53a0cb=a12_0x57ff;try{const _0x5b1295=telegramBotService_1['telegramBotService'][_0x53a0cb(0x1a1)](),_0x330129=await database_1[_0x53a0cb(0x199)]['telegramUser']['count'](),_0x32f4b1=await database_1[_0x53a0cb(0x199)]['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x5095c3=await database_1[_0x53a0cb(0x199)]['telegramUser'][_0x53a0cb(0x16e)]({'by':[_0x53a0cb(0x193)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x27887e[_0x53a0cb(0x166)]({'success':!![],'result':{'bot':{'isActive':_0x5b1295[_0x53a0cb(0x181)],'username':_0x5b1295[_0x53a0cb(0x18b)]},'statistics':{'totalUsers':_0x330129,'verifiedUsers':_0x32f4b1,'unverifiedUsers':_0x330129-_0x32f4b1,'connectedShops':_0x5095c3[_0x53a0cb(0x19d)]}}});}catch(_0x449f0d){_0x5c9606(_0x449f0d);}},this[_0x476d06(0x197)]=async(_0x399d29,_0x135299,_0xdd0348)=>{const _0x46a57d=_0x476d06;try{const {page:page=0x1,limit:limit=0x14,verified:_0x168340}=_0x399d29[_0x46a57d(0x19b)],_0x2ef416=(Number(page)-0x1)*Number(limit),_0x48b1a6={};_0x168340!==undefined&&(_0x48b1a6['isVerified']=_0x168340==='true');const [_0x237101,_0x1b147d]=await Promise[_0x46a57d(0x19c)]([database_1['default'][_0x46a57d(0x1a2)][_0x46a57d(0x190)]({'where':_0x48b1a6,'skip':_0x2ef416,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x46a57d(0x1a2)]['count']({'where':_0x48b1a6})]);_0x135299[_0x46a57d(0x166)]({'success':!![],'users':_0x237101['map'](_0x37d641=>({'id':_0x37d641['id'],'telegramId':_0x37d641[_0x46a57d(0x195)],'username':_0x37d641[_0x46a57d(0x18b)],'firstName':_0x37d641['firstName'],'lastName':_0x37d641[_0x46a57d(0x176)],'isVerified':_0x37d641['isVerified'],'shop':_0x37d641[_0x46a57d(0x17b)],'createdAt':_0x37d641[_0x46a57d(0x17f)],'updatedAt':_0x37d641[_0x46a57d(0x174)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1b147d,'totalPages':Math[_0x46a57d(0x175)](_0x1b147d/Number(limit))}});}catch(_0x5c5876){_0xdd0348(_0x5c5876);}},this['sendBroadcast']=async(_0x19992e,_0x32ec14,_0x55df46)=>{const _0x40edfa=_0x476d06;try{const {message:_0x51b8ae,shopId:_0x39233a}=_0x19992e[_0x40edfa(0x173)];if(!_0x51b8ae)return _0x32ec14[_0x40edfa(0x183)](0x190)['json']({'success':![],'message':_0x40edfa(0x182)});if(_0x39233a)await telegramBotService_1[_0x40edfa(0x169)][_0x40edfa(0x192)](_0x39233a,_0x51b8ae,{'parse_mode':_0x40edfa(0x16a)});else{const _0x1ab34f=await database_1[_0x40edfa(0x199)][_0x40edfa(0x1a2)][_0x40edfa(0x190)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x10f5e5=[...new Set(_0x1ab34f[_0x40edfa(0x16c)](_0x378688=>_0x378688[_0x40edfa(0x193)])[_0x40edfa(0x172)](Boolean))];for(const _0x2832a7 of _0x10f5e5){_0x2832a7&&await telegramBotService_1[_0x40edfa(0x169)][_0x40edfa(0x192)](_0x2832a7,_0x51b8ae,{'parse_mode':_0x40edfa(0x16a)});}}_0x32ec14[_0x40edfa(0x166)]({'success':!![],'message':_0x40edfa(0x1a0)});}catch(_0x4a4861){_0x55df46(_0x4a4861);}},this[_0x476d06(0x170)]=async(_0x50f275,_0xf6abf6,_0xb53c05)=>{const _0x58d859=_0x476d06;try{const {telegramId:_0x43bec9}=_0x50f275[_0x58d859(0x17c)],_0x2ff0f6=await database_1[_0x58d859(0x199)][_0x58d859(0x1a2)]['findUnique']({'where':{'telegramId':_0x43bec9},'include':{'shop':!![]}});if(!_0x2ff0f6)return _0xf6abf6[_0x58d859(0x183)](0x194)[_0x58d859(0x166)]({'success':![],'message':_0x58d859(0x18f)});await database_1[_0x58d859(0x199)][_0x58d859(0x1a2)][_0x58d859(0x185)]({'where':{'telegramId':_0x43bec9},'data':{'shopId':null,'isVerified':![]}}),_0xf6abf6[_0x58d859(0x166)]({'success':!![],'message':_0x58d859(0x191)});}catch(_0x4d884b){_0xb53c05(_0x4d884b);}},this[_0x476d06(0x168)]=async(_0x49b8f2,_0x496aa8,_0x3deacf)=>{const _0x4484e5=_0x476d06;try{const {shopId:_0xeea4dc,type:type=_0x4484e5(0x1a5),testData:_0x36e337}=_0x49b8f2[_0x4484e5(0x173)];if(!_0xeea4dc)return _0x496aa8[_0x4484e5(0x183)](0x190)['json']({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x309036=await database_1[_0x4484e5(0x199)]['shop']['findUnique']({'where':{'id':_0xeea4dc},'select':{'id':!![],'name':!![]}});if(!_0x309036)return _0x496aa8['status'](0x194)[_0x4484e5(0x166)]({'success':![],'message':_0x4484e5(0x19e)});switch(type){case _0x4484e5(0x1a5):const _0x21f88={'id':_0x4484e5(0x16d),'amount':_0x36e337?.[_0x4484e5(0x187)]||0x64,'currency':_0x36e337?.[_0x4484e5(0x165)]||_0x4484e5(0x196),'productName':_0x36e337?.[_0x4484e5(0x184)]||'Test\x20Product','gateway':_0x36e337?.[_0x4484e5(0x189)]||_0x4484e5(0x16f),'createdAt':new Date(),..._0x36e337};await telegramBotService_1[_0x4484e5(0x169)][_0x4484e5(0x1a3)](_0xeea4dc,_0x21f88,_0x4484e5(0x177));break;case _0x4484e5(0x179):const _0x45b2c5={'id':_0x4484e5(0x17d),'amount':_0x36e337?.['amount']||0x1f4,'method':_0x36e337?.[_0x4484e5(0x19a)]||_0x4484e5(0x186),'createdAt':new Date(),..._0x36e337};await telegramBotService_1[_0x4484e5(0x169)]['sendPayoutNotification'](_0xeea4dc,_0x45b2c5,_0x4484e5(0x18a));break;case'custom':await telegramBotService_1[_0x4484e5(0x169)]['sendCustomNotification'](_0xeea4dc,_0x36e337?.['title']||'Test\x20Notification',_0x36e337?.[_0x4484e5(0x19f)]||{'message':_0x4484e5(0x178)});break;default:return _0x496aa8[_0x4484e5(0x183)](0x190)[_0x4484e5(0x166)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x496aa8[_0x4484e5(0x166)]({'success':!![],'message':_0x4484e5(0x188)+type+_0x4484e5(0x1a6)});}catch(_0x2e29b3){_0x3deacf(_0x2e29b3);}};}}exports[a12_0x499326(0x194)]=TelegramController;function a12_0x3e91(){const _0x2e8cf0=['gateway','completed','username','1264703ikClPc','432501NqboDI','2UQWdaW','Telegram\x20user\x20not\x20found','findMany','User\x20disconnected\x20successfully','sendShopNotification','shopId','TelegramController','telegramId','USD','getTelegramUsers','3020024dpxiVO','default','method','query','all','length','Shop\x20not\x20found','details','Broadcast\x20message\x20sent\x20successfully','getBotInfo','telegramUser','sendPaymentNotification','../services/telegramBotService','payment','\x20notification\x20sent\x20successfully','../config/database','currency','json','60qKhWHg','sendTestNotification','telegramBotService','Markdown','2317984yzVttS','map','test_payment_123','groupBy','plisio','disconnectUser','3648500crXoVu','filter','body','updatedAt','ceil','lastName','paid','This\x20is\x20a\x20test\x20notification','payout','2062647yFrNrm','shop','params','test_payout_123','__esModule','createdAt','994770wKLDuZ','isActive','Message\x20is\x20required','status','productName','update','bank_transfer','amount','Test\x20'];a12_0x3e91=function(){return _0x2e8cf0;};return a12_0x3e91();}