'use strict';const a14_0x1899c4=a14_0x1929;(function(_0x13a540,_0x272cbc){const _0x29ccd9=a14_0x1929,_0x46e805=_0x13a540();while(!![]){try{const _0x29489c=parseInt(_0x29ccd9(0x13e))/0x1+parseInt(_0x29ccd9(0x11f))/0x2*(parseInt(_0x29ccd9(0x126))/0x3)+parseInt(_0x29ccd9(0x12a))/0x4*(parseInt(_0x29ccd9(0x116))/0x5)+-parseInt(_0x29ccd9(0x121))/0x6+parseInt(_0x29ccd9(0x12e))/0x7*(parseInt(_0x29ccd9(0x110))/0x8)+-parseInt(_0x29ccd9(0x131))/0x9*(-parseInt(_0x29ccd9(0x11b))/0xa)+-parseInt(_0x29ccd9(0x14f))/0xb;if(_0x29489c===_0x272cbc)break;else _0x46e805['push'](_0x46e805['shift']());}catch(_0x411236){_0x46e805['push'](_0x46e805['shift']());}}}(a14_0x5273,0xd615a));function a14_0x5273(){const _0x54a5e4=['firstName','query','map','txid','isActive','wallet','shopId','Test\x20Product','sendShopNotification','groupBy','50096904dMZIyB','USD','ceil','disconnectUser','telegramUser','payment','Test\x20','getTelegramUsers','username','Broadcast\x20message\x20sent\x20successfully','TRC20','paid','telegramId','__esModule','test_payment_123','944344JdvKKL','getBotStatus','sendTestNotification','title','telegramBotService','__importDefault','10cwqpJY','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','defineProperty','Shop\x20not\x20found','details','1021790dLIiLd','filter','Shop\x20ID\x20is\x20required','currency','155734dvMDKX','TelegramController','2898516pbCgBf','Message\x20is\x20required','User\x20disconnected\x20successfully','json','findUnique','51eOtGAm','payout','params','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','1834332beHRrL','sendPayoutNotification','default','\x20notification\x20sent\x20successfully','91gUalYY','createdAt','../services/telegramBotService','45HAveai','count','shop','true','This\x20is\x20a\x20test\x20notification','updatedAt','gateway','amount','body','custom','Тестовый\x20период','../config/database','Telegram\x20user\x20not\x20found','1627881UFSnzp','length','Test\x20Notification','findMany','sendPaymentNotification','status','sendCustomNotification'];a14_0x5273=function(){return _0x54a5e4;};return a14_0x5273();}var __importDefault=this&&this[a14_0x1899c4(0x115)]||function(_0xe7f6ba){const _0x14dd24=a14_0x1899c4;return _0xe7f6ba&&_0xe7f6ba[_0x14dd24(0x10e)]?_0xe7f6ba:{'default':_0xe7f6ba};};Object[a14_0x1899c4(0x118)](exports,'__esModule',{'value':!![]}),exports[a14_0x1899c4(0x120)]=void 0x0;const telegramBotService_1=require(a14_0x1899c4(0x130)),database_1=__importDefault(require(a14_0x1899c4(0x13c)));class TelegramController{constructor(){const _0x44e192=a14_0x1899c4;this[_0x44e192(0x111)]=async(_0x116666,_0x4bbc66,_0x7e487a)=>{const _0x12a22b=_0x44e192;try{const _0x3e8831=telegramBotService_1[_0x12a22b(0x114)]['getBotInfo'](),_0x2b0154=await database_1[_0x12a22b(0x12c)]['telegramUser']['count'](),_0x10589e=await database_1[_0x12a22b(0x12c)][_0x12a22b(0x105)]['count']({'where':{'isVerified':!![]}}),_0x73a3b7=await database_1['default'][_0x12a22b(0x105)][_0x12a22b(0x14e)]({'by':[_0x12a22b(0x14b)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4bbc66[_0x12a22b(0x124)]({'success':!![],'result':{'bot':{'isActive':_0x3e8831[_0x12a22b(0x149)],'username':_0x3e8831['username']},'statistics':{'totalUsers':_0x2b0154,'verifiedUsers':_0x10589e,'unverifiedUsers':_0x2b0154-_0x10589e,'connectedShops':_0x73a3b7[_0x12a22b(0x13f)]}}});}catch(_0x18a7c){_0x7e487a(_0x18a7c);}},this[_0x44e192(0x108)]=async(_0x3d30d8,_0x5f3061,_0x3c6875)=>{const _0x272ccd=_0x44e192;try{const {page:page=0x1,limit:limit=0x14,verified:_0x54f09d}=_0x3d30d8[_0x272ccd(0x146)],_0x37d408=(Number(page)-0x1)*Number(limit),_0xe19fb0={};_0x54f09d!==undefined&&(_0xe19fb0['isVerified']=_0x54f09d===_0x272ccd(0x134));const [_0x386f01,_0x31967c]=await Promise['all']([database_1['default']['telegramUser'][_0x272ccd(0x141)]({'where':_0xe19fb0,'skip':_0x37d408,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x272ccd(0x12c)]['telegramUser'][_0x272ccd(0x132)]({'where':_0xe19fb0})]);_0x5f3061['json']({'success':!![],'users':_0x386f01['map'](_0x4e41f7=>({'id':_0x4e41f7['id'],'telegramId':_0x4e41f7[_0x272ccd(0x10d)],'username':_0x4e41f7[_0x272ccd(0x109)],'firstName':_0x4e41f7[_0x272ccd(0x145)],'lastName':_0x4e41f7['lastName'],'isVerified':_0x4e41f7['isVerified'],'shop':_0x4e41f7[_0x272ccd(0x133)],'createdAt':_0x4e41f7[_0x272ccd(0x12f)],'updatedAt':_0x4e41f7[_0x272ccd(0x136)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x31967c,'totalPages':Math[_0x272ccd(0x151)](_0x31967c/Number(limit))}});}catch(_0x2cd7d0){_0x3c6875(_0x2cd7d0);}},this['sendBroadcast']=async(_0x393a4e,_0x33d9fb,_0x2ecf79)=>{const _0x7e1e84=_0x44e192;try{const {message:_0x5de22,shopId:_0x4c8667}=_0x393a4e['body'];if(!_0x5de22)return _0x33d9fb[_0x7e1e84(0x143)](0x190)['json']({'success':![],'message':_0x7e1e84(0x122)});if(_0x4c8667)await telegramBotService_1['telegramBotService'][_0x7e1e84(0x14d)](_0x4c8667,_0x5de22,{'parse_mode':'Markdown'});else{const _0x4fd8bc=await database_1[_0x7e1e84(0x12c)][_0x7e1e84(0x105)][_0x7e1e84(0x141)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x152815=[...new Set(_0x4fd8bc[_0x7e1e84(0x147)](_0x1a0ab1=>_0x1a0ab1['shopId'])[_0x7e1e84(0x11c)](Boolean))];for(const _0xbca69b of _0x152815){_0xbca69b&&await telegramBotService_1['telegramBotService'][_0x7e1e84(0x14d)](_0xbca69b,_0x5de22,{'parse_mode':'Markdown'});}}_0x33d9fb[_0x7e1e84(0x124)]({'success':!![],'message':_0x7e1e84(0x10a)});}catch(_0x36988e){_0x2ecf79(_0x36988e);}},this[_0x44e192(0x104)]=async(_0x25082a,_0x4719b3,_0x54f615)=>{const _0x13b9a=_0x44e192;try{const {telegramId:_0x5ffddd}=_0x25082a[_0x13b9a(0x128)],_0xda8e4f=await database_1[_0x13b9a(0x12c)][_0x13b9a(0x105)][_0x13b9a(0x125)]({'where':{'telegramId':_0x5ffddd},'include':{'shop':!![]}});if(!_0xda8e4f)return _0x4719b3[_0x13b9a(0x143)](0x194)['json']({'success':![],'message':_0x13b9a(0x13d)});await database_1['default'][_0x13b9a(0x105)]['update']({'where':{'telegramId':_0x5ffddd},'data':{'shopId':null,'isVerified':![]}}),_0x4719b3[_0x13b9a(0x124)]({'success':!![],'message':_0x13b9a(0x123)});}catch(_0x1d17d6){_0x54f615(_0x1d17d6);}},this[_0x44e192(0x112)]=async(_0x3c5db2,_0x39bda7,_0x13252d)=>{const _0x3ee740=_0x44e192;try{const {shopId:_0x2eae6c,type:type=_0x3ee740(0x106),testData:_0x245820}=_0x3c5db2[_0x3ee740(0x139)];if(!_0x2eae6c)return _0x39bda7[_0x3ee740(0x143)](0x190)[_0x3ee740(0x124)]({'success':![],'message':_0x3ee740(0x11d)});const _0x5ef867=await database_1[_0x3ee740(0x12c)][_0x3ee740(0x133)][_0x3ee740(0x125)]({'where':{'id':_0x2eae6c},'select':{'id':!![],'name':!![]}});if(!_0x5ef867)return _0x39bda7[_0x3ee740(0x143)](0x194)[_0x3ee740(0x124)]({'success':![],'message':_0x3ee740(0x119)});switch(type){case'payment':const _0x2aab8d={'id':_0x3ee740(0x10f),'amount':_0x245820?.[_0x3ee740(0x138)]||0x64,'currency':_0x245820?.[_0x3ee740(0x11e)]||_0x3ee740(0x150),'productName':_0x245820?.['productName']||_0x3ee740(0x14c),'gateway':_0x245820?.[_0x3ee740(0x137)]||'plisio','createdAt':new Date(),..._0x245820};await telegramBotService_1[_0x3ee740(0x114)][_0x3ee740(0x142)](_0x2eae6c,_0x2aab8d,_0x3ee740(0x10c));break;case _0x3ee740(0x127):const _0x4837f4={'id':'test_payout_123','amount':_0x245820?.[_0x3ee740(0x138)]||0x1f4,'network':_0x245820?.['network']||_0x3ee740(0x10b),'wallet':_0x245820?.[_0x3ee740(0x14a)]||_0x3ee740(0x117),'period':_0x3ee740(0x13b),'createdAt':new Date(),'txid':_0x245820?.[_0x3ee740(0x148)]||null,..._0x245820};await telegramBotService_1[_0x3ee740(0x114)][_0x3ee740(0x12b)](_0x2eae6c,_0x4837f4);break;case _0x3ee740(0x13a):await telegramBotService_1[_0x3ee740(0x114)][_0x3ee740(0x144)](_0x2eae6c,_0x245820?.[_0x3ee740(0x113)]||_0x3ee740(0x140),_0x245820?.[_0x3ee740(0x11a)]||{'message':_0x3ee740(0x135)});break;default:return _0x39bda7[_0x3ee740(0x143)](0x190)[_0x3ee740(0x124)]({'success':![],'message':_0x3ee740(0x129)});}_0x39bda7['json']({'success':!![],'message':_0x3ee740(0x107)+type+_0x3ee740(0x12d)});}catch(_0x41e51e){_0x13252d(_0x41e51e);}};}}function a14_0x1929(_0x2af118,_0x2eb0f2){const _0x527373=a14_0x5273();return a14_0x1929=function(_0x1929e6,_0x2979dd){_0x1929e6=_0x1929e6-0x104;let _0x34eaf9=_0x527373[_0x1929e6];return _0x34eaf9;},a14_0x1929(_0x2af118,_0x2eb0f2);}exports[a14_0x1899c4(0x120)]=TelegramController;