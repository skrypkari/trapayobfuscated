'use strict';const a12_0x54c5ea=a12_0x4793;(function(_0x17a1c7,_0x77283){const _0x1f1280=a12_0x4793,_0x1e16bb=_0x17a1c7();while(!![]){try{const _0x33fa7d=-parseInt(_0x1f1280(0xae))/0x1+-parseInt(_0x1f1280(0xf0))/0x2+parseInt(_0x1f1280(0xc6))/0x3*(parseInt(_0x1f1280(0xca))/0x4)+parseInt(_0x1f1280(0xbe))/0x5*(-parseInt(_0x1f1280(0xda))/0x6)+parseInt(_0x1f1280(0xb6))/0x7*(-parseInt(_0x1f1280(0xce))/0x8)+parseInt(_0x1f1280(0xb4))/0x9+parseInt(_0x1f1280(0xe6))/0xa;if(_0x33fa7d===_0x77283)break;else _0x1e16bb['push'](_0x1e16bb['shift']());}catch(_0x118162){_0x1e16bb['push'](_0x1e16bb['shift']());}}}(a12_0x435a,0xce569));function a12_0x435a(){const _0x1786ea=['json','paid','User\x20disconnected\x20successfully','36140000NBDUMQ','payment','shopId','disconnectUser','../config/database','groupBy','Test\x20Product','test_payout_123','../services/telegramBotService','Shop\x20ID\x20is\x20required','1218812glpvtt','payout','sendShopNotification','sendPayoutNotification','410222IdXknT','custom','sendBroadcast','createdAt','amount','all','7078851tkFqTr','telegramBotService','119noMpNk','Message\x20is\x20required','defineProperty','This\x20is\x20a\x20test\x20notification','__importDefault','currency','true','isActive','7610BVMGSX','map','__esModule','Markdown','USD','update','sendCustomNotification','updatedAt','3grPiIu','firstName','title','method','2135164pcgoie','query','telegramUser','default','793432SPKtzT','isVerified','bank_transfer','length','getBotInfo','lastName','username','Test\x20Notification','plisio','findUnique','Broadcast\x20message\x20sent\x20successfully','Test\x20','5454qiZDnZ','findMany','telegramId','ceil','status','completed','count','shop','sendPaymentNotification'];a12_0x435a=function(){return _0x1786ea;};return a12_0x435a();}var __importDefault=this&&this[a12_0x54c5ea(0xba)]||function(_0x53f999){const _0x3b0304=a12_0x54c5ea;return _0x53f999&&_0x53f999[_0x3b0304(0xc0)]?_0x53f999:{'default':_0x53f999};};Object[a12_0x54c5ea(0xb8)](exports,a12_0x54c5ea(0xc0),{'value':!![]}),exports['TelegramController']=void 0x0;function a12_0x4793(_0x8f3794,_0x47c452){const _0x435a53=a12_0x435a();return a12_0x4793=function(_0x47935d,_0xbb7449){_0x47935d=_0x47935d-0xae;let _0x37a268=_0x435a53[_0x47935d];return _0x37a268;},a12_0x4793(_0x8f3794,_0x47c452);}const telegramBotService_1=require(a12_0x54c5ea(0xee)),database_1=__importDefault(require(a12_0x54c5ea(0xea)));class TelegramController{constructor(){const _0x342fc2=a12_0x54c5ea;this['getBotStatus']=async(_0x5d9b9e,_0x35931b,_0x2dea39)=>{const _0x16d402=a12_0x4793;try{const _0xca6da3=telegramBotService_1[_0x16d402(0xb5)][_0x16d402(0xd2)](),_0x370200=await database_1['default']['telegramUser'][_0x16d402(0xe0)](),_0x61a9de=await database_1['default'][_0x16d402(0xcc)]['count']({'where':{'isVerified':!![]}}),_0x493793=await database_1[_0x16d402(0xcd)]['telegramUser'][_0x16d402(0xeb)]({'by':[_0x16d402(0xe8)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x35931b[_0x16d402(0xe3)]({'success':!![],'result':{'bot':{'isActive':_0xca6da3[_0x16d402(0xbd)],'username':_0xca6da3['username']},'statistics':{'totalUsers':_0x370200,'verifiedUsers':_0x61a9de,'unverifiedUsers':_0x370200-_0x61a9de,'connectedShops':_0x493793[_0x16d402(0xd1)]}}});}catch(_0x5580af){_0x2dea39(_0x5580af);}},this['getTelegramUsers']=async(_0x2e45a6,_0x390255,_0x51b828)=>{const _0x5d4ee3=a12_0x4793;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3176f8}=_0x2e45a6[_0x5d4ee3(0xcb)],_0x3104d2=(Number(page)-0x1)*Number(limit),_0x498643={};_0x3176f8!==undefined&&(_0x498643[_0x5d4ee3(0xcf)]=_0x3176f8===_0x5d4ee3(0xbc));const [_0x1ec2be,_0x29c65e]=await Promise[_0x5d4ee3(0xb3)]([database_1[_0x5d4ee3(0xcd)][_0x5d4ee3(0xcc)]['findMany']({'where':_0x498643,'skip':_0x3104d2,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5d4ee3(0xcd)][_0x5d4ee3(0xcc)][_0x5d4ee3(0xe0)]({'where':_0x498643})]);_0x390255[_0x5d4ee3(0xe3)]({'success':!![],'users':_0x1ec2be[_0x5d4ee3(0xbf)](_0x1d40e5=>({'id':_0x1d40e5['id'],'telegramId':_0x1d40e5[_0x5d4ee3(0xdc)],'username':_0x1d40e5[_0x5d4ee3(0xd4)],'firstName':_0x1d40e5[_0x5d4ee3(0xc7)],'lastName':_0x1d40e5[_0x5d4ee3(0xd3)],'isVerified':_0x1d40e5[_0x5d4ee3(0xcf)],'shop':_0x1d40e5[_0x5d4ee3(0xe1)],'createdAt':_0x1d40e5[_0x5d4ee3(0xb1)],'updatedAt':_0x1d40e5[_0x5d4ee3(0xc5)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x29c65e,'totalPages':Math[_0x5d4ee3(0xdd)](_0x29c65e/Number(limit))}});}catch(_0x39a574){_0x51b828(_0x39a574);}},this[_0x342fc2(0xb0)]=async(_0x4a2368,_0x1d1857,_0x3c1dd5)=>{const _0x21b795=_0x342fc2;try{const {message:_0x5a9a28,shopId:_0x49a576}=_0x4a2368['body'];if(!_0x5a9a28)return _0x1d1857['status'](0x190)['json']({'success':![],'message':_0x21b795(0xb7)});if(_0x49a576)await telegramBotService_1[_0x21b795(0xb5)]['sendShopNotification'](_0x49a576,_0x5a9a28,{'parse_mode':_0x21b795(0xc1)});else{const _0x583426=await database_1[_0x21b795(0xcd)][_0x21b795(0xcc)][_0x21b795(0xdb)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x552bee=[...new Set(_0x583426[_0x21b795(0xbf)](_0x506115=>_0x506115[_0x21b795(0xe8)])['filter'](Boolean))];for(const _0x29965d of _0x552bee){_0x29965d&&await telegramBotService_1[_0x21b795(0xb5)][_0x21b795(0xf2)](_0x29965d,_0x5a9a28,{'parse_mode':_0x21b795(0xc1)});}}_0x1d1857[_0x21b795(0xe3)]({'success':!![],'message':_0x21b795(0xd8)});}catch(_0xf97710){_0x3c1dd5(_0xf97710);}},this[_0x342fc2(0xe9)]=async(_0x241333,_0x1611b3,_0x51abb4)=>{const _0xf8bbbf=_0x342fc2;try{const {telegramId:_0x3886f8}=_0x241333['params'],_0x4dfd17=await database_1[_0xf8bbbf(0xcd)][_0xf8bbbf(0xcc)][_0xf8bbbf(0xd7)]({'where':{'telegramId':_0x3886f8},'include':{'shop':!![]}});if(!_0x4dfd17)return _0x1611b3[_0xf8bbbf(0xde)](0x194)[_0xf8bbbf(0xe3)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0xf8bbbf(0xcd)][_0xf8bbbf(0xcc)][_0xf8bbbf(0xc3)]({'where':{'telegramId':_0x3886f8},'data':{'shopId':null,'isVerified':![]}}),_0x1611b3[_0xf8bbbf(0xe3)]({'success':!![],'message':_0xf8bbbf(0xe5)});}catch(_0xa88f75){_0x51abb4(_0xa88f75);}},this['sendTestNotification']=async(_0x495c67,_0x252d77,_0x253b35)=>{const _0xd1ea6e=_0x342fc2;try{const {shopId:_0x44c521,type:type=_0xd1ea6e(0xe7),testData:_0x161cb9}=_0x495c67['body'];if(!_0x44c521)return _0x252d77['status'](0x190)['json']({'success':![],'message':_0xd1ea6e(0xef)});const _0x5dafab=await database_1[_0xd1ea6e(0xcd)][_0xd1ea6e(0xe1)]['findUnique']({'where':{'id':_0x44c521},'select':{'id':!![],'name':!![]}});if(!_0x5dafab)return _0x252d77[_0xd1ea6e(0xde)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0xd1ea6e(0xe7):const _0x48fb99={'id':'test_payment_123','amount':_0x161cb9?.[_0xd1ea6e(0xb2)]||0x64,'currency':_0x161cb9?.[_0xd1ea6e(0xbb)]||_0xd1ea6e(0xc2),'productName':_0x161cb9?.['productName']||_0xd1ea6e(0xec),'gateway':_0x161cb9?.['gateway']||_0xd1ea6e(0xd6),'createdAt':new Date(),..._0x161cb9};await telegramBotService_1['telegramBotService'][_0xd1ea6e(0xe2)](_0x44c521,_0x48fb99,_0xd1ea6e(0xe4));break;case _0xd1ea6e(0xf1):const _0x3ed867={'id':_0xd1ea6e(0xed),'amount':_0x161cb9?.[_0xd1ea6e(0xb2)]||0x1f4,'method':_0x161cb9?.[_0xd1ea6e(0xc9)]||_0xd1ea6e(0xd0),'createdAt':new Date(),..._0x161cb9};await telegramBotService_1[_0xd1ea6e(0xb5)][_0xd1ea6e(0xf3)](_0x44c521,_0x3ed867,_0xd1ea6e(0xdf));break;case _0xd1ea6e(0xaf):await telegramBotService_1[_0xd1ea6e(0xb5)][_0xd1ea6e(0xc4)](_0x44c521,_0x161cb9?.[_0xd1ea6e(0xc8)]||_0xd1ea6e(0xd5),_0x161cb9?.['details']||{'message':_0xd1ea6e(0xb9)});break;default:return _0x252d77[_0xd1ea6e(0xde)](0x190)[_0xd1ea6e(0xe3)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x252d77[_0xd1ea6e(0xe3)]({'success':!![],'message':_0xd1ea6e(0xd9)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x4807d5){_0x253b35(_0x4807d5);}};}}exports['TelegramController']=TelegramController;