'use strict';const a12_0x1192a2=a12_0x4a83;function a12_0x4a83(_0x2ac17d,_0x35d718){const _0x3d82cf=a12_0x3d82();return a12_0x4a83=function(_0x4a8316,_0x45356c){_0x4a8316=_0x4a8316-0x153;let _0x245b49=_0x3d82cf[_0x4a8316];return _0x245b49;},a12_0x4a83(_0x2ac17d,_0x35d718);}(function(_0x319516,_0x41e972){const _0x1bc15b=a12_0x4a83,_0x5c0f69=_0x319516();while(!![]){try{const _0x2edb73=-parseInt(_0x1bc15b(0x174))/0x1+parseInt(_0x1bc15b(0x161))/0x2+parseInt(_0x1bc15b(0x175))/0x3+-parseInt(_0x1bc15b(0x164))/0x4*(parseInt(_0x1bc15b(0x192))/0x5)+-parseInt(_0x1bc15b(0x15e))/0x6+parseInt(_0x1bc15b(0x18b))/0x7*(-parseInt(_0x1bc15b(0x193))/0x8)+-parseInt(_0x1bc15b(0x177))/0x9*(-parseInt(_0x1bc15b(0x157))/0xa);if(_0x2edb73===_0x41e972)break;else _0x5c0f69['push'](_0x5c0f69['shift']());}catch(_0xb6e99d){_0x5c0f69['push'](_0x5c0f69['shift']());}}}(a12_0x3d82,0xa8eb3));var __importDefault=this&&this['__importDefault']||function(_0x1cdcaf){return _0x1cdcaf&&_0x1cdcaf['__esModule']?_0x1cdcaf:{'default':_0x1cdcaf};};Object[a12_0x1192a2(0x167)](exports,a12_0x1192a2(0x186),{'value':!![]}),exports[a12_0x1192a2(0x189)]=void 0x0;const telegramBotService_1=require(a12_0x1192a2(0x166)),database_1=__importDefault(require('../config/database'));function a12_0x3d82(){const _0x27ca0c=['map','208792kpBDMg','Telegram\x20user\x20not\x20found','../services/telegramBotService','defineProperty','body','sendBroadcast','paid','sendPaymentNotification','Test\x20Product','sendShopNotification','sendTestNotification','length','default','disconnectUser','shop','isVerified','592120KlDOPP','3525930wRemXS','count','45WjMOFG','findMany','true','currency','details','telegramBotService','Test\x20','payment','desc','amount','Shop\x20not\x20found','method','sendCustomNotification','username','Test\x20Notification','__esModule','getBotStatus','lastName','TelegramController','all','35021OeRawG','sendPayoutNotification','updatedAt','User\x20disconnected\x20successfully','update','bank_transfer','filter','50gtsTmT','184fHrcdT','This\x20is\x20a\x20test\x20notification','json','telegramUser','createdAt','USD','1859330iyXmRz','productName','shopId','Broadcast\x20message\x20sent\x20successfully','status','telegramId','findUnique','6750702jiEcvS','query','groupBy','1882404rvtutI','getBotInfo'];a12_0x3d82=function(){return _0x27ca0c;};return a12_0x3d82();}class TelegramController{constructor(){const _0xe40bd3=a12_0x1192a2;this[_0xe40bd3(0x187)]=async(_0x4ebf4e,_0x4bdc18,_0x802b3e)=>{const _0x53506a=_0xe40bd3;try{const _0x12f12c=telegramBotService_1[_0x53506a(0x17c)][_0x53506a(0x162)](),_0x213b01=await database_1[_0x53506a(0x170)][_0x53506a(0x154)][_0x53506a(0x176)](),_0x7db068=await database_1[_0x53506a(0x170)]['telegramUser'][_0x53506a(0x176)]({'where':{'isVerified':!![]}}),_0x471fe7=await database_1[_0x53506a(0x170)][_0x53506a(0x154)][_0x53506a(0x160)]({'by':[_0x53506a(0x159)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4bdc18['json']({'success':!![],'result':{'bot':{'isActive':_0x12f12c['isActive'],'username':_0x12f12c['username']},'statistics':{'totalUsers':_0x213b01,'verifiedUsers':_0x7db068,'unverifiedUsers':_0x213b01-_0x7db068,'connectedShops':_0x471fe7[_0x53506a(0x16f)]}}});}catch(_0x315886){_0x802b3e(_0x315886);}},this['getTelegramUsers']=async(_0x1ab79c,_0x2c1114,_0x2cc44c)=>{const _0x107123=_0xe40bd3;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4eb173}=_0x1ab79c[_0x107123(0x15f)],_0x3fbbab=(Number(page)-0x1)*Number(limit),_0x4a3b39={};_0x4eb173!==undefined&&(_0x4a3b39[_0x107123(0x173)]=_0x4eb173===_0x107123(0x179));const [_0x22bf58,_0x5a162c]=await Promise[_0x107123(0x18a)]([database_1[_0x107123(0x170)][_0x107123(0x154)][_0x107123(0x178)]({'where':_0x4a3b39,'skip':_0x3fbbab,'take':Number(limit),'orderBy':{'createdAt':_0x107123(0x17f)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x107123(0x170)][_0x107123(0x154)][_0x107123(0x176)]({'where':_0x4a3b39})]);_0x2c1114[_0x107123(0x153)]({'success':!![],'users':_0x22bf58[_0x107123(0x163)](_0x1f5619=>({'id':_0x1f5619['id'],'telegramId':_0x1f5619[_0x107123(0x15c)],'username':_0x1f5619[_0x107123(0x184)],'firstName':_0x1f5619['firstName'],'lastName':_0x1f5619[_0x107123(0x188)],'isVerified':_0x1f5619[_0x107123(0x173)],'shop':_0x1f5619[_0x107123(0x172)],'createdAt':_0x1f5619[_0x107123(0x155)],'updatedAt':_0x1f5619[_0x107123(0x18d)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5a162c,'totalPages':Math['ceil'](_0x5a162c/Number(limit))}});}catch(_0x3dc020){_0x2cc44c(_0x3dc020);}},this[_0xe40bd3(0x169)]=async(_0x1ee342,_0x8ca77f,_0x14dfcc)=>{const _0x2aa584=_0xe40bd3;try{const {message:_0x249566,shopId:_0x94e98b}=_0x1ee342['body'];if(!_0x249566)return _0x8ca77f[_0x2aa584(0x15b)](0x190)[_0x2aa584(0x153)]({'success':![],'message':'Message\x20is\x20required'});if(_0x94e98b)await telegramBotService_1[_0x2aa584(0x17c)][_0x2aa584(0x16d)](_0x94e98b,_0x249566,{'parse_mode':'Markdown'});else{const _0x49f849=await database_1['default'][_0x2aa584(0x154)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4893cd=[...new Set(_0x49f849['map'](_0x4c6331=>_0x4c6331[_0x2aa584(0x159)])[_0x2aa584(0x191)](Boolean))];for(const _0x144431 of _0x4893cd){_0x144431&&await telegramBotService_1[_0x2aa584(0x17c)][_0x2aa584(0x16d)](_0x144431,_0x249566,{'parse_mode':'Markdown'});}}_0x8ca77f[_0x2aa584(0x153)]({'success':!![],'message':_0x2aa584(0x15a)});}catch(_0x574e3e){_0x14dfcc(_0x574e3e);}},this[_0xe40bd3(0x171)]=async(_0x17bb5d,_0x5b7370,_0x3dc36a)=>{const _0x3b5a37=_0xe40bd3;try{const {telegramId:_0x19083c}=_0x17bb5d['params'],_0x46af64=await database_1[_0x3b5a37(0x170)][_0x3b5a37(0x154)][_0x3b5a37(0x15d)]({'where':{'telegramId':_0x19083c},'include':{'shop':!![]}});if(!_0x46af64)return _0x5b7370['status'](0x194)[_0x3b5a37(0x153)]({'success':![],'message':_0x3b5a37(0x165)});await database_1[_0x3b5a37(0x170)][_0x3b5a37(0x154)][_0x3b5a37(0x18f)]({'where':{'telegramId':_0x19083c},'data':{'shopId':null,'isVerified':![]}}),_0x5b7370['json']({'success':!![],'message':_0x3b5a37(0x18e)});}catch(_0x1d3ef4){_0x3dc36a(_0x1d3ef4);}},this[_0xe40bd3(0x16e)]=async(_0x4d308e,_0x42f17f,_0x690aab)=>{const _0x442e9c=_0xe40bd3;try{const {shopId:_0x44f467,type:type=_0x442e9c(0x17e),testData:_0x3f44fa}=_0x4d308e[_0x442e9c(0x168)];if(!_0x44f467)return _0x42f17f[_0x442e9c(0x15b)](0x190)[_0x442e9c(0x153)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x563cf8=await database_1['default'][_0x442e9c(0x172)][_0x442e9c(0x15d)]({'where':{'id':_0x44f467},'select':{'id':!![],'name':!![]}});if(!_0x563cf8)return _0x42f17f[_0x442e9c(0x15b)](0x194)['json']({'success':![],'message':_0x442e9c(0x181)});switch(type){case _0x442e9c(0x17e):const _0x52a4f1={'id':'test_payment_123','amount':_0x3f44fa?.[_0x442e9c(0x180)]||0x64,'currency':_0x3f44fa?.[_0x442e9c(0x17a)]||_0x442e9c(0x156),'productName':_0x3f44fa?.[_0x442e9c(0x158)]||_0x442e9c(0x16c),'gateway':_0x3f44fa?.['gateway']||'plisio','createdAt':new Date(),..._0x3f44fa};await telegramBotService_1[_0x442e9c(0x17c)][_0x442e9c(0x16b)](_0x44f467,_0x52a4f1,_0x442e9c(0x16a));break;case'payout':const _0x49f312={'id':'test_payout_123','amount':_0x3f44fa?.[_0x442e9c(0x180)]||0x1f4,'method':_0x3f44fa?.[_0x442e9c(0x182)]||_0x442e9c(0x190),'createdAt':new Date(),..._0x3f44fa};await telegramBotService_1[_0x442e9c(0x17c)][_0x442e9c(0x18c)](_0x44f467,_0x49f312,'completed');break;case'custom':await telegramBotService_1['telegramBotService'][_0x442e9c(0x183)](_0x44f467,_0x3f44fa?.['title']||_0x442e9c(0x185),_0x3f44fa?.[_0x442e9c(0x17b)]||{'message':_0x442e9c(0x194)});break;default:return _0x42f17f[_0x442e9c(0x15b)](0x190)[_0x442e9c(0x153)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x42f17f[_0x442e9c(0x153)]({'success':!![],'message':_0x442e9c(0x17d)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x148b20){_0x690aab(_0x148b20);}};}}exports[a12_0x1192a2(0x189)]=TelegramController;