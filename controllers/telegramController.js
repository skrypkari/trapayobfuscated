'use strict';function a14_0x437d(_0x3772d2,_0x5f5282){const _0x427c8d=a14_0x427c();return a14_0x437d=function(_0x437da9,_0x5a8aec){_0x437da9=_0x437da9-0x100;let _0x57331e=_0x427c8d[_0x437da9];return _0x57331e;},a14_0x437d(_0x3772d2,_0x5f5282);}const a14_0x18e063=a14_0x437d;(function(_0x1e56ce,_0x4c6a6f){const _0x117335=a14_0x437d,_0x42247a=_0x1e56ce();while(!![]){try{const _0x53bc01=-parseInt(_0x117335(0x125))/0x1+-parseInt(_0x117335(0x100))/0x2+-parseInt(_0x117335(0x143))/0x3*(parseInt(_0x117335(0x112))/0x4)+parseInt(_0x117335(0x118))/0x5*(parseInt(_0x117335(0x141))/0x6)+parseInt(_0x117335(0x10e))/0x7+-parseInt(_0x117335(0x13a))/0x8+parseInt(_0x117335(0x114))/0x9;if(_0x53bc01===_0x4c6a6f)break;else _0x42247a['push'](_0x42247a['shift']());}catch(_0x1cafcd){_0x42247a['push'](_0x42247a['shift']());}}}(a14_0x427c,0x47e0d));function a14_0x427c(){const _0x7d42fa=['95928ZQDnLq','all','13461XpKHbI','86044bAwHYJ','map','findUnique','lastName','telegramUser','sendShopNotification','sendTestNotification','defineProperty','body','Test\x20','../config/database','Telegram\x20user\x20not\x20found','Shop\x20ID\x20is\x20required','productName','3547068zVRXjW','sendBroadcast','custom','telegramId','4CdrGve','Message\x20is\x20required','1800666DKLrle','plisio','USD','__esModule','105RvsKGY','update','findMany','status','details','sendCustomNotification','Test\x20Product','params','title','isActive','payment','shopId','Broadcast\x20message\x20sent\x20successfully','312786WmhiCU','sendPayoutNotification','TelegramController','json','telegramBotService','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','../services/telegramBotService','true','ceil','updatedAt','User\x20disconnected\x20successfully','Shop\x20not\x20found','createdAt','amount','This\x20is\x20a\x20test\x20notification','payout','isVerified','Markdown','shop','getBotStatus','Test\x20Notification','3102704ArzlgA','completed','test_payout_123','getTelegramUsers','bank_transfer','count','default'];a14_0x427c=function(){return _0x7d42fa;};return a14_0x427c();}var __importDefault=this&&this['__importDefault']||function(_0x537d04){const _0x2da584=a14_0x437d;return _0x537d04&&_0x537d04[_0x2da584(0x117)]?_0x537d04:{'default':_0x537d04};};Object[a14_0x18e063(0x107)](exports,a14_0x18e063(0x117),{'value':!![]}),exports[a14_0x18e063(0x127)]=void 0x0;const telegramBotService_1=require(a14_0x18e063(0x12b)),database_1=__importDefault(require(a14_0x18e063(0x10a)));class TelegramController{constructor(){const _0x24a8ef=a14_0x18e063;this[_0x24a8ef(0x138)]=async(_0x5b38bd,_0xab659,_0x43d669)=>{const _0x227867=_0x24a8ef;try{const _0x45f585=telegramBotService_1[_0x227867(0x129)]['getBotInfo'](),_0x31c7a0=await database_1[_0x227867(0x140)][_0x227867(0x104)][_0x227867(0x13f)](),_0x45a8b9=await database_1[_0x227867(0x140)][_0x227867(0x104)]['count']({'where':{'isVerified':!![]}}),_0x203d6d=await database_1[_0x227867(0x140)]['telegramUser']['groupBy']({'by':[_0x227867(0x123)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xab659['json']({'success':!![],'result':{'bot':{'isActive':_0x45f585[_0x227867(0x121)],'username':_0x45f585['username']},'statistics':{'totalUsers':_0x31c7a0,'verifiedUsers':_0x45a8b9,'unverifiedUsers':_0x31c7a0-_0x45a8b9,'connectedShops':_0x203d6d['length']}}});}catch(_0x3b7552){_0x43d669(_0x3b7552);}},this[_0x24a8ef(0x13d)]=async(_0x1563e3,_0x422c55,_0x4bb45f)=>{const _0x575e22=_0x24a8ef;try{const {page:page=0x1,limit:limit=0x14,verified:_0x40de85}=_0x1563e3['query'],_0x18c954=(Number(page)-0x1)*Number(limit),_0x266e5b={};_0x40de85!==undefined&&(_0x266e5b[_0x575e22(0x135)]=_0x40de85===_0x575e22(0x12c));const [_0x4ee14a,_0x3d0cf]=await Promise[_0x575e22(0x142)]([database_1['default'][_0x575e22(0x104)][_0x575e22(0x11a)]({'where':_0x266e5b,'skip':_0x18c954,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x575e22(0x140)]['telegramUser']['count']({'where':_0x266e5b})]);_0x422c55['json']({'success':!![],'users':_0x4ee14a[_0x575e22(0x101)](_0x4c7558=>({'id':_0x4c7558['id'],'telegramId':_0x4c7558[_0x575e22(0x111)],'username':_0x4c7558['username'],'firstName':_0x4c7558['firstName'],'lastName':_0x4c7558[_0x575e22(0x103)],'isVerified':_0x4c7558[_0x575e22(0x135)],'shop':_0x4c7558[_0x575e22(0x137)],'createdAt':_0x4c7558[_0x575e22(0x131)],'updatedAt':_0x4c7558[_0x575e22(0x12e)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3d0cf,'totalPages':Math[_0x575e22(0x12d)](_0x3d0cf/Number(limit))}});}catch(_0x267102){_0x4bb45f(_0x267102);}},this[_0x24a8ef(0x10f)]=async(_0x3f5f9c,_0x5e2279,_0x3db9d8)=>{const _0x59233c=_0x24a8ef;try{const {message:_0x235f4b,shopId:_0x569b93}=_0x3f5f9c['body'];if(!_0x235f4b)return _0x5e2279['status'](0x190)[_0x59233c(0x128)]({'success':![],'message':_0x59233c(0x113)});if(_0x569b93)await telegramBotService_1[_0x59233c(0x129)][_0x59233c(0x105)](_0x569b93,_0x235f4b,{'parse_mode':_0x59233c(0x136)});else{const _0x18e5f9=await database_1[_0x59233c(0x140)]['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x16ed9f=[...new Set(_0x18e5f9[_0x59233c(0x101)](_0x899e1d=>_0x899e1d[_0x59233c(0x123)])['filter'](Boolean))];for(const _0x338839 of _0x16ed9f){_0x338839&&await telegramBotService_1[_0x59233c(0x129)]['sendShopNotification'](_0x338839,_0x235f4b,{'parse_mode':_0x59233c(0x136)});}}_0x5e2279[_0x59233c(0x128)]({'success':!![],'message':_0x59233c(0x124)});}catch(_0x713175){_0x3db9d8(_0x713175);}},this['disconnectUser']=async(_0x1cb3da,_0x5b65ca,_0x3ee997)=>{const _0x31d13c=_0x24a8ef;try{const {telegramId:_0x4aa3f6}=_0x1cb3da[_0x31d13c(0x11f)],_0x6cf189=await database_1[_0x31d13c(0x140)][_0x31d13c(0x104)][_0x31d13c(0x102)]({'where':{'telegramId':_0x4aa3f6},'include':{'shop':!![]}});if(!_0x6cf189)return _0x5b65ca[_0x31d13c(0x11b)](0x194)[_0x31d13c(0x128)]({'success':![],'message':_0x31d13c(0x10b)});await database_1['default'][_0x31d13c(0x104)][_0x31d13c(0x119)]({'where':{'telegramId':_0x4aa3f6},'data':{'shopId':null,'isVerified':![]}}),_0x5b65ca['json']({'success':!![],'message':_0x31d13c(0x12f)});}catch(_0x5c4c39){_0x3ee997(_0x5c4c39);}},this[_0x24a8ef(0x106)]=async(_0x17c54a,_0x14fb81,_0x3726c1)=>{const _0x21455c=_0x24a8ef;try{const {shopId:_0x345ea5,type:type=_0x21455c(0x122),testData:_0x5d9dcc}=_0x17c54a[_0x21455c(0x108)];if(!_0x345ea5)return _0x14fb81[_0x21455c(0x11b)](0x190)['json']({'success':![],'message':_0x21455c(0x10c)});const _0x37a99e=await database_1[_0x21455c(0x140)][_0x21455c(0x137)]['findUnique']({'where':{'id':_0x345ea5},'select':{'id':!![],'name':!![]}});if(!_0x37a99e)return _0x14fb81[_0x21455c(0x11b)](0x194)[_0x21455c(0x128)]({'success':![],'message':_0x21455c(0x130)});switch(type){case _0x21455c(0x122):const _0x5590e2={'id':'test_payment_123','amount':_0x5d9dcc?.[_0x21455c(0x132)]||0x64,'currency':_0x5d9dcc?.['currency']||_0x21455c(0x116),'productName':_0x5d9dcc?.[_0x21455c(0x10d)]||_0x21455c(0x11e),'gateway':_0x5d9dcc?.['gateway']||_0x21455c(0x115),'createdAt':new Date(),..._0x5d9dcc};await telegramBotService_1[_0x21455c(0x129)]['sendPaymentNotification'](_0x345ea5,_0x5590e2,'paid');break;case _0x21455c(0x134):const _0x2094e5={'id':_0x21455c(0x13c),'amount':_0x5d9dcc?.[_0x21455c(0x132)]||0x1f4,'method':_0x5d9dcc?.['method']||_0x21455c(0x13e),'createdAt':new Date(),..._0x5d9dcc};await telegramBotService_1['telegramBotService'][_0x21455c(0x126)](_0x345ea5,_0x2094e5,_0x21455c(0x13b));break;case _0x21455c(0x110):await telegramBotService_1[_0x21455c(0x129)][_0x21455c(0x11d)](_0x345ea5,_0x5d9dcc?.[_0x21455c(0x120)]||_0x21455c(0x139),_0x5d9dcc?.[_0x21455c(0x11c)]||{'message':_0x21455c(0x133)});break;default:return _0x14fb81[_0x21455c(0x11b)](0x190)['json']({'success':![],'message':_0x21455c(0x12a)});}_0x14fb81[_0x21455c(0x128)]({'success':!![],'message':_0x21455c(0x109)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x270ce7){_0x3726c1(_0x270ce7);}};}}exports[a14_0x18e063(0x127)]=TelegramController;