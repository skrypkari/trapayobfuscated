'use strict';const a17_0xb9e021=a17_0x102e;function a17_0x3a00(){const _0x180834=['616632qISNog','Broadcast\x20message\x20sent\x20successfully','currency','payout','count','2245905KjhrwD','telegramUser','custom','getBotInfo','findMany','Test\x20','203500AXKrgM','plisio','6EJOJGf','all','ceil','update','shopId','Test\x20Notification','status','payment','sendShopNotification','txid','Telegram\x20user\x20not\x20found','createdAt','telegramBotService','default','firstName','Shop\x20ID\x20is\x20required','../config/database','shop','This\x20is\x20a\x20test\x20notification','840HrcbVx','sendBroadcast','19539kAcDlC','map','gateway','TelegramController','username','Test\x20Product','\x20notification\x20sent\x20successfully','amount','filter','desc','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','json','916727EZqEgm','updatedAt','30qwesAQ','__esModule','groupBy','2nJyjZu','test_payout_123','sendTestNotification','paid','disconnectUser','telegramId','__importDefault','body','lastName','Тестовый\x20период','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','wallet','1867235jRivcV','5922191FcoYpP','TRC20','sendCustomNotification','User\x20disconnected\x20successfully','findUnique','Message\x20is\x20required','title','Markdown','length','../services/telegramBotService','network','getBotStatus','isVerified'];a17_0x3a00=function(){return _0x180834;};return a17_0x3a00();}(function(_0x410fec,_0x4675b5){const _0x4a53d2=a17_0x102e,_0x3078ad=_0x410fec();while(!![]){try{const _0x31c6c3=parseInt(_0x4a53d2(0x1a4))/0x1+parseInt(_0x4a53d2(0x17f))/0x2*(-parseInt(_0x4a53d2(0x19e))/0x3)+-parseInt(_0x4a53d2(0x199))/0x4+-parseInt(_0x4a53d2(0x18b))/0x5+parseInt(_0x4a53d2(0x1a6))/0x6*(-parseInt(_0x4a53d2(0x17a))/0x7)+parseInt(_0x4a53d2(0x16c))/0x8*(parseInt(_0x4a53d2(0x16e))/0x9)+-parseInt(_0x4a53d2(0x17c))/0xa*(-parseInt(_0x4a53d2(0x18c))/0xb);if(_0x31c6c3===_0x4675b5)break;else _0x3078ad['push'](_0x3078ad['shift']());}catch(_0x3ea774){_0x3078ad['push'](_0x3078ad['shift']());}}}(a17_0x3a00,0x9c1a5));function a17_0x102e(_0x5a740b,_0x233f56){_0x5a740b=_0x5a740b-0x15f;const _0x3a00de=a17_0x3a00();let _0x102e2b=_0x3a00de[_0x5a740b];return _0x102e2b;}var __importDefault=this&&this[a17_0xb9e021(0x185)]||function(_0x3f319b){const _0x2ead1d=a17_0xb9e021;return _0x3f319b&&_0x3f319b[_0x2ead1d(0x17d)]?_0x3f319b:{'default':_0x3f319b};};Object['defineProperty'](exports,a17_0xb9e021(0x17d),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a17_0xb9e021(0x195)),database_1=__importDefault(require(a17_0xb9e021(0x169)));class TelegramController{constructor(){const _0x226632=a17_0xb9e021;this[_0x226632(0x197)]=async(_0x51d4ed,_0x4f0c2f,_0x585e80)=>{const _0x545c8d=_0x226632;try{const _0x41e59e=telegramBotService_1[_0x545c8d(0x165)][_0x545c8d(0x1a1)](),_0x3f78c4=await database_1[_0x545c8d(0x166)]['telegramUser'][_0x545c8d(0x19d)](),_0x3b26f7=await database_1['default'][_0x545c8d(0x19f)][_0x545c8d(0x19d)]({'where':{'isVerified':!![]}}),_0x461c=await database_1[_0x545c8d(0x166)]['telegramUser'][_0x545c8d(0x17e)]({'by':[_0x545c8d(0x1aa)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4f0c2f[_0x545c8d(0x179)]({'success':!![],'result':{'bot':{'isActive':_0x41e59e['isActive'],'username':_0x41e59e[_0x545c8d(0x172)]},'statistics':{'totalUsers':_0x3f78c4,'verifiedUsers':_0x3b26f7,'unverifiedUsers':_0x3f78c4-_0x3b26f7,'connectedShops':_0x461c[_0x545c8d(0x194)]}}});}catch(_0x21d13e){_0x585e80(_0x21d13e);}},this['getTelegramUsers']=async(_0x376edb,_0x571814,_0x491887)=>{const _0x20132e=_0x226632;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4de8ea}=_0x376edb['query'],_0x357d2f=(Number(page)-0x1)*Number(limit),_0xbb303d={};_0x4de8ea!==undefined&&(_0xbb303d['isVerified']=_0x4de8ea==='true');const [_0x200a09,_0x3d96e6]=await Promise[_0x20132e(0x1a7)]([database_1[_0x20132e(0x166)][_0x20132e(0x19f)][_0x20132e(0x1a2)]({'where':_0xbb303d,'skip':_0x357d2f,'take':Number(limit),'orderBy':{'createdAt':_0x20132e(0x177)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x20132e(0x166)]['telegramUser'][_0x20132e(0x19d)]({'where':_0xbb303d})]);_0x571814[_0x20132e(0x179)]({'success':!![],'users':_0x200a09[_0x20132e(0x16f)](_0x2232d2=>({'id':_0x2232d2['id'],'telegramId':_0x2232d2[_0x20132e(0x184)],'username':_0x2232d2[_0x20132e(0x172)],'firstName':_0x2232d2[_0x20132e(0x167)],'lastName':_0x2232d2[_0x20132e(0x187)],'isVerified':_0x2232d2[_0x20132e(0x198)],'shop':_0x2232d2[_0x20132e(0x16a)],'createdAt':_0x2232d2[_0x20132e(0x164)],'updatedAt':_0x2232d2[_0x20132e(0x17b)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3d96e6,'totalPages':Math[_0x20132e(0x1a8)](_0x3d96e6/Number(limit))}});}catch(_0x27c8a1){_0x491887(_0x27c8a1);}},this[_0x226632(0x16d)]=async(_0x160246,_0x3f7feb,_0x3d994e)=>{const _0x5a0d76=_0x226632;try{const {message:_0x379f3b,shopId:_0x1bde44}=_0x160246[_0x5a0d76(0x186)];if(!_0x379f3b)return _0x3f7feb[_0x5a0d76(0x15f)](0x190)[_0x5a0d76(0x179)]({'success':![],'message':_0x5a0d76(0x191)});if(_0x1bde44)await telegramBotService_1[_0x5a0d76(0x165)][_0x5a0d76(0x161)](_0x1bde44,_0x379f3b,{'parse_mode':_0x5a0d76(0x193)});else{const _0x913eff=await database_1[_0x5a0d76(0x166)][_0x5a0d76(0x19f)][_0x5a0d76(0x1a2)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4b8824=[...new Set(_0x913eff[_0x5a0d76(0x16f)](_0x34a516=>_0x34a516['shopId'])[_0x5a0d76(0x176)](Boolean))];for(const _0x15a685 of _0x4b8824){_0x15a685&&await telegramBotService_1[_0x5a0d76(0x165)][_0x5a0d76(0x161)](_0x15a685,_0x379f3b,{'parse_mode':_0x5a0d76(0x193)});}}_0x3f7feb[_0x5a0d76(0x179)]({'success':!![],'message':_0x5a0d76(0x19a)});}catch(_0x31b4eb){_0x3d994e(_0x31b4eb);}},this[_0x226632(0x183)]=async(_0x5d3062,_0x114535,_0x40f7e7)=>{const _0x59a258=_0x226632;try{const {telegramId:_0x1f7b27}=_0x5d3062['params'],_0x553f0e=await database_1[_0x59a258(0x166)][_0x59a258(0x19f)][_0x59a258(0x190)]({'where':{'telegramId':_0x1f7b27},'include':{'shop':!![]}});if(!_0x553f0e)return _0x114535['status'](0x194)[_0x59a258(0x179)]({'success':![],'message':_0x59a258(0x163)});await database_1['default'][_0x59a258(0x19f)][_0x59a258(0x1a9)]({'where':{'telegramId':_0x1f7b27},'data':{'shopId':null,'isVerified':![]}}),_0x114535[_0x59a258(0x179)]({'success':!![],'message':_0x59a258(0x18f)});}catch(_0x134ea0){_0x40f7e7(_0x134ea0);}},this[_0x226632(0x181)]=async(_0x4fa120,_0x173f9b,_0x3154e9)=>{const _0xadbd7d=_0x226632;try{const {shopId:_0x56b1c5,type:type=_0xadbd7d(0x160),testData:_0x2a7347}=_0x4fa120[_0xadbd7d(0x186)];if(!_0x56b1c5)return _0x173f9b[_0xadbd7d(0x15f)](0x190)[_0xadbd7d(0x179)]({'success':![],'message':_0xadbd7d(0x168)});const _0x574c14=await database_1[_0xadbd7d(0x166)][_0xadbd7d(0x16a)]['findUnique']({'where':{'id':_0x56b1c5},'select':{'id':!![],'name':!![]}});if(!_0x574c14)return _0x173f9b[_0xadbd7d(0x15f)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0xadbd7d(0x160):const _0x1f1c03={'id':'test_payment_123','amount':_0x2a7347?.[_0xadbd7d(0x175)]||0x64,'currency':_0x2a7347?.[_0xadbd7d(0x19b)]||'USD','productName':_0x2a7347?.['productName']||_0xadbd7d(0x173),'gateway':_0x2a7347?.[_0xadbd7d(0x170)]||_0xadbd7d(0x1a5),'createdAt':new Date(),..._0x2a7347};await telegramBotService_1[_0xadbd7d(0x165)]['sendPaymentNotification'](_0x56b1c5,_0x1f1c03,_0xadbd7d(0x182));break;case _0xadbd7d(0x19c):const _0x9683c3={'id':_0xadbd7d(0x180),'amount':_0x2a7347?.[_0xadbd7d(0x175)]||0x1f4,'network':_0x2a7347?.[_0xadbd7d(0x196)]||_0xadbd7d(0x18d),'wallet':_0x2a7347?.[_0xadbd7d(0x18a)]||_0xadbd7d(0x178),'period':_0xadbd7d(0x188),'createdAt':new Date(),'txid':_0x2a7347?.[_0xadbd7d(0x162)]||null,..._0x2a7347};await telegramBotService_1[_0xadbd7d(0x165)]['sendPayoutNotification'](_0x56b1c5,_0x9683c3);break;case _0xadbd7d(0x1a0):await telegramBotService_1['telegramBotService'][_0xadbd7d(0x18e)](_0x56b1c5,_0x2a7347?.[_0xadbd7d(0x192)]||_0xadbd7d(0x1ab),_0x2a7347?.['details']||{'message':_0xadbd7d(0x16b)});break;default:return _0x173f9b['status'](0x190)['json']({'success':![],'message':_0xadbd7d(0x189)});}_0x173f9b['json']({'success':!![],'message':_0xadbd7d(0x1a3)+type+_0xadbd7d(0x174)});}catch(_0x37bfae){_0x3154e9(_0x37bfae);}};}}exports[a17_0xb9e021(0x171)]=TelegramController;