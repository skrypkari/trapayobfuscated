'use strict';function a12_0x1b06(_0x23dccb,_0xa4f704){const _0x1ff5b4=a12_0x1ff5();return a12_0x1b06=function(_0x1b061d,_0x462ed1){_0x1b061d=_0x1b061d-0x112;let _0x46b59b=_0x1ff5b4[_0x1b061d];return _0x46b59b;},a12_0x1b06(_0x23dccb,_0xa4f704);}function a12_0x1ff5(){const _0x2af891=['username','update','isActive','Message\x20is\x20required','status','disconnectUser','10xGBuLo','telegramBotService','sendTestNotification','count','Telegram\x20user\x20not\x20found','findMany','../services/telegramBotService','json','bank_transfer','lastName','sendShopNotification','ceil','custom','\x20notification\x20sent\x20successfully','productName','3640664GDFkdd','telegramUser','isVerified','map','Test\x20','body','Test\x20Notification','shopId','687861hiwULJ','currency','findUnique','desc','sendCustomNotification','User\x20disconnected\x20successfully','plisio','shop','Broadcast\x20message\x20sent\x20successfully','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','sendPaymentNotification','payment','500GawLul','groupBy','USD','sendPayoutNotification','TelegramController','6499717tlwHfd','query','Test\x20Product','length','defineProperty','3702ouXCGq','createdAt','amount','166200kmwxDL','gateway','__importDefault','829014AuBDGF','Markdown','__esModule','title','getTelegramUsers','20VKbnTt','updatedAt','default','payout','test_payment_123','paid','15719370QDkJez','getBotStatus','Shop\x20not\x20found'];a12_0x1ff5=function(){return _0x2af891;};return a12_0x1ff5();}const a12_0x2ca63e=a12_0x1b06;(function(_0x1bf3fa,_0x5d0922){const _0x558df9=a12_0x1b06,_0x24781b=_0x1bf3fa();while(!![]){try{const _0x22ffc2=parseInt(_0x558df9(0x138))/0x1*(parseInt(_0x558df9(0x121))/0x2)+parseInt(_0x558df9(0x11e))/0x3*(parseInt(_0x558df9(0x114))/0x4)+parseInt(_0x558df9(0x129))/0x5*(parseInt(_0x558df9(0x124))/0x6)+parseInt(_0x558df9(0x119))/0x7+-parseInt(_0x558df9(0x147))/0x8+parseInt(_0x558df9(0x14f))/0x9+-parseInt(_0x558df9(0x12f))/0xa;if(_0x22ffc2===_0x5d0922)break;else _0x24781b['push'](_0x24781b['shift']());}catch(_0x3ba70c){_0x24781b['push'](_0x24781b['shift']());}}}(a12_0x1ff5,0x7df1a));var __importDefault=this&&this[a12_0x2ca63e(0x123)]||function(_0x23e2eb){const _0x7e5ff6=a12_0x2ca63e;return _0x23e2eb&&_0x23e2eb[_0x7e5ff6(0x126)]?_0x23e2eb:{'default':_0x23e2eb};};Object[a12_0x2ca63e(0x11d)](exports,a12_0x2ca63e(0x126),{'value':!![]}),exports[a12_0x2ca63e(0x118)]=void 0x0;const telegramBotService_1=require(a12_0x2ca63e(0x13e)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0xd62f28=a12_0x2ca63e;this[_0xd62f28(0x130)]=async(_0x3cd149,_0x549824,_0x5fa873)=>{const _0x14de89=_0xd62f28;try{const _0x157a17=telegramBotService_1[_0x14de89(0x139)]['getBotInfo'](),_0x41cfb0=await database_1[_0x14de89(0x12b)][_0x14de89(0x148)][_0x14de89(0x13b)](),_0x3edaa1=await database_1[_0x14de89(0x12b)][_0x14de89(0x148)][_0x14de89(0x13b)]({'where':{'isVerified':!![]}}),_0xbf9c05=await database_1['default'][_0x14de89(0x148)][_0x14de89(0x115)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x549824['json']({'success':!![],'result':{'bot':{'isActive':_0x157a17[_0x14de89(0x134)],'username':_0x157a17['username']},'statistics':{'totalUsers':_0x41cfb0,'verifiedUsers':_0x3edaa1,'unverifiedUsers':_0x41cfb0-_0x3edaa1,'connectedShops':_0xbf9c05[_0x14de89(0x11c)]}}});}catch(_0x3a06ff){_0x5fa873(_0x3a06ff);}},this[_0xd62f28(0x128)]=async(_0x38bf1d,_0x3224c0,_0x606c5)=>{const _0x3b2f63=_0xd62f28;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2a25da}=_0x38bf1d[_0x3b2f63(0x11a)],_0x252437=(Number(page)-0x1)*Number(limit),_0x3527d5={};_0x2a25da!==undefined&&(_0x3527d5[_0x3b2f63(0x149)]=_0x2a25da==='true');const [_0x3aa497,_0x311330]=await Promise['all']([database_1[_0x3b2f63(0x12b)][_0x3b2f63(0x148)]['findMany']({'where':_0x3527d5,'skip':_0x252437,'take':Number(limit),'orderBy':{'createdAt':_0x3b2f63(0x152)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x3b2f63(0x12b)]['telegramUser'][_0x3b2f63(0x13b)]({'where':_0x3527d5})]);_0x3224c0[_0x3b2f63(0x13f)]({'success':!![],'users':_0x3aa497[_0x3b2f63(0x14a)](_0xa19786=>({'id':_0xa19786['id'],'telegramId':_0xa19786['telegramId'],'username':_0xa19786[_0x3b2f63(0x132)],'firstName':_0xa19786['firstName'],'lastName':_0xa19786[_0x3b2f63(0x141)],'isVerified':_0xa19786[_0x3b2f63(0x149)],'shop':_0xa19786[_0x3b2f63(0x156)],'createdAt':_0xa19786[_0x3b2f63(0x11f)],'updatedAt':_0xa19786[_0x3b2f63(0x12a)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x311330,'totalPages':Math[_0x3b2f63(0x143)](_0x311330/Number(limit))}});}catch(_0x590f70){_0x606c5(_0x590f70);}},this['sendBroadcast']=async(_0x5ee952,_0x50dc02,_0x4a4279)=>{const _0x25e07c=_0xd62f28;try{const {message:_0x1df197,shopId:_0x2f3f68}=_0x5ee952['body'];if(!_0x1df197)return _0x50dc02[_0x25e07c(0x136)](0x190)[_0x25e07c(0x13f)]({'success':![],'message':_0x25e07c(0x135)});if(_0x2f3f68)await telegramBotService_1['telegramBotService'][_0x25e07c(0x142)](_0x2f3f68,_0x1df197,{'parse_mode':_0x25e07c(0x125)});else{const _0x152a1a=await database_1[_0x25e07c(0x12b)][_0x25e07c(0x148)][_0x25e07c(0x13d)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5c96e3=[...new Set(_0x152a1a['map'](_0x16ea7e=>_0x16ea7e[_0x25e07c(0x14e)])['filter'](Boolean))];for(const _0x28aaf0 of _0x5c96e3){_0x28aaf0&&await telegramBotService_1[_0x25e07c(0x139)][_0x25e07c(0x142)](_0x28aaf0,_0x1df197,{'parse_mode':'Markdown'});}}_0x50dc02['json']({'success':!![],'message':_0x25e07c(0x157)});}catch(_0x3ee183){_0x4a4279(_0x3ee183);}},this[_0xd62f28(0x137)]=async(_0x575e5c,_0x5d7de7,_0x462363)=>{const _0x220d20=_0xd62f28;try{const {telegramId:_0x54d601}=_0x575e5c['params'],_0x4d022a=await database_1[_0x220d20(0x12b)][_0x220d20(0x148)][_0x220d20(0x151)]({'where':{'telegramId':_0x54d601},'include':{'shop':!![]}});if(!_0x4d022a)return _0x5d7de7[_0x220d20(0x136)](0x194)['json']({'success':![],'message':_0x220d20(0x13c)});await database_1['default']['telegramUser'][_0x220d20(0x133)]({'where':{'telegramId':_0x54d601},'data':{'shopId':null,'isVerified':![]}}),_0x5d7de7[_0x220d20(0x13f)]({'success':!![],'message':_0x220d20(0x154)});}catch(_0x119915){_0x462363(_0x119915);}},this[_0xd62f28(0x13a)]=async(_0x5f3704,_0x55cebc,_0x3b66fd)=>{const _0x50df7b=_0xd62f28;try{const {shopId:_0x5f2308,type:type='payment',testData:_0x1923a7}=_0x5f3704[_0x50df7b(0x14c)];if(!_0x5f2308)return _0x55cebc[_0x50df7b(0x136)](0x190)[_0x50df7b(0x13f)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x493856=await database_1[_0x50df7b(0x12b)]['shop'][_0x50df7b(0x151)]({'where':{'id':_0x5f2308},'select':{'id':!![],'name':!![]}});if(!_0x493856)return _0x55cebc[_0x50df7b(0x136)](0x194)[_0x50df7b(0x13f)]({'success':![],'message':_0x50df7b(0x131)});switch(type){case _0x50df7b(0x113):const _0x10ef95={'id':_0x50df7b(0x12d),'amount':_0x1923a7?.[_0x50df7b(0x120)]||0x64,'currency':_0x1923a7?.[_0x50df7b(0x150)]||_0x50df7b(0x116),'productName':_0x1923a7?.[_0x50df7b(0x146)]||_0x50df7b(0x11b),'gateway':_0x1923a7?.[_0x50df7b(0x122)]||_0x50df7b(0x155),'createdAt':new Date(),..._0x1923a7};await telegramBotService_1[_0x50df7b(0x139)][_0x50df7b(0x112)](_0x5f2308,_0x10ef95,_0x50df7b(0x12e));break;case _0x50df7b(0x12c):const _0x2908ba={'id':'test_payout_123','amount':_0x1923a7?.[_0x50df7b(0x120)]||0x1f4,'method':_0x1923a7?.['method']||_0x50df7b(0x140),'createdAt':new Date(),..._0x1923a7};await telegramBotService_1[_0x50df7b(0x139)][_0x50df7b(0x117)](_0x5f2308,_0x2908ba,'completed');break;case _0x50df7b(0x144):await telegramBotService_1[_0x50df7b(0x139)][_0x50df7b(0x153)](_0x5f2308,_0x1923a7?.[_0x50df7b(0x127)]||_0x50df7b(0x14d),_0x1923a7?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x55cebc[_0x50df7b(0x136)](0x190)[_0x50df7b(0x13f)]({'success':![],'message':_0x50df7b(0x158)});}_0x55cebc[_0x50df7b(0x13f)]({'success':!![],'message':_0x50df7b(0x14b)+type+_0x50df7b(0x145)});}catch(_0x3c8048){_0x3b66fd(_0x3c8048);}};}}exports['TelegramController']=TelegramController;