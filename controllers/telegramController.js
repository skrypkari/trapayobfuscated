'use strict';const a12_0xa9ff28=a12_0x5d22;(function(_0x3f187d,_0x5b645f){const _0x39289f=a12_0x5d22,_0x7fff22=_0x3f187d();while(!![]){try{const _0x3e604d=-parseInt(_0x39289f(0xa0))/0x1+parseInt(_0x39289f(0xa6))/0x2+-parseInt(_0x39289f(0xa5))/0x3*(parseInt(_0x39289f(0xaa))/0x4)+-parseInt(_0x39289f(0xa1))/0x5+parseInt(_0x39289f(0xa9))/0x6*(-parseInt(_0x39289f(0x98))/0x7)+-parseInt(_0x39289f(0xb4))/0x8+parseInt(_0x39289f(0xc6))/0x9;if(_0x3e604d===_0x5b645f)break;else _0x7fff22['push'](_0x7fff22['shift']());}catch(_0x242159){_0x7fff22['push'](_0x7fff22['shift']());}}}(a12_0x3b33,0x6e87a));function a12_0x5d22(_0x5baf37,_0x1f0cd2){const _0x3b3305=a12_0x3b33();return a12_0x5d22=function(_0x5d22da,_0xb2af5){_0x5d22da=_0x5d22da-0x90;let _0x15debb=_0x3b3305[_0x5d22da];return _0x15debb;},a12_0x5d22(_0x5baf37,_0x1f0cd2);}function a12_0x3b33(){const _0x212991=['firstName','ceil','desc','158436wgvLTT','2277355aMlidv','payout','sendPaymentNotification','all','1404981QSQnNB','1031326ijHyMC','telegramUser','shop','6rmsjTh','4eZQEsW','json','This\x20is\x20a\x20test\x20notification','isActive','createdAt','body','test_payout_123','count','currency','../services/telegramBotService','5591104Ujquma','../config/database','TelegramController','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','USD','amount','__importDefault','disconnectUser','default','Test\x20','title','Message\x20is\x20required','plisio','sendCustomNotification','update','map','defineProperty','isVerified','18560502aQadKH','length','Broadcast\x20message\x20sent\x20successfully','details','true','custom','test_payment_123','Shop\x20ID\x20is\x20required','getTelegramUsers','payment','User\x20disconnected\x20successfully','sendPayoutNotification','filter','Shop\x20not\x20found','__esModule','findMany','shopId','sendTestNotification','telegramBotService','Test\x20Notification','getBotStatus','params','sendShopNotification','Telegram\x20user\x20not\x20found','groupBy','Markdown','status','updatedAt','bank_transfer','2408623lYNRVx','findUnique','username','query','Test\x20Product'];a12_0x3b33=function(){return _0x212991;};return a12_0x3b33();}var __importDefault=this&&this[a12_0xa9ff28(0xba)]||function(_0xea4ada){return _0xea4ada&&_0xea4ada['__esModule']?_0xea4ada:{'default':_0xea4ada};};Object[a12_0xa9ff28(0xc4)](exports,a12_0xa9ff28(0xd4),{'value':!![]}),exports[a12_0xa9ff28(0xb6)]=void 0x0;const telegramBotService_1=require(a12_0xa9ff28(0xb3)),database_1=__importDefault(require(a12_0xa9ff28(0xb5)));class TelegramController{constructor(){const _0x3f6c35=a12_0xa9ff28;this[_0x3f6c35(0xda)]=async(_0x246436,_0x39039c,_0x1e07e2)=>{const _0x3b3cf3=_0x3f6c35;try{const _0xcaa80a=telegramBotService_1[_0x3b3cf3(0xd8)]['getBotInfo'](),_0xae3059=await database_1['default'][_0x3b3cf3(0xa7)]['count'](),_0x11c558=await database_1[_0x3b3cf3(0xbc)]['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x5ea876=await database_1[_0x3b3cf3(0xbc)][_0x3b3cf3(0xa7)][_0x3b3cf3(0x93)]({'by':[_0x3b3cf3(0xd6)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x39039c[_0x3b3cf3(0xab)]({'success':!![],'result':{'bot':{'isActive':_0xcaa80a[_0x3b3cf3(0xad)],'username':_0xcaa80a[_0x3b3cf3(0x9a)]},'statistics':{'totalUsers':_0xae3059,'verifiedUsers':_0x11c558,'unverifiedUsers':_0xae3059-_0x11c558,'connectedShops':_0x5ea876[_0x3b3cf3(0xc7)]}}});}catch(_0x2693b0){_0x1e07e2(_0x2693b0);}},this[_0x3f6c35(0xce)]=async(_0x3a854a,_0x52d7ca,_0x616ac2)=>{const _0x311b57=_0x3f6c35;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1daece}=_0x3a854a[_0x311b57(0x9b)],_0x557a30=(Number(page)-0x1)*Number(limit),_0x32515f={};_0x1daece!==undefined&&(_0x32515f['isVerified']=_0x1daece===_0x311b57(0xca));const [_0x23791d,_0x173536]=await Promise[_0x311b57(0xa4)]([database_1[_0x311b57(0xbc)][_0x311b57(0xa7)][_0x311b57(0xd5)]({'where':_0x32515f,'skip':_0x557a30,'take':Number(limit),'orderBy':{'createdAt':_0x311b57(0x9f)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x311b57(0xbc)][_0x311b57(0xa7)][_0x311b57(0xb1)]({'where':_0x32515f})]);_0x52d7ca[_0x311b57(0xab)]({'success':!![],'users':_0x23791d[_0x311b57(0xc3)](_0x55e217=>({'id':_0x55e217['id'],'telegramId':_0x55e217['telegramId'],'username':_0x55e217[_0x311b57(0x9a)],'firstName':_0x55e217[_0x311b57(0x9d)],'lastName':_0x55e217['lastName'],'isVerified':_0x55e217[_0x311b57(0xc5)],'shop':_0x55e217[_0x311b57(0xa8)],'createdAt':_0x55e217[_0x311b57(0xae)],'updatedAt':_0x55e217[_0x311b57(0x96)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x173536,'totalPages':Math[_0x311b57(0x9e)](_0x173536/Number(limit))}});}catch(_0x22ff46){_0x616ac2(_0x22ff46);}},this['sendBroadcast']=async(_0x1fdecd,_0x1fed75,_0x12d057)=>{const _0x4cda6b=_0x3f6c35;try{const {message:_0x24a6b9,shopId:_0x381e2b}=_0x1fdecd[_0x4cda6b(0xaf)];if(!_0x24a6b9)return _0x1fed75[_0x4cda6b(0x95)](0x190)[_0x4cda6b(0xab)]({'success':![],'message':_0x4cda6b(0xbf)});if(_0x381e2b)await telegramBotService_1['telegramBotService'][_0x4cda6b(0x91)](_0x381e2b,_0x24a6b9,{'parse_mode':_0x4cda6b(0x94)});else{const _0x2b5e25=await database_1[_0x4cda6b(0xbc)]['telegramUser'][_0x4cda6b(0xd5)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3423df=[...new Set(_0x2b5e25['map'](_0x45c3a3=>_0x45c3a3['shopId'])[_0x4cda6b(0xd2)](Boolean))];for(const _0xe412cd of _0x3423df){_0xe412cd&&await telegramBotService_1[_0x4cda6b(0xd8)]['sendShopNotification'](_0xe412cd,_0x24a6b9,{'parse_mode':_0x4cda6b(0x94)});}}_0x1fed75[_0x4cda6b(0xab)]({'success':!![],'message':_0x4cda6b(0xc8)});}catch(_0x2990e5){_0x12d057(_0x2990e5);}},this[_0x3f6c35(0xbb)]=async(_0x57f42c,_0x180aed,_0x3cbbc6)=>{const _0x178f5d=_0x3f6c35;try{const {telegramId:_0x642b61}=_0x57f42c[_0x178f5d(0x90)],_0x11cf94=await database_1[_0x178f5d(0xbc)][_0x178f5d(0xa7)][_0x178f5d(0x99)]({'where':{'telegramId':_0x642b61},'include':{'shop':!![]}});if(!_0x11cf94)return _0x180aed[_0x178f5d(0x95)](0x194)[_0x178f5d(0xab)]({'success':![],'message':_0x178f5d(0x92)});await database_1[_0x178f5d(0xbc)][_0x178f5d(0xa7)][_0x178f5d(0xc2)]({'where':{'telegramId':_0x642b61},'data':{'shopId':null,'isVerified':![]}}),_0x180aed[_0x178f5d(0xab)]({'success':!![],'message':_0x178f5d(0xd0)});}catch(_0x4878ca){_0x3cbbc6(_0x4878ca);}},this[_0x3f6c35(0xd7)]=async(_0x5ce169,_0x4225a0,_0x51a203)=>{const _0x35ef7c=_0x3f6c35;try{const {shopId:_0x282cf3,type:type=_0x35ef7c(0xcf),testData:_0x44232c}=_0x5ce169[_0x35ef7c(0xaf)];if(!_0x282cf3)return _0x4225a0[_0x35ef7c(0x95)](0x190)[_0x35ef7c(0xab)]({'success':![],'message':_0x35ef7c(0xcd)});const _0x312f74=await database_1[_0x35ef7c(0xbc)]['shop']['findUnique']({'where':{'id':_0x282cf3},'select':{'id':!![],'name':!![]}});if(!_0x312f74)return _0x4225a0[_0x35ef7c(0x95)](0x194)[_0x35ef7c(0xab)]({'success':![],'message':_0x35ef7c(0xd3)});switch(type){case _0x35ef7c(0xcf):const _0x713fff={'id':_0x35ef7c(0xcc),'amount':_0x44232c?.[_0x35ef7c(0xb9)]||0x64,'currency':_0x44232c?.[_0x35ef7c(0xb2)]||_0x35ef7c(0xb8),'productName':_0x44232c?.['productName']||_0x35ef7c(0x9c),'gateway':_0x44232c?.['gateway']||_0x35ef7c(0xc0),'createdAt':new Date(),..._0x44232c};await telegramBotService_1[_0x35ef7c(0xd8)][_0x35ef7c(0xa3)](_0x282cf3,_0x713fff,'paid');break;case _0x35ef7c(0xa2):const _0x307ff1={'id':_0x35ef7c(0xb0),'amount':_0x44232c?.[_0x35ef7c(0xb9)]||0x1f4,'method':_0x44232c?.['method']||_0x35ef7c(0x97),'createdAt':new Date(),..._0x44232c};await telegramBotService_1[_0x35ef7c(0xd8)][_0x35ef7c(0xd1)](_0x282cf3,_0x307ff1,'completed');break;case _0x35ef7c(0xcb):await telegramBotService_1[_0x35ef7c(0xd8)][_0x35ef7c(0xc1)](_0x282cf3,_0x44232c?.[_0x35ef7c(0xbe)]||_0x35ef7c(0xd9),_0x44232c?.[_0x35ef7c(0xc9)]||{'message':_0x35ef7c(0xac)});break;default:return _0x4225a0[_0x35ef7c(0x95)](0x190)[_0x35ef7c(0xab)]({'success':![],'message':_0x35ef7c(0xb7)});}_0x4225a0[_0x35ef7c(0xab)]({'success':!![],'message':_0x35ef7c(0xbd)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x42c0af){_0x51a203(_0x42c0af);}};}}exports['TelegramController']=TelegramController;