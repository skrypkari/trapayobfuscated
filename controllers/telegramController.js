'use strict';const a12_0x2c8416=a12_0x4753;(function(_0x275655,_0x181fa5){const _0x3e1b86=a12_0x4753,_0x436627=_0x275655();while(!![]){try{const _0x3b387e=-parseInt(_0x3e1b86(0x1f7))/0x1*(parseInt(_0x3e1b86(0x1e4))/0x2)+-parseInt(_0x3e1b86(0x1e0))/0x3+-parseInt(_0x3e1b86(0x1d2))/0x4+parseInt(_0x3e1b86(0x1f8))/0x5*(-parseInt(_0x3e1b86(0x20e))/0x6)+-parseInt(_0x3e1b86(0x1f9))/0x7*(-parseInt(_0x3e1b86(0x1d5))/0x8)+-parseInt(_0x3e1b86(0x20c))/0x9*(parseInt(_0x3e1b86(0x1eb))/0xa)+parseInt(_0x3e1b86(0x1d4))/0xb;if(_0x3b387e===_0x181fa5)break;else _0x436627['push'](_0x436627['shift']());}catch(_0x2b45fa){_0x436627['push'](_0x436627['shift']());}}}(a12_0x332e,0x35fe2));function a12_0x332e(){const _0x46a0db=['getTelegramUsers','sendShopNotification','27vofEBJ','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','1146nvWoyA','sendPaymentNotification','Test\x20','shopId','ceil','telegramId','test_payout_123','true','getBotInfo','query','length','findMany','Shop\x20not\x20found','1026772dDdMGw','body','18387644MDsdLx','16AHSLwc','json','../config/database','params','method','USD','__esModule','../services/telegramBotService','default','sendBroadcast','lastName','1145688nKqNoe','amount','firstName','title','2tZQhVz','details','Test\x20Notification','Shop\x20ID\x20is\x20required','update','plisio','status','415270dFojgj','filter','sendPayoutNotification','count','This\x20is\x20a\x20test\x20notification','telegramBotService','Broadcast\x20message\x20sent\x20successfully','findUnique','User\x20disconnected\x20successfully','shop','username','all','417893WuBKHC','9015TjmQDB','262451iHiCmd','Test\x20Product','TelegramController','isVerified','sendTestNotification','completed','telegramUser','defineProperty','__importDefault','map','Markdown','updatedAt','test_payment_123','desc','isActive','payment','productName'];a12_0x332e=function(){return _0x46a0db;};return a12_0x332e();}var __importDefault=this&&this[a12_0x2c8416(0x201)]||function(_0x339e4e){const _0x3f0d50=a12_0x2c8416;return _0x339e4e&&_0x339e4e[_0x3f0d50(0x1db)]?_0x339e4e:{'default':_0x339e4e};};Object[a12_0x2c8416(0x200)](exports,'__esModule',{'value':!![]}),exports[a12_0x2c8416(0x1fb)]=void 0x0;const telegramBotService_1=require(a12_0x2c8416(0x1dc)),database_1=__importDefault(require(a12_0x2c8416(0x1d7)));class TelegramController{constructor(){const _0x35aaab=a12_0x2c8416;this['getBotStatus']=async(_0x1ec6b9,_0x41e7f2,_0x16db97)=>{const _0x33d12a=a12_0x4753;try{const _0x59c58c=telegramBotService_1[_0x33d12a(0x1f0)][_0x33d12a(0x1cd)](),_0x2a480a=await database_1[_0x33d12a(0x1dd)][_0x33d12a(0x1ff)][_0x33d12a(0x1ee)](),_0x1fa9bd=await database_1[_0x33d12a(0x1dd)][_0x33d12a(0x1ff)][_0x33d12a(0x1ee)]({'where':{'isVerified':!![]}}),_0x2bd1f3=await database_1[_0x33d12a(0x1dd)][_0x33d12a(0x1ff)]['groupBy']({'by':[_0x33d12a(0x211)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x41e7f2[_0x33d12a(0x1d6)]({'success':!![],'result':{'bot':{'isActive':_0x59c58c[_0x33d12a(0x207)],'username':_0x59c58c[_0x33d12a(0x1f5)]},'statistics':{'totalUsers':_0x2a480a,'verifiedUsers':_0x1fa9bd,'unverifiedUsers':_0x2a480a-_0x1fa9bd,'connectedShops':_0x2bd1f3[_0x33d12a(0x1cf)]}}});}catch(_0x497fd0){_0x16db97(_0x497fd0);}},this[_0x35aaab(0x20a)]=async(_0x19f12d,_0x3a6cc7,_0x416854)=>{const _0x1e79d5=_0x35aaab;try{const {page:page=0x1,limit:limit=0x14,verified:_0x48f2ba}=_0x19f12d[_0x1e79d5(0x1ce)],_0x137319=(Number(page)-0x1)*Number(limit),_0x5dbdd5={};_0x48f2ba!==undefined&&(_0x5dbdd5['isVerified']=_0x48f2ba===_0x1e79d5(0x1cc));const [_0x5a02d6,_0x10b5f3]=await Promise[_0x1e79d5(0x1f6)]([database_1[_0x1e79d5(0x1dd)][_0x1e79d5(0x1ff)][_0x1e79d5(0x1d0)]({'where':_0x5dbdd5,'skip':_0x137319,'take':Number(limit),'orderBy':{'createdAt':_0x1e79d5(0x206)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x1e79d5(0x1ff)][_0x1e79d5(0x1ee)]({'where':_0x5dbdd5})]);_0x3a6cc7[_0x1e79d5(0x1d6)]({'success':!![],'users':_0x5a02d6[_0x1e79d5(0x202)](_0x38a6f1=>({'id':_0x38a6f1['id'],'telegramId':_0x38a6f1[_0x1e79d5(0x1ca)],'username':_0x38a6f1[_0x1e79d5(0x1f5)],'firstName':_0x38a6f1[_0x1e79d5(0x1e2)],'lastName':_0x38a6f1[_0x1e79d5(0x1df)],'isVerified':_0x38a6f1[_0x1e79d5(0x1fc)],'shop':_0x38a6f1[_0x1e79d5(0x1f4)],'createdAt':_0x38a6f1['createdAt'],'updatedAt':_0x38a6f1[_0x1e79d5(0x204)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x10b5f3,'totalPages':Math[_0x1e79d5(0x1c9)](_0x10b5f3/Number(limit))}});}catch(_0x22ffe2){_0x416854(_0x22ffe2);}},this[_0x35aaab(0x1de)]=async(_0x25b985,_0x55bfef,_0x32e987)=>{const _0x3993bf=_0x35aaab;try{const {message:_0x47b2cf,shopId:_0x5af214}=_0x25b985[_0x3993bf(0x1d3)];if(!_0x47b2cf)return _0x55bfef[_0x3993bf(0x1ea)](0x190)[_0x3993bf(0x1d6)]({'success':![],'message':'Message\x20is\x20required'});if(_0x5af214)await telegramBotService_1[_0x3993bf(0x1f0)][_0x3993bf(0x20b)](_0x5af214,_0x47b2cf,{'parse_mode':'Markdown'});else{const _0x3b991c=await database_1['default'][_0x3993bf(0x1ff)][_0x3993bf(0x1d0)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3a0063=[...new Set(_0x3b991c['map'](_0x5f3774=>_0x5f3774[_0x3993bf(0x211)])[_0x3993bf(0x1ec)](Boolean))];for(const _0x4122cc of _0x3a0063){_0x4122cc&&await telegramBotService_1[_0x3993bf(0x1f0)][_0x3993bf(0x20b)](_0x4122cc,_0x47b2cf,{'parse_mode':_0x3993bf(0x203)});}}_0x55bfef[_0x3993bf(0x1d6)]({'success':!![],'message':_0x3993bf(0x1f1)});}catch(_0x568ea0){_0x32e987(_0x568ea0);}},this['disconnectUser']=async(_0x1b9e17,_0x2e7368,_0x35371e)=>{const _0x17a312=_0x35aaab;try{const {telegramId:_0x13cb31}=_0x1b9e17[_0x17a312(0x1d8)],_0x3d5b9c=await database_1[_0x17a312(0x1dd)][_0x17a312(0x1ff)][_0x17a312(0x1f2)]({'where':{'telegramId':_0x13cb31},'include':{'shop':!![]}});if(!_0x3d5b9c)return _0x2e7368[_0x17a312(0x1ea)](0x194)[_0x17a312(0x1d6)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x17a312(0x1dd)][_0x17a312(0x1ff)][_0x17a312(0x1e8)]({'where':{'telegramId':_0x13cb31},'data':{'shopId':null,'isVerified':![]}}),_0x2e7368[_0x17a312(0x1d6)]({'success':!![],'message':_0x17a312(0x1f3)});}catch(_0x129fc4){_0x35371e(_0x129fc4);}},this[_0x35aaab(0x1fd)]=async(_0x1cb328,_0x3fe8db,_0x328f50)=>{const _0x166a62=_0x35aaab;try{const {shopId:_0x48b718,type:type=_0x166a62(0x208),testData:_0x605f5a}=_0x1cb328['body'];if(!_0x48b718)return _0x3fe8db['status'](0x190)[_0x166a62(0x1d6)]({'success':![],'message':_0x166a62(0x1e7)});const _0x35906a=await database_1['default'][_0x166a62(0x1f4)]['findUnique']({'where':{'id':_0x48b718},'select':{'id':!![],'name':!![]}});if(!_0x35906a)return _0x3fe8db[_0x166a62(0x1ea)](0x194)[_0x166a62(0x1d6)]({'success':![],'message':_0x166a62(0x1d1)});switch(type){case _0x166a62(0x208):const _0x4bf181={'id':_0x166a62(0x205),'amount':_0x605f5a?.[_0x166a62(0x1e1)]||0x64,'currency':_0x605f5a?.['currency']||_0x166a62(0x1da),'productName':_0x605f5a?.[_0x166a62(0x209)]||_0x166a62(0x1fa),'gateway':_0x605f5a?.['gateway']||_0x166a62(0x1e9),'createdAt':new Date(),..._0x605f5a};await telegramBotService_1[_0x166a62(0x1f0)][_0x166a62(0x20f)](_0x48b718,_0x4bf181,'paid');break;case'payout':const _0x54d2b5={'id':_0x166a62(0x1cb),'amount':_0x605f5a?.[_0x166a62(0x1e1)]||0x1f4,'method':_0x605f5a?.[_0x166a62(0x1d9)]||'bank_transfer','createdAt':new Date(),..._0x605f5a};await telegramBotService_1['telegramBotService'][_0x166a62(0x1ed)](_0x48b718,_0x54d2b5,_0x166a62(0x1fe));break;case'custom':await telegramBotService_1[_0x166a62(0x1f0)]['sendCustomNotification'](_0x48b718,_0x605f5a?.[_0x166a62(0x1e3)]||_0x166a62(0x1e6),_0x605f5a?.[_0x166a62(0x1e5)]||{'message':_0x166a62(0x1ef)});break;default:return _0x3fe8db['status'](0x190)[_0x166a62(0x1d6)]({'success':![],'message':_0x166a62(0x20d)});}_0x3fe8db[_0x166a62(0x1d6)]({'success':!![],'message':_0x166a62(0x210)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x13a8e8){_0x328f50(_0x13a8e8);}};}}function a12_0x4753(_0x146e68,_0x316fe7){const _0x332ee6=a12_0x332e();return a12_0x4753=function(_0x47531f,_0x4c458d){_0x47531f=_0x47531f-0x1c9;let _0x1a8229=_0x332ee6[_0x47531f];return _0x1a8229;},a12_0x4753(_0x146e68,_0x316fe7);}exports[a12_0x2c8416(0x1fb)]=TelegramController;