'use strict';const a12_0x410a85=a12_0x1b31;(function(_0x1a9fdb,_0x2becc9){const _0xec5484=a12_0x1b31,_0x307c65=_0x1a9fdb();while(!![]){try{const _0x399abb=parseInt(_0xec5484(0xa1))/0x1+parseInt(_0xec5484(0xc3))/0x2+-parseInt(_0xec5484(0x7d))/0x3+-parseInt(_0xec5484(0xa5))/0x4+parseInt(_0xec5484(0xa2))/0x5+-parseInt(_0xec5484(0x93))/0x6+-parseInt(_0xec5484(0xaf))/0x7;if(_0x399abb===_0x2becc9)break;else _0x307c65['push'](_0x307c65['shift']());}catch(_0x56d068){_0x307c65['push'](_0x307c65['shift']());}}}(a12_0xacd0,0x8fa0d));var __importDefault=this&&this[a12_0x410a85(0xc4)]||function(_0x1397fe){return _0x1397fe&&_0x1397fe['__esModule']?_0x1397fe:{'default':_0x1397fe};};Object[a12_0x410a85(0xbc)](exports,a12_0x410a85(0xb1),{'value':!![]}),exports[a12_0x410a85(0xb2)]=void 0x0;const telegramBotService_1=require(a12_0x410a85(0xae)),database_1=__importDefault(require(a12_0x410a85(0x98)));class TelegramController{constructor(){const _0x3561b9=a12_0x410a85;this[_0x3561b9(0x82)]=async(_0x38fdba,_0x33e284,_0xe53793)=>{const _0x419b98=_0x3561b9;try{const _0x2ad4ab=telegramBotService_1[_0x419b98(0xc1)][_0x419b98(0x9f)](),_0x38f3fb=await database_1[_0x419b98(0xa6)][_0x419b98(0x96)][_0x419b98(0xbb)](),_0x42694c=await database_1['default'][_0x419b98(0x96)][_0x419b98(0xbb)]({'where':{'isVerified':!![]}}),_0x1b81d0=await database_1['default']['telegramUser'][_0x419b98(0x80)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x33e284[_0x419b98(0xb7)]({'success':!![],'result':{'bot':{'isActive':_0x2ad4ab['isActive'],'username':_0x2ad4ab[_0x419b98(0x91)]},'statistics':{'totalUsers':_0x38f3fb,'verifiedUsers':_0x42694c,'unverifiedUsers':_0x38f3fb-_0x42694c,'connectedShops':_0x1b81d0['length']}}});}catch(_0x5b24b4){_0xe53793(_0x5b24b4);}},this[_0x3561b9(0xb0)]=async(_0x1fbf68,_0x58d2e8,_0x35521e)=>{const _0x195762=_0x3561b9;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2555f1}=_0x1fbf68[_0x195762(0xa0)],_0x58d73f=(Number(page)-0x1)*Number(limit),_0x39c834={};_0x2555f1!==undefined&&(_0x39c834[_0x195762(0x9e)]=_0x2555f1===_0x195762(0xb8));const [_0x2eab23,_0x487835]=await Promise['all']([database_1[_0x195762(0xa6)]['telegramUser'][_0x195762(0xa4)]({'where':_0x39c834,'skip':_0x58d73f,'take':Number(limit),'orderBy':{'createdAt':_0x195762(0xb4)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x195762(0xa6)][_0x195762(0x96)]['count']({'where':_0x39c834})]);_0x58d2e8['json']({'success':!![],'users':_0x2eab23[_0x195762(0xa8)](_0x4e03db=>({'id':_0x4e03db['id'],'telegramId':_0x4e03db[_0x195762(0x9d)],'username':_0x4e03db['username'],'firstName':_0x4e03db['firstName'],'lastName':_0x4e03db[_0x195762(0xad)],'isVerified':_0x4e03db[_0x195762(0x9e)],'shop':_0x4e03db[_0x195762(0x89)],'createdAt':_0x4e03db[_0x195762(0x9a)],'updatedAt':_0x4e03db[_0x195762(0x85)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x487835,'totalPages':Math[_0x195762(0x99)](_0x487835/Number(limit))}});}catch(_0x380da3){_0x35521e(_0x380da3);}},this[_0x3561b9(0xb9)]=async(_0x5795b1,_0xda6486,_0x46ea5d)=>{const _0x2639f4=_0x3561b9;try{const {message:_0x564b42,shopId:_0x2eb742}=_0x5795b1[_0x2639f4(0x94)];if(!_0x564b42)return _0xda6486[_0x2639f4(0xbf)](0x190)[_0x2639f4(0xb7)]({'success':![],'message':_0x2639f4(0x7e)});if(_0x2eb742)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x2eb742,_0x564b42,{'parse_mode':_0x2639f4(0x84)});else{const _0x3e0d08=await database_1[_0x2639f4(0xa6)][_0x2639f4(0x96)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x41f176=[...new Set(_0x3e0d08[_0x2639f4(0xa8)](_0x3708ae=>_0x3708ae['shopId'])['filter'](Boolean))];for(const _0x2d3299 of _0x41f176){_0x2d3299&&await telegramBotService_1[_0x2639f4(0xc1)][_0x2639f4(0xb5)](_0x2d3299,_0x564b42,{'parse_mode':_0x2639f4(0x84)});}}_0xda6486[_0x2639f4(0xb7)]({'success':!![],'message':_0x2639f4(0xa3)});}catch(_0x20a705){_0x46ea5d(_0x20a705);}},this[_0x3561b9(0x7f)]=async(_0x28012f,_0x5c7843,_0x2d6a37)=>{const _0x29b278=_0x3561b9;try{const {telegramId:_0x576456}=_0x28012f[_0x29b278(0x90)],_0x2c92b4=await database_1['default'][_0x29b278(0x96)][_0x29b278(0x8a)]({'where':{'telegramId':_0x576456},'include':{'shop':!![]}});if(!_0x2c92b4)return _0x5c7843[_0x29b278(0xbf)](0x194)['json']({'success':![],'message':_0x29b278(0xaa)});await database_1['default']['telegramUser'][_0x29b278(0xab)]({'where':{'telegramId':_0x576456},'data':{'shopId':null,'isVerified':![]}}),_0x5c7843[_0x29b278(0xb7)]({'success':!![],'message':_0x29b278(0x87)});}catch(_0x5f2a05){_0x2d6a37(_0x5f2a05);}},this['sendTestNotification']=async(_0x38b3c6,_0x4def17,_0x16f900)=>{const _0x38eef2=_0x3561b9;try{const {shopId:_0xffab8d,type:type=_0x38eef2(0xac),testData:_0x506bef}=_0x38b3c6[_0x38eef2(0x94)];if(!_0xffab8d)return _0x4def17[_0x38eef2(0xbf)](0x190)[_0x38eef2(0xb7)]({'success':![],'message':_0x38eef2(0x95)});const _0xca9e55=await database_1[_0x38eef2(0xa6)][_0x38eef2(0x89)][_0x38eef2(0x8a)]({'where':{'id':_0xffab8d},'select':{'id':!![],'name':!![]}});if(!_0xca9e55)return _0x4def17[_0x38eef2(0xbf)](0x194)['json']({'success':![],'message':_0x38eef2(0x92)});switch(type){case _0x38eef2(0xac):const _0x30a195={'id':_0x38eef2(0xa9),'amount':_0x506bef?.[_0x38eef2(0xa7)]||0x64,'currency':_0x506bef?.[_0x38eef2(0x83)]||_0x38eef2(0xbe),'productName':_0x506bef?.[_0x38eef2(0x8f)]||'Test\x20Product','gateway':_0x506bef?.[_0x38eef2(0x8d)]||_0x38eef2(0x81),'createdAt':new Date(),..._0x506bef};await telegramBotService_1[_0x38eef2(0xc1)][_0x38eef2(0x9c)](_0xffab8d,_0x30a195,_0x38eef2(0xb3));break;case _0x38eef2(0xc2):const _0x4caeae={'id':_0x38eef2(0x97),'amount':_0x506bef?.[_0x38eef2(0xa7)]||0x1f4,'method':_0x506bef?.[_0x38eef2(0x9b)]||'bank_transfer','createdAt':new Date(),..._0x506bef};await telegramBotService_1[_0x38eef2(0xc1)][_0x38eef2(0x8c)](_0xffab8d,_0x4caeae,_0x38eef2(0xc0));break;case _0x38eef2(0x8b):await telegramBotService_1[_0x38eef2(0xc1)][_0x38eef2(0x8e)](_0xffab8d,_0x506bef?.[_0x38eef2(0x88)]||_0x38eef2(0x86),_0x506bef?.[_0x38eef2(0xbd)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x4def17[_0x38eef2(0xbf)](0x190)['json']({'success':![],'message':_0x38eef2(0xba)});}_0x4def17[_0x38eef2(0xb7)]({'success':!![],'message':_0x38eef2(0xb6)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x9a22c0){_0x16f900(_0x9a22c0);}};}}function a12_0xacd0(){const _0x31cc03=['createdAt','method','sendPaymentNotification','telegramId','isVerified','getBotInfo','query','872849tOgulo','870065DyCihd','Broadcast\x20message\x20sent\x20successfully','findMany','1123124LpFhNC','default','amount','map','test_payment_123','Telegram\x20user\x20not\x20found','update','payment','lastName','../services/telegramBotService','4680676wQoOHY','getTelegramUsers','__esModule','TelegramController','paid','desc','sendShopNotification','Test\x20','json','true','sendBroadcast','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','count','defineProperty','details','USD','status','completed','telegramBotService','payout','1422600VqssMm','__importDefault','272565qGsJES','Message\x20is\x20required','disconnectUser','groupBy','plisio','getBotStatus','currency','Markdown','updatedAt','Test\x20Notification','User\x20disconnected\x20successfully','title','shop','findUnique','custom','sendPayoutNotification','gateway','sendCustomNotification','productName','params','username','Shop\x20not\x20found','777342PXeGnf','body','Shop\x20ID\x20is\x20required','telegramUser','test_payout_123','../config/database','ceil'];a12_0xacd0=function(){return _0x31cc03;};return a12_0xacd0();}function a12_0x1b31(_0x22a0f1,_0x22e741){const _0xacd0c8=a12_0xacd0();return a12_0x1b31=function(_0x1b31e4,_0x471f75){_0x1b31e4=_0x1b31e4-0x7d;let _0x3be7d8=_0xacd0c8[_0x1b31e4];return _0x3be7d8;},a12_0x1b31(_0x22a0f1,_0x22e741);}exports[a12_0x410a85(0xb2)]=TelegramController;