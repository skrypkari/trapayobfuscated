'use strict';const a18_0x57785a=a18_0x4051;(function(_0x50f97c,_0x51bcfd){const _0x410126=a18_0x4051,_0x2a26cf=_0x50f97c();while(!![]){try{const _0x55f1e3=parseInt(_0x410126(0x19c))/0x1+-parseInt(_0x410126(0x1c0))/0x2+parseInt(_0x410126(0x1cc))/0x3*(-parseInt(_0x410126(0x1bf))/0x4)+-parseInt(_0x410126(0x1c3))/0x5+-parseInt(_0x410126(0x1a6))/0x6*(-parseInt(_0x410126(0x1b8))/0x7)+parseInt(_0x410126(0x1d5))/0x8+parseInt(_0x410126(0x1d2))/0x9;if(_0x55f1e3===_0x51bcfd)break;else _0x2a26cf['push'](_0x2a26cf['shift']());}catch(_0x86362e){_0x2a26cf['push'](_0x2a26cf['shift']());}}}(a18_0x2c75,0xa8e35));function a18_0x2c75(){const _0x340db0=['../services/telegramBotService','count','Broadcast\x20message\x20sent\x20successfully','findMany','sendTestNotification','filter','Test\x20Notification','params','Тестовый\x20период','update','This\x20is\x20a\x20test\x20notification','findUnique','sendBroadcast','1081179sWhcZp','body','Telegram\x20user\x20not\x20found','shop','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','__esModule','sendShopNotification','updatedAt','Shop\x20ID\x20is\x20required','isVerified','520488rbiRlU','\x20notification\x20sent\x20successfully','createdAt','status','username','currency','Shop\x20not\x20found','json','query','payment','Markdown','sendPaymentNotification','amount','sendPayoutNotification','groupBy','network','map','true','77NktULP','test_payout_123','Test\x20Product','wallet','paid','Test\x20','TelegramController','13556RZuFda','2148956smEvDc','disconnectUser','all','4753865EbfMmy','custom','desc','default','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','telegramUser','isActive','txid','telegramId','1101uTwCVK','__importDefault','telegramBotService','getTelegramUsers','shopId','length','8282079wHewqm','TRC20','payout','8041128sFbAys','title','USD','getBotStatus'];a18_0x2c75=function(){return _0x340db0;};return a18_0x2c75();}var __importDefault=this&&this[a18_0x57785a(0x1cd)]||function(_0x45d963){const _0x1d7a42=a18_0x57785a;return _0x45d963&&_0x45d963[_0x1d7a42(0x1a1)]?_0x45d963:{'default':_0x45d963};};Object['defineProperty'](exports,a18_0x57785a(0x1a1),{'value':!![]}),exports[a18_0x57785a(0x1be)]=void 0x0;function a18_0x4051(_0x143d0a,_0x4cc86d){_0x143d0a=_0x143d0a-0x199;const _0x2c758e=a18_0x2c75();let _0x40518e=_0x2c758e[_0x143d0a];return _0x40518e;}const telegramBotService_1=require(a18_0x57785a(0x1d9)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x894845=a18_0x57785a;this[_0x894845(0x1d8)]=async(_0x47b3e7,_0x5467d8,_0x51e0e8)=>{const _0x2fdcf5=_0x894845;try{const _0x327322=telegramBotService_1['telegramBotService']['getBotInfo'](),_0xe083d0=await database_1[_0x2fdcf5(0x1c6)]['telegramUser'][_0x2fdcf5(0x1da)](),_0x572c2b=await database_1[_0x2fdcf5(0x1c6)]['telegramUser'][_0x2fdcf5(0x1da)]({'where':{'isVerified':!![]}}),_0x19631=await database_1[_0x2fdcf5(0x1c6)][_0x2fdcf5(0x1c8)][_0x2fdcf5(0x1b4)]({'by':[_0x2fdcf5(0x1d0)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5467d8[_0x2fdcf5(0x1ad)]({'success':!![],'result':{'bot':{'isActive':_0x327322[_0x2fdcf5(0x1c9)],'username':_0x327322[_0x2fdcf5(0x1aa)]},'statistics':{'totalUsers':_0xe083d0,'verifiedUsers':_0x572c2b,'unverifiedUsers':_0xe083d0-_0x572c2b,'connectedShops':_0x19631[_0x2fdcf5(0x1d1)]}}});}catch(_0x220f7e){_0x51e0e8(_0x220f7e);}},this[_0x894845(0x1cf)]=async(_0x19949f,_0x1ec546,_0x48a488)=>{const _0x2cfe5a=_0x894845;try{const {page:page=0x1,limit:limit=0x14,verified:_0x8dd990}=_0x19949f[_0x2cfe5a(0x1ae)],_0x86ed6a=(Number(page)-0x1)*Number(limit),_0x32607e={};_0x8dd990!==undefined&&(_0x32607e['isVerified']=_0x8dd990===_0x2cfe5a(0x1b7));const [_0x5eb452,_0x29a5c0]=await Promise[_0x2cfe5a(0x1c2)]([database_1[_0x2cfe5a(0x1c6)][_0x2cfe5a(0x1c8)][_0x2cfe5a(0x1dc)]({'where':_0x32607e,'skip':_0x86ed6a,'take':Number(limit),'orderBy':{'createdAt':_0x2cfe5a(0x1c5)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2cfe5a(0x1c6)]['telegramUser'][_0x2cfe5a(0x1da)]({'where':_0x32607e})]);_0x1ec546['json']({'success':!![],'users':_0x5eb452[_0x2cfe5a(0x1b6)](_0x56bf7b=>({'id':_0x56bf7b['id'],'telegramId':_0x56bf7b[_0x2cfe5a(0x1cb)],'username':_0x56bf7b[_0x2cfe5a(0x1aa)],'firstName':_0x56bf7b['firstName'],'lastName':_0x56bf7b['lastName'],'isVerified':_0x56bf7b[_0x2cfe5a(0x1a5)],'shop':_0x56bf7b[_0x2cfe5a(0x19f)],'createdAt':_0x56bf7b[_0x2cfe5a(0x1a8)],'updatedAt':_0x56bf7b[_0x2cfe5a(0x1a3)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x29a5c0,'totalPages':Math['ceil'](_0x29a5c0/Number(limit))}});}catch(_0x54414c){_0x48a488(_0x54414c);}},this[_0x894845(0x19b)]=async(_0x3e27ea,_0x37bcad,_0x401339)=>{const _0x44c056=_0x894845;try{const {message:_0x36354e,shopId:_0x4cb2f9}=_0x3e27ea[_0x44c056(0x19d)];if(!_0x36354e)return _0x37bcad[_0x44c056(0x1a9)](0x190)[_0x44c056(0x1ad)]({'success':![],'message':'Message\x20is\x20required'});if(_0x4cb2f9)await telegramBotService_1[_0x44c056(0x1ce)][_0x44c056(0x1a2)](_0x4cb2f9,_0x36354e,{'parse_mode':_0x44c056(0x1b0)});else{const _0x58cc4c=await database_1[_0x44c056(0x1c6)][_0x44c056(0x1c8)][_0x44c056(0x1dc)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x499c68=[...new Set(_0x58cc4c[_0x44c056(0x1b6)](_0x28d515=>_0x28d515['shopId'])[_0x44c056(0x1de)](Boolean))];for(const _0xb74a57 of _0x499c68){_0xb74a57&&await telegramBotService_1[_0x44c056(0x1ce)][_0x44c056(0x1a2)](_0xb74a57,_0x36354e,{'parse_mode':_0x44c056(0x1b0)});}}_0x37bcad[_0x44c056(0x1ad)]({'success':!![],'message':_0x44c056(0x1db)});}catch(_0x2c7a52){_0x401339(_0x2c7a52);}},this[_0x894845(0x1c1)]=async(_0x3e493a,_0x52612f,_0x3c7654)=>{const _0xdf765f=_0x894845;try{const {telegramId:_0x11ae1c}=_0x3e493a[_0xdf765f(0x1e0)],_0xd148f9=await database_1[_0xdf765f(0x1c6)]['telegramUser'][_0xdf765f(0x19a)]({'where':{'telegramId':_0x11ae1c},'include':{'shop':!![]}});if(!_0xd148f9)return _0x52612f[_0xdf765f(0x1a9)](0x194)[_0xdf765f(0x1ad)]({'success':![],'message':_0xdf765f(0x19e)});await database_1['default']['telegramUser'][_0xdf765f(0x1e2)]({'where':{'telegramId':_0x11ae1c},'data':{'shopId':null,'isVerified':![]}}),_0x52612f['json']({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x20efe7){_0x3c7654(_0x20efe7);}},this[_0x894845(0x1dd)]=async(_0x59df4d,_0x100206,_0x36488e)=>{const _0x51af58=_0x894845;try{const {shopId:_0x2481e3,type:type=_0x51af58(0x1af),testData:_0x33f2f9}=_0x59df4d[_0x51af58(0x19d)];if(!_0x2481e3)return _0x100206[_0x51af58(0x1a9)](0x190)[_0x51af58(0x1ad)]({'success':![],'message':_0x51af58(0x1a4)});const _0x185b2a=await database_1[_0x51af58(0x1c6)][_0x51af58(0x19f)][_0x51af58(0x19a)]({'where':{'id':_0x2481e3},'select':{'id':!![],'name':!![]}});if(!_0x185b2a)return _0x100206[_0x51af58(0x1a9)](0x194)[_0x51af58(0x1ad)]({'success':![],'message':_0x51af58(0x1ac)});switch(type){case _0x51af58(0x1af):const _0xe5f8fb={'id':'test_payment_123','amount':_0x33f2f9?.[_0x51af58(0x1b2)]||0x64,'currency':_0x33f2f9?.[_0x51af58(0x1ab)]||_0x51af58(0x1d7),'productName':_0x33f2f9?.['productName']||_0x51af58(0x1ba),'gateway':_0x33f2f9?.['gateway']||'plisio','createdAt':new Date(),..._0x33f2f9};await telegramBotService_1['telegramBotService'][_0x51af58(0x1b1)](_0x2481e3,_0xe5f8fb,_0x51af58(0x1bc));break;case _0x51af58(0x1d4):const _0x4b6277={'id':_0x51af58(0x1b9),'amount':_0x33f2f9?.[_0x51af58(0x1b2)]||0x1f4,'network':_0x33f2f9?.[_0x51af58(0x1b5)]||_0x51af58(0x1d3),'wallet':_0x33f2f9?.[_0x51af58(0x1bb)]||_0x51af58(0x1a0),'period':_0x51af58(0x1e1),'createdAt':new Date(),'txid':_0x33f2f9?.[_0x51af58(0x1ca)]||null,..._0x33f2f9};await telegramBotService_1[_0x51af58(0x1ce)][_0x51af58(0x1b3)](_0x2481e3,_0x4b6277);break;case _0x51af58(0x1c4):await telegramBotService_1[_0x51af58(0x1ce)]['sendCustomNotification'](_0x2481e3,_0x33f2f9?.[_0x51af58(0x1d6)]||_0x51af58(0x1df),_0x33f2f9?.['details']||{'message':_0x51af58(0x199)});break;default:return _0x100206[_0x51af58(0x1a9)](0x190)['json']({'success':![],'message':_0x51af58(0x1c7)});}_0x100206[_0x51af58(0x1ad)]({'success':!![],'message':_0x51af58(0x1bd)+type+_0x51af58(0x1a7)});}catch(_0x5e5500){_0x36488e(_0x5e5500);}};}}exports[a18_0x57785a(0x1be)]=TelegramController;