'use strict';function a12_0x5e24(_0x22766b,_0x31acc0){const _0x4c067b=a12_0x4c06();return a12_0x5e24=function(_0x5e2492,_0x1572b6){_0x5e2492=_0x5e2492-0x19e;let _0x14f923=_0x4c067b[_0x5e2492];return _0x14f923;},a12_0x5e24(_0x22766b,_0x31acc0);}const a12_0x372ffe=a12_0x5e24;(function(_0x3d7d99,_0x55b078){const _0x55ba75=a12_0x5e24,_0x48717=_0x3d7d99();while(!![]){try{const _0x4dcd13=-parseInt(_0x55ba75(0x19f))/0x1+-parseInt(_0x55ba75(0x1dc))/0x2+parseInt(_0x55ba75(0x1b0))/0x3*(parseInt(_0x55ba75(0x1e5))/0x4)+-parseInt(_0x55ba75(0x1b7))/0x5*(-parseInt(_0x55ba75(0x1b3))/0x6)+parseInt(_0x55ba75(0x1a8))/0x7+parseInt(_0x55ba75(0x1ae))/0x8*(-parseInt(_0x55ba75(0x1ac))/0x9)+parseInt(_0x55ba75(0x1db))/0xa*(parseInt(_0x55ba75(0x1de))/0xb);if(_0x4dcd13===_0x55b078)break;else _0x48717['push'](_0x48717['shift']());}catch(_0x3eba86){_0x48717['push'](_0x48717['shift']());}}}(a12_0x4c06,0x3614c));var __importDefault=this&&this['__importDefault']||function(_0x3133cf){const _0x244212=a12_0x5e24;return _0x3133cf&&_0x3133cf[_0x244212(0x1e1)]?_0x3133cf:{'default':_0x3133cf};};Object[a12_0x372ffe(0x1cd)](exports,a12_0x372ffe(0x1e1),{'value':!![]}),exports[a12_0x372ffe(0x1d3)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x372ffe(0x1cb)));class TelegramController{constructor(){const _0x13bb99=a12_0x372ffe;this[_0x13bb99(0x1d6)]=async(_0x66a3a3,_0x540f30,_0x3d89dc)=>{const _0x8740c8=_0x13bb99;try{const _0x1ae501=telegramBotService_1[_0x8740c8(0x1b8)][_0x8740c8(0x1b1)](),_0x2fb088=await database_1['default'][_0x8740c8(0x1c3)][_0x8740c8(0x1bd)](),_0xb49b53=await database_1[_0x8740c8(0x1c5)][_0x8740c8(0x1c3)][_0x8740c8(0x1bd)]({'where':{'isVerified':!![]}}),_0x2f5a07=await database_1[_0x8740c8(0x1c5)][_0x8740c8(0x1c3)]['groupBy']({'by':[_0x8740c8(0x1cf)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x540f30[_0x8740c8(0x1b5)]({'success':!![],'result':{'bot':{'isActive':_0x1ae501[_0x8740c8(0x1d2)],'username':_0x1ae501[_0x8740c8(0x1a5)]},'statistics':{'totalUsers':_0x2fb088,'verifiedUsers':_0xb49b53,'unverifiedUsers':_0x2fb088-_0xb49b53,'connectedShops':_0x2f5a07[_0x8740c8(0x1a2)]}}});}catch(_0x4c61db){_0x3d89dc(_0x4c61db);}},this[_0x13bb99(0x1bc)]=async(_0x5bf2a9,_0x3dfbef,_0x1524dd)=>{const _0x194312=_0x13bb99;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3a9c71}=_0x5bf2a9['query'],_0xceb3b9=(Number(page)-0x1)*Number(limit),_0x4e8582={};_0x3a9c71!==undefined&&(_0x4e8582[_0x194312(0x1aa)]=_0x3a9c71==='true');const [_0x55c4e0,_0x531fc8]=await Promise[_0x194312(0x1af)]([database_1[_0x194312(0x1c5)][_0x194312(0x1c3)]['findMany']({'where':_0x4e8582,'skip':_0xceb3b9,'take':Number(limit),'orderBy':{'createdAt':_0x194312(0x1ce)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x194312(0x1c5)][_0x194312(0x1c3)][_0x194312(0x1bd)]({'where':_0x4e8582})]);_0x3dfbef[_0x194312(0x1b5)]({'success':!![],'users':_0x55c4e0[_0x194312(0x1e0)](_0x1850e3=>({'id':_0x1850e3['id'],'telegramId':_0x1850e3[_0x194312(0x1c7)],'username':_0x1850e3[_0x194312(0x1a5)],'firstName':_0x1850e3[_0x194312(0x1b9)],'lastName':_0x1850e3[_0x194312(0x1d7)],'isVerified':_0x1850e3[_0x194312(0x1aa)],'shop':_0x1850e3[_0x194312(0x1a1)],'createdAt':_0x1850e3[_0x194312(0x1cc)],'updatedAt':_0x1850e3[_0x194312(0x1bf)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x531fc8,'totalPages':Math[_0x194312(0x1c4)](_0x531fc8/Number(limit))}});}catch(_0xc21a0a){_0x1524dd(_0xc21a0a);}},this[_0x13bb99(0x1e2)]=async(_0x128b40,_0xfd3be0,_0x32e527)=>{const _0x4ccb55=_0x13bb99;try{const {message:_0xb2a04a,shopId:_0x7068b7}=_0x128b40['body'];if(!_0xb2a04a)return _0xfd3be0['status'](0x190)[_0x4ccb55(0x1b5)]({'success':![],'message':'Message\x20is\x20required'});if(_0x7068b7)await telegramBotService_1[_0x4ccb55(0x1b8)][_0x4ccb55(0x1bb)](_0x7068b7,_0xb2a04a,{'parse_mode':'Markdown'});else{const _0x40165f=await database_1['default'][_0x4ccb55(0x1c3)][_0x4ccb55(0x1a9)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5145b5=[...new Set(_0x40165f[_0x4ccb55(0x1e0)](_0x1ce6e4=>_0x1ce6e4[_0x4ccb55(0x1cf)])['filter'](Boolean))];for(const _0x128b75 of _0x5145b5){_0x128b75&&await telegramBotService_1[_0x4ccb55(0x1b8)]['sendShopNotification'](_0x128b75,_0xb2a04a,{'parse_mode':_0x4ccb55(0x1ad)});}}_0xfd3be0[_0x4ccb55(0x1b5)]({'success':!![],'message':_0x4ccb55(0x1a0)});}catch(_0x3ad93c){_0x32e527(_0x3ad93c);}},this[_0x13bb99(0x1c9)]=async(_0x593a65,_0xc017b1,_0x181c3d)=>{const _0x421050=_0x13bb99;try{const {telegramId:_0xdf515}=_0x593a65[_0x421050(0x1d5)],_0x34de6a=await database_1['default'][_0x421050(0x1c3)]['findUnique']({'where':{'telegramId':_0xdf515},'include':{'shop':!![]}});if(!_0x34de6a)return _0xc017b1[_0x421050(0x1c0)](0x194)['json']({'success':![],'message':_0x421050(0x1c6)});await database_1[_0x421050(0x1c5)][_0x421050(0x1c3)][_0x421050(0x1c1)]({'where':{'telegramId':_0xdf515},'data':{'shopId':null,'isVerified':![]}}),_0xc017b1[_0x421050(0x1b5)]({'success':!![],'message':_0x421050(0x1da)});}catch(_0xd71ea4){_0x181c3d(_0xd71ea4);}},this[_0x13bb99(0x1d9)]=async(_0x8b33b6,_0x15967f,_0x10db27)=>{const _0x1e662b=_0x13bb99;try{const {shopId:_0x2f7b47,type:type=_0x1e662b(0x1dd),testData:_0x723e00}=_0x8b33b6[_0x1e662b(0x1e3)];if(!_0x2f7b47)return _0x15967f['status'](0x190)[_0x1e662b(0x1b5)]({'success':![],'message':_0x1e662b(0x1d1)});const _0xabaae4=await database_1[_0x1e662b(0x1c5)][_0x1e662b(0x1a1)]['findUnique']({'where':{'id':_0x2f7b47},'select':{'id':!![],'name':!![]}});if(!_0xabaae4)return _0x15967f[_0x1e662b(0x1c0)](0x194)[_0x1e662b(0x1b5)]({'success':![],'message':_0x1e662b(0x1d8)});switch(type){case _0x1e662b(0x1dd):const _0x57f07c={'id':_0x1e662b(0x1a4),'amount':_0x723e00?.[_0x1e662b(0x1c8)]||0x64,'currency':_0x723e00?.['currency']||_0x1e662b(0x1be),'productName':_0x723e00?.[_0x1e662b(0x1b4)]||_0x1e662b(0x1a7),'gateway':_0x723e00?.['gateway']||_0x1e662b(0x19e),'createdAt':new Date(),..._0x723e00};await telegramBotService_1[_0x1e662b(0x1b8)][_0x1e662b(0x1e4)](_0x2f7b47,_0x57f07c,_0x1e662b(0x1b2));break;case'payout':const _0x4d6338={'id':_0x1e662b(0x1a6),'amount':_0x723e00?.[_0x1e662b(0x1c8)]||0x1f4,'method':_0x723e00?.[_0x1e662b(0x1d4)]||_0x1e662b(0x1e6),'createdAt':new Date(),..._0x723e00};await telegramBotService_1[_0x1e662b(0x1b8)][_0x1e662b(0x1b6)](_0x2f7b47,_0x4d6338,'completed');break;case _0x1e662b(0x1ba):await telegramBotService_1[_0x1e662b(0x1b8)][_0x1e662b(0x1d0)](_0x2f7b47,_0x723e00?.[_0x1e662b(0x1a3)]||'Test\x20Notification',_0x723e00?.['details']||{'message':_0x1e662b(0x1ca)});break;default:return _0x15967f[_0x1e662b(0x1c0)](0x190)[_0x1e662b(0x1b5)]({'success':![],'message':_0x1e662b(0x1df)});}_0x15967f[_0x1e662b(0x1b5)]({'success':!![],'message':_0x1e662b(0x1ab)+type+_0x1e662b(0x1c2)});}catch(_0x387dc3){_0x10db27(_0x387dc3);}};}}function a12_0x4c06(){const _0x47f739=['params','getBotStatus','lastName','Shop\x20not\x20found','sendTestNotification','User\x20disconnected\x20successfully','330CZnzuL','744718XEaGic','payment','258599sIzWXg','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','map','__esModule','sendBroadcast','body','sendPaymentNotification','37676WtdvID','bank_transfer','plisio','214549oFFWCa','Broadcast\x20message\x20sent\x20successfully','shop','length','title','test_payment_123','username','test_payout_123','Test\x20Product','1582875pYPCww','findMany','isVerified','Test\x20','9VZJEYG','Markdown','2561128fcXZWZ','all','9dOxtVE','getBotInfo','paid','6YadlXJ','productName','json','sendPayoutNotification','491930UdoTNb','telegramBotService','firstName','custom','sendShopNotification','getTelegramUsers','count','USD','updatedAt','status','update','\x20notification\x20sent\x20successfully','telegramUser','ceil','default','Telegram\x20user\x20not\x20found','telegramId','amount','disconnectUser','This\x20is\x20a\x20test\x20notification','../config/database','createdAt','defineProperty','desc','shopId','sendCustomNotification','Shop\x20ID\x20is\x20required','isActive','TelegramController','method'];a12_0x4c06=function(){return _0x47f739;};return a12_0x4c06();}exports[a12_0x372ffe(0x1d3)]=TelegramController;