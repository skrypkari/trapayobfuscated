'use strict';function a12_0x583b(_0x4e1c66,_0x296f51){const _0x5c8959=a12_0x5c89();return a12_0x583b=function(_0x583b2d,_0x53dabb){_0x583b2d=_0x583b2d-0x1c0;let _0x362e51=_0x5c8959[_0x583b2d];return _0x362e51;},a12_0x583b(_0x4e1c66,_0x296f51);}const a12_0x34fd9f=a12_0x583b;(function(_0x20acde,_0x58e607){const _0x57b43d=a12_0x583b,_0x21ec46=_0x20acde();while(!![]){try{const _0x21019d=parseInt(_0x57b43d(0x203))/0x1+-parseInt(_0x57b43d(0x1ef))/0x2*(parseInt(_0x57b43d(0x1ce))/0x3)+-parseInt(_0x57b43d(0x1f2))/0x4*(-parseInt(_0x57b43d(0x1de))/0x5)+-parseInt(_0x57b43d(0x1f6))/0x6*(-parseInt(_0x57b43d(0x1f0))/0x7)+parseInt(_0x57b43d(0x1f1))/0x8*(parseInt(_0x57b43d(0x1c2))/0x9)+parseInt(_0x57b43d(0x1c5))/0xa+-parseInt(_0x57b43d(0x1ee))/0xb;if(_0x21019d===_0x58e607)break;else _0x21ec46['push'](_0x21ec46['shift']());}catch(_0x569d56){_0x21ec46['push'](_0x21ec46['shift']());}}}(a12_0x5c89,0xb6c05));var __importDefault=this&&this['__importDefault']||function(_0x437669){return _0x437669&&_0x437669['__esModule']?_0x437669:{'default':_0x437669};};Object[a12_0x34fd9f(0x1df)](exports,a12_0x34fd9f(0x1c1),{'value':!![]}),exports[a12_0x34fd9f(0x1c3)]=void 0x0;const telegramBotService_1=require(a12_0x34fd9f(0x202)),database_1=__importDefault(require(a12_0x34fd9f(0x1cf)));class TelegramController{constructor(){const _0xf67629=a12_0x34fd9f;this[_0xf67629(0x1ea)]=async(_0x1fb411,_0x235595,_0x405b73)=>{const _0x2e133d=_0xf67629;try{const _0x38044f=telegramBotService_1[_0x2e133d(0x1ec)]['getBotInfo'](),_0x233dda=await database_1['default'][_0x2e133d(0x1f5)][_0x2e133d(0x1c6)](),_0x33ce80=await database_1['default'][_0x2e133d(0x1f5)]['count']({'where':{'isVerified':!![]}}),_0x558eff=await database_1[_0x2e133d(0x1da)][_0x2e133d(0x1f5)][_0x2e133d(0x1e4)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x235595[_0x2e133d(0x1e2)]({'success':!![],'result':{'bot':{'isActive':_0x38044f[_0x2e133d(0x201)],'username':_0x38044f[_0x2e133d(0x1ca)]},'statistics':{'totalUsers':_0x233dda,'verifiedUsers':_0x33ce80,'unverifiedUsers':_0x233dda-_0x33ce80,'connectedShops':_0x558eff[_0x2e133d(0x1db)]}}});}catch(_0x4f009b){_0x405b73(_0x4f009b);}},this[_0xf67629(0x1fc)]=async(_0x114839,_0x32d9f2,_0x3408a2)=>{const _0x4bfe3a=_0xf67629;try{const {page:page=0x1,limit:limit=0x14,verified:_0x564c4d}=_0x114839['query'],_0x2f3812=(Number(page)-0x1)*Number(limit),_0x3a5051={};_0x564c4d!==undefined&&(_0x3a5051[_0x4bfe3a(0x1fa)]=_0x564c4d==='true');const [_0x3ef182,_0x5a1f21]=await Promise[_0x4bfe3a(0x1d8)]([database_1['default']['telegramUser'][_0x4bfe3a(0x1d1)]({'where':_0x3a5051,'skip':_0x2f3812,'take':Number(limit),'orderBy':{'createdAt':_0x4bfe3a(0x1cb)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4bfe3a(0x1da)]['telegramUser'][_0x4bfe3a(0x1c6)]({'where':_0x3a5051})]);_0x32d9f2[_0x4bfe3a(0x1e2)]({'success':!![],'users':_0x3ef182[_0x4bfe3a(0x1d5)](_0xedafa1=>({'id':_0xedafa1['id'],'telegramId':_0xedafa1[_0x4bfe3a(0x1cd)],'username':_0xedafa1[_0x4bfe3a(0x1ca)],'firstName':_0xedafa1[_0x4bfe3a(0x1e9)],'lastName':_0xedafa1[_0x4bfe3a(0x205)],'isVerified':_0xedafa1[_0x4bfe3a(0x1fa)],'shop':_0xedafa1['shop'],'createdAt':_0xedafa1[_0x4bfe3a(0x1e1)],'updatedAt':_0xedafa1['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5a1f21,'totalPages':Math[_0x4bfe3a(0x1cc)](_0x5a1f21/Number(limit))}});}catch(_0x248585){_0x3408a2(_0x248585);}},this['sendBroadcast']=async(_0x21d449,_0x4e292f,_0x41231d)=>{const _0x4b972d=_0xf67629;try{const {message:_0x23cf5d,shopId:_0x1d4efc}=_0x21d449['body'];if(!_0x23cf5d)return _0x4e292f[_0x4b972d(0x1c7)](0x190)[_0x4b972d(0x1e2)]({'success':![],'message':_0x4b972d(0x1e3)});if(_0x1d4efc)await telegramBotService_1['telegramBotService'][_0x4b972d(0x1c4)](_0x1d4efc,_0x23cf5d,{'parse_mode':_0x4b972d(0x200)});else{const _0x4616ee=await database_1[_0x4b972d(0x1da)][_0x4b972d(0x1f5)][_0x4b972d(0x1d1)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x356ff0=[...new Set(_0x4616ee[_0x4b972d(0x1d5)](_0x46b05d=>_0x46b05d[_0x4b972d(0x1fb)])['filter'](Boolean))];for(const _0x9c121 of _0x356ff0){_0x9c121&&await telegramBotService_1[_0x4b972d(0x1ec)][_0x4b972d(0x1c4)](_0x9c121,_0x23cf5d,{'parse_mode':_0x4b972d(0x200)});}}_0x4e292f[_0x4b972d(0x1e2)]({'success':!![],'message':_0x4b972d(0x1c9)});}catch(_0xc88bea){_0x41231d(_0xc88bea);}},this[_0xf67629(0x1f9)]=async(_0x2bf93c,_0x11daeb,_0x3dee1d)=>{const _0xafb4e7=_0xf67629;try{const {telegramId:_0x35a671}=_0x2bf93c[_0xafb4e7(0x1ff)],_0x2810e2=await database_1['default'][_0xafb4e7(0x1f5)][_0xafb4e7(0x1dd)]({'where':{'telegramId':_0x35a671},'include':{'shop':!![]}});if(!_0x2810e2)return _0x11daeb['status'](0x194)[_0xafb4e7(0x1e2)]({'success':![],'message':_0xafb4e7(0x204)});await database_1[_0xafb4e7(0x1da)]['telegramUser'][_0xafb4e7(0x1d0)]({'where':{'telegramId':_0x35a671},'data':{'shopId':null,'isVerified':![]}}),_0x11daeb['json']({'success':!![],'message':_0xafb4e7(0x1e8)});}catch(_0x2b2410){_0x3dee1d(_0x2b2410);}},this['sendTestNotification']=async(_0x18825b,_0x27a2d9,_0x4f4a0f)=>{const _0x12f5b7=_0xf67629;try{const {shopId:_0x36d295,type:type=_0x12f5b7(0x1f4),testData:_0x26cd5b}=_0x18825b[_0x12f5b7(0x1d9)];if(!_0x36d295)return _0x27a2d9['status'](0x190)[_0x12f5b7(0x1e2)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0xd3dfdc=await database_1[_0x12f5b7(0x1da)]['shop'][_0x12f5b7(0x1dd)]({'where':{'id':_0x36d295},'select':{'id':!![],'name':!![]}});if(!_0xd3dfdc)return _0x27a2d9[_0x12f5b7(0x1c7)](0x194)[_0x12f5b7(0x1e2)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0x2dad02={'id':_0x12f5b7(0x1c8),'amount':_0x26cd5b?.[_0x12f5b7(0x1ed)]||0x64,'currency':_0x26cd5b?.[_0x12f5b7(0x1f7)]||_0x12f5b7(0x206),'productName':_0x26cd5b?.[_0x12f5b7(0x1e5)]||_0x12f5b7(0x1f3),'gateway':_0x26cd5b?.[_0x12f5b7(0x1eb)]||_0x12f5b7(0x1d4),'createdAt':new Date(),..._0x26cd5b};await telegramBotService_1[_0x12f5b7(0x1ec)][_0x12f5b7(0x1dc)](_0x36d295,_0x2dad02,_0x12f5b7(0x1c0));break;case'payout':const _0x140d5f={'id':'test_payout_123','amount':_0x26cd5b?.['amount']||0x1f4,'method':_0x26cd5b?.[_0x12f5b7(0x1e6)]||_0x12f5b7(0x1d6),'createdAt':new Date(),..._0x26cd5b};await telegramBotService_1[_0x12f5b7(0x1ec)][_0x12f5b7(0x1e7)](_0x36d295,_0x140d5f,_0x12f5b7(0x1fe));break;case _0x12f5b7(0x1f8):await telegramBotService_1['telegramBotService'][_0x12f5b7(0x1d3)](_0x36d295,_0x26cd5b?.['title']||_0x12f5b7(0x1e0),_0x26cd5b?.[_0x12f5b7(0x1d2)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x27a2d9['status'](0x190)[_0x12f5b7(0x1e2)]({'success':![],'message':_0x12f5b7(0x1fd)});}_0x27a2d9[_0x12f5b7(0x1e2)]({'success':!![],'message':'Test\x20'+type+_0x12f5b7(0x1d7)});}catch(_0x41224e){_0x4f4a0f(_0x41224e);}};}}function a12_0x5c89(){const _0x56e226=['\x20notification\x20sent\x20successfully','all','body','default','length','sendPaymentNotification','findUnique','20290KLaucA','defineProperty','Test\x20Notification','createdAt','json','Message\x20is\x20required','groupBy','productName','method','sendPayoutNotification','User\x20disconnected\x20successfully','firstName','getBotStatus','gateway','telegramBotService','amount','24558380oBmldF','282CeTXuY','7ODcwcm','304eSVEdy','464cfXOBW','Test\x20Product','payment','telegramUser','830256apWbJM','currency','custom','disconnectUser','isVerified','shopId','getTelegramUsers','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','completed','params','Markdown','isActive','../services/telegramBotService','1089859NcBdCI','Telegram\x20user\x20not\x20found','lastName','USD','paid','__esModule','334647OLcMxK','TelegramController','sendShopNotification','3510090zIMuSH','count','status','test_payment_123','Broadcast\x20message\x20sent\x20successfully','username','desc','ceil','telegramId','10251sFvhum','../config/database','update','findMany','details','sendCustomNotification','plisio','map','bank_transfer'];a12_0x5c89=function(){return _0x56e226;};return a12_0x5c89();}exports[a12_0x34fd9f(0x1c3)]=TelegramController;