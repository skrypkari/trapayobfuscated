'use strict';const a12_0x3668d0=a12_0x24e4;(function(_0x1aa950,_0x18f727){const _0x3ff0c4=a12_0x24e4,_0x1fe29f=_0x1aa950();while(!![]){try{const _0x3b2e0f=-parseInt(_0x3ff0c4(0x1ef))/0x1+-parseInt(_0x3ff0c4(0x1f7))/0x2+-parseInt(_0x3ff0c4(0x1d8))/0x3*(parseInt(_0x3ff0c4(0x1f3))/0x4)+parseInt(_0x3ff0c4(0x1f8))/0x5*(-parseInt(_0x3ff0c4(0x1d0))/0x6)+-parseInt(_0x3ff0c4(0x205))/0x7*(parseInt(_0x3ff0c4(0x1fe))/0x8)+parseInt(_0x3ff0c4(0x1e7))/0x9*(parseInt(_0x3ff0c4(0x1df))/0xa)+parseInt(_0x3ff0c4(0x209))/0xb;if(_0x3b2e0f===_0x18f727)break;else _0x1fe29f['push'](_0x1fe29f['shift']());}catch(_0x464996){_0x1fe29f['push'](_0x1fe29f['shift']());}}}(a12_0x2877,0x98ff8));function a12_0x2877(){const _0x2215b8=['lastName','3MnKdOq','createdAt','findUnique','ceil','TelegramController','updatedAt','desc','2685940KkerhC','default','body','completed','sendTestNotification','true','telegramId','\x20notification\x20sent\x20successfully','36cCdvpe','sendBroadcast','groupBy','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','title','This\x20is\x20a\x20test\x20notification','amount','payment','634089IZOMsr','shopId','shop','sendShopNotification','58544OwIrwo','count','defineProperty','isVerified','2196600IeMHaa','260045wzlWiu','Broadcast\x20message\x20sent\x20successfully','getBotInfo','isActive','test_payment_123','telegramUser','2792GckCAn','update','test_payout_123','paid','telegramBotService','username','json','7161yXcfVX','plisio','../config/database','details','21080411HAibpo','findMany','productName','payout','method','getBotStatus','__esModule','Shop\x20ID\x20is\x20required','params','filter','../services/telegramBotService','status','30nozKdU','Test\x20Product','gateway','Test\x20','Markdown','map','query'];a12_0x2877=function(){return _0x2215b8;};return a12_0x2877();}var __importDefault=this&&this['__importDefault']||function(_0x457da0){return _0x457da0&&_0x457da0['__esModule']?_0x457da0:{'default':_0x457da0};};function a12_0x24e4(_0x381c70,_0x3626d4){const _0x2877f1=a12_0x2877();return a12_0x24e4=function(_0x24e476,_0x6780ef){_0x24e476=_0x24e476-0x1cf;let _0x413b4e=_0x2877f1[_0x24e476];return _0x413b4e;},a12_0x24e4(_0x381c70,_0x3626d4);}Object[a12_0x3668d0(0x1f5)](exports,a12_0x3668d0(0x20f),{'value':!![]}),exports[a12_0x3668d0(0x1dc)]=void 0x0;const telegramBotService_1=require(a12_0x3668d0(0x213)),database_1=__importDefault(require(a12_0x3668d0(0x207)));class TelegramController{constructor(){const _0x340b96=a12_0x3668d0;this[_0x340b96(0x20e)]=async(_0x236b94,_0x3f8487,_0x2c514d)=>{const _0x1dccc3=_0x340b96;try{const _0x30ea2d=telegramBotService_1[_0x1dccc3(0x202)][_0x1dccc3(0x1fa)](),_0x22710c=await database_1[_0x1dccc3(0x1e0)]['telegramUser'][_0x1dccc3(0x1f4)](),_0x3a1f17=await database_1[_0x1dccc3(0x1e0)]['telegramUser'][_0x1dccc3(0x1f4)]({'where':{'isVerified':!![]}}),_0x34a840=await database_1[_0x1dccc3(0x1e0)][_0x1dccc3(0x1fd)][_0x1dccc3(0x1e9)]({'by':[_0x1dccc3(0x1f0)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3f8487[_0x1dccc3(0x204)]({'success':!![],'result':{'bot':{'isActive':_0x30ea2d[_0x1dccc3(0x1fb)],'username':_0x30ea2d[_0x1dccc3(0x203)]},'statistics':{'totalUsers':_0x22710c,'verifiedUsers':_0x3a1f17,'unverifiedUsers':_0x22710c-_0x3a1f17,'connectedShops':_0x34a840['length']}}});}catch(_0x30f736){_0x2c514d(_0x30f736);}},this['getTelegramUsers']=async(_0x1afef1,_0x162cbb,_0x28970a)=>{const _0x3632c4=_0x340b96;try{const {page:page=0x1,limit:limit=0x14,verified:_0x10d7e7}=_0x1afef1[_0x3632c4(0x1d6)],_0x15c887=(Number(page)-0x1)*Number(limit),_0x43888d={};_0x10d7e7!==undefined&&(_0x43888d['isVerified']=_0x10d7e7===_0x3632c4(0x1e4));const [_0x1cc055,_0x292757]=await Promise['all']([database_1['default']['telegramUser'][_0x3632c4(0x20a)]({'where':_0x43888d,'skip':_0x15c887,'take':Number(limit),'orderBy':{'createdAt':_0x3632c4(0x1de)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x3632c4(0x1e0)][_0x3632c4(0x1fd)][_0x3632c4(0x1f4)]({'where':_0x43888d})]);_0x162cbb[_0x3632c4(0x204)]({'success':!![],'users':_0x1cc055[_0x3632c4(0x1d5)](_0x445ad1=>({'id':_0x445ad1['id'],'telegramId':_0x445ad1[_0x3632c4(0x1e5)],'username':_0x445ad1[_0x3632c4(0x203)],'firstName':_0x445ad1['firstName'],'lastName':_0x445ad1[_0x3632c4(0x1d7)],'isVerified':_0x445ad1[_0x3632c4(0x1f6)],'shop':_0x445ad1['shop'],'createdAt':_0x445ad1[_0x3632c4(0x1d9)],'updatedAt':_0x445ad1[_0x3632c4(0x1dd)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x292757,'totalPages':Math[_0x3632c4(0x1db)](_0x292757/Number(limit))}});}catch(_0x3a004a){_0x28970a(_0x3a004a);}},this[_0x340b96(0x1e8)]=async(_0x5cf23d,_0x53f372,_0x3059fb)=>{const _0x55d395=_0x340b96;try{const {message:_0x185382,shopId:_0x5b3c3e}=_0x5cf23d[_0x55d395(0x1e1)];if(!_0x185382)return _0x53f372[_0x55d395(0x1cf)](0x190)[_0x55d395(0x204)]({'success':![],'message':'Message\x20is\x20required'});if(_0x5b3c3e)await telegramBotService_1['telegramBotService'][_0x55d395(0x1f2)](_0x5b3c3e,_0x185382,{'parse_mode':_0x55d395(0x1d4)});else{const _0xa22f52=await database_1['default'][_0x55d395(0x1fd)][_0x55d395(0x20a)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3041ab=[...new Set(_0xa22f52[_0x55d395(0x1d5)](_0x3dab3c=>_0x3dab3c[_0x55d395(0x1f0)])[_0x55d395(0x212)](Boolean))];for(const _0x23e0fe of _0x3041ab){_0x23e0fe&&await telegramBotService_1['telegramBotService'][_0x55d395(0x1f2)](_0x23e0fe,_0x185382,{'parse_mode':_0x55d395(0x1d4)});}}_0x53f372[_0x55d395(0x204)]({'success':!![],'message':_0x55d395(0x1f9)});}catch(_0x230899){_0x3059fb(_0x230899);}},this['disconnectUser']=async(_0x3f069b,_0x28040c,_0x1885eb)=>{const _0x5bb9a9=_0x340b96;try{const {telegramId:_0x5e564c}=_0x3f069b[_0x5bb9a9(0x211)],_0x34fbf7=await database_1['default'][_0x5bb9a9(0x1fd)]['findUnique']({'where':{'telegramId':_0x5e564c},'include':{'shop':!![]}});if(!_0x34fbf7)return _0x28040c[_0x5bb9a9(0x1cf)](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x5bb9a9(0x1fd)][_0x5bb9a9(0x1ff)]({'where':{'telegramId':_0x5e564c},'data':{'shopId':null,'isVerified':![]}}),_0x28040c[_0x5bb9a9(0x204)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x4b207a){_0x1885eb(_0x4b207a);}},this[_0x340b96(0x1e3)]=async(_0x2eb0ef,_0x40e3ec,_0xcb06e8)=>{const _0x8506ec=_0x340b96;try{const {shopId:_0x47deb7,type:type=_0x8506ec(0x1ee),testData:_0x1a52f7}=_0x2eb0ef[_0x8506ec(0x1e1)];if(!_0x47deb7)return _0x40e3ec[_0x8506ec(0x1cf)](0x190)[_0x8506ec(0x204)]({'success':![],'message':_0x8506ec(0x210)});const _0x1c0e94=await database_1['default'][_0x8506ec(0x1f1)][_0x8506ec(0x1da)]({'where':{'id':_0x47deb7},'select':{'id':!![],'name':!![]}});if(!_0x1c0e94)return _0x40e3ec[_0x8506ec(0x1cf)](0x194)[_0x8506ec(0x204)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x8506ec(0x1ee):const _0x2c5941={'id':_0x8506ec(0x1fc),'amount':_0x1a52f7?.[_0x8506ec(0x1ed)]||0x64,'currency':_0x1a52f7?.['currency']||'USD','productName':_0x1a52f7?.[_0x8506ec(0x20b)]||_0x8506ec(0x1d1),'gateway':_0x1a52f7?.[_0x8506ec(0x1d2)]||_0x8506ec(0x206),'createdAt':new Date(),..._0x1a52f7};await telegramBotService_1[_0x8506ec(0x202)]['sendPaymentNotification'](_0x47deb7,_0x2c5941,_0x8506ec(0x201));break;case _0x8506ec(0x20c):const _0x527d2d={'id':_0x8506ec(0x200),'amount':_0x1a52f7?.[_0x8506ec(0x1ed)]||0x1f4,'method':_0x1a52f7?.[_0x8506ec(0x20d)]||'bank_transfer','createdAt':new Date(),..._0x1a52f7};await telegramBotService_1[_0x8506ec(0x202)]['sendPayoutNotification'](_0x47deb7,_0x527d2d,_0x8506ec(0x1e2));break;case'custom':await telegramBotService_1['telegramBotService']['sendCustomNotification'](_0x47deb7,_0x1a52f7?.[_0x8506ec(0x1eb)]||'Test\x20Notification',_0x1a52f7?.[_0x8506ec(0x208)]||{'message':_0x8506ec(0x1ec)});break;default:return _0x40e3ec['status'](0x190)[_0x8506ec(0x204)]({'success':![],'message':_0x8506ec(0x1ea)});}_0x40e3ec[_0x8506ec(0x204)]({'success':!![],'message':_0x8506ec(0x1d3)+type+_0x8506ec(0x1e6)});}catch(_0x40f1e6){_0xcb06e8(_0x40f1e6);}};}}exports['TelegramController']=TelegramController;