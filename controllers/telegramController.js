'use strict';function a12_0x2a4b(){const _0xddd073=['status','shop','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','query','sendPaymentNotification','updatedAt','body','Test\x20','3703CmrXnI','../config/database','json','isActive','Broadcast\x20message\x20sent\x20successfully','completed','sendCustomNotification','test_payout_123','amount','Test\x20Product','Markdown','map','2154mfnMIt','274586ENsYgt','findUnique','details','6iXKmQC','disconnectUser','__esModule','80588AkLEnf','payment','username','telegramId','sendBroadcast','602965sCVENn','currency','bank_transfer','1100208jHrMLW','firstName','User\x20disconnected\x20successfully','TelegramController','paid','true','custom','isVerified','gateway','productName','Shop\x20ID\x20is\x20required','filter','18fkpCKR','getBotStatus','40008iqyibw','all','getBotInfo','telegramBotService','shopId','lastName','This\x20is\x20a\x20test\x20notification','count','__importDefault','telegramUser','ceil','createdAt','findMany','1601390mcJvIX','length','sendShopNotification','../services/telegramBotService','default'];a12_0x2a4b=function(){return _0xddd073;};return a12_0x2a4b();}function a12_0x4a1a(_0x26760c,_0x1842bb){const _0x2a4b47=a12_0x2a4b();return a12_0x4a1a=function(_0x4a1a34,_0x508008){_0x4a1a34=_0x4a1a34-0x18b;let _0x25d6e6=_0x2a4b47[_0x4a1a34];return _0x25d6e6;},a12_0x4a1a(_0x26760c,_0x1842bb);}const a12_0x3de7c5=a12_0x4a1a;(function(_0x76a59,_0x3215a9){const _0x561b97=a12_0x4a1a,_0x240b5e=_0x76a59();while(!![]){try{const _0x34af41=-parseInt(_0x561b97(0x193))/0x1+parseInt(_0x561b97(0x18d))/0x2+-parseInt(_0x561b97(0x190))/0x3*(parseInt(_0x561b97(0x1a9))/0x4)+parseInt(_0x561b97(0x198))/0x5+-parseInt(_0x561b97(0x18c))/0x6*(-parseInt(_0x561b97(0x1c3))/0x7)+parseInt(_0x561b97(0x19b))/0x8+-parseInt(_0x561b97(0x1a7))/0x9*(parseInt(_0x561b97(0x1b6))/0xa);if(_0x34af41===_0x3215a9)break;else _0x240b5e['push'](_0x240b5e['shift']());}catch(_0x1ada7a){_0x240b5e['push'](_0x240b5e['shift']());}}}(a12_0x2a4b,0x28265));var __importDefault=this&&this[a12_0x3de7c5(0x1b1)]||function(_0xf76b50){return _0xf76b50&&_0xf76b50['__esModule']?_0xf76b50:{'default':_0xf76b50};};Object['defineProperty'](exports,a12_0x3de7c5(0x192),{'value':!![]}),exports[a12_0x3de7c5(0x19e)]=void 0x0;const telegramBotService_1=require(a12_0x3de7c5(0x1b9)),database_1=__importDefault(require(a12_0x3de7c5(0x1c4)));class TelegramController{constructor(){const _0x52e151=a12_0x3de7c5;this[_0x52e151(0x1a8)]=async(_0x1fa23e,_0x162038,_0x4d5c14)=>{const _0x44246f=_0x52e151;try{const _0x15a624=telegramBotService_1[_0x44246f(0x1ac)][_0x44246f(0x1ab)](),_0x18ddd7=await database_1[_0x44246f(0x1ba)][_0x44246f(0x1b2)]['count'](),_0x2ef128=await database_1['default'][_0x44246f(0x1b2)][_0x44246f(0x1b0)]({'where':{'isVerified':!![]}}),_0x173da7=await database_1['default']['telegramUser']['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x162038['json']({'success':!![],'result':{'bot':{'isActive':_0x15a624[_0x44246f(0x1c6)],'username':_0x15a624[_0x44246f(0x195)]},'statistics':{'totalUsers':_0x18ddd7,'verifiedUsers':_0x2ef128,'unverifiedUsers':_0x18ddd7-_0x2ef128,'connectedShops':_0x173da7[_0x44246f(0x1b7)]}}});}catch(_0x1c8465){_0x4d5c14(_0x1c8465);}},this['getTelegramUsers']=async(_0xa60f98,_0x2a280d,_0x174c26)=>{const _0x4bb343=_0x52e151;try{const {page:page=0x1,limit:limit=0x14,verified:_0xc361e3}=_0xa60f98[_0x4bb343(0x1be)],_0x4958e9=(Number(page)-0x1)*Number(limit),_0x9ddb34={};_0xc361e3!==undefined&&(_0x9ddb34[_0x4bb343(0x1a2)]=_0xc361e3===_0x4bb343(0x1a0));const [_0x4418c6,_0x2d4392]=await Promise[_0x4bb343(0x1aa)]([database_1[_0x4bb343(0x1ba)]['telegramUser'][_0x4bb343(0x1b5)]({'where':_0x9ddb34,'skip':_0x4958e9,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4bb343(0x1ba)][_0x4bb343(0x1b2)][_0x4bb343(0x1b0)]({'where':_0x9ddb34})]);_0x2a280d['json']({'success':!![],'users':_0x4418c6[_0x4bb343(0x18b)](_0x338c5a=>({'id':_0x338c5a['id'],'telegramId':_0x338c5a[_0x4bb343(0x196)],'username':_0x338c5a[_0x4bb343(0x195)],'firstName':_0x338c5a[_0x4bb343(0x19c)],'lastName':_0x338c5a[_0x4bb343(0x1ae)],'isVerified':_0x338c5a[_0x4bb343(0x1a2)],'shop':_0x338c5a[_0x4bb343(0x1bc)],'createdAt':_0x338c5a[_0x4bb343(0x1b4)],'updatedAt':_0x338c5a[_0x4bb343(0x1c0)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2d4392,'totalPages':Math[_0x4bb343(0x1b3)](_0x2d4392/Number(limit))}});}catch(_0x1c3d31){_0x174c26(_0x1c3d31);}},this[_0x52e151(0x197)]=async(_0x499630,_0x2fa987,_0x523982)=>{const _0x5af86f=_0x52e151;try{const {message:_0x20b77c,shopId:_0x3ce2d9}=_0x499630[_0x5af86f(0x1c1)];if(!_0x20b77c)return _0x2fa987['status'](0x190)[_0x5af86f(0x1c5)]({'success':![],'message':'Message\x20is\x20required'});if(_0x3ce2d9)await telegramBotService_1['telegramBotService'][_0x5af86f(0x1b8)](_0x3ce2d9,_0x20b77c,{'parse_mode':_0x5af86f(0x1cd)});else{const _0x1ad6eb=await database_1[_0x5af86f(0x1ba)][_0x5af86f(0x1b2)][_0x5af86f(0x1b5)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1a9927=[...new Set(_0x1ad6eb[_0x5af86f(0x18b)](_0x48af12=>_0x48af12[_0x5af86f(0x1ad)])[_0x5af86f(0x1a6)](Boolean))];for(const _0x148af1 of _0x1a9927){_0x148af1&&await telegramBotService_1[_0x5af86f(0x1ac)][_0x5af86f(0x1b8)](_0x148af1,_0x20b77c,{'parse_mode':_0x5af86f(0x1cd)});}}_0x2fa987[_0x5af86f(0x1c5)]({'success':!![],'message':_0x5af86f(0x1c7)});}catch(_0x49e66c){_0x523982(_0x49e66c);}},this[_0x52e151(0x191)]=async(_0x51b99f,_0x4ea0ad,_0x4a9118)=>{const _0x240739=_0x52e151;try{const {telegramId:_0xe846ea}=_0x51b99f['params'],_0x38b519=await database_1['default'][_0x240739(0x1b2)][_0x240739(0x18e)]({'where':{'telegramId':_0xe846ea},'include':{'shop':!![]}});if(!_0x38b519)return _0x4ea0ad[_0x240739(0x1bb)](0x194)[_0x240739(0x1c5)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x240739(0x1ba)]['telegramUser']['update']({'where':{'telegramId':_0xe846ea},'data':{'shopId':null,'isVerified':![]}}),_0x4ea0ad[_0x240739(0x1c5)]({'success':!![],'message':_0x240739(0x19d)});}catch(_0xf995d9){_0x4a9118(_0xf995d9);}},this['sendTestNotification']=async(_0x70a028,_0x35e42e,_0x811de2)=>{const _0x5c9a4c=_0x52e151;try{const {shopId:_0x222263,type:type='payment',testData:_0x1543dd}=_0x70a028[_0x5c9a4c(0x1c1)];if(!_0x222263)return _0x35e42e[_0x5c9a4c(0x1bb)](0x190)[_0x5c9a4c(0x1c5)]({'success':![],'message':_0x5c9a4c(0x1a5)});const _0x902542=await database_1[_0x5c9a4c(0x1ba)][_0x5c9a4c(0x1bc)][_0x5c9a4c(0x18e)]({'where':{'id':_0x222263},'select':{'id':!![],'name':!![]}});if(!_0x902542)return _0x35e42e[_0x5c9a4c(0x1bb)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x5c9a4c(0x194):const _0x48d6d3={'id':'test_payment_123','amount':_0x1543dd?.[_0x5c9a4c(0x1cb)]||0x64,'currency':_0x1543dd?.[_0x5c9a4c(0x199)]||'USD','productName':_0x1543dd?.[_0x5c9a4c(0x1a4)]||_0x5c9a4c(0x1cc),'gateway':_0x1543dd?.[_0x5c9a4c(0x1a3)]||'plisio','createdAt':new Date(),..._0x1543dd};await telegramBotService_1[_0x5c9a4c(0x1ac)][_0x5c9a4c(0x1bf)](_0x222263,_0x48d6d3,_0x5c9a4c(0x19f));break;case'payout':const _0x56b975={'id':_0x5c9a4c(0x1ca),'amount':_0x1543dd?.[_0x5c9a4c(0x1cb)]||0x1f4,'method':_0x1543dd?.['method']||_0x5c9a4c(0x19a),'createdAt':new Date(),..._0x1543dd};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x222263,_0x56b975,_0x5c9a4c(0x1c8));break;case _0x5c9a4c(0x1a1):await telegramBotService_1[_0x5c9a4c(0x1ac)][_0x5c9a4c(0x1c9)](_0x222263,_0x1543dd?.['title']||'Test\x20Notification',_0x1543dd?.[_0x5c9a4c(0x18f)]||{'message':_0x5c9a4c(0x1af)});break;default:return _0x35e42e['status'](0x190)[_0x5c9a4c(0x1c5)]({'success':![],'message':_0x5c9a4c(0x1bd)});}_0x35e42e[_0x5c9a4c(0x1c5)]({'success':!![],'message':_0x5c9a4c(0x1c2)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x3f61ad){_0x811de2(_0x3f61ad);}};}}exports['TelegramController']=TelegramController;