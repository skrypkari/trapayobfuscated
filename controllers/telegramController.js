'use strict';const a12_0x4853c1=a12_0x38ba;(function(_0x41be8a,_0x377b4a){const _0x448912=a12_0x38ba,_0x587aca=_0x41be8a();while(!![]){try{const _0x3bd226=parseInt(_0x448912(0x226))/0x1+parseInt(_0x448912(0x228))/0x2*(-parseInt(_0x448912(0x1f4))/0x3)+-parseInt(_0x448912(0x224))/0x4*(-parseInt(_0x448912(0x22e))/0x5)+parseInt(_0x448912(0x1ff))/0x6*(parseInt(_0x448912(0x208))/0x7)+-parseInt(_0x448912(0x231))/0x8*(-parseInt(_0x448912(0x1f9))/0x9)+-parseInt(_0x448912(0x1fc))/0xa*(parseInt(_0x448912(0x1f6))/0xb)+parseInt(_0x448912(0x1f8))/0xc;if(_0x3bd226===_0x377b4a)break;else _0x587aca['push'](_0x587aca['shift']());}catch(_0x4928e3){_0x587aca['push'](_0x587aca['shift']());}}}(a12_0x11df,0x445f5));var __importDefault=this&&this['__importDefault']||function(_0x10811e){const _0xcdafbb=a12_0x38ba;return _0x10811e&&_0x10811e[_0xcdafbb(0x1fe)]?_0x10811e:{'default':_0x10811e};};Object[a12_0x4853c1(0x203)](exports,a12_0x4853c1(0x1fe),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x4853c1(0x23c)),database_1=__importDefault(require(a12_0x4853c1(0x1fa)));function a12_0x38ba(_0x6f6beb,_0x45ae78){const _0x11dfbd=a12_0x11df();return a12_0x38ba=function(_0x38ba07,_0x472d3a){_0x38ba07=_0x38ba07-0x1f3;let _0x2969a6=_0x11dfbd[_0x38ba07];return _0x2969a6;},a12_0x38ba(_0x6f6beb,_0x45ae78);}class TelegramController{constructor(){const _0xc717bf=a12_0x4853c1;this[_0xc717bf(0x218)]=async(_0x2d7848,_0x17353f,_0x4cb7b3)=>{const _0x45adb9=_0xc717bf;try{const _0x4b6844=telegramBotService_1[_0x45adb9(0x20b)][_0x45adb9(0x215)](),_0x22820c=await database_1[_0x45adb9(0x20a)]['telegramUser'][_0x45adb9(0x213)](),_0x1b781e=await database_1['default'][_0x45adb9(0x200)][_0x45adb9(0x213)]({'where':{'isVerified':!![]}}),_0x367461=await database_1[_0x45adb9(0x20a)]['telegramUser'][_0x45adb9(0x20c)]({'by':[_0x45adb9(0x223)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x17353f['json']({'success':!![],'result':{'bot':{'isActive':_0x4b6844[_0x45adb9(0x216)],'username':_0x4b6844[_0x45adb9(0x233)]},'statistics':{'totalUsers':_0x22820c,'verifiedUsers':_0x1b781e,'unverifiedUsers':_0x22820c-_0x1b781e,'connectedShops':_0x367461['length']}}});}catch(_0x2d960e){_0x4cb7b3(_0x2d960e);}},this[_0xc717bf(0x20f)]=async(_0x4cf7e6,_0x46bd86,_0x3e7fb5)=>{const _0x40a0d8=_0xc717bf;try{const {page:page=0x1,limit:limit=0x14,verified:_0x17d119}=_0x4cf7e6[_0x40a0d8(0x229)],_0x564b9e=(Number(page)-0x1)*Number(limit),_0x5eede0={};_0x17d119!==undefined&&(_0x5eede0[_0x40a0d8(0x22b)]=_0x17d119===_0x40a0d8(0x206));const [_0x5ba293,_0x288f44]=await Promise[_0x40a0d8(0x22f)]([database_1[_0x40a0d8(0x20a)][_0x40a0d8(0x200)][_0x40a0d8(0x1fb)]({'where':_0x5eede0,'skip':_0x564b9e,'take':Number(limit),'orderBy':{'createdAt':_0x40a0d8(0x214)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x40a0d8(0x20a)][_0x40a0d8(0x200)]['count']({'where':_0x5eede0})]);_0x46bd86[_0x40a0d8(0x202)]({'success':!![],'users':_0x5ba293[_0x40a0d8(0x210)](_0x182093=>({'id':_0x182093['id'],'telegramId':_0x182093[_0x40a0d8(0x20e)],'username':_0x182093[_0x40a0d8(0x233)],'firstName':_0x182093[_0x40a0d8(0x204)],'lastName':_0x182093[_0x40a0d8(0x201)],'isVerified':_0x182093['isVerified'],'shop':_0x182093[_0x40a0d8(0x230)],'createdAt':_0x182093['createdAt'],'updatedAt':_0x182093[_0x40a0d8(0x22c)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x288f44,'totalPages':Math['ceil'](_0x288f44/Number(limit))}});}catch(_0x519497){_0x3e7fb5(_0x519497);}},this[_0xc717bf(0x212)]=async(_0x11b38d,_0x417825,_0xcf6040)=>{const _0x3a8292=_0xc717bf;try{const {message:_0x10fb7b,shopId:_0x2f960c}=_0x11b38d[_0x3a8292(0x238)];if(!_0x10fb7b)return _0x417825[_0x3a8292(0x234)](0x190)[_0x3a8292(0x202)]({'success':![],'message':_0x3a8292(0x23b)});if(_0x2f960c)await telegramBotService_1[_0x3a8292(0x20b)][_0x3a8292(0x21d)](_0x2f960c,_0x10fb7b,{'parse_mode':_0x3a8292(0x1f3)});else{const _0x47a8f6=await database_1[_0x3a8292(0x20a)][_0x3a8292(0x200)][_0x3a8292(0x1fb)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5bd6e3=[...new Set(_0x47a8f6[_0x3a8292(0x210)](_0x2af87a=>_0x2af87a['shopId'])['filter'](Boolean))];for(const _0x5698f4 of _0x5bd6e3){_0x5698f4&&await telegramBotService_1[_0x3a8292(0x20b)][_0x3a8292(0x21d)](_0x5698f4,_0x10fb7b,{'parse_mode':_0x3a8292(0x1f3)});}}_0x417825['json']({'success':!![],'message':_0x3a8292(0x219)});}catch(_0x44e84f){_0xcf6040(_0x44e84f);}},this[_0xc717bf(0x235)]=async(_0x22e25a,_0x13ee49,_0x2ce49d)=>{const _0x3d3483=_0xc717bf;try{const {telegramId:_0x5c1987}=_0x22e25a[_0x3d3483(0x20d)],_0x46bf06=await database_1[_0x3d3483(0x20a)][_0x3d3483(0x200)][_0x3d3483(0x1f7)]({'where':{'telegramId':_0x5c1987},'include':{'shop':!![]}});if(!_0x46bf06)return _0x13ee49[_0x3d3483(0x234)](0x194)[_0x3d3483(0x202)]({'success':![],'message':_0x3d3483(0x237)});await database_1[_0x3d3483(0x20a)][_0x3d3483(0x200)][_0x3d3483(0x209)]({'where':{'telegramId':_0x5c1987},'data':{'shopId':null,'isVerified':![]}}),_0x13ee49[_0x3d3483(0x202)]({'success':!![],'message':_0x3d3483(0x217)});}catch(_0x1c75f1){_0x2ce49d(_0x1c75f1);}},this['sendTestNotification']=async(_0x1b1d43,_0x5b0943,_0x32b4d6)=>{const _0x17d370=_0xc717bf;try{const {shopId:_0x4d55aa,type:type=_0x17d370(0x21c),testData:_0x767db9}=_0x1b1d43['body'];if(!_0x4d55aa)return _0x5b0943[_0x17d370(0x234)](0x190)[_0x17d370(0x202)]({'success':![],'message':_0x17d370(0x225)});const _0x336e78=await database_1[_0x17d370(0x20a)][_0x17d370(0x230)][_0x17d370(0x1f7)]({'where':{'id':_0x4d55aa},'select':{'id':!![],'name':!![]}});if(!_0x336e78)return _0x5b0943['status'](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x17d370(0x21c):const _0x316dee={'id':_0x17d370(0x207),'amount':_0x767db9?.['amount']||0x64,'currency':_0x767db9?.['currency']||'USD','productName':_0x767db9?.[_0x17d370(0x22d)]||_0x17d370(0x21e),'gateway':_0x767db9?.[_0x17d370(0x211)]||_0x17d370(0x221),'createdAt':new Date(),..._0x767db9};await telegramBotService_1[_0x17d370(0x20b)][_0x17d370(0x1f5)](_0x4d55aa,_0x316dee,_0x17d370(0x21b));break;case _0x17d370(0x239):const _0x1803b4={'id':_0x17d370(0x227),'amount':_0x767db9?.['amount']||0x1f4,'method':_0x767db9?.[_0x17d370(0x21f)]||'bank_transfer','createdAt':new Date(),..._0x767db9};await telegramBotService_1[_0x17d370(0x20b)][_0x17d370(0x236)](_0x4d55aa,_0x1803b4,'completed');break;case'custom':await telegramBotService_1[_0x17d370(0x20b)][_0x17d370(0x22a)](_0x4d55aa,_0x767db9?.[_0x17d370(0x222)]||_0x17d370(0x232),_0x767db9?.[_0x17d370(0x23a)]||{'message':_0x17d370(0x21a)});break;default:return _0x5b0943[_0x17d370(0x234)](0x190)[_0x17d370(0x202)]({'success':![],'message':_0x17d370(0x205)});}_0x5b0943['json']({'success':!![],'message':_0x17d370(0x1fd)+type+_0x17d370(0x220)});}catch(_0xb9a895){_0x32b4d6(_0xb9a895);}};}}exports['TelegramController']=TelegramController;function a12_0x11df(){const _0x3f68c9=['567864zXkwQC','findUnique','505308cztpjp','37773SgVNuJ','../config/database','findMany','40rVTrhx','Test\x20','__esModule','114fJzDLi','telegramUser','lastName','json','defineProperty','firstName','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','true','test_payment_123','100128sSbJAy','update','default','telegramBotService','groupBy','params','telegramId','getTelegramUsers','map','gateway','sendBroadcast','count','desc','getBotInfo','isActive','User\x20disconnected\x20successfully','getBotStatus','Broadcast\x20message\x20sent\x20successfully','This\x20is\x20a\x20test\x20notification','paid','payment','sendShopNotification','Test\x20Product','method','\x20notification\x20sent\x20successfully','plisio','title','shopId','373004pfCMmd','Shop\x20ID\x20is\x20required','39228EIInnq','test_payout_123','148102HWlLVq','query','sendCustomNotification','isVerified','updatedAt','productName','10pNwSdr','all','shop','40cAQtOY','Test\x20Notification','username','status','disconnectUser','sendPayoutNotification','Telegram\x20user\x20not\x20found','body','payout','details','Message\x20is\x20required','../services/telegramBotService','Markdown','3iAbpIR','sendPaymentNotification'];a12_0x11df=function(){return _0x3f68c9;};return a12_0x11df();}