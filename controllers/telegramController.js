'use strict';function a12_0x34f3(){const _0x34c017=['getTelegramUsers','ceil','status','createdAt','9XQcuTB','Test\x20','all','default','3839730BobHOZ','16RYTTEd','Shop\x20not\x20found','map','disconnectUser','8547240LPhrJM','Markdown','isVerified','sendTestNotification','sendShopNotification','defineProperty','lastName','47468VwZvcj','body','amount','findUnique','details','params','custom','User\x20disconnected\x20successfully','\x20notification\x20sent\x20successfully','update','username','test_payment_123','method','paid','__importDefault','bank_transfer','payout','../services/telegramBotService','getBotStatus','This\x20is\x20a\x20test\x20notification','205009OtllZK','query','json','USD','Broadcast\x20message\x20sent\x20successfully','sendBroadcast','telegramBotService','Telegram\x20user\x20not\x20found','shop','../config/database','test_payout_123','__esModule','title','count','sendCustomNotification','shopId','completed','40515qcvFfs','findMany','filter','1672196YVesQa','gateway','productName','updatedAt','TelegramController','Test\x20Notification','payment','getBotInfo','currency','sendPaymentNotification','880983Gqobta','plisio','telegramUser','sendPayoutNotification'];a12_0x34f3=function(){return _0x34c017;};return a12_0x34f3();}const a12_0x26d98f=a12_0x5dca;function a12_0x5dca(_0x248307,_0x2ef0e2){const _0x34f39a=a12_0x34f3();return a12_0x5dca=function(_0x5dca25,_0xe7e644){_0x5dca25=_0x5dca25-0x1b4;let _0x1cc81f=_0x34f39a[_0x5dca25];return _0x1cc81f;},a12_0x5dca(_0x248307,_0x2ef0e2);}(function(_0xe4df4f,_0x388add){const _0x286734=a12_0x5dca,_0x1652d5=_0xe4df4f();while(!![]){try{const _0x44d3fe=-parseInt(_0x286734(0x1dd))/0x1*(-parseInt(_0x286734(0x1e8))/0x2)+-parseInt(_0x286734(0x1d0))/0x3+parseInt(_0x286734(0x1c6))/0x4+parseInt(_0x286734(0x1c3))/0x5+-parseInt(_0x286734(0x1dc))/0x6+-parseInt(_0x286734(0x1fc))/0x7+-parseInt(_0x286734(0x1e1))/0x8*(-parseInt(_0x286734(0x1d8))/0x9);if(_0x44d3fe===_0x388add)break;else _0x1652d5['push'](_0x1652d5['shift']());}catch(_0x3f882e){_0x1652d5['push'](_0x1652d5['shift']());}}}(a12_0x34f3,0xde826));var __importDefault=this&&this[a12_0x26d98f(0x1f6)]||function(_0x401761){const _0x5b504b=a12_0x26d98f;return _0x401761&&_0x401761[_0x5b504b(0x1bd)]?_0x401761:{'default':_0x401761};};Object[a12_0x26d98f(0x1e6)](exports,a12_0x26d98f(0x1bd),{'value':!![]}),exports[a12_0x26d98f(0x1ca)]=void 0x0;const telegramBotService_1=require(a12_0x26d98f(0x1f9)),database_1=__importDefault(require(a12_0x26d98f(0x1bb)));class TelegramController{constructor(){const _0x238a83=a12_0x26d98f;this[_0x238a83(0x1fa)]=async(_0x135b47,_0x5e5f66,_0x30aab4)=>{const _0x10007c=_0x238a83;try{const _0x36ef2d=telegramBotService_1['telegramBotService'][_0x10007c(0x1cd)](),_0x5e2595=await database_1[_0x10007c(0x1db)][_0x10007c(0x1d2)][_0x10007c(0x1bf)](),_0x435f7a=await database_1[_0x10007c(0x1db)][_0x10007c(0x1d2)][_0x10007c(0x1bf)]({'where':{'isVerified':!![]}}),_0x2954ba=await database_1[_0x10007c(0x1db)][_0x10007c(0x1d2)]['groupBy']({'by':[_0x10007c(0x1c1)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5e5f66[_0x10007c(0x1b4)]({'success':!![],'result':{'bot':{'isActive':_0x36ef2d['isActive'],'username':_0x36ef2d[_0x10007c(0x1f2)]},'statistics':{'totalUsers':_0x5e2595,'verifiedUsers':_0x435f7a,'unverifiedUsers':_0x5e2595-_0x435f7a,'connectedShops':_0x2954ba['length']}}});}catch(_0x13ffde){_0x30aab4(_0x13ffde);}},this[_0x238a83(0x1d4)]=async(_0x172ebb,_0x5d31e7,_0x4764d1)=>{const _0x4b43d9=_0x238a83;try{const {page:page=0x1,limit:limit=0x14,verified:_0x12b8e2}=_0x172ebb[_0x4b43d9(0x1fd)],_0x602d7d=(Number(page)-0x1)*Number(limit),_0x1bde70={};_0x12b8e2!==undefined&&(_0x1bde70[_0x4b43d9(0x1e3)]=_0x12b8e2==='true');const [_0x1385b2,_0x22eb54]=await Promise[_0x4b43d9(0x1da)]([database_1['default'][_0x4b43d9(0x1d2)][_0x4b43d9(0x1c4)]({'where':_0x1bde70,'skip':_0x602d7d,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4b43d9(0x1db)][_0x4b43d9(0x1d2)][_0x4b43d9(0x1bf)]({'where':_0x1bde70})]);_0x5d31e7[_0x4b43d9(0x1b4)]({'success':!![],'users':_0x1385b2[_0x4b43d9(0x1df)](_0xcd019e=>({'id':_0xcd019e['id'],'telegramId':_0xcd019e['telegramId'],'username':_0xcd019e['username'],'firstName':_0xcd019e['firstName'],'lastName':_0xcd019e[_0x4b43d9(0x1e7)],'isVerified':_0xcd019e[_0x4b43d9(0x1e3)],'shop':_0xcd019e[_0x4b43d9(0x1ba)],'createdAt':_0xcd019e[_0x4b43d9(0x1d7)],'updatedAt':_0xcd019e[_0x4b43d9(0x1c9)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x22eb54,'totalPages':Math[_0x4b43d9(0x1d5)](_0x22eb54/Number(limit))}});}catch(_0x288a4a){_0x4764d1(_0x288a4a);}},this[_0x238a83(0x1b7)]=async(_0x479101,_0x48c6c1,_0x144ba1)=>{const _0x32f798=_0x238a83;try{const {message:_0x11dff6,shopId:_0x1ed354}=_0x479101[_0x32f798(0x1e9)];if(!_0x11dff6)return _0x48c6c1['status'](0x190)[_0x32f798(0x1b4)]({'success':![],'message':'Message\x20is\x20required'});if(_0x1ed354)await telegramBotService_1[_0x32f798(0x1b8)]['sendShopNotification'](_0x1ed354,_0x11dff6,{'parse_mode':_0x32f798(0x1e2)});else{const _0x101d49=await database_1[_0x32f798(0x1db)][_0x32f798(0x1d2)][_0x32f798(0x1c4)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1ca494=[...new Set(_0x101d49[_0x32f798(0x1df)](_0x2ac51d=>_0x2ac51d[_0x32f798(0x1c1)])[_0x32f798(0x1c5)](Boolean))];for(const _0xae2101 of _0x1ca494){_0xae2101&&await telegramBotService_1['telegramBotService'][_0x32f798(0x1e5)](_0xae2101,_0x11dff6,{'parse_mode':_0x32f798(0x1e2)});}}_0x48c6c1[_0x32f798(0x1b4)]({'success':!![],'message':_0x32f798(0x1b6)});}catch(_0x1bdc61){_0x144ba1(_0x1bdc61);}},this[_0x238a83(0x1e0)]=async(_0x5559e1,_0x867c7d,_0xb068a6)=>{const _0x1737c5=_0x238a83;try{const {telegramId:_0x1ca4b5}=_0x5559e1[_0x1737c5(0x1ed)],_0xec0ad0=await database_1[_0x1737c5(0x1db)][_0x1737c5(0x1d2)][_0x1737c5(0x1eb)]({'where':{'telegramId':_0x1ca4b5},'include':{'shop':!![]}});if(!_0xec0ad0)return _0x867c7d['status'](0x194)[_0x1737c5(0x1b4)]({'success':![],'message':_0x1737c5(0x1b9)});await database_1['default'][_0x1737c5(0x1d2)][_0x1737c5(0x1f1)]({'where':{'telegramId':_0x1ca4b5},'data':{'shopId':null,'isVerified':![]}}),_0x867c7d[_0x1737c5(0x1b4)]({'success':!![],'message':_0x1737c5(0x1ef)});}catch(_0xa382e2){_0xb068a6(_0xa382e2);}},this[_0x238a83(0x1e4)]=async(_0x2e6ea4,_0x5a4526,_0x5d76ef)=>{const _0x428045=_0x238a83;try{const {shopId:_0x503f51,type:type='payment',testData:_0x5c2fd7}=_0x2e6ea4[_0x428045(0x1e9)];if(!_0x503f51)return _0x5a4526[_0x428045(0x1d6)](0x190)[_0x428045(0x1b4)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x5224d2=await database_1['default']['shop'][_0x428045(0x1eb)]({'where':{'id':_0x503f51},'select':{'id':!![],'name':!![]}});if(!_0x5224d2)return _0x5a4526[_0x428045(0x1d6)](0x194)[_0x428045(0x1b4)]({'success':![],'message':_0x428045(0x1de)});switch(type){case _0x428045(0x1cc):const _0x3b2483={'id':_0x428045(0x1f3),'amount':_0x5c2fd7?.['amount']||0x64,'currency':_0x5c2fd7?.[_0x428045(0x1ce)]||_0x428045(0x1b5),'productName':_0x5c2fd7?.[_0x428045(0x1c8)]||'Test\x20Product','gateway':_0x5c2fd7?.[_0x428045(0x1c7)]||_0x428045(0x1d1),'createdAt':new Date(),..._0x5c2fd7};await telegramBotService_1[_0x428045(0x1b8)][_0x428045(0x1cf)](_0x503f51,_0x3b2483,_0x428045(0x1f5));break;case _0x428045(0x1f8):const _0x28e9d1={'id':_0x428045(0x1bc),'amount':_0x5c2fd7?.[_0x428045(0x1ea)]||0x1f4,'method':_0x5c2fd7?.[_0x428045(0x1f4)]||_0x428045(0x1f7),'createdAt':new Date(),..._0x5c2fd7};await telegramBotService_1[_0x428045(0x1b8)][_0x428045(0x1d3)](_0x503f51,_0x28e9d1,_0x428045(0x1c2));break;case _0x428045(0x1ee):await telegramBotService_1[_0x428045(0x1b8)][_0x428045(0x1c0)](_0x503f51,_0x5c2fd7?.[_0x428045(0x1be)]||_0x428045(0x1cb),_0x5c2fd7?.[_0x428045(0x1ec)]||{'message':_0x428045(0x1fb)});break;default:return _0x5a4526['status'](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x5a4526[_0x428045(0x1b4)]({'success':!![],'message':_0x428045(0x1d9)+type+_0x428045(0x1f0)});}catch(_0x43d680){_0x5d76ef(_0x43d680);}};}}exports[a12_0x26d98f(0x1ca)]=TelegramController;