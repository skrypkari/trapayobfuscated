'use strict';const a12_0x249475=a12_0x4a09;(function(_0x5d10f9,_0x2a825d){const _0x70f24d=a12_0x4a09,_0x3ca9e1=_0x5d10f9();while(!![]){try{const _0x3e312f=parseInt(_0x70f24d(0x154))/0x1+-parseInt(_0x70f24d(0x174))/0x2+-parseInt(_0x70f24d(0x12f))/0x3+parseInt(_0x70f24d(0x16c))/0x4*(-parseInt(_0x70f24d(0x156))/0x5)+parseInt(_0x70f24d(0x179))/0x6*(parseInt(_0x70f24d(0x175))/0x7)+-parseInt(_0x70f24d(0x130))/0x8*(parseInt(_0x70f24d(0x164))/0x9)+parseInt(_0x70f24d(0x145))/0xa;if(_0x3e312f===_0x2a825d)break;else _0x3ca9e1['push'](_0x3ca9e1['shift']());}catch(_0x2eb552){_0x3ca9e1['push'](_0x3ca9e1['shift']());}}}(a12_0x45db,0x2514e));function a12_0x4a09(_0x376c07,_0x5f1662){const _0x45db52=a12_0x45db();return a12_0x4a09=function(_0x4a0913,_0x1535ca){_0x4a0913=_0x4a0913-0x12f;let _0x572b5b=_0x45db52[_0x4a0913];return _0x572b5b;},a12_0x4a09(_0x376c07,_0x5f1662);}var __importDefault=this&&this[a12_0x249475(0x14f)]||function(_0x121bb1){const _0x301db3=a12_0x249475;return _0x121bb1&&_0x121bb1[_0x301db3(0x13a)]?_0x121bb1:{'default':_0x121bb1};};Object['defineProperty'](exports,a12_0x249475(0x13a),{'value':!![]}),exports[a12_0x249475(0x158)]=void 0x0;const telegramBotService_1=require(a12_0x249475(0x142)),database_1=__importDefault(require(a12_0x249475(0x15d)));function a12_0x45db(){const _0x2f6f39=['json','default','227815lzcvMp','all','1220JwdmtV','getBotInfo','TelegramController','bank_transfer','status','completed','body','../config/database','sendPayoutNotification','title','Test\x20Notification','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','\x20notification\x20sent\x20successfully','findMany','32499EVDsAz','isActive','shop','sendBroadcast','filter','amount','getBotStatus','findUnique','4160cpQUac','Telegram\x20user\x20not\x20found','telegramUser','username','Shop\x20ID\x20is\x20required','groupBy','shopId','Message\x20is\x20required','347820xvgDDU','448qMLrYD','method','gateway','payment','8634PhmRWI','disconnectUser','297354eJYVWQ','392oizMZI','query','productName','telegramBotService','map','getTelegramUsers','telegramId','true','Shop\x20not\x20found','details','__esModule','test_payment_123','custom','This\x20is\x20a\x20test\x20notification','Test\x20Product','sendShopNotification','lastName','ceil','../services/telegramBotService','firstName','isVerified','5357020zLdCtG','count','sendCustomNotification','updatedAt','USD','payout','currency','sendTestNotification','test_payout_123','Broadcast\x20message\x20sent\x20successfully','__importDefault','Markdown','plisio'];a12_0x45db=function(){return _0x2f6f39;};return a12_0x45db();}class TelegramController{constructor(){const _0x2ea8e=a12_0x249475;this[_0x2ea8e(0x16a)]=async(_0x8696ee,_0xafd12d,_0x204a1d)=>{const _0x4c709b=_0x2ea8e;try{const _0x3e4d65=telegramBotService_1[_0x4c709b(0x133)][_0x4c709b(0x157)](),_0x43b25d=await database_1['default'][_0x4c709b(0x16e)][_0x4c709b(0x146)](),_0x1e3525=await database_1[_0x4c709b(0x153)][_0x4c709b(0x16e)][_0x4c709b(0x146)]({'where':{'isVerified':!![]}}),_0x56ec78=await database_1[_0x4c709b(0x153)]['telegramUser'][_0x4c709b(0x171)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xafd12d[_0x4c709b(0x152)]({'success':!![],'result':{'bot':{'isActive':_0x3e4d65[_0x4c709b(0x165)],'username':_0x3e4d65[_0x4c709b(0x16f)]},'statistics':{'totalUsers':_0x43b25d,'verifiedUsers':_0x1e3525,'unverifiedUsers':_0x43b25d-_0x1e3525,'connectedShops':_0x56ec78['length']}}});}catch(_0xdfbbd4){_0x204a1d(_0xdfbbd4);}},this[_0x2ea8e(0x135)]=async(_0x51c486,_0x1776fd,_0x49feaf)=>{const _0xa0c9d4=_0x2ea8e;try{const {page:page=0x1,limit:limit=0x14,verified:_0x72e6ab}=_0x51c486[_0xa0c9d4(0x131)],_0x1ecc71=(Number(page)-0x1)*Number(limit),_0x5b5742={};_0x72e6ab!==undefined&&(_0x5b5742['isVerified']=_0x72e6ab===_0xa0c9d4(0x137));const [_0x4c40c0,_0x157d63]=await Promise[_0xa0c9d4(0x155)]([database_1['default'][_0xa0c9d4(0x16e)]['findMany']({'where':_0x5b5742,'skip':_0x1ecc71,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['telegramUser'][_0xa0c9d4(0x146)]({'where':_0x5b5742})]);_0x1776fd[_0xa0c9d4(0x152)]({'success':!![],'users':_0x4c40c0[_0xa0c9d4(0x134)](_0x4b24fb=>({'id':_0x4b24fb['id'],'telegramId':_0x4b24fb[_0xa0c9d4(0x136)],'username':_0x4b24fb[_0xa0c9d4(0x16f)],'firstName':_0x4b24fb[_0xa0c9d4(0x143)],'lastName':_0x4b24fb[_0xa0c9d4(0x140)],'isVerified':_0x4b24fb[_0xa0c9d4(0x144)],'shop':_0x4b24fb[_0xa0c9d4(0x166)],'createdAt':_0x4b24fb['createdAt'],'updatedAt':_0x4b24fb[_0xa0c9d4(0x148)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x157d63,'totalPages':Math[_0xa0c9d4(0x141)](_0x157d63/Number(limit))}});}catch(_0x86cd3d){_0x49feaf(_0x86cd3d);}},this[_0x2ea8e(0x167)]=async(_0x315b59,_0x558573,_0x5393ff)=>{const _0x1dab01=_0x2ea8e;try{const {message:_0x1c25b9,shopId:_0x4bdfe4}=_0x315b59[_0x1dab01(0x15c)];if(!_0x1c25b9)return _0x558573['status'](0x190)[_0x1dab01(0x152)]({'success':![],'message':_0x1dab01(0x173)});if(_0x4bdfe4)await telegramBotService_1['telegramBotService'][_0x1dab01(0x13f)](_0x4bdfe4,_0x1c25b9,{'parse_mode':_0x1dab01(0x150)});else{const _0x3a3ab5=await database_1[_0x1dab01(0x153)][_0x1dab01(0x16e)][_0x1dab01(0x163)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4efc1b=[...new Set(_0x3a3ab5[_0x1dab01(0x134)](_0x302044=>_0x302044[_0x1dab01(0x172)])[_0x1dab01(0x168)](Boolean))];for(const _0x2d536f of _0x4efc1b){_0x2d536f&&await telegramBotService_1[_0x1dab01(0x133)][_0x1dab01(0x13f)](_0x2d536f,_0x1c25b9,{'parse_mode':_0x1dab01(0x150)});}}_0x558573[_0x1dab01(0x152)]({'success':!![],'message':_0x1dab01(0x14e)});}catch(_0x2a4405){_0x5393ff(_0x2a4405);}},this[_0x2ea8e(0x17a)]=async(_0x2a93da,_0x213368,_0x27a77e)=>{const _0x4fcb2a=_0x2ea8e;try{const {telegramId:_0xac4a19}=_0x2a93da['params'],_0x1a91cd=await database_1['default'][_0x4fcb2a(0x16e)][_0x4fcb2a(0x16b)]({'where':{'telegramId':_0xac4a19},'include':{'shop':!![]}});if(!_0x1a91cd)return _0x213368['status'](0x194)[_0x4fcb2a(0x152)]({'success':![],'message':_0x4fcb2a(0x16d)});await database_1['default'][_0x4fcb2a(0x16e)]['update']({'where':{'telegramId':_0xac4a19},'data':{'shopId':null,'isVerified':![]}}),_0x213368[_0x4fcb2a(0x152)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x507a19){_0x27a77e(_0x507a19);}},this[_0x2ea8e(0x14c)]=async(_0x3ae49d,_0x55246e,_0x505d5d)=>{const _0x281c61=_0x2ea8e;try{const {shopId:_0x20648e,type:type=_0x281c61(0x178),testData:_0x2f4005}=_0x3ae49d['body'];if(!_0x20648e)return _0x55246e[_0x281c61(0x15a)](0x190)[_0x281c61(0x152)]({'success':![],'message':_0x281c61(0x170)});const _0x576e60=await database_1[_0x281c61(0x153)][_0x281c61(0x166)]['findUnique']({'where':{'id':_0x20648e},'select':{'id':!![],'name':!![]}});if(!_0x576e60)return _0x55246e['status'](0x194)[_0x281c61(0x152)]({'success':![],'message':_0x281c61(0x138)});switch(type){case _0x281c61(0x178):const _0xd4c124={'id':_0x281c61(0x13b),'amount':_0x2f4005?.[_0x281c61(0x169)]||0x64,'currency':_0x2f4005?.[_0x281c61(0x14b)]||_0x281c61(0x149),'productName':_0x2f4005?.[_0x281c61(0x132)]||_0x281c61(0x13e),'gateway':_0x2f4005?.[_0x281c61(0x177)]||_0x281c61(0x151),'createdAt':new Date(),..._0x2f4005};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x20648e,_0xd4c124,'paid');break;case _0x281c61(0x14a):const _0x23a088={'id':_0x281c61(0x14d),'amount':_0x2f4005?.[_0x281c61(0x169)]||0x1f4,'method':_0x2f4005?.[_0x281c61(0x176)]||_0x281c61(0x159),'createdAt':new Date(),..._0x2f4005};await telegramBotService_1[_0x281c61(0x133)][_0x281c61(0x15e)](_0x20648e,_0x23a088,_0x281c61(0x15b));break;case _0x281c61(0x13c):await telegramBotService_1[_0x281c61(0x133)][_0x281c61(0x147)](_0x20648e,_0x2f4005?.[_0x281c61(0x15f)]||_0x281c61(0x160),_0x2f4005?.[_0x281c61(0x139)]||{'message':_0x281c61(0x13d)});break;default:return _0x55246e[_0x281c61(0x15a)](0x190)[_0x281c61(0x152)]({'success':![],'message':_0x281c61(0x161)});}_0x55246e[_0x281c61(0x152)]({'success':!![],'message':'Test\x20'+type+_0x281c61(0x162)});}catch(_0x138ccc){_0x505d5d(_0x138ccc);}};}}exports['TelegramController']=TelegramController;