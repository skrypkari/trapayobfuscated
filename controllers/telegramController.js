'use strict';const a12_0x2c7afb=a12_0x1719;(function(_0x2d0f26,_0x303b80){const _0x47c417=a12_0x1719,_0x5f2c68=_0x2d0f26();while(!![]){try{const _0x3fdb0b=parseInt(_0x47c417(0x69))/0x1+parseInt(_0x47c417(0x8d))/0x2+parseInt(_0x47c417(0x6f))/0x3*(-parseInt(_0x47c417(0x9b))/0x4)+-parseInt(_0x47c417(0x7a))/0x5+-parseInt(_0x47c417(0x81))/0x6+-parseInt(_0x47c417(0x9e))/0x7+-parseInt(_0x47c417(0x65))/0x8*(-parseInt(_0x47c417(0x90))/0x9);if(_0x3fdb0b===_0x303b80)break;else _0x5f2c68['push'](_0x5f2c68['shift']());}catch(_0xc85903){_0x5f2c68['push'](_0x5f2c68['shift']());}}}(a12_0x4244,0x5fe3e));function a12_0x4244(){const _0x308a73=['amount','../config/database','3frXAaO','filter','getBotInfo','json','findMany','custom','sendPaymentNotification','all','getBotStatus','TelegramController','true','2878410NdUjXR','telegramId','test_payout_123','currency','defineProperty','username','query','4313976QmaZIL','groupBy','update','getTelegramUsers','completed','isVerified','__esModule','params','findUnique','sendPayoutNotification','title','test_payment_123','789344OVcPug','Test\x20Product','map','11571282gxNZrl','telegramBotService','createdAt','payment','body','productName','sendCustomNotification','sendTestNotification','isActive','status','count','755708HJSPWK','default','paid','3519712UPjskM','payout','Test\x20Notification','shop','Broadcast\x20message\x20sent\x20successfully','length','USD','telegramUser','desc','Message\x20is\x20required','8zHuTyW','\x20notification\x20sent\x20successfully','shopId','Markdown','698817LvcOXO','User\x20disconnected\x20successfully','sendShopNotification','details'];a12_0x4244=function(){return _0x308a73;};return a12_0x4244();}function a12_0x1719(_0x4597ca,_0x1d6c1e){const _0x4244b4=a12_0x4244();return a12_0x1719=function(_0x17196a,_0x5f4428){_0x17196a=_0x17196a-0x64;let _0x4fad76=_0x4244b4[_0x17196a];return _0x4fad76;},a12_0x1719(_0x4597ca,_0x1d6c1e);}var __importDefault=this&&this['__importDefault']||function(_0x222087){const _0x1e0833=a12_0x1719;return _0x222087&&_0x222087[_0x1e0833(0x87)]?_0x222087:{'default':_0x222087};};Object[a12_0x2c7afb(0x7e)](exports,a12_0x2c7afb(0x87),{'value':!![]}),exports[a12_0x2c7afb(0x78)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x2c7afb(0x6e)));class TelegramController{constructor(){const _0x244c5e=a12_0x2c7afb;this[_0x244c5e(0x77)]=async(_0x2b663a,_0x2b13b7,_0x14fb44)=>{const _0x51b1ab=_0x244c5e;try{const _0x42bc76=telegramBotService_1[_0x51b1ab(0x91)][_0x51b1ab(0x71)](),_0x211a4f=await database_1['default'][_0x51b1ab(0xa5)][_0x51b1ab(0x9a)](),_0x1c115e=await database_1[_0x51b1ab(0x9c)][_0x51b1ab(0xa5)][_0x51b1ab(0x9a)]({'where':{'isVerified':!![]}}),_0x6459bb=await database_1[_0x51b1ab(0x9c)][_0x51b1ab(0xa5)][_0x51b1ab(0x82)]({'by':[_0x51b1ab(0x67)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2b13b7[_0x51b1ab(0x72)]({'success':!![],'result':{'bot':{'isActive':_0x42bc76[_0x51b1ab(0x98)],'username':_0x42bc76[_0x51b1ab(0x7f)]},'statistics':{'totalUsers':_0x211a4f,'verifiedUsers':_0x1c115e,'unverifiedUsers':_0x211a4f-_0x1c115e,'connectedShops':_0x6459bb[_0x51b1ab(0xa3)]}}});}catch(_0xba366e){_0x14fb44(_0xba366e);}},this[_0x244c5e(0x84)]=async(_0x27b849,_0x3757bb,_0x44805e)=>{const _0x49eb31=_0x244c5e;try{const {page:page=0x1,limit:limit=0x14,verified:_0x45d8db}=_0x27b849[_0x49eb31(0x80)],_0x256690=(Number(page)-0x1)*Number(limit),_0x11cd49={};_0x45d8db!==undefined&&(_0x11cd49[_0x49eb31(0x86)]=_0x45d8db===_0x49eb31(0x79));const [_0x4a1ff7,_0x14858d]=await Promise[_0x49eb31(0x76)]([database_1['default'][_0x49eb31(0xa5)][_0x49eb31(0x73)]({'where':_0x11cd49,'skip':_0x256690,'take':Number(limit),'orderBy':{'createdAt':_0x49eb31(0xa6)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x49eb31(0xa5)][_0x49eb31(0x9a)]({'where':_0x11cd49})]);_0x3757bb[_0x49eb31(0x72)]({'success':!![],'users':_0x4a1ff7[_0x49eb31(0x8f)](_0x1481cf=>({'id':_0x1481cf['id'],'telegramId':_0x1481cf[_0x49eb31(0x7b)],'username':_0x1481cf[_0x49eb31(0x7f)],'firstName':_0x1481cf['firstName'],'lastName':_0x1481cf['lastName'],'isVerified':_0x1481cf['isVerified'],'shop':_0x1481cf[_0x49eb31(0xa1)],'createdAt':_0x1481cf[_0x49eb31(0x92)],'updatedAt':_0x1481cf['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x14858d,'totalPages':Math['ceil'](_0x14858d/Number(limit))}});}catch(_0x2819d3){_0x44805e(_0x2819d3);}},this['sendBroadcast']=async(_0x2f186f,_0x38323e,_0x232d87)=>{const _0x3490d7=_0x244c5e;try{const {message:_0x5d98c5,shopId:_0x28ca5a}=_0x2f186f[_0x3490d7(0x94)];if(!_0x5d98c5)return _0x38323e[_0x3490d7(0x99)](0x190)[_0x3490d7(0x72)]({'success':![],'message':_0x3490d7(0x64)});if(_0x28ca5a)await telegramBotService_1[_0x3490d7(0x91)][_0x3490d7(0x6b)](_0x28ca5a,_0x5d98c5,{'parse_mode':_0x3490d7(0x68)});else{const _0x436431=await database_1[_0x3490d7(0x9c)][_0x3490d7(0xa5)][_0x3490d7(0x73)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xfac50c=[...new Set(_0x436431[_0x3490d7(0x8f)](_0x55dd7a=>_0x55dd7a['shopId'])[_0x3490d7(0x70)](Boolean))];for(const _0x25f686 of _0xfac50c){_0x25f686&&await telegramBotService_1['telegramBotService'][_0x3490d7(0x6b)](_0x25f686,_0x5d98c5,{'parse_mode':_0x3490d7(0x68)});}}_0x38323e[_0x3490d7(0x72)]({'success':!![],'message':_0x3490d7(0xa2)});}catch(_0x1aecdb){_0x232d87(_0x1aecdb);}},this['disconnectUser']=async(_0x3f4355,_0x151fc,_0x55aaf3)=>{const _0x3047eb=_0x244c5e;try{const {telegramId:_0x5c99b5}=_0x3f4355[_0x3047eb(0x88)],_0x256e00=await database_1['default'][_0x3047eb(0xa5)]['findUnique']({'where':{'telegramId':_0x5c99b5},'include':{'shop':!![]}});if(!_0x256e00)return _0x151fc['status'](0x194)[_0x3047eb(0x72)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x3047eb(0xa5)][_0x3047eb(0x83)]({'where':{'telegramId':_0x5c99b5},'data':{'shopId':null,'isVerified':![]}}),_0x151fc[_0x3047eb(0x72)]({'success':!![],'message':_0x3047eb(0x6a)});}catch(_0x20105d){_0x55aaf3(_0x20105d);}},this[_0x244c5e(0x97)]=async(_0x3188ac,_0x34ea59,_0x363e64)=>{const _0x23f0c9=_0x244c5e;try{const {shopId:_0x2c9d9f,type:type=_0x23f0c9(0x93),testData:_0x29a5b0}=_0x3188ac[_0x23f0c9(0x94)];if(!_0x2c9d9f)return _0x34ea59['status'](0x190)['json']({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x2f0717=await database_1[_0x23f0c9(0x9c)]['shop'][_0x23f0c9(0x89)]({'where':{'id':_0x2c9d9f},'select':{'id':!![],'name':!![]}});if(!_0x2f0717)return _0x34ea59[_0x23f0c9(0x99)](0x194)[_0x23f0c9(0x72)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x23f0c9(0x93):const _0x4e4c3b={'id':_0x23f0c9(0x8c),'amount':_0x29a5b0?.[_0x23f0c9(0x6d)]||0x64,'currency':_0x29a5b0?.[_0x23f0c9(0x7d)]||_0x23f0c9(0xa4),'productName':_0x29a5b0?.[_0x23f0c9(0x95)]||_0x23f0c9(0x8e),'gateway':_0x29a5b0?.['gateway']||'plisio','createdAt':new Date(),..._0x29a5b0};await telegramBotService_1[_0x23f0c9(0x91)][_0x23f0c9(0x75)](_0x2c9d9f,_0x4e4c3b,_0x23f0c9(0x9d));break;case _0x23f0c9(0x9f):const _0x68762e={'id':_0x23f0c9(0x7c),'amount':_0x29a5b0?.[_0x23f0c9(0x6d)]||0x1f4,'method':_0x29a5b0?.['method']||'bank_transfer','createdAt':new Date(),..._0x29a5b0};await telegramBotService_1['telegramBotService'][_0x23f0c9(0x8a)](_0x2c9d9f,_0x68762e,_0x23f0c9(0x85));break;case _0x23f0c9(0x74):await telegramBotService_1['telegramBotService'][_0x23f0c9(0x96)](_0x2c9d9f,_0x29a5b0?.[_0x23f0c9(0x8b)]||_0x23f0c9(0xa0),_0x29a5b0?.[_0x23f0c9(0x6c)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x34ea59[_0x23f0c9(0x99)](0x190)[_0x23f0c9(0x72)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x34ea59[_0x23f0c9(0x72)]({'success':!![],'message':'Test\x20'+type+_0x23f0c9(0x66)});}catch(_0x32adc6){_0x363e64(_0x32adc6);}};}}exports[a12_0x2c7afb(0x78)]=TelegramController;