'use strict';const a12_0x3104a0=a12_0x37cb;(function(_0xd23b56,_0x3ca69a){const _0x291aac=a12_0x37cb,_0x248e32=_0xd23b56();while(!![]){try{const _0x39c4e5=parseInt(_0x291aac(0x11e))/0x1*(parseInt(_0x291aac(0x141))/0x2)+parseInt(_0x291aac(0x13b))/0x3+-parseInt(_0x291aac(0x136))/0x4*(-parseInt(_0x291aac(0x118))/0x5)+parseInt(_0x291aac(0x149))/0x6+-parseInt(_0x291aac(0x138))/0x7+parseInt(_0x291aac(0x158))/0x8*(parseInt(_0x291aac(0x127))/0x9)+-parseInt(_0x291aac(0x117))/0xa;if(_0x39c4e5===_0x3ca69a)break;else _0x248e32['push'](_0x248e32['shift']());}catch(_0xdef987){_0x248e32['push'](_0x248e32['shift']());}}}(a12_0x2dd0,0xb7deb));function a12_0x37cb(_0x179e1e,_0x5a9b05){const _0x2dd027=a12_0x2dd0();return a12_0x37cb=function(_0x37cb99,_0x4ba894){_0x37cb99=_0x37cb99-0x113;let _0x4bfe56=_0x2dd027[_0x37cb99];return _0x4bfe56;},a12_0x37cb(_0x179e1e,_0x5a9b05);}function a12_0x2dd0(){const _0x258390=['\x20notification\x20sent\x20successfully','__esModule','filter','title','getBotStatus','__importDefault','test_payment_123','telegramUser','2596940wBtJgK','35345rIQvLb','all','sendShopNotification','TelegramController','shopId','bank_transfer','123MzwJEW','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','currency','body','default','status','telegramId','gateway','length','2439NgoeNg','count','sendPaymentNotification','shop','isActive','Test\x20Product','Shop\x20ID\x20is\x20required','Message\x20is\x20required','USD','Test\x20Notification','payout','json','username','custom','details','428vfdtgI','amount','8589182UizmmT','telegramBotService','plisio','2182524kffbJz','This\x20is\x20a\x20test\x20notification','defineProperty','findUnique','sendPayoutNotification','query','1942JqpNWH','method','groupBy','User\x20disconnected\x20successfully','updatedAt','update','isVerified','true','3612660zcgxgM','paid','firstName','getTelegramUsers','Shop\x20not\x20found','sendCustomNotification','completed','disconnectUser','payment','test_payout_123','Broadcast\x20message\x20sent\x20successfully','Test\x20','Markdown','findMany','sendBroadcast','1016DbChkt','productName'];a12_0x2dd0=function(){return _0x258390;};return a12_0x2dd0();}var __importDefault=this&&this[a12_0x3104a0(0x114)]||function(_0x192163){return _0x192163&&_0x192163['__esModule']?_0x192163:{'default':_0x192163};};Object[a12_0x3104a0(0x13d)](exports,a12_0x3104a0(0x15b),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x37d25f=a12_0x3104a0;this[_0x37d25f(0x113)]=async(_0x11703b,_0x2fe7fc,_0x4b17db)=>{const _0x4890a3=_0x37d25f;try{const _0x807a7c=telegramBotService_1[_0x4890a3(0x139)]['getBotInfo'](),_0x104465=await database_1['default'][_0x4890a3(0x116)]['count'](),_0x5dcf2a=await database_1[_0x4890a3(0x122)][_0x4890a3(0x116)][_0x4890a3(0x128)]({'where':{'isVerified':!![]}}),_0x2ad577=await database_1['default'][_0x4890a3(0x116)][_0x4890a3(0x143)]({'by':[_0x4890a3(0x11c)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2fe7fc[_0x4890a3(0x132)]({'success':!![],'result':{'bot':{'isActive':_0x807a7c[_0x4890a3(0x12b)],'username':_0x807a7c[_0x4890a3(0x133)]},'statistics':{'totalUsers':_0x104465,'verifiedUsers':_0x5dcf2a,'unverifiedUsers':_0x104465-_0x5dcf2a,'connectedShops':_0x2ad577[_0x4890a3(0x126)]}}});}catch(_0x5e0769){_0x4b17db(_0x5e0769);}},this[_0x37d25f(0x14c)]=async(_0x1785b9,_0x469ad5,_0x4d20c3)=>{const _0x4c3c9b=_0x37d25f;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1e28d3}=_0x1785b9[_0x4c3c9b(0x140)],_0x2f52d8=(Number(page)-0x1)*Number(limit),_0x434cf0={};_0x1e28d3!==undefined&&(_0x434cf0[_0x4c3c9b(0x147)]=_0x1e28d3===_0x4c3c9b(0x148));const [_0x3504ec,_0x6d32cd]=await Promise[_0x4c3c9b(0x119)]([database_1[_0x4c3c9b(0x122)]['telegramUser'][_0x4c3c9b(0x156)]({'where':_0x434cf0,'skip':_0x2f52d8,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4c3c9b(0x122)][_0x4c3c9b(0x116)][_0x4c3c9b(0x128)]({'where':_0x434cf0})]);_0x469ad5['json']({'success':!![],'users':_0x3504ec['map'](_0x2e5eb4=>({'id':_0x2e5eb4['id'],'telegramId':_0x2e5eb4[_0x4c3c9b(0x124)],'username':_0x2e5eb4[_0x4c3c9b(0x133)],'firstName':_0x2e5eb4[_0x4c3c9b(0x14b)],'lastName':_0x2e5eb4['lastName'],'isVerified':_0x2e5eb4[_0x4c3c9b(0x147)],'shop':_0x2e5eb4[_0x4c3c9b(0x12a)],'createdAt':_0x2e5eb4['createdAt'],'updatedAt':_0x2e5eb4[_0x4c3c9b(0x145)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x6d32cd,'totalPages':Math['ceil'](_0x6d32cd/Number(limit))}});}catch(_0x158481){_0x4d20c3(_0x158481);}},this[_0x37d25f(0x157)]=async(_0x669ce,_0xda3390,_0x1257d5)=>{const _0x1665bc=_0x37d25f;try{const {message:_0x3e239a,shopId:_0xf17163}=_0x669ce[_0x1665bc(0x121)];if(!_0x3e239a)return _0xda3390['status'](0x190)[_0x1665bc(0x132)]({'success':![],'message':_0x1665bc(0x12e)});if(_0xf17163)await telegramBotService_1['telegramBotService'][_0x1665bc(0x11a)](_0xf17163,_0x3e239a,{'parse_mode':_0x1665bc(0x155)});else{const _0x5ded58=await database_1[_0x1665bc(0x122)][_0x1665bc(0x116)][_0x1665bc(0x156)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x169a5d=[...new Set(_0x5ded58['map'](_0x3169de=>_0x3169de[_0x1665bc(0x11c)])[_0x1665bc(0x15c)](Boolean))];for(const _0x4a39ae of _0x169a5d){_0x4a39ae&&await telegramBotService_1[_0x1665bc(0x139)][_0x1665bc(0x11a)](_0x4a39ae,_0x3e239a,{'parse_mode':'Markdown'});}}_0xda3390[_0x1665bc(0x132)]({'success':!![],'message':_0x1665bc(0x153)});}catch(_0x171ca1){_0x1257d5(_0x171ca1);}},this[_0x37d25f(0x150)]=async(_0x12eb3d,_0x50a6de,_0x3b03b4)=>{const _0xdee1b7=_0x37d25f;try{const {telegramId:_0x261fc8}=_0x12eb3d['params'],_0x541d9e=await database_1['default']['telegramUser'][_0xdee1b7(0x13e)]({'where':{'telegramId':_0x261fc8},'include':{'shop':!![]}});if(!_0x541d9e)return _0x50a6de['status'](0x194)[_0xdee1b7(0x132)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0xdee1b7(0x122)]['telegramUser'][_0xdee1b7(0x146)]({'where':{'telegramId':_0x261fc8},'data':{'shopId':null,'isVerified':![]}}),_0x50a6de['json']({'success':!![],'message':_0xdee1b7(0x144)});}catch(_0x320eaa){_0x3b03b4(_0x320eaa);}},this['sendTestNotification']=async(_0x313047,_0x352ce8,_0x3be31a)=>{const _0x541701=_0x37d25f;try{const {shopId:_0x4a86b6,type:type=_0x541701(0x151),testData:_0x25380d}=_0x313047['body'];if(!_0x4a86b6)return _0x352ce8[_0x541701(0x123)](0x190)[_0x541701(0x132)]({'success':![],'message':_0x541701(0x12d)});const _0x30e819=await database_1[_0x541701(0x122)][_0x541701(0x12a)][_0x541701(0x13e)]({'where':{'id':_0x4a86b6},'select':{'id':!![],'name':!![]}});if(!_0x30e819)return _0x352ce8[_0x541701(0x123)](0x194)[_0x541701(0x132)]({'success':![],'message':_0x541701(0x14d)});switch(type){case _0x541701(0x151):const _0x537385={'id':_0x541701(0x115),'amount':_0x25380d?.[_0x541701(0x137)]||0x64,'currency':_0x25380d?.[_0x541701(0x120)]||_0x541701(0x12f),'productName':_0x25380d?.[_0x541701(0x159)]||_0x541701(0x12c),'gateway':_0x25380d?.[_0x541701(0x125)]||_0x541701(0x13a),'createdAt':new Date(),..._0x25380d};await telegramBotService_1[_0x541701(0x139)][_0x541701(0x129)](_0x4a86b6,_0x537385,_0x541701(0x14a));break;case _0x541701(0x131):const _0x243c40={'id':_0x541701(0x152),'amount':_0x25380d?.[_0x541701(0x137)]||0x1f4,'method':_0x25380d?.[_0x541701(0x142)]||_0x541701(0x11d),'createdAt':new Date(),..._0x25380d};await telegramBotService_1[_0x541701(0x139)][_0x541701(0x13f)](_0x4a86b6,_0x243c40,_0x541701(0x14f));break;case _0x541701(0x134):await telegramBotService_1[_0x541701(0x139)][_0x541701(0x14e)](_0x4a86b6,_0x25380d?.[_0x541701(0x15d)]||_0x541701(0x130),_0x25380d?.[_0x541701(0x135)]||{'message':_0x541701(0x13c)});break;default:return _0x352ce8[_0x541701(0x123)](0x190)[_0x541701(0x132)]({'success':![],'message':_0x541701(0x11f)});}_0x352ce8['json']({'success':!![],'message':_0x541701(0x154)+type+_0x541701(0x15a)});}catch(_0x3847a5){_0x3be31a(_0x3847a5);}};}}exports[a12_0x3104a0(0x11b)]=TelegramController;