'use strict';const a12_0x27fd65=a12_0x588e;(function(_0x597678,_0x29328a){const _0x5ddb43=a12_0x588e,_0x59396a=_0x597678();while(!![]){try{const _0x4c0b3b=parseInt(_0x5ddb43(0x112))/0x1+parseInt(_0x5ddb43(0x107))/0x2+-parseInt(_0x5ddb43(0xd3))/0x3*(parseInt(_0x5ddb43(0xde))/0x4)+-parseInt(_0x5ddb43(0xf2))/0x5*(-parseInt(_0x5ddb43(0xe8))/0x6)+-parseInt(_0x5ddb43(0xe1))/0x7+-parseInt(_0x5ddb43(0xe2))/0x8*(parseInt(_0x5ddb43(0x10e))/0x9)+parseInt(_0x5ddb43(0x103))/0xa;if(_0x4c0b3b===_0x29328a)break;else _0x59396a['push'](_0x59396a['shift']());}catch(_0x58746e){_0x59396a['push'](_0x59396a['shift']());}}}(a12_0x3832,0x4b8be));var __importDefault=this&&this['__importDefault']||function(_0x1fdf31){const _0xf309c9=a12_0x588e;return _0x1fdf31&&_0x1fdf31[_0xf309c9(0x10b)]?_0x1fdf31:{'default':_0x1fdf31};};Object[a12_0x27fd65(0xeb)](exports,a12_0x27fd65(0x10b),{'value':!![]}),exports[a12_0x27fd65(0x10d)]=void 0x0;const telegramBotService_1=require(a12_0x27fd65(0xf1)),database_1=__importDefault(require(a12_0x27fd65(0x105)));function a12_0x588e(_0x22f47f,_0x2e214b){const _0x3832cc=a12_0x3832();return a12_0x588e=function(_0x588e78,_0x2ed6e9){_0x588e78=_0x588e78-0xc9;let _0x1a6ecb=_0x3832cc[_0x588e78];return _0x1a6ecb;},a12_0x588e(_0x22f47f,_0x2e214b);}class TelegramController{constructor(){const _0x11c5e8=a12_0x27fd65;this[_0x11c5e8(0xf4)]=async(_0x1af39e,_0x3fadc1,_0x4fedf5)=>{const _0x3caba8=_0x11c5e8;try{const _0x2a5802=telegramBotService_1[_0x3caba8(0xe7)][_0x3caba8(0x111)](),_0x22f964=await database_1[_0x3caba8(0xe3)][_0x3caba8(0x108)]['count'](),_0x298ca5=await database_1[_0x3caba8(0xe3)][_0x3caba8(0x108)][_0x3caba8(0xcc)]({'where':{'isVerified':!![]}}),_0x10a0ee=await database_1[_0x3caba8(0xe3)]['telegramUser'][_0x3caba8(0xda)]({'by':[_0x3caba8(0x102)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3fadc1['json']({'success':!![],'result':{'bot':{'isActive':_0x2a5802[_0x3caba8(0xfc)],'username':_0x2a5802[_0x3caba8(0xd2)]},'statistics':{'totalUsers':_0x22f964,'verifiedUsers':_0x298ca5,'unverifiedUsers':_0x22f964-_0x298ca5,'connectedShops':_0x10a0ee[_0x3caba8(0xd7)]}}});}catch(_0x343e0d){_0x4fedf5(_0x343e0d);}},this[_0x11c5e8(0xef)]=async(_0x2e7e0e,_0x34ca07,_0xa330b7)=>{const _0x1aecac=_0x11c5e8;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5aa42b}=_0x2e7e0e[_0x1aecac(0xdd)],_0x2c6483=(Number(page)-0x1)*Number(limit),_0x4bec75={};_0x5aa42b!==undefined&&(_0x4bec75[_0x1aecac(0x100)]=_0x5aa42b===_0x1aecac(0x10a));const [_0xb53578,_0x11249a]=await Promise[_0x1aecac(0xcb)]([database_1['default']['telegramUser'][_0x1aecac(0x104)]({'where':_0x4bec75,'skip':_0x2c6483,'take':Number(limit),'orderBy':{'createdAt':_0x1aecac(0xfd)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1aecac(0xe3)][_0x1aecac(0x108)][_0x1aecac(0xcc)]({'where':_0x4bec75})]);_0x34ca07[_0x1aecac(0xe5)]({'success':!![],'users':_0xb53578[_0x1aecac(0xdb)](_0x2dede3=>({'id':_0x2dede3['id'],'telegramId':_0x2dede3[_0x1aecac(0x101)],'username':_0x2dede3[_0x1aecac(0xd2)],'firstName':_0x2dede3[_0x1aecac(0xed)],'lastName':_0x2dede3[_0x1aecac(0xcd)],'isVerified':_0x2dede3[_0x1aecac(0x100)],'shop':_0x2dede3[_0x1aecac(0xec)],'createdAt':_0x2dede3['createdAt'],'updatedAt':_0x2dede3[_0x1aecac(0xf3)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x11249a,'totalPages':Math['ceil'](_0x11249a/Number(limit))}});}catch(_0x269ff5){_0xa330b7(_0x269ff5);}},this['sendBroadcast']=async(_0x5dc133,_0x1a9e00,_0x1825be)=>{const _0xb0efa3=_0x11c5e8;try{const {message:_0x533d86,shopId:_0xf1ddb6}=_0x5dc133[_0xb0efa3(0xe9)];if(!_0x533d86)return _0x1a9e00[_0xb0efa3(0xd5)](0x190)['json']({'success':![],'message':_0xb0efa3(0xea)});if(_0xf1ddb6)await telegramBotService_1[_0xb0efa3(0xe7)][_0xb0efa3(0xce)](_0xf1ddb6,_0x533d86,{'parse_mode':_0xb0efa3(0xd1)});else{const _0x545ec5=await database_1[_0xb0efa3(0xe3)][_0xb0efa3(0x108)][_0xb0efa3(0x104)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x367fcc=[...new Set(_0x545ec5[_0xb0efa3(0xdb)](_0x100148=>_0x100148['shopId'])[_0xb0efa3(0x10c)](Boolean))];for(const _0x4fc31e of _0x367fcc){_0x4fc31e&&await telegramBotService_1[_0xb0efa3(0xe7)][_0xb0efa3(0xce)](_0x4fc31e,_0x533d86,{'parse_mode':_0xb0efa3(0xd1)});}}_0x1a9e00[_0xb0efa3(0xe5)]({'success':!![],'message':_0xb0efa3(0xdf)});}catch(_0x2298d3){_0x1825be(_0x2298d3);}},this[_0x11c5e8(0xfb)]=async(_0x31c187,_0x5a4333,_0x5845f5)=>{const _0x46b797=_0x11c5e8;try{const {telegramId:_0x32aa3f}=_0x31c187[_0x46b797(0xf6)],_0x2ecded=await database_1[_0x46b797(0xe3)][_0x46b797(0x108)][_0x46b797(0xca)]({'where':{'telegramId':_0x32aa3f},'include':{'shop':!![]}});if(!_0x2ecded)return _0x5a4333[_0x46b797(0xd5)](0x194)[_0x46b797(0xe5)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x46b797(0xe3)][_0x46b797(0x108)]['update']({'where':{'telegramId':_0x32aa3f},'data':{'shopId':null,'isVerified':![]}}),_0x5a4333[_0x46b797(0xe5)]({'success':!![],'message':_0x46b797(0xff)});}catch(_0x464c3d){_0x5845f5(_0x464c3d);}},this['sendTestNotification']=async(_0x2a3184,_0xb47c96,_0x1dd8fb)=>{const _0x5c3d9d=_0x11c5e8;try{const {shopId:_0x5914f5,type:type='payment',testData:_0x4fb32f}=_0x2a3184[_0x5c3d9d(0xe9)];if(!_0x5914f5)return _0xb47c96['status'](0x190)['json']({'success':![],'message':_0x5c3d9d(0xd0)});const _0x8e3325=await database_1[_0x5c3d9d(0xe3)][_0x5c3d9d(0xec)][_0x5c3d9d(0xca)]({'where':{'id':_0x5914f5},'select':{'id':!![],'name':!![]}});if(!_0x8e3325)return _0xb47c96[_0x5c3d9d(0xd5)](0x194)['json']({'success':![],'message':_0x5c3d9d(0xcf)});switch(type){case _0x5c3d9d(0x106):const _0x487d97={'id':_0x5c3d9d(0xd6),'amount':_0x4fb32f?.['amount']||0x64,'currency':_0x4fb32f?.[_0x5c3d9d(0xfa)]||_0x5c3d9d(0xc9),'productName':_0x4fb32f?.[_0x5c3d9d(0xf8)]||_0x5c3d9d(0xf5),'gateway':_0x4fb32f?.[_0x5c3d9d(0xee)]||'plisio','createdAt':new Date(),..._0x4fb32f};await telegramBotService_1[_0x5c3d9d(0xe7)][_0x5c3d9d(0x109)](_0x5914f5,_0x487d97,_0x5c3d9d(0xd8));break;case'payout':const _0x3df60d={'id':_0x5c3d9d(0x110),'amount':_0x4fb32f?.[_0x5c3d9d(0xdc)]||0x1f4,'method':_0x4fb32f?.[_0x5c3d9d(0xf7)]||_0x5c3d9d(0xe6),'createdAt':new Date(),..._0x4fb32f};await telegramBotService_1[_0x5c3d9d(0xe7)][_0x5c3d9d(0xd4)](_0x5914f5,_0x3df60d,'completed');break;case'custom':await telegramBotService_1[_0x5c3d9d(0xe7)][_0x5c3d9d(0xe0)](_0x5914f5,_0x4fb32f?.[_0x5c3d9d(0xfe)]||_0x5c3d9d(0xf0),_0x4fb32f?.[_0x5c3d9d(0x10f)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0xb47c96[_0x5c3d9d(0xd5)](0x190)[_0x5c3d9d(0xe5)]({'success':![],'message':_0x5c3d9d(0xd9)});}_0xb47c96[_0x5c3d9d(0xe5)]({'success':!![],'message':_0x5c3d9d(0xf9)+type+_0x5c3d9d(0xe4)});}catch(_0x4faac2){_0x1dd8fb(_0x4faac2);}};}}function a12_0x3832(){const _0x3535c7=['794616kHcjUl','sendPayoutNotification','status','test_payment_123','length','paid','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','groupBy','map','amount','query','4dcMmNw','Broadcast\x20message\x20sent\x20successfully','sendCustomNotification','962759CoBDVV','136ffjyKh','default','\x20notification\x20sent\x20successfully','json','bank_transfer','telegramBotService','789900dTSEDF','body','Message\x20is\x20required','defineProperty','shop','firstName','gateway','getTelegramUsers','Test\x20Notification','../services/telegramBotService','5YJTaxy','updatedAt','getBotStatus','Test\x20Product','params','method','productName','Test\x20','currency','disconnectUser','isActive','desc','title','User\x20disconnected\x20successfully','isVerified','telegramId','shopId','3327180XWYsOY','findMany','../config/database','payment','763312TzMRGv','telegramUser','sendPaymentNotification','true','__esModule','filter','TelegramController','317187LJphFF','details','test_payout_123','getBotInfo','464954ATVRFJ','USD','findUnique','all','count','lastName','sendShopNotification','Shop\x20not\x20found','Shop\x20ID\x20is\x20required','Markdown','username'];a12_0x3832=function(){return _0x3535c7;};return a12_0x3832();}exports[a12_0x27fd65(0x10d)]=TelegramController;