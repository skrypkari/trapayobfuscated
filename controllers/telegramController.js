'use strict';const a12_0x18e02e=a12_0x8ff6;(function(_0xc86166,_0x3f0adc){const _0x35e212=a12_0x8ff6,_0x5f5ba0=_0xc86166();while(!![]){try{const _0x334964=-parseInt(_0x35e212(0x78))/0x1*(parseInt(_0x35e212(0x90))/0x2)+parseInt(_0x35e212(0x9f))/0x3*(-parseInt(_0x35e212(0x74))/0x4)+parseInt(_0x35e212(0x75))/0x5+parseInt(_0x35e212(0xbb))/0x6+parseInt(_0x35e212(0x91))/0x7+-parseInt(_0x35e212(0x72))/0x8*(parseInt(_0x35e212(0xa3))/0x9)+-parseInt(_0x35e212(0xb5))/0xa;if(_0x334964===_0x3f0adc)break;else _0x5f5ba0['push'](_0x5f5ba0['shift']());}catch(_0x59b5d){_0x5f5ba0['push'](_0x5f5ba0['shift']());}}}(a12_0x5d86,0x38d0b));var __importDefault=this&&this['__importDefault']||function(_0x420239){const _0x387d3f=a12_0x8ff6;return _0x420239&&_0x420239[_0x387d3f(0x99)]?_0x420239:{'default':_0x420239};};function a12_0x5d86(){const _0x30d92c=['Telegram\x20user\x20not\x20found','Test\x20Product','test_payout_123','669celHEp','telegramBotService','USD','sendShopNotification','4071375xDwavW','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','getBotInfo','Message\x20is\x20required','map','json','default','TelegramController','lastName','telegramId','desc','sendPaymentNotification','../services/telegramBotService','defineProperty','../config/database','Test\x20Notification','title','Shop\x20not\x20found','455140elFGkD','update','Markdown','custom','details','telegramUser','1829862zHYnrw','sendCustomNotification','8rJVPHU','gateway','3112PAkRfM','1735150nigpys','method','findUnique','1krmFmV','status','payment','currency','query','filter','isVerified','sendPayoutNotification','findMany','true','getBotStatus','Test\x20','sendBroadcast','payout','sendTestNotification','isActive','updatedAt','productName','paid','User\x20disconnected\x20successfully','ceil','username','groupBy','shopId','151332gvcFQR','2294299FcDNin','all','amount','count','length','This\x20is\x20a\x20test\x20notification','disconnectUser','body','__esModule','test_payment_123','Broadcast\x20message\x20sent\x20successfully'];a12_0x5d86=function(){return _0x30d92c;};return a12_0x5d86();}Object[a12_0x18e02e(0xb0)](exports,a12_0x18e02e(0x99),{'value':!![]}),exports[a12_0x18e02e(0xaa)]=void 0x0;function a12_0x8ff6(_0x27b2c0,_0x255fdf){const _0x5d86b7=a12_0x5d86();return a12_0x8ff6=function(_0x8ff644,_0x368fba){_0x8ff644=_0x8ff644-0x72;let _0x20e3e0=_0x5d86b7[_0x8ff644];return _0x20e3e0;},a12_0x8ff6(_0x27b2c0,_0x255fdf);}const telegramBotService_1=require(a12_0x18e02e(0xaf)),database_1=__importDefault(require(a12_0x18e02e(0xb1)));class TelegramController{constructor(){const _0x5ad0c6=a12_0x18e02e;this[_0x5ad0c6(0x82)]=async(_0x1c959,_0x318af8,_0x512db2)=>{const _0x377f92=_0x5ad0c6;try{const _0xf0c0c9=telegramBotService_1['telegramBotService'][_0x377f92(0xa5)](),_0x1c1f80=await database_1['default'][_0x377f92(0xba)][_0x377f92(0x94)](),_0x3d69dc=await database_1[_0x377f92(0xa9)][_0x377f92(0xba)][_0x377f92(0x94)]({'where':{'isVerified':!![]}}),_0x599374=await database_1[_0x377f92(0xa9)]['telegramUser'][_0x377f92(0x8e)]({'by':[_0x377f92(0x8f)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x318af8[_0x377f92(0xa8)]({'success':!![],'result':{'bot':{'isActive':_0xf0c0c9[_0x377f92(0x87)],'username':_0xf0c0c9[_0x377f92(0x8d)]},'statistics':{'totalUsers':_0x1c1f80,'verifiedUsers':_0x3d69dc,'unverifiedUsers':_0x1c1f80-_0x3d69dc,'connectedShops':_0x599374[_0x377f92(0x95)]}}});}catch(_0x18c1d6){_0x512db2(_0x18c1d6);}},this['getTelegramUsers']=async(_0x3a9c8b,_0x3e0e8c,_0x5cf489)=>{const _0x34a29e=_0x5ad0c6;try{const {page:page=0x1,limit:limit=0x14,verified:_0x7fd1a7}=_0x3a9c8b[_0x34a29e(0x7c)],_0x1844b0=(Number(page)-0x1)*Number(limit),_0x10c0d5={};_0x7fd1a7!==undefined&&(_0x10c0d5[_0x34a29e(0x7e)]=_0x7fd1a7===_0x34a29e(0x81));const [_0x2736a5,_0x1a59d4]=await Promise[_0x34a29e(0x92)]([database_1[_0x34a29e(0xa9)][_0x34a29e(0xba)][_0x34a29e(0x80)]({'where':_0x10c0d5,'skip':_0x1844b0,'take':Number(limit),'orderBy':{'createdAt':_0x34a29e(0xad)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x34a29e(0xa9)][_0x34a29e(0xba)][_0x34a29e(0x94)]({'where':_0x10c0d5})]);_0x3e0e8c[_0x34a29e(0xa8)]({'success':!![],'users':_0x2736a5['map'](_0x5ead87=>({'id':_0x5ead87['id'],'telegramId':_0x5ead87[_0x34a29e(0xac)],'username':_0x5ead87[_0x34a29e(0x8d)],'firstName':_0x5ead87['firstName'],'lastName':_0x5ead87[_0x34a29e(0xab)],'isVerified':_0x5ead87[_0x34a29e(0x7e)],'shop':_0x5ead87['shop'],'createdAt':_0x5ead87['createdAt'],'updatedAt':_0x5ead87[_0x34a29e(0x88)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1a59d4,'totalPages':Math[_0x34a29e(0x8c)](_0x1a59d4/Number(limit))}});}catch(_0x420bde){_0x5cf489(_0x420bde);}},this[_0x5ad0c6(0x84)]=async(_0x28ae51,_0x34f878,_0x107f37)=>{const _0x125cbb=_0x5ad0c6;try{const {message:_0x4c24fc,shopId:_0x2bc9f7}=_0x28ae51[_0x125cbb(0x98)];if(!_0x4c24fc)return _0x34f878[_0x125cbb(0x79)](0x190)[_0x125cbb(0xa8)]({'success':![],'message':_0x125cbb(0xa6)});if(_0x2bc9f7)await telegramBotService_1['telegramBotService'][_0x125cbb(0xa2)](_0x2bc9f7,_0x4c24fc,{'parse_mode':_0x125cbb(0xb7)});else{const _0x1764b8=await database_1['default'][_0x125cbb(0xba)][_0x125cbb(0x80)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2b03d0=[...new Set(_0x1764b8[_0x125cbb(0xa7)](_0x5e0189=>_0x5e0189[_0x125cbb(0x8f)])[_0x125cbb(0x7d)](Boolean))];for(const _0x2f3080 of _0x2b03d0){_0x2f3080&&await telegramBotService_1[_0x125cbb(0xa0)][_0x125cbb(0xa2)](_0x2f3080,_0x4c24fc,{'parse_mode':_0x125cbb(0xb7)});}}_0x34f878[_0x125cbb(0xa8)]({'success':!![],'message':_0x125cbb(0x9b)});}catch(_0xa237ec){_0x107f37(_0xa237ec);}},this[_0x5ad0c6(0x97)]=async(_0x4fd1d3,_0x2d6b55,_0x2787d2)=>{const _0x59a2a0=_0x5ad0c6;try{const {telegramId:_0x37f6c8}=_0x4fd1d3['params'],_0x2fd24a=await database_1[_0x59a2a0(0xa9)]['telegramUser'][_0x59a2a0(0x77)]({'where':{'telegramId':_0x37f6c8},'include':{'shop':!![]}});if(!_0x2fd24a)return _0x2d6b55['status'](0x194)[_0x59a2a0(0xa8)]({'success':![],'message':_0x59a2a0(0x9c)});await database_1[_0x59a2a0(0xa9)]['telegramUser'][_0x59a2a0(0xb6)]({'where':{'telegramId':_0x37f6c8},'data':{'shopId':null,'isVerified':![]}}),_0x2d6b55['json']({'success':!![],'message':_0x59a2a0(0x8b)});}catch(_0x126c57){_0x2787d2(_0x126c57);}},this[_0x5ad0c6(0x86)]=async(_0x1d8326,_0x4f94f2,_0x58576)=>{const _0x14eb53=_0x5ad0c6;try{const {shopId:_0xc6a1fd,type:type=_0x14eb53(0x7a),testData:_0x1cf3d5}=_0x1d8326['body'];if(!_0xc6a1fd)return _0x4f94f2[_0x14eb53(0x79)](0x190)['json']({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x56d96e=await database_1[_0x14eb53(0xa9)]['shop'][_0x14eb53(0x77)]({'where':{'id':_0xc6a1fd},'select':{'id':!![],'name':!![]}});if(!_0x56d96e)return _0x4f94f2[_0x14eb53(0x79)](0x194)[_0x14eb53(0xa8)]({'success':![],'message':_0x14eb53(0xb4)});switch(type){case _0x14eb53(0x7a):const _0x318384={'id':_0x14eb53(0x9a),'amount':_0x1cf3d5?.[_0x14eb53(0x93)]||0x64,'currency':_0x1cf3d5?.[_0x14eb53(0x7b)]||_0x14eb53(0xa1),'productName':_0x1cf3d5?.[_0x14eb53(0x89)]||_0x14eb53(0x9d),'gateway':_0x1cf3d5?.[_0x14eb53(0x73)]||'plisio','createdAt':new Date(),..._0x1cf3d5};await telegramBotService_1[_0x14eb53(0xa0)][_0x14eb53(0xae)](_0xc6a1fd,_0x318384,_0x14eb53(0x8a));break;case _0x14eb53(0x85):const _0x424735={'id':_0x14eb53(0x9e),'amount':_0x1cf3d5?.[_0x14eb53(0x93)]||0x1f4,'method':_0x1cf3d5?.[_0x14eb53(0x76)]||'bank_transfer','createdAt':new Date(),..._0x1cf3d5};await telegramBotService_1[_0x14eb53(0xa0)][_0x14eb53(0x7f)](_0xc6a1fd,_0x424735,'completed');break;case _0x14eb53(0xb8):await telegramBotService_1[_0x14eb53(0xa0)][_0x14eb53(0xbc)](_0xc6a1fd,_0x1cf3d5?.[_0x14eb53(0xb3)]||_0x14eb53(0xb2),_0x1cf3d5?.[_0x14eb53(0xb9)]||{'message':_0x14eb53(0x96)});break;default:return _0x4f94f2[_0x14eb53(0x79)](0x190)[_0x14eb53(0xa8)]({'success':![],'message':_0x14eb53(0xa4)});}_0x4f94f2[_0x14eb53(0xa8)]({'success':!![],'message':_0x14eb53(0x83)+type+'\x20notification\x20sent\x20successfully'});}catch(_0xc2290f){_0x58576(_0xc2290f);}};}}exports[a12_0x18e02e(0xaa)]=TelegramController;