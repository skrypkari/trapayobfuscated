'use strict';const a13_0x58df13=a13_0x5b17;(function(_0x398af7,_0x17ac44){const _0x369a99=a13_0x5b17,_0x226c58=_0x398af7();while(!![]){try{const _0x3a5f15=parseInt(_0x369a99(0xb7))/0x1+-parseInt(_0x369a99(0xbd))/0x2*(-parseInt(_0x369a99(0xa3))/0x3)+-parseInt(_0x369a99(0xa5))/0x4+-parseInt(_0x369a99(0x94))/0x5+-parseInt(_0x369a99(0xb3))/0x6*(-parseInt(_0x369a99(0xc9))/0x7)+parseInt(_0x369a99(0xcd))/0x8*(-parseInt(_0x369a99(0xc4))/0x9)+parseInt(_0x369a99(0xce))/0xa*(parseInt(_0x369a99(0x9d))/0xb);if(_0x3a5f15===_0x17ac44)break;else _0x226c58['push'](_0x226c58['shift']());}catch(_0xd1b96e){_0x226c58['push'](_0x226c58['shift']());}}}(a13_0x5955,0xdcb3a));function a13_0x5955(){const _0x5af8c4=['31077JxzTIw','amount','desc','payment','sendTestNotification','861UyAsCV','__esModule','defineProperty','getBotStatus','3712lzXpqR','10rYjwDn','telegramId','Message\x20is\x20required','groupBy','findUnique','findMany','ceil','details','telegramBotService','Telegram\x20user\x20not\x20found','sendPaymentNotification','map','8297885vnoryx','Test\x20','body','all','isVerified','firstName','currency','Broadcast\x20message\x20sent\x20successfully','sendShopNotification','18615839gRkHcA','bank_transfer','username','../config/database','TelegramController','\x20notification\x20sent\x20successfully','3DjJMSv','gateway','1345400RrobRB','disconnectUser','lastName','filter','Markdown','sendBroadcast','completed','json','Shop\x20ID\x20is\x20required','default','test_payment_123','payout','productName','USD','41502Cepzsm','shopId','count','shop','1171688mgAZth','length','telegramUser','This\x20is\x20a\x20test\x20notification','paid','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','1574570AeDBxE','isActive','status','getTelegramUsers','update','custom','query'];a13_0x5955=function(){return _0x5af8c4;};return a13_0x5955();}function a13_0x5b17(_0x251240,_0x27fdda){const _0x595507=a13_0x5955();return a13_0x5b17=function(_0x5b17a9,_0x327ea5){_0x5b17a9=_0x5b17a9-0x93;let _0x3ff3af=_0x595507[_0x5b17a9];return _0x3ff3af;},a13_0x5b17(_0x251240,_0x27fdda);}var __importDefault=this&&this['__importDefault']||function(_0x19c38b){const _0x5c71db=a13_0x5b17;return _0x19c38b&&_0x19c38b[_0x5c71db(0xca)]?_0x19c38b:{'default':_0x19c38b};};Object[a13_0x58df13(0xcb)](exports,a13_0x58df13(0xca),{'value':!![]}),exports[a13_0x58df13(0xa1)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a13_0x58df13(0xa0)));class TelegramController{constructor(){const _0x12a8fe=a13_0x58df13;this[_0x12a8fe(0xcc)]=async(_0x32b79d,_0x5d41ba,_0x10ab36)=>{const _0x1d9fdf=_0x12a8fe;try{const _0x50fb52=telegramBotService_1[_0x1d9fdf(0xd6)]['getBotInfo'](),_0x2904dc=await database_1[_0x1d9fdf(0xae)][_0x1d9fdf(0xb9)][_0x1d9fdf(0xb5)](),_0x2d4d74=await database_1[_0x1d9fdf(0xae)][_0x1d9fdf(0xb9)][_0x1d9fdf(0xb5)]({'where':{'isVerified':!![]}}),_0x585394=await database_1[_0x1d9fdf(0xae)][_0x1d9fdf(0xb9)][_0x1d9fdf(0xd1)]({'by':[_0x1d9fdf(0xb4)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5d41ba[_0x1d9fdf(0xac)]({'success':!![],'result':{'bot':{'isActive':_0x50fb52[_0x1d9fdf(0xbe)],'username':_0x50fb52[_0x1d9fdf(0x9f)]},'statistics':{'totalUsers':_0x2904dc,'verifiedUsers':_0x2d4d74,'unverifiedUsers':_0x2904dc-_0x2d4d74,'connectedShops':_0x585394[_0x1d9fdf(0xb8)]}}});}catch(_0x3ea408){_0x10ab36(_0x3ea408);}},this[_0x12a8fe(0xc0)]=async(_0xbf289e,_0x32ae5a,_0x18a0fb)=>{const _0x375113=_0x12a8fe;try{const {page:page=0x1,limit:limit=0x14,verified:_0x44debd}=_0xbf289e[_0x375113(0xc3)],_0x2e81e2=(Number(page)-0x1)*Number(limit),_0x2b8812={};_0x44debd!==undefined&&(_0x2b8812['isVerified']=_0x44debd==='true');const [_0x334e8c,_0x244ad0]=await Promise[_0x375113(0x97)]([database_1[_0x375113(0xae)][_0x375113(0xb9)][_0x375113(0xd3)]({'where':_0x2b8812,'skip':_0x2e81e2,'take':Number(limit),'orderBy':{'createdAt':_0x375113(0xc6)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x375113(0xae)][_0x375113(0xb9)][_0x375113(0xb5)]({'where':_0x2b8812})]);_0x32ae5a['json']({'success':!![],'users':_0x334e8c[_0x375113(0x93)](_0x52dc99=>({'id':_0x52dc99['id'],'telegramId':_0x52dc99[_0x375113(0xcf)],'username':_0x52dc99[_0x375113(0x9f)],'firstName':_0x52dc99[_0x375113(0x99)],'lastName':_0x52dc99[_0x375113(0xa7)],'isVerified':_0x52dc99[_0x375113(0x98)],'shop':_0x52dc99['shop'],'createdAt':_0x52dc99['createdAt'],'updatedAt':_0x52dc99['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x244ad0,'totalPages':Math[_0x375113(0xd4)](_0x244ad0/Number(limit))}});}catch(_0x4142f8){_0x18a0fb(_0x4142f8);}},this[_0x12a8fe(0xaa)]=async(_0x2b3a62,_0x1e397a,_0x1f1ca8)=>{const _0x3f29aa=_0x12a8fe;try{const {message:_0x4a538c,shopId:_0x694b2c}=_0x2b3a62[_0x3f29aa(0x96)];if(!_0x4a538c)return _0x1e397a[_0x3f29aa(0xbf)](0x190)[_0x3f29aa(0xac)]({'success':![],'message':_0x3f29aa(0xd0)});if(_0x694b2c)await telegramBotService_1[_0x3f29aa(0xd6)][_0x3f29aa(0x9c)](_0x694b2c,_0x4a538c,{'parse_mode':_0x3f29aa(0xa9)});else{const _0x82f755=await database_1[_0x3f29aa(0xae)][_0x3f29aa(0xb9)][_0x3f29aa(0xd3)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x169460=[...new Set(_0x82f755[_0x3f29aa(0x93)](_0xf59914=>_0xf59914[_0x3f29aa(0xb4)])[_0x3f29aa(0xa8)](Boolean))];for(const _0x3821ec of _0x169460){_0x3821ec&&await telegramBotService_1['telegramBotService'][_0x3f29aa(0x9c)](_0x3821ec,_0x4a538c,{'parse_mode':_0x3f29aa(0xa9)});}}_0x1e397a[_0x3f29aa(0xac)]({'success':!![],'message':_0x3f29aa(0x9b)});}catch(_0x1e9cd0){_0x1f1ca8(_0x1e9cd0);}},this[_0x12a8fe(0xa6)]=async(_0x31e943,_0x36c54f,_0xc6aa03)=>{const _0x14371c=_0x12a8fe;try{const {telegramId:_0x56657b}=_0x31e943['params'],_0x3412ec=await database_1[_0x14371c(0xae)][_0x14371c(0xb9)][_0x14371c(0xd2)]({'where':{'telegramId':_0x56657b},'include':{'shop':!![]}});if(!_0x3412ec)return _0x36c54f[_0x14371c(0xbf)](0x194)[_0x14371c(0xac)]({'success':![],'message':_0x14371c(0xd7)});await database_1[_0x14371c(0xae)]['telegramUser'][_0x14371c(0xc1)]({'where':{'telegramId':_0x56657b},'data':{'shopId':null,'isVerified':![]}}),_0x36c54f[_0x14371c(0xac)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x5c9461){_0xc6aa03(_0x5c9461);}},this[_0x12a8fe(0xc8)]=async(_0x25f0ed,_0x3b07ca,_0x2b6e81)=>{const _0x514a7e=_0x12a8fe;try{const {shopId:_0x342047,type:type=_0x514a7e(0xc7),testData:_0x3ff84b}=_0x25f0ed[_0x514a7e(0x96)];if(!_0x342047)return _0x3b07ca[_0x514a7e(0xbf)](0x190)['json']({'success':![],'message':_0x514a7e(0xad)});const _0x28e8a5=await database_1[_0x514a7e(0xae)][_0x514a7e(0xb6)][_0x514a7e(0xd2)]({'where':{'id':_0x342047},'select':{'id':!![],'name':!![]}});if(!_0x28e8a5)return _0x3b07ca[_0x514a7e(0xbf)](0x194)[_0x514a7e(0xac)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x514a7e(0xc7):const _0x5fdead={'id':_0x514a7e(0xaf),'amount':_0x3ff84b?.[_0x514a7e(0xc5)]||0x64,'currency':_0x3ff84b?.[_0x514a7e(0x9a)]||_0x514a7e(0xb2),'productName':_0x3ff84b?.[_0x514a7e(0xb1)]||'Test\x20Product','gateway':_0x3ff84b?.[_0x514a7e(0xa4)]||'plisio','createdAt':new Date(),..._0x3ff84b};await telegramBotService_1[_0x514a7e(0xd6)][_0x514a7e(0xd8)](_0x342047,_0x5fdead,_0x514a7e(0xbb));break;case _0x514a7e(0xb0):const _0x161f9f={'id':'test_payout_123','amount':_0x3ff84b?.[_0x514a7e(0xc5)]||0x1f4,'method':_0x3ff84b?.['method']||_0x514a7e(0x9e),'createdAt':new Date(),..._0x3ff84b};await telegramBotService_1[_0x514a7e(0xd6)]['sendPayoutNotification'](_0x342047,_0x161f9f,_0x514a7e(0xab));break;case _0x514a7e(0xc2):await telegramBotService_1[_0x514a7e(0xd6)]['sendCustomNotification'](_0x342047,_0x3ff84b?.['title']||'Test\x20Notification',_0x3ff84b?.[_0x514a7e(0xd5)]||{'message':_0x514a7e(0xba)});break;default:return _0x3b07ca[_0x514a7e(0xbf)](0x190)[_0x514a7e(0xac)]({'success':![],'message':_0x514a7e(0xbc)});}_0x3b07ca['json']({'success':!![],'message':_0x514a7e(0x95)+type+_0x514a7e(0xa2)});}catch(_0x348678){_0x2b6e81(_0x348678);}};}}exports[a13_0x58df13(0xa1)]=TelegramController;