'use strict';const a12_0x49a489=a12_0x30c5;(function(_0x4467a0,_0x50384a){const _0x43febc=a12_0x30c5,_0x3f4af5=_0x4467a0();while(!![]){try{const _0x2c4669=-parseInt(_0x43febc(0x1c8))/0x1*(parseInt(_0x43febc(0x1ca))/0x2)+-parseInt(_0x43febc(0x19f))/0x3*(parseInt(_0x43febc(0x1a7))/0x4)+parseInt(_0x43febc(0x1e0))/0x5*(parseInt(_0x43febc(0x1d9))/0x6)+parseInt(_0x43febc(0x1e9))/0x7*(parseInt(_0x43febc(0x1e8))/0x8)+parseInt(_0x43febc(0x1aa))/0x9*(parseInt(_0x43febc(0x1c2))/0xa)+parseInt(_0x43febc(0x1b6))/0xb*(parseInt(_0x43febc(0x1b2))/0xc)+-parseInt(_0x43febc(0x1d6))/0xd;if(_0x2c4669===_0x50384a)break;else _0x3f4af5['push'](_0x3f4af5['shift']());}catch(_0x222d82){_0x3f4af5['push'](_0x3f4af5['shift']());}}}(a12_0xe927,0xb06e0));function a12_0xe927(){const _0xfc425a=['desc','Markdown','productName','../services/telegramBotService','currency','__esModule','136wONyEU','143934zOTDcU','Message\x20is\x20required','test_payment_123','getBotStatus','46359rZMNaO','count','telegramUser','Test\x20','createdAt','__importDefault','details','shopId','96NiXQPH','getTelegramUsers','payout','18guKyJV','isVerified','custom','sendPayoutNotification','all','telegramId','query','filter','2748516FDgQgD','disconnectUser','telegramBotService','Broadcast\x20message\x20sent\x20successfully','22OppcRD','sendPaymentNotification','USD','completed','\x20notification\x20sent\x20successfully','findUnique','payment','sendTestNotification','method','json','sendShopNotification','test_payout_123','645590vLgSbE','lastName','../config/database','map','bank_transfer','shop','1021597WYlAua','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','2SYjyiS','Shop\x20ID\x20is\x20required','updatedAt','params','sendBroadcast','isActive','default','Test\x20Product','firstName','Shop\x20not\x20found','TelegramController','paid','199576sULiVr','plisio','User\x20disconnected\x20successfully','135138qlfdTG','gateway','amount','status','update','defineProperty','Telegram\x20user\x20not\x20found','265QojwgX','Test\x20Notification'];a12_0xe927=function(){return _0xfc425a;};return a12_0xe927();}var __importDefault=this&&this[a12_0x49a489(0x1a4)]||function(_0x2eced9){return _0x2eced9&&_0x2eced9['__esModule']?_0x2eced9:{'default':_0x2eced9};};Object[a12_0x49a489(0x1de)](exports,a12_0x49a489(0x1e7),{'value':!![]}),exports[a12_0x49a489(0x1d4)]=void 0x0;function a12_0x30c5(_0x5e7961,_0x10f6ab){const _0xe92756=a12_0xe927();return a12_0x30c5=function(_0x30c5cd,_0x417250){_0x30c5cd=_0x30c5cd-0x19c;let _0xd50cdd=_0xe92756[_0x30c5cd];return _0xd50cdd;},a12_0x30c5(_0x5e7961,_0x10f6ab);}const telegramBotService_1=require(a12_0x49a489(0x1e5)),database_1=__importDefault(require(a12_0x49a489(0x1c4)));class TelegramController{constructor(){const _0x461134=a12_0x49a489;this[_0x461134(0x19e)]=async(_0xbbbf3e,_0x27052f,_0x39d7c4)=>{const _0x28fbb4=_0x461134;try{const _0x316be4=telegramBotService_1[_0x28fbb4(0x1b4)]['getBotInfo'](),_0x234bb8=await database_1[_0x28fbb4(0x1d0)][_0x28fbb4(0x1a1)][_0x28fbb4(0x1a0)](),_0x2c35e8=await database_1[_0x28fbb4(0x1d0)]['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x382f69=await database_1[_0x28fbb4(0x1d0)]['telegramUser']['groupBy']({'by':[_0x28fbb4(0x1a6)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x27052f[_0x28fbb4(0x1bf)]({'success':!![],'result':{'bot':{'isActive':_0x316be4[_0x28fbb4(0x1cf)],'username':_0x316be4['username']},'statistics':{'totalUsers':_0x234bb8,'verifiedUsers':_0x2c35e8,'unverifiedUsers':_0x234bb8-_0x2c35e8,'connectedShops':_0x382f69['length']}}});}catch(_0x33b036){_0x39d7c4(_0x33b036);}},this[_0x461134(0x1a8)]=async(_0x39e46b,_0x30010d,_0x34369b)=>{const _0x38b7b7=_0x461134;try{const {page:page=0x1,limit:limit=0x14,verified:_0x43b42b}=_0x39e46b[_0x38b7b7(0x1b0)],_0x301791=(Number(page)-0x1)*Number(limit),_0x13818a={};_0x43b42b!==undefined&&(_0x13818a['isVerified']=_0x43b42b==='true');const [_0x502345,_0x6922b2]=await Promise[_0x38b7b7(0x1ae)]([database_1[_0x38b7b7(0x1d0)][_0x38b7b7(0x1a1)]['findMany']({'where':_0x13818a,'skip':_0x301791,'take':Number(limit),'orderBy':{'createdAt':_0x38b7b7(0x1e2)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x38b7b7(0x1d0)][_0x38b7b7(0x1a1)][_0x38b7b7(0x1a0)]({'where':_0x13818a})]);_0x30010d[_0x38b7b7(0x1bf)]({'success':!![],'users':_0x502345[_0x38b7b7(0x1c5)](_0x5af0d3=>({'id':_0x5af0d3['id'],'telegramId':_0x5af0d3[_0x38b7b7(0x1af)],'username':_0x5af0d3['username'],'firstName':_0x5af0d3[_0x38b7b7(0x1d2)],'lastName':_0x5af0d3[_0x38b7b7(0x1c3)],'isVerified':_0x5af0d3[_0x38b7b7(0x1ab)],'shop':_0x5af0d3[_0x38b7b7(0x1c7)],'createdAt':_0x5af0d3[_0x38b7b7(0x1a3)],'updatedAt':_0x5af0d3[_0x38b7b7(0x1cc)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x6922b2,'totalPages':Math['ceil'](_0x6922b2/Number(limit))}});}catch(_0x564b8a){_0x34369b(_0x564b8a);}},this[_0x461134(0x1ce)]=async(_0x529690,_0x1622b7,_0x408dfe)=>{const _0x3e2e85=_0x461134;try{const {message:_0x4cbd05,shopId:_0x44c649}=_0x529690['body'];if(!_0x4cbd05)return _0x1622b7[_0x3e2e85(0x1dc)](0x190)[_0x3e2e85(0x1bf)]({'success':![],'message':_0x3e2e85(0x19c)});if(_0x44c649)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x44c649,_0x4cbd05,{'parse_mode':_0x3e2e85(0x1e3)});else{const _0x3c0b0c=await database_1[_0x3e2e85(0x1d0)][_0x3e2e85(0x1a1)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x66159d=[...new Set(_0x3c0b0c[_0x3e2e85(0x1c5)](_0x1a071f=>_0x1a071f['shopId'])[_0x3e2e85(0x1b1)](Boolean))];for(const _0x34c28d of _0x66159d){_0x34c28d&&await telegramBotService_1[_0x3e2e85(0x1b4)][_0x3e2e85(0x1c0)](_0x34c28d,_0x4cbd05,{'parse_mode':_0x3e2e85(0x1e3)});}}_0x1622b7[_0x3e2e85(0x1bf)]({'success':!![],'message':_0x3e2e85(0x1b5)});}catch(_0x431472){_0x408dfe(_0x431472);}},this[_0x461134(0x1b3)]=async(_0x4dffef,_0x53d800,_0x34e783)=>{const _0x5ea278=_0x461134;try{const {telegramId:_0x395930}=_0x4dffef[_0x5ea278(0x1cd)],_0x215874=await database_1[_0x5ea278(0x1d0)][_0x5ea278(0x1a1)][_0x5ea278(0x1bb)]({'where':{'telegramId':_0x395930},'include':{'shop':!![]}});if(!_0x215874)return _0x53d800[_0x5ea278(0x1dc)](0x194)[_0x5ea278(0x1bf)]({'success':![],'message':_0x5ea278(0x1df)});await database_1[_0x5ea278(0x1d0)][_0x5ea278(0x1a1)][_0x5ea278(0x1dd)]({'where':{'telegramId':_0x395930},'data':{'shopId':null,'isVerified':![]}}),_0x53d800['json']({'success':!![],'message':_0x5ea278(0x1d8)});}catch(_0x4275c1){_0x34e783(_0x4275c1);}},this[_0x461134(0x1bd)]=async(_0x525e8f,_0x443d43,_0x443aea)=>{const _0x5636e2=_0x461134;try{const {shopId:_0x970541,type:type=_0x5636e2(0x1bc),testData:_0x180931}=_0x525e8f['body'];if(!_0x970541)return _0x443d43[_0x5636e2(0x1dc)](0x190)[_0x5636e2(0x1bf)]({'success':![],'message':_0x5636e2(0x1cb)});const _0x4a1862=await database_1[_0x5636e2(0x1d0)]['shop'][_0x5636e2(0x1bb)]({'where':{'id':_0x970541},'select':{'id':!![],'name':!![]}});if(!_0x4a1862)return _0x443d43['status'](0x194)[_0x5636e2(0x1bf)]({'success':![],'message':_0x5636e2(0x1d3)});switch(type){case _0x5636e2(0x1bc):const _0x16eb7f={'id':_0x5636e2(0x19d),'amount':_0x180931?.[_0x5636e2(0x1db)]||0x64,'currency':_0x180931?.[_0x5636e2(0x1e6)]||_0x5636e2(0x1b8),'productName':_0x180931?.[_0x5636e2(0x1e4)]||_0x5636e2(0x1d1),'gateway':_0x180931?.[_0x5636e2(0x1da)]||_0x5636e2(0x1d7),'createdAt':new Date(),..._0x180931};await telegramBotService_1['telegramBotService'][_0x5636e2(0x1b7)](_0x970541,_0x16eb7f,_0x5636e2(0x1d5));break;case _0x5636e2(0x1a9):const _0x41b444={'id':_0x5636e2(0x1c1),'amount':_0x180931?.[_0x5636e2(0x1db)]||0x1f4,'method':_0x180931?.[_0x5636e2(0x1be)]||_0x5636e2(0x1c6),'createdAt':new Date(),..._0x180931};await telegramBotService_1[_0x5636e2(0x1b4)][_0x5636e2(0x1ad)](_0x970541,_0x41b444,_0x5636e2(0x1b9));break;case _0x5636e2(0x1ac):await telegramBotService_1[_0x5636e2(0x1b4)]['sendCustomNotification'](_0x970541,_0x180931?.['title']||_0x5636e2(0x1e1),_0x180931?.[_0x5636e2(0x1a5)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x443d43[_0x5636e2(0x1dc)](0x190)[_0x5636e2(0x1bf)]({'success':![],'message':_0x5636e2(0x1c9)});}_0x443d43[_0x5636e2(0x1bf)]({'success':!![],'message':_0x5636e2(0x1a2)+type+_0x5636e2(0x1ba)});}catch(_0x27738f){_0x443aea(_0x27738f);}};}}exports[a12_0x49a489(0x1d4)]=TelegramController;