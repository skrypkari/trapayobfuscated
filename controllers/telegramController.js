'use strict';function a18_0x49e1(){const _0x12c4b5=['network','txid','test_payment_123','count','amount','../config/database','getBotInfo','82686vQyOkL','sendCustomNotification','telegramId','2879240JAeoXQ','wallet','231nEUSxg','sendPayoutNotification','paid','TRC20','details','TelegramController','Telegram\x20user\x20not\x20found','payout','params','default','Broadcast\x20message\x20sent\x20successfully','__importDefault','body','map','getTelegramUsers','3959196EVMrBB','Test\x20Notification','USD','findMany','length','currency','shop','234440wwqCmt','Test\x20Product','telegramBotService','This\x20is\x20a\x20test\x20notification','gateway','query','sendShopNotification','payment','status','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Shop\x20not\x20found','Shop\x20ID\x20is\x20required','lastName','User\x20disconnected\x20successfully','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','desc','sendBroadcast','username','isActive','isVerified','json','findUnique','telegramUser','12597UzZYun','custom','58854SxCRTD','\x20notification\x20sent\x20successfully','20uIqKlb','Тестовый\x20период','Test\x20','plisio','defineProperty','3010923MJVUoV','145leqlsP','shopId','__esModule','filter','Message\x20is\x20required','title'];a18_0x49e1=function(){return _0x12c4b5;};return a18_0x49e1();}const a18_0x5eb1c6=a18_0x129d;(function(_0x2a8c2c,_0x2730ec){const _0x20deb4=a18_0x129d,_0x139d21=_0x2a8c2c();while(!![]){try{const _0x324f22=-parseInt(_0x20deb4(0x6b))/0x1+parseInt(_0x20deb4(0x6f))/0x2*(parseInt(_0x20deb4(0x82))/0x3)+parseInt(_0x20deb4(0x96))/0x4+parseInt(_0x20deb4(0x75))/0x5*(parseInt(_0x20deb4(0x6d))/0x6)+parseInt(_0x20deb4(0x87))/0x7*(-parseInt(_0x20deb4(0x9d))/0x8)+-parseInt(_0x20deb4(0x74))/0x9+parseInt(_0x20deb4(0x85))/0xa;if(_0x324f22===_0x2730ec)break;else _0x139d21['push'](_0x139d21['shift']());}catch(_0x588e51){_0x139d21['push'](_0x139d21['shift']());}}}(a18_0x49e1,0x7fd4b));var __importDefault=this&&this[a18_0x5eb1c6(0x92)]||function(_0x3c37b7){const _0x13226e=a18_0x5eb1c6;return _0x3c37b7&&_0x3c37b7[_0x13226e(0x77)]?_0x3c37b7:{'default':_0x3c37b7};};Object[a18_0x5eb1c6(0x73)](exports,a18_0x5eb1c6(0x77),{'value':!![]}),exports[a18_0x5eb1c6(0x8c)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a18_0x5eb1c6(0x80)));function a18_0x129d(_0x57ef51,_0x4a674c){_0x57ef51=_0x57ef51-0x65;const _0x49e13c=a18_0x49e1();let _0x129d64=_0x49e13c[_0x57ef51];return _0x129d64;}class TelegramController{constructor(){const _0x31ec73=a18_0x5eb1c6;this['getBotStatus']=async(_0x3db955,_0x5208f0,_0x58ceb2)=>{const _0x306dc6=a18_0x129d;try{const _0x56ddc3=telegramBotService_1[_0x306dc6(0x9f)][_0x306dc6(0x81)](),_0x3dd239=await database_1['default'][_0x306dc6(0x6a)][_0x306dc6(0x7e)](),_0x5746a2=await database_1[_0x306dc6(0x90)][_0x306dc6(0x6a)][_0x306dc6(0x7e)]({'where':{'isVerified':!![]}}),_0x386fde=await database_1[_0x306dc6(0x90)][_0x306dc6(0x6a)]['groupBy']({'by':[_0x306dc6(0x76)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5208f0[_0x306dc6(0x68)]({'success':!![],'result':{'bot':{'isActive':_0x56ddc3[_0x306dc6(0x66)],'username':_0x56ddc3['username']},'statistics':{'totalUsers':_0x3dd239,'verifiedUsers':_0x5746a2,'unverifiedUsers':_0x3dd239-_0x5746a2,'connectedShops':_0x386fde[_0x306dc6(0x9a)]}}});}catch(_0x496c5a){_0x58ceb2(_0x496c5a);}},this[_0x31ec73(0x95)]=async(_0x2f5201,_0x321606,_0x36a721)=>{const _0x7abefe=_0x31ec73;try{const {page:page=0x1,limit:limit=0x14,verified:_0x203ffa}=_0x2f5201[_0x7abefe(0xa2)],_0xa354af=(Number(page)-0x1)*Number(limit),_0x504819={};_0x203ffa!==undefined&&(_0x504819[_0x7abefe(0x67)]=_0x203ffa==='true');const [_0x1f2803,_0x1ed0d7]=await Promise['all']([database_1[_0x7abefe(0x90)][_0x7abefe(0x6a)][_0x7abefe(0x99)]({'where':_0x504819,'skip':_0xa354af,'take':Number(limit),'orderBy':{'createdAt':_0x7abefe(0xac)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x7abefe(0x90)][_0x7abefe(0x6a)][_0x7abefe(0x7e)]({'where':_0x504819})]);_0x321606[_0x7abefe(0x68)]({'success':!![],'users':_0x1f2803[_0x7abefe(0x94)](_0x223f18=>({'id':_0x223f18['id'],'telegramId':_0x223f18[_0x7abefe(0x84)],'username':_0x223f18[_0x7abefe(0x65)],'firstName':_0x223f18['firstName'],'lastName':_0x223f18[_0x7abefe(0xa9)],'isVerified':_0x223f18[_0x7abefe(0x67)],'shop':_0x223f18[_0x7abefe(0x9c)],'createdAt':_0x223f18['createdAt'],'updatedAt':_0x223f18['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1ed0d7,'totalPages':Math['ceil'](_0x1ed0d7/Number(limit))}});}catch(_0x15ccc2){_0x36a721(_0x15ccc2);}},this[_0x31ec73(0xad)]=async(_0x350a54,_0x42543a,_0x258ebe)=>{const _0x34b377=_0x31ec73;try{const {message:_0x3d621a,shopId:_0x5a966e}=_0x350a54[_0x34b377(0x93)];if(!_0x3d621a)return _0x42543a[_0x34b377(0xa5)](0x190)[_0x34b377(0x68)]({'success':![],'message':_0x34b377(0x79)});if(_0x5a966e)await telegramBotService_1[_0x34b377(0x9f)][_0x34b377(0xa3)](_0x5a966e,_0x3d621a,{'parse_mode':'Markdown'});else{const _0x4af65c=await database_1['default']['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x115515=[...new Set(_0x4af65c['map'](_0x91bef4=>_0x91bef4[_0x34b377(0x76)])[_0x34b377(0x78)](Boolean))];for(const _0x1673fb of _0x115515){_0x1673fb&&await telegramBotService_1[_0x34b377(0x9f)][_0x34b377(0xa3)](_0x1673fb,_0x3d621a,{'parse_mode':'Markdown'});}}_0x42543a[_0x34b377(0x68)]({'success':!![],'message':_0x34b377(0x91)});}catch(_0x1056a8){_0x258ebe(_0x1056a8);}},this['disconnectUser']=async(_0x6d0730,_0x12f2ce,_0x4f3bce)=>{const _0x5d7993=_0x31ec73;try{const {telegramId:_0x1d2280}=_0x6d0730[_0x5d7993(0x8f)],_0x408124=await database_1[_0x5d7993(0x90)]['telegramUser']['findUnique']({'where':{'telegramId':_0x1d2280},'include':{'shop':!![]}});if(!_0x408124)return _0x12f2ce[_0x5d7993(0xa5)](0x194)[_0x5d7993(0x68)]({'success':![],'message':_0x5d7993(0x8d)});await database_1[_0x5d7993(0x90)]['telegramUser']['update']({'where':{'telegramId':_0x1d2280},'data':{'shopId':null,'isVerified':![]}}),_0x12f2ce[_0x5d7993(0x68)]({'success':!![],'message':_0x5d7993(0xaa)});}catch(_0x47730c){_0x4f3bce(_0x47730c);}},this['sendTestNotification']=async(_0x352643,_0x2293b1,_0x394d57)=>{const _0x45a23a=_0x31ec73;try{const {shopId:_0x5c9c94,type:type=_0x45a23a(0xa4),testData:_0x566b8b}=_0x352643[_0x45a23a(0x93)];if(!_0x5c9c94)return _0x2293b1[_0x45a23a(0xa5)](0x190)[_0x45a23a(0x68)]({'success':![],'message':_0x45a23a(0xa8)});const _0x135460=await database_1[_0x45a23a(0x90)][_0x45a23a(0x9c)][_0x45a23a(0x69)]({'where':{'id':_0x5c9c94},'select':{'id':!![],'name':!![]}});if(!_0x135460)return _0x2293b1['status'](0x194)[_0x45a23a(0x68)]({'success':![],'message':_0x45a23a(0xa7)});switch(type){case'payment':const _0x4aa85c={'id':_0x45a23a(0x7d),'amount':_0x566b8b?.['amount']||0x64,'currency':_0x566b8b?.[_0x45a23a(0x9b)]||_0x45a23a(0x98),'productName':_0x566b8b?.['productName']||_0x45a23a(0x9e),'gateway':_0x566b8b?.[_0x45a23a(0xa1)]||_0x45a23a(0x72),'createdAt':new Date(),..._0x566b8b};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x5c9c94,_0x4aa85c,_0x45a23a(0x89));break;case _0x45a23a(0x8e):const _0x4af563={'id':'test_payout_123','amount':_0x566b8b?.[_0x45a23a(0x7f)]||0x1f4,'network':_0x566b8b?.[_0x45a23a(0x7b)]||_0x45a23a(0x8a),'wallet':_0x566b8b?.[_0x45a23a(0x86)]||_0x45a23a(0xab),'period':_0x45a23a(0x70),'createdAt':new Date(),'txid':_0x566b8b?.[_0x45a23a(0x7c)]||null,..._0x566b8b};await telegramBotService_1['telegramBotService'][_0x45a23a(0x88)](_0x5c9c94,_0x4af563);break;case _0x45a23a(0x6c):await telegramBotService_1[_0x45a23a(0x9f)][_0x45a23a(0x83)](_0x5c9c94,_0x566b8b?.[_0x45a23a(0x7a)]||_0x45a23a(0x97),_0x566b8b?.[_0x45a23a(0x8b)]||{'message':_0x45a23a(0xa0)});break;default:return _0x2293b1[_0x45a23a(0xa5)](0x190)[_0x45a23a(0x68)]({'success':![],'message':_0x45a23a(0xa6)});}_0x2293b1[_0x45a23a(0x68)]({'success':!![],'message':_0x45a23a(0x71)+type+_0x45a23a(0x6e)});}catch(_0x27ec77){_0x394d57(_0x27ec77);}};}}exports['TelegramController']=TelegramController;