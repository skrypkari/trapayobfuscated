'use strict';function a18_0x4008(){const _0x5436c9=['Тестовый\x20период','status','Test\x20Product','sendCustomNotification','8iFdUtp','createdAt','USD','getTelegramUsers','wallet','18809ltTDjt','payout','telegramId','count','params','length','Telegram\x20user\x20not\x20found','details','disconnectUser','network','json','This\x20is\x20a\x20test\x20notification','shopId','paid','Shop\x20ID\x20is\x20required','test_payout_123','6461280unzxuD','groupBy','username','amount','TRC20','test_payment_123','TelegramController','sendPayoutNotification','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','519927CnGTyw','currency','Message\x20is\x20required','3641220xrfmWc','telegramUser','default','sendTestNotification','map','findUnique','txid','defineProperty','title','\x20notification\x20sent\x20successfully','body','../services/telegramBotService','filter','Shop\x20not\x20found','plisio','sendShopNotification','../config/database','firstName','getBotStatus','2428990sDQgsO','telegramBotService','custom','Markdown','shop','2456dlWEml','update','desc','845993IdPYKa','gateway','Test\x20Notification','17496GYZwgP','updatedAt','User\x20disconnected\x20successfully','__esModule','findMany'];a18_0x4008=function(){return _0x5436c9;};return a18_0x4008();}const a18_0x53bd59=a18_0x22ed;(function(_0x76af00,_0x42bbca){const _0x53fe2d=a18_0x22ed,_0x3318a6=_0x76af00();while(!![]){try{const _0x43ee5c=parseInt(_0x53fe2d(0x207))/0x1+parseInt(_0x53fe2d(0x20a))/0x2+-parseInt(_0x53fe2d(0x1e9))/0x3*(-parseInt(_0x53fe2d(0x213))/0x4)+-parseInt(_0x53fe2d(0x1ff))/0x5+parseInt(_0x53fe2d(0x1e0))/0x6+parseInt(_0x53fe2d(0x218))/0x7*(-parseInt(_0x53fe2d(0x204))/0x8)+-parseInt(_0x53fe2d(0x1ec))/0x9;if(_0x43ee5c===_0x42bbca)break;else _0x3318a6['push'](_0x3318a6['shift']());}catch(_0x5eaebc){_0x3318a6['push'](_0x3318a6['shift']());}}}(a18_0x4008,0x89708));function a18_0x22ed(_0x130e19,_0x51616a){_0x130e19=_0x130e19-0x1d3;const _0x400804=a18_0x4008();let _0x22ede4=_0x400804[_0x130e19];return _0x22ede4;}var __importDefault=this&&this['__importDefault']||function(_0x2b9f06){return _0x2b9f06&&_0x2b9f06['__esModule']?_0x2b9f06:{'default':_0x2b9f06};};Object[a18_0x53bd59(0x1f3)](exports,a18_0x53bd59(0x20d),{'value':!![]}),exports[a18_0x53bd59(0x1e6)]=void 0x0;const telegramBotService_1=require(a18_0x53bd59(0x1f7)),database_1=__importDefault(require(a18_0x53bd59(0x1fc)));class TelegramController{constructor(){const _0xcfaea2=a18_0x53bd59;this[_0xcfaea2(0x1fe)]=async(_0x579ff3,_0x3d82f5,_0x42cd9e)=>{const _0x170d3e=_0xcfaea2;try{const _0x2f9485=telegramBotService_1[_0x170d3e(0x200)]['getBotInfo'](),_0x2268b2=await database_1[_0x170d3e(0x1ee)][_0x170d3e(0x1ed)][_0x170d3e(0x1d3)](),_0x4a3ccd=await database_1[_0x170d3e(0x1ee)]['telegramUser'][_0x170d3e(0x1d3)]({'where':{'isVerified':!![]}}),_0x4b148b=await database_1[_0x170d3e(0x1ee)][_0x170d3e(0x1ed)][_0x170d3e(0x1e1)]({'by':[_0x170d3e(0x1dc)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3d82f5['json']({'success':!![],'result':{'bot':{'isActive':_0x2f9485['isActive'],'username':_0x2f9485[_0x170d3e(0x1e2)]},'statistics':{'totalUsers':_0x2268b2,'verifiedUsers':_0x4a3ccd,'unverifiedUsers':_0x2268b2-_0x4a3ccd,'connectedShops':_0x4b148b[_0x170d3e(0x1d5)]}}});}catch(_0x48b305){_0x42cd9e(_0x48b305);}},this[_0xcfaea2(0x216)]=async(_0x17114d,_0x2af769,_0x70906f)=>{const _0x49129b=_0xcfaea2;try{const {page:page=0x1,limit:limit=0x14,verified:_0x534812}=_0x17114d['query'],_0x4d1289=(Number(page)-0x1)*Number(limit),_0x3cbc8e={};_0x534812!==undefined&&(_0x3cbc8e['isVerified']=_0x534812==='true');const [_0x279af1,_0x1be88b]=await Promise['all']([database_1[_0x49129b(0x1ee)]['telegramUser'][_0x49129b(0x20e)]({'where':_0x3cbc8e,'skip':_0x4d1289,'take':Number(limit),'orderBy':{'createdAt':_0x49129b(0x206)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x49129b(0x1ed)][_0x49129b(0x1d3)]({'where':_0x3cbc8e})]);_0x2af769[_0x49129b(0x1da)]({'success':!![],'users':_0x279af1[_0x49129b(0x1f0)](_0xb99408=>({'id':_0xb99408['id'],'telegramId':_0xb99408[_0x49129b(0x21a)],'username':_0xb99408[_0x49129b(0x1e2)],'firstName':_0xb99408[_0x49129b(0x1fd)],'lastName':_0xb99408['lastName'],'isVerified':_0xb99408['isVerified'],'shop':_0xb99408[_0x49129b(0x203)],'createdAt':_0xb99408[_0x49129b(0x214)],'updatedAt':_0xb99408[_0x49129b(0x20b)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1be88b,'totalPages':Math['ceil'](_0x1be88b/Number(limit))}});}catch(_0x5f154d){_0x70906f(_0x5f154d);}},this['sendBroadcast']=async(_0x40a654,_0x34b98d,_0x5b5a82)=>{const _0x313d98=_0xcfaea2;try{const {message:_0x3f7aa1,shopId:_0xb0f895}=_0x40a654[_0x313d98(0x1f6)];if(!_0x3f7aa1)return _0x34b98d['status'](0x190)[_0x313d98(0x1da)]({'success':![],'message':_0x313d98(0x1eb)});if(_0xb0f895)await telegramBotService_1[_0x313d98(0x200)]['sendShopNotification'](_0xb0f895,_0x3f7aa1,{'parse_mode':_0x313d98(0x202)});else{const _0x4fa09b=await database_1[_0x313d98(0x1ee)][_0x313d98(0x1ed)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xc77ea5=[...new Set(_0x4fa09b[_0x313d98(0x1f0)](_0x3c6226=>_0x3c6226[_0x313d98(0x1dc)])[_0x313d98(0x1f8)](Boolean))];for(const _0x5ad9db of _0xc77ea5){_0x5ad9db&&await telegramBotService_1[_0x313d98(0x200)][_0x313d98(0x1fb)](_0x5ad9db,_0x3f7aa1,{'parse_mode':'Markdown'});}}_0x34b98d[_0x313d98(0x1da)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x42c2a5){_0x5b5a82(_0x42c2a5);}},this[_0xcfaea2(0x1d8)]=async(_0xe2ccd7,_0x205cc0,_0x510fc1)=>{const _0x489b24=_0xcfaea2;try{const {telegramId:_0x131b5c}=_0xe2ccd7[_0x489b24(0x1d4)],_0x1047bd=await database_1[_0x489b24(0x1ee)][_0x489b24(0x1ed)][_0x489b24(0x1f1)]({'where':{'telegramId':_0x131b5c},'include':{'shop':!![]}});if(!_0x1047bd)return _0x205cc0[_0x489b24(0x210)](0x194)['json']({'success':![],'message':_0x489b24(0x1d6)});await database_1[_0x489b24(0x1ee)]['telegramUser'][_0x489b24(0x205)]({'where':{'telegramId':_0x131b5c},'data':{'shopId':null,'isVerified':![]}}),_0x205cc0['json']({'success':!![],'message':_0x489b24(0x20c)});}catch(_0x2b5446){_0x510fc1(_0x2b5446);}},this[_0xcfaea2(0x1ef)]=async(_0x20e650,_0x4da3eb,_0x101c2e)=>{const _0x367910=_0xcfaea2;try{const {shopId:_0x5bba9a,type:type='payment',testData:_0x4670d3}=_0x20e650['body'];if(!_0x5bba9a)return _0x4da3eb['status'](0x190)[_0x367910(0x1da)]({'success':![],'message':_0x367910(0x1de)});const _0x2d720c=await database_1[_0x367910(0x1ee)][_0x367910(0x203)][_0x367910(0x1f1)]({'where':{'id':_0x5bba9a},'select':{'id':!![],'name':!![]}});if(!_0x2d720c)return _0x4da3eb[_0x367910(0x210)](0x194)[_0x367910(0x1da)]({'success':![],'message':_0x367910(0x1f9)});switch(type){case'payment':const _0x439c7c={'id':_0x367910(0x1e5),'amount':_0x4670d3?.[_0x367910(0x1e3)]||0x64,'currency':_0x4670d3?.[_0x367910(0x1ea)]||_0x367910(0x215),'productName':_0x4670d3?.['productName']||_0x367910(0x211),'gateway':_0x4670d3?.[_0x367910(0x208)]||_0x367910(0x1fa),'createdAt':new Date(),..._0x4670d3};await telegramBotService_1[_0x367910(0x200)]['sendPaymentNotification'](_0x5bba9a,_0x439c7c,_0x367910(0x1dd));break;case _0x367910(0x219):const _0x15f3cd={'id':_0x367910(0x1df),'amount':_0x4670d3?.['amount']||0x1f4,'network':_0x4670d3?.[_0x367910(0x1d9)]||_0x367910(0x1e4),'wallet':_0x4670d3?.[_0x367910(0x217)]||_0x367910(0x1e8),'period':_0x367910(0x20f),'createdAt':new Date(),'txid':_0x4670d3?.[_0x367910(0x1f2)]||null,..._0x4670d3};await telegramBotService_1['telegramBotService'][_0x367910(0x1e7)](_0x5bba9a,_0x15f3cd);break;case _0x367910(0x201):await telegramBotService_1[_0x367910(0x200)][_0x367910(0x212)](_0x5bba9a,_0x4670d3?.[_0x367910(0x1f4)]||_0x367910(0x209),_0x4670d3?.[_0x367910(0x1d7)]||{'message':_0x367910(0x1db)});break;default:return _0x4da3eb[_0x367910(0x210)](0x190)[_0x367910(0x1da)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x4da3eb['json']({'success':!![],'message':'Test\x20'+type+_0x367910(0x1f5)});}catch(_0x4ad636){_0x101c2e(_0x4ad636);}};}}exports[a18_0x53bd59(0x1e6)]=TelegramController;