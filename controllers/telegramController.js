'use strict';const a18_0x32b1ca=a18_0x5bf6;(function(_0x536aab,_0x295212){const _0x5e8076=a18_0x5bf6,_0x5d8700=_0x536aab();while(!![]){try{const _0x2893a6=parseInt(_0x5e8076(0x12a))/0x1+-parseInt(_0x5e8076(0x158))/0x2+parseInt(_0x5e8076(0x15a))/0x3*(-parseInt(_0x5e8076(0x16a))/0x4)+-parseInt(_0x5e8076(0x164))/0x5+parseInt(_0x5e8076(0x144))/0x6+-parseInt(_0x5e8076(0x125))/0x7*(parseInt(_0x5e8076(0x13f))/0x8)+-parseInt(_0x5e8076(0x161))/0x9*(-parseInt(_0x5e8076(0x12c))/0xa);if(_0x2893a6===_0x295212)break;else _0x5d8700['push'](_0x5d8700['shift']());}catch(_0x300dba){_0x5d8700['push'](_0x5d8700['shift']());}}}(a18_0x2186,0xb8841));var __importDefault=this&&this[a18_0x32b1ca(0x135)]||function(_0x1320d1){const _0x517882=a18_0x32b1ca;return _0x1320d1&&_0x1320d1[_0x517882(0x13b)]?_0x1320d1:{'default':_0x1320d1};};Object[a18_0x32b1ca(0x133)](exports,a18_0x32b1ca(0x13b),{'value':!![]}),exports[a18_0x32b1ca(0x15d)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a18_0x32b1ca(0x129)));function a18_0x5bf6(_0x48fa8d,_0x589160){_0x48fa8d=_0x48fa8d-0x124;const _0x2186aa=a18_0x2186();let _0x5bf6dc=_0x2186aa[_0x48fa8d];return _0x5bf6dc;}class TelegramController{constructor(){const _0x13d15e=a18_0x32b1ca;this[_0x13d15e(0x12d)]=async(_0x4246e1,_0x3839f1,_0x36d9df)=>{const _0x42a518=_0x13d15e;try{const _0x461983=telegramBotService_1[_0x42a518(0x13d)]['getBotInfo'](),_0x54f7fe=await database_1['default'][_0x42a518(0x131)][_0x42a518(0x148)](),_0x4694f9=await database_1[_0x42a518(0x149)][_0x42a518(0x131)]['count']({'where':{'isVerified':!![]}}),_0x49c2fa=await database_1['default'][_0x42a518(0x131)][_0x42a518(0x138)]({'by':[_0x42a518(0x142)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3839f1[_0x42a518(0x168)]({'success':!![],'result':{'bot':{'isActive':_0x461983[_0x42a518(0x169)],'username':_0x461983['username']},'statistics':{'totalUsers':_0x54f7fe,'verifiedUsers':_0x4694f9,'unverifiedUsers':_0x54f7fe-_0x4694f9,'connectedShops':_0x49c2fa[_0x42a518(0x126)]}}});}catch(_0x2e4ebc){_0x36d9df(_0x2e4ebc);}},this[_0x13d15e(0x13e)]=async(_0x3e7930,_0xb9ffe2,_0x34f8e0)=>{const _0x500305=_0x13d15e;try{const {page:page=0x1,limit:limit=0x14,verified:_0x51da8a}=_0x3e7930[_0x500305(0x165)],_0xea347=(Number(page)-0x1)*Number(limit),_0x5543cf={};_0x51da8a!==undefined&&(_0x5543cf[_0x500305(0x14b)]=_0x51da8a===_0x500305(0x14a));const [_0x4e0299,_0x279db4]=await Promise['all']([database_1[_0x500305(0x149)][_0x500305(0x131)]['findMany']({'where':_0x5543cf,'skip':_0xea347,'take':Number(limit),'orderBy':{'createdAt':_0x500305(0x153)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x500305(0x149)][_0x500305(0x131)][_0x500305(0x148)]({'where':_0x5543cf})]);_0xb9ffe2[_0x500305(0x168)]({'success':!![],'users':_0x4e0299[_0x500305(0x143)](_0x1d60b8=>({'id':_0x1d60b8['id'],'telegramId':_0x1d60b8['telegramId'],'username':_0x1d60b8[_0x500305(0x152)],'firstName':_0x1d60b8['firstName'],'lastName':_0x1d60b8['lastName'],'isVerified':_0x1d60b8[_0x500305(0x14b)],'shop':_0x1d60b8[_0x500305(0x132)],'createdAt':_0x1d60b8[_0x500305(0x128)],'updatedAt':_0x1d60b8[_0x500305(0x156)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x279db4,'totalPages':Math['ceil'](_0x279db4/Number(limit))}});}catch(_0x2e0c1b){_0x34f8e0(_0x2e0c1b);}},this['sendBroadcast']=async(_0x7f76af,_0x401e7a,_0x17518e)=>{const _0x4c1e5c=_0x13d15e;try{const {message:_0x529011,shopId:_0x287e53}=_0x7f76af[_0x4c1e5c(0x12b)];if(!_0x529011)return _0x401e7a[_0x4c1e5c(0x15c)](0x190)[_0x4c1e5c(0x168)]({'success':![],'message':_0x4c1e5c(0x15f)});if(_0x287e53)await telegramBotService_1[_0x4c1e5c(0x13d)][_0x4c1e5c(0x150)](_0x287e53,_0x529011,{'parse_mode':_0x4c1e5c(0x13a)});else{const _0x536d03=await database_1['default'][_0x4c1e5c(0x131)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x241c29=[...new Set(_0x536d03[_0x4c1e5c(0x143)](_0x868fb1=>_0x868fb1[_0x4c1e5c(0x142)])[_0x4c1e5c(0x151)](Boolean))];for(const _0x1db1da of _0x241c29){_0x1db1da&&await telegramBotService_1[_0x4c1e5c(0x13d)][_0x4c1e5c(0x150)](_0x1db1da,_0x529011,{'parse_mode':_0x4c1e5c(0x13a)});}}_0x401e7a[_0x4c1e5c(0x168)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x297ea9){_0x17518e(_0x297ea9);}},this[_0x13d15e(0x124)]=async(_0x444232,_0x3b5653,_0x529972)=>{const _0xa1ef2e=_0x13d15e;try{const {telegramId:_0x17a593}=_0x444232[_0xa1ef2e(0x12f)],_0x350f6f=await database_1[_0xa1ef2e(0x149)][_0xa1ef2e(0x131)][_0xa1ef2e(0x147)]({'where':{'telegramId':_0x17a593},'include':{'shop':!![]}});if(!_0x350f6f)return _0x3b5653[_0xa1ef2e(0x15c)](0x194)[_0xa1ef2e(0x168)]({'success':![],'message':_0xa1ef2e(0x159)});await database_1[_0xa1ef2e(0x149)][_0xa1ef2e(0x131)][_0xa1ef2e(0x160)]({'where':{'telegramId':_0x17a593},'data':{'shopId':null,'isVerified':![]}}),_0x3b5653[_0xa1ef2e(0x168)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x7a66c9){_0x529972(_0x7a66c9);}},this['sendTestNotification']=async(_0x38bf2a,_0xa139bc,_0x4031c0)=>{const _0xb73a24=_0x13d15e;try{const {shopId:_0x776e74,type:type=_0xb73a24(0x155),testData:_0x51b9ff}=_0x38bf2a[_0xb73a24(0x12b)];if(!_0x776e74)return _0xa139bc[_0xb73a24(0x15c)](0x190)[_0xb73a24(0x168)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x1190bf=await database_1[_0xb73a24(0x149)][_0xb73a24(0x132)][_0xb73a24(0x147)]({'where':{'id':_0x776e74},'select':{'id':!![],'name':!![]}});if(!_0x1190bf)return _0xa139bc['status'](0x194)['json']({'success':![],'message':_0xb73a24(0x157)});switch(type){case _0xb73a24(0x155):const _0x422048={'id':_0xb73a24(0x130),'amount':_0x51b9ff?.['amount']||0x64,'currency':_0x51b9ff?.[_0xb73a24(0x140)]||'USD','productName':_0x51b9ff?.[_0xb73a24(0x13c)]||_0xb73a24(0x141),'gateway':_0x51b9ff?.[_0xb73a24(0x15b)]||_0xb73a24(0x127),'createdAt':new Date(),..._0x51b9ff};await telegramBotService_1[_0xb73a24(0x13d)][_0xb73a24(0x15e)](_0x776e74,_0x422048,_0xb73a24(0x167));break;case'payout':const _0xc3cd62={'id':_0xb73a24(0x145),'amount':_0x51b9ff?.[_0xb73a24(0x134)]||0x1f4,'network':_0x51b9ff?.[_0xb73a24(0x14f)]||_0xb73a24(0x14c),'wallet':_0x51b9ff?.[_0xb73a24(0x137)]||_0xb73a24(0x154),'period':_0xb73a24(0x163),'createdAt':new Date(),'txid':_0x51b9ff?.[_0xb73a24(0x146)]||null,..._0x51b9ff};await telegramBotService_1[_0xb73a24(0x13d)][_0xb73a24(0x14d)](_0x776e74,_0xc3cd62);break;case'custom':await telegramBotService_1[_0xb73a24(0x13d)][_0xb73a24(0x14e)](_0x776e74,_0x51b9ff?.['title']||_0xb73a24(0x139),_0x51b9ff?.[_0xb73a24(0x12e)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0xa139bc['status'](0x190)[_0xb73a24(0x168)]({'success':![],'message':_0xb73a24(0x136)});}_0xa139bc[_0xb73a24(0x168)]({'success':!![],'message':_0xb73a24(0x162)+type+_0xb73a24(0x166)});}catch(_0x1a2cea){_0x4031c0(_0x1a2cea);}};}}exports[a18_0x32b1ca(0x15d)]=TelegramController;function a18_0x2186(){const _0x3566a4=['1199240pvEqyx','Telegram\x20user\x20not\x20found','18NKxnhn','gateway','status','TelegramController','sendPaymentNotification','Message\x20is\x20required','update','897588DsfQkG','Test\x20','Тестовый\x20период','4626025oSFuHB','query','\x20notification\x20sent\x20successfully','paid','json','isActive','159220VRyaip','disconnectUser','14BFTxCO','length','plisio','createdAt','../config/database','1166535dvSfVH','body','90AYOeRo','getBotStatus','details','params','test_payment_123','telegramUser','shop','defineProperty','amount','__importDefault','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','wallet','groupBy','Test\x20Notification','Markdown','__esModule','productName','telegramBotService','getTelegramUsers','799256DLETcq','currency','Test\x20Product','shopId','map','3930738STPafL','test_payout_123','txid','findUnique','count','default','true','isVerified','TRC20','sendPayoutNotification','sendCustomNotification','network','sendShopNotification','filter','username','desc','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','payment','updatedAt','Shop\x20not\x20found'];a18_0x2186=function(){return _0x3566a4;};return a18_0x2186();}