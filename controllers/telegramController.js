'use strict';const a12_0x21bf14=a12_0x1d0f;(function(_0x369501,_0xd13d77){const _0x47f60e=a12_0x1d0f,_0x3bac76=_0x369501();while(!![]){try{const _0x303e6a=-parseInt(_0x47f60e(0x16e))/0x1*(parseInt(_0x47f60e(0x14b))/0x2)+parseInt(_0x47f60e(0x174))/0x3*(parseInt(_0x47f60e(0x17a))/0x4)+-parseInt(_0x47f60e(0x14c))/0x5+parseInt(_0x47f60e(0x14a))/0x6*(parseInt(_0x47f60e(0x166))/0x7)+-parseInt(_0x47f60e(0x153))/0x8+parseInt(_0x47f60e(0x149))/0x9*(-parseInt(_0x47f60e(0x168))/0xa)+-parseInt(_0x47f60e(0x158))/0xb*(-parseInt(_0x47f60e(0x133))/0xc);if(_0x303e6a===_0xd13d77)break;else _0x3bac76['push'](_0x3bac76['shift']());}catch(_0xe589e7){_0x3bac76['push'](_0x3bac76['shift']());}}}(a12_0x22a9,0xc4f5e));var __importDefault=this&&this['__importDefault']||function(_0x59a037){const _0x5d26d4=a12_0x1d0f;return _0x59a037&&_0x59a037[_0x5d26d4(0x136)]?_0x59a037:{'default':_0x59a037};};Object[a12_0x21bf14(0x176)](exports,a12_0x21bf14(0x136),{'value':!![]}),exports['TelegramController']=void 0x0;function a12_0x1d0f(_0xc54af9,_0x2c02c8){const _0x22a9ef=a12_0x22a9();return a12_0x1d0f=function(_0x1d0fd1,_0x26c0c5){_0x1d0fd1=_0x1d0fd1-0x133;let _0x373692=_0x22a9ef[_0x1d0fd1];return _0x373692;},a12_0x1d0f(_0xc54af9,_0x2c02c8);}const telegramBotService_1=require(a12_0x21bf14(0x17d)),database_1=__importDefault(require(a12_0x21bf14(0x13f)));function a12_0x22a9(){const _0x236c4d=['productName','../services/telegramBotService','12BPxVMM','desc','findUnique','__esModule','Test\x20Notification','body','telegramUser','TelegramController','sendTestNotification','getTelegramUsers','Shop\x20not\x20found','disconnectUser','../config/database','findMany','default','createdAt','gateway','json','currency','groupBy','sendPayoutNotification','method','3230631FctTjj','558786ZyxgDO','39394iiLqsa','1406920nogqLk','status','update','firstName','USD','map','User\x20disconnected\x20successfully','510144JPYVHs','isVerified','shopId','amount','plisio','13545961BqZUUd','test_payout_123','sendBroadcast','params','all','custom','username','length','sendShopNotification','Shop\x20ID\x20is\x20required','telegramId','\x20notification\x20sent\x20successfully','query','Test\x20Product','63XmvMsn','completed','10lAreDJ','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','shop','getBotInfo','sendCustomNotification','telegramBotService','47gMUQMz','isActive','true','filter','getBotStatus','sendPaymentNotification','9QIMqeZ','paid','defineProperty','count','Test\x20','title','489320OvKGUX','lastName'];a12_0x22a9=function(){return _0x236c4d;};return a12_0x22a9();}class TelegramController{constructor(){const _0x159851=a12_0x21bf14;this[_0x159851(0x172)]=async(_0x5a7342,_0x3c32e9,_0x3b149f)=>{const _0x5818c0=_0x159851;try{const _0x46770a=telegramBotService_1['telegramBotService'][_0x5818c0(0x16b)](),_0x51ba45=await database_1[_0x5818c0(0x141)][_0x5818c0(0x139)][_0x5818c0(0x177)](),_0x2d0512=await database_1[_0x5818c0(0x141)][_0x5818c0(0x139)][_0x5818c0(0x177)]({'where':{'isVerified':!![]}}),_0x321f5a=await database_1[_0x5818c0(0x141)]['telegramUser'][_0x5818c0(0x146)]({'by':[_0x5818c0(0x155)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3c32e9['json']({'success':!![],'result':{'bot':{'isActive':_0x46770a[_0x5818c0(0x16f)],'username':_0x46770a[_0x5818c0(0x15e)]},'statistics':{'totalUsers':_0x51ba45,'verifiedUsers':_0x2d0512,'unverifiedUsers':_0x51ba45-_0x2d0512,'connectedShops':_0x321f5a[_0x5818c0(0x15f)]}}});}catch(_0x5de905){_0x3b149f(_0x5de905);}},this[_0x159851(0x13c)]=async(_0x24dda1,_0x525c58,_0x50b9b5)=>{const _0x491ae3=_0x159851;try{const {page:page=0x1,limit:limit=0x14,verified:_0x29f68b}=_0x24dda1[_0x491ae3(0x164)],_0x4a6de0=(Number(page)-0x1)*Number(limit),_0x1b479b={};_0x29f68b!==undefined&&(_0x1b479b[_0x491ae3(0x154)]=_0x29f68b===_0x491ae3(0x170));const [_0x32a0fc,_0x92f22c]=await Promise[_0x491ae3(0x15c)]([database_1[_0x491ae3(0x141)][_0x491ae3(0x139)]['findMany']({'where':_0x1b479b,'skip':_0x4a6de0,'take':Number(limit),'orderBy':{'createdAt':_0x491ae3(0x134)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x491ae3(0x141)]['telegramUser'][_0x491ae3(0x177)]({'where':_0x1b479b})]);_0x525c58[_0x491ae3(0x144)]({'success':!![],'users':_0x32a0fc[_0x491ae3(0x151)](_0x33f913=>({'id':_0x33f913['id'],'telegramId':_0x33f913[_0x491ae3(0x162)],'username':_0x33f913[_0x491ae3(0x15e)],'firstName':_0x33f913[_0x491ae3(0x14f)],'lastName':_0x33f913[_0x491ae3(0x17b)],'isVerified':_0x33f913[_0x491ae3(0x154)],'shop':_0x33f913[_0x491ae3(0x16a)],'createdAt':_0x33f913[_0x491ae3(0x142)],'updatedAt':_0x33f913['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x92f22c,'totalPages':Math['ceil'](_0x92f22c/Number(limit))}});}catch(_0x35783f){_0x50b9b5(_0x35783f);}},this[_0x159851(0x15a)]=async(_0x408603,_0x362909,_0x3bd2e4)=>{const _0x49d85c=_0x159851;try{const {message:_0x2dddb9,shopId:_0x1a3faa}=_0x408603[_0x49d85c(0x138)];if(!_0x2dddb9)return _0x362909[_0x49d85c(0x14d)](0x190)['json']({'success':![],'message':'Message\x20is\x20required'});if(_0x1a3faa)await telegramBotService_1['telegramBotService'][_0x49d85c(0x160)](_0x1a3faa,_0x2dddb9,{'parse_mode':'Markdown'});else{const _0x21d7df=await database_1[_0x49d85c(0x141)][_0x49d85c(0x139)][_0x49d85c(0x140)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x29be0b=[...new Set(_0x21d7df[_0x49d85c(0x151)](_0x1fff12=>_0x1fff12[_0x49d85c(0x155)])[_0x49d85c(0x171)](Boolean))];for(const _0x807422 of _0x29be0b){_0x807422&&await telegramBotService_1[_0x49d85c(0x16d)][_0x49d85c(0x160)](_0x807422,_0x2dddb9,{'parse_mode':'Markdown'});}}_0x362909[_0x49d85c(0x144)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x31775d){_0x3bd2e4(_0x31775d);}},this[_0x159851(0x13e)]=async(_0x3a775d,_0x11992d,_0x354b30)=>{const _0x8f2c9a=_0x159851;try{const {telegramId:_0x2a064a}=_0x3a775d[_0x8f2c9a(0x15b)],_0x2570f4=await database_1[_0x8f2c9a(0x141)][_0x8f2c9a(0x139)][_0x8f2c9a(0x135)]({'where':{'telegramId':_0x2a064a},'include':{'shop':!![]}});if(!_0x2570f4)return _0x11992d[_0x8f2c9a(0x14d)](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x8f2c9a(0x139)][_0x8f2c9a(0x14e)]({'where':{'telegramId':_0x2a064a},'data':{'shopId':null,'isVerified':![]}}),_0x11992d['json']({'success':!![],'message':_0x8f2c9a(0x152)});}catch(_0x1663a6){_0x354b30(_0x1663a6);}},this[_0x159851(0x13b)]=async(_0x45887a,_0x1ef5f3,_0x437ff4)=>{const _0x19e68e=_0x159851;try{const {shopId:_0x2327ee,type:type='payment',testData:_0x2a5f4a}=_0x45887a['body'];if(!_0x2327ee)return _0x1ef5f3['status'](0x190)[_0x19e68e(0x144)]({'success':![],'message':_0x19e68e(0x161)});const _0x470896=await database_1['default'][_0x19e68e(0x16a)][_0x19e68e(0x135)]({'where':{'id':_0x2327ee},'select':{'id':!![],'name':!![]}});if(!_0x470896)return _0x1ef5f3[_0x19e68e(0x14d)](0x194)[_0x19e68e(0x144)]({'success':![],'message':_0x19e68e(0x13d)});switch(type){case'payment':const _0x23418e={'id':'test_payment_123','amount':_0x2a5f4a?.[_0x19e68e(0x156)]||0x64,'currency':_0x2a5f4a?.[_0x19e68e(0x145)]||_0x19e68e(0x150),'productName':_0x2a5f4a?.[_0x19e68e(0x17c)]||_0x19e68e(0x165),'gateway':_0x2a5f4a?.[_0x19e68e(0x143)]||_0x19e68e(0x157),'createdAt':new Date(),..._0x2a5f4a};await telegramBotService_1[_0x19e68e(0x16d)][_0x19e68e(0x173)](_0x2327ee,_0x23418e,_0x19e68e(0x175));break;case'payout':const _0x49bb3d={'id':_0x19e68e(0x159),'amount':_0x2a5f4a?.['amount']||0x1f4,'method':_0x2a5f4a?.[_0x19e68e(0x148)]||'bank_transfer','createdAt':new Date(),..._0x2a5f4a};await telegramBotService_1[_0x19e68e(0x16d)][_0x19e68e(0x147)](_0x2327ee,_0x49bb3d,_0x19e68e(0x167));break;case _0x19e68e(0x15d):await telegramBotService_1[_0x19e68e(0x16d)][_0x19e68e(0x16c)](_0x2327ee,_0x2a5f4a?.[_0x19e68e(0x179)]||_0x19e68e(0x137),_0x2a5f4a?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x1ef5f3[_0x19e68e(0x14d)](0x190)[_0x19e68e(0x144)]({'success':![],'message':_0x19e68e(0x169)});}_0x1ef5f3[_0x19e68e(0x144)]({'success':!![],'message':_0x19e68e(0x178)+type+_0x19e68e(0x163)});}catch(_0x3eaa63){_0x437ff4(_0x3eaa63);}};}}exports[a12_0x21bf14(0x13a)]=TelegramController;