'use strict';const a12_0x5947eb=a12_0x4aa1;(function(_0x429712,_0x2cc521){const _0x3630bb=a12_0x4aa1,_0x40a156=_0x429712();while(!![]){try{const _0x113c43=-parseInt(_0x3630bb(0xec))/0x1+parseInt(_0x3630bb(0xf1))/0x2*(parseInt(_0x3630bb(0xe0))/0x3)+-parseInt(_0x3630bb(0xfd))/0x4*(parseInt(_0x3630bb(0x108))/0x5)+-parseInt(_0x3630bb(0xc8))/0x6+parseInt(_0x3630bb(0x103))/0x7+parseInt(_0x3630bb(0xcb))/0x8+parseInt(_0x3630bb(0xcd))/0x9*(parseInt(_0x3630bb(0xd1))/0xa);if(_0x113c43===_0x2cc521)break;else _0x40a156['push'](_0x40a156['shift']());}catch(_0x407220){_0x40a156['push'](_0x40a156['shift']());}}}(a12_0x21de,0x62a65));var __importDefault=this&&this[a12_0x5947eb(0xd2)]||function(_0x4f6ad3){return _0x4f6ad3&&_0x4f6ad3['__esModule']?_0x4f6ad3:{'default':_0x4f6ad3};};function a12_0x4aa1(_0x40793a,_0xd9af41){const _0x21dec3=a12_0x21de();return a12_0x4aa1=function(_0x4aa1c9,_0x24c672){_0x4aa1c9=_0x4aa1c9-0xc3;let _0x35f9e9=_0x21dec3[_0x4aa1c9];return _0x35f9e9;},a12_0x4aa1(_0x40793a,_0xd9af41);}Object[a12_0x5947eb(0xdd)](exports,a12_0x5947eb(0xcc),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x5947eb(0x102)),database_1=__importDefault(require(a12_0x5947eb(0x101)));class TelegramController{constructor(){const _0x5d5950=a12_0x5947eb;this[_0x5d5950(0xe8)]=async(_0x2a5fff,_0x3f2c0c,_0x53c86d)=>{const _0x31dac1=_0x5d5950;try{const _0x5a019c=telegramBotService_1[_0x31dac1(0xe4)][_0x31dac1(0xfb)](),_0x19c56f=await database_1[_0x31dac1(0xc3)][_0x31dac1(0xce)][_0x31dac1(0xc6)](),_0x7609e8=await database_1[_0x31dac1(0xc3)]['telegramUser'][_0x31dac1(0xc6)]({'where':{'isVerified':!![]}}),_0x49382d=await database_1[_0x31dac1(0xc3)][_0x31dac1(0xce)][_0x31dac1(0xc5)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3f2c0c[_0x31dac1(0xdb)]({'success':!![],'result':{'bot':{'isActive':_0x5a019c[_0x31dac1(0xde)],'username':_0x5a019c[_0x31dac1(0xd7)]},'statistics':{'totalUsers':_0x19c56f,'verifiedUsers':_0x7609e8,'unverifiedUsers':_0x19c56f-_0x7609e8,'connectedShops':_0x49382d['length']}}});}catch(_0x47477d){_0x53c86d(_0x47477d);}},this[_0x5d5950(0xf7)]=async(_0x1346a5,_0x5082e1,_0x4f70cb)=>{const _0x4127b8=_0x5d5950;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1054bf}=_0x1346a5[_0x4127b8(0xd5)],_0x1247cc=(Number(page)-0x1)*Number(limit),_0x406061={};_0x1054bf!==undefined&&(_0x406061[_0x4127b8(0xcf)]=_0x1054bf===_0x4127b8(0xf5));const [_0x3a4e09,_0xf8e9b1]=await Promise[_0x4127b8(0x106)]([database_1['default'][_0x4127b8(0xce)][_0x4127b8(0xd9)]({'where':_0x406061,'skip':_0x1247cc,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['telegramUser'][_0x4127b8(0xc6)]({'where':_0x406061})]);_0x5082e1['json']({'success':!![],'users':_0x3a4e09[_0x4127b8(0xfc)](_0x24b5a8=>({'id':_0x24b5a8['id'],'telegramId':_0x24b5a8['telegramId'],'username':_0x24b5a8['username'],'firstName':_0x24b5a8[_0x4127b8(0xea)],'lastName':_0x24b5a8[_0x4127b8(0xd8)],'isVerified':_0x24b5a8[_0x4127b8(0xcf)],'shop':_0x24b5a8[_0x4127b8(0x107)],'createdAt':_0x24b5a8[_0x4127b8(0xdf)],'updatedAt':_0x24b5a8['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xf8e9b1,'totalPages':Math[_0x4127b8(0xe5)](_0xf8e9b1/Number(limit))}});}catch(_0x355fa5){_0x4f70cb(_0x355fa5);}},this[_0x5d5950(0xd0)]=async(_0xbef139,_0x872db,_0x2b1844)=>{const _0x427899=_0x5d5950;try{const {message:_0x5e651c,shopId:_0x2b72e5}=_0xbef139[_0x427899(0xc7)];if(!_0x5e651c)return _0x872db[_0x427899(0x104)](0x190)[_0x427899(0xdb)]({'success':![],'message':_0x427899(0xef)});if(_0x2b72e5)await telegramBotService_1[_0x427899(0xe4)][_0x427899(0xe9)](_0x2b72e5,_0x5e651c,{'parse_mode':_0x427899(0xed)});else{const _0x46fa46=await database_1[_0x427899(0xc3)][_0x427899(0xce)][_0x427899(0xd9)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x46433f=[...new Set(_0x46fa46['map'](_0x52f3af=>_0x52f3af[_0x427899(0xf8)])[_0x427899(0xeb)](Boolean))];for(const _0x29cf60 of _0x46433f){_0x29cf60&&await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x29cf60,_0x5e651c,{'parse_mode':_0x427899(0xed)});}}_0x872db[_0x427899(0xdb)]({'success':!![],'message':_0x427899(0xfa)});}catch(_0x12703d){_0x2b1844(_0x12703d);}},this[_0x5d5950(0xf3)]=async(_0x3d6da2,_0xd3d15a,_0x117a89)=>{const _0x306626=_0x5d5950;try{const {telegramId:_0x2a23c0}=_0x3d6da2[_0x306626(0xf0)],_0x5a9d89=await database_1[_0x306626(0xc3)][_0x306626(0xce)]['findUnique']({'where':{'telegramId':_0x2a23c0},'include':{'shop':!![]}});if(!_0x5a9d89)return _0xd3d15a[_0x306626(0x104)](0x194)[_0x306626(0xdb)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x306626(0xce)][_0x306626(0xee)]({'where':{'telegramId':_0x2a23c0},'data':{'shopId':null,'isVerified':![]}}),_0xd3d15a[_0x306626(0xdb)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x304128){_0x117a89(_0x304128);}},this['sendTestNotification']=async(_0x39ea40,_0x21b7a0,_0x17c502)=>{const _0x549fa7=_0x5d5950;try{const {shopId:_0x343242,type:type=_0x549fa7(0xd3),testData:_0x349740}=_0x39ea40[_0x549fa7(0xc7)];if(!_0x343242)return _0x21b7a0[_0x549fa7(0x104)](0x190)['json']({'success':![],'message':_0x549fa7(0xdc)});const _0x4fdf06=await database_1[_0x549fa7(0xc3)][_0x549fa7(0x107)]['findUnique']({'where':{'id':_0x343242},'select':{'id':!![],'name':!![]}});if(!_0x4fdf06)return _0x21b7a0[_0x549fa7(0x104)](0x194)[_0x549fa7(0xdb)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x549fa7(0xd3):const _0x3bb040={'id':_0x549fa7(0xf2),'amount':_0x349740?.[_0x549fa7(0xfe)]||0x64,'currency':_0x349740?.['currency']||'USD','productName':_0x349740?.['productName']||'Test\x20Product','gateway':_0x349740?.[_0x549fa7(0xf6)]||_0x549fa7(0xe7),'createdAt':new Date(),..._0x349740};await telegramBotService_1['telegramBotService'][_0x549fa7(0xe6)](_0x343242,_0x3bb040,_0x549fa7(0xe3));break;case _0x549fa7(0xff):const _0x42c74e={'id':_0x549fa7(0xca),'amount':_0x349740?.[_0x549fa7(0xfe)]||0x1f4,'method':_0x349740?.[_0x549fa7(0xe2)]||_0x549fa7(0xc9),'createdAt':new Date(),..._0x349740};await telegramBotService_1[_0x549fa7(0xe4)]['sendPayoutNotification'](_0x343242,_0x42c74e,'completed');break;case _0x549fa7(0xda):await telegramBotService_1[_0x549fa7(0xe4)][_0x549fa7(0xd6)](_0x343242,_0x349740?.[_0x549fa7(0xe1)]||_0x549fa7(0xf9),_0x349740?.[_0x549fa7(0xf4)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x21b7a0[_0x549fa7(0x104)](0x190)[_0x549fa7(0xdb)]({'success':![],'message':_0x549fa7(0xd4)});}_0x21b7a0[_0x549fa7(0xdb)]({'success':!![],'message':_0x549fa7(0xc4)+type+_0x549fa7(0x100)});}catch(_0x48a8dc){_0x17c502(_0x48a8dc);}};}}function a12_0x21de(){const _0xa5d92a=['Message\x20is\x20required','params','22358mjnmOh','test_payment_123','disconnectUser','details','true','gateway','getTelegramUsers','shopId','Test\x20Notification','Broadcast\x20message\x20sent\x20successfully','getBotInfo','map','171768fLHmsN','amount','payout','\x20notification\x20sent\x20successfully','../config/database','../services/telegramBotService','1432081JmmtaJ','status','TelegramController','all','shop','35RyCrqo','default','Test\x20','groupBy','count','body','3557934bDWYtk','bank_transfer','test_payout_123','1066696TVclqJ','__esModule','27gThvYU','telegramUser','isVerified','sendBroadcast','4715160leaOyL','__importDefault','payment','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','query','sendCustomNotification','username','lastName','findMany','custom','json','Shop\x20ID\x20is\x20required','defineProperty','isActive','createdAt','21qStVQV','title','method','paid','telegramBotService','ceil','sendPaymentNotification','plisio','getBotStatus','sendShopNotification','firstName','filter','533069hdBJwE','Markdown','update'];a12_0x21de=function(){return _0xa5d92a;};return a12_0x21de();}exports[a12_0x5947eb(0x105)]=TelegramController;