'use strict';const a12_0x60f2ea=a12_0x551f;function a12_0x551f(_0x444ebb,_0x572a86){const _0x424fd5=a12_0x424f();return a12_0x551f=function(_0x551f0a,_0xb8c2a3){_0x551f0a=_0x551f0a-0x112;let _0x45afd5=_0x424fd5[_0x551f0a];return _0x45afd5;},a12_0x551f(_0x444ebb,_0x572a86);}(function(_0x19a8d6,_0x2b0bd9){const _0x309f43=a12_0x551f,_0xd1cab7=_0x19a8d6();while(!![]){try{const _0x218727=-parseInt(_0x309f43(0x114))/0x1*(parseInt(_0x309f43(0x118))/0x2)+parseInt(_0x309f43(0x127))/0x3+-parseInt(_0x309f43(0x149))/0x4*(-parseInt(_0x309f43(0x11b))/0x5)+parseInt(_0x309f43(0x125))/0x6*(-parseInt(_0x309f43(0x126))/0x7)+-parseInt(_0x309f43(0x145))/0x8*(parseInt(_0x309f43(0x123))/0x9)+-parseInt(_0x309f43(0x120))/0xa*(parseInt(_0x309f43(0x122))/0xb)+parseInt(_0x309f43(0x121))/0xc*(parseInt(_0x309f43(0x142))/0xd);if(_0x218727===_0x2b0bd9)break;else _0xd1cab7['push'](_0xd1cab7['shift']());}catch(_0x122c4e){_0xd1cab7['push'](_0xd1cab7['shift']());}}}(a12_0x424f,0xb9ef9));var __importDefault=this&&this[a12_0x60f2ea(0x14f)]||function(_0x55b751){return _0x55b751&&_0x55b751['__esModule']?_0x55b751:{'default':_0x55b751};};Object[a12_0x60f2ea(0x138)](exports,a12_0x60f2ea(0x11d),{'value':!![]}),exports[a12_0x60f2ea(0x11a)]=void 0x0;const telegramBotService_1=require(a12_0x60f2ea(0x135)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x1a39b5=a12_0x60f2ea;this[_0x1a39b5(0x13d)]=async(_0x51d650,_0x458db8,_0x4d7f78)=>{const _0xe98b11=_0x1a39b5;try{const _0x947b2b=telegramBotService_1[_0xe98b11(0x12c)][_0xe98b11(0x115)](),_0x519963=await database_1[_0xe98b11(0x14b)][_0xe98b11(0x147)][_0xe98b11(0x12a)](),_0x161c55=await database_1[_0xe98b11(0x14b)][_0xe98b11(0x147)]['count']({'where':{'isVerified':!![]}}),_0x1420f3=await database_1[_0xe98b11(0x14b)][_0xe98b11(0x147)][_0xe98b11(0x129)]({'by':[_0xe98b11(0x124)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x458db8[_0xe98b11(0x12b)]({'success':!![],'result':{'bot':{'isActive':_0x947b2b[_0xe98b11(0x112)],'username':_0x947b2b[_0xe98b11(0x133)]},'statistics':{'totalUsers':_0x519963,'verifiedUsers':_0x161c55,'unverifiedUsers':_0x519963-_0x161c55,'connectedShops':_0x1420f3['length']}}});}catch(_0x2ad379){_0x4d7f78(_0x2ad379);}},this['getTelegramUsers']=async(_0x45efaf,_0xa36602,_0x603872)=>{const _0x4b4023=_0x1a39b5;try{const {page:page=0x1,limit:limit=0x14,verified:_0x260ac1}=_0x45efaf[_0x4b4023(0x12e)],_0x5bad48=(Number(page)-0x1)*Number(limit),_0x35184d={};_0x260ac1!==undefined&&(_0x35184d[_0x4b4023(0x13f)]=_0x260ac1===_0x4b4023(0x14e));const [_0x4128b1,_0x5e6774]=await Promise['all']([database_1['default'][_0x4b4023(0x147)]['findMany']({'where':_0x35184d,'skip':_0x5bad48,'take':Number(limit),'orderBy':{'createdAt':_0x4b4023(0x141)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4b4023(0x14b)][_0x4b4023(0x147)][_0x4b4023(0x12a)]({'where':_0x35184d})]);_0xa36602[_0x4b4023(0x12b)]({'success':!![],'users':_0x4128b1['map'](_0x42e2e8=>({'id':_0x42e2e8['id'],'telegramId':_0x42e2e8['telegramId'],'username':_0x42e2e8['username'],'firstName':_0x42e2e8[_0x4b4023(0x144)],'lastName':_0x42e2e8[_0x4b4023(0x113)],'isVerified':_0x42e2e8[_0x4b4023(0x13f)],'shop':_0x42e2e8[_0x4b4023(0x139)],'createdAt':_0x42e2e8[_0x4b4023(0x150)],'updatedAt':_0x42e2e8['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5e6774,'totalPages':Math['ceil'](_0x5e6774/Number(limit))}});}catch(_0x111481){_0x603872(_0x111481);}},this[_0x1a39b5(0x152)]=async(_0x53a055,_0x25e20e,_0x1ac7d9)=>{const _0x4d164a=_0x1a39b5;try{const {message:_0x50e19a,shopId:_0x46d248}=_0x53a055[_0x4d164a(0x136)];if(!_0x50e19a)return _0x25e20e[_0x4d164a(0x143)](0x190)['json']({'success':![],'message':_0x4d164a(0x140)});if(_0x46d248)await telegramBotService_1[_0x4d164a(0x12c)][_0x4d164a(0x131)](_0x46d248,_0x50e19a,{'parse_mode':_0x4d164a(0x13a)});else{const _0x18dbdf=await database_1['default']['telegramUser'][_0x4d164a(0x12f)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xf9dda5=[...new Set(_0x18dbdf[_0x4d164a(0x156)](_0x310949=>_0x310949[_0x4d164a(0x124)])[_0x4d164a(0x13b)](Boolean))];for(const _0x1c0227 of _0xf9dda5){_0x1c0227&&await telegramBotService_1[_0x4d164a(0x12c)][_0x4d164a(0x131)](_0x1c0227,_0x50e19a,{'parse_mode':_0x4d164a(0x13a)});}}_0x25e20e[_0x4d164a(0x12b)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x10bc74){_0x1ac7d9(_0x10bc74);}},this['disconnectUser']=async(_0x5626fc,_0x98e32f,_0x25ec4a)=>{const _0x3d52df=_0x1a39b5;try{const {telegramId:_0x399c3e}=_0x5626fc['params'],_0x59d5d8=await database_1[_0x3d52df(0x14b)][_0x3d52df(0x147)][_0x3d52df(0x14a)]({'where':{'telegramId':_0x399c3e},'include':{'shop':!![]}});if(!_0x59d5d8)return _0x98e32f[_0x3d52df(0x143)](0x194)[_0x3d52df(0x12b)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x3d52df(0x14b)][_0x3d52df(0x147)]['update']({'where':{'telegramId':_0x399c3e},'data':{'shopId':null,'isVerified':![]}}),_0x98e32f[_0x3d52df(0x12b)]({'success':!![],'message':_0x3d52df(0x154)});}catch(_0x5377b6){_0x25ec4a(_0x5377b6);}},this['sendTestNotification']=async(_0x2a7fe4,_0x3b4777,_0x317fbc)=>{const _0x139dc2=_0x1a39b5;try{const {shopId:_0x2f3f8b,type:type=_0x139dc2(0x146),testData:_0x5193ef}=_0x2a7fe4[_0x139dc2(0x136)];if(!_0x2f3f8b)return _0x3b4777['status'](0x190)[_0x139dc2(0x12b)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x42d6a6=await database_1['default'][_0x139dc2(0x139)][_0x139dc2(0x14a)]({'where':{'id':_0x2f3f8b},'select':{'id':!![],'name':!![]}});if(!_0x42d6a6)return _0x3b4777[_0x139dc2(0x143)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x139dc2(0x146):const _0x4af06a={'id':_0x139dc2(0x155),'amount':_0x5193ef?.['amount']||0x64,'currency':_0x5193ef?.[_0x139dc2(0x116)]||'USD','productName':_0x5193ef?.[_0x139dc2(0x153)]||_0x139dc2(0x11f),'gateway':_0x5193ef?.[_0x139dc2(0x13c)]||_0x139dc2(0x151),'createdAt':new Date(),..._0x5193ef};await telegramBotService_1[_0x139dc2(0x12c)][_0x139dc2(0x11e)](_0x2f3f8b,_0x4af06a,_0x139dc2(0x119));break;case'payout':const _0x206ba7={'id':_0x139dc2(0x130),'amount':_0x5193ef?.[_0x139dc2(0x13e)]||0x1f4,'method':_0x5193ef?.[_0x139dc2(0x132)]||'bank_transfer','createdAt':new Date(),..._0x5193ef};await telegramBotService_1[_0x139dc2(0x12c)][_0x139dc2(0x134)](_0x2f3f8b,_0x206ba7,_0x139dc2(0x12d));break;case _0x139dc2(0x137):await telegramBotService_1[_0x139dc2(0x12c)][_0x139dc2(0x128)](_0x2f3f8b,_0x5193ef?.[_0x139dc2(0x148)]||'Test\x20Notification',_0x5193ef?.[_0x139dc2(0x11c)]||{'message':_0x139dc2(0x14d)});break;default:return _0x3b4777['status'](0x190)[_0x139dc2(0x12b)]({'success':![],'message':_0x139dc2(0x14c)});}_0x3b4777[_0x139dc2(0x12b)]({'success':!![],'message':'Test\x20'+type+_0x139dc2(0x117)});}catch(_0x4b087b){_0x317fbc(_0x4b087b);}};}}function a12_0x424f(){const _0x924f6f=['findMany','test_payout_123','sendShopNotification','method','username','sendPayoutNotification','../services/telegramBotService','body','custom','defineProperty','shop','Markdown','filter','gateway','getBotStatus','amount','isVerified','Message\x20is\x20required','desc','299Ghklvu','status','firstName','7456inBCHI','payment','telegramUser','title','200qfomzL','findUnique','default','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','This\x20is\x20a\x20test\x20notification','true','__importDefault','createdAt','plisio','sendBroadcast','productName','User\x20disconnected\x20successfully','test_payment_123','map','isActive','lastName','170snkEId','getBotInfo','currency','\x20notification\x20sent\x20successfully','696BbGHth','paid','TelegramController','90995SqHqne','details','__esModule','sendPaymentNotification','Test\x20Product','3220010sjLSZW','1156956DlliFs','44DGZltN','3258uRCXOm','shopId','654078tBSGwM','63NSdAUA','899427lRBFQM','sendCustomNotification','groupBy','count','json','telegramBotService','completed','query'];a12_0x424f=function(){return _0x924f6f;};return a12_0x424f();}exports[a12_0x60f2ea(0x11a)]=TelegramController;