'use strict';const a12_0x58ddfb=a12_0x236c;(function(_0x39c5d4,_0x1819e7){const _0xbdf5ba=a12_0x236c,_0x55ffe6=_0x39c5d4();while(!![]){try{const _0x444843=parseInt(_0xbdf5ba(0x16a))/0x1+parseInt(_0xbdf5ba(0x17a))/0x2*(-parseInt(_0xbdf5ba(0x165))/0x3)+parseInt(_0xbdf5ba(0x154))/0x4+parseInt(_0xbdf5ba(0x166))/0x5*(-parseInt(_0xbdf5ba(0x143))/0x6)+parseInt(_0xbdf5ba(0x160))/0x7*(parseInt(_0xbdf5ba(0x180))/0x8)+parseInt(_0xbdf5ba(0x14c))/0x9*(parseInt(_0xbdf5ba(0x147))/0xa)+-parseInt(_0xbdf5ba(0x140))/0xb;if(_0x444843===_0x1819e7)break;else _0x55ffe6['push'](_0x55ffe6['shift']());}catch(_0xc8b356){_0x55ffe6['push'](_0x55ffe6['shift']());}}}(a12_0x218e,0xd63b2));function a12_0x236c(_0x41a9d5,_0x446a30){const _0x218ee1=a12_0x218e();return a12_0x236c=function(_0x236c99,_0x3e92a9){_0x236c99=_0x236c99-0x13f;let _0x37a98b=_0x218ee1[_0x236c99];return _0x37a98b;},a12_0x236c(_0x41a9d5,_0x446a30);}function a12_0x218e(){const _0x3776cf=['firstName','8153988iXODgC','status','updatedAt','test_payout_123','4329510AkDzse','groupBy','plisio','productName','payment','9ImnBZG','findUnique','map','../config/database','params','length','Broadcast\x20message\x20sent\x20successfully','details','4882092RiQdhF','TelegramController','Shop\x20ID\x20is\x20required','__importDefault','default','desc','getTelegramUsers','payout','currency','getBotStatus','update','bank_transfer','1073751RLoavo','username','USD','telegramBotService','Shop\x20not\x20found','3oewhJg','5QUGMBR','findMany','count','Message\x20is\x20required','1677479iXGDfU','telegramId','defineProperty','Markdown','Test\x20Notification','paid','sendShopNotification','sendPaymentNotification','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','true','getBotInfo','createdAt','json','sendPayoutNotification','telegramUser','ceil','860138aTGSoE','filter','body','shopId','method','completed','56OsKPar','sendTestNotification','sendCustomNotification','../services/telegramBotService','This\x20is\x20a\x20test\x20notification','custom','isVerified','amount','gateway','__esModule','Test\x20Product','19119617MTLiCf','isActive'];a12_0x218e=function(){return _0x3776cf;};return a12_0x218e();}var __importDefault=this&&this[a12_0x58ddfb(0x157)]||function(_0x2058c7){const _0x26c756=a12_0x58ddfb;return _0x2058c7&&_0x2058c7[_0x26c756(0x189)]?_0x2058c7:{'default':_0x2058c7};};Object[a12_0x58ddfb(0x16c)](exports,'__esModule',{'value':!![]}),exports[a12_0x58ddfb(0x155)]=void 0x0;const telegramBotService_1=require(a12_0x58ddfb(0x183)),database_1=__importDefault(require(a12_0x58ddfb(0x14f)));class TelegramController{constructor(){const _0x55c277=a12_0x58ddfb;this[_0x55c277(0x15d)]=async(_0x99bf90,_0x34e2e9,_0x65821c)=>{const _0x4a7124=_0x55c277;try{const _0x2398ba=telegramBotService_1[_0x4a7124(0x163)][_0x4a7124(0x174)](),_0x1d0e6b=await database_1['default'][_0x4a7124(0x178)][_0x4a7124(0x168)](),_0xd18fa0=await database_1['default'][_0x4a7124(0x178)]['count']({'where':{'isVerified':!![]}}),_0x3c6087=await database_1[_0x4a7124(0x158)]['telegramUser'][_0x4a7124(0x148)]({'by':[_0x4a7124(0x17d)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x34e2e9['json']({'success':!![],'result':{'bot':{'isActive':_0x2398ba[_0x4a7124(0x141)],'username':_0x2398ba[_0x4a7124(0x161)]},'statistics':{'totalUsers':_0x1d0e6b,'verifiedUsers':_0xd18fa0,'unverifiedUsers':_0x1d0e6b-_0xd18fa0,'connectedShops':_0x3c6087[_0x4a7124(0x151)]}}});}catch(_0x1dc5f8){_0x65821c(_0x1dc5f8);}},this[_0x55c277(0x15a)]=async(_0x5c4cc1,_0x4645a6,_0x5ad993)=>{const _0xf07f61=_0x55c277;try{const {page:page=0x1,limit:limit=0x14,verified:_0x8f8854}=_0x5c4cc1['query'],_0x3aca4d=(Number(page)-0x1)*Number(limit),_0x500814={};_0x8f8854!==undefined&&(_0x500814[_0xf07f61(0x186)]=_0x8f8854===_0xf07f61(0x173));const [_0xa6aa75,_0x48e282]=await Promise['all']([database_1[_0xf07f61(0x158)][_0xf07f61(0x178)][_0xf07f61(0x167)]({'where':_0x500814,'skip':_0x3aca4d,'take':Number(limit),'orderBy':{'createdAt':_0xf07f61(0x159)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0xf07f61(0x158)]['telegramUser'][_0xf07f61(0x168)]({'where':_0x500814})]);_0x4645a6[_0xf07f61(0x176)]({'success':!![],'users':_0xa6aa75[_0xf07f61(0x14e)](_0x2f5d68=>({'id':_0x2f5d68['id'],'telegramId':_0x2f5d68[_0xf07f61(0x16b)],'username':_0x2f5d68[_0xf07f61(0x161)],'firstName':_0x2f5d68[_0xf07f61(0x142)],'lastName':_0x2f5d68['lastName'],'isVerified':_0x2f5d68[_0xf07f61(0x186)],'shop':_0x2f5d68['shop'],'createdAt':_0x2f5d68[_0xf07f61(0x175)],'updatedAt':_0x2f5d68[_0xf07f61(0x145)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x48e282,'totalPages':Math[_0xf07f61(0x179)](_0x48e282/Number(limit))}});}catch(_0x32a550){_0x5ad993(_0x32a550);}},this['sendBroadcast']=async(_0x30398c,_0x4d1d2e,_0x58d72c)=>{const _0x358af0=_0x55c277;try{const {message:_0x3df178,shopId:_0x117051}=_0x30398c[_0x358af0(0x17c)];if(!_0x3df178)return _0x4d1d2e[_0x358af0(0x144)](0x190)['json']({'success':![],'message':_0x358af0(0x169)});if(_0x117051)await telegramBotService_1['telegramBotService'][_0x358af0(0x170)](_0x117051,_0x3df178,{'parse_mode':_0x358af0(0x16d)});else{const _0x3763a7=await database_1[_0x358af0(0x158)][_0x358af0(0x178)][_0x358af0(0x167)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x32894f=[...new Set(_0x3763a7[_0x358af0(0x14e)](_0x211c6b=>_0x211c6b['shopId'])[_0x358af0(0x17b)](Boolean))];for(const _0x1852af of _0x32894f){_0x1852af&&await telegramBotService_1[_0x358af0(0x163)][_0x358af0(0x170)](_0x1852af,_0x3df178,{'parse_mode':_0x358af0(0x16d)});}}_0x4d1d2e[_0x358af0(0x176)]({'success':!![],'message':_0x358af0(0x152)});}catch(_0x2c40eb){_0x58d72c(_0x2c40eb);}},this['disconnectUser']=async(_0x52db5c,_0x12fd0f,_0x1b8e22)=>{const _0x2c13fe=_0x55c277;try{const {telegramId:_0x260858}=_0x52db5c[_0x2c13fe(0x150)],_0x42e9d8=await database_1[_0x2c13fe(0x158)]['telegramUser'][_0x2c13fe(0x14d)]({'where':{'telegramId':_0x260858},'include':{'shop':!![]}});if(!_0x42e9d8)return _0x12fd0f[_0x2c13fe(0x144)](0x194)[_0x2c13fe(0x176)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x2c13fe(0x178)][_0x2c13fe(0x15e)]({'where':{'telegramId':_0x260858},'data':{'shopId':null,'isVerified':![]}}),_0x12fd0f[_0x2c13fe(0x176)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x309d03){_0x1b8e22(_0x309d03);}},this[_0x55c277(0x181)]=async(_0x389549,_0x4125fc,_0x7d273e)=>{const _0x5e46b5=_0x55c277;try{const {shopId:_0x3ac96b,type:type=_0x5e46b5(0x14b),testData:_0xc54b02}=_0x389549[_0x5e46b5(0x17c)];if(!_0x3ac96b)return _0x4125fc[_0x5e46b5(0x144)](0x190)[_0x5e46b5(0x176)]({'success':![],'message':_0x5e46b5(0x156)});const _0x4622ba=await database_1[_0x5e46b5(0x158)]['shop'][_0x5e46b5(0x14d)]({'where':{'id':_0x3ac96b},'select':{'id':!![],'name':!![]}});if(!_0x4622ba)return _0x4125fc['status'](0x194)['json']({'success':![],'message':_0x5e46b5(0x164)});switch(type){case _0x5e46b5(0x14b):const _0x1f8a54={'id':'test_payment_123','amount':_0xc54b02?.[_0x5e46b5(0x187)]||0x64,'currency':_0xc54b02?.[_0x5e46b5(0x15c)]||_0x5e46b5(0x162),'productName':_0xc54b02?.[_0x5e46b5(0x14a)]||_0x5e46b5(0x13f),'gateway':_0xc54b02?.[_0x5e46b5(0x188)]||_0x5e46b5(0x149),'createdAt':new Date(),..._0xc54b02};await telegramBotService_1[_0x5e46b5(0x163)][_0x5e46b5(0x171)](_0x3ac96b,_0x1f8a54,_0x5e46b5(0x16f));break;case _0x5e46b5(0x15b):const _0x16b0ef={'id':_0x5e46b5(0x146),'amount':_0xc54b02?.[_0x5e46b5(0x187)]||0x1f4,'method':_0xc54b02?.[_0x5e46b5(0x17e)]||_0x5e46b5(0x15f),'createdAt':new Date(),..._0xc54b02};await telegramBotService_1[_0x5e46b5(0x163)][_0x5e46b5(0x177)](_0x3ac96b,_0x16b0ef,_0x5e46b5(0x17f));break;case _0x5e46b5(0x185):await telegramBotService_1[_0x5e46b5(0x163)][_0x5e46b5(0x182)](_0x3ac96b,_0xc54b02?.['title']||_0x5e46b5(0x16e),_0xc54b02?.[_0x5e46b5(0x153)]||{'message':_0x5e46b5(0x184)});break;default:return _0x4125fc[_0x5e46b5(0x144)](0x190)['json']({'success':![],'message':_0x5e46b5(0x172)});}_0x4125fc[_0x5e46b5(0x176)]({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x17d1d0){_0x7d273e(_0x17d1d0);}};}}exports[a12_0x58ddfb(0x155)]=TelegramController;