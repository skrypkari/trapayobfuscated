'use strict';const a17_0x3caacc=a17_0x3c26;(function(_0x31d5ee,_0x2fa893){const _0x3a7801=a17_0x3c26,_0x1387e9=_0x31d5ee();while(!![]){try{const _0x30546e=-parseInt(_0x3a7801(0xd2))/0x1+-parseInt(_0x3a7801(0xb1))/0x2+parseInt(_0x3a7801(0xc8))/0x3*(-parseInt(_0x3a7801(0xb9))/0x4)+-parseInt(_0x3a7801(0xcf))/0x5+parseInt(_0x3a7801(0xbe))/0x6+parseInt(_0x3a7801(0xda))/0x7+parseInt(_0x3a7801(0xee))/0x8;if(_0x30546e===_0x2fa893)break;else _0x1387e9['push'](_0x1387e9['shift']());}catch(_0x51346e){_0x1387e9['push'](_0x1387e9['shift']());}}}(a17_0x4102,0x76ff7));var __importDefault=this&&this['__importDefault']||function(_0x451b8c){const _0x2b9286=a17_0x3c26;return _0x451b8c&&_0x451b8c[_0x2b9286(0xd1)]?_0x451b8c:{'default':_0x451b8c};};Object[a17_0x3caacc(0xd6)](exports,a17_0x3caacc(0xd1),{'value':!![]}),exports[a17_0x3caacc(0xe8)]=void 0x0;function a17_0x4102(){const _0x4fde56=['telegramBotService','Test\x20Notification','query','findUnique','txid','TelegramController','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','desc','isActive','TRC20','length','8803368PNPPWg','shop','true','body','Shop\x20ID\x20is\x20required','gateway','payment','shopId','all','count','groupBy','Message\x20is\x20required','Telegram\x20user\x20not\x20found','61304bDpimJ','../config/database','firstName','status','username','This\x20is\x20a\x20test\x20notification','productName','params','85328CWePUA','Тестовый\x20период','createdAt','disconnectUser','sendShopNotification','2171142QbbniP','Markdown','currency','isVerified','telegramId','\x20notification\x20sent\x20successfully','ceil','updatedAt','getBotInfo','test_payment_123','33rPfAhy','default','sendPaymentNotification','Shop\x20not\x20found','map','telegramUser','getBotStatus','3866465oFhxSY','Test\x20','__esModule','875749iObOgq','update','lastName','test_payout_123','defineProperty','payout','User\x20disconnected\x20successfully','USD','6576381FkMGBf','json','title','details','../services/telegramBotService','amount','getTelegramUsers','sendPayoutNotification','Broadcast\x20message\x20sent\x20successfully'];a17_0x4102=function(){return _0x4fde56;};return a17_0x4102();}const telegramBotService_1=require(a17_0x3caacc(0xde)),database_1=__importDefault(require(a17_0x3caacc(0xb2)));function a17_0x3c26(_0x283cf3,_0x503a99){_0x283cf3=_0x283cf3-0xa6;const _0x41027a=a17_0x4102();let _0x3c269b=_0x41027a[_0x283cf3];return _0x3c269b;}class TelegramController{constructor(){const _0x358329=a17_0x3caacc;this[_0x358329(0xce)]=async(_0x5b7ba1,_0xa16205,_0x457207)=>{const _0x20a46c=_0x358329;try{const _0x286773=telegramBotService_1['telegramBotService'][_0x20a46c(0xc6)](),_0x3d824e=await database_1[_0x20a46c(0xc9)][_0x20a46c(0xcd)][_0x20a46c(0xad)](),_0x5eed70=await database_1[_0x20a46c(0xc9)][_0x20a46c(0xcd)][_0x20a46c(0xad)]({'where':{'isVerified':!![]}}),_0x226ecc=await database_1[_0x20a46c(0xc9)][_0x20a46c(0xcd)][_0x20a46c(0xae)]({'by':[_0x20a46c(0xab)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xa16205[_0x20a46c(0xdb)]({'success':!![],'result':{'bot':{'isActive':_0x286773[_0x20a46c(0xeb)],'username':_0x286773[_0x20a46c(0xb5)]},'statistics':{'totalUsers':_0x3d824e,'verifiedUsers':_0x5eed70,'unverifiedUsers':_0x3d824e-_0x5eed70,'connectedShops':_0x226ecc[_0x20a46c(0xed)]}}});}catch(_0x41797e){_0x457207(_0x41797e);}},this[_0x358329(0xe0)]=async(_0x421933,_0x33363d,_0x195ff9)=>{const _0x3590f4=_0x358329;try{const {page:page=0x1,limit:limit=0x14,verified:_0xa24f39}=_0x421933[_0x3590f4(0xe5)],_0xf513ac=(Number(page)-0x1)*Number(limit),_0x123185={};_0xa24f39!==undefined&&(_0x123185[_0x3590f4(0xc1)]=_0xa24f39===_0x3590f4(0xa6));const [_0x3d4956,_0x26cf5e]=await Promise[_0x3590f4(0xac)]([database_1['default'][_0x3590f4(0xcd)]['findMany']({'where':_0x123185,'skip':_0xf513ac,'take':Number(limit),'orderBy':{'createdAt':_0x3590f4(0xea)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x3590f4(0xc9)]['telegramUser'][_0x3590f4(0xad)]({'where':_0x123185})]);_0x33363d[_0x3590f4(0xdb)]({'success':!![],'users':_0x3d4956[_0x3590f4(0xcc)](_0x434deb=>({'id':_0x434deb['id'],'telegramId':_0x434deb[_0x3590f4(0xc2)],'username':_0x434deb[_0x3590f4(0xb5)],'firstName':_0x434deb[_0x3590f4(0xb3)],'lastName':_0x434deb[_0x3590f4(0xd4)],'isVerified':_0x434deb[_0x3590f4(0xc1)],'shop':_0x434deb[_0x3590f4(0xef)],'createdAt':_0x434deb[_0x3590f4(0xbb)],'updatedAt':_0x434deb[_0x3590f4(0xc5)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x26cf5e,'totalPages':Math[_0x3590f4(0xc4)](_0x26cf5e/Number(limit))}});}catch(_0x405ba0){_0x195ff9(_0x405ba0);}},this['sendBroadcast']=async(_0x258d9e,_0x4c9b55,_0x4d150a)=>{const _0x944de1=_0x358329;try{const {message:_0x10bc96,shopId:_0x4cf5c9}=_0x258d9e[_0x944de1(0xa7)];if(!_0x10bc96)return _0x4c9b55[_0x944de1(0xb4)](0x190)[_0x944de1(0xdb)]({'success':![],'message':_0x944de1(0xaf)});if(_0x4cf5c9)await telegramBotService_1['telegramBotService'][_0x944de1(0xbd)](_0x4cf5c9,_0x10bc96,{'parse_mode':_0x944de1(0xbf)});else{const _0x2f615f=await database_1[_0x944de1(0xc9)]['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5057d6=[...new Set(_0x2f615f[_0x944de1(0xcc)](_0x403372=>_0x403372['shopId'])['filter'](Boolean))];for(const _0x21cb50 of _0x5057d6){_0x21cb50&&await telegramBotService_1[_0x944de1(0xe3)][_0x944de1(0xbd)](_0x21cb50,_0x10bc96,{'parse_mode':_0x944de1(0xbf)});}}_0x4c9b55[_0x944de1(0xdb)]({'success':!![],'message':_0x944de1(0xe2)});}catch(_0x26d68e){_0x4d150a(_0x26d68e);}},this[_0x358329(0xbc)]=async(_0x4983c1,_0x2585a5,_0x3d2645)=>{const _0x5dd5a6=_0x358329;try{const {telegramId:_0x157eda}=_0x4983c1[_0x5dd5a6(0xb8)],_0x531a28=await database_1[_0x5dd5a6(0xc9)]['telegramUser'][_0x5dd5a6(0xe6)]({'where':{'telegramId':_0x157eda},'include':{'shop':!![]}});if(!_0x531a28)return _0x2585a5['status'](0x194)[_0x5dd5a6(0xdb)]({'success':![],'message':_0x5dd5a6(0xb0)});await database_1[_0x5dd5a6(0xc9)][_0x5dd5a6(0xcd)][_0x5dd5a6(0xd3)]({'where':{'telegramId':_0x157eda},'data':{'shopId':null,'isVerified':![]}}),_0x2585a5[_0x5dd5a6(0xdb)]({'success':!![],'message':_0x5dd5a6(0xd8)});}catch(_0x511c66){_0x3d2645(_0x511c66);}},this['sendTestNotification']=async(_0xed3256,_0x3a05ea,_0x4f5691)=>{const _0x295472=_0x358329;try{const {shopId:_0x456ed7,type:type='payment',testData:_0x4618c9}=_0xed3256[_0x295472(0xa7)];if(!_0x456ed7)return _0x3a05ea[_0x295472(0xb4)](0x190)[_0x295472(0xdb)]({'success':![],'message':_0x295472(0xa8)});const _0x1f7618=await database_1[_0x295472(0xc9)][_0x295472(0xef)][_0x295472(0xe6)]({'where':{'id':_0x456ed7},'select':{'id':!![],'name':!![]}});if(!_0x1f7618)return _0x3a05ea['status'](0x194)['json']({'success':![],'message':_0x295472(0xcb)});switch(type){case _0x295472(0xaa):const _0x50c1d4={'id':_0x295472(0xc7),'amount':_0x4618c9?.[_0x295472(0xdf)]||0x64,'currency':_0x4618c9?.[_0x295472(0xc0)]||_0x295472(0xd9),'productName':_0x4618c9?.[_0x295472(0xb7)]||'Test\x20Product','gateway':_0x4618c9?.[_0x295472(0xa9)]||'plisio','createdAt':new Date(),..._0x4618c9};await telegramBotService_1[_0x295472(0xe3)][_0x295472(0xca)](_0x456ed7,_0x50c1d4,'paid');break;case _0x295472(0xd7):const _0x3daca6={'id':_0x295472(0xd5),'amount':_0x4618c9?.['amount']||0x1f4,'network':_0x4618c9?.['network']||_0x295472(0xec),'wallet':_0x4618c9?.['wallet']||_0x295472(0xe9),'period':_0x295472(0xba),'createdAt':new Date(),'txid':_0x4618c9?.[_0x295472(0xe7)]||null,..._0x4618c9};await telegramBotService_1[_0x295472(0xe3)][_0x295472(0xe1)](_0x456ed7,_0x3daca6);break;case'custom':await telegramBotService_1[_0x295472(0xe3)]['sendCustomNotification'](_0x456ed7,_0x4618c9?.[_0x295472(0xdc)]||_0x295472(0xe4),_0x4618c9?.[_0x295472(0xdd)]||{'message':_0x295472(0xb6)});break;default:return _0x3a05ea[_0x295472(0xb4)](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x3a05ea['json']({'success':!![],'message':_0x295472(0xd0)+type+_0x295472(0xc3)});}catch(_0x5c85e1){_0x4f5691(_0x5c85e1);}};}}exports[a17_0x3caacc(0xe8)]=TelegramController;