'use strict';const a12_0x4c0fd8=a12_0x28b6;(function(_0x42523e,_0x15420f){const _0x7282a7=a12_0x28b6,_0x35c4c0=_0x42523e();while(!![]){try{const _0x497969=parseInt(_0x7282a7(0x1ed))/0x1+-parseInt(_0x7282a7(0x1ea))/0x2*(parseInt(_0x7282a7(0x214))/0x3)+-parseInt(_0x7282a7(0x1fd))/0x4+-parseInt(_0x7282a7(0x1f0))/0x5*(parseInt(_0x7282a7(0x204))/0x6)+parseInt(_0x7282a7(0x1fc))/0x7*(-parseInt(_0x7282a7(0x1e5))/0x8)+parseInt(_0x7282a7(0x1ff))/0x9*(parseInt(_0x7282a7(0x1f5))/0xa)+parseInt(_0x7282a7(0x222))/0xb;if(_0x497969===_0x15420f)break;else _0x35c4c0['push'](_0x35c4c0['shift']());}catch(_0x43d701){_0x35c4c0['push'](_0x35c4c0['shift']());}}}(a12_0x3a25,0x5771b));function a12_0x3a25(){const _0x167e66=['filter','findUnique','bank_transfer','sendTestNotification','782590cYDHeb','Markdown','params','payment','update','currency','shop','49ijEbtB','1446508nnWQMt','title','54YvWvym','firstName','method','status','defineProperty','1563882yaAyox','getBotInfo','groupBy','amount','shopId','lastName','getBotStatus','sendPaymentNotification','../services/telegramBotService','default','test_payment_123','updatedAt','sendShopNotification','Test\x20Product','Shop\x20ID\x20is\x20required','isVerified','51ZOdWoM','length','Message\x20is\x20required','gateway','true','Telegram\x20user\x20not\x20found','sendBroadcast','findMany','TelegramController','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','isActive','telegramId','productName','details','7915193dfiyIu','telegramUser','Shop\x20not\x20found','__esModule','telegramBotService','map','ceil','201008Adowxn','query','body','test_payout_123','custom','50602PEnKbe','count','createdAt','657974YanpNb','getTelegramUsers','json','10ssXRuv'];a12_0x3a25=function(){return _0x167e66;};return a12_0x3a25();}var __importDefault=this&&this['__importDefault']||function(_0x489003){const _0x1779b4=a12_0x28b6;return _0x489003&&_0x489003[_0x1779b4(0x1e1)]?_0x489003:{'default':_0x489003};};Object[a12_0x4c0fd8(0x203)](exports,'__esModule',{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x4c0fd8(0x20c)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x2a6956=a12_0x4c0fd8;this[_0x2a6956(0x20a)]=async(_0x2b4af2,_0x4e5c87,_0x44345d)=>{const _0x2699bf=_0x2a6956;try{const _0x181268=telegramBotService_1[_0x2699bf(0x1e2)][_0x2699bf(0x205)](),_0x13f813=await database_1[_0x2699bf(0x20d)][_0x2699bf(0x223)][_0x2699bf(0x1eb)](),_0x352081=await database_1[_0x2699bf(0x20d)]['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x474279=await database_1[_0x2699bf(0x20d)][_0x2699bf(0x223)][_0x2699bf(0x206)]({'by':[_0x2699bf(0x208)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4e5c87[_0x2699bf(0x1ef)]({'success':!![],'result':{'bot':{'isActive':_0x181268[_0x2699bf(0x21e)],'username':_0x181268['username']},'statistics':{'totalUsers':_0x13f813,'verifiedUsers':_0x352081,'unverifiedUsers':_0x13f813-_0x352081,'connectedShops':_0x474279[_0x2699bf(0x215)]}}});}catch(_0x4d020d){_0x44345d(_0x4d020d);}},this[_0x2a6956(0x1ee)]=async(_0x22cd7e,_0x46f51b,_0x3dfaf5)=>{const _0x15075c=_0x2a6956;try{const {page:page=0x1,limit:limit=0x14,verified:_0x42e034}=_0x22cd7e[_0x15075c(0x1e6)],_0x324268=(Number(page)-0x1)*Number(limit),_0xe81831={};_0x42e034!==undefined&&(_0xe81831[_0x15075c(0x213)]=_0x42e034===_0x15075c(0x218));const [_0x3e9a33,_0x1e8a50]=await Promise['all']([database_1[_0x15075c(0x20d)][_0x15075c(0x223)][_0x15075c(0x21b)]({'where':_0xe81831,'skip':_0x324268,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x15075c(0x20d)][_0x15075c(0x223)]['count']({'where':_0xe81831})]);_0x46f51b['json']({'success':!![],'users':_0x3e9a33[_0x15075c(0x1e3)](_0x824ee1=>({'id':_0x824ee1['id'],'telegramId':_0x824ee1[_0x15075c(0x21f)],'username':_0x824ee1['username'],'firstName':_0x824ee1[_0x15075c(0x200)],'lastName':_0x824ee1[_0x15075c(0x209)],'isVerified':_0x824ee1[_0x15075c(0x213)],'shop':_0x824ee1[_0x15075c(0x1fb)],'createdAt':_0x824ee1[_0x15075c(0x1ec)],'updatedAt':_0x824ee1[_0x15075c(0x20f)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1e8a50,'totalPages':Math[_0x15075c(0x1e4)](_0x1e8a50/Number(limit))}});}catch(_0x44e9a8){_0x3dfaf5(_0x44e9a8);}},this[_0x2a6956(0x21a)]=async(_0x4c91ee,_0xfacf24,_0x80175)=>{const _0xd11b1e=_0x2a6956;try{const {message:_0x34a204,shopId:_0x14b62e}=_0x4c91ee[_0xd11b1e(0x1e7)];if(!_0x34a204)return _0xfacf24[_0xd11b1e(0x202)](0x190)[_0xd11b1e(0x1ef)]({'success':![],'message':_0xd11b1e(0x216)});if(_0x14b62e)await telegramBotService_1['telegramBotService'][_0xd11b1e(0x210)](_0x14b62e,_0x34a204,{'parse_mode':_0xd11b1e(0x1f6)});else{const _0x38dc17=await database_1[_0xd11b1e(0x20d)][_0xd11b1e(0x223)][_0xd11b1e(0x21b)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x11ff9b=[...new Set(_0x38dc17[_0xd11b1e(0x1e3)](_0x134550=>_0x134550[_0xd11b1e(0x208)])[_0xd11b1e(0x1f1)](Boolean))];for(const _0x1ed099 of _0x11ff9b){_0x1ed099&&await telegramBotService_1[_0xd11b1e(0x1e2)][_0xd11b1e(0x210)](_0x1ed099,_0x34a204,{'parse_mode':_0xd11b1e(0x1f6)});}}_0xfacf24['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x1df54b){_0x80175(_0x1df54b);}},this['disconnectUser']=async(_0x4a3520,_0x3a130b,_0x12fb9d)=>{const _0x4e8eaf=_0x2a6956;try{const {telegramId:_0x156768}=_0x4a3520[_0x4e8eaf(0x1f7)],_0xd10ca1=await database_1[_0x4e8eaf(0x20d)][_0x4e8eaf(0x223)][_0x4e8eaf(0x1f2)]({'where':{'telegramId':_0x156768},'include':{'shop':!![]}});if(!_0xd10ca1)return _0x3a130b['status'](0x194)[_0x4e8eaf(0x1ef)]({'success':![],'message':_0x4e8eaf(0x219)});await database_1[_0x4e8eaf(0x20d)][_0x4e8eaf(0x223)][_0x4e8eaf(0x1f9)]({'where':{'telegramId':_0x156768},'data':{'shopId':null,'isVerified':![]}}),_0x3a130b['json']({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x256fc3){_0x12fb9d(_0x256fc3);}},this[_0x2a6956(0x1f4)]=async(_0x26d85b,_0x1e1f96,_0x4c3f86)=>{const _0x4ea9de=_0x2a6956;try{const {shopId:_0x46fa79,type:type=_0x4ea9de(0x1f8),testData:_0x1ed959}=_0x26d85b[_0x4ea9de(0x1e7)];if(!_0x46fa79)return _0x1e1f96['status'](0x190)['json']({'success':![],'message':_0x4ea9de(0x212)});const _0x1b37a6=await database_1[_0x4ea9de(0x20d)][_0x4ea9de(0x1fb)][_0x4ea9de(0x1f2)]({'where':{'id':_0x46fa79},'select':{'id':!![],'name':!![]}});if(!_0x1b37a6)return _0x1e1f96['status'](0x194)['json']({'success':![],'message':_0x4ea9de(0x1e0)});switch(type){case'payment':const _0x39c123={'id':_0x4ea9de(0x20e),'amount':_0x1ed959?.[_0x4ea9de(0x207)]||0x64,'currency':_0x1ed959?.[_0x4ea9de(0x1fa)]||'USD','productName':_0x1ed959?.[_0x4ea9de(0x220)]||_0x4ea9de(0x211),'gateway':_0x1ed959?.[_0x4ea9de(0x217)]||'plisio','createdAt':new Date(),..._0x1ed959};await telegramBotService_1['telegramBotService'][_0x4ea9de(0x20b)](_0x46fa79,_0x39c123,'paid');break;case'payout':const _0x2e4275={'id':_0x4ea9de(0x1e8),'amount':_0x1ed959?.[_0x4ea9de(0x207)]||0x1f4,'method':_0x1ed959?.[_0x4ea9de(0x201)]||_0x4ea9de(0x1f3),'createdAt':new Date(),..._0x1ed959};await telegramBotService_1[_0x4ea9de(0x1e2)]['sendPayoutNotification'](_0x46fa79,_0x2e4275,'completed');break;case _0x4ea9de(0x1e9):await telegramBotService_1['telegramBotService']['sendCustomNotification'](_0x46fa79,_0x1ed959?.[_0x4ea9de(0x1fe)]||'Test\x20Notification',_0x1ed959?.[_0x4ea9de(0x221)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x1e1f96[_0x4ea9de(0x202)](0x190)['json']({'success':![],'message':_0x4ea9de(0x21d)});}_0x1e1f96['json']({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x29cd59){_0x4c3f86(_0x29cd59);}};}}function a12_0x28b6(_0x45c4c9,_0x342d1e){const _0x3a2577=a12_0x3a25();return a12_0x28b6=function(_0x28b662,_0x5cc1c8){_0x28b662=_0x28b662-0x1e0;let _0x206193=_0x3a2577[_0x28b662];return _0x206193;},a12_0x28b6(_0x45c4c9,_0x342d1e);}exports[a12_0x4c0fd8(0x21c)]=TelegramController;