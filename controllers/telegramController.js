'use strict';const a12_0x284f37=a12_0x6a07;function a12_0x596e(){const _0xf8cbe2=['details','completed','130WqPljJ','11OezBUg','createdAt','method','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','shop','isVerified','Markdown','lastName','8590776ShwviI','findUnique','findMany','Test\x20Notification','json','shopId','true','defineProperty','currency','getBotStatus','\x20notification\x20sent\x20successfully','33340zegkbe','sendCustomNotification','10004625NAnPJU','query','gateway','sendShopNotification','Test\x20','TelegramController','firstName','2145568jdZinx','payout','amount','productName','custom','all','params','USD','Test\x20Product','update','payment','paid','getBotInfo','body','User\x20disconnected\x20successfully','Message\x20is\x20required','map','__importDefault','sendTestNotification','bank_transfer','788976AABiSr','Shop\x20not\x20found','sendBroadcast','../config/database','getTelegramUsers','sendPaymentNotification','default','21yRDQth','filter','test_payment_123','telegramBotService','11164zjOpxu','desc','900ffdNzh','../services/telegramBotService','username','title','isActive','36847210FAITgJ','Shop\x20ID\x20is\x20required','telegramUser','test_payout_123','status','count','groupBy'];a12_0x596e=function(){return _0xf8cbe2;};return a12_0x596e();}(function(_0x31f376,_0x462930){const _0x525312=a12_0x6a07,_0x37bce6=_0x31f376();while(!![]){try{const _0x5e33a6=parseInt(_0x525312(0x11e))/0x1+parseInt(_0x525312(0xdd))/0x2*(-parseInt(_0x525312(0xdf))/0x3)+-parseInt(_0x525312(0x101))/0x4*(parseInt(_0x525312(0xed))/0x5)+-parseInt(_0x525312(0xf6))/0x6+parseInt(_0x525312(0xd9))/0x7*(parseInt(_0x525312(0x10a))/0x8)+-parseInt(_0x525312(0x103))/0x9+parseInt(_0x525312(0xe4))/0xa*(parseInt(_0x525312(0xee))/0xb);if(_0x5e33a6===_0x462930)break;else _0x37bce6['push'](_0x37bce6['shift']());}catch(_0x3cb610){_0x37bce6['push'](_0x37bce6['shift']());}}}(a12_0x596e,0xcdf22));var __importDefault=this&&this[a12_0x284f37(0x11b)]||function(_0x151e82){return _0x151e82&&_0x151e82['__esModule']?_0x151e82:{'default':_0x151e82};};Object[a12_0x284f37(0xfd)](exports,'__esModule',{'value':!![]}),exports[a12_0x284f37(0x108)]=void 0x0;const telegramBotService_1=require(a12_0x284f37(0xe0)),database_1=__importDefault(require(a12_0x284f37(0x121)));function a12_0x6a07(_0x2f3f93,_0x278f56){const _0x596ec3=a12_0x596e();return a12_0x6a07=function(_0x6a07e0,_0x1afba6){_0x6a07e0=_0x6a07e0-0xd8;let _0x319a3e=_0x596ec3[_0x6a07e0];return _0x319a3e;},a12_0x6a07(_0x2f3f93,_0x278f56);}class TelegramController{constructor(){const _0x5a2e72=a12_0x284f37;this[_0x5a2e72(0xff)]=async(_0x3d0f86,_0x44b9e3,_0x2a59f7)=>{const _0x408831=_0x5a2e72;try{const _0x17a969=telegramBotService_1[_0x408831(0xdc)][_0x408831(0x116)](),_0x102f26=await database_1[_0x408831(0xd8)]['telegramUser']['count'](),_0x2ae56d=await database_1[_0x408831(0xd8)][_0x408831(0xe6)]['count']({'where':{'isVerified':!![]}}),_0x3e3e7b=await database_1[_0x408831(0xd8)][_0x408831(0xe6)][_0x408831(0xea)]({'by':[_0x408831(0xfb)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x44b9e3[_0x408831(0xfa)]({'success':!![],'result':{'bot':{'isActive':_0x17a969[_0x408831(0xe3)],'username':_0x17a969[_0x408831(0xe1)]},'statistics':{'totalUsers':_0x102f26,'verifiedUsers':_0x2ae56d,'unverifiedUsers':_0x102f26-_0x2ae56d,'connectedShops':_0x3e3e7b['length']}}});}catch(_0xf4bcfc){_0x2a59f7(_0xf4bcfc);}},this[_0x5a2e72(0x122)]=async(_0x1872bb,_0x2cbd33,_0x5d18f0)=>{const _0x4b47ea=_0x5a2e72;try{const {page:page=0x1,limit:limit=0x14,verified:_0x18dab6}=_0x1872bb[_0x4b47ea(0x104)],_0x4c2a8f=(Number(page)-0x1)*Number(limit),_0xd30de4={};_0x18dab6!==undefined&&(_0xd30de4[_0x4b47ea(0xf3)]=_0x18dab6===_0x4b47ea(0xfc));const [_0x2edea7,_0x23b821]=await Promise[_0x4b47ea(0x10f)]([database_1[_0x4b47ea(0xd8)][_0x4b47ea(0xe6)]['findMany']({'where':_0xd30de4,'skip':_0x4c2a8f,'take':Number(limit),'orderBy':{'createdAt':_0x4b47ea(0xde)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4b47ea(0xd8)][_0x4b47ea(0xe6)][_0x4b47ea(0xe9)]({'where':_0xd30de4})]);_0x2cbd33[_0x4b47ea(0xfa)]({'success':!![],'users':_0x2edea7[_0x4b47ea(0x11a)](_0x26f09c=>({'id':_0x26f09c['id'],'telegramId':_0x26f09c['telegramId'],'username':_0x26f09c['username'],'firstName':_0x26f09c[_0x4b47ea(0x109)],'lastName':_0x26f09c[_0x4b47ea(0xf5)],'isVerified':_0x26f09c['isVerified'],'shop':_0x26f09c['shop'],'createdAt':_0x26f09c[_0x4b47ea(0xef)],'updatedAt':_0x26f09c['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x23b821,'totalPages':Math['ceil'](_0x23b821/Number(limit))}});}catch(_0x1421fc){_0x5d18f0(_0x1421fc);}},this[_0x5a2e72(0x120)]=async(_0x421407,_0x35b675,_0x35e14c)=>{const _0x18398c=_0x5a2e72;try{const {message:_0x501902,shopId:_0x4edb50}=_0x421407[_0x18398c(0x117)];if(!_0x501902)return _0x35b675['status'](0x190)['json']({'success':![],'message':_0x18398c(0x119)});if(_0x4edb50)await telegramBotService_1[_0x18398c(0xdc)][_0x18398c(0x106)](_0x4edb50,_0x501902,{'parse_mode':_0x18398c(0xf4)});else{const _0x5d27ad=await database_1['default'][_0x18398c(0xe6)][_0x18398c(0xf8)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x161fa9=[...new Set(_0x5d27ad[_0x18398c(0x11a)](_0x707bcd=>_0x707bcd[_0x18398c(0xfb)])[_0x18398c(0xda)](Boolean))];for(const _0x632c6 of _0x161fa9){_0x632c6&&await telegramBotService_1['telegramBotService'][_0x18398c(0x106)](_0x632c6,_0x501902,{'parse_mode':_0x18398c(0xf4)});}}_0x35b675['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x3bd467){_0x35e14c(_0x3bd467);}},this['disconnectUser']=async(_0x17a441,_0x867c12,_0x3b4c48)=>{const _0x53b98a=_0x5a2e72;try{const {telegramId:_0x4723b8}=_0x17a441[_0x53b98a(0x110)],_0x41e748=await database_1[_0x53b98a(0xd8)]['telegramUser'][_0x53b98a(0xf7)]({'where':{'telegramId':_0x4723b8},'include':{'shop':!![]}});if(!_0x41e748)return _0x867c12[_0x53b98a(0xe8)](0x194)[_0x53b98a(0xfa)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x53b98a(0xd8)][_0x53b98a(0xe6)][_0x53b98a(0x113)]({'where':{'telegramId':_0x4723b8},'data':{'shopId':null,'isVerified':![]}}),_0x867c12[_0x53b98a(0xfa)]({'success':!![],'message':_0x53b98a(0x118)});}catch(_0x11027e){_0x3b4c48(_0x11027e);}},this[_0x5a2e72(0x11c)]=async(_0x58e30c,_0x17e82c,_0x47cf1c)=>{const _0x4a954d=_0x5a2e72;try{const {shopId:_0x77a20f,type:type=_0x4a954d(0x114),testData:_0x13e603}=_0x58e30c['body'];if(!_0x77a20f)return _0x17e82c[_0x4a954d(0xe8)](0x190)[_0x4a954d(0xfa)]({'success':![],'message':_0x4a954d(0xe5)});const _0x2619bb=await database_1[_0x4a954d(0xd8)][_0x4a954d(0xf2)][_0x4a954d(0xf7)]({'where':{'id':_0x77a20f},'select':{'id':!![],'name':!![]}});if(!_0x2619bb)return _0x17e82c[_0x4a954d(0xe8)](0x194)[_0x4a954d(0xfa)]({'success':![],'message':_0x4a954d(0x11f)});switch(type){case _0x4a954d(0x114):const _0x43cdfd={'id':_0x4a954d(0xdb),'amount':_0x13e603?.[_0x4a954d(0x10c)]||0x64,'currency':_0x13e603?.[_0x4a954d(0xfe)]||_0x4a954d(0x111),'productName':_0x13e603?.[_0x4a954d(0x10d)]||_0x4a954d(0x112),'gateway':_0x13e603?.[_0x4a954d(0x105)]||'plisio','createdAt':new Date(),..._0x13e603};await telegramBotService_1['telegramBotService'][_0x4a954d(0x123)](_0x77a20f,_0x43cdfd,_0x4a954d(0x115));break;case _0x4a954d(0x10b):const _0x18de0b={'id':_0x4a954d(0xe7),'amount':_0x13e603?.[_0x4a954d(0x10c)]||0x1f4,'method':_0x13e603?.[_0x4a954d(0xf0)]||_0x4a954d(0x11d),'createdAt':new Date(),..._0x13e603};await telegramBotService_1[_0x4a954d(0xdc)]['sendPayoutNotification'](_0x77a20f,_0x18de0b,_0x4a954d(0xec));break;case _0x4a954d(0x10e):await telegramBotService_1[_0x4a954d(0xdc)][_0x4a954d(0x102)](_0x77a20f,_0x13e603?.[_0x4a954d(0xe2)]||_0x4a954d(0xf9),_0x13e603?.[_0x4a954d(0xeb)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x17e82c['status'](0x190)[_0x4a954d(0xfa)]({'success':![],'message':_0x4a954d(0xf1)});}_0x17e82c[_0x4a954d(0xfa)]({'success':!![],'message':_0x4a954d(0x107)+type+_0x4a954d(0x100)});}catch(_0x39fa32){_0x47cf1c(_0x39fa32);}};}}exports[a12_0x284f37(0x108)]=TelegramController;