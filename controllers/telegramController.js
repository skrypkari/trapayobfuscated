'use strict';function a14_0x1fbb(_0x3baaf,_0x2a0765){const _0x3767b3=a14_0x3767();return a14_0x1fbb=function(_0x1fbbeb,_0x53eeb1){_0x1fbbeb=_0x1fbbeb-0x117;let _0x2174ca=_0x3767b3[_0x1fbbeb];return _0x2174ca;},a14_0x1fbb(_0x3baaf,_0x2a0765);}const a14_0x63016c=a14_0x1fbb;(function(_0x7c33ee,_0xc6383e){const _0xb8dc5d=a14_0x1fbb,_0x34264d=_0x7c33ee();while(!![]){try{const _0x3cf523=parseInt(_0xb8dc5d(0x152))/0x1*(-parseInt(_0xb8dc5d(0x13b))/0x2)+-parseInt(_0xb8dc5d(0x147))/0x3+-parseInt(_0xb8dc5d(0x15d))/0x4+-parseInt(_0xb8dc5d(0x159))/0x5*(-parseInt(_0xb8dc5d(0x157))/0x6)+parseInt(_0xb8dc5d(0x13c))/0x7*(-parseInt(_0xb8dc5d(0x144))/0x8)+parseInt(_0xb8dc5d(0x129))/0x9+parseInt(_0xb8dc5d(0x154))/0xa*(parseInt(_0xb8dc5d(0x150))/0xb);if(_0x3cf523===_0xc6383e)break;else _0x34264d['push'](_0x34264d['shift']());}catch(_0x59d3d5){_0x34264d['push'](_0x34264d['shift']());}}}(a14_0x3767,0x2fa1e));var __importDefault=this&&this[a14_0x63016c(0x134)]||function(_0x4e728a){const _0x25017a=a14_0x63016c;return _0x4e728a&&_0x4e728a[_0x25017a(0x15b)]?_0x4e728a:{'default':_0x4e728a};};Object[a14_0x63016c(0x138)](exports,a14_0x63016c(0x15b),{'value':!![]}),exports[a14_0x63016c(0x122)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a14_0x63016c(0x143)));function a14_0x3767(){const _0x39d16b=['Markdown','sendShopNotification','../config/database','8ZQUOVR','amount','all','955029JWuBBa','default','firstName','update','Shop\x20ID\x20is\x20required','payout','findUnique','USD','gateway','22ttQvaj','Shop\x20not\x20found','1yuDfeJ','telegramBotService','1801100ioJQvA','lastName','getTelegramUsers','13644XQgXNU','sendCustomNotification','390bZNIjz','json','__esModule','username','247772VuqGgk','count','custom','map','ceil','test_payment_123','Telegram\x20user\x20not\x20found','sendPaymentNotification','filter','Test\x20Product','desc','Test\x20Notification','TelegramController','sendPayoutNotification','true','isActive','Test\x20','Broadcast\x20message\x20sent\x20successfully','isVerified','3433113qCKVdZ','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','telegramUser','payment','getBotInfo','body','currency','plisio','createdAt','shop','params','__importDefault','status','title','findMany','defineProperty','paid','\x20notification\x20sent\x20successfully','545276sTRECL','497161hUrTTL','sendTestNotification','query','shopId','details'];a14_0x3767=function(){return _0x39d16b;};return a14_0x3767();}class TelegramController{constructor(){const _0x311b7a=a14_0x63016c;this['getBotStatus']=async(_0x527cc1,_0x2f80ea,_0x1bf009)=>{const _0x1db36c=a14_0x1fbb;try{const _0x121e51=telegramBotService_1[_0x1db36c(0x153)][_0x1db36c(0x12d)](),_0x44a1df=await database_1[_0x1db36c(0x148)][_0x1db36c(0x12b)]['count'](),_0x885e2d=await database_1[_0x1db36c(0x148)][_0x1db36c(0x12b)][_0x1db36c(0x117)]({'where':{'isVerified':!![]}}),_0x34edc9=await database_1['default'][_0x1db36c(0x12b)]['groupBy']({'by':[_0x1db36c(0x13f)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2f80ea['json']({'success':!![],'result':{'bot':{'isActive':_0x121e51[_0x1db36c(0x125)],'username':_0x121e51[_0x1db36c(0x15c)]},'statistics':{'totalUsers':_0x44a1df,'verifiedUsers':_0x885e2d,'unverifiedUsers':_0x44a1df-_0x885e2d,'connectedShops':_0x34edc9['length']}}});}catch(_0x2b1f9a){_0x1bf009(_0x2b1f9a);}},this[_0x311b7a(0x156)]=async(_0x19bdf0,_0x4c46dc,_0xfa5d9)=>{const _0x519dcd=_0x311b7a;try{const {page:page=0x1,limit:limit=0x14,verified:_0xe4df69}=_0x19bdf0[_0x519dcd(0x13e)],_0x49556e=(Number(page)-0x1)*Number(limit),_0x2d7dfb={};_0xe4df69!==undefined&&(_0x2d7dfb[_0x519dcd(0x128)]=_0xe4df69===_0x519dcd(0x124));const [_0x2fa495,_0x11ee8a]=await Promise[_0x519dcd(0x146)]([database_1[_0x519dcd(0x148)]['telegramUser'][_0x519dcd(0x137)]({'where':_0x2d7dfb,'skip':_0x49556e,'take':Number(limit),'orderBy':{'createdAt':_0x519dcd(0x120)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x519dcd(0x148)][_0x519dcd(0x12b)][_0x519dcd(0x117)]({'where':_0x2d7dfb})]);_0x4c46dc[_0x519dcd(0x15a)]({'success':!![],'users':_0x2fa495[_0x519dcd(0x119)](_0x2334e0=>({'id':_0x2334e0['id'],'telegramId':_0x2334e0['telegramId'],'username':_0x2334e0[_0x519dcd(0x15c)],'firstName':_0x2334e0[_0x519dcd(0x149)],'lastName':_0x2334e0[_0x519dcd(0x155)],'isVerified':_0x2334e0[_0x519dcd(0x128)],'shop':_0x2334e0['shop'],'createdAt':_0x2334e0[_0x519dcd(0x131)],'updatedAt':_0x2334e0['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x11ee8a,'totalPages':Math[_0x519dcd(0x11a)](_0x11ee8a/Number(limit))}});}catch(_0x39cc2f){_0xfa5d9(_0x39cc2f);}},this['sendBroadcast']=async(_0x1de0ca,_0x26bebe,_0x26ed0a)=>{const _0x50cf82=_0x311b7a;try{const {message:_0x3ab81b,shopId:_0xb44c28}=_0x1de0ca[_0x50cf82(0x12e)];if(!_0x3ab81b)return _0x26bebe['status'](0x190)[_0x50cf82(0x15a)]({'success':![],'message':'Message\x20is\x20required'});if(_0xb44c28)await telegramBotService_1['telegramBotService'][_0x50cf82(0x142)](_0xb44c28,_0x3ab81b,{'parse_mode':'Markdown'});else{const _0xfdc920=await database_1[_0x50cf82(0x148)][_0x50cf82(0x12b)][_0x50cf82(0x137)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xbcce95=[...new Set(_0xfdc920[_0x50cf82(0x119)](_0x4050e5=>_0x4050e5[_0x50cf82(0x13f)])[_0x50cf82(0x11e)](Boolean))];for(const _0x4631b5 of _0xbcce95){_0x4631b5&&await telegramBotService_1[_0x50cf82(0x153)][_0x50cf82(0x142)](_0x4631b5,_0x3ab81b,{'parse_mode':_0x50cf82(0x141)});}}_0x26bebe['json']({'success':!![],'message':_0x50cf82(0x127)});}catch(_0x403ddd){_0x26ed0a(_0x403ddd);}},this['disconnectUser']=async(_0x454b05,_0x4b44f8,_0x296396)=>{const _0x7e5c5b=_0x311b7a;try{const {telegramId:_0x34a2ff}=_0x454b05[_0x7e5c5b(0x133)],_0x574f39=await database_1[_0x7e5c5b(0x148)]['telegramUser'][_0x7e5c5b(0x14d)]({'where':{'telegramId':_0x34a2ff},'include':{'shop':!![]}});if(!_0x574f39)return _0x4b44f8[_0x7e5c5b(0x135)](0x194)[_0x7e5c5b(0x15a)]({'success':![],'message':_0x7e5c5b(0x11c)});await database_1[_0x7e5c5b(0x148)][_0x7e5c5b(0x12b)][_0x7e5c5b(0x14a)]({'where':{'telegramId':_0x34a2ff},'data':{'shopId':null,'isVerified':![]}}),_0x4b44f8[_0x7e5c5b(0x15a)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x1496b4){_0x296396(_0x1496b4);}},this[_0x311b7a(0x13d)]=async(_0x2ccc64,_0x570106,_0x4ca0e9)=>{const _0x13dc55=_0x311b7a;try{const {shopId:_0xb8e050,type:type=_0x13dc55(0x12c),testData:_0x31ab2e}=_0x2ccc64['body'];if(!_0xb8e050)return _0x570106['status'](0x190)[_0x13dc55(0x15a)]({'success':![],'message':_0x13dc55(0x14b)});const _0x39df7c=await database_1['default'][_0x13dc55(0x132)][_0x13dc55(0x14d)]({'where':{'id':_0xb8e050},'select':{'id':!![],'name':!![]}});if(!_0x39df7c)return _0x570106[_0x13dc55(0x135)](0x194)['json']({'success':![],'message':_0x13dc55(0x151)});switch(type){case _0x13dc55(0x12c):const _0x51f242={'id':_0x13dc55(0x11b),'amount':_0x31ab2e?.[_0x13dc55(0x145)]||0x64,'currency':_0x31ab2e?.[_0x13dc55(0x12f)]||_0x13dc55(0x14e),'productName':_0x31ab2e?.['productName']||_0x13dc55(0x11f),'gateway':_0x31ab2e?.[_0x13dc55(0x14f)]||_0x13dc55(0x130),'createdAt':new Date(),..._0x31ab2e};await telegramBotService_1[_0x13dc55(0x153)][_0x13dc55(0x11d)](_0xb8e050,_0x51f242,_0x13dc55(0x139));break;case _0x13dc55(0x14c):const _0xff00b3={'id':'test_payout_123','amount':_0x31ab2e?.['amount']||0x1f4,'method':_0x31ab2e?.['method']||'bank_transfer','createdAt':new Date(),..._0x31ab2e};await telegramBotService_1['telegramBotService'][_0x13dc55(0x123)](_0xb8e050,_0xff00b3,'completed');break;case _0x13dc55(0x118):await telegramBotService_1['telegramBotService'][_0x13dc55(0x158)](_0xb8e050,_0x31ab2e?.[_0x13dc55(0x136)]||_0x13dc55(0x121),_0x31ab2e?.[_0x13dc55(0x140)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x570106[_0x13dc55(0x135)](0x190)[_0x13dc55(0x15a)]({'success':![],'message':_0x13dc55(0x12a)});}_0x570106[_0x13dc55(0x15a)]({'success':!![],'message':_0x13dc55(0x126)+type+_0x13dc55(0x13a)});}catch(_0x38905d){_0x4ca0e9(_0x38905d);}};}}exports[a14_0x63016c(0x122)]=TelegramController;