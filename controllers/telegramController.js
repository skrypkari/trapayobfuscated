'use strict';function a12_0x9348(){const _0x1f6a62=['firstName','telegramUser','TelegramController','productName','../config/database','count','findMany','defineProperty','927044DFXPUy','getBotStatus','getBotInfo','map','lastName','getTelegramUsers','230690acKKeZ','createdAt','test_payment_123','User\x20disconnected\x20successfully','\x20notification\x20sent\x20successfully','Markdown','__esModule','63007mqucmp','amount','status','method','update','updatedAt','3392279VXEABj','body','groupBy','sendBroadcast','shopId','sendShopNotification','Test\x20','26dTDgIE','true','paid','query','filter','150FuMbWR','params','completed','currency','telegramId','telegramBotService','username','findUnique','isVerified','Broadcast\x20message\x20sent\x20successfully','shop','test_payout_123','gateway','Test\x20Notification','default','sendCustomNotification','29241aeSWnL','15320616iPWBoE','Telegram\x20user\x20not\x20found','desc','Shop\x20ID\x20is\x20required','title','sendPayoutNotification','15MuQDIz','isActive','Message\x20is\x20required','payment','20hCOwMy','__importDefault','5050IjJRoz','ceil','json','156224YZVlkF','USD','472dHLcIy'];a12_0x9348=function(){return _0x1f6a62;};return a12_0x9348();}const a12_0x5bac2e=a12_0x2cba;(function(_0x166c41,_0x41f9af){const _0x518530=a12_0x2cba,_0x58e860=_0x166c41();while(!![]){try{const _0x5fcaca=parseInt(_0x518530(0x115))/0x1*(parseInt(_0x518530(0x110))/0x2)+parseInt(_0x518530(0x10c))/0x3*(-parseInt(_0x518530(0x120))/0x4)+parseInt(_0x518530(0x126))/0x5*(parseInt(_0x518530(0x13f))/0x6)+parseInt(_0x518530(0x12d))/0x7*(parseInt(_0x518530(0x117))/0x8)+-parseInt(_0x518530(0x105))/0x9*(-parseInt(_0x518530(0x112))/0xa)+-parseInt(_0x518530(0x133))/0xb+parseInt(_0x518530(0x106))/0xc*(-parseInt(_0x518530(0x13a))/0xd);if(_0x5fcaca===_0x41f9af)break;else _0x58e860['push'](_0x58e860['shift']());}catch(_0x252904){_0x58e860['push'](_0x58e860['shift']());}}}(a12_0x9348,0xd3a30));var __importDefault=this&&this[a12_0x5bac2e(0x111)]||function(_0x242097){return _0x242097&&_0x242097['__esModule']?_0x242097:{'default':_0x242097};};Object[a12_0x5bac2e(0x11f)](exports,a12_0x5bac2e(0x12c),{'value':!![]}),exports[a12_0x5bac2e(0x11a)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x5bac2e(0x11c)));class TelegramController{constructor(){const _0x454b60=a12_0x5bac2e;this[_0x454b60(0x121)]=async(_0x352925,_0x374a3d,_0x4e7fee)=>{const _0xf1bb24=_0x454b60;try{const _0x5cdde5=telegramBotService_1['telegramBotService'][_0xf1bb24(0x122)](),_0x2f2669=await database_1[_0xf1bb24(0x103)][_0xf1bb24(0x119)][_0xf1bb24(0x11d)](),_0x3a4a81=await database_1[_0xf1bb24(0x103)][_0xf1bb24(0x119)][_0xf1bb24(0x11d)]({'where':{'isVerified':!![]}}),_0x3ead88=await database_1[_0xf1bb24(0x103)][_0xf1bb24(0x119)][_0xf1bb24(0x135)]({'by':[_0xf1bb24(0x137)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x374a3d[_0xf1bb24(0x114)]({'success':!![],'result':{'bot':{'isActive':_0x5cdde5[_0xf1bb24(0x10d)],'username':_0x5cdde5[_0xf1bb24(0xfb)]},'statistics':{'totalUsers':_0x2f2669,'verifiedUsers':_0x3a4a81,'unverifiedUsers':_0x2f2669-_0x3a4a81,'connectedShops':_0x3ead88['length']}}});}catch(_0x4b6cf8){_0x4e7fee(_0x4b6cf8);}},this[_0x454b60(0x125)]=async(_0x535088,_0x430d6f,_0x49f6e2)=>{const _0x2221b8=_0x454b60;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4d526d}=_0x535088[_0x2221b8(0x13d)],_0x3a5177=(Number(page)-0x1)*Number(limit),_0x40fd95={};_0x4d526d!==undefined&&(_0x40fd95[_0x2221b8(0xfd)]=_0x4d526d===_0x2221b8(0x13b));const [_0x348553,_0x2467d4]=await Promise['all']([database_1[_0x2221b8(0x103)][_0x2221b8(0x119)][_0x2221b8(0x11e)]({'where':_0x40fd95,'skip':_0x3a5177,'take':Number(limit),'orderBy':{'createdAt':_0x2221b8(0x108)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2221b8(0x103)][_0x2221b8(0x119)][_0x2221b8(0x11d)]({'where':_0x40fd95})]);_0x430d6f['json']({'success':!![],'users':_0x348553['map'](_0x5d4051=>({'id':_0x5d4051['id'],'telegramId':_0x5d4051[_0x2221b8(0xf9)],'username':_0x5d4051['username'],'firstName':_0x5d4051[_0x2221b8(0x118)],'lastName':_0x5d4051[_0x2221b8(0x124)],'isVerified':_0x5d4051[_0x2221b8(0xfd)],'shop':_0x5d4051[_0x2221b8(0xff)],'createdAt':_0x5d4051[_0x2221b8(0x127)],'updatedAt':_0x5d4051[_0x2221b8(0x132)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2467d4,'totalPages':Math[_0x2221b8(0x113)](_0x2467d4/Number(limit))}});}catch(_0x274406){_0x49f6e2(_0x274406);}},this[_0x454b60(0x136)]=async(_0x425fb3,_0x2e2276,_0x54d1e0)=>{const _0x55783b=_0x454b60;try{const {message:_0x17a60b,shopId:_0xc7d91}=_0x425fb3[_0x55783b(0x134)];if(!_0x17a60b)return _0x2e2276[_0x55783b(0x12f)](0x190)[_0x55783b(0x114)]({'success':![],'message':_0x55783b(0x10e)});if(_0xc7d91)await telegramBotService_1['telegramBotService'][_0x55783b(0x138)](_0xc7d91,_0x17a60b,{'parse_mode':_0x55783b(0x12b)});else{const _0x43baed=await database_1[_0x55783b(0x103)][_0x55783b(0x119)][_0x55783b(0x11e)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x738ca=[...new Set(_0x43baed[_0x55783b(0x123)](_0x32fe20=>_0x32fe20[_0x55783b(0x137)])[_0x55783b(0x13e)](Boolean))];for(const _0x2c5286 of _0x738ca){_0x2c5286&&await telegramBotService_1[_0x55783b(0xfa)][_0x55783b(0x138)](_0x2c5286,_0x17a60b,{'parse_mode':_0x55783b(0x12b)});}}_0x2e2276[_0x55783b(0x114)]({'success':!![],'message':_0x55783b(0xfe)});}catch(_0x5dd3ee){_0x54d1e0(_0x5dd3ee);}},this['disconnectUser']=async(_0x1ddf98,_0x3c9e3c,_0x5b2549)=>{const _0x6b99f1=_0x454b60;try{const {telegramId:_0x1348e4}=_0x1ddf98[_0x6b99f1(0x140)],_0x58a9bd=await database_1['default'][_0x6b99f1(0x119)][_0x6b99f1(0xfc)]({'where':{'telegramId':_0x1348e4},'include':{'shop':!![]}});if(!_0x58a9bd)return _0x3c9e3c[_0x6b99f1(0x12f)](0x194)[_0x6b99f1(0x114)]({'success':![],'message':_0x6b99f1(0x107)});await database_1[_0x6b99f1(0x103)][_0x6b99f1(0x119)][_0x6b99f1(0x131)]({'where':{'telegramId':_0x1348e4},'data':{'shopId':null,'isVerified':![]}}),_0x3c9e3c[_0x6b99f1(0x114)]({'success':!![],'message':_0x6b99f1(0x129)});}catch(_0x4129fd){_0x5b2549(_0x4129fd);}},this['sendTestNotification']=async(_0xf2c919,_0x257b3a,_0x2d5743)=>{const _0x3739a1=_0x454b60;try{const {shopId:_0xbc2861,type:type=_0x3739a1(0x10f),testData:_0x139378}=_0xf2c919[_0x3739a1(0x134)];if(!_0xbc2861)return _0x257b3a[_0x3739a1(0x12f)](0x190)[_0x3739a1(0x114)]({'success':![],'message':_0x3739a1(0x109)});const _0x1ba633=await database_1[_0x3739a1(0x103)][_0x3739a1(0xff)][_0x3739a1(0xfc)]({'where':{'id':_0xbc2861},'select':{'id':!![],'name':!![]}});if(!_0x1ba633)return _0x257b3a['status'](0x194)[_0x3739a1(0x114)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x3739a1(0x10f):const _0x488d32={'id':_0x3739a1(0x128),'amount':_0x139378?.[_0x3739a1(0x12e)]||0x64,'currency':_0x139378?.[_0x3739a1(0xf8)]||_0x3739a1(0x116),'productName':_0x139378?.[_0x3739a1(0x11b)]||'Test\x20Product','gateway':_0x139378?.[_0x3739a1(0x101)]||'plisio','createdAt':new Date(),..._0x139378};await telegramBotService_1[_0x3739a1(0xfa)]['sendPaymentNotification'](_0xbc2861,_0x488d32,_0x3739a1(0x13c));break;case'payout':const _0x1a5447={'id':_0x3739a1(0x100),'amount':_0x139378?.[_0x3739a1(0x12e)]||0x1f4,'method':_0x139378?.[_0x3739a1(0x130)]||'bank_transfer','createdAt':new Date(),..._0x139378};await telegramBotService_1[_0x3739a1(0xfa)][_0x3739a1(0x10b)](_0xbc2861,_0x1a5447,_0x3739a1(0x141));break;case'custom':await telegramBotService_1[_0x3739a1(0xfa)][_0x3739a1(0x104)](_0xbc2861,_0x139378?.[_0x3739a1(0x10a)]||_0x3739a1(0x102),_0x139378?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x257b3a['status'](0x190)[_0x3739a1(0x114)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x257b3a[_0x3739a1(0x114)]({'success':!![],'message':_0x3739a1(0x139)+type+_0x3739a1(0x12a)});}catch(_0x195eb6){_0x2d5743(_0x195eb6);}};}}function a12_0x2cba(_0x203428,_0x2fd0ea){const _0x93487b=a12_0x9348();return a12_0x2cba=function(_0x2cba22,_0x105913){_0x2cba22=_0x2cba22-0xf8;let _0x2efcea=_0x93487b[_0x2cba22];return _0x2efcea;},a12_0x2cba(_0x203428,_0x2fd0ea);}exports[a12_0x5bac2e(0x11a)]=TelegramController;