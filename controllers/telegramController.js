'use strict';function a20_0x24c0(_0x2a46c0,_0x30fe8f){_0x2a46c0=_0x2a46c0-0x12c;const _0x285a46=a20_0x285a();let _0x24c02d=_0x285a46[_0x2a46c0];return _0x24c02d;}const a20_0xe0d618=a20_0x24c0;(function(_0x10152c,_0x548896){const _0x5f551f=a20_0x24c0,_0x277de2=_0x10152c();while(!![]){try{const _0x57f4c0=-parseInt(_0x5f551f(0x12f))/0x1*(-parseInt(_0x5f551f(0x144))/0x2)+-parseInt(_0x5f551f(0x16b))/0x3*(parseInt(_0x5f551f(0x174))/0x4)+parseInt(_0x5f551f(0x141))/0x5*(parseInt(_0x5f551f(0x157))/0x6)+parseInt(_0x5f551f(0x130))/0x7+parseInt(_0x5f551f(0x161))/0x8+parseInt(_0x5f551f(0x168))/0x9*(-parseInt(_0x5f551f(0x15e))/0xa)+parseInt(_0x5f551f(0x156))/0xb*(-parseInt(_0x5f551f(0x15c))/0xc);if(_0x57f4c0===_0x548896)break;else _0x277de2['push'](_0x277de2['shift']());}catch(_0x56f50d){_0x277de2['push'](_0x277de2['shift']());}}}(a20_0x285a,0x3770c));function a20_0x285a(){const _0x5dcfd4=['TRC20','count','query','Тестовый\x20период','title','body','150jFeGYS','getBotInfo','default','14916JYMAvL','isActive','txid','getTelegramUsers','findUnique','payment','shopId','params','sendTestNotification','User\x20disconnected\x20successfully','shop','amount','isVerified','paid','json','filter','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','USD','77HIXYLW','11250IWgAcM','createdAt','ceil','__esModule','Message\x20is\x20required','495084aXbvwb','all','70EzLlCR','sendPaymentNotification','updatedAt','2954272hlXEDH','map','findMany','network','productName','wallet','\x20notification\x20sent\x20successfully','329103GUgKpc','custom','telegramBotService','413811xxWmQp','disconnectUser','Telegram\x20user\x20not\x20found','lastName','defineProperty','TelegramController','Test\x20Product','telegramUser','Broadcast\x20message\x20sent\x20successfully','4TiAIxS','update','status','currency','desc','test_payment_123','44jMrYfl','1092721cacfhq','firstName','sendBroadcast','sendCustomNotification','sendShopNotification','Shop\x20ID\x20is\x20required','payout','username','../services/telegramBotService','This\x20is\x20a\x20test\x20notification','true'];a20_0x285a=function(){return _0x5dcfd4;};return a20_0x285a();}var __importDefault=this&&this['__importDefault']||function(_0x2670b7){return _0x2670b7&&_0x2670b7['__esModule']?_0x2670b7:{'default':_0x2670b7};};Object[a20_0xe0d618(0x16f)](exports,a20_0xe0d618(0x15a),{'value':!![]}),exports[a20_0xe0d618(0x170)]=void 0x0;const telegramBotService_1=require(a20_0xe0d618(0x138)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0xfe1dda=a20_0xe0d618;this['getBotStatus']=async(_0x30b83c,_0x24fbc1,_0x25b6c8)=>{const _0x219697=a20_0x24c0;try{const _0x56c8d6=telegramBotService_1['telegramBotService'][_0x219697(0x142)](),_0x3354be=await database_1[_0x219697(0x143)][_0x219697(0x172)][_0x219697(0x13c)](),_0x58fdcd=await database_1[_0x219697(0x143)]['telegramUser'][_0x219697(0x13c)]({'where':{'isVerified':!![]}}),_0x2e0cd4=await database_1[_0x219697(0x143)]['telegramUser']['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x24fbc1['json']({'success':!![],'result':{'bot':{'isActive':_0x56c8d6[_0x219697(0x145)],'username':_0x56c8d6['username']},'statistics':{'totalUsers':_0x3354be,'verifiedUsers':_0x58fdcd,'unverifiedUsers':_0x3354be-_0x58fdcd,'connectedShops':_0x2e0cd4['length']}}});}catch(_0x27731e){_0x25b6c8(_0x27731e);}},this[_0xfe1dda(0x147)]=async(_0x3f3168,_0x19a94f,_0x32677c)=>{const _0x450996=_0xfe1dda;try{const {page:page=0x1,limit:limit=0x14,verified:_0x13aa6d}=_0x3f3168[_0x450996(0x13d)],_0x4045c4=(Number(page)-0x1)*Number(limit),_0xfa0d9e={};_0x13aa6d!==undefined&&(_0xfa0d9e[_0x450996(0x150)]=_0x13aa6d===_0x450996(0x13a));const [_0x30f664,_0x3ccbcf]=await Promise[_0x450996(0x15d)]([database_1[_0x450996(0x143)]['telegramUser'][_0x450996(0x163)]({'where':_0xfa0d9e,'skip':_0x4045c4,'take':Number(limit),'orderBy':{'createdAt':_0x450996(0x12d)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x450996(0x143)]['telegramUser'][_0x450996(0x13c)]({'where':_0xfa0d9e})]);_0x19a94f[_0x450996(0x152)]({'success':!![],'users':_0x30f664[_0x450996(0x162)](_0x347cd0=>({'id':_0x347cd0['id'],'telegramId':_0x347cd0['telegramId'],'username':_0x347cd0[_0x450996(0x137)],'firstName':_0x347cd0[_0x450996(0x131)],'lastName':_0x347cd0[_0x450996(0x16e)],'isVerified':_0x347cd0[_0x450996(0x150)],'shop':_0x347cd0[_0x450996(0x14e)],'createdAt':_0x347cd0[_0x450996(0x158)],'updatedAt':_0x347cd0[_0x450996(0x160)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3ccbcf,'totalPages':Math[_0x450996(0x159)](_0x3ccbcf/Number(limit))}});}catch(_0x21f1cd){_0x32677c(_0x21f1cd);}},this[_0xfe1dda(0x132)]=async(_0x2d357b,_0x2471e9,_0x2ce721)=>{const _0x1894a0=_0xfe1dda;try{const {message:_0x75520,shopId:_0xf08129}=_0x2d357b[_0x1894a0(0x140)];if(!_0x75520)return _0x2471e9[_0x1894a0(0x176)](0x190)['json']({'success':![],'message':_0x1894a0(0x15b)});if(_0xf08129)await telegramBotService_1[_0x1894a0(0x16a)][_0x1894a0(0x134)](_0xf08129,_0x75520,{'parse_mode':'Markdown'});else{const _0x275a32=await database_1[_0x1894a0(0x143)][_0x1894a0(0x172)][_0x1894a0(0x163)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x26828b=[...new Set(_0x275a32[_0x1894a0(0x162)](_0x1dc167=>_0x1dc167[_0x1894a0(0x14a)])[_0x1894a0(0x153)](Boolean))];for(const _0x394637 of _0x26828b){_0x394637&&await telegramBotService_1[_0x1894a0(0x16a)]['sendShopNotification'](_0x394637,_0x75520,{'parse_mode':'Markdown'});}}_0x2471e9[_0x1894a0(0x152)]({'success':!![],'message':_0x1894a0(0x173)});}catch(_0x966983){_0x2ce721(_0x966983);}},this[_0xfe1dda(0x16c)]=async(_0x26ee8d,_0x435981,_0x44578e)=>{const _0x350135=_0xfe1dda;try{const {telegramId:_0x4d1953}=_0x26ee8d[_0x350135(0x14b)],_0x57f671=await database_1[_0x350135(0x143)]['telegramUser'][_0x350135(0x148)]({'where':{'telegramId':_0x4d1953},'include':{'shop':!![]}});if(!_0x57f671)return _0x435981[_0x350135(0x176)](0x194)[_0x350135(0x152)]({'success':![],'message':_0x350135(0x16d)});await database_1['default'][_0x350135(0x172)][_0x350135(0x175)]({'where':{'telegramId':_0x4d1953},'data':{'shopId':null,'isVerified':![]}}),_0x435981[_0x350135(0x152)]({'success':!![],'message':_0x350135(0x14d)});}catch(_0x25aaf1){_0x44578e(_0x25aaf1);}},this[_0xfe1dda(0x14c)]=async(_0x48d954,_0x4b4c0b,_0x28ec12)=>{const _0x4a5e99=_0xfe1dda;try{const {shopId:_0x51b754,type:type=_0x4a5e99(0x149),testData:_0x413612}=_0x48d954['body'];if(!_0x51b754)return _0x4b4c0b['status'](0x190)[_0x4a5e99(0x152)]({'success':![],'message':_0x4a5e99(0x135)});const _0x4b6bca=await database_1[_0x4a5e99(0x143)][_0x4a5e99(0x14e)][_0x4a5e99(0x148)]({'where':{'id':_0x51b754},'select':{'id':!![],'name':!![]}});if(!_0x4b6bca)return _0x4b4c0b[_0x4a5e99(0x176)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x4a5e99(0x149):const _0x883988={'id':_0x4a5e99(0x12e),'amount':_0x413612?.[_0x4a5e99(0x14f)]||0x64,'currency':_0x413612?.[_0x4a5e99(0x12c)]||_0x4a5e99(0x155),'productName':_0x413612?.[_0x4a5e99(0x165)]||_0x4a5e99(0x171),'gateway':_0x413612?.['gateway']||'plisio','createdAt':new Date(),..._0x413612};await telegramBotService_1[_0x4a5e99(0x16a)][_0x4a5e99(0x15f)](_0x51b754,_0x883988,_0x4a5e99(0x151));break;case _0x4a5e99(0x136):const _0xba161b={'id':'test_payout_123','amount':_0x413612?.[_0x4a5e99(0x14f)]||0x1f4,'network':_0x413612?.[_0x4a5e99(0x164)]||_0x4a5e99(0x13b),'wallet':_0x413612?.[_0x4a5e99(0x166)]||'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','period':_0x4a5e99(0x13e),'createdAt':new Date(),'txid':_0x413612?.[_0x4a5e99(0x146)]||null,..._0x413612};await telegramBotService_1[_0x4a5e99(0x16a)]['sendPayoutNotification'](_0x51b754,_0xba161b);break;case _0x4a5e99(0x169):await telegramBotService_1[_0x4a5e99(0x16a)][_0x4a5e99(0x133)](_0x51b754,_0x413612?.[_0x4a5e99(0x13f)]||'Test\x20Notification',_0x413612?.['details']||{'message':_0x4a5e99(0x139)});break;default:return _0x4b4c0b[_0x4a5e99(0x176)](0x190)[_0x4a5e99(0x152)]({'success':![],'message':_0x4a5e99(0x154)});}_0x4b4c0b[_0x4a5e99(0x152)]({'success':!![],'message':'Test\x20'+type+_0x4a5e99(0x167)});}catch(_0x109e6e){_0x28ec12(_0x109e6e);}};}}exports[a20_0xe0d618(0x170)]=TelegramController;