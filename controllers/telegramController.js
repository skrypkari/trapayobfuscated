'use strict';const a12_0x4b9a36=a12_0x3784;(function(_0x42911d,_0x11fe85){const _0x2881c8=a12_0x3784,_0x4ce242=_0x42911d();while(!![]){try{const _0x49f1be=-parseInt(_0x2881c8(0xe7))/0x1*(-parseInt(_0x2881c8(0xf1))/0x2)+-parseInt(_0x2881c8(0xe0))/0x3*(-parseInt(_0x2881c8(0xbe))/0x4)+-parseInt(_0x2881c8(0xed))/0x5*(-parseInt(_0x2881c8(0xbf))/0x6)+parseInt(_0x2881c8(0xe8))/0x7+parseInt(_0x2881c8(0xee))/0x8*(-parseInt(_0x2881c8(0xb9))/0x9)+parseInt(_0x2881c8(0xae))/0xa*(parseInt(_0x2881c8(0xe4))/0xb)+-parseInt(_0x2881c8(0xb5))/0xc;if(_0x49f1be===_0x11fe85)break;else _0x4ce242['push'](_0x4ce242['shift']());}catch(_0x58967c){_0x4ce242['push'](_0x4ce242['shift']());}}}(a12_0x2207,0x5f27c));var __importDefault=this&&this[a12_0x4b9a36(0xd8)]||function(_0x535955){return _0x535955&&_0x535955['__esModule']?_0x535955:{'default':_0x535955};};Object[a12_0x4b9a36(0xba)](exports,a12_0x4b9a36(0xc7),{'value':!![]}),exports['TelegramController']=void 0x0;function a12_0x3784(_0x547331,_0x5d77ff){const _0x2207bd=a12_0x2207();return a12_0x3784=function(_0x3784a5,_0x4ba333){_0x3784a5=_0x3784a5-0xad;let _0x2a6dc9=_0x2207bd[_0x3784a5];return _0x2a6dc9;},a12_0x3784(_0x547331,_0x5d77ff);}const telegramBotService_1=require(a12_0x4b9a36(0xcc)),database_1=__importDefault(require(a12_0x4b9a36(0xef)));function a12_0x2207(){const _0x1f5e5a=['Shop\x20not\x20found','15354240aRNnkX','test_payout_123','shop','createdAt','18RgFMSW','defineProperty','Message\x20is\x20required','custom','title','4spYKTr','4782IuYShb','amount','sendShopNotification','sendCustomNotification','getBotInfo','json','filter','USD','__esModule','Test\x20','method','length','details','../services/telegramBotService','firstName','query','status','payment','all','sendTestNotification','Telegram\x20user\x20not\x20found','isActive','username','updatedAt','count','__importDefault','Test\x20Product','getTelegramUsers','telegramId','findUnique','shopId','TelegramController','desc','2197842PKUQxh','currency','Shop\x20ID\x20is\x20required','paid','4301PKooNo','Broadcast\x20message\x20sent\x20successfully','bank_transfer','163cErWBq','1476916jXrdpv','sendPaymentNotification','sendPayoutNotification','isVerified','telegramUser','2265dGrvlo','1776784rnNGqh','../config/database','params','1874bXptuN','productName','plisio','getBotStatus','\x20notification\x20sent\x20successfully','gateway','findMany','map','Markdown','ceil','test_payment_123','payout','This\x20is\x20a\x20test\x20notification','true','Test\x20Notification','16780Uostfg','default','completed','telegramBotService','lastName','User\x20disconnected\x20successfully'];a12_0x2207=function(){return _0x1f5e5a;};return a12_0x2207();}class TelegramController{constructor(){const _0x162973=a12_0x4b9a36;this[_0x162973(0xf4)]=async(_0x113ba6,_0xf0763f,_0x18c656)=>{const _0x28c4eb=_0x162973;try{const _0x5b0edf=telegramBotService_1['telegramBotService'][_0x28c4eb(0xc3)](),_0x2f36c6=await database_1['default'][_0x28c4eb(0xec)]['count'](),_0x465e34=await database_1[_0x28c4eb(0xaf)]['telegramUser'][_0x28c4eb(0xd7)]({'where':{'isVerified':!![]}}),_0x688a50=await database_1[_0x28c4eb(0xaf)][_0x28c4eb(0xec)]['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xf0763f[_0x28c4eb(0xc4)]({'success':!![],'result':{'bot':{'isActive':_0x5b0edf[_0x28c4eb(0xd4)],'username':_0x5b0edf[_0x28c4eb(0xd5)]},'statistics':{'totalUsers':_0x2f36c6,'verifiedUsers':_0x465e34,'unverifiedUsers':_0x2f36c6-_0x465e34,'connectedShops':_0x688a50[_0x28c4eb(0xca)]}}});}catch(_0x5a035e){_0x18c656(_0x5a035e);}},this[_0x162973(0xda)]=async(_0x3f7021,_0x15986e,_0x5f0121)=>{const _0x163374=_0x162973;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2fc465}=_0x3f7021[_0x163374(0xce)],_0x363de1=(Number(page)-0x1)*Number(limit),_0x139d65={};_0x2fc465!==undefined&&(_0x139d65['isVerified']=_0x2fc465===_0x163374(0xfe));const [_0x297da6,_0x1772ec]=await Promise[_0x163374(0xd1)]([database_1[_0x163374(0xaf)][_0x163374(0xec)]['findMany']({'where':_0x139d65,'skip':_0x363de1,'take':Number(limit),'orderBy':{'createdAt':_0x163374(0xdf)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x163374(0xec)][_0x163374(0xd7)]({'where':_0x139d65})]);_0x15986e[_0x163374(0xc4)]({'success':!![],'users':_0x297da6[_0x163374(0xf8)](_0x33466b=>({'id':_0x33466b['id'],'telegramId':_0x33466b[_0x163374(0xdb)],'username':_0x33466b[_0x163374(0xd5)],'firstName':_0x33466b[_0x163374(0xcd)],'lastName':_0x33466b[_0x163374(0xb2)],'isVerified':_0x33466b[_0x163374(0xeb)],'shop':_0x33466b[_0x163374(0xb7)],'createdAt':_0x33466b[_0x163374(0xb8)],'updatedAt':_0x33466b[_0x163374(0xd6)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1772ec,'totalPages':Math[_0x163374(0xfa)](_0x1772ec/Number(limit))}});}catch(_0x5c2956){_0x5f0121(_0x5c2956);}},this['sendBroadcast']=async(_0x49c709,_0x395b26,_0x3d3905)=>{const _0x529d56=_0x162973;try{const {message:_0x3a1573,shopId:_0x67809f}=_0x49c709['body'];if(!_0x3a1573)return _0x395b26[_0x529d56(0xcf)](0x190)[_0x529d56(0xc4)]({'success':![],'message':_0x529d56(0xbb)});if(_0x67809f)await telegramBotService_1[_0x529d56(0xb1)][_0x529d56(0xc1)](_0x67809f,_0x3a1573,{'parse_mode':_0x529d56(0xf9)});else{const _0x222cc5=await database_1[_0x529d56(0xaf)][_0x529d56(0xec)][_0x529d56(0xf7)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x57ff36=[...new Set(_0x222cc5['map'](_0x67d1f7=>_0x67d1f7[_0x529d56(0xdd)])[_0x529d56(0xc5)](Boolean))];for(const _0x2e5197 of _0x57ff36){_0x2e5197&&await telegramBotService_1['telegramBotService'][_0x529d56(0xc1)](_0x2e5197,_0x3a1573,{'parse_mode':_0x529d56(0xf9)});}}_0x395b26['json']({'success':!![],'message':_0x529d56(0xe5)});}catch(_0x266750){_0x3d3905(_0x266750);}},this['disconnectUser']=async(_0x1699f8,_0x1a2c09,_0x33f140)=>{const _0x568a7c=_0x162973;try{const {telegramId:_0xa4e6d2}=_0x1699f8[_0x568a7c(0xf0)],_0x5d3fdd=await database_1['default'][_0x568a7c(0xec)]['findUnique']({'where':{'telegramId':_0xa4e6d2},'include':{'shop':!![]}});if(!_0x5d3fdd)return _0x1a2c09['status'](0x194)[_0x568a7c(0xc4)]({'success':![],'message':_0x568a7c(0xd3)});await database_1['default'][_0x568a7c(0xec)]['update']({'where':{'telegramId':_0xa4e6d2},'data':{'shopId':null,'isVerified':![]}}),_0x1a2c09['json']({'success':!![],'message':_0x568a7c(0xb3)});}catch(_0x18868a){_0x33f140(_0x18868a);}},this[_0x162973(0xd2)]=async(_0x35406e,_0x3871c4,_0x21b248)=>{const _0x597947=_0x162973;try{const {shopId:_0x36307c,type:type=_0x597947(0xd0),testData:_0x16d55c}=_0x35406e['body'];if(!_0x36307c)return _0x3871c4[_0x597947(0xcf)](0x190)[_0x597947(0xc4)]({'success':![],'message':_0x597947(0xe2)});const _0x41e9ec=await database_1[_0x597947(0xaf)][_0x597947(0xb7)][_0x597947(0xdc)]({'where':{'id':_0x36307c},'select':{'id':!![],'name':!![]}});if(!_0x41e9ec)return _0x3871c4[_0x597947(0xcf)](0x194)[_0x597947(0xc4)]({'success':![],'message':_0x597947(0xb4)});switch(type){case _0x597947(0xd0):const _0x30d8e7={'id':_0x597947(0xfb),'amount':_0x16d55c?.[_0x597947(0xc0)]||0x64,'currency':_0x16d55c?.[_0x597947(0xe1)]||_0x597947(0xc6),'productName':_0x16d55c?.[_0x597947(0xf2)]||_0x597947(0xd9),'gateway':_0x16d55c?.[_0x597947(0xf6)]||_0x597947(0xf3),'createdAt':new Date(),..._0x16d55c};await telegramBotService_1['telegramBotService'][_0x597947(0xe9)](_0x36307c,_0x30d8e7,_0x597947(0xe3));break;case _0x597947(0xfc):const _0x54faef={'id':_0x597947(0xb6),'amount':_0x16d55c?.[_0x597947(0xc0)]||0x1f4,'method':_0x16d55c?.[_0x597947(0xc9)]||_0x597947(0xe6),'createdAt':new Date(),..._0x16d55c};await telegramBotService_1[_0x597947(0xb1)][_0x597947(0xea)](_0x36307c,_0x54faef,_0x597947(0xb0));break;case _0x597947(0xbc):await telegramBotService_1[_0x597947(0xb1)][_0x597947(0xc2)](_0x36307c,_0x16d55c?.[_0x597947(0xbd)]||_0x597947(0xad),_0x16d55c?.[_0x597947(0xcb)]||{'message':_0x597947(0xfd)});break;default:return _0x3871c4['status'](0x190)[_0x597947(0xc4)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x3871c4['json']({'success':!![],'message':_0x597947(0xc8)+type+_0x597947(0xf5)});}catch(_0x33ec38){_0x21b248(_0x33ec38);}};}}exports[a12_0x4b9a36(0xde)]=TelegramController;