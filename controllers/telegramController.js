'use strict';function a12_0x3aee(_0x3b0a83,_0x438146){const _0x227700=a12_0x2277();return a12_0x3aee=function(_0x3aeef5,_0x2ea015){_0x3aeef5=_0x3aeef5-0x17f;let _0x1553ff=_0x227700[_0x3aeef5];return _0x1553ff;},a12_0x3aee(_0x3b0a83,_0x438146);}const a12_0x2877be=a12_0x3aee;function a12_0x2277(){const _0x331b29=['method','2876881rMuNbj','124FDtJuT','firstName','392091abfeen','__esModule','lastName','length','createdAt','title','Telegram\x20user\x20not\x20found','This\x20is\x20a\x20test\x20notification','shopId','telegramId','update','productName','2010078XkYFfn','Broadcast\x20message\x20sent\x20successfully','defineProperty','query','username','89820CWfVfR','sendCustomNotification','sendPaymentNotification','User\x20disconnected\x20successfully','body','findUnique','isVerified','payment','shop','375426WGcSHt','sendShopNotification','Test\x20Notification','count','paid','custom','status','../services/telegramBotService','params','4XSfKJf','currency','bank_transfer','sendBroadcast','Test\x20Product','isActive','sendPayoutNotification','473LuCKdw','Shop\x20not\x20found','findMany','json','657KLeNwa','Message\x20is\x20required','map','default','filter','plisio','Shop\x20ID\x20is\x20required','37180aXJNoY','desc','telegramUser','4456GHeRBv','true','amount','disconnectUser','test_payout_123','telegramBotService','Markdown'];a12_0x2277=function(){return _0x331b29;};return a12_0x2277();}(function(_0x492b98,_0x417726){const _0x26ad39=a12_0x3aee,_0x33d9f6=_0x492b98();while(!![]){try{const _0x2e7e4f=parseInt(_0x26ad39(0x19e))/0x1+-parseInt(_0x26ad39(0x1a7))/0x2*(parseInt(_0x26ad39(0x184))/0x3)+-parseInt(_0x26ad39(0x182))/0x4*(parseInt(_0x26ad39(0x1b9))/0x5)+parseInt(_0x26ad39(0x190))/0x6+parseInt(_0x26ad39(0x181))/0x7+-parseInt(_0x26ad39(0x1bc))/0x8*(-parseInt(_0x26ad39(0x1b2))/0x9)+parseInt(_0x26ad39(0x195))/0xa*(-parseInt(_0x26ad39(0x1ae))/0xb);if(_0x2e7e4f===_0x417726)break;else _0x33d9f6['push'](_0x33d9f6['shift']());}catch(_0x19ba2f){_0x33d9f6['push'](_0x33d9f6['shift']());}}}(a12_0x2277,0x4552b));var __importDefault=this&&this['__importDefault']||function(_0x5da584){const _0x1d5446=a12_0x3aee;return _0x5da584&&_0x5da584[_0x1d5446(0x185)]?_0x5da584:{'default':_0x5da584};};Object[a12_0x2877be(0x192)](exports,'__esModule',{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x2877be(0x1a5)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x45a577=a12_0x2877be;this['getBotStatus']=async(_0x26fc94,_0x474af6,_0x3bd7db)=>{const _0x2222ab=a12_0x3aee;try{const _0x24806d=telegramBotService_1['telegramBotService']['getBotInfo'](),_0x2e3a41=await database_1[_0x2222ab(0x1b5)][_0x2222ab(0x1bb)][_0x2222ab(0x1a1)](),_0x55160c=await database_1[_0x2222ab(0x1b5)][_0x2222ab(0x1bb)][_0x2222ab(0x1a1)]({'where':{'isVerified':!![]}}),_0x453ded=await database_1[_0x2222ab(0x1b5)]['telegramUser']['groupBy']({'by':[_0x2222ab(0x18c)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x474af6[_0x2222ab(0x1b1)]({'success':!![],'result':{'bot':{'isActive':_0x24806d[_0x2222ab(0x1ac)],'username':_0x24806d[_0x2222ab(0x194)]},'statistics':{'totalUsers':_0x2e3a41,'verifiedUsers':_0x55160c,'unverifiedUsers':_0x2e3a41-_0x55160c,'connectedShops':_0x453ded[_0x2222ab(0x187)]}}});}catch(_0x411bf4){_0x3bd7db(_0x411bf4);}},this['getTelegramUsers']=async(_0x38493d,_0x2ba389,_0x376601)=>{const _0x2d75fd=a12_0x3aee;try{const {page:page=0x1,limit:limit=0x14,verified:_0x31f626}=_0x38493d[_0x2d75fd(0x193)],_0x335776=(Number(page)-0x1)*Number(limit),_0x2a1a54={};_0x31f626!==undefined&&(_0x2a1a54[_0x2d75fd(0x19b)]=_0x31f626===_0x2d75fd(0x1bd));const [_0x43254b,_0x2bdedd]=await Promise['all']([database_1['default'][_0x2d75fd(0x1bb)]['findMany']({'where':_0x2a1a54,'skip':_0x335776,'take':Number(limit),'orderBy':{'createdAt':_0x2d75fd(0x1ba)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2d75fd(0x1b5)][_0x2d75fd(0x1bb)][_0x2d75fd(0x1a1)]({'where':_0x2a1a54})]);_0x2ba389[_0x2d75fd(0x1b1)]({'success':!![],'users':_0x43254b['map'](_0x235fb7=>({'id':_0x235fb7['id'],'telegramId':_0x235fb7[_0x2d75fd(0x18d)],'username':_0x235fb7[_0x2d75fd(0x194)],'firstName':_0x235fb7[_0x2d75fd(0x183)],'lastName':_0x235fb7[_0x2d75fd(0x186)],'isVerified':_0x235fb7['isVerified'],'shop':_0x235fb7[_0x2d75fd(0x19d)],'createdAt':_0x235fb7[_0x2d75fd(0x188)],'updatedAt':_0x235fb7['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2bdedd,'totalPages':Math['ceil'](_0x2bdedd/Number(limit))}});}catch(_0x4dafb0){_0x376601(_0x4dafb0);}},this[_0x45a577(0x1aa)]=async(_0x1b6cd8,_0x16ae30,_0x11be8b)=>{const _0x444c85=_0x45a577;try{const {message:_0x9c36f,shopId:_0x1ed73a}=_0x1b6cd8[_0x444c85(0x199)];if(!_0x9c36f)return _0x16ae30[_0x444c85(0x1a4)](0x190)['json']({'success':![],'message':_0x444c85(0x1b3)});if(_0x1ed73a)await telegramBotService_1[_0x444c85(0x1c1)][_0x444c85(0x19f)](_0x1ed73a,_0x9c36f,{'parse_mode':_0x444c85(0x17f)});else{const _0x29650b=await database_1[_0x444c85(0x1b5)][_0x444c85(0x1bb)][_0x444c85(0x1b0)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xb739e5=[...new Set(_0x29650b[_0x444c85(0x1b4)](_0x4ee2fd=>_0x4ee2fd['shopId'])[_0x444c85(0x1b6)](Boolean))];for(const _0x1e8a1f of _0xb739e5){_0x1e8a1f&&await telegramBotService_1[_0x444c85(0x1c1)][_0x444c85(0x19f)](_0x1e8a1f,_0x9c36f,{'parse_mode':_0x444c85(0x17f)});}}_0x16ae30[_0x444c85(0x1b1)]({'success':!![],'message':_0x444c85(0x191)});}catch(_0x5c171e){_0x11be8b(_0x5c171e);}},this[_0x45a577(0x1bf)]=async(_0x84d97c,_0x17caa3,_0xeab775)=>{const _0x332a93=_0x45a577;try{const {telegramId:_0x508f69}=_0x84d97c[_0x332a93(0x1a6)],_0x57de98=await database_1[_0x332a93(0x1b5)]['telegramUser'][_0x332a93(0x19a)]({'where':{'telegramId':_0x508f69},'include':{'shop':!![]}});if(!_0x57de98)return _0x17caa3[_0x332a93(0x1a4)](0x194)[_0x332a93(0x1b1)]({'success':![],'message':_0x332a93(0x18a)});await database_1[_0x332a93(0x1b5)]['telegramUser'][_0x332a93(0x18e)]({'where':{'telegramId':_0x508f69},'data':{'shopId':null,'isVerified':![]}}),_0x17caa3['json']({'success':!![],'message':_0x332a93(0x198)});}catch(_0x34c40c){_0xeab775(_0x34c40c);}},this['sendTestNotification']=async(_0x21f7d0,_0x159cc1,_0x57c783)=>{const _0x42ed1b=_0x45a577;try{const {shopId:_0x4f6bf3,type:type=_0x42ed1b(0x19c),testData:_0x1f5fda}=_0x21f7d0['body'];if(!_0x4f6bf3)return _0x159cc1[_0x42ed1b(0x1a4)](0x190)[_0x42ed1b(0x1b1)]({'success':![],'message':_0x42ed1b(0x1b8)});const _0x3d70de=await database_1[_0x42ed1b(0x1b5)][_0x42ed1b(0x19d)][_0x42ed1b(0x19a)]({'where':{'id':_0x4f6bf3},'select':{'id':!![],'name':!![]}});if(!_0x3d70de)return _0x159cc1[_0x42ed1b(0x1a4)](0x194)[_0x42ed1b(0x1b1)]({'success':![],'message':_0x42ed1b(0x1af)});switch(type){case _0x42ed1b(0x19c):const _0x135a85={'id':'test_payment_123','amount':_0x1f5fda?.[_0x42ed1b(0x1be)]||0x64,'currency':_0x1f5fda?.[_0x42ed1b(0x1a8)]||'USD','productName':_0x1f5fda?.[_0x42ed1b(0x18f)]||_0x42ed1b(0x1ab),'gateway':_0x1f5fda?.['gateway']||_0x42ed1b(0x1b7),'createdAt':new Date(),..._0x1f5fda};await telegramBotService_1['telegramBotService'][_0x42ed1b(0x197)](_0x4f6bf3,_0x135a85,_0x42ed1b(0x1a2));break;case'payout':const _0x2dfbb9={'id':_0x42ed1b(0x1c0),'amount':_0x1f5fda?.[_0x42ed1b(0x1be)]||0x1f4,'method':_0x1f5fda?.[_0x42ed1b(0x180)]||_0x42ed1b(0x1a9),'createdAt':new Date(),..._0x1f5fda};await telegramBotService_1[_0x42ed1b(0x1c1)][_0x42ed1b(0x1ad)](_0x4f6bf3,_0x2dfbb9,'completed');break;case _0x42ed1b(0x1a3):await telegramBotService_1[_0x42ed1b(0x1c1)][_0x42ed1b(0x196)](_0x4f6bf3,_0x1f5fda?.[_0x42ed1b(0x189)]||_0x42ed1b(0x1a0),_0x1f5fda?.['details']||{'message':_0x42ed1b(0x18b)});break;default:return _0x159cc1[_0x42ed1b(0x1a4)](0x190)[_0x42ed1b(0x1b1)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x159cc1[_0x42ed1b(0x1b1)]({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x57de34){_0x57c783(_0x57de34);}};}}exports['TelegramController']=TelegramController;