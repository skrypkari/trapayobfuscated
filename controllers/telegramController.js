'use strict';const a12_0xf27936=a12_0x173f;(function(_0x279282,_0x31194a){const _0xbf6bad=a12_0x173f,_0x20d2cb=_0x279282();while(!![]){try{const _0x2bf85c=-parseInt(_0xbf6bad(0x130))/0x1+parseInt(_0xbf6bad(0x135))/0x2+-parseInt(_0xbf6bad(0x11b))/0x3*(parseInt(_0xbf6bad(0x139))/0x4)+parseInt(_0xbf6bad(0x13d))/0x5*(-parseInt(_0xbf6bad(0x11d))/0x6)+parseInt(_0xbf6bad(0x11e))/0x7+-parseInt(_0xbf6bad(0x142))/0x8*(parseInt(_0xbf6bad(0x149))/0x9)+parseInt(_0xbf6bad(0x132))/0xa*(parseInt(_0xbf6bad(0x113))/0xb);if(_0x2bf85c===_0x31194a)break;else _0x20d2cb['push'](_0x20d2cb['shift']());}catch(_0x1c062b){_0x20d2cb['push'](_0x20d2cb['shift']());}}}(a12_0x1f6f,0x22caf));var __importDefault=this&&this[a12_0xf27936(0x131)]||function(_0x1452f3){return _0x1452f3&&_0x1452f3['__esModule']?_0x1452f3:{'default':_0x1452f3};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a12_0xf27936(0x146)]=void 0x0;function a12_0x1f6f(){const _0xbd20d2=['Broadcast\x20message\x20sent\x20successfully','telegramBotService','desc','status','getBotStatus','default','map','username','\x20notification\x20sent\x20successfully','payment','../config/database','currency','plisio','groupBy','sendBroadcast','length','filter','200322gHboFB','__importDefault','9230IxheLA','paid','count','515722lOCLme','shopId','true','details','51004mfUvOU','params','sendCustomNotification','sendPayoutNotification','9875IyIgSx','bank_transfer','isVerified','findUnique','../services/telegramBotService','64Kiwpgj','This\x20is\x20a\x20test\x20notification','sendTestNotification','telegramId','TelegramController','ceil','User\x20disconnected\x20successfully','189324uzJNDA','sendShopNotification','Telegram\x20user\x20not\x20found','Shop\x20ID\x20is\x20required','body','Test\x20Product','findMany','json','amount','Message\x20is\x20required','custom','telegramUser','productName','shop','firstName','completed','6567CcXgWI','method','Test\x20','test_payment_123','createdAt','lastName','test_payout_123','Test\x20Notification','63tavhCQ','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','690tJATZX','1379875oKaSJA'];a12_0x1f6f=function(){return _0xbd20d2;};return a12_0x1f6f();}const telegramBotService_1=require(a12_0xf27936(0x141)),database_1=__importDefault(require(a12_0xf27936(0x129)));class TelegramController{constructor(){const _0x38b54b=a12_0xf27936;this[_0x38b54b(0x123)]=async(_0x2df8ed,_0x493b10,_0x16309c)=>{const _0x112863=_0x38b54b;try{const _0x408c3e=telegramBotService_1[_0x112863(0x120)]['getBotInfo'](),_0x14b1a2=await database_1['default'][_0x112863(0x10e)][_0x112863(0x134)](),_0xcd2695=await database_1[_0x112863(0x124)]['telegramUser'][_0x112863(0x134)]({'where':{'isVerified':!![]}}),_0x48f19a=await database_1['default'][_0x112863(0x10e)][_0x112863(0x12c)]({'by':[_0x112863(0x136)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x493b10[_0x112863(0x10a)]({'success':!![],'result':{'bot':{'isActive':_0x408c3e['isActive'],'username':_0x408c3e['username']},'statistics':{'totalUsers':_0x14b1a2,'verifiedUsers':_0xcd2695,'unverifiedUsers':_0x14b1a2-_0xcd2695,'connectedShops':_0x48f19a[_0x112863(0x12e)]}}});}catch(_0x2fafdd){_0x16309c(_0x2fafdd);}},this['getTelegramUsers']=async(_0x407cd8,_0x405a67,_0x3c814f)=>{const _0x53f4ab=_0x38b54b;try{const {page:page=0x1,limit:limit=0x14,verified:_0x24e138}=_0x407cd8['query'],_0x280f95=(Number(page)-0x1)*Number(limit),_0x38d7f6={};_0x24e138!==undefined&&(_0x38d7f6[_0x53f4ab(0x13f)]=_0x24e138===_0x53f4ab(0x137));const [_0x534c19,_0x313ddd]=await Promise['all']([database_1[_0x53f4ab(0x124)][_0x53f4ab(0x10e)][_0x53f4ab(0x109)]({'where':_0x38d7f6,'skip':_0x280f95,'take':Number(limit),'orderBy':{'createdAt':_0x53f4ab(0x121)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x53f4ab(0x124)][_0x53f4ab(0x10e)]['count']({'where':_0x38d7f6})]);_0x405a67[_0x53f4ab(0x10a)]({'success':!![],'users':_0x534c19[_0x53f4ab(0x125)](_0xfcc13b=>({'id':_0xfcc13b['id'],'telegramId':_0xfcc13b[_0x53f4ab(0x145)],'username':_0xfcc13b[_0x53f4ab(0x126)],'firstName':_0xfcc13b[_0x53f4ab(0x111)],'lastName':_0xfcc13b[_0x53f4ab(0x118)],'isVerified':_0xfcc13b[_0x53f4ab(0x13f)],'shop':_0xfcc13b['shop'],'createdAt':_0xfcc13b[_0x53f4ab(0x117)],'updatedAt':_0xfcc13b['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x313ddd,'totalPages':Math[_0x53f4ab(0x147)](_0x313ddd/Number(limit))}});}catch(_0x37b632){_0x3c814f(_0x37b632);}},this[_0x38b54b(0x12d)]=async(_0x1e9db0,_0x3b9ffc,_0x180795)=>{const _0x2b0856=_0x38b54b;try{const {message:_0x482ef9,shopId:_0x50af51}=_0x1e9db0[_0x2b0856(0x107)];if(!_0x482ef9)return _0x3b9ffc[_0x2b0856(0x122)](0x190)[_0x2b0856(0x10a)]({'success':![],'message':_0x2b0856(0x10c)});if(_0x50af51)await telegramBotService_1[_0x2b0856(0x120)][_0x2b0856(0x14a)](_0x50af51,_0x482ef9,{'parse_mode':'Markdown'});else{const _0x130fdd=await database_1[_0x2b0856(0x124)][_0x2b0856(0x10e)][_0x2b0856(0x109)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2e6bfa=[...new Set(_0x130fdd[_0x2b0856(0x125)](_0x5e2e44=>_0x5e2e44[_0x2b0856(0x136)])[_0x2b0856(0x12f)](Boolean))];for(const _0x3a135a of _0x2e6bfa){_0x3a135a&&await telegramBotService_1[_0x2b0856(0x120)][_0x2b0856(0x14a)](_0x3a135a,_0x482ef9,{'parse_mode':'Markdown'});}}_0x3b9ffc[_0x2b0856(0x10a)]({'success':!![],'message':_0x2b0856(0x11f)});}catch(_0x38365){_0x180795(_0x38365);}},this['disconnectUser']=async(_0x52a8e4,_0x60f309,_0x1e83ed)=>{const _0x2734eb=_0x38b54b;try{const {telegramId:_0x3a6871}=_0x52a8e4[_0x2734eb(0x13a)],_0x4d3e05=await database_1[_0x2734eb(0x124)][_0x2734eb(0x10e)][_0x2734eb(0x140)]({'where':{'telegramId':_0x3a6871},'include':{'shop':!![]}});if(!_0x4d3e05)return _0x60f309[_0x2734eb(0x122)](0x194)[_0x2734eb(0x10a)]({'success':![],'message':_0x2734eb(0x14b)});await database_1[_0x2734eb(0x124)][_0x2734eb(0x10e)]['update']({'where':{'telegramId':_0x3a6871},'data':{'shopId':null,'isVerified':![]}}),_0x60f309[_0x2734eb(0x10a)]({'success':!![],'message':_0x2734eb(0x148)});}catch(_0x1fe741){_0x1e83ed(_0x1fe741);}},this[_0x38b54b(0x144)]=async(_0x10a916,_0x3b55c1,_0x12a2ee)=>{const _0x5e52b5=_0x38b54b;try{const {shopId:_0x4d7d2f,type:type='payment',testData:_0x134cd8}=_0x10a916[_0x5e52b5(0x107)];if(!_0x4d7d2f)return _0x3b55c1[_0x5e52b5(0x122)](0x190)[_0x5e52b5(0x10a)]({'success':![],'message':_0x5e52b5(0x106)});const _0x41cb01=await database_1[_0x5e52b5(0x124)][_0x5e52b5(0x110)][_0x5e52b5(0x140)]({'where':{'id':_0x4d7d2f},'select':{'id':!![],'name':!![]}});if(!_0x41cb01)return _0x3b55c1['status'](0x194)[_0x5e52b5(0x10a)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x5e52b5(0x128):const _0x1c04b6={'id':_0x5e52b5(0x116),'amount':_0x134cd8?.[_0x5e52b5(0x10b)]||0x64,'currency':_0x134cd8?.[_0x5e52b5(0x12a)]||'USD','productName':_0x134cd8?.[_0x5e52b5(0x10f)]||_0x5e52b5(0x108),'gateway':_0x134cd8?.['gateway']||_0x5e52b5(0x12b),'createdAt':new Date(),..._0x134cd8};await telegramBotService_1[_0x5e52b5(0x120)]['sendPaymentNotification'](_0x4d7d2f,_0x1c04b6,_0x5e52b5(0x133));break;case'payout':const _0x5dbacf={'id':_0x5e52b5(0x119),'amount':_0x134cd8?.[_0x5e52b5(0x10b)]||0x1f4,'method':_0x134cd8?.[_0x5e52b5(0x114)]||_0x5e52b5(0x13e),'createdAt':new Date(),..._0x134cd8};await telegramBotService_1['telegramBotService'][_0x5e52b5(0x13c)](_0x4d7d2f,_0x5dbacf,_0x5e52b5(0x112));break;case _0x5e52b5(0x10d):await telegramBotService_1[_0x5e52b5(0x120)][_0x5e52b5(0x13b)](_0x4d7d2f,_0x134cd8?.['title']||_0x5e52b5(0x11a),_0x134cd8?.[_0x5e52b5(0x138)]||{'message':_0x5e52b5(0x143)});break;default:return _0x3b55c1['status'](0x190)[_0x5e52b5(0x10a)]({'success':![],'message':_0x5e52b5(0x11c)});}_0x3b55c1[_0x5e52b5(0x10a)]({'success':!![],'message':_0x5e52b5(0x115)+type+_0x5e52b5(0x127)});}catch(_0x184241){_0x12a2ee(_0x184241);}};}}function a12_0x173f(_0x27f9ac,_0xbe42bd){const _0x1f6fa9=a12_0x1f6f();return a12_0x173f=function(_0x173f14,_0x1eced9){_0x173f14=_0x173f14-0x106;let _0x24b810=_0x1f6fa9[_0x173f14];return _0x24b810;},a12_0x173f(_0x27f9ac,_0xbe42bd);}exports[a12_0xf27936(0x146)]=TelegramController;