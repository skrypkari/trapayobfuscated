'use strict';function a12_0x214e(_0x4a1dc0,_0x41148a){const _0x84e118=a12_0x84e1();return a12_0x214e=function(_0x214e73,_0x17e911){_0x214e73=_0x214e73-0x19e;let _0x462cbd=_0x84e118[_0x214e73];return _0x462cbd;},a12_0x214e(_0x4a1dc0,_0x41148a);}const a12_0x435a7f=a12_0x214e;function a12_0x84e1(){const _0x27ee28=['sendShopNotification','sendCustomNotification','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','shopId','amount','body','params','Message\x20is\x20required','length','desc','json','5154342lLirqi','Test\x20Notification','sendPayoutNotification','productName','title','lastName','sendBroadcast','456732iyKPnQ','2375mcIFLk','query','groupBy','telegramUser','../services/telegramBotService','Telegram\x20user\x20not\x20found','\x20notification\x20sent\x20successfully','disconnectUser','Broadcast\x20message\x20sent\x20successfully','update','USD','createdAt','findMany','currency','test_payout_123','status','getTelegramUsers','User\x20disconnected\x20successfully','getBotInfo','shop','payout','isVerified','../config/database','This\x20is\x20a\x20test\x20notification','count','1695581RqNHYE','updatedAt','Test\x20Product','telegramBotService','20514nsxWQF','filter','TelegramController','default','findUnique','all','Test\x20','ceil','Shop\x20not\x20found','true','8jEdaQq','Markdown','__esModule','telegramId','9535393mHTyqS','2711664IvujIX','getBotStatus','test_payment_123','23694489GkSZOB','details','payment','completed','map'];a12_0x84e1=function(){return _0x27ee28;};return a12_0x84e1();}(function(_0x4d9976,_0x209b4a){const _0x58a7bd=a12_0x214e,_0x177af1=_0x4d9976();while(!![]){try{const _0x14287e=-parseInt(_0x58a7bd(0x1dd))/0x1+-parseInt(_0x58a7bd(0x1a9))/0x2+-parseInt(_0x58a7bd(0x1bc))/0x3+parseInt(_0x58a7bd(0x1c3))/0x4+-parseInt(_0x58a7bd(0x1c4))/0x5*(-parseInt(_0x58a7bd(0x1e1))/0x6)+-parseInt(_0x58a7bd(0x1a8))/0x7*(-parseInt(_0x58a7bd(0x1a4))/0x8)+parseInt(_0x58a7bd(0x1ac))/0x9;if(_0x14287e===_0x209b4a)break;else _0x177af1['push'](_0x177af1['shift']());}catch(_0x196f3e){_0x177af1['push'](_0x177af1['shift']());}}}(a12_0x84e1,0xeb411));var __importDefault=this&&this['__importDefault']||function(_0x34f86c){return _0x34f86c&&_0x34f86c['__esModule']?_0x34f86c:{'default':_0x34f86c};};Object['defineProperty'](exports,a12_0x435a7f(0x1a6),{'value':!![]}),exports[a12_0x435a7f(0x1e3)]=void 0x0;const telegramBotService_1=require(a12_0x435a7f(0x1c8)),database_1=__importDefault(require(a12_0x435a7f(0x1da)));class TelegramController{constructor(){const _0x31d5d3=a12_0x435a7f;this[_0x31d5d3(0x1aa)]=async(_0x2077ae,_0x2aac42,_0x1aa4b5)=>{const _0xc7b7c9=_0x31d5d3;try{const _0x4f287c=telegramBotService_1[_0xc7b7c9(0x1e0)][_0xc7b7c9(0x1d6)](),_0x4c1741=await database_1[_0xc7b7c9(0x1e4)]['telegramUser'][_0xc7b7c9(0x1dc)](),_0x3eeb19=await database_1[_0xc7b7c9(0x1e4)]['telegramUser'][_0xc7b7c9(0x1dc)]({'where':{'isVerified':!![]}}),_0x397d92=await database_1[_0xc7b7c9(0x1e4)][_0xc7b7c9(0x1c7)][_0xc7b7c9(0x1c6)]({'by':[_0xc7b7c9(0x1b4)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2aac42[_0xc7b7c9(0x1bb)]({'success':!![],'result':{'bot':{'isActive':_0x4f287c['isActive'],'username':_0x4f287c['username']},'statistics':{'totalUsers':_0x4c1741,'verifiedUsers':_0x3eeb19,'unverifiedUsers':_0x4c1741-_0x3eeb19,'connectedShops':_0x397d92[_0xc7b7c9(0x1b9)]}}});}catch(_0x19596f){_0x1aa4b5(_0x19596f);}},this[_0x31d5d3(0x1d4)]=async(_0x1b47bd,_0x403bec,_0x11f2e7)=>{const _0x354bce=_0x31d5d3;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4a929c}=_0x1b47bd[_0x354bce(0x1c5)],_0x45f3e0=(Number(page)-0x1)*Number(limit),_0x2c98d7={};_0x4a929c!==undefined&&(_0x2c98d7['isVerified']=_0x4a929c===_0x354bce(0x1a3));const [_0x3eb4d0,_0x48ffdd]=await Promise[_0x354bce(0x19f)]([database_1[_0x354bce(0x1e4)][_0x354bce(0x1c7)][_0x354bce(0x1d0)]({'where':_0x2c98d7,'skip':_0x45f3e0,'take':Number(limit),'orderBy':{'createdAt':_0x354bce(0x1ba)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x354bce(0x1e4)][_0x354bce(0x1c7)][_0x354bce(0x1dc)]({'where':_0x2c98d7})]);_0x403bec[_0x354bce(0x1bb)]({'success':!![],'users':_0x3eb4d0[_0x354bce(0x1b0)](_0xfca7d1=>({'id':_0xfca7d1['id'],'telegramId':_0xfca7d1[_0x354bce(0x1a7)],'username':_0xfca7d1['username'],'firstName':_0xfca7d1['firstName'],'lastName':_0xfca7d1[_0x354bce(0x1c1)],'isVerified':_0xfca7d1[_0x354bce(0x1d9)],'shop':_0xfca7d1[_0x354bce(0x1d7)],'createdAt':_0xfca7d1[_0x354bce(0x1cf)],'updatedAt':_0xfca7d1[_0x354bce(0x1de)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x48ffdd,'totalPages':Math[_0x354bce(0x1a1)](_0x48ffdd/Number(limit))}});}catch(_0x55771e){_0x11f2e7(_0x55771e);}},this[_0x31d5d3(0x1c2)]=async(_0x5b72b3,_0xa47b5e,_0x1122b9)=>{const _0x130ba2=_0x31d5d3;try{const {message:_0x5ee054,shopId:_0x52c107}=_0x5b72b3['body'];if(!_0x5ee054)return _0xa47b5e[_0x130ba2(0x1d3)](0x190)['json']({'success':![],'message':_0x130ba2(0x1b8)});if(_0x52c107)await telegramBotService_1[_0x130ba2(0x1e0)][_0x130ba2(0x1b1)](_0x52c107,_0x5ee054,{'parse_mode':'Markdown'});else{const _0x3ae62e=await database_1[_0x130ba2(0x1e4)]['telegramUser'][_0x130ba2(0x1d0)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xa63798=[...new Set(_0x3ae62e[_0x130ba2(0x1b0)](_0x17535d=>_0x17535d[_0x130ba2(0x1b4)])[_0x130ba2(0x1e2)](Boolean))];for(const _0x3c3b1e of _0xa63798){_0x3c3b1e&&await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x3c3b1e,_0x5ee054,{'parse_mode':_0x130ba2(0x1a5)});}}_0xa47b5e['json']({'success':!![],'message':_0x130ba2(0x1cc)});}catch(_0x4ccce7){_0x1122b9(_0x4ccce7);}},this[_0x31d5d3(0x1cb)]=async(_0xadfef5,_0x423b24,_0x300f49)=>{const _0x4f3235=_0x31d5d3;try{const {telegramId:_0x12c632}=_0xadfef5[_0x4f3235(0x1b7)],_0x98bc7b=await database_1[_0x4f3235(0x1e4)][_0x4f3235(0x1c7)][_0x4f3235(0x19e)]({'where':{'telegramId':_0x12c632},'include':{'shop':!![]}});if(!_0x98bc7b)return _0x423b24['status'](0x194)[_0x4f3235(0x1bb)]({'success':![],'message':_0x4f3235(0x1c9)});await database_1['default']['telegramUser'][_0x4f3235(0x1cd)]({'where':{'telegramId':_0x12c632},'data':{'shopId':null,'isVerified':![]}}),_0x423b24['json']({'success':!![],'message':_0x4f3235(0x1d5)});}catch(_0x1d74c1){_0x300f49(_0x1d74c1);}},this['sendTestNotification']=async(_0x335b67,_0x8e73af,_0x32a24f)=>{const _0x56df37=_0x31d5d3;try{const {shopId:_0x13ad7e,type:type=_0x56df37(0x1ae),testData:_0x36c22b}=_0x335b67[_0x56df37(0x1b6)];if(!_0x13ad7e)return _0x8e73af['status'](0x190)[_0x56df37(0x1bb)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x452e5b=await database_1[_0x56df37(0x1e4)][_0x56df37(0x1d7)][_0x56df37(0x19e)]({'where':{'id':_0x13ad7e},'select':{'id':!![],'name':!![]}});if(!_0x452e5b)return _0x8e73af[_0x56df37(0x1d3)](0x194)[_0x56df37(0x1bb)]({'success':![],'message':_0x56df37(0x1a2)});switch(type){case _0x56df37(0x1ae):const _0x458438={'id':_0x56df37(0x1ab),'amount':_0x36c22b?.[_0x56df37(0x1b5)]||0x64,'currency':_0x36c22b?.[_0x56df37(0x1d1)]||_0x56df37(0x1ce),'productName':_0x36c22b?.[_0x56df37(0x1bf)]||_0x56df37(0x1df),'gateway':_0x36c22b?.['gateway']||'plisio','createdAt':new Date(),..._0x36c22b};await telegramBotService_1[_0x56df37(0x1e0)]['sendPaymentNotification'](_0x13ad7e,_0x458438,'paid');break;case _0x56df37(0x1d8):const _0x330c52={'id':_0x56df37(0x1d2),'amount':_0x36c22b?.['amount']||0x1f4,'method':_0x36c22b?.['method']||'bank_transfer','createdAt':new Date(),..._0x36c22b};await telegramBotService_1[_0x56df37(0x1e0)][_0x56df37(0x1be)](_0x13ad7e,_0x330c52,_0x56df37(0x1af));break;case'custom':await telegramBotService_1['telegramBotService'][_0x56df37(0x1b2)](_0x13ad7e,_0x36c22b?.[_0x56df37(0x1c0)]||_0x56df37(0x1bd),_0x36c22b?.[_0x56df37(0x1ad)]||{'message':_0x56df37(0x1db)});break;default:return _0x8e73af['status'](0x190)[_0x56df37(0x1bb)]({'success':![],'message':_0x56df37(0x1b3)});}_0x8e73af[_0x56df37(0x1bb)]({'success':!![],'message':_0x56df37(0x1a0)+type+_0x56df37(0x1ca)});}catch(_0x4aaf27){_0x32a24f(_0x4aaf27);}};}}exports[a12_0x435a7f(0x1e3)]=TelegramController;