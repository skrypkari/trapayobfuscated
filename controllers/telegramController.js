'use strict';const a12_0x5b4433=a12_0x1338;(function(_0x5b6087,_0x408417){const _0x29aa28=a12_0x1338,_0x43dc03=_0x5b6087();while(!![]){try{const _0x4b3861=-parseInt(_0x29aa28(0x141))/0x1*(parseInt(_0x29aa28(0x12f))/0x2)+-parseInt(_0x29aa28(0x124))/0x3+parseInt(_0x29aa28(0x127))/0x4*(parseInt(_0x29aa28(0x11e))/0x5)+parseInt(_0x29aa28(0x14b))/0x6+parseInt(_0x29aa28(0x12b))/0x7+parseInt(_0x29aa28(0x11a))/0x8*(-parseInt(_0x29aa28(0x153))/0x9)+parseInt(_0x29aa28(0x154))/0xa;if(_0x4b3861===_0x408417)break;else _0x43dc03['push'](_0x43dc03['shift']());}catch(_0xfeb260){_0x43dc03['push'](_0x43dc03['shift']());}}}(a12_0x4d3c,0xb7aa5));var __importDefault=this&&this[a12_0x5b4433(0x137)]||function(_0x24691f){const _0x1ee348=a12_0x5b4433;return _0x24691f&&_0x24691f[_0x1ee348(0x140)]?_0x24691f:{'default':_0x24691f};};Object[a12_0x5b4433(0x145)](exports,a12_0x5b4433(0x140),{'value':!![]}),exports[a12_0x5b4433(0x139)]=void 0x0;function a12_0x4d3c(){const _0x322d6e=['30sLIcRh','json','update','username','groupBy','telegramId','612474tvVMEW','test_payout_123','findMany','766680VUDibl','sendShopNotification','updatedAt','method','1977528TzXtCC','ceil','map','This\x20is\x20a\x20test\x20notification','2802UPkBFK','User\x20disconnected\x20successfully','lastName','findUnique','length','Test\x20Product','payout','sendTestNotification','__importDefault','firstName','TelegramController','getTelegramUsers','filter','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','createdAt','count','Shop\x20ID\x20is\x20required','__esModule','695lSylmK','details','productName','sendPaymentNotification','defineProperty','sendPayoutNotification','../services/telegramBotService','status','Test\x20Notification','telegramUser','3805332JtHyFo','custom','true','params','plisio','shopId','\x20notification\x20sent\x20successfully','amount','2675709HTviYF','4580020BREEaM','Markdown','completed','test_payment_123','USD','shop','Message\x20is\x20required','sendCustomNotification','Broadcast\x20message\x20sent\x20successfully','telegramBotService','bank_transfer','Test\x20','getBotInfo','query','default','disconnectUser','Shop\x20not\x20found','16vSPDtM','title','isVerified','getBotStatus'];a12_0x4d3c=function(){return _0x322d6e;};return a12_0x4d3c();}function a12_0x1338(_0x10f96a,_0x5461a6){const _0x4d3c9a=a12_0x4d3c();return a12_0x1338=function(_0x133821,_0x40b185){_0x133821=_0x133821-0x110;let _0x2d4a95=_0x4d3c9a[_0x133821];return _0x2d4a95;},a12_0x1338(_0x10f96a,_0x5461a6);}const telegramBotService_1=require(a12_0x5b4433(0x147)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x422ca0=a12_0x5b4433;this[_0x422ca0(0x11d)]=async(_0x26fb6f,_0x47369e,_0x2e141f)=>{const _0x3fcd9b=_0x422ca0;try{const _0x48c0c0=telegramBotService_1[_0x3fcd9b(0x112)][_0x3fcd9b(0x115)](),_0x4797b7=await database_1[_0x3fcd9b(0x117)]['telegramUser'][_0x3fcd9b(0x13e)](),_0xe6c273=await database_1[_0x3fcd9b(0x117)]['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x54f10d=await database_1[_0x3fcd9b(0x117)][_0x3fcd9b(0x14a)][_0x3fcd9b(0x122)]({'by':[_0x3fcd9b(0x150)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x47369e[_0x3fcd9b(0x11f)]({'success':!![],'result':{'bot':{'isActive':_0x48c0c0['isActive'],'username':_0x48c0c0['username']},'statistics':{'totalUsers':_0x4797b7,'verifiedUsers':_0xe6c273,'unverifiedUsers':_0x4797b7-_0xe6c273,'connectedShops':_0x54f10d[_0x3fcd9b(0x133)]}}});}catch(_0x58261f){_0x2e141f(_0x58261f);}},this[_0x422ca0(0x13a)]=async(_0xfdd8ee,_0x5cbed4,_0x49952d)=>{const _0xf27cff=_0x422ca0;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5d5a95}=_0xfdd8ee[_0xf27cff(0x116)],_0x1f7a3f=(Number(page)-0x1)*Number(limit),_0x441f83={};_0x5d5a95!==undefined&&(_0x441f83[_0xf27cff(0x11c)]=_0x5d5a95===_0xf27cff(0x14d));const [_0x4fc590,_0x443a33]=await Promise['all']([database_1['default'][_0xf27cff(0x14a)][_0xf27cff(0x126)]({'where':_0x441f83,'skip':_0x1f7a3f,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0xf27cff(0x117)][_0xf27cff(0x14a)][_0xf27cff(0x13e)]({'where':_0x441f83})]);_0x5cbed4['json']({'success':!![],'users':_0x4fc590[_0xf27cff(0x12d)](_0x5613a4=>({'id':_0x5613a4['id'],'telegramId':_0x5613a4[_0xf27cff(0x123)],'username':_0x5613a4[_0xf27cff(0x121)],'firstName':_0x5613a4[_0xf27cff(0x138)],'lastName':_0x5613a4[_0xf27cff(0x131)],'isVerified':_0x5613a4[_0xf27cff(0x11c)],'shop':_0x5613a4['shop'],'createdAt':_0x5613a4[_0xf27cff(0x13d)],'updatedAt':_0x5613a4[_0xf27cff(0x129)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x443a33,'totalPages':Math[_0xf27cff(0x12c)](_0x443a33/Number(limit))}});}catch(_0x29283f){_0x49952d(_0x29283f);}},this['sendBroadcast']=async(_0xc08193,_0x279709,_0x43fc9f)=>{const _0x54bdda=_0x422ca0;try{const {message:_0x182bf2,shopId:_0x224988}=_0xc08193['body'];if(!_0x182bf2)return _0x279709[_0x54bdda(0x148)](0x190)[_0x54bdda(0x11f)]({'success':![],'message':_0x54bdda(0x15a)});if(_0x224988)await telegramBotService_1['telegramBotService'][_0x54bdda(0x128)](_0x224988,_0x182bf2,{'parse_mode':_0x54bdda(0x155)});else{const _0x3eba73=await database_1['default'][_0x54bdda(0x14a)][_0x54bdda(0x126)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2dd416=[...new Set(_0x3eba73[_0x54bdda(0x12d)](_0x1ae9e9=>_0x1ae9e9[_0x54bdda(0x150)])[_0x54bdda(0x13b)](Boolean))];for(const _0x4b0d32 of _0x2dd416){_0x4b0d32&&await telegramBotService_1[_0x54bdda(0x112)][_0x54bdda(0x128)](_0x4b0d32,_0x182bf2,{'parse_mode':_0x54bdda(0x155)});}}_0x279709[_0x54bdda(0x11f)]({'success':!![],'message':_0x54bdda(0x111)});}catch(_0x590b27){_0x43fc9f(_0x590b27);}},this[_0x422ca0(0x118)]=async(_0x2a28ca,_0x3eaddb,_0x1e451f)=>{const _0x5eff9e=_0x422ca0;try{const {telegramId:_0x4fbbe0}=_0x2a28ca[_0x5eff9e(0x14e)],_0x49e22f=await database_1[_0x5eff9e(0x117)][_0x5eff9e(0x14a)][_0x5eff9e(0x132)]({'where':{'telegramId':_0x4fbbe0},'include':{'shop':!![]}});if(!_0x49e22f)return _0x3eaddb['status'](0x194)[_0x5eff9e(0x11f)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x5eff9e(0x117)][_0x5eff9e(0x14a)][_0x5eff9e(0x120)]({'where':{'telegramId':_0x4fbbe0},'data':{'shopId':null,'isVerified':![]}}),_0x3eaddb[_0x5eff9e(0x11f)]({'success':!![],'message':_0x5eff9e(0x130)});}catch(_0x3a419c){_0x1e451f(_0x3a419c);}},this[_0x422ca0(0x136)]=async(_0x572915,_0x1abd84,_0x384882)=>{const _0x10e012=_0x422ca0;try{const {shopId:_0x575aff,type:type='payment',testData:_0x43f2c8}=_0x572915['body'];if(!_0x575aff)return _0x1abd84[_0x10e012(0x148)](0x190)[_0x10e012(0x11f)]({'success':![],'message':_0x10e012(0x13f)});const _0x5f4ecb=await database_1['default'][_0x10e012(0x159)][_0x10e012(0x132)]({'where':{'id':_0x575aff},'select':{'id':!![],'name':!![]}});if(!_0x5f4ecb)return _0x1abd84[_0x10e012(0x148)](0x194)[_0x10e012(0x11f)]({'success':![],'message':_0x10e012(0x119)});switch(type){case'payment':const _0x3eabce={'id':_0x10e012(0x157),'amount':_0x43f2c8?.[_0x10e012(0x152)]||0x64,'currency':_0x43f2c8?.['currency']||_0x10e012(0x158),'productName':_0x43f2c8?.[_0x10e012(0x143)]||_0x10e012(0x134),'gateway':_0x43f2c8?.['gateway']||_0x10e012(0x14f),'createdAt':new Date(),..._0x43f2c8};await telegramBotService_1['telegramBotService'][_0x10e012(0x144)](_0x575aff,_0x3eabce,'paid');break;case _0x10e012(0x135):const _0x52197f={'id':_0x10e012(0x125),'amount':_0x43f2c8?.[_0x10e012(0x152)]||0x1f4,'method':_0x43f2c8?.[_0x10e012(0x12a)]||_0x10e012(0x113),'createdAt':new Date(),..._0x43f2c8};await telegramBotService_1['telegramBotService'][_0x10e012(0x146)](_0x575aff,_0x52197f,_0x10e012(0x156));break;case _0x10e012(0x14c):await telegramBotService_1[_0x10e012(0x112)][_0x10e012(0x110)](_0x575aff,_0x43f2c8?.[_0x10e012(0x11b)]||_0x10e012(0x149),_0x43f2c8?.[_0x10e012(0x142)]||{'message':_0x10e012(0x12e)});break;default:return _0x1abd84[_0x10e012(0x148)](0x190)['json']({'success':![],'message':_0x10e012(0x13c)});}_0x1abd84['json']({'success':!![],'message':_0x10e012(0x114)+type+_0x10e012(0x151)});}catch(_0x130194){_0x384882(_0x130194);}};}}exports[a12_0x5b4433(0x139)]=TelegramController;