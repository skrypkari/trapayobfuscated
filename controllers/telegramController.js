'use strict';function a13_0x2b2e(){const _0x361858=['gateway','sendPayoutNotification','updatedAt','Broadcast\x20message\x20sent\x20successfully','Message\x20is\x20required','map','isVerified','93370RFbuDu','telegramUser','sendShopNotification','filter','currency','params','shop','groupBy','Test\x20Product','Shop\x20ID\x20is\x20required','username','6130tyFIxZ','sendTestNotification','payout','2735106vcvqcs','lastName','all','sendPaymentNotification','telegramBotService','title','sendCustomNotification','completed','body','Shop\x20not\x20found','findUnique','custom','query','test_payout_123','plisio','getBotStatus','28107OLRgTw','Telegram\x20user\x20not\x20found','paid','bank_transfer','4309977puXmNV','../services/telegramBotService','This\x20is\x20a\x20test\x20notification','Test\x20Notification','getBotInfo','true','count','desc','__esModule','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','amount','firstName','shopId','User\x20disconnected\x20successfully','../config/database','224jRQWzS','getTelegramUsers','TelegramController','telegramId','productName','defineProperty','default','USD','length','status','payment','isActive','14DsQUiS','76646QOOipU','ceil','Markdown','update','details','8432788neAIVK','json','794960rJcOcp'];a13_0x2b2e=function(){return _0x361858;};return a13_0x2b2e();}function a13_0x5528(_0x267a4a,_0x87f335){const _0x2b2edd=a13_0x2b2e();return a13_0x5528=function(_0x55284f,_0x9b9fa6){_0x55284f=_0x55284f-0xd5;let _0x368f76=_0x2b2edd[_0x55284f];return _0x368f76;},a13_0x5528(_0x267a4a,_0x87f335);}const a13_0x2fcb39=a13_0x5528;(function(_0x2995ba,_0x355798){const _0x32448e=a13_0x5528,_0x25a55c=_0x2995ba();while(!![]){try{const _0x960fef=-parseInt(_0x32448e(0xd5))/0x1*(-parseInt(_0x32448e(0x121))/0x2)+parseInt(_0x32448e(0x106))/0x3+-parseInt(_0x32448e(0x115))/0x4*(parseInt(_0x32448e(0xe4))/0x5)+parseInt(_0x32448e(0xf2))/0x6+parseInt(_0x32448e(0xda))/0x7+parseInt(_0x32448e(0xdc))/0x8+-parseInt(_0x32448e(0x102))/0x9*(parseInt(_0x32448e(0xef))/0xa);if(_0x960fef===_0x355798)break;else _0x25a55c['push'](_0x25a55c['shift']());}catch(_0x296114){_0x25a55c['push'](_0x25a55c['shift']());}}}(a13_0x2b2e,0xbcb4f));var __importDefault=this&&this['__importDefault']||function(_0x56e74b){const _0x31ee29=a13_0x5528;return _0x56e74b&&_0x56e74b[_0x31ee29(0x10e)]?_0x56e74b:{'default':_0x56e74b};};Object[a13_0x2fcb39(0x11a)](exports,a13_0x2fcb39(0x10e),{'value':!![]}),exports[a13_0x2fcb39(0x117)]=void 0x0;const telegramBotService_1=require(a13_0x2fcb39(0x107)),database_1=__importDefault(require(a13_0x2fcb39(0x114)));class TelegramController{constructor(){const _0x207379=a13_0x2fcb39;this[_0x207379(0x101)]=async(_0xad4515,_0x24e6ef,_0x42067c)=>{const _0x4c194d=_0x207379;try{const _0xfdf0e1=telegramBotService_1[_0x4c194d(0xf6)][_0x4c194d(0x10a)](),_0x25679a=await database_1[_0x4c194d(0x11b)]['telegramUser'][_0x4c194d(0x10c)](),_0x55874f=await database_1['default'][_0x4c194d(0xe5)]['count']({'where':{'isVerified':!![]}}),_0x132287=await database_1[_0x4c194d(0x11b)]['telegramUser'][_0x4c194d(0xeb)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x24e6ef[_0x4c194d(0xdb)]({'success':!![],'result':{'bot':{'isActive':_0xfdf0e1[_0x4c194d(0x120)],'username':_0xfdf0e1[_0x4c194d(0xee)]},'statistics':{'totalUsers':_0x25679a,'verifiedUsers':_0x55874f,'unverifiedUsers':_0x25679a-_0x55874f,'connectedShops':_0x132287[_0x4c194d(0x11d)]}}});}catch(_0x4e79f8){_0x42067c(_0x4e79f8);}},this[_0x207379(0x116)]=async(_0x5e4ed0,_0x4ec752,_0x3d824f)=>{const _0x5a742d=_0x207379;try{const {page:page=0x1,limit:limit=0x14,verified:_0x170836}=_0x5e4ed0[_0x5a742d(0xfe)],_0x8fe91f=(Number(page)-0x1)*Number(limit),_0x1a96f1={};_0x170836!==undefined&&(_0x1a96f1[_0x5a742d(0xe3)]=_0x170836===_0x5a742d(0x10b));const [_0x297f6d,_0x242ec0]=await Promise[_0x5a742d(0xf4)]([database_1[_0x5a742d(0x11b)][_0x5a742d(0xe5)]['findMany']({'where':_0x1a96f1,'skip':_0x8fe91f,'take':Number(limit),'orderBy':{'createdAt':_0x5a742d(0x10d)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5a742d(0x11b)]['telegramUser'][_0x5a742d(0x10c)]({'where':_0x1a96f1})]);_0x4ec752[_0x5a742d(0xdb)]({'success':!![],'users':_0x297f6d[_0x5a742d(0xe2)](_0x6daec3=>({'id':_0x6daec3['id'],'telegramId':_0x6daec3[_0x5a742d(0x118)],'username':_0x6daec3[_0x5a742d(0xee)],'firstName':_0x6daec3[_0x5a742d(0x111)],'lastName':_0x6daec3[_0x5a742d(0xf3)],'isVerified':_0x6daec3[_0x5a742d(0xe3)],'shop':_0x6daec3[_0x5a742d(0xea)],'createdAt':_0x6daec3['createdAt'],'updatedAt':_0x6daec3[_0x5a742d(0xdf)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x242ec0,'totalPages':Math[_0x5a742d(0xd6)](_0x242ec0/Number(limit))}});}catch(_0x37db5d){_0x3d824f(_0x37db5d);}},this['sendBroadcast']=async(_0x4200f2,_0xdb6776,_0x3910b7)=>{const _0xa29e8=_0x207379;try{const {message:_0x1640d3,shopId:_0x56958f}=_0x4200f2[_0xa29e8(0xfa)];if(!_0x1640d3)return _0xdb6776['status'](0x190)[_0xa29e8(0xdb)]({'success':![],'message':_0xa29e8(0xe1)});if(_0x56958f)await telegramBotService_1[_0xa29e8(0xf6)][_0xa29e8(0xe6)](_0x56958f,_0x1640d3,{'parse_mode':_0xa29e8(0xd7)});else{const _0x5e5176=await database_1[_0xa29e8(0x11b)][_0xa29e8(0xe5)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x30015b=[...new Set(_0x5e5176['map'](_0x17d114=>_0x17d114[_0xa29e8(0x112)])[_0xa29e8(0xe7)](Boolean))];for(const _0x111115 of _0x30015b){_0x111115&&await telegramBotService_1[_0xa29e8(0xf6)][_0xa29e8(0xe6)](_0x111115,_0x1640d3,{'parse_mode':_0xa29e8(0xd7)});}}_0xdb6776[_0xa29e8(0xdb)]({'success':!![],'message':_0xa29e8(0xe0)});}catch(_0x45d7b7){_0x3910b7(_0x45d7b7);}},this['disconnectUser']=async(_0x129fbd,_0x29c379,_0x2855c9)=>{const _0x2e936a=_0x207379;try{const {telegramId:_0x114ba4}=_0x129fbd[_0x2e936a(0xe9)],_0x535923=await database_1[_0x2e936a(0x11b)][_0x2e936a(0xe5)][_0x2e936a(0xfc)]({'where':{'telegramId':_0x114ba4},'include':{'shop':!![]}});if(!_0x535923)return _0x29c379[_0x2e936a(0x11e)](0x194)[_0x2e936a(0xdb)]({'success':![],'message':_0x2e936a(0x103)});await database_1[_0x2e936a(0x11b)][_0x2e936a(0xe5)][_0x2e936a(0xd8)]({'where':{'telegramId':_0x114ba4},'data':{'shopId':null,'isVerified':![]}}),_0x29c379[_0x2e936a(0xdb)]({'success':!![],'message':_0x2e936a(0x113)});}catch(_0x1b641b){_0x2855c9(_0x1b641b);}},this[_0x207379(0xf0)]=async(_0x3545aa,_0x5aa88b,_0x5461b7)=>{const _0xd8458c=_0x207379;try{const {shopId:_0x18d95a,type:type=_0xd8458c(0x11f),testData:_0x5dd090}=_0x3545aa[_0xd8458c(0xfa)];if(!_0x18d95a)return _0x5aa88b[_0xd8458c(0x11e)](0x190)[_0xd8458c(0xdb)]({'success':![],'message':_0xd8458c(0xed)});const _0x3c45d7=await database_1[_0xd8458c(0x11b)][_0xd8458c(0xea)][_0xd8458c(0xfc)]({'where':{'id':_0x18d95a},'select':{'id':!![],'name':!![]}});if(!_0x3c45d7)return _0x5aa88b[_0xd8458c(0x11e)](0x194)[_0xd8458c(0xdb)]({'success':![],'message':_0xd8458c(0xfb)});switch(type){case'payment':const _0x3623ab={'id':'test_payment_123','amount':_0x5dd090?.[_0xd8458c(0x110)]||0x64,'currency':_0x5dd090?.[_0xd8458c(0xe8)]||_0xd8458c(0x11c),'productName':_0x5dd090?.[_0xd8458c(0x119)]||_0xd8458c(0xec),'gateway':_0x5dd090?.[_0xd8458c(0xdd)]||_0xd8458c(0x100),'createdAt':new Date(),..._0x5dd090};await telegramBotService_1[_0xd8458c(0xf6)][_0xd8458c(0xf5)](_0x18d95a,_0x3623ab,_0xd8458c(0x104));break;case _0xd8458c(0xf1):const _0x52cdb5={'id':_0xd8458c(0xff),'amount':_0x5dd090?.['amount']||0x1f4,'method':_0x5dd090?.['method']||_0xd8458c(0x105),'createdAt':new Date(),..._0x5dd090};await telegramBotService_1[_0xd8458c(0xf6)][_0xd8458c(0xde)](_0x18d95a,_0x52cdb5,_0xd8458c(0xf9));break;case _0xd8458c(0xfd):await telegramBotService_1['telegramBotService'][_0xd8458c(0xf8)](_0x18d95a,_0x5dd090?.[_0xd8458c(0xf7)]||_0xd8458c(0x109),_0x5dd090?.[_0xd8458c(0xd9)]||{'message':_0xd8458c(0x108)});break;default:return _0x5aa88b['status'](0x190)['json']({'success':![],'message':_0xd8458c(0x10f)});}_0x5aa88b[_0xd8458c(0xdb)]({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x44319c){_0x5461b7(_0x44319c);}};}}exports['TelegramController']=TelegramController;