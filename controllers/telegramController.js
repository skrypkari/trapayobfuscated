'use strict';const a17_0xc9757a=a17_0x3d95;(function(_0x2f1bda,_0x4ce277){const _0x1af511=a17_0x3d95,_0x8d82ca=_0x2f1bda();while(!![]){try{const _0x2ed423=parseInt(_0x1af511(0x192))/0x1+-parseInt(_0x1af511(0x18a))/0x2*(-parseInt(_0x1af511(0x169))/0x3)+-parseInt(_0x1af511(0x178))/0x4*(-parseInt(_0x1af511(0x177))/0x5)+parseInt(_0x1af511(0x16e))/0x6+parseInt(_0x1af511(0x1a4))/0x7*(-parseInt(_0x1af511(0x18f))/0x8)+parseInt(_0x1af511(0x17b))/0x9+-parseInt(_0x1af511(0x173))/0xa;if(_0x2ed423===_0x4ce277)break;else _0x8d82ca['push'](_0x8d82ca['shift']());}catch(_0x123a3d){_0x8d82ca['push'](_0x8d82ca['shift']());}}}(a17_0x24ef,0x9ace6));function a17_0x24ef(){const _0x20578d=['18134DmzVEq','paid','Shop\x20ID\x20is\x20required','Telegram\x20user\x20not\x20found','firstName','8CpWUhk','default','Test\x20','455732RHqDMX','json','defineProperty','filter','TRC20','txid','payout','telegramId','Message\x20is\x20required','Тестовый\x20период','sendPayoutNotification','body','currency','title','length','findMany','telegramBotService','sendCustomNotification','8634451KcWnCG','isActive','User\x20disconnected\x20successfully','desc','This\x20is\x20a\x20test\x20notification','Shop\x20not\x20found','USD','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','map','lastName','all','../services/telegramBotService','Test\x20Product','../config/database','telegramUser','username','test_payout_123','createdAt','amount','258ewmSvC','query','sendPaymentNotification','isVerified','disconnectUser','3942282nesOKW','Test\x20Notification','ceil','productName','TelegramController','11041300ZMxCEM','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','shop','gateway','923665HUmlwj','8SmqFkd','\x20notification\x20sent\x20successfully','status','6387318NhrNhv','network','sendBroadcast','getBotInfo','findUnique','shopId','wallet','update','payment','count','sendShopNotification','getTelegramUsers','plisio','test_payment_123','Markdown'];a17_0x24ef=function(){return _0x20578d;};return a17_0x24ef();}var __importDefault=this&&this['__importDefault']||function(_0x3cd4fa){return _0x3cd4fa&&_0x3cd4fa['__esModule']?_0x3cd4fa:{'default':_0x3cd4fa};};Object[a17_0xc9757a(0x194)](exports,'__esModule',{'value':!![]}),exports[a17_0xc9757a(0x172)]=void 0x0;const telegramBotService_1=require(a17_0xc9757a(0x1af)),database_1=__importDefault(require(a17_0xc9757a(0x1b1)));function a17_0x3d95(_0x2bb45a,_0x4d1549){_0x2bb45a=_0x2bb45a-0x164;const _0x24efdf=a17_0x24ef();let _0x3d95f5=_0x24efdf[_0x2bb45a];return _0x3d95f5;}class TelegramController{constructor(){const _0x1278a0=a17_0xc9757a;this['getBotStatus']=async(_0x3398cc,_0x351595,_0x34389f)=>{const _0x21b5d0=a17_0x3d95;try{const _0x46b4d2=telegramBotService_1[_0x21b5d0(0x1a2)][_0x21b5d0(0x17e)](),_0x5c5174=await database_1['default']['telegramUser']['count'](),_0x561dff=await database_1[_0x21b5d0(0x190)]['telegramUser'][_0x21b5d0(0x184)]({'where':{'isVerified':!![]}}),_0x5322a5=await database_1[_0x21b5d0(0x190)]['telegramUser']['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x351595[_0x21b5d0(0x193)]({'success':!![],'result':{'bot':{'isActive':_0x46b4d2[_0x21b5d0(0x1a5)],'username':_0x46b4d2['username']},'statistics':{'totalUsers':_0x5c5174,'verifiedUsers':_0x561dff,'unverifiedUsers':_0x5c5174-_0x561dff,'connectedShops':_0x5322a5[_0x21b5d0(0x1a0)]}}});}catch(_0x150bbb){_0x34389f(_0x150bbb);}},this[_0x1278a0(0x186)]=async(_0x3623cd,_0x7dda07,_0x5c9f84)=>{const _0x49458b=_0x1278a0;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2ec0b4}=_0x3623cd[_0x49458b(0x16a)],_0x1d9615=(Number(page)-0x1)*Number(limit),_0x50fa38={};_0x2ec0b4!==undefined&&(_0x50fa38['isVerified']=_0x2ec0b4==='true');const [_0xc6a252,_0x3d56ff]=await Promise[_0x49458b(0x1ae)]([database_1[_0x49458b(0x190)][_0x49458b(0x164)][_0x49458b(0x1a1)]({'where':_0x50fa38,'skip':_0x1d9615,'take':Number(limit),'orderBy':{'createdAt':_0x49458b(0x1a7)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x49458b(0x164)]['count']({'where':_0x50fa38})]);_0x7dda07[_0x49458b(0x193)]({'success':!![],'users':_0xc6a252[_0x49458b(0x1ac)](_0x197ad8=>({'id':_0x197ad8['id'],'telegramId':_0x197ad8[_0x49458b(0x199)],'username':_0x197ad8[_0x49458b(0x165)],'firstName':_0x197ad8[_0x49458b(0x18e)],'lastName':_0x197ad8[_0x49458b(0x1ad)],'isVerified':_0x197ad8[_0x49458b(0x16c)],'shop':_0x197ad8[_0x49458b(0x175)],'createdAt':_0x197ad8[_0x49458b(0x167)],'updatedAt':_0x197ad8['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3d56ff,'totalPages':Math[_0x49458b(0x170)](_0x3d56ff/Number(limit))}});}catch(_0x4d4bd){_0x5c9f84(_0x4d4bd);}},this[_0x1278a0(0x17d)]=async(_0x1b87ea,_0x342a09,_0x431552)=>{const _0x3d48d2=_0x1278a0;try{const {message:_0x3ad4e8,shopId:_0x3aa956}=_0x1b87ea[_0x3d48d2(0x19d)];if(!_0x3ad4e8)return _0x342a09[_0x3d48d2(0x17a)](0x190)[_0x3d48d2(0x193)]({'success':![],'message':_0x3d48d2(0x19a)});if(_0x3aa956)await telegramBotService_1['telegramBotService'][_0x3d48d2(0x185)](_0x3aa956,_0x3ad4e8,{'parse_mode':_0x3d48d2(0x189)});else{const _0x22c899=await database_1['default'][_0x3d48d2(0x164)][_0x3d48d2(0x1a1)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5bbe06=[...new Set(_0x22c899[_0x3d48d2(0x1ac)](_0x3c1a6b=>_0x3c1a6b[_0x3d48d2(0x180)])[_0x3d48d2(0x195)](Boolean))];for(const _0xa06d1c of _0x5bbe06){_0xa06d1c&&await telegramBotService_1[_0x3d48d2(0x1a2)][_0x3d48d2(0x185)](_0xa06d1c,_0x3ad4e8,{'parse_mode':_0x3d48d2(0x189)});}}_0x342a09[_0x3d48d2(0x193)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0xbac7f4){_0x431552(_0xbac7f4);}},this[_0x1278a0(0x16d)]=async(_0xab99a1,_0xfbb4d2,_0x3d652f)=>{const _0x50e23c=_0x1278a0;try{const {telegramId:_0x4ab88b}=_0xab99a1['params'],_0x1bf952=await database_1['default'][_0x50e23c(0x164)][_0x50e23c(0x17f)]({'where':{'telegramId':_0x4ab88b},'include':{'shop':!![]}});if(!_0x1bf952)return _0xfbb4d2[_0x50e23c(0x17a)](0x194)[_0x50e23c(0x193)]({'success':![],'message':_0x50e23c(0x18d)});await database_1[_0x50e23c(0x190)][_0x50e23c(0x164)][_0x50e23c(0x182)]({'where':{'telegramId':_0x4ab88b},'data':{'shopId':null,'isVerified':![]}}),_0xfbb4d2['json']({'success':!![],'message':_0x50e23c(0x1a6)});}catch(_0x2c3aa1){_0x3d652f(_0x2c3aa1);}},this['sendTestNotification']=async(_0x560244,_0x3080c7,_0x3b2f40)=>{const _0xa6996e=_0x1278a0;try{const {shopId:_0x17d53c,type:type=_0xa6996e(0x183),testData:_0x5d1309}=_0x560244[_0xa6996e(0x19d)];if(!_0x17d53c)return _0x3080c7[_0xa6996e(0x17a)](0x190)[_0xa6996e(0x193)]({'success':![],'message':_0xa6996e(0x18c)});const _0x4cb17a=await database_1[_0xa6996e(0x190)][_0xa6996e(0x175)][_0xa6996e(0x17f)]({'where':{'id':_0x17d53c},'select':{'id':!![],'name':!![]}});if(!_0x4cb17a)return _0x3080c7[_0xa6996e(0x17a)](0x194)[_0xa6996e(0x193)]({'success':![],'message':_0xa6996e(0x1a9)});switch(type){case'payment':const _0x163604={'id':_0xa6996e(0x188),'amount':_0x5d1309?.[_0xa6996e(0x168)]||0x64,'currency':_0x5d1309?.[_0xa6996e(0x19e)]||_0xa6996e(0x1aa),'productName':_0x5d1309?.[_0xa6996e(0x171)]||_0xa6996e(0x1b0),'gateway':_0x5d1309?.[_0xa6996e(0x176)]||_0xa6996e(0x187),'createdAt':new Date(),..._0x5d1309};await telegramBotService_1['telegramBotService'][_0xa6996e(0x16b)](_0x17d53c,_0x163604,_0xa6996e(0x18b));break;case _0xa6996e(0x198):const _0x2ad52f={'id':_0xa6996e(0x166),'amount':_0x5d1309?.['amount']||0x1f4,'network':_0x5d1309?.[_0xa6996e(0x17c)]||_0xa6996e(0x196),'wallet':_0x5d1309?.[_0xa6996e(0x181)]||_0xa6996e(0x174),'period':_0xa6996e(0x19b),'createdAt':new Date(),'txid':_0x5d1309?.[_0xa6996e(0x197)]||null,..._0x5d1309};await telegramBotService_1[_0xa6996e(0x1a2)][_0xa6996e(0x19c)](_0x17d53c,_0x2ad52f);break;case'custom':await telegramBotService_1[_0xa6996e(0x1a2)][_0xa6996e(0x1a3)](_0x17d53c,_0x5d1309?.[_0xa6996e(0x19f)]||_0xa6996e(0x16f),_0x5d1309?.['details']||{'message':_0xa6996e(0x1a8)});break;default:return _0x3080c7[_0xa6996e(0x17a)](0x190)['json']({'success':![],'message':_0xa6996e(0x1ab)});}_0x3080c7['json']({'success':!![],'message':_0xa6996e(0x191)+type+_0xa6996e(0x179)});}catch(_0x3132db){_0x3b2f40(_0x3132db);}};}}exports[a17_0xc9757a(0x172)]=TelegramController;