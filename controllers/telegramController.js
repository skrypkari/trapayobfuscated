'use strict';const a12_0x36fb87=a12_0x4cb6;function a12_0x3cf7(){const _0x4bfc4c=['Shop\x20not\x20found','7612790ruipGC','getTelegramUsers','ceil','disconnectUser','telegramId','true','custom','../config/database','username','map','This\x20is\x20a\x20test\x20notification','User\x20disconnected\x20successfully','payout','../services/telegramBotService','64611800nPNmpr','findUnique','details','Test\x20','isActive','title','344320oSHTno','body','isVerified','8UhYBMA','TelegramController','\x20notification\x20sent\x20successfully','defineProperty','desc','findMany','5615jIeBGu','test_payment_123','telegramBotService','USD','Test\x20Notification','method','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','productName','payment','1800367pLdisM','status','Broadcast\x20message\x20sent\x20successfully','Telegram\x20user\x20not\x20found','shop','updatedAt','9SViDBk','currency','default','401598Ddldnz','sendTestNotification','completed','all','getBotStatus','__esModule','sendCustomNotification','sendShopNotification','shopId','paid','2555637QEHnAn','Message\x20is\x20required','Markdown','9GGRnDf','sendBroadcast','json','filter','createdAt','firstName','gateway','telegramUser','groupBy','__importDefault','update','lastName','sendPayoutNotification','8022tjXczv'];a12_0x3cf7=function(){return _0x4bfc4c;};return a12_0x3cf7();}(function(_0x6da3fe,_0x241017){const _0x14bb94=a12_0x4cb6,_0x4f5c54=_0x6da3fe();while(!![]){try{const _0xd6a57f=-parseInt(_0x14bb94(0x173))/0x1+-parseInt(_0x14bb94(0x17c))/0x2*(parseInt(_0x14bb94(0x179))/0x3)+parseInt(_0x14bb94(0x161))/0x4+-parseInt(_0x14bb94(0x16a))/0x5*(parseInt(_0x14bb94(0x196))/0x6)+-parseInt(_0x14bb94(0x186))/0x7*(parseInt(_0x14bb94(0x164))/0x8)+-parseInt(_0x14bb94(0x189))/0x9*(parseInt(_0x14bb94(0x198))/0xa)+parseInt(_0x14bb94(0x1a6))/0xb;if(_0xd6a57f===_0x241017)break;else _0x4f5c54['push'](_0x4f5c54['shift']());}catch(_0x1fe9dd){_0x4f5c54['push'](_0x4f5c54['shift']());}}}(a12_0x3cf7,0xe2e0f));var __importDefault=this&&this[a12_0x36fb87(0x192)]||function(_0x212cd0){return _0x212cd0&&_0x212cd0['__esModule']?_0x212cd0:{'default':_0x212cd0};};Object[a12_0x36fb87(0x167)](exports,a12_0x36fb87(0x181),{'value':!![]}),exports[a12_0x36fb87(0x165)]=void 0x0;const telegramBotService_1=require(a12_0x36fb87(0x1a5)),database_1=__importDefault(require(a12_0x36fb87(0x19f)));class TelegramController{constructor(){const _0x3a4547=a12_0x36fb87;this[_0x3a4547(0x180)]=async(_0x13c0bc,_0x3b5b7c,_0x42bca8)=>{const _0x32cda6=_0x3a4547;try{const _0x283024=telegramBotService_1[_0x32cda6(0x16c)]['getBotInfo'](),_0x46f27f=await database_1[_0x32cda6(0x17b)][_0x32cda6(0x190)]['count'](),_0x58e6aa=await database_1[_0x32cda6(0x17b)][_0x32cda6(0x190)]['count']({'where':{'isVerified':!![]}}),_0x10751d=await database_1['default'][_0x32cda6(0x190)][_0x32cda6(0x191)]({'by':[_0x32cda6(0x184)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3b5b7c[_0x32cda6(0x18b)]({'success':!![],'result':{'bot':{'isActive':_0x283024[_0x32cda6(0x15f)],'username':_0x283024[_0x32cda6(0x1a0)]},'statistics':{'totalUsers':_0x46f27f,'verifiedUsers':_0x58e6aa,'unverifiedUsers':_0x46f27f-_0x58e6aa,'connectedShops':_0x10751d['length']}}});}catch(_0xa885c){_0x42bca8(_0xa885c);}},this[_0x3a4547(0x199)]=async(_0xa17843,_0x5e350c,_0xa6674a)=>{const _0x16fb6d=_0x3a4547;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3df89f}=_0xa17843['query'],_0x380de3=(Number(page)-0x1)*Number(limit),_0x5cf65c={};_0x3df89f!==undefined&&(_0x5cf65c[_0x16fb6d(0x163)]=_0x3df89f===_0x16fb6d(0x19d));const [_0x3b4e21,_0x587c1b]=await Promise[_0x16fb6d(0x17f)]([database_1[_0x16fb6d(0x17b)]['telegramUser'][_0x16fb6d(0x169)]({'where':_0x5cf65c,'skip':_0x380de3,'take':Number(limit),'orderBy':{'createdAt':_0x16fb6d(0x168)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x16fb6d(0x17b)][_0x16fb6d(0x190)]['count']({'where':_0x5cf65c})]);_0x5e350c[_0x16fb6d(0x18b)]({'success':!![],'users':_0x3b4e21[_0x16fb6d(0x1a1)](_0x193ead=>({'id':_0x193ead['id'],'telegramId':_0x193ead[_0x16fb6d(0x19c)],'username':_0x193ead[_0x16fb6d(0x1a0)],'firstName':_0x193ead[_0x16fb6d(0x18e)],'lastName':_0x193ead[_0x16fb6d(0x194)],'isVerified':_0x193ead[_0x16fb6d(0x163)],'shop':_0x193ead[_0x16fb6d(0x177)],'createdAt':_0x193ead[_0x16fb6d(0x18d)],'updatedAt':_0x193ead[_0x16fb6d(0x178)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x587c1b,'totalPages':Math[_0x16fb6d(0x19a)](_0x587c1b/Number(limit))}});}catch(_0x4b9e3d){_0xa6674a(_0x4b9e3d);}},this[_0x3a4547(0x18a)]=async(_0x11d086,_0x12ce08,_0x5f0c2e)=>{const _0x2a18ab=_0x3a4547;try{const {message:_0x133cb4,shopId:_0x33be10}=_0x11d086['body'];if(!_0x133cb4)return _0x12ce08[_0x2a18ab(0x174)](0x190)['json']({'success':![],'message':_0x2a18ab(0x187)});if(_0x33be10)await telegramBotService_1[_0x2a18ab(0x16c)][_0x2a18ab(0x183)](_0x33be10,_0x133cb4,{'parse_mode':_0x2a18ab(0x188)});else{const _0x35c9e6=await database_1[_0x2a18ab(0x17b)][_0x2a18ab(0x190)][_0x2a18ab(0x169)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x40f695=[...new Set(_0x35c9e6[_0x2a18ab(0x1a1)](_0x182631=>_0x182631['shopId'])[_0x2a18ab(0x18c)](Boolean))];for(const _0x24db26 of _0x40f695){_0x24db26&&await telegramBotService_1[_0x2a18ab(0x16c)][_0x2a18ab(0x183)](_0x24db26,_0x133cb4,{'parse_mode':_0x2a18ab(0x188)});}}_0x12ce08[_0x2a18ab(0x18b)]({'success':!![],'message':_0x2a18ab(0x175)});}catch(_0x1e7076){_0x5f0c2e(_0x1e7076);}},this[_0x3a4547(0x19b)]=async(_0x4b9234,_0x6014c6,_0x618733)=>{const _0x3809b9=_0x3a4547;try{const {telegramId:_0x14fbf6}=_0x4b9234['params'],_0x48af8c=await database_1['default'][_0x3809b9(0x190)][_0x3809b9(0x1a7)]({'where':{'telegramId':_0x14fbf6},'include':{'shop':!![]}});if(!_0x48af8c)return _0x6014c6[_0x3809b9(0x174)](0x194)[_0x3809b9(0x18b)]({'success':![],'message':_0x3809b9(0x176)});await database_1[_0x3809b9(0x17b)][_0x3809b9(0x190)][_0x3809b9(0x193)]({'where':{'telegramId':_0x14fbf6},'data':{'shopId':null,'isVerified':![]}}),_0x6014c6[_0x3809b9(0x18b)]({'success':!![],'message':_0x3809b9(0x1a3)});}catch(_0x398ef5){_0x618733(_0x398ef5);}},this[_0x3a4547(0x17d)]=async(_0x37f78c,_0x45d541,_0x5a2f4a)=>{const _0x160448=_0x3a4547;try{const {shopId:_0x4d64a7,type:type='payment',testData:_0x21e2ea}=_0x37f78c[_0x160448(0x162)];if(!_0x4d64a7)return _0x45d541['status'](0x190)[_0x160448(0x18b)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x480b08=await database_1[_0x160448(0x17b)][_0x160448(0x177)][_0x160448(0x1a7)]({'where':{'id':_0x4d64a7},'select':{'id':!![],'name':!![]}});if(!_0x480b08)return _0x45d541[_0x160448(0x174)](0x194)[_0x160448(0x18b)]({'success':![],'message':_0x160448(0x197)});switch(type){case _0x160448(0x172):const _0x3cdd7b={'id':_0x160448(0x16b),'amount':_0x21e2ea?.['amount']||0x64,'currency':_0x21e2ea?.[_0x160448(0x17a)]||_0x160448(0x16d),'productName':_0x21e2ea?.[_0x160448(0x171)]||'Test\x20Product','gateway':_0x21e2ea?.[_0x160448(0x18f)]||'plisio','createdAt':new Date(),..._0x21e2ea};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x4d64a7,_0x3cdd7b,_0x160448(0x185));break;case _0x160448(0x1a4):const _0x370a61={'id':'test_payout_123','amount':_0x21e2ea?.['amount']||0x1f4,'method':_0x21e2ea?.[_0x160448(0x16f)]||'bank_transfer','createdAt':new Date(),..._0x21e2ea};await telegramBotService_1['telegramBotService'][_0x160448(0x195)](_0x4d64a7,_0x370a61,_0x160448(0x17e));break;case _0x160448(0x19e):await telegramBotService_1[_0x160448(0x16c)][_0x160448(0x182)](_0x4d64a7,_0x21e2ea?.[_0x160448(0x160)]||_0x160448(0x16e),_0x21e2ea?.[_0x160448(0x1a8)]||{'message':_0x160448(0x1a2)});break;default:return _0x45d541['status'](0x190)[_0x160448(0x18b)]({'success':![],'message':_0x160448(0x170)});}_0x45d541[_0x160448(0x18b)]({'success':!![],'message':_0x160448(0x1a9)+type+_0x160448(0x166)});}catch(_0x1b97b1){_0x5a2f4a(_0x1b97b1);}};}}function a12_0x4cb6(_0x27af1c,_0x4bffff){const _0x3cf778=a12_0x3cf7();return a12_0x4cb6=function(_0x4cb655,_0x579e53){_0x4cb655=_0x4cb655-0x15f;let _0x320c3a=_0x3cf778[_0x4cb655];return _0x320c3a;},a12_0x4cb6(_0x27af1c,_0x4bffff);}exports[a12_0x36fb87(0x165)]=TelegramController;