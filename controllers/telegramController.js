'use strict';const a12_0x5dc03f=a12_0x1679;(function(_0x37d1b6,_0x6973f2){const _0x439b12=a12_0x1679,_0x5d513e=_0x37d1b6();while(!![]){try{const _0xe4422c=parseInt(_0x439b12(0x168))/0x1*(-parseInt(_0x439b12(0x143))/0x2)+-parseInt(_0x439b12(0x148))/0x3+parseInt(_0x439b12(0x16a))/0x4*(parseInt(_0x439b12(0x139))/0x5)+-parseInt(_0x439b12(0x161))/0x6+parseInt(_0x439b12(0x164))/0x7*(parseInt(_0x439b12(0x151))/0x8)+-parseInt(_0x439b12(0x162))/0x9*(-parseInt(_0x439b12(0x13f))/0xa)+-parseInt(_0x439b12(0x13d))/0xb;if(_0xe4422c===_0x6973f2)break;else _0x5d513e['push'](_0x5d513e['shift']());}catch(_0x2c6ffb){_0x5d513e['push'](_0x5d513e['shift']());}}}(a12_0x5109,0x58027));var __importDefault=this&&this[a12_0x5dc03f(0x145)]||function(_0x26ad4a){return _0x26ad4a&&_0x26ad4a['__esModule']?_0x26ad4a:{'default':_0x26ad4a};};function a12_0x1679(_0x4f9d4f,_0x3ee038){const _0x510948=a12_0x5109();return a12_0x1679=function(_0x167919,_0x81a5fd){_0x167919=_0x167919-0x130;let _0x5cccb9=_0x510948[_0x167919];return _0x5cccb9;},a12_0x1679(_0x4f9d4f,_0x3ee038);}Object[a12_0x5dc03f(0x158)](exports,a12_0x5dc03f(0x169),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x5dc03f(0x172)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x31fa17=a12_0x5dc03f;this[_0x31fa17(0x131)]=async(_0x391341,_0x3ce781,_0x3693be)=>{const _0xf80e81=_0x31fa17;try{const _0x3b5954=telegramBotService_1[_0xf80e81(0x16d)][_0xf80e81(0x177)](),_0x23b6e5=await database_1[_0xf80e81(0x14f)][_0xf80e81(0x137)][_0xf80e81(0x14e)](),_0x24e264=await database_1['default'][_0xf80e81(0x137)][_0xf80e81(0x14e)]({'where':{'isVerified':!![]}}),_0x8bdda1=await database_1['default'][_0xf80e81(0x137)]['groupBy']({'by':[_0xf80e81(0x15d)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3ce781[_0xf80e81(0x13c)]({'success':!![],'result':{'bot':{'isActive':_0x3b5954[_0xf80e81(0x13a)],'username':_0x3b5954[_0xf80e81(0x136)]},'statistics':{'totalUsers':_0x23b6e5,'verifiedUsers':_0x24e264,'unverifiedUsers':_0x23b6e5-_0x24e264,'connectedShops':_0x8bdda1[_0xf80e81(0x173)]}}});}catch(_0x529cab){_0x3693be(_0x529cab);}},this[_0x31fa17(0x147)]=async(_0x53d503,_0x5ea278,_0x9443d5)=>{const _0x4d80d6=_0x31fa17;try{const {page:page=0x1,limit:limit=0x14,verified:_0x287df4}=_0x53d503[_0x4d80d6(0x144)],_0x5c619b=(Number(page)-0x1)*Number(limit),_0x3f48f2={};_0x287df4!==undefined&&(_0x3f48f2['isVerified']=_0x287df4===_0x4d80d6(0x135));const [_0x182b3b,_0x10223e]=await Promise['all']([database_1[_0x4d80d6(0x14f)]['telegramUser'][_0x4d80d6(0x157)]({'where':_0x3f48f2,'skip':_0x5c619b,'take':Number(limit),'orderBy':{'createdAt':_0x4d80d6(0x16b)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4d80d6(0x14f)][_0x4d80d6(0x137)][_0x4d80d6(0x14e)]({'where':_0x3f48f2})]);_0x5ea278[_0x4d80d6(0x13c)]({'success':!![],'users':_0x182b3b[_0x4d80d6(0x159)](_0xdb92c1=>({'id':_0xdb92c1['id'],'telegramId':_0xdb92c1[_0x4d80d6(0x155)],'username':_0xdb92c1[_0x4d80d6(0x136)],'firstName':_0xdb92c1[_0x4d80d6(0x16e)],'lastName':_0xdb92c1[_0x4d80d6(0x178)],'isVerified':_0xdb92c1[_0x4d80d6(0x166)],'shop':_0xdb92c1[_0x4d80d6(0x15a)],'createdAt':_0xdb92c1[_0x4d80d6(0x13b)],'updatedAt':_0xdb92c1[_0x4d80d6(0x14b)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x10223e,'totalPages':Math[_0x4d80d6(0x146)](_0x10223e/Number(limit))}});}catch(_0xcd1d35){_0x9443d5(_0xcd1d35);}},this[_0x31fa17(0x132)]=async(_0x22242d,_0x401721,_0x2d711c)=>{const _0x1b28a4=_0x31fa17;try{const {message:_0x1a7098,shopId:_0x189232}=_0x22242d[_0x1b28a4(0x153)];if(!_0x1a7098)return _0x401721[_0x1b28a4(0x149)](0x190)[_0x1b28a4(0x13c)]({'success':![],'message':_0x1b28a4(0x13e)});if(_0x189232)await telegramBotService_1[_0x1b28a4(0x16d)][_0x1b28a4(0x134)](_0x189232,_0x1a7098,{'parse_mode':'Markdown'});else{const _0x2d2f18=await database_1[_0x1b28a4(0x14f)][_0x1b28a4(0x137)][_0x1b28a4(0x157)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4d770a=[...new Set(_0x2d2f18[_0x1b28a4(0x159)](_0x30954b=>_0x30954b[_0x1b28a4(0x15d)])[_0x1b28a4(0x142)](Boolean))];for(const _0x46eb18 of _0x4d770a){_0x46eb18&&await telegramBotService_1[_0x1b28a4(0x16d)][_0x1b28a4(0x134)](_0x46eb18,_0x1a7098,{'parse_mode':_0x1b28a4(0x160)});}}_0x401721[_0x1b28a4(0x13c)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x2f1529){_0x2d711c(_0x2f1529);}},this[_0x31fa17(0x174)]=async(_0x49ff08,_0x1760af,_0x34a574)=>{const _0x869454=_0x31fa17;try{const {telegramId:_0x231eaa}=_0x49ff08[_0x869454(0x156)],_0x97f122=await database_1['default'][_0x869454(0x137)]['findUnique']({'where':{'telegramId':_0x231eaa},'include':{'shop':!![]}});if(!_0x97f122)return _0x1760af[_0x869454(0x149)](0x194)[_0x869454(0x13c)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x869454(0x14f)][_0x869454(0x137)][_0x869454(0x152)]({'where':{'telegramId':_0x231eaa},'data':{'shopId':null,'isVerified':![]}}),_0x1760af['json']({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x39a88a){_0x34a574(_0x39a88a);}},this[_0x31fa17(0x167)]=async(_0x4111c8,_0x317726,_0x90640b)=>{const _0x8b6c64=_0x31fa17;try{const {shopId:_0x34e9a2,type:type=_0x8b6c64(0x154),testData:_0x20b001}=_0x4111c8['body'];if(!_0x34e9a2)return _0x317726[_0x8b6c64(0x149)](0x190)['json']({'success':![],'message':_0x8b6c64(0x165)});const _0x122ddd=await database_1[_0x8b6c64(0x14f)][_0x8b6c64(0x15a)]['findUnique']({'where':{'id':_0x34e9a2},'select':{'id':!![],'name':!![]}});if(!_0x122ddd)return _0x317726[_0x8b6c64(0x149)](0x194)[_0x8b6c64(0x13c)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x8b6c64(0x154):const _0x22fa99={'id':_0x8b6c64(0x15f),'amount':_0x20b001?.[_0x8b6c64(0x15b)]||0x64,'currency':_0x20b001?.['currency']||_0x8b6c64(0x171),'productName':_0x20b001?.[_0x8b6c64(0x170)]||_0x8b6c64(0x16c),'gateway':_0x20b001?.[_0x8b6c64(0x14d)]||'plisio','createdAt':new Date(),..._0x20b001};await telegramBotService_1[_0x8b6c64(0x16d)][_0x8b6c64(0x141)](_0x34e9a2,_0x22fa99,'paid');break;case _0x8b6c64(0x150):const _0x534aaa={'id':_0x8b6c64(0x176),'amount':_0x20b001?.[_0x8b6c64(0x15b)]||0x1f4,'method':_0x20b001?.['method']||_0x8b6c64(0x14a),'createdAt':new Date(),..._0x20b001};await telegramBotService_1[_0x8b6c64(0x16d)][_0x8b6c64(0x138)](_0x34e9a2,_0x534aaa,_0x8b6c64(0x133));break;case _0x8b6c64(0x140):await telegramBotService_1[_0x8b6c64(0x16d)][_0x8b6c64(0x130)](_0x34e9a2,_0x20b001?.['title']||_0x8b6c64(0x15e),_0x20b001?.[_0x8b6c64(0x15c)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x317726[_0x8b6c64(0x149)](0x190)[_0x8b6c64(0x13c)]({'success':![],'message':_0x8b6c64(0x175)});}_0x317726[_0x8b6c64(0x13c)]({'success':!![],'message':_0x8b6c64(0x163)+type+_0x8b6c64(0x14c)});}catch(_0x37ebfb){_0x90640b(_0x37ebfb);}};}}exports[a12_0x5dc03f(0x16f)]=TelegramController;function a12_0x5109(){const _0x3408a2=['filter','892NSIPPg','query','__importDefault','ceil','getTelegramUsers','194238nVTmqE','status','bank_transfer','updatedAt','\x20notification\x20sent\x20successfully','gateway','count','default','payout','389296vGNpHo','update','body','payment','telegramId','params','findMany','defineProperty','map','shop','amount','details','shopId','Test\x20Notification','test_payment_123','Markdown','473304omuadv','9lyIBFa','Test\x20','28xDEjyk','Shop\x20ID\x20is\x20required','isVerified','sendTestNotification','724bAwFZb','__esModule','1996wHBGJP','desc','Test\x20Product','telegramBotService','firstName','TelegramController','productName','USD','../services/telegramBotService','length','disconnectUser','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','test_payout_123','getBotInfo','lastName','sendCustomNotification','getBotStatus','sendBroadcast','completed','sendShopNotification','true','username','telegramUser','sendPayoutNotification','6585vOvuSz','isActive','createdAt','json','4753331PkEkiH','Message\x20is\x20required','4073110xCjOuV','custom','sendPaymentNotification'];a12_0x5109=function(){return _0x3408a2;};return a12_0x5109();}