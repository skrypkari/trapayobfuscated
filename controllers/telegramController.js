'use strict';const a12_0x1529eb=a12_0x27f4;(function(_0x2b9a66,_0xe8e06f){const _0x36b8e6=a12_0x27f4,_0x368517=_0x2b9a66();while(!![]){try{const _0x323e3d=-parseInt(_0x36b8e6(0x11e))/0x1*(-parseInt(_0x36b8e6(0x112))/0x2)+-parseInt(_0x36b8e6(0x128))/0x3+-parseInt(_0x36b8e6(0x146))/0x4+parseInt(_0x36b8e6(0x122))/0x5+-parseInt(_0x36b8e6(0x140))/0x6+parseInt(_0x36b8e6(0x150))/0x7*(parseInt(_0x36b8e6(0x13a))/0x8)+parseInt(_0x36b8e6(0x129))/0x9*(-parseInt(_0x36b8e6(0x116))/0xa);if(_0x323e3d===_0xe8e06f)break;else _0x368517['push'](_0x368517['shift']());}catch(_0x20939b){_0x368517['push'](_0x368517['shift']());}}}(a12_0x36c5,0x34749));var __importDefault=this&&this[a12_0x1529eb(0x134)]||function(_0x25567d){const _0x1f2321=a12_0x1529eb;return _0x25567d&&_0x25567d[_0x1f2321(0x14f)]?_0x25567d:{'default':_0x25567d};};function a12_0x27f4(_0x4e6519,_0x54ea80){const _0x36c5e0=a12_0x36c5();return a12_0x27f4=function(_0x27f4e5,_0x4d035a){_0x27f4e5=_0x27f4e5-0x110;let _0x138ccd=_0x36c5e0[_0x27f4e5];return _0x138ccd;},a12_0x27f4(_0x4e6519,_0x54ea80);}function a12_0x36c5(){const _0x294bde=['shop','../services/telegramBotService','USD','all','desc','sendShopNotification','__importDefault','sendTestNotification','productName','isActive','User\x20disconnected\x20successfully','sendPaymentNotification','9656CUsfPq','query','status','filter','getTelegramUsers','plisio','2264316ogMwwO','This\x20is\x20a\x20test\x20notification','update','telegramUser','length','Shop\x20not\x20found','72412EQCxZG','gateway','isVerified','username','json','sendPayoutNotification','map','default','ceil','__esModule','973dOfIGs','completed','custom','../config/database','title','telegramBotService','2OvXOWz','TelegramController','\x20notification\x20sent\x20successfully','findUnique','10naFeBg','defineProperty','count','currency','groupBy','Test\x20Notification','Test\x20','test_payout_123','395935ROstAj','firstName','body','params','737175IHvgqH','payment','getBotInfo','shopId','sendCustomNotification','true','223836uGrive','235665XkoKmn','Markdown','getBotStatus','findMany','Telegram\x20user\x20not\x20found'];a12_0x36c5=function(){return _0x294bde;};return a12_0x36c5();}Object[a12_0x1529eb(0x117)](exports,a12_0x1529eb(0x14f),{'value':!![]}),exports[a12_0x1529eb(0x113)]=void 0x0;const telegramBotService_1=require(a12_0x1529eb(0x12f)),database_1=__importDefault(require(a12_0x1529eb(0x153)));class TelegramController{constructor(){const _0x36be60=a12_0x1529eb;this[_0x36be60(0x12b)]=async(_0x17ec21,_0x347950,_0x31d8f0)=>{const _0x5e9585=_0x36be60;try{const _0x298d8c=telegramBotService_1[_0x5e9585(0x111)][_0x5e9585(0x124)](),_0x3e5548=await database_1[_0x5e9585(0x14d)]['telegramUser']['count'](),_0x1827cd=await database_1[_0x5e9585(0x14d)][_0x5e9585(0x143)]['count']({'where':{'isVerified':!![]}}),_0x2e9e0d=await database_1['default'][_0x5e9585(0x143)][_0x5e9585(0x11a)]({'by':[_0x5e9585(0x125)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x347950[_0x5e9585(0x14a)]({'success':!![],'result':{'bot':{'isActive':_0x298d8c[_0x5e9585(0x137)],'username':_0x298d8c[_0x5e9585(0x149)]},'statistics':{'totalUsers':_0x3e5548,'verifiedUsers':_0x1827cd,'unverifiedUsers':_0x3e5548-_0x1827cd,'connectedShops':_0x2e9e0d[_0x5e9585(0x144)]}}});}catch(_0x5890d9){_0x31d8f0(_0x5890d9);}},this[_0x36be60(0x13e)]=async(_0x1b11a3,_0x1d6b5b,_0x118e49)=>{const _0x2ad981=_0x36be60;try{const {page:page=0x1,limit:limit=0x14,verified:_0x39a078}=_0x1b11a3[_0x2ad981(0x13b)],_0x5f0c8a=(Number(page)-0x1)*Number(limit),_0x5b225d={};_0x39a078!==undefined&&(_0x5b225d[_0x2ad981(0x148)]=_0x39a078===_0x2ad981(0x127));const [_0x70197,_0x1973e1]=await Promise[_0x2ad981(0x131)]([database_1[_0x2ad981(0x14d)][_0x2ad981(0x143)][_0x2ad981(0x12c)]({'where':_0x5b225d,'skip':_0x5f0c8a,'take':Number(limit),'orderBy':{'createdAt':_0x2ad981(0x132)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2ad981(0x14d)][_0x2ad981(0x143)][_0x2ad981(0x118)]({'where':_0x5b225d})]);_0x1d6b5b[_0x2ad981(0x14a)]({'success':!![],'users':_0x70197[_0x2ad981(0x14c)](_0x20292e=>({'id':_0x20292e['id'],'telegramId':_0x20292e['telegramId'],'username':_0x20292e[_0x2ad981(0x149)],'firstName':_0x20292e[_0x2ad981(0x11f)],'lastName':_0x20292e['lastName'],'isVerified':_0x20292e[_0x2ad981(0x148)],'shop':_0x20292e[_0x2ad981(0x12e)],'createdAt':_0x20292e['createdAt'],'updatedAt':_0x20292e['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1973e1,'totalPages':Math[_0x2ad981(0x14e)](_0x1973e1/Number(limit))}});}catch(_0x28a6bc){_0x118e49(_0x28a6bc);}},this['sendBroadcast']=async(_0x5d514f,_0x5b6230,_0x58368a)=>{const _0x579a93=_0x36be60;try{const {message:_0x1ea93f,shopId:_0x12b51d}=_0x5d514f['body'];if(!_0x1ea93f)return _0x5b6230[_0x579a93(0x13c)](0x190)[_0x579a93(0x14a)]({'success':![],'message':'Message\x20is\x20required'});if(_0x12b51d)await telegramBotService_1['telegramBotService'][_0x579a93(0x133)](_0x12b51d,_0x1ea93f,{'parse_mode':_0x579a93(0x12a)});else{const _0x3cd31d=await database_1[_0x579a93(0x14d)]['telegramUser'][_0x579a93(0x12c)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2957f2=[...new Set(_0x3cd31d[_0x579a93(0x14c)](_0x25d45f=>_0x25d45f['shopId'])[_0x579a93(0x13d)](Boolean))];for(const _0x27af70 of _0x2957f2){_0x27af70&&await telegramBotService_1[_0x579a93(0x111)][_0x579a93(0x133)](_0x27af70,_0x1ea93f,{'parse_mode':'Markdown'});}}_0x5b6230[_0x579a93(0x14a)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x30b859){_0x58368a(_0x30b859);}},this['disconnectUser']=async(_0x322828,_0xe34c74,_0x11b1d1)=>{const _0x2aeec5=_0x36be60;try{const {telegramId:_0x1e7bb4}=_0x322828[_0x2aeec5(0x121)],_0x174718=await database_1[_0x2aeec5(0x14d)][_0x2aeec5(0x143)][_0x2aeec5(0x115)]({'where':{'telegramId':_0x1e7bb4},'include':{'shop':!![]}});if(!_0x174718)return _0xe34c74[_0x2aeec5(0x13c)](0x194)[_0x2aeec5(0x14a)]({'success':![],'message':_0x2aeec5(0x12d)});await database_1['default'][_0x2aeec5(0x143)][_0x2aeec5(0x142)]({'where':{'telegramId':_0x1e7bb4},'data':{'shopId':null,'isVerified':![]}}),_0xe34c74[_0x2aeec5(0x14a)]({'success':!![],'message':_0x2aeec5(0x138)});}catch(_0x18c670){_0x11b1d1(_0x18c670);}},this[_0x36be60(0x135)]=async(_0x5bee75,_0x206560,_0x3e4373)=>{const _0x34b645=_0x36be60;try{const {shopId:_0x22dca5,type:type=_0x34b645(0x123),testData:_0x1485b8}=_0x5bee75[_0x34b645(0x120)];if(!_0x22dca5)return _0x206560[_0x34b645(0x13c)](0x190)[_0x34b645(0x14a)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x2ea4e2=await database_1['default']['shop'][_0x34b645(0x115)]({'where':{'id':_0x22dca5},'select':{'id':!![],'name':!![]}});if(!_0x2ea4e2)return _0x206560['status'](0x194)[_0x34b645(0x14a)]({'success':![],'message':_0x34b645(0x145)});switch(type){case _0x34b645(0x123):const _0x1392f7={'id':'test_payment_123','amount':_0x1485b8?.['amount']||0x64,'currency':_0x1485b8?.[_0x34b645(0x119)]||_0x34b645(0x130),'productName':_0x1485b8?.[_0x34b645(0x136)]||'Test\x20Product','gateway':_0x1485b8?.[_0x34b645(0x147)]||_0x34b645(0x13f),'createdAt':new Date(),..._0x1485b8};await telegramBotService_1[_0x34b645(0x111)][_0x34b645(0x139)](_0x22dca5,_0x1392f7,'paid');break;case'payout':const _0x1dd582={'id':_0x34b645(0x11d),'amount':_0x1485b8?.['amount']||0x1f4,'method':_0x1485b8?.['method']||'bank_transfer','createdAt':new Date(),..._0x1485b8};await telegramBotService_1[_0x34b645(0x111)][_0x34b645(0x14b)](_0x22dca5,_0x1dd582,_0x34b645(0x151));break;case _0x34b645(0x152):await telegramBotService_1[_0x34b645(0x111)][_0x34b645(0x126)](_0x22dca5,_0x1485b8?.[_0x34b645(0x110)]||_0x34b645(0x11b),_0x1485b8?.['details']||{'message':_0x34b645(0x141)});break;default:return _0x206560['status'](0x190)[_0x34b645(0x14a)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x206560['json']({'success':!![],'message':_0x34b645(0x11c)+type+_0x34b645(0x114)});}catch(_0x42afb0){_0x3e4373(_0x42afb0);}};}}exports['TelegramController']=TelegramController;