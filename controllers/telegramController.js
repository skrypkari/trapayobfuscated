'use strict';function a12_0x40ac(_0x15248c,_0x2b72da){const _0x439cb2=a12_0x439c();return a12_0x40ac=function(_0x40ac75,_0x48529a){_0x40ac75=_0x40ac75-0xaa;let _0x2de6da=_0x439cb2[_0x40ac75];return _0x2de6da;},a12_0x40ac(_0x15248c,_0x2b72da);}const a12_0x4b4532=a12_0x40ac;(function(_0xed46e4,_0x237932){const _0x3e8a36=a12_0x40ac,_0x2b1bc6=_0xed46e4();while(!![]){try{const _0x2ad95b=parseInt(_0x3e8a36(0xd3))/0x1+parseInt(_0x3e8a36(0xb0))/0x2+parseInt(_0x3e8a36(0xb1))/0x3+parseInt(_0x3e8a36(0xc5))/0x4+-parseInt(_0x3e8a36(0xaf))/0x5+-parseInt(_0x3e8a36(0xba))/0x6*(-parseInt(_0x3e8a36(0xab))/0x7)+-parseInt(_0x3e8a36(0xbe))/0x8*(parseInt(_0x3e8a36(0xec))/0x9);if(_0x2ad95b===_0x237932)break;else _0x2b1bc6['push'](_0x2b1bc6['shift']());}catch(_0x4c63fe){_0x2b1bc6['push'](_0x2b1bc6['shift']());}}}(a12_0x439c,0x6e76d));var __importDefault=this&&this[a12_0x4b4532(0xc0)]||function(_0x14370c){return _0x14370c&&_0x14370c['__esModule']?_0x14370c:{'default':_0x14370c};};Object[a12_0x4b4532(0xd4)](exports,a12_0x4b4532(0xb3),{'value':!![]}),exports[a12_0x4b4532(0xbd)]=void 0x0;function a12_0x439c(){const _0x559b7a=['getBotInfo','sendShopNotification','payment','true','This\x20is\x20a\x20test\x20notification','Shop\x20not\x20found','username','ceil','json','telegramBotService','productName','isActive','findMany','params','disconnectUser','test_payout_123','shopId','18501417mRwsOa','status','telegramUser','Message\x20is\x20required','groupBy','7YNthxH','desc','sendPaymentNotification','Test\x20','3164060FvyFYt','1598230DvmNIN','2248947jlooHp','Telegram\x20user\x20not\x20found','__esModule','currency','\x20notification\x20sent\x20successfully','body','filter','Shop\x20ID\x20is\x20required','count','4547082zaTpKl','telegramId','update','TelegramController','8cnzpmM','Test\x20Product','__importDefault','method','Broadcast\x20message\x20sent\x20successfully','test_payment_123','sendTestNotification','2942588WJPfhD','updatedAt','Markdown','payout','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','amount','length','firstName','sendPayoutNotification','completed','getBotStatus','findUnique','../config/database','lastName','98728UJWfvN','defineProperty','map','default','Test\x20Notification','details','isVerified','../services/telegramBotService'];a12_0x439c=function(){return _0x559b7a;};return a12_0x439c();}const telegramBotService_1=require(a12_0x4b4532(0xda)),database_1=__importDefault(require(a12_0x4b4532(0xd1)));class TelegramController{constructor(){const _0x1aaaa0=a12_0x4b4532;this[_0x1aaaa0(0xcf)]=async(_0x13d3f1,_0xc93c47,_0x55dc18)=>{const _0x176b94=_0x1aaaa0;try{const _0x762c19=telegramBotService_1['telegramBotService'][_0x176b94(0xdb)](),_0x33de9a=await database_1[_0x176b94(0xd6)][_0x176b94(0xee)][_0x176b94(0xb9)](),_0x13bc91=await database_1[_0x176b94(0xd6)][_0x176b94(0xee)]['count']({'where':{'isVerified':!![]}}),_0x17f024=await database_1[_0x176b94(0xd6)][_0x176b94(0xee)][_0x176b94(0xaa)]({'by':[_0x176b94(0xeb)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xc93c47['json']({'success':!![],'result':{'bot':{'isActive':_0x762c19[_0x176b94(0xe6)],'username':_0x762c19[_0x176b94(0xe1)]},'statistics':{'totalUsers':_0x33de9a,'verifiedUsers':_0x13bc91,'unverifiedUsers':_0x33de9a-_0x13bc91,'connectedShops':_0x17f024[_0x176b94(0xcb)]}}});}catch(_0x8eda04){_0x55dc18(_0x8eda04);}},this['getTelegramUsers']=async(_0x8f2b94,_0x133578,_0x5d50c5)=>{const _0xa59e2a=_0x1aaaa0;try{const {page:page=0x1,limit:limit=0x14,verified:_0x22328a}=_0x8f2b94['query'],_0x260714=(Number(page)-0x1)*Number(limit),_0x5f31fa={};_0x22328a!==undefined&&(_0x5f31fa[_0xa59e2a(0xd9)]=_0x22328a===_0xa59e2a(0xde));const [_0x51204f,_0x3458aa]=await Promise['all']([database_1['default'][_0xa59e2a(0xee)][_0xa59e2a(0xe7)]({'where':_0x5f31fa,'skip':_0x260714,'take':Number(limit),'orderBy':{'createdAt':_0xa59e2a(0xac)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0xa59e2a(0xd6)][_0xa59e2a(0xee)][_0xa59e2a(0xb9)]({'where':_0x5f31fa})]);_0x133578[_0xa59e2a(0xe3)]({'success':!![],'users':_0x51204f[_0xa59e2a(0xd5)](_0x2ecece=>({'id':_0x2ecece['id'],'telegramId':_0x2ecece[_0xa59e2a(0xbb)],'username':_0x2ecece[_0xa59e2a(0xe1)],'firstName':_0x2ecece[_0xa59e2a(0xcc)],'lastName':_0x2ecece[_0xa59e2a(0xd2)],'isVerified':_0x2ecece[_0xa59e2a(0xd9)],'shop':_0x2ecece['shop'],'createdAt':_0x2ecece['createdAt'],'updatedAt':_0x2ecece[_0xa59e2a(0xc6)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3458aa,'totalPages':Math[_0xa59e2a(0xe2)](_0x3458aa/Number(limit))}});}catch(_0x4db020){_0x5d50c5(_0x4db020);}},this['sendBroadcast']=async(_0x20bbcd,_0x353a17,_0x1dc570)=>{const _0x57b484=_0x1aaaa0;try{const {message:_0x13df2a,shopId:_0x509514}=_0x20bbcd[_0x57b484(0xb6)];if(!_0x13df2a)return _0x353a17[_0x57b484(0xed)](0x190)[_0x57b484(0xe3)]({'success':![],'message':_0x57b484(0xef)});if(_0x509514)await telegramBotService_1[_0x57b484(0xe4)][_0x57b484(0xdc)](_0x509514,_0x13df2a,{'parse_mode':_0x57b484(0xc7)});else{const _0x11eaad=await database_1[_0x57b484(0xd6)][_0x57b484(0xee)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3a2987=[...new Set(_0x11eaad['map'](_0x398630=>_0x398630[_0x57b484(0xeb)])[_0x57b484(0xb7)](Boolean))];for(const _0x4241ec of _0x3a2987){_0x4241ec&&await telegramBotService_1[_0x57b484(0xe4)]['sendShopNotification'](_0x4241ec,_0x13df2a,{'parse_mode':_0x57b484(0xc7)});}}_0x353a17[_0x57b484(0xe3)]({'success':!![],'message':_0x57b484(0xc2)});}catch(_0x4d4025){_0x1dc570(_0x4d4025);}},this[_0x1aaaa0(0xe9)]=async(_0x1a5936,_0x3d2e0e,_0x46fd19)=>{const _0x2bd9e5=_0x1aaaa0;try{const {telegramId:_0x105222}=_0x1a5936[_0x2bd9e5(0xe8)],_0x25f07d=await database_1[_0x2bd9e5(0xd6)][_0x2bd9e5(0xee)][_0x2bd9e5(0xd0)]({'where':{'telegramId':_0x105222},'include':{'shop':!![]}});if(!_0x25f07d)return _0x3d2e0e[_0x2bd9e5(0xed)](0x194)[_0x2bd9e5(0xe3)]({'success':![],'message':_0x2bd9e5(0xb2)});await database_1[_0x2bd9e5(0xd6)]['telegramUser'][_0x2bd9e5(0xbc)]({'where':{'telegramId':_0x105222},'data':{'shopId':null,'isVerified':![]}}),_0x3d2e0e[_0x2bd9e5(0xe3)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x3f297c){_0x46fd19(_0x3f297c);}},this[_0x1aaaa0(0xc4)]=async(_0x116d42,_0x17014b,_0x51ea13)=>{const _0x5503df=_0x1aaaa0;try{const {shopId:_0x2778f3,type:type='payment',testData:_0x233388}=_0x116d42[_0x5503df(0xb6)];if(!_0x2778f3)return _0x17014b[_0x5503df(0xed)](0x190)[_0x5503df(0xe3)]({'success':![],'message':_0x5503df(0xb8)});const _0x474800=await database_1[_0x5503df(0xd6)]['shop']['findUnique']({'where':{'id':_0x2778f3},'select':{'id':!![],'name':!![]}});if(!_0x474800)return _0x17014b[_0x5503df(0xed)](0x194)[_0x5503df(0xe3)]({'success':![],'message':_0x5503df(0xe0)});switch(type){case _0x5503df(0xdd):const _0x156b49={'id':_0x5503df(0xc3),'amount':_0x233388?.[_0x5503df(0xca)]||0x64,'currency':_0x233388?.[_0x5503df(0xb4)]||'USD','productName':_0x233388?.[_0x5503df(0xe5)]||_0x5503df(0xbf),'gateway':_0x233388?.['gateway']||'plisio','createdAt':new Date(),..._0x233388};await telegramBotService_1[_0x5503df(0xe4)][_0x5503df(0xad)](_0x2778f3,_0x156b49,'paid');break;case _0x5503df(0xc8):const _0x581deb={'id':_0x5503df(0xea),'amount':_0x233388?.['amount']||0x1f4,'method':_0x233388?.[_0x5503df(0xc1)]||'bank_transfer','createdAt':new Date(),..._0x233388};await telegramBotService_1[_0x5503df(0xe4)][_0x5503df(0xcd)](_0x2778f3,_0x581deb,_0x5503df(0xce));break;case'custom':await telegramBotService_1[_0x5503df(0xe4)]['sendCustomNotification'](_0x2778f3,_0x233388?.['title']||_0x5503df(0xd7),_0x233388?.[_0x5503df(0xd8)]||{'message':_0x5503df(0xdf)});break;default:return _0x17014b[_0x5503df(0xed)](0x190)['json']({'success':![],'message':_0x5503df(0xc9)});}_0x17014b[_0x5503df(0xe3)]({'success':!![],'message':_0x5503df(0xae)+type+_0x5503df(0xb5)});}catch(_0x358894){_0x51ea13(_0x358894);}};}}exports[a12_0x4b4532(0xbd)]=TelegramController;