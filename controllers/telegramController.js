'use strict';const a12_0x5f2d8d=a12_0x3d2e;function a12_0x3d2e(_0x39e822,_0x2f1757){const _0x4396f1=a12_0x4396();return a12_0x3d2e=function(_0x3d2ec9,_0x37e26e){_0x3d2ec9=_0x3d2ec9-0xb8;let _0x8704c1=_0x4396f1[_0x3d2ec9];return _0x8704c1;},a12_0x3d2e(_0x39e822,_0x2f1757);}(function(_0x544e33,_0x2c978b){const _0x28028d=a12_0x3d2e,_0x1da75b=_0x544e33();while(!![]){try{const _0x3ad843=-parseInt(_0x28028d(0xe7))/0x1*(-parseInt(_0x28028d(0xd6))/0x2)+-parseInt(_0x28028d(0xcf))/0x3+-parseInt(_0x28028d(0xda))/0x4*(-parseInt(_0x28028d(0xf1))/0x5)+parseInt(_0x28028d(0xd5))/0x6+parseInt(_0x28028d(0xc6))/0x7*(-parseInt(_0x28028d(0xed))/0x8)+parseInt(_0x28028d(0xfc))/0x9+parseInt(_0x28028d(0x101))/0xa*(-parseInt(_0x28028d(0xf7))/0xb);if(_0x3ad843===_0x2c978b)break;else _0x1da75b['push'](_0x1da75b['shift']());}catch(_0x231d79){_0x1da75b['push'](_0x1da75b['shift']());}}}(a12_0x4396,0x300f8));var __importDefault=this&&this[a12_0x5f2d8d(0xc5)]||function(_0x42215e){return _0x42215e&&_0x42215e['__esModule']?_0x42215e:{'default':_0x42215e};};Object['defineProperty'](exports,a12_0x5f2d8d(0xd7),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x5f2d8d(0xf3)),database_1=__importDefault(require(a12_0x5f2d8d(0xce)));function a12_0x4396(){const _0x425ff6=['status','test_payout_123','findMany','isVerified','shop','getBotStatus','params','../config/database','387744gqvmqv','sendTestNotification','gateway','TelegramController','findUnique','paid','1182852zUeEhW','2jeOblH','__esModule','Message\x20is\x20required','Test\x20Product','100HptgdI','sendBroadcast','lastName','Test\x20','ceil','Shop\x20not\x20found','json','Test\x20Notification','body','desc','completed','isActive','sendShopNotification','48661gHJHwV','map','USD','sendPayoutNotification','bank_transfer','length','1164816xzZLAh','currency','true','test_payment_123','47455nUHuHu','firstName','../services/telegramBotService','createdAt','update','updatedAt','954646RqvKzR','amount','Broadcast\x20message\x20sent\x20successfully','telegramBotService','getBotInfo','678726ymubkK','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','plisio','sendCustomNotification','payment','10brwGXr','count','filter','telegramUser','method','payout','default','title','username','disconnectUser','Telegram\x20user\x20not\x20found','\x20notification\x20sent\x20successfully','Markdown','query','This\x20is\x20a\x20test\x20notification','shopId','productName','__importDefault','7XiXlaA'];a12_0x4396=function(){return _0x425ff6;};return a12_0x4396();}class TelegramController{constructor(){const _0x21b5c4=a12_0x5f2d8d;this[_0x21b5c4(0xcc)]=async(_0x43567d,_0x5db613,_0x3ebe74)=>{const _0x43988d=_0x21b5c4;try{const _0x74d3a5=telegramBotService_1['telegramBotService'][_0x43988d(0xfb)](),_0x134b01=await database_1[_0x43988d(0xba)]['telegramUser'][_0x43988d(0x102)](),_0x32f61b=await database_1[_0x43988d(0xba)][_0x43988d(0x104)][_0x43988d(0x102)]({'where':{'isVerified':!![]}}),_0x24e514=await database_1['default'][_0x43988d(0x104)]['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5db613['json']({'success':!![],'result':{'bot':{'isActive':_0x74d3a5[_0x43988d(0xe5)],'username':_0x74d3a5[_0x43988d(0xbc)]},'statistics':{'totalUsers':_0x134b01,'verifiedUsers':_0x32f61b,'unverifiedUsers':_0x134b01-_0x32f61b,'connectedShops':_0x24e514[_0x43988d(0xec)]}}});}catch(_0x305a2e){_0x3ebe74(_0x305a2e);}},this['getTelegramUsers']=async(_0x2daefc,_0x40736d,_0x1c945b)=>{const _0x4abea0=_0x21b5c4;try{const {page:page=0x1,limit:limit=0x14,verified:_0x9756d5}=_0x2daefc[_0x4abea0(0xc1)],_0x20bcb0=(Number(page)-0x1)*Number(limit),_0x37d22e={};_0x9756d5!==undefined&&(_0x37d22e[_0x4abea0(0xca)]=_0x9756d5===_0x4abea0(0xef));const [_0x2718c4,_0xaee286]=await Promise['all']([database_1['default'][_0x4abea0(0x104)]['findMany']({'where':_0x37d22e,'skip':_0x20bcb0,'take':Number(limit),'orderBy':{'createdAt':_0x4abea0(0xe3)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4abea0(0xba)][_0x4abea0(0x104)][_0x4abea0(0x102)]({'where':_0x37d22e})]);_0x40736d[_0x4abea0(0xe0)]({'success':!![],'users':_0x2718c4['map'](_0x5b2b3c=>({'id':_0x5b2b3c['id'],'telegramId':_0x5b2b3c['telegramId'],'username':_0x5b2b3c[_0x4abea0(0xbc)],'firstName':_0x5b2b3c[_0x4abea0(0xf2)],'lastName':_0x5b2b3c[_0x4abea0(0xdc)],'isVerified':_0x5b2b3c[_0x4abea0(0xca)],'shop':_0x5b2b3c[_0x4abea0(0xcb)],'createdAt':_0x5b2b3c[_0x4abea0(0xf4)],'updatedAt':_0x5b2b3c[_0x4abea0(0xf6)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xaee286,'totalPages':Math[_0x4abea0(0xde)](_0xaee286/Number(limit))}});}catch(_0x49c4ab){_0x1c945b(_0x49c4ab);}},this[_0x21b5c4(0xdb)]=async(_0x38661f,_0x4bbedd,_0x87704c)=>{const _0x202c70=_0x21b5c4;try{const {message:_0xc13c0c,shopId:_0x35d757}=_0x38661f['body'];if(!_0xc13c0c)return _0x4bbedd[_0x202c70(0xc7)](0x190)['json']({'success':![],'message':_0x202c70(0xd8)});if(_0x35d757)await telegramBotService_1[_0x202c70(0xfa)][_0x202c70(0xe6)](_0x35d757,_0xc13c0c,{'parse_mode':_0x202c70(0xc0)});else{const _0x9b2824=await database_1['default']['telegramUser'][_0x202c70(0xc9)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x37a94c=[...new Set(_0x9b2824[_0x202c70(0xe8)](_0x207476=>_0x207476[_0x202c70(0xc3)])[_0x202c70(0x103)](Boolean))];for(const _0x489b30 of _0x37a94c){_0x489b30&&await telegramBotService_1[_0x202c70(0xfa)][_0x202c70(0xe6)](_0x489b30,_0xc13c0c,{'parse_mode':_0x202c70(0xc0)});}}_0x4bbedd[_0x202c70(0xe0)]({'success':!![],'message':_0x202c70(0xf9)});}catch(_0x5606d0){_0x87704c(_0x5606d0);}},this[_0x21b5c4(0xbd)]=async(_0x2a4e4f,_0x14c831,_0x59def0)=>{const _0x5b5402=_0x21b5c4;try{const {telegramId:_0x591fe4}=_0x2a4e4f[_0x5b5402(0xcd)],_0x281f2e=await database_1[_0x5b5402(0xba)][_0x5b5402(0x104)][_0x5b5402(0xd3)]({'where':{'telegramId':_0x591fe4},'include':{'shop':!![]}});if(!_0x281f2e)return _0x14c831[_0x5b5402(0xc7)](0x194)[_0x5b5402(0xe0)]({'success':![],'message':_0x5b5402(0xbe)});await database_1[_0x5b5402(0xba)][_0x5b5402(0x104)][_0x5b5402(0xf5)]({'where':{'telegramId':_0x591fe4},'data':{'shopId':null,'isVerified':![]}}),_0x14c831['json']({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x179622){_0x59def0(_0x179622);}},this[_0x21b5c4(0xd0)]=async(_0x4d14d5,_0x284306,_0x428a52)=>{const _0xd999b8=_0x21b5c4;try{const {shopId:_0x431b13,type:type=_0xd999b8(0x100),testData:_0x3e63d4}=_0x4d14d5[_0xd999b8(0xe2)];if(!_0x431b13)return _0x284306[_0xd999b8(0xc7)](0x190)[_0xd999b8(0xe0)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x242869=await database_1[_0xd999b8(0xba)][_0xd999b8(0xcb)][_0xd999b8(0xd3)]({'where':{'id':_0x431b13},'select':{'id':!![],'name':!![]}});if(!_0x242869)return _0x284306[_0xd999b8(0xc7)](0x194)['json']({'success':![],'message':_0xd999b8(0xdf)});switch(type){case'payment':const _0x1cadbf={'id':_0xd999b8(0xf0),'amount':_0x3e63d4?.[_0xd999b8(0xf8)]||0x64,'currency':_0x3e63d4?.[_0xd999b8(0xee)]||_0xd999b8(0xe9),'productName':_0x3e63d4?.[_0xd999b8(0xc4)]||_0xd999b8(0xd9),'gateway':_0x3e63d4?.[_0xd999b8(0xd1)]||_0xd999b8(0xfe),'createdAt':new Date(),..._0x3e63d4};await telegramBotService_1[_0xd999b8(0xfa)]['sendPaymentNotification'](_0x431b13,_0x1cadbf,_0xd999b8(0xd4));break;case _0xd999b8(0xb9):const _0x23db2c={'id':_0xd999b8(0xc8),'amount':_0x3e63d4?.[_0xd999b8(0xf8)]||0x1f4,'method':_0x3e63d4?.[_0xd999b8(0xb8)]||_0xd999b8(0xeb),'createdAt':new Date(),..._0x3e63d4};await telegramBotService_1[_0xd999b8(0xfa)][_0xd999b8(0xea)](_0x431b13,_0x23db2c,_0xd999b8(0xe4));break;case'custom':await telegramBotService_1[_0xd999b8(0xfa)][_0xd999b8(0xff)](_0x431b13,_0x3e63d4?.[_0xd999b8(0xbb)]||_0xd999b8(0xe1),_0x3e63d4?.['details']||{'message':_0xd999b8(0xc2)});break;default:return _0x284306[_0xd999b8(0xc7)](0x190)['json']({'success':![],'message':_0xd999b8(0xfd)});}_0x284306['json']({'success':!![],'message':_0xd999b8(0xdd)+type+_0xd999b8(0xbf)});}catch(_0x1eab90){_0x428a52(_0x1eab90);}};}}exports[a12_0x5f2d8d(0xd2)]=TelegramController;