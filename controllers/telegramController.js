'use strict';const a19_0x2b930f=a19_0x302e;function a19_0x302e(_0x3785c3,_0x5016ff){_0x3785c3=_0x3785c3-0x14f;const _0x5a08e6=a19_0x5a08();let _0x302e66=_0x5a08e6[_0x3785c3];return _0x302e66;}(function(_0x3f483b,_0x43b45a){const _0x3c911c=a19_0x302e,_0x17fa9a=_0x3f483b();while(!![]){try{const _0x31729d=parseInt(_0x3c911c(0x172))/0x1+parseInt(_0x3c911c(0x184))/0x2+-parseInt(_0x3c911c(0x165))/0x3+-parseInt(_0x3c911c(0x17e))/0x4*(-parseInt(_0x3c911c(0x188))/0x5)+parseInt(_0x3c911c(0x151))/0x6+-parseInt(_0x3c911c(0x178))/0x7*(parseInt(_0x3c911c(0x171))/0x8)+-parseInt(_0x3c911c(0x18e))/0x9;if(_0x31729d===_0x43b45a)break;else _0x17fa9a['push'](_0x17fa9a['shift']());}catch(_0x5924f6){_0x17fa9a['push'](_0x17fa9a['shift']());}}}(a19_0x5a08,0xdda1b));function a19_0x5a08(){const _0x1e209e=['sendBroadcast','60jQYFUb','details','Message\x20is\x20required','../services/telegramBotService','shop','length','1039552BAMHOI','gateway','sendCustomNotification','defineProperty','177015FUaeig','body','TRC20','isVerified','sendPayoutNotification','test_payout_123','14010750mouTVG','wallet','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','test_payment_123','params','isActive','currency','Markdown','shopId','getBotInfo','telegramUser','sendShopNotification','3371508UzmJWN','username','payout','Broadcast\x20message\x20sent\x20successfully','productName','json','Test\x20Product','telegramBotService','Telegram\x20user\x20not\x20found','plisio','default','status','USD','TelegramController','This\x20is\x20a\x20test\x20notification','custom','findUnique','__esModule','firstName','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','372549LwiaDZ','title','Test\x20','User\x20disconnected\x20successfully','sendPaymentNotification','findMany','getTelegramUsers','lastName','createdAt','__importDefault','map','groupBy','136MZvkns','1318292FAbNua','update','\x20notification\x20sent\x20successfully','filter','count','Shop\x20ID\x20is\x20required','140945fsAJqG','sendTestNotification','Test\x20Notification','disconnectUser','amount'];a19_0x5a08=function(){return _0x1e209e;};return a19_0x5a08();}var __importDefault=this&&this[a19_0x2b930f(0x16e)]||function(_0x3d04b2){const _0x5d1c58=a19_0x2b930f;return _0x3d04b2&&_0x3d04b2[_0x5d1c58(0x162)]?_0x3d04b2:{'default':_0x3d04b2};};Object[a19_0x2b930f(0x187)](exports,a19_0x2b930f(0x162),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a19_0x2b930f(0x181)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x4e11a9=a19_0x2b930f;this['getBotStatus']=async(_0x45b427,_0x4ff0b0,_0x559771)=>{const _0x4cee4b=a19_0x302e;try{const _0x12f8fa=telegramBotService_1['telegramBotService'][_0x4cee4b(0x197)](),_0x23cfdb=await database_1[_0x4cee4b(0x15b)][_0x4cee4b(0x14f)][_0x4cee4b(0x176)](),_0x508dae=await database_1[_0x4cee4b(0x15b)][_0x4cee4b(0x14f)][_0x4cee4b(0x176)]({'where':{'isVerified':!![]}}),_0x404911=await database_1[_0x4cee4b(0x15b)]['telegramUser'][_0x4cee4b(0x170)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4ff0b0[_0x4cee4b(0x156)]({'success':!![],'result':{'bot':{'isActive':_0x12f8fa[_0x4cee4b(0x193)],'username':_0x12f8fa[_0x4cee4b(0x152)]},'statistics':{'totalUsers':_0x23cfdb,'verifiedUsers':_0x508dae,'unverifiedUsers':_0x23cfdb-_0x508dae,'connectedShops':_0x404911[_0x4cee4b(0x183)]}}});}catch(_0x3e4852){_0x559771(_0x3e4852);}},this[_0x4e11a9(0x16b)]=async(_0x80a965,_0x4b6407,_0x16e81c)=>{const _0x148016=_0x4e11a9;try{const {page:page=0x1,limit:limit=0x14,verified:_0x26aeef}=_0x80a965['query'],_0x3187c7=(Number(page)-0x1)*Number(limit),_0x52255e={};_0x26aeef!==undefined&&(_0x52255e[_0x148016(0x18b)]=_0x26aeef==='true');const [_0x344143,_0x10a235]=await Promise['all']([database_1['default'][_0x148016(0x14f)]['findMany']({'where':_0x52255e,'skip':_0x3187c7,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x148016(0x15b)]['telegramUser']['count']({'where':_0x52255e})]);_0x4b6407['json']({'success':!![],'users':_0x344143[_0x148016(0x16f)](_0x5116e0=>({'id':_0x5116e0['id'],'telegramId':_0x5116e0['telegramId'],'username':_0x5116e0[_0x148016(0x152)],'firstName':_0x5116e0[_0x148016(0x163)],'lastName':_0x5116e0[_0x148016(0x16c)],'isVerified':_0x5116e0[_0x148016(0x18b)],'shop':_0x5116e0[_0x148016(0x182)],'createdAt':_0x5116e0[_0x148016(0x16d)],'updatedAt':_0x5116e0['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x10a235,'totalPages':Math['ceil'](_0x10a235/Number(limit))}});}catch(_0x5a28f3){_0x16e81c(_0x5a28f3);}},this[_0x4e11a9(0x17d)]=async(_0x14e0a2,_0xafe58c,_0x234ce7)=>{const _0x55ca13=_0x4e11a9;try{const {message:_0x51dc5a,shopId:_0x11d464}=_0x14e0a2['body'];if(!_0x51dc5a)return _0xafe58c[_0x55ca13(0x15c)](0x190)[_0x55ca13(0x156)]({'success':![],'message':_0x55ca13(0x180)});if(_0x11d464)await telegramBotService_1[_0x55ca13(0x158)][_0x55ca13(0x150)](_0x11d464,_0x51dc5a,{'parse_mode':_0x55ca13(0x195)});else{const _0x78f557=await database_1[_0x55ca13(0x15b)]['telegramUser'][_0x55ca13(0x16a)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x13388f=[...new Set(_0x78f557[_0x55ca13(0x16f)](_0x32febf=>_0x32febf[_0x55ca13(0x196)])[_0x55ca13(0x175)](Boolean))];for(const _0x213fdf of _0x13388f){_0x213fdf&&await telegramBotService_1[_0x55ca13(0x158)][_0x55ca13(0x150)](_0x213fdf,_0x51dc5a,{'parse_mode':'Markdown'});}}_0xafe58c['json']({'success':!![],'message':_0x55ca13(0x154)});}catch(_0x5f864){_0x234ce7(_0x5f864);}},this[_0x4e11a9(0x17b)]=async(_0x101b17,_0x4cee4c,_0x37994f)=>{const _0x3abed1=_0x4e11a9;try{const {telegramId:_0x7021af}=_0x101b17[_0x3abed1(0x192)],_0x5e9cdc=await database_1[_0x3abed1(0x15b)]['telegramUser']['findUnique']({'where':{'telegramId':_0x7021af},'include':{'shop':!![]}});if(!_0x5e9cdc)return _0x4cee4c[_0x3abed1(0x15c)](0x194)[_0x3abed1(0x156)]({'success':![],'message':_0x3abed1(0x159)});await database_1[_0x3abed1(0x15b)][_0x3abed1(0x14f)][_0x3abed1(0x173)]({'where':{'telegramId':_0x7021af},'data':{'shopId':null,'isVerified':![]}}),_0x4cee4c['json']({'success':!![],'message':_0x3abed1(0x168)});}catch(_0x85259a){_0x37994f(_0x85259a);}},this[_0x4e11a9(0x179)]=async(_0x319305,_0x11e4ca,_0x30731b)=>{const _0x2dc9b4=_0x4e11a9;try{const {shopId:_0x4b9d92,type:type='payment',testData:_0x42dd12}=_0x319305[_0x2dc9b4(0x189)];if(!_0x4b9d92)return _0x11e4ca[_0x2dc9b4(0x15c)](0x190)[_0x2dc9b4(0x156)]({'success':![],'message':_0x2dc9b4(0x177)});const _0xe86754=await database_1[_0x2dc9b4(0x15b)][_0x2dc9b4(0x182)][_0x2dc9b4(0x161)]({'where':{'id':_0x4b9d92},'select':{'id':!![],'name':!![]}});if(!_0xe86754)return _0x11e4ca[_0x2dc9b4(0x15c)](0x194)[_0x2dc9b4(0x156)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0x7cfc69={'id':_0x2dc9b4(0x191),'amount':_0x42dd12?.[_0x2dc9b4(0x17c)]||0x64,'currency':_0x42dd12?.[_0x2dc9b4(0x194)]||_0x2dc9b4(0x15d),'productName':_0x42dd12?.[_0x2dc9b4(0x155)]||_0x2dc9b4(0x157),'gateway':_0x42dd12?.[_0x2dc9b4(0x185)]||_0x2dc9b4(0x15a),'createdAt':new Date(),..._0x42dd12};await telegramBotService_1['telegramBotService'][_0x2dc9b4(0x169)](_0x4b9d92,_0x7cfc69,'paid');break;case _0x2dc9b4(0x153):const _0x17edd4={'id':_0x2dc9b4(0x18d),'amount':_0x42dd12?.['amount']||0x1f4,'network':_0x42dd12?.['network']||_0x2dc9b4(0x18a),'wallet':_0x42dd12?.[_0x2dc9b4(0x18f)]||_0x2dc9b4(0x164),'period':'Тестовый\x20период','createdAt':new Date(),'txid':_0x42dd12?.['txid']||null,..._0x42dd12};await telegramBotService_1[_0x2dc9b4(0x158)][_0x2dc9b4(0x18c)](_0x4b9d92,_0x17edd4);break;case _0x2dc9b4(0x160):await telegramBotService_1[_0x2dc9b4(0x158)][_0x2dc9b4(0x186)](_0x4b9d92,_0x42dd12?.[_0x2dc9b4(0x166)]||_0x2dc9b4(0x17a),_0x42dd12?.[_0x2dc9b4(0x17f)]||{'message':_0x2dc9b4(0x15f)});break;default:return _0x11e4ca['status'](0x190)['json']({'success':![],'message':_0x2dc9b4(0x190)});}_0x11e4ca[_0x2dc9b4(0x156)]({'success':!![],'message':_0x2dc9b4(0x167)+type+_0x2dc9b4(0x174)});}catch(_0x465e1f){_0x30731b(_0x465e1f);}};}}exports[a19_0x2b930f(0x15e)]=TelegramController;