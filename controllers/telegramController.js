'use strict';function a12_0x536d(){const _0x2b8cb1=['test_payout_123','User\x20disconnected\x20successfully','Telegram\x20user\x20not\x20found','__importDefault','amount','currency','query','sendPayoutNotification','../services/telegramBotService','telegramUser','sendShopNotification','plisio','disconnectUser','true','username','bank_transfer','telegramBotService','TelegramController','json','firstName','groupBy','telegramId','all','findMany','completed','details','count','shopId','getTelegramUsers','getBotInfo','lastName','Message\x20is\x20required','\x20notification\x20sent\x20successfully','This\x20is\x20a\x20test\x20notification','683271BFuVxv','productName','__esModule','filter','2201850EjIrrb','1185984rFWPgs','payment','update','244331YZxsQm','test_payment_123','isVerified','171962sinvDw','319795JVdPOg','Markdown','payout','gateway','Test\x20','map','483144mittvm','status','getBotStatus','sendBroadcast','findUnique','sendTestNotification','params','desc','Test\x20Notification','isActive','shop','createdAt','../config/database','ceil','default','body'];a12_0x536d=function(){return _0x2b8cb1;};return a12_0x536d();}const a12_0xbe3321=a12_0x31c4;(function(_0x990b4a,_0x355391){const _0x392716=a12_0x31c4,_0x4936cc=_0x990b4a();while(!![]){try{const _0x1a674d=-parseInt(_0x392716(0x110))/0x1+parseInt(_0x392716(0x113))/0x2+parseInt(_0x392716(0x108))/0x3+-parseInt(_0x392716(0x11a))/0x4+parseInt(_0x392716(0x114))/0x5+-parseInt(_0x392716(0x10d))/0x6+parseInt(_0x392716(0x10c))/0x7;if(_0x1a674d===_0x355391)break;else _0x4936cc['push'](_0x4936cc['shift']());}catch(_0x367632){_0x4936cc['push'](_0x4936cc['shift']());}}}(a12_0x536d,0x1f9ba));var __importDefault=this&&this[a12_0xbe3321(0xe9)]||function(_0x5d1ad9){const _0x3b151d=a12_0xbe3321;return _0x5d1ad9&&_0x5d1ad9[_0x3b151d(0x10a)]?_0x5d1ad9:{'default':_0x5d1ad9};};Object['defineProperty'](exports,a12_0xbe3321(0x10a),{'value':!![]}),exports[a12_0xbe3321(0xf7)]=void 0x0;function a12_0x31c4(_0x1d10ae,_0x1418e5){const _0x536d57=a12_0x536d();return a12_0x31c4=function(_0x31c4cc,_0x4313e1){_0x31c4cc=_0x31c4cc-0xdb;let _0x414a5e=_0x536d57[_0x31c4cc];return _0x414a5e;},a12_0x31c4(_0x1d10ae,_0x1418e5);}const telegramBotService_1=require(a12_0xbe3321(0xee)),database_1=__importDefault(require(a12_0xbe3321(0xe2)));class TelegramController{constructor(){const _0x4423a5=a12_0xbe3321;this[_0x4423a5(0x11c)]=async(_0x36910e,_0x1be73a,_0x4a7892)=>{const _0xfbae2d=_0x4423a5;try{const _0x4732d6=telegramBotService_1['telegramBotService'][_0xfbae2d(0x103)](),_0x4e0bb7=await database_1[_0xfbae2d(0xe4)]['telegramUser'][_0xfbae2d(0x100)](),_0x32e32f=await database_1[_0xfbae2d(0xe4)][_0xfbae2d(0xef)]['count']({'where':{'isVerified':!![]}}),_0xe2ed38=await database_1['default'][_0xfbae2d(0xef)][_0xfbae2d(0xfa)]({'by':[_0xfbae2d(0x101)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1be73a[_0xfbae2d(0xf8)]({'success':!![],'result':{'bot':{'isActive':_0x4732d6[_0xfbae2d(0xdf)],'username':_0x4732d6[_0xfbae2d(0xf4)]},'statistics':{'totalUsers':_0x4e0bb7,'verifiedUsers':_0x32e32f,'unverifiedUsers':_0x4e0bb7-_0x32e32f,'connectedShops':_0xe2ed38['length']}}});}catch(_0x39faac){_0x4a7892(_0x39faac);}},this[_0x4423a5(0x102)]=async(_0xfc590a,_0x5da50a,_0x135e77)=>{const _0x73f9a3=_0x4423a5;try{const {page:page=0x1,limit:limit=0x14,verified:_0x462802}=_0xfc590a[_0x73f9a3(0xec)],_0x5c5da9=(Number(page)-0x1)*Number(limit),_0x4f1996={};_0x462802!==undefined&&(_0x4f1996[_0x73f9a3(0x112)]=_0x462802===_0x73f9a3(0xf3));const [_0x52c9f9,_0x531b7d]=await Promise[_0x73f9a3(0xfc)]([database_1['default'][_0x73f9a3(0xef)][_0x73f9a3(0xfd)]({'where':_0x4f1996,'skip':_0x5c5da9,'take':Number(limit),'orderBy':{'createdAt':_0x73f9a3(0xdd)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x73f9a3(0xe4)][_0x73f9a3(0xef)][_0x73f9a3(0x100)]({'where':_0x4f1996})]);_0x5da50a[_0x73f9a3(0xf8)]({'success':!![],'users':_0x52c9f9[_0x73f9a3(0x119)](_0x53b370=>({'id':_0x53b370['id'],'telegramId':_0x53b370[_0x73f9a3(0xfb)],'username':_0x53b370[_0x73f9a3(0xf4)],'firstName':_0x53b370[_0x73f9a3(0xf9)],'lastName':_0x53b370[_0x73f9a3(0x104)],'isVerified':_0x53b370[_0x73f9a3(0x112)],'shop':_0x53b370[_0x73f9a3(0xe0)],'createdAt':_0x53b370[_0x73f9a3(0xe1)],'updatedAt':_0x53b370['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x531b7d,'totalPages':Math[_0x73f9a3(0xe3)](_0x531b7d/Number(limit))}});}catch(_0x493aed){_0x135e77(_0x493aed);}},this[_0x4423a5(0x11d)]=async(_0x2ef4e5,_0x5344ce,_0xce8cc5)=>{const _0x3cd41c=_0x4423a5;try{const {message:_0xce03f7,shopId:_0x367b73}=_0x2ef4e5[_0x3cd41c(0xe5)];if(!_0xce03f7)return _0x5344ce['status'](0x190)[_0x3cd41c(0xf8)]({'success':![],'message':_0x3cd41c(0x105)});if(_0x367b73)await telegramBotService_1[_0x3cd41c(0xf6)][_0x3cd41c(0xf0)](_0x367b73,_0xce03f7,{'parse_mode':_0x3cd41c(0x115)});else{const _0x12984e=await database_1[_0x3cd41c(0xe4)][_0x3cd41c(0xef)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3a8980=[...new Set(_0x12984e[_0x3cd41c(0x119)](_0x1b1e5d=>_0x1b1e5d[_0x3cd41c(0x101)])[_0x3cd41c(0x10b)](Boolean))];for(const _0x1da0f5 of _0x3a8980){_0x1da0f5&&await telegramBotService_1[_0x3cd41c(0xf6)][_0x3cd41c(0xf0)](_0x1da0f5,_0xce03f7,{'parse_mode':'Markdown'});}}_0x5344ce[_0x3cd41c(0xf8)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x3c96ca){_0xce8cc5(_0x3c96ca);}},this[_0x4423a5(0xf2)]=async(_0x28a48a,_0x58d5c6,_0x2fc123)=>{const _0x210cbc=_0x4423a5;try{const {telegramId:_0x369f81}=_0x28a48a[_0x210cbc(0xdc)],_0x4ccdc5=await database_1[_0x210cbc(0xe4)]['telegramUser'][_0x210cbc(0x11e)]({'where':{'telegramId':_0x369f81},'include':{'shop':!![]}});if(!_0x4ccdc5)return _0x58d5c6[_0x210cbc(0x11b)](0x194)[_0x210cbc(0xf8)]({'success':![],'message':_0x210cbc(0xe8)});await database_1['default']['telegramUser'][_0x210cbc(0x10f)]({'where':{'telegramId':_0x369f81},'data':{'shopId':null,'isVerified':![]}}),_0x58d5c6[_0x210cbc(0xf8)]({'success':!![],'message':_0x210cbc(0xe7)});}catch(_0xf57ebc){_0x2fc123(_0xf57ebc);}},this[_0x4423a5(0xdb)]=async(_0x180bb6,_0x376804,_0x5edec8)=>{const _0x969173=_0x4423a5;try{const {shopId:_0x4632fe,type:type=_0x969173(0x10e),testData:_0x324c66}=_0x180bb6[_0x969173(0xe5)];if(!_0x4632fe)return _0x376804['status'](0x190)['json']({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x293a0f=await database_1['default'][_0x969173(0xe0)]['findUnique']({'where':{'id':_0x4632fe},'select':{'id':!![],'name':!![]}});if(!_0x293a0f)return _0x376804[_0x969173(0x11b)](0x194)[_0x969173(0xf8)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x969173(0x10e):const _0x2dc04f={'id':_0x969173(0x111),'amount':_0x324c66?.[_0x969173(0xea)]||0x64,'currency':_0x324c66?.[_0x969173(0xeb)]||'USD','productName':_0x324c66?.[_0x969173(0x109)]||'Test\x20Product','gateway':_0x324c66?.[_0x969173(0x117)]||_0x969173(0xf1),'createdAt':new Date(),..._0x324c66};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x4632fe,_0x2dc04f,'paid');break;case _0x969173(0x116):const _0xe8d1ff={'id':_0x969173(0xe6),'amount':_0x324c66?.[_0x969173(0xea)]||0x1f4,'method':_0x324c66?.['method']||_0x969173(0xf5),'createdAt':new Date(),..._0x324c66};await telegramBotService_1[_0x969173(0xf6)][_0x969173(0xed)](_0x4632fe,_0xe8d1ff,_0x969173(0xfe));break;case'custom':await telegramBotService_1[_0x969173(0xf6)]['sendCustomNotification'](_0x4632fe,_0x324c66?.['title']||_0x969173(0xde),_0x324c66?.[_0x969173(0xff)]||{'message':_0x969173(0x107)});break;default:return _0x376804[_0x969173(0x11b)](0x190)[_0x969173(0xf8)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x376804[_0x969173(0xf8)]({'success':!![],'message':_0x969173(0x118)+type+_0x969173(0x106)});}catch(_0x4428ef){_0x5edec8(_0x4428ef);}};}}exports[a12_0xbe3321(0xf7)]=TelegramController;