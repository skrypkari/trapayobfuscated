'use strict';const a12_0x17862a=a12_0x1db6;(function(_0x372a8d,_0x3f8a76){const _0x10c42d=a12_0x1db6,_0x865015=_0x372a8d();while(!![]){try{const _0x2001e0=-parseInt(_0x10c42d(0x15d))/0x1*(parseInt(_0x10c42d(0x17c))/0x2)+-parseInt(_0x10c42d(0x182))/0x3*(parseInt(_0x10c42d(0x156))/0x4)+-parseInt(_0x10c42d(0x167))/0x5+parseInt(_0x10c42d(0x183))/0x6+-parseInt(_0x10c42d(0x16c))/0x7*(-parseInt(_0x10c42d(0x163))/0x8)+-parseInt(_0x10c42d(0x14c))/0x9+parseInt(_0x10c42d(0x168))/0xa;if(_0x2001e0===_0x3f8a76)break;else _0x865015['push'](_0x865015['shift']());}catch(_0x578ae9){_0x865015['push'](_0x865015['shift']());}}}(a12_0x4eb5,0xdf62f));var __importDefault=this&&this[a12_0x17862a(0x178)]||function(_0x5d3241){const _0x7353ad=a12_0x17862a;return _0x5d3241&&_0x5d3241[_0x7353ad(0x16b)]?_0x5d3241:{'default':_0x5d3241};};Object[a12_0x17862a(0x154)](exports,a12_0x17862a(0x16b),{'value':!![]}),exports[a12_0x17862a(0x161)]=void 0x0;function a12_0x1db6(_0x2d5bfc,_0x5d769c){const _0x4eb56f=a12_0x4eb5();return a12_0x1db6=function(_0x1db68a,_0x306121){_0x1db68a=_0x1db68a-0x14a;let _0x40b616=_0x4eb56f[_0x1db68a];return _0x40b616;},a12_0x1db6(_0x2d5bfc,_0x5d769c);}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x17862a(0x179)));class TelegramController{constructor(){const _0x155fc8=a12_0x17862a;this['getBotStatus']=async(_0x1e248c,_0x52e1f1,_0x159585)=>{const _0x2d232d=a12_0x1db6;try{const _0x1f1bfd=telegramBotService_1['telegramBotService'][_0x2d232d(0x186)](),_0x400899=await database_1['default']['telegramUser'][_0x2d232d(0x17b)](),_0xf5b99f=await database_1[_0x2d232d(0x15b)][_0x2d232d(0x175)][_0x2d232d(0x17b)]({'where':{'isVerified':!![]}}),_0x3350a5=await database_1[_0x2d232d(0x15b)][_0x2d232d(0x175)][_0x2d232d(0x15c)]({'by':[_0x2d232d(0x14f)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x52e1f1[_0x2d232d(0x155)]({'success':!![],'result':{'bot':{'isActive':_0x1f1bfd['isActive'],'username':_0x1f1bfd[_0x2d232d(0x169)]},'statistics':{'totalUsers':_0x400899,'verifiedUsers':_0xf5b99f,'unverifiedUsers':_0x400899-_0xf5b99f,'connectedShops':_0x3350a5[_0x2d232d(0x172)]}}});}catch(_0x152857){_0x159585(_0x152857);}},this['getTelegramUsers']=async(_0x389bf5,_0x15136c,_0x5b895f)=>{const _0x98f648=a12_0x1db6;try{const {page:page=0x1,limit:limit=0x14,verified:_0x424486}=_0x389bf5['query'],_0x5297fa=(Number(page)-0x1)*Number(limit),_0x199bb1={};_0x424486!==undefined&&(_0x199bb1['isVerified']=_0x424486===_0x98f648(0x181));const [_0x48bc1a,_0x1a8fa9]=await Promise['all']([database_1['default'][_0x98f648(0x175)][_0x98f648(0x16d)]({'where':_0x199bb1,'skip':_0x5297fa,'take':Number(limit),'orderBy':{'createdAt':_0x98f648(0x152)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x98f648(0x15b)][_0x98f648(0x175)]['count']({'where':_0x199bb1})]);_0x15136c[_0x98f648(0x155)]({'success':!![],'users':_0x48bc1a[_0x98f648(0x16e)](_0x24c25c=>({'id':_0x24c25c['id'],'telegramId':_0x24c25c[_0x98f648(0x157)],'username':_0x24c25c[_0x98f648(0x169)],'firstName':_0x24c25c[_0x98f648(0x166)],'lastName':_0x24c25c[_0x98f648(0x174)],'isVerified':_0x24c25c['isVerified'],'shop':_0x24c25c[_0x98f648(0x165)],'createdAt':_0x24c25c[_0x98f648(0x17f)],'updatedAt':_0x24c25c[_0x98f648(0x176)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1a8fa9,'totalPages':Math['ceil'](_0x1a8fa9/Number(limit))}});}catch(_0x19e0ee){_0x5b895f(_0x19e0ee);}},this['sendBroadcast']=async(_0xb9c48a,_0x20be72,_0x475f50)=>{const _0x42cdef=a12_0x1db6;try{const {message:_0x2d2bd3,shopId:_0x134258}=_0xb9c48a[_0x42cdef(0x150)];if(!_0x2d2bd3)return _0x20be72[_0x42cdef(0x16f)](0x190)[_0x42cdef(0x155)]({'success':![],'message':'Message\x20is\x20required'});if(_0x134258)await telegramBotService_1[_0x42cdef(0x17a)]['sendShopNotification'](_0x134258,_0x2d2bd3,{'parse_mode':_0x42cdef(0x14e)});else{const _0x5ba6bc=await database_1[_0x42cdef(0x15b)][_0x42cdef(0x175)][_0x42cdef(0x16d)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x385983=[...new Set(_0x5ba6bc[_0x42cdef(0x16e)](_0x2218cb=>_0x2218cb[_0x42cdef(0x14f)])[_0x42cdef(0x159)](Boolean))];for(const _0x4a35c1 of _0x385983){_0x4a35c1&&await telegramBotService_1[_0x42cdef(0x17a)][_0x42cdef(0x17d)](_0x4a35c1,_0x2d2bd3,{'parse_mode':_0x42cdef(0x14e)});}}_0x20be72[_0x42cdef(0x155)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x46bb12){_0x475f50(_0x46bb12);}},this[_0x155fc8(0x185)]=async(_0x47c5be,_0x7c82a5,_0x4410f7)=>{const _0x106760=_0x155fc8;try{const {telegramId:_0x203b0c}=_0x47c5be[_0x106760(0x162)],_0xc30d19=await database_1[_0x106760(0x15b)][_0x106760(0x175)][_0x106760(0x173)]({'where':{'telegramId':_0x203b0c},'include':{'shop':!![]}});if(!_0xc30d19)return _0x7c82a5['status'](0x194)[_0x106760(0x155)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default']['telegramUser'][_0x106760(0x14a)]({'where':{'telegramId':_0x203b0c},'data':{'shopId':null,'isVerified':![]}}),_0x7c82a5[_0x106760(0x155)]({'success':!![],'message':_0x106760(0x18a)});}catch(_0x454b7a){_0x4410f7(_0x454b7a);}},this['sendTestNotification']=async(_0xa67468,_0x41990a,_0xeedd4a)=>{const _0x28b613=_0x155fc8;try{const {shopId:_0x354ee6,type:type='payment',testData:_0x9c741a}=_0xa67468[_0x28b613(0x150)];if(!_0x354ee6)return _0x41990a[_0x28b613(0x16f)](0x190)[_0x28b613(0x155)]({'success':![],'message':_0x28b613(0x180)});const _0x319114=await database_1['default'][_0x28b613(0x165)][_0x28b613(0x173)]({'where':{'id':_0x354ee6},'select':{'id':!![],'name':!![]}});if(!_0x319114)return _0x41990a[_0x28b613(0x16f)](0x194)[_0x28b613(0x155)]({'success':![],'message':_0x28b613(0x164)});switch(type){case _0x28b613(0x15e):const _0x846954={'id':'test_payment_123','amount':_0x9c741a?.[_0x28b613(0x17e)]||0x64,'currency':_0x9c741a?.[_0x28b613(0x160)]||_0x28b613(0x171),'productName':_0x9c741a?.[_0x28b613(0x15f)]||_0x28b613(0x158),'gateway':_0x9c741a?.['gateway']||'plisio','createdAt':new Date(),..._0x9c741a};await telegramBotService_1[_0x28b613(0x17a)][_0x28b613(0x14d)](_0x354ee6,_0x846954,_0x28b613(0x187));break;case _0x28b613(0x18b):const _0x231bfe={'id':_0x28b613(0x177),'amount':_0x9c741a?.['amount']||0x1f4,'method':_0x9c741a?.[_0x28b613(0x188)]||_0x28b613(0x14b),'createdAt':new Date(),..._0x9c741a};await telegramBotService_1[_0x28b613(0x17a)][_0x28b613(0x189)](_0x354ee6,_0x231bfe,_0x28b613(0x184));break;case _0x28b613(0x151):await telegramBotService_1[_0x28b613(0x17a)][_0x28b613(0x16a)](_0x354ee6,_0x9c741a?.['title']||'Test\x20Notification',_0x9c741a?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x41990a[_0x28b613(0x16f)](0x190)[_0x28b613(0x155)]({'success':![],'message':_0x28b613(0x153)});}_0x41990a['json']({'success':!![],'message':_0x28b613(0x15a)+type+_0x28b613(0x170)});}catch(_0x2d8cd6){_0xeedd4a(_0x2d8cd6);}};}}function a12_0x4eb5(){const _0x120e06=['findUnique','lastName','telegramUser','updatedAt','test_payout_123','__importDefault','../config/database','telegramBotService','count','2aqVdXM','sendShopNotification','amount','createdAt','Shop\x20ID\x20is\x20required','true','3SSabcq','2687298uUCpyl','completed','disconnectUser','getBotInfo','paid','method','sendPayoutNotification','User\x20disconnected\x20successfully','payout','update','bank_transfer','9357786DJeHHy','sendPaymentNotification','Markdown','shopId','body','custom','desc','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','defineProperty','json','1157648cdiWLr','telegramId','Test\x20Product','filter','Test\x20','default','groupBy','863609JfMtXc','payment','productName','currency','TelegramController','params','2785912WQFFDW','Shop\x20not\x20found','shop','firstName','8925575uMqMyZ','34002810XVNVui','username','sendCustomNotification','__esModule','21bTTvPG','findMany','map','status','\x20notification\x20sent\x20successfully','USD','length'];a12_0x4eb5=function(){return _0x120e06;};return a12_0x4eb5();}exports['TelegramController']=TelegramController;