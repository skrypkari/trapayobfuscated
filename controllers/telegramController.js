'use strict';function a12_0x1c23(_0x5e4a8a,_0x5f3490){const _0x1bd84f=a12_0x1bd8();return a12_0x1c23=function(_0x1c23ce,_0x3a181a){_0x1c23ce=_0x1c23ce-0xe8;let _0x8a117=_0x1bd84f[_0x1c23ce];return _0x8a117;},a12_0x1c23(_0x5e4a8a,_0x5f3490);}const a12_0x55fc0e=a12_0x1c23;(function(_0x5cdba6,_0x4ec642){const _0x348048=a12_0x1c23,_0x152f2d=_0x5cdba6();while(!![]){try{const _0x4de326=-parseInt(_0x348048(0x11d))/0x1*(parseInt(_0x348048(0x122))/0x2)+-parseInt(_0x348048(0x125))/0x3*(parseInt(_0x348048(0xff))/0x4)+parseInt(_0x348048(0xed))/0x5*(parseInt(_0x348048(0x133))/0x6)+parseInt(_0x348048(0x120))/0x7*(parseInt(_0x348048(0x131))/0x8)+parseInt(_0x348048(0x119))/0x9*(parseInt(_0x348048(0xfb))/0xa)+parseInt(_0x348048(0x114))/0xb*(-parseInt(_0x348048(0xe8))/0xc)+-parseInt(_0x348048(0x127))/0xd*(-parseInt(_0x348048(0x126))/0xe);if(_0x4de326===_0x4ec642)break;else _0x152f2d['push'](_0x152f2d['shift']());}catch(_0xbb4c1e){_0x152f2d['push'](_0x152f2d['shift']());}}}(a12_0x1bd8,0x6d39d));var __importDefault=this&&this[a12_0x55fc0e(0x110)]||function(_0x518668){return _0x518668&&_0x518668['__esModule']?_0x518668:{'default':_0x518668};};function a12_0x1bd8(){const _0x5396e9=['getBotInfo','Telegram\x20user\x20not\x20found','9wOCHsD','amount','sendBroadcast','sendCustomNotification','3613UCzhqM','groupBy','Broadcast\x20message\x20sent\x20successfully','7aaQbeV','__esModule','204huTnku','json','query','114909cGMyCT','116074sYpFDB','715LqLFGh','count','shop','title','details','Message\x20is\x20required','body','Test\x20Product','plisio','params','4645864tbIoij','shopId','864mtNDKK','Test\x20','325116nvAEfh','findUnique','username','telegramUser','payment','18690xOMbOS','status','update','isVerified','test_payout_123','currency','default','test_payment_123','findMany','filter','TelegramController','custom','\x20notification\x20sent\x20successfully','telegramId','1265470VwgYpC','telegramBotService','sendShopNotification','../config/database','84eJWQVX','../services/telegramBotService','payout','ceil','updatedAt','USD','method','length','isActive','getTelegramUsers','gateway','Shop\x20ID\x20is\x20required','sendPayoutNotification','createdAt','lastName','map','productName','__importDefault','getBotStatus','completed','Shop\x20not\x20found','33hGMRcI','bank_transfer','desc'];a12_0x1bd8=function(){return _0x5396e9;};return a12_0x1bd8();}Object['defineProperty'](exports,a12_0x55fc0e(0x121),{'value':!![]}),exports[a12_0x55fc0e(0xf7)]=void 0x0;const telegramBotService_1=require(a12_0x55fc0e(0x100)),database_1=__importDefault(require(a12_0x55fc0e(0xfe)));class TelegramController{constructor(){const _0x2690ec=a12_0x55fc0e;this[_0x2690ec(0x111)]=async(_0x48b98b,_0x3c916d,_0x252db9)=>{const _0x2ba449=_0x2690ec;try{const _0x51c2bb=telegramBotService_1[_0x2ba449(0xfc)][_0x2ba449(0x117)](),_0x4ad8a0=await database_1[_0x2ba449(0xf3)][_0x2ba449(0xeb)][_0x2ba449(0x128)](),_0x50c401=await database_1[_0x2ba449(0xf3)][_0x2ba449(0xeb)]['count']({'where':{'isVerified':!![]}}),_0x4349b5=await database_1[_0x2ba449(0xf3)]['telegramUser'][_0x2ba449(0x11e)]({'by':[_0x2ba449(0x132)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3c916d[_0x2ba449(0x123)]({'success':!![],'result':{'bot':{'isActive':_0x51c2bb[_0x2ba449(0x107)],'username':_0x51c2bb[_0x2ba449(0xea)]},'statistics':{'totalUsers':_0x4ad8a0,'verifiedUsers':_0x50c401,'unverifiedUsers':_0x4ad8a0-_0x50c401,'connectedShops':_0x4349b5[_0x2ba449(0x106)]}}});}catch(_0x228725){_0x252db9(_0x228725);}},this[_0x2690ec(0x108)]=async(_0x2a9e77,_0x53aadb,_0x4fbb2d)=>{const _0x4b99e3=_0x2690ec;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2c055a}=_0x2a9e77[_0x4b99e3(0x124)],_0x47a4bb=(Number(page)-0x1)*Number(limit),_0xd2bd6f={};_0x2c055a!==undefined&&(_0xd2bd6f[_0x4b99e3(0xf0)]=_0x2c055a==='true');const [_0x24e989,_0x1ecf50]=await Promise['all']([database_1[_0x4b99e3(0xf3)][_0x4b99e3(0xeb)][_0x4b99e3(0xf5)]({'where':_0xd2bd6f,'skip':_0x47a4bb,'take':Number(limit),'orderBy':{'createdAt':_0x4b99e3(0x116)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x4b99e3(0xeb)][_0x4b99e3(0x128)]({'where':_0xd2bd6f})]);_0x53aadb[_0x4b99e3(0x123)]({'success':!![],'users':_0x24e989['map'](_0x391ac6=>({'id':_0x391ac6['id'],'telegramId':_0x391ac6[_0x4b99e3(0xfa)],'username':_0x391ac6['username'],'firstName':_0x391ac6['firstName'],'lastName':_0x391ac6[_0x4b99e3(0x10d)],'isVerified':_0x391ac6['isVerified'],'shop':_0x391ac6[_0x4b99e3(0x129)],'createdAt':_0x391ac6[_0x4b99e3(0x10c)],'updatedAt':_0x391ac6[_0x4b99e3(0x103)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1ecf50,'totalPages':Math[_0x4b99e3(0x102)](_0x1ecf50/Number(limit))}});}catch(_0x18c89f){_0x4fbb2d(_0x18c89f);}},this[_0x2690ec(0x11b)]=async(_0x3e4e3d,_0x4d9ed6,_0x5654e1)=>{const _0x2f3b59=_0x2690ec;try{const {message:_0x39f9f3,shopId:_0x3c5b0}=_0x3e4e3d['body'];if(!_0x39f9f3)return _0x4d9ed6['status'](0x190)['json']({'success':![],'message':_0x2f3b59(0x12c)});if(_0x3c5b0)await telegramBotService_1['telegramBotService'][_0x2f3b59(0xfd)](_0x3c5b0,_0x39f9f3,{'parse_mode':'Markdown'});else{const _0x552f7d=await database_1[_0x2f3b59(0xf3)][_0x2f3b59(0xeb)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2611a2=[...new Set(_0x552f7d[_0x2f3b59(0x10e)](_0x12fd23=>_0x12fd23['shopId'])[_0x2f3b59(0xf6)](Boolean))];for(const _0x3eefa4 of _0x2611a2){_0x3eefa4&&await telegramBotService_1[_0x2f3b59(0xfc)][_0x2f3b59(0xfd)](_0x3eefa4,_0x39f9f3,{'parse_mode':'Markdown'});}}_0x4d9ed6[_0x2f3b59(0x123)]({'success':!![],'message':_0x2f3b59(0x11f)});}catch(_0x266f3e){_0x5654e1(_0x266f3e);}},this['disconnectUser']=async(_0x3081c8,_0x554696,_0x5f5030)=>{const _0x112734=_0x2690ec;try{const {telegramId:_0x4b2412}=_0x3081c8[_0x112734(0x130)],_0x1f0e76=await database_1[_0x112734(0xf3)][_0x112734(0xeb)][_0x112734(0xe9)]({'where':{'telegramId':_0x4b2412},'include':{'shop':!![]}});if(!_0x1f0e76)return _0x554696[_0x112734(0xee)](0x194)[_0x112734(0x123)]({'success':![],'message':_0x112734(0x118)});await database_1[_0x112734(0xf3)][_0x112734(0xeb)][_0x112734(0xef)]({'where':{'telegramId':_0x4b2412},'data':{'shopId':null,'isVerified':![]}}),_0x554696[_0x112734(0x123)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x3603ac){_0x5f5030(_0x3603ac);}},this['sendTestNotification']=async(_0x227484,_0x4546f1,_0x2f14c8)=>{const _0x34eef1=_0x2690ec;try{const {shopId:_0x4ef514,type:type=_0x34eef1(0xec),testData:_0xe27f17}=_0x227484[_0x34eef1(0x12d)];if(!_0x4ef514)return _0x4546f1[_0x34eef1(0xee)](0x190)[_0x34eef1(0x123)]({'success':![],'message':_0x34eef1(0x10a)});const _0x1aa5e7=await database_1[_0x34eef1(0xf3)][_0x34eef1(0x129)]['findUnique']({'where':{'id':_0x4ef514},'select':{'id':!![],'name':!![]}});if(!_0x1aa5e7)return _0x4546f1[_0x34eef1(0xee)](0x194)[_0x34eef1(0x123)]({'success':![],'message':_0x34eef1(0x113)});switch(type){case _0x34eef1(0xec):const _0x3f4e8={'id':_0x34eef1(0xf4),'amount':_0xe27f17?.[_0x34eef1(0x11a)]||0x64,'currency':_0xe27f17?.[_0x34eef1(0xf2)]||_0x34eef1(0x104),'productName':_0xe27f17?.[_0x34eef1(0x10f)]||_0x34eef1(0x12e),'gateway':_0xe27f17?.[_0x34eef1(0x109)]||_0x34eef1(0x12f),'createdAt':new Date(),..._0xe27f17};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x4ef514,_0x3f4e8,'paid');break;case _0x34eef1(0x101):const _0xe49b52={'id':_0x34eef1(0xf1),'amount':_0xe27f17?.[_0x34eef1(0x11a)]||0x1f4,'method':_0xe27f17?.[_0x34eef1(0x105)]||_0x34eef1(0x115),'createdAt':new Date(),..._0xe27f17};await telegramBotService_1[_0x34eef1(0xfc)][_0x34eef1(0x10b)](_0x4ef514,_0xe49b52,_0x34eef1(0x112));break;case _0x34eef1(0xf8):await telegramBotService_1['telegramBotService'][_0x34eef1(0x11c)](_0x4ef514,_0xe27f17?.[_0x34eef1(0x12a)]||'Test\x20Notification',_0xe27f17?.[_0x34eef1(0x12b)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x4546f1['status'](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x4546f1[_0x34eef1(0x123)]({'success':!![],'message':_0x34eef1(0x134)+type+_0x34eef1(0xf9)});}catch(_0x51ea8f){_0x2f14c8(_0x51ea8f);}};}}exports[a12_0x55fc0e(0xf7)]=TelegramController;