'use strict';function a12_0x19cd(_0x1ff9f7,_0x118e61){const _0x1a2f16=a12_0x1a2f();return a12_0x19cd=function(_0x19cde4,_0x3ef7ff){_0x19cde4=_0x19cde4-0x1b0;let _0x17fc6b=_0x1a2f16[_0x19cde4];return _0x17fc6b;},a12_0x19cd(_0x1ff9f7,_0x118e61);}const a12_0x4c574a=a12_0x19cd;(function(_0x5385fe,_0x156f90){const _0x59d622=a12_0x19cd,_0x9012d8=_0x5385fe();while(!![]){try{const _0x13bdec=-parseInt(_0x59d622(0x1dc))/0x1*(-parseInt(_0x59d622(0x1b8))/0x2)+parseInt(_0x59d622(0x1b1))/0x3+-parseInt(_0x59d622(0x1c9))/0x4*(-parseInt(_0x59d622(0x1ce))/0x5)+parseInt(_0x59d622(0x1d8))/0x6*(-parseInt(_0x59d622(0x1b5))/0x7)+-parseInt(_0x59d622(0x1c7))/0x8*(-parseInt(_0x59d622(0x1f0))/0x9)+-parseInt(_0x59d622(0x1d6))/0xa*(parseInt(_0x59d622(0x1de))/0xb)+-parseInt(_0x59d622(0x1c4))/0xc;if(_0x13bdec===_0x156f90)break;else _0x9012d8['push'](_0x9012d8['shift']());}catch(_0x24fe49){_0x9012d8['push'](_0x9012d8['shift']());}}}(a12_0x1a2f,0x3a67f));var __importDefault=this&&this[a12_0x4c574a(0x1b2)]||function(_0x5ad47f){const _0x4f5f91=a12_0x4c574a;return _0x5ad47f&&_0x5ad47f[_0x4f5f91(0x1cc)]?_0x5ad47f:{'default':_0x5ad47f};};Object[a12_0x4c574a(0x1db)](exports,a12_0x4c574a(0x1cc),{'value':!![]}),exports['TelegramController']=void 0x0;function a12_0x1a2f(){const _0x299531=['../services/telegramBotService','test_payment_123','true','isVerified','details','length','filter','paid','desc','Shop\x20ID\x20is\x20required','2310696fFZFxd','Shop\x20not\x20found','Broadcast\x20message\x20sent\x20successfully','3296HzokxU','sendShopNotification','779932itNLur','telegramUser','currency','__esModule','method','10PGNVXb','json','Test\x20Product','shop','payment','disconnectUser','amount','findUnique','49230shiznz','Message\x20is\x20required','7614psKOzF','findMany','getTelegramUsers','defineProperty','2159DEOzgl','\x20notification\x20sent\x20successfully','143IjJzDU','username','test_payout_123','shopId','Test\x20','default','update','updatedAt','productName','createdAt','getBotInfo','Test\x20Notification','sendPayoutNotification','sendBroadcast','ceil','sendCustomNotification','This\x20is\x20a\x20test\x20notification','status','720rGirwO','getBotStatus','title','TelegramController','telegramId','telegramBotService','sendTestNotification','628350FeRYOr','__importDefault','count','gateway','1337dcJsNW','custom','payout','98qSuuuW','query'];a12_0x1a2f=function(){return _0x299531;};return a12_0x1a2f();}const telegramBotService_1=require(a12_0x4c574a(0x1ba)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x4ef558=a12_0x4c574a;this[_0x4ef558(0x1f1)]=async(_0x5b98d1,_0x441f4e,_0x4f388b)=>{const _0x3d8234=_0x4ef558;try{const _0x269f04=telegramBotService_1['telegramBotService'][_0x3d8234(0x1e8)](),_0x5bcc0c=await database_1[_0x3d8234(0x1e3)][_0x3d8234(0x1ca)][_0x3d8234(0x1b3)](),_0x12fff3=await database_1[_0x3d8234(0x1e3)][_0x3d8234(0x1ca)]['count']({'where':{'isVerified':!![]}}),_0x1a9278=await database_1['default'][_0x3d8234(0x1ca)]['groupBy']({'by':[_0x3d8234(0x1e1)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x441f4e[_0x3d8234(0x1cf)]({'success':!![],'result':{'bot':{'isActive':_0x269f04['isActive'],'username':_0x269f04[_0x3d8234(0x1df)]},'statistics':{'totalUsers':_0x5bcc0c,'verifiedUsers':_0x12fff3,'unverifiedUsers':_0x5bcc0c-_0x12fff3,'connectedShops':_0x1a9278[_0x3d8234(0x1bf)]}}});}catch(_0x1e979c){_0x4f388b(_0x1e979c);}},this[_0x4ef558(0x1da)]=async(_0x499a95,_0x307b62,_0x204ef5)=>{const _0x4a3c54=_0x4ef558;try{const {page:page=0x1,limit:limit=0x14,verified:_0x133130}=_0x499a95[_0x4a3c54(0x1b9)],_0x58af0b=(Number(page)-0x1)*Number(limit),_0x45a920={};_0x133130!==undefined&&(_0x45a920[_0x4a3c54(0x1bd)]=_0x133130===_0x4a3c54(0x1bc));const [_0x657b03,_0x40a99c]=await Promise['all']([database_1[_0x4a3c54(0x1e3)][_0x4a3c54(0x1ca)][_0x4a3c54(0x1d9)]({'where':_0x45a920,'skip':_0x58af0b,'take':Number(limit),'orderBy':{'createdAt':_0x4a3c54(0x1c2)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4a3c54(0x1e3)][_0x4a3c54(0x1ca)]['count']({'where':_0x45a920})]);_0x307b62[_0x4a3c54(0x1cf)]({'success':!![],'users':_0x657b03['map'](_0x1ef889=>({'id':_0x1ef889['id'],'telegramId':_0x1ef889[_0x4a3c54(0x1f4)],'username':_0x1ef889[_0x4a3c54(0x1df)],'firstName':_0x1ef889['firstName'],'lastName':_0x1ef889['lastName'],'isVerified':_0x1ef889[_0x4a3c54(0x1bd)],'shop':_0x1ef889[_0x4a3c54(0x1d1)],'createdAt':_0x1ef889[_0x4a3c54(0x1e7)],'updatedAt':_0x1ef889[_0x4a3c54(0x1e5)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x40a99c,'totalPages':Math[_0x4a3c54(0x1ec)](_0x40a99c/Number(limit))}});}catch(_0x205610){_0x204ef5(_0x205610);}},this[_0x4ef558(0x1eb)]=async(_0x166336,_0x40fda3,_0x4c8df7)=>{const _0x31983f=_0x4ef558;try{const {message:_0x43de96,shopId:_0x1ea743}=_0x166336['body'];if(!_0x43de96)return _0x40fda3[_0x31983f(0x1ef)](0x190)[_0x31983f(0x1cf)]({'success':![],'message':_0x31983f(0x1d7)});if(_0x1ea743)await telegramBotService_1['telegramBotService'][_0x31983f(0x1c8)](_0x1ea743,_0x43de96,{'parse_mode':'Markdown'});else{const _0x92c2f7=await database_1[_0x31983f(0x1e3)][_0x31983f(0x1ca)][_0x31983f(0x1d9)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3b239d=[...new Set(_0x92c2f7['map'](_0x3811f7=>_0x3811f7[_0x31983f(0x1e1)])[_0x31983f(0x1c0)](Boolean))];for(const _0x2062a5 of _0x3b239d){_0x2062a5&&await telegramBotService_1['telegramBotService'][_0x31983f(0x1c8)](_0x2062a5,_0x43de96,{'parse_mode':'Markdown'});}}_0x40fda3[_0x31983f(0x1cf)]({'success':!![],'message':_0x31983f(0x1c6)});}catch(_0x362fb5){_0x4c8df7(_0x362fb5);}},this[_0x4ef558(0x1d3)]=async(_0x18e5cb,_0x2bd7c1,_0x58a3cf)=>{const _0x41aeef=_0x4ef558;try{const {telegramId:_0x3ea412}=_0x18e5cb['params'],_0x4bc80c=await database_1['default'][_0x41aeef(0x1ca)][_0x41aeef(0x1d5)]({'where':{'telegramId':_0x3ea412},'include':{'shop':!![]}});if(!_0x4bc80c)return _0x2bd7c1['status'](0x194)[_0x41aeef(0x1cf)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x41aeef(0x1ca)][_0x41aeef(0x1e4)]({'where':{'telegramId':_0x3ea412},'data':{'shopId':null,'isVerified':![]}}),_0x2bd7c1['json']({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x286df6){_0x58a3cf(_0x286df6);}},this[_0x4ef558(0x1b0)]=async(_0x4ebd66,_0x5be7c3,_0xe7460e)=>{const _0x122dc1=_0x4ef558;try{const {shopId:_0x2b429e,type:type=_0x122dc1(0x1d2),testData:_0x43c571}=_0x4ebd66['body'];if(!_0x2b429e)return _0x5be7c3[_0x122dc1(0x1ef)](0x190)[_0x122dc1(0x1cf)]({'success':![],'message':_0x122dc1(0x1c3)});const _0x4cd389=await database_1[_0x122dc1(0x1e3)][_0x122dc1(0x1d1)][_0x122dc1(0x1d5)]({'where':{'id':_0x2b429e},'select':{'id':!![],'name':!![]}});if(!_0x4cd389)return _0x5be7c3[_0x122dc1(0x1ef)](0x194)['json']({'success':![],'message':_0x122dc1(0x1c5)});switch(type){case _0x122dc1(0x1d2):const _0x1568bf={'id':_0x122dc1(0x1bb),'amount':_0x43c571?.[_0x122dc1(0x1d4)]||0x64,'currency':_0x43c571?.[_0x122dc1(0x1cb)]||'USD','productName':_0x43c571?.[_0x122dc1(0x1e6)]||_0x122dc1(0x1d0),'gateway':_0x43c571?.[_0x122dc1(0x1b4)]||'plisio','createdAt':new Date(),..._0x43c571};await telegramBotService_1[_0x122dc1(0x1f5)]['sendPaymentNotification'](_0x2b429e,_0x1568bf,_0x122dc1(0x1c1));break;case _0x122dc1(0x1b7):const _0xb0cdf7={'id':_0x122dc1(0x1e0),'amount':_0x43c571?.[_0x122dc1(0x1d4)]||0x1f4,'method':_0x43c571?.[_0x122dc1(0x1cd)]||'bank_transfer','createdAt':new Date(),..._0x43c571};await telegramBotService_1[_0x122dc1(0x1f5)][_0x122dc1(0x1ea)](_0x2b429e,_0xb0cdf7,'completed');break;case _0x122dc1(0x1b6):await telegramBotService_1[_0x122dc1(0x1f5)][_0x122dc1(0x1ed)](_0x2b429e,_0x43c571?.[_0x122dc1(0x1f2)]||_0x122dc1(0x1e9),_0x43c571?.[_0x122dc1(0x1be)]||{'message':_0x122dc1(0x1ee)});break;default:return _0x5be7c3['status'](0x190)[_0x122dc1(0x1cf)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x5be7c3[_0x122dc1(0x1cf)]({'success':!![],'message':_0x122dc1(0x1e2)+type+_0x122dc1(0x1dd)});}catch(_0x4449fe){_0xe7460e(_0x4449fe);}};}}exports[a12_0x4c574a(0x1f3)]=TelegramController;