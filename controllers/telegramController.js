'use strict';const a18_0x688241=a18_0x4606;function a18_0x4606(_0x8ef3d5,_0x2a0097){_0x8ef3d5=_0x8ef3d5-0xbc;const _0x5893bf=a18_0x5893();let _0x46061c=_0x5893bf[_0x8ef3d5];return _0x46061c;}(function(_0x20d182,_0x3c352a){const _0x49f6d2=a18_0x4606,_0x51868c=_0x20d182();while(!![]){try{const _0x16c20f=parseInt(_0x49f6d2(0xe1))/0x1+parseInt(_0x49f6d2(0xc0))/0x2*(-parseInt(_0x49f6d2(0xc1))/0x3)+-parseInt(_0x49f6d2(0xf1))/0x4+-parseInt(_0x49f6d2(0xed))/0x5*(-parseInt(_0x49f6d2(0xea))/0x6)+parseInt(_0x49f6d2(0xf5))/0x7+-parseInt(_0x49f6d2(0x104))/0x8+-parseInt(_0x49f6d2(0xe4))/0x9*(parseInt(_0x49f6d2(0xe3))/0xa);if(_0x16c20f===_0x3c352a)break;else _0x51868c['push'](_0x51868c['shift']());}catch(_0x1d14a2){_0x51868c['push'](_0x51868c['shift']());}}}(a18_0x5893,0x1f087));var __importDefault=this&&this['__importDefault']||function(_0x2c83d8){return _0x2c83d8&&_0x2c83d8['__esModule']?_0x2c83d8:{'default':_0x2c83d8};};function a18_0x5893(){const _0x384033=['currency','shopId','count','title','474AkMgjl','telegramBotService','all','15610zQyKod','query','isActive','test_payment_123','189620aTlBMK','updatedAt','desc','length','1475355nZqJPN','body','json','This\x20is\x20a\x20test\x20notification','Message\x20is\x20required','__esModule','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','update','TRC20','sendPayoutNotification','createdAt','defineProperty','sendCustomNotification','gateway','telegramId','2023600VgaeiT','../config/database','sendShopNotification','TelegramController','Shop\x20not\x20found','72866yxDyrW','18IvmOEB','User\x20disconnected\x20successfully','lastName','shop','Broadcast\x20message\x20sent\x20successfully','username','USD','disconnectUser','Тестовый\x20период','findMany','sendTestNotification','txid','telegramUser','amount','Test\x20Notification','getBotInfo','Test\x20','true','Test\x20Product','findUnique','\x20notification\x20sent\x20successfully','isVerified','filter','Markdown','default','wallet','status','Shop\x20ID\x20is\x20required','paid','getTelegramUsers','sendBroadcast','payment','198084poraIb','params','10470lZVnCc','81ubjMeZ','plisio'];a18_0x5893=function(){return _0x384033;};return a18_0x5893();}Object[a18_0x688241(0x100)](exports,a18_0x688241(0xfa),{'value':!![]}),exports[a18_0x688241(0xbe)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a18_0x688241(0xbc)));class TelegramController{constructor(){const _0xa89cff=a18_0x688241;this['getBotStatus']=async(_0x174e6e,_0x100787,_0x4c1c22)=>{const _0x319058=a18_0x4606;try{const _0xb4c062=telegramBotService_1[_0x319058(0xeb)][_0x319058(0xd0)](),_0x241cba=await database_1[_0x319058(0xd9)]['telegramUser'][_0x319058(0xe8)](),_0x40f1cb=await database_1[_0x319058(0xd9)][_0x319058(0xcd)][_0x319058(0xe8)]({'where':{'isVerified':!![]}}),_0x392074=await database_1['default'][_0x319058(0xcd)]['groupBy']({'by':[_0x319058(0xe7)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x100787[_0x319058(0xf7)]({'success':!![],'result':{'bot':{'isActive':_0xb4c062[_0x319058(0xef)],'username':_0xb4c062[_0x319058(0xc6)]},'statistics':{'totalUsers':_0x241cba,'verifiedUsers':_0x40f1cb,'unverifiedUsers':_0x241cba-_0x40f1cb,'connectedShops':_0x392074[_0x319058(0xf4)]}}});}catch(_0x2d1ed1){_0x4c1c22(_0x2d1ed1);}},this[_0xa89cff(0xde)]=async(_0x4f817e,_0x56efb7,_0x37794c)=>{const _0x2aaa29=_0xa89cff;try{const {page:page=0x1,limit:limit=0x14,verified:_0x912404}=_0x4f817e[_0x2aaa29(0xee)],_0x2a3e88=(Number(page)-0x1)*Number(limit),_0x34b985={};_0x912404!==undefined&&(_0x34b985[_0x2aaa29(0xd6)]=_0x912404===_0x2aaa29(0xd2));const [_0x2fb9b6,_0x57052c]=await Promise[_0x2aaa29(0xec)]([database_1[_0x2aaa29(0xd9)][_0x2aaa29(0xcd)][_0x2aaa29(0xca)]({'where':_0x34b985,'skip':_0x2a3e88,'take':Number(limit),'orderBy':{'createdAt':_0x2aaa29(0xf3)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2aaa29(0xd9)]['telegramUser'][_0x2aaa29(0xe8)]({'where':_0x34b985})]);_0x56efb7[_0x2aaa29(0xf7)]({'success':!![],'users':_0x2fb9b6['map'](_0x201947=>({'id':_0x201947['id'],'telegramId':_0x201947[_0x2aaa29(0x103)],'username':_0x201947[_0x2aaa29(0xc6)],'firstName':_0x201947['firstName'],'lastName':_0x201947[_0x2aaa29(0xc3)],'isVerified':_0x201947[_0x2aaa29(0xd6)],'shop':_0x201947['shop'],'createdAt':_0x201947[_0x2aaa29(0xff)],'updatedAt':_0x201947[_0x2aaa29(0xf2)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x57052c,'totalPages':Math['ceil'](_0x57052c/Number(limit))}});}catch(_0x39a842){_0x37794c(_0x39a842);}},this[_0xa89cff(0xdf)]=async(_0x10d29b,_0x3dce6f,_0x156a89)=>{const _0x1bf6b5=_0xa89cff;try{const {message:_0x48259c,shopId:_0x717ded}=_0x10d29b[_0x1bf6b5(0xf6)];if(!_0x48259c)return _0x3dce6f['status'](0x190)[_0x1bf6b5(0xf7)]({'success':![],'message':_0x1bf6b5(0xf9)});if(_0x717ded)await telegramBotService_1[_0x1bf6b5(0xeb)][_0x1bf6b5(0xbd)](_0x717ded,_0x48259c,{'parse_mode':_0x1bf6b5(0xd8)});else{const _0x3a8cbe=await database_1[_0x1bf6b5(0xd9)][_0x1bf6b5(0xcd)][_0x1bf6b5(0xca)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x499d0b=[...new Set(_0x3a8cbe['map'](_0xf9cdbf=>_0xf9cdbf[_0x1bf6b5(0xe7)])[_0x1bf6b5(0xd7)](Boolean))];for(const _0x35143c of _0x499d0b){_0x35143c&&await telegramBotService_1[_0x1bf6b5(0xeb)][_0x1bf6b5(0xbd)](_0x35143c,_0x48259c,{'parse_mode':_0x1bf6b5(0xd8)});}}_0x3dce6f[_0x1bf6b5(0xf7)]({'success':!![],'message':_0x1bf6b5(0xc5)});}catch(_0x17f937){_0x156a89(_0x17f937);}},this[_0xa89cff(0xc8)]=async(_0x3e7e52,_0x5433c8,_0x54a553)=>{const _0x3535aa=_0xa89cff;try{const {telegramId:_0xd00450}=_0x3e7e52[_0x3535aa(0xe2)],_0x2706be=await database_1[_0x3535aa(0xd9)]['telegramUser'][_0x3535aa(0xd4)]({'where':{'telegramId':_0xd00450},'include':{'shop':!![]}});if(!_0x2706be)return _0x5433c8[_0x3535aa(0xdb)](0x194)[_0x3535aa(0xf7)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x3535aa(0xd9)][_0x3535aa(0xcd)][_0x3535aa(0xfc)]({'where':{'telegramId':_0xd00450},'data':{'shopId':null,'isVerified':![]}}),_0x5433c8['json']({'success':!![],'message':_0x3535aa(0xc2)});}catch(_0x42456d){_0x54a553(_0x42456d);}},this[_0xa89cff(0xcb)]=async(_0x19ce58,_0x2421e0,_0x35720a)=>{const _0x2022b8=_0xa89cff;try{const {shopId:_0x3523ed,type:type='payment',testData:_0x1f5c05}=_0x19ce58[_0x2022b8(0xf6)];if(!_0x3523ed)return _0x2421e0[_0x2022b8(0xdb)](0x190)[_0x2022b8(0xf7)]({'success':![],'message':_0x2022b8(0xdc)});const _0x582d47=await database_1[_0x2022b8(0xd9)][_0x2022b8(0xc4)][_0x2022b8(0xd4)]({'where':{'id':_0x3523ed},'select':{'id':!![],'name':!![]}});if(!_0x582d47)return _0x2421e0[_0x2022b8(0xdb)](0x194)[_0x2022b8(0xf7)]({'success':![],'message':_0x2022b8(0xbf)});switch(type){case _0x2022b8(0xe0):const _0xcd6e2d={'id':_0x2022b8(0xf0),'amount':_0x1f5c05?.[_0x2022b8(0xce)]||0x64,'currency':_0x1f5c05?.[_0x2022b8(0xe6)]||_0x2022b8(0xc7),'productName':_0x1f5c05?.['productName']||_0x2022b8(0xd3),'gateway':_0x1f5c05?.[_0x2022b8(0x102)]||_0x2022b8(0xe5),'createdAt':new Date(),..._0x1f5c05};await telegramBotService_1[_0x2022b8(0xeb)]['sendPaymentNotification'](_0x3523ed,_0xcd6e2d,_0x2022b8(0xdd));break;case'payout':const _0x395e5e={'id':'test_payout_123','amount':_0x1f5c05?.['amount']||0x1f4,'network':_0x1f5c05?.['network']||_0x2022b8(0xfd),'wallet':_0x1f5c05?.[_0x2022b8(0xda)]||_0x2022b8(0xfb),'period':_0x2022b8(0xc9),'createdAt':new Date(),'txid':_0x1f5c05?.[_0x2022b8(0xcc)]||null,..._0x1f5c05};await telegramBotService_1['telegramBotService'][_0x2022b8(0xfe)](_0x3523ed,_0x395e5e);break;case'custom':await telegramBotService_1['telegramBotService'][_0x2022b8(0x101)](_0x3523ed,_0x1f5c05?.[_0x2022b8(0xe9)]||_0x2022b8(0xcf),_0x1f5c05?.['details']||{'message':_0x2022b8(0xf8)});break;default:return _0x2421e0[_0x2022b8(0xdb)](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x2421e0[_0x2022b8(0xf7)]({'success':!![],'message':_0x2022b8(0xd1)+type+_0x2022b8(0xd5)});}catch(_0xffcb96){_0x35720a(_0xffcb96);}};}}exports[a18_0x688241(0xbe)]=TelegramController;