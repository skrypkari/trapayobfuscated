'use strict';const a12_0x430fbf=a12_0x3e3e;(function(_0x2ea207,_0x220160){const _0x1f205b=a12_0x3e3e,_0x4a93f1=_0x2ea207();while(!![]){try{const _0x3b9322=-parseInt(_0x1f205b(0x1cb))/0x1+parseInt(_0x1f205b(0x1c5))/0x2*(-parseInt(_0x1f205b(0x1d9))/0x3)+-parseInt(_0x1f205b(0x1d6))/0x4+-parseInt(_0x1f205b(0x1da))/0x5*(-parseInt(_0x1f205b(0x1a5))/0x6)+parseInt(_0x1f205b(0x1b3))/0x7*(parseInt(_0x1f205b(0x1b9))/0x8)+-parseInt(_0x1f205b(0x199))/0x9*(parseInt(_0x1f205b(0x1bb))/0xa)+parseInt(_0x1f205b(0x1bd))/0xb;if(_0x3b9322===_0x220160)break;else _0x4a93f1['push'](_0x4a93f1['shift']());}catch(_0x1e216e){_0x4a93f1['push'](_0x4a93f1['shift']());}}}(a12_0x440f,0xc68a4));function a12_0x440f(){const _0x56e2c7=['4106968zkRJrP','Test\x20Product','payout','353151ygetsG','2725035jZBCTZ','status','Test\x20Notification','sendPaymentNotification','disconnectUser','Test\x20','5402097ysjwch','gateway','sendTestNotification','productName','isActive','payment','telegramBotService','updatedAt','Markdown','Shop\x20ID\x20is\x20required','sendShopNotification','This\x20is\x20a\x20test\x20notification','6utTHqf','details','createdAt','method','defineProperty','USD','groupBy','all','findUnique','amount','Shop\x20not\x20found','findMany','count','body','7wbjqdO','../config/database','User\x20disconnected\x20successfully','\x20notification\x20sent\x20successfully','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','__esModule','3602216EztMQp','lastName','10iERlar','getBotInfo','40150341HlhvAg','Telegram\x20user\x20not\x20found','getTelegramUsers','shopId','paid','filter','firstName','update','12TbVXaJ','json','currency','__importDefault','sendPayoutNotification','sendCustomNotification','1498818xdTyAR','test_payout_123','telegramUser','map','length','isVerified','shop','TelegramController','default','sendBroadcast','ceil'];a12_0x440f=function(){return _0x56e2c7;};return a12_0x440f();}function a12_0x3e3e(_0x541e00,_0x48328a){const _0x440fec=a12_0x440f();return a12_0x3e3e=function(_0x3e3e6b,_0x5321c7){_0x3e3e6b=_0x3e3e6b-0x199;let _0x27cf5c=_0x440fec[_0x3e3e6b];return _0x27cf5c;},a12_0x3e3e(_0x541e00,_0x48328a);}var __importDefault=this&&this[a12_0x430fbf(0x1c8)]||function(_0x48e8e6){const _0x56bcc9=a12_0x430fbf;return _0x48e8e6&&_0x48e8e6[_0x56bcc9(0x1b8)]?_0x48e8e6:{'default':_0x48e8e6};};Object[a12_0x430fbf(0x1a9)](exports,a12_0x430fbf(0x1b8),{'value':!![]}),exports[a12_0x430fbf(0x1d2)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x430fbf(0x1b4)));class TelegramController{constructor(){const _0x3d4d58=a12_0x430fbf;this['getBotStatus']=async(_0xe3531c,_0x3262ea,_0x3f8618)=>{const _0x251e3c=a12_0x3e3e;try{const _0x908eed=telegramBotService_1[_0x251e3c(0x19f)][_0x251e3c(0x1bc)](),_0x39cd74=await database_1[_0x251e3c(0x1d3)][_0x251e3c(0x1cd)][_0x251e3c(0x1b1)](),_0x179bc7=await database_1['default'][_0x251e3c(0x1cd)][_0x251e3c(0x1b1)]({'where':{'isVerified':!![]}}),_0x4a90ee=await database_1[_0x251e3c(0x1d3)]['telegramUser'][_0x251e3c(0x1ab)]({'by':[_0x251e3c(0x1c0)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3262ea[_0x251e3c(0x1c6)]({'success':!![],'result':{'bot':{'isActive':_0x908eed[_0x251e3c(0x19d)],'username':_0x908eed['username']},'statistics':{'totalUsers':_0x39cd74,'verifiedUsers':_0x179bc7,'unverifiedUsers':_0x39cd74-_0x179bc7,'connectedShops':_0x4a90ee[_0x251e3c(0x1cf)]}}});}catch(_0x466e08){_0x3f8618(_0x466e08);}},this[_0x3d4d58(0x1bf)]=async(_0x212489,_0xdbd413,_0x67ed40)=>{const _0x30db44=_0x3d4d58;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1ae831}=_0x212489['query'],_0xf465cd=(Number(page)-0x1)*Number(limit),_0x4b4632={};_0x1ae831!==undefined&&(_0x4b4632[_0x30db44(0x1d0)]=_0x1ae831==='true');const [_0x9ffee2,_0xbcac8e]=await Promise[_0x30db44(0x1ac)]([database_1[_0x30db44(0x1d3)]['telegramUser'][_0x30db44(0x1b0)]({'where':_0x4b4632,'skip':_0xf465cd,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x30db44(0x1cd)]['count']({'where':_0x4b4632})]);_0xdbd413[_0x30db44(0x1c6)]({'success':!![],'users':_0x9ffee2['map'](_0x2e3cdf=>({'id':_0x2e3cdf['id'],'telegramId':_0x2e3cdf['telegramId'],'username':_0x2e3cdf['username'],'firstName':_0x2e3cdf[_0x30db44(0x1c3)],'lastName':_0x2e3cdf[_0x30db44(0x1ba)],'isVerified':_0x2e3cdf['isVerified'],'shop':_0x2e3cdf[_0x30db44(0x1d1)],'createdAt':_0x2e3cdf[_0x30db44(0x1a7)],'updatedAt':_0x2e3cdf[_0x30db44(0x1a0)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xbcac8e,'totalPages':Math[_0x30db44(0x1d5)](_0xbcac8e/Number(limit))}});}catch(_0x2e9d99){_0x67ed40(_0x2e9d99);}},this[_0x3d4d58(0x1d4)]=async(_0x2c0d52,_0x578b42,_0x50d3d7)=>{const _0xdfaf57=_0x3d4d58;try{const {message:_0x29aff7,shopId:_0x434e8b}=_0x2c0d52[_0xdfaf57(0x1b2)];if(!_0x29aff7)return _0x578b42['status'](0x190)['json']({'success':![],'message':'Message\x20is\x20required'});if(_0x434e8b)await telegramBotService_1[_0xdfaf57(0x19f)][_0xdfaf57(0x1a3)](_0x434e8b,_0x29aff7,{'parse_mode':_0xdfaf57(0x1a1)});else{const _0x35393d=await database_1[_0xdfaf57(0x1d3)][_0xdfaf57(0x1cd)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2d4efa=[...new Set(_0x35393d[_0xdfaf57(0x1ce)](_0xb43999=>_0xb43999['shopId'])[_0xdfaf57(0x1c2)](Boolean))];for(const _0x3f156b of _0x2d4efa){_0x3f156b&&await telegramBotService_1[_0xdfaf57(0x19f)][_0xdfaf57(0x1a3)](_0x3f156b,_0x29aff7,{'parse_mode':'Markdown'});}}_0x578b42['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x4ae11e){_0x50d3d7(_0x4ae11e);}},this[_0x3d4d58(0x1de)]=async(_0x1142f8,_0x1aa9d3,_0x4e4e60)=>{const _0x37944d=_0x3d4d58;try{const {telegramId:_0x3f76e7}=_0x1142f8['params'],_0xffc623=await database_1[_0x37944d(0x1d3)][_0x37944d(0x1cd)][_0x37944d(0x1ad)]({'where':{'telegramId':_0x3f76e7},'include':{'shop':!![]}});if(!_0xffc623)return _0x1aa9d3[_0x37944d(0x1db)](0x194)['json']({'success':![],'message':_0x37944d(0x1be)});await database_1[_0x37944d(0x1d3)][_0x37944d(0x1cd)][_0x37944d(0x1c4)]({'where':{'telegramId':_0x3f76e7},'data':{'shopId':null,'isVerified':![]}}),_0x1aa9d3[_0x37944d(0x1c6)]({'success':!![],'message':_0x37944d(0x1b5)});}catch(_0x555b83){_0x4e4e60(_0x555b83);}},this[_0x3d4d58(0x19b)]=async(_0x974687,_0x5500c2,_0x32f17f)=>{const _0x2b5114=_0x3d4d58;try{const {shopId:_0x439b74,type:type=_0x2b5114(0x19e),testData:_0x323c9a}=_0x974687['body'];if(!_0x439b74)return _0x5500c2[_0x2b5114(0x1db)](0x190)[_0x2b5114(0x1c6)]({'success':![],'message':_0x2b5114(0x1a2)});const _0x4d8a1f=await database_1[_0x2b5114(0x1d3)][_0x2b5114(0x1d1)][_0x2b5114(0x1ad)]({'where':{'id':_0x439b74},'select':{'id':!![],'name':!![]}});if(!_0x4d8a1f)return _0x5500c2[_0x2b5114(0x1db)](0x194)[_0x2b5114(0x1c6)]({'success':![],'message':_0x2b5114(0x1af)});switch(type){case _0x2b5114(0x19e):const _0xee5c2f={'id':'test_payment_123','amount':_0x323c9a?.['amount']||0x64,'currency':_0x323c9a?.[_0x2b5114(0x1c7)]||_0x2b5114(0x1aa),'productName':_0x323c9a?.[_0x2b5114(0x19c)]||_0x2b5114(0x1d7),'gateway':_0x323c9a?.[_0x2b5114(0x19a)]||'plisio','createdAt':new Date(),..._0x323c9a};await telegramBotService_1['telegramBotService'][_0x2b5114(0x1dd)](_0x439b74,_0xee5c2f,_0x2b5114(0x1c1));break;case _0x2b5114(0x1d8):const _0x4383ea={'id':_0x2b5114(0x1cc),'amount':_0x323c9a?.[_0x2b5114(0x1ae)]||0x1f4,'method':_0x323c9a?.[_0x2b5114(0x1a8)]||'bank_transfer','createdAt':new Date(),..._0x323c9a};await telegramBotService_1[_0x2b5114(0x19f)][_0x2b5114(0x1c9)](_0x439b74,_0x4383ea,'completed');break;case'custom':await telegramBotService_1[_0x2b5114(0x19f)][_0x2b5114(0x1ca)](_0x439b74,_0x323c9a?.['title']||_0x2b5114(0x1dc),_0x323c9a?.[_0x2b5114(0x1a6)]||{'message':_0x2b5114(0x1a4)});break;default:return _0x5500c2['status'](0x190)[_0x2b5114(0x1c6)]({'success':![],'message':_0x2b5114(0x1b7)});}_0x5500c2[_0x2b5114(0x1c6)]({'success':!![],'message':_0x2b5114(0x1df)+type+_0x2b5114(0x1b6)});}catch(_0x163591){_0x32f17f(_0x163591);}};}}exports['TelegramController']=TelegramController;