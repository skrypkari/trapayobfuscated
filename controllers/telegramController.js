'use strict';const a12_0x5ad1d9=a12_0x1979;(function(_0x56e763,_0x4db882){const _0x4a887e=a12_0x1979,_0x3712e8=_0x56e763();while(!![]){try{const _0x4c33fc=-parseInt(_0x4a887e(0x190))/0x1*(parseInt(_0x4a887e(0x1a6))/0x2)+-parseInt(_0x4a887e(0x1a9))/0x3*(parseInt(_0x4a887e(0x177))/0x4)+parseInt(_0x4a887e(0x1a4))/0x5*(parseInt(_0x4a887e(0x19d))/0x6)+-parseInt(_0x4a887e(0x1a8))/0x7*(parseInt(_0x4a887e(0x1b3))/0x8)+parseInt(_0x4a887e(0x1ad))/0x9*(parseInt(_0x4a887e(0x174))/0xa)+parseInt(_0x4a887e(0x178))/0xb*(-parseInt(_0x4a887e(0x17a))/0xc)+-parseInt(_0x4a887e(0x1b0))/0xd*(-parseInt(_0x4a887e(0x180))/0xe);if(_0x4c33fc===_0x4db882)break;else _0x3712e8['push'](_0x3712e8['shift']());}catch(_0x3ae436){_0x3712e8['push'](_0x3712e8['shift']());}}}(a12_0x2b03,0x6e82f));function a12_0x2b03(){const _0x43f304=['currency','telegramBotService','shop','1470WDFEiN','Test\x20Product','findUnique','4VkIZMH','14146iuJRdg','__importDefault','8112OEPgra','TelegramController','firstName','test_payout_123','Test\x20Notification','query','14sjviRB','bank_transfer','sendCustomNotification','body','map','custom','true','findMany','filter','Shop\x20ID\x20is\x20required','__esModule','telegramId','createdAt','method','default','telegramUser','5HZRyqb','disconnectUser','plisio','paid','Markdown','sendBroadcast','desc','isVerified','sendShopNotification','This\x20is\x20a\x20test\x20notification','isActive','username','sendPaymentNotification','2603982QAiHIz','Test\x20','title','Shop\x20not\x20found','update','productName','sendPayoutNotification','5jPanBD','getTelegramUsers','205822ABxjPE','json','1165787nwTMZS','1916223nrgtCD','test_payment_123','ceil','../config/database','49131cagCVO','count','amount','18269654tzlQyb','status','length','8nzfQuU','Broadcast\x20message\x20sent\x20successfully','completed','../services/telegramBotService','Message\x20is\x20required','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','getBotStatus','all','User\x20disconnected\x20successfully','getBotInfo'];a12_0x2b03=function(){return _0x43f304;};return a12_0x2b03();}var __importDefault=this&&this[a12_0x5ad1d9(0x179)]||function(_0x51226c){const _0x2c2541=a12_0x5ad1d9;return _0x51226c&&_0x51226c[_0x2c2541(0x18a)]?_0x51226c:{'default':_0x51226c};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a12_0x5ad1d9(0x17b)]=void 0x0;function a12_0x1979(_0x4ab3a1,_0x224fa7){const _0x2b036e=a12_0x2b03();return a12_0x1979=function(_0x197976,_0x1e895a){_0x197976=_0x197976-0x16d;let _0x2a13ae=_0x2b036e[_0x197976];return _0x2a13ae;},a12_0x1979(_0x4ab3a1,_0x224fa7);}const telegramBotService_1=require(a12_0x5ad1d9(0x1b6)),database_1=__importDefault(require(a12_0x5ad1d9(0x1ac)));class TelegramController{constructor(){const _0xe68c9a=a12_0x5ad1d9;this[_0xe68c9a(0x16d)]=async(_0x4f32bb,_0x59b5cc,_0x45f58f)=>{const _0x401f01=_0xe68c9a;try{const _0x56517d=telegramBotService_1[_0x401f01(0x172)][_0x401f01(0x170)](),_0x3cf139=await database_1[_0x401f01(0x18e)][_0x401f01(0x18f)][_0x401f01(0x1ae)](),_0x395b30=await database_1[_0x401f01(0x18e)][_0x401f01(0x18f)][_0x401f01(0x1ae)]({'where':{'isVerified':!![]}}),_0x117482=await database_1[_0x401f01(0x18e)][_0x401f01(0x18f)]['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x59b5cc['json']({'success':!![],'result':{'bot':{'isActive':_0x56517d[_0x401f01(0x19a)],'username':_0x56517d[_0x401f01(0x19b)]},'statistics':{'totalUsers':_0x3cf139,'verifiedUsers':_0x395b30,'unverifiedUsers':_0x3cf139-_0x395b30,'connectedShops':_0x117482[_0x401f01(0x1b2)]}}});}catch(_0x451475){_0x45f58f(_0x451475);}},this[_0xe68c9a(0x1a5)]=async(_0x168876,_0x4fd012,_0x465491)=>{const _0x1b3a88=_0xe68c9a;try{const {page:page=0x1,limit:limit=0x14,verified:_0x48851f}=_0x168876[_0x1b3a88(0x17f)],_0xbe0d2e=(Number(page)-0x1)*Number(limit),_0x5d94d9={};_0x48851f!==undefined&&(_0x5d94d9[_0x1b3a88(0x197)]=_0x48851f===_0x1b3a88(0x186));const [_0x105125,_0x27b687]=await Promise[_0x1b3a88(0x16e)]([database_1[_0x1b3a88(0x18e)][_0x1b3a88(0x18f)][_0x1b3a88(0x187)]({'where':_0x5d94d9,'skip':_0xbe0d2e,'take':Number(limit),'orderBy':{'createdAt':_0x1b3a88(0x196)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1b3a88(0x18e)][_0x1b3a88(0x18f)]['count']({'where':_0x5d94d9})]);_0x4fd012['json']({'success':!![],'users':_0x105125[_0x1b3a88(0x184)](_0x843589=>({'id':_0x843589['id'],'telegramId':_0x843589[_0x1b3a88(0x18b)],'username':_0x843589[_0x1b3a88(0x19b)],'firstName':_0x843589[_0x1b3a88(0x17c)],'lastName':_0x843589['lastName'],'isVerified':_0x843589[_0x1b3a88(0x197)],'shop':_0x843589[_0x1b3a88(0x173)],'createdAt':_0x843589[_0x1b3a88(0x18c)],'updatedAt':_0x843589['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x27b687,'totalPages':Math[_0x1b3a88(0x1ab)](_0x27b687/Number(limit))}});}catch(_0x4e4076){_0x465491(_0x4e4076);}},this[_0xe68c9a(0x195)]=async(_0x3ab6ac,_0x22d971,_0x16c18e)=>{const _0x188c1c=_0xe68c9a;try{const {message:_0x3725fd,shopId:_0x414729}=_0x3ab6ac[_0x188c1c(0x183)];if(!_0x3725fd)return _0x22d971[_0x188c1c(0x1b1)](0x190)[_0x188c1c(0x1a7)]({'success':![],'message':_0x188c1c(0x1b7)});if(_0x414729)await telegramBotService_1[_0x188c1c(0x172)][_0x188c1c(0x198)](_0x414729,_0x3725fd,{'parse_mode':'Markdown'});else{const _0x46e8c6=await database_1[_0x188c1c(0x18e)][_0x188c1c(0x18f)][_0x188c1c(0x187)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x208436=[...new Set(_0x46e8c6[_0x188c1c(0x184)](_0x88d1a8=>_0x88d1a8['shopId'])[_0x188c1c(0x188)](Boolean))];for(const _0x1a5de6 of _0x208436){_0x1a5de6&&await telegramBotService_1['telegramBotService'][_0x188c1c(0x198)](_0x1a5de6,_0x3725fd,{'parse_mode':_0x188c1c(0x194)});}}_0x22d971[_0x188c1c(0x1a7)]({'success':!![],'message':_0x188c1c(0x1b4)});}catch(_0x44507a){_0x16c18e(_0x44507a);}},this[_0xe68c9a(0x191)]=async(_0x1ecd96,_0x337d7b,_0x2511c6)=>{const _0x5d1988=_0xe68c9a;try{const {telegramId:_0x4c058c}=_0x1ecd96['params'],_0x5c07f6=await database_1['default'][_0x5d1988(0x18f)][_0x5d1988(0x176)]({'where':{'telegramId':_0x4c058c},'include':{'shop':!![]}});if(!_0x5c07f6)return _0x337d7b[_0x5d1988(0x1b1)](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x5d1988(0x18e)][_0x5d1988(0x18f)][_0x5d1988(0x1a1)]({'where':{'telegramId':_0x4c058c},'data':{'shopId':null,'isVerified':![]}}),_0x337d7b[_0x5d1988(0x1a7)]({'success':!![],'message':_0x5d1988(0x16f)});}catch(_0x518e94){_0x2511c6(_0x518e94);}},this['sendTestNotification']=async(_0x156001,_0x51da31,_0x2d9e5d)=>{const _0x4bfb26=_0xe68c9a;try{const {shopId:_0x294ffd,type:type='payment',testData:_0x4000ad}=_0x156001['body'];if(!_0x294ffd)return _0x51da31['status'](0x190)[_0x4bfb26(0x1a7)]({'success':![],'message':_0x4bfb26(0x189)});const _0x703758=await database_1[_0x4bfb26(0x18e)][_0x4bfb26(0x173)]['findUnique']({'where':{'id':_0x294ffd},'select':{'id':!![],'name':!![]}});if(!_0x703758)return _0x51da31[_0x4bfb26(0x1b1)](0x194)[_0x4bfb26(0x1a7)]({'success':![],'message':_0x4bfb26(0x1a0)});switch(type){case'payment':const _0x47f860={'id':_0x4bfb26(0x1aa),'amount':_0x4000ad?.[_0x4bfb26(0x1af)]||0x64,'currency':_0x4000ad?.[_0x4bfb26(0x171)]||'USD','productName':_0x4000ad?.[_0x4bfb26(0x1a2)]||_0x4bfb26(0x175),'gateway':_0x4000ad?.['gateway']||_0x4bfb26(0x192),'createdAt':new Date(),..._0x4000ad};await telegramBotService_1[_0x4bfb26(0x172)][_0x4bfb26(0x19c)](_0x294ffd,_0x47f860,_0x4bfb26(0x193));break;case'payout':const _0x32fce3={'id':_0x4bfb26(0x17d),'amount':_0x4000ad?.[_0x4bfb26(0x1af)]||0x1f4,'method':_0x4000ad?.[_0x4bfb26(0x18d)]||_0x4bfb26(0x181),'createdAt':new Date(),..._0x4000ad};await telegramBotService_1[_0x4bfb26(0x172)][_0x4bfb26(0x1a3)](_0x294ffd,_0x32fce3,_0x4bfb26(0x1b5));break;case _0x4bfb26(0x185):await telegramBotService_1[_0x4bfb26(0x172)][_0x4bfb26(0x182)](_0x294ffd,_0x4000ad?.[_0x4bfb26(0x19f)]||_0x4bfb26(0x17e),_0x4000ad?.['details']||{'message':_0x4bfb26(0x199)});break;default:return _0x51da31[_0x4bfb26(0x1b1)](0x190)[_0x4bfb26(0x1a7)]({'success':![],'message':_0x4bfb26(0x1b8)});}_0x51da31[_0x4bfb26(0x1a7)]({'success':!![],'message':_0x4bfb26(0x19e)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x49716a){_0x2d9e5d(_0x49716a);}};}}exports[a12_0x5ad1d9(0x17b)]=TelegramController;