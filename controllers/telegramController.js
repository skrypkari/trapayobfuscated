'use strict';const a12_0xe3e956=a12_0x4b5f;(function(_0x2e3e9e,_0x20794d){const _0x2f5c87=a12_0x4b5f,_0x2609d6=_0x2e3e9e();while(!![]){try{const _0x59090e=parseInt(_0x2f5c87(0x1c2))/0x1+parseInt(_0x2f5c87(0x1f2))/0x2*(parseInt(_0x2f5c87(0x1df))/0x3)+-parseInt(_0x2f5c87(0x1b8))/0x4+parseInt(_0x2f5c87(0x1d3))/0x5*(-parseInt(_0x2f5c87(0x1b6))/0x6)+parseInt(_0x2f5c87(0x1bd))/0x7+parseInt(_0x2f5c87(0x1ef))/0x8+parseInt(_0x2f5c87(0x1be))/0x9;if(_0x59090e===_0x20794d)break;else _0x2609d6['push'](_0x2609d6['shift']());}catch(_0x305e21){_0x2609d6['push'](_0x2609d6['shift']());}}}(a12_0x1298,0xa2196));function a12_0x1298(){const _0xb16f8a=['sendCustomNotification','lastName','currency','sendShopNotification','details','2591454HxIRVg','true','4265276ljwkIN','USD','findMany','completed','findUnique','6893915qLKTEW','426510HPHunG','query','custom','payout','275080MZjrSY','Test\x20Notification','../services/telegramBotService','defineProperty','bank_transfer','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','filter','\x20notification\x20sent\x20successfully','groupBy','telegramUser','Message\x20is\x20required','Markdown','isVerified','status','count','Test\x20','username','15HOBgrT','params','TelegramController','disconnectUser','amount','Shop\x20ID\x20is\x20required','title','shop','isActive','Shop\x20not\x20found','shopId','getBotStatus','3sVLdpt','all','__esModule','This\x20is\x20a\x20test\x20notification','body','paid','json','Broadcast\x20message\x20sent\x20successfully','default','method','length','payment','getBotInfo','gateway','update','sendPaymentNotification','7233000fXbPPw','productName','telegramBotService','1629128zGLrGb','map','User\x20disconnected\x20successfully'];a12_0x1298=function(){return _0xb16f8a;};return a12_0x1298();}function a12_0x4b5f(_0x200cd6,_0x41649a){const _0x1298e5=a12_0x1298();return a12_0x4b5f=function(_0x4b5f33,_0x488236){_0x4b5f33=_0x4b5f33-0x1b3;let _0x3d717e=_0x1298e5[_0x4b5f33];return _0x3d717e;},a12_0x4b5f(_0x200cd6,_0x41649a);}var __importDefault=this&&this['__importDefault']||function(_0xe59d32){return _0xe59d32&&_0xe59d32['__esModule']?_0xe59d32:{'default':_0xe59d32};};Object[a12_0xe3e956(0x1c5)](exports,a12_0xe3e956(0x1e1),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0xe3e956(0x1c4)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x50d655=a12_0xe3e956;this[_0x50d655(0x1de)]=async(_0x20de34,_0x3955a7,_0x27323a)=>{const _0x4dd951=_0x50d655;try{const _0x26d35f=telegramBotService_1['telegramBotService'][_0x4dd951(0x1eb)](),_0x213dc0=await database_1[_0x4dd951(0x1e7)]['telegramUser'][_0x4dd951(0x1d0)](),_0x48b200=await database_1['default'][_0x4dd951(0x1cb)][_0x4dd951(0x1d0)]({'where':{'isVerified':!![]}}),_0x3a8147=await database_1[_0x4dd951(0x1e7)][_0x4dd951(0x1cb)][_0x4dd951(0x1ca)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3955a7[_0x4dd951(0x1e5)]({'success':!![],'result':{'bot':{'isActive':_0x26d35f[_0x4dd951(0x1db)],'username':_0x26d35f['username']},'statistics':{'totalUsers':_0x213dc0,'verifiedUsers':_0x48b200,'unverifiedUsers':_0x213dc0-_0x48b200,'connectedShops':_0x3a8147[_0x4dd951(0x1e9)]}}});}catch(_0x4380af){_0x27323a(_0x4380af);}},this['getTelegramUsers']=async(_0xbfc5d7,_0xbc6111,_0x566e13)=>{const _0x4a71bd=_0x50d655;try{const {page:page=0x1,limit:limit=0x14,verified:_0x590ca6}=_0xbfc5d7[_0x4a71bd(0x1bf)],_0x431321=(Number(page)-0x1)*Number(limit),_0x125550={};_0x590ca6!==undefined&&(_0x125550[_0x4a71bd(0x1ce)]=_0x590ca6===_0x4a71bd(0x1b7));const [_0x38c3da,_0x562063]=await Promise[_0x4a71bd(0x1e0)]([database_1[_0x4a71bd(0x1e7)][_0x4a71bd(0x1cb)][_0x4a71bd(0x1ba)]({'where':_0x125550,'skip':_0x431321,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4a71bd(0x1e7)][_0x4a71bd(0x1cb)][_0x4a71bd(0x1d0)]({'where':_0x125550})]);_0xbc6111[_0x4a71bd(0x1e5)]({'success':!![],'users':_0x38c3da[_0x4a71bd(0x1f3)](_0x1f6d86=>({'id':_0x1f6d86['id'],'telegramId':_0x1f6d86['telegramId'],'username':_0x1f6d86[_0x4a71bd(0x1d2)],'firstName':_0x1f6d86['firstName'],'lastName':_0x1f6d86[_0x4a71bd(0x1f6)],'isVerified':_0x1f6d86[_0x4a71bd(0x1ce)],'shop':_0x1f6d86[_0x4a71bd(0x1da)],'createdAt':_0x1f6d86['createdAt'],'updatedAt':_0x1f6d86['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x562063,'totalPages':Math['ceil'](_0x562063/Number(limit))}});}catch(_0xa3cc45){_0x566e13(_0xa3cc45);}},this['sendBroadcast']=async(_0x150c80,_0x19d70d,_0x41dd61)=>{const _0x4fd7bf=_0x50d655;try{const {message:_0x53d018,shopId:_0x443eb5}=_0x150c80[_0x4fd7bf(0x1e3)];if(!_0x53d018)return _0x19d70d[_0x4fd7bf(0x1cf)](0x190)[_0x4fd7bf(0x1e5)]({'success':![],'message':_0x4fd7bf(0x1cc)});if(_0x443eb5)await telegramBotService_1[_0x4fd7bf(0x1f1)]['sendShopNotification'](_0x443eb5,_0x53d018,{'parse_mode':_0x4fd7bf(0x1cd)});else{const _0x4e5b46=await database_1['default']['telegramUser'][_0x4fd7bf(0x1ba)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x437ace=[...new Set(_0x4e5b46[_0x4fd7bf(0x1f3)](_0x46017d=>_0x46017d[_0x4fd7bf(0x1dd)])[_0x4fd7bf(0x1c8)](Boolean))];for(const _0x5edc72 of _0x437ace){_0x5edc72&&await telegramBotService_1[_0x4fd7bf(0x1f1)][_0x4fd7bf(0x1b4)](_0x5edc72,_0x53d018,{'parse_mode':'Markdown'});}}_0x19d70d['json']({'success':!![],'message':_0x4fd7bf(0x1e6)});}catch(_0xb5d36a){_0x41dd61(_0xb5d36a);}},this[_0x50d655(0x1d6)]=async(_0x2b84f4,_0x128bda,_0x4d038e)=>{const _0xcde3a0=_0x50d655;try{const {telegramId:_0x5bb52d}=_0x2b84f4[_0xcde3a0(0x1d4)],_0x1d8d9a=await database_1[_0xcde3a0(0x1e7)][_0xcde3a0(0x1cb)][_0xcde3a0(0x1bc)]({'where':{'telegramId':_0x5bb52d},'include':{'shop':!![]}});if(!_0x1d8d9a)return _0x128bda[_0xcde3a0(0x1cf)](0x194)[_0xcde3a0(0x1e5)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0xcde3a0(0x1e7)][_0xcde3a0(0x1cb)][_0xcde3a0(0x1ed)]({'where':{'telegramId':_0x5bb52d},'data':{'shopId':null,'isVerified':![]}}),_0x128bda[_0xcde3a0(0x1e5)]({'success':!![],'message':_0xcde3a0(0x1f4)});}catch(_0x58d4a3){_0x4d038e(_0x58d4a3);}},this['sendTestNotification']=async(_0x45045a,_0x74b222,_0x319be7)=>{const _0x2b491a=_0x50d655;try{const {shopId:_0x380b64,type:type=_0x2b491a(0x1ea),testData:_0xddb9ff}=_0x45045a['body'];if(!_0x380b64)return _0x74b222[_0x2b491a(0x1cf)](0x190)[_0x2b491a(0x1e5)]({'success':![],'message':_0x2b491a(0x1d8)});const _0x20c384=await database_1[_0x2b491a(0x1e7)][_0x2b491a(0x1da)][_0x2b491a(0x1bc)]({'where':{'id':_0x380b64},'select':{'id':!![],'name':!![]}});if(!_0x20c384)return _0x74b222['status'](0x194)['json']({'success':![],'message':_0x2b491a(0x1dc)});switch(type){case _0x2b491a(0x1ea):const _0xfc8104={'id':'test_payment_123','amount':_0xddb9ff?.[_0x2b491a(0x1d7)]||0x64,'currency':_0xddb9ff?.[_0x2b491a(0x1b3)]||_0x2b491a(0x1b9),'productName':_0xddb9ff?.[_0x2b491a(0x1f0)]||'Test\x20Product','gateway':_0xddb9ff?.[_0x2b491a(0x1ec)]||'plisio','createdAt':new Date(),..._0xddb9ff};await telegramBotService_1[_0x2b491a(0x1f1)][_0x2b491a(0x1ee)](_0x380b64,_0xfc8104,_0x2b491a(0x1e4));break;case _0x2b491a(0x1c1):const _0x3e3480={'id':'test_payout_123','amount':_0xddb9ff?.['amount']||0x1f4,'method':_0xddb9ff?.[_0x2b491a(0x1e8)]||_0x2b491a(0x1c6),'createdAt':new Date(),..._0xddb9ff};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x380b64,_0x3e3480,_0x2b491a(0x1bb));break;case _0x2b491a(0x1c0):await telegramBotService_1[_0x2b491a(0x1f1)][_0x2b491a(0x1f5)](_0x380b64,_0xddb9ff?.[_0x2b491a(0x1d9)]||_0x2b491a(0x1c3),_0xddb9ff?.[_0x2b491a(0x1b5)]||{'message':_0x2b491a(0x1e2)});break;default:return _0x74b222[_0x2b491a(0x1cf)](0x190)[_0x2b491a(0x1e5)]({'success':![],'message':_0x2b491a(0x1c7)});}_0x74b222[_0x2b491a(0x1e5)]({'success':!![],'message':_0x2b491a(0x1d1)+type+_0x2b491a(0x1c9)});}catch(_0x5bf3de){_0x319be7(_0x5bf3de);}};}}exports[a12_0xe3e956(0x1d5)]=TelegramController;