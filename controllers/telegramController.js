'use strict';const a12_0x5a28f2=a12_0x1018;function a12_0x1018(_0x5c16d6,_0x29e3d1){const _0x7b75ed=a12_0x7b75();return a12_0x1018=function(_0x101899,_0x38e9c5){_0x101899=_0x101899-0x1c9;let _0x488bfb=_0x7b75ed[_0x101899];return _0x488bfb;},a12_0x1018(_0x5c16d6,_0x29e3d1);}(function(_0x216bd3,_0x4a0abb){const _0xc87379=a12_0x1018,_0x5bad8f=_0x216bd3();while(!![]){try{const _0x3d0d6e=parseInt(_0xc87379(0x1d6))/0x1+parseInt(_0xc87379(0x1e8))/0x2*(parseInt(_0xc87379(0x201))/0x3)+-parseInt(_0xc87379(0x203))/0x4*(parseInt(_0xc87379(0x1fe))/0x5)+-parseInt(_0xc87379(0x1fd))/0x6*(parseInt(_0xc87379(0x1d3))/0x7)+-parseInt(_0xc87379(0x1f0))/0x8*(-parseInt(_0xc87379(0x1f6))/0x9)+parseInt(_0xc87379(0x204))/0xa*(-parseInt(_0xc87379(0x1f8))/0xb)+parseInt(_0xc87379(0x1ec))/0xc;if(_0x3d0d6e===_0x4a0abb)break;else _0x5bad8f['push'](_0x5bad8f['shift']());}catch(_0x5f588e){_0x5bad8f['push'](_0x5bad8f['shift']());}}}(a12_0x7b75,0x45e7e));function a12_0x7b75(){const _0x15f099=['29160DROGPw','1550FKmlVp','telegramId','title','\x20notification\x20sent\x20successfully','This\x20is\x20a\x20test\x20notification','Shop\x20ID\x20is\x20required','map','getBotStatus','Markdown','method','payout','User\x20disconnected\x20successfully','test_payout_123','isVerified','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','updatedAt','body','filter','count','currency','isActive','getTelegramUsers','Message\x20is\x20required','sendPaymentNotification','details','812hxYFtF','disconnectUser','getBotInfo','291219SgBhJS','custom','Test\x20','json','telegramBotService','productName','Shop\x20not\x20found','completed','findUnique','groupBy','../services/telegramBotService','shop','bank_transfer','default','Broadcast\x20message\x20sent\x20successfully','createdAt','all','status','2056neboZQ','defineProperty','paid','amount','5168400KLxbMW','sendShopNotification','sendCustomNotification','findMany','7624QZBwRB','username','payment','TelegramController','USD','lastName','1170FFYiOk','shopId','9977CPxMZe','telegramUser','plisio','test_payment_123','__esModule','4104synPTB','235UZQABS','sendBroadcast','../config/database','9yezkuC','true'];a12_0x7b75=function(){return _0x15f099;};return a12_0x7b75();}var __importDefault=this&&this['__importDefault']||function(_0x332c18){const _0x4fd563=a12_0x1018;return _0x332c18&&_0x332c18[_0x4fd563(0x1fc)]?_0x332c18:{'default':_0x332c18};};Object[a12_0x5a28f2(0x1e9)](exports,a12_0x5a28f2(0x1fc),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x5a28f2(0x1e0)),database_1=__importDefault(require(a12_0x5a28f2(0x200)));class TelegramController{constructor(){const _0x4d4e1a=a12_0x5a28f2;this[_0x4d4e1a(0x20b)]=async(_0x364308,_0x3380b5,_0x1977c6)=>{const _0x49e454=_0x4d4e1a;try{const _0x2bfb0e=telegramBotService_1[_0x49e454(0x1da)][_0x49e454(0x1d5)](),_0x5b7d76=await database_1[_0x49e454(0x1e3)][_0x49e454(0x1f9)][_0x49e454(0x1cc)](),_0x17daa9=await database_1[_0x49e454(0x1e3)][_0x49e454(0x1f9)]['count']({'where':{'isVerified':!![]}}),_0x285c56=await database_1[_0x49e454(0x1e3)]['telegramUser'][_0x49e454(0x1df)]({'by':[_0x49e454(0x1f7)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3380b5[_0x49e454(0x1d9)]({'success':!![],'result':{'bot':{'isActive':_0x2bfb0e[_0x49e454(0x1ce)],'username':_0x2bfb0e['username']},'statistics':{'totalUsers':_0x5b7d76,'verifiedUsers':_0x17daa9,'unverifiedUsers':_0x5b7d76-_0x17daa9,'connectedShops':_0x285c56['length']}}});}catch(_0x34952e){_0x1977c6(_0x34952e);}},this[_0x4d4e1a(0x1cf)]=async(_0xbf9614,_0x2a29ad,_0x20aaf7)=>{const _0x170b6b=_0x4d4e1a;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4cdbe4}=_0xbf9614['query'],_0x505d99=(Number(page)-0x1)*Number(limit),_0x4d826e={};_0x4cdbe4!==undefined&&(_0x4d826e[_0x170b6b(0x211)]=_0x4cdbe4===_0x170b6b(0x202));const [_0x13d70a,_0x5787cf]=await Promise[_0x170b6b(0x1e6)]([database_1[_0x170b6b(0x1e3)][_0x170b6b(0x1f9)]['findMany']({'where':_0x4d826e,'skip':_0x505d99,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x170b6b(0x1e3)]['telegramUser'][_0x170b6b(0x1cc)]({'where':_0x4d826e})]);_0x2a29ad['json']({'success':!![],'users':_0x13d70a[_0x170b6b(0x20a)](_0x2292d9=>({'id':_0x2292d9['id'],'telegramId':_0x2292d9[_0x170b6b(0x205)],'username':_0x2292d9[_0x170b6b(0x1f1)],'firstName':_0x2292d9['firstName'],'lastName':_0x2292d9[_0x170b6b(0x1f5)],'isVerified':_0x2292d9[_0x170b6b(0x211)],'shop':_0x2292d9[_0x170b6b(0x1e1)],'createdAt':_0x2292d9[_0x170b6b(0x1e5)],'updatedAt':_0x2292d9[_0x170b6b(0x1c9)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5787cf,'totalPages':Math['ceil'](_0x5787cf/Number(limit))}});}catch(_0x270d8a){_0x20aaf7(_0x270d8a);}},this[_0x4d4e1a(0x1ff)]=async(_0x49b806,_0x34a156,_0x4429e8)=>{const _0x277456=_0x4d4e1a;try{const {message:_0x13dffb,shopId:_0x5f2ee7}=_0x49b806[_0x277456(0x1ca)];if(!_0x13dffb)return _0x34a156[_0x277456(0x1e7)](0x190)[_0x277456(0x1d9)]({'success':![],'message':_0x277456(0x1d0)});if(_0x5f2ee7)await telegramBotService_1['telegramBotService'][_0x277456(0x1ed)](_0x5f2ee7,_0x13dffb,{'parse_mode':'Markdown'});else{const _0x5ca516=await database_1['default'][_0x277456(0x1f9)][_0x277456(0x1ef)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1cb823=[...new Set(_0x5ca516['map'](_0x222df3=>_0x222df3['shopId'])[_0x277456(0x1cb)](Boolean))];for(const _0x2e0123 of _0x1cb823){_0x2e0123&&await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x2e0123,_0x13dffb,{'parse_mode':_0x277456(0x20c)});}}_0x34a156['json']({'success':!![],'message':_0x277456(0x1e4)});}catch(_0x440ec5){_0x4429e8(_0x440ec5);}},this[_0x4d4e1a(0x1d4)]=async(_0x358b5d,_0x522b81,_0x3fdda6)=>{const _0x4730d4=_0x4d4e1a;try{const {telegramId:_0x48a74f}=_0x358b5d['params'],_0x505cde=await database_1[_0x4730d4(0x1e3)][_0x4730d4(0x1f9)][_0x4730d4(0x1de)]({'where':{'telegramId':_0x48a74f},'include':{'shop':!![]}});if(!_0x505cde)return _0x522b81[_0x4730d4(0x1e7)](0x194)[_0x4730d4(0x1d9)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x4730d4(0x1f9)]['update']({'where':{'telegramId':_0x48a74f},'data':{'shopId':null,'isVerified':![]}}),_0x522b81['json']({'success':!![],'message':_0x4730d4(0x20f)});}catch(_0x4c2648){_0x3fdda6(_0x4c2648);}},this['sendTestNotification']=async(_0x5b495c,_0x788271,_0x553484)=>{const _0xdd6d25=_0x4d4e1a;try{const {shopId:_0x160a9f,type:type=_0xdd6d25(0x1f2),testData:_0x406280}=_0x5b495c[_0xdd6d25(0x1ca)];if(!_0x160a9f)return _0x788271[_0xdd6d25(0x1e7)](0x190)[_0xdd6d25(0x1d9)]({'success':![],'message':_0xdd6d25(0x209)});const _0x2064b8=await database_1['default'][_0xdd6d25(0x1e1)][_0xdd6d25(0x1de)]({'where':{'id':_0x160a9f},'select':{'id':!![],'name':!![]}});if(!_0x2064b8)return _0x788271['status'](0x194)[_0xdd6d25(0x1d9)]({'success':![],'message':_0xdd6d25(0x1dc)});switch(type){case _0xdd6d25(0x1f2):const _0x1718ea={'id':_0xdd6d25(0x1fb),'amount':_0x406280?.[_0xdd6d25(0x1eb)]||0x64,'currency':_0x406280?.[_0xdd6d25(0x1cd)]||_0xdd6d25(0x1f4),'productName':_0x406280?.[_0xdd6d25(0x1db)]||'Test\x20Product','gateway':_0x406280?.['gateway']||_0xdd6d25(0x1fa),'createdAt':new Date(),..._0x406280};await telegramBotService_1[_0xdd6d25(0x1da)][_0xdd6d25(0x1d1)](_0x160a9f,_0x1718ea,_0xdd6d25(0x1ea));break;case _0xdd6d25(0x20e):const _0x58531f={'id':_0xdd6d25(0x210),'amount':_0x406280?.[_0xdd6d25(0x1eb)]||0x1f4,'method':_0x406280?.[_0xdd6d25(0x20d)]||_0xdd6d25(0x1e2),'createdAt':new Date(),..._0x406280};await telegramBotService_1[_0xdd6d25(0x1da)]['sendPayoutNotification'](_0x160a9f,_0x58531f,_0xdd6d25(0x1dd));break;case _0xdd6d25(0x1d7):await telegramBotService_1[_0xdd6d25(0x1da)][_0xdd6d25(0x1ee)](_0x160a9f,_0x406280?.[_0xdd6d25(0x206)]||'Test\x20Notification',_0x406280?.[_0xdd6d25(0x1d2)]||{'message':_0xdd6d25(0x208)});break;default:return _0x788271[_0xdd6d25(0x1e7)](0x190)['json']({'success':![],'message':_0xdd6d25(0x212)});}_0x788271['json']({'success':!![],'message':_0xdd6d25(0x1d8)+type+_0xdd6d25(0x207)});}catch(_0x4c7946){_0x553484(_0x4c7946);}};}}exports[a12_0x5a28f2(0x1f3)]=TelegramController;