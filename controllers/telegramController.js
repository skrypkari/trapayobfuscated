'use strict';const a20_0x154a79=a20_0x32a0;(function(_0x65be67,_0x4dc266){const _0x353f32=a20_0x32a0,_0x2ef480=_0x65be67();while(!![]){try{const _0x40cb0d=parseInt(_0x353f32(0x18b))/0x1*(parseInt(_0x353f32(0x16d))/0x2)+-parseInt(_0x353f32(0x189))/0x3+-parseInt(_0x353f32(0x1a0))/0x4*(-parseInt(_0x353f32(0x164))/0x5)+-parseInt(_0x353f32(0x1a1))/0x6*(-parseInt(_0x353f32(0x185))/0x7)+-parseInt(_0x353f32(0x16e))/0x8+parseInt(_0x353f32(0x16a))/0x9*(parseInt(_0x353f32(0x18f))/0xa)+-parseInt(_0x353f32(0x17c))/0xb;if(_0x40cb0d===_0x4dc266)break;else _0x2ef480['push'](_0x2ef480['shift']());}catch(_0x54ec0a){_0x2ef480['push'](_0x2ef480['shift']());}}}(a20_0xe993,0xef5cb));function a20_0xe993(){const _0x25f294=['true','388020JAOqOD','test_payment_123','403732caUWoT','findMany','currency','desc','1651490GzObGb','default','telegramUser','Test\x20','ceil','__importDefault','shop','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','map','Telegram\x20user\x20not\x20found','filter','test_payout_123','getBotStatus','sendCustomNotification','isVerified','Markdown','sendPayoutNotification','1364628OgsmOQ','6akspCT','defineProperty','firstName','Broadcast\x20message\x20sent\x20successfully','length','telegramBotService','shopId','txid','Shop\x20ID\x20is\x20required','gateway','getTelegramUsers','updatedAt','Shop\x20not\x20found','sendTestNotification','payment','USD','Тестовый\x20период','sendBroadcast','25wpQnLm','payout','__esModule','wallet','amount','count','9cEgZTb','username','getBotInfo','4anqXYw','4193240SgXTjh','paid','plisio','custom','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','User\x20disconnected\x20successfully','sendPaymentNotification','lastName','params','TelegramController','all','sendShopNotification','title','details','15688332yinKzU','json','body','findUnique','../services/telegramBotService','groupBy','TRC20','disconnectUser','productName','2672152yNwdHr','Test\x20Product','status'];a20_0xe993=function(){return _0x25f294;};return a20_0xe993();}var __importDefault=this&&this[a20_0x154a79(0x194)]||function(_0xe55c7f){const _0x5cc035=a20_0x154a79;return _0xe55c7f&&_0xe55c7f[_0x5cc035(0x166)]?_0xe55c7f:{'default':_0xe55c7f};};Object[a20_0x154a79(0x1a2)](exports,'__esModule',{'value':!![]}),exports[a20_0x154a79(0x177)]=void 0x0;const telegramBotService_1=require(a20_0x154a79(0x180)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x5b7ce9=a20_0x154a79;this[_0x5b7ce9(0x19b)]=async(_0x19002e,_0x3c67ff,_0x3c8ebd)=>{const _0x4eb374=_0x5b7ce9;try{const _0x166d6e=telegramBotService_1['telegramBotService'][_0x4eb374(0x16c)](),_0x238158=await database_1[_0x4eb374(0x190)]['telegramUser'][_0x4eb374(0x169)](),_0x1d88e8=await database_1[_0x4eb374(0x190)][_0x4eb374(0x191)][_0x4eb374(0x169)]({'where':{'isVerified':!![]}}),_0x2f8013=await database_1[_0x4eb374(0x190)][_0x4eb374(0x191)][_0x4eb374(0x181)]({'by':[_0x4eb374(0x1a7)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3c67ff[_0x4eb374(0x17d)]({'success':!![],'result':{'bot':{'isActive':_0x166d6e['isActive'],'username':_0x166d6e[_0x4eb374(0x16b)]},'statistics':{'totalUsers':_0x238158,'verifiedUsers':_0x1d88e8,'unverifiedUsers':_0x238158-_0x1d88e8,'connectedShops':_0x2f8013[_0x4eb374(0x1a5)]}}});}catch(_0x508e00){_0x3c8ebd(_0x508e00);}},this[_0x5b7ce9(0x15c)]=async(_0x1ead6e,_0x5b08ef,_0x22059b)=>{const _0x344b44=_0x5b7ce9;try{const {page:page=0x1,limit:limit=0x14,verified:_0x22b0a7}=_0x1ead6e['query'],_0xd072bf=(Number(page)-0x1)*Number(limit),_0x161bdf={};_0x22b0a7!==undefined&&(_0x161bdf[_0x344b44(0x19d)]=_0x22b0a7===_0x344b44(0x188));const [_0x48b214,_0x46264c]=await Promise[_0x344b44(0x178)]([database_1[_0x344b44(0x190)][_0x344b44(0x191)][_0x344b44(0x18c)]({'where':_0x161bdf,'skip':_0xd072bf,'take':Number(limit),'orderBy':{'createdAt':_0x344b44(0x18e)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['telegramUser'][_0x344b44(0x169)]({'where':_0x161bdf})]);_0x5b08ef['json']({'success':!![],'users':_0x48b214[_0x344b44(0x197)](_0x533e6d=>({'id':_0x533e6d['id'],'telegramId':_0x533e6d['telegramId'],'username':_0x533e6d[_0x344b44(0x16b)],'firstName':_0x533e6d[_0x344b44(0x1a3)],'lastName':_0x533e6d[_0x344b44(0x175)],'isVerified':_0x533e6d[_0x344b44(0x19d)],'shop':_0x533e6d[_0x344b44(0x195)],'createdAt':_0x533e6d['createdAt'],'updatedAt':_0x533e6d[_0x344b44(0x15d)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x46264c,'totalPages':Math[_0x344b44(0x193)](_0x46264c/Number(limit))}});}catch(_0x5c2708){_0x22059b(_0x5c2708);}},this[_0x5b7ce9(0x163)]=async(_0x1379b6,_0x2732a8,_0x17ef18)=>{const _0x296a2a=_0x5b7ce9;try{const {message:_0x247e87,shopId:_0x21f8df}=_0x1379b6[_0x296a2a(0x17e)];if(!_0x247e87)return _0x2732a8['status'](0x190)[_0x296a2a(0x17d)]({'success':![],'message':'Message\x20is\x20required'});if(_0x21f8df)await telegramBotService_1['telegramBotService'][_0x296a2a(0x179)](_0x21f8df,_0x247e87,{'parse_mode':_0x296a2a(0x19e)});else{const _0x549aac=await database_1[_0x296a2a(0x190)]['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x162993=[...new Set(_0x549aac[_0x296a2a(0x197)](_0x4e42c6=>_0x4e42c6['shopId'])[_0x296a2a(0x199)](Boolean))];for(const _0x516925 of _0x162993){_0x516925&&await telegramBotService_1['telegramBotService'][_0x296a2a(0x179)](_0x516925,_0x247e87,{'parse_mode':_0x296a2a(0x19e)});}}_0x2732a8['json']({'success':!![],'message':_0x296a2a(0x1a4)});}catch(_0x13a688){_0x17ef18(_0x13a688);}},this[_0x5b7ce9(0x183)]=async(_0x38b630,_0x5792b9,_0x5cc130)=>{const _0x526d71=_0x5b7ce9;try{const {telegramId:_0x53dedb}=_0x38b630[_0x526d71(0x176)],_0x3584f0=await database_1['default'][_0x526d71(0x191)][_0x526d71(0x17f)]({'where':{'telegramId':_0x53dedb},'include':{'shop':!![]}});if(!_0x3584f0)return _0x5792b9[_0x526d71(0x187)](0x194)[_0x526d71(0x17d)]({'success':![],'message':_0x526d71(0x198)});await database_1[_0x526d71(0x190)][_0x526d71(0x191)]['update']({'where':{'telegramId':_0x53dedb},'data':{'shopId':null,'isVerified':![]}}),_0x5792b9[_0x526d71(0x17d)]({'success':!![],'message':_0x526d71(0x173)});}catch(_0x1018ae){_0x5cc130(_0x1018ae);}},this[_0x5b7ce9(0x15f)]=async(_0x54a041,_0x521506,_0x3dc14a)=>{const _0x5c1757=_0x5b7ce9;try{const {shopId:_0x45dbb2,type:type=_0x5c1757(0x160),testData:_0x3090d0}=_0x54a041['body'];if(!_0x45dbb2)return _0x521506[_0x5c1757(0x187)](0x190)[_0x5c1757(0x17d)]({'success':![],'message':_0x5c1757(0x15a)});const _0x13aefb=await database_1['default'][_0x5c1757(0x195)][_0x5c1757(0x17f)]({'where':{'id':_0x45dbb2},'select':{'id':!![],'name':!![]}});if(!_0x13aefb)return _0x521506[_0x5c1757(0x187)](0x194)[_0x5c1757(0x17d)]({'success':![],'message':_0x5c1757(0x15e)});switch(type){case _0x5c1757(0x160):const _0x53feea={'id':_0x5c1757(0x18a),'amount':_0x3090d0?.[_0x5c1757(0x168)]||0x64,'currency':_0x3090d0?.[_0x5c1757(0x18d)]||_0x5c1757(0x161),'productName':_0x3090d0?.[_0x5c1757(0x184)]||_0x5c1757(0x186),'gateway':_0x3090d0?.[_0x5c1757(0x15b)]||_0x5c1757(0x170),'createdAt':new Date(),..._0x3090d0};await telegramBotService_1['telegramBotService'][_0x5c1757(0x174)](_0x45dbb2,_0x53feea,_0x5c1757(0x16f));break;case _0x5c1757(0x165):const _0x60f6a6={'id':_0x5c1757(0x19a),'amount':_0x3090d0?.['amount']||0x1f4,'network':_0x3090d0?.['network']||_0x5c1757(0x182),'wallet':_0x3090d0?.[_0x5c1757(0x167)]||_0x5c1757(0x196),'period':_0x5c1757(0x162),'createdAt':new Date(),'txid':_0x3090d0?.[_0x5c1757(0x1a8)]||null,..._0x3090d0};await telegramBotService_1[_0x5c1757(0x1a6)][_0x5c1757(0x19f)](_0x45dbb2,_0x60f6a6);break;case _0x5c1757(0x171):await telegramBotService_1[_0x5c1757(0x1a6)][_0x5c1757(0x19c)](_0x45dbb2,_0x3090d0?.[_0x5c1757(0x17a)]||'Test\x20Notification',_0x3090d0?.[_0x5c1757(0x17b)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x521506[_0x5c1757(0x187)](0x190)['json']({'success':![],'message':_0x5c1757(0x172)});}_0x521506[_0x5c1757(0x17d)]({'success':!![],'message':_0x5c1757(0x192)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x23c663){_0x3dc14a(_0x23c663);}};}}function a20_0x32a0(_0x345abc,_0x25835a){_0x345abc=_0x345abc-0x15a;const _0xe993d1=a20_0xe993();let _0x32a088=_0xe993d1[_0x345abc];return _0x32a088;}exports[a20_0x154a79(0x177)]=TelegramController;