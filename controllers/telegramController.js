'use strict';const a12_0x50b4dc=a12_0x4ce1;(function(_0x59b5c9,_0x42f4c1){const _0x33fedd=a12_0x4ce1,_0x5d2ac4=_0x59b5c9();while(!![]){try{const _0x1fe4c7=parseInt(_0x33fedd(0x10a))/0x1+parseInt(_0x33fedd(0x10d))/0x2+parseInt(_0x33fedd(0x10e))/0x3+-parseInt(_0x33fedd(0x130))/0x4+parseInt(_0x33fedd(0x110))/0x5+parseInt(_0x33fedd(0x10c))/0x6+parseInt(_0x33fedd(0xfc))/0x7*(-parseInt(_0x33fedd(0x13a))/0x8);if(_0x1fe4c7===_0x42f4c1)break;else _0x5d2ac4['push'](_0x5d2ac4['shift']());}catch(_0x5a00f2){_0x5d2ac4['push'](_0x5d2ac4['shift']());}}}(a12_0x1015,0x44422));function a12_0x4ce1(_0x15ba85,_0x1f9d76){const _0x1015f1=a12_0x1015();return a12_0x4ce1=function(_0x4ce130,_0x781aff){_0x4ce130=_0x4ce130-0xfc;let _0x3d1740=_0x1015f1[_0x4ce130];return _0x3d1740;},a12_0x4ce1(_0x15ba85,_0x1f9d76);}var __importDefault=this&&this[a12_0x50b4dc(0x118)]||function(_0x1dced8){const _0x485b30=a12_0x50b4dc;return _0x1dced8&&_0x1dced8[_0x485b30(0x101)]?_0x1dced8:{'default':_0x1dced8};};Object[a12_0x50b4dc(0x11b)](exports,a12_0x50b4dc(0x101),{'value':!![]}),exports[a12_0x50b4dc(0x11f)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x50b4dc(0x103)));class TelegramController{constructor(){const _0x5ca099=a12_0x50b4dc;this['getBotStatus']=async(_0x483866,_0x127080,_0x29490c)=>{const _0x38dafc=a12_0x4ce1;try{const _0x365415=telegramBotService_1[_0x38dafc(0x122)][_0x38dafc(0x13b)](),_0x106f9a=await database_1[_0x38dafc(0x140)][_0x38dafc(0x141)][_0x38dafc(0x134)](),_0x17f55f=await database_1[_0x38dafc(0x140)][_0x38dafc(0x141)][_0x38dafc(0x134)]({'where':{'isVerified':!![]}}),_0x5f5596=await database_1[_0x38dafc(0x140)][_0x38dafc(0x141)][_0x38dafc(0x125)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x127080[_0x38dafc(0x11a)]({'success':!![],'result':{'bot':{'isActive':_0x365415['isActive'],'username':_0x365415[_0x38dafc(0x13c)]},'statistics':{'totalUsers':_0x106f9a,'verifiedUsers':_0x17f55f,'unverifiedUsers':_0x106f9a-_0x17f55f,'connectedShops':_0x5f5596[_0x38dafc(0xff)]}}});}catch(_0x3bf4b3){_0x29490c(_0x3bf4b3);}},this[_0x5ca099(0x116)]=async(_0x21d430,_0x59faf2,_0x13285d)=>{const _0x5af02b=_0x5ca099;try{const {page:page=0x1,limit:limit=0x14,verified:_0x585fb9}=_0x21d430[_0x5af02b(0x10b)],_0x194ae4=(Number(page)-0x1)*Number(limit),_0x2c928b={};_0x585fb9!==undefined&&(_0x2c928b[_0x5af02b(0x104)]=_0x585fb9===_0x5af02b(0xfe));const [_0x5007f7,_0x537a58]=await Promise[_0x5af02b(0x128)]([database_1[_0x5af02b(0x140)][_0x5af02b(0x141)]['findMany']({'where':_0x2c928b,'skip':_0x194ae4,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x5af02b(0x141)][_0x5af02b(0x134)]({'where':_0x2c928b})]);_0x59faf2[_0x5af02b(0x11a)]({'success':!![],'users':_0x5007f7[_0x5af02b(0x11c)](_0x32b1da=>({'id':_0x32b1da['id'],'telegramId':_0x32b1da[_0x5af02b(0x112)],'username':_0x32b1da[_0x5af02b(0x13c)],'firstName':_0x32b1da[_0x5af02b(0x127)],'lastName':_0x32b1da[_0x5af02b(0x126)],'isVerified':_0x32b1da['isVerified'],'shop':_0x32b1da['shop'],'createdAt':_0x32b1da[_0x5af02b(0x135)],'updatedAt':_0x32b1da[_0x5af02b(0x133)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x537a58,'totalPages':Math[_0x5af02b(0x137)](_0x537a58/Number(limit))}});}catch(_0x59d896){_0x13285d(_0x59d896);}},this[_0x5ca099(0x100)]=async(_0x46a33e,_0x573bd8,_0x2c8ed7)=>{const _0x1fda98=_0x5ca099;try{const {message:_0x12b749,shopId:_0x5697d1}=_0x46a33e['body'];if(!_0x12b749)return _0x573bd8['status'](0x190)['json']({'success':![],'message':'Message\x20is\x20required'});if(_0x5697d1)await telegramBotService_1[_0x1fda98(0x122)][_0x1fda98(0x120)](_0x5697d1,_0x12b749,{'parse_mode':_0x1fda98(0x115)});else{const _0xe113cb=await database_1[_0x1fda98(0x140)]['telegramUser'][_0x1fda98(0x108)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x32a04b=[...new Set(_0xe113cb[_0x1fda98(0x11c)](_0x468f7b=>_0x468f7b[_0x1fda98(0xfd)])[_0x1fda98(0x117)](Boolean))];for(const _0x51fcdb of _0x32a04b){_0x51fcdb&&await telegramBotService_1[_0x1fda98(0x122)]['sendShopNotification'](_0x51fcdb,_0x12b749,{'parse_mode':_0x1fda98(0x115)});}}_0x573bd8[_0x1fda98(0x11a)]({'success':!![],'message':_0x1fda98(0x106)});}catch(_0x82a01c){_0x2c8ed7(_0x82a01c);}},this[_0x5ca099(0x11e)]=async(_0x5cf987,_0x5d5889,_0x24df58)=>{const _0x3e48a0=_0x5ca099;try{const {telegramId:_0xc289b5}=_0x5cf987[_0x3e48a0(0x107)],_0x579bc3=await database_1[_0x3e48a0(0x140)][_0x3e48a0(0x141)][_0x3e48a0(0x138)]({'where':{'telegramId':_0xc289b5},'include':{'shop':!![]}});if(!_0x579bc3)return _0x5d5889[_0x3e48a0(0x121)](0x194)[_0x3e48a0(0x11a)]({'success':![],'message':_0x3e48a0(0x109)});await database_1['default'][_0x3e48a0(0x141)][_0x3e48a0(0x111)]({'where':{'telegramId':_0xc289b5},'data':{'shopId':null,'isVerified':![]}}),_0x5d5889[_0x3e48a0(0x11a)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x3ce781){_0x24df58(_0x3ce781);}},this['sendTestNotification']=async(_0x12c88f,_0x4040c3,_0x5505bc)=>{const _0x1d8294=_0x5ca099;try{const {shopId:_0x1aee00,type:type='payment',testData:_0xf1ebfe}=_0x12c88f[_0x1d8294(0x114)];if(!_0x1aee00)return _0x4040c3[_0x1d8294(0x121)](0x190)[_0x1d8294(0x11a)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x560b41=await database_1[_0x1d8294(0x140)][_0x1d8294(0x12d)][_0x1d8294(0x138)]({'where':{'id':_0x1aee00},'select':{'id':!![],'name':!![]}});if(!_0x560b41)return _0x4040c3['status'](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0x2016ba={'id':_0x1d8294(0x129),'amount':_0xf1ebfe?.[_0x1d8294(0x124)]||0x64,'currency':_0xf1ebfe?.[_0x1d8294(0x12f)]||'USD','productName':_0xf1ebfe?.[_0x1d8294(0x136)]||_0x1d8294(0x12e),'gateway':_0xf1ebfe?.[_0x1d8294(0x12c)]||_0x1d8294(0x13f),'createdAt':new Date(),..._0xf1ebfe};await telegramBotService_1[_0x1d8294(0x122)][_0x1d8294(0x12b)](_0x1aee00,_0x2016ba,_0x1d8294(0x119));break;case _0x1d8294(0x102):const _0x43396b={'id':'test_payout_123','amount':_0xf1ebfe?.[_0x1d8294(0x124)]||0x1f4,'method':_0xf1ebfe?.[_0x1d8294(0x123)]||_0x1d8294(0x10f),'createdAt':new Date(),..._0xf1ebfe};await telegramBotService_1[_0x1d8294(0x122)][_0x1d8294(0x105)](_0x1aee00,_0x43396b,_0x1d8294(0x13e));break;case _0x1d8294(0x11d):await telegramBotService_1[_0x1d8294(0x122)][_0x1d8294(0x132)](_0x1aee00,_0xf1ebfe?.[_0x1d8294(0x12a)]||_0x1d8294(0x113),_0xf1ebfe?.['details']||{'message':_0x1d8294(0x139)});break;default:return _0x4040c3[_0x1d8294(0x121)](0x190)[_0x1d8294(0x11a)]({'success':![],'message':_0x1d8294(0x131)});}_0x4040c3['json']({'success':!![],'message':_0x1d8294(0x13d)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x593556){_0x5505bc(_0x593556);}};}}function a12_0x1015(){const _0x3482dd=['telegramBotService','method','amount','groupBy','lastName','firstName','all','test_payment_123','title','sendPaymentNotification','gateway','shop','Test\x20Product','currency','2170816BvhPPv','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','sendCustomNotification','updatedAt','count','createdAt','productName','ceil','findUnique','This\x20is\x20a\x20test\x20notification','44232waMNxM','getBotInfo','username','Test\x20','completed','plisio','default','telegramUser','1057iFJWzZ','shopId','true','length','sendBroadcast','__esModule','payout','../config/database','isVerified','sendPayoutNotification','Broadcast\x20message\x20sent\x20successfully','params','findMany','Telegram\x20user\x20not\x20found','194420pkIPaG','query','2201094XJljGK','638252BLGdop','705981qcvPfW','bank_transfer','2707235gjwcph','update','telegramId','Test\x20Notification','body','Markdown','getTelegramUsers','filter','__importDefault','paid','json','defineProperty','map','custom','disconnectUser','TelegramController','sendShopNotification','status'];a12_0x1015=function(){return _0x3482dd;};return a12_0x1015();}exports[a12_0x50b4dc(0x11f)]=TelegramController;