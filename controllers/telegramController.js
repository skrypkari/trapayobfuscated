'use strict';function a12_0x231e(){const _0x1e96db=['custom','filter','4105040KRJpDW','amount','gateway','Test\x20Product','groupBy','User\x20disconnected\x20successfully','updatedAt','details','sendShopNotification','telegramBotService','disconnectUser','22310163uHeHzb','5eCcWLW','This\x20is\x20a\x20test\x20notification','sendTestNotification','Message\x20is\x20required','isVerified','4599246RVLJqM','createdAt','872113bzkVJi','defineProperty','shopId','shop','test_payout_123','status','map','length','default','ceil','Telegram\x20user\x20not\x20found','getTelegramUsers','4488584lngXUU','getBotInfo','isActive','__esModule','completed','8638yFUtVu','../config/database','sendPaymentNotification','sendCustomNotification','Test\x20Notification','findUnique','TelegramController','Markdown','productName','getBotStatus','method','telegramUser','payment','all','102IZefvU','username','Test\x20','update','desc','Shop\x20not\x20found','sendBroadcast','990423IWMoSo','sendPayoutNotification','json','count','paid','true','Broadcast\x20message\x20sent\x20successfully','payout'];a12_0x231e=function(){return _0x1e96db;};return a12_0x231e();}const a12_0x190c31=a12_0x45a2;(function(_0x4d33b7,_0x7af25c){const _0x3a0c0b=a12_0x45a2,_0x4fc813=_0x4d33b7();while(!![]){try{const _0x3cddb3=parseInt(_0x3a0c0b(0xd0))/0x1+parseInt(_0x3a0c0b(0x9e))/0x2*(-parseInt(_0x3a0c0b(0xac))/0x3)+-parseInt(_0x3a0c0b(0xbd))/0x4+parseInt(_0x3a0c0b(0xc9))/0x5*(-parseInt(_0x3a0c0b(0xce))/0x6)+-parseInt(_0x3a0c0b(0xb3))/0x7+-parseInt(_0x3a0c0b(0x99))/0x8+parseInt(_0x3a0c0b(0xc8))/0x9;if(_0x3cddb3===_0x7af25c)break;else _0x4fc813['push'](_0x4fc813['shift']());}catch(_0x2fe9ac){_0x4fc813['push'](_0x4fc813['shift']());}}}(a12_0x231e,0xad0cb));var __importDefault=this&&this['__importDefault']||function(_0x3aea62){return _0x3aea62&&_0x3aea62['__esModule']?_0x3aea62:{'default':_0x3aea62};};Object[a12_0x190c31(0xd1)](exports,a12_0x190c31(0x9c),{'value':!![]}),exports[a12_0x190c31(0xa4)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x190c31(0x9f)));class TelegramController{constructor(){const _0x4e30ce=a12_0x190c31;this[_0x4e30ce(0xa7)]=async(_0x3392fe,_0x228b5a,_0x52e6ca)=>{const _0xf3c21=_0x4e30ce;try{const _0x5b285d=telegramBotService_1[_0xf3c21(0xc6)][_0xf3c21(0x9a)](),_0x3c9e0e=await database_1['default'][_0xf3c21(0xa9)][_0xf3c21(0xb6)](),_0x4adce0=await database_1[_0xf3c21(0xd8)][_0xf3c21(0xa9)][_0xf3c21(0xb6)]({'where':{'isVerified':!![]}}),_0x3ef1bd=await database_1[_0xf3c21(0xd8)][_0xf3c21(0xa9)][_0xf3c21(0xc1)]({'by':[_0xf3c21(0xd2)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x228b5a[_0xf3c21(0xb5)]({'success':!![],'result':{'bot':{'isActive':_0x5b285d[_0xf3c21(0x9b)],'username':_0x5b285d[_0xf3c21(0xad)]},'statistics':{'totalUsers':_0x3c9e0e,'verifiedUsers':_0x4adce0,'unverifiedUsers':_0x3c9e0e-_0x4adce0,'connectedShops':_0x3ef1bd[_0xf3c21(0xd7)]}}});}catch(_0x16f335){_0x52e6ca(_0x16f335);}},this[_0x4e30ce(0xdb)]=async(_0x19269a,_0x4162fc,_0x10da75)=>{const _0x242195=_0x4e30ce;try{const {page:page=0x1,limit:limit=0x14,verified:_0x291812}=_0x19269a['query'],_0x2c9b5f=(Number(page)-0x1)*Number(limit),_0x3b4bba={};_0x291812!==undefined&&(_0x3b4bba[_0x242195(0xcd)]=_0x291812===_0x242195(0xb8));const [_0x1d095f,_0x1ee7e6]=await Promise[_0x242195(0xab)]([database_1[_0x242195(0xd8)][_0x242195(0xa9)]['findMany']({'where':_0x3b4bba,'skip':_0x2c9b5f,'take':Number(limit),'orderBy':{'createdAt':_0x242195(0xb0)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x242195(0xd8)]['telegramUser'][_0x242195(0xb6)]({'where':_0x3b4bba})]);_0x4162fc[_0x242195(0xb5)]({'success':!![],'users':_0x1d095f[_0x242195(0xd6)](_0x1208f6=>({'id':_0x1208f6['id'],'telegramId':_0x1208f6['telegramId'],'username':_0x1208f6[_0x242195(0xad)],'firstName':_0x1208f6['firstName'],'lastName':_0x1208f6['lastName'],'isVerified':_0x1208f6[_0x242195(0xcd)],'shop':_0x1208f6[_0x242195(0xd3)],'createdAt':_0x1208f6[_0x242195(0xcf)],'updatedAt':_0x1208f6[_0x242195(0xc3)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1ee7e6,'totalPages':Math[_0x242195(0xd9)](_0x1ee7e6/Number(limit))}});}catch(_0x2db7e6){_0x10da75(_0x2db7e6);}},this[_0x4e30ce(0xb2)]=async(_0xb40884,_0xab75e7,_0x3dfd55)=>{const _0xaca5b3=_0x4e30ce;try{const {message:_0x2da338,shopId:_0x358250}=_0xb40884['body'];if(!_0x2da338)return _0xab75e7[_0xaca5b3(0xd5)](0x190)[_0xaca5b3(0xb5)]({'success':![],'message':_0xaca5b3(0xcc)});if(_0x358250)await telegramBotService_1['telegramBotService'][_0xaca5b3(0xc5)](_0x358250,_0x2da338,{'parse_mode':_0xaca5b3(0xa5)});else{const _0x830375=await database_1[_0xaca5b3(0xd8)][_0xaca5b3(0xa9)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x48a0eb=[...new Set(_0x830375['map'](_0x5ac125=>_0x5ac125[_0xaca5b3(0xd2)])[_0xaca5b3(0xbc)](Boolean))];for(const _0x4c0011 of _0x48a0eb){_0x4c0011&&await telegramBotService_1[_0xaca5b3(0xc6)][_0xaca5b3(0xc5)](_0x4c0011,_0x2da338,{'parse_mode':_0xaca5b3(0xa5)});}}_0xab75e7['json']({'success':!![],'message':_0xaca5b3(0xb9)});}catch(_0x463055){_0x3dfd55(_0x463055);}},this[_0x4e30ce(0xc7)]=async(_0xe112a9,_0x531eea,_0xb77307)=>{const _0x556a8c=_0x4e30ce;try{const {telegramId:_0x4a1ecf}=_0xe112a9['params'],_0x3e7f51=await database_1[_0x556a8c(0xd8)][_0x556a8c(0xa9)][_0x556a8c(0xa3)]({'where':{'telegramId':_0x4a1ecf},'include':{'shop':!![]}});if(!_0x3e7f51)return _0x531eea[_0x556a8c(0xd5)](0x194)[_0x556a8c(0xb5)]({'success':![],'message':_0x556a8c(0xda)});await database_1[_0x556a8c(0xd8)][_0x556a8c(0xa9)][_0x556a8c(0xaf)]({'where':{'telegramId':_0x4a1ecf},'data':{'shopId':null,'isVerified':![]}}),_0x531eea[_0x556a8c(0xb5)]({'success':!![],'message':_0x556a8c(0xc2)});}catch(_0x19a8ee){_0xb77307(_0x19a8ee);}},this[_0x4e30ce(0xcb)]=async(_0xc8b0a3,_0x20902d,_0x428aef)=>{const _0x473a08=_0x4e30ce;try{const {shopId:_0x27c4b1,type:type=_0x473a08(0xaa),testData:_0x155d00}=_0xc8b0a3['body'];if(!_0x27c4b1)return _0x20902d[_0x473a08(0xd5)](0x190)[_0x473a08(0xb5)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0xc8257f=await database_1[_0x473a08(0xd8)][_0x473a08(0xd3)]['findUnique']({'where':{'id':_0x27c4b1},'select':{'id':!![],'name':!![]}});if(!_0xc8257f)return _0x20902d['status'](0x194)[_0x473a08(0xb5)]({'success':![],'message':_0x473a08(0xb1)});switch(type){case _0x473a08(0xaa):const _0x4b195d={'id':'test_payment_123','amount':_0x155d00?.[_0x473a08(0xbe)]||0x64,'currency':_0x155d00?.['currency']||'USD','productName':_0x155d00?.[_0x473a08(0xa6)]||_0x473a08(0xc0),'gateway':_0x155d00?.[_0x473a08(0xbf)]||'plisio','createdAt':new Date(),..._0x155d00};await telegramBotService_1[_0x473a08(0xc6)][_0x473a08(0xa0)](_0x27c4b1,_0x4b195d,_0x473a08(0xb7));break;case _0x473a08(0xba):const _0x62bc6e={'id':_0x473a08(0xd4),'amount':_0x155d00?.['amount']||0x1f4,'method':_0x155d00?.[_0x473a08(0xa8)]||'bank_transfer','createdAt':new Date(),..._0x155d00};await telegramBotService_1[_0x473a08(0xc6)][_0x473a08(0xb4)](_0x27c4b1,_0x62bc6e,_0x473a08(0x9d));break;case _0x473a08(0xbb):await telegramBotService_1[_0x473a08(0xc6)][_0x473a08(0xa1)](_0x27c4b1,_0x155d00?.['title']||_0x473a08(0xa2),_0x155d00?.[_0x473a08(0xc4)]||{'message':_0x473a08(0xca)});break;default:return _0x20902d[_0x473a08(0xd5)](0x190)[_0x473a08(0xb5)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x20902d[_0x473a08(0xb5)]({'success':!![],'message':_0x473a08(0xae)+type+'\x20notification\x20sent\x20successfully'});}catch(_0xc1e6e4){_0x428aef(_0xc1e6e4);}};}}function a12_0x45a2(_0x2c3234,_0x28fdfd){const _0x231e0e=a12_0x231e();return a12_0x45a2=function(_0x45a28a,_0x22dbae){_0x45a28a=_0x45a28a-0x99;let _0x8539f3=_0x231e0e[_0x45a28a];return _0x8539f3;},a12_0x45a2(_0x2c3234,_0x28fdfd);}exports[a12_0x190c31(0xa4)]=TelegramController;