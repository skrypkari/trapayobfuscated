'use strict';function a12_0x4682(_0x5317af,_0x434dfa){const _0x35131a=a12_0x3513();return a12_0x4682=function(_0x4682e4,_0x2ce7a3){_0x4682e4=_0x4682e4-0x1b1;let _0x318eee=_0x35131a[_0x4682e4];return _0x318eee;},a12_0x4682(_0x5317af,_0x434dfa);}const a12_0x18892a=a12_0x4682;(function(_0x21a8c1,_0x28a33c){const _0x2d8a57=a12_0x4682,_0x1eec60=_0x21a8c1();while(!![]){try{const _0x188b3e=-parseInt(_0x2d8a57(0x1e5))/0x1*(-parseInt(_0x2d8a57(0x1f1))/0x2)+-parseInt(_0x2d8a57(0x1d2))/0x3+-parseInt(_0x2d8a57(0x1e1))/0x4+parseInt(_0x2d8a57(0x1d0))/0x5+-parseInt(_0x2d8a57(0x1ed))/0x6+-parseInt(_0x2d8a57(0x1e3))/0x7*(-parseInt(_0x2d8a57(0x1cd))/0x8)+parseInt(_0x2d8a57(0x1f3))/0x9;if(_0x188b3e===_0x28a33c)break;else _0x1eec60['push'](_0x1eec60['shift']());}catch(_0x5696e5){_0x1eec60['push'](_0x1eec60['shift']());}}}(a12_0x3513,0x7b0b3));var __importDefault=this&&this[a12_0x18892a(0x1ef)]||function(_0x2443bf){const _0x50431b=a12_0x18892a;return _0x2443bf&&_0x2443bf[_0x50431b(0x1ce)]?_0x2443bf:{'default':_0x2443bf};};Object['defineProperty'](exports,a12_0x18892a(0x1ce),{'value':!![]}),exports[a12_0x18892a(0x1d4)]=void 0x0;const telegramBotService_1=require(a12_0x18892a(0x1ee)),database_1=__importDefault(require(a12_0x18892a(0x1da)));function a12_0x3513(){const _0x2befef=['This\x20is\x20a\x20test\x20notification','1276490xIDcYD','status','2268936Lkhlok','sendPayoutNotification','ceil','sendTestNotification','update','Message\x20is\x20required','\x20notification\x20sent\x20successfully','payout','groupBy','findMany','amount','shop','Test\x20','isActive','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','paid','params','title','telegramUser','Broadcast\x20message\x20sent\x20successfully','Shop\x20ID\x20is\x20required','findUnique','lastName','firstName','test_payout_123','query','getBotInfo','User\x20disconnected\x20successfully','getTelegramUsers','length','json','true','bank_transfer','sendCustomNotification','2077520AOkVte','__esModule','method','3006710UHiFXl','telegramId','801675IzWFbo','count','TelegramController','completed','USD','payment','shopId','body','../config/database','isVerified','telegramBotService','custom','Markdown','all','Test\x20Notification','3730220DSrYXB','map','14HBDumq','default','1dxNRAL','currency','username','disconnectUser','desc','sendBroadcast','plisio','sendShopNotification','1843824UVHUyC','../services/telegramBotService','__importDefault'];a12_0x3513=function(){return _0x2befef;};return a12_0x3513();}class TelegramController{constructor(){const _0x29650d=a12_0x18892a;this['getBotStatus']=async(_0x3d0cd3,_0xf531d4,_0x2d21e5)=>{const _0x9991ce=a12_0x4682;try{const _0x28e0af=telegramBotService_1['telegramBotService'][_0x9991ce(0x1c5)](),_0x56c65b=await database_1[_0x9991ce(0x1e4)][_0x9991ce(0x1bd)][_0x9991ce(0x1d3)](),_0xefd64e=await database_1['default'][_0x9991ce(0x1bd)][_0x9991ce(0x1d3)]({'where':{'isVerified':!![]}}),_0x463f49=await database_1[_0x9991ce(0x1e4)][_0x9991ce(0x1bd)][_0x9991ce(0x1b3)]({'by':[_0x9991ce(0x1d8)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xf531d4[_0x9991ce(0x1c9)]({'success':!![],'result':{'bot':{'isActive':_0x28e0af[_0x9991ce(0x1b8)],'username':_0x28e0af[_0x9991ce(0x1e7)]},'statistics':{'totalUsers':_0x56c65b,'verifiedUsers':_0xefd64e,'unverifiedUsers':_0x56c65b-_0xefd64e,'connectedShops':_0x463f49[_0x9991ce(0x1c8)]}}});}catch(_0x24648){_0x2d21e5(_0x24648);}},this[_0x29650d(0x1c7)]=async(_0x1da0aa,_0x470d0a,_0x3f1d05)=>{const _0x573ff4=_0x29650d;try{const {page:page=0x1,limit:limit=0x14,verified:_0x29dc83}=_0x1da0aa[_0x573ff4(0x1c4)],_0x2fa82a=(Number(page)-0x1)*Number(limit),_0x5a5fd9={};_0x29dc83!==undefined&&(_0x5a5fd9[_0x573ff4(0x1db)]=_0x29dc83===_0x573ff4(0x1ca));const [_0x21c420,_0x27cd6d]=await Promise[_0x573ff4(0x1df)]([database_1[_0x573ff4(0x1e4)][_0x573ff4(0x1bd)]['findMany']({'where':_0x5a5fd9,'skip':_0x2fa82a,'take':Number(limit),'orderBy':{'createdAt':_0x573ff4(0x1e9)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x573ff4(0x1e4)][_0x573ff4(0x1bd)][_0x573ff4(0x1d3)]({'where':_0x5a5fd9})]);_0x470d0a[_0x573ff4(0x1c9)]({'success':!![],'users':_0x21c420['map'](_0x312448=>({'id':_0x312448['id'],'telegramId':_0x312448[_0x573ff4(0x1d1)],'username':_0x312448[_0x573ff4(0x1e7)],'firstName':_0x312448[_0x573ff4(0x1c2)],'lastName':_0x312448[_0x573ff4(0x1c1)],'isVerified':_0x312448[_0x573ff4(0x1db)],'shop':_0x312448[_0x573ff4(0x1b6)],'createdAt':_0x312448['createdAt'],'updatedAt':_0x312448['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x27cd6d,'totalPages':Math[_0x573ff4(0x1f5)](_0x27cd6d/Number(limit))}});}catch(_0x3e5643){_0x3f1d05(_0x3e5643);}},this[_0x29650d(0x1ea)]=async(_0x21cbed,_0x4994d4,_0x59cebb)=>{const _0x1f58c2=_0x29650d;try{const {message:_0x54b5ee,shopId:_0x422d97}=_0x21cbed[_0x1f58c2(0x1d9)];if(!_0x54b5ee)return _0x4994d4[_0x1f58c2(0x1f2)](0x190)['json']({'success':![],'message':_0x1f58c2(0x1f8)});if(_0x422d97)await telegramBotService_1[_0x1f58c2(0x1dc)][_0x1f58c2(0x1ec)](_0x422d97,_0x54b5ee,{'parse_mode':_0x1f58c2(0x1de)});else{const _0x113685=await database_1['default']['telegramUser'][_0x1f58c2(0x1b4)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x33cf0e=[...new Set(_0x113685[_0x1f58c2(0x1e2)](_0x5c4764=>_0x5c4764['shopId'])['filter'](Boolean))];for(const _0x4fb1f3 of _0x33cf0e){_0x4fb1f3&&await telegramBotService_1['telegramBotService'][_0x1f58c2(0x1ec)](_0x4fb1f3,_0x54b5ee,{'parse_mode':_0x1f58c2(0x1de)});}}_0x4994d4[_0x1f58c2(0x1c9)]({'success':!![],'message':_0x1f58c2(0x1be)});}catch(_0x5a92c8){_0x59cebb(_0x5a92c8);}},this[_0x29650d(0x1e8)]=async(_0x4e0914,_0x527c87,_0x5f0f51)=>{const _0x20fadb=_0x29650d;try{const {telegramId:_0x32f513}=_0x4e0914[_0x20fadb(0x1bb)],_0x5e09d9=await database_1[_0x20fadb(0x1e4)]['telegramUser']['findUnique']({'where':{'telegramId':_0x32f513},'include':{'shop':!![]}});if(!_0x5e09d9)return _0x527c87[_0x20fadb(0x1f2)](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x20fadb(0x1e4)][_0x20fadb(0x1bd)][_0x20fadb(0x1f7)]({'where':{'telegramId':_0x32f513},'data':{'shopId':null,'isVerified':![]}}),_0x527c87[_0x20fadb(0x1c9)]({'success':!![],'message':_0x20fadb(0x1c6)});}catch(_0x3880a9){_0x5f0f51(_0x3880a9);}},this[_0x29650d(0x1f6)]=async(_0x6ece20,_0x5b8043,_0x1feee4)=>{const _0xda9014=_0x29650d;try{const {shopId:_0x4369c9,type:type=_0xda9014(0x1d7),testData:_0x17c082}=_0x6ece20[_0xda9014(0x1d9)];if(!_0x4369c9)return _0x5b8043[_0xda9014(0x1f2)](0x190)['json']({'success':![],'message':_0xda9014(0x1bf)});const _0x1cbffd=await database_1[_0xda9014(0x1e4)]['shop'][_0xda9014(0x1c0)]({'where':{'id':_0x4369c9},'select':{'id':!![],'name':!![]}});if(!_0x1cbffd)return _0x5b8043[_0xda9014(0x1f2)](0x194)[_0xda9014(0x1c9)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0xda9014(0x1d7):const _0x385808={'id':'test_payment_123','amount':_0x17c082?.[_0xda9014(0x1b5)]||0x64,'currency':_0x17c082?.[_0xda9014(0x1e6)]||_0xda9014(0x1d6),'productName':_0x17c082?.['productName']||'Test\x20Product','gateway':_0x17c082?.['gateway']||_0xda9014(0x1eb),'createdAt':new Date(),..._0x17c082};await telegramBotService_1[_0xda9014(0x1dc)]['sendPaymentNotification'](_0x4369c9,_0x385808,_0xda9014(0x1ba));break;case _0xda9014(0x1b2):const _0x55def5={'id':_0xda9014(0x1c3),'amount':_0x17c082?.[_0xda9014(0x1b5)]||0x1f4,'method':_0x17c082?.[_0xda9014(0x1cf)]||_0xda9014(0x1cb),'createdAt':new Date(),..._0x17c082};await telegramBotService_1[_0xda9014(0x1dc)][_0xda9014(0x1f4)](_0x4369c9,_0x55def5,_0xda9014(0x1d5));break;case _0xda9014(0x1dd):await telegramBotService_1[_0xda9014(0x1dc)][_0xda9014(0x1cc)](_0x4369c9,_0x17c082?.[_0xda9014(0x1bc)]||_0xda9014(0x1e0),_0x17c082?.['details']||{'message':_0xda9014(0x1f0)});break;default:return _0x5b8043[_0xda9014(0x1f2)](0x190)[_0xda9014(0x1c9)]({'success':![],'message':_0xda9014(0x1b9)});}_0x5b8043[_0xda9014(0x1c9)]({'success':!![],'message':_0xda9014(0x1b7)+type+_0xda9014(0x1b1)});}catch(_0x5e817f){_0x1feee4(_0x5e817f);}};}}exports[a12_0x18892a(0x1d4)]=TelegramController;