'use strict';function a12_0xa6ee(){const _0xbef25c=['Shop\x20ID\x20is\x20required','query','telegramId','update','updatedAt','sendPaymentNotification','length','isActive','params','Shop\x20not\x20found','bank_transfer','User\x20disconnected\x20successfully','Markdown','createdAt','Telegram\x20user\x20not\x20found','Test\x20Product','isVerified','sendShopNotification','status','lastName','defineProperty','telegramBotService','filter','title','__esModule','2185372OKmSKa','getBotStatus','shopId','sendTestNotification','body','method','groupBy','sendBroadcast','../services/telegramBotService','details','193416dRChxG','5081286jVOoFp','firstName','plisio','Broadcast\x20message\x20sent\x20successfully','paid','../config/database','completed','amount','test_payment_123','default','findUnique','findMany','1756320vFJmnp','This\x20is\x20a\x20test\x20notification','custom','sendCustomNotification','map','20785304fOtyNe','Test\x20','test_payout_123','sendPayoutNotification','count','username','1yuwNvE','shop','gateway','telegramUser','1923945lpQMkz','json','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','TelegramController','payment','1416930JYdJYe'];a12_0xa6ee=function(){return _0xbef25c;};return a12_0xa6ee();}const a12_0x4a4a11=a12_0x28f4;(function(_0x15de78,_0x3b3731){const _0x36119e=a12_0x28f4,_0x1e60c8=_0x15de78();while(!![]){try{const _0x52bcf2=parseInt(_0x36119e(0x11c))/0x1*(parseInt(_0x36119e(0x104))/0x2)+-parseInt(_0x36119e(0xe0))/0x3+-parseInt(_0x36119e(0xfa))/0x4+-parseInt(_0x36119e(0xdb))/0x5+parseInt(_0x36119e(0x111))/0x6+-parseInt(_0x36119e(0x105))/0x7+parseInt(_0x36119e(0x116))/0x8;if(_0x52bcf2===_0x3b3731)break;else _0x1e60c8['push'](_0x1e60c8['shift']());}catch(_0x1df245){_0x1e60c8['push'](_0x1e60c8['shift']());}}}(a12_0xa6ee,0xd188b));var __importDefault=this&&this['__importDefault']||function(_0x472251){const _0x37f9f5=a12_0x28f4;return _0x472251&&_0x472251[_0x37f9f5(0xf9)]?_0x472251:{'default':_0x472251};};function a12_0x28f4(_0x419f8d,_0x374897){const _0xa6ee2e=a12_0xa6ee();return a12_0x28f4=function(_0x28f4d9,_0x3acdd4){_0x28f4d9=_0x28f4d9-0xda;let _0x37069f=_0xa6ee2e[_0x28f4d9];return _0x37069f;},a12_0x28f4(_0x419f8d,_0x374897);}Object[a12_0x4a4a11(0xf5)](exports,a12_0x4a4a11(0xf9),{'value':!![]}),exports[a12_0x4a4a11(0xde)]=void 0x0;const telegramBotService_1=require(a12_0x4a4a11(0x102)),database_1=__importDefault(require(a12_0x4a4a11(0x10a)));class TelegramController{constructor(){const _0x26f83f=a12_0x4a4a11;this[_0x26f83f(0xfb)]=async(_0x502d60,_0x167780,_0x336f3c)=>{const _0x8269b7=_0x26f83f;try{const _0x5928ed=telegramBotService_1['telegramBotService']['getBotInfo'](),_0x2eb3d3=await database_1['default'][_0x8269b7(0xda)]['count'](),_0x2fe784=await database_1['default'][_0x8269b7(0xda)][_0x8269b7(0x11a)]({'where':{'isVerified':!![]}}),_0x61784a=await database_1[_0x8269b7(0x10e)][_0x8269b7(0xda)][_0x8269b7(0x100)]({'by':[_0x8269b7(0xfc)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x167780[_0x8269b7(0xdc)]({'success':!![],'result':{'bot':{'isActive':_0x5928ed[_0x8269b7(0xe8)],'username':_0x5928ed[_0x8269b7(0x11b)]},'statistics':{'totalUsers':_0x2eb3d3,'verifiedUsers':_0x2fe784,'unverifiedUsers':_0x2eb3d3-_0x2fe784,'connectedShops':_0x61784a[_0x8269b7(0xe7)]}}});}catch(_0x46d379){_0x336f3c(_0x46d379);}},this['getTelegramUsers']=async(_0x52801a,_0x25dca3,_0x5448f3)=>{const _0x3d3555=_0x26f83f;try{const {page:page=0x1,limit:limit=0x14,verified:_0x40498e}=_0x52801a[_0x3d3555(0xe2)],_0x2bc6ee=(Number(page)-0x1)*Number(limit),_0x5b5df7={};_0x40498e!==undefined&&(_0x5b5df7[_0x3d3555(0xf1)]=_0x40498e==='true');const [_0x158f6f,_0x4b29ff]=await Promise['all']([database_1[_0x3d3555(0x10e)][_0x3d3555(0xda)][_0x3d3555(0x110)]({'where':_0x5b5df7,'skip':_0x2bc6ee,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x3d3555(0xda)]['count']({'where':_0x5b5df7})]);_0x25dca3[_0x3d3555(0xdc)]({'success':!![],'users':_0x158f6f[_0x3d3555(0x115)](_0x52ab0d=>({'id':_0x52ab0d['id'],'telegramId':_0x52ab0d[_0x3d3555(0xe3)],'username':_0x52ab0d[_0x3d3555(0x11b)],'firstName':_0x52ab0d[_0x3d3555(0x106)],'lastName':_0x52ab0d[_0x3d3555(0xf4)],'isVerified':_0x52ab0d['isVerified'],'shop':_0x52ab0d[_0x3d3555(0x11d)],'createdAt':_0x52ab0d[_0x3d3555(0xee)],'updatedAt':_0x52ab0d[_0x3d3555(0xe5)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x4b29ff,'totalPages':Math['ceil'](_0x4b29ff/Number(limit))}});}catch(_0x4e6ccb){_0x5448f3(_0x4e6ccb);}},this[_0x26f83f(0x101)]=async(_0x193872,_0x2064e0,_0x8ab97b)=>{const _0x1eb24d=_0x26f83f;try{const {message:_0xc9d53e,shopId:_0x17566f}=_0x193872[_0x1eb24d(0xfe)];if(!_0xc9d53e)return _0x2064e0['status'](0x190)[_0x1eb24d(0xdc)]({'success':![],'message':'Message\x20is\x20required'});if(_0x17566f)await telegramBotService_1[_0x1eb24d(0xf6)][_0x1eb24d(0xf2)](_0x17566f,_0xc9d53e,{'parse_mode':_0x1eb24d(0xed)});else{const _0x44a70f=await database_1[_0x1eb24d(0x10e)]['telegramUser'][_0x1eb24d(0x110)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x206667=[...new Set(_0x44a70f[_0x1eb24d(0x115)](_0xcbd225=>_0xcbd225[_0x1eb24d(0xfc)])[_0x1eb24d(0xf7)](Boolean))];for(const _0x45e77c of _0x206667){_0x45e77c&&await telegramBotService_1[_0x1eb24d(0xf6)]['sendShopNotification'](_0x45e77c,_0xc9d53e,{'parse_mode':'Markdown'});}}_0x2064e0[_0x1eb24d(0xdc)]({'success':!![],'message':_0x1eb24d(0x108)});}catch(_0x1170c4){_0x8ab97b(_0x1170c4);}},this['disconnectUser']=async(_0x46a144,_0x1b54f8,_0x51e265)=>{const _0x4c0d31=_0x26f83f;try{const {telegramId:_0x30d5e0}=_0x46a144[_0x4c0d31(0xe9)],_0x8b95c2=await database_1['default'][_0x4c0d31(0xda)][_0x4c0d31(0x10f)]({'where':{'telegramId':_0x30d5e0},'include':{'shop':!![]}});if(!_0x8b95c2)return _0x1b54f8[_0x4c0d31(0xf3)](0x194)[_0x4c0d31(0xdc)]({'success':![],'message':_0x4c0d31(0xef)});await database_1[_0x4c0d31(0x10e)][_0x4c0d31(0xda)][_0x4c0d31(0xe4)]({'where':{'telegramId':_0x30d5e0},'data':{'shopId':null,'isVerified':![]}}),_0x1b54f8[_0x4c0d31(0xdc)]({'success':!![],'message':_0x4c0d31(0xec)});}catch(_0x5a2012){_0x51e265(_0x5a2012);}},this[_0x26f83f(0xfd)]=async(_0x129dca,_0x3fc86c,_0x3a887b)=>{const _0x21658d=_0x26f83f;try{const {shopId:_0x253be6,type:type=_0x21658d(0xdf),testData:_0x161a6c}=_0x129dca[_0x21658d(0xfe)];if(!_0x253be6)return _0x3fc86c[_0x21658d(0xf3)](0x190)['json']({'success':![],'message':_0x21658d(0xe1)});const _0x242de0=await database_1[_0x21658d(0x10e)][_0x21658d(0x11d)][_0x21658d(0x10f)]({'where':{'id':_0x253be6},'select':{'id':!![],'name':!![]}});if(!_0x242de0)return _0x3fc86c[_0x21658d(0xf3)](0x194)[_0x21658d(0xdc)]({'success':![],'message':_0x21658d(0xea)});switch(type){case _0x21658d(0xdf):const _0x2e6de6={'id':_0x21658d(0x10d),'amount':_0x161a6c?.[_0x21658d(0x10c)]||0x64,'currency':_0x161a6c?.['currency']||'USD','productName':_0x161a6c?.['productName']||_0x21658d(0xf0),'gateway':_0x161a6c?.[_0x21658d(0x11e)]||_0x21658d(0x107),'createdAt':new Date(),..._0x161a6c};await telegramBotService_1['telegramBotService'][_0x21658d(0xe6)](_0x253be6,_0x2e6de6,_0x21658d(0x109));break;case'payout':const _0x171d57={'id':_0x21658d(0x118),'amount':_0x161a6c?.['amount']||0x1f4,'method':_0x161a6c?.[_0x21658d(0xff)]||_0x21658d(0xeb),'createdAt':new Date(),..._0x161a6c};await telegramBotService_1[_0x21658d(0xf6)][_0x21658d(0x119)](_0x253be6,_0x171d57,_0x21658d(0x10b));break;case _0x21658d(0x113):await telegramBotService_1[_0x21658d(0xf6)][_0x21658d(0x114)](_0x253be6,_0x161a6c?.[_0x21658d(0xf8)]||'Test\x20Notification',_0x161a6c?.[_0x21658d(0x103)]||{'message':_0x21658d(0x112)});break;default:return _0x3fc86c[_0x21658d(0xf3)](0x190)[_0x21658d(0xdc)]({'success':![],'message':_0x21658d(0xdd)});}_0x3fc86c[_0x21658d(0xdc)]({'success':!![],'message':_0x21658d(0x117)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x12dc4c){_0x3a887b(_0x12dc4c);}};}}exports[a12_0x4a4a11(0xde)]=TelegramController;