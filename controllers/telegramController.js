'use strict';function a12_0x2bd5(){const _0x11d2ec=['groupBy','This\x20is\x20a\x20test\x20notification','sendPayoutNotification','sendTestNotification','json','Test\x20','all','default','title','telegramUser','findMany','sendBroadcast','findUnique','1106070UYiSow','test_payout_123','true','body','desc','__importDefault','test_payment_123','6DfxHxA','3416aeVkSL','Message\x20is\x20required','query','disconnectUser','6TYopkt','248320zoMdiI','status','amount','20700SjasOG','createdAt','gateway','productName','payout','paid','isActive','TelegramController','getBotInfo','custom','details','sendShopNotification','lastName','update','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','plisio','ceil','defineProperty','Test\x20Notification','currency','sendPaymentNotification','129556sFTENw','count','shop','bank_transfer','Broadcast\x20message\x20sent\x20successfully','method','completed','telegramBotService','Shop\x20ID\x20is\x20required','getTelegramUsers','3239325QziiLY','../services/telegramBotService','payment','map','128NURcJt','shopId','__esModule','username','sendCustomNotification','Shop\x20not\x20found','\x20notification\x20sent\x20successfully','USD','Telegram\x20user\x20not\x20found','updatedAt','414340FoJaoG','isVerified','Markdown'];a12_0x2bd5=function(){return _0x11d2ec;};return a12_0x2bd5();}const a12_0x1a3d44=a12_0x2982;(function(_0x4949ba,_0x478fb9){const _0x1881f=a12_0x2982,_0x362b0a=_0x4949ba();while(!![]){try{const _0x283f20=parseInt(_0x1881f(0x1fa))/0x1*(-parseInt(_0x1881f(0x1fe))/0x2)+parseInt(_0x1881f(0x1f9))/0x3*(parseInt(_0x1881f(0x1ff))/0x4)+-parseInt(_0x1881f(0x22f))/0x5+parseInt(_0x1881f(0x202))/0x6+parseInt(_0x1881f(0x217))/0x7*(-parseInt(_0x1881f(0x225))/0x8)+parseInt(_0x1881f(0x221))/0x9+parseInt(_0x1881f(0x1f2))/0xa;if(_0x283f20===_0x478fb9)break;else _0x362b0a['push'](_0x362b0a['shift']());}catch(_0x246ce9){_0x362b0a['push'](_0x362b0a['shift']());}}}(a12_0x2bd5,0x33002));function a12_0x2982(_0x782566,_0x4a9b5c){const _0x2bd570=a12_0x2bd5();return a12_0x2982=function(_0x2982a0,_0x57d5f5){_0x2982a0=_0x2982a0-0x1f0;let _0x3bb21c=_0x2bd570[_0x2982a0];return _0x3bb21c;},a12_0x2982(_0x782566,_0x4a9b5c);}var __importDefault=this&&this[a12_0x1a3d44(0x1f7)]||function(_0x1c3a65){const _0x5061c5=a12_0x1a3d44;return _0x1c3a65&&_0x1c3a65[_0x5061c5(0x227)]?_0x1c3a65:{'default':_0x1c3a65};};Object[a12_0x1a3d44(0x213)](exports,'__esModule',{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x1a3d44(0x222)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x139275=a12_0x1a3d44;this['getBotStatus']=async(_0x24bf9d,_0x5357ed,_0x4ac550)=>{const _0x5a7232=a12_0x2982;try{const _0x301700=telegramBotService_1[_0x5a7232(0x21e)][_0x5a7232(0x20a)](),_0x3126c5=await database_1[_0x5a7232(0x239)][_0x5a7232(0x23b)][_0x5a7232(0x218)](),_0x2c2433=await database_1[_0x5a7232(0x239)]['telegramUser'][_0x5a7232(0x218)]({'where':{'isVerified':!![]}}),_0x54b280=await database_1['default']['telegramUser'][_0x5a7232(0x232)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5357ed[_0x5a7232(0x236)]({'success':!![],'result':{'bot':{'isActive':_0x301700[_0x5a7232(0x208)],'username':_0x301700[_0x5a7232(0x228)]},'statistics':{'totalUsers':_0x3126c5,'verifiedUsers':_0x2c2433,'unverifiedUsers':_0x3126c5-_0x2c2433,'connectedShops':_0x54b280['length']}}});}catch(_0x4c8ab4){_0x4ac550(_0x4c8ab4);}},this[_0x139275(0x220)]=async(_0x13e552,_0x55098b,_0xed665d)=>{const _0x3098ab=_0x139275;try{const {page:page=0x1,limit:limit=0x14,verified:_0x24e1c6}=_0x13e552[_0x3098ab(0x1fc)],_0x4192f1=(Number(page)-0x1)*Number(limit),_0x54a0fd={};_0x24e1c6!==undefined&&(_0x54a0fd[_0x3098ab(0x230)]=_0x24e1c6===_0x3098ab(0x1f4));const [_0xee467a,_0x2cbf47]=await Promise[_0x3098ab(0x238)]([database_1['default'][_0x3098ab(0x23b)][_0x3098ab(0x23c)]({'where':_0x54a0fd,'skip':_0x4192f1,'take':Number(limit),'orderBy':{'createdAt':_0x3098ab(0x1f6)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x3098ab(0x239)]['telegramUser'][_0x3098ab(0x218)]({'where':_0x54a0fd})]);_0x55098b[_0x3098ab(0x236)]({'success':!![],'users':_0xee467a[_0x3098ab(0x224)](_0x28c2f9=>({'id':_0x28c2f9['id'],'telegramId':_0x28c2f9['telegramId'],'username':_0x28c2f9[_0x3098ab(0x228)],'firstName':_0x28c2f9['firstName'],'lastName':_0x28c2f9[_0x3098ab(0x20e)],'isVerified':_0x28c2f9[_0x3098ab(0x230)],'shop':_0x28c2f9['shop'],'createdAt':_0x28c2f9[_0x3098ab(0x203)],'updatedAt':_0x28c2f9[_0x3098ab(0x22e)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2cbf47,'totalPages':Math[_0x3098ab(0x212)](_0x2cbf47/Number(limit))}});}catch(_0x5b8662){_0xed665d(_0x5b8662);}},this[_0x139275(0x1f0)]=async(_0x481d94,_0x3a18be,_0xfc0aed)=>{const _0x1e1ccf=_0x139275;try{const {message:_0x56d8f0,shopId:_0x2dcd56}=_0x481d94[_0x1e1ccf(0x1f5)];if(!_0x56d8f0)return _0x3a18be[_0x1e1ccf(0x200)](0x190)[_0x1e1ccf(0x236)]({'success':![],'message':_0x1e1ccf(0x1fb)});if(_0x2dcd56)await telegramBotService_1[_0x1e1ccf(0x21e)][_0x1e1ccf(0x20d)](_0x2dcd56,_0x56d8f0,{'parse_mode':'Markdown'});else{const _0x3cf05f=await database_1[_0x1e1ccf(0x239)][_0x1e1ccf(0x23b)][_0x1e1ccf(0x23c)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2932e3=[...new Set(_0x3cf05f[_0x1e1ccf(0x224)](_0x253335=>_0x253335[_0x1e1ccf(0x226)])['filter'](Boolean))];for(const _0x3a4604 of _0x2932e3){_0x3a4604&&await telegramBotService_1[_0x1e1ccf(0x21e)][_0x1e1ccf(0x20d)](_0x3a4604,_0x56d8f0,{'parse_mode':_0x1e1ccf(0x231)});}}_0x3a18be[_0x1e1ccf(0x236)]({'success':!![],'message':_0x1e1ccf(0x21b)});}catch(_0x1e29f0){_0xfc0aed(_0x1e29f0);}},this[_0x139275(0x1fd)]=async(_0x60ce89,_0x39001f,_0x132a67)=>{const _0x274caf=_0x139275;try{const {telegramId:_0x1f9e87}=_0x60ce89['params'],_0xe7f3d3=await database_1['default'][_0x274caf(0x23b)][_0x274caf(0x1f1)]({'where':{'telegramId':_0x1f9e87},'include':{'shop':!![]}});if(!_0xe7f3d3)return _0x39001f[_0x274caf(0x200)](0x194)['json']({'success':![],'message':_0x274caf(0x22d)});await database_1[_0x274caf(0x239)]['telegramUser'][_0x274caf(0x20f)]({'where':{'telegramId':_0x1f9e87},'data':{'shopId':null,'isVerified':![]}}),_0x39001f[_0x274caf(0x236)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x52b16a){_0x132a67(_0x52b16a);}},this[_0x139275(0x235)]=async(_0x41c2ae,_0x28362f,_0x2b1cbe)=>{const _0x15945a=_0x139275;try{const {shopId:_0x154325,type:type=_0x15945a(0x223),testData:_0x2db0c0}=_0x41c2ae[_0x15945a(0x1f5)];if(!_0x154325)return _0x28362f[_0x15945a(0x200)](0x190)['json']({'success':![],'message':_0x15945a(0x21f)});const _0x1bde69=await database_1[_0x15945a(0x239)][_0x15945a(0x219)][_0x15945a(0x1f1)]({'where':{'id':_0x154325},'select':{'id':!![],'name':!![]}});if(!_0x1bde69)return _0x28362f[_0x15945a(0x200)](0x194)[_0x15945a(0x236)]({'success':![],'message':_0x15945a(0x22a)});switch(type){case _0x15945a(0x223):const _0x1926f6={'id':_0x15945a(0x1f8),'amount':_0x2db0c0?.[_0x15945a(0x201)]||0x64,'currency':_0x2db0c0?.[_0x15945a(0x215)]||_0x15945a(0x22c),'productName':_0x2db0c0?.[_0x15945a(0x205)]||'Test\x20Product','gateway':_0x2db0c0?.[_0x15945a(0x204)]||_0x15945a(0x211),'createdAt':new Date(),..._0x2db0c0};await telegramBotService_1[_0x15945a(0x21e)][_0x15945a(0x216)](_0x154325,_0x1926f6,_0x15945a(0x207));break;case _0x15945a(0x206):const _0x460f5d={'id':_0x15945a(0x1f3),'amount':_0x2db0c0?.[_0x15945a(0x201)]||0x1f4,'method':_0x2db0c0?.[_0x15945a(0x21c)]||_0x15945a(0x21a),'createdAt':new Date(),..._0x2db0c0};await telegramBotService_1[_0x15945a(0x21e)][_0x15945a(0x234)](_0x154325,_0x460f5d,_0x15945a(0x21d));break;case _0x15945a(0x20b):await telegramBotService_1[_0x15945a(0x21e)][_0x15945a(0x229)](_0x154325,_0x2db0c0?.[_0x15945a(0x23a)]||_0x15945a(0x214),_0x2db0c0?.[_0x15945a(0x20c)]||{'message':_0x15945a(0x233)});break;default:return _0x28362f['status'](0x190)[_0x15945a(0x236)]({'success':![],'message':_0x15945a(0x210)});}_0x28362f['json']({'success':!![],'message':_0x15945a(0x237)+type+_0x15945a(0x22b)});}catch(_0x1a1205){_0x2b1cbe(_0x1a1205);}};}}exports[a12_0x1a3d44(0x209)]=TelegramController;