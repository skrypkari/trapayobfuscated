'use strict';const a12_0x35ca17=a12_0x3036;(function(_0x2344f9,_0x4041cb){const _0x2b6204=a12_0x3036,_0x1957ba=_0x2344f9();while(!![]){try{const _0x1c66bc=-parseInt(_0x2b6204(0x1f6))/0x1+-parseInt(_0x2b6204(0x1d2))/0x2*(parseInt(_0x2b6204(0x1f7))/0x3)+-parseInt(_0x2b6204(0x1e3))/0x4+-parseInt(_0x2b6204(0x202))/0x5+parseInt(_0x2b6204(0x1e1))/0x6*(-parseInt(_0x2b6204(0x1cb))/0x7)+-parseInt(_0x2b6204(0x1c1))/0x8*(parseInt(_0x2b6204(0x1cd))/0x9)+-parseInt(_0x2b6204(0x1fd))/0xa*(-parseInt(_0x2b6204(0x1ef))/0xb);if(_0x1c66bc===_0x4041cb)break;else _0x1957ba['push'](_0x1957ba['shift']());}catch(_0x15ec20){_0x1957ba['push'](_0x1957ba['shift']());}}}(a12_0x3b9a,0x9310f));function a12_0x3b9a(){const _0x44e516=['4690500RubHsU','TelegramController','payout','filter','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','8020216FRJzpM','count','shop','gateway','Shop\x20not\x20found','status','ceil','telegramUser','This\x20is\x20a\x20test\x20notification','amount','749TULVcw','../services/telegramBotService','9QsjhUT','shopId','sendPayoutNotification','username','createdAt','701466JhZNXb','Broadcast\x20message\x20sent\x20successfully','Test\x20Product','paid','Message\x20is\x20required','firstName','true','User\x20disconnected\x20successfully','../config/database','method','\x20notification\x20sent\x20successfully','sendPaymentNotification','getBotStatus','findMany','update','39342nwbZvO','isVerified','864312NgzgKP','disconnectUser','default','sendCustomNotification','sendShopNotification','title','getBotInfo','desc','Markdown','test_payment_123','custom','length','59810773PWBICV','query','__importDefault','sendTestNotification','json','telegramId','isActive','924457mHwlfT','9MitaPK','completed','findUnique','Test\x20Notification','all','currency','10KsfXDg','productName','groupBy','telegramBotService','updatedAt'];a12_0x3b9a=function(){return _0x44e516;};return a12_0x3b9a();}var __importDefault=this&&this[a12_0x35ca17(0x1f1)]||function(_0x244dcf){return _0x244dcf&&_0x244dcf['__esModule']?_0x244dcf:{'default':_0x244dcf};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a12_0x35ca17(0x203)]=void 0x0;const telegramBotService_1=require(a12_0x35ca17(0x1cc)),database_1=__importDefault(require(a12_0x35ca17(0x1da)));class TelegramController{constructor(){const _0x3e9089=a12_0x35ca17;this[_0x3e9089(0x1de)]=async(_0x1dd355,_0x1307be,_0x3d67f0)=>{const _0x9cf39e=_0x3e9089;try{const _0x58b190=telegramBotService_1[_0x9cf39e(0x200)][_0x9cf39e(0x1e9)](),_0x4512b2=await database_1[_0x9cf39e(0x1e5)][_0x9cf39e(0x1c8)]['count'](),_0x1a75d6=await database_1[_0x9cf39e(0x1e5)][_0x9cf39e(0x1c8)][_0x9cf39e(0x1c2)]({'where':{'isVerified':!![]}}),_0x28f773=await database_1[_0x9cf39e(0x1e5)][_0x9cf39e(0x1c8)][_0x9cf39e(0x1ff)]({'by':[_0x9cf39e(0x1ce)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1307be[_0x9cf39e(0x1f3)]({'success':!![],'result':{'bot':{'isActive':_0x58b190[_0x9cf39e(0x1f5)],'username':_0x58b190[_0x9cf39e(0x1d0)]},'statistics':{'totalUsers':_0x4512b2,'verifiedUsers':_0x1a75d6,'unverifiedUsers':_0x4512b2-_0x1a75d6,'connectedShops':_0x28f773[_0x9cf39e(0x1ee)]}}});}catch(_0x1d60b5){_0x3d67f0(_0x1d60b5);}},this['getTelegramUsers']=async(_0x5ca608,_0x362973,_0x353bc3)=>{const _0x13f4b7=_0x3e9089;try{const {page:page=0x1,limit:limit=0x14,verified:_0x560f82}=_0x5ca608[_0x13f4b7(0x1f0)],_0x5a6760=(Number(page)-0x1)*Number(limit),_0x58a00b={};_0x560f82!==undefined&&(_0x58a00b['isVerified']=_0x560f82===_0x13f4b7(0x1d8));const [_0x1dd9de,_0x355db5]=await Promise[_0x13f4b7(0x1fb)]([database_1[_0x13f4b7(0x1e5)][_0x13f4b7(0x1c8)]['findMany']({'where':_0x58a00b,'skip':_0x5a6760,'take':Number(limit),'orderBy':{'createdAt':_0x13f4b7(0x1ea)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x13f4b7(0x1e5)]['telegramUser']['count']({'where':_0x58a00b})]);_0x362973[_0x13f4b7(0x1f3)]({'success':!![],'users':_0x1dd9de['map'](_0x562681=>({'id':_0x562681['id'],'telegramId':_0x562681[_0x13f4b7(0x1f4)],'username':_0x562681[_0x13f4b7(0x1d0)],'firstName':_0x562681[_0x13f4b7(0x1d7)],'lastName':_0x562681['lastName'],'isVerified':_0x562681[_0x13f4b7(0x1e2)],'shop':_0x562681[_0x13f4b7(0x1c3)],'createdAt':_0x562681[_0x13f4b7(0x1d1)],'updatedAt':_0x562681[_0x13f4b7(0x201)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x355db5,'totalPages':Math[_0x13f4b7(0x1c7)](_0x355db5/Number(limit))}});}catch(_0x1a405e){_0x353bc3(_0x1a405e);}},this['sendBroadcast']=async(_0xb74111,_0x2f7c90,_0x4a66b0)=>{const _0x2a1416=_0x3e9089;try{const {message:_0x3b228a,shopId:_0x26a06c}=_0xb74111['body'];if(!_0x3b228a)return _0x2f7c90[_0x2a1416(0x1c6)](0x190)[_0x2a1416(0x1f3)]({'success':![],'message':_0x2a1416(0x1d6)});if(_0x26a06c)await telegramBotService_1[_0x2a1416(0x200)][_0x2a1416(0x1e7)](_0x26a06c,_0x3b228a,{'parse_mode':'Markdown'});else{const _0x547369=await database_1[_0x2a1416(0x1e5)]['telegramUser'][_0x2a1416(0x1df)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x123ef6=[...new Set(_0x547369['map'](_0x15e266=>_0x15e266[_0x2a1416(0x1ce)])[_0x2a1416(0x1bf)](Boolean))];for(const _0x1e0d4d of _0x123ef6){_0x1e0d4d&&await telegramBotService_1[_0x2a1416(0x200)][_0x2a1416(0x1e7)](_0x1e0d4d,_0x3b228a,{'parse_mode':_0x2a1416(0x1eb)});}}_0x2f7c90['json']({'success':!![],'message':_0x2a1416(0x1d3)});}catch(_0x4eda69){_0x4a66b0(_0x4eda69);}},this[_0x3e9089(0x1e4)]=async(_0x52a166,_0x4dea0d,_0x45c7b7)=>{const _0xa05b52=_0x3e9089;try{const {telegramId:_0x4eda17}=_0x52a166['params'],_0x4d4b77=await database_1['default'][_0xa05b52(0x1c8)][_0xa05b52(0x1f9)]({'where':{'telegramId':_0x4eda17},'include':{'shop':!![]}});if(!_0x4d4b77)return _0x4dea0d[_0xa05b52(0x1c6)](0x194)[_0xa05b52(0x1f3)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0xa05b52(0x1e5)]['telegramUser'][_0xa05b52(0x1e0)]({'where':{'telegramId':_0x4eda17},'data':{'shopId':null,'isVerified':![]}}),_0x4dea0d[_0xa05b52(0x1f3)]({'success':!![],'message':_0xa05b52(0x1d9)});}catch(_0x22c6ed){_0x45c7b7(_0x22c6ed);}},this[_0x3e9089(0x1f2)]=async(_0x1f47ee,_0x1ab169,_0x17cfd9)=>{const _0x43c96d=_0x3e9089;try{const {shopId:_0xc74ab8,type:type='payment',testData:_0x2b7c7b}=_0x1f47ee['body'];if(!_0xc74ab8)return _0x1ab169[_0x43c96d(0x1c6)](0x190)[_0x43c96d(0x1f3)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x4b354b=await database_1[_0x43c96d(0x1e5)][_0x43c96d(0x1c3)][_0x43c96d(0x1f9)]({'where':{'id':_0xc74ab8},'select':{'id':!![],'name':!![]}});if(!_0x4b354b)return _0x1ab169['status'](0x194)[_0x43c96d(0x1f3)]({'success':![],'message':_0x43c96d(0x1c5)});switch(type){case'payment':const _0x456bff={'id':_0x43c96d(0x1ec),'amount':_0x2b7c7b?.['amount']||0x64,'currency':_0x2b7c7b?.[_0x43c96d(0x1fc)]||'USD','productName':_0x2b7c7b?.[_0x43c96d(0x1fe)]||_0x43c96d(0x1d4),'gateway':_0x2b7c7b?.[_0x43c96d(0x1c4)]||'plisio','createdAt':new Date(),..._0x2b7c7b};await telegramBotService_1['telegramBotService'][_0x43c96d(0x1dd)](_0xc74ab8,_0x456bff,_0x43c96d(0x1d5));break;case _0x43c96d(0x204):const _0x43da88={'id':'test_payout_123','amount':_0x2b7c7b?.[_0x43c96d(0x1ca)]||0x1f4,'method':_0x2b7c7b?.[_0x43c96d(0x1db)]||'bank_transfer','createdAt':new Date(),..._0x2b7c7b};await telegramBotService_1[_0x43c96d(0x200)][_0x43c96d(0x1cf)](_0xc74ab8,_0x43da88,_0x43c96d(0x1f8));break;case _0x43c96d(0x1ed):await telegramBotService_1[_0x43c96d(0x200)][_0x43c96d(0x1e6)](_0xc74ab8,_0x2b7c7b?.[_0x43c96d(0x1e8)]||_0x43c96d(0x1fa),_0x2b7c7b?.['details']||{'message':_0x43c96d(0x1c9)});break;default:return _0x1ab169[_0x43c96d(0x1c6)](0x190)[_0x43c96d(0x1f3)]({'success':![],'message':_0x43c96d(0x1c0)});}_0x1ab169[_0x43c96d(0x1f3)]({'success':!![],'message':'Test\x20'+type+_0x43c96d(0x1dc)});}catch(_0x4b94a4){_0x17cfd9(_0x4b94a4);}};}}function a12_0x3036(_0x38b5e2,_0x42cb41){const _0x3b9a77=a12_0x3b9a();return a12_0x3036=function(_0x3036e,_0x11fc81){_0x3036e=_0x3036e-0x1bf;let _0x203183=_0x3b9a77[_0x3036e];return _0x203183;},a12_0x3036(_0x38b5e2,_0x42cb41);}exports[a12_0x35ca17(0x203)]=TelegramController;