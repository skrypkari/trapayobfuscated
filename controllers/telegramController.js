'use strict';const a12_0x566439=a12_0x4b9e;function a12_0x4b9e(_0x9dad76,_0x367b7d){const _0x5c23dc=a12_0x5c23();return a12_0x4b9e=function(_0x4b9ea1,_0x2ba2d5){_0x4b9ea1=_0x4b9ea1-0x1de;let _0x5ce0f0=_0x5c23dc[_0x4b9ea1];return _0x5ce0f0;},a12_0x4b9e(_0x9dad76,_0x367b7d);}(function(_0x24c1c0,_0x563db0){const _0x1b2912=a12_0x4b9e,_0x4b9743=_0x24c1c0();while(!![]){try{const _0x18523e=-parseInt(_0x1b2912(0x215))/0x1*(parseInt(_0x1b2912(0x1e4))/0x2)+-parseInt(_0x1b2912(0x201))/0x3+-parseInt(_0x1b2912(0x1f2))/0x4*(parseInt(_0x1b2912(0x21c))/0x5)+-parseInt(_0x1b2912(0x1e9))/0x6+-parseInt(_0x1b2912(0x1ff))/0x7+parseInt(_0x1b2912(0x206))/0x8*(parseInt(_0x1b2912(0x20c))/0x9)+parseInt(_0x1b2912(0x1e0))/0xa;if(_0x18523e===_0x563db0)break;else _0x4b9743['push'](_0x4b9743['shift']());}catch(_0x4f97b2){_0x4b9743['push'](_0x4b9743['shift']());}}}(a12_0x5c23,0xe705f));var __importDefault=this&&this['__importDefault']||function(_0x733c10){const _0x4aadf4=a12_0x4b9e;return _0x733c10&&_0x733c10[_0x4aadf4(0x204)]?_0x733c10:{'default':_0x733c10};};Object[a12_0x566439(0x1ea)](exports,a12_0x566439(0x204),{'value':!![]}),exports[a12_0x566439(0x223)]=void 0x0;const telegramBotService_1=require(a12_0x566439(0x205)),database_1=__importDefault(require(a12_0x566439(0x1f9)));function a12_0x5c23(){const _0x3e2e28=['shop','count','1151452uUSQGD','productName','Test\x20','true','plisio','title','Test\x20Notification','../config/database','currency','shopId','test_payment_123','json','telegramUser','8047501pIZKct','test_payout_123','4780788FTFTKH','isActive','status','__esModule','../services/telegramBotService','1538440vqtOiQ','desc','findUnique','telegramId','Test\x20Product','firstName','72uWBPMb','update','completed','map','sendBroadcast','Shop\x20ID\x20is\x20required','method','payment','getBotInfo','33dPIeiX','updatedAt','sendPayoutNotification','groupBy','filter','Shop\x20not\x20found','Broadcast\x20message\x20sent\x20successfully','5jwMEkQ','username','findMany','body','getBotStatus','amount','ceil','TelegramController','gateway','default','33418800RkFDoe','Markdown','custom','isVerified','21674PPOqvz','query','This\x20is\x20a\x20test\x20notification','\x20notification\x20sent\x20successfully','bank_transfer','3271956ZjKHKB','defineProperty','paid','sendTestNotification','length','telegramBotService','lastName'];a12_0x5c23=function(){return _0x3e2e28;};return a12_0x5c23();}class TelegramController{constructor(){const _0x7d44c2=a12_0x566439;this[_0x7d44c2(0x220)]=async(_0x5ec648,_0x3a6a30,_0x2956a8)=>{const _0x305d29=_0x7d44c2;try{const _0x4381f7=telegramBotService_1[_0x305d29(0x1ee)][_0x305d29(0x214)](),_0x1bd047=await database_1['default'][_0x305d29(0x1fe)][_0x305d29(0x1f1)](),_0x1b23f5=await database_1[_0x305d29(0x1df)][_0x305d29(0x1fe)][_0x305d29(0x1f1)]({'where':{'isVerified':!![]}}),_0x3e08ff=await database_1[_0x305d29(0x1df)]['telegramUser'][_0x305d29(0x218)]({'by':[_0x305d29(0x1fb)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3a6a30[_0x305d29(0x1fd)]({'success':!![],'result':{'bot':{'isActive':_0x4381f7[_0x305d29(0x202)],'username':_0x4381f7[_0x305d29(0x21d)]},'statistics':{'totalUsers':_0x1bd047,'verifiedUsers':_0x1b23f5,'unverifiedUsers':_0x1bd047-_0x1b23f5,'connectedShops':_0x3e08ff[_0x305d29(0x1ed)]}}});}catch(_0x381dd7){_0x2956a8(_0x381dd7);}},this['getTelegramUsers']=async(_0x505d53,_0x3ca15e,_0x173803)=>{const _0x26617c=_0x7d44c2;try{const {page:page=0x1,limit:limit=0x14,verified:_0xfbd002}=_0x505d53[_0x26617c(0x1e5)],_0x64cc12=(Number(page)-0x1)*Number(limit),_0x47d2d7={};_0xfbd002!==undefined&&(_0x47d2d7[_0x26617c(0x1e3)]=_0xfbd002===_0x26617c(0x1f5));const [_0x2d8962,_0x41faf0]=await Promise['all']([database_1[_0x26617c(0x1df)][_0x26617c(0x1fe)][_0x26617c(0x21e)]({'where':_0x47d2d7,'skip':_0x64cc12,'take':Number(limit),'orderBy':{'createdAt':_0x26617c(0x207)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x26617c(0x1df)]['telegramUser'][_0x26617c(0x1f1)]({'where':_0x47d2d7})]);_0x3ca15e[_0x26617c(0x1fd)]({'success':!![],'users':_0x2d8962['map'](_0x66e9f5=>({'id':_0x66e9f5['id'],'telegramId':_0x66e9f5[_0x26617c(0x209)],'username':_0x66e9f5[_0x26617c(0x21d)],'firstName':_0x66e9f5[_0x26617c(0x20b)],'lastName':_0x66e9f5[_0x26617c(0x1ef)],'isVerified':_0x66e9f5[_0x26617c(0x1e3)],'shop':_0x66e9f5[_0x26617c(0x1f0)],'createdAt':_0x66e9f5['createdAt'],'updatedAt':_0x66e9f5[_0x26617c(0x216)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x41faf0,'totalPages':Math[_0x26617c(0x222)](_0x41faf0/Number(limit))}});}catch(_0x3bc70a){_0x173803(_0x3bc70a);}},this[_0x7d44c2(0x210)]=async(_0x39fadf,_0x346569,_0x1734cc)=>{const _0x87d401=_0x7d44c2;try{const {message:_0x7fc1ab,shopId:_0xf26772}=_0x39fadf[_0x87d401(0x21f)];if(!_0x7fc1ab)return _0x346569[_0x87d401(0x203)](0x190)[_0x87d401(0x1fd)]({'success':![],'message':'Message\x20is\x20required'});if(_0xf26772)await telegramBotService_1[_0x87d401(0x1ee)]['sendShopNotification'](_0xf26772,_0x7fc1ab,{'parse_mode':_0x87d401(0x1e1)});else{const _0x332280=await database_1[_0x87d401(0x1df)][_0x87d401(0x1fe)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xc13f9c=[...new Set(_0x332280[_0x87d401(0x20f)](_0x2a7a1d=>_0x2a7a1d['shopId'])[_0x87d401(0x219)](Boolean))];for(const _0x2147f2 of _0xc13f9c){_0x2147f2&&await telegramBotService_1[_0x87d401(0x1ee)]['sendShopNotification'](_0x2147f2,_0x7fc1ab,{'parse_mode':_0x87d401(0x1e1)});}}_0x346569[_0x87d401(0x1fd)]({'success':!![],'message':_0x87d401(0x21b)});}catch(_0x3ab055){_0x1734cc(_0x3ab055);}},this['disconnectUser']=async(_0x525a11,_0x2fd13b,_0x7e9ae1)=>{const _0x352218=_0x7d44c2;try{const {telegramId:_0x1f3b38}=_0x525a11['params'],_0x53f299=await database_1[_0x352218(0x1df)][_0x352218(0x1fe)]['findUnique']({'where':{'telegramId':_0x1f3b38},'include':{'shop':!![]}});if(!_0x53f299)return _0x2fd13b['status'](0x194)[_0x352218(0x1fd)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x352218(0x1df)][_0x352218(0x1fe)][_0x352218(0x20d)]({'where':{'telegramId':_0x1f3b38},'data':{'shopId':null,'isVerified':![]}}),_0x2fd13b[_0x352218(0x1fd)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x253202){_0x7e9ae1(_0x253202);}},this[_0x7d44c2(0x1ec)]=async(_0x4d2313,_0x347929,_0xdee7c9)=>{const _0x295568=_0x7d44c2;try{const {shopId:_0x2bd207,type:type='payment',testData:_0xeb9152}=_0x4d2313[_0x295568(0x21f)];if(!_0x2bd207)return _0x347929[_0x295568(0x203)](0x190)[_0x295568(0x1fd)]({'success':![],'message':_0x295568(0x211)});const _0x482f4d=await database_1[_0x295568(0x1df)][_0x295568(0x1f0)][_0x295568(0x208)]({'where':{'id':_0x2bd207},'select':{'id':!![],'name':!![]}});if(!_0x482f4d)return _0x347929[_0x295568(0x203)](0x194)['json']({'success':![],'message':_0x295568(0x21a)});switch(type){case _0x295568(0x213):const _0x40d8a7={'id':_0x295568(0x1fc),'amount':_0xeb9152?.[_0x295568(0x221)]||0x64,'currency':_0xeb9152?.[_0x295568(0x1fa)]||'USD','productName':_0xeb9152?.[_0x295568(0x1f3)]||_0x295568(0x20a),'gateway':_0xeb9152?.[_0x295568(0x1de)]||_0x295568(0x1f6),'createdAt':new Date(),..._0xeb9152};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x2bd207,_0x40d8a7,_0x295568(0x1eb));break;case'payout':const _0x4bf99e={'id':_0x295568(0x200),'amount':_0xeb9152?.[_0x295568(0x221)]||0x1f4,'method':_0xeb9152?.[_0x295568(0x212)]||_0x295568(0x1e8),'createdAt':new Date(),..._0xeb9152};await telegramBotService_1[_0x295568(0x1ee)][_0x295568(0x217)](_0x2bd207,_0x4bf99e,_0x295568(0x20e));break;case _0x295568(0x1e2):await telegramBotService_1[_0x295568(0x1ee)]['sendCustomNotification'](_0x2bd207,_0xeb9152?.[_0x295568(0x1f7)]||_0x295568(0x1f8),_0xeb9152?.['details']||{'message':_0x295568(0x1e6)});break;default:return _0x347929[_0x295568(0x203)](0x190)[_0x295568(0x1fd)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x347929[_0x295568(0x1fd)]({'success':!![],'message':_0x295568(0x1f4)+type+_0x295568(0x1e7)});}catch(_0xf3b688){_0xdee7c9(_0xf3b688);}};}}exports[a12_0x566439(0x223)]=TelegramController;