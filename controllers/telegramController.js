'use strict';const a12_0x53a605=a12_0xe6f0;function a12_0xe6f0(_0x5d5cd2,_0x5250fd){const _0x28fb7d=a12_0x28fb();return a12_0xe6f0=function(_0xe6f049,_0x2361a5){_0xe6f049=_0xe6f049-0x181;let _0x520be4=_0x28fb7d[_0xe6f049];return _0x520be4;},a12_0xe6f0(_0x5d5cd2,_0x5250fd);}(function(_0x430d10,_0x528bcb){const _0x532410=a12_0xe6f0,_0xe0675f=_0x430d10();while(!![]){try{const _0x4d58b3=parseInt(_0x532410(0x1bc))/0x1*(-parseInt(_0x532410(0x1b6))/0x2)+-parseInt(_0x532410(0x194))/0x3+parseInt(_0x532410(0x182))/0x4+-parseInt(_0x532410(0x1ae))/0x5*(parseInt(_0x532410(0x1b7))/0x6)+-parseInt(_0x532410(0x1ac))/0x7*(parseInt(_0x532410(0x1c5))/0x8)+parseInt(_0x532410(0x1a6))/0x9*(parseInt(_0x532410(0x1a8))/0xa)+parseInt(_0x532410(0x1b2))/0xb;if(_0x4d58b3===_0x528bcb)break;else _0xe0675f['push'](_0xe0675f['shift']());}catch(_0x1f0aea){_0xe0675f['push'](_0xe0675f['shift']());}}}(a12_0x28fb,0xdeb4c));var __importDefault=this&&this[a12_0x53a605(0x183)]||function(_0x99f0ed){const _0x55250b=a12_0x53a605;return _0x99f0ed&&_0x99f0ed[_0x55250b(0x190)]?_0x99f0ed:{'default':_0x99f0ed};};Object[a12_0x53a605(0x192)](exports,a12_0x53a605(0x190),{'value':!![]}),exports[a12_0x53a605(0x1be)]=void 0x0;const telegramBotService_1=require(a12_0x53a605(0x1bb)),database_1=__importDefault(require('../config/database'));function a12_0x28fb(){const _0x50c656=['findMany','USD','10XQUnPq','12kZTWGE','groupBy','true','bank_transfer','../services/telegramBotService','84632qVQbkU','updatedAt','TelegramController','custom','ceil','Shop\x20not\x20found','firstName','\x20notification\x20sent\x20successfully','all','1648sUJNjy','isVerified','telegramId','body','json','Markdown','6025920tDXcxQ','__importDefault','plisio','Test\x20Notification','lastName','Test\x20Product','method','paid','count','Broadcast\x20message\x20sent\x20successfully','filter','telegramUser','default','test_payout_123','__esModule','username','defineProperty','amount','2493657VqVkAR','disconnectUser','sendTestNotification','completed','User\x20disconnected\x20successfully','createdAt','map','status','shopId','title','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','payment','gateway','findUnique','details','sendCustomNotification','params','sendPaymentNotification','45GNTqYn','getBotInfo','2784580YDdsPb','sendBroadcast','productName','Test\x20','53690aJGTQn','payout','3266205ZoQQXI','sendShopNotification','telegramBotService','Shop\x20ID\x20is\x20required','23697465ypFgYU','isActive'];a12_0x28fb=function(){return _0x50c656;};return a12_0x28fb();}class TelegramController{constructor(){const _0x1d527c=a12_0x53a605;this['getBotStatus']=async(_0x444085,_0x5ace1b,_0x5396bc)=>{const _0x4c5f87=a12_0xe6f0;try{const _0x5a9865=telegramBotService_1['telegramBotService'][_0x4c5f87(0x1a7)](),_0x4dccc2=await database_1[_0x4c5f87(0x18e)][_0x4c5f87(0x18d)][_0x4c5f87(0x18a)](),_0x58d239=await database_1['default'][_0x4c5f87(0x18d)][_0x4c5f87(0x18a)]({'where':{'isVerified':!![]}}),_0x57337c=await database_1[_0x4c5f87(0x18e)][_0x4c5f87(0x18d)][_0x4c5f87(0x1b8)]({'by':[_0x4c5f87(0x19c)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5ace1b[_0x4c5f87(0x1c9)]({'success':!![],'result':{'bot':{'isActive':_0x5a9865[_0x4c5f87(0x1b3)],'username':_0x5a9865['username']},'statistics':{'totalUsers':_0x4dccc2,'verifiedUsers':_0x58d239,'unverifiedUsers':_0x4dccc2-_0x58d239,'connectedShops':_0x57337c['length']}}});}catch(_0x58ce37){_0x5396bc(_0x58ce37);}},this['getTelegramUsers']=async(_0x37ef8e,_0x3dcbca,_0x32f0bb)=>{const _0x370c98=a12_0xe6f0;try{const {page:page=0x1,limit:limit=0x14,verified:_0x36592d}=_0x37ef8e['query'],_0x5f2a76=(Number(page)-0x1)*Number(limit),_0x428e1d={};_0x36592d!==undefined&&(_0x428e1d[_0x370c98(0x1c6)]=_0x36592d===_0x370c98(0x1b9));const [_0x5fc046,_0x44ff99]=await Promise[_0x370c98(0x1c4)]([database_1['default']['telegramUser']['findMany']({'where':_0x428e1d,'skip':_0x5f2a76,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x370c98(0x18e)][_0x370c98(0x18d)][_0x370c98(0x18a)]({'where':_0x428e1d})]);_0x3dcbca[_0x370c98(0x1c9)]({'success':!![],'users':_0x5fc046[_0x370c98(0x19a)](_0x2e85d1=>({'id':_0x2e85d1['id'],'telegramId':_0x2e85d1[_0x370c98(0x1c7)],'username':_0x2e85d1[_0x370c98(0x191)],'firstName':_0x2e85d1[_0x370c98(0x1c2)],'lastName':_0x2e85d1[_0x370c98(0x186)],'isVerified':_0x2e85d1[_0x370c98(0x1c6)],'shop':_0x2e85d1['shop'],'createdAt':_0x2e85d1[_0x370c98(0x199)],'updatedAt':_0x2e85d1[_0x370c98(0x1bd)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x44ff99,'totalPages':Math[_0x370c98(0x1c0)](_0x44ff99/Number(limit))}});}catch(_0x31d761){_0x32f0bb(_0x31d761);}},this[_0x1d527c(0x1a9)]=async(_0x335ef9,_0x1d53a4,_0x2cd0c5)=>{const _0x5dfba0=_0x1d527c;try{const {message:_0x1e2055,shopId:_0x56064b}=_0x335ef9[_0x5dfba0(0x1c8)];if(!_0x1e2055)return _0x1d53a4[_0x5dfba0(0x19b)](0x190)[_0x5dfba0(0x1c9)]({'success':![],'message':'Message\x20is\x20required'});if(_0x56064b)await telegramBotService_1[_0x5dfba0(0x1b0)][_0x5dfba0(0x1af)](_0x56064b,_0x1e2055,{'parse_mode':_0x5dfba0(0x181)});else{const _0x2ed67b=await database_1[_0x5dfba0(0x18e)][_0x5dfba0(0x18d)][_0x5dfba0(0x1b4)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x43a165=[...new Set(_0x2ed67b[_0x5dfba0(0x19a)](_0x4947a6=>_0x4947a6[_0x5dfba0(0x19c)])[_0x5dfba0(0x18c)](Boolean))];for(const _0x85d61d of _0x43a165){_0x85d61d&&await telegramBotService_1[_0x5dfba0(0x1b0)][_0x5dfba0(0x1af)](_0x85d61d,_0x1e2055,{'parse_mode':_0x5dfba0(0x181)});}}_0x1d53a4['json']({'success':!![],'message':_0x5dfba0(0x18b)});}catch(_0x5818ce){_0x2cd0c5(_0x5818ce);}},this[_0x1d527c(0x195)]=async(_0x255436,_0x40d92f,_0x156724)=>{const _0x744d0c=_0x1d527c;try{const {telegramId:_0x59b3f1}=_0x255436[_0x744d0c(0x1a4)],_0x470f36=await database_1['default'][_0x744d0c(0x18d)][_0x744d0c(0x1a1)]({'where':{'telegramId':_0x59b3f1},'include':{'shop':!![]}});if(!_0x470f36)return _0x40d92f[_0x744d0c(0x19b)](0x194)[_0x744d0c(0x1c9)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x744d0c(0x18e)][_0x744d0c(0x18d)]['update']({'where':{'telegramId':_0x59b3f1},'data':{'shopId':null,'isVerified':![]}}),_0x40d92f[_0x744d0c(0x1c9)]({'success':!![],'message':_0x744d0c(0x198)});}catch(_0x38b496){_0x156724(_0x38b496);}},this[_0x1d527c(0x196)]=async(_0x29fdf1,_0x3a41c2,_0xfbc9fc)=>{const _0x2081c8=_0x1d527c;try{const {shopId:_0x2d02d4,type:type=_0x2081c8(0x19f),testData:_0x47e35a}=_0x29fdf1[_0x2081c8(0x1c8)];if(!_0x2d02d4)return _0x3a41c2[_0x2081c8(0x19b)](0x190)[_0x2081c8(0x1c9)]({'success':![],'message':_0x2081c8(0x1b1)});const _0x3a0776=await database_1[_0x2081c8(0x18e)]['shop'][_0x2081c8(0x1a1)]({'where':{'id':_0x2d02d4},'select':{'id':!![],'name':!![]}});if(!_0x3a0776)return _0x3a41c2[_0x2081c8(0x19b)](0x194)[_0x2081c8(0x1c9)]({'success':![],'message':_0x2081c8(0x1c1)});switch(type){case _0x2081c8(0x19f):const _0x3ce2c9={'id':'test_payment_123','amount':_0x47e35a?.['amount']||0x64,'currency':_0x47e35a?.['currency']||_0x2081c8(0x1b5),'productName':_0x47e35a?.[_0x2081c8(0x1aa)]||_0x2081c8(0x187),'gateway':_0x47e35a?.[_0x2081c8(0x1a0)]||_0x2081c8(0x184),'createdAt':new Date(),..._0x47e35a};await telegramBotService_1[_0x2081c8(0x1b0)][_0x2081c8(0x1a5)](_0x2d02d4,_0x3ce2c9,_0x2081c8(0x189));break;case _0x2081c8(0x1ad):const _0x4d4c9a={'id':_0x2081c8(0x18f),'amount':_0x47e35a?.[_0x2081c8(0x193)]||0x1f4,'method':_0x47e35a?.[_0x2081c8(0x188)]||_0x2081c8(0x1ba),'createdAt':new Date(),..._0x47e35a};await telegramBotService_1[_0x2081c8(0x1b0)]['sendPayoutNotification'](_0x2d02d4,_0x4d4c9a,_0x2081c8(0x197));break;case _0x2081c8(0x1bf):await telegramBotService_1['telegramBotService'][_0x2081c8(0x1a3)](_0x2d02d4,_0x47e35a?.[_0x2081c8(0x19d)]||_0x2081c8(0x185),_0x47e35a?.[_0x2081c8(0x1a2)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x3a41c2[_0x2081c8(0x19b)](0x190)[_0x2081c8(0x1c9)]({'success':![],'message':_0x2081c8(0x19e)});}_0x3a41c2[_0x2081c8(0x1c9)]({'success':!![],'message':_0x2081c8(0x1ab)+type+_0x2081c8(0x1c3)});}catch(_0x49b2b7){_0xfbc9fc(_0x49b2b7);}};}}exports[a12_0x53a605(0x1be)]=TelegramController;