'use strict';const a12_0x315e62=a12_0x3f4e;(function(_0x86cf1d,_0x37e94d){const _0x5c7951=a12_0x3f4e,_0x23d0b7=_0x86cf1d();while(!![]){try{const _0x6511c0=parseInt(_0x5c7951(0x16c))/0x1+-parseInt(_0x5c7951(0x18d))/0x2+-parseInt(_0x5c7951(0x169))/0x3*(-parseInt(_0x5c7951(0x183))/0x4)+-parseInt(_0x5c7951(0x179))/0x5*(parseInt(_0x5c7951(0x155))/0x6)+-parseInt(_0x5c7951(0x17b))/0x7+parseInt(_0x5c7951(0x156))/0x8+parseInt(_0x5c7951(0x162))/0x9*(-parseInt(_0x5c7951(0x15a))/0xa);if(_0x6511c0===_0x37e94d)break;else _0x23d0b7['push'](_0x23d0b7['shift']());}catch(_0x471a09){_0x23d0b7['push'](_0x23d0b7['shift']());}}}(a12_0x72ac,0x5ce9f));function a12_0x72ac(){const _0x3e1760=['telegramUser','Shop\x20not\x20found','gateway','groupBy','custom','paid','createdAt','sendPaymentNotification','json','USD','__esModule','lastName','31926rSqULn','5274888IjYDrX','getBotInfo','sendBroadcast','__importDefault','7370980PDlglO','sendShopNotification','telegramBotService','body','update','details','productName','query','9IedbEt','Markdown','firstName','Shop\x20ID\x20is\x20required','disconnectUser','method','Test\x20Notification','141izljyA','telegramId','username','456473iPnObF','findMany','status','title','true','test_payment_123','desc','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','../services/telegramBotService','count','Telegram\x20user\x20not\x20found','getBotStatus','Test\x20Product','110AfFuCb','amount','1714097XYRvWQ','default','map','sendCustomNotification','\x20notification\x20sent\x20successfully','updatedAt','filter','sendTestNotification','54884fKDWtV','defineProperty','User\x20disconnected\x20successfully','Message\x20is\x20required','isActive','test_payout_123','currency','isVerified','all','payment','562230vuOqTO','completed','shopId','sendPayoutNotification','Broadcast\x20message\x20sent\x20successfully','shop'];a12_0x72ac=function(){return _0x3e1760;};return a12_0x72ac();}var __importDefault=this&&this[a12_0x315e62(0x159)]||function(_0x41c953){const _0x121d98=a12_0x315e62;return _0x41c953&&_0x41c953[_0x121d98(0x153)]?_0x41c953:{'default':_0x41c953};};Object[a12_0x315e62(0x184)](exports,'__esModule',{'value':!![]}),exports['TelegramController']=void 0x0;function a12_0x3f4e(_0x76018f,_0x574156){const _0x72aca1=a12_0x72ac();return a12_0x3f4e=function(_0x3f4e00,_0x519cf7){_0x3f4e00=_0x3f4e00-0x14d;let _0x4457c0=_0x72aca1[_0x3f4e00];return _0x4457c0;},a12_0x3f4e(_0x76018f,_0x574156);}const telegramBotService_1=require(a12_0x315e62(0x174)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x3630ba=a12_0x315e62;this[_0x3630ba(0x177)]=async(_0x3c6ab8,_0x5472ad,_0x336e2d)=>{const _0x1ce601=_0x3630ba;try{const _0x1f2ccf=telegramBotService_1[_0x1ce601(0x15c)][_0x1ce601(0x157)](),_0x1ea1e0=await database_1[_0x1ce601(0x17c)]['telegramUser'][_0x1ce601(0x175)](),_0x4079e8=await database_1[_0x1ce601(0x17c)][_0x1ce601(0x193)]['count']({'where':{'isVerified':!![]}}),_0x2d10cf=await database_1['default'][_0x1ce601(0x193)][_0x1ce601(0x196)]({'by':[_0x1ce601(0x18f)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5472ad[_0x1ce601(0x151)]({'success':!![],'result':{'bot':{'isActive':_0x1f2ccf[_0x1ce601(0x187)],'username':_0x1f2ccf[_0x1ce601(0x16b)]},'statistics':{'totalUsers':_0x1ea1e0,'verifiedUsers':_0x4079e8,'unverifiedUsers':_0x1ea1e0-_0x4079e8,'connectedShops':_0x2d10cf['length']}}});}catch(_0x140fdc){_0x336e2d(_0x140fdc);}},this['getTelegramUsers']=async(_0x189c89,_0x37621a,_0x2e5237)=>{const _0x13f039=_0x3630ba;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4d9e01}=_0x189c89[_0x13f039(0x161)],_0x52901b=(Number(page)-0x1)*Number(limit),_0x2e421b={};_0x4d9e01!==undefined&&(_0x2e421b[_0x13f039(0x18a)]=_0x4d9e01===_0x13f039(0x170));const [_0xcc23cb,_0x146ee0]=await Promise[_0x13f039(0x18b)]([database_1['default'][_0x13f039(0x193)][_0x13f039(0x16d)]({'where':_0x2e421b,'skip':_0x52901b,'take':Number(limit),'orderBy':{'createdAt':_0x13f039(0x172)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x13f039(0x17c)][_0x13f039(0x193)][_0x13f039(0x175)]({'where':_0x2e421b})]);_0x37621a[_0x13f039(0x151)]({'success':!![],'users':_0xcc23cb[_0x13f039(0x17d)](_0x2f436f=>({'id':_0x2f436f['id'],'telegramId':_0x2f436f[_0x13f039(0x16a)],'username':_0x2f436f[_0x13f039(0x16b)],'firstName':_0x2f436f[_0x13f039(0x164)],'lastName':_0x2f436f[_0x13f039(0x154)],'isVerified':_0x2f436f[_0x13f039(0x18a)],'shop':_0x2f436f[_0x13f039(0x192)],'createdAt':_0x2f436f[_0x13f039(0x14f)],'updatedAt':_0x2f436f[_0x13f039(0x180)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x146ee0,'totalPages':Math['ceil'](_0x146ee0/Number(limit))}});}catch(_0x331ae5){_0x2e5237(_0x331ae5);}},this[_0x3630ba(0x158)]=async(_0x3f6ffb,_0x2ebb06,_0x477a55)=>{const _0x5eaa06=_0x3630ba;try{const {message:_0x2041bd,shopId:_0x5386e9}=_0x3f6ffb[_0x5eaa06(0x15d)];if(!_0x2041bd)return _0x2ebb06[_0x5eaa06(0x16e)](0x190)['json']({'success':![],'message':_0x5eaa06(0x186)});if(_0x5386e9)await telegramBotService_1[_0x5eaa06(0x15c)][_0x5eaa06(0x15b)](_0x5386e9,_0x2041bd,{'parse_mode':_0x5eaa06(0x163)});else{const _0x381ead=await database_1['default'][_0x5eaa06(0x193)][_0x5eaa06(0x16d)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x774a84=[...new Set(_0x381ead[_0x5eaa06(0x17d)](_0x327933=>_0x327933['shopId'])[_0x5eaa06(0x181)](Boolean))];for(const _0xf4c91c of _0x774a84){_0xf4c91c&&await telegramBotService_1[_0x5eaa06(0x15c)][_0x5eaa06(0x15b)](_0xf4c91c,_0x2041bd,{'parse_mode':'Markdown'});}}_0x2ebb06['json']({'success':!![],'message':_0x5eaa06(0x191)});}catch(_0x2479c3){_0x477a55(_0x2479c3);}},this[_0x3630ba(0x166)]=async(_0x5c51ac,_0x4009fb,_0x1ddeb1)=>{const _0xbab573=_0x3630ba;try{const {telegramId:_0x182621}=_0x5c51ac['params'],_0x2c292a=await database_1[_0xbab573(0x17c)][_0xbab573(0x193)]['findUnique']({'where':{'telegramId':_0x182621},'include':{'shop':!![]}});if(!_0x2c292a)return _0x4009fb[_0xbab573(0x16e)](0x194)[_0xbab573(0x151)]({'success':![],'message':_0xbab573(0x176)});await database_1[_0xbab573(0x17c)][_0xbab573(0x193)][_0xbab573(0x15e)]({'where':{'telegramId':_0x182621},'data':{'shopId':null,'isVerified':![]}}),_0x4009fb[_0xbab573(0x151)]({'success':!![],'message':_0xbab573(0x185)});}catch(_0x2dbce4){_0x1ddeb1(_0x2dbce4);}},this[_0x3630ba(0x182)]=async(_0x262e20,_0x3061e5,_0x2550b9)=>{const _0x1ae56d=_0x3630ba;try{const {shopId:_0xf20a35,type:type=_0x1ae56d(0x18c),testData:_0x48b21c}=_0x262e20[_0x1ae56d(0x15d)];if(!_0xf20a35)return _0x3061e5[_0x1ae56d(0x16e)](0x190)[_0x1ae56d(0x151)]({'success':![],'message':_0x1ae56d(0x165)});const _0x765a58=await database_1[_0x1ae56d(0x17c)]['shop']['findUnique']({'where':{'id':_0xf20a35},'select':{'id':!![],'name':!![]}});if(!_0x765a58)return _0x3061e5['status'](0x194)[_0x1ae56d(0x151)]({'success':![],'message':_0x1ae56d(0x194)});switch(type){case _0x1ae56d(0x18c):const _0x5ef794={'id':_0x1ae56d(0x171),'amount':_0x48b21c?.[_0x1ae56d(0x17a)]||0x64,'currency':_0x48b21c?.[_0x1ae56d(0x189)]||_0x1ae56d(0x152),'productName':_0x48b21c?.[_0x1ae56d(0x160)]||_0x1ae56d(0x178),'gateway':_0x48b21c?.[_0x1ae56d(0x195)]||'plisio','createdAt':new Date(),..._0x48b21c};await telegramBotService_1['telegramBotService'][_0x1ae56d(0x150)](_0xf20a35,_0x5ef794,_0x1ae56d(0x14e));break;case'payout':const _0x283e48={'id':_0x1ae56d(0x188),'amount':_0x48b21c?.[_0x1ae56d(0x17a)]||0x1f4,'method':_0x48b21c?.[_0x1ae56d(0x167)]||'bank_transfer','createdAt':new Date(),..._0x48b21c};await telegramBotService_1['telegramBotService'][_0x1ae56d(0x190)](_0xf20a35,_0x283e48,_0x1ae56d(0x18e));break;case _0x1ae56d(0x14d):await telegramBotService_1[_0x1ae56d(0x15c)][_0x1ae56d(0x17e)](_0xf20a35,_0x48b21c?.[_0x1ae56d(0x16f)]||_0x1ae56d(0x168),_0x48b21c?.[_0x1ae56d(0x15f)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x3061e5['status'](0x190)[_0x1ae56d(0x151)]({'success':![],'message':_0x1ae56d(0x173)});}_0x3061e5['json']({'success':!![],'message':'Test\x20'+type+_0x1ae56d(0x17f)});}catch(_0x374bc4){_0x2550b9(_0x374bc4);}};}}exports['TelegramController']=TelegramController;