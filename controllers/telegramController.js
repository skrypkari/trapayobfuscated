'use strict';function a12_0x3c51(){const _0x4682ee=['944188yertRn','Shop\x20not\x20found','test_payment_123','groupBy','telegramBotService','6020yUizXq','map','payout','method','plisio','findMany','TelegramController','username','16434kuITVA','Markdown','firstName','paid','Broadcast\x20message\x20sent\x20successfully','amount','payment','filter','isVerified','params','json','USD','shopId','currency','updatedAt','defineProperty','lastName','5raSyak','104hSsveu','test_payout_123','details','Test\x20Product','../config/database','default','query','productName','1425231qGrqpX','desc','sendPayoutNotification','927976XSFert','count','isActive','body','12RKtMXH','update','Telegram\x20user\x20not\x20found','2nPYrYp','true','sendTestNotification','sendShopNotification','findUnique','length','Test\x20','getBotInfo','Shop\x20ID\x20is\x20required','shop','User\x20disconnected\x20successfully','ceil','title','This\x20is\x20a\x20test\x20notification','all','../services/telegramBotService','1731324ImHZlK','disconnectUser','1249718cVlWCR','getBotStatus','status','32trzDzP','sendBroadcast','__importDefault','telegramUser','5259339RxibUh','completed','__esModule'];a12_0x3c51=function(){return _0x4682ee;};return a12_0x3c51();}const a12_0x274735=a12_0x5927;(function(_0x5630d8,_0xc1880f){const _0x28fef8=a12_0x5927,_0x2100b1=_0x5630d8();while(!![]){try{const _0x5050e8=parseInt(_0x28fef8(0x1e6))/0x1+-parseInt(_0x28fef8(0x221))/0x2*(parseInt(_0x28fef8(0x1ed))/0x3)+parseInt(_0x28fef8(0x1f0))/0x4*(parseInt(_0x28fef8(0x20e))/0x5)+-parseInt(_0x28fef8(0x21e))/0x6*(parseInt(_0x28fef8(0x21a))/0x7)+parseInt(_0x28fef8(0x1e9))/0x8*(-parseInt(_0x28fef8(0x217))/0x9)+-parseInt(_0x28fef8(0x1f5))/0xa*(-parseInt(_0x28fef8(0x1fd))/0xb)+parseInt(_0x28fef8(0x1e4))/0xc*(parseInt(_0x28fef8(0x20f))/0xd);if(_0x5050e8===_0xc1880f)break;else _0x2100b1['push'](_0x2100b1['shift']());}catch(_0x4bd584){_0x2100b1['push'](_0x2100b1['shift']());}}}(a12_0x3c51,0xd8b84));var __importDefault=this&&this[a12_0x274735(0x1eb)]||function(_0x4cb587){return _0x4cb587&&_0x4cb587['__esModule']?_0x4cb587:{'default':_0x4cb587};};Object[a12_0x274735(0x20c)](exports,a12_0x274735(0x1ef),{'value':!![]}),exports[a12_0x274735(0x1fb)]=void 0x0;const telegramBotService_1=require(a12_0x274735(0x1e3)),database_1=__importDefault(require(a12_0x274735(0x213)));function a12_0x5927(_0x144130,_0x294d40){const _0x3c51f4=a12_0x3c51();return a12_0x5927=function(_0x592764,_0xe8af17){_0x592764=_0x592764-0x1de;let _0x2ab3dd=_0x3c51f4[_0x592764];return _0x2ab3dd;},a12_0x5927(_0x144130,_0x294d40);}class TelegramController{constructor(){const _0x448786=a12_0x274735;this[_0x448786(0x1e7)]=async(_0x6fcbc7,_0x336bdc,_0x52b282)=>{const _0x3990ef=_0x448786;try{const _0x3ecd95=telegramBotService_1[_0x3990ef(0x1f4)][_0x3990ef(0x228)](),_0x4a273a=await database_1[_0x3990ef(0x214)][_0x3990ef(0x1ec)][_0x3990ef(0x21b)](),_0xbb16d5=await database_1[_0x3990ef(0x214)]['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x53d84a=await database_1['default'][_0x3990ef(0x1ec)][_0x3990ef(0x1f3)]({'by':[_0x3990ef(0x209)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x336bdc['json']({'success':!![],'result':{'bot':{'isActive':_0x3ecd95[_0x3990ef(0x21c)],'username':_0x3ecd95['username']},'statistics':{'totalUsers':_0x4a273a,'verifiedUsers':_0xbb16d5,'unverifiedUsers':_0x4a273a-_0xbb16d5,'connectedShops':_0x53d84a[_0x3990ef(0x226)]}}});}catch(_0x339689){_0x52b282(_0x339689);}},this['getTelegramUsers']=async(_0x4e37b2,_0x3b18a4,_0x1696db)=>{const _0x1b648f=_0x448786;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3f33c7}=_0x4e37b2[_0x1b648f(0x215)],_0xe039a3=(Number(page)-0x1)*Number(limit),_0x48e051={};_0x3f33c7!==undefined&&(_0x48e051[_0x1b648f(0x205)]=_0x3f33c7===_0x1b648f(0x222));const [_0x26f974,_0x2c35ad]=await Promise[_0x1b648f(0x1e2)]([database_1[_0x1b648f(0x214)]['telegramUser'][_0x1b648f(0x1fa)]({'where':_0x48e051,'skip':_0xe039a3,'take':Number(limit),'orderBy':{'createdAt':_0x1b648f(0x218)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1b648f(0x214)]['telegramUser']['count']({'where':_0x48e051})]);_0x3b18a4['json']({'success':!![],'users':_0x26f974[_0x1b648f(0x1f6)](_0x1d022a=>({'id':_0x1d022a['id'],'telegramId':_0x1d022a['telegramId'],'username':_0x1d022a[_0x1b648f(0x1fc)],'firstName':_0x1d022a[_0x1b648f(0x1ff)],'lastName':_0x1d022a[_0x1b648f(0x20d)],'isVerified':_0x1d022a['isVerified'],'shop':_0x1d022a[_0x1b648f(0x22a)],'createdAt':_0x1d022a['createdAt'],'updatedAt':_0x1d022a[_0x1b648f(0x20b)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2c35ad,'totalPages':Math[_0x1b648f(0x1df)](_0x2c35ad/Number(limit))}});}catch(_0x2bf787){_0x1696db(_0x2bf787);}},this[_0x448786(0x1ea)]=async(_0x4e660d,_0x33f587,_0xb36582)=>{const _0x514aed=_0x448786;try{const {message:_0x32b942,shopId:_0x21f580}=_0x4e660d[_0x514aed(0x21d)];if(!_0x32b942)return _0x33f587[_0x514aed(0x1e8)](0x190)[_0x514aed(0x207)]({'success':![],'message':'Message\x20is\x20required'});if(_0x21f580)await telegramBotService_1[_0x514aed(0x1f4)][_0x514aed(0x224)](_0x21f580,_0x32b942,{'parse_mode':_0x514aed(0x1fe)});else{const _0x133568=await database_1['default'][_0x514aed(0x1ec)][_0x514aed(0x1fa)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x182c6c=[...new Set(_0x133568[_0x514aed(0x1f6)](_0x4c17b6=>_0x4c17b6['shopId'])[_0x514aed(0x204)](Boolean))];for(const _0x2f55ff of _0x182c6c){_0x2f55ff&&await telegramBotService_1[_0x514aed(0x1f4)][_0x514aed(0x224)](_0x2f55ff,_0x32b942,{'parse_mode':_0x514aed(0x1fe)});}}_0x33f587[_0x514aed(0x207)]({'success':!![],'message':_0x514aed(0x201)});}catch(_0x2fbf7f){_0xb36582(_0x2fbf7f);}},this[_0x448786(0x1e5)]=async(_0x1d4775,_0x3124a7,_0x59b3fa)=>{const _0x2afe0f=_0x448786;try{const {telegramId:_0x12b215}=_0x1d4775[_0x2afe0f(0x206)],_0x5852cf=await database_1[_0x2afe0f(0x214)]['telegramUser'][_0x2afe0f(0x225)]({'where':{'telegramId':_0x12b215},'include':{'shop':!![]}});if(!_0x5852cf)return _0x3124a7[_0x2afe0f(0x1e8)](0x194)[_0x2afe0f(0x207)]({'success':![],'message':_0x2afe0f(0x220)});await database_1[_0x2afe0f(0x214)][_0x2afe0f(0x1ec)][_0x2afe0f(0x21f)]({'where':{'telegramId':_0x12b215},'data':{'shopId':null,'isVerified':![]}}),_0x3124a7['json']({'success':!![],'message':_0x2afe0f(0x1de)});}catch(_0x493101){_0x59b3fa(_0x493101);}},this[_0x448786(0x223)]=async(_0x30aecb,_0x169919,_0x5a29e0)=>{const _0x1d4b37=_0x448786;try{const {shopId:_0x5ed80d,type:type=_0x1d4b37(0x203),testData:_0xa7918e}=_0x30aecb['body'];if(!_0x5ed80d)return _0x169919[_0x1d4b37(0x1e8)](0x190)[_0x1d4b37(0x207)]({'success':![],'message':_0x1d4b37(0x229)});const _0x2d401e=await database_1[_0x1d4b37(0x214)][_0x1d4b37(0x22a)][_0x1d4b37(0x225)]({'where':{'id':_0x5ed80d},'select':{'id':!![],'name':!![]}});if(!_0x2d401e)return _0x169919[_0x1d4b37(0x1e8)](0x194)[_0x1d4b37(0x207)]({'success':![],'message':_0x1d4b37(0x1f1)});switch(type){case'payment':const _0x27c9b6={'id':_0x1d4b37(0x1f2),'amount':_0xa7918e?.[_0x1d4b37(0x202)]||0x64,'currency':_0xa7918e?.[_0x1d4b37(0x20a)]||_0x1d4b37(0x208),'productName':_0xa7918e?.[_0x1d4b37(0x216)]||_0x1d4b37(0x212),'gateway':_0xa7918e?.['gateway']||_0x1d4b37(0x1f9),'createdAt':new Date(),..._0xa7918e};await telegramBotService_1[_0x1d4b37(0x1f4)]['sendPaymentNotification'](_0x5ed80d,_0x27c9b6,_0x1d4b37(0x200));break;case _0x1d4b37(0x1f7):const _0x464a53={'id':_0x1d4b37(0x210),'amount':_0xa7918e?.[_0x1d4b37(0x202)]||0x1f4,'method':_0xa7918e?.[_0x1d4b37(0x1f8)]||'bank_transfer','createdAt':new Date(),..._0xa7918e};await telegramBotService_1[_0x1d4b37(0x1f4)][_0x1d4b37(0x219)](_0x5ed80d,_0x464a53,_0x1d4b37(0x1ee));break;case'custom':await telegramBotService_1[_0x1d4b37(0x1f4)]['sendCustomNotification'](_0x5ed80d,_0xa7918e?.[_0x1d4b37(0x1e0)]||'Test\x20Notification',_0xa7918e?.[_0x1d4b37(0x211)]||{'message':_0x1d4b37(0x1e1)});break;default:return _0x169919[_0x1d4b37(0x1e8)](0x190)[_0x1d4b37(0x207)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x169919[_0x1d4b37(0x207)]({'success':!![],'message':_0x1d4b37(0x227)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x3f72e2){_0x5a29e0(_0x3f72e2);}};}}exports[a12_0x274735(0x1fb)]=TelegramController;