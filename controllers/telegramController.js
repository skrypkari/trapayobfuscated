'use strict';function a12_0x5879(_0x482a92,_0x575008){const _0x51a9a3=a12_0x51a9();return a12_0x5879=function(_0x587968,_0x451c61){_0x587968=_0x587968-0xff;let _0x4cb3b3=_0x51a9a3[_0x587968];return _0x4cb3b3;},a12_0x5879(_0x482a92,_0x575008);}const a12_0x39fee9=a12_0x5879;(function(_0x4b0962,_0x2294ed){const _0x407721=a12_0x5879,_0x481435=_0x4b0962();while(!![]){try{const _0x2f9db5=parseInt(_0x407721(0x102))/0x1*(-parseInt(_0x407721(0x10e))/0x2)+parseInt(_0x407721(0xff))/0x3+-parseInt(_0x407721(0x10c))/0x4*(-parseInt(_0x407721(0x12f))/0x5)+-parseInt(_0x407721(0x141))/0x6+-parseInt(_0x407721(0x12a))/0x7*(parseInt(_0x407721(0x103))/0x8)+parseInt(_0x407721(0x127))/0x9+parseInt(_0x407721(0x116))/0xa*(parseInt(_0x407721(0x115))/0xb);if(_0x2f9db5===_0x2294ed)break;else _0x481435['push'](_0x481435['shift']());}catch(_0x5cda9f){_0x481435['push'](_0x481435['shift']());}}}(a12_0x51a9,0xe246f));var __importDefault=this&&this[a12_0x39fee9(0x132)]||function(_0x116cf1){const _0x2b5a96=a12_0x39fee9;return _0x116cf1&&_0x116cf1[_0x2b5a96(0x119)]?_0x116cf1:{'default':_0x116cf1};};function a12_0x51a9(){const _0x310523=['findMany','Shop\x20not\x20found','getBotInfo','sendPayoutNotification','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','body','username','Markdown','ceil','8332083BIJUeR','currency','User\x20disconnected\x20successfully','77meEwUZ','telegramBotService','telegramId','shop','Telegram\x20user\x20not\x20found','4776215HezfrQ','updatedAt','title','__importDefault','json','details','Test\x20Product','amount','count','getBotStatus','paid','status','isVerified','params','map','method','findUnique','Test\x20Notification','9704748MpRdDt','Shop\x20ID\x20is\x20required','sendShopNotification','custom','3647160QRoiXD','This\x20is\x20a\x20test\x20notification','desc','1050847pRfOCs','428552iPiKfR','telegramUser','payment','shopId','../services/telegramBotService','default','length','sendCustomNotification','payout','4bgYGQb','filter','2VPlsWl','test_payment_123','sendPaymentNotification','USD','Message\x20is\x20required','Broadcast\x20message\x20sent\x20successfully','disconnectUser','319egKnfB','375050GMAGbF','TelegramController','all','__esModule','true','createdAt','lastName','query'];a12_0x51a9=function(){return _0x310523;};return a12_0x51a9();}Object['defineProperty'](exports,a12_0x39fee9(0x119),{'value':!![]}),exports[a12_0x39fee9(0x117)]=void 0x0;const telegramBotService_1=require(a12_0x39fee9(0x107)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x363316=a12_0x39fee9;this[_0x363316(0x138)]=async(_0x4b59d1,_0x21b7cd,_0x2a1170)=>{const _0x39f606=_0x363316;try{const _0x42603e=telegramBotService_1['telegramBotService'][_0x39f606(0x120)](),_0x259f97=await database_1['default'][_0x39f606(0x104)][_0x39f606(0x137)](),_0x19c2e1=await database_1[_0x39f606(0x108)]['telegramUser'][_0x39f606(0x137)]({'where':{'isVerified':!![]}}),_0x4ac475=await database_1[_0x39f606(0x108)][_0x39f606(0x104)]['groupBy']({'by':[_0x39f606(0x106)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x21b7cd[_0x39f606(0x133)]({'success':!![],'result':{'bot':{'isActive':_0x42603e['isActive'],'username':_0x42603e[_0x39f606(0x124)]},'statistics':{'totalUsers':_0x259f97,'verifiedUsers':_0x19c2e1,'unverifiedUsers':_0x259f97-_0x19c2e1,'connectedShops':_0x4ac475[_0x39f606(0x109)]}}});}catch(_0xcc41dd){_0x2a1170(_0xcc41dd);}},this['getTelegramUsers']=async(_0x1345f7,_0xcde584,_0x384f59)=>{const _0x462d53=_0x363316;try{const {page:page=0x1,limit:limit=0x14,verified:_0x152d84}=_0x1345f7[_0x462d53(0x11d)],_0x2a0d66=(Number(page)-0x1)*Number(limit),_0x37c07e={};_0x152d84!==undefined&&(_0x37c07e[_0x462d53(0x13b)]=_0x152d84===_0x462d53(0x11a));const [_0xcd7576,_0x15e464]=await Promise[_0x462d53(0x118)]([database_1[_0x462d53(0x108)]['telegramUser'][_0x462d53(0x11e)]({'where':_0x37c07e,'skip':_0x2a0d66,'take':Number(limit),'orderBy':{'createdAt':_0x462d53(0x101)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x462d53(0x108)][_0x462d53(0x104)][_0x462d53(0x137)]({'where':_0x37c07e})]);_0xcde584[_0x462d53(0x133)]({'success':!![],'users':_0xcd7576['map'](_0xec2f62=>({'id':_0xec2f62['id'],'telegramId':_0xec2f62[_0x462d53(0x12c)],'username':_0xec2f62[_0x462d53(0x124)],'firstName':_0xec2f62['firstName'],'lastName':_0xec2f62[_0x462d53(0x11c)],'isVerified':_0xec2f62[_0x462d53(0x13b)],'shop':_0xec2f62[_0x462d53(0x12d)],'createdAt':_0xec2f62[_0x462d53(0x11b)],'updatedAt':_0xec2f62[_0x462d53(0x130)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x15e464,'totalPages':Math[_0x462d53(0x126)](_0x15e464/Number(limit))}});}catch(_0x19ebad){_0x384f59(_0x19ebad);}},this['sendBroadcast']=async(_0x868835,_0x2cc450,_0x1c3ff6)=>{const _0x54b1d1=_0x363316;try{const {message:_0x4e5ed1,shopId:_0x5f5902}=_0x868835[_0x54b1d1(0x123)];if(!_0x4e5ed1)return _0x2cc450['status'](0x190)[_0x54b1d1(0x133)]({'success':![],'message':_0x54b1d1(0x112)});if(_0x5f5902)await telegramBotService_1[_0x54b1d1(0x12b)][_0x54b1d1(0x143)](_0x5f5902,_0x4e5ed1,{'parse_mode':_0x54b1d1(0x125)});else{const _0x24942b=await database_1[_0x54b1d1(0x108)][_0x54b1d1(0x104)][_0x54b1d1(0x11e)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1dd9a0=[...new Set(_0x24942b[_0x54b1d1(0x13d)](_0x195235=>_0x195235[_0x54b1d1(0x106)])[_0x54b1d1(0x10d)](Boolean))];for(const _0x3ed74b of _0x1dd9a0){_0x3ed74b&&await telegramBotService_1[_0x54b1d1(0x12b)][_0x54b1d1(0x143)](_0x3ed74b,_0x4e5ed1,{'parse_mode':'Markdown'});}}_0x2cc450[_0x54b1d1(0x133)]({'success':!![],'message':_0x54b1d1(0x113)});}catch(_0x36c908){_0x1c3ff6(_0x36c908);}},this[_0x363316(0x114)]=async(_0x1182e2,_0x533f88,_0x1a975f)=>{const _0x4f4ea5=_0x363316;try{const {telegramId:_0x175447}=_0x1182e2[_0x4f4ea5(0x13c)],_0x2ba0e6=await database_1[_0x4f4ea5(0x108)][_0x4f4ea5(0x104)][_0x4f4ea5(0x13f)]({'where':{'telegramId':_0x175447},'include':{'shop':!![]}});if(!_0x2ba0e6)return _0x533f88[_0x4f4ea5(0x13a)](0x194)[_0x4f4ea5(0x133)]({'success':![],'message':_0x4f4ea5(0x12e)});await database_1[_0x4f4ea5(0x108)][_0x4f4ea5(0x104)]['update']({'where':{'telegramId':_0x175447},'data':{'shopId':null,'isVerified':![]}}),_0x533f88[_0x4f4ea5(0x133)]({'success':!![],'message':_0x4f4ea5(0x129)});}catch(_0x5033f5){_0x1a975f(_0x5033f5);}},this['sendTestNotification']=async(_0xe47ec3,_0x25b99c,_0x2aa2fc)=>{const _0x2b52b6=_0x363316;try{const {shopId:_0x2eb887,type:type=_0x2b52b6(0x105),testData:_0x2acb26}=_0xe47ec3[_0x2b52b6(0x123)];if(!_0x2eb887)return _0x25b99c[_0x2b52b6(0x13a)](0x190)[_0x2b52b6(0x133)]({'success':![],'message':_0x2b52b6(0x142)});const _0x301855=await database_1[_0x2b52b6(0x108)][_0x2b52b6(0x12d)][_0x2b52b6(0x13f)]({'where':{'id':_0x2eb887},'select':{'id':!![],'name':!![]}});if(!_0x301855)return _0x25b99c[_0x2b52b6(0x13a)](0x194)['json']({'success':![],'message':_0x2b52b6(0x11f)});switch(type){case _0x2b52b6(0x105):const _0x4d07a5={'id':_0x2b52b6(0x10f),'amount':_0x2acb26?.[_0x2b52b6(0x136)]||0x64,'currency':_0x2acb26?.[_0x2b52b6(0x128)]||_0x2b52b6(0x111),'productName':_0x2acb26?.['productName']||_0x2b52b6(0x135),'gateway':_0x2acb26?.['gateway']||'plisio','createdAt':new Date(),..._0x2acb26};await telegramBotService_1[_0x2b52b6(0x12b)][_0x2b52b6(0x110)](_0x2eb887,_0x4d07a5,_0x2b52b6(0x139));break;case _0x2b52b6(0x10b):const _0x18154b={'id':'test_payout_123','amount':_0x2acb26?.[_0x2b52b6(0x136)]||0x1f4,'method':_0x2acb26?.[_0x2b52b6(0x13e)]||'bank_transfer','createdAt':new Date(),..._0x2acb26};await telegramBotService_1[_0x2b52b6(0x12b)][_0x2b52b6(0x121)](_0x2eb887,_0x18154b,'completed');break;case _0x2b52b6(0x144):await telegramBotService_1['telegramBotService'][_0x2b52b6(0x10a)](_0x2eb887,_0x2acb26?.[_0x2b52b6(0x131)]||_0x2b52b6(0x140),_0x2acb26?.[_0x2b52b6(0x134)]||{'message':_0x2b52b6(0x100)});break;default:return _0x25b99c[_0x2b52b6(0x13a)](0x190)[_0x2b52b6(0x133)]({'success':![],'message':_0x2b52b6(0x122)});}_0x25b99c[_0x2b52b6(0x133)]({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x3ef6b2){_0x2aa2fc(_0x3ef6b2);}};}}exports[a12_0x39fee9(0x117)]=TelegramController;