'use strict';const a12_0xb36f4b=a12_0x9f81;function a12_0x3482(){const _0x58f986=['sendPaymentNotification','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','63PnHcMW','Test\x20Product','payment','completed','status','default','isActive','Test\x20Notification','amount','productName','getBotInfo','title','username','ceil','paid','disconnectUser','sendTestNotification','../config/database','36TEjBvI','3020969ZMBWwl','isVerified','createdAt','bank_transfer','8YdGAXI','plisio','lastName','getBotStatus','19564zhfqaD','defineProperty','sendPayoutNotification','filter','Markdown','telegramUser','Shop\x20not\x20found','sendBroadcast','shopId','count','User\x20disconnected\x20successfully','findUnique','all','shop','payout','body','4324551SNPHxR','getTelegramUsers','12yoLUJW','query','sendShopNotification','json','65vYBsTS','This\x20is\x20a\x20test\x20notification','findMany','55265prMHEI','Telegram\x20user\x20not\x20found','434260ggyeon','telegramBotService','details','groupBy','TelegramController','27394rVbrvE','615162qPbwdB','Broadcast\x20message\x20sent\x20successfully','Test\x20','true','__esModule','Message\x20is\x20required','gateway','updatedAt','map','Shop\x20ID\x20is\x20required','desc','\x20notification\x20sent\x20successfully','params','update'];a12_0x3482=function(){return _0x58f986;};return a12_0x3482();}function a12_0x9f81(_0xe0e32c,_0x480e11){const _0x34826f=a12_0x3482();return a12_0x9f81=function(_0x9f814d,_0x55b9d2){_0x9f814d=_0x9f814d-0x18e;let _0x5ef504=_0x34826f[_0x9f814d];return _0x5ef504;},a12_0x9f81(_0xe0e32c,_0x480e11);}(function(_0x595b46,_0xb896e8){const _0x4c0264=a12_0x9f81,_0x575945=_0x595b46();while(!![]){try{const _0x174738=parseInt(_0x4c0264(0x1c8))/0x1+-parseInt(_0x4c0264(0x1cf))/0x2*(parseInt(_0x4c0264(0x1a6))/0x3)+parseInt(_0x4c0264(0x1af))/0x4*(-parseInt(_0x4c0264(0x1c5))/0x5)+-parseInt(_0x4c0264(0x1d0))/0x6+parseInt(_0x4c0264(0x1a7))/0x7*(parseInt(_0x4c0264(0x1ab))/0x8)+parseInt(_0x4c0264(0x194))/0x9*(-parseInt(_0x4c0264(0x1ca))/0xa)+parseInt(_0x4c0264(0x1bf))/0xb*(parseInt(_0x4c0264(0x1c1))/0xc);if(_0x174738===_0xb896e8)break;else _0x575945['push'](_0x575945['shift']());}catch(_0x54ce12){_0x575945['push'](_0x575945['shift']());}}}(a12_0x3482,0x3bf0d));var __importDefault=this&&this['__importDefault']||function(_0x559b53){const _0x50be1e=a12_0x9f81;return _0x559b53&&_0x559b53[_0x50be1e(0x1d4)]?_0x559b53:{'default':_0x559b53};};Object[a12_0xb36f4b(0x1b0)](exports,a12_0xb36f4b(0x1d4),{'value':!![]}),exports[a12_0xb36f4b(0x1ce)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0xb36f4b(0x1a5)));class TelegramController{constructor(){const _0x102c5c=a12_0xb36f4b;this[_0x102c5c(0x1ae)]=async(_0x324460,_0x5eb61c,_0x1686b9)=>{const _0x3144bb=_0x102c5c;try{const _0x17064c=telegramBotService_1[_0x3144bb(0x1cb)][_0x3144bb(0x19e)](),_0xba44fd=await database_1[_0x3144bb(0x199)][_0x3144bb(0x1b4)][_0x3144bb(0x1b8)](),_0x4f2e1a=await database_1[_0x3144bb(0x199)][_0x3144bb(0x1b4)][_0x3144bb(0x1b8)]({'where':{'isVerified':!![]}}),_0x2ea3a5=await database_1[_0x3144bb(0x199)][_0x3144bb(0x1b4)][_0x3144bb(0x1cd)]({'by':[_0x3144bb(0x1b7)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5eb61c[_0x3144bb(0x1c4)]({'success':!![],'result':{'bot':{'isActive':_0x17064c[_0x3144bb(0x19a)],'username':_0x17064c[_0x3144bb(0x1a0)]},'statistics':{'totalUsers':_0xba44fd,'verifiedUsers':_0x4f2e1a,'unverifiedUsers':_0xba44fd-_0x4f2e1a,'connectedShops':_0x2ea3a5['length']}}});}catch(_0x1f50d3){_0x1686b9(_0x1f50d3);}},this[_0x102c5c(0x1c0)]=async(_0xd36e08,_0x37ebdb,_0xc65eb2)=>{const _0x3bd106=_0x102c5c;try{const {page:page=0x1,limit:limit=0x14,verified:_0x112aa3}=_0xd36e08[_0x3bd106(0x1c2)],_0x5ca747=(Number(page)-0x1)*Number(limit),_0x278121={};_0x112aa3!==undefined&&(_0x278121[_0x3bd106(0x1a8)]=_0x112aa3===_0x3bd106(0x1d3));const [_0xad5870,_0x3419b3]=await Promise[_0x3bd106(0x1bb)]([database_1[_0x3bd106(0x199)][_0x3bd106(0x1b4)][_0x3bd106(0x1c7)]({'where':_0x278121,'skip':_0x5ca747,'take':Number(limit),'orderBy':{'createdAt':_0x3bd106(0x18e)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x3bd106(0x1b4)][_0x3bd106(0x1b8)]({'where':_0x278121})]);_0x37ebdb[_0x3bd106(0x1c4)]({'success':!![],'users':_0xad5870[_0x3bd106(0x1d8)](_0x4301a7=>({'id':_0x4301a7['id'],'telegramId':_0x4301a7['telegramId'],'username':_0x4301a7['username'],'firstName':_0x4301a7['firstName'],'lastName':_0x4301a7[_0x3bd106(0x1ad)],'isVerified':_0x4301a7[_0x3bd106(0x1a8)],'shop':_0x4301a7[_0x3bd106(0x1bc)],'createdAt':_0x4301a7[_0x3bd106(0x1a9)],'updatedAt':_0x4301a7[_0x3bd106(0x1d7)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3419b3,'totalPages':Math[_0x3bd106(0x1a1)](_0x3419b3/Number(limit))}});}catch(_0x45d30f){_0xc65eb2(_0x45d30f);}},this[_0x102c5c(0x1b6)]=async(_0xdf72ff,_0x39b4bd,_0x495452)=>{const _0x48d084=_0x102c5c;try{const {message:_0xef9dc6,shopId:_0x2ab7e0}=_0xdf72ff[_0x48d084(0x1be)];if(!_0xef9dc6)return _0x39b4bd[_0x48d084(0x198)](0x190)[_0x48d084(0x1c4)]({'success':![],'message':_0x48d084(0x1d5)});if(_0x2ab7e0)await telegramBotService_1[_0x48d084(0x1cb)][_0x48d084(0x1c3)](_0x2ab7e0,_0xef9dc6,{'parse_mode':_0x48d084(0x1b3)});else{const _0x416954=await database_1[_0x48d084(0x199)][_0x48d084(0x1b4)][_0x48d084(0x1c7)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x426983=[...new Set(_0x416954[_0x48d084(0x1d8)](_0x7f28ad=>_0x7f28ad[_0x48d084(0x1b7)])[_0x48d084(0x1b2)](Boolean))];for(const _0x3d69e3 of _0x426983){_0x3d69e3&&await telegramBotService_1['telegramBotService'][_0x48d084(0x1c3)](_0x3d69e3,_0xef9dc6,{'parse_mode':_0x48d084(0x1b3)});}}_0x39b4bd[_0x48d084(0x1c4)]({'success':!![],'message':_0x48d084(0x1d1)});}catch(_0x2283ca){_0x495452(_0x2283ca);}},this[_0x102c5c(0x1a3)]=async(_0x3a3d92,_0x186828,_0x27e8ae)=>{const _0x4f1322=_0x102c5c;try{const {telegramId:_0xf8b535}=_0x3a3d92[_0x4f1322(0x190)],_0x46c26e=await database_1[_0x4f1322(0x199)][_0x4f1322(0x1b4)][_0x4f1322(0x1ba)]({'where':{'telegramId':_0xf8b535},'include':{'shop':!![]}});if(!_0x46c26e)return _0x186828[_0x4f1322(0x198)](0x194)[_0x4f1322(0x1c4)]({'success':![],'message':_0x4f1322(0x1c9)});await database_1[_0x4f1322(0x199)]['telegramUser'][_0x4f1322(0x191)]({'where':{'telegramId':_0xf8b535},'data':{'shopId':null,'isVerified':![]}}),_0x186828[_0x4f1322(0x1c4)]({'success':!![],'message':_0x4f1322(0x1b9)});}catch(_0x515c1c){_0x27e8ae(_0x515c1c);}},this[_0x102c5c(0x1a4)]=async(_0x19b97a,_0x3d7a6c,_0x38de66)=>{const _0x10a42d=_0x102c5c;try{const {shopId:_0x22aa30,type:type=_0x10a42d(0x196),testData:_0x1adf87}=_0x19b97a[_0x10a42d(0x1be)];if(!_0x22aa30)return _0x3d7a6c[_0x10a42d(0x198)](0x190)[_0x10a42d(0x1c4)]({'success':![],'message':_0x10a42d(0x1d9)});const _0x185d2d=await database_1[_0x10a42d(0x199)][_0x10a42d(0x1bc)][_0x10a42d(0x1ba)]({'where':{'id':_0x22aa30},'select':{'id':!![],'name':!![]}});if(!_0x185d2d)return _0x3d7a6c[_0x10a42d(0x198)](0x194)[_0x10a42d(0x1c4)]({'success':![],'message':_0x10a42d(0x1b5)});switch(type){case _0x10a42d(0x196):const _0x292485={'id':'test_payment_123','amount':_0x1adf87?.[_0x10a42d(0x19c)]||0x64,'currency':_0x1adf87?.['currency']||'USD','productName':_0x1adf87?.[_0x10a42d(0x19d)]||_0x10a42d(0x195),'gateway':_0x1adf87?.[_0x10a42d(0x1d6)]||_0x10a42d(0x1ac),'createdAt':new Date(),..._0x1adf87};await telegramBotService_1[_0x10a42d(0x1cb)][_0x10a42d(0x192)](_0x22aa30,_0x292485,_0x10a42d(0x1a2));break;case _0x10a42d(0x1bd):const _0x20212b={'id':'test_payout_123','amount':_0x1adf87?.[_0x10a42d(0x19c)]||0x1f4,'method':_0x1adf87?.['method']||_0x10a42d(0x1aa),'createdAt':new Date(),..._0x1adf87};await telegramBotService_1[_0x10a42d(0x1cb)][_0x10a42d(0x1b1)](_0x22aa30,_0x20212b,_0x10a42d(0x197));break;case'custom':await telegramBotService_1['telegramBotService']['sendCustomNotification'](_0x22aa30,_0x1adf87?.[_0x10a42d(0x19f)]||_0x10a42d(0x19b),_0x1adf87?.[_0x10a42d(0x1cc)]||{'message':_0x10a42d(0x1c6)});break;default:return _0x3d7a6c[_0x10a42d(0x198)](0x190)[_0x10a42d(0x1c4)]({'success':![],'message':_0x10a42d(0x193)});}_0x3d7a6c['json']({'success':!![],'message':_0x10a42d(0x1d2)+type+_0x10a42d(0x18f)});}catch(_0x1e34a0){_0x38de66(_0x1e34a0);}};}}exports[a12_0xb36f4b(0x1ce)]=TelegramController;