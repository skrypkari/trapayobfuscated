'use strict';function a12_0x2285(){const _0x1f9a4d=['body','13pxkdZo','12516911mnYMaL','../services/telegramBotService','completed','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','paid','details','isVerified','desc','all','Test\x20','Shop\x20not\x20found','groupBy','getTelegramUsers','title','telegramUser','Message\x20is\x20required','method','408012PWeicu','isActive','3665tRPxNa','disconnectUser','test_payout_123','count','shopId','\x20notification\x20sent\x20successfully','params','gateway','currency','sendBroadcast','amount','default','payout','updatedAt','lastName','custom','bank_transfer','productName','length','45341RDJiXB','findUnique','json','findMany','getBotInfo','7LhzBAG','__importDefault','Shop\x20ID\x20is\x20required','USD','Markdown','defineProperty','telegramBotService','This\x20is\x20a\x20test\x20notification','payment','map','username','query','51912372PcSXdI','User\x20disconnected\x20successfully','telegramId','filter','shop','test_payment_123','4434JLALbk','true','48zlZYwT','9MNVhwC','firstName','sendPaymentNotification','ceil','4887952fmYLcA','828biLkDc','sendTestNotification','status','50370GQkziK'];a12_0x2285=function(){return _0x1f9a4d;};return a12_0x2285();}function a12_0x3f96(_0x559ebf,_0x158ad4){const _0x22851e=a12_0x2285();return a12_0x3f96=function(_0x3f9670,_0x34c05d){_0x3f9670=_0x3f9670-0x6c;let _0x48d0dc=_0x22851e[_0x3f9670];return _0x48d0dc;},a12_0x3f96(_0x559ebf,_0x158ad4);}const a12_0x7cfb39=a12_0x3f96;(function(_0x233228,_0x2b0d2e){const _0x63681c=a12_0x3f96,_0x5901c9=_0x233228();while(!![]){try{const _0x100662=-parseInt(_0x63681c(0x7f))/0x1*(parseInt(_0x63681c(0x98))/0x2)+parseInt(_0x63681c(0x99))/0x3*(parseInt(_0x63681c(0xb5))/0x4)+-parseInt(_0x63681c(0x6c))/0x5*(parseInt(_0x63681c(0x96))/0x6)+-parseInt(_0x63681c(0x84))/0x7*(parseInt(_0x63681c(0x9d))/0x8)+parseInt(_0x63681c(0x9e))/0x9*(-parseInt(_0x63681c(0xa1))/0xa)+-parseInt(_0x63681c(0xa4))/0xb+parseInt(_0x63681c(0x90))/0xc*(parseInt(_0x63681c(0xa3))/0xd);if(_0x100662===_0x2b0d2e)break;else _0x5901c9['push'](_0x5901c9['shift']());}catch(_0x272d82){_0x5901c9['push'](_0x5901c9['shift']());}}}(a12_0x2285,0xc0d6e));var __importDefault=this&&this[a12_0x7cfb39(0x85)]||function(_0x5596a7){return _0x5596a7&&_0x5596a7['__esModule']?_0x5596a7:{'default':_0x5596a7};};Object[a12_0x7cfb39(0x89)](exports,'__esModule',{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x7cfb39(0xa5)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x1342de=a12_0x7cfb39;this['getBotStatus']=async(_0x585fce,_0x26b827,_0x457966)=>{const _0x29c1ab=a12_0x3f96;try{const _0x54eb83=telegramBotService_1[_0x29c1ab(0x8a)][_0x29c1ab(0x83)](),_0x384ca9=await database_1['default'][_0x29c1ab(0xb2)][_0x29c1ab(0x6f)](),_0x530508=await database_1[_0x29c1ab(0x77)][_0x29c1ab(0xb2)][_0x29c1ab(0x6f)]({'where':{'isVerified':!![]}}),_0x528e23=await database_1[_0x29c1ab(0x77)][_0x29c1ab(0xb2)][_0x29c1ab(0xaf)]({'by':[_0x29c1ab(0x70)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x26b827[_0x29c1ab(0x81)]({'success':!![],'result':{'bot':{'isActive':_0x54eb83[_0x29c1ab(0xb6)],'username':_0x54eb83['username']},'statistics':{'totalUsers':_0x384ca9,'verifiedUsers':_0x530508,'unverifiedUsers':_0x384ca9-_0x530508,'connectedShops':_0x528e23[_0x29c1ab(0x7e)]}}});}catch(_0x130f8e){_0x457966(_0x130f8e);}},this[_0x1342de(0xb0)]=async(_0x1878a,_0x20a27a,_0x42d3ed)=>{const _0x353bda=_0x1342de;try{const {page:page=0x1,limit:limit=0x14,verified:_0x23f5d5}=_0x1878a[_0x353bda(0x8f)],_0x3e7168=(Number(page)-0x1)*Number(limit),_0x2f85bd={};_0x23f5d5!==undefined&&(_0x2f85bd[_0x353bda(0xaa)]=_0x23f5d5===_0x353bda(0x97));const [_0x40699e,_0x28691c]=await Promise[_0x353bda(0xac)]([database_1[_0x353bda(0x77)][_0x353bda(0xb2)][_0x353bda(0x82)]({'where':_0x2f85bd,'skip':_0x3e7168,'take':Number(limit),'orderBy':{'createdAt':_0x353bda(0xab)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['telegramUser'][_0x353bda(0x6f)]({'where':_0x2f85bd})]);_0x20a27a['json']({'success':!![],'users':_0x40699e[_0x353bda(0x8d)](_0x4eaf3e=>({'id':_0x4eaf3e['id'],'telegramId':_0x4eaf3e[_0x353bda(0x92)],'username':_0x4eaf3e[_0x353bda(0x8e)],'firstName':_0x4eaf3e[_0x353bda(0x9a)],'lastName':_0x4eaf3e[_0x353bda(0x7a)],'isVerified':_0x4eaf3e[_0x353bda(0xaa)],'shop':_0x4eaf3e[_0x353bda(0x94)],'createdAt':_0x4eaf3e['createdAt'],'updatedAt':_0x4eaf3e[_0x353bda(0x79)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x28691c,'totalPages':Math[_0x353bda(0x9c)](_0x28691c/Number(limit))}});}catch(_0x4d3378){_0x42d3ed(_0x4d3378);}},this[_0x1342de(0x75)]=async(_0x5c518f,_0x2bec11,_0x10b5c2)=>{const _0x5e9172=_0x1342de;try{const {message:_0x1942ce,shopId:_0x5e7f70}=_0x5c518f[_0x5e9172(0xa2)];if(!_0x1942ce)return _0x2bec11[_0x5e9172(0xa0)](0x190)[_0x5e9172(0x81)]({'success':![],'message':_0x5e9172(0xb3)});if(_0x5e7f70)await telegramBotService_1[_0x5e9172(0x8a)]['sendShopNotification'](_0x5e7f70,_0x1942ce,{'parse_mode':_0x5e9172(0x88)});else{const _0x29e443=await database_1[_0x5e9172(0x77)][_0x5e9172(0xb2)][_0x5e9172(0x82)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4fac6f=[...new Set(_0x29e443[_0x5e9172(0x8d)](_0x5b8155=>_0x5b8155['shopId'])[_0x5e9172(0x93)](Boolean))];for(const _0x152bd1 of _0x4fac6f){_0x152bd1&&await telegramBotService_1[_0x5e9172(0x8a)]['sendShopNotification'](_0x152bd1,_0x1942ce,{'parse_mode':_0x5e9172(0x88)});}}_0x2bec11[_0x5e9172(0x81)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x28dcc1){_0x10b5c2(_0x28dcc1);}},this[_0x1342de(0x6d)]=async(_0x1cabc8,_0x3cc5ba,_0x18a0a0)=>{const _0x583725=_0x1342de;try{const {telegramId:_0x2b4be8}=_0x1cabc8[_0x583725(0x72)],_0x39a008=await database_1[_0x583725(0x77)][_0x583725(0xb2)][_0x583725(0x80)]({'where':{'telegramId':_0x2b4be8},'include':{'shop':!![]}});if(!_0x39a008)return _0x3cc5ba[_0x583725(0xa0)](0x194)[_0x583725(0x81)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x583725(0xb2)]['update']({'where':{'telegramId':_0x2b4be8},'data':{'shopId':null,'isVerified':![]}}),_0x3cc5ba[_0x583725(0x81)]({'success':!![],'message':_0x583725(0x91)});}catch(_0x299b85){_0x18a0a0(_0x299b85);}},this[_0x1342de(0x9f)]=async(_0x1166cc,_0x214a8e,_0x5470a6)=>{const _0x2958cc=_0x1342de;try{const {shopId:_0x5ee5f9,type:type='payment',testData:_0x50fcc3}=_0x1166cc[_0x2958cc(0xa2)];if(!_0x5ee5f9)return _0x214a8e[_0x2958cc(0xa0)](0x190)[_0x2958cc(0x81)]({'success':![],'message':_0x2958cc(0x86)});const _0x5e5db5=await database_1[_0x2958cc(0x77)][_0x2958cc(0x94)][_0x2958cc(0x80)]({'where':{'id':_0x5ee5f9},'select':{'id':!![],'name':!![]}});if(!_0x5e5db5)return _0x214a8e[_0x2958cc(0xa0)](0x194)[_0x2958cc(0x81)]({'success':![],'message':_0x2958cc(0xae)});switch(type){case _0x2958cc(0x8c):const _0x40a4d3={'id':_0x2958cc(0x95),'amount':_0x50fcc3?.['amount']||0x64,'currency':_0x50fcc3?.[_0x2958cc(0x74)]||_0x2958cc(0x87),'productName':_0x50fcc3?.[_0x2958cc(0x7d)]||'Test\x20Product','gateway':_0x50fcc3?.[_0x2958cc(0x73)]||'plisio','createdAt':new Date(),..._0x50fcc3};await telegramBotService_1[_0x2958cc(0x8a)][_0x2958cc(0x9b)](_0x5ee5f9,_0x40a4d3,_0x2958cc(0xa8));break;case _0x2958cc(0x78):const _0x49340e={'id':_0x2958cc(0x6e),'amount':_0x50fcc3?.[_0x2958cc(0x76)]||0x1f4,'method':_0x50fcc3?.[_0x2958cc(0xb4)]||_0x2958cc(0x7c),'createdAt':new Date(),..._0x50fcc3};await telegramBotService_1[_0x2958cc(0x8a)]['sendPayoutNotification'](_0x5ee5f9,_0x49340e,_0x2958cc(0xa6));break;case _0x2958cc(0x7b):await telegramBotService_1[_0x2958cc(0x8a)]['sendCustomNotification'](_0x5ee5f9,_0x50fcc3?.[_0x2958cc(0xb1)]||'Test\x20Notification',_0x50fcc3?.[_0x2958cc(0xa9)]||{'message':_0x2958cc(0x8b)});break;default:return _0x214a8e['status'](0x190)['json']({'success':![],'message':_0x2958cc(0xa7)});}_0x214a8e[_0x2958cc(0x81)]({'success':!![],'message':_0x2958cc(0xad)+type+_0x2958cc(0x71)});}catch(_0x336351){_0x5470a6(_0x336351);}};}}exports['TelegramController']=TelegramController;