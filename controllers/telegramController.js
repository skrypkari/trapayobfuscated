'use strict';const a12_0x38e3be=a12_0x270e;(function(_0x54cad4,_0x19ea2e){const _0x4912a7=a12_0x270e,_0x48c072=_0x54cad4();while(!![]){try{const _0x54a03a=parseInt(_0x4912a7(0x89))/0x1*(parseInt(_0x4912a7(0xa6))/0x2)+parseInt(_0x4912a7(0xbd))/0x3+-parseInt(_0x4912a7(0x8d))/0x4*(-parseInt(_0x4912a7(0x7e))/0x5)+-parseInt(_0x4912a7(0xa0))/0x6*(parseInt(_0x4912a7(0x84))/0x7)+parseInt(_0x4912a7(0xa2))/0x8+parseInt(_0x4912a7(0xa4))/0x9+-parseInt(_0x4912a7(0x9e))/0xa*(parseInt(_0x4912a7(0xa1))/0xb);if(_0x54a03a===_0x19ea2e)break;else _0x48c072['push'](_0x48c072['shift']());}catch(_0xba70d7){_0x48c072['push'](_0x48c072['shift']());}}}(a12_0x15c7,0xafaac));var __importDefault=this&&this[a12_0x38e3be(0xb3)]||function(_0x25059e){const _0x23b071=a12_0x38e3be;return _0x25059e&&_0x25059e[_0x23b071(0x8e)]?_0x25059e:{'default':_0x25059e};};Object['defineProperty'](exports,a12_0x38e3be(0x8e),{'value':!![]}),exports[a12_0x38e3be(0xb7)]=void 0x0;const telegramBotService_1=require(a12_0x38e3be(0x97)),database_1=__importDefault(require(a12_0x38e3be(0x86)));class TelegramController{constructor(){const _0x19de05=a12_0x38e3be;this['getBotStatus']=async(_0x8a230b,_0x4a6de5,_0x558aa9)=>{const _0xd53b4e=a12_0x270e;try{const _0x31e5df=telegramBotService_1[_0xd53b4e(0xb8)][_0xd53b4e(0x85)](),_0xa0ccaf=await database_1[_0xd53b4e(0x7c)][_0xd53b4e(0x8c)][_0xd53b4e(0x7a)](),_0x1dd761=await database_1[_0xd53b4e(0x7c)][_0xd53b4e(0x8c)][_0xd53b4e(0x7a)]({'where':{'isVerified':!![]}}),_0x1b2e58=await database_1[_0xd53b4e(0x7c)][_0xd53b4e(0x8c)][_0xd53b4e(0xab)]({'by':[_0xd53b4e(0xa3)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4a6de5[_0xd53b4e(0x96)]({'success':!![],'result':{'bot':{'isActive':_0x31e5df[_0xd53b4e(0xbc)],'username':_0x31e5df[_0xd53b4e(0x99)]},'statistics':{'totalUsers':_0xa0ccaf,'verifiedUsers':_0x1dd761,'unverifiedUsers':_0xa0ccaf-_0x1dd761,'connectedShops':_0x1b2e58['length']}}});}catch(_0x284ebb){_0x558aa9(_0x284ebb);}},this[_0x19de05(0x7d)]=async(_0x1c8472,_0x279a1e,_0x30a393)=>{const _0x178a6d=_0x19de05;try{const {page:page=0x1,limit:limit=0x14,verified:_0x11b3c8}=_0x1c8472[_0x178a6d(0x90)],_0xe809f5=(Number(page)-0x1)*Number(limit),_0x55fc2f={};_0x11b3c8!==undefined&&(_0x55fc2f['isVerified']=_0x11b3c8===_0x178a6d(0xba));const [_0x49087e,_0x54d2a0]=await Promise['all']([database_1[_0x178a6d(0x7c)]['telegramUser']['findMany']({'where':_0x55fc2f,'skip':_0xe809f5,'take':Number(limit),'orderBy':{'createdAt':_0x178a6d(0x82)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x178a6d(0x7c)]['telegramUser'][_0x178a6d(0x7a)]({'where':_0x55fc2f})]);_0x279a1e[_0x178a6d(0x96)]({'success':!![],'users':_0x49087e[_0x178a6d(0x8b)](_0x5265a7=>({'id':_0x5265a7['id'],'telegramId':_0x5265a7[_0x178a6d(0xb6)],'username':_0x5265a7['username'],'firstName':_0x5265a7['firstName'],'lastName':_0x5265a7[_0x178a6d(0x9a)],'isVerified':_0x5265a7[_0x178a6d(0xad)],'shop':_0x5265a7[_0x178a6d(0xaa)],'createdAt':_0x5265a7[_0x178a6d(0x9c)],'updatedAt':_0x5265a7[_0x178a6d(0xae)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x54d2a0,'totalPages':Math[_0x178a6d(0xb4)](_0x54d2a0/Number(limit))}});}catch(_0x2b7472){_0x30a393(_0x2b7472);}},this[_0x19de05(0xbe)]=async(_0x306175,_0x257128,_0x43fc6d)=>{const _0x2d3311=_0x19de05;try{const {message:_0x46ae8f,shopId:_0x136616}=_0x306175['body'];if(!_0x46ae8f)return _0x257128[_0x2d3311(0x7f)](0x190)[_0x2d3311(0x96)]({'success':![],'message':'Message\x20is\x20required'});if(_0x136616)await telegramBotService_1['telegramBotService'][_0x2d3311(0xa8)](_0x136616,_0x46ae8f,{'parse_mode':_0x2d3311(0x83)});else{const _0x4086f2=await database_1[_0x2d3311(0x7c)]['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x36650b=[...new Set(_0x4086f2['map'](_0x18148c=>_0x18148c[_0x2d3311(0xa3)])[_0x2d3311(0x88)](Boolean))];for(const _0x1d3653 of _0x36650b){_0x1d3653&&await telegramBotService_1[_0x2d3311(0xb8)][_0x2d3311(0xa8)](_0x1d3653,_0x46ae8f,{'parse_mode':_0x2d3311(0x83)});}}_0x257128[_0x2d3311(0x96)]({'success':!![],'message':_0x2d3311(0x7b)});}catch(_0x43e4f8){_0x43fc6d(_0x43e4f8);}},this[_0x19de05(0x8f)]=async(_0x3f8bba,_0x812dcf,_0x87d7dc)=>{const _0x174b64=_0x19de05;try{const {telegramId:_0x14fa83}=_0x3f8bba[_0x174b64(0xb2)],_0x2bc851=await database_1['default'][_0x174b64(0x8c)]['findUnique']({'where':{'telegramId':_0x14fa83},'include':{'shop':!![]}});if(!_0x2bc851)return _0x812dcf[_0x174b64(0x7f)](0x194)[_0x174b64(0x96)]({'success':![],'message':_0x174b64(0xb9)});await database_1[_0x174b64(0x7c)][_0x174b64(0x8c)][_0x174b64(0xb5)]({'where':{'telegramId':_0x14fa83},'data':{'shopId':null,'isVerified':![]}}),_0x812dcf['json']({'success':!![],'message':_0x174b64(0x9b)});}catch(_0x5ea602){_0x87d7dc(_0x5ea602);}},this[_0x19de05(0xc0)]=async(_0x1f102a,_0x3f01b4,_0x132cfd)=>{const _0x20bd9e=_0x19de05;try{const {shopId:_0x212523,type:type=_0x20bd9e(0xac),testData:_0x5e7adb}=_0x1f102a[_0x20bd9e(0x79)];if(!_0x212523)return _0x3f01b4[_0x20bd9e(0x7f)](0x190)[_0x20bd9e(0x96)]({'success':![],'message':_0x20bd9e(0xbb)});const _0x63b9b7=await database_1[_0x20bd9e(0x7c)][_0x20bd9e(0xaa)][_0x20bd9e(0x9d)]({'where':{'id':_0x212523},'select':{'id':!![],'name':!![]}});if(!_0x63b9b7)return _0x3f01b4[_0x20bd9e(0x7f)](0x194)[_0x20bd9e(0x96)]({'success':![],'message':_0x20bd9e(0x8a)});switch(type){case _0x20bd9e(0xac):const _0x55033c={'id':_0x20bd9e(0xa5),'amount':_0x5e7adb?.[_0x20bd9e(0xa7)]||0x64,'currency':_0x5e7adb?.[_0x20bd9e(0x94)]||_0x20bd9e(0x98),'productName':_0x5e7adb?.[_0x20bd9e(0xbf)]||'Test\x20Product','gateway':_0x5e7adb?.[_0x20bd9e(0x80)]||_0x20bd9e(0xa9),'createdAt':new Date(),..._0x5e7adb};await telegramBotService_1[_0x20bd9e(0xb8)]['sendPaymentNotification'](_0x212523,_0x55033c,'paid');break;case _0x20bd9e(0x95):const _0x41f608={'id':_0x20bd9e(0x81),'amount':_0x5e7adb?.[_0x20bd9e(0xa7)]||0x1f4,'method':_0x5e7adb?.['method']||_0x20bd9e(0x77),'createdAt':new Date(),..._0x5e7adb};await telegramBotService_1[_0x20bd9e(0xb8)][_0x20bd9e(0x92)](_0x212523,_0x41f608,'completed');break;case _0x20bd9e(0x87):await telegramBotService_1[_0x20bd9e(0xb8)]['sendCustomNotification'](_0x212523,_0x5e7adb?.[_0x20bd9e(0xb0)]||_0x20bd9e(0x78),_0x5e7adb?.[_0x20bd9e(0x9f)]||{'message':_0x20bd9e(0xb1)});break;default:return _0x3f01b4[_0x20bd9e(0x7f)](0x190)[_0x20bd9e(0x96)]({'success':![],'message':_0x20bd9e(0x93)});}_0x3f01b4[_0x20bd9e(0x96)]({'success':!![],'message':_0x20bd9e(0xaf)+type+_0x20bd9e(0x91)});}catch(_0x54cce0){_0x132cfd(_0x54cce0);}};}}function a12_0x270e(_0x324145,_0x264b12){const _0x15c740=a12_0x15c7();return a12_0x270e=function(_0x270ec8,_0x1650c8){_0x270ec8=_0x270ec8-0x77;let _0x4e3fb8=_0x15c740[_0x270ec8];return _0x4e3fb8;},a12_0x270e(_0x324145,_0x264b12);}function a12_0x15c7(){const _0x5b3d61=['test_payment_123','786ySTNoT','amount','sendShopNotification','plisio','shop','groupBy','payment','isVerified','updatedAt','Test\x20','title','This\x20is\x20a\x20test\x20notification','params','__importDefault','ceil','update','telegramId','TelegramController','telegramBotService','Telegram\x20user\x20not\x20found','true','Shop\x20ID\x20is\x20required','isActive','3775353MlyyNs','sendBroadcast','productName','sendTestNotification','bank_transfer','Test\x20Notification','body','count','Broadcast\x20message\x20sent\x20successfully','default','getTelegramUsers','66435SJNKgi','status','gateway','test_payout_123','desc','Markdown','169883kwGpjD','getBotInfo','../config/database','custom','filter','1492nGkXrp','Shop\x20not\x20found','map','telegramUser','300YQJGrA','__esModule','disconnectUser','query','\x20notification\x20sent\x20successfully','sendPayoutNotification','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','currency','payout','json','../services/telegramBotService','USD','username','lastName','User\x20disconnected\x20successfully','createdAt','findUnique','5210EZXzUK','details','6BRuwCp','85415PJQXPz','11307432fJOCSp','shopId','4811445kRCUlF'];a12_0x15c7=function(){return _0x5b3d61;};return a12_0x15c7();}exports[a12_0x38e3be(0xb7)]=TelegramController;