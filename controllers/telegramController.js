'use strict';function a12_0x4e53(_0x2a4fb3,_0x5b9f36){const _0x1253a2=a12_0x1253();return a12_0x4e53=function(_0x4e5352,_0xb8fb46){_0x4e5352=_0x4e5352-0x19f;let _0x57dc98=_0x1253a2[_0x4e5352];return _0x57dc98;},a12_0x4e53(_0x2a4fb3,_0x5b9f36);}const a12_0x453fcd=a12_0x4e53;(function(_0x4eba21,_0x4a32e3){const _0x4b4fbc=a12_0x4e53,_0x556083=_0x4eba21();while(!![]){try{const _0x146ab1=parseInt(_0x4b4fbc(0x1c9))/0x1+parseInt(_0x4b4fbc(0x1a2))/0x2+-parseInt(_0x4b4fbc(0x1bc))/0x3*(parseInt(_0x4b4fbc(0x1b4))/0x4)+parseInt(_0x4b4fbc(0x1a7))/0x5+parseInt(_0x4b4fbc(0x1af))/0x6*(parseInt(_0x4b4fbc(0x1e5))/0x7)+parseInt(_0x4b4fbc(0x1c7))/0x8*(-parseInt(_0x4b4fbc(0x19f))/0x9)+-parseInt(_0x4b4fbc(0x1bd))/0xa;if(_0x146ab1===_0x4a32e3)break;else _0x556083['push'](_0x556083['shift']());}catch(_0xfc0da8){_0x556083['push'](_0x556083['shift']());}}}(a12_0x1253,0x81c2d));function a12_0x1253(){const _0x30f423=['completed','map','1137168WWadbO','firstName','username','shopId','../config/database','4PcBfyJ','params','Markdown','ceil','body','__esModule','isVerified','Test\x20Notification','1058451ompaMS','13958940RpHANO','payment','details','amount','Message\x20is\x20required','shop','currency','productName','createdAt','Broadcast\x20message\x20sent\x20successfully','1168iGbEHC','sendBroadcast','801544QVEGDO','getTelegramUsers','Telegram\x20user\x20not\x20found','findMany','filter','custom','\x20notification\x20sent\x20successfully','updatedAt','bank_transfer','status','json','findUnique','count','USD','all','telegramUser','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','isActive','sendShopNotification','getBotInfo','plisio','Test\x20','sendPaymentNotification','title','default','telegramBotService','../services/telegramBotService','test_payment_123','28oaHoCg','desc','57096MBibMH','Shop\x20not\x20found','Shop\x20ID\x20is\x20required','1670306HsiNJG','gateway','This\x20is\x20a\x20test\x20notification','sendCustomNotification','defineProperty','4058135vxsVlB','query','paid','__importDefault','Test\x20Product','test_payout_123'];a12_0x1253=function(){return _0x30f423;};return a12_0x1253();}var __importDefault=this&&this[a12_0x453fcd(0x1aa)]||function(_0x35ba6f){const _0x356693=a12_0x453fcd;return _0x35ba6f&&_0x35ba6f[_0x356693(0x1b9)]?_0x35ba6f:{'default':_0x35ba6f};};Object[a12_0x453fcd(0x1a6)](exports,a12_0x453fcd(0x1b9),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x453fcd(0x1e3)),database_1=__importDefault(require(a12_0x453fcd(0x1b3)));class TelegramController{constructor(){const _0x4c8e7e=a12_0x453fcd;this['getBotStatus']=async(_0x2b2bdb,_0x338250,_0xbcaf7a)=>{const _0x494c94=a12_0x4e53;try{const _0x11edb7=telegramBotService_1[_0x494c94(0x1e2)][_0x494c94(0x1dc)](),_0x39aad4=await database_1[_0x494c94(0x1e1)]['telegramUser'][_0x494c94(0x1d5)](),_0x48c373=await database_1[_0x494c94(0x1e1)][_0x494c94(0x1d8)][_0x494c94(0x1d5)]({'where':{'isVerified':!![]}}),_0x594239=await database_1[_0x494c94(0x1e1)]['telegramUser']['groupBy']({'by':[_0x494c94(0x1b2)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x338250[_0x494c94(0x1d3)]({'success':!![],'result':{'bot':{'isActive':_0x11edb7[_0x494c94(0x1da)],'username':_0x11edb7[_0x494c94(0x1b1)]},'statistics':{'totalUsers':_0x39aad4,'verifiedUsers':_0x48c373,'unverifiedUsers':_0x39aad4-_0x48c373,'connectedShops':_0x594239['length']}}});}catch(_0x4e410a){_0xbcaf7a(_0x4e410a);}},this[_0x4c8e7e(0x1ca)]=async(_0x19a0b3,_0x3316e3,_0x553af3)=>{const _0x5f4612=_0x4c8e7e;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4663aa}=_0x19a0b3[_0x5f4612(0x1a8)],_0x23a1c2=(Number(page)-0x1)*Number(limit),_0x137e23={};_0x4663aa!==undefined&&(_0x137e23[_0x5f4612(0x1ba)]=_0x4663aa==='true');const [_0x538c81,_0x3c6f05]=await Promise[_0x5f4612(0x1d7)]([database_1[_0x5f4612(0x1e1)][_0x5f4612(0x1d8)][_0x5f4612(0x1cc)]({'where':_0x137e23,'skip':_0x23a1c2,'take':Number(limit),'orderBy':{'createdAt':_0x5f4612(0x1e6)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5f4612(0x1e1)][_0x5f4612(0x1d8)][_0x5f4612(0x1d5)]({'where':_0x137e23})]);_0x3316e3[_0x5f4612(0x1d3)]({'success':!![],'users':_0x538c81[_0x5f4612(0x1ae)](_0x5ef6d3=>({'id':_0x5ef6d3['id'],'telegramId':_0x5ef6d3['telegramId'],'username':_0x5ef6d3[_0x5f4612(0x1b1)],'firstName':_0x5ef6d3[_0x5f4612(0x1b0)],'lastName':_0x5ef6d3['lastName'],'isVerified':_0x5ef6d3['isVerified'],'shop':_0x5ef6d3['shop'],'createdAt':_0x5ef6d3[_0x5f4612(0x1c5)],'updatedAt':_0x5ef6d3[_0x5f4612(0x1d0)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3c6f05,'totalPages':Math[_0x5f4612(0x1b7)](_0x3c6f05/Number(limit))}});}catch(_0x4dfc5f){_0x553af3(_0x4dfc5f);}},this[_0x4c8e7e(0x1c8)]=async(_0x25cbfd,_0xa92f3,_0x2add43)=>{const _0x28e814=_0x4c8e7e;try{const {message:_0x223d2d,shopId:_0x542bd7}=_0x25cbfd[_0x28e814(0x1b8)];if(!_0x223d2d)return _0xa92f3['status'](0x190)[_0x28e814(0x1d3)]({'success':![],'message':_0x28e814(0x1c1)});if(_0x542bd7)await telegramBotService_1[_0x28e814(0x1e2)][_0x28e814(0x1db)](_0x542bd7,_0x223d2d,{'parse_mode':_0x28e814(0x1b6)});else{const _0x29dd9f=await database_1[_0x28e814(0x1e1)][_0x28e814(0x1d8)][_0x28e814(0x1cc)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2183a3=[...new Set(_0x29dd9f['map'](_0x33fb62=>_0x33fb62[_0x28e814(0x1b2)])[_0x28e814(0x1cd)](Boolean))];for(const _0x3b4498 of _0x2183a3){_0x3b4498&&await telegramBotService_1['telegramBotService'][_0x28e814(0x1db)](_0x3b4498,_0x223d2d,{'parse_mode':_0x28e814(0x1b6)});}}_0xa92f3[_0x28e814(0x1d3)]({'success':!![],'message':_0x28e814(0x1c6)});}catch(_0x43f124){_0x2add43(_0x43f124);}},this['disconnectUser']=async(_0x19b7ce,_0x2b3c3d,_0x5c48fc)=>{const _0x1d7743=_0x4c8e7e;try{const {telegramId:_0x47efa5}=_0x19b7ce[_0x1d7743(0x1b5)],_0x2f89a3=await database_1[_0x1d7743(0x1e1)][_0x1d7743(0x1d8)]['findUnique']({'where':{'telegramId':_0x47efa5},'include':{'shop':!![]}});if(!_0x2f89a3)return _0x2b3c3d[_0x1d7743(0x1d2)](0x194)[_0x1d7743(0x1d3)]({'success':![],'message':_0x1d7743(0x1cb)});await database_1[_0x1d7743(0x1e1)][_0x1d7743(0x1d8)]['update']({'where':{'telegramId':_0x47efa5},'data':{'shopId':null,'isVerified':![]}}),_0x2b3c3d[_0x1d7743(0x1d3)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x57250e){_0x5c48fc(_0x57250e);}},this['sendTestNotification']=async(_0x4b2b13,_0x3fd7c5,_0x3622c1)=>{const _0x55a6ef=_0x4c8e7e;try{const {shopId:_0x3d16d4,type:type=_0x55a6ef(0x1be),testData:_0x5c9c44}=_0x4b2b13[_0x55a6ef(0x1b8)];if(!_0x3d16d4)return _0x3fd7c5['status'](0x190)[_0x55a6ef(0x1d3)]({'success':![],'message':_0x55a6ef(0x1a1)});const _0x21bd5c=await database_1[_0x55a6ef(0x1e1)][_0x55a6ef(0x1c2)][_0x55a6ef(0x1d4)]({'where':{'id':_0x3d16d4},'select':{'id':!![],'name':!![]}});if(!_0x21bd5c)return _0x3fd7c5['status'](0x194)[_0x55a6ef(0x1d3)]({'success':![],'message':_0x55a6ef(0x1a0)});switch(type){case _0x55a6ef(0x1be):const _0x599ae2={'id':_0x55a6ef(0x1e4),'amount':_0x5c9c44?.[_0x55a6ef(0x1c0)]||0x64,'currency':_0x5c9c44?.[_0x55a6ef(0x1c3)]||_0x55a6ef(0x1d6),'productName':_0x5c9c44?.[_0x55a6ef(0x1c4)]||_0x55a6ef(0x1ab),'gateway':_0x5c9c44?.[_0x55a6ef(0x1a3)]||_0x55a6ef(0x1dd),'createdAt':new Date(),..._0x5c9c44};await telegramBotService_1['telegramBotService'][_0x55a6ef(0x1df)](_0x3d16d4,_0x599ae2,_0x55a6ef(0x1a9));break;case'payout':const _0x83c18c={'id':_0x55a6ef(0x1ac),'amount':_0x5c9c44?.['amount']||0x1f4,'method':_0x5c9c44?.['method']||_0x55a6ef(0x1d1),'createdAt':new Date(),..._0x5c9c44};await telegramBotService_1[_0x55a6ef(0x1e2)]['sendPayoutNotification'](_0x3d16d4,_0x83c18c,_0x55a6ef(0x1ad));break;case _0x55a6ef(0x1ce):await telegramBotService_1[_0x55a6ef(0x1e2)][_0x55a6ef(0x1a5)](_0x3d16d4,_0x5c9c44?.[_0x55a6ef(0x1e0)]||_0x55a6ef(0x1bb),_0x5c9c44?.[_0x55a6ef(0x1bf)]||{'message':_0x55a6ef(0x1a4)});break;default:return _0x3fd7c5['status'](0x190)['json']({'success':![],'message':_0x55a6ef(0x1d9)});}_0x3fd7c5[_0x55a6ef(0x1d3)]({'success':!![],'message':_0x55a6ef(0x1de)+type+_0x55a6ef(0x1cf)});}catch(_0x12f00b){_0x3622c1(_0x12f00b);}};}}exports['TelegramController']=TelegramController;