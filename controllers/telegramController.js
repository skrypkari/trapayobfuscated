'use strict';const a12_0x10dd9c=a12_0x5b9e;(function(_0x835398,_0x9bd440){const _0x51e1be=a12_0x5b9e,_0x4c5f0f=_0x835398();while(!![]){try{const _0x3b2571=parseInt(_0x51e1be(0x209))/0x1+parseInt(_0x51e1be(0x1fc))/0x2+-parseInt(_0x51e1be(0x1f8))/0x3+parseInt(_0x51e1be(0x201))/0x4*(-parseInt(_0x51e1be(0x1ed))/0x5)+parseInt(_0x51e1be(0x204))/0x6+parseInt(_0x51e1be(0x1ec))/0x7+-parseInt(_0x51e1be(0x1ee))/0x8*(parseInt(_0x51e1be(0x1f3))/0x9);if(_0x3b2571===_0x9bd440)break;else _0x4c5f0f['push'](_0x4c5f0f['shift']());}catch(_0xbb8d86){_0x4c5f0f['push'](_0x4c5f0f['shift']());}}}(a12_0x26a3,0x49259));var __importDefault=this&&this[a12_0x10dd9c(0x1da)]||function(_0x1dc285){return _0x1dc285&&_0x1dc285['__esModule']?_0x1dc285:{'default':_0x1dc285};};Object[a12_0x10dd9c(0x1dd)](exports,'__esModule',{'value':!![]}),exports[a12_0x10dd9c(0x213)]=void 0x0;function a12_0x26a3(){const _0x4ffbec=['getBotInfo','test_payout_123','payout','TelegramController','map','getBotStatus','params','json','updatedAt','createdAt','currency','findMany','findUnique','count','shop','__importDefault','status','true','defineProperty','sendPaymentNotification','details','Test\x20Notification','username','User\x20disconnected\x20successfully','Telegram\x20user\x20not\x20found','query','sendCustomNotification','method','body','\x20notification\x20sent\x20successfully','sendPayoutNotification','productName','length','31598uaXZrV','105thpLHi','180568GDCYSI','update','custom','telegramUser','firstName','63BxQXIJ','USD','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','sendBroadcast','telegramBotService','1743327xOxSrw','payment','shopId','../config/database','949314BZqFhT','default','title','Markdown','Test\x20','24292CFrQkH','amount','sendShopNotification','1348896TpqtsY','completed','getTelegramUsers','ceil','all','462261hPoIGs','groupBy','disconnectUser','Broadcast\x20message\x20sent\x20successfully','Message\x20is\x20required','bank_transfer','Test\x20Product'];a12_0x26a3=function(){return _0x4ffbec;};return a12_0x26a3();}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x10dd9c(0x1fb)));class TelegramController{constructor(){const _0x5aebcf=a12_0x10dd9c;this[_0x5aebcf(0x215)]=async(_0x39ad4b,_0x3bd62f,_0x43c4b6)=>{const _0x1f7564=_0x5aebcf;try{const _0x2f103a=telegramBotService_1['telegramBotService'][_0x1f7564(0x210)](),_0x34720f=await database_1['default'][_0x1f7564(0x1f1)][_0x1f7564(0x1d8)](),_0x325aec=await database_1[_0x1f7564(0x1fd)][_0x1f7564(0x1f1)]['count']({'where':{'isVerified':!![]}}),_0x110b84=await database_1[_0x1f7564(0x1fd)][_0x1f7564(0x1f1)][_0x1f7564(0x20a)]({'by':[_0x1f7564(0x1fa)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3bd62f[_0x1f7564(0x1d2)]({'success':!![],'result':{'bot':{'isActive':_0x2f103a['isActive'],'username':_0x2f103a[_0x1f7564(0x1e1)]},'statistics':{'totalUsers':_0x34720f,'verifiedUsers':_0x325aec,'unverifiedUsers':_0x34720f-_0x325aec,'connectedShops':_0x110b84[_0x1f7564(0x1eb)]}}});}catch(_0x1dbb63){_0x43c4b6(_0x1dbb63);}},this[_0x5aebcf(0x206)]=async(_0x324545,_0x30e2f5,_0x3c2118)=>{const _0x53b520=_0x5aebcf;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2c0b01}=_0x324545[_0x53b520(0x1e4)],_0x658260=(Number(page)-0x1)*Number(limit),_0x2be791={};_0x2c0b01!==undefined&&(_0x2be791['isVerified']=_0x2c0b01===_0x53b520(0x1dc));const [_0x1be0b4,_0x3b889]=await Promise[_0x53b520(0x208)]([database_1[_0x53b520(0x1fd)][_0x53b520(0x1f1)]['findMany']({'where':_0x2be791,'skip':_0x658260,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x53b520(0x1f1)][_0x53b520(0x1d8)]({'where':_0x2be791})]);_0x30e2f5['json']({'success':!![],'users':_0x1be0b4[_0x53b520(0x214)](_0x1f76df=>({'id':_0x1f76df['id'],'telegramId':_0x1f76df['telegramId'],'username':_0x1f76df[_0x53b520(0x1e1)],'firstName':_0x1f76df[_0x53b520(0x1f2)],'lastName':_0x1f76df['lastName'],'isVerified':_0x1f76df['isVerified'],'shop':_0x1f76df[_0x53b520(0x1d9)],'createdAt':_0x1f76df[_0x53b520(0x1d4)],'updatedAt':_0x1f76df[_0x53b520(0x1d3)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3b889,'totalPages':Math[_0x53b520(0x207)](_0x3b889/Number(limit))}});}catch(_0x26d947){_0x3c2118(_0x26d947);}},this[_0x5aebcf(0x1f6)]=async(_0x45f5a2,_0x1dad02,_0x1915eb)=>{const _0x1a3d29=_0x5aebcf;try{const {message:_0x5b5071,shopId:_0x1bcb57}=_0x45f5a2[_0x1a3d29(0x1e7)];if(!_0x5b5071)return _0x1dad02[_0x1a3d29(0x1db)](0x190)[_0x1a3d29(0x1d2)]({'success':![],'message':_0x1a3d29(0x20d)});if(_0x1bcb57)await telegramBotService_1[_0x1a3d29(0x1f7)][_0x1a3d29(0x203)](_0x1bcb57,_0x5b5071,{'parse_mode':'Markdown'});else{const _0x4a1bee=await database_1[_0x1a3d29(0x1fd)][_0x1a3d29(0x1f1)][_0x1a3d29(0x1d6)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4b841a=[...new Set(_0x4a1bee[_0x1a3d29(0x214)](_0x2102c4=>_0x2102c4[_0x1a3d29(0x1fa)])['filter'](Boolean))];for(const _0x3da568 of _0x4b841a){_0x3da568&&await telegramBotService_1[_0x1a3d29(0x1f7)][_0x1a3d29(0x203)](_0x3da568,_0x5b5071,{'parse_mode':_0x1a3d29(0x1ff)});}}_0x1dad02[_0x1a3d29(0x1d2)]({'success':!![],'message':_0x1a3d29(0x20c)});}catch(_0x29f6c4){_0x1915eb(_0x29f6c4);}},this[_0x5aebcf(0x20b)]=async(_0x3a6bef,_0x2a90b9,_0x4975ba)=>{const _0x1e7101=_0x5aebcf;try{const {telegramId:_0x13c763}=_0x3a6bef[_0x1e7101(0x216)],_0xe4cb21=await database_1['default'][_0x1e7101(0x1f1)][_0x1e7101(0x1d7)]({'where':{'telegramId':_0x13c763},'include':{'shop':!![]}});if(!_0xe4cb21)return _0x2a90b9[_0x1e7101(0x1db)](0x194)[_0x1e7101(0x1d2)]({'success':![],'message':_0x1e7101(0x1e3)});await database_1['default']['telegramUser'][_0x1e7101(0x1ef)]({'where':{'telegramId':_0x13c763},'data':{'shopId':null,'isVerified':![]}}),_0x2a90b9[_0x1e7101(0x1d2)]({'success':!![],'message':_0x1e7101(0x1e2)});}catch(_0x18341d){_0x4975ba(_0x18341d);}},this['sendTestNotification']=async(_0x10cbd3,_0xa71e84,_0x348e43)=>{const _0x5f2b8c=_0x5aebcf;try{const {shopId:_0x2eda84,type:type=_0x5f2b8c(0x1f9),testData:_0x1ab13e}=_0x10cbd3[_0x5f2b8c(0x1e7)];if(!_0x2eda84)return _0xa71e84[_0x5f2b8c(0x1db)](0x190)[_0x5f2b8c(0x1d2)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x1b5010=await database_1[_0x5f2b8c(0x1fd)]['shop']['findUnique']({'where':{'id':_0x2eda84},'select':{'id':!![],'name':!![]}});if(!_0x1b5010)return _0xa71e84['status'](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x5f2b8c(0x1f9):const _0x14154c={'id':'test_payment_123','amount':_0x1ab13e?.[_0x5f2b8c(0x202)]||0x64,'currency':_0x1ab13e?.[_0x5f2b8c(0x1d5)]||_0x5f2b8c(0x1f4),'productName':_0x1ab13e?.[_0x5f2b8c(0x1ea)]||_0x5f2b8c(0x20f),'gateway':_0x1ab13e?.['gateway']||'plisio','createdAt':new Date(),..._0x1ab13e};await telegramBotService_1[_0x5f2b8c(0x1f7)][_0x5f2b8c(0x1de)](_0x2eda84,_0x14154c,'paid');break;case _0x5f2b8c(0x212):const _0x31185f={'id':_0x5f2b8c(0x211),'amount':_0x1ab13e?.[_0x5f2b8c(0x202)]||0x1f4,'method':_0x1ab13e?.[_0x5f2b8c(0x1e6)]||_0x5f2b8c(0x20e),'createdAt':new Date(),..._0x1ab13e};await telegramBotService_1['telegramBotService'][_0x5f2b8c(0x1e9)](_0x2eda84,_0x31185f,_0x5f2b8c(0x205));break;case _0x5f2b8c(0x1f0):await telegramBotService_1[_0x5f2b8c(0x1f7)][_0x5f2b8c(0x1e5)](_0x2eda84,_0x1ab13e?.[_0x5f2b8c(0x1fe)]||_0x5f2b8c(0x1e0),_0x1ab13e?.[_0x5f2b8c(0x1df)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0xa71e84['status'](0x190)[_0x5f2b8c(0x1d2)]({'success':![],'message':_0x5f2b8c(0x1f5)});}_0xa71e84[_0x5f2b8c(0x1d2)]({'success':!![],'message':_0x5f2b8c(0x200)+type+_0x5f2b8c(0x1e8)});}catch(_0xc76113){_0x348e43(_0xc76113);}};}}function a12_0x5b9e(_0x46be1e,_0x18c19b){const _0x26a3a7=a12_0x26a3();return a12_0x5b9e=function(_0x5b9e62,_0x1fd30f){_0x5b9e62=_0x5b9e62-0x1d2;let _0x25cdf3=_0x26a3a7[_0x5b9e62];return _0x25cdf3;},a12_0x5b9e(_0x46be1e,_0x18c19b);}exports['TelegramController']=TelegramController;