'use strict';const a12_0x19cbb2=a12_0x3d30;(function(_0x3924d2,_0x2128e4){const _0x5bcfd8=a12_0x3d30,_0x4a0d4b=_0x3924d2();while(!![]){try{const _0x444c29=-parseInt(_0x5bcfd8(0x1ec))/0x1+parseInt(_0x5bcfd8(0x202))/0x2+parseInt(_0x5bcfd8(0x1dd))/0x3+parseInt(_0x5bcfd8(0x1df))/0x4+parseInt(_0x5bcfd8(0x1f6))/0x5*(parseInt(_0x5bcfd8(0x1ea))/0x6)+parseInt(_0x5bcfd8(0x200))/0x7+-parseInt(_0x5bcfd8(0x1d0))/0x8*(parseInt(_0x5bcfd8(0x207))/0x9);if(_0x444c29===_0x2128e4)break;else _0x4a0d4b['push'](_0x4a0d4b['shift']());}catch(_0x16e845){_0x4a0d4b['push'](_0x4a0d4b['shift']());}}}(a12_0x218b,0xbd7c3));function a12_0x218b(){const _0x4458ed=['update','Shop\x20not\x20found','test_payment_123','1131357KlVoNq','default','5013588fOIVvB','desc','sendPaymentNotification','title','plisio','sendShopNotification','json','../config/database','map','shopId','Message\x20is\x20required','144522owInaK','User\x20disconnected\x20successfully','317436HoDaJz','true','createdAt','length','lastName','../services/telegramBotService','getBotInfo','groupBy','findMany','USD','260BkRByv','bank_transfer','status','params','ceil','This\x20is\x20a\x20test\x20notification','__esModule','filter','gateway','currency','10203816hKRujR','TelegramController','1134736YPTxWL','query','isVerified','Shop\x20ID\x20is\x20required','username','34330761KUmrMl','shop','custom','sendCustomNotification','isActive','details','sendBroadcast','telegramUser','body','amount','__importDefault','telegramId','getBotStatus','telegramBotService','Test\x20Product','8POUvuU','payout','Markdown','findUnique','count','\x20notification\x20sent\x20successfully','completed','sendPayoutNotification','test_payout_123','paid'];a12_0x218b=function(){return _0x4458ed;};return a12_0x218b();}function a12_0x3d30(_0x5f481c,_0x4d49f0){const _0x218bf2=a12_0x218b();return a12_0x3d30=function(_0x3d30d8,_0x46c4a2){_0x3d30d8=_0x3d30d8-0x1c8;let _0x263cea=_0x218bf2[_0x3d30d8];return _0x263cea;},a12_0x3d30(_0x5f481c,_0x4d49f0);}var __importDefault=this&&this[a12_0x19cbb2(0x1cb)]||function(_0x4c4039){const _0x599c4d=a12_0x19cbb2;return _0x4c4039&&_0x4c4039[_0x599c4d(0x1fc)]?_0x4c4039:{'default':_0x4c4039};};Object['defineProperty'](exports,a12_0x19cbb2(0x1fc),{'value':!![]}),exports[a12_0x19cbb2(0x201)]=void 0x0;const telegramBotService_1=require(a12_0x19cbb2(0x1f1)),database_1=__importDefault(require(a12_0x19cbb2(0x1e6)));class TelegramController{constructor(){const _0x5b6332=a12_0x19cbb2;this[_0x5b6332(0x1cd)]=async(_0x45a637,_0x426ba7,_0x158f29)=>{const _0x3e6824=_0x5b6332;try{const _0x147709=telegramBotService_1['telegramBotService'][_0x3e6824(0x1f2)](),_0x363bbe=await database_1[_0x3e6824(0x1de)][_0x3e6824(0x1c8)][_0x3e6824(0x1d4)](),_0x37e400=await database_1['default'][_0x3e6824(0x1c8)][_0x3e6824(0x1d4)]({'where':{'isVerified':!![]}}),_0x4966bc=await database_1[_0x3e6824(0x1de)][_0x3e6824(0x1c8)][_0x3e6824(0x1f3)]({'by':[_0x3e6824(0x1e8)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x426ba7[_0x3e6824(0x1e5)]({'success':!![],'result':{'bot':{'isActive':_0x147709[_0x3e6824(0x20b)],'username':_0x147709[_0x3e6824(0x206)]},'statistics':{'totalUsers':_0x363bbe,'verifiedUsers':_0x37e400,'unverifiedUsers':_0x363bbe-_0x37e400,'connectedShops':_0x4966bc[_0x3e6824(0x1ef)]}}});}catch(_0x381866){_0x158f29(_0x381866);}},this['getTelegramUsers']=async(_0x47a2a9,_0x97d5e0,_0x33237d)=>{const _0x1bb840=_0x5b6332;try{const {page:page=0x1,limit:limit=0x14,verified:_0x18488e}=_0x47a2a9[_0x1bb840(0x203)],_0x491ba6=(Number(page)-0x1)*Number(limit),_0x4bfe71={};_0x18488e!==undefined&&(_0x4bfe71[_0x1bb840(0x204)]=_0x18488e===_0x1bb840(0x1ed));const [_0x91803c,_0x30cc4a]=await Promise['all']([database_1[_0x1bb840(0x1de)][_0x1bb840(0x1c8)][_0x1bb840(0x1f4)]({'where':_0x4bfe71,'skip':_0x491ba6,'take':Number(limit),'orderBy':{'createdAt':_0x1bb840(0x1e0)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1bb840(0x1de)][_0x1bb840(0x1c8)][_0x1bb840(0x1d4)]({'where':_0x4bfe71})]);_0x97d5e0[_0x1bb840(0x1e5)]({'success':!![],'users':_0x91803c[_0x1bb840(0x1e7)](_0x18504d=>({'id':_0x18504d['id'],'telegramId':_0x18504d[_0x1bb840(0x1cc)],'username':_0x18504d[_0x1bb840(0x206)],'firstName':_0x18504d['firstName'],'lastName':_0x18504d[_0x1bb840(0x1f0)],'isVerified':_0x18504d[_0x1bb840(0x204)],'shop':_0x18504d[_0x1bb840(0x208)],'createdAt':_0x18504d[_0x1bb840(0x1ee)],'updatedAt':_0x18504d['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x30cc4a,'totalPages':Math[_0x1bb840(0x1fa)](_0x30cc4a/Number(limit))}});}catch(_0x286c99){_0x33237d(_0x286c99);}},this[_0x5b6332(0x20d)]=async(_0x1f8f68,_0x59b09a,_0x24ffb9)=>{const _0x146349=_0x5b6332;try{const {message:_0x3faabe,shopId:_0x2ffaa1}=_0x1f8f68[_0x146349(0x1c9)];if(!_0x3faabe)return _0x59b09a[_0x146349(0x1f8)](0x190)[_0x146349(0x1e5)]({'success':![],'message':_0x146349(0x1e9)});if(_0x2ffaa1)await telegramBotService_1[_0x146349(0x1ce)]['sendShopNotification'](_0x2ffaa1,_0x3faabe,{'parse_mode':_0x146349(0x1d2)});else{const _0x457e91=await database_1[_0x146349(0x1de)][_0x146349(0x1c8)][_0x146349(0x1f4)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3b5262=[...new Set(_0x457e91[_0x146349(0x1e7)](_0xbf53bf=>_0xbf53bf[_0x146349(0x1e8)])[_0x146349(0x1fd)](Boolean))];for(const _0x6003e1 of _0x3b5262){_0x6003e1&&await telegramBotService_1[_0x146349(0x1ce)][_0x146349(0x1e4)](_0x6003e1,_0x3faabe,{'parse_mode':_0x146349(0x1d2)});}}_0x59b09a[_0x146349(0x1e5)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0xe8276a){_0x24ffb9(_0xe8276a);}},this['disconnectUser']=async(_0x1e0975,_0x1d5e18,_0xf9f7cb)=>{const _0x275a60=_0x5b6332;try{const {telegramId:_0x1b4e59}=_0x1e0975[_0x275a60(0x1f9)],_0x33f5d4=await database_1['default']['telegramUser'][_0x275a60(0x1d3)]({'where':{'telegramId':_0x1b4e59},'include':{'shop':!![]}});if(!_0x33f5d4)return _0x1d5e18[_0x275a60(0x1f8)](0x194)[_0x275a60(0x1e5)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x275a60(0x1c8)][_0x275a60(0x1da)]({'where':{'telegramId':_0x1b4e59},'data':{'shopId':null,'isVerified':![]}}),_0x1d5e18[_0x275a60(0x1e5)]({'success':!![],'message':_0x275a60(0x1eb)});}catch(_0xe9c0fd){_0xf9f7cb(_0xe9c0fd);}},this['sendTestNotification']=async(_0x3739d9,_0x46194d,_0x32c49b)=>{const _0x579ea2=_0x5b6332;try{const {shopId:_0x4ca630,type:type='payment',testData:_0x3f864c}=_0x3739d9['body'];if(!_0x4ca630)return _0x46194d['status'](0x190)[_0x579ea2(0x1e5)]({'success':![],'message':_0x579ea2(0x205)});const _0xf62f2b=await database_1[_0x579ea2(0x1de)]['shop'][_0x579ea2(0x1d3)]({'where':{'id':_0x4ca630},'select':{'id':!![],'name':!![]}});if(!_0xf62f2b)return _0x46194d[_0x579ea2(0x1f8)](0x194)[_0x579ea2(0x1e5)]({'success':![],'message':_0x579ea2(0x1db)});switch(type){case'payment':const _0x3be612={'id':_0x579ea2(0x1dc),'amount':_0x3f864c?.[_0x579ea2(0x1ca)]||0x64,'currency':_0x3f864c?.[_0x579ea2(0x1ff)]||_0x579ea2(0x1f5),'productName':_0x3f864c?.['productName']||_0x579ea2(0x1cf),'gateway':_0x3f864c?.[_0x579ea2(0x1fe)]||_0x579ea2(0x1e3),'createdAt':new Date(),..._0x3f864c};await telegramBotService_1['telegramBotService'][_0x579ea2(0x1e1)](_0x4ca630,_0x3be612,_0x579ea2(0x1d9));break;case _0x579ea2(0x1d1):const _0x46406c={'id':_0x579ea2(0x1d8),'amount':_0x3f864c?.['amount']||0x1f4,'method':_0x3f864c?.['method']||_0x579ea2(0x1f7),'createdAt':new Date(),..._0x3f864c};await telegramBotService_1['telegramBotService'][_0x579ea2(0x1d7)](_0x4ca630,_0x46406c,_0x579ea2(0x1d6));break;case _0x579ea2(0x209):await telegramBotService_1[_0x579ea2(0x1ce)][_0x579ea2(0x20a)](_0x4ca630,_0x3f864c?.[_0x579ea2(0x1e2)]||'Test\x20Notification',_0x3f864c?.[_0x579ea2(0x20c)]||{'message':_0x579ea2(0x1fb)});break;default:return _0x46194d[_0x579ea2(0x1f8)](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x46194d[_0x579ea2(0x1e5)]({'success':!![],'message':'Test\x20'+type+_0x579ea2(0x1d5)});}catch(_0x2a23ec){_0x32c49b(_0x2a23ec);}};}}exports[a12_0x19cbb2(0x201)]=TelegramController;