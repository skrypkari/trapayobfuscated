'use strict';const a14_0x2cca06=a14_0xa4e6;function a14_0xa4e6(_0x5b46dd,_0x179447){const _0x585282=a14_0x5852();return a14_0xa4e6=function(_0xa4e6bb,_0x521522){_0xa4e6bb=_0xa4e6bb-0x68;let _0x40de2e=_0x585282[_0xa4e6bb];return _0x40de2e;},a14_0xa4e6(_0x5b46dd,_0x179447);}(function(_0x1d4f81,_0x5483fb){const _0x122ac7=a14_0xa4e6,_0x48dadb=_0x1d4f81();while(!![]){try{const _0x4586ba=parseInt(_0x122ac7(0x7f))/0x1*(parseInt(_0x122ac7(0x8e))/0x2)+parseInt(_0x122ac7(0x6d))/0x3+-parseInt(_0x122ac7(0x91))/0x4+parseInt(_0x122ac7(0x71))/0x5*(-parseInt(_0x122ac7(0x93))/0x6)+-parseInt(_0x122ac7(0xad))/0x7*(parseInt(_0x122ac7(0xaa))/0x8)+-parseInt(_0x122ac7(0xa5))/0x9*(parseInt(_0x122ac7(0x9c))/0xa)+parseInt(_0x122ac7(0x90))/0xb;if(_0x4586ba===_0x5483fb)break;else _0x48dadb['push'](_0x48dadb['shift']());}catch(_0x256392){_0x48dadb['push'](_0x48dadb['shift']());}}}(a14_0x5852,0x53d1a));var __importDefault=this&&this['__importDefault']||function(_0x3ef5b0){const _0x11694e=a14_0xa4e6;return _0x3ef5b0&&_0x3ef5b0[_0x11694e(0xa2)]?_0x3ef5b0:{'default':_0x3ef5b0};};function a14_0x5852(){const _0x5878bc=['getBotInfo','This\x20is\x20a\x20test\x20notification','Shop\x20not\x20found','sendPaymentNotification','all','50420mqpHfN','USD','payment','body','sendShopNotification','payout','__esModule','params','paid','207XEJDTe','createdAt','username','telegramBotService','disconnectUser','549016MoYYnz','../config/database','Markdown','7Vzusef','sendCustomNotification','count','\x20notification\x20sent\x20successfully','status','User\x20disconnected\x20successfully','shopId','793929OEZoWB','findMany','isActive','shop','21165DwIZuz','bank_transfer','Telegram\x20user\x20not\x20found','plisio','gateway','Test\x20','json','../services/telegramBotService','custom','test_payout_123','amount','ceil','getBotStatus','map','815IKIljZ','title','Test\x20Product','telegramUser','query','Broadcast\x20message\x20sent\x20successfully','isVerified','findUnique','Shop\x20ID\x20is\x20required','sendBroadcast','defineProperty','default','TelegramController','filter','sendTestNotification','1452ditqSU','method','2707870nRbXLw','1502548VLxRzA','update','282TENbyX','groupBy','telegramId','details'];a14_0x5852=function(){return _0x5878bc;};return a14_0x5852();}Object[a14_0x2cca06(0x89)](exports,a14_0x2cca06(0xa2),{'value':!![]}),exports[a14_0x2cca06(0x8b)]=void 0x0;const telegramBotService_1=require(a14_0x2cca06(0x78)),database_1=__importDefault(require(a14_0x2cca06(0xab)));class TelegramController{constructor(){const _0x15eab0=a14_0x2cca06;this[_0x15eab0(0x7d)]=async(_0x47cd1d,_0x3cd69a,_0x43fdb3)=>{const _0x5e9046=_0x15eab0;try{const _0x3d30c5=telegramBotService_1[_0x5e9046(0xa8)][_0x5e9046(0x97)](),_0x27c5c3=await database_1[_0x5e9046(0x8a)][_0x5e9046(0x82)][_0x5e9046(0x68)](),_0x9be939=await database_1[_0x5e9046(0x8a)]['telegramUser'][_0x5e9046(0x68)]({'where':{'isVerified':!![]}}),_0x20c0ed=await database_1[_0x5e9046(0x8a)][_0x5e9046(0x82)][_0x5e9046(0x94)]({'by':[_0x5e9046(0x6c)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3cd69a['json']({'success':!![],'result':{'bot':{'isActive':_0x3d30c5[_0x5e9046(0x6f)],'username':_0x3d30c5[_0x5e9046(0xa7)]},'statistics':{'totalUsers':_0x27c5c3,'verifiedUsers':_0x9be939,'unverifiedUsers':_0x27c5c3-_0x9be939,'connectedShops':_0x20c0ed['length']}}});}catch(_0xc93029){_0x43fdb3(_0xc93029);}},this['getTelegramUsers']=async(_0x49dbcb,_0x55ca8a,_0x38039b)=>{const _0x5de2c9=_0x15eab0;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1c295d}=_0x49dbcb[_0x5de2c9(0x83)],_0x212d9d=(Number(page)-0x1)*Number(limit),_0x522ed4={};_0x1c295d!==undefined&&(_0x522ed4[_0x5de2c9(0x85)]=_0x1c295d==='true');const [_0x313e1e,_0x2f9517]=await Promise[_0x5de2c9(0x9b)]([database_1[_0x5de2c9(0x8a)][_0x5de2c9(0x82)][_0x5de2c9(0x6e)]({'where':_0x522ed4,'skip':_0x212d9d,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5de2c9(0x8a)][_0x5de2c9(0x82)][_0x5de2c9(0x68)]({'where':_0x522ed4})]);_0x55ca8a[_0x5de2c9(0x77)]({'success':!![],'users':_0x313e1e[_0x5de2c9(0x7e)](_0xfca312=>({'id':_0xfca312['id'],'telegramId':_0xfca312[_0x5de2c9(0x95)],'username':_0xfca312[_0x5de2c9(0xa7)],'firstName':_0xfca312['firstName'],'lastName':_0xfca312['lastName'],'isVerified':_0xfca312[_0x5de2c9(0x85)],'shop':_0xfca312[_0x5de2c9(0x70)],'createdAt':_0xfca312[_0x5de2c9(0xa6)],'updatedAt':_0xfca312['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2f9517,'totalPages':Math[_0x5de2c9(0x7c)](_0x2f9517/Number(limit))}});}catch(_0x3741d6){_0x38039b(_0x3741d6);}},this[_0x15eab0(0x88)]=async(_0xdb6adb,_0x1dfb65,_0x3e253d)=>{const _0x13d1e3=_0x15eab0;try{const {message:_0xa8d21d,shopId:_0x5dc2dc}=_0xdb6adb[_0x13d1e3(0x9f)];if(!_0xa8d21d)return _0x1dfb65[_0x13d1e3(0x6a)](0x190)[_0x13d1e3(0x77)]({'success':![],'message':'Message\x20is\x20required'});if(_0x5dc2dc)await telegramBotService_1[_0x13d1e3(0xa8)][_0x13d1e3(0xa0)](_0x5dc2dc,_0xa8d21d,{'parse_mode':_0x13d1e3(0xac)});else{const _0x41a539=await database_1[_0x13d1e3(0x8a)][_0x13d1e3(0x82)][_0x13d1e3(0x6e)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1b6c7f=[...new Set(_0x41a539[_0x13d1e3(0x7e)](_0xcf6f7a=>_0xcf6f7a[_0x13d1e3(0x6c)])[_0x13d1e3(0x8c)](Boolean))];for(const _0x6db549 of _0x1b6c7f){_0x6db549&&await telegramBotService_1[_0x13d1e3(0xa8)]['sendShopNotification'](_0x6db549,_0xa8d21d,{'parse_mode':_0x13d1e3(0xac)});}}_0x1dfb65[_0x13d1e3(0x77)]({'success':!![],'message':_0x13d1e3(0x84)});}catch(_0x58be32){_0x3e253d(_0x58be32);}},this[_0x15eab0(0xa9)]=async(_0x332f2,_0x341743,_0x2157e6)=>{const _0x704c1f=_0x15eab0;try{const {telegramId:_0x3ec3bf}=_0x332f2[_0x704c1f(0xa3)],_0x4eed50=await database_1[_0x704c1f(0x8a)][_0x704c1f(0x82)]['findUnique']({'where':{'telegramId':_0x3ec3bf},'include':{'shop':!![]}});if(!_0x4eed50)return _0x341743[_0x704c1f(0x6a)](0x194)[_0x704c1f(0x77)]({'success':![],'message':_0x704c1f(0x73)});await database_1['default']['telegramUser'][_0x704c1f(0x92)]({'where':{'telegramId':_0x3ec3bf},'data':{'shopId':null,'isVerified':![]}}),_0x341743[_0x704c1f(0x77)]({'success':!![],'message':_0x704c1f(0x6b)});}catch(_0x2f1786){_0x2157e6(_0x2f1786);}},this[_0x15eab0(0x8d)]=async(_0x14772e,_0x4e652c,_0xea2817)=>{const _0x358a82=_0x15eab0;try{const {shopId:_0x55356e,type:type='payment',testData:_0x2d07ac}=_0x14772e['body'];if(!_0x55356e)return _0x4e652c[_0x358a82(0x6a)](0x190)[_0x358a82(0x77)]({'success':![],'message':_0x358a82(0x87)});const _0xbc6330=await database_1[_0x358a82(0x8a)]['shop'][_0x358a82(0x86)]({'where':{'id':_0x55356e},'select':{'id':!![],'name':!![]}});if(!_0xbc6330)return _0x4e652c[_0x358a82(0x6a)](0x194)['json']({'success':![],'message':_0x358a82(0x99)});switch(type){case _0x358a82(0x9e):const _0x3c15a3={'id':'test_payment_123','amount':_0x2d07ac?.[_0x358a82(0x7b)]||0x64,'currency':_0x2d07ac?.['currency']||_0x358a82(0x9d),'productName':_0x2d07ac?.['productName']||_0x358a82(0x81),'gateway':_0x2d07ac?.[_0x358a82(0x75)]||_0x358a82(0x74),'createdAt':new Date(),..._0x2d07ac};await telegramBotService_1[_0x358a82(0xa8)][_0x358a82(0x9a)](_0x55356e,_0x3c15a3,_0x358a82(0xa4));break;case _0x358a82(0xa1):const _0x1b1fa7={'id':_0x358a82(0x7a),'amount':_0x2d07ac?.[_0x358a82(0x7b)]||0x1f4,'method':_0x2d07ac?.[_0x358a82(0x8f)]||_0x358a82(0x72),'createdAt':new Date(),..._0x2d07ac};await telegramBotService_1[_0x358a82(0xa8)]['sendPayoutNotification'](_0x55356e,_0x1b1fa7,'completed');break;case _0x358a82(0x79):await telegramBotService_1[_0x358a82(0xa8)][_0x358a82(0xae)](_0x55356e,_0x2d07ac?.[_0x358a82(0x80)]||'Test\x20Notification',_0x2d07ac?.[_0x358a82(0x96)]||{'message':_0x358a82(0x98)});break;default:return _0x4e652c[_0x358a82(0x6a)](0x190)[_0x358a82(0x77)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x4e652c[_0x358a82(0x77)]({'success':!![],'message':_0x358a82(0x76)+type+_0x358a82(0x69)});}catch(_0x126906){_0xea2817(_0x126906);}};}}exports[a14_0x2cca06(0x8b)]=TelegramController;