'use strict';const a12_0x3a057b=a12_0x4355;(function(_0x3d0489,_0xd662be){const _0x121bb6=a12_0x4355,_0x2f2adb=_0x3d0489();while(!![]){try{const _0x290968=parseInt(_0x121bb6(0xac))/0x1*(-parseInt(_0x121bb6(0x93))/0x2)+-parseInt(_0x121bb6(0xaa))/0x3*(parseInt(_0x121bb6(0x82))/0x4)+-parseInt(_0x121bb6(0x79))/0x5*(-parseInt(_0x121bb6(0xa7))/0x6)+parseInt(_0x121bb6(0xa1))/0x7+parseInt(_0x121bb6(0x8f))/0x8+-parseInt(_0x121bb6(0x9b))/0x9+parseInt(_0x121bb6(0xaf))/0xa*(parseInt(_0x121bb6(0x77))/0xb);if(_0x290968===_0xd662be)break;else _0x2f2adb['push'](_0x2f2adb['shift']());}catch(_0x289bce){_0x2f2adb['push'](_0x2f2adb['shift']());}}}(a12_0x216b,0x1d9e7));function a12_0x216b(){const _0x5099c1=['\x20notification\x20sent\x20successfully','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','4skeAUD','createdAt','../config/database','payment','default','bank_transfer','findUnique','details','sendPayoutNotification','update','disconnectUser','paid','username','1033024HgTsAx','Message\x20is\x20required','__importDefault','title','131402FmzxYD','desc','getTelegramUsers','lastName','groupBy','count','all','Telegram\x20user\x20not\x20found','182610oAPLKQ','isVerified','Shop\x20ID\x20is\x20required','plisio','firstName','getBotStatus','481719eHVGGI','sendBroadcast','Test\x20','User\x20disconnected\x20successfully','query','length','23682opRtvd','../services/telegramBotService','Markdown','265629rSWGBL','shop','2UItpGH','json','custom','40ENtshX','sendTestNotification','findMany','params','amount','telegramBotService','shopId','status','telegramUser','__esModule','test_payout_123','sendCustomNotification','completed','updatedAt','method','ceil','gateway','113443XvMVud','USD','155WqIOdJ','isActive','TelegramController','Shop\x20not\x20found','sendShopNotification','productName','body'];a12_0x216b=function(){return _0x5099c1;};return a12_0x216b();}var __importDefault=this&&this[a12_0x3a057b(0x91)]||function(_0x6726fd){const _0x29b55a=a12_0x3a057b;return _0x6726fd&&_0x6726fd[_0x29b55a(0x6f)]?_0x6726fd:{'default':_0x6726fd};};function a12_0x4355(_0x3c1628,_0x180fbe){const _0x216bfb=a12_0x216b();return a12_0x4355=function(_0x4355ee,_0xf360eb){_0x4355ee=_0x4355ee-0x6f;let _0x3004ee=_0x216bfb[_0x4355ee];return _0x3004ee;},a12_0x4355(_0x3c1628,_0x180fbe);}Object['defineProperty'](exports,a12_0x3a057b(0x6f),{'value':!![]}),exports[a12_0x3a057b(0x7b)]=void 0x0;const telegramBotService_1=require(a12_0x3a057b(0xa8)),database_1=__importDefault(require(a12_0x3a057b(0x84)));class TelegramController{constructor(){const _0x981967=a12_0x3a057b;this[_0x981967(0xa0)]=async(_0x426c50,_0xa95f6d,_0x176555)=>{const _0x33c7b6=_0x981967;try{const _0x16dcb5=telegramBotService_1[_0x33c7b6(0xb4)]['getBotInfo'](),_0x1138ed=await database_1['default']['telegramUser'][_0x33c7b6(0x98)](),_0x47b777=await database_1['default']['telegramUser'][_0x33c7b6(0x98)]({'where':{'isVerified':!![]}}),_0x363c52=await database_1[_0x33c7b6(0x86)][_0x33c7b6(0xb7)][_0x33c7b6(0x97)]({'by':[_0x33c7b6(0xb5)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xa95f6d[_0x33c7b6(0xad)]({'success':!![],'result':{'bot':{'isActive':_0x16dcb5[_0x33c7b6(0x7a)],'username':_0x16dcb5[_0x33c7b6(0x8e)]},'statistics':{'totalUsers':_0x1138ed,'verifiedUsers':_0x47b777,'unverifiedUsers':_0x1138ed-_0x47b777,'connectedShops':_0x363c52[_0x33c7b6(0xa6)]}}});}catch(_0x45e17f){_0x176555(_0x45e17f);}},this[_0x981967(0x95)]=async(_0x80805f,_0x3ed080,_0x239fdb)=>{const _0x4cadd8=_0x981967;try{const {page:page=0x1,limit:limit=0x14,verified:_0x22076c}=_0x80805f[_0x4cadd8(0xa5)],_0x42d3b6=(Number(page)-0x1)*Number(limit),_0x344b7d={};_0x22076c!==undefined&&(_0x344b7d['isVerified']=_0x22076c==='true');const [_0x103f1d,_0x1dcc56]=await Promise[_0x4cadd8(0x99)]([database_1[_0x4cadd8(0x86)][_0x4cadd8(0xb7)][_0x4cadd8(0xb1)]({'where':_0x344b7d,'skip':_0x42d3b6,'take':Number(limit),'orderBy':{'createdAt':_0x4cadd8(0x94)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4cadd8(0x86)][_0x4cadd8(0xb7)][_0x4cadd8(0x98)]({'where':_0x344b7d})]);_0x3ed080['json']({'success':!![],'users':_0x103f1d['map'](_0x3f765e=>({'id':_0x3f765e['id'],'telegramId':_0x3f765e['telegramId'],'username':_0x3f765e['username'],'firstName':_0x3f765e[_0x4cadd8(0x9f)],'lastName':_0x3f765e[_0x4cadd8(0x96)],'isVerified':_0x3f765e[_0x4cadd8(0x9c)],'shop':_0x3f765e['shop'],'createdAt':_0x3f765e[_0x4cadd8(0x83)],'updatedAt':_0x3f765e[_0x4cadd8(0x73)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1dcc56,'totalPages':Math[_0x4cadd8(0x75)](_0x1dcc56/Number(limit))}});}catch(_0x27a26b){_0x239fdb(_0x27a26b);}},this[_0x981967(0xa2)]=async(_0x3f1a64,_0x45483c,_0x22661d)=>{const _0x44351a=_0x981967;try{const {message:_0x33be24,shopId:_0x4472cc}=_0x3f1a64[_0x44351a(0x7f)];if(!_0x33be24)return _0x45483c[_0x44351a(0xb6)](0x190)[_0x44351a(0xad)]({'success':![],'message':_0x44351a(0x90)});if(_0x4472cc)await telegramBotService_1[_0x44351a(0xb4)][_0x44351a(0x7d)](_0x4472cc,_0x33be24,{'parse_mode':_0x44351a(0xa9)});else{const _0x4ba0bd=await database_1[_0x44351a(0x86)]['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1ab6f5=[...new Set(_0x4ba0bd['map'](_0xab5df1=>_0xab5df1[_0x44351a(0xb5)])['filter'](Boolean))];for(const _0x364ce8 of _0x1ab6f5){_0x364ce8&&await telegramBotService_1[_0x44351a(0xb4)][_0x44351a(0x7d)](_0x364ce8,_0x33be24,{'parse_mode':'Markdown'});}}_0x45483c['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x1f70b5){_0x22661d(_0x1f70b5);}},this[_0x981967(0x8c)]=async(_0x2d51f9,_0x2056e8,_0x2ed6a9)=>{const _0x1d6146=_0x981967;try{const {telegramId:_0x24064e}=_0x2d51f9[_0x1d6146(0xb2)],_0x3d31f0=await database_1['default'][_0x1d6146(0xb7)][_0x1d6146(0x88)]({'where':{'telegramId':_0x24064e},'include':{'shop':!![]}});if(!_0x3d31f0)return _0x2056e8['status'](0x194)[_0x1d6146(0xad)]({'success':![],'message':_0x1d6146(0x9a)});await database_1[_0x1d6146(0x86)]['telegramUser'][_0x1d6146(0x8b)]({'where':{'telegramId':_0x24064e},'data':{'shopId':null,'isVerified':![]}}),_0x2056e8[_0x1d6146(0xad)]({'success':!![],'message':_0x1d6146(0xa4)});}catch(_0x5b3ef4){_0x2ed6a9(_0x5b3ef4);}},this[_0x981967(0xb0)]=async(_0x146bf5,_0x1d753c,_0x2c78f9)=>{const _0x20c7a7=_0x981967;try{const {shopId:_0xa70f2e,type:type=_0x20c7a7(0x85),testData:_0xc5ecf0}=_0x146bf5['body'];if(!_0xa70f2e)return _0x1d753c['status'](0x190)['json']({'success':![],'message':_0x20c7a7(0x9d)});const _0x2e5c0f=await database_1[_0x20c7a7(0x86)][_0x20c7a7(0xab)][_0x20c7a7(0x88)]({'where':{'id':_0xa70f2e},'select':{'id':!![],'name':!![]}});if(!_0x2e5c0f)return _0x1d753c[_0x20c7a7(0xb6)](0x194)['json']({'success':![],'message':_0x20c7a7(0x7c)});switch(type){case _0x20c7a7(0x85):const _0x1b404e={'id':'test_payment_123','amount':_0xc5ecf0?.['amount']||0x64,'currency':_0xc5ecf0?.['currency']||_0x20c7a7(0x78),'productName':_0xc5ecf0?.[_0x20c7a7(0x7e)]||'Test\x20Product','gateway':_0xc5ecf0?.[_0x20c7a7(0x76)]||_0x20c7a7(0x9e),'createdAt':new Date(),..._0xc5ecf0};await telegramBotService_1[_0x20c7a7(0xb4)]['sendPaymentNotification'](_0xa70f2e,_0x1b404e,_0x20c7a7(0x8d));break;case'payout':const _0x20775b={'id':_0x20c7a7(0x70),'amount':_0xc5ecf0?.[_0x20c7a7(0xb3)]||0x1f4,'method':_0xc5ecf0?.[_0x20c7a7(0x74)]||_0x20c7a7(0x87),'createdAt':new Date(),..._0xc5ecf0};await telegramBotService_1[_0x20c7a7(0xb4)][_0x20c7a7(0x8a)](_0xa70f2e,_0x20775b,_0x20c7a7(0x72));break;case _0x20c7a7(0xae):await telegramBotService_1[_0x20c7a7(0xb4)][_0x20c7a7(0x71)](_0xa70f2e,_0xc5ecf0?.[_0x20c7a7(0x92)]||'Test\x20Notification',_0xc5ecf0?.[_0x20c7a7(0x89)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x1d753c[_0x20c7a7(0xb6)](0x190)[_0x20c7a7(0xad)]({'success':![],'message':_0x20c7a7(0x81)});}_0x1d753c[_0x20c7a7(0xad)]({'success':!![],'message':_0x20c7a7(0xa3)+type+_0x20c7a7(0x80)});}catch(_0x15828b){_0x2c78f9(_0x15828b);}};}}exports['TelegramController']=TelegramController;