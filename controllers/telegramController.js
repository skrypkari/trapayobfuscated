'use strict';function a12_0x3d50(){const _0x1e79ad=['__esModule','details','telegramUser','Shop\x20ID\x20is\x20required','json','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','412184Gtypzi','gateway','groupBy','telegramId','21980erpXAX','This\x20is\x20a\x20test\x20notification','sendTestNotification','5sxVWFZ','disconnectUser','desc','username','title','test_payout_123','Test\x20','query','telegramBotService','body','default','findMany','Telegram\x20user\x20not\x20found','sendPayoutNotification','test_payment_123','__importDefault','findUnique','getBotInfo','2796xyZUIy','paid','../config/database','plisio','30yFtPPI','sendCustomNotification','lastName','sendBroadcast','filter','sendShopNotification','\x20notification\x20sent\x20successfully','Test\x20Notification','currency','isVerified','all','120XRDMUz','payment','shop','13491687dpacKU','shopId','amount','map','ceil','53344WXYQVQ','Test\x20Product','status','update','2294685zHAFvU','Markdown','181334Ldnbrn','completed','productName','../services/telegramBotService','length','defineProperty','Shop\x20not\x20found','count','true','1249332bPlDNa','Broadcast\x20message\x20sent\x20successfully','params'];a12_0x3d50=function(){return _0x1e79ad;};return a12_0x3d50();}const a12_0x97c861=a12_0x3b30;(function(_0x50ccba,_0x420ec3){const _0x10d28a=a12_0x3b30,_0x338c00=_0x50ccba();while(!![]){try{const _0x22dd6d=-parseInt(_0x10d28a(0x183))/0x1*(parseInt(_0x10d28a(0x16a))/0x2)+parseInt(_0x10d28a(0x173))/0x3+parseInt(_0x10d28a(0x164))/0x4*(parseInt(_0x10d28a(0x1a4))/0x5)+parseInt(_0x10d28a(0x195))/0x6*(-parseInt(_0x10d28a(0x180))/0x7)+-parseInt(_0x10d28a(0x17c))/0x8+parseInt(_0x10d28a(0x168))/0x9*(parseInt(_0x10d28a(0x199))/0xa)+parseInt(_0x10d28a(0x15f))/0xb;if(_0x22dd6d===_0x420ec3)break;else _0x338c00['push'](_0x338c00['shift']());}catch(_0x4475f0){_0x338c00['push'](_0x338c00['shift']());}}}(a12_0x3d50,0xb980e));var __importDefault=this&&this[a12_0x97c861(0x192)]||function(_0x509921){const _0x2bc8a6=a12_0x97c861;return _0x509921&&_0x509921[_0x2bc8a6(0x176)]?_0x509921:{'default':_0x509921};};function a12_0x3b30(_0x4dd67a,_0x3cf2b3){const _0x3d5098=a12_0x3d50();return a12_0x3b30=function(_0x3b304e,_0x2da7fa){_0x3b304e=_0x3b304e-0x15e;let _0x4c22db=_0x3d5098[_0x3b304e];return _0x4c22db;},a12_0x3b30(_0x4dd67a,_0x3cf2b3);}Object[a12_0x97c861(0x16f)](exports,a12_0x97c861(0x176),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x97c861(0x16d)),database_1=__importDefault(require(a12_0x97c861(0x197)));class TelegramController{constructor(){const _0x78557a=a12_0x97c861;this['getBotStatus']=async(_0x32b720,_0x2dfa70,_0x753971)=>{const _0x31734f=a12_0x3b30;try{const _0x350235=telegramBotService_1[_0x31734f(0x18b)][_0x31734f(0x194)](),_0x219717=await database_1[_0x31734f(0x18d)][_0x31734f(0x178)]['count'](),_0x15c178=await database_1[_0x31734f(0x18d)][_0x31734f(0x178)][_0x31734f(0x171)]({'where':{'isVerified':!![]}}),_0x569eed=await database_1[_0x31734f(0x18d)][_0x31734f(0x178)][_0x31734f(0x17e)]({'by':[_0x31734f(0x160)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2dfa70[_0x31734f(0x17a)]({'success':!![],'result':{'bot':{'isActive':_0x350235['isActive'],'username':_0x350235[_0x31734f(0x186)]},'statistics':{'totalUsers':_0x219717,'verifiedUsers':_0x15c178,'unverifiedUsers':_0x219717-_0x15c178,'connectedShops':_0x569eed[_0x31734f(0x16e)]}}});}catch(_0x2b735d){_0x753971(_0x2b735d);}},this['getTelegramUsers']=async(_0x447b38,_0x2d5b52,_0x27e96a)=>{const _0x27ffa6=a12_0x3b30;try{const {page:page=0x1,limit:limit=0x14,verified:_0x33b8de}=_0x447b38[_0x27ffa6(0x18a)],_0x3bb98f=(Number(page)-0x1)*Number(limit),_0x2932d9={};_0x33b8de!==undefined&&(_0x2932d9[_0x27ffa6(0x1a2)]=_0x33b8de===_0x27ffa6(0x172));const [_0x2f2599,_0x2f1a02]=await Promise[_0x27ffa6(0x1a3)]([database_1['default'][_0x27ffa6(0x178)][_0x27ffa6(0x18e)]({'where':_0x2932d9,'skip':_0x3bb98f,'take':Number(limit),'orderBy':{'createdAt':_0x27ffa6(0x185)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x27ffa6(0x18d)]['telegramUser'][_0x27ffa6(0x171)]({'where':_0x2932d9})]);_0x2d5b52[_0x27ffa6(0x17a)]({'success':!![],'users':_0x2f2599[_0x27ffa6(0x162)](_0x5cb29a=>({'id':_0x5cb29a['id'],'telegramId':_0x5cb29a[_0x27ffa6(0x17f)],'username':_0x5cb29a[_0x27ffa6(0x186)],'firstName':_0x5cb29a['firstName'],'lastName':_0x5cb29a[_0x27ffa6(0x19b)],'isVerified':_0x5cb29a['isVerified'],'shop':_0x5cb29a['shop'],'createdAt':_0x5cb29a['createdAt'],'updatedAt':_0x5cb29a['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2f1a02,'totalPages':Math[_0x27ffa6(0x163)](_0x2f1a02/Number(limit))}});}catch(_0x14389e){_0x27e96a(_0x14389e);}},this[_0x78557a(0x19c)]=async(_0x1b9945,_0x317f5f,_0x2d6b2c)=>{const _0x4cb4ff=_0x78557a;try{const {message:_0x198fc2,shopId:_0xf9b906}=_0x1b9945[_0x4cb4ff(0x18c)];if(!_0x198fc2)return _0x317f5f[_0x4cb4ff(0x166)](0x190)[_0x4cb4ff(0x17a)]({'success':![],'message':'Message\x20is\x20required'});if(_0xf9b906)await telegramBotService_1[_0x4cb4ff(0x18b)][_0x4cb4ff(0x19e)](_0xf9b906,_0x198fc2,{'parse_mode':_0x4cb4ff(0x169)});else{const _0x3ad0c2=await database_1[_0x4cb4ff(0x18d)]['telegramUser'][_0x4cb4ff(0x18e)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x57be2a=[...new Set(_0x3ad0c2[_0x4cb4ff(0x162)](_0x47bced=>_0x47bced[_0x4cb4ff(0x160)])[_0x4cb4ff(0x19d)](Boolean))];for(const _0x40688e of _0x57be2a){_0x40688e&&await telegramBotService_1['telegramBotService'][_0x4cb4ff(0x19e)](_0x40688e,_0x198fc2,{'parse_mode':_0x4cb4ff(0x169)});}}_0x317f5f[_0x4cb4ff(0x17a)]({'success':!![],'message':_0x4cb4ff(0x174)});}catch(_0x990670){_0x2d6b2c(_0x990670);}},this[_0x78557a(0x184)]=async(_0x3e1cd6,_0x5a3067,_0x53f46e)=>{const _0x2b4d11=_0x78557a;try{const {telegramId:_0x15e28a}=_0x3e1cd6[_0x2b4d11(0x175)],_0x4d3886=await database_1[_0x2b4d11(0x18d)][_0x2b4d11(0x178)][_0x2b4d11(0x193)]({'where':{'telegramId':_0x15e28a},'include':{'shop':!![]}});if(!_0x4d3886)return _0x5a3067['status'](0x194)[_0x2b4d11(0x17a)]({'success':![],'message':_0x2b4d11(0x18f)});await database_1[_0x2b4d11(0x18d)][_0x2b4d11(0x178)][_0x2b4d11(0x167)]({'where':{'telegramId':_0x15e28a},'data':{'shopId':null,'isVerified':![]}}),_0x5a3067[_0x2b4d11(0x17a)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x347cae){_0x53f46e(_0x347cae);}},this[_0x78557a(0x182)]=async(_0x321ce9,_0x106f04,_0x59fdf9)=>{const _0x38c4bd=_0x78557a;try{const {shopId:_0x44b564,type:type='payment',testData:_0x25a736}=_0x321ce9[_0x38c4bd(0x18c)];if(!_0x44b564)return _0x106f04[_0x38c4bd(0x166)](0x190)[_0x38c4bd(0x17a)]({'success':![],'message':_0x38c4bd(0x179)});const _0x2f863e=await database_1['default'][_0x38c4bd(0x15e)]['findUnique']({'where':{'id':_0x44b564},'select':{'id':!![],'name':!![]}});if(!_0x2f863e)return _0x106f04[_0x38c4bd(0x166)](0x194)['json']({'success':![],'message':_0x38c4bd(0x170)});switch(type){case _0x38c4bd(0x1a5):const _0x2eb60b={'id':_0x38c4bd(0x191),'amount':_0x25a736?.[_0x38c4bd(0x161)]||0x64,'currency':_0x25a736?.[_0x38c4bd(0x1a1)]||'USD','productName':_0x25a736?.[_0x38c4bd(0x16c)]||_0x38c4bd(0x165),'gateway':_0x25a736?.[_0x38c4bd(0x17d)]||_0x38c4bd(0x198),'createdAt':new Date(),..._0x25a736};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x44b564,_0x2eb60b,_0x38c4bd(0x196));break;case'payout':const _0x36000b={'id':_0x38c4bd(0x188),'amount':_0x25a736?.['amount']||0x1f4,'method':_0x25a736?.['method']||'bank_transfer','createdAt':new Date(),..._0x25a736};await telegramBotService_1[_0x38c4bd(0x18b)][_0x38c4bd(0x190)](_0x44b564,_0x36000b,_0x38c4bd(0x16b));break;case'custom':await telegramBotService_1[_0x38c4bd(0x18b)][_0x38c4bd(0x19a)](_0x44b564,_0x25a736?.[_0x38c4bd(0x187)]||_0x38c4bd(0x1a0),_0x25a736?.[_0x38c4bd(0x177)]||{'message':_0x38c4bd(0x181)});break;default:return _0x106f04['status'](0x190)[_0x38c4bd(0x17a)]({'success':![],'message':_0x38c4bd(0x17b)});}_0x106f04['json']({'success':!![],'message':_0x38c4bd(0x189)+type+_0x38c4bd(0x19f)});}catch(_0x3136cd){_0x59fdf9(_0x3136cd);}};}}exports['TelegramController']=TelegramController;