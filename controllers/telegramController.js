'use strict';const a20_0x172d16=a20_0x471b;(function(_0x42986f,_0xb763ae){const _0x3f6dce=a20_0x471b,_0x6dbc84=_0x42986f();while(!![]){try{const _0x23d863=parseInt(_0x3f6dce(0x99))/0x1*(parseInt(_0x3f6dce(0x90))/0x2)+-parseInt(_0x3f6dce(0x91))/0x3*(-parseInt(_0x3f6dce(0x96))/0x4)+parseInt(_0x3f6dce(0xa4))/0x5*(parseInt(_0x3f6dce(0xab))/0x6)+parseInt(_0x3f6dce(0x9c))/0x7*(parseInt(_0x3f6dce(0xa1))/0x8)+-parseInt(_0x3f6dce(0xb4))/0x9+parseInt(_0x3f6dce(0x73))/0xa*(-parseInt(_0x3f6dce(0x98))/0xb)+-parseInt(_0x3f6dce(0x8b))/0xc;if(_0x23d863===_0xb763ae)break;else _0x6dbc84['push'](_0x6dbc84['shift']());}catch(_0x5097ed){_0x6dbc84['push'](_0x6dbc84['shift']());}}}(a20_0x12f4,0x512cf));var __importDefault=this&&this[a20_0x172d16(0xa0)]||function(_0x1708aa){const _0x37a040=a20_0x172d16;return _0x1708aa&&_0x1708aa[_0x37a040(0x72)]?_0x1708aa:{'default':_0x1708aa};};function a20_0x12f4(){const _0x2981dc=['getBotStatus','currency','getTelegramUsers','389286wcPurz','sendShopNotification','sendCustomNotification','details','plisio','shopId','telegramId','__esModule','27490GjsuBE','payment','Message\x20is\x20required','defineProperty','Shop\x20not\x20found','TelegramController','Markdown','params','wallet','isVerified','map','disconnectUser','json','title','Test\x20','This\x20is\x20a\x20test\x20notification','paid','sendPaymentNotification','Broadcast\x20message\x20sent\x20successfully','sendTestNotification','telegramBotService','update','status','payout','15964764swpCoe','count','txid','body','ceil','617426fwNbnl','6102pxILeN','Тестовый\x20период','productName','updatedAt','firstName','1248DlgbdE','Telegram\x20user\x20not\x20found','539JIEKsE','2eSlKOQ','shop','telegramUser','2212REXhPL','findUnique','gateway','default','__importDefault','11288kdgdvQ','sendBroadcast','all','95jPYkOP','findMany','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','filter','createdAt','groupBy','true','45138NgTJVA','desc','isActive','length','query','Shop\x20ID\x20is\x20required'];a20_0x12f4=function(){return _0x2981dc;};return a20_0x12f4();}function a20_0x471b(_0x3d0f30,_0x4108d5){_0x3d0f30=_0x3d0f30-0x6e;const _0x12f4ea=a20_0x12f4();let _0x471b51=_0x12f4ea[_0x3d0f30];return _0x471b51;}Object[a20_0x172d16(0x76)](exports,a20_0x172d16(0x72),{'value':!![]}),exports[a20_0x172d16(0x78)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x1d7db5=a20_0x172d16;this[_0x1d7db5(0xb1)]=async(_0x387005,_0x3acc62,_0x145164)=>{const _0xf8dfb1=_0x1d7db5;try{const _0x245ee2=telegramBotService_1[_0xf8dfb1(0x87)]['getBotInfo'](),_0xa2da62=await database_1[_0xf8dfb1(0x9f)]['telegramUser'][_0xf8dfb1(0x8c)](),_0x426001=await database_1[_0xf8dfb1(0x9f)][_0xf8dfb1(0x9b)][_0xf8dfb1(0x8c)]({'where':{'isVerified':!![]}}),_0x1dad96=await database_1[_0xf8dfb1(0x9f)][_0xf8dfb1(0x9b)][_0xf8dfb1(0xa9)]({'by':[_0xf8dfb1(0x70)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3acc62['json']({'success':!![],'result':{'bot':{'isActive':_0x245ee2[_0xf8dfb1(0xad)],'username':_0x245ee2['username']},'statistics':{'totalUsers':_0xa2da62,'verifiedUsers':_0x426001,'unverifiedUsers':_0xa2da62-_0x426001,'connectedShops':_0x1dad96[_0xf8dfb1(0xae)]}}});}catch(_0x942707){_0x145164(_0x942707);}},this[_0x1d7db5(0xb3)]=async(_0xa79ed0,_0x5117ce,_0x467518)=>{const _0x5c238e=_0x1d7db5;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1e00eb}=_0xa79ed0[_0x5c238e(0xaf)],_0xdbeec4=(Number(page)-0x1)*Number(limit),_0x413049={};_0x1e00eb!==undefined&&(_0x413049[_0x5c238e(0x7c)]=_0x1e00eb===_0x5c238e(0xaa));const [_0x130900,_0xb2a75e]=await Promise[_0x5c238e(0xa3)]([database_1['default']['telegramUser'][_0x5c238e(0xa5)]({'where':_0x413049,'skip':_0xdbeec4,'take':Number(limit),'orderBy':{'createdAt':_0x5c238e(0xac)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5c238e(0x9f)][_0x5c238e(0x9b)][_0x5c238e(0x8c)]({'where':_0x413049})]);_0x5117ce['json']({'success':!![],'users':_0x130900[_0x5c238e(0x7d)](_0x1bf080=>({'id':_0x1bf080['id'],'telegramId':_0x1bf080[_0x5c238e(0x71)],'username':_0x1bf080['username'],'firstName':_0x1bf080[_0x5c238e(0x95)],'lastName':_0x1bf080['lastName'],'isVerified':_0x1bf080[_0x5c238e(0x7c)],'shop':_0x1bf080[_0x5c238e(0x9a)],'createdAt':_0x1bf080[_0x5c238e(0xa8)],'updatedAt':_0x1bf080[_0x5c238e(0x94)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xb2a75e,'totalPages':Math[_0x5c238e(0x8f)](_0xb2a75e/Number(limit))}});}catch(_0x585c5c){_0x467518(_0x585c5c);}},this[_0x1d7db5(0xa2)]=async(_0x5d6367,_0x2dcdb5,_0x5bfb30)=>{const _0x452f6a=_0x1d7db5;try{const {message:_0x462ee0,shopId:_0x249987}=_0x5d6367['body'];if(!_0x462ee0)return _0x2dcdb5[_0x452f6a(0x89)](0x190)[_0x452f6a(0x7f)]({'success':![],'message':_0x452f6a(0x75)});if(_0x249987)await telegramBotService_1['telegramBotService'][_0x452f6a(0xb5)](_0x249987,_0x462ee0,{'parse_mode':_0x452f6a(0x79)});else{const _0x3e318a=await database_1['default'][_0x452f6a(0x9b)][_0x452f6a(0xa5)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x11e927=[...new Set(_0x3e318a[_0x452f6a(0x7d)](_0x446283=>_0x446283[_0x452f6a(0x70)])[_0x452f6a(0xa7)](Boolean))];for(const _0x110ea3 of _0x11e927){_0x110ea3&&await telegramBotService_1[_0x452f6a(0x87)][_0x452f6a(0xb5)](_0x110ea3,_0x462ee0,{'parse_mode':_0x452f6a(0x79)});}}_0x2dcdb5['json']({'success':!![],'message':_0x452f6a(0x85)});}catch(_0x1726c9){_0x5bfb30(_0x1726c9);}},this[_0x1d7db5(0x7e)]=async(_0x14c42d,_0x115276,_0x3e66c1)=>{const _0xe17fc4=_0x1d7db5;try{const {telegramId:_0x3ca87c}=_0x14c42d[_0xe17fc4(0x7a)],_0x84926b=await database_1[_0xe17fc4(0x9f)]['telegramUser']['findUnique']({'where':{'telegramId':_0x3ca87c},'include':{'shop':!![]}});if(!_0x84926b)return _0x115276[_0xe17fc4(0x89)](0x194)[_0xe17fc4(0x7f)]({'success':![],'message':_0xe17fc4(0x97)});await database_1[_0xe17fc4(0x9f)]['telegramUser'][_0xe17fc4(0x88)]({'where':{'telegramId':_0x3ca87c},'data':{'shopId':null,'isVerified':![]}}),_0x115276[_0xe17fc4(0x7f)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x475165){_0x3e66c1(_0x475165);}},this[_0x1d7db5(0x86)]=async(_0x489a02,_0x1c8268,_0x11a4d8)=>{const _0x101bb5=_0x1d7db5;try{const {shopId:_0x583cd5,type:type=_0x101bb5(0x74),testData:_0x53bbac}=_0x489a02[_0x101bb5(0x8e)];if(!_0x583cd5)return _0x1c8268[_0x101bb5(0x89)](0x190)[_0x101bb5(0x7f)]({'success':![],'message':_0x101bb5(0xb0)});const _0x5865ef=await database_1[_0x101bb5(0x9f)]['shop'][_0x101bb5(0x9d)]({'where':{'id':_0x583cd5},'select':{'id':!![],'name':!![]}});if(!_0x5865ef)return _0x1c8268[_0x101bb5(0x89)](0x194)[_0x101bb5(0x7f)]({'success':![],'message':_0x101bb5(0x77)});switch(type){case _0x101bb5(0x74):const _0x538989={'id':'test_payment_123','amount':_0x53bbac?.['amount']||0x64,'currency':_0x53bbac?.[_0x101bb5(0xb2)]||'USD','productName':_0x53bbac?.[_0x101bb5(0x93)]||'Test\x20Product','gateway':_0x53bbac?.[_0x101bb5(0x9e)]||_0x101bb5(0x6f),'createdAt':new Date(),..._0x53bbac};await telegramBotService_1[_0x101bb5(0x87)][_0x101bb5(0x84)](_0x583cd5,_0x538989,_0x101bb5(0x83));break;case _0x101bb5(0x8a):const _0x51d515={'id':'test_payout_123','amount':_0x53bbac?.['amount']||0x1f4,'network':_0x53bbac?.['network']||'TRC20','wallet':_0x53bbac?.[_0x101bb5(0x7b)]||_0x101bb5(0xa6),'period':_0x101bb5(0x92),'createdAt':new Date(),'txid':_0x53bbac?.[_0x101bb5(0x8d)]||null,..._0x53bbac};await telegramBotService_1[_0x101bb5(0x87)]['sendPayoutNotification'](_0x583cd5,_0x51d515);break;case'custom':await telegramBotService_1[_0x101bb5(0x87)][_0x101bb5(0xb6)](_0x583cd5,_0x53bbac?.[_0x101bb5(0x80)]||'Test\x20Notification',_0x53bbac?.[_0x101bb5(0x6e)]||{'message':_0x101bb5(0x82)});break;default:return _0x1c8268[_0x101bb5(0x89)](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x1c8268[_0x101bb5(0x7f)]({'success':!![],'message':_0x101bb5(0x81)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x4493d0){_0x11a4d8(_0x4493d0);}};}}exports['TelegramController']=TelegramController;