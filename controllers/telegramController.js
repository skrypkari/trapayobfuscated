'use strict';const a14_0x377016=a14_0x2803;(function(_0x3c2ca3,_0x101de1){const _0x206d65=a14_0x2803,_0x39d2b9=_0x3c2ca3();while(!![]){try{const _0x52a30e=parseInt(_0x206d65(0x1e0))/0x1+-parseInt(_0x206d65(0x1fb))/0x2*(-parseInt(_0x206d65(0x1fc))/0x3)+parseInt(_0x206d65(0x1e2))/0x4+-parseInt(_0x206d65(0x1ea))/0x5+parseInt(_0x206d65(0x205))/0x6+-parseInt(_0x206d65(0x212))/0x7*(-parseInt(_0x206d65(0x1e1))/0x8)+-parseInt(_0x206d65(0x20b))/0x9;if(_0x52a30e===_0x101de1)break;else _0x39d2b9['push'](_0x39d2b9['shift']());}catch(_0x2ef339){_0x39d2b9['push'](_0x39d2b9['shift']());}}}(a14_0x5d2e,0xe0f65));function a14_0x5d2e(){const _0x438b44=['username','__importDefault','amount','3772510khVPXd','__esModule','default','desc','sendBroadcast','Shop\x20not\x20found','Markdown','method','title','payout','Test\x20','sendPaymentNotification','filter','plisio','body','Test\x20Product','getTelegramUsers','1537724hVRMzo','6rjTTMC','updatedAt','TelegramController','query','Message\x20is\x20required','getBotStatus','true','disconnectUser','telegramId','6101868tICqbj','telegramBotService','findUnique','json','bank_transfer','telegramUser','29555640PRQcNO','User\x20disconnected\x20successfully','test_payment_123','defineProperty','../config/database','payment','map','2263373EMnESH','params','currency','sendCustomNotification','test_payout_123','update','status','This\x20is\x20a\x20test\x20notification','groupBy','shop','\x20notification\x20sent\x20successfully','completed','firstName','sendShopNotification','productName','gateway','all','Test\x20Notification','isVerified','findMany','sendTestNotification','Telegram\x20user\x20not\x20found','985705pWTzgg','16rrXACd','3091288WLOkwD','details','count','shopId','../services/telegramBotService'];a14_0x5d2e=function(){return _0x438b44;};return a14_0x5d2e();}function a14_0x2803(_0x3776d8,_0x239b48){const _0x5d2e51=a14_0x5d2e();return a14_0x2803=function(_0x28034b,_0x174403){_0x28034b=_0x28034b-0x1da;let _0x5df278=_0x5d2e51[_0x28034b];return _0x5df278;},a14_0x2803(_0x3776d8,_0x239b48);}var __importDefault=this&&this[a14_0x377016(0x1e8)]||function(_0x4c782b){const _0x323195=a14_0x377016;return _0x4c782b&&_0x4c782b[_0x323195(0x1eb)]?_0x4c782b:{'default':_0x4c782b};};Object[a14_0x377016(0x20e)](exports,a14_0x377016(0x1eb),{'value':!![]}),exports[a14_0x377016(0x1fe)]=void 0x0;const telegramBotService_1=require(a14_0x377016(0x1e6)),database_1=__importDefault(require(a14_0x377016(0x20f)));class TelegramController{constructor(){const _0x27142a=a14_0x377016;this[_0x27142a(0x201)]=async(_0x2f4987,_0x175695,_0xc72b19)=>{const _0x574eda=_0x27142a;try{const _0x4a72f6=telegramBotService_1['telegramBotService']['getBotInfo'](),_0xf36d20=await database_1[_0x574eda(0x1ec)]['telegramUser'][_0x574eda(0x1e4)](),_0x4ee474=await database_1[_0x574eda(0x1ec)][_0x574eda(0x20a)][_0x574eda(0x1e4)]({'where':{'isVerified':!![]}}),_0x4f3fa1=await database_1['default'][_0x574eda(0x20a)][_0x574eda(0x21a)]({'by':[_0x574eda(0x1e5)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x175695['json']({'success':!![],'result':{'bot':{'isActive':_0x4a72f6['isActive'],'username':_0x4a72f6['username']},'statistics':{'totalUsers':_0xf36d20,'verifiedUsers':_0x4ee474,'unverifiedUsers':_0xf36d20-_0x4ee474,'connectedShops':_0x4f3fa1['length']}}});}catch(_0x4cab5d){_0xc72b19(_0x4cab5d);}},this[_0x27142a(0x1fa)]=async(_0x3a03cb,_0x50c04b,_0x55a1d3)=>{const _0x3fe608=_0x27142a;try{const {page:page=0x1,limit:limit=0x14,verified:_0xb3d5c7}=_0x3a03cb[_0x3fe608(0x1ff)],_0x46498e=(Number(page)-0x1)*Number(limit),_0x443c85={};_0xb3d5c7!==undefined&&(_0x443c85[_0x3fe608(0x1dc)]=_0xb3d5c7===_0x3fe608(0x202));const [_0x46abb2,_0x26590f]=await Promise[_0x3fe608(0x1da)]([database_1[_0x3fe608(0x1ec)][_0x3fe608(0x20a)][_0x3fe608(0x1dd)]({'where':_0x443c85,'skip':_0x46498e,'take':Number(limit),'orderBy':{'createdAt':_0x3fe608(0x1ed)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x3fe608(0x20a)][_0x3fe608(0x1e4)]({'where':_0x443c85})]);_0x50c04b[_0x3fe608(0x208)]({'success':!![],'users':_0x46abb2[_0x3fe608(0x211)](_0x17a66e=>({'id':_0x17a66e['id'],'telegramId':_0x17a66e[_0x3fe608(0x204)],'username':_0x17a66e[_0x3fe608(0x1e7)],'firstName':_0x17a66e[_0x3fe608(0x21e)],'lastName':_0x17a66e['lastName'],'isVerified':_0x17a66e['isVerified'],'shop':_0x17a66e[_0x3fe608(0x21b)],'createdAt':_0x17a66e['createdAt'],'updatedAt':_0x17a66e[_0x3fe608(0x1fd)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x26590f,'totalPages':Math['ceil'](_0x26590f/Number(limit))}});}catch(_0x38543d){_0x55a1d3(_0x38543d);}},this[_0x27142a(0x1ee)]=async(_0x534cec,_0xc9ed9e,_0x4edbb8)=>{const _0x4d3518=_0x27142a;try{const {message:_0x274a3b,shopId:_0x27dd1b}=_0x534cec[_0x4d3518(0x1f8)];if(!_0x274a3b)return _0xc9ed9e['status'](0x190)[_0x4d3518(0x208)]({'success':![],'message':_0x4d3518(0x200)});if(_0x27dd1b)await telegramBotService_1[_0x4d3518(0x206)][_0x4d3518(0x21f)](_0x27dd1b,_0x274a3b,{'parse_mode':_0x4d3518(0x1f0)});else{const _0x308f32=await database_1['default'][_0x4d3518(0x20a)][_0x4d3518(0x1dd)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x370b31=[...new Set(_0x308f32['map'](_0x408100=>_0x408100[_0x4d3518(0x1e5)])[_0x4d3518(0x1f6)](Boolean))];for(const _0x42955c of _0x370b31){_0x42955c&&await telegramBotService_1[_0x4d3518(0x206)][_0x4d3518(0x21f)](_0x42955c,_0x274a3b,{'parse_mode':_0x4d3518(0x1f0)});}}_0xc9ed9e['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x59d8ce){_0x4edbb8(_0x59d8ce);}},this[_0x27142a(0x203)]=async(_0x3d11a1,_0x3c9259,_0x104de6)=>{const _0x15f507=_0x27142a;try{const {telegramId:_0x59c1ee}=_0x3d11a1[_0x15f507(0x213)],_0x1dd5fc=await database_1[_0x15f507(0x1ec)][_0x15f507(0x20a)][_0x15f507(0x207)]({'where':{'telegramId':_0x59c1ee},'include':{'shop':!![]}});if(!_0x1dd5fc)return _0x3c9259[_0x15f507(0x218)](0x194)[_0x15f507(0x208)]({'success':![],'message':_0x15f507(0x1df)});await database_1['default'][_0x15f507(0x20a)][_0x15f507(0x217)]({'where':{'telegramId':_0x59c1ee},'data':{'shopId':null,'isVerified':![]}}),_0x3c9259[_0x15f507(0x208)]({'success':!![],'message':_0x15f507(0x20c)});}catch(_0x1f8115){_0x104de6(_0x1f8115);}},this[_0x27142a(0x1de)]=async(_0x462922,_0x16165d,_0x5bedd3)=>{const _0x19bfb3=_0x27142a;try{const {shopId:_0x2f4859,type:type='payment',testData:_0x3013e5}=_0x462922['body'];if(!_0x2f4859)return _0x16165d[_0x19bfb3(0x218)](0x190)[_0x19bfb3(0x208)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x20b178=await database_1[_0x19bfb3(0x1ec)][_0x19bfb3(0x21b)][_0x19bfb3(0x207)]({'where':{'id':_0x2f4859},'select':{'id':!![],'name':!![]}});if(!_0x20b178)return _0x16165d[_0x19bfb3(0x218)](0x194)['json']({'success':![],'message':_0x19bfb3(0x1ef)});switch(type){case _0x19bfb3(0x210):const _0x41fe83={'id':_0x19bfb3(0x20d),'amount':_0x3013e5?.[_0x19bfb3(0x1e9)]||0x64,'currency':_0x3013e5?.[_0x19bfb3(0x214)]||'USD','productName':_0x3013e5?.[_0x19bfb3(0x220)]||_0x19bfb3(0x1f9),'gateway':_0x3013e5?.[_0x19bfb3(0x221)]||_0x19bfb3(0x1f7),'createdAt':new Date(),..._0x3013e5};await telegramBotService_1[_0x19bfb3(0x206)][_0x19bfb3(0x1f5)](_0x2f4859,_0x41fe83,'paid');break;case _0x19bfb3(0x1f3):const _0x22053d={'id':_0x19bfb3(0x216),'amount':_0x3013e5?.['amount']||0x1f4,'method':_0x3013e5?.[_0x19bfb3(0x1f1)]||_0x19bfb3(0x209),'createdAt':new Date(),..._0x3013e5};await telegramBotService_1[_0x19bfb3(0x206)]['sendPayoutNotification'](_0x2f4859,_0x22053d,_0x19bfb3(0x21d));break;case'custom':await telegramBotService_1[_0x19bfb3(0x206)][_0x19bfb3(0x215)](_0x2f4859,_0x3013e5?.[_0x19bfb3(0x1f2)]||_0x19bfb3(0x1db),_0x3013e5?.[_0x19bfb3(0x1e3)]||{'message':_0x19bfb3(0x219)});break;default:return _0x16165d[_0x19bfb3(0x218)](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x16165d[_0x19bfb3(0x208)]({'success':!![],'message':_0x19bfb3(0x1f4)+type+_0x19bfb3(0x21c)});}catch(_0x5cad75){_0x5bedd3(_0x5cad75);}};}}exports[a14_0x377016(0x1fe)]=TelegramController;