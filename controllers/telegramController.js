'use strict';const a12_0x3d64e5=a12_0x129f;function a12_0x129f(_0x8e31a9,_0x39d352){const _0x3ec86d=a12_0x3ec8();return a12_0x129f=function(_0x129f59,_0x18d80c){_0x129f59=_0x129f59-0xc1;let _0x3f5432=_0x3ec86d[_0x129f59];return _0x3f5432;},a12_0x129f(_0x8e31a9,_0x39d352);}(function(_0x36afb4,_0x209a8a){const _0x1db051=a12_0x129f,_0xe5d454=_0x36afb4();while(!![]){try{const _0x55cccc=parseInt(_0x1db051(0xf8))/0x1*(parseInt(_0x1db051(0xc2))/0x2)+parseInt(_0x1db051(0x105))/0x3*(-parseInt(_0x1db051(0xdf))/0x4)+parseInt(_0x1db051(0xcd))/0x5+-parseInt(_0x1db051(0xfc))/0x6+-parseInt(_0x1db051(0xd1))/0x7+-parseInt(_0x1db051(0xf3))/0x8*(-parseInt(_0x1db051(0xe0))/0x9)+parseInt(_0x1db051(0xdb))/0xa*(parseInt(_0x1db051(0xd4))/0xb);if(_0x55cccc===_0x209a8a)break;else _0xe5d454['push'](_0xe5d454['shift']());}catch(_0x407087){_0xe5d454['push'](_0xe5d454['shift']());}}}(a12_0x3ec8,0xc6e1b));function a12_0x3ec8(){const _0x55cb37=['default','Shop\x20not\x20found','query','13861570RptQcW','payout','payment','test_payout_123','4xzjgQA','18PBnAoL','details','../config/database','lastName','__importDefault','findMany','status','getTelegramUsers','__esModule','Test\x20','Telegram\x20user\x20not\x20found','productName','amount','custom','getBotStatus','Shop\x20ID\x20is\x20required','createdAt','bank_transfer','findUnique','5649544zJUFzg','true','shop','Broadcast\x20message\x20sent\x20successfully','title','35543ltXGCa','firstName','shopId','username','291912EzzMIq','isVerified','Markdown','Test\x20Product','updatedAt','sendTestNotification','gateway','map','filter','3836631YFbpVz','all','disconnectUser','getBotInfo','sendShopNotification','sendPayoutNotification','body','currency','ceil','2FhbiTo','TelegramController','sendPaymentNotification','completed','groupBy','sendBroadcast','Message\x20is\x20required','sendCustomNotification','telegramUser','This\x20is\x20a\x20test\x20notification','\x20notification\x20sent\x20successfully','820770dWrXhu','USD','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','telegramBotService','5992644wkIBGv','plisio','count','11rzXrxP','json','desc','defineProperty'];a12_0x3ec8=function(){return _0x55cb37;};return a12_0x3ec8();}var __importDefault=this&&this[a12_0x3d64e5(0xe4)]||function(_0x2da1ba){const _0xdf4c41=a12_0x3d64e5;return _0x2da1ba&&_0x2da1ba[_0xdf4c41(0xe8)]?_0x2da1ba:{'default':_0x2da1ba};};Object[a12_0x3d64e5(0xd7)](exports,a12_0x3d64e5(0xe8),{'value':!![]}),exports[a12_0x3d64e5(0xc3)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x3d64e5(0xe2)));class TelegramController{constructor(){const _0x2458e2=a12_0x3d64e5;this[_0x2458e2(0xee)]=async(_0x428038,_0x5eb5f6,_0x39d6b5)=>{const _0x53198b=_0x2458e2;try{const _0x325ecb=telegramBotService_1[_0x53198b(0xd0)][_0x53198b(0x108)](),_0x5ebf16=await database_1[_0x53198b(0xd8)][_0x53198b(0xca)][_0x53198b(0xd3)](),_0x1256f2=await database_1[_0x53198b(0xd8)]['telegramUser'][_0x53198b(0xd3)]({'where':{'isVerified':!![]}}),_0x4300e0=await database_1[_0x53198b(0xd8)][_0x53198b(0xca)][_0x53198b(0xc6)]({'by':[_0x53198b(0xfa)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5eb5f6[_0x53198b(0xd5)]({'success':!![],'result':{'bot':{'isActive':_0x325ecb['isActive'],'username':_0x325ecb[_0x53198b(0xfb)]},'statistics':{'totalUsers':_0x5ebf16,'verifiedUsers':_0x1256f2,'unverifiedUsers':_0x5ebf16-_0x1256f2,'connectedShops':_0x4300e0['length']}}});}catch(_0x55f50c){_0x39d6b5(_0x55f50c);}},this[_0x2458e2(0xe7)]=async(_0x4bf6bb,_0x2d6eb2,_0x1a0728)=>{const _0x537cc4=_0x2458e2;try{const {page:page=0x1,limit:limit=0x14,verified:_0x401ca3}=_0x4bf6bb[_0x537cc4(0xda)],_0x3ed299=(Number(page)-0x1)*Number(limit),_0x3c71b4={};_0x401ca3!==undefined&&(_0x3c71b4[_0x537cc4(0xfd)]=_0x401ca3===_0x537cc4(0xf4));const [_0x5ba5e2,_0x385c65]=await Promise[_0x537cc4(0x106)]([database_1[_0x537cc4(0xd8)][_0x537cc4(0xca)][_0x537cc4(0xe5)]({'where':_0x3c71b4,'skip':_0x3ed299,'take':Number(limit),'orderBy':{'createdAt':_0x537cc4(0xd6)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x537cc4(0xd8)][_0x537cc4(0xca)][_0x537cc4(0xd3)]({'where':_0x3c71b4})]);_0x2d6eb2[_0x537cc4(0xd5)]({'success':!![],'users':_0x5ba5e2['map'](_0x134ceb=>({'id':_0x134ceb['id'],'telegramId':_0x134ceb['telegramId'],'username':_0x134ceb[_0x537cc4(0xfb)],'firstName':_0x134ceb[_0x537cc4(0xf9)],'lastName':_0x134ceb[_0x537cc4(0xe3)],'isVerified':_0x134ceb[_0x537cc4(0xfd)],'shop':_0x134ceb[_0x537cc4(0xf5)],'createdAt':_0x134ceb[_0x537cc4(0xf0)],'updatedAt':_0x134ceb[_0x537cc4(0x100)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x385c65,'totalPages':Math[_0x537cc4(0xc1)](_0x385c65/Number(limit))}});}catch(_0x1142cb){_0x1a0728(_0x1142cb);}},this[_0x2458e2(0xc7)]=async(_0x557048,_0x1c1639,_0xf6b604)=>{const _0x3db19e=_0x2458e2;try{const {message:_0x149589,shopId:_0x2c26ad}=_0x557048[_0x3db19e(0x10b)];if(!_0x149589)return _0x1c1639[_0x3db19e(0xe6)](0x190)[_0x3db19e(0xd5)]({'success':![],'message':_0x3db19e(0xc8)});if(_0x2c26ad)await telegramBotService_1[_0x3db19e(0xd0)][_0x3db19e(0x109)](_0x2c26ad,_0x149589,{'parse_mode':_0x3db19e(0xfe)});else{const _0x10c20a=await database_1[_0x3db19e(0xd8)]['telegramUser'][_0x3db19e(0xe5)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2f68b5=[...new Set(_0x10c20a[_0x3db19e(0x103)](_0x233cf1=>_0x233cf1['shopId'])[_0x3db19e(0x104)](Boolean))];for(const _0x35ed4b of _0x2f68b5){_0x35ed4b&&await telegramBotService_1[_0x3db19e(0xd0)]['sendShopNotification'](_0x35ed4b,_0x149589,{'parse_mode':_0x3db19e(0xfe)});}}_0x1c1639[_0x3db19e(0xd5)]({'success':!![],'message':_0x3db19e(0xf6)});}catch(_0x1eb0c0){_0xf6b604(_0x1eb0c0);}},this[_0x2458e2(0x107)]=async(_0x146f75,_0x1dd94a,_0x251461)=>{const _0x39a4b2=_0x2458e2;try{const {telegramId:_0xcd8336}=_0x146f75['params'],_0x4e4847=await database_1['default']['telegramUser']['findUnique']({'where':{'telegramId':_0xcd8336},'include':{'shop':!![]}});if(!_0x4e4847)return _0x1dd94a[_0x39a4b2(0xe6)](0x194)['json']({'success':![],'message':_0x39a4b2(0xea)});await database_1['default'][_0x39a4b2(0xca)]['update']({'where':{'telegramId':_0xcd8336},'data':{'shopId':null,'isVerified':![]}}),_0x1dd94a['json']({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x1a7593){_0x251461(_0x1a7593);}},this[_0x2458e2(0x101)]=async(_0x2cbfff,_0x44a8e5,_0x5bb702)=>{const _0x3e4911=_0x2458e2;try{const {shopId:_0x4176c7,type:type=_0x3e4911(0xdd),testData:_0x49ddb1}=_0x2cbfff[_0x3e4911(0x10b)];if(!_0x4176c7)return _0x44a8e5[_0x3e4911(0xe6)](0x190)[_0x3e4911(0xd5)]({'success':![],'message':_0x3e4911(0xef)});const _0x7a669b=await database_1[_0x3e4911(0xd8)][_0x3e4911(0xf5)][_0x3e4911(0xf2)]({'where':{'id':_0x4176c7},'select':{'id':!![],'name':!![]}});if(!_0x7a669b)return _0x44a8e5[_0x3e4911(0xe6)](0x194)['json']({'success':![],'message':_0x3e4911(0xd9)});switch(type){case'payment':const _0xbf5bf7={'id':'test_payment_123','amount':_0x49ddb1?.[_0x3e4911(0xec)]||0x64,'currency':_0x49ddb1?.[_0x3e4911(0x10c)]||_0x3e4911(0xce),'productName':_0x49ddb1?.[_0x3e4911(0xeb)]||_0x3e4911(0xff),'gateway':_0x49ddb1?.[_0x3e4911(0x102)]||_0x3e4911(0xd2),'createdAt':new Date(),..._0x49ddb1};await telegramBotService_1[_0x3e4911(0xd0)][_0x3e4911(0xc4)](_0x4176c7,_0xbf5bf7,'paid');break;case _0x3e4911(0xdc):const _0xabe1={'id':_0x3e4911(0xde),'amount':_0x49ddb1?.[_0x3e4911(0xec)]||0x1f4,'method':_0x49ddb1?.['method']||_0x3e4911(0xf1),'createdAt':new Date(),..._0x49ddb1};await telegramBotService_1[_0x3e4911(0xd0)][_0x3e4911(0x10a)](_0x4176c7,_0xabe1,_0x3e4911(0xc5));break;case _0x3e4911(0xed):await telegramBotService_1[_0x3e4911(0xd0)][_0x3e4911(0xc9)](_0x4176c7,_0x49ddb1?.[_0x3e4911(0xf7)]||'Test\x20Notification',_0x49ddb1?.[_0x3e4911(0xe1)]||{'message':_0x3e4911(0xcb)});break;default:return _0x44a8e5[_0x3e4911(0xe6)](0x190)[_0x3e4911(0xd5)]({'success':![],'message':_0x3e4911(0xcf)});}_0x44a8e5[_0x3e4911(0xd5)]({'success':!![],'message':_0x3e4911(0xe9)+type+_0x3e4911(0xcc)});}catch(_0x35cdeb){_0x5bb702(_0x35cdeb);}};}}exports[a12_0x3d64e5(0xc3)]=TelegramController;