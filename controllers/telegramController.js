'use strict';function a12_0x3368(_0x207881,_0x25ac62){const _0x203959=a12_0x2039();return a12_0x3368=function(_0x3368a6,_0x35df88){_0x3368a6=_0x3368a6-0x1e5;let _0x51e0a4=_0x203959[_0x3368a6];return _0x51e0a4;},a12_0x3368(_0x207881,_0x25ac62);}const a12_0x5a9235=a12_0x3368;(function(_0x5b1cea,_0x24cd93){const _0x470c4b=a12_0x3368,_0x50f58e=_0x5b1cea();while(!![]){try{const _0x3c4b50=-parseInt(_0x470c4b(0x20e))/0x1+-parseInt(_0x470c4b(0x230))/0x2*(-parseInt(_0x470c4b(0x22e))/0x3)+-parseInt(_0x470c4b(0x215))/0x4*(-parseInt(_0x470c4b(0x21c))/0x5)+parseInt(_0x470c4b(0x204))/0x6*(parseInt(_0x470c4b(0x202))/0x7)+parseInt(_0x470c4b(0x1e5))/0x8+parseInt(_0x470c4b(0x209))/0x9*(parseInt(_0x470c4b(0x1fb))/0xa)+-parseInt(_0x470c4b(0x20c))/0xb;if(_0x3c4b50===_0x24cd93)break;else _0x50f58e['push'](_0x50f58e['shift']());}catch(_0xb1cb90){_0x50f58e['push'](_0x50f58e['shift']());}}}(a12_0x2039,0x1fc6a));var __importDefault=this&&this[a12_0x5a9235(0x21e)]||function(_0x55f514){const _0x134f4f=a12_0x5a9235;return _0x55f514&&_0x55f514[_0x134f4f(0x200)]?_0x55f514:{'default':_0x55f514};};Object[a12_0x5a9235(0x1e6)](exports,a12_0x5a9235(0x200),{'value':!![]}),exports[a12_0x5a9235(0x211)]=void 0x0;function a12_0x2039(){const _0x16257e=['6KSFmWh','createdAt','username','map','Markdown','9yMhTzq','status','sendShopNotification','5949680cVlyan','payment','164883cCGIVp','disconnectUser','update','TelegramController','Shop\x20ID\x20is\x20required','paid','currency','152dcKabF','payout','body','isVerified','Test\x20Product','Test\x20','telegramBotService','8795vgawTQ','User\x20disconnected\x20successfully','__importDefault','test_payout_123','getTelegramUsers','getBotInfo','sendPaymentNotification','true','sendPayoutNotification','amount','title','Test\x20Notification','findUnique','../services/telegramBotService','\x20notification\x20sent\x20successfully','shop','telegramId','Message\x20is\x20required','3747OKBWkG','findMany','382gfFWFA','length','940224kofLNo','defineProperty','Telegram\x20user\x20not\x20found','bank_transfer','json','completed','sendTestNotification','filter','plisio','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','sendCustomNotification','shopId','sendBroadcast','firstName','Broadcast\x20message\x20sent\x20successfully','gateway','count','This\x20is\x20a\x20test\x20notification','test_payment_123','query','../config/database','method','2353290HVzrFn','custom','USD','telegramUser','params','__esModule','isActive','1243613WirdkE','default'];a12_0x2039=function(){return _0x16257e;};return a12_0x2039();}const telegramBotService_1=require(a12_0x5a9235(0x229)),database_1=__importDefault(require(a12_0x5a9235(0x1f9)));class TelegramController{constructor(){const _0x477590=a12_0x5a9235;this['getBotStatus']=async(_0x1d0d8d,_0x1cfdc9,_0x51e6e9)=>{const _0x3f05ea=a12_0x3368;try{const _0x456a1b=telegramBotService_1[_0x3f05ea(0x21b)][_0x3f05ea(0x221)](),_0x4083e0=await database_1[_0x3f05ea(0x203)][_0x3f05ea(0x1fe)][_0x3f05ea(0x1f5)](),_0x9260c3=await database_1['default']['telegramUser'][_0x3f05ea(0x1f5)]({'where':{'isVerified':!![]}}),_0x9b7b1c=await database_1[_0x3f05ea(0x203)]['telegramUser']['groupBy']({'by':[_0x3f05ea(0x1f0)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1cfdc9[_0x3f05ea(0x1e9)]({'success':!![],'result':{'bot':{'isActive':_0x456a1b[_0x3f05ea(0x201)],'username':_0x456a1b['username']},'statistics':{'totalUsers':_0x4083e0,'verifiedUsers':_0x9260c3,'unverifiedUsers':_0x4083e0-_0x9260c3,'connectedShops':_0x9b7b1c[_0x3f05ea(0x231)]}}});}catch(_0xca793d){_0x51e6e9(_0xca793d);}},this[_0x477590(0x220)]=async(_0x5b1b2d,_0x313215,_0x45c18f)=>{const _0x29b52d=_0x477590;try{const {page:page=0x1,limit:limit=0x14,verified:_0x15ea86}=_0x5b1b2d[_0x29b52d(0x1f8)],_0x1fd3fd=(Number(page)-0x1)*Number(limit),_0xc36fe1={};_0x15ea86!==undefined&&(_0xc36fe1[_0x29b52d(0x218)]=_0x15ea86===_0x29b52d(0x223));const [_0x8a4885,_0x5b8400]=await Promise['all']([database_1[_0x29b52d(0x203)][_0x29b52d(0x1fe)]['findMany']({'where':_0xc36fe1,'skip':_0x1fd3fd,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x29b52d(0x203)]['telegramUser']['count']({'where':_0xc36fe1})]);_0x313215[_0x29b52d(0x1e9)]({'success':!![],'users':_0x8a4885[_0x29b52d(0x207)](_0x506096=>({'id':_0x506096['id'],'telegramId':_0x506096[_0x29b52d(0x22c)],'username':_0x506096[_0x29b52d(0x206)],'firstName':_0x506096[_0x29b52d(0x1f2)],'lastName':_0x506096['lastName'],'isVerified':_0x506096[_0x29b52d(0x218)],'shop':_0x506096[_0x29b52d(0x22b)],'createdAt':_0x506096[_0x29b52d(0x205)],'updatedAt':_0x506096['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5b8400,'totalPages':Math['ceil'](_0x5b8400/Number(limit))}});}catch(_0x40f359){_0x45c18f(_0x40f359);}},this[_0x477590(0x1f1)]=async(_0x4a46cb,_0x599559,_0xc797d0)=>{const _0x15f113=_0x477590;try{const {message:_0x3f4209,shopId:_0xc0b536}=_0x4a46cb[_0x15f113(0x217)];if(!_0x3f4209)return _0x599559[_0x15f113(0x20a)](0x190)['json']({'success':![],'message':_0x15f113(0x22d)});if(_0xc0b536)await telegramBotService_1[_0x15f113(0x21b)][_0x15f113(0x20b)](_0xc0b536,_0x3f4209,{'parse_mode':_0x15f113(0x208)});else{const _0x41fc74=await database_1['default'][_0x15f113(0x1fe)][_0x15f113(0x22f)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x458de9=[...new Set(_0x41fc74[_0x15f113(0x207)](_0x25fb47=>_0x25fb47[_0x15f113(0x1f0)])[_0x15f113(0x1ec)](Boolean))];for(const _0x88caef of _0x458de9){_0x88caef&&await telegramBotService_1[_0x15f113(0x21b)][_0x15f113(0x20b)](_0x88caef,_0x3f4209,{'parse_mode':_0x15f113(0x208)});}}_0x599559[_0x15f113(0x1e9)]({'success':!![],'message':_0x15f113(0x1f3)});}catch(_0x54273d){_0xc797d0(_0x54273d);}},this[_0x477590(0x20f)]=async(_0x5cdd49,_0x70ced6,_0x344398)=>{const _0x311b38=_0x477590;try{const {telegramId:_0x4c89e0}=_0x5cdd49[_0x311b38(0x1ff)],_0x24c58a=await database_1[_0x311b38(0x203)][_0x311b38(0x1fe)][_0x311b38(0x228)]({'where':{'telegramId':_0x4c89e0},'include':{'shop':!![]}});if(!_0x24c58a)return _0x70ced6[_0x311b38(0x20a)](0x194)['json']({'success':![],'message':_0x311b38(0x1e7)});await database_1['default'][_0x311b38(0x1fe)][_0x311b38(0x210)]({'where':{'telegramId':_0x4c89e0},'data':{'shopId':null,'isVerified':![]}}),_0x70ced6[_0x311b38(0x1e9)]({'success':!![],'message':_0x311b38(0x21d)});}catch(_0x48806f){_0x344398(_0x48806f);}},this[_0x477590(0x1eb)]=async(_0x28505e,_0xe76720,_0x5e8888)=>{const _0x133de7=_0x477590;try{const {shopId:_0x5abd92,type:type=_0x133de7(0x20d),testData:_0x1178eb}=_0x28505e['body'];if(!_0x5abd92)return _0xe76720['status'](0x190)[_0x133de7(0x1e9)]({'success':![],'message':_0x133de7(0x212)});const _0xa20cfe=await database_1[_0x133de7(0x203)]['shop'][_0x133de7(0x228)]({'where':{'id':_0x5abd92},'select':{'id':!![],'name':!![]}});if(!_0xa20cfe)return _0xe76720['status'](0x194)[_0x133de7(0x1e9)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0x224dbf={'id':_0x133de7(0x1f7),'amount':_0x1178eb?.[_0x133de7(0x225)]||0x64,'currency':_0x1178eb?.[_0x133de7(0x214)]||_0x133de7(0x1fd),'productName':_0x1178eb?.['productName']||_0x133de7(0x219),'gateway':_0x1178eb?.[_0x133de7(0x1f4)]||_0x133de7(0x1ed),'createdAt':new Date(),..._0x1178eb};await telegramBotService_1['telegramBotService'][_0x133de7(0x222)](_0x5abd92,_0x224dbf,_0x133de7(0x213));break;case _0x133de7(0x216):const _0x8302fd={'id':_0x133de7(0x21f),'amount':_0x1178eb?.['amount']||0x1f4,'method':_0x1178eb?.[_0x133de7(0x1fa)]||_0x133de7(0x1e8),'createdAt':new Date(),..._0x1178eb};await telegramBotService_1[_0x133de7(0x21b)][_0x133de7(0x224)](_0x5abd92,_0x8302fd,_0x133de7(0x1ea));break;case _0x133de7(0x1fc):await telegramBotService_1[_0x133de7(0x21b)][_0x133de7(0x1ef)](_0x5abd92,_0x1178eb?.[_0x133de7(0x226)]||_0x133de7(0x227),_0x1178eb?.['details']||{'message':_0x133de7(0x1f6)});break;default:return _0xe76720[_0x133de7(0x20a)](0x190)[_0x133de7(0x1e9)]({'success':![],'message':_0x133de7(0x1ee)});}_0xe76720[_0x133de7(0x1e9)]({'success':!![],'message':_0x133de7(0x21a)+type+_0x133de7(0x22a)});}catch(_0x50a717){_0x5e8888(_0x50a717);}};}}exports['TelegramController']=TelegramController;