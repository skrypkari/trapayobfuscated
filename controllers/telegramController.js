'use strict';const a12_0xefee8=a12_0x5c6a;(function(_0x228feb,_0x107b85){const _0x140921=a12_0x5c6a,_0x231f91=_0x228feb();while(!![]){try{const _0xb89868=-parseInt(_0x140921(0x1b5))/0x1*(-parseInt(_0x140921(0x1b6))/0x2)+-parseInt(_0x140921(0x19d))/0x3+parseInt(_0x140921(0x192))/0x4+parseInt(_0x140921(0x1a6))/0x5*(parseInt(_0x140921(0x191))/0x6)+parseInt(_0x140921(0x188))/0x7*(parseInt(_0x140921(0x1ab))/0x8)+parseInt(_0x140921(0x196))/0x9*(-parseInt(_0x140921(0x1bd))/0xa)+-parseInt(_0x140921(0x199))/0xb*(-parseInt(_0x140921(0x1b1))/0xc);if(_0xb89868===_0x107b85)break;else _0x231f91['push'](_0x231f91['shift']());}catch(_0x35fcdb){_0x231f91['push'](_0x231f91['shift']());}}}(a12_0x3801,0x94e2a));var __importDefault=this&&this[a12_0xefee8(0x1af)]||function(_0x386f7f){const _0x2ec3cc=a12_0xefee8;return _0x386f7f&&_0x386f7f[_0x2ec3cc(0x1bf)]?_0x386f7f:{'default':_0x386f7f};};Object[a12_0xefee8(0x1b4)](exports,a12_0xefee8(0x1bf),{'value':!![]}),exports[a12_0xefee8(0x195)]=void 0x0;const telegramBotService_1=require(a12_0xefee8(0x183)),database_1=__importDefault(require('../config/database'));function a12_0x5c6a(_0x1a97a6,_0x53e115){const _0x38016c=a12_0x3801();return a12_0x5c6a=function(_0x5c6ad3,_0x3256c4){_0x5c6ad3=_0x5c6ad3-0x180;let _0x49ce1a=_0x38016c[_0x5c6ad3];return _0x49ce1a;},a12_0x5c6a(_0x1a97a6,_0x53e115);}function a12_0x3801(){const _0x4d54d1=['sendTestNotification','true','json','update','../services/telegramBotService','status','Shop\x20ID\x20is\x20required','Markdown','sendBroadcast','91546BWGayr','amount','Shop\x20not\x20found','getBotStatus','details','map','isActive','isVerified','title','6xvwxdU','579156KiOtPf','payout','lastName','TelegramController','176427VOXBkL','getBotInfo','sendCustomNotification','158851ymhSoP','test_payment_123','gateway','count','3617670ZfOpCH','firstName','Broadcast\x20message\x20sent\x20successfully','shop','payment','shopId','method','params','username','1088525kXbYSw','query','USD','updatedAt','telegramBotService','304GvltlZ','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','currency','desc','__importDefault','completed','768mBJIhF','Test\x20Notification','filter','defineProperty','584MrbeFv','244XvdQOW','This\x20is\x20a\x20test\x20notification','findMany','\x20notification\x20sent\x20successfully','findUnique','telegramUser','groupBy','20ZJSDDy','sendShopNotification','__esModule','Telegram\x20user\x20not\x20found','default','Test\x20','body','custom','productName'];a12_0x3801=function(){return _0x4d54d1;};return a12_0x3801();}class TelegramController{constructor(){const _0x511224=a12_0xefee8;this[_0x511224(0x18b)]=async(_0x33b059,_0x33ed91,_0x5c9b5c)=>{const _0x5c08bc=_0x511224;try{const _0x334082=telegramBotService_1[_0x5c08bc(0x1aa)][_0x5c08bc(0x197)](),_0x2feda2=await database_1[_0x5c08bc(0x1c1)]['telegramUser'][_0x5c08bc(0x19c)](),_0x2b6f08=await database_1['default'][_0x5c08bc(0x1bb)][_0x5c08bc(0x19c)]({'where':{'isVerified':!![]}}),_0x13293e=await database_1['default']['telegramUser'][_0x5c08bc(0x1bc)]({'by':[_0x5c08bc(0x1a2)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x33ed91[_0x5c08bc(0x181)]({'success':!![],'result':{'bot':{'isActive':_0x334082[_0x5c08bc(0x18e)],'username':_0x334082['username']},'statistics':{'totalUsers':_0x2feda2,'verifiedUsers':_0x2b6f08,'unverifiedUsers':_0x2feda2-_0x2b6f08,'connectedShops':_0x13293e['length']}}});}catch(_0x8229ee){_0x5c9b5c(_0x8229ee);}},this['getTelegramUsers']=async(_0x1c59b9,_0x35bef6,_0x5c7d45)=>{const _0x4d83a0=_0x511224;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1d1428}=_0x1c59b9[_0x4d83a0(0x1a7)],_0x3ac296=(Number(page)-0x1)*Number(limit),_0x2c6d4b={};_0x1d1428!==undefined&&(_0x2c6d4b[_0x4d83a0(0x18f)]=_0x1d1428===_0x4d83a0(0x180));const [_0x699673,_0x1f5459]=await Promise['all']([database_1[_0x4d83a0(0x1c1)]['telegramUser'][_0x4d83a0(0x1b8)]({'where':_0x2c6d4b,'skip':_0x3ac296,'take':Number(limit),'orderBy':{'createdAt':_0x4d83a0(0x1ae)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4d83a0(0x1c1)]['telegramUser'][_0x4d83a0(0x19c)]({'where':_0x2c6d4b})]);_0x35bef6['json']({'success':!![],'users':_0x699673[_0x4d83a0(0x18d)](_0x31c3ea=>({'id':_0x31c3ea['id'],'telegramId':_0x31c3ea['telegramId'],'username':_0x31c3ea[_0x4d83a0(0x1a5)],'firstName':_0x31c3ea[_0x4d83a0(0x19e)],'lastName':_0x31c3ea[_0x4d83a0(0x194)],'isVerified':_0x31c3ea['isVerified'],'shop':_0x31c3ea[_0x4d83a0(0x1a0)],'createdAt':_0x31c3ea['createdAt'],'updatedAt':_0x31c3ea[_0x4d83a0(0x1a9)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1f5459,'totalPages':Math['ceil'](_0x1f5459/Number(limit))}});}catch(_0x55943e){_0x5c7d45(_0x55943e);}},this[_0x511224(0x187)]=async(_0x4ca106,_0x4dea55,_0x12e2b6)=>{const _0xaf778e=_0x511224;try{const {message:_0x5f02c2,shopId:_0x3b6011}=_0x4ca106['body'];if(!_0x5f02c2)return _0x4dea55[_0xaf778e(0x184)](0x190)[_0xaf778e(0x181)]({'success':![],'message':'Message\x20is\x20required'});if(_0x3b6011)await telegramBotService_1[_0xaf778e(0x1aa)][_0xaf778e(0x1be)](_0x3b6011,_0x5f02c2,{'parse_mode':_0xaf778e(0x186)});else{const _0x4b3c2a=await database_1[_0xaf778e(0x1c1)][_0xaf778e(0x1bb)][_0xaf778e(0x1b8)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2e90e0=[...new Set(_0x4b3c2a['map'](_0x521f10=>_0x521f10['shopId'])[_0xaf778e(0x1b3)](Boolean))];for(const _0x1cd7b3 of _0x2e90e0){_0x1cd7b3&&await telegramBotService_1[_0xaf778e(0x1aa)][_0xaf778e(0x1be)](_0x1cd7b3,_0x5f02c2,{'parse_mode':'Markdown'});}}_0x4dea55[_0xaf778e(0x181)]({'success':!![],'message':_0xaf778e(0x19f)});}catch(_0x20f110){_0x12e2b6(_0x20f110);}},this['disconnectUser']=async(_0x1a5d88,_0x596707,_0x1a85c8)=>{const _0x1ef832=_0x511224;try{const {telegramId:_0x3071ce}=_0x1a5d88[_0x1ef832(0x1a4)],_0x5e7a3e=await database_1[_0x1ef832(0x1c1)][_0x1ef832(0x1bb)][_0x1ef832(0x1ba)]({'where':{'telegramId':_0x3071ce},'include':{'shop':!![]}});if(!_0x5e7a3e)return _0x596707['status'](0x194)['json']({'success':![],'message':_0x1ef832(0x1c0)});await database_1[_0x1ef832(0x1c1)]['telegramUser'][_0x1ef832(0x182)]({'where':{'telegramId':_0x3071ce},'data':{'shopId':null,'isVerified':![]}}),_0x596707[_0x1ef832(0x181)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x179205){_0x1a85c8(_0x179205);}},this[_0x511224(0x1c6)]=async(_0x3e2731,_0x214ff1,_0x49c6ea)=>{const _0x272735=_0x511224;try{const {shopId:_0x53d8eb,type:type=_0x272735(0x1a1),testData:_0x3d6870}=_0x3e2731[_0x272735(0x1c3)];if(!_0x53d8eb)return _0x214ff1[_0x272735(0x184)](0x190)[_0x272735(0x181)]({'success':![],'message':_0x272735(0x185)});const _0x2ca246=await database_1[_0x272735(0x1c1)][_0x272735(0x1a0)][_0x272735(0x1ba)]({'where':{'id':_0x53d8eb},'select':{'id':!![],'name':!![]}});if(!_0x2ca246)return _0x214ff1['status'](0x194)[_0x272735(0x181)]({'success':![],'message':_0x272735(0x18a)});switch(type){case'payment':const _0x493c3d={'id':_0x272735(0x19a),'amount':_0x3d6870?.[_0x272735(0x189)]||0x64,'currency':_0x3d6870?.[_0x272735(0x1ad)]||_0x272735(0x1a8),'productName':_0x3d6870?.[_0x272735(0x1c5)]||'Test\x20Product','gateway':_0x3d6870?.[_0x272735(0x19b)]||'plisio','createdAt':new Date(),..._0x3d6870};await telegramBotService_1[_0x272735(0x1aa)]['sendPaymentNotification'](_0x53d8eb,_0x493c3d,'paid');break;case _0x272735(0x193):const _0x543abc={'id':'test_payout_123','amount':_0x3d6870?.[_0x272735(0x189)]||0x1f4,'method':_0x3d6870?.[_0x272735(0x1a3)]||'bank_transfer','createdAt':new Date(),..._0x3d6870};await telegramBotService_1[_0x272735(0x1aa)]['sendPayoutNotification'](_0x53d8eb,_0x543abc,_0x272735(0x1b0));break;case _0x272735(0x1c4):await telegramBotService_1[_0x272735(0x1aa)][_0x272735(0x198)](_0x53d8eb,_0x3d6870?.[_0x272735(0x190)]||_0x272735(0x1b2),_0x3d6870?.[_0x272735(0x18c)]||{'message':_0x272735(0x1b7)});break;default:return _0x214ff1[_0x272735(0x184)](0x190)['json']({'success':![],'message':_0x272735(0x1ac)});}_0x214ff1['json']({'success':!![],'message':_0x272735(0x1c2)+type+_0x272735(0x1b9)});}catch(_0x22e913){_0x49c6ea(_0x22e913);}};}}exports[a12_0xefee8(0x195)]=TelegramController;