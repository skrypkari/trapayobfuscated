'use strict';const a12_0xa0b1a2=a12_0x286d;function a12_0x547b(){const _0x1b702e=['1436245SdeiYW','shop','84MLqght','Test\x20Product','update','test_payout_123','map','__esModule','gateway','count','1565333IIBqsZ','getBotStatus','6iGDcDv','sendTestNotification','User\x20disconnected\x20successfully','17977HmveZI','default','18lWcqlg','shopId','21201ztQmaV','../config/database','2763444VAVHQK','165296hkywRu','title','64mbrcJb','\x20notification\x20sent\x20successfully','updatedAt','Telegram\x20user\x20not\x20found','custom','plisio','findMany','sendShopNotification','Test\x20','createdAt','username','test_payment_123','params','sendCustomNotification','USD','telegramUser','telegramId','../services/telegramBotService','getTelegramUsers','__importDefault','query','Shop\x20ID\x20is\x20required','ceil','defineProperty','filter','isActive','length','TelegramController','isVerified','payment','bank_transfer','json','productName','currency','disconnectUser','122022gvBMti','findUnique','Test\x20Notification','details','completed','telegramBotService','130xUJWlo','groupBy','status','sendBroadcast','body'];a12_0x547b=function(){return _0x1b702e;};return a12_0x547b();}(function(_0x56802c,_0x569f46){const _0x4df7e1=a12_0x286d,_0x39fb66=_0x56802c();while(!![]){try{const _0x55f8cc=-parseInt(_0x4df7e1(0xd5))/0x1*(-parseInt(_0x4df7e1(0xd7))/0x2)+parseInt(_0x4df7e1(0xd9))/0x3*(-parseInt(_0x4df7e1(0xde))/0x4)+-parseInt(_0x4df7e1(0xc6))/0x5*(-parseInt(_0x4df7e1(0xd2))/0x6)+-parseInt(_0x4df7e1(0xc8))/0x7*(parseInt(_0x4df7e1(0xdc))/0x8)+-parseInt(_0x4df7e1(0xbb))/0x9*(-parseInt(_0x4df7e1(0xc1))/0xa)+parseInt(_0x4df7e1(0xd0))/0xb+-parseInt(_0x4df7e1(0xdb))/0xc;if(_0x55f8cc===_0x569f46)break;else _0x39fb66['push'](_0x39fb66['shift']());}catch(_0x78a255){_0x39fb66['push'](_0x39fb66['shift']());}}}(a12_0x547b,0x2b0a8));var __importDefault=this&&this[a12_0xa0b1a2(0xf1)]||function(_0x4d2743){const _0x281d5e=a12_0xa0b1a2;return _0x4d2743&&_0x4d2743[_0x281d5e(0xcd)]?_0x4d2743:{'default':_0x4d2743};};Object[a12_0xa0b1a2(0xf5)](exports,a12_0xa0b1a2(0xcd),{'value':!![]}),exports[a12_0xa0b1a2(0xf9)]=void 0x0;function a12_0x286d(_0x21011a,_0xec28e6){const _0x547b39=a12_0x547b();return a12_0x286d=function(_0x286d39,_0x55b37b){_0x286d39=_0x286d39-0xb5;let _0x5ba468=_0x547b39[_0x286d39];return _0x5ba468;},a12_0x286d(_0x21011a,_0xec28e6);}const telegramBotService_1=require(a12_0xa0b1a2(0xef)),database_1=__importDefault(require(a12_0xa0b1a2(0xda)));class TelegramController{constructor(){const _0x7da0fb=a12_0xa0b1a2;this[_0x7da0fb(0xd1)]=async(_0x1502fc,_0x2bf1bf,_0x12bd7e)=>{const _0x15e7fc=_0x7da0fb;try{const _0x2e7eb5=telegramBotService_1['telegramBotService']['getBotInfo'](),_0x42f525=await database_1[_0x15e7fc(0xd6)]['telegramUser']['count'](),_0x3a74fc=await database_1[_0x15e7fc(0xd6)][_0x15e7fc(0xed)][_0x15e7fc(0xcf)]({'where':{'isVerified':!![]}}),_0x2396cf=await database_1[_0x15e7fc(0xd6)][_0x15e7fc(0xed)][_0x15e7fc(0xc2)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2bf1bf['json']({'success':!![],'result':{'bot':{'isActive':_0x2e7eb5[_0x15e7fc(0xf7)],'username':_0x2e7eb5[_0x15e7fc(0xe8)]},'statistics':{'totalUsers':_0x42f525,'verifiedUsers':_0x3a74fc,'unverifiedUsers':_0x42f525-_0x3a74fc,'connectedShops':_0x2396cf[_0x15e7fc(0xf8)]}}});}catch(_0x4e3568){_0x12bd7e(_0x4e3568);}},this[_0x7da0fb(0xf0)]=async(_0x29b8f3,_0x131360,_0x668a4c)=>{const _0x49678c=_0x7da0fb;try{const {page:page=0x1,limit:limit=0x14,verified:_0x570120}=_0x29b8f3[_0x49678c(0xf2)],_0x58990f=(Number(page)-0x1)*Number(limit),_0x3886df={};_0x570120!==undefined&&(_0x3886df[_0x49678c(0xfa)]=_0x570120==='true');const [_0x310f5d,_0x4eb6ba]=await Promise['all']([database_1[_0x49678c(0xd6)][_0x49678c(0xed)][_0x49678c(0xe4)]({'where':_0x3886df,'skip':_0x58990f,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x49678c(0xd6)][_0x49678c(0xed)][_0x49678c(0xcf)]({'where':_0x3886df})]);_0x131360[_0x49678c(0xb7)]({'success':!![],'users':_0x310f5d[_0x49678c(0xcc)](_0x36f257=>({'id':_0x36f257['id'],'telegramId':_0x36f257[_0x49678c(0xee)],'username':_0x36f257[_0x49678c(0xe8)],'firstName':_0x36f257['firstName'],'lastName':_0x36f257['lastName'],'isVerified':_0x36f257[_0x49678c(0xfa)],'shop':_0x36f257[_0x49678c(0xc7)],'createdAt':_0x36f257[_0x49678c(0xe7)],'updatedAt':_0x36f257[_0x49678c(0xe0)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x4eb6ba,'totalPages':Math[_0x49678c(0xf4)](_0x4eb6ba/Number(limit))}});}catch(_0x7a396){_0x668a4c(_0x7a396);}},this[_0x7da0fb(0xc4)]=async(_0x2b5724,_0x155fd0,_0x1ddff7)=>{const _0xc07a88=_0x7da0fb;try{const {message:_0x31f98a,shopId:_0x5de0c9}=_0x2b5724[_0xc07a88(0xc5)];if(!_0x31f98a)return _0x155fd0[_0xc07a88(0xc3)](0x190)['json']({'success':![],'message':'Message\x20is\x20required'});if(_0x5de0c9)await telegramBotService_1[_0xc07a88(0xc0)][_0xc07a88(0xe5)](_0x5de0c9,_0x31f98a,{'parse_mode':'Markdown'});else{const _0x3c00ff=await database_1[_0xc07a88(0xd6)][_0xc07a88(0xed)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x270c13=[...new Set(_0x3c00ff[_0xc07a88(0xcc)](_0x4fa371=>_0x4fa371[_0xc07a88(0xd8)])[_0xc07a88(0xf6)](Boolean))];for(const _0x345f53 of _0x270c13){_0x345f53&&await telegramBotService_1[_0xc07a88(0xc0)]['sendShopNotification'](_0x345f53,_0x31f98a,{'parse_mode':'Markdown'});}}_0x155fd0['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x21f176){_0x1ddff7(_0x21f176);}},this[_0x7da0fb(0xba)]=async(_0x531bba,_0x5eaa8d,_0x55264e)=>{const _0x3fdc4e=_0x7da0fb;try{const {telegramId:_0x1458d9}=_0x531bba[_0x3fdc4e(0xea)],_0x198f75=await database_1['default'][_0x3fdc4e(0xed)][_0x3fdc4e(0xbc)]({'where':{'telegramId':_0x1458d9},'include':{'shop':!![]}});if(!_0x198f75)return _0x5eaa8d[_0x3fdc4e(0xc3)](0x194)[_0x3fdc4e(0xb7)]({'success':![],'message':_0x3fdc4e(0xe1)});await database_1['default'][_0x3fdc4e(0xed)][_0x3fdc4e(0xca)]({'where':{'telegramId':_0x1458d9},'data':{'shopId':null,'isVerified':![]}}),_0x5eaa8d['json']({'success':!![],'message':_0x3fdc4e(0xd4)});}catch(_0x5626db){_0x55264e(_0x5626db);}},this[_0x7da0fb(0xd3)]=async(_0x45b26a,_0x67907f,_0x2890c0)=>{const _0x4d1ddf=_0x7da0fb;try{const {shopId:_0x38485c,type:type=_0x4d1ddf(0xb5),testData:_0xf40563}=_0x45b26a[_0x4d1ddf(0xc5)];if(!_0x38485c)return _0x67907f[_0x4d1ddf(0xc3)](0x190)[_0x4d1ddf(0xb7)]({'success':![],'message':_0x4d1ddf(0xf3)});const _0x67dd86=await database_1['default']['shop'][_0x4d1ddf(0xbc)]({'where':{'id':_0x38485c},'select':{'id':!![],'name':!![]}});if(!_0x67dd86)return _0x67907f[_0x4d1ddf(0xc3)](0x194)[_0x4d1ddf(0xb7)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x4d1ddf(0xb5):const _0x477b2f={'id':_0x4d1ddf(0xe9),'amount':_0xf40563?.['amount']||0x64,'currency':_0xf40563?.[_0x4d1ddf(0xb9)]||_0x4d1ddf(0xec),'productName':_0xf40563?.[_0x4d1ddf(0xb8)]||_0x4d1ddf(0xc9),'gateway':_0xf40563?.[_0x4d1ddf(0xce)]||_0x4d1ddf(0xe3),'createdAt':new Date(),..._0xf40563};await telegramBotService_1[_0x4d1ddf(0xc0)]['sendPaymentNotification'](_0x38485c,_0x477b2f,'paid');break;case'payout':const _0xef1df5={'id':_0x4d1ddf(0xcb),'amount':_0xf40563?.['amount']||0x1f4,'method':_0xf40563?.['method']||_0x4d1ddf(0xb6),'createdAt':new Date(),..._0xf40563};await telegramBotService_1[_0x4d1ddf(0xc0)]['sendPayoutNotification'](_0x38485c,_0xef1df5,_0x4d1ddf(0xbf));break;case _0x4d1ddf(0xe2):await telegramBotService_1[_0x4d1ddf(0xc0)][_0x4d1ddf(0xeb)](_0x38485c,_0xf40563?.[_0x4d1ddf(0xdd)]||_0x4d1ddf(0xbd),_0xf40563?.[_0x4d1ddf(0xbe)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x67907f[_0x4d1ddf(0xc3)](0x190)[_0x4d1ddf(0xb7)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x67907f[_0x4d1ddf(0xb7)]({'success':!![],'message':_0x4d1ddf(0xe6)+type+_0x4d1ddf(0xdf)});}catch(_0x551c61){_0x2890c0(_0x551c61);}};}}exports[a12_0xa0b1a2(0xf9)]=TelegramController;