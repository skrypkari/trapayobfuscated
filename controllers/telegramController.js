'use strict';function a20_0x410d(){const _0x463b16=['all','USD','network','filter','10lZVMBa','query','2623250BOrrXi','__esModule','shopId','shop','2CVjOUX','gateway','getBotInfo','status','Broadcast\x20message\x20sent\x20successfully','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','wallet','findMany','json','lastName','TelegramController','desc','TRC20','isVerified','plisio','Test\x20','firstName','findUnique','Telegram\x20user\x20not\x20found','\x20notification\x20sent\x20successfully','true','../config/database','132603InUiXa','Тестовый\x20период','telegramId','Message\x20is\x20required','details','7532070fWgHQv','This\x20is\x20a\x20test\x20notification','disconnectUser','telegramUser','length','User\x20disconnected\x20successfully','payout','groupBy','ceil','165930twcShs','__importDefault','../services/telegramBotService','sendPaymentNotification','productName','map','body','Markdown','test_payment_123','count','username','804472MnGKaT','default','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','sendCustomNotification','amount','484857OLIPux','test_payout_123','txid','telegramBotService','createdAt','876046FnMlhv','sendPayoutNotification','104rJrpyJ','defineProperty','payment'];a20_0x410d=function(){return _0x463b16;};return a20_0x410d();}const a20_0x5eaad9=a20_0x32b9;(function(_0x552428,_0x3413f4){const _0x2d3e78=a20_0x32b9,_0x168080=_0x552428();while(!![]){try{const _0x950722=-parseInt(_0x2d3e78(0xc5))/0x1*(-parseInt(_0x2d3e78(0xb6))/0x2)+parseInt(_0x2d3e78(0xdb))/0x3+parseInt(_0x2d3e78(0xf4))/0x4+parseInt(_0x2d3e78(0xbf))/0x5*(parseInt(_0x2d3e78(0xe9))/0x6)+-parseInt(_0x2d3e78(0xc1))/0x7+parseInt(_0x2d3e78(0xb8))/0x8*(parseInt(_0x2d3e78(0xf9))/0x9)+-parseInt(_0x2d3e78(0xe0))/0xa;if(_0x950722===_0x3413f4)break;else _0x168080['push'](_0x168080['shift']());}catch(_0x2e9fa5){_0x168080['push'](_0x168080['shift']());}}}(a20_0x410d,0xb6e0b));function a20_0x32b9(_0x5da6c1,_0x217392){_0x5da6c1=_0x5da6c1-0xb5;const _0x410d45=a20_0x410d();let _0x32b927=_0x410d45[_0x5da6c1];return _0x32b927;}var __importDefault=this&&this[a20_0x5eaad9(0xea)]||function(_0x5046e2){return _0x5046e2&&_0x5046e2['__esModule']?_0x5046e2:{'default':_0x5046e2};};Object[a20_0x5eaad9(0xb9)](exports,a20_0x5eaad9(0xc2),{'value':!![]}),exports[a20_0x5eaad9(0xcf)]=void 0x0;const telegramBotService_1=require(a20_0x5eaad9(0xeb)),database_1=__importDefault(require(a20_0x5eaad9(0xda)));class TelegramController{constructor(){const _0x7b1ecf=a20_0x5eaad9;this['getBotStatus']=async(_0x549e25,_0x5790ca,_0xfb411)=>{const _0xcb5911=a20_0x32b9;try{const _0x3bc9ee=telegramBotService_1[_0xcb5911(0xfc)][_0xcb5911(0xc7)](),_0x54f0de=await database_1[_0xcb5911(0xf5)][_0xcb5911(0xe3)][_0xcb5911(0xf2)](),_0x5650ae=await database_1[_0xcb5911(0xf5)][_0xcb5911(0xe3)]['count']({'where':{'isVerified':!![]}}),_0x4ca5c4=await database_1[_0xcb5911(0xf5)][_0xcb5911(0xe3)][_0xcb5911(0xe7)]({'by':[_0xcb5911(0xc3)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5790ca[_0xcb5911(0xcd)]({'success':!![],'result':{'bot':{'isActive':_0x3bc9ee['isActive'],'username':_0x3bc9ee['username']},'statistics':{'totalUsers':_0x54f0de,'verifiedUsers':_0x5650ae,'unverifiedUsers':_0x54f0de-_0x5650ae,'connectedShops':_0x4ca5c4[_0xcb5911(0xe4)]}}});}catch(_0x2c61de){_0xfb411(_0x2c61de);}},this['getTelegramUsers']=async(_0x49a0b8,_0x4ee88a,_0x948c4f)=>{const _0x516089=a20_0x32b9;try{const {page:page=0x1,limit:limit=0x14,verified:_0x365c9c}=_0x49a0b8[_0x516089(0xc0)],_0x4c4b5b=(Number(page)-0x1)*Number(limit),_0x28de5d={};_0x365c9c!==undefined&&(_0x28de5d[_0x516089(0xd2)]=_0x365c9c===_0x516089(0xd9));const [_0x5e6484,_0x59894f]=await Promise[_0x516089(0xbb)]([database_1[_0x516089(0xf5)][_0x516089(0xe3)][_0x516089(0xcc)]({'where':_0x28de5d,'skip':_0x4c4b5b,'take':Number(limit),'orderBy':{'createdAt':_0x516089(0xd0)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x516089(0xf5)][_0x516089(0xe3)]['count']({'where':_0x28de5d})]);_0x4ee88a['json']({'success':!![],'users':_0x5e6484[_0x516089(0xee)](_0x19fb3c=>({'id':_0x19fb3c['id'],'telegramId':_0x19fb3c[_0x516089(0xdd)],'username':_0x19fb3c[_0x516089(0xf3)],'firstName':_0x19fb3c[_0x516089(0xd5)],'lastName':_0x19fb3c[_0x516089(0xce)],'isVerified':_0x19fb3c['isVerified'],'shop':_0x19fb3c[_0x516089(0xc4)],'createdAt':_0x19fb3c[_0x516089(0xb5)],'updatedAt':_0x19fb3c['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x59894f,'totalPages':Math[_0x516089(0xe8)](_0x59894f/Number(limit))}});}catch(_0x10e41c){_0x948c4f(_0x10e41c);}},this['sendBroadcast']=async(_0x1cb0d1,_0x15c941,_0x34b0e2)=>{const _0x407cd4=a20_0x32b9;try{const {message:_0x2f707d,shopId:_0x3c05ef}=_0x1cb0d1[_0x407cd4(0xef)];if(!_0x2f707d)return _0x15c941[_0x407cd4(0xc8)](0x190)['json']({'success':![],'message':_0x407cd4(0xde)});if(_0x3c05ef)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x3c05ef,_0x2f707d,{'parse_mode':'Markdown'});else{const _0x4fb305=await database_1[_0x407cd4(0xf5)]['telegramUser'][_0x407cd4(0xcc)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x9e0d=[...new Set(_0x4fb305[_0x407cd4(0xee)](_0x5a3387=>_0x5a3387[_0x407cd4(0xc3)])[_0x407cd4(0xbe)](Boolean))];for(const _0x52caac of _0x9e0d){_0x52caac&&await telegramBotService_1[_0x407cd4(0xfc)]['sendShopNotification'](_0x52caac,_0x2f707d,{'parse_mode':_0x407cd4(0xf0)});}}_0x15c941['json']({'success':!![],'message':_0x407cd4(0xc9)});}catch(_0x2e52c7){_0x34b0e2(_0x2e52c7);}},this[_0x7b1ecf(0xe2)]=async(_0x22f99b,_0x5dd8c4,_0x3ed9fd)=>{const _0x2203df=_0x7b1ecf;try{const {telegramId:_0x5e8b44}=_0x22f99b['params'],_0x516bc2=await database_1[_0x2203df(0xf5)][_0x2203df(0xe3)][_0x2203df(0xd6)]({'where':{'telegramId':_0x5e8b44},'include':{'shop':!![]}});if(!_0x516bc2)return _0x5dd8c4['status'](0x194)[_0x2203df(0xcd)]({'success':![],'message':_0x2203df(0xd7)});await database_1[_0x2203df(0xf5)][_0x2203df(0xe3)]['update']({'where':{'telegramId':_0x5e8b44},'data':{'shopId':null,'isVerified':![]}}),_0x5dd8c4['json']({'success':!![],'message':_0x2203df(0xe5)});}catch(_0x1ac2c2){_0x3ed9fd(_0x1ac2c2);}},this['sendTestNotification']=async(_0x30f5cd,_0x3cd733,_0x4b341c)=>{const _0x512335=_0x7b1ecf;try{const {shopId:_0x2e26f8,type:type=_0x512335(0xba),testData:_0x5cdee0}=_0x30f5cd[_0x512335(0xef)];if(!_0x2e26f8)return _0x3cd733[_0x512335(0xc8)](0x190)[_0x512335(0xcd)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x2154cc=await database_1[_0x512335(0xf5)][_0x512335(0xc4)]['findUnique']({'where':{'id':_0x2e26f8},'select':{'id':!![],'name':!![]}});if(!_0x2154cc)return _0x3cd733[_0x512335(0xc8)](0x194)[_0x512335(0xcd)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x512335(0xba):const _0x1586e5={'id':_0x512335(0xf1),'amount':_0x5cdee0?.[_0x512335(0xf8)]||0x64,'currency':_0x5cdee0?.['currency']||_0x512335(0xbc),'productName':_0x5cdee0?.[_0x512335(0xed)]||'Test\x20Product','gateway':_0x5cdee0?.[_0x512335(0xc6)]||_0x512335(0xd3),'createdAt':new Date(),..._0x5cdee0};await telegramBotService_1[_0x512335(0xfc)][_0x512335(0xec)](_0x2e26f8,_0x1586e5,'paid');break;case _0x512335(0xe6):const _0x529209={'id':_0x512335(0xfa),'amount':_0x5cdee0?.[_0x512335(0xf8)]||0x1f4,'network':_0x5cdee0?.[_0x512335(0xbd)]||_0x512335(0xd1),'wallet':_0x5cdee0?.[_0x512335(0xcb)]||_0x512335(0xca),'period':_0x512335(0xdc),'createdAt':new Date(),'txid':_0x5cdee0?.[_0x512335(0xfb)]||null,..._0x5cdee0};await telegramBotService_1[_0x512335(0xfc)][_0x512335(0xb7)](_0x2e26f8,_0x529209);break;case'custom':await telegramBotService_1[_0x512335(0xfc)][_0x512335(0xf7)](_0x2e26f8,_0x5cdee0?.['title']||'Test\x20Notification',_0x5cdee0?.[_0x512335(0xdf)]||{'message':_0x512335(0xe1)});break;default:return _0x3cd733[_0x512335(0xc8)](0x190)[_0x512335(0xcd)]({'success':![],'message':_0x512335(0xf6)});}_0x3cd733[_0x512335(0xcd)]({'success':!![],'message':_0x512335(0xd4)+type+_0x512335(0xd8)});}catch(_0x131b23){_0x4b341c(_0x131b23);}};}}exports['TelegramController']=TelegramController;