'use strict';const a12_0x8faa87=a12_0x3303;(function(_0x5e55c3,_0x3ff0be){const _0x42630e=a12_0x3303,_0x39bf7b=_0x5e55c3();while(!![]){try{const _0x2d48a0=-parseInt(_0x42630e(0x1dd))/0x1*(-parseInt(_0x42630e(0x1e6))/0x2)+parseInt(_0x42630e(0x1d5))/0x3+parseInt(_0x42630e(0x1b6))/0x4*(-parseInt(_0x42630e(0x1d9))/0x5)+parseInt(_0x42630e(0x1c0))/0x6+parseInt(_0x42630e(0x1e4))/0x7+parseInt(_0x42630e(0x1ba))/0x8*(parseInt(_0x42630e(0x1d6))/0x9)+-parseInt(_0x42630e(0x1b8))/0xa;if(_0x2d48a0===_0x3ff0be)break;else _0x39bf7b['push'](_0x39bf7b['shift']());}catch(_0xb68414){_0x39bf7b['push'](_0x39bf7b['shift']());}}}(a12_0x3517,0x83f1a));var __importDefault=this&&this[a12_0x8faa87(0x1ab)]||function(_0x20e31b){const _0x77704f=a12_0x8faa87;return _0x20e31b&&_0x20e31b[_0x77704f(0x1b0)]?_0x20e31b:{'default':_0x20e31b};};function a12_0x3517(){const _0x5689bf=['Message\x20is\x20required','status','95wFmaUr','filter','findUnique','../services/telegramBotService','1071863fSLXVE','Telegram\x20user\x20not\x20found','sendShopNotification','username','paid','getBotInfo','default','5477941xSaIfI','isActive','2grbZkL','all','sendBroadcast','Broadcast\x20message\x20sent\x20successfully','Test\x20Notification','telegramBotService','desc','lastName','telegramId','\x20notification\x20sent\x20successfully','groupBy','custom','__importDefault','count','query','firstName','getTelegramUsers','__esModule','TelegramController','sendCustomNotification','map','productName','amount','132932fcKfmx','bank_transfer','23224740dHTRmI','json','192VOcolp','shopId','title','update','User\x20disconnected\x20successfully','params','4633722cdXBJP','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Test\x20Product','telegramUser','body','findMany','true','updatedAt','USD','shop','getBotStatus','Markdown','disconnectUser','../config/database','plisio','payment','Test\x20','sendPaymentNotification','gateway','createdAt','sendTestNotification','2243682aZgPUd','44901vmzQEp'];a12_0x3517=function(){return _0x5689bf;};return a12_0x3517();}Object['defineProperty'](exports,a12_0x8faa87(0x1b0),{'value':!![]}),exports['TelegramController']=void 0x0;function a12_0x3303(_0x530519,_0xe401f9){const _0x3517b3=a12_0x3517();return a12_0x3303=function(_0x330392,_0x2aa0cc){_0x330392=_0x330392-0x1a3;let _0x489420=_0x3517b3[_0x330392];return _0x489420;},a12_0x3303(_0x530519,_0xe401f9);}const telegramBotService_1=require(a12_0x8faa87(0x1dc)),database_1=__importDefault(require(a12_0x8faa87(0x1cd)));class TelegramController{constructor(){const _0x2c27a9=a12_0x8faa87;this[_0x2c27a9(0x1ca)]=async(_0x1a3102,_0x4d0242,_0x5aa68c)=>{const _0x4b50f2=_0x2c27a9;try{const _0x4a2657=telegramBotService_1[_0x4b50f2(0x1a4)][_0x4b50f2(0x1e2)](),_0x1647fc=await database_1[_0x4b50f2(0x1e3)]['telegramUser'][_0x4b50f2(0x1ac)](),_0x34cfc0=await database_1[_0x4b50f2(0x1e3)][_0x4b50f2(0x1c3)][_0x4b50f2(0x1ac)]({'where':{'isVerified':!![]}}),_0x497279=await database_1[_0x4b50f2(0x1e3)][_0x4b50f2(0x1c3)][_0x4b50f2(0x1a9)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4d0242[_0x4b50f2(0x1b9)]({'success':!![],'result':{'bot':{'isActive':_0x4a2657[_0x4b50f2(0x1e5)],'username':_0x4a2657[_0x4b50f2(0x1e0)]},'statistics':{'totalUsers':_0x1647fc,'verifiedUsers':_0x34cfc0,'unverifiedUsers':_0x1647fc-_0x34cfc0,'connectedShops':_0x497279['length']}}});}catch(_0x29ede9){_0x5aa68c(_0x29ede9);}},this[_0x2c27a9(0x1af)]=async(_0x5143f0,_0x32d642,_0x1acecc)=>{const _0x41460b=_0x2c27a9;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2730c1}=_0x5143f0[_0x41460b(0x1ad)],_0x4c3c6d=(Number(page)-0x1)*Number(limit),_0xf2105c={};_0x2730c1!==undefined&&(_0xf2105c['isVerified']=_0x2730c1===_0x41460b(0x1c6));const [_0x2ffd1c,_0x5a3c2f]=await Promise[_0x41460b(0x1e7)]([database_1[_0x41460b(0x1e3)][_0x41460b(0x1c3)][_0x41460b(0x1c5)]({'where':_0xf2105c,'skip':_0x4c3c6d,'take':Number(limit),'orderBy':{'createdAt':_0x41460b(0x1a5)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x41460b(0x1e3)][_0x41460b(0x1c3)][_0x41460b(0x1ac)]({'where':_0xf2105c})]);_0x32d642[_0x41460b(0x1b9)]({'success':!![],'users':_0x2ffd1c[_0x41460b(0x1b3)](_0x280f9e=>({'id':_0x280f9e['id'],'telegramId':_0x280f9e[_0x41460b(0x1a7)],'username':_0x280f9e['username'],'firstName':_0x280f9e[_0x41460b(0x1ae)],'lastName':_0x280f9e[_0x41460b(0x1a6)],'isVerified':_0x280f9e['isVerified'],'shop':_0x280f9e[_0x41460b(0x1c9)],'createdAt':_0x280f9e[_0x41460b(0x1d3)],'updatedAt':_0x280f9e[_0x41460b(0x1c7)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5a3c2f,'totalPages':Math['ceil'](_0x5a3c2f/Number(limit))}});}catch(_0x1a2c02){_0x1acecc(_0x1a2c02);}},this[_0x2c27a9(0x1e8)]=async(_0x47e1b6,_0x2694f0,_0x24f31f)=>{const _0x2fed8e=_0x2c27a9;try{const {message:_0x1f7bae,shopId:_0x50494e}=_0x47e1b6['body'];if(!_0x1f7bae)return _0x2694f0[_0x2fed8e(0x1d8)](0x190)['json']({'success':![],'message':_0x2fed8e(0x1d7)});if(_0x50494e)await telegramBotService_1[_0x2fed8e(0x1a4)][_0x2fed8e(0x1df)](_0x50494e,_0x1f7bae,{'parse_mode':_0x2fed8e(0x1cb)});else{const _0x10434a=await database_1[_0x2fed8e(0x1e3)]['telegramUser'][_0x2fed8e(0x1c5)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x233a2f=[...new Set(_0x10434a[_0x2fed8e(0x1b3)](_0x3191bb=>_0x3191bb[_0x2fed8e(0x1bb)])[_0x2fed8e(0x1da)](Boolean))];for(const _0x42b3b2 of _0x233a2f){_0x42b3b2&&await telegramBotService_1[_0x2fed8e(0x1a4)][_0x2fed8e(0x1df)](_0x42b3b2,_0x1f7bae,{'parse_mode':_0x2fed8e(0x1cb)});}}_0x2694f0[_0x2fed8e(0x1b9)]({'success':!![],'message':_0x2fed8e(0x1e9)});}catch(_0x2ea42f){_0x24f31f(_0x2ea42f);}},this[_0x2c27a9(0x1cc)]=async(_0x281e78,_0x387adf,_0x4b9714)=>{const _0x160e39=_0x2c27a9;try{const {telegramId:_0x2a8eab}=_0x281e78[_0x160e39(0x1bf)],_0x3c1fc7=await database_1[_0x160e39(0x1e3)][_0x160e39(0x1c3)][_0x160e39(0x1db)]({'where':{'telegramId':_0x2a8eab},'include':{'shop':!![]}});if(!_0x3c1fc7)return _0x387adf[_0x160e39(0x1d8)](0x194)[_0x160e39(0x1b9)]({'success':![],'message':_0x160e39(0x1de)});await database_1[_0x160e39(0x1e3)]['telegramUser'][_0x160e39(0x1bd)]({'where':{'telegramId':_0x2a8eab},'data':{'shopId':null,'isVerified':![]}}),_0x387adf[_0x160e39(0x1b9)]({'success':!![],'message':_0x160e39(0x1be)});}catch(_0x10aa12){_0x4b9714(_0x10aa12);}},this[_0x2c27a9(0x1d4)]=async(_0x31a5b4,_0x5228e7,_0x5e8c0b)=>{const _0x54285e=_0x2c27a9;try{const {shopId:_0x7bdafb,type:type=_0x54285e(0x1cf),testData:_0x4d6023}=_0x31a5b4[_0x54285e(0x1c4)];if(!_0x7bdafb)return _0x5228e7[_0x54285e(0x1d8)](0x190)[_0x54285e(0x1b9)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x52b3a5=await database_1['default'][_0x54285e(0x1c9)]['findUnique']({'where':{'id':_0x7bdafb},'select':{'id':!![],'name':!![]}});if(!_0x52b3a5)return _0x5228e7[_0x54285e(0x1d8)](0x194)[_0x54285e(0x1b9)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x54285e(0x1cf):const _0x23cb95={'id':'test_payment_123','amount':_0x4d6023?.[_0x54285e(0x1b5)]||0x64,'currency':_0x4d6023?.['currency']||_0x54285e(0x1c8),'productName':_0x4d6023?.[_0x54285e(0x1b4)]||_0x54285e(0x1c2),'gateway':_0x4d6023?.[_0x54285e(0x1d2)]||_0x54285e(0x1ce),'createdAt':new Date(),..._0x4d6023};await telegramBotService_1[_0x54285e(0x1a4)][_0x54285e(0x1d1)](_0x7bdafb,_0x23cb95,_0x54285e(0x1e1));break;case'payout':const _0x516763={'id':'test_payout_123','amount':_0x4d6023?.[_0x54285e(0x1b5)]||0x1f4,'method':_0x4d6023?.['method']||_0x54285e(0x1b7),'createdAt':new Date(),..._0x4d6023};await telegramBotService_1[_0x54285e(0x1a4)]['sendPayoutNotification'](_0x7bdafb,_0x516763,'completed');break;case _0x54285e(0x1aa):await telegramBotService_1[_0x54285e(0x1a4)][_0x54285e(0x1b2)](_0x7bdafb,_0x4d6023?.[_0x54285e(0x1bc)]||_0x54285e(0x1a3),_0x4d6023?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x5228e7[_0x54285e(0x1d8)](0x190)[_0x54285e(0x1b9)]({'success':![],'message':_0x54285e(0x1c1)});}_0x5228e7[_0x54285e(0x1b9)]({'success':!![],'message':_0x54285e(0x1d0)+type+_0x54285e(0x1a8)});}catch(_0x1eb4cb){_0x5e8c0b(_0x1eb4cb);}};}}exports[a12_0x8faa87(0x1b1)]=TelegramController;