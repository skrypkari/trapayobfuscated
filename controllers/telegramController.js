'use strict';const a12_0x3d4d05=a12_0x49b8;(function(_0x1447b6,_0x50e3a1){const _0x1a9c95=a12_0x49b8,_0x2a266e=_0x1447b6();while(!![]){try{const _0x53f1bd=parseInt(_0x1a9c95(0xb7))/0x1*(-parseInt(_0x1a9c95(0x90))/0x2)+-parseInt(_0x1a9c95(0x8c))/0x3*(-parseInt(_0x1a9c95(0xa6))/0x4)+-parseInt(_0x1a9c95(0xb8))/0x5+parseInt(_0x1a9c95(0xa3))/0x6*(-parseInt(_0x1a9c95(0xb5))/0x7)+-parseInt(_0x1a9c95(0x84))/0x8*(parseInt(_0x1a9c95(0xac))/0x9)+parseInt(_0x1a9c95(0xbd))/0xa*(-parseInt(_0x1a9c95(0xbe))/0xb)+parseInt(_0x1a9c95(0xb0))/0xc*(parseInt(_0x1a9c95(0x80))/0xd);if(_0x53f1bd===_0x50e3a1)break;else _0x2a266e['push'](_0x2a266e['shift']());}catch(_0x543a2f){_0x2a266e['push'](_0x2a266e['shift']());}}}(a12_0x4d00,0x83e7b));function a12_0x49b8(_0x4d38a4,_0x418ce1){const _0x4d00cb=a12_0x4d00();return a12_0x49b8=function(_0x49b865,_0x18324a){_0x49b865=_0x49b865-0x7f;let _0x167bb5=_0x4d00cb[_0x49b865];return _0x167bb5;},a12_0x49b8(_0x4d38a4,_0x418ce1);}var __importDefault=this&&this['__importDefault']||function(_0x384e6e){return _0x384e6e&&_0x384e6e['__esModule']?_0x384e6e:{'default':_0x384e6e};};Object[a12_0x3d4d05(0xc3)](exports,'__esModule',{'value':!![]}),exports[a12_0x3d4d05(0xa4)]=void 0x0;const telegramBotService_1=require(a12_0x3d4d05(0x9a)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0xcc9bd=a12_0x3d4d05;this[_0xcc9bd(0xc7)]=async(_0x2b3e76,_0x5ab537,_0x453bd7)=>{const _0x43f603=_0xcc9bd;try{const _0x429858=telegramBotService_1[_0x43f603(0x97)]['getBotInfo'](),_0x4aa931=await database_1[_0x43f603(0x8d)]['telegramUser']['count'](),_0x13e30b=await database_1['default'][_0x43f603(0xc5)][_0x43f603(0x9c)]({'where':{'isVerified':!![]}}),_0x3131ff=await database_1[_0x43f603(0x8d)][_0x43f603(0xc5)][_0x43f603(0xad)]({'by':[_0x43f603(0xaf)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5ab537['json']({'success':!![],'result':{'bot':{'isActive':_0x429858[_0x43f603(0x99)],'username':_0x429858[_0x43f603(0x83)]},'statistics':{'totalUsers':_0x4aa931,'verifiedUsers':_0x13e30b,'unverifiedUsers':_0x4aa931-_0x13e30b,'connectedShops':_0x3131ff[_0x43f603(0x85)]}}});}catch(_0x508356){_0x453bd7(_0x508356);}},this[_0xcc9bd(0xbb)]=async(_0x34239a,_0x369897,_0x4bab86)=>{const _0x144275=_0xcc9bd;try{const {page:page=0x1,limit:limit=0x14,verified:_0x557034}=_0x34239a[_0x144275(0xa8)],_0x20bfd0=(Number(page)-0x1)*Number(limit),_0x2babc2={};_0x557034!==undefined&&(_0x2babc2[_0x144275(0x8a)]=_0x557034===_0x144275(0xbf));const [_0x139b25,_0xf01f9d]=await Promise['all']([database_1[_0x144275(0x8d)][_0x144275(0xc5)][_0x144275(0x93)]({'where':_0x2babc2,'skip':_0x20bfd0,'take':Number(limit),'orderBy':{'createdAt':_0x144275(0xc6)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x144275(0x8d)][_0x144275(0xc5)]['count']({'where':_0x2babc2})]);_0x369897[_0x144275(0xb1)]({'success':!![],'users':_0x139b25[_0x144275(0xb4)](_0x5979aa=>({'id':_0x5979aa['id'],'telegramId':_0x5979aa[_0x144275(0x9e)],'username':_0x5979aa[_0x144275(0x83)],'firstName':_0x5979aa[_0x144275(0xae)],'lastName':_0x5979aa['lastName'],'isVerified':_0x5979aa[_0x144275(0x8a)],'shop':_0x5979aa[_0x144275(0x94)],'createdAt':_0x5979aa[_0x144275(0xaa)],'updatedAt':_0x5979aa[_0x144275(0x7f)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xf01f9d,'totalPages':Math[_0x144275(0xb9)](_0xf01f9d/Number(limit))}});}catch(_0x4350a7){_0x4bab86(_0x4350a7);}},this[_0xcc9bd(0x96)]=async(_0x3d9fae,_0xd757dc,_0x2a2fd4)=>{const _0x5b6886=_0xcc9bd;try{const {message:_0x70f0b6,shopId:_0x4e1bd1}=_0x3d9fae[_0x5b6886(0x9d)];if(!_0x70f0b6)return _0xd757dc[_0x5b6886(0xb2)](0x190)['json']({'success':![],'message':'Message\x20is\x20required'});if(_0x4e1bd1)await telegramBotService_1[_0x5b6886(0x97)][_0x5b6886(0x82)](_0x4e1bd1,_0x70f0b6,{'parse_mode':_0x5b6886(0x98)});else{const _0x207552=await database_1[_0x5b6886(0x8d)][_0x5b6886(0xc5)][_0x5b6886(0x93)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5537ab=[...new Set(_0x207552[_0x5b6886(0xb4)](_0xd06fe8=>_0xd06fe8['shopId'])[_0x5b6886(0xc0)](Boolean))];for(const _0x270ff6 of _0x5537ab){_0x270ff6&&await telegramBotService_1['telegramBotService'][_0x5b6886(0x82)](_0x270ff6,_0x70f0b6,{'parse_mode':'Markdown'});}}_0xd757dc[_0x5b6886(0xb1)]({'success':!![],'message':_0x5b6886(0x8f)});}catch(_0x2c061c){_0x2a2fd4(_0x2c061c);}},this[_0xcc9bd(0x81)]=async(_0x4caa52,_0x2e59d1,_0x108a01)=>{const _0x509ff8=_0xcc9bd;try{const {telegramId:_0x3a5002}=_0x4caa52[_0x509ff8(0x9f)],_0x2e09f4=await database_1[_0x509ff8(0x8d)]['telegramUser'][_0x509ff8(0x86)]({'where':{'telegramId':_0x3a5002},'include':{'shop':!![]}});if(!_0x2e09f4)return _0x2e59d1[_0x509ff8(0xb2)](0x194)[_0x509ff8(0xb1)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x509ff8(0xc5)]['update']({'where':{'telegramId':_0x3a5002},'data':{'shopId':null,'isVerified':![]}}),_0x2e59d1[_0x509ff8(0xb1)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x445ad0){_0x108a01(_0x445ad0);}},this[_0xcc9bd(0xbc)]=async(_0xf1c231,_0x1cec87,_0x3564e2)=>{const _0x6f3463=_0xcc9bd;try{const {shopId:_0x33047a,type:type=_0x6f3463(0x95),testData:_0x3f934f}=_0xf1c231[_0x6f3463(0x9d)];if(!_0x33047a)return _0x1cec87[_0x6f3463(0xb2)](0x190)[_0x6f3463(0xb1)]({'success':![],'message':_0x6f3463(0xa5)});const _0x1bfdde=await database_1[_0x6f3463(0x8d)][_0x6f3463(0x94)][_0x6f3463(0x86)]({'where':{'id':_0x33047a},'select':{'id':!![],'name':!![]}});if(!_0x1bfdde)return _0x1cec87['status'](0x194)[_0x6f3463(0xb1)]({'success':![],'message':_0x6f3463(0xc1)});switch(type){case _0x6f3463(0x95):const _0x33ff8c={'id':_0x6f3463(0xab),'amount':_0x3f934f?.[_0x6f3463(0xba)]||0x64,'currency':_0x3f934f?.['currency']||_0x6f3463(0xb3),'productName':_0x3f934f?.[_0x6f3463(0xb6)]||_0x6f3463(0xc8),'gateway':_0x3f934f?.[_0x6f3463(0x9b)]||_0x6f3463(0x88),'createdAt':new Date(),..._0x3f934f};await telegramBotService_1[_0x6f3463(0x97)][_0x6f3463(0xc4)](_0x33047a,_0x33ff8c,_0x6f3463(0x87));break;case _0x6f3463(0x89):const _0x3f9f36={'id':'test_payout_123','amount':_0x3f934f?.[_0x6f3463(0xba)]||0x1f4,'method':_0x3f934f?.[_0x6f3463(0xa7)]||_0x6f3463(0xa0),'createdAt':new Date(),..._0x3f934f};await telegramBotService_1[_0x6f3463(0x97)]['sendPayoutNotification'](_0x33047a,_0x3f9f36,_0x6f3463(0xa2));break;case _0x6f3463(0xa9):await telegramBotService_1[_0x6f3463(0x97)]['sendCustomNotification'](_0x33047a,_0x3f934f?.[_0x6f3463(0x91)]||_0x6f3463(0x92),_0x3f934f?.[_0x6f3463(0xa1)]||{'message':_0x6f3463(0x8b)});break;default:return _0x1cec87['status'](0x190)[_0x6f3463(0xb1)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x1cec87[_0x6f3463(0xb1)]({'success':!![],'message':_0x6f3463(0x8e)+type+_0x6f3463(0xc2)});}catch(_0x38aa5b){_0x3564e2(_0x38aa5b);}};}}function a12_0x4d00(){const _0x5d8b69=['username','320clUxBZ','length','findUnique','paid','plisio','payout','isVerified','This\x20is\x20a\x20test\x20notification','291UULxFS','default','Test\x20','Broadcast\x20message\x20sent\x20successfully','1268CamYzu','title','Test\x20Notification','findMany','shop','payment','sendBroadcast','telegramBotService','Markdown','isActive','../services/telegramBotService','gateway','count','body','telegramId','params','bank_transfer','details','completed','1314ZTbiSQ','TelegramController','Shop\x20ID\x20is\x20required','12420IsQsYf','method','query','custom','createdAt','test_payment_123','91917cgFEjW','groupBy','firstName','shopId','115356aKQVdG','json','status','USD','map','14273uIPVWN','productName','461kNYkvQ','5117390jhadcw','ceil','amount','getTelegramUsers','sendTestNotification','120MEAMQR','108449MnlZqz','true','filter','Shop\x20not\x20found','\x20notification\x20sent\x20successfully','defineProperty','sendPaymentNotification','telegramUser','desc','getBotStatus','Test\x20Product','updatedAt','3419qFSOHJ','disconnectUser','sendShopNotification'];a12_0x4d00=function(){return _0x5d8b69;};return a12_0x4d00();}exports[a12_0x3d4d05(0xa4)]=TelegramController;