'use strict';const a12_0x47cdb6=a12_0x25b6;function a12_0x2eb8(){const _0x5e2401=['Broadcast\x20message\x20sent\x20successfully','updatedAt','test_payment_123','__importDefault','currency','gateway','This\x20is\x20a\x20test\x20notification','\x20notification\x20sent\x20successfully','paid','telegramUser','filter','test_payout_123','27eKVpbD','2167165KWBlUE','sendPaymentNotification','findMany','Test\x20','USD','__esModule','1242507bDRSpe','ceil','2bBQykt','amount','defineProperty','12DlzCpb','Shop\x20not\x20found','custom','31905864EIXalm','4640433klzrTJ','sendCustomNotification','sendShopNotification','body','shop','payout','isVerified','json','sendPayoutNotification','5126451zGXaeZ','../config/database','10ifmisV','isActive','desc','Shop\x20ID\x20is\x20required','details','groupBy','username','Test\x20Notification','telegramBotService','Telegram\x20user\x20not\x20found','telegramId','default','payment','2642408ADMked','findUnique','firstName','true','Test\x20Product','bank_transfer','params','4ikZDWE','query','Message\x20is\x20required','5158585zsFXZo','plisio','TelegramController','getBotStatus','Markdown','count','status','User\x20disconnected\x20successfully','../services/telegramBotService','map','shopId','title'];a12_0x2eb8=function(){return _0x5e2401;};return a12_0x2eb8();}function a12_0x25b6(_0x4b08fe,_0x47930c){const _0x2eb80b=a12_0x2eb8();return a12_0x25b6=function(_0x25b682,_0x47460f){_0x25b682=_0x25b682-0x108;let _0x803d62=_0x2eb80b[_0x25b682];return _0x803d62;},a12_0x25b6(_0x4b08fe,_0x47930c);}(function(_0x356407,_0x49417e){const _0x4465e2=a12_0x25b6,_0x2d9368=_0x356407();while(!![]){try{const _0x321481=-parseInt(_0x4465e2(0x132))/0x1+parseInt(_0x4465e2(0x134))/0x2*(-parseInt(_0x4465e2(0x13b))/0x3)+parseInt(_0x4465e2(0x110))/0x4*(parseInt(_0x4465e2(0x113))/0x5)+-parseInt(_0x4465e2(0x137))/0x6*(parseInt(_0x4465e2(0x12c))/0x7)+parseInt(_0x4465e2(0x109))/0x8*(parseInt(_0x4465e2(0x12b))/0x9)+-parseInt(_0x4465e2(0x146))/0xa*(parseInt(_0x4465e2(0x144))/0xb)+parseInt(_0x4465e2(0x13a))/0xc;if(_0x321481===_0x49417e)break;else _0x2d9368['push'](_0x2d9368['shift']());}catch(_0x7028d4){_0x2d9368['push'](_0x2d9368['shift']());}}}(a12_0x2eb8,0xc4fed));var __importDefault=this&&this[a12_0x47cdb6(0x122)]||function(_0x493e20){return _0x493e20&&_0x493e20['__esModule']?_0x493e20:{'default':_0x493e20};};Object[a12_0x47cdb6(0x136)](exports,a12_0x47cdb6(0x131),{'value':!![]}),exports[a12_0x47cdb6(0x115)]=void 0x0;const telegramBotService_1=require(a12_0x47cdb6(0x11b)),database_1=__importDefault(require(a12_0x47cdb6(0x145)));class TelegramController{constructor(){const _0x4877e0=a12_0x47cdb6;this[_0x4877e0(0x116)]=async(_0x3a432a,_0x52f3eb,_0x127e20)=>{const _0x51e970=_0x4877e0;try{const _0x14f509=telegramBotService_1[_0x51e970(0x14e)]['getBotInfo'](),_0x1b3e83=await database_1[_0x51e970(0x151)]['telegramUser']['count'](),_0x9f71e6=await database_1[_0x51e970(0x151)][_0x51e970(0x128)][_0x51e970(0x118)]({'where':{'isVerified':!![]}}),_0x3e5009=await database_1[_0x51e970(0x151)][_0x51e970(0x128)][_0x51e970(0x14b)]({'by':[_0x51e970(0x11d)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x52f3eb[_0x51e970(0x142)]({'success':!![],'result':{'bot':{'isActive':_0x14f509[_0x51e970(0x147)],'username':_0x14f509[_0x51e970(0x14c)]},'statistics':{'totalUsers':_0x1b3e83,'verifiedUsers':_0x9f71e6,'unverifiedUsers':_0x1b3e83-_0x9f71e6,'connectedShops':_0x3e5009['length']}}});}catch(_0x288efc){_0x127e20(_0x288efc);}},this['getTelegramUsers']=async(_0x356896,_0x5b796e,_0x241d39)=>{const _0x4f4447=_0x4877e0;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5f14a5}=_0x356896[_0x4f4447(0x111)],_0x8de226=(Number(page)-0x1)*Number(limit),_0x50a17c={};_0x5f14a5!==undefined&&(_0x50a17c[_0x4f4447(0x141)]=_0x5f14a5===_0x4f4447(0x10c));const [_0x35180c,_0x22099f]=await Promise['all']([database_1[_0x4f4447(0x151)][_0x4f4447(0x128)]['findMany']({'where':_0x50a17c,'skip':_0x8de226,'take':Number(limit),'orderBy':{'createdAt':_0x4f4447(0x148)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4f4447(0x151)]['telegramUser']['count']({'where':_0x50a17c})]);_0x5b796e['json']({'success':!![],'users':_0x35180c[_0x4f4447(0x11c)](_0x3156d1=>({'id':_0x3156d1['id'],'telegramId':_0x3156d1[_0x4f4447(0x150)],'username':_0x3156d1['username'],'firstName':_0x3156d1[_0x4f4447(0x10b)],'lastName':_0x3156d1['lastName'],'isVerified':_0x3156d1['isVerified'],'shop':_0x3156d1['shop'],'createdAt':_0x3156d1['createdAt'],'updatedAt':_0x3156d1[_0x4f4447(0x120)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x22099f,'totalPages':Math[_0x4f4447(0x133)](_0x22099f/Number(limit))}});}catch(_0x272f30){_0x241d39(_0x272f30);}},this['sendBroadcast']=async(_0x30ad91,_0x163135,_0x1cc881)=>{const _0x5b7cf2=_0x4877e0;try{const {message:_0x24b109,shopId:_0x1671ae}=_0x30ad91[_0x5b7cf2(0x13e)];if(!_0x24b109)return _0x163135[_0x5b7cf2(0x119)](0x190)[_0x5b7cf2(0x142)]({'success':![],'message':_0x5b7cf2(0x112)});if(_0x1671ae)await telegramBotService_1[_0x5b7cf2(0x14e)][_0x5b7cf2(0x13d)](_0x1671ae,_0x24b109,{'parse_mode':_0x5b7cf2(0x117)});else{const _0x11de16=await database_1[_0x5b7cf2(0x151)][_0x5b7cf2(0x128)][_0x5b7cf2(0x12e)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2588c6=[...new Set(_0x11de16['map'](_0x59b803=>_0x59b803[_0x5b7cf2(0x11d)])[_0x5b7cf2(0x129)](Boolean))];for(const _0x1e9d87 of _0x2588c6){_0x1e9d87&&await telegramBotService_1[_0x5b7cf2(0x14e)]['sendShopNotification'](_0x1e9d87,_0x24b109,{'parse_mode':_0x5b7cf2(0x117)});}}_0x163135[_0x5b7cf2(0x142)]({'success':!![],'message':_0x5b7cf2(0x11f)});}catch(_0x249689){_0x1cc881(_0x249689);}},this['disconnectUser']=async(_0x31148b,_0x3c64e4,_0x2ce20a)=>{const _0xed1b9f=_0x4877e0;try{const {telegramId:_0x195bc6}=_0x31148b[_0xed1b9f(0x10f)],_0x3be44a=await database_1[_0xed1b9f(0x151)][_0xed1b9f(0x128)][_0xed1b9f(0x10a)]({'where':{'telegramId':_0x195bc6},'include':{'shop':!![]}});if(!_0x3be44a)return _0x3c64e4[_0xed1b9f(0x119)](0x194)[_0xed1b9f(0x142)]({'success':![],'message':_0xed1b9f(0x14f)});await database_1[_0xed1b9f(0x151)][_0xed1b9f(0x128)]['update']({'where':{'telegramId':_0x195bc6},'data':{'shopId':null,'isVerified':![]}}),_0x3c64e4[_0xed1b9f(0x142)]({'success':!![],'message':_0xed1b9f(0x11a)});}catch(_0x3a2046){_0x2ce20a(_0x3a2046);}},this['sendTestNotification']=async(_0x3f11a2,_0x199fee,_0x5de2e3)=>{const _0x738c5=_0x4877e0;try{const {shopId:_0x39133d,type:type='payment',testData:_0x29f35d}=_0x3f11a2[_0x738c5(0x13e)];if(!_0x39133d)return _0x199fee[_0x738c5(0x119)](0x190)['json']({'success':![],'message':_0x738c5(0x149)});const _0x31aa8f=await database_1[_0x738c5(0x151)][_0x738c5(0x13f)]['findUnique']({'where':{'id':_0x39133d},'select':{'id':!![],'name':!![]}});if(!_0x31aa8f)return _0x199fee[_0x738c5(0x119)](0x194)[_0x738c5(0x142)]({'success':![],'message':_0x738c5(0x138)});switch(type){case _0x738c5(0x108):const _0x335019={'id':_0x738c5(0x121),'amount':_0x29f35d?.['amount']||0x64,'currency':_0x29f35d?.[_0x738c5(0x123)]||_0x738c5(0x130),'productName':_0x29f35d?.['productName']||_0x738c5(0x10d),'gateway':_0x29f35d?.[_0x738c5(0x124)]||_0x738c5(0x114),'createdAt':new Date(),..._0x29f35d};await telegramBotService_1['telegramBotService'][_0x738c5(0x12d)](_0x39133d,_0x335019,_0x738c5(0x127));break;case _0x738c5(0x140):const _0x3a29d4={'id':_0x738c5(0x12a),'amount':_0x29f35d?.[_0x738c5(0x135)]||0x1f4,'method':_0x29f35d?.['method']||_0x738c5(0x10e),'createdAt':new Date(),..._0x29f35d};await telegramBotService_1[_0x738c5(0x14e)][_0x738c5(0x143)](_0x39133d,_0x3a29d4,'completed');break;case _0x738c5(0x139):await telegramBotService_1[_0x738c5(0x14e)][_0x738c5(0x13c)](_0x39133d,_0x29f35d?.[_0x738c5(0x11e)]||_0x738c5(0x14d),_0x29f35d?.[_0x738c5(0x14a)]||{'message':_0x738c5(0x125)});break;default:return _0x199fee[_0x738c5(0x119)](0x190)[_0x738c5(0x142)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x199fee[_0x738c5(0x142)]({'success':!![],'message':_0x738c5(0x12f)+type+_0x738c5(0x126)});}catch(_0xd94124){_0x5de2e3(_0xd94124);}};}}exports['TelegramController']=TelegramController;