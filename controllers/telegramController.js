'use strict';const a12_0x30a237=a12_0x33cb;(function(_0x2bc6e0,_0x3aa390){const _0x3848d5=a12_0x33cb,_0x1365dc=_0x2bc6e0();while(!![]){try{const _0x972570=parseInt(_0x3848d5(0xa9))/0x1*(-parseInt(_0x3848d5(0xa5))/0x2)+parseInt(_0x3848d5(0xc4))/0x3+-parseInt(_0x3848d5(0xc5))/0x4*(parseInt(_0x3848d5(0x94))/0x5)+-parseInt(_0x3848d5(0xca))/0x6*(-parseInt(_0x3848d5(0xb0))/0x7)+-parseInt(_0x3848d5(0xc7))/0x8+parseInt(_0x3848d5(0xbf))/0x9+parseInt(_0x3848d5(0x9d))/0xa*(parseInt(_0x3848d5(0xa2))/0xb);if(_0x972570===_0x3aa390)break;else _0x1365dc['push'](_0x1365dc['shift']());}catch(_0x33f2c1){_0x1365dc['push'](_0x1365dc['shift']());}}}(a12_0x5a5d,0x67fdc));var __importDefault=this&&this[a12_0x30a237(0x8d)]||function(_0x567bd7){const _0x3edbd2=a12_0x30a237;return _0x567bd7&&_0x567bd7[_0x3edbd2(0x90)]?_0x567bd7:{'default':_0x567bd7};};Object[a12_0x30a237(0xa3)](exports,a12_0x30a237(0x90),{'value':!![]}),exports[a12_0x30a237(0xc1)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x30a237(0x89)));function a12_0x33cb(_0x435db5,_0x3b95f4){const _0x5a5de0=a12_0x5a5d();return a12_0x33cb=function(_0x33cbfa,_0x135852){_0x33cbfa=_0x33cbfa-0x86;let _0x54feaa=_0x5a5de0[_0x33cbfa];return _0x54feaa;},a12_0x33cb(_0x435db5,_0x3b95f4);}class TelegramController{constructor(){const _0x5cc2a6=a12_0x30a237;this[_0x5cc2a6(0xc9)]=async(_0x3974e1,_0x2f5c5d,_0x3c4e80)=>{const _0x47373e=_0x5cc2a6;try{const _0x5c2305=telegramBotService_1[_0x47373e(0xa0)][_0x47373e(0xac)](),_0x33f6b9=await database_1['default'][_0x47373e(0xc2)][_0x47373e(0xc8)](),_0x1a92ab=await database_1[_0x47373e(0xb8)][_0x47373e(0xc2)]['count']({'where':{'isVerified':!![]}}),_0x25c278=await database_1[_0x47373e(0xb8)][_0x47373e(0xc2)][_0x47373e(0xa7)]({'by':[_0x47373e(0x96)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2f5c5d['json']({'success':!![],'result':{'bot':{'isActive':_0x5c2305[_0x47373e(0x9b)],'username':_0x5c2305[_0x47373e(0xb7)]},'statistics':{'totalUsers':_0x33f6b9,'verifiedUsers':_0x1a92ab,'unverifiedUsers':_0x33f6b9-_0x1a92ab,'connectedShops':_0x25c278[_0x47373e(0xa1)]}}});}catch(_0x5130ef){_0x3c4e80(_0x5130ef);}},this[_0x5cc2a6(0xad)]=async(_0x4ae09e,_0x1975e4,_0x404edf)=>{const _0x5a4faf=_0x5cc2a6;try{const {page:page=0x1,limit:limit=0x14,verified:_0xcd4e60}=_0x4ae09e[_0x5a4faf(0xa6)],_0x24c305=(Number(page)-0x1)*Number(limit),_0x25243d={};_0xcd4e60!==undefined&&(_0x25243d[_0x5a4faf(0x95)]=_0xcd4e60===_0x5a4faf(0xae));const [_0x54f954,_0x2227fe]=await Promise['all']([database_1['default']['telegramUser'][_0x5a4faf(0xbc)]({'where':_0x25243d,'skip':_0x24c305,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5a4faf(0xb8)][_0x5a4faf(0xc2)]['count']({'where':_0x25243d})]);_0x1975e4[_0x5a4faf(0xb2)]({'success':!![],'users':_0x54f954[_0x5a4faf(0x8b)](_0x2e6b27=>({'id':_0x2e6b27['id'],'telegramId':_0x2e6b27[_0x5a4faf(0x91)],'username':_0x2e6b27[_0x5a4faf(0xb7)],'firstName':_0x2e6b27[_0x5a4faf(0x98)],'lastName':_0x2e6b27['lastName'],'isVerified':_0x2e6b27[_0x5a4faf(0x95)],'shop':_0x2e6b27[_0x5a4faf(0x8a)],'createdAt':_0x2e6b27[_0x5a4faf(0xcd)],'updatedAt':_0x2e6b27['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2227fe,'totalPages':Math[_0x5a4faf(0xba)](_0x2227fe/Number(limit))}});}catch(_0x2e7275){_0x404edf(_0x2e7275);}},this['sendBroadcast']=async(_0x16fc60,_0x4ed85a,_0x5bb017)=>{const _0x1e4c72=_0x5cc2a6;try{const {message:_0x1594c6,shopId:_0x4d7039}=_0x16fc60[_0x1e4c72(0xcc)];if(!_0x1594c6)return _0x4ed85a[_0x1e4c72(0x9c)](0x190)[_0x1e4c72(0xb2)]({'success':![],'message':'Message\x20is\x20required'});if(_0x4d7039)await telegramBotService_1[_0x1e4c72(0xa0)][_0x1e4c72(0x97)](_0x4d7039,_0x1594c6,{'parse_mode':_0x1e4c72(0x88)});else{const _0x2f3c50=await database_1[_0x1e4c72(0xb8)][_0x1e4c72(0xc2)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x166661=[...new Set(_0x2f3c50[_0x1e4c72(0x8b)](_0x10fa95=>_0x10fa95[_0x1e4c72(0x96)])[_0x1e4c72(0xb1)](Boolean))];for(const _0x4d13db of _0x166661){_0x4d13db&&await telegramBotService_1[_0x1e4c72(0xa0)][_0x1e4c72(0x97)](_0x4d13db,_0x1594c6,{'parse_mode':_0x1e4c72(0x88)});}}_0x4ed85a[_0x1e4c72(0xb2)]({'success':!![],'message':_0x1e4c72(0xc0)});}catch(_0x46db65){_0x5bb017(_0x46db65);}},this['disconnectUser']=async(_0x1b4ba9,_0x5b79e4,_0x5326e7)=>{const _0x214ff5=_0x5cc2a6;try{const {telegramId:_0xcc3f80}=_0x1b4ba9[_0x214ff5(0x8c)],_0x5ece8b=await database_1[_0x214ff5(0xb8)][_0x214ff5(0xc2)][_0x214ff5(0xb9)]({'where':{'telegramId':_0xcc3f80},'include':{'shop':!![]}});if(!_0x5ece8b)return _0x5b79e4['status'](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x214ff5(0xb8)]['telegramUser']['update']({'where':{'telegramId':_0xcc3f80},'data':{'shopId':null,'isVerified':![]}}),_0x5b79e4[_0x214ff5(0xb2)]({'success':!![],'message':_0x214ff5(0xaf)});}catch(_0x389040){_0x5326e7(_0x389040);}},this[_0x5cc2a6(0x9e)]=async(_0x4aac9c,_0x296914,_0x5ad31b)=>{const _0x3c3985=_0x5cc2a6;try{const {shopId:_0x51fdf0,type:type=_0x3c3985(0xa4),testData:_0x215048}=_0x4aac9c[_0x3c3985(0xcc)];if(!_0x51fdf0)return _0x296914[_0x3c3985(0x9c)](0x190)['json']({'success':![],'message':_0x3c3985(0x92)});const _0x39e007=await database_1['default'][_0x3c3985(0x8a)][_0x3c3985(0xb9)]({'where':{'id':_0x51fdf0},'select':{'id':!![],'name':!![]}});if(!_0x39e007)return _0x296914['status'](0x194)[_0x3c3985(0xb2)]({'success':![],'message':_0x3c3985(0xa8)});switch(type){case'payment':const _0x310a8c={'id':_0x3c3985(0xab),'amount':_0x215048?.[_0x3c3985(0x8f)]||0x64,'currency':_0x215048?.[_0x3c3985(0xc3)]||_0x3c3985(0xbb),'productName':_0x215048?.[_0x3c3985(0xb6)]||'Test\x20Product','gateway':_0x215048?.[_0x3c3985(0x93)]||_0x3c3985(0xb4),'createdAt':new Date(),..._0x215048};await telegramBotService_1[_0x3c3985(0xa0)][_0x3c3985(0xbd)](_0x51fdf0,_0x310a8c,_0x3c3985(0xbe));break;case _0x3c3985(0x86):const _0xa846c7={'id':_0x3c3985(0x99),'amount':_0x215048?.[_0x3c3985(0x8f)]||0x1f4,'method':_0x215048?.['method']||'bank_transfer','createdAt':new Date(),..._0x215048};await telegramBotService_1['telegramBotService'][_0x3c3985(0x9a)](_0x51fdf0,_0xa846c7,_0x3c3985(0xcb));break;case _0x3c3985(0x8e):await telegramBotService_1['telegramBotService'][_0x3c3985(0xb3)](_0x51fdf0,_0x215048?.[_0x3c3985(0xc6)]||'Test\x20Notification',_0x215048?.['details']||{'message':_0x3c3985(0x87)});break;default:return _0x296914[_0x3c3985(0x9c)](0x190)[_0x3c3985(0xb2)]({'success':![],'message':_0x3c3985(0xaa)});}_0x296914[_0x3c3985(0xb2)]({'success':!![],'message':_0x3c3985(0xb5)+type+_0x3c3985(0x9f)});}catch(_0x415b23){_0x5ad31b(_0x415b23);}};}}exports[a12_0x30a237(0xc1)]=TelegramController;function a12_0x5a5d(){const _0x529b3a=['User\x20disconnected\x20successfully','21Ctnirq','filter','json','sendCustomNotification','plisio','Test\x20','productName','username','default','findUnique','ceil','USD','findMany','sendPaymentNotification','paid','4410045RPOxXQ','Broadcast\x20message\x20sent\x20successfully','TelegramController','telegramUser','currency','1776360IPtaBL','124qmQmum','title','3729288vnTDCX','count','getBotStatus','1615026eTDBRY','completed','body','createdAt','payout','This\x20is\x20a\x20test\x20notification','Markdown','../config/database','shop','map','params','__importDefault','custom','amount','__esModule','telegramId','Shop\x20ID\x20is\x20required','gateway','75305Rpkubm','isVerified','shopId','sendShopNotification','firstName','test_payout_123','sendPayoutNotification','isActive','status','980VwRhgV','sendTestNotification','\x20notification\x20sent\x20successfully','telegramBotService','length','18337CdqKEz','defineProperty','payment','2VzbQzv','query','groupBy','Shop\x20not\x20found','694004uLHMGF','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','test_payment_123','getBotInfo','getTelegramUsers','true'];a12_0x5a5d=function(){return _0x529b3a;};return a12_0x5a5d();}