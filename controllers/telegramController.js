'use strict';const a12_0xe72bce=a12_0x5cbb;(function(_0x46eb6a,_0x5085b0){const _0x202f1d=a12_0x5cbb,_0x464363=_0x46eb6a();while(!![]){try{const _0xeacdd0=-parseInt(_0x202f1d(0x233))/0x1*(-parseInt(_0x202f1d(0x206))/0x2)+parseInt(_0x202f1d(0x21b))/0x3*(parseInt(_0x202f1d(0x22b))/0x4)+-parseInt(_0x202f1d(0x22e))/0x5*(parseInt(_0x202f1d(0x213))/0x6)+-parseInt(_0x202f1d(0x227))/0x7*(-parseInt(_0x202f1d(0x204))/0x8)+-parseInt(_0x202f1d(0x221))/0x9+parseInt(_0x202f1d(0x1f2))/0xa+-parseInt(_0x202f1d(0x217))/0xb;if(_0xeacdd0===_0x5085b0)break;else _0x464363['push'](_0x464363['shift']());}catch(_0x5df2c1){_0x464363['push'](_0x464363['shift']());}}}(a12_0x4ff4,0xc3921));var __importDefault=this&&this[a12_0xe72bce(0x1f4)]||function(_0xe45b77){const _0x4be673=a12_0xe72bce;return _0xe45b77&&_0xe45b77[_0x4be673(0x21d)]?_0xe45b77:{'default':_0xe45b77};};function a12_0x4ff4(){const _0x3fcef1=['plisio','count','payment','5fkffqC','method','Shop\x20ID\x20is\x20required','paid','Message\x20is\x20required','Shop\x20not\x20found','filter','This\x20is\x20a\x20test\x20notification','5654270bwMyeT','defineProperty','__importDefault','telegramBotService','firstName','sendShopNotification','length','ceil','sendPaymentNotification','Telegram\x20user\x20not\x20found','telegramUser','gateway','findUnique','getTelegramUsers','payout','sendCustomNotification','currency','groupBy','3176912MsFvuj','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','455098wbphRK','sendPayoutNotification','Broadcast\x20message\x20sent\x20successfully','title','params','Test\x20Product','body','USD','amount','map','shop','../config/database','findMany','2220qeIthw','update','TelegramController','Markdown','8069666Yilghq','status','telegramId','username','39009licceF','default','__esModule','Test\x20Notification','query','lastName','10842552JqzdYz','User\x20disconnected\x20successfully','productName','isVerified','desc','updatedAt','21xASOtU','shopId','\x20notification\x20sent\x20successfully','isActive','356wYGFDF','json','details','17735TLHBgh','test_payment_123'];a12_0x4ff4=function(){return _0x3fcef1;};return a12_0x4ff4();}function a12_0x5cbb(_0x369e12,_0x28dc00){const _0x4ff424=a12_0x4ff4();return a12_0x5cbb=function(_0x5cbbba,_0x441006){_0x5cbbba=_0x5cbbba-0x1f2;let _0x4d7ae7=_0x4ff424[_0x5cbbba];return _0x4d7ae7;},a12_0x5cbb(_0x369e12,_0x28dc00);}Object[a12_0xe72bce(0x1f3)](exports,'__esModule',{'value':!![]}),exports[a12_0xe72bce(0x215)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0xe72bce(0x211)));class TelegramController{constructor(){const _0x35c70a=a12_0xe72bce;this['getBotStatus']=async(_0xdde0fd,_0x2a3e39,_0x4ba51f)=>{const _0x4e59ca=a12_0x5cbb;try{const _0x2916d0=telegramBotService_1['telegramBotService']['getBotInfo'](),_0x76052e=await database_1[_0x4e59ca(0x21c)]['telegramUser'][_0x4e59ca(0x231)](),_0xa73f51=await database_1[_0x4e59ca(0x21c)][_0x4e59ca(0x1fc)][_0x4e59ca(0x231)]({'where':{'isVerified':!![]}}),_0x4ca565=await database_1[_0x4e59ca(0x21c)][_0x4e59ca(0x1fc)][_0x4e59ca(0x203)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2a3e39['json']({'success':!![],'result':{'bot':{'isActive':_0x2916d0[_0x4e59ca(0x22a)],'username':_0x2916d0[_0x4e59ca(0x21a)]},'statistics':{'totalUsers':_0x76052e,'verifiedUsers':_0xa73f51,'unverifiedUsers':_0x76052e-_0xa73f51,'connectedShops':_0x4ca565[_0x4e59ca(0x1f8)]}}});}catch(_0x3dbd7f){_0x4ba51f(_0x3dbd7f);}},this[_0x35c70a(0x1ff)]=async(_0x36ea5c,_0x3286ed,_0x1119fd)=>{const _0x1cfd00=_0x35c70a;try{const {page:page=0x1,limit:limit=0x14,verified:_0x254be0}=_0x36ea5c[_0x1cfd00(0x21f)],_0x341fa2=(Number(page)-0x1)*Number(limit),_0x3cacb0={};_0x254be0!==undefined&&(_0x3cacb0[_0x1cfd00(0x224)]=_0x254be0==='true');const [_0x1dd7ed,_0xb59d5c]=await Promise['all']([database_1[_0x1cfd00(0x21c)][_0x1cfd00(0x1fc)][_0x1cfd00(0x212)]({'where':_0x3cacb0,'skip':_0x341fa2,'take':Number(limit),'orderBy':{'createdAt':_0x1cfd00(0x225)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1cfd00(0x21c)][_0x1cfd00(0x1fc)][_0x1cfd00(0x231)]({'where':_0x3cacb0})]);_0x3286ed[_0x1cfd00(0x22c)]({'success':!![],'users':_0x1dd7ed[_0x1cfd00(0x20f)](_0x53551a=>({'id':_0x53551a['id'],'telegramId':_0x53551a[_0x1cfd00(0x219)],'username':_0x53551a[_0x1cfd00(0x21a)],'firstName':_0x53551a[_0x1cfd00(0x1f6)],'lastName':_0x53551a[_0x1cfd00(0x220)],'isVerified':_0x53551a[_0x1cfd00(0x224)],'shop':_0x53551a[_0x1cfd00(0x210)],'createdAt':_0x53551a['createdAt'],'updatedAt':_0x53551a[_0x1cfd00(0x226)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xb59d5c,'totalPages':Math[_0x1cfd00(0x1f9)](_0xb59d5c/Number(limit))}});}catch(_0x1b26ca){_0x1119fd(_0x1b26ca);}},this['sendBroadcast']=async(_0x53b8ce,_0x364b90,_0x54a92e)=>{const _0x275d54=_0x35c70a;try{const {message:_0x317b81,shopId:_0x14afb6}=_0x53b8ce[_0x275d54(0x20c)];if(!_0x317b81)return _0x364b90[_0x275d54(0x218)](0x190)[_0x275d54(0x22c)]({'success':![],'message':_0x275d54(0x237)});if(_0x14afb6)await telegramBotService_1[_0x275d54(0x1f5)][_0x275d54(0x1f7)](_0x14afb6,_0x317b81,{'parse_mode':_0x275d54(0x216)});else{const _0x4b3a5a=await database_1[_0x275d54(0x21c)][_0x275d54(0x1fc)][_0x275d54(0x212)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5b6e91=[...new Set(_0x4b3a5a[_0x275d54(0x20f)](_0x271816=>_0x271816[_0x275d54(0x228)])[_0x275d54(0x239)](Boolean))];for(const _0x465d9 of _0x5b6e91){_0x465d9&&await telegramBotService_1[_0x275d54(0x1f5)][_0x275d54(0x1f7)](_0x465d9,_0x317b81,{'parse_mode':_0x275d54(0x216)});}}_0x364b90['json']({'success':!![],'message':_0x275d54(0x208)});}catch(_0x905df4){_0x54a92e(_0x905df4);}},this['disconnectUser']=async(_0x1abdd0,_0x427657,_0x492f62)=>{const _0x4e1bc4=_0x35c70a;try{const {telegramId:_0x437f37}=_0x1abdd0[_0x4e1bc4(0x20a)],_0x327dac=await database_1[_0x4e1bc4(0x21c)][_0x4e1bc4(0x1fc)][_0x4e1bc4(0x1fe)]({'where':{'telegramId':_0x437f37},'include':{'shop':!![]}});if(!_0x327dac)return _0x427657[_0x4e1bc4(0x218)](0x194)[_0x4e1bc4(0x22c)]({'success':![],'message':_0x4e1bc4(0x1fb)});await database_1[_0x4e1bc4(0x21c)][_0x4e1bc4(0x1fc)][_0x4e1bc4(0x214)]({'where':{'telegramId':_0x437f37},'data':{'shopId':null,'isVerified':![]}}),_0x427657['json']({'success':!![],'message':_0x4e1bc4(0x222)});}catch(_0xe039c2){_0x492f62(_0xe039c2);}},this['sendTestNotification']=async(_0x14b387,_0x53c873,_0x191219)=>{const _0x29470e=_0x35c70a;try{const {shopId:_0x21b8f5,type:type=_0x29470e(0x232),testData:_0x1dd065}=_0x14b387[_0x29470e(0x20c)];if(!_0x21b8f5)return _0x53c873['status'](0x190)['json']({'success':![],'message':_0x29470e(0x235)});const _0x15383e=await database_1[_0x29470e(0x21c)][_0x29470e(0x210)]['findUnique']({'where':{'id':_0x21b8f5},'select':{'id':!![],'name':!![]}});if(!_0x15383e)return _0x53c873[_0x29470e(0x218)](0x194)[_0x29470e(0x22c)]({'success':![],'message':_0x29470e(0x238)});switch(type){case _0x29470e(0x232):const _0x5cef1b={'id':_0x29470e(0x22f),'amount':_0x1dd065?.['amount']||0x64,'currency':_0x1dd065?.[_0x29470e(0x202)]||_0x29470e(0x20d),'productName':_0x1dd065?.[_0x29470e(0x223)]||_0x29470e(0x20b),'gateway':_0x1dd065?.[_0x29470e(0x1fd)]||_0x29470e(0x230),'createdAt':new Date(),..._0x1dd065};await telegramBotService_1[_0x29470e(0x1f5)][_0x29470e(0x1fa)](_0x21b8f5,_0x5cef1b,_0x29470e(0x236));break;case _0x29470e(0x200):const _0xc45577={'id':'test_payout_123','amount':_0x1dd065?.[_0x29470e(0x20e)]||0x1f4,'method':_0x1dd065?.[_0x29470e(0x234)]||'bank_transfer','createdAt':new Date(),..._0x1dd065};await telegramBotService_1[_0x29470e(0x1f5)][_0x29470e(0x207)](_0x21b8f5,_0xc45577,'completed');break;case'custom':await telegramBotService_1[_0x29470e(0x1f5)][_0x29470e(0x201)](_0x21b8f5,_0x1dd065?.[_0x29470e(0x209)]||_0x29470e(0x21e),_0x1dd065?.[_0x29470e(0x22d)]||{'message':_0x29470e(0x23a)});break;default:return _0x53c873[_0x29470e(0x218)](0x190)[_0x29470e(0x22c)]({'success':![],'message':_0x29470e(0x205)});}_0x53c873[_0x29470e(0x22c)]({'success':!![],'message':'Test\x20'+type+_0x29470e(0x229)});}catch(_0xb332ff){_0x191219(_0xb332ff);}};}}exports[a12_0xe72bce(0x215)]=TelegramController;