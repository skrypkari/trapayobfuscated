'use strict';const a14_0x275587=a14_0x22d3;function a14_0x22d3(_0x19863a,_0xed04af){const _0x37f86f=a14_0x37f8();return a14_0x22d3=function(_0x22d38d,_0x5cba2b){_0x22d38d=_0x22d38d-0xf6;let _0x4a5984=_0x37f86f[_0x22d38d];return _0x4a5984;},a14_0x22d3(_0x19863a,_0xed04af);}(function(_0x29f613,_0x53c1f4){const _0x185e0b=a14_0x22d3,_0x46d06b=_0x29f613();while(!![]){try{const _0x13982e=parseInt(_0x185e0b(0x140))/0x1*(-parseInt(_0x185e0b(0xf9))/0x2)+parseInt(_0x185e0b(0x113))/0x3*(parseInt(_0x185e0b(0x100))/0x4)+parseInt(_0x185e0b(0x120))/0x5+-parseInt(_0x185e0b(0xf7))/0x6+parseInt(_0x185e0b(0x130))/0x7*(parseInt(_0x185e0b(0x139))/0x8)+-parseInt(_0x185e0b(0x10f))/0x9*(-parseInt(_0x185e0b(0x122))/0xa)+-parseInt(_0x185e0b(0x109))/0xb;if(_0x13982e===_0x53c1f4)break;else _0x46d06b['push'](_0x46d06b['shift']());}catch(_0x352d11){_0x46d06b['push'](_0x46d06b['shift']());}}}(a14_0x37f8,0xf2214));function a14_0x37f8(){const _0x315d90=['sendCustomNotification','../config/database','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','TelegramController','telegramUser','18zLHdGb','payout','status','Markdown','3bZFKlI','bank_transfer','test_payment_123','filter','username','plisio','test_payout_123','true','all','params','method','groupBy','disconnectUser','5102455wWDxJv','createdAt','3267860NSKceh','lastName','getBotInfo','details','USD','title','Telegram\x20user\x20not\x20found','\x20notification\x20sent\x20successfully','telegramBotService','findMany','body','updatedAt','ceil','default','2437533VYbHbX','json','desc','payment','__importDefault','__esModule','getBotStatus','productName','map','32RLaBEa','findUnique','This\x20is\x20a\x20test\x20notification','isVerified','Shop\x20not\x20found','sendShopNotification','Test\x20Product','8asmitP','User\x20disconnected\x20successfully','sendPaymentNotification','length','2150538wQczZT','Test\x20','400196sTqDrU','count','completed','defineProperty','currency','Broadcast\x20message\x20sent\x20successfully','getTelegramUsers','6300052OykxZW','amount','custom','telegramId','shopId','sendBroadcast','firstName','query','update','18600791awtNgW'];a14_0x37f8=function(){return _0x315d90;};return a14_0x37f8();}var __importDefault=this&&this[a14_0x275587(0x134)]||function(_0x101a7d){const _0x20f36c=a14_0x275587;return _0x101a7d&&_0x101a7d[_0x20f36c(0x135)]?_0x101a7d:{'default':_0x101a7d};};Object[a14_0x275587(0xfc)](exports,a14_0x275587(0x135),{'value':!![]}),exports[a14_0x275587(0x10d)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a14_0x275587(0x10b)));class TelegramController{constructor(){const _0x331cc1=a14_0x275587;this[_0x331cc1(0x136)]=async(_0x7c86ea,_0x35218e,_0x3e7752)=>{const _0x4d756f=_0x331cc1;try{const _0x281f6b=telegramBotService_1[_0x4d756f(0x12a)][_0x4d756f(0x124)](),_0x595c42=await database_1[_0x4d756f(0x12f)]['telegramUser'][_0x4d756f(0xfa)](),_0x9cf8c4=await database_1['default'][_0x4d756f(0x10e)][_0x4d756f(0xfa)]({'where':{'isVerified':!![]}}),_0xf41fcf=await database_1[_0x4d756f(0x12f)][_0x4d756f(0x10e)][_0x4d756f(0x11e)]({'by':[_0x4d756f(0x104)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x35218e[_0x4d756f(0x131)]({'success':!![],'result':{'bot':{'isActive':_0x281f6b['isActive'],'username':_0x281f6b[_0x4d756f(0x117)]},'statistics':{'totalUsers':_0x595c42,'verifiedUsers':_0x9cf8c4,'unverifiedUsers':_0x595c42-_0x9cf8c4,'connectedShops':_0xf41fcf[_0x4d756f(0xf6)]}}});}catch(_0x53d13a){_0x3e7752(_0x53d13a);}},this[_0x331cc1(0xff)]=async(_0x3daed3,_0x201760,_0x5a3e0b)=>{const _0x2d2bd7=_0x331cc1;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1fd3d6}=_0x3daed3[_0x2d2bd7(0x107)],_0x11cddb=(Number(page)-0x1)*Number(limit),_0x1d7063={};_0x1fd3d6!==undefined&&(_0x1d7063['isVerified']=_0x1fd3d6===_0x2d2bd7(0x11a));const [_0xe4977a,_0x2d3c1c]=await Promise[_0x2d2bd7(0x11b)]([database_1['default']['telegramUser'][_0x2d2bd7(0x12b)]({'where':_0x1d7063,'skip':_0x11cddb,'take':Number(limit),'orderBy':{'createdAt':_0x2d2bd7(0x132)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2d2bd7(0x12f)][_0x2d2bd7(0x10e)]['count']({'where':_0x1d7063})]);_0x201760['json']({'success':!![],'users':_0xe4977a[_0x2d2bd7(0x138)](_0x5e8ef3=>({'id':_0x5e8ef3['id'],'telegramId':_0x5e8ef3[_0x2d2bd7(0x103)],'username':_0x5e8ef3[_0x2d2bd7(0x117)],'firstName':_0x5e8ef3[_0x2d2bd7(0x106)],'lastName':_0x5e8ef3[_0x2d2bd7(0x123)],'isVerified':_0x5e8ef3[_0x2d2bd7(0x13c)],'shop':_0x5e8ef3['shop'],'createdAt':_0x5e8ef3[_0x2d2bd7(0x121)],'updatedAt':_0x5e8ef3[_0x2d2bd7(0x12d)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2d3c1c,'totalPages':Math[_0x2d2bd7(0x12e)](_0x2d3c1c/Number(limit))}});}catch(_0x426903){_0x5a3e0b(_0x426903);}},this[_0x331cc1(0x105)]=async(_0x528ff8,_0x18ec7a,_0xd26931)=>{const _0x2acea5=_0x331cc1;try{const {message:_0x253367,shopId:_0xf14ea3}=_0x528ff8[_0x2acea5(0x12c)];if(!_0x253367)return _0x18ec7a[_0x2acea5(0x111)](0x190)['json']({'success':![],'message':'Message\x20is\x20required'});if(_0xf14ea3)await telegramBotService_1[_0x2acea5(0x12a)][_0x2acea5(0x13e)](_0xf14ea3,_0x253367,{'parse_mode':_0x2acea5(0x112)});else{const _0x543ae0=await database_1[_0x2acea5(0x12f)][_0x2acea5(0x10e)][_0x2acea5(0x12b)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x37ad25=[...new Set(_0x543ae0[_0x2acea5(0x138)](_0x36dff5=>_0x36dff5[_0x2acea5(0x104)])[_0x2acea5(0x116)](Boolean))];for(const _0x5fdf7e of _0x37ad25){_0x5fdf7e&&await telegramBotService_1[_0x2acea5(0x12a)][_0x2acea5(0x13e)](_0x5fdf7e,_0x253367,{'parse_mode':_0x2acea5(0x112)});}}_0x18ec7a[_0x2acea5(0x131)]({'success':!![],'message':_0x2acea5(0xfe)});}catch(_0x103b5d){_0xd26931(_0x103b5d);}},this[_0x331cc1(0x11f)]=async(_0x1c97ea,_0xf6bd96,_0x5acb1d)=>{const _0x1fff9f=_0x331cc1;try{const {telegramId:_0x53f861}=_0x1c97ea[_0x1fff9f(0x11c)],_0x2cb060=await database_1[_0x1fff9f(0x12f)][_0x1fff9f(0x10e)][_0x1fff9f(0x13a)]({'where':{'telegramId':_0x53f861},'include':{'shop':!![]}});if(!_0x2cb060)return _0xf6bd96['status'](0x194)[_0x1fff9f(0x131)]({'success':![],'message':_0x1fff9f(0x128)});await database_1[_0x1fff9f(0x12f)][_0x1fff9f(0x10e)][_0x1fff9f(0x108)]({'where':{'telegramId':_0x53f861},'data':{'shopId':null,'isVerified':![]}}),_0xf6bd96[_0x1fff9f(0x131)]({'success':!![],'message':_0x1fff9f(0x141)});}catch(_0x4adcc3){_0x5acb1d(_0x4adcc3);}},this['sendTestNotification']=async(_0x34c71e,_0x5de90b,_0x258041)=>{const _0x2dea75=_0x331cc1;try{const {shopId:_0x2f2489,type:type=_0x2dea75(0x133),testData:_0x331f9f}=_0x34c71e[_0x2dea75(0x12c)];if(!_0x2f2489)return _0x5de90b[_0x2dea75(0x111)](0x190)[_0x2dea75(0x131)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x1671ad=await database_1[_0x2dea75(0x12f)]['shop']['findUnique']({'where':{'id':_0x2f2489},'select':{'id':!![],'name':!![]}});if(!_0x1671ad)return _0x5de90b[_0x2dea75(0x111)](0x194)['json']({'success':![],'message':_0x2dea75(0x13d)});switch(type){case _0x2dea75(0x133):const _0x1b3e08={'id':_0x2dea75(0x115),'amount':_0x331f9f?.[_0x2dea75(0x101)]||0x64,'currency':_0x331f9f?.[_0x2dea75(0xfd)]||_0x2dea75(0x126),'productName':_0x331f9f?.[_0x2dea75(0x137)]||_0x2dea75(0x13f),'gateway':_0x331f9f?.['gateway']||_0x2dea75(0x118),'createdAt':new Date(),..._0x331f9f};await telegramBotService_1[_0x2dea75(0x12a)][_0x2dea75(0x142)](_0x2f2489,_0x1b3e08,'paid');break;case _0x2dea75(0x110):const _0x465710={'id':_0x2dea75(0x119),'amount':_0x331f9f?.['amount']||0x1f4,'method':_0x331f9f?.[_0x2dea75(0x11d)]||_0x2dea75(0x114),'createdAt':new Date(),..._0x331f9f};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x2f2489,_0x465710,_0x2dea75(0xfb));break;case _0x2dea75(0x102):await telegramBotService_1[_0x2dea75(0x12a)][_0x2dea75(0x10a)](_0x2f2489,_0x331f9f?.[_0x2dea75(0x127)]||'Test\x20Notification',_0x331f9f?.[_0x2dea75(0x125)]||{'message':_0x2dea75(0x13b)});break;default:return _0x5de90b['status'](0x190)[_0x2dea75(0x131)]({'success':![],'message':_0x2dea75(0x10c)});}_0x5de90b[_0x2dea75(0x131)]({'success':!![],'message':_0x2dea75(0xf8)+type+_0x2dea75(0x129)});}catch(_0x39891d){_0x258041(_0x39891d);}};}}exports[a14_0x275587(0x10d)]=TelegramController;