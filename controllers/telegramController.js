'use strict';const a12_0x2a54a4=a12_0x3d5f;function a12_0x3998(){const _0x5c3f38=['../services/telegramBotService','Markdown','payout','3332964CZCDvQ','Test\x20Notification','update','desc','test_payout_123','length','defineProperty','Telegram\x20user\x20not\x20found','payment','firstName','true','completed','TelegramController','params','getBotInfo','USD','default','17320TtGkto','sendPayoutNotification','sendBroadcast','1Enyfug','sendShopNotification','isVerified','findMany','\x20notification\x20sent\x20successfully','shopId','sendPaymentNotification','query','filter','plisio','getTelegramUsers','2373xzlaYL','bank_transfer','groupBy','map','telegramBotService','sendCustomNotification','json','Shop\x20not\x20found','custom','2042512FMATUi','lastName','title','currency','amount','3173955MmhiQw','telegramUser','../config/database','username','count','shop','1120446bILrJh','15050840oUQatr','sendTestNotification','__esModule','productName','Shop\x20ID\x20is\x20required','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','disconnectUser','method','status','User\x20disconnected\x20successfully','createdAt','body','10zdfLBQ','5795055dSAswP','Broadcast\x20message\x20sent\x20successfully'];a12_0x3998=function(){return _0x5c3f38;};return a12_0x3998();}(function(_0x13fd05,_0x2ad9bc){const _0x1ccfdd=a12_0x3d5f,_0x5a34ba=_0x13fd05();while(!![]){try{const _0x508254=parseInt(_0x1ccfdd(0xb0))/0x1*(-parseInt(_0x1ccfdd(0xc4))/0x2)+-parseInt(_0x1ccfdd(0xc9))/0x3+parseInt(_0x1ccfdd(0x9c))/0x4+-parseInt(_0x1ccfdd(0x96))/0x5*(-parseInt(_0x1ccfdd(0xcf))/0x6)+parseInt(_0x1ccfdd(0xbb))/0x7*(-parseInt(_0x1ccfdd(0xad))/0x8)+parseInt(_0x1ccfdd(0x97))/0x9+parseInt(_0x1ccfdd(0xd0))/0xa;if(_0x508254===_0x2ad9bc)break;else _0x5a34ba['push'](_0x5a34ba['shift']());}catch(_0x21afff){_0x5a34ba['push'](_0x5a34ba['shift']());}}}(a12_0x3998,0x8473e));var __importDefault=this&&this['__importDefault']||function(_0x15f2dd){return _0x15f2dd&&_0x15f2dd['__esModule']?_0x15f2dd:{'default':_0x15f2dd};};Object[a12_0x2a54a4(0xa2)](exports,a12_0x2a54a4(0xd2),{'value':!![]}),exports['TelegramController']=void 0x0;function a12_0x3d5f(_0x733220,_0x5f4865){const _0x399850=a12_0x3998();return a12_0x3d5f=function(_0x3d5f2c,_0x22ef9e){_0x3d5f2c=_0x3d5f2c-0x91;let _0x81f48=_0x399850[_0x3d5f2c];return _0x81f48;},a12_0x3d5f(_0x733220,_0x5f4865);}const telegramBotService_1=require(a12_0x2a54a4(0x99)),database_1=__importDefault(require(a12_0x2a54a4(0xcb)));class TelegramController{constructor(){const _0x3f860f=a12_0x2a54a4;this['getBotStatus']=async(_0x3ad36c,_0x197790,_0x481697)=>{const _0x1ab774=a12_0x3d5f;try{const _0x57509e=telegramBotService_1[_0x1ab774(0xbf)][_0x1ab774(0xaa)](),_0x32b3ce=await database_1[_0x1ab774(0xac)][_0x1ab774(0xca)][_0x1ab774(0xcd)](),_0x54e91f=await database_1[_0x1ab774(0xac)]['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x2aed4a=await database_1[_0x1ab774(0xac)][_0x1ab774(0xca)][_0x1ab774(0xbd)]({'by':[_0x1ab774(0xb5)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x197790[_0x1ab774(0xc1)]({'success':!![],'result':{'bot':{'isActive':_0x57509e['isActive'],'username':_0x57509e[_0x1ab774(0xcc)]},'statistics':{'totalUsers':_0x32b3ce,'verifiedUsers':_0x54e91f,'unverifiedUsers':_0x32b3ce-_0x54e91f,'connectedShops':_0x2aed4a[_0x1ab774(0xa1)]}}});}catch(_0x16f319){_0x481697(_0x16f319);}},this[_0x3f860f(0xba)]=async(_0x5d42dc,_0x10a5d0,_0x4f5318)=>{const _0xf0b1b2=_0x3f860f;try{const {page:page=0x1,limit:limit=0x14,verified:_0x42eae7}=_0x5d42dc[_0xf0b1b2(0xb7)],_0x33c212=(Number(page)-0x1)*Number(limit),_0x1e0caf={};_0x42eae7!==undefined&&(_0x1e0caf[_0xf0b1b2(0xb2)]=_0x42eae7===_0xf0b1b2(0xa6));const [_0x152e26,_0x37ff4f]=await Promise['all']([database_1[_0xf0b1b2(0xac)][_0xf0b1b2(0xca)][_0xf0b1b2(0xb3)]({'where':_0x1e0caf,'skip':_0x33c212,'take':Number(limit),'orderBy':{'createdAt':_0xf0b1b2(0x9f)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0xf0b1b2(0xac)][_0xf0b1b2(0xca)][_0xf0b1b2(0xcd)]({'where':_0x1e0caf})]);_0x10a5d0[_0xf0b1b2(0xc1)]({'success':!![],'users':_0x152e26[_0xf0b1b2(0xbe)](_0x23fa4c=>({'id':_0x23fa4c['id'],'telegramId':_0x23fa4c['telegramId'],'username':_0x23fa4c[_0xf0b1b2(0xcc)],'firstName':_0x23fa4c[_0xf0b1b2(0xa5)],'lastName':_0x23fa4c[_0xf0b1b2(0xc5)],'isVerified':_0x23fa4c[_0xf0b1b2(0xb2)],'shop':_0x23fa4c['shop'],'createdAt':_0x23fa4c[_0xf0b1b2(0x94)],'updatedAt':_0x23fa4c['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x37ff4f,'totalPages':Math['ceil'](_0x37ff4f/Number(limit))}});}catch(_0xdfa92c){_0x4f5318(_0xdfa92c);}},this[_0x3f860f(0xaf)]=async(_0x1e9068,_0x4c6124,_0x26910d)=>{const _0x4bb81e=_0x3f860f;try{const {message:_0x30f2a3,shopId:_0x1dc036}=_0x1e9068[_0x4bb81e(0x95)];if(!_0x30f2a3)return _0x4c6124[_0x4bb81e(0x92)](0x190)[_0x4bb81e(0xc1)]({'success':![],'message':'Message\x20is\x20required'});if(_0x1dc036)await telegramBotService_1[_0x4bb81e(0xbf)][_0x4bb81e(0xb1)](_0x1dc036,_0x30f2a3,{'parse_mode':_0x4bb81e(0x9a)});else{const _0x47496c=await database_1['default'][_0x4bb81e(0xca)][_0x4bb81e(0xb3)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1ae56c=[...new Set(_0x47496c[_0x4bb81e(0xbe)](_0x3021c1=>_0x3021c1[_0x4bb81e(0xb5)])[_0x4bb81e(0xb8)](Boolean))];for(const _0x234b65 of _0x1ae56c){_0x234b65&&await telegramBotService_1[_0x4bb81e(0xbf)][_0x4bb81e(0xb1)](_0x234b65,_0x30f2a3,{'parse_mode':_0x4bb81e(0x9a)});}}_0x4c6124[_0x4bb81e(0xc1)]({'success':!![],'message':_0x4bb81e(0x98)});}catch(_0x43fc25){_0x26910d(_0x43fc25);}},this[_0x3f860f(0xd6)]=async(_0x32dc5b,_0x4cc814,_0x423584)=>{const _0x5d7b45=_0x3f860f;try{const {telegramId:_0x59e111}=_0x32dc5b[_0x5d7b45(0xa9)],_0x39d317=await database_1[_0x5d7b45(0xac)][_0x5d7b45(0xca)]['findUnique']({'where':{'telegramId':_0x59e111},'include':{'shop':!![]}});if(!_0x39d317)return _0x4cc814[_0x5d7b45(0x92)](0x194)[_0x5d7b45(0xc1)]({'success':![],'message':_0x5d7b45(0xa3)});await database_1['default'][_0x5d7b45(0xca)][_0x5d7b45(0x9e)]({'where':{'telegramId':_0x59e111},'data':{'shopId':null,'isVerified':![]}}),_0x4cc814[_0x5d7b45(0xc1)]({'success':!![],'message':_0x5d7b45(0x93)});}catch(_0x489078){_0x423584(_0x489078);}},this[_0x3f860f(0xd1)]=async(_0x453348,_0x528f77,_0x1abd16)=>{const _0x2d16fa=_0x3f860f;try{const {shopId:_0x59f511,type:type=_0x2d16fa(0xa4),testData:_0x1b319a}=_0x453348['body'];if(!_0x59f511)return _0x528f77[_0x2d16fa(0x92)](0x190)['json']({'success':![],'message':_0x2d16fa(0xd4)});const _0x21245b=await database_1[_0x2d16fa(0xac)][_0x2d16fa(0xce)]['findUnique']({'where':{'id':_0x59f511},'select':{'id':!![],'name':!![]}});if(!_0x21245b)return _0x528f77[_0x2d16fa(0x92)](0x194)['json']({'success':![],'message':_0x2d16fa(0xc2)});switch(type){case _0x2d16fa(0xa4):const _0x1ba416={'id':'test_payment_123','amount':_0x1b319a?.['amount']||0x64,'currency':_0x1b319a?.[_0x2d16fa(0xc7)]||_0x2d16fa(0xab),'productName':_0x1b319a?.[_0x2d16fa(0xd3)]||'Test\x20Product','gateway':_0x1b319a?.['gateway']||_0x2d16fa(0xb9),'createdAt':new Date(),..._0x1b319a};await telegramBotService_1[_0x2d16fa(0xbf)][_0x2d16fa(0xb6)](_0x59f511,_0x1ba416,'paid');break;case _0x2d16fa(0x9b):const _0x48852b={'id':_0x2d16fa(0xa0),'amount':_0x1b319a?.[_0x2d16fa(0xc8)]||0x1f4,'method':_0x1b319a?.[_0x2d16fa(0x91)]||_0x2d16fa(0xbc),'createdAt':new Date(),..._0x1b319a};await telegramBotService_1[_0x2d16fa(0xbf)][_0x2d16fa(0xae)](_0x59f511,_0x48852b,_0x2d16fa(0xa7));break;case _0x2d16fa(0xc3):await telegramBotService_1['telegramBotService'][_0x2d16fa(0xc0)](_0x59f511,_0x1b319a?.[_0x2d16fa(0xc6)]||_0x2d16fa(0x9d),_0x1b319a?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x528f77[_0x2d16fa(0x92)](0x190)['json']({'success':![],'message':_0x2d16fa(0xd5)});}_0x528f77[_0x2d16fa(0xc1)]({'success':!![],'message':'Test\x20'+type+_0x2d16fa(0xb4)});}catch(_0x2350db){_0x1abd16(_0x2350db);}};}}exports[a12_0x2a54a4(0xa8)]=TelegramController;