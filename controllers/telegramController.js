'use strict';const a12_0x541edb=a12_0x2853;(function(_0x30ef41,_0x207a25){const _0x21b43f=a12_0x2853,_0xee504=_0x30ef41();while(!![]){try{const _0x182b50=parseInt(_0x21b43f(0x194))/0x1+-parseInt(_0x21b43f(0x177))/0x2+-parseInt(_0x21b43f(0x1aa))/0x3*(-parseInt(_0x21b43f(0x192))/0x4)+parseInt(_0x21b43f(0x193))/0x5*(parseInt(_0x21b43f(0x182))/0x6)+-parseInt(_0x21b43f(0x1a7))/0x7*(-parseInt(_0x21b43f(0x1ab))/0x8)+-parseInt(_0x21b43f(0x1a8))/0x9*(parseInt(_0x21b43f(0x1b0))/0xa)+-parseInt(_0x21b43f(0x17f))/0xb*(-parseInt(_0x21b43f(0x18d))/0xc);if(_0x182b50===_0x207a25)break;else _0xee504['push'](_0xee504['shift']());}catch(_0x2b2e8c){_0xee504['push'](_0xee504['shift']());}}}(a12_0x4ec7,0x35f7d));var __importDefault=this&&this[a12_0x541edb(0x16f)]||function(_0x1db5aa){const _0x4d0c4b=a12_0x541edb;return _0x1db5aa&&_0x1db5aa[_0x4d0c4b(0x18c)]?_0x1db5aa:{'default':_0x1db5aa};};Object[a12_0x541edb(0x16c)](exports,'__esModule',{'value':!![]}),exports[a12_0x541edb(0x19e)]=void 0x0;const telegramBotService_1=require(a12_0x541edb(0x1a2)),database_1=__importDefault(require(a12_0x541edb(0x1ac)));function a12_0x2853(_0x5ba678,_0x4fcbbf){const _0x4ec772=a12_0x4ec7();return a12_0x2853=function(_0x2853c7,_0x1c47ee){_0x2853c7=_0x2853c7-0x16a;let _0x4ef5e6=_0x4ec772[_0x2853c7];return _0x4ef5e6;},a12_0x2853(_0x5ba678,_0x4fcbbf);}class TelegramController{constructor(){const _0x3b6983=a12_0x541edb;this[_0x3b6983(0x181)]=async(_0x55a4ee,_0x39bf34,_0x47ae83)=>{const _0x306631=_0x3b6983;try{const _0x387fdb=telegramBotService_1[_0x306631(0x199)][_0x306631(0x18a)](),_0x446547=await database_1[_0x306631(0x1a3)][_0x306631(0x178)][_0x306631(0x171)](),_0x42fe81=await database_1[_0x306631(0x1a3)][_0x306631(0x178)][_0x306631(0x171)]({'where':{'isVerified':!![]}}),_0x2ba21f=await database_1[_0x306631(0x1a3)]['telegramUser']['groupBy']({'by':[_0x306631(0x189)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x39bf34[_0x306631(0x19f)]({'success':!![],'result':{'bot':{'isActive':_0x387fdb[_0x306631(0x19d)],'username':_0x387fdb[_0x306631(0x173)]},'statistics':{'totalUsers':_0x446547,'verifiedUsers':_0x42fe81,'unverifiedUsers':_0x446547-_0x42fe81,'connectedShops':_0x2ba21f[_0x306631(0x183)]}}});}catch(_0x3ebd72){_0x47ae83(_0x3ebd72);}},this[_0x3b6983(0x1ae)]=async(_0x257dcb,_0x3661f3,_0x2a00e4)=>{const _0x16db4f=_0x3b6983;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2801ef}=_0x257dcb[_0x16db4f(0x1b1)],_0x5daab2=(Number(page)-0x1)*Number(limit),_0x57c970={};_0x2801ef!==undefined&&(_0x57c970[_0x16db4f(0x1a5)]=_0x2801ef==='true');const [_0x4f5bd6,_0x4a220d]=await Promise[_0x16db4f(0x180)]([database_1[_0x16db4f(0x1a3)]['telegramUser'][_0x16db4f(0x17d)]({'where':_0x57c970,'skip':_0x5daab2,'take':Number(limit),'orderBy':{'createdAt':_0x16db4f(0x1a6)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x16db4f(0x1a3)][_0x16db4f(0x178)][_0x16db4f(0x171)]({'where':_0x57c970})]);_0x3661f3[_0x16db4f(0x19f)]({'success':!![],'users':_0x4f5bd6[_0x16db4f(0x17b)](_0x186d6a=>({'id':_0x186d6a['id'],'telegramId':_0x186d6a[_0x16db4f(0x195)],'username':_0x186d6a['username'],'firstName':_0x186d6a[_0x16db4f(0x179)],'lastName':_0x186d6a['lastName'],'isVerified':_0x186d6a[_0x16db4f(0x1a5)],'shop':_0x186d6a[_0x16db4f(0x1af)],'createdAt':_0x186d6a['createdAt'],'updatedAt':_0x186d6a['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x4a220d,'totalPages':Math['ceil'](_0x4a220d/Number(limit))}});}catch(_0x5f2f0a){_0x2a00e4(_0x5f2f0a);}},this[_0x3b6983(0x190)]=async(_0x5b66e1,_0x1b9b9e,_0x44fea9)=>{const _0xebcd31=_0x3b6983;try{const {message:_0x3249c6,shopId:_0x5ca855}=_0x5b66e1[_0xebcd31(0x16d)];if(!_0x3249c6)return _0x1b9b9e[_0xebcd31(0x17a)](0x190)[_0xebcd31(0x19f)]({'success':![],'message':_0xebcd31(0x18e)});if(_0x5ca855)await telegramBotService_1[_0xebcd31(0x199)][_0xebcd31(0x1a1)](_0x5ca855,_0x3249c6,{'parse_mode':_0xebcd31(0x18f)});else{const _0x4f67ee=await database_1['default']['telegramUser'][_0xebcd31(0x17d)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1e5042=[...new Set(_0x4f67ee[_0xebcd31(0x17b)](_0x31969b=>_0x31969b[_0xebcd31(0x189)])['filter'](Boolean))];for(const _0x1b5611 of _0x1e5042){_0x1b5611&&await telegramBotService_1['telegramBotService'][_0xebcd31(0x1a1)](_0x1b5611,_0x3249c6,{'parse_mode':_0xebcd31(0x18f)});}}_0x1b9b9e[_0xebcd31(0x19f)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x5f08b3){_0x44fea9(_0x5f08b3);}},this[_0x3b6983(0x19b)]=async(_0x3c1089,_0x22277c,_0x1cd436)=>{const _0x362a0c=_0x3b6983;try{const {telegramId:_0x9989aa}=_0x3c1089['params'],_0x22c758=await database_1[_0x362a0c(0x1a3)]['telegramUser']['findUnique']({'where':{'telegramId':_0x9989aa},'include':{'shop':!![]}});if(!_0x22c758)return _0x22277c[_0x362a0c(0x17a)](0x194)['json']({'success':![],'message':_0x362a0c(0x17c)});await database_1[_0x362a0c(0x1a3)][_0x362a0c(0x178)][_0x362a0c(0x185)]({'where':{'telegramId':_0x9989aa},'data':{'shopId':null,'isVerified':![]}}),_0x22277c[_0x362a0c(0x19f)]({'success':!![],'message':_0x362a0c(0x16b)});}catch(_0xf90ace){_0x1cd436(_0xf90ace);}},this[_0x3b6983(0x197)]=async(_0x5074ce,_0x5c1ad3,_0x15458b)=>{const _0xdf0526=_0x3b6983;try{const {shopId:_0x56fdda,type:type=_0xdf0526(0x176),testData:_0x378729}=_0x5074ce[_0xdf0526(0x16d)];if(!_0x56fdda)return _0x5c1ad3[_0xdf0526(0x17a)](0x190)['json']({'success':![],'message':_0xdf0526(0x17e)});const _0xbb2d78=await database_1[_0xdf0526(0x1a3)][_0xdf0526(0x1af)][_0xdf0526(0x184)]({'where':{'id':_0x56fdda},'select':{'id':!![],'name':!![]}});if(!_0xbb2d78)return _0x5c1ad3[_0xdf0526(0x17a)](0x194)['json']({'success':![],'message':_0xdf0526(0x19a)});switch(type){case _0xdf0526(0x176):const _0x24945b={'id':_0xdf0526(0x1a0),'amount':_0x378729?.['amount']||0x64,'currency':_0x378729?.[_0xdf0526(0x1a9)]||_0xdf0526(0x175),'productName':_0x378729?.['productName']||_0xdf0526(0x170),'gateway':_0x378729?.['gateway']||_0xdf0526(0x188),'createdAt':new Date(),..._0x378729};await telegramBotService_1[_0xdf0526(0x199)]['sendPaymentNotification'](_0x56fdda,_0x24945b,_0xdf0526(0x16a));break;case _0xdf0526(0x174):const _0x44203c={'id':_0xdf0526(0x1a4),'amount':_0x378729?.[_0xdf0526(0x187)]||0x1f4,'method':_0x378729?.[_0xdf0526(0x191)]||_0xdf0526(0x1b3),'createdAt':new Date(),..._0x378729};await telegramBotService_1[_0xdf0526(0x199)][_0xdf0526(0x16e)](_0x56fdda,_0x44203c,_0xdf0526(0x186));break;case'custom':await telegramBotService_1[_0xdf0526(0x199)]['sendCustomNotification'](_0x56fdda,_0x378729?.[_0xdf0526(0x172)]||_0xdf0526(0x1ad),_0x378729?.[_0xdf0526(0x198)]||{'message':_0xdf0526(0x18b)});break;default:return _0x5c1ad3[_0xdf0526(0x17a)](0x190)['json']({'success':![],'message':_0xdf0526(0x196)});}_0x5c1ad3['json']({'success':!![],'message':_0xdf0526(0x1b2)+type+_0xdf0526(0x19c)});}catch(_0x55d7fd){_0x15458b(_0x55d7fd);}};}}function a12_0x4ec7(){const _0x448449=['test_payout_123','isVerified','desc','38906FDshPA','9jQqEzG','currency','226293IPrWZv','232ObhOVs','../config/database','Test\x20Notification','getTelegramUsers','shop','3436470xnApDE','query','Test\x20','bank_transfer','paid','User\x20disconnected\x20successfully','defineProperty','body','sendPayoutNotification','__importDefault','Test\x20Product','count','title','username','payout','USD','payment','540778ZqeCQr','telegramUser','firstName','status','map','Telegram\x20user\x20not\x20found','findMany','Shop\x20ID\x20is\x20required','33693oNnITv','all','getBotStatus','607530QkwtqA','length','findUnique','update','completed','amount','plisio','shopId','getBotInfo','This\x20is\x20a\x20test\x20notification','__esModule','1104ihzHXb','Message\x20is\x20required','Markdown','sendBroadcast','method','12zQbFSK','5xCCVIy','64563nAJKVl','telegramId','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','sendTestNotification','details','telegramBotService','Shop\x20not\x20found','disconnectUser','\x20notification\x20sent\x20successfully','isActive','TelegramController','json','test_payment_123','sendShopNotification','../services/telegramBotService','default'];a12_0x4ec7=function(){return _0x448449;};return a12_0x4ec7();}exports[a12_0x541edb(0x19e)]=TelegramController;