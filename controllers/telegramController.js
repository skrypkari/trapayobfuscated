'use strict';const a12_0x1d02a8=a12_0x4f08;(function(_0x208f78,_0x337656){const _0x3c9f5e=a12_0x4f08,_0x2df017=_0x208f78();while(!![]){try{const _0x56a4b1=parseInt(_0x3c9f5e(0xd3))/0x1*(parseInt(_0x3c9f5e(0xd9))/0x2)+-parseInt(_0x3c9f5e(0xfd))/0x3+-parseInt(_0x3c9f5e(0xf4))/0x4*(-parseInt(_0x3c9f5e(0xbc))/0x5)+parseInt(_0x3c9f5e(0xcb))/0x6+parseInt(_0x3c9f5e(0xb4))/0x7+-parseInt(_0x3c9f5e(0xe9))/0x8+-parseInt(_0x3c9f5e(0xc6))/0x9;if(_0x56a4b1===_0x337656)break;else _0x2df017['push'](_0x2df017['shift']());}catch(_0x38a051){_0x2df017['push'](_0x2df017['shift']());}}}(a12_0x526f,0x914f0));var __importDefault=this&&this[a12_0x1d02a8(0xf6)]||function(_0x4dd034){const _0x12e57c=a12_0x1d02a8;return _0x4dd034&&_0x4dd034[_0x12e57c(0xb8)]?_0x4dd034:{'default':_0x4dd034};};Object[a12_0x1d02a8(0xb6)](exports,'__esModule',{'value':!![]}),exports[a12_0x1d02a8(0xf3)]=void 0x0;const telegramBotService_1=require(a12_0x1d02a8(0xd5)),database_1=__importDefault(require(a12_0x1d02a8(0xcd)));function a12_0x4f08(_0x352eb0,_0x508e0b){const _0x526fd1=a12_0x526f();return a12_0x4f08=function(_0x4f08ab,_0x1b4b21){_0x4f08ab=_0x4f08ab-0xb4;let _0x2ce557=_0x526fd1[_0x4f08ab];return _0x2ce557;},a12_0x4f08(_0x352eb0,_0x508e0b);}class TelegramController{constructor(){const _0x417115=a12_0x1d02a8;this['getBotStatus']=async(_0x2a863f,_0x21a297,_0x286d96)=>{const _0x51f4c1=a12_0x4f08;try{const _0x562af0=telegramBotService_1[_0x51f4c1(0xed)]['getBotInfo'](),_0x241352=await database_1[_0x51f4c1(0xeb)][_0x51f4c1(0xfa)][_0x51f4c1(0xd0)](),_0x4fb4d8=await database_1[_0x51f4c1(0xeb)][_0x51f4c1(0xfa)][_0x51f4c1(0xd0)]({'where':{'isVerified':!![]}}),_0x182fb7=await database_1[_0x51f4c1(0xeb)]['telegramUser'][_0x51f4c1(0xc4)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x21a297[_0x51f4c1(0xf9)]({'success':!![],'result':{'bot':{'isActive':_0x562af0[_0x51f4c1(0xf7)],'username':_0x562af0['username']},'statistics':{'totalUsers':_0x241352,'verifiedUsers':_0x4fb4d8,'unverifiedUsers':_0x241352-_0x4fb4d8,'connectedShops':_0x182fb7[_0x51f4c1(0xd2)]}}});}catch(_0x1c71ea){_0x286d96(_0x1c71ea);}},this[_0x417115(0xd8)]=async(_0xc0f911,_0x19c2c5,_0x1a5c60)=>{const _0x38f69c=_0x417115;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3094bb}=_0xc0f911[_0x38f69c(0xe5)],_0x58e2de=(Number(page)-0x1)*Number(limit),_0xa80ddb={};_0x3094bb!==undefined&&(_0xa80ddb[_0x38f69c(0xbe)]=_0x3094bb==='true');const [_0x36abf,_0x15b015]=await Promise['all']([database_1[_0x38f69c(0xeb)]['telegramUser'][_0x38f69c(0xc9)]({'where':_0xa80ddb,'skip':_0x58e2de,'take':Number(limit),'orderBy':{'createdAt':_0x38f69c(0xfb)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x38f69c(0xeb)][_0x38f69c(0xfa)]['count']({'where':_0xa80ddb})]);_0x19c2c5['json']({'success':!![],'users':_0x36abf[_0x38f69c(0xce)](_0x4913a9=>({'id':_0x4913a9['id'],'telegramId':_0x4913a9[_0x38f69c(0xfc)],'username':_0x4913a9[_0x38f69c(0xca)],'firstName':_0x4913a9['firstName'],'lastName':_0x4913a9[_0x38f69c(0xb7)],'isVerified':_0x4913a9['isVerified'],'shop':_0x4913a9[_0x38f69c(0xcf)],'createdAt':_0x4913a9[_0x38f69c(0xcc)],'updatedAt':_0x4913a9[_0x38f69c(0xf0)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x15b015,'totalPages':Math[_0x38f69c(0xd6)](_0x15b015/Number(limit))}});}catch(_0x178716){_0x1a5c60(_0x178716);}},this[_0x417115(0xba)]=async(_0x9802cb,_0x3b2839,_0x2f8a66)=>{const _0x3f7d2a=_0x417115;try{const {message:_0x4daead,shopId:_0x39a52f}=_0x9802cb[_0x3f7d2a(0xe2)];if(!_0x4daead)return _0x3b2839[_0x3f7d2a(0xd7)](0x190)[_0x3f7d2a(0xf9)]({'success':![],'message':_0x3f7d2a(0xc5)});if(_0x39a52f)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x39a52f,_0x4daead,{'parse_mode':_0x3f7d2a(0xc1)});else{const _0x80e792=await database_1['default'][_0x3f7d2a(0xfa)][_0x3f7d2a(0xc9)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x45f34c=[...new Set(_0x80e792[_0x3f7d2a(0xce)](_0x2f3a89=>_0x2f3a89[_0x3f7d2a(0xf2)])[_0x3f7d2a(0xd4)](Boolean))];for(const _0x53c4de of _0x45f34c){_0x53c4de&&await telegramBotService_1[_0x3f7d2a(0xed)]['sendShopNotification'](_0x53c4de,_0x4daead,{'parse_mode':'Markdown'});}}_0x3b2839[_0x3f7d2a(0xf9)]({'success':!![],'message':_0x3f7d2a(0xf1)});}catch(_0x47be1c){_0x2f8a66(_0x47be1c);}},this[_0x417115(0xde)]=async(_0x3d0ca4,_0x4bd9cf,_0x58d012)=>{const _0x24df31=_0x417115;try{const {telegramId:_0x86199d}=_0x3d0ca4[_0x24df31(0xd1)],_0x5a966d=await database_1[_0x24df31(0xeb)][_0x24df31(0xfa)]['findUnique']({'where':{'telegramId':_0x86199d},'include':{'shop':!![]}});if(!_0x5a966d)return _0x4bd9cf[_0x24df31(0xd7)](0x194)[_0x24df31(0xf9)]({'success':![],'message':_0x24df31(0xef)});await database_1['default'][_0x24df31(0xfa)][_0x24df31(0xe3)]({'where':{'telegramId':_0x86199d},'data':{'shopId':null,'isVerified':![]}}),_0x4bd9cf[_0x24df31(0xf9)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x48a38d){_0x58d012(_0x48a38d);}},this[_0x417115(0xda)]=async(_0x17f3b4,_0x69ceb2,_0x4aa0b9)=>{const _0x4799a3=_0x417115;try{const {shopId:_0xf7d9e1,type:type='payment',testData:_0x2031da}=_0x17f3b4[_0x4799a3(0xe2)];if(!_0xf7d9e1)return _0x69ceb2[_0x4799a3(0xd7)](0x190)[_0x4799a3(0xf9)]({'success':![],'message':_0x4799a3(0xc8)});const _0x16cb7a=await database_1[_0x4799a3(0xeb)]['shop'][_0x4799a3(0xbf)]({'where':{'id':_0xf7d9e1},'select':{'id':!![],'name':!![]}});if(!_0x16cb7a)return _0x69ceb2[_0x4799a3(0xd7)](0x194)['json']({'success':![],'message':_0x4799a3(0xc3)});switch(type){case _0x4799a3(0xc2):const _0x34e889={'id':_0x4799a3(0xe0),'amount':_0x2031da?.[_0x4799a3(0xc7)]||0x64,'currency':_0x2031da?.[_0x4799a3(0xec)]||_0x4799a3(0xf5),'productName':_0x2031da?.[_0x4799a3(0xf8)]||_0x4799a3(0xdf),'gateway':_0x2031da?.[_0x4799a3(0xe8)]||_0x4799a3(0xe7),'createdAt':new Date(),..._0x2031da};await telegramBotService_1[_0x4799a3(0xed)][_0x4799a3(0xee)](_0xf7d9e1,_0x34e889,'paid');break;case _0x4799a3(0xe4):const _0xc3326c={'id':_0x4799a3(0xe1),'amount':_0x2031da?.['amount']||0x1f4,'method':_0x2031da?.[_0x4799a3(0xb9)]||'bank_transfer','createdAt':new Date(),..._0x2031da};await telegramBotService_1[_0x4799a3(0xed)][_0x4799a3(0xdd)](_0xf7d9e1,_0xc3326c,_0x4799a3(0xbd));break;case _0x4799a3(0xbb):await telegramBotService_1[_0x4799a3(0xed)]['sendCustomNotification'](_0xf7d9e1,_0x2031da?.[_0x4799a3(0xe6)]||'Test\x20Notification',_0x2031da?.[_0x4799a3(0xdc)]||{'message':_0x4799a3(0xb5)});break;default:return _0x69ceb2[_0x4799a3(0xd7)](0x190)['json']({'success':![],'message':_0x4799a3(0xea)});}_0x69ceb2[_0x4799a3(0xf9)]({'success':!![],'message':_0x4799a3(0xdb)+type+_0x4799a3(0xc0)});}catch(_0xe0a5e2){_0x4aa0b9(_0xe0a5e2);}};}}exports['TelegramController']=TelegramController;function a12_0x526f(){const _0x2b398a=['Test\x20Product','test_payment_123','test_payout_123','body','update','payout','query','title','plisio','gateway','5304672KeEFMt','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','default','currency','telegramBotService','sendPaymentNotification','Telegram\x20user\x20not\x20found','updatedAt','Broadcast\x20message\x20sent\x20successfully','shopId','TelegramController','28LrQVRI','USD','__importDefault','isActive','productName','json','telegramUser','desc','telegramId','897456RtjJMn','3995579JFAMgR','This\x20is\x20a\x20test\x20notification','defineProperty','lastName','__esModule','method','sendBroadcast','custom','145285ofzKUe','completed','isVerified','findUnique','\x20notification\x20sent\x20successfully','Markdown','payment','Shop\x20not\x20found','groupBy','Message\x20is\x20required','5747058DolPmw','amount','Shop\x20ID\x20is\x20required','findMany','username','3793662gfBQFs','createdAt','../config/database','map','shop','count','params','length','789509baulIZ','filter','../services/telegramBotService','ceil','status','getTelegramUsers','2jvvPoW','sendTestNotification','Test\x20','details','sendPayoutNotification','disconnectUser'];a12_0x526f=function(){return _0x2b398a;};return a12_0x526f();}