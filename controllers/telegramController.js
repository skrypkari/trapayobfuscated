'use strict';const a14_0x416ed1=a14_0xa109;(function(_0x4a18c8,_0x3cd92c){const _0x2a09d0=a14_0xa109,_0x12b262=_0x4a18c8();while(!![]){try{const _0x28b410=parseInt(_0x2a09d0(0x1fd))/0x1+parseInt(_0x2a09d0(0x216))/0x2+-parseInt(_0x2a09d0(0x219))/0x3*(-parseInt(_0x2a09d0(0x20f))/0x4)+parseInt(_0x2a09d0(0x1f6))/0x5*(-parseInt(_0x2a09d0(0x1e3))/0x6)+parseInt(_0x2a09d0(0x206))/0x7+-parseInt(_0x2a09d0(0x1e9))/0x8+parseInt(_0x2a09d0(0x20d))/0x9*(-parseInt(_0x2a09d0(0x210))/0xa);if(_0x28b410===_0x3cd92c)break;else _0x12b262['push'](_0x12b262['shift']());}catch(_0x582a9b){_0x12b262['push'](_0x12b262['shift']());}}}(a14_0x3195,0x1e082));function a14_0x3195(){const _0x52d6ef=['findMany','count','sendPayoutNotification','9DEitIM','User\x20disconnected\x20successfully','680jEmzDK','65620qruodM','telegramBotService','TelegramController','currency','updatedAt','This\x20is\x20a\x20test\x20notification','60904rasZdx','title','sendCustomNotification','4236KfdAvo','telegramId','../config/database','defineProperty','txid','filter','default','json','USD','Shop\x20not\x20found','paid','productName','update','__importDefault','wallet','ceil','length','amount','true','sendTestNotification','26298oppMhs','all','Shop\x20ID\x20is\x20required','gateway','status','username','1840432gggMib','getTelegramUsers','Test\x20','map','sendShopNotification','../services/telegramBotService','Test\x20Product','TRC20','test_payout_123','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Broadcast\x20message\x20sent\x20successfully','disconnectUser','Test\x20Notification','155WFdDGz','isVerified','Тестовый\x20период','body','sendBroadcast','test_payment_123','groupBy','22218SXlnqN','lastName','shop','Markdown','payout','isActive','__esModule','findUnique','details','1419523lPrwmm','telegramUser','getBotInfo','shopId'];a14_0x3195=function(){return _0x52d6ef;};return a14_0x3195();}var __importDefault=this&&this[a14_0x416ed1(0x226)]||function(_0x2a6ac9){const _0x1959c4=a14_0x416ed1;return _0x2a6ac9&&_0x2a6ac9[_0x1959c4(0x203)]?_0x2a6ac9:{'default':_0x2a6ac9};};Object[a14_0x416ed1(0x21c)](exports,a14_0x416ed1(0x203),{'value':!![]}),exports[a14_0x416ed1(0x212)]=void 0x0;const telegramBotService_1=require(a14_0x416ed1(0x1ee)),database_1=__importDefault(require(a14_0x416ed1(0x21b)));function a14_0xa109(_0x4886e9,_0x1eb017){const _0x319516=a14_0x3195();return a14_0xa109=function(_0xa1097b,_0x1a1852){_0xa1097b=_0xa1097b-0x1e0;let _0x484bd8=_0x319516[_0xa1097b];return _0x484bd8;},a14_0xa109(_0x4886e9,_0x1eb017);}class TelegramController{constructor(){const _0xbe7c26=a14_0x416ed1;this['getBotStatus']=async(_0x109d87,_0x4cafb2,_0x3f8aa4)=>{const _0x209049=a14_0xa109;try{const _0x4db88c=telegramBotService_1['telegramBotService'][_0x209049(0x208)](),_0x36821c=await database_1[_0x209049(0x21f)][_0x209049(0x207)][_0x209049(0x20b)](),_0x1a77b3=await database_1[_0x209049(0x21f)][_0x209049(0x207)][_0x209049(0x20b)]({'where':{'isVerified':!![]}}),_0x1b4d8f=await database_1[_0x209049(0x21f)]['telegramUser'][_0x209049(0x1fc)]({'by':[_0x209049(0x209)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4cafb2[_0x209049(0x220)]({'success':!![],'result':{'bot':{'isActive':_0x4db88c[_0x209049(0x202)],'username':_0x4db88c[_0x209049(0x1e8)]},'statistics':{'totalUsers':_0x36821c,'verifiedUsers':_0x1a77b3,'unverifiedUsers':_0x36821c-_0x1a77b3,'connectedShops':_0x1b4d8f[_0x209049(0x229)]}}});}catch(_0x4e81ff){_0x3f8aa4(_0x4e81ff);}},this[_0xbe7c26(0x1ea)]=async(_0x74507f,_0x1e8a57,_0x17b38e)=>{const _0x1d1081=_0xbe7c26;try{const {page:page=0x1,limit:limit=0x14,verified:_0x36ffce}=_0x74507f['query'],_0x4cc7f7=(Number(page)-0x1)*Number(limit),_0xf5876c={};_0x36ffce!==undefined&&(_0xf5876c[_0x1d1081(0x1f7)]=_0x36ffce===_0x1d1081(0x1e1));const [_0x4ca564,_0x1936cd]=await Promise[_0x1d1081(0x1e4)]([database_1[_0x1d1081(0x21f)][_0x1d1081(0x207)][_0x1d1081(0x20a)]({'where':_0xf5876c,'skip':_0x4cc7f7,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1d1081(0x21f)][_0x1d1081(0x207)]['count']({'where':_0xf5876c})]);_0x1e8a57[_0x1d1081(0x220)]({'success':!![],'users':_0x4ca564[_0x1d1081(0x1ec)](_0x10e7d=>({'id':_0x10e7d['id'],'telegramId':_0x10e7d[_0x1d1081(0x21a)],'username':_0x10e7d['username'],'firstName':_0x10e7d['firstName'],'lastName':_0x10e7d[_0x1d1081(0x1fe)],'isVerified':_0x10e7d[_0x1d1081(0x1f7)],'shop':_0x10e7d[_0x1d1081(0x1ff)],'createdAt':_0x10e7d['createdAt'],'updatedAt':_0x10e7d[_0x1d1081(0x214)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1936cd,'totalPages':Math[_0x1d1081(0x228)](_0x1936cd/Number(limit))}});}catch(_0x1aac64){_0x17b38e(_0x1aac64);}},this[_0xbe7c26(0x1fa)]=async(_0x52e042,_0xa02063,_0x2bbd53)=>{const _0x45d774=_0xbe7c26;try{const {message:_0xeb3eef,shopId:_0x34b4ca}=_0x52e042[_0x45d774(0x1f9)];if(!_0xeb3eef)return _0xa02063[_0x45d774(0x1e7)](0x190)[_0x45d774(0x220)]({'success':![],'message':'Message\x20is\x20required'});if(_0x34b4ca)await telegramBotService_1[_0x45d774(0x211)][_0x45d774(0x1ed)](_0x34b4ca,_0xeb3eef,{'parse_mode':_0x45d774(0x200)});else{const _0x42e7a0=await database_1[_0x45d774(0x21f)]['telegramUser'][_0x45d774(0x20a)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x99a5c1=[...new Set(_0x42e7a0[_0x45d774(0x1ec)](_0x3009c8=>_0x3009c8[_0x45d774(0x209)])[_0x45d774(0x21e)](Boolean))];for(const _0x7532c0 of _0x99a5c1){_0x7532c0&&await telegramBotService_1[_0x45d774(0x211)]['sendShopNotification'](_0x7532c0,_0xeb3eef,{'parse_mode':_0x45d774(0x200)});}}_0xa02063['json']({'success':!![],'message':_0x45d774(0x1f3)});}catch(_0x24e444){_0x2bbd53(_0x24e444);}},this[_0xbe7c26(0x1f4)]=async(_0x7e4935,_0x4c76dd,_0x5e368f)=>{const _0x59521b=_0xbe7c26;try{const {telegramId:_0x328a7f}=_0x7e4935['params'],_0x5db6db=await database_1['default'][_0x59521b(0x207)][_0x59521b(0x204)]({'where':{'telegramId':_0x328a7f},'include':{'shop':!![]}});if(!_0x5db6db)return _0x4c76dd[_0x59521b(0x1e7)](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x59521b(0x21f)][_0x59521b(0x207)][_0x59521b(0x225)]({'where':{'telegramId':_0x328a7f},'data':{'shopId':null,'isVerified':![]}}),_0x4c76dd[_0x59521b(0x220)]({'success':!![],'message':_0x59521b(0x20e)});}catch(_0x2e3557){_0x5e368f(_0x2e3557);}},this[_0xbe7c26(0x1e2)]=async(_0x28826d,_0x55b4c8,_0x1d8af7)=>{const _0x224efe=_0xbe7c26;try{const {shopId:_0x1dbd43,type:type='payment',testData:_0x320635}=_0x28826d['body'];if(!_0x1dbd43)return _0x55b4c8['status'](0x190)[_0x224efe(0x220)]({'success':![],'message':_0x224efe(0x1e5)});const _0x27a4d9=await database_1['default'][_0x224efe(0x1ff)]['findUnique']({'where':{'id':_0x1dbd43},'select':{'id':!![],'name':!![]}});if(!_0x27a4d9)return _0x55b4c8[_0x224efe(0x1e7)](0x194)[_0x224efe(0x220)]({'success':![],'message':_0x224efe(0x222)});switch(type){case'payment':const _0x244998={'id':_0x224efe(0x1fb),'amount':_0x320635?.[_0x224efe(0x1e0)]||0x64,'currency':_0x320635?.[_0x224efe(0x213)]||_0x224efe(0x221),'productName':_0x320635?.[_0x224efe(0x224)]||_0x224efe(0x1ef),'gateway':_0x320635?.[_0x224efe(0x1e6)]||'plisio','createdAt':new Date(),..._0x320635};await telegramBotService_1[_0x224efe(0x211)]['sendPaymentNotification'](_0x1dbd43,_0x244998,_0x224efe(0x223));break;case _0x224efe(0x201):const _0x125bf6={'id':_0x224efe(0x1f1),'amount':_0x320635?.[_0x224efe(0x1e0)]||0x1f4,'network':_0x320635?.['network']||_0x224efe(0x1f0),'wallet':_0x320635?.[_0x224efe(0x227)]||'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','period':_0x224efe(0x1f8),'createdAt':new Date(),'txid':_0x320635?.[_0x224efe(0x21d)]||null,..._0x320635};await telegramBotService_1[_0x224efe(0x211)][_0x224efe(0x20c)](_0x1dbd43,_0x125bf6);break;case'custom':await telegramBotService_1['telegramBotService'][_0x224efe(0x218)](_0x1dbd43,_0x320635?.[_0x224efe(0x217)]||_0x224efe(0x1f5),_0x320635?.[_0x224efe(0x205)]||{'message':_0x224efe(0x215)});break;default:return _0x55b4c8[_0x224efe(0x1e7)](0x190)[_0x224efe(0x220)]({'success':![],'message':_0x224efe(0x1f2)});}_0x55b4c8[_0x224efe(0x220)]({'success':!![],'message':_0x224efe(0x1eb)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x342dd2){_0x1d8af7(_0x342dd2);}};}}exports[a14_0x416ed1(0x212)]=TelegramController;