'use strict';function a18_0x42d4(_0x2d6e17,_0x22ad02){_0x2d6e17=_0x2d6e17-0x110;const _0x343c74=a18_0x343c();let _0x42d430=_0x343c74[_0x2d6e17];return _0x42d430;}const a18_0x1ccdfb=a18_0x42d4;function a18_0x343c(){const _0x1f5c77=['Shop\x20not\x20found','This\x20is\x20a\x20test\x20notification','amount','shopId','telegramId','test_payment_123','2899611tXMbOO','details','getBotStatus','TelegramController','status','Telegram\x20user\x20not\x20found','payment','__esModule','custom','shop','title','params','6273190bYmjiM','2520734JONqqi','677565sXCbeD','ceil','all','Message\x20is\x20required','network','__importDefault','body','getBotInfo','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','telegramBotService','Broadcast\x20message\x20sent\x20successfully','default','lastName','json','findUnique','defineProperty','paid','test_payout_123','5188757dmejRr','Тестовый\x20период','isActive','sendTestNotification','currency','1605792vEivZh','count','2124028OFnitp','\x20notification\x20sent\x20successfully','username','payout','plisio','map','update','Markdown','telegramUser','sendPayoutNotification','disconnectUser','Test\x20','User\x20disconnected\x20successfully','../config/database','Shop\x20ID\x20is\x20required','Test\x20Product','../services/telegramBotService','USD','sendBroadcast','sendPaymentNotification','desc','wallet','groupBy'];a18_0x343c=function(){return _0x1f5c77;};return a18_0x343c();}(function(_0x6d75d4,_0x3e3a29){const _0x50b908=a18_0x42d4,_0x2ffa0a=_0x6d75d4();while(!![]){try{const _0x802f0e=parseInt(_0x50b908(0x125))/0x1+parseInt(_0x50b908(0x124))/0x2+-parseInt(_0x50b908(0x117))/0x3+parseInt(_0x50b908(0x13e))/0x4+-parseInt(_0x50b908(0x123))/0x5+-parseInt(_0x50b908(0x13c))/0x6+parseInt(_0x50b908(0x137))/0x7;if(_0x802f0e===_0x3e3a29)break;else _0x2ffa0a['push'](_0x2ffa0a['shift']());}catch(_0x454cb5){_0x2ffa0a['push'](_0x2ffa0a['shift']());}}}(a18_0x343c,0xb01e7));var __importDefault=this&&this[a18_0x1ccdfb(0x12a)]||function(_0x48ddd8){const _0x4e815f=a18_0x1ccdfb;return _0x48ddd8&&_0x48ddd8[_0x4e815f(0x11e)]?_0x48ddd8:{'default':_0x48ddd8};};Object[a18_0x1ccdfb(0x134)](exports,a18_0x1ccdfb(0x11e),{'value':!![]}),exports[a18_0x1ccdfb(0x11a)]=void 0x0;const telegramBotService_1=require(a18_0x1ccdfb(0x14e)),database_1=__importDefault(require(a18_0x1ccdfb(0x14b)));class TelegramController{constructor(){const _0x1f4162=a18_0x1ccdfb;this[_0x1f4162(0x119)]=async(_0x5b8784,_0x34948d,_0x426cf9)=>{const _0x7d13da=_0x1f4162;try{const _0x28ca07=telegramBotService_1[_0x7d13da(0x12e)][_0x7d13da(0x12c)](),_0x2b3922=await database_1[_0x7d13da(0x130)][_0x7d13da(0x146)][_0x7d13da(0x13d)](),_0x5d407f=await database_1['default'][_0x7d13da(0x146)]['count']({'where':{'isVerified':!![]}}),_0x261954=await database_1[_0x7d13da(0x130)]['telegramUser'][_0x7d13da(0x110)]({'by':[_0x7d13da(0x114)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x34948d['json']({'success':!![],'result':{'bot':{'isActive':_0x28ca07[_0x7d13da(0x139)],'username':_0x28ca07['username']},'statistics':{'totalUsers':_0x2b3922,'verifiedUsers':_0x5d407f,'unverifiedUsers':_0x2b3922-_0x5d407f,'connectedShops':_0x261954['length']}}});}catch(_0x4e55c4){_0x426cf9(_0x4e55c4);}},this['getTelegramUsers']=async(_0x4e7dc5,_0x420e39,_0x43082d)=>{const _0x5501e3=_0x1f4162;try{const {page:page=0x1,limit:limit=0x14,verified:_0x109525}=_0x4e7dc5['query'],_0x4d71f2=(Number(page)-0x1)*Number(limit),_0x270606={};_0x109525!==undefined&&(_0x270606['isVerified']=_0x109525==='true');const [_0xd3eed5,_0x221e3c]=await Promise[_0x5501e3(0x127)]([database_1[_0x5501e3(0x130)]['telegramUser']['findMany']({'where':_0x270606,'skip':_0x4d71f2,'take':Number(limit),'orderBy':{'createdAt':_0x5501e3(0x152)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x5501e3(0x146)]['count']({'where':_0x270606})]);_0x420e39[_0x5501e3(0x132)]({'success':!![],'users':_0xd3eed5[_0x5501e3(0x143)](_0x3accb8=>({'id':_0x3accb8['id'],'telegramId':_0x3accb8[_0x5501e3(0x115)],'username':_0x3accb8[_0x5501e3(0x140)],'firstName':_0x3accb8['firstName'],'lastName':_0x3accb8[_0x5501e3(0x131)],'isVerified':_0x3accb8['isVerified'],'shop':_0x3accb8['shop'],'createdAt':_0x3accb8['createdAt'],'updatedAt':_0x3accb8['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x221e3c,'totalPages':Math[_0x5501e3(0x126)](_0x221e3c/Number(limit))}});}catch(_0x1c009c){_0x43082d(_0x1c009c);}},this[_0x1f4162(0x150)]=async(_0x2f0d9c,_0x49acdf,_0x12f991)=>{const _0x338232=_0x1f4162;try{const {message:_0x4f4dc4,shopId:_0x4aa77a}=_0x2f0d9c[_0x338232(0x12b)];if(!_0x4f4dc4)return _0x49acdf[_0x338232(0x11b)](0x190)[_0x338232(0x132)]({'success':![],'message':_0x338232(0x128)});if(_0x4aa77a)await telegramBotService_1[_0x338232(0x12e)]['sendShopNotification'](_0x4aa77a,_0x4f4dc4,{'parse_mode':_0x338232(0x145)});else{const _0x3f447e=await database_1[_0x338232(0x130)]['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4c1c03=[...new Set(_0x3f447e['map'](_0x265188=>_0x265188[_0x338232(0x114)])['filter'](Boolean))];for(const _0x54bab9 of _0x4c1c03){_0x54bab9&&await telegramBotService_1[_0x338232(0x12e)]['sendShopNotification'](_0x54bab9,_0x4f4dc4,{'parse_mode':_0x338232(0x145)});}}_0x49acdf[_0x338232(0x132)]({'success':!![],'message':_0x338232(0x12f)});}catch(_0x290941){_0x12f991(_0x290941);}},this[_0x1f4162(0x148)]=async(_0x1151ae,_0x5c206f,_0x234986)=>{const _0x394fc5=_0x1f4162;try{const {telegramId:_0x4453a6}=_0x1151ae[_0x394fc5(0x122)],_0xfcf72b=await database_1[_0x394fc5(0x130)][_0x394fc5(0x146)][_0x394fc5(0x133)]({'where':{'telegramId':_0x4453a6},'include':{'shop':!![]}});if(!_0xfcf72b)return _0x5c206f[_0x394fc5(0x11b)](0x194)['json']({'success':![],'message':_0x394fc5(0x11c)});await database_1[_0x394fc5(0x130)]['telegramUser'][_0x394fc5(0x144)]({'where':{'telegramId':_0x4453a6},'data':{'shopId':null,'isVerified':![]}}),_0x5c206f[_0x394fc5(0x132)]({'success':!![],'message':_0x394fc5(0x14a)});}catch(_0x4a7606){_0x234986(_0x4a7606);}},this[_0x1f4162(0x13a)]=async(_0x4ccfeb,_0x152841,_0x1bd13a)=>{const _0x1fa939=_0x1f4162;try{const {shopId:_0x4c5ef4,type:type=_0x1fa939(0x11d),testData:_0x5d54f4}=_0x4ccfeb[_0x1fa939(0x12b)];if(!_0x4c5ef4)return _0x152841[_0x1fa939(0x11b)](0x190)['json']({'success':![],'message':_0x1fa939(0x14c)});const _0x559ca4=await database_1[_0x1fa939(0x130)][_0x1fa939(0x120)][_0x1fa939(0x133)]({'where':{'id':_0x4c5ef4},'select':{'id':!![],'name':!![]}});if(!_0x559ca4)return _0x152841[_0x1fa939(0x11b)](0x194)['json']({'success':![],'message':_0x1fa939(0x111)});switch(type){case'payment':const _0x2deb58={'id':_0x1fa939(0x116),'amount':_0x5d54f4?.[_0x1fa939(0x113)]||0x64,'currency':_0x5d54f4?.[_0x1fa939(0x13b)]||_0x1fa939(0x14f),'productName':_0x5d54f4?.['productName']||_0x1fa939(0x14d),'gateway':_0x5d54f4?.['gateway']||_0x1fa939(0x142),'createdAt':new Date(),..._0x5d54f4};await telegramBotService_1[_0x1fa939(0x12e)][_0x1fa939(0x151)](_0x4c5ef4,_0x2deb58,_0x1fa939(0x135));break;case _0x1fa939(0x141):const _0x4a1fe0={'id':_0x1fa939(0x136),'amount':_0x5d54f4?.[_0x1fa939(0x113)]||0x1f4,'network':_0x5d54f4?.[_0x1fa939(0x129)]||'TRC20','wallet':_0x5d54f4?.[_0x1fa939(0x153)]||_0x1fa939(0x12d),'period':_0x1fa939(0x138),'createdAt':new Date(),'txid':_0x5d54f4?.['txid']||null,..._0x5d54f4};await telegramBotService_1['telegramBotService'][_0x1fa939(0x147)](_0x4c5ef4,_0x4a1fe0);break;case _0x1fa939(0x11f):await telegramBotService_1[_0x1fa939(0x12e)]['sendCustomNotification'](_0x4c5ef4,_0x5d54f4?.[_0x1fa939(0x121)]||'Test\x20Notification',_0x5d54f4?.[_0x1fa939(0x118)]||{'message':_0x1fa939(0x112)});break;default:return _0x152841[_0x1fa939(0x11b)](0x190)[_0x1fa939(0x132)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x152841['json']({'success':!![],'message':_0x1fa939(0x149)+type+_0x1fa939(0x13f)});}catch(_0x3123af){_0x1bd13a(_0x3123af);}};}}exports[a18_0x1ccdfb(0x11a)]=TelegramController;