'use strict';const a12_0x2b0f1b=a12_0xb941;(function(_0x2881af,_0x5d0ac3){const _0x5b4709=a12_0xb941,_0x138c4f=_0x2881af();while(!![]){try{const _0x42af7b=-parseInt(_0x5b4709(0xda))/0x1+parseInt(_0x5b4709(0xcf))/0x2*(-parseInt(_0x5b4709(0xf7))/0x3)+-parseInt(_0x5b4709(0xbb))/0x4*(-parseInt(_0x5b4709(0xd3))/0x5)+parseInt(_0x5b4709(0xbc))/0x6*(-parseInt(_0x5b4709(0xe7))/0x7)+-parseInt(_0x5b4709(0xd2))/0x8+parseInt(_0x5b4709(0xb8))/0x9+-parseInt(_0x5b4709(0xd5))/0xa*(-parseInt(_0x5b4709(0xf1))/0xb);if(_0x42af7b===_0x5d0ac3)break;else _0x138c4f['push'](_0x138c4f['shift']());}catch(_0x488ae5){_0x138c4f['push'](_0x138c4f['shift']());}}}(a12_0xaf92,0x9e0d2));var __importDefault=this&&this[a12_0x2b0f1b(0xc6)]||function(_0x2c14e7){const _0x56363a=a12_0x2b0f1b;return _0x2c14e7&&_0x2c14e7[_0x56363a(0xde)]?_0x2c14e7:{'default':_0x2c14e7};};Object[a12_0x2b0f1b(0xc8)](exports,'__esModule',{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x2b0f1b(0xfa)),database_1=__importDefault(require(a12_0x2b0f1b(0xfd)));function a12_0xaf92(){const _0x37f155=['1392666ZUDEoS','telegramId','Shop\x20not\x20found','amount','Test\x20','sendTestNotification','Message\x20is\x20required','default','TelegramController','isVerified','__importDefault','getBotStatus','defineProperty','firstName','Shop\x20ID\x20is\x20required','username','count','telegramBotService','plisio','228bYjYir','sendCustomNotification','length','1414640cdjuCv','2710MRnYTW','method','160810mGexCu','Markdown','true','json','map','1002147zlLelk','update','getBotInfo','Test\x20Notification','__esModule','payment','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','getTelegramUsers','User\x20disconnected\x20successfully','test_payout_123','isActive','telegramUser','status','14zalBGq','test_payment_123','bank_transfer','productName','details','paid','sendShopNotification','filter','Test\x20Product','findMany','1441cCgzop','shop','disconnectUser','USD','findUnique','body','4908WwuKjm','lastName','gateway','../services/telegramBotService','all','completed','../config/database','shopId','query','656208JFLXac','currency','sendBroadcast','2196SZgafP'];a12_0xaf92=function(){return _0x37f155;};return a12_0xaf92();}class TelegramController{constructor(){const _0x130e4a=a12_0x2b0f1b;this[_0x130e4a(0xc7)]=async(_0x441022,_0x4f32e6,_0x3db264)=>{const _0x314252=_0x130e4a;try{const _0x5f9509=telegramBotService_1[_0x314252(0xcd)][_0x314252(0xdc)](),_0x2fb8ab=await database_1[_0x314252(0xc3)][_0x314252(0xe5)][_0x314252(0xcc)](),_0x10af43=await database_1[_0x314252(0xc3)]['telegramUser'][_0x314252(0xcc)]({'where':{'isVerified':!![]}}),_0x2446c0=await database_1[_0x314252(0xc3)][_0x314252(0xe5)]['groupBy']({'by':[_0x314252(0xfe)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4f32e6['json']({'success':!![],'result':{'bot':{'isActive':_0x5f9509[_0x314252(0xe4)],'username':_0x5f9509[_0x314252(0xcb)]},'statistics':{'totalUsers':_0x2fb8ab,'verifiedUsers':_0x10af43,'unverifiedUsers':_0x2fb8ab-_0x10af43,'connectedShops':_0x2446c0[_0x314252(0xd1)]}}});}catch(_0x4b38f9){_0x3db264(_0x4b38f9);}},this[_0x130e4a(0xe1)]=async(_0x421343,_0x5ed5b9,_0x5677a7)=>{const _0x527ef5=_0x130e4a;try{const {page:page=0x1,limit:limit=0x14,verified:_0xa63696}=_0x421343[_0x527ef5(0xff)],_0xcb96b1=(Number(page)-0x1)*Number(limit),_0xbc488={};_0xa63696!==undefined&&(_0xbc488[_0x527ef5(0xc5)]=_0xa63696===_0x527ef5(0xd7));const [_0xf3d7f7,_0x32dbeb]=await Promise[_0x527ef5(0xfb)]([database_1[_0x527ef5(0xc3)]['telegramUser'][_0x527ef5(0xf0)]({'where':_0xbc488,'skip':_0xcb96b1,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x527ef5(0xc3)][_0x527ef5(0xe5)][_0x527ef5(0xcc)]({'where':_0xbc488})]);_0x5ed5b9[_0x527ef5(0xd8)]({'success':!![],'users':_0xf3d7f7[_0x527ef5(0xd9)](_0x7f40af=>({'id':_0x7f40af['id'],'telegramId':_0x7f40af[_0x527ef5(0xbd)],'username':_0x7f40af['username'],'firstName':_0x7f40af[_0x527ef5(0xc9)],'lastName':_0x7f40af[_0x527ef5(0xf8)],'isVerified':_0x7f40af[_0x527ef5(0xc5)],'shop':_0x7f40af[_0x527ef5(0xf2)],'createdAt':_0x7f40af['createdAt'],'updatedAt':_0x7f40af['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x32dbeb,'totalPages':Math['ceil'](_0x32dbeb/Number(limit))}});}catch(_0x114021){_0x5677a7(_0x114021);}},this[_0x130e4a(0xba)]=async(_0x280faf,_0x4752a5,_0x42ae86)=>{const _0x3e2629=_0x130e4a;try{const {message:_0x153e1b,shopId:_0x59f5a2}=_0x280faf[_0x3e2629(0xf6)];if(!_0x153e1b)return _0x4752a5[_0x3e2629(0xe6)](0x190)[_0x3e2629(0xd8)]({'success':![],'message':_0x3e2629(0xc2)});if(_0x59f5a2)await telegramBotService_1[_0x3e2629(0xcd)][_0x3e2629(0xed)](_0x59f5a2,_0x153e1b,{'parse_mode':'Markdown'});else{const _0x190c34=await database_1[_0x3e2629(0xc3)][_0x3e2629(0xe5)][_0x3e2629(0xf0)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xfaaacf=[...new Set(_0x190c34[_0x3e2629(0xd9)](_0x3b783d=>_0x3b783d[_0x3e2629(0xfe)])[_0x3e2629(0xee)](Boolean))];for(const _0x57e263 of _0xfaaacf){_0x57e263&&await telegramBotService_1['telegramBotService'][_0x3e2629(0xed)](_0x57e263,_0x153e1b,{'parse_mode':_0x3e2629(0xd6)});}}_0x4752a5[_0x3e2629(0xd8)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x546b32){_0x42ae86(_0x546b32);}},this[_0x130e4a(0xf3)]=async(_0x2bf2b1,_0x51fc8c,_0x2ed607)=>{const _0x364063=_0x130e4a;try{const {telegramId:_0x42129c}=_0x2bf2b1['params'],_0x12a130=await database_1[_0x364063(0xc3)][_0x364063(0xe5)][_0x364063(0xf5)]({'where':{'telegramId':_0x42129c},'include':{'shop':!![]}});if(!_0x12a130)return _0x51fc8c[_0x364063(0xe6)](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x364063(0xc3)][_0x364063(0xe5)][_0x364063(0xdb)]({'where':{'telegramId':_0x42129c},'data':{'shopId':null,'isVerified':![]}}),_0x51fc8c[_0x364063(0xd8)]({'success':!![],'message':_0x364063(0xe2)});}catch(_0x24c16a){_0x2ed607(_0x24c16a);}},this[_0x130e4a(0xc1)]=async(_0x507e48,_0x4ab3f9,_0x4669eb)=>{const _0x13b6a1=_0x130e4a;try{const {shopId:_0x2bf111,type:type=_0x13b6a1(0xdf),testData:_0x16bb5b}=_0x507e48[_0x13b6a1(0xf6)];if(!_0x2bf111)return _0x4ab3f9[_0x13b6a1(0xe6)](0x190)[_0x13b6a1(0xd8)]({'success':![],'message':_0x13b6a1(0xca)});const _0x1101cf=await database_1['default']['shop'][_0x13b6a1(0xf5)]({'where':{'id':_0x2bf111},'select':{'id':!![],'name':!![]}});if(!_0x1101cf)return _0x4ab3f9[_0x13b6a1(0xe6)](0x194)[_0x13b6a1(0xd8)]({'success':![],'message':_0x13b6a1(0xbe)});switch(type){case'payment':const _0xb71f1e={'id':_0x13b6a1(0xe8),'amount':_0x16bb5b?.[_0x13b6a1(0xbf)]||0x64,'currency':_0x16bb5b?.[_0x13b6a1(0xb9)]||_0x13b6a1(0xf4),'productName':_0x16bb5b?.[_0x13b6a1(0xea)]||_0x13b6a1(0xef),'gateway':_0x16bb5b?.[_0x13b6a1(0xf9)]||_0x13b6a1(0xce),'createdAt':new Date(),..._0x16bb5b};await telegramBotService_1[_0x13b6a1(0xcd)]['sendPaymentNotification'](_0x2bf111,_0xb71f1e,_0x13b6a1(0xec));break;case'payout':const _0x15dd97={'id':_0x13b6a1(0xe3),'amount':_0x16bb5b?.['amount']||0x1f4,'method':_0x16bb5b?.[_0x13b6a1(0xd4)]||_0x13b6a1(0xe9),'createdAt':new Date(),..._0x16bb5b};await telegramBotService_1[_0x13b6a1(0xcd)]['sendPayoutNotification'](_0x2bf111,_0x15dd97,_0x13b6a1(0xfc));break;case'custom':await telegramBotService_1['telegramBotService'][_0x13b6a1(0xd0)](_0x2bf111,_0x16bb5b?.['title']||_0x13b6a1(0xdd),_0x16bb5b?.[_0x13b6a1(0xeb)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x4ab3f9['status'](0x190)['json']({'success':![],'message':_0x13b6a1(0xe0)});}_0x4ab3f9[_0x13b6a1(0xd8)]({'success':!![],'message':_0x13b6a1(0xc0)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x2405d9){_0x4669eb(_0x2405d9);}};}}function a12_0xb941(_0x125773,_0x1d7a79){const _0xaf9287=a12_0xaf92();return a12_0xb941=function(_0xb94165,_0x46271c){_0xb94165=_0xb94165-0xb8;let _0x385563=_0xaf9287[_0xb94165];return _0x385563;},a12_0xb941(_0x125773,_0x1d7a79);}exports[a12_0x2b0f1b(0xc4)]=TelegramController;