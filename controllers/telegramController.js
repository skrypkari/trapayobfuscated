'use strict';const a12_0xc47edd=a12_0x58be;function a12_0x58be(_0x1d4f22,_0x30d86a){const _0x2984ee=a12_0x2984();return a12_0x58be=function(_0x58be81,_0x1c2747){_0x58be81=_0x58be81-0xfa;let _0x49f2d5=_0x2984ee[_0x58be81];return _0x49f2d5;},a12_0x58be(_0x1d4f22,_0x30d86a);}(function(_0x19e8d9,_0x1701c5){const _0x246a30=a12_0x58be,_0x3f8ed5=_0x19e8d9();while(!![]){try{const _0xbd23a1=parseInt(_0x246a30(0x13d))/0x1*(parseInt(_0x246a30(0x121))/0x2)+-parseInt(_0x246a30(0x131))/0x3*(parseInt(_0x246a30(0x11d))/0x4)+parseInt(_0x246a30(0x140))/0x5+-parseInt(_0x246a30(0x134))/0x6+parseInt(_0x246a30(0x10f))/0x7*(parseInt(_0x246a30(0x125))/0x8)+-parseInt(_0x246a30(0x117))/0x9+parseInt(_0x246a30(0x13a))/0xa*(parseInt(_0x246a30(0x10d))/0xb);if(_0xbd23a1===_0x1701c5)break;else _0x3f8ed5['push'](_0x3f8ed5['shift']());}catch(_0x2745a5){_0x3f8ed5['push'](_0x3f8ed5['shift']());}}}(a12_0x2984,0x3011a));var __importDefault=this&&this[a12_0xc47edd(0x102)]||function(_0x36c70c){const _0x5131da=a12_0xc47edd;return _0x36c70c&&_0x36c70c[_0x5131da(0xfe)]?_0x36c70c:{'default':_0x36c70c};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a12_0xc47edd(0x12e)]=void 0x0;function a12_0x2984(){const _0x81d9da=['params','2234745UTSDmO','map','sendCustomNotification','telegramBotService','Broadcast\x20message\x20sent\x20successfully','amount','52HHkCtH','firstName','\x20notification\x20sent\x20successfully','paid','142khsYjp','Test\x20','updatedAt','Telegram\x20user\x20not\x20found','98584kwBVWL','productName','shop','getBotInfo','count','Message\x20is\x20required','payment','all','body','TelegramController','method','true','25383AWrOfk','query','plisio','666876epxHiB','lastName','sendPayoutNotification','payout','sendShopNotification','Shop\x20ID\x20is\x20required','120uZParq','length','default','5433fEBAUy','../services/telegramBotService','custom','321540ipCkON','isActive','Test\x20Product','json','ceil','__esModule','disconnectUser','update','User\x20disconnected\x20successfully','__importDefault','filter','telegramUser','sendTestNotification','sendBroadcast','currency','findUnique','title','telegramId','bank_transfer','username','141779JVOJZt','Test\x20Notification','35VrFVhA','USD','getBotStatus','details','status','isVerified','sendPaymentNotification'];a12_0x2984=function(){return _0x81d9da;};return a12_0x2984();}const telegramBotService_1=require(a12_0xc47edd(0x13e)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x1cb320=a12_0xc47edd;this[_0x1cb320(0x111)]=async(_0x326a52,_0x54a4c6,_0x5a5887)=>{const _0x2c93c6=_0x1cb320;try{const _0x49a6f6=telegramBotService_1[_0x2c93c6(0x11a)][_0x2c93c6(0x128)](),_0x1f2e87=await database_1[_0x2c93c6(0x13c)][_0x2c93c6(0x104)][_0x2c93c6(0x129)](),_0x4c4654=await database_1['default'][_0x2c93c6(0x104)][_0x2c93c6(0x129)]({'where':{'isVerified':!![]}}),_0x59ee21=await database_1[_0x2c93c6(0x13c)][_0x2c93c6(0x104)]['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x54a4c6['json']({'success':!![],'result':{'bot':{'isActive':_0x49a6f6[_0x2c93c6(0xfa)],'username':_0x49a6f6[_0x2c93c6(0x10c)]},'statistics':{'totalUsers':_0x1f2e87,'verifiedUsers':_0x4c4654,'unverifiedUsers':_0x1f2e87-_0x4c4654,'connectedShops':_0x59ee21[_0x2c93c6(0x13b)]}}});}catch(_0x2cf0a3){_0x5a5887(_0x2cf0a3);}},this['getTelegramUsers']=async(_0x5f0352,_0x419e91,_0x43c44c)=>{const _0x4692b5=_0x1cb320;try{const {page:page=0x1,limit:limit=0x14,verified:_0x48be5c}=_0x5f0352[_0x4692b5(0x132)],_0x508045=(Number(page)-0x1)*Number(limit),_0x4e8951={};_0x48be5c!==undefined&&(_0x4e8951[_0x4692b5(0x114)]=_0x48be5c===_0x4692b5(0x130));const [_0x4b2200,_0x3eb6ba]=await Promise[_0x4692b5(0x12c)]([database_1[_0x4692b5(0x13c)][_0x4692b5(0x104)]['findMany']({'where':_0x4e8951,'skip':_0x508045,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4692b5(0x13c)][_0x4692b5(0x104)][_0x4692b5(0x129)]({'where':_0x4e8951})]);_0x419e91['json']({'success':!![],'users':_0x4b2200['map'](_0x1e7f58=>({'id':_0x1e7f58['id'],'telegramId':_0x1e7f58[_0x4692b5(0x10a)],'username':_0x1e7f58[_0x4692b5(0x10c)],'firstName':_0x1e7f58[_0x4692b5(0x11e)],'lastName':_0x1e7f58[_0x4692b5(0x135)],'isVerified':_0x1e7f58[_0x4692b5(0x114)],'shop':_0x1e7f58[_0x4692b5(0x127)],'createdAt':_0x1e7f58['createdAt'],'updatedAt':_0x1e7f58[_0x4692b5(0x123)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3eb6ba,'totalPages':Math[_0x4692b5(0xfd)](_0x3eb6ba/Number(limit))}});}catch(_0x147c6c){_0x43c44c(_0x147c6c);}},this[_0x1cb320(0x106)]=async(_0x2ff0c1,_0x4c8aad,_0xfc0c59)=>{const _0x456c4a=_0x1cb320;try{const {message:_0x35327f,shopId:_0x3e69c7}=_0x2ff0c1[_0x456c4a(0x12d)];if(!_0x35327f)return _0x4c8aad[_0x456c4a(0x113)](0x190)[_0x456c4a(0xfc)]({'success':![],'message':_0x456c4a(0x12a)});if(_0x3e69c7)await telegramBotService_1[_0x456c4a(0x11a)][_0x456c4a(0x138)](_0x3e69c7,_0x35327f,{'parse_mode':'Markdown'});else{const _0x5967d9=await database_1['default'][_0x456c4a(0x104)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3aa2c8=[...new Set(_0x5967d9[_0x456c4a(0x118)](_0x3c5ea7=>_0x3c5ea7['shopId'])[_0x456c4a(0x103)](Boolean))];for(const _0xe67ca1 of _0x3aa2c8){_0xe67ca1&&await telegramBotService_1[_0x456c4a(0x11a)][_0x456c4a(0x138)](_0xe67ca1,_0x35327f,{'parse_mode':'Markdown'});}}_0x4c8aad['json']({'success':!![],'message':_0x456c4a(0x11b)});}catch(_0x475e5d){_0xfc0c59(_0x475e5d);}},this[_0x1cb320(0xff)]=async(_0x19ea05,_0x35c0ec,_0x468288)=>{const _0x571433=_0x1cb320;try{const {telegramId:_0x25dc33}=_0x19ea05[_0x571433(0x116)],_0x162700=await database_1[_0x571433(0x13c)][_0x571433(0x104)][_0x571433(0x108)]({'where':{'telegramId':_0x25dc33},'include':{'shop':!![]}});if(!_0x162700)return _0x35c0ec[_0x571433(0x113)](0x194)['json']({'success':![],'message':_0x571433(0x124)});await database_1['default'][_0x571433(0x104)][_0x571433(0x100)]({'where':{'telegramId':_0x25dc33},'data':{'shopId':null,'isVerified':![]}}),_0x35c0ec['json']({'success':!![],'message':_0x571433(0x101)});}catch(_0x5d3fd7){_0x468288(_0x5d3fd7);}},this[_0x1cb320(0x105)]=async(_0x38a808,_0x403d02,_0x4a369f)=>{const _0x2ef020=_0x1cb320;try{const {shopId:_0x4508e0,type:type=_0x2ef020(0x12b),testData:_0x461a8c}=_0x38a808[_0x2ef020(0x12d)];if(!_0x4508e0)return _0x403d02['status'](0x190)[_0x2ef020(0xfc)]({'success':![],'message':_0x2ef020(0x139)});const _0x5ae3d9=await database_1['default']['shop'][_0x2ef020(0x108)]({'where':{'id':_0x4508e0},'select':{'id':!![],'name':!![]}});if(!_0x5ae3d9)return _0x403d02[_0x2ef020(0x113)](0x194)[_0x2ef020(0xfc)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x2ef020(0x12b):const _0xbe5ca7={'id':'test_payment_123','amount':_0x461a8c?.[_0x2ef020(0x11c)]||0x64,'currency':_0x461a8c?.[_0x2ef020(0x107)]||_0x2ef020(0x110),'productName':_0x461a8c?.[_0x2ef020(0x126)]||_0x2ef020(0xfb),'gateway':_0x461a8c?.['gateway']||_0x2ef020(0x133),'createdAt':new Date(),..._0x461a8c};await telegramBotService_1['telegramBotService'][_0x2ef020(0x115)](_0x4508e0,_0xbe5ca7,_0x2ef020(0x120));break;case _0x2ef020(0x137):const _0x5a6eaf={'id':'test_payout_123','amount':_0x461a8c?.[_0x2ef020(0x11c)]||0x1f4,'method':_0x461a8c?.[_0x2ef020(0x12f)]||_0x2ef020(0x10b),'createdAt':new Date(),..._0x461a8c};await telegramBotService_1[_0x2ef020(0x11a)][_0x2ef020(0x136)](_0x4508e0,_0x5a6eaf,'completed');break;case _0x2ef020(0x13f):await telegramBotService_1['telegramBotService'][_0x2ef020(0x119)](_0x4508e0,_0x461a8c?.[_0x2ef020(0x109)]||_0x2ef020(0x10e),_0x461a8c?.[_0x2ef020(0x112)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x403d02[_0x2ef020(0x113)](0x190)[_0x2ef020(0xfc)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x403d02[_0x2ef020(0xfc)]({'success':!![],'message':_0x2ef020(0x122)+type+_0x2ef020(0x11f)});}catch(_0x1959d8){_0x4a369f(_0x1959d8);}};}}exports[a12_0xc47edd(0x12e)]=TelegramController;