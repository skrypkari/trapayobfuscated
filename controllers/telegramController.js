'use strict';const a17_0x1dfba1=a17_0x33bf;(function(_0x184b7c,_0x2e1a98){const _0xe3135=a17_0x33bf,_0x11626c=_0x184b7c();while(!![]){try{const _0x4ec686=-parseInt(_0xe3135(0x1c4))/0x1+parseInt(_0xe3135(0x1ce))/0x2+-parseInt(_0xe3135(0x1b3))/0x3+parseInt(_0xe3135(0x1ac))/0x4+parseInt(_0xe3135(0x1af))/0x5*(parseInt(_0xe3135(0x1c1))/0x6)+-parseInt(_0xe3135(0x1b0))/0x7*(parseInt(_0xe3135(0x19e))/0x8)+-parseInt(_0xe3135(0x1cb))/0x9*(parseInt(_0xe3135(0x192))/0xa);if(_0x4ec686===_0x2e1a98)break;else _0x11626c['push'](_0x11626c['shift']());}catch(_0x103011){_0x11626c['push'](_0x11626c['shift']());}}}(a17_0x4b40,0xdbee6));function a17_0x33bf(_0x2d0235,_0x229c95){_0x2d0235=_0x2d0235-0x190;const _0x4b4021=a17_0x4b40();let _0x33bf19=_0x4b4021[_0x2d0235];return _0x33bf19;}var __importDefault=this&&this[a17_0x1dfba1(0x1ab)]||function(_0x59d161){const _0x3f8bd2=a17_0x1dfba1;return _0x59d161&&_0x59d161[_0x3f8bd2(0x1aa)]?_0x59d161:{'default':_0x59d161};};Object[a17_0x1dfba1(0x1a1)](exports,a17_0x1dfba1(0x1aa),{'value':!![]}),exports[a17_0x1dfba1(0x1bb)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require('../config/database'));function a17_0x4b40(){const _0x4d5f54=['updatedAt','txid','amount','groupBy','9CfHldC','getBotStatus','telegramId','2639996vtdyTx','network','payment','telegramBotService','sendTestNotification','test_payout_123','wallet','filter','Message\x20is\x20required','Test\x20Notification','username','Test\x20Product','User\x20disconnected\x20successfully','Shop\x20ID\x20is\x20required','sendShopNotification','findUnique','getTelegramUsers','createdAt','details','18088490tPQPQo','body','shop','map','USD','sendPaymentNotification','true','Тестовый\x20период','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','lastName','title','Shop\x20not\x20found','8936ieDdtb','all','Test\x20','defineProperty','isActive','count','gateway','Markdown','getBotInfo','json','custom','TRC20','__esModule','__importDefault','5499900sLxvGs','desc','shopId','6992215bScWlM','6223evGzJI','isVerified','\x20notification\x20sent\x20successfully','335298nZWwMj','length','disconnectUser','firstName','sendCustomNotification','payout','productName','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','TelegramController','status','default','currency','paid','plisio','6PgWsQW','Telegram\x20user\x20not\x20found','findMany','278950DudxcA','telegramUser','query'];a17_0x4b40=function(){return _0x4d5f54;};return a17_0x4b40();}class TelegramController{constructor(){const _0x20753c=a17_0x1dfba1;this[_0x20753c(0x1cc)]=async(_0x39e6f6,_0x361f71,_0x452e35)=>{const _0x20c8f2=_0x20753c;try{const _0xa63dbb=telegramBotService_1[_0x20c8f2(0x1d1)][_0x20c8f2(0x1a6)](),_0x377bed=await database_1[_0x20c8f2(0x1bd)]['telegramUser'][_0x20c8f2(0x1a3)](),_0xcc8a71=await database_1[_0x20c8f2(0x1bd)][_0x20c8f2(0x1c5)][_0x20c8f2(0x1a3)]({'where':{'isVerified':!![]}}),_0x43e861=await database_1[_0x20c8f2(0x1bd)]['telegramUser'][_0x20c8f2(0x1ca)]({'by':[_0x20c8f2(0x1ae)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x361f71['json']({'success':!![],'result':{'bot':{'isActive':_0xa63dbb[_0x20c8f2(0x1a2)],'username':_0xa63dbb[_0x20c8f2(0x1d8)]},'statistics':{'totalUsers':_0x377bed,'verifiedUsers':_0xcc8a71,'unverifiedUsers':_0x377bed-_0xcc8a71,'connectedShops':_0x43e861[_0x20c8f2(0x1b4)]}}});}catch(_0x52522f){_0x452e35(_0x52522f);}},this[_0x20753c(0x1de)]=async(_0x4357f5,_0x3ae6fb,_0x3c8a96)=>{const _0x1fbac6=_0x20753c;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2343c3}=_0x4357f5[_0x1fbac6(0x1c6)],_0x3828b0=(Number(page)-0x1)*Number(limit),_0x1c1df6={};_0x2343c3!==undefined&&(_0x1c1df6[_0x1fbac6(0x1b1)]=_0x2343c3===_0x1fbac6(0x198));const [_0x419f67,_0x1517d7]=await Promise[_0x1fbac6(0x19f)]([database_1[_0x1fbac6(0x1bd)][_0x1fbac6(0x1c5)]['findMany']({'where':_0x1c1df6,'skip':_0x3828b0,'take':Number(limit),'orderBy':{'createdAt':_0x1fbac6(0x1ad)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1fbac6(0x1bd)]['telegramUser'][_0x1fbac6(0x1a3)]({'where':_0x1c1df6})]);_0x3ae6fb[_0x1fbac6(0x1a7)]({'success':!![],'users':_0x419f67[_0x1fbac6(0x195)](_0x30d9ce=>({'id':_0x30d9ce['id'],'telegramId':_0x30d9ce[_0x1fbac6(0x1cd)],'username':_0x30d9ce['username'],'firstName':_0x30d9ce[_0x1fbac6(0x1b6)],'lastName':_0x30d9ce[_0x1fbac6(0x19b)],'isVerified':_0x30d9ce['isVerified'],'shop':_0x30d9ce[_0x1fbac6(0x194)],'createdAt':_0x30d9ce[_0x1fbac6(0x190)],'updatedAt':_0x30d9ce[_0x1fbac6(0x1c7)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1517d7,'totalPages':Math['ceil'](_0x1517d7/Number(limit))}});}catch(_0x454271){_0x3c8a96(_0x454271);}},this['sendBroadcast']=async(_0x1a1e8c,_0x37977e,_0x32204c)=>{const _0x152b59=_0x20753c;try{const {message:_0x309456,shopId:_0x2de10e}=_0x1a1e8c[_0x152b59(0x193)];if(!_0x309456)return _0x37977e[_0x152b59(0x1bc)](0x190)[_0x152b59(0x1a7)]({'success':![],'message':_0x152b59(0x1d6)});if(_0x2de10e)await telegramBotService_1['telegramBotService'][_0x152b59(0x1dc)](_0x2de10e,_0x309456,{'parse_mode':'Markdown'});else{const _0x436a4e=await database_1[_0x152b59(0x1bd)][_0x152b59(0x1c5)][_0x152b59(0x1c3)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x575dff=[...new Set(_0x436a4e[_0x152b59(0x195)](_0x251048=>_0x251048[_0x152b59(0x1ae)])[_0x152b59(0x1d5)](Boolean))];for(const _0x3873f9 of _0x575dff){_0x3873f9&&await telegramBotService_1[_0x152b59(0x1d1)]['sendShopNotification'](_0x3873f9,_0x309456,{'parse_mode':_0x152b59(0x1a5)});}}_0x37977e[_0x152b59(0x1a7)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x41994a){_0x32204c(_0x41994a);}},this[_0x20753c(0x1b5)]=async(_0x10e165,_0x2e6e57,_0x5c8b97)=>{const _0x46b71d=_0x20753c;try{const {telegramId:_0x4c3a23}=_0x10e165['params'],_0x1680b5=await database_1[_0x46b71d(0x1bd)]['telegramUser'][_0x46b71d(0x1dd)]({'where':{'telegramId':_0x4c3a23},'include':{'shop':!![]}});if(!_0x1680b5)return _0x2e6e57[_0x46b71d(0x1bc)](0x194)[_0x46b71d(0x1a7)]({'success':![],'message':_0x46b71d(0x1c2)});await database_1[_0x46b71d(0x1bd)][_0x46b71d(0x1c5)]['update']({'where':{'telegramId':_0x4c3a23},'data':{'shopId':null,'isVerified':![]}}),_0x2e6e57[_0x46b71d(0x1a7)]({'success':!![],'message':_0x46b71d(0x1da)});}catch(_0x3fa8d9){_0x5c8b97(_0x3fa8d9);}},this[_0x20753c(0x1d2)]=async(_0x5e9aa2,_0x6fed4f,_0x213463)=>{const _0x15af16=_0x20753c;try{const {shopId:_0x1aaee8,type:type=_0x15af16(0x1d0),testData:_0x48f4ef}=_0x5e9aa2[_0x15af16(0x193)];if(!_0x1aaee8)return _0x6fed4f[_0x15af16(0x1bc)](0x190)['json']({'success':![],'message':_0x15af16(0x1db)});const _0x2abdb3=await database_1['default'][_0x15af16(0x194)][_0x15af16(0x1dd)]({'where':{'id':_0x1aaee8},'select':{'id':!![],'name':!![]}});if(!_0x2abdb3)return _0x6fed4f['status'](0x194)['json']({'success':![],'message':_0x15af16(0x19d)});switch(type){case _0x15af16(0x1d0):const _0x3318c3={'id':'test_payment_123','amount':_0x48f4ef?.[_0x15af16(0x1c9)]||0x64,'currency':_0x48f4ef?.[_0x15af16(0x1be)]||_0x15af16(0x196),'productName':_0x48f4ef?.[_0x15af16(0x1b9)]||_0x15af16(0x1d9),'gateway':_0x48f4ef?.[_0x15af16(0x1a4)]||_0x15af16(0x1c0),'createdAt':new Date(),..._0x48f4ef};await telegramBotService_1[_0x15af16(0x1d1)][_0x15af16(0x197)](_0x1aaee8,_0x3318c3,_0x15af16(0x1bf));break;case _0x15af16(0x1b8):const _0x24e6f0={'id':_0x15af16(0x1d3),'amount':_0x48f4ef?.['amount']||0x1f4,'network':_0x48f4ef?.[_0x15af16(0x1cf)]||_0x15af16(0x1a9),'wallet':_0x48f4ef?.[_0x15af16(0x1d4)]||_0x15af16(0x1ba),'period':_0x15af16(0x199),'createdAt':new Date(),'txid':_0x48f4ef?.[_0x15af16(0x1c8)]||null,..._0x48f4ef};await telegramBotService_1[_0x15af16(0x1d1)]['sendPayoutNotification'](_0x1aaee8,_0x24e6f0);break;case _0x15af16(0x1a8):await telegramBotService_1[_0x15af16(0x1d1)][_0x15af16(0x1b7)](_0x1aaee8,_0x48f4ef?.[_0x15af16(0x19c)]||_0x15af16(0x1d7),_0x48f4ef?.[_0x15af16(0x191)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x6fed4f[_0x15af16(0x1bc)](0x190)[_0x15af16(0x1a7)]({'success':![],'message':_0x15af16(0x19a)});}_0x6fed4f['json']({'success':!![],'message':_0x15af16(0x1a0)+type+_0x15af16(0x1b2)});}catch(_0x24e19c){_0x213463(_0x24e19c);}};}}exports[a17_0x1dfba1(0x1bb)]=TelegramController;