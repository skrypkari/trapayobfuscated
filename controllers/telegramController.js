'use strict';function a12_0x603f(_0x1e4994,_0x5be3a8){const _0xd92eec=a12_0xd92e();return a12_0x603f=function(_0x603f32,_0xe4f2b8){_0x603f32=_0x603f32-0x17d;let _0x1e40ef=_0xd92eec[_0x603f32];return _0x1e40ef;},a12_0x603f(_0x1e4994,_0x5be3a8);}const a12_0x3ff839=a12_0x603f;(function(_0x546693,_0x191bac){const _0x28bbd3=a12_0x603f,_0x3419c7=_0x546693();while(!![]){try{const _0x3cd3dd=parseInt(_0x28bbd3(0x1ab))/0x1+-parseInt(_0x28bbd3(0x183))/0x2+parseInt(_0x28bbd3(0x184))/0x3+parseInt(_0x28bbd3(0x1b7))/0x4+parseInt(_0x28bbd3(0x1bb))/0x5*(parseInt(_0x28bbd3(0x1b6))/0x6)+parseInt(_0x28bbd3(0x1a7))/0x7+-parseInt(_0x28bbd3(0x196))/0x8*(parseInt(_0x28bbd3(0x1a2))/0x9);if(_0x3cd3dd===_0x191bac)break;else _0x3419c7['push'](_0x3419c7['shift']());}catch(_0x260c84){_0x3419c7['push'](_0x3419c7['shift']());}}}(a12_0xd92e,0xc7a83));var __importDefault=this&&this['__importDefault']||function(_0x4f4d58){return _0x4f4d58&&_0x4f4d58['__esModule']?_0x4f4d58:{'default':_0x4f4d58};};Object['defineProperty'](exports,a12_0x3ff839(0x17e),{'value':!![]}),exports[a12_0x3ff839(0x192)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x3ff839(0x189)));class TelegramController{constructor(){const _0x2c8757=a12_0x3ff839;this[_0x2c8757(0x1be)]=async(_0x4e96d8,_0x5a95ff,_0x2d26cb)=>{const _0x19480f=_0x2c8757;try{const _0x33cec8=telegramBotService_1[_0x19480f(0x1b1)]['getBotInfo'](),_0x230a3e=await database_1[_0x19480f(0x1bc)][_0x19480f(0x17d)][_0x19480f(0x19d)](),_0x468372=await database_1[_0x19480f(0x1bc)][_0x19480f(0x17d)][_0x19480f(0x19d)]({'where':{'isVerified':!![]}}),_0x4495dc=await database_1[_0x19480f(0x1bc)][_0x19480f(0x17d)]['groupBy']({'by':[_0x19480f(0x1c0)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5a95ff[_0x19480f(0x1a4)]({'success':!![],'result':{'bot':{'isActive':_0x33cec8[_0x19480f(0x19f)],'username':_0x33cec8[_0x19480f(0x1af)]},'statistics':{'totalUsers':_0x230a3e,'verifiedUsers':_0x468372,'unverifiedUsers':_0x230a3e-_0x468372,'connectedShops':_0x4495dc[_0x19480f(0x1a9)]}}});}catch(_0x4481fb){_0x2d26cb(_0x4481fb);}},this[_0x2c8757(0x1a8)]=async(_0x3afbd3,_0x3c19e0,_0x4bddcd)=>{const _0x43aabe=_0x2c8757;try{const {page:page=0x1,limit:limit=0x14,verified:_0x32e30e}=_0x3afbd3[_0x43aabe(0x1a3)],_0x507c97=(Number(page)-0x1)*Number(limit),_0x31ce75={};_0x32e30e!==undefined&&(_0x31ce75[_0x43aabe(0x193)]=_0x32e30e===_0x43aabe(0x1b2));const [_0x4acb72,_0x549e2b]=await Promise[_0x43aabe(0x18f)]([database_1[_0x43aabe(0x1bc)][_0x43aabe(0x17d)][_0x43aabe(0x1a1)]({'where':_0x31ce75,'skip':_0x507c97,'take':Number(limit),'orderBy':{'createdAt':_0x43aabe(0x199)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x43aabe(0x1bc)][_0x43aabe(0x17d)][_0x43aabe(0x19d)]({'where':_0x31ce75})]);_0x3c19e0[_0x43aabe(0x1a4)]({'success':!![],'users':_0x4acb72['map'](_0x2cb09c=>({'id':_0x2cb09c['id'],'telegramId':_0x2cb09c['telegramId'],'username':_0x2cb09c['username'],'firstName':_0x2cb09c[_0x43aabe(0x18a)],'lastName':_0x2cb09c[_0x43aabe(0x1bf)],'isVerified':_0x2cb09c[_0x43aabe(0x193)],'shop':_0x2cb09c[_0x43aabe(0x1ae)],'createdAt':_0x2cb09c[_0x43aabe(0x182)],'updatedAt':_0x2cb09c[_0x43aabe(0x19b)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x549e2b,'totalPages':Math['ceil'](_0x549e2b/Number(limit))}});}catch(_0x46b52c){_0x4bddcd(_0x46b52c);}},this['sendBroadcast']=async(_0x1e6192,_0x46b36d,_0x225dde)=>{const _0x358803=_0x2c8757;try{const {message:_0x8eba11,shopId:_0x287bdf}=_0x1e6192[_0x358803(0x19c)];if(!_0x8eba11)return _0x46b36d[_0x358803(0x19a)](0x190)[_0x358803(0x1a4)]({'success':![],'message':_0x358803(0x18c)});if(_0x287bdf)await telegramBotService_1[_0x358803(0x1b1)][_0x358803(0x195)](_0x287bdf,_0x8eba11,{'parse_mode':_0x358803(0x1b4)});else{const _0x4ef256=await database_1[_0x358803(0x1bc)]['telegramUser'][_0x358803(0x1a1)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x146d4d=[...new Set(_0x4ef256['map'](_0x341a2f=>_0x341a2f['shopId'])[_0x358803(0x1ad)](Boolean))];for(const _0x3c4792 of _0x146d4d){_0x3c4792&&await telegramBotService_1['telegramBotService'][_0x358803(0x195)](_0x3c4792,_0x8eba11,{'parse_mode':'Markdown'});}}_0x46b36d[_0x358803(0x1a4)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x588bcf){_0x225dde(_0x588bcf);}},this[_0x2c8757(0x1b3)]=async(_0x5b7298,_0x44da72,_0x360816)=>{const _0x3ca891=_0x2c8757;try{const {telegramId:_0x3e99e6}=_0x5b7298[_0x3ca891(0x181)],_0x23d21b=await database_1[_0x3ca891(0x1bc)][_0x3ca891(0x17d)]['findUnique']({'where':{'telegramId':_0x3e99e6},'include':{'shop':!![]}});if(!_0x23d21b)return _0x44da72[_0x3ca891(0x19a)](0x194)[_0x3ca891(0x1a4)]({'success':![],'message':_0x3ca891(0x188)});await database_1[_0x3ca891(0x1bc)][_0x3ca891(0x17d)][_0x3ca891(0x1b0)]({'where':{'telegramId':_0x3e99e6},'data':{'shopId':null,'isVerified':![]}}),_0x44da72['json']({'success':!![],'message':_0x3ca891(0x1b9)});}catch(_0x41e02c){_0x360816(_0x41e02c);}},this[_0x2c8757(0x1b8)]=async(_0x30ec8e,_0x4119a6,_0x509919)=>{const _0x16e034=_0x2c8757;try{const {shopId:_0x2f618f,type:type=_0x16e034(0x18d),testData:_0x413219}=_0x30ec8e[_0x16e034(0x19c)];if(!_0x2f618f)return _0x4119a6[_0x16e034(0x19a)](0x190)[_0x16e034(0x1a4)]({'success':![],'message':_0x16e034(0x19e)});const _0x42400d=await database_1[_0x16e034(0x1bc)]['shop'][_0x16e034(0x1a6)]({'where':{'id':_0x2f618f},'select':{'id':!![],'name':!![]}});if(!_0x42400d)return _0x4119a6[_0x16e034(0x19a)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x16e034(0x18d):const _0x2319dc={'id':_0x16e034(0x180),'amount':_0x413219?.['amount']||0x64,'currency':_0x413219?.[_0x16e034(0x18b)]||_0x16e034(0x1ac),'productName':_0x413219?.[_0x16e034(0x1a0)]||_0x16e034(0x185),'gateway':_0x413219?.['gateway']||_0x16e034(0x1bd),'createdAt':new Date(),..._0x413219};await telegramBotService_1[_0x16e034(0x1b1)][_0x16e034(0x1aa)](_0x2f618f,_0x2319dc,_0x16e034(0x17f));break;case _0x16e034(0x1b5):const _0x267017={'id':_0x16e034(0x18e),'amount':_0x413219?.[_0x16e034(0x187)]||0x1f4,'method':_0x413219?.['method']||'bank_transfer','createdAt':new Date(),..._0x413219};await telegramBotService_1[_0x16e034(0x1b1)][_0x16e034(0x197)](_0x2f618f,_0x267017,_0x16e034(0x1a5));break;case'custom':await telegramBotService_1[_0x16e034(0x1b1)][_0x16e034(0x186)](_0x2f618f,_0x413219?.['title']||_0x16e034(0x198),_0x413219?.[_0x16e034(0x191)]||{'message':_0x16e034(0x194)});break;default:return _0x4119a6[_0x16e034(0x19a)](0x190)[_0x16e034(0x1a4)]({'success':![],'message':_0x16e034(0x1ba)});}_0x4119a6['json']({'success':!![],'message':'Test\x20'+type+_0x16e034(0x190)});}catch(_0x424f0a){_0x509919(_0x424f0a);}};}}function a12_0xd92e(){const _0x1049f7=['query','json','completed','findUnique','5050346pbTWlt','getTelegramUsers','length','sendPaymentNotification','403766CVMkkA','USD','filter','shop','username','update','telegramBotService','true','disconnectUser','Markdown','payout','18PigRab','1952900zfhfkG','sendTestNotification','User\x20disconnected\x20successfully','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','2285525rKrvGS','default','plisio','getBotStatus','lastName','shopId','telegramUser','__esModule','paid','test_payment_123','params','createdAt','345402pqyPGj','711657fkhOYU','Test\x20Product','sendCustomNotification','amount','Telegram\x20user\x20not\x20found','../config/database','firstName','currency','Message\x20is\x20required','payment','test_payout_123','all','\x20notification\x20sent\x20successfully','details','TelegramController','isVerified','This\x20is\x20a\x20test\x20notification','sendShopNotification','328HvkNHn','sendPayoutNotification','Test\x20Notification','desc','status','updatedAt','body','count','Shop\x20ID\x20is\x20required','isActive','productName','findMany','489843OBzmVm'];a12_0xd92e=function(){return _0x1049f7;};return a12_0xd92e();}exports[a12_0x3ff839(0x192)]=TelegramController;