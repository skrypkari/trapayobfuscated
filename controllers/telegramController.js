'use strict';const a14_0x398e4e=a14_0x3894;function a14_0x120e(){const _0x153d04=['lastName','status','details','isVerified','true','network','wallet','getBotInfo','isActive','update','USD','amount','Markdown','telegramId','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','findMany','User\x20disconnected\x20successfully','shop','sendPayoutNotification','21tFoBhA','Test\x20Product','custom','__esModule','This\x20is\x20a\x20test\x20notification','Shop\x20ID\x20is\x20required','Message\x20is\x20required','gateway','createdAt','126849cvqCSi','sendTestNotification','payment','4673268OKvLSu','getBotStatus','Broadcast\x20message\x20sent\x20successfully','payout','1555482VJxIlV','ceil','productName','../services/telegramBotService','map','plisio','1108499Fgpmyi','body','length','params','telegramUser','telegramBotService','sendShopNotification','defineProperty','shopId','desc','disconnectUser','1698dyeulN','username','2383408PBRmOk','default','TRC20','test_payout_123','findUnique','Shop\x20not\x20found','filter','query','Test\x20Notification','TelegramController','test_payment_123','count','13039614KVZJTx','all','../config/database','Тестовый\x20период','json','sendBroadcast','sendCustomNotification','19015BxTijk','txid'];a14_0x120e=function(){return _0x153d04;};return a14_0x120e();}(function(_0x1b42ae,_0x387fd8){const _0x1c40fb=a14_0x3894,_0x28cb50=_0x1b42ae();while(!![]){try{const _0x59d235=parseInt(_0x1c40fb(0x11a))/0x1+-parseInt(_0x1c40fb(0x15f))/0x2+-parseInt(_0x1c40fb(0x158))/0x3+-parseInt(_0x1c40fb(0x15b))/0x4+-parseInt(_0x1c40fb(0x13a))/0x5*(-parseInt(_0x1c40fb(0x125))/0x6)+parseInt(_0x1c40fb(0x14f))/0x7*(-parseInt(_0x1c40fb(0x127))/0x8)+parseInt(_0x1c40fb(0x133))/0x9;if(_0x59d235===_0x387fd8)break;else _0x28cb50['push'](_0x28cb50['shift']());}catch(_0x245043){_0x28cb50['push'](_0x28cb50['shift']());}}}(a14_0x120e,0xb7773));function a14_0x3894(_0x17cb1d,_0xf15968){const _0x120ed6=a14_0x120e();return a14_0x3894=function(_0x389460,_0x23ef28){_0x389460=_0x389460-0x117;let _0x165bb1=_0x120ed6[_0x389460];return _0x165bb1;},a14_0x3894(_0x17cb1d,_0xf15968);}var __importDefault=this&&this['__importDefault']||function(_0x3e107b){const _0x583c0a=a14_0x3894;return _0x3e107b&&_0x3e107b[_0x583c0a(0x152)]?_0x3e107b:{'default':_0x3e107b};};Object[a14_0x398e4e(0x121)](exports,a14_0x398e4e(0x152),{'value':!![]}),exports[a14_0x398e4e(0x130)]=void 0x0;const telegramBotService_1=require(a14_0x398e4e(0x117)),database_1=__importDefault(require(a14_0x398e4e(0x135)));class TelegramController{constructor(){const _0x27ff9c=a14_0x398e4e;this[_0x27ff9c(0x15c)]=async(_0x49e51a,_0x4d1376,_0x24f659)=>{const _0x565021=_0x27ff9c;try{const _0x3da4a8=telegramBotService_1[_0x565021(0x11f)][_0x565021(0x143)](),_0x378bf6=await database_1[_0x565021(0x128)][_0x565021(0x11e)][_0x565021(0x132)](),_0xf3c750=await database_1[_0x565021(0x128)]['telegramUser'][_0x565021(0x132)]({'where':{'isVerified':!![]}}),_0x117f48=await database_1[_0x565021(0x128)][_0x565021(0x11e)]['groupBy']({'by':[_0x565021(0x122)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4d1376[_0x565021(0x137)]({'success':!![],'result':{'bot':{'isActive':_0x3da4a8[_0x565021(0x144)],'username':_0x3da4a8['username']},'statistics':{'totalUsers':_0x378bf6,'verifiedUsers':_0xf3c750,'unverifiedUsers':_0x378bf6-_0xf3c750,'connectedShops':_0x117f48[_0x565021(0x11c)]}}});}catch(_0x30190b){_0x24f659(_0x30190b);}},this['getTelegramUsers']=async(_0x15fa22,_0x10f9b9,_0x2faca6)=>{const _0x439866=_0x27ff9c;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2949d9}=_0x15fa22[_0x439866(0x12e)],_0x1f8952=(Number(page)-0x1)*Number(limit),_0x5ff688={};_0x2949d9!==undefined&&(_0x5ff688[_0x439866(0x13f)]=_0x2949d9===_0x439866(0x140));const [_0x12d786,_0x49fad7]=await Promise[_0x439866(0x134)]([database_1['default']['telegramUser'][_0x439866(0x14b)]({'where':_0x5ff688,'skip':_0x1f8952,'take':Number(limit),'orderBy':{'createdAt':_0x439866(0x123)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x439866(0x11e)][_0x439866(0x132)]({'where':_0x5ff688})]);_0x10f9b9['json']({'success':!![],'users':_0x12d786[_0x439866(0x118)](_0x32b2e4=>({'id':_0x32b2e4['id'],'telegramId':_0x32b2e4[_0x439866(0x149)],'username':_0x32b2e4[_0x439866(0x126)],'firstName':_0x32b2e4['firstName'],'lastName':_0x32b2e4[_0x439866(0x13c)],'isVerified':_0x32b2e4[_0x439866(0x13f)],'shop':_0x32b2e4[_0x439866(0x14d)],'createdAt':_0x32b2e4[_0x439866(0x157)],'updatedAt':_0x32b2e4['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x49fad7,'totalPages':Math[_0x439866(0x160)](_0x49fad7/Number(limit))}});}catch(_0x3bbc65){_0x2faca6(_0x3bbc65);}},this[_0x27ff9c(0x138)]=async(_0x1f290f,_0x3de11e,_0x4a95d2)=>{const _0x336941=_0x27ff9c;try{const {message:_0x5d9602,shopId:_0x5803d7}=_0x1f290f[_0x336941(0x11b)];if(!_0x5d9602)return _0x3de11e['status'](0x190)[_0x336941(0x137)]({'success':![],'message':_0x336941(0x155)});if(_0x5803d7)await telegramBotService_1[_0x336941(0x11f)][_0x336941(0x120)](_0x5803d7,_0x5d9602,{'parse_mode':_0x336941(0x148)});else{const _0x23a37b=await database_1[_0x336941(0x128)][_0x336941(0x11e)][_0x336941(0x14b)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x19a049=[...new Set(_0x23a37b[_0x336941(0x118)](_0x2a6f22=>_0x2a6f22['shopId'])[_0x336941(0x12d)](Boolean))];for(const _0xfcc86c of _0x19a049){_0xfcc86c&&await telegramBotService_1['telegramBotService'][_0x336941(0x120)](_0xfcc86c,_0x5d9602,{'parse_mode':_0x336941(0x148)});}}_0x3de11e['json']({'success':!![],'message':_0x336941(0x15d)});}catch(_0x27300b){_0x4a95d2(_0x27300b);}},this[_0x27ff9c(0x124)]=async(_0x113982,_0x39df1a,_0x497948)=>{const _0x2b9037=_0x27ff9c;try{const {telegramId:_0x6ee8b5}=_0x113982[_0x2b9037(0x11d)],_0x3bc134=await database_1[_0x2b9037(0x128)][_0x2b9037(0x11e)][_0x2b9037(0x12b)]({'where':{'telegramId':_0x6ee8b5},'include':{'shop':!![]}});if(!_0x3bc134)return _0x39df1a['status'](0x194)[_0x2b9037(0x137)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x2b9037(0x128)][_0x2b9037(0x11e)][_0x2b9037(0x145)]({'where':{'telegramId':_0x6ee8b5},'data':{'shopId':null,'isVerified':![]}}),_0x39df1a[_0x2b9037(0x137)]({'success':!![],'message':_0x2b9037(0x14c)});}catch(_0x59f7e7){_0x497948(_0x59f7e7);}},this[_0x27ff9c(0x159)]=async(_0x8a1125,_0x5b79ea,_0x553d7d)=>{const _0x24af87=_0x27ff9c;try{const {shopId:_0xc7956a,type:type=_0x24af87(0x15a),testData:_0x42753d}=_0x8a1125[_0x24af87(0x11b)];if(!_0xc7956a)return _0x5b79ea['status'](0x190)[_0x24af87(0x137)]({'success':![],'message':_0x24af87(0x154)});const _0x476970=await database_1['default'][_0x24af87(0x14d)][_0x24af87(0x12b)]({'where':{'id':_0xc7956a},'select':{'id':!![],'name':!![]}});if(!_0x476970)return _0x5b79ea[_0x24af87(0x13d)](0x194)['json']({'success':![],'message':_0x24af87(0x12c)});switch(type){case'payment':const _0x2b4a07={'id':_0x24af87(0x131),'amount':_0x42753d?.[_0x24af87(0x147)]||0x64,'currency':_0x42753d?.['currency']||_0x24af87(0x146),'productName':_0x42753d?.[_0x24af87(0x161)]||_0x24af87(0x150),'gateway':_0x42753d?.[_0x24af87(0x156)]||_0x24af87(0x119),'createdAt':new Date(),..._0x42753d};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0xc7956a,_0x2b4a07,'paid');break;case _0x24af87(0x15e):const _0x3bf855={'id':_0x24af87(0x12a),'amount':_0x42753d?.[_0x24af87(0x147)]||0x1f4,'network':_0x42753d?.[_0x24af87(0x141)]||_0x24af87(0x129),'wallet':_0x42753d?.[_0x24af87(0x142)]||_0x24af87(0x14a),'period':_0x24af87(0x136),'createdAt':new Date(),'txid':_0x42753d?.[_0x24af87(0x13b)]||null,..._0x42753d};await telegramBotService_1[_0x24af87(0x11f)][_0x24af87(0x14e)](_0xc7956a,_0x3bf855);break;case _0x24af87(0x151):await telegramBotService_1[_0x24af87(0x11f)][_0x24af87(0x139)](_0xc7956a,_0x42753d?.['title']||_0x24af87(0x12f),_0x42753d?.[_0x24af87(0x13e)]||{'message':_0x24af87(0x153)});break;default:return _0x5b79ea['status'](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x5b79ea[_0x24af87(0x137)]({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x4d9cc7){_0x553d7d(_0x4d9cc7);}};}}exports['TelegramController']=TelegramController;