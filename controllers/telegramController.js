'use strict';const a17_0x3acca7=a17_0x1a58;(function(_0x2b98b8,_0x3824ad){const _0x145201=a17_0x1a58,_0xa8928b=_0x2b98b8();while(!![]){try{const _0x198617=parseInt(_0x145201(0xbb))/0x1*(parseInt(_0x145201(0xb0))/0x2)+-parseInt(_0x145201(0xab))/0x3*(parseInt(_0x145201(0xcc))/0x4)+parseInt(_0x145201(0xd1))/0x5+-parseInt(_0x145201(0xbd))/0x6+-parseInt(_0x145201(0xd8))/0x7*(parseInt(_0x145201(0xa3))/0x8)+-parseInt(_0x145201(0x9d))/0x9*(parseInt(_0x145201(0xa0))/0xa)+parseInt(_0x145201(0xcb))/0xb*(parseInt(_0x145201(0x9b))/0xc);if(_0x198617===_0x3824ad)break;else _0xa8928b['push'](_0xa8928b['shift']());}catch(_0x268853){_0xa8928b['push'](_0xa8928b['shift']());}}}(a17_0xd1e6,0x6a522));var __importDefault=this&&this['__importDefault']||function(_0x77107b){const _0x18c080=a17_0x1a58;return _0x77107b&&_0x77107b[_0x18c080(0xdf)]?_0x77107b:{'default':_0x77107b};};Object[a17_0x3acca7(0xd0)](exports,'__esModule',{'value':!![]}),exports[a17_0x3acca7(0xb5)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a17_0x3acca7(0x99)));function a17_0x1a58(_0x99d803,_0x54126e){_0x99d803=_0x99d803-0x97;const _0xd1e6cc=a17_0xd1e6();let _0x1a5898=_0xd1e6cc[_0x99d803];return _0x1a5898;}class TelegramController{constructor(){const _0xfd476c=a17_0x3acca7;this[_0xfd476c(0xa9)]=async(_0x1bb7ce,_0x26d125,_0x17d8ea)=>{const _0x3c83a0=_0xfd476c;try{const _0x545e23=telegramBotService_1[_0x3c83a0(0xb9)][_0x3c83a0(0xd5)](),_0x6dcf0d=await database_1[_0x3c83a0(0xac)][_0x3c83a0(0xd7)]['count'](),_0x5b6a00=await database_1[_0x3c83a0(0xac)]['telegramUser'][_0x3c83a0(0xad)]({'where':{'isVerified':!![]}}),_0x5ac98d=await database_1[_0x3c83a0(0xac)][_0x3c83a0(0xd7)][_0x3c83a0(0x9c)]({'by':[_0x3c83a0(0xc1)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x26d125[_0x3c83a0(0xc3)]({'success':!![],'result':{'bot':{'isActive':_0x545e23[_0x3c83a0(0xb6)],'username':_0x545e23[_0x3c83a0(0x98)]},'statistics':{'totalUsers':_0x6dcf0d,'verifiedUsers':_0x5b6a00,'unverifiedUsers':_0x6dcf0d-_0x5b6a00,'connectedShops':_0x5ac98d[_0x3c83a0(0xd3)]}}});}catch(_0x202194){_0x17d8ea(_0x202194);}},this['getTelegramUsers']=async(_0x3509a5,_0x419ce2,_0x55f597)=>{const _0x3cad86=_0xfd476c;try{const {page:page=0x1,limit:limit=0x14,verified:_0x51644f}=_0x3509a5[_0x3cad86(0xa5)],_0x43d215=(Number(page)-0x1)*Number(limit),_0x3c2756={};_0x51644f!==undefined&&(_0x3c2756['isVerified']=_0x51644f==='true');const [_0x549448,_0x27e174]=await Promise[_0x3cad86(0xba)]([database_1[_0x3cad86(0xac)][_0x3cad86(0xd7)][_0x3cad86(0xde)]({'where':_0x3c2756,'skip':_0x43d215,'take':Number(limit),'orderBy':{'createdAt':_0x3cad86(0xa1)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x3cad86(0xac)][_0x3cad86(0xd7)][_0x3cad86(0xad)]({'where':_0x3c2756})]);_0x419ce2[_0x3cad86(0xc3)]({'success':!![],'users':_0x549448[_0x3cad86(0x9e)](_0x302612=>({'id':_0x302612['id'],'telegramId':_0x302612[_0x3cad86(0xb4)],'username':_0x302612[_0x3cad86(0x98)],'firstName':_0x302612[_0x3cad86(0xc2)],'lastName':_0x302612[_0x3cad86(0xaf)],'isVerified':_0x302612[_0x3cad86(0xd6)],'shop':_0x302612[_0x3cad86(0xae)],'createdAt':_0x302612[_0x3cad86(0xd2)],'updatedAt':_0x302612[_0x3cad86(0xdb)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x27e174,'totalPages':Math['ceil'](_0x27e174/Number(limit))}});}catch(_0x3a1ea1){_0x55f597(_0x3a1ea1);}},this[_0xfd476c(0xb1)]=async(_0x16e85e,_0x12432f,_0x1666dd)=>{const _0x2eee20=_0xfd476c;try{const {message:_0x276e25,shopId:_0x300af3}=_0x16e85e[_0x2eee20(0x9a)];if(!_0x276e25)return _0x12432f[_0x2eee20(0xc0)](0x190)['json']({'success':![],'message':_0x2eee20(0xa7)});if(_0x300af3)await telegramBotService_1[_0x2eee20(0xb9)][_0x2eee20(0xca)](_0x300af3,_0x276e25,{'parse_mode':'Markdown'});else{const _0x719af7=await database_1[_0x2eee20(0xac)][_0x2eee20(0xd7)][_0x2eee20(0xde)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2eb2ae=[...new Set(_0x719af7[_0x2eee20(0x9e)](_0x364473=>_0x364473['shopId'])[_0x2eee20(0xd9)](Boolean))];for(const _0x5da677 of _0x2eb2ae){_0x5da677&&await telegramBotService_1[_0x2eee20(0xb9)]['sendShopNotification'](_0x5da677,_0x276e25,{'parse_mode':'Markdown'});}}_0x12432f['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x40dafc){_0x1666dd(_0x40dafc);}},this[_0xfd476c(0xc4)]=async(_0x3bce7d,_0x58be8d,_0x4fdd99)=>{const _0x451f0e=_0xfd476c;try{const {telegramId:_0x5c9183}=_0x3bce7d[_0x451f0e(0xb2)],_0x19d7e5=await database_1[_0x451f0e(0xac)]['telegramUser']['findUnique']({'where':{'telegramId':_0x5c9183},'include':{'shop':!![]}});if(!_0x19d7e5)return _0x58be8d[_0x451f0e(0xc0)](0x194)[_0x451f0e(0xc3)]({'success':![],'message':_0x451f0e(0xb8)});await database_1['default'][_0x451f0e(0xd7)]['update']({'where':{'telegramId':_0x5c9183},'data':{'shopId':null,'isVerified':![]}}),_0x58be8d[_0x451f0e(0xc3)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x13adcf){_0x4fdd99(_0x13adcf);}},this[_0xfd476c(0xdd)]=async(_0x20bfa2,_0x395b86,_0x44e6f)=>{const _0x3d3ee4=_0xfd476c;try{const {shopId:_0x585a1d,type:type=_0x3d3ee4(0xcd),testData:_0x4bbf96}=_0x20bfa2[_0x3d3ee4(0x9a)];if(!_0x585a1d)return _0x395b86[_0x3d3ee4(0xc0)](0x190)[_0x3d3ee4(0xc3)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x16400b=await database_1[_0x3d3ee4(0xac)][_0x3d3ee4(0xae)]['findUnique']({'where':{'id':_0x585a1d},'select':{'id':!![],'name':!![]}});if(!_0x16400b)return _0x395b86[_0x3d3ee4(0xc0)](0x194)[_0x3d3ee4(0xc3)]({'success':![],'message':_0x3d3ee4(0xd4)});switch(type){case'payment':const _0x40cf07={'id':_0x3d3ee4(0xda),'amount':_0x4bbf96?.[_0x3d3ee4(0xa8)]||0x64,'currency':_0x4bbf96?.[_0x3d3ee4(0x97)]||_0x3d3ee4(0xa4),'productName':_0x4bbf96?.['productName']||_0x3d3ee4(0xb7),'gateway':_0x4bbf96?.['gateway']||_0x3d3ee4(0xc6),'createdAt':new Date(),..._0x4bbf96};await telegramBotService_1['telegramBotService'][_0x3d3ee4(0xc7)](_0x585a1d,_0x40cf07,_0x3d3ee4(0xcf));break;case _0x3d3ee4(0xaa):const _0x5ec117={'id':_0x3d3ee4(0x9f),'amount':_0x4bbf96?.[_0x3d3ee4(0xa8)]||0x1f4,'network':_0x4bbf96?.['network']||_0x3d3ee4(0xbe),'wallet':_0x4bbf96?.[_0x3d3ee4(0xa6)]||'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','period':_0x3d3ee4(0xbf),'createdAt':new Date(),'txid':_0x4bbf96?.[_0x3d3ee4(0xdc)]||null,..._0x4bbf96};await telegramBotService_1[_0x3d3ee4(0xb9)]['sendPayoutNotification'](_0x585a1d,_0x5ec117);break;case _0x3d3ee4(0xc5):await telegramBotService_1[_0x3d3ee4(0xb9)][_0x3d3ee4(0xa2)](_0x585a1d,_0x4bbf96?.['title']||_0x3d3ee4(0xc9),_0x4bbf96?.[_0x3d3ee4(0xbc)]||{'message':_0x3d3ee4(0xc8)});break;default:return _0x395b86[_0x3d3ee4(0xc0)](0x190)[_0x3d3ee4(0xc3)]({'success':![],'message':_0x3d3ee4(0xb3)});}_0x395b86[_0x3d3ee4(0xc3)]({'success':!![],'message':_0x3d3ee4(0xce)+type+'\x20notification\x20sent\x20successfully'});}catch(_0xb708d4){_0x44e6f(_0xb708d4);}};}}exports[a17_0x3acca7(0xb5)]=TelegramController;function a17_0xd1e6(){const _0x25484a=['updatedAt','txid','sendTestNotification','findMany','__esModule','currency','username','../config/database','body','36jFFFYD','groupBy','36MNoZcG','map','test_payout_123','1466020DmFVoA','desc','sendCustomNotification','63272ZuTNcT','USD','query','wallet','Message\x20is\x20required','amount','getBotStatus','payout','51093JCDIAr','default','count','shop','lastName','243658CApNno','sendBroadcast','params','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','telegramId','TelegramController','isActive','Test\x20Product','Telegram\x20user\x20not\x20found','telegramBotService','all','3zfmwze','details','1998990ZNLHCv','TRC20','Тестовый\x20период','status','shopId','firstName','json','disconnectUser','custom','plisio','sendPaymentNotification','This\x20is\x20a\x20test\x20notification','Test\x20Notification','sendShopNotification','8122279mfISqI','140NzJMbI','payment','Test\x20','paid','defineProperty','1004695vDZtlr','createdAt','length','Shop\x20not\x20found','getBotInfo','isVerified','telegramUser','735MtmNsA','filter','test_payment_123'];a17_0xd1e6=function(){return _0x25484a;};return a17_0xd1e6();}