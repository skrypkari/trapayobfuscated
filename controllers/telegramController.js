'use strict';const a18_0x520ba4=a18_0xde47;(function(_0xd5c810,_0x22094d){const _0x419fba=a18_0xde47,_0x2b0f0b=_0xd5c810();while(!![]){try{const _0xed4906=-parseInt(_0x419fba(0x1f5))/0x1+-parseInt(_0x419fba(0x1f4))/0x2*(parseInt(_0x419fba(0x1c3))/0x3)+-parseInt(_0x419fba(0x1c4))/0x4+-parseInt(_0x419fba(0x1c9))/0x5*(parseInt(_0x419fba(0x1cc))/0x6)+parseInt(_0x419fba(0x1f0))/0x7*(parseInt(_0x419fba(0x1c8))/0x8)+parseInt(_0x419fba(0x1bf))/0x9*(-parseInt(_0x419fba(0x1c0))/0xa)+parseInt(_0x419fba(0x1db))/0xb*(parseInt(_0x419fba(0x1eb))/0xc);if(_0xed4906===_0x22094d)break;else _0x2b0f0b['push'](_0x2b0f0b['shift']());}catch(_0x35143d){_0x2b0f0b['push'](_0x2b0f0b['shift']());}}}(a18_0x31d8,0xd0bb5));function a18_0x31d8(){const _0x36c89e=['username','count','all','User\x20disconnected\x20successfully','../services/telegramBotService','Тестовый\x20период','query','TelegramController','shopId','3333epYfQg','sendCustomNotification','length','Markdown','details','lastName','Shop\x20not\x20found','__importDefault','update','amount','body','USD','telegramBotService','createdAt','Message\x20is\x20required','json','212568OmRypq','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','productName','gateway','Telegram\x20user\x20not\x20found','2044egyDoB','test_payout_123','getBotStatus','updatedAt','2938228LQPBWp','377986BEPTQH','sendTestNotification','firstName','isActive','isVerified','payment','filter','true','shop','../config/database','findUnique','This\x20is\x20a\x20test\x20notification','sendBroadcast','Test\x20','Shop\x20ID\x20is\x20required','status','currency','sendPaymentNotification','__esModule','Test\x20Product','defineProperty','map','plisio','122049ZXRSnD','1130yujBSs','desc','default','3kKqQYo','6750408RtcBfV','findMany','getTelegramUsers','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','25296ZPRBhC','90OCtubH','disconnectUser','Broadcast\x20message\x20sent\x20successfully','122862FVZSWm','telegramUser','wallet','sendShopNotification','getBotInfo','Test\x20Notification'];a18_0x31d8=function(){return _0x36c89e;};return a18_0x31d8();}var __importDefault=this&&this[a18_0x520ba4(0x1e2)]||function(_0x5e7977){const _0x2d1c58=a18_0x520ba4;return _0x5e7977&&_0x5e7977[_0x2d1c58(0x1ba)]?_0x5e7977:{'default':_0x5e7977};};Object[a18_0x520ba4(0x1bc)](exports,a18_0x520ba4(0x1ba),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a18_0x520ba4(0x1d6)),database_1=__importDefault(require(a18_0x520ba4(0x1fe)));function a18_0xde47(_0x57cc9b,_0x25ebcf){_0x57cc9b=_0x57cc9b-0x1ba;const _0x31d81b=a18_0x31d8();let _0xde47a2=_0x31d81b[_0x57cc9b];return _0xde47a2;}class TelegramController{constructor(){const _0x82f9cb=a18_0x520ba4;this[_0x82f9cb(0x1f2)]=async(_0x3245a4,_0x54fd50,_0x3a886f)=>{const _0x185b4a=_0x82f9cb;try{const _0x4685a9=telegramBotService_1[_0x185b4a(0x1e7)][_0x185b4a(0x1d0)](),_0x1a6f90=await database_1[_0x185b4a(0x1c2)][_0x185b4a(0x1cd)][_0x185b4a(0x1d3)](),_0x368936=await database_1['default'][_0x185b4a(0x1cd)][_0x185b4a(0x1d3)]({'where':{'isVerified':!![]}}),_0x471406=await database_1[_0x185b4a(0x1c2)][_0x185b4a(0x1cd)]['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x54fd50['json']({'success':!![],'result':{'bot':{'isActive':_0x4685a9[_0x185b4a(0x1f8)],'username':_0x4685a9[_0x185b4a(0x1d2)]},'statistics':{'totalUsers':_0x1a6f90,'verifiedUsers':_0x368936,'unverifiedUsers':_0x1a6f90-_0x368936,'connectedShops':_0x471406[_0x185b4a(0x1dd)]}}});}catch(_0x250184){_0x3a886f(_0x250184);}},this[_0x82f9cb(0x1c6)]=async(_0x2be75c,_0x45790c,_0x131ff1)=>{const _0x9e9fa7=_0x82f9cb;try{const {page:page=0x1,limit:limit=0x14,verified:_0x253334}=_0x2be75c[_0x9e9fa7(0x1d8)],_0x46aa5d=(Number(page)-0x1)*Number(limit),_0xfde5e7={};_0x253334!==undefined&&(_0xfde5e7[_0x9e9fa7(0x1f9)]=_0x253334===_0x9e9fa7(0x1fc));const [_0x5d94d5,_0x194726]=await Promise[_0x9e9fa7(0x1d4)]([database_1[_0x9e9fa7(0x1c2)]['telegramUser']['findMany']({'where':_0xfde5e7,'skip':_0x46aa5d,'take':Number(limit),'orderBy':{'createdAt':_0x9e9fa7(0x1c1)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x9e9fa7(0x1c2)][_0x9e9fa7(0x1cd)][_0x9e9fa7(0x1d3)]({'where':_0xfde5e7})]);_0x45790c[_0x9e9fa7(0x1ea)]({'success':!![],'users':_0x5d94d5[_0x9e9fa7(0x1bd)](_0x1f34d4=>({'id':_0x1f34d4['id'],'telegramId':_0x1f34d4['telegramId'],'username':_0x1f34d4[_0x9e9fa7(0x1d2)],'firstName':_0x1f34d4[_0x9e9fa7(0x1f7)],'lastName':_0x1f34d4[_0x9e9fa7(0x1e0)],'isVerified':_0x1f34d4['isVerified'],'shop':_0x1f34d4[_0x9e9fa7(0x1fd)],'createdAt':_0x1f34d4[_0x9e9fa7(0x1e8)],'updatedAt':_0x1f34d4[_0x9e9fa7(0x1f3)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x194726,'totalPages':Math['ceil'](_0x194726/Number(limit))}});}catch(_0x23e67d){_0x131ff1(_0x23e67d);}},this[_0x82f9cb(0x201)]=async(_0x321480,_0x420f5c,_0x190f13)=>{const _0x1ea4f1=_0x82f9cb;try{const {message:_0x47c116,shopId:_0x50d541}=_0x321480['body'];if(!_0x47c116)return _0x420f5c[_0x1ea4f1(0x204)](0x190)['json']({'success':![],'message':_0x1ea4f1(0x1e9)});if(_0x50d541)await telegramBotService_1[_0x1ea4f1(0x1e7)][_0x1ea4f1(0x1cf)](_0x50d541,_0x47c116,{'parse_mode':_0x1ea4f1(0x1de)});else{const _0x1ebd79=await database_1[_0x1ea4f1(0x1c2)][_0x1ea4f1(0x1cd)][_0x1ea4f1(0x1c5)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2ff414=[...new Set(_0x1ebd79['map'](_0x542499=>_0x542499[_0x1ea4f1(0x1da)])[_0x1ea4f1(0x1fb)](Boolean))];for(const _0x354324 of _0x2ff414){_0x354324&&await telegramBotService_1['telegramBotService'][_0x1ea4f1(0x1cf)](_0x354324,_0x47c116,{'parse_mode':_0x1ea4f1(0x1de)});}}_0x420f5c[_0x1ea4f1(0x1ea)]({'success':!![],'message':_0x1ea4f1(0x1cb)});}catch(_0x33f18b){_0x190f13(_0x33f18b);}},this[_0x82f9cb(0x1ca)]=async(_0x38bb01,_0x55f23c,_0x31285b)=>{const _0x481fc6=_0x82f9cb;try{const {telegramId:_0x498d21}=_0x38bb01['params'],_0xded2ef=await database_1[_0x481fc6(0x1c2)]['telegramUser'][_0x481fc6(0x1ff)]({'where':{'telegramId':_0x498d21},'include':{'shop':!![]}});if(!_0xded2ef)return _0x55f23c[_0x481fc6(0x204)](0x194)[_0x481fc6(0x1ea)]({'success':![],'message':_0x481fc6(0x1ef)});await database_1['default'][_0x481fc6(0x1cd)][_0x481fc6(0x1e3)]({'where':{'telegramId':_0x498d21},'data':{'shopId':null,'isVerified':![]}}),_0x55f23c['json']({'success':!![],'message':_0x481fc6(0x1d5)});}catch(_0x1de8ce){_0x31285b(_0x1de8ce);}},this[_0x82f9cb(0x1f6)]=async(_0x338d9a,_0x47e1d3,_0x25e61a)=>{const _0x4ca9a5=_0x82f9cb;try{const {shopId:_0x23b078,type:type=_0x4ca9a5(0x1fa),testData:_0x170c1e}=_0x338d9a[_0x4ca9a5(0x1e5)];if(!_0x23b078)return _0x47e1d3[_0x4ca9a5(0x204)](0x190)[_0x4ca9a5(0x1ea)]({'success':![],'message':_0x4ca9a5(0x203)});const _0x409b0e=await database_1['default'][_0x4ca9a5(0x1fd)][_0x4ca9a5(0x1ff)]({'where':{'id':_0x23b078},'select':{'id':!![],'name':!![]}});if(!_0x409b0e)return _0x47e1d3[_0x4ca9a5(0x204)](0x194)[_0x4ca9a5(0x1ea)]({'success':![],'message':_0x4ca9a5(0x1e1)});switch(type){case _0x4ca9a5(0x1fa):const _0xc8b272={'id':'test_payment_123','amount':_0x170c1e?.[_0x4ca9a5(0x1e4)]||0x64,'currency':_0x170c1e?.[_0x4ca9a5(0x205)]||_0x4ca9a5(0x1e6),'productName':_0x170c1e?.[_0x4ca9a5(0x1ed)]||_0x4ca9a5(0x1bb),'gateway':_0x170c1e?.[_0x4ca9a5(0x1ee)]||_0x4ca9a5(0x1be),'createdAt':new Date(),..._0x170c1e};await telegramBotService_1[_0x4ca9a5(0x1e7)][_0x4ca9a5(0x206)](_0x23b078,_0xc8b272,'paid');break;case'payout':const _0x4a2ce5={'id':_0x4ca9a5(0x1f1),'amount':_0x170c1e?.['amount']||0x1f4,'network':_0x170c1e?.['network']||'TRC20','wallet':_0x170c1e?.[_0x4ca9a5(0x1ce)]||_0x4ca9a5(0x1ec),'period':_0x4ca9a5(0x1d7),'createdAt':new Date(),'txid':_0x170c1e?.['txid']||null,..._0x170c1e};await telegramBotService_1[_0x4ca9a5(0x1e7)]['sendPayoutNotification'](_0x23b078,_0x4a2ce5);break;case'custom':await telegramBotService_1[_0x4ca9a5(0x1e7)][_0x4ca9a5(0x1dc)](_0x23b078,_0x170c1e?.['title']||_0x4ca9a5(0x1d1),_0x170c1e?.[_0x4ca9a5(0x1df)]||{'message':_0x4ca9a5(0x200)});break;default:return _0x47e1d3[_0x4ca9a5(0x204)](0x190)['json']({'success':![],'message':_0x4ca9a5(0x1c7)});}_0x47e1d3['json']({'success':!![],'message':_0x4ca9a5(0x202)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x49cab7){_0x25e61a(_0x49cab7);}};}}exports[a18_0x520ba4(0x1d9)]=TelegramController;