'use strict';const a12_0x305870=a12_0x8076;function a12_0x8076(_0x18d607,_0x5eda7e){const _0x28d2eb=a12_0x28d2();return a12_0x8076=function(_0x807675,_0xc47ba2){_0x807675=_0x807675-0x172;let _0x1c403b=_0x28d2eb[_0x807675];return _0x1c403b;},a12_0x8076(_0x18d607,_0x5eda7e);}(function(_0x5e34ed,_0xc6a619){const _0x4ed1a1=a12_0x8076,_0x3f9994=_0x5e34ed();while(!![]){try{const _0x30640f=-parseInt(_0x4ed1a1(0x1ab))/0x1+parseInt(_0x4ed1a1(0x18f))/0x2*(parseInt(_0x4ed1a1(0x1aa))/0x3)+parseInt(_0x4ed1a1(0x1b2))/0x4*(parseInt(_0x4ed1a1(0x1a3))/0x5)+parseInt(_0x4ed1a1(0x178))/0x6+parseInt(_0x4ed1a1(0x1b0))/0x7+-parseInt(_0x4ed1a1(0x192))/0x8+-parseInt(_0x4ed1a1(0x177))/0x9*(parseInt(_0x4ed1a1(0x190))/0xa);if(_0x30640f===_0xc6a619)break;else _0x3f9994['push'](_0x3f9994['shift']());}catch(_0x1df8d9){_0x3f9994['push'](_0x3f9994['shift']());}}}(a12_0x28d2,0xe17ee));var __importDefault=this&&this[a12_0x305870(0x19f)]||function(_0x240a8b){const _0x610b1e=a12_0x305870;return _0x240a8b&&_0x240a8b[_0x610b1e(0x1ac)]?_0x240a8b:{'default':_0x240a8b};};Object[a12_0x305870(0x175)](exports,'__esModule',{'value':!![]}),exports[a12_0x305870(0x1ad)]=void 0x0;const telegramBotService_1=require(a12_0x305870(0x188)),database_1=__importDefault(require(a12_0x305870(0x17a)));function a12_0x28d2(){const _0x597ade=['14tXOaQz','3651300sMfVdo','telegramUser','84568eaaoZF','amount','test_payout_123','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','updatedAt','body','params','shop','telegramBotService','bank_transfer','telegramId','Markdown','sendPayoutNotification','__importDefault','Test\x20','firstName','update','26295ciUeCc','title','all','lastName','username','sendPaymentNotification','shopId','24741cZObSK','1001614faVPXM','__esModule','TelegramController','custom','findUnique','5198109gvNgnZ','method','808UFnpdd','productName','default','sendShopNotification','User\x20disconnected\x20successfully','This\x20is\x20a\x20test\x20notification','defineProperty','groupBy','9TJTbMD','2629866PBORBf','filter','../config/database','payment','findMany','disconnectUser','isVerified','getBotStatus','sendBroadcast','completed','getTelegramUsers','query','Shop\x20ID\x20is\x20required','map','json','getBotInfo','../services/telegramBotService','isActive','status','true','Broadcast\x20message\x20sent\x20successfully','test_payment_123','count'];a12_0x28d2=function(){return _0x597ade;};return a12_0x28d2();}class TelegramController{constructor(){const _0x3103b9=a12_0x305870;this[_0x3103b9(0x17f)]=async(_0x2bd1ff,_0x4e664f,_0x40cc7d)=>{const _0xda6062=_0x3103b9;try{const _0x58090a=telegramBotService_1['telegramBotService'][_0xda6062(0x187)](),_0x34f2af=await database_1[_0xda6062(0x1b4)][_0xda6062(0x191)][_0xda6062(0x18e)](),_0x3a54e6=await database_1[_0xda6062(0x1b4)][_0xda6062(0x191)][_0xda6062(0x18e)]({'where':{'isVerified':!![]}}),_0x1d9da2=await database_1[_0xda6062(0x1b4)][_0xda6062(0x191)][_0xda6062(0x176)]({'by':[_0xda6062(0x1a9)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4e664f['json']({'success':!![],'result':{'bot':{'isActive':_0x58090a[_0xda6062(0x189)],'username':_0x58090a[_0xda6062(0x1a7)]},'statistics':{'totalUsers':_0x34f2af,'verifiedUsers':_0x3a54e6,'unverifiedUsers':_0x34f2af-_0x3a54e6,'connectedShops':_0x1d9da2['length']}}});}catch(_0x5933af){_0x40cc7d(_0x5933af);}},this[_0x3103b9(0x182)]=async(_0x45108f,_0x4c82be,_0xcf170d)=>{const _0x48ef7a=_0x3103b9;try{const {page:page=0x1,limit:limit=0x14,verified:_0x31181d}=_0x45108f[_0x48ef7a(0x183)],_0x3e9b27=(Number(page)-0x1)*Number(limit),_0x506a86={};_0x31181d!==undefined&&(_0x506a86[_0x48ef7a(0x17e)]=_0x31181d===_0x48ef7a(0x18b));const [_0x3144f6,_0x28fef1]=await Promise[_0x48ef7a(0x1a5)]([database_1[_0x48ef7a(0x1b4)][_0x48ef7a(0x191)][_0x48ef7a(0x17c)]({'where':_0x506a86,'skip':_0x3e9b27,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x48ef7a(0x1b4)][_0x48ef7a(0x191)]['count']({'where':_0x506a86})]);_0x4c82be[_0x48ef7a(0x186)]({'success':!![],'users':_0x3144f6[_0x48ef7a(0x185)](_0x5e699a=>({'id':_0x5e699a['id'],'telegramId':_0x5e699a[_0x48ef7a(0x19c)],'username':_0x5e699a['username'],'firstName':_0x5e699a[_0x48ef7a(0x1a1)],'lastName':_0x5e699a[_0x48ef7a(0x1a6)],'isVerified':_0x5e699a['isVerified'],'shop':_0x5e699a[_0x48ef7a(0x199)],'createdAt':_0x5e699a['createdAt'],'updatedAt':_0x5e699a[_0x48ef7a(0x196)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x28fef1,'totalPages':Math['ceil'](_0x28fef1/Number(limit))}});}catch(_0xd79e49){_0xcf170d(_0xd79e49);}},this[_0x3103b9(0x180)]=async(_0x47cb86,_0x1424a7,_0x263cd0)=>{const _0x3c4da9=_0x3103b9;try{const {message:_0x51577b,shopId:_0x4e2be2}=_0x47cb86['body'];if(!_0x51577b)return _0x1424a7[_0x3c4da9(0x18a)](0x190)[_0x3c4da9(0x186)]({'success':![],'message':'Message\x20is\x20required'});if(_0x4e2be2)await telegramBotService_1[_0x3c4da9(0x19a)][_0x3c4da9(0x172)](_0x4e2be2,_0x51577b,{'parse_mode':_0x3c4da9(0x19d)});else{const _0x30b675=await database_1['default']['telegramUser'][_0x3c4da9(0x17c)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2f9b8b=[...new Set(_0x30b675[_0x3c4da9(0x185)](_0x4a2e2b=>_0x4a2e2b[_0x3c4da9(0x1a9)])[_0x3c4da9(0x179)](Boolean))];for(const _0x246efb of _0x2f9b8b){_0x246efb&&await telegramBotService_1[_0x3c4da9(0x19a)][_0x3c4da9(0x172)](_0x246efb,_0x51577b,{'parse_mode':_0x3c4da9(0x19d)});}}_0x1424a7[_0x3c4da9(0x186)]({'success':!![],'message':_0x3c4da9(0x18c)});}catch(_0x56375e){_0x263cd0(_0x56375e);}},this[_0x3103b9(0x17d)]=async(_0x5221a6,_0x315ab0,_0x233d7a)=>{const _0x4da612=_0x3103b9;try{const {telegramId:_0x3de77f}=_0x5221a6[_0x4da612(0x198)],_0xa7870f=await database_1[_0x4da612(0x1b4)]['telegramUser'][_0x4da612(0x1af)]({'where':{'telegramId':_0x3de77f},'include':{'shop':!![]}});if(!_0xa7870f)return _0x315ab0[_0x4da612(0x18a)](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x4da612(0x1b4)][_0x4da612(0x191)][_0x4da612(0x1a2)]({'where':{'telegramId':_0x3de77f},'data':{'shopId':null,'isVerified':![]}}),_0x315ab0[_0x4da612(0x186)]({'success':!![],'message':_0x4da612(0x173)});}catch(_0x54c19){_0x233d7a(_0x54c19);}},this['sendTestNotification']=async(_0x5ae9d8,_0x2b8c7f,_0xe61302)=>{const _0x469532=_0x3103b9;try{const {shopId:_0x28e983,type:type=_0x469532(0x17b),testData:_0x235f6a}=_0x5ae9d8[_0x469532(0x197)];if(!_0x28e983)return _0x2b8c7f[_0x469532(0x18a)](0x190)['json']({'success':![],'message':_0x469532(0x184)});const _0x3b4627=await database_1[_0x469532(0x1b4)][_0x469532(0x199)]['findUnique']({'where':{'id':_0x28e983},'select':{'id':!![],'name':!![]}});if(!_0x3b4627)return _0x2b8c7f[_0x469532(0x18a)](0x194)[_0x469532(0x186)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x469532(0x17b):const _0x5d05d5={'id':_0x469532(0x18d),'amount':_0x235f6a?.[_0x469532(0x193)]||0x64,'currency':_0x235f6a?.['currency']||'USD','productName':_0x235f6a?.[_0x469532(0x1b3)]||'Test\x20Product','gateway':_0x235f6a?.['gateway']||'plisio','createdAt':new Date(),..._0x235f6a};await telegramBotService_1[_0x469532(0x19a)][_0x469532(0x1a8)](_0x28e983,_0x5d05d5,'paid');break;case'payout':const _0x20efbd={'id':_0x469532(0x194),'amount':_0x235f6a?.[_0x469532(0x193)]||0x1f4,'method':_0x235f6a?.[_0x469532(0x1b1)]||_0x469532(0x19b),'createdAt':new Date(),..._0x235f6a};await telegramBotService_1[_0x469532(0x19a)][_0x469532(0x19e)](_0x28e983,_0x20efbd,_0x469532(0x181));break;case _0x469532(0x1ae):await telegramBotService_1[_0x469532(0x19a)]['sendCustomNotification'](_0x28e983,_0x235f6a?.[_0x469532(0x1a4)]||'Test\x20Notification',_0x235f6a?.['details']||{'message':_0x469532(0x174)});break;default:return _0x2b8c7f[_0x469532(0x18a)](0x190)[_0x469532(0x186)]({'success':![],'message':_0x469532(0x195)});}_0x2b8c7f['json']({'success':!![],'message':_0x469532(0x1a0)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x5dd9fd){_0xe61302(_0x5dd9fd);}};}}exports[a12_0x305870(0x1ad)]=TelegramController;