'use strict';function a12_0xd919(_0x4ce0b4,_0x419939){const _0x45d822=a12_0x45d8();return a12_0xd919=function(_0xd919ce,_0x2ca7a9){_0xd919ce=_0xd919ce-0x160;let _0x37e790=_0x45d822[_0xd919ce];return _0x37e790;},a12_0xd919(_0x4ce0b4,_0x419939);}const a12_0xea7d5=a12_0xd919;(function(_0x30a1e0,_0x2cbd62){const _0x2e5043=a12_0xd919,_0x52eebb=_0x30a1e0();while(!![]){try{const _0x4acf2b=-parseInt(_0x2e5043(0x175))/0x1*(parseInt(_0x2e5043(0x172))/0x2)+parseInt(_0x2e5043(0x174))/0x3+parseInt(_0x2e5043(0x17c))/0x4+parseInt(_0x2e5043(0x187))/0x5+parseInt(_0x2e5043(0x163))/0x6*(parseInt(_0x2e5043(0x16f))/0x7)+-parseInt(_0x2e5043(0x165))/0x8+parseInt(_0x2e5043(0x160))/0x9;if(_0x4acf2b===_0x2cbd62)break;else _0x52eebb['push'](_0x52eebb['shift']());}catch(_0x5b402f){_0x52eebb['push'](_0x52eebb['shift']());}}}(a12_0x45d8,0x49e8e));var __importDefault=this&&this[a12_0xea7d5(0x180)]||function(_0x172834){const _0x176629=a12_0xea7d5;return _0x172834&&_0x172834[_0x176629(0x17a)]?_0x172834:{'default':_0x172834};};Object[a12_0xea7d5(0x19d)](exports,a12_0xea7d5(0x17a),{'value':!![]}),exports[a12_0xea7d5(0x173)]=void 0x0;const telegramBotService_1=require(a12_0xea7d5(0x177)),database_1=__importDefault(require(a12_0xea7d5(0x194)));class TelegramController{constructor(){const _0x44699c=a12_0xea7d5;this[_0x44699c(0x178)]=async(_0x5ea4ed,_0x511e77,_0x3a7875)=>{const _0x558f86=_0x44699c;try{const _0x2db710=telegramBotService_1['telegramBotService'][_0x558f86(0x190)](),_0x5d2442=await database_1[_0x558f86(0x183)]['telegramUser'][_0x558f86(0x16e)](),_0x27ec90=await database_1['default'][_0x558f86(0x191)][_0x558f86(0x16e)]({'where':{'isVerified':!![]}}),_0x41bf20=await database_1['default'][_0x558f86(0x191)][_0x558f86(0x197)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x511e77[_0x558f86(0x199)]({'success':!![],'result':{'bot':{'isActive':_0x2db710[_0x558f86(0x179)],'username':_0x2db710[_0x558f86(0x192)]},'statistics':{'totalUsers':_0x5d2442,'verifiedUsers':_0x27ec90,'unverifiedUsers':_0x5d2442-_0x27ec90,'connectedShops':_0x41bf20[_0x558f86(0x1a1)]}}});}catch(_0x16ea1b){_0x3a7875(_0x16ea1b);}},this['getTelegramUsers']=async(_0x5e40c0,_0x38237e,_0x213153)=>{const _0x26f1c7=_0x44699c;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4aa3b3}=_0x5e40c0[_0x26f1c7(0x162)],_0x1a6e9e=(Number(page)-0x1)*Number(limit),_0x17653d={};_0x4aa3b3!==undefined&&(_0x17653d[_0x26f1c7(0x19b)]=_0x4aa3b3==='true');const [_0x4a8c1b,_0x3a3480]=await Promise[_0x26f1c7(0x18f)]([database_1[_0x26f1c7(0x183)][_0x26f1c7(0x191)][_0x26f1c7(0x16a)]({'where':_0x17653d,'skip':_0x1a6e9e,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x26f1c7(0x183)][_0x26f1c7(0x191)]['count']({'where':_0x17653d})]);_0x38237e['json']({'success':!![],'users':_0x4a8c1b[_0x26f1c7(0x198)](_0x1c10fc=>({'id':_0x1c10fc['id'],'telegramId':_0x1c10fc['telegramId'],'username':_0x1c10fc[_0x26f1c7(0x192)],'firstName':_0x1c10fc['firstName'],'lastName':_0x1c10fc[_0x26f1c7(0x16b)],'isVerified':_0x1c10fc['isVerified'],'shop':_0x1c10fc[_0x26f1c7(0x16c)],'createdAt':_0x1c10fc['createdAt'],'updatedAt':_0x1c10fc[_0x26f1c7(0x182)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3a3480,'totalPages':Math[_0x26f1c7(0x170)](_0x3a3480/Number(limit))}});}catch(_0x2b4504){_0x213153(_0x2b4504);}},this[_0x44699c(0x186)]=async(_0x484015,_0x1516be,_0x662b8a)=>{const _0x3c4861=_0x44699c;try{const {message:_0x553982,shopId:_0x1efc1b}=_0x484015['body'];if(!_0x553982)return _0x1516be[_0x3c4861(0x18a)](0x190)[_0x3c4861(0x199)]({'success':![],'message':_0x3c4861(0x18c)});if(_0x1efc1b)await telegramBotService_1[_0x3c4861(0x169)][_0x3c4861(0x19a)](_0x1efc1b,_0x553982,{'parse_mode':'Markdown'});else{const _0x5e7646=await database_1[_0x3c4861(0x183)][_0x3c4861(0x191)][_0x3c4861(0x16a)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x28f14f=[...new Set(_0x5e7646[_0x3c4861(0x198)](_0x588143=>_0x588143[_0x3c4861(0x195)])[_0x3c4861(0x17f)](Boolean))];for(const _0x316ece of _0x28f14f){_0x316ece&&await telegramBotService_1[_0x3c4861(0x169)][_0x3c4861(0x19a)](_0x316ece,_0x553982,{'parse_mode':_0x3c4861(0x19f)});}}_0x1516be[_0x3c4861(0x199)]({'success':!![],'message':_0x3c4861(0x164)});}catch(_0x1ef6c4){_0x662b8a(_0x1ef6c4);}},this[_0x44699c(0x19c)]=async(_0x495a32,_0x1d9d67,_0x3e15d3)=>{const _0x5d9230=_0x44699c;try{const {telegramId:_0x3b0a0c}=_0x495a32[_0x5d9230(0x185)],_0x34692d=await database_1['default'][_0x5d9230(0x191)]['findUnique']({'where':{'telegramId':_0x3b0a0c},'include':{'shop':!![]}});if(!_0x34692d)return _0x1d9d67['status'](0x194)[_0x5d9230(0x199)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x5d9230(0x183)][_0x5d9230(0x191)]['update']({'where':{'telegramId':_0x3b0a0c},'data':{'shopId':null,'isVerified':![]}}),_0x1d9d67['json']({'success':!![],'message':_0x5d9230(0x161)});}catch(_0x3e19f4){_0x3e15d3(_0x3e19f4);}},this[_0x44699c(0x184)]=async(_0x5cf5b3,_0x301d58,_0x1d486b)=>{const _0x4c7906=_0x44699c;try{const {shopId:_0x365363,type:type=_0x4c7906(0x1a0),testData:_0x4812a4}=_0x5cf5b3[_0x4c7906(0x17b)];if(!_0x365363)return _0x301d58['status'](0x190)[_0x4c7906(0x199)]({'success':![],'message':_0x4c7906(0x18d)});const _0x1fccce=await database_1[_0x4c7906(0x183)]['shop'][_0x4c7906(0x181)]({'where':{'id':_0x365363},'select':{'id':!![],'name':!![]}});if(!_0x1fccce)return _0x301d58[_0x4c7906(0x18a)](0x194)[_0x4c7906(0x199)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x4c7906(0x1a0):const _0x522156={'id':_0x4c7906(0x17d),'amount':_0x4812a4?.['amount']||0x64,'currency':_0x4812a4?.['currency']||_0x4c7906(0x18e),'productName':_0x4812a4?.[_0x4c7906(0x16d)]||'Test\x20Product','gateway':_0x4812a4?.['gateway']||_0x4c7906(0x171),'createdAt':new Date(),..._0x4812a4};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x365363,_0x522156,_0x4c7906(0x19e));break;case _0x4c7906(0x196):const _0x29b62d={'id':_0x4c7906(0x166),'amount':_0x4812a4?.[_0x4c7906(0x189)]||0x1f4,'method':_0x4812a4?.[_0x4c7906(0x193)]||_0x4c7906(0x17e),'createdAt':new Date(),..._0x4812a4};await telegramBotService_1[_0x4c7906(0x169)]['sendPayoutNotification'](_0x365363,_0x29b62d,'completed');break;case _0x4c7906(0x176):await telegramBotService_1[_0x4c7906(0x169)]['sendCustomNotification'](_0x365363,_0x4812a4?.['title']||_0x4c7906(0x1a2),_0x4812a4?.[_0x4c7906(0x18b)]||{'message':_0x4c7906(0x168)});break;default:return _0x301d58['status'](0x190)[_0x4c7906(0x199)]({'success':![],'message':_0x4c7906(0x167)});}_0x301d58['json']({'success':!![],'message':_0x4c7906(0x188)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x421bdf){_0x1d486b(_0x421bdf);}};}}function a12_0x45d8(){const _0x28ba38=['groupBy','map','json','sendShopNotification','isVerified','disconnectUser','defineProperty','paid','Markdown','payment','length','Test\x20Notification','3811950dSnKaK','User\x20disconnected\x20successfully','query','6faTHBq','Broadcast\x20message\x20sent\x20successfully','3786088rmrWiv','test_payout_123','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','This\x20is\x20a\x20test\x20notification','telegramBotService','findMany','lastName','shop','productName','count','871003tbwrSp','ceil','plisio','1038014ENMyXi','TelegramController','461766Hjsbvr','1BcoovJ','custom','../services/telegramBotService','getBotStatus','isActive','__esModule','body','790168ZciPyE','test_payment_123','bank_transfer','filter','__importDefault','findUnique','updatedAt','default','sendTestNotification','params','sendBroadcast','1977795TyfFky','Test\x20','amount','status','details','Message\x20is\x20required','Shop\x20ID\x20is\x20required','USD','all','getBotInfo','telegramUser','username','method','../config/database','shopId','payout'];a12_0x45d8=function(){return _0x28ba38;};return a12_0x45d8();}exports[a12_0xea7d5(0x173)]=TelegramController;