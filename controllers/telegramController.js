'use strict';const a12_0x530dab=a12_0x2c43;(function(_0x43a4e3,_0x13166d){const _0xac5559=a12_0x2c43,_0x121bc0=_0x43a4e3();while(!![]){try{const _0x52bbbb=-parseInt(_0xac5559(0x1ac))/0x1*(parseInt(_0xac5559(0x1aa))/0x2)+-parseInt(_0xac5559(0x19e))/0x3+-parseInt(_0xac5559(0x1b0))/0x4*(parseInt(_0xac5559(0x1a0))/0x5)+-parseInt(_0xac5559(0x1af))/0x6+-parseInt(_0xac5559(0x189))/0x7+parseInt(_0xac5559(0x19f))/0x8+parseInt(_0xac5559(0x1c6))/0x9*(parseInt(_0xac5559(0x1ca))/0xa);if(_0x52bbbb===_0x13166d)break;else _0x121bc0['push'](_0x121bc0['shift']());}catch(_0x409aa6){_0x121bc0['push'](_0x121bc0['shift']());}}}(a12_0x3c86,0xea19a));function a12_0x2c43(_0x2ece1b,_0x28bdd4){const _0x3c86c1=a12_0x3c86();return a12_0x2c43=function(_0x2c43ba,_0xeae714){_0x2c43ba=_0x2c43ba-0x184;let _0x1a1808=_0x3c86c1[_0x2c43ba];return _0x1a1808;},a12_0x2c43(_0x2ece1b,_0x28bdd4);}var __importDefault=this&&this[a12_0x530dab(0x19b)]||function(_0x1efdb6){return _0x1efdb6&&_0x1efdb6['__esModule']?_0x1efdb6:{'default':_0x1efdb6};};Object[a12_0x530dab(0x18c)](exports,a12_0x530dab(0x1b9),{'value':!![]}),exports[a12_0x530dab(0x1b3)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x539b17=a12_0x530dab;this[_0x539b17(0x1b1)]=async(_0x5adc7b,_0x277da0,_0xc8c369)=>{const _0xb902a1=_0x539b17;try{const _0x2b5848=telegramBotService_1['telegramBotService'][_0xb902a1(0x192)](),_0x21ac88=await database_1['default'][_0xb902a1(0x1bd)][_0xb902a1(0x1ae)](),_0x42c7fa=await database_1[_0xb902a1(0x18a)][_0xb902a1(0x1bd)][_0xb902a1(0x1ae)]({'where':{'isVerified':!![]}}),_0x4547a0=await database_1['default']['telegramUser'][_0xb902a1(0x1b5)]({'by':[_0xb902a1(0x197)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x277da0[_0xb902a1(0x1bb)]({'success':!![],'result':{'bot':{'isActive':_0x2b5848[_0xb902a1(0x1a9)],'username':_0x2b5848['username']},'statistics':{'totalUsers':_0x21ac88,'verifiedUsers':_0x42c7fa,'unverifiedUsers':_0x21ac88-_0x42c7fa,'connectedShops':_0x4547a0[_0xb902a1(0x1a8)]}}});}catch(_0x16e456){_0xc8c369(_0x16e456);}},this[_0x539b17(0x1b8)]=async(_0x589cf4,_0x5f14df,_0x1cf75b)=>{const _0x1d17a1=_0x539b17;try{const {page:page=0x1,limit:limit=0x14,verified:_0x25d2c1}=_0x589cf4[_0x1d17a1(0x1bc)],_0x117ad6=(Number(page)-0x1)*Number(limit),_0x5987e1={};_0x25d2c1!==undefined&&(_0x5987e1[_0x1d17a1(0x198)]=_0x25d2c1===_0x1d17a1(0x19c));const [_0x20c728,_0x1f0af9]=await Promise['all']([database_1[_0x1d17a1(0x18a)]['telegramUser'][_0x1d17a1(0x1a1)]({'where':_0x5987e1,'skip':_0x117ad6,'take':Number(limit),'orderBy':{'createdAt':_0x1d17a1(0x1be)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1d17a1(0x18a)][_0x1d17a1(0x1bd)][_0x1d17a1(0x1ae)]({'where':_0x5987e1})]);_0x5f14df[_0x1d17a1(0x1bb)]({'success':!![],'users':_0x20c728[_0x1d17a1(0x1a7)](_0x30619c=>({'id':_0x30619c['id'],'telegramId':_0x30619c['telegramId'],'username':_0x30619c['username'],'firstName':_0x30619c['firstName'],'lastName':_0x30619c[_0x1d17a1(0x1c4)],'isVerified':_0x30619c[_0x1d17a1(0x198)],'shop':_0x30619c[_0x1d17a1(0x1c0)],'createdAt':_0x30619c[_0x1d17a1(0x184)],'updatedAt':_0x30619c['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1f0af9,'totalPages':Math[_0x1d17a1(0x190)](_0x1f0af9/Number(limit))}});}catch(_0x1e062e){_0x1cf75b(_0x1e062e);}},this[_0x539b17(0x1c7)]=async(_0x246d68,_0x12804f,_0x392331)=>{const _0x3a77fc=_0x539b17;try{const {message:_0x64bc6f,shopId:_0x548f54}=_0x246d68[_0x3a77fc(0x1bf)];if(!_0x64bc6f)return _0x12804f[_0x3a77fc(0x1c2)](0x190)[_0x3a77fc(0x1bb)]({'success':![],'message':_0x3a77fc(0x1ab)});if(_0x548f54)await telegramBotService_1[_0x3a77fc(0x185)][_0x3a77fc(0x1c5)](_0x548f54,_0x64bc6f,{'parse_mode':'Markdown'});else{const _0x448247=await database_1[_0x3a77fc(0x18a)][_0x3a77fc(0x1bd)][_0x3a77fc(0x1a1)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5eb9ff=[...new Set(_0x448247[_0x3a77fc(0x1a7)](_0x2761ba=>_0x2761ba[_0x3a77fc(0x197)])[_0x3a77fc(0x18b)](Boolean))];for(const _0x498221 of _0x5eb9ff){_0x498221&&await telegramBotService_1['telegramBotService'][_0x3a77fc(0x1c5)](_0x498221,_0x64bc6f,{'parse_mode':_0x3a77fc(0x1a2)});}}_0x12804f[_0x3a77fc(0x1bb)]({'success':!![],'message':_0x3a77fc(0x18e)});}catch(_0xb93840){_0x392331(_0xb93840);}},this[_0x539b17(0x1a5)]=async(_0x4b660e,_0x4cec23,_0x5132c8)=>{const _0x55bdca=_0x539b17;try{const {telegramId:_0xfb52c8}=_0x4b660e[_0x55bdca(0x1ba)],_0x34d81e=await database_1[_0x55bdca(0x18a)][_0x55bdca(0x1bd)]['findUnique']({'where':{'telegramId':_0xfb52c8},'include':{'shop':!![]}});if(!_0x34d81e)return _0x4cec23[_0x55bdca(0x1c2)](0x194)[_0x55bdca(0x1bb)]({'success':![],'message':_0x55bdca(0x187)});await database_1['default']['telegramUser']['update']({'where':{'telegramId':_0xfb52c8},'data':{'shopId':null,'isVerified':![]}}),_0x4cec23[_0x55bdca(0x1bb)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x5cd8f0){_0x5132c8(_0x5cd8f0);}},this[_0x539b17(0x194)]=async(_0x31f0cf,_0x3a0d50,_0x48f036)=>{const _0x467a5e=_0x539b17;try{const {shopId:_0x510b31,type:type=_0x467a5e(0x186),testData:_0x92e7e6}=_0x31f0cf['body'];if(!_0x510b31)return _0x3a0d50['status'](0x190)['json']({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x12bd44=await database_1[_0x467a5e(0x18a)][_0x467a5e(0x1c0)]['findUnique']({'where':{'id':_0x510b31},'select':{'id':!![],'name':!![]}});if(!_0x12bd44)return _0x3a0d50[_0x467a5e(0x1c2)](0x194)[_0x467a5e(0x1bb)]({'success':![],'message':_0x467a5e(0x196)});switch(type){case _0x467a5e(0x186):const _0x1b9f1b={'id':_0x467a5e(0x18f),'amount':_0x92e7e6?.[_0x467a5e(0x1c1)]||0x64,'currency':_0x92e7e6?.[_0x467a5e(0x1c3)]||'USD','productName':_0x92e7e6?.[_0x467a5e(0x1c8)]||'Test\x20Product','gateway':_0x92e7e6?.[_0x467a5e(0x1b6)]||_0x467a5e(0x1a4),'createdAt':new Date(),..._0x92e7e6};await telegramBotService_1[_0x467a5e(0x185)][_0x467a5e(0x18d)](_0x510b31,_0x1b9f1b,_0x467a5e(0x199));break;case'payout':const _0x2748a7={'id':_0x467a5e(0x1c9),'amount':_0x92e7e6?.['amount']||0x1f4,'method':_0x92e7e6?.['method']||_0x467a5e(0x188),'createdAt':new Date(),..._0x92e7e6};await telegramBotService_1[_0x467a5e(0x185)][_0x467a5e(0x1b2)](_0x510b31,_0x2748a7,_0x467a5e(0x1b7));break;case _0x467a5e(0x1ad):await telegramBotService_1[_0x467a5e(0x185)][_0x467a5e(0x195)](_0x510b31,_0x92e7e6?.[_0x467a5e(0x1a3)]||_0x467a5e(0x1a6),_0x92e7e6?.[_0x467a5e(0x1b4)]||{'message':_0x467a5e(0x193)});break;default:return _0x3a0d50[_0x467a5e(0x1c2)](0x190)[_0x467a5e(0x1bb)]({'success':![],'message':_0x467a5e(0x19d)});}_0x3a0d50['json']({'success':!![],'message':_0x467a5e(0x19a)+type+_0x467a5e(0x191)});}catch(_0x413243){_0x48f036(_0x413243);}};}}exports[a12_0x530dab(0x1b3)]=TelegramController;function a12_0x3c86(){const _0xfd8353=['title','plisio','disconnectUser','Test\x20Notification','map','length','isActive','2IXGOuk','Message\x20is\x20required','1316621yrmokH','custom','count','7252302UYcteM','123284WZyMPk','getBotStatus','sendPayoutNotification','TelegramController','details','groupBy','gateway','completed','getTelegramUsers','__esModule','params','json','query','telegramUser','desc','body','shop','amount','status','currency','lastName','sendShopNotification','1359ZePlaa','sendBroadcast','productName','test_payout_123','408120vIlWuN','createdAt','telegramBotService','payment','Telegram\x20user\x20not\x20found','bank_transfer','10584028DfyBLJ','default','filter','defineProperty','sendPaymentNotification','Broadcast\x20message\x20sent\x20successfully','test_payment_123','ceil','\x20notification\x20sent\x20successfully','getBotInfo','This\x20is\x20a\x20test\x20notification','sendTestNotification','sendCustomNotification','Shop\x20not\x20found','shopId','isVerified','paid','Test\x20','__importDefault','true','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','2627091vSMxKj','2359200LKUFVN','95rnSRWu','findMany','Markdown'];a12_0x3c86=function(){return _0xfd8353;};return a12_0x3c86();}