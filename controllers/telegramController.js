'use strict';const a20_0xbd6078=a20_0x4073;(function(_0x500412,_0x24cc2f){const _0x1833ec=a20_0x4073,_0x671edf=_0x500412();while(!![]){try{const _0x5b0c1a=-parseInt(_0x1833ec(0x1b1))/0x1*(parseInt(_0x1833ec(0x174))/0x2)+parseInt(_0x1833ec(0x1ad))/0x3*(parseInt(_0x1833ec(0x1b0))/0x4)+parseInt(_0x1833ec(0x1bc))/0x5*(parseInt(_0x1833ec(0x19b))/0x6)+parseInt(_0x1833ec(0x19c))/0x7+parseInt(_0x1833ec(0x176))/0x8+parseInt(_0x1833ec(0x1a2))/0x9+parseInt(_0x1833ec(0x1b6))/0xa*(-parseInt(_0x1833ec(0x18f))/0xb);if(_0x5b0c1a===_0x24cc2f)break;else _0x671edf['push'](_0x671edf['shift']());}catch(_0x132c02){_0x671edf['push'](_0x671edf['shift']());}}}(a20_0x3294,0x4854b));var __importDefault=this&&this[a20_0xbd6078(0x1ac)]||function(_0x2ced82){const _0x1db893=a20_0xbd6078;return _0x2ced82&&_0x2ced82[_0x1db893(0x179)]?_0x2ced82:{'default':_0x2ced82};};Object[a20_0xbd6078(0x193)](exports,a20_0xbd6078(0x179),{'value':!![]}),exports[a20_0xbd6078(0x188)]=void 0x0;function a20_0x3294(){const _0x5b5496=['updatedAt','payment','paid','findUnique','groupBy','sendBroadcast','__importDefault','9gabIjK','json','getBotInfo','12044noLtLi','106231kloDbN','Message\x20is\x20required','TRC20','filter','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','40cQKciq','User\x20disconnected\x20successfully','USD','Telegram\x20user\x20not\x20found','telegramBotService','network','195955vgxZoW','plisio','default','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','createdAt','10rxGrHy','custom','535208GGrEsh','\x20notification\x20sent\x20successfully','map','__esModule','telegramId','payout','getBotStatus','Shop\x20ID\x20is\x20required','query','shop','disconnectUser','shopId','amount','desc','sendPayoutNotification','status','all','sendShopNotification','TelegramController','../config/database','test_payout_123','sendTestNotification','Broadcast\x20message\x20sent\x20successfully','ceil','update','1145133rBIbhA','title','body','params','defineProperty','username','findMany','true','count','Тестовый\x20период','wallet','Shop\x20not\x20found','78hZHncT','916888MzUOJe','telegramUser','Test\x20','Test\x20Product','lastName','test_payment_123','4746897QFDbml','Markdown','isVerified','firstName'];a20_0x3294=function(){return _0x5b5496;};return a20_0x3294();}function a20_0x4073(_0x485282,_0x9916bf){_0x485282=_0x485282-0x173;const _0x32946c=a20_0x3294();let _0x4073ac=_0x32946c[_0x485282];return _0x4073ac;}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a20_0xbd6078(0x189)));class TelegramController{constructor(){const _0x5a4017=a20_0xbd6078;this[_0x5a4017(0x17c)]=async(_0xd9f5ad,_0x3d5530,_0x3726ee)=>{const _0xf3074d=_0x5a4017;try{const _0x341783=telegramBotService_1[_0xf3074d(0x1ba)][_0xf3074d(0x1af)](),_0x3439f5=await database_1[_0xf3074d(0x1be)][_0xf3074d(0x19d)]['count'](),_0x1b5fcb=await database_1[_0xf3074d(0x1be)][_0xf3074d(0x19d)][_0xf3074d(0x197)]({'where':{'isVerified':!![]}}),_0x1e382a=await database_1[_0xf3074d(0x1be)][_0xf3074d(0x19d)][_0xf3074d(0x1aa)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3d5530[_0xf3074d(0x1ae)]({'success':!![],'result':{'bot':{'isActive':_0x341783['isActive'],'username':_0x341783[_0xf3074d(0x194)]},'statistics':{'totalUsers':_0x3439f5,'verifiedUsers':_0x1b5fcb,'unverifiedUsers':_0x3439f5-_0x1b5fcb,'connectedShops':_0x1e382a['length']}}});}catch(_0x4b6fd2){_0x3726ee(_0x4b6fd2);}},this['getTelegramUsers']=async(_0x3b6471,_0x2d5aa0,_0x1ebe8a)=>{const _0x2aa9a0=_0x5a4017;try{const {page:page=0x1,limit:limit=0x14,verified:_0x31a0be}=_0x3b6471[_0x2aa9a0(0x17e)],_0xbdd372=(Number(page)-0x1)*Number(limit),_0x333366={};_0x31a0be!==undefined&&(_0x333366[_0x2aa9a0(0x1a4)]=_0x31a0be===_0x2aa9a0(0x196));const [_0x306c71,_0x38f371]=await Promise[_0x2aa9a0(0x186)]([database_1[_0x2aa9a0(0x1be)]['telegramUser'][_0x2aa9a0(0x195)]({'where':_0x333366,'skip':_0xbdd372,'take':Number(limit),'orderBy':{'createdAt':_0x2aa9a0(0x183)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2aa9a0(0x1be)][_0x2aa9a0(0x19d)]['count']({'where':_0x333366})]);_0x2d5aa0['json']({'success':!![],'users':_0x306c71[_0x2aa9a0(0x178)](_0x209c5b=>({'id':_0x209c5b['id'],'telegramId':_0x209c5b[_0x2aa9a0(0x17a)],'username':_0x209c5b[_0x2aa9a0(0x194)],'firstName':_0x209c5b[_0x2aa9a0(0x1a5)],'lastName':_0x209c5b[_0x2aa9a0(0x1a0)],'isVerified':_0x209c5b['isVerified'],'shop':_0x209c5b[_0x2aa9a0(0x17f)],'createdAt':_0x209c5b[_0x2aa9a0(0x173)],'updatedAt':_0x209c5b[_0x2aa9a0(0x1a6)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x38f371,'totalPages':Math[_0x2aa9a0(0x18d)](_0x38f371/Number(limit))}});}catch(_0x164a55){_0x1ebe8a(_0x164a55);}},this[_0x5a4017(0x1ab)]=async(_0x1d6bd0,_0x2f7a66,_0x41c7ad)=>{const _0x4744c9=_0x5a4017;try{const {message:_0x278957,shopId:_0x1f0c97}=_0x1d6bd0['body'];if(!_0x278957)return _0x2f7a66[_0x4744c9(0x185)](0x190)[_0x4744c9(0x1ae)]({'success':![],'message':_0x4744c9(0x1b2)});if(_0x1f0c97)await telegramBotService_1['telegramBotService'][_0x4744c9(0x187)](_0x1f0c97,_0x278957,{'parse_mode':_0x4744c9(0x1a3)});else{const _0x4a088b=await database_1[_0x4744c9(0x1be)]['telegramUser'][_0x4744c9(0x195)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x18e23c=[...new Set(_0x4a088b['map'](_0x2f52f0=>_0x2f52f0[_0x4744c9(0x181)])[_0x4744c9(0x1b4)](Boolean))];for(const _0xb453f6 of _0x18e23c){_0xb453f6&&await telegramBotService_1[_0x4744c9(0x1ba)][_0x4744c9(0x187)](_0xb453f6,_0x278957,{'parse_mode':'Markdown'});}}_0x2f7a66[_0x4744c9(0x1ae)]({'success':!![],'message':_0x4744c9(0x18c)});}catch(_0x4d5c9c){_0x41c7ad(_0x4d5c9c);}},this[_0x5a4017(0x180)]=async(_0x290fb5,_0x4613c6,_0x45ba48)=>{const _0xba13aa=_0x5a4017;try{const {telegramId:_0x9f1613}=_0x290fb5[_0xba13aa(0x192)],_0x50decf=await database_1[_0xba13aa(0x1be)]['telegramUser'][_0xba13aa(0x1a9)]({'where':{'telegramId':_0x9f1613},'include':{'shop':!![]}});if(!_0x50decf)return _0x4613c6['status'](0x194)[_0xba13aa(0x1ae)]({'success':![],'message':_0xba13aa(0x1b9)});await database_1[_0xba13aa(0x1be)]['telegramUser'][_0xba13aa(0x18e)]({'where':{'telegramId':_0x9f1613},'data':{'shopId':null,'isVerified':![]}}),_0x4613c6[_0xba13aa(0x1ae)]({'success':!![],'message':_0xba13aa(0x1b7)});}catch(_0x501d88){_0x45ba48(_0x501d88);}},this[_0x5a4017(0x18b)]=async(_0x469f03,_0x39d634,_0xf3a44e)=>{const _0x151dcb=_0x5a4017;try{const {shopId:_0x59e1d2,type:type='payment',testData:_0x55a24b}=_0x469f03[_0x151dcb(0x191)];if(!_0x59e1d2)return _0x39d634[_0x151dcb(0x185)](0x190)[_0x151dcb(0x1ae)]({'success':![],'message':_0x151dcb(0x17d)});const _0x1b0486=await database_1[_0x151dcb(0x1be)][_0x151dcb(0x17f)]['findUnique']({'where':{'id':_0x59e1d2},'select':{'id':!![],'name':!![]}});if(!_0x1b0486)return _0x39d634['status'](0x194)[_0x151dcb(0x1ae)]({'success':![],'message':_0x151dcb(0x19a)});switch(type){case _0x151dcb(0x1a7):const _0x5548b8={'id':_0x151dcb(0x1a1),'amount':_0x55a24b?.['amount']||0x64,'currency':_0x55a24b?.['currency']||_0x151dcb(0x1b8),'productName':_0x55a24b?.['productName']||_0x151dcb(0x19f),'gateway':_0x55a24b?.['gateway']||_0x151dcb(0x1bd),'createdAt':new Date(),..._0x55a24b};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x59e1d2,_0x5548b8,_0x151dcb(0x1a8));break;case _0x151dcb(0x17b):const _0xee5e9f={'id':_0x151dcb(0x18a),'amount':_0x55a24b?.[_0x151dcb(0x182)]||0x1f4,'network':_0x55a24b?.[_0x151dcb(0x1bb)]||_0x151dcb(0x1b3),'wallet':_0x55a24b?.[_0x151dcb(0x199)]||_0x151dcb(0x1b5),'period':_0x151dcb(0x198),'createdAt':new Date(),'txid':_0x55a24b?.['txid']||null,..._0x55a24b};await telegramBotService_1[_0x151dcb(0x1ba)][_0x151dcb(0x184)](_0x59e1d2,_0xee5e9f);break;case _0x151dcb(0x175):await telegramBotService_1[_0x151dcb(0x1ba)]['sendCustomNotification'](_0x59e1d2,_0x55a24b?.[_0x151dcb(0x190)]||'Test\x20Notification',_0x55a24b?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x39d634[_0x151dcb(0x185)](0x190)['json']({'success':![],'message':_0x151dcb(0x1bf)});}_0x39d634[_0x151dcb(0x1ae)]({'success':!![],'message':_0x151dcb(0x19e)+type+_0x151dcb(0x177)});}catch(_0x33172c){_0xf3a44e(_0x33172c);}};}}exports[a20_0xbd6078(0x188)]=TelegramController;