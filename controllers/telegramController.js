'use strict';const a12_0x317039=a12_0x3440;(function(_0x3a5393,_0x509764){const _0x323618=a12_0x3440,_0x2e8a5a=_0x3a5393();while(!![]){try{const _0x1a9a95=-parseInt(_0x323618(0x13a))/0x1+-parseInt(_0x323618(0x14d))/0x2*(-parseInt(_0x323618(0x150))/0x3)+parseInt(_0x323618(0x12f))/0x4*(parseInt(_0x323618(0x159))/0x5)+parseInt(_0x323618(0x155))/0x6+parseInt(_0x323618(0x13e))/0x7+-parseInt(_0x323618(0x120))/0x8+-parseInt(_0x323618(0x143))/0x9;if(_0x1a9a95===_0x509764)break;else _0x2e8a5a['push'](_0x2e8a5a['shift']());}catch(_0x1bd9bb){_0x2e8a5a['push'](_0x2e8a5a['shift']());}}}(a12_0x20a5,0xc8df1));var __importDefault=this&&this[a12_0x317039(0x13d)]||function(_0xb63f29){const _0x25d564=a12_0x317039;return _0xb63f29&&_0xb63f29[_0x25d564(0x132)]?_0xb63f29:{'default':_0xb63f29};};Object[a12_0x317039(0x152)](exports,a12_0x317039(0x132),{'value':!![]}),exports[a12_0x317039(0x154)]=void 0x0;function a12_0x20a5(){const _0x30b23b=['shop','all','sendPaymentNotification','telegramId','21504141GjTAjk','method','firstName','bank_transfer','payout','json','../config/database','findUnique','custom','Test\x20Product','3055086rbJSnn','sendTestNotification','Shop\x20not\x20found','3uevmVE','sendPayoutNotification','defineProperty','Message\x20is\x20required','TelegramController','2540184XEteUR','status','body','isVerified','5PmTxST','sendCustomNotification','getBotStatus','isActive','title','filter','disconnectUser','amount','update','desc','plisio','USD','groupBy','default','updatedAt','length','test_payout_123','test_payment_123','sendBroadcast','9590304BIjQAj','This\x20is\x20a\x20test\x20notification','details','count','sendShopNotification','Shop\x20ID\x20is\x20required','paid','findMany','telegramUser','../services/telegramBotService','createdAt','Test\x20','User\x20disconnected\x20successfully','payment','query','6550604DbqKFT','gateway','username','__esModule','shopId','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','map','Test\x20Notification','getBotInfo','Telegram\x20user\x20not\x20found','productName','433225bHzICd','\x20notification\x20sent\x20successfully','telegramBotService','__importDefault','8789011ZEXTCK'];a12_0x20a5=function(){return _0x30b23b;};return a12_0x20a5();}const telegramBotService_1=require(a12_0x317039(0x129)),database_1=__importDefault(require(a12_0x317039(0x149)));function a12_0x3440(_0x40115d,_0x41e0ce){const _0x20a50e=a12_0x20a5();return a12_0x3440=function(_0x3440ba,_0x3efe05){_0x3440ba=_0x3440ba-0x10f;let _0x345140=_0x20a50e[_0x3440ba];return _0x345140;},a12_0x3440(_0x40115d,_0x41e0ce);}class TelegramController{constructor(){const _0x129e3d=a12_0x317039;this[_0x129e3d(0x10f)]=async(_0x19b79c,_0x115f8b,_0x2dfafd)=>{const _0x50014d=_0x129e3d;try{const _0x5b7ce8=telegramBotService_1[_0x50014d(0x13c)][_0x50014d(0x137)](),_0x5d44f6=await database_1[_0x50014d(0x11a)][_0x50014d(0x128)][_0x50014d(0x123)](),_0x521dd9=await database_1[_0x50014d(0x11a)][_0x50014d(0x128)][_0x50014d(0x123)]({'where':{'isVerified':!![]}}),_0x11f826=await database_1[_0x50014d(0x11a)][_0x50014d(0x128)][_0x50014d(0x119)]({'by':[_0x50014d(0x133)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x115f8b[_0x50014d(0x148)]({'success':!![],'result':{'bot':{'isActive':_0x5b7ce8[_0x50014d(0x110)],'username':_0x5b7ce8[_0x50014d(0x131)]},'statistics':{'totalUsers':_0x5d44f6,'verifiedUsers':_0x521dd9,'unverifiedUsers':_0x5d44f6-_0x521dd9,'connectedShops':_0x11f826[_0x50014d(0x11c)]}}});}catch(_0x3f639c){_0x2dfafd(_0x3f639c);}},this['getTelegramUsers']=async(_0x2672d5,_0x5efe0f,_0x5132ad)=>{const _0x1fbdb7=_0x129e3d;try{const {page:page=0x1,limit:limit=0x14,verified:_0x14fe1c}=_0x2672d5[_0x1fbdb7(0x12e)],_0x4c9b3a=(Number(page)-0x1)*Number(limit),_0x1ec023={};_0x14fe1c!==undefined&&(_0x1ec023[_0x1fbdb7(0x158)]=_0x14fe1c==='true');const [_0x3ddbc4,_0x32fd1c]=await Promise[_0x1fbdb7(0x140)]([database_1[_0x1fbdb7(0x11a)][_0x1fbdb7(0x128)]['findMany']({'where':_0x1ec023,'skip':_0x4c9b3a,'take':Number(limit),'orderBy':{'createdAt':_0x1fbdb7(0x116)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1fbdb7(0x11a)]['telegramUser'][_0x1fbdb7(0x123)]({'where':_0x1ec023})]);_0x5efe0f[_0x1fbdb7(0x148)]({'success':!![],'users':_0x3ddbc4[_0x1fbdb7(0x135)](_0x3acaf2=>({'id':_0x3acaf2['id'],'telegramId':_0x3acaf2[_0x1fbdb7(0x142)],'username':_0x3acaf2[_0x1fbdb7(0x131)],'firstName':_0x3acaf2[_0x1fbdb7(0x145)],'lastName':_0x3acaf2['lastName'],'isVerified':_0x3acaf2[_0x1fbdb7(0x158)],'shop':_0x3acaf2[_0x1fbdb7(0x13f)],'createdAt':_0x3acaf2[_0x1fbdb7(0x12a)],'updatedAt':_0x3acaf2[_0x1fbdb7(0x11b)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x32fd1c,'totalPages':Math['ceil'](_0x32fd1c/Number(limit))}});}catch(_0x37d052){_0x5132ad(_0x37d052);}},this[_0x129e3d(0x11f)]=async(_0x3ac451,_0x50cade,_0xcbe679)=>{const _0x5d4183=_0x129e3d;try{const {message:_0x124b67,shopId:_0x4a0e01}=_0x3ac451[_0x5d4183(0x157)];if(!_0x124b67)return _0x50cade[_0x5d4183(0x156)](0x190)[_0x5d4183(0x148)]({'success':![],'message':_0x5d4183(0x153)});if(_0x4a0e01)await telegramBotService_1['telegramBotService'][_0x5d4183(0x124)](_0x4a0e01,_0x124b67,{'parse_mode':'Markdown'});else{const _0x2ff26d=await database_1[_0x5d4183(0x11a)]['telegramUser'][_0x5d4183(0x127)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2a0f5c=[...new Set(_0x2ff26d['map'](_0x170f20=>_0x170f20['shopId'])[_0x5d4183(0x112)](Boolean))];for(const _0x178909 of _0x2a0f5c){_0x178909&&await telegramBotService_1[_0x5d4183(0x13c)][_0x5d4183(0x124)](_0x178909,_0x124b67,{'parse_mode':'Markdown'});}}_0x50cade[_0x5d4183(0x148)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x2d4438){_0xcbe679(_0x2d4438);}},this[_0x129e3d(0x113)]=async(_0x1c1cdd,_0x324703,_0x2e482e)=>{const _0x51b61c=_0x129e3d;try{const {telegramId:_0x217d8a}=_0x1c1cdd['params'],_0x145c3a=await database_1['default'][_0x51b61c(0x128)][_0x51b61c(0x14a)]({'where':{'telegramId':_0x217d8a},'include':{'shop':!![]}});if(!_0x145c3a)return _0x324703[_0x51b61c(0x156)](0x194)[_0x51b61c(0x148)]({'success':![],'message':_0x51b61c(0x138)});await database_1[_0x51b61c(0x11a)]['telegramUser'][_0x51b61c(0x115)]({'where':{'telegramId':_0x217d8a},'data':{'shopId':null,'isVerified':![]}}),_0x324703[_0x51b61c(0x148)]({'success':!![],'message':_0x51b61c(0x12c)});}catch(_0x2e8a03){_0x2e482e(_0x2e8a03);}},this[_0x129e3d(0x14e)]=async(_0x2cfe11,_0x51a082,_0x20a54e)=>{const _0x449c94=_0x129e3d;try{const {shopId:_0x1ea9c7,type:type=_0x449c94(0x12d),testData:_0x1b6ddb}=_0x2cfe11[_0x449c94(0x157)];if(!_0x1ea9c7)return _0x51a082[_0x449c94(0x156)](0x190)['json']({'success':![],'message':_0x449c94(0x125)});const _0x4ec688=await database_1['default']['shop'][_0x449c94(0x14a)]({'where':{'id':_0x1ea9c7},'select':{'id':!![],'name':!![]}});if(!_0x4ec688)return _0x51a082[_0x449c94(0x156)](0x194)[_0x449c94(0x148)]({'success':![],'message':_0x449c94(0x14f)});switch(type){case _0x449c94(0x12d):const _0x557dc7={'id':_0x449c94(0x11e),'amount':_0x1b6ddb?.[_0x449c94(0x114)]||0x64,'currency':_0x1b6ddb?.['currency']||_0x449c94(0x118),'productName':_0x1b6ddb?.[_0x449c94(0x139)]||_0x449c94(0x14c),'gateway':_0x1b6ddb?.[_0x449c94(0x130)]||_0x449c94(0x117),'createdAt':new Date(),..._0x1b6ddb};await telegramBotService_1['telegramBotService'][_0x449c94(0x141)](_0x1ea9c7,_0x557dc7,_0x449c94(0x126));break;case _0x449c94(0x147):const _0x31e4fc={'id':_0x449c94(0x11d),'amount':_0x1b6ddb?.['amount']||0x1f4,'method':_0x1b6ddb?.[_0x449c94(0x144)]||_0x449c94(0x146),'createdAt':new Date(),..._0x1b6ddb};await telegramBotService_1[_0x449c94(0x13c)][_0x449c94(0x151)](_0x1ea9c7,_0x31e4fc,'completed');break;case _0x449c94(0x14b):await telegramBotService_1['telegramBotService'][_0x449c94(0x15a)](_0x1ea9c7,_0x1b6ddb?.[_0x449c94(0x111)]||_0x449c94(0x136),_0x1b6ddb?.[_0x449c94(0x122)]||{'message':_0x449c94(0x121)});break;default:return _0x51a082[_0x449c94(0x156)](0x190)[_0x449c94(0x148)]({'success':![],'message':_0x449c94(0x134)});}_0x51a082[_0x449c94(0x148)]({'success':!![],'message':_0x449c94(0x12b)+type+_0x449c94(0x13b)});}catch(_0x3db6bb){_0x20a54e(_0x3db6bb);}};}}exports[a12_0x317039(0x154)]=TelegramController;