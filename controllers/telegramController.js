'use strict';const a12_0x195fda=a12_0x47e7;function a12_0x47e7(_0x1368f2,_0x640fe4){const _0x42b50b=a12_0x42b5();return a12_0x47e7=function(_0x47e7e2,_0x1492d4){_0x47e7e2=_0x47e7e2-0xe1;let _0x22e764=_0x42b50b[_0x47e7e2];return _0x22e764;},a12_0x47e7(_0x1368f2,_0x640fe4);}(function(_0x198bd2,_0xe2171c){const _0x1aaf81=a12_0x47e7,_0x52c852=_0x198bd2();while(!![]){try{const _0x9c862a=parseInt(_0x1aaf81(0x104))/0x1*(-parseInt(_0x1aaf81(0x102))/0x2)+parseInt(_0x1aaf81(0xee))/0x3*(parseInt(_0x1aaf81(0xed))/0x4)+-parseInt(_0x1aaf81(0xf7))/0x5*(-parseInt(_0x1aaf81(0xfd))/0x6)+-parseInt(_0x1aaf81(0xf8))/0x7*(-parseInt(_0x1aaf81(0x126))/0x8)+parseInt(_0x1aaf81(0x112))/0x9+-parseInt(_0x1aaf81(0x109))/0xa+-parseInt(_0x1aaf81(0x11f))/0xb*(parseInt(_0x1aaf81(0xf6))/0xc);if(_0x9c862a===_0xe2171c)break;else _0x52c852['push'](_0x52c852['shift']());}catch(_0x16b7ac){_0x52c852['push'](_0x52c852['shift']());}}}(a12_0x42b5,0xcedc5));var __importDefault=this&&this['__importDefault']||function(_0x30605b){const _0x397562=a12_0x47e7;return _0x30605b&&_0x30605b[_0x397562(0xe7)]?_0x30605b:{'default':_0x30605b};};function a12_0x42b5(){const _0x4acaf4=['telegramBotService','276xQVkiT','5aJQwVv','5684ojKOnr','disconnectUser','username','shop','all','2559306UEhMBC','sendPayoutNotification','\x20notification\x20sent\x20successfully','Message\x20is\x20required','firstName','218ZeGGOk','productName','2301zzZqoy','payout','length','USD','../services/telegramBotService','979610mTZZVX','lastName','shopId','isVerified','This\x20is\x20a\x20test\x20notification','payment','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','getBotStatus','custom','13813281qNTwqR','TelegramController','test_payment_123','sendShopNotification','getTelegramUsers','Test\x20Product','default','method','currency','../config/database','plisio','findUnique','count','546403fCfnny','Test\x20Notification','Broadcast\x20message\x20sent\x20successfully','map','updatedAt','findMany','groupBy','104WdTDFM','getBotInfo','completed','test_payout_123','status','Shop\x20ID\x20is\x20required','sendBroadcast','body','title','__esModule','json','Telegram\x20user\x20not\x20found','Markdown','User\x20disconnected\x20successfully','bank_transfer','1466536szSyeA','3HXiGHX','params','telegramUser','sendPaymentNotification','filter','gateway','ceil'];a12_0x42b5=function(){return _0x4acaf4;};return a12_0x42b5();}Object['defineProperty'](exports,a12_0x195fda(0xe7),{'value':!![]}),exports[a12_0x195fda(0x113)]=void 0x0;const telegramBotService_1=require(a12_0x195fda(0x108)),database_1=__importDefault(require(a12_0x195fda(0x11b)));class TelegramController{constructor(){const _0x41792b=a12_0x195fda;this[_0x41792b(0x110)]=async(_0x3ee79a,_0x1c376b,_0x4c79b5)=>{const _0xf47f99=_0x41792b;try{const _0xe4fb5f=telegramBotService_1['telegramBotService'][_0xf47f99(0x127)](),_0x2ca918=await database_1['default'][_0xf47f99(0xf0)][_0xf47f99(0x11e)](),_0x1a74e9=await database_1[_0xf47f99(0x118)][_0xf47f99(0xf0)][_0xf47f99(0x11e)]({'where':{'isVerified':!![]}}),_0x11d7a2=await database_1[_0xf47f99(0x118)][_0xf47f99(0xf0)][_0xf47f99(0x125)]({'by':[_0xf47f99(0x10b)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1c376b[_0xf47f99(0xe8)]({'success':!![],'result':{'bot':{'isActive':_0xe4fb5f['isActive'],'username':_0xe4fb5f['username']},'statistics':{'totalUsers':_0x2ca918,'verifiedUsers':_0x1a74e9,'unverifiedUsers':_0x2ca918-_0x1a74e9,'connectedShops':_0x11d7a2[_0xf47f99(0x106)]}}});}catch(_0x1b2e4e){_0x4c79b5(_0x1b2e4e);}},this[_0x41792b(0x116)]=async(_0x39b3b1,_0x325a12,_0x44d42d)=>{const _0x1d9e50=_0x41792b;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5ba353}=_0x39b3b1['query'],_0x2f80fc=(Number(page)-0x1)*Number(limit),_0x114a4e={};_0x5ba353!==undefined&&(_0x114a4e[_0x1d9e50(0x10c)]=_0x5ba353==='true');const [_0x69629b,_0x3e83a5]=await Promise[_0x1d9e50(0xfc)]([database_1[_0x1d9e50(0x118)][_0x1d9e50(0xf0)][_0x1d9e50(0x124)]({'where':_0x114a4e,'skip':_0x2f80fc,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1d9e50(0x118)][_0x1d9e50(0xf0)][_0x1d9e50(0x11e)]({'where':_0x114a4e})]);_0x325a12[_0x1d9e50(0xe8)]({'success':!![],'users':_0x69629b[_0x1d9e50(0x122)](_0x2c4926=>({'id':_0x2c4926['id'],'telegramId':_0x2c4926['telegramId'],'username':_0x2c4926[_0x1d9e50(0xfa)],'firstName':_0x2c4926[_0x1d9e50(0x101)],'lastName':_0x2c4926[_0x1d9e50(0x10a)],'isVerified':_0x2c4926[_0x1d9e50(0x10c)],'shop':_0x2c4926[_0x1d9e50(0xfb)],'createdAt':_0x2c4926['createdAt'],'updatedAt':_0x2c4926[_0x1d9e50(0x123)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3e83a5,'totalPages':Math[_0x1d9e50(0xf4)](_0x3e83a5/Number(limit))}});}catch(_0xf1d970){_0x44d42d(_0xf1d970);}},this[_0x41792b(0xe4)]=async(_0x26474a,_0x4fbec2,_0x5f5565)=>{const _0x1e4f76=_0x41792b;try{const {message:_0x22f0ec,shopId:_0x496856}=_0x26474a[_0x1e4f76(0xe5)];if(!_0x22f0ec)return _0x4fbec2[_0x1e4f76(0xe2)](0x190)[_0x1e4f76(0xe8)]({'success':![],'message':_0x1e4f76(0x100)});if(_0x496856)await telegramBotService_1[_0x1e4f76(0xf5)][_0x1e4f76(0x115)](_0x496856,_0x22f0ec,{'parse_mode':'Markdown'});else{const _0x42ed23=await database_1['default']['telegramUser'][_0x1e4f76(0x124)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x26f4d5=[...new Set(_0x42ed23[_0x1e4f76(0x122)](_0x2bca98=>_0x2bca98['shopId'])[_0x1e4f76(0xf2)](Boolean))];for(const _0x2b1d52 of _0x26f4d5){_0x2b1d52&&await telegramBotService_1[_0x1e4f76(0xf5)][_0x1e4f76(0x115)](_0x2b1d52,_0x22f0ec,{'parse_mode':_0x1e4f76(0xea)});}}_0x4fbec2['json']({'success':!![],'message':_0x1e4f76(0x121)});}catch(_0x5750c2){_0x5f5565(_0x5750c2);}},this[_0x41792b(0xf9)]=async(_0x216971,_0x35e319,_0x4c629d)=>{const _0x334015=_0x41792b;try{const {telegramId:_0x369971}=_0x216971[_0x334015(0xef)],_0x481f73=await database_1[_0x334015(0x118)][_0x334015(0xf0)][_0x334015(0x11d)]({'where':{'telegramId':_0x369971},'include':{'shop':!![]}});if(!_0x481f73)return _0x35e319['status'](0x194)[_0x334015(0xe8)]({'success':![],'message':_0x334015(0xe9)});await database_1[_0x334015(0x118)][_0x334015(0xf0)]['update']({'where':{'telegramId':_0x369971},'data':{'shopId':null,'isVerified':![]}}),_0x35e319[_0x334015(0xe8)]({'success':!![],'message':_0x334015(0xeb)});}catch(_0x459779){_0x4c629d(_0x459779);}},this['sendTestNotification']=async(_0x4241d5,_0x3bb1f1,_0x86088e)=>{const _0x5b6ceb=_0x41792b;try{const {shopId:_0x38806b,type:type=_0x5b6ceb(0x10e),testData:_0x203761}=_0x4241d5[_0x5b6ceb(0xe5)];if(!_0x38806b)return _0x3bb1f1[_0x5b6ceb(0xe2)](0x190)[_0x5b6ceb(0xe8)]({'success':![],'message':_0x5b6ceb(0xe3)});const _0x55c741=await database_1['default'][_0x5b6ceb(0xfb)][_0x5b6ceb(0x11d)]({'where':{'id':_0x38806b},'select':{'id':!![],'name':!![]}});if(!_0x55c741)return _0x3bb1f1[_0x5b6ceb(0xe2)](0x194)[_0x5b6ceb(0xe8)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x5b6ceb(0x10e):const _0x5316c3={'id':_0x5b6ceb(0x114),'amount':_0x203761?.['amount']||0x64,'currency':_0x203761?.[_0x5b6ceb(0x11a)]||_0x5b6ceb(0x107),'productName':_0x203761?.[_0x5b6ceb(0x103)]||_0x5b6ceb(0x117),'gateway':_0x203761?.[_0x5b6ceb(0xf3)]||_0x5b6ceb(0x11c),'createdAt':new Date(),..._0x203761};await telegramBotService_1[_0x5b6ceb(0xf5)][_0x5b6ceb(0xf1)](_0x38806b,_0x5316c3,'paid');break;case _0x5b6ceb(0x105):const _0x3c6b77={'id':_0x5b6ceb(0xe1),'amount':_0x203761?.['amount']||0x1f4,'method':_0x203761?.[_0x5b6ceb(0x119)]||_0x5b6ceb(0xec),'createdAt':new Date(),..._0x203761};await telegramBotService_1[_0x5b6ceb(0xf5)][_0x5b6ceb(0xfe)](_0x38806b,_0x3c6b77,_0x5b6ceb(0x128));break;case _0x5b6ceb(0x111):await telegramBotService_1['telegramBotService']['sendCustomNotification'](_0x38806b,_0x203761?.[_0x5b6ceb(0xe6)]||_0x5b6ceb(0x120),_0x203761?.['details']||{'message':_0x5b6ceb(0x10d)});break;default:return _0x3bb1f1[_0x5b6ceb(0xe2)](0x190)[_0x5b6ceb(0xe8)]({'success':![],'message':_0x5b6ceb(0x10f)});}_0x3bb1f1['json']({'success':!![],'message':'Test\x20'+type+_0x5b6ceb(0xff)});}catch(_0xe3aa56){_0x86088e(_0xe3aa56);}};}}exports[a12_0x195fda(0x113)]=TelegramController;