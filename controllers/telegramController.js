'use strict';function a20_0x2b66(_0x521898,_0x33c3ec){_0x521898=_0x521898-0x157;const _0x5b0153=a20_0x5b01();let _0x2b66e4=_0x5b0153[_0x521898];return _0x2b66e4;}const a20_0x3ba937=a20_0x2b66;function a20_0x5b01(){const _0x58c637=['Markdown','333881ELKurs','filter','USD','isActive','paid','payment','default','telegramId','Shop\x20ID\x20is\x20required','isVerified','network','sendTestNotification','json','../config/database','groupBy','body','createdAt','13180RRXbqH','16914GkGiBu','93LVUowA','sendPayoutNotification','desc','defineProperty','695MIgbyg','true','Broadcast\x20message\x20sent\x20successfully','Message\x20is\x20required','payout','count','getBotStatus','title','sendPaymentNotification','params','__importDefault','Test\x20Product','custom','test_payout_123','telegramUser','ceil','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','lastName','This\x20is\x20a\x20test\x20notification','593982xSPjPT','username','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','query','productName','update','shop','findUnique','findMany','\x20notification\x20sent\x20successfully','__esModule','updatedAt','map','sendShopNotification','6003712MFXiVu','sendCustomNotification','1128708mxIlIT','length','70150iTQkds','status','all','TelegramController','getTelegramUsers','txid','Shop\x20not\x20found','shopId','firstName','90yiswbJ','telegramBotService'];a20_0x5b01=function(){return _0x58c637;};return a20_0x5b01();}(function(_0x4e16a0,_0x19f289){const _0xf8c2a8=a20_0x2b66,_0x2d0f81=_0x4e16a0();while(!![]){try{const _0x39df50=-parseInt(_0xf8c2a8(0x189))/0x1+-parseInt(_0xf8c2a8(0x19b))/0x2*(parseInt(_0xf8c2a8(0x19c))/0x3)+parseInt(_0xf8c2a8(0x19a))/0x4*(parseInt(_0xf8c2a8(0x158))/0x5)+-parseInt(_0xf8c2a8(0x16b))/0x6+-parseInt(_0xf8c2a8(0x17b))/0x7+parseInt(_0xf8c2a8(0x179))/0x8+-parseInt(_0xf8c2a8(0x186))/0x9*(-parseInt(_0xf8c2a8(0x17d))/0xa);if(_0x39df50===_0x19f289)break;else _0x2d0f81['push'](_0x2d0f81['shift']());}catch(_0x1d7bde){_0x2d0f81['push'](_0x2d0f81['shift']());}}}(a20_0x5b01,0x671ba));var __importDefault=this&&this[a20_0x3ba937(0x162)]||function(_0xb73d67){return _0xb73d67&&_0xb73d67['__esModule']?_0xb73d67:{'default':_0xb73d67};};Object[a20_0x3ba937(0x157)](exports,a20_0x3ba937(0x175),{'value':!![]}),exports[a20_0x3ba937(0x180)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a20_0x3ba937(0x196)));class TelegramController{constructor(){const _0x20f0ac=a20_0x3ba937;this[_0x20f0ac(0x15e)]=async(_0x7360e4,_0x5f2caa,_0x987a80)=>{const _0x3d3883=_0x20f0ac;try{const _0x24f1d3=telegramBotService_1[_0x3d3883(0x187)]['getBotInfo'](),_0x29275c=await database_1['default'][_0x3d3883(0x166)]['count'](),_0x5164bf=await database_1[_0x3d3883(0x18f)][_0x3d3883(0x166)][_0x3d3883(0x15d)]({'where':{'isVerified':!![]}}),_0x8416ec=await database_1[_0x3d3883(0x18f)]['telegramUser'][_0x3d3883(0x197)]({'by':[_0x3d3883(0x184)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5f2caa['json']({'success':!![],'result':{'bot':{'isActive':_0x24f1d3[_0x3d3883(0x18c)],'username':_0x24f1d3[_0x3d3883(0x16c)]},'statistics':{'totalUsers':_0x29275c,'verifiedUsers':_0x5164bf,'unverifiedUsers':_0x29275c-_0x5164bf,'connectedShops':_0x8416ec[_0x3d3883(0x17c)]}}});}catch(_0x48f70f){_0x987a80(_0x48f70f);}},this[_0x20f0ac(0x181)]=async(_0xb5b602,_0x2254f5,_0x5d63d1)=>{const _0x29af3a=_0x20f0ac;try{const {page:page=0x1,limit:limit=0x14,verified:_0x316eaa}=_0xb5b602[_0x29af3a(0x16e)],_0x1ad3ad=(Number(page)-0x1)*Number(limit),_0x122eb1={};_0x316eaa!==undefined&&(_0x122eb1['isVerified']=_0x316eaa===_0x29af3a(0x159));const [_0x4c5347,_0x387439]=await Promise[_0x29af3a(0x17f)]([database_1[_0x29af3a(0x18f)][_0x29af3a(0x166)][_0x29af3a(0x173)]({'where':_0x122eb1,'skip':_0x1ad3ad,'take':Number(limit),'orderBy':{'createdAt':_0x29af3a(0x19e)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x29af3a(0x18f)]['telegramUser'][_0x29af3a(0x15d)]({'where':_0x122eb1})]);_0x2254f5[_0x29af3a(0x195)]({'success':!![],'users':_0x4c5347[_0x29af3a(0x177)](_0x56feeb=>({'id':_0x56feeb['id'],'telegramId':_0x56feeb[_0x29af3a(0x190)],'username':_0x56feeb['username'],'firstName':_0x56feeb[_0x29af3a(0x185)],'lastName':_0x56feeb[_0x29af3a(0x169)],'isVerified':_0x56feeb[_0x29af3a(0x192)],'shop':_0x56feeb[_0x29af3a(0x171)],'createdAt':_0x56feeb[_0x29af3a(0x199)],'updatedAt':_0x56feeb[_0x29af3a(0x176)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x387439,'totalPages':Math[_0x29af3a(0x167)](_0x387439/Number(limit))}});}catch(_0x29b41c){_0x5d63d1(_0x29b41c);}},this['sendBroadcast']=async(_0x161f5f,_0x2c362d,_0x26e716)=>{const _0x1f1ebc=_0x20f0ac;try{const {message:_0xeaaeb4,shopId:_0x14ec1f}=_0x161f5f[_0x1f1ebc(0x198)];if(!_0xeaaeb4)return _0x2c362d[_0x1f1ebc(0x17e)](0x190)[_0x1f1ebc(0x195)]({'success':![],'message':_0x1f1ebc(0x15b)});if(_0x14ec1f)await telegramBotService_1[_0x1f1ebc(0x187)][_0x1f1ebc(0x178)](_0x14ec1f,_0xeaaeb4,{'parse_mode':'Markdown'});else{const _0x2a94a6=await database_1['default'][_0x1f1ebc(0x166)][_0x1f1ebc(0x173)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4d7342=[...new Set(_0x2a94a6[_0x1f1ebc(0x177)](_0x328f62=>_0x328f62['shopId'])[_0x1f1ebc(0x18a)](Boolean))];for(const _0x161006 of _0x4d7342){_0x161006&&await telegramBotService_1['telegramBotService'][_0x1f1ebc(0x178)](_0x161006,_0xeaaeb4,{'parse_mode':_0x1f1ebc(0x188)});}}_0x2c362d['json']({'success':!![],'message':_0x1f1ebc(0x15a)});}catch(_0x15e43b){_0x26e716(_0x15e43b);}},this['disconnectUser']=async(_0x275951,_0x30a7ba,_0x259403)=>{const _0x55f632=_0x20f0ac;try{const {telegramId:_0x2fb1e8}=_0x275951[_0x55f632(0x161)],_0x243d40=await database_1[_0x55f632(0x18f)]['telegramUser'][_0x55f632(0x172)]({'where':{'telegramId':_0x2fb1e8},'include':{'shop':!![]}});if(!_0x243d40)return _0x30a7ba['status'](0x194)[_0x55f632(0x195)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x55f632(0x166)][_0x55f632(0x170)]({'where':{'telegramId':_0x2fb1e8},'data':{'shopId':null,'isVerified':![]}}),_0x30a7ba[_0x55f632(0x195)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x463828){_0x259403(_0x463828);}},this[_0x20f0ac(0x194)]=async(_0x2731d4,_0x14c5cf,_0x4d9202)=>{const _0x2bd421=_0x20f0ac;try{const {shopId:_0x1180bb,type:type=_0x2bd421(0x18e),testData:_0xb75c25}=_0x2731d4[_0x2bd421(0x198)];if(!_0x1180bb)return _0x14c5cf[_0x2bd421(0x17e)](0x190)[_0x2bd421(0x195)]({'success':![],'message':_0x2bd421(0x191)});const _0x543577=await database_1[_0x2bd421(0x18f)][_0x2bd421(0x171)]['findUnique']({'where':{'id':_0x1180bb},'select':{'id':!![],'name':!![]}});if(!_0x543577)return _0x14c5cf['status'](0x194)[_0x2bd421(0x195)]({'success':![],'message':_0x2bd421(0x183)});switch(type){case'payment':const _0x4b6840={'id':'test_payment_123','amount':_0xb75c25?.['amount']||0x64,'currency':_0xb75c25?.['currency']||_0x2bd421(0x18b),'productName':_0xb75c25?.[_0x2bd421(0x16f)]||_0x2bd421(0x163),'gateway':_0xb75c25?.['gateway']||'plisio','createdAt':new Date(),..._0xb75c25};await telegramBotService_1[_0x2bd421(0x187)][_0x2bd421(0x160)](_0x1180bb,_0x4b6840,_0x2bd421(0x18d));break;case _0x2bd421(0x15c):const _0x36fa92={'id':_0x2bd421(0x165),'amount':_0xb75c25?.['amount']||0x1f4,'network':_0xb75c25?.[_0x2bd421(0x193)]||'TRC20','wallet':_0xb75c25?.['wallet']||_0x2bd421(0x16d),'period':'Тестовый\x20период','createdAt':new Date(),'txid':_0xb75c25?.[_0x2bd421(0x182)]||null,..._0xb75c25};await telegramBotService_1[_0x2bd421(0x187)][_0x2bd421(0x19d)](_0x1180bb,_0x36fa92);break;case _0x2bd421(0x164):await telegramBotService_1[_0x2bd421(0x187)][_0x2bd421(0x17a)](_0x1180bb,_0xb75c25?.[_0x2bd421(0x15f)]||'Test\x20Notification',_0xb75c25?.['details']||{'message':_0x2bd421(0x16a)});break;default:return _0x14c5cf['status'](0x190)['json']({'success':![],'message':_0x2bd421(0x168)});}_0x14c5cf[_0x2bd421(0x195)]({'success':!![],'message':'Test\x20'+type+_0x2bd421(0x174)});}catch(_0x20d85d){_0x4d9202(_0x20d85d);}};}}exports[a20_0x3ba937(0x180)]=TelegramController;