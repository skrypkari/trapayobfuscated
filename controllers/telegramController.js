'use strict';function a12_0x2726(){const _0x499c7c=['USD','telegramUser','desc','findMany','sendTestNotification','bank_transfer','sendCustomNotification','custom','map','Shop\x20not\x20found','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','test_payment_123','30dKyblt','923447qxqQcV','__importDefault','gateway','amount','count','__esModule','groupBy','payment','filter','\x20notification\x20sent\x20successfully','sendShopNotification','findUnique','payout','default','telegramBotService','4026800OZYJMz','true','getTelegramUsers','TelegramController','firstName','shopId','status','ceil','18414eTyMJh','4176LfHjtN','1903230rXZmuv','1818756JlgFdv','json','paid','telegramId','getBotInfo','productName','method','Broadcast\x20message\x20sent\x20successfully','sendPayoutNotification','lastName','update','shop','length','Shop\x20ID\x20is\x20required','plisio','Test\x20','username','User\x20disconnected\x20successfully','details','3QrlhXz','../config/database','all','Test\x20Notification','4018865PHlMcz','query','test_payout_123','updatedAt','disconnectUser','isVerified','Test\x20Product','isActive','680018LjpHwb','defineProperty'];a12_0x2726=function(){return _0x499c7c;};return a12_0x2726();}const a12_0x39be0e=a12_0x2730;(function(_0x58540e,_0x3f636a){const _0x3b991f=a12_0x2730,_0x121cbd=_0x58540e();while(!![]){try{const _0x5cba00=parseInt(_0x3b991f(0x1cc))/0x1+parseInt(_0x3b991f(0x1f5))/0x2*(-parseInt(_0x3b991f(0x1c0))/0x3)+parseInt(_0x3b991f(0x1ea))/0x4+-parseInt(_0x3b991f(0x1c4))/0x5+parseInt(_0x3b991f(0x1da))/0x6*(-parseInt(_0x3b991f(0x1db))/0x7)+parseInt(_0x3b991f(0x1f3))/0x8*(parseInt(_0x3b991f(0x1f2))/0x9)+parseInt(_0x3b991f(0x1f4))/0xa;if(_0x5cba00===_0x3f636a)break;else _0x121cbd['push'](_0x121cbd['shift']());}catch(_0x130c67){_0x121cbd['push'](_0x121cbd['shift']());}}}(a12_0x2726,0x8bb89));var __importDefault=this&&this[a12_0x39be0e(0x1dc)]||function(_0x4c36d2){const _0x4b7660=a12_0x39be0e;return _0x4c36d2&&_0x4c36d2[_0x4b7660(0x1e0)]?_0x4c36d2:{'default':_0x4c36d2};};Object[a12_0x39be0e(0x1cd)](exports,a12_0x39be0e(0x1e0),{'value':!![]}),exports[a12_0x39be0e(0x1ed)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x39be0e(0x1c1)));function a12_0x2730(_0x5e648c,_0x4763c8){const _0x2726ea=a12_0x2726();return a12_0x2730=function(_0x2730f5,_0x1ef7bb){_0x2730f5=_0x2730f5-0x1be;let _0x2c3cbf=_0x2726ea[_0x2730f5];return _0x2c3cbf;},a12_0x2730(_0x5e648c,_0x4763c8);}class TelegramController{constructor(){const _0x2108ef=a12_0x39be0e;this['getBotStatus']=async(_0x61852c,_0x1da60b,_0x214d79)=>{const _0x38a40d=a12_0x2730;try{const _0x1a6481=telegramBotService_1['telegramBotService'][_0x38a40d(0x1f9)](),_0x19eee9=await database_1[_0x38a40d(0x1e8)]['telegramUser'][_0x38a40d(0x1df)](),_0x28819e=await database_1[_0x38a40d(0x1e8)][_0x38a40d(0x1cf)]['count']({'where':{'isVerified':!![]}}),_0xddba24=await database_1['default'][_0x38a40d(0x1cf)][_0x38a40d(0x1e1)]({'by':[_0x38a40d(0x1ef)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1da60b[_0x38a40d(0x1f6)]({'success':!![],'result':{'bot':{'isActive':_0x1a6481[_0x38a40d(0x1cb)],'username':_0x1a6481[_0x38a40d(0x205)]},'statistics':{'totalUsers':_0x19eee9,'verifiedUsers':_0x28819e,'unverifiedUsers':_0x19eee9-_0x28819e,'connectedShops':_0xddba24[_0x38a40d(0x201)]}}});}catch(_0x204f25){_0x214d79(_0x204f25);}},this[_0x2108ef(0x1ec)]=async(_0x26add2,_0x5cece0,_0x3be7b4)=>{const _0x4f0935=_0x2108ef;try{const {page:page=0x1,limit:limit=0x14,verified:_0x28aec8}=_0x26add2[_0x4f0935(0x1c5)],_0x508e37=(Number(page)-0x1)*Number(limit),_0x49f0ff={};_0x28aec8!==undefined&&(_0x49f0ff[_0x4f0935(0x1c9)]=_0x28aec8===_0x4f0935(0x1eb));const [_0x529bdc,_0x6f51bb]=await Promise[_0x4f0935(0x1c2)]([database_1['default'][_0x4f0935(0x1cf)][_0x4f0935(0x1d1)]({'where':_0x49f0ff,'skip':_0x508e37,'take':Number(limit),'orderBy':{'createdAt':_0x4f0935(0x1d0)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4f0935(0x1e8)][_0x4f0935(0x1cf)][_0x4f0935(0x1df)]({'where':_0x49f0ff})]);_0x5cece0[_0x4f0935(0x1f6)]({'success':!![],'users':_0x529bdc[_0x4f0935(0x1d6)](_0x17ae03=>({'id':_0x17ae03['id'],'telegramId':_0x17ae03[_0x4f0935(0x1f8)],'username':_0x17ae03['username'],'firstName':_0x17ae03[_0x4f0935(0x1ee)],'lastName':_0x17ae03[_0x4f0935(0x1fe)],'isVerified':_0x17ae03[_0x4f0935(0x1c9)],'shop':_0x17ae03[_0x4f0935(0x200)],'createdAt':_0x17ae03['createdAt'],'updatedAt':_0x17ae03[_0x4f0935(0x1c7)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x6f51bb,'totalPages':Math[_0x4f0935(0x1f1)](_0x6f51bb/Number(limit))}});}catch(_0x2e4d04){_0x3be7b4(_0x2e4d04);}},this['sendBroadcast']=async(_0x485de4,_0x3724e7,_0x338a5e)=>{const _0x2230d9=_0x2108ef;try{const {message:_0x1f9e14,shopId:_0x44a5d6}=_0x485de4['body'];if(!_0x1f9e14)return _0x3724e7[_0x2230d9(0x1f0)](0x190)[_0x2230d9(0x1f6)]({'success':![],'message':'Message\x20is\x20required'});if(_0x44a5d6)await telegramBotService_1[_0x2230d9(0x1e9)][_0x2230d9(0x1e5)](_0x44a5d6,_0x1f9e14,{'parse_mode':'Markdown'});else{const _0x4f6270=await database_1['default'][_0x2230d9(0x1cf)][_0x2230d9(0x1d1)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3899ed=[...new Set(_0x4f6270[_0x2230d9(0x1d6)](_0x57941b=>_0x57941b[_0x2230d9(0x1ef)])[_0x2230d9(0x1e3)](Boolean))];for(const _0x1918c0 of _0x3899ed){_0x1918c0&&await telegramBotService_1['telegramBotService'][_0x2230d9(0x1e5)](_0x1918c0,_0x1f9e14,{'parse_mode':'Markdown'});}}_0x3724e7[_0x2230d9(0x1f6)]({'success':!![],'message':_0x2230d9(0x1fc)});}catch(_0x57c7f1){_0x338a5e(_0x57c7f1);}},this[_0x2108ef(0x1c8)]=async(_0x56667e,_0xe6bdfa,_0x1871c1)=>{const _0x293a97=_0x2108ef;try{const {telegramId:_0x2abc5b}=_0x56667e['params'],_0x3de30a=await database_1['default'][_0x293a97(0x1cf)]['findUnique']({'where':{'telegramId':_0x2abc5b},'include':{'shop':!![]}});if(!_0x3de30a)return _0xe6bdfa['status'](0x194)['json']({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x293a97(0x1e8)][_0x293a97(0x1cf)][_0x293a97(0x1ff)]({'where':{'telegramId':_0x2abc5b},'data':{'shopId':null,'isVerified':![]}}),_0xe6bdfa[_0x293a97(0x1f6)]({'success':!![],'message':_0x293a97(0x1be)});}catch(_0x5204ac){_0x1871c1(_0x5204ac);}},this[_0x2108ef(0x1d2)]=async(_0x19c375,_0x24bc97,_0x84fe9c)=>{const _0x126466=_0x2108ef;try{const {shopId:_0x217e50,type:type=_0x126466(0x1e2),testData:_0x48e950}=_0x19c375['body'];if(!_0x217e50)return _0x24bc97[_0x126466(0x1f0)](0x190)[_0x126466(0x1f6)]({'success':![],'message':_0x126466(0x202)});const _0x4ead62=await database_1[_0x126466(0x1e8)][_0x126466(0x200)][_0x126466(0x1e6)]({'where':{'id':_0x217e50},'select':{'id':!![],'name':!![]}});if(!_0x4ead62)return _0x24bc97['status'](0x194)[_0x126466(0x1f6)]({'success':![],'message':_0x126466(0x1d7)});switch(type){case'payment':const _0x161649={'id':_0x126466(0x1d9),'amount':_0x48e950?.['amount']||0x64,'currency':_0x48e950?.['currency']||_0x126466(0x1ce),'productName':_0x48e950?.[_0x126466(0x1fa)]||_0x126466(0x1ca),'gateway':_0x48e950?.[_0x126466(0x1dd)]||_0x126466(0x203),'createdAt':new Date(),..._0x48e950};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x217e50,_0x161649,_0x126466(0x1f7));break;case _0x126466(0x1e7):const _0x5bdc3f={'id':_0x126466(0x1c6),'amount':_0x48e950?.[_0x126466(0x1de)]||0x1f4,'method':_0x48e950?.[_0x126466(0x1fb)]||_0x126466(0x1d3),'createdAt':new Date(),..._0x48e950};await telegramBotService_1['telegramBotService'][_0x126466(0x1fd)](_0x217e50,_0x5bdc3f,'completed');break;case _0x126466(0x1d5):await telegramBotService_1[_0x126466(0x1e9)][_0x126466(0x1d4)](_0x217e50,_0x48e950?.['title']||_0x126466(0x1c3),_0x48e950?.[_0x126466(0x1bf)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x24bc97[_0x126466(0x1f0)](0x190)[_0x126466(0x1f6)]({'success':![],'message':_0x126466(0x1d8)});}_0x24bc97['json']({'success':!![],'message':_0x126466(0x204)+type+_0x126466(0x1e4)});}catch(_0xc9f988){_0x84fe9c(_0xc9f988);}};}}exports['TelegramController']=TelegramController;