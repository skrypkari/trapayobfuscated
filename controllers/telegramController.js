'use strict';function a12_0x2815(_0x4a214b,_0x6f90ab){const _0x1da494=a12_0x1da4();return a12_0x2815=function(_0x2815fb,_0x42c600){_0x2815fb=_0x2815fb-0x122;let _0x5d12ea=_0x1da494[_0x2815fb];return _0x5d12ea;},a12_0x2815(_0x4a214b,_0x6f90ab);}const a12_0x424d84=a12_0x2815;(function(_0xbeaa12,_0x24a4f6){const _0x26cd74=a12_0x2815,_0x859674=_0xbeaa12();while(!![]){try{const _0x679b41=parseInt(_0x26cd74(0x139))/0x1+-parseInt(_0x26cd74(0x14e))/0x2*(-parseInt(_0x26cd74(0x135))/0x3)+-parseInt(_0x26cd74(0x155))/0x4*(parseInt(_0x26cd74(0x151))/0x5)+parseInt(_0x26cd74(0x148))/0x6*(-parseInt(_0x26cd74(0x14b))/0x7)+-parseInt(_0x26cd74(0x134))/0x8+parseInt(_0x26cd74(0x137))/0x9+parseInt(_0x26cd74(0x12e))/0xa;if(_0x679b41===_0x24a4f6)break;else _0x859674['push'](_0x859674['shift']());}catch(_0x1dd4e5){_0x859674['push'](_0x859674['shift']());}}}(a12_0x1da4,0x208de));var __importDefault=this&&this[a12_0x424d84(0x152)]||function(_0x5a6d0c){return _0x5a6d0c&&_0x5a6d0c['__esModule']?_0x5a6d0c:{'default':_0x5a6d0c};};function a12_0x1da4(){const _0x2807f2=['TelegramController','method','telegramUser','test_payout_123','sendPaymentNotification','telegramId','sendCustomNotification','username','Test\x20','findMany','12DmvCeu','createdAt','lastName','67207lIzlXy','paid','Shop\x20ID\x20is\x20required','982daMxIi','../services/telegramBotService','disconnectUser','108755dXWadV','__importDefault','amount','getTelegramUsers','44AGilmy','json','default','isActive','update','Test\x20Product','isVerified','shop','Telegram\x20user\x20not\x20found','__esModule','custom','updatedAt','sendShopNotification','\x20notification\x20sent\x20successfully','groupBy','plisio','findUnique','telegramBotService','USD','gateway','body','defineProperty','Test\x20Notification','params','Broadcast\x20message\x20sent\x20successfully','title','productName','4677070QgPqZp','status','desc','map','getBotInfo','Markdown','2079984JNoaLk','237TiafZN','count','1120185WYHCjx','Message\x20is\x20required','20842UsEGmT','all','query','getBotStatus','shopId'];a12_0x1da4=function(){return _0x2807f2;};return a12_0x1da4();}Object[a12_0x424d84(0x128)](exports,a12_0x424d84(0x15e),{'value':!![]}),exports[a12_0x424d84(0x13e)]=void 0x0;const telegramBotService_1=require(a12_0x424d84(0x14f)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x480fd0=a12_0x424d84;this[_0x480fd0(0x13c)]=async(_0x34f4e2,_0x2dda0a,_0xbdf8c2)=>{const _0xc6297d=_0x480fd0;try{const _0xede5e9=telegramBotService_1[_0xc6297d(0x124)][_0xc6297d(0x132)](),_0x197d51=await database_1[_0xc6297d(0x157)][_0xc6297d(0x140)]['count'](),_0x45e1b3=await database_1['default']['telegramUser'][_0xc6297d(0x136)]({'where':{'isVerified':!![]}}),_0x3f1669=await database_1[_0xc6297d(0x157)][_0xc6297d(0x140)][_0xc6297d(0x163)]({'by':[_0xc6297d(0x13d)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2dda0a[_0xc6297d(0x156)]({'success':!![],'result':{'bot':{'isActive':_0xede5e9[_0xc6297d(0x158)],'username':_0xede5e9[_0xc6297d(0x145)]},'statistics':{'totalUsers':_0x197d51,'verifiedUsers':_0x45e1b3,'unverifiedUsers':_0x197d51-_0x45e1b3,'connectedShops':_0x3f1669['length']}}});}catch(_0x50ff3c){_0xbdf8c2(_0x50ff3c);}},this[_0x480fd0(0x154)]=async(_0x50cf8b,_0x39ccee,_0x512767)=>{const _0x4def68=_0x480fd0;try{const {page:page=0x1,limit:limit=0x14,verified:_0x332b3c}=_0x50cf8b[_0x4def68(0x13b)],_0x4b5925=(Number(page)-0x1)*Number(limit),_0x2f6ac0={};_0x332b3c!==undefined&&(_0x2f6ac0['isVerified']=_0x332b3c==='true');const [_0x347120,_0x1e0115]=await Promise[_0x4def68(0x13a)]([database_1[_0x4def68(0x157)][_0x4def68(0x140)][_0x4def68(0x147)]({'where':_0x2f6ac0,'skip':_0x4b5925,'take':Number(limit),'orderBy':{'createdAt':_0x4def68(0x130)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4def68(0x157)][_0x4def68(0x140)][_0x4def68(0x136)]({'where':_0x2f6ac0})]);_0x39ccee[_0x4def68(0x156)]({'success':!![],'users':_0x347120[_0x4def68(0x131)](_0x3e6b42=>({'id':_0x3e6b42['id'],'telegramId':_0x3e6b42[_0x4def68(0x143)],'username':_0x3e6b42['username'],'firstName':_0x3e6b42['firstName'],'lastName':_0x3e6b42[_0x4def68(0x14a)],'isVerified':_0x3e6b42[_0x4def68(0x15b)],'shop':_0x3e6b42['shop'],'createdAt':_0x3e6b42[_0x4def68(0x149)],'updatedAt':_0x3e6b42[_0x4def68(0x160)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1e0115,'totalPages':Math['ceil'](_0x1e0115/Number(limit))}});}catch(_0x23696f){_0x512767(_0x23696f);}},this['sendBroadcast']=async(_0x3ccd35,_0x3b3962,_0x4711fe)=>{const _0x28dd53=_0x480fd0;try{const {message:_0x36aabf,shopId:_0x321648}=_0x3ccd35['body'];if(!_0x36aabf)return _0x3b3962[_0x28dd53(0x12f)](0x190)[_0x28dd53(0x156)]({'success':![],'message':_0x28dd53(0x138)});if(_0x321648)await telegramBotService_1[_0x28dd53(0x124)][_0x28dd53(0x161)](_0x321648,_0x36aabf,{'parse_mode':_0x28dd53(0x133)});else{const _0x181f40=await database_1[_0x28dd53(0x157)]['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x8a7efb=[...new Set(_0x181f40[_0x28dd53(0x131)](_0x28fc56=>_0x28fc56[_0x28dd53(0x13d)])['filter'](Boolean))];for(const _0x4301b7 of _0x8a7efb){_0x4301b7&&await telegramBotService_1[_0x28dd53(0x124)]['sendShopNotification'](_0x4301b7,_0x36aabf,{'parse_mode':'Markdown'});}}_0x3b3962[_0x28dd53(0x156)]({'success':!![],'message':_0x28dd53(0x12b)});}catch(_0x3c67da){_0x4711fe(_0x3c67da);}},this[_0x480fd0(0x150)]=async(_0x1a151a,_0x15823a,_0x5b676e)=>{const _0x39ba15=_0x480fd0;try{const {telegramId:_0x1f2d6e}=_0x1a151a[_0x39ba15(0x12a)],_0x33cd3b=await database_1['default'][_0x39ba15(0x140)][_0x39ba15(0x123)]({'where':{'telegramId':_0x1f2d6e},'include':{'shop':!![]}});if(!_0x33cd3b)return _0x15823a['status'](0x194)[_0x39ba15(0x156)]({'success':![],'message':_0x39ba15(0x15d)});await database_1[_0x39ba15(0x157)][_0x39ba15(0x140)][_0x39ba15(0x159)]({'where':{'telegramId':_0x1f2d6e},'data':{'shopId':null,'isVerified':![]}}),_0x15823a[_0x39ba15(0x156)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x3cd6b3){_0x5b676e(_0x3cd6b3);}},this['sendTestNotification']=async(_0x2adf0f,_0x9ddf6e,_0x2ea641)=>{const _0x2c266d=_0x480fd0;try{const {shopId:_0x467cdc,type:type='payment',testData:_0x357eec}=_0x2adf0f[_0x2c266d(0x127)];if(!_0x467cdc)return _0x9ddf6e['status'](0x190)[_0x2c266d(0x156)]({'success':![],'message':_0x2c266d(0x14d)});const _0x3f4a5b=await database_1[_0x2c266d(0x157)][_0x2c266d(0x15c)][_0x2c266d(0x123)]({'where':{'id':_0x467cdc},'select':{'id':!![],'name':!![]}});if(!_0x3f4a5b)return _0x9ddf6e[_0x2c266d(0x12f)](0x194)[_0x2c266d(0x156)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0x2009df={'id':'test_payment_123','amount':_0x357eec?.['amount']||0x64,'currency':_0x357eec?.['currency']||_0x2c266d(0x125),'productName':_0x357eec?.[_0x2c266d(0x12d)]||_0x2c266d(0x15a),'gateway':_0x357eec?.[_0x2c266d(0x126)]||_0x2c266d(0x122),'createdAt':new Date(),..._0x357eec};await telegramBotService_1['telegramBotService'][_0x2c266d(0x142)](_0x467cdc,_0x2009df,_0x2c266d(0x14c));break;case'payout':const _0x11fd3a={'id':_0x2c266d(0x141),'amount':_0x357eec?.[_0x2c266d(0x153)]||0x1f4,'method':_0x357eec?.[_0x2c266d(0x13f)]||'bank_transfer','createdAt':new Date(),..._0x357eec};await telegramBotService_1[_0x2c266d(0x124)]['sendPayoutNotification'](_0x467cdc,_0x11fd3a,'completed');break;case _0x2c266d(0x15f):await telegramBotService_1['telegramBotService'][_0x2c266d(0x144)](_0x467cdc,_0x357eec?.[_0x2c266d(0x12c)]||_0x2c266d(0x129),_0x357eec?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x9ddf6e[_0x2c266d(0x12f)](0x190)[_0x2c266d(0x156)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x9ddf6e['json']({'success':!![],'message':_0x2c266d(0x146)+type+_0x2c266d(0x162)});}catch(_0x5064f1){_0x2ea641(_0x5064f1);}};}}exports[a12_0x424d84(0x13e)]=TelegramController;