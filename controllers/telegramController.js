'use strict';function a12_0x3bbf(_0x45f731,_0x3114f9){const _0xf4a604=a12_0xf4a6();return a12_0x3bbf=function(_0x3bbf55,_0x49fbfe){_0x3bbf55=_0x3bbf55-0x1ac;let _0x444572=_0xf4a604[_0x3bbf55];return _0x444572;},a12_0x3bbf(_0x45f731,_0x3114f9);}const a12_0x4615b6=a12_0x3bbf;(function(_0x435e08,_0x5a49f1){const _0x3b7099=a12_0x3bbf,_0x4de6cf=_0x435e08();while(!![]){try{const _0x1d3ea1=parseInt(_0x3b7099(0x1f2))/0x1+-parseInt(_0x3b7099(0x1e9))/0x2*(-parseInt(_0x3b7099(0x1ca))/0x3)+-parseInt(_0x3b7099(0x1c2))/0x4*(parseInt(_0x3b7099(0x1ad))/0x5)+parseInt(_0x3b7099(0x1d3))/0x6+-parseInt(_0x3b7099(0x1d6))/0x7*(-parseInt(_0x3b7099(0x1de))/0x8)+-parseInt(_0x3b7099(0x1db))/0x9*(-parseInt(_0x3b7099(0x1bc))/0xa)+-parseInt(_0x3b7099(0x1b7))/0xb;if(_0x1d3ea1===_0x5a49f1)break;else _0x4de6cf['push'](_0x4de6cf['shift']());}catch(_0x44b9f0){_0x4de6cf['push'](_0x4de6cf['shift']());}}}(a12_0xf4a6,0x725a3));function a12_0xf4a6(){const _0x129498=['399GANits','getBotInfo','sendPayoutNotification','custom','completed','sendTestNotification','__esModule','ceil','disconnectUser','2836860rmVjlR','productName','findUnique','242046cxoZbi','body','isVerified','User\x20disconnected\x20successfully','sendCustomNotification','5290317ZXDQzG','map','default','88fRRccP','title','createdAt','updatedAt','USD','defineProperty','Message\x20is\x20required','payout','count','telegramBotService','../config/database','3846HNxQeL','firstName','lastName','This\x20is\x20a\x20test\x20notification','payment','telegramUser','Test\x20Product','../services/telegramBotService','TelegramController','251673uVqcrx','all','json','3550270pmtJRT','status','Test\x20Notification','filter','details','method','groupBy','currency','sendPaymentNotification','shop','8469692ZUymvH','findMany','test_payout_123','Shop\x20ID\x20is\x20required','plisio','10FfbAfd','sendShopNotification','amount','Telegram\x20user\x20not\x20found','true','length','4bRrgWB','shopId','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','gateway','isActive','Broadcast\x20message\x20sent\x20successfully','paid','getBotStatus'];a12_0xf4a6=function(){return _0x129498;};return a12_0xf4a6();}var __importDefault=this&&this['__importDefault']||function(_0x1c4103){return _0x1c4103&&_0x1c4103['__esModule']?_0x1c4103:{'default':_0x1c4103};};Object[a12_0x4615b6(0x1e3)](exports,a12_0x4615b6(0x1d0),{'value':!![]}),exports[a12_0x4615b6(0x1f1)]=void 0x0;const telegramBotService_1=require(a12_0x4615b6(0x1f0)),database_1=__importDefault(require(a12_0x4615b6(0x1e8)));class TelegramController{constructor(){const _0x37e1f5=a12_0x4615b6;this[_0x37e1f5(0x1c9)]=async(_0x37c98b,_0x166bd0,_0x2883f3)=>{const _0x3618d0=_0x37e1f5;try{const _0x39cc7d=telegramBotService_1[_0x3618d0(0x1e7)][_0x3618d0(0x1cb)](),_0x263920=await database_1[_0x3618d0(0x1dd)][_0x3618d0(0x1ee)][_0x3618d0(0x1e6)](),_0x4b9e47=await database_1[_0x3618d0(0x1dd)][_0x3618d0(0x1ee)]['count']({'where':{'isVerified':!![]}}),_0x13ac96=await database_1[_0x3618d0(0x1dd)][_0x3618d0(0x1ee)][_0x3618d0(0x1b3)]({'by':[_0x3618d0(0x1c3)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x166bd0['json']({'success':!![],'result':{'bot':{'isActive':_0x39cc7d[_0x3618d0(0x1c6)],'username':_0x39cc7d['username']},'statistics':{'totalUsers':_0x263920,'verifiedUsers':_0x4b9e47,'unverifiedUsers':_0x263920-_0x4b9e47,'connectedShops':_0x13ac96[_0x3618d0(0x1c1)]}}});}catch(_0x463b7e){_0x2883f3(_0x463b7e);}},this['getTelegramUsers']=async(_0xca346,_0x338e37,_0x39d61e)=>{const _0x7dccf2=_0x37e1f5;try{const {page:page=0x1,limit:limit=0x14,verified:_0x403acd}=_0xca346['query'],_0x5ef34=(Number(page)-0x1)*Number(limit),_0x81c9ff={};_0x403acd!==undefined&&(_0x81c9ff[_0x7dccf2(0x1d8)]=_0x403acd===_0x7dccf2(0x1c0));const [_0x3733e1,_0x32fef0]=await Promise[_0x7dccf2(0x1f3)]([database_1[_0x7dccf2(0x1dd)]['telegramUser']['findMany']({'where':_0x81c9ff,'skip':_0x5ef34,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x7dccf2(0x1dd)]['telegramUser'][_0x7dccf2(0x1e6)]({'where':_0x81c9ff})]);_0x338e37[_0x7dccf2(0x1ac)]({'success':!![],'users':_0x3733e1[_0x7dccf2(0x1dc)](_0x31b5c6=>({'id':_0x31b5c6['id'],'telegramId':_0x31b5c6['telegramId'],'username':_0x31b5c6['username'],'firstName':_0x31b5c6[_0x7dccf2(0x1ea)],'lastName':_0x31b5c6[_0x7dccf2(0x1eb)],'isVerified':_0x31b5c6['isVerified'],'shop':_0x31b5c6[_0x7dccf2(0x1b6)],'createdAt':_0x31b5c6[_0x7dccf2(0x1e0)],'updatedAt':_0x31b5c6[_0x7dccf2(0x1e1)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x32fef0,'totalPages':Math[_0x7dccf2(0x1d1)](_0x32fef0/Number(limit))}});}catch(_0x5b9ce8){_0x39d61e(_0x5b9ce8);}},this['sendBroadcast']=async(_0x17ed4d,_0x13b679,_0x858db7)=>{const _0x53abd4=_0x37e1f5;try{const {message:_0x177888,shopId:_0x258619}=_0x17ed4d['body'];if(!_0x177888)return _0x13b679[_0x53abd4(0x1ae)](0x190)[_0x53abd4(0x1ac)]({'success':![],'message':_0x53abd4(0x1e4)});if(_0x258619)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x258619,_0x177888,{'parse_mode':'Markdown'});else{const _0x3246bd=await database_1[_0x53abd4(0x1dd)][_0x53abd4(0x1ee)][_0x53abd4(0x1b8)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x550a8a=[...new Set(_0x3246bd[_0x53abd4(0x1dc)](_0x48953a=>_0x48953a['shopId'])[_0x53abd4(0x1b0)](Boolean))];for(const _0x59cb29 of _0x550a8a){_0x59cb29&&await telegramBotService_1[_0x53abd4(0x1e7)][_0x53abd4(0x1bd)](_0x59cb29,_0x177888,{'parse_mode':'Markdown'});}}_0x13b679[_0x53abd4(0x1ac)]({'success':!![],'message':_0x53abd4(0x1c7)});}catch(_0x555edf){_0x858db7(_0x555edf);}},this[_0x37e1f5(0x1d2)]=async(_0x129bd8,_0x125568,_0x56e55e)=>{const _0x44edd5=_0x37e1f5;try{const {telegramId:_0x4a2aac}=_0x129bd8['params'],_0x1d0e27=await database_1[_0x44edd5(0x1dd)][_0x44edd5(0x1ee)]['findUnique']({'where':{'telegramId':_0x4a2aac},'include':{'shop':!![]}});if(!_0x1d0e27)return _0x125568[_0x44edd5(0x1ae)](0x194)['json']({'success':![],'message':_0x44edd5(0x1bf)});await database_1[_0x44edd5(0x1dd)][_0x44edd5(0x1ee)]['update']({'where':{'telegramId':_0x4a2aac},'data':{'shopId':null,'isVerified':![]}}),_0x125568['json']({'success':!![],'message':_0x44edd5(0x1d9)});}catch(_0x27456a){_0x56e55e(_0x27456a);}},this[_0x37e1f5(0x1cf)]=async(_0x52544f,_0x1073d4,_0xcc2bfa)=>{const _0xb969d1=_0x37e1f5;try{const {shopId:_0x1068b1,type:type=_0xb969d1(0x1ed),testData:_0x19abfc}=_0x52544f[_0xb969d1(0x1d7)];if(!_0x1068b1)return _0x1073d4[_0xb969d1(0x1ae)](0x190)['json']({'success':![],'message':_0xb969d1(0x1ba)});const _0x391538=await database_1[_0xb969d1(0x1dd)][_0xb969d1(0x1b6)][_0xb969d1(0x1d5)]({'where':{'id':_0x1068b1},'select':{'id':!![],'name':!![]}});if(!_0x391538)return _0x1073d4[_0xb969d1(0x1ae)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0xd94f87={'id':'test_payment_123','amount':_0x19abfc?.[_0xb969d1(0x1be)]||0x64,'currency':_0x19abfc?.[_0xb969d1(0x1b4)]||_0xb969d1(0x1e2),'productName':_0x19abfc?.[_0xb969d1(0x1d4)]||_0xb969d1(0x1ef),'gateway':_0x19abfc?.[_0xb969d1(0x1c5)]||_0xb969d1(0x1bb),'createdAt':new Date(),..._0x19abfc};await telegramBotService_1['telegramBotService'][_0xb969d1(0x1b5)](_0x1068b1,_0xd94f87,_0xb969d1(0x1c8));break;case _0xb969d1(0x1e5):const _0x3d3104={'id':_0xb969d1(0x1b9),'amount':_0x19abfc?.[_0xb969d1(0x1be)]||0x1f4,'method':_0x19abfc?.[_0xb969d1(0x1b2)]||'bank_transfer','createdAt':new Date(),..._0x19abfc};await telegramBotService_1[_0xb969d1(0x1e7)][_0xb969d1(0x1cc)](_0x1068b1,_0x3d3104,_0xb969d1(0x1ce));break;case _0xb969d1(0x1cd):await telegramBotService_1[_0xb969d1(0x1e7)][_0xb969d1(0x1da)](_0x1068b1,_0x19abfc?.[_0xb969d1(0x1df)]||_0xb969d1(0x1af),_0x19abfc?.[_0xb969d1(0x1b1)]||{'message':_0xb969d1(0x1ec)});break;default:return _0x1073d4['status'](0x190)[_0xb969d1(0x1ac)]({'success':![],'message':_0xb969d1(0x1c4)});}_0x1073d4[_0xb969d1(0x1ac)]({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x441a02){_0xcc2bfa(_0x441a02);}};}}exports[a12_0x4615b6(0x1f1)]=TelegramController;