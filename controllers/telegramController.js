'use strict';function a12_0x1a15(_0x598fd5,_0x52b0d0){const _0x12a303=a12_0x12a3();return a12_0x1a15=function(_0x1a15c0,_0x130abc){_0x1a15c0=_0x1a15c0-0xe3;let _0x43fdfa=_0x12a303[_0x1a15c0];return _0x43fdfa;},a12_0x1a15(_0x598fd5,_0x52b0d0);}const a12_0x2ab7e5=a12_0x1a15;(function(_0x555adc,_0x40dfbc){const _0x198dfa=a12_0x1a15,_0x5115c2=_0x555adc();while(!![]){try{const _0x3a3337=parseInt(_0x198dfa(0x101))/0x1*(parseInt(_0x198dfa(0x11c))/0x2)+parseInt(_0x198dfa(0x123))/0x3*(-parseInt(_0x198dfa(0xed))/0x4)+-parseInt(_0x198dfa(0x125))/0x5+-parseInt(_0x198dfa(0x11b))/0x6+parseInt(_0x198dfa(0x105))/0x7*(parseInt(_0x198dfa(0x10b))/0x8)+parseInt(_0x198dfa(0xfc))/0x9*(-parseInt(_0x198dfa(0x117))/0xa)+parseInt(_0x198dfa(0xf4))/0xb;if(_0x3a3337===_0x40dfbc)break;else _0x5115c2['push'](_0x5115c2['shift']());}catch(_0x1d6423){_0x5115c2['push'](_0x5115c2['shift']());}}}(a12_0x12a3,0xdd6ba));var __importDefault=this&&this[a12_0x2ab7e5(0x111)]||function(_0x598131){const _0x89c77e=a12_0x2ab7e5;return _0x598131&&_0x598131[_0x89c77e(0x10e)]?_0x598131:{'default':_0x598131};};Object['defineProperty'](exports,a12_0x2ab7e5(0x10e),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x2ab7e5(0x11f)),database_1=__importDefault(require(a12_0x2ab7e5(0xe9)));class TelegramController{constructor(){const _0x14a238=a12_0x2ab7e5;this[_0x14a238(0x10f)]=async(_0x29f5cc,_0x56a0b1,_0x518de4)=>{const _0x13c96c=_0x14a238;try{const _0x160f07=telegramBotService_1['telegramBotService']['getBotInfo'](),_0x5b16fb=await database_1[_0x13c96c(0x10d)]['telegramUser'][_0x13c96c(0x119)](),_0x3f4636=await database_1['default'][_0x13c96c(0x10c)][_0x13c96c(0x119)]({'where':{'isVerified':!![]}}),_0x42686f=await database_1['default']['telegramUser'][_0x13c96c(0x116)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x56a0b1[_0x13c96c(0xf6)]({'success':!![],'result':{'bot':{'isActive':_0x160f07['isActive'],'username':_0x160f07[_0x13c96c(0xf5)]},'statistics':{'totalUsers':_0x5b16fb,'verifiedUsers':_0x3f4636,'unverifiedUsers':_0x5b16fb-_0x3f4636,'connectedShops':_0x42686f['length']}}});}catch(_0x15d0fe){_0x518de4(_0x15d0fe);}},this['getTelegramUsers']=async(_0x4fff70,_0x51d92f,_0x26577c)=>{const _0x16f773=_0x14a238;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2bd80a}=_0x4fff70['query'],_0x3caa55=(Number(page)-0x1)*Number(limit),_0x366ee0={};_0x2bd80a!==undefined&&(_0x366ee0[_0x16f773(0xe5)]=_0x2bd80a==='true');const [_0x372bc9,_0x177567]=await Promise[_0x16f773(0xf1)]([database_1['default'][_0x16f773(0x10c)][_0x16f773(0xf8)]({'where':_0x366ee0,'skip':_0x3caa55,'take':Number(limit),'orderBy':{'createdAt':_0x16f773(0xfb)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x16f773(0x10d)][_0x16f773(0x10c)][_0x16f773(0x119)]({'where':_0x366ee0})]);_0x51d92f['json']({'success':!![],'users':_0x372bc9['map'](_0x1f7cfc=>({'id':_0x1f7cfc['id'],'telegramId':_0x1f7cfc[_0x16f773(0xe4)],'username':_0x1f7cfc['username'],'firstName':_0x1f7cfc[_0x16f773(0xe7)],'lastName':_0x1f7cfc['lastName'],'isVerified':_0x1f7cfc['isVerified'],'shop':_0x1f7cfc[_0x16f773(0xff)],'createdAt':_0x1f7cfc['createdAt'],'updatedAt':_0x1f7cfc[_0x16f773(0xf3)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x177567,'totalPages':Math[_0x16f773(0xf7)](_0x177567/Number(limit))}});}catch(_0x5c7abb){_0x26577c(_0x5c7abb);}},this['sendBroadcast']=async(_0x48b4da,_0xc45a74,_0x545cb3)=>{const _0x5175e9=_0x14a238;try{const {message:_0x350873,shopId:_0x1fc709}=_0x48b4da['body'];if(!_0x350873)return _0xc45a74[_0x5175e9(0x11a)](0x190)[_0x5175e9(0xf6)]({'success':![],'message':_0x5175e9(0xf0)});if(_0x1fc709)await telegramBotService_1['telegramBotService'][_0x5175e9(0x106)](_0x1fc709,_0x350873,{'parse_mode':_0x5175e9(0x100)});else{const _0xccef7c=await database_1[_0x5175e9(0x10d)][_0x5175e9(0x10c)][_0x5175e9(0xf8)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xd4f0a=[...new Set(_0xccef7c[_0x5175e9(0x120)](_0x5531ab=>_0x5531ab[_0x5175e9(0x126)])[_0x5175e9(0x104)](Boolean))];for(const _0x4cce78 of _0xd4f0a){_0x4cce78&&await telegramBotService_1[_0x5175e9(0x112)][_0x5175e9(0x106)](_0x4cce78,_0x350873,{'parse_mode':_0x5175e9(0x100)});}}_0xc45a74[_0x5175e9(0xf6)]({'success':!![],'message':_0x5175e9(0x108)});}catch(_0x38f15a){_0x545cb3(_0x38f15a);}},this['disconnectUser']=async(_0xdcccdf,_0x279dbe,_0x3391e4)=>{const _0x213531=_0x14a238;try{const {telegramId:_0x33e9dc}=_0xdcccdf['params'],_0x1a4f93=await database_1[_0x213531(0x10d)]['telegramUser']['findUnique']({'where':{'telegramId':_0x33e9dc},'include':{'shop':!![]}});if(!_0x1a4f93)return _0x279dbe[_0x213531(0x11a)](0x194)['json']({'success':![],'message':_0x213531(0x11e)});await database_1[_0x213531(0x10d)][_0x213531(0x10c)][_0x213531(0xea)]({'where':{'telegramId':_0x33e9dc},'data':{'shopId':null,'isVerified':![]}}),_0x279dbe[_0x213531(0xf6)]({'success':!![],'message':_0x213531(0xeb)});}catch(_0x585de5){_0x3391e4(_0x585de5);}},this[_0x14a238(0x127)]=async(_0x3d631a,_0x33f8c2,_0x43c611)=>{const _0x36d787=_0x14a238;try{const {shopId:_0x1138d0,type:type=_0x36d787(0xfe),testData:_0x15d97c}=_0x3d631a[_0x36d787(0x11d)];if(!_0x1138d0)return _0x33f8c2[_0x36d787(0x11a)](0x190)[_0x36d787(0xf6)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x1b9a3f=await database_1[_0x36d787(0x10d)][_0x36d787(0xff)][_0x36d787(0x124)]({'where':{'id':_0x1138d0},'select':{'id':!![],'name':!![]}});if(!_0x1b9a3f)return _0x33f8c2['status'](0x194)[_0x36d787(0xf6)]({'success':![],'message':_0x36d787(0xe6)});switch(type){case _0x36d787(0xfe):const _0x102061={'id':_0x36d787(0xe8),'amount':_0x15d97c?.['amount']||0x64,'currency':_0x15d97c?.[_0x36d787(0x115)]||'USD','productName':_0x15d97c?.[_0x36d787(0x113)]||_0x36d787(0x122),'gateway':_0x15d97c?.[_0x36d787(0x102)]||'plisio','createdAt':new Date(),..._0x15d97c};await telegramBotService_1[_0x36d787(0x112)][_0x36d787(0x118)](_0x1138d0,_0x102061,'paid');break;case _0x36d787(0xee):const _0x258ea5={'id':'test_payout_123','amount':_0x15d97c?.[_0x36d787(0x121)]||0x1f4,'method':_0x15d97c?.[_0x36d787(0xec)]||_0x36d787(0x10a),'createdAt':new Date(),..._0x15d97c};await telegramBotService_1[_0x36d787(0x112)][_0x36d787(0xe3)](_0x1138d0,_0x258ea5,_0x36d787(0xf9));break;case _0x36d787(0xf2):await telegramBotService_1[_0x36d787(0x112)][_0x36d787(0xfa)](_0x1138d0,_0x15d97c?.[_0x36d787(0x107)]||_0x36d787(0x114),_0x15d97c?.[_0x36d787(0x103)]||{'message':_0x36d787(0x109)});break;default:return _0x33f8c2['status'](0x190)[_0x36d787(0xf6)]({'success':![],'message':_0x36d787(0xfd)});}_0x33f8c2[_0x36d787(0xf6)]({'success':!![],'message':_0x36d787(0xef)+type+_0x36d787(0x110)});}catch(_0x2d02a9){_0x43c611(_0x2d02a9);}};}}exports['TelegramController']=TelegramController;function a12_0x12a3(){const _0x2957e7=['filter','11655469oZIZfO','sendShopNotification','title','Broadcast\x20message\x20sent\x20successfully','This\x20is\x20a\x20test\x20notification','bank_transfer','8sZMQny','telegramUser','default','__esModule','getBotStatus','\x20notification\x20sent\x20successfully','__importDefault','telegramBotService','productName','Test\x20Notification','currency','groupBy','10dPDnxJ','sendPaymentNotification','count','status','7734864AEKegh','10DlcIUj','body','Telegram\x20user\x20not\x20found','../services/telegramBotService','map','amount','Test\x20Product','3NQBDch','findUnique','1454680jbSahN','shopId','sendTestNotification','sendPayoutNotification','telegramId','isVerified','Shop\x20not\x20found','firstName','test_payment_123','../config/database','update','User\x20disconnected\x20successfully','method','1527940vEhYzZ','payout','Test\x20','Message\x20is\x20required','all','custom','updatedAt','12534214ooFFtV','username','json','ceil','findMany','completed','sendCustomNotification','desc','19377ZFhWvp','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','payment','shop','Markdown','13323BqRROu','gateway','details'];a12_0x12a3=function(){return _0x2957e7;};return a12_0x12a3();}