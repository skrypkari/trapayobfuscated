'use strict';const a13_0x1a37bc=a13_0xb012;(function(_0x503a3d,_0x49da1e){const _0x40d5a4=a13_0xb012,_0x5f2b37=_0x503a3d();while(!![]){try{const _0x3b03e2=-parseInt(_0x40d5a4(0x18b))/0x1*(parseInt(_0x40d5a4(0x1ac))/0x2)+-parseInt(_0x40d5a4(0x188))/0x3+parseInt(_0x40d5a4(0x1c7))/0x4*(-parseInt(_0x40d5a4(0x1b9))/0x5)+-parseInt(_0x40d5a4(0x1a5))/0x6+-parseInt(_0x40d5a4(0x1c2))/0x7*(parseInt(_0x40d5a4(0x1aa))/0x8)+parseInt(_0x40d5a4(0x19d))/0x9*(parseInt(_0x40d5a4(0x1a0))/0xa)+-parseInt(_0x40d5a4(0x1cb))/0xb*(-parseInt(_0x40d5a4(0x193))/0xc);if(_0x3b03e2===_0x49da1e)break;else _0x5f2b37['push'](_0x5f2b37['shift']());}catch(_0x456f77){_0x5f2b37['push'](_0x5f2b37['shift']());}}}(a13_0x5d6c,0xe367f));var __importDefault=this&&this[a13_0x1a37bc(0x1c4)]||function(_0x130b0e){const _0x526fec=a13_0x1a37bc;return _0x130b0e&&_0x130b0e[_0x526fec(0x1ae)]?_0x130b0e:{'default':_0x130b0e};};function a13_0x5d6c(){const _0x385014=['test_payout_123','68104668FVzdDF','Message\x20is\x20required','title','productName','Test\x20Notification','firstName','getTelegramUsers','bank_transfer','filter','custom','1321416ZGmVul','completed','Test\x20Product','10sjwDFx','isActive','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','username','plisio','6628152QADNPO','amount','ceil','currency','User\x20disconnected\x20successfully','1711400ATqnzK','groupBy','110932hLLkMk','json','__esModule','Markdown','body','desc','disconnectUser','shop','sendTestNotification','telegramBotService','Test\x20','sendCustomNotification','createdAt','15nmQqMl','findMany','sendShopNotification','update','Shop\x20not\x20found','default','status','findUnique','test_payment_123','21dOzGhg','lastName','__importDefault','getBotInfo','telegramUser','169028CdqQyX','paid','USD','Shop\x20ID\x20is\x20required','11Idsvue','isVerified','defineProperty','payout','gateway','payment','TelegramController','count','sendPaymentNotification','4892610JcCyrm','map','Telegram\x20user\x20not\x20found','25yZIvEb','shopId','params','true','sendBroadcast','updatedAt','details'];a13_0x5d6c=function(){return _0x385014;};return a13_0x5d6c();}Object[a13_0x1a37bc(0x1cd)](exports,'__esModule',{'value':!![]}),exports[a13_0x1a37bc(0x185)]=void 0x0;function a13_0xb012(_0x164aa4,_0x22001d){const _0x5d6c66=a13_0x5d6c();return a13_0xb012=function(_0xb01273,_0x188038){_0xb01273=_0xb01273-0x184;let _0x4a3b78=_0x5d6c66[_0xb01273];return _0x4a3b78;},a13_0xb012(_0x164aa4,_0x22001d);}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x5ab64f=a13_0x1a37bc;this['getBotStatus']=async(_0x34d65c,_0x8478d0,_0x19876f)=>{const _0x2aa7a5=a13_0xb012;try{const _0x3ba201=telegramBotService_1[_0x2aa7a5(0x1b5)][_0x2aa7a5(0x1c5)](),_0x314a1c=await database_1['default'][_0x2aa7a5(0x1c6)][_0x2aa7a5(0x186)](),_0x5aa25f=await database_1['default']['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x13cc3a=await database_1[_0x2aa7a5(0x1be)][_0x2aa7a5(0x1c6)][_0x2aa7a5(0x1ab)]({'by':[_0x2aa7a5(0x18c)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x8478d0[_0x2aa7a5(0x1ad)]({'success':!![],'result':{'bot':{'isActive':_0x3ba201[_0x2aa7a5(0x1a1)],'username':_0x3ba201[_0x2aa7a5(0x1a3)]},'statistics':{'totalUsers':_0x314a1c,'verifiedUsers':_0x5aa25f,'unverifiedUsers':_0x314a1c-_0x5aa25f,'connectedShops':_0x13cc3a['length']}}});}catch(_0x42dbe9){_0x19876f(_0x42dbe9);}},this[_0x5ab64f(0x199)]=async(_0x4139fd,_0xb06dc6,_0x481b97)=>{const _0x482ec5=_0x5ab64f;try{const {page:page=0x1,limit:limit=0x14,verified:_0x106da1}=_0x4139fd['query'],_0x3e51dc=(Number(page)-0x1)*Number(limit),_0x1608d8={};_0x106da1!==undefined&&(_0x1608d8[_0x482ec5(0x1cc)]=_0x106da1===_0x482ec5(0x18e));const [_0x537e5b,_0x51bfbd]=await Promise['all']([database_1[_0x482ec5(0x1be)][_0x482ec5(0x1c6)][_0x482ec5(0x1ba)]({'where':_0x1608d8,'skip':_0x3e51dc,'take':Number(limit),'orderBy':{'createdAt':_0x482ec5(0x1b1)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x482ec5(0x1c6)][_0x482ec5(0x186)]({'where':_0x1608d8})]);_0xb06dc6[_0x482ec5(0x1ad)]({'success':!![],'users':_0x537e5b[_0x482ec5(0x189)](_0x3181c1=>({'id':_0x3181c1['id'],'telegramId':_0x3181c1['telegramId'],'username':_0x3181c1[_0x482ec5(0x1a3)],'firstName':_0x3181c1[_0x482ec5(0x198)],'lastName':_0x3181c1[_0x482ec5(0x1c3)],'isVerified':_0x3181c1[_0x482ec5(0x1cc)],'shop':_0x3181c1[_0x482ec5(0x1b3)],'createdAt':_0x3181c1[_0x482ec5(0x1b8)],'updatedAt':_0x3181c1[_0x482ec5(0x190)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x51bfbd,'totalPages':Math[_0x482ec5(0x1a7)](_0x51bfbd/Number(limit))}});}catch(_0x1667ba){_0x481b97(_0x1667ba);}},this[_0x5ab64f(0x18f)]=async(_0x181ea1,_0x4e0325,_0x44c02a)=>{const _0x4bb1c1=_0x5ab64f;try{const {message:_0x53264f,shopId:_0x37a748}=_0x181ea1[_0x4bb1c1(0x1b0)];if(!_0x53264f)return _0x4e0325[_0x4bb1c1(0x1bf)](0x190)['json']({'success':![],'message':_0x4bb1c1(0x194)});if(_0x37a748)await telegramBotService_1[_0x4bb1c1(0x1b5)][_0x4bb1c1(0x1bb)](_0x37a748,_0x53264f,{'parse_mode':_0x4bb1c1(0x1af)});else{const _0x132238=await database_1[_0x4bb1c1(0x1be)][_0x4bb1c1(0x1c6)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x526bfc=[...new Set(_0x132238[_0x4bb1c1(0x189)](_0x2cd3b2=>_0x2cd3b2[_0x4bb1c1(0x18c)])[_0x4bb1c1(0x19b)](Boolean))];for(const _0x37e6ad of _0x526bfc){_0x37e6ad&&await telegramBotService_1['telegramBotService'][_0x4bb1c1(0x1bb)](_0x37e6ad,_0x53264f,{'parse_mode':_0x4bb1c1(0x1af)});}}_0x4e0325['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x856f6){_0x44c02a(_0x856f6);}},this[_0x5ab64f(0x1b2)]=async(_0x434097,_0x1f1fb3,_0x573278)=>{const _0x3d124a=_0x5ab64f;try{const {telegramId:_0x389354}=_0x434097[_0x3d124a(0x18d)],_0x378e2c=await database_1[_0x3d124a(0x1be)][_0x3d124a(0x1c6)]['findUnique']({'where':{'telegramId':_0x389354},'include':{'shop':!![]}});if(!_0x378e2c)return _0x1f1fb3[_0x3d124a(0x1bf)](0x194)['json']({'success':![],'message':_0x3d124a(0x18a)});await database_1['default'][_0x3d124a(0x1c6)][_0x3d124a(0x1bc)]({'where':{'telegramId':_0x389354},'data':{'shopId':null,'isVerified':![]}}),_0x1f1fb3['json']({'success':!![],'message':_0x3d124a(0x1a9)});}catch(_0x5adada){_0x573278(_0x5adada);}},this[_0x5ab64f(0x1b4)]=async(_0x3be221,_0x476b1c,_0x601057)=>{const _0x304214=_0x5ab64f;try{const {shopId:_0x5c9e10,type:type=_0x304214(0x184),testData:_0x4460da}=_0x3be221[_0x304214(0x1b0)];if(!_0x5c9e10)return _0x476b1c[_0x304214(0x1bf)](0x190)[_0x304214(0x1ad)]({'success':![],'message':_0x304214(0x1ca)});const _0x27a5bd=await database_1[_0x304214(0x1be)][_0x304214(0x1b3)][_0x304214(0x1c0)]({'where':{'id':_0x5c9e10},'select':{'id':!![],'name':!![]}});if(!_0x27a5bd)return _0x476b1c[_0x304214(0x1bf)](0x194)['json']({'success':![],'message':_0x304214(0x1bd)});switch(type){case'payment':const _0x2f4585={'id':_0x304214(0x1c1),'amount':_0x4460da?.[_0x304214(0x1a6)]||0x64,'currency':_0x4460da?.[_0x304214(0x1a8)]||_0x304214(0x1c9),'productName':_0x4460da?.[_0x304214(0x196)]||_0x304214(0x19f),'gateway':_0x4460da?.[_0x304214(0x1cf)]||_0x304214(0x1a4),'createdAt':new Date(),..._0x4460da};await telegramBotService_1['telegramBotService'][_0x304214(0x187)](_0x5c9e10,_0x2f4585,_0x304214(0x1c8));break;case _0x304214(0x1ce):const _0x5dd2de={'id':_0x304214(0x192),'amount':_0x4460da?.[_0x304214(0x1a6)]||0x1f4,'method':_0x4460da?.['method']||_0x304214(0x19a),'createdAt':new Date(),..._0x4460da};await telegramBotService_1[_0x304214(0x1b5)]['sendPayoutNotification'](_0x5c9e10,_0x5dd2de,_0x304214(0x19e));break;case _0x304214(0x19c):await telegramBotService_1['telegramBotService'][_0x304214(0x1b7)](_0x5c9e10,_0x4460da?.[_0x304214(0x195)]||_0x304214(0x197),_0x4460da?.[_0x304214(0x191)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x476b1c[_0x304214(0x1bf)](0x190)[_0x304214(0x1ad)]({'success':![],'message':_0x304214(0x1a2)});}_0x476b1c[_0x304214(0x1ad)]({'success':!![],'message':_0x304214(0x1b6)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x5ae5ef){_0x601057(_0x5ae5ef);}};}}exports[a13_0x1a37bc(0x185)]=TelegramController;