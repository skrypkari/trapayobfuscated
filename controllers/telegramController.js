'use strict';const a12_0x4a6e3b=a12_0x29cd;function a12_0x29cd(_0x12a312,_0xf39b8a){const _0x23a831=a12_0x23a8();return a12_0x29cd=function(_0x29cd5a,_0x3c856e){_0x29cd5a=_0x29cd5a-0xf9;let _0x280017=_0x23a831[_0x29cd5a];return _0x280017;},a12_0x29cd(_0x12a312,_0xf39b8a);}(function(_0x5198a0,_0x2a4454){const _0x19633c=a12_0x29cd,_0x32a9a1=_0x5198a0();while(!![]){try{const _0x3471d4=parseInt(_0x19633c(0x11c))/0x1*(-parseInt(_0x19633c(0x139))/0x2)+-parseInt(_0x19633c(0x13a))/0x3*(parseInt(_0x19633c(0xff))/0x4)+parseInt(_0x19633c(0xfc))/0x5*(-parseInt(_0x19633c(0x11f))/0x6)+parseInt(_0x19633c(0x12f))/0x7+-parseInt(_0x19633c(0x100))/0x8*(-parseInt(_0x19633c(0x115))/0x9)+-parseInt(_0x19633c(0xfb))/0xa*(-parseInt(_0x19633c(0x12e))/0xb)+parseInt(_0x19633c(0x138))/0xc;if(_0x3471d4===_0x2a4454)break;else _0x32a9a1['push'](_0x32a9a1['shift']());}catch(_0x3e20f0){_0x32a9a1['push'](_0x32a9a1['shift']());}}}(a12_0x23a8,0xe34c2));var __importDefault=this&&this[a12_0x4a6e3b(0x13e)]||function(_0x5d1ed7){const _0x1f9a73=a12_0x4a6e3b;return _0x5d1ed7&&_0x5d1ed7[_0x1f9a73(0x122)]?_0x5d1ed7:{'default':_0x5d1ed7};};Object[a12_0x4a6e3b(0x133)](exports,'__esModule',{'value':!![]}),exports[a12_0x4a6e3b(0x142)]=void 0x0;const telegramBotService_1=require(a12_0x4a6e3b(0x121)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0xd2b172=a12_0x4a6e3b;this[_0xd2b172(0x13c)]=async(_0x4e0441,_0x3dae74,_0x20d37f)=>{const _0x52e3eb=_0xd2b172;try{const _0x8ca203=telegramBotService_1[_0x52e3eb(0x140)][_0x52e3eb(0x10a)](),_0xa9393f=await database_1[_0x52e3eb(0x107)][_0x52e3eb(0x102)][_0x52e3eb(0x10b)](),_0x1ead02=await database_1[_0x52e3eb(0x107)]['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x76c539=await database_1[_0x52e3eb(0x107)][_0x52e3eb(0x102)]['groupBy']({'by':[_0x52e3eb(0x101)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3dae74[_0x52e3eb(0xfa)]({'success':!![],'result':{'bot':{'isActive':_0x8ca203['isActive'],'username':_0x8ca203[_0x52e3eb(0x129)]},'statistics':{'totalUsers':_0xa9393f,'verifiedUsers':_0x1ead02,'unverifiedUsers':_0xa9393f-_0x1ead02,'connectedShops':_0x76c539[_0x52e3eb(0x13b)]}}});}catch(_0x2e7719){_0x20d37f(_0x2e7719);}},this['getTelegramUsers']=async(_0x2aeb,_0x3fba01,_0x354727)=>{const _0x35f4b3=_0xd2b172;try{const {page:page=0x1,limit:limit=0x14,verified:_0xe5b2c6}=_0x2aeb[_0x35f4b3(0x12a)],_0x30f338=(Number(page)-0x1)*Number(limit),_0x3ba898={};_0xe5b2c6!==undefined&&(_0x3ba898[_0x35f4b3(0x130)]=_0xe5b2c6===_0x35f4b3(0x124));const [_0x1d4af7,_0x1fd9d2]=await Promise[_0x35f4b3(0x136)]([database_1[_0x35f4b3(0x107)][_0x35f4b3(0x102)]['findMany']({'where':_0x3ba898,'skip':_0x30f338,'take':Number(limit),'orderBy':{'createdAt':_0x35f4b3(0x118)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x35f4b3(0x107)]['telegramUser'][_0x35f4b3(0x10b)]({'where':_0x3ba898})]);_0x3fba01[_0x35f4b3(0xfa)]({'success':!![],'users':_0x1d4af7[_0x35f4b3(0x113)](_0x3048f7=>({'id':_0x3048f7['id'],'telegramId':_0x3048f7[_0x35f4b3(0xf9)],'username':_0x3048f7[_0x35f4b3(0x129)],'firstName':_0x3048f7[_0x35f4b3(0x114)],'lastName':_0x3048f7[_0x35f4b3(0x10f)],'isVerified':_0x3048f7['isVerified'],'shop':_0x3048f7[_0x35f4b3(0x119)],'createdAt':_0x3048f7['createdAt'],'updatedAt':_0x3048f7['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1fd9d2,'totalPages':Math[_0x35f4b3(0x11b)](_0x1fd9d2/Number(limit))}});}catch(_0xe5d014){_0x354727(_0xe5d014);}},this[_0xd2b172(0x131)]=async(_0x18a75b,_0x4a35a9,_0x58e9f3)=>{const _0x12f0ee=_0xd2b172;try{const {message:_0x92449f,shopId:_0x521cec}=_0x18a75b[_0x12f0ee(0x10c)];if(!_0x92449f)return _0x4a35a9[_0x12f0ee(0x134)](0x190)['json']({'success':![],'message':_0x12f0ee(0x10e)});if(_0x521cec)await telegramBotService_1[_0x12f0ee(0x140)][_0x12f0ee(0x112)](_0x521cec,_0x92449f,{'parse_mode':_0x12f0ee(0x13f)});else{const _0x54cf4f=await database_1[_0x12f0ee(0x107)][_0x12f0ee(0x102)][_0x12f0ee(0x103)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4e7e3a=[...new Set(_0x54cf4f[_0x12f0ee(0x113)](_0x8fd551=>_0x8fd551[_0x12f0ee(0x101)])[_0x12f0ee(0x108)](Boolean))];for(const _0x52ea88 of _0x4e7e3a){_0x52ea88&&await telegramBotService_1[_0x12f0ee(0x140)][_0x12f0ee(0x112)](_0x52ea88,_0x92449f,{'parse_mode':_0x12f0ee(0x13f)});}}_0x4a35a9[_0x12f0ee(0xfa)]({'success':!![],'message':_0x12f0ee(0x104)});}catch(_0x82c3e2){_0x58e9f3(_0x82c3e2);}},this[_0xd2b172(0x10d)]=async(_0x5853de,_0x17339f,_0x271139)=>{const _0x4f2b47=_0xd2b172;try{const {telegramId:_0x37fd74}=_0x5853de[_0x4f2b47(0x128)],_0x5410ca=await database_1[_0x4f2b47(0x107)][_0x4f2b47(0x102)][_0x4f2b47(0x125)]({'where':{'telegramId':_0x37fd74},'include':{'shop':!![]}});if(!_0x5410ca)return _0x17339f[_0x4f2b47(0x134)](0x194)[_0x4f2b47(0xfa)]({'success':![],'message':_0x4f2b47(0x137)});await database_1[_0x4f2b47(0x107)]['telegramUser'][_0x4f2b47(0x106)]({'where':{'telegramId':_0x37fd74},'data':{'shopId':null,'isVerified':![]}}),_0x17339f[_0x4f2b47(0xfa)]({'success':!![],'message':_0x4f2b47(0x11d)});}catch(_0x5e6a8d){_0x271139(_0x5e6a8d);}},this['sendTestNotification']=async(_0x473efc,_0x30b3e0,_0x219193)=>{const _0x502cf8=_0xd2b172;try{const {shopId:_0x5b8b9f,type:type=_0x502cf8(0x120),testData:_0x339cde}=_0x473efc[_0x502cf8(0x10c)];if(!_0x5b8b9f)return _0x30b3e0[_0x502cf8(0x134)](0x190)[_0x502cf8(0xfa)]({'success':![],'message':_0x502cf8(0xfd)});const _0x4a268d=await database_1[_0x502cf8(0x107)]['shop']['findUnique']({'where':{'id':_0x5b8b9f},'select':{'id':!![],'name':!![]}});if(!_0x4a268d)return _0x30b3e0['status'](0x194)[_0x502cf8(0xfa)]({'success':![],'message':_0x502cf8(0xfe)});switch(type){case _0x502cf8(0x120):const _0x5e0576={'id':_0x502cf8(0x12b),'amount':_0x339cde?.[_0x502cf8(0x12d)]||0x64,'currency':_0x339cde?.[_0x502cf8(0x141)]||_0x502cf8(0x105),'productName':_0x339cde?.['productName']||_0x502cf8(0x123),'gateway':_0x339cde?.[_0x502cf8(0x111)]||_0x502cf8(0x143),'createdAt':new Date(),..._0x339cde};await telegramBotService_1[_0x502cf8(0x140)][_0x502cf8(0x12c)](_0x5b8b9f,_0x5e0576,_0x502cf8(0x126));break;case _0x502cf8(0x135):const _0x13888d={'id':'test_payout_123','amount':_0x339cde?.['amount']||0x1f4,'method':_0x339cde?.[_0x502cf8(0x117)]||'bank_transfer','createdAt':new Date(),..._0x339cde};await telegramBotService_1[_0x502cf8(0x140)][_0x502cf8(0x110)](_0x5b8b9f,_0x13888d,_0x502cf8(0x116));break;case _0x502cf8(0x11e):await telegramBotService_1['telegramBotService'][_0x502cf8(0x144)](_0x5b8b9f,_0x339cde?.[_0x502cf8(0x13d)]||'Test\x20Notification',_0x339cde?.[_0x502cf8(0x109)]||{'message':_0x502cf8(0x132)});break;default:return _0x30b3e0[_0x502cf8(0x134)](0x190)[_0x502cf8(0xfa)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x30b3e0[_0x502cf8(0xfa)]({'success':!![],'message':_0x502cf8(0x11a)+type+_0x502cf8(0x127)});}catch(_0x51149c){_0x219193(_0x51149c);}};}}exports[a12_0x4a6e3b(0x142)]=TelegramController;function a12_0x23a8(){const _0x249d4c=['Telegram\x20user\x20not\x20found','2760468DaIvgH','1477434Uvenxi','153861BWiogc','length','getBotStatus','title','__importDefault','Markdown','telegramBotService','currency','TelegramController','plisio','sendCustomNotification','telegramId','json','80BtgpHb','4585ZVCaBR','Shop\x20ID\x20is\x20required','Shop\x20not\x20found','92alwOma','8VMJObS','shopId','telegramUser','findMany','Broadcast\x20message\x20sent\x20successfully','USD','update','default','filter','details','getBotInfo','count','body','disconnectUser','Message\x20is\x20required','lastName','sendPayoutNotification','gateway','sendShopNotification','map','firstName','10732698RWqOId','completed','method','desc','shop','Test\x20','ceil','1tENPxM','User\x20disconnected\x20successfully','custom','972tMcGoO','payment','../services/telegramBotService','__esModule','Test\x20Product','true','findUnique','paid','\x20notification\x20sent\x20successfully','params','username','query','test_payment_123','sendPaymentNotification','amount','1869142IRpyLk','1511615uUiFwh','isVerified','sendBroadcast','This\x20is\x20a\x20test\x20notification','defineProperty','status','payout','all'];a12_0x23a8=function(){return _0x249d4c;};return a12_0x23a8();}