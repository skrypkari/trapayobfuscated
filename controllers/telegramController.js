'use strict';const a12_0x15ca4b=a12_0x5d1a;(function(_0x1d600b,_0x1ead1f){const _0x37585f=a12_0x5d1a,_0x24560f=_0x1d600b();while(!![]){try{const _0x14940d=parseInt(_0x37585f(0x114))/0x1*(-parseInt(_0x37585f(0xe3))/0x2)+-parseInt(_0x37585f(0xf8))/0x3*(parseInt(_0x37585f(0x11f))/0x4)+parseInt(_0x37585f(0x102))/0x5*(-parseInt(_0x37585f(0xf3))/0x6)+parseInt(_0x37585f(0x10b))/0x7*(parseInt(_0x37585f(0x101))/0x8)+-parseInt(_0x37585f(0x115))/0x9*(parseInt(_0x37585f(0xef))/0xa)+parseInt(_0x37585f(0xf0))/0xb+parseInt(_0x37585f(0x122))/0xc;if(_0x14940d===_0x1ead1f)break;else _0x24560f['push'](_0x24560f['shift']());}catch(_0x2f8081){_0x24560f['push'](_0x24560f['shift']());}}}(a12_0x230b,0xdd626));var __importDefault=this&&this[a12_0x15ca4b(0x10f)]||function(_0x44a9b1){const _0x52cd57=a12_0x15ca4b;return _0x44a9b1&&_0x44a9b1[_0x52cd57(0x100)]?_0x44a9b1:{'default':_0x44a9b1};};function a12_0x230b(){const _0x16bad8=['Message\x20is\x20required','sendPaymentNotification','TelegramController','__esModule','13814776NFXIbi','20FuvPIR','sendBroadcast','Telegram\x20user\x20not\x20found','sendPayoutNotification','Test\x20Notification','completed','findUnique','json','sendTestNotification','7CDdWxv','payment','paid','USD','__importDefault','shop','disconnectUser','productName','lastName','107Yyivqe','17001dDdJbY','firstName','amount','updatedAt','params','test_payout_123','ceil','status','getTelegramUsers','plisio','1270792OAPJMt','count','Shop\x20ID\x20is\x20required','20664792ILZFgB','telegramUser','desc','defineProperty','custom','query','gateway','update','isVerified','Broadcast\x20message\x20sent\x20successfully','../config/database','length','22002yXFehW','User\x20disconnected\x20successfully','isActive','sendShopNotification','map','method','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','groupBy','bank_transfer','default','currency','telegramBotService','1950MOumSJ','12900921jopoea','\x20notification\x20sent\x20successfully','username','2301114HZYxFj','filter','telegramId','../services/telegramBotService','Markdown','6iDioLe','findMany','body','sendCustomNotification','shopId'];a12_0x230b=function(){return _0x16bad8;};return a12_0x230b();}function a12_0x5d1a(_0x2a0552,_0x27f99a){const _0x230bf3=a12_0x230b();return a12_0x5d1a=function(_0x5d1af9,_0x23e2f5){_0x5d1af9=_0x5d1af9-0xe2;let _0x129d86=_0x230bf3[_0x5d1af9];return _0x129d86;},a12_0x5d1a(_0x2a0552,_0x27f99a);}Object[a12_0x15ca4b(0x125)](exports,a12_0x15ca4b(0x100),{'value':!![]}),exports[a12_0x15ca4b(0xff)]=void 0x0;const telegramBotService_1=require(a12_0x15ca4b(0xf6)),database_1=__importDefault(require(a12_0x15ca4b(0x12c)));class TelegramController{constructor(){const _0x3a5c2d=a12_0x15ca4b;this['getBotStatus']=async(_0x33b844,_0x20dfd7,_0x36a429)=>{const _0x14dae7=a12_0x5d1a;try{const _0x517b67=telegramBotService_1['telegramBotService']['getBotInfo'](),_0xd38396=await database_1[_0x14dae7(0xec)][_0x14dae7(0x123)][_0x14dae7(0x120)](),_0x57d5e3=await database_1[_0x14dae7(0xec)][_0x14dae7(0x123)][_0x14dae7(0x120)]({'where':{'isVerified':!![]}}),_0x11d9c8=await database_1['default'][_0x14dae7(0x123)][_0x14dae7(0xea)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x20dfd7[_0x14dae7(0x109)]({'success':!![],'result':{'bot':{'isActive':_0x517b67[_0x14dae7(0xe5)],'username':_0x517b67[_0x14dae7(0xf2)]},'statistics':{'totalUsers':_0xd38396,'verifiedUsers':_0x57d5e3,'unverifiedUsers':_0xd38396-_0x57d5e3,'connectedShops':_0x11d9c8[_0x14dae7(0xe2)]}}});}catch(_0x24963c){_0x36a429(_0x24963c);}},this[_0x3a5c2d(0x11d)]=async(_0x1591d4,_0x4c2c94,_0x2279e6)=>{const _0x17a106=_0x3a5c2d;try{const {page:page=0x1,limit:limit=0x14,verified:_0x38a795}=_0x1591d4[_0x17a106(0x127)],_0x4f9ed6=(Number(page)-0x1)*Number(limit),_0x2de90b={};_0x38a795!==undefined&&(_0x2de90b[_0x17a106(0x12a)]=_0x38a795==='true');const [_0x4a91ce,_0x3dd630]=await Promise['all']([database_1[_0x17a106(0xec)][_0x17a106(0x123)][_0x17a106(0xf9)]({'where':_0x2de90b,'skip':_0x4f9ed6,'take':Number(limit),'orderBy':{'createdAt':_0x17a106(0x124)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x17a106(0x123)][_0x17a106(0x120)]({'where':_0x2de90b})]);_0x4c2c94[_0x17a106(0x109)]({'success':!![],'users':_0x4a91ce['map'](_0x2a33a3=>({'id':_0x2a33a3['id'],'telegramId':_0x2a33a3[_0x17a106(0xf5)],'username':_0x2a33a3[_0x17a106(0xf2)],'firstName':_0x2a33a3[_0x17a106(0x116)],'lastName':_0x2a33a3[_0x17a106(0x113)],'isVerified':_0x2a33a3[_0x17a106(0x12a)],'shop':_0x2a33a3[_0x17a106(0x110)],'createdAt':_0x2a33a3['createdAt'],'updatedAt':_0x2a33a3[_0x17a106(0x118)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3dd630,'totalPages':Math[_0x17a106(0x11b)](_0x3dd630/Number(limit))}});}catch(_0x1647a0){_0x2279e6(_0x1647a0);}},this[_0x3a5c2d(0x103)]=async(_0x342d0e,_0x6006dd,_0x2262ea)=>{const _0x44dd7b=_0x3a5c2d;try{const {message:_0x108a9e,shopId:_0x568a3b}=_0x342d0e[_0x44dd7b(0xfa)];if(!_0x108a9e)return _0x6006dd[_0x44dd7b(0x11c)](0x190)[_0x44dd7b(0x109)]({'success':![],'message':_0x44dd7b(0xfd)});if(_0x568a3b)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x568a3b,_0x108a9e,{'parse_mode':_0x44dd7b(0xf7)});else{const _0x3c211b=await database_1[_0x44dd7b(0xec)][_0x44dd7b(0x123)][_0x44dd7b(0xf9)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2d62a3=[...new Set(_0x3c211b[_0x44dd7b(0xe7)](_0x8bf5e4=>_0x8bf5e4[_0x44dd7b(0xfc)])[_0x44dd7b(0xf4)](Boolean))];for(const _0x37091c of _0x2d62a3){_0x37091c&&await telegramBotService_1[_0x44dd7b(0xee)][_0x44dd7b(0xe6)](_0x37091c,_0x108a9e,{'parse_mode':_0x44dd7b(0xf7)});}}_0x6006dd['json']({'success':!![],'message':_0x44dd7b(0x12b)});}catch(_0x52407f){_0x2262ea(_0x52407f);}},this[_0x3a5c2d(0x111)]=async(_0x49d485,_0x37385f,_0x192719)=>{const _0x28fc14=_0x3a5c2d;try{const {telegramId:_0x2707c7}=_0x49d485[_0x28fc14(0x119)],_0x4703f8=await database_1[_0x28fc14(0xec)][_0x28fc14(0x123)][_0x28fc14(0x108)]({'where':{'telegramId':_0x2707c7},'include':{'shop':!![]}});if(!_0x4703f8)return _0x37385f['status'](0x194)['json']({'success':![],'message':_0x28fc14(0x104)});await database_1[_0x28fc14(0xec)]['telegramUser'][_0x28fc14(0x129)]({'where':{'telegramId':_0x2707c7},'data':{'shopId':null,'isVerified':![]}}),_0x37385f['json']({'success':!![],'message':_0x28fc14(0xe4)});}catch(_0x24dc66){_0x192719(_0x24dc66);}},this[_0x3a5c2d(0x10a)]=async(_0x29c075,_0x50c7fd,_0x290a5c)=>{const _0x15e26e=_0x3a5c2d;try{const {shopId:_0x37275b,type:type='payment',testData:_0x4bfb05}=_0x29c075[_0x15e26e(0xfa)];if(!_0x37275b)return _0x50c7fd['status'](0x190)[_0x15e26e(0x109)]({'success':![],'message':_0x15e26e(0x121)});const _0x3bd823=await database_1[_0x15e26e(0xec)][_0x15e26e(0x110)][_0x15e26e(0x108)]({'where':{'id':_0x37275b},'select':{'id':!![],'name':!![]}});if(!_0x3bd823)return _0x50c7fd[_0x15e26e(0x11c)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x15e26e(0x10c):const _0x8a2615={'id':'test_payment_123','amount':_0x4bfb05?.['amount']||0x64,'currency':_0x4bfb05?.[_0x15e26e(0xed)]||_0x15e26e(0x10e),'productName':_0x4bfb05?.[_0x15e26e(0x112)]||'Test\x20Product','gateway':_0x4bfb05?.[_0x15e26e(0x128)]||_0x15e26e(0x11e),'createdAt':new Date(),..._0x4bfb05};await telegramBotService_1['telegramBotService'][_0x15e26e(0xfe)](_0x37275b,_0x8a2615,_0x15e26e(0x10d));break;case'payout':const _0x21de93={'id':_0x15e26e(0x11a),'amount':_0x4bfb05?.[_0x15e26e(0x117)]||0x1f4,'method':_0x4bfb05?.[_0x15e26e(0xe8)]||_0x15e26e(0xeb),'createdAt':new Date(),..._0x4bfb05};await telegramBotService_1[_0x15e26e(0xee)][_0x15e26e(0x105)](_0x37275b,_0x21de93,_0x15e26e(0x107));break;case _0x15e26e(0x126):await telegramBotService_1[_0x15e26e(0xee)][_0x15e26e(0xfb)](_0x37275b,_0x4bfb05?.['title']||_0x15e26e(0x106),_0x4bfb05?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x50c7fd[_0x15e26e(0x11c)](0x190)[_0x15e26e(0x109)]({'success':![],'message':_0x15e26e(0xe9)});}_0x50c7fd[_0x15e26e(0x109)]({'success':!![],'message':'Test\x20'+type+_0x15e26e(0xf1)});}catch(_0x22cd77){_0x290a5c(_0x22cd77);}};}}exports['TelegramController']=TelegramController;