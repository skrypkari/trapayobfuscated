'use strict';const a13_0x476b61=a13_0x1a98;(function(_0x38580e,_0x26db3a){const _0x19ba10=a13_0x1a98,_0x48ff28=_0x38580e();while(!![]){try{const _0x5be705=-parseInt(_0x19ba10(0xa9))/0x1*(-parseInt(_0x19ba10(0x9c))/0x2)+parseInt(_0x19ba10(0xaf))/0x3+-parseInt(_0x19ba10(0xae))/0x4*(parseInt(_0x19ba10(0x77))/0x5)+parseInt(_0x19ba10(0x93))/0x6*(parseInt(_0x19ba10(0x94))/0x7)+-parseInt(_0x19ba10(0xad))/0x8*(parseInt(_0x19ba10(0x74))/0x9)+parseInt(_0x19ba10(0x9e))/0xa+-parseInt(_0x19ba10(0x72))/0xb;if(_0x5be705===_0x26db3a)break;else _0x48ff28['push'](_0x48ff28['shift']());}catch(_0x13e7db){_0x48ff28['push'](_0x48ff28['shift']());}}}(a13_0x1183,0x6295d));function a13_0x1a98(_0x29de2c,_0x395c95){const _0x1183c6=a13_0x1183();return a13_0x1a98=function(_0x1a989a,_0x20f7db){_0x1a989a=_0x1a989a-0x6d;let _0x1fdf6c=_0x1183c6[_0x1a989a];return _0x1fdf6c;},a13_0x1a98(_0x29de2c,_0x395c95);}var __importDefault=this&&this[a13_0x476b61(0xa7)]||function(_0x4ee319){const _0x1d6199=a13_0x476b61;return _0x4ee319&&_0x4ee319[_0x1d6199(0x9b)]?_0x4ee319:{'default':_0x4ee319};};Object[a13_0x476b61(0xb3)](exports,a13_0x476b61(0x9b),{'value':!![]}),exports[a13_0x476b61(0x96)]=void 0x0;const telegramBotService_1=require(a13_0x476b61(0x9f)),database_1=__importDefault(require(a13_0x476b61(0xa4)));function a13_0x1183(){const _0x53b2a1=['createdAt','telegramBotService','../config/database','User\x20disconnected\x20successfully','sendPayoutNotification','__importDefault','Broadcast\x20message\x20sent\x20successfully','3XWkLJZ','disconnectUser','update','amount','494144UphuUu','20aEiLer','2121597omVQgP','shop','default','Shop\x20not\x20found','defineProperty','gateway','findUnique','completed','Markdown','Telegram\x20user\x20not\x20found','groupBy','telegramUser','plisio','315425MiLtaW','getBotInfo','99qSKDWC','body','query','428365KxlrYK','sendBroadcast','shopId','lastName','desc','map','payment','USD','status','sendCustomNotification','title','Message\x20is\x20required','custom','paid','firstName','sendShopNotification','findMany','This\x20is\x20a\x20test\x20notification','sendTestNotification','currency','productName','isActive','params','updatedAt','\x20notification\x20sent\x20successfully','json','true','isVerified','10308iUAHzS','336BnigTJ','Test\x20Product','TelegramController','Test\x20Notification','sendPaymentNotification','username','method','__esModule','25498AGPgAd','test_payout_123','7123830YdsXdn','../services/telegramBotService','count','Shop\x20ID\x20is\x20required'];a13_0x1183=function(){return _0x53b2a1;};return a13_0x1183();}class TelegramController{constructor(){const _0x342d8b=a13_0x476b61;this['getBotStatus']=async(_0x4555ed,_0x1211c6,_0x3da87e)=>{const _0x17dee8=a13_0x1a98;try{const _0x23848f=telegramBotService_1[_0x17dee8(0xa3)][_0x17dee8(0x73)](),_0x289d67=await database_1['default'][_0x17dee8(0x70)][_0x17dee8(0xa0)](),_0x728b63=await database_1['default'][_0x17dee8(0x70)]['count']({'where':{'isVerified':!![]}}),_0x21fa77=await database_1[_0x17dee8(0xb1)]['telegramUser'][_0x17dee8(0x6f)]({'by':[_0x17dee8(0x79)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1211c6[_0x17dee8(0x90)]({'success':!![],'result':{'bot':{'isActive':_0x23848f[_0x17dee8(0x8c)],'username':_0x23848f[_0x17dee8(0x99)]},'statistics':{'totalUsers':_0x289d67,'verifiedUsers':_0x728b63,'unverifiedUsers':_0x289d67-_0x728b63,'connectedShops':_0x21fa77['length']}}});}catch(_0x4e7cc7){_0x3da87e(_0x4e7cc7);}},this['getTelegramUsers']=async(_0x58d0b2,_0x4554a9,_0x2cfa98)=>{const _0x4f7c5b=a13_0x1a98;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4173a8}=_0x58d0b2[_0x4f7c5b(0x76)],_0x1f7301=(Number(page)-0x1)*Number(limit),_0x4c72d5={};_0x4173a8!==undefined&&(_0x4c72d5[_0x4f7c5b(0x92)]=_0x4173a8===_0x4f7c5b(0x91));const [_0x3add1c,_0x3741da]=await Promise['all']([database_1[_0x4f7c5b(0xb1)][_0x4f7c5b(0x70)][_0x4f7c5b(0x87)]({'where':_0x4c72d5,'skip':_0x1f7301,'take':Number(limit),'orderBy':{'createdAt':_0x4f7c5b(0x7b)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4f7c5b(0xb1)][_0x4f7c5b(0x70)][_0x4f7c5b(0xa0)]({'where':_0x4c72d5})]);_0x4554a9['json']({'success':!![],'users':_0x3add1c[_0x4f7c5b(0x7c)](_0x595954=>({'id':_0x595954['id'],'telegramId':_0x595954['telegramId'],'username':_0x595954[_0x4f7c5b(0x99)],'firstName':_0x595954[_0x4f7c5b(0x85)],'lastName':_0x595954[_0x4f7c5b(0x7a)],'isVerified':_0x595954[_0x4f7c5b(0x92)],'shop':_0x595954[_0x4f7c5b(0xb0)],'createdAt':_0x595954[_0x4f7c5b(0xa2)],'updatedAt':_0x595954[_0x4f7c5b(0x8e)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3741da,'totalPages':Math['ceil'](_0x3741da/Number(limit))}});}catch(_0x222df2){_0x2cfa98(_0x222df2);}},this[_0x342d8b(0x78)]=async(_0x3381c9,_0x26a818,_0x53da89)=>{const _0x2ce457=_0x342d8b;try{const {message:_0x3189c6,shopId:_0x1c4c8e}=_0x3381c9[_0x2ce457(0x75)];if(!_0x3189c6)return _0x26a818[_0x2ce457(0x7f)](0x190)[_0x2ce457(0x90)]({'success':![],'message':_0x2ce457(0x82)});if(_0x1c4c8e)await telegramBotService_1[_0x2ce457(0xa3)][_0x2ce457(0x86)](_0x1c4c8e,_0x3189c6,{'parse_mode':_0x2ce457(0x6d)});else{const _0x5f20ce=await database_1[_0x2ce457(0xb1)][_0x2ce457(0x70)][_0x2ce457(0x87)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x15057a=[...new Set(_0x5f20ce['map'](_0x4bd3e0=>_0x4bd3e0[_0x2ce457(0x79)])['filter'](Boolean))];for(const _0x5cbc33 of _0x15057a){_0x5cbc33&&await telegramBotService_1[_0x2ce457(0xa3)][_0x2ce457(0x86)](_0x5cbc33,_0x3189c6,{'parse_mode':'Markdown'});}}_0x26a818[_0x2ce457(0x90)]({'success':!![],'message':_0x2ce457(0xa8)});}catch(_0x27e8fa){_0x53da89(_0x27e8fa);}},this[_0x342d8b(0xaa)]=async(_0x4f4a6b,_0x184055,_0x336b47)=>{const _0x3cc829=_0x342d8b;try{const {telegramId:_0x33424f}=_0x4f4a6b[_0x3cc829(0x8d)],_0xffa83a=await database_1[_0x3cc829(0xb1)]['telegramUser']['findUnique']({'where':{'telegramId':_0x33424f},'include':{'shop':!![]}});if(!_0xffa83a)return _0x184055['status'](0x194)[_0x3cc829(0x90)]({'success':![],'message':_0x3cc829(0x6e)});await database_1[_0x3cc829(0xb1)]['telegramUser'][_0x3cc829(0xab)]({'where':{'telegramId':_0x33424f},'data':{'shopId':null,'isVerified':![]}}),_0x184055['json']({'success':!![],'message':_0x3cc829(0xa5)});}catch(_0x5b313a){_0x336b47(_0x5b313a);}},this[_0x342d8b(0x89)]=async(_0x198311,_0x323100,_0xd0f9c2)=>{const _0x4d421a=_0x342d8b;try{const {shopId:_0x46044b,type:type=_0x4d421a(0x7d),testData:_0x2672ce}=_0x198311['body'];if(!_0x46044b)return _0x323100[_0x4d421a(0x7f)](0x190)[_0x4d421a(0x90)]({'success':![],'message':_0x4d421a(0xa1)});const _0x472b59=await database_1[_0x4d421a(0xb1)][_0x4d421a(0xb0)][_0x4d421a(0xb5)]({'where':{'id':_0x46044b},'select':{'id':!![],'name':!![]}});if(!_0x472b59)return _0x323100[_0x4d421a(0x7f)](0x194)[_0x4d421a(0x90)]({'success':![],'message':_0x4d421a(0xb2)});switch(type){case _0x4d421a(0x7d):const _0x396a19={'id':'test_payment_123','amount':_0x2672ce?.[_0x4d421a(0xac)]||0x64,'currency':_0x2672ce?.[_0x4d421a(0x8a)]||_0x4d421a(0x7e),'productName':_0x2672ce?.[_0x4d421a(0x8b)]||_0x4d421a(0x95),'gateway':_0x2672ce?.[_0x4d421a(0xb4)]||_0x4d421a(0x71),'createdAt':new Date(),..._0x2672ce};await telegramBotService_1['telegramBotService'][_0x4d421a(0x98)](_0x46044b,_0x396a19,_0x4d421a(0x84));break;case'payout':const _0x4005e3={'id':_0x4d421a(0x9d),'amount':_0x2672ce?.[_0x4d421a(0xac)]||0x1f4,'method':_0x2672ce?.[_0x4d421a(0x9a)]||'bank_transfer','createdAt':new Date(),..._0x2672ce};await telegramBotService_1[_0x4d421a(0xa3)][_0x4d421a(0xa6)](_0x46044b,_0x4005e3,_0x4d421a(0xb6));break;case _0x4d421a(0x83):await telegramBotService_1[_0x4d421a(0xa3)][_0x4d421a(0x80)](_0x46044b,_0x2672ce?.[_0x4d421a(0x81)]||_0x4d421a(0x97),_0x2672ce?.['details']||{'message':_0x4d421a(0x88)});break;default:return _0x323100[_0x4d421a(0x7f)](0x190)[_0x4d421a(0x90)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x323100[_0x4d421a(0x90)]({'success':!![],'message':'Test\x20'+type+_0x4d421a(0x8f)});}catch(_0x547b51){_0xd0f9c2(_0x547b51);}};}}exports[a13_0x476b61(0x96)]=TelegramController;