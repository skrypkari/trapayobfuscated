'use strict';const a12_0x2dd097=a12_0x1178;(function(_0x3645c3,_0x45452a){const _0x11b298=a12_0x1178,_0x4c865f=_0x3645c3();while(!![]){try{const _0x3ef3bb=-parseInt(_0x11b298(0xe5))/0x1*(-parseInt(_0x11b298(0x105))/0x2)+-parseInt(_0x11b298(0x11b))/0x3+parseInt(_0x11b298(0xf7))/0x4*(-parseInt(_0x11b298(0xe3))/0x5)+parseInt(_0x11b298(0xe9))/0x6*(-parseInt(_0x11b298(0x11e))/0x7)+-parseInt(_0x11b298(0xfa))/0x8*(parseInt(_0x11b298(0xfc))/0x9)+-parseInt(_0x11b298(0x11c))/0xa*(-parseInt(_0x11b298(0x121))/0xb)+parseInt(_0x11b298(0x119))/0xc;if(_0x3ef3bb===_0x45452a)break;else _0x4c865f['push'](_0x4c865f['shift']());}catch(_0x118e37){_0x4c865f['push'](_0x4c865f['shift']());}}}(a12_0xb019,0x6020e));var __importDefault=this&&this[a12_0x2dd097(0x103)]||function(_0x37d8bc){const _0x2d97e5=a12_0x2dd097;return _0x37d8bc&&_0x37d8bc[_0x2d97e5(0xea)]?_0x37d8bc:{'default':_0x37d8bc};};Object[a12_0x2dd097(0xdd)](exports,a12_0x2dd097(0xea),{'value':!![]}),exports[a12_0x2dd097(0xf3)]=void 0x0;function a12_0xb019(){const _0x49ec6a=['sendBroadcast','3725557FdFdzd','defineProperty','count','plisio','ceil','findMany','test_payout_123','249725cPpUUj','isActive','3223BsnGxI','filter','Shop\x20ID\x20is\x20required','custom','1317378TrEADG','__esModule','sendPayoutNotification','Markdown','\x20notification\x20sent\x20successfully','createdAt','sendTestNotification','update','Test\x20Product','paid','TelegramController','length','body','sendPaymentNotification','4yrNFtF','isVerified','sendShopNotification','411392yVfizW','username','108wbRpcL','This\x20is\x20a\x20test\x20notification','Shop\x20not\x20found','Message\x20is\x20required','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','amount','telegramBotService','__importDefault','payment','344HMcMzb','shop','default','USD','Test\x20Notification','findUnique','desc','groupBy','getBotStatus','params','shopId','details','telegramUser','Broadcast\x20message\x20sent\x20successfully','status','all','json','updatedAt','Test\x20','getBotInfo','7214148QaraEf','payout','641652cytmqn','10cngyNV','map','7ADWPhy','completed'];a12_0xb019=function(){return _0x49ec6a;};return a12_0xb019();}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require('../config/database'));function a12_0x1178(_0x49a569,_0x301010){const _0xb01969=a12_0xb019();return a12_0x1178=function(_0x11785f,_0x1bc2b4){_0x11785f=_0x11785f-0xdd;let _0x1edce9=_0xb01969[_0x11785f];return _0x1edce9;},a12_0x1178(_0x49a569,_0x301010);}class TelegramController{constructor(){const _0x3605c9=a12_0x2dd097;this[_0x3605c9(0x10d)]=async(_0x58819b,_0x36f724,_0x2b69b6)=>{const _0x4c616c=_0x3605c9;try{const _0x25770f=telegramBotService_1['telegramBotService'][_0x4c616c(0x118)](),_0x20483e=await database_1[_0x4c616c(0x107)][_0x4c616c(0x111)][_0x4c616c(0xde)](),_0x3d36ec=await database_1[_0x4c616c(0x107)][_0x4c616c(0x111)][_0x4c616c(0xde)]({'where':{'isVerified':!![]}}),_0x280b13=await database_1[_0x4c616c(0x107)][_0x4c616c(0x111)][_0x4c616c(0x10c)]({'by':[_0x4c616c(0x10f)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x36f724[_0x4c616c(0x115)]({'success':!![],'result':{'bot':{'isActive':_0x25770f[_0x4c616c(0xe4)],'username':_0x25770f['username']},'statistics':{'totalUsers':_0x20483e,'verifiedUsers':_0x3d36ec,'unverifiedUsers':_0x20483e-_0x3d36ec,'connectedShops':_0x280b13[_0x4c616c(0xf4)]}}});}catch(_0x5329db){_0x2b69b6(_0x5329db);}},this['getTelegramUsers']=async(_0x2e22b0,_0x47da25,_0x1bb368)=>{const _0x4330c2=_0x3605c9;try{const {page:page=0x1,limit:limit=0x14,verified:_0x39573c}=_0x2e22b0['query'],_0x1a1810=(Number(page)-0x1)*Number(limit),_0xacfcc4={};_0x39573c!==undefined&&(_0xacfcc4[_0x4330c2(0xf8)]=_0x39573c==='true');const [_0x358265,_0x1bd0d4]=await Promise[_0x4330c2(0x114)]([database_1[_0x4330c2(0x107)][_0x4330c2(0x111)]['findMany']({'where':_0xacfcc4,'skip':_0x1a1810,'take':Number(limit),'orderBy':{'createdAt':_0x4330c2(0x10b)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4330c2(0x107)][_0x4330c2(0x111)][_0x4330c2(0xde)]({'where':_0xacfcc4})]);_0x47da25['json']({'success':!![],'users':_0x358265[_0x4330c2(0x11d)](_0x222355=>({'id':_0x222355['id'],'telegramId':_0x222355['telegramId'],'username':_0x222355[_0x4330c2(0xfb)],'firstName':_0x222355['firstName'],'lastName':_0x222355['lastName'],'isVerified':_0x222355['isVerified'],'shop':_0x222355[_0x4330c2(0x106)],'createdAt':_0x222355[_0x4330c2(0xee)],'updatedAt':_0x222355[_0x4330c2(0x116)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1bd0d4,'totalPages':Math[_0x4330c2(0xe0)](_0x1bd0d4/Number(limit))}});}catch(_0x1e548c){_0x1bb368(_0x1e548c);}},this[_0x3605c9(0x120)]=async(_0x25187b,_0x17ea53,_0x1e48fc)=>{const _0x341295=_0x3605c9;try{const {message:_0x7e797f,shopId:_0x5c068f}=_0x25187b['body'];if(!_0x7e797f)return _0x17ea53[_0x341295(0x113)](0x190)[_0x341295(0x115)]({'success':![],'message':_0x341295(0xff)});if(_0x5c068f)await telegramBotService_1['telegramBotService'][_0x341295(0xf9)](_0x5c068f,_0x7e797f,{'parse_mode':_0x341295(0xec)});else{const _0x4a001b=await database_1[_0x341295(0x107)][_0x341295(0x111)][_0x341295(0xe1)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4582b0=[...new Set(_0x4a001b[_0x341295(0x11d)](_0x3cf6ee=>_0x3cf6ee[_0x341295(0x10f)])[_0x341295(0xe6)](Boolean))];for(const _0x50bfe1 of _0x4582b0){_0x50bfe1&&await telegramBotService_1[_0x341295(0x102)][_0x341295(0xf9)](_0x50bfe1,_0x7e797f,{'parse_mode':_0x341295(0xec)});}}_0x17ea53['json']({'success':!![],'message':_0x341295(0x112)});}catch(_0x534503){_0x1e48fc(_0x534503);}},this['disconnectUser']=async(_0x3fcdea,_0x57e879,_0x276665)=>{const _0x596b59=_0x3605c9;try{const {telegramId:_0x1f6848}=_0x3fcdea[_0x596b59(0x10e)],_0x22b955=await database_1[_0x596b59(0x107)][_0x596b59(0x111)][_0x596b59(0x10a)]({'where':{'telegramId':_0x1f6848},'include':{'shop':!![]}});if(!_0x22b955)return _0x57e879['status'](0x194)[_0x596b59(0x115)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x596b59(0x107)][_0x596b59(0x111)][_0x596b59(0xf0)]({'where':{'telegramId':_0x1f6848},'data':{'shopId':null,'isVerified':![]}}),_0x57e879[_0x596b59(0x115)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x9b8229){_0x276665(_0x9b8229);}},this[_0x3605c9(0xef)]=async(_0x121b8,_0x29bc3f,_0x2db396)=>{const _0x80231=_0x3605c9;try{const {shopId:_0xa213ff,type:type=_0x80231(0x104),testData:_0x2316ef}=_0x121b8[_0x80231(0xf5)];if(!_0xa213ff)return _0x29bc3f[_0x80231(0x113)](0x190)[_0x80231(0x115)]({'success':![],'message':_0x80231(0xe7)});const _0x412c8b=await database_1[_0x80231(0x107)]['shop'][_0x80231(0x10a)]({'where':{'id':_0xa213ff},'select':{'id':!![],'name':!![]}});if(!_0x412c8b)return _0x29bc3f['status'](0x194)[_0x80231(0x115)]({'success':![],'message':_0x80231(0xfe)});switch(type){case _0x80231(0x104):const _0xf010a0={'id':'test_payment_123','amount':_0x2316ef?.[_0x80231(0x101)]||0x64,'currency':_0x2316ef?.['currency']||_0x80231(0x108),'productName':_0x2316ef?.['productName']||_0x80231(0xf1),'gateway':_0x2316ef?.['gateway']||_0x80231(0xdf),'createdAt':new Date(),..._0x2316ef};await telegramBotService_1[_0x80231(0x102)][_0x80231(0xf6)](_0xa213ff,_0xf010a0,_0x80231(0xf2));break;case _0x80231(0x11a):const _0x3e75fe={'id':_0x80231(0xe2),'amount':_0x2316ef?.['amount']||0x1f4,'method':_0x2316ef?.['method']||'bank_transfer','createdAt':new Date(),..._0x2316ef};await telegramBotService_1['telegramBotService'][_0x80231(0xeb)](_0xa213ff,_0x3e75fe,_0x80231(0x11f));break;case _0x80231(0xe8):await telegramBotService_1[_0x80231(0x102)]['sendCustomNotification'](_0xa213ff,_0x2316ef?.['title']||_0x80231(0x109),_0x2316ef?.[_0x80231(0x110)]||{'message':_0x80231(0xfd)});break;default:return _0x29bc3f[_0x80231(0x113)](0x190)[_0x80231(0x115)]({'success':![],'message':_0x80231(0x100)});}_0x29bc3f[_0x80231(0x115)]({'success':!![],'message':_0x80231(0x117)+type+_0x80231(0xed)});}catch(_0x4b87f2){_0x2db396(_0x4b87f2);}};}}exports['TelegramController']=TelegramController;