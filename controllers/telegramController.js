'use strict';function a13_0x532f(){const _0x5bdf59=['telegramBotService','body','TelegramController','__esModule','5yjonix','getBotStatus','Telegram\x20user\x20not\x20found','count','lastName','desc','firstName','updatedAt','length','getTelegramUsers','1386iNuXUM','sendBroadcast','sendTestNotification','all','amount','2drfJQO','plisio','payment','Test\x20','details','findMany','bank_transfer','Message\x20is\x20required','Broadcast\x20message\x20sent\x20successfully','../services/telegramBotService','default','Shop\x20ID\x20is\x20required','title','payout','getBotInfo','27112HKxuEs','groupBy','test_payment_123','1078tKfyOX','Shop\x20not\x20found','query','productName','shopId','46119cInfwO','method','2619SyaHnn','Markdown','213291hnicoa','1487586IeRenI','1812470fEmHtO','currency','custom','disconnectUser','completed','User\x20disconnected\x20successfully','json','isVerified','1159777XiXXRG','username','shop','telegramUser','sendShopNotification','findUnique','188FjlgmA','telegramId','test_payout_123','filter','84AXmqKp','isActive','24830hjxGKC','update','paid','status','createdAt','map','__importDefault','Test\x20Product'];a13_0x532f=function(){return _0x5bdf59;};return a13_0x532f();}const a13_0x2f7202=a13_0x59fe;(function(_0x1d5d17,_0x20a5d3){const _0x27c174=a13_0x59fe,_0x3fcb75=_0x1d5d17();while(!![]){try{const _0x6d5c37=parseInt(_0x27c174(0x124))/0x1*(parseInt(_0x27c174(0x14b))/0x2)+parseInt(_0x27c174(0x116))/0x3*(parseInt(_0x27c174(0x12a))/0x4)+-parseInt(_0x27c174(0x13c))/0x5*(-parseInt(_0x27c174(0x11b))/0x6)+-parseInt(_0x27c174(0x111))/0x7*(-parseInt(_0x27c174(0x10e))/0x8)+parseInt(_0x27c174(0x118))/0x9*(parseInt(_0x27c174(0x130))/0xa)+parseInt(_0x27c174(0x11c))/0xb*(-parseInt(_0x27c174(0x12e))/0xc)+parseInt(_0x27c174(0x11a))/0xd*(-parseInt(_0x27c174(0x146))/0xe);if(_0x6d5c37===_0x20a5d3)break;else _0x3fcb75['push'](_0x3fcb75['shift']());}catch(_0x328232){_0x3fcb75['push'](_0x3fcb75['shift']());}}}(a13_0x532f,0x91c17));var __importDefault=this&&this[a13_0x2f7202(0x136)]||function(_0x5dcde7){const _0x1b99d7=a13_0x2f7202;return _0x5dcde7&&_0x5dcde7[_0x1b99d7(0x13b)]?_0x5dcde7:{'default':_0x5dcde7};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['TelegramController']=void 0x0;function a13_0x59fe(_0xbfdce2,_0x106979){const _0x532fd1=a13_0x532f();return a13_0x59fe=function(_0x59fe01,_0x22b1fa){_0x59fe01=_0x59fe01-0x105;let _0x48c29b=_0x532fd1[_0x59fe01];return _0x48c29b;},a13_0x59fe(_0xbfdce2,_0x106979);}const telegramBotService_1=require(a13_0x2f7202(0x108)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x46d374=a13_0x2f7202;this[_0x46d374(0x13d)]=async(_0x3c9b65,_0x1a17b1,_0x1fb984)=>{const _0x1aaa3b=_0x46d374;try{const _0x523453=telegramBotService_1[_0x1aaa3b(0x138)][_0x1aaa3b(0x10d)](),_0x278a8a=await database_1['default'][_0x1aaa3b(0x127)][_0x1aaa3b(0x13f)](),_0x178894=await database_1['default'][_0x1aaa3b(0x127)]['count']({'where':{'isVerified':!![]}}),_0x10d2c5=await database_1[_0x1aaa3b(0x109)][_0x1aaa3b(0x127)][_0x1aaa3b(0x10f)]({'by':[_0x1aaa3b(0x115)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1a17b1[_0x1aaa3b(0x122)]({'success':!![],'result':{'bot':{'isActive':_0x523453[_0x1aaa3b(0x12f)],'username':_0x523453[_0x1aaa3b(0x125)]},'statistics':{'totalUsers':_0x278a8a,'verifiedUsers':_0x178894,'unverifiedUsers':_0x278a8a-_0x178894,'connectedShops':_0x10d2c5[_0x1aaa3b(0x144)]}}});}catch(_0x3ccfe0){_0x1fb984(_0x3ccfe0);}},this[_0x46d374(0x145)]=async(_0x4b8eee,_0x2b1df7,_0x3d765d)=>{const _0x4ce915=_0x46d374;try{const {page:page=0x1,limit:limit=0x14,verified:_0x16c8f4}=_0x4b8eee[_0x4ce915(0x113)],_0x586e95=(Number(page)-0x1)*Number(limit),_0x495778={};_0x16c8f4!==undefined&&(_0x495778[_0x4ce915(0x123)]=_0x16c8f4==='true');const [_0x38a611,_0x3db582]=await Promise[_0x4ce915(0x149)]([database_1[_0x4ce915(0x109)][_0x4ce915(0x127)][_0x4ce915(0x150)]({'where':_0x495778,'skip':_0x586e95,'take':Number(limit),'orderBy':{'createdAt':_0x4ce915(0x141)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4ce915(0x109)][_0x4ce915(0x127)][_0x4ce915(0x13f)]({'where':_0x495778})]);_0x2b1df7['json']({'success':!![],'users':_0x38a611[_0x4ce915(0x135)](_0x13b2cb=>({'id':_0x13b2cb['id'],'telegramId':_0x13b2cb[_0x4ce915(0x12b)],'username':_0x13b2cb[_0x4ce915(0x125)],'firstName':_0x13b2cb[_0x4ce915(0x142)],'lastName':_0x13b2cb[_0x4ce915(0x140)],'isVerified':_0x13b2cb['isVerified'],'shop':_0x13b2cb[_0x4ce915(0x126)],'createdAt':_0x13b2cb[_0x4ce915(0x134)],'updatedAt':_0x13b2cb[_0x4ce915(0x143)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3db582,'totalPages':Math['ceil'](_0x3db582/Number(limit))}});}catch(_0x180c9b){_0x3d765d(_0x180c9b);}},this[_0x46d374(0x147)]=async(_0x22646f,_0x34290c,_0x369ac1)=>{const _0x3b4c31=_0x46d374;try{const {message:_0x3b0491,shopId:_0x791170}=_0x22646f[_0x3b4c31(0x139)];if(!_0x3b0491)return _0x34290c[_0x3b4c31(0x133)](0x190)[_0x3b4c31(0x122)]({'success':![],'message':_0x3b4c31(0x106)});if(_0x791170)await telegramBotService_1[_0x3b4c31(0x138)][_0x3b4c31(0x128)](_0x791170,_0x3b0491,{'parse_mode':_0x3b4c31(0x119)});else{const _0x573946=await database_1[_0x3b4c31(0x109)][_0x3b4c31(0x127)][_0x3b4c31(0x150)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x306098=[...new Set(_0x573946[_0x3b4c31(0x135)](_0x59d25b=>_0x59d25b[_0x3b4c31(0x115)])[_0x3b4c31(0x12d)](Boolean))];for(const _0x4404db of _0x306098){_0x4404db&&await telegramBotService_1['telegramBotService'][_0x3b4c31(0x128)](_0x4404db,_0x3b0491,{'parse_mode':_0x3b4c31(0x119)});}}_0x34290c[_0x3b4c31(0x122)]({'success':!![],'message':_0x3b4c31(0x107)});}catch(_0x51eeef){_0x369ac1(_0x51eeef);}},this[_0x46d374(0x11f)]=async(_0x1f7d22,_0x4213e7,_0x2f83f4)=>{const _0x893d0a=_0x46d374;try{const {telegramId:_0x8bceb3}=_0x1f7d22['params'],_0x1b9d13=await database_1['default'][_0x893d0a(0x127)][_0x893d0a(0x129)]({'where':{'telegramId':_0x8bceb3},'include':{'shop':!![]}});if(!_0x1b9d13)return _0x4213e7[_0x893d0a(0x133)](0x194)['json']({'success':![],'message':_0x893d0a(0x13e)});await database_1[_0x893d0a(0x109)][_0x893d0a(0x127)][_0x893d0a(0x131)]({'where':{'telegramId':_0x8bceb3},'data':{'shopId':null,'isVerified':![]}}),_0x4213e7[_0x893d0a(0x122)]({'success':!![],'message':_0x893d0a(0x121)});}catch(_0xcf7bdd){_0x2f83f4(_0xcf7bdd);}},this[_0x46d374(0x148)]=async(_0x37c6fe,_0x29d4f0,_0x420d14)=>{const _0x3d80db=_0x46d374;try{const {shopId:_0x1f5209,type:type=_0x3d80db(0x14d),testData:_0x197133}=_0x37c6fe['body'];if(!_0x1f5209)return _0x29d4f0[_0x3d80db(0x133)](0x190)[_0x3d80db(0x122)]({'success':![],'message':_0x3d80db(0x10a)});const _0x13a8c8=await database_1[_0x3d80db(0x109)]['shop'][_0x3d80db(0x129)]({'where':{'id':_0x1f5209},'select':{'id':!![],'name':!![]}});if(!_0x13a8c8)return _0x29d4f0[_0x3d80db(0x133)](0x194)[_0x3d80db(0x122)]({'success':![],'message':_0x3d80db(0x112)});switch(type){case _0x3d80db(0x14d):const _0x4f002d={'id':_0x3d80db(0x110),'amount':_0x197133?.[_0x3d80db(0x14a)]||0x64,'currency':_0x197133?.[_0x3d80db(0x11d)]||'USD','productName':_0x197133?.[_0x3d80db(0x114)]||_0x3d80db(0x137),'gateway':_0x197133?.['gateway']||_0x3d80db(0x14c),'createdAt':new Date(),..._0x197133};await telegramBotService_1[_0x3d80db(0x138)]['sendPaymentNotification'](_0x1f5209,_0x4f002d,_0x3d80db(0x132));break;case _0x3d80db(0x10c):const _0x276b70={'id':_0x3d80db(0x12c),'amount':_0x197133?.[_0x3d80db(0x14a)]||0x1f4,'method':_0x197133?.[_0x3d80db(0x117)]||_0x3d80db(0x105),'createdAt':new Date(),..._0x197133};await telegramBotService_1[_0x3d80db(0x138)]['sendPayoutNotification'](_0x1f5209,_0x276b70,_0x3d80db(0x120));break;case _0x3d80db(0x11e):await telegramBotService_1[_0x3d80db(0x138)]['sendCustomNotification'](_0x1f5209,_0x197133?.[_0x3d80db(0x10b)]||'Test\x20Notification',_0x197133?.[_0x3d80db(0x14f)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x29d4f0['status'](0x190)[_0x3d80db(0x122)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x29d4f0['json']({'success':!![],'message':_0x3d80db(0x14e)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x588eb0){_0x420d14(_0x588eb0);}};}}exports[a13_0x2f7202(0x13a)]=TelegramController;