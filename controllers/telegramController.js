'use strict';const a12_0x343749=a12_0x2c1a;(function(_0x3c5f6f,_0x126c73){const _0x23e4ac=a12_0x2c1a,_0x55deb7=_0x3c5f6f();while(!![]){try{const _0x4f2d42=-parseInt(_0x23e4ac(0x131))/0x1+-parseInt(_0x23e4ac(0x112))/0x2*(-parseInt(_0x23e4ac(0x111))/0x3)+-parseInt(_0x23e4ac(0x12d))/0x4*(-parseInt(_0x23e4ac(0x107))/0x5)+-parseInt(_0x23e4ac(0xfd))/0x6+parseInt(_0x23e4ac(0x11a))/0x7+-parseInt(_0x23e4ac(0x11f))/0x8+parseInt(_0x23e4ac(0x130))/0x9*(parseInt(_0x23e4ac(0x100))/0xa);if(_0x4f2d42===_0x126c73)break;else _0x55deb7['push'](_0x55deb7['shift']());}catch(_0x3bdf1f){_0x55deb7['push'](_0x55deb7['shift']());}}}(a12_0x1299,0x74e63));function a12_0x1299(){const _0x34c583=['__esModule','getTelegramUsers','map','telegramBotService','paid','isVerified','test_payout_123','3okEtls','1760018HWUFpX','status','details','This\x20is\x20a\x20test\x20notification','length','username','User\x20disconnected\x20successfully','findMany','6555381ZWjTdX','desc','Test\x20Product','productName','findUnique','2869040oCbgdY','firstName','lastName','filter','Telegram\x20user\x20not\x20found','plisio','ceil','__importDefault','count','title','json','sendShopNotification','shopId','shop','10408Csotob','getBotInfo','updatedAt','270360aGYIbR','592693qMIozG','Test\x20Notification','test_payment_123','defineProperty','../services/telegramBotService','../config/database','sendCustomNotification','Broadcast\x20message\x20sent\x20successfully','groupBy','getBotStatus','query','method','telegramUser','createdAt','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','body','5600832XBycxq','amount','update','60RNtPYR','default','sendTestNotification','true','payment','TelegramController','Markdown','705pEcelJ','params','completed'];a12_0x1299=function(){return _0x34c583;};return a12_0x1299();}function a12_0x2c1a(_0x14858b,_0x2b4abf){const _0x129972=a12_0x1299();return a12_0x2c1a=function(_0x2c1add,_0xca1c84){_0x2c1add=_0x2c1add-0xf1;let _0xa8abed=_0x129972[_0x2c1add];return _0xa8abed;},a12_0x2c1a(_0x14858b,_0x2b4abf);}var __importDefault=this&&this[a12_0x343749(0x126)]||function(_0x210f2c){return _0x210f2c&&_0x210f2c['__esModule']?_0x210f2c:{'default':_0x210f2c};};Object[a12_0x343749(0x134)](exports,a12_0x343749(0x10a),{'value':!![]}),exports[a12_0x343749(0x105)]=void 0x0;const telegramBotService_1=require(a12_0x343749(0xf1)),database_1=__importDefault(require(a12_0x343749(0xf2)));class TelegramController{constructor(){const _0x59a81c=a12_0x343749;this[_0x59a81c(0xf6)]=async(_0x6a9f9c,_0x8ba329,_0x3775c9)=>{const _0x216ff7=_0x59a81c;try{const _0x7e0ac=telegramBotService_1[_0x216ff7(0x10d)][_0x216ff7(0x12e)](),_0x1f9c57=await database_1[_0x216ff7(0x101)]['telegramUser'][_0x216ff7(0x127)](),_0x3434df=await database_1[_0x216ff7(0x101)][_0x216ff7(0xf9)][_0x216ff7(0x127)]({'where':{'isVerified':!![]}}),_0x3e125a=await database_1[_0x216ff7(0x101)][_0x216ff7(0xf9)][_0x216ff7(0xf5)]({'by':[_0x216ff7(0x12b)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x8ba329[_0x216ff7(0x129)]({'success':!![],'result':{'bot':{'isActive':_0x7e0ac['isActive'],'username':_0x7e0ac[_0x216ff7(0x117)]},'statistics':{'totalUsers':_0x1f9c57,'verifiedUsers':_0x3434df,'unverifiedUsers':_0x1f9c57-_0x3434df,'connectedShops':_0x3e125a[_0x216ff7(0x116)]}}});}catch(_0x1b6f99){_0x3775c9(_0x1b6f99);}},this[_0x59a81c(0x10b)]=async(_0x27e807,_0x152f10,_0x2b69db)=>{const _0x3a63b4=_0x59a81c;try{const {page:page=0x1,limit:limit=0x14,verified:_0x50045e}=_0x27e807[_0x3a63b4(0xf7)],_0x275c3b=(Number(page)-0x1)*Number(limit),_0x34533e={};_0x50045e!==undefined&&(_0x34533e[_0x3a63b4(0x10f)]=_0x50045e===_0x3a63b4(0x103));const [_0x5447c8,_0x498808]=await Promise['all']([database_1[_0x3a63b4(0x101)][_0x3a63b4(0xf9)][_0x3a63b4(0x119)]({'where':_0x34533e,'skip':_0x275c3b,'take':Number(limit),'orderBy':{'createdAt':_0x3a63b4(0x11b)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x3a63b4(0xf9)][_0x3a63b4(0x127)]({'where':_0x34533e})]);_0x152f10[_0x3a63b4(0x129)]({'success':!![],'users':_0x5447c8[_0x3a63b4(0x10c)](_0x35e76d=>({'id':_0x35e76d['id'],'telegramId':_0x35e76d['telegramId'],'username':_0x35e76d[_0x3a63b4(0x117)],'firstName':_0x35e76d[_0x3a63b4(0x120)],'lastName':_0x35e76d[_0x3a63b4(0x121)],'isVerified':_0x35e76d['isVerified'],'shop':_0x35e76d[_0x3a63b4(0x12c)],'createdAt':_0x35e76d[_0x3a63b4(0xfa)],'updatedAt':_0x35e76d[_0x3a63b4(0x12f)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x498808,'totalPages':Math[_0x3a63b4(0x125)](_0x498808/Number(limit))}});}catch(_0x11370e){_0x2b69db(_0x11370e);}},this['sendBroadcast']=async(_0x49055e,_0x21bd18,_0xeda633)=>{const _0x125997=_0x59a81c;try{const {message:_0x18fa98,shopId:_0x4ebd50}=_0x49055e[_0x125997(0xfc)];if(!_0x18fa98)return _0x21bd18[_0x125997(0x113)](0x190)[_0x125997(0x129)]({'success':![],'message':'Message\x20is\x20required'});if(_0x4ebd50)await telegramBotService_1[_0x125997(0x10d)][_0x125997(0x12a)](_0x4ebd50,_0x18fa98,{'parse_mode':_0x125997(0x106)});else{const _0x1180a1=await database_1[_0x125997(0x101)]['telegramUser'][_0x125997(0x119)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xdb42ca=[...new Set(_0x1180a1[_0x125997(0x10c)](_0x238133=>_0x238133[_0x125997(0x12b)])[_0x125997(0x122)](Boolean))];for(const _0x5cce7a of _0xdb42ca){_0x5cce7a&&await telegramBotService_1['telegramBotService'][_0x125997(0x12a)](_0x5cce7a,_0x18fa98,{'parse_mode':_0x125997(0x106)});}}_0x21bd18[_0x125997(0x129)]({'success':!![],'message':_0x125997(0xf4)});}catch(_0x3c76eb){_0xeda633(_0x3c76eb);}},this['disconnectUser']=async(_0x191625,_0x5db2f0,_0x16879c)=>{const _0x3f87e9=_0x59a81c;try{const {telegramId:_0x203432}=_0x191625[_0x3f87e9(0x108)],_0x52da05=await database_1[_0x3f87e9(0x101)][_0x3f87e9(0xf9)][_0x3f87e9(0x11e)]({'where':{'telegramId':_0x203432},'include':{'shop':!![]}});if(!_0x52da05)return _0x5db2f0[_0x3f87e9(0x113)](0x194)[_0x3f87e9(0x129)]({'success':![],'message':_0x3f87e9(0x123)});await database_1['default'][_0x3f87e9(0xf9)][_0x3f87e9(0xff)]({'where':{'telegramId':_0x203432},'data':{'shopId':null,'isVerified':![]}}),_0x5db2f0[_0x3f87e9(0x129)]({'success':!![],'message':_0x3f87e9(0x118)});}catch(_0x1ba1f0){_0x16879c(_0x1ba1f0);}},this[_0x59a81c(0x102)]=async(_0x4815cb,_0x18d2a9,_0x18bed9)=>{const _0x3ff6ee=_0x59a81c;try{const {shopId:_0x14e53b,type:type=_0x3ff6ee(0x104),testData:_0x1b3614}=_0x4815cb[_0x3ff6ee(0xfc)];if(!_0x14e53b)return _0x18d2a9['status'](0x190)['json']({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x2962a8=await database_1['default']['shop']['findUnique']({'where':{'id':_0x14e53b},'select':{'id':!![],'name':!![]}});if(!_0x2962a8)return _0x18d2a9[_0x3ff6ee(0x113)](0x194)[_0x3ff6ee(0x129)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0x1e9ef2={'id':_0x3ff6ee(0x133),'amount':_0x1b3614?.[_0x3ff6ee(0xfe)]||0x64,'currency':_0x1b3614?.['currency']||'USD','productName':_0x1b3614?.[_0x3ff6ee(0x11d)]||_0x3ff6ee(0x11c),'gateway':_0x1b3614?.['gateway']||_0x3ff6ee(0x124),'createdAt':new Date(),..._0x1b3614};await telegramBotService_1[_0x3ff6ee(0x10d)]['sendPaymentNotification'](_0x14e53b,_0x1e9ef2,_0x3ff6ee(0x10e));break;case'payout':const _0x128531={'id':_0x3ff6ee(0x110),'amount':_0x1b3614?.[_0x3ff6ee(0xfe)]||0x1f4,'method':_0x1b3614?.[_0x3ff6ee(0xf8)]||'bank_transfer','createdAt':new Date(),..._0x1b3614};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x14e53b,_0x128531,_0x3ff6ee(0x109));break;case'custom':await telegramBotService_1['telegramBotService'][_0x3ff6ee(0xf3)](_0x14e53b,_0x1b3614?.[_0x3ff6ee(0x128)]||_0x3ff6ee(0x132),_0x1b3614?.[_0x3ff6ee(0x114)]||{'message':_0x3ff6ee(0x115)});break;default:return _0x18d2a9[_0x3ff6ee(0x113)](0x190)[_0x3ff6ee(0x129)]({'success':![],'message':_0x3ff6ee(0xfb)});}_0x18d2a9[_0x3ff6ee(0x129)]({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x260a05){_0x18bed9(_0x260a05);}};}}exports['TelegramController']=TelegramController;