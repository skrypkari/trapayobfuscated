'use strict';function a12_0x1095(_0x1b34f5,_0x589d4c){const _0x5ad74e=a12_0x5ad7();return a12_0x1095=function(_0x109587,_0x370f9e){_0x109587=_0x109587-0x1d0;let _0x2f06e2=_0x5ad74e[_0x109587];return _0x2f06e2;},a12_0x1095(_0x1b34f5,_0x589d4c);}const a12_0x5c4249=a12_0x1095;(function(_0x2c959a,_0x56bc62){const _0x193d5c=a12_0x1095,_0x4a095e=_0x2c959a();while(!![]){try{const _0x1f0bde=-parseInt(_0x193d5c(0x1e3))/0x1+-parseInt(_0x193d5c(0x1fa))/0x2*(-parseInt(_0x193d5c(0x1de))/0x3)+-parseInt(_0x193d5c(0x1e7))/0x4*(parseInt(_0x193d5c(0x1f2))/0x5)+parseInt(_0x193d5c(0x1fd))/0x6+parseInt(_0x193d5c(0x1d9))/0x7+-parseInt(_0x193d5c(0x20b))/0x8*(-parseInt(_0x193d5c(0x20a))/0x9)+-parseInt(_0x193d5c(0x1eb))/0xa*(parseInt(_0x193d5c(0x1ef))/0xb);if(_0x1f0bde===_0x56bc62)break;else _0x4a095e['push'](_0x4a095e['shift']());}catch(_0x262403){_0x4a095e['push'](_0x4a095e['shift']());}}}(a12_0x5ad7,0xe7536));var __importDefault=this&&this[a12_0x5c4249(0x1df)]||function(_0x38623e){return _0x38623e&&_0x38623e['__esModule']?_0x38623e:{'default':_0x38623e};};Object[a12_0x5c4249(0x1e9)](exports,a12_0x5c4249(0x1fc),{'value':!![]}),exports[a12_0x5c4249(0x1d0)]=void 0x0;const telegramBotService_1=require(a12_0x5c4249(0x1fb)),database_1=__importDefault(require(a12_0x5c4249(0x1e0)));function a12_0x5ad7(){const _0x3b02be=['count','updatedAt','findUnique','9CfVuiy','5324648RQwSpx','telegramUser','User\x20disconnected\x20successfully','length','test_payout_123','update','Message\x20is\x20required','TelegramController','currency','sendCustomNotification','shopId','findMany','gateway','This\x20is\x20a\x20test\x20notification','sendBroadcast','username','2504432EJakxY','details','all','isVerified','Test\x20Notification','47904sxVkvy','__importDefault','../config/database','sendShopNotification','default','571038xhyBbe','title','json','telegramId','5556baACKN','\x20notification\x20sent\x20successfully','defineProperty','lastName','3985090LafdLz','completed','bank_transfer','Test\x20Product','11mgLjvz','payout','payment','3595oogxYg','filter','body','Test\x20','getTelegramUsers','Markdown','telegramBotService','productName','34ezHAor','../services/telegramBotService','__esModule','9725610rwNwGT','params','getBotStatus','isActive','Telegram\x20user\x20not\x20found','status','createdAt','custom','paid','shop'];a12_0x5ad7=function(){return _0x3b02be;};return a12_0x5ad7();}class TelegramController{constructor(){const _0x4b55d5=a12_0x5c4249;this[_0x4b55d5(0x1ff)]=async(_0x30da8,_0x2496ca,_0x3f705a)=>{const _0x4e360b=_0x4b55d5;try{const _0x3e4eb0=telegramBotService_1[_0x4e360b(0x1f8)]['getBotInfo'](),_0x25bbbe=await database_1[_0x4e360b(0x1e2)]['telegramUser'][_0x4e360b(0x207)](),_0x38c717=await database_1[_0x4e360b(0x1e2)][_0x4e360b(0x20c)][_0x4e360b(0x207)]({'where':{'isVerified':!![]}}),_0x33c8c4=await database_1[_0x4e360b(0x1e2)][_0x4e360b(0x20c)]['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2496ca[_0x4e360b(0x1e5)]({'success':!![],'result':{'bot':{'isActive':_0x3e4eb0[_0x4e360b(0x200)],'username':_0x3e4eb0[_0x4e360b(0x1d8)]},'statistics':{'totalUsers':_0x25bbbe,'verifiedUsers':_0x38c717,'unverifiedUsers':_0x25bbbe-_0x38c717,'connectedShops':_0x33c8c4[_0x4e360b(0x20e)]}}});}catch(_0x120458){_0x3f705a(_0x120458);}},this[_0x4b55d5(0x1f6)]=async(_0x5e4458,_0x29e37c,_0x1ce2d0)=>{const _0x4cabb7=_0x4b55d5;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1be8c3}=_0x5e4458['query'],_0x575034=(Number(page)-0x1)*Number(limit),_0x42d2fe={};_0x1be8c3!==undefined&&(_0x42d2fe[_0x4cabb7(0x1dc)]=_0x1be8c3==='true');const [_0x5a5df1,_0x45cbac]=await Promise[_0x4cabb7(0x1db)]([database_1['default']['telegramUser'][_0x4cabb7(0x1d4)]({'where':_0x42d2fe,'skip':_0x575034,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4cabb7(0x1e2)]['telegramUser'][_0x4cabb7(0x207)]({'where':_0x42d2fe})]);_0x29e37c[_0x4cabb7(0x1e5)]({'success':!![],'users':_0x5a5df1['map'](_0x4ab7b5=>({'id':_0x4ab7b5['id'],'telegramId':_0x4ab7b5[_0x4cabb7(0x1e6)],'username':_0x4ab7b5[_0x4cabb7(0x1d8)],'firstName':_0x4ab7b5['firstName'],'lastName':_0x4ab7b5[_0x4cabb7(0x1ea)],'isVerified':_0x4ab7b5[_0x4cabb7(0x1dc)],'shop':_0x4ab7b5[_0x4cabb7(0x206)],'createdAt':_0x4ab7b5[_0x4cabb7(0x203)],'updatedAt':_0x4ab7b5[_0x4cabb7(0x208)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x45cbac,'totalPages':Math['ceil'](_0x45cbac/Number(limit))}});}catch(_0x15dd37){_0x1ce2d0(_0x15dd37);}},this[_0x4b55d5(0x1d7)]=async(_0x21d456,_0x19cd6,_0x1807c9)=>{const _0x44d06a=_0x4b55d5;try{const {message:_0x714504,shopId:_0x2085c3}=_0x21d456[_0x44d06a(0x1f4)];if(!_0x714504)return _0x19cd6[_0x44d06a(0x202)](0x190)[_0x44d06a(0x1e5)]({'success':![],'message':_0x44d06a(0x211)});if(_0x2085c3)await telegramBotService_1[_0x44d06a(0x1f8)][_0x44d06a(0x1e1)](_0x2085c3,_0x714504,{'parse_mode':_0x44d06a(0x1f7)});else{const _0x4eb640=await database_1[_0x44d06a(0x1e2)][_0x44d06a(0x20c)][_0x44d06a(0x1d4)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x40f50e=[...new Set(_0x4eb640['map'](_0x1b71f2=>_0x1b71f2[_0x44d06a(0x1d3)])[_0x44d06a(0x1f3)](Boolean))];for(const _0x543ede of _0x40f50e){_0x543ede&&await telegramBotService_1['telegramBotService'][_0x44d06a(0x1e1)](_0x543ede,_0x714504,{'parse_mode':_0x44d06a(0x1f7)});}}_0x19cd6[_0x44d06a(0x1e5)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x3278c0){_0x1807c9(_0x3278c0);}},this['disconnectUser']=async(_0x158e3e,_0x481364,_0xbaf5a)=>{const _0x26de39=_0x4b55d5;try{const {telegramId:_0x19364e}=_0x158e3e[_0x26de39(0x1fe)],_0x5be51f=await database_1[_0x26de39(0x1e2)][_0x26de39(0x20c)]['findUnique']({'where':{'telegramId':_0x19364e},'include':{'shop':!![]}});if(!_0x5be51f)return _0x481364[_0x26de39(0x202)](0x194)[_0x26de39(0x1e5)]({'success':![],'message':_0x26de39(0x201)});await database_1[_0x26de39(0x1e2)][_0x26de39(0x20c)][_0x26de39(0x210)]({'where':{'telegramId':_0x19364e},'data':{'shopId':null,'isVerified':![]}}),_0x481364[_0x26de39(0x1e5)]({'success':!![],'message':_0x26de39(0x20d)});}catch(_0x3c122f){_0xbaf5a(_0x3c122f);}},this['sendTestNotification']=async(_0x1c444e,_0x1819f8,_0x12e0aa)=>{const _0x3dd3f2=_0x4b55d5;try{const {shopId:_0x3107e1,type:type=_0x3dd3f2(0x1f1),testData:_0x25e66c}=_0x1c444e[_0x3dd3f2(0x1f4)];if(!_0x3107e1)return _0x1819f8['status'](0x190)[_0x3dd3f2(0x1e5)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x326a9e=await database_1['default'][_0x3dd3f2(0x206)][_0x3dd3f2(0x209)]({'where':{'id':_0x3107e1},'select':{'id':!![],'name':!![]}});if(!_0x326a9e)return _0x1819f8['status'](0x194)[_0x3dd3f2(0x1e5)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x3dd3f2(0x1f1):const _0x364b67={'id':'test_payment_123','amount':_0x25e66c?.['amount']||0x64,'currency':_0x25e66c?.[_0x3dd3f2(0x1d1)]||'USD','productName':_0x25e66c?.[_0x3dd3f2(0x1f9)]||_0x3dd3f2(0x1ee),'gateway':_0x25e66c?.[_0x3dd3f2(0x1d5)]||'plisio','createdAt':new Date(),..._0x25e66c};await telegramBotService_1[_0x3dd3f2(0x1f8)]['sendPaymentNotification'](_0x3107e1,_0x364b67,_0x3dd3f2(0x205));break;case _0x3dd3f2(0x1f0):const _0x1e222={'id':_0x3dd3f2(0x20f),'amount':_0x25e66c?.['amount']||0x1f4,'method':_0x25e66c?.['method']||_0x3dd3f2(0x1ed),'createdAt':new Date(),..._0x25e66c};await telegramBotService_1[_0x3dd3f2(0x1f8)]['sendPayoutNotification'](_0x3107e1,_0x1e222,_0x3dd3f2(0x1ec));break;case _0x3dd3f2(0x204):await telegramBotService_1[_0x3dd3f2(0x1f8)][_0x3dd3f2(0x1d2)](_0x3107e1,_0x25e66c?.[_0x3dd3f2(0x1e4)]||_0x3dd3f2(0x1dd),_0x25e66c?.[_0x3dd3f2(0x1da)]||{'message':_0x3dd3f2(0x1d6)});break;default:return _0x1819f8[_0x3dd3f2(0x202)](0x190)[_0x3dd3f2(0x1e5)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x1819f8[_0x3dd3f2(0x1e5)]({'success':!![],'message':_0x3dd3f2(0x1f5)+type+_0x3dd3f2(0x1e8)});}catch(_0x54b36a){_0x12e0aa(_0x54b36a);}};}}exports['TelegramController']=TelegramController;