'use strict';function a12_0x1540(_0x41999f,_0x4ba734){const _0x4610a2=a12_0x4610();return a12_0x1540=function(_0x1540ca,_0x125d8e){_0x1540ca=_0x1540ca-0x135;let _0x4dfd8e=_0x4610a2[_0x1540ca];return _0x4dfd8e;},a12_0x1540(_0x41999f,_0x4ba734);}const a12_0xfda1c=a12_0x1540;(function(_0x370cd8,_0x22ae00){const _0x46f1da=a12_0x1540,_0x133cce=_0x370cd8();while(!![]){try{const _0x3752cd=-parseInt(_0x46f1da(0x14b))/0x1+parseInt(_0x46f1da(0x146))/0x2+-parseInt(_0x46f1da(0x158))/0x3*(-parseInt(_0x46f1da(0x169))/0x4)+parseInt(_0x46f1da(0x13c))/0x5*(-parseInt(_0x46f1da(0x148))/0x6)+parseInt(_0x46f1da(0x141))/0x7*(parseInt(_0x46f1da(0x170))/0x8)+parseInt(_0x46f1da(0x161))/0x9*(-parseInt(_0x46f1da(0x144))/0xa)+parseInt(_0x46f1da(0x16a))/0xb*(parseInt(_0x46f1da(0x162))/0xc);if(_0x3752cd===_0x22ae00)break;else _0x133cce['push'](_0x133cce['shift']());}catch(_0x22a728){_0x133cce['push'](_0x133cce['shift']());}}}(a12_0x4610,0x8ddbd));var __importDefault=this&&this[a12_0xfda1c(0x14f)]||function(_0xae8a6e){return _0xae8a6e&&_0xae8a6e['__esModule']?_0xae8a6e:{'default':_0xae8a6e};};Object['defineProperty'](exports,a12_0xfda1c(0x137),{'value':!![]}),exports[a12_0xfda1c(0x136)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0xfda1c(0x156)));class TelegramController{constructor(){const _0x143d9b=a12_0xfda1c;this[_0x143d9b(0x172)]=async(_0x293c92,_0x3224c1,_0x32b0b9)=>{const _0x5bf092=_0x143d9b;try{const _0x562d8b=telegramBotService_1[_0x5bf092(0x15f)][_0x5bf092(0x173)](),_0x59cfda=await database_1[_0x5bf092(0x14a)]['telegramUser'][_0x5bf092(0x16f)](),_0x5f520e=await database_1[_0x5bf092(0x14a)][_0x5bf092(0x138)]['count']({'where':{'isVerified':!![]}}),_0x34bc8a=await database_1[_0x5bf092(0x14a)]['telegramUser'][_0x5bf092(0x142)]({'by':[_0x5bf092(0x167)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3224c1[_0x5bf092(0x155)]({'success':!![],'result':{'bot':{'isActive':_0x562d8b[_0x5bf092(0x14e)],'username':_0x562d8b[_0x5bf092(0x151)]},'statistics':{'totalUsers':_0x59cfda,'verifiedUsers':_0x5f520e,'unverifiedUsers':_0x59cfda-_0x5f520e,'connectedShops':_0x34bc8a[_0x5bf092(0x15c)]}}});}catch(_0xb63050){_0x32b0b9(_0xb63050);}},this[_0x143d9b(0x150)]=async(_0x50e17e,_0x4593c1,_0x42dfa8)=>{const _0x82fe9=_0x143d9b;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1e62bd}=_0x50e17e[_0x82fe9(0x179)],_0x257bba=(Number(page)-0x1)*Number(limit),_0x4f3f50={};_0x1e62bd!==undefined&&(_0x4f3f50['isVerified']=_0x1e62bd==='true');const [_0x175643,_0x49f20f]=await Promise[_0x82fe9(0x165)]([database_1[_0x82fe9(0x14a)][_0x82fe9(0x138)]['findMany']({'where':_0x4f3f50,'skip':_0x257bba,'take':Number(limit),'orderBy':{'createdAt':_0x82fe9(0x139)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x82fe9(0x14a)]['telegramUser'][_0x82fe9(0x16f)]({'where':_0x4f3f50})]);_0x4593c1['json']({'success':!![],'users':_0x175643[_0x82fe9(0x13b)](_0x1b4638=>({'id':_0x1b4638['id'],'telegramId':_0x1b4638[_0x82fe9(0x15d)],'username':_0x1b4638[_0x82fe9(0x151)],'firstName':_0x1b4638[_0x82fe9(0x152)],'lastName':_0x1b4638[_0x82fe9(0x168)],'isVerified':_0x1b4638[_0x82fe9(0x13a)],'shop':_0x1b4638[_0x82fe9(0x149)],'createdAt':_0x1b4638['createdAt'],'updatedAt':_0x1b4638[_0x82fe9(0x154)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x49f20f,'totalPages':Math[_0x82fe9(0x16b)](_0x49f20f/Number(limit))}});}catch(_0x1509fe){_0x42dfa8(_0x1509fe);}},this[_0x143d9b(0x166)]=async(_0x1820d9,_0x22cd75,_0x409c19)=>{const _0x2a5533=_0x143d9b;try{const {message:_0x23433e,shopId:_0x47756b}=_0x1820d9['body'];if(!_0x23433e)return _0x22cd75[_0x2a5533(0x175)](0x190)[_0x2a5533(0x155)]({'success':![],'message':_0x2a5533(0x17a)});if(_0x47756b)await telegramBotService_1[_0x2a5533(0x15f)]['sendShopNotification'](_0x47756b,_0x23433e,{'parse_mode':_0x2a5533(0x163)});else{const _0x27f838=await database_1[_0x2a5533(0x14a)][_0x2a5533(0x138)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2e43fc=[...new Set(_0x27f838[_0x2a5533(0x13b)](_0x5e7a71=>_0x5e7a71[_0x2a5533(0x167)])[_0x2a5533(0x14d)](Boolean))];for(const _0x43f1e2 of _0x2e43fc){_0x43f1e2&&await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x43f1e2,_0x23433e,{'parse_mode':_0x2a5533(0x163)});}}_0x22cd75[_0x2a5533(0x155)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x1271a6){_0x409c19(_0x1271a6);}},this[_0x143d9b(0x16e)]=async(_0xf3d4f7,_0x3b4d50,_0x31a705)=>{const _0x65439b=_0x143d9b;try{const {telegramId:_0x5848d7}=_0xf3d4f7[_0x65439b(0x159)],_0x3aa583=await database_1[_0x65439b(0x14a)][_0x65439b(0x138)][_0x65439b(0x140)]({'where':{'telegramId':_0x5848d7},'include':{'shop':!![]}});if(!_0x3aa583)return _0x3b4d50[_0x65439b(0x175)](0x194)[_0x65439b(0x155)]({'success':![],'message':_0x65439b(0x160)});await database_1['default'][_0x65439b(0x138)][_0x65439b(0x177)]({'where':{'telegramId':_0x5848d7},'data':{'shopId':null,'isVerified':![]}}),_0x3b4d50[_0x65439b(0x155)]({'success':!![],'message':_0x65439b(0x13e)});}catch(_0x42d26c){_0x31a705(_0x42d26c);}},this[_0x143d9b(0x178)]=async(_0x10414c,_0x4d37ec,_0x4b4cd7)=>{const _0x1e39de=_0x143d9b;try{const {shopId:_0x55aa25,type:type=_0x1e39de(0x15a),testData:_0x1d8de2}=_0x10414c[_0x1e39de(0x145)];if(!_0x55aa25)return _0x4d37ec[_0x1e39de(0x175)](0x190)['json']({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x3c820e=await database_1[_0x1e39de(0x14a)][_0x1e39de(0x149)][_0x1e39de(0x140)]({'where':{'id':_0x55aa25},'select':{'id':!![],'name':!![]}});if(!_0x3c820e)return _0x4d37ec[_0x1e39de(0x175)](0x194)[_0x1e39de(0x155)]({'success':![],'message':_0x1e39de(0x16d)});switch(type){case _0x1e39de(0x15a):const _0x50e1b7={'id':_0x1e39de(0x176),'amount':_0x1d8de2?.[_0x1e39de(0x147)]||0x64,'currency':_0x1d8de2?.['currency']||_0x1e39de(0x15e),'productName':_0x1d8de2?.['productName']||_0x1e39de(0x171),'gateway':_0x1d8de2?.[_0x1e39de(0x17c)]||_0x1e39de(0x15b),'createdAt':new Date(),..._0x1d8de2};await telegramBotService_1[_0x1e39de(0x15f)][_0x1e39de(0x157)](_0x55aa25,_0x50e1b7,_0x1e39de(0x17b));break;case'payout':const _0x268d96={'id':_0x1e39de(0x16c),'amount':_0x1d8de2?.['amount']||0x1f4,'method':_0x1d8de2?.['method']||_0x1e39de(0x13d),'createdAt':new Date(),..._0x1d8de2};await telegramBotService_1[_0x1e39de(0x15f)][_0x1e39de(0x135)](_0x55aa25,_0x268d96,_0x1e39de(0x153));break;case _0x1e39de(0x174):await telegramBotService_1['telegramBotService']['sendCustomNotification'](_0x55aa25,_0x1d8de2?.[_0x1e39de(0x14c)]||_0x1e39de(0x13f),_0x1d8de2?.[_0x1e39de(0x164)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x4d37ec[_0x1e39de(0x175)](0x190)[_0x1e39de(0x155)]({'success':![],'message':_0x1e39de(0x143)});}_0x4d37ec[_0x1e39de(0x155)]({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x2e53d4){_0x4b4cd7(_0x2e53d4);}};}}exports[a12_0xfda1c(0x136)]=TelegramController;function a12_0x4610(){const _0xa6c428=['username','firstName','completed','updatedAt','json','../config/database','sendPaymentNotification','39tUNhad','params','payment','plisio','length','telegramId','USD','telegramBotService','Telegram\x20user\x20not\x20found','36TNMpzx','3396504ZfMRWT','Markdown','details','all','sendBroadcast','shopId','lastName','269564xeDwfL','11xKXpSC','ceil','test_payout_123','Shop\x20not\x20found','disconnectUser','count','56JWSzlS','Test\x20Product','getBotStatus','getBotInfo','custom','status','test_payment_123','update','sendTestNotification','query','Message\x20is\x20required','paid','gateway','sendPayoutNotification','TelegramController','__esModule','telegramUser','desc','isVerified','map','1473095vZnzdi','bank_transfer','User\x20disconnected\x20successfully','Test\x20Notification','findUnique','578333CYbqQC','groupBy','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','766790sMKxLv','body','535298snTMdR','amount','6FCVTlL','shop','default','822719HxasXn','title','filter','isActive','__importDefault','getTelegramUsers'];a12_0x4610=function(){return _0xa6c428;};return a12_0x4610();}