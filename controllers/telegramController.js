'use strict';function a12_0x54bb(_0xa81856,_0x352c4d){const _0x3c1ba4=a12_0x3c1b();return a12_0x54bb=function(_0x54bb33,_0x4d2ee6){_0x54bb33=_0x54bb33-0x189;let _0x4748f9=_0x3c1ba4[_0x54bb33];return _0x4748f9;},a12_0x54bb(_0xa81856,_0x352c4d);}const a12_0x1276d4=a12_0x54bb;(function(_0x5807ec,_0x55eed9){const _0x4c9cf6=a12_0x54bb,_0x2120ac=_0x5807ec();while(!![]){try{const _0x235303=-parseInt(_0x4c9cf6(0x1c1))/0x1+parseInt(_0x4c9cf6(0x19f))/0x2+parseInt(_0x4c9cf6(0x1ac))/0x3+-parseInt(_0x4c9cf6(0x18a))/0x4+-parseInt(_0x4c9cf6(0x1a7))/0x5+-parseInt(_0x4c9cf6(0x1ae))/0x6*(-parseInt(_0x4c9cf6(0x197))/0x7)+-parseInt(_0x4c9cf6(0x195))/0x8;if(_0x235303===_0x55eed9)break;else _0x2120ac['push'](_0x2120ac['shift']());}catch(_0x4d84e8){_0x2120ac['push'](_0x2120ac['shift']());}}}(a12_0x3c1b,0x4b78e));var __importDefault=this&&this[a12_0x1276d4(0x19d)]||function(_0x372c95){const _0xe4d390=a12_0x1276d4;return _0x372c95&&_0x372c95[_0xe4d390(0x1c4)]?_0x372c95:{'default':_0x372c95};};Object[a12_0x1276d4(0x19c)](exports,a12_0x1276d4(0x1c4),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x1276d4(0x1c5)),database_1=__importDefault(require(a12_0x1276d4(0x1be)));class TelegramController{constructor(){const _0x541a5d=a12_0x1276d4;this[_0x541a5d(0x1a8)]=async(_0x35975a,_0x4ea7c8,_0x43ab9d)=>{const _0x1a4a86=_0x541a5d;try{const _0x3dbbd2=telegramBotService_1[_0x1a4a86(0x1c9)][_0x1a4a86(0x1cc)](),_0x39c427=await database_1[_0x1a4a86(0x18b)][_0x1a4a86(0x1b0)][_0x1a4a86(0x1cd)](),_0x3409eb=await database_1['default'][_0x1a4a86(0x1b0)][_0x1a4a86(0x1cd)]({'where':{'isVerified':!![]}}),_0x26a46a=await database_1[_0x1a4a86(0x18b)][_0x1a4a86(0x1b0)][_0x1a4a86(0x1ce)]({'by':[_0x1a4a86(0x199)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4ea7c8[_0x1a4a86(0x1c8)]({'success':!![],'result':{'bot':{'isActive':_0x3dbbd2['isActive'],'username':_0x3dbbd2['username']},'statistics':{'totalUsers':_0x39c427,'verifiedUsers':_0x3409eb,'unverifiedUsers':_0x39c427-_0x3409eb,'connectedShops':_0x26a46a[_0x1a4a86(0x1a5)]}}});}catch(_0x274f07){_0x43ab9d(_0x274f07);}},this[_0x541a5d(0x1a1)]=async(_0x13ae87,_0xf64901,_0x4dd9c2)=>{const _0x237b27=_0x541a5d;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3900da}=_0x13ae87[_0x237b27(0x1a6)],_0xead0c0=(Number(page)-0x1)*Number(limit),_0xac44c9={};_0x3900da!==undefined&&(_0xac44c9['isVerified']=_0x3900da===_0x237b27(0x1bb));const [_0x2a1e59,_0xbbac2e]=await Promise[_0x237b27(0x193)]([database_1[_0x237b27(0x18b)][_0x237b27(0x1b0)][_0x237b27(0x194)]({'where':_0xac44c9,'skip':_0xead0c0,'take':Number(limit),'orderBy':{'createdAt':_0x237b27(0x1af)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x237b27(0x1b0)][_0x237b27(0x1cd)]({'where':_0xac44c9})]);_0xf64901[_0x237b27(0x1c8)]({'success':!![],'users':_0x2a1e59[_0x237b27(0x1ad)](_0x3d4cba=>({'id':_0x3d4cba['id'],'telegramId':_0x3d4cba[_0x237b27(0x18d)],'username':_0x3d4cba['username'],'firstName':_0x3d4cba[_0x237b27(0x1bf)],'lastName':_0x3d4cba[_0x237b27(0x1a3)],'isVerified':_0x3d4cba['isVerified'],'shop':_0x3d4cba[_0x237b27(0x1c7)],'createdAt':_0x3d4cba[_0x237b27(0x1bc)],'updatedAt':_0x3d4cba['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xbbac2e,'totalPages':Math[_0x237b27(0x191)](_0xbbac2e/Number(limit))}});}catch(_0x77a8e2){_0x4dd9c2(_0x77a8e2);}},this['sendBroadcast']=async(_0x52a02e,_0x57c755,_0xcbeb1c)=>{const _0x649329=_0x541a5d;try{const {message:_0x1b086f,shopId:_0x1b2892}=_0x52a02e[_0x649329(0x1a2)];if(!_0x1b086f)return _0x57c755[_0x649329(0x1ba)](0x190)[_0x649329(0x1c8)]({'success':![],'message':_0x649329(0x1bd)});if(_0x1b2892)await telegramBotService_1[_0x649329(0x1c9)]['sendShopNotification'](_0x1b2892,_0x1b086f,{'parse_mode':'Markdown'});else{const _0x1093e4=await database_1[_0x649329(0x18b)][_0x649329(0x1b0)][_0x649329(0x194)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x363729=[...new Set(_0x1093e4[_0x649329(0x1ad)](_0x163d86=>_0x163d86[_0x649329(0x199)])[_0x649329(0x1b9)](Boolean))];for(const _0x38179c of _0x363729){_0x38179c&&await telegramBotService_1[_0x649329(0x1c9)]['sendShopNotification'](_0x38179c,_0x1b086f,{'parse_mode':_0x649329(0x1a4)});}}_0x57c755[_0x649329(0x1c8)]({'success':!![],'message':_0x649329(0x19b)});}catch(_0x1b523a){_0xcbeb1c(_0x1b523a);}},this['disconnectUser']=async(_0x27a9fa,_0x359b60,_0x3bcd52)=>{const _0x148065=_0x541a5d;try{const {telegramId:_0x56b160}=_0x27a9fa['params'],_0x144753=await database_1[_0x148065(0x18b)][_0x148065(0x1b0)][_0x148065(0x1cf)]({'where':{'telegramId':_0x56b160},'include':{'shop':!![]}});if(!_0x144753)return _0x359b60[_0x148065(0x1ba)](0x194)['json']({'success':![],'message':_0x148065(0x18e)});await database_1['default'][_0x148065(0x1b0)][_0x148065(0x198)]({'where':{'telegramId':_0x56b160},'data':{'shopId':null,'isVerified':![]}}),_0x359b60['json']({'success':!![],'message':_0x148065(0x1a9)});}catch(_0x2a00d4){_0x3bcd52(_0x2a00d4);}},this[_0x541a5d(0x18f)]=async(_0x55da8c,_0x4a5d4e,_0x24caba)=>{const _0x36bd22=_0x541a5d;try{const {shopId:_0x306376,type:type='payment',testData:_0x4d38ec}=_0x55da8c['body'];if(!_0x306376)return _0x4a5d4e[_0x36bd22(0x1ba)](0x190)[_0x36bd22(0x1c8)]({'success':![],'message':_0x36bd22(0x1b4)});const _0x1a3a11=await database_1[_0x36bd22(0x18b)][_0x36bd22(0x1c7)][_0x36bd22(0x1cf)]({'where':{'id':_0x306376},'select':{'id':!![],'name':!![]}});if(!_0x1a3a11)return _0x4a5d4e[_0x36bd22(0x1ba)](0x194)[_0x36bd22(0x1c8)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x36bd22(0x1ab):const _0x113dd8={'id':_0x36bd22(0x196),'amount':_0x4d38ec?.[_0x36bd22(0x1b2)]||0x64,'currency':_0x4d38ec?.[_0x36bd22(0x1c6)]||_0x36bd22(0x1b6),'productName':_0x4d38ec?.[_0x36bd22(0x1c3)]||_0x36bd22(0x19a),'gateway':_0x4d38ec?.[_0x36bd22(0x1d0)]||_0x36bd22(0x1c0),'createdAt':new Date(),..._0x4d38ec};await telegramBotService_1[_0x36bd22(0x1c9)][_0x36bd22(0x1aa)](_0x306376,_0x113dd8,_0x36bd22(0x1b1));break;case _0x36bd22(0x1c2):const _0x5d4bc4={'id':_0x36bd22(0x190),'amount':_0x4d38ec?.[_0x36bd22(0x1b2)]||0x1f4,'method':_0x4d38ec?.[_0x36bd22(0x1b3)]||_0x36bd22(0x19e),'createdAt':new Date(),..._0x4d38ec};await telegramBotService_1[_0x36bd22(0x1c9)][_0x36bd22(0x189)](_0x306376,_0x5d4bc4,_0x36bd22(0x1b7));break;case _0x36bd22(0x1b8):await telegramBotService_1[_0x36bd22(0x1c9)][_0x36bd22(0x1b5)](_0x306376,_0x4d38ec?.[_0x36bd22(0x18c)]||_0x36bd22(0x1a0),_0x4d38ec?.['details']||{'message':_0x36bd22(0x1ca)});break;default:return _0x4a5d4e[_0x36bd22(0x1ba)](0x190)[_0x36bd22(0x1c8)]({'success':![],'message':_0x36bd22(0x192)});}_0x4a5d4e[_0x36bd22(0x1c8)]({'success':!![],'message':'Test\x20'+type+_0x36bd22(0x1cb)});}catch(_0x2c1e98){_0x24caba(_0x2c1e98);}};}}function a12_0x3c1b(){const _0x100264=['132456YtZVzX','test_payment_123','63QuZkwn','update','shopId','Test\x20Product','Broadcast\x20message\x20sent\x20successfully','defineProperty','__importDefault','bank_transfer','1043362fkJPKI','Test\x20Notification','getTelegramUsers','body','lastName','Markdown','length','query','1083615PgiDXu','getBotStatus','User\x20disconnected\x20successfully','sendPaymentNotification','payment','896157EgNGfk','map','222468ybCDXf','desc','telegramUser','paid','amount','method','Shop\x20ID\x20is\x20required','sendCustomNotification','USD','completed','custom','filter','status','true','createdAt','Message\x20is\x20required','../config/database','firstName','plisio','54299IMaprf','payout','productName','__esModule','../services/telegramBotService','currency','shop','json','telegramBotService','This\x20is\x20a\x20test\x20notification','\x20notification\x20sent\x20successfully','getBotInfo','count','groupBy','findUnique','gateway','sendPayoutNotification','2229556GzxvyX','default','title','telegramId','Telegram\x20user\x20not\x20found','sendTestNotification','test_payout_123','ceil','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','all','findMany'];a12_0x3c1b=function(){return _0x100264;};return a12_0x3c1b();}exports['TelegramController']=TelegramController;