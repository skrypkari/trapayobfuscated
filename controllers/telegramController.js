'use strict';const a12_0x3b8137=a12_0x3e58;(function(_0x19e321,_0x2da0c3){const _0x5a8fb7=a12_0x3e58,_0x140562=_0x19e321();while(!![]){try{const _0x4e475e=-parseInt(_0x5a8fb7(0xa9))/0x1+-parseInt(_0x5a8fb7(0xc4))/0x2*(-parseInt(_0x5a8fb7(0xa5))/0x3)+parseInt(_0x5a8fb7(0xd2))/0x4+-parseInt(_0x5a8fb7(0xde))/0x5+-parseInt(_0x5a8fb7(0xbd))/0x6*(parseInt(_0x5a8fb7(0xb7))/0x7)+-parseInt(_0x5a8fb7(0xc2))/0x8*(parseInt(_0x5a8fb7(0xb2))/0x9)+parseInt(_0x5a8fb7(0xdf))/0xa;if(_0x4e475e===_0x2da0c3)break;else _0x140562['push'](_0x140562['shift']());}catch(_0x3d362b){_0x140562['push'](_0x140562['shift']());}}}(a12_0x5cd5,0x61413));function a12_0x5cd5(){const _0x9aa923=['TelegramController','defineProperty','payout','filter','telegramUser','query','sendPaymentNotification','Shop\x20ID\x20is\x20required','445773lEThnc','Test\x20','findMany','USD','665230kvxnAX','body','telegramId','../services/telegramBotService','sendBroadcast','shop','sendPayoutNotification','User\x20disconnected\x20successfully','shopId','1017BFCopS','username','test_payout_123','true','map','2702dNQYpa','test_payment_123','__esModule','custom','amount','bank_transfer','8010FfXRSg','Message\x20is\x20required','update','telegramBotService','productName','11768kcblGA','sendTestNotification','2yLPkPO','Markdown','Telegram\x20user\x20not\x20found','disconnectUser','isActive','status','getBotInfo','Test\x20Product','groupBy','payment','ceil','\x20notification\x20sent\x20successfully','createdAt','Test\x20Notification','84028UFOnSr','gateway','__importDefault','findUnique','default','json','updatedAt','all','title','count','currency','sendCustomNotification','2444395nGzIzR','20643990whLSAG','completed','lastName'];a12_0x5cd5=function(){return _0x9aa923;};return a12_0x5cd5();}var __importDefault=this&&this[a12_0x3b8137(0xd4)]||function(_0x46280b){const _0x7fce78=a12_0x3b8137;return _0x46280b&&_0x46280b[_0x7fce78(0xb9)]?_0x46280b:{'default':_0x46280b};};Object[a12_0x3b8137(0xe3)](exports,a12_0x3b8137(0xb9),{'value':!![]}),exports[a12_0x3b8137(0xe2)]=void 0x0;const telegramBotService_1=require(a12_0x3b8137(0xac)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x13f535=a12_0x3b8137;this['getBotStatus']=async(_0x36c001,_0xd733a0,_0x28509f)=>{const _0x4bb0ad=a12_0x3e58;try{const _0x2c9cd5=telegramBotService_1[_0x4bb0ad(0xc0)][_0x4bb0ad(0xca)](),_0x944788=await database_1[_0x4bb0ad(0xd6)][_0x4bb0ad(0xa1)][_0x4bb0ad(0xdb)](),_0x1eb42d=await database_1['default'][_0x4bb0ad(0xa1)][_0x4bb0ad(0xdb)]({'where':{'isVerified':!![]}}),_0x37609d=await database_1[_0x4bb0ad(0xd6)]['telegramUser'][_0x4bb0ad(0xcc)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xd733a0[_0x4bb0ad(0xd7)]({'success':!![],'result':{'bot':{'isActive':_0x2c9cd5[_0x4bb0ad(0xc8)],'username':_0x2c9cd5['username']},'statistics':{'totalUsers':_0x944788,'verifiedUsers':_0x1eb42d,'unverifiedUsers':_0x944788-_0x1eb42d,'connectedShops':_0x37609d['length']}}});}catch(_0x23a02e){_0x28509f(_0x23a02e);}},this['getTelegramUsers']=async(_0xa8ca27,_0x4b3e2a,_0x5eb4ef)=>{const _0x555d77=a12_0x3e58;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2eab07}=_0xa8ca27[_0x555d77(0xa2)],_0x20037c=(Number(page)-0x1)*Number(limit),_0x37c4db={};_0x2eab07!==undefined&&(_0x37c4db['isVerified']=_0x2eab07===_0x555d77(0xb5));const [_0x4b7646,_0x38c9d7]=await Promise[_0x555d77(0xd9)]([database_1[_0x555d77(0xd6)][_0x555d77(0xa1)][_0x555d77(0xa7)]({'where':_0x37c4db,'skip':_0x20037c,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x555d77(0xd6)][_0x555d77(0xa1)][_0x555d77(0xdb)]({'where':_0x37c4db})]);_0x4b3e2a[_0x555d77(0xd7)]({'success':!![],'users':_0x4b7646[_0x555d77(0xb6)](_0x18b4c8=>({'id':_0x18b4c8['id'],'telegramId':_0x18b4c8[_0x555d77(0xab)],'username':_0x18b4c8[_0x555d77(0xb3)],'firstName':_0x18b4c8['firstName'],'lastName':_0x18b4c8[_0x555d77(0xe1)],'isVerified':_0x18b4c8['isVerified'],'shop':_0x18b4c8[_0x555d77(0xae)],'createdAt':_0x18b4c8[_0x555d77(0xd0)],'updatedAt':_0x18b4c8[_0x555d77(0xd8)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x38c9d7,'totalPages':Math[_0x555d77(0xce)](_0x38c9d7/Number(limit))}});}catch(_0x10ff3f){_0x5eb4ef(_0x10ff3f);}},this[_0x13f535(0xad)]=async(_0xdf511c,_0x2bd9cf,_0x43dfe2)=>{const _0x3b7329=_0x13f535;try{const {message:_0x44ea64,shopId:_0x1b397e}=_0xdf511c['body'];if(!_0x44ea64)return _0x2bd9cf['status'](0x190)[_0x3b7329(0xd7)]({'success':![],'message':_0x3b7329(0xbe)});if(_0x1b397e)await telegramBotService_1[_0x3b7329(0xc0)]['sendShopNotification'](_0x1b397e,_0x44ea64,{'parse_mode':_0x3b7329(0xc5)});else{const _0x41f874=await database_1[_0x3b7329(0xd6)][_0x3b7329(0xa1)][_0x3b7329(0xa7)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3c8af6=[...new Set(_0x41f874['map'](_0x59b527=>_0x59b527[_0x3b7329(0xb1)])[_0x3b7329(0xe5)](Boolean))];for(const _0x483b23 of _0x3c8af6){_0x483b23&&await telegramBotService_1[_0x3b7329(0xc0)]['sendShopNotification'](_0x483b23,_0x44ea64,{'parse_mode':_0x3b7329(0xc5)});}}_0x2bd9cf[_0x3b7329(0xd7)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x42272e){_0x43dfe2(_0x42272e);}},this[_0x13f535(0xc7)]=async(_0x1c6f57,_0x5d50f5,_0x560588)=>{const _0x1dbc65=_0x13f535;try{const {telegramId:_0x5027cb}=_0x1c6f57['params'],_0x5f0701=await database_1[_0x1dbc65(0xd6)]['telegramUser'][_0x1dbc65(0xd5)]({'where':{'telegramId':_0x5027cb},'include':{'shop':!![]}});if(!_0x5f0701)return _0x5d50f5[_0x1dbc65(0xc9)](0x194)[_0x1dbc65(0xd7)]({'success':![],'message':_0x1dbc65(0xc6)});await database_1[_0x1dbc65(0xd6)]['telegramUser'][_0x1dbc65(0xbf)]({'where':{'telegramId':_0x5027cb},'data':{'shopId':null,'isVerified':![]}}),_0x5d50f5[_0x1dbc65(0xd7)]({'success':!![],'message':_0x1dbc65(0xb0)});}catch(_0x4757c2){_0x560588(_0x4757c2);}},this[_0x13f535(0xc3)]=async(_0x455d4d,_0x3aa6c5,_0x7db3ad)=>{const _0x2a24ff=_0x13f535;try{const {shopId:_0x3d3a0d,type:type=_0x2a24ff(0xcd),testData:_0x4ddd2e}=_0x455d4d[_0x2a24ff(0xaa)];if(!_0x3d3a0d)return _0x3aa6c5[_0x2a24ff(0xc9)](0x190)[_0x2a24ff(0xd7)]({'success':![],'message':_0x2a24ff(0xa4)});const _0x1bb730=await database_1[_0x2a24ff(0xd6)][_0x2a24ff(0xae)][_0x2a24ff(0xd5)]({'where':{'id':_0x3d3a0d},'select':{'id':!![],'name':!![]}});if(!_0x1bb730)return _0x3aa6c5['status'](0x194)[_0x2a24ff(0xd7)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0x45561b={'id':_0x2a24ff(0xb8),'amount':_0x4ddd2e?.[_0x2a24ff(0xbb)]||0x64,'currency':_0x4ddd2e?.[_0x2a24ff(0xdc)]||_0x2a24ff(0xa8),'productName':_0x4ddd2e?.[_0x2a24ff(0xc1)]||_0x2a24ff(0xcb),'gateway':_0x4ddd2e?.[_0x2a24ff(0xd3)]||'plisio','createdAt':new Date(),..._0x4ddd2e};await telegramBotService_1[_0x2a24ff(0xc0)][_0x2a24ff(0xa3)](_0x3d3a0d,_0x45561b,'paid');break;case _0x2a24ff(0xe4):const _0x4347f9={'id':_0x2a24ff(0xb4),'amount':_0x4ddd2e?.[_0x2a24ff(0xbb)]||0x1f4,'method':_0x4ddd2e?.['method']||_0x2a24ff(0xbc),'createdAt':new Date(),..._0x4ddd2e};await telegramBotService_1[_0x2a24ff(0xc0)][_0x2a24ff(0xaf)](_0x3d3a0d,_0x4347f9,_0x2a24ff(0xe0));break;case _0x2a24ff(0xba):await telegramBotService_1[_0x2a24ff(0xc0)][_0x2a24ff(0xdd)](_0x3d3a0d,_0x4ddd2e?.[_0x2a24ff(0xda)]||_0x2a24ff(0xd1),_0x4ddd2e?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x3aa6c5['status'](0x190)[_0x2a24ff(0xd7)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x3aa6c5[_0x2a24ff(0xd7)]({'success':!![],'message':_0x2a24ff(0xa6)+type+_0x2a24ff(0xcf)});}catch(_0x182c17){_0x7db3ad(_0x182c17);}};}}function a12_0x3e58(_0x6d2a32,_0x114b5e){const _0x5cd5ef=a12_0x5cd5();return a12_0x3e58=function(_0x3e586e,_0xa4beb7){_0x3e586e=_0x3e586e-0xa1;let _0x5f163=_0x5cd5ef[_0x3e586e];return _0x5f163;},a12_0x3e58(_0x6d2a32,_0x114b5e);}exports['TelegramController']=TelegramController;