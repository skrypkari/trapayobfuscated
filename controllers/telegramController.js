'use strict';const a14_0x1792bf=a14_0x59d4;(function(_0x5429cc,_0x243c52){const _0x101041=a14_0x59d4,_0x5b5cc2=_0x5429cc();while(!![]){try{const _0x3582f5=parseInt(_0x101041(0x162))/0x1*(parseInt(_0x101041(0x12c))/0x2)+parseInt(_0x101041(0x157))/0x3+parseInt(_0x101041(0x129))/0x4+-parseInt(_0x101041(0x140))/0x5+-parseInt(_0x101041(0x14a))/0x6+-parseInt(_0x101041(0x164))/0x7*(parseInt(_0x101041(0x135))/0x8)+parseInt(_0x101041(0x12e))/0x9;if(_0x3582f5===_0x243c52)break;else _0x5b5cc2['push'](_0x5b5cc2['shift']());}catch(_0xbfeb61){_0x5b5cc2['push'](_0x5b5cc2['shift']());}}}(a14_0x1d5a,0x4c9da));function a14_0x1d5a(){const _0x1573a3=['Message\x20is\x20required','1522890blaciF','Telegram\x20user\x20not\x20found','ceil','Broadcast\x20message\x20sent\x20successfully','desc','sendPaymentNotification','plisio','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','User\x20disconnected\x20successfully','true','productName','isVerified','telegramId','1539987nQeVKf','Test\x20Product','query','payment','findMany','default','lastName','details','test_payout_123','Test\x20Notification','Shop\x20ID\x20is\x20required','567841FfZqGQ','updatedAt','7MiZDiV','telegramBotService','This\x20is\x20a\x20test\x20notification','method','getBotStatus','USD','groupBy','firstName','getTelegramUsers','custom','../services/telegramBotService','filter','defineProperty','sendShopNotification','sendTestNotification','payout','gateway','../config/database','917280xCqgmL','bank_transfer','Test\x20','2tEUELB','test_payment_123','497520gubWrw','Markdown','json','username','map','createdAt','status','2299824mxhGSz','__importDefault','__esModule','paid','telegramUser','currency','shopId','TelegramController','update','sendPayoutNotification','findUnique','2553295mhcEKo','shop','completed','count','Shop\x20not\x20found','sendBroadcast','title','getBotInfo','body'];a14_0x1d5a=function(){return _0x1573a3;};return a14_0x1d5a();}function a14_0x59d4(_0x13c154,_0x4f2e0c){const _0x1d5a14=a14_0x1d5a();return a14_0x59d4=function(_0x59d425,_0x116219){_0x59d425=_0x59d425-0x11a;let _0x1077dc=_0x1d5a14[_0x59d425];return _0x1077dc;},a14_0x59d4(_0x13c154,_0x4f2e0c);}var __importDefault=this&&this[a14_0x1792bf(0x136)]||function(_0x1c699b){const _0x246981=a14_0x1792bf;return _0x1c699b&&_0x1c699b[_0x246981(0x137)]?_0x1c699b:{'default':_0x1c699b};};Object[a14_0x1792bf(0x123)](exports,'__esModule',{'value':!![]}),exports[a14_0x1792bf(0x13c)]=void 0x0;const telegramBotService_1=require(a14_0x1792bf(0x121)),database_1=__importDefault(require(a14_0x1792bf(0x128)));class TelegramController{constructor(){const _0x36ab86=a14_0x1792bf;this[_0x36ab86(0x11b)]=async(_0x460d04,_0x1ad78b,_0x1ba92d)=>{const _0x3d4956=_0x36ab86;try{const _0x51b967=telegramBotService_1['telegramBotService'][_0x3d4956(0x147)](),_0x4f23b0=await database_1['default']['telegramUser']['count'](),_0x3e40da=await database_1['default']['telegramUser'][_0x3d4956(0x143)]({'where':{'isVerified':!![]}}),_0x3a34e4=await database_1[_0x3d4956(0x15c)]['telegramUser'][_0x3d4956(0x11d)]({'by':[_0x3d4956(0x13b)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1ad78b[_0x3d4956(0x130)]({'success':!![],'result':{'bot':{'isActive':_0x51b967['isActive'],'username':_0x51b967[_0x3d4956(0x131)]},'statistics':{'totalUsers':_0x4f23b0,'verifiedUsers':_0x3e40da,'unverifiedUsers':_0x4f23b0-_0x3e40da,'connectedShops':_0x3a34e4['length']}}});}catch(_0x1fcd57){_0x1ba92d(_0x1fcd57);}},this[_0x36ab86(0x11f)]=async(_0x2acd1e,_0x2e514d,_0x349baf)=>{const _0x13c6ee=_0x36ab86;try{const {page:page=0x1,limit:limit=0x14,verified:_0x388ed0}=_0x2acd1e[_0x13c6ee(0x159)],_0x2e8d5e=(Number(page)-0x1)*Number(limit),_0x45a45d={};_0x388ed0!==undefined&&(_0x45a45d['isVerified']=_0x388ed0===_0x13c6ee(0x153));const [_0x17d6cf,_0x31a752]=await Promise['all']([database_1[_0x13c6ee(0x15c)][_0x13c6ee(0x139)][_0x13c6ee(0x15b)]({'where':_0x45a45d,'skip':_0x2e8d5e,'take':Number(limit),'orderBy':{'createdAt':_0x13c6ee(0x14e)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x13c6ee(0x139)][_0x13c6ee(0x143)]({'where':_0x45a45d})]);_0x2e514d[_0x13c6ee(0x130)]({'success':!![],'users':_0x17d6cf[_0x13c6ee(0x132)](_0x73d6e5=>({'id':_0x73d6e5['id'],'telegramId':_0x73d6e5[_0x13c6ee(0x156)],'username':_0x73d6e5[_0x13c6ee(0x131)],'firstName':_0x73d6e5[_0x13c6ee(0x11e)],'lastName':_0x73d6e5[_0x13c6ee(0x15d)],'isVerified':_0x73d6e5[_0x13c6ee(0x155)],'shop':_0x73d6e5[_0x13c6ee(0x141)],'createdAt':_0x73d6e5[_0x13c6ee(0x133)],'updatedAt':_0x73d6e5[_0x13c6ee(0x163)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x31a752,'totalPages':Math[_0x13c6ee(0x14c)](_0x31a752/Number(limit))}});}catch(_0x6db122){_0x349baf(_0x6db122);}},this[_0x36ab86(0x145)]=async(_0x13113f,_0x441c19,_0x1acabf)=>{const _0x45e3ae=_0x36ab86;try{const {message:_0x4c8c07,shopId:_0x28426e}=_0x13113f[_0x45e3ae(0x148)];if(!_0x4c8c07)return _0x441c19['status'](0x190)[_0x45e3ae(0x130)]({'success':![],'message':_0x45e3ae(0x149)});if(_0x28426e)await telegramBotService_1[_0x45e3ae(0x165)][_0x45e3ae(0x124)](_0x28426e,_0x4c8c07,{'parse_mode':_0x45e3ae(0x12f)});else{const _0xd01934=await database_1[_0x45e3ae(0x15c)]['telegramUser'][_0x45e3ae(0x15b)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4222f3=[...new Set(_0xd01934['map'](_0x367ed8=>_0x367ed8[_0x45e3ae(0x13b)])[_0x45e3ae(0x122)](Boolean))];for(const _0x3d870a of _0x4222f3){_0x3d870a&&await telegramBotService_1[_0x45e3ae(0x165)][_0x45e3ae(0x124)](_0x3d870a,_0x4c8c07,{'parse_mode':_0x45e3ae(0x12f)});}}_0x441c19[_0x45e3ae(0x130)]({'success':!![],'message':_0x45e3ae(0x14d)});}catch(_0x5cf7e1){_0x1acabf(_0x5cf7e1);}},this['disconnectUser']=async(_0x26bcc9,_0x3fe5ea,_0x108f00)=>{const _0x443cdc=_0x36ab86;try{const {telegramId:_0x7805b3}=_0x26bcc9['params'],_0x4f7c86=await database_1[_0x443cdc(0x15c)]['telegramUser'][_0x443cdc(0x13f)]({'where':{'telegramId':_0x7805b3},'include':{'shop':!![]}});if(!_0x4f7c86)return _0x3fe5ea['status'](0x194)['json']({'success':![],'message':_0x443cdc(0x14b)});await database_1[_0x443cdc(0x15c)][_0x443cdc(0x139)][_0x443cdc(0x13d)]({'where':{'telegramId':_0x7805b3},'data':{'shopId':null,'isVerified':![]}}),_0x3fe5ea[_0x443cdc(0x130)]({'success':!![],'message':_0x443cdc(0x152)});}catch(_0x35609d){_0x108f00(_0x35609d);}},this[_0x36ab86(0x125)]=async(_0x4b25c7,_0x46df59,_0x3757ec)=>{const _0x31d8fd=_0x36ab86;try{const {shopId:_0x2eb113,type:type='payment',testData:_0x58e5c5}=_0x4b25c7[_0x31d8fd(0x148)];if(!_0x2eb113)return _0x46df59[_0x31d8fd(0x134)](0x190)[_0x31d8fd(0x130)]({'success':![],'message':_0x31d8fd(0x161)});const _0xf7da70=await database_1[_0x31d8fd(0x15c)][_0x31d8fd(0x141)][_0x31d8fd(0x13f)]({'where':{'id':_0x2eb113},'select':{'id':!![],'name':!![]}});if(!_0xf7da70)return _0x46df59[_0x31d8fd(0x134)](0x194)['json']({'success':![],'message':_0x31d8fd(0x144)});switch(type){case _0x31d8fd(0x15a):const _0x1136f2={'id':_0x31d8fd(0x12d),'amount':_0x58e5c5?.['amount']||0x64,'currency':_0x58e5c5?.[_0x31d8fd(0x13a)]||_0x31d8fd(0x11c),'productName':_0x58e5c5?.[_0x31d8fd(0x154)]||_0x31d8fd(0x158),'gateway':_0x58e5c5?.[_0x31d8fd(0x127)]||_0x31d8fd(0x150),'createdAt':new Date(),..._0x58e5c5};await telegramBotService_1[_0x31d8fd(0x165)][_0x31d8fd(0x14f)](_0x2eb113,_0x1136f2,_0x31d8fd(0x138));break;case _0x31d8fd(0x126):const _0x527682={'id':_0x31d8fd(0x15f),'amount':_0x58e5c5?.['amount']||0x1f4,'method':_0x58e5c5?.[_0x31d8fd(0x11a)]||_0x31d8fd(0x12a),'createdAt':new Date(),..._0x58e5c5};await telegramBotService_1[_0x31d8fd(0x165)][_0x31d8fd(0x13e)](_0x2eb113,_0x527682,_0x31d8fd(0x142));break;case _0x31d8fd(0x120):await telegramBotService_1['telegramBotService']['sendCustomNotification'](_0x2eb113,_0x58e5c5?.[_0x31d8fd(0x146)]||_0x31d8fd(0x160),_0x58e5c5?.[_0x31d8fd(0x15e)]||{'message':_0x31d8fd(0x166)});break;default:return _0x46df59[_0x31d8fd(0x134)](0x190)['json']({'success':![],'message':_0x31d8fd(0x151)});}_0x46df59['json']({'success':!![],'message':_0x31d8fd(0x12b)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x389575){_0x3757ec(_0x389575);}};}}exports[a14_0x1792bf(0x13c)]=TelegramController;