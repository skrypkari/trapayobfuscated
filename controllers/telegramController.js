'use strict';const a12_0x2b8b02=a12_0x39ca;(function(_0x5877f2,_0x40e660){const _0x1694a9=a12_0x39ca,_0x493c81=_0x5877f2();while(!![]){try{const _0x1d4713=-parseInt(_0x1694a9(0xb8))/0x1*(-parseInt(_0x1694a9(0x97))/0x2)+parseInt(_0x1694a9(0xbf))/0x3*(-parseInt(_0x1694a9(0x9c))/0x4)+-parseInt(_0x1694a9(0xac))/0x5+parseInt(_0x1694a9(0xa0))/0x6+-parseInt(_0x1694a9(0xae))/0x7+-parseInt(_0x1694a9(0xcb))/0x8*(parseInt(_0x1694a9(0xc0))/0x9)+parseInt(_0x1694a9(0x9e))/0xa;if(_0x1d4713===_0x40e660)break;else _0x493c81['push'](_0x493c81['shift']());}catch(_0x18a8a5){_0x493c81['push'](_0x493c81['shift']());}}}(a12_0x1419,0x575bd));var __importDefault=this&&this[a12_0x2b8b02(0xc8)]||function(_0x5208dc){const _0x4b231a=a12_0x2b8b02;return _0x5208dc&&_0x5208dc[_0x4b231a(0xa9)]?_0x5208dc:{'default':_0x5208dc};};Object[a12_0x2b8b02(0xc9)](exports,a12_0x2b8b02(0xa9),{'value':!![]}),exports[a12_0x2b8b02(0xc5)]=void 0x0;function a12_0x39ca(_0x5aa6a8,_0x415be4){const _0x1419e0=a12_0x1419();return a12_0x39ca=function(_0x39ca40,_0x3a3047){_0x39ca40=_0x39ca40-0x8d;let _0x396af2=_0x1419e0[_0x39ca40];return _0x396af2;},a12_0x39ca(_0x5aa6a8,_0x415be4);}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x2b8b02(0x94)));class TelegramController{constructor(){const _0x1dc18b=a12_0x2b8b02;this[_0x1dc18b(0x91)]=async(_0x4e3a4d,_0x485340,_0x53cf34)=>{const _0xecd7fb=_0x1dc18b;try{const _0x22bf19=telegramBotService_1[_0xecd7fb(0xa7)][_0xecd7fb(0x96)](),_0x2158c1=await database_1[_0xecd7fb(0xc2)][_0xecd7fb(0xba)][_0xecd7fb(0xc6)](),_0x264920=await database_1[_0xecd7fb(0xc2)]['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x395396=await database_1[_0xecd7fb(0xc2)][_0xecd7fb(0xba)]['groupBy']({'by':[_0xecd7fb(0xa2)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x485340[_0xecd7fb(0xc7)]({'success':!![],'result':{'bot':{'isActive':_0x22bf19['isActive'],'username':_0x22bf19['username']},'statistics':{'totalUsers':_0x2158c1,'verifiedUsers':_0x264920,'unverifiedUsers':_0x2158c1-_0x264920,'connectedShops':_0x395396['length']}}});}catch(_0x5cc014){_0x53cf34(_0x5cc014);}},this['getTelegramUsers']=async(_0xc67b5a,_0xeb4df9,_0x6a7659)=>{const _0x2ec943=_0x1dc18b;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5cf63c}=_0xc67b5a['query'],_0x389d93=(Number(page)-0x1)*Number(limit),_0x59b243={};_0x5cf63c!==undefined&&(_0x59b243[_0x2ec943(0xb2)]=_0x5cf63c==='true');const [_0x4b0821,_0x319d2a]=await Promise[_0x2ec943(0x9b)]([database_1['default'][_0x2ec943(0xba)][_0x2ec943(0xa1)]({'where':_0x59b243,'skip':_0x389d93,'take':Number(limit),'orderBy':{'createdAt':_0x2ec943(0xbe)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2ec943(0xc2)][_0x2ec943(0xba)][_0x2ec943(0xc6)]({'where':_0x59b243})]);_0xeb4df9[_0x2ec943(0xc7)]({'success':!![],'users':_0x4b0821[_0x2ec943(0x93)](_0xd4094a=>({'id':_0xd4094a['id'],'telegramId':_0xd4094a[_0x2ec943(0x9d)],'username':_0xd4094a[_0x2ec943(0xcf)],'firstName':_0xd4094a[_0x2ec943(0x8d)],'lastName':_0xd4094a[_0x2ec943(0xa8)],'isVerified':_0xd4094a[_0x2ec943(0xb2)],'shop':_0xd4094a['shop'],'createdAt':_0xd4094a[_0x2ec943(0x99)],'updatedAt':_0xd4094a[_0x2ec943(0xc1)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x319d2a,'totalPages':Math['ceil'](_0x319d2a/Number(limit))}});}catch(_0x26777f){_0x6a7659(_0x26777f);}},this[_0x1dc18b(0xbc)]=async(_0x58c7a6,_0x578b62,_0x36e636)=>{const _0x279488=_0x1dc18b;try{const {message:_0x56494d,shopId:_0x3cbc1d}=_0x58c7a6[_0x279488(0xcd)];if(!_0x56494d)return _0x578b62[_0x279488(0xb0)](0x190)[_0x279488(0xc7)]({'success':![],'message':'Message\x20is\x20required'});if(_0x3cbc1d)await telegramBotService_1[_0x279488(0xa7)]['sendShopNotification'](_0x3cbc1d,_0x56494d,{'parse_mode':_0x279488(0x9a)});else{const _0x423089=await database_1[_0x279488(0xc2)]['telegramUser'][_0x279488(0xa1)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4454da=[...new Set(_0x423089[_0x279488(0x93)](_0x500113=>_0x500113[_0x279488(0xa2)])['filter'](Boolean))];for(const _0x2b75c7 of _0x4454da){_0x2b75c7&&await telegramBotService_1['telegramBotService'][_0x279488(0xb9)](_0x2b75c7,_0x56494d,{'parse_mode':'Markdown'});}}_0x578b62[_0x279488(0xc7)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x27f0a1){_0x36e636(_0x27f0a1);}},this[_0x1dc18b(0xcc)]=async(_0x302da0,_0x3e85b5,_0x24521a)=>{const _0x5c0e6c=_0x1dc18b;try{const {telegramId:_0x2c5985}=_0x302da0[_0x5c0e6c(0xb1)],_0x383955=await database_1[_0x5c0e6c(0xc2)][_0x5c0e6c(0xba)][_0x5c0e6c(0xb6)]({'where':{'telegramId':_0x2c5985},'include':{'shop':!![]}});if(!_0x383955)return _0x3e85b5[_0x5c0e6c(0xb0)](0x194)[_0x5c0e6c(0xc7)]({'success':![],'message':_0x5c0e6c(0xb3)});await database_1['default'][_0x5c0e6c(0xba)][_0x5c0e6c(0xa6)]({'where':{'telegramId':_0x2c5985},'data':{'shopId':null,'isVerified':![]}}),_0x3e85b5[_0x5c0e6c(0xc7)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x1a826e){_0x24521a(_0x1a826e);}},this[_0x1dc18b(0xce)]=async(_0x645b72,_0x22c61a,_0xd80c9)=>{const _0x199502=_0x1dc18b;try{const {shopId:_0x4e5fc5,type:type=_0x199502(0x8f),testData:_0x87eb33}=_0x645b72[_0x199502(0xcd)];if(!_0x4e5fc5)return _0x22c61a[_0x199502(0xb0)](0x190)[_0x199502(0xc7)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x4437d2=await database_1['default']['shop']['findUnique']({'where':{'id':_0x4e5fc5},'select':{'id':!![],'name':!![]}});if(!_0x4437d2)return _0x22c61a['status'](0x194)[_0x199502(0xc7)]({'success':![],'message':_0x199502(0xa3)});switch(type){case'payment':const _0x59f972={'id':_0x199502(0xa5),'amount':_0x87eb33?.[_0x199502(0xad)]||0x64,'currency':_0x87eb33?.['currency']||_0x199502(0xa4),'productName':_0x87eb33?.[_0x199502(0xb7)]||'Test\x20Product','gateway':_0x87eb33?.[_0x199502(0x9f)]||_0x199502(0x90),'createdAt':new Date(),..._0x87eb33};await telegramBotService_1['telegramBotService'][_0x199502(0xab)](_0x4e5fc5,_0x59f972,_0x199502(0x98));break;case _0x199502(0xbb):const _0x154bf8={'id':'test_payout_123','amount':_0x87eb33?.[_0x199502(0xad)]||0x1f4,'method':_0x87eb33?.[_0x199502(0xaa)]||_0x199502(0xb4),'createdAt':new Date(),..._0x87eb33};await telegramBotService_1[_0x199502(0xa7)][_0x199502(0xca)](_0x4e5fc5,_0x154bf8,_0x199502(0x95));break;case'custom':await telegramBotService_1[_0x199502(0xa7)][_0x199502(0xb5)](_0x4e5fc5,_0x87eb33?.[_0x199502(0xc4)]||'Test\x20Notification',_0x87eb33?.[_0x199502(0xc3)]||{'message':_0x199502(0x92)});break;default:return _0x22c61a[_0x199502(0xb0)](0x190)['json']({'success':![],'message':_0x199502(0x8e)});}_0x22c61a[_0x199502(0xc7)]({'success':!![],'message':_0x199502(0xbd)+type+_0x199502(0xaf)});}catch(_0x123d3d){_0xd80c9(_0x123d3d);}};}}function a12_0x1419(){const _0x28d18a=['sendCustomNotification','findUnique','productName','8608DMWKpG','sendShopNotification','telegramUser','payout','sendBroadcast','Test\x20','desc','3ztYUTl','1269063smyHHb','updatedAt','default','details','title','TelegramController','count','json','__importDefault','defineProperty','sendPayoutNotification','32tNsrSq','disconnectUser','body','sendTestNotification','username','firstName','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','payment','plisio','getBotStatus','This\x20is\x20a\x20test\x20notification','map','../config/database','completed','getBotInfo','118bepabp','paid','createdAt','Markdown','all','2795368XuVakO','telegramId','15855780zJRswW','gateway','2156136fPUgsd','findMany','shopId','Shop\x20not\x20found','USD','test_payment_123','update','telegramBotService','lastName','__esModule','method','sendPaymentNotification','874360wmolej','amount','4600701gVVIso','\x20notification\x20sent\x20successfully','status','params','isVerified','Telegram\x20user\x20not\x20found','bank_transfer'];a12_0x1419=function(){return _0x28d18a;};return a12_0x1419();}exports[a12_0x2b8b02(0xc5)]=TelegramController;