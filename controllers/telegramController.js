'use strict';const a13_0x53563d=a13_0x5b70;(function(_0x380649,_0x415fd6){const _0x5b69a8=a13_0x5b70,_0x537e21=_0x380649();while(!![]){try{const _0x1a155=-parseInt(_0x5b69a8(0xdc))/0x1*(parseInt(_0x5b69a8(0x10b))/0x2)+-parseInt(_0x5b69a8(0xf6))/0x3+parseInt(_0x5b69a8(0xfc))/0x4+parseInt(_0x5b69a8(0x11e))/0x5*(-parseInt(_0x5b69a8(0xee))/0x6)+parseInt(_0x5b69a8(0xe8))/0x7*(parseInt(_0x5b69a8(0x103))/0x8)+-parseInt(_0x5b69a8(0xf8))/0x9*(-parseInt(_0x5b69a8(0xe2))/0xa)+-parseInt(_0x5b69a8(0xea))/0xb;if(_0x1a155===_0x415fd6)break;else _0x537e21['push'](_0x537e21['shift']());}catch(_0x5eee07){_0x537e21['push'](_0x537e21['shift']());}}}(a13_0x542e,0xddcbe));var __importDefault=this&&this['__importDefault']||function(_0x56a572){const _0x2eadab=a13_0x5b70;return _0x56a572&&_0x56a572[_0x2eadab(0x105)]?_0x56a572:{'default':_0x56a572};};function a13_0x542e(){const _0x4321bf=['Test\x20','findUnique','Markdown','895190rsQlVV','details','query','../services/telegramBotService','currency','method','14NSZBdi','gateway','23987557BswdSO','Test\x20Notification','shopId','payment','345540vDdcDU','paid','test_payout_123','username','disconnectUser','params','length','completed','580446ZIfKaD','map','162kWVfmU','sendBroadcast','\x20notification\x20sent\x20successfully','sendPayoutNotification','2835248ZmTzVE','status','custom','getBotStatus','default','Test\x20Product','groupBy','7066872aknIni','title','__esModule','update','isVerified','body','User\x20disconnected\x20successfully','shop','2DWyPvC','defineProperty','isActive','sendPaymentNotification','sendShopNotification','productName','USD','Message\x20is\x20required','bank_transfer','../config/database','firstName','telegramUser','sendCustomNotification','telegramId','telegramBotService','lastName','updatedAt','getBotInfo','desc','25JuFuWj','all','TelegramController','sendTestNotification','Telegram\x20user\x20not\x20found','json','516275tColdH','Shop\x20not\x20found','count'];a13_0x542e=function(){return _0x4321bf;};return a13_0x542e();}Object[a13_0x53563d(0x10c)](exports,a13_0x53563d(0x105),{'value':!![]}),exports[a13_0x53563d(0x120)]=void 0x0;const telegramBotService_1=require(a13_0x53563d(0xe5)),database_1=__importDefault(require(a13_0x53563d(0x114)));class TelegramController{constructor(){const _0x5ee6d8=a13_0x53563d;this[_0x5ee6d8(0xff)]=async(_0x509800,_0x4a3438,_0x455a4e)=>{const _0x1d6df7=_0x5ee6d8;try{const _0x461e36=telegramBotService_1[_0x1d6df7(0x119)][_0x1d6df7(0x11c)](),_0x87be88=await database_1[_0x1d6df7(0x100)][_0x1d6df7(0x116)][_0x1d6df7(0xde)](),_0x1bbd38=await database_1[_0x1d6df7(0x100)][_0x1d6df7(0x116)][_0x1d6df7(0xde)]({'where':{'isVerified':!![]}}),_0x4e66bd=await database_1[_0x1d6df7(0x100)][_0x1d6df7(0x116)][_0x1d6df7(0x102)]({'by':[_0x1d6df7(0xec)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4a3438[_0x1d6df7(0xdb)]({'success':!![],'result':{'bot':{'isActive':_0x461e36[_0x1d6df7(0x10d)],'username':_0x461e36[_0x1d6df7(0xf1)]},'statistics':{'totalUsers':_0x87be88,'verifiedUsers':_0x1bbd38,'unverifiedUsers':_0x87be88-_0x1bbd38,'connectedShops':_0x4e66bd[_0x1d6df7(0xf4)]}}});}catch(_0x15c619){_0x455a4e(_0x15c619);}},this['getTelegramUsers']=async(_0x4f280e,_0x51474d,_0x2d921d)=>{const _0x5cb123=_0x5ee6d8;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1f5f5d}=_0x4f280e[_0x5cb123(0xe4)],_0x402ada=(Number(page)-0x1)*Number(limit),_0x39405e={};_0x1f5f5d!==undefined&&(_0x39405e[_0x5cb123(0x107)]=_0x1f5f5d==='true');const [_0x497d00,_0x1f0318]=await Promise[_0x5cb123(0x11f)]([database_1[_0x5cb123(0x100)]['telegramUser']['findMany']({'where':_0x39405e,'skip':_0x402ada,'take':Number(limit),'orderBy':{'createdAt':_0x5cb123(0x11d)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5cb123(0x100)][_0x5cb123(0x116)]['count']({'where':_0x39405e})]);_0x51474d[_0x5cb123(0xdb)]({'success':!![],'users':_0x497d00[_0x5cb123(0xf7)](_0x4d5d1b=>({'id':_0x4d5d1b['id'],'telegramId':_0x4d5d1b[_0x5cb123(0x118)],'username':_0x4d5d1b[_0x5cb123(0xf1)],'firstName':_0x4d5d1b[_0x5cb123(0x115)],'lastName':_0x4d5d1b[_0x5cb123(0x11a)],'isVerified':_0x4d5d1b[_0x5cb123(0x107)],'shop':_0x4d5d1b['shop'],'createdAt':_0x4d5d1b['createdAt'],'updatedAt':_0x4d5d1b[_0x5cb123(0x11b)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1f0318,'totalPages':Math['ceil'](_0x1f0318/Number(limit))}});}catch(_0x1b3504){_0x2d921d(_0x1b3504);}},this[_0x5ee6d8(0xf9)]=async(_0x10921e,_0x6d13e5,_0x112867)=>{const _0x121983=_0x5ee6d8;try{const {message:_0x172df8,shopId:_0x11f0dc}=_0x10921e[_0x121983(0x108)];if(!_0x172df8)return _0x6d13e5[_0x121983(0xfd)](0x190)[_0x121983(0xdb)]({'success':![],'message':_0x121983(0x112)});if(_0x11f0dc)await telegramBotService_1['telegramBotService'][_0x121983(0x10f)](_0x11f0dc,_0x172df8,{'parse_mode':'Markdown'});else{const _0x2618f4=await database_1[_0x121983(0x100)]['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2934fd=[...new Set(_0x2618f4[_0x121983(0xf7)](_0x55a4d9=>_0x55a4d9['shopId'])['filter'](Boolean))];for(const _0x21bb0d of _0x2934fd){_0x21bb0d&&await telegramBotService_1[_0x121983(0x119)][_0x121983(0x10f)](_0x21bb0d,_0x172df8,{'parse_mode':_0x121983(0xe1)});}}_0x6d13e5[_0x121983(0xdb)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x4df0a1){_0x112867(_0x4df0a1);}},this[_0x5ee6d8(0xf2)]=async(_0x5e25b6,_0x414ef1,_0x518acf)=>{const _0x3c86e2=_0x5ee6d8;try{const {telegramId:_0x16569d}=_0x5e25b6[_0x3c86e2(0xf3)],_0x452700=await database_1[_0x3c86e2(0x100)][_0x3c86e2(0x116)][_0x3c86e2(0xe0)]({'where':{'telegramId':_0x16569d},'include':{'shop':!![]}});if(!_0x452700)return _0x414ef1[_0x3c86e2(0xfd)](0x194)[_0x3c86e2(0xdb)]({'success':![],'message':_0x3c86e2(0xda)});await database_1[_0x3c86e2(0x100)][_0x3c86e2(0x116)][_0x3c86e2(0x106)]({'where':{'telegramId':_0x16569d},'data':{'shopId':null,'isVerified':![]}}),_0x414ef1[_0x3c86e2(0xdb)]({'success':!![],'message':_0x3c86e2(0x109)});}catch(_0x19904d){_0x518acf(_0x19904d);}},this[_0x5ee6d8(0xd9)]=async(_0x30ab29,_0x49d7d4,_0x34015e)=>{const _0x416d0f=_0x5ee6d8;try{const {shopId:_0x5a68cb,type:type=_0x416d0f(0xed),testData:_0x48b350}=_0x30ab29[_0x416d0f(0x108)];if(!_0x5a68cb)return _0x49d7d4[_0x416d0f(0xfd)](0x190)[_0x416d0f(0xdb)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0xa960f8=await database_1[_0x416d0f(0x100)][_0x416d0f(0x10a)][_0x416d0f(0xe0)]({'where':{'id':_0x5a68cb},'select':{'id':!![],'name':!![]}});if(!_0xa960f8)return _0x49d7d4[_0x416d0f(0xfd)](0x194)[_0x416d0f(0xdb)]({'success':![],'message':_0x416d0f(0xdd)});switch(type){case _0x416d0f(0xed):const _0x510da7={'id':'test_payment_123','amount':_0x48b350?.['amount']||0x64,'currency':_0x48b350?.[_0x416d0f(0xe6)]||_0x416d0f(0x111),'productName':_0x48b350?.[_0x416d0f(0x110)]||_0x416d0f(0x101),'gateway':_0x48b350?.[_0x416d0f(0xe9)]||'plisio','createdAt':new Date(),..._0x48b350};await telegramBotService_1[_0x416d0f(0x119)][_0x416d0f(0x10e)](_0x5a68cb,_0x510da7,_0x416d0f(0xef));break;case'payout':const _0x56ff79={'id':_0x416d0f(0xf0),'amount':_0x48b350?.['amount']||0x1f4,'method':_0x48b350?.[_0x416d0f(0xe7)]||_0x416d0f(0x113),'createdAt':new Date(),..._0x48b350};await telegramBotService_1['telegramBotService'][_0x416d0f(0xfb)](_0x5a68cb,_0x56ff79,_0x416d0f(0xf5));break;case _0x416d0f(0xfe):await telegramBotService_1[_0x416d0f(0x119)][_0x416d0f(0x117)](_0x5a68cb,_0x48b350?.[_0x416d0f(0x104)]||_0x416d0f(0xeb),_0x48b350?.[_0x416d0f(0xe3)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x49d7d4[_0x416d0f(0xfd)](0x190)[_0x416d0f(0xdb)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x49d7d4[_0x416d0f(0xdb)]({'success':!![],'message':_0x416d0f(0xdf)+type+_0x416d0f(0xfa)});}catch(_0x331baf){_0x34015e(_0x331baf);}};}}function a13_0x5b70(_0x32244a,_0x21cfd0){const _0x542e33=a13_0x542e();return a13_0x5b70=function(_0x5b7034,_0x1ecfe4){_0x5b7034=_0x5b7034-0xd9;let _0x5abe6b=_0x542e33[_0x5b7034];return _0x5abe6b;},a13_0x5b70(_0x32244a,_0x21cfd0);}exports['TelegramController']=TelegramController;