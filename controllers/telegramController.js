'use strict';const a13_0x1d1d50=a13_0x33d8;(function(_0x50baf9,_0x19461b){const _0x4a6db6=a13_0x33d8,_0x412725=_0x50baf9();while(!![]){try{const _0x19d037=-parseInt(_0x4a6db6(0x1b9))/0x1*(-parseInt(_0x4a6db6(0x1cd))/0x2)+-parseInt(_0x4a6db6(0x1e3))/0x3+-parseInt(_0x4a6db6(0x1d7))/0x4*(parseInt(_0x4a6db6(0x1f5))/0x5)+parseInt(_0x4a6db6(0x1d2))/0x6*(-parseInt(_0x4a6db6(0x1ec))/0x7)+parseInt(_0x4a6db6(0x1be))/0x8+parseInt(_0x4a6db6(0x1b4))/0x9+parseInt(_0x4a6db6(0x1d0))/0xa*(parseInt(_0x4a6db6(0x1ce))/0xb);if(_0x19d037===_0x19461b)break;else _0x412725['push'](_0x412725['shift']());}catch(_0x58cefa){_0x412725['push'](_0x412725['shift']());}}}(a13_0x19ec,0x6c887));var __importDefault=this&&this[a13_0x1d1d50(0x1b8)]||function(_0x38fc5f){const _0x2aefcd=a13_0x1d1d50;return _0x38fc5f&&_0x38fc5f[_0x2aefcd(0x1bb)]?_0x38fc5f:{'default':_0x38fc5f};};Object[a13_0x1d1d50(0x1f2)](exports,a13_0x1d1d50(0x1bb),{'value':!![]}),exports[a13_0x1d1d50(0x1c3)]=void 0x0;const telegramBotService_1=require(a13_0x1d1d50(0x1c1)),database_1=__importDefault(require(a13_0x1d1d50(0x1e8)));class TelegramController{constructor(){const _0x372b21=a13_0x1d1d50;this[_0x372b21(0x1c0)]=async(_0x4cc6d7,_0x4d52e1,_0x39f684)=>{const _0x19d0ca=_0x372b21;try{const _0x282c00=telegramBotService_1[_0x19d0ca(0x1cf)][_0x19d0ca(0x1ca)](),_0x4b3145=await database_1['default'][_0x19d0ca(0x1ea)][_0x19d0ca(0x1ee)](),_0x545290=await database_1[_0x19d0ca(0x1df)][_0x19d0ca(0x1ea)][_0x19d0ca(0x1ee)]({'where':{'isVerified':!![]}}),_0x1a546a=await database_1[_0x19d0ca(0x1df)][_0x19d0ca(0x1ea)]['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4d52e1['json']({'success':!![],'result':{'bot':{'isActive':_0x282c00[_0x19d0ca(0x1c5)],'username':_0x282c00[_0x19d0ca(0x1da)]},'statistics':{'totalUsers':_0x4b3145,'verifiedUsers':_0x545290,'unverifiedUsers':_0x4b3145-_0x545290,'connectedShops':_0x1a546a['length']}}});}catch(_0xde08ff){_0x39f684(_0xde08ff);}},this['getTelegramUsers']=async(_0x33161c,_0x390ce2,_0x5d177e)=>{const _0x3f58a5=_0x372b21;try{const {page:page=0x1,limit:limit=0x14,verified:_0x300316}=_0x33161c['query'],_0x4d8bfc=(Number(page)-0x1)*Number(limit),_0x40f373={};_0x300316!==undefined&&(_0x40f373[_0x3f58a5(0x1c8)]=_0x300316==='true');const [_0x322b01,_0x8c6bfc]=await Promise[_0x3f58a5(0x1eb)]([database_1[_0x3f58a5(0x1df)][_0x3f58a5(0x1ea)][_0x3f58a5(0x1e5)]({'where':_0x40f373,'skip':_0x4d8bfc,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x3f58a5(0x1ea)][_0x3f58a5(0x1ee)]({'where':_0x40f373})]);_0x390ce2[_0x3f58a5(0x1d9)]({'success':!![],'users':_0x322b01[_0x3f58a5(0x1b3)](_0x31c1b2=>({'id':_0x31c1b2['id'],'telegramId':_0x31c1b2[_0x3f58a5(0x1d4)],'username':_0x31c1b2['username'],'firstName':_0x31c1b2[_0x3f58a5(0x1b1)],'lastName':_0x31c1b2[_0x3f58a5(0x1bc)],'isVerified':_0x31c1b2['isVerified'],'shop':_0x31c1b2[_0x3f58a5(0x1d5)],'createdAt':_0x31c1b2['createdAt'],'updatedAt':_0x31c1b2[_0x3f58a5(0x1e1)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x8c6bfc,'totalPages':Math[_0x3f58a5(0x1e2)](_0x8c6bfc/Number(limit))}});}catch(_0x1dd5a7){_0x5d177e(_0x1dd5a7);}},this[_0x372b21(0x1ba)]=async(_0x876ad4,_0x537839,_0x532fdf)=>{const _0x33c8b8=_0x372b21;try{const {message:_0x23cd0f,shopId:_0x4e06b}=_0x876ad4['body'];if(!_0x23cd0f)return _0x537839[_0x33c8b8(0x1e4)](0x190)[_0x33c8b8(0x1d9)]({'success':![],'message':_0x33c8b8(0x1b5)});if(_0x4e06b)await telegramBotService_1[_0x33c8b8(0x1cf)][_0x33c8b8(0x1ed)](_0x4e06b,_0x23cd0f,{'parse_mode':'Markdown'});else{const _0x5bd2f9=await database_1[_0x33c8b8(0x1df)]['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x19c71e=[...new Set(_0x5bd2f9[_0x33c8b8(0x1b3)](_0x3f12ac=>_0x3f12ac[_0x33c8b8(0x1cc)])[_0x33c8b8(0x1db)](Boolean))];for(const _0x4eb74c of _0x19c71e){_0x4eb74c&&await telegramBotService_1[_0x33c8b8(0x1cf)][_0x33c8b8(0x1ed)](_0x4eb74c,_0x23cd0f,{'parse_mode':_0x33c8b8(0x1dc)});}}_0x537839['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x2d43e9){_0x532fdf(_0x2d43e9);}},this['disconnectUser']=async(_0x30a960,_0x121f0b,_0x4a90b3)=>{const _0x1c0c2e=_0x372b21;try{const {telegramId:_0x50eb33}=_0x30a960[_0x1c0c2e(0x1e7)],_0xdeeb18=await database_1['default']['telegramUser'][_0x1c0c2e(0x1b7)]({'where':{'telegramId':_0x50eb33},'include':{'shop':!![]}});if(!_0xdeeb18)return _0x121f0b[_0x1c0c2e(0x1e4)](0x194)[_0x1c0c2e(0x1d9)]({'success':![],'message':_0x1c0c2e(0x1c9)});await database_1[_0x1c0c2e(0x1df)]['telegramUser'][_0x1c0c2e(0x1d1)]({'where':{'telegramId':_0x50eb33},'data':{'shopId':null,'isVerified':![]}}),_0x121f0b[_0x1c0c2e(0x1d9)]({'success':!![],'message':_0x1c0c2e(0x1c7)});}catch(_0x396b13){_0x4a90b3(_0x396b13);}},this[_0x372b21(0x1bf)]=async(_0x1c17cf,_0x36c502,_0x322b4d)=>{const _0x4e5aa4=_0x372b21;try{const {shopId:_0x5d162f,type:type=_0x4e5aa4(0x1d3),testData:_0x702fab}=_0x1c17cf[_0x4e5aa4(0x1c2)];if(!_0x5d162f)return _0x36c502['status'](0x190)['json']({'success':![],'message':_0x4e5aa4(0x1f1)});const _0x510147=await database_1['default'][_0x4e5aa4(0x1d5)][_0x4e5aa4(0x1b7)]({'where':{'id':_0x5d162f},'select':{'id':!![],'name':!![]}});if(!_0x510147)return _0x36c502[_0x4e5aa4(0x1e4)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x4e5aa4(0x1d3):const _0x1e6588={'id':_0x4e5aa4(0x1e9),'amount':_0x702fab?.[_0x4e5aa4(0x1dd)]||0x64,'currency':_0x702fab?.[_0x4e5aa4(0x1e0)]||_0x4e5aa4(0x1cb),'productName':_0x702fab?.[_0x4e5aa4(0x1c6)]||'Test\x20Product','gateway':_0x702fab?.[_0x4e5aa4(0x1c4)]||'plisio','createdAt':new Date(),..._0x702fab};await telegramBotService_1[_0x4e5aa4(0x1cf)][_0x4e5aa4(0x1f0)](_0x5d162f,_0x1e6588,_0x4e5aa4(0x1bd));break;case _0x4e5aa4(0x1f4):const _0x303834={'id':_0x4e5aa4(0x1d6),'amount':_0x702fab?.[_0x4e5aa4(0x1dd)]||0x1f4,'method':_0x702fab?.['method']||'bank_transfer','createdAt':new Date(),..._0x702fab};await telegramBotService_1[_0x4e5aa4(0x1cf)]['sendPayoutNotification'](_0x5d162f,_0x303834,_0x4e5aa4(0x1f3));break;case _0x4e5aa4(0x1e6):await telegramBotService_1[_0x4e5aa4(0x1cf)][_0x4e5aa4(0x1d8)](_0x5d162f,_0x702fab?.['title']||_0x4e5aa4(0x1b6),_0x702fab?.[_0x4e5aa4(0x1de)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x36c502[_0x4e5aa4(0x1e4)](0x190)[_0x4e5aa4(0x1d9)]({'success':![],'message':_0x4e5aa4(0x1b2)});}_0x36c502['json']({'success':!![],'message':_0x4e5aa4(0x1ef)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x55cf7a){_0x322b4d(_0x55cf7a);}};}}exports[a13_0x1d1d50(0x1c3)]=TelegramController;function a13_0x33d8(_0x514d8c,_0x4e114b){const _0x19ec21=a13_0x19ec();return a13_0x33d8=function(_0x33d81e,_0x1e564b){_0x33d81e=_0x33d81e-0x1b1;let _0x511549=_0x19ec21[_0x33d81e];return _0x511549;},a13_0x33d8(_0x514d8c,_0x4e114b);}function a13_0x19ec(){const _0x3bb318=['findMany','custom','params','../config/database','test_payment_123','telegramUser','all','7BLLXIU','sendShopNotification','count','Test\x20','sendPaymentNotification','Shop\x20ID\x20is\x20required','defineProperty','completed','payout','2340cZtPXL','firstName','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','map','6552603MpfcVN','Message\x20is\x20required','Test\x20Notification','findUnique','__importDefault','433oPlDYk','sendBroadcast','__esModule','lastName','paid','7098968YiSpNP','sendTestNotification','getBotStatus','../services/telegramBotService','body','TelegramController','gateway','isActive','productName','User\x20disconnected\x20successfully','isVerified','Telegram\x20user\x20not\x20found','getBotInfo','USD','shopId','672lUuUmb','5838349WVfOJt','telegramBotService','10AmUWau','update','4389630WlZebs','payment','telegramId','shop','test_payout_123','4812zbnttk','sendCustomNotification','json','username','filter','Markdown','amount','details','default','currency','updatedAt','ceil','1657575wDnbhZ','status'];a13_0x19ec=function(){return _0x3bb318;};return a13_0x19ec();}