'use strict';const a12_0x41defc=a12_0x5b36;(function(_0x7cf9d,_0x133247){const _0xe163c0=a12_0x5b36,_0x12722d=_0x7cf9d();while(!![]){try{const _0x131f3e=-parseInt(_0xe163c0(0x1a0))/0x1*(parseInt(_0xe163c0(0x176))/0x2)+-parseInt(_0xe163c0(0x199))/0x3+-parseInt(_0xe163c0(0x19d))/0x4+parseInt(_0xe163c0(0x180))/0x5*(-parseInt(_0xe163c0(0x17a))/0x6)+-parseInt(_0xe163c0(0x1ad))/0x7+parseInt(_0xe163c0(0x1a1))/0x8+parseInt(_0xe163c0(0x190))/0x9;if(_0x131f3e===_0x133247)break;else _0x12722d['push'](_0x12722d['shift']());}catch(_0xcc6165){_0x12722d['push'](_0x12722d['shift']());}}}(a12_0x266a,0x830f8));var __importDefault=this&&this['__importDefault']||function(_0x30b2ab){const _0x1882d5=a12_0x5b36;return _0x30b2ab&&_0x30b2ab[_0x1882d5(0x194)]?_0x30b2ab:{'default':_0x30b2ab};};function a12_0x266a(){const _0x2f6f1a=['completed','ceil','defineProperty','sendTestNotification','createdAt','method','query','username','Broadcast\x20message\x20sent\x20successfully','\x20notification\x20sent\x20successfully','shopId','findUnique','findMany','33554385NayCPg','json','title','getBotInfo','__esModule','test_payment_123','telegramBotService','isVerified','details','2788938CFyvaN','lastName','Telegram\x20user\x20not\x20found','gateway','2088216bqEKKq','telegramId','currency','2JgVEcj','3173024jvFnYt','telegramUser','../config/database','getBotStatus','updatedAt','plisio','all','count','USD','custom','Shop\x20not\x20found','User\x20disconnected\x20successfully','5460938VPfveq','Message\x20is\x20required','disconnectUser','Test\x20Product','body','sendShopNotification','bank_transfer','../services/telegramBotService','getTelegramUsers','sendBroadcast','params','Markdown','productName','default','shop','sendCustomNotification','update','true','isActive','sendPaymentNotification','1041790uTbewu','sendPayoutNotification','length','amount','1886670JkijBE','desc','payment','filter','status','This\x20is\x20a\x20test\x20notification','5gpVYkM','TelegramController','test_payout_123'];a12_0x266a=function(){return _0x2f6f1a;};return a12_0x266a();}Object[a12_0x41defc(0x185)](exports,'__esModule',{'value':!![]}),exports[a12_0x41defc(0x181)]=void 0x0;const telegramBotService_1=require(a12_0x41defc(0x1b4)),database_1=__importDefault(require(a12_0x41defc(0x1a3)));class TelegramController{constructor(){const _0x5dcec=a12_0x41defc;this[_0x5dcec(0x1a4)]=async(_0x14d049,_0x4e5249,_0x11cc7e)=>{const _0x46dfb2=_0x5dcec;try{const _0x446b76=telegramBotService_1[_0x46dfb2(0x196)][_0x46dfb2(0x193)](),_0x4a7627=await database_1[_0x46dfb2(0x16f)][_0x46dfb2(0x1a2)][_0x46dfb2(0x1a8)](),_0x5b3404=await database_1[_0x46dfb2(0x16f)][_0x46dfb2(0x1a2)][_0x46dfb2(0x1a8)]({'where':{'isVerified':!![]}}),_0x20337e=await database_1['default'][_0x46dfb2(0x1a2)]['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4e5249['json']({'success':!![],'result':{'bot':{'isActive':_0x446b76[_0x46dfb2(0x174)],'username':_0x446b76[_0x46dfb2(0x18a)]},'statistics':{'totalUsers':_0x4a7627,'verifiedUsers':_0x5b3404,'unverifiedUsers':_0x4a7627-_0x5b3404,'connectedShops':_0x20337e[_0x46dfb2(0x178)]}}});}catch(_0x5a5477){_0x11cc7e(_0x5a5477);}},this[_0x5dcec(0x1b5)]=async(_0x7dbc45,_0x264bf7,_0xf93ac9)=>{const _0x2f475f=_0x5dcec;try{const {page:page=0x1,limit:limit=0x14,verified:_0x67413b}=_0x7dbc45[_0x2f475f(0x189)],_0x582caa=(Number(page)-0x1)*Number(limit),_0x327f72={};_0x67413b!==undefined&&(_0x327f72[_0x2f475f(0x197)]=_0x67413b===_0x2f475f(0x173));const [_0x134f56,_0x2f4e2c]=await Promise[_0x2f475f(0x1a7)]([database_1['default'][_0x2f475f(0x1a2)][_0x2f475f(0x18f)]({'where':_0x327f72,'skip':_0x582caa,'take':Number(limit),'orderBy':{'createdAt':_0x2f475f(0x17b)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2f475f(0x16f)][_0x2f475f(0x1a2)][_0x2f475f(0x1a8)]({'where':_0x327f72})]);_0x264bf7[_0x2f475f(0x191)]({'success':!![],'users':_0x134f56['map'](_0x3da7c0=>({'id':_0x3da7c0['id'],'telegramId':_0x3da7c0[_0x2f475f(0x19e)],'username':_0x3da7c0['username'],'firstName':_0x3da7c0['firstName'],'lastName':_0x3da7c0[_0x2f475f(0x19a)],'isVerified':_0x3da7c0[_0x2f475f(0x197)],'shop':_0x3da7c0[_0x2f475f(0x170)],'createdAt':_0x3da7c0[_0x2f475f(0x187)],'updatedAt':_0x3da7c0[_0x2f475f(0x1a5)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2f4e2c,'totalPages':Math[_0x2f475f(0x184)](_0x2f4e2c/Number(limit))}});}catch(_0x21e796){_0xf93ac9(_0x21e796);}},this[_0x5dcec(0x1b6)]=async(_0x16a5fb,_0x1e524b,_0x1090ca)=>{const _0x2eadab=_0x5dcec;try{const {message:_0xc9f905,shopId:_0x5b0995}=_0x16a5fb['body'];if(!_0xc9f905)return _0x1e524b['status'](0x190)[_0x2eadab(0x191)]({'success':![],'message':_0x2eadab(0x1ae)});if(_0x5b0995)await telegramBotService_1[_0x2eadab(0x196)][_0x2eadab(0x1b2)](_0x5b0995,_0xc9f905,{'parse_mode':_0x2eadab(0x1b8)});else{const _0x17c0e5=await database_1[_0x2eadab(0x16f)][_0x2eadab(0x1a2)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x550472=[...new Set(_0x17c0e5['map'](_0x4a97d3=>_0x4a97d3[_0x2eadab(0x18d)])[_0x2eadab(0x17d)](Boolean))];for(const _0x559d3a of _0x550472){_0x559d3a&&await telegramBotService_1[_0x2eadab(0x196)][_0x2eadab(0x1b2)](_0x559d3a,_0xc9f905,{'parse_mode':_0x2eadab(0x1b8)});}}_0x1e524b[_0x2eadab(0x191)]({'success':!![],'message':_0x2eadab(0x18b)});}catch(_0x286681){_0x1090ca(_0x286681);}},this[_0x5dcec(0x1af)]=async(_0x272078,_0x540d06,_0x48e47f)=>{const _0x1b1d8b=_0x5dcec;try{const {telegramId:_0x2fe347}=_0x272078[_0x1b1d8b(0x1b7)],_0x3d2b35=await database_1[_0x1b1d8b(0x16f)][_0x1b1d8b(0x1a2)][_0x1b1d8b(0x18e)]({'where':{'telegramId':_0x2fe347},'include':{'shop':!![]}});if(!_0x3d2b35)return _0x540d06[_0x1b1d8b(0x17e)](0x194)[_0x1b1d8b(0x191)]({'success':![],'message':_0x1b1d8b(0x19b)});await database_1[_0x1b1d8b(0x16f)][_0x1b1d8b(0x1a2)][_0x1b1d8b(0x172)]({'where':{'telegramId':_0x2fe347},'data':{'shopId':null,'isVerified':![]}}),_0x540d06['json']({'success':!![],'message':_0x1b1d8b(0x1ac)});}catch(_0x3cb828){_0x48e47f(_0x3cb828);}},this[_0x5dcec(0x186)]=async(_0x587d25,_0x7e76b2,_0x3d5c99)=>{const _0x49cfae=_0x5dcec;try{const {shopId:_0x49d6d9,type:type=_0x49cfae(0x17c),testData:_0x1f6d0b}=_0x587d25[_0x49cfae(0x1b1)];if(!_0x49d6d9)return _0x7e76b2[_0x49cfae(0x17e)](0x190)[_0x49cfae(0x191)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x42f9b4=await database_1[_0x49cfae(0x16f)][_0x49cfae(0x170)][_0x49cfae(0x18e)]({'where':{'id':_0x49d6d9},'select':{'id':!![],'name':!![]}});if(!_0x42f9b4)return _0x7e76b2[_0x49cfae(0x17e)](0x194)['json']({'success':![],'message':_0x49cfae(0x1ab)});switch(type){case _0x49cfae(0x17c):const _0x55b078={'id':_0x49cfae(0x195),'amount':_0x1f6d0b?.[_0x49cfae(0x179)]||0x64,'currency':_0x1f6d0b?.[_0x49cfae(0x19f)]||_0x49cfae(0x1a9),'productName':_0x1f6d0b?.[_0x49cfae(0x1b9)]||_0x49cfae(0x1b0),'gateway':_0x1f6d0b?.[_0x49cfae(0x19c)]||_0x49cfae(0x1a6),'createdAt':new Date(),..._0x1f6d0b};await telegramBotService_1['telegramBotService'][_0x49cfae(0x175)](_0x49d6d9,_0x55b078,'paid');break;case'payout':const _0x102a11={'id':_0x49cfae(0x182),'amount':_0x1f6d0b?.[_0x49cfae(0x179)]||0x1f4,'method':_0x1f6d0b?.[_0x49cfae(0x188)]||_0x49cfae(0x1b3),'createdAt':new Date(),..._0x1f6d0b};await telegramBotService_1[_0x49cfae(0x196)][_0x49cfae(0x177)](_0x49d6d9,_0x102a11,_0x49cfae(0x183));break;case _0x49cfae(0x1aa):await telegramBotService_1[_0x49cfae(0x196)][_0x49cfae(0x171)](_0x49d6d9,_0x1f6d0b?.[_0x49cfae(0x192)]||'Test\x20Notification',_0x1f6d0b?.[_0x49cfae(0x198)]||{'message':_0x49cfae(0x17f)});break;default:return _0x7e76b2[_0x49cfae(0x17e)](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x7e76b2['json']({'success':!![],'message':'Test\x20'+type+_0x49cfae(0x18c)});}catch(_0x193378){_0x3d5c99(_0x193378);}};}}function a12_0x5b36(_0x11aebc,_0x3faaad){const _0x266aa7=a12_0x266a();return a12_0x5b36=function(_0x5b3678,_0x86c972){_0x5b3678=_0x5b3678-0x16f;let _0x4d12f6=_0x266aa7[_0x5b3678];return _0x4d12f6;},a12_0x5b36(_0x11aebc,_0x3faaad);}exports[a12_0x41defc(0x181)]=TelegramController;