'use strict';function a12_0xeaef(_0x4ba2d2,_0x5b2871){const _0x2e6ce1=a12_0x2e6c();return a12_0xeaef=function(_0xeaefe0,_0x9eae3d){_0xeaefe0=_0xeaefe0-0x6f;let _0x301d06=_0x2e6ce1[_0xeaefe0];return _0x301d06;},a12_0xeaef(_0x4ba2d2,_0x5b2871);}const a12_0x30d4fb=a12_0xeaef;(function(_0xbe358e,_0x121dbe){const _0x242094=a12_0xeaef,_0x156ffc=_0xbe358e();while(!![]){try{const _0x169cd2=-parseInt(_0x242094(0xa6))/0x1*(-parseInt(_0x242094(0x7b))/0x2)+parseInt(_0x242094(0xb4))/0x3*(parseInt(_0x242094(0xb8))/0x4)+parseInt(_0x242094(0x90))/0x5*(-parseInt(_0x242094(0x78))/0x6)+parseInt(_0x242094(0xba))/0x7*(-parseInt(_0x242094(0xbd))/0x8)+parseInt(_0x242094(0x9b))/0x9*(parseInt(_0x242094(0x70))/0xa)+-parseInt(_0x242094(0xad))/0xb*(-parseInt(_0x242094(0xa0))/0xc)+parseInt(_0x242094(0x92))/0xd*(-parseInt(_0x242094(0xa7))/0xe);if(_0x169cd2===_0x121dbe)break;else _0x156ffc['push'](_0x156ffc['shift']());}catch(_0x5a1129){_0x156ffc['push'](_0x156ffc['shift']());}}}(a12_0x2e6c,0x6341d));var __importDefault=this&&this['__importDefault']||function(_0x262e92){const _0x5bb86b=a12_0xeaef;return _0x262e92&&_0x262e92[_0x5bb86b(0x8a)]?_0x262e92:{'default':_0x262e92};};Object[a12_0x30d4fb(0x88)](exports,a12_0x30d4fb(0x8a),{'value':!![]}),exports[a12_0x30d4fb(0xa1)]=void 0x0;const telegramBotService_1=require(a12_0x30d4fb(0x8d)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x327a5e=a12_0x30d4fb;this[_0x327a5e(0x80)]=async(_0x3871f7,_0x23159d,_0x388b94)=>{const _0x55ab27=_0x327a5e;try{const _0x306183=telegramBotService_1[_0x55ab27(0xa2)][_0x55ab27(0x8c)](),_0x2975ad=await database_1['default'][_0x55ab27(0x75)][_0x55ab27(0x91)](),_0x22527c=await database_1[_0x55ab27(0x9e)][_0x55ab27(0x75)][_0x55ab27(0x91)]({'where':{'isVerified':!![]}}),_0x104243=await database_1[_0x55ab27(0x9e)]['telegramUser'][_0x55ab27(0x8b)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x23159d[_0x55ab27(0x85)]({'success':!![],'result':{'bot':{'isActive':_0x306183['isActive'],'username':_0x306183[_0x55ab27(0xb0)]},'statistics':{'totalUsers':_0x2975ad,'verifiedUsers':_0x22527c,'unverifiedUsers':_0x2975ad-_0x22527c,'connectedShops':_0x104243[_0x55ab27(0x83)]}}});}catch(_0x506e9a){_0x388b94(_0x506e9a);}},this[_0x327a5e(0x96)]=async(_0x42daf6,_0x409f8f,_0x2a0c7e)=>{const _0x33b569=_0x327a5e;try{const {page:page=0x1,limit:limit=0x14,verified:_0x55cc8a}=_0x42daf6[_0x33b569(0x9a)],_0x237078=(Number(page)-0x1)*Number(limit),_0x40061f={};_0x55cc8a!==undefined&&(_0x40061f[_0x33b569(0x99)]=_0x55cc8a==='true');const [_0x4e00a2,_0x33bd82]=await Promise[_0x33b569(0x81)]([database_1[_0x33b569(0x9e)][_0x33b569(0x75)][_0x33b569(0xb7)]({'where':_0x40061f,'skip':_0x237078,'take':Number(limit),'orderBy':{'createdAt':_0x33b569(0xb1)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x33b569(0x9e)][_0x33b569(0x75)][_0x33b569(0x91)]({'where':_0x40061f})]);_0x409f8f['json']({'success':!![],'users':_0x4e00a2['map'](_0x932c6c=>({'id':_0x932c6c['id'],'telegramId':_0x932c6c[_0x33b569(0xb3)],'username':_0x932c6c[_0x33b569(0xb0)],'firstName':_0x932c6c[_0x33b569(0x6f)],'lastName':_0x932c6c[_0x33b569(0xbe)],'isVerified':_0x932c6c[_0x33b569(0x99)],'shop':_0x932c6c[_0x33b569(0x95)],'createdAt':_0x932c6c['createdAt'],'updatedAt':_0x932c6c[_0x33b569(0x73)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x33bd82,'totalPages':Math[_0x33b569(0x94)](_0x33bd82/Number(limit))}});}catch(_0x5c5306){_0x2a0c7e(_0x5c5306);}},this[_0x327a5e(0x9c)]=async(_0x4d1a4e,_0x573fba,_0xf8c575)=>{const _0x5826ba=_0x327a5e;try{const {message:_0x287079,shopId:_0x522ef1}=_0x4d1a4e[_0x5826ba(0x76)];if(!_0x287079)return _0x573fba[_0x5826ba(0x9f)](0x190)[_0x5826ba(0x85)]({'success':![],'message':_0x5826ba(0xa5)});if(_0x522ef1)await telegramBotService_1[_0x5826ba(0xa2)][_0x5826ba(0xb9)](_0x522ef1,_0x287079,{'parse_mode':'Markdown'});else{const _0x31d62e=await database_1[_0x5826ba(0x9e)]['telegramUser'][_0x5826ba(0xb7)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x91f483=[...new Set(_0x31d62e[_0x5826ba(0x87)](_0x14e218=>_0x14e218[_0x5826ba(0x8e)])[_0x5826ba(0x86)](Boolean))];for(const _0x56a513 of _0x91f483){_0x56a513&&await telegramBotService_1[_0x5826ba(0xa2)][_0x5826ba(0xb9)](_0x56a513,_0x287079,{'parse_mode':_0x5826ba(0x9d)});}}_0x573fba[_0x5826ba(0x85)]({'success':!![],'message':_0x5826ba(0x7e)});}catch(_0x35f350){_0xf8c575(_0x35f350);}},this[_0x327a5e(0x79)]=async(_0x5f0dd3,_0x4883bf,_0x516302)=>{const _0xd5ce3b=_0x327a5e;try{const {telegramId:_0x48a114}=_0x5f0dd3[_0xd5ce3b(0x82)],_0x1415c4=await database_1[_0xd5ce3b(0x9e)][_0xd5ce3b(0x75)][_0xd5ce3b(0x8f)]({'where':{'telegramId':_0x48a114},'include':{'shop':!![]}});if(!_0x1415c4)return _0x4883bf[_0xd5ce3b(0x9f)](0x194)[_0xd5ce3b(0x85)]({'success':![],'message':_0xd5ce3b(0x7f)});await database_1[_0xd5ce3b(0x9e)][_0xd5ce3b(0x75)][_0xd5ce3b(0xae)]({'where':{'telegramId':_0x48a114},'data':{'shopId':null,'isVerified':![]}}),_0x4883bf[_0xd5ce3b(0x85)]({'success':!![],'message':_0xd5ce3b(0xa9)});}catch(_0x186b54){_0x516302(_0x186b54);}},this[_0x327a5e(0x84)]=async(_0x3570f8,_0x1c45bd,_0x572fed)=>{const _0x221d99=_0x327a5e;try{const {shopId:_0x1e2b8f,type:type='payment',testData:_0x151292}=_0x3570f8[_0x221d99(0x76)];if(!_0x1e2b8f)return _0x1c45bd['status'](0x190)[_0x221d99(0x85)]({'success':![],'message':_0x221d99(0xb6)});const _0x134b09=await database_1['default'][_0x221d99(0x95)][_0x221d99(0x8f)]({'where':{'id':_0x1e2b8f},'select':{'id':!![],'name':!![]}});if(!_0x134b09)return _0x1c45bd[_0x221d99(0x9f)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x221d99(0xbb):const _0x1c3a79={'id':_0x221d99(0x97),'amount':_0x151292?.['amount']||0x64,'currency':_0x151292?.[_0x221d99(0xb5)]||_0x221d99(0xab),'productName':_0x151292?.[_0x221d99(0x89)]||'Test\x20Product','gateway':_0x151292?.[_0x221d99(0xa4)]||_0x221d99(0xaf),'createdAt':new Date(),..._0x151292};await telegramBotService_1[_0x221d99(0xa2)][_0x221d99(0x71)](_0x1e2b8f,_0x1c3a79,_0x221d99(0x77));break;case _0x221d99(0x7d):const _0x3467e5={'id':_0x221d99(0xbc),'amount':_0x151292?.[_0x221d99(0xac)]||0x1f4,'method':_0x151292?.[_0x221d99(0xb2)]||_0x221d99(0xa8),'createdAt':new Date(),..._0x151292};await telegramBotService_1[_0x221d99(0xa2)][_0x221d99(0x7a)](_0x1e2b8f,_0x3467e5,_0x221d99(0x72));break;case _0x221d99(0x74):await telegramBotService_1[_0x221d99(0xa2)][_0x221d99(0xa3)](_0x1e2b8f,_0x151292?.[_0x221d99(0xbf)]||'Test\x20Notification',_0x151292?.[_0x221d99(0x98)]||{'message':_0x221d99(0x93)});break;default:return _0x1c45bd[_0x221d99(0x9f)](0x190)[_0x221d99(0x85)]({'success':![],'message':_0x221d99(0xc0)});}_0x1c45bd[_0x221d99(0x85)]({'success':!![],'message':_0x221d99(0x7c)+type+_0x221d99(0xaa)});}catch(_0x377a58){_0x572fed(_0x377a58);}};}}function a12_0x2e6c(){const _0x5845f0=['Broadcast\x20message\x20sent\x20successfully','Telegram\x20user\x20not\x20found','getBotStatus','all','params','length','sendTestNotification','json','filter','map','defineProperty','productName','__esModule','groupBy','getBotInfo','../services/telegramBotService','shopId','findUnique','10iemzjb','count','1235avqeMF','This\x20is\x20a\x20test\x20notification','ceil','shop','getTelegramUsers','test_payment_123','details','isVerified','query','5382VBlKWE','sendBroadcast','Markdown','default','status','187260CzGfHI','TelegramController','telegramBotService','sendCustomNotification','gateway','Message\x20is\x20required','59MGAIOD','1204jnXQmc','bank_transfer','User\x20disconnected\x20successfully','\x20notification\x20sent\x20successfully','USD','amount','297towYfS','update','plisio','username','desc','method','telegramId','15EFpwja','currency','Shop\x20ID\x20is\x20required','findMany','66060ELUQll','sendShopNotification','43561UpHXqZ','payment','test_payout_123','920qAstIV','lastName','title','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','firstName','12790XzKFVb','sendPaymentNotification','completed','updatedAt','custom','telegramUser','body','paid','1749366QMCaJi','disconnectUser','sendPayoutNotification','15076uhhxTi','Test\x20','payout'];a12_0x2e6c=function(){return _0x5845f0;};return a12_0x2e6c();}exports[a12_0x30d4fb(0xa1)]=TelegramController;