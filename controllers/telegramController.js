'use strict';const a12_0x4eb3d7=a12_0x2778;function a12_0x285a(){const _0x2362ca=['username','completed','updatedAt','Test\x20Product','sendTestNotification','isVerified','../services/telegramBotService','details','1660195MUbJFb','title','getTelegramUsers','Message\x20is\x20required','getBotStatus','Shop\x20not\x20found','shopId','26133426UEhela','Test\x20Notification','isActive','query','sendPayoutNotification','status','\x20notification\x20sent\x20successfully','5462205oHtMAL','method','firstName','productName','4188192rXcVcb','USD','telegramBotService','../config/database','ceil','custom','length','findMany','payout','sendShopNotification','sendPaymentNotification','2aapxHL','Test\x20','all','params','__importDefault','6583984bJCAWU','lastName','1402820AopbtE','Broadcast\x20message\x20sent\x20successfully','amount','plisio','body','TelegramController','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','12uTNhRk','json','telegramUser','filter','defineProperty','gateway','count','User\x20disconnected\x20successfully','update','desc','findUnique','default','paid','6354174MwEDAg','currency','Telegram\x20user\x20not\x20found','This\x20is\x20a\x20test\x20notification','shop','test_payout_123','__esModule','createdAt','payment','map','Shop\x20ID\x20is\x20required'];a12_0x285a=function(){return _0x2362ca;};return a12_0x285a();}(function(_0x58b8ad,_0x402e3e){const _0x325f29=a12_0x2778,_0x912aea=_0x58b8ad();while(!![]){try{const _0x12f47a=-parseInt(_0x325f29(0x118))/0x1+parseInt(_0x325f29(0x15c))/0x2*(parseInt(_0x325f29(0x151))/0x3)+parseInt(_0x325f29(0x11f))/0x4*(-parseInt(_0x325f29(0x13f))/0x5)+-parseInt(_0x325f29(0x12c))/0x6+-parseInt(_0x325f29(0x14d))/0x7+parseInt(_0x325f29(0x116))/0x8+parseInt(_0x325f29(0x146))/0x9;if(_0x12f47a===_0x402e3e)break;else _0x912aea['push'](_0x912aea['shift']());}catch(_0xa81258){_0x912aea['push'](_0x912aea['shift']());}}}(a12_0x285a,0xd7f0f));function a12_0x2778(_0x3aa768,_0x159868){const _0x285acb=a12_0x285a();return a12_0x2778=function(_0x277885,_0x210d1c){_0x277885=_0x277885-0x112;let _0x5e93f1=_0x285acb[_0x277885];return _0x5e93f1;},a12_0x2778(_0x3aa768,_0x159868);}var __importDefault=this&&this[a12_0x4eb3d7(0x115)]||function(_0x343732){const _0x27569d=a12_0x4eb3d7;return _0x343732&&_0x343732[_0x27569d(0x132)]?_0x343732:{'default':_0x343732};};Object[a12_0x4eb3d7(0x123)](exports,a12_0x4eb3d7(0x132),{'value':!![]}),exports[a12_0x4eb3d7(0x11d)]=void 0x0;const telegramBotService_1=require(a12_0x4eb3d7(0x13d)),database_1=__importDefault(require(a12_0x4eb3d7(0x154)));class TelegramController{constructor(){const _0x59ff5c=a12_0x4eb3d7;this[_0x59ff5c(0x143)]=async(_0xfb2706,_0x3f8016,_0x322b5e)=>{const _0x1c75e4=_0x59ff5c;try{const _0x42390a=telegramBotService_1[_0x1c75e4(0x153)]['getBotInfo'](),_0x54cd3f=await database_1[_0x1c75e4(0x12a)]['telegramUser'][_0x1c75e4(0x125)](),_0x237fa5=await database_1['default'][_0x1c75e4(0x121)][_0x1c75e4(0x125)]({'where':{'isVerified':!![]}}),_0x18f15e=await database_1['default']['telegramUser']['groupBy']({'by':[_0x1c75e4(0x145)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3f8016[_0x1c75e4(0x120)]({'success':!![],'result':{'bot':{'isActive':_0x42390a[_0x1c75e4(0x148)],'username':_0x42390a[_0x1c75e4(0x137)]},'statistics':{'totalUsers':_0x54cd3f,'verifiedUsers':_0x237fa5,'unverifiedUsers':_0x54cd3f-_0x237fa5,'connectedShops':_0x18f15e[_0x1c75e4(0x157)]}}});}catch(_0x592d0b){_0x322b5e(_0x592d0b);}},this[_0x59ff5c(0x141)]=async(_0x21ee42,_0x38302d,_0x4d288e)=>{const _0x3ea084=_0x59ff5c;try{const {page:page=0x1,limit:limit=0x14,verified:_0x766d58}=_0x21ee42[_0x3ea084(0x149)],_0x3250af=(Number(page)-0x1)*Number(limit),_0x4b3e95={};_0x766d58!==undefined&&(_0x4b3e95['isVerified']=_0x766d58==='true');const [_0x3bc1f3,_0xfcc8f0]=await Promise[_0x3ea084(0x113)]([database_1[_0x3ea084(0x12a)]['telegramUser'][_0x3ea084(0x158)]({'where':_0x4b3e95,'skip':_0x3250af,'take':Number(limit),'orderBy':{'createdAt':_0x3ea084(0x128)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x3ea084(0x12a)][_0x3ea084(0x121)]['count']({'where':_0x4b3e95})]);_0x38302d[_0x3ea084(0x120)]({'success':!![],'users':_0x3bc1f3[_0x3ea084(0x135)](_0x4042c7=>({'id':_0x4042c7['id'],'telegramId':_0x4042c7['telegramId'],'username':_0x4042c7['username'],'firstName':_0x4042c7[_0x3ea084(0x14f)],'lastName':_0x4042c7[_0x3ea084(0x117)],'isVerified':_0x4042c7[_0x3ea084(0x13c)],'shop':_0x4042c7[_0x3ea084(0x130)],'createdAt':_0x4042c7[_0x3ea084(0x133)],'updatedAt':_0x4042c7[_0x3ea084(0x139)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xfcc8f0,'totalPages':Math[_0x3ea084(0x155)](_0xfcc8f0/Number(limit))}});}catch(_0x34f23d){_0x4d288e(_0x34f23d);}},this['sendBroadcast']=async(_0x166608,_0x24e5a6,_0x3f71eb)=>{const _0x360f75=_0x59ff5c;try{const {message:_0x52da98,shopId:_0x5d9bb7}=_0x166608[_0x360f75(0x11c)];if(!_0x52da98)return _0x24e5a6[_0x360f75(0x14b)](0x190)[_0x360f75(0x120)]({'success':![],'message':_0x360f75(0x142)});if(_0x5d9bb7)await telegramBotService_1[_0x360f75(0x153)][_0x360f75(0x15a)](_0x5d9bb7,_0x52da98,{'parse_mode':'Markdown'});else{const _0x4134b3=await database_1[_0x360f75(0x12a)]['telegramUser'][_0x360f75(0x158)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x43cd66=[...new Set(_0x4134b3[_0x360f75(0x135)](_0x285f11=>_0x285f11[_0x360f75(0x145)])[_0x360f75(0x122)](Boolean))];for(const _0x2020a8 of _0x43cd66){_0x2020a8&&await telegramBotService_1[_0x360f75(0x153)][_0x360f75(0x15a)](_0x2020a8,_0x52da98,{'parse_mode':'Markdown'});}}_0x24e5a6[_0x360f75(0x120)]({'success':!![],'message':_0x360f75(0x119)});}catch(_0x495db5){_0x3f71eb(_0x495db5);}},this['disconnectUser']=async(_0x5bb291,_0x16ae7d,_0x55d34f)=>{const _0x4c0d44=_0x59ff5c;try{const {telegramId:_0x44d2ea}=_0x5bb291[_0x4c0d44(0x114)],_0x5151e0=await database_1['default'][_0x4c0d44(0x121)][_0x4c0d44(0x129)]({'where':{'telegramId':_0x44d2ea},'include':{'shop':!![]}});if(!_0x5151e0)return _0x16ae7d[_0x4c0d44(0x14b)](0x194)['json']({'success':![],'message':_0x4c0d44(0x12e)});await database_1[_0x4c0d44(0x12a)][_0x4c0d44(0x121)][_0x4c0d44(0x127)]({'where':{'telegramId':_0x44d2ea},'data':{'shopId':null,'isVerified':![]}}),_0x16ae7d['json']({'success':!![],'message':_0x4c0d44(0x126)});}catch(_0x574e15){_0x55d34f(_0x574e15);}},this[_0x59ff5c(0x13b)]=async(_0x4239ad,_0x10eb94,_0x3b9fcb)=>{const _0x29a9ba=_0x59ff5c;try{const {shopId:_0x419937,type:type=_0x29a9ba(0x134),testData:_0x16417c}=_0x4239ad[_0x29a9ba(0x11c)];if(!_0x419937)return _0x10eb94['status'](0x190)[_0x29a9ba(0x120)]({'success':![],'message':_0x29a9ba(0x136)});const _0x5dd7bc=await database_1[_0x29a9ba(0x12a)][_0x29a9ba(0x130)][_0x29a9ba(0x129)]({'where':{'id':_0x419937},'select':{'id':!![],'name':!![]}});if(!_0x5dd7bc)return _0x10eb94['status'](0x194)[_0x29a9ba(0x120)]({'success':![],'message':_0x29a9ba(0x144)});switch(type){case _0x29a9ba(0x134):const _0x4633d3={'id':'test_payment_123','amount':_0x16417c?.[_0x29a9ba(0x11a)]||0x64,'currency':_0x16417c?.[_0x29a9ba(0x12d)]||_0x29a9ba(0x152),'productName':_0x16417c?.[_0x29a9ba(0x150)]||_0x29a9ba(0x13a),'gateway':_0x16417c?.[_0x29a9ba(0x124)]||_0x29a9ba(0x11b),'createdAt':new Date(),..._0x16417c};await telegramBotService_1[_0x29a9ba(0x153)][_0x29a9ba(0x15b)](_0x419937,_0x4633d3,_0x29a9ba(0x12b));break;case _0x29a9ba(0x159):const _0xa7aac7={'id':_0x29a9ba(0x131),'amount':_0x16417c?.[_0x29a9ba(0x11a)]||0x1f4,'method':_0x16417c?.[_0x29a9ba(0x14e)]||'bank_transfer','createdAt':new Date(),..._0x16417c};await telegramBotService_1[_0x29a9ba(0x153)][_0x29a9ba(0x14a)](_0x419937,_0xa7aac7,_0x29a9ba(0x138));break;case _0x29a9ba(0x156):await telegramBotService_1[_0x29a9ba(0x153)]['sendCustomNotification'](_0x419937,_0x16417c?.[_0x29a9ba(0x140)]||_0x29a9ba(0x147),_0x16417c?.[_0x29a9ba(0x13e)]||{'message':_0x29a9ba(0x12f)});break;default:return _0x10eb94['status'](0x190)['json']({'success':![],'message':_0x29a9ba(0x11e)});}_0x10eb94[_0x29a9ba(0x120)]({'success':!![],'message':_0x29a9ba(0x112)+type+_0x29a9ba(0x14c)});}catch(_0xbcf741){_0x3b9fcb(_0xbcf741);}};}}exports[a12_0x4eb3d7(0x11d)]=TelegramController;