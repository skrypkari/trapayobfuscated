'use strict';const a12_0x4d7f6e=a12_0x471b;function a12_0x1a77(){const _0x1e98a9=['\x20notification\x20sent\x20successfully','sendBroadcast','__esModule','186DYQUKK','findMany','map','Markdown','sendPayoutNotification','Shop\x20not\x20found','getTelegramUsers','true','desc','gateway','defineProperty','completed','34426GboBIH','amount','shopId','Test\x20Product','../config/database','updatedAt','Telegram\x20user\x20not\x20found','4AWlBBE','TelegramController','details','Shop\x20ID\x20is\x20required','test_payment_123','paid','1511450DCoemR','firstName','disconnectUser','currency','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','findUnique','Test\x20Notification','Broadcast\x20message\x20sent\x20successfully','body','9352fXDoBF','1731213OorIuf','username','sendTestNotification','3195mMxmqq','shop','params','2581415oDpuUM','telegramBotService','telegramId','ceil','createdAt','length','This\x20is\x20a\x20test\x20notification','count','title','sendCustomNotification','getBotInfo','sendShopNotification','plisio','payment','isVerified','isActive','telegramUser','status','sendPaymentNotification','428622fqHBQB','bank_transfer','default','all','Message\x20is\x20required','test_payout_123','1FfkwAe','115368GnRbXL','update','__importDefault','custom','json','payout'];a12_0x1a77=function(){return _0x1e98a9;};return a12_0x1a77();}(function(_0x494b7b,_0x713bdd){const _0x4c1158=a12_0x471b,_0x109cb8=_0x494b7b();while(!![]){try{const _0x2a9684=parseInt(_0x4c1158(0x95))/0x1*(parseInt(_0x4c1158(0x8f))/0x2)+-parseInt(_0x4c1158(0x96))/0x3+-parseInt(_0x4c1158(0xb2))/0x4*(-parseInt(_0x4c1158(0x7c))/0x5)+-parseInt(_0x4c1158(0x9f))/0x6*(-parseInt(_0x4c1158(0xab))/0x7)+parseInt(_0x4c1158(0x75))/0x8*(-parseInt(_0x4c1158(0x79))/0x9)+-parseInt(_0x4c1158(0x6c))/0xa+parseInt(_0x4c1158(0x76))/0xb;if(_0x2a9684===_0x713bdd)break;else _0x109cb8['push'](_0x109cb8['shift']());}catch(_0x27bdf5){_0x109cb8['push'](_0x109cb8['shift']());}}}(a12_0x1a77,0x6a67f));var __importDefault=this&&this[a12_0x4d7f6e(0x98)]||function(_0x29b59e){const _0x39aeb0=a12_0x4d7f6e;return _0x29b59e&&_0x29b59e[_0x39aeb0(0x9e)]?_0x29b59e:{'default':_0x29b59e};};Object[a12_0x4d7f6e(0xa9)](exports,a12_0x4d7f6e(0x9e),{'value':!![]}),exports[a12_0x4d7f6e(0xb3)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x4d7f6e(0xaf)));class TelegramController{constructor(){const _0x31314c=a12_0x4d7f6e;this['getBotStatus']=async(_0x1f572c,_0x55ee18,_0x475118)=>{const _0x271851=a12_0x471b;try{const _0x31295f=telegramBotService_1[_0x271851(0x7d)][_0x271851(0x86)](),_0x4f1b50=await database_1[_0x271851(0x91)]['telegramUser'][_0x271851(0x83)](),_0x4c6149=await database_1['default'][_0x271851(0x8c)][_0x271851(0x83)]({'where':{'isVerified':!![]}}),_0xbee055=await database_1[_0x271851(0x91)][_0x271851(0x8c)]['groupBy']({'by':[_0x271851(0xad)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x55ee18[_0x271851(0x9a)]({'success':!![],'result':{'bot':{'isActive':_0x31295f[_0x271851(0x8b)],'username':_0x31295f[_0x271851(0x77)]},'statistics':{'totalUsers':_0x4f1b50,'verifiedUsers':_0x4c6149,'unverifiedUsers':_0x4f1b50-_0x4c6149,'connectedShops':_0xbee055[_0x271851(0x81)]}}});}catch(_0x35b2ff){_0x475118(_0x35b2ff);}},this[_0x31314c(0xa5)]=async(_0x1fdad5,_0x2e0626,_0x431c6b)=>{const _0x4e5856=_0x31314c;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1cd2f3}=_0x1fdad5['query'],_0x2fa373=(Number(page)-0x1)*Number(limit),_0x41660b={};_0x1cd2f3!==undefined&&(_0x41660b[_0x4e5856(0x8a)]=_0x1cd2f3===_0x4e5856(0xa6));const [_0x458f8f,_0x580254]=await Promise[_0x4e5856(0x92)]([database_1[_0x4e5856(0x91)][_0x4e5856(0x8c)]['findMany']({'where':_0x41660b,'skip':_0x2fa373,'take':Number(limit),'orderBy':{'createdAt':_0x4e5856(0xa7)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4e5856(0x91)][_0x4e5856(0x8c)][_0x4e5856(0x83)]({'where':_0x41660b})]);_0x2e0626['json']({'success':!![],'users':_0x458f8f[_0x4e5856(0xa1)](_0x463d0f=>({'id':_0x463d0f['id'],'telegramId':_0x463d0f[_0x4e5856(0x7e)],'username':_0x463d0f[_0x4e5856(0x77)],'firstName':_0x463d0f[_0x4e5856(0x6d)],'lastName':_0x463d0f['lastName'],'isVerified':_0x463d0f[_0x4e5856(0x8a)],'shop':_0x463d0f[_0x4e5856(0x7a)],'createdAt':_0x463d0f[_0x4e5856(0x80)],'updatedAt':_0x463d0f[_0x4e5856(0xb0)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x580254,'totalPages':Math[_0x4e5856(0x7f)](_0x580254/Number(limit))}});}catch(_0x108431){_0x431c6b(_0x108431);}},this[_0x31314c(0x9d)]=async(_0x4dbfba,_0x44f67c,_0x1418f2)=>{const _0x15c541=_0x31314c;try{const {message:_0x2b8054,shopId:_0x54bacd}=_0x4dbfba[_0x15c541(0x74)];if(!_0x2b8054)return _0x44f67c['status'](0x190)[_0x15c541(0x9a)]({'success':![],'message':_0x15c541(0x93)});if(_0x54bacd)await telegramBotService_1[_0x15c541(0x7d)][_0x15c541(0x87)](_0x54bacd,_0x2b8054,{'parse_mode':_0x15c541(0xa2)});else{const _0x426a9c=await database_1[_0x15c541(0x91)][_0x15c541(0x8c)][_0x15c541(0xa0)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3beacb=[...new Set(_0x426a9c[_0x15c541(0xa1)](_0x4490ee=>_0x4490ee[_0x15c541(0xad)])['filter'](Boolean))];for(const _0x51af7b of _0x3beacb){_0x51af7b&&await telegramBotService_1[_0x15c541(0x7d)][_0x15c541(0x87)](_0x51af7b,_0x2b8054,{'parse_mode':_0x15c541(0xa2)});}}_0x44f67c['json']({'success':!![],'message':_0x15c541(0x73)});}catch(_0x108281){_0x1418f2(_0x108281);}},this[_0x31314c(0x6e)]=async(_0x4552d0,_0x4cf16c,_0x3dd8f0)=>{const _0x33548e=_0x31314c;try{const {telegramId:_0xe57172}=_0x4552d0[_0x33548e(0x7b)],_0x2e55ce=await database_1[_0x33548e(0x91)][_0x33548e(0x8c)][_0x33548e(0x71)]({'where':{'telegramId':_0xe57172},'include':{'shop':!![]}});if(!_0x2e55ce)return _0x4cf16c[_0x33548e(0x8d)](0x194)[_0x33548e(0x9a)]({'success':![],'message':_0x33548e(0xb1)});await database_1[_0x33548e(0x91)]['telegramUser'][_0x33548e(0x97)]({'where':{'telegramId':_0xe57172},'data':{'shopId':null,'isVerified':![]}}),_0x4cf16c[_0x33548e(0x9a)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x333914){_0x3dd8f0(_0x333914);}},this[_0x31314c(0x78)]=async(_0x30e710,_0x8ac190,_0x4e8242)=>{const _0x54cfdc=_0x31314c;try{const {shopId:_0x2bad60,type:type=_0x54cfdc(0x89),testData:_0x20eef2}=_0x30e710['body'];if(!_0x2bad60)return _0x8ac190[_0x54cfdc(0x8d)](0x190)['json']({'success':![],'message':_0x54cfdc(0x69)});const _0x51af9a=await database_1[_0x54cfdc(0x91)][_0x54cfdc(0x7a)][_0x54cfdc(0x71)]({'where':{'id':_0x2bad60},'select':{'id':!![],'name':!![]}});if(!_0x51af9a)return _0x8ac190['status'](0x194)[_0x54cfdc(0x9a)]({'success':![],'message':_0x54cfdc(0xa4)});switch(type){case _0x54cfdc(0x89):const _0xe0b545={'id':_0x54cfdc(0x6a),'amount':_0x20eef2?.['amount']||0x64,'currency':_0x20eef2?.[_0x54cfdc(0x6f)]||'USD','productName':_0x20eef2?.['productName']||_0x54cfdc(0xae),'gateway':_0x20eef2?.[_0x54cfdc(0xa8)]||_0x54cfdc(0x88),'createdAt':new Date(),..._0x20eef2};await telegramBotService_1[_0x54cfdc(0x7d)][_0x54cfdc(0x8e)](_0x2bad60,_0xe0b545,_0x54cfdc(0x6b));break;case _0x54cfdc(0x9b):const _0x3b559f={'id':_0x54cfdc(0x94),'amount':_0x20eef2?.[_0x54cfdc(0xac)]||0x1f4,'method':_0x20eef2?.['method']||_0x54cfdc(0x90),'createdAt':new Date(),..._0x20eef2};await telegramBotService_1[_0x54cfdc(0x7d)][_0x54cfdc(0xa3)](_0x2bad60,_0x3b559f,_0x54cfdc(0xaa));break;case _0x54cfdc(0x99):await telegramBotService_1[_0x54cfdc(0x7d)][_0x54cfdc(0x85)](_0x2bad60,_0x20eef2?.[_0x54cfdc(0x84)]||_0x54cfdc(0x72),_0x20eef2?.[_0x54cfdc(0xb4)]||{'message':_0x54cfdc(0x82)});break;default:return _0x8ac190[_0x54cfdc(0x8d)](0x190)[_0x54cfdc(0x9a)]({'success':![],'message':_0x54cfdc(0x70)});}_0x8ac190[_0x54cfdc(0x9a)]({'success':!![],'message':'Test\x20'+type+_0x54cfdc(0x9c)});}catch(_0x2a48ff){_0x4e8242(_0x2a48ff);}};}}function a12_0x471b(_0x164020,_0x5826c6){const _0x1a7712=a12_0x1a77();return a12_0x471b=function(_0x471ba8,_0x1f3d52){_0x471ba8=_0x471ba8-0x69;let _0x4f7de8=_0x1a7712[_0x471ba8];return _0x4f7de8;},a12_0x471b(_0x164020,_0x5826c6);}exports[a12_0x4d7f6e(0xb3)]=TelegramController;