'use strict';const a14_0x35a22a=a14_0x3c4e;(function(_0x4a4b85,_0x34dab5){const _0x45275e=a14_0x3c4e,_0x2cf2fa=_0x4a4b85();while(!![]){try{const _0x2db65e=parseInt(_0x45275e(0xf9))/0x1*(-parseInt(_0x45275e(0xcc))/0x2)+parseInt(_0x45275e(0xc8))/0x3+-parseInt(_0x45275e(0xd2))/0x4*(parseInt(_0x45275e(0xce))/0x5)+-parseInt(_0x45275e(0xfd))/0x6*(parseInt(_0x45275e(0xfa))/0x7)+parseInt(_0x45275e(0xd3))/0x8+parseInt(_0x45275e(0xcd))/0x9*(parseInt(_0x45275e(0xe5))/0xa)+parseInt(_0x45275e(0xdc))/0xb;if(_0x2db65e===_0x34dab5)break;else _0x2cf2fa['push'](_0x2cf2fa['shift']());}catch(_0x2bcc7b){_0x2cf2fa['push'](_0x2cf2fa['shift']());}}}(a14_0x18b4,0xc416c));var __importDefault=this&&this[a14_0x35a22a(0xd5)]||function(_0x3ab98a){const _0x49042d=a14_0x35a22a;return _0x3ab98a&&_0x3ab98a[_0x49042d(0xe3)]?_0x3ab98a:{'default':_0x3ab98a};};function a14_0x18b4(){const _0x42e1c9=['User\x20disconnected\x20successfully','createdAt','sendPayoutNotification','telegramId','Markdown','desc','filter','This\x20is\x20a\x20test\x20notification','length','title','\x20notification\x20sent\x20successfully','bank_transfer','USD','body','username','2FRDyDi','14KaGSRG','amount','telegramBotService','2856714DXPLBw','json','getBotStatus','getTelegramUsers','TelegramController','all','query','details','telegramUser','method','productName','payment','params','Test\x20Product','sendShopNotification','shop','test_payout_123','defineProperty','test_payment_123','payout','Test\x20Notification','completed','1341498lemRBj','updatedAt','findMany','default','1229692WfWYym','3007827xqTDbb','25UyZywS','getBotInfo','Telegram\x20user\x20not\x20found','sendPaymentNotification','168524VboYws','8001568BvjPId','true','__importDefault','count','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Message\x20is\x20required','isActive','gateway','Shop\x20ID\x20is\x20required','15556200IrRMfi','map','Broadcast\x20message\x20sent\x20successfully','sendBroadcast','../config/database','lastName','shopId','__esModule','Test\x20','10EIRyXn','status','findUnique','isVerified','paid'];a14_0x18b4=function(){return _0x42e1c9;};return a14_0x18b4();}Object[a14_0x35a22a(0xc3)](exports,a14_0x35a22a(0xe3),{'value':!![]}),exports[a14_0x35a22a(0x101)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a14_0x35a22a(0xe0)));function a14_0x3c4e(_0x4e8c8c,_0x114eb9){const _0x18b484=a14_0x18b4();return a14_0x3c4e=function(_0x3c4e5e,_0x1c2e45){_0x3c4e5e=_0x3c4e5e-0xb7;let _0x4d6e38=_0x18b484[_0x3c4e5e];return _0x4d6e38;},a14_0x3c4e(_0x4e8c8c,_0x114eb9);}class TelegramController{constructor(){const _0x93462c=a14_0x35a22a;this[_0x93462c(0xff)]=async(_0x2908f8,_0x1dcef1,_0x42b221)=>{const _0x2c2450=_0x93462c;try{const _0x4f1dc0=telegramBotService_1[_0x2c2450(0xfc)][_0x2c2450(0xcf)](),_0x1364e3=await database_1['default'][_0x2c2450(0xba)][_0x2c2450(0xd6)](),_0x4b79f5=await database_1['default']['telegramUser'][_0x2c2450(0xd6)]({'where':{'isVerified':!![]}}),_0x310b44=await database_1[_0x2c2450(0xcb)]['telegramUser']['groupBy']({'by':[_0x2c2450(0xe2)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1dcef1[_0x2c2450(0xfe)]({'success':!![],'result':{'bot':{'isActive':_0x4f1dc0[_0x2c2450(0xd9)],'username':_0x4f1dc0[_0x2c2450(0xf8)]},'statistics':{'totalUsers':_0x1364e3,'verifiedUsers':_0x4b79f5,'unverifiedUsers':_0x1364e3-_0x4b79f5,'connectedShops':_0x310b44[_0x2c2450(0xf2)]}}});}catch(_0x34921c){_0x42b221(_0x34921c);}},this[_0x93462c(0x100)]=async(_0x545c7a,_0x42a9f2,_0x627de)=>{const _0x1a765b=_0x93462c;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5d7fcf}=_0x545c7a[_0x1a765b(0xb8)],_0x49dd75=(Number(page)-0x1)*Number(limit),_0x2250a4={};_0x5d7fcf!==undefined&&(_0x2250a4[_0x1a765b(0xe8)]=_0x5d7fcf===_0x1a765b(0xd4));const [_0x53e66a,_0xe59f5d]=await Promise[_0x1a765b(0xb7)]([database_1['default'][_0x1a765b(0xba)][_0x1a765b(0xca)]({'where':_0x2250a4,'skip':_0x49dd75,'take':Number(limit),'orderBy':{'createdAt':_0x1a765b(0xef)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1a765b(0xcb)]['telegramUser'][_0x1a765b(0xd6)]({'where':_0x2250a4})]);_0x42a9f2['json']({'success':!![],'users':_0x53e66a[_0x1a765b(0xdd)](_0x1de1ca=>({'id':_0x1de1ca['id'],'telegramId':_0x1de1ca[_0x1a765b(0xed)],'username':_0x1de1ca[_0x1a765b(0xf8)],'firstName':_0x1de1ca['firstName'],'lastName':_0x1de1ca[_0x1a765b(0xe1)],'isVerified':_0x1de1ca[_0x1a765b(0xe8)],'shop':_0x1de1ca[_0x1a765b(0xc1)],'createdAt':_0x1de1ca[_0x1a765b(0xeb)],'updatedAt':_0x1de1ca[_0x1a765b(0xc9)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xe59f5d,'totalPages':Math['ceil'](_0xe59f5d/Number(limit))}});}catch(_0x9cb3ee){_0x627de(_0x9cb3ee);}},this[_0x93462c(0xdf)]=async(_0x1b5dd0,_0x366ec8,_0x26a7a)=>{const _0x421a77=_0x93462c;try{const {message:_0x4bafb9,shopId:_0x4c91a8}=_0x1b5dd0['body'];if(!_0x4bafb9)return _0x366ec8[_0x421a77(0xe6)](0x190)[_0x421a77(0xfe)]({'success':![],'message':_0x421a77(0xd8)});if(_0x4c91a8)await telegramBotService_1[_0x421a77(0xfc)][_0x421a77(0xc0)](_0x4c91a8,_0x4bafb9,{'parse_mode':_0x421a77(0xee)});else{const _0x245b91=await database_1[_0x421a77(0xcb)][_0x421a77(0xba)][_0x421a77(0xca)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2c1f66=[...new Set(_0x245b91[_0x421a77(0xdd)](_0x190c63=>_0x190c63[_0x421a77(0xe2)])[_0x421a77(0xf0)](Boolean))];for(const _0x2b2529 of _0x2c1f66){_0x2b2529&&await telegramBotService_1['telegramBotService'][_0x421a77(0xc0)](_0x2b2529,_0x4bafb9,{'parse_mode':_0x421a77(0xee)});}}_0x366ec8[_0x421a77(0xfe)]({'success':!![],'message':_0x421a77(0xde)});}catch(_0x1ff02e){_0x26a7a(_0x1ff02e);}},this['disconnectUser']=async(_0x299a65,_0x1c31a0,_0x5f1874)=>{const _0x53a37a=_0x93462c;try{const {telegramId:_0x203a63}=_0x299a65[_0x53a37a(0xbe)],_0x351f64=await database_1[_0x53a37a(0xcb)][_0x53a37a(0xba)][_0x53a37a(0xe7)]({'where':{'telegramId':_0x203a63},'include':{'shop':!![]}});if(!_0x351f64)return _0x1c31a0[_0x53a37a(0xe6)](0x194)[_0x53a37a(0xfe)]({'success':![],'message':_0x53a37a(0xd0)});await database_1[_0x53a37a(0xcb)][_0x53a37a(0xba)]['update']({'where':{'telegramId':_0x203a63},'data':{'shopId':null,'isVerified':![]}}),_0x1c31a0[_0x53a37a(0xfe)]({'success':!![],'message':_0x53a37a(0xea)});}catch(_0x23f8af){_0x5f1874(_0x23f8af);}},this['sendTestNotification']=async(_0x3896a7,_0x59e793,_0x165450)=>{const _0x21042d=_0x93462c;try{const {shopId:_0x328c08,type:type=_0x21042d(0xbd),testData:_0x4869f5}=_0x3896a7[_0x21042d(0xf7)];if(!_0x328c08)return _0x59e793['status'](0x190)[_0x21042d(0xfe)]({'success':![],'message':_0x21042d(0xdb)});const _0x40cc1c=await database_1['default'][_0x21042d(0xc1)][_0x21042d(0xe7)]({'where':{'id':_0x328c08},'select':{'id':!![],'name':!![]}});if(!_0x40cc1c)return _0x59e793['status'](0x194)[_0x21042d(0xfe)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x21042d(0xbd):const _0x7c23af={'id':_0x21042d(0xc4),'amount':_0x4869f5?.[_0x21042d(0xfb)]||0x64,'currency':_0x4869f5?.['currency']||_0x21042d(0xf6),'productName':_0x4869f5?.[_0x21042d(0xbc)]||_0x21042d(0xbf),'gateway':_0x4869f5?.[_0x21042d(0xda)]||'plisio','createdAt':new Date(),..._0x4869f5};await telegramBotService_1[_0x21042d(0xfc)][_0x21042d(0xd1)](_0x328c08,_0x7c23af,_0x21042d(0xe9));break;case _0x21042d(0xc5):const _0x1d1b6d={'id':_0x21042d(0xc2),'amount':_0x4869f5?.[_0x21042d(0xfb)]||0x1f4,'method':_0x4869f5?.[_0x21042d(0xbb)]||_0x21042d(0xf5),'createdAt':new Date(),..._0x4869f5};await telegramBotService_1['telegramBotService'][_0x21042d(0xec)](_0x328c08,_0x1d1b6d,_0x21042d(0xc7));break;case'custom':await telegramBotService_1[_0x21042d(0xfc)]['sendCustomNotification'](_0x328c08,_0x4869f5?.[_0x21042d(0xf3)]||_0x21042d(0xc6),_0x4869f5?.[_0x21042d(0xb9)]||{'message':_0x21042d(0xf1)});break;default:return _0x59e793[_0x21042d(0xe6)](0x190)[_0x21042d(0xfe)]({'success':![],'message':_0x21042d(0xd7)});}_0x59e793['json']({'success':!![],'message':_0x21042d(0xe4)+type+_0x21042d(0xf4)});}catch(_0x2bfcd2){_0x165450(_0x2bfcd2);}};}}exports[a14_0x35a22a(0x101)]=TelegramController;