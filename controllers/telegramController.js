'use strict';const a12_0x4daa29=a12_0x40d1;(function(_0xbafb7c,_0x38f4d3){const _0x19282f=a12_0x40d1,_0x540523=_0xbafb7c();while(!![]){try{const _0x3298b0=parseInt(_0x19282f(0x11e))/0x1*(-parseInt(_0x19282f(0x10e))/0x2)+-parseInt(_0x19282f(0xfa))/0x3*(-parseInt(_0x19282f(0x135))/0x4)+-parseInt(_0x19282f(0x101))/0x5+parseInt(_0x19282f(0x108))/0x6*(-parseInt(_0x19282f(0x125))/0x7)+parseInt(_0x19282f(0xff))/0x8*(-parseInt(_0x19282f(0x12a))/0x9)+-parseInt(_0x19282f(0x12b))/0xa*(parseInt(_0x19282f(0x10b))/0xb)+parseInt(_0x19282f(0x123))/0xc;if(_0x3298b0===_0x38f4d3)break;else _0x540523['push'](_0x540523['shift']());}catch(_0x437d6a){_0x540523['push'](_0x540523['shift']());}}}(a12_0x4974,0x2c506));var __importDefault=this&&this[a12_0x4daa29(0x106)]||function(_0x412c7d){const _0xadbc74=a12_0x4daa29;return _0x412c7d&&_0x412c7d[_0xadbc74(0x12d)]?_0x412c7d:{'default':_0x412c7d};};Object[a12_0x4daa29(0x10a)](exports,a12_0x4daa29(0x12d),{'value':!![]}),exports[a12_0x4daa29(0x126)]=void 0x0;const telegramBotService_1=require(a12_0x4daa29(0x116)),database_1=__importDefault(require('../config/database'));function a12_0x40d1(_0x2e6705,_0x2a9baa){const _0x49743f=a12_0x4974();return a12_0x40d1=function(_0x40d139,_0x560522){_0x40d139=_0x40d139-0xf4;let _0x2d7cb2=_0x49743f[_0x40d139];return _0x2d7cb2;},a12_0x40d1(_0x2e6705,_0x2a9baa);}function a12_0x4974(){const _0x2ba3fe=['Telegram\x20user\x20not\x20found','map','username','getBotStatus','filter','281364thUoAR','USD','ceil','status','custom','firstName','Shop\x20ID\x20is\x20required','isActive','payment','sendPayoutNotification','createdAt','isVerified','12fdCCpU','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','length','paid','shopId','5208VnZgCl','Test\x20Notification','355460TKgDih','shop','productName','count','Test\x20','__importDefault','lastName','60FnVdPz','json','defineProperty','20977Bvtzny','amount','sendTestNotification','483122vLAntr','desc','default','Test\x20Product','gateway','sendBroadcast','payout','findUnique','../services/telegramBotService','completed','sendCustomNotification','body','telegramBotService','telegramUser','findMany','plisio','1lAjteA','update','telegramId','title','This\x20is\x20a\x20test\x20notification','11910360RjygGc','params','132839okQOBC','TelegramController','\x20notification\x20sent\x20successfully','Markdown','bank_transfer','4887UonLHN','1240rZKvMb','query','__esModule','test_payout_123','all'];a12_0x4974=function(){return _0x2ba3fe;};return a12_0x4974();}class TelegramController{constructor(){const _0x332258=a12_0x4daa29;this[_0x332258(0x133)]=async(_0x22e494,_0xe04347,_0x328b38)=>{const _0x581089=_0x332258;try{const _0x32eca6=telegramBotService_1[_0x581089(0x11a)]['getBotInfo'](),_0x1c7d55=await database_1[_0x581089(0x110)][_0x581089(0x11b)][_0x581089(0x104)](),_0x569d88=await database_1[_0x581089(0x110)][_0x581089(0x11b)][_0x581089(0x104)]({'where':{'isVerified':!![]}}),_0x393612=await database_1[_0x581089(0x110)]['telegramUser']['groupBy']({'by':[_0x581089(0xfe)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xe04347[_0x581089(0x109)]({'success':!![],'result':{'bot':{'isActive':_0x32eca6[_0x581089(0xf5)],'username':_0x32eca6[_0x581089(0x132)]},'statistics':{'totalUsers':_0x1c7d55,'verifiedUsers':_0x569d88,'unverifiedUsers':_0x1c7d55-_0x569d88,'connectedShops':_0x393612[_0x581089(0xfc)]}}});}catch(_0x159bef){_0x328b38(_0x159bef);}},this['getTelegramUsers']=async(_0x241d01,_0x4e57a4,_0x25bf9d)=>{const _0x5d5aed=_0x332258;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1e3642}=_0x241d01[_0x5d5aed(0x12c)],_0x309e64=(Number(page)-0x1)*Number(limit),_0x48fff1={};_0x1e3642!==undefined&&(_0x48fff1[_0x5d5aed(0xf9)]=_0x1e3642==='true');const [_0x184ca5,_0x562f9e]=await Promise[_0x5d5aed(0x12f)]([database_1[_0x5d5aed(0x110)]['telegramUser'][_0x5d5aed(0x11c)]({'where':_0x48fff1,'skip':_0x309e64,'take':Number(limit),'orderBy':{'createdAt':_0x5d5aed(0x10f)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5d5aed(0x110)]['telegramUser'][_0x5d5aed(0x104)]({'where':_0x48fff1})]);_0x4e57a4[_0x5d5aed(0x109)]({'success':!![],'users':_0x184ca5[_0x5d5aed(0x131)](_0x344549=>({'id':_0x344549['id'],'telegramId':_0x344549[_0x5d5aed(0x120)],'username':_0x344549[_0x5d5aed(0x132)],'firstName':_0x344549[_0x5d5aed(0x13a)],'lastName':_0x344549[_0x5d5aed(0x107)],'isVerified':_0x344549[_0x5d5aed(0xf9)],'shop':_0x344549[_0x5d5aed(0x102)],'createdAt':_0x344549[_0x5d5aed(0xf8)],'updatedAt':_0x344549['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x562f9e,'totalPages':Math[_0x5d5aed(0x137)](_0x562f9e/Number(limit))}});}catch(_0x4079a3){_0x25bf9d(_0x4079a3);}},this[_0x332258(0x113)]=async(_0x813d6e,_0x4ce01e,_0x31811a)=>{const _0x558e4a=_0x332258;try{const {message:_0x21a475,shopId:_0x1345f2}=_0x813d6e['body'];if(!_0x21a475)return _0x4ce01e[_0x558e4a(0x138)](0x190)[_0x558e4a(0x109)]({'success':![],'message':'Message\x20is\x20required'});if(_0x1345f2)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x1345f2,_0x21a475,{'parse_mode':_0x558e4a(0x128)});else{const _0x10a437=await database_1[_0x558e4a(0x110)]['telegramUser']['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2c8ee0=[...new Set(_0x10a437[_0x558e4a(0x131)](_0x39847d=>_0x39847d['shopId'])[_0x558e4a(0x134)](Boolean))];for(const _0x1405be of _0x2c8ee0){_0x1405be&&await telegramBotService_1[_0x558e4a(0x11a)]['sendShopNotification'](_0x1405be,_0x21a475,{'parse_mode':_0x558e4a(0x128)});}}_0x4ce01e[_0x558e4a(0x109)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x383382){_0x31811a(_0x383382);}},this['disconnectUser']=async(_0xb1d512,_0x8bcc89,_0x49dfbe)=>{const _0x53877b=_0x332258;try{const {telegramId:_0x1f7055}=_0xb1d512[_0x53877b(0x124)],_0x51f833=await database_1[_0x53877b(0x110)][_0x53877b(0x11b)][_0x53877b(0x115)]({'where':{'telegramId':_0x1f7055},'include':{'shop':!![]}});if(!_0x51f833)return _0x8bcc89[_0x53877b(0x138)](0x194)['json']({'success':![],'message':_0x53877b(0x130)});await database_1[_0x53877b(0x110)]['telegramUser'][_0x53877b(0x11f)]({'where':{'telegramId':_0x1f7055},'data':{'shopId':null,'isVerified':![]}}),_0x8bcc89['json']({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x1a1cf1){_0x49dfbe(_0x1a1cf1);}},this[_0x332258(0x10d)]=async(_0x1b2306,_0x4e6c9a,_0x46e6b5)=>{const _0x18f132=_0x332258;try{const {shopId:_0x3a8362,type:type=_0x18f132(0xf6),testData:_0x1c004f}=_0x1b2306[_0x18f132(0x119)];if(!_0x3a8362)return _0x4e6c9a[_0x18f132(0x138)](0x190)[_0x18f132(0x109)]({'success':![],'message':_0x18f132(0xf4)});const _0x10abf5=await database_1[_0x18f132(0x110)][_0x18f132(0x102)][_0x18f132(0x115)]({'where':{'id':_0x3a8362},'select':{'id':!![],'name':!![]}});if(!_0x10abf5)return _0x4e6c9a[_0x18f132(0x138)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x18f132(0xf6):const _0x3a3ee4={'id':'test_payment_123','amount':_0x1c004f?.[_0x18f132(0x10c)]||0x64,'currency':_0x1c004f?.['currency']||_0x18f132(0x136),'productName':_0x1c004f?.[_0x18f132(0x103)]||_0x18f132(0x111),'gateway':_0x1c004f?.[_0x18f132(0x112)]||_0x18f132(0x11d),'createdAt':new Date(),..._0x1c004f};await telegramBotService_1[_0x18f132(0x11a)]['sendPaymentNotification'](_0x3a8362,_0x3a3ee4,_0x18f132(0xfd));break;case _0x18f132(0x114):const _0x2b83b4={'id':_0x18f132(0x12e),'amount':_0x1c004f?.['amount']||0x1f4,'method':_0x1c004f?.['method']||_0x18f132(0x129),'createdAt':new Date(),..._0x1c004f};await telegramBotService_1['telegramBotService'][_0x18f132(0xf7)](_0x3a8362,_0x2b83b4,_0x18f132(0x117));break;case _0x18f132(0x139):await telegramBotService_1['telegramBotService'][_0x18f132(0x118)](_0x3a8362,_0x1c004f?.[_0x18f132(0x121)]||_0x18f132(0x100),_0x1c004f?.['details']||{'message':_0x18f132(0x122)});break;default:return _0x4e6c9a[_0x18f132(0x138)](0x190)['json']({'success':![],'message':_0x18f132(0xfb)});}_0x4e6c9a['json']({'success':!![],'message':_0x18f132(0x105)+type+_0x18f132(0x127)});}catch(_0xf8f992){_0x46e6b5(_0xf8f992);}};}}exports['TelegramController']=TelegramController;