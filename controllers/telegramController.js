'use strict';const a12_0x1d6ce9=a12_0x16af;(function(_0x4641de,_0x3f3d45){const _0x3ef5e1=a12_0x16af,_0x196c77=_0x4641de();while(!![]){try{const _0x4db7d8=parseInt(_0x3ef5e1(0x174))/0x1*(-parseInt(_0x3ef5e1(0x177))/0x2)+-parseInt(_0x3ef5e1(0x156))/0x3+parseInt(_0x3ef5e1(0x14c))/0x4*(parseInt(_0x3ef5e1(0x162))/0x5)+parseInt(_0x3ef5e1(0x167))/0x6+parseInt(_0x3ef5e1(0x17c))/0x7*(-parseInt(_0x3ef5e1(0x16e))/0x8)+-parseInt(_0x3ef5e1(0x170))/0x9+parseInt(_0x3ef5e1(0x180))/0xa*(parseInt(_0x3ef5e1(0x172))/0xb);if(_0x4db7d8===_0x3f3d45)break;else _0x196c77['push'](_0x196c77['shift']());}catch(_0x27dfe3){_0x196c77['push'](_0x196c77['shift']());}}}(a12_0x15a2,0x760e4));var __importDefault=this&&this[a12_0x1d6ce9(0x16d)]||function(_0x28bd01){const _0x4505d7=a12_0x1d6ce9;return _0x28bd01&&_0x28bd01[_0x4505d7(0x176)]?_0x28bd01:{'default':_0x28bd01};};function a12_0x15a2(){const _0x3d7339=['username','../services/telegramBotService','getTelegramUsers','getBotStatus','createdAt','telegramUser','defineProperty','completed','groupBy','Broadcast\x20message\x20sent\x20successfully','85oqNZqT','currency','telegramBotService','custom','json','5093814RfOqwx','Markdown','TelegramController','shop','findUnique','method','__importDefault','24rEMzjz','payout','1103715iNpzJk','count','3076337ZOiiII','lastName','61534ztpPvi','test_payment_123','__esModule','28VpvpVo','../config/database','length','sendShopNotification','status','104111YIqsNI','shopId','Test\x20Notification','USD','10ZGJLOq','sendTestNotification','body','gateway','This\x20is\x20a\x20test\x20notification','Message\x20is\x20required','payment','Test\x20Product','amount','all','filter','bank_transfer','update','plisio','default','197840ZVxTpN','findMany','telegramId','Shop\x20not\x20found','paid','map','sendCustomNotification','Telegram\x20user\x20not\x20found','sendPayoutNotification','isVerified','1371510MxjatM','details'];a12_0x15a2=function(){return _0x3d7339;};return a12_0x15a2();}Object[a12_0x1d6ce9(0x15e)](exports,'__esModule',{'value':!![]}),exports[a12_0x1d6ce9(0x169)]=void 0x0;const telegramBotService_1=require(a12_0x1d6ce9(0x159)),database_1=__importDefault(require(a12_0x1d6ce9(0x178)));class TelegramController{constructor(){const _0x183fae=a12_0x1d6ce9;this[_0x183fae(0x15b)]=async(_0x3028d2,_0x5252b0,_0x280a67)=>{const _0x25bc96=_0x183fae;try{const _0x18a8b9=telegramBotService_1[_0x25bc96(0x164)]['getBotInfo'](),_0x646297=await database_1[_0x25bc96(0x14b)]['telegramUser'][_0x25bc96(0x171)](),_0x2d0986=await database_1[_0x25bc96(0x14b)][_0x25bc96(0x15d)][_0x25bc96(0x171)]({'where':{'isVerified':!![]}}),_0x4f13ef=await database_1['default'][_0x25bc96(0x15d)][_0x25bc96(0x160)]({'by':[_0x25bc96(0x17d)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5252b0[_0x25bc96(0x166)]({'success':!![],'result':{'bot':{'isActive':_0x18a8b9['isActive'],'username':_0x18a8b9[_0x25bc96(0x158)]},'statistics':{'totalUsers':_0x646297,'verifiedUsers':_0x2d0986,'unverifiedUsers':_0x646297-_0x2d0986,'connectedShops':_0x4f13ef[_0x25bc96(0x179)]}}});}catch(_0x214fac){_0x280a67(_0x214fac);}},this[_0x183fae(0x15a)]=async(_0x19a2b4,_0x125f3e,_0x3d9e54)=>{const _0x2d2407=_0x183fae;try{const {page:page=0x1,limit:limit=0x14,verified:_0x41f50d}=_0x19a2b4['query'],_0x12fa1b=(Number(page)-0x1)*Number(limit),_0x4320fe={};_0x41f50d!==undefined&&(_0x4320fe[_0x2d2407(0x155)]=_0x41f50d==='true');const [_0x229ff5,_0x58398e]=await Promise[_0x2d2407(0x146)]([database_1['default'][_0x2d2407(0x15d)][_0x2d2407(0x14d)]({'where':_0x4320fe,'skip':_0x12fa1b,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2d2407(0x14b)][_0x2d2407(0x15d)][_0x2d2407(0x171)]({'where':_0x4320fe})]);_0x125f3e['json']({'success':!![],'users':_0x229ff5['map'](_0x41a624=>({'id':_0x41a624['id'],'telegramId':_0x41a624[_0x2d2407(0x14e)],'username':_0x41a624[_0x2d2407(0x158)],'firstName':_0x41a624['firstName'],'lastName':_0x41a624[_0x2d2407(0x173)],'isVerified':_0x41a624['isVerified'],'shop':_0x41a624[_0x2d2407(0x16a)],'createdAt':_0x41a624[_0x2d2407(0x15c)],'updatedAt':_0x41a624['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x58398e,'totalPages':Math['ceil'](_0x58398e/Number(limit))}});}catch(_0xff1861){_0x3d9e54(_0xff1861);}},this['sendBroadcast']=async(_0x3ddd70,_0x14b925,_0x2efaf0)=>{const _0x5521ce=_0x183fae;try{const {message:_0xab827b,shopId:_0x56a100}=_0x3ddd70[_0x5521ce(0x182)];if(!_0xab827b)return _0x14b925['status'](0x190)[_0x5521ce(0x166)]({'success':![],'message':_0x5521ce(0x142)});if(_0x56a100)await telegramBotService_1[_0x5521ce(0x164)][_0x5521ce(0x17a)](_0x56a100,_0xab827b,{'parse_mode':_0x5521ce(0x168)});else{const _0x45d4c6=await database_1[_0x5521ce(0x14b)][_0x5521ce(0x15d)][_0x5521ce(0x14d)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xf1afab=[...new Set(_0x45d4c6[_0x5521ce(0x151)](_0x34b1fe=>_0x34b1fe[_0x5521ce(0x17d)])[_0x5521ce(0x147)](Boolean))];for(const _0x3f996b of _0xf1afab){_0x3f996b&&await telegramBotService_1['telegramBotService'][_0x5521ce(0x17a)](_0x3f996b,_0xab827b,{'parse_mode':_0x5521ce(0x168)});}}_0x14b925[_0x5521ce(0x166)]({'success':!![],'message':_0x5521ce(0x161)});}catch(_0x2b68c4){_0x2efaf0(_0x2b68c4);}},this['disconnectUser']=async(_0x4076c3,_0xf0ab0c,_0x2a432a)=>{const _0x53e1bc=_0x183fae;try{const {telegramId:_0x38c44e}=_0x4076c3['params'],_0x5401ee=await database_1[_0x53e1bc(0x14b)][_0x53e1bc(0x15d)][_0x53e1bc(0x16b)]({'where':{'telegramId':_0x38c44e},'include':{'shop':!![]}});if(!_0x5401ee)return _0xf0ab0c['status'](0x194)['json']({'success':![],'message':_0x53e1bc(0x153)});await database_1[_0x53e1bc(0x14b)][_0x53e1bc(0x15d)][_0x53e1bc(0x149)]({'where':{'telegramId':_0x38c44e},'data':{'shopId':null,'isVerified':![]}}),_0xf0ab0c[_0x53e1bc(0x166)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x3e18ca){_0x2a432a(_0x3e18ca);}},this[_0x183fae(0x181)]=async(_0x3f50e2,_0x361702,_0x3db5d6)=>{const _0x59f88e=_0x183fae;try{const {shopId:_0x260259,type:type=_0x59f88e(0x143),testData:_0x969ab8}=_0x3f50e2[_0x59f88e(0x182)];if(!_0x260259)return _0x361702['status'](0x190)[_0x59f88e(0x166)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x3ef8d1=await database_1[_0x59f88e(0x14b)][_0x59f88e(0x16a)][_0x59f88e(0x16b)]({'where':{'id':_0x260259},'select':{'id':!![],'name':!![]}});if(!_0x3ef8d1)return _0x361702[_0x59f88e(0x17b)](0x194)[_0x59f88e(0x166)]({'success':![],'message':_0x59f88e(0x14f)});switch(type){case'payment':const _0x52b136={'id':_0x59f88e(0x175),'amount':_0x969ab8?.['amount']||0x64,'currency':_0x969ab8?.[_0x59f88e(0x163)]||_0x59f88e(0x17f),'productName':_0x969ab8?.['productName']||_0x59f88e(0x144),'gateway':_0x969ab8?.[_0x59f88e(0x183)]||_0x59f88e(0x14a),'createdAt':new Date(),..._0x969ab8};await telegramBotService_1[_0x59f88e(0x164)]['sendPaymentNotification'](_0x260259,_0x52b136,_0x59f88e(0x150));break;case _0x59f88e(0x16f):const _0x829771={'id':'test_payout_123','amount':_0x969ab8?.[_0x59f88e(0x145)]||0x1f4,'method':_0x969ab8?.[_0x59f88e(0x16c)]||_0x59f88e(0x148),'createdAt':new Date(),..._0x969ab8};await telegramBotService_1[_0x59f88e(0x164)][_0x59f88e(0x154)](_0x260259,_0x829771,_0x59f88e(0x15f));break;case _0x59f88e(0x165):await telegramBotService_1[_0x59f88e(0x164)][_0x59f88e(0x152)](_0x260259,_0x969ab8?.['title']||_0x59f88e(0x17e),_0x969ab8?.[_0x59f88e(0x157)]||{'message':_0x59f88e(0x184)});break;default:return _0x361702[_0x59f88e(0x17b)](0x190)[_0x59f88e(0x166)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x361702[_0x59f88e(0x166)]({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x1a16be){_0x3db5d6(_0x1a16be);}};}}function a12_0x16af(_0x1a0646,_0x436dd9){const _0x15a2f3=a12_0x15a2();return a12_0x16af=function(_0x16af79,_0x120f49){_0x16af79=_0x16af79-0x142;let _0x2a2fae=_0x15a2f3[_0x16af79];return _0x2a2fae;},a12_0x16af(_0x1a0646,_0x436dd9);}exports[a12_0x1d6ce9(0x169)]=TelegramController;