'use strict';const a13_0x272b62=a13_0x5a5b;(function(_0x227e07,_0x396463){const _0x20cc98=a13_0x5a5b,_0x1b9c29=_0x227e07();while(!![]){try{const _0x30fa84=parseInt(_0x20cc98(0x122))/0x1*(parseInt(_0x20cc98(0x14f))/0x2)+-parseInt(_0x20cc98(0x120))/0x3+-parseInt(_0x20cc98(0x12e))/0x4*(-parseInt(_0x20cc98(0x168))/0x5)+-parseInt(_0x20cc98(0x149))/0x6+-parseInt(_0x20cc98(0x128))/0x7+parseInt(_0x20cc98(0x144))/0x8+-parseInt(_0x20cc98(0x126))/0x9*(-parseInt(_0x20cc98(0x127))/0xa);if(_0x30fa84===_0x396463)break;else _0x1b9c29['push'](_0x1b9c29['shift']());}catch(_0x59360a){_0x1b9c29['push'](_0x1b9c29['shift']());}}}(a13_0x5f09,0xd638a));function a13_0x5f09(){const _0x5add8c=['Markdown','4245804hSYHUF','test_payment_123','267899wUptuL','query','amount','completed','12180537qAeZpK','20KkqXCO','1054858RIWamA','Message\x20is\x20required','telegramBotService','__esModule','plisio','payout','156DgNDjg','Test\x20Product','currency','This\x20is\x20a\x20test\x20notification','Shop\x20not\x20found','findUnique','params','TelegramController','method','getBotStatus','map','sendShopNotification','custom','payment','details','productName','User\x20disconnected\x20successfully','ceil','\x20notification\x20sent\x20successfully','count','Shop\x20ID\x20is\x20required','isVerified','996528BBIboZ','shopId','body','paid','telegramUser','8948766PFjldP','username','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','title','groupBy','../config/database','4WBaYpW','defineProperty','bank_transfer','Test\x20','update','gateway','sendPaymentNotification','lastName','telegramId','sendCustomNotification','findMany','json','sendPayoutNotification','length','createdAt','test_payout_123','sendBroadcast','true','getTelegramUsers','shop','firstName','filter','status','updatedAt','default','72785arioRk'];a13_0x5f09=function(){return _0x5add8c;};return a13_0x5f09();}var __importDefault=this&&this['__importDefault']||function(_0x12d1d8){return _0x12d1d8&&_0x12d1d8['__esModule']?_0x12d1d8:{'default':_0x12d1d8};};Object[a13_0x272b62(0x150)](exports,a13_0x272b62(0x12b),{'value':!![]}),exports[a13_0x272b62(0x135)]=void 0x0;function a13_0x5a5b(_0x3ee01b,_0x3d47e4){const _0x5f092c=a13_0x5f09();return a13_0x5a5b=function(_0x5a5b1a,_0x5e40d4){_0x5a5b1a=_0x5a5b1a-0x11f;let _0x4ef0c2=_0x5f092c[_0x5a5b1a];return _0x4ef0c2;},a13_0x5a5b(_0x3ee01b,_0x3d47e4);}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a13_0x272b62(0x14e)));class TelegramController{constructor(){const _0x1fc670=a13_0x272b62;this[_0x1fc670(0x137)]=async(_0x51b34b,_0xc3b9a1,_0x4524b3)=>{const _0x5ab9e8=_0x1fc670;try{const _0x30596b=telegramBotService_1[_0x5ab9e8(0x12a)]['getBotInfo'](),_0x201b97=await database_1[_0x5ab9e8(0x167)][_0x5ab9e8(0x148)][_0x5ab9e8(0x141)](),_0x5c4e5a=await database_1[_0x5ab9e8(0x167)][_0x5ab9e8(0x148)][_0x5ab9e8(0x141)]({'where':{'isVerified':!![]}}),_0x35acc1=await database_1[_0x5ab9e8(0x167)]['telegramUser'][_0x5ab9e8(0x14d)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xc3b9a1[_0x5ab9e8(0x15a)]({'success':!![],'result':{'bot':{'isActive':_0x30596b['isActive'],'username':_0x30596b[_0x5ab9e8(0x14a)]},'statistics':{'totalUsers':_0x201b97,'verifiedUsers':_0x5c4e5a,'unverifiedUsers':_0x201b97-_0x5c4e5a,'connectedShops':_0x35acc1[_0x5ab9e8(0x15c)]}}});}catch(_0x34543c){_0x4524b3(_0x34543c);}},this[_0x1fc670(0x161)]=async(_0x17a217,_0x3b1b7a,_0x1aa6de)=>{const _0x5c9e31=_0x1fc670;try{const {page:page=0x1,limit:limit=0x14,verified:_0x293086}=_0x17a217[_0x5c9e31(0x123)],_0x46dc28=(Number(page)-0x1)*Number(limit),_0x5ee662={};_0x293086!==undefined&&(_0x5ee662[_0x5c9e31(0x143)]=_0x293086===_0x5c9e31(0x160));const [_0x42e1f8,_0x274a57]=await Promise['all']([database_1['default']['telegramUser'][_0x5c9e31(0x159)]({'where':_0x5ee662,'skip':_0x46dc28,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5c9e31(0x167)][_0x5c9e31(0x148)][_0x5c9e31(0x141)]({'where':_0x5ee662})]);_0x3b1b7a[_0x5c9e31(0x15a)]({'success':!![],'users':_0x42e1f8[_0x5c9e31(0x138)](_0x378641=>({'id':_0x378641['id'],'telegramId':_0x378641[_0x5c9e31(0x157)],'username':_0x378641[_0x5c9e31(0x14a)],'firstName':_0x378641[_0x5c9e31(0x163)],'lastName':_0x378641[_0x5c9e31(0x156)],'isVerified':_0x378641['isVerified'],'shop':_0x378641[_0x5c9e31(0x162)],'createdAt':_0x378641[_0x5c9e31(0x15d)],'updatedAt':_0x378641[_0x5c9e31(0x166)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x274a57,'totalPages':Math[_0x5c9e31(0x13f)](_0x274a57/Number(limit))}});}catch(_0x419340){_0x1aa6de(_0x419340);}},this[_0x1fc670(0x15f)]=async(_0x3c49c1,_0x25586b,_0x4c2111)=>{const _0x542f02=_0x1fc670;try{const {message:_0x277927,shopId:_0x9e48a0}=_0x3c49c1[_0x542f02(0x146)];if(!_0x277927)return _0x25586b[_0x542f02(0x165)](0x190)[_0x542f02(0x15a)]({'success':![],'message':_0x542f02(0x129)});if(_0x9e48a0)await telegramBotService_1['telegramBotService'][_0x542f02(0x139)](_0x9e48a0,_0x277927,{'parse_mode':'Markdown'});else{const _0x5cacca=await database_1['default'][_0x542f02(0x148)][_0x542f02(0x159)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x253db3=[...new Set(_0x5cacca[_0x542f02(0x138)](_0x2a1efc=>_0x2a1efc[_0x542f02(0x145)])[_0x542f02(0x164)](Boolean))];for(const _0x3f46ba of _0x253db3){_0x3f46ba&&await telegramBotService_1[_0x542f02(0x12a)][_0x542f02(0x139)](_0x3f46ba,_0x277927,{'parse_mode':_0x542f02(0x11f)});}}_0x25586b['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x591751){_0x4c2111(_0x591751);}},this['disconnectUser']=async(_0x242dcd,_0x3e81ff,_0x107b12)=>{const _0x176a2c=_0x1fc670;try{const {telegramId:_0xa4b0c3}=_0x242dcd[_0x176a2c(0x134)],_0x2a7077=await database_1['default'][_0x176a2c(0x148)][_0x176a2c(0x133)]({'where':{'telegramId':_0xa4b0c3},'include':{'shop':!![]}});if(!_0x2a7077)return _0x3e81ff[_0x176a2c(0x165)](0x194)[_0x176a2c(0x15a)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x176a2c(0x167)][_0x176a2c(0x148)][_0x176a2c(0x153)]({'where':{'telegramId':_0xa4b0c3},'data':{'shopId':null,'isVerified':![]}}),_0x3e81ff[_0x176a2c(0x15a)]({'success':!![],'message':_0x176a2c(0x13e)});}catch(_0x3d2287){_0x107b12(_0x3d2287);}},this['sendTestNotification']=async(_0x9e0fb8,_0x1077cd,_0x3de743)=>{const _0x423946=_0x1fc670;try{const {shopId:_0x280f97,type:type=_0x423946(0x13b),testData:_0x23d1d7}=_0x9e0fb8[_0x423946(0x146)];if(!_0x280f97)return _0x1077cd['status'](0x190)[_0x423946(0x15a)]({'success':![],'message':_0x423946(0x142)});const _0x372f63=await database_1[_0x423946(0x167)]['shop'][_0x423946(0x133)]({'where':{'id':_0x280f97},'select':{'id':!![],'name':!![]}});if(!_0x372f63)return _0x1077cd[_0x423946(0x165)](0x194)['json']({'success':![],'message':_0x423946(0x132)});switch(type){case _0x423946(0x13b):const _0xa9573d={'id':_0x423946(0x121),'amount':_0x23d1d7?.[_0x423946(0x124)]||0x64,'currency':_0x23d1d7?.[_0x423946(0x130)]||'USD','productName':_0x23d1d7?.[_0x423946(0x13d)]||_0x423946(0x12f),'gateway':_0x23d1d7?.[_0x423946(0x154)]||_0x423946(0x12c),'createdAt':new Date(),..._0x23d1d7};await telegramBotService_1['telegramBotService'][_0x423946(0x155)](_0x280f97,_0xa9573d,_0x423946(0x147));break;case _0x423946(0x12d):const _0x20f55a={'id':_0x423946(0x15e),'amount':_0x23d1d7?.['amount']||0x1f4,'method':_0x23d1d7?.[_0x423946(0x136)]||_0x423946(0x151),'createdAt':new Date(),..._0x23d1d7};await telegramBotService_1['telegramBotService'][_0x423946(0x15b)](_0x280f97,_0x20f55a,_0x423946(0x125));break;case _0x423946(0x13a):await telegramBotService_1['telegramBotService'][_0x423946(0x158)](_0x280f97,_0x23d1d7?.[_0x423946(0x14c)]||'Test\x20Notification',_0x23d1d7?.[_0x423946(0x13c)]||{'message':_0x423946(0x131)});break;default:return _0x1077cd[_0x423946(0x165)](0x190)[_0x423946(0x15a)]({'success':![],'message':_0x423946(0x14b)});}_0x1077cd[_0x423946(0x15a)]({'success':!![],'message':_0x423946(0x152)+type+_0x423946(0x140)});}catch(_0x1183f5){_0x3de743(_0x1183f5);}};}}exports[a13_0x272b62(0x135)]=TelegramController;