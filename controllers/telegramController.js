'use strict';const a12_0x2d23a1=a12_0x28cf;(function(_0x394b20,_0x372381){const _0x19a752=a12_0x28cf,_0x4ba06f=_0x394b20();while(!![]){try{const _0x35cf20=parseInt(_0x19a752(0x177))/0x1*(-parseInt(_0x19a752(0x199))/0x2)+parseInt(_0x19a752(0x19a))/0x3*(parseInt(_0x19a752(0x1a4))/0x4)+parseInt(_0x19a752(0x167))/0x5+parseInt(_0x19a752(0x166))/0x6+parseInt(_0x19a752(0x173))/0x7*(-parseInt(_0x19a752(0x161))/0x8)+-parseInt(_0x19a752(0x17a))/0x9*(-parseInt(_0x19a752(0x191))/0xa)+parseInt(_0x19a752(0x188))/0xb*(-parseInt(_0x19a752(0x186))/0xc);if(_0x35cf20===_0x372381)break;else _0x4ba06f['push'](_0x4ba06f['shift']());}catch(_0x2669d3){_0x4ba06f['push'](_0x4ba06f['shift']());}}}(a12_0x3694,0xea5ee));var __importDefault=this&&this[a12_0x2d23a1(0x182)]||function(_0x37ea5a){return _0x37ea5a&&_0x37ea5a['__esModule']?_0x37ea5a:{'default':_0x37ea5a};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a12_0x2d23a1(0x16b)]=void 0x0;function a12_0x3694(){const _0x7bc46d=['telegramId','15010EAxuiV','sendPayoutNotification','sendBroadcast','productName','sendCustomNotification','map','findMany','filter','350tBoSCz','811065GfQrfq','status','getTelegramUsers','Shop\x20ID\x20is\x20required','../services/telegramBotService','username','Markdown','length','true','custom','4oFLuFu','Test\x20Product','body','8bLekEM','paid','ceil','This\x20is\x20a\x20test\x20notification','default','10586190vRJWYE','4576810SqOvZC','Message\x20is\x20required','test_payout_123','method','TelegramController','firstName','getBotInfo','Broadcast\x20message\x20sent\x20successfully','sendShopNotification','getBotStatus','sendPaymentNotification','shopId','6925849sQAFDu','telegramUser','disconnectUser','telegramBotService','662KhRIOy','lastName','USD','1098aBKCuV','payout','isVerified','isActive','test_payment_123','json','Test\x20Notification','updatedAt','__importDefault','bank_transfer','findUnique','groupBy','2004Zpwsur','../config/database','70345QbjlaG','\x20notification\x20sent\x20successfully','amount','count','currency','shop','sendTestNotification','desc'];a12_0x3694=function(){return _0x7bc46d;};return a12_0x3694();}const telegramBotService_1=require(a12_0x2d23a1(0x19e)),database_1=__importDefault(require(a12_0x2d23a1(0x187)));function a12_0x28cf(_0x1c5129,_0xe805de){const _0x3694e0=a12_0x3694();return a12_0x28cf=function(_0x28cfa3,_0x8f2aff){_0x28cfa3=_0x28cfa3-0x160;let _0x18b641=_0x3694e0[_0x28cfa3];return _0x18b641;},a12_0x28cf(_0x1c5129,_0xe805de);}class TelegramController{constructor(){const _0x4e1067=a12_0x2d23a1;this[_0x4e1067(0x170)]=async(_0x24b62f,_0x526a0a,_0x1206d2)=>{const _0x2acfd0=_0x4e1067;try{const _0x3f8092=telegramBotService_1['telegramBotService'][_0x2acfd0(0x16d)](),_0x55475d=await database_1[_0x2acfd0(0x165)][_0x2acfd0(0x174)]['count'](),_0x229691=await database_1[_0x2acfd0(0x165)]['telegramUser'][_0x2acfd0(0x18b)]({'where':{'isVerified':!![]}}),_0x33f67b=await database_1[_0x2acfd0(0x165)][_0x2acfd0(0x174)][_0x2acfd0(0x185)]({'by':[_0x2acfd0(0x172)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x526a0a[_0x2acfd0(0x17f)]({'success':!![],'result':{'bot':{'isActive':_0x3f8092[_0x2acfd0(0x17d)],'username':_0x3f8092[_0x2acfd0(0x19f)]},'statistics':{'totalUsers':_0x55475d,'verifiedUsers':_0x229691,'unverifiedUsers':_0x55475d-_0x229691,'connectedShops':_0x33f67b[_0x2acfd0(0x1a1)]}}});}catch(_0x1b6bc9){_0x1206d2(_0x1b6bc9);}},this[_0x4e1067(0x19c)]=async(_0x2cbd94,_0x115bcf,_0x60a985)=>{const _0x1c4283=_0x4e1067;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1aa4a8}=_0x2cbd94['query'],_0x427504=(Number(page)-0x1)*Number(limit),_0x3c6822={};_0x1aa4a8!==undefined&&(_0x3c6822[_0x1c4283(0x17c)]=_0x1aa4a8===_0x1c4283(0x1a2));const [_0xda9007,_0x5c29aa]=await Promise['all']([database_1[_0x1c4283(0x165)][_0x1c4283(0x174)][_0x1c4283(0x197)]({'where':_0x3c6822,'skip':_0x427504,'take':Number(limit),'orderBy':{'createdAt':_0x1c4283(0x18f)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1c4283(0x165)][_0x1c4283(0x174)][_0x1c4283(0x18b)]({'where':_0x3c6822})]);_0x115bcf[_0x1c4283(0x17f)]({'success':!![],'users':_0xda9007[_0x1c4283(0x196)](_0xe1c982=>({'id':_0xe1c982['id'],'telegramId':_0xe1c982[_0x1c4283(0x190)],'username':_0xe1c982[_0x1c4283(0x19f)],'firstName':_0xe1c982[_0x1c4283(0x16c)],'lastName':_0xe1c982[_0x1c4283(0x178)],'isVerified':_0xe1c982[_0x1c4283(0x17c)],'shop':_0xe1c982[_0x1c4283(0x18d)],'createdAt':_0xe1c982['createdAt'],'updatedAt':_0xe1c982[_0x1c4283(0x181)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5c29aa,'totalPages':Math[_0x1c4283(0x163)](_0x5c29aa/Number(limit))}});}catch(_0x1e2762){_0x60a985(_0x1e2762);}},this[_0x4e1067(0x193)]=async(_0x426731,_0x2e88b7,_0x1fdb44)=>{const _0x3429ef=_0x4e1067;try{const {message:_0x2ea581,shopId:_0xc84e5f}=_0x426731[_0x3429ef(0x160)];if(!_0x2ea581)return _0x2e88b7[_0x3429ef(0x19b)](0x190)['json']({'success':![],'message':_0x3429ef(0x168)});if(_0xc84e5f)await telegramBotService_1[_0x3429ef(0x176)][_0x3429ef(0x16f)](_0xc84e5f,_0x2ea581,{'parse_mode':'Markdown'});else{const _0x1890bf=await database_1[_0x3429ef(0x165)][_0x3429ef(0x174)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x52e7af=[...new Set(_0x1890bf[_0x3429ef(0x196)](_0x55cfc5=>_0x55cfc5['shopId'])[_0x3429ef(0x198)](Boolean))];for(const _0x1f39c8 of _0x52e7af){_0x1f39c8&&await telegramBotService_1[_0x3429ef(0x176)]['sendShopNotification'](_0x1f39c8,_0x2ea581,{'parse_mode':_0x3429ef(0x1a0)});}}_0x2e88b7[_0x3429ef(0x17f)]({'success':!![],'message':_0x3429ef(0x16e)});}catch(_0x3da4d2){_0x1fdb44(_0x3da4d2);}},this[_0x4e1067(0x175)]=async(_0xe3670c,_0x547ec2,_0xd5982e)=>{const _0x236c7a=_0x4e1067;try{const {telegramId:_0x17fa66}=_0xe3670c['params'],_0x5d26c1=await database_1[_0x236c7a(0x165)][_0x236c7a(0x174)][_0x236c7a(0x184)]({'where':{'telegramId':_0x17fa66},'include':{'shop':!![]}});if(!_0x5d26c1)return _0x547ec2[_0x236c7a(0x19b)](0x194)[_0x236c7a(0x17f)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x236c7a(0x165)]['telegramUser']['update']({'where':{'telegramId':_0x17fa66},'data':{'shopId':null,'isVerified':![]}}),_0x547ec2['json']({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x49811d){_0xd5982e(_0x49811d);}},this[_0x4e1067(0x18e)]=async(_0x1bd99a,_0x2ec23d,_0x36768c)=>{const _0x1abaf5=_0x4e1067;try{const {shopId:_0x4a39ad,type:type='payment',testData:_0x27662c}=_0x1bd99a[_0x1abaf5(0x160)];if(!_0x4a39ad)return _0x2ec23d[_0x1abaf5(0x19b)](0x190)[_0x1abaf5(0x17f)]({'success':![],'message':_0x1abaf5(0x19d)});const _0x294201=await database_1[_0x1abaf5(0x165)][_0x1abaf5(0x18d)][_0x1abaf5(0x184)]({'where':{'id':_0x4a39ad},'select':{'id':!![],'name':!![]}});if(!_0x294201)return _0x2ec23d[_0x1abaf5(0x19b)](0x194)[_0x1abaf5(0x17f)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0x39ae62={'id':_0x1abaf5(0x17e),'amount':_0x27662c?.[_0x1abaf5(0x18a)]||0x64,'currency':_0x27662c?.[_0x1abaf5(0x18c)]||_0x1abaf5(0x179),'productName':_0x27662c?.[_0x1abaf5(0x194)]||_0x1abaf5(0x1a5),'gateway':_0x27662c?.['gateway']||'plisio','createdAt':new Date(),..._0x27662c};await telegramBotService_1[_0x1abaf5(0x176)][_0x1abaf5(0x171)](_0x4a39ad,_0x39ae62,_0x1abaf5(0x162));break;case _0x1abaf5(0x17b):const _0x19119c={'id':_0x1abaf5(0x169),'amount':_0x27662c?.[_0x1abaf5(0x18a)]||0x1f4,'method':_0x27662c?.[_0x1abaf5(0x16a)]||_0x1abaf5(0x183),'createdAt':new Date(),..._0x27662c};await telegramBotService_1[_0x1abaf5(0x176)][_0x1abaf5(0x192)](_0x4a39ad,_0x19119c,'completed');break;case _0x1abaf5(0x1a3):await telegramBotService_1[_0x1abaf5(0x176)][_0x1abaf5(0x195)](_0x4a39ad,_0x27662c?.['title']||_0x1abaf5(0x180),_0x27662c?.['details']||{'message':_0x1abaf5(0x164)});break;default:return _0x2ec23d[_0x1abaf5(0x19b)](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x2ec23d[_0x1abaf5(0x17f)]({'success':!![],'message':'Test\x20'+type+_0x1abaf5(0x189)});}catch(_0x250d88){_0x36768c(_0x250d88);}};}}exports[a12_0x2d23a1(0x16b)]=TelegramController;