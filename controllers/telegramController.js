'use strict';const a12_0x2c3451=a12_0x959e;function a12_0x959e(_0x149aef,_0x235380){const _0x1d743f=a12_0x1d74();return a12_0x959e=function(_0x959e39,_0x4b2036){_0x959e39=_0x959e39-0x1a8;let _0x34ecae=_0x1d743f[_0x959e39];return _0x34ecae;},a12_0x959e(_0x149aef,_0x235380);}(function(_0x17ea12,_0xe3b3a3){const _0x406632=a12_0x959e,_0x449046=_0x17ea12();while(!![]){try{const _0x2e4829=parseInt(_0x406632(0x1e3))/0x1*(parseInt(_0x406632(0x1d3))/0x2)+-parseInt(_0x406632(0x1c7))/0x3+parseInt(_0x406632(0x1ee))/0x4*(-parseInt(_0x406632(0x1ea))/0x5)+-parseInt(_0x406632(0x1c9))/0x6*(-parseInt(_0x406632(0x1eb))/0x7)+parseInt(_0x406632(0x1ba))/0x8+parseInt(_0x406632(0x1f2))/0x9*(parseInt(_0x406632(0x1cb))/0xa)+-parseInt(_0x406632(0x1cf))/0xb;if(_0x2e4829===_0xe3b3a3)break;else _0x449046['push'](_0x449046['shift']());}catch(_0xf88135){_0x449046['push'](_0x449046['shift']());}}}(a12_0x1d74,0x3a255));function a12_0x1d74(){const _0x5155eb=['__importDefault','18EqLkzU','currency','20usQktF','getBotInfo','Test\x20Product','length','1358456PIHRQs','findMany','findUnique','telegramBotService','74QTpasS','getTelegramUsers','updatedAt','lastName','count','telegramUser','__esModule','groupBy','ceil','TelegramController','desc','shop','body','update','firstName','Test\x20Notification','10000TxVOiB','isActive','params','Telegram\x20user\x20not\x20found','test_payment_123','payout','status','5IPJPBk','305683PDVAAv','User\x20disconnected\x20successfully','disconnectUser','1049564CafYVF','title','default','paid','445293tLqufU','../services/telegramBotService','plisio','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','filter','createdAt','test_payout_123','Message\x20is\x20required','sendCustomNotification','amount','isVerified','custom','sendPayoutNotification','all','method','Shop\x20not\x20found','json','true','payment','3139048PCRLrw','map','sendShopNotification','sendTestNotification','productName','shopId','Broadcast\x20message\x20sent\x20successfully','completed','username','../config/database','sendPaymentNotification','USD','defineProperty','1104870SWUqlG'];a12_0x1d74=function(){return _0x5155eb;};return a12_0x1d74();}var __importDefault=this&&this[a12_0x2c3451(0x1c8)]||function(_0x564617){const _0x1a9fb0=a12_0x2c3451;return _0x564617&&_0x564617[_0x1a9fb0(0x1d9)]?_0x564617:{'default':_0x564617};};Object[a12_0x2c3451(0x1c6)](exports,a12_0x2c3451(0x1d9),{'value':!![]}),exports[a12_0x2c3451(0x1dc)]=void 0x0;const telegramBotService_1=require(a12_0x2c3451(0x1a8)),database_1=__importDefault(require(a12_0x2c3451(0x1c3)));class TelegramController{constructor(){const _0x2f0659=a12_0x2c3451;this['getBotStatus']=async(_0xcd1443,_0x1273ef,_0x2baee0)=>{const _0x1e2229=a12_0x959e;try{const _0x574898=telegramBotService_1[_0x1e2229(0x1d2)][_0x1e2229(0x1cc)](),_0x566f2d=await database_1['default'][_0x1e2229(0x1d8)][_0x1e2229(0x1d7)](),_0x5163ff=await database_1[_0x1e2229(0x1f0)]['telegramUser'][_0x1e2229(0x1d7)]({'where':{'isVerified':!![]}}),_0x3f1f26=await database_1[_0x1e2229(0x1f0)]['telegramUser'][_0x1e2229(0x1da)]({'by':[_0x1e2229(0x1bf)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1273ef[_0x1e2229(0x1b7)]({'success':!![],'result':{'bot':{'isActive':_0x574898[_0x1e2229(0x1e4)],'username':_0x574898['username']},'statistics':{'totalUsers':_0x566f2d,'verifiedUsers':_0x5163ff,'unverifiedUsers':_0x566f2d-_0x5163ff,'connectedShops':_0x3f1f26[_0x1e2229(0x1ce)]}}});}catch(_0x37839e){_0x2baee0(_0x37839e);}},this[_0x2f0659(0x1d4)]=async(_0x3fe462,_0x1eab5d,_0x59c083)=>{const _0x2588e5=_0x2f0659;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4f87a6}=_0x3fe462['query'],_0x50ca7e=(Number(page)-0x1)*Number(limit),_0x42290f={};_0x4f87a6!==undefined&&(_0x42290f[_0x2588e5(0x1b1)]=_0x4f87a6===_0x2588e5(0x1b8));const [_0x4daa81,_0x5cdc8d]=await Promise[_0x2588e5(0x1b4)]([database_1[_0x2588e5(0x1f0)]['telegramUser'][_0x2588e5(0x1d0)]({'where':_0x42290f,'skip':_0x50ca7e,'take':Number(limit),'orderBy':{'createdAt':_0x2588e5(0x1dd)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2588e5(0x1f0)][_0x2588e5(0x1d8)][_0x2588e5(0x1d7)]({'where':_0x42290f})]);_0x1eab5d[_0x2588e5(0x1b7)]({'success':!![],'users':_0x4daa81[_0x2588e5(0x1bb)](_0x40be1a=>({'id':_0x40be1a['id'],'telegramId':_0x40be1a['telegramId'],'username':_0x40be1a[_0x2588e5(0x1c2)],'firstName':_0x40be1a[_0x2588e5(0x1e1)],'lastName':_0x40be1a[_0x2588e5(0x1d6)],'isVerified':_0x40be1a['isVerified'],'shop':_0x40be1a[_0x2588e5(0x1de)],'createdAt':_0x40be1a[_0x2588e5(0x1ac)],'updatedAt':_0x40be1a[_0x2588e5(0x1d5)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x5cdc8d,'totalPages':Math[_0x2588e5(0x1db)](_0x5cdc8d/Number(limit))}});}catch(_0x1b8e45){_0x59c083(_0x1b8e45);}},this['sendBroadcast']=async(_0x4133a6,_0x488a49,_0x1c87dc)=>{const _0x5210a2=_0x2f0659;try{const {message:_0xbea5f3,shopId:_0x4ea36f}=_0x4133a6[_0x5210a2(0x1df)];if(!_0xbea5f3)return _0x488a49['status'](0x190)[_0x5210a2(0x1b7)]({'success':![],'message':_0x5210a2(0x1ae)});if(_0x4ea36f)await telegramBotService_1[_0x5210a2(0x1d2)][_0x5210a2(0x1bc)](_0x4ea36f,_0xbea5f3,{'parse_mode':'Markdown'});else{const _0xece88a=await database_1[_0x5210a2(0x1f0)][_0x5210a2(0x1d8)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3a15c6=[...new Set(_0xece88a[_0x5210a2(0x1bb)](_0x596ebc=>_0x596ebc[_0x5210a2(0x1bf)])[_0x5210a2(0x1ab)](Boolean))];for(const _0x2047dd of _0x3a15c6){_0x2047dd&&await telegramBotService_1['telegramBotService'][_0x5210a2(0x1bc)](_0x2047dd,_0xbea5f3,{'parse_mode':'Markdown'});}}_0x488a49[_0x5210a2(0x1b7)]({'success':!![],'message':_0x5210a2(0x1c0)});}catch(_0x49e19a){_0x1c87dc(_0x49e19a);}},this[_0x2f0659(0x1ed)]=async(_0x5c9172,_0x51145f,_0x5e4e74)=>{const _0x3554c4=_0x2f0659;try{const {telegramId:_0x324bcd}=_0x5c9172[_0x3554c4(0x1e5)],_0x310866=await database_1[_0x3554c4(0x1f0)][_0x3554c4(0x1d8)][_0x3554c4(0x1d1)]({'where':{'telegramId':_0x324bcd},'include':{'shop':!![]}});if(!_0x310866)return _0x51145f['status'](0x194)['json']({'success':![],'message':_0x3554c4(0x1e6)});await database_1[_0x3554c4(0x1f0)][_0x3554c4(0x1d8)][_0x3554c4(0x1e0)]({'where':{'telegramId':_0x324bcd},'data':{'shopId':null,'isVerified':![]}}),_0x51145f[_0x3554c4(0x1b7)]({'success':!![],'message':_0x3554c4(0x1ec)});}catch(_0x3ba6a0){_0x5e4e74(_0x3ba6a0);}},this[_0x2f0659(0x1bd)]=async(_0x6f4217,_0x52deb1,_0x15dc09)=>{const _0x59948e=_0x2f0659;try{const {shopId:_0xc69370,type:type=_0x59948e(0x1b9),testData:_0x5a6c01}=_0x6f4217[_0x59948e(0x1df)];if(!_0xc69370)return _0x52deb1[_0x59948e(0x1e9)](0x190)[_0x59948e(0x1b7)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x25a988=await database_1['default'][_0x59948e(0x1de)][_0x59948e(0x1d1)]({'where':{'id':_0xc69370},'select':{'id':!![],'name':!![]}});if(!_0x25a988)return _0x52deb1[_0x59948e(0x1e9)](0x194)[_0x59948e(0x1b7)]({'success':![],'message':_0x59948e(0x1b6)});switch(type){case _0x59948e(0x1b9):const _0x3cbbec={'id':_0x59948e(0x1e7),'amount':_0x5a6c01?.[_0x59948e(0x1b0)]||0x64,'currency':_0x5a6c01?.[_0x59948e(0x1ca)]||_0x59948e(0x1c5),'productName':_0x5a6c01?.[_0x59948e(0x1be)]||_0x59948e(0x1cd),'gateway':_0x5a6c01?.['gateway']||_0x59948e(0x1a9),'createdAt':new Date(),..._0x5a6c01};await telegramBotService_1['telegramBotService'][_0x59948e(0x1c4)](_0xc69370,_0x3cbbec,_0x59948e(0x1f1));break;case _0x59948e(0x1e8):const _0xddaac6={'id':_0x59948e(0x1ad),'amount':_0x5a6c01?.[_0x59948e(0x1b0)]||0x1f4,'method':_0x5a6c01?.[_0x59948e(0x1b5)]||'bank_transfer','createdAt':new Date(),..._0x5a6c01};await telegramBotService_1[_0x59948e(0x1d2)][_0x59948e(0x1b3)](_0xc69370,_0xddaac6,_0x59948e(0x1c1));break;case _0x59948e(0x1b2):await telegramBotService_1[_0x59948e(0x1d2)][_0x59948e(0x1af)](_0xc69370,_0x5a6c01?.[_0x59948e(0x1ef)]||_0x59948e(0x1e2),_0x5a6c01?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x52deb1[_0x59948e(0x1e9)](0x190)['json']({'success':![],'message':_0x59948e(0x1aa)});}_0x52deb1['json']({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x55bd75){_0x15dc09(_0x55bd75);}};}}exports[a12_0x2c3451(0x1dc)]=TelegramController;