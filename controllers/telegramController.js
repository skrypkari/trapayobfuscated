'use strict';const a20_0x227cfd=a20_0x1eec;(function(_0x7101a3,_0x26ebb9){const _0x3eb1f7=a20_0x1eec,_0x23bc2f=_0x7101a3();while(!![]){try{const _0x4302d4=parseInt(_0x3eb1f7(0x151))/0x1*(-parseInt(_0x3eb1f7(0x14e))/0x2)+parseInt(_0x3eb1f7(0x12e))/0x3*(-parseInt(_0x3eb1f7(0x12a))/0x4)+-parseInt(_0x3eb1f7(0x129))/0x5+-parseInt(_0x3eb1f7(0x12f))/0x6+-parseInt(_0x3eb1f7(0x163))/0x7+parseInt(_0x3eb1f7(0x15f))/0x8+parseInt(_0x3eb1f7(0x125))/0x9;if(_0x4302d4===_0x26ebb9)break;else _0x23bc2f['push'](_0x23bc2f['shift']());}catch(_0xbbeb3f){_0x23bc2f['push'](_0x23bc2f['shift']());}}}(a20_0x4ae3,0xdedd5));function a20_0x1eec(_0x436871,_0x319c64){_0x436871=_0x436871-0x11f;const _0x4ae388=a20_0x4ae3();let _0x1eeca5=_0x4ae388[_0x436871];return _0x1eeca5;}var __importDefault=this&&this['__importDefault']||function(_0x1291db){const _0x435000=a20_0x1eec;return _0x1291db&&_0x1291db[_0x435000(0x14f)]?_0x1291db:{'default':_0x1291db};};Object[a20_0x227cfd(0x137)](exports,a20_0x227cfd(0x14f),{'value':!![]}),exports[a20_0x227cfd(0x130)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a20_0x227cfd(0x126)));function a20_0x4ae3(){const _0x431912=['63rhOZRd','9493902VKqFcR','TelegramController','wallet','username','USD','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','TRC20','custom','defineProperty','getTelegramUsers','true','status','sendPaymentNotification','getBotStatus','gateway','count','body','test_payment_123','createdAt','params','Тестовый\x20период','disconnectUser','filter','details','Test\x20Product','isVerified','query','sendBroadcast','groupBy','sendPayoutNotification','length','1138zcfCfv','__esModule','lastName','2547OkHQNB','desc','Markdown','all','shopId','findUnique','telegramUser','txid','ceil','map','findMany','sendCustomNotification','payment','default','11993544pltkaV','This\x20is\x20a\x20test\x20notification','json','telegramId','5181022Pbtasa','productName','Test\x20','paid','Broadcast\x20message\x20sent\x20successfully','User\x20disconnected\x20successfully','network','sendShopNotification','title','38154843pTawnD','../config/database','updatedAt','Telegram\x20user\x20not\x20found','3608050bgNQkf','63324gyZIrG','currency','telegramBotService','update'];a20_0x4ae3=function(){return _0x431912;};return a20_0x4ae3();}class TelegramController{constructor(){const _0x17e357=a20_0x227cfd;this[_0x17e357(0x13c)]=async(_0x29a2ab,_0x2f8ad0,_0x3fdb19)=>{const _0x27e97a=_0x17e357;try{const _0x3a9bca=telegramBotService_1[_0x27e97a(0x12c)]['getBotInfo'](),_0x5e6c98=await database_1['default'][_0x27e97a(0x157)][_0x27e97a(0x13e)](),_0x162b59=await database_1[_0x27e97a(0x15e)][_0x27e97a(0x157)]['count']({'where':{'isVerified':!![]}}),_0x370fad=await database_1[_0x27e97a(0x15e)]['telegramUser'][_0x27e97a(0x14b)]({'by':[_0x27e97a(0x155)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2f8ad0['json']({'success':!![],'result':{'bot':{'isActive':_0x3a9bca['isActive'],'username':_0x3a9bca[_0x27e97a(0x132)]},'statistics':{'totalUsers':_0x5e6c98,'verifiedUsers':_0x162b59,'unverifiedUsers':_0x5e6c98-_0x162b59,'connectedShops':_0x370fad[_0x27e97a(0x14d)]}}});}catch(_0x4bd27a){_0x3fdb19(_0x4bd27a);}},this[_0x17e357(0x138)]=async(_0x5c13bb,_0x55e57b,_0x1170e2)=>{const _0x1302dc=_0x17e357;try{const {page:page=0x1,limit:limit=0x14,verified:_0x34575d}=_0x5c13bb[_0x1302dc(0x149)],_0x5efd70=(Number(page)-0x1)*Number(limit),_0x14e7d2={};_0x34575d!==undefined&&(_0x14e7d2[_0x1302dc(0x148)]=_0x34575d===_0x1302dc(0x139));const [_0x10a30e,_0x49c459]=await Promise[_0x1302dc(0x154)]([database_1[_0x1302dc(0x15e)][_0x1302dc(0x157)][_0x1302dc(0x15b)]({'where':_0x14e7d2,'skip':_0x5efd70,'take':Number(limit),'orderBy':{'createdAt':_0x1302dc(0x152)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x1302dc(0x15e)]['telegramUser'][_0x1302dc(0x13e)]({'where':_0x14e7d2})]);_0x55e57b[_0x1302dc(0x161)]({'success':!![],'users':_0x10a30e[_0x1302dc(0x15a)](_0x1b6908=>({'id':_0x1b6908['id'],'telegramId':_0x1b6908[_0x1302dc(0x162)],'username':_0x1b6908['username'],'firstName':_0x1b6908['firstName'],'lastName':_0x1b6908[_0x1302dc(0x150)],'isVerified':_0x1b6908[_0x1302dc(0x148)],'shop':_0x1b6908['shop'],'createdAt':_0x1b6908[_0x1302dc(0x141)],'updatedAt':_0x1b6908[_0x1302dc(0x127)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x49c459,'totalPages':Math[_0x1302dc(0x159)](_0x49c459/Number(limit))}});}catch(_0x106b3c){_0x1170e2(_0x106b3c);}},this[_0x17e357(0x14a)]=async(_0x23d071,_0x491857,_0x5c6640)=>{const _0x2756d7=_0x17e357;try{const {message:_0x2f6c93,shopId:_0x42d115}=_0x23d071[_0x2756d7(0x13f)];if(!_0x2f6c93)return _0x491857[_0x2756d7(0x13a)](0x190)[_0x2756d7(0x161)]({'success':![],'message':'Message\x20is\x20required'});if(_0x42d115)await telegramBotService_1[_0x2756d7(0x12c)]['sendShopNotification'](_0x42d115,_0x2f6c93,{'parse_mode':_0x2756d7(0x153)});else{const _0x2c048c=await database_1['default'][_0x2756d7(0x157)][_0x2756d7(0x15b)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3afa11=[...new Set(_0x2c048c['map'](_0x3120aa=>_0x3120aa[_0x2756d7(0x155)])[_0x2756d7(0x145)](Boolean))];for(const _0x5c7dfc of _0x3afa11){_0x5c7dfc&&await telegramBotService_1[_0x2756d7(0x12c)][_0x2756d7(0x123)](_0x5c7dfc,_0x2f6c93,{'parse_mode':_0x2756d7(0x153)});}}_0x491857['json']({'success':!![],'message':_0x2756d7(0x120)});}catch(_0x423da4){_0x5c6640(_0x423da4);}},this[_0x17e357(0x144)]=async(_0x1db119,_0x770781,_0x3a8c24)=>{const _0x447deb=_0x17e357;try{const {telegramId:_0x227faa}=_0x1db119[_0x447deb(0x142)],_0x33f03d=await database_1[_0x447deb(0x15e)][_0x447deb(0x157)][_0x447deb(0x156)]({'where':{'telegramId':_0x227faa},'include':{'shop':!![]}});if(!_0x33f03d)return _0x770781[_0x447deb(0x13a)](0x194)[_0x447deb(0x161)]({'success':![],'message':_0x447deb(0x128)});await database_1[_0x447deb(0x15e)][_0x447deb(0x157)][_0x447deb(0x12d)]({'where':{'telegramId':_0x227faa},'data':{'shopId':null,'isVerified':![]}}),_0x770781['json']({'success':!![],'message':_0x447deb(0x121)});}catch(_0x59dc1d){_0x3a8c24(_0x59dc1d);}},this['sendTestNotification']=async(_0x34790f,_0x454176,_0x15299e)=>{const _0x27ca81=_0x17e357;try{const {shopId:_0x730c6d,type:type='payment',testData:_0x11be9f}=_0x34790f[_0x27ca81(0x13f)];if(!_0x730c6d)return _0x454176['status'](0x190)[_0x27ca81(0x161)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x5ed0f6=await database_1['default']['shop']['findUnique']({'where':{'id':_0x730c6d},'select':{'id':!![],'name':!![]}});if(!_0x5ed0f6)return _0x454176[_0x27ca81(0x13a)](0x194)[_0x27ca81(0x161)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x27ca81(0x15d):const _0x1147e0={'id':_0x27ca81(0x140),'amount':_0x11be9f?.['amount']||0x64,'currency':_0x11be9f?.[_0x27ca81(0x12b)]||_0x27ca81(0x133),'productName':_0x11be9f?.[_0x27ca81(0x164)]||_0x27ca81(0x147),'gateway':_0x11be9f?.[_0x27ca81(0x13d)]||'plisio','createdAt':new Date(),..._0x11be9f};await telegramBotService_1[_0x27ca81(0x12c)][_0x27ca81(0x13b)](_0x730c6d,_0x1147e0,_0x27ca81(0x11f));break;case'payout':const _0x9035eb={'id':'test_payout_123','amount':_0x11be9f?.['amount']||0x1f4,'network':_0x11be9f?.[_0x27ca81(0x122)]||_0x27ca81(0x135),'wallet':_0x11be9f?.[_0x27ca81(0x131)]||_0x27ca81(0x134),'period':_0x27ca81(0x143),'createdAt':new Date(),'txid':_0x11be9f?.[_0x27ca81(0x158)]||null,..._0x11be9f};await telegramBotService_1[_0x27ca81(0x12c)][_0x27ca81(0x14c)](_0x730c6d,_0x9035eb);break;case _0x27ca81(0x136):await telegramBotService_1[_0x27ca81(0x12c)][_0x27ca81(0x15c)](_0x730c6d,_0x11be9f?.[_0x27ca81(0x124)]||'Test\x20Notification',_0x11be9f?.[_0x27ca81(0x146)]||{'message':_0x27ca81(0x160)});break;default:return _0x454176['status'](0x190)[_0x27ca81(0x161)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x454176[_0x27ca81(0x161)]({'success':!![],'message':_0x27ca81(0x165)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x43e3a0){_0x15299e(_0x43e3a0);}};}}exports['TelegramController']=TelegramController;