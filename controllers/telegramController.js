'use strict';const a14_0x5bd8=a14_0x133b;(function(_0x56c19c,_0x2b2ee8){const _0x49f8a3=a14_0x133b,_0x6a468a=_0x56c19c();while(!![]){try{const _0xfe9ee4=-parseInt(_0x49f8a3(0x8d))/0x1*(parseInt(_0x49f8a3(0xb2))/0x2)+parseInt(_0x49f8a3(0xa5))/0x3+parseInt(_0x49f8a3(0x75))/0x4*(parseInt(_0x49f8a3(0xb1))/0x5)+-parseInt(_0x49f8a3(0x88))/0x6+-parseInt(_0x49f8a3(0x98))/0x7+-parseInt(_0x49f8a3(0x93))/0x8*(parseInt(_0x49f8a3(0x92))/0x9)+parseInt(_0x49f8a3(0x87))/0xa*(parseInt(_0x49f8a3(0x71))/0xb);if(_0xfe9ee4===_0x2b2ee8)break;else _0x6a468a['push'](_0x6a468a['shift']());}catch(_0x3a05be){_0x6a468a['push'](_0x6a468a['shift']());}}}(a14_0xcf02,0x8c49c));function a14_0xcf02(){const _0x1a580f=['sendCustomNotification','4154525VvppOs','2524PgduDJ','Markdown','This\x20is\x20a\x20test\x20notification','sendShopNotification','plisio','completed','__esModule','updatedAt','Shop\x20ID\x20is\x20required','createdAt','6347MJOvlj','username','Telegram\x20user\x20not\x20found','params','4ZhailX','paid','details','Test\x20Product','sendBroadcast','sendPayoutNotification','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','payment','payout','body','true','length','custom','groupBy','TelegramController','getBotStatus','desc','findMany','25310ERzLKw','1828758kEQHob','shopId','User\x20disconnected\x20successfully','sendPaymentNotification','json','386YCvPzh','isVerified','status','findUnique','map','91872RWBiUh','640zCAtTc','all','method','count','telegramUser','4532073VJxKPx','defineProperty','lastName','isActive','test_payout_123','\x20notification\x20sent\x20successfully','query','update','sendTestNotification','telegramId','firstName','getBotInfo','../config/database','1617996KCBmqd','../services/telegramBotService','Broadcast\x20message\x20sent\x20successfully','telegramBotService','filter','default','test_payment_123','title','__importDefault','Test\x20Notification','Shop\x20not\x20found'];a14_0xcf02=function(){return _0x1a580f;};return a14_0xcf02();}var __importDefault=this&&this[a14_0x5bd8(0xad)]||function(_0x460338){const _0x422b52=a14_0x5bd8;return _0x460338&&_0x460338[_0x422b52(0x6d)]?_0x460338:{'default':_0x460338};};Object[a14_0x5bd8(0x99)](exports,a14_0x5bd8(0x6d),{'value':!![]}),exports[a14_0x5bd8(0x83)]=void 0x0;function a14_0x133b(_0x2991eb,_0x515ab8){const _0xcf0289=a14_0xcf02();return a14_0x133b=function(_0x133b8f,_0x38d09b){_0x133b8f=_0x133b8f-0x6c;let _0x132f07=_0xcf0289[_0x133b8f];return _0x132f07;},a14_0x133b(_0x2991eb,_0x515ab8);}const telegramBotService_1=require(a14_0x5bd8(0xa6)),database_1=__importDefault(require(a14_0x5bd8(0xa4)));class TelegramController{constructor(){const _0x202d7e=a14_0x5bd8;this[_0x202d7e(0x84)]=async(_0x3c8696,_0x2c2b90,_0x3bdb79)=>{const _0x45fde1=_0x202d7e;try{const _0x5900de=telegramBotService_1[_0x45fde1(0xa8)][_0x45fde1(0xa3)](),_0x5e65aa=await database_1[_0x45fde1(0xaa)]['telegramUser'][_0x45fde1(0x96)](),_0x205f96=await database_1[_0x45fde1(0xaa)][_0x45fde1(0x97)][_0x45fde1(0x96)]({'where':{'isVerified':!![]}}),_0x261a40=await database_1[_0x45fde1(0xaa)][_0x45fde1(0x97)][_0x45fde1(0x82)]({'by':[_0x45fde1(0x89)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2c2b90[_0x45fde1(0x8c)]({'success':!![],'result':{'bot':{'isActive':_0x5900de[_0x45fde1(0x9b)],'username':_0x5900de[_0x45fde1(0x72)]},'statistics':{'totalUsers':_0x5e65aa,'verifiedUsers':_0x205f96,'unverifiedUsers':_0x5e65aa-_0x205f96,'connectedShops':_0x261a40[_0x45fde1(0x80)]}}});}catch(_0xa3f32f){_0x3bdb79(_0xa3f32f);}},this['getTelegramUsers']=async(_0x52b7cf,_0x100ca0,_0x4598f0)=>{const _0x4bfe97=_0x202d7e;try{const {page:page=0x1,limit:limit=0x14,verified:_0x56f9fa}=_0x52b7cf[_0x4bfe97(0x9e)],_0xe1a791=(Number(page)-0x1)*Number(limit),_0x2ea222={};_0x56f9fa!==undefined&&(_0x2ea222[_0x4bfe97(0x8e)]=_0x56f9fa===_0x4bfe97(0x7f));const [_0x42d804,_0x23d4d9]=await Promise[_0x4bfe97(0x94)]([database_1['default'][_0x4bfe97(0x97)][_0x4bfe97(0x86)]({'where':_0x2ea222,'skip':_0xe1a791,'take':Number(limit),'orderBy':{'createdAt':_0x4bfe97(0x85)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4bfe97(0xaa)][_0x4bfe97(0x97)][_0x4bfe97(0x96)]({'where':_0x2ea222})]);_0x100ca0[_0x4bfe97(0x8c)]({'success':!![],'users':_0x42d804[_0x4bfe97(0x91)](_0x316759=>({'id':_0x316759['id'],'telegramId':_0x316759[_0x4bfe97(0xa1)],'username':_0x316759[_0x4bfe97(0x72)],'firstName':_0x316759[_0x4bfe97(0xa2)],'lastName':_0x316759[_0x4bfe97(0x9a)],'isVerified':_0x316759[_0x4bfe97(0x8e)],'shop':_0x316759['shop'],'createdAt':_0x316759[_0x4bfe97(0x70)],'updatedAt':_0x316759[_0x4bfe97(0x6e)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x23d4d9,'totalPages':Math['ceil'](_0x23d4d9/Number(limit))}});}catch(_0x4ac568){_0x4598f0(_0x4ac568);}},this[_0x202d7e(0x79)]=async(_0x341396,_0x1ebc22,_0x317ecf)=>{const _0x4ddb37=_0x202d7e;try{const {message:_0x3b6b93,shopId:_0x36afe2}=_0x341396[_0x4ddb37(0x7e)];if(!_0x3b6b93)return _0x1ebc22[_0x4ddb37(0x8f)](0x190)[_0x4ddb37(0x8c)]({'success':![],'message':'Message\x20is\x20required'});if(_0x36afe2)await telegramBotService_1[_0x4ddb37(0xa8)][_0x4ddb37(0xb5)](_0x36afe2,_0x3b6b93,{'parse_mode':_0x4ddb37(0xb3)});else{const _0x4e24b5=await database_1[_0x4ddb37(0xaa)][_0x4ddb37(0x97)][_0x4ddb37(0x86)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3c4c22=[...new Set(_0x4e24b5[_0x4ddb37(0x91)](_0x1fd933=>_0x1fd933[_0x4ddb37(0x89)])[_0x4ddb37(0xa9)](Boolean))];for(const _0x4759af of _0x3c4c22){_0x4759af&&await telegramBotService_1[_0x4ddb37(0xa8)]['sendShopNotification'](_0x4759af,_0x3b6b93,{'parse_mode':_0x4ddb37(0xb3)});}}_0x1ebc22[_0x4ddb37(0x8c)]({'success':!![],'message':_0x4ddb37(0xa7)});}catch(_0x4fd503){_0x317ecf(_0x4fd503);}},this['disconnectUser']=async(_0x33b099,_0x1674d7,_0x13ace9)=>{const _0x277756=_0x202d7e;try{const {telegramId:_0x238177}=_0x33b099[_0x277756(0x74)],_0x459381=await database_1[_0x277756(0xaa)][_0x277756(0x97)][_0x277756(0x90)]({'where':{'telegramId':_0x238177},'include':{'shop':!![]}});if(!_0x459381)return _0x1674d7[_0x277756(0x8f)](0x194)[_0x277756(0x8c)]({'success':![],'message':_0x277756(0x73)});await database_1[_0x277756(0xaa)][_0x277756(0x97)][_0x277756(0x9f)]({'where':{'telegramId':_0x238177},'data':{'shopId':null,'isVerified':![]}}),_0x1674d7[_0x277756(0x8c)]({'success':!![],'message':_0x277756(0x8a)});}catch(_0x3dd8fd){_0x13ace9(_0x3dd8fd);}},this[_0x202d7e(0xa0)]=async(_0x363a33,_0x14d6c2,_0x358cf0)=>{const _0x578172=_0x202d7e;try{const {shopId:_0x1f3ead,type:type=_0x578172(0x7c),testData:_0x1ca2ec}=_0x363a33[_0x578172(0x7e)];if(!_0x1f3ead)return _0x14d6c2['status'](0x190)[_0x578172(0x8c)]({'success':![],'message':_0x578172(0x6f)});const _0x4d9f7f=await database_1[_0x578172(0xaa)]['shop']['findUnique']({'where':{'id':_0x1f3ead},'select':{'id':!![],'name':!![]}});if(!_0x4d9f7f)return _0x14d6c2[_0x578172(0x8f)](0x194)['json']({'success':![],'message':_0x578172(0xaf)});switch(type){case _0x578172(0x7c):const _0x5ca814={'id':_0x578172(0xab),'amount':_0x1ca2ec?.['amount']||0x64,'currency':_0x1ca2ec?.['currency']||'USD','productName':_0x1ca2ec?.['productName']||_0x578172(0x78),'gateway':_0x1ca2ec?.['gateway']||_0x578172(0xb6),'createdAt':new Date(),..._0x1ca2ec};await telegramBotService_1[_0x578172(0xa8)][_0x578172(0x8b)](_0x1f3ead,_0x5ca814,_0x578172(0x76));break;case _0x578172(0x7d):const _0x4e5a24={'id':_0x578172(0x9c),'amount':_0x1ca2ec?.['amount']||0x1f4,'method':_0x1ca2ec?.[_0x578172(0x95)]||'bank_transfer','createdAt':new Date(),..._0x1ca2ec};await telegramBotService_1['telegramBotService'][_0x578172(0x7a)](_0x1f3ead,_0x4e5a24,_0x578172(0x6c));break;case _0x578172(0x81):await telegramBotService_1[_0x578172(0xa8)][_0x578172(0xb0)](_0x1f3ead,_0x1ca2ec?.[_0x578172(0xac)]||_0x578172(0xae),_0x1ca2ec?.[_0x578172(0x77)]||{'message':_0x578172(0xb4)});break;default:return _0x14d6c2[_0x578172(0x8f)](0x190)[_0x578172(0x8c)]({'success':![],'message':_0x578172(0x7b)});}_0x14d6c2[_0x578172(0x8c)]({'success':!![],'message':'Test\x20'+type+_0x578172(0x9d)});}catch(_0x490a2d){_0x358cf0(_0x490a2d);}};}}exports['TelegramController']=TelegramController;