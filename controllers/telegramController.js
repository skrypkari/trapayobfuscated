'use strict';function a12_0x15bf(_0x3176d6,_0x2e3b28){const _0x115b2b=a12_0x115b();return a12_0x15bf=function(_0x15bf67,_0x166db9){_0x15bf67=_0x15bf67-0x67;let _0x31242c=_0x115b2b[_0x15bf67];return _0x31242c;},a12_0x15bf(_0x3176d6,_0x2e3b28);}const a12_0x33b93c=a12_0x15bf;(function(_0x5887a8,_0x7583d6){const _0xa53170=a12_0x15bf,_0x490cce=_0x5887a8();while(!![]){try{const _0x6f6256=parseInt(_0xa53170(0x91))/0x1+-parseInt(_0xa53170(0xa4))/0x2+parseInt(_0xa53170(0x79))/0x3*(-parseInt(_0xa53170(0x67))/0x4)+-parseInt(_0xa53170(0x94))/0x5+parseInt(_0xa53170(0xa3))/0x6+parseInt(_0xa53170(0x7d))/0x7+-parseInt(_0xa53170(0x7f))/0x8*(-parseInt(_0xa53170(0x83))/0x9);if(_0x6f6256===_0x7583d6)break;else _0x490cce['push'](_0x490cce['shift']());}catch(_0xcf408b){_0x490cce['push'](_0x490cce['shift']());}}}(a12_0x115b,0xa74b4));var __importDefault=this&&this[a12_0x33b93c(0x93)]||function(_0x47fac8){return _0x47fac8&&_0x47fac8['__esModule']?_0x47fac8:{'default':_0x47fac8};};Object['defineProperty'](exports,a12_0x33b93c(0x68),{'value':!![]}),exports[a12_0x33b93c(0x9e)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x33b93c(0xac)));class TelegramController{constructor(){const _0x26c712=a12_0x33b93c;this[_0x26c712(0xad)]=async(_0x12398b,_0x15428c,_0x3fb7c8)=>{const _0x3d69ff=_0x26c712;try{const _0x4408d0=telegramBotService_1[_0x3d69ff(0x6c)][_0x3d69ff(0x87)](),_0x5aba10=await database_1[_0x3d69ff(0x88)][_0x3d69ff(0x70)][_0x3d69ff(0x97)](),_0x22bc0b=await database_1[_0x3d69ff(0x88)][_0x3d69ff(0x70)][_0x3d69ff(0x97)]({'where':{'isVerified':!![]}}),_0x53e616=await database_1[_0x3d69ff(0x88)][_0x3d69ff(0x70)][_0x3d69ff(0x7e)]({'by':[_0x3d69ff(0xab)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x15428c['json']({'success':!![],'result':{'bot':{'isActive':_0x4408d0[_0x3d69ff(0x9b)],'username':_0x4408d0[_0x3d69ff(0x75)]},'statistics':{'totalUsers':_0x5aba10,'verifiedUsers':_0x22bc0b,'unverifiedUsers':_0x5aba10-_0x22bc0b,'connectedShops':_0x53e616[_0x3d69ff(0x6e)]}}});}catch(_0x158c97){_0x3fb7c8(_0x158c97);}},this[_0x26c712(0x95)]=async(_0x3379c4,_0x22f6bf,_0x1679da)=>{const _0x10468d=_0x26c712;try{const {page:page=0x1,limit:limit=0x14,verified:_0x29eb64}=_0x3379c4[_0x10468d(0x78)],_0x4705eb=(Number(page)-0x1)*Number(limit),_0x3ab951={};_0x29eb64!==undefined&&(_0x3ab951['isVerified']=_0x29eb64===_0x10468d(0x7a));const [_0x211310,_0x22aa9d]=await Promise[_0x10468d(0x77)]([database_1[_0x10468d(0x88)][_0x10468d(0x70)][_0x10468d(0x74)]({'where':_0x3ab951,'skip':_0x4705eb,'take':Number(limit),'orderBy':{'createdAt':_0x10468d(0xaa)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x10468d(0x88)][_0x10468d(0x70)]['count']({'where':_0x3ab951})]);_0x22f6bf[_0x10468d(0x9a)]({'success':!![],'users':_0x211310['map'](_0x500285=>({'id':_0x500285['id'],'telegramId':_0x500285[_0x10468d(0x69)],'username':_0x500285['username'],'firstName':_0x500285[_0x10468d(0x7c)],'lastName':_0x500285[_0x10468d(0xa6)],'isVerified':_0x500285['isVerified'],'shop':_0x500285[_0x10468d(0x72)],'createdAt':_0x500285[_0x10468d(0x6a)],'updatedAt':_0x500285['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x22aa9d,'totalPages':Math[_0x10468d(0x9f)](_0x22aa9d/Number(limit))}});}catch(_0x5aff1e){_0x1679da(_0x5aff1e);}},this['sendBroadcast']=async(_0x6a40d4,_0x293e2b,_0x14cf1a)=>{const _0x2b3ed3=_0x26c712;try{const {message:_0x1fdfad,shopId:_0x14e9b7}=_0x6a40d4[_0x2b3ed3(0xa1)];if(!_0x1fdfad)return _0x293e2b['status'](0x190)[_0x2b3ed3(0x9a)]({'success':![],'message':_0x2b3ed3(0x89)});if(_0x14e9b7)await telegramBotService_1[_0x2b3ed3(0x6c)]['sendShopNotification'](_0x14e9b7,_0x1fdfad,{'parse_mode':'Markdown'});else{const _0x4c511e=await database_1['default'][_0x2b3ed3(0x70)][_0x2b3ed3(0x74)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x322a90=[...new Set(_0x4c511e[_0x2b3ed3(0xa7)](_0x23b2e8=>_0x23b2e8[_0x2b3ed3(0xab)])['filter'](Boolean))];for(const _0x20f48e of _0x322a90){_0x20f48e&&await telegramBotService_1[_0x2b3ed3(0x6c)]['sendShopNotification'](_0x20f48e,_0x1fdfad,{'parse_mode':_0x2b3ed3(0x90)});}}_0x293e2b[_0x2b3ed3(0x9a)]({'success':!![],'message':_0x2b3ed3(0x6f)});}catch(_0x4eed6a){_0x14cf1a(_0x4eed6a);}},this[_0x26c712(0x71)]=async(_0x2d595d,_0x572667,_0x54119e)=>{const _0x2b124b=_0x26c712;try{const {telegramId:_0x492e40}=_0x2d595d[_0x2b124b(0x82)],_0x4e0289=await database_1[_0x2b124b(0x88)][_0x2b124b(0x70)][_0x2b124b(0x8c)]({'where':{'telegramId':_0x492e40},'include':{'shop':!![]}});if(!_0x4e0289)return _0x572667['status'](0x194)[_0x2b124b(0x9a)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x2b124b(0x88)]['telegramUser'][_0x2b124b(0xa5)]({'where':{'telegramId':_0x492e40},'data':{'shopId':null,'isVerified':![]}}),_0x572667[_0x2b124b(0x9a)]({'success':!![],'message':_0x2b124b(0x81)});}catch(_0x294452){_0x54119e(_0x294452);}},this['sendTestNotification']=async(_0x20ade6,_0x3208ca,_0x1df13e)=>{const _0x401c91=_0x26c712;try{const {shopId:_0x16c288,type:type=_0x401c91(0x8e),testData:_0x54fc10}=_0x20ade6[_0x401c91(0xa1)];if(!_0x16c288)return _0x3208ca[_0x401c91(0x8f)](0x190)[_0x401c91(0x9a)]({'success':![],'message':_0x401c91(0xa9)});const _0xb37e12=await database_1[_0x401c91(0x88)]['shop']['findUnique']({'where':{'id':_0x16c288},'select':{'id':!![],'name':!![]}});if(!_0xb37e12)return _0x3208ca[_0x401c91(0x8f)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x401c91(0x8e):const _0x391645={'id':_0x401c91(0x8a),'amount':_0x54fc10?.['amount']||0x64,'currency':_0x54fc10?.[_0x401c91(0x8d)]||_0x401c91(0x6b),'productName':_0x54fc10?.['productName']||_0x401c91(0x9d),'gateway':_0x54fc10?.[_0x401c91(0x9c)]||_0x401c91(0x85),'createdAt':new Date(),..._0x54fc10};await telegramBotService_1['telegramBotService'][_0x401c91(0x99)](_0x16c288,_0x391645,'paid');break;case _0x401c91(0x7b):const _0x59638b={'id':_0x401c91(0x73),'amount':_0x54fc10?.[_0x401c91(0x98)]||0x1f4,'method':_0x54fc10?.[_0x401c91(0x92)]||'bank_transfer','createdAt':new Date(),..._0x54fc10};await telegramBotService_1['telegramBotService'][_0x401c91(0x86)](_0x16c288,_0x59638b,_0x401c91(0x6d));break;case _0x401c91(0x80):await telegramBotService_1['telegramBotService'][_0x401c91(0xa0)](_0x16c288,_0x54fc10?.[_0x401c91(0x8b)]||_0x401c91(0x96),_0x54fc10?.[_0x401c91(0xa8)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x3208ca[_0x401c91(0x8f)](0x190)[_0x401c91(0x9a)]({'success':![],'message':_0x401c91(0x84)});}_0x3208ca['json']({'success':!![],'message':_0x401c91(0xa2)+type+_0x401c91(0x76)});}catch(_0x4ad072){_0x1df13e(_0x4ad072);}};}}exports[a12_0x33b93c(0x9e)]=TelegramController;function a12_0x115b(){const _0x54b66d=['title','findUnique','currency','payment','status','Markdown','495463ybZKUG','method','__importDefault','326310UtyGZj','getTelegramUsers','Test\x20Notification','count','amount','sendPaymentNotification','json','isActive','gateway','Test\x20Product','TelegramController','ceil','sendCustomNotification','body','Test\x20','4104342Nqytcn','2731530FUZKxW','update','lastName','map','details','Shop\x20ID\x20is\x20required','desc','shopId','../config/database','getBotStatus','24136veGfHE','__esModule','telegramId','createdAt','USD','telegramBotService','completed','length','Broadcast\x20message\x20sent\x20successfully','telegramUser','disconnectUser','shop','test_payout_123','findMany','username','\x20notification\x20sent\x20successfully','all','query','489Glivda','true','payout','firstName','6795593xmvKaY','groupBy','368CBRTnc','custom','User\x20disconnected\x20successfully','params','185769OiECar','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','plisio','sendPayoutNotification','getBotInfo','default','Message\x20is\x20required','test_payment_123'];a12_0x115b=function(){return _0x54b66d;};return a12_0x115b();}