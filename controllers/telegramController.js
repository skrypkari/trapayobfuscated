'use strict';const a12_0x19ad05=a12_0x5f0e;function a12_0x5f0e(_0x3aef6a,_0x292398){const _0x15c37c=a12_0x15c3();return a12_0x5f0e=function(_0x5f0ee4,_0xb66412){_0x5f0ee4=_0x5f0ee4-0x165;let _0x4e8a7f=_0x15c37c[_0x5f0ee4];return _0x4e8a7f;},a12_0x5f0e(_0x3aef6a,_0x292398);}(function(_0xaf458f,_0x2162f5){const _0x4bdec7=a12_0x5f0e,_0xc3db9c=_0xaf458f();while(!![]){try{const _0x57c50a=parseInt(_0x4bdec7(0x16a))/0x1*(-parseInt(_0x4bdec7(0x1a2))/0x2)+-parseInt(_0x4bdec7(0x16d))/0x3+parseInt(_0x4bdec7(0x19e))/0x4*(-parseInt(_0x4bdec7(0x1af))/0x5)+-parseInt(_0x4bdec7(0x184))/0x6*(parseInt(_0x4bdec7(0x180))/0x7)+-parseInt(_0x4bdec7(0x16c))/0x8+parseInt(_0x4bdec7(0x18a))/0x9+parseInt(_0x4bdec7(0x190))/0xa*(parseInt(_0x4bdec7(0x170))/0xb);if(_0x57c50a===_0x2162f5)break;else _0xc3db9c['push'](_0xc3db9c['shift']());}catch(_0x40f762){_0xc3db9c['push'](_0xc3db9c['shift']());}}}(a12_0x15c3,0x53830));function a12_0x15c3(){const _0x2ff5d4=['User\x20disconnected\x20successfully','title','body','count','payout','sendPayoutNotification','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','isVerified','filter','json','\x20notification\x20sent\x20successfully','14XCOUmZ','update','sendCustomNotification','params','862266yNpVGc','test_payout_123','username','payment','findUnique','updatedAt','5773446SkIqYX','lastName','sendTestNotification','status','method','Test\x20Notification','187830nnHtGl','isActive','telegramBotService','__esModule','../services/telegramBotService','desc','telegramId','test_payment_123','Broadcast\x20message\x20sent\x20successfully','telegramUser','defineProperty','findMany','Test\x20','Message\x20is\x20required','999428uuZELQ','groupBy','true','map','4986fdyZdk','sendShopNotification','This\x20is\x20a\x20test\x20notification','plisio','__importDefault','productName','getBotInfo','shopId','details','all','Test\x20Product','getBotStatus','TelegramController','5ZnQcfz','Shop\x20ID\x20is\x20required','sendBroadcast','ceil','length','Telegram\x20user\x20not\x20found','paid','default','Markdown','51ijFwuO','completed','5252736pSEgYx','1724913pFUMLY','USD','shop','935CMBkZj','bank_transfer','amount','getTelegramUsers','query'];a12_0x15c3=function(){return _0x2ff5d4;};return a12_0x15c3();}var __importDefault=this&&this[a12_0x19ad05(0x1a6)]||function(_0x151829){const _0xae61e3=a12_0x19ad05;return _0x151829&&_0x151829[_0xae61e3(0x193)]?_0x151829:{'default':_0x151829};};Object[a12_0x19ad05(0x19a)](exports,a12_0x19ad05(0x193),{'value':!![]}),exports[a12_0x19ad05(0x1ae)]=void 0x0;const telegramBotService_1=require(a12_0x19ad05(0x194)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x5afc7d=a12_0x19ad05;this[_0x5afc7d(0x1ad)]=async(_0x521249,_0x43759b,_0xddb8b0)=>{const _0x1369ef=_0x5afc7d;try{const _0x2896ec=telegramBotService_1[_0x1369ef(0x192)][_0x1369ef(0x1a8)](),_0x2de5c3=await database_1[_0x1369ef(0x168)]['telegramUser'][_0x1369ef(0x178)](),_0x1e6c47=await database_1['default']['telegramUser'][_0x1369ef(0x178)]({'where':{'isVerified':!![]}}),_0x7b2d83=await database_1['default'][_0x1369ef(0x199)][_0x1369ef(0x19f)]({'by':[_0x1369ef(0x1a9)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x43759b[_0x1369ef(0x17e)]({'success':!![],'result':{'bot':{'isActive':_0x2896ec[_0x1369ef(0x191)],'username':_0x2896ec['username']},'statistics':{'totalUsers':_0x2de5c3,'verifiedUsers':_0x1e6c47,'unverifiedUsers':_0x2de5c3-_0x1e6c47,'connectedShops':_0x7b2d83[_0x1369ef(0x165)]}}});}catch(_0xb65adc){_0xddb8b0(_0xb65adc);}},this[_0x5afc7d(0x173)]=async(_0x11e8a2,_0x1bdb06,_0x48dee4)=>{const _0x2861a9=_0x5afc7d;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5eb9ca}=_0x11e8a2[_0x2861a9(0x174)],_0x5e689a=(Number(page)-0x1)*Number(limit),_0x4e8389={};_0x5eb9ca!==undefined&&(_0x4e8389[_0x2861a9(0x17c)]=_0x5eb9ca===_0x2861a9(0x1a0));const [_0x443d31,_0x34df6a]=await Promise[_0x2861a9(0x1ab)]([database_1['default'][_0x2861a9(0x199)][_0x2861a9(0x19b)]({'where':_0x4e8389,'skip':_0x5e689a,'take':Number(limit),'orderBy':{'createdAt':_0x2861a9(0x195)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['telegramUser'][_0x2861a9(0x178)]({'where':_0x4e8389})]);_0x1bdb06[_0x2861a9(0x17e)]({'success':!![],'users':_0x443d31['map'](_0xeef9e9=>({'id':_0xeef9e9['id'],'telegramId':_0xeef9e9[_0x2861a9(0x196)],'username':_0xeef9e9[_0x2861a9(0x186)],'firstName':_0xeef9e9['firstName'],'lastName':_0xeef9e9[_0x2861a9(0x18b)],'isVerified':_0xeef9e9['isVerified'],'shop':_0xeef9e9['shop'],'createdAt':_0xeef9e9['createdAt'],'updatedAt':_0xeef9e9[_0x2861a9(0x189)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x34df6a,'totalPages':Math[_0x2861a9(0x1b2)](_0x34df6a/Number(limit))}});}catch(_0x51b9a2){_0x48dee4(_0x51b9a2);}},this[_0x5afc7d(0x1b1)]=async(_0x41aade,_0x38c730,_0x855141)=>{const _0x3a9743=_0x5afc7d;try{const {message:_0x5529a7,shopId:_0x5676b6}=_0x41aade[_0x3a9743(0x177)];if(!_0x5529a7)return _0x38c730['status'](0x190)[_0x3a9743(0x17e)]({'success':![],'message':_0x3a9743(0x19d)});if(_0x5676b6)await telegramBotService_1['telegramBotService'][_0x3a9743(0x1a3)](_0x5676b6,_0x5529a7,{'parse_mode':'Markdown'});else{const _0x43c4b0=await database_1[_0x3a9743(0x168)][_0x3a9743(0x199)][_0x3a9743(0x19b)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xbbb784=[...new Set(_0x43c4b0[_0x3a9743(0x1a1)](_0x3e4c06=>_0x3e4c06[_0x3a9743(0x1a9)])[_0x3a9743(0x17d)](Boolean))];for(const _0x185b9a of _0xbbb784){_0x185b9a&&await telegramBotService_1[_0x3a9743(0x192)][_0x3a9743(0x1a3)](_0x185b9a,_0x5529a7,{'parse_mode':_0x3a9743(0x169)});}}_0x38c730[_0x3a9743(0x17e)]({'success':!![],'message':_0x3a9743(0x198)});}catch(_0xf6e82e){_0x855141(_0xf6e82e);}},this['disconnectUser']=async(_0x73ed9d,_0x5ac1c6,_0x1a5d84)=>{const _0x370420=_0x5afc7d;try{const {telegramId:_0x3b1b}=_0x73ed9d[_0x370420(0x183)],_0xafc2a1=await database_1[_0x370420(0x168)][_0x370420(0x199)][_0x370420(0x188)]({'where':{'telegramId':_0x3b1b},'include':{'shop':!![]}});if(!_0xafc2a1)return _0x5ac1c6[_0x370420(0x18d)](0x194)['json']({'success':![],'message':_0x370420(0x166)});await database_1[_0x370420(0x168)]['telegramUser'][_0x370420(0x181)]({'where':{'telegramId':_0x3b1b},'data':{'shopId':null,'isVerified':![]}}),_0x5ac1c6[_0x370420(0x17e)]({'success':!![],'message':_0x370420(0x175)});}catch(_0x366716){_0x1a5d84(_0x366716);}},this[_0x5afc7d(0x18c)]=async(_0x1365a6,_0xdaeef5,_0x4014ed)=>{const _0x376e8e=_0x5afc7d;try{const {shopId:_0x46af3f,type:type=_0x376e8e(0x187),testData:_0x2e8b05}=_0x1365a6[_0x376e8e(0x177)];if(!_0x46af3f)return _0xdaeef5['status'](0x190)['json']({'success':![],'message':_0x376e8e(0x1b0)});const _0x5d7397=await database_1[_0x376e8e(0x168)][_0x376e8e(0x16f)][_0x376e8e(0x188)]({'where':{'id':_0x46af3f},'select':{'id':!![],'name':!![]}});if(!_0x5d7397)return _0xdaeef5[_0x376e8e(0x18d)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x376e8e(0x187):const _0x4be9af={'id':_0x376e8e(0x197),'amount':_0x2e8b05?.['amount']||0x64,'currency':_0x2e8b05?.['currency']||_0x376e8e(0x16e),'productName':_0x2e8b05?.[_0x376e8e(0x1a7)]||_0x376e8e(0x1ac),'gateway':_0x2e8b05?.['gateway']||_0x376e8e(0x1a5),'createdAt':new Date(),..._0x2e8b05};await telegramBotService_1[_0x376e8e(0x192)]['sendPaymentNotification'](_0x46af3f,_0x4be9af,_0x376e8e(0x167));break;case _0x376e8e(0x179):const _0x466fb3={'id':_0x376e8e(0x185),'amount':_0x2e8b05?.[_0x376e8e(0x172)]||0x1f4,'method':_0x2e8b05?.[_0x376e8e(0x18e)]||_0x376e8e(0x171),'createdAt':new Date(),..._0x2e8b05};await telegramBotService_1[_0x376e8e(0x192)][_0x376e8e(0x17a)](_0x46af3f,_0x466fb3,_0x376e8e(0x16b));break;case'custom':await telegramBotService_1[_0x376e8e(0x192)][_0x376e8e(0x182)](_0x46af3f,_0x2e8b05?.[_0x376e8e(0x176)]||_0x376e8e(0x18f),_0x2e8b05?.[_0x376e8e(0x1aa)]||{'message':_0x376e8e(0x1a4)});break;default:return _0xdaeef5[_0x376e8e(0x18d)](0x190)[_0x376e8e(0x17e)]({'success':![],'message':_0x376e8e(0x17b)});}_0xdaeef5[_0x376e8e(0x17e)]({'success':!![],'message':_0x376e8e(0x19c)+type+_0x376e8e(0x17f)});}catch(_0x5d1853){_0x4014ed(_0x5d1853);}};}}exports[a12_0x19ad05(0x1ae)]=TelegramController;