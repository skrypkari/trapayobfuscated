'use strict';function a13_0x1442(_0x3e79cc,_0x29ff19){const _0x43ba60=a13_0x43ba();return a13_0x1442=function(_0x1442fe,_0x374b09){_0x1442fe=_0x1442fe-0x19b;let _0x17cd8c=_0x43ba60[_0x1442fe];return _0x17cd8c;},a13_0x1442(_0x3e79cc,_0x29ff19);}const a13_0x525979=a13_0x1442;(function(_0x1e8e7f,_0x557eb7){const _0x4b220b=a13_0x1442,_0x298904=_0x1e8e7f();while(!![]){try{const _0x991c6e=parseInt(_0x4b220b(0x1a1))/0x1+parseInt(_0x4b220b(0x1bd))/0x2*(parseInt(_0x4b220b(0x1c1))/0x3)+-parseInt(_0x4b220b(0x1ca))/0x4*(-parseInt(_0x4b220b(0x1cc))/0x5)+parseInt(_0x4b220b(0x1d1))/0x6+parseInt(_0x4b220b(0x19b))/0x7*(-parseInt(_0x4b220b(0x1d0))/0x8)+-parseInt(_0x4b220b(0x1d6))/0x9+-parseInt(_0x4b220b(0x1b9))/0xa;if(_0x991c6e===_0x557eb7)break;else _0x298904['push'](_0x298904['shift']());}catch(_0x4d9d1f){_0x298904['push'](_0x298904['shift']());}}}(a13_0x43ba,0xf1015));var __importDefault=this&&this[a13_0x525979(0x1b3)]||function(_0x3d6e2d){const _0x5c1381=a13_0x525979;return _0x3d6e2d&&_0x3d6e2d[_0x5c1381(0x1a2)]?_0x3d6e2d:{'default':_0x3d6e2d};};Object['defineProperty'](exports,a13_0x525979(0x1a2),{'value':!![]}),exports[a13_0x525979(0x1b4)]=void 0x0;const telegramBotService_1=require(a13_0x525979(0x1da)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x22b68e=a13_0x525979;this[_0x22b68e(0x1a5)]=async(_0x5e07cc,_0x4d938c,_0x2846ff)=>{const _0x35574a=_0x22b68e;try{const _0x27b63c=telegramBotService_1[_0x35574a(0x1d2)][_0x35574a(0x1ae)](),_0x4e9a9d=await database_1['default'][_0x35574a(0x1a4)][_0x35574a(0x1b6)](),_0x2843fe=await database_1[_0x35574a(0x1bb)][_0x35574a(0x1a4)][_0x35574a(0x1b6)]({'where':{'isVerified':!![]}}),_0x4e6de7=await database_1[_0x35574a(0x1bb)]['telegramUser']['groupBy']({'by':[_0x35574a(0x1c8)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4d938c[_0x35574a(0x19d)]({'success':!![],'result':{'bot':{'isActive':_0x27b63c[_0x35574a(0x1d4)],'username':_0x27b63c[_0x35574a(0x1a9)]},'statistics':{'totalUsers':_0x4e9a9d,'verifiedUsers':_0x2843fe,'unverifiedUsers':_0x4e9a9d-_0x2843fe,'connectedShops':_0x4e6de7['length']}}});}catch(_0x5448dd){_0x2846ff(_0x5448dd);}},this['getTelegramUsers']=async(_0x3ad41d,_0x27945c,_0x6882af)=>{const _0x351986=_0x22b68e;try{const {page:page=0x1,limit:limit=0x14,verified:_0x397e3d}=_0x3ad41d[_0x351986(0x1c5)],_0x404eb8=(Number(page)-0x1)*Number(limit),_0x3ce8c3={};_0x397e3d!==undefined&&(_0x3ce8c3[_0x351986(0x1c6)]=_0x397e3d==='true');const [_0x1c9c76,_0x14e44b]=await Promise[_0x351986(0x1a0)]([database_1[_0x351986(0x1bb)]['telegramUser'][_0x351986(0x1a7)]({'where':_0x3ce8c3,'skip':_0x404eb8,'take':Number(limit),'orderBy':{'createdAt':_0x351986(0x1b0)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x351986(0x1bb)][_0x351986(0x1a4)][_0x351986(0x1b6)]({'where':_0x3ce8c3})]);_0x27945c['json']({'success':!![],'users':_0x1c9c76[_0x351986(0x1ac)](_0x28e250=>({'id':_0x28e250['id'],'telegramId':_0x28e250[_0x351986(0x1d3)],'username':_0x28e250[_0x351986(0x1a9)],'firstName':_0x28e250[_0x351986(0x1cd)],'lastName':_0x28e250[_0x351986(0x1ba)],'isVerified':_0x28e250[_0x351986(0x1c6)],'shop':_0x28e250[_0x351986(0x1ce)],'createdAt':_0x28e250[_0x351986(0x1ab)],'updatedAt':_0x28e250['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x14e44b,'totalPages':Math['ceil'](_0x14e44b/Number(limit))}});}catch(_0x1a65b6){_0x6882af(_0x1a65b6);}},this['sendBroadcast']=async(_0x4dd932,_0xb22392,_0x190043)=>{const _0x45c17d=_0x22b68e;try{const {message:_0x56a646,shopId:_0x5cb941}=_0x4dd932[_0x45c17d(0x1b8)];if(!_0x56a646)return _0xb22392['status'](0x190)[_0x45c17d(0x19d)]({'success':![],'message':_0x45c17d(0x1a6)});if(_0x5cb941)await telegramBotService_1['telegramBotService'][_0x45c17d(0x1a8)](_0x5cb941,_0x56a646,{'parse_mode':_0x45c17d(0x1a3)});else{const _0x26d82a=await database_1['default']['telegramUser'][_0x45c17d(0x1a7)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4668dd=[...new Set(_0x26d82a[_0x45c17d(0x1ac)](_0x5791c2=>_0x5791c2['shopId'])['filter'](Boolean))];for(const _0x439f56 of _0x4668dd){_0x439f56&&await telegramBotService_1[_0x45c17d(0x1d2)][_0x45c17d(0x1a8)](_0x439f56,_0x56a646,{'parse_mode':_0x45c17d(0x1a3)});}}_0xb22392[_0x45c17d(0x19d)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x494da4){_0x190043(_0x494da4);}},this['disconnectUser']=async(_0x59a148,_0x5019e3,_0x526665)=>{const _0x436951=_0x22b68e;try{const {telegramId:_0x2d5c84}=_0x59a148[_0x436951(0x1c0)],_0x1d99ac=await database_1[_0x436951(0x1bb)][_0x436951(0x1a4)][_0x436951(0x1c4)]({'where':{'telegramId':_0x2d5c84},'include':{'shop':!![]}});if(!_0x1d99ac)return _0x5019e3[_0x436951(0x1be)](0x194)[_0x436951(0x19d)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x436951(0x1bb)]['telegramUser'][_0x436951(0x1aa)]({'where':{'telegramId':_0x2d5c84},'data':{'shopId':null,'isVerified':![]}}),_0x5019e3[_0x436951(0x19d)]({'success':!![],'message':_0x436951(0x19f)});}catch(_0x16f25d){_0x526665(_0x16f25d);}},this[_0x22b68e(0x1ad)]=async(_0xee3b92,_0x5b662d,_0x116237)=>{const _0x1430e3=_0x22b68e;try{const {shopId:_0x371606,type:type=_0x1430e3(0x1b7),testData:_0x4fa2ef}=_0xee3b92[_0x1430e3(0x1b8)];if(!_0x371606)return _0x5b662d[_0x1430e3(0x1be)](0x190)['json']({'success':![],'message':_0x1430e3(0x1b2)});const _0x290736=await database_1['default'][_0x1430e3(0x1ce)][_0x1430e3(0x1c4)]({'where':{'id':_0x371606},'select':{'id':!![],'name':!![]}});if(!_0x290736)return _0x5b662d['status'](0x194)[_0x1430e3(0x19d)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x1430e3(0x1b7):const _0x7e44e2={'id':'test_payment_123','amount':_0x4fa2ef?.[_0x1430e3(0x1cb)]||0x64,'currency':_0x4fa2ef?.['currency']||_0x1430e3(0x1db),'productName':_0x4fa2ef?.[_0x1430e3(0x1d7)]||_0x1430e3(0x1cf),'gateway':_0x4fa2ef?.['gateway']||_0x1430e3(0x1bf),'createdAt':new Date(),..._0x4fa2ef};await telegramBotService_1[_0x1430e3(0x1d2)]['sendPaymentNotification'](_0x371606,_0x7e44e2,_0x1430e3(0x1d9));break;case _0x1430e3(0x1c3):const _0x396485={'id':'test_payout_123','amount':_0x4fa2ef?.['amount']||0x1f4,'method':_0x4fa2ef?.[_0x1430e3(0x19e)]||_0x1430e3(0x1b1),'createdAt':new Date(),..._0x4fa2ef};await telegramBotService_1[_0x1430e3(0x1d2)][_0x1430e3(0x1af)](_0x371606,_0x396485,_0x1430e3(0x19c));break;case _0x1430e3(0x1b5):await telegramBotService_1[_0x1430e3(0x1d2)][_0x1430e3(0x1d5)](_0x371606,_0x4fa2ef?.[_0x1430e3(0x1c9)]||_0x1430e3(0x1bc),_0x4fa2ef?.[_0x1430e3(0x1d8)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x5b662d[_0x1430e3(0x1be)](0x190)[_0x1430e3(0x19d)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x5b662d[_0x1430e3(0x19d)]({'success':!![],'message':_0x1430e3(0x1c2)+type+_0x1430e3(0x1c7)});}catch(_0x373de7){_0x116237(_0x373de7);}};}}function a13_0x43ba(){const _0x296dc5=['custom','count','payment','body','10440350kSRTGW','lastName','default','Test\x20Notification','6DWEokQ','status','plisio','params','1717971QkzfqQ','Test\x20','payout','findUnique','query','isVerified','\x20notification\x20sent\x20successfully','shopId','title','200brDHxg','amount','114765rMVwqP','firstName','shop','Test\x20Product','10286104OClrcQ','5642106GnTqBA','telegramBotService','telegramId','isActive','sendCustomNotification','15095070HQkFuk','productName','details','paid','../services/telegramBotService','USD','7fpohjI','completed','json','method','User\x20disconnected\x20successfully','all','1188213MfTjUK','__esModule','Markdown','telegramUser','getBotStatus','Message\x20is\x20required','findMany','sendShopNotification','username','update','createdAt','map','sendTestNotification','getBotInfo','sendPayoutNotification','desc','bank_transfer','Shop\x20ID\x20is\x20required','__importDefault','TelegramController'];a13_0x43ba=function(){return _0x296dc5;};return a13_0x43ba();}exports[a13_0x525979(0x1b4)]=TelegramController;