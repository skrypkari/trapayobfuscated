'use strict';const a12_0x18c272=a12_0x38ac;function a12_0x38ac(_0x3a3f02,_0x51d324){const _0x1e4011=a12_0x1e40();return a12_0x38ac=function(_0x38ac32,_0xc1fcc2){_0x38ac32=_0x38ac32-0x7f;let _0x136ff8=_0x1e4011[_0x38ac32];return _0x136ff8;},a12_0x38ac(_0x3a3f02,_0x51d324);}(function(_0x3e06bc,_0x464ea8){const _0x50d9fd=a12_0x38ac,_0x5d8407=_0x3e06bc();while(!![]){try{const _0x787452=parseInt(_0x50d9fd(0xa0))/0x1+parseInt(_0x50d9fd(0xa6))/0x2*(parseInt(_0x50d9fd(0x86))/0x3)+-parseInt(_0x50d9fd(0x91))/0x4*(parseInt(_0x50d9fd(0x88))/0x5)+parseInt(_0x50d9fd(0xba))/0x6*(-parseInt(_0x50d9fd(0x83))/0x7)+parseInt(_0x50d9fd(0xbb))/0x8*(-parseInt(_0x50d9fd(0xaf))/0x9)+parseInt(_0x50d9fd(0x90))/0xa+parseInt(_0x50d9fd(0x94))/0xb*(-parseInt(_0x50d9fd(0xac))/0xc);if(_0x787452===_0x464ea8)break;else _0x5d8407['push'](_0x5d8407['shift']());}catch(_0x542467){_0x5d8407['push'](_0x5d8407['shift']());}}}(a12_0x1e40,0x41b3f));var __importDefault=this&&this['__importDefault']||function(_0x17d3dd){const _0x3aaa40=a12_0x38ac;return _0x17d3dd&&_0x17d3dd[_0x3aaa40(0x8b)]?_0x17d3dd:{'default':_0x17d3dd};};Object[a12_0x18c272(0xb8)](exports,a12_0x18c272(0x8b),{'value':!![]}),exports[a12_0x18c272(0xbe)]=void 0x0;function a12_0x1e40(){const _0x453ba9=['json','Test\x20','groupBy','996AbLLUu','telegramBotService','Test\x20Notification','927jsgQGu','shopId','test_payment_123','gateway','Shop\x20ID\x20is\x20required','\x20notification\x20sent\x20successfully','isActive','payment','payout','defineProperty','lastName','18sQYVXa','1448WMiVWj','../services/telegramBotService','status','TelegramController','bank_transfer','disconnectUser','findMany','default','sendTestNotification','completed','Markdown','username','sendPaymentNotification','276248rWUivl','plisio','custom','3fiUDBs','currency','30xohvkN','Test\x20Product','telegramId','__esModule','sendPayoutNotification','count','update','ceil','5146640VygLZy','183472XWsfgG','filter','User\x20disconnected\x20successfully','51161FaEmQq','Shop\x20not\x20found','all','body','getBotStatus','Telegram\x20user\x20not\x20found','length','getBotInfo','updatedAt','query','findUnique','amount','220800nzVfdF','shop','true','params','map','USD','663862MVsJRH','sendShopNotification','telegramUser'];a12_0x1e40=function(){return _0x453ba9;};return a12_0x1e40();}const telegramBotService_1=require(a12_0x18c272(0xbc)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x3f2651=a12_0x18c272;this[_0x3f2651(0x98)]=async(_0xc3b147,_0x2e961b,_0x37e31f)=>{const _0x3fb97e=_0x3f2651;try{const _0x505fd2=telegramBotService_1[_0x3fb97e(0xad)][_0x3fb97e(0x9b)](),_0x55a3a9=await database_1[_0x3fb97e(0xc2)]['telegramUser'][_0x3fb97e(0x8d)](),_0x3665d3=await database_1[_0x3fb97e(0xc2)][_0x3fb97e(0xa8)][_0x3fb97e(0x8d)]({'where':{'isVerified':!![]}}),_0x90c762=await database_1[_0x3fb97e(0xc2)][_0x3fb97e(0xa8)][_0x3fb97e(0xab)]({'by':[_0x3fb97e(0xb0)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2e961b[_0x3fb97e(0xa9)]({'success':!![],'result':{'bot':{'isActive':_0x505fd2[_0x3fb97e(0xb5)],'username':_0x505fd2[_0x3fb97e(0x81)]},'statistics':{'totalUsers':_0x55a3a9,'verifiedUsers':_0x3665d3,'unverifiedUsers':_0x55a3a9-_0x3665d3,'connectedShops':_0x90c762[_0x3fb97e(0x9a)]}}});}catch(_0x5e443){_0x37e31f(_0x5e443);}},this['getTelegramUsers']=async(_0x5661dd,_0x45fb2e,_0x1bb1e5)=>{const _0x199700=_0x3f2651;try{const {page:page=0x1,limit:limit=0x14,verified:_0x58973f}=_0x5661dd[_0x199700(0x9d)],_0x50b19c=(Number(page)-0x1)*Number(limit),_0x281f79={};_0x58973f!==undefined&&(_0x281f79['isVerified']=_0x58973f===_0x199700(0xa2));const [_0x3a827f,_0x2f2627]=await Promise[_0x199700(0x96)]([database_1['default'][_0x199700(0xa8)][_0x199700(0xc1)]({'where':_0x281f79,'skip':_0x50b19c,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x199700(0xc2)][_0x199700(0xa8)][_0x199700(0x8d)]({'where':_0x281f79})]);_0x45fb2e[_0x199700(0xa9)]({'success':!![],'users':_0x3a827f[_0x199700(0xa4)](_0x3c4a8b=>({'id':_0x3c4a8b['id'],'telegramId':_0x3c4a8b[_0x199700(0x8a)],'username':_0x3c4a8b[_0x199700(0x81)],'firstName':_0x3c4a8b['firstName'],'lastName':_0x3c4a8b[_0x199700(0xb9)],'isVerified':_0x3c4a8b['isVerified'],'shop':_0x3c4a8b[_0x199700(0xa1)],'createdAt':_0x3c4a8b['createdAt'],'updatedAt':_0x3c4a8b[_0x199700(0x9c)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2f2627,'totalPages':Math[_0x199700(0x8f)](_0x2f2627/Number(limit))}});}catch(_0x953893){_0x1bb1e5(_0x953893);}},this['sendBroadcast']=async(_0x1926be,_0x516cf9,_0x298027)=>{const _0x4d5798=_0x3f2651;try{const {message:_0x3be074,shopId:_0x4d8ccf}=_0x1926be['body'];if(!_0x3be074)return _0x516cf9[_0x4d5798(0xbd)](0x190)[_0x4d5798(0xa9)]({'success':![],'message':'Message\x20is\x20required'});if(_0x4d8ccf)await telegramBotService_1['telegramBotService'][_0x4d5798(0xa7)](_0x4d8ccf,_0x3be074,{'parse_mode':'Markdown'});else{const _0x52f6d3=await database_1[_0x4d5798(0xc2)][_0x4d5798(0xa8)][_0x4d5798(0xc1)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1372cd=[...new Set(_0x52f6d3[_0x4d5798(0xa4)](_0x2c76e6=>_0x2c76e6[_0x4d5798(0xb0)])[_0x4d5798(0x92)](Boolean))];for(const _0x3594c5 of _0x1372cd){_0x3594c5&&await telegramBotService_1[_0x4d5798(0xad)][_0x4d5798(0xa7)](_0x3594c5,_0x3be074,{'parse_mode':_0x4d5798(0x80)});}}_0x516cf9[_0x4d5798(0xa9)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x13d67c){_0x298027(_0x13d67c);}},this[_0x3f2651(0xc0)]=async(_0x29a7b7,_0x4b271a,_0x3035e3)=>{const _0x2524cb=_0x3f2651;try{const {telegramId:_0xdfec81}=_0x29a7b7[_0x2524cb(0xa3)],_0x404faa=await database_1[_0x2524cb(0xc2)]['telegramUser'][_0x2524cb(0x9e)]({'where':{'telegramId':_0xdfec81},'include':{'shop':!![]}});if(!_0x404faa)return _0x4b271a[_0x2524cb(0xbd)](0x194)[_0x2524cb(0xa9)]({'success':![],'message':_0x2524cb(0x99)});await database_1[_0x2524cb(0xc2)][_0x2524cb(0xa8)][_0x2524cb(0x8e)]({'where':{'telegramId':_0xdfec81},'data':{'shopId':null,'isVerified':![]}}),_0x4b271a['json']({'success':!![],'message':_0x2524cb(0x93)});}catch(_0x3116a4){_0x3035e3(_0x3116a4);}},this[_0x3f2651(0xc3)]=async(_0x55bf73,_0x137ca0,_0x4372c2)=>{const _0x3a5d77=_0x3f2651;try{const {shopId:_0x28f26b,type:type=_0x3a5d77(0xb6),testData:_0x32dbda}=_0x55bf73[_0x3a5d77(0x97)];if(!_0x28f26b)return _0x137ca0['status'](0x190)[_0x3a5d77(0xa9)]({'success':![],'message':_0x3a5d77(0xb3)});const _0x28c002=await database_1[_0x3a5d77(0xc2)][_0x3a5d77(0xa1)]['findUnique']({'where':{'id':_0x28f26b},'select':{'id':!![],'name':!![]}});if(!_0x28c002)return _0x137ca0['status'](0x194)[_0x3a5d77(0xa9)]({'success':![],'message':_0x3a5d77(0x95)});switch(type){case _0x3a5d77(0xb6):const _0x579d11={'id':_0x3a5d77(0xb1),'amount':_0x32dbda?.[_0x3a5d77(0x9f)]||0x64,'currency':_0x32dbda?.[_0x3a5d77(0x87)]||_0x3a5d77(0xa5),'productName':_0x32dbda?.['productName']||_0x3a5d77(0x89),'gateway':_0x32dbda?.[_0x3a5d77(0xb2)]||_0x3a5d77(0x84),'createdAt':new Date(),..._0x32dbda};await telegramBotService_1['telegramBotService'][_0x3a5d77(0x82)](_0x28f26b,_0x579d11,'paid');break;case _0x3a5d77(0xb7):const _0x40b350={'id':'test_payout_123','amount':_0x32dbda?.[_0x3a5d77(0x9f)]||0x1f4,'method':_0x32dbda?.['method']||_0x3a5d77(0xbf),'createdAt':new Date(),..._0x32dbda};await telegramBotService_1[_0x3a5d77(0xad)][_0x3a5d77(0x8c)](_0x28f26b,_0x40b350,_0x3a5d77(0x7f));break;case _0x3a5d77(0x85):await telegramBotService_1[_0x3a5d77(0xad)]['sendCustomNotification'](_0x28f26b,_0x32dbda?.['title']||_0x3a5d77(0xae),_0x32dbda?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x137ca0['status'](0x190)[_0x3a5d77(0xa9)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x137ca0[_0x3a5d77(0xa9)]({'success':!![],'message':_0x3a5d77(0xaa)+type+_0x3a5d77(0xb4)});}catch(_0x574e28){_0x4372c2(_0x574e28);}};}}exports[a12_0x18c272(0xbe)]=TelegramController;