'use strict';const a12_0xe67d5c=a12_0x1bcc;function a12_0x1bcc(_0x13144c,_0x4bc997){const _0x4aebb8=a12_0x4aeb();return a12_0x1bcc=function(_0x1bcc51,_0x32f133){_0x1bcc51=_0x1bcc51-0xab;let _0x103967=_0x4aebb8[_0x1bcc51];return _0x103967;},a12_0x1bcc(_0x13144c,_0x4bc997);}function a12_0x4aeb(){const _0x270897=['__importDefault','102opcskb','payment','query','createdAt','This\x20is\x20a\x20test\x20notification','7398SREVVE','sendPaymentNotification','firstName','sendBroadcast','Shop\x20ID\x20is\x20required','\x20notification\x20sent\x20successfully','params','paid','isActive','productName','sendTestNotification','completed','shop','12194766OXrLgM','telegramUser','TelegramController','json','currency','username','getBotInfo','170oKTwzj','31829NOkFxF','getBotStatus','__esModule','gateway','method','map','findMany','Broadcast\x20message\x20sent\x20successfully','payout','Markdown','plisio','1649315DSHEat','desc','count','../services/telegramBotService','default','updatedAt','telegramBotService','ceil','title','sendShopNotification','Test\x20Notification','376lvhqCk','status','update','1171159rcebRI','getTelegramUsers','Test\x20Product','amount','lastName','isVerified','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','length','sendCustomNotification','../config/database','body','telegramId','4dizNbV','8043780EdKSRA','findUnique','shopId','4354401DIjeBq','bank_transfer','User\x20disconnected\x20successfully'];a12_0x4aeb=function(){return _0x270897;};return a12_0x4aeb();}(function(_0x4e3a38,_0x5de09b){const _0x1b2353=a12_0x1bcc,_0x38b3fd=_0x4e3a38();while(!![]){try{const _0x126c95=-parseInt(_0x1b2353(0xbf))/0x1*(-parseInt(_0x1b2353(0xc4))/0x2)+parseInt(_0x1b2353(0xbb))/0x3+-parseInt(_0x1b2353(0xb7))/0x4*(parseInt(_0x1b2353(0xe4))/0x5)+-parseInt(_0x1b2353(0xb8))/0x6+-parseInt(_0x1b2353(0xd9))/0x7*(-parseInt(_0x1b2353(0xef))/0x8)+-parseInt(_0x1b2353(0xd1))/0x9+parseInt(_0x1b2353(0xd8))/0xa*(parseInt(_0x1b2353(0xab))/0xb);if(_0x126c95===_0x5de09b)break;else _0x38b3fd['push'](_0x38b3fd['shift']());}catch(_0x5aa848){_0x38b3fd['push'](_0x38b3fd['shift']());}}}(a12_0x4aeb,0xc9e64));var __importDefault=this&&this[a12_0xe67d5c(0xbe)]||function(_0x24a8ed){return _0x24a8ed&&_0x24a8ed['__esModule']?_0x24a8ed:{'default':_0x24a8ed};};Object['defineProperty'](exports,a12_0xe67d5c(0xdb),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0xe67d5c(0xe7)),database_1=__importDefault(require(a12_0xe67d5c(0xb4)));class TelegramController{constructor(){const _0x5084e0=a12_0xe67d5c;this[_0x5084e0(0xda)]=async(_0x40ae6a,_0x504d9e,_0x3fcda3)=>{const _0x29d18e=_0x5084e0;try{const _0x464e1e=telegramBotService_1[_0x29d18e(0xea)][_0x29d18e(0xd7)](),_0x46b4b3=await database_1[_0x29d18e(0xe8)][_0x29d18e(0xd2)][_0x29d18e(0xe6)](),_0x5d6c06=await database_1[_0x29d18e(0xe8)][_0x29d18e(0xd2)][_0x29d18e(0xe6)]({'where':{'isVerified':!![]}}),_0x5c5f1c=await database_1['default'][_0x29d18e(0xd2)]['groupBy']({'by':[_0x29d18e(0xba)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x504d9e[_0x29d18e(0xd4)]({'success':!![],'result':{'bot':{'isActive':_0x464e1e[_0x29d18e(0xcc)],'username':_0x464e1e[_0x29d18e(0xd6)]},'statistics':{'totalUsers':_0x46b4b3,'verifiedUsers':_0x5d6c06,'unverifiedUsers':_0x46b4b3-_0x5d6c06,'connectedShops':_0x5c5f1c[_0x29d18e(0xb2)]}}});}catch(_0x45ca17){_0x3fcda3(_0x45ca17);}},this[_0x5084e0(0xac)]=async(_0x8bab77,_0x3436db,_0x159ddd)=>{const _0x3a7d76=_0x5084e0;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4ad637}=_0x8bab77[_0x3a7d76(0xc1)],_0x1e2f5a=(Number(page)-0x1)*Number(limit),_0x5762bd={};_0x4ad637!==undefined&&(_0x5762bd[_0x3a7d76(0xb0)]=_0x4ad637==='true');const [_0x35eae4,_0x2b7e65]=await Promise['all']([database_1[_0x3a7d76(0xe8)][_0x3a7d76(0xd2)]['findMany']({'where':_0x5762bd,'skip':_0x1e2f5a,'take':Number(limit),'orderBy':{'createdAt':_0x3a7d76(0xe5)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x3a7d76(0xe8)][_0x3a7d76(0xd2)][_0x3a7d76(0xe6)]({'where':_0x5762bd})]);_0x3436db['json']({'success':!![],'users':_0x35eae4['map'](_0x342277=>({'id':_0x342277['id'],'telegramId':_0x342277[_0x3a7d76(0xb6)],'username':_0x342277[_0x3a7d76(0xd6)],'firstName':_0x342277[_0x3a7d76(0xc6)],'lastName':_0x342277[_0x3a7d76(0xaf)],'isVerified':_0x342277[_0x3a7d76(0xb0)],'shop':_0x342277['shop'],'createdAt':_0x342277[_0x3a7d76(0xc2)],'updatedAt':_0x342277[_0x3a7d76(0xe9)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2b7e65,'totalPages':Math[_0x3a7d76(0xeb)](_0x2b7e65/Number(limit))}});}catch(_0x4e8c0c){_0x159ddd(_0x4e8c0c);}},this[_0x5084e0(0xc7)]=async(_0x4d5948,_0x1d9d91,_0x9811c5)=>{const _0x395976=_0x5084e0;try{const {message:_0x481deb,shopId:_0x333db6}=_0x4d5948[_0x395976(0xb5)];if(!_0x481deb)return _0x1d9d91[_0x395976(0xf0)](0x190)[_0x395976(0xd4)]({'success':![],'message':'Message\x20is\x20required'});if(_0x333db6)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x333db6,_0x481deb,{'parse_mode':'Markdown'});else{const _0x3b148b=await database_1[_0x395976(0xe8)][_0x395976(0xd2)][_0x395976(0xdf)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4f47aa=[...new Set(_0x3b148b[_0x395976(0xde)](_0x2a4685=>_0x2a4685[_0x395976(0xba)])['filter'](Boolean))];for(const _0x2892f8 of _0x4f47aa){_0x2892f8&&await telegramBotService_1[_0x395976(0xea)][_0x395976(0xed)](_0x2892f8,_0x481deb,{'parse_mode':_0x395976(0xe2)});}}_0x1d9d91[_0x395976(0xd4)]({'success':!![],'message':_0x395976(0xe0)});}catch(_0x29c531){_0x9811c5(_0x29c531);}},this['disconnectUser']=async(_0x27082a,_0x222616,_0x477631)=>{const _0x3183bf=_0x5084e0;try{const {telegramId:_0x41a4d8}=_0x27082a[_0x3183bf(0xca)],_0x13a38d=await database_1[_0x3183bf(0xe8)][_0x3183bf(0xd2)]['findUnique']({'where':{'telegramId':_0x41a4d8},'include':{'shop':!![]}});if(!_0x13a38d)return _0x222616['status'](0x194)[_0x3183bf(0xd4)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x3183bf(0xe8)][_0x3183bf(0xd2)][_0x3183bf(0xf1)]({'where':{'telegramId':_0x41a4d8},'data':{'shopId':null,'isVerified':![]}}),_0x222616[_0x3183bf(0xd4)]({'success':!![],'message':_0x3183bf(0xbd)});}catch(_0x19bec0){_0x477631(_0x19bec0);}},this[_0x5084e0(0xce)]=async(_0x236966,_0x1cc559,_0x23ae20)=>{const _0x5c80f0=_0x5084e0;try{const {shopId:_0x2ed034,type:type='payment',testData:_0x2b9615}=_0x236966[_0x5c80f0(0xb5)];if(!_0x2ed034)return _0x1cc559[_0x5c80f0(0xf0)](0x190)[_0x5c80f0(0xd4)]({'success':![],'message':_0x5c80f0(0xc8)});const _0x65eb76=await database_1[_0x5c80f0(0xe8)][_0x5c80f0(0xd0)][_0x5c80f0(0xb9)]({'where':{'id':_0x2ed034},'select':{'id':!![],'name':!![]}});if(!_0x65eb76)return _0x1cc559[_0x5c80f0(0xf0)](0x194)[_0x5c80f0(0xd4)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x5c80f0(0xc0):const _0x5c7c30={'id':'test_payment_123','amount':_0x2b9615?.[_0x5c80f0(0xae)]||0x64,'currency':_0x2b9615?.[_0x5c80f0(0xd5)]||'USD','productName':_0x2b9615?.[_0x5c80f0(0xcd)]||_0x5c80f0(0xad),'gateway':_0x2b9615?.[_0x5c80f0(0xdc)]||_0x5c80f0(0xe3),'createdAt':new Date(),..._0x2b9615};await telegramBotService_1[_0x5c80f0(0xea)][_0x5c80f0(0xc5)](_0x2ed034,_0x5c7c30,_0x5c80f0(0xcb));break;case _0x5c80f0(0xe1):const _0x78d5a4={'id':'test_payout_123','amount':_0x2b9615?.[_0x5c80f0(0xae)]||0x1f4,'method':_0x2b9615?.[_0x5c80f0(0xdd)]||_0x5c80f0(0xbc),'createdAt':new Date(),..._0x2b9615};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x2ed034,_0x78d5a4,_0x5c80f0(0xcf));break;case'custom':await telegramBotService_1['telegramBotService'][_0x5c80f0(0xb3)](_0x2ed034,_0x2b9615?.[_0x5c80f0(0xec)]||_0x5c80f0(0xee),_0x2b9615?.['details']||{'message':_0x5c80f0(0xc3)});break;default:return _0x1cc559[_0x5c80f0(0xf0)](0x190)[_0x5c80f0(0xd4)]({'success':![],'message':_0x5c80f0(0xb1)});}_0x1cc559[_0x5c80f0(0xd4)]({'success':!![],'message':'Test\x20'+type+_0x5c80f0(0xc9)});}catch(_0x263336){_0x23ae20(_0x263336);}};}}exports[a12_0xe67d5c(0xd3)]=TelegramController;