'use strict';const a12_0x34aa99=a12_0xfb23;(function(_0x1422d3,_0x4ca866){const _0x440d00=a12_0xfb23,_0x5e9df2=_0x1422d3();while(!![]){try{const _0x34ee25=parseInt(_0x440d00(0xb5))/0x1+parseInt(_0x440d00(0xdc))/0x2+-parseInt(_0x440d00(0xb4))/0x3*(-parseInt(_0x440d00(0xe5))/0x4)+-parseInt(_0x440d00(0xbf))/0x5*(parseInt(_0x440d00(0xe3))/0x6)+-parseInt(_0x440d00(0xf1))/0x7*(parseInt(_0x440d00(0xb2))/0x8)+-parseInt(_0x440d00(0xf9))/0x9*(parseInt(_0x440d00(0xbe))/0xa)+-parseInt(_0x440d00(0xd6))/0xb*(-parseInt(_0x440d00(0xc1))/0xc);if(_0x34ee25===_0x4ca866)break;else _0x5e9df2['push'](_0x5e9df2['shift']());}catch(_0x2bf336){_0x5e9df2['push'](_0x5e9df2['shift']());}}}(a12_0xda8f,0x9a3cc));var __importDefault=this&&this['__importDefault']||function(_0x49caeb){const _0x1ed1d0=a12_0xfb23;return _0x49caeb&&_0x49caeb[_0x1ed1d0(0xd9)]?_0x49caeb:{'default':_0x49caeb};};function a12_0xda8f(){const _0x1f684c=['78885nPKeEQ','status','sendBroadcast','../services/telegramBotService','test_payment_123','27184VmFUeA','ceil','3882rpFYRK','645447WwlfDA','User\x20disconnected\x20successfully','getBotInfo','Message\x20is\x20required','true','paid','disconnectUser','update','shopId','830PoIUeH','9825eoBFWa','test_payout_123','1001076ooNyzV','updatedAt','query','default','Markdown','details','params','amount','length','getTelegramUsers','desc','payout','body','json','shop','completed','sendShopNotification','getBotStatus','lastName','Test\x20Notification','currency','55KKIBdG','TelegramController','count','__esModule','title','defineProperty','855212sfnMUP','all','gateway','telegramUser','findMany','Test\x20Product','Shop\x20not\x20found','1002gzZIHV','Test\x20','2784DiojOS','This\x20is\x20a\x20test\x20notification','Broadcast\x20message\x20sent\x20successfully','sendTestNotification','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','USD','username','bank_transfer','telegramBotService','createdAt','sendPayoutNotification','payment','1449urNPBm','isVerified','plisio','method','firstName','findUnique','isActive','telegramId'];a12_0xda8f=function(){return _0x1f684c;};return a12_0xda8f();}Object[a12_0x34aa99(0xdb)](exports,a12_0x34aa99(0xd9),{'value':!![]}),exports['TelegramController']=void 0x0;function a12_0xfb23(_0x246bb0,_0x65d2ab){const _0xda8f89=a12_0xda8f();return a12_0xfb23=function(_0xfb2330,_0x1995d6){_0xfb2330=_0xfb2330-0xae;let _0x25ad24=_0xda8f89[_0xfb2330];return _0x25ad24;},a12_0xfb23(_0x246bb0,_0x65d2ab);}const telegramBotService_1=require(a12_0x34aa99(0xb0)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x2db0e0=a12_0x34aa99;this[_0x2db0e0(0xd2)]=async(_0x32ea0f,_0x32ab32,_0x42f6cb)=>{const _0x5dc208=_0x2db0e0;try{const _0x531d56=telegramBotService_1['telegramBotService'][_0x5dc208(0xb7)](),_0x382925=await database_1['default']['telegramUser'][_0x5dc208(0xd8)](),_0x2e0cc5=await database_1[_0x5dc208(0xc4)][_0x5dc208(0xdf)][_0x5dc208(0xd8)]({'where':{'isVerified':!![]}}),_0x277ca1=await database_1[_0x5dc208(0xc4)]['telegramUser']['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x32ab32[_0x5dc208(0xce)]({'success':!![],'result':{'bot':{'isActive':_0x531d56[_0x5dc208(0xf7)],'username':_0x531d56['username']},'statistics':{'totalUsers':_0x382925,'verifiedUsers':_0x2e0cc5,'unverifiedUsers':_0x382925-_0x2e0cc5,'connectedShops':_0x277ca1[_0x5dc208(0xc9)]}}});}catch(_0x42be08){_0x42f6cb(_0x42be08);}},this[_0x2db0e0(0xca)]=async(_0x297899,_0x4feb9a,_0x560892)=>{const _0x5c35ca=_0x2db0e0;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2b6190}=_0x297899[_0x5c35ca(0xc3)],_0x39faad=(Number(page)-0x1)*Number(limit),_0x183628={};_0x2b6190!==undefined&&(_0x183628[_0x5c35ca(0xf2)]=_0x2b6190===_0x5c35ca(0xb9));const [_0x5b61b9,_0x2f4a48]=await Promise[_0x5c35ca(0xdd)]([database_1[_0x5c35ca(0xc4)][_0x5c35ca(0xdf)][_0x5c35ca(0xe0)]({'where':_0x183628,'skip':_0x39faad,'take':Number(limit),'orderBy':{'createdAt':_0x5c35ca(0xcb)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5c35ca(0xc4)]['telegramUser'][_0x5c35ca(0xd8)]({'where':_0x183628})]);_0x4feb9a[_0x5c35ca(0xce)]({'success':!![],'users':_0x5b61b9['map'](_0x27f06d=>({'id':_0x27f06d['id'],'telegramId':_0x27f06d[_0x5c35ca(0xf8)],'username':_0x27f06d[_0x5c35ca(0xeb)],'firstName':_0x27f06d[_0x5c35ca(0xf5)],'lastName':_0x27f06d[_0x5c35ca(0xd3)],'isVerified':_0x27f06d[_0x5c35ca(0xf2)],'shop':_0x27f06d[_0x5c35ca(0xcf)],'createdAt':_0x27f06d[_0x5c35ca(0xee)],'updatedAt':_0x27f06d[_0x5c35ca(0xc2)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x2f4a48,'totalPages':Math[_0x5c35ca(0xb3)](_0x2f4a48/Number(limit))}});}catch(_0x59f70f){_0x560892(_0x59f70f);}},this[_0x2db0e0(0xaf)]=async(_0x2b97b4,_0x1d58a8,_0x5e0e7b)=>{const _0x6c199d=_0x2db0e0;try{const {message:_0x274644,shopId:_0x4eb1f4}=_0x2b97b4['body'];if(!_0x274644)return _0x1d58a8['status'](0x190)['json']({'success':![],'message':_0x6c199d(0xb8)});if(_0x4eb1f4)await telegramBotService_1['telegramBotService'][_0x6c199d(0xd1)](_0x4eb1f4,_0x274644,{'parse_mode':_0x6c199d(0xc5)});else{const _0xaf0933=await database_1['default'][_0x6c199d(0xdf)][_0x6c199d(0xe0)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x33d77e=[...new Set(_0xaf0933['map'](_0x11b154=>_0x11b154[_0x6c199d(0xbd)])['filter'](Boolean))];for(const _0x1d62bf of _0x33d77e){_0x1d62bf&&await telegramBotService_1[_0x6c199d(0xed)][_0x6c199d(0xd1)](_0x1d62bf,_0x274644,{'parse_mode':_0x6c199d(0xc5)});}}_0x1d58a8[_0x6c199d(0xce)]({'success':!![],'message':_0x6c199d(0xe7)});}catch(_0x4f3afc){_0x5e0e7b(_0x4f3afc);}},this[_0x2db0e0(0xbb)]=async(_0x2d9594,_0x30dbdc,_0x4467aa)=>{const _0x35f7d2=_0x2db0e0;try{const {telegramId:_0x226ca9}=_0x2d9594[_0x35f7d2(0xc7)],_0x56112d=await database_1[_0x35f7d2(0xc4)]['telegramUser'][_0x35f7d2(0xf6)]({'where':{'telegramId':_0x226ca9},'include':{'shop':!![]}});if(!_0x56112d)return _0x30dbdc[_0x35f7d2(0xae)](0x194)[_0x35f7d2(0xce)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x35f7d2(0xc4)][_0x35f7d2(0xdf)][_0x35f7d2(0xbc)]({'where':{'telegramId':_0x226ca9},'data':{'shopId':null,'isVerified':![]}}),_0x30dbdc[_0x35f7d2(0xce)]({'success':!![],'message':_0x35f7d2(0xb6)});}catch(_0x5b84fe){_0x4467aa(_0x5b84fe);}},this[_0x2db0e0(0xe8)]=async(_0x5d8f4d,_0x368f37,_0x15a3e0)=>{const _0xb24299=_0x2db0e0;try{const {shopId:_0x3b6264,type:type='payment',testData:_0xb863e8}=_0x5d8f4d[_0xb24299(0xcd)];if(!_0x3b6264)return _0x368f37[_0xb24299(0xae)](0x190)[_0xb24299(0xce)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x480860=await database_1[_0xb24299(0xc4)]['shop']['findUnique']({'where':{'id':_0x3b6264},'select':{'id':!![],'name':!![]}});if(!_0x480860)return _0x368f37['status'](0x194)[_0xb24299(0xce)]({'success':![],'message':_0xb24299(0xe2)});switch(type){case _0xb24299(0xf0):const _0x3cf424={'id':_0xb24299(0xb1),'amount':_0xb863e8?.[_0xb24299(0xc8)]||0x64,'currency':_0xb863e8?.[_0xb24299(0xd5)]||_0xb24299(0xea),'productName':_0xb863e8?.['productName']||_0xb24299(0xe1),'gateway':_0xb863e8?.[_0xb24299(0xde)]||_0xb24299(0xf3),'createdAt':new Date(),..._0xb863e8};await telegramBotService_1[_0xb24299(0xed)]['sendPaymentNotification'](_0x3b6264,_0x3cf424,_0xb24299(0xba));break;case _0xb24299(0xcc):const _0xcdb159={'id':_0xb24299(0xc0),'amount':_0xb863e8?.['amount']||0x1f4,'method':_0xb863e8?.[_0xb24299(0xf4)]||_0xb24299(0xec),'createdAt':new Date(),..._0xb863e8};await telegramBotService_1[_0xb24299(0xed)][_0xb24299(0xef)](_0x3b6264,_0xcdb159,_0xb24299(0xd0));break;case'custom':await telegramBotService_1['telegramBotService']['sendCustomNotification'](_0x3b6264,_0xb863e8?.[_0xb24299(0xda)]||_0xb24299(0xd4),_0xb863e8?.[_0xb24299(0xc6)]||{'message':_0xb24299(0xe6)});break;default:return _0x368f37[_0xb24299(0xae)](0x190)['json']({'success':![],'message':_0xb24299(0xe9)});}_0x368f37['json']({'success':!![],'message':_0xb24299(0xe4)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x3ad10e){_0x15a3e0(_0x3ad10e);}};}}exports[a12_0x34aa99(0xd7)]=TelegramController;