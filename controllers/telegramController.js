'use strict';const a12_0x3ba670=a12_0x3ef4;(function(_0x35df62,_0x5ccb81){const _0x168c14=a12_0x3ef4,_0x862a73=_0x35df62();while(!![]){try{const _0x481085=parseInt(_0x168c14(0x138))/0x1*(-parseInt(_0x168c14(0x12e))/0x2)+parseInt(_0x168c14(0x162))/0x3+-parseInt(_0x168c14(0x131))/0x4*(parseInt(_0x168c14(0x13f))/0x5)+parseInt(_0x168c14(0x15f))/0x6+-parseInt(_0x168c14(0x14c))/0x7+-parseInt(_0x168c14(0x129))/0x8*(parseInt(_0x168c14(0x147))/0x9)+parseInt(_0x168c14(0x13a))/0xa*(parseInt(_0x168c14(0x11d))/0xb);if(_0x481085===_0x5ccb81)break;else _0x862a73['push'](_0x862a73['shift']());}catch(_0x2c1555){_0x862a73['push'](_0x862a73['shift']());}}}(a12_0x685d,0xa5fb8));function a12_0x685d(){const _0x48b790=['findUnique','shop','191572nddPON','lastName','json','sendBroadcast','map','../config/database','Test\x20Notification','6crimiP','shopId','498770PldOiK','test_payout_123','Telegram\x20user\x20not\x20found','getTelegramUsers','payment','35zHVbWk','filter','TelegramController','updatedAt','length','../services/telegramBotService','getBotInfo','productName','2367MQhdWb','sendPayoutNotification','completed','sendPaymentNotification','This\x20is\x20a\x20test\x20notification','986482PaQGim','true','Test\x20Product','\x20notification\x20sent\x20successfully','__esModule','firstName','gateway','getBotStatus','status','Shop\x20ID\x20is\x20required','custom','count','USD','username','sendShopNotification','query','paid','payout','currency','4987026vJlydp','ceil','telegramId','3826164jnPTAF','title','Shop\x20not\x20found','253KLOpPl','bank_transfer','default','findMany','test_payment_123','User\x20disconnected\x20successfully','plisio','telegramUser','telegramBotService','isVerified','all','Markdown','24536IqknAw','amount','defineProperty','groupBy','Broadcast\x20message\x20sent\x20successfully','430356aswFSl'];a12_0x685d=function(){return _0x48b790;};return a12_0x685d();}var __importDefault=this&&this['__importDefault']||function(_0x850113){const _0x49cac1=a12_0x3ef4;return _0x850113&&_0x850113[_0x49cac1(0x150)]?_0x850113:{'default':_0x850113};};function a12_0x3ef4(_0x33d8a5,_0x54e5bc){const _0x685d1c=a12_0x685d();return a12_0x3ef4=function(_0x3ef4cd,_0x111d8d){_0x3ef4cd=_0x3ef4cd-0x11c;let _0x5e577b=_0x685d1c[_0x3ef4cd];return _0x5e577b;},a12_0x3ef4(_0x33d8a5,_0x54e5bc);}Object[a12_0x3ba670(0x12b)](exports,a12_0x3ba670(0x150),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x3ba670(0x144)),database_1=__importDefault(require(a12_0x3ba670(0x136)));class TelegramController{constructor(){const _0x598fc9=a12_0x3ba670;this[_0x598fc9(0x153)]=async(_0x380ed3,_0x5b3aa1,_0x53c463)=>{const _0x24fe0e=_0x598fc9;try{const _0x20cadb=telegramBotService_1[_0x24fe0e(0x125)][_0x24fe0e(0x145)](),_0x1c452b=await database_1[_0x24fe0e(0x11f)]['telegramUser'][_0x24fe0e(0x157)](),_0x2b6893=await database_1[_0x24fe0e(0x11f)][_0x24fe0e(0x124)][_0x24fe0e(0x157)]({'where':{'isVerified':!![]}}),_0x2d6162=await database_1['default']['telegramUser'][_0x24fe0e(0x12c)]({'by':[_0x24fe0e(0x139)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5b3aa1[_0x24fe0e(0x133)]({'success':!![],'result':{'bot':{'isActive':_0x20cadb['isActive'],'username':_0x20cadb[_0x24fe0e(0x159)]},'statistics':{'totalUsers':_0x1c452b,'verifiedUsers':_0x2b6893,'unverifiedUsers':_0x1c452b-_0x2b6893,'connectedShops':_0x2d6162[_0x24fe0e(0x143)]}}});}catch(_0x23a4a9){_0x53c463(_0x23a4a9);}},this[_0x598fc9(0x13d)]=async(_0x1554c3,_0x22be71,_0x5437db)=>{const _0x5c7d47=_0x598fc9;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2390c3}=_0x1554c3[_0x5c7d47(0x15b)],_0x5a279d=(Number(page)-0x1)*Number(limit),_0x1dcbeb={};_0x2390c3!==undefined&&(_0x1dcbeb[_0x5c7d47(0x126)]=_0x2390c3===_0x5c7d47(0x14d));const [_0x30641a,_0x20f023]=await Promise[_0x5c7d47(0x127)]([database_1[_0x5c7d47(0x11f)]['telegramUser'][_0x5c7d47(0x120)]({'where':_0x1dcbeb,'skip':_0x5a279d,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5c7d47(0x11f)][_0x5c7d47(0x124)][_0x5c7d47(0x157)]({'where':_0x1dcbeb})]);_0x22be71[_0x5c7d47(0x133)]({'success':!![],'users':_0x30641a[_0x5c7d47(0x135)](_0xd44cf6=>({'id':_0xd44cf6['id'],'telegramId':_0xd44cf6[_0x5c7d47(0x161)],'username':_0xd44cf6[_0x5c7d47(0x159)],'firstName':_0xd44cf6[_0x5c7d47(0x151)],'lastName':_0xd44cf6[_0x5c7d47(0x132)],'isVerified':_0xd44cf6['isVerified'],'shop':_0xd44cf6[_0x5c7d47(0x130)],'createdAt':_0xd44cf6['createdAt'],'updatedAt':_0xd44cf6[_0x5c7d47(0x142)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x20f023,'totalPages':Math[_0x5c7d47(0x160)](_0x20f023/Number(limit))}});}catch(_0x135f4e){_0x5437db(_0x135f4e);}},this[_0x598fc9(0x134)]=async(_0x26d02a,_0x2c69e1,_0x18d30b)=>{const _0x2942b6=_0x598fc9;try{const {message:_0x3b14dd,shopId:_0x1242c5}=_0x26d02a['body'];if(!_0x3b14dd)return _0x2c69e1[_0x2942b6(0x154)](0x190)[_0x2942b6(0x133)]({'success':![],'message':'Message\x20is\x20required'});if(_0x1242c5)await telegramBotService_1[_0x2942b6(0x125)]['sendShopNotification'](_0x1242c5,_0x3b14dd,{'parse_mode':_0x2942b6(0x128)});else{const _0x1cc514=await database_1[_0x2942b6(0x11f)][_0x2942b6(0x124)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3254b8=[...new Set(_0x1cc514[_0x2942b6(0x135)](_0x43fdd0=>_0x43fdd0[_0x2942b6(0x139)])[_0x2942b6(0x140)](Boolean))];for(const _0x15baf9 of _0x3254b8){_0x15baf9&&await telegramBotService_1[_0x2942b6(0x125)][_0x2942b6(0x15a)](_0x15baf9,_0x3b14dd,{'parse_mode':'Markdown'});}}_0x2c69e1[_0x2942b6(0x133)]({'success':!![],'message':_0x2942b6(0x12d)});}catch(_0x27f6ce){_0x18d30b(_0x27f6ce);}},this['disconnectUser']=async(_0x4c59c3,_0x34531c,_0x13913b)=>{const _0xb1219c=_0x598fc9;try{const {telegramId:_0x3166a8}=_0x4c59c3['params'],_0x1e79bc=await database_1[_0xb1219c(0x11f)][_0xb1219c(0x124)]['findUnique']({'where':{'telegramId':_0x3166a8},'include':{'shop':!![]}});if(!_0x1e79bc)return _0x34531c['status'](0x194)[_0xb1219c(0x133)]({'success':![],'message':_0xb1219c(0x13c)});await database_1[_0xb1219c(0x11f)]['telegramUser']['update']({'where':{'telegramId':_0x3166a8},'data':{'shopId':null,'isVerified':![]}}),_0x34531c['json']({'success':!![],'message':_0xb1219c(0x122)});}catch(_0x44584b){_0x13913b(_0x44584b);}},this['sendTestNotification']=async(_0x169064,_0x307ffb,_0x3a6057)=>{const _0x4ac7c8=_0x598fc9;try{const {shopId:_0x29caf7,type:type=_0x4ac7c8(0x13e),testData:_0x15abe5}=_0x169064['body'];if(!_0x29caf7)return _0x307ffb['status'](0x190)['json']({'success':![],'message':_0x4ac7c8(0x155)});const _0x3ce24a=await database_1[_0x4ac7c8(0x11f)][_0x4ac7c8(0x130)][_0x4ac7c8(0x12f)]({'where':{'id':_0x29caf7},'select':{'id':!![],'name':!![]}});if(!_0x3ce24a)return _0x307ffb['status'](0x194)[_0x4ac7c8(0x133)]({'success':![],'message':_0x4ac7c8(0x11c)});switch(type){case _0x4ac7c8(0x13e):const _0x5ae6bd={'id':_0x4ac7c8(0x121),'amount':_0x15abe5?.[_0x4ac7c8(0x12a)]||0x64,'currency':_0x15abe5?.[_0x4ac7c8(0x15e)]||_0x4ac7c8(0x158),'productName':_0x15abe5?.[_0x4ac7c8(0x146)]||_0x4ac7c8(0x14e),'gateway':_0x15abe5?.[_0x4ac7c8(0x152)]||_0x4ac7c8(0x123),'createdAt':new Date(),..._0x15abe5};await telegramBotService_1[_0x4ac7c8(0x125)][_0x4ac7c8(0x14a)](_0x29caf7,_0x5ae6bd,_0x4ac7c8(0x15c));break;case _0x4ac7c8(0x15d):const _0x34b6ec={'id':_0x4ac7c8(0x13b),'amount':_0x15abe5?.[_0x4ac7c8(0x12a)]||0x1f4,'method':_0x15abe5?.['method']||_0x4ac7c8(0x11e),'createdAt':new Date(),..._0x15abe5};await telegramBotService_1['telegramBotService'][_0x4ac7c8(0x148)](_0x29caf7,_0x34b6ec,_0x4ac7c8(0x149));break;case _0x4ac7c8(0x156):await telegramBotService_1[_0x4ac7c8(0x125)]['sendCustomNotification'](_0x29caf7,_0x15abe5?.[_0x4ac7c8(0x163)]||_0x4ac7c8(0x137),_0x15abe5?.['details']||{'message':_0x4ac7c8(0x14b)});break;default:return _0x307ffb['status'](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x307ffb[_0x4ac7c8(0x133)]({'success':!![],'message':'Test\x20'+type+_0x4ac7c8(0x14f)});}catch(_0x25c46c){_0x3a6057(_0x25c46c);}};}}exports[a12_0x3ba670(0x141)]=TelegramController;