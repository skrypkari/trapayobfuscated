'use strict';const a12_0xbc7748=a12_0x4816;(function(_0xf3a783,_0x5cd4bf){const _0x26f6c9=a12_0x4816,_0x1d42ce=_0xf3a783();while(!![]){try{const _0x15eae9=-parseInt(_0x26f6c9(0x147))/0x1*(-parseInt(_0x26f6c9(0x121))/0x2)+parseInt(_0x26f6c9(0x160))/0x3+parseInt(_0x26f6c9(0x133))/0x4*(parseInt(_0x26f6c9(0x157))/0x5)+parseInt(_0x26f6c9(0x159))/0x6*(-parseInt(_0x26f6c9(0x166))/0x7)+-parseInt(_0x26f6c9(0x13b))/0x8+parseInt(_0x26f6c9(0x14f))/0x9+-parseInt(_0x26f6c9(0x153))/0xa*(parseInt(_0x26f6c9(0x161))/0xb);if(_0x15eae9===_0x5cd4bf)break;else _0x1d42ce['push'](_0x1d42ce['shift']());}catch(_0x1ac89e){_0x1d42ce['push'](_0x1d42ce['shift']());}}}(a12_0x1d11,0x58371));function a12_0x4816(_0x3ee27e,_0x4846e1){const _0x1d1196=a12_0x1d11();return a12_0x4816=function(_0x4816e8,_0x53f1f3){_0x4816e8=_0x4816e8-0x11c;let _0xe9d6fb=_0x1d1196[_0x4816e8];return _0xe9d6fb;},a12_0x4816(_0x3ee27e,_0x4846e1);}var __importDefault=this&&this[a12_0xbc7748(0x14c)]||function(_0x566eec){const _0x49838d=a12_0xbc7748;return _0x566eec&&_0x566eec[_0x49838d(0x135)]?_0x566eec:{'default':_0x566eec};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a12_0xbc7748(0x136)]=void 0x0;const telegramBotService_1=require(a12_0xbc7748(0x14a)),database_1=__importDefault(require(a12_0xbc7748(0x132)));function a12_0x1d11(){const _0x28627f=['completed','240YjhEtD','productName','disconnectUser','USD','356945vNztTt','plisio','78iBiQAh','count','updatedAt','\x20notification\x20sent\x20successfully','shopId','Test\x20Product','User\x20disconnected\x20successfully','1241307keaiBU','359029chpDlR','sendBroadcast','update','lastName','payout','9471jIhyJL','desc','telegramId','telegramBotService','ceil','Broadcast\x20message\x20sent\x20successfully','test_payment_123','map','865078IJVSYD','username','Telegram\x20user\x20not\x20found','custom','test_payout_123','sendCustomNotification','paid','createdAt','sendTestNotification','findUnique','query','isActive','method','payment','default','getTelegramUsers','telegramUser','../config/database','20ZriLJb','findMany','__esModule','TelegramController','body','bank_transfer','amount','all','351080pKkWjW','true','length','filter','currency','details','status','Test\x20','getBotInfo','isVerified','json','Message\x20is\x20required','1AIePjO','Shop\x20ID\x20is\x20required','title','../services/telegramBotService','Markdown','__importDefault','shop','sendShopNotification','25974CPaFDm','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','This\x20is\x20a\x20test\x20notification'];a12_0x1d11=function(){return _0x28627f;};return a12_0x1d11();}class TelegramController{constructor(){const _0x169e4c=a12_0xbc7748;this['getBotStatus']=async(_0x137343,_0x3d0eef,_0x2cc353)=>{const _0x4216ab=a12_0x4816;try{const _0x535103=telegramBotService_1[_0x4216ab(0x11c)][_0x4216ab(0x143)](),_0x1d365d=await database_1[_0x4216ab(0x12f)][_0x4216ab(0x131)][_0x4216ab(0x15a)](),_0x2ce12a=await database_1[_0x4216ab(0x12f)][_0x4216ab(0x131)][_0x4216ab(0x15a)]({'where':{'isVerified':!![]}}),_0x313929=await database_1[_0x4216ab(0x12f)][_0x4216ab(0x131)]['groupBy']({'by':[_0x4216ab(0x15d)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3d0eef[_0x4216ab(0x145)]({'success':!![],'result':{'bot':{'isActive':_0x535103[_0x4216ab(0x12c)],'username':_0x535103[_0x4216ab(0x122)]},'statistics':{'totalUsers':_0x1d365d,'verifiedUsers':_0x2ce12a,'unverifiedUsers':_0x1d365d-_0x2ce12a,'connectedShops':_0x313929[_0x4216ab(0x13d)]}}});}catch(_0x16293f){_0x2cc353(_0x16293f);}},this[_0x169e4c(0x130)]=async(_0x55a97f,_0x3b67dd,_0x41446a)=>{const _0x24e671=_0x169e4c;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3cccdf}=_0x55a97f[_0x24e671(0x12b)],_0x159c9b=(Number(page)-0x1)*Number(limit),_0x9ba4ac={};_0x3cccdf!==undefined&&(_0x9ba4ac[_0x24e671(0x144)]=_0x3cccdf===_0x24e671(0x13c));const [_0x4dc7a2,_0x27cb1e]=await Promise[_0x24e671(0x13a)]([database_1[_0x24e671(0x12f)][_0x24e671(0x131)][_0x24e671(0x134)]({'where':_0x9ba4ac,'skip':_0x159c9b,'take':Number(limit),'orderBy':{'createdAt':_0x24e671(0x167)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x24e671(0x131)][_0x24e671(0x15a)]({'where':_0x9ba4ac})]);_0x3b67dd['json']({'success':!![],'users':_0x4dc7a2['map'](_0x39aad9=>({'id':_0x39aad9['id'],'telegramId':_0x39aad9[_0x24e671(0x168)],'username':_0x39aad9['username'],'firstName':_0x39aad9['firstName'],'lastName':_0x39aad9[_0x24e671(0x164)],'isVerified':_0x39aad9['isVerified'],'shop':_0x39aad9[_0x24e671(0x14d)],'createdAt':_0x39aad9[_0x24e671(0x128)],'updatedAt':_0x39aad9[_0x24e671(0x15b)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x27cb1e,'totalPages':Math[_0x24e671(0x11d)](_0x27cb1e/Number(limit))}});}catch(_0x39c621){_0x41446a(_0x39c621);}},this[_0x169e4c(0x162)]=async(_0x5da61e,_0x393437,_0x5da873)=>{const _0x118473=_0x169e4c;try{const {message:_0x14eddd,shopId:_0xe411e1}=_0x5da61e[_0x118473(0x137)];if(!_0x14eddd)return _0x393437[_0x118473(0x141)](0x190)[_0x118473(0x145)]({'success':![],'message':_0x118473(0x146)});if(_0xe411e1)await telegramBotService_1['telegramBotService'][_0x118473(0x14e)](_0xe411e1,_0x14eddd,{'parse_mode':_0x118473(0x14b)});else{const _0x3028af=await database_1[_0x118473(0x12f)][_0x118473(0x131)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x2626fc=[...new Set(_0x3028af[_0x118473(0x120)](_0x143a9e=>_0x143a9e[_0x118473(0x15d)])[_0x118473(0x13e)](Boolean))];for(const _0x5f40c5 of _0x2626fc){_0x5f40c5&&await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x5f40c5,_0x14eddd,{'parse_mode':'Markdown'});}}_0x393437[_0x118473(0x145)]({'success':!![],'message':_0x118473(0x11e)});}catch(_0x29636e){_0x5da873(_0x29636e);}},this[_0x169e4c(0x155)]=async(_0x3cda81,_0xd37e62,_0x49d3a9)=>{const _0x1a39c7=_0x169e4c;try{const {telegramId:_0x7e8ed9}=_0x3cda81['params'],_0x2478b8=await database_1['default'][_0x1a39c7(0x131)][_0x1a39c7(0x12a)]({'where':{'telegramId':_0x7e8ed9},'include':{'shop':!![]}});if(!_0x2478b8)return _0xd37e62[_0x1a39c7(0x141)](0x194)[_0x1a39c7(0x145)]({'success':![],'message':_0x1a39c7(0x123)});await database_1['default'][_0x1a39c7(0x131)][_0x1a39c7(0x163)]({'where':{'telegramId':_0x7e8ed9},'data':{'shopId':null,'isVerified':![]}}),_0xd37e62[_0x1a39c7(0x145)]({'success':!![],'message':_0x1a39c7(0x15f)});}catch(_0x24d59d){_0x49d3a9(_0x24d59d);}},this[_0x169e4c(0x129)]=async(_0x5b78ed,_0x582d44,_0x274f20)=>{const _0xf9a50a=_0x169e4c;try{const {shopId:_0x417df8,type:type=_0xf9a50a(0x12e),testData:_0x402f99}=_0x5b78ed[_0xf9a50a(0x137)];if(!_0x417df8)return _0x582d44[_0xf9a50a(0x141)](0x190)['json']({'success':![],'message':_0xf9a50a(0x148)});const _0x14bda7=await database_1['default'][_0xf9a50a(0x14d)]['findUnique']({'where':{'id':_0x417df8},'select':{'id':!![],'name':!![]}});if(!_0x14bda7)return _0x582d44[_0xf9a50a(0x141)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0xf9a50a(0x12e):const _0x167e1e={'id':_0xf9a50a(0x11f),'amount':_0x402f99?.[_0xf9a50a(0x139)]||0x64,'currency':_0x402f99?.[_0xf9a50a(0x13f)]||_0xf9a50a(0x156),'productName':_0x402f99?.[_0xf9a50a(0x154)]||_0xf9a50a(0x15e),'gateway':_0x402f99?.['gateway']||_0xf9a50a(0x158),'createdAt':new Date(),..._0x402f99};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x417df8,_0x167e1e,_0xf9a50a(0x127));break;case _0xf9a50a(0x165):const _0xea8221={'id':_0xf9a50a(0x125),'amount':_0x402f99?.[_0xf9a50a(0x139)]||0x1f4,'method':_0x402f99?.[_0xf9a50a(0x12d)]||_0xf9a50a(0x138),'createdAt':new Date(),..._0x402f99};await telegramBotService_1[_0xf9a50a(0x11c)]['sendPayoutNotification'](_0x417df8,_0xea8221,_0xf9a50a(0x152));break;case _0xf9a50a(0x124):await telegramBotService_1[_0xf9a50a(0x11c)][_0xf9a50a(0x126)](_0x417df8,_0x402f99?.[_0xf9a50a(0x149)]||'Test\x20Notification',_0x402f99?.[_0xf9a50a(0x140)]||{'message':_0xf9a50a(0x151)});break;default:return _0x582d44[_0xf9a50a(0x141)](0x190)[_0xf9a50a(0x145)]({'success':![],'message':_0xf9a50a(0x150)});}_0x582d44[_0xf9a50a(0x145)]({'success':!![],'message':_0xf9a50a(0x142)+type+_0xf9a50a(0x15c)});}catch(_0x591dd7){_0x274f20(_0x591dd7);}};}}exports[a12_0xbc7748(0x136)]=TelegramController;