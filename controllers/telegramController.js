'use strict';const a12_0x52f6f3=a12_0x45fa;(function(_0x40e24f,_0x4bd7d3){const _0xdf8d02=a12_0x45fa,_0x360580=_0x40e24f();while(!![]){try{const _0x241713=-parseInt(_0xdf8d02(0xed))/0x1*(-parseInt(_0xdf8d02(0xc4))/0x2)+parseInt(_0xdf8d02(0xc2))/0x3+parseInt(_0xdf8d02(0xb9))/0x4*(-parseInt(_0xdf8d02(0xc5))/0x5)+parseInt(_0xdf8d02(0xa6))/0x6*(parseInt(_0xdf8d02(0xee))/0x7)+-parseInt(_0xdf8d02(0xbf))/0x8*(parseInt(_0xdf8d02(0xb0))/0x9)+-parseInt(_0xdf8d02(0xec))/0xa*(-parseInt(_0xdf8d02(0xe2))/0xb)+-parseInt(_0xdf8d02(0xb3))/0xc*(parseInt(_0xdf8d02(0xd9))/0xd);if(_0x241713===_0x4bd7d3)break;else _0x360580['push'](_0x360580['shift']());}catch(_0x44b806){_0x360580['push'](_0x360580['shift']());}}}(a12_0x274b,0x6d175));var __importDefault=this&&this[a12_0x52f6f3(0xb6)]||function(_0x3f994b){const _0x38319a=a12_0x52f6f3;return _0x3f994b&&_0x3f994b[_0x38319a(0xb7)]?_0x3f994b:{'default':_0x3f994b};};function a12_0x274b(){const _0x3f0c0e=['3771490QAEnxH','8VIvwid','7BurAIb','test_payout_123','params','1467456RcZiCZ','all','Test\x20Notification','currency','Shop\x20not\x20found','sendPayoutNotification','update','filter','shop','body','36XmilEo','telegramUser','createdAt','60Svdcru','true','firstName','__importDefault','__esModule','shopId','2489860DTrDbV','Message\x20is\x20required','sendBroadcast','title','../config/database','sendPaymentNotification','1291568gjhIVv','json','map','1225197TwYMaB','lastName','180548ndFqHf','5RIXdWK','updatedAt','Shop\x20ID\x20is\x20required','amount','desc','payment','telegramBotService','findMany','\x20notification\x20sent\x20successfully','bank_transfer','payout','details','method','This\x20is\x20a\x20test\x20notification','Test\x20Product','USD','getBotInfo','status','findUnique','defineProperty','96798fAGsKV','Telegram\x20user\x20not\x20found','groupBy','disconnectUser','completed','getBotStatus','isVerified','Broadcast\x20message\x20sent\x20successfully','count','11RVHqGg','plisio','TelegramController','username','sendTestNotification','sendShopNotification','length','Test\x20','User\x20disconnected\x20successfully','default'];a12_0x274b=function(){return _0x3f0c0e;};return a12_0x274b();}Object[a12_0x52f6f3(0xd8)](exports,a12_0x52f6f3(0xb7),{'value':!![]}),exports[a12_0x52f6f3(0xe4)]=void 0x0;function a12_0x45fa(_0x448adf,_0x3a9618){const _0x274b50=a12_0x274b();return a12_0x45fa=function(_0x45fa9e,_0x286ceb){_0x45fa9e=_0x45fa9e-0xa5;let _0x48c528=_0x274b50[_0x45fa9e];return _0x48c528;},a12_0x45fa(_0x448adf,_0x3a9618);}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x52f6f3(0xbd)));class TelegramController{constructor(){const _0x404ef8=a12_0x52f6f3;this[_0x404ef8(0xde)]=async(_0x46e288,_0x52a62b,_0x556ac9)=>{const _0x5c3170=_0x404ef8;try{const _0x5b2f72=telegramBotService_1['telegramBotService'][_0x5c3170(0xd5)](),_0x57567e=await database_1['default'][_0x5c3170(0xb1)][_0x5c3170(0xe1)](),_0x5e62f3=await database_1[_0x5c3170(0xeb)]['telegramUser'][_0x5c3170(0xe1)]({'where':{'isVerified':!![]}}),_0x1daf58=await database_1['default'][_0x5c3170(0xb1)][_0x5c3170(0xdb)]({'by':[_0x5c3170(0xb8)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x52a62b[_0x5c3170(0xc0)]({'success':!![],'result':{'bot':{'isActive':_0x5b2f72['isActive'],'username':_0x5b2f72[_0x5c3170(0xe5)]},'statistics':{'totalUsers':_0x57567e,'verifiedUsers':_0x5e62f3,'unverifiedUsers':_0x57567e-_0x5e62f3,'connectedShops':_0x1daf58[_0x5c3170(0xe8)]}}});}catch(_0x5c420c){_0x556ac9(_0x5c420c);}},this['getTelegramUsers']=async(_0x558dd9,_0xd3f4fb,_0x594ad7)=>{const _0x3f7525=_0x404ef8;try{const {page:page=0x1,limit:limit=0x14,verified:_0x197e82}=_0x558dd9['query'],_0x324e3a=(Number(page)-0x1)*Number(limit),_0x9b48ba={};_0x197e82!==undefined&&(_0x9b48ba[_0x3f7525(0xdf)]=_0x197e82===_0x3f7525(0xb4));const [_0x3c31cb,_0xd8e708]=await Promise[_0x3f7525(0xa7)]([database_1[_0x3f7525(0xeb)]['telegramUser']['findMany']({'where':_0x9b48ba,'skip':_0x324e3a,'take':Number(limit),'orderBy':{'createdAt':_0x3f7525(0xc9)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x3f7525(0xb1)][_0x3f7525(0xe1)]({'where':_0x9b48ba})]);_0xd3f4fb['json']({'success':!![],'users':_0x3c31cb[_0x3f7525(0xc1)](_0x3f70f2=>({'id':_0x3f70f2['id'],'telegramId':_0x3f70f2['telegramId'],'username':_0x3f70f2[_0x3f7525(0xe5)],'firstName':_0x3f70f2[_0x3f7525(0xb5)],'lastName':_0x3f70f2[_0x3f7525(0xc3)],'isVerified':_0x3f70f2['isVerified'],'shop':_0x3f70f2[_0x3f7525(0xae)],'createdAt':_0x3f70f2[_0x3f7525(0xb2)],'updatedAt':_0x3f70f2[_0x3f7525(0xc6)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xd8e708,'totalPages':Math['ceil'](_0xd8e708/Number(limit))}});}catch(_0x1a0415){_0x594ad7(_0x1a0415);}},this[_0x404ef8(0xbb)]=async(_0x4841e8,_0x5d4648,_0x1351da)=>{const _0x3a11cb=_0x404ef8;try{const {message:_0x1bdba9,shopId:_0x368b1a}=_0x4841e8[_0x3a11cb(0xaf)];if(!_0x1bdba9)return _0x5d4648[_0x3a11cb(0xd6)](0x190)[_0x3a11cb(0xc0)]({'success':![],'message':_0x3a11cb(0xba)});if(_0x368b1a)await telegramBotService_1[_0x3a11cb(0xcb)][_0x3a11cb(0xe7)](_0x368b1a,_0x1bdba9,{'parse_mode':'Markdown'});else{const _0x101077=await database_1[_0x3a11cb(0xeb)][_0x3a11cb(0xb1)][_0x3a11cb(0xcc)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x37cbed=[...new Set(_0x101077[_0x3a11cb(0xc1)](_0x56957d=>_0x56957d[_0x3a11cb(0xb8)])[_0x3a11cb(0xad)](Boolean))];for(const _0x358aab of _0x37cbed){_0x358aab&&await telegramBotService_1['telegramBotService'][_0x3a11cb(0xe7)](_0x358aab,_0x1bdba9,{'parse_mode':'Markdown'});}}_0x5d4648['json']({'success':!![],'message':_0x3a11cb(0xe0)});}catch(_0x4a043a){_0x1351da(_0x4a043a);}},this[_0x404ef8(0xdc)]=async(_0x5ad953,_0x4a6bc4,_0x1fa475)=>{const _0x350d7d=_0x404ef8;try{const {telegramId:_0x10856a}=_0x5ad953[_0x350d7d(0xa5)],_0x310c12=await database_1[_0x350d7d(0xeb)][_0x350d7d(0xb1)]['findUnique']({'where':{'telegramId':_0x10856a},'include':{'shop':!![]}});if(!_0x310c12)return _0x4a6bc4[_0x350d7d(0xd6)](0x194)[_0x350d7d(0xc0)]({'success':![],'message':_0x350d7d(0xda)});await database_1['default']['telegramUser'][_0x350d7d(0xac)]({'where':{'telegramId':_0x10856a},'data':{'shopId':null,'isVerified':![]}}),_0x4a6bc4[_0x350d7d(0xc0)]({'success':!![],'message':_0x350d7d(0xea)});}catch(_0x199e53){_0x1fa475(_0x199e53);}},this[_0x404ef8(0xe6)]=async(_0x378581,_0x41b93f,_0x407bfb)=>{const _0xbfb260=_0x404ef8;try{const {shopId:_0x5ae648,type:type=_0xbfb260(0xca),testData:_0x53044e}=_0x378581['body'];if(!_0x5ae648)return _0x41b93f[_0xbfb260(0xd6)](0x190)['json']({'success':![],'message':_0xbfb260(0xc7)});const _0x1a72b2=await database_1[_0xbfb260(0xeb)][_0xbfb260(0xae)][_0xbfb260(0xd7)]({'where':{'id':_0x5ae648},'select':{'id':!![],'name':!![]}});if(!_0x1a72b2)return _0x41b93f['status'](0x194)[_0xbfb260(0xc0)]({'success':![],'message':_0xbfb260(0xaa)});switch(type){case'payment':const _0x27fccf={'id':'test_payment_123','amount':_0x53044e?.[_0xbfb260(0xc8)]||0x64,'currency':_0x53044e?.[_0xbfb260(0xa9)]||_0xbfb260(0xd4),'productName':_0x53044e?.['productName']||_0xbfb260(0xd3),'gateway':_0x53044e?.['gateway']||_0xbfb260(0xe3),'createdAt':new Date(),..._0x53044e};await telegramBotService_1['telegramBotService'][_0xbfb260(0xbe)](_0x5ae648,_0x27fccf,'paid');break;case _0xbfb260(0xcf):const _0x5d87ed={'id':_0xbfb260(0xef),'amount':_0x53044e?.[_0xbfb260(0xc8)]||0x1f4,'method':_0x53044e?.[_0xbfb260(0xd1)]||_0xbfb260(0xce),'createdAt':new Date(),..._0x53044e};await telegramBotService_1['telegramBotService'][_0xbfb260(0xab)](_0x5ae648,_0x5d87ed,_0xbfb260(0xdd));break;case'custom':await telegramBotService_1[_0xbfb260(0xcb)]['sendCustomNotification'](_0x5ae648,_0x53044e?.[_0xbfb260(0xbc)]||_0xbfb260(0xa8),_0x53044e?.[_0xbfb260(0xd0)]||{'message':_0xbfb260(0xd2)});break;default:return _0x41b93f['status'](0x190)[_0xbfb260(0xc0)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x41b93f[_0xbfb260(0xc0)]({'success':!![],'message':_0xbfb260(0xe9)+type+_0xbfb260(0xcd)});}catch(_0x3b1a54){_0x407bfb(_0x3b1a54);}};}}exports['TelegramController']=TelegramController;