'use strict';const a13_0x3690e5=a13_0x4ada;function a13_0x4ada(_0x2eeb6f,_0xad4725){const _0x69d019=a13_0x69d0();return a13_0x4ada=function(_0x4ada0d,_0x42c3ec){_0x4ada0d=_0x4ada0d-0x15d;let _0x57b409=_0x69d019[_0x4ada0d];return _0x57b409;},a13_0x4ada(_0x2eeb6f,_0xad4725);}function a13_0x69d0(){const _0x24af02=['1662XTZMPP','Test\x20Notification','default','count','telegramUser','telegramId','disconnectUser','Test\x20','../services/telegramBotService','filter','bank_transfer','findUnique','details','2705942KYbIlm','USD','11812437yludsD','sendBroadcast','custom','lastName','telegramBotService','json','body','all','__esModule','updatedAt','status','\x20notification\x20sent\x20successfully','plisio','13293QHsLzS','username','2192uxDHoH','2008272dDTCdg','test_payment_123','getTelegramUsers','ceil','productName','amount','payment','map','update','shop','paid','test_payout_123','gateway','sendCustomNotification','length','TelegramController','User\x20disconnected\x20successfully','848679eDbENl','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','sendPaymentNotification','desc','Test\x20Product','firstName','2296AGPWxo','defineProperty','getBotStatus','isActive','method','isVerified','7995930KfcMyU','shopId','sendShopNotification','Markdown','params','Message\x20is\x20required','__importDefault','completed','This\x20is\x20a\x20test\x20notification','Shop\x20not\x20found','getBotInfo','findMany'];a13_0x69d0=function(){return _0x24af02;};return a13_0x69d0();}(function(_0x4ba334,_0x5e2b98){const _0x17ef27=a13_0x4ada,_0x403198=_0x4ba334();while(!![]){try{const _0x1f31a4=-parseInt(_0x17ef27(0x15f))/0x1+-parseInt(_0x17ef27(0x184))/0x2+-parseInt(_0x17ef27(0x177))/0x3*(parseInt(_0x17ef27(0x195))/0x4)+parseInt(_0x17ef27(0x16b))/0x5+-parseInt(_0x17ef27(0x196))/0x6+parseInt(_0x17ef27(0x186))/0x7+-parseInt(_0x17ef27(0x165))/0x8*(-parseInt(_0x17ef27(0x193))/0x9);if(_0x1f31a4===_0x5e2b98)break;else _0x403198['push'](_0x403198['shift']());}catch(_0x50f06a){_0x403198['push'](_0x403198['shift']());}}}(a13_0x69d0,0xd48de));var __importDefault=this&&this[a13_0x3690e5(0x171)]||function(_0x20b57b){const _0x19ca34=a13_0x3690e5;return _0x20b57b&&_0x20b57b[_0x19ca34(0x18e)]?_0x20b57b:{'default':_0x20b57b};};Object[a13_0x3690e5(0x166)](exports,a13_0x3690e5(0x18e),{'value':!![]}),exports[a13_0x3690e5(0x15d)]=void 0x0;const telegramBotService_1=require(a13_0x3690e5(0x17f)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0xd65645=a13_0x3690e5;this[_0xd65645(0x167)]=async(_0x21a397,_0x103f26,_0x317b22)=>{const _0x511ff9=_0xd65645;try{const _0x39d8ee=telegramBotService_1[_0x511ff9(0x18a)][_0x511ff9(0x175)](),_0x1be1ba=await database_1[_0x511ff9(0x179)][_0x511ff9(0x17b)]['count'](),_0x96faa1=await database_1[_0x511ff9(0x179)]['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x353c5e=await database_1[_0x511ff9(0x179)][_0x511ff9(0x17b)]['groupBy']({'by':[_0x511ff9(0x16c)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x103f26[_0x511ff9(0x18b)]({'success':!![],'result':{'bot':{'isActive':_0x39d8ee[_0x511ff9(0x168)],'username':_0x39d8ee['username']},'statistics':{'totalUsers':_0x1be1ba,'verifiedUsers':_0x96faa1,'unverifiedUsers':_0x1be1ba-_0x96faa1,'connectedShops':_0x353c5e[_0x511ff9(0x1a4)]}}});}catch(_0x7e8c64){_0x317b22(_0x7e8c64);}},this[_0xd65645(0x198)]=async(_0x5e11ee,_0x222ee2,_0x7e52be)=>{const _0x413f22=_0xd65645;try{const {page:page=0x1,limit:limit=0x14,verified:_0x96001b}=_0x5e11ee['query'],_0x49a355=(Number(page)-0x1)*Number(limit),_0x6f1868={};_0x96001b!==undefined&&(_0x6f1868[_0x413f22(0x16a)]=_0x96001b==='true');const [_0x421895,_0xc6174b]=await Promise[_0x413f22(0x18d)]([database_1['default'][_0x413f22(0x17b)][_0x413f22(0x176)]({'where':_0x6f1868,'skip':_0x49a355,'take':Number(limit),'orderBy':{'createdAt':_0x413f22(0x162)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x413f22(0x179)][_0x413f22(0x17b)][_0x413f22(0x17a)]({'where':_0x6f1868})]);_0x222ee2[_0x413f22(0x18b)]({'success':!![],'users':_0x421895[_0x413f22(0x19d)](_0x2e2cbc=>({'id':_0x2e2cbc['id'],'telegramId':_0x2e2cbc[_0x413f22(0x17c)],'username':_0x2e2cbc[_0x413f22(0x194)],'firstName':_0x2e2cbc[_0x413f22(0x164)],'lastName':_0x2e2cbc[_0x413f22(0x189)],'isVerified':_0x2e2cbc[_0x413f22(0x16a)],'shop':_0x2e2cbc[_0x413f22(0x19f)],'createdAt':_0x2e2cbc['createdAt'],'updatedAt':_0x2e2cbc[_0x413f22(0x18f)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xc6174b,'totalPages':Math[_0x413f22(0x199)](_0xc6174b/Number(limit))}});}catch(_0x21d00f){_0x7e52be(_0x21d00f);}},this[_0xd65645(0x187)]=async(_0x2123f8,_0x113169,_0x502c14)=>{const _0x23f749=_0xd65645;try{const {message:_0x975065,shopId:_0x1ac9e3}=_0x2123f8['body'];if(!_0x975065)return _0x113169[_0x23f749(0x190)](0x190)['json']({'success':![],'message':_0x23f749(0x170)});if(_0x1ac9e3)await telegramBotService_1[_0x23f749(0x18a)][_0x23f749(0x16d)](_0x1ac9e3,_0x975065,{'parse_mode':'Markdown'});else{const _0x20cd1d=await database_1['default'][_0x23f749(0x17b)][_0x23f749(0x176)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3ea0a4=[...new Set(_0x20cd1d[_0x23f749(0x19d)](_0x50b2af=>_0x50b2af[_0x23f749(0x16c)])[_0x23f749(0x180)](Boolean))];for(const _0x3f3c85 of _0x3ea0a4){_0x3f3c85&&await telegramBotService_1[_0x23f749(0x18a)][_0x23f749(0x16d)](_0x3f3c85,_0x975065,{'parse_mode':_0x23f749(0x16e)});}}_0x113169[_0x23f749(0x18b)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x24952c){_0x502c14(_0x24952c);}},this[_0xd65645(0x17d)]=async(_0x3f1258,_0x34a5b3,_0x29af30)=>{const _0x179764=_0xd65645;try{const {telegramId:_0x1c6854}=_0x3f1258[_0x179764(0x16f)],_0x4ac12b=await database_1[_0x179764(0x179)][_0x179764(0x17b)][_0x179764(0x182)]({'where':{'telegramId':_0x1c6854},'include':{'shop':!![]}});if(!_0x4ac12b)return _0x34a5b3[_0x179764(0x190)](0x194)[_0x179764(0x18b)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x179764(0x179)][_0x179764(0x17b)][_0x179764(0x19e)]({'where':{'telegramId':_0x1c6854},'data':{'shopId':null,'isVerified':![]}}),_0x34a5b3['json']({'success':!![],'message':_0x179764(0x15e)});}catch(_0x22db06){_0x29af30(_0x22db06);}},this['sendTestNotification']=async(_0x20c631,_0x49f8f5,_0x56b76e)=>{const _0x118ef8=_0xd65645;try{const {shopId:_0x4c84b1,type:type=_0x118ef8(0x19c),testData:_0x1a04a7}=_0x20c631[_0x118ef8(0x18c)];if(!_0x4c84b1)return _0x49f8f5['status'](0x190)[_0x118ef8(0x18b)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x21afcd=await database_1[_0x118ef8(0x179)]['shop'][_0x118ef8(0x182)]({'where':{'id':_0x4c84b1},'select':{'id':!![],'name':!![]}});if(!_0x21afcd)return _0x49f8f5[_0x118ef8(0x190)](0x194)[_0x118ef8(0x18b)]({'success':![],'message':_0x118ef8(0x174)});switch(type){case _0x118ef8(0x19c):const _0x1cd12c={'id':_0x118ef8(0x197),'amount':_0x1a04a7?.[_0x118ef8(0x19b)]||0x64,'currency':_0x1a04a7?.['currency']||_0x118ef8(0x185),'productName':_0x1a04a7?.[_0x118ef8(0x19a)]||_0x118ef8(0x163),'gateway':_0x1a04a7?.[_0x118ef8(0x1a2)]||_0x118ef8(0x192),'createdAt':new Date(),..._0x1a04a7};await telegramBotService_1[_0x118ef8(0x18a)][_0x118ef8(0x161)](_0x4c84b1,_0x1cd12c,_0x118ef8(0x1a0));break;case'payout':const _0x39f814={'id':_0x118ef8(0x1a1),'amount':_0x1a04a7?.[_0x118ef8(0x19b)]||0x1f4,'method':_0x1a04a7?.[_0x118ef8(0x169)]||_0x118ef8(0x181),'createdAt':new Date(),..._0x1a04a7};await telegramBotService_1[_0x118ef8(0x18a)]['sendPayoutNotification'](_0x4c84b1,_0x39f814,_0x118ef8(0x172));break;case _0x118ef8(0x188):await telegramBotService_1[_0x118ef8(0x18a)][_0x118ef8(0x1a3)](_0x4c84b1,_0x1a04a7?.['title']||_0x118ef8(0x178),_0x1a04a7?.[_0x118ef8(0x183)]||{'message':_0x118ef8(0x173)});break;default:return _0x49f8f5[_0x118ef8(0x190)](0x190)[_0x118ef8(0x18b)]({'success':![],'message':_0x118ef8(0x160)});}_0x49f8f5['json']({'success':!![],'message':_0x118ef8(0x17e)+type+_0x118ef8(0x191)});}catch(_0x259e2a){_0x56b76e(_0x259e2a);}};}}exports[a13_0x3690e5(0x15d)]=TelegramController;