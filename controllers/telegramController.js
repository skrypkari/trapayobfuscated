'use strict';function a12_0x5861(_0x1d8519,_0x55feeb){const _0x103f93=a12_0x103f();return a12_0x5861=function(_0x58613d,_0x425912){_0x58613d=_0x58613d-0xb2;let _0x17a287=_0x103f93[_0x58613d];return _0x17a287;},a12_0x5861(_0x1d8519,_0x55feeb);}const a12_0x275a48=a12_0x5861;(function(_0x3d968a,_0x56e86c){const _0x38679e=a12_0x5861,_0x366352=_0x3d968a();while(!![]){try{const _0x4ebdf0=-parseInt(_0x38679e(0xd9))/0x1+parseInt(_0x38679e(0xc6))/0x2+-parseInt(_0x38679e(0xb3))/0x3+-parseInt(_0x38679e(0xb5))/0x4*(parseInt(_0x38679e(0xb8))/0x5)+-parseInt(_0x38679e(0xd8))/0x6+parseInt(_0x38679e(0xc7))/0x7+parseInt(_0x38679e(0xe7))/0x8;if(_0x4ebdf0===_0x56e86c)break;else _0x366352['push'](_0x366352['shift']());}catch(_0x40bb2d){_0x366352['push'](_0x366352['shift']());}}}(a12_0x103f,0x39f76));var __importDefault=this&&this[a12_0x275a48(0xd6)]||function(_0x50d285){return _0x50d285&&_0x50d285['__esModule']?_0x50d285:{'default':_0x50d285};};function a12_0x103f(){const _0x56317f=['916640ytjDjp','2449566HplFhx','title','sendPaymentNotification','telegramBotService','payment','firstName','Markdown','disconnectUser','TelegramController','update','length','details','payout','Shop\x20ID\x20is\x20required','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','__importDefault','Message\x20is\x20required','1196814edMSZU','77111ESpJhG','isActive','This\x20is\x20a\x20test\x20notification','query','isVerified','shop','sendShopNotification','count','\x20notification\x20sent\x20successfully','telegramId','Broadcast\x20message\x20sent\x20successfully','currency','params','completed','2253616vyCkhh','bank_transfer','all','Test\x20','getTelegramUsers','test_payment_123','map','username','defineProperty','filter','Test\x20Notification','amount','Test\x20Product','sendPayoutNotification','updatedAt','sendTestNotification','385176xoHrtb','shopId','1164kxWxTo','__esModule','sendCustomNotification','7690sFRMIq','telegramUser','findMany','test_payout_123','createdAt','json','../config/database','true','USD','gateway','plisio','status','default','sendBroadcast'];a12_0x103f=function(){return _0x56317f;};return a12_0x103f();}Object[a12_0x275a48(0xef)](exports,a12_0x275a48(0xb6),{'value':!![]}),exports[a12_0x275a48(0xcf)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x275a48(0xbe)));class TelegramController{constructor(){const _0x4d87ee=a12_0x275a48;this['getBotStatus']=async(_0x504699,_0x5b62ca,_0x145d58)=>{const _0x4feba1=a12_0x5861;try{const _0x2fe2f3=telegramBotService_1[_0x4feba1(0xca)]['getBotInfo'](),_0x5c6471=await database_1[_0x4feba1(0xc4)][_0x4feba1(0xb9)][_0x4feba1(0xe0)](),_0x12f845=await database_1[_0x4feba1(0xc4)][_0x4feba1(0xb9)]['count']({'where':{'isVerified':!![]}}),_0x1b6ee2=await database_1['default']['telegramUser']['groupBy']({'by':[_0x4feba1(0xb4)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5b62ca[_0x4feba1(0xbd)]({'success':!![],'result':{'bot':{'isActive':_0x2fe2f3[_0x4feba1(0xda)],'username':_0x2fe2f3['username']},'statistics':{'totalUsers':_0x5c6471,'verifiedUsers':_0x12f845,'unverifiedUsers':_0x5c6471-_0x12f845,'connectedShops':_0x1b6ee2[_0x4feba1(0xd1)]}}});}catch(_0xa76640){_0x145d58(_0xa76640);}},this[_0x4d87ee(0xeb)]=async(_0x3daa0d,_0x2d5920,_0x5f5167)=>{const _0x10dbda=_0x4d87ee;try{const {page:page=0x1,limit:limit=0x14,verified:_0x451ace}=_0x3daa0d[_0x10dbda(0xdc)],_0x5df18e=(Number(page)-0x1)*Number(limit),_0x3381e={};_0x451ace!==undefined&&(_0x3381e[_0x10dbda(0xdd)]=_0x451ace===_0x10dbda(0xbf));const [_0x397f61,_0x3eec77]=await Promise[_0x10dbda(0xe9)]([database_1[_0x10dbda(0xc4)]['telegramUser']['findMany']({'where':_0x3381e,'skip':_0x5df18e,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x10dbda(0xc4)][_0x10dbda(0xb9)][_0x10dbda(0xe0)]({'where':_0x3381e})]);_0x2d5920[_0x10dbda(0xbd)]({'success':!![],'users':_0x397f61['map'](_0x9547e1=>({'id':_0x9547e1['id'],'telegramId':_0x9547e1[_0x10dbda(0xe2)],'username':_0x9547e1[_0x10dbda(0xee)],'firstName':_0x9547e1[_0x10dbda(0xcc)],'lastName':_0x9547e1['lastName'],'isVerified':_0x9547e1[_0x10dbda(0xdd)],'shop':_0x9547e1[_0x10dbda(0xde)],'createdAt':_0x9547e1[_0x10dbda(0xbc)],'updatedAt':_0x9547e1[_0x10dbda(0xf5)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3eec77,'totalPages':Math['ceil'](_0x3eec77/Number(limit))}});}catch(_0x28d2f8){_0x5f5167(_0x28d2f8);}},this[_0x4d87ee(0xc5)]=async(_0x2f3634,_0x2f2109,_0x5091cc)=>{const _0x2fb5b3=_0x4d87ee;try{const {message:_0x3725ef,shopId:_0x28b22c}=_0x2f3634['body'];if(!_0x3725ef)return _0x2f2109[_0x2fb5b3(0xc3)](0x190)['json']({'success':![],'message':_0x2fb5b3(0xd7)});if(_0x28b22c)await telegramBotService_1['telegramBotService'][_0x2fb5b3(0xdf)](_0x28b22c,_0x3725ef,{'parse_mode':_0x2fb5b3(0xcd)});else{const _0xb8fa49=await database_1[_0x2fb5b3(0xc4)][_0x2fb5b3(0xb9)][_0x2fb5b3(0xba)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3bd4ca=[...new Set(_0xb8fa49[_0x2fb5b3(0xed)](_0x5869fb=>_0x5869fb[_0x2fb5b3(0xb4)])[_0x2fb5b3(0xf0)](Boolean))];for(const _0x57b431 of _0x3bd4ca){_0x57b431&&await telegramBotService_1[_0x2fb5b3(0xca)][_0x2fb5b3(0xdf)](_0x57b431,_0x3725ef,{'parse_mode':_0x2fb5b3(0xcd)});}}_0x2f2109['json']({'success':!![],'message':_0x2fb5b3(0xe3)});}catch(_0x3a637d){_0x5091cc(_0x3a637d);}},this[_0x4d87ee(0xce)]=async(_0x1d80b1,_0x2b02e5,_0x460509)=>{const _0x48acec=_0x4d87ee;try{const {telegramId:_0x195860}=_0x1d80b1[_0x48acec(0xe5)],_0x1032ba=await database_1[_0x48acec(0xc4)][_0x48acec(0xb9)]['findUnique']({'where':{'telegramId':_0x195860},'include':{'shop':!![]}});if(!_0x1032ba)return _0x2b02e5[_0x48acec(0xc3)](0x194)[_0x48acec(0xbd)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1[_0x48acec(0xc4)][_0x48acec(0xb9)][_0x48acec(0xd0)]({'where':{'telegramId':_0x195860},'data':{'shopId':null,'isVerified':![]}}),_0x2b02e5['json']({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x110d4c){_0x460509(_0x110d4c);}},this[_0x4d87ee(0xb2)]=async(_0x4cc265,_0x1450b9,_0x1a4292)=>{const _0xb78202=_0x4d87ee;try{const {shopId:_0x26f34b,type:type=_0xb78202(0xcb),testData:_0x1e197c}=_0x4cc265['body'];if(!_0x26f34b)return _0x1450b9[_0xb78202(0xc3)](0x190)[_0xb78202(0xbd)]({'success':![],'message':_0xb78202(0xd4)});const _0x378102=await database_1[_0xb78202(0xc4)][_0xb78202(0xde)]['findUnique']({'where':{'id':_0x26f34b},'select':{'id':!![],'name':!![]}});if(!_0x378102)return _0x1450b9[_0xb78202(0xc3)](0x194)[_0xb78202(0xbd)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0xb78202(0xcb):const _0x4b95fc={'id':_0xb78202(0xec),'amount':_0x1e197c?.[_0xb78202(0xf2)]||0x64,'currency':_0x1e197c?.[_0xb78202(0xe4)]||_0xb78202(0xc0),'productName':_0x1e197c?.['productName']||_0xb78202(0xf3),'gateway':_0x1e197c?.[_0xb78202(0xc1)]||_0xb78202(0xc2),'createdAt':new Date(),..._0x1e197c};await telegramBotService_1[_0xb78202(0xca)][_0xb78202(0xc9)](_0x26f34b,_0x4b95fc,'paid');break;case _0xb78202(0xd3):const _0x2ab36b={'id':_0xb78202(0xbb),'amount':_0x1e197c?.['amount']||0x1f4,'method':_0x1e197c?.['method']||_0xb78202(0xe8),'createdAt':new Date(),..._0x1e197c};await telegramBotService_1[_0xb78202(0xca)][_0xb78202(0xf4)](_0x26f34b,_0x2ab36b,_0xb78202(0xe6));break;case'custom':await telegramBotService_1[_0xb78202(0xca)][_0xb78202(0xb7)](_0x26f34b,_0x1e197c?.[_0xb78202(0xc8)]||_0xb78202(0xf1),_0x1e197c?.[_0xb78202(0xd2)]||{'message':_0xb78202(0xdb)});break;default:return _0x1450b9['status'](0x190)[_0xb78202(0xbd)]({'success':![],'message':_0xb78202(0xd5)});}_0x1450b9[_0xb78202(0xbd)]({'success':!![],'message':_0xb78202(0xea)+type+_0xb78202(0xe1)});}catch(_0x1402dc){_0x1a4292(_0x1402dc);}};}}exports[a12_0x275a48(0xcf)]=TelegramController;