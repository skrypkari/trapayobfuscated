'use strict';const a17_0x4d54f2=a17_0x1073;(function(_0xf33383,_0x14e342){const _0x388fa5=a17_0x1073,_0x39b69c=_0xf33383();while(!![]){try{const _0x119a69=-parseInt(_0x388fa5(0x154))/0x1+parseInt(_0x388fa5(0x15b))/0x2+-parseInt(_0x388fa5(0x169))/0x3+-parseInt(_0x388fa5(0x176))/0x4*(parseInt(_0x388fa5(0x18c))/0x5)+-parseInt(_0x388fa5(0x18d))/0x6*(parseInt(_0x388fa5(0x14f))/0x7)+parseInt(_0x388fa5(0x18e))/0x8*(parseInt(_0x388fa5(0x170))/0x9)+-parseInt(_0x388fa5(0x194))/0xa*(-parseInt(_0x388fa5(0x16b))/0xb);if(_0x119a69===_0x14e342)break;else _0x39b69c['push'](_0x39b69c['shift']());}catch(_0x1150b0){_0x39b69c['push'](_0x39b69c['shift']());}}}(a17_0x439a,0x4b811));var __importDefault=this&&this['__importDefault']||function(_0xe175d1){const _0x4deea7=a17_0x1073;return _0xe175d1&&_0xe175d1[_0x4deea7(0x163)]?_0xe175d1:{'default':_0xe175d1};};function a17_0x439a(){const _0x165425=['count','Test\x20','all','payment','Telegram\x20user\x20not\x20found','1696200GlMEkF','true','1133GvnLMM','findUnique','isVerified','This\x20is\x20a\x20test\x20notification','shopId','9JGzmcW','json','default','defineProperty','USD','gateway','56AfhGSL','getTelegramUsers','Markdown','shop','createdAt','title','plisio','currency','telegramBotService','\x20notification\x20sent\x20successfully','custom','sendBroadcast','updatedAt','TRC20','update','sendShopNotification','groupBy','network','body','findMany','../services/telegramBotService','payout','69635oFeedu','18NPkpeY','3743704yZqyTm','ceil','sendPaymentNotification','getBotInfo','paid','details','68170gOZzNX','sendPayoutNotification','Тестовый\x20период','User\x20disconnected\x20successfully','Test\x20Notification','txid','Shop\x20ID\x20is\x20required','Test\x20Product','1291913QtDccz','length','telegramId','test_payment_123','sendTestNotification','120027IdndpW','telegramUser','Broadcast\x20message\x20sent\x20successfully','getBotStatus','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','desc','status','1146466CmTGdy','Shop\x20not\x20found','filter','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','sendCustomNotification','username','map','amount','__esModule'];a17_0x439a=function(){return _0x165425;};return a17_0x439a();}Object[a17_0x4d54f2(0x173)](exports,'__esModule',{'value':!![]}),exports['TelegramController']=void 0x0;function a17_0x1073(_0xf59108,_0x39abee){_0xf59108=_0xf59108-0x14a;const _0x439ae6=a17_0x439a();let _0x1073c4=_0x439ae6[_0xf59108];return _0x1073c4;}const telegramBotService_1=require(a17_0x4d54f2(0x18a)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x5090c3=a17_0x4d54f2;this[_0x5090c3(0x157)]=async(_0x1ec5b6,_0xd1572e,_0x496a88)=>{const _0x77ab0f=_0x5090c3;try{const _0x1c9436=telegramBotService_1[_0x77ab0f(0x17e)][_0x77ab0f(0x191)](),_0x46adea=await database_1[_0x77ab0f(0x172)][_0x77ab0f(0x155)][_0x77ab0f(0x164)](),_0xc2d670=await database_1[_0x77ab0f(0x172)][_0x77ab0f(0x155)][_0x77ab0f(0x164)]({'where':{'isVerified':!![]}}),_0x1bf241=await database_1[_0x77ab0f(0x172)][_0x77ab0f(0x155)][_0x77ab0f(0x186)]({'by':[_0x77ab0f(0x16f)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xd1572e[_0x77ab0f(0x171)]({'success':!![],'result':{'bot':{'isActive':_0x1c9436['isActive'],'username':_0x1c9436[_0x77ab0f(0x160)]},'statistics':{'totalUsers':_0x46adea,'verifiedUsers':_0xc2d670,'unverifiedUsers':_0x46adea-_0xc2d670,'connectedShops':_0x1bf241[_0x77ab0f(0x150)]}}});}catch(_0x38756e){_0x496a88(_0x38756e);}},this[_0x5090c3(0x177)]=async(_0x5ad9db,_0x489d06,_0x4278aa)=>{const _0x42f295=_0x5090c3;try{const {page:page=0x1,limit:limit=0x14,verified:_0x5b5ae6}=_0x5ad9db['query'],_0x262478=(Number(page)-0x1)*Number(limit),_0x1ba88b={};_0x5b5ae6!==undefined&&(_0x1ba88b['isVerified']=_0x5b5ae6===_0x42f295(0x16a));const [_0x3ed7b8,_0xeecc1f]=await Promise[_0x42f295(0x166)]([database_1[_0x42f295(0x172)]['telegramUser']['findMany']({'where':_0x1ba88b,'skip':_0x262478,'take':Number(limit),'orderBy':{'createdAt':_0x42f295(0x159)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x42f295(0x172)][_0x42f295(0x155)][_0x42f295(0x164)]({'where':_0x1ba88b})]);_0x489d06[_0x42f295(0x171)]({'success':!![],'users':_0x3ed7b8[_0x42f295(0x161)](_0x9ee32b=>({'id':_0x9ee32b['id'],'telegramId':_0x9ee32b[_0x42f295(0x151)],'username':_0x9ee32b[_0x42f295(0x160)],'firstName':_0x9ee32b['firstName'],'lastName':_0x9ee32b['lastName'],'isVerified':_0x9ee32b[_0x42f295(0x16d)],'shop':_0x9ee32b[_0x42f295(0x179)],'createdAt':_0x9ee32b[_0x42f295(0x17a)],'updatedAt':_0x9ee32b[_0x42f295(0x182)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xeecc1f,'totalPages':Math[_0x42f295(0x18f)](_0xeecc1f/Number(limit))}});}catch(_0x368eaa){_0x4278aa(_0x368eaa);}},this[_0x5090c3(0x181)]=async(_0x14c8ea,_0x576568,_0xc17be4)=>{const _0x245f8=_0x5090c3;try{const {message:_0x530ae1,shopId:_0x490c24}=_0x14c8ea[_0x245f8(0x188)];if(!_0x530ae1)return _0x576568[_0x245f8(0x15a)](0x190)[_0x245f8(0x171)]({'success':![],'message':'Message\x20is\x20required'});if(_0x490c24)await telegramBotService_1[_0x245f8(0x17e)][_0x245f8(0x185)](_0x490c24,_0x530ae1,{'parse_mode':_0x245f8(0x178)});else{const _0xbcd77f=await database_1[_0x245f8(0x172)][_0x245f8(0x155)][_0x245f8(0x189)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3f96af=[...new Set(_0xbcd77f[_0x245f8(0x161)](_0x193c08=>_0x193c08[_0x245f8(0x16f)])[_0x245f8(0x15d)](Boolean))];for(const _0x8ce92d of _0x3f96af){_0x8ce92d&&await telegramBotService_1['telegramBotService'][_0x245f8(0x185)](_0x8ce92d,_0x530ae1,{'parse_mode':'Markdown'});}}_0x576568[_0x245f8(0x171)]({'success':!![],'message':_0x245f8(0x156)});}catch(_0x38e647){_0xc17be4(_0x38e647);}},this['disconnectUser']=async(_0x6ab956,_0x11fa75,_0x9888a)=>{const _0x4afef3=_0x5090c3;try{const {telegramId:_0x47044b}=_0x6ab956['params'],_0xf7a0f6=await database_1[_0x4afef3(0x172)]['telegramUser'][_0x4afef3(0x16c)]({'where':{'telegramId':_0x47044b},'include':{'shop':!![]}});if(!_0xf7a0f6)return _0x11fa75[_0x4afef3(0x15a)](0x194)[_0x4afef3(0x171)]({'success':![],'message':_0x4afef3(0x168)});await database_1[_0x4afef3(0x172)][_0x4afef3(0x155)][_0x4afef3(0x184)]({'where':{'telegramId':_0x47044b},'data':{'shopId':null,'isVerified':![]}}),_0x11fa75[_0x4afef3(0x171)]({'success':!![],'message':_0x4afef3(0x14a)});}catch(_0x413af9){_0x9888a(_0x413af9);}},this[_0x5090c3(0x153)]=async(_0x516c20,_0x44461b,_0x2c5395)=>{const _0x235802=_0x5090c3;try{const {shopId:_0x21599c,type:type=_0x235802(0x167),testData:_0x3cefa5}=_0x516c20[_0x235802(0x188)];if(!_0x21599c)return _0x44461b[_0x235802(0x15a)](0x190)[_0x235802(0x171)]({'success':![],'message':_0x235802(0x14d)});const _0x5a7f1b=await database_1['default'][_0x235802(0x179)][_0x235802(0x16c)]({'where':{'id':_0x21599c},'select':{'id':!![],'name':!![]}});if(!_0x5a7f1b)return _0x44461b[_0x235802(0x15a)](0x194)[_0x235802(0x171)]({'success':![],'message':_0x235802(0x15c)});switch(type){case _0x235802(0x167):const _0x58f714={'id':_0x235802(0x152),'amount':_0x3cefa5?.[_0x235802(0x162)]||0x64,'currency':_0x3cefa5?.[_0x235802(0x17d)]||_0x235802(0x174),'productName':_0x3cefa5?.['productName']||_0x235802(0x14e),'gateway':_0x3cefa5?.[_0x235802(0x175)]||_0x235802(0x17c),'createdAt':new Date(),..._0x3cefa5};await telegramBotService_1[_0x235802(0x17e)][_0x235802(0x190)](_0x21599c,_0x58f714,_0x235802(0x192));break;case _0x235802(0x18b):const _0x3d333e={'id':'test_payout_123','amount':_0x3cefa5?.[_0x235802(0x162)]||0x1f4,'network':_0x3cefa5?.[_0x235802(0x187)]||_0x235802(0x183),'wallet':_0x3cefa5?.['wallet']||_0x235802(0x15e),'period':_0x235802(0x196),'createdAt':new Date(),'txid':_0x3cefa5?.[_0x235802(0x14c)]||null,..._0x3cefa5};await telegramBotService_1['telegramBotService'][_0x235802(0x195)](_0x21599c,_0x3d333e);break;case _0x235802(0x180):await telegramBotService_1['telegramBotService'][_0x235802(0x15f)](_0x21599c,_0x3cefa5?.[_0x235802(0x17b)]||_0x235802(0x14b),_0x3cefa5?.[_0x235802(0x193)]||{'message':_0x235802(0x16e)});break;default:return _0x44461b[_0x235802(0x15a)](0x190)[_0x235802(0x171)]({'success':![],'message':_0x235802(0x158)});}_0x44461b[_0x235802(0x171)]({'success':!![],'message':_0x235802(0x165)+type+_0x235802(0x17f)});}catch(_0x2cee16){_0x2c5395(_0x2cee16);}};}}exports['TelegramController']=TelegramController;