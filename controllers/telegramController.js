'use strict';const a12_0x19d9c5=a12_0x1a5a;(function(_0x56a0bd,_0x11bdee){const _0x48b8ce=a12_0x1a5a,_0x188aa7=_0x56a0bd();while(!![]){try{const _0x292f0e=parseInt(_0x48b8ce(0xce))/0x1+parseInt(_0x48b8ce(0xf1))/0x2+parseInt(_0x48b8ce(0xec))/0x3*(-parseInt(_0x48b8ce(0xe0))/0x4)+parseInt(_0x48b8ce(0xb6))/0x5*(-parseInt(_0x48b8ce(0xb4))/0x6)+-parseInt(_0x48b8ce(0xe1))/0x7*(-parseInt(_0x48b8ce(0xb7))/0x8)+parseInt(_0x48b8ce(0xf6))/0x9+-parseInt(_0x48b8ce(0xbe))/0xa*(parseInt(_0x48b8ce(0xfa))/0xb);if(_0x292f0e===_0x11bdee)break;else _0x188aa7['push'](_0x188aa7['shift']());}catch(_0x5222cd){_0x188aa7['push'](_0x188aa7['shift']());}}}(a12_0xe261,0x785f7));var __importDefault=this&&this[a12_0x19d9c5(0xc2)]||function(_0x4c9c42){return _0x4c9c42&&_0x4c9c42['__esModule']?_0x4c9c42:{'default':_0x4c9c42};};Object[a12_0x19d9c5(0xd9)](exports,'__esModule',{'value':!![]}),exports[a12_0x19d9c5(0xe8)]=void 0x0;function a12_0x1a5a(_0x19fa39,_0x4c39c4){const _0xe261af=a12_0xe261();return a12_0x1a5a=function(_0x1a5a14,_0x5a46db){_0x1a5a14=_0x1a5a14-0xb3;let _0x93446e=_0xe261af[_0x1a5a14];return _0x93446e;},a12_0x1a5a(_0x19fa39,_0x4c39c4);}const telegramBotService_1=require(a12_0x19d9c5(0xee)),database_1=__importDefault(require(a12_0x19d9c5(0xb9)));function a12_0xe261(){const _0x63d8ef=['Shop\x20not\x20found','custom','paid','json','count','lastName','USD','payout','default','defineProperty','shopId','disconnectUser','sendTestNotification','map','Test\x20Notification','shop','75632jkpJIF','322ApOvgN','method','body','length','sendShopNotification','test_payout_123','findMany','TelegramController','productName','createdAt','sendBroadcast','45GHczit','findUnique','../services/telegramBotService','getBotInfo','telegramBotService','361874Eswftl','details','bank_transfer','filter','sendPaymentNotification','4086684IoeMzG','isVerified','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Test\x20','121pBNJnu','desc','amount','ceil','Broadcast\x20message\x20sent\x20successfully','6toubWZ','isActive','689305fAmOpy','92192xXqlJP','Markdown','../config/database','update','Shop\x20ID\x20is\x20required','status','firstName','733990mOXDjd','username','\x20notification\x20sent\x20successfully','User\x20disconnected\x20successfully','__importDefault','query','currency','groupBy','updatedAt','This\x20is\x20a\x20test\x20notification','Message\x20is\x20required','telegramId','sendPayoutNotification','completed','params','payment','556800bdhiBw','telegramUser'];a12_0xe261=function(){return _0x63d8ef;};return a12_0xe261();}class TelegramController{constructor(){const _0x2d1a95=a12_0x19d9c5;this['getBotStatus']=async(_0x596bb8,_0x20cb93,_0x5ce40a)=>{const _0x2b3ca8=a12_0x1a5a;try{const _0x504988=telegramBotService_1['telegramBotService'][_0x2b3ca8(0xef)](),_0x588bd8=await database_1[_0x2b3ca8(0xd8)][_0x2b3ca8(0xcf)][_0x2b3ca8(0xd4)](),_0x19353a=await database_1[_0x2b3ca8(0xd8)][_0x2b3ca8(0xcf)][_0x2b3ca8(0xd4)]({'where':{'isVerified':!![]}}),_0x17a670=await database_1[_0x2b3ca8(0xd8)][_0x2b3ca8(0xcf)][_0x2b3ca8(0xc5)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x20cb93[_0x2b3ca8(0xd3)]({'success':!![],'result':{'bot':{'isActive':_0x504988[_0x2b3ca8(0xb5)],'username':_0x504988[_0x2b3ca8(0xbf)]},'statistics':{'totalUsers':_0x588bd8,'verifiedUsers':_0x19353a,'unverifiedUsers':_0x588bd8-_0x19353a,'connectedShops':_0x17a670[_0x2b3ca8(0xe4)]}}});}catch(_0x28183f){_0x5ce40a(_0x28183f);}},this['getTelegramUsers']=async(_0x3a2d5d,_0x19675a,_0x3a3385)=>{const _0x37af42=a12_0x1a5a;try{const {page:page=0x1,limit:limit=0x14,verified:_0x31992b}=_0x3a2d5d[_0x37af42(0xc3)],_0xc609cd=(Number(page)-0x1)*Number(limit),_0x24032e={};_0x31992b!==undefined&&(_0x24032e[_0x37af42(0xf7)]=_0x31992b==='true');const [_0x9b730b,_0x25bb80]=await Promise['all']([database_1[_0x37af42(0xd8)][_0x37af42(0xcf)][_0x37af42(0xe7)]({'where':_0x24032e,'skip':_0xc609cd,'take':Number(limit),'orderBy':{'createdAt':_0x37af42(0xfb)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x37af42(0xd8)][_0x37af42(0xcf)][_0x37af42(0xd4)]({'where':_0x24032e})]);_0x19675a['json']({'success':!![],'users':_0x9b730b['map'](_0x1cc0c8=>({'id':_0x1cc0c8['id'],'telegramId':_0x1cc0c8[_0x37af42(0xc9)],'username':_0x1cc0c8['username'],'firstName':_0x1cc0c8[_0x37af42(0xbd)],'lastName':_0x1cc0c8[_0x37af42(0xd5)],'isVerified':_0x1cc0c8[_0x37af42(0xf7)],'shop':_0x1cc0c8[_0x37af42(0xdf)],'createdAt':_0x1cc0c8[_0x37af42(0xea)],'updatedAt':_0x1cc0c8[_0x37af42(0xc6)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x25bb80,'totalPages':Math[_0x37af42(0xfd)](_0x25bb80/Number(limit))}});}catch(_0x18df7b){_0x3a3385(_0x18df7b);}},this[_0x2d1a95(0xeb)]=async(_0x27b7d3,_0x415525,_0x31aa48)=>{const _0x21c5d8=_0x2d1a95;try{const {message:_0x19d13f,shopId:_0x209894}=_0x27b7d3['body'];if(!_0x19d13f)return _0x415525[_0x21c5d8(0xbc)](0x190)[_0x21c5d8(0xd3)]({'success':![],'message':_0x21c5d8(0xc8)});if(_0x209894)await telegramBotService_1['telegramBotService'][_0x21c5d8(0xe5)](_0x209894,_0x19d13f,{'parse_mode':_0x21c5d8(0xb8)});else{const _0x4fec48=await database_1[_0x21c5d8(0xd8)]['telegramUser'][_0x21c5d8(0xe7)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x550bcb=[...new Set(_0x4fec48[_0x21c5d8(0xdd)](_0x317f21=>_0x317f21[_0x21c5d8(0xda)])[_0x21c5d8(0xf4)](Boolean))];for(const _0x4e1373 of _0x550bcb){_0x4e1373&&await telegramBotService_1[_0x21c5d8(0xf0)][_0x21c5d8(0xe5)](_0x4e1373,_0x19d13f,{'parse_mode':_0x21c5d8(0xb8)});}}_0x415525[_0x21c5d8(0xd3)]({'success':!![],'message':_0x21c5d8(0xb3)});}catch(_0x44d2a6){_0x31aa48(_0x44d2a6);}},this[_0x2d1a95(0xdb)]=async(_0xe67362,_0xd847a7,_0x19a060)=>{const _0x1c0987=_0x2d1a95;try{const {telegramId:_0x3dd303}=_0xe67362[_0x1c0987(0xcc)],_0x24b386=await database_1[_0x1c0987(0xd8)][_0x1c0987(0xcf)][_0x1c0987(0xed)]({'where':{'telegramId':_0x3dd303},'include':{'shop':!![]}});if(!_0x24b386)return _0xd847a7['status'](0x194)[_0x1c0987(0xd3)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default']['telegramUser'][_0x1c0987(0xba)]({'where':{'telegramId':_0x3dd303},'data':{'shopId':null,'isVerified':![]}}),_0xd847a7[_0x1c0987(0xd3)]({'success':!![],'message':_0x1c0987(0xc1)});}catch(_0x271053){_0x19a060(_0x271053);}},this[_0x2d1a95(0xdc)]=async(_0x5467a2,_0x23bdf4,_0x347043)=>{const _0x5d3892=_0x2d1a95;try{const {shopId:_0x39026c,type:type=_0x5d3892(0xcd),testData:_0x4888f5}=_0x5467a2[_0x5d3892(0xe3)];if(!_0x39026c)return _0x23bdf4[_0x5d3892(0xbc)](0x190)[_0x5d3892(0xd3)]({'success':![],'message':_0x5d3892(0xbb)});const _0x366fe1=await database_1['default'][_0x5d3892(0xdf)][_0x5d3892(0xed)]({'where':{'id':_0x39026c},'select':{'id':!![],'name':!![]}});if(!_0x366fe1)return _0x23bdf4[_0x5d3892(0xbc)](0x194)[_0x5d3892(0xd3)]({'success':![],'message':_0x5d3892(0xd0)});switch(type){case _0x5d3892(0xcd):const _0x25dc44={'id':'test_payment_123','amount':_0x4888f5?.[_0x5d3892(0xfc)]||0x64,'currency':_0x4888f5?.[_0x5d3892(0xc4)]||_0x5d3892(0xd6),'productName':_0x4888f5?.[_0x5d3892(0xe9)]||'Test\x20Product','gateway':_0x4888f5?.['gateway']||'plisio','createdAt':new Date(),..._0x4888f5};await telegramBotService_1['telegramBotService'][_0x5d3892(0xf5)](_0x39026c,_0x25dc44,_0x5d3892(0xd2));break;case _0x5d3892(0xd7):const _0x2a811f={'id':_0x5d3892(0xe6),'amount':_0x4888f5?.[_0x5d3892(0xfc)]||0x1f4,'method':_0x4888f5?.[_0x5d3892(0xe2)]||_0x5d3892(0xf3),'createdAt':new Date(),..._0x4888f5};await telegramBotService_1[_0x5d3892(0xf0)][_0x5d3892(0xca)](_0x39026c,_0x2a811f,_0x5d3892(0xcb));break;case _0x5d3892(0xd1):await telegramBotService_1[_0x5d3892(0xf0)]['sendCustomNotification'](_0x39026c,_0x4888f5?.['title']||_0x5d3892(0xde),_0x4888f5?.[_0x5d3892(0xf2)]||{'message':_0x5d3892(0xc7)});break;default:return _0x23bdf4[_0x5d3892(0xbc)](0x190)[_0x5d3892(0xd3)]({'success':![],'message':_0x5d3892(0xf8)});}_0x23bdf4[_0x5d3892(0xd3)]({'success':!![],'message':_0x5d3892(0xf9)+type+_0x5d3892(0xc0)});}catch(_0x1aec5b){_0x347043(_0x1aec5b);}};}}exports[a12_0x19d9c5(0xe8)]=TelegramController;