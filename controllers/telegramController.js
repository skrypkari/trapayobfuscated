'use strict';const a12_0x110eb1=a12_0x5493;function a12_0x5493(_0x545926,_0x7d12db){const _0x1b80a3=a12_0x1b80();return a12_0x5493=function(_0x549301,_0x393faa){_0x549301=_0x549301-0x1ee;let _0xf7258f=_0x1b80a3[_0x549301];return _0xf7258f;},a12_0x5493(_0x545926,_0x7d12db);}(function(_0xafdb25,_0x6091b2){const _0x5d1acc=a12_0x5493,_0x570746=_0xafdb25();while(!![]){try{const _0x2b4d77=-parseInt(_0x5d1acc(0x1f9))/0x1*(-parseInt(_0x5d1acc(0x20d))/0x2)+-parseInt(_0x5d1acc(0x230))/0x3*(-parseInt(_0x5d1acc(0x21c))/0x4)+parseInt(_0x5d1acc(0x20c))/0x5*(parseInt(_0x5d1acc(0x217))/0x6)+parseInt(_0x5d1acc(0x1fe))/0x7*(parseInt(_0x5d1acc(0x1ef))/0x8)+-parseInt(_0x5d1acc(0x214))/0x9*(parseInt(_0x5d1acc(0x209))/0xa)+-parseInt(_0x5d1acc(0x1f3))/0xb*(-parseInt(_0x5d1acc(0x219))/0xc)+-parseInt(_0x5d1acc(0x20b))/0xd*(parseInt(_0x5d1acc(0x221))/0xe);if(_0x2b4d77===_0x6091b2)break;else _0x570746['push'](_0x570746['shift']());}catch(_0x41ec81){_0x570746['push'](_0x570746['shift']());}}}(a12_0x1b80,0x280d7));var __importDefault=this&&this[a12_0x110eb1(0x1fa)]||function(_0x7dace1){const _0x1711b9=a12_0x110eb1;return _0x7dace1&&_0x7dace1[_0x1711b9(0x222)]?_0x7dace1:{'default':_0x7dace1};};Object[a12_0x110eb1(0x21a)](exports,'__esModule',{'value':!![]}),exports[a12_0x110eb1(0x1f2)]=void 0x0;const telegramBotService_1=require(a12_0x110eb1(0x21d)),database_1=__importDefault(require(a12_0x110eb1(0x223)));class TelegramController{constructor(){const _0x328140=a12_0x110eb1;this[_0x328140(0x1f6)]=async(_0x14edac,_0x22be7d,_0x8bf03e)=>{const _0x414016=_0x328140;try{const _0x557ea1=telegramBotService_1[_0x414016(0x1f0)][_0x414016(0x1f4)](),_0x597c10=await database_1[_0x414016(0x207)]['telegramUser']['count'](),_0x3bf1f4=await database_1[_0x414016(0x207)]['telegramUser'][_0x414016(0x22f)]({'where':{'isVerified':!![]}}),_0x4cbf3b=await database_1[_0x414016(0x207)][_0x414016(0x1f7)]['groupBy']({'by':[_0x414016(0x227)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x22be7d[_0x414016(0x20e)]({'success':!![],'result':{'bot':{'isActive':_0x557ea1['isActive'],'username':_0x557ea1[_0x414016(0x1ee)]},'statistics':{'totalUsers':_0x597c10,'verifiedUsers':_0x3bf1f4,'unverifiedUsers':_0x597c10-_0x3bf1f4,'connectedShops':_0x4cbf3b[_0x414016(0x22e)]}}});}catch(_0xc25920){_0x8bf03e(_0xc25920);}},this[_0x328140(0x1fc)]=async(_0x53d163,_0x314b1f,_0x740483)=>{const _0x33cb19=_0x328140;try{const {page:page=0x1,limit:limit=0x14,verified:_0x431bf6}=_0x53d163['query'],_0x4b3c74=(Number(page)-0x1)*Number(limit),_0x406685={};_0x431bf6!==undefined&&(_0x406685[_0x33cb19(0x208)]=_0x431bf6===_0x33cb19(0x1f8));const [_0x4cbb1a,_0x43aed1]=await Promise[_0x33cb19(0x232)]([database_1[_0x33cb19(0x207)][_0x33cb19(0x1f7)][_0x33cb19(0x220)]({'where':_0x406685,'skip':_0x4b3c74,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x33cb19(0x1f7)][_0x33cb19(0x22f)]({'where':_0x406685})]);_0x314b1f[_0x33cb19(0x20e)]({'success':!![],'users':_0x4cbb1a['map'](_0x3a8246=>({'id':_0x3a8246['id'],'telegramId':_0x3a8246['telegramId'],'username':_0x3a8246[_0x33cb19(0x1ee)],'firstName':_0x3a8246['firstName'],'lastName':_0x3a8246[_0x33cb19(0x204)],'isVerified':_0x3a8246[_0x33cb19(0x208)],'shop':_0x3a8246['shop'],'createdAt':_0x3a8246[_0x33cb19(0x211)],'updatedAt':_0x3a8246['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x43aed1,'totalPages':Math['ceil'](_0x43aed1/Number(limit))}});}catch(_0x39cc67){_0x740483(_0x39cc67);}},this['sendBroadcast']=async(_0x3c2d95,_0x54956c,_0x57315b)=>{const _0x260113=_0x328140;try{const {message:_0x8bbf3f,shopId:_0xf370e5}=_0x3c2d95[_0x260113(0x1f5)];if(!_0x8bbf3f)return _0x54956c[_0x260113(0x22b)](0x190)['json']({'success':![],'message':'Message\x20is\x20required'});if(_0xf370e5)await telegramBotService_1[_0x260113(0x1f0)][_0x260113(0x231)](_0xf370e5,_0x8bbf3f,{'parse_mode':'Markdown'});else{const _0x37e935=await database_1[_0x260113(0x207)][_0x260113(0x1f7)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0xc564f=[...new Set(_0x37e935[_0x260113(0x203)](_0x47e127=>_0x47e127[_0x260113(0x227)])['filter'](Boolean))];for(const _0x429f0d of _0xc564f){_0x429f0d&&await telegramBotService_1[_0x260113(0x1f0)][_0x260113(0x231)](_0x429f0d,_0x8bbf3f,{'parse_mode':_0x260113(0x225)});}}_0x54956c[_0x260113(0x20e)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x2996ba){_0x57315b(_0x2996ba);}},this['disconnectUser']=async(_0x18636e,_0x77261a,_0xd1d70b)=>{const _0x55c9d1=_0x328140;try{const {telegramId:_0x426252}=_0x18636e[_0x55c9d1(0x226)],_0xd24016=await database_1['default']['telegramUser']['findUnique']({'where':{'telegramId':_0x426252},'include':{'shop':!![]}});if(!_0xd24016)return _0x77261a[_0x55c9d1(0x22b)](0x194)[_0x55c9d1(0x20e)]({'success':![],'message':_0x55c9d1(0x1fd)});await database_1[_0x55c9d1(0x207)]['telegramUser'][_0x55c9d1(0x22d)]({'where':{'telegramId':_0x426252},'data':{'shopId':null,'isVerified':![]}}),_0x77261a[_0x55c9d1(0x20e)]({'success':!![],'message':_0x55c9d1(0x1ff)});}catch(_0x51e04a){_0xd1d70b(_0x51e04a);}},this[_0x328140(0x201)]=async(_0x5cc8ee,_0x1534aa,_0x1429b1)=>{const _0x20a77f=_0x328140;try{const {shopId:_0x129ef4,type:type='payment',testData:_0x23e367}=_0x5cc8ee['body'];if(!_0x129ef4)return _0x1534aa[_0x20a77f(0x22b)](0x190)[_0x20a77f(0x20e)]({'success':![],'message':_0x20a77f(0x210)});const _0x559d89=await database_1[_0x20a77f(0x207)][_0x20a77f(0x21e)][_0x20a77f(0x212)]({'where':{'id':_0x129ef4},'select':{'id':!![],'name':!![]}});if(!_0x559d89)return _0x1534aa[_0x20a77f(0x22b)](0x194)[_0x20a77f(0x20e)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case'payment':const _0x4a207e={'id':_0x20a77f(0x1fb),'amount':_0x23e367?.['amount']||0x64,'currency':_0x23e367?.['currency']||_0x20a77f(0x218),'productName':_0x23e367?.[_0x20a77f(0x228)]||'Test\x20Product','gateway':_0x23e367?.['gateway']||_0x20a77f(0x224),'createdAt':new Date(),..._0x23e367};await telegramBotService_1[_0x20a77f(0x1f0)][_0x20a77f(0x22a)](_0x129ef4,_0x4a207e,_0x20a77f(0x22c));break;case _0x20a77f(0x200):const _0x402818={'id':_0x20a77f(0x20f),'amount':_0x23e367?.[_0x20a77f(0x233)]||0x1f4,'method':_0x23e367?.[_0x20a77f(0x21b)]||_0x20a77f(0x215),'createdAt':new Date(),..._0x23e367};await telegramBotService_1[_0x20a77f(0x1f0)][_0x20a77f(0x205)](_0x129ef4,_0x402818,_0x20a77f(0x229));break;case _0x20a77f(0x21f):await telegramBotService_1['telegramBotService'][_0x20a77f(0x1f1)](_0x129ef4,_0x23e367?.['title']||'Test\x20Notification',_0x23e367?.[_0x20a77f(0x216)]||{'message':_0x20a77f(0x20a)});break;default:return _0x1534aa[_0x20a77f(0x22b)](0x190)[_0x20a77f(0x20e)]({'success':![],'message':_0x20a77f(0x206)});}_0x1534aa[_0x20a77f(0x20e)]({'success':!![],'message':_0x20a77f(0x202)+type+_0x20a77f(0x213)});}catch(_0x95575f){_0x1429b1(_0x95575f);}};}}function a12_0x1b80(){const _0x1fe00e=['findMany','98cVnlXx','__esModule','../config/database','plisio','Markdown','params','shopId','productName','completed','sendPaymentNotification','status','paid','update','length','count','21cysFya','sendShopNotification','all','amount','username','1988816EyyNSQ','telegramBotService','sendCustomNotification','TelegramController','665786CidLeR','getBotInfo','body','getBotStatus','telegramUser','true','6sbAlnG','__importDefault','test_payment_123','getTelegramUsers','Telegram\x20user\x20not\x20found','7uVkpOQ','User\x20disconnected\x20successfully','payout','sendTestNotification','Test\x20','map','lastName','sendPayoutNotification','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','default','isVerified','529990agYThJ','This\x20is\x20a\x20test\x20notification','1099423iHcqJi','45930bFQnRJ','19226IRfwWB','json','test_payout_123','Shop\x20ID\x20is\x20required','createdAt','findUnique','\x20notification\x20sent\x20successfully','9siMsJC','bank_transfer','details','90VQQnBQ','USD','24hxVZuM','defineProperty','method','139388jMcjRp','../services/telegramBotService','shop','custom'];a12_0x1b80=function(){return _0x1fe00e;};return a12_0x1b80();}exports[a12_0x110eb1(0x1f2)]=TelegramController;