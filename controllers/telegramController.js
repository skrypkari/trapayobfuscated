'use strict';function a12_0x288d(_0x3dba76,_0x210676){const _0x48fab2=a12_0x48fa();return a12_0x288d=function(_0x288d4a,_0x268307){_0x288d4a=_0x288d4a-0x77;let _0xaf8a4=_0x48fab2[_0x288d4a];return _0xaf8a4;},a12_0x288d(_0x3dba76,_0x210676);}const a12_0x268f1a=a12_0x288d;(function(_0x141e53,_0x1f81dd){const _0x5c197c=a12_0x288d,_0x2bbad4=_0x141e53();while(!![]){try{const _0x316524=-parseInt(_0x5c197c(0xa0))/0x1+-parseInt(_0x5c197c(0x92))/0x2+-parseInt(_0x5c197c(0xb3))/0x3+parseInt(_0x5c197c(0xb7))/0x4+-parseInt(_0x5c197c(0x79))/0x5+parseInt(_0x5c197c(0xa1))/0x6+parseInt(_0x5c197c(0xba))/0x7;if(_0x316524===_0x1f81dd)break;else _0x2bbad4['push'](_0x2bbad4['shift']());}catch(_0x46514f){_0x2bbad4['push'](_0x2bbad4['shift']());}}}(a12_0x48fa,0xd6728));var __importDefault=this&&this[a12_0x268f1a(0x86)]||function(_0x535132){const _0x515a93=a12_0x268f1a;return _0x535132&&_0x535132[_0x515a93(0x8e)]?_0x535132:{'default':_0x535132};};Object[a12_0x268f1a(0x95)](exports,'__esModule',{'value':!![]}),exports[a12_0x268f1a(0xb9)]=void 0x0;const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require(a12_0x268f1a(0x93)));function a12_0x48fa(){const _0x18d984=['sendBroadcast','5400955FhfeTh','lastName','USD','test_payout_123','sendPayoutNotification','telegramBotService','test_payment_123','Markdown','desc','body','productName','sendShopNotification','length','__importDefault','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','This\x20is\x20a\x20test\x20notification','Shop\x20not\x20found','count','json','firstName','isVerified','__esModule','all','username','status','23034HlZwBn','../config/database','telegramUser','defineProperty','method','bank_transfer','findMany','User\x20disconnected\x20successfully','plisio','gateway','map','sendPaymentNotification','paid','custom','615718pcyhVm','5389650Dfklng','Broadcast\x20message\x20sent\x20successfully','sendTestNotification','Test\x20Product','ceil','createdAt','disconnectUser','Telegram\x20user\x20not\x20found','findUnique','details','sendCustomNotification','shopId','update','shop','updatedAt','amount','Message\x20is\x20required','getBotInfo','4698921EXfyAW','Test\x20Notification','telegramId','default','2410184DpDqFp','Shop\x20ID\x20is\x20required','TelegramController','18559016XQsZQm','payment','completed','params'];a12_0x48fa=function(){return _0x18d984;};return a12_0x48fa();}class TelegramController{constructor(){const _0x325fa3=a12_0x268f1a;this['getBotStatus']=async(_0x1ac719,_0x5019fa,_0x44f044)=>{const _0x344a33=a12_0x288d;try{const _0x200238=telegramBotService_1[_0x344a33(0x7e)][_0x344a33(0xb2)](),_0x5e38b6=await database_1[_0x344a33(0xb6)][_0x344a33(0x94)][_0x344a33(0x8a)](),_0x1242aa=await database_1[_0x344a33(0xb6)][_0x344a33(0x94)]['count']({'where':{'isVerified':!![]}}),_0x45a9ab=await database_1[_0x344a33(0xb6)][_0x344a33(0x94)]['groupBy']({'by':[_0x344a33(0xac)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5019fa[_0x344a33(0x8b)]({'success':!![],'result':{'bot':{'isActive':_0x200238['isActive'],'username':_0x200238['username']},'statistics':{'totalUsers':_0x5e38b6,'verifiedUsers':_0x1242aa,'unverifiedUsers':_0x5e38b6-_0x1242aa,'connectedShops':_0x45a9ab[_0x344a33(0x85)]}}});}catch(_0x57151a){_0x44f044(_0x57151a);}},this['getTelegramUsers']=async(_0x429412,_0x53ff43,_0x20ec8c)=>{const _0x2b5dac=a12_0x288d;try{const {page:page=0x1,limit:limit=0x14,verified:_0x51fe9c}=_0x429412['query'],_0x177e7d=(Number(page)-0x1)*Number(limit),_0x5b683f={};_0x51fe9c!==undefined&&(_0x5b683f[_0x2b5dac(0x8d)]=_0x51fe9c==='true');const [_0x518abb,_0x4a3bbc]=await Promise[_0x2b5dac(0x8f)]([database_1[_0x2b5dac(0xb6)]['telegramUser'][_0x2b5dac(0x98)]({'where':_0x5b683f,'skip':_0x177e7d,'take':Number(limit),'orderBy':{'createdAt':_0x2b5dac(0x81)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2b5dac(0xb6)][_0x2b5dac(0x94)][_0x2b5dac(0x8a)]({'where':_0x5b683f})]);_0x53ff43['json']({'success':!![],'users':_0x518abb[_0x2b5dac(0x9c)](_0x5b087f=>({'id':_0x5b087f['id'],'telegramId':_0x5b087f[_0x2b5dac(0xb5)],'username':_0x5b087f[_0x2b5dac(0x90)],'firstName':_0x5b087f[_0x2b5dac(0x8c)],'lastName':_0x5b087f[_0x2b5dac(0x7a)],'isVerified':_0x5b087f[_0x2b5dac(0x8d)],'shop':_0x5b087f[_0x2b5dac(0xae)],'createdAt':_0x5b087f[_0x2b5dac(0xa6)],'updatedAt':_0x5b087f[_0x2b5dac(0xaf)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x4a3bbc,'totalPages':Math[_0x2b5dac(0xa5)](_0x4a3bbc/Number(limit))}});}catch(_0x4b7d28){_0x20ec8c(_0x4b7d28);}},this[_0x325fa3(0x78)]=async(_0x9633,_0x8bf021,_0x193aba)=>{const _0x53775f=_0x325fa3;try{const {message:_0x299a44,shopId:_0x5842c9}=_0x9633['body'];if(!_0x299a44)return _0x8bf021[_0x53775f(0x91)](0x190)['json']({'success':![],'message':_0x53775f(0xb1)});if(_0x5842c9)await telegramBotService_1[_0x53775f(0x7e)][_0x53775f(0x84)](_0x5842c9,_0x299a44,{'parse_mode':_0x53775f(0x80)});else{const _0x25355f=await database_1[_0x53775f(0xb6)][_0x53775f(0x94)][_0x53775f(0x98)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x871251=[...new Set(_0x25355f['map'](_0xc6b65f=>_0xc6b65f[_0x53775f(0xac)])['filter'](Boolean))];for(const _0x2d9ea9 of _0x871251){_0x2d9ea9&&await telegramBotService_1[_0x53775f(0x7e)]['sendShopNotification'](_0x2d9ea9,_0x299a44,{'parse_mode':_0x53775f(0x80)});}}_0x8bf021[_0x53775f(0x8b)]({'success':!![],'message':_0x53775f(0xa2)});}catch(_0x508284){_0x193aba(_0x508284);}},this[_0x325fa3(0xa7)]=async(_0x3ea3c3,_0xc098f3,_0x19d573)=>{const _0x5abfc3=_0x325fa3;try{const {telegramId:_0x2fc400}=_0x3ea3c3[_0x5abfc3(0x77)],_0x495d7b=await database_1['default'][_0x5abfc3(0x94)][_0x5abfc3(0xa9)]({'where':{'telegramId':_0x2fc400},'include':{'shop':!![]}});if(!_0x495d7b)return _0xc098f3[_0x5abfc3(0x91)](0x194)[_0x5abfc3(0x8b)]({'success':![],'message':_0x5abfc3(0xa8)});await database_1['default'][_0x5abfc3(0x94)][_0x5abfc3(0xad)]({'where':{'telegramId':_0x2fc400},'data':{'shopId':null,'isVerified':![]}}),_0xc098f3[_0x5abfc3(0x8b)]({'success':!![],'message':_0x5abfc3(0x99)});}catch(_0x4fdc42){_0x19d573(_0x4fdc42);}},this[_0x325fa3(0xa3)]=async(_0x513fa8,_0x5853fe,_0x473112)=>{const _0x35a2a9=_0x325fa3;try{const {shopId:_0x7c06e8,type:type=_0x35a2a9(0xbb),testData:_0x4b3ca1}=_0x513fa8[_0x35a2a9(0x82)];if(!_0x7c06e8)return _0x5853fe[_0x35a2a9(0x91)](0x190)[_0x35a2a9(0x8b)]({'success':![],'message':_0x35a2a9(0xb8)});const _0x3c4cd8=await database_1[_0x35a2a9(0xb6)]['shop'][_0x35a2a9(0xa9)]({'where':{'id':_0x7c06e8},'select':{'id':!![],'name':!![]}});if(!_0x3c4cd8)return _0x5853fe[_0x35a2a9(0x91)](0x194)[_0x35a2a9(0x8b)]({'success':![],'message':_0x35a2a9(0x89)});switch(type){case _0x35a2a9(0xbb):const _0x56caeb={'id':_0x35a2a9(0x7f),'amount':_0x4b3ca1?.['amount']||0x64,'currency':_0x4b3ca1?.['currency']||_0x35a2a9(0x7b),'productName':_0x4b3ca1?.[_0x35a2a9(0x83)]||_0x35a2a9(0xa4),'gateway':_0x4b3ca1?.[_0x35a2a9(0x9b)]||_0x35a2a9(0x9a),'createdAt':new Date(),..._0x4b3ca1};await telegramBotService_1[_0x35a2a9(0x7e)][_0x35a2a9(0x9d)](_0x7c06e8,_0x56caeb,_0x35a2a9(0x9e));break;case'payout':const _0x4dea46={'id':_0x35a2a9(0x7c),'amount':_0x4b3ca1?.[_0x35a2a9(0xb0)]||0x1f4,'method':_0x4b3ca1?.[_0x35a2a9(0x96)]||_0x35a2a9(0x97),'createdAt':new Date(),..._0x4b3ca1};await telegramBotService_1['telegramBotService'][_0x35a2a9(0x7d)](_0x7c06e8,_0x4dea46,_0x35a2a9(0xbc));break;case _0x35a2a9(0x9f):await telegramBotService_1[_0x35a2a9(0x7e)][_0x35a2a9(0xab)](_0x7c06e8,_0x4b3ca1?.['title']||_0x35a2a9(0xb4),_0x4b3ca1?.[_0x35a2a9(0xaa)]||{'message':_0x35a2a9(0x88)});break;default:return _0x5853fe[_0x35a2a9(0x91)](0x190)['json']({'success':![],'message':_0x35a2a9(0x87)});}_0x5853fe['json']({'success':!![],'message':'Test\x20'+type+'\x20notification\x20sent\x20successfully'});}catch(_0x47cc7f){_0x473112(_0x47cc7f);}};}}exports['TelegramController']=TelegramController;