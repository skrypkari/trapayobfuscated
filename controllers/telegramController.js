'use strict';const a12_0x53d3ed=a12_0x340a;(function(_0x13ff5f,_0xb5f9f5){const _0x1aeb5b=a12_0x340a,_0x1fb3b6=_0x13ff5f();while(!![]){try{const _0x5c33a5=-parseInt(_0x1aeb5b(0x183))/0x1*(parseInt(_0x1aeb5b(0x1b4))/0x2)+-parseInt(_0x1aeb5b(0x1c0))/0x3*(parseInt(_0x1aeb5b(0x184))/0x4)+-parseInt(_0x1aeb5b(0x1ab))/0x5*(-parseInt(_0x1aeb5b(0x188))/0x6)+parseInt(_0x1aeb5b(0x195))/0x7*(parseInt(_0x1aeb5b(0x196))/0x8)+-parseInt(_0x1aeb5b(0x1ad))/0x9+parseInt(_0x1aeb5b(0x17e))/0xa*(-parseInt(_0x1aeb5b(0x187))/0xb)+parseInt(_0x1aeb5b(0x194))/0xc*(parseInt(_0x1aeb5b(0x19f))/0xd);if(_0x5c33a5===_0xb5f9f5)break;else _0x1fb3b6['push'](_0x1fb3b6['shift']());}catch(_0x1b8c6b){_0x1fb3b6['push'](_0x1fb3b6['shift']());}}}(a12_0x5cdd,0xd0d39));function a12_0x5cdd(){const _0x2dbfc6=['firstName','productName','count','../services/telegramBotService','Shop\x20ID\x20is\x20required','1807FeYdnO','json','default','getBotInfo','currency','Shop\x20not\x20found','groupBy','map','isVerified','__esModule','telegramBotService','sendCustomNotification','60ZFOlzM','details','8377227QeltmK','gateway','Markdown','Message\x20is\x20required','Telegram\x20user\x20not\x20found','custom','bank_transfer','2102ayQvDw','Test\x20Product','title','findUnique','username','sendPaymentNotification','desc','Test\x20Notification','body','Broadcast\x20message\x20sent\x20successfully','getTelegramUsers','amount','69YtSBdz','User\x20disconnected\x20successfully','telegramId','test_payout_123','This\x20is\x20a\x20test\x20notification','params','13105660yViLXz','lastName','plisio','Test\x20','sendTestNotification','967aKhDGm','223996HSABWt','all','paid','11ubHeSa','819438FQcgry','telegramUser','TelegramController','shopId','payout','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','true','method','findMany','query','createdAt','status','241752gKJnKa','4151IKTxlu','12976zpHYqV','isActive','../config/database','payment'];a12_0x5cdd=function(){return _0x2dbfc6;};return a12_0x5cdd();}var __importDefault=this&&this['__importDefault']||function(_0x25d9a3){return _0x25d9a3&&_0x25d9a3['__esModule']?_0x25d9a3:{'default':_0x25d9a3};};function a12_0x340a(_0x34a92f,_0x186f00){const _0x5cddc1=a12_0x5cdd();return a12_0x340a=function(_0x340ad7,_0x5c697a){_0x340ad7=_0x340ad7-0x17b;let _0x15ca35=_0x5cddc1[_0x340ad7];return _0x15ca35;},a12_0x340a(_0x34a92f,_0x186f00);}Object['defineProperty'](exports,a12_0x53d3ed(0x1a8),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x53d3ed(0x19d)),database_1=__importDefault(require(a12_0x53d3ed(0x198)));class TelegramController{constructor(){const _0x45e9c3=a12_0x53d3ed;this['getBotStatus']=async(_0x35f1b5,_0x10820c,_0x17a645)=>{const _0x35ac3f=a12_0x340a;try{const _0x490528=telegramBotService_1[_0x35ac3f(0x1a9)][_0x35ac3f(0x1a2)](),_0x2dc667=await database_1[_0x35ac3f(0x1a1)]['telegramUser'][_0x35ac3f(0x19c)](),_0x6ae318=await database_1[_0x35ac3f(0x1a1)][_0x35ac3f(0x189)]['count']({'where':{'isVerified':!![]}}),_0x131a7b=await database_1['default'][_0x35ac3f(0x189)][_0x35ac3f(0x1a5)]({'by':[_0x35ac3f(0x18b)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x10820c[_0x35ac3f(0x1a0)]({'success':!![],'result':{'bot':{'isActive':_0x490528[_0x35ac3f(0x197)],'username':_0x490528['username']},'statistics':{'totalUsers':_0x2dc667,'verifiedUsers':_0x6ae318,'unverifiedUsers':_0x2dc667-_0x6ae318,'connectedShops':_0x131a7b['length']}}});}catch(_0x1a9e85){_0x17a645(_0x1a9e85);}},this[_0x45e9c3(0x1be)]=async(_0x4daf70,_0x56af4f,_0x54c76c)=>{const _0x49c02d=_0x45e9c3;try{const {page:page=0x1,limit:limit=0x14,verified:_0x3a31e4}=_0x4daf70[_0x49c02d(0x191)],_0x53ee81=(Number(page)-0x1)*Number(limit),_0x58a828={};_0x3a31e4!==undefined&&(_0x58a828[_0x49c02d(0x1a7)]=_0x3a31e4===_0x49c02d(0x18e));const [_0x32c0da,_0x1f3994]=await Promise[_0x49c02d(0x185)]([database_1[_0x49c02d(0x1a1)][_0x49c02d(0x189)][_0x49c02d(0x190)]({'where':_0x58a828,'skip':_0x53ee81,'take':Number(limit),'orderBy':{'createdAt':_0x49c02d(0x1ba)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x49c02d(0x1a1)][_0x49c02d(0x189)]['count']({'where':_0x58a828})]);_0x56af4f[_0x49c02d(0x1a0)]({'success':!![],'users':_0x32c0da[_0x49c02d(0x1a6)](_0x63c94c=>({'id':_0x63c94c['id'],'telegramId':_0x63c94c[_0x49c02d(0x1c2)],'username':_0x63c94c[_0x49c02d(0x1b8)],'firstName':_0x63c94c[_0x49c02d(0x19a)],'lastName':_0x63c94c[_0x49c02d(0x17f)],'isVerified':_0x63c94c[_0x49c02d(0x1a7)],'shop':_0x63c94c['shop'],'createdAt':_0x63c94c[_0x49c02d(0x192)],'updatedAt':_0x63c94c['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1f3994,'totalPages':Math['ceil'](_0x1f3994/Number(limit))}});}catch(_0x3aa534){_0x54c76c(_0x3aa534);}},this['sendBroadcast']=async(_0x39c164,_0x4da17d,_0x140d28)=>{const _0x241fc7=_0x45e9c3;try{const {message:_0x1d9a13,shopId:_0x813e51}=_0x39c164[_0x241fc7(0x1bc)];if(!_0x1d9a13)return _0x4da17d[_0x241fc7(0x193)](0x190)[_0x241fc7(0x1a0)]({'success':![],'message':_0x241fc7(0x1b0)});if(_0x813e51)await telegramBotService_1[_0x241fc7(0x1a9)]['sendShopNotification'](_0x813e51,_0x1d9a13,{'parse_mode':_0x241fc7(0x1af)});else{const _0x21b8b3=await database_1[_0x241fc7(0x1a1)][_0x241fc7(0x189)][_0x241fc7(0x190)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3b1370=[...new Set(_0x21b8b3[_0x241fc7(0x1a6)](_0x2b1d18=>_0x2b1d18[_0x241fc7(0x18b)])['filter'](Boolean))];for(const _0x2f1dd1 of _0x3b1370){_0x2f1dd1&&await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x2f1dd1,_0x1d9a13,{'parse_mode':_0x241fc7(0x1af)});}}_0x4da17d[_0x241fc7(0x1a0)]({'success':!![],'message':_0x241fc7(0x1bd)});}catch(_0x21196a){_0x140d28(_0x21196a);}},this['disconnectUser']=async(_0x2b594b,_0x582354,_0x225701)=>{const _0xa45a9=_0x45e9c3;try{const {telegramId:_0x48783d}=_0x2b594b[_0xa45a9(0x17d)],_0x565328=await database_1['default'][_0xa45a9(0x189)][_0xa45a9(0x1b7)]({'where':{'telegramId':_0x48783d},'include':{'shop':!![]}});if(!_0x565328)return _0x582354[_0xa45a9(0x193)](0x194)[_0xa45a9(0x1a0)]({'success':![],'message':_0xa45a9(0x1b1)});await database_1['default'][_0xa45a9(0x189)]['update']({'where':{'telegramId':_0x48783d},'data':{'shopId':null,'isVerified':![]}}),_0x582354[_0xa45a9(0x1a0)]({'success':!![],'message':_0xa45a9(0x1c1)});}catch(_0x98979){_0x225701(_0x98979);}},this[_0x45e9c3(0x182)]=async(_0x1c0baf,_0x45661d,_0xa2fa79)=>{const _0x1ab6eb=_0x45e9c3;try{const {shopId:_0x50bb87,type:type=_0x1ab6eb(0x199),testData:_0xa6d1ce}=_0x1c0baf[_0x1ab6eb(0x1bc)];if(!_0x50bb87)return _0x45661d[_0x1ab6eb(0x193)](0x190)[_0x1ab6eb(0x1a0)]({'success':![],'message':_0x1ab6eb(0x19e)});const _0x403084=await database_1[_0x1ab6eb(0x1a1)]['shop']['findUnique']({'where':{'id':_0x50bb87},'select':{'id':!![],'name':!![]}});if(!_0x403084)return _0x45661d['status'](0x194)[_0x1ab6eb(0x1a0)]({'success':![],'message':_0x1ab6eb(0x1a4)});switch(type){case _0x1ab6eb(0x199):const _0xa8c95d={'id':'test_payment_123','amount':_0xa6d1ce?.[_0x1ab6eb(0x1bf)]||0x64,'currency':_0xa6d1ce?.[_0x1ab6eb(0x1a3)]||'USD','productName':_0xa6d1ce?.[_0x1ab6eb(0x19b)]||_0x1ab6eb(0x1b5),'gateway':_0xa6d1ce?.[_0x1ab6eb(0x1ae)]||_0x1ab6eb(0x180),'createdAt':new Date(),..._0xa6d1ce};await telegramBotService_1[_0x1ab6eb(0x1a9)][_0x1ab6eb(0x1b9)](_0x50bb87,_0xa8c95d,_0x1ab6eb(0x186));break;case _0x1ab6eb(0x18c):const _0x3f30d4={'id':_0x1ab6eb(0x17b),'amount':_0xa6d1ce?.[_0x1ab6eb(0x1bf)]||0x1f4,'method':_0xa6d1ce?.[_0x1ab6eb(0x18f)]||_0x1ab6eb(0x1b3),'createdAt':new Date(),..._0xa6d1ce};await telegramBotService_1[_0x1ab6eb(0x1a9)]['sendPayoutNotification'](_0x50bb87,_0x3f30d4,'completed');break;case _0x1ab6eb(0x1b2):await telegramBotService_1[_0x1ab6eb(0x1a9)][_0x1ab6eb(0x1aa)](_0x50bb87,_0xa6d1ce?.[_0x1ab6eb(0x1b6)]||_0x1ab6eb(0x1bb),_0xa6d1ce?.[_0x1ab6eb(0x1ac)]||{'message':_0x1ab6eb(0x17c)});break;default:return _0x45661d[_0x1ab6eb(0x193)](0x190)[_0x1ab6eb(0x1a0)]({'success':![],'message':_0x1ab6eb(0x18d)});}_0x45661d['json']({'success':!![],'message':_0x1ab6eb(0x181)+type+'\x20notification\x20sent\x20successfully'});}catch(_0xb74aa7){_0xa2fa79(_0xb74aa7);}};}}exports[a12_0x53d3ed(0x18a)]=TelegramController;