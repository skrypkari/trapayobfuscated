'use strict';const a12_0x160e8d=a12_0x51ac;(function(_0x2ead7f,_0x479138){const _0x4f5fff=a12_0x51ac,_0x36fff9=_0x2ead7f();while(!![]){try{const _0x5926c0=parseInt(_0x4f5fff(0xf6))/0x1*(parseInt(_0x4f5fff(0xec))/0x2)+parseInt(_0x4f5fff(0xe8))/0x3*(parseInt(_0x4f5fff(0x11b))/0x4)+parseInt(_0x4f5fff(0x10e))/0x5*(-parseInt(_0x4f5fff(0x11d))/0x6)+parseInt(_0x4f5fff(0x11e))/0x7+parseInt(_0x4f5fff(0xe3))/0x8*(-parseInt(_0x4f5fff(0xdd))/0x9)+-parseInt(_0x4f5fff(0x11a))/0xa*(-parseInt(_0x4f5fff(0xde))/0xb)+-parseInt(_0x4f5fff(0xff))/0xc;if(_0x5926c0===_0x479138)break;else _0x36fff9['push'](_0x36fff9['shift']());}catch(_0x2569ce){_0x36fff9['push'](_0x36fff9['shift']());}}}(a12_0x285a,0xb9782));function a12_0x285a(){const _0x1d3377=['getBotInfo','findUnique','filter','test_payout_123','Markdown','sendBroadcast','body','1967230gCLrEe','sendShopNotification','sendCustomNotification','lastName','\x20notification\x20sent\x20successfully','telegramBotService','Test\x20Notification','amount','desc','defineProperty','firstName','count','4467710UTqKQc','899240BuMqUk','__importDefault','6ecERTq','1148490YoWKwq','Telegram\x20user\x20not\x20found','findMany','map','productName','Shop\x20ID\x20is\x20required','sendTestNotification','4528485hVfmAE','22gCgkdK','updatedAt','gateway','shop','telegramId','8YAcOyG','custom','../services/telegramBotService','This\x20is\x20a\x20test\x20notification','query','3NwMnAp','length','isVerified','json','82mHMWHb','getBotStatus','TelegramController','Message\x20is\x20required','Shop\x20not\x20found','createdAt','status','plisio','username','Test\x20','31849BYrCiM','true','update','isActive','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','../config/database','method','default','payment','11183256ghEdOD','disconnectUser','telegramUser','__esModule','test_payment_123','all','shopId','ceil'];a12_0x285a=function(){return _0x1d3377;};return a12_0x285a();}var __importDefault=this&&this[a12_0x160e8d(0x11c)]||function(_0x3c9549){const _0x30a1a3=a12_0x160e8d;return _0x3c9549&&_0x3c9549[_0x30a1a3(0x102)]?_0x3c9549:{'default':_0x3c9549};};Object[a12_0x160e8d(0x117)](exports,a12_0x160e8d(0x102),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x160e8d(0xe5)),database_1=__importDefault(require(a12_0x160e8d(0xfb)));class TelegramController{constructor(){const _0x420a2b=a12_0x160e8d;this[_0x420a2b(0xed)]=async(_0x1869bc,_0x347bc7,_0x3d1da3)=>{const _0xe72e09=_0x420a2b;try{const _0x4e5905=telegramBotService_1['telegramBotService'][_0xe72e09(0x107)](),_0x37ae6b=await database_1['default'][_0xe72e09(0x101)]['count'](),_0x1315fb=await database_1[_0xe72e09(0xfd)][_0xe72e09(0x101)]['count']({'where':{'isVerified':!![]}}),_0x1b8b13=await database_1[_0xe72e09(0xfd)][_0xe72e09(0x101)]['groupBy']({'by':[_0xe72e09(0x105)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x347bc7[_0xe72e09(0xeb)]({'success':!![],'result':{'bot':{'isActive':_0x4e5905[_0xe72e09(0xf9)],'username':_0x4e5905[_0xe72e09(0xf4)]},'statistics':{'totalUsers':_0x37ae6b,'verifiedUsers':_0x1315fb,'unverifiedUsers':_0x37ae6b-_0x1315fb,'connectedShops':_0x1b8b13[_0xe72e09(0xe9)]}}});}catch(_0x47e930){_0x3d1da3(_0x47e930);}},this['getTelegramUsers']=async(_0x199967,_0x5ed496,_0x3542a0)=>{const _0x120d34=_0x420a2b;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1fe2e5}=_0x199967[_0x120d34(0xe7)],_0x2b3154=(Number(page)-0x1)*Number(limit),_0x123925={};_0x1fe2e5!==undefined&&(_0x123925[_0x120d34(0xea)]=_0x1fe2e5===_0x120d34(0xf7));const [_0x2ae187,_0x1ac478]=await Promise[_0x120d34(0x104)]([database_1['default'][_0x120d34(0x101)][_0x120d34(0xd8)]({'where':_0x123925,'skip':_0x2b3154,'take':Number(limit),'orderBy':{'createdAt':_0x120d34(0x116)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x120d34(0xfd)][_0x120d34(0x101)][_0x120d34(0x119)]({'where':_0x123925})]);_0x5ed496[_0x120d34(0xeb)]({'success':!![],'users':_0x2ae187[_0x120d34(0xd9)](_0x5bc1a5=>({'id':_0x5bc1a5['id'],'telegramId':_0x5bc1a5[_0x120d34(0xe2)],'username':_0x5bc1a5['username'],'firstName':_0x5bc1a5[_0x120d34(0x118)],'lastName':_0x5bc1a5[_0x120d34(0x111)],'isVerified':_0x5bc1a5[_0x120d34(0xea)],'shop':_0x5bc1a5[_0x120d34(0xe1)],'createdAt':_0x5bc1a5[_0x120d34(0xf1)],'updatedAt':_0x5bc1a5[_0x120d34(0xdf)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1ac478,'totalPages':Math[_0x120d34(0x106)](_0x1ac478/Number(limit))}});}catch(_0x10655b){_0x3542a0(_0x10655b);}},this[_0x420a2b(0x10c)]=async(_0x58c4ac,_0x303e4a,_0x28bfcc)=>{const _0x1a69bc=_0x420a2b;try{const {message:_0x3047bf,shopId:_0x1e5f15}=_0x58c4ac[_0x1a69bc(0x10d)];if(!_0x3047bf)return _0x303e4a[_0x1a69bc(0xf2)](0x190)[_0x1a69bc(0xeb)]({'success':![],'message':_0x1a69bc(0xef)});if(_0x1e5f15)await telegramBotService_1['telegramBotService'][_0x1a69bc(0x10f)](_0x1e5f15,_0x3047bf,{'parse_mode':_0x1a69bc(0x10b)});else{const _0x224237=await database_1[_0x1a69bc(0xfd)][_0x1a69bc(0x101)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3ebd87=[...new Set(_0x224237['map'](_0x96956d=>_0x96956d['shopId'])[_0x1a69bc(0x109)](Boolean))];for(const _0x1fb174 of _0x3ebd87){_0x1fb174&&await telegramBotService_1[_0x1a69bc(0x113)][_0x1a69bc(0x10f)](_0x1fb174,_0x3047bf,{'parse_mode':_0x1a69bc(0x10b)});}}_0x303e4a[_0x1a69bc(0xeb)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x31d63c){_0x28bfcc(_0x31d63c);}},this[_0x420a2b(0x100)]=async(_0x382980,_0x4d44ff,_0x4b333e)=>{const _0x46c64a=_0x420a2b;try{const {telegramId:_0xf20291}=_0x382980['params'],_0x224f71=await database_1['default'][_0x46c64a(0x101)][_0x46c64a(0x108)]({'where':{'telegramId':_0xf20291},'include':{'shop':!![]}});if(!_0x224f71)return _0x4d44ff['status'](0x194)['json']({'success':![],'message':_0x46c64a(0xd7)});await database_1[_0x46c64a(0xfd)][_0x46c64a(0x101)][_0x46c64a(0xf8)]({'where':{'telegramId':_0xf20291},'data':{'shopId':null,'isVerified':![]}}),_0x4d44ff[_0x46c64a(0xeb)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x4730e9){_0x4b333e(_0x4730e9);}},this[_0x420a2b(0xdc)]=async(_0x305b24,_0x27b40d,_0x35f59e)=>{const _0x55341f=_0x420a2b;try{const {shopId:_0x1de51a,type:type=_0x55341f(0xfe),testData:_0x340e02}=_0x305b24[_0x55341f(0x10d)];if(!_0x1de51a)return _0x27b40d[_0x55341f(0xf2)](0x190)[_0x55341f(0xeb)]({'success':![],'message':_0x55341f(0xdb)});const _0x36774f=await database_1['default'][_0x55341f(0xe1)][_0x55341f(0x108)]({'where':{'id':_0x1de51a},'select':{'id':!![],'name':!![]}});if(!_0x36774f)return _0x27b40d[_0x55341f(0xf2)](0x194)[_0x55341f(0xeb)]({'success':![],'message':_0x55341f(0xf0)});switch(type){case _0x55341f(0xfe):const _0x531150={'id':_0x55341f(0x103),'amount':_0x340e02?.[_0x55341f(0x115)]||0x64,'currency':_0x340e02?.['currency']||'USD','productName':_0x340e02?.[_0x55341f(0xda)]||'Test\x20Product','gateway':_0x340e02?.[_0x55341f(0xe0)]||_0x55341f(0xf3),'createdAt':new Date(),..._0x340e02};await telegramBotService_1[_0x55341f(0x113)]['sendPaymentNotification'](_0x1de51a,_0x531150,'paid');break;case'payout':const _0x5f3037={'id':_0x55341f(0x10a),'amount':_0x340e02?.[_0x55341f(0x115)]||0x1f4,'method':_0x340e02?.[_0x55341f(0xfc)]||'bank_transfer','createdAt':new Date(),..._0x340e02};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x1de51a,_0x5f3037,'completed');break;case _0x55341f(0xe4):await telegramBotService_1[_0x55341f(0x113)][_0x55341f(0x110)](_0x1de51a,_0x340e02?.['title']||_0x55341f(0x114),_0x340e02?.['details']||{'message':_0x55341f(0xe6)});break;default:return _0x27b40d[_0x55341f(0xf2)](0x190)[_0x55341f(0xeb)]({'success':![],'message':_0x55341f(0xfa)});}_0x27b40d[_0x55341f(0xeb)]({'success':!![],'message':_0x55341f(0xf5)+type+_0x55341f(0x112)});}catch(_0x44d6a0){_0x35f59e(_0x44d6a0);}};}}function a12_0x51ac(_0x18239d,_0x172022){const _0x285a74=a12_0x285a();return a12_0x51ac=function(_0x51ac65,_0x579367){_0x51ac65=_0x51ac65-0xd7;let _0x43b784=_0x285a74[_0x51ac65];return _0x43b784;},a12_0x51ac(_0x18239d,_0x172022);}exports[a12_0x160e8d(0xee)]=TelegramController;