'use strict';const a12_0xc52a1b=a12_0x5952;(function(_0x36acb9,_0x57e207){const _0x518355=a12_0x5952,_0x5b89e8=_0x36acb9();while(!![]){try{const _0x54c872=parseInt(_0x518355(0xa6))/0x1+parseInt(_0x518355(0x9c))/0x2*(-parseInt(_0x518355(0x8a))/0x3)+parseInt(_0x518355(0x7c))/0x4*(parseInt(_0x518355(0x9e))/0x5)+-parseInt(_0x518355(0x6a))/0x6+parseInt(_0x518355(0x97))/0x7+parseInt(_0x518355(0xa5))/0x8*(-parseInt(_0x518355(0x96))/0x9)+parseInt(_0x518355(0x91))/0xa*(parseInt(_0x518355(0x7e))/0xb);if(_0x54c872===_0x57e207)break;else _0x5b89e8['push'](_0x5b89e8['shift']());}catch(_0x6e2597){_0x5b89e8['push'](_0x5b89e8['shift']());}}}(a12_0x54fa,0xf124c));function a12_0x5952(_0x55f46d,_0x51afbe){const _0x54fa0a=a12_0x54fa();return a12_0x5952=function(_0x5952a4,_0x4ec32e){_0x5952a4=_0x5952a4-0x6a;let _0x47d219=_0x54fa0a[_0x5952a4];return _0x47d219;},a12_0x5952(_0x55f46d,_0x51afbe);}function a12_0x54fa(){const _0x5c1a70=['length','true','4bYOzMq','sendPaymentNotification','210892enAiyN','createdAt','findMany','amount','query','sendShopNotification','ceil','Telegram\x20user\x20not\x20found','bank_transfer','Broadcast\x20message\x20sent\x20successfully','telegramId','update','966279wmkIyF','Test\x20','gateway','sendCustomNotification','desc','shopId','../services/telegramBotService','170ORhDZt','groupBy','all','params','../config/database','108zsjmfL','8578941IRYYSR','__importDefault','custom','isActive','test_payout_123','6ySWHgB','default','9451435CFPzsv','count','title','\x20notification\x20sent\x20successfully','body','shop','plisio','141544mnYZGj','113508SwCwIV','sendTestNotification','map','Shop\x20ID\x20is\x20required','sendBroadcast','sendPayoutNotification','productName','username','USD','Test\x20Notification','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','payment','paid','updatedAt','findUnique','payout','8333778nBKmZT','currency','details','status','lastName','filter','TelegramController','defineProperty','json','telegramBotService','Markdown','firstName','Shop\x20not\x20found','test_payment_123','telegramUser','isVerified'];a12_0x54fa=function(){return _0x5c1a70;};return a12_0x54fa();}var __importDefault=this&&this[a12_0xc52a1b(0x98)]||function(_0x569c2b){return _0x569c2b&&_0x569c2b['__esModule']?_0x569c2b:{'default':_0x569c2b};};Object[a12_0xc52a1b(0x71)](exports,'__esModule',{'value':!![]}),exports[a12_0xc52a1b(0x70)]=void 0x0;const telegramBotService_1=require(a12_0xc52a1b(0x90)),database_1=__importDefault(require(a12_0xc52a1b(0x95)));class TelegramController{constructor(){const _0x3449ca=a12_0xc52a1b;this['getBotStatus']=async(_0x4a0ef1,_0x278202,_0x154ea3)=>{const _0x849f0d=a12_0x5952;try{const _0x25a821=telegramBotService_1['telegramBotService']['getBotInfo'](),_0x51fef6=await database_1[_0x849f0d(0x9d)][_0x849f0d(0x78)][_0x849f0d(0x9f)](),_0x328dc3=await database_1['default'][_0x849f0d(0x78)][_0x849f0d(0x9f)]({'where':{'isVerified':!![]}}),_0x468abc=await database_1['default'][_0x849f0d(0x78)][_0x849f0d(0x92)]({'by':[_0x849f0d(0x8f)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x278202[_0x849f0d(0x72)]({'success':!![],'result':{'bot':{'isActive':_0x25a821[_0x849f0d(0x9a)],'username':_0x25a821[_0x849f0d(0xad)]},'statistics':{'totalUsers':_0x51fef6,'verifiedUsers':_0x328dc3,'unverifiedUsers':_0x51fef6-_0x328dc3,'connectedShops':_0x468abc[_0x849f0d(0x7a)]}}});}catch(_0x43fad2){_0x154ea3(_0x43fad2);}},this['getTelegramUsers']=async(_0x1ef19d,_0xcaa684,_0x2b76cb)=>{const _0xd82254=a12_0x5952;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1bd143}=_0x1ef19d[_0xd82254(0x82)],_0x38d363=(Number(page)-0x1)*Number(limit),_0x5816bc={};_0x1bd143!==undefined&&(_0x5816bc['isVerified']=_0x1bd143===_0xd82254(0x7b));const [_0x3a1727,_0x32ace4]=await Promise[_0xd82254(0x93)]([database_1[_0xd82254(0x9d)][_0xd82254(0x78)][_0xd82254(0x80)]({'where':_0x5816bc,'skip':_0x38d363,'take':Number(limit),'orderBy':{'createdAt':_0xd82254(0x8e)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0xd82254(0x9d)][_0xd82254(0x78)][_0xd82254(0x9f)]({'where':_0x5816bc})]);_0xcaa684[_0xd82254(0x72)]({'success':!![],'users':_0x3a1727[_0xd82254(0xa8)](_0x10cbe7=>({'id':_0x10cbe7['id'],'telegramId':_0x10cbe7[_0xd82254(0x88)],'username':_0x10cbe7[_0xd82254(0xad)],'firstName':_0x10cbe7[_0xd82254(0x75)],'lastName':_0x10cbe7[_0xd82254(0x6e)],'isVerified':_0x10cbe7[_0xd82254(0x79)],'shop':_0x10cbe7[_0xd82254(0xa3)],'createdAt':_0x10cbe7[_0xd82254(0x7f)],'updatedAt':_0x10cbe7[_0xd82254(0xb3)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x32ace4,'totalPages':Math[_0xd82254(0x84)](_0x32ace4/Number(limit))}});}catch(_0x8d4952){_0x2b76cb(_0x8d4952);}},this[_0x3449ca(0xaa)]=async(_0x49a268,_0x35b99c,_0x7557d6)=>{const _0x596303=_0x3449ca;try{const {message:_0x18c3d8,shopId:_0x5ddaf3}=_0x49a268[_0x596303(0xa2)];if(!_0x18c3d8)return _0x35b99c[_0x596303(0x6d)](0x190)[_0x596303(0x72)]({'success':![],'message':'Message\x20is\x20required'});if(_0x5ddaf3)await telegramBotService_1['telegramBotService'][_0x596303(0x83)](_0x5ddaf3,_0x18c3d8,{'parse_mode':_0x596303(0x74)});else{const _0xbfb9d6=await database_1['default']['telegramUser'][_0x596303(0x80)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3b9290=[...new Set(_0xbfb9d6['map'](_0x43b093=>_0x43b093['shopId'])[_0x596303(0x6f)](Boolean))];for(const _0x3fd4b8 of _0x3b9290){_0x3fd4b8&&await telegramBotService_1[_0x596303(0x73)][_0x596303(0x83)](_0x3fd4b8,_0x18c3d8,{'parse_mode':_0x596303(0x74)});}}_0x35b99c['json']({'success':!![],'message':_0x596303(0x87)});}catch(_0x16750a){_0x7557d6(_0x16750a);}},this['disconnectUser']=async(_0x2cdb63,_0x528fda,_0x155b94)=>{const _0x572835=_0x3449ca;try{const {telegramId:_0x40b75d}=_0x2cdb63[_0x572835(0x94)],_0x18a7cc=await database_1[_0x572835(0x9d)][_0x572835(0x78)][_0x572835(0xb4)]({'where':{'telegramId':_0x40b75d},'include':{'shop':!![]}});if(!_0x18a7cc)return _0x528fda[_0x572835(0x6d)](0x194)[_0x572835(0x72)]({'success':![],'message':_0x572835(0x85)});await database_1['default']['telegramUser'][_0x572835(0x89)]({'where':{'telegramId':_0x40b75d},'data':{'shopId':null,'isVerified':![]}}),_0x528fda['json']({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x31a726){_0x155b94(_0x31a726);}},this[_0x3449ca(0xa7)]=async(_0x3a2657,_0x56112d,_0x1685e9)=>{const _0x2aa0c0=_0x3449ca;try{const {shopId:_0x65af8e,type:type=_0x2aa0c0(0xb1),testData:_0x4fd82d}=_0x3a2657[_0x2aa0c0(0xa2)];if(!_0x65af8e)return _0x56112d[_0x2aa0c0(0x6d)](0x190)[_0x2aa0c0(0x72)]({'success':![],'message':_0x2aa0c0(0xa9)});const _0x1acb50=await database_1[_0x2aa0c0(0x9d)][_0x2aa0c0(0xa3)]['findUnique']({'where':{'id':_0x65af8e},'select':{'id':!![],'name':!![]}});if(!_0x1acb50)return _0x56112d[_0x2aa0c0(0x6d)](0x194)[_0x2aa0c0(0x72)]({'success':![],'message':_0x2aa0c0(0x76)});switch(type){case _0x2aa0c0(0xb1):const _0x196e7c={'id':_0x2aa0c0(0x77),'amount':_0x4fd82d?.[_0x2aa0c0(0x81)]||0x64,'currency':_0x4fd82d?.[_0x2aa0c0(0x6b)]||_0x2aa0c0(0xae),'productName':_0x4fd82d?.[_0x2aa0c0(0xac)]||'Test\x20Product','gateway':_0x4fd82d?.[_0x2aa0c0(0x8c)]||_0x2aa0c0(0xa4),'createdAt':new Date(),..._0x4fd82d};await telegramBotService_1['telegramBotService'][_0x2aa0c0(0x7d)](_0x65af8e,_0x196e7c,_0x2aa0c0(0xb2));break;case _0x2aa0c0(0xb5):const _0xbf6abe={'id':_0x2aa0c0(0x9b),'amount':_0x4fd82d?.[_0x2aa0c0(0x81)]||0x1f4,'method':_0x4fd82d?.['method']||_0x2aa0c0(0x86),'createdAt':new Date(),..._0x4fd82d};await telegramBotService_1[_0x2aa0c0(0x73)][_0x2aa0c0(0xab)](_0x65af8e,_0xbf6abe,'completed');break;case _0x2aa0c0(0x99):await telegramBotService_1[_0x2aa0c0(0x73)][_0x2aa0c0(0x8d)](_0x65af8e,_0x4fd82d?.[_0x2aa0c0(0xa0)]||_0x2aa0c0(0xaf),_0x4fd82d?.[_0x2aa0c0(0x6c)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x56112d[_0x2aa0c0(0x6d)](0x190)[_0x2aa0c0(0x72)]({'success':![],'message':_0x2aa0c0(0xb0)});}_0x56112d[_0x2aa0c0(0x72)]({'success':!![],'message':_0x2aa0c0(0x8b)+type+_0x2aa0c0(0xa1)});}catch(_0x4e9e61){_0x1685e9(_0x4e9e61);}};}}exports[a12_0xc52a1b(0x70)]=TelegramController;