'use strict';const a12_0x39dcd4=a12_0x56a9;(function(_0x5377d9,_0x559757){const _0x31b0b6=a12_0x56a9,_0x3fa8e9=_0x5377d9();while(!![]){try{const _0x3421d7=parseInt(_0x31b0b6(0x1d8))/0x1+parseInt(_0x31b0b6(0x1da))/0x2+parseInt(_0x31b0b6(0x1a3))/0x3*(-parseInt(_0x31b0b6(0x1bb))/0x4)+parseInt(_0x31b0b6(0x1bd))/0x5*(-parseInt(_0x31b0b6(0x1ae))/0x6)+parseInt(_0x31b0b6(0x1d4))/0x7+parseInt(_0x31b0b6(0x1ab))/0x8+-parseInt(_0x31b0b6(0x1c2))/0x9;if(_0x3421d7===_0x559757)break;else _0x3fa8e9['push'](_0x3fa8e9['shift']());}catch(_0x64f6a3){_0x3fa8e9['push'](_0x3fa8e9['shift']());}}}(a12_0x3622,0x248d5));function a12_0x3622(){const _0x135bc7=['currency','sendCustomNotification','TelegramController','231623ELSPdo','test_payout_123','276806DaCrrT','getTelegramUsers','Test\x20Notification','Message\x20is\x20required','Test\x20Product','true','groupBy','productName','USD','sendTestNotification','createdAt','completed','Broadcast\x20message\x20sent\x20successfully','test_payment_123','shop','3KmirML','length','plisio','lastName','details','firstName','body','telegramBotService','1365976BgATmg','Markdown','defineProperty','7602cQpcgI','status','sendShopNotification','updatedAt','Shop\x20ID\x20is\x20required','Shop\x20not\x20found','Telegram\x20user\x20not\x20found','../services/telegramBotService','../config/database','telegramId','json','amount','username','570596FBYPdz','findUnique','380UrbIIk','desc','gateway','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','shopId','2449053qEnEUE','\x20notification\x20sent\x20successfully','getBotInfo','sendPaymentNotification','params','bank_transfer','isVerified','findMany','telegramUser','all','method','count','__importDefault','filter','custom','payment','Test\x20','default','840014GQztRS'];a12_0x3622=function(){return _0x135bc7;};return a12_0x3622();}var __importDefault=this&&this[a12_0x39dcd4(0x1ce)]||function(_0x59fb15){return _0x59fb15&&_0x59fb15['__esModule']?_0x59fb15:{'default':_0x59fb15};};Object[a12_0x39dcd4(0x1ad)](exports,'__esModule',{'value':!![]}),exports[a12_0x39dcd4(0x1d7)]=void 0x0;const telegramBotService_1=require(a12_0x39dcd4(0x1b5)),database_1=__importDefault(require(a12_0x39dcd4(0x1b6)));class TelegramController{constructor(){const _0x18634f=a12_0x39dcd4;this['getBotStatus']=async(_0x52fe81,_0x1f18c2,_0x11bd80)=>{const _0x341c75=a12_0x56a9;try{const _0x1151f4=telegramBotService_1[_0x341c75(0x1aa)][_0x341c75(0x1c4)](),_0x24e03c=await database_1[_0x341c75(0x1d3)][_0x341c75(0x1ca)][_0x341c75(0x1cd)](),_0x4256d1=await database_1[_0x341c75(0x1d3)][_0x341c75(0x1ca)]['count']({'where':{'isVerified':!![]}}),_0x7d2077=await database_1[_0x341c75(0x1d3)][_0x341c75(0x1ca)][_0x341c75(0x1e0)]({'by':[_0x341c75(0x1c1)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1f18c2[_0x341c75(0x1b8)]({'success':!![],'result':{'bot':{'isActive':_0x1151f4['isActive'],'username':_0x1151f4[_0x341c75(0x1ba)]},'statistics':{'totalUsers':_0x24e03c,'verifiedUsers':_0x4256d1,'unverifiedUsers':_0x24e03c-_0x4256d1,'connectedShops':_0x7d2077[_0x341c75(0x1a4)]}}});}catch(_0x440b06){_0x11bd80(_0x440b06);}},this[_0x18634f(0x1db)]=async(_0x5ac4d3,_0x2fd9ed,_0x16a176)=>{const _0x4c86d1=_0x18634f;try{const {page:page=0x1,limit:limit=0x14,verified:_0x260e0e}=_0x5ac4d3['query'],_0x57f304=(Number(page)-0x1)*Number(limit),_0x1b5244={};_0x260e0e!==undefined&&(_0x1b5244[_0x4c86d1(0x1c8)]=_0x260e0e===_0x4c86d1(0x1df));const [_0x1d6b22,_0x109ebd]=await Promise[_0x4c86d1(0x1cb)]([database_1[_0x4c86d1(0x1d3)][_0x4c86d1(0x1ca)][_0x4c86d1(0x1c9)]({'where':_0x1b5244,'skip':_0x57f304,'take':Number(limit),'orderBy':{'createdAt':_0x4c86d1(0x1be)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['telegramUser']['count']({'where':_0x1b5244})]);_0x2fd9ed[_0x4c86d1(0x1b8)]({'success':!![],'users':_0x1d6b22['map'](_0x13622c=>({'id':_0x13622c['id'],'telegramId':_0x13622c[_0x4c86d1(0x1b7)],'username':_0x13622c[_0x4c86d1(0x1ba)],'firstName':_0x13622c[_0x4c86d1(0x1a8)],'lastName':_0x13622c[_0x4c86d1(0x1a6)],'isVerified':_0x13622c['isVerified'],'shop':_0x13622c['shop'],'createdAt':_0x13622c[_0x4c86d1(0x19e)],'updatedAt':_0x13622c[_0x4c86d1(0x1b1)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x109ebd,'totalPages':Math['ceil'](_0x109ebd/Number(limit))}});}catch(_0x4c0716){_0x16a176(_0x4c0716);}},this['sendBroadcast']=async(_0x5b92bb,_0x30cace,_0x1e5fcd)=>{const _0x26542c=_0x18634f;try{const {message:_0x3bcaa3,shopId:_0x3ee19d}=_0x5b92bb['body'];if(!_0x3bcaa3)return _0x30cace[_0x26542c(0x1af)](0x190)['json']({'success':![],'message':_0x26542c(0x1dd)});if(_0x3ee19d)await telegramBotService_1[_0x26542c(0x1aa)][_0x26542c(0x1b0)](_0x3ee19d,_0x3bcaa3,{'parse_mode':_0x26542c(0x1ac)});else{const _0x91846=await database_1[_0x26542c(0x1d3)][_0x26542c(0x1ca)][_0x26542c(0x1c9)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x34911d=[...new Set(_0x91846['map'](_0x314e5a=>_0x314e5a[_0x26542c(0x1c1)])[_0x26542c(0x1cf)](Boolean))];for(const _0x516211 of _0x34911d){_0x516211&&await telegramBotService_1['telegramBotService'][_0x26542c(0x1b0)](_0x516211,_0x3bcaa3,{'parse_mode':'Markdown'});}}_0x30cace[_0x26542c(0x1b8)]({'success':!![],'message':_0x26542c(0x1a0)});}catch(_0x5821cb){_0x1e5fcd(_0x5821cb);}},this['disconnectUser']=async(_0x4a4610,_0x43af6a,_0x316103)=>{const _0x2826ba=_0x18634f;try{const {telegramId:_0x2d1084}=_0x4a4610[_0x2826ba(0x1c6)],_0x5545d3=await database_1[_0x2826ba(0x1d3)]['telegramUser'][_0x2826ba(0x1bc)]({'where':{'telegramId':_0x2d1084},'include':{'shop':!![]}});if(!_0x5545d3)return _0x43af6a[_0x2826ba(0x1af)](0x194)[_0x2826ba(0x1b8)]({'success':![],'message':_0x2826ba(0x1b4)});await database_1[_0x2826ba(0x1d3)][_0x2826ba(0x1ca)]['update']({'where':{'telegramId':_0x2d1084},'data':{'shopId':null,'isVerified':![]}}),_0x43af6a[_0x2826ba(0x1b8)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x2bf266){_0x316103(_0x2bf266);}},this[_0x18634f(0x1e3)]=async(_0x32e2d7,_0x21bbba,_0x1555f7)=>{const _0x145420=_0x18634f;try{const {shopId:_0x555370,type:type=_0x145420(0x1d1),testData:_0x4285d9}=_0x32e2d7[_0x145420(0x1a9)];if(!_0x555370)return _0x21bbba[_0x145420(0x1af)](0x190)[_0x145420(0x1b8)]({'success':![],'message':_0x145420(0x1b2)});const _0x4d3db6=await database_1[_0x145420(0x1d3)][_0x145420(0x1a2)][_0x145420(0x1bc)]({'where':{'id':_0x555370},'select':{'id':!![],'name':!![]}});if(!_0x4d3db6)return _0x21bbba[_0x145420(0x1af)](0x194)['json']({'success':![],'message':_0x145420(0x1b3)});switch(type){case _0x145420(0x1d1):const _0x7b0ee4={'id':_0x145420(0x1a1),'amount':_0x4285d9?.[_0x145420(0x1b9)]||0x64,'currency':_0x4285d9?.[_0x145420(0x1d5)]||_0x145420(0x1e2),'productName':_0x4285d9?.[_0x145420(0x1e1)]||_0x145420(0x1de),'gateway':_0x4285d9?.[_0x145420(0x1bf)]||_0x145420(0x1a5),'createdAt':new Date(),..._0x4285d9};await telegramBotService_1['telegramBotService'][_0x145420(0x1c5)](_0x555370,_0x7b0ee4,'paid');break;case'payout':const _0x5334e2={'id':_0x145420(0x1d9),'amount':_0x4285d9?.[_0x145420(0x1b9)]||0x1f4,'method':_0x4285d9?.[_0x145420(0x1cc)]||_0x145420(0x1c7),'createdAt':new Date(),..._0x4285d9};await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x555370,_0x5334e2,_0x145420(0x19f));break;case _0x145420(0x1d0):await telegramBotService_1[_0x145420(0x1aa)][_0x145420(0x1d6)](_0x555370,_0x4285d9?.['title']||_0x145420(0x1dc),_0x4285d9?.[_0x145420(0x1a7)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x21bbba[_0x145420(0x1af)](0x190)['json']({'success':![],'message':_0x145420(0x1c0)});}_0x21bbba[_0x145420(0x1b8)]({'success':!![],'message':_0x145420(0x1d2)+type+_0x145420(0x1c3)});}catch(_0x5b685c){_0x1555f7(_0x5b685c);}};}}function a12_0x56a9(_0x10b8f6,_0x2c6c59){const _0x3622eb=a12_0x3622();return a12_0x56a9=function(_0x56a906,_0x2e981a){_0x56a906=_0x56a906-0x19e;let _0x48c992=_0x3622eb[_0x56a906];return _0x48c992;},a12_0x56a9(_0x10b8f6,_0x2c6c59);}exports[a12_0x39dcd4(0x1d7)]=TelegramController;