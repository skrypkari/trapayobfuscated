'use strict';const a18_0x59daf1=a18_0x1c7d;(function(_0x39bfa1,_0x3e6cdc){const _0x16d3c3=a18_0x1c7d,_0x3fe7f7=_0x39bfa1();while(!![]){try{const _0x249882=-parseInt(_0x16d3c3(0x97))/0x1*(-parseInt(_0x16d3c3(0xd5))/0x2)+-parseInt(_0x16d3c3(0xd1))/0x3+parseInt(_0x16d3c3(0xbc))/0x4*(-parseInt(_0x16d3c3(0xae))/0x5)+parseInt(_0x16d3c3(0xc0))/0x6*(-parseInt(_0x16d3c3(0xa9))/0x7)+parseInt(_0x16d3c3(0xd9))/0x8+-parseInt(_0x16d3c3(0xa2))/0x9*(-parseInt(_0x16d3c3(0xa3))/0xa)+parseInt(_0x16d3c3(0xb5))/0xb;if(_0x249882===_0x3e6cdc)break;else _0x3fe7f7['push'](_0x3fe7f7['shift']());}catch(_0xc7c7d){_0x3fe7f7['push'](_0x3fe7f7['shift']());}}}(a18_0x43e4,0x9e788));var __importDefault=this&&this[a18_0x59daf1(0x9d)]||function(_0x41d1b4){const _0x277aa8=a18_0x59daf1;return _0x41d1b4&&_0x41d1b4[_0x277aa8(0xd7)]?_0x41d1b4:{'default':_0x41d1b4};};function a18_0x43e4(){const _0x3d45d2=['sendPayoutNotification','526624KTRGSD','sendPaymentNotification','body','network','payout','Test\x20Notification','json','Broadcast\x20message\x20sent\x20successfully','wallet','telegramUser','3QNWcMC','desc','findUnique','TRC20','count','default','__importDefault','shop','updatedAt','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','2232639LdPBQb','20fmzpOG','findMany','Test\x20Product','currency','ceil','test_payment_123','8818341qJrxDy','User\x20disconnected\x20successfully','true','sendShopNotification','plisio','1682555FZooPy','all','sendBroadcast','payment','username','../config/database','\x20notification\x20sent\x20successfully','21295857qLtDcn','lastName','update','map','query','shopId','telegramBotService','4rjTYPM','disconnectUser','filter','../services/telegramBotService','6gyMGkk','firstName','sendCustomNotification','TelegramController','details','Shop\x20ID\x20is\x20required','Markdown','Message\x20is\x20required','txid','test_payout_123','status','Telegram\x20user\x20not\x20found','getBotStatus','title','groupBy','amount','Test\x20','825045CmlFbq','length','sendTestNotification','isVerified','14952lMlZzH','getBotInfo','__esModule'];a18_0x43e4=function(){return _0x3d45d2;};return a18_0x43e4();}Object['defineProperty'](exports,a18_0x59daf1(0xd7),{'value':!![]}),exports[a18_0x59daf1(0xc3)]=void 0x0;const telegramBotService_1=require(a18_0x59daf1(0xbf)),database_1=__importDefault(require(a18_0x59daf1(0xb3)));function a18_0x1c7d(_0x451f89,_0x3ab8c5){_0x451f89=_0x451f89-0x96;const _0x43e47c=a18_0x43e4();let _0x1c7d35=_0x43e47c[_0x451f89];return _0x1c7d35;}class TelegramController{constructor(){const _0xdf8987=a18_0x59daf1;this[_0xdf8987(0xcc)]=async(_0x26d55f,_0x16c467,_0x312e1a)=>{const _0x1d825a=_0xdf8987;try{const _0x38eda8=telegramBotService_1[_0x1d825a(0xbb)][_0x1d825a(0xd6)](),_0x302673=await database_1[_0x1d825a(0x9c)][_0x1d825a(0x96)][_0x1d825a(0x9b)](),_0x49ce1f=await database_1[_0x1d825a(0x9c)][_0x1d825a(0x96)][_0x1d825a(0x9b)]({'where':{'isVerified':!![]}}),_0x1ff5b9=await database_1['default']['telegramUser'][_0x1d825a(0xce)]({'by':[_0x1d825a(0xba)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x16c467[_0x1d825a(0xdf)]({'success':!![],'result':{'bot':{'isActive':_0x38eda8['isActive'],'username':_0x38eda8[_0x1d825a(0xb2)]},'statistics':{'totalUsers':_0x302673,'verifiedUsers':_0x49ce1f,'unverifiedUsers':_0x302673-_0x49ce1f,'connectedShops':_0x1ff5b9[_0x1d825a(0xd2)]}}});}catch(_0x59016d){_0x312e1a(_0x59016d);}},this['getTelegramUsers']=async(_0x23645f,_0x160b9b,_0x253cdb)=>{const _0x17f2e6=_0xdf8987;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2cb70e}=_0x23645f[_0x17f2e6(0xb9)],_0x28d552=(Number(page)-0x1)*Number(limit),_0x2df020={};_0x2cb70e!==undefined&&(_0x2df020[_0x17f2e6(0xd4)]=_0x2cb70e===_0x17f2e6(0xab));const [_0xcbcbce,_0x1f5734]=await Promise[_0x17f2e6(0xaf)]([database_1['default']['telegramUser'][_0x17f2e6(0xa4)]({'where':_0x2df020,'skip':_0x28d552,'take':Number(limit),'orderBy':{'createdAt':_0x17f2e6(0x98)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x17f2e6(0x96)]['count']({'where':_0x2df020})]);_0x160b9b[_0x17f2e6(0xdf)]({'success':!![],'users':_0xcbcbce[_0x17f2e6(0xb8)](_0xfe03f8=>({'id':_0xfe03f8['id'],'telegramId':_0xfe03f8['telegramId'],'username':_0xfe03f8[_0x17f2e6(0xb2)],'firstName':_0xfe03f8[_0x17f2e6(0xc1)],'lastName':_0xfe03f8[_0x17f2e6(0xb6)],'isVerified':_0xfe03f8[_0x17f2e6(0xd4)],'shop':_0xfe03f8[_0x17f2e6(0x9e)],'createdAt':_0xfe03f8['createdAt'],'updatedAt':_0xfe03f8[_0x17f2e6(0x9f)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1f5734,'totalPages':Math[_0x17f2e6(0xa7)](_0x1f5734/Number(limit))}});}catch(_0x1f7907){_0x253cdb(_0x1f7907);}},this[_0xdf8987(0xb0)]=async(_0xccd427,_0x3bcce1,_0xb2950b)=>{const _0x41864a=_0xdf8987;try{const {message:_0x2c9ffd,shopId:_0x1c5cf7}=_0xccd427[_0x41864a(0xdb)];if(!_0x2c9ffd)return _0x3bcce1[_0x41864a(0xca)](0x190)[_0x41864a(0xdf)]({'success':![],'message':_0x41864a(0xc7)});if(_0x1c5cf7)await telegramBotService_1[_0x41864a(0xbb)][_0x41864a(0xac)](_0x1c5cf7,_0x2c9ffd,{'parse_mode':_0x41864a(0xc6)});else{const _0x2f795c=await database_1[_0x41864a(0x9c)][_0x41864a(0x96)][_0x41864a(0xa4)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4eac5d=[...new Set(_0x2f795c[_0x41864a(0xb8)](_0xd181b3=>_0xd181b3[_0x41864a(0xba)])[_0x41864a(0xbe)](Boolean))];for(const _0x26a0b8 of _0x4eac5d){_0x26a0b8&&await telegramBotService_1[_0x41864a(0xbb)][_0x41864a(0xac)](_0x26a0b8,_0x2c9ffd,{'parse_mode':_0x41864a(0xc6)});}}_0x3bcce1[_0x41864a(0xdf)]({'success':!![],'message':_0x41864a(0xe0)});}catch(_0x5d52b2){_0xb2950b(_0x5d52b2);}},this[_0xdf8987(0xbd)]=async(_0x2c594b,_0x75b3c0,_0x4193a8)=>{const _0x4a26fd=_0xdf8987;try{const {telegramId:_0x5d0de6}=_0x2c594b['params'],_0x867bf0=await database_1[_0x4a26fd(0x9c)]['telegramUser'][_0x4a26fd(0x99)]({'where':{'telegramId':_0x5d0de6},'include':{'shop':!![]}});if(!_0x867bf0)return _0x75b3c0[_0x4a26fd(0xca)](0x194)[_0x4a26fd(0xdf)]({'success':![],'message':_0x4a26fd(0xcb)});await database_1[_0x4a26fd(0x9c)][_0x4a26fd(0x96)][_0x4a26fd(0xb7)]({'where':{'telegramId':_0x5d0de6},'data':{'shopId':null,'isVerified':![]}}),_0x75b3c0[_0x4a26fd(0xdf)]({'success':!![],'message':_0x4a26fd(0xaa)});}catch(_0x1af9d9){_0x4193a8(_0x1af9d9);}},this[_0xdf8987(0xd3)]=async(_0x1924ed,_0x481a9d,_0x467217)=>{const _0xeea5c7=_0xdf8987;try{const {shopId:_0xd83e8a,type:type=_0xeea5c7(0xb1),testData:_0x34ff35}=_0x1924ed['body'];if(!_0xd83e8a)return _0x481a9d[_0xeea5c7(0xca)](0x190)[_0xeea5c7(0xdf)]({'success':![],'message':_0xeea5c7(0xc5)});const _0x336c26=await database_1['default']['shop']['findUnique']({'where':{'id':_0xd83e8a},'select':{'id':!![],'name':!![]}});if(!_0x336c26)return _0x481a9d[_0xeea5c7(0xca)](0x194)['json']({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0xeea5c7(0xb1):const _0x13050a={'id':_0xeea5c7(0xa8),'amount':_0x34ff35?.[_0xeea5c7(0xcf)]||0x64,'currency':_0x34ff35?.[_0xeea5c7(0xa6)]||'USD','productName':_0x34ff35?.['productName']||_0xeea5c7(0xa5),'gateway':_0x34ff35?.['gateway']||_0xeea5c7(0xad),'createdAt':new Date(),..._0x34ff35};await telegramBotService_1[_0xeea5c7(0xbb)][_0xeea5c7(0xda)](_0xd83e8a,_0x13050a,'paid');break;case _0xeea5c7(0xdd):const _0x25be8a={'id':_0xeea5c7(0xc9),'amount':_0x34ff35?.['amount']||0x1f4,'network':_0x34ff35?.[_0xeea5c7(0xdc)]||_0xeea5c7(0x9a),'wallet':_0x34ff35?.[_0xeea5c7(0xe1)]||_0xeea5c7(0xa0),'period':'Тестовый\x20период','createdAt':new Date(),'txid':_0x34ff35?.[_0xeea5c7(0xc8)]||null,..._0x34ff35};await telegramBotService_1[_0xeea5c7(0xbb)][_0xeea5c7(0xd8)](_0xd83e8a,_0x25be8a);break;case'custom':await telegramBotService_1[_0xeea5c7(0xbb)][_0xeea5c7(0xc2)](_0xd83e8a,_0x34ff35?.[_0xeea5c7(0xcd)]||_0xeea5c7(0xde),_0x34ff35?.[_0xeea5c7(0xc4)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x481a9d[_0xeea5c7(0xca)](0x190)[_0xeea5c7(0xdf)]({'success':![],'message':_0xeea5c7(0xa1)});}_0x481a9d[_0xeea5c7(0xdf)]({'success':!![],'message':_0xeea5c7(0xd0)+type+_0xeea5c7(0xb4)});}catch(_0x480dfb){_0x467217(_0x480dfb);}};}}exports[a18_0x59daf1(0xc3)]=TelegramController;