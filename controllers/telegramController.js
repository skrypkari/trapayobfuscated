'use strict';const a17_0xee2b6e=a17_0x106b;(function(_0x2d8b23,_0x5f5434){const _0xb669ee=a17_0x106b,_0x32ff83=_0x2d8b23();while(!![]){try{const _0x44f0cf=-parseInt(_0xb669ee(0xc9))/0x1*(parseInt(_0xb669ee(0xd6))/0x2)+parseInt(_0xb669ee(0xc8))/0x3+parseInt(_0xb669ee(0xbc))/0x4+parseInt(_0xb669ee(0x93))/0x5+-parseInt(_0xb669ee(0x98))/0x6*(-parseInt(_0xb669ee(0x97))/0x7)+parseInt(_0xb669ee(0xcd))/0x8*(parseInt(_0xb669ee(0xbe))/0x9)+-parseInt(_0xb669ee(0x9e))/0xa;if(_0x44f0cf===_0x5f5434)break;else _0x32ff83['push'](_0x32ff83['shift']());}catch(_0x4875bf){_0x32ff83['push'](_0x32ff83['shift']());}}}(a17_0x8438,0x6c32c));function a17_0x106b(_0x4e0ca7,_0x107e02){_0x4e0ca7=_0x4e0ca7-0x8e;const _0x84380f=a17_0x8438();let _0x106b4c=_0x84380f[_0x4e0ca7];return _0x106b4c;}var __importDefault=this&&this['__importDefault']||function(_0x13b7d5){const _0x2b60da=a17_0x106b;return _0x13b7d5&&_0x13b7d5[_0x2b60da(0x91)]?_0x13b7d5:{'default':_0x13b7d5};};Object[a17_0xee2b6e(0x9f)](exports,a17_0xee2b6e(0x91),{'value':!![]}),exports[a17_0xee2b6e(0xbf)]=void 0x0;const telegramBotService_1=require(a17_0xee2b6e(0xa0)),database_1=__importDefault(require(a17_0xee2b6e(0xb7)));class TelegramController{constructor(){const _0x4d0743=a17_0xee2b6e;this[_0x4d0743(0xae)]=async(_0x36dd7d,_0x44b97e,_0x1c03ba)=>{const _0x275035=_0x4d0743;try{const _0x5976f5=telegramBotService_1['telegramBotService'][_0x275035(0x94)](),_0x10363e=await database_1[_0x275035(0xcb)][_0x275035(0x96)][_0x275035(0xc4)](),_0x6429fc=await database_1[_0x275035(0xcb)][_0x275035(0x96)]['count']({'where':{'isVerified':!![]}}),_0x171403=await database_1[_0x275035(0xcb)]['telegramUser'][_0x275035(0x9b)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x44b97e[_0x275035(0xc7)]({'success':!![],'result':{'bot':{'isActive':_0x5976f5[_0x275035(0xc1)],'username':_0x5976f5[_0x275035(0x90)]},'statistics':{'totalUsers':_0x10363e,'verifiedUsers':_0x6429fc,'unverifiedUsers':_0x10363e-_0x6429fc,'connectedShops':_0x171403['length']}}});}catch(_0xf128b){_0x1c03ba(_0xf128b);}},this[_0x4d0743(0xd4)]=async(_0x2d6c00,_0x446268,_0xc4f781)=>{const _0x348226=_0x4d0743;try{const {page:page=0x1,limit:limit=0x14,verified:_0x24c618}=_0x2d6c00[_0x348226(0xc6)],_0x202bf2=(Number(page)-0x1)*Number(limit),_0x12e3f5={};_0x24c618!==undefined&&(_0x12e3f5[_0x348226(0x8f)]=_0x24c618==='true');const [_0x384f52,_0x3f074d]=await Promise['all']([database_1[_0x348226(0xcb)][_0x348226(0x96)]['findMany']({'where':_0x12e3f5,'skip':_0x202bf2,'take':Number(limit),'orderBy':{'createdAt':_0x348226(0x9a)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x348226(0x96)]['count']({'where':_0x12e3f5})]);_0x446268['json']({'success':!![],'users':_0x384f52['map'](_0xc01981=>({'id':_0xc01981['id'],'telegramId':_0xc01981[_0x348226(0xb1)],'username':_0xc01981['username'],'firstName':_0xc01981[_0x348226(0xa6)],'lastName':_0xc01981[_0x348226(0xa1)],'isVerified':_0xc01981['isVerified'],'shop':_0xc01981['shop'],'createdAt':_0xc01981['createdAt'],'updatedAt':_0xc01981[_0x348226(0xb5)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x3f074d,'totalPages':Math[_0x348226(0xa8)](_0x3f074d/Number(limit))}});}catch(_0x3afef1){_0xc4f781(_0x3afef1);}},this[_0x4d0743(0xc3)]=async(_0x57b3e6,_0x1389ee,_0x28ad97)=>{const _0x3cffc2=_0x4d0743;try{const {message:_0x72de5f,shopId:_0x76d328}=_0x57b3e6['body'];if(!_0x72de5f)return _0x1389ee[_0x3cffc2(0xce)](0x190)[_0x3cffc2(0xc7)]({'success':![],'message':_0x3cffc2(0x9d)});if(_0x76d328)await telegramBotService_1[_0x3cffc2(0xbb)][_0x3cffc2(0xa3)](_0x76d328,_0x72de5f,{'parse_mode':_0x3cffc2(0xd1)});else{const _0x4a8aaa=await database_1[_0x3cffc2(0xcb)][_0x3cffc2(0x96)][_0x3cffc2(0x99)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x27299c=[...new Set(_0x4a8aaa['map'](_0x2e6499=>_0x2e6499[_0x3cffc2(0xaa)])[_0x3cffc2(0xac)](Boolean))];for(const _0xff2fea of _0x27299c){_0xff2fea&&await telegramBotService_1['telegramBotService'][_0x3cffc2(0xa3)](_0xff2fea,_0x72de5f,{'parse_mode':_0x3cffc2(0xd1)});}}_0x1389ee[_0x3cffc2(0xc7)]({'success':!![],'message':_0x3cffc2(0xa2)});}catch(_0x201294){_0x28ad97(_0x201294);}},this[_0x4d0743(0x92)]=async(_0x3315b4,_0x4388ee,_0x59e03f)=>{const _0x4d7314=_0x4d0743;try{const {telegramId:_0x2077f6}=_0x3315b4['params'],_0x46a5c8=await database_1[_0x4d7314(0xcb)]['telegramUser'][_0x4d7314(0xb4)]({'where':{'telegramId':_0x2077f6},'include':{'shop':!![]}});if(!_0x46a5c8)return _0x4388ee[_0x4d7314(0xce)](0x194)[_0x4d7314(0xc7)]({'success':![],'message':_0x4d7314(0xbd)});await database_1[_0x4d7314(0xcb)][_0x4d7314(0x96)][_0x4d7314(0xcf)]({'where':{'telegramId':_0x2077f6},'data':{'shopId':null,'isVerified':![]}}),_0x4388ee['json']({'success':!![],'message':_0x4d7314(0x8e)});}catch(_0x159e79){_0x59e03f(_0x159e79);}},this[_0x4d0743(0xa9)]=async(_0x858c9e,_0x46f7ad,_0x5302e0)=>{const _0x23d69b=_0x4d0743;try{const {shopId:_0x45aadd,type:type=_0x23d69b(0xa5),testData:_0x2129a3}=_0x858c9e[_0x23d69b(0xb9)];if(!_0x45aadd)return _0x46f7ad[_0x23d69b(0xce)](0x190)[_0x23d69b(0xc7)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x2422b7=await database_1[_0x23d69b(0xcb)][_0x23d69b(0xd2)][_0x23d69b(0xb4)]({'where':{'id':_0x45aadd},'select':{'id':!![],'name':!![]}});if(!_0x2422b7)return _0x46f7ad['status'](0x194)[_0x23d69b(0xc7)]({'success':![],'message':_0x23d69b(0xd5)});switch(type){case _0x23d69b(0xa5):const _0x5537cc={'id':_0x23d69b(0xab),'amount':_0x2129a3?.[_0x23d69b(0xb3)]||0x64,'currency':_0x2129a3?.[_0x23d69b(0xca)]||'USD','productName':_0x2129a3?.[_0x23d69b(0x9c)]||_0x23d69b(0x95),'gateway':_0x2129a3?.[_0x23d69b(0xd0)]||_0x23d69b(0xb8),'createdAt':new Date(),..._0x2129a3};await telegramBotService_1[_0x23d69b(0xbb)][_0x23d69b(0xd3)](_0x45aadd,_0x5537cc,_0x23d69b(0xcc));break;case _0x23d69b(0xad):const _0x508a64={'id':'test_payout_123','amount':_0x2129a3?.[_0x23d69b(0xb3)]||0x1f4,'network':_0x2129a3?.['network']||'TRC20','wallet':_0x2129a3?.[_0x23d69b(0xc2)]||_0x23d69b(0xc5),'period':_0x23d69b(0xba),'createdAt':new Date(),'txid':_0x2129a3?.[_0x23d69b(0xc0)]||null,..._0x2129a3};await telegramBotService_1[_0x23d69b(0xbb)]['sendPayoutNotification'](_0x45aadd,_0x508a64);break;case'custom':await telegramBotService_1[_0x23d69b(0xbb)][_0x23d69b(0xa7)](_0x45aadd,_0x2129a3?.[_0x23d69b(0xb6)]||'Test\x20Notification',_0x2129a3?.['details']||{'message':_0x23d69b(0xb0)});break;default:return _0x46f7ad[_0x23d69b(0xce)](0x190)['json']({'success':![],'message':_0x23d69b(0xb2)});}_0x46f7ad[_0x23d69b(0xc7)]({'success':!![],'message':_0x23d69b(0xa4)+type+_0x23d69b(0xaf)});}catch(_0x3a458b){_0x5302e0(_0x3a458b);}};}}exports['TelegramController']=TelegramController;function a17_0x8438(){const _0x4edb53=['3398336RrbiKU','Telegram\x20user\x20not\x20found','2745qtPMHi','TelegramController','txid','isActive','wallet','sendBroadcast','count','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','query','json','1508250IrdSMf','25waGjCB','currency','default','paid','1608GwVoJP','status','update','gateway','Markdown','shop','sendPaymentNotification','getTelegramUsers','Shop\x20not\x20found','62366MmQcVE','User\x20disconnected\x20successfully','isVerified','username','__esModule','disconnectUser','3743575kIlUdh','getBotInfo','Test\x20Product','telegramUser','413CRpwEY','42312zZHMav','findMany','desc','groupBy','productName','Message\x20is\x20required','13556670mmkHgT','defineProperty','../services/telegramBotService','lastName','Broadcast\x20message\x20sent\x20successfully','sendShopNotification','Test\x20','payment','firstName','sendCustomNotification','ceil','sendTestNotification','shopId','test_payment_123','filter','payout','getBotStatus','\x20notification\x20sent\x20successfully','This\x20is\x20a\x20test\x20notification','telegramId','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','amount','findUnique','updatedAt','title','../config/database','plisio','body','Тестовый\x20период','telegramBotService'];a17_0x8438=function(){return _0x4edb53;};return a17_0x8438();}