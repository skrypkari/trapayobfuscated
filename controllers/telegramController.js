'use strict';function a12_0x3b8c(){const _0x33c07c=['shopId','payout','title','This\x20is\x20a\x20test\x20notification','telegramBotService','getBotStatus','payment','1954936gJPEcA','plisio','json','Test\x20','map','sendPayoutNotification','isVerified','default','Markdown','body','test_payout_123','7nAJREH','shop','474424egVzPP','22obXBkr','length','findMany','telegramId','1340ONCdhD','Message\x20is\x20required','Telegram\x20user\x20not\x20found','method','defineProperty','1513190jZtRiM','sendBroadcast','267204iiEAIQ','disconnectUser','lastName','username','bank_transfer','User\x20disconnected\x20successfully','TelegramController','sendShopNotification','Test\x20Product','1497qBmHYh','status','gateway','Shop\x20not\x20found','custom','239041ZgrxjV','Broadcast\x20message\x20sent\x20successfully','USD','filter','query','createdAt','completed','getBotInfo','ceil','update','amount','all','../services/telegramBotService','943938bOfJhz','__esModule','Shop\x20ID\x20is\x20required','count','15pjbFQG','telegramUser','updatedAt','params','details','sendTestNotification','findUnique'];a12_0x3b8c=function(){return _0x33c07c;};return a12_0x3b8c();}const a12_0x23f292=a12_0x2e66;(function(_0xe96ad4,_0x27d140){const _0x1fc634=a12_0x2e66,_0x31a478=_0xe96ad4();while(!![]){try{const _0x39fcaf=parseInt(_0x1fc634(0x19d))/0x1+-parseInt(_0x1fc634(0x183))/0x2+parseInt(_0x1fc634(0x198))/0x3*(parseInt(_0x1fc634(0x188))/0x4)+-parseInt(_0x1fc634(0x168))/0x5*(-parseInt(_0x1fc634(0x18f))/0x6)+parseInt(_0x1fc634(0x181))/0x7*(parseInt(_0x1fc634(0x176))/0x8)+-parseInt(_0x1fc634(0x164))/0x9+parseInt(_0x1fc634(0x18d))/0xa*(-parseInt(_0x1fc634(0x184))/0xb);if(_0x39fcaf===_0x27d140)break;else _0x31a478['push'](_0x31a478['shift']());}catch(_0x3c6073){_0x31a478['push'](_0x31a478['shift']());}}}(a12_0x3b8c,0x220b3));var __importDefault=this&&this['__importDefault']||function(_0x3054c0){const _0x4ee47d=a12_0x2e66;return _0x3054c0&&_0x3054c0[_0x4ee47d(0x165)]?_0x3054c0:{'default':_0x3054c0};};Object[a12_0x23f292(0x18c)](exports,a12_0x23f292(0x165),{'value':!![]}),exports[a12_0x23f292(0x195)]=void 0x0;const telegramBotService_1=require(a12_0x23f292(0x163)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x563d6f=a12_0x23f292;this[_0x563d6f(0x174)]=async(_0x136d7c,_0x32adc4,_0x3749b2)=>{const _0x1e062a=_0x563d6f;try{const _0x112ea0=telegramBotService_1[_0x1e062a(0x173)][_0x1e062a(0x15e)](),_0x23f34b=await database_1[_0x1e062a(0x17d)][_0x1e062a(0x169)][_0x1e062a(0x167)](),_0x3780e5=await database_1[_0x1e062a(0x17d)][_0x1e062a(0x169)][_0x1e062a(0x167)]({'where':{'isVerified':!![]}}),_0x329d51=await database_1[_0x1e062a(0x17d)][_0x1e062a(0x169)]['groupBy']({'by':[_0x1e062a(0x16f)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x32adc4[_0x1e062a(0x178)]({'success':!![],'result':{'bot':{'isActive':_0x112ea0['isActive'],'username':_0x112ea0[_0x1e062a(0x192)]},'statistics':{'totalUsers':_0x23f34b,'verifiedUsers':_0x3780e5,'unverifiedUsers':_0x23f34b-_0x3780e5,'connectedShops':_0x329d51[_0x1e062a(0x185)]}}});}catch(_0x2cfdd3){_0x3749b2(_0x2cfdd3);}},this['getTelegramUsers']=async(_0x5b8594,_0x807b2c,_0x1934f2)=>{const _0x3c46c2=_0x563d6f;try{const {page:page=0x1,limit:limit=0x14,verified:_0x72a8d6}=_0x5b8594[_0x3c46c2(0x1a1)],_0x1c3eb2=(Number(page)-0x1)*Number(limit),_0x1e2a77={};_0x72a8d6!==undefined&&(_0x1e2a77[_0x3c46c2(0x17c)]=_0x72a8d6==='true');const [_0x5cf923,_0x152767]=await Promise[_0x3c46c2(0x162)]([database_1[_0x3c46c2(0x17d)]['telegramUser'][_0x3c46c2(0x186)]({'where':_0x1e2a77,'skip':_0x1c3eb2,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x3c46c2(0x17d)][_0x3c46c2(0x169)][_0x3c46c2(0x167)]({'where':_0x1e2a77})]);_0x807b2c[_0x3c46c2(0x178)]({'success':!![],'users':_0x5cf923[_0x3c46c2(0x17a)](_0x270a1d=>({'id':_0x270a1d['id'],'telegramId':_0x270a1d[_0x3c46c2(0x187)],'username':_0x270a1d['username'],'firstName':_0x270a1d['firstName'],'lastName':_0x270a1d[_0x3c46c2(0x191)],'isVerified':_0x270a1d[_0x3c46c2(0x17c)],'shop':_0x270a1d[_0x3c46c2(0x182)],'createdAt':_0x270a1d[_0x3c46c2(0x1a2)],'updatedAt':_0x270a1d[_0x3c46c2(0x16a)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x152767,'totalPages':Math[_0x3c46c2(0x15f)](_0x152767/Number(limit))}});}catch(_0x352f00){_0x1934f2(_0x352f00);}},this[_0x563d6f(0x18e)]=async(_0x4bea49,_0xb7b1eb,_0x150128)=>{const _0x526dd2=_0x563d6f;try{const {message:_0x1133d1,shopId:_0xe85116}=_0x4bea49[_0x526dd2(0x17f)];if(!_0x1133d1)return _0xb7b1eb[_0x526dd2(0x199)](0x190)[_0x526dd2(0x178)]({'success':![],'message':_0x526dd2(0x189)});if(_0xe85116)await telegramBotService_1[_0x526dd2(0x173)][_0x526dd2(0x196)](_0xe85116,_0x1133d1,{'parse_mode':_0x526dd2(0x17e)});else{const _0x445d4b=await database_1['default'][_0x526dd2(0x169)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1ff230=[...new Set(_0x445d4b[_0x526dd2(0x17a)](_0x4d5c16=>_0x4d5c16[_0x526dd2(0x16f)])[_0x526dd2(0x1a0)](Boolean))];for(const _0x216067 of _0x1ff230){_0x216067&&await telegramBotService_1[_0x526dd2(0x173)][_0x526dd2(0x196)](_0x216067,_0x1133d1,{'parse_mode':_0x526dd2(0x17e)});}}_0xb7b1eb['json']({'success':!![],'message':_0x526dd2(0x19e)});}catch(_0xb7ce0e){_0x150128(_0xb7ce0e);}},this[_0x563d6f(0x190)]=async(_0x221269,_0x246474,_0x3a8194)=>{const _0x5794b0=_0x563d6f;try{const {telegramId:_0x265f38}=_0x221269[_0x5794b0(0x16b)],_0x39d9e8=await database_1[_0x5794b0(0x17d)]['telegramUser'][_0x5794b0(0x16e)]({'where':{'telegramId':_0x265f38},'include':{'shop':!![]}});if(!_0x39d9e8)return _0x246474['status'](0x194)['json']({'success':![],'message':_0x5794b0(0x18a)});await database_1[_0x5794b0(0x17d)][_0x5794b0(0x169)][_0x5794b0(0x160)]({'where':{'telegramId':_0x265f38},'data':{'shopId':null,'isVerified':![]}}),_0x246474[_0x5794b0(0x178)]({'success':!![],'message':_0x5794b0(0x194)});}catch(_0x2f65ab){_0x3a8194(_0x2f65ab);}},this[_0x563d6f(0x16d)]=async(_0x32b3f5,_0x175979,_0x2cbb23)=>{const _0x30df4e=_0x563d6f;try{const {shopId:_0x32d652,type:type=_0x30df4e(0x175),testData:_0x49f042}=_0x32b3f5[_0x30df4e(0x17f)];if(!_0x32d652)return _0x175979[_0x30df4e(0x199)](0x190)[_0x30df4e(0x178)]({'success':![],'message':_0x30df4e(0x166)});const _0x25fdd1=await database_1[_0x30df4e(0x17d)][_0x30df4e(0x182)]['findUnique']({'where':{'id':_0x32d652},'select':{'id':!![],'name':!![]}});if(!_0x25fdd1)return _0x175979[_0x30df4e(0x199)](0x194)[_0x30df4e(0x178)]({'success':![],'message':_0x30df4e(0x19b)});switch(type){case'payment':const _0x2c4db3={'id':'test_payment_123','amount':_0x49f042?.[_0x30df4e(0x161)]||0x64,'currency':_0x49f042?.['currency']||_0x30df4e(0x19f),'productName':_0x49f042?.['productName']||_0x30df4e(0x197),'gateway':_0x49f042?.[_0x30df4e(0x19a)]||_0x30df4e(0x177),'createdAt':new Date(),..._0x49f042};await telegramBotService_1[_0x30df4e(0x173)]['sendPaymentNotification'](_0x32d652,_0x2c4db3,'paid');break;case _0x30df4e(0x170):const _0x186415={'id':_0x30df4e(0x180),'amount':_0x49f042?.[_0x30df4e(0x161)]||0x1f4,'method':_0x49f042?.[_0x30df4e(0x18b)]||_0x30df4e(0x193),'createdAt':new Date(),..._0x49f042};await telegramBotService_1['telegramBotService'][_0x30df4e(0x17b)](_0x32d652,_0x186415,_0x30df4e(0x1a3));break;case _0x30df4e(0x19c):await telegramBotService_1[_0x30df4e(0x173)]['sendCustomNotification'](_0x32d652,_0x49f042?.[_0x30df4e(0x171)]||'Test\x20Notification',_0x49f042?.[_0x30df4e(0x16c)]||{'message':_0x30df4e(0x172)});break;default:return _0x175979[_0x30df4e(0x199)](0x190)[_0x30df4e(0x178)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x175979['json']({'success':!![],'message':_0x30df4e(0x179)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x5785c3){_0x2cbb23(_0x5785c3);}};}}function a12_0x2e66(_0x5eaa8e,_0x355797){const _0x3b8ca1=a12_0x3b8c();return a12_0x2e66=function(_0x2e66d8,_0x12a710){_0x2e66d8=_0x2e66d8-0x15e;let _0x186166=_0x3b8ca1[_0x2e66d8];return _0x186166;},a12_0x2e66(_0x5eaa8e,_0x355797);}exports[a12_0x23f292(0x195)]=TelegramController;