'use strict';const a12_0x4723e4=a12_0x1ffe;(function(_0x13f9f4,_0xea770d){const _0x38f1cc=a12_0x1ffe,_0x20f0c9=_0x13f9f4();while(!![]){try{const _0x36a912=-parseInt(_0x38f1cc(0x215))/0x1+-parseInt(_0x38f1cc(0x1f9))/0x2+-parseInt(_0x38f1cc(0x22c))/0x3+parseInt(_0x38f1cc(0x202))/0x4+-parseInt(_0x38f1cc(0x1f3))/0x5+-parseInt(_0x38f1cc(0x201))/0x6*(-parseInt(_0x38f1cc(0x21a))/0x7)+parseInt(_0x38f1cc(0x207))/0x8;if(_0x36a912===_0xea770d)break;else _0x20f0c9['push'](_0x20f0c9['shift']());}catch(_0x483b3f){_0x20f0c9['push'](_0x20f0c9['shift']());}}}(a12_0x5095,0xc5d9d));function a12_0x1ffe(_0x130128,_0x170352){const _0x509584=a12_0x5095();return a12_0x1ffe=function(_0x1ffe31,_0x520fa6){_0x1ffe31=_0x1ffe31-0x1ee;let _0x5f3037=_0x509584[_0x1ffe31];return _0x5f3037;},a12_0x1ffe(_0x130128,_0x170352);}var __importDefault=this&&this[a12_0x4723e4(0x224)]||function(_0x10e8de){const _0x51cc42=a12_0x4723e4;return _0x10e8de&&_0x10e8de[_0x51cc42(0x212)]?_0x10e8de:{'default':_0x10e8de};};Object[a12_0x4723e4(0x222)](exports,a12_0x4723e4(0x212),{'value':!![]}),exports['TelegramController']=void 0x0;function a12_0x5095(){const _0x1de49f=['getBotStatus','bank_transfer','getTelegramUsers','filter','Test\x20','payout','Shop\x20not\x20found','1685298CReeZW','4674776BHiAbb','default','telegramUser','sendShopNotification','status','17574880kZSOuK','Test\x20Product','all','disconnectUser','test_payment_123','Shop\x20ID\x20is\x20required','createdAt','desc','isVerified','telegramBotService','updatedAt','__esModule','sendPaymentNotification','\x20notification\x20sent\x20successfully','1371647jrfKms','test_payout_123','findMany','sendTestNotification','username','7cbktId','currency','amount','paid','groupBy','map','getBotInfo','params','defineProperty','payment','__importDefault','query','Message\x20is\x20required','TelegramController','custom','details','sendPayoutNotification','USD','2931081jbtaIm','length','Markdown','lastName','User\x20disconnected\x20successfully','sendCustomNotification','body','sendBroadcast','isActive','ceil','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','count','json','update','1651440fhpmfN','gateway','productName','shopId','Telegram\x20user\x20not\x20found','findUnique','314156evQXhA'];a12_0x5095=function(){return _0x1de49f;};return a12_0x5095();}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x83e773=a12_0x4723e4;this[_0x83e773(0x1fa)]=async(_0x26e7cb,_0x3a088c,_0x36e6c5)=>{const _0x1af7e4=_0x83e773;try{const _0x34cf06=telegramBotService_1[_0x1af7e4(0x210)][_0x1af7e4(0x220)](),_0x5a6a3c=await database_1[_0x1af7e4(0x203)][_0x1af7e4(0x204)][_0x1af7e4(0x1f0)](),_0x1b3237=await database_1[_0x1af7e4(0x203)][_0x1af7e4(0x204)][_0x1af7e4(0x1f0)]({'where':{'isVerified':!![]}}),_0x265968=await database_1['default']['telegramUser'][_0x1af7e4(0x21e)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3a088c[_0x1af7e4(0x1f1)]({'success':!![],'result':{'bot':{'isActive':_0x34cf06[_0x1af7e4(0x234)],'username':_0x34cf06[_0x1af7e4(0x219)]},'statistics':{'totalUsers':_0x5a6a3c,'verifiedUsers':_0x1b3237,'unverifiedUsers':_0x5a6a3c-_0x1b3237,'connectedShops':_0x265968[_0x1af7e4(0x22d)]}}});}catch(_0x1ded08){_0x36e6c5(_0x1ded08);}},this[_0x83e773(0x1fc)]=async(_0x54fb6a,_0x2af8c1,_0x2bc441)=>{const _0x5d0543=_0x83e773;try{const {page:page=0x1,limit:limit=0x14,verified:_0x567694}=_0x54fb6a[_0x5d0543(0x225)],_0x446a8b=(Number(page)-0x1)*Number(limit),_0x34b059={};_0x567694!==undefined&&(_0x34b059[_0x5d0543(0x20f)]=_0x567694==='true');const [_0x372a56,_0x22736b]=await Promise[_0x5d0543(0x209)]([database_1['default']['telegramUser'][_0x5d0543(0x217)]({'where':_0x34b059,'skip':_0x446a8b,'take':Number(limit),'orderBy':{'createdAt':_0x5d0543(0x20e)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5d0543(0x203)][_0x5d0543(0x204)]['count']({'where':_0x34b059})]);_0x2af8c1[_0x5d0543(0x1f1)]({'success':!![],'users':_0x372a56['map'](_0x226e94=>({'id':_0x226e94['id'],'telegramId':_0x226e94['telegramId'],'username':_0x226e94[_0x5d0543(0x219)],'firstName':_0x226e94['firstName'],'lastName':_0x226e94[_0x5d0543(0x22f)],'isVerified':_0x226e94[_0x5d0543(0x20f)],'shop':_0x226e94['shop'],'createdAt':_0x226e94[_0x5d0543(0x20d)],'updatedAt':_0x226e94[_0x5d0543(0x211)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x22736b,'totalPages':Math[_0x5d0543(0x1ee)](_0x22736b/Number(limit))}});}catch(_0x43cbb7){_0x2bc441(_0x43cbb7);}},this[_0x83e773(0x233)]=async(_0x4d1f34,_0x3f8658,_0x35771f)=>{const _0x7db9ba=_0x83e773;try{const {message:_0x1b8c43,shopId:_0x3722d6}=_0x4d1f34[_0x7db9ba(0x232)];if(!_0x1b8c43)return _0x3f8658[_0x7db9ba(0x206)](0x190)[_0x7db9ba(0x1f1)]({'success':![],'message':_0x7db9ba(0x226)});if(_0x3722d6)await telegramBotService_1['telegramBotService'][_0x7db9ba(0x205)](_0x3722d6,_0x1b8c43,{'parse_mode':_0x7db9ba(0x22e)});else{const _0x4c4729=await database_1[_0x7db9ba(0x203)][_0x7db9ba(0x204)][_0x7db9ba(0x217)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x16c073=[...new Set(_0x4c4729[_0x7db9ba(0x21f)](_0x4d4a23=>_0x4d4a23[_0x7db9ba(0x1f6)])[_0x7db9ba(0x1fd)](Boolean))];for(const _0x4be570 of _0x16c073){_0x4be570&&await telegramBotService_1[_0x7db9ba(0x210)][_0x7db9ba(0x205)](_0x4be570,_0x1b8c43,{'parse_mode':_0x7db9ba(0x22e)});}}_0x3f8658[_0x7db9ba(0x1f1)]({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x5e8b90){_0x35771f(_0x5e8b90);}},this[_0x83e773(0x20a)]=async(_0x560e39,_0x1f4432,_0x3a5903)=>{const _0x39526a=_0x83e773;try{const {telegramId:_0x224f67}=_0x560e39[_0x39526a(0x221)],_0x57ce6e=await database_1[_0x39526a(0x203)]['telegramUser'][_0x39526a(0x1f8)]({'where':{'telegramId':_0x224f67},'include':{'shop':!![]}});if(!_0x57ce6e)return _0x1f4432[_0x39526a(0x206)](0x194)[_0x39526a(0x1f1)]({'success':![],'message':_0x39526a(0x1f7)});await database_1['default'][_0x39526a(0x204)][_0x39526a(0x1f2)]({'where':{'telegramId':_0x224f67},'data':{'shopId':null,'isVerified':![]}}),_0x1f4432[_0x39526a(0x1f1)]({'success':!![],'message':_0x39526a(0x230)});}catch(_0xa6a8fe){_0x3a5903(_0xa6a8fe);}},this[_0x83e773(0x218)]=async(_0x32a399,_0x275489,_0x57e4d9)=>{const _0x25f1aa=_0x83e773;try{const {shopId:_0x336b27,type:type=_0x25f1aa(0x223),testData:_0x5c3b83}=_0x32a399[_0x25f1aa(0x232)];if(!_0x336b27)return _0x275489[_0x25f1aa(0x206)](0x190)[_0x25f1aa(0x1f1)]({'success':![],'message':_0x25f1aa(0x20c)});const _0x112173=await database_1[_0x25f1aa(0x203)]['shop'][_0x25f1aa(0x1f8)]({'where':{'id':_0x336b27},'select':{'id':!![],'name':!![]}});if(!_0x112173)return _0x275489[_0x25f1aa(0x206)](0x194)[_0x25f1aa(0x1f1)]({'success':![],'message':_0x25f1aa(0x200)});switch(type){case _0x25f1aa(0x223):const _0x115805={'id':_0x25f1aa(0x20b),'amount':_0x5c3b83?.[_0x25f1aa(0x21c)]||0x64,'currency':_0x5c3b83?.[_0x25f1aa(0x21b)]||_0x25f1aa(0x22b),'productName':_0x5c3b83?.[_0x25f1aa(0x1f5)]||_0x25f1aa(0x208),'gateway':_0x5c3b83?.[_0x25f1aa(0x1f4)]||'plisio','createdAt':new Date(),..._0x5c3b83};await telegramBotService_1[_0x25f1aa(0x210)][_0x25f1aa(0x213)](_0x336b27,_0x115805,_0x25f1aa(0x21d));break;case _0x25f1aa(0x1ff):const _0x414a93={'id':_0x25f1aa(0x216),'amount':_0x5c3b83?.[_0x25f1aa(0x21c)]||0x1f4,'method':_0x5c3b83?.['method']||_0x25f1aa(0x1fb),'createdAt':new Date(),..._0x5c3b83};await telegramBotService_1[_0x25f1aa(0x210)][_0x25f1aa(0x22a)](_0x336b27,_0x414a93,'completed');break;case _0x25f1aa(0x228):await telegramBotService_1['telegramBotService'][_0x25f1aa(0x231)](_0x336b27,_0x5c3b83?.['title']||'Test\x20Notification',_0x5c3b83?.[_0x25f1aa(0x229)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x275489[_0x25f1aa(0x206)](0x190)['json']({'success':![],'message':_0x25f1aa(0x1ef)});}_0x275489[_0x25f1aa(0x1f1)]({'success':!![],'message':_0x25f1aa(0x1fe)+type+_0x25f1aa(0x214)});}catch(_0x131136){_0x57e4d9(_0x131136);}};}}exports[a12_0x4723e4(0x227)]=TelegramController;