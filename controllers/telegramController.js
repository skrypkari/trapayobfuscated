'use strict';function a12_0x4faa(){const _0xb9d192=['telegramId','count','260SZJaES','update','sendCustomNotification','createdAt','Telegram\x20user\x20not\x20found','all','Test\x20','sendPaymentNotification','gateway','370553hSIePF','152730VgYtbZ','sendPayoutNotification','7ONeotf','User\x20disconnected\x20successfully','984904vkUaDW','__importDefault','shopId','true','8lCxGts','paid','sendTestNotification','USD','Broadcast\x20message\x20sent\x20successfully','desc','413050UdJcXH','shop','__esModule','Shop\x20ID\x20is\x20required','telegramBotService','getTelegramUsers','findUnique','Shop\x20not\x20found','length','amount','map','payout','This\x20is\x20a\x20test\x20notification','updatedAt','telegramUser','bank_transfer','status','defineProperty','productName','Markdown','custom','66oczdck','payment','username','isVerified','Message\x20is\x20required','test_payment_123','query','726858ytMEEi','method','sendBroadcast','groupBy','616821tBzClz','body','getBotInfo','findMany','../services/telegramBotService','default','json','448224ZiduJo','TelegramController','disconnectUser','currency'];a12_0x4faa=function(){return _0xb9d192;};return a12_0x4faa();}function a12_0x3eee(_0x51b317,_0xbf16f6){const _0x4faa05=a12_0x4faa();return a12_0x3eee=function(_0x3eee69,_0x3f10dd){_0x3eee69=_0x3eee69-0x190;let _0x45e065=_0x4faa05[_0x3eee69];return _0x45e065;},a12_0x3eee(_0x51b317,_0xbf16f6);}const a12_0x143e6e=a12_0x3eee;(function(_0x311e00,_0xab2cc3){const _0x201797=a12_0x3eee,_0x1c46a1=_0x311e00();while(!![]){try{const _0x96d1d8=-parseInt(_0x201797(0x1d0))/0x1+-parseInt(_0x201797(0x1c1))/0x2+-parseInt(_0x201797(0x1ba))/0x3*(-parseInt(_0x201797(0x194))/0x4)+-parseInt(_0x201797(0x1d1))/0x5*(parseInt(_0x201797(0x1af))/0x6)+parseInt(_0x201797(0x1d3))/0x7*(-parseInt(_0x201797(0x190))/0x8)+-parseInt(_0x201797(0x1b6))/0x9+parseInt(_0x201797(0x1c7))/0xa*(parseInt(_0x201797(0x19a))/0xb);if(_0x96d1d8===_0xab2cc3)break;else _0x1c46a1['push'](_0x1c46a1['shift']());}catch(_0x418c94){_0x1c46a1['push'](_0x1c46a1['shift']());}}}(a12_0x4faa,0x3dc28));var __importDefault=this&&this[a12_0x143e6e(0x191)]||function(_0x50c778){const _0x4fe307=a12_0x143e6e;return _0x50c778&&_0x50c778[_0x4fe307(0x19c)]?_0x50c778:{'default':_0x50c778};};Object[a12_0x143e6e(0x1ab)](exports,a12_0x143e6e(0x19c),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a12_0x143e6e(0x1be)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x4c152c=a12_0x143e6e;this['getBotStatus']=async(_0x6daf65,_0x1a3135,_0x4506d0)=>{const _0x313ef2=a12_0x3eee;try{const _0x20396d=telegramBotService_1['telegramBotService'][_0x313ef2(0x1bc)](),_0x1a8c1e=await database_1[_0x313ef2(0x1bf)][_0x313ef2(0x1a8)]['count'](),_0x1dfa44=await database_1[_0x313ef2(0x1bf)]['telegramUser'][_0x313ef2(0x1c6)]({'where':{'isVerified':!![]}}),_0x2d1758=await database_1[_0x313ef2(0x1bf)][_0x313ef2(0x1a8)][_0x313ef2(0x1b9)]({'by':[_0x313ef2(0x192)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1a3135[_0x313ef2(0x1c0)]({'success':!![],'result':{'bot':{'isActive':_0x20396d['isActive'],'username':_0x20396d['username']},'statistics':{'totalUsers':_0x1a8c1e,'verifiedUsers':_0x1dfa44,'unverifiedUsers':_0x1a8c1e-_0x1dfa44,'connectedShops':_0x2d1758[_0x313ef2(0x1a2)]}}});}catch(_0x7c34d9){_0x4506d0(_0x7c34d9);}},this[_0x4c152c(0x19f)]=async(_0x4b1218,_0x5b17de,_0x416225)=>{const _0x490128=_0x4c152c;try{const {page:page=0x1,limit:limit=0x14,verified:_0x51d341}=_0x4b1218[_0x490128(0x1b5)],_0x596f79=(Number(page)-0x1)*Number(limit),_0x19a6cf={};_0x51d341!==undefined&&(_0x19a6cf['isVerified']=_0x51d341===_0x490128(0x193));const [_0x4ef5d3,_0x1e3a5f]=await Promise[_0x490128(0x1cc)]([database_1[_0x490128(0x1bf)]['telegramUser'][_0x490128(0x1bd)]({'where':_0x19a6cf,'skip':_0x596f79,'take':Number(limit),'orderBy':{'createdAt':_0x490128(0x199)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x490128(0x1bf)]['telegramUser'][_0x490128(0x1c6)]({'where':_0x19a6cf})]);_0x5b17de[_0x490128(0x1c0)]({'success':!![],'users':_0x4ef5d3[_0x490128(0x1a4)](_0x2eccac=>({'id':_0x2eccac['id'],'telegramId':_0x2eccac[_0x490128(0x1c5)],'username':_0x2eccac[_0x490128(0x1b1)],'firstName':_0x2eccac['firstName'],'lastName':_0x2eccac['lastName'],'isVerified':_0x2eccac[_0x490128(0x1b2)],'shop':_0x2eccac[_0x490128(0x19b)],'createdAt':_0x2eccac[_0x490128(0x1ca)],'updatedAt':_0x2eccac[_0x490128(0x1a7)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x1e3a5f,'totalPages':Math['ceil'](_0x1e3a5f/Number(limit))}});}catch(_0x2a3fbf){_0x416225(_0x2a3fbf);}},this[_0x4c152c(0x1b8)]=async(_0x3a3821,_0x2e29eb,_0x4c630b)=>{const _0x59043d=_0x4c152c;try{const {message:_0x27deec,shopId:_0x7411fe}=_0x3a3821[_0x59043d(0x1bb)];if(!_0x27deec)return _0x2e29eb[_0x59043d(0x1aa)](0x190)[_0x59043d(0x1c0)]({'success':![],'message':_0x59043d(0x1b3)});if(_0x7411fe)await telegramBotService_1[_0x59043d(0x19e)]['sendShopNotification'](_0x7411fe,_0x27deec,{'parse_mode':_0x59043d(0x1ad)});else{const _0x43b75b=await database_1[_0x59043d(0x1bf)][_0x59043d(0x1a8)][_0x59043d(0x1bd)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x575c2c=[...new Set(_0x43b75b[_0x59043d(0x1a4)](_0x211838=>_0x211838[_0x59043d(0x192)])['filter'](Boolean))];for(const _0x54ea31 of _0x575c2c){_0x54ea31&&await telegramBotService_1[_0x59043d(0x19e)]['sendShopNotification'](_0x54ea31,_0x27deec,{'parse_mode':_0x59043d(0x1ad)});}}_0x2e29eb[_0x59043d(0x1c0)]({'success':!![],'message':_0x59043d(0x198)});}catch(_0x1faac8){_0x4c630b(_0x1faac8);}},this[_0x4c152c(0x1c3)]=async(_0x35716a,_0x12218d,_0x8513f7)=>{const _0x5a23e6=_0x4c152c;try{const {telegramId:_0x1d3c10}=_0x35716a['params'],_0x398a6d=await database_1[_0x5a23e6(0x1bf)][_0x5a23e6(0x1a8)][_0x5a23e6(0x1a0)]({'where':{'telegramId':_0x1d3c10},'include':{'shop':!![]}});if(!_0x398a6d)return _0x12218d['status'](0x194)[_0x5a23e6(0x1c0)]({'success':![],'message':_0x5a23e6(0x1cb)});await database_1[_0x5a23e6(0x1bf)][_0x5a23e6(0x1a8)][_0x5a23e6(0x1c8)]({'where':{'telegramId':_0x1d3c10},'data':{'shopId':null,'isVerified':![]}}),_0x12218d[_0x5a23e6(0x1c0)]({'success':!![],'message':_0x5a23e6(0x1d4)});}catch(_0x217883){_0x8513f7(_0x217883);}},this[_0x4c152c(0x196)]=async(_0x57c0e0,_0xac1cfb,_0x2737a6)=>{const _0x2d96a9=_0x4c152c;try{const {shopId:_0x24b333,type:type=_0x2d96a9(0x1b0),testData:_0x33dd0b}=_0x57c0e0[_0x2d96a9(0x1bb)];if(!_0x24b333)return _0xac1cfb[_0x2d96a9(0x1aa)](0x190)['json']({'success':![],'message':_0x2d96a9(0x19d)});const _0x4cc657=await database_1[_0x2d96a9(0x1bf)][_0x2d96a9(0x19b)][_0x2d96a9(0x1a0)]({'where':{'id':_0x24b333},'select':{'id':!![],'name':!![]}});if(!_0x4cc657)return _0xac1cfb['status'](0x194)['json']({'success':![],'message':_0x2d96a9(0x1a1)});switch(type){case'payment':const _0x309d44={'id':_0x2d96a9(0x1b4),'amount':_0x33dd0b?.[_0x2d96a9(0x1a3)]||0x64,'currency':_0x33dd0b?.[_0x2d96a9(0x1c4)]||_0x2d96a9(0x197),'productName':_0x33dd0b?.[_0x2d96a9(0x1ac)]||'Test\x20Product','gateway':_0x33dd0b?.[_0x2d96a9(0x1cf)]||'plisio','createdAt':new Date(),..._0x33dd0b};await telegramBotService_1[_0x2d96a9(0x19e)][_0x2d96a9(0x1ce)](_0x24b333,_0x309d44,_0x2d96a9(0x195));break;case _0x2d96a9(0x1a5):const _0x773ea={'id':'test_payout_123','amount':_0x33dd0b?.[_0x2d96a9(0x1a3)]||0x1f4,'method':_0x33dd0b?.[_0x2d96a9(0x1b7)]||_0x2d96a9(0x1a9),'createdAt':new Date(),..._0x33dd0b};await telegramBotService_1[_0x2d96a9(0x19e)][_0x2d96a9(0x1d2)](_0x24b333,_0x773ea,'completed');break;case _0x2d96a9(0x1ae):await telegramBotService_1['telegramBotService'][_0x2d96a9(0x1c9)](_0x24b333,_0x33dd0b?.['title']||'Test\x20Notification',_0x33dd0b?.['details']||{'message':_0x2d96a9(0x1a6)});break;default:return _0xac1cfb[_0x2d96a9(0x1aa)](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0xac1cfb[_0x2d96a9(0x1c0)]({'success':!![],'message':_0x2d96a9(0x1cd)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x4cbc67){_0x2737a6(_0x4cbc67);}};}}exports[a12_0x143e6e(0x1c2)]=TelegramController;