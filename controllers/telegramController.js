'use strict';const a13_0x5d6469=a13_0x1c41;(function(_0x831e38,_0xb7dfed){const _0x4d3765=a13_0x1c41,_0x2668da=_0x831e38();while(!![]){try{const _0x40e206=parseInt(_0x4d3765(0x1bc))/0x1+parseInt(_0x4d3765(0x1ac))/0x2*(-parseInt(_0x4d3765(0x19e))/0x3)+-parseInt(_0x4d3765(0x1d4))/0x4*(-parseInt(_0x4d3765(0x1cd))/0x5)+parseInt(_0x4d3765(0x1b7))/0x6*(parseInt(_0x4d3765(0x1a5))/0x7)+parseInt(_0x4d3765(0x1c5))/0x8+parseInt(_0x4d3765(0x1b8))/0x9*(parseInt(_0x4d3765(0x1b4))/0xa)+-parseInt(_0x4d3765(0x1d1))/0xb;if(_0x40e206===_0xb7dfed)break;else _0x2668da['push'](_0x2668da['shift']());}catch(_0x59e2f2){_0x2668da['push'](_0x2668da['shift']());}}}(a13_0x3514,0xf3051));function a13_0x1c41(_0x4d23a3,_0x31e8d9){const _0x351486=a13_0x3514();return a13_0x1c41=function(_0x1c4124,_0x500344){_0x1c4124=_0x1c4124-0x18d;let _0x391009=_0x351486[_0x1c4124];return _0x391009;},a13_0x1c41(_0x4d23a3,_0x31e8d9);}function a13_0x3514(){const _0x5115c8=['method','gateway','status','test_payment_123','params','2457055Gnzske','User\x20disconnected\x20successfully','lastName','bank_transfer','8564897tiTkiC','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Test\x20Notification','4exHjcY','sendPayoutNotification','__importDefault','Broadcast\x20message\x20sent\x20successfully','desc','USD','findMany','Markdown','details','../services/telegramBotService','body','payout','TelegramController','telegramUser','plisio','sendShopNotification','This\x20is\x20a\x20test\x20notification','getBotInfo','sendBroadcast','3dujOsv','length','shop','payment','test_payout_123','currency','custom','1382731XhXJZj','Test\x20Product','updatedAt','defineProperty','findUnique','\x20notification\x20sent\x20successfully','shopId','1749746aZakSo','getBotStatus','sendTestNotification','completed','getTelegramUsers','map','Message\x20is\x20required','count','30WLuZtx','default','sendCustomNotification','6MBhurG','381933fGlWiO','Telegram\x20user\x20not\x20found','username','productName','1831166lOtMGs','Test\x20','all','disconnectUser','json','update','title','isActive','telegramBotService','11904lcvosS','__esModule','amount'];a13_0x3514=function(){return _0x5115c8;};return a13_0x3514();}var __importDefault=this&&this[a13_0x5d6469(0x18d)]||function(_0xe7d642){const _0x17a4ef=a13_0x5d6469;return _0xe7d642&&_0xe7d642[_0x17a4ef(0x1c6)]?_0xe7d642:{'default':_0xe7d642};};Object[a13_0x5d6469(0x1a8)](exports,a13_0x5d6469(0x1c6),{'value':!![]}),exports[a13_0x5d6469(0x197)]=void 0x0;const telegramBotService_1=require(a13_0x5d6469(0x194)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x31af9b=a13_0x5d6469;this[_0x31af9b(0x1ad)]=async(_0x125975,_0x3608c5,_0x50dcbe)=>{const _0x430505=_0x31af9b;try{const _0x5e198a=telegramBotService_1[_0x430505(0x1c4)][_0x430505(0x19c)](),_0x1e5a98=await database_1[_0x430505(0x1b5)]['telegramUser'][_0x430505(0x1b3)](),_0x5dbada=await database_1[_0x430505(0x1b5)][_0x430505(0x198)][_0x430505(0x1b3)]({'where':{'isVerified':!![]}}),_0x52dc3c=await database_1[_0x430505(0x1b5)][_0x430505(0x198)]['groupBy']({'by':[_0x430505(0x1ab)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3608c5[_0x430505(0x1c0)]({'success':!![],'result':{'bot':{'isActive':_0x5e198a[_0x430505(0x1c3)],'username':_0x5e198a[_0x430505(0x1ba)]},'statistics':{'totalUsers':_0x1e5a98,'verifiedUsers':_0x5dbada,'unverifiedUsers':_0x1e5a98-_0x5dbada,'connectedShops':_0x52dc3c[_0x430505(0x19f)]}}});}catch(_0x1edc24){_0x50dcbe(_0x1edc24);}},this[_0x31af9b(0x1b0)]=async(_0x1c9152,_0x1f4460,_0x11dd97)=>{const _0x4c2159=_0x31af9b;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2c2a98}=_0x1c9152['query'],_0x360a2d=(Number(page)-0x1)*Number(limit),_0x4364ca={};_0x2c2a98!==undefined&&(_0x4364ca['isVerified']=_0x2c2a98==='true');const [_0x289726,_0xe715ee]=await Promise[_0x4c2159(0x1be)]([database_1[_0x4c2159(0x1b5)]['telegramUser']['findMany']({'where':_0x4364ca,'skip':_0x360a2d,'take':Number(limit),'orderBy':{'createdAt':_0x4c2159(0x18f)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4c2159(0x1b5)][_0x4c2159(0x198)]['count']({'where':_0x4364ca})]);_0x1f4460[_0x4c2159(0x1c0)]({'success':!![],'users':_0x289726[_0x4c2159(0x1b1)](_0x5756f8=>({'id':_0x5756f8['id'],'telegramId':_0x5756f8['telegramId'],'username':_0x5756f8[_0x4c2159(0x1ba)],'firstName':_0x5756f8['firstName'],'lastName':_0x5756f8[_0x4c2159(0x1cf)],'isVerified':_0x5756f8['isVerified'],'shop':_0x5756f8[_0x4c2159(0x1a0)],'createdAt':_0x5756f8['createdAt'],'updatedAt':_0x5756f8[_0x4c2159(0x1a7)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xe715ee,'totalPages':Math['ceil'](_0xe715ee/Number(limit))}});}catch(_0x1e3609){_0x11dd97(_0x1e3609);}},this[_0x31af9b(0x19d)]=async(_0x774975,_0x426f02,_0x58c002)=>{const _0x147b8e=_0x31af9b;try{const {message:_0x5a048f,shopId:_0x47040e}=_0x774975[_0x147b8e(0x195)];if(!_0x5a048f)return _0x426f02[_0x147b8e(0x1ca)](0x190)[_0x147b8e(0x1c0)]({'success':![],'message':_0x147b8e(0x1b2)});if(_0x47040e)await telegramBotService_1[_0x147b8e(0x1c4)][_0x147b8e(0x19a)](_0x47040e,_0x5a048f,{'parse_mode':_0x147b8e(0x192)});else{const _0x38fb04=await database_1[_0x147b8e(0x1b5)][_0x147b8e(0x198)][_0x147b8e(0x191)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x1088a0=[...new Set(_0x38fb04[_0x147b8e(0x1b1)](_0x2a4677=>_0x2a4677[_0x147b8e(0x1ab)])['filter'](Boolean))];for(const _0x52bda3 of _0x1088a0){_0x52bda3&&await telegramBotService_1[_0x147b8e(0x1c4)][_0x147b8e(0x19a)](_0x52bda3,_0x5a048f,{'parse_mode':'Markdown'});}}_0x426f02[_0x147b8e(0x1c0)]({'success':!![],'message':_0x147b8e(0x18e)});}catch(_0x4e7fe1){_0x58c002(_0x4e7fe1);}},this[_0x31af9b(0x1bf)]=async(_0x4acdbf,_0x2875cd,_0x2c633c)=>{const _0x4a2c85=_0x31af9b;try{const {telegramId:_0xe20d36}=_0x4acdbf[_0x4a2c85(0x1cc)],_0x286759=await database_1['default'][_0x4a2c85(0x198)]['findUnique']({'where':{'telegramId':_0xe20d36},'include':{'shop':!![]}});if(!_0x286759)return _0x2875cd[_0x4a2c85(0x1ca)](0x194)['json']({'success':![],'message':_0x4a2c85(0x1b9)});await database_1[_0x4a2c85(0x1b5)][_0x4a2c85(0x198)][_0x4a2c85(0x1c1)]({'where':{'telegramId':_0xe20d36},'data':{'shopId':null,'isVerified':![]}}),_0x2875cd[_0x4a2c85(0x1c0)]({'success':!![],'message':_0x4a2c85(0x1ce)});}catch(_0x29267b){_0x2c633c(_0x29267b);}},this[_0x31af9b(0x1ae)]=async(_0x5d36cd,_0x1df1a9,_0x46c248)=>{const _0x3840b8=_0x31af9b;try{const {shopId:_0x5d8c37,type:type=_0x3840b8(0x1a1),testData:_0x332a34}=_0x5d36cd[_0x3840b8(0x195)];if(!_0x5d8c37)return _0x1df1a9[_0x3840b8(0x1ca)](0x190)[_0x3840b8(0x1c0)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x34aab3=await database_1[_0x3840b8(0x1b5)]['shop'][_0x3840b8(0x1a9)]({'where':{'id':_0x5d8c37},'select':{'id':!![],'name':!![]}});if(!_0x34aab3)return _0x1df1a9[_0x3840b8(0x1ca)](0x194)[_0x3840b8(0x1c0)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x3840b8(0x1a1):const _0x580315={'id':_0x3840b8(0x1cb),'amount':_0x332a34?.['amount']||0x64,'currency':_0x332a34?.[_0x3840b8(0x1a3)]||_0x3840b8(0x190),'productName':_0x332a34?.[_0x3840b8(0x1bb)]||_0x3840b8(0x1a6),'gateway':_0x332a34?.[_0x3840b8(0x1c9)]||_0x3840b8(0x199),'createdAt':new Date(),..._0x332a34};await telegramBotService_1[_0x3840b8(0x1c4)]['sendPaymentNotification'](_0x5d8c37,_0x580315,'paid');break;case _0x3840b8(0x196):const _0x36b610={'id':_0x3840b8(0x1a2),'amount':_0x332a34?.[_0x3840b8(0x1c7)]||0x1f4,'method':_0x332a34?.[_0x3840b8(0x1c8)]||_0x3840b8(0x1d0),'createdAt':new Date(),..._0x332a34};await telegramBotService_1[_0x3840b8(0x1c4)][_0x3840b8(0x1d5)](_0x5d8c37,_0x36b610,_0x3840b8(0x1af));break;case _0x3840b8(0x1a4):await telegramBotService_1[_0x3840b8(0x1c4)][_0x3840b8(0x1b6)](_0x5d8c37,_0x332a34?.[_0x3840b8(0x1c2)]||_0x3840b8(0x1d3),_0x332a34?.[_0x3840b8(0x193)]||{'message':_0x3840b8(0x19b)});break;default:return _0x1df1a9[_0x3840b8(0x1ca)](0x190)[_0x3840b8(0x1c0)]({'success':![],'message':_0x3840b8(0x1d2)});}_0x1df1a9[_0x3840b8(0x1c0)]({'success':!![],'message':_0x3840b8(0x1bd)+type+_0x3840b8(0x1aa)});}catch(_0x2e8871){_0x46c248(_0x2e8871);}};}}exports[a13_0x5d6469(0x197)]=TelegramController;