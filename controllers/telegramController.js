'use strict';function a12_0x30f3(_0x58e88e,_0x1708da){const _0xf182e5=a12_0xf182();return a12_0x30f3=function(_0x30f3ae,_0x4b5100){_0x30f3ae=_0x30f3ae-0x1d0;let _0x2e003c=_0xf182e5[_0x30f3ae];return _0x2e003c;},a12_0x30f3(_0x58e88e,_0x1708da);}const a12_0x29baea=a12_0x30f3;function a12_0xf182(){const _0x2dc10c=['title','lastName','3335373qKbtck','findMany','__esModule','TelegramController','getBotStatus','1170060ZcJtIr','15Jnzrbl','true','getBotInfo','length','Test\x20','User\x20disconnected\x20successfully','count','groupBy','amount','default','filter','params','269843nMkdZw','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','completed','isVerified','Markdown','username','Shop\x20not\x20found','update','updatedAt','productName','930132MKoQGI','sendPaymentNotification','status','telegramBotService','test_payment_123','shop','sendCustomNotification','USD','test_payout_123','defineProperty','details','map','10ObnUiI','sendShopNotification','sendPayoutNotification','bank_transfer','telegramUser','getTelegramUsers','113168qCciBH','../config/database','435820STvrVS','body','disconnectUser','1245DFrFJk','json','ceil','16GDZnEY','payout','payment','gateway','shopId','currency','../services/telegramBotService','822AGBWDJ','method','492LbXiHC','custom','Broadcast\x20message\x20sent\x20successfully','findUnique','Message\x20is\x20required'];a12_0xf182=function(){return _0x2dc10c;};return a12_0xf182();}(function(_0x5b1ec5,_0x14dc37){const _0x4eb826=a12_0x30f3,_0x47726f=_0x5b1ec5();while(!![]){try{const _0x258118=parseInt(_0x4eb826(0x201))/0x1+-parseInt(_0x4eb826(0x1ea))/0x2+-parseInt(_0x4eb826(0x1eb))/0x3*(-parseInt(_0x4eb826(0x215))/0x4)+-parseInt(_0x4eb826(0x1d2))/0x5*(parseInt(_0x4eb826(0x1dc))/0x6)+parseInt(_0x4eb826(0x1f7))/0x7*(-parseInt(_0x4eb826(0x1d5))/0x8)+parseInt(_0x4eb826(0x1e5))/0x9*(parseInt(_0x4eb826(0x20d))/0xa)+parseInt(_0x4eb826(0x213))/0xb*(-parseInt(_0x4eb826(0x1de))/0xc);if(_0x258118===_0x14dc37)break;else _0x47726f['push'](_0x47726f['shift']());}catch(_0x4063f4){_0x47726f['push'](_0x47726f['shift']());}}}(a12_0xf182,0xb199f));var __importDefault=this&&this['__importDefault']||function(_0x63076d){const _0x334ecf=a12_0x30f3;return _0x63076d&&_0x63076d[_0x334ecf(0x1e7)]?_0x63076d:{'default':_0x63076d};};Object[a12_0x29baea(0x20a)](exports,a12_0x29baea(0x1e7),{'value':!![]}),exports[a12_0x29baea(0x1e8)]=void 0x0;const telegramBotService_1=require(a12_0x29baea(0x1db)),database_1=__importDefault(require(a12_0x29baea(0x214)));class TelegramController{constructor(){const _0x20f09e=a12_0x29baea;this[_0x20f09e(0x1e9)]=async(_0x24e3cd,_0x3c62b5,_0x31d5d9)=>{const _0xb9a2bf=_0x20f09e;try{const _0x4ac6fb=telegramBotService_1[_0xb9a2bf(0x204)][_0xb9a2bf(0x1ed)](),_0x73df1a=await database_1['default'][_0xb9a2bf(0x211)][_0xb9a2bf(0x1f1)](),_0xeb7ef3=await database_1[_0xb9a2bf(0x1f4)][_0xb9a2bf(0x211)]['count']({'where':{'isVerified':!![]}}),_0x5cdd81=await database_1['default'][_0xb9a2bf(0x211)][_0xb9a2bf(0x1f2)]({'by':[_0xb9a2bf(0x1d9)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x3c62b5[_0xb9a2bf(0x1d3)]({'success':!![],'result':{'bot':{'isActive':_0x4ac6fb['isActive'],'username':_0x4ac6fb[_0xb9a2bf(0x1fc)]},'statistics':{'totalUsers':_0x73df1a,'verifiedUsers':_0xeb7ef3,'unverifiedUsers':_0x73df1a-_0xeb7ef3,'connectedShops':_0x5cdd81[_0xb9a2bf(0x1ee)]}}});}catch(_0x27773f){_0x31d5d9(_0x27773f);}},this[_0x20f09e(0x212)]=async(_0x565555,_0x14cf74,_0x22b60f)=>{const _0x397326=_0x20f09e;try{const {page:page=0x1,limit:limit=0x14,verified:_0x4a57f6}=_0x565555['query'],_0x110e6d=(Number(page)-0x1)*Number(limit),_0x240270={};_0x4a57f6!==undefined&&(_0x240270['isVerified']=_0x4a57f6===_0x397326(0x1ec));const [_0x2b7eef,_0xdf6922]=await Promise['all']([database_1[_0x397326(0x1f4)][_0x397326(0x211)][_0x397326(0x1e6)]({'where':_0x240270,'skip':_0x110e6d,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x397326(0x1f4)][_0x397326(0x211)][_0x397326(0x1f1)]({'where':_0x240270})]);_0x14cf74[_0x397326(0x1d3)]({'success':!![],'users':_0x2b7eef['map'](_0x386de2=>({'id':_0x386de2['id'],'telegramId':_0x386de2['telegramId'],'username':_0x386de2[_0x397326(0x1fc)],'firstName':_0x386de2['firstName'],'lastName':_0x386de2[_0x397326(0x1e4)],'isVerified':_0x386de2[_0x397326(0x1fa)],'shop':_0x386de2['shop'],'createdAt':_0x386de2['createdAt'],'updatedAt':_0x386de2[_0x397326(0x1ff)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0xdf6922,'totalPages':Math[_0x397326(0x1d4)](_0xdf6922/Number(limit))}});}catch(_0x451ad9){_0x22b60f(_0x451ad9);}},this['sendBroadcast']=async(_0x480ea3,_0xf70168,_0x2b15d1)=>{const _0x350c7f=_0x20f09e;try{const {message:_0x54e080,shopId:_0xf2605d}=_0x480ea3[_0x350c7f(0x1d0)];if(!_0x54e080)return _0xf70168[_0x350c7f(0x203)](0x190)[_0x350c7f(0x1d3)]({'success':![],'message':_0x350c7f(0x1e2)});if(_0xf2605d)await telegramBotService_1[_0x350c7f(0x204)]['sendShopNotification'](_0xf2605d,_0x54e080,{'parse_mode':_0x350c7f(0x1fb)});else{const _0x29cb33=await database_1[_0x350c7f(0x1f4)]['telegramUser'][_0x350c7f(0x1e6)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x3ab5f5=[...new Set(_0x29cb33[_0x350c7f(0x20c)](_0x172b48=>_0x172b48['shopId'])[_0x350c7f(0x1f5)](Boolean))];for(const _0x9dadf9 of _0x3ab5f5){_0x9dadf9&&await telegramBotService_1[_0x350c7f(0x204)][_0x350c7f(0x20e)](_0x9dadf9,_0x54e080,{'parse_mode':_0x350c7f(0x1fb)});}}_0xf70168[_0x350c7f(0x1d3)]({'success':!![],'message':_0x350c7f(0x1e0)});}catch(_0x257750){_0x2b15d1(_0x257750);}},this[_0x20f09e(0x1d1)]=async(_0x1156ce,_0x2b3b3c,_0x5f007a)=>{const _0x1108d2=_0x20f09e;try{const {telegramId:_0x57f272}=_0x1156ce[_0x1108d2(0x1f6)],_0x539555=await database_1[_0x1108d2(0x1f4)][_0x1108d2(0x211)][_0x1108d2(0x1e1)]({'where':{'telegramId':_0x57f272},'include':{'shop':!![]}});if(!_0x539555)return _0x2b3b3c[_0x1108d2(0x203)](0x194)[_0x1108d2(0x1d3)]({'success':![],'message':'Telegram\x20user\x20not\x20found'});await database_1['default'][_0x1108d2(0x211)][_0x1108d2(0x1fe)]({'where':{'telegramId':_0x57f272},'data':{'shopId':null,'isVerified':![]}}),_0x2b3b3c[_0x1108d2(0x1d3)]({'success':!![],'message':_0x1108d2(0x1f0)});}catch(_0x561b7b){_0x5f007a(_0x561b7b);}},this['sendTestNotification']=async(_0x1fc1a4,_0x6edcf0,_0x40d170)=>{const _0x33ba54=_0x20f09e;try{const {shopId:_0x411cce,type:type=_0x33ba54(0x1d7),testData:_0x38c0d7}=_0x1fc1a4['body'];if(!_0x411cce)return _0x6edcf0[_0x33ba54(0x203)](0x190)[_0x33ba54(0x1d3)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x58b1d9=await database_1['default'][_0x33ba54(0x206)][_0x33ba54(0x1e1)]({'where':{'id':_0x411cce},'select':{'id':!![],'name':!![]}});if(!_0x58b1d9)return _0x6edcf0['status'](0x194)[_0x33ba54(0x1d3)]({'success':![],'message':_0x33ba54(0x1fd)});switch(type){case _0x33ba54(0x1d7):const _0x19a849={'id':_0x33ba54(0x205),'amount':_0x38c0d7?.[_0x33ba54(0x1f3)]||0x64,'currency':_0x38c0d7?.[_0x33ba54(0x1da)]||_0x33ba54(0x208),'productName':_0x38c0d7?.[_0x33ba54(0x200)]||'Test\x20Product','gateway':_0x38c0d7?.[_0x33ba54(0x1d8)]||'plisio','createdAt':new Date(),..._0x38c0d7};await telegramBotService_1[_0x33ba54(0x204)][_0x33ba54(0x202)](_0x411cce,_0x19a849,'paid');break;case _0x33ba54(0x1d6):const _0x49bf86={'id':_0x33ba54(0x209),'amount':_0x38c0d7?.[_0x33ba54(0x1f3)]||0x1f4,'method':_0x38c0d7?.[_0x33ba54(0x1dd)]||_0x33ba54(0x210),'createdAt':new Date(),..._0x38c0d7};await telegramBotService_1[_0x33ba54(0x204)][_0x33ba54(0x20f)](_0x411cce,_0x49bf86,_0x33ba54(0x1f9));break;case _0x33ba54(0x1df):await telegramBotService_1[_0x33ba54(0x204)][_0x33ba54(0x207)](_0x411cce,_0x38c0d7?.[_0x33ba54(0x1e3)]||'Test\x20Notification',_0x38c0d7?.[_0x33ba54(0x20b)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x6edcf0[_0x33ba54(0x203)](0x190)[_0x33ba54(0x1d3)]({'success':![],'message':_0x33ba54(0x1f8)});}_0x6edcf0[_0x33ba54(0x1d3)]({'success':!![],'message':_0x33ba54(0x1ef)+type+'\x20notification\x20sent\x20successfully'});}catch(_0x52098b){_0x40d170(_0x52098b);}};}}exports['TelegramController']=TelegramController;