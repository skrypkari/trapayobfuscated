'use strict';const a17_0x50978b=a17_0x21ee;(function(_0x3299c4,_0x5dd7a1){const _0x3b4c37=a17_0x21ee,_0x94cb4e=_0x3299c4();while(!![]){try{const _0x576a5d=parseInt(_0x3b4c37(0x1cb))/0x1+-parseInt(_0x3b4c37(0x198))/0x2*(parseInt(_0x3b4c37(0x1a4))/0x3)+parseInt(_0x3b4c37(0x194))/0x4*(-parseInt(_0x3b4c37(0x193))/0x5)+parseInt(_0x3b4c37(0x1d0))/0x6+parseInt(_0x3b4c37(0x1c9))/0x7+parseInt(_0x3b4c37(0x1be))/0x8*(parseInt(_0x3b4c37(0x1b3))/0x9)+parseInt(_0x3b4c37(0x1ac))/0xa;if(_0x576a5d===_0x5dd7a1)break;else _0x94cb4e['push'](_0x94cb4e['shift']());}catch(_0x4d25d4){_0x94cb4e['push'](_0x94cb4e['shift']());}}}(a17_0x2502,0xd4e75));var __importDefault=this&&this[a17_0x50978b(0x19a)]||function(_0x1418f5){const _0x3327bb=a17_0x50978b;return _0x1418f5&&_0x1418f5[_0x3327bb(0x1b0)]?_0x1418f5:{'default':_0x1418f5};};Object['defineProperty'](exports,a17_0x50978b(0x1b0),{'value':!![]}),exports['TelegramController']=void 0x0;const telegramBotService_1=require(a17_0x50978b(0x1c3)),database_1=__importDefault(require('../config/database'));function a17_0x21ee(_0x273ebb,_0xd56029){_0x273ebb=_0x273ebb-0x193;const _0x250260=a17_0x2502();let _0x21ee4d=_0x250260[_0x273ebb];return _0x21ee4d;}class TelegramController{constructor(){const _0x555a30=a17_0x50978b;this[_0x555a30(0x1d9)]=async(_0x3d39a6,_0x5e6211,_0xa949cb)=>{const _0x4d8622=_0x555a30;try{const _0x47d388=telegramBotService_1[_0x4d8622(0x1c1)][_0x4d8622(0x1b8)](),_0x4eba9d=await database_1[_0x4d8622(0x19e)][_0x4d8622(0x195)][_0x4d8622(0x1cd)](),_0x5687e4=await database_1[_0x4d8622(0x19e)]['telegramUser'][_0x4d8622(0x1cd)]({'where':{'isVerified':!![]}}),_0x4bfaf9=await database_1[_0x4d8622(0x19e)][_0x4d8622(0x195)]['groupBy']({'by':[_0x4d8622(0x199)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x5e6211[_0x4d8622(0x1c0)]({'success':!![],'result':{'bot':{'isActive':_0x47d388[_0x4d8622(0x1d2)],'username':_0x47d388[_0x4d8622(0x1a0)]},'statistics':{'totalUsers':_0x4eba9d,'verifiedUsers':_0x5687e4,'unverifiedUsers':_0x4eba9d-_0x5687e4,'connectedShops':_0x4bfaf9[_0x4d8622(0x1d5)]}}});}catch(_0x4cc67b){_0xa949cb(_0x4cc67b);}},this[_0x555a30(0x1d6)]=async(_0x46fe73,_0x2741f9,_0x31bba4)=>{const _0x49e28b=_0x555a30;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1347e2}=_0x46fe73['query'],_0x4bf926=(Number(page)-0x1)*Number(limit),_0x15a865={};_0x1347e2!==undefined&&(_0x15a865[_0x49e28b(0x1ad)]=_0x1347e2===_0x49e28b(0x1c8));const [_0x451bb2,_0x13be2a]=await Promise[_0x49e28b(0x19c)]([database_1['default'][_0x49e28b(0x195)][_0x49e28b(0x1b4)]({'where':_0x15a865,'skip':_0x4bf926,'take':Number(limit),'orderBy':{'createdAt':_0x49e28b(0x1af)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x49e28b(0x19e)][_0x49e28b(0x195)][_0x49e28b(0x1cd)]({'where':_0x15a865})]);_0x2741f9[_0x49e28b(0x1c0)]({'success':!![],'users':_0x451bb2[_0x49e28b(0x1ce)](_0x24e0f3=>({'id':_0x24e0f3['id'],'telegramId':_0x24e0f3[_0x49e28b(0x1aa)],'username':_0x24e0f3[_0x49e28b(0x1a0)],'firstName':_0x24e0f3[_0x49e28b(0x1c7)],'lastName':_0x24e0f3[_0x49e28b(0x1b5)],'isVerified':_0x24e0f3['isVerified'],'shop':_0x24e0f3[_0x49e28b(0x1a1)],'createdAt':_0x24e0f3[_0x49e28b(0x1a6)],'updatedAt':_0x24e0f3['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x13be2a,'totalPages':Math['ceil'](_0x13be2a/Number(limit))}});}catch(_0x38350e){_0x31bba4(_0x38350e);}},this[_0x555a30(0x1d4)]=async(_0x5c0faa,_0x7db180,_0x475c45)=>{const _0x36b72c=_0x555a30;try{const {message:_0x3bd9cd,shopId:_0x43cde9}=_0x5c0faa[_0x36b72c(0x1a5)];if(!_0x3bd9cd)return _0x7db180[_0x36b72c(0x1b1)](0x190)[_0x36b72c(0x1c0)]({'success':![],'message':'Message\x20is\x20required'});if(_0x43cde9)await telegramBotService_1[_0x36b72c(0x1c1)][_0x36b72c(0x1ab)](_0x43cde9,_0x3bd9cd,{'parse_mode':_0x36b72c(0x1b9)});else{const _0x5594f0=await database_1[_0x36b72c(0x19e)]['telegramUser'][_0x36b72c(0x1b4)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x4ab1be=[...new Set(_0x5594f0[_0x36b72c(0x1ce)](_0x2c3a85=>_0x2c3a85[_0x36b72c(0x199)])['filter'](Boolean))];for(const _0x25a37d of _0x4ab1be){_0x25a37d&&await telegramBotService_1[_0x36b72c(0x1c1)][_0x36b72c(0x1ab)](_0x25a37d,_0x3bd9cd,{'parse_mode':'Markdown'});}}_0x7db180['json']({'success':!![],'message':_0x36b72c(0x1d7)});}catch(_0x2c7ae6){_0x475c45(_0x2c7ae6);}},this[_0x555a30(0x1d8)]=async(_0x149f14,_0x18ea0d,_0x28bb49)=>{const _0x2dcaa0=_0x555a30;try{const {telegramId:_0x1ba72e}=_0x149f14[_0x2dcaa0(0x1a7)],_0xc55914=await database_1[_0x2dcaa0(0x19e)]['telegramUser']['findUnique']({'where':{'telegramId':_0x1ba72e},'include':{'shop':!![]}});if(!_0xc55914)return _0x18ea0d[_0x2dcaa0(0x1b1)](0x194)[_0x2dcaa0(0x1c0)]({'success':![],'message':_0x2dcaa0(0x1ca)});await database_1['default'][_0x2dcaa0(0x195)][_0x2dcaa0(0x1b6)]({'where':{'telegramId':_0x1ba72e},'data':{'shopId':null,'isVerified':![]}}),_0x18ea0d[_0x2dcaa0(0x1c0)]({'success':!![],'message':_0x2dcaa0(0x19f)});}catch(_0x4da6ac){_0x28bb49(_0x4da6ac);}},this[_0x555a30(0x1ba)]=async(_0x2abc2b,_0x118085,_0x3e4e97)=>{const _0x37eba2=_0x555a30;try{const {shopId:_0x59342e,type:type='payment',testData:_0x498f97}=_0x2abc2b[_0x37eba2(0x1a5)];if(!_0x59342e)return _0x118085[_0x37eba2(0x1b1)](0x190)[_0x37eba2(0x1c0)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0x54b055=await database_1[_0x37eba2(0x19e)][_0x37eba2(0x1a1)]['findUnique']({'where':{'id':_0x59342e},'select':{'id':!![],'name':!![]}});if(!_0x54b055)return _0x118085[_0x37eba2(0x1b1)](0x194)[_0x37eba2(0x1c0)]({'success':![],'message':_0x37eba2(0x1a8)});switch(type){case _0x37eba2(0x1bb):const _0x3f11c5={'id':_0x37eba2(0x1a9),'amount':_0x498f97?.[_0x37eba2(0x1bd)]||0x64,'currency':_0x498f97?.[_0x37eba2(0x19d)]||'USD','productName':_0x498f97?.[_0x37eba2(0x1b2)]||_0x37eba2(0x1cc),'gateway':_0x498f97?.[_0x37eba2(0x1bf)]||_0x37eba2(0x1a2),'createdAt':new Date(),..._0x498f97};await telegramBotService_1[_0x37eba2(0x1c1)][_0x37eba2(0x1c4)](_0x59342e,_0x3f11c5,_0x37eba2(0x1d1));break;case _0x37eba2(0x1c5):const _0x49c851={'id':_0x37eba2(0x1cf),'amount':_0x498f97?.[_0x37eba2(0x1bd)]||0x1f4,'network':_0x498f97?.['network']||_0x37eba2(0x1d3),'wallet':_0x498f97?.['wallet']||_0x37eba2(0x197),'period':_0x37eba2(0x1c2),'createdAt':new Date(),'txid':_0x498f97?.[_0x37eba2(0x1a3)]||null,..._0x498f97};await telegramBotService_1[_0x37eba2(0x1c1)][_0x37eba2(0x1c6)](_0x59342e,_0x49c851);break;case _0x37eba2(0x19b):await telegramBotService_1[_0x37eba2(0x1c1)]['sendCustomNotification'](_0x59342e,_0x498f97?.['title']||_0x37eba2(0x1b7),_0x498f97?.['details']||{'message':_0x37eba2(0x1ae)});break;default:return _0x118085['status'](0x190)[_0x37eba2(0x1c0)]({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x118085[_0x37eba2(0x1c0)]({'success':!![],'message':_0x37eba2(0x196)+type+_0x37eba2(0x1bc)});}catch(_0x15cb7a){_0x3e4e97(_0x15cb7a);}};}}function a17_0x2502(){const _0x5f495f=['productName','9npuLXI','findMany','lastName','update','Test\x20Notification','getBotInfo','Markdown','sendTestNotification','payment','\x20notification\x20sent\x20successfully','amount','12024304KDzpJF','gateway','json','telegramBotService','Тестовый\x20период','../services/telegramBotService','sendPaymentNotification','payout','sendPayoutNotification','firstName','true','2507407geHknp','Telegram\x20user\x20not\x20found','355509llcXEK','Test\x20Product','count','map','test_payout_123','3553638QaSTJo','paid','isActive','TRC20','sendBroadcast','length','getTelegramUsers','Broadcast\x20message\x20sent\x20successfully','disconnectUser','getBotStatus','6798295CbyTUM','4WrWAvE','telegramUser','Test\x20','TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t','702490IsMULW','shopId','__importDefault','custom','all','currency','default','User\x20disconnected\x20successfully','username','shop','plisio','txid','6LxErTf','body','createdAt','params','Shop\x20not\x20found','test_payment_123','telegramId','sendShopNotification','1251810foxVZt','isVerified','This\x20is\x20a\x20test\x20notification','desc','__esModule','status'];a17_0x2502=function(){return _0x5f495f;};return a17_0x2502();}exports['TelegramController']=TelegramController;