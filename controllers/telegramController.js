'use strict';const a12_0x4aca2e=a12_0x43d6;(function(_0x50326e,_0x46334a){const _0x3d5c68=a12_0x43d6,_0x430c07=_0x50326e();while(!![]){try{const _0x2f2826=-parseInt(_0x3d5c68(0x1e3))/0x1*(parseInt(_0x3d5c68(0x1ce))/0x2)+parseInt(_0x3d5c68(0x1f5))/0x3*(parseInt(_0x3d5c68(0x1be))/0x4)+parseInt(_0x3d5c68(0x1dd))/0x5*(parseInt(_0x3d5c68(0x1e2))/0x6)+parseInt(_0x3d5c68(0x1f4))/0x7*(parseInt(_0x3d5c68(0x1df))/0x8)+-parseInt(_0x3d5c68(0x1e9))/0x9*(-parseInt(_0x3d5c68(0x1da))/0xa)+-parseInt(_0x3d5c68(0x1bd))/0xb*(-parseInt(_0x3d5c68(0x1fe))/0xc)+parseInt(_0x3d5c68(0x1e8))/0xd*(-parseInt(_0x3d5c68(0x1fb))/0xe);if(_0x2f2826===_0x46334a)break;else _0x430c07['push'](_0x430c07['shift']());}catch(_0x430220){_0x430c07['push'](_0x430c07['shift']());}}}(a12_0x4782,0xb7c4c));function a12_0x4782(){const _0x34670b=['isActive','plisio','body','sendCustomNotification','13sxyIcs','783cAeOfY','__importDefault','map','count','details','payment','getBotStatus','getBotInfo','__esModule','telegramUser','amount','3997clwqRN','669yIENyS','shopId','update','telegramId','\x20notification\x20sent\x20successfully','TelegramController','33520676kxAGaY','groupBy','isVerified','2252904ThjFtC','defineProperty','test_payout_123','telegramBotService','sendShopNotification','Markdown','findUnique','completed','updatedAt','66cmVflk','5776oFdCUw','getTelegramUsers','ceil','currency','custom','Test\x20Product','status','paid','Shop\x20not\x20found','payout','findMany','test_payment_123','Broadcast\x20message\x20sent\x20successfully','username','Message\x20is\x20required','params','436602RkdmYS','default','firstName','Test\x20','Telegram\x20user\x20not\x20found','sendTestNotification','sendPayoutNotification','productName','sendBroadcast','true','json','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','111970dDwRpQ','shop','This\x20is\x20a\x20test\x20notification','4475laaUpd','../config/database','4880BeTeXE','../services/telegramBotService','length','6912azUQPh','3ioGNPm'];a12_0x4782=function(){return _0x34670b;};return a12_0x4782();}var __importDefault=this&&this[a12_0x4aca2e(0x1ea)]||function(_0xaafb92){return _0xaafb92&&_0xaafb92['__esModule']?_0xaafb92:{'default':_0xaafb92};};Object[a12_0x4aca2e(0x1ff)](exports,a12_0x4aca2e(0x1f1),{'value':!![]}),exports[a12_0x4aca2e(0x1fa)]=void 0x0;function a12_0x43d6(_0x241752,_0x584492){const _0x47826d=a12_0x4782();return a12_0x43d6=function(_0x43d63b,_0x18a17e){_0x43d63b=_0x43d63b-0x1b7;let _0x327ddf=_0x47826d[_0x43d63b];return _0x327ddf;},a12_0x43d6(_0x241752,_0x584492);}const telegramBotService_1=require(a12_0x4aca2e(0x1e0)),database_1=__importDefault(require(a12_0x4aca2e(0x1de)));class TelegramController{constructor(){const _0x3aa7e1=a12_0x4aca2e;this[_0x3aa7e1(0x1ef)]=async(_0x24f3bb,_0x480b88,_0x389c9f)=>{const _0x1d43a4=_0x3aa7e1;try{const _0x43faae=telegramBotService_1[_0x1d43a4(0x1b7)][_0x1d43a4(0x1f0)](),_0x332767=await database_1[_0x1d43a4(0x1cf)][_0x1d43a4(0x1f2)][_0x1d43a4(0x1ec)](),_0x109c27=await database_1[_0x1d43a4(0x1cf)][_0x1d43a4(0x1f2)][_0x1d43a4(0x1ec)]({'where':{'isVerified':!![]}}),_0x3262be=await database_1[_0x1d43a4(0x1cf)][_0x1d43a4(0x1f2)][_0x1d43a4(0x1fc)]({'by':[_0x1d43a4(0x1f6)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x480b88['json']({'success':!![],'result':{'bot':{'isActive':_0x43faae[_0x1d43a4(0x1e4)],'username':_0x43faae[_0x1d43a4(0x1cb)]},'statistics':{'totalUsers':_0x332767,'verifiedUsers':_0x109c27,'unverifiedUsers':_0x332767-_0x109c27,'connectedShops':_0x3262be[_0x1d43a4(0x1e1)]}}});}catch(_0x32e8a7){_0x389c9f(_0x32e8a7);}},this[_0x3aa7e1(0x1bf)]=async(_0x5ab058,_0x296245,_0x3eff94)=>{const _0x14beeb=_0x3aa7e1;try{const {page:page=0x1,limit:limit=0x14,verified:_0x43c9fd}=_0x5ab058['query'],_0x4f7fa0=(Number(page)-0x1)*Number(limit),_0x22daa7={};_0x43c9fd!==undefined&&(_0x22daa7[_0x14beeb(0x1fd)]=_0x43c9fd===_0x14beeb(0x1d7));const [_0x4b9a54,_0x43555e]=await Promise['all']([database_1[_0x14beeb(0x1cf)][_0x14beeb(0x1f2)][_0x14beeb(0x1c8)]({'where':_0x22daa7,'skip':_0x4f7fa0,'take':Number(limit),'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x14beeb(0x1cf)]['telegramUser'][_0x14beeb(0x1ec)]({'where':_0x22daa7})]);_0x296245[_0x14beeb(0x1d8)]({'success':!![],'users':_0x4b9a54[_0x14beeb(0x1eb)](_0x5cd668=>({'id':_0x5cd668['id'],'telegramId':_0x5cd668[_0x14beeb(0x1f8)],'username':_0x5cd668['username'],'firstName':_0x5cd668[_0x14beeb(0x1d0)],'lastName':_0x5cd668['lastName'],'isVerified':_0x5cd668[_0x14beeb(0x1fd)],'shop':_0x5cd668[_0x14beeb(0x1db)],'createdAt':_0x5cd668['createdAt'],'updatedAt':_0x5cd668[_0x14beeb(0x1bc)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x43555e,'totalPages':Math[_0x14beeb(0x1c0)](_0x43555e/Number(limit))}});}catch(_0x14fd09){_0x3eff94(_0x14fd09);}},this[_0x3aa7e1(0x1d6)]=async(_0x5d9d35,_0x37f4f1,_0x3ba835)=>{const _0x1d95a0=_0x3aa7e1;try{const {message:_0x278e2a,shopId:_0x322aac}=_0x5d9d35[_0x1d95a0(0x1e6)];if(!_0x278e2a)return _0x37f4f1[_0x1d95a0(0x1c4)](0x190)['json']({'success':![],'message':_0x1d95a0(0x1cc)});if(_0x322aac)await telegramBotService_1[_0x1d95a0(0x1b7)]['sendShopNotification'](_0x322aac,_0x278e2a,{'parse_mode':'Markdown'});else{const _0x4505fa=await database_1[_0x1d95a0(0x1cf)][_0x1d95a0(0x1f2)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x34b1f1=[...new Set(_0x4505fa[_0x1d95a0(0x1eb)](_0x294adb=>_0x294adb['shopId'])['filter'](Boolean))];for(const _0x3ae3a9 of _0x34b1f1){_0x3ae3a9&&await telegramBotService_1[_0x1d95a0(0x1b7)][_0x1d95a0(0x1b8)](_0x3ae3a9,_0x278e2a,{'parse_mode':_0x1d95a0(0x1b9)});}}_0x37f4f1['json']({'success':!![],'message':_0x1d95a0(0x1ca)});}catch(_0x3e04e6){_0x3ba835(_0x3e04e6);}},this['disconnectUser']=async(_0x1813ec,_0x46b1a6,_0x565e26)=>{const _0x41b624=_0x3aa7e1;try{const {telegramId:_0x45960c}=_0x1813ec[_0x41b624(0x1cd)],_0x13664a=await database_1['default']['telegramUser']['findUnique']({'where':{'telegramId':_0x45960c},'include':{'shop':!![]}});if(!_0x13664a)return _0x46b1a6[_0x41b624(0x1c4)](0x194)['json']({'success':![],'message':_0x41b624(0x1d2)});await database_1[_0x41b624(0x1cf)][_0x41b624(0x1f2)][_0x41b624(0x1f7)]({'where':{'telegramId':_0x45960c},'data':{'shopId':null,'isVerified':![]}}),_0x46b1a6[_0x41b624(0x1d8)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x3734d5){_0x565e26(_0x3734d5);}},this[_0x3aa7e1(0x1d3)]=async(_0x25f9ce,_0x2207a0,_0x75b48d)=>{const _0x22c6d3=_0x3aa7e1;try{const {shopId:_0x3f72e7,type:type=_0x22c6d3(0x1ee),testData:_0x1b1c1c}=_0x25f9ce[_0x22c6d3(0x1e6)];if(!_0x3f72e7)return _0x2207a0[_0x22c6d3(0x1c4)](0x190)[_0x22c6d3(0x1d8)]({'success':![],'message':'Shop\x20ID\x20is\x20required'});const _0xa6f46a=await database_1['default'][_0x22c6d3(0x1db)][_0x22c6d3(0x1ba)]({'where':{'id':_0x3f72e7},'select':{'id':!![],'name':!![]}});if(!_0xa6f46a)return _0x2207a0[_0x22c6d3(0x1c4)](0x194)[_0x22c6d3(0x1d8)]({'success':![],'message':_0x22c6d3(0x1c6)});switch(type){case _0x22c6d3(0x1ee):const _0x1df7e4={'id':_0x22c6d3(0x1c9),'amount':_0x1b1c1c?.['amount']||0x64,'currency':_0x1b1c1c?.[_0x22c6d3(0x1c1)]||'USD','productName':_0x1b1c1c?.[_0x22c6d3(0x1d5)]||_0x22c6d3(0x1c3),'gateway':_0x1b1c1c?.['gateway']||_0x22c6d3(0x1e5),'createdAt':new Date(),..._0x1b1c1c};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x3f72e7,_0x1df7e4,_0x22c6d3(0x1c5));break;case _0x22c6d3(0x1c7):const _0x9643a6={'id':_0x22c6d3(0x200),'amount':_0x1b1c1c?.[_0x22c6d3(0x1f3)]||0x1f4,'method':_0x1b1c1c?.['method']||'bank_transfer','createdAt':new Date(),..._0x1b1c1c};await telegramBotService_1[_0x22c6d3(0x1b7)][_0x22c6d3(0x1d4)](_0x3f72e7,_0x9643a6,_0x22c6d3(0x1bb));break;case _0x22c6d3(0x1c2):await telegramBotService_1[_0x22c6d3(0x1b7)][_0x22c6d3(0x1e7)](_0x3f72e7,_0x1b1c1c?.['title']||'Test\x20Notification',_0x1b1c1c?.[_0x22c6d3(0x1ed)]||{'message':_0x22c6d3(0x1dc)});break;default:return _0x2207a0['status'](0x190)[_0x22c6d3(0x1d8)]({'success':![],'message':_0x22c6d3(0x1d9)});}_0x2207a0[_0x22c6d3(0x1d8)]({'success':!![],'message':_0x22c6d3(0x1d1)+type+_0x22c6d3(0x1f9)});}catch(_0x229229){_0x75b48d(_0x229229);}};}}exports[a12_0x4aca2e(0x1fa)]=TelegramController;