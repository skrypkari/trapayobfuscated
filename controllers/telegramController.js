'use strict';const a12_0xd62821=a12_0x1fc4;function a12_0x568b(){const _0x3b4ec5=['Telegram\x20user\x20not\x20found','Markdown','sendShopNotification','shop','getBotStatus','Shop\x20ID\x20is\x20required','findMany','95244TiYkFD','filter','TelegramController','map','count','350074dyDETz','gateway','telegramUser','USD','default','__esModule','100Fhsuqc','6461736TKUhON','1723940dfxeNe','Test\x20','json','getBotInfo','3300gILkZh','status','isActive','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','161WfLMEk','amount','test_payout_123','11udjizl','custom','disconnectUser','lastName','username','update','Message\x20is\x20required','findUnique','18WFcyxr','1iLOfLF','true','paid','\x20notification\x20sent\x20successfully','query','defineProperty','payment','body','telegramBotService','plisio','shopId','productName','title','test_payment_123','completed','492120SNAAeS','updatedAt','desc','params','sendCustomNotification','sendPayoutNotification','all','29816HkbzXo','__importDefault','ceil','details','sendTestNotification','Test\x20Notification'];a12_0x568b=function(){return _0x3b4ec5;};return a12_0x568b();}(function(_0x56909d,_0x3861fa){const _0x651411=a12_0x1fc4,_0x1abb5d=_0x56909d();while(!![]){try{const _0x20cb04=-parseInt(_0x651411(0x205))/0x1*(-parseInt(_0x651411(0x1e9))/0x2)+parseInt(_0x651411(0x1e4))/0x3+parseInt(_0x651411(0x21b))/0x4*(parseInt(_0x651411(0x1ef))/0x5)+-parseInt(_0x651411(0x1f5))/0x6*(parseInt(_0x651411(0x1f9))/0x7)+-parseInt(_0x651411(0x214))/0x8*(-parseInt(_0x651411(0x204))/0x9)+parseInt(_0x651411(0x1f1))/0xa*(parseInt(_0x651411(0x1fc))/0xb)+-parseInt(_0x651411(0x1f0))/0xc;if(_0x20cb04===_0x3861fa)break;else _0x1abb5d['push'](_0x1abb5d['shift']());}catch(_0x311086){_0x1abb5d['push'](_0x1abb5d['shift']());}}}(a12_0x568b,0x18741));var __importDefault=this&&this[a12_0xd62821(0x21c)]||function(_0x59c424){const _0x590e16=a12_0xd62821;return _0x59c424&&_0x59c424[_0x590e16(0x1ee)]?_0x59c424:{'default':_0x59c424};};Object[a12_0xd62821(0x20a)](exports,a12_0xd62821(0x1ee),{'value':!![]}),exports[a12_0xd62821(0x1e6)]=void 0x0;function a12_0x1fc4(_0x338f17,_0x168b14){const _0x568b36=a12_0x568b();return a12_0x1fc4=function(_0x1fc479,_0x1d1503){_0x1fc479=_0x1fc479-0x1e1;let _0x554cbe=_0x568b36[_0x1fc479];return _0x554cbe;},a12_0x1fc4(_0x338f17,_0x168b14);}const telegramBotService_1=require('../services/telegramBotService'),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x5991ba=a12_0xd62821;this[_0x5991ba(0x1e1)]=async(_0x564e72,_0x4b2e00,_0x34a9ef)=>{const _0x36a871=_0x5991ba;try{const _0x5f133a=telegramBotService_1[_0x36a871(0x20d)][_0x36a871(0x1f4)](),_0x36cb4c=await database_1[_0x36a871(0x1ed)][_0x36a871(0x1eb)][_0x36a871(0x1e8)](),_0x521b2c=await database_1['default'][_0x36a871(0x1eb)]['count']({'where':{'isVerified':!![]}}),_0x4ec468=await database_1['default'][_0x36a871(0x1eb)]['groupBy']({'by':[_0x36a871(0x20f)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x4b2e00[_0x36a871(0x1f3)]({'success':!![],'result':{'bot':{'isActive':_0x5f133a[_0x36a871(0x1f7)],'username':_0x5f133a['username']},'statistics':{'totalUsers':_0x36cb4c,'verifiedUsers':_0x521b2c,'unverifiedUsers':_0x36cb4c-_0x521b2c,'connectedShops':_0x4ec468['length']}}});}catch(_0x203402){_0x34a9ef(_0x203402);}},this['getTelegramUsers']=async(_0x49be59,_0x11eb99,_0x3c8e8a)=>{const _0x36761b=_0x5991ba;try{const {page:page=0x1,limit:limit=0x14,verified:_0x1e4f2e}=_0x49be59[_0x36761b(0x209)],_0x4b02af=(Number(page)-0x1)*Number(limit),_0x3b9d67={};_0x1e4f2e!==undefined&&(_0x3b9d67['isVerified']=_0x1e4f2e===_0x36761b(0x206));const [_0x309ce8,_0x4aed3f]=await Promise[_0x36761b(0x21a)]([database_1[_0x36761b(0x1ed)]['telegramUser'][_0x36761b(0x1e3)]({'where':_0x3b9d67,'skip':_0x4b02af,'take':Number(limit),'orderBy':{'createdAt':_0x36761b(0x216)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x36761b(0x1ed)][_0x36761b(0x1eb)][_0x36761b(0x1e8)]({'where':_0x3b9d67})]);_0x11eb99[_0x36761b(0x1f3)]({'success':!![],'users':_0x309ce8[_0x36761b(0x1e7)](_0x3d34b3=>({'id':_0x3d34b3['id'],'telegramId':_0x3d34b3['telegramId'],'username':_0x3d34b3[_0x36761b(0x200)],'firstName':_0x3d34b3['firstName'],'lastName':_0x3d34b3[_0x36761b(0x1ff)],'isVerified':_0x3d34b3['isVerified'],'shop':_0x3d34b3[_0x36761b(0x224)],'createdAt':_0x3d34b3['createdAt'],'updatedAt':_0x3d34b3[_0x36761b(0x215)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x4aed3f,'totalPages':Math[_0x36761b(0x21d)](_0x4aed3f/Number(limit))}});}catch(_0x1520a1){_0x3c8e8a(_0x1520a1);}},this['sendBroadcast']=async(_0x1ffd08,_0xf0955e,_0x4389a7)=>{const _0xf721bf=_0x5991ba;try{const {message:_0x511de5,shopId:_0x2d399e}=_0x1ffd08[_0xf721bf(0x20c)];if(!_0x511de5)return _0xf0955e[_0xf721bf(0x1f6)](0x190)[_0xf721bf(0x1f3)]({'success':![],'message':_0xf721bf(0x202)});if(_0x2d399e)await telegramBotService_1[_0xf721bf(0x20d)][_0xf721bf(0x223)](_0x2d399e,_0x511de5,{'parse_mode':_0xf721bf(0x222)});else{const _0xac8b22=await database_1['default'][_0xf721bf(0x1eb)][_0xf721bf(0x1e3)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x361c42=[...new Set(_0xac8b22[_0xf721bf(0x1e7)](_0x55234d=>_0x55234d[_0xf721bf(0x20f)])[_0xf721bf(0x1e5)](Boolean))];for(const _0x4d3a86 of _0x361c42){_0x4d3a86&&await telegramBotService_1['telegramBotService'][_0xf721bf(0x223)](_0x4d3a86,_0x511de5,{'parse_mode':_0xf721bf(0x222)});}}_0xf0955e['json']({'success':!![],'message':'Broadcast\x20message\x20sent\x20successfully'});}catch(_0x364cde){_0x4389a7(_0x364cde);}},this[_0x5991ba(0x1fe)]=async(_0x151dce,_0x1c89ff,_0x1979fc)=>{const _0x335186=_0x5991ba;try{const {telegramId:_0x155aec}=_0x151dce[_0x335186(0x217)],_0x2c4eb1=await database_1[_0x335186(0x1ed)][_0x335186(0x1eb)][_0x335186(0x203)]({'where':{'telegramId':_0x155aec},'include':{'shop':!![]}});if(!_0x2c4eb1)return _0x1c89ff[_0x335186(0x1f6)](0x194)['json']({'success':![],'message':_0x335186(0x221)});await database_1[_0x335186(0x1ed)][_0x335186(0x1eb)][_0x335186(0x201)]({'where':{'telegramId':_0x155aec},'data':{'shopId':null,'isVerified':![]}}),_0x1c89ff[_0x335186(0x1f3)]({'success':!![],'message':'User\x20disconnected\x20successfully'});}catch(_0x2afc37){_0x1979fc(_0x2afc37);}},this[_0x5991ba(0x21f)]=async(_0x6e43f,_0x1c16b5,_0x451e38)=>{const _0x457527=_0x5991ba;try{const {shopId:_0x2a50b6,type:type=_0x457527(0x20b),testData:_0x36c71c}=_0x6e43f[_0x457527(0x20c)];if(!_0x2a50b6)return _0x1c16b5[_0x457527(0x1f6)](0x190)[_0x457527(0x1f3)]({'success':![],'message':_0x457527(0x1e2)});const _0x5cdbae=await database_1['default'][_0x457527(0x224)]['findUnique']({'where':{'id':_0x2a50b6},'select':{'id':!![],'name':!![]}});if(!_0x5cdbae)return _0x1c16b5[_0x457527(0x1f6)](0x194)[_0x457527(0x1f3)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x457527(0x20b):const _0x2d125b={'id':_0x457527(0x212),'amount':_0x36c71c?.[_0x457527(0x1fa)]||0x64,'currency':_0x36c71c?.['currency']||_0x457527(0x1ec),'productName':_0x36c71c?.[_0x457527(0x210)]||'Test\x20Product','gateway':_0x36c71c?.[_0x457527(0x1ea)]||_0x457527(0x20e),'createdAt':new Date(),..._0x36c71c};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x2a50b6,_0x2d125b,_0x457527(0x207));break;case'payout':const _0x476ddd={'id':_0x457527(0x1fb),'amount':_0x36c71c?.[_0x457527(0x1fa)]||0x1f4,'method':_0x36c71c?.['method']||'bank_transfer','createdAt':new Date(),..._0x36c71c};await telegramBotService_1[_0x457527(0x20d)][_0x457527(0x219)](_0x2a50b6,_0x476ddd,_0x457527(0x213));break;case _0x457527(0x1fd):await telegramBotService_1[_0x457527(0x20d)][_0x457527(0x218)](_0x2a50b6,_0x36c71c?.[_0x457527(0x211)]||_0x457527(0x220),_0x36c71c?.[_0x457527(0x21e)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x1c16b5[_0x457527(0x1f6)](0x190)['json']({'success':![],'message':_0x457527(0x1f8)});}_0x1c16b5[_0x457527(0x1f3)]({'success':!![],'message':_0x457527(0x1f2)+type+_0x457527(0x208)});}catch(_0x1560a9){_0x451e38(_0x1560a9);}};}}exports[a12_0xd62821(0x1e6)]=TelegramController;