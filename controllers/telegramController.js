'use strict';const a12_0x14153f=a12_0x5438;(function(_0x25c553,_0x4b6db2){const _0x1bcaf7=a12_0x5438,_0x24e853=_0x25c553();while(!![]){try{const _0x20a4c7=parseInt(_0x1bcaf7(0xd2))/0x1+parseInt(_0x1bcaf7(0xff))/0x2*(parseInt(_0x1bcaf7(0xf6))/0x3)+parseInt(_0x1bcaf7(0xf4))/0x4+parseInt(_0x1bcaf7(0x100))/0x5+-parseInt(_0x1bcaf7(0x10a))/0x6*(parseInt(_0x1bcaf7(0xf9))/0x7)+parseInt(_0x1bcaf7(0xf8))/0x8+-parseInt(_0x1bcaf7(0x111))/0x9;if(_0x20a4c7===_0x4b6db2)break;else _0x24e853['push'](_0x24e853['shift']());}catch(_0x37149a){_0x24e853['push'](_0x24e853['shift']());}}}(a12_0x3ca5,0xc7955));function a12_0x5438(_0x4874bc,_0xd423a6){const _0x3ca5aa=a12_0x3ca5();return a12_0x5438=function(_0x543876,_0x524288){_0x543876=_0x543876-0xd0;let _0x58a4e8=_0x3ca5aa[_0x543876];return _0x58a4e8;},a12_0x5438(_0x4874bc,_0xd423a6);}var __importDefault=this&&this[a12_0x14153f(0xf5)]||function(_0x38aaf5){return _0x38aaf5&&_0x38aaf5['__esModule']?_0x38aaf5:{'default':_0x38aaf5};};function a12_0x3ca5(){const _0x31a16d=['shopId','plisio','isVerified','6421316gWcGcu','__importDefault','507183mwzCbF','productName','1000616OTDdeA','14042MhklOp','username','createdAt','title','getBotInfo','../services/telegramBotService','14iVszzm','1262190XCFGXj','defineProperty','groupBy','json','disconnectUser','method','firstName','count','This\x20is\x20a\x20test\x20notification','payout','2826HCvqBJ','lastName','sendShopNotification','paid','sendBroadcast','sendCustomNotification','Shop\x20not\x20found','20646126VjCVqQ','default','update','details','payment','890062AVshxm','Markdown','status','ceil','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','Broadcast\x20message\x20sent\x20successfully','shop','gateway','../config/database','amount','telegramBotService','USD','findMany','Telegram\x20user\x20not\x20found','sendPaymentNotification','telegramUser','test_payment_123','telegramId','User\x20disconnected\x20successfully','filter','sendPayoutNotification','TelegramController','Shop\x20ID\x20is\x20required','findUnique','currency','Message\x20is\x20required','length','desc','__esModule','\x20notification\x20sent\x20successfully','body'];a12_0x3ca5=function(){return _0x31a16d;};return a12_0x3ca5();}Object[a12_0x14153f(0x101)](exports,a12_0x14153f(0xee),{'value':!![]}),exports[a12_0x14153f(0xe7)]=void 0x0;const telegramBotService_1=require(a12_0x14153f(0xfe)),database_1=__importDefault(require(a12_0x14153f(0xda)));class TelegramController{constructor(){const _0x58f449=a12_0x14153f;this['getBotStatus']=async(_0x4a565b,_0x1da948,_0x34b4fa)=>{const _0x5000cf=a12_0x5438;try{const _0x78f6f3=telegramBotService_1[_0x5000cf(0xdc)][_0x5000cf(0xfd)](),_0x2ea055=await database_1[_0x5000cf(0x112)][_0x5000cf(0xe1)][_0x5000cf(0x107)](),_0x476afc=await database_1[_0x5000cf(0x112)][_0x5000cf(0xe1)][_0x5000cf(0x107)]({'where':{'isVerified':!![]}}),_0x429738=await database_1[_0x5000cf(0x112)]['telegramUser'][_0x5000cf(0x102)]({'by':[_0x5000cf(0xf1)],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x1da948[_0x5000cf(0x103)]({'success':!![],'result':{'bot':{'isActive':_0x78f6f3['isActive'],'username':_0x78f6f3[_0x5000cf(0xfa)]},'statistics':{'totalUsers':_0x2ea055,'verifiedUsers':_0x476afc,'unverifiedUsers':_0x2ea055-_0x476afc,'connectedShops':_0x429738[_0x5000cf(0xec)]}}});}catch(_0x4930ad){_0x34b4fa(_0x4930ad);}},this['getTelegramUsers']=async(_0x241441,_0x324fc8,_0x550a9e)=>{const _0x8675fa=a12_0x5438;try{const {page:page=0x1,limit:limit=0x14,verified:_0x42845a}=_0x241441['query'],_0x49223f=(Number(page)-0x1)*Number(limit),_0x949105={};_0x42845a!==undefined&&(_0x949105[_0x8675fa(0xf3)]=_0x42845a==='true');const [_0x1262ed,_0x32a6fa]=await Promise['all']([database_1['default']['telegramUser'][_0x8675fa(0xde)]({'where':_0x949105,'skip':_0x49223f,'take':Number(limit),'orderBy':{'createdAt':_0x8675fa(0xed)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x8675fa(0x112)][_0x8675fa(0xe1)][_0x8675fa(0x107)]({'where':_0x949105})]);_0x324fc8['json']({'success':!![],'users':_0x1262ed['map'](_0x54dff3=>({'id':_0x54dff3['id'],'telegramId':_0x54dff3[_0x8675fa(0xe3)],'username':_0x54dff3[_0x8675fa(0xfa)],'firstName':_0x54dff3[_0x8675fa(0x106)],'lastName':_0x54dff3[_0x8675fa(0x10b)],'isVerified':_0x54dff3[_0x8675fa(0xf3)],'shop':_0x54dff3[_0x8675fa(0xd8)],'createdAt':_0x54dff3[_0x8675fa(0xfb)],'updatedAt':_0x54dff3['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x32a6fa,'totalPages':Math[_0x8675fa(0xd5)](_0x32a6fa/Number(limit))}});}catch(_0x8f42fb){_0x550a9e(_0x8f42fb);}},this[_0x58f449(0x10e)]=async(_0x41ea02,_0x455643,_0x305e5c)=>{const _0x57d7c9=_0x58f449;try{const {message:_0x31a72b,shopId:_0x3adf92}=_0x41ea02[_0x57d7c9(0xf0)];if(!_0x31a72b)return _0x455643[_0x57d7c9(0xd4)](0x190)[_0x57d7c9(0x103)]({'success':![],'message':_0x57d7c9(0xeb)});if(_0x3adf92)await telegramBotService_1[_0x57d7c9(0xdc)][_0x57d7c9(0x10c)](_0x3adf92,_0x31a72b,{'parse_mode':_0x57d7c9(0xd3)});else{const _0x438d70=await database_1['default'][_0x57d7c9(0xe1)][_0x57d7c9(0xde)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x5d1ea3=[...new Set(_0x438d70['map'](_0xbff939=>_0xbff939[_0x57d7c9(0xf1)])[_0x57d7c9(0xe5)](Boolean))];for(const _0x2d3eb0 of _0x5d1ea3){_0x2d3eb0&&await telegramBotService_1[_0x57d7c9(0xdc)][_0x57d7c9(0x10c)](_0x2d3eb0,_0x31a72b,{'parse_mode':_0x57d7c9(0xd3)});}}_0x455643[_0x57d7c9(0x103)]({'success':!![],'message':_0x57d7c9(0xd7)});}catch(_0x1399ae){_0x305e5c(_0x1399ae);}},this[_0x58f449(0x104)]=async(_0x442854,_0x1e3066,_0x3e2852)=>{const _0x4768be=_0x58f449;try{const {telegramId:_0x5779e9}=_0x442854['params'],_0x352617=await database_1[_0x4768be(0x112)]['telegramUser'][_0x4768be(0xe9)]({'where':{'telegramId':_0x5779e9},'include':{'shop':!![]}});if(!_0x352617)return _0x1e3066[_0x4768be(0xd4)](0x194)[_0x4768be(0x103)]({'success':![],'message':_0x4768be(0xdf)});await database_1[_0x4768be(0x112)]['telegramUser'][_0x4768be(0x113)]({'where':{'telegramId':_0x5779e9},'data':{'shopId':null,'isVerified':![]}}),_0x1e3066[_0x4768be(0x103)]({'success':!![],'message':_0x4768be(0xe4)});}catch(_0x555fcc){_0x3e2852(_0x555fcc);}},this['sendTestNotification']=async(_0x51fc74,_0x41819a,_0x1c882b)=>{const _0x5191bc=_0x58f449;try{const {shopId:_0x313dfe,type:type='payment',testData:_0x219293}=_0x51fc74[_0x5191bc(0xf0)];if(!_0x313dfe)return _0x41819a[_0x5191bc(0xd4)](0x190)['json']({'success':![],'message':_0x5191bc(0xe8)});const _0x301031=await database_1[_0x5191bc(0x112)][_0x5191bc(0xd8)]['findUnique']({'where':{'id':_0x313dfe},'select':{'id':!![],'name':!![]}});if(!_0x301031)return _0x41819a[_0x5191bc(0xd4)](0x194)['json']({'success':![],'message':_0x5191bc(0x110)});switch(type){case _0x5191bc(0xd1):const _0x4354ab={'id':_0x5191bc(0xe2),'amount':_0x219293?.['amount']||0x64,'currency':_0x219293?.[_0x5191bc(0xea)]||_0x5191bc(0xdd),'productName':_0x219293?.[_0x5191bc(0xf7)]||'Test\x20Product','gateway':_0x219293?.[_0x5191bc(0xd9)]||_0x5191bc(0xf2),'createdAt':new Date(),..._0x219293};await telegramBotService_1[_0x5191bc(0xdc)][_0x5191bc(0xe0)](_0x313dfe,_0x4354ab,_0x5191bc(0x10d));break;case _0x5191bc(0x109):const _0x12dc32={'id':'test_payout_123','amount':_0x219293?.[_0x5191bc(0xdb)]||0x1f4,'method':_0x219293?.[_0x5191bc(0x105)]||'bank_transfer','createdAt':new Date(),..._0x219293};await telegramBotService_1[_0x5191bc(0xdc)][_0x5191bc(0xe6)](_0x313dfe,_0x12dc32,'completed');break;case'custom':await telegramBotService_1[_0x5191bc(0xdc)][_0x5191bc(0x10f)](_0x313dfe,_0x219293?.[_0x5191bc(0xfc)]||'Test\x20Notification',_0x219293?.[_0x5191bc(0xd0)]||{'message':_0x5191bc(0x108)});break;default:return _0x41819a[_0x5191bc(0xd4)](0x190)[_0x5191bc(0x103)]({'success':![],'message':_0x5191bc(0xd6)});}_0x41819a[_0x5191bc(0x103)]({'success':!![],'message':'Test\x20'+type+_0x5191bc(0xef)});}catch(_0x2d3f35){_0x1c882b(_0x2d3f35);}};}}exports[a12_0x14153f(0xe7)]=TelegramController;