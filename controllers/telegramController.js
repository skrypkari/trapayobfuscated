'use strict';const a12_0x518b5a=a12_0x3425;(function(_0x4482b9,_0x601af){const _0x180312=a12_0x3425,_0x294be4=_0x4482b9();while(!![]){try{const _0x1fbd1f=-parseInt(_0x180312(0x134))/0x1+-parseInt(_0x180312(0x15f))/0x2*(parseInt(_0x180312(0x132))/0x3)+-parseInt(_0x180312(0x135))/0x4*(-parseInt(_0x180312(0x131))/0x5)+-parseInt(_0x180312(0x168))/0x6+-parseInt(_0x180312(0x162))/0x7*(-parseInt(_0x180312(0x130))/0x8)+parseInt(_0x180312(0x133))/0x9*(parseInt(_0x180312(0x15a))/0xa)+parseInt(_0x180312(0x12b))/0xb;if(_0x1fbd1f===_0x601af)break;else _0x294be4['push'](_0x294be4['shift']());}catch(_0x403d62){_0x294be4['push'](_0x294be4['shift']());}}}(a12_0xa102,0x76c23));function a12_0xa102(){const _0x1b097c=['shopId','map','Markdown','filter','Test\x20Product','20YifYZt','status','all','params','Test\x20','124740giXBUI','ceil','query','3605KtAhaY','updatedAt','Telegram\x20user\x20not\x20found','TelegramController','Shop\x20ID\x20is\x20required','Broadcast\x20message\x20sent\x20successfully','868938elgDbl','__importDefault','getBotStatus','__esModule','amount','\x20notification\x20sent\x20successfully','40007VSSbCZ','shop','paid','telegramBotService','USD','11224yYiNBw','357195pkYPEq','39SvCobi','989487iqCDEh','289829LKKPmL','44fDaaRo','disconnectUser','defineProperty','User\x20disconnected\x20successfully','createdAt','findUnique','currency','length','isVerified','getTelegramUsers','productName','test_payout_123','groupBy','payment','sendPayoutNotification','../services/telegramBotService','default','Message\x20is\x20required','lastName','findMany','details','isActive','desc','This\x20is\x20a\x20test\x20notification','sendCustomNotification','count','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','telegramUser','body','json','Shop\x20not\x20found','username'];a12_0xa102=function(){return _0x1b097c;};return a12_0xa102();}var __importDefault=this&&this[a12_0x518b5a(0x169)]||function(_0x3b2b28){const _0x510e37=a12_0x518b5a;return _0x3b2b28&&_0x3b2b28[_0x510e37(0x16b)]?_0x3b2b28:{'default':_0x3b2b28};};function a12_0x3425(_0x3dcb5a,_0x2dd944){const _0xa102cc=a12_0xa102();return a12_0x3425=function(_0x342505,_0x3e9954){_0x342505=_0x342505-0x12b;let _0x553e25=_0xa102cc[_0x342505];return _0x553e25;},a12_0x3425(_0x3dcb5a,_0x2dd944);}Object[a12_0x518b5a(0x137)](exports,a12_0x518b5a(0x16b),{'value':!![]}),exports[a12_0x518b5a(0x165)]=void 0x0;const telegramBotService_1=require(a12_0x518b5a(0x144)),database_1=__importDefault(require('../config/database'));class TelegramController{constructor(){const _0x16b4cf=a12_0x518b5a;this[_0x16b4cf(0x16a)]=async(_0x2c75f4,_0xaf4b78,_0x37ed5a)=>{const _0x47b0c8=_0x16b4cf;try{const _0x5f5b3e=telegramBotService_1['telegramBotService']['getBotInfo'](),_0x2f8820=await database_1['default'][_0x47b0c8(0x150)]['count'](),_0x193d43=await database_1['default'][_0x47b0c8(0x150)][_0x47b0c8(0x14e)]({'where':{'isVerified':!![]}}),_0x43fbaa=await database_1[_0x47b0c8(0x145)][_0x47b0c8(0x150)][_0x47b0c8(0x141)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0xaf4b78[_0x47b0c8(0x152)]({'success':!![],'result':{'bot':{'isActive':_0x5f5b3e[_0x47b0c8(0x14a)],'username':_0x5f5b3e['username']},'statistics':{'totalUsers':_0x2f8820,'verifiedUsers':_0x193d43,'unverifiedUsers':_0x2f8820-_0x193d43,'connectedShops':_0x43fbaa[_0x47b0c8(0x13c)]}}});}catch(_0x223e87){_0x37ed5a(_0x223e87);}},this[_0x16b4cf(0x13e)]=async(_0x2f82fe,_0xdba289,_0x3d9301)=>{const _0x35355e=_0x16b4cf;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2459a7}=_0x2f82fe[_0x35355e(0x161)],_0x5d8b29=(Number(page)-0x1)*Number(limit),_0x2c6428={};_0x2459a7!==undefined&&(_0x2c6428[_0x35355e(0x13d)]=_0x2459a7==='true');const [_0x315c1f,_0x57cd55]=await Promise[_0x35355e(0x15c)]([database_1[_0x35355e(0x145)]['telegramUser'][_0x35355e(0x148)]({'where':_0x2c6428,'skip':_0x5d8b29,'take':Number(limit),'orderBy':{'createdAt':_0x35355e(0x14b)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x35355e(0x145)][_0x35355e(0x150)][_0x35355e(0x14e)]({'where':_0x2c6428})]);_0xdba289[_0x35355e(0x152)]({'success':!![],'users':_0x315c1f[_0x35355e(0x156)](_0x3b31d1=>({'id':_0x3b31d1['id'],'telegramId':_0x3b31d1['telegramId'],'username':_0x3b31d1[_0x35355e(0x154)],'firstName':_0x3b31d1['firstName'],'lastName':_0x3b31d1[_0x35355e(0x147)],'isVerified':_0x3b31d1[_0x35355e(0x13d)],'shop':_0x3b31d1[_0x35355e(0x12c)],'createdAt':_0x3b31d1[_0x35355e(0x139)],'updatedAt':_0x3b31d1[_0x35355e(0x163)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x57cd55,'totalPages':Math[_0x35355e(0x160)](_0x57cd55/Number(limit))}});}catch(_0x4da68f){_0x3d9301(_0x4da68f);}},this['sendBroadcast']=async(_0x4394a0,_0x4414d8,_0x4f00b8)=>{const _0x53826e=_0x16b4cf;try{const {message:_0x54e393,shopId:_0x7089ff}=_0x4394a0[_0x53826e(0x151)];if(!_0x54e393)return _0x4414d8[_0x53826e(0x15b)](0x190)[_0x53826e(0x152)]({'success':![],'message':_0x53826e(0x146)});if(_0x7089ff)await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x7089ff,_0x54e393,{'parse_mode':'Markdown'});else{const _0x1eae44=await database_1[_0x53826e(0x145)][_0x53826e(0x150)][_0x53826e(0x148)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x476004=[...new Set(_0x1eae44[_0x53826e(0x156)](_0x4ea038=>_0x4ea038[_0x53826e(0x155)])[_0x53826e(0x158)](Boolean))];for(const _0x5e1cb4 of _0x476004){_0x5e1cb4&&await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x5e1cb4,_0x54e393,{'parse_mode':_0x53826e(0x157)});}}_0x4414d8[_0x53826e(0x152)]({'success':!![],'message':_0x53826e(0x167)});}catch(_0x32e15c){_0x4f00b8(_0x32e15c);}},this[_0x16b4cf(0x136)]=async(_0x554358,_0x270334,_0x5f2805)=>{const _0x4cce4d=_0x16b4cf;try{const {telegramId:_0x16ea44}=_0x554358[_0x4cce4d(0x15d)],_0x4fe4c3=await database_1[_0x4cce4d(0x145)][_0x4cce4d(0x150)][_0x4cce4d(0x13a)]({'where':{'telegramId':_0x16ea44},'include':{'shop':!![]}});if(!_0x4fe4c3)return _0x270334[_0x4cce4d(0x15b)](0x194)[_0x4cce4d(0x152)]({'success':![],'message':_0x4cce4d(0x164)});await database_1['default'][_0x4cce4d(0x150)]['update']({'where':{'telegramId':_0x16ea44},'data':{'shopId':null,'isVerified':![]}}),_0x270334[_0x4cce4d(0x152)]({'success':!![],'message':_0x4cce4d(0x138)});}catch(_0x35f347){_0x5f2805(_0x35f347);}},this['sendTestNotification']=async(_0x2a48e7,_0x31dbb4,_0xb865f8)=>{const _0x54fd22=_0x16b4cf;try{const {shopId:_0x4b90fe,type:type='payment',testData:_0x3d1bd9}=_0x2a48e7[_0x54fd22(0x151)];if(!_0x4b90fe)return _0x31dbb4[_0x54fd22(0x15b)](0x190)[_0x54fd22(0x152)]({'success':![],'message':_0x54fd22(0x166)});const _0x1f29a4=await database_1[_0x54fd22(0x145)][_0x54fd22(0x12c)]['findUnique']({'where':{'id':_0x4b90fe},'select':{'id':!![],'name':!![]}});if(!_0x1f29a4)return _0x31dbb4[_0x54fd22(0x15b)](0x194)['json']({'success':![],'message':_0x54fd22(0x153)});switch(type){case _0x54fd22(0x142):const _0x3ff8bf={'id':'test_payment_123','amount':_0x3d1bd9?.[_0x54fd22(0x16c)]||0x64,'currency':_0x3d1bd9?.[_0x54fd22(0x13b)]||_0x54fd22(0x12f),'productName':_0x3d1bd9?.[_0x54fd22(0x13f)]||_0x54fd22(0x159),'gateway':_0x3d1bd9?.['gateway']||'plisio','createdAt':new Date(),..._0x3d1bd9};await telegramBotService_1[_0x54fd22(0x12e)]['sendPaymentNotification'](_0x4b90fe,_0x3ff8bf,_0x54fd22(0x12d));break;case'payout':const _0x5189b8={'id':_0x54fd22(0x140),'amount':_0x3d1bd9?.[_0x54fd22(0x16c)]||0x1f4,'method':_0x3d1bd9?.['method']||'bank_transfer','createdAt':new Date(),..._0x3d1bd9};await telegramBotService_1[_0x54fd22(0x12e)][_0x54fd22(0x143)](_0x4b90fe,_0x5189b8,'completed');break;case'custom':await telegramBotService_1[_0x54fd22(0x12e)][_0x54fd22(0x14d)](_0x4b90fe,_0x3d1bd9?.['title']||'Test\x20Notification',_0x3d1bd9?.[_0x54fd22(0x149)]||{'message':_0x54fd22(0x14c)});break;default:return _0x31dbb4[_0x54fd22(0x15b)](0x190)['json']({'success':![],'message':_0x54fd22(0x14f)});}_0x31dbb4[_0x54fd22(0x152)]({'success':!![],'message':_0x54fd22(0x15e)+type+_0x54fd22(0x16d)});}catch(_0x12c9d1){_0xb865f8(_0x12c9d1);}};}}exports[a12_0x518b5a(0x165)]=TelegramController;