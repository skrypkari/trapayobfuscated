'use strict';function a12_0x4f0e(_0x41a630,_0x19f35f){const _0x6782c7=a12_0x6782();return a12_0x4f0e=function(_0x4f0e9d,_0x5441c6){_0x4f0e9d=_0x4f0e9d-0x156;let _0x1585c1=_0x6782c7[_0x4f0e9d];return _0x1585c1;},a12_0x4f0e(_0x41a630,_0x19f35f);}const a12_0x454089=a12_0x4f0e;(function(_0x52ba83,_0x4abca0){const _0x122915=a12_0x4f0e,_0x372ac0=_0x52ba83();while(!![]){try{const _0x5f30b1=-parseInt(_0x122915(0x173))/0x1*(-parseInt(_0x122915(0x168))/0x2)+-parseInt(_0x122915(0x18a))/0x3*(-parseInt(_0x122915(0x190))/0x4)+-parseInt(_0x122915(0x199))/0x5+-parseInt(_0x122915(0x15c))/0x6+parseInt(_0x122915(0x18f))/0x7+parseInt(_0x122915(0x18d))/0x8+parseInt(_0x122915(0x17d))/0x9*(-parseInt(_0x122915(0x186))/0xa);if(_0x5f30b1===_0x4abca0)break;else _0x372ac0['push'](_0x372ac0['shift']());}catch(_0x3ced1f){_0x372ac0['push'](_0x372ac0['shift']());}}}(a12_0x6782,0x99864));var __importDefault=this&&this[a12_0x454089(0x164)]||function(_0x9b9aaa){const _0x174aa4=a12_0x454089;return _0x9b9aaa&&_0x9b9aaa[_0x174aa4(0x196)]?_0x9b9aaa:{'default':_0x9b9aaa};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a12_0x454089(0x169)]=void 0x0;function a12_0x6782(){const _0x1ccda1=['sendShopNotification','telegramUser','getBotStatus','telegramId','createdAt','plisio','firstName','json','amount','45ZXdiLI','sendTestNotification','getTelegramUsers','bank_transfer','payout','default','shopId','findUnique','ceil','1885360IYwVVE','details','Message\x20is\x20required','groupBy','74835QQJOBD','User\x20disconnected\x20successfully','params','2927768rNiyhK','username','3607954ErOjre','120nUlOIp','Shop\x20not\x20found','query','body','sendCustomNotification','map','__esModule','Shop\x20ID\x20is\x20required','Broadcast\x20message\x20sent\x20successfully','1709240unylXZ','Markdown','updatedAt','telegramBotService','findMany','../services/telegramBotService','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','desc','shop','update','21084rNZkUw','sendPayoutNotification','\x20notification\x20sent\x20successfully','true','status','isVerified','completed','Telegram\x20user\x20not\x20found','__importDefault','getBotInfo','count','filter','114854LWnXKQ','TelegramController','payment','USD','Test\x20Product','gateway','../config/database','length','Test\x20','productName','isActive','5xWyaov'];a12_0x6782=function(){return _0x1ccda1;};return a12_0x6782();}const telegramBotService_1=require(a12_0x454089(0x157)),database_1=__importDefault(require(a12_0x454089(0x16e)));class TelegramController{constructor(){const _0x2009a1=a12_0x454089;this[_0x2009a1(0x176)]=async(_0x247bdc,_0x2d9a39,_0x1d6c25)=>{const _0x2b0f39=_0x2009a1;try{const _0x196a01=telegramBotService_1[_0x2b0f39(0x19c)][_0x2b0f39(0x165)](),_0x2602f0=await database_1[_0x2b0f39(0x182)]['telegramUser']['count'](),_0x1ffddd=await database_1[_0x2b0f39(0x182)]['telegramUser']['count']({'where':{'isVerified':!![]}}),_0x4d37ef=await database_1[_0x2b0f39(0x182)][_0x2b0f39(0x175)][_0x2b0f39(0x189)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2d9a39['json']({'success':!![],'result':{'bot':{'isActive':_0x196a01[_0x2b0f39(0x172)],'username':_0x196a01[_0x2b0f39(0x18e)]},'statistics':{'totalUsers':_0x2602f0,'verifiedUsers':_0x1ffddd,'unverifiedUsers':_0x2602f0-_0x1ffddd,'connectedShops':_0x4d37ef[_0x2b0f39(0x16f)]}}});}catch(_0x5866a9){_0x1d6c25(_0x5866a9);}},this[_0x2009a1(0x17f)]=async(_0x3d457a,_0x5803e2,_0x2a46fc)=>{const _0x4492e2=_0x2009a1;try{const {page:page=0x1,limit:limit=0x14,verified:_0x65a0f3}=_0x3d457a[_0x4492e2(0x192)],_0x2b7f02=(Number(page)-0x1)*Number(limit),_0x50f1e8={};_0x65a0f3!==undefined&&(_0x50f1e8['isVerified']=_0x65a0f3===_0x4492e2(0x15f));const [_0x40e8df,_0x574747]=await Promise['all']([database_1[_0x4492e2(0x182)][_0x4492e2(0x175)][_0x4492e2(0x156)]({'where':_0x50f1e8,'skip':_0x2b7f02,'take':Number(limit),'orderBy':{'createdAt':_0x4492e2(0x159)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4492e2(0x182)]['telegramUser'][_0x4492e2(0x166)]({'where':_0x50f1e8})]);_0x5803e2['json']({'success':!![],'users':_0x40e8df[_0x4492e2(0x195)](_0x1fecff=>({'id':_0x1fecff['id'],'telegramId':_0x1fecff[_0x4492e2(0x177)],'username':_0x1fecff[_0x4492e2(0x18e)],'firstName':_0x1fecff[_0x4492e2(0x17a)],'lastName':_0x1fecff['lastName'],'isVerified':_0x1fecff[_0x4492e2(0x161)],'shop':_0x1fecff[_0x4492e2(0x15a)],'createdAt':_0x1fecff[_0x4492e2(0x178)],'updatedAt':_0x1fecff[_0x4492e2(0x19b)]})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x574747,'totalPages':Math[_0x4492e2(0x185)](_0x574747/Number(limit))}});}catch(_0x42ab43){_0x2a46fc(_0x42ab43);}},this['sendBroadcast']=async(_0x3c0517,_0x44f534,_0xdbdcf5)=>{const _0x4a3789=_0x2009a1;try{const {message:_0x8c947,shopId:_0x45f40d}=_0x3c0517[_0x4a3789(0x193)];if(!_0x8c947)return _0x44f534[_0x4a3789(0x160)](0x190)[_0x4a3789(0x17b)]({'success':![],'message':_0x4a3789(0x188)});if(_0x45f40d)await telegramBotService_1[_0x4a3789(0x19c)][_0x4a3789(0x174)](_0x45f40d,_0x8c947,{'parse_mode':'Markdown'});else{const _0x542ed0=await database_1['default'][_0x4a3789(0x175)][_0x4a3789(0x156)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x141077=[...new Set(_0x542ed0[_0x4a3789(0x195)](_0x58edbd=>_0x58edbd[_0x4a3789(0x183)])[_0x4a3789(0x167)](Boolean))];for(const _0x239ba5 of _0x141077){_0x239ba5&&await telegramBotService_1['telegramBotService'][_0x4a3789(0x174)](_0x239ba5,_0x8c947,{'parse_mode':_0x4a3789(0x19a)});}}_0x44f534['json']({'success':!![],'message':_0x4a3789(0x198)});}catch(_0x27ab11){_0xdbdcf5(_0x27ab11);}},this['disconnectUser']=async(_0x1bb4e6,_0x31973a,_0x115629)=>{const _0xa5a937=_0x2009a1;try{const {telegramId:_0x3e3c36}=_0x1bb4e6[_0xa5a937(0x18c)],_0x343426=await database_1[_0xa5a937(0x182)][_0xa5a937(0x175)][_0xa5a937(0x184)]({'where':{'telegramId':_0x3e3c36},'include':{'shop':!![]}});if(!_0x343426)return _0x31973a[_0xa5a937(0x160)](0x194)[_0xa5a937(0x17b)]({'success':![],'message':_0xa5a937(0x163)});await database_1[_0xa5a937(0x182)]['telegramUser'][_0xa5a937(0x15b)]({'where':{'telegramId':_0x3e3c36},'data':{'shopId':null,'isVerified':![]}}),_0x31973a[_0xa5a937(0x17b)]({'success':!![],'message':_0xa5a937(0x18b)});}catch(_0x19d6c2){_0x115629(_0x19d6c2);}},this[_0x2009a1(0x17e)]=async(_0x2a9319,_0x23449a,_0x5aa1c4)=>{const _0xd0d7d8=_0x2009a1;try{const {shopId:_0x3df40e,type:type=_0xd0d7d8(0x16a),testData:_0x1924d1}=_0x2a9319[_0xd0d7d8(0x193)];if(!_0x3df40e)return _0x23449a[_0xd0d7d8(0x160)](0x190)[_0xd0d7d8(0x17b)]({'success':![],'message':_0xd0d7d8(0x197)});const _0xd61ea=await database_1[_0xd0d7d8(0x182)][_0xd0d7d8(0x15a)][_0xd0d7d8(0x184)]({'where':{'id':_0x3df40e},'select':{'id':!![],'name':!![]}});if(!_0xd61ea)return _0x23449a[_0xd0d7d8(0x160)](0x194)[_0xd0d7d8(0x17b)]({'success':![],'message':_0xd0d7d8(0x191)});switch(type){case'payment':const _0x5643ea={'id':'test_payment_123','amount':_0x1924d1?.['amount']||0x64,'currency':_0x1924d1?.['currency']||_0xd0d7d8(0x16b),'productName':_0x1924d1?.[_0xd0d7d8(0x171)]||_0xd0d7d8(0x16c),'gateway':_0x1924d1?.[_0xd0d7d8(0x16d)]||_0xd0d7d8(0x179),'createdAt':new Date(),..._0x1924d1};await telegramBotService_1[_0xd0d7d8(0x19c)]['sendPaymentNotification'](_0x3df40e,_0x5643ea,'paid');break;case _0xd0d7d8(0x181):const _0x4e14d6={'id':'test_payout_123','amount':_0x1924d1?.[_0xd0d7d8(0x17c)]||0x1f4,'method':_0x1924d1?.['method']||_0xd0d7d8(0x180),'createdAt':new Date(),..._0x1924d1};await telegramBotService_1[_0xd0d7d8(0x19c)][_0xd0d7d8(0x15d)](_0x3df40e,_0x4e14d6,_0xd0d7d8(0x162));break;case'custom':await telegramBotService_1[_0xd0d7d8(0x19c)][_0xd0d7d8(0x194)](_0x3df40e,_0x1924d1?.['title']||'Test\x20Notification',_0x1924d1?.[_0xd0d7d8(0x187)]||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x23449a['status'](0x190)['json']({'success':![],'message':_0xd0d7d8(0x158)});}_0x23449a[_0xd0d7d8(0x17b)]({'success':!![],'message':_0xd0d7d8(0x170)+type+_0xd0d7d8(0x15e)});}catch(_0x385386){_0x5aa1c4(_0x385386);}};}}exports[a12_0x454089(0x169)]=TelegramController;