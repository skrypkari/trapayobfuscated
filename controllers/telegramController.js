'use strict';const a12_0x28ce27=a12_0x203a;(function(_0xfe5edb,_0x349210){const _0x3ed0c2=a12_0x203a,_0x5982f1=_0xfe5edb();while(!![]){try{const _0x4d1148=-parseInt(_0x3ed0c2(0x1a8))/0x1*(-parseInt(_0x3ed0c2(0x1b0))/0x2)+parseInt(_0x3ed0c2(0x1c6))/0x3*(parseInt(_0x3ed0c2(0x1cd))/0x4)+-parseInt(_0x3ed0c2(0x1a2))/0x5+parseInt(_0x3ed0c2(0x1a9))/0x6*(-parseInt(_0x3ed0c2(0x1db))/0x7)+parseInt(_0x3ed0c2(0x1ab))/0x8+-parseInt(_0x3ed0c2(0x1c8))/0x9*(parseInt(_0x3ed0c2(0x1d7))/0xa)+-parseInt(_0x3ed0c2(0x1c7))/0xb;if(_0x4d1148===_0x349210)break;else _0x5982f1['push'](_0x5982f1['shift']());}catch(_0x6756b5){_0x5982f1['push'](_0x5982f1['shift']());}}}(a12_0x2bce,0x750f3));var __importDefault=this&&this[a12_0x28ce27(0x1ca)]||function(_0x5303d0){const _0x57a591=a12_0x28ce27;return _0x5303d0&&_0x5303d0[_0x57a591(0x1bf)]?_0x5303d0:{'default':_0x5303d0};};Object[a12_0x28ce27(0x1bd)](exports,a12_0x28ce27(0x1bf),{'value':!![]}),exports[a12_0x28ce27(0x1b9)]=void 0x0;function a12_0x2bce(){const _0x4c08ea=['update','2836419IhwTco','3825569qKOhZf','828lEeJdk','body','__importDefault','createdAt','test_payout_123','4akdtOu','sendBroadcast','telegramId','count','status','findUnique','Shop\x20not\x20found','shopId','sendShopNotification','Telegram\x20user\x20not\x20found','59210DFTdGG','sendTestNotification','Test\x20Product','default','63pKAgSQ','title','USD','gateway','shop','payment','Test\x20','findMany','telegramBotService','getBotStatus','\x20notification\x20sent\x20successfully','sendPayoutNotification','2143080YlIpIn','Message\x20is\x20required','groupBy','getBotInfo','sendCustomNotification','Broadcast\x20message\x20sent\x20successfully','177JtHrGb','105186CsDcxX','telegramUser','1653384KeMAxR','disconnectUser','../services/telegramBotService','Shop\x20ID\x20is\x20required','username','9110aLlzDc','method','lastName','map','params','firstName','isActive','User\x20disconnected\x20successfully','json','TelegramController','getTelegramUsers','bank_transfer','completed','defineProperty','true','__esModule','custom','isVerified','desc','productName','currency'];a12_0x2bce=function(){return _0x4c08ea;};return a12_0x2bce();}const telegramBotService_1=require(a12_0x28ce27(0x1ad)),database_1=__importDefault(require('../config/database'));function a12_0x203a(_0x12af67,_0x18a4d1){const _0x2bce3d=a12_0x2bce();return a12_0x203a=function(_0x203ab3,_0x423c25){_0x203ab3=_0x203ab3-0x1a0;let _0x3387ac=_0x2bce3d[_0x203ab3];return _0x3387ac;},a12_0x203a(_0x12af67,_0x18a4d1);}class TelegramController{constructor(){const _0x5edcbf=a12_0x28ce27;this[_0x5edcbf(0x1e4)]=async(_0x57ba55,_0x24edd1,_0x335755)=>{const _0x2dd8f7=_0x5edcbf;try{const _0x4dda3d=telegramBotService_1[_0x2dd8f7(0x1e3)][_0x2dd8f7(0x1a5)](),_0x204c21=await database_1[_0x2dd8f7(0x1da)][_0x2dd8f7(0x1aa)]['count'](),_0x401352=await database_1[_0x2dd8f7(0x1da)][_0x2dd8f7(0x1aa)][_0x2dd8f7(0x1d0)]({'where':{'isVerified':!![]}}),_0x3bca76=await database_1['default'][_0x2dd8f7(0x1aa)][_0x2dd8f7(0x1a4)]({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x24edd1[_0x2dd8f7(0x1b8)]({'success':!![],'result':{'bot':{'isActive':_0x4dda3d[_0x2dd8f7(0x1b6)],'username':_0x4dda3d[_0x2dd8f7(0x1af)]},'statistics':{'totalUsers':_0x204c21,'verifiedUsers':_0x401352,'unverifiedUsers':_0x204c21-_0x401352,'connectedShops':_0x3bca76['length']}}});}catch(_0x1621f8){_0x335755(_0x1621f8);}},this[_0x5edcbf(0x1ba)]=async(_0x5331d0,_0x55cdbf,_0x45b341)=>{const _0x2176ef=_0x5edcbf;try{const {page:page=0x1,limit:limit=0x14,verified:_0xaf4e3d}=_0x5331d0['query'],_0x474493=(Number(page)-0x1)*Number(limit),_0x1359f3={};_0xaf4e3d!==undefined&&(_0x1359f3[_0x2176ef(0x1c1)]=_0xaf4e3d===_0x2176ef(0x1be));const [_0x415b87,_0x57813f]=await Promise['all']([database_1[_0x2176ef(0x1da)][_0x2176ef(0x1aa)][_0x2176ef(0x1e2)]({'where':_0x1359f3,'skip':_0x474493,'take':Number(limit),'orderBy':{'createdAt':_0x2176ef(0x1c2)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2176ef(0x1da)]['telegramUser']['count']({'where':_0x1359f3})]);_0x55cdbf[_0x2176ef(0x1b8)]({'success':!![],'users':_0x415b87[_0x2176ef(0x1b3)](_0x4614b6=>({'id':_0x4614b6['id'],'telegramId':_0x4614b6[_0x2176ef(0x1cf)],'username':_0x4614b6['username'],'firstName':_0x4614b6[_0x2176ef(0x1b5)],'lastName':_0x4614b6[_0x2176ef(0x1b2)],'isVerified':_0x4614b6['isVerified'],'shop':_0x4614b6[_0x2176ef(0x1df)],'createdAt':_0x4614b6[_0x2176ef(0x1cb)],'updatedAt':_0x4614b6['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x57813f,'totalPages':Math['ceil'](_0x57813f/Number(limit))}});}catch(_0x4e8310){_0x45b341(_0x4e8310);}},this[_0x5edcbf(0x1ce)]=async(_0x486360,_0xa10d5e,_0x36131b)=>{const _0x44aa5a=_0x5edcbf;try{const {message:_0x1eb6d8,shopId:_0x65b527}=_0x486360[_0x44aa5a(0x1c9)];if(!_0x1eb6d8)return _0xa10d5e['status'](0x190)[_0x44aa5a(0x1b8)]({'success':![],'message':_0x44aa5a(0x1a3)});if(_0x65b527)await telegramBotService_1[_0x44aa5a(0x1e3)][_0x44aa5a(0x1d5)](_0x65b527,_0x1eb6d8,{'parse_mode':'Markdown'});else{const _0x3f096a=await database_1['default'][_0x44aa5a(0x1aa)][_0x44aa5a(0x1e2)]({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x373778=[...new Set(_0x3f096a[_0x44aa5a(0x1b3)](_0x27cd4f=>_0x27cd4f[_0x44aa5a(0x1d4)])['filter'](Boolean))];for(const _0x158e0c of _0x373778){_0x158e0c&&await telegramBotService_1[_0x44aa5a(0x1e3)][_0x44aa5a(0x1d5)](_0x158e0c,_0x1eb6d8,{'parse_mode':'Markdown'});}}_0xa10d5e[_0x44aa5a(0x1b8)]({'success':!![],'message':_0x44aa5a(0x1a7)});}catch(_0x1af565){_0x36131b(_0x1af565);}},this[_0x5edcbf(0x1ac)]=async(_0x4514de,_0x1d2aca,_0x136d3b)=>{const _0x157177=_0x5edcbf;try{const {telegramId:_0x443447}=_0x4514de[_0x157177(0x1b4)],_0x27a1c7=await database_1[_0x157177(0x1da)]['telegramUser'][_0x157177(0x1d2)]({'where':{'telegramId':_0x443447},'include':{'shop':!![]}});if(!_0x27a1c7)return _0x1d2aca[_0x157177(0x1d1)](0x194)[_0x157177(0x1b8)]({'success':![],'message':_0x157177(0x1d6)});await database_1[_0x157177(0x1da)][_0x157177(0x1aa)][_0x157177(0x1c5)]({'where':{'telegramId':_0x443447},'data':{'shopId':null,'isVerified':![]}}),_0x1d2aca[_0x157177(0x1b8)]({'success':!![],'message':_0x157177(0x1b7)});}catch(_0x4ce8ee){_0x136d3b(_0x4ce8ee);}},this[_0x5edcbf(0x1d8)]=async(_0x34a0cf,_0x2476ab,_0x4843c3)=>{const _0x5d0e48=_0x5edcbf;try{const {shopId:_0x51e382,type:type='payment',testData:_0xb41c21}=_0x34a0cf[_0x5d0e48(0x1c9)];if(!_0x51e382)return _0x2476ab['status'](0x190)[_0x5d0e48(0x1b8)]({'success':![],'message':_0x5d0e48(0x1ae)});const _0x3f153f=await database_1['default']['shop'][_0x5d0e48(0x1d2)]({'where':{'id':_0x51e382},'select':{'id':!![],'name':!![]}});if(!_0x3f153f)return _0x2476ab['status'](0x194)['json']({'success':![],'message':_0x5d0e48(0x1d3)});switch(type){case _0x5d0e48(0x1e0):const _0x38ae11={'id':'test_payment_123','amount':_0xb41c21?.['amount']||0x64,'currency':_0xb41c21?.[_0x5d0e48(0x1c4)]||_0x5d0e48(0x1dd),'productName':_0xb41c21?.[_0x5d0e48(0x1c3)]||_0x5d0e48(0x1d9),'gateway':_0xb41c21?.[_0x5d0e48(0x1de)]||'plisio','createdAt':new Date(),..._0xb41c21};await telegramBotService_1[_0x5d0e48(0x1e3)]['sendPaymentNotification'](_0x51e382,_0x38ae11,'paid');break;case'payout':const _0x5c08bc={'id':_0x5d0e48(0x1cc),'amount':_0xb41c21?.['amount']||0x1f4,'method':_0xb41c21?.[_0x5d0e48(0x1b1)]||_0x5d0e48(0x1bb),'createdAt':new Date(),..._0xb41c21};await telegramBotService_1[_0x5d0e48(0x1e3)][_0x5d0e48(0x1a1)](_0x51e382,_0x5c08bc,_0x5d0e48(0x1bc));break;case _0x5d0e48(0x1c0):await telegramBotService_1['telegramBotService'][_0x5d0e48(0x1a6)](_0x51e382,_0xb41c21?.[_0x5d0e48(0x1dc)]||'Test\x20Notification',_0xb41c21?.['details']||{'message':'This\x20is\x20a\x20test\x20notification'});break;default:return _0x2476ab[_0x5d0e48(0x1d1)](0x190)['json']({'success':![],'message':'Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom'});}_0x2476ab['json']({'success':!![],'message':_0x5d0e48(0x1e1)+type+_0x5d0e48(0x1a0)});}catch(_0x44929d){_0x4843c3(_0x44929d);}};}}exports[a12_0x28ce27(0x1b9)]=TelegramController;