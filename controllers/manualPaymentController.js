'use strict';const a9_0x16d58a=a9_0x3ca9;function a9_0x3ca9(_0x3a7931,_0x1aa0dc){_0x3a7931=_0x3a7931-0x12d;const _0x53965e=a9_0x5396();let _0x3ca9ee=_0x53965e[_0x3a7931];return _0x3ca9ee;}(function(_0x542f83,_0x32b1c7){const _0x302846=a9_0x3ca9,_0x2d0782=_0x542f83();while(!![]){try{const _0x2f1588=-parseInt(_0x302846(0x152))/0x1+parseInt(_0x302846(0x16c))/0x2*(-parseInt(_0x302846(0x150))/0x3)+-parseInt(_0x302846(0x15c))/0x4+-parseInt(_0x302846(0x174))/0x5+-parseInt(_0x302846(0x136))/0x6+-parseInt(_0x302846(0x196))/0x7*(-parseInt(_0x302846(0x147))/0x8)+-parseInt(_0x302846(0x163))/0x9*(-parseInt(_0x302846(0x16e))/0xa);if(_0x2f1588===_0x32b1c7)break;else _0x2d0782['push'](_0x2d0782['shift']());}catch(_0x33dc85){_0x2d0782['push'](_0x2d0782['shift']());}}}(a9_0x5396,0x97bb6));var __importDefault=this&&this[a9_0x16d58a(0x13e)]||function(_0x3c8bd7){const _0x862548=a9_0x16d58a;return _0x3c8bd7&&_0x3c8bd7[_0x862548(0x162)]?_0x3c8bd7:{'default':_0x3c8bd7};};Object[a9_0x16d58a(0x14d)](exports,a9_0x16d58a(0x162),{'value':!![]}),exports[a9_0x16d58a(0x155)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a9_0x16d58a(0x135))),telegramBotService_1=require(a9_0x16d58a(0x18e));function a9_0x5396(){const _0x3195bc=['__esModule','24835617dYwqqL','KB)\x0a','CAD','7867339505','\x20\x20\x20-\x20Payment\x20ID:\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent','png','toUpperCase','telegramBotService','2XnQKpc','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','10gsEUMc','update','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','üí∞\x20Amount:\x20','length','default','4332755LUIFQi','‚ùå\x20Upload\x20payment\x20proof\x20error:','SEPA\x20Bank\x20Transfer','üè™\x20Shop:\x20','replace','sepa','sendDirectFile','sendShopFile','heic','shop','Payment\x20not\x20found','üåê\x20Client\x20IP:\x20','unknown','JPEG','username','currency','interac','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','from','File\x20data\x20is\x20required','log','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','sendShopNotification','connection','createdAt','../services/telegramBotService','\x20Payment\x20Proof\x20Received\x0a\x0a','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','pdf','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','.\x20Supported:\x20','name','üí≥\x20Payment\x20ID:\x20','39011IamKxI','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','includes','Internal\x20server\x20error','\x20\x20\x20-\x20File\x20size:\x20','\x20\x20\x20-\x20File\x20type:\x20','amount','üìÅ\x20File\x20type:\x20','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','Payment\x20proof\x20uploaded\x20successfully','error','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','../config/database','4620288FZDPNZ','JPG','sendDirectMessage','Invalid\x20base64\x20file\x20data','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','Payment\x20ID\x20is\x20required','uploadPaymentProof','Unknown\x20error','__importDefault','‚ùå\x20Payment\x20not\x20found:\x20','body','10MB','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','üåê\x20Customer\x20IP:\x20','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','base64','toLowerCase','1528ByWWkK','shopId','updatedAt','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','gateway','params','defineProperty','\x20\x20\x20-\x20Gateway:\x20','status','2174157XUWhES','json','393432bKAGjZ','üîÑ\x20','findUnique','manualPaymentController','ManualPaymentController','join','Markdown','payment','round','getManualPaymentInfo','1790848QYJKGW','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','üìÅ\x20File:\x20','message','EUR','remoteAddress'];a9_0x5396=function(){return _0x3195bc;};return a9_0x5396();}class ManualPaymentController{async[a9_0x16d58a(0x13c)](_0x72085c,_0x512906){const _0x546a13=a9_0x16d58a;try{const {paymentId:_0x2d23ba,fileData:_0x5586d0,fileType:_0x4facc8,fileName:_0x1d226e}=_0x72085c[_0x546a13(0x140)],_0x462890=_0x72085c['ip']||_0x72085c[_0x546a13(0x18c)]?.[_0x546a13(0x161)]||_0x546a13(0x180);console[_0x546a13(0x188)](_0x546a13(0x170)+_0x2d23ba),console[_0x546a13(0x188)](_0x546a13(0x12f)+_0x4facc8+',\x20size:\x20'+(_0x5586d0?Math[_0x546a13(0x15a)](_0x5586d0[_0x546a13(0x172)]*0.75/0x400):0x0)+'KB'),console[_0x546a13(0x188)](_0x546a13(0x17f)+_0x462890);if(!_0x2d23ba){_0x512906[_0x546a13(0x14f)](0x190)[_0x546a13(0x151)]({'success':![],'error':_0x546a13(0x13b)});return;}if(!_0x5586d0){_0x512906[_0x546a13(0x14f)](0x190)['json']({'success':![],'error':_0x546a13(0x187)});return;}if(!_0x4facc8){_0x512906[_0x546a13(0x14f)](0x190)['json']({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x374ad5=[_0x546a13(0x169),'jpg','jpeg',_0x546a13(0x17c),_0x546a13(0x191)],_0x4d3161=_0x4facc8[_0x546a13(0x146)]()[_0x546a13(0x178)]('.','');if(!_0x374ad5[_0x546a13(0x198)](_0x4d3161)){_0x512906[_0x546a13(0x14f)](0x190)['json']({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x4facc8+_0x546a13(0x193)+_0x374ad5[_0x546a13(0x157)](',\x20')});return;}const _0x4c09f7=0xa*0x400*0x400;if(_0x5586d0[_0x546a13(0x172)]>_0x4c09f7){_0x512906[_0x546a13(0x14f)](0x190)[_0x546a13(0x151)]({'success':![],'error':_0x546a13(0x15d)});return;}const _0x426b6b=await database_1[_0x546a13(0x173)][_0x546a13(0x159)][_0x546a13(0x154)]({'where':{'id':_0x2d23ba},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x426b6b){console['log'](_0x546a13(0x13f)+_0x2d23ba),_0x512906[_0x546a13(0x14f)](0x194)[_0x546a13(0x151)]({'success':![],'error':_0x546a13(0x17e)});return;}if(_0x426b6b[_0x546a13(0x14b)]!==_0x546a13(0x184)&&_0x426b6b[_0x546a13(0x14b)]!==_0x546a13(0x179)){console[_0x546a13(0x188)](_0x546a13(0x197)+_0x426b6b[_0x546a13(0x14b)]),_0x512906['status'](0x190)[_0x546a13(0x151)]({'success':![],'error':_0x546a13(0x190)+_0x426b6b['gateway']});return;}let _0x2352af=_0x5586d0;_0x5586d0[_0x546a13(0x198)](',')&&(_0x2352af=_0x5586d0['split'](',')[0x1]);try{Buffer[_0x546a13(0x186)](_0x2352af,_0x546a13(0x145));}catch(_0x48ec7b){_0x512906[_0x546a13(0x14f)](0x190)[_0x546a13(0x151)]({'success':![],'error':_0x546a13(0x139)});return;}const _0x1fa017=await database_1[_0x546a13(0x173)]['payment'][_0x546a13(0x16f)]({'where':{'id':_0x2d23ba},'data':{'status':'PROCESSING','updatedAt':new Date()}});console['log'](_0x546a13(0x189)),console[_0x546a13(0x188)](_0x546a13(0x167)+_0x2d23ba),console['log'](_0x546a13(0x14e)+_0x426b6b[_0x546a13(0x14b)]['toUpperCase']()),console[_0x546a13(0x188)](_0x546a13(0x12d)+_0x4d3161),console[_0x546a13(0x188)](_0x546a13(0x19a)+Math[_0x546a13(0x15a)](_0x2352af[_0x546a13(0x172)]*0.75/0x400)+'KB'),console[_0x546a13(0x188)](_0x546a13(0x16d));try{const _0x21dd61=_0x426b6b[_0x546a13(0x14b)]['toUpperCase'](),_0x199873=_0x426b6b['shop']['name']||_0x426b6b['shop'][_0x546a13(0x182)],_0x53feb4=Math['round'](_0x2352af[_0x546a13(0x172)]*0.75/0x400),_0x661f09=_0x546a13(0x153)+_0x21dd61+_0x546a13(0x18f)+(_0x546a13(0x195)+_0x2d23ba+'\x0a')+(_0x546a13(0x171)+_0x426b6b['amount']+'\x20'+_0x426b6b[_0x546a13(0x183)]+'\x0a')+(_0x546a13(0x15e)+_0x4d3161['toUpperCase']()+'\x20('+_0x53feb4+_0x546a13(0x164))+_0x546a13(0x134)+(_0x546a13(0x143)+_0x462890+'\x0a\x0a')+_0x546a13(0x14a);await telegramBotService_1[_0x546a13(0x16b)][_0x546a13(0x18b)](_0x426b6b[_0x546a13(0x148)],_0x661f09,{'parse_mode':_0x546a13(0x158)});const _0x5f2ec8=Buffer[_0x546a13(0x186)](_0x2352af,'base64'),_0x181dbb='payment_proof_'+_0x2d23ba+'.'+_0x4d3161;await telegramBotService_1[_0x546a13(0x16b)][_0x546a13(0x17b)](_0x426b6b[_0x546a13(0x148)],_0x5f2ec8,_0x181dbb,'Payment\x20proof\x20for\x20'+_0x2d23ba),console[_0x546a13(0x188)](_0x546a13(0x192));const _0x41c67e=_0x546a13(0x166),_0x2b6586='üîÑ\x20'+_0x21dd61+_0x546a13(0x13a)+(_0x546a13(0x195)+_0x2d23ba+'\x0a')+(_0x546a13(0x177)+_0x199873+'\x0a')+('üí∞\x20Amount:\x20'+_0x426b6b[_0x546a13(0x12e)]+'\x20'+_0x426b6b[_0x546a13(0x183)]+'\x0a')+('üìÅ\x20File:\x20'+_0x4d3161[_0x546a13(0x16a)]()+'\x20('+_0x53feb4+_0x546a13(0x164))+_0x546a13(0x134)+(_0x546a13(0x143)+_0x462890+'\x0a\x0a')+_0x546a13(0x131);await telegramBotService_1[_0x546a13(0x16b)][_0x546a13(0x138)](parseInt(_0x41c67e),_0x2b6586),await telegramBotService_1['telegramBotService'][_0x546a13(0x17a)](parseInt(_0x41c67e),_0x5f2ec8,_0x181dbb,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x2d23ba),console['log'](_0x546a13(0x168));}catch(_0x23fa33){console[_0x546a13(0x133)](_0x546a13(0x18a),_0x23fa33);}_0x512906['json']({'success':!![],'message':_0x546a13(0x132),'data':{'paymentId':_0x1fa017['id'],'status':_0x1fa017['status'],'gateway':_0x426b6b[_0x546a13(0x14b)],'fileType':_0x4d3161,'fileSize':Math[_0x546a13(0x15a)](_0x2352af[_0x546a13(0x172)]*0.75/0x400)+'KB','uploadedAt':_0x1fa017[_0x546a13(0x149)]}});}catch(_0x4644a9){console[_0x546a13(0x133)](_0x546a13(0x175),_0x4644a9),_0x512906[_0x546a13(0x14f)](0x1f4)[_0x546a13(0x151)]({'success':![],'error':_0x546a13(0x199),'details':_0x4644a9 instanceof Error?_0x4644a9[_0x546a13(0x15f)]:_0x546a13(0x13d)});}}async[a9_0x16d58a(0x15b)](_0x2af77d,_0x199dca){const _0x2f9dbe=a9_0x16d58a;try{const {paymentId:_0x1f23a5}=_0x2af77d[_0x2f9dbe(0x14c)];console[_0x2f9dbe(0x188)]('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x1f23a5);const _0x2afd9e=await database_1['default']['payment'][_0x2f9dbe(0x154)]({'where':{'id':_0x1f23a5},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2afd9e){_0x199dca[_0x2f9dbe(0x14f)](0x194)[_0x2f9dbe(0x151)]({'success':![],'error':_0x2f9dbe(0x17e)});return;}if(_0x2afd9e['gateway']!==_0x2f9dbe(0x184)&&_0x2afd9e['gateway']!==_0x2f9dbe(0x179)){_0x199dca['status'](0x190)['json']({'success':![],'error':_0x2f9dbe(0x185)+_0x2afd9e[_0x2f9dbe(0x14b)]});return;}let _0x1a5139='',_0x375384=_0x2afd9e[_0x2f9dbe(0x183)],_0x535017='';if(_0x2afd9e[_0x2f9dbe(0x14b)]===_0x2f9dbe(0x184))_0x535017='Interac\x20e-Transfer',_0x375384=_0x2f9dbe(0x165),_0x1a5139=_0x2f9dbe(0x142)+_0x2afd9e[_0x2f9dbe(0x12e)]+'\x20'+_0x375384+_0x2f9dbe(0x130);else _0x2afd9e[_0x2f9dbe(0x14b)]==='sepa'&&(_0x535017=_0x2f9dbe(0x176),_0x375384=_0x2f9dbe(0x160),_0x1a5139='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x2afd9e['amount']+'\x20'+_0x375384+_0x2f9dbe(0x130));const _0x136cc2={'success':!![],'data':{'paymentId':_0x2afd9e['id'],'gateway':_0x2afd9e['gateway'],'gatewayName':_0x2afd9e[_0x2f9dbe(0x14b)]['toUpperCase'](),'transferType':_0x535017,'amount':_0x2afd9e[_0x2f9dbe(0x12e)],'currency':_0x375384,'status':_0x2afd9e[_0x2f9dbe(0x14f)],'instructions':_0x1a5139,'shopName':_0x2afd9e['shop'][_0x2f9dbe(0x194)]||_0x2afd9e[_0x2f9dbe(0x17d)]['username'],'hasProof':![],'proofType':null,'createdAt':_0x2afd9e[_0x2f9dbe(0x18d)],'updatedAt':_0x2afd9e[_0x2f9dbe(0x149)],'supportedFileTypes':['PNG',_0x2f9dbe(0x137),_0x2f9dbe(0x181),'HEIC','PDF'],'maxFileSize':_0x2f9dbe(0x141)}};_0x199dca[_0x2f9dbe(0x151)](_0x136cc2);}catch(_0x48309a){console['error'](_0x2f9dbe(0x144),_0x48309a),_0x199dca[_0x2f9dbe(0x14f)](0x1f4)[_0x2f9dbe(0x151)]({'success':![],'error':'Internal\x20server\x20error','details':_0x48309a instanceof Error?_0x48309a['message']:_0x2f9dbe(0x13d)});}}}exports[a9_0x16d58a(0x156)]=ManualPaymentController,exports[a9_0x16d58a(0x155)]=new ManualPaymentController();