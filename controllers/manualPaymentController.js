'use strict';const a8_0x4ebb3a=a8_0x479d;(function(_0x26e034,_0x3a7ff8){const _0xd0175f=a8_0x479d,_0xc62d22=_0x26e034();while(!![]){try{const _0x4874f3=parseInt(_0xd0175f(0x15b))/0x1*(parseInt(_0xd0175f(0x175))/0x2)+-parseInt(_0xd0175f(0x188))/0x3+parseInt(_0xd0175f(0x155))/0x4+-parseInt(_0xd0175f(0x183))/0x5+parseInt(_0xd0175f(0x16d))/0x6*(-parseInt(_0xd0175f(0x153))/0x7)+parseInt(_0xd0175f(0x197))/0x8*(parseInt(_0xd0175f(0x192))/0x9)+parseInt(_0xd0175f(0x157))/0xa;if(_0x4874f3===_0x3a7ff8)break;else _0xc62d22['push'](_0xc62d22['shift']());}catch(_0x2f702c){_0xc62d22['push'](_0xc62d22['shift']());}}}(a8_0x1966,0x5c46d));var __importDefault=this&&this[a8_0x4ebb3a(0x199)]||function(_0x1b0bf1){const _0x5a3022=a8_0x4ebb3a;return _0x1b0bf1&&_0x1b0bf1[_0x5a3022(0x16a)]?_0x1b0bf1:{'default':_0x1b0bf1};};Object[a8_0x4ebb3a(0x182)](exports,'__esModule',{'value':!![]}),exports['manualPaymentController']=exports['ManualPaymentController']=void 0x0;function a8_0x1966(){const _0x5d6b65=['\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','error','includes','toUpperCase','üí≥\x20Payment\x20ID:\x20','Invalid\x20base64\x20file\x20data','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','message','üìã\x20Get\x20manual\x20payment\x20info:\x20','from','defineProperty','779815hZxMqn','unknown','‚ùå\x20Upload\x20payment\x20proof\x20error:','length','pdf','1225101SNJBnO','üîÑ\x20','toLowerCase','interac','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','üìÅ\x20File:\x20','sendShopNotification','\x20Payment\x20Proof\x20Received\x0a\x0a','üåê\x20Customer\x20IP:\x20','findUnique','2907aLyBRF','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','shop','updatedAt','split','7664fgChir','Unknown\x20error','__importDefault','shopId','telegramBotService','replace','uploadPaymentProof','sendShopFile','KB)\x0a','png','round','amount','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','7867339505','üí∞\x20Amount:\x20','sendDirectFile','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','.\x20Supported:\x20','üåê\x20Client\x20IP:\x20','sendDirectMessage','log','PNG','currency','EUR','base64','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','Payment\x20not\x20found','PDF','Payment\x20proof\x20for\x20','default','7ntQuno','\x20\x20\x20-\x20Gateway:\x20','456684sORJxs','payment','4447870pWEOEF','manualPaymentController','status','update','17ApbpFt','Payment\x20proof\x20uploaded\x20successfully','connection','join','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','Interac\x20e-Transfer','‚ùå\x20Payment\x20not\x20found:\x20','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','username','params','10MB','gateway','json','name','\x20\x20\x20-\x20File\x20size:\x20','__esModule','üè™\x20Shop:\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent','2447058tEBTgE','File\x20data\x20is\x20required','PROCESSING','File\x20type\x20is\x20required','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','ManualPaymentController','Unsupported\x20file\x20type:\x20','56676WjxwCt','sepa'];a8_0x1966=function(){return _0x5d6b65;};return a8_0x1966();}const database_1=__importDefault(require('../config/database')),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async[a8_0x4ebb3a(0x19d)](_0x138570,_0x53ad43){const _0x5172c8=a8_0x4ebb3a;try{const {paymentId:_0x234bfa,fileData:_0x5b268d,fileType:_0x447a52,fileName:_0x433af6}=_0x138570['body'],_0x47f07e=_0x138570['ip']||_0x138570[_0x5172c8(0x15d)]?.['remoteAddress']||_0x5172c8(0x184);console['log']('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x234bfa),console[_0x5172c8(0x1ab)]('üìÅ\x20File\x20type:\x20'+_0x447a52+',\x20size:\x20'+(_0x5b268d?Math[_0x5172c8(0x1a1)](_0x5b268d['length']*0.75/0x400):0x0)+'KB'),console[_0x5172c8(0x1ab)](_0x5172c8(0x1a9)+_0x47f07e);if(!_0x234bfa){_0x53ad43[_0x5172c8(0x159)](0x190)[_0x5172c8(0x167)]({'success':![],'error':'Payment\x20ID\x20is\x20required'});return;}if(!_0x5b268d){_0x53ad43[_0x5172c8(0x159)](0x190)[_0x5172c8(0x167)]({'success':![],'error':_0x5172c8(0x16e)});return;}if(!_0x447a52){_0x53ad43['status'](0x190)['json']({'success':![],'error':_0x5172c8(0x170)});return;}const _0x28a6b0=[_0x5172c8(0x1a0),'jpg','jpeg','heic',_0x5172c8(0x187)],_0x17f835=_0x447a52[_0x5172c8(0x18a)]()[_0x5172c8(0x19c)]('.','');if(!_0x28a6b0[_0x5172c8(0x179)](_0x17f835)){_0x53ad43[_0x5172c8(0x159)](0x190)[_0x5172c8(0x167)]({'success':![],'error':_0x5172c8(0x174)+_0x447a52+_0x5172c8(0x1a8)+_0x28a6b0[_0x5172c8(0x15e)](',\x20')});return;}const _0x121761=0xa*0x400*0x400;if(_0x5b268d[_0x5172c8(0x186)]>_0x121761){_0x53ad43['status'](0x190)[_0x5172c8(0x167)]({'success':![],'error':_0x5172c8(0x18c)});return;}const _0x2f09a4=await database_1[_0x5172c8(0x152)][_0x5172c8(0x156)][_0x5172c8(0x191)]({'where':{'id':_0x234bfa},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2f09a4){console[_0x5172c8(0x1ab)](_0x5172c8(0x161)+_0x234bfa),_0x53ad43[_0x5172c8(0x159)](0x194)['json']({'success':![],'error':_0x5172c8(0x14f)});return;}if(_0x2f09a4[_0x5172c8(0x166)]!==_0x5172c8(0x18b)&&_0x2f09a4[_0x5172c8(0x166)]!==_0x5172c8(0x176)){console['log'](_0x5172c8(0x193)+_0x2f09a4['gateway']),_0x53ad43[_0x5172c8(0x159)](0x190)[_0x5172c8(0x167)]({'success':![],'error':_0x5172c8(0x1a7)+_0x2f09a4['gateway']});return;}let _0x298ac5=_0x5b268d;_0x5b268d[_0x5172c8(0x179)](',')&&(_0x298ac5=_0x5b268d[_0x5172c8(0x196)](',')[0x1]);try{Buffer[_0x5172c8(0x181)](_0x298ac5,'base64');}catch(_0x1a9c09){_0x53ad43[_0x5172c8(0x159)](0x190)[_0x5172c8(0x167)]({'success':![],'error':_0x5172c8(0x17c)});return;}const _0x4d3b81=await database_1[_0x5172c8(0x152)][_0x5172c8(0x156)][_0x5172c8(0x15a)]({'where':{'id':_0x234bfa},'data':{'status':_0x5172c8(0x16f),'updatedAt':new Date()}});console[_0x5172c8(0x1ab)](_0x5172c8(0x17e)),console[_0x5172c8(0x1ab)]('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x234bfa),console[_0x5172c8(0x1ab)](_0x5172c8(0x154)+_0x2f09a4[_0x5172c8(0x166)][_0x5172c8(0x17a)]()),console[_0x5172c8(0x1ab)]('\x20\x20\x20-\x20File\x20type:\x20'+_0x17f835),console[_0x5172c8(0x1ab)](_0x5172c8(0x169)+Math[_0x5172c8(0x1a1)](_0x298ac5[_0x5172c8(0x186)]*0.75/0x400)+'KB'),console['log']('\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING');try{const _0x3d0bdc=_0x2f09a4[_0x5172c8(0x166)]['toUpperCase'](),_0x457fca=_0x2f09a4[_0x5172c8(0x194)][_0x5172c8(0x168)]||_0x2f09a4['shop'][_0x5172c8(0x163)],_0x3d84fb=Math['round'](_0x298ac5[_0x5172c8(0x186)]*0.75/0x400),_0x4dffd0=_0x5172c8(0x189)+_0x3d0bdc+_0x5172c8(0x18f)+('üí≥\x20Payment\x20ID:\x20'+_0x234bfa+'\x0a')+(_0x5172c8(0x1a5)+_0x2f09a4[_0x5172c8(0x1a2)]+'\x20'+_0x2f09a4[_0x5172c8(0x1ad)]+'\x0a')+(_0x5172c8(0x18d)+_0x17f835['toUpperCase']()+'\x20('+_0x3d84fb+_0x5172c8(0x19f))+_0x5172c8(0x1a3)+(_0x5172c8(0x190)+_0x47f07e+'\x0a\x0a')+'‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1[_0x5172c8(0x19b)][_0x5172c8(0x18e)](_0x2f09a4[_0x5172c8(0x19a)],_0x4dffd0,{'parse_mode':'Markdown'});const _0xf0345f=Buffer['from'](_0x298ac5,_0x5172c8(0x14d)),_0x30181f='payment_proof_'+_0x234bfa+'.'+_0x17f835;await telegramBotService_1[_0x5172c8(0x19b)][_0x5172c8(0x19e)](_0x2f09a4['shopId'],_0xf0345f,_0x30181f,_0x5172c8(0x151)+_0x234bfa),console['log']('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x55b6a9=_0x5172c8(0x1a4),_0x1f6a54=_0x5172c8(0x189)+_0x3d0bdc+_0x5172c8(0x177)+(_0x5172c8(0x17b)+_0x234bfa+'\x0a')+(_0x5172c8(0x16b)+_0x457fca+'\x0a')+('üí∞\x20Amount:\x20'+_0x2f09a4['amount']+'\x20'+_0x2f09a4[_0x5172c8(0x1ad)]+'\x0a')+(_0x5172c8(0x18d)+_0x17f835[_0x5172c8(0x17a)]()+'\x20('+_0x3d84fb+_0x5172c8(0x19f))+_0x5172c8(0x1a3)+('üåê\x20Customer\x20IP:\x20'+_0x47f07e+'\x0a\x0a')+_0x5172c8(0x172);await telegramBotService_1[_0x5172c8(0x19b)][_0x5172c8(0x1aa)](parseInt(_0x55b6a9),_0x1f6a54),await telegramBotService_1['telegramBotService'][_0x5172c8(0x1a6)](parseInt(_0x55b6a9),_0xf0345f,_0x30181f,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x234bfa),console['log'](_0x5172c8(0x16c));}catch(_0x415766){console[_0x5172c8(0x178)](_0x5172c8(0x162),_0x415766);}_0x53ad43[_0x5172c8(0x167)]({'success':!![],'message':_0x5172c8(0x15c),'data':{'paymentId':_0x4d3b81['id'],'status':_0x4d3b81[_0x5172c8(0x159)],'gateway':_0x2f09a4['gateway'],'fileType':_0x17f835,'fileSize':Math['round'](_0x298ac5[_0x5172c8(0x186)]*0.75/0x400)+'KB','uploadedAt':_0x4d3b81[_0x5172c8(0x195)]}});}catch(_0x295512){console['error'](_0x5172c8(0x185),_0x295512),_0x53ad43[_0x5172c8(0x159)](0x1f4)[_0x5172c8(0x167)]({'success':![],'error':'Internal\x20server\x20error','details':_0x295512 instanceof Error?_0x295512[_0x5172c8(0x17f)]:'Unknown\x20error'});}}async['getManualPaymentInfo'](_0x9d45ef,_0x1d627f){const _0x259327=a8_0x4ebb3a;try{const {paymentId:_0x40d74e}=_0x9d45ef[_0x259327(0x164)];console[_0x259327(0x1ab)](_0x259327(0x180)+_0x40d74e);const _0x418010=await database_1[_0x259327(0x152)][_0x259327(0x156)][_0x259327(0x191)]({'where':{'id':_0x40d74e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x418010){_0x1d627f[_0x259327(0x159)](0x194)[_0x259327(0x167)]({'success':![],'error':_0x259327(0x14f)});return;}if(_0x418010[_0x259327(0x166)]!=='interac'&&_0x418010[_0x259327(0x166)]!==_0x259327(0x176)){_0x1d627f[_0x259327(0x159)](0x190)['json']({'success':![],'error':_0x259327(0x14e)+_0x418010[_0x259327(0x166)]});return;}let _0x2940e4='',_0x49def5=_0x418010[_0x259327(0x1ad)],_0x146bf5='';if(_0x418010['gateway']===_0x259327(0x18b))_0x146bf5=_0x259327(0x160),_0x49def5='CAD',_0x2940e4=_0x259327(0x171)+_0x418010[_0x259327(0x1a2)]+'\x20'+_0x49def5+_0x259327(0x15f);else _0x418010[_0x259327(0x166)]===_0x259327(0x176)&&(_0x146bf5='SEPA\x20Bank\x20Transfer',_0x49def5=_0x259327(0x14c),_0x2940e4='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x418010[_0x259327(0x1a2)]+'\x20'+_0x49def5+_0x259327(0x15f));const _0x41e5c7={'success':!![],'data':{'paymentId':_0x418010['id'],'gateway':_0x418010[_0x259327(0x166)],'gatewayName':_0x418010[_0x259327(0x166)]['toUpperCase'](),'transferType':_0x146bf5,'amount':_0x418010['amount'],'currency':_0x49def5,'status':_0x418010[_0x259327(0x159)],'instructions':_0x2940e4,'shopName':_0x418010[_0x259327(0x194)][_0x259327(0x168)]||_0x418010[_0x259327(0x194)][_0x259327(0x163)],'hasProof':![],'proofType':null,'createdAt':_0x418010['createdAt'],'updatedAt':_0x418010[_0x259327(0x195)],'supportedFileTypes':[_0x259327(0x1ac),'JPG','JPEG','HEIC',_0x259327(0x150)],'maxFileSize':_0x259327(0x165)}};_0x1d627f[_0x259327(0x167)](_0x41e5c7);}catch(_0xadaaaa){console[_0x259327(0x178)](_0x259327(0x17d),_0xadaaaa),_0x1d627f[_0x259327(0x159)](0x1f4)['json']({'success':![],'error':'Internal\x20server\x20error','details':_0xadaaaa instanceof Error?_0xadaaaa[_0x259327(0x17f)]:_0x259327(0x198)});}}}function a8_0x479d(_0x29e904,_0xbd41f7){const _0x196658=a8_0x1966();return a8_0x479d=function(_0x479dd5,_0x5f41bf){_0x479dd5=_0x479dd5-0x14c;let _0xe7ebf0=_0x196658[_0x479dd5];return _0xe7ebf0;},a8_0x479d(_0x29e904,_0xbd41f7);}exports[a8_0x4ebb3a(0x173)]=ManualPaymentController,exports[a8_0x4ebb3a(0x158)]=new ManualPaymentController();