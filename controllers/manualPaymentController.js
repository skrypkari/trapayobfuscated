'use strict';const a11_0x3f9034=a11_0x4017;(function(_0x22368f,_0x157d4a){const _0x366ad4=a11_0x4017,_0x1f4913=_0x22368f();while(!![]){try{const _0x80bc41=-parseInt(_0x366ad4(0x1c5))/0x1*(-parseInt(_0x366ad4(0x19e))/0x2)+-parseInt(_0x366ad4(0x1ce))/0x3*(parseInt(_0x366ad4(0x1bd))/0x4)+parseInt(_0x366ad4(0x196))/0x5*(-parseInt(_0x366ad4(0x172))/0x6)+parseInt(_0x366ad4(0x1be))/0x7+-parseInt(_0x366ad4(0x193))/0x8+parseInt(_0x366ad4(0x1b6))/0x9+parseInt(_0x366ad4(0x174))/0xa*(-parseInt(_0x366ad4(0x18e))/0xb);if(_0x80bc41===_0x157d4a)break;else _0x1f4913['push'](_0x1f4913['shift']());}catch(_0x2ba76b){_0x1f4913['push'](_0x1f4913['shift']());}}}(a11_0x13fa,0xa2dc7));var __importDefault=this&&this[a11_0x3f9034(0x195)]||function(_0x56d803){const _0x35ed31=a11_0x3f9034;return _0x56d803&&_0x56d803[_0x35ed31(0x1c0)]?_0x56d803:{'default':_0x56d803};};Object[a11_0x3f9034(0x18f)](exports,a11_0x3f9034(0x1c0),{'value':!![]}),exports[a11_0x3f9034(0x199)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a11_0x3f9034(0x192))),telegramBotService_1=require('../services/telegramBotService');function a11_0x4017(_0x384589,_0x342d7b){_0x384589=_0x384589-0x166;const _0x13fafc=a11_0x13fa();let _0x4017a1=_0x13fafc[_0x384589];return _0x4017a1;}function a11_0x13fa(){const _0x391294=['JPG','1604yeaUbp','3280935dQWwEF','üìã\x20Get\x20manual\x20payment\x20info:\x20','__esModule','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','Unsupported\x20file\x20type:\x20','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','updatedAt','11whcVmT','üìÅ\x20File\x20type:\x20','json','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','includes','name','File\x20type\x20is\x20required','PROCESSING','\x20\x20\x20-\x20File\x20size:\x20','3039YzAdqW','username','join','Payment\x20proof\x20for\x20','sepa','‚ùå\x20Payment\x20not\x20found:\x20','sendShopNotification','createdAt','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','shopId','message','Interac\x20e-Transfer','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','JPEG','42HytnQH','params','6220DKyMnh','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','CAD','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','üåê\x20Customer\x20IP:\x20','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','round','.\x20Supported:\x20','default','from','error','update',',\x20size:\x20','\x20\x20\x20-\x20File\x20type:\x20','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','EUR','üìÅ\x20File:\x20','uploadPaymentProof','Internal\x20server\x20error','currency','üí∞\x20Amount:\x20','status','payment','jpg','7867339505','7491iDoqdx','defineProperty','length','Invalid\x20base64\x20file\x20data','../config/database','2865280IrgoKz','File\x20data\x20is\x20required','__importDefault','56020FdSqjN','sendDirectFile','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','manualPaymentController','toUpperCase','Markdown','split','heic','32962xfzFaj','PNG','telegramBotService','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','HEIC','replace','gateway','remoteAddress','amount','Payment\x20ID\x20is\x20required','sendDirectMessage','getManualPaymentInfo','Payment\x20proof\x20uploaded\x20successfully','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','SEPA\x20Bank\x20Transfer','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','interac','\x20\x20\x20-\x20Gateway:\x20','findUnique','Unknown\x20error','log','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','üí≥\x20Payment\x20ID:\x20','KB)\x0a','11551194NzfemJ','üåê\x20Client\x20IP:\x20','shop','sendShopFile','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent'];a11_0x13fa=function(){return _0x391294;};return a11_0x13fa();}class ManualPaymentController{async[a11_0x3f9034(0x186)](_0x3fd667,_0x1fde10){const _0x4d354e=a11_0x3f9034;try{const {paymentId:_0x42f07d,fileData:_0x4d659c,fileType:_0xab1207,fileName:_0x405313}=_0x3fd667['body'],_0x636e5d=_0x3fd667['ip']||_0x3fd667['connection']?.[_0x4d354e(0x1a5)]||'unknown';console[_0x4d354e(0x1b2)](_0x4d354e(0x182)+_0x42f07d),console['log'](_0x4d354e(0x1c6)+_0xab1207+_0x4d354e(0x180)+(_0x4d659c?Math[_0x4d354e(0x17a)](_0x4d659c[_0x4d354e(0x190)]*0.75/0x400):0x0)+'KB'),console['log'](_0x4d354e(0x1b7)+_0x636e5d);if(!_0x42f07d){_0x1fde10[_0x4d354e(0x18a)](0x190)[_0x4d354e(0x1c7)]({'success':![],'error':_0x4d354e(0x1a7)});return;}if(!_0x4d659c){_0x1fde10[_0x4d354e(0x18a)](0x190)[_0x4d354e(0x1c7)]({'success':![],'error':_0x4d354e(0x194)});return;}if(!_0xab1207){_0x1fde10['status'](0x190)[_0x4d354e(0x1c7)]({'success':![],'error':_0x4d354e(0x1cb)});return;}const _0x6ce4c8=['png',_0x4d354e(0x18c),'jpeg',_0x4d354e(0x19d),'pdf'],_0x4d1353=_0xab1207['toLowerCase']()[_0x4d354e(0x1a3)]('.','');if(!_0x6ce4c8[_0x4d354e(0x1c9)](_0x4d1353)){_0x1fde10[_0x4d354e(0x18a)](0x190)[_0x4d354e(0x1c7)]({'success':![],'error':_0x4d354e(0x1c2)+_0xab1207+_0x4d354e(0x17b)+_0x6ce4c8[_0x4d354e(0x166)](',\x20')});return;}const _0xfdf974=0xa*0x400*0x400;if(_0x4d659c[_0x4d354e(0x190)]>_0xfdf974){_0x1fde10[_0x4d354e(0x18a)](0x190)[_0x4d354e(0x1c7)]({'success':![],'error':_0x4d354e(0x1ab)});return;}const _0x28d02d=await database_1['default'][_0x4d354e(0x18b)][_0x4d354e(0x1b0)]({'where':{'id':_0x42f07d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x28d02d){console[_0x4d354e(0x1b2)](_0x4d354e(0x169)+_0x42f07d),_0x1fde10['status'](0x194)['json']({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x28d02d['gateway']!==_0x4d354e(0x1ae)&&_0x28d02d[_0x4d354e(0x1a4)]!==_0x4d354e(0x168)){console[_0x4d354e(0x1b2)](_0x4d354e(0x175)+_0x28d02d[_0x4d354e(0x1a4)]),_0x1fde10['status'](0x190)[_0x4d354e(0x1c7)]({'success':![],'error':_0x4d354e(0x177)+_0x28d02d[_0x4d354e(0x1a4)]});return;}let _0x5a9115=_0x4d659c;_0x4d659c[_0x4d354e(0x1c9)](',')&&(_0x5a9115=_0x4d659c[_0x4d354e(0x19c)](',')[0x1]);try{Buffer[_0x4d354e(0x17d)](_0x5a9115,'base64');}catch(_0x27dcd3){_0x1fde10[_0x4d354e(0x18a)](0x190)['json']({'success':![],'error':_0x4d354e(0x191)});return;}const _0x4dd89f=await database_1[_0x4d354e(0x17c)][_0x4d354e(0x18b)][_0x4d354e(0x17f)]({'where':{'id':_0x42f07d},'data':{'status':_0x4d354e(0x1cc),'updatedAt':new Date()}});console[_0x4d354e(0x1b2)]('‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:'),console[_0x4d354e(0x1b2)]('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x42f07d),console[_0x4d354e(0x1b2)](_0x4d354e(0x1af)+_0x28d02d[_0x4d354e(0x1a4)][_0x4d354e(0x19a)]()),console[_0x4d354e(0x1b2)](_0x4d354e(0x181)+_0x4d1353),console[_0x4d354e(0x1b2)](_0x4d354e(0x1cd)+Math[_0x4d354e(0x17a)](_0x5a9115[_0x4d354e(0x190)]*0.75/0x400)+'KB'),console[_0x4d354e(0x1b2)](_0x4d354e(0x1c1));try{const _0x17551b=_0x28d02d[_0x4d354e(0x1a4)][_0x4d354e(0x19a)](),_0x6a27b5=_0x28d02d[_0x4d354e(0x1b8)][_0x4d354e(0x1ca)]||_0x28d02d[_0x4d354e(0x1b8)]['username'],_0x2c79a8=Math['round'](_0x5a9115[_0x4d354e(0x190)]*0.75/0x400),_0x54e7b2='üîÑ\x20'+_0x17551b+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0x4d354e(0x1b4)+_0x42f07d+'\x0a')+(_0x4d354e(0x189)+_0x28d02d[_0x4d354e(0x1a6)]+'\x20'+_0x28d02d['currency']+'\x0a')+(_0x4d354e(0x185)+_0x4d1353[_0x4d354e(0x19a)]()+'\x20('+_0x2c79a8+'KB)\x0a')+_0x4d354e(0x1a1)+('üåê\x20Customer\x20IP:\x20'+_0x636e5d+'\x0a\x0a')+_0x4d354e(0x198);await telegramBotService_1['telegramBotService'][_0x4d354e(0x16a)](_0x28d02d[_0x4d354e(0x16d)],_0x54e7b2,{'parse_mode':_0x4d354e(0x19b)});const _0x246b3b=Buffer[_0x4d354e(0x17d)](_0x5a9115,'base64'),_0x18cc6b='payment_proof_'+_0x42f07d+'.'+_0x4d1353;await telegramBotService_1[_0x4d354e(0x1a0)][_0x4d354e(0x1b9)](_0x28d02d['shopId'],_0x246b3b,_0x18cc6b,_0x4d354e(0x167)+_0x42f07d),console[_0x4d354e(0x1b2)](_0x4d354e(0x1c3));const _0x985a60=_0x4d354e(0x18d),_0x958d4c='üîÑ\x20'+_0x17551b+_0x4d354e(0x179)+('üí≥\x20Payment\x20ID:\x20'+_0x42f07d+'\x0a')+('üè™\x20Shop:\x20'+_0x6a27b5+'\x0a')+(_0x4d354e(0x189)+_0x28d02d[_0x4d354e(0x1a6)]+'\x20'+_0x28d02d[_0x4d354e(0x188)]+'\x0a')+(_0x4d354e(0x185)+_0x4d1353[_0x4d354e(0x19a)]()+'\x20('+_0x2c79a8+_0x4d354e(0x1b5))+_0x4d354e(0x1a1)+(_0x4d354e(0x178)+_0x636e5d+'\x0a\x0a')+'‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.';await telegramBotService_1[_0x4d354e(0x1a0)][_0x4d354e(0x1a8)](parseInt(_0x985a60),_0x958d4c),await telegramBotService_1[_0x4d354e(0x1a0)][_0x4d354e(0x197)](parseInt(_0x985a60),_0x246b3b,_0x18cc6b,_0x4d354e(0x1b3)+_0x42f07d),console[_0x4d354e(0x1b2)](_0x4d354e(0x1bb));}catch(_0x406069){console['error'](_0x4d354e(0x1c8),_0x406069);}_0x1fde10[_0x4d354e(0x1c7)]({'success':!![],'message':_0x4d354e(0x1aa),'data':{'paymentId':_0x4dd89f['id'],'status':_0x4dd89f[_0x4d354e(0x18a)],'gateway':_0x28d02d[_0x4d354e(0x1a4)],'fileType':_0x4d1353,'fileSize':Math[_0x4d354e(0x17a)](_0x5a9115[_0x4d354e(0x190)]*0.75/0x400)+'KB','uploadedAt':_0x4dd89f[_0x4d354e(0x1c4)]}});}catch(_0x5b056e){console[_0x4d354e(0x17e)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x5b056e),_0x1fde10[_0x4d354e(0x18a)](0x1f4)[_0x4d354e(0x1c7)]({'success':![],'error':_0x4d354e(0x187),'details':_0x5b056e instanceof Error?_0x5b056e['message']:_0x4d354e(0x1b1)});}}async[a11_0x3f9034(0x1a9)](_0x2f8a73,_0x244059){const _0x5c9596=a11_0x3f9034;try{const {paymentId:_0x4340ce}=_0x2f8a73[_0x5c9596(0x173)];console[_0x5c9596(0x1b2)](_0x5c9596(0x1bf)+_0x4340ce);const _0x1a419d=await database_1[_0x5c9596(0x17c)][_0x5c9596(0x18b)]['findUnique']({'where':{'id':_0x4340ce},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1a419d){_0x244059['status'](0x194)[_0x5c9596(0x1c7)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x1a419d[_0x5c9596(0x1a4)]!==_0x5c9596(0x1ae)&&_0x1a419d[_0x5c9596(0x1a4)]!==_0x5c9596(0x168)){_0x244059[_0x5c9596(0x18a)](0x190)[_0x5c9596(0x1c7)]({'success':![],'error':_0x5c9596(0x1ba)+_0x1a419d[_0x5c9596(0x1a4)]});return;}let _0x50f0fb='',_0x29d157=_0x1a419d['currency'],_0x17a014='';if(_0x1a419d['gateway']===_0x5c9596(0x1ae))_0x17a014=_0x5c9596(0x16f),_0x29d157=_0x5c9596(0x176),_0x50f0fb=_0x5c9596(0x170)+_0x1a419d[_0x5c9596(0x1a6)]+'\x20'+_0x29d157+_0x5c9596(0x16c);else _0x1a419d[_0x5c9596(0x1a4)]===_0x5c9596(0x168)&&(_0x17a014=_0x5c9596(0x1ac),_0x29d157=_0x5c9596(0x184),_0x50f0fb=_0x5c9596(0x183)+_0x1a419d[_0x5c9596(0x1a6)]+'\x20'+_0x29d157+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x433afb={'success':!![],'data':{'paymentId':_0x1a419d['id'],'gateway':_0x1a419d[_0x5c9596(0x1a4)],'gatewayName':_0x1a419d['gateway']['toUpperCase'](),'transferType':_0x17a014,'amount':_0x1a419d[_0x5c9596(0x1a6)],'currency':_0x29d157,'status':_0x1a419d[_0x5c9596(0x18a)],'instructions':_0x50f0fb,'shopName':_0x1a419d[_0x5c9596(0x1b8)][_0x5c9596(0x1ca)]||_0x1a419d[_0x5c9596(0x1b8)][_0x5c9596(0x1cf)],'hasProof':![],'proofType':null,'createdAt':_0x1a419d[_0x5c9596(0x16b)],'updatedAt':_0x1a419d['updatedAt'],'supportedFileTypes':[_0x5c9596(0x19f),_0x5c9596(0x1bc),_0x5c9596(0x171),_0x5c9596(0x1a2),'PDF'],'maxFileSize':'10MB'}};_0x244059['json'](_0x433afb);}catch(_0x40e0f9){console[_0x5c9596(0x17e)](_0x5c9596(0x1ad),_0x40e0f9),_0x244059[_0x5c9596(0x18a)](0x1f4)[_0x5c9596(0x1c7)]({'success':![],'error':'Internal\x20server\x20error','details':_0x40e0f9 instanceof Error?_0x40e0f9[_0x5c9596(0x16e)]:'Unknown\x20error'});}}}exports['ManualPaymentController']=ManualPaymentController,exports[a11_0x3f9034(0x199)]=new ManualPaymentController();