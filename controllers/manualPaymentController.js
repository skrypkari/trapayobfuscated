'use strict';function a8_0x2c34(){const _0x5707a7=['‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','Unknown\x20error','Internal\x20server\x20error','üìÅ\x20File\x20type:\x20','28uBEDLh','Invalid\x20base64\x20file\x20data','toLowerCase','shop','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','from','sendShopFile','File\x20type\x20is\x20required','length','üí≥\x20Payment\x20ID:\x20','round','sepa','14272GbQNmq','__importDefault','jpeg','KB)\x0a','HEIC','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','includes','sendShopNotification','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','message','JPG','\x20\x20\x20-\x20Gateway:\x20','üìÅ\x20File:\x20','createdAt','username','\x20Payment\x20Proof\x20Received\x0a\x0a','updatedAt','üí∞\x20Amount:\x20','default','\x20\x20\x20-\x20Payment\x20ID:\x20','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','interac','üåê\x20Client\x20IP:\x20','üìã\x20Get\x20manual\x20payment\x20info:\x20','Interac\x20e-Transfer','pdf','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','11ZnKSVe','514348gUcEAG','sendDirectFile','status','PNG','manualPaymentController','Payment\x20proof\x20for\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','Payment\x20proof\x20uploaded\x20successfully','shopId','‚ùå\x20Payment\x20not\x20found:\x20','__esModule','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','currency','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','7867339505','10MB','png','354614kHwwlp','log','Payment\x20ID\x20is\x20required','base64','CAD','PROCESSING','File\x20data\x20is\x20required','1oMcpFv','JPEG','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','connection','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','665410kQBZYN','body','.\x20Supported:\x20','\x20\x20\x20-\x20File\x20size:\x20','‚ùå\x20Upload\x20payment\x20proof\x20error:','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','jpg','toUpperCase','update','ManualPaymentController','uploadPaymentProof','json','\x20\x20\x20-\x20File\x20type:\x20','SEPA\x20Bank\x20Transfer','983050XjdOSY','üîÑ\x20','EUR','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:',',\x20size:\x20','gateway','../config/database','Unsupported\x20file\x20type:\x20','144564xkLHGj','3CmvZNl','telegramBotService','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','üåê\x20Customer\x20IP:\x20','defineProperty','883269txBoRk','payment','amount','error','sendDirectMessage','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','heic'];a8_0x2c34=function(){return _0x5707a7;};return a8_0x2c34();}const a8_0x28ef01=a8_0x1e95;(function(_0x4c86e8,_0x3a026b){const _0x304509=a8_0x1e95,_0x2623cb=_0x4c86e8();while(!![]){try{const _0x414e65=parseInt(_0x304509(0x14f))/0x1*(parseInt(_0x304509(0x148))/0x2)+-parseInt(_0x304509(0x16b))/0x3*(parseInt(_0x304509(0x135))/0x4)+parseInt(_0x304509(0x162))/0x5+parseInt(_0x304509(0x16a))/0x6+parseInt(_0x304509(0x10d))/0x7*(parseInt(_0x304509(0x119))/0x8)+-parseInt(_0x304509(0x101))/0x9+-parseInt(_0x304509(0x154))/0xa*(parseInt(_0x304509(0x134))/0xb);if(_0x414e65===_0x3a026b)break;else _0x2623cb['push'](_0x2623cb['shift']());}catch(_0x79cd4){_0x2623cb['push'](_0x2623cb['shift']());}}}(a8_0x2c34,0x1b506));var __importDefault=this&&this[a8_0x28ef01(0x11a)]||function(_0x45bea7){const _0x2820a2=a8_0x28ef01;return _0x45bea7&&_0x45bea7[_0x2820a2(0x140)]?_0x45bea7:{'default':_0x45bea7};};Object[a8_0x28ef01(0x16f)](exports,a8_0x28ef01(0x140),{'value':!![]}),exports[a8_0x28ef01(0x139)]=exports[a8_0x28ef01(0x15d)]=void 0x0;function a8_0x1e95(_0x37909b,_0x59add8){const _0x2c34e0=a8_0x2c34();return a8_0x1e95=function(_0x1e9521,_0x213159){_0x1e9521=_0x1e9521-0x101;let _0x12c83a=_0x2c34e0[_0x1e9521];return _0x12c83a;},a8_0x1e95(_0x37909b,_0x59add8);}const database_1=__importDefault(require(a8_0x28ef01(0x168))),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async[a8_0x28ef01(0x15e)](_0xad2ad2,_0x210324){const _0x5d18ec=a8_0x28ef01;try{const {paymentId:_0x383cad,fileData:_0x25d082,fileType:_0x2725c8,fileName:_0x282c09}=_0xad2ad2[_0x5d18ec(0x155)],_0x2f9b63=_0xad2ad2['ip']||_0xad2ad2[_0x5d18ec(0x152)]?.['remoteAddress']||'unknown';console['log'](_0x5d18ec(0x12d)+_0x383cad),console[_0x5d18ec(0x149)](_0x5d18ec(0x10c)+_0x2725c8+_0x5d18ec(0x166)+(_0x25d082?Math[_0x5d18ec(0x117)](_0x25d082[_0x5d18ec(0x115)]*0.75/0x400):0x0)+'KB'),console[_0x5d18ec(0x149)](_0x5d18ec(0x12f)+_0x2f9b63);if(!_0x383cad){_0x210324[_0x5d18ec(0x137)](0x190)[_0x5d18ec(0x15f)]({'success':![],'error':_0x5d18ec(0x14a)});return;}if(!_0x25d082){_0x210324[_0x5d18ec(0x137)](0x190)[_0x5d18ec(0x15f)]({'success':![],'error':_0x5d18ec(0x14e)});return;}if(!_0x2725c8){_0x210324[_0x5d18ec(0x137)](0x190)[_0x5d18ec(0x15f)]({'success':![],'error':_0x5d18ec(0x114)});return;}const _0x30dbf4=[_0x5d18ec(0x147),_0x5d18ec(0x15a),_0x5d18ec(0x11b),_0x5d18ec(0x107),_0x5d18ec(0x132)],_0x599d7b=_0x2725c8[_0x5d18ec(0x10f)]()['replace']('.','');if(!_0x30dbf4[_0x5d18ec(0x11f)](_0x599d7b)){_0x210324['status'](0x190)['json']({'success':![],'error':_0x5d18ec(0x169)+_0x2725c8+_0x5d18ec(0x156)+_0x30dbf4['join'](',\x20')});return;}const _0x2bc9b4=0xa*0x400*0x400;if(_0x25d082[_0x5d18ec(0x115)]>_0x2bc9b4){_0x210324['status'](0x190)[_0x5d18ec(0x15f)]({'success':![],'error':_0x5d18ec(0x144)});return;}const _0x21ab11=await database_1[_0x5d18ec(0x12b)]['payment']['findUnique']({'where':{'id':_0x383cad},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x21ab11){console[_0x5d18ec(0x149)](_0x5d18ec(0x13f)+_0x383cad),_0x210324[_0x5d18ec(0x137)](0x194)[_0x5d18ec(0x15f)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x21ab11[_0x5d18ec(0x167)]!==_0x5d18ec(0x12e)&&_0x21ab11[_0x5d18ec(0x167)]!==_0x5d18ec(0x118)){console['log'](_0x5d18ec(0x133)+_0x21ab11['gateway']),_0x210324['status'](0x190)['json']({'success':![],'error':_0x5d18ec(0x159)+_0x21ab11[_0x5d18ec(0x167)]});return;}let _0x1ea27c=_0x25d082;_0x25d082[_0x5d18ec(0x11f)](',')&&(_0x1ea27c=_0x25d082['split'](',')[0x1]);try{Buffer[_0x5d18ec(0x112)](_0x1ea27c,'base64');}catch(_0x31696e){_0x210324['status'](0x190)[_0x5d18ec(0x15f)]({'success':![],'error':_0x5d18ec(0x10e)});return;}const _0x3bbc8b=await database_1[_0x5d18ec(0x12b)][_0x5d18ec(0x102)][_0x5d18ec(0x15c)]({'where':{'id':_0x383cad},'data':{'status':_0x5d18ec(0x14d),'updatedAt':new Date()}});console['log'](_0x5d18ec(0x108)),console[_0x5d18ec(0x149)](_0x5d18ec(0x12c)+_0x383cad),console[_0x5d18ec(0x149)](_0x5d18ec(0x124)+_0x21ab11[_0x5d18ec(0x167)][_0x5d18ec(0x15b)]()),console[_0x5d18ec(0x149)](_0x5d18ec(0x160)+_0x599d7b),console[_0x5d18ec(0x149)](_0x5d18ec(0x157)+Math[_0x5d18ec(0x117)](_0x1ea27c[_0x5d18ec(0x115)]*0.75/0x400)+'KB'),console['log'](_0x5d18ec(0x109));try{const _0x1e40e1=_0x21ab11[_0x5d18ec(0x167)][_0x5d18ec(0x15b)](),_0x1f55ff=_0x21ab11[_0x5d18ec(0x110)]['name']||_0x21ab11[_0x5d18ec(0x110)][_0x5d18ec(0x127)],_0x2143c6=Math['round'](_0x1ea27c['length']*0.75/0x400),_0x43f4e4=_0x5d18ec(0x163)+_0x1e40e1+_0x5d18ec(0x128)+('üí≥\x20Payment\x20ID:\x20'+_0x383cad+'\x0a')+('üí∞\x20Amount:\x20'+_0x21ab11[_0x5d18ec(0x103)]+'\x20'+_0x21ab11[_0x5d18ec(0x142)]+'\x0a')+(_0x5d18ec(0x125)+_0x599d7b[_0x5d18ec(0x15b)]()+'\x20('+_0x2143c6+_0x5d18ec(0x11c))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x5d18ec(0x16e)+_0x2f9b63+'\x0a\x0a')+_0x5d18ec(0x106);await telegramBotService_1[_0x5d18ec(0x16c)][_0x5d18ec(0x120)](_0x21ab11[_0x5d18ec(0x13e)],_0x43f4e4,{'parse_mode':'Markdown'});const _0x48b4c4=Buffer['from'](_0x1ea27c,_0x5d18ec(0x14b)),_0x57f22e='payment_proof_'+_0x383cad+'.'+_0x599d7b;await telegramBotService_1[_0x5d18ec(0x16c)][_0x5d18ec(0x113)](_0x21ab11[_0x5d18ec(0x13e)],_0x48b4c4,_0x57f22e,_0x5d18ec(0x13a)+_0x383cad),console['log'](_0x5d18ec(0x111));const _0xd58dbb=_0x5d18ec(0x145),_0x32abd5=_0x5d18ec(0x163)+_0x1e40e1+_0x5d18ec(0x11e)+(_0x5d18ec(0x116)+_0x383cad+'\x0a')+('üè™\x20Shop:\x20'+_0x1f55ff+'\x0a')+(_0x5d18ec(0x12a)+_0x21ab11['amount']+'\x20'+_0x21ab11[_0x5d18ec(0x142)]+'\x0a')+(_0x5d18ec(0x125)+_0x599d7b[_0x5d18ec(0x15b)]()+'\x20('+_0x2143c6+_0x5d18ec(0x11c))+_0x5d18ec(0x13c)+(_0x5d18ec(0x16e)+_0x2f9b63+'\x0a\x0a')+_0x5d18ec(0x151);await telegramBotService_1[_0x5d18ec(0x16c)][_0x5d18ec(0x105)](parseInt(_0xd58dbb),_0x32abd5),await telegramBotService_1[_0x5d18ec(0x16c)][_0x5d18ec(0x136)](parseInt(_0xd58dbb),_0x48b4c4,_0x57f22e,_0x5d18ec(0x141)+_0x383cad),console[_0x5d18ec(0x149)](_0x5d18ec(0x13b));}catch(_0x1c6a28){console['error'](_0x5d18ec(0x165),_0x1c6a28);}_0x210324[_0x5d18ec(0x15f)]({'success':!![],'message':_0x5d18ec(0x13d),'data':{'paymentId':_0x3bbc8b['id'],'status':_0x3bbc8b[_0x5d18ec(0x137)],'gateway':_0x21ab11[_0x5d18ec(0x167)],'fileType':_0x599d7b,'fileSize':Math[_0x5d18ec(0x117)](_0x1ea27c[_0x5d18ec(0x115)]*0.75/0x400)+'KB','uploadedAt':_0x3bbc8b[_0x5d18ec(0x129)]}});}catch(_0x12b37a){console[_0x5d18ec(0x104)](_0x5d18ec(0x158),_0x12b37a),_0x210324[_0x5d18ec(0x137)](0x1f4)[_0x5d18ec(0x15f)]({'success':![],'error':_0x5d18ec(0x10b),'details':_0x12b37a instanceof Error?_0x12b37a[_0x5d18ec(0x122)]:_0x5d18ec(0x10a)});}}async['getManualPaymentInfo'](_0x4a30f5,_0x5c966f){const _0x32e8a4=a8_0x28ef01;try{const {paymentId:_0x2e85c7}=_0x4a30f5['params'];console[_0x32e8a4(0x149)](_0x32e8a4(0x130)+_0x2e85c7);const _0x33af3f=await database_1[_0x32e8a4(0x12b)]['payment']['findUnique']({'where':{'id':_0x2e85c7},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x33af3f){_0x5c966f['status'](0x194)[_0x32e8a4(0x15f)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x33af3f['gateway']!==_0x32e8a4(0x12e)&&_0x33af3f[_0x32e8a4(0x167)]!=='sepa'){_0x5c966f['status'](0x190)[_0x32e8a4(0x15f)]({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x33af3f[_0x32e8a4(0x167)]});return;}let _0x3d8ec3='',_0x5c6eb7=_0x33af3f[_0x32e8a4(0x142)],_0x1d744f='';if(_0x33af3f[_0x32e8a4(0x167)]===_0x32e8a4(0x12e))_0x1d744f=_0x32e8a4(0x131),_0x5c6eb7=_0x32e8a4(0x14c),_0x3d8ec3=_0x32e8a4(0x16d)+_0x33af3f[_0x32e8a4(0x103)]+'\x20'+_0x5c6eb7+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.';else _0x33af3f[_0x32e8a4(0x167)]===_0x32e8a4(0x118)&&(_0x1d744f=_0x32e8a4(0x161),_0x5c6eb7=_0x32e8a4(0x164),_0x3d8ec3=_0x32e8a4(0x153)+_0x33af3f[_0x32e8a4(0x103)]+'\x20'+_0x5c6eb7+_0x32e8a4(0x143));const _0x3ff3da={'success':!![],'data':{'paymentId':_0x33af3f['id'],'gateway':_0x33af3f[_0x32e8a4(0x167)],'gatewayName':_0x33af3f[_0x32e8a4(0x167)][_0x32e8a4(0x15b)](),'transferType':_0x1d744f,'amount':_0x33af3f[_0x32e8a4(0x103)],'currency':_0x5c6eb7,'status':_0x33af3f[_0x32e8a4(0x137)],'instructions':_0x3d8ec3,'shopName':_0x33af3f[_0x32e8a4(0x110)]['name']||_0x33af3f['shop']['username'],'hasProof':![],'proofType':null,'createdAt':_0x33af3f[_0x32e8a4(0x126)],'updatedAt':_0x33af3f[_0x32e8a4(0x129)],'supportedFileTypes':[_0x32e8a4(0x138),_0x32e8a4(0x123),_0x32e8a4(0x150),_0x32e8a4(0x11d),'PDF'],'maxFileSize':_0x32e8a4(0x146)}};_0x5c966f[_0x32e8a4(0x15f)](_0x3ff3da);}catch(_0x55356a){console[_0x32e8a4(0x104)](_0x32e8a4(0x121),_0x55356a),_0x5c966f[_0x32e8a4(0x137)](0x1f4)[_0x32e8a4(0x15f)]({'success':![],'error':'Internal\x20server\x20error','details':_0x55356a instanceof Error?_0x55356a[_0x32e8a4(0x122)]:_0x32e8a4(0x10a)});}}}exports[a8_0x28ef01(0x15d)]=ManualPaymentController,exports[a8_0x28ef01(0x139)]=new ManualPaymentController();