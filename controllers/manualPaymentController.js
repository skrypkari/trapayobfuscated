'use strict';function a9_0x562a(_0x5bfde4,_0x1b635b){_0x5bfde4=_0x5bfde4-0x121;const _0x264e03=a9_0x264e();let _0x562a6a=_0x264e03[_0x5bfde4];return _0x562a6a;}const a9_0x4a9b2a=a9_0x562a;(function(_0x54c679,_0x11015e){const _0x74e7d9=a9_0x562a,_0x5d142e=_0x54c679();while(!![]){try{const _0x2d8921=parseInt(_0x74e7d9(0x13c))/0x1*(parseInt(_0x74e7d9(0x140))/0x2)+parseInt(_0x74e7d9(0x146))/0x3*(-parseInt(_0x74e7d9(0x124))/0x4)+parseInt(_0x74e7d9(0x17e))/0x5+-parseInt(_0x74e7d9(0x125))/0x6+parseInt(_0x74e7d9(0x132))/0x7*(-parseInt(_0x74e7d9(0x137))/0x8)+parseInt(_0x74e7d9(0x157))/0x9*(-parseInt(_0x74e7d9(0x17f))/0xa)+parseInt(_0x74e7d9(0x183))/0xb*(parseInt(_0x74e7d9(0x17a))/0xc);if(_0x2d8921===_0x11015e)break;else _0x5d142e['push'](_0x5d142e['shift']());}catch(_0x15ac44){_0x5d142e['push'](_0x5d142e['shift']());}}}(a9_0x264e,0x3a739));var __importDefault=this&&this[a9_0x4a9b2a(0x138)]||function(_0x2cf4dd){const _0x704ba2=a9_0x4a9b2a;return _0x2cf4dd&&_0x2cf4dd[_0x704ba2(0x149)]?_0x2cf4dd:{'default':_0x2cf4dd};};Object[a9_0x4a9b2a(0x160)](exports,a9_0x4a9b2a(0x149),{'value':!![]}),exports[a9_0x4a9b2a(0x144)]=exports[a9_0x4a9b2a(0x189)]=void 0x0;const database_1=__importDefault(require(a9_0x4a9b2a(0x175))),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async[a9_0x4a9b2a(0x126)](_0x4bf2d9,_0x480814){const _0x148a71=a9_0x4a9b2a;try{const {paymentId:_0x40bde3,fileData:_0x633f8c,fileType:_0x12e491,fileName:_0x3b0ad0}=_0x4bf2d9[_0x148a71(0x172)],_0x1445c9=_0x4bf2d9['ip']||_0x4bf2d9['connection']?.['remoteAddress']||_0x148a71(0x180);console[_0x148a71(0x13a)](_0x148a71(0x167)+_0x40bde3),console[_0x148a71(0x13a)](_0x148a71(0x12b)+_0x12e491+_0x148a71(0x128)+(_0x633f8c?Math[_0x148a71(0x15d)](_0x633f8c['length']*0.75/0x400):0x0)+'KB'),console['log']('ğŸŒ\x20Client\x20IP:\x20'+_0x1445c9);if(!_0x40bde3){_0x480814[_0x148a71(0x16f)](0x190)[_0x148a71(0x181)]({'success':![],'error':_0x148a71(0x127)});return;}if(!_0x633f8c){_0x480814[_0x148a71(0x16f)](0x190)[_0x148a71(0x181)]({'success':![],'error':_0x148a71(0x14c)});return;}if(!_0x12e491){_0x480814[_0x148a71(0x16f)](0x190)['json']({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x437308=[_0x148a71(0x135),'jpg','jpeg',_0x148a71(0x164),_0x148a71(0x143)],_0x2701be=_0x12e491['toLowerCase']()[_0x148a71(0x185)]('.','');if(!_0x437308[_0x148a71(0x12d)](_0x2701be)){_0x480814[_0x148a71(0x16f)](0x190)[_0x148a71(0x181)]({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x12e491+'.\x20Supported:\x20'+_0x437308[_0x148a71(0x16b)](',\x20')});return;}const _0x2bb7b1=0xa*0x400*0x400;if(_0x633f8c[_0x148a71(0x147)]>_0x2bb7b1){_0x480814[_0x148a71(0x16f)](0x190)['json']({'success':![],'error':_0x148a71(0x134)});return;}const _0x5bc292=await database_1[_0x148a71(0x170)][_0x148a71(0x142)][_0x148a71(0x133)]({'where':{'id':_0x40bde3},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5bc292){console[_0x148a71(0x13a)](_0x148a71(0x168)+_0x40bde3),_0x480814[_0x148a71(0x16f)](0x194)[_0x148a71(0x181)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x5bc292[_0x148a71(0x153)]!==_0x148a71(0x13f)&&_0x5bc292[_0x148a71(0x153)]!==_0x148a71(0x16a)){console[_0x148a71(0x13a)](_0x148a71(0x122)+_0x5bc292['gateway']),_0x480814[_0x148a71(0x16f)](0x190)['json']({'success':![],'error':_0x148a71(0x151)+_0x5bc292[_0x148a71(0x153)]});return;}let _0xca8e49=_0x633f8c;_0x633f8c['includes'](',')&&(_0xca8e49=_0x633f8c[_0x148a71(0x154)](',')[0x1]);try{Buffer[_0x148a71(0x162)](_0xca8e49,_0x148a71(0x129));}catch(_0x42a0da){_0x480814[_0x148a71(0x16f)](0x190)['json']({'success':![],'error':_0x148a71(0x14a)});return;}const _0xb9f609=await database_1[_0x148a71(0x170)][_0x148a71(0x142)][_0x148a71(0x12c)]({'where':{'id':_0x40bde3},'data':{'status':_0x148a71(0x15e),'updatedAt':new Date()}});console['log']('âœ…\x20Payment\x20proof\x20uploaded\x20successfully:'),console['log'](_0x148a71(0x169)+_0x40bde3),console[_0x148a71(0x13a)](_0x148a71(0x121)+_0x5bc292[_0x148a71(0x153)][_0x148a71(0x145)]()),console[_0x148a71(0x13a)](_0x148a71(0x16d)+_0x2701be),console[_0x148a71(0x13a)](_0x148a71(0x152)+Math[_0x148a71(0x15d)](_0xca8e49[_0x148a71(0x147)]*0.75/0x400)+'KB'),console[_0x148a71(0x13a)](_0x148a71(0x148));try{const _0x8d4e7b=_0x5bc292[_0x148a71(0x153)][_0x148a71(0x145)](),_0x4d232a=_0x5bc292[_0x148a71(0x13e)][_0x148a71(0x136)]||_0x5bc292[_0x148a71(0x13e)]['username'],_0x12c733=Math[_0x148a71(0x15d)](_0xca8e49['length']*0.75/0x400),_0x16f997='ğŸ”„\x20'+_0x8d4e7b+_0x148a71(0x15c)+(_0x148a71(0x17c)+_0x40bde3+'\x0a')+(_0x148a71(0x178)+_0x5bc292[_0x148a71(0x179)]+'\x20'+_0x5bc292['currency']+'\x0a')+(_0x148a71(0x16e)+_0x2701be[_0x148a71(0x145)]()+'\x20('+_0x12c733+_0x148a71(0x12e))+'ğŸ“Š\x20Status:\x20PENDING\x20â†’\x20PROCESSING\x0a'+(_0x148a71(0x141)+_0x1445c9+'\x0a\x0a')+_0x148a71(0x176);await telegramBotService_1[_0x148a71(0x131)][_0x148a71(0x14f)](_0x5bc292['shopId'],_0x16f997,{'parse_mode':'Markdown'});const _0x2dd9d4=Buffer[_0x148a71(0x162)](_0xca8e49,_0x148a71(0x129)),_0x4b0546=_0x148a71(0x12f)+_0x40bde3+'.'+_0x2701be;await telegramBotService_1['telegramBotService'][_0x148a71(0x150)](_0x5bc292[_0x148a71(0x158)],_0x2dd9d4,_0x4b0546,_0x148a71(0x186)+_0x40bde3),console[_0x148a71(0x13a)](_0x148a71(0x188));const _0x48feae='7867339505',_0x55f57c=_0x148a71(0x177)+_0x8d4e7b+'\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a'+(_0x148a71(0x17c)+_0x40bde3+'\x0a')+('ğŸª\x20Shop:\x20'+_0x4d232a+'\x0a')+(_0x148a71(0x178)+_0x5bc292['amount']+'\x20'+_0x5bc292['currency']+'\x0a')+(_0x148a71(0x16e)+_0x2701be[_0x148a71(0x145)]()+'\x20('+_0x12c733+'KB)\x0a')+_0x148a71(0x18a)+('ğŸŒ\x20Customer\x20IP:\x20'+_0x1445c9+'\x0a\x0a')+_0x148a71(0x155);await telegramBotService_1[_0x148a71(0x131)][_0x148a71(0x14b)](parseInt(_0x48feae),_0x55f57c),await telegramBotService_1['telegramBotService'][_0x148a71(0x171)](parseInt(_0x48feae),_0x2dd9d4,_0x4b0546,_0x148a71(0x139)+_0x40bde3),console[_0x148a71(0x13a)](_0x148a71(0x14d));}catch(_0x398ab1){console[_0x148a71(0x130)]('âŒ\x20Failed\x20to\x20send\x20Telegram\x20notifications:',_0x398ab1);}_0x480814[_0x148a71(0x181)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0xb9f609['id'],'status':_0xb9f609[_0x148a71(0x16f)],'gateway':_0x5bc292[_0x148a71(0x153)],'fileType':_0x2701be,'fileSize':Math[_0x148a71(0x15d)](_0xca8e49[_0x148a71(0x147)]*0.75/0x400)+'KB','uploadedAt':_0xb9f609[_0x148a71(0x17b)]}});}catch(_0x1494db){console['error']('âŒ\x20Upload\x20payment\x20proof\x20error:',_0x1494db),_0x480814[_0x148a71(0x16f)](0x1f4)[_0x148a71(0x181)]({'success':![],'error':'Internal\x20server\x20error','details':_0x1494db instanceof Error?_0x1494db[_0x148a71(0x159)]:'Unknown\x20error'});}}async[a9_0x4a9b2a(0x123)](_0x86b5c9,_0x4b746a){const _0x3e5ce2=a9_0x4a9b2a;try{const {paymentId:_0x2c06c8}=_0x86b5c9[_0x3e5ce2(0x17d)];console['log'](_0x3e5ce2(0x12a)+_0x2c06c8);const _0x1ad16d=await database_1['default'][_0x3e5ce2(0x142)][_0x3e5ce2(0x133)]({'where':{'id':_0x2c06c8},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1ad16d){_0x4b746a[_0x3e5ce2(0x16f)](0x194)['json']({'success':![],'error':_0x3e5ce2(0x163)});return;}if(_0x1ad16d[_0x3e5ce2(0x153)]!==_0x3e5ce2(0x13f)&&_0x1ad16d[_0x3e5ce2(0x153)]!==_0x3e5ce2(0x16a)){_0x4b746a[_0x3e5ce2(0x16f)](0x190)['json']({'success':![],'error':_0x3e5ce2(0x173)+_0x1ad16d[_0x3e5ce2(0x153)]});return;}let _0x2e574c='',_0x558d09=_0x1ad16d[_0x3e5ce2(0x15f)],_0x17da64='';if(_0x1ad16d[_0x3e5ce2(0x153)]===_0x3e5ce2(0x13f))_0x17da64=_0x3e5ce2(0x174),_0x558d09=_0x3e5ce2(0x15b),_0x2e574c=_0x3e5ce2(0x182)+_0x1ad16d[_0x3e5ce2(0x179)]+'\x20'+_0x558d09+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.';else _0x1ad16d[_0x3e5ce2(0x153)]==='sepa'&&(_0x17da64='SEPA\x20Bank\x20Transfer',_0x558d09=_0x3e5ce2(0x15a),_0x2e574c='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x1ad16d[_0x3e5ce2(0x179)]+'\x20'+_0x558d09+_0x3e5ce2(0x13b));const _0x2126a={'success':!![],'data':{'paymentId':_0x1ad16d['id'],'gateway':_0x1ad16d['gateway'],'gatewayName':_0x1ad16d[_0x3e5ce2(0x153)][_0x3e5ce2(0x145)](),'transferType':_0x17da64,'amount':_0x1ad16d['amount'],'currency':_0x558d09,'status':_0x1ad16d[_0x3e5ce2(0x16f)],'instructions':_0x2e574c,'shopName':_0x1ad16d['shop'][_0x3e5ce2(0x136)]||_0x1ad16d[_0x3e5ce2(0x13e)][_0x3e5ce2(0x187)],'hasProof':![],'proofType':null,'createdAt':_0x1ad16d[_0x3e5ce2(0x16c)],'updatedAt':_0x1ad16d['updatedAt'],'supportedFileTypes':['PNG',_0x3e5ce2(0x13d),_0x3e5ce2(0x161),_0x3e5ce2(0x184),_0x3e5ce2(0x165)],'maxFileSize':_0x3e5ce2(0x14e)}};_0x4b746a[_0x3e5ce2(0x181)](_0x2126a);}catch(_0x58322c){console[_0x3e5ce2(0x130)](_0x3e5ce2(0x156),_0x58322c),_0x4b746a['status'](0x1f4)[_0x3e5ce2(0x181)]({'success':![],'error':_0x3e5ce2(0x166),'details':_0x58322c instanceof Error?_0x58322c[_0x3e5ce2(0x159)]:'Unknown\x20error'});}}}function a9_0x264e(){const _0x4fdac7=['toUpperCase','543ZggAow','length','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','__esModule','Invalid\x20base64\x20file\x20data','sendDirectMessage','File\x20data\x20is\x20required','ğŸ“±\x20Admin\x20notification\x20and\x20file\x20sent','10MB','sendShopNotification','sendShopFile','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','\x20\x20\x20-\x20File\x20size:\x20','gateway','split','âš ï¸\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','âŒ\x20Get\x20manual\x20payment\x20info\x20error:','9hqgFzv','shopId','message','EUR','CAD','\x20Payment\x20Proof\x20Received\x0a\x0a','round','PROCESSING','currency','defineProperty','JPEG','from','Payment\x20not\x20found','heic','PDF','Internal\x20server\x20error','ğŸ“¤\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','âŒ\x20Payment\x20not\x20found:\x20','\x20\x20\x20-\x20Payment\x20ID:\x20','sepa','join','createdAt','\x20\x20\x20-\x20File\x20type:\x20','ğŸ“\x20File:\x20','status','default','sendDirectFile','body','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','Interac\x20e-Transfer','../config/database','â³\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','ğŸ”„\x20','ğŸ’°\x20Amount:\x20','amount','770940FiIJwU','updatedAt','ğŸ’³\x20Payment\x20ID:\x20','params','2063145pDPuwE','969790ynhRje','unknown','json','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','88IWKtco','HEIC','replace','Payment\x20proof\x20for\x20','username','ğŸ“±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','ManualPaymentController','ğŸ“Š\x20Status:\x20PENDING\x20â†’\x20PROCESSING\x0a','\x20\x20\x20-\x20Gateway:\x20','âŒ\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','getManualPaymentInfo','1464gJdLZb','2575836hcIeUd','uploadPaymentProof','Payment\x20ID\x20is\x20required',',\x20size:\x20','base64','ğŸ“‹\x20Get\x20manual\x20payment\x20info:\x20','ğŸ“\x20File\x20type:\x20','update','includes','KB)\x0a','payment_proof_','error','telegramBotService','1368556FWBpbl','findUnique','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','png','name','8gsiCTH','__importDefault','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','log','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','7759qoIrHl','JPG','shop','interac','26ibAWxC','ğŸŒ\x20Customer\x20IP:\x20','payment','pdf','manualPaymentController'];a9_0x264e=function(){return _0x4fdac7;};return a9_0x264e();}exports[a9_0x4a9b2a(0x189)]=ManualPaymentController,exports[a9_0x4a9b2a(0x144)]=new ManualPaymentController();