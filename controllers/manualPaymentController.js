'use strict';const a8_0x1c90b5=a8_0x3532;(function(_0x168eab,_0x47b53a){const _0xa7c7b5=a8_0x3532,_0x2080d0=_0x168eab();while(!![]){try{const _0x51b1fa=parseInt(_0xa7c7b5(0x1b5))/0x1+parseInt(_0xa7c7b5(0x184))/0x2*(parseInt(_0xa7c7b5(0x1e1))/0x3)+parseInt(_0xa7c7b5(0x19c))/0x4+parseInt(_0xa7c7b5(0x1d0))/0x5*(parseInt(_0xa7c7b5(0x1d1))/0x6)+-parseInt(_0xa7c7b5(0x1d6))/0x7*(parseInt(_0xa7c7b5(0x182))/0x8)+-parseInt(_0xa7c7b5(0x194))/0x9*(parseInt(_0xa7c7b5(0x188))/0xa)+-parseInt(_0xa7c7b5(0x18d))/0xb*(-parseInt(_0xa7c7b5(0x18c))/0xc);if(_0x51b1fa===_0x47b53a)break;else _0x2080d0['push'](_0x2080d0['shift']());}catch(_0xdc17ae){_0x2080d0['push'](_0x2080d0['shift']());}}}(a8_0xf3c0,0xc955d));var __importDefault=this&&this[a8_0x1c90b5(0x1dd)]||function(_0x1cf407){return _0x1cf407&&_0x1cf407['__esModule']?_0x1cf407:{'default':_0x1cf407};};function a8_0x3532(_0x3f5bb4,_0x665ebb){const _0xf3c0d7=a8_0xf3c0();return a8_0x3532=function(_0x3532b2,_0x11427b){_0x3532b2=_0x3532b2-0x180;let _0x56340b=_0xf3c0d7[_0x3532b2];return _0x56340b;},a8_0x3532(_0x3f5bb4,_0x665ebb);}Object[a8_0x1c90b5(0x18b)](exports,a8_0x1c90b5(0x185),{'value':!![]}),exports[a8_0x1c90b5(0x186)]=exports[a8_0x1c90b5(0x191)]=void 0x0;function a8_0xf3c0(){const _0x502a77=['HEIC','105478OZBcLx','__esModule','manualPaymentController','File\x20type\x20is\x20required','6349890FbtGhs','sendDirectFile','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','defineProperty','24tMsdIH','6138374qYTNXv','length','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','ManualPaymentController','JPEG','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','9dfiIWK','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','Invalid\x20base64\x20file\x20data','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','updatedAt','üìÅ\x20File\x20type:\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','../config/database','1370484FAITUP','getManualPaymentInfo','PROCESSING',',\x20size:\x20','shop','interac','sendDirectMessage','shopId','json','amount','round','üè™\x20Shop:\x20','üí≥\x20Payment\x20ID:\x20','üìã\x20Get\x20manual\x20payment\x20info:\x20','png','gateway','7867339505','base64','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','PNG','üìÅ\x20File:\x20','Payment\x20proof\x20for\x20','sendShopFile','connection','telegramBotService','138804MPLYRK','name','split','Internal\x20server\x20error','KB)\x0a','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','\x20\x20\x20-\x20Gateway:\x20','sepa','replace','JPG','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','CAD','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','\x20\x20\x20-\x20File\x20type:\x20','params','\x20Payment\x20Proof\x20Received\x0a\x0a','error','payment','Unknown\x20error','üåê\x20Customer\x20IP:\x20','üí∞\x20Amount:\x20','‚ùå\x20Payment\x20not\x20found:\x20','currency','SEPA\x20Bank\x20Transfer','createdAt','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','1165Qvqegs','474WVLBxr','Payment\x20proof\x20uploaded\x20successfully','toUpperCase','\x20\x20\x20-\x20Payment\x20ID:\x20','sendShopNotification','309183Tqktqc','includes','File\x20data\x20is\x20required','jpeg','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','Payment\x20ID\x20is\x20required','join','__importDefault','status','log','üîÑ\x20','69qNpupp','update','message','üì±\x20Admin\x20notification\x20and\x20file\x20sent','Unsupported\x20file\x20type:\x20','\x20\x20\x20-\x20File\x20size:\x20','remoteAddress','findUnique','pdf','payment_proof_','uploadPaymentProof','default','jpg','Payment\x20not\x20found','from','248nUfcMR'];a8_0xf3c0=function(){return _0x502a77;};return a8_0xf3c0();}const database_1=__importDefault(require(a8_0x1c90b5(0x19b))),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async[a8_0x1c90b5(0x1eb)](_0xd295b2,_0x509432){const _0x2de6e5=a8_0x1c90b5;try{const {paymentId:_0x383e16,fileData:_0x1b5234,fileType:_0xc9f5e,fileName:_0x477008}=_0xd295b2['body'],_0x4e22aa=_0xd295b2['ip']||_0xd295b2[_0x2de6e5(0x1b3)]?.[_0x2de6e5(0x1e7)]||'unknown';console[_0x2de6e5(0x1df)]('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x383e16),console['log'](_0x2de6e5(0x199)+_0xc9f5e+_0x2de6e5(0x19f)+(_0x1b5234?Math[_0x2de6e5(0x1a6)](_0x1b5234[_0x2de6e5(0x18e)]*0.75/0x400):0x0)+'KB'),console[_0x2de6e5(0x1df)]('üåê\x20Client\x20IP:\x20'+_0x4e22aa);if(!_0x383e16){_0x509432[_0x2de6e5(0x1de)](0x190)['json']({'success':![],'error':_0x2de6e5(0x1db)});return;}if(!_0x1b5234){_0x509432[_0x2de6e5(0x1de)](0x190)[_0x2de6e5(0x1a4)]({'success':![],'error':_0x2de6e5(0x1d8)});return;}if(!_0xc9f5e){_0x509432['status'](0x190)['json']({'success':![],'error':_0x2de6e5(0x187)});return;}const _0x1fea32=[_0x2de6e5(0x1aa),_0x2de6e5(0x1ed),_0x2de6e5(0x1d9),'heic',_0x2de6e5(0x1e9)],_0x3e237e=_0xc9f5e['toLowerCase']()[_0x2de6e5(0x1bd)]('.','');if(!_0x1fea32[_0x2de6e5(0x1d7)](_0x3e237e)){_0x509432[_0x2de6e5(0x1de)](0x190)[_0x2de6e5(0x1a4)]({'success':![],'error':_0x2de6e5(0x1e5)+_0xc9f5e+'.\x20Supported:\x20'+_0x1fea32[_0x2de6e5(0x1dc)](',\x20')});return;}const _0x195da8=0xa*0x400*0x400;if(_0x1b5234['length']>_0x195da8){_0x509432['status'](0x190)['json']({'success':![],'error':_0x2de6e5(0x190)});return;}const _0x28264b=await database_1['default'][_0x2de6e5(0x1c7)][_0x2de6e5(0x1e8)]({'where':{'id':_0x383e16},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x28264b){console[_0x2de6e5(0x1df)](_0x2de6e5(0x1cb)+_0x383e16),_0x509432['status'](0x194)[_0x2de6e5(0x1a4)]({'success':![],'error':_0x2de6e5(0x180)});return;}if(_0x28264b[_0x2de6e5(0x1ab)]!==_0x2de6e5(0x1a1)&&_0x28264b['gateway']!==_0x2de6e5(0x1bc)){console['log'](_0x2de6e5(0x197)+_0x28264b['gateway']),_0x509432[_0x2de6e5(0x1de)](0x190)['json']({'success':![],'error':_0x2de6e5(0x1ae)+_0x28264b[_0x2de6e5(0x1ab)]});return;}let _0x228324=_0x1b5234;_0x1b5234['includes'](',')&&(_0x228324=_0x1b5234[_0x2de6e5(0x1b7)](',')[0x1]);try{Buffer[_0x2de6e5(0x181)](_0x228324,'base64');}catch(_0x7b2d8e){_0x509432[_0x2de6e5(0x1de)](0x190)['json']({'success':![],'error':_0x2de6e5(0x196)});return;}const _0x49a936=await database_1[_0x2de6e5(0x1ec)][_0x2de6e5(0x1c7)][_0x2de6e5(0x1e2)]({'where':{'id':_0x383e16},'data':{'status':_0x2de6e5(0x19e),'updatedAt':new Date()}});console['log'](_0x2de6e5(0x1c2)),console[_0x2de6e5(0x1df)](_0x2de6e5(0x1d4)+_0x383e16),console[_0x2de6e5(0x1df)](_0x2de6e5(0x1bb)+_0x28264b['gateway']['toUpperCase']()),console[_0x2de6e5(0x1df)](_0x2de6e5(0x1c3)+_0x3e237e),console[_0x2de6e5(0x1df)](_0x2de6e5(0x1e6)+Math[_0x2de6e5(0x1a6)](_0x228324['length']*0.75/0x400)+'KB'),console[_0x2de6e5(0x1df)](_0x2de6e5(0x19a));try{const _0x3fff7b=_0x28264b['gateway'][_0x2de6e5(0x1d3)](),_0x5ac438=_0x28264b[_0x2de6e5(0x1a0)][_0x2de6e5(0x1b6)]||_0x28264b[_0x2de6e5(0x1a0)]['username'],_0x24fbc6=Math[_0x2de6e5(0x1a6)](_0x228324[_0x2de6e5(0x18e)]*0.75/0x400),_0x1bc8e6=_0x2de6e5(0x1e0)+_0x3fff7b+_0x2de6e5(0x1c5)+(_0x2de6e5(0x1a8)+_0x383e16+'\x0a')+(_0x2de6e5(0x1ca)+_0x28264b['amount']+'\x20'+_0x28264b[_0x2de6e5(0x1cc)]+'\x0a')+(_0x2de6e5(0x1b0)+_0x3e237e[_0x2de6e5(0x1d3)]()+'\x20('+_0x24fbc6+_0x2de6e5(0x1b9))+_0x2de6e5(0x1bf)+('üåê\x20Customer\x20IP:\x20'+_0x4e22aa+'\x0a\x0a')+_0x2de6e5(0x195);await telegramBotService_1[_0x2de6e5(0x1b4)][_0x2de6e5(0x1d5)](_0x28264b[_0x2de6e5(0x1a3)],_0x1bc8e6,{'parse_mode':'Markdown'});const _0x58bdc6=Buffer[_0x2de6e5(0x181)](_0x228324,_0x2de6e5(0x1ad)),_0x465830=_0x2de6e5(0x1ea)+_0x383e16+'.'+_0x3e237e;await telegramBotService_1[_0x2de6e5(0x1b4)][_0x2de6e5(0x1b2)](_0x28264b[_0x2de6e5(0x1a3)],_0x58bdc6,_0x465830,_0x2de6e5(0x1b1)+_0x383e16),console[_0x2de6e5(0x1df)]('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x4f56d3=_0x2de6e5(0x1ac),_0x407a14='üîÑ\x20'+_0x3fff7b+_0x2de6e5(0x18a)+('üí≥\x20Payment\x20ID:\x20'+_0x383e16+'\x0a')+(_0x2de6e5(0x1a7)+_0x5ac438+'\x0a')+(_0x2de6e5(0x1ca)+_0x28264b[_0x2de6e5(0x1a5)]+'\x20'+_0x28264b[_0x2de6e5(0x1cc)]+'\x0a')+(_0x2de6e5(0x1b0)+_0x3e237e[_0x2de6e5(0x1d3)]()+'\x20('+_0x24fbc6+'KB)\x0a')+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x2de6e5(0x1c9)+_0x4e22aa+'\x0a\x0a')+_0x2de6e5(0x1da);await telegramBotService_1[_0x2de6e5(0x1b4)][_0x2de6e5(0x1a2)](parseInt(_0x4f56d3),_0x407a14),await telegramBotService_1[_0x2de6e5(0x1b4)][_0x2de6e5(0x189)](parseInt(_0x4f56d3),_0x58bdc6,_0x465830,_0x2de6e5(0x1cf)+_0x383e16),console[_0x2de6e5(0x1df)](_0x2de6e5(0x1e4));}catch(_0xb97c09){console['error'](_0x2de6e5(0x18f),_0xb97c09);}_0x509432[_0x2de6e5(0x1a4)]({'success':!![],'message':_0x2de6e5(0x1d2),'data':{'paymentId':_0x49a936['id'],'status':_0x49a936['status'],'gateway':_0x28264b[_0x2de6e5(0x1ab)],'fileType':_0x3e237e,'fileSize':Math[_0x2de6e5(0x1a6)](_0x228324[_0x2de6e5(0x18e)]*0.75/0x400)+'KB','uploadedAt':_0x49a936[_0x2de6e5(0x198)]}});}catch(_0x140f54){console[_0x2de6e5(0x1c6)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x140f54),_0x509432[_0x2de6e5(0x1de)](0x1f4)[_0x2de6e5(0x1a4)]({'success':![],'error':_0x2de6e5(0x1b8),'details':_0x140f54 instanceof Error?_0x140f54['message']:'Unknown\x20error'});}}async[a8_0x1c90b5(0x19d)](_0x49de84,_0x32657e){const _0x211eec=a8_0x1c90b5;try{const {paymentId:_0x262e14}=_0x49de84[_0x211eec(0x1c4)];console[_0x211eec(0x1df)](_0x211eec(0x1a9)+_0x262e14);const _0x4800bd=await database_1[_0x211eec(0x1ec)]['payment'][_0x211eec(0x1e8)]({'where':{'id':_0x262e14},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4800bd){_0x32657e[_0x211eec(0x1de)](0x194)['json']({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x4800bd['gateway']!=='interac'&&_0x4800bd[_0x211eec(0x1ab)]!=='sepa'){_0x32657e[_0x211eec(0x1de)](0x190)['json']({'success':![],'error':_0x211eec(0x1ba)+_0x4800bd[_0x211eec(0x1ab)]});return;}let _0x538e7a='',_0x444125=_0x4800bd[_0x211eec(0x1cc)],_0x366dbf='';if(_0x4800bd['gateway']==='interac')_0x366dbf='Interac\x20e-Transfer',_0x444125=_0x211eec(0x1c1),_0x538e7a='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x4800bd[_0x211eec(0x1a5)]+'\x20'+_0x444125+_0x211eec(0x1c0);else _0x4800bd[_0x211eec(0x1ab)]===_0x211eec(0x1bc)&&(_0x366dbf=_0x211eec(0x1cd),_0x444125='EUR',_0x538e7a=_0x211eec(0x193)+_0x4800bd[_0x211eec(0x1a5)]+'\x20'+_0x444125+_0x211eec(0x1c0));const _0x283792={'success':!![],'data':{'paymentId':_0x4800bd['id'],'gateway':_0x4800bd[_0x211eec(0x1ab)],'gatewayName':_0x4800bd[_0x211eec(0x1ab)][_0x211eec(0x1d3)](),'transferType':_0x366dbf,'amount':_0x4800bd[_0x211eec(0x1a5)],'currency':_0x444125,'status':_0x4800bd[_0x211eec(0x1de)],'instructions':_0x538e7a,'shopName':_0x4800bd[_0x211eec(0x1a0)][_0x211eec(0x1b6)]||_0x4800bd[_0x211eec(0x1a0)]['username'],'hasProof':![],'proofType':null,'createdAt':_0x4800bd[_0x211eec(0x1ce)],'updatedAt':_0x4800bd[_0x211eec(0x198)],'supportedFileTypes':[_0x211eec(0x1af),_0x211eec(0x1be),_0x211eec(0x192),_0x211eec(0x183),'PDF'],'maxFileSize':'10MB'}};_0x32657e[_0x211eec(0x1a4)](_0x283792);}catch(_0x252807){console[_0x211eec(0x1c6)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x252807),_0x32657e[_0x211eec(0x1de)](0x1f4)[_0x211eec(0x1a4)]({'success':![],'error':_0x211eec(0x1b8),'details':_0x252807 instanceof Error?_0x252807[_0x211eec(0x1e3)]:_0x211eec(0x1c8)});}}}exports[a8_0x1c90b5(0x191)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();