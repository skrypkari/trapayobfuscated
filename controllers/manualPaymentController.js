'use strict';function a11_0x2c9e(){const _0xc4c92b=['round','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','Invalid\x20base64\x20file\x20data','Internal\x20server\x20error','uploadPaymentProof','üìÅ\x20File:\x20','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','üí∞\x20Amount:\x20','name','üåê\x20Customer\x20IP:\x20','telegramBotService','Payment\x20proof\x20for\x20','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','currency','10MB','update','üè™\x20Shop:\x20','43687aNfUAu','getManualPaymentInfo','message','ManualPaymentController','Interac\x20e-Transfer','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','PROCESSING','sepa','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','shop','payment','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','manualPaymentController','split','interac','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','962706IqHasJ','\x20\x20\x20-\x20Gateway:\x20','includes','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','JPEG','EUR','__esModule','json','jpeg','length','761264hVMXub','4556187apJZCT','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','PNG','gateway','PDF','üìÅ\x20File\x20type:\x20','Unknown\x20error','22LQoQfM','SEPA\x20Bank\x20Transfer','File\x20type\x20is\x20required','JPG','toLowerCase','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','.\x20Supported:\x20','../services/telegramBotService','pdf','error','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','\x20\x20\x20-\x20Payment\x20ID:\x20','from','1yyvyeg','File\x20data\x20is\x20required','üì±\x20Admin\x20notification\x20and\x20file\x20sent','KB)\x0a','Markdown','üåê\x20Client\x20IP:\x20','CAD','270996NjDdOw','\x20\x20\x20-\x20File\x20size:\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','defineProperty','592nAPwKc','1819540UenEvN','7867339505','shopId','unknown','amount','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','username','toUpperCase','heic','payment_proof_','sendDirectMessage','png','join','\x20\x20\x20-\x20File\x20type:\x20','default',',\x20size:\x20','‚ùå\x20Upload\x20payment\x20proof\x20error:','üí≥\x20Payment\x20ID:\x20','base64','203358aOWwsB','sendShopFile','üîÑ\x20','Payment\x20ID\x20is\x20required','15TcBrDm','body','status','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','findUnique','log','updatedAt','jpg','Unsupported\x20file\x20type:\x20','Payment\x20proof\x20uploaded\x20successfully'];a11_0x2c9e=function(){return _0xc4c92b;};return a11_0x2c9e();}const a11_0x2f1bfc=a11_0x148a;(function(_0x34f92d,_0x9a4dbd){const _0x5ae977=a11_0x148a,_0x66819b=_0x34f92d();while(!![]){try{const _0x5e8e6e=parseInt(_0x5ae977(0x17e))/0x1*(-parseInt(_0x5ae977(0x185))/0x2)+-parseInt(_0x5ae977(0x19d))/0x3+parseInt(_0x5ae977(0x169))/0x4*(parseInt(_0x5ae977(0x1a1))/0x5)+-parseInt(_0x5ae977(0x15f))/0x6+-parseInt(_0x5ae977(0x14e))/0x7*(-parseInt(_0x5ae977(0x189))/0x8)+-parseInt(_0x5ae977(0x16a))/0x9+parseInt(_0x5ae977(0x18a))/0xa*(parseInt(_0x5ae977(0x171))/0xb);if(_0x5e8e6e===_0x9a4dbd)break;else _0x66819b['push'](_0x66819b['shift']());}catch(_0x5a917d){_0x66819b['push'](_0x66819b['shift']());}}}(a11_0x2c9e,0x80978));var __importDefault=this&&this['__importDefault']||function(_0x39632a){const _0x513b9a=a11_0x148a;return _0x39632a&&_0x39632a[_0x513b9a(0x165)]?_0x39632a:{'default':_0x39632a};};Object[a11_0x2f1bfc(0x188)](exports,a11_0x2f1bfc(0x165),{'value':!![]}),exports['manualPaymentController']=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a11_0x2f1bfc(0x178));function a11_0x148a(_0x446077,_0x5a0009){_0x446077=_0x446077-0x14b;const _0x2c9e26=a11_0x2c9e();let _0x148ac2=_0x2c9e26[_0x446077];return _0x148ac2;}class ManualPaymentController{async[a11_0x2f1bfc(0x1af)](_0xa51e40,_0x4ce4cd){const _0x408a9e=a11_0x2f1bfc;try{const {paymentId:_0x4acb1f,fileData:_0x514bfc,fileType:_0x5a457f,fileName:_0x517c8f}=_0xa51e40[_0x408a9e(0x1a2)],_0x4b5e96=_0xa51e40['ip']||_0xa51e40['connection']?.['remoteAddress']||_0x408a9e(0x18d);console[_0x408a9e(0x1a6)](_0x408a9e(0x1b2)+_0x4acb1f),console[_0x408a9e(0x1a6)](_0x408a9e(0x16f)+_0x5a457f+_0x408a9e(0x199)+(_0x514bfc?Math[_0x408a9e(0x1ab)](_0x514bfc['length']*0.75/0x400):0x0)+'KB'),console[_0x408a9e(0x1a6)](_0x408a9e(0x183)+_0x4b5e96);if(!_0x4acb1f){_0x4ce4cd[_0x408a9e(0x1a3)](0x190)[_0x408a9e(0x166)]({'success':![],'error':_0x408a9e(0x1a0)});return;}if(!_0x514bfc){_0x4ce4cd['status'](0x190)[_0x408a9e(0x166)]({'success':![],'error':_0x408a9e(0x17f)});return;}if(!_0x5a457f){_0x4ce4cd[_0x408a9e(0x1a3)](0x190)['json']({'success':![],'error':_0x408a9e(0x173)});return;}const _0x2a5c67=[_0x408a9e(0x195),_0x408a9e(0x1a8),_0x408a9e(0x167),_0x408a9e(0x192),_0x408a9e(0x179)],_0x5ce5ac=_0x5a457f[_0x408a9e(0x175)]()['replace']('.','');if(!_0x2a5c67[_0x408a9e(0x161)](_0x5ce5ac)){_0x4ce4cd[_0x408a9e(0x1a3)](0x190)[_0x408a9e(0x166)]({'success':![],'error':_0x408a9e(0x1a9)+_0x5a457f+_0x408a9e(0x177)+_0x2a5c67[_0x408a9e(0x196)](',\x20')});return;}const _0x3c9717=0xa*0x400*0x400;if(_0x514bfc[_0x408a9e(0x168)]>_0x3c9717){_0x4ce4cd[_0x408a9e(0x1a3)](0x190)[_0x408a9e(0x166)]({'success':![],'error':_0x408a9e(0x153)});return;}const _0x388abe=await database_1['default']['payment'][_0x408a9e(0x1a5)]({'where':{'id':_0x4acb1f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x388abe){console[_0x408a9e(0x1a6)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x4acb1f),_0x4ce4cd['status'](0x194)['json']({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x388abe[_0x408a9e(0x16d)]!==_0x408a9e(0x15c)&&_0x388abe['gateway']!==_0x408a9e(0x155)){console[_0x408a9e(0x1a6)](_0x408a9e(0x1ac)+_0x388abe[_0x408a9e(0x16d)]),_0x4ce4cd[_0x408a9e(0x1a3)](0x190)[_0x408a9e(0x166)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x388abe[_0x408a9e(0x16d)]});return;}let _0x660d2a=_0x514bfc;_0x514bfc[_0x408a9e(0x161)](',')&&(_0x660d2a=_0x514bfc[_0x408a9e(0x15b)](',')[0x1]);try{Buffer[_0x408a9e(0x17d)](_0x660d2a,_0x408a9e(0x19c));}catch(_0x335e86){_0x4ce4cd[_0x408a9e(0x1a3)](0x190)[_0x408a9e(0x166)]({'success':![],'error':_0x408a9e(0x1ad)});return;}const _0x26b5e3=await database_1[_0x408a9e(0x198)][_0x408a9e(0x158)][_0x408a9e(0x14c)]({'where':{'id':_0x4acb1f},'data':{'status':_0x408a9e(0x154),'updatedAt':new Date()}});console['log'](_0x408a9e(0x176)),console['log'](_0x408a9e(0x17c)+_0x4acb1f),console['log'](_0x408a9e(0x160)+_0x388abe[_0x408a9e(0x16d)][_0x408a9e(0x191)]()),console[_0x408a9e(0x1a6)](_0x408a9e(0x197)+_0x5ce5ac),console[_0x408a9e(0x1a6)](_0x408a9e(0x186)+Math['round'](_0x660d2a[_0x408a9e(0x168)]*0.75/0x400)+'KB'),console[_0x408a9e(0x1a6)](_0x408a9e(0x187));try{const _0x1ed1a1=_0x388abe[_0x408a9e(0x16d)][_0x408a9e(0x191)](),_0x5aeebb=_0x388abe[_0x408a9e(0x157)][_0x408a9e(0x1b4)]||_0x388abe[_0x408a9e(0x157)][_0x408a9e(0x190)],_0x388cf2=Math['round'](_0x660d2a[_0x408a9e(0x168)]*0.75/0x400),_0x1fe96f=_0x408a9e(0x19f)+_0x1ed1a1+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0x408a9e(0x19b)+_0x4acb1f+'\x0a')+(_0x408a9e(0x1b3)+_0x388abe[_0x408a9e(0x18e)]+'\x20'+_0x388abe[_0x408a9e(0x1b9)]+'\x0a')+(_0x408a9e(0x1b0)+_0x5ce5ac[_0x408a9e(0x191)]()+'\x20('+_0x388cf2+'KB)\x0a')+_0x408a9e(0x1b1)+(_0x408a9e(0x1b5)+_0x4b5e96+'\x0a\x0a')+_0x408a9e(0x16b);await telegramBotService_1[_0x408a9e(0x1b6)]['sendShopNotification'](_0x388abe[_0x408a9e(0x18c)],_0x1fe96f,{'parse_mode':_0x408a9e(0x182)});const _0x450878=Buffer[_0x408a9e(0x17d)](_0x660d2a,'base64'),_0x462564=_0x408a9e(0x193)+_0x4acb1f+'.'+_0x5ce5ac;await telegramBotService_1[_0x408a9e(0x1b6)][_0x408a9e(0x19e)](_0x388abe[_0x408a9e(0x18c)],_0x450878,_0x462564,_0x408a9e(0x1b7)+_0x4acb1f),console[_0x408a9e(0x1a6)](_0x408a9e(0x1a4));const _0x3bb281=_0x408a9e(0x18b),_0xc41f8f='üîÑ\x20'+_0x1ed1a1+'\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a'+('üí≥\x20Payment\x20ID:\x20'+_0x4acb1f+'\x0a')+(_0x408a9e(0x14d)+_0x5aeebb+'\x0a')+(_0x408a9e(0x1b3)+_0x388abe[_0x408a9e(0x18e)]+'\x20'+_0x388abe['currency']+'\x0a')+('üìÅ\x20File:\x20'+_0x5ce5ac[_0x408a9e(0x191)]()+'\x20('+_0x388cf2+_0x408a9e(0x181))+_0x408a9e(0x1b1)+(_0x408a9e(0x1b5)+_0x4b5e96+'\x0a\x0a')+_0x408a9e(0x17b);await telegramBotService_1[_0x408a9e(0x1b6)][_0x408a9e(0x194)](parseInt(_0x3bb281),_0xc41f8f),await telegramBotService_1[_0x408a9e(0x1b6)]['sendDirectFile'](parseInt(_0x3bb281),_0x450878,_0x462564,_0x408a9e(0x15e)+_0x4acb1f),console[_0x408a9e(0x1a6)](_0x408a9e(0x180));}catch(_0x3c92a1){console[_0x408a9e(0x17a)](_0x408a9e(0x15d),_0x3c92a1);}_0x4ce4cd['json']({'success':!![],'message':_0x408a9e(0x1aa),'data':{'paymentId':_0x26b5e3['id'],'status':_0x26b5e3[_0x408a9e(0x1a3)],'gateway':_0x388abe[_0x408a9e(0x16d)],'fileType':_0x5ce5ac,'fileSize':Math[_0x408a9e(0x1ab)](_0x660d2a['length']*0.75/0x400)+'KB','uploadedAt':_0x26b5e3[_0x408a9e(0x1a7)]}});}catch(_0x4c56d5){console[_0x408a9e(0x17a)](_0x408a9e(0x19a),_0x4c56d5),_0x4ce4cd[_0x408a9e(0x1a3)](0x1f4)[_0x408a9e(0x166)]({'success':![],'error':_0x408a9e(0x1ae),'details':_0x4c56d5 instanceof Error?_0x4c56d5[_0x408a9e(0x150)]:_0x408a9e(0x170)});}}async[a11_0x2f1bfc(0x14f)](_0x20b7a1,_0x3b5344){const _0x4ddf36=a11_0x2f1bfc;try{const {paymentId:_0x2ed22a}=_0x20b7a1['params'];console[_0x4ddf36(0x1a6)]('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x2ed22a);const _0xf869c1=await database_1[_0x4ddf36(0x198)]['payment'][_0x4ddf36(0x1a5)]({'where':{'id':_0x2ed22a},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xf869c1){_0x3b5344[_0x4ddf36(0x1a3)](0x194)[_0x4ddf36(0x166)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0xf869c1[_0x4ddf36(0x16d)]!==_0x4ddf36(0x15c)&&_0xf869c1[_0x4ddf36(0x16d)]!==_0x4ddf36(0x155)){_0x3b5344[_0x4ddf36(0x1a3)](0x190)[_0x4ddf36(0x166)]({'success':![],'error':_0x4ddf36(0x159)+_0xf869c1[_0x4ddf36(0x16d)]});return;}let _0x5e9321='',_0x43ea28=_0xf869c1['currency'],_0x585a17='';if(_0xf869c1[_0x4ddf36(0x16d)]===_0x4ddf36(0x15c))_0x585a17=_0x4ddf36(0x152),_0x43ea28=_0x4ddf36(0x184),_0x5e9321=_0x4ddf36(0x156)+_0xf869c1[_0x4ddf36(0x18e)]+'\x20'+_0x43ea28+_0x4ddf36(0x1b8);else _0xf869c1['gateway']===_0x4ddf36(0x155)&&(_0x585a17=_0x4ddf36(0x172),_0x43ea28=_0x4ddf36(0x164),_0x5e9321=_0x4ddf36(0x18f)+_0xf869c1[_0x4ddf36(0x18e)]+'\x20'+_0x43ea28+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x29c386={'success':!![],'data':{'paymentId':_0xf869c1['id'],'gateway':_0xf869c1[_0x4ddf36(0x16d)],'gatewayName':_0xf869c1[_0x4ddf36(0x16d)][_0x4ddf36(0x191)](),'transferType':_0x585a17,'amount':_0xf869c1[_0x4ddf36(0x18e)],'currency':_0x43ea28,'status':_0xf869c1['status'],'instructions':_0x5e9321,'shopName':_0xf869c1[_0x4ddf36(0x157)][_0x4ddf36(0x1b4)]||_0xf869c1[_0x4ddf36(0x157)][_0x4ddf36(0x190)],'hasProof':![],'proofType':null,'createdAt':_0xf869c1['createdAt'],'updatedAt':_0xf869c1['updatedAt'],'supportedFileTypes':[_0x4ddf36(0x16c),_0x4ddf36(0x174),_0x4ddf36(0x163),'HEIC',_0x4ddf36(0x16e)],'maxFileSize':_0x4ddf36(0x14b)}};_0x3b5344[_0x4ddf36(0x166)](_0x29c386);}catch(_0x1d800f){console[_0x4ddf36(0x17a)](_0x4ddf36(0x162),_0x1d800f),_0x3b5344[_0x4ddf36(0x1a3)](0x1f4)[_0x4ddf36(0x166)]({'success':![],'error':_0x4ddf36(0x1ae),'details':_0x1d800f instanceof Error?_0x1d800f[_0x4ddf36(0x150)]:_0x4ddf36(0x170)});}}}exports[a11_0x2f1bfc(0x151)]=ManualPaymentController,exports[a11_0x2f1bfc(0x15a)]=new ManualPaymentController();