'use strict';const a11_0x59cac3=a11_0x3834;(function(_0x5ca215,_0xe411b9){const _0x115532=a11_0x3834,_0x20375c=_0x5ca215();while(!![]){try{const _0x36c431=parseInt(_0x115532(0x75))/0x1+-parseInt(_0x115532(0x9b))/0x2*(-parseInt(_0x115532(0x7a))/0x3)+-parseInt(_0x115532(0xaa))/0x4*(parseInt(_0x115532(0xae))/0x5)+-parseInt(_0x115532(0x9e))/0x6*(-parseInt(_0x115532(0xac))/0x7)+parseInt(_0x115532(0x85))/0x8+parseInt(_0x115532(0xbe))/0x9*(parseInt(_0x115532(0x74))/0xa)+-parseInt(_0x115532(0x77))/0xb*(parseInt(_0x115532(0xd1))/0xc);if(_0x36c431===_0xe411b9)break;else _0x20375c['push'](_0x20375c['shift']());}catch(_0x1aeb4a){_0x20375c['push'](_0x20375c['shift']());}}}(a11_0x43e8,0x1c2e8));function a11_0x3834(_0x4bf1e6,_0x181f43){_0x4bf1e6=_0x4bf1e6-0x74;const _0x43e8a6=a11_0x43e8();let _0x3834f1=_0x43e8a6[_0x4bf1e6];return _0x3834f1;}function a11_0x43e8(){const _0x5dba07=['sendDirectFile','toUpperCase','Payment\x20proof\x20for\x20','toLowerCase','updatedAt','Payment\x20not\x20found','../config/database','__esModule','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','400IWEiHB','File\x20data\x20is\x20required','7LeYDsO','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','10535aNNwHf','HEIC','PDF','getManualPaymentInfo',',\x20size:\x20','Interac\x20e-Transfer','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','ManualPaymentController','join','__importDefault','payment','üè™\x20Shop:\x20','remoteAddress','pdf','üìã\x20Get\x20manual\x20payment\x20info:\x20','212418VQaVTv','length','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','Unknown\x20error','unknown','7867339505','split','body','üåê\x20Customer\x20IP:\x20','shop','defineProperty','telegramBotService','message','username','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','EUR','sepa','üìÅ\x20File:\x20','312EUhCpB','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','default','\x20\x20\x20-\x20File\x20size:\x20','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','interac','update','heic','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','currency','png','from','SEPA\x20Bank\x20Transfer','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','manualPaymentController','30bFzXwi','52155XGAYpA','.\x20Supported:\x20','128711BQSVwq','error','Unsupported\x20file\x20type:\x20','9UhhLzI','params','üí≥\x20Payment\x20ID:\x20','CAD','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','round','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','base64','replace','shopId','amount','1244456NchpWD','\x20\x20\x20-\x20Gateway:\x20','log','status','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','name','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','üìÅ\x20File\x20type:\x20','\x20\x20\x20-\x20Payment\x20ID:\x20','‚ùå\x20Payment\x20not\x20found:\x20','gateway','Payment\x20ID\x20is\x20required','jpeg','\x20\x20\x20-\x20File\x20type:\x20','\x20Payment\x20Proof\x20Received\x0a\x0a','json','uploadPaymentProof','../services/telegramBotService','KB)\x0a','üí∞\x20Amount:\x20','payment_proof_','JPEG','97406ATGnEa','jpg','createdAt','1234386nkkftF','sendDirectMessage','10MB'];a11_0x43e8=function(){return _0x5dba07;};return a11_0x43e8();}var __importDefault=this&&this[a11_0x59cac3(0xb8)]||function(_0x3735b0){const _0x53cb98=a11_0x59cac3;return _0x3735b0&&_0x3735b0[_0x53cb98(0xa8)]?_0x3735b0:{'default':_0x3735b0};};Object[a11_0x59cac3(0xc9)](exports,a11_0x59cac3(0xa8),{'value':!![]}),exports[a11_0x59cac3(0xdf)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a11_0x59cac3(0xa7))),telegramBotService_1=require(a11_0x59cac3(0x96));class ManualPaymentController{async[a11_0x59cac3(0x95)](_0xd0b34c,_0x1659c1){const _0x3a3a2b=a11_0x59cac3;try{const {paymentId:_0x2daf12,fileData:_0xcf8d18,fileType:_0x4d3a24,fileName:_0x51595e}=_0xd0b34c[_0x3a3a2b(0xc6)],_0x28a0c2=_0xd0b34c['ip']||_0xd0b34c['connection']?.[_0x3a3a2b(0xbb)]||_0x3a3a2b(0xc3);console[_0x3a3a2b(0x87)](_0x3a3a2b(0xa9)+_0x2daf12),console[_0x3a3a2b(0x87)](_0x3a3a2b(0x8c)+_0x4d3a24+_0x3a3a2b(0xb2)+(_0xcf8d18?Math['round'](_0xcf8d18[_0x3a3a2b(0xbf)]*0.75/0x400):0x0)+'KB'),console[_0x3a3a2b(0x87)]('üåê\x20Client\x20IP:\x20'+_0x28a0c2);if(!_0x2daf12){_0x1659c1[_0x3a3a2b(0x88)](0x190)[_0x3a3a2b(0x94)]({'success':![],'error':_0x3a3a2b(0x90)});return;}if(!_0xcf8d18){_0x1659c1['status'](0x190)[_0x3a3a2b(0x94)]({'success':![],'error':_0x3a3a2b(0xab)});return;}if(!_0x4d3a24){_0x1659c1['status'](0x190)[_0x3a3a2b(0x94)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x2b0f85=[_0x3a3a2b(0xdb),_0x3a3a2b(0x9c),_0x3a3a2b(0x91),_0x3a3a2b(0xd8),_0x3a3a2b(0xbc)],_0x3d9bfb=_0x4d3a24[_0x3a3a2b(0xa4)]()[_0x3a3a2b(0x82)]('.','');if(!_0x2b0f85['includes'](_0x3d9bfb)){_0x1659c1[_0x3a3a2b(0x88)](0x190)[_0x3a3a2b(0x94)]({'success':![],'error':_0x3a3a2b(0x79)+_0x4d3a24+_0x3a3a2b(0x76)+_0x2b0f85[_0x3a3a2b(0xb7)](',\x20')});return;}const _0x56cc34=0xa*0x400*0x400;if(_0xcf8d18[_0x3a3a2b(0xbf)]>_0x56cc34){_0x1659c1['status'](0x190)[_0x3a3a2b(0x94)]({'success':![],'error':_0x3a3a2b(0xd5)});return;}const _0x56c481=await database_1[_0x3a3a2b(0xd3)][_0x3a3a2b(0xb9)]['findUnique']({'where':{'id':_0x2daf12},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x56c481){console['log'](_0x3a3a2b(0x8e)+_0x2daf12),_0x1659c1[_0x3a3a2b(0x88)](0x194)['json']({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x56c481[_0x3a3a2b(0x8f)]!==_0x3a3a2b(0xd6)&&_0x56c481[_0x3a3a2b(0x8f)]!==_0x3a3a2b(0xcf)){console['log']('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x56c481[_0x3a3a2b(0x8f)]),_0x1659c1[_0x3a3a2b(0x88)](0x190)[_0x3a3a2b(0x94)]({'success':![],'error':_0x3a3a2b(0x8b)+_0x56c481[_0x3a3a2b(0x8f)]});return;}let _0x213b2b=_0xcf8d18;_0xcf8d18['includes'](',')&&(_0x213b2b=_0xcf8d18[_0x3a3a2b(0xc5)](',')[0x1]);try{Buffer[_0x3a3a2b(0xdc)](_0x213b2b,_0x3a3a2b(0x81));}catch(_0x549908){_0x1659c1[_0x3a3a2b(0x88)](0x190)[_0x3a3a2b(0x94)]({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x38979b=await database_1[_0x3a3a2b(0xd3)][_0x3a3a2b(0xb9)][_0x3a3a2b(0xd7)]({'where':{'id':_0x2daf12},'data':{'status':'PROCESSING','updatedAt':new Date()}});console['log'](_0x3a3a2b(0xc1)),console[_0x3a3a2b(0x87)](_0x3a3a2b(0x8d)+_0x2daf12),console[_0x3a3a2b(0x87)](_0x3a3a2b(0x86)+_0x56c481['gateway'][_0x3a3a2b(0xa2)]()),console[_0x3a3a2b(0x87)](_0x3a3a2b(0x92)+_0x3d9bfb),console[_0x3a3a2b(0x87)](_0x3a3a2b(0xd4)+Math[_0x3a3a2b(0x7f)](_0x213b2b[_0x3a3a2b(0xbf)]*0.75/0x400)+'KB'),console[_0x3a3a2b(0x87)](_0x3a3a2b(0xb5));try{const _0x5e57b8=_0x56c481[_0x3a3a2b(0x8f)][_0x3a3a2b(0xa2)](),_0x28a365=_0x56c481[_0x3a3a2b(0xc8)][_0x3a3a2b(0x8a)]||_0x56c481[_0x3a3a2b(0xc8)][_0x3a3a2b(0xcc)],_0x3dab38=Math['round'](_0x213b2b['length']*0.75/0x400),_0x4da692='üîÑ\x20'+_0x5e57b8+_0x3a3a2b(0x93)+(_0x3a3a2b(0x7c)+_0x2daf12+'\x0a')+(_0x3a3a2b(0x98)+_0x56c481[_0x3a3a2b(0x84)]+'\x20'+_0x56c481['currency']+'\x0a')+(_0x3a3a2b(0xd0)+_0x3d9bfb[_0x3a3a2b(0xa2)]()+'\x20('+_0x3dab38+'KB)\x0a')+_0x3a3a2b(0xd2)+(_0x3a3a2b(0xc7)+_0x28a0c2+'\x0a\x0a')+_0x3a3a2b(0xcd);await telegramBotService_1[_0x3a3a2b(0xca)]['sendShopNotification'](_0x56c481[_0x3a3a2b(0x83)],_0x4da692,{'parse_mode':'Markdown'});const _0x46ad76=Buffer[_0x3a3a2b(0xdc)](_0x213b2b,_0x3a3a2b(0x81)),_0x4ae990=_0x3a3a2b(0x99)+_0x2daf12+'.'+_0x3d9bfb;await telegramBotService_1[_0x3a3a2b(0xca)]['sendShopFile'](_0x56c481[_0x3a3a2b(0x83)],_0x46ad76,_0x4ae990,_0x3a3a2b(0xa3)+_0x2daf12),console[_0x3a3a2b(0x87)]('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x5b681d=_0x3a3a2b(0xc4),_0x29acd7='üîÑ\x20'+_0x5e57b8+_0x3a3a2b(0x80)+('üí≥\x20Payment\x20ID:\x20'+_0x2daf12+'\x0a')+(_0x3a3a2b(0xba)+_0x28a365+'\x0a')+(_0x3a3a2b(0x98)+_0x56c481[_0x3a3a2b(0x84)]+'\x20'+_0x56c481[_0x3a3a2b(0xda)]+'\x0a')+(_0x3a3a2b(0xd0)+_0x3d9bfb[_0x3a3a2b(0xa2)]()+'\x20('+_0x3dab38+_0x3a3a2b(0x97))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+('üåê\x20Customer\x20IP:\x20'+_0x28a0c2+'\x0a\x0a')+_0x3a3a2b(0xad);await telegramBotService_1[_0x3a3a2b(0xca)][_0x3a3a2b(0x9f)](parseInt(_0x5b681d),_0x29acd7),await telegramBotService_1[_0x3a3a2b(0xca)][_0x3a3a2b(0xa1)](parseInt(_0x5b681d),_0x46ad76,_0x4ae990,_0x3a3a2b(0x7e)+_0x2daf12),console[_0x3a3a2b(0x87)]('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x235363){console[_0x3a3a2b(0x78)](_0x3a3a2b(0xb4),_0x235363);}_0x1659c1['json']({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x38979b['id'],'status':_0x38979b[_0x3a3a2b(0x88)],'gateway':_0x56c481['gateway'],'fileType':_0x3d9bfb,'fileSize':Math[_0x3a3a2b(0x7f)](_0x213b2b[_0x3a3a2b(0xbf)]*0.75/0x400)+'KB','uploadedAt':_0x38979b[_0x3a3a2b(0xa5)]}});}catch(_0x4ad7a9){console['error']('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x4ad7a9),_0x1659c1[_0x3a3a2b(0x88)](0x1f4)[_0x3a3a2b(0x94)]({'success':![],'error':'Internal\x20server\x20error','details':_0x4ad7a9 instanceof Error?_0x4ad7a9[_0x3a3a2b(0xcb)]:_0x3a3a2b(0xc2)});}}async[a11_0x59cac3(0xb1)](_0x58eed0,_0x2a731f){const _0x11df27=a11_0x59cac3;try{const {paymentId:_0x16661e}=_0x58eed0[_0x11df27(0x7b)];console[_0x11df27(0x87)](_0x11df27(0xbd)+_0x16661e);const _0x1426e0=await database_1[_0x11df27(0xd3)]['payment']['findUnique']({'where':{'id':_0x16661e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1426e0){_0x2a731f[_0x11df27(0x88)](0x194)[_0x11df27(0x94)]({'success':![],'error':_0x11df27(0xa6)});return;}if(_0x1426e0['gateway']!==_0x11df27(0xd6)&&_0x1426e0[_0x11df27(0x8f)]!=='sepa'){_0x2a731f[_0x11df27(0x88)](0x190)[_0x11df27(0x94)]({'success':![],'error':_0x11df27(0xc0)+_0x1426e0[_0x11df27(0x8f)]});return;}let _0x25e28b='',_0x37693c=_0x1426e0[_0x11df27(0xda)],_0x18f2c4='';if(_0x1426e0[_0x11df27(0x8f)]===_0x11df27(0xd6))_0x18f2c4=_0x11df27(0xb3),_0x37693c=_0x11df27(0x7d),_0x25e28b=_0x11df27(0xde)+_0x1426e0[_0x11df27(0x84)]+'\x20'+_0x37693c+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.';else _0x1426e0[_0x11df27(0x8f)]===_0x11df27(0xcf)&&(_0x18f2c4=_0x11df27(0xdd),_0x37693c=_0x11df27(0xce),_0x25e28b=_0x11df27(0x89)+_0x1426e0[_0x11df27(0x84)]+'\x20'+_0x37693c+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x1229c3={'success':!![],'data':{'paymentId':_0x1426e0['id'],'gateway':_0x1426e0[_0x11df27(0x8f)],'gatewayName':_0x1426e0['gateway']['toUpperCase'](),'transferType':_0x18f2c4,'amount':_0x1426e0[_0x11df27(0x84)],'currency':_0x37693c,'status':_0x1426e0[_0x11df27(0x88)],'instructions':_0x25e28b,'shopName':_0x1426e0[_0x11df27(0xc8)]['name']||_0x1426e0[_0x11df27(0xc8)][_0x11df27(0xcc)],'hasProof':![],'proofType':null,'createdAt':_0x1426e0[_0x11df27(0x9d)],'updatedAt':_0x1426e0[_0x11df27(0xa5)],'supportedFileTypes':['PNG','JPG',_0x11df27(0x9a),_0x11df27(0xaf),_0x11df27(0xb0)],'maxFileSize':_0x11df27(0xa0)}};_0x2a731f[_0x11df27(0x94)](_0x1229c3);}catch(_0xe38f5e){console[_0x11df27(0x78)](_0x11df27(0xd9),_0xe38f5e),_0x2a731f['status'](0x1f4)['json']({'success':![],'error':'Internal\x20server\x20error','details':_0xe38f5e instanceof Error?_0xe38f5e[_0x11df27(0xcb)]:_0x11df27(0xc2)});}}}exports[a11_0x59cac3(0xb6)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();