'use strict';const a11_0x1f38b4=a11_0xbf9d;function a11_0x28c6(){const _0x127591=['\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','PROCESSING','KB)\x0a','SEPA\x20Bank\x20Transfer','üåê\x20Client\x20IP:\x20','params','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','PDF','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','from','\x20Payment\x20Proof\x20Received\x0a\x0a','JPG','toLowerCase','üìÅ\x20File\x20type:\x20','base64','üí≥\x20Payment\x20ID:\x20','jpg','toUpperCase','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','üí∞\x20Amount:\x20','gateway','name','üåê\x20Customer\x20IP:\x20','default','amount','üìÅ\x20File:\x20','payment_proof_','includes','__esModule','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','Unsupported\x20file\x20type:\x20',',\x20size:\x20','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','length','round','jpeg','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','json','40JApzAQ','createdAt','7867339505','‚ùå\x20Payment\x20not\x20found:\x20','Payment\x20not\x20found','PNG','updatedAt','split','3813984tkBxbs','51566YbDWGX','CAD','Interac\x20e-Transfer','2180596PogpUX','9231528OEioVe','uploadPaymentProof','üîÑ\x20','.\x20Supported:\x20','JPEG','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','1059720bDbYYk','unknown','üìã\x20Get\x20manual\x20payment\x20info:\x20','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','../services/telegramBotService','EUR','1399482nhbost','shop','defineProperty','log','update','\x20\x20\x20-\x20Gateway:\x20','Payment\x20proof\x20for\x20','sendShopNotification','pdf','42BekpWT','manualPaymentController','telegramBotService','shopId','findUnique','‚ùå\x20Upload\x20payment\x20proof\x20error:','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','payment','remoteAddress','Unknown\x20error','üè™\x20Shop:\x20','currency','error','interac','\x20\x20\x20-\x20File\x20size:\x20','__importDefault','\x20\x20\x20-\x20Payment\x20ID:\x20','sepa','Payment\x20ID\x20is\x20required','File\x20data\x20is\x20required','\x20\x20\x20-\x20File\x20type:\x20','Internal\x20server\x20error','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','message','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','ManualPaymentController','20021895ZmWneD','username','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','join','status'];a11_0x28c6=function(){return _0x127591;};return a11_0x28c6();}(function(_0x265d92,_0x493325){const _0x5111b0=a11_0xbf9d,_0xeeae2a=_0x265d92();while(!![]){try{const _0x5c9da=parseInt(_0x5111b0(0x19e))/0x1*(-parseInt(_0x5111b0(0x1a7))/0x2)+parseInt(_0x5111b0(0x1a6))/0x3+parseInt(_0x5111b0(0x1aa))/0x4+-parseInt(_0x5111b0(0x1b1))/0x5+parseInt(_0x5111b0(0x1c1))/0x6*(parseInt(_0x5111b0(0x1b8))/0x7)+parseInt(_0x5111b0(0x1ab))/0x8+-parseInt(_0x5111b0(0x1db))/0x9;if(_0x5c9da===_0x493325)break;else _0xeeae2a['push'](_0xeeae2a['shift']());}catch(_0x3aed66){_0xeeae2a['push'](_0xeeae2a['shift']());}}}(a11_0x28c6,0xdc35d));var __importDefault=this&&this[a11_0x1f38b4(0x1d0)]||function(_0x22df8c){const _0x285b9a=a11_0x1f38b4;return _0x22df8c&&_0x22df8c[_0x285b9a(0x194)]?_0x22df8c:{'default':_0x22df8c};};function a11_0xbf9d(_0x547a31,_0x1d2552){_0x547a31=_0x547a31-0x187;const _0x28c6d9=a11_0x28c6();let _0xbf9df=_0x28c6d9[_0x547a31];return _0xbf9df;}Object[a11_0x1f38b4(0x1ba)](exports,a11_0x1f38b4(0x194),{'value':!![]}),exports[a11_0x1f38b4(0x1c2)]=exports[a11_0x1f38b4(0x1da)]=void 0x0;const database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a11_0x1f38b4(0x1b6));class ManualPaymentController{async[a11_0x1f38b4(0x1ac)](_0x6aa2f1,_0x115215){const _0x5a380b=a11_0x1f38b4;try{const {paymentId:_0x44acec,fileData:_0x14f34b,fileType:_0x1b7dab,fileName:_0x466595}=_0x6aa2f1['body'],_0x56740f=_0x6aa2f1['ip']||_0x6aa2f1['connection']?.[_0x5a380b(0x1c9)]||_0x5a380b(0x1b2);console['log'](_0x5a380b(0x1dd)+_0x44acec),console[_0x5a380b(0x1bb)](_0x5a380b(0x1ee)+_0x1b7dab+_0x5a380b(0x197)+(_0x14f34b?Math[_0x5a380b(0x19a)](_0x14f34b[_0x5a380b(0x199)]*0.75/0x400):0x0)+'KB'),console[_0x5a380b(0x1bb)](_0x5a380b(0x1e5)+_0x56740f);if(!_0x44acec){_0x115215[_0x5a380b(0x1df)](0x190)['json']({'success':![],'error':_0x5a380b(0x1d3)});return;}if(!_0x14f34b){_0x115215['status'](0x190)[_0x5a380b(0x19d)]({'success':![],'error':_0x5a380b(0x1d4)});return;}if(!_0x1b7dab){_0x115215['status'](0x190)[_0x5a380b(0x19d)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x310cbf=['png',_0x5a380b(0x188),_0x5a380b(0x19b),'heic',_0x5a380b(0x1c0)],_0x56e4fe=_0x1b7dab[_0x5a380b(0x1ed)]()['replace']('.','');if(!_0x310cbf['includes'](_0x56e4fe)){_0x115215[_0x5a380b(0x1df)](0x190)[_0x5a380b(0x19d)]({'success':![],'error':_0x5a380b(0x196)+_0x1b7dab+_0x5a380b(0x1ae)+_0x310cbf[_0x5a380b(0x1de)](',\x20')});return;}const _0x4b01d1=0xa*0x400*0x400;if(_0x14f34b[_0x5a380b(0x199)]>_0x4b01d1){_0x115215[_0x5a380b(0x1df)](0x190)[_0x5a380b(0x19d)]({'success':![],'error':_0x5a380b(0x1b0)});return;}const _0x1ee3a9=await database_1[_0x5a380b(0x18f)][_0x5a380b(0x1c8)][_0x5a380b(0x1c5)]({'where':{'id':_0x44acec},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1ee3a9){console[_0x5a380b(0x1bb)](_0x5a380b(0x1a1)+_0x44acec),_0x115215[_0x5a380b(0x1df)](0x194)[_0x5a380b(0x19d)]({'success':![],'error':_0x5a380b(0x1a2)});return;}if(_0x1ee3a9[_0x5a380b(0x18c)]!==_0x5a380b(0x1ce)&&_0x1ee3a9[_0x5a380b(0x18c)]!==_0x5a380b(0x1d2)){console[_0x5a380b(0x1bb)](_0x5a380b(0x1b5)+_0x1ee3a9[_0x5a380b(0x18c)]),_0x115215[_0x5a380b(0x1df)](0x190)[_0x5a380b(0x19d)]({'success':![],'error':_0x5a380b(0x1d9)+_0x1ee3a9[_0x5a380b(0x18c)]});return;}let _0x48cade=_0x14f34b;_0x14f34b[_0x5a380b(0x193)](',')&&(_0x48cade=_0x14f34b[_0x5a380b(0x1a5)](',')[0x1]);try{Buffer['from'](_0x48cade,_0x5a380b(0x1ef));}catch(_0x412067){_0x115215['status'](0x190)[_0x5a380b(0x19d)]({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x4d5309=await database_1[_0x5a380b(0x18f)][_0x5a380b(0x1c8)][_0x5a380b(0x1bc)]({'where':{'id':_0x44acec},'data':{'status':_0x5a380b(0x1e2),'updatedAt':new Date()}});console[_0x5a380b(0x1bb)](_0x5a380b(0x1c7)),console[_0x5a380b(0x1bb)](_0x5a380b(0x1d1)+_0x44acec),console[_0x5a380b(0x1bb)](_0x5a380b(0x1bd)+_0x1ee3a9['gateway']['toUpperCase']()),console[_0x5a380b(0x1bb)](_0x5a380b(0x1d5)+_0x56e4fe),console[_0x5a380b(0x1bb)](_0x5a380b(0x1cf)+Math[_0x5a380b(0x19a)](_0x48cade[_0x5a380b(0x199)]*0.75/0x400)+'KB'),console[_0x5a380b(0x1bb)]('\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING');try{const _0x48c2db=_0x1ee3a9[_0x5a380b(0x18c)][_0x5a380b(0x189)](),_0x5996f5=_0x1ee3a9[_0x5a380b(0x1b9)][_0x5a380b(0x18d)]||_0x1ee3a9[_0x5a380b(0x1b9)][_0x5a380b(0x1dc)],_0x9e5b4d=Math[_0x5a380b(0x19a)](_0x48cade['length']*0.75/0x400),_0x3222ea=_0x5a380b(0x1ad)+_0x48c2db+_0x5a380b(0x1eb)+(_0x5a380b(0x187)+_0x44acec+'\x0a')+(_0x5a380b(0x18b)+_0x1ee3a9['amount']+'\x20'+_0x1ee3a9[_0x5a380b(0x1cc)]+'\x0a')+(_0x5a380b(0x191)+_0x56e4fe[_0x5a380b(0x189)]()+'\x20('+_0x9e5b4d+_0x5a380b(0x1e3))+_0x5a380b(0x19c)+(_0x5a380b(0x18e)+_0x56740f+'\x0a\x0a')+_0x5a380b(0x18a);await telegramBotService_1['telegramBotService'][_0x5a380b(0x1bf)](_0x1ee3a9[_0x5a380b(0x1c4)],_0x3222ea,{'parse_mode':'Markdown'});const _0xbffa03=Buffer[_0x5a380b(0x1ea)](_0x48cade,_0x5a380b(0x1ef)),_0x9cb8fe=_0x5a380b(0x192)+_0x44acec+'.'+_0x56e4fe;await telegramBotService_1[_0x5a380b(0x1c3)]['sendShopFile'](_0x1ee3a9[_0x5a380b(0x1c4)],_0xbffa03,_0x9cb8fe,_0x5a380b(0x1be)+_0x44acec),console[_0x5a380b(0x1bb)](_0x5a380b(0x198));const _0x407cb3=_0x5a380b(0x1a0),_0x53a806='üîÑ\x20'+_0x48c2db+_0x5a380b(0x1e7)+(_0x5a380b(0x187)+_0x44acec+'\x0a')+(_0x5a380b(0x1cb)+_0x5996f5+'\x0a')+(_0x5a380b(0x18b)+_0x1ee3a9[_0x5a380b(0x190)]+'\x20'+_0x1ee3a9[_0x5a380b(0x1cc)]+'\x0a')+(_0x5a380b(0x191)+_0x56e4fe[_0x5a380b(0x189)]()+'\x20('+_0x9e5b4d+'KB)\x0a')+_0x5a380b(0x19c)+(_0x5a380b(0x18e)+_0x56740f+'\x0a\x0a')+'‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.';await telegramBotService_1['telegramBotService']['sendDirectMessage'](parseInt(_0x407cb3),_0x53a806),await telegramBotService_1['telegramBotService']['sendDirectFile'](parseInt(_0x407cb3),_0xbffa03,_0x9cb8fe,_0x5a380b(0x195)+_0x44acec),console[_0x5a380b(0x1bb)]('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x34fa8b){console[_0x5a380b(0x1cd)](_0x5a380b(0x1e1),_0x34fa8b);}_0x115215[_0x5a380b(0x19d)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x4d5309['id'],'status':_0x4d5309[_0x5a380b(0x1df)],'gateway':_0x1ee3a9[_0x5a380b(0x18c)],'fileType':_0x56e4fe,'fileSize':Math['round'](_0x48cade[_0x5a380b(0x199)]*0.75/0x400)+'KB','uploadedAt':_0x4d5309[_0x5a380b(0x1a4)]}});}catch(_0x42885a){console[_0x5a380b(0x1cd)](_0x5a380b(0x1c6),_0x42885a),_0x115215[_0x5a380b(0x1df)](0x1f4)[_0x5a380b(0x19d)]({'success':![],'error':_0x5a380b(0x1d6),'details':_0x42885a instanceof Error?_0x42885a[_0x5a380b(0x1d8)]:_0x5a380b(0x1ca)});}}async['getManualPaymentInfo'](_0x55a072,_0x412f1c){const _0x31cc1b=a11_0x1f38b4;try{const {paymentId:_0x9eacad}=_0x55a072[_0x31cc1b(0x1e6)];console[_0x31cc1b(0x1bb)](_0x31cc1b(0x1b3)+_0x9eacad);const _0x1a7370=await database_1[_0x31cc1b(0x18f)][_0x31cc1b(0x1c8)][_0x31cc1b(0x1c5)]({'where':{'id':_0x9eacad},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1a7370){_0x412f1c['status'](0x194)[_0x31cc1b(0x19d)]({'success':![],'error':_0x31cc1b(0x1a2)});return;}if(_0x1a7370['gateway']!==_0x31cc1b(0x1ce)&&_0x1a7370[_0x31cc1b(0x18c)]!=='sepa'){_0x412f1c[_0x31cc1b(0x1df)](0x190)['json']({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x1a7370[_0x31cc1b(0x18c)]});return;}let _0x163af4='',_0x37ba11=_0x1a7370['currency'],_0x172326='';if(_0x1a7370[_0x31cc1b(0x18c)]===_0x31cc1b(0x1ce))_0x172326=_0x31cc1b(0x1a9),_0x37ba11=_0x31cc1b(0x1a8),_0x163af4=_0x31cc1b(0x1e9)+_0x1a7370['amount']+'\x20'+_0x37ba11+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.';else _0x1a7370[_0x31cc1b(0x18c)]===_0x31cc1b(0x1d2)&&(_0x172326=_0x31cc1b(0x1e4),_0x37ba11=_0x31cc1b(0x1b7),_0x163af4=_0x31cc1b(0x1d7)+_0x1a7370[_0x31cc1b(0x190)]+'\x20'+_0x37ba11+_0x31cc1b(0x1e0));const _0x537e52={'success':!![],'data':{'paymentId':_0x1a7370['id'],'gateway':_0x1a7370[_0x31cc1b(0x18c)],'gatewayName':_0x1a7370[_0x31cc1b(0x18c)]['toUpperCase'](),'transferType':_0x172326,'amount':_0x1a7370[_0x31cc1b(0x190)],'currency':_0x37ba11,'status':_0x1a7370[_0x31cc1b(0x1df)],'instructions':_0x163af4,'shopName':_0x1a7370['shop'][_0x31cc1b(0x18d)]||_0x1a7370['shop'][_0x31cc1b(0x1dc)],'hasProof':![],'proofType':null,'createdAt':_0x1a7370[_0x31cc1b(0x19f)],'updatedAt':_0x1a7370['updatedAt'],'supportedFileTypes':[_0x31cc1b(0x1a3),_0x31cc1b(0x1ec),_0x31cc1b(0x1af),'HEIC',_0x31cc1b(0x1e8)],'maxFileSize':'10MB'}};_0x412f1c['json'](_0x537e52);}catch(_0x48aa56){console[_0x31cc1b(0x1cd)](_0x31cc1b(0x1b4),_0x48aa56),_0x412f1c[_0x31cc1b(0x1df)](0x1f4)[_0x31cc1b(0x19d)]({'success':![],'error':_0x31cc1b(0x1d6),'details':_0x48aa56 instanceof Error?_0x48aa56[_0x31cc1b(0x1d8)]:'Unknown\x20error'});}}}exports['ManualPaymentController']=ManualPaymentController,exports[a11_0x1f38b4(0x1c2)]=new ManualPaymentController();