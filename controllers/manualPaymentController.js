'use strict';const a8_0x432922=a8_0x96cd;(function(_0x560c3e,_0x3d94fe){const _0x80fb18=a8_0x96cd,_0x35490b=_0x560c3e();while(!![]){try{const _0x3b3102=parseInt(_0x80fb18(0x1ff))/0x1+parseInt(_0x80fb18(0x20f))/0x2*(-parseInt(_0x80fb18(0x1da))/0x3)+parseInt(_0x80fb18(0x1c8))/0x4+parseInt(_0x80fb18(0x1d4))/0x5+-parseInt(_0x80fb18(0x1f9))/0x6+parseInt(_0x80fb18(0x203))/0x7*(parseInt(_0x80fb18(0x1ee))/0x8)+-parseInt(_0x80fb18(0x1f2))/0x9*(parseInt(_0x80fb18(0x1ef))/0xa);if(_0x3b3102===_0x3d94fe)break;else _0x35490b['push'](_0x35490b['shift']());}catch(_0x344e06){_0x35490b['push'](_0x35490b['shift']());}}}(a8_0x3547,0x851bf));function a8_0x96cd(_0x5499c8,_0x4200bd){const _0x3547a4=a8_0x3547();return a8_0x96cd=function(_0x96cd8e,_0x207be7){_0x96cd8e=_0x96cd8e-0x1c7;let _0x38d0de=_0x3547a4[_0x96cd8e];return _0x38d0de;},a8_0x96cd(_0x5499c8,_0x4200bd);}var __importDefault=this&&this[a8_0x432922(0x206)]||function(_0x3661d1){const _0x1fda04=a8_0x432922;return _0x3661d1&&_0x3661d1[_0x1fda04(0x1d0)]?_0x3661d1:{'default':_0x3661d1};};function a8_0x3547(){const _0x345f84=['includes','from','findUnique','body','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','default','gateway','username','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','round','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','Internal\x20server\x20error','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','jpeg','8bzWziG','5628130qBhcVu','Payment\x20proof\x20can\x20only\x20be\x20uploaded\x20for\x20PENDING\x20payments.\x20Current\x20status:\x20','\x20\x20\x20-\x20Payment\x20ID:\x20','9xAbyTO','json','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','SEPA\x20Bank\x20Transfer','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','status','JPEG','2247666gOLXrl','toLowerCase','uploadPaymentProof','name','../config/database','toUpperCase','488473CIKISx','payment','PDF','\x20\x20\x20-\x20File\x20size:\x20','4207364pfdOFb','message','amount','__importDefault','Unknown\x20error','params','üìã\x20Get\x20manual\x20payment\x20info:\x20','manualPaymentController','base64','log','Unsupported\x20file\x20type:\x20','createdAt','7402aMPTMr','shop','getManualPaymentInfo','ManualPaymentController','\x20\x20\x20-\x20File\x20type:\x20','üìÅ\x20File\x20type:\x20','Payment\x20not\x20found','remoteAddress','error','HEIC','2580996oaNlVN','‚ùå\x20Payment\x20not\x20found:\x20','‚ùå\x20Invalid\x20payment\x20status:\x20','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','File\x20data\x20is\x20required',',\x20size:\x20','.\x20Supported:\x20','replace','__esModule','\x20\x20\x20-\x20Gateway:\x20','jpg','heic','3606140zHhnvE','connection','JPG','sepa','PNG','interac','789SNCrFG','Payment\x20proof\x20uploaded\x20successfully','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','split','Payment\x20ID\x20is\x20required','length'];a8_0x3547=function(){return _0x345f84;};return a8_0x3547();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a8_0x432922(0x20a)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a8_0x432922(0x1fd)));class ManualPaymentController{async[a8_0x432922(0x1fb)](_0x5f2ffa,_0x1bd157){const _0x44a43=a8_0x432922;try{const {paymentId:_0x4e935e,fileData:_0x2aaba1,fileType:_0x529db9,fileName:_0x3b0764}=_0x5f2ffa[_0x44a43(0x1e3)],_0x134874=_0x5f2ffa['ip']||_0x5f2ffa[_0x44a43(0x1d5)]?.[_0x44a43(0x216)]||'unknown';console[_0x44a43(0x20c)](_0x44a43(0x1f6)+_0x4e935e),console[_0x44a43(0x20c)](_0x44a43(0x214)+_0x529db9+_0x44a43(0x1cd)+(_0x2aaba1?Math[_0x44a43(0x1e9)](_0x2aaba1['length']*0.75/0x400):0x0)+'KB'),console[_0x44a43(0x20c)]('üåê\x20Client\x20IP:\x20'+_0x134874);if(!_0x4e935e){_0x1bd157['status'](0x190)[_0x44a43(0x1f3)]({'success':![],'error':_0x44a43(0x1de)});return;}if(!_0x2aaba1){_0x1bd157[_0x44a43(0x1f7)](0x190)[_0x44a43(0x1f3)]({'success':![],'error':_0x44a43(0x1cc)});return;}if(!_0x529db9){_0x1bd157['status'](0x190)[_0x44a43(0x1f3)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x5a1598=['png',_0x44a43(0x1d2),_0x44a43(0x1ed),_0x44a43(0x1d3),'pdf'],_0x4b9696=_0x529db9[_0x44a43(0x1fa)]()[_0x44a43(0x1cf)]('.','');if(!_0x5a1598[_0x44a43(0x1e0)](_0x4b9696)){_0x1bd157['status'](0x190)[_0x44a43(0x1f3)]({'success':![],'error':_0x44a43(0x20d)+_0x529db9+_0x44a43(0x1ce)+_0x5a1598['join'](',\x20')});return;}const _0x46d8f0=0xa*0x400*0x400;if(_0x2aaba1[_0x44a43(0x1df)]>_0x46d8f0){_0x1bd157[_0x44a43(0x1f7)](0x190)[_0x44a43(0x1f3)]({'success':![],'error':_0x44a43(0x1e8)});return;}const _0x3ea239=await database_1[_0x44a43(0x1e5)][_0x44a43(0x200)][_0x44a43(0x1e2)]({'where':{'id':_0x4e935e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3ea239){console['log'](_0x44a43(0x1c9)+_0x4e935e),_0x1bd157['status'](0x194)['json']({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x3ea239['gateway']!==_0x44a43(0x1d9)&&_0x3ea239[_0x44a43(0x1e6)]!==_0x44a43(0x1d7)){console[_0x44a43(0x20c)](_0x44a43(0x1cb)+_0x3ea239[_0x44a43(0x1e6)]),_0x1bd157[_0x44a43(0x1f7)](0x190)[_0x44a43(0x1f3)]({'success':![],'error':_0x44a43(0x1ea)+_0x3ea239[_0x44a43(0x1e6)]});return;}if(_0x3ea239[_0x44a43(0x1f7)]!=='PENDING'){console['log'](_0x44a43(0x1ca)+_0x3ea239['status']),_0x1bd157[_0x44a43(0x1f7)](0x190)['json']({'success':![],'error':_0x44a43(0x1f0)+_0x3ea239[_0x44a43(0x1f7)]});return;}let _0xa5019=_0x2aaba1;_0x2aaba1['includes'](',')&&(_0xa5019=_0x2aaba1[_0x44a43(0x1dd)](',')[0x1]);try{Buffer[_0x44a43(0x1e1)](_0xa5019,_0x44a43(0x20b));}catch(_0x1f609e){_0x1bd157[_0x44a43(0x1f7)](0x190)[_0x44a43(0x1f3)]({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x20243c=await database_1['default'][_0x44a43(0x200)]['update']({'where':{'id':_0x4e935e},'data':{'paymentProof':_0xa5019,'paymentProofType':_0x4b9696,'status':'PROCESSING','updatedAt':new Date()}});console[_0x44a43(0x20c)](_0x44a43(0x1e4)),console['log'](_0x44a43(0x1f1)+_0x4e935e),console[_0x44a43(0x20c)](_0x44a43(0x1d1)+_0x3ea239['gateway']['toUpperCase']()),console['log'](_0x44a43(0x213)+_0x4b9696),console['log'](_0x44a43(0x202)+Math['round'](_0xa5019[_0x44a43(0x1df)]*0.75/0x400)+'KB'),console[_0x44a43(0x20c)]('\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING'),_0x1bd157[_0x44a43(0x1f3)]({'success':!![],'message':_0x44a43(0x1db),'data':{'paymentId':_0x20243c['id'],'status':_0x20243c[_0x44a43(0x1f7)],'gateway':_0x3ea239['gateway'],'fileType':_0x4b9696,'fileSize':Math[_0x44a43(0x1e9)](_0xa5019[_0x44a43(0x1df)]*0.75/0x400)+'KB','uploadedAt':_0x20243c['updatedAt']}});}catch(_0x1a53ce){console[_0x44a43(0x217)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x1a53ce),_0x1bd157[_0x44a43(0x1f7)](0x1f4)[_0x44a43(0x1f3)]({'success':![],'error':'Internal\x20server\x20error','details':_0x1a53ce instanceof Error?_0x1a53ce[_0x44a43(0x204)]:'Unknown\x20error'});}}async[a8_0x432922(0x211)](_0x121f1a,_0x2d744b){const _0x217220=a8_0x432922;try{const {paymentId:_0x31a39e}=_0x121f1a[_0x217220(0x208)];console[_0x217220(0x20c)](_0x217220(0x209)+_0x31a39e);const _0xae30dd=await database_1[_0x217220(0x1e5)][_0x217220(0x200)][_0x217220(0x1e2)]({'where':{'id':_0x31a39e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xae30dd){_0x2d744b['status'](0x194)['json']({'success':![],'error':_0x217220(0x215)});return;}if(_0xae30dd[_0x217220(0x1e6)]!==_0x217220(0x1d9)&&_0xae30dd[_0x217220(0x1e6)]!==_0x217220(0x1d7)){_0x2d744b[_0x217220(0x1f7)](0x190)[_0x217220(0x1f3)]({'success':![],'error':_0x217220(0x1f4)+_0xae30dd[_0x217220(0x1e6)]});return;}let _0x239b76='',_0x323136=_0xae30dd['currency'],_0x4d8de7='';if(_0xae30dd[_0x217220(0x1e6)]==='interac')_0x4d8de7='Interac\x20e-Transfer',_0x323136='CAD',_0x239b76='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0xae30dd[_0x217220(0x205)]+'\x20'+_0x323136+_0x217220(0x1dc);else _0xae30dd[_0x217220(0x1e6)]===_0x217220(0x1d7)&&(_0x4d8de7=_0x217220(0x1f5),_0x323136='EUR',_0x239b76='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0xae30dd['amount']+'\x20'+_0x323136+_0x217220(0x1dc));const _0x229cab={'success':!![],'data':{'paymentId':_0xae30dd['id'],'gateway':_0xae30dd['gateway'],'gatewayName':_0xae30dd[_0x217220(0x1e6)][_0x217220(0x1fe)](),'transferType':_0x4d8de7,'amount':_0xae30dd['amount'],'currency':_0x323136,'status':_0xae30dd[_0x217220(0x1f7)],'instructions':_0x239b76,'shopName':_0xae30dd['shop'][_0x217220(0x1fc)]||_0xae30dd[_0x217220(0x210)][_0x217220(0x1e7)],'hasProof':![],'proofType':null,'createdAt':_0xae30dd[_0x217220(0x20e)],'updatedAt':_0xae30dd['updatedAt'],'supportedFileTypes':[_0x217220(0x1d8),_0x217220(0x1d6),_0x217220(0x1f8),_0x217220(0x1c7),_0x217220(0x201)],'maxFileSize':'10MB'}};_0x2d744b[_0x217220(0x1f3)](_0x229cab);}catch(_0x4b59d4){console[_0x217220(0x217)](_0x217220(0x1ec),_0x4b59d4),_0x2d744b[_0x217220(0x1f7)](0x1f4)['json']({'success':![],'error':_0x217220(0x1eb),'details':_0x4b59d4 instanceof Error?_0x4b59d4[_0x217220(0x204)]:_0x217220(0x207)});}}}exports[a8_0x432922(0x212)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();