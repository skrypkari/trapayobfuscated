'use strict';function a10_0x4f6d(_0x44d7ee,_0x5b00ac){_0x44d7ee=_0x44d7ee-0x1d9;const _0x44e48f=a10_0x44e4();let _0x4f6dd6=_0x44e48f[_0x44d7ee];return _0x4f6dd6;}function a10_0x44e4(){const _0x8ac9f9=['üìÅ\x20File\x20type:\x20','3gAnCPV','Payment\x20not\x20found','jpg','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','getManualPaymentInfo','body','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','2OTMMaw','7110cRSfan','49NPDqBw','connection','name','File\x20type\x20is\x20required','amount','PNG','üí∞\x20Amount:\x20','username','replace','PDF','Unsupported\x20file\x20type:\x20','findUnique','pdf','Markdown','56380pXspcz','../config/database','json','sendShopNotification','3997089TKCHEH','update','üìã\x20Get\x20manual\x20payment\x20info:\x20','7867339505','toUpperCase','Payment\x20proof\x20uploaded\x20successfully','toLowerCase','manualPaymentController','heic',',\x20size:\x20','error','EUR','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','payment','__esModule','shop','üí≥\x20Payment\x20ID:\x20','Invalid\x20base64\x20file\x20data','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','__importDefault','sendDirectMessage','File\x20data\x20is\x20required','üîÑ\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent','sepa','split','includes','interac','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','Interac\x20e-Transfer','shopId','default','log','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','\x20\x20\x20-\x20File\x20size:\x20','.\x20Supported:\x20','defineProperty','message','png','üåê\x20Customer\x20IP:\x20','ManualPaymentController','CAD','\x20\x20\x20-\x20File\x20type:\x20','Payment\x20ID\x20is\x20required','345093bkSwRG','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','1095pVLPEH','jpeg','448328xxpyMW','Internal\x20server\x20error','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','üåê\x20Client\x20IP:\x20','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','148812ByykuV','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','‚ùå\x20Payment\x20not\x20found:\x20','../services/telegramBotService','round','KB)\x0a','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','gateway','7533888MGMNQx','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','status','319hmCHQs','from','PROCESSING','telegramBotService','SEPA\x20Bank\x20Transfer','Unknown\x20error','JPEG','üè™\x20Shop:\x20','uploadPaymentProof','sendDirectFile','length','base64','remoteAddress','JPG','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','üìÅ\x20File:\x20','sendShopFile'];a10_0x44e4=function(){return _0x8ac9f9;};return a10_0x44e4();}const a10_0x4c5321=a10_0x4f6d;(function(_0x2acdb3,_0x34c0b5){const _0xfdce02=a10_0x4f6d,_0xe14b6e=_0x2acdb3();while(!![]){try{const _0x5e243a=parseInt(_0xfdce02(0x222))/0x1*(-parseInt(_0xfdce02(0x1e2))/0x2)+-parseInt(_0xfdce02(0x1db))/0x3*(parseInt(_0xfdce02(0x22c))/0x4)+parseInt(_0xfdce02(0x224))/0x5*(parseInt(_0xfdce02(0x1e3))/0x6)+-parseInt(_0xfdce02(0x1e4))/0x7*(-parseInt(_0xfdce02(0x226))/0x8)+-parseInt(_0xfdce02(0x1f6))/0x9+-parseInt(_0xfdce02(0x1f2))/0xa*(parseInt(_0xfdce02(0x237))/0xb)+parseInt(_0xfdce02(0x234))/0xc;if(_0x5e243a===_0x34c0b5)break;else _0xe14b6e['push'](_0xe14b6e['shift']());}catch(_0x1897ad){_0xe14b6e['push'](_0xe14b6e['shift']());}}}(a10_0x44e4,0x46bab));var __importDefault=this&&this[a10_0x4c5321(0x209)]||function(_0x5dd4b5){const _0x310c3c=a10_0x4c5321;return _0x5dd4b5&&_0x5dd4b5[_0x310c3c(0x204)]?_0x5dd4b5:{'default':_0x5dd4b5};};Object[a10_0x4c5321(0x21a)](exports,a10_0x4c5321(0x204),{'value':!![]}),exports[a10_0x4c5321(0x1fd)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a10_0x4c5321(0x1f3))),telegramBotService_1=require(a10_0x4c5321(0x22f));class ManualPaymentController{async[a10_0x4c5321(0x23f)](_0x270976,_0x5aaee3){const _0x5ea961=a10_0x4c5321;try{const {paymentId:_0x33e89f,fileData:_0x11e6ef,fileType:_0xf089a4,fileName:_0x264e03}=_0x270976[_0x5ea961(0x1e0)],_0x5e993c=_0x270976['ip']||_0x270976[_0x5ea961(0x1e5)]?.[_0x5ea961(0x243)]||'unknown';console['log'](_0x5ea961(0x232)+_0x33e89f),console['log'](_0x5ea961(0x1da)+_0xf089a4+_0x5ea961(0x1ff)+(_0x11e6ef?Math['round'](_0x11e6ef[_0x5ea961(0x241)]*0.75/0x400):0x0)+'KB'),console[_0x5ea961(0x216)](_0x5ea961(0x22a)+_0x5e993c);if(!_0x33e89f){_0x5aaee3['status'](0x190)[_0x5ea961(0x1f4)]({'success':![],'error':_0x5ea961(0x221)});return;}if(!_0x11e6ef){_0x5aaee3[_0x5ea961(0x236)](0x190)[_0x5ea961(0x1f4)]({'success':![],'error':_0x5ea961(0x20b)});return;}if(!_0xf089a4){_0x5aaee3[_0x5ea961(0x236)](0x190)['json']({'success':![],'error':_0x5ea961(0x1e7)});return;}const _0x4bf767=[_0x5ea961(0x21c),_0x5ea961(0x1dd),_0x5ea961(0x225),_0x5ea961(0x1fe),_0x5ea961(0x1f0)],_0x210d51=_0xf089a4[_0x5ea961(0x1fc)]()[_0x5ea961(0x1ec)]('.','');if(!_0x4bf767['includes'](_0x210d51)){_0x5aaee3[_0x5ea961(0x236)](0x190)[_0x5ea961(0x1f4)]({'success':![],'error':_0x5ea961(0x1ee)+_0xf089a4+_0x5ea961(0x219)+_0x4bf767['join'](',\x20')});return;}const _0x4b6bc1=0xa*0x400*0x400;if(_0x11e6ef[_0x5ea961(0x241)]>_0x4b6bc1){_0x5aaee3[_0x5ea961(0x236)](0x190)[_0x5ea961(0x1f4)]({'success':![],'error':_0x5ea961(0x229)});return;}const _0x24fba0=await database_1[_0x5ea961(0x215)]['payment'][_0x5ea961(0x1ef)]({'where':{'id':_0x33e89f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x24fba0){console['log'](_0x5ea961(0x22e)+_0x33e89f),_0x5aaee3[_0x5ea961(0x236)](0x194)[_0x5ea961(0x1f4)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x24fba0['gateway']!==_0x5ea961(0x211)&&_0x24fba0['gateway']!==_0x5ea961(0x20e)){console[_0x5ea961(0x216)](_0x5ea961(0x22b)+_0x24fba0[_0x5ea961(0x233)]),_0x5aaee3['status'](0x190)[_0x5ea961(0x1f4)]({'success':![],'error':_0x5ea961(0x1e1)+_0x24fba0[_0x5ea961(0x233)]});return;}let _0x2a9814=_0x11e6ef;_0x11e6ef[_0x5ea961(0x210)](',')&&(_0x2a9814=_0x11e6ef[_0x5ea961(0x20f)](',')[0x1]);try{Buffer[_0x5ea961(0x238)](_0x2a9814,_0x5ea961(0x242));}catch(_0x375d3c){_0x5aaee3[_0x5ea961(0x236)](0x190)[_0x5ea961(0x1f4)]({'success':![],'error':_0x5ea961(0x207)});return;}const _0x401ab1=await database_1[_0x5ea961(0x215)]['payment'][_0x5ea961(0x1f7)]({'where':{'id':_0x33e89f},'data':{'status':_0x5ea961(0x239),'updatedAt':new Date()}});console[_0x5ea961(0x216)]('‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:'),console['log']('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x33e89f),console[_0x5ea961(0x216)]('\x20\x20\x20-\x20Gateway:\x20'+_0x24fba0['gateway'][_0x5ea961(0x1fa)]()),console[_0x5ea961(0x216)](_0x5ea961(0x220)+_0x210d51),console[_0x5ea961(0x216)](_0x5ea961(0x218)+Math[_0x5ea961(0x230)](_0x2a9814[_0x5ea961(0x241)]*0.75/0x400)+'KB'),console['log']('\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING');try{const _0xf5424f=_0x24fba0[_0x5ea961(0x233)][_0x5ea961(0x1fa)](),_0x190339=_0x24fba0[_0x5ea961(0x205)][_0x5ea961(0x1e6)]||_0x24fba0[_0x5ea961(0x205)][_0x5ea961(0x1eb)],_0x585c5c=Math['round'](_0x2a9814[_0x5ea961(0x241)]*0.75/0x400),_0x181f32=_0x5ea961(0x20c)+_0xf5424f+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0x5ea961(0x206)+_0x33e89f+'\x0a')+('üí∞\x20Amount:\x20'+_0x24fba0['amount']+'\x20'+_0x24fba0['currency']+'\x0a')+(_0x5ea961(0x246)+_0x210d51[_0x5ea961(0x1fa)]()+'\x20('+_0x585c5c+_0x5ea961(0x231))+_0x5ea961(0x202)+('üåê\x20Customer\x20IP:\x20'+_0x5e993c+'\x0a\x0a')+'‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1['telegramBotService'][_0x5ea961(0x1f5)](_0x24fba0[_0x5ea961(0x214)],_0x181f32,{'parse_mode':_0x5ea961(0x1f1)});const _0x93f42f=Buffer[_0x5ea961(0x238)](_0x2a9814,_0x5ea961(0x242)),_0x3b3310='payment_proof_'+_0x33e89f+'.'+_0x210d51;await telegramBotService_1['telegramBotService'][_0x5ea961(0x1d9)](_0x24fba0['shopId'],_0x93f42f,_0x3b3310,'Payment\x20proof\x20for\x20'+_0x33e89f),console[_0x5ea961(0x216)](_0x5ea961(0x217));const _0x53fcfc=_0x5ea961(0x1f9),_0x42cc2c=_0x5ea961(0x20c)+_0xf5424f+_0x5ea961(0x223)+(_0x5ea961(0x206)+_0x33e89f+'\x0a')+(_0x5ea961(0x23e)+_0x190339+'\x0a')+(_0x5ea961(0x1ea)+_0x24fba0['amount']+'\x20'+_0x24fba0['currency']+'\x0a')+(_0x5ea961(0x246)+_0x210d51[_0x5ea961(0x1fa)]()+'\x20('+_0x585c5c+_0x5ea961(0x231))+_0x5ea961(0x202)+(_0x5ea961(0x21d)+_0x5e993c+'\x0a\x0a')+_0x5ea961(0x212);await telegramBotService_1[_0x5ea961(0x23a)][_0x5ea961(0x20a)](parseInt(_0x53fcfc),_0x42cc2c),await telegramBotService_1[_0x5ea961(0x23a)][_0x5ea961(0x240)](parseInt(_0x53fcfc),_0x93f42f,_0x3b3310,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x33e89f),console['log'](_0x5ea961(0x20d));}catch(_0xb9fdcc){console[_0x5ea961(0x200)](_0x5ea961(0x208),_0xb9fdcc);}_0x5aaee3[_0x5ea961(0x1f4)]({'success':!![],'message':_0x5ea961(0x1fb),'data':{'paymentId':_0x401ab1['id'],'status':_0x401ab1[_0x5ea961(0x236)],'gateway':_0x24fba0['gateway'],'fileType':_0x210d51,'fileSize':Math[_0x5ea961(0x230)](_0x2a9814['length']*0.75/0x400)+'KB','uploadedAt':_0x401ab1['updatedAt']}});}catch(_0x3fafb3){console['error']('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x3fafb3),_0x5aaee3[_0x5ea961(0x236)](0x1f4)[_0x5ea961(0x1f4)]({'success':![],'error':_0x5ea961(0x227),'details':_0x3fafb3 instanceof Error?_0x3fafb3[_0x5ea961(0x21b)]:'Unknown\x20error'});}}async[a10_0x4c5321(0x1df)](_0x33d09a,_0x2ff56b){const _0x321a10=a10_0x4c5321;try{const {paymentId:_0x5f4b24}=_0x33d09a['params'];console[_0x321a10(0x216)](_0x321a10(0x1f8)+_0x5f4b24);const _0x483c32=await database_1[_0x321a10(0x215)][_0x321a10(0x203)][_0x321a10(0x1ef)]({'where':{'id':_0x5f4b24},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x483c32){_0x2ff56b['status'](0x194)[_0x321a10(0x1f4)]({'success':![],'error':_0x321a10(0x1dc)});return;}if(_0x483c32['gateway']!==_0x321a10(0x211)&&_0x483c32[_0x321a10(0x233)]!==_0x321a10(0x20e)){_0x2ff56b[_0x321a10(0x236)](0x190)[_0x321a10(0x1f4)]({'success':![],'error':_0x321a10(0x245)+_0x483c32[_0x321a10(0x233)]});return;}let _0x86b3fb='',_0x168f0e=_0x483c32['currency'],_0x44699a='';if(_0x483c32[_0x321a10(0x233)]===_0x321a10(0x211))_0x44699a=_0x321a10(0x213),_0x168f0e=_0x321a10(0x21f),_0x86b3fb=_0x321a10(0x22d)+_0x483c32[_0x321a10(0x1e8)]+'\x20'+_0x168f0e+_0x321a10(0x235);else _0x483c32[_0x321a10(0x233)]===_0x321a10(0x20e)&&(_0x44699a=_0x321a10(0x23b),_0x168f0e=_0x321a10(0x201),_0x86b3fb=_0x321a10(0x228)+_0x483c32[_0x321a10(0x1e8)]+'\x20'+_0x168f0e+_0x321a10(0x235));const _0x131c1c={'success':!![],'data':{'paymentId':_0x483c32['id'],'gateway':_0x483c32[_0x321a10(0x233)],'gatewayName':_0x483c32[_0x321a10(0x233)]['toUpperCase'](),'transferType':_0x44699a,'amount':_0x483c32[_0x321a10(0x1e8)],'currency':_0x168f0e,'status':_0x483c32[_0x321a10(0x236)],'instructions':_0x86b3fb,'shopName':_0x483c32[_0x321a10(0x205)]['name']||_0x483c32[_0x321a10(0x205)][_0x321a10(0x1eb)],'hasProof':![],'proofType':null,'createdAt':_0x483c32['createdAt'],'updatedAt':_0x483c32['updatedAt'],'supportedFileTypes':[_0x321a10(0x1e9),_0x321a10(0x244),_0x321a10(0x23d),'HEIC',_0x321a10(0x1ed)],'maxFileSize':'10MB'}};_0x2ff56b[_0x321a10(0x1f4)](_0x131c1c);}catch(_0x4b0d3a){console[_0x321a10(0x200)](_0x321a10(0x1de),_0x4b0d3a),_0x2ff56b[_0x321a10(0x236)](0x1f4)[_0x321a10(0x1f4)]({'success':![],'error':_0x321a10(0x227),'details':_0x4b0d3a instanceof Error?_0x4b0d3a[_0x321a10(0x21b)]:_0x321a10(0x23c)});}}}exports[a10_0x4c5321(0x21e)]=ManualPaymentController,exports[a10_0x4c5321(0x1fd)]=new ManualPaymentController();