'use strict';const a8_0x5ac5c4=a8_0x2d59;(function(_0x492874,_0x18d49f){const _0x220ec1=a8_0x2d59,_0x180e93=_0x492874();while(!![]){try{const _0x219def=-parseInt(_0x220ec1(0x244))/0x1+-parseInt(_0x220ec1(0x217))/0x2*(parseInt(_0x220ec1(0x222))/0x3)+parseInt(_0x220ec1(0x21c))/0x4+parseInt(_0x220ec1(0x22a))/0x5+-parseInt(_0x220ec1(0x1e4))/0x6+-parseInt(_0x220ec1(0x202))/0x7*(parseInt(_0x220ec1(0x216))/0x8)+parseInt(_0x220ec1(0x23e))/0x9;if(_0x219def===_0x18d49f)break;else _0x180e93['push'](_0x180e93['shift']());}catch(_0x23286c){_0x180e93['push'](_0x180e93['shift']());}}}(a8_0x365d,0xa8d25));function a8_0x365d(){const _0x23704d=['File\x20data\x20is\x20required','../config/database','5164604vhgewL','length','updatedAt','JPG','Payment\x20proof\x20uploaded\x20successfully','üåê\x20Customer\x20IP:\x20','717gnDWXS','sendDirectMessage','message','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','shop','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','toLowerCase','5865085OGzvmy','7867339505','remoteAddress','\x20Payment\x20Proof\x20Received\x0a\x0a','gateway','üìÅ\x20File\x20type:\x20','shopId','PNG','ManualPaymentController','__esModule','PROCESSING','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','.\x20Supported:\x20','interac','\x20\x20\x20-\x20File\x20type:\x20','createdAt','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','sendDirectFile','toUpperCase','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','10950948OqNZSy','payment','defineProperty','default','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','round','560668eugXyY','from','update','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','üìÅ\x20File:\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','\x20\x20\x20-\x20Gateway:\x20','currency','üåê\x20Client\x20IP:\x20','4836192ljPKXI','HEIC','username','Unknown\x20error','‚ùå\x20Upload\x20payment\x20proof\x20error:','Unsupported\x20file\x20type:\x20','log','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','includes','\x20\x20\x20-\x20Payment\x20ID:\x20','üí≥\x20Payment\x20ID:\x20','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','üîÑ\x20','Payment\x20ID\x20is\x20required','error','PDF','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','KB)\x0a','‚ùå\x20Payment\x20not\x20found:\x20','üí∞\x20Amount:\x20','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','../services/telegramBotService','sendShopNotification','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','10MB','Payment\x20proof\x20for\x20','amount','File\x20type\x20is\x20required','name','findUnique','28xgbtdY','base64','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','split','params','telegramBotService','json','Interac\x20e-Transfer','Invalid\x20base64\x20file\x20data','heic','manualPaymentController','EUR','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','üìã\x20Get\x20manual\x20payment\x20info:\x20','status','Internal\x20server\x20error','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','sepa','SEPA\x20Bank\x20Transfer','jpeg','1386552vkggbv','7778hYAkKI','\x20\x20\x20-\x20File\x20size:\x20','pdf'];a8_0x365d=function(){return _0x23704d;};return a8_0x365d();}function a8_0x2d59(_0x1088e3,_0x1082da){const _0x365dee=a8_0x365d();return a8_0x2d59=function(_0x2d5929,_0x380810){_0x2d5929=_0x2d5929-0x1e3;let _0x50ebb8=_0x365dee[_0x2d5929];return _0x50ebb8;},a8_0x2d59(_0x1088e3,_0x1082da);}var __importDefault=this&&this['__importDefault']||function(_0x1e0a1a){const _0x1005d5=a8_0x2d59;return _0x1e0a1a&&_0x1e0a1a[_0x1005d5(0x233)]?_0x1e0a1a:{'default':_0x1e0a1a};};Object[a8_0x5ac5c4(0x240)](exports,a8_0x5ac5c4(0x233),{'value':!![]}),exports['manualPaymentController']=exports[a8_0x5ac5c4(0x232)]=void 0x0;const database_1=__importDefault(require(a8_0x5ac5c4(0x21b))),telegramBotService_1=require(a8_0x5ac5c4(0x1f9));class ManualPaymentController{async['uploadPaymentProof'](_0x18d560,_0x23f707){const _0x2c9dc4=a8_0x5ac5c4;try{const {paymentId:_0x582b45,fileData:_0x10ab82,fileType:_0xf8dbcd,fileName:_0x2e1bce}=_0x18d560['body'],_0x28c651=_0x18d560['ip']||_0x18d560['connection']?.[_0x2c9dc4(0x22c)]||'unknown';console[_0x2c9dc4(0x1ea)](_0x2c9dc4(0x204)+_0x582b45),console[_0x2c9dc4(0x1ea)](_0x2c9dc4(0x22f)+_0xf8dbcd+',\x20size:\x20'+(_0x10ab82?Math[_0x2c9dc4(0x243)](_0x10ab82['length']*0.75/0x400):0x0)+'KB'),console[_0x2c9dc4(0x1ea)](_0x2c9dc4(0x1e3)+_0x28c651);if(!_0x582b45){_0x23f707['status'](0x190)[_0x2c9dc4(0x208)]({'success':![],'error':_0x2c9dc4(0x1f1)});return;}if(!_0x10ab82){_0x23f707['status'](0x190)['json']({'success':![],'error':_0x2c9dc4(0x21a)});return;}if(!_0xf8dbcd){_0x23f707[_0x2c9dc4(0x210)](0x190)['json']({'success':![],'error':_0x2c9dc4(0x1ff)});return;}const _0x3e59b0=['png','jpg',_0x2c9dc4(0x215),_0x2c9dc4(0x20b),_0x2c9dc4(0x219)],_0x792c43=_0xf8dbcd[_0x2c9dc4(0x229)]()['replace']('.','');if(!_0x3e59b0[_0x2c9dc4(0x1ec)](_0x792c43)){_0x23f707[_0x2c9dc4(0x210)](0x190)[_0x2c9dc4(0x208)]({'success':![],'error':_0x2c9dc4(0x1e9)+_0xf8dbcd+_0x2c9dc4(0x236)+_0x3e59b0['join'](',\x20')});return;}const _0x55b636=0xa*0x400*0x400;if(_0x10ab82[_0x2c9dc4(0x21d)]>_0x55b636){_0x23f707[_0x2c9dc4(0x210)](0x190)[_0x2c9dc4(0x208)]({'success':![],'error':_0x2c9dc4(0x20e)});return;}const _0x55954a=await database_1[_0x2c9dc4(0x241)]['payment'][_0x2c9dc4(0x201)]({'where':{'id':_0x582b45},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x55954a){console[_0x2c9dc4(0x1ea)](_0x2c9dc4(0x1f6)+_0x582b45),_0x23f707[_0x2c9dc4(0x210)](0x194)[_0x2c9dc4(0x208)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x55954a[_0x2c9dc4(0x22e)]!=='interac'&&_0x55954a[_0x2c9dc4(0x22e)]!==_0x2c9dc4(0x213)){console[_0x2c9dc4(0x1ea)](_0x2c9dc4(0x1eb)+_0x55954a[_0x2c9dc4(0x22e)]),_0x23f707[_0x2c9dc4(0x210)](0x190)[_0x2c9dc4(0x208)]({'success':![],'error':_0x2c9dc4(0x1ef)+_0x55954a['gateway']});return;}let _0x25533b=_0x10ab82;_0x10ab82[_0x2c9dc4(0x1ec)](',')&&(_0x25533b=_0x10ab82[_0x2c9dc4(0x205)](',')[0x1]);try{Buffer['from'](_0x25533b,'base64');}catch(_0x173fdd){_0x23f707[_0x2c9dc4(0x210)](0x190)[_0x2c9dc4(0x208)]({'success':![],'error':_0x2c9dc4(0x20a)});return;}const _0x16fa46=await database_1[_0x2c9dc4(0x241)][_0x2c9dc4(0x23f)][_0x2c9dc4(0x246)]({'where':{'id':_0x582b45},'data':{'status':_0x2c9dc4(0x234),'updatedAt':new Date()}});console['log'](_0x2c9dc4(0x212)),console[_0x2c9dc4(0x1ea)](_0x2c9dc4(0x1ed)+_0x582b45),console[_0x2c9dc4(0x1ea)](_0x2c9dc4(0x24a)+_0x55954a[_0x2c9dc4(0x22e)]['toUpperCase']()),console[_0x2c9dc4(0x1ea)](_0x2c9dc4(0x238)+_0x792c43),console['log'](_0x2c9dc4(0x218)+Math['round'](_0x25533b['length']*0.75/0x400)+'KB'),console[_0x2c9dc4(0x1ea)](_0x2c9dc4(0x249));try{const _0xeb28df=_0x55954a['gateway'][_0x2c9dc4(0x23c)](),_0x38c648=_0x55954a['shop'][_0x2c9dc4(0x200)]||_0x55954a[_0x2c9dc4(0x226)]['username'],_0x46469a=Math[_0x2c9dc4(0x243)](_0x25533b['length']*0.75/0x400),_0x20b6bb=_0x2c9dc4(0x1f0)+_0xeb28df+_0x2c9dc4(0x22d)+(_0x2c9dc4(0x1ee)+_0x582b45+'\x0a')+(_0x2c9dc4(0x1f7)+_0x55954a[_0x2c9dc4(0x1fe)]+'\x20'+_0x55954a[_0x2c9dc4(0x24b)]+'\x0a')+(_0x2c9dc4(0x248)+_0x792c43['toUpperCase']()+'\x20('+_0x46469a+_0x2c9dc4(0x1f5))+_0x2c9dc4(0x247)+(_0x2c9dc4(0x221)+_0x28c651+'\x0a\x0a')+_0x2c9dc4(0x225);await telegramBotService_1[_0x2c9dc4(0x207)][_0x2c9dc4(0x1fa)](_0x55954a[_0x2c9dc4(0x230)],_0x20b6bb,{'parse_mode':'Markdown'});const _0x5c9091=Buffer[_0x2c9dc4(0x245)](_0x25533b,_0x2c9dc4(0x203)),_0x34ba28='payment_proof_'+_0x582b45+'.'+_0x792c43;await telegramBotService_1[_0x2c9dc4(0x207)]['sendShopFile'](_0x55954a[_0x2c9dc4(0x230)],_0x5c9091,_0x34ba28,_0x2c9dc4(0x1fd)+_0x582b45),console[_0x2c9dc4(0x1ea)](_0x2c9dc4(0x1f8));const _0x5995fb=_0x2c9dc4(0x22b),_0x1bee35=_0x2c9dc4(0x1f0)+_0xeb28df+_0x2c9dc4(0x1fb)+(_0x2c9dc4(0x1ee)+_0x582b45+'\x0a')+('üè™\x20Shop:\x20'+_0x38c648+'\x0a')+(_0x2c9dc4(0x1f7)+_0x55954a['amount']+'\x20'+_0x55954a[_0x2c9dc4(0x24b)]+'\x0a')+(_0x2c9dc4(0x248)+_0x792c43['toUpperCase']()+'\x20('+_0x46469a+'KB)\x0a')+_0x2c9dc4(0x247)+(_0x2c9dc4(0x221)+_0x28c651+'\x0a\x0a')+_0x2c9dc4(0x23a);await telegramBotService_1[_0x2c9dc4(0x207)][_0x2c9dc4(0x223)](parseInt(_0x5995fb),_0x1bee35),await telegramBotService_1['telegramBotService'][_0x2c9dc4(0x23b)](parseInt(_0x5995fb),_0x5c9091,_0x34ba28,_0x2c9dc4(0x1f4)+_0x582b45),console['log']('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x144e6c){console[_0x2c9dc4(0x1f2)](_0x2c9dc4(0x227),_0x144e6c);}_0x23f707[_0x2c9dc4(0x208)]({'success':!![],'message':_0x2c9dc4(0x220),'data':{'paymentId':_0x16fa46['id'],'status':_0x16fa46[_0x2c9dc4(0x210)],'gateway':_0x55954a['gateway'],'fileType':_0x792c43,'fileSize':Math[_0x2c9dc4(0x243)](_0x25533b['length']*0.75/0x400)+'KB','uploadedAt':_0x16fa46['updatedAt']}});}catch(_0x105871){console[_0x2c9dc4(0x1f2)](_0x2c9dc4(0x1e8),_0x105871),_0x23f707['status'](0x1f4)[_0x2c9dc4(0x208)]({'success':![],'error':_0x2c9dc4(0x211),'details':_0x105871 instanceof Error?_0x105871[_0x2c9dc4(0x224)]:_0x2c9dc4(0x1e7)});}}async['getManualPaymentInfo'](_0x40c2b9,_0x3b2743){const _0x5d8cb6=a8_0x5ac5c4;try{const {paymentId:_0x5193e0}=_0x40c2b9[_0x5d8cb6(0x206)];console[_0x5d8cb6(0x1ea)](_0x5d8cb6(0x20f)+_0x5193e0);const _0x446101=await database_1['default'][_0x5d8cb6(0x23f)][_0x5d8cb6(0x201)]({'where':{'id':_0x5193e0},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x446101){_0x3b2743[_0x5d8cb6(0x210)](0x194)[_0x5d8cb6(0x208)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x446101['gateway']!=='interac'&&_0x446101['gateway']!==_0x5d8cb6(0x213)){_0x3b2743[_0x5d8cb6(0x210)](0x190)[_0x5d8cb6(0x208)]({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x446101[_0x5d8cb6(0x22e)]});return;}let _0xe41ad7='',_0x148036=_0x446101[_0x5d8cb6(0x24b)],_0x3193a0='';if(_0x446101[_0x5d8cb6(0x22e)]===_0x5d8cb6(0x237))_0x3193a0=_0x5d8cb6(0x209),_0x148036='CAD',_0xe41ad7=_0x5d8cb6(0x242)+_0x446101[_0x5d8cb6(0x1fe)]+'\x20'+_0x148036+_0x5d8cb6(0x228);else _0x446101[_0x5d8cb6(0x22e)]==='sepa'&&(_0x3193a0=_0x5d8cb6(0x214),_0x148036=_0x5d8cb6(0x20d),_0xe41ad7=_0x5d8cb6(0x235)+_0x446101[_0x5d8cb6(0x1fe)]+'\x20'+_0x148036+_0x5d8cb6(0x228));const _0x169723={'success':!![],'data':{'paymentId':_0x446101['id'],'gateway':_0x446101['gateway'],'gatewayName':_0x446101[_0x5d8cb6(0x22e)][_0x5d8cb6(0x23c)](),'transferType':_0x3193a0,'amount':_0x446101[_0x5d8cb6(0x1fe)],'currency':_0x148036,'status':_0x446101['status'],'instructions':_0xe41ad7,'shopName':_0x446101['shop'][_0x5d8cb6(0x200)]||_0x446101[_0x5d8cb6(0x226)][_0x5d8cb6(0x1e6)],'hasProof':![],'proofType':null,'createdAt':_0x446101[_0x5d8cb6(0x239)],'updatedAt':_0x446101[_0x5d8cb6(0x21e)],'supportedFileTypes':[_0x5d8cb6(0x231),_0x5d8cb6(0x21f),'JPEG',_0x5d8cb6(0x1e5),_0x5d8cb6(0x1f3)],'maxFileSize':_0x5d8cb6(0x1fc)}};_0x3b2743[_0x5d8cb6(0x208)](_0x169723);}catch(_0x8f2f1){console[_0x5d8cb6(0x1f2)](_0x5d8cb6(0x23d),_0x8f2f1),_0x3b2743[_0x5d8cb6(0x210)](0x1f4)[_0x5d8cb6(0x208)]({'success':![],'error':_0x5d8cb6(0x211),'details':_0x8f2f1 instanceof Error?_0x8f2f1['message']:'Unknown\x20error'});}}}exports[a8_0x5ac5c4(0x232)]=ManualPaymentController,exports[a8_0x5ac5c4(0x20c)]=new ManualPaymentController();