'use strict';const a10_0x36c9a4=a10_0x2479;(function(_0x12ada4,_0x404474){const _0x5ef339=a10_0x2479,_0x2be18b=_0x12ada4();while(!![]){try{const _0x19c4cd=parseInt(_0x5ef339(0x75))/0x1+parseInt(_0x5ef339(0x99))/0x2+-parseInt(_0x5ef339(0x7b))/0x3*(-parseInt(_0x5ef339(0xb3))/0x4)+parseInt(_0x5ef339(0x82))/0x5*(parseInt(_0x5ef339(0x70))/0x6)+parseInt(_0x5ef339(0x8f))/0x7*(-parseInt(_0x5ef339(0x78))/0x8)+parseInt(_0x5ef339(0xbb))/0x9+-parseInt(_0x5ef339(0x83))/0xa;if(_0x19c4cd===_0x404474)break;else _0x2be18b['push'](_0x2be18b['shift']());}catch(_0x19607){_0x2be18b['push'](_0x2be18b['shift']());}}}(a10_0x4398,0x5065e));function a10_0x2479(_0x217fcf,_0x3d7c16){_0x217fcf=_0x217fcf-0x66;const _0x43982f=a10_0x4398();let _0x2479e9=_0x43982f[_0x217fcf];return _0x2479e9;}function a10_0x4398(){const _0x340936=['4236714xzFkGN','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','shop','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','sendShopFile','payment','Interac\x20e-Transfer','Unsupported\x20file\x20type:\x20','JPG','length','from','telegramBotService','File\x20data\x20is\x20required','error','name','ManualPaymentController','message','14154CCAtbi','jpeg','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','defineProperty','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','46379DWcnCM','Invalid\x20base64\x20file\x20data','toUpperCase','8HyanlM','PNG','pdf','45uUeCUM','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','10MB','__importDefault','connection','üì±\x20Admin\x20notification\x20and\x20file\x20sent','unknown','925ImTbxJ','6553750zjrzVF','.\x20Supported:\x20','toLowerCase','status','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','gateway','PROCESSING','includes','log','PDF','Payment\x20proof\x20for\x20','manualPaymentController','2773302BeidNi','Payment\x20ID\x20is\x20required','JPEG','üìÅ\x20File\x20type:\x20','amount','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','remoteAddress','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','json','base64','720712kPxQVO','SEPA\x20Bank\x20Transfer','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','png','7867339505','üí≥\x20Payment\x20ID:\x20','default','body','update','sendDirectFile','Markdown','üìÅ\x20File:\x20','‚ùå\x20Payment\x20not\x20found:\x20','currency','üè™\x20Shop:\x20','findUnique','shopId','round','Payment\x20not\x20found','updatedAt','HEIC','üîÑ\x20','Internal\x20server\x20error','interac','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','File\x20type\x20is\x20required','17860GqcVBf','createdAt','uploadPaymentProof','sepa','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','‚ùå\x20Upload\x20payment\x20proof\x20error:','KB)\x0a','üí∞\x20Amount:\x20'];a10_0x4398=function(){return _0x340936;};return a10_0x4398();}var __importDefault=this&&this[a10_0x36c9a4(0x7e)]||function(_0x1a8dff){return _0x1a8dff&&_0x1a8dff['__esModule']?_0x1a8dff:{'default':_0x1a8dff};};Object[a10_0x36c9a4(0x73)](exports,'__esModule',{'value':!![]}),exports[a10_0x36c9a4(0x8e)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require('../config/database')),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async[a10_0x36c9a4(0xb5)](_0x1c4ae6,_0x4209c3){const _0xb06fd2=a10_0x36c9a4;try{const {paymentId:_0x3ca430,fileData:_0x499a11,fileType:_0x16f492,fileName:_0xe8edb4}=_0x1c4ae6[_0xb06fd2(0xa0)],_0x15d826=_0x1c4ae6['ip']||_0x1c4ae6[_0xb06fd2(0x7f)]?.[_0xb06fd2(0x95)]||_0xb06fd2(0x81);console[_0xb06fd2(0x8b)]('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x3ca430),console[_0xb06fd2(0x8b)](_0xb06fd2(0x92)+_0x16f492+',\x20size:\x20'+(_0x499a11?Math['round'](_0x499a11[_0xb06fd2(0x68)]*0.75/0x400):0x0)+'KB'),console[_0xb06fd2(0x8b)]('üåê\x20Client\x20IP:\x20'+_0x15d826);if(!_0x3ca430){_0x4209c3[_0xb06fd2(0x86)](0x190)[_0xb06fd2(0x97)]({'success':![],'error':_0xb06fd2(0x90)});return;}if(!_0x499a11){_0x4209c3[_0xb06fd2(0x86)](0x190)['json']({'success':![],'error':_0xb06fd2(0x6b)});return;}if(!_0x16f492){_0x4209c3[_0xb06fd2(0x86)](0x190)[_0xb06fd2(0x97)]({'success':![],'error':_0xb06fd2(0xb2)});return;}const _0x45d092=[_0xb06fd2(0x9c),'jpg',_0xb06fd2(0x71),'heic',_0xb06fd2(0x7a)],_0x2d1aa9=_0x16f492[_0xb06fd2(0x85)]()['replace']('.','');if(!_0x45d092['includes'](_0x2d1aa9)){_0x4209c3[_0xb06fd2(0x86)](0x190)[_0xb06fd2(0x97)]({'success':![],'error':_0xb06fd2(0x66)+_0x16f492+_0xb06fd2(0x84)+_0x45d092['join'](',\x20')});return;}const _0x371bf6=0xa*0x400*0x400;if(_0x499a11[_0xb06fd2(0x68)]>_0x371bf6){_0x4209c3[_0xb06fd2(0x86)](0x190)['json']({'success':![],'error':_0xb06fd2(0xb7)});return;}const _0x59ec36=await database_1[_0xb06fd2(0x9f)][_0xb06fd2(0xc0)][_0xb06fd2(0xa8)]({'where':{'id':_0x3ca430},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x59ec36){console[_0xb06fd2(0x8b)](_0xb06fd2(0xa5)+_0x3ca430),_0x4209c3[_0xb06fd2(0x86)](0x194)[_0xb06fd2(0x97)]({'success':![],'error':_0xb06fd2(0xab)});return;}if(_0x59ec36[_0xb06fd2(0x88)]!=='interac'&&_0x59ec36[_0xb06fd2(0x88)]!==_0xb06fd2(0xb6)){console[_0xb06fd2(0x8b)](_0xb06fd2(0x74)+_0x59ec36[_0xb06fd2(0x88)]),_0x4209c3[_0xb06fd2(0x86)](0x190)['json']({'success':![],'error':_0xb06fd2(0x94)+_0x59ec36['gateway']});return;}let _0x16af9f=_0x499a11;_0x499a11[_0xb06fd2(0x8a)](',')&&(_0x16af9f=_0x499a11['split'](',')[0x1]);try{Buffer[_0xb06fd2(0x69)](_0x16af9f,_0xb06fd2(0x98));}catch(_0x13f6aa){_0x4209c3['status'](0x190)[_0xb06fd2(0x97)]({'success':![],'error':_0xb06fd2(0x76)});return;}const _0x577bd7=await database_1['default'][_0xb06fd2(0xc0)][_0xb06fd2(0xa1)]({'where':{'id':_0x3ca430},'data':{'status':_0xb06fd2(0x89),'updatedAt':new Date()}});console[_0xb06fd2(0x8b)]('‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:'),console[_0xb06fd2(0x8b)]('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x3ca430),console['log']('\x20\x20\x20-\x20Gateway:\x20'+_0x59ec36[_0xb06fd2(0x88)][_0xb06fd2(0x77)]()),console[_0xb06fd2(0x8b)]('\x20\x20\x20-\x20File\x20type:\x20'+_0x2d1aa9),console[_0xb06fd2(0x8b)]('\x20\x20\x20-\x20File\x20size:\x20'+Math['round'](_0x16af9f[_0xb06fd2(0x68)]*0.75/0x400)+'KB'),console[_0xb06fd2(0x8b)](_0xb06fd2(0xb1));try{const _0xe48b3=_0x59ec36['gateway'][_0xb06fd2(0x77)](),_0x3f0c51=_0x59ec36[_0xb06fd2(0xbd)][_0xb06fd2(0x6d)]||_0x59ec36[_0xb06fd2(0xbd)]['username'],_0x56e02d=Math[_0xb06fd2(0xaa)](_0x16af9f[_0xb06fd2(0x68)]*0.75/0x400),_0x1f555f=_0xb06fd2(0xae)+_0xe48b3+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0xb06fd2(0x9e)+_0x3ca430+'\x0a')+(_0xb06fd2(0xba)+_0x59ec36[_0xb06fd2(0x93)]+'\x20'+_0x59ec36[_0xb06fd2(0xa6)]+'\x0a')+('üìÅ\x20File:\x20'+_0x2d1aa9[_0xb06fd2(0x77)]()+'\x20('+_0x56e02d+'KB)\x0a')+_0xb06fd2(0xbc)+('üåê\x20Customer\x20IP:\x20'+_0x15d826+'\x0a\x0a')+_0xb06fd2(0xbe);await telegramBotService_1[_0xb06fd2(0x6a)]['sendShopNotification'](_0x59ec36[_0xb06fd2(0xa9)],_0x1f555f,{'parse_mode':_0xb06fd2(0xa3)});const _0x3a6e49=Buffer[_0xb06fd2(0x69)](_0x16af9f,_0xb06fd2(0x98)),_0x208341='payment_proof_'+_0x3ca430+'.'+_0x2d1aa9;await telegramBotService_1['telegramBotService'][_0xb06fd2(0xbf)](_0x59ec36['shopId'],_0x3a6e49,_0x208341,_0xb06fd2(0x8d)+_0x3ca430),console[_0xb06fd2(0x8b)]('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x4eddad=_0xb06fd2(0x9d),_0x2879af=_0xb06fd2(0xae)+_0xe48b3+_0xb06fd2(0x87)+(_0xb06fd2(0x9e)+_0x3ca430+'\x0a')+(_0xb06fd2(0xa7)+_0x3f0c51+'\x0a')+(_0xb06fd2(0xba)+_0x59ec36[_0xb06fd2(0x93)]+'\x20'+_0x59ec36[_0xb06fd2(0xa6)]+'\x0a')+(_0xb06fd2(0xa4)+_0x2d1aa9[_0xb06fd2(0x77)]()+'\x20('+_0x56e02d+_0xb06fd2(0xb9))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+('üåê\x20Customer\x20IP:\x20'+_0x15d826+'\x0a\x0a')+'‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.';await telegramBotService_1[_0xb06fd2(0x6a)]['sendDirectMessage'](parseInt(_0x4eddad),_0x2879af),await telegramBotService_1[_0xb06fd2(0x6a)][_0xb06fd2(0xa2)](parseInt(_0x4eddad),_0x3a6e49,_0x208341,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x3ca430),console[_0xb06fd2(0x8b)](_0xb06fd2(0x80));}catch(_0x1ff6f5){console[_0xb06fd2(0x6c)]('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:',_0x1ff6f5);}_0x4209c3[_0xb06fd2(0x97)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x577bd7['id'],'status':_0x577bd7[_0xb06fd2(0x86)],'gateway':_0x59ec36[_0xb06fd2(0x88)],'fileType':_0x2d1aa9,'fileSize':Math['round'](_0x16af9f[_0xb06fd2(0x68)]*0.75/0x400)+'KB','uploadedAt':_0x577bd7[_0xb06fd2(0xac)]}});}catch(_0x183dfa){console[_0xb06fd2(0x6c)](_0xb06fd2(0xb8),_0x183dfa),_0x4209c3[_0xb06fd2(0x86)](0x1f4)[_0xb06fd2(0x97)]({'success':![],'error':_0xb06fd2(0xaf),'details':_0x183dfa instanceof Error?_0x183dfa[_0xb06fd2(0x6f)]:'Unknown\x20error'});}}async['getManualPaymentInfo'](_0x974b72,_0x1376f6){const _0x2a6571=a10_0x36c9a4;try{const {paymentId:_0x49b864}=_0x974b72['params'];console['log']('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x49b864);const _0x105737=await database_1['default']['payment'][_0x2a6571(0xa8)]({'where':{'id':_0x49b864},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x105737){_0x1376f6[_0x2a6571(0x86)](0x194)[_0x2a6571(0x97)]({'success':![],'error':_0x2a6571(0xab)});return;}if(_0x105737[_0x2a6571(0x88)]!==_0x2a6571(0xb0)&&_0x105737[_0x2a6571(0x88)]!==_0x2a6571(0xb6)){_0x1376f6[_0x2a6571(0x86)](0x190)[_0x2a6571(0x97)]({'success':![],'error':_0x2a6571(0x9b)+_0x105737[_0x2a6571(0x88)]});return;}let _0x1d9d54='',_0x15c5f6=_0x105737[_0x2a6571(0xa6)],_0x202354='';if(_0x105737[_0x2a6571(0x88)]===_0x2a6571(0xb0))_0x202354=_0x2a6571(0xc1),_0x15c5f6='CAD',_0x1d9d54=_0x2a6571(0x72)+_0x105737['amount']+'\x20'+_0x15c5f6+_0x2a6571(0x96);else _0x105737[_0x2a6571(0x88)]===_0x2a6571(0xb6)&&(_0x202354=_0x2a6571(0x9a),_0x15c5f6='EUR',_0x1d9d54=_0x2a6571(0x7c)+_0x105737[_0x2a6571(0x93)]+'\x20'+_0x15c5f6+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x440120={'success':!![],'data':{'paymentId':_0x105737['id'],'gateway':_0x105737[_0x2a6571(0x88)],'gatewayName':_0x105737[_0x2a6571(0x88)][_0x2a6571(0x77)](),'transferType':_0x202354,'amount':_0x105737['amount'],'currency':_0x15c5f6,'status':_0x105737[_0x2a6571(0x86)],'instructions':_0x1d9d54,'shopName':_0x105737['shop']['name']||_0x105737[_0x2a6571(0xbd)]['username'],'hasProof':![],'proofType':null,'createdAt':_0x105737[_0x2a6571(0xb4)],'updatedAt':_0x105737['updatedAt'],'supportedFileTypes':[_0x2a6571(0x79),_0x2a6571(0x67),_0x2a6571(0x91),_0x2a6571(0xad),_0x2a6571(0x8c)],'maxFileSize':_0x2a6571(0x7d)}};_0x1376f6[_0x2a6571(0x97)](_0x440120);}catch(_0x59b66f){console[_0x2a6571(0x6c)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x59b66f),_0x1376f6['status'](0x1f4)[_0x2a6571(0x97)]({'success':![],'error':_0x2a6571(0xaf),'details':_0x59b66f instanceof Error?_0x59b66f[_0x2a6571(0x6f)]:'Unknown\x20error'});}}}exports[a10_0x36c9a4(0x6e)]=ManualPaymentController,exports[a10_0x36c9a4(0x8e)]=new ManualPaymentController();