'use strict';const a11_0x1614d5=a11_0x5831;(function(_0x141d3d,_0x2ee903){const _0x56fbb3=a11_0x5831,_0x1317c2=_0x141d3d();while(!![]){try{const _0x41aa90=parseInt(_0x56fbb3(0xdc))/0x1+-parseInt(_0x56fbb3(0xb9))/0x2+parseInt(_0x56fbb3(0x92))/0x3*(-parseInt(_0x56fbb3(0x84))/0x4)+-parseInt(_0x56fbb3(0x8e))/0x5+parseInt(_0x56fbb3(0x9c))/0x6*(-parseInt(_0x56fbb3(0xd7))/0x7)+parseInt(_0x56fbb3(0xaf))/0x8*(-parseInt(_0x56fbb3(0x87))/0x9)+-parseInt(_0x56fbb3(0xb4))/0xa*(-parseInt(_0x56fbb3(0xb0))/0xb);if(_0x41aa90===_0x2ee903)break;else _0x1317c2['push'](_0x1317c2['shift']());}catch(_0x1cca43){_0x1317c2['push'](_0x1317c2['shift']());}}}(a11_0x37ed,0xee36a));function a11_0x5831(_0x37effb,_0xd208dc){_0x37effb=_0x37effb-0x7c;const _0x37ed95=a11_0x37ed();let _0x5831e9=_0x37ed95[_0x37effb];return _0x5831e9;}function a11_0x37ed(){const _0x215b6e=['base64','__importDefault','__esModule','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','shopId','JPEG','2561514SOyhAw','jpeg','currency','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a',',\x20size:\x20','payment','shop','.\x20Supported:\x20','updatedAt','File\x20data\x20is\x20required','SEPA\x20Bank\x20Transfer','sendDirectMessage','../services/telegramBotService','default','join','uploadPaymentProof','gateway','üí∞\x20Amount:\x20','JPG','16yDLCEH','11tCQOsN','error','payment_proof_','body','30489110PDEBuc','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','png','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','pdf','2672832dzldRN','connection','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','\x20\x20\x20-\x20Gateway:\x20','HEIC','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','Payment\x20not\x20found','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','round','PDF','sendShopNotification','EUR','username','\x20\x20\x20-\x20Payment\x20ID:\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent','Invalid\x20base64\x20file\x20data','update','7867339505','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','sepa','CAD','10MB','üåê\x20Client\x20IP:\x20','name','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','PROCESSING','amount','ManualPaymentController','üìÅ\x20File:\x20','7vBoMRB','includes','üåê\x20Customer\x20IP:\x20','Unsupported\x20file\x20type:\x20','toUpperCase','930917FNGaWZ','Unknown\x20error','log','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','manualPaymentController','findUnique','unknown','üîÑ\x20','\x20Payment\x20Proof\x20Received\x0a\x0a','json','toLowerCase','createdAt','length','sendDirectFile','from','telegramBotService','1868696plHSRc','üìÅ\x20File\x20type:\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','2588238CaLbbp','KB)\x0a','üè™\x20Shop:\x20','defineProperty','Internal\x20server\x20error','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','üí≥\x20Payment\x20ID:\x20','992165rCzySl','remoteAddress','Interac\x20e-Transfer','message','3OPMKgq','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','status','üìã\x20Get\x20manual\x20payment\x20info:\x20'];a11_0x37ed=function(){return _0x215b6e;};return a11_0x37ed();}var __importDefault=this&&this[a11_0x1614d5(0x97)]||function(_0x1f8240){const _0x41f6bc=a11_0x1614d5;return _0x1f8240&&_0x1f8240[_0x41f6bc(0x98)]?_0x1f8240:{'default':_0x1f8240};};Object[a11_0x1614d5(0x8a)](exports,a11_0x1614d5(0x98),{'value':!![]}),exports[a11_0x1614d5(0xe0)]=exports[a11_0x1614d5(0xd5)]=void 0x0;const database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a11_0x1614d5(0xa8));class ManualPaymentController{async[a11_0x1614d5(0xab)](_0x27327a,_0x493470){const _0x572c41=a11_0x1614d5;try{const {paymentId:_0x1ab350,fileData:_0x44254d,fileType:_0xcb5908,fileName:_0x5f2704}=_0x27327a[_0x572c41(0xb3)],_0x35da9d=_0x27327a['ip']||_0x27327a[_0x572c41(0xba)]?.[_0x572c41(0x8f)]||_0x572c41(0xe2);console[_0x572c41(0xde)](_0x572c41(0xbe)+_0x1ab350),console['log'](_0x572c41(0x85)+_0xcb5908+_0x572c41(0xa0)+(_0x44254d?Math[_0x572c41(0xc2)](_0x44254d[_0x572c41(0x80)]*0.75/0x400):0x0)+'KB'),console[_0x572c41(0xde)](_0x572c41(0xd0)+_0x35da9d);if(!_0x1ab350){_0x493470[_0x572c41(0x94)](0x190)['json']({'success':![],'error':'Payment\x20ID\x20is\x20required'});return;}if(!_0x44254d){_0x493470[_0x572c41(0x94)](0x190)[_0x572c41(0x7d)]({'success':![],'error':_0x572c41(0xa5)});return;}if(!_0xcb5908){_0x493470[_0x572c41(0x94)](0x190)[_0x572c41(0x7d)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x55e276=[_0x572c41(0xb6),'jpg',_0x572c41(0x9d),'heic',_0x572c41(0xb8)],_0x2f2311=_0xcb5908[_0x572c41(0x7e)]()['replace']('.','');if(!_0x55e276[_0x572c41(0xd8)](_0x2f2311)){_0x493470['status'](0x190)['json']({'success':![],'error':_0x572c41(0xda)+_0xcb5908+_0x572c41(0xa3)+_0x55e276[_0x572c41(0xaa)](',\x20')});return;}const _0x449184=0xa*0x400*0x400;if(_0x44254d[_0x572c41(0x80)]>_0x449184){_0x493470[_0x572c41(0x94)](0x190)[_0x572c41(0x7d)]({'success':![],'error':_0x572c41(0x99)});return;}const _0x3015b1=await database_1[_0x572c41(0xa9)][_0x572c41(0xa1)][_0x572c41(0xe1)]({'where':{'id':_0x1ab350},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3015b1){console[_0x572c41(0xde)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x1ab350),_0x493470['status'](0x194)['json']({'success':![],'error':_0x572c41(0xbf)});return;}if(_0x3015b1[_0x572c41(0xac)]!=='interac'&&_0x3015b1['gateway']!=='sepa'){console[_0x572c41(0xde)]('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x3015b1[_0x572c41(0xac)]),_0x493470[_0x572c41(0x94)](0x190)[_0x572c41(0x7d)]({'success':![],'error':_0x572c41(0x93)+_0x3015b1['gateway']});return;}let _0x128340=_0x44254d;_0x44254d[_0x572c41(0xd8)](',')&&(_0x128340=_0x44254d['split'](',')[0x1]);try{Buffer[_0x572c41(0x82)](_0x128340,_0x572c41(0x96));}catch(_0x39fca4){_0x493470[_0x572c41(0x94)](0x190)[_0x572c41(0x7d)]({'success':![],'error':_0x572c41(0xc9)});return;}const _0x2f28c0=await database_1[_0x572c41(0xa9)]['payment'][_0x572c41(0xca)]({'where':{'id':_0x1ab350},'data':{'status':_0x572c41(0xd3),'updatedAt':new Date()}});console[_0x572c41(0xde)](_0x572c41(0xb5)),console[_0x572c41(0xde)](_0x572c41(0xc7)+_0x1ab350),console[_0x572c41(0xde)](_0x572c41(0xbc)+_0x3015b1[_0x572c41(0xac)][_0x572c41(0xdb)]()),console['log']('\x20\x20\x20-\x20File\x20type:\x20'+_0x2f2311),console[_0x572c41(0xde)]('\x20\x20\x20-\x20File\x20size:\x20'+Math[_0x572c41(0xc2)](_0x128340['length']*0.75/0x400)+'KB'),console[_0x572c41(0xde)](_0x572c41(0x86));try{const _0x1cc976=_0x3015b1['gateway'][_0x572c41(0xdb)](),_0x283356=_0x3015b1[_0x572c41(0xa2)]['name']||_0x3015b1[_0x572c41(0xa2)][_0x572c41(0xc6)],_0x1a85a=Math[_0x572c41(0xc2)](_0x128340['length']*0.75/0x400),_0x4ff95a=_0x572c41(0xe3)+_0x1cc976+_0x572c41(0x7c)+('üí≥\x20Payment\x20ID:\x20'+_0x1ab350+'\x0a')+(_0x572c41(0xad)+_0x3015b1[_0x572c41(0xd4)]+'\x20'+_0x3015b1[_0x572c41(0x9e)]+'\x0a')+(_0x572c41(0xd6)+_0x2f2311[_0x572c41(0xdb)]()+'\x20('+_0x1a85a+'KB)\x0a')+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+('üåê\x20Customer\x20IP:\x20'+_0x35da9d+'\x0a\x0a')+_0x572c41(0x8c);await telegramBotService_1[_0x572c41(0x83)][_0x572c41(0xc4)](_0x3015b1['shopId'],_0x4ff95a,{'parse_mode':'Markdown'});const _0x20433a=Buffer[_0x572c41(0x82)](_0x128340,'base64'),_0x4e683f=_0x572c41(0xb2)+_0x1ab350+'.'+_0x2f2311;await telegramBotService_1[_0x572c41(0x83)]['sendShopFile'](_0x3015b1[_0x572c41(0x9a)],_0x20433a,_0x4e683f,'Payment\x20proof\x20for\x20'+_0x1ab350),console[_0x572c41(0xde)]('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x3076ba=_0x572c41(0xcb),_0x19f2f6=_0x572c41(0xe3)+_0x1cc976+_0x572c41(0xc1)+(_0x572c41(0x8d)+_0x1ab350+'\x0a')+(_0x572c41(0x89)+_0x283356+'\x0a')+(_0x572c41(0xad)+_0x3015b1[_0x572c41(0xd4)]+'\x20'+_0x3015b1[_0x572c41(0x9e)]+'\x0a')+(_0x572c41(0xd6)+_0x2f2311[_0x572c41(0xdb)]()+'\x20('+_0x1a85a+_0x572c41(0x88))+_0x572c41(0x9f)+(_0x572c41(0xd9)+_0x35da9d+'\x0a\x0a')+_0x572c41(0xb7);await telegramBotService_1['telegramBotService'][_0x572c41(0xa7)](parseInt(_0x3076ba),_0x19f2f6),await telegramBotService_1[_0x572c41(0x83)][_0x572c41(0x81)](parseInt(_0x3076ba),_0x20433a,_0x4e683f,_0x572c41(0xbb)+_0x1ab350),console[_0x572c41(0xde)](_0x572c41(0xc8));}catch(_0x523c32){console[_0x572c41(0xb1)]('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:',_0x523c32);}_0x493470[_0x572c41(0x7d)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x2f28c0['id'],'status':_0x2f28c0['status'],'gateway':_0x3015b1[_0x572c41(0xac)],'fileType':_0x2f2311,'fileSize':Math[_0x572c41(0xc2)](_0x128340[_0x572c41(0x80)]*0.75/0x400)+'KB','uploadedAt':_0x2f28c0[_0x572c41(0xa4)]}});}catch(_0x324c8e){console[_0x572c41(0xb1)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x324c8e),_0x493470[_0x572c41(0x94)](0x1f4)[_0x572c41(0x7d)]({'success':![],'error':_0x572c41(0x8b),'details':_0x324c8e instanceof Error?_0x324c8e[_0x572c41(0x91)]:'Unknown\x20error'});}}async['getManualPaymentInfo'](_0x23c69f,_0x4217a7){const _0x1fdc07=a11_0x1614d5;try{const {paymentId:_0xccd654}=_0x23c69f['params'];console['log'](_0x1fdc07(0x95)+_0xccd654);const _0xaab005=await database_1[_0x1fdc07(0xa9)][_0x1fdc07(0xa1)][_0x1fdc07(0xe1)]({'where':{'id':_0xccd654},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xaab005){_0x4217a7[_0x1fdc07(0x94)](0x194)[_0x1fdc07(0x7d)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0xaab005[_0x1fdc07(0xac)]!=='interac'&&_0xaab005[_0x1fdc07(0xac)]!==_0x1fdc07(0xcd)){_0x4217a7[_0x1fdc07(0x94)](0x190)[_0x1fdc07(0x7d)]({'success':![],'error':_0x1fdc07(0xdf)+_0xaab005[_0x1fdc07(0xac)]});return;}let _0x387419='',_0x25baa4=_0xaab005[_0x1fdc07(0x9e)],_0x259220='';if(_0xaab005['gateway']==='interac')_0x259220=_0x1fdc07(0x90),_0x25baa4=_0x1fdc07(0xce),_0x387419=_0x1fdc07(0xc0)+_0xaab005[_0x1fdc07(0xd4)]+'\x20'+_0x25baa4+_0x1fdc07(0xcc);else _0xaab005[_0x1fdc07(0xac)]===_0x1fdc07(0xcd)&&(_0x259220=_0x1fdc07(0xa6),_0x25baa4=_0x1fdc07(0xc5),_0x387419=_0x1fdc07(0xd2)+_0xaab005[_0x1fdc07(0xd4)]+'\x20'+_0x25baa4+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x658775={'success':!![],'data':{'paymentId':_0xaab005['id'],'gateway':_0xaab005[_0x1fdc07(0xac)],'gatewayName':_0xaab005['gateway'][_0x1fdc07(0xdb)](),'transferType':_0x259220,'amount':_0xaab005[_0x1fdc07(0xd4)],'currency':_0x25baa4,'status':_0xaab005['status'],'instructions':_0x387419,'shopName':_0xaab005[_0x1fdc07(0xa2)][_0x1fdc07(0xd1)]||_0xaab005[_0x1fdc07(0xa2)][_0x1fdc07(0xc6)],'hasProof':![],'proofType':null,'createdAt':_0xaab005[_0x1fdc07(0x7f)],'updatedAt':_0xaab005[_0x1fdc07(0xa4)],'supportedFileTypes':['PNG',_0x1fdc07(0xae),_0x1fdc07(0x9b),_0x1fdc07(0xbd),_0x1fdc07(0xc3)],'maxFileSize':_0x1fdc07(0xcf)}};_0x4217a7[_0x1fdc07(0x7d)](_0x658775);}catch(_0x23510a){console[_0x1fdc07(0xb1)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x23510a),_0x4217a7['status'](0x1f4)[_0x1fdc07(0x7d)]({'success':![],'error':_0x1fdc07(0x8b),'details':_0x23510a instanceof Error?_0x23510a['message']:_0x1fdc07(0xdd)});}}}exports[a11_0x1614d5(0xd5)]=ManualPaymentController,exports[a11_0x1614d5(0xe0)]=new ManualPaymentController();