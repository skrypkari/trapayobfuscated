'use strict';const a8_0x533d5b=a8_0x7147;(function(_0x59e1bd,_0x1144b0){const _0x3b02bc=a8_0x7147,_0x75f2a4=_0x59e1bd();while(!![]){try{const _0x5c6db4=-parseInt(_0x3b02bc(0x113))/0x1*(-parseInt(_0x3b02bc(0x10c))/0x2)+-parseInt(_0x3b02bc(0xf4))/0x3+-parseInt(_0x3b02bc(0xcf))/0x4+parseInt(_0x3b02bc(0x111))/0x5+-parseInt(_0x3b02bc(0x109))/0x6+-parseInt(_0x3b02bc(0x103))/0x7+parseInt(_0x3b02bc(0xd8))/0x8*(parseInt(_0x3b02bc(0xf3))/0x9);if(_0x5c6db4===_0x1144b0)break;else _0x75f2a4['push'](_0x75f2a4['shift']());}catch(_0x15ec68){_0x75f2a4['push'](_0x75f2a4['shift']());}}}(a8_0x394a,0x7174b));var __importDefault=this&&this[a8_0x533d5b(0x10b)]||function(_0x5a8c7e){const _0x354257=a8_0x533d5b;return _0x5a8c7e&&_0x5a8c7e[_0x354257(0x126)]?_0x5a8c7e:{'default':_0x5a8c7e};};Object[a8_0x533d5b(0xed)](exports,a8_0x533d5b(0x126),{'value':!![]}),exports['manualPaymentController']=exports['ManualPaymentController']=void 0x0;function a8_0x394a(){const _0x1a7de5=['toUpperCase','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','telegramBotService','EUR','status','321656vmmfRm','message','log','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','../config/database','üåê\x20Customer\x20IP:\x20','Payment\x20not\x20found','Payment\x20proof\x20for\x20','shopId','2049928sBGMhz','body','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','üí≥\x20Payment\x20ID:\x20','length','Unsupported\x20file\x20type:\x20','heic','sepa','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','round','connection','üìã\x20Get\x20manual\x20payment\x20info:\x20','\x20\x20\x20-\x20Gateway:\x20','üìÅ\x20File:\x20','json','from','sendShopNotification','Payment\x20ID\x20is\x20required','sendDirectFile','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','updatedAt','defineProperty','uploadPaymentProof','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','params','pdf','interac','54GIZsPW','2128755gWrNhe','jpg','üí∞\x20Amount:\x20','Unknown\x20error','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','Payment\x20proof\x20uploaded\x20successfully','amount','currency','üè™\x20Shop:\x20','üîÑ\x20','.\x20Supported:\x20','includes','‚ùå\x20Upload\x20payment\x20proof\x20error:','JPG','KB)\x0a','1038989FkrMVs','sendDirectMessage','getManualPaymentInfo','10MB','ManualPaymentController','Internal\x20server\x20error','5459076BlbwHQ','üåê\x20Client\x20IP:\x20','__importDefault','1502GsOgaC','‚ùå\x20Payment\x20not\x20found:\x20','shop','error','username','3442125vUOlvt','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','116gMgJhU','HEIC','JPEG','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','\x20\x20\x20-\x20File\x20size:\x20','CAD','SEPA\x20Bank\x20Transfer','base64','\x20Payment\x20Proof\x20Received\x0a\x0a','üì±\x20Admin\x20notification\x20and\x20file\x20sent','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','gateway','Invalid\x20base64\x20file\x20data','findUnique','remoteAddress','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','payment','default','__esModule','jpeg','\x20\x20\x20-\x20Payment\x20ID:\x20','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','manualPaymentController'];a8_0x394a=function(){return _0x1a7de5;};return a8_0x394a();}function a8_0x7147(_0x21286,_0x36ef48){const _0x394a16=a8_0x394a();return a8_0x7147=function(_0x7147cf,_0x440b93){_0x7147cf=_0x7147cf-0xcd;let _0x24ad04=_0x394a16[_0x7147cf];return _0x24ad04;},a8_0x7147(_0x21286,_0x36ef48);}const database_1=__importDefault(require(a8_0x533d5b(0xd3))),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async[a8_0x533d5b(0xee)](_0x5c1187,_0x5a297e){const _0xa77982=a8_0x533d5b;try{const {paymentId:_0x54c273,fileData:_0x461ba5,fileType:_0x28a384,fileName:_0xc12308}=_0x5c1187[_0xa77982(0xd9)],_0x4120d6=_0x5c1187['ip']||_0x5c1187[_0xa77982(0xe2)]?.[_0xa77982(0x122)]||'unknown';console[_0xa77982(0xd1)](_0xa77982(0xda)+_0x54c273),console[_0xa77982(0xd1)]('üìÅ\x20File\x20type:\x20'+_0x28a384+',\x20size:\x20'+(_0x461ba5?Math['round'](_0x461ba5[_0xa77982(0xdc)]*0.75/0x400):0x0)+'KB'),console['log'](_0xa77982(0x10a)+_0x4120d6);if(!_0x54c273){_0x5a297e[_0xa77982(0xce)](0x190)[_0xa77982(0xe6)]({'success':![],'error':_0xa77982(0xe9)});return;}if(!_0x461ba5){_0x5a297e[_0xa77982(0xce)](0x190)['json']({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x28a384){_0x5a297e[_0xa77982(0xce)](0x190)[_0xa77982(0xe6)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x4d59eb=['png',_0xa77982(0xf5),_0xa77982(0x127),_0xa77982(0xde),_0xa77982(0xf1)],_0x5dc99f=_0x28a384['toLowerCase']()['replace']('.','');if(!_0x4d59eb[_0xa77982(0xff)](_0x5dc99f)){_0x5a297e['status'](0x190)['json']({'success':![],'error':_0xa77982(0xdd)+_0x28a384+_0xa77982(0xfe)+_0x4d59eb['join'](',\x20')});return;}const _0x767893=0xa*0x400*0x400;if(_0x461ba5[_0xa77982(0xdc)]>_0x767893){_0x5a297e[_0xa77982(0xce)](0x190)[_0xa77982(0xe6)]({'success':![],'error':'File\x20too\x20large.\x20Maximum\x20size:\x2010MB'});return;}const _0x1a3f89=await database_1[_0xa77982(0x125)][_0xa77982(0x124)][_0xa77982(0x121)]({'where':{'id':_0x54c273},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1a3f89){console[_0xa77982(0xd1)](_0xa77982(0x10d)+_0x54c273),_0x5a297e[_0xa77982(0xce)](0x194)[_0xa77982(0xe6)]({'success':![],'error':_0xa77982(0xd5)});return;}if(_0x1a3f89[_0xa77982(0x11f)]!==_0xa77982(0xf2)&&_0x1a3f89[_0xa77982(0x11f)]!==_0xa77982(0xdf)){console['log'](_0xa77982(0x11e)+_0x1a3f89[_0xa77982(0x11f)]),_0x5a297e[_0xa77982(0xce)](0x190)[_0xa77982(0xe6)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x1a3f89[_0xa77982(0x11f)]});return;}let _0x32f985=_0x461ba5;_0x461ba5[_0xa77982(0xff)](',')&&(_0x32f985=_0x461ba5['split'](',')[0x1]);try{Buffer[_0xa77982(0xe7)](_0x32f985,_0xa77982(0x11b));}catch(_0xf127c2){_0x5a297e[_0xa77982(0xce)](0x190)['json']({'success':![],'error':_0xa77982(0x120)});return;}const _0x1ff261=await database_1[_0xa77982(0x125)][_0xa77982(0x124)]['update']({'where':{'id':_0x54c273},'data':{'status':'PROCESSING','updatedAt':new Date()}});console['log'](_0xa77982(0x112)),console['log'](_0xa77982(0x128)+_0x54c273),console['log'](_0xa77982(0xe4)+_0x1a3f89[_0xa77982(0x11f)][_0xa77982(0x12b)]()),console['log']('\x20\x20\x20-\x20File\x20type:\x20'+_0x5dc99f),console[_0xa77982(0xd1)](_0xa77982(0x118)+Math['round'](_0x32f985[_0xa77982(0xdc)]*0.75/0x400)+'KB'),console[_0xa77982(0xd1)](_0xa77982(0x117));try{const _0x5dbba5=_0x1a3f89[_0xa77982(0x11f)][_0xa77982(0x12b)](),_0x47a991=_0x1a3f89[_0xa77982(0x10e)]['name']||_0x1a3f89['shop'][_0xa77982(0x110)],_0x5eea90=Math[_0xa77982(0xe1)](_0x32f985[_0xa77982(0xdc)]*0.75/0x400),_0xc4f8f9=_0xa77982(0xfd)+_0x5dbba5+_0xa77982(0x11c)+(_0xa77982(0xdb)+_0x54c273+'\x0a')+('üí∞\x20Amount:\x20'+_0x1a3f89[_0xa77982(0xfa)]+'\x20'+_0x1a3f89[_0xa77982(0xfb)]+'\x0a')+(_0xa77982(0xe5)+_0x5dc99f[_0xa77982(0x12b)]()+'\x20('+_0x5eea90+_0xa77982(0x102))+_0xa77982(0x123)+(_0xa77982(0xd4)+_0x4120d6+'\x0a\x0a')+_0xa77982(0xef);await telegramBotService_1[_0xa77982(0x12d)][_0xa77982(0xe8)](_0x1a3f89[_0xa77982(0xd7)],_0xc4f8f9,{'parse_mode':'Markdown'});const _0x8b4352=Buffer[_0xa77982(0xe7)](_0x32f985,_0xa77982(0x11b)),_0x2ed49f='payment_proof_'+_0x54c273+'.'+_0x5dc99f;await telegramBotService_1[_0xa77982(0x12d)]['sendShopFile'](_0x1a3f89[_0xa77982(0xd7)],_0x8b4352,_0x2ed49f,_0xa77982(0xd6)+_0x54c273),console[_0xa77982(0xd1)]('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x45ae99='7867339505',_0x58f445=_0xa77982(0xfd)+_0x5dbba5+_0xa77982(0x12c)+(_0xa77982(0xdb)+_0x54c273+'\x0a')+(_0xa77982(0xfc)+_0x47a991+'\x0a')+(_0xa77982(0xf6)+_0x1a3f89[_0xa77982(0xfa)]+'\x20'+_0x1a3f89[_0xa77982(0xfb)]+'\x0a')+('üìÅ\x20File:\x20'+_0x5dc99f[_0xa77982(0x12b)]()+'\x20('+_0x5eea90+_0xa77982(0x102))+_0xa77982(0x123)+(_0xa77982(0xd4)+_0x4120d6+'\x0a\x0a')+_0xa77982(0xeb);await telegramBotService_1[_0xa77982(0x12d)][_0xa77982(0x104)](parseInt(_0x45ae99),_0x58f445),await telegramBotService_1['telegramBotService'][_0xa77982(0xea)](parseInt(_0x45ae99),_0x8b4352,_0x2ed49f,_0xa77982(0xe0)+_0x54c273),console[_0xa77982(0xd1)](_0xa77982(0x11d));}catch(_0x860878){console[_0xa77982(0x10f)](_0xa77982(0xf8),_0x860878);}_0x5a297e['json']({'success':!![],'message':_0xa77982(0xf9),'data':{'paymentId':_0x1ff261['id'],'status':_0x1ff261['status'],'gateway':_0x1a3f89[_0xa77982(0x11f)],'fileType':_0x5dc99f,'fileSize':Math[_0xa77982(0xe1)](_0x32f985[_0xa77982(0xdc)]*0.75/0x400)+'KB','uploadedAt':_0x1ff261['updatedAt']}});}catch(_0x2c7054){console['error'](_0xa77982(0x100),_0x2c7054),_0x5a297e[_0xa77982(0xce)](0x1f4)[_0xa77982(0xe6)]({'success':![],'error':_0xa77982(0x108),'details':_0x2c7054 instanceof Error?_0x2c7054[_0xa77982(0xd0)]:_0xa77982(0xf7)});}}async[a8_0x533d5b(0x105)](_0x126a6a,_0x208444){const _0x9a579=a8_0x533d5b;try{const {paymentId:_0x36b3b2}=_0x126a6a[_0x9a579(0xf0)];console[_0x9a579(0xd1)](_0x9a579(0xe3)+_0x36b3b2);const _0x20c895=await database_1['default'][_0x9a579(0x124)][_0x9a579(0x121)]({'where':{'id':_0x36b3b2},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x20c895){_0x208444['status'](0x194)[_0x9a579(0xe6)]({'success':![],'error':_0x9a579(0xd5)});return;}if(_0x20c895[_0x9a579(0x11f)]!==_0x9a579(0xf2)&&_0x20c895['gateway']!=='sepa'){_0x208444[_0x9a579(0xce)](0x190)[_0x9a579(0xe6)]({'success':![],'error':_0x9a579(0x129)+_0x20c895[_0x9a579(0x11f)]});return;}let _0x869425='',_0x2b34fe=_0x20c895[_0x9a579(0xfb)],_0x4e5e04='';if(_0x20c895[_0x9a579(0x11f)]===_0x9a579(0xf2))_0x4e5e04='Interac\x20e-Transfer',_0x2b34fe=_0x9a579(0x119),_0x869425=_0x9a579(0x116)+_0x20c895[_0x9a579(0xfa)]+'\x20'+_0x2b34fe+_0x9a579(0xd2);else _0x20c895[_0x9a579(0x11f)]==='sepa'&&(_0x4e5e04=_0x9a579(0x11a),_0x2b34fe=_0x9a579(0xcd),_0x869425='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x20c895[_0x9a579(0xfa)]+'\x20'+_0x2b34fe+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0xf58bc6={'success':!![],'data':{'paymentId':_0x20c895['id'],'gateway':_0x20c895['gateway'],'gatewayName':_0x20c895[_0x9a579(0x11f)]['toUpperCase'](),'transferType':_0x4e5e04,'amount':_0x20c895[_0x9a579(0xfa)],'currency':_0x2b34fe,'status':_0x20c895['status'],'instructions':_0x869425,'shopName':_0x20c895[_0x9a579(0x10e)]['name']||_0x20c895[_0x9a579(0x10e)][_0x9a579(0x110)],'hasProof':![],'proofType':null,'createdAt':_0x20c895['createdAt'],'updatedAt':_0x20c895[_0x9a579(0xec)],'supportedFileTypes':['PNG',_0x9a579(0x101),_0x9a579(0x115),_0x9a579(0x114),'PDF'],'maxFileSize':_0x9a579(0x106)}};_0x208444[_0x9a579(0xe6)](_0xf58bc6);}catch(_0x580424){console[_0x9a579(0x10f)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x580424),_0x208444['status'](0x1f4)[_0x9a579(0xe6)]({'success':![],'error':'Internal\x20server\x20error','details':_0x580424 instanceof Error?_0x580424['message']:_0x9a579(0xf7)});}}}exports[a8_0x533d5b(0x107)]=ManualPaymentController,exports[a8_0x533d5b(0x12a)]=new ManualPaymentController();