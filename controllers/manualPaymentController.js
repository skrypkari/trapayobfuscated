'use strict';const a9_0x5e478f=a9_0x5eb6;(function(_0x3a7640,_0x1658d1){const _0x2416f6=a9_0x5eb6,_0x2f3c73=_0x3a7640();while(!![]){try{const _0x20052d=-parseInt(_0x2416f6(0xdc))/0x1*(parseInt(_0x2416f6(0xcf))/0x2)+parseInt(_0x2416f6(0xd6))/0x3+-parseInt(_0x2416f6(0xa8))/0x4+-parseInt(_0x2416f6(0xc9))/0x5*(-parseInt(_0x2416f6(0xb9))/0x6)+parseInt(_0x2416f6(0xac))/0x7*(parseInt(_0x2416f6(0xc3))/0x8)+-parseInt(_0x2416f6(0xa4))/0x9+parseInt(_0x2416f6(0xe6))/0xa;if(_0x20052d===_0x1658d1)break;else _0x2f3c73['push'](_0x2f3c73['shift']());}catch(_0x5abf3e){_0x2f3c73['push'](_0x2f3c73['shift']());}}}(a9_0x39cf,0xb2913));var __importDefault=this&&this[a9_0x5e478f(0xbb)]||function(_0x21de35){const _0x137789=a9_0x5e478f;return _0x21de35&&_0x21de35[_0x137789(0xd2)]?_0x21de35:{'default':_0x21de35};};Object['defineProperty'](exports,a9_0x5e478f(0xd2),{'value':!![]}),exports[a9_0x5e478f(0xc0)]=exports['ManualPaymentController']=void 0x0;function a9_0x39cf(){const _0x2f5562=['shopId','14392CErNSt','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','File\x20data\x20is\x20required','default','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','username','\x20Payment\x20Proof\x20Received\x0a\x0a','toLowerCase','Interac\x20e-Transfer','from','status','sendShopFile','telegramBotService','2935290bjUtEL','Payment\x20proof\x20for\x20','__importDefault','replace','Unsupported\x20file\x20type:\x20','unknown','round','manualPaymentController','name','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','2048NjTPsQ','Unknown\x20error','üìÅ\x20File\x20type:\x20','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','sendDirectMessage','üí∞\x20Amount:\x20','5SuTTvK','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','png','log','üåê\x20Customer\x20IP:\x20','2492xVkcbg','sendShopNotification','File\x20type\x20is\x20required','__esModule','ManualPaymentController','\x20\x20\x20-\x20File\x20type:\x20','getManualPaymentInfo','2387862dLJsZS','sepa','KB)\x0a','PNG','Payment\x20not\x20found','amount','821AHNxpV','payment_proof_','createdAt','üîÑ\x20','10MB','jpeg','join','uploadPaymentProof','7867339505','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','26253650MkLccL','gateway','üìã\x20Get\x20manual\x20payment\x20info:\x20','\x20\x20\x20-\x20File\x20size:\x20','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','../services/telegramBotService','split','currency','Markdown','length','Invalid\x20base64\x20file\x20data','sendDirectFile','üåê\x20Client\x20IP:\x20','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','EUR','PROCESSING','\x20\x20\x20-\x20Payment\x20ID:\x20','üìÅ\x20File:\x20','payment','findUnique','\x20\x20\x20-\x20Gateway:\x20','JPEG','includes','connection','JPG','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','PDF','üè™\x20Shop:\x20','shop','error','heic','üí≥\x20Payment\x20ID:\x20','pdf','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','‚ùå\x20Upload\x20payment\x20proof\x20error:','toUpperCase','Internal\x20server\x20error','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','‚ùå\x20Payment\x20not\x20found:\x20','12691170KPXIFy','Payment\x20ID\x20is\x20required',',\x20size:\x20','json','5089452pUSpdG','message','update'];a9_0x39cf=function(){return _0x2f5562;};return a9_0x39cf();}function a9_0x5eb6(_0x459dea,_0x5b34c0){_0x459dea=_0x459dea-0x9d;const _0x39cff1=a9_0x39cf();let _0x5eb6d0=_0x39cff1[_0x459dea];return _0x5eb6d0;}const database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a9_0x5e478f(0xeb));class ManualPaymentController{async[a9_0x5e478f(0xe3)](_0x2e1ea6,_0x2a1177){const _0x667eb8=a9_0x5e478f;try{const {paymentId:_0x1cd322,fileData:_0x5c2b1e,fileType:_0x3feb23,fileName:_0x36d75b}=_0x2e1ea6['body'],_0x58d1a2=_0x2e1ea6['ip']||_0x2e1ea6[_0x667eb8(0xfd)]?.['remoteAddress']||_0x667eb8(0xbe);console[_0x667eb8(0xcd)]('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x1cd322),console[_0x667eb8(0xcd)](_0x667eb8(0xc5)+_0x3feb23+_0x667eb8(0xa6)+(_0x5c2b1e?Math[_0x667eb8(0xbf)](_0x5c2b1e[_0x667eb8(0xef)]*0.75/0x400):0x0)+'KB'),console[_0x667eb8(0xcd)](_0x667eb8(0xf2)+_0x58d1a2);if(!_0x1cd322){_0x2a1177['status'](0x190)[_0x667eb8(0xa7)]({'success':![],'error':_0x667eb8(0xa5)});return;}if(!_0x5c2b1e){_0x2a1177['status'](0x190)[_0x667eb8(0xa7)]({'success':![],'error':_0x667eb8(0xae)});return;}if(!_0x3feb23){_0x2a1177[_0x667eb8(0xb6)](0x190)['json']({'success':![],'error':_0x667eb8(0xd1)});return;}const _0x20960e=[_0x667eb8(0xcc),'jpg',_0x667eb8(0xe1),_0x667eb8(0x104),_0x667eb8(0x9d)],_0x175968=_0x3feb23[_0x667eb8(0xb3)]()[_0x667eb8(0xbc)]('.','');if(!_0x20960e[_0x667eb8(0xfc)](_0x175968)){_0x2a1177[_0x667eb8(0xb6)](0x190)[_0x667eb8(0xa7)]({'success':![],'error':_0x667eb8(0xbd)+_0x3feb23+'.\x20Supported:\x20'+_0x20960e[_0x667eb8(0xe2)](',\x20')});return;}const _0x4ef710=0xa*0x400*0x400;if(_0x5c2b1e['length']>_0x4ef710){_0x2a1177[_0x667eb8(0xb6)](0x190)[_0x667eb8(0xa7)]({'success':![],'error':'File\x20too\x20large.\x20Maximum\x20size:\x2010MB'});return;}const _0x1cbd4f=await database_1['default']['payment'][_0x667eb8(0xf9)]({'where':{'id':_0x1cd322},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1cbd4f){console[_0x667eb8(0xcd)](_0x667eb8(0xa3)+_0x1cd322),_0x2a1177['status'](0x194)[_0x667eb8(0xa7)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x1cbd4f[_0x667eb8(0xe7)]!=='interac'&&_0x1cbd4f[_0x667eb8(0xe7)]!==_0x667eb8(0xd7)){console[_0x667eb8(0xcd)](_0x667eb8(0xea)+_0x1cbd4f[_0x667eb8(0xe7)]),_0x2a1177[_0x667eb8(0xb6)](0x190)[_0x667eb8(0xa7)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x1cbd4f[_0x667eb8(0xe7)]});return;}let _0x5657d8=_0x5c2b1e;_0x5c2b1e[_0x667eb8(0xfc)](',')&&(_0x5657d8=_0x5c2b1e[_0x667eb8(0xec)](',')[0x1]);try{Buffer[_0x667eb8(0xb5)](_0x5657d8,'base64');}catch(_0x4f97f6){_0x2a1177['status'](0x190)[_0x667eb8(0xa7)]({'success':![],'error':_0x667eb8(0xf0)});return;}const _0x231c5e=await database_1[_0x667eb8(0xaf)][_0x667eb8(0xf8)][_0x667eb8(0xaa)]({'where':{'id':_0x1cd322},'data':{'status':_0x667eb8(0xf5),'updatedAt':new Date()}});console['log'](_0x667eb8(0xca)),console[_0x667eb8(0xcd)](_0x667eb8(0xf6)+_0x1cd322),console[_0x667eb8(0xcd)](_0x667eb8(0xfa)+_0x1cbd4f[_0x667eb8(0xe7)][_0x667eb8(0xa0)]()),console['log'](_0x667eb8(0xd4)+_0x175968),console['log'](_0x667eb8(0xe9)+Math[_0x667eb8(0xbf)](_0x5657d8[_0x667eb8(0xef)]*0.75/0x400)+'KB'),console[_0x667eb8(0xcd)]('\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING');try{const _0x39db25=_0x1cbd4f[_0x667eb8(0xe7)][_0x667eb8(0xa0)](),_0x10b9e5=_0x1cbd4f[_0x667eb8(0x102)][_0x667eb8(0xc1)]||_0x1cbd4f[_0x667eb8(0x102)][_0x667eb8(0xb1)],_0x4a6045=Math[_0x667eb8(0xbf)](_0x5657d8[_0x667eb8(0xef)]*0.75/0x400),_0x1d9aa4=_0x667eb8(0xdf)+_0x39db25+_0x667eb8(0xb2)+(_0x667eb8(0x105)+_0x1cd322+'\x0a')+(_0x667eb8(0xc8)+_0x1cbd4f['amount']+'\x20'+_0x1cbd4f['currency']+'\x0a')+(_0x667eb8(0xf7)+_0x175968[_0x667eb8(0xa0)]()+'\x20('+_0x4a6045+_0x667eb8(0xd8))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x667eb8(0xce)+_0x58d1a2+'\x0a\x0a')+'‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1[_0x667eb8(0xb8)][_0x667eb8(0xd0)](_0x1cbd4f[_0x667eb8(0xab)],_0x1d9aa4,{'parse_mode':_0x667eb8(0xee)});const _0x2cd3d1=Buffer[_0x667eb8(0xb5)](_0x5657d8,'base64'),_0x5ee07c=_0x667eb8(0xdd)+_0x1cd322+'.'+_0x175968;await telegramBotService_1[_0x667eb8(0xb8)][_0x667eb8(0xb7)](_0x1cbd4f['shopId'],_0x2cd3d1,_0x5ee07c,_0x667eb8(0xba)+_0x1cd322),console[_0x667eb8(0xcd)](_0x667eb8(0xa2));const _0x5a87c5=_0x667eb8(0xe4),_0x253b15=_0x667eb8(0xdf)+_0x39db25+_0x667eb8(0xc6)+('üí≥\x20Payment\x20ID:\x20'+_0x1cd322+'\x0a')+(_0x667eb8(0x101)+_0x10b9e5+'\x0a')+(_0x667eb8(0xc8)+_0x1cbd4f['amount']+'\x20'+_0x1cbd4f[_0x667eb8(0xed)]+'\x0a')+('üìÅ\x20File:\x20'+_0x175968['toUpperCase']()+'\x20('+_0x4a6045+_0x667eb8(0xd8))+_0x667eb8(0xc2)+(_0x667eb8(0xce)+_0x58d1a2+'\x0a\x0a')+_0x667eb8(0xad);await telegramBotService_1['telegramBotService'][_0x667eb8(0xc7)](parseInt(_0x5a87c5),_0x253b15),await telegramBotService_1['telegramBotService'][_0x667eb8(0xf1)](parseInt(_0x5a87c5),_0x2cd3d1,_0x5ee07c,_0x667eb8(0xf3)+_0x1cd322),console[_0x667eb8(0xcd)]('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x538b79){console['error'](_0x667eb8(0xe5),_0x538b79);}_0x2a1177[_0x667eb8(0xa7)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x231c5e['id'],'status':_0x231c5e['status'],'gateway':_0x1cbd4f['gateway'],'fileType':_0x175968,'fileSize':Math['round'](_0x5657d8['length']*0.75/0x400)+'KB','uploadedAt':_0x231c5e['updatedAt']}});}catch(_0x5b6f90){console[_0x667eb8(0x103)](_0x667eb8(0x9f),_0x5b6f90),_0x2a1177[_0x667eb8(0xb6)](0x1f4)[_0x667eb8(0xa7)]({'success':![],'error':_0x667eb8(0xa1),'details':_0x5b6f90 instanceof Error?_0x5b6f90[_0x667eb8(0xa9)]:'Unknown\x20error'});}}async[a9_0x5e478f(0xd5)](_0x40103d,_0x5f1755){const _0x545a16=a9_0x5e478f;try{const {paymentId:_0x2c8937}=_0x40103d['params'];console[_0x545a16(0xcd)](_0x545a16(0xe8)+_0x2c8937);const _0x1ac2dc=await database_1[_0x545a16(0xaf)][_0x545a16(0xf8)][_0x545a16(0xf9)]({'where':{'id':_0x2c8937},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1ac2dc){_0x5f1755[_0x545a16(0xb6)](0x194)[_0x545a16(0xa7)]({'success':![],'error':_0x545a16(0xda)});return;}if(_0x1ac2dc[_0x545a16(0xe7)]!=='interac'&&_0x1ac2dc[_0x545a16(0xe7)]!==_0x545a16(0xd7)){_0x5f1755['status'](0x190)[_0x545a16(0xa7)]({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x1ac2dc['gateway']});return;}let _0x1a1ad3='',_0xfedb9e=_0x1ac2dc['currency'],_0x3f6b99='';if(_0x1ac2dc[_0x545a16(0xe7)]==='interac')_0x3f6b99=_0x545a16(0xb4),_0xfedb9e='CAD',_0x1a1ad3=_0x545a16(0x9e)+_0x1ac2dc[_0x545a16(0xdb)]+'\x20'+_0xfedb9e+_0x545a16(0xff);else _0x1ac2dc['gateway']==='sepa'&&(_0x3f6b99='SEPA\x20Bank\x20Transfer',_0xfedb9e=_0x545a16(0xf4),_0x1a1ad3=_0x545a16(0xb0)+_0x1ac2dc['amount']+'\x20'+_0xfedb9e+_0x545a16(0xff));const _0x2f390c={'success':!![],'data':{'paymentId':_0x1ac2dc['id'],'gateway':_0x1ac2dc[_0x545a16(0xe7)],'gatewayName':_0x1ac2dc[_0x545a16(0xe7)]['toUpperCase'](),'transferType':_0x3f6b99,'amount':_0x1ac2dc[_0x545a16(0xdb)],'currency':_0xfedb9e,'status':_0x1ac2dc['status'],'instructions':_0x1a1ad3,'shopName':_0x1ac2dc[_0x545a16(0x102)][_0x545a16(0xc1)]||_0x1ac2dc[_0x545a16(0x102)][_0x545a16(0xb1)],'hasProof':![],'proofType':null,'createdAt':_0x1ac2dc[_0x545a16(0xde)],'updatedAt':_0x1ac2dc['updatedAt'],'supportedFileTypes':[_0x545a16(0xd9),_0x545a16(0xfe),_0x545a16(0xfb),'HEIC',_0x545a16(0x100)],'maxFileSize':_0x545a16(0xe0)}};_0x5f1755[_0x545a16(0xa7)](_0x2f390c);}catch(_0x3bc308){console[_0x545a16(0x103)](_0x545a16(0xcb),_0x3bc308),_0x5f1755[_0x545a16(0xb6)](0x1f4)[_0x545a16(0xa7)]({'success':![],'error':_0x545a16(0xa1),'details':_0x3bc308 instanceof Error?_0x3bc308[_0x545a16(0xa9)]:_0x545a16(0xc4)});}}}exports[a9_0x5e478f(0xd3)]=ManualPaymentController,exports[a9_0x5e478f(0xc0)]=new ManualPaymentController();