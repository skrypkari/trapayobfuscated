'use strict';const a9_0x307776=a9_0x2ffc;function a9_0x2ffc(_0x5b281a,_0xc6440d){_0x5b281a=_0x5b281a-0x11c;const _0x3f5ea9=a9_0x3f5e();let _0x2ffca2=_0x3f5ea9[_0x5b281a];return _0x2ffca2;}(function(_0x43096a,_0xe65688){const _0x5602c6=a9_0x2ffc,_0x2cd805=_0x43096a();while(!![]){try{const _0x514c81=-parseInt(_0x5602c6(0x124))/0x1+-parseInt(_0x5602c6(0x129))/0x2*(-parseInt(_0x5602c6(0x141))/0x3)+-parseInt(_0x5602c6(0x166))/0x4+-parseInt(_0x5602c6(0x17c))/0x5*(-parseInt(_0x5602c6(0x180))/0x6)+-parseInt(_0x5602c6(0x153))/0x7*(parseInt(_0x5602c6(0x145))/0x8)+parseInt(_0x5602c6(0x174))/0x9+parseInt(_0x5602c6(0x12a))/0xa*(parseInt(_0x5602c6(0x142))/0xb);if(_0x514c81===_0xe65688)break;else _0x2cd805['push'](_0x2cd805['shift']());}catch(_0x4b0e66){_0x2cd805['push'](_0x2cd805['shift']());}}}(a9_0x3f5e,0x81f17));var __importDefault=this&&this['__importDefault']||function(_0x4a78dd){return _0x4a78dd&&_0x4a78dd['__esModule']?_0x4a78dd:{'default':_0x4a78dd};};function a9_0x3f5e(){const _0x18d439=['json','../services/telegramBotService','7867339505','../config/database','üìã\x20Get\x20manual\x20payment\x20info:\x20','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','üì±\x20Admin\x20notification\x20and\x20file\x20sent','jpg','PNG','122997DWEbot','55mrnIIs','body','ManualPaymentController','4904WiIsqw','telegramBotService','sendDirectMessage','unknown','amount','uploadPaymentProof','\x20\x20\x20-\x20File\x20size:\x20','\x20\x20\x20-\x20Payment\x20ID:\x20','.\x20Supported:\x20','sendShopNotification','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','from','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','findUnique','6041hPCyLN','\x20\x20\x20-\x20File\x20type:\x20','üîÑ\x20','Payment\x20proof\x20for\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','error','üí∞\x20Amount:\x20',',\x20size:\x20','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','KB)\x0a','\x20\x20\x20-\x20Gateway:\x20','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','üåê\x20Client\x20IP:\x20','username','toUpperCase','Payment\x20proof\x20uploaded\x20successfully','getManualPaymentInfo','Payment\x20ID\x20is\x20required','split','1579904nofovB','jpeg','length','round','heic','payment_proof_','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','sendDirectFile','interac','pdf','Unknown\x20error','‚ùå\x20Payment\x20not\x20found:\x20','log','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','815391OVHcDB','sepa','gateway','sendShopFile','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','JPG','remoteAddress','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','518555ESvSGR','File\x20data\x20is\x20required','default','üí≥\x20Payment\x20ID:\x20','6znLGoA','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','params','base64','HEIC','CAD','message','üè™\x20Shop:\x20','currency','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','10MB','Payment\x20not\x20found','394179mqkgYh','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','includes','defineProperty','38KWVZCM','1754260tfuYCk','File\x20type\x20is\x20required','payment','üåê\x20Customer\x20IP:\x20','shop','manualPaymentController','shopId','replace','status','Unsupported\x20file\x20type:\x20','name','connection','Internal\x20server\x20error','toLowerCase'];a9_0x3f5e=function(){return _0x18d439;};return a9_0x3f5e();}Object[a9_0x307776(0x128)](exports,'__esModule',{'value':!![]}),exports[a9_0x307776(0x12f)]=exports[a9_0x307776(0x144)]=void 0x0;const database_1=__importDefault(require(a9_0x307776(0x13b))),telegramBotService_1=require(a9_0x307776(0x139));class ManualPaymentController{async[a9_0x307776(0x14a)](_0x5a675e,_0x424f0e){const _0x3a34be=a9_0x307776;try{const {paymentId:_0x21a77c,fileData:_0x596728,fileType:_0x344292,fileName:_0x53d741}=_0x5a675e[_0x3a34be(0x143)],_0x16a49a=_0x5a675e['ip']||_0x5a675e[_0x3a34be(0x135)]?.[_0x3a34be(0x17a)]||_0x3a34be(0x148);console[_0x3a34be(0x172)]('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x21a77c),console['log']('üìÅ\x20File\x20type:\x20'+_0x344292+_0x3a34be(0x15a)+(_0x596728?Math['round'](_0x596728[_0x3a34be(0x168)]*0.75/0x400):0x0)+'KB'),console[_0x3a34be(0x172)](_0x3a34be(0x15f)+_0x16a49a);if(!_0x21a77c){_0x424f0e[_0x3a34be(0x132)](0x190)[_0x3a34be(0x138)]({'success':![],'error':_0x3a34be(0x164)});return;}if(!_0x596728){_0x424f0e['status'](0x190)[_0x3a34be(0x138)]({'success':![],'error':_0x3a34be(0x17d)});return;}if(!_0x344292){_0x424f0e['status'](0x190)[_0x3a34be(0x138)]({'success':![],'error':_0x3a34be(0x12b)});return;}const _0x27765b=['png',_0x3a34be(0x13f),_0x3a34be(0x167),_0x3a34be(0x16a),_0x3a34be(0x16f)],_0x34f148=_0x344292[_0x3a34be(0x137)]()[_0x3a34be(0x131)]('.','');if(!_0x27765b['includes'](_0x34f148)){_0x424f0e['status'](0x190)[_0x3a34be(0x138)]({'success':![],'error':_0x3a34be(0x133)+_0x344292+_0x3a34be(0x14d)+_0x27765b['join'](',\x20')});return;}const _0x3726a2=0xa*0x400*0x400;if(_0x596728[_0x3a34be(0x168)]>_0x3726a2){_0x424f0e[_0x3a34be(0x132)](0x190)[_0x3a34be(0x138)]({'success':![],'error':_0x3a34be(0x17b)});return;}const _0x4ff8bc=await database_1[_0x3a34be(0x17e)][_0x3a34be(0x12c)][_0x3a34be(0x152)]({'where':{'id':_0x21a77c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4ff8bc){console['log'](_0x3a34be(0x171)+_0x21a77c),_0x424f0e[_0x3a34be(0x132)](0x194)[_0x3a34be(0x138)]({'success':![],'error':_0x3a34be(0x123)});return;}if(_0x4ff8bc[_0x3a34be(0x176)]!==_0x3a34be(0x16e)&&_0x4ff8bc['gateway']!==_0x3a34be(0x175)){console[_0x3a34be(0x172)](_0x3a34be(0x178)+_0x4ff8bc[_0x3a34be(0x176)]),_0x424f0e['status'](0x190)[_0x3a34be(0x138)]({'success':![],'error':_0x3a34be(0x15b)+_0x4ff8bc[_0x3a34be(0x176)]});return;}let _0x4b1ff0=_0x596728;_0x596728[_0x3a34be(0x127)](',')&&(_0x4b1ff0=_0x596728[_0x3a34be(0x165)](',')[0x1]);try{Buffer[_0x3a34be(0x150)](_0x4b1ff0,_0x3a34be(0x183));}catch(_0x3fe990){_0x424f0e['status'](0x190)[_0x3a34be(0x138)]({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x3f583c=await database_1['default'][_0x3a34be(0x12c)]['update']({'where':{'id':_0x21a77c},'data':{'status':'PROCESSING','updatedAt':new Date()}});console[_0x3a34be(0x172)](_0x3a34be(0x126)),console[_0x3a34be(0x172)](_0x3a34be(0x14c)+_0x21a77c),console[_0x3a34be(0x172)](_0x3a34be(0x15d)+_0x4ff8bc['gateway'][_0x3a34be(0x161)]()),console[_0x3a34be(0x172)](_0x3a34be(0x154)+_0x34f148),console[_0x3a34be(0x172)](_0x3a34be(0x14b)+Math[_0x3a34be(0x169)](_0x4b1ff0[_0x3a34be(0x168)]*0.75/0x400)+'KB'),console[_0x3a34be(0x172)](_0x3a34be(0x157));try{const _0x867b2c=_0x4ff8bc[_0x3a34be(0x176)]['toUpperCase'](),_0x54f002=_0x4ff8bc['shop'][_0x3a34be(0x134)]||_0x4ff8bc[_0x3a34be(0x12e)][_0x3a34be(0x160)],_0x41b100=Math[_0x3a34be(0x169)](_0x4b1ff0['length']*0.75/0x400),_0x10abe5=_0x3a34be(0x155)+_0x867b2c+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0x3a34be(0x17f)+_0x21a77c+'\x0a')+(_0x3a34be(0x159)+_0x4ff8bc[_0x3a34be(0x149)]+'\x20'+_0x4ff8bc[_0x3a34be(0x120)]+'\x0a')+('üìÅ\x20File:\x20'+_0x34f148['toUpperCase']()+'\x20('+_0x41b100+_0x3a34be(0x15c))+_0x3a34be(0x14f)+(_0x3a34be(0x12d)+_0x16a49a+'\x0a\x0a')+_0x3a34be(0x151);await telegramBotService_1[_0x3a34be(0x146)][_0x3a34be(0x14e)](_0x4ff8bc[_0x3a34be(0x130)],_0x10abe5,{'parse_mode':'Markdown'});const _0x40fa14=Buffer[_0x3a34be(0x150)](_0x4b1ff0,_0x3a34be(0x183)),_0x5a0ad8=_0x3a34be(0x16b)+_0x21a77c+'.'+_0x34f148;await telegramBotService_1[_0x3a34be(0x146)][_0x3a34be(0x177)](_0x4ff8bc[_0x3a34be(0x130)],_0x40fa14,_0x5a0ad8,_0x3a34be(0x156)+_0x21a77c),console[_0x3a34be(0x172)](_0x3a34be(0x15e));const _0xef61b9=_0x3a34be(0x13a),_0x50ac75=_0x3a34be(0x155)+_0x867b2c+'\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a'+(_0x3a34be(0x17f)+_0x21a77c+'\x0a')+(_0x3a34be(0x11f)+_0x54f002+'\x0a')+(_0x3a34be(0x159)+_0x4ff8bc[_0x3a34be(0x149)]+'\x20'+_0x4ff8bc[_0x3a34be(0x120)]+'\x0a')+('üìÅ\x20File:\x20'+_0x34f148['toUpperCase']()+'\x20('+_0x41b100+_0x3a34be(0x15c))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x3a34be(0x12d)+_0x16a49a+'\x0a\x0a')+_0x3a34be(0x125);await telegramBotService_1[_0x3a34be(0x146)][_0x3a34be(0x147)](parseInt(_0xef61b9),_0x50ac75),await telegramBotService_1['telegramBotService'][_0x3a34be(0x16d)](parseInt(_0xef61b9),_0x40fa14,_0x5a0ad8,_0x3a34be(0x121)+_0x21a77c),console[_0x3a34be(0x172)](_0x3a34be(0x13e));}catch(_0x5e1df8){console[_0x3a34be(0x158)](_0x3a34be(0x173),_0x5e1df8);}_0x424f0e['json']({'success':!![],'message':_0x3a34be(0x162),'data':{'paymentId':_0x3f583c['id'],'status':_0x3f583c[_0x3a34be(0x132)],'gateway':_0x4ff8bc['gateway'],'fileType':_0x34f148,'fileSize':Math['round'](_0x4b1ff0[_0x3a34be(0x168)]*0.75/0x400)+'KB','uploadedAt':_0x3f583c['updatedAt']}});}catch(_0x46ecd0){console['error']('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x46ecd0),_0x424f0e[_0x3a34be(0x132)](0x1f4)[_0x3a34be(0x138)]({'success':![],'error':'Internal\x20server\x20error','details':_0x46ecd0 instanceof Error?_0x46ecd0[_0x3a34be(0x11e)]:'Unknown\x20error'});}}async[a9_0x307776(0x163)](_0x53058c,_0x2951df){const _0x88f4e1=a9_0x307776;try{const {paymentId:_0x42d68f}=_0x53058c[_0x88f4e1(0x182)];console['log'](_0x88f4e1(0x13c)+_0x42d68f);const _0x519343=await database_1[_0x88f4e1(0x17e)][_0x88f4e1(0x12c)]['findUnique']({'where':{'id':_0x42d68f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x519343){_0x2951df[_0x88f4e1(0x132)](0x194)['json']({'success':![],'error':_0x88f4e1(0x123)});return;}if(_0x519343[_0x88f4e1(0x176)]!==_0x88f4e1(0x16e)&&_0x519343[_0x88f4e1(0x176)]!==_0x88f4e1(0x175)){_0x2951df[_0x88f4e1(0x132)](0x190)[_0x88f4e1(0x138)]({'success':![],'error':_0x88f4e1(0x181)+_0x519343['gateway']});return;}let _0x286d2d='',_0x50052a=_0x519343[_0x88f4e1(0x120)],_0x27d25f='';if(_0x519343['gateway']===_0x88f4e1(0x16e))_0x27d25f='Interac\x20e-Transfer',_0x50052a=_0x88f4e1(0x11d),_0x286d2d=_0x88f4e1(0x16c)+_0x519343['amount']+'\x20'+_0x50052a+_0x88f4e1(0x13d);else _0x519343['gateway']===_0x88f4e1(0x175)&&(_0x27d25f='SEPA\x20Bank\x20Transfer',_0x50052a='EUR',_0x286d2d='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x519343['amount']+'\x20'+_0x50052a+_0x88f4e1(0x13d));const _0x21b9d0={'success':!![],'data':{'paymentId':_0x519343['id'],'gateway':_0x519343[_0x88f4e1(0x176)],'gatewayName':_0x519343[_0x88f4e1(0x176)][_0x88f4e1(0x161)](),'transferType':_0x27d25f,'amount':_0x519343[_0x88f4e1(0x149)],'currency':_0x50052a,'status':_0x519343[_0x88f4e1(0x132)],'instructions':_0x286d2d,'shopName':_0x519343[_0x88f4e1(0x12e)][_0x88f4e1(0x134)]||_0x519343[_0x88f4e1(0x12e)][_0x88f4e1(0x160)],'hasProof':![],'proofType':null,'createdAt':_0x519343['createdAt'],'updatedAt':_0x519343['updatedAt'],'supportedFileTypes':[_0x88f4e1(0x140),_0x88f4e1(0x179),'JPEG',_0x88f4e1(0x11c),'PDF'],'maxFileSize':_0x88f4e1(0x122)}};_0x2951df[_0x88f4e1(0x138)](_0x21b9d0);}catch(_0x2d7e6c){console[_0x88f4e1(0x158)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x2d7e6c),_0x2951df[_0x88f4e1(0x132)](0x1f4)[_0x88f4e1(0x138)]({'success':![],'error':_0x88f4e1(0x136),'details':_0x2d7e6c instanceof Error?_0x2d7e6c[_0x88f4e1(0x11e)]:_0x88f4e1(0x170)});}}}exports[a9_0x307776(0x144)]=ManualPaymentController,exports[a9_0x307776(0x12f)]=new ManualPaymentController();