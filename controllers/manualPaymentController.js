'use strict';const a8_0x141563=a8_0x31e6;(function(_0x3f8da2,_0x2d827c){const _0x28f9c0=a8_0x31e6,_0x749343=_0x3f8da2();while(!![]){try{const _0x55b73d=-parseInt(_0x28f9c0(0x1cf))/0x1*(-parseInt(_0x28f9c0(0x207))/0x2)+-parseInt(_0x28f9c0(0x21e))/0x3+parseInt(_0x28f9c0(0x221))/0x4*(parseInt(_0x28f9c0(0x1ee))/0x5)+parseInt(_0x28f9c0(0x1e5))/0x6+-parseInt(_0x28f9c0(0x228))/0x7+parseInt(_0x28f9c0(0x1c6))/0x8*(parseInt(_0x28f9c0(0x21f))/0x9)+-parseInt(_0x28f9c0(0x20e))/0xa*(parseInt(_0x28f9c0(0x219))/0xb);if(_0x55b73d===_0x2d827c)break;else _0x749343['push'](_0x749343['shift']());}catch(_0x35aa71){_0x749343['push'](_0x749343['shift']());}}}(a8_0x2cb1,0xef961));var __importDefault=this&&this['__importDefault']||function(_0x5689bd){const _0x15f21a=a8_0x31e6;return _0x5689bd&&_0x5689bd[_0x15f21a(0x20c)]?_0x5689bd:{'default':_0x5689bd};};Object[a8_0x141563(0x1da)](exports,a8_0x141563(0x20c),{'value':!![]}),exports[a8_0x141563(0x200)]=exports[a8_0x141563(0x1f4)]=void 0x0;const database_1=__importDefault(require(a8_0x141563(0x204))),telegramBotService_1=require(a8_0x141563(0x1eb));function a8_0x31e6(_0x3249b9,_0x41b1ce){const _0x2cb172=a8_0x2cb1();return a8_0x31e6=function(_0x31e6cc,_0x422d51){_0x31e6cc=_0x31e6cc-0x1c4;let _0xd412a4=_0x2cb172[_0x31e6cc];return _0xd412a4;},a8_0x31e6(_0x3249b9,_0x41b1ce);}class ManualPaymentController{async['uploadPaymentProof'](_0x1e0312,_0x143d01){const _0x188103=a8_0x141563;try{const {paymentId:_0x2b5028,fileData:_0x15cebf,fileType:_0x5509bc,fileName:_0x4f0566}=_0x1e0312[_0x188103(0x215)],_0x1c71d8=_0x1e0312['ip']||_0x1e0312[_0x188103(0x1f8)]?.[_0x188103(0x220)]||_0x188103(0x1df);console['log']('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x2b5028),console[_0x188103(0x1e4)](_0x188103(0x1dc)+_0x5509bc+_0x188103(0x21c)+(_0x15cebf?Math['round'](_0x15cebf[_0x188103(0x217)]*0.75/0x400):0x0)+'KB'),console[_0x188103(0x1e4)](_0x188103(0x1f1)+_0x1c71d8);if(!_0x2b5028){_0x143d01['status'](0x190)['json']({'success':![],'error':'Payment\x20ID\x20is\x20required'});return;}if(!_0x15cebf){_0x143d01['status'](0x190)[_0x188103(0x1cb)]({'success':![],'error':_0x188103(0x21a)});return;}if(!_0x5509bc){_0x143d01['status'](0x190)[_0x188103(0x1cb)]({'success':![],'error':_0x188103(0x1de)});return;}const _0x9eeeff=['png',_0x188103(0x1e2),_0x188103(0x1f5),'heic','pdf'],_0x880913=_0x5509bc[_0x188103(0x211)]()[_0x188103(0x222)]('.','');if(!_0x9eeeff[_0x188103(0x1f7)](_0x880913)){_0x143d01[_0x188103(0x1fd)](0x190)['json']({'success':![],'error':_0x188103(0x208)+_0x5509bc+_0x188103(0x20f)+_0x9eeeff[_0x188103(0x223)](',\x20')});return;}const _0x22be6e=0xa*0x400*0x400;if(_0x15cebf[_0x188103(0x217)]>_0x22be6e){_0x143d01['status'](0x190)[_0x188103(0x1cb)]({'success':![],'error':_0x188103(0x1ea)});return;}const _0x52670d=await database_1[_0x188103(0x202)][_0x188103(0x1ca)][_0x188103(0x1c5)]({'where':{'id':_0x2b5028},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x52670d){console[_0x188103(0x1e4)](_0x188103(0x1cd)+_0x2b5028),_0x143d01[_0x188103(0x1fd)](0x194)[_0x188103(0x1cb)]({'success':![],'error':_0x188103(0x226)});return;}if(_0x52670d[_0x188103(0x1fe)]!=='interac'&&_0x52670d[_0x188103(0x1fe)]!=='sepa'){console[_0x188103(0x1e4)]('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x52670d[_0x188103(0x1fe)]),_0x143d01['status'](0x190)['json']({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x52670d[_0x188103(0x1fe)]});return;}let _0x3a3693=_0x15cebf;_0x15cebf[_0x188103(0x1f7)](',')&&(_0x3a3693=_0x15cebf['split'](',')[0x1]);try{Buffer['from'](_0x3a3693,_0x188103(0x20a));}catch(_0x3f7081){_0x143d01[_0x188103(0x1fd)](0x190)[_0x188103(0x1cb)]({'success':![],'error':_0x188103(0x1e0)});return;}const _0x34bced=await database_1[_0x188103(0x202)][_0x188103(0x1ca)]['update']({'where':{'id':_0x2b5028},'data':{'status':'PROCESSING','updatedAt':new Date()}});console[_0x188103(0x1e4)](_0x188103(0x1fc)),console[_0x188103(0x1e4)]('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x2b5028),console['log'](_0x188103(0x1f2)+_0x52670d[_0x188103(0x1fe)][_0x188103(0x1ed)]()),console[_0x188103(0x1e4)](_0x188103(0x227)+_0x880913),console['log'](_0x188103(0x1db)+Math['round'](_0x3a3693[_0x188103(0x217)]*0.75/0x400)+'KB'),console[_0x188103(0x1e4)](_0x188103(0x1d5));try{const _0x147660=_0x52670d[_0x188103(0x1fe)][_0x188103(0x1ed)](),_0x198842=_0x52670d[_0x188103(0x201)][_0x188103(0x1e1)]||_0x52670d[_0x188103(0x201)][_0x188103(0x218)],_0x5ba129=Math[_0x188103(0x1e9)](_0x3a3693[_0x188103(0x217)]*0.75/0x400),_0x4a8ede=_0x188103(0x1f6)+_0x147660+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0x188103(0x1d2)+_0x2b5028+'\x0a')+('üí∞\x20Amount:\x20'+_0x52670d[_0x188103(0x1c4)]+'\x20'+_0x52670d[_0x188103(0x1d3)]+'\x0a')+(_0x188103(0x205)+_0x880913[_0x188103(0x1ed)]()+'\x20('+_0x5ba129+_0x188103(0x20d))+_0x188103(0x203)+(_0x188103(0x1fa)+_0x1c71d8+'\x0a\x0a')+_0x188103(0x1dd);await telegramBotService_1[_0x188103(0x1d6)][_0x188103(0x1ce)](_0x52670d['shopId'],_0x4a8ede,{'parse_mode':_0x188103(0x1c9)});const _0x4190d0=Buffer[_0x188103(0x1ff)](_0x3a3693,_0x188103(0x20a)),_0xed71a1=_0x188103(0x210)+_0x2b5028+'.'+_0x880913;await telegramBotService_1[_0x188103(0x1d6)][_0x188103(0x1d1)](_0x52670d['shopId'],_0x4190d0,_0xed71a1,'Payment\x20proof\x20for\x20'+_0x2b5028),console[_0x188103(0x1e4)]('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x241244=_0x188103(0x1ec),_0x2f75b5=_0x188103(0x1f6)+_0x147660+_0x188103(0x212)+('üí≥\x20Payment\x20ID:\x20'+_0x2b5028+'\x0a')+(_0x188103(0x21b)+_0x198842+'\x0a')+(_0x188103(0x1d9)+_0x52670d[_0x188103(0x1c4)]+'\x20'+_0x52670d[_0x188103(0x1d3)]+'\x0a')+('üìÅ\x20File:\x20'+_0x880913[_0x188103(0x1ed)]()+'\x20('+_0x5ba129+_0x188103(0x20d))+_0x188103(0x203)+(_0x188103(0x1fa)+_0x1c71d8+'\x0a\x0a')+_0x188103(0x214);await telegramBotService_1[_0x188103(0x1d6)][_0x188103(0x1ef)](parseInt(_0x241244),_0x2f75b5),await telegramBotService_1[_0x188103(0x1d6)][_0x188103(0x20b)](parseInt(_0x241244),_0x4190d0,_0xed71a1,_0x188103(0x1c7)+_0x2b5028),console[_0x188103(0x1e4)](_0x188103(0x1f3));}catch(_0x3b77af){console[_0x188103(0x1f0)](_0x188103(0x1d7),_0x3b77af);}_0x143d01[_0x188103(0x1cb)]({'success':!![],'message':_0x188103(0x1e6),'data':{'paymentId':_0x34bced['id'],'status':_0x34bced[_0x188103(0x1fd)],'gateway':_0x52670d['gateway'],'fileType':_0x880913,'fileSize':Math[_0x188103(0x1e9)](_0x3a3693['length']*0.75/0x400)+'KB','uploadedAt':_0x34bced['updatedAt']}});}catch(_0x7c5189){console[_0x188103(0x1f0)](_0x188103(0x213),_0x7c5189),_0x143d01[_0x188103(0x1fd)](0x1f4)[_0x188103(0x1cb)]({'success':![],'error':_0x188103(0x1fb),'details':_0x7c5189 instanceof Error?_0x7c5189[_0x188103(0x1d0)]:_0x188103(0x1d4)});}}async[a8_0x141563(0x1d8)](_0x4487ff,_0x2ba616){const _0xadbe67=a8_0x141563;try{const {paymentId:_0x15c4b9}=_0x4487ff[_0xadbe67(0x209)];console[_0xadbe67(0x1e4)]('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x15c4b9);const _0x4407d3=await database_1[_0xadbe67(0x202)]['payment'][_0xadbe67(0x1c5)]({'where':{'id':_0x15c4b9},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4407d3){_0x2ba616['status'](0x194)[_0xadbe67(0x1cb)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x4407d3['gateway']!=='interac'&&_0x4407d3['gateway']!=='sepa'){_0x2ba616[_0xadbe67(0x1fd)](0x190)[_0xadbe67(0x1cb)]({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x4407d3[_0xadbe67(0x1fe)]});return;}let _0x115c3e='',_0x3d9ba1=_0x4407d3[_0xadbe67(0x1d3)],_0x2bb1a3='';if(_0x4407d3[_0xadbe67(0x1fe)]===_0xadbe67(0x1f9))_0x2bb1a3='Interac\x20e-Transfer',_0x3d9ba1='CAD',_0x115c3e='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x4407d3['amount']+'\x20'+_0x3d9ba1+_0xadbe67(0x1c8);else _0x4407d3[_0xadbe67(0x1fe)]===_0xadbe67(0x1cc)&&(_0x2bb1a3=_0xadbe67(0x1e7),_0x3d9ba1='EUR',_0x115c3e='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x4407d3[_0xadbe67(0x1c4)]+'\x20'+_0x3d9ba1+_0xadbe67(0x1c8));const _0x24ba36={'success':!![],'data':{'paymentId':_0x4407d3['id'],'gateway':_0x4407d3[_0xadbe67(0x1fe)],'gatewayName':_0x4407d3['gateway'][_0xadbe67(0x1ed)](),'transferType':_0x2bb1a3,'amount':_0x4407d3['amount'],'currency':_0x3d9ba1,'status':_0x4407d3[_0xadbe67(0x1fd)],'instructions':_0x115c3e,'shopName':_0x4407d3[_0xadbe67(0x201)][_0xadbe67(0x1e1)]||_0x4407d3[_0xadbe67(0x201)][_0xadbe67(0x218)],'hasProof':![],'proofType':null,'createdAt':_0x4407d3[_0xadbe67(0x21d)],'updatedAt':_0x4407d3['updatedAt'],'supportedFileTypes':[_0xadbe67(0x216),_0xadbe67(0x1e8),_0xadbe67(0x1e3),_0xadbe67(0x206),'PDF'],'maxFileSize':_0xadbe67(0x225)}};_0x2ba616['json'](_0x24ba36);}catch(_0x105eb5){console[_0xadbe67(0x1f0)](_0xadbe67(0x224),_0x105eb5),_0x2ba616[_0xadbe67(0x1fd)](0x1f4)[_0xadbe67(0x1cb)]({'success':![],'error':'Internal\x20server\x20error','details':_0x105eb5 instanceof Error?_0x105eb5[_0xadbe67(0x1d0)]:_0xadbe67(0x1d4)});}}}function a8_0x2cb1(){const _0x31509d=['ManualPaymentController','jpeg','üîÑ\x20','includes','connection','interac','üåê\x20Customer\x20IP:\x20','Internal\x20server\x20error','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','status','gateway','from','manualPaymentController','shop','default','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','../config/database','üìÅ\x20File:\x20','HEIC','4IIfGVN','Unsupported\x20file\x20type:\x20','params','base64','sendDirectFile','__esModule','KB)\x0a','20ylYrBD','.\x20Supported:\x20','payment_proof_','toLowerCase','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','‚ùå\x20Upload\x20payment\x20proof\x20error:','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','body','PNG','length','username','11236973YLkYYu','File\x20data\x20is\x20required','üè™\x20Shop:\x20',',\x20size:\x20','createdAt','3487293tvvMfp','15741wsSCnL','remoteAddress','1112312UmodmV','replace','join','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','10MB','Payment\x20not\x20found','\x20\x20\x20-\x20File\x20type:\x20','1424941FBLaEx','amount','findUnique','8336vzuPLj','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','Markdown','payment','json','sepa','‚ùå\x20Payment\x20not\x20found:\x20','sendShopNotification','482714gKtaSf','message','sendShopFile','üí≥\x20Payment\x20ID:\x20','currency','Unknown\x20error','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','telegramBotService','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','getManualPaymentInfo','üí∞\x20Amount:\x20','defineProperty','\x20\x20\x20-\x20File\x20size:\x20','üìÅ\x20File\x20type:\x20','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','File\x20type\x20is\x20required','unknown','Invalid\x20base64\x20file\x20data','name','jpg','JPEG','log','1272894hROcMW','Payment\x20proof\x20uploaded\x20successfully','SEPA\x20Bank\x20Transfer','JPG','round','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','../services/telegramBotService','7867339505','toUpperCase','25WHRBLh','sendDirectMessage','error','üåê\x20Client\x20IP:\x20','\x20\x20\x20-\x20Gateway:\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent'];a8_0x2cb1=function(){return _0x31509d;};return a8_0x2cb1();}exports[a8_0x141563(0x1f4)]=ManualPaymentController,exports[a8_0x141563(0x200)]=new ManualPaymentController();