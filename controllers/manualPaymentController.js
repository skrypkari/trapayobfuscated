'use strict';const a11_0x307878=a11_0x1f36;(function(_0x385a73,_0x2d7e76){const _0x28fbe1=a11_0x1f36,_0xbc336d=_0x385a73();while(!![]){try{const _0x23f703=parseInt(_0x28fbe1(0x1aa))/0x1*(parseInt(_0x28fbe1(0x1b8))/0x2)+parseInt(_0x28fbe1(0x1b7))/0x3*(parseInt(_0x28fbe1(0x1c2))/0x4)+parseInt(_0x28fbe1(0x19d))/0x5*(-parseInt(_0x28fbe1(0x1bb))/0x6)+-parseInt(_0x28fbe1(0x1a8))/0x7+parseInt(_0x28fbe1(0x1b2))/0x8*(-parseInt(_0x28fbe1(0x1cf))/0x9)+parseInt(_0x28fbe1(0x174))/0xa*(parseInt(_0x28fbe1(0x1bd))/0xb)+-parseInt(_0x28fbe1(0x1c4))/0xc*(parseInt(_0x28fbe1(0x1ab))/0xd);if(_0x23f703===_0x2d7e76)break;else _0xbc336d['push'](_0xbc336d['shift']());}catch(_0x205a57){_0xbc336d['push'](_0xbc336d['shift']());}}}(a11_0x4af1,0xbf135));var __importDefault=this&&this[a11_0x307878(0x1d2)]||function(_0x383751){return _0x383751&&_0x383751['__esModule']?_0x383751:{'default':_0x383751};};Object['defineProperty'](exports,a11_0x307878(0x182),{'value':!![]}),exports[a11_0x307878(0x1dd)]=exports[a11_0x307878(0x17d)]=void 0x0;function a11_0x1f36(_0x10d6bf,_0x3dbd65){_0x10d6bf=_0x10d6bf-0x173;const _0x4af1b7=a11_0x4af1();let _0x1f36b7=_0x4af1b7[_0x10d6bf];return _0x1f36b7;}function a11_0x4af1(){const _0x1f3a9b=['Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','7867339505','message','ðŸ“±\x20Admin\x20notification\x20and\x20file\x20sent','10kkzlit','.\x20Supported:\x20','ðŸ’³\x20Payment\x20ID:\x20','sendShopNotification','length','updatedAt','amount','Invalid\x20base64\x20file\x20data','sepa','ManualPaymentController','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','10MB','âŒ\x20Get\x20manual\x20payment\x20info\x20error:','__esModule',',\x20size:\x20','ðŸ“¤\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','sendDirectMessage','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','Payment\x20ID\x20is\x20required','shopId','unknown','Interac\x20e-Transfer','uploadPaymentProof','connection','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','error','ðŸ“±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','default','CAD','ðŸŒ\x20Customer\x20IP:\x20','PNG','PDF','HEIC','replace','round','Internal\x20server\x20error','name','ðŸ“\x20File\x20type:\x20','gateway','âŒ\x20Payment\x20not\x20found:\x20','2453915YagiuA','update','log','ðŸ’°\x20Amount:\x20','getManualPaymentInfo','sendDirectFile','toLowerCase','findUnique','âœ…\x20Payment\x20proof\x20uploaded\x20successfully:','â³\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','KB)\x0a','1771056QMHrrx','ðŸ“Š\x20Status:\x20PENDING\x20â†’\x20PROCESSING\x0a','42923mCFDam','3525314dFbnFu','EUR','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','File\x20data\x20is\x20required','includes','\x20\x20\x20-\x20Payment\x20ID:\x20','status','6704UqCQwR','username','../config/database','payment_proof_','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','4149117WFzhUG','72yIzLRy','Markdown','JPG','18TKGmRG','heic','16219049KWXSiK','Unknown\x20error','base64','Payment\x20proof\x20uploaded\x20successfully','toUpperCase','4lVvVnd','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','60FxGeob','âŒ\x20Upload\x20payment\x20proof\x20error:','json','Payment\x20proof\x20for\x20','params','jpg','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notifications:','\x20\x20\x20-\x20Gateway:\x20','âš ï¸\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','ðŸª\x20Shop:\x20','telegramBotService','5787LXhAVW','remoteAddress','ðŸ“\x20File:\x20','__importDefault','shop','interac','ðŸ”„\x20','PROCESSING','png','payment','\x20\x20\x20-\x20File\x20type:\x20','jpeg','currency','from','manualPaymentController','Payment\x20not\x20found','ðŸ“‹\x20Get\x20manual\x20payment\x20info:\x20','File\x20type\x20is\x20required'];a11_0x4af1=function(){return _0x1f3a9b;};return a11_0x4af1();}const database_1=__importDefault(require(a11_0x307878(0x1b4))),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async[a11_0x307878(0x18b)](_0x56b7a9,_0x526375){const _0x34a9ea=a11_0x307878;try{const {paymentId:_0x1c18e9,fileData:_0x4bac73,fileType:_0x477b83,fileName:_0x55a6d6}=_0x56b7a9['body'],_0x5a3a1b=_0x56b7a9['ip']||_0x56b7a9[_0x34a9ea(0x18c)]?.[_0x34a9ea(0x1d0)]||_0x34a9ea(0x189);console[_0x34a9ea(0x19f)](_0x34a9ea(0x184)+_0x1c18e9),console[_0x34a9ea(0x19f)](_0x34a9ea(0x19a)+_0x477b83+_0x34a9ea(0x183)+(_0x4bac73?Math[_0x34a9ea(0x197)](_0x4bac73[_0x34a9ea(0x178)]*0.75/0x400):0x0)+'KB'),console['log']('ðŸŒ\x20Client\x20IP:\x20'+_0x5a3a1b);if(!_0x1c18e9){_0x526375[_0x34a9ea(0x1b1)](0x190)[_0x34a9ea(0x1c6)]({'success':![],'error':_0x34a9ea(0x187)});return;}if(!_0x4bac73){_0x526375[_0x34a9ea(0x1b1)](0x190)[_0x34a9ea(0x1c6)]({'success':![],'error':_0x34a9ea(0x1ae)});return;}if(!_0x477b83){_0x526375[_0x34a9ea(0x1b1)](0x190)[_0x34a9ea(0x1c6)]({'success':![],'error':_0x34a9ea(0x1e0)});return;}const _0x4e52cf=[_0x34a9ea(0x1d7),_0x34a9ea(0x1c9),_0x34a9ea(0x1da),_0x34a9ea(0x1bc),'pdf'],_0x45c874=_0x477b83[_0x34a9ea(0x1a3)]()[_0x34a9ea(0x196)]('.','');if(!_0x4e52cf[_0x34a9ea(0x1af)](_0x45c874)){_0x526375['status'](0x190)[_0x34a9ea(0x1c6)]({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x477b83+_0x34a9ea(0x175)+_0x4e52cf['join'](',\x20')});return;}const _0x8d3df7=0xa*0x400*0x400;if(_0x4bac73[_0x34a9ea(0x178)]>_0x8d3df7){_0x526375[_0x34a9ea(0x1b1)](0x190)[_0x34a9ea(0x1c6)]({'success':![],'error':_0x34a9ea(0x17e)});return;}const _0x34774a=await database_1['default'][_0x34a9ea(0x1d8)][_0x34a9ea(0x1a4)]({'where':{'id':_0x1c18e9},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x34774a){console[_0x34a9ea(0x19f)](_0x34a9ea(0x19c)+_0x1c18e9),_0x526375[_0x34a9ea(0x1b1)](0x194)[_0x34a9ea(0x1c6)]({'success':![],'error':_0x34a9ea(0x1de)});return;}if(_0x34774a['gateway']!=='interac'&&_0x34774a[_0x34a9ea(0x19b)]!=='sepa'){console[_0x34a9ea(0x19f)]('âŒ\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x34774a['gateway']),_0x526375[_0x34a9ea(0x1b1)](0x190)[_0x34a9ea(0x1c6)]({'success':![],'error':_0x34a9ea(0x1c3)+_0x34774a[_0x34a9ea(0x19b)]});return;}let _0x5021d9=_0x4bac73;_0x4bac73[_0x34a9ea(0x1af)](',')&&(_0x5021d9=_0x4bac73['split'](',')[0x1]);try{Buffer['from'](_0x5021d9,_0x34a9ea(0x1bf));}catch(_0x21ee8c){_0x526375['status'](0x190)['json']({'success':![],'error':_0x34a9ea(0x17b)});return;}const _0x5a2d4c=await database_1[_0x34a9ea(0x190)][_0x34a9ea(0x1d8)][_0x34a9ea(0x19e)]({'where':{'id':_0x1c18e9},'data':{'status':_0x34a9ea(0x1d6),'updatedAt':new Date()}});console[_0x34a9ea(0x19f)](_0x34a9ea(0x1a5)),console[_0x34a9ea(0x19f)](_0x34a9ea(0x1b0)+_0x1c18e9),console[_0x34a9ea(0x19f)](_0x34a9ea(0x1cb)+_0x34774a['gateway'][_0x34a9ea(0x1c1)]()),console['log'](_0x34a9ea(0x1d9)+_0x45c874),console[_0x34a9ea(0x19f)]('\x20\x20\x20-\x20File\x20size:\x20'+Math['round'](_0x5021d9['length']*0.75/0x400)+'KB'),console[_0x34a9ea(0x19f)]('\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING');try{const _0x439bb1=_0x34774a['gateway'][_0x34a9ea(0x1c1)](),_0x1212b5=_0x34774a['shop'][_0x34a9ea(0x199)]||_0x34774a[_0x34a9ea(0x1d3)][_0x34a9ea(0x1b3)],_0x5ed4bd=Math['round'](_0x5021d9[_0x34a9ea(0x178)]*0.75/0x400),_0x52f322=_0x34a9ea(0x1d5)+_0x439bb1+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0x34a9ea(0x176)+_0x1c18e9+'\x0a')+(_0x34a9ea(0x1a0)+_0x34774a[_0x34a9ea(0x17a)]+'\x20'+_0x34774a[_0x34a9ea(0x1db)]+'\x0a')+(_0x34a9ea(0x1d1)+_0x45c874[_0x34a9ea(0x1c1)]()+'\x20('+_0x5ed4bd+_0x34a9ea(0x1a7))+_0x34a9ea(0x1a9)+(_0x34a9ea(0x192)+_0x5a3a1b+'\x0a\x0a')+_0x34a9ea(0x1a6);await telegramBotService_1[_0x34a9ea(0x1ce)][_0x34a9ea(0x177)](_0x34774a[_0x34a9ea(0x188)],_0x52f322,{'parse_mode':_0x34a9ea(0x1b9)});const _0x44fd3e=Buffer[_0x34a9ea(0x1dc)](_0x5021d9,_0x34a9ea(0x1bf)),_0x3b3117=_0x34a9ea(0x1b5)+_0x1c18e9+'.'+_0x45c874;await telegramBotService_1[_0x34a9ea(0x1ce)]['sendShopFile'](_0x34774a[_0x34a9ea(0x188)],_0x44fd3e,_0x3b3117,_0x34a9ea(0x1c7)+_0x1c18e9),console[_0x34a9ea(0x19f)](_0x34a9ea(0x18f));const _0x2207ff=_0x34a9ea(0x1e2),_0x5ea770=_0x34a9ea(0x1d5)+_0x439bb1+_0x34a9ea(0x18d)+('ðŸ’³\x20Payment\x20ID:\x20'+_0x1c18e9+'\x0a')+(_0x34a9ea(0x1cd)+_0x1212b5+'\x0a')+('ðŸ’°\x20Amount:\x20'+_0x34774a[_0x34a9ea(0x17a)]+'\x20'+_0x34774a['currency']+'\x0a')+(_0x34a9ea(0x1d1)+_0x45c874['toUpperCase']()+'\x20('+_0x5ed4bd+_0x34a9ea(0x1a7))+_0x34a9ea(0x1a9)+(_0x34a9ea(0x192)+_0x5a3a1b+'\x0a\x0a')+_0x34a9ea(0x1cc);await telegramBotService_1['telegramBotService'][_0x34a9ea(0x185)](parseInt(_0x2207ff),_0x5ea770),await telegramBotService_1[_0x34a9ea(0x1ce)][_0x34a9ea(0x1a2)](parseInt(_0x2207ff),_0x44fd3e,_0x3b3117,_0x34a9ea(0x1ad)+_0x1c18e9),console['log'](_0x34a9ea(0x173));}catch(_0x42b28f){console[_0x34a9ea(0x18e)](_0x34a9ea(0x1ca),_0x42b28f);}_0x526375['json']({'success':!![],'message':_0x34a9ea(0x1c0),'data':{'paymentId':_0x5a2d4c['id'],'status':_0x5a2d4c[_0x34a9ea(0x1b1)],'gateway':_0x34774a[_0x34a9ea(0x19b)],'fileType':_0x45c874,'fileSize':Math[_0x34a9ea(0x197)](_0x5021d9[_0x34a9ea(0x178)]*0.75/0x400)+'KB','uploadedAt':_0x5a2d4c[_0x34a9ea(0x179)]}});}catch(_0x330aa3){console['error'](_0x34a9ea(0x1c5),_0x330aa3),_0x526375[_0x34a9ea(0x1b1)](0x1f4)[_0x34a9ea(0x1c6)]({'success':![],'error':_0x34a9ea(0x198),'details':_0x330aa3 instanceof Error?_0x330aa3[_0x34a9ea(0x1e3)]:_0x34a9ea(0x1be)});}}async[a11_0x307878(0x1a1)](_0x215ec6,_0x3bec64){const _0x458007=a11_0x307878;try{const {paymentId:_0x3b0d35}=_0x215ec6[_0x458007(0x1c8)];console[_0x458007(0x19f)](_0x458007(0x1df)+_0x3b0d35);const _0x482c27=await database_1[_0x458007(0x190)]['payment'][_0x458007(0x1a4)]({'where':{'id':_0x3b0d35},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x482c27){_0x3bec64[_0x458007(0x1b1)](0x194)[_0x458007(0x1c6)]({'success':![],'error':_0x458007(0x1de)});return;}if(_0x482c27['gateway']!==_0x458007(0x1d4)&&_0x482c27[_0x458007(0x19b)]!==_0x458007(0x17c)){_0x3bec64[_0x458007(0x1b1)](0x190)['json']({'success':![],'error':_0x458007(0x1e1)+_0x482c27[_0x458007(0x19b)]});return;}let _0x16631c='',_0x48733a=_0x482c27[_0x458007(0x1db)],_0x55b3f2='';if(_0x482c27['gateway']===_0x458007(0x1d4))_0x55b3f2=_0x458007(0x18a),_0x48733a=_0x458007(0x191),_0x16631c=_0x458007(0x1b6)+_0x482c27[_0x458007(0x17a)]+'\x20'+_0x48733a+_0x458007(0x186);else _0x482c27[_0x458007(0x19b)]===_0x458007(0x17c)&&(_0x55b3f2='SEPA\x20Bank\x20Transfer',_0x48733a=_0x458007(0x1ac),_0x16631c=_0x458007(0x17f)+_0x482c27[_0x458007(0x17a)]+'\x20'+_0x48733a+_0x458007(0x186));const _0x5d37e9={'success':!![],'data':{'paymentId':_0x482c27['id'],'gateway':_0x482c27[_0x458007(0x19b)],'gatewayName':_0x482c27[_0x458007(0x19b)][_0x458007(0x1c1)](),'transferType':_0x55b3f2,'amount':_0x482c27[_0x458007(0x17a)],'currency':_0x48733a,'status':_0x482c27['status'],'instructions':_0x16631c,'shopName':_0x482c27[_0x458007(0x1d3)][_0x458007(0x199)]||_0x482c27['shop'][_0x458007(0x1b3)],'hasProof':![],'proofType':null,'createdAt':_0x482c27['createdAt'],'updatedAt':_0x482c27['updatedAt'],'supportedFileTypes':[_0x458007(0x193),_0x458007(0x1ba),'JPEG',_0x458007(0x195),_0x458007(0x194)],'maxFileSize':_0x458007(0x180)}};_0x3bec64[_0x458007(0x1c6)](_0x5d37e9);}catch(_0xfbb475){console[_0x458007(0x18e)](_0x458007(0x181),_0xfbb475),_0x3bec64[_0x458007(0x1b1)](0x1f4)[_0x458007(0x1c6)]({'success':![],'error':'Internal\x20server\x20error','details':_0xfbb475 instanceof Error?_0xfbb475[_0x458007(0x1e3)]:_0x458007(0x1be)});}}}exports[a11_0x307878(0x17d)]=ManualPaymentController,exports[a11_0x307878(0x1dd)]=new ManualPaymentController();