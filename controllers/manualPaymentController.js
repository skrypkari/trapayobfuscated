'use strict';const a8_0x1486a5=a8_0x1857;(function(_0x13f482,_0x146ab2){const _0x154505=a8_0x1857,_0x5ce2b5=_0x13f482();while(!![]){try{const _0x3671e0=parseInt(_0x154505(0xd6))/0x1*(-parseInt(_0x154505(0xe8))/0x2)+parseInt(_0x154505(0xc9))/0x3*(-parseInt(_0x154505(0x10a))/0x4)+-parseInt(_0x154505(0xe5))/0x5+parseInt(_0x154505(0x112))/0x6+parseInt(_0x154505(0xd9))/0x7+-parseInt(_0x154505(0xfc))/0x8*(parseInt(_0x154505(0x108))/0x9)+parseInt(_0x154505(0xdf))/0xa*(parseInt(_0x154505(0x10c))/0xb);if(_0x3671e0===_0x146ab2)break;else _0x5ce2b5['push'](_0x5ce2b5['shift']());}catch(_0x4c847d){_0x5ce2b5['push'](_0x5ce2b5['shift']());}}}(a8_0x419d,0x8a3be));var __importDefault=this&&this['__importDefault']||function(_0x521828){const _0x4a52b5=a8_0x1857;return _0x521828&&_0x521828[_0x4a52b5(0xd8)]?_0x521828:{'default':_0x521828};};Object['defineProperty'](exports,a8_0x1486a5(0xd8),{'value':!![]}),exports['manualPaymentController']=exports[a8_0x1486a5(0x116)]=void 0x0;const database_1=__importDefault(require(a8_0x1486a5(0xc6))),telegramBotService_1=require('../services/telegramBotService');function a8_0x419d(){const _0x5728d4=['toUpperCase','join','Markdown','createdAt','sendShopFile','message','uploadPaymentProof','split','üåê\x20Customer\x20IP:\x20','KB)\x0a','payment_proof_','png','\x20\x20\x20-\x20File\x20size:\x20','updatedAt','includes','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','base64',',\x20size:\x20','../config/database','SEPA\x20Bank\x20Transfer','üìÅ\x20File:\x20','39SDjHvT','üí∞\x20Amount:\x20','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','\x20\x20\x20-\x20Gateway:\x20','10MB','‚ùå\x20Upload\x20payment\x20proof\x20error:','json','round','‚ùå\x20Payment\x20not\x20found:\x20','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','log','params','2BQikCN','File\x20type\x20is\x20required','__esModule','4929372DwVRfK','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','PNG','manualPaymentController','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','pdf','20143030EACVnr','payment','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','Invalid\x20base64\x20file\x20data','PROCESSING','unknown','3695790BUYKrx','üåê\x20Client\x20IP:\x20','shopId','581426fTKBEX','Payment\x20not\x20found','CAD','heic','üìÅ\x20File\x20type:\x20','Internal\x20server\x20error','JPEG','default','getManualPaymentInfo','üí≥\x20Payment\x20ID:\x20','error','Unknown\x20error','length','7867339505','Unsupported\x20file\x20type:\x20','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','currency','.\x20Supported:\x20','Payment\x20proof\x20for\x20','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','16PDeAyV','findUnique','from','üîÑ\x20','username','sendDirectMessage','gateway','sepa','HEIC','status','sendShopNotification','\x20\x20\x20-\x20File\x20type:\x20','4725891ohTYkm','name','83228izaUDU','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','11yoqjDQ','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','shop','File\x20data\x20is\x20required','interac','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','2933880ZbaPEK','connection','telegramBotService','amount','ManualPaymentController'];a8_0x419d=function(){return _0x5728d4;};return a8_0x419d();}function a8_0x1857(_0x392f4a,_0xf1ce67){const _0x419d5c=a8_0x419d();return a8_0x1857=function(_0x185711,_0x183f61){_0x185711=_0x185711-0xb8;let _0x2c8e11=_0x419d5c[_0x185711];return _0x2c8e11;},a8_0x1857(_0x392f4a,_0xf1ce67);}class ManualPaymentController{async[a8_0x1486a5(0xba)](_0x5e180a,_0x9cc32c){const _0x491719=a8_0x1486a5;try{const {paymentId:_0x5d6636,fileData:_0x51403e,fileType:_0x1ec77b,fileName:_0x2ad08c}=_0x5e180a['body'],_0x5bbc7c=_0x5e180a['ip']||_0x5e180a[_0x491719(0x113)]?.['remoteAddress']||_0x491719(0xe4);console[_0x491719(0xd4)](_0x491719(0xe1)+_0x5d6636),console[_0x491719(0xd4)](_0x491719(0xec)+_0x1ec77b+_0x491719(0xc5)+(_0x51403e?Math['round'](_0x51403e[_0x491719(0xf4)]*0.75/0x400):0x0)+'KB'),console[_0x491719(0xd4)](_0x491719(0xe6)+_0x5bbc7c);if(!_0x5d6636){_0x9cc32c[_0x491719(0x105)](0x190)[_0x491719(0xd0)]({'success':![],'error':'Payment\x20ID\x20is\x20required'});return;}if(!_0x51403e){_0x9cc32c[_0x491719(0x105)](0x190)[_0x491719(0xd0)]({'success':![],'error':_0x491719(0x10f)});return;}if(!_0x1ec77b){_0x9cc32c[_0x491719(0x105)](0x190)[_0x491719(0xd0)]({'success':![],'error':_0x491719(0xd7)});return;}const _0x5b7643=[_0x491719(0xbf),'jpg','jpeg',_0x491719(0xeb),_0x491719(0xde)],_0x218cce=_0x1ec77b['toLowerCase']()['replace']('.','');if(!_0x5b7643['includes'](_0x218cce)){_0x9cc32c['status'](0x190)[_0x491719(0xd0)]({'success':![],'error':_0x491719(0xf6)+_0x1ec77b+_0x491719(0xf9)+_0x5b7643[_0x491719(0x118)](',\x20')});return;}const _0x2bb5a5=0xa*0x400*0x400;if(_0x51403e[_0x491719(0xf4)]>_0x2bb5a5){_0x9cc32c[_0x491719(0x105)](0x190)[_0x491719(0xd0)]({'success':![],'error':_0x491719(0xd3)});return;}const _0x35b68c=await database_1[_0x491719(0xef)][_0x491719(0xe0)][_0x491719(0xfd)]({'where':{'id':_0x5d6636},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x35b68c){console[_0x491719(0xd4)](_0x491719(0xd2)+_0x5d6636),_0x9cc32c[_0x491719(0x105)](0x194)[_0x491719(0xd0)]({'success':![],'error':_0x491719(0xe9)});return;}if(_0x35b68c[_0x491719(0x102)]!==_0x491719(0x110)&&_0x35b68c[_0x491719(0x102)]!==_0x491719(0x103)){console[_0x491719(0xd4)](_0x491719(0x10b)+_0x35b68c[_0x491719(0x102)]),_0x9cc32c[_0x491719(0x105)](0x190)[_0x491719(0xd0)]({'success':![],'error':_0x491719(0xda)+_0x35b68c[_0x491719(0x102)]});return;}let _0x5984a2=_0x51403e;_0x51403e[_0x491719(0xc2)](',')&&(_0x5984a2=_0x51403e[_0x491719(0xbb)](',')[0x1]);try{Buffer[_0x491719(0xfe)](_0x5984a2,_0x491719(0xc4));}catch(_0x30835a){_0x9cc32c[_0x491719(0x105)](0x190)[_0x491719(0xd0)]({'success':![],'error':_0x491719(0xe2)});return;}const _0x1ee3d7=await database_1[_0x491719(0xef)][_0x491719(0xe0)]['update']({'where':{'id':_0x5d6636},'data':{'status':_0x491719(0xe3),'updatedAt':new Date()}});console['log']('‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:'),console[_0x491719(0xd4)]('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x5d6636),console[_0x491719(0xd4)](_0x491719(0xcd)+_0x35b68c['gateway']['toUpperCase']()),console[_0x491719(0xd4)](_0x491719(0x107)+_0x218cce),console[_0x491719(0xd4)](_0x491719(0xc0)+Math['round'](_0x5984a2[_0x491719(0xf4)]*0.75/0x400)+'KB'),console['log']('\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING');try{const _0x4fa181=_0x35b68c[_0x491719(0x102)][_0x491719(0x117)](),_0x58f9c2=_0x35b68c['shop'][_0x491719(0x109)]||_0x35b68c[_0x491719(0x10e)]['username'],_0x383915=Math[_0x491719(0xd1)](_0x5984a2[_0x491719(0xf4)]*0.75/0x400),_0x388266=_0x491719(0xff)+_0x4fa181+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0x491719(0xf1)+_0x5d6636+'\x0a')+(_0x491719(0xca)+_0x35b68c[_0x491719(0x115)]+'\x20'+_0x35b68c['currency']+'\x0a')+(_0x491719(0xc8)+_0x218cce[_0x491719(0x117)]()+'\x20('+_0x383915+_0x491719(0xbd))+_0x491719(0xdd)+(_0x491719(0xbc)+_0x5bbc7c+'\x0a\x0a')+_0x491719(0xcb);await telegramBotService_1[_0x491719(0x114)][_0x491719(0x106)](_0x35b68c[_0x491719(0xe7)],_0x388266,{'parse_mode':_0x491719(0x119)});const _0x54734e=Buffer[_0x491719(0xfe)](_0x5984a2,_0x491719(0xc4)),_0x1eca40=_0x491719(0xbe)+_0x5d6636+'.'+_0x218cce;await telegramBotService_1[_0x491719(0x114)][_0x491719(0xb8)](_0x35b68c[_0x491719(0xe7)],_0x54734e,_0x1eca40,_0x491719(0xfa)+_0x5d6636),console[_0x491719(0xd4)](_0x491719(0xc3));const _0x478cd1=_0x491719(0xf5),_0x1ed79d=_0x491719(0xff)+_0x4fa181+'\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a'+(_0x491719(0xf1)+_0x5d6636+'\x0a')+('üè™\x20Shop:\x20'+_0x58f9c2+'\x0a')+(_0x491719(0xca)+_0x35b68c['amount']+'\x20'+_0x35b68c[_0x491719(0xf8)]+'\x0a')+(_0x491719(0xc8)+_0x218cce[_0x491719(0x117)]()+'\x20('+_0x383915+_0x491719(0xbd))+_0x491719(0xdd)+(_0x491719(0xbc)+_0x5bbc7c+'\x0a\x0a')+_0x491719(0xcc);await telegramBotService_1[_0x491719(0x114)][_0x491719(0x101)](parseInt(_0x478cd1),_0x1ed79d),await telegramBotService_1['telegramBotService']['sendDirectFile'](parseInt(_0x478cd1),_0x54734e,_0x1eca40,_0x491719(0xf7)+_0x5d6636),console[_0x491719(0xd4)]('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x1b6192){console[_0x491719(0xf2)](_0x491719(0x111),_0x1b6192);}_0x9cc32c[_0x491719(0xd0)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x1ee3d7['id'],'status':_0x1ee3d7[_0x491719(0x105)],'gateway':_0x35b68c[_0x491719(0x102)],'fileType':_0x218cce,'fileSize':Math[_0x491719(0xd1)](_0x5984a2[_0x491719(0xf4)]*0.75/0x400)+'KB','uploadedAt':_0x1ee3d7[_0x491719(0xc1)]}});}catch(_0x398f67){console[_0x491719(0xf2)](_0x491719(0xcf),_0x398f67),_0x9cc32c[_0x491719(0x105)](0x1f4)[_0x491719(0xd0)]({'success':![],'error':_0x491719(0xed),'details':_0x398f67 instanceof Error?_0x398f67[_0x491719(0xb9)]:_0x491719(0xf3)});}}async[a8_0x1486a5(0xf0)](_0x4229d5,_0x483407){const _0x4a36b3=a8_0x1486a5;try{const {paymentId:_0x2ac754}=_0x4229d5[_0x4a36b3(0xd5)];console[_0x4a36b3(0xd4)]('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x2ac754);const _0x62992d=await database_1['default'][_0x4a36b3(0xe0)][_0x4a36b3(0xfd)]({'where':{'id':_0x2ac754},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x62992d){_0x483407[_0x4a36b3(0x105)](0x194)['json']({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x62992d[_0x4a36b3(0x102)]!==_0x4a36b3(0x110)&&_0x62992d[_0x4a36b3(0x102)]!=='sepa'){_0x483407[_0x4a36b3(0x105)](0x190)['json']({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x62992d[_0x4a36b3(0x102)]});return;}let _0x377cc6='',_0x13fb73=_0x62992d[_0x4a36b3(0xf8)],_0xe3ecd8='';if(_0x62992d['gateway']===_0x4a36b3(0x110))_0xe3ecd8='Interac\x20e-Transfer',_0x13fb73=_0x4a36b3(0xea),_0x377cc6=_0x4a36b3(0xfb)+_0x62992d[_0x4a36b3(0x115)]+'\x20'+_0x13fb73+_0x4a36b3(0x10d);else _0x62992d[_0x4a36b3(0x102)]===_0x4a36b3(0x103)&&(_0xe3ecd8=_0x4a36b3(0xc7),_0x13fb73='EUR',_0x377cc6='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x62992d[_0x4a36b3(0x115)]+'\x20'+_0x13fb73+_0x4a36b3(0x10d));const _0x55fdc0={'success':!![],'data':{'paymentId':_0x62992d['id'],'gateway':_0x62992d[_0x4a36b3(0x102)],'gatewayName':_0x62992d[_0x4a36b3(0x102)][_0x4a36b3(0x117)](),'transferType':_0xe3ecd8,'amount':_0x62992d[_0x4a36b3(0x115)],'currency':_0x13fb73,'status':_0x62992d[_0x4a36b3(0x105)],'instructions':_0x377cc6,'shopName':_0x62992d[_0x4a36b3(0x10e)][_0x4a36b3(0x109)]||_0x62992d[_0x4a36b3(0x10e)][_0x4a36b3(0x100)],'hasProof':![],'proofType':null,'createdAt':_0x62992d[_0x4a36b3(0x11a)],'updatedAt':_0x62992d['updatedAt'],'supportedFileTypes':[_0x4a36b3(0xdb),'JPG',_0x4a36b3(0xee),_0x4a36b3(0x104),'PDF'],'maxFileSize':_0x4a36b3(0xce)}};_0x483407[_0x4a36b3(0xd0)](_0x55fdc0);}catch(_0x2e86de){console[_0x4a36b3(0xf2)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x2e86de),_0x483407['status'](0x1f4)[_0x4a36b3(0xd0)]({'success':![],'error':_0x4a36b3(0xed),'details':_0x2e86de instanceof Error?_0x2e86de[_0x4a36b3(0xb9)]:_0x4a36b3(0xf3)});}}}exports[a8_0x1486a5(0x116)]=ManualPaymentController,exports[a8_0x1486a5(0xdc)]=new ManualPaymentController();