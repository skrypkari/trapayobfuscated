'use strict';const a8_0x4c496b=a8_0x2851;function a8_0x20e2(){const _0x324c23=['json','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','JPEG','../config/database','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','connection','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','update','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','join','status','Payment\x20proof\x20uploaded\x20successfully','üìã\x20Get\x20manual\x20payment\x20info:\x20','‚ùå\x20Payment\x20not\x20found:\x20','544392LoJuJN','toUpperCase','base64','Payment\x20not\x20found','interac','üè™\x20Shop:\x20','length','shop','png','104EGZNAu','manualPaymentController','__esModule','log','__importDefault','298fAUjHo','gateway','.\x20Supported:\x20','üìÅ\x20File:\x20','sendDirectFile','\x20\x20\x20-\x20File\x20type:\x20','3105477wttYHW','remoteAddress','Internal\x20server\x20error','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','sepa','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','SEPA\x20Bank\x20Transfer','findUnique','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','../services/telegramBotService','default','3104590mksXOv',',\x20size:\x20','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','error','sendDirectMessage','üîÑ\x20','Markdown','CAD','844295eYNQTE','1259536mZtimB','üí≥\x20Payment\x20ID:\x20','sendShopFile','uploadPaymentProof','Payment\x20ID\x20is\x20required','üåê\x20Client\x20IP:\x20','11FojqcE','‚ùå\x20Upload\x20payment\x20proof\x20error:','split','18399AhUDfp','7867339505','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','getManualPaymentInfo','Unknown\x20error','üì±\x20Admin\x20notification\x20and\x20file\x20sent','from','shopId','KB)\x0a','payment','currency','JPG','createdAt','username','\x20\x20\x20-\x20File\x20size:\x20','defineProperty','35FtRBZv','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','amount','round','\x20\x20\x20-\x20Gateway:\x20','updatedAt','29148dsPUco','telegramBotService','üåê\x20Customer\x20IP:\x20','PROCESSING','name','\x20Payment\x20Proof\x20Received\x0a\x0a','message','jpeg','HEIC','includes','üìÅ\x20File\x20type:\x20'];a8_0x20e2=function(){return _0x324c23;};return a8_0x20e2();}(function(_0xb0ba6c,_0x57abe6){const _0x34843b=a8_0x2851,_0x39183d=_0xb0ba6c();while(!![]){try{const _0xdc2bad=-parseInt(_0x34843b(0x1a0))/0x1+parseInt(_0x34843b(0x1e8))/0x2*(parseInt(_0x34843b(0x1aa))/0x3)+parseInt(_0x34843b(0x1a1))/0x4+parseInt(_0x34843b(0x1bb))/0x5*(-parseInt(_0x34843b(0x1da))/0x6)+-parseInt(_0x34843b(0x1c1))/0x7*(-parseInt(_0x34843b(0x1e3))/0x8)+parseInt(_0x34843b(0x1ee))/0x9+-parseInt(_0x34843b(0x198))/0xa*(-parseInt(_0x34843b(0x1a7))/0xb);if(_0xdc2bad===_0x57abe6)break;else _0x39183d['push'](_0x39183d['shift']());}catch(_0x4731a5){_0x39183d['push'](_0x39183d['shift']());}}}(a8_0x20e2,0x700ae));function a8_0x2851(_0x433348,_0x473016){const _0x20e227=a8_0x20e2();return a8_0x2851=function(_0x285150,_0x22005d){_0x285150=_0x285150-0x191;let _0x3e1bea=_0x20e227[_0x285150];return _0x3e1bea;},a8_0x2851(_0x433348,_0x473016);}var __importDefault=this&&this[a8_0x4c496b(0x1e7)]||function(_0x4dcf5c){const _0x57fe3c=a8_0x4c496b;return _0x4dcf5c&&_0x4dcf5c[_0x57fe3c(0x1e5)]?_0x4dcf5c:{'default':_0x4dcf5c};};Object[a8_0x4c496b(0x1ba)](exports,a8_0x4c496b(0x1e5),{'value':!![]}),exports['manualPaymentController']=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a8_0x4c496b(0x1cf))),telegramBotService_1=require(a8_0x4c496b(0x196));class ManualPaymentController{async[a8_0x4c496b(0x1a4)](_0x8fd24d,_0x1ed7fa){const _0xf2df89=a8_0x4c496b;try{const {paymentId:_0x3031dc,fileData:_0x10655d,fileType:_0x56ee34,fileName:_0x43a16c}=_0x8fd24d['body'],_0x9a5fd3=_0x8fd24d['ip']||_0x8fd24d[_0xf2df89(0x1d1)]?.[_0xf2df89(0x1ef)]||'unknown';console['log'](_0xf2df89(0x195)+_0x3031dc),console[_0xf2df89(0x1e6)](_0xf2df89(0x1cb)+_0x56ee34+_0xf2df89(0x199)+(_0x10655d?Math[_0xf2df89(0x1be)](_0x10655d[_0xf2df89(0x1e0)]*0.75/0x400):0x0)+'KB'),console[_0xf2df89(0x1e6)](_0xf2df89(0x1a6)+_0x9a5fd3);if(!_0x3031dc){_0x1ed7fa[_0xf2df89(0x1d6)](0x190)[_0xf2df89(0x1cc)]({'success':![],'error':_0xf2df89(0x1a5)});return;}if(!_0x10655d){_0x1ed7fa[_0xf2df89(0x1d6)](0x190)[_0xf2df89(0x1cc)]({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x56ee34){_0x1ed7fa['status'](0x190)[_0xf2df89(0x1cc)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x3a6ec7=[_0xf2df89(0x1e2),'jpg',_0xf2df89(0x1c8),'heic','pdf'],_0x32f457=_0x56ee34['toLowerCase']()['replace']('.','');if(!_0x3a6ec7[_0xf2df89(0x1ca)](_0x32f457)){_0x1ed7fa['status'](0x190)[_0xf2df89(0x1cc)]({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x56ee34+_0xf2df89(0x1ea)+_0x3a6ec7[_0xf2df89(0x1d5)](',\x20')});return;}const _0x56d64d=0xa*0x400*0x400;if(_0x10655d['length']>_0x56d64d){_0x1ed7fa[_0xf2df89(0x1d6)](0x190)[_0xf2df89(0x1cc)]({'success':![],'error':'File\x20too\x20large.\x20Maximum\x20size:\x2010MB'});return;}const _0x139db6=await database_1['default']['payment'][_0xf2df89(0x193)]({'where':{'id':_0x3031dc},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x139db6){console[_0xf2df89(0x1e6)](_0xf2df89(0x1d9)+_0x3031dc),_0x1ed7fa[_0xf2df89(0x1d6)](0x194)['json']({'success':![],'error':_0xf2df89(0x1dd)});return;}if(_0x139db6[_0xf2df89(0x1e9)]!==_0xf2df89(0x1de)&&_0x139db6['gateway']!==_0xf2df89(0x1f2)){console['log'](_0xf2df89(0x1bc)+_0x139db6['gateway']),_0x1ed7fa[_0xf2df89(0x1d6)](0x190)[_0xf2df89(0x1cc)]({'success':![],'error':_0xf2df89(0x194)+_0x139db6[_0xf2df89(0x1e9)]});return;}let _0x312e13=_0x10655d;_0x10655d[_0xf2df89(0x1ca)](',')&&(_0x312e13=_0x10655d[_0xf2df89(0x1a9)](',')[0x1]);try{Buffer[_0xf2df89(0x1b1)](_0x312e13,'base64');}catch(_0x701b91){_0x1ed7fa[_0xf2df89(0x1d6)](0x190)[_0xf2df89(0x1cc)]({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x1ad2e1=await database_1[_0xf2df89(0x197)][_0xf2df89(0x1b4)][_0xf2df89(0x1d3)]({'where':{'id':_0x3031dc},'data':{'status':_0xf2df89(0x1c4),'updatedAt':new Date()}});console[_0xf2df89(0x1e6)](_0xf2df89(0x1ac)),console['log']('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x3031dc),console[_0xf2df89(0x1e6)](_0xf2df89(0x1bf)+_0x139db6[_0xf2df89(0x1e9)][_0xf2df89(0x1db)]()),console[_0xf2df89(0x1e6)](_0xf2df89(0x1ed)+_0x32f457),console[_0xf2df89(0x1e6)](_0xf2df89(0x1b9)+Math[_0xf2df89(0x1be)](_0x312e13[_0xf2df89(0x1e0)]*0.75/0x400)+'KB'),console['log'](_0xf2df89(0x1d0));try{const _0x5b8dae=_0x139db6[_0xf2df89(0x1e9)][_0xf2df89(0x1db)](),_0x393254=_0x139db6[_0xf2df89(0x1e1)][_0xf2df89(0x1c5)]||_0x139db6['shop'][_0xf2df89(0x1b8)],_0x3c96a3=Math[_0xf2df89(0x1be)](_0x312e13[_0xf2df89(0x1e0)]*0.75/0x400),_0x5068f0=_0xf2df89(0x19d)+_0x5b8dae+_0xf2df89(0x1c6)+(_0xf2df89(0x1a2)+_0x3031dc+'\x0a')+('üí∞\x20Amount:\x20'+_0x139db6[_0xf2df89(0x1bd)]+'\x20'+_0x139db6[_0xf2df89(0x1b5)]+'\x0a')+(_0xf2df89(0x1eb)+_0x32f457['toUpperCase']()+'\x20('+_0x3c96a3+_0xf2df89(0x1b3))+_0xf2df89(0x1d2)+(_0xf2df89(0x1c3)+_0x9a5fd3+'\x0a\x0a')+_0xf2df89(0x191);await telegramBotService_1[_0xf2df89(0x1c2)]['sendShopNotification'](_0x139db6[_0xf2df89(0x1b2)],_0x5068f0,{'parse_mode':_0xf2df89(0x19e)});const _0x247d7c=Buffer['from'](_0x312e13,_0xf2df89(0x1dc)),_0x4dae93='payment_proof_'+_0x3031dc+'.'+_0x32f457;await telegramBotService_1['telegramBotService'][_0xf2df89(0x1a3)](_0x139db6[_0xf2df89(0x1b2)],_0x247d7c,_0x4dae93,'Payment\x20proof\x20for\x20'+_0x3031dc),console[_0xf2df89(0x1e6)]('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x5db815=_0xf2df89(0x1ab),_0x30fc90=_0xf2df89(0x19d)+_0x5b8dae+_0xf2df89(0x1d4)+(_0xf2df89(0x1a2)+_0x3031dc+'\x0a')+(_0xf2df89(0x1df)+_0x393254+'\x0a')+('üí∞\x20Amount:\x20'+_0x139db6['amount']+'\x20'+_0x139db6[_0xf2df89(0x1b5)]+'\x0a')+('üìÅ\x20File:\x20'+_0x32f457['toUpperCase']()+'\x20('+_0x3c96a3+_0xf2df89(0x1b3))+_0xf2df89(0x1d2)+(_0xf2df89(0x1c3)+_0x9a5fd3+'\x0a\x0a')+_0xf2df89(0x1f1);await telegramBotService_1[_0xf2df89(0x1c2)][_0xf2df89(0x19c)](parseInt(_0x5db815),_0x30fc90),await telegramBotService_1[_0xf2df89(0x1c2)][_0xf2df89(0x1ec)](parseInt(_0x5db815),_0x247d7c,_0x4dae93,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x3031dc),console[_0xf2df89(0x1e6)](_0xf2df89(0x1b0));}catch(_0x18d12c){console[_0xf2df89(0x19b)]('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:',_0x18d12c);}_0x1ed7fa[_0xf2df89(0x1cc)]({'success':!![],'message':_0xf2df89(0x1d7),'data':{'paymentId':_0x1ad2e1['id'],'status':_0x1ad2e1['status'],'gateway':_0x139db6[_0xf2df89(0x1e9)],'fileType':_0x32f457,'fileSize':Math['round'](_0x312e13['length']*0.75/0x400)+'KB','uploadedAt':_0x1ad2e1[_0xf2df89(0x1c0)]}});}catch(_0x48683c){console[_0xf2df89(0x19b)](_0xf2df89(0x1a8),_0x48683c),_0x1ed7fa[_0xf2df89(0x1d6)](0x1f4)['json']({'success':![],'error':_0xf2df89(0x1f0),'details':_0x48683c instanceof Error?_0x48683c[_0xf2df89(0x1c7)]:_0xf2df89(0x1af)});}}async[a8_0x4c496b(0x1ae)](_0xd9093b,_0x9c9c49){const _0x407939=a8_0x4c496b;try{const {paymentId:_0x369663}=_0xd9093b['params'];console[_0x407939(0x1e6)](_0x407939(0x1d8)+_0x369663);const _0x55c85f=await database_1[_0x407939(0x197)][_0x407939(0x1b4)][_0x407939(0x193)]({'where':{'id':_0x369663},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x55c85f){_0x9c9c49[_0x407939(0x1d6)](0x194)[_0x407939(0x1cc)]({'success':![],'error':_0x407939(0x1dd)});return;}if(_0x55c85f[_0x407939(0x1e9)]!==_0x407939(0x1de)&&_0x55c85f[_0x407939(0x1e9)]!==_0x407939(0x1f2)){_0x9c9c49[_0x407939(0x1d6)](0x190)[_0x407939(0x1cc)]({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x55c85f[_0x407939(0x1e9)]});return;}let _0x5b14c7='',_0x41d5be=_0x55c85f['currency'],_0x4dccc8='';if(_0x55c85f['gateway']===_0x407939(0x1de))_0x4dccc8='Interac\x20e-Transfer',_0x41d5be=_0x407939(0x19f),_0x5b14c7=_0x407939(0x19a)+_0x55c85f['amount']+'\x20'+_0x41d5be+_0x407939(0x1cd);else _0x55c85f[_0x407939(0x1e9)]===_0x407939(0x1f2)&&(_0x4dccc8=_0x407939(0x192),_0x41d5be='EUR',_0x5b14c7=_0x407939(0x1ad)+_0x55c85f[_0x407939(0x1bd)]+'\x20'+_0x41d5be+_0x407939(0x1cd));const _0x4c3715={'success':!![],'data':{'paymentId':_0x55c85f['id'],'gateway':_0x55c85f[_0x407939(0x1e9)],'gatewayName':_0x55c85f['gateway'][_0x407939(0x1db)](),'transferType':_0x4dccc8,'amount':_0x55c85f[_0x407939(0x1bd)],'currency':_0x41d5be,'status':_0x55c85f[_0x407939(0x1d6)],'instructions':_0x5b14c7,'shopName':_0x55c85f[_0x407939(0x1e1)][_0x407939(0x1c5)]||_0x55c85f[_0x407939(0x1e1)][_0x407939(0x1b8)],'hasProof':![],'proofType':null,'createdAt':_0x55c85f[_0x407939(0x1b7)],'updatedAt':_0x55c85f[_0x407939(0x1c0)],'supportedFileTypes':['PNG',_0x407939(0x1b6),_0x407939(0x1ce),_0x407939(0x1c9),'PDF'],'maxFileSize':'10MB'}};_0x9c9c49[_0x407939(0x1cc)](_0x4c3715);}catch(_0x264bd8){console[_0x407939(0x19b)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x264bd8),_0x9c9c49['status'](0x1f4)[_0x407939(0x1cc)]({'success':![],'error':_0x407939(0x1f0),'details':_0x264bd8 instanceof Error?_0x264bd8[_0x407939(0x1c7)]:_0x407939(0x1af)});}}}exports['ManualPaymentController']=ManualPaymentController,exports[a8_0x4c496b(0x1e4)]=new ManualPaymentController();