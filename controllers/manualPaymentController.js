'use strict';const a10_0x47e173=a10_0x3473;function a10_0x3473(_0x748f73,_0x3dce2b){_0x748f73=_0x748f73-0x164;const _0x19b34b=a10_0x19b3();let _0x347393=_0x19b34b[_0x748f73];return _0x347393;}function a10_0x19b3(){const _0x121e90=['üè™\x20Shop:\x20','amount','message','unknown','\x20\x20\x20-\x20File\x20size:\x20','PNG','üîÑ\x20','Markdown','includes','sendShopNotification','jpg','toUpperCase','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','EUR','payment_proof_','Payment\x20not\x20found','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','2093769JKxbnd','Unsupported\x20file\x20type:\x20','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','join','üåê\x20Customer\x20IP:\x20','manualPaymentController','uploadPaymentProof','Invalid\x20base64\x20file\x20data','json','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','211944lowCxP','__esModule','PROCESSING','__importDefault','JPEG','sendDirectMessage','.\x20Supported:\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent','name','üìã\x20Get\x20manual\x20payment\x20info:\x20','üí∞\x20Amount:\x20','Interac\x20e-Transfer','base64','Payment\x20ID\x20is\x20required','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','updatedAt','username','68787GvRAiC','from','File\x20data\x20is\x20required','heic','createdAt','sepa','SEPA\x20Bank\x20Transfer','default','findUnique','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','File\x20type\x20is\x20required','ManualPaymentController','../config/database','sendDirectFile','\x20\x20\x20-\x20Payment\x20ID:\x20','split','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','\x20Payment\x20Proof\x20Received\x0a\x0a','üìÅ\x20File:\x20','status','206230RKEDQs','86527mklvWN','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','276MNDGDz','toLowerCase','üìÅ\x20File\x20type:\x20','../services/telegramBotService','telegramBotService','HEIC','Unknown\x20error','remoteAddress','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','sendShopFile','error','log','length','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','‚ùå\x20Payment\x20not\x20found:\x20','üí≥\x20Payment\x20ID:\x20','gateway','replace','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','Payment\x20proof\x20uploaded\x20successfully','PDF','round','connection','1826040CInfVg','9agjXlr','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','currency','params','shop','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','jpeg','2195208BIcKVW','\x20\x20\x20-\x20Gateway:\x20','‚ùå\x20Upload\x20payment\x20proof\x20error:','payment','body','shopId','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','interac'];a10_0x19b3=function(){return _0x121e90;};return a10_0x19b3();}(function(_0x4de201,_0x4d9867){const _0x47f5ae=a10_0x3473,_0x408323=_0x4de201();while(!![]){try{const _0x3a9aa6=-parseInt(_0x47f5ae(0x1ca))/0x1+parseInt(_0x47f5ae(0x173))/0x2+parseInt(_0x47f5ae(0x1af))/0x3+-parseInt(_0x47f5ae(0x195))/0x4+-parseInt(_0x47f5ae(0x18d))/0x5+parseInt(_0x47f5ae(0x176))/0x6*(parseInt(_0x47f5ae(0x174))/0x7)+-parseInt(_0x47f5ae(0x1b9))/0x8*(parseInt(_0x47f5ae(0x18e))/0x9);if(_0x3a9aa6===_0x4d9867)break;else _0x408323['push'](_0x408323['shift']());}catch(_0x5d48d0){_0x408323['push'](_0x408323['shift']());}}}(a10_0x19b3,0x57fa2));var __importDefault=this&&this[a10_0x47e173(0x1bc)]||function(_0x5ae320){const _0x13f15e=a10_0x47e173;return _0x5ae320&&_0x5ae320[_0x13f15e(0x1ba)]?_0x5ae320:{'default':_0x5ae320};};Object['defineProperty'](exports,a10_0x47e173(0x1ba),{'value':!![]}),exports[a10_0x47e173(0x1b4)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a10_0x47e173(0x16b))),telegramBotService_1=require(a10_0x47e173(0x179));class ManualPaymentController{async[a10_0x47e173(0x1b5)](_0x3634c5,_0x5e31b7){const _0x48b83e=a10_0x47e173;try{const {paymentId:_0x19092e,fileData:_0x29bacb,fileType:_0x3f8e8b,fileName:_0x24451b}=_0x3634c5[_0x48b83e(0x199)],_0x23b5c7=_0x3634c5['ip']||_0x3634c5[_0x48b83e(0x18c)]?.[_0x48b83e(0x17d)]||_0x48b83e(0x1a1);console[_0x48b83e(0x181)]('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x19092e),console[_0x48b83e(0x181)](_0x48b83e(0x178)+_0x3f8e8b+',\x20size:\x20'+(_0x29bacb?Math['round'](_0x29bacb['length']*0.75/0x400):0x0)+'KB'),console[_0x48b83e(0x181)]('üåê\x20Client\x20IP:\x20'+_0x23b5c7);if(!_0x19092e){_0x5e31b7[_0x48b83e(0x172)](0x190)[_0x48b83e(0x1b7)]({'success':![],'error':_0x48b83e(0x1c6)});return;}if(!_0x29bacb){_0x5e31b7[_0x48b83e(0x172)](0x190)[_0x48b83e(0x1b7)]({'success':![],'error':_0x48b83e(0x1cc)});return;}if(!_0x3f8e8b){_0x5e31b7[_0x48b83e(0x172)](0x190)[_0x48b83e(0x1b7)]({'success':![],'error':_0x48b83e(0x169)});return;}const _0x7a1e63=['png',_0x48b83e(0x1a8),_0x48b83e(0x194),_0x48b83e(0x1cd),'pdf'],_0x451573=_0x3f8e8b[_0x48b83e(0x177)]()[_0x48b83e(0x187)]('.','');if(!_0x7a1e63['includes'](_0x451573)){_0x5e31b7[_0x48b83e(0x172)](0x190)[_0x48b83e(0x1b7)]({'success':![],'error':_0x48b83e(0x1b0)+_0x3f8e8b+_0x48b83e(0x1bf)+_0x7a1e63[_0x48b83e(0x1b2)](',\x20')});return;}const _0x8726e0=0xa*0x400*0x400;if(_0x29bacb[_0x48b83e(0x182)]>_0x8726e0){_0x5e31b7[_0x48b83e(0x172)](0x190)[_0x48b83e(0x1b7)]({'success':![],'error':_0x48b83e(0x193)});return;}const _0x1bc724=await database_1[_0x48b83e(0x166)]['payment'][_0x48b83e(0x167)]({'where':{'id':_0x19092e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1bc724){console[_0x48b83e(0x181)](_0x48b83e(0x184)+_0x19092e),_0x5e31b7[_0x48b83e(0x172)](0x194)['json']({'success':![],'error':_0x48b83e(0x1ad)});return;}if(_0x1bc724[_0x48b83e(0x186)]!==_0x48b83e(0x19d)&&_0x1bc724['gateway']!=='sepa'){console[_0x48b83e(0x181)]('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x1bc724[_0x48b83e(0x186)]),_0x5e31b7['status'](0x190)[_0x48b83e(0x1b7)]({'success':![],'error':_0x48b83e(0x188)+_0x1bc724[_0x48b83e(0x186)]});return;}let _0x1b2899=_0x29bacb;_0x29bacb[_0x48b83e(0x1a6)](',')&&(_0x1b2899=_0x29bacb[_0x48b83e(0x16e)](',')[0x1]);try{Buffer[_0x48b83e(0x1cb)](_0x1b2899,'base64');}catch(_0x417446){_0x5e31b7['status'](0x190)['json']({'success':![],'error':_0x48b83e(0x1b6)});return;}const _0x119a9c=await database_1[_0x48b83e(0x166)][_0x48b83e(0x198)]['update']({'where':{'id':_0x19092e},'data':{'status':_0x48b83e(0x1bb),'updatedAt':new Date()}});console[_0x48b83e(0x181)]('‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:'),console[_0x48b83e(0x181)](_0x48b83e(0x16d)+_0x19092e),console[_0x48b83e(0x181)](_0x48b83e(0x196)+_0x1bc724[_0x48b83e(0x186)]['toUpperCase']()),console['log']('\x20\x20\x20-\x20File\x20type:\x20'+_0x451573),console[_0x48b83e(0x181)](_0x48b83e(0x1a2)+Math['round'](_0x1b2899[_0x48b83e(0x182)]*0.75/0x400)+'KB'),console[_0x48b83e(0x181)](_0x48b83e(0x1aa));try{const _0x2f6610=_0x1bc724['gateway'][_0x48b83e(0x1a9)](),_0x529022=_0x1bc724[_0x48b83e(0x192)][_0x48b83e(0x1c1)]||_0x1bc724[_0x48b83e(0x192)][_0x48b83e(0x1c9)],_0x225cef=Math[_0x48b83e(0x18b)](_0x1b2899[_0x48b83e(0x182)]*0.75/0x400),_0x53b3d6=_0x48b83e(0x1a4)+_0x2f6610+_0x48b83e(0x170)+(_0x48b83e(0x185)+_0x19092e+'\x0a')+(_0x48b83e(0x1c3)+_0x1bc724['amount']+'\x20'+_0x1bc724[_0x48b83e(0x190)]+'\x0a')+(_0x48b83e(0x171)+_0x451573['toUpperCase']()+'\x20('+_0x225cef+'KB)\x0a')+_0x48b83e(0x175)+(_0x48b83e(0x1b3)+_0x23b5c7+'\x0a\x0a')+_0x48b83e(0x19b);await telegramBotService_1[_0x48b83e(0x17a)][_0x48b83e(0x1a7)](_0x1bc724[_0x48b83e(0x19a)],_0x53b3d6,{'parse_mode':_0x48b83e(0x1a5)});const _0x531d40=Buffer[_0x48b83e(0x1cb)](_0x1b2899,_0x48b83e(0x1c5)),_0x4065a2=_0x48b83e(0x1ac)+_0x19092e+'.'+_0x451573;await telegramBotService_1['telegramBotService'][_0x48b83e(0x17f)](_0x1bc724[_0x48b83e(0x19a)],_0x531d40,_0x4065a2,'Payment\x20proof\x20for\x20'+_0x19092e),console['log'](_0x48b83e(0x19c));const _0x5da9c0='7867339505',_0x2ef5eb=_0x48b83e(0x1a4)+_0x2f6610+_0x48b83e(0x183)+(_0x48b83e(0x185)+_0x19092e+'\x0a')+(_0x48b83e(0x19e)+_0x529022+'\x0a')+(_0x48b83e(0x1c3)+_0x1bc724['amount']+'\x20'+_0x1bc724[_0x48b83e(0x190)]+'\x0a')+(_0x48b83e(0x171)+_0x451573[_0x48b83e(0x1a9)]()+'\x20('+_0x225cef+'KB)\x0a')+_0x48b83e(0x175)+(_0x48b83e(0x1b3)+_0x23b5c7+'\x0a\x0a')+_0x48b83e(0x16f);await telegramBotService_1[_0x48b83e(0x17a)][_0x48b83e(0x1be)](parseInt(_0x5da9c0),_0x2ef5eb),await telegramBotService_1[_0x48b83e(0x17a)][_0x48b83e(0x16c)](parseInt(_0x5da9c0),_0x531d40,_0x4065a2,_0x48b83e(0x1b1)+_0x19092e),console['log'](_0x48b83e(0x1c0));}catch(_0x2fab4c){console[_0x48b83e(0x180)](_0x48b83e(0x18f),_0x2fab4c);}_0x5e31b7[_0x48b83e(0x1b7)]({'success':!![],'message':_0x48b83e(0x189),'data':{'paymentId':_0x119a9c['id'],'status':_0x119a9c[_0x48b83e(0x172)],'gateway':_0x1bc724[_0x48b83e(0x186)],'fileType':_0x451573,'fileSize':Math[_0x48b83e(0x18b)](_0x1b2899[_0x48b83e(0x182)]*0.75/0x400)+'KB','uploadedAt':_0x119a9c[_0x48b83e(0x1c8)]}});}catch(_0x3eb76a){console[_0x48b83e(0x180)](_0x48b83e(0x197),_0x3eb76a),_0x5e31b7[_0x48b83e(0x172)](0x1f4)['json']({'success':![],'error':'Internal\x20server\x20error','details':_0x3eb76a instanceof Error?_0x3eb76a[_0x48b83e(0x1a0)]:_0x48b83e(0x17c)});}}async['getManualPaymentInfo'](_0x16ba40,_0x1fd72e){const _0x19121c=a10_0x47e173;try{const {paymentId:_0x2aa0a8}=_0x16ba40[_0x19121c(0x191)];console['log'](_0x19121c(0x1c2)+_0x2aa0a8);const _0x471cca=await database_1[_0x19121c(0x166)]['payment'][_0x19121c(0x167)]({'where':{'id':_0x2aa0a8},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x471cca){_0x1fd72e[_0x19121c(0x172)](0x194)[_0x19121c(0x1b7)]({'success':![],'error':_0x19121c(0x1ad)});return;}if(_0x471cca[_0x19121c(0x186)]!=='interac'&&_0x471cca[_0x19121c(0x186)]!=='sepa'){_0x1fd72e[_0x19121c(0x172)](0x190)[_0x19121c(0x1b7)]({'success':![],'error':_0x19121c(0x1b8)+_0x471cca[_0x19121c(0x186)]});return;}let _0x562f61='',_0x1ff500=_0x471cca[_0x19121c(0x190)],_0x4c7d02='';if(_0x471cca[_0x19121c(0x186)]===_0x19121c(0x19d))_0x4c7d02=_0x19121c(0x1c4),_0x1ff500='CAD',_0x562f61=_0x19121c(0x1c7)+_0x471cca['amount']+'\x20'+_0x1ff500+_0x19121c(0x17e);else _0x471cca[_0x19121c(0x186)]===_0x19121c(0x164)&&(_0x4c7d02=_0x19121c(0x165),_0x1ff500=_0x19121c(0x1ab),_0x562f61=_0x19121c(0x1ae)+_0x471cca[_0x19121c(0x19f)]+'\x20'+_0x1ff500+_0x19121c(0x17e));const _0x45e2d2={'success':!![],'data':{'paymentId':_0x471cca['id'],'gateway':_0x471cca[_0x19121c(0x186)],'gatewayName':_0x471cca[_0x19121c(0x186)][_0x19121c(0x1a9)](),'transferType':_0x4c7d02,'amount':_0x471cca[_0x19121c(0x19f)],'currency':_0x1ff500,'status':_0x471cca[_0x19121c(0x172)],'instructions':_0x562f61,'shopName':_0x471cca['shop'][_0x19121c(0x1c1)]||_0x471cca[_0x19121c(0x192)][_0x19121c(0x1c9)],'hasProof':![],'proofType':null,'createdAt':_0x471cca[_0x19121c(0x1ce)],'updatedAt':_0x471cca['updatedAt'],'supportedFileTypes':[_0x19121c(0x1a3),'JPG',_0x19121c(0x1bd),_0x19121c(0x17b),_0x19121c(0x18a)],'maxFileSize':'10MB'}};_0x1fd72e[_0x19121c(0x1b7)](_0x45e2d2);}catch(_0x1a8090){console['error'](_0x19121c(0x168),_0x1a8090),_0x1fd72e[_0x19121c(0x172)](0x1f4)[_0x19121c(0x1b7)]({'success':![],'error':'Internal\x20server\x20error','details':_0x1a8090 instanceof Error?_0x1a8090['message']:_0x19121c(0x17c)});}}}exports[a10_0x47e173(0x16a)]=ManualPaymentController,exports[a10_0x47e173(0x1b4)]=new ManualPaymentController();