'use strict';function a8_0x78a4(_0xec75a,_0x3dc3a9){const _0x3a8947=a8_0x3a89();return a8_0x78a4=function(_0x78a433,_0x4d0c38){_0x78a433=_0x78a433-0xc5;let _0x294c9c=_0x3a8947[_0x78a433];return _0x294c9c;},a8_0x78a4(_0xec75a,_0x3dc3a9);}const a8_0x3d2172=a8_0x78a4;(function(_0x7c089e,_0x7ee007){const _0x583b0c=a8_0x78a4,_0x3bea77=_0x7c089e();while(!![]){try{const _0x301b29=parseInt(_0x583b0c(0xfc))/0x1+-parseInt(_0x583b0c(0xd6))/0x2*(parseInt(_0x583b0c(0x107))/0x3)+-parseInt(_0x583b0c(0xe6))/0x4+-parseInt(_0x583b0c(0x104))/0x5+parseInt(_0x583b0c(0xcc))/0x6*(-parseInt(_0x583b0c(0x121))/0x7)+-parseInt(_0x583b0c(0xd2))/0x8*(parseInt(_0x583b0c(0x11c))/0x9)+parseInt(_0x583b0c(0x109))/0xa;if(_0x301b29===_0x7ee007)break;else _0x3bea77['push'](_0x3bea77['shift']());}catch(_0x27b439){_0x3bea77['push'](_0x3bea77['shift']());}}}(a8_0x3a89,0x3af61));var __importDefault=this&&this['__importDefault']||function(_0x82d032){return _0x82d032&&_0x82d032['__esModule']?_0x82d032:{'default':_0x82d032};};Object[a8_0x3d2172(0x12b)](exports,'__esModule',{'value':!![]}),exports['manualPaymentController']=exports[a8_0x3d2172(0x115)]=void 0x0;function a8_0x3a89(){const _0x2de42b=['Interac\x20e-Transfer','8253NkxKOB','üåê\x20Client\x20IP:\x20','EUR','updatedAt','Payment\x20not\x20found','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','png','üìÅ\x20File\x20type:\x20','üåê\x20Customer\x20IP:\x20','length','defineProperty','telegramBotService','toUpperCase','findUnique',',\x20size:\x20','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','replace','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','KB)\x0a','HEIC','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','\x20\x20\x20-\x20File\x20size:\x20','366XDKvmK','gateway','7867339505','\x20\x20\x20-\x20File\x20type:\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent','manualPaymentController','22424AnTHBp','pdf','Unknown\x20error','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','590626qkcGLH','Payment\x20proof\x20uploaded\x20successfully','error','remoteAddress','status','includes','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','sendDirectFile','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','Unsupported\x20file\x20type:\x20','sendShopFile','toLowerCase','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','message','currency','payment','1504200hjspqe','10MB','../services/telegramBotService','üè™\x20Shop:\x20','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','interac','base64','default','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','getManualPaymentInfo','sepa','Payment\x20ID\x20is\x20required','log','PNG','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','.\x20Supported:\x20','params','join','unknown','sendShopNotification','from','\x20Payment\x20Proof\x20Received\x0a\x0a','214611aNgbXf','json','‚ùå\x20Upload\x20payment\x20proof\x20error:','username','jpeg','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','uploadPaymentProof','üí≥\x20Payment\x20ID:\x20','2299915tewUHR','round','name','3GehRRO','update','13675060UVZYDU','Internal\x20server\x20error','shop','amount','Invalid\x20base64\x20file\x20data','üîÑ\x20','üí∞\x20Amount:\x20','üìã\x20Get\x20manual\x20payment\x20info:\x20','shopId','PDF','Markdown','\x20\x20\x20-\x20Gateway:\x20','ManualPaymentController','../config/database','connection','sendDirectMessage','SEPA\x20Bank\x20Transfer','split','CAD','441oCDtEx','payment_proof_','createdAt','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'];a8_0x3a89=function(){return _0x2de42b;};return a8_0x3a89();}const database_1=__importDefault(require(a8_0x3d2172(0x116))),telegramBotService_1=require(a8_0x3d2172(0xe8));class ManualPaymentController{async[a8_0x3d2172(0x102)](_0x4a0043,_0x18b1f3){const _0x4d4623=a8_0x3d2172;try{const {paymentId:_0x24fc11,fileData:_0x40837d,fileType:_0x419370,fileName:_0x14b2cf}=_0x4a0043['body'],_0x41e343=_0x4a0043['ip']||_0x4a0043[_0x4d4623(0x117)]?.[_0x4d4623(0xd9)]||_0x4d4623(0xf8);console[_0x4d4623(0xf2)](_0x4d4623(0xee)+_0x24fc11),console[_0x4d4623(0xf2)](_0x4d4623(0x128)+_0x419370+_0x4d4623(0x12f)+(_0x40837d?Math[_0x4d4623(0x105)](_0x40837d[_0x4d4623(0x12a)]*0.75/0x400):0x0)+'KB'),console['log'](_0x4d4623(0x122)+_0x41e343);if(!_0x24fc11){_0x18b1f3[_0x4d4623(0xda)](0x190)[_0x4d4623(0xfd)]({'success':![],'error':_0x4d4623(0xf1)});return;}if(!_0x40837d){_0x18b1f3['status'](0x190)[_0x4d4623(0xfd)]({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x419370){_0x18b1f3[_0x4d4623(0xda)](0x190)[_0x4d4623(0xfd)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x1ea5dc=[_0x4d4623(0x127),'jpg',_0x4d4623(0x100),'heic',_0x4d4623(0xd3)],_0x98e3a4=_0x419370[_0x4d4623(0xe1)]()[_0x4d4623(0xc6)]('.','');if(!_0x1ea5dc[_0x4d4623(0xdb)](_0x98e3a4)){_0x18b1f3['status'](0x190)[_0x4d4623(0xfd)]({'success':![],'error':_0x4d4623(0xdf)+_0x419370+_0x4d4623(0xf5)+_0x1ea5dc[_0x4d4623(0xf7)](',\x20')});return;}const _0x1ead4c=0xa*0x400*0x400;if(_0x40837d[_0x4d4623(0x12a)]>_0x1ead4c){_0x18b1f3['status'](0x190)['json']({'success':![],'error':_0x4d4623(0xdc)});return;}const _0x17dba3=await database_1['default'][_0x4d4623(0xe5)]['findUnique']({'where':{'id':_0x24fc11},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x17dba3){console[_0x4d4623(0xf2)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x24fc11),_0x18b1f3[_0x4d4623(0xda)](0x194)[_0x4d4623(0xfd)]({'success':![],'error':_0x4d4623(0x125)});return;}if(_0x17dba3['gateway']!==_0x4d4623(0xeb)&&_0x17dba3[_0x4d4623(0xcd)]!=='sepa'){console[_0x4d4623(0xf2)](_0x4d4623(0xea)+_0x17dba3[_0x4d4623(0xcd)]),_0x18b1f3[_0x4d4623(0xda)](0x190)['json']({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x17dba3[_0x4d4623(0xcd)]});return;}let _0x4288ed=_0x40837d;_0x40837d[_0x4d4623(0xdb)](',')&&(_0x4288ed=_0x40837d[_0x4d4623(0x11a)](',')[0x1]);try{Buffer[_0x4d4623(0xfa)](_0x4288ed,_0x4d4623(0xec));}catch(_0x3a82fc){_0x18b1f3[_0x4d4623(0xda)](0x190)[_0x4d4623(0xfd)]({'success':![],'error':_0x4d4623(0x10d)});return;}const _0x12c62f=await database_1[_0x4d4623(0xed)][_0x4d4623(0xe5)][_0x4d4623(0x108)]({'where':{'id':_0x24fc11},'data':{'status':'PROCESSING','updatedAt':new Date()}});console[_0x4d4623(0xf2)](_0x4d4623(0x101)),console['log']('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x24fc11),console[_0x4d4623(0xf2)](_0x4d4623(0x114)+_0x17dba3[_0x4d4623(0xcd)][_0x4d4623(0x12d)]()),console[_0x4d4623(0xf2)](_0x4d4623(0xcf)+_0x98e3a4),console['log'](_0x4d4623(0xcb)+Math[_0x4d4623(0x105)](_0x4288ed[_0x4d4623(0x12a)]*0.75/0x400)+'KB'),console[_0x4d4623(0xf2)](_0x4d4623(0xd5));try{const _0x2e345d=_0x17dba3[_0x4d4623(0xcd)][_0x4d4623(0x12d)](),_0x3f8fcd=_0x17dba3[_0x4d4623(0x10b)][_0x4d4623(0x106)]||_0x17dba3['shop'][_0x4d4623(0xff)],_0x310d80=Math[_0x4d4623(0x105)](_0x4288ed[_0x4d4623(0x12a)]*0.75/0x400),_0x33954a=_0x4d4623(0x10e)+_0x2e345d+_0x4d4623(0xfb)+(_0x4d4623(0x103)+_0x24fc11+'\x0a')+(_0x4d4623(0x10f)+_0x17dba3[_0x4d4623(0x10c)]+'\x20'+_0x17dba3[_0x4d4623(0xe4)]+'\x0a')+('üìÅ\x20File:\x20'+_0x98e3a4['toUpperCase']()+'\x20('+_0x310d80+_0x4d4623(0xc8))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x4d4623(0x129)+_0x41e343+'\x0a\x0a')+'‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1[_0x4d4623(0x12c)][_0x4d4623(0xf9)](_0x17dba3['shopId'],_0x33954a,{'parse_mode':_0x4d4623(0x113)});const _0x58b930=Buffer[_0x4d4623(0xfa)](_0x4288ed,'base64'),_0x159ec6=_0x4d4623(0x11d)+_0x24fc11+'.'+_0x98e3a4;await telegramBotService_1[_0x4d4623(0x12c)][_0x4d4623(0xe0)](_0x17dba3[_0x4d4623(0x111)],_0x58b930,_0x159ec6,'Payment\x20proof\x20for\x20'+_0x24fc11),console[_0x4d4623(0xf2)]('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x3a0f67=_0x4d4623(0xce),_0x519bc9='üîÑ\x20'+_0x2e345d+_0x4d4623(0xca)+(_0x4d4623(0x103)+_0x24fc11+'\x0a')+(_0x4d4623(0xe9)+_0x3f8fcd+'\x0a')+(_0x4d4623(0x10f)+_0x17dba3['amount']+'\x20'+_0x17dba3['currency']+'\x0a')+('üìÅ\x20File:\x20'+_0x98e3a4[_0x4d4623(0x12d)]()+'\x20('+_0x310d80+_0x4d4623(0xc8))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x4d4623(0x129)+_0x41e343+'\x0a\x0a')+_0x4d4623(0x126);await telegramBotService_1[_0x4d4623(0x12c)][_0x4d4623(0x118)](parseInt(_0x3a0f67),_0x519bc9),await telegramBotService_1[_0x4d4623(0x12c)][_0x4d4623(0xdd)](parseInt(_0x3a0f67),_0x58b930,_0x159ec6,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x24fc11),console[_0x4d4623(0xf2)](_0x4d4623(0xd0));}catch(_0x3d8913){console[_0x4d4623(0xd8)](_0x4d4623(0xc7),_0x3d8913);}_0x18b1f3[_0x4d4623(0xfd)]({'success':!![],'message':_0x4d4623(0xd7),'data':{'paymentId':_0x12c62f['id'],'status':_0x12c62f[_0x4d4623(0xda)],'gateway':_0x17dba3['gateway'],'fileType':_0x98e3a4,'fileSize':Math[_0x4d4623(0x105)](_0x4288ed[_0x4d4623(0x12a)]*0.75/0x400)+'KB','uploadedAt':_0x12c62f[_0x4d4623(0x124)]}});}catch(_0x2f87cc){console['error'](_0x4d4623(0xfe),_0x2f87cc),_0x18b1f3[_0x4d4623(0xda)](0x1f4)['json']({'success':![],'error':_0x4d4623(0x10a),'details':_0x2f87cc instanceof Error?_0x2f87cc[_0x4d4623(0xe3)]:_0x4d4623(0xd4)});}}async[a8_0x3d2172(0xef)](_0x23b1bd,_0x3a258b){const _0x3b695b=a8_0x3d2172;try{const {paymentId:_0x1ad0de}=_0x23b1bd[_0x3b695b(0xf6)];console[_0x3b695b(0xf2)](_0x3b695b(0x110)+_0x1ad0de);const _0x39f0d6=await database_1['default']['payment'][_0x3b695b(0x12e)]({'where':{'id':_0x1ad0de},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x39f0d6){_0x3a258b[_0x3b695b(0xda)](0x194)[_0x3b695b(0xfd)]({'success':![],'error':_0x3b695b(0x125)});return;}if(_0x39f0d6[_0x3b695b(0xcd)]!==_0x3b695b(0xeb)&&_0x39f0d6[_0x3b695b(0xcd)]!==_0x3b695b(0xf0)){_0x3a258b[_0x3b695b(0xda)](0x190)[_0x3b695b(0xfd)]({'success':![],'error':_0x3b695b(0xf4)+_0x39f0d6[_0x3b695b(0xcd)]});return;}let _0x3a4b5a='',_0x1621b3=_0x39f0d6['currency'],_0x5a2114='';if(_0x39f0d6['gateway']===_0x3b695b(0xeb))_0x5a2114=_0x3b695b(0x120),_0x1621b3=_0x3b695b(0x11b),_0x3a4b5a=_0x3b695b(0x11f)+_0x39f0d6[_0x3b695b(0x10c)]+'\x20'+_0x1621b3+_0x3b695b(0xe2);else _0x39f0d6['gateway']==='sepa'&&(_0x5a2114=_0x3b695b(0x119),_0x1621b3=_0x3b695b(0x123),_0x3a4b5a=_0x3b695b(0xc5)+_0x39f0d6[_0x3b695b(0x10c)]+'\x20'+_0x1621b3+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x23051a={'success':!![],'data':{'paymentId':_0x39f0d6['id'],'gateway':_0x39f0d6[_0x3b695b(0xcd)],'gatewayName':_0x39f0d6['gateway'][_0x3b695b(0x12d)](),'transferType':_0x5a2114,'amount':_0x39f0d6[_0x3b695b(0x10c)],'currency':_0x1621b3,'status':_0x39f0d6['status'],'instructions':_0x3a4b5a,'shopName':_0x39f0d6[_0x3b695b(0x10b)][_0x3b695b(0x106)]||_0x39f0d6[_0x3b695b(0x10b)][_0x3b695b(0xff)],'hasProof':![],'proofType':null,'createdAt':_0x39f0d6[_0x3b695b(0x11e)],'updatedAt':_0x39f0d6[_0x3b695b(0x124)],'supportedFileTypes':[_0x3b695b(0xf3),'JPG','JPEG',_0x3b695b(0xc9),_0x3b695b(0x112)],'maxFileSize':_0x3b695b(0xe7)}};_0x3a258b['json'](_0x23051a);}catch(_0x210a82){console[_0x3b695b(0xd8)](_0x3b695b(0xde),_0x210a82),_0x3a258b[_0x3b695b(0xda)](0x1f4)[_0x3b695b(0xfd)]({'success':![],'error':_0x3b695b(0x10a),'details':_0x210a82 instanceof Error?_0x210a82[_0x3b695b(0xe3)]:_0x3b695b(0xd4)});}}}exports[a8_0x3d2172(0x115)]=ManualPaymentController,exports[a8_0x3d2172(0xd1)]=new ManualPaymentController();