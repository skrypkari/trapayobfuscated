'use strict';const a8_0x3ff13b=a8_0x1fd7;(function(_0x4655de,_0x41371f){const _0xdb06b6=a8_0x1fd7,_0x15dd8b=_0x4655de();while(!![]){try{const _0x2adb12=-parseInt(_0xdb06b6(0xe2))/0x1*(-parseInt(_0xdb06b6(0xda))/0x2)+parseInt(_0xdb06b6(0x88))/0x3+parseInt(_0xdb06b6(0xdb))/0x4*(parseInt(_0xdb06b6(0xc2))/0x5)+parseInt(_0xdb06b6(0x89))/0x6*(-parseInt(_0xdb06b6(0xe3))/0x7)+parseInt(_0xdb06b6(0xe6))/0x8*(parseInt(_0xdb06b6(0x8c))/0x9)+parseInt(_0xdb06b6(0xbd))/0xa+-parseInt(_0xdb06b6(0xd9))/0xb*(parseInt(_0xdb06b6(0xb1))/0xc);if(_0x2adb12===_0x41371f)break;else _0x15dd8b['push'](_0x15dd8b['shift']());}catch(_0x21cc12){_0x15dd8b['push'](_0x15dd8b['shift']());}}}(a8_0x30ce,0x904d0));function a8_0x1fd7(_0x2752a9,_0xcf4cc5){const _0x30cedb=a8_0x30ce();return a8_0x1fd7=function(_0x1fd716,_0x4c3566){_0x1fd716=_0x1fd716-0x87;let _0x34005c=_0x30cedb[_0x1fd716];return _0x34005c;},a8_0x1fd7(_0x2752a9,_0xcf4cc5);}var __importDefault=this&&this[a8_0x3ff13b(0xa6)]||function(_0x38d90f){const _0x3cfdcb=a8_0x3ff13b;return _0x38d90f&&_0x38d90f[_0x3cfdcb(0xc3)]?_0x38d90f:{'default':_0x38d90f};};Object[a8_0x3ff13b(0xde)](exports,a8_0x3ff13b(0xc3),{'value':!![]}),exports[a8_0x3ff13b(0xbe)]=exports[a8_0x3ff13b(0xcf)]=void 0x0;function a8_0x30ce(){const _0x145ad7=['üîÑ\x20','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','5WfeJoe','__esModule',',\x20size:\x20','Unknown\x20error','PDF','KB)\x0a','üí∞\x20Amount:\x20','\x20Payment\x20Proof\x20Received\x0a\x0a','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','10MB','\x20\x20\x20-\x20Gateway:\x20','sendShopFile','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','ManualPaymentController','jpeg','HEIC','Payment\x20ID\x20is\x20required','Payment\x20proof\x20uploaded\x20successfully','üí≥\x20Payment\x20ID:\x20','\x20\x20\x20-\x20File\x20type:\x20','error','interac','toLowerCase','2357861xcPlUv','956VkyYpB','2749228LpTMKu','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','sepa','defineProperty','params','body','7867339505','422qbXtry','1765421sAKrPe','EUR','shop','1090296NGvpcF','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','gateway','PROCESSING','Payment\x20not\x20found','status','toUpperCase','../services/telegramBotService','üìÅ\x20File\x20type:\x20','Interac\x20e-Transfer','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','json','üìã\x20Get\x20manual\x20payment\x20info:\x20','File\x20type\x20is\x20required','2437065XnuXFp','12hStDUx','Payment\x20proof\x20for\x20','username','45JMsujt','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','payment_proof_','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','length','Unsupported\x20file\x20type:\x20','round','heic','\x20\x20\x20-\x20File\x20size:\x20','createdAt','split','jpg','payment','sendDirectMessage','telegramBotService','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','PNG','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','default','includes','log','amount','../config/database','uploadPaymentProof','__importDefault','SEPA\x20Bank\x20Transfer','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','üåê\x20Customer\x20IP:\x20','CAD','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','üè™\x20Shop:\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','shopId','name','message','96UGtzrJ','üìÅ\x20File:\x20','from','join','currency','JPG','sendShopNotification','‚ùå\x20Payment\x20not\x20found:\x20','\x20\x20\x20-\x20Payment\x20ID:\x20','pdf','Internal\x20server\x20error','.\x20Supported:\x20','4274570eLSVAE','manualPaymentController','base64'];a8_0x30ce=function(){return _0x145ad7;};return a8_0x30ce();}const database_1=__importDefault(require(a8_0x3ff13b(0xa4))),telegramBotService_1=require(a8_0x3ff13b(0xed));class ManualPaymentController{async[a8_0x3ff13b(0xa5)](_0x4db22a,_0x57b252){const _0x2cfd26=a8_0x3ff13b;try{const {paymentId:_0x40e662,fileData:_0x417ede,fileType:_0x30a5af,fileName:_0x1c8928}=_0x4db22a[_0x2cfd26(0xe0)],_0x315678=_0x4db22a['ip']||_0x4db22a['connection']?.['remoteAddress']||'unknown';console[_0x2cfd26(0xa2)](_0x2cfd26(0xab)+_0x40e662),console[_0x2cfd26(0xa2)](_0x2cfd26(0xee)+_0x30a5af+_0x2cfd26(0xc4)+(_0x417ede?Math[_0x2cfd26(0x92)](_0x417ede[_0x2cfd26(0x90)]*0.75/0x400):0x0)+'KB'),console[_0x2cfd26(0xa2)]('üåê\x20Client\x20IP:\x20'+_0x315678);if(!_0x40e662){_0x57b252[_0x2cfd26(0xeb)](0x190)[_0x2cfd26(0xf1)]({'success':![],'error':_0x2cfd26(0xd2)});return;}if(!_0x417ede){_0x57b252[_0x2cfd26(0xeb)](0x190)[_0x2cfd26(0xf1)]({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x30a5af){_0x57b252[_0x2cfd26(0xeb)](0x190)[_0x2cfd26(0xf1)]({'success':![],'error':_0x2cfd26(0x87)});return;}const _0x2c01c5=['png',_0x2cfd26(0x97),_0x2cfd26(0xd0),_0x2cfd26(0x93),_0x2cfd26(0xba)],_0x46536c=_0x30a5af[_0x2cfd26(0xd8)]()['replace']('.','');if(!_0x2c01c5[_0x2cfd26(0xa1)](_0x46536c)){_0x57b252[_0x2cfd26(0xeb)](0x190)['json']({'success':![],'error':_0x2cfd26(0x91)+_0x30a5af+_0x2cfd26(0xbc)+_0x2c01c5[_0x2cfd26(0xb4)](',\x20')});return;}const _0x498572=0xa*0x400*0x400;if(_0x417ede[_0x2cfd26(0x90)]>_0x498572){_0x57b252[_0x2cfd26(0xeb)](0x190)[_0x2cfd26(0xf1)]({'success':![],'error':_0x2cfd26(0xce)});return;}const _0x571cf2=await database_1[_0x2cfd26(0xa0)][_0x2cfd26(0x98)]['findUnique']({'where':{'id':_0x40e662},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x571cf2){console['log'](_0x2cfd26(0xb8)+_0x40e662),_0x57b252[_0x2cfd26(0xeb)](0x194)[_0x2cfd26(0xf1)]({'success':![],'error':_0x2cfd26(0xea)});return;}if(_0x571cf2[_0x2cfd26(0xe8)]!==_0x2cfd26(0xd7)&&_0x571cf2['gateway']!=='sepa'){console[_0x2cfd26(0xa2)](_0x2cfd26(0x9c)+_0x571cf2['gateway']),_0x57b252[_0x2cfd26(0xeb)](0x190)[_0x2cfd26(0xf1)]({'success':![],'error':_0x2cfd26(0x8d)+_0x571cf2[_0x2cfd26(0xe8)]});return;}let _0x379c0d=_0x417ede;_0x417ede[_0x2cfd26(0xa1)](',')&&(_0x379c0d=_0x417ede[_0x2cfd26(0x96)](',')[0x1]);try{Buffer[_0x2cfd26(0xb3)](_0x379c0d,'base64');}catch(_0x26a974){_0x57b252[_0x2cfd26(0xeb)](0x190)[_0x2cfd26(0xf1)]({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x127759=await database_1['default'][_0x2cfd26(0x98)]['update']({'where':{'id':_0x40e662},'data':{'status':_0x2cfd26(0xe9),'updatedAt':new Date()}});console[_0x2cfd26(0xa2)](_0x2cfd26(0x9e)),console[_0x2cfd26(0xa2)](_0x2cfd26(0xb9)+_0x40e662),console[_0x2cfd26(0xa2)](_0x2cfd26(0xcc)+_0x571cf2['gateway']['toUpperCase']()),console['log'](_0x2cfd26(0xd5)+_0x46536c),console[_0x2cfd26(0xa2)](_0x2cfd26(0x94)+Math[_0x2cfd26(0x92)](_0x379c0d[_0x2cfd26(0x90)]*0.75/0x400)+'KB'),console[_0x2cfd26(0xa2)](_0x2cfd26(0xad));try{const _0x53e223=_0x571cf2[_0x2cfd26(0xe8)][_0x2cfd26(0xec)](),_0x3355f1=_0x571cf2[_0x2cfd26(0xe5)][_0x2cfd26(0xaf)]||_0x571cf2['shop'][_0x2cfd26(0x8b)],_0x58f752=Math['round'](_0x379c0d[_0x2cfd26(0x90)]*0.75/0x400),_0x419505=_0x2cfd26(0xc0)+_0x53e223+_0x2cfd26(0xc9)+('üí≥\x20Payment\x20ID:\x20'+_0x40e662+'\x0a')+(_0x2cfd26(0xc8)+_0x571cf2[_0x2cfd26(0xa3)]+'\x20'+_0x571cf2['currency']+'\x0a')+(_0x2cfd26(0xb2)+_0x46536c[_0x2cfd26(0xec)]()+'\x20('+_0x58f752+_0x2cfd26(0xc7))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x2cfd26(0xa9)+_0x315678+'\x0a\x0a')+'‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1[_0x2cfd26(0x9a)][_0x2cfd26(0xb7)](_0x571cf2[_0x2cfd26(0xae)],_0x419505,{'parse_mode':'Markdown'});const _0x384ddd=Buffer[_0x2cfd26(0xb3)](_0x379c0d,_0x2cfd26(0xbf)),_0x25503b=_0x2cfd26(0x8e)+_0x40e662+'.'+_0x46536c;await telegramBotService_1[_0x2cfd26(0x9a)][_0x2cfd26(0xcd)](_0x571cf2[_0x2cfd26(0xae)],_0x384ddd,_0x25503b,_0x2cfd26(0x8a)+_0x40e662),console['log'](_0x2cfd26(0xca));const _0x5df2f9=_0x2cfd26(0xe1),_0x8d0a7e=_0x2cfd26(0xc0)+_0x53e223+_0x2cfd26(0x9b)+(_0x2cfd26(0xd4)+_0x40e662+'\x0a')+(_0x2cfd26(0xac)+_0x3355f1+'\x0a')+(_0x2cfd26(0xc8)+_0x571cf2['amount']+'\x20'+_0x571cf2[_0x2cfd26(0xb5)]+'\x0a')+(_0x2cfd26(0xb2)+_0x46536c['toUpperCase']()+'\x20('+_0x58f752+_0x2cfd26(0xc7))+_0x2cfd26(0xe7)+('üåê\x20Customer\x20IP:\x20'+_0x315678+'\x0a\x0a')+_0x2cfd26(0x9f);await telegramBotService_1[_0x2cfd26(0x9a)][_0x2cfd26(0x99)](parseInt(_0x5df2f9),_0x8d0a7e),await telegramBotService_1[_0x2cfd26(0x9a)]['sendDirectFile'](parseInt(_0x5df2f9),_0x384ddd,_0x25503b,_0x2cfd26(0xa8)+_0x40e662),console[_0x2cfd26(0xa2)]('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x5ec65a){console[_0x2cfd26(0xd6)]('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:',_0x5ec65a);}_0x57b252['json']({'success':!![],'message':_0x2cfd26(0xd3),'data':{'paymentId':_0x127759['id'],'status':_0x127759['status'],'gateway':_0x571cf2[_0x2cfd26(0xe8)],'fileType':_0x46536c,'fileSize':Math[_0x2cfd26(0x92)](_0x379c0d['length']*0.75/0x400)+'KB','uploadedAt':_0x127759['updatedAt']}});}catch(_0x218774){console[_0x2cfd26(0xd6)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x218774),_0x57b252['status'](0x1f4)[_0x2cfd26(0xf1)]({'success':![],'error':_0x2cfd26(0xbb),'details':_0x218774 instanceof Error?_0x218774[_0x2cfd26(0xb0)]:_0x2cfd26(0xc5)});}}async['getManualPaymentInfo'](_0x295632,_0x170298){const _0x3c45d9=a8_0x3ff13b;try{const {paymentId:_0x4a7664}=_0x295632[_0x3c45d9(0xdf)];console[_0x3c45d9(0xa2)](_0x3c45d9(0xf2)+_0x4a7664);const _0x1ab256=await database_1['default'][_0x3c45d9(0x98)]['findUnique']({'where':{'id':_0x4a7664},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1ab256){_0x170298[_0x3c45d9(0xeb)](0x194)[_0x3c45d9(0xf1)]({'success':![],'error':_0x3c45d9(0xea)});return;}if(_0x1ab256['gateway']!==_0x3c45d9(0xd7)&&_0x1ab256[_0x3c45d9(0xe8)]!=='sepa'){_0x170298['status'](0x190)[_0x3c45d9(0xf1)]({'success':![],'error':_0x3c45d9(0xdc)+_0x1ab256[_0x3c45d9(0xe8)]});return;}let _0xc6f484='',_0x5a60ed=_0x1ab256[_0x3c45d9(0xb5)],_0x7fe10='';if(_0x1ab256[_0x3c45d9(0xe8)]===_0x3c45d9(0xd7))_0x7fe10=_0x3c45d9(0xef),_0x5a60ed=_0x3c45d9(0xaa),_0xc6f484='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x1ab256['amount']+'\x20'+_0x5a60ed+_0x3c45d9(0x8f);else _0x1ab256[_0x3c45d9(0xe8)]===_0x3c45d9(0xdd)&&(_0x7fe10=_0x3c45d9(0xa7),_0x5a60ed=_0x3c45d9(0xe4),_0xc6f484=_0x3c45d9(0xc1)+_0x1ab256[_0x3c45d9(0xa3)]+'\x20'+_0x5a60ed+_0x3c45d9(0x8f));const _0x535655={'success':!![],'data':{'paymentId':_0x1ab256['id'],'gateway':_0x1ab256[_0x3c45d9(0xe8)],'gatewayName':_0x1ab256['gateway'][_0x3c45d9(0xec)](),'transferType':_0x7fe10,'amount':_0x1ab256[_0x3c45d9(0xa3)],'currency':_0x5a60ed,'status':_0x1ab256['status'],'instructions':_0xc6f484,'shopName':_0x1ab256[_0x3c45d9(0xe5)][_0x3c45d9(0xaf)]||_0x1ab256[_0x3c45d9(0xe5)][_0x3c45d9(0x8b)],'hasProof':![],'proofType':null,'createdAt':_0x1ab256[_0x3c45d9(0x95)],'updatedAt':_0x1ab256['updatedAt'],'supportedFileTypes':[_0x3c45d9(0x9d),_0x3c45d9(0xb6),'JPEG',_0x3c45d9(0xd1),_0x3c45d9(0xc6)],'maxFileSize':_0x3c45d9(0xcb)}};_0x170298['json'](_0x535655);}catch(_0x119d3b){console[_0x3c45d9(0xd6)](_0x3c45d9(0xf0),_0x119d3b),_0x170298[_0x3c45d9(0xeb)](0x1f4)[_0x3c45d9(0xf1)]({'success':![],'error':_0x3c45d9(0xbb),'details':_0x119d3b instanceof Error?_0x119d3b[_0x3c45d9(0xb0)]:_0x3c45d9(0xc5)});}}}exports['ManualPaymentController']=ManualPaymentController,exports[a8_0x3ff13b(0xbe)]=new ManualPaymentController();