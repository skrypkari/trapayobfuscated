'use strict';const a11_0x3aec3b=a11_0x31bd;(function(_0xe5fa69,_0x5d25f0){const _0x4ac1c2=a11_0x31bd,_0x2fe039=_0xe5fa69();while(!![]){try{const _0x4c7735=-parseInt(_0x4ac1c2(0x160))/0x1*(-parseInt(_0x4ac1c2(0x174))/0x2)+-parseInt(_0x4ac1c2(0x183))/0x3+parseInt(_0x4ac1c2(0x186))/0x4+-parseInt(_0x4ac1c2(0x135))/0x5*(parseInt(_0x4ac1c2(0x185))/0x6)+-parseInt(_0x4ac1c2(0x159))/0x7+-parseInt(_0x4ac1c2(0x18a))/0x8*(parseInt(_0x4ac1c2(0x16b))/0x9)+parseInt(_0x4ac1c2(0x141))/0xa*(parseInt(_0x4ac1c2(0x16a))/0xb);if(_0x4c7735===_0x5d25f0)break;else _0x2fe039['push'](_0x2fe039['shift']());}catch(_0xc10980){_0x2fe039['push'](_0x2fe039['shift']());}}}(a11_0x2604,0x41094));function a11_0x2604(){const _0x59e627=['interac','shop','length','üìã\x20Get\x20manual\x20payment\x20info:\x20','base64','Payment\x20ID\x20is\x20required',',\x20size:\x20','9320344SXxbvK','36pxepMP','7867339505','toUpperCase','createdAt','png','sepa','jpg','error','json','237764mbBZEo','üåê\x20Client\x20IP:\x20','\x20\x20\x20-\x20Payment\x20ID:\x20','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','round','manualPaymentController','telegramBotService','‚ùå\x20Upload\x20payment\x20proof\x20error:','Invalid\x20base64\x20file\x20data','Payment\x20not\x20found','amount','getManualPaymentInfo','PROCESSING','pdf','8835HiDgzh','body','445110ilUJLa','530096owyXlJ','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','üåê\x20Customer\x20IP:\x20','File\x20data\x20is\x20required','906616IShEYl','EUR','log','currency','JPEG','shopId','üè™\x20Shop:\x20','üîÑ\x20','PDF','\x20\x20\x20-\x20Gateway:\x20','Payment\x20proof\x20for\x20','update','username','Payment\x20proof\x20uploaded\x20successfully','remoteAddress','sendShopNotification','.\x20Supported:\x20','connection','25CXEVSm','payment','HEIC','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent','\x20\x20\x20-\x20File\x20size:\x20','join','KB)\x0a','üí∞\x20Amount:\x20','ManualPaymentController','from','gateway','10pjMwip','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','sendDirectFile','Unknown\x20error','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','uploadPaymentProof','üìÅ\x20File:\x20','SEPA\x20Bank\x20Transfer','replace','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','findUnique','\x20Payment\x20Proof\x20Received\x0a\x0a','PNG','üìÅ\x20File\x20type:\x20','CAD','jpeg','heic','\x20\x20\x20-\x20File\x20type:\x20','__esModule','File\x20type\x20is\x20required','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','message','__importDefault','default','868182sAyGPO','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','../config/database','name','2HKeEre','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','status'];a11_0x2604=function(){return _0x59e627;};return a11_0x2604();}var __importDefault=this&&this[a11_0x3aec3b(0x157)]||function(_0x5a276a){return _0x5a276a&&_0x5a276a['__esModule']?_0x5a276a:{'default':_0x5a276a};};Object['defineProperty'](exports,a11_0x3aec3b(0x153),{'value':!![]}),exports[a11_0x3aec3b(0x17a)]=exports[a11_0x3aec3b(0x13e)]=void 0x0;const database_1=__importDefault(require(a11_0x3aec3b(0x15e))),telegramBotService_1=require('../services/telegramBotService');function a11_0x31bd(_0x463e0a,_0x1861a3){_0x463e0a=_0x463e0a-0x12b;const _0x2604e7=a11_0x2604();let _0x31bd26=_0x2604e7[_0x463e0a];return _0x31bd26;}class ManualPaymentController{async[a11_0x3aec3b(0x146)](_0xa8ef03,_0x4511ec){const _0x215398=a11_0x3aec3b;try{const {paymentId:_0x3c6e5d,fileData:_0x39960c,fileType:_0x320a7b,fileName:_0x294f7a}=_0xa8ef03[_0x215398(0x184)],_0x386e34=_0xa8ef03['ip']||_0xa8ef03[_0x215398(0x134)]?.[_0x215398(0x131)]||'unknown';console[_0x215398(0x18c)](_0x215398(0x15b)+_0x3c6e5d),console[_0x215398(0x18c)](_0x215398(0x14e)+_0x320a7b+_0x215398(0x169)+(_0x39960c?Math['round'](_0x39960c[_0x215398(0x165)]*0.75/0x400):0x0)+'KB'),console[_0x215398(0x18c)](_0x215398(0x175)+_0x386e34);if(!_0x3c6e5d){_0x4511ec[_0x215398(0x162)](0x190)['json']({'success':![],'error':_0x215398(0x168)});return;}if(!_0x39960c){_0x4511ec[_0x215398(0x162)](0x190)[_0x215398(0x173)]({'success':![],'error':_0x215398(0x189)});return;}if(!_0x320a7b){_0x4511ec[_0x215398(0x162)](0x190)[_0x215398(0x173)]({'success':![],'error':_0x215398(0x154)});return;}const _0x150556=[_0x215398(0x16f),_0x215398(0x171),_0x215398(0x150),_0x215398(0x151),_0x215398(0x182)],_0x4f71d9=_0x320a7b['toLowerCase']()[_0x215398(0x149)]('.','');if(!_0x150556['includes'](_0x4f71d9)){_0x4511ec[_0x215398(0x162)](0x190)[_0x215398(0x173)]({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x320a7b+_0x215398(0x133)+_0x150556[_0x215398(0x13b)](',\x20')});return;}const _0x4f0d75=0xa*0x400*0x400;if(_0x39960c['length']>_0x4f0d75){_0x4511ec[_0x215398(0x162)](0x190)['json']({'success':![],'error':'File\x20too\x20large.\x20Maximum\x20size:\x2010MB'});return;}const _0x1d287c=await database_1[_0x215398(0x158)][_0x215398(0x136)][_0x215398(0x14b)]({'where':{'id':_0x3c6e5d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1d287c){console[_0x215398(0x18c)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x3c6e5d),_0x4511ec['status'](0x194)['json']({'success':![],'error':_0x215398(0x17e)});return;}if(_0x1d287c[_0x215398(0x140)]!=='interac'&&_0x1d287c['gateway']!==_0x215398(0x170)){console[_0x215398(0x18c)]('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x1d287c['gateway']),_0x4511ec[_0x215398(0x162)](0x190)[_0x215398(0x173)]({'success':![],'error':_0x215398(0x138)+_0x1d287c[_0x215398(0x140)]});return;}let _0x364528=_0x39960c;_0x39960c['includes'](',')&&(_0x364528=_0x39960c['split'](',')[0x1]);try{Buffer[_0x215398(0x13f)](_0x364528,_0x215398(0x167));}catch(_0x1c6981){_0x4511ec[_0x215398(0x162)](0x190)['json']({'success':![],'error':_0x215398(0x17d)});return;}const _0x39a45a=await database_1[_0x215398(0x158)]['payment'][_0x215398(0x12e)]({'where':{'id':_0x3c6e5d},'data':{'status':_0x215398(0x181),'updatedAt':new Date()}});console[_0x215398(0x18c)](_0x215398(0x155)),console[_0x215398(0x18c)](_0x215398(0x176)+_0x3c6e5d),console[_0x215398(0x18c)](_0x215398(0x12c)+_0x1d287c['gateway'][_0x215398(0x16d)]()),console['log'](_0x215398(0x152)+_0x4f71d9),console[_0x215398(0x18c)](_0x215398(0x13a)+Math[_0x215398(0x179)](_0x364528[_0x215398(0x165)]*0.75/0x400)+'KB'),console[_0x215398(0x18c)](_0x215398(0x15a));try{const _0x23ea7d=_0x1d287c[_0x215398(0x140)][_0x215398(0x16d)](),_0x462369=_0x1d287c[_0x215398(0x164)][_0x215398(0x15f)]||_0x1d287c['shop'][_0x215398(0x12f)],_0x3bfd46=Math[_0x215398(0x179)](_0x364528[_0x215398(0x165)]*0.75/0x400),_0x3be2ce='üîÑ\x20'+_0x23ea7d+_0x215398(0x14c)+('üí≥\x20Payment\x20ID:\x20'+_0x3c6e5d+'\x0a')+(_0x215398(0x13d)+_0x1d287c[_0x215398(0x17f)]+'\x20'+_0x1d287c[_0x215398(0x18d)]+'\x0a')+(_0x215398(0x147)+_0x4f71d9[_0x215398(0x16d)]()+'\x20('+_0x3bfd46+_0x215398(0x13c))+_0x215398(0x15c)+('üåê\x20Customer\x20IP:\x20'+_0x386e34+'\x0a\x0a')+_0x215398(0x187);await telegramBotService_1[_0x215398(0x17b)][_0x215398(0x132)](_0x1d287c[_0x215398(0x18f)],_0x3be2ce,{'parse_mode':'Markdown'});const _0x2c7cb8=Buffer[_0x215398(0x13f)](_0x364528,_0x215398(0x167)),_0x3a92df='payment_proof_'+_0x3c6e5d+'.'+_0x4f71d9;await telegramBotService_1[_0x215398(0x17b)]['sendShopFile'](_0x1d287c['shopId'],_0x2c7cb8,_0x3a92df,_0x215398(0x12d)+_0x3c6e5d),console[_0x215398(0x18c)](_0x215398(0x14a));const _0x3bf6ff=_0x215398(0x16c),_0x213b65=_0x215398(0x191)+_0x23ea7d+_0x215398(0x161)+('üí≥\x20Payment\x20ID:\x20'+_0x3c6e5d+'\x0a')+(_0x215398(0x190)+_0x462369+'\x0a')+('üí∞\x20Amount:\x20'+_0x1d287c[_0x215398(0x17f)]+'\x20'+_0x1d287c['currency']+'\x0a')+('üìÅ\x20File:\x20'+_0x4f71d9[_0x215398(0x16d)]()+'\x20('+_0x3bfd46+'KB)\x0a')+_0x215398(0x15c)+(_0x215398(0x188)+_0x386e34+'\x0a\x0a')+'‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.';await telegramBotService_1[_0x215398(0x17b)]['sendDirectMessage'](parseInt(_0x3bf6ff),_0x213b65),await telegramBotService_1['telegramBotService'][_0x215398(0x143)](parseInt(_0x3bf6ff),_0x2c7cb8,_0x3a92df,_0x215398(0x145)+_0x3c6e5d),console[_0x215398(0x18c)](_0x215398(0x139));}catch(_0x5a3ce7){console['error'](_0x215398(0x142),_0x5a3ce7);}_0x4511ec[_0x215398(0x173)]({'success':!![],'message':_0x215398(0x130),'data':{'paymentId':_0x39a45a['id'],'status':_0x39a45a[_0x215398(0x162)],'gateway':_0x1d287c[_0x215398(0x140)],'fileType':_0x4f71d9,'fileSize':Math[_0x215398(0x179)](_0x364528[_0x215398(0x165)]*0.75/0x400)+'KB','uploadedAt':_0x39a45a['updatedAt']}});}catch(_0x13e03c){console[_0x215398(0x172)](_0x215398(0x17c),_0x13e03c),_0x4511ec[_0x215398(0x162)](0x1f4)[_0x215398(0x173)]({'success':![],'error':'Internal\x20server\x20error','details':_0x13e03c instanceof Error?_0x13e03c['message']:_0x215398(0x144)});}}async[a11_0x3aec3b(0x180)](_0x2cdf7d,_0x129c65){const _0x481a2e=a11_0x3aec3b;try{const {paymentId:_0x31a94b}=_0x2cdf7d['params'];console[_0x481a2e(0x18c)](_0x481a2e(0x166)+_0x31a94b);const _0x3264cd=await database_1[_0x481a2e(0x158)][_0x481a2e(0x136)][_0x481a2e(0x14b)]({'where':{'id':_0x31a94b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3264cd){_0x129c65[_0x481a2e(0x162)](0x194)['json']({'success':![],'error':_0x481a2e(0x17e)});return;}if(_0x3264cd['gateway']!==_0x481a2e(0x163)&&_0x3264cd['gateway']!=='sepa'){_0x129c65[_0x481a2e(0x162)](0x190)['json']({'success':![],'error':_0x481a2e(0x178)+_0x3264cd[_0x481a2e(0x140)]});return;}let _0x4215f8='',_0x3be5a5=_0x3264cd['currency'],_0x2973c0='';if(_0x3264cd[_0x481a2e(0x140)]===_0x481a2e(0x163))_0x2973c0='Interac\x20e-Transfer',_0x3be5a5=_0x481a2e(0x14f),_0x4215f8='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x3264cd[_0x481a2e(0x17f)]+'\x20'+_0x3be5a5+_0x481a2e(0x177);else _0x3264cd[_0x481a2e(0x140)]===_0x481a2e(0x170)&&(_0x2973c0=_0x481a2e(0x148),_0x3be5a5=_0x481a2e(0x18b),_0x4215f8=_0x481a2e(0x15d)+_0x3264cd['amount']+'\x20'+_0x3be5a5+_0x481a2e(0x177));const _0x4f18f6={'success':!![],'data':{'paymentId':_0x3264cd['id'],'gateway':_0x3264cd['gateway'],'gatewayName':_0x3264cd[_0x481a2e(0x140)]['toUpperCase'](),'transferType':_0x2973c0,'amount':_0x3264cd[_0x481a2e(0x17f)],'currency':_0x3be5a5,'status':_0x3264cd[_0x481a2e(0x162)],'instructions':_0x4215f8,'shopName':_0x3264cd[_0x481a2e(0x164)][_0x481a2e(0x15f)]||_0x3264cd['shop'][_0x481a2e(0x12f)],'hasProof':![],'proofType':null,'createdAt':_0x3264cd[_0x481a2e(0x16e)],'updatedAt':_0x3264cd['updatedAt'],'supportedFileTypes':[_0x481a2e(0x14d),'JPG',_0x481a2e(0x18e),_0x481a2e(0x137),_0x481a2e(0x12b)],'maxFileSize':'10MB'}};_0x129c65['json'](_0x4f18f6);}catch(_0x430893){console[_0x481a2e(0x172)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x430893),_0x129c65[_0x481a2e(0x162)](0x1f4)[_0x481a2e(0x173)]({'success':![],'error':'Internal\x20server\x20error','details':_0x430893 instanceof Error?_0x430893[_0x481a2e(0x156)]:_0x481a2e(0x144)});}}}exports[a11_0x3aec3b(0x13e)]=ManualPaymentController,exports[a11_0x3aec3b(0x17a)]=new ManualPaymentController();