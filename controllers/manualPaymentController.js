'use strict';const a8_0x384cee=a8_0x359b;function a8_0x5344(){const _0x5e65b6=['includes','interac','jpg','KB)\x0a','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','PDF','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','jpeg','Internal\x20server\x20error','error','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','\x20\x20\x20-\x20Payment\x20ID:\x20','186jFSllX','toUpperCase','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','2945630ELOFAS','__importDefault','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','PNG','join','replace','shopId','sendShopNotification','ManualPaymentController','JPG','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','payment_proof_','username','remoteAddress','\x20\x20\x20-\x20File\x20size:\x20','üí∞\x20Amount:\x20','1549998DOgQZF','1541701SOjdET','message','split','findUnique','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','üåê\x20Client\x20IP:\x20','\x20\x20\x20-\x20File\x20type:\x20','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','4549EhDhMK','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','amount','shop','‚ùå\x20Payment\x20not\x20found:\x20','status','createdAt','params','18PRiIkh','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','Unknown\x20error','Invalid\x20base64\x20file\x20data','__esModule','Payment\x20proof\x20uploaded\x20successfully','1411744mRaeGI','body','update','length','log','uploadPaymentProof','üí≥\x20Payment\x20ID:\x20','default','Unsupported\x20file\x20type:\x20','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','üì±\x20Admin\x20notification\x20and\x20file\x20sent','7867339505','üè™\x20Shop:\x20','1510IOCugN','connection','File\x20data\x20is\x20required','Payment\x20not\x20found','from','unknown','üåê\x20Customer\x20IP:\x20','toLowerCase','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','base64','name','3201ChuVDW','üìÅ\x20File:\x20','png','round','sendShopFile','telegramBotService','File\x20type\x20is\x20required','gateway','pdf','sendDirectMessage','json','payment','sepa','currency','üìã\x20Get\x20manual\x20payment\x20info:\x20','Interac\x20e-Transfer','getManualPaymentInfo','PROCESSING','manualPaymentController','SEPA\x20Bank\x20Transfer','defineProperty','9908uAPkCW','updatedAt','9kXhfMR','HEIC','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','7332BPjnaS','\x20\x20\x20-\x20Gateway:\x20','Payment\x20proof\x20for\x20','JPEG'];a8_0x5344=function(){return _0x5e65b6;};return a8_0x5344();}function a8_0x359b(_0xc6b177,_0x159e37){const _0x534491=a8_0x5344();return a8_0x359b=function(_0x359ba2,_0x5d0ddd){_0x359ba2=_0x359ba2-0x87;let _0xf80ea6=_0x534491[_0x359ba2];return _0xf80ea6;},a8_0x359b(_0xc6b177,_0x159e37);}(function(_0x5ec03f,_0x681cdb){const _0x3039e3=a8_0x359b,_0x399c51=_0x5ec03f();while(!![]){try{const _0x4a387a=-parseInt(_0x3039e3(0xc8))/0x1*(-parseInt(_0x3039e3(0xac))/0x2)+parseInt(_0x3039e3(0xbf))/0x3+-parseInt(_0x3039e3(0x97))/0x4*(-parseInt(_0x3039e3(0xe4))/0x5)+-parseInt(_0x3039e3(0xd0))/0x6*(parseInt(_0x3039e3(0xc0))/0x7)+-parseInt(_0x3039e3(0xd7))/0x8*(parseInt(_0x3039e3(0x99))/0x9)+-parseInt(_0x3039e3(0xaf))/0xa+parseInt(_0x3039e3(0xf0))/0xb*(-parseInt(_0x3039e3(0x9c))/0xc);if(_0x4a387a===_0x681cdb)break;else _0x399c51['push'](_0x399c51['shift']());}catch(_0xd3e425){_0x399c51['push'](_0x399c51['shift']());}}}(a8_0x5344,0x5c568));var __importDefault=this&&this[a8_0x384cee(0xb0)]||function(_0x3778ee){const _0x4e3e7b=a8_0x384cee;return _0x3778ee&&_0x3778ee[_0x4e3e7b(0xd5)]?_0x3778ee:{'default':_0x3778ee};};Object[a8_0x384cee(0x96)](exports,'__esModule',{'value':!![]}),exports[a8_0x384cee(0x94)]=exports[a8_0x384cee(0xb7)]=void 0x0;const database_1=__importDefault(require('../config/database')),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async[a8_0x384cee(0xdc)](_0x7b4789,_0x3c68fa){const _0x458fc1=a8_0x384cee;try{const {paymentId:_0x10c991,fileData:_0x1e190d,fileType:_0x3cf442,fileName:_0x38bbf7}=_0x7b4789[_0x458fc1(0xd8)],_0x36067c=_0x7b4789['ip']||_0x7b4789[_0x458fc1(0xe5)]?.[_0x458fc1(0xbc)]||_0x458fc1(0xe9);console['log']('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x10c991),console[_0x458fc1(0xdb)]('üìÅ\x20File\x20type:\x20'+_0x3cf442+',\x20size:\x20'+(_0x1e190d?Math['round'](_0x1e190d[_0x458fc1(0xda)]*0.75/0x400):0x0)+'KB'),console['log'](_0x458fc1(0xc5)+_0x36067c);if(!_0x10c991){_0x3c68fa['status'](0x190)[_0x458fc1(0x8c)]({'success':![],'error':'Payment\x20ID\x20is\x20required'});return;}if(!_0x1e190d){_0x3c68fa[_0x458fc1(0xcd)](0x190)['json']({'success':![],'error':_0x458fc1(0xe6)});return;}if(!_0x3cf442){_0x3c68fa[_0x458fc1(0xcd)](0x190)[_0x458fc1(0x8c)]({'success':![],'error':_0x458fc1(0x88)});return;}const _0x9e1b72=[_0x458fc1(0xf2),_0x458fc1(0xa2),_0x458fc1(0xa7),'heic',_0x458fc1(0x8a)],_0x3265f5=_0x3cf442[_0x458fc1(0xeb)]()[_0x458fc1(0xb4)]('.','');if(!_0x9e1b72[_0x458fc1(0xa0)](_0x3265f5)){_0x3c68fa['status'](0x190)[_0x458fc1(0x8c)]({'success':![],'error':_0x458fc1(0xdf)+_0x3cf442+'.\x20Supported:\x20'+_0x9e1b72[_0x458fc1(0xb3)](',\x20')});return;}const _0x44f3d1=0xa*0x400*0x400;if(_0x1e190d[_0x458fc1(0xda)]>_0x44f3d1){_0x3c68fa[_0x458fc1(0xcd)](0x190)[_0x458fc1(0x8c)]({'success':![],'error':_0x458fc1(0xec)});return;}const _0x14c6da=await database_1[_0x458fc1(0xde)][_0x458fc1(0x8d)][_0x458fc1(0xc3)]({'where':{'id':_0x10c991},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x14c6da){console[_0x458fc1(0xdb)](_0x458fc1(0xcc)+_0x10c991),_0x3c68fa[_0x458fc1(0xcd)](0x194)[_0x458fc1(0x8c)]({'success':![],'error':_0x458fc1(0xe7)});return;}if(_0x14c6da[_0x458fc1(0x89)]!==_0x458fc1(0xa1)&&_0x14c6da['gateway']!==_0x458fc1(0x8e)){console[_0x458fc1(0xdb)](_0x458fc1(0xd1)+_0x14c6da[_0x458fc1(0x89)]),_0x3c68fa[_0x458fc1(0xcd)](0x190)[_0x458fc1(0x8c)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x14c6da[_0x458fc1(0x89)]});return;}let _0x201ae5=_0x1e190d;_0x1e190d[_0x458fc1(0xa0)](',')&&(_0x201ae5=_0x1e190d[_0x458fc1(0xc2)](',')[0x1]);try{Buffer[_0x458fc1(0xe8)](_0x201ae5,_0x458fc1(0xee));}catch(_0x20b0ce){_0x3c68fa[_0x458fc1(0xcd)](0x190)[_0x458fc1(0x8c)]({'success':![],'error':_0x458fc1(0xd4)});return;}const _0x15579c=await database_1['default'][_0x458fc1(0x8d)][_0x458fc1(0xd9)]({'where':{'id':_0x10c991},'data':{'status':_0x458fc1(0x93),'updatedAt':new Date()}});console[_0x458fc1(0xdb)](_0x458fc1(0xa6)),console[_0x458fc1(0xdb)](_0x458fc1(0xab)+_0x10c991),console[_0x458fc1(0xdb)](_0x458fc1(0x9d)+_0x14c6da['gateway'][_0x458fc1(0xad)]()),console[_0x458fc1(0xdb)](_0x458fc1(0xc6)+_0x3265f5),console[_0x458fc1(0xdb)](_0x458fc1(0xbd)+Math[_0x458fc1(0xf3)](_0x201ae5[_0x458fc1(0xda)]*0.75/0x400)+'KB'),console['log'](_0x458fc1(0xd2));try{const _0x530ee9=_0x14c6da[_0x458fc1(0x89)][_0x458fc1(0xad)](),_0x4a8e98=_0x14c6da[_0x458fc1(0xcb)][_0x458fc1(0xef)]||_0x14c6da['shop'][_0x458fc1(0xbb)],_0x5b2753=Math['round'](_0x201ae5['length']*0.75/0x400),_0x39226b='üîÑ\x20'+_0x530ee9+'\x20Payment\x20Proof\x20Received\x0a\x0a'+('üí≥\x20Payment\x20ID:\x20'+_0x10c991+'\x0a')+(_0x458fc1(0xbe)+_0x14c6da[_0x458fc1(0xca)]+'\x20'+_0x14c6da['currency']+'\x0a')+('üìÅ\x20File:\x20'+_0x3265f5[_0x458fc1(0xad)]()+'\x20('+_0x5b2753+_0x458fc1(0xa3))+_0x458fc1(0xc7)+('üåê\x20Customer\x20IP:\x20'+_0x36067c+'\x0a\x0a')+_0x458fc1(0xae);await telegramBotService_1[_0x458fc1(0x87)][_0x458fc1(0xb6)](_0x14c6da['shopId'],_0x39226b,{'parse_mode':'Markdown'});const _0x547bf0=Buffer['from'](_0x201ae5,_0x458fc1(0xee)),_0x17a905=_0x458fc1(0xba)+_0x10c991+'.'+_0x3265f5;await telegramBotService_1['telegramBotService'][_0x458fc1(0xf4)](_0x14c6da[_0x458fc1(0xb5)],_0x547bf0,_0x17a905,_0x458fc1(0x9e)+_0x10c991),console[_0x458fc1(0xdb)](_0x458fc1(0xc4));const _0x15145e=_0x458fc1(0xe2),_0x2ebaa0='üîÑ\x20'+_0x530ee9+_0x458fc1(0xe0)+(_0x458fc1(0xdd)+_0x10c991+'\x0a')+(_0x458fc1(0xe3)+_0x4a8e98+'\x0a')+(_0x458fc1(0xbe)+_0x14c6da['amount']+'\x20'+_0x14c6da['currency']+'\x0a')+(_0x458fc1(0xf1)+_0x3265f5[_0x458fc1(0xad)]()+'\x20('+_0x5b2753+_0x458fc1(0xa3))+_0x458fc1(0xc7)+(_0x458fc1(0xea)+_0x36067c+'\x0a\x0a')+_0x458fc1(0xaa);await telegramBotService_1[_0x458fc1(0x87)][_0x458fc1(0x8b)](parseInt(_0x15145e),_0x2ebaa0),await telegramBotService_1[_0x458fc1(0x87)]['sendDirectFile'](parseInt(_0x15145e),_0x547bf0,_0x17a905,_0x458fc1(0xc9)+_0x10c991),console[_0x458fc1(0xdb)](_0x458fc1(0xe1));}catch(_0x47046c){console[_0x458fc1(0xa9)](_0x458fc1(0xed),_0x47046c);}_0x3c68fa[_0x458fc1(0x8c)]({'success':!![],'message':_0x458fc1(0xd6),'data':{'paymentId':_0x15579c['id'],'status':_0x15579c[_0x458fc1(0xcd)],'gateway':_0x14c6da[_0x458fc1(0x89)],'fileType':_0x3265f5,'fileSize':Math[_0x458fc1(0xf3)](_0x201ae5[_0x458fc1(0xda)]*0.75/0x400)+'KB','uploadedAt':_0x15579c[_0x458fc1(0x98)]}});}catch(_0x35dada){console[_0x458fc1(0xa9)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x35dada),_0x3c68fa[_0x458fc1(0xcd)](0x1f4)[_0x458fc1(0x8c)]({'success':![],'error':_0x458fc1(0xa8),'details':_0x35dada instanceof Error?_0x35dada['message']:_0x458fc1(0xd3)});}}async[a8_0x384cee(0x92)](_0x2a38f5,_0x4f077d){const _0x414e4d=a8_0x384cee;try{const {paymentId:_0xe7669c}=_0x2a38f5[_0x414e4d(0xcf)];console[_0x414e4d(0xdb)](_0x414e4d(0x90)+_0xe7669c);const _0x335e14=await database_1[_0x414e4d(0xde)]['payment'][_0x414e4d(0xc3)]({'where':{'id':_0xe7669c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x335e14){_0x4f077d[_0x414e4d(0xcd)](0x194)['json']({'success':![],'error':_0x414e4d(0xe7)});return;}if(_0x335e14[_0x414e4d(0x89)]!==_0x414e4d(0xa1)&&_0x335e14[_0x414e4d(0x89)]!==_0x414e4d(0x8e)){_0x4f077d[_0x414e4d(0xcd)](0x190)['json']({'success':![],'error':_0x414e4d(0x9b)+_0x335e14[_0x414e4d(0x89)]});return;}let _0x1cf479='',_0x359f49=_0x335e14[_0x414e4d(0x8f)],_0x2ff515='';if(_0x335e14[_0x414e4d(0x89)]===_0x414e4d(0xa1))_0x2ff515=_0x414e4d(0x91),_0x359f49='CAD',_0x1cf479=_0x414e4d(0xb1)+_0x335e14[_0x414e4d(0xca)]+'\x20'+_0x359f49+_0x414e4d(0xa4);else _0x335e14[_0x414e4d(0x89)]===_0x414e4d(0x8e)&&(_0x2ff515=_0x414e4d(0x95),_0x359f49='EUR',_0x1cf479='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x335e14[_0x414e4d(0xca)]+'\x20'+_0x359f49+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x2ff8c6={'success':!![],'data':{'paymentId':_0x335e14['id'],'gateway':_0x335e14[_0x414e4d(0x89)],'gatewayName':_0x335e14[_0x414e4d(0x89)][_0x414e4d(0xad)](),'transferType':_0x2ff515,'amount':_0x335e14[_0x414e4d(0xca)],'currency':_0x359f49,'status':_0x335e14[_0x414e4d(0xcd)],'instructions':_0x1cf479,'shopName':_0x335e14[_0x414e4d(0xcb)][_0x414e4d(0xef)]||_0x335e14[_0x414e4d(0xcb)][_0x414e4d(0xbb)],'hasProof':![],'proofType':null,'createdAt':_0x335e14[_0x414e4d(0xce)],'updatedAt':_0x335e14['updatedAt'],'supportedFileTypes':[_0x414e4d(0xb2),_0x414e4d(0xb8),_0x414e4d(0x9f),_0x414e4d(0x9a),_0x414e4d(0xa5)],'maxFileSize':'10MB'}};_0x4f077d[_0x414e4d(0x8c)](_0x2ff8c6);}catch(_0x586671){console['error'](_0x414e4d(0xb9),_0x586671),_0x4f077d['status'](0x1f4)[_0x414e4d(0x8c)]({'success':![],'error':_0x414e4d(0xa8),'details':_0x586671 instanceof Error?_0x586671[_0x414e4d(0xc1)]:_0x414e4d(0xd3)});}}}exports[a8_0x384cee(0xb7)]=ManualPaymentController,exports[a8_0x384cee(0x94)]=new ManualPaymentController();