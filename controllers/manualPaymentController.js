'use strict';const a8_0x2c6db5=a8_0x38d9;(function(_0x5147d4,_0x5ac85f){const _0x29ba9=a8_0x38d9,_0x239267=_0x5147d4();while(!![]){try{const _0x54ee27=parseInt(_0x29ba9(0xb6))/0x1+parseInt(_0x29ba9(0xda))/0x2*(-parseInt(_0x29ba9(0xbf))/0x3)+parseInt(_0x29ba9(0xcd))/0x4+-parseInt(_0x29ba9(0xc3))/0x5*(-parseInt(_0x29ba9(0xe7))/0x6)+-parseInt(_0x29ba9(0xfc))/0x7+parseInt(_0x29ba9(0x9e))/0x8+parseInt(_0x29ba9(0xe9))/0x9*(-parseInt(_0x29ba9(0xa0))/0xa);if(_0x54ee27===_0x5ac85f)break;else _0x239267['push'](_0x239267['shift']());}catch(_0x14a6c3){_0x239267['push'](_0x239267['shift']());}}}(a8_0x5053,0x1fd98));var __importDefault=this&&this[a8_0x2c6db5(0xa7)]||function(_0xa99a1b){const _0x1913d9=a8_0x2c6db5;return _0xa99a1b&&_0xa99a1b[_0x1913d9(0xf6)]?_0xa99a1b:{'default':_0xa99a1b};};Object[a8_0x2c6db5(0x9b)](exports,a8_0x2c6db5(0xf6),{'value':!![]}),exports[a8_0x2c6db5(0xfd)]=exports[a8_0x2c6db5(0xe2)]=void 0x0;const database_1=__importDefault(require(a8_0x2c6db5(0x9d))),telegramBotService_1=require(a8_0x2c6db5(0xce));function a8_0x38d9(_0x24bfc8,_0x322451){const _0x5053d8=a8_0x5053();return a8_0x38d9=function(_0x38d9ec,_0x4b4463){_0x38d9ec=_0x38d9ec-0x95;let _0x302143=_0x5053d8[_0x38d9ec];return _0x302143;},a8_0x38d9(_0x24bfc8,_0x322451);}class ManualPaymentController{async[a8_0x2c6db5(0x100)](_0x332af2,_0x2abc0b){const _0x238a86=a8_0x2c6db5;try{const {paymentId:_0x383978,fileData:_0x5ed3c3,fileType:_0x3c1f0a,fileName:_0x9d0213}=_0x332af2[_0x238a86(0xb9)],_0x29277b=_0x332af2['ip']||_0x332af2[_0x238a86(0xd0)]?.[_0x238a86(0xf3)]||_0x238a86(0x99);console[_0x238a86(0xba)](_0x238a86(0xb7)+_0x383978),console[_0x238a86(0xba)](_0x238a86(0xb0)+_0x3c1f0a+_0x238a86(0xca)+(_0x5ed3c3?Math[_0x238a86(0xa1)](_0x5ed3c3[_0x238a86(0xcb)]*0.75/0x400):0x0)+'KB'),console[_0x238a86(0xba)]('üåê\x20Client\x20IP:\x20'+_0x29277b);if(!_0x383978){_0x2abc0b[_0x238a86(0xc5)](0x190)[_0x238a86(0xd3)]({'success':![],'error':_0x238a86(0xc4)});return;}if(!_0x5ed3c3){_0x2abc0b[_0x238a86(0xc5)](0x190)[_0x238a86(0xd3)]({'success':![],'error':_0x238a86(0xa2)});return;}if(!_0x3c1f0a){_0x2abc0b[_0x238a86(0xc5)](0x190)['json']({'success':![],'error':_0x238a86(0xfb)});return;}const _0x29be3d=[_0x238a86(0xea),_0x238a86(0xd9),_0x238a86(0xbb),'heic',_0x238a86(0xd6)],_0xb243da=_0x3c1f0a[_0x238a86(0xab)]()[_0x238a86(0xe0)]('.','');if(!_0x29be3d[_0x238a86(0xee)](_0xb243da)){_0x2abc0b['status'](0x190)['json']({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x3c1f0a+_0x238a86(0x9c)+_0x29be3d[_0x238a86(0x105)](',\x20')});return;}const _0x512680=0xa*0x400*0x400;if(_0x5ed3c3[_0x238a86(0xcb)]>_0x512680){_0x2abc0b['status'](0x190)['json']({'success':![],'error':_0x238a86(0xb3)});return;}const _0x57094b=await database_1[_0x238a86(0xbc)][_0x238a86(0xfe)][_0x238a86(0xde)]({'where':{'id':_0x383978},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x57094b){console['log'](_0x238a86(0xc1)+_0x383978),_0x2abc0b[_0x238a86(0xc5)](0x194)['json']({'success':![],'error':_0x238a86(0xaa)});return;}if(_0x57094b['gateway']!==_0x238a86(0xb8)&&_0x57094b[_0x238a86(0xbe)]!==_0x238a86(0x104)){console[_0x238a86(0xba)](_0x238a86(0xf1)+_0x57094b[_0x238a86(0xbe)]),_0x2abc0b[_0x238a86(0xc5)](0x190)['json']({'success':![],'error':_0x238a86(0xc2)+_0x57094b[_0x238a86(0xbe)]});return;}let _0x149b55=_0x5ed3c3;_0x5ed3c3[_0x238a86(0xee)](',')&&(_0x149b55=_0x5ed3c3['split'](',')[0x1]);try{Buffer[_0x238a86(0x98)](_0x149b55,_0x238a86(0x101));}catch(_0x4bc1c1){_0x2abc0b[_0x238a86(0xc5)](0x190)[_0x238a86(0xd3)]({'success':![],'error':_0x238a86(0xa9)});return;}const _0x2e07fd=await database_1['default'][_0x238a86(0xfe)][_0x238a86(0xdf)]({'where':{'id':_0x383978},'data':{'status':'PROCESSING','updatedAt':new Date()}});console[_0x238a86(0xba)](_0x238a86(0xdd)),console[_0x238a86(0xba)](_0x238a86(0xf7)+_0x383978),console['log'](_0x238a86(0xef)+_0x57094b['gateway'][_0x238a86(0xeb)]()),console[_0x238a86(0xba)]('\x20\x20\x20-\x20File\x20type:\x20'+_0xb243da),console['log'](_0x238a86(0xa4)+Math[_0x238a86(0xa1)](_0x149b55[_0x238a86(0xcb)]*0.75/0x400)+'KB'),console[_0x238a86(0xba)](_0x238a86(0x9a));try{const _0x32750c=_0x57094b[_0x238a86(0xbe)][_0x238a86(0xeb)](),_0x10ec08=_0x57094b['shop']['name']||_0x57094b[_0x238a86(0x9f)]['username'],_0x52c37a=Math[_0x238a86(0xa1)](_0x149b55[_0x238a86(0xcb)]*0.75/0x400),_0x53937a=_0x238a86(0x95)+_0x32750c+_0x238a86(0xad)+(_0x238a86(0xe6)+_0x383978+'\x0a')+(_0x238a86(0xb4)+_0x57094b[_0x238a86(0xc7)]+'\x20'+_0x57094b['currency']+'\x0a')+(_0x238a86(0x103)+_0xb243da[_0x238a86(0xeb)]()+'\x20('+_0x52c37a+_0x238a86(0xa5))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x238a86(0xdb)+_0x29277b+'\x0a\x0a')+_0x238a86(0xc6);await telegramBotService_1['telegramBotService'][_0x238a86(0xae)](_0x57094b['shopId'],_0x53937a,{'parse_mode':'Markdown'});const _0x46455d=Buffer['from'](_0x149b55,_0x238a86(0x101)),_0x299c99=_0x238a86(0xd8)+_0x383978+'.'+_0xb243da;await telegramBotService_1[_0x238a86(0x102)][_0x238a86(0xec)](_0x57094b[_0x238a86(0xcc)],_0x46455d,_0x299c99,_0x238a86(0xb5)+_0x383978),console[_0x238a86(0xba)](_0x238a86(0xd4));const _0x5ee7d8=_0x238a86(0xaf),_0x40fccc='üîÑ\x20'+_0x32750c+_0x238a86(0xe3)+('üí≥\x20Payment\x20ID:\x20'+_0x383978+'\x0a')+(_0x238a86(0xcf)+_0x10ec08+'\x0a')+(_0x238a86(0xb4)+_0x57094b['amount']+'\x20'+_0x57094b['currency']+'\x0a')+(_0x238a86(0x103)+_0xb243da[_0x238a86(0xeb)]()+'\x20('+_0x52c37a+'KB)\x0a')+_0x238a86(0x97)+('üåê\x20Customer\x20IP:\x20'+_0x29277b+'\x0a\x0a')+_0x238a86(0xc0);await telegramBotService_1['telegramBotService']['sendDirectMessage'](parseInt(_0x5ee7d8),_0x40fccc),await telegramBotService_1['telegramBotService'][_0x238a86(0xd5)](parseInt(_0x5ee7d8),_0x46455d,_0x299c99,_0x238a86(0xf8)+_0x383978),console[_0x238a86(0xba)](_0x238a86(0xe1));}catch(_0x353ffb){console[_0x238a86(0xd7)](_0x238a86(0xa3),_0x353ffb);}_0x2abc0b[_0x238a86(0xd3)]({'success':!![],'message':_0x238a86(0xe5),'data':{'paymentId':_0x2e07fd['id'],'status':_0x2e07fd[_0x238a86(0xc5)],'gateway':_0x57094b[_0x238a86(0xbe)],'fileType':_0xb243da,'fileSize':Math[_0x238a86(0xa1)](_0x149b55['length']*0.75/0x400)+'KB','uploadedAt':_0x2e07fd['updatedAt']}});}catch(_0x4158d1){console['error'](_0x238a86(0xb1),_0x4158d1),_0x2abc0b[_0x238a86(0xc5)](0x1f4)['json']({'success':![],'error':_0x238a86(0xf9),'details':_0x4158d1 instanceof Error?_0x4158d1['message']:_0x238a86(0xfa)});}}async['getManualPaymentInfo'](_0x21fda7,_0x2db019){const _0x3f9e29=a8_0x2c6db5;try{const {paymentId:_0x1e11b4}=_0x21fda7[_0x3f9e29(0xbd)];console['log'](_0x3f9e29(0xc8)+_0x1e11b4);const _0x4d3cb5=await database_1[_0x3f9e29(0xbc)][_0x3f9e29(0xfe)]['findUnique']({'where':{'id':_0x1e11b4},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4d3cb5){_0x2db019[_0x3f9e29(0xc5)](0x194)[_0x3f9e29(0xd3)]({'success':![],'error':_0x3f9e29(0xaa)});return;}if(_0x4d3cb5['gateway']!==_0x3f9e29(0xb8)&&_0x4d3cb5[_0x3f9e29(0xbe)]!==_0x3f9e29(0x104)){_0x2db019[_0x3f9e29(0xc5)](0x190)[_0x3f9e29(0xd3)]({'success':![],'error':_0x3f9e29(0xa8)+_0x4d3cb5[_0x3f9e29(0xbe)]});return;}let _0x397b53='',_0xc10ac9=_0x4d3cb5['currency'],_0x5d1cca='';if(_0x4d3cb5[_0x3f9e29(0xbe)]===_0x3f9e29(0xb8))_0x5d1cca=_0x3f9e29(0x96),_0xc10ac9=_0x3f9e29(0xa6),_0x397b53='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x4d3cb5[_0x3f9e29(0xc7)]+'\x20'+_0xc10ac9+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.';else _0x4d3cb5[_0x3f9e29(0xbe)]===_0x3f9e29(0x104)&&(_0x5d1cca='SEPA\x20Bank\x20Transfer',_0xc10ac9=_0x3f9e29(0xf5),_0x397b53=_0x3f9e29(0xac)+_0x4d3cb5[_0x3f9e29(0xc7)]+'\x20'+_0xc10ac9+_0x3f9e29(0xf2));const _0x492bbf={'success':!![],'data':{'paymentId':_0x4d3cb5['id'],'gateway':_0x4d3cb5['gateway'],'gatewayName':_0x4d3cb5[_0x3f9e29(0xbe)][_0x3f9e29(0xeb)](),'transferType':_0x5d1cca,'amount':_0x4d3cb5[_0x3f9e29(0xc7)],'currency':_0xc10ac9,'status':_0x4d3cb5[_0x3f9e29(0xc5)],'instructions':_0x397b53,'shopName':_0x4d3cb5['shop'][_0x3f9e29(0xd1)]||_0x4d3cb5['shop'][_0x3f9e29(0xf0)],'hasProof':![],'proofType':null,'createdAt':_0x4d3cb5[_0x3f9e29(0xf4)],'updatedAt':_0x4d3cb5[_0x3f9e29(0xd2)],'supportedFileTypes':[_0x3f9e29(0xff),_0x3f9e29(0xb2),_0x3f9e29(0xe4),'HEIC',_0x3f9e29(0xed)],'maxFileSize':_0x3f9e29(0xe8)}};_0x2db019[_0x3f9e29(0xd3)](_0x492bbf);}catch(_0x26f699){console[_0x3f9e29(0xd7)](_0x3f9e29(0xdc),_0x26f699),_0x2db019[_0x3f9e29(0xc5)](0x1f4)[_0x3f9e29(0xd3)]({'success':![],'error':_0x3f9e29(0xf9),'details':_0x26f699 instanceof Error?_0x26f699[_0x3f9e29(0xc9)]:'Unknown\x20error'});}}}exports[a8_0x2c6db5(0xe2)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();function a8_0x5053(){const _0x1eaaa7=['interac','body','log','jpeg','default','params','gateway','24FSUWlb','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','‚ùå\x20Payment\x20not\x20found:\x20','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','238195PFgCYF','Payment\x20ID\x20is\x20required','status','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','amount','üìã\x20Get\x20manual\x20payment\x20info:\x20','message',',\x20size:\x20','length','shopId','756720MjVqpR','../services/telegramBotService','üè™\x20Shop:\x20','connection','name','updatedAt','json','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','sendDirectFile','pdf','error','payment_proof_','jpg','57082NGGyjN','üåê\x20Customer\x20IP:\x20','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','findUnique','update','replace','üì±\x20Admin\x20notification\x20and\x20file\x20sent','ManualPaymentController','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','JPEG','Payment\x20proof\x20uploaded\x20successfully','üí≥\x20Payment\x20ID:\x20','30poZpmz','10MB','279IKmsjd','png','toUpperCase','sendShopFile','PDF','includes','\x20\x20\x20-\x20Gateway:\x20','username','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','remoteAddress','createdAt','EUR','__esModule','\x20\x20\x20-\x20Payment\x20ID:\x20','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','Internal\x20server\x20error','Unknown\x20error','File\x20type\x20is\x20required','297430tYJxfo','manualPaymentController','payment','PNG','uploadPaymentProof','base64','telegramBotService','üìÅ\x20File:\x20','sepa','join','üîÑ\x20','Interac\x20e-Transfer','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','from','unknown','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','defineProperty','.\x20Supported:\x20','../config/database','1343184FTyEak','shop','112830AOBHME','round','File\x20data\x20is\x20required','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','\x20\x20\x20-\x20File\x20size:\x20','KB)\x0a','CAD','__importDefault','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','Invalid\x20base64\x20file\x20data','Payment\x20not\x20found','toLowerCase','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','\x20Payment\x20Proof\x20Received\x0a\x0a','sendShopNotification','7867339505','üìÅ\x20File\x20type:\x20','‚ùå\x20Upload\x20payment\x20proof\x20error:','JPG','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','üí∞\x20Amount:\x20','Payment\x20proof\x20for\x20','155774qLwdXS','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'];a8_0x5053=function(){return _0x1eaaa7;};return a8_0x5053();}