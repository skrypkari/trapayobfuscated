'use strict';const a8_0x2ee561=a8_0x3893;(function(_0x19bcc5,_0x3a16d8){const _0x465832=a8_0x3893,_0x3d3d42=_0x19bcc5();while(!![]){try{const _0x4d2330=parseInt(_0x465832(0x1ff))/0x1+-parseInt(_0x465832(0x1f8))/0x2*(parseInt(_0x465832(0x1f6))/0x3)+-parseInt(_0x465832(0x1b9))/0x4+parseInt(_0x465832(0x1fc))/0x5*(-parseInt(_0x465832(0x1b1))/0x6)+parseInt(_0x465832(0x1c4))/0x7+parseInt(_0x465832(0x1df))/0x8*(parseInt(_0x465832(0x1ca))/0x9)+parseInt(_0x465832(0x1e8))/0xa*(-parseInt(_0x465832(0x1cd))/0xb);if(_0x4d2330===_0x3a16d8)break;else _0x3d3d42['push'](_0x3d3d42['shift']());}catch(_0x493635){_0x3d3d42['push'](_0x3d3d42['shift']());}}}(a8_0x5958,0xbbdff));var __importDefault=this&&this[a8_0x2ee561(0x1a8)]||function(_0x3a61f6){const _0x4ffc4f=a8_0x2ee561;return _0x3a61f6&&_0x3a61f6[_0x4ffc4f(0x19b)]?_0x3a61f6:{'default':_0x3a61f6};};Object[a8_0x2ee561(0x1c1)](exports,a8_0x2ee561(0x19b),{'value':!![]}),exports[a8_0x2ee561(0x199)]=exports['ManualPaymentController']=void 0x0;function a8_0x3893(_0x22f203,_0x485fef){const _0x595894=a8_0x5958();return a8_0x3893=function(_0x3893ae,_0x398157){_0x3893ae=_0x3893ae-0x194;let _0x5150d3=_0x595894[_0x3893ae];return _0x5150d3;},a8_0x3893(_0x22f203,_0x485fef);}const database_1=__importDefault(require(a8_0x2ee561(0x19d))),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async['uploadPaymentProof'](_0x3b1df7,_0x433a38){const _0x287ad3=a8_0x2ee561;try{const {paymentId:_0x10718e,fileData:_0x3a8a67,fileType:_0x12da6e,fileName:_0x41dee8}=_0x3b1df7[_0x287ad3(0x1ad)],_0x52b20f=_0x3b1df7['ip']||_0x3b1df7[_0x287ad3(0x1c8)]?.[_0x287ad3(0x1a1)]||_0x287ad3(0x200);console[_0x287ad3(0x1ea)](_0x287ad3(0x1b7)+_0x10718e),console[_0x287ad3(0x1ea)](_0x287ad3(0x19f)+_0x12da6e+',\x20size:\x20'+(_0x3a8a67?Math[_0x287ad3(0x1fa)](_0x3a8a67['length']*0.75/0x400):0x0)+'KB'),console[_0x287ad3(0x1ea)](_0x287ad3(0x1e7)+_0x52b20f);if(!_0x10718e){_0x433a38[_0x287ad3(0x1f2)](0x190)[_0x287ad3(0x1d7)]({'success':![],'error':_0x287ad3(0x1da)});return;}if(!_0x3a8a67){_0x433a38[_0x287ad3(0x1f2)](0x190)[_0x287ad3(0x1d7)]({'success':![],'error':_0x287ad3(0x1c7)});return;}if(!_0x12da6e){_0x433a38['status'](0x190)[_0x287ad3(0x1d7)]({'success':![],'error':_0x287ad3(0x1cc)});return;}const _0x307e4d=[_0x287ad3(0x1ae),_0x287ad3(0x1fe),'jpeg','heic',_0x287ad3(0x195)],_0x431626=_0x12da6e[_0x287ad3(0x1b2)]()[_0x287ad3(0x197)]('.','');if(!_0x307e4d['includes'](_0x431626)){_0x433a38[_0x287ad3(0x1f2)](0x190)[_0x287ad3(0x1d7)]({'success':![],'error':_0x287ad3(0x1e0)+_0x12da6e+_0x287ad3(0x1cb)+_0x307e4d[_0x287ad3(0x1d8)](',\x20')});return;}const _0x5a4227=0xa*0x400*0x400;if(_0x3a8a67[_0x287ad3(0x1f5)]>_0x5a4227){_0x433a38[_0x287ad3(0x1f2)](0x190)[_0x287ad3(0x1d7)]({'success':![],'error':_0x287ad3(0x19c)});return;}const _0x228432=await database_1[_0x287ad3(0x1e5)][_0x287ad3(0x1f3)][_0x287ad3(0x1a9)]({'where':{'id':_0x10718e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x228432){console[_0x287ad3(0x1ea)](_0x287ad3(0x1dc)+_0x10718e),_0x433a38['status'](0x194)['json']({'success':![],'error':_0x287ad3(0x1a7)});return;}if(_0x228432[_0x287ad3(0x1d1)]!=='interac'&&_0x228432['gateway']!==_0x287ad3(0x1d6)){console[_0x287ad3(0x1ea)](_0x287ad3(0x1a5)+_0x228432['gateway']),_0x433a38['status'](0x190)[_0x287ad3(0x1d7)]({'success':![],'error':_0x287ad3(0x1ce)+_0x228432[_0x287ad3(0x1d1)]});return;}let _0x4267d0=_0x3a8a67;_0x3a8a67[_0x287ad3(0x1aa)](',')&&(_0x4267d0=_0x3a8a67['split'](',')[0x1]);try{Buffer[_0x287ad3(0x194)](_0x4267d0,_0x287ad3(0x1a2));}catch(_0x4f3f0b){_0x433a38[_0x287ad3(0x1f2)](0x190)['json']({'success':![],'error':_0x287ad3(0x1d4)});return;}const _0x10d4b0=await database_1[_0x287ad3(0x1e5)][_0x287ad3(0x1f3)]['update']({'where':{'id':_0x10718e},'data':{'status':_0x287ad3(0x1b3),'updatedAt':new Date()}});console['log']('✅\x20Payment\x20proof\x20uploaded\x20successfully:'),console[_0x287ad3(0x1ea)](_0x287ad3(0x1c5)+_0x10718e),console[_0x287ad3(0x1ea)](_0x287ad3(0x1a3)+_0x228432[_0x287ad3(0x1d1)][_0x287ad3(0x1b0)]()),console[_0x287ad3(0x1ea)](_0x287ad3(0x1ec)+_0x431626),console[_0x287ad3(0x1ea)]('\x20\x20\x20-\x20File\x20size:\x20'+Math[_0x287ad3(0x1fa)](_0x4267d0[_0x287ad3(0x1f5)]*0.75/0x400)+'KB'),console[_0x287ad3(0x1ea)](_0x287ad3(0x1fb));try{const _0xe43537=_0x228432[_0x287ad3(0x1d1)][_0x287ad3(0x1b0)](),_0x2a12d4=_0x228432[_0x287ad3(0x1f1)][_0x287ad3(0x1ee)]||_0x228432[_0x287ad3(0x1f1)]['username'],_0x50f3d8=Math[_0x287ad3(0x1fa)](_0x4267d0['length']*0.75/0x400),_0x1d6cc5=_0x287ad3(0x1d3)+_0xe43537+_0x287ad3(0x1bc)+(_0x287ad3(0x1be)+_0x10718e+'\x0a')+(_0x287ad3(0x1a0)+_0x228432[_0x287ad3(0x1ac)]+'\x20'+_0x228432[_0x287ad3(0x1ab)]+'\x0a')+(_0x287ad3(0x1b4)+_0x431626[_0x287ad3(0x1b0)]()+'\x20('+_0x50f3d8+_0x287ad3(0x1e2))+_0x287ad3(0x1bd)+('🌐\x20Customer\x20IP:\x20'+_0x52b20f+'\x0a\x0a')+_0x287ad3(0x1c9);await telegramBotService_1['telegramBotService'][_0x287ad3(0x1e3)](_0x228432[_0x287ad3(0x1bf)],_0x1d6cc5,{'parse_mode':'Markdown'});const _0x440626=Buffer[_0x287ad3(0x194)](_0x4267d0,_0x287ad3(0x1a2)),_0xb2471a=_0x287ad3(0x1a4)+_0x10718e+'.'+_0x431626;await telegramBotService_1['telegramBotService'][_0x287ad3(0x1a6)](_0x228432['shopId'],_0x440626,_0xb2471a,_0x287ad3(0x1e4)+_0x10718e),console[_0x287ad3(0x1ea)](_0x287ad3(0x1de));const _0x260ea3=_0x287ad3(0x1d5),_0x290ee1=_0x287ad3(0x1d3)+_0xe43537+_0x287ad3(0x1eb)+('💳\x20Payment\x20ID:\x20'+_0x10718e+'\x0a')+(_0x287ad3(0x1d2)+_0x2a12d4+'\x0a')+(_0x287ad3(0x1a0)+_0x228432[_0x287ad3(0x1ac)]+'\x20'+_0x228432['currency']+'\x0a')+('📁\x20File:\x20'+_0x431626[_0x287ad3(0x1b0)]()+'\x20('+_0x50f3d8+_0x287ad3(0x1e2))+_0x287ad3(0x1bd)+(_0x287ad3(0x1b8)+_0x52b20f+'\x0a\x0a')+'⚠️\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.';await telegramBotService_1['telegramBotService'][_0x287ad3(0x1ef)](parseInt(_0x260ea3),_0x290ee1),await telegramBotService_1[_0x287ad3(0x19e)][_0x287ad3(0x1d9)](parseInt(_0x260ea3),_0x440626,_0xb2471a,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x10718e),console['log'](_0x287ad3(0x198));}catch(_0x225861){console[_0x287ad3(0x19a)](_0x287ad3(0x1af),_0x225861);}_0x433a38[_0x287ad3(0x1d7)]({'success':!![],'message':_0x287ad3(0x1f4),'data':{'paymentId':_0x10d4b0['id'],'status':_0x10d4b0[_0x287ad3(0x1f2)],'gateway':_0x228432[_0x287ad3(0x1d1)],'fileType':_0x431626,'fileSize':Math[_0x287ad3(0x1fa)](_0x4267d0[_0x287ad3(0x1f5)]*0.75/0x400)+'KB','uploadedAt':_0x10d4b0['updatedAt']}});}catch(_0x15fcf4){console[_0x287ad3(0x19a)](_0x287ad3(0x1ed),_0x15fcf4),_0x433a38[_0x287ad3(0x1f2)](0x1f4)[_0x287ad3(0x1d7)]({'success':![],'error':'Internal\x20server\x20error','details':_0x15fcf4 instanceof Error?_0x15fcf4[_0x287ad3(0x1e1)]:_0x287ad3(0x1dd)});}}async[a8_0x2ee561(0x1ba)](_0x5acdf3,_0x11e3cc){const _0x44711f=a8_0x2ee561;try{const {paymentId:_0xb461a6}=_0x5acdf3[_0x44711f(0x1db)];console[_0x44711f(0x1ea)](_0x44711f(0x1e6)+_0xb461a6);const _0x29ca49=await database_1[_0x44711f(0x1e5)][_0x44711f(0x1f3)][_0x44711f(0x1a9)]({'where':{'id':_0xb461a6},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x29ca49){_0x11e3cc[_0x44711f(0x1f2)](0x194)[_0x44711f(0x1d7)]({'success':![],'error':_0x44711f(0x1a7)});return;}if(_0x29ca49[_0x44711f(0x1d1)]!==_0x44711f(0x1b6)&&_0x29ca49[_0x44711f(0x1d1)]!==_0x44711f(0x1d6)){_0x11e3cc[_0x44711f(0x1f2)](0x190)[_0x44711f(0x1d7)]({'success':![],'error':_0x44711f(0x1c3)+_0x29ca49[_0x44711f(0x1d1)]});return;}let _0x344df9='',_0x119f4d=_0x29ca49[_0x44711f(0x1ab)],_0x547e61='';if(_0x29ca49[_0x44711f(0x1d1)]==='interac')_0x547e61=_0x44711f(0x1d0),_0x119f4d=_0x44711f(0x1fd),_0x344df9=_0x44711f(0x1cf)+_0x29ca49[_0x44711f(0x1ac)]+'\x20'+_0x119f4d+_0x44711f(0x1f7);else _0x29ca49[_0x44711f(0x1d1)]===_0x44711f(0x1d6)&&(_0x547e61=_0x44711f(0x1bb),_0x119f4d='EUR',_0x344df9='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x29ca49['amount']+'\x20'+_0x119f4d+_0x44711f(0x1f7));const _0x15083f={'success':!![],'data':{'paymentId':_0x29ca49['id'],'gateway':_0x29ca49[_0x44711f(0x1d1)],'gatewayName':_0x29ca49[_0x44711f(0x1d1)]['toUpperCase'](),'transferType':_0x547e61,'amount':_0x29ca49['amount'],'currency':_0x119f4d,'status':_0x29ca49[_0x44711f(0x1f2)],'instructions':_0x344df9,'shopName':_0x29ca49['shop'][_0x44711f(0x1ee)]||_0x29ca49[_0x44711f(0x1f1)]['username'],'hasProof':![],'proofType':null,'createdAt':_0x29ca49['createdAt'],'updatedAt':_0x29ca49[_0x44711f(0x1c0)],'supportedFileTypes':[_0x44711f(0x201),_0x44711f(0x1c6),_0x44711f(0x1f9),'HEIC',_0x44711f(0x1b5)],'maxFileSize':_0x44711f(0x196)}};_0x11e3cc[_0x44711f(0x1d7)](_0x15083f);}catch(_0x448db1){console[_0x44711f(0x19a)](_0x44711f(0x1e9),_0x448db1),_0x11e3cc[_0x44711f(0x1f2)](0x1f4)[_0x44711f(0x1d7)]({'success':![],'error':_0x44711f(0x1f0),'details':_0x448db1 instanceof Error?_0x448db1[_0x44711f(0x1e1)]:_0x44711f(0x1dd)});}}}exports[a8_0x2ee561(0x1c2)]=ManualPaymentController,exports[a8_0x2ee561(0x199)]=new ManualPaymentController();function a8_0x5958(){const _0x5d735d=['Unknown\x20error','📱\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','8EMGCPC','Unsupported\x20file\x20type:\x20','message','KB)\x0a','sendShopNotification','Payment\x20proof\x20for\x20','default','📋\x20Get\x20manual\x20payment\x20info:\x20','🌐\x20Client\x20IP:\x20','110muoBRW','❌\x20Get\x20manual\x20payment\x20info\x20error:','log','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','\x20\x20\x20-\x20File\x20type:\x20','❌\x20Upload\x20payment\x20proof\x20error:','name','sendDirectMessage','Internal\x20server\x20error','shop','status','payment','Payment\x20proof\x20uploaded\x20successfully','length','3ZmyknA','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','716206Tuwtcu','JPEG','round','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','300VNoSdK','CAD','jpg','899136mEnjaR','unknown','PNG','from','pdf','10MB','replace','📱\x20Admin\x20notification\x20and\x20file\x20sent','manualPaymentController','error','__esModule','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','../config/database','telegramBotService','📁\x20File\x20type:\x20','💰\x20Amount:\x20','remoteAddress','base64','\x20\x20\x20-\x20Gateway:\x20','payment_proof_','❌\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','sendShopFile','Payment\x20not\x20found','__importDefault','findUnique','includes','currency','amount','body','png','❌\x20Failed\x20to\x20send\x20Telegram\x20notifications:','toUpperCase','88698RxUORM','toLowerCase','PROCESSING','📁\x20File:\x20','PDF','interac','📤\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','🌐\x20Customer\x20IP:\x20','789908bYOVrC','getManualPaymentInfo','SEPA\x20Bank\x20Transfer','\x20Payment\x20Proof\x20Received\x0a\x0a','📊\x20Status:\x20PENDING\x20→\x20PROCESSING\x0a','💳\x20Payment\x20ID:\x20','shopId','updatedAt','defineProperty','ManualPaymentController','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','10577147fYSRzs','\x20\x20\x20-\x20Payment\x20ID:\x20','JPG','File\x20data\x20is\x20required','connection','⏳\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','1844505YBmkkJ','.\x20Supported:\x20','File\x20type\x20is\x20required','403007QxAsjC','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','Interac\x20e-Transfer','gateway','🏪\x20Shop:\x20','🔄\x20','Invalid\x20base64\x20file\x20data','7867339505','sepa','json','join','sendDirectFile','Payment\x20ID\x20is\x20required','params','❌\x20Payment\x20not\x20found:\x20'];a8_0x5958=function(){return _0x5d735d;};return a8_0x5958();}