'use strict';const a8_0x2056fd=a8_0x54a0;(function(_0x104485,_0x2761d6){const _0x8e40ce=a8_0x54a0,_0x3ab8b1=_0x104485();while(!![]){try{const _0x193fc5=parseInt(_0x8e40ce(0x15b))/0x1+parseInt(_0x8e40ce(0x1af))/0x2+-parseInt(_0x8e40ce(0x172))/0x3*(parseInt(_0x8e40ce(0x1b9))/0x4)+parseInt(_0x8e40ce(0x18f))/0x5+-parseInt(_0x8e40ce(0x169))/0x6*(-parseInt(_0x8e40ce(0x15a))/0x7)+-parseInt(_0x8e40ce(0x1a0))/0x8*(-parseInt(_0x8e40ce(0x16d))/0x9)+parseInt(_0x8e40ce(0x1a4))/0xa*(-parseInt(_0x8e40ce(0x1b7))/0xb);if(_0x193fc5===_0x2761d6)break;else _0x3ab8b1['push'](_0x3ab8b1['shift']());}catch(_0x181094){_0x3ab8b1['push'](_0x3ab8b1['shift']());}}}(a8_0x5d3b,0x74bdc));function a8_0x5d3b(){const _0x29ec46=['\x20\x20\x20-\x20Gateway:\x20','PROCESSING','HEIC','username','41241oDjPHU','🌐\x20Client\x20IP:\x20','sendShopFile','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','default','📱\x20Admin\x20notification\x20and\x20file\x20sent','remoteAddress','shopId','Unsupported\x20file\x20type:\x20','toUpperCase','defineProperty','body','✅\x20Payment\x20proof\x20uploaded\x20successfully:','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','🏪\x20Shop:\x20','amount','7867339505','length','File\x20data\x20is\x20required','../config/database','⚠️\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','telegramBotService','\x20\x20\x20-\x20File\x20type:\x20','split','name','payment','gateway','shop','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','4137600pIFXMC','Payment\x20not\x20found','currency','📊\x20Status:\x20PENDING\x20→\x20PROCESSING\x0a','sendShopNotification','💳\x20Payment\x20ID:\x20','Unknown\x20error','uploadPaymentProof','Payment\x20proof\x20uploaded\x20successfully','sendDirectMessage','heic','getManualPaymentInfo','10MB','❌\x20Upload\x20payment\x20proof\x20error:','\x20\x20\x20-\x20File\x20size:\x20','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','File\x20type\x20is\x20required','8RnXZUc','jpeg','../services/telegramBotService','PNG','6070PdGWQB',',\x20size:\x20','Markdown','📁\x20File\x20type:\x20','base64','📤\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','__importDefault','png','round','findUnique','sepa','1682424RvptYt','🌐\x20Customer\x20IP:\x20','update','💰\x20Amount:\x20','toLowerCase','❌\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','📋\x20Get\x20manual\x20payment\x20info:\x20','JPEG','36113HsMVRk','replace','236WZBGTY','📱\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','manualPaymentController','Internal\x20server\x20error','📁\x20File:\x20','JPG','payment_proof_','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','includes','Payment\x20proof\x20for\x20','status','jpg','createdAt','json','39536IfzaTZ','638297NvpyGg','ManualPaymentController','❌\x20Failed\x20to\x20send\x20Telegram\x20notifications:','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','log','Payment\x20ID\x20is\x20required','\x20Payment\x20Proof\x20Received\x0a\x0a','error','Interac\x20e-Transfer','⏳\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','CAD','message','pdf','KB)\x0a','438jjvPtH','🔄\x20','❌\x20Payment\x20not\x20found:\x20','interac','5064237nqbbCZ'];a8_0x5d3b=function(){return _0x29ec46;};return a8_0x5d3b();}var __importDefault=this&&this[a8_0x2056fd(0x1aa)]||function(_0x330bc1){return _0x330bc1&&_0x330bc1['__esModule']?_0x330bc1:{'default':_0x330bc1};};function a8_0x54a0(_0x50a740,_0x290b74){const _0x5d3b53=a8_0x5d3b();return a8_0x54a0=function(_0x54a046,_0x307889){_0x54a046=_0x54a046-0x14d;let _0xe3df07=_0x5d3b53[_0x54a046];return _0xe3df07;},a8_0x54a0(_0x50a740,_0x290b74);}Object[a8_0x2056fd(0x17c)](exports,'__esModule',{'value':!![]}),exports[a8_0x2056fd(0x14e)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a8_0x2056fd(0x185))),telegramBotService_1=require(a8_0x2056fd(0x1a2));class ManualPaymentController{async[a8_0x2056fd(0x196)](_0x32167f,_0x4aabb6){const _0x4d9882=a8_0x2056fd;try{const {paymentId:_0x4b7991,fileData:_0x30cada,fileType:_0x1a5482,fileName:_0x1fd0e1}=_0x32167f[_0x4d9882(0x17d)],_0x11ca93=_0x32167f['ip']||_0x32167f['connection']?.[_0x4d9882(0x178)]||'unknown';console[_0x4d9882(0x15f)](_0x4d9882(0x1a9)+_0x4b7991),console[_0x4d9882(0x15f)](_0x4d9882(0x1a7)+_0x1a5482+_0x4d9882(0x1a5)+(_0x30cada?Math[_0x4d9882(0x1ac)](_0x30cada[_0x4d9882(0x183)]*0.75/0x400):0x0)+'KB'),console['log'](_0x4d9882(0x173)+_0x11ca93);if(!_0x4b7991){_0x4aabb6[_0x4d9882(0x156)](0x190)[_0x4d9882(0x159)]({'success':![],'error':_0x4d9882(0x160)});return;}if(!_0x30cada){_0x4aabb6[_0x4d9882(0x156)](0x190)[_0x4d9882(0x159)]({'success':![],'error':_0x4d9882(0x184)});return;}if(!_0x1a5482){_0x4aabb6[_0x4d9882(0x156)](0x190)[_0x4d9882(0x159)]({'success':![],'error':_0x4d9882(0x19f)});return;}const _0x227330=[_0x4d9882(0x1ab),_0x4d9882(0x157),_0x4d9882(0x1a1),_0x4d9882(0x199),_0x4d9882(0x167)],_0x3ee65b=_0x1a5482[_0x4d9882(0x1b3)]()[_0x4d9882(0x1b8)]('.','');if(!_0x227330[_0x4d9882(0x154)](_0x3ee65b)){_0x4aabb6[_0x4d9882(0x156)](0x190)[_0x4d9882(0x159)]({'success':![],'error':_0x4d9882(0x17a)+_0x1a5482+'.\x20Supported:\x20'+_0x227330['join'](',\x20')});return;}const _0x1ad938=0xa*0x400*0x400;if(_0x30cada[_0x4d9882(0x183)]>_0x1ad938){_0x4aabb6[_0x4d9882(0x156)](0x190)[_0x4d9882(0x159)]({'success':![],'error':'File\x20too\x20large.\x20Maximum\x20size:\x2010MB'});return;}const _0x100488=await database_1[_0x4d9882(0x176)][_0x4d9882(0x18b)]['findUnique']({'where':{'id':_0x4b7991},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x100488){console[_0x4d9882(0x15f)](_0x4d9882(0x16b)+_0x4b7991),_0x4aabb6['status'](0x194)[_0x4d9882(0x159)]({'success':![],'error':_0x4d9882(0x190)});return;}if(_0x100488[_0x4d9882(0x18c)]!=='interac'&&_0x100488[_0x4d9882(0x18c)]!==_0x4d9882(0x1ae)){console['log'](_0x4d9882(0x1b4)+_0x100488[_0x4d9882(0x18c)]),_0x4aabb6[_0x4d9882(0x156)](0x190)[_0x4d9882(0x159)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x100488[_0x4d9882(0x18c)]});return;}let _0x48608d=_0x30cada;_0x30cada[_0x4d9882(0x154)](',')&&(_0x48608d=_0x30cada[_0x4d9882(0x189)](',')[0x1]);try{Buffer['from'](_0x48608d,'base64');}catch(_0x4e685f){_0x4aabb6[_0x4d9882(0x156)](0x190)[_0x4d9882(0x159)]({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x3b9bc9=await database_1[_0x4d9882(0x176)][_0x4d9882(0x18b)][_0x4d9882(0x1b1)]({'where':{'id':_0x4b7991},'data':{'status':_0x4d9882(0x16f),'updatedAt':new Date()}});console[_0x4d9882(0x15f)](_0x4d9882(0x17e)),console[_0x4d9882(0x15f)]('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x4b7991),console[_0x4d9882(0x15f)](_0x4d9882(0x16e)+_0x100488[_0x4d9882(0x18c)][_0x4d9882(0x17b)]()),console['log'](_0x4d9882(0x188)+_0x3ee65b),console[_0x4d9882(0x15f)](_0x4d9882(0x19d)+Math[_0x4d9882(0x1ac)](_0x48608d['length']*0.75/0x400)+'KB'),console[_0x4d9882(0x15f)](_0x4d9882(0x175));try{const _0x457f62=_0x100488[_0x4d9882(0x18c)]['toUpperCase'](),_0x2fa67a=_0x100488[_0x4d9882(0x18d)][_0x4d9882(0x18a)]||_0x100488[_0x4d9882(0x18d)][_0x4d9882(0x171)],_0xf3c0ce=Math[_0x4d9882(0x1ac)](_0x48608d[_0x4d9882(0x183)]*0.75/0x400),_0x5630d5='🔄\x20'+_0x457f62+_0x4d9882(0x161)+('💳\x20Payment\x20ID:\x20'+_0x4b7991+'\x0a')+(_0x4d9882(0x1b2)+_0x100488[_0x4d9882(0x181)]+'\x20'+_0x100488[_0x4d9882(0x191)]+'\x0a')+(_0x4d9882(0x150)+_0x3ee65b[_0x4d9882(0x17b)]()+'\x20('+_0xf3c0ce+_0x4d9882(0x168))+_0x4d9882(0x192)+(_0x4d9882(0x1b0)+_0x11ca93+'\x0a\x0a')+_0x4d9882(0x164);await telegramBotService_1[_0x4d9882(0x187)][_0x4d9882(0x193)](_0x100488[_0x4d9882(0x179)],_0x5630d5,{'parse_mode':_0x4d9882(0x1a6)});const _0x36fe6b=Buffer['from'](_0x48608d,_0x4d9882(0x1a8)),_0x39f273=_0x4d9882(0x152)+_0x4b7991+'.'+_0x3ee65b;await telegramBotService_1[_0x4d9882(0x187)][_0x4d9882(0x174)](_0x100488[_0x4d9882(0x179)],_0x36fe6b,_0x39f273,_0x4d9882(0x155)+_0x4b7991),console[_0x4d9882(0x15f)](_0x4d9882(0x14d));const _0x56647f=_0x4d9882(0x182),_0x4fb174=_0x4d9882(0x16a)+_0x457f62+_0x4d9882(0x18e)+(_0x4d9882(0x194)+_0x4b7991+'\x0a')+(_0x4d9882(0x180)+_0x2fa67a+'\x0a')+(_0x4d9882(0x1b2)+_0x100488[_0x4d9882(0x181)]+'\x20'+_0x100488[_0x4d9882(0x191)]+'\x0a')+(_0x4d9882(0x150)+_0x3ee65b[_0x4d9882(0x17b)]()+'\x20('+_0xf3c0ce+_0x4d9882(0x168))+_0x4d9882(0x192)+(_0x4d9882(0x1b0)+_0x11ca93+'\x0a\x0a')+_0x4d9882(0x186);await telegramBotService_1['telegramBotService'][_0x4d9882(0x198)](parseInt(_0x56647f),_0x4fb174),await telegramBotService_1[_0x4d9882(0x187)]['sendDirectFile'](parseInt(_0x56647f),_0x36fe6b,_0x39f273,_0x4d9882(0x153)+_0x4b7991),console['log'](_0x4d9882(0x177));}catch(_0x23fdd7){console[_0x4d9882(0x162)](_0x4d9882(0x15d),_0x23fdd7);}_0x4aabb6[_0x4d9882(0x159)]({'success':!![],'message':_0x4d9882(0x197),'data':{'paymentId':_0x3b9bc9['id'],'status':_0x3b9bc9[_0x4d9882(0x156)],'gateway':_0x100488['gateway'],'fileType':_0x3ee65b,'fileSize':Math[_0x4d9882(0x1ac)](_0x48608d[_0x4d9882(0x183)]*0.75/0x400)+'KB','uploadedAt':_0x3b9bc9['updatedAt']}});}catch(_0x1ab42d){console[_0x4d9882(0x162)](_0x4d9882(0x19c),_0x1ab42d),_0x4aabb6[_0x4d9882(0x156)](0x1f4)[_0x4d9882(0x159)]({'success':![],'error':_0x4d9882(0x14f),'details':_0x1ab42d instanceof Error?_0x1ab42d[_0x4d9882(0x166)]:_0x4d9882(0x195)});}}async[a8_0x2056fd(0x19a)](_0x4b60fc,_0xaef245){const _0x5cddc2=a8_0x2056fd;try{const {paymentId:_0x5ee977}=_0x4b60fc['params'];console[_0x5cddc2(0x15f)](_0x5cddc2(0x1b5)+_0x5ee977);const _0x1301a4=await database_1[_0x5cddc2(0x176)][_0x5cddc2(0x18b)][_0x5cddc2(0x1ad)]({'where':{'id':_0x5ee977},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1301a4){_0xaef245[_0x5cddc2(0x156)](0x194)[_0x5cddc2(0x159)]({'success':![],'error':_0x5cddc2(0x190)});return;}if(_0x1301a4[_0x5cddc2(0x18c)]!==_0x5cddc2(0x16c)&&_0x1301a4['gateway']!==_0x5cddc2(0x1ae)){_0xaef245[_0x5cddc2(0x156)](0x190)[_0x5cddc2(0x159)]({'success':![],'error':_0x5cddc2(0x15e)+_0x1301a4[_0x5cddc2(0x18c)]});return;}let _0x3a8206='',_0x397f1b=_0x1301a4['currency'],_0x2157e7='';if(_0x1301a4['gateway']===_0x5cddc2(0x16c))_0x2157e7=_0x5cddc2(0x163),_0x397f1b=_0x5cddc2(0x165),_0x3a8206='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x1301a4[_0x5cddc2(0x181)]+'\x20'+_0x397f1b+_0x5cddc2(0x17f);else _0x1301a4[_0x5cddc2(0x18c)]===_0x5cddc2(0x1ae)&&(_0x2157e7='SEPA\x20Bank\x20Transfer',_0x397f1b='EUR',_0x3a8206=_0x5cddc2(0x19e)+_0x1301a4[_0x5cddc2(0x181)]+'\x20'+_0x397f1b+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x52377a={'success':!![],'data':{'paymentId':_0x1301a4['id'],'gateway':_0x1301a4[_0x5cddc2(0x18c)],'gatewayName':_0x1301a4[_0x5cddc2(0x18c)]['toUpperCase'](),'transferType':_0x2157e7,'amount':_0x1301a4['amount'],'currency':_0x397f1b,'status':_0x1301a4[_0x5cddc2(0x156)],'instructions':_0x3a8206,'shopName':_0x1301a4[_0x5cddc2(0x18d)]['name']||_0x1301a4['shop'][_0x5cddc2(0x171)],'hasProof':![],'proofType':null,'createdAt':_0x1301a4[_0x5cddc2(0x158)],'updatedAt':_0x1301a4['updatedAt'],'supportedFileTypes':[_0x5cddc2(0x1a3),_0x5cddc2(0x151),_0x5cddc2(0x1b6),_0x5cddc2(0x170),'PDF'],'maxFileSize':_0x5cddc2(0x19b)}};_0xaef245['json'](_0x52377a);}catch(_0xcd659c){console[_0x5cddc2(0x162)]('❌\x20Get\x20manual\x20payment\x20info\x20error:',_0xcd659c),_0xaef245[_0x5cddc2(0x156)](0x1f4)[_0x5cddc2(0x159)]({'success':![],'error':_0x5cddc2(0x14f),'details':_0xcd659c instanceof Error?_0xcd659c[_0x5cddc2(0x166)]:_0x5cddc2(0x195)});}}}exports[a8_0x2056fd(0x15c)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();