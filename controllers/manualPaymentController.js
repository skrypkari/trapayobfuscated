'use strict';const a10_0x4e9c5d=a10_0x17ba;(function(_0x1c8b8b,_0x109f39){const _0x3b1234=a10_0x17ba,_0x2044e7=_0x1c8b8b();while(!![]){try{const _0x2cc34f=parseInt(_0x3b1234(0x19b))/0x1*(-parseInt(_0x3b1234(0x15f))/0x2)+-parseInt(_0x3b1234(0x162))/0x3*(-parseInt(_0x3b1234(0x178))/0x4)+-parseInt(_0x3b1234(0x16d))/0x5*(parseInt(_0x3b1234(0x18c))/0x6)+parseInt(_0x3b1234(0x188))/0x7*(parseInt(_0x3b1234(0x16c))/0x8)+parseInt(_0x3b1234(0x19f))/0x9*(-parseInt(_0x3b1234(0x173))/0xa)+parseInt(_0x3b1234(0x177))/0xb+parseInt(_0x3b1234(0x1bf))/0xc;if(_0x2cc34f===_0x109f39)break;else _0x2044e7['push'](_0x2044e7['shift']());}catch(_0x491b55){_0x2044e7['push'](_0x2044e7['shift']());}}}(a10_0x4e8b,0xe955b));function a10_0x17ba(_0x50a186,_0x389a2a){_0x50a186=_0x50a186-0x155;const _0x4e8b4b=a10_0x4e8b();let _0x17ba89=_0x4e8b4b[_0x50a186];return _0x17ba89;}var __importDefault=this&&this[a10_0x4e9c5d(0x1b8)]||function(_0x37667c){return _0x37667c&&_0x37667c['__esModule']?_0x37667c:{'default':_0x37667c};};function a10_0x4e8b(){const _0x326188=['EUR','sepa','update','Payment\x20ID\x20is\x20required','pdf','heic','username','payment','updatedAt','41ldZemF','.\x20Supported:\x20','telegramBotService','payment_proof_','690021xYNilA','jpeg','manualPaymentController','connection','../config/database','includes','replace','defineProperty','Payment\x20proof\x20uploaded\x20successfully','\x20\x20\x20-\x20Payment\x20ID:\x20','default','base64','currency','JPEG','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','Payment\x20not\x20found','shop','CAD','message','sendDirectMessage','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','findUnique','üí∞\x20Amount:\x20','PROCESSING','\x20\x20\x20-\x20File\x20size:\x20','__importDefault','HEIC','amount','Markdown','\x20\x20\x20-\x20Gateway:\x20','sendShopFile','KB)\x0a','24892584NbeKFN','Invalid\x20base64\x20file\x20data','üìÅ\x20File:\x20','remoteAddress','ManualPaymentController','params','üåê\x20Client\x20IP:\x20','Payment\x20proof\x20for\x20','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','error','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant',',\x20size:\x20','toUpperCase','84828fgKRPc','JPG','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','261399sdGwAt','status','üîÑ\x20','üìã\x20Get\x20manual\x20payment\x20info:\x20','round','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','length','getManualPaymentInfo','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','interac','6464NVGaJn','1018065JCdPff','body','toLowerCase','7867339505','png','name','220vhbzFE','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','Interac\x20e-Transfer','\x20Payment\x20Proof\x20Received\x0a\x0a','10878978GCxwgf','68jWVHou','uploadPaymentProof','gateway','../services/telegramBotService','SEPA\x20Bank\x20Transfer','Unknown\x20error','10MB','üìÅ\x20File\x20type:\x20','jpg','üí≥\x20Payment\x20ID:\x20','PDF','json','shopId','‚ùå\x20Upload\x20payment\x20proof\x20error:','log','__esModule','2114lhvrcm','üè™\x20Shop:\x20','sendDirectFile','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','12IkNvHe','üåê\x20Customer\x20IP:\x20','from','PNG','Internal\x20server\x20error','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'];a10_0x4e8b=function(){return _0x326188;};return a10_0x4e8b();}Object[a10_0x4e9c5d(0x1a6)](exports,a10_0x4e9c5d(0x187),{'value':!![]}),exports['manualPaymentController']=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a10_0x4e9c5d(0x1a3))),telegramBotService_1=require(a10_0x4e9c5d(0x17b));class ManualPaymentController{async[a10_0x4e9c5d(0x179)](_0x1d6c60,_0x5ea194){const _0x409f14=a10_0x4e9c5d;try{const {paymentId:_0x1d1db4,fileData:_0x51c830,fileType:_0x245b8f,fileName:_0x39f6fa}=_0x1d6c60[_0x409f14(0x16e)],_0x42cf3a=_0x1d6c60['ip']||_0x1d6c60[_0x409f14(0x1a2)]?.[_0x409f14(0x155)]||'unknown';console[_0x409f14(0x186)](_0x409f14(0x191)+_0x1d1db4),console[_0x409f14(0x186)](_0x409f14(0x17f)+_0x245b8f+_0x409f14(0x15d)+(_0x51c830?Math[_0x409f14(0x166)](_0x51c830[_0x409f14(0x168)]*0.75/0x400):0x0)+'KB'),console[_0x409f14(0x186)](_0x409f14(0x158)+_0x42cf3a);if(!_0x1d1db4){_0x5ea194[_0x409f14(0x163)](0x190)[_0x409f14(0x183)]({'success':![],'error':_0x409f14(0x195)});return;}if(!_0x51c830){_0x5ea194['status'](0x190)[_0x409f14(0x183)]({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x245b8f){_0x5ea194[_0x409f14(0x163)](0x190)['json']({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x18b32b=[_0x409f14(0x171),_0x409f14(0x180),_0x409f14(0x1a0),_0x409f14(0x197),_0x409f14(0x196)],_0x251365=_0x245b8f[_0x409f14(0x16f)]()[_0x409f14(0x1a5)]('.','');if(!_0x18b32b['includes'](_0x251365)){_0x5ea194['status'](0x190)[_0x409f14(0x183)]({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x245b8f+_0x409f14(0x19c)+_0x18b32b['join'](',\x20')});return;}const _0x550553=0xa*0x400*0x400;if(_0x51c830[_0x409f14(0x168)]>_0x550553){_0x5ea194[_0x409f14(0x163)](0x190)['json']({'success':![],'error':_0x409f14(0x161)});return;}const _0x3ffe3b=await database_1[_0x409f14(0x1a9)][_0x409f14(0x199)]['findUnique']({'where':{'id':_0x1d1db4},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3ffe3b){console[_0x409f14(0x186)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x1d1db4),_0x5ea194[_0x409f14(0x163)](0x194)[_0x409f14(0x183)]({'success':![],'error':_0x409f14(0x1ae)});return;}if(_0x3ffe3b[_0x409f14(0x17a)]!==_0x409f14(0x16b)&&_0x3ffe3b[_0x409f14(0x17a)]!==_0x409f14(0x193)){console[_0x409f14(0x186)]('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x3ffe3b[_0x409f14(0x17a)]),_0x5ea194[_0x409f14(0x163)](0x190)[_0x409f14(0x183)]({'success':![],'error':_0x409f14(0x18b)+_0x3ffe3b['gateway']});return;}let _0x5f5db7=_0x51c830;_0x51c830[_0x409f14(0x1a4)](',')&&(_0x5f5db7=_0x51c830['split'](',')[0x1]);try{Buffer[_0x409f14(0x18e)](_0x5f5db7,_0x409f14(0x1aa));}catch(_0xac7543){_0x5ea194[_0x409f14(0x163)](0x190)[_0x409f14(0x183)]({'success':![],'error':_0x409f14(0x1c0)});return;}const _0xe05145=await database_1[_0x409f14(0x1a9)][_0x409f14(0x199)][_0x409f14(0x194)]({'where':{'id':_0x1d1db4},'data':{'status':_0x409f14(0x1b6),'updatedAt':new Date()}});console[_0x409f14(0x186)](_0x409f14(0x174)),console[_0x409f14(0x186)](_0x409f14(0x1a8)+_0x1d1db4),console[_0x409f14(0x186)](_0x409f14(0x1bc)+_0x3ffe3b[_0x409f14(0x17a)]['toUpperCase']()),console[_0x409f14(0x186)]('\x20\x20\x20-\x20File\x20type:\x20'+_0x251365),console[_0x409f14(0x186)](_0x409f14(0x1b7)+Math[_0x409f14(0x166)](_0x5f5db7[_0x409f14(0x168)]*0.75/0x400)+'KB'),console[_0x409f14(0x186)](_0x409f14(0x167));try{const _0xebaec7=_0x3ffe3b[_0x409f14(0x17a)][_0x409f14(0x15e)](),_0x4f6a9f=_0x3ffe3b[_0x409f14(0x1af)][_0x409f14(0x172)]||_0x3ffe3b[_0x409f14(0x1af)][_0x409f14(0x198)],_0x3eea6d=Math[_0x409f14(0x166)](_0x5f5db7[_0x409f14(0x168)]*0.75/0x400),_0x425527=_0x409f14(0x164)+_0xebaec7+_0x409f14(0x176)+(_0x409f14(0x181)+_0x1d1db4+'\x0a')+('üí∞\x20Amount:\x20'+_0x3ffe3b[_0x409f14(0x1ba)]+'\x20'+_0x3ffe3b['currency']+'\x0a')+(_0x409f14(0x1c1)+_0x251365[_0x409f14(0x15e)]()+'\x20('+_0x3eea6d+_0x409f14(0x1be))+_0x409f14(0x1ad)+(_0x409f14(0x18d)+_0x42cf3a+'\x0a\x0a')+'‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x3ffe3b[_0x409f14(0x184)],_0x425527,{'parse_mode':_0x409f14(0x1bb)});const _0x2a460b=Buffer[_0x409f14(0x18e)](_0x5f5db7,'base64'),_0x5b0c92=_0x409f14(0x19e)+_0x1d1db4+'.'+_0x251365;await telegramBotService_1[_0x409f14(0x19d)][_0x409f14(0x1bd)](_0x3ffe3b[_0x409f14(0x184)],_0x2a460b,_0x5b0c92,_0x409f14(0x159)+_0x1d1db4),console[_0x409f14(0x186)](_0x409f14(0x15c));const _0x54fecc=_0x409f14(0x170),_0x510a50='üîÑ\x20'+_0xebaec7+_0x409f14(0x1b3)+(_0x409f14(0x181)+_0x1d1db4+'\x0a')+(_0x409f14(0x189)+_0x4f6a9f+'\x0a')+(_0x409f14(0x1b5)+_0x3ffe3b[_0x409f14(0x1ba)]+'\x20'+_0x3ffe3b['currency']+'\x0a')+(_0x409f14(0x1c1)+_0x251365[_0x409f14(0x15e)]()+'\x20('+_0x3eea6d+_0x409f14(0x1be))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+('üåê\x20Customer\x20IP:\x20'+_0x42cf3a+'\x0a\x0a')+'‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.';await telegramBotService_1[_0x409f14(0x19d)][_0x409f14(0x1b2)](parseInt(_0x54fecc),_0x510a50),await telegramBotService_1[_0x409f14(0x19d)][_0x409f14(0x18a)](parseInt(_0x54fecc),_0x2a460b,_0x5b0c92,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x1d1db4),console[_0x409f14(0x186)]('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x426990){console[_0x409f14(0x15b)]('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:',_0x426990);}_0x5ea194['json']({'success':!![],'message':_0x409f14(0x1a7),'data':{'paymentId':_0xe05145['id'],'status':_0xe05145[_0x409f14(0x163)],'gateway':_0x3ffe3b[_0x409f14(0x17a)],'fileType':_0x251365,'fileSize':Math[_0x409f14(0x166)](_0x5f5db7[_0x409f14(0x168)]*0.75/0x400)+'KB','uploadedAt':_0xe05145[_0x409f14(0x19a)]}});}catch(_0x545f40){console[_0x409f14(0x15b)](_0x409f14(0x185),_0x545f40),_0x5ea194['status'](0x1f4)[_0x409f14(0x183)]({'success':![],'error':_0x409f14(0x190),'details':_0x545f40 instanceof Error?_0x545f40[_0x409f14(0x1b1)]:_0x409f14(0x17d)});}}async[a10_0x4e9c5d(0x169)](_0x21bc00,_0x3359cf){const _0x8cc877=a10_0x4e9c5d;try{const {paymentId:_0x38330d}=_0x21bc00[_0x8cc877(0x157)];console[_0x8cc877(0x186)](_0x8cc877(0x165)+_0x38330d);const _0x97e169=await database_1['default'][_0x8cc877(0x199)][_0x8cc877(0x1b4)]({'where':{'id':_0x38330d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x97e169){_0x3359cf['status'](0x194)['json']({'success':![],'error':_0x8cc877(0x1ae)});return;}if(_0x97e169[_0x8cc877(0x17a)]!==_0x8cc877(0x16b)&&_0x97e169['gateway']!==_0x8cc877(0x193)){_0x3359cf[_0x8cc877(0x163)](0x190)[_0x8cc877(0x183)]({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x97e169[_0x8cc877(0x17a)]});return;}let _0x1e1b6d='',_0x37fc3b=_0x97e169[_0x8cc877(0x1ab)],_0x6d6aef='';if(_0x97e169['gateway']===_0x8cc877(0x16b))_0x6d6aef=_0x8cc877(0x175),_0x37fc3b=_0x8cc877(0x1b0),_0x1e1b6d='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x97e169[_0x8cc877(0x1ba)]+'\x20'+_0x37fc3b+_0x8cc877(0x16a);else _0x97e169[_0x8cc877(0x17a)]===_0x8cc877(0x193)&&(_0x6d6aef=_0x8cc877(0x17c),_0x37fc3b=_0x8cc877(0x192),_0x1e1b6d=_0x8cc877(0x15a)+_0x97e169[_0x8cc877(0x1ba)]+'\x20'+_0x37fc3b+_0x8cc877(0x16a));const _0x1478f4={'success':!![],'data':{'paymentId':_0x97e169['id'],'gateway':_0x97e169[_0x8cc877(0x17a)],'gatewayName':_0x97e169[_0x8cc877(0x17a)]['toUpperCase'](),'transferType':_0x6d6aef,'amount':_0x97e169[_0x8cc877(0x1ba)],'currency':_0x37fc3b,'status':_0x97e169[_0x8cc877(0x163)],'instructions':_0x1e1b6d,'shopName':_0x97e169[_0x8cc877(0x1af)]['name']||_0x97e169[_0x8cc877(0x1af)][_0x8cc877(0x198)],'hasProof':![],'proofType':null,'createdAt':_0x97e169['createdAt'],'updatedAt':_0x97e169[_0x8cc877(0x19a)],'supportedFileTypes':[_0x8cc877(0x18f),_0x8cc877(0x160),_0x8cc877(0x1ac),_0x8cc877(0x1b9),_0x8cc877(0x182)],'maxFileSize':_0x8cc877(0x17e)}};_0x3359cf[_0x8cc877(0x183)](_0x1478f4);}catch(_0x2d2307){console[_0x8cc877(0x15b)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x2d2307),_0x3359cf['status'](0x1f4)[_0x8cc877(0x183)]({'success':![],'error':_0x8cc877(0x190),'details':_0x2d2307 instanceof Error?_0x2d2307['message']:_0x8cc877(0x17d)});}}}exports[a10_0x4e9c5d(0x156)]=ManualPaymentController,exports[a10_0x4e9c5d(0x1a1)]=new ManualPaymentController();