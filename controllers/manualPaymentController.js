'use strict';const a8_0xdc147a=a8_0x9981;function a8_0x9981(_0x1d7071,_0x54a5b2){const _0x1f8171=a8_0x1f81();return a8_0x9981=function(_0x99812a,_0x53c690){_0x99812a=_0x99812a-0x115;let _0x175bf1=_0x1f8171[_0x99812a];return _0x175bf1;},a8_0x9981(_0x1d7071,_0x54a5b2);}(function(_0x39086f,_0x4a2fd2){const _0x12e34b=a8_0x9981,_0x1530e0=_0x39086f();while(!![]){try{const _0x44aec=-parseInt(_0x12e34b(0x133))/0x1+-parseInt(_0x12e34b(0x164))/0x2*(-parseInt(_0x12e34b(0x159))/0x3)+parseInt(_0x12e34b(0x15b))/0x4+-parseInt(_0x12e34b(0x14c))/0x5+-parseInt(_0x12e34b(0x145))/0x6*(parseInt(_0x12e34b(0x143))/0x7)+parseInt(_0x12e34b(0x137))/0x8+-parseInt(_0x12e34b(0x146))/0x9;if(_0x44aec===_0x4a2fd2)break;else _0x1530e0['push'](_0x1530e0['shift']());}catch(_0x406948){_0x1530e0['push'](_0x1530e0['shift']());}}}(a8_0x1f81,0xc6d62));var __importDefault=this&&this[a8_0xdc147a(0x151)]||function(_0x1909f4){const _0x51b625=a8_0xdc147a;return _0x1909f4&&_0x1909f4[_0x51b625(0x117)]?_0x1909f4:{'default':_0x1909f4};};Object[a8_0xdc147a(0x147)](exports,a8_0xdc147a(0x117),{'value':!![]}),exports[a8_0xdc147a(0x153)]=exports[a8_0xdc147a(0x11f)]=void 0x0;const database_1=__importDefault(require(a8_0xdc147a(0x12a)));function a8_0x1f81(){const _0x2e17cb=['‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','Internal\x20server\x20error','../config/database','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','Payment\x20ID\x20is\x20required','CAD','\x20\x20\x20-\x20Gateway:\x20','update','sepa','includes','default','140684kafbBu','json','unknown','Unsupported\x20file\x20type:\x20','12590568aTyzYQ','status','üìã\x20Get\x20manual\x20payment\x20info:\x20','File\x20data\x20is\x20required','Payment\x20proof\x20uploaded\x20successfully','payment','message','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','pdf','.\x20Supported:\x20','base64','30751kYogOk','Payment\x20proof\x20can\x20only\x20be\x20uploaded\x20for\x20PENDING\x20payments.\x20Current\x20status:\x20','1014gjCmyj','8140392hianXC','defineProperty','params','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','EUR','Unknown\x20error','4268210YrlMkM','from','PROCESSING','Payment\x20not\x20found','png','__importDefault','toUpperCase','manualPaymentController','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','üåê\x20Client\x20IP:\x20','amount','heic','findUnique','1500YpbdFn','HEIC','2119376yaQASO','10MB','log','toLowerCase','‚ùå\x20Upload\x20payment\x20proof\x20error:','getManualPaymentInfo','PDF','File\x20type\x20is\x20required','length','5408GlAeLJ','shop','updatedAt','__esModule','\x20\x20\x20-\x20File\x20type:\x20','round','replace','\x20\x20\x20-\x20File\x20size:\x20','split','createdAt','interac','ManualPaymentController','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','jpg','üìÅ\x20File\x20type:\x20','gateway','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','error',',\x20size:\x20'];a8_0x1f81=function(){return _0x2e17cb;};return a8_0x1f81();}class ManualPaymentController{async['uploadPaymentProof'](_0x5045ab,_0x48b26a){const _0x173b5a=a8_0xdc147a;try{const {paymentId:_0x77f3d6,fileData:_0x386d35,fileType:_0x5b2c60,fileName:_0x985155}=_0x5045ab['body'],_0x20faa5=_0x5045ab['ip']||_0x5045ab['connection']?.['remoteAddress']||_0x173b5a(0x135);console[_0x173b5a(0x15d)](_0x173b5a(0x149)+_0x77f3d6),console['log'](_0x173b5a(0x122)+_0x5b2c60+_0x173b5a(0x127)+(_0x386d35?Math['round'](_0x386d35[_0x173b5a(0x163)]*0.75/0x400):0x0)+'KB'),console['log'](_0x173b5a(0x155)+_0x20faa5);if(!_0x77f3d6){_0x48b26a['status'](0x190)['json']({'success':![],'error':_0x173b5a(0x12c)});return;}if(!_0x386d35){_0x48b26a[_0x173b5a(0x138)](0x190)[_0x173b5a(0x134)]({'success':![],'error':_0x173b5a(0x13a)});return;}if(!_0x5b2c60){_0x48b26a['status'](0x190)[_0x173b5a(0x134)]({'success':![],'error':_0x173b5a(0x162)});return;}const _0x5bd331=[_0x173b5a(0x150),_0x173b5a(0x121),'jpeg',_0x173b5a(0x157),_0x173b5a(0x140)],_0x1bc1c0=_0x5b2c60[_0x173b5a(0x15e)]()[_0x173b5a(0x11a)]('.','');if(!_0x5bd331[_0x173b5a(0x131)](_0x1bc1c0)){_0x48b26a[_0x173b5a(0x138)](0x190)[_0x173b5a(0x134)]({'success':![],'error':_0x173b5a(0x136)+_0x5b2c60+_0x173b5a(0x141)+_0x5bd331['join'](',\x20')});return;}const _0x2e5133=0xa*0x400*0x400;if(_0x386d35[_0x173b5a(0x163)]>_0x2e5133){_0x48b26a['status'](0x190)[_0x173b5a(0x134)]({'success':![],'error':'File\x20too\x20large.\x20Maximum\x20size:\x2010MB'});return;}const _0x21df8b=await database_1[_0x173b5a(0x132)]['payment'][_0x173b5a(0x158)]({'where':{'id':_0x77f3d6},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x21df8b){console[_0x173b5a(0x15d)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x77f3d6),_0x48b26a['status'](0x194)[_0x173b5a(0x134)]({'success':![],'error':_0x173b5a(0x14f)});return;}if(_0x21df8b[_0x173b5a(0x123)]!==_0x173b5a(0x11e)&&_0x21df8b[_0x173b5a(0x123)]!==_0x173b5a(0x130)){console[_0x173b5a(0x15d)](_0x173b5a(0x128)+_0x21df8b[_0x173b5a(0x123)]),_0x48b26a[_0x173b5a(0x138)](0x190)[_0x173b5a(0x134)]({'success':![],'error':_0x173b5a(0x120)+_0x21df8b[_0x173b5a(0x123)]});return;}if(_0x21df8b['status']!=='PENDING'){console[_0x173b5a(0x15d)]('‚ùå\x20Invalid\x20payment\x20status:\x20'+_0x21df8b[_0x173b5a(0x138)]),_0x48b26a['status'](0x190)[_0x173b5a(0x134)]({'success':![],'error':_0x173b5a(0x144)+_0x21df8b[_0x173b5a(0x138)]});return;}let _0x2757b4=_0x386d35;_0x386d35['includes'](',')&&(_0x2757b4=_0x386d35[_0x173b5a(0x11c)](',')[0x1]);try{Buffer[_0x173b5a(0x14d)](_0x2757b4,_0x173b5a(0x142));}catch(_0x432726){_0x48b26a['status'](0x190)[_0x173b5a(0x134)]({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x321ffd=await database_1[_0x173b5a(0x132)]['payment'][_0x173b5a(0x12f)]({'where':{'id':_0x77f3d6},'data':{'status':_0x173b5a(0x14e),'updatedAt':new Date()}});console[_0x173b5a(0x15d)](_0x173b5a(0x12b)),console['log']('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x77f3d6),console[_0x173b5a(0x15d)](_0x173b5a(0x12e)+_0x21df8b[_0x173b5a(0x123)][_0x173b5a(0x152)]()),console[_0x173b5a(0x15d)](_0x173b5a(0x118)+_0x1bc1c0),console['log'](_0x173b5a(0x11b)+Math['round'](_0x2757b4[_0x173b5a(0x163)]*0.75/0x400)+'KB'),console[_0x173b5a(0x15d)](_0x173b5a(0x124)),_0x48b26a['json']({'success':!![],'message':_0x173b5a(0x13b),'data':{'paymentId':_0x321ffd['id'],'status':_0x321ffd[_0x173b5a(0x138)],'gateway':_0x21df8b[_0x173b5a(0x123)],'fileType':_0x1bc1c0,'fileSize':Math[_0x173b5a(0x119)](_0x2757b4['length']*0.75/0x400)+'KB','uploadedAt':_0x321ffd[_0x173b5a(0x116)]}});}catch(_0x82a214){console['error'](_0x173b5a(0x15f),_0x82a214),_0x48b26a['status'](0x1f4)[_0x173b5a(0x134)]({'success':![],'error':_0x173b5a(0x129),'details':_0x82a214 instanceof Error?_0x82a214[_0x173b5a(0x13d)]:'Unknown\x20error'});}}async[a8_0xdc147a(0x160)](_0x28bba1,_0x1efb87){const _0x12129e=a8_0xdc147a;try{const {paymentId:_0x193419}=_0x28bba1[_0x12129e(0x148)];console[_0x12129e(0x15d)](_0x12129e(0x139)+_0x193419);const _0x3d94da=await database_1[_0x12129e(0x132)][_0x12129e(0x13c)][_0x12129e(0x158)]({'where':{'id':_0x193419},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3d94da){_0x1efb87['status'](0x194)[_0x12129e(0x134)]({'success':![],'error':_0x12129e(0x14f)});return;}if(_0x3d94da['gateway']!==_0x12129e(0x11e)&&_0x3d94da[_0x12129e(0x123)]!==_0x12129e(0x130)){_0x1efb87[_0x12129e(0x138)](0x190)[_0x12129e(0x134)]({'success':![],'error':_0x12129e(0x13f)+_0x3d94da[_0x12129e(0x123)]});return;}let _0x4e6cec='',_0x3a2731=_0x3d94da['currency'],_0x264ecd='';if(_0x3d94da['gateway']===_0x12129e(0x11e))_0x264ecd='Interac\x20e-Transfer',_0x3a2731=_0x12129e(0x12d),_0x4e6cec=_0x12129e(0x13e)+_0x3d94da[_0x12129e(0x156)]+'\x20'+_0x3a2731+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.';else _0x3d94da['gateway']==='sepa'&&(_0x264ecd='SEPA\x20Bank\x20Transfer',_0x3a2731=_0x12129e(0x14a),_0x4e6cec=_0x12129e(0x154)+_0x3d94da['amount']+'\x20'+_0x3a2731+_0x12129e(0x125));const _0x49a0b9={'success':!![],'data':{'paymentId':_0x3d94da['id'],'gateway':_0x3d94da[_0x12129e(0x123)],'gatewayName':_0x3d94da['gateway'][_0x12129e(0x152)](),'transferType':_0x264ecd,'amount':_0x3d94da[_0x12129e(0x156)],'currency':_0x3a2731,'status':_0x3d94da[_0x12129e(0x138)],'instructions':_0x4e6cec,'shopName':_0x3d94da['shop']['name']||_0x3d94da[_0x12129e(0x115)]['username'],'hasProof':![],'proofType':null,'createdAt':_0x3d94da[_0x12129e(0x11d)],'updatedAt':_0x3d94da[_0x12129e(0x116)],'supportedFileTypes':['PNG','JPG','JPEG',_0x12129e(0x15a),_0x12129e(0x161)],'maxFileSize':_0x12129e(0x15c)}};_0x1efb87[_0x12129e(0x134)](_0x49a0b9);}catch(_0x4dbdc4){console[_0x12129e(0x126)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x4dbdc4),_0x1efb87[_0x12129e(0x138)](0x1f4)[_0x12129e(0x134)]({'success':![],'error':'Internal\x20server\x20error','details':_0x4dbdc4 instanceof Error?_0x4dbdc4[_0x12129e(0x13d)]:_0x12129e(0x14b)});}}}exports[a8_0xdc147a(0x11f)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();