'use strict';const a9_0x42d1f8=a9_0xfdb1;(function(_0x1cc17c,_0x18989b){const _0x2423a5=a9_0xfdb1,_0x1fcf85=_0x1cc17c();while(!![]){try{const _0x41b7c9=parseInt(_0x2423a5(0xcb))/0x1*(parseInt(_0x2423a5(0xc3))/0x2)+parseInt(_0x2423a5(0xfa))/0x3*(parseInt(_0x2423a5(0xa4))/0x4)+-parseInt(_0x2423a5(0xbe))/0x5*(parseInt(_0x2423a5(0xf1))/0x6)+parseInt(_0x2423a5(0xaa))/0x7*(parseInt(_0x2423a5(0xae))/0x8)+-parseInt(_0x2423a5(0xdc))/0x9*(parseInt(_0x2423a5(0xe9))/0xa)+-parseInt(_0x2423a5(0x101))/0xb+-parseInt(_0x2423a5(0x95))/0xc*(-parseInt(_0x2423a5(0xc5))/0xd);if(_0x41b7c9===_0x18989b)break;else _0x1fcf85['push'](_0x1fcf85['shift']());}catch(_0x38e949){_0x1fcf85['push'](_0x1fcf85['shift']());}}}(a9_0x56e7,0x1bd21));function a9_0x56e7(){const _0x49cdb2=['split','216BApxsU','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','KB)\x0a','ManualPaymentController','png','../services/telegramBotService','pdf','Payment\x20ID\x20is\x20required','payment','\x20\x20\x20-\x20Gateway:\x20','username','Markdown','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','\x20\x20\x20-\x20Payment\x20ID:\x20','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','2348SkKhqt','updatedAt','Invalid\x20base64\x20file\x20data','default','shop','message','161SmlBTq','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','üè™\x20Shop:\x20','Unsupported\x20file\x20type:\x20','26056QjZKKF','sendDirectFile','update','log','base64','Unknown\x20error','connection','PNG','../config/database','status','üîÑ\x20','10MB','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','Payment\x20not\x20found','üí∞\x20Amount:\x20','\x20Payment\x20Proof\x20Received\x0a\x0a','5Qcwdom','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','Internal\x20server\x20error','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','\x20\x20\x20-\x20File\x20size:\x20','1956Pjvjsu','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','69225XKDaPy','join','round','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','Interac\x20e-Transfer','from','133OVBfVp','params','‚ùå\x20Payment\x20not\x20found:\x20','json','üìÅ\x20File:\x20','replace','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','PROCESSING','sendDirectMessage','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','currency','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','üí≥\x20Payment\x20ID:\x20','üåê\x20Client\x20IP:\x20','PDF','name','gateway','1638TlaHIK','toLowerCase','interac',',\x20size:\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent','manualPaymentController','body','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','getManualPaymentInfo','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','CAD','sendShopFile','.\x20Supported:\x20','6220YOhrem','EUR','defineProperty','File\x20data\x20is\x20required','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','sepa','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','toUpperCase','102612xRrbFh','__esModule','uploadPaymentProof','jpeg','payment_proof_','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','üìã\x20Get\x20manual\x20payment\x20info:\x20','shopId','includes','549vOAHmy','heic','length','amount','üåê\x20Customer\x20IP:\x20','HEIC','findUnique','1803967RQrpxl','error','telegramBotService'];a9_0x56e7=function(){return _0x49cdb2;};return a9_0x56e7();}var __importDefault=this&&this['__importDefault']||function(_0x5b670e){const _0x3f1133=a9_0xfdb1;return _0x5b670e&&_0x5b670e[_0x3f1133(0xf2)]?_0x5b670e:{'default':_0x5b670e};};function a9_0xfdb1(_0x43c1eb,_0x42693b){_0x43c1eb=_0x43c1eb-0x95;const _0x56e7dd=a9_0x56e7();let _0xfdb119=_0x56e7dd[_0x43c1eb];return _0xfdb119;}Object[a9_0x42d1f8(0xeb)](exports,a9_0x42d1f8(0xf2),{'value':!![]}),exports[a9_0x42d1f8(0xe1)]=exports[a9_0x42d1f8(0x98)]=void 0x0;const database_1=__importDefault(require(a9_0x42d1f8(0xb6))),telegramBotService_1=require(a9_0x42d1f8(0x9a));class ManualPaymentController{async[a9_0x42d1f8(0xf3)](_0x3969a7,_0x37fb98){const _0x2a452b=a9_0x42d1f8;try{const {paymentId:_0x4d912b,fileData:_0x22ce06,fileType:_0x1032dc,fileName:_0x17d769}=_0x3969a7[_0x2a452b(0xe2)],_0x39277f=_0x3969a7['ip']||_0x3969a7[_0x2a452b(0xb4)]?.['remoteAddress']||'unknown';console['log'](_0x2a452b(0xab)+_0x4d912b),console[_0x2a452b(0xb1)]('üìÅ\x20File\x20type:\x20'+_0x1032dc+_0x2a452b(0xdf)+(_0x22ce06?Math[_0x2a452b(0xc7)](_0x22ce06[_0x2a452b(0xfc)]*0.75/0x400):0x0)+'KB'),console[_0x2a452b(0xb1)](_0x2a452b(0xd8)+_0x39277f);if(!_0x4d912b){_0x37fb98[_0x2a452b(0xb7)](0x190)[_0x2a452b(0xce)]({'success':![],'error':_0x2a452b(0x9c)});return;}if(!_0x22ce06){_0x37fb98[_0x2a452b(0xb7)](0x190)[_0x2a452b(0xce)]({'success':![],'error':_0x2a452b(0xec)});return;}if(!_0x1032dc){_0x37fb98['status'](0x190)[_0x2a452b(0xce)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x2e2dd4=[_0x2a452b(0x99),'jpg',_0x2a452b(0xf4),_0x2a452b(0xfb),_0x2a452b(0x9b)],_0x3ba709=_0x1032dc[_0x2a452b(0xdd)]()[_0x2a452b(0xd0)]('.','');if(!_0x2e2dd4[_0x2a452b(0xf9)](_0x3ba709)){_0x37fb98[_0x2a452b(0xb7)](0x190)['json']({'success':![],'error':_0x2a452b(0xad)+_0x1032dc+_0x2a452b(0xe8)+_0x2e2dd4[_0x2a452b(0xc6)](',\x20')});return;}const _0x4fd5c1=0xa*0x400*0x400;if(_0x22ce06[_0x2a452b(0xfc)]>_0x4fd5c1){_0x37fb98[_0x2a452b(0xb7)](0x190)[_0x2a452b(0xce)]({'success':![],'error':_0x2a452b(0xa1)});return;}const _0x2b4142=await database_1['default'][_0x2a452b(0x9d)][_0x2a452b(0x100)]({'where':{'id':_0x4d912b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2b4142){console[_0x2a452b(0xb1)](_0x2a452b(0xcd)+_0x4d912b),_0x37fb98[_0x2a452b(0xb7)](0x194)['json']({'success':![],'error':_0x2a452b(0xbb)});return;}if(_0x2b4142['gateway']!==_0x2a452b(0xde)&&_0x2b4142[_0x2a452b(0xdb)]!==_0x2a452b(0xee)){console[_0x2a452b(0xb1)](_0x2a452b(0x96)+_0x2b4142[_0x2a452b(0xdb)]),_0x37fb98[_0x2a452b(0xb7)](0x190)['json']({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x2b4142[_0x2a452b(0xdb)]});return;}let _0x235b32=_0x22ce06;_0x22ce06[_0x2a452b(0xf9)](',')&&(_0x235b32=_0x22ce06[_0x2a452b(0x104)](',')[0x1]);try{Buffer[_0x2a452b(0xca)](_0x235b32,_0x2a452b(0xb2));}catch(_0x534033){_0x37fb98['status'](0x190)[_0x2a452b(0xce)]({'success':![],'error':_0x2a452b(0xa6)});return;}const _0xe14cde=await database_1[_0x2a452b(0xa7)]['payment'][_0x2a452b(0xb0)]({'where':{'id':_0x4d912b},'data':{'status':_0x2a452b(0xd2),'updatedAt':new Date()}});console[_0x2a452b(0xb1)](_0x2a452b(0xbf)),console[_0x2a452b(0xb1)](_0x2a452b(0xa2)+_0x4d912b),console['log'](_0x2a452b(0x9e)+_0x2b4142['gateway'][_0x2a452b(0xf0)]()),console[_0x2a452b(0xb1)]('\x20\x20\x20-\x20File\x20type:\x20'+_0x3ba709),console[_0x2a452b(0xb1)](_0x2a452b(0xc2)+Math[_0x2a452b(0xc7)](_0x235b32[_0x2a452b(0xfc)]*0.75/0x400)+'KB'),console['log'](_0x2a452b(0xe3));try{const _0x5d12dc=_0x2b4142[_0x2a452b(0xdb)][_0x2a452b(0xf0)](),_0x4f31ff=_0x2b4142[_0x2a452b(0xa8)][_0x2a452b(0xda)]||_0x2b4142[_0x2a452b(0xa8)][_0x2a452b(0x9f)],_0xf08713=Math[_0x2a452b(0xc7)](_0x235b32['length']*0.75/0x400),_0x306620=_0x2a452b(0xb8)+_0x5d12dc+_0x2a452b(0xbd)+(_0x2a452b(0xd7)+_0x4d912b+'\x0a')+(_0x2a452b(0xbc)+_0x2b4142[_0x2a452b(0xfd)]+'\x20'+_0x2b4142[_0x2a452b(0xd5)]+'\x0a')+(_0x2a452b(0xcf)+_0x3ba709[_0x2a452b(0xf0)]()+'\x20('+_0xf08713+_0x2a452b(0x97))+_0x2a452b(0xc1)+(_0x2a452b(0xfe)+_0x39277f+'\x0a\x0a')+_0x2a452b(0xef);await telegramBotService_1[_0x2a452b(0x103)]['sendShopNotification'](_0x2b4142['shopId'],_0x306620,{'parse_mode':_0x2a452b(0xa0)});const _0x391211=Buffer[_0x2a452b(0xca)](_0x235b32,_0x2a452b(0xb2)),_0x49f36d=_0x2a452b(0xf5)+_0x4d912b+'.'+_0x3ba709;await telegramBotService_1[_0x2a452b(0x103)][_0x2a452b(0xe7)](_0x2b4142[_0x2a452b(0xf8)],_0x391211,_0x49f36d,'Payment\x20proof\x20for\x20'+_0x4d912b),console[_0x2a452b(0xb1)](_0x2a452b(0xa3));const _0x3c39cd='7867339505',_0x1d63de=_0x2a452b(0xb8)+_0x5d12dc+_0x2a452b(0xf6)+('üí≥\x20Payment\x20ID:\x20'+_0x4d912b+'\x0a')+(_0x2a452b(0xac)+_0x4f31ff+'\x0a')+(_0x2a452b(0xbc)+_0x2b4142[_0x2a452b(0xfd)]+'\x20'+_0x2b4142[_0x2a452b(0xd5)]+'\x0a')+(_0x2a452b(0xcf)+_0x3ba709[_0x2a452b(0xf0)]()+'\x20('+_0xf08713+_0x2a452b(0x97))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x2a452b(0xfe)+_0x39277f+'\x0a\x0a')+_0x2a452b(0xd6);await telegramBotService_1[_0x2a452b(0x103)][_0x2a452b(0xd3)](parseInt(_0x3c39cd),_0x1d63de),await telegramBotService_1[_0x2a452b(0x103)][_0x2a452b(0xaf)](parseInt(_0x3c39cd),_0x391211,_0x49f36d,_0x2a452b(0xed)+_0x4d912b),console['log'](_0x2a452b(0xe0));}catch(_0x58b99c){console['error'](_0x2a452b(0xc8),_0x58b99c);}_0x37fb98[_0x2a452b(0xce)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0xe14cde['id'],'status':_0xe14cde[_0x2a452b(0xb7)],'gateway':_0x2b4142[_0x2a452b(0xdb)],'fileType':_0x3ba709,'fileSize':Math['round'](_0x235b32[_0x2a452b(0xfc)]*0.75/0x400)+'KB','uploadedAt':_0xe14cde[_0x2a452b(0xa5)]}});}catch(_0x39730f){console[_0x2a452b(0x102)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x39730f),_0x37fb98[_0x2a452b(0xb7)](0x1f4)[_0x2a452b(0xce)]({'success':![],'error':_0x2a452b(0xc0),'details':_0x39730f instanceof Error?_0x39730f[_0x2a452b(0xa9)]:_0x2a452b(0xb3)});}}async[a9_0x42d1f8(0xe4)](_0x1abb35,_0x198a6b){const _0x8b2a04=a9_0x42d1f8;try{const {paymentId:_0xfa24be}=_0x1abb35[_0x8b2a04(0xcc)];console[_0x8b2a04(0xb1)](_0x8b2a04(0xf7)+_0xfa24be);const _0x34b8a6=await database_1[_0x8b2a04(0xa7)]['payment'][_0x8b2a04(0x100)]({'where':{'id':_0xfa24be},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x34b8a6){_0x198a6b[_0x8b2a04(0xb7)](0x194)['json']({'success':![],'error':_0x8b2a04(0xbb)});return;}if(_0x34b8a6['gateway']!==_0x8b2a04(0xde)&&_0x34b8a6[_0x8b2a04(0xdb)]!==_0x8b2a04(0xee)){_0x198a6b[_0x8b2a04(0xb7)](0x190)[_0x8b2a04(0xce)]({'success':![],'error':_0x8b2a04(0xc4)+_0x34b8a6['gateway']});return;}let _0x5e4288='',_0x11449f=_0x34b8a6['currency'],_0x101795='';if(_0x34b8a6['gateway']==='interac')_0x101795=_0x8b2a04(0xc9),_0x11449f=_0x8b2a04(0xe6),_0x5e4288=_0x8b2a04(0xe5)+_0x34b8a6[_0x8b2a04(0xfd)]+'\x20'+_0x11449f+_0x8b2a04(0xba);else _0x34b8a6[_0x8b2a04(0xdb)]==='sepa'&&(_0x101795='SEPA\x20Bank\x20Transfer',_0x11449f=_0x8b2a04(0xea),_0x5e4288=_0x8b2a04(0xd1)+_0x34b8a6[_0x8b2a04(0xfd)]+'\x20'+_0x11449f+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0xc31b6b={'success':!![],'data':{'paymentId':_0x34b8a6['id'],'gateway':_0x34b8a6[_0x8b2a04(0xdb)],'gatewayName':_0x34b8a6[_0x8b2a04(0xdb)][_0x8b2a04(0xf0)](),'transferType':_0x101795,'amount':_0x34b8a6['amount'],'currency':_0x11449f,'status':_0x34b8a6['status'],'instructions':_0x5e4288,'shopName':_0x34b8a6[_0x8b2a04(0xa8)][_0x8b2a04(0xda)]||_0x34b8a6[_0x8b2a04(0xa8)][_0x8b2a04(0x9f)],'hasProof':![],'proofType':null,'createdAt':_0x34b8a6['createdAt'],'updatedAt':_0x34b8a6[_0x8b2a04(0xa5)],'supportedFileTypes':[_0x8b2a04(0xb5),'JPG','JPEG',_0x8b2a04(0xff),_0x8b2a04(0xd9)],'maxFileSize':_0x8b2a04(0xb9)}};_0x198a6b[_0x8b2a04(0xce)](_0xc31b6b);}catch(_0xb3ab31){console[_0x8b2a04(0x102)](_0x8b2a04(0xd4),_0xb3ab31),_0x198a6b[_0x8b2a04(0xb7)](0x1f4)[_0x8b2a04(0xce)]({'success':![],'error':_0x8b2a04(0xc0),'details':_0xb3ab31 instanceof Error?_0xb3ab31['message']:_0x8b2a04(0xb3)});}}}exports['ManualPaymentController']=ManualPaymentController,exports[a9_0x42d1f8(0xe1)]=new ManualPaymentController();