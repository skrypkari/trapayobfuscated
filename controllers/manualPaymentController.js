'use strict';function a8_0x39dd(){const _0x244b0f=['includes','shop','__importDefault','sendShopFile','pdf','üìÅ\x20File:\x20','../config/database','base64','.\x20Supported:\x20','KB)\x0a','error','2PKFJIw','54uzWgAk','Internal\x20server\x20error','shopId','gateway','unknown','PROCESSING','üìÅ\x20File\x20type:\x20','5GITGUV','username','manualPaymentController','length','Markdown','Payment\x20proof\x20for\x20','currency','interac','\x20\x20\x20-\x20File\x20size:\x20','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','1328712DeoxfF','SEPA\x20Bank\x20Transfer','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','toUpperCase','EUR','jpeg','Unsupported\x20file\x20type:\x20','sendDirectFile','10MB','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','Invalid\x20base64\x20file\x20data','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','üåê\x20Client\x20IP:\x20','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','3848310CDWgqm','\x20\x20\x20-\x20Gateway:\x20','Payment\x20ID\x20is\x20required','toLowerCase','json','updatedAt','getManualPaymentInfo','createdAt','connection','ManualPaymentController','split','default','File\x20type\x20is\x20required','\x20\x20\x20-\x20Payment\x20ID:\x20','\x20\x20\x20-\x20File\x20type:\x20','status','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','2816043rHyEYk','message','1224044OGcaLJ','2183753ZaCRJU','from','params','JPEG','üí≥\x20Payment\x20ID:\x20','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','üåê\x20Customer\x20IP:\x20','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','sepa','join','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','1752528nTgeiG','round','defineProperty','log','PDF','Unknown\x20error','Interac\x20e-Transfer','91aKPtoj','üì±\x20Admin\x20notification\x20and\x20file\x20sent','HEIC','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','uploadPaymentProof','\x20Payment\x20Proof\x20Received\x0a\x0a','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','210846UTTHCd','payment','remoteAddress','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','__esModule','üîÑ\x20','replace','findUnique','Payment\x20proof\x20uploaded\x20successfully','telegramBotService','amount'];a8_0x39dd=function(){return _0x244b0f;};return a8_0x39dd();}const a8_0x39cd54=a8_0x5e69;function a8_0x5e69(_0x3b192f,_0x187e46){const _0x39dd64=a8_0x39dd();return a8_0x5e69=function(_0x5e6980,_0x4b5624){_0x5e6980=_0x5e6980-0x71;let _0x196956=_0x39dd64[_0x5e6980];return _0x196956;},a8_0x5e69(_0x3b192f,_0x187e46);}(function(_0x838fce,_0x55ec6c){const _0x4e6d1f=a8_0x5e69,_0x507df2=_0x838fce();while(!![]){try{const _0x42a860=-parseInt(_0x4e6d1f(0xcf))/0x1+parseInt(_0x4e6d1f(0xbd))/0x2*(parseInt(_0x4e6d1f(0x8a))/0x3)+parseInt(_0x4e6d1f(0x8c))/0x4*(-parseInt(_0x4e6d1f(0xc5))/0x5)+-parseInt(_0x4e6d1f(0xa7))/0x6*(parseInt(_0x4e6d1f(0xa0))/0x7)+-parseInt(_0x4e6d1f(0x99))/0x8*(-parseInt(_0x4e6d1f(0xbe))/0x9)+parseInt(_0x4e6d1f(0x79))/0xa+parseInt(_0x4e6d1f(0x8d))/0xb;if(_0x42a860===_0x55ec6c)break;else _0x507df2['push'](_0x507df2['shift']());}catch(_0x1c7690){_0x507df2['push'](_0x507df2['shift']());}}}(a8_0x39dd,0xb5dab));var __importDefault=this&&this[a8_0x39cd54(0xb4)]||function(_0x5bb848){const _0x580a6f=a8_0x39cd54;return _0x5bb848&&_0x5bb848[_0x580a6f(0xab)]?_0x5bb848:{'default':_0x5bb848};};Object[a8_0x39cd54(0x9b)](exports,a8_0x39cd54(0xab),{'value':!![]}),exports[a8_0x39cd54(0xc7)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a8_0x39cd54(0xb8))),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async[a8_0x39cd54(0xa4)](_0x1b7de4,_0x59d601){const _0x453f6b=a8_0x39cd54;try{const {paymentId:_0x271a30,fileData:_0x237024,fileType:_0x4e4566,fileName:_0x147ada}=_0x1b7de4['body'],_0x32f830=_0x1b7de4['ip']||_0x1b7de4[_0x453f6b(0x81)]?.[_0x453f6b(0xa9)]||_0x453f6b(0xc2);console[_0x453f6b(0x9c)](_0x453f6b(0x74)+_0x271a30),console[_0x453f6b(0x9c)](_0x453f6b(0xc4)+_0x4e4566+',\x20size:\x20'+(_0x237024?Math['round'](_0x237024['length']*0.75/0x400):0x0)+'KB'),console['log'](_0x453f6b(0x77)+_0x32f830);if(!_0x271a30){_0x59d601[_0x453f6b(0x88)](0x190)[_0x453f6b(0x7d)]({'success':![],'error':_0x453f6b(0x7b)});return;}if(!_0x237024){_0x59d601[_0x453f6b(0x88)](0x190)[_0x453f6b(0x7d)]({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x4e4566){_0x59d601[_0x453f6b(0x88)](0x190)[_0x453f6b(0x7d)]({'success':![],'error':_0x453f6b(0x85)});return;}const _0x2db9f6=['png','jpg',_0x453f6b(0xd4),'heic',_0x453f6b(0xb6)],_0x23b97d=_0x4e4566[_0x453f6b(0x7c)]()[_0x453f6b(0xad)]('.','');if(!_0x2db9f6['includes'](_0x23b97d)){_0x59d601[_0x453f6b(0x88)](0x190)['json']({'success':![],'error':_0x453f6b(0x71)+_0x4e4566+_0x453f6b(0xba)+_0x2db9f6[_0x453f6b(0x97)](',\x20')});return;}const _0xbf6860=0xa*0x400*0x400;if(_0x237024[_0x453f6b(0xc8)]>_0xbf6860){_0x59d601[_0x453f6b(0x88)](0x190)[_0x453f6b(0x7d)]({'success':![],'error':_0x453f6b(0x93)});return;}const _0x1413f4=await database_1['default'][_0x453f6b(0xa8)]['findUnique']({'where':{'id':_0x271a30},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1413f4){console[_0x453f6b(0x9c)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x271a30),_0x59d601[_0x453f6b(0x88)](0x194)[_0x453f6b(0x7d)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x1413f4['gateway']!==_0x453f6b(0xcc)&&_0x1413f4[_0x453f6b(0xc1)]!==_0x453f6b(0x96)){console[_0x453f6b(0x9c)]('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x1413f4[_0x453f6b(0xc1)]),_0x59d601[_0x453f6b(0x88)](0x190)[_0x453f6b(0x7d)]({'success':![],'error':_0x453f6b(0x89)+_0x1413f4[_0x453f6b(0xc1)]});return;}let _0x35e186=_0x237024;_0x237024[_0x453f6b(0xb2)](',')&&(_0x35e186=_0x237024[_0x453f6b(0x83)](',')[0x1]);try{Buffer['from'](_0x35e186,'base64');}catch(_0x35e79f){_0x59d601[_0x453f6b(0x88)](0x190)[_0x453f6b(0x7d)]({'success':![],'error':_0x453f6b(0x75)});return;}const _0x476124=await database_1['default'][_0x453f6b(0xa8)]['update']({'where':{'id':_0x271a30},'data':{'status':_0x453f6b(0xc3),'updatedAt':new Date()}});console[_0x453f6b(0x9c)]('‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:'),console[_0x453f6b(0x9c)](_0x453f6b(0x86)+_0x271a30),console[_0x453f6b(0x9c)](_0x453f6b(0x7a)+_0x1413f4[_0x453f6b(0xc1)]['toUpperCase']()),console['log'](_0x453f6b(0x87)+_0x23b97d),console[_0x453f6b(0x9c)](_0x453f6b(0xcd)+Math['round'](_0x35e186[_0x453f6b(0xc8)]*0.75/0x400)+'KB'),console[_0x453f6b(0x9c)]('\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING');try{const _0x349742=_0x1413f4[_0x453f6b(0xc1)][_0x453f6b(0xd2)](),_0x234518=_0x1413f4[_0x453f6b(0xb3)]['name']||_0x1413f4[_0x453f6b(0xb3)][_0x453f6b(0xc6)],_0x168fec=Math[_0x453f6b(0x9a)](_0x35e186['length']*0.75/0x400),_0x4116cb='üîÑ\x20'+_0x349742+_0x453f6b(0xa5)+(_0x453f6b(0x91)+_0x271a30+'\x0a')+('üí∞\x20Amount:\x20'+_0x1413f4[_0x453f6b(0xb1)]+'\x20'+_0x1413f4['currency']+'\x0a')+(_0x453f6b(0xb7)+_0x23b97d[_0x453f6b(0xd2)]()+'\x20('+_0x168fec+_0x453f6b(0xbb))+_0x453f6b(0xaa)+(_0x453f6b(0x94)+_0x32f830+'\x0a\x0a')+_0x453f6b(0x98);await telegramBotService_1[_0x453f6b(0xb0)]['sendShopNotification'](_0x1413f4[_0x453f6b(0xc0)],_0x4116cb,{'parse_mode':_0x453f6b(0xc9)});const _0x1fa60a=Buffer[_0x453f6b(0x8e)](_0x35e186,_0x453f6b(0xb9)),_0x23baf1='payment_proof_'+_0x271a30+'.'+_0x23b97d;await telegramBotService_1[_0x453f6b(0xb0)][_0x453f6b(0xb5)](_0x1413f4[_0x453f6b(0xc0)],_0x1fa60a,_0x23baf1,_0x453f6b(0xca)+_0x271a30),console['log']('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x3635a9='7867339505',_0x32373e=_0x453f6b(0xac)+_0x349742+_0x453f6b(0xa6)+(_0x453f6b(0x91)+_0x271a30+'\x0a')+('üè™\x20Shop:\x20'+_0x234518+'\x0a')+('üí∞\x20Amount:\x20'+_0x1413f4[_0x453f6b(0xb1)]+'\x20'+_0x1413f4[_0x453f6b(0xcb)]+'\x0a')+(_0x453f6b(0xb7)+_0x23b97d[_0x453f6b(0xd2)]()+'\x20('+_0x168fec+'KB)\x0a')+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x453f6b(0x94)+_0x32f830+'\x0a\x0a')+_0x453f6b(0xce);await telegramBotService_1[_0x453f6b(0xb0)]['sendDirectMessage'](parseInt(_0x3635a9),_0x32373e),await telegramBotService_1[_0x453f6b(0xb0)][_0x453f6b(0x72)](parseInt(_0x3635a9),_0x1fa60a,_0x23baf1,_0x453f6b(0x76)+_0x271a30),console[_0x453f6b(0x9c)](_0x453f6b(0xa1));}catch(_0x1eed02){console[_0x453f6b(0xbc)](_0x453f6b(0x95),_0x1eed02);}_0x59d601[_0x453f6b(0x7d)]({'success':!![],'message':_0x453f6b(0xaf),'data':{'paymentId':_0x476124['id'],'status':_0x476124[_0x453f6b(0x88)],'gateway':_0x1413f4[_0x453f6b(0xc1)],'fileType':_0x23b97d,'fileSize':Math['round'](_0x35e186[_0x453f6b(0xc8)]*0.75/0x400)+'KB','uploadedAt':_0x476124[_0x453f6b(0x7e)]}});}catch(_0x34bc48){console[_0x453f6b(0xbc)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x34bc48),_0x59d601[_0x453f6b(0x88)](0x1f4)[_0x453f6b(0x7d)]({'success':![],'error':_0x453f6b(0xbf),'details':_0x34bc48 instanceof Error?_0x34bc48[_0x453f6b(0x8b)]:_0x453f6b(0x9e)});}}async[a8_0x39cd54(0x7f)](_0x2b685e,_0x1483e6){const _0x2682f3=a8_0x39cd54;try{const {paymentId:_0x288253}=_0x2b685e[_0x2682f3(0x8f)];console['log']('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x288253);const _0x158c8d=await database_1[_0x2682f3(0x84)][_0x2682f3(0xa8)][_0x2682f3(0xae)]({'where':{'id':_0x288253},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x158c8d){_0x1483e6[_0x2682f3(0x88)](0x194)[_0x2682f3(0x7d)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x158c8d[_0x2682f3(0xc1)]!==_0x2682f3(0xcc)&&_0x158c8d['gateway']!=='sepa'){_0x1483e6[_0x2682f3(0x88)](0x190)['json']({'success':![],'error':_0x2682f3(0x78)+_0x158c8d[_0x2682f3(0xc1)]});return;}let _0x2e6ae6='',_0x20d8a2=_0x158c8d[_0x2682f3(0xcb)],_0x3c761a='';if(_0x158c8d[_0x2682f3(0xc1)]===_0x2682f3(0xcc))_0x3c761a=_0x2682f3(0x9f),_0x20d8a2='CAD',_0x2e6ae6='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x158c8d['amount']+'\x20'+_0x20d8a2+_0x2682f3(0xd1);else _0x158c8d[_0x2682f3(0xc1)]===_0x2682f3(0x96)&&(_0x3c761a=_0x2682f3(0xd0),_0x20d8a2=_0x2682f3(0xd3),_0x2e6ae6=_0x2682f3(0xa3)+_0x158c8d[_0x2682f3(0xb1)]+'\x20'+_0x20d8a2+_0x2682f3(0xd1));const _0x2cd309={'success':!![],'data':{'paymentId':_0x158c8d['id'],'gateway':_0x158c8d[_0x2682f3(0xc1)],'gatewayName':_0x158c8d[_0x2682f3(0xc1)]['toUpperCase'](),'transferType':_0x3c761a,'amount':_0x158c8d[_0x2682f3(0xb1)],'currency':_0x20d8a2,'status':_0x158c8d[_0x2682f3(0x88)],'instructions':_0x2e6ae6,'shopName':_0x158c8d[_0x2682f3(0xb3)]['name']||_0x158c8d[_0x2682f3(0xb3)][_0x2682f3(0xc6)],'hasProof':![],'proofType':null,'createdAt':_0x158c8d[_0x2682f3(0x80)],'updatedAt':_0x158c8d[_0x2682f3(0x7e)],'supportedFileTypes':['PNG','JPG',_0x2682f3(0x90),_0x2682f3(0xa2),_0x2682f3(0x9d)],'maxFileSize':_0x2682f3(0x73)}};_0x1483e6[_0x2682f3(0x7d)](_0x2cd309);}catch(_0x35adb8){console['error'](_0x2682f3(0x92),_0x35adb8),_0x1483e6[_0x2682f3(0x88)](0x1f4)[_0x2682f3(0x7d)]({'success':![],'error':_0x2682f3(0xbf),'details':_0x35adb8 instanceof Error?_0x35adb8[_0x2682f3(0x8b)]:_0x2682f3(0x9e)});}}}exports[a8_0x39cd54(0x82)]=ManualPaymentController,exports[a8_0x39cd54(0xc7)]=new ManualPaymentController();