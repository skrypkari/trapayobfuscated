'use strict';const a9_0x339e47=a9_0x4c4d;(function(_0x51ee0a,_0x295626){const _0x25b78c=a9_0x4c4d,_0x36b6ab=_0x51ee0a();while(!![]){try{const _0x3cc9e=-parseInt(_0x25b78c(0x20a))/0x1*(-parseInt(_0x25b78c(0x1db))/0x2)+-parseInt(_0x25b78c(0x1b5))/0x3+parseInt(_0x25b78c(0x203))/0x4*(-parseInt(_0x25b78c(0x1d2))/0x5)+-parseInt(_0x25b78c(0x1de))/0x6+-parseInt(_0x25b78c(0x1f3))/0x7*(parseInt(_0x25b78c(0x212))/0x8)+-parseInt(_0x25b78c(0x1c8))/0x9+-parseInt(_0x25b78c(0x1b7))/0xa*(-parseInt(_0x25b78c(0x1f5))/0xb);if(_0x3cc9e===_0x295626)break;else _0x36b6ab['push'](_0x36b6ab['shift']());}catch(_0x1f7771){_0x36b6ab['push'](_0x36b6ab['shift']());}}}(a9_0x9690,0xefbd2));function a9_0x9690(){const _0x18877f=['params','üìÅ\x20File:\x20','üîÑ\x20','15yhcSnt','connection','__esModule','üí≥\x20Payment\x20ID:\x20','replace','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','split','sendShopNotification','3826sPaavX','status','includes','5039592wLzaWa','message','from','PNG','jpeg','üåê\x20Customer\x20IP:\x20','üåê\x20Client\x20IP:\x20','Invalid\x20base64\x20file\x20data','gateway','Payment\x20ID\x20is\x20required','.\x20Supported:\x20','Markdown','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','JPEG','toUpperCase','üìã\x20Get\x20manual\x20payment\x20info:\x20','getManualPaymentInfo','unknown','Unsupported\x20file\x20type:\x20','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','\x20Payment\x20Proof\x20Received\x0a\x0a','5982788avhoUO','name','77NPtQCZ','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','currency','default','body','length','üì±\x20Admin\x20notification\x20and\x20file\x20sent','CAD','updatedAt','interac','\x20\x20\x20-\x20Payment\x20ID:\x20','jpg','heic','JPG','216648gpXvGG','pdf','PDF','../services/telegramBotService','Payment\x20proof\x20uploaded\x20successfully','update','toLowerCase','179UEsblq','SEPA\x20Bank\x20Transfer','findUnique','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','uploadPaymentProof','round','7867339505','sendDirectFile','16GbTmvl','üè™\x20Shop:\x20','Unknown\x20error','File\x20data\x20is\x20required','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','10MB','error','remoteAddress','ManualPaymentController','sepa','payment_proof_',',\x20size:\x20','telegramBotService','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','json','sendShopFile','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','üí∞\x20Amount:\x20','join','2116284kDEDlS','sendDirectMessage','8509790lVpqEq','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','‚ùå\x20Payment\x20not\x20found:\x20','EUR','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','log','png','shop','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','manualPaymentController','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','createdAt','amount','payment','Internal\x20server\x20error','Payment\x20not\x20found','17100864VYxnjG','‚ùå\x20Upload\x20payment\x20proof\x20error:','defineProperty','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','KB)\x0a','HEIC','shopId'];a9_0x9690=function(){return _0x18877f;};return a9_0x9690();}var __importDefault=this&&this['__importDefault']||function(_0x438fde){const _0x1c58f3=a9_0x4c4d;return _0x438fde&&_0x438fde[_0x1c58f3(0x1d4)]?_0x438fde:{'default':_0x438fde};};function a9_0x4c4d(_0x2acd3c,_0x281f49){_0x2acd3c=_0x2acd3c-0x1af;const _0x96907a=a9_0x9690();let _0x4c4dca=_0x96907a[_0x2acd3c];return _0x4c4dca;}Object[a9_0x339e47(0x1ca)](exports,a9_0x339e47(0x1d4),{'value':!![]}),exports['manualPaymentController']=exports[a9_0x339e47(0x21b)]=void 0x0;const database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a9_0x339e47(0x206));class ManualPaymentController{async[a9_0x339e47(0x20e)](_0xf58dfa,_0x3629bd){const _0x35d319=a9_0x339e47;try{const {paymentId:_0x5e2ca8,fileData:_0x4aeab6,fileType:_0x377040,fileName:_0x55820b}=_0xf58dfa[_0x35d319(0x1f9)],_0x30c3e2=_0xf58dfa['ip']||_0xf58dfa[_0x35d319(0x1d3)]?.[_0x35d319(0x21a)]||_0x35d319(0x1ef);console['log']('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x5e2ca8),console[_0x35d319(0x1bd)]('üìÅ\x20File\x20type:\x20'+_0x377040+_0x35d319(0x21e)+(_0x4aeab6?Math[_0x35d319(0x20f)](_0x4aeab6[_0x35d319(0x1fa)]*0.75/0x400):0x0)+'KB'),console[_0x35d319(0x1bd)](_0x35d319(0x1e4)+_0x30c3e2);if(!_0x5e2ca8){_0x3629bd['status'](0x190)[_0x35d319(0x1b0)]({'success':![],'error':_0x35d319(0x1e7)});return;}if(!_0x4aeab6){_0x3629bd[_0x35d319(0x1dc)](0x190)[_0x35d319(0x1b0)]({'success':![],'error':_0x35d319(0x215)});return;}if(!_0x377040){_0x3629bd[_0x35d319(0x1dc)](0x190)[_0x35d319(0x1b0)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x4ac96a=[_0x35d319(0x1be),_0x35d319(0x200),_0x35d319(0x1e2),_0x35d319(0x201),_0x35d319(0x204)],_0xb3569e=_0x377040[_0x35d319(0x209)]()[_0x35d319(0x1d6)]('.','');if(!_0x4ac96a[_0x35d319(0x1dd)](_0xb3569e)){_0x3629bd[_0x35d319(0x1dc)](0x190)['json']({'success':![],'error':_0x35d319(0x1f0)+_0x377040+_0x35d319(0x1e8)+_0x4ac96a[_0x35d319(0x1b4)](',\x20')});return;}const _0x4b0488=0xa*0x400*0x400;if(_0x4aeab6[_0x35d319(0x1fa)]>_0x4b0488){_0x3629bd[_0x35d319(0x1dc)](0x190)[_0x35d319(0x1b0)]({'success':![],'error':'File\x20too\x20large.\x20Maximum\x20size:\x2010MB'});return;}const _0x3e313d=await database_1['default']['payment'][_0x35d319(0x20c)]({'where':{'id':_0x5e2ca8},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3e313d){console[_0x35d319(0x1bd)](_0x35d319(0x1b9)+_0x5e2ca8),_0x3629bd[_0x35d319(0x1dc)](0x194)[_0x35d319(0x1b0)]({'success':![],'error':_0x35d319(0x1c7)});return;}if(_0x3e313d[_0x35d319(0x1e6)]!==_0x35d319(0x1fe)&&_0x3e313d[_0x35d319(0x1e6)]!==_0x35d319(0x21c)){console[_0x35d319(0x1bd)](_0x35d319(0x1ea)+_0x3e313d['gateway']),_0x3629bd[_0x35d319(0x1dc)](0x190)['json']({'success':![],'error':_0x35d319(0x1b8)+_0x3e313d[_0x35d319(0x1e6)]});return;}let _0x22663c=_0x4aeab6;_0x4aeab6[_0x35d319(0x1dd)](',')&&(_0x22663c=_0x4aeab6[_0x35d319(0x1d9)](',')[0x1]);try{Buffer[_0x35d319(0x1e0)](_0x22663c,'base64');}catch(_0x386af6){_0x3629bd[_0x35d319(0x1dc)](0x190)['json']({'success':![],'error':_0x35d319(0x1e5)});return;}const _0x5c76ec=await database_1['default'][_0x35d319(0x1c5)][_0x35d319(0x208)]({'where':{'id':_0x5e2ca8},'data':{'status':'PROCESSING','updatedAt':new Date()}});console[_0x35d319(0x1bd)](_0x35d319(0x217)),console[_0x35d319(0x1bd)](_0x35d319(0x1ff)+_0x5e2ca8),console[_0x35d319(0x1bd)]('\x20\x20\x20-\x20Gateway:\x20'+_0x3e313d[_0x35d319(0x1e6)][_0x35d319(0x1ec)]()),console['log']('\x20\x20\x20-\x20File\x20type:\x20'+_0xb3569e),console[_0x35d319(0x1bd)]('\x20\x20\x20-\x20File\x20size:\x20'+Math[_0x35d319(0x20f)](_0x22663c[_0x35d319(0x1fa)]*0.75/0x400)+'KB'),console[_0x35d319(0x1bd)](_0x35d319(0x1bc));try{const _0xdd6cd1=_0x3e313d['gateway'][_0x35d319(0x1ec)](),_0x230f39=_0x3e313d[_0x35d319(0x1bf)][_0x35d319(0x1f4)]||_0x3e313d['shop']['username'],_0x4f2610=Math[_0x35d319(0x20f)](_0x22663c[_0x35d319(0x1fa)]*0.75/0x400),_0x97bbe2='üîÑ\x20'+_0xdd6cd1+_0x35d319(0x1f2)+('üí≥\x20Payment\x20ID:\x20'+_0x5e2ca8+'\x0a')+(_0x35d319(0x1b3)+_0x3e313d[_0x35d319(0x1c4)]+'\x20'+_0x3e313d[_0x35d319(0x1f7)]+'\x0a')+(_0x35d319(0x1d0)+_0xb3569e[_0x35d319(0x1ec)]()+'\x20('+_0x4f2610+_0x35d319(0x1cc))+_0x35d319(0x1f6)+(_0x35d319(0x1e3)+_0x30c3e2+'\x0a\x0a')+_0x35d319(0x1af);await telegramBotService_1['telegramBotService'][_0x35d319(0x1da)](_0x3e313d[_0x35d319(0x1ce)],_0x97bbe2,{'parse_mode':_0x35d319(0x1e9)});const _0x4fd57d=Buffer[_0x35d319(0x1e0)](_0x22663c,'base64'),_0x4f06f5=_0x35d319(0x21d)+_0x5e2ca8+'.'+_0xb3569e;await telegramBotService_1[_0x35d319(0x21f)][_0x35d319(0x1b1)](_0x3e313d[_0x35d319(0x1ce)],_0x4fd57d,_0x4f06f5,'Payment\x20proof\x20for\x20'+_0x5e2ca8),console[_0x35d319(0x1bd)](_0x35d319(0x1c2));const _0x2d0a46=_0x35d319(0x210),_0x31f829=_0x35d319(0x1d1)+_0xdd6cd1+_0x35d319(0x216)+(_0x35d319(0x1d5)+_0x5e2ca8+'\x0a')+(_0x35d319(0x213)+_0x230f39+'\x0a')+(_0x35d319(0x1b3)+_0x3e313d[_0x35d319(0x1c4)]+'\x20'+_0x3e313d['currency']+'\x0a')+('üìÅ\x20File:\x20'+_0xb3569e[_0x35d319(0x1ec)]()+'\x20('+_0x4f2610+_0x35d319(0x1cc))+_0x35d319(0x1f6)+('üåê\x20Customer\x20IP:\x20'+_0x30c3e2+'\x0a\x0a')+_0x35d319(0x1d8);await telegramBotService_1[_0x35d319(0x21f)][_0x35d319(0x1b6)](parseInt(_0x2d0a46),_0x31f829),await telegramBotService_1[_0x35d319(0x21f)][_0x35d319(0x211)](parseInt(_0x2d0a46),_0x4fd57d,_0x4f06f5,_0x35d319(0x1d7)+_0x5e2ca8),console['log'](_0x35d319(0x1fb));}catch(_0xdc4dfe){console[_0x35d319(0x219)](_0x35d319(0x1c0),_0xdc4dfe);}_0x3629bd[_0x35d319(0x1b0)]({'success':!![],'message':_0x35d319(0x207),'data':{'paymentId':_0x5c76ec['id'],'status':_0x5c76ec[_0x35d319(0x1dc)],'gateway':_0x3e313d[_0x35d319(0x1e6)],'fileType':_0xb3569e,'fileSize':Math[_0x35d319(0x20f)](_0x22663c[_0x35d319(0x1fa)]*0.75/0x400)+'KB','uploadedAt':_0x5c76ec['updatedAt']}});}catch(_0x2cea7f){console['error'](_0x35d319(0x1c9),_0x2cea7f),_0x3629bd['status'](0x1f4)[_0x35d319(0x1b0)]({'success':![],'error':'Internal\x20server\x20error','details':_0x2cea7f instanceof Error?_0x2cea7f[_0x35d319(0x1df)]:_0x35d319(0x214)});}}async[a9_0x339e47(0x1ee)](_0xff8981,_0x4d5866){const _0xa9e0aa=a9_0x339e47;try{const {paymentId:_0x1c5edf}=_0xff8981[_0xa9e0aa(0x1cf)];console[_0xa9e0aa(0x1bd)](_0xa9e0aa(0x1ed)+_0x1c5edf);const _0x13fb8f=await database_1[_0xa9e0aa(0x1f8)][_0xa9e0aa(0x1c5)][_0xa9e0aa(0x20c)]({'where':{'id':_0x1c5edf},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x13fb8f){_0x4d5866[_0xa9e0aa(0x1dc)](0x194)[_0xa9e0aa(0x1b0)]({'success':![],'error':_0xa9e0aa(0x1c7)});return;}if(_0x13fb8f[_0xa9e0aa(0x1e6)]!=='interac'&&_0x13fb8f[_0xa9e0aa(0x1e6)]!=='sepa'){_0x4d5866[_0xa9e0aa(0x1dc)](0x190)['json']({'success':![],'error':_0xa9e0aa(0x1cb)+_0x13fb8f[_0xa9e0aa(0x1e6)]});return;}let _0x129e28='',_0x14e89d=_0x13fb8f[_0xa9e0aa(0x1f7)],_0x5ca0b6='';if(_0x13fb8f[_0xa9e0aa(0x1e6)]==='interac')_0x5ca0b6='Interac\x20e-Transfer',_0x14e89d=_0xa9e0aa(0x1fc),_0x129e28=_0xa9e0aa(0x1b2)+_0x13fb8f['amount']+'\x20'+_0x14e89d+_0xa9e0aa(0x1bb);else _0x13fb8f[_0xa9e0aa(0x1e6)]==='sepa'&&(_0x5ca0b6=_0xa9e0aa(0x20b),_0x14e89d=_0xa9e0aa(0x1ba),_0x129e28=_0xa9e0aa(0x20d)+_0x13fb8f[_0xa9e0aa(0x1c4)]+'\x20'+_0x14e89d+_0xa9e0aa(0x1bb));const _0x206a1f={'success':!![],'data':{'paymentId':_0x13fb8f['id'],'gateway':_0x13fb8f[_0xa9e0aa(0x1e6)],'gatewayName':_0x13fb8f[_0xa9e0aa(0x1e6)]['toUpperCase'](),'transferType':_0x5ca0b6,'amount':_0x13fb8f[_0xa9e0aa(0x1c4)],'currency':_0x14e89d,'status':_0x13fb8f[_0xa9e0aa(0x1dc)],'instructions':_0x129e28,'shopName':_0x13fb8f[_0xa9e0aa(0x1bf)]['name']||_0x13fb8f[_0xa9e0aa(0x1bf)]['username'],'hasProof':![],'proofType':null,'createdAt':_0x13fb8f[_0xa9e0aa(0x1c3)],'updatedAt':_0x13fb8f[_0xa9e0aa(0x1fd)],'supportedFileTypes':[_0xa9e0aa(0x1e1),_0xa9e0aa(0x202),_0xa9e0aa(0x1eb),_0xa9e0aa(0x1cd),_0xa9e0aa(0x205)],'maxFileSize':_0xa9e0aa(0x218)}};_0x4d5866['json'](_0x206a1f);}catch(_0x5eb1bf){console[_0xa9e0aa(0x219)](_0xa9e0aa(0x1f1),_0x5eb1bf),_0x4d5866[_0xa9e0aa(0x1dc)](0x1f4)[_0xa9e0aa(0x1b0)]({'success':![],'error':_0xa9e0aa(0x1c6),'details':_0x5eb1bf instanceof Error?_0x5eb1bf['message']:'Unknown\x20error'});}}}exports[a9_0x339e47(0x21b)]=ManualPaymentController,exports[a9_0x339e47(0x1c1)]=new ManualPaymentController();