'use strict';const a8_0x1710f7=a8_0x2c68;(function(_0x5aea2a,_0x4e7beb){const _0x1f7e47=a8_0x2c68,_0x431a11=_0x5aea2a();while(!![]){try{const _0x1ead8e=parseInt(_0x1f7e47(0x10f))/0x1+parseInt(_0x1f7e47(0xdb))/0x2+-parseInt(_0x1f7e47(0xd5))/0x3+parseInt(_0x1f7e47(0x11b))/0x4*(-parseInt(_0x1f7e47(0x10a))/0x5)+parseInt(_0x1f7e47(0xcb))/0x6+parseInt(_0x1f7e47(0xfc))/0x7*(-parseInt(_0x1f7e47(0x100))/0x8)+parseInt(_0x1f7e47(0x11d))/0x9*(parseInt(_0x1f7e47(0xe8))/0xa);if(_0x1ead8e===_0x4e7beb)break;else _0x431a11['push'](_0x431a11['shift']());}catch(_0x1ab291){_0x431a11['push'](_0x431a11['shift']());}}}(a8_0x5771,0xa78ae));var __importDefault=this&&this['__importDefault']||function(_0x6717e0){return _0x6717e0&&_0x6717e0['__esModule']?_0x6717e0:{'default':_0x6717e0};};function a8_0x5771(){const _0x117b5a=['2947398ADyhZi','sepa','../services/telegramBotService','payment','png','PROCESSING','1247158dTQlZX','telegramBotService','jpeg','createdAt','amount','Unsupported\x20file\x20type:\x20','Markdown','status','default','10MB','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','üîÑ\x20','gateway','6136730kDTjWK','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','sendShopNotification','from','\x20\x20\x20-\x20File\x20size:\x20','jpg','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','includes','params','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','EUR','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','Payment\x20not\x20found','toUpperCase','File\x20type\x20is\x20required','\x20\x20\x20-\x20File\x20type:\x20','error','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','uploadPaymentProof','sendDirectFile','6951QfLeVG','length','Payment\x20proof\x20uploaded\x20successfully','sendShopFile','10856tbmDoF','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','KB)\x0a','shopId',',\x20size:\x20','currency','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','üí∞\x20Amount:\x20','Payment\x20ID\x20is\x20required','manualPaymentController','91535CUXgJl','HEIC','PNG','Unknown\x20error','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','1164301CnVNjC','json','round','Internal\x20server\x20error','üìã\x20Get\x20manual\x20payment\x20info:\x20','PDF','interac','Invalid\x20base64\x20file\x20data','sendDirectMessage','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','payment_proof_','join','32tzbcTB','.\x20Supported:\x20','9UdMUst','pdf','üìÅ\x20File\x20type:\x20','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','\x20Payment\x20Proof\x20Received\x0a\x0a','‚ùå\x20Payment\x20not\x20found:\x20','üí≥\x20Payment\x20ID:\x20','replace','message','JPG','CAD','../config/database','updatedAt','üåê\x20Client\x20IP:\x20','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','__esModule','7867339505','shop','log','toLowerCase','connection','heic','4566744GMRlDb','base64','üìÅ\x20File:\x20','SEPA\x20Bank\x20Transfer','ManualPaymentController','split','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','üåê\x20Customer\x20IP:\x20','Interac\x20e-Transfer','remoteAddress'];a8_0x5771=function(){return _0x117b5a;};return a8_0x5771();}function a8_0x2c68(_0x1b8151,_0x55618c){const _0x577168=a8_0x5771();return a8_0x2c68=function(_0x2c68c6,_0xc4340){_0x2c68c6=_0x2c68c6-0xc4;let _0xe2cbc9=_0x577168[_0x2c68c6];return _0xe2cbc9;},a8_0x2c68(_0x1b8151,_0x55618c);}Object['defineProperty'](exports,a8_0x1710f7(0xc4),{'value':!![]}),exports['manualPaymentController']=exports[a8_0x1710f7(0xcf)]=void 0x0;const database_1=__importDefault(require(a8_0x1710f7(0x129))),telegramBotService_1=require(a8_0x1710f7(0xd7));class ManualPaymentController{async[a8_0x1710f7(0xfa)](_0x27c250,_0x58990a){const _0x2dff85=a8_0x1710f7;try{const {paymentId:_0x1e0c05,fileData:_0x7d8858,fileType:_0x1bf5a7,fileName:_0x85e26}=_0x27c250['body'],_0x38f03e=_0x27c250['ip']||_0x27c250[_0x2dff85(0xc9)]?.[_0x2dff85(0xd4)]||'unknown';console['log'](_0x2dff85(0x10e)+_0x1e0c05),console[_0x2dff85(0xc7)](_0x2dff85(0x11f)+_0x1bf5a7+_0x2dff85(0x104)+(_0x7d8858?Math[_0x2dff85(0x111)](_0x7d8858[_0x2dff85(0xfd)]*0.75/0x400):0x0)+'KB'),console['log'](_0x2dff85(0x12b)+_0x38f03e);if(!_0x1e0c05){_0x58990a[_0x2dff85(0xe2)](0x190)['json']({'success':![],'error':_0x2dff85(0x108)});return;}if(!_0x7d8858){_0x58990a[_0x2dff85(0xe2)](0x190)[_0x2dff85(0x110)]({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x1bf5a7){_0x58990a[_0x2dff85(0xe2)](0x190)['json']({'success':![],'error':_0x2dff85(0xf6)});return;}const _0x3968f8=[_0x2dff85(0xd9),_0x2dff85(0xed),_0x2dff85(0xdd),_0x2dff85(0xca),_0x2dff85(0x11e)],_0x343a21=_0x1bf5a7[_0x2dff85(0xc8)]()[_0x2dff85(0x125)]('.','');if(!_0x3968f8[_0x2dff85(0xef)](_0x343a21)){_0x58990a[_0x2dff85(0xe2)](0x190)[_0x2dff85(0x110)]({'success':![],'error':_0x2dff85(0xe0)+_0x1bf5a7+_0x2dff85(0x11c)+_0x3968f8[_0x2dff85(0x11a)](',\x20')});return;}const _0x23ece7=0xa*0x400*0x400;if(_0x7d8858[_0x2dff85(0xfd)]>_0x23ece7){_0x58990a[_0x2dff85(0xe2)](0x190)[_0x2dff85(0x110)]({'success':![],'error':'File\x20too\x20large.\x20Maximum\x20size:\x2010MB'});return;}const _0x58be8a=await database_1[_0x2dff85(0xe3)][_0x2dff85(0xd8)]['findUnique']({'where':{'id':_0x1e0c05},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x58be8a){console[_0x2dff85(0xc7)](_0x2dff85(0x123)+_0x1e0c05),_0x58990a[_0x2dff85(0xe2)](0x194)[_0x2dff85(0x110)]({'success':![],'error':_0x2dff85(0xf4)});return;}if(_0x58be8a[_0x2dff85(0xe7)]!==_0x2dff85(0x115)&&_0x58be8a[_0x2dff85(0xe7)]!==_0x2dff85(0xd6)){console['log'](_0x2dff85(0x121)+_0x58be8a[_0x2dff85(0xe7)]),_0x58990a[_0x2dff85(0xe2)](0x190)['json']({'success':![],'error':_0x2dff85(0x12c)+_0x58be8a[_0x2dff85(0xe7)]});return;}let _0x223d63=_0x7d8858;_0x7d8858[_0x2dff85(0xef)](',')&&(_0x223d63=_0x7d8858[_0x2dff85(0xd0)](',')[0x1]);try{Buffer[_0x2dff85(0xeb)](_0x223d63,_0x2dff85(0xcc));}catch(_0x2cac89){_0x58990a[_0x2dff85(0xe2)](0x190)['json']({'success':![],'error':_0x2dff85(0x116)});return;}const _0x38e8e2=await database_1[_0x2dff85(0xe3)][_0x2dff85(0xd8)]['update']({'where':{'id':_0x1e0c05},'data':{'status':_0x2dff85(0xda),'updatedAt':new Date()}});console[_0x2dff85(0xc7)](_0x2dff85(0xf9)),console[_0x2dff85(0xc7)]('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x1e0c05),console['log']('\x20\x20\x20-\x20Gateway:\x20'+_0x58be8a[_0x2dff85(0xe7)]['toUpperCase']()),console[_0x2dff85(0xc7)](_0x2dff85(0xf7)+_0x343a21),console[_0x2dff85(0xc7)](_0x2dff85(0xec)+Math[_0x2dff85(0x111)](_0x223d63[_0x2dff85(0xfd)]*0.75/0x400)+'KB'),console[_0x2dff85(0xc7)](_0x2dff85(0x101));try{const _0x18cceb=_0x58be8a[_0x2dff85(0xe7)]['toUpperCase'](),_0x342cc5=_0x58be8a[_0x2dff85(0xc6)]['name']||_0x58be8a['shop']['username'],_0x325901=Math['round'](_0x223d63['length']*0.75/0x400),_0x40666a='üîÑ\x20'+_0x18cceb+_0x2dff85(0x122)+(_0x2dff85(0x124)+_0x1e0c05+'\x0a')+(_0x2dff85(0x107)+_0x58be8a[_0x2dff85(0xdf)]+'\x20'+_0x58be8a[_0x2dff85(0x105)]+'\x0a')+(_0x2dff85(0xcd)+_0x343a21['toUpperCase']()+'\x20('+_0x325901+_0x2dff85(0x102))+_0x2dff85(0xee)+(_0x2dff85(0xd2)+_0x38f03e+'\x0a\x0a')+_0x2dff85(0xe9);await telegramBotService_1[_0x2dff85(0xdc)][_0x2dff85(0xea)](_0x58be8a[_0x2dff85(0x103)],_0x40666a,{'parse_mode':_0x2dff85(0xe1)});const _0x2327e4=Buffer[_0x2dff85(0xeb)](_0x223d63,_0x2dff85(0xcc)),_0x5d859a=_0x2dff85(0x119)+_0x1e0c05+'.'+_0x343a21;await telegramBotService_1[_0x2dff85(0xdc)][_0x2dff85(0xff)](_0x58be8a[_0x2dff85(0x103)],_0x2327e4,_0x5d859a,'Payment\x20proof\x20for\x20'+_0x1e0c05),console['log']('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x52fc5f=_0x2dff85(0xc5),_0x5059d3=_0x2dff85(0xe6)+_0x18cceb+_0x2dff85(0x106)+(_0x2dff85(0x124)+_0x1e0c05+'\x0a')+('üè™\x20Shop:\x20'+_0x342cc5+'\x0a')+(_0x2dff85(0x107)+_0x58be8a['amount']+'\x20'+_0x58be8a[_0x2dff85(0x105)]+'\x0a')+(_0x2dff85(0xcd)+_0x343a21[_0x2dff85(0xf5)]()+'\x20('+_0x325901+_0x2dff85(0x102))+_0x2dff85(0xee)+('üåê\x20Customer\x20IP:\x20'+_0x38f03e+'\x0a\x0a')+_0x2dff85(0xf1);await telegramBotService_1['telegramBotService'][_0x2dff85(0x117)](parseInt(_0x52fc5f),_0x5059d3),await telegramBotService_1[_0x2dff85(0xdc)][_0x2dff85(0xfb)](parseInt(_0x52fc5f),_0x2327e4,_0x5d859a,_0x2dff85(0xd1)+_0x1e0c05),console[_0x2dff85(0xc7)]('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x18cffd){console['error'](_0x2dff85(0x120),_0x18cffd);}_0x58990a['json']({'success':!![],'message':_0x2dff85(0xfe),'data':{'paymentId':_0x38e8e2['id'],'status':_0x38e8e2[_0x2dff85(0xe2)],'gateway':_0x58be8a[_0x2dff85(0xe7)],'fileType':_0x343a21,'fileSize':Math[_0x2dff85(0x111)](_0x223d63[_0x2dff85(0xfd)]*0.75/0x400)+'KB','uploadedAt':_0x38e8e2[_0x2dff85(0x12a)]}});}catch(_0x359644){console['error']('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x359644),_0x58990a['status'](0x1f4)[_0x2dff85(0x110)]({'success':![],'error':_0x2dff85(0x112),'details':_0x359644 instanceof Error?_0x359644[_0x2dff85(0x126)]:_0x2dff85(0x10d)});}}async['getManualPaymentInfo'](_0x35d2d8,_0x55e4cc){const _0x4d2985=a8_0x1710f7;try{const {paymentId:_0x3800de}=_0x35d2d8[_0x4d2985(0xf0)];console['log'](_0x4d2985(0x113)+_0x3800de);const _0x54e4b5=await database_1[_0x4d2985(0xe3)]['payment']['findUnique']({'where':{'id':_0x3800de},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x54e4b5){_0x55e4cc[_0x4d2985(0xe2)](0x194)[_0x4d2985(0x110)]({'success':![],'error':_0x4d2985(0xf4)});return;}if(_0x54e4b5['gateway']!=='interac'&&_0x54e4b5['gateway']!==_0x4d2985(0xd6)){_0x55e4cc[_0x4d2985(0xe2)](0x190)[_0x4d2985(0x110)]({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x54e4b5[_0x4d2985(0xe7)]});return;}let _0x446c6e='',_0x489aa2=_0x54e4b5[_0x4d2985(0x105)],_0x44c3db='';if(_0x54e4b5['gateway']===_0x4d2985(0x115))_0x44c3db=_0x4d2985(0xd3),_0x489aa2=_0x4d2985(0x128),_0x446c6e=_0x4d2985(0xe5)+_0x54e4b5[_0x4d2985(0xdf)]+'\x20'+_0x489aa2+_0x4d2985(0xf3);else _0x54e4b5[_0x4d2985(0xe7)]==='sepa'&&(_0x44c3db=_0x4d2985(0xce),_0x489aa2=_0x4d2985(0xf2),_0x446c6e='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x54e4b5[_0x4d2985(0xdf)]+'\x20'+_0x489aa2+_0x4d2985(0xf3));const _0x311c18={'success':!![],'data':{'paymentId':_0x54e4b5['id'],'gateway':_0x54e4b5[_0x4d2985(0xe7)],'gatewayName':_0x54e4b5[_0x4d2985(0xe7)][_0x4d2985(0xf5)](),'transferType':_0x44c3db,'amount':_0x54e4b5[_0x4d2985(0xdf)],'currency':_0x489aa2,'status':_0x54e4b5[_0x4d2985(0xe2)],'instructions':_0x446c6e,'shopName':_0x54e4b5[_0x4d2985(0xc6)]['name']||_0x54e4b5[_0x4d2985(0xc6)]['username'],'hasProof':![],'proofType':null,'createdAt':_0x54e4b5[_0x4d2985(0xde)],'updatedAt':_0x54e4b5['updatedAt'],'supportedFileTypes':[_0x4d2985(0x10c),_0x4d2985(0x127),'JPEG',_0x4d2985(0x10b),_0x4d2985(0x114)],'maxFileSize':_0x4d2985(0xe4)}};_0x55e4cc['json'](_0x311c18);}catch(_0x39154f){console[_0x4d2985(0xf8)](_0x4d2985(0x118),_0x39154f),_0x55e4cc[_0x4d2985(0xe2)](0x1f4)[_0x4d2985(0x110)]({'success':![],'error':_0x4d2985(0x112),'details':_0x39154f instanceof Error?_0x39154f[_0x4d2985(0x126)]:_0x4d2985(0x10d)});}}}exports[a8_0x1710f7(0xcf)]=ManualPaymentController,exports[a8_0x1710f7(0x109)]=new ManualPaymentController();