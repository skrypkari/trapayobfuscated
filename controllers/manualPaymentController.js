'use strict';const a8_0x2de733=a8_0x107e;(function(_0x4436d3,_0x3370cc){const _0x5c4b4d=a8_0x107e,_0x175ff4=_0x4436d3();while(!![]){try{const _0x92a215=-parseInt(_0x5c4b4d(0x195))/0x1*(-parseInt(_0x5c4b4d(0x1ae))/0x2)+parseInt(_0x5c4b4d(0x19d))/0x3+parseInt(_0x5c4b4d(0x1a5))/0x4*(-parseInt(_0x5c4b4d(0x1e9))/0x5)+-parseInt(_0x5c4b4d(0x1e4))/0x6+parseInt(_0x5c4b4d(0x198))/0x7+-parseInt(_0x5c4b4d(0x1d4))/0x8*(-parseInt(_0x5c4b4d(0x193))/0x9)+parseInt(_0x5c4b4d(0x1a7))/0xa;if(_0x92a215===_0x3370cc)break;else _0x175ff4['push'](_0x175ff4['shift']());}catch(_0x3f0398){_0x175ff4['push'](_0x175ff4['shift']());}}}(a8_0x4527,0x3ed2a));function a8_0x4527(){const _0x2d7448=['replace','telegramBotService','pdf','555042hRSuOx','sendShopFile','amount','\x20\x20\x20-\x20File\x20type:\x20','remoteAddress','2488015CMAiLA','\x20Payment\x20Proof\x20Received\x0a\x0a','üåê\x20Customer\x20IP:\x20','shop','jpeg','EUR','PNG','File\x20type\x20is\x20required','params','sendDirectMessage','CAD','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','../config/database','../services/telegramBotService','JPG','error','payment','gateway','username','Unknown\x20error','549JlvhJv','10MB','176185ktTzUu','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','round','112980TpFruU','üìÅ\x20File:\x20','üìã\x20Get\x20manual\x20payment\x20info:\x20','length','\x20\x20\x20-\x20Gateway:\x20','390363fRRUZC','üí∞\x20Amount:\x20','Payment\x20not\x20found','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','sepa','sendShopNotification','message','toUpperCase','4WdPjqZ','Payment\x20proof\x20uploaded\x20successfully','4463570oLmrhq','toLowerCase','default','Payment\x20proof\x20for\x20','createdAt','üîÑ\x20','updatedAt','2icXLZq','uploadPaymentProof','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','HEIC','log','Unsupported\x20file\x20type:\x20','üåê\x20Client\x20IP:\x20','name','üí≥\x20Payment\x20ID:\x20','ManualPaymentController','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','join','__esModule','‚ùå\x20Upload\x20payment\x20proof\x20error:','split','PROCESSING','defineProperty','Markdown','JPEG','payment_proof_','interac','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','üì±\x20Admin\x20notification\x20and\x20file\x20sent','\x20\x20\x20-\x20File\x20size:\x20','manualPaymentController','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','jpg','png','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','findUnique','json','PDF','from','File\x20data\x20is\x20required','status','10312rFqXZY','update','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','‚ùå\x20Payment\x20not\x20found:\x20','base64','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','Internal\x20server\x20error','Interac\x20e-Transfer','üè™\x20Shop:\x20','7867339505','currency','includes','KB)\x0a'];a8_0x4527=function(){return _0x2d7448;};return a8_0x4527();}var __importDefault=this&&this['__importDefault']||function(_0x4ee03f){const _0x9471e5=a8_0x107e;return _0x4ee03f&&_0x4ee03f[_0x9471e5(0x1bc)]?_0x4ee03f:{'default':_0x4ee03f};};Object[a8_0x2de733(0x1c0)](exports,a8_0x2de733(0x1bc),{'value':!![]}),exports[a8_0x2de733(0x1c8)]=exports[a8_0x2de733(0x1b9)]=void 0x0;function a8_0x107e(_0x32ba75,_0x4d30ed){const _0x452716=a8_0x4527();return a8_0x107e=function(_0x107ee6,_0x32fa44){_0x107ee6=_0x107ee6-0x183;let _0x3eec8a=_0x452716[_0x107ee6];return _0x3eec8a;},a8_0x107e(_0x32ba75,_0x4d30ed);}const database_1=__importDefault(require(a8_0x2de733(0x18b))),telegramBotService_1=require(a8_0x2de733(0x18c));class ManualPaymentController{async[a8_0x2de733(0x1af)](_0x3ddd0c,_0x590315){const _0x212ebb=a8_0x2de733;try{const {paymentId:_0x3f912f,fileData:_0x59bc8d,fileType:_0x56b4fa,fileName:_0x260a8e}=_0x3ddd0c['body'],_0x29614b=_0x3ddd0c['ip']||_0x3ddd0c['connection']?.[_0x212ebb(0x1e8)]||'unknown';console[_0x212ebb(0x1b4)](_0x212ebb(0x1c9)+_0x3f912f),console[_0x212ebb(0x1b4)]('üìÅ\x20File\x20type:\x20'+_0x56b4fa+',\x20size:\x20'+(_0x59bc8d?Math['round'](_0x59bc8d[_0x212ebb(0x19b)]*0.75/0x400):0x0)+'KB'),console['log'](_0x212ebb(0x1b6)+_0x29614b);if(!_0x3f912f){_0x590315[_0x212ebb(0x1d3)](0x190)['json']({'success':![],'error':'Payment\x20ID\x20is\x20required'});return;}if(!_0x59bc8d){_0x590315[_0x212ebb(0x1d3)](0x190)[_0x212ebb(0x1cf)]({'success':![],'error':_0x212ebb(0x1d2)});return;}if(!_0x56b4fa){_0x590315[_0x212ebb(0x1d3)](0x190)[_0x212ebb(0x1cf)]({'success':![],'error':_0x212ebb(0x186)});return;}const _0x52b160=[_0x212ebb(0x1cb),_0x212ebb(0x1ca),_0x212ebb(0x183),'heic',_0x212ebb(0x1e3)],_0x598fcc=_0x56b4fa[_0x212ebb(0x1a8)]()[_0x212ebb(0x1e1)]('.','');if(!_0x52b160[_0x212ebb(0x1df)](_0x598fcc)){_0x590315[_0x212ebb(0x1d3)](0x190)[_0x212ebb(0x1cf)]({'success':![],'error':_0x212ebb(0x1b5)+_0x56b4fa+'.\x20Supported:\x20'+_0x52b160[_0x212ebb(0x1bb)](',\x20')});return;}const _0x7ef078=0xa*0x400*0x400;if(_0x59bc8d[_0x212ebb(0x19b)]>_0x7ef078){_0x590315[_0x212ebb(0x1d3)](0x190)['json']({'success':![],'error':_0x212ebb(0x1d6)});return;}const _0x39d89a=await database_1['default']['payment'][_0x212ebb(0x1ce)]({'where':{'id':_0x3f912f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x39d89a){console[_0x212ebb(0x1b4)](_0x212ebb(0x1d7)+_0x3f912f),_0x590315[_0x212ebb(0x1d3)](0x194)[_0x212ebb(0x1cf)]({'success':![],'error':_0x212ebb(0x19f)});return;}if(_0x39d89a['gateway']!==_0x212ebb(0x1c4)&&_0x39d89a[_0x212ebb(0x190)]!=='sepa'){console[_0x212ebb(0x1b4)](_0x212ebb(0x1b1)+_0x39d89a[_0x212ebb(0x190)]),_0x590315[_0x212ebb(0x1d3)](0x190)[_0x212ebb(0x1cf)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x39d89a['gateway']});return;}let _0x562e72=_0x59bc8d;_0x59bc8d[_0x212ebb(0x1df)](',')&&(_0x562e72=_0x59bc8d[_0x212ebb(0x1be)](',')[0x1]);try{Buffer[_0x212ebb(0x1d1)](_0x562e72,'base64');}catch(_0x358a38){_0x590315['status'](0x190)[_0x212ebb(0x1cf)]({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x1d334f=await database_1[_0x212ebb(0x1a9)]['payment'][_0x212ebb(0x1d5)]({'where':{'id':_0x3f912f},'data':{'status':_0x212ebb(0x1bf),'updatedAt':new Date()}});console[_0x212ebb(0x1b4)](_0x212ebb(0x1ba)),console[_0x212ebb(0x1b4)]('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x3f912f),console[_0x212ebb(0x1b4)](_0x212ebb(0x19c)+_0x39d89a['gateway'][_0x212ebb(0x1a4)]()),console['log'](_0x212ebb(0x1e7)+_0x598fcc),console['log'](_0x212ebb(0x1c7)+Math[_0x212ebb(0x197)](_0x562e72[_0x212ebb(0x19b)]*0.75/0x400)+'KB'),console[_0x212ebb(0x1b4)](_0x212ebb(0x1cc));try{const _0x88d733=_0x39d89a[_0x212ebb(0x190)][_0x212ebb(0x1a4)](),_0x252423=_0x39d89a[_0x212ebb(0x1ec)]['name']||_0x39d89a[_0x212ebb(0x1ec)][_0x212ebb(0x191)],_0x20bc28=Math[_0x212ebb(0x197)](_0x562e72[_0x212ebb(0x19b)]*0.75/0x400),_0x2189d9=_0x212ebb(0x1ac)+_0x88d733+_0x212ebb(0x1ea)+(_0x212ebb(0x1b8)+_0x3f912f+'\x0a')+('üí∞\x20Amount:\x20'+_0x39d89a[_0x212ebb(0x1e6)]+'\x20'+_0x39d89a[_0x212ebb(0x1de)]+'\x0a')+(_0x212ebb(0x199)+_0x598fcc[_0x212ebb(0x1a4)]()+'\x20('+_0x20bc28+_0x212ebb(0x1e0))+_0x212ebb(0x1cd)+(_0x212ebb(0x1eb)+_0x29614b+'\x0a\x0a')+_0x212ebb(0x18a);await telegramBotService_1[_0x212ebb(0x1e2)][_0x212ebb(0x1a2)](_0x39d89a['shopId'],_0x2189d9,{'parse_mode':_0x212ebb(0x1c1)});const _0x97e2e5=Buffer[_0x212ebb(0x1d1)](_0x562e72,_0x212ebb(0x1d8)),_0x4a99e8=_0x212ebb(0x1c3)+_0x3f912f+'.'+_0x598fcc;await telegramBotService_1[_0x212ebb(0x1e2)][_0x212ebb(0x1e5)](_0x39d89a['shopId'],_0x97e2e5,_0x4a99e8,_0x212ebb(0x1aa)+_0x3f912f),console['log'](_0x212ebb(0x1d9));const _0x4fab23=_0x212ebb(0x1dd),_0x266f86='üîÑ\x20'+_0x88d733+_0x212ebb(0x1c5)+(_0x212ebb(0x1b8)+_0x3f912f+'\x0a')+(_0x212ebb(0x1dc)+_0x252423+'\x0a')+(_0x212ebb(0x19e)+_0x39d89a[_0x212ebb(0x1e6)]+'\x20'+_0x39d89a[_0x212ebb(0x1de)]+'\x0a')+(_0x212ebb(0x199)+_0x598fcc['toUpperCase']()+'\x20('+_0x20bc28+_0x212ebb(0x1e0))+_0x212ebb(0x1cd)+(_0x212ebb(0x1eb)+_0x29614b+'\x0a\x0a')+'‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.';await telegramBotService_1[_0x212ebb(0x1e2)][_0x212ebb(0x188)](parseInt(_0x4fab23),_0x266f86),await telegramBotService_1['telegramBotService']['sendDirectFile'](parseInt(_0x4fab23),_0x97e2e5,_0x4a99e8,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x3f912f),console['log'](_0x212ebb(0x1c6));}catch(_0x20a7df){console[_0x212ebb(0x18e)](_0x212ebb(0x196),_0x20a7df);}_0x590315[_0x212ebb(0x1cf)]({'success':!![],'message':_0x212ebb(0x1a6),'data':{'paymentId':_0x1d334f['id'],'status':_0x1d334f[_0x212ebb(0x1d3)],'gateway':_0x39d89a[_0x212ebb(0x190)],'fileType':_0x598fcc,'fileSize':Math[_0x212ebb(0x197)](_0x562e72[_0x212ebb(0x19b)]*0.75/0x400)+'KB','uploadedAt':_0x1d334f[_0x212ebb(0x1ad)]}});}catch(_0x4ac21a){console[_0x212ebb(0x18e)](_0x212ebb(0x1bd),_0x4ac21a),_0x590315['status'](0x1f4)[_0x212ebb(0x1cf)]({'success':![],'error':'Internal\x20server\x20error','details':_0x4ac21a instanceof Error?_0x4ac21a[_0x212ebb(0x1a3)]:'Unknown\x20error'});}}async['getManualPaymentInfo'](_0x2973b2,_0x51f2f0){const _0x290233=a8_0x2de733;try{const {paymentId:_0x2dc5a4}=_0x2973b2[_0x290233(0x187)];console['log'](_0x290233(0x19a)+_0x2dc5a4);const _0x4bff23=await database_1[_0x290233(0x1a9)][_0x290233(0x18f)][_0x290233(0x1ce)]({'where':{'id':_0x2dc5a4},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4bff23){_0x51f2f0[_0x290233(0x1d3)](0x194)[_0x290233(0x1cf)]({'success':![],'error':_0x290233(0x19f)});return;}if(_0x4bff23[_0x290233(0x190)]!=='interac'&&_0x4bff23[_0x290233(0x190)]!==_0x290233(0x1a1)){_0x51f2f0[_0x290233(0x1d3)](0x190)['json']({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x4bff23[_0x290233(0x190)]});return;}let _0xd245f8='',_0x28475f=_0x4bff23[_0x290233(0x1de)],_0x58fb7b='';if(_0x4bff23[_0x290233(0x190)]==='interac')_0x58fb7b=_0x290233(0x1db),_0x28475f=_0x290233(0x189),_0xd245f8='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x4bff23[_0x290233(0x1e6)]+'\x20'+_0x28475f+_0x290233(0x1b2);else _0x4bff23[_0x290233(0x190)]==='sepa'&&(_0x58fb7b='SEPA\x20Bank\x20Transfer',_0x28475f=_0x290233(0x184),_0xd245f8=_0x290233(0x1a0)+_0x4bff23[_0x290233(0x1e6)]+'\x20'+_0x28475f+_0x290233(0x1b2));const _0x38a632={'success':!![],'data':{'paymentId':_0x4bff23['id'],'gateway':_0x4bff23[_0x290233(0x190)],'gatewayName':_0x4bff23[_0x290233(0x190)][_0x290233(0x1a4)](),'transferType':_0x58fb7b,'amount':_0x4bff23['amount'],'currency':_0x28475f,'status':_0x4bff23['status'],'instructions':_0xd245f8,'shopName':_0x4bff23['shop'][_0x290233(0x1b7)]||_0x4bff23[_0x290233(0x1ec)][_0x290233(0x191)],'hasProof':![],'proofType':null,'createdAt':_0x4bff23[_0x290233(0x1ab)],'updatedAt':_0x4bff23[_0x290233(0x1ad)],'supportedFileTypes':[_0x290233(0x185),_0x290233(0x18d),_0x290233(0x1c2),_0x290233(0x1b3),_0x290233(0x1d0)],'maxFileSize':_0x290233(0x194)}};_0x51f2f0[_0x290233(0x1cf)](_0x38a632);}catch(_0x538f12){console[_0x290233(0x18e)](_0x290233(0x1b0),_0x538f12),_0x51f2f0[_0x290233(0x1d3)](0x1f4)[_0x290233(0x1cf)]({'success':![],'error':_0x290233(0x1da),'details':_0x538f12 instanceof Error?_0x538f12[_0x290233(0x1a3)]:_0x290233(0x192)});}}}exports[a8_0x2de733(0x1b9)]=ManualPaymentController,exports[a8_0x2de733(0x1c8)]=new ManualPaymentController();