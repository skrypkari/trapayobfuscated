'use strict';const a8_0x14a874=a8_0x4c28;(function(_0x59f55d,_0x2d60a6){const _0x3054b1=a8_0x4c28,_0x18d344=_0x59f55d();while(!![]){try{const _0x2ecce0=parseInt(_0x3054b1(0x19c))/0x1*(-parseInt(_0x3054b1(0x15c))/0x2)+-parseInt(_0x3054b1(0x165))/0x3*(-parseInt(_0x3054b1(0x1b9))/0x4)+-parseInt(_0x3054b1(0x1a7))/0x5*(parseInt(_0x3054b1(0x1b7))/0x6)+-parseInt(_0x3054b1(0x15b))/0x7+parseInt(_0x3054b1(0x16c))/0x8+parseInt(_0x3054b1(0x1ab))/0x9*(-parseInt(_0x3054b1(0x197))/0xa)+parseInt(_0x3054b1(0x1ad))/0xb;if(_0x2ecce0===_0x2d60a6)break;else _0x18d344['push'](_0x18d344['shift']());}catch(_0x3f5bfc){_0x18d344['push'](_0x18d344['shift']());}}}(a8_0x12cc,0xecaec));function a8_0x4c28(_0x2f83ef,_0x2b3301){const _0x12cc87=a8_0x12cc();return a8_0x4c28=function(_0x4c2834,_0x457c98){_0x4c2834=_0x4c2834-0x14d;let _0x2b4b3a=_0x12cc87[_0x4c2834];return _0x2b4b3a;},a8_0x4c28(_0x2f83ef,_0x2b3301);}var __importDefault=this&&this[a8_0x14a874(0x1a3)]||function(_0x3f40a3){return _0x3f40a3&&_0x3f40a3['__esModule']?_0x3f40a3:{'default':_0x3f40a3};};Object[a8_0x14a874(0x15e)](exports,a8_0x14a874(0x157),{'value':!![]}),exports[a8_0x14a874(0x186)]=exports[a8_0x14a874(0x1b8)]=void 0x0;const database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a8_0x14a874(0x187));class ManualPaymentController{async[a8_0x14a874(0x18c)](_0x1912d4,_0x5aa214){const _0x5c8965=a8_0x14a874;try{const {paymentId:_0x13551d,fileData:_0x2a8391,fileType:_0x32d2de,fileName:_0x591fde}=_0x1912d4['body'],_0xa26669=_0x1912d4['ip']||_0x1912d4[_0x5c8965(0x185)]?.[_0x5c8965(0x168)]||_0x5c8965(0x154);console[_0x5c8965(0x161)](_0x5c8965(0x19f)+_0x13551d),console[_0x5c8965(0x161)](_0x5c8965(0x18f)+_0x32d2de+_0x5c8965(0x1b3)+(_0x2a8391?Math['round'](_0x2a8391[_0x5c8965(0x1b1)]*0.75/0x400):0x0)+'KB'),console[_0x5c8965(0x161)](_0x5c8965(0x171)+_0xa26669);if(!_0x13551d){_0x5aa214[_0x5c8965(0x151)](0x190)[_0x5c8965(0x14f)]({'success':![],'error':'Payment\x20ID\x20is\x20required'});return;}if(!_0x2a8391){_0x5aa214[_0x5c8965(0x151)](0x190)[_0x5c8965(0x14f)]({'success':![],'error':_0x5c8965(0x14d)});return;}if(!_0x32d2de){_0x5aa214[_0x5c8965(0x151)](0x190)['json']({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x508e94=[_0x5c8965(0x188),'jpg',_0x5c8965(0x195),_0x5c8965(0x17c),'pdf'],_0x358ec3=_0x32d2de[_0x5c8965(0x167)]()[_0x5c8965(0x17e)]('.','');if(!_0x508e94[_0x5c8965(0x177)](_0x358ec3)){_0x5aa214[_0x5c8965(0x151)](0x190)['json']({'success':![],'error':_0x5c8965(0x183)+_0x32d2de+_0x5c8965(0x1a6)+_0x508e94[_0x5c8965(0x1ba)](',\x20')});return;}const _0x223204=0xa*0x400*0x400;if(_0x2a8391[_0x5c8965(0x1b1)]>_0x223204){_0x5aa214[_0x5c8965(0x151)](0x190)[_0x5c8965(0x14f)]({'success':![],'error':_0x5c8965(0x196)});return;}const _0x2f3396=await database_1[_0x5c8965(0x16a)][_0x5c8965(0x160)][_0x5c8965(0x18d)]({'where':{'id':_0x13551d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2f3396){console['log'](_0x5c8965(0x1b4)+_0x13551d),_0x5aa214[_0x5c8965(0x151)](0x194)[_0x5c8965(0x14f)]({'success':![],'error':_0x5c8965(0x17a)});return;}if(_0x2f3396[_0x5c8965(0x1ac)]!==_0x5c8965(0x15a)&&_0x2f3396['gateway']!=='sepa'){console[_0x5c8965(0x161)](_0x5c8965(0x16b)+_0x2f3396[_0x5c8965(0x1ac)]),_0x5aa214[_0x5c8965(0x151)](0x190)[_0x5c8965(0x14f)]({'success':![],'error':_0x5c8965(0x16d)+_0x2f3396[_0x5c8965(0x1ac)]});return;}let _0x10efa2=_0x2a8391;_0x2a8391['includes'](',')&&(_0x10efa2=_0x2a8391[_0x5c8965(0x18a)](',')[0x1]);try{Buffer[_0x5c8965(0x15d)](_0x10efa2,_0x5c8965(0x172));}catch(_0x27a03e){_0x5aa214[_0x5c8965(0x151)](0x190)[_0x5c8965(0x14f)]({'success':![],'error':_0x5c8965(0x156)});return;}const _0x19d6a2=await database_1['default'][_0x5c8965(0x160)][_0x5c8965(0x17b)]({'where':{'id':_0x13551d},'data':{'status':_0x5c8965(0x162),'updatedAt':new Date()}});console['log'](_0x5c8965(0x180)),console[_0x5c8965(0x161)](_0x5c8965(0x159)+_0x13551d),console[_0x5c8965(0x161)]('\x20\x20\x20-\x20Gateway:\x20'+_0x2f3396['gateway']['toUpperCase']()),console['log'](_0x5c8965(0x152)+_0x358ec3),console[_0x5c8965(0x161)](_0x5c8965(0x1a0)+Math['round'](_0x10efa2[_0x5c8965(0x1b1)]*0.75/0x400)+'KB'),console[_0x5c8965(0x161)]('\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING');try{const _0x5b0f08=_0x2f3396[_0x5c8965(0x1ac)]['toUpperCase'](),_0x266025=_0x2f3396[_0x5c8965(0x1ae)][_0x5c8965(0x1a4)]||_0x2f3396[_0x5c8965(0x1ae)][_0x5c8965(0x1b2)],_0x4a4500=Math[_0x5c8965(0x158)](_0x10efa2[_0x5c8965(0x1b1)]*0.75/0x400),_0x1e6945=_0x5c8965(0x190)+_0x5b0f08+_0x5c8965(0x163)+('üí≥\x20Payment\x20ID:\x20'+_0x13551d+'\x0a')+(_0x5c8965(0x189)+_0x2f3396['amount']+'\x20'+_0x2f3396[_0x5c8965(0x1a9)]+'\x0a')+(_0x5c8965(0x1bb)+_0x358ec3[_0x5c8965(0x191)]()+'\x20('+_0x4a4500+'KB)\x0a')+_0x5c8965(0x1a2)+('üåê\x20Customer\x20IP:\x20'+_0xa26669+'\x0a\x0a')+_0x5c8965(0x1aa);await telegramBotService_1[_0x5c8965(0x170)][_0x5c8965(0x1a8)](_0x2f3396[_0x5c8965(0x181)],_0x1e6945,{'parse_mode':'Markdown'});const _0x23d9cb=Buffer[_0x5c8965(0x15d)](_0x10efa2,'base64'),_0x555bc3='payment_proof_'+_0x13551d+'.'+_0x358ec3;await telegramBotService_1[_0x5c8965(0x170)][_0x5c8965(0x16f)](_0x2f3396[_0x5c8965(0x181)],_0x23d9cb,_0x555bc3,_0x5c8965(0x192)+_0x13551d),console[_0x5c8965(0x161)](_0x5c8965(0x153));const _0x54f10c=_0x5c8965(0x193),_0xfc45ec=_0x5c8965(0x190)+_0x5b0f08+'\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a'+('üí≥\x20Payment\x20ID:\x20'+_0x13551d+'\x0a')+(_0x5c8965(0x169)+_0x266025+'\x0a')+(_0x5c8965(0x189)+_0x2f3396[_0x5c8965(0x17f)]+'\x20'+_0x2f3396[_0x5c8965(0x1a9)]+'\x0a')+(_0x5c8965(0x1bb)+_0x358ec3[_0x5c8965(0x191)]()+'\x20('+_0x4a4500+_0x5c8965(0x19a))+_0x5c8965(0x1a2)+(_0x5c8965(0x164)+_0xa26669+'\x0a\x0a')+_0x5c8965(0x178);await telegramBotService_1[_0x5c8965(0x170)][_0x5c8965(0x18b)](parseInt(_0x54f10c),_0xfc45ec),await telegramBotService_1[_0x5c8965(0x170)][_0x5c8965(0x1b5)](parseInt(_0x54f10c),_0x23d9cb,_0x555bc3,_0x5c8965(0x1b6)+_0x13551d),console[_0x5c8965(0x161)](_0x5c8965(0x176));}catch(_0x1d332e){console[_0x5c8965(0x19b)](_0x5c8965(0x16e),_0x1d332e);}_0x5aa214[_0x5c8965(0x14f)]({'success':!![],'message':_0x5c8965(0x194),'data':{'paymentId':_0x19d6a2['id'],'status':_0x19d6a2[_0x5c8965(0x151)],'gateway':_0x2f3396[_0x5c8965(0x1ac)],'fileType':_0x358ec3,'fileSize':Math[_0x5c8965(0x158)](_0x10efa2[_0x5c8965(0x1b1)]*0.75/0x400)+'KB','uploadedAt':_0x19d6a2[_0x5c8965(0x199)]}});}catch(_0x2a8b6b){console['error'](_0x5c8965(0x1b0),_0x2a8b6b),_0x5aa214[_0x5c8965(0x151)](0x1f4)[_0x5c8965(0x14f)]({'success':![],'error':_0x5c8965(0x15f),'details':_0x2a8b6b instanceof Error?_0x2a8b6b['message']:'Unknown\x20error'});}}async['getManualPaymentInfo'](_0x58a831,_0x29ff2e){const _0x33650d=a8_0x14a874;try{const {paymentId:_0x2e5f86}=_0x58a831[_0x33650d(0x175)];console[_0x33650d(0x161)](_0x33650d(0x14e)+_0x2e5f86);const _0x3ca548=await database_1[_0x33650d(0x16a)][_0x33650d(0x160)][_0x33650d(0x18d)]({'where':{'id':_0x2e5f86},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3ca548){_0x29ff2e[_0x33650d(0x151)](0x194)[_0x33650d(0x14f)]({'success':![],'error':_0x33650d(0x17a)});return;}if(_0x3ca548['gateway']!==_0x33650d(0x15a)&&_0x3ca548[_0x33650d(0x1ac)]!=='sepa'){_0x29ff2e[_0x33650d(0x151)](0x190)[_0x33650d(0x14f)]({'success':![],'error':_0x33650d(0x184)+_0x3ca548[_0x33650d(0x1ac)]});return;}let _0x143d72='',_0x5288ef=_0x3ca548[_0x33650d(0x1a9)],_0x2bd37d='';if(_0x3ca548[_0x33650d(0x1ac)]===_0x33650d(0x15a))_0x2bd37d='Interac\x20e-Transfer',_0x5288ef=_0x33650d(0x1a5),_0x143d72=_0x33650d(0x19d)+_0x3ca548[_0x33650d(0x17f)]+'\x20'+_0x5288ef+_0x33650d(0x150);else _0x3ca548[_0x33650d(0x1ac)]===_0x33650d(0x155)&&(_0x2bd37d=_0x33650d(0x173),_0x5288ef=_0x33650d(0x182),_0x143d72=_0x33650d(0x19e)+_0x3ca548[_0x33650d(0x17f)]+'\x20'+_0x5288ef+_0x33650d(0x150));const _0x1fdf10={'success':!![],'data':{'paymentId':_0x3ca548['id'],'gateway':_0x3ca548[_0x33650d(0x1ac)],'gatewayName':_0x3ca548[_0x33650d(0x1ac)][_0x33650d(0x191)](),'transferType':_0x2bd37d,'amount':_0x3ca548[_0x33650d(0x17f)],'currency':_0x5288ef,'status':_0x3ca548['status'],'instructions':_0x143d72,'shopName':_0x3ca548['shop'][_0x33650d(0x1a4)]||_0x3ca548[_0x33650d(0x1ae)][_0x33650d(0x1b2)],'hasProof':![],'proofType':null,'createdAt':_0x3ca548[_0x33650d(0x17d)],'updatedAt':_0x3ca548['updatedAt'],'supportedFileTypes':[_0x33650d(0x174),_0x33650d(0x1a1),_0x33650d(0x179),_0x33650d(0x166),_0x33650d(0x18e)],'maxFileSize':'10MB'}};_0x29ff2e[_0x33650d(0x14f)](_0x1fdf10);}catch(_0x26530e){console['error'](_0x33650d(0x1af),_0x26530e),_0x29ff2e['status'](0x1f4)[_0x33650d(0x14f)]({'success':![],'error':'Internal\x20server\x20error','details':_0x26530e instanceof Error?_0x26530e['message']:_0x33650d(0x198)});}}}function a8_0x12cc(){const _0x426ac7=['sendShopNotification','currency','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','14679qnUsJI','gateway','11894333cFUGCx','shop','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','‚ùå\x20Upload\x20payment\x20proof\x20error:','length','username',',\x20size:\x20','‚ùå\x20Payment\x20not\x20found:\x20','sendDirectFile','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','108YUgYeb','ManualPaymentController','6331348xayxdM','join','üìÅ\x20File:\x20','File\x20data\x20is\x20required','üìã\x20Get\x20manual\x20payment\x20info:\x20','json','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','status','\x20\x20\x20-\x20File\x20type:\x20','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','unknown','sepa','Invalid\x20base64\x20file\x20data','__esModule','round','\x20\x20\x20-\x20Payment\x20ID:\x20','interac','4098612YDiHGm','15188BsOmZE','from','defineProperty','Internal\x20server\x20error','payment','log','PROCESSING','\x20Payment\x20Proof\x20Received\x0a\x0a','üåê\x20Customer\x20IP:\x20','3GDvtLt','HEIC','toLowerCase','remoteAddress','üè™\x20Shop:\x20','default','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','9438456wEEQvA','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','sendShopFile','telegramBotService','üåê\x20Client\x20IP:\x20','base64','SEPA\x20Bank\x20Transfer','PNG','params','üì±\x20Admin\x20notification\x20and\x20file\x20sent','includes','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','JPEG','Payment\x20not\x20found','update','heic','createdAt','replace','amount','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','shopId','EUR','Unsupported\x20file\x20type:\x20','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','connection','manualPaymentController','../services/telegramBotService','png','üí∞\x20Amount:\x20','split','sendDirectMessage','uploadPaymentProof','findUnique','PDF','üìÅ\x20File\x20type:\x20','üîÑ\x20','toUpperCase','Payment\x20proof\x20for\x20','7867339505','Payment\x20proof\x20uploaded\x20successfully','jpeg','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','5510MbufKl','Unknown\x20error','updatedAt','KB)\x0a','error','65XKeUKD','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','\x20\x20\x20-\x20File\x20size:\x20','JPG','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','__importDefault','name','CAD','.\x20Supported:\x20','249080vDZNFZ'];a8_0x12cc=function(){return _0x426ac7;};return a8_0x12cc();}exports[a8_0x14a874(0x1b8)]=ManualPaymentController,exports[a8_0x14a874(0x186)]=new ManualPaymentController();