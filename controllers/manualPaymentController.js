'use strict';const a11_0x508cf7=a11_0x5155;(function(_0xe55ce7,_0x38ad31){const _0x2716c4=a11_0x5155,_0x5668ea=_0xe55ce7();while(!![]){try{const _0x40e7a3=parseInt(_0x2716c4(0x213))/0x1*(-parseInt(_0x2716c4(0x21f))/0x2)+-parseInt(_0x2716c4(0x252))/0x3*(-parseInt(_0x2716c4(0x237))/0x4)+-parseInt(_0x2716c4(0x1fc))/0x5+parseInt(_0x2716c4(0x1f0))/0x6+-parseInt(_0x2716c4(0x248))/0x7*(-parseInt(_0x2716c4(0x220))/0x8)+parseInt(_0x2716c4(0x224))/0x9*(-parseInt(_0x2716c4(0x203))/0xa)+parseInt(_0x2716c4(0x204))/0xb;if(_0x40e7a3===_0x38ad31)break;else _0x5668ea['push'](_0x5668ea['shift']());}catch(_0x56f4b6){_0x5668ea['push'](_0x5668ea['shift']());}}}(a11_0x48fd,0xe3db9));var __importDefault=this&&this[a11_0x508cf7(0x226)]||function(_0x27cff6){const _0x519e67=a11_0x508cf7;return _0x27cff6&&_0x27cff6[_0x519e67(0x223)]?_0x27cff6:{'default':_0x27cff6};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['manualPaymentController']=exports['ManualPaymentController']=void 0x0;function a11_0x5155(_0x356883,_0x294838){_0x356883=_0x356883-0x1ed;const _0x48fd93=a11_0x48fd();let _0x51553d=_0x48fd93[_0x356883];return _0x51553d;}const database_1=__importDefault(require(a11_0x508cf7(0x246))),telegramBotService_1=require(a11_0x508cf7(0x206));function a11_0x48fd(){const _0x131643=['37423760AXHoxL','jpeg','../services/telegramBotService','Unknown\x20error','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','Internal\x20server\x20error','Payment\x20not\x20found','getManualPaymentInfo','payment_proof_','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','username','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','json','üìÅ\x20File\x20type:\x20','Payment\x20proof\x20uploaded\x20successfully','857krjmDR','File\x20data\x20is\x20required','‚ùå\x20Payment\x20not\x20found:\x20','EUR','payment','currency','\x20\x20\x20-\x20Gateway:\x20','round','amount','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','Markdown','PNG','4274pUCjQv','8asavHr','üåê\x20Client\x20IP:\x20','Invalid\x20base64\x20file\x20data','__esModule','993060fPqall','sendShopFile','__importDefault','pdf','KB)\x0a','createdAt','toLowerCase','Payment\x20proof\x20for\x20','SEPA\x20Bank\x20Transfer','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','gateway','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','üåê\x20Customer\x20IP:\x20','findUnique','name','.\x20Supported:\x20','sendDirectMessage','includes','error','334688tDkOUS','png','ManualPaymentController','join','connection','telegramBotService','toUpperCase','heic','üîÑ\x20','status','üí≥\x20Payment\x20ID:\x20','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','base64','unknown','HEIC','../config/database','default','8815996kkehuP','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','PDF','JPG','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','‚ùå\x20Upload\x20payment\x20proof\x20error:','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','üí∞\x20Amount:\x20','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','üìÅ\x20File:\x20','33CFTjeB','log','CAD','length','668622eRpfRd','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','\x20Payment\x20Proof\x20Received\x0a\x0a','PROCESSING','uploadPaymentProof','manualPaymentController','message','params','\x20\x20\x20-\x20File\x20size:\x20','\x20\x20\x20-\x20File\x20type:\x20','9126515JRNZca','shopId','Interac\x20e-Transfer','from','sepa','shop','updatedAt','100WubEeE'];a11_0x48fd=function(){return _0x131643;};return a11_0x48fd();}class ManualPaymentController{async[a11_0x508cf7(0x1f6)](_0x57a062,_0x4d5076){const _0x32fe51=a11_0x508cf7;try{const {paymentId:_0x3db7da,fileData:_0x40733d,fileType:_0x8c564,fileName:_0x1cd3d5}=_0x57a062['body'],_0x5eda78=_0x57a062['ip']||_0x57a062[_0x32fe51(0x23b)]?.['remoteAddress']||_0x32fe51(0x244);console[_0x32fe51(0x1ed)](_0x32fe51(0x242)+_0x3db7da),console['log'](_0x32fe51(0x211)+_0x8c564+',\x20size:\x20'+(_0x40733d?Math[_0x32fe51(0x21a)](_0x40733d['length']*0.75/0x400):0x0)+'KB'),console['log'](_0x32fe51(0x221)+_0x5eda78);if(!_0x3db7da){_0x4d5076[_0x32fe51(0x240)](0x190)['json']({'success':![],'error':'Payment\x20ID\x20is\x20required'});return;}if(!_0x40733d){_0x4d5076[_0x32fe51(0x240)](0x190)[_0x32fe51(0x210)]({'success':![],'error':_0x32fe51(0x214)});return;}if(!_0x8c564){_0x4d5076[_0x32fe51(0x240)](0x190)[_0x32fe51(0x210)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x4616f2=[_0x32fe51(0x238),'jpg',_0x32fe51(0x205),_0x32fe51(0x23e),_0x32fe51(0x227)],_0x418f68=_0x8c564[_0x32fe51(0x22a)]()['replace']('.','');if(!_0x4616f2['includes'](_0x418f68)){_0x4d5076['status'](0x190)[_0x32fe51(0x210)]({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x8c564+_0x32fe51(0x233)+_0x4616f2[_0x32fe51(0x23a)](',\x20')});return;}const _0x32f28f=0xa*0x400*0x400;if(_0x40733d[_0x32fe51(0x1ef)]>_0x32f28f){_0x4d5076[_0x32fe51(0x240)](0x190)[_0x32fe51(0x210)]({'success':![],'error':_0x32fe51(0x1f2)});return;}const _0x1a98eb=await database_1[_0x32fe51(0x247)]['payment'][_0x32fe51(0x231)]({'where':{'id':_0x3db7da},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1a98eb){console[_0x32fe51(0x1ed)](_0x32fe51(0x215)+_0x3db7da),_0x4d5076['status'](0x194)['json']({'success':![],'error':_0x32fe51(0x20a)});return;}if(_0x1a98eb[_0x32fe51(0x22e)]!=='interac'&&_0x1a98eb[_0x32fe51(0x22e)]!=='sepa'){console['log']('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x1a98eb[_0x32fe51(0x22e)]),_0x4d5076['status'](0x190)[_0x32fe51(0x210)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x1a98eb['gateway']});return;}let _0x262c3d=_0x40733d;_0x40733d[_0x32fe51(0x235)](',')&&(_0x262c3d=_0x40733d['split'](',')[0x1]);try{Buffer[_0x32fe51(0x1ff)](_0x262c3d,_0x32fe51(0x243));}catch(_0x5315a7){_0x4d5076[_0x32fe51(0x240)](0x190)[_0x32fe51(0x210)]({'success':![],'error':_0x32fe51(0x222)});return;}const _0x5cbcad=await database_1[_0x32fe51(0x247)][_0x32fe51(0x217)]['update']({'where':{'id':_0x3db7da},'data':{'status':_0x32fe51(0x1f5),'updatedAt':new Date()}});console[_0x32fe51(0x1ed)](_0x32fe51(0x22d)),console['log']('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x3db7da),console[_0x32fe51(0x1ed)](_0x32fe51(0x219)+_0x1a98eb[_0x32fe51(0x22e)][_0x32fe51(0x23d)]()),console[_0x32fe51(0x1ed)](_0x32fe51(0x1fb)+_0x418f68),console[_0x32fe51(0x1ed)](_0x32fe51(0x1fa)+Math[_0x32fe51(0x21a)](_0x262c3d[_0x32fe51(0x1ef)]*0.75/0x400)+'KB'),console['log'](_0x32fe51(0x1f3));try{const _0x667439=_0x1a98eb[_0x32fe51(0x22e)]['toUpperCase'](),_0x1f9487=_0x1a98eb['shop'][_0x32fe51(0x232)]||_0x1a98eb[_0x32fe51(0x201)][_0x32fe51(0x20e)],_0x1b638b=Math[_0x32fe51(0x21a)](_0x262c3d['length']*0.75/0x400),_0x37a976='üîÑ\x20'+_0x667439+_0x32fe51(0x1f4)+(_0x32fe51(0x241)+_0x3db7da+'\x0a')+('üí∞\x20Amount:\x20'+_0x1a98eb[_0x32fe51(0x21b)]+'\x20'+_0x1a98eb[_0x32fe51(0x218)]+'\x0a')+(_0x32fe51(0x251)+_0x418f68[_0x32fe51(0x23d)]()+'\x20('+_0x1b638b+_0x32fe51(0x228))+_0x32fe51(0x20f)+(_0x32fe51(0x230)+_0x5eda78+'\x0a\x0a')+_0x32fe51(0x22f);await telegramBotService_1[_0x32fe51(0x23c)]['sendShopNotification'](_0x1a98eb[_0x32fe51(0x1fd)],_0x37a976,{'parse_mode':_0x32fe51(0x21d)});const _0x3b2dc2=Buffer[_0x32fe51(0x1ff)](_0x262c3d,'base64'),_0x2a37fa=_0x32fe51(0x20c)+_0x3db7da+'.'+_0x418f68;await telegramBotService_1[_0x32fe51(0x23c)][_0x32fe51(0x225)](_0x1a98eb[_0x32fe51(0x1fd)],_0x3b2dc2,_0x2a37fa,_0x32fe51(0x22b)+_0x3db7da),console[_0x32fe51(0x1ed)]('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x3d2585='7867339505',_0x33459a=_0x32fe51(0x23f)+_0x667439+_0x32fe51(0x1f1)+(_0x32fe51(0x241)+_0x3db7da+'\x0a')+('üè™\x20Shop:\x20'+_0x1f9487+'\x0a')+(_0x32fe51(0x24f)+_0x1a98eb['amount']+'\x20'+_0x1a98eb['currency']+'\x0a')+(_0x32fe51(0x251)+_0x418f68['toUpperCase']()+'\x20('+_0x1b638b+_0x32fe51(0x228))+_0x32fe51(0x20f)+('üåê\x20Customer\x20IP:\x20'+_0x5eda78+'\x0a\x0a')+_0x32fe51(0x21c);await telegramBotService_1[_0x32fe51(0x23c)][_0x32fe51(0x234)](parseInt(_0x3d2585),_0x33459a),await telegramBotService_1[_0x32fe51(0x23c)]['sendDirectFile'](parseInt(_0x3d2585),_0x3b2dc2,_0x2a37fa,_0x32fe51(0x24e)+_0x3db7da),console[_0x32fe51(0x1ed)]('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x57cd6b){console[_0x32fe51(0x236)]('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:',_0x57cd6b);}_0x4d5076[_0x32fe51(0x210)]({'success':!![],'message':_0x32fe51(0x212),'data':{'paymentId':_0x5cbcad['id'],'status':_0x5cbcad[_0x32fe51(0x240)],'gateway':_0x1a98eb[_0x32fe51(0x22e)],'fileType':_0x418f68,'fileSize':Math[_0x32fe51(0x21a)](_0x262c3d[_0x32fe51(0x1ef)]*0.75/0x400)+'KB','uploadedAt':_0x5cbcad[_0x32fe51(0x202)]}});}catch(_0x1f3a62){console['error'](_0x32fe51(0x24d),_0x1f3a62),_0x4d5076['status'](0x1f4)['json']({'success':![],'error':_0x32fe51(0x209),'details':_0x1f3a62 instanceof Error?_0x1f3a62['message']:_0x32fe51(0x207)});}}async[a11_0x508cf7(0x20b)](_0x1824cd,_0x1bda10){const _0x49a878=a11_0x508cf7;try{const {paymentId:_0x54b5b4}=_0x1824cd[_0x49a878(0x1f9)];console[_0x49a878(0x1ed)]('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x54b5b4);const _0x4bbd12=await database_1[_0x49a878(0x247)][_0x49a878(0x217)][_0x49a878(0x231)]({'where':{'id':_0x54b5b4},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4bbd12){_0x1bda10['status'](0x194)[_0x49a878(0x210)]({'success':![],'error':_0x49a878(0x20a)});return;}if(_0x4bbd12[_0x49a878(0x22e)]!=='interac'&&_0x4bbd12[_0x49a878(0x22e)]!==_0x49a878(0x200)){_0x1bda10['status'](0x190)[_0x49a878(0x210)]({'success':![],'error':_0x49a878(0x250)+_0x4bbd12[_0x49a878(0x22e)]});return;}let _0x10c283='',_0x30dec9=_0x4bbd12['currency'],_0x226df6='';if(_0x4bbd12[_0x49a878(0x22e)]==='interac')_0x226df6=_0x49a878(0x1fe),_0x30dec9=_0x49a878(0x1ee),_0x10c283=_0x49a878(0x208)+_0x4bbd12[_0x49a878(0x21b)]+'\x20'+_0x30dec9+_0x49a878(0x20d);else _0x4bbd12[_0x49a878(0x22e)]==='sepa'&&(_0x226df6=_0x49a878(0x22c),_0x30dec9=_0x49a878(0x216),_0x10c283=_0x49a878(0x24c)+_0x4bbd12[_0x49a878(0x21b)]+'\x20'+_0x30dec9+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x217749={'success':!![],'data':{'paymentId':_0x4bbd12['id'],'gateway':_0x4bbd12[_0x49a878(0x22e)],'gatewayName':_0x4bbd12[_0x49a878(0x22e)][_0x49a878(0x23d)](),'transferType':_0x226df6,'amount':_0x4bbd12[_0x49a878(0x21b)],'currency':_0x30dec9,'status':_0x4bbd12[_0x49a878(0x240)],'instructions':_0x10c283,'shopName':_0x4bbd12[_0x49a878(0x201)]['name']||_0x4bbd12[_0x49a878(0x201)][_0x49a878(0x20e)],'hasProof':![],'proofType':null,'createdAt':_0x4bbd12[_0x49a878(0x229)],'updatedAt':_0x4bbd12['updatedAt'],'supportedFileTypes':[_0x49a878(0x21e),_0x49a878(0x24b),'JPEG',_0x49a878(0x245),_0x49a878(0x24a)],'maxFileSize':'10MB'}};_0x1bda10['json'](_0x217749);}catch(_0x33033a){console[_0x49a878(0x236)](_0x49a878(0x249),_0x33033a),_0x1bda10[_0x49a878(0x240)](0x1f4)[_0x49a878(0x210)]({'success':![],'error':_0x49a878(0x209),'details':_0x33033a instanceof Error?_0x33033a[_0x49a878(0x1f8)]:_0x49a878(0x207)});}}}exports[a11_0x508cf7(0x239)]=ManualPaymentController,exports[a11_0x508cf7(0x1f7)]=new ManualPaymentController();