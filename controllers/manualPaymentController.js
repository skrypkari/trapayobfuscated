'use strict';function a10_0x448d(_0x335a91,_0x4938cc){_0x335a91=_0x335a91-0x19b;const _0x54a69d=a10_0x54a6();let _0x448dd3=_0x54a69d[_0x335a91];return _0x448dd3;}const a10_0x4e90fe=a10_0x448d;(function(_0x15e339,_0x24440c){const _0x15de2c=a10_0x448d,_0x295eb4=_0x15e339();while(!![]){try{const _0x3d61e2=-parseInt(_0x15de2c(0x1c6))/0x1*(parseInt(_0x15de2c(0x1f8))/0x2)+-parseInt(_0x15de2c(0x1f7))/0x3+parseInt(_0x15de2c(0x1b0))/0x4+-parseInt(_0x15de2c(0x1fa))/0x5+-parseInt(_0x15de2c(0x1b6))/0x6+parseInt(_0x15de2c(0x1e3))/0x7+-parseInt(_0x15de2c(0x1c9))/0x8*(-parseInt(_0x15de2c(0x1ac))/0x9);if(_0x3d61e2===_0x24440c)break;else _0x295eb4['push'](_0x295eb4['shift']());}catch(_0x275b2f){_0x295eb4['push'](_0x295eb4['shift']());}}}(a10_0x54a6,0x9e96b));function a10_0x54a6(){const _0x419010=['üì±\x20Admin\x20notification\x20and\x20file\x20sent','__esModule','gateway','Internal\x20server\x20error','sendShopFile','body','telegramBotService','üåê\x20Customer\x20IP:\x20','JPEG','../services/telegramBotService','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','9SLevnn','File\x20type\x20is\x20required','\x20Payment\x20Proof\x20Received\x0a\x0a','update','4909352UaGrhL','Unknown\x20error','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','from','status','Payment\x20proof\x20uploaded\x20successfully','5753436RKDpAg','message','üí∞\x20Amount:\x20','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','\x20\x20\x20-\x20Payment\x20ID:\x20','currency','EUR','üîÑ\x20','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','replace','toLowerCase','createdAt','PNG','jpeg','join','.\x20Supported:\x20','1369aoWkRB','üìã\x20Get\x20manual\x20payment\x20info:\x20','Payment\x20ID\x20is\x20required','9233752cTOfBk','shop','sendDirectMessage','json','split','round','base64','\x20\x20\x20-\x20File\x20type:\x20','name','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','sepa','PDF','üìÅ\x20File\x20type:\x20',',\x20size:\x20','Unsupported\x20file\x20type:\x20','png','pdf','jpg','\x20\x20\x20-\x20Gateway:\x20','KB)\x0a','username','payment_proof_','heic','\x20\x20\x20-\x20File\x20size:\x20','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','unknown','7544817GjohwM','sendDirectFile','findUnique','amount','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','ManualPaymentController','__importDefault','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','manualPaymentController','Interac\x20e-Transfer','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','Markdown','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','HEIC','üìÅ\x20File:\x20','‚ùå\x20Payment\x20not\x20found:\x20','Payment\x20not\x20found','üè™\x20Shop:\x20','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','1274862yEYqNR','1714xRjsOh','includes','1263580OtobcG','JPG','../config/database','params','log','interac','default','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','üåê\x20Client\x20IP:\x20','length','shopId','remoteAddress','10MB','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','error','updatedAt','üí≥\x20Payment\x20ID:\x20','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','toUpperCase','payment'];a10_0x54a6=function(){return _0x419010;};return a10_0x54a6();}var __importDefault=this&&this[a10_0x4e90fe(0x1e9)]||function(_0x565c0c){const _0x5b90c4=a10_0x4e90fe;return _0x565c0c&&_0x565c0c[_0x5b90c4(0x1a2)]?_0x565c0c:{'default':_0x565c0c};};Object['defineProperty'](exports,a10_0x4e90fe(0x1a2),{'value':!![]}),exports['manualPaymentController']=exports[a10_0x4e90fe(0x1e8)]=void 0x0;const database_1=__importDefault(require(a10_0x4e90fe(0x1fc))),telegramBotService_1=require(a10_0x4e90fe(0x1aa));class ManualPaymentController{async['uploadPaymentProof'](_0x56836c,_0x480a8a){const _0x382030=a10_0x4e90fe;try{const {paymentId:_0x27c1cb,fileData:_0x27728,fileType:_0x312d9c,fileName:_0x272ab6}=_0x56836c[_0x382030(0x1a6)],_0x4e2ff1=_0x56836c['ip']||_0x56836c['connection']?.[_0x382030(0x205)]||_0x382030(0x1e2);console[_0x382030(0x1fe)]('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x27c1cb),console['log'](_0x382030(0x1d5)+_0x312d9c+_0x382030(0x1d6)+(_0x27728?Math[_0x382030(0x1ce)](_0x27728[_0x382030(0x203)]*0.75/0x400):0x0)+'KB'),console[_0x382030(0x1fe)](_0x382030(0x202)+_0x4e2ff1);if(!_0x27c1cb){_0x480a8a['status'](0x190)[_0x382030(0x1cc)]({'success':![],'error':_0x382030(0x1c8)});return;}if(!_0x27728){_0x480a8a[_0x382030(0x1b4)](0x190)[_0x382030(0x1cc)]({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x312d9c){_0x480a8a[_0x382030(0x1b4)](0x190)[_0x382030(0x1cc)]({'success':![],'error':_0x382030(0x1ad)});return;}const _0x9ad602=[_0x382030(0x1d8),_0x382030(0x1da),_0x382030(0x1c3),_0x382030(0x1df),_0x382030(0x1d9)],_0x358531=_0x312d9c[_0x382030(0x1c0)]()[_0x382030(0x1bf)]('.','');if(!_0x9ad602[_0x382030(0x1f9)](_0x358531)){_0x480a8a[_0x382030(0x1b4)](0x190)['json']({'success':![],'error':_0x382030(0x1d7)+_0x312d9c+_0x382030(0x1c5)+_0x9ad602[_0x382030(0x1c4)](',\x20')});return;}const _0x1cfdea=0xa*0x400*0x400;if(_0x27728['length']>_0x1cfdea){_0x480a8a[_0x382030(0x1b4)](0x190)[_0x382030(0x1cc)]({'success':![],'error':_0x382030(0x1e7)});return;}const _0x35b742=await database_1[_0x382030(0x200)][_0x382030(0x1a0)][_0x382030(0x1e5)]({'where':{'id':_0x27c1cb},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x35b742){console[_0x382030(0x1fe)](_0x382030(0x1f3)+_0x27c1cb),_0x480a8a[_0x382030(0x1b4)](0x194)['json']({'success':![],'error':_0x382030(0x1f4)});return;}if(_0x35b742[_0x382030(0x1a3)]!==_0x382030(0x1ff)&&_0x35b742[_0x382030(0x1a3)]!==_0x382030(0x1d3)){console[_0x382030(0x1fe)](_0x382030(0x1b2)+_0x35b742['gateway']),_0x480a8a[_0x382030(0x1b4)](0x190)[_0x382030(0x1cc)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x35b742[_0x382030(0x1a3)]});return;}let _0x627cde=_0x27728;_0x27728['includes'](',')&&(_0x627cde=_0x27728[_0x382030(0x1cd)](',')[0x1]);try{Buffer[_0x382030(0x1b3)](_0x627cde,'base64');}catch(_0x5708d3){_0x480a8a['status'](0x190)['json']({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x281fc9=await database_1[_0x382030(0x200)][_0x382030(0x1a0)][_0x382030(0x1af)]({'where':{'id':_0x27c1cb},'data':{'status':'PROCESSING','updatedAt':new Date()}});console[_0x382030(0x1fe)](_0x382030(0x1b9)),console[_0x382030(0x1fe)](_0x382030(0x1ba)+_0x27c1cb),console[_0x382030(0x1fe)](_0x382030(0x1db)+_0x35b742[_0x382030(0x1a3)][_0x382030(0x19f)]()),console[_0x382030(0x1fe)](_0x382030(0x1d0)+_0x358531),console[_0x382030(0x1fe)](_0x382030(0x1e0)+Math[_0x382030(0x1ce)](_0x627cde[_0x382030(0x203)]*0.75/0x400)+'KB'),console[_0x382030(0x1fe)](_0x382030(0x1ab));try{const _0xc29d19=_0x35b742[_0x382030(0x1a3)][_0x382030(0x19f)](),_0x5241a8=_0x35b742[_0x382030(0x1ca)][_0x382030(0x1d1)]||_0x35b742[_0x382030(0x1ca)][_0x382030(0x1dd)],_0x3a0f38=Math['round'](_0x627cde[_0x382030(0x203)]*0.75/0x400),_0x52d75b=_0x382030(0x1bd)+_0xc29d19+_0x382030(0x1ae)+(_0x382030(0x19d)+_0x27c1cb+'\x0a')+(_0x382030(0x1b8)+_0x35b742[_0x382030(0x1e6)]+'\x20'+_0x35b742['currency']+'\x0a')+(_0x382030(0x1f2)+_0x358531['toUpperCase']()+'\x20('+_0x3a0f38+_0x382030(0x1dc))+_0x382030(0x1f0)+(_0x382030(0x1a8)+_0x4e2ff1+'\x0a\x0a')+_0x382030(0x1d2);await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x35b742[_0x382030(0x204)],_0x52d75b,{'parse_mode':_0x382030(0x1ee)});const _0x58da6a=Buffer[_0x382030(0x1b3)](_0x627cde,_0x382030(0x1cf)),_0x38ac2f=_0x382030(0x1de)+_0x27c1cb+'.'+_0x358531;await telegramBotService_1[_0x382030(0x1a7)][_0x382030(0x1a5)](_0x35b742['shopId'],_0x58da6a,_0x38ac2f,'Payment\x20proof\x20for\x20'+_0x27c1cb),console[_0x382030(0x1fe)](_0x382030(0x201));const _0xeac611='7867339505',_0x35ca1a=_0x382030(0x1bd)+_0xc29d19+_0x382030(0x19e)+('üí≥\x20Payment\x20ID:\x20'+_0x27c1cb+'\x0a')+(_0x382030(0x1f5)+_0x5241a8+'\x0a')+('üí∞\x20Amount:\x20'+_0x35b742['amount']+'\x20'+_0x35b742['currency']+'\x0a')+(_0x382030(0x1f2)+_0x358531['toUpperCase']()+'\x20('+_0x3a0f38+_0x382030(0x1dc))+_0x382030(0x1f0)+('üåê\x20Customer\x20IP:\x20'+_0x4e2ff1+'\x0a\x0a')+_0x382030(0x1ef);await telegramBotService_1[_0x382030(0x1a7)][_0x382030(0x1cb)](parseInt(_0xeac611),_0x35ca1a),await telegramBotService_1[_0x382030(0x1a7)][_0x382030(0x1e4)](parseInt(_0xeac611),_0x58da6a,_0x38ac2f,_0x382030(0x1e1)+_0x27c1cb),console[_0x382030(0x1fe)](_0x382030(0x1a1));}catch(_0x38c9aa){console[_0x382030(0x19b)]('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:',_0x38c9aa);}_0x480a8a[_0x382030(0x1cc)]({'success':!![],'message':_0x382030(0x1b5),'data':{'paymentId':_0x281fc9['id'],'status':_0x281fc9[_0x382030(0x1b4)],'gateway':_0x35b742[_0x382030(0x1a3)],'fileType':_0x358531,'fileSize':Math[_0x382030(0x1ce)](_0x627cde[_0x382030(0x203)]*0.75/0x400)+'KB','uploadedAt':_0x281fc9[_0x382030(0x19c)]}});}catch(_0x1bbd57){console['error']('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x1bbd57),_0x480a8a[_0x382030(0x1b4)](0x1f4)[_0x382030(0x1cc)]({'success':![],'error':_0x382030(0x1a4),'details':_0x1bbd57 instanceof Error?_0x1bbd57[_0x382030(0x1b7)]:_0x382030(0x1b1)});}}async['getManualPaymentInfo'](_0x28c899,_0x240908){const _0x5e7972=a10_0x4e90fe;try{const {paymentId:_0x34b994}=_0x28c899[_0x5e7972(0x1fd)];console[_0x5e7972(0x1fe)](_0x5e7972(0x1c7)+_0x34b994);const _0x30ddb3=await database_1[_0x5e7972(0x200)][_0x5e7972(0x1a0)][_0x5e7972(0x1e5)]({'where':{'id':_0x34b994},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x30ddb3){_0x240908['status'](0x194)[_0x5e7972(0x1cc)]({'success':![],'error':_0x5e7972(0x1f4)});return;}if(_0x30ddb3[_0x5e7972(0x1a3)]!==_0x5e7972(0x1ff)&&_0x30ddb3[_0x5e7972(0x1a3)]!=='sepa'){_0x240908[_0x5e7972(0x1b4)](0x190)['json']({'success':![],'error':_0x5e7972(0x1ed)+_0x30ddb3['gateway']});return;}let _0x4a1a17='',_0x294d87=_0x30ddb3[_0x5e7972(0x1bb)],_0x40be33='';if(_0x30ddb3['gateway']===_0x5e7972(0x1ff))_0x40be33=_0x5e7972(0x1ec),_0x294d87='CAD',_0x4a1a17=_0x5e7972(0x1be)+_0x30ddb3['amount']+'\x20'+_0x294d87+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.';else _0x30ddb3[_0x5e7972(0x1a3)]===_0x5e7972(0x1d3)&&(_0x40be33='SEPA\x20Bank\x20Transfer',_0x294d87=_0x5e7972(0x1bc),_0x4a1a17=_0x5e7972(0x207)+_0x30ddb3['amount']+'\x20'+_0x294d87+_0x5e7972(0x1ea));const _0x2f9e7e={'success':!![],'data':{'paymentId':_0x30ddb3['id'],'gateway':_0x30ddb3[_0x5e7972(0x1a3)],'gatewayName':_0x30ddb3[_0x5e7972(0x1a3)][_0x5e7972(0x19f)](),'transferType':_0x40be33,'amount':_0x30ddb3['amount'],'currency':_0x294d87,'status':_0x30ddb3[_0x5e7972(0x1b4)],'instructions':_0x4a1a17,'shopName':_0x30ddb3[_0x5e7972(0x1ca)][_0x5e7972(0x1d1)]||_0x30ddb3[_0x5e7972(0x1ca)]['username'],'hasProof':![],'proofType':null,'createdAt':_0x30ddb3[_0x5e7972(0x1c1)],'updatedAt':_0x30ddb3['updatedAt'],'supportedFileTypes':[_0x5e7972(0x1c2),_0x5e7972(0x1fb),_0x5e7972(0x1a9),_0x5e7972(0x1f1),_0x5e7972(0x1d4)],'maxFileSize':_0x5e7972(0x206)}};_0x240908[_0x5e7972(0x1cc)](_0x2f9e7e);}catch(_0x505430){console[_0x5e7972(0x19b)](_0x5e7972(0x1f6),_0x505430),_0x240908[_0x5e7972(0x1b4)](0x1f4)['json']({'success':![],'error':'Internal\x20server\x20error','details':_0x505430 instanceof Error?_0x505430[_0x5e7972(0x1b7)]:'Unknown\x20error'});}}}exports['ManualPaymentController']=ManualPaymentController,exports[a10_0x4e90fe(0x1eb)]=new ManualPaymentController();