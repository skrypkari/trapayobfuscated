'use strict';const a8_0x4814f9=a8_0x364c;function a8_0x364c(_0xc212fd,_0x5c5bf6){const _0x2aca93=a8_0x2aca();return a8_0x364c=function(_0x364cba,_0xa064f1){_0x364cba=_0x364cba-0x14b;let _0x1562eb=_0x2aca93[_0x364cba];return _0x1562eb;},a8_0x364c(_0xc212fd,_0x5c5bf6);}(function(_0xc68b3,_0x539250){const _0x10bb38=a8_0x364c,_0x3d9086=_0xc68b3();while(!![]){try{const _0x5b2028=-parseInt(_0x10bb38(0x14e))/0x1*(parseInt(_0x10bb38(0x195))/0x2)+-parseInt(_0x10bb38(0x18a))/0x3*(-parseInt(_0x10bb38(0x1b1))/0x4)+parseInt(_0x10bb38(0x1a7))/0x5*(parseInt(_0x10bb38(0x18f))/0x6)+parseInt(_0x10bb38(0x180))/0x7*(parseInt(_0x10bb38(0x182))/0x8)+parseInt(_0x10bb38(0x152))/0x9+parseInt(_0x10bb38(0x19f))/0xa+-parseInt(_0x10bb38(0x164))/0xb;if(_0x5b2028===_0x539250)break;else _0x3d9086['push'](_0x3d9086['shift']());}catch(_0x411f64){_0x3d9086['push'](_0x3d9086['shift']());}}}(a8_0x2aca,0x69ac2));var __importDefault=this&&this['__importDefault']||function(_0x154b43){const _0x54d64b=a8_0x364c;return _0x154b43&&_0x154b43[_0x54d64b(0x186)]?_0x154b43:{'default':_0x154b43};};Object[a8_0x4814f9(0x179)](exports,a8_0x4814f9(0x186),{'value':!![]}),exports[a8_0x4814f9(0x193)]=exports[a8_0x4814f9(0x1a9)]=void 0x0;const database_1=__importDefault(require(a8_0x4814f9(0x191))),telegramBotService_1=require(a8_0x4814f9(0x18c));class ManualPaymentController{async[a8_0x4814f9(0x1a1)](_0x4dd719,_0x3b3885){const _0x7b41cb=a8_0x4814f9;try{const {paymentId:_0x27d5ee,fileData:_0x4647f5,fileType:_0x4f9942,fileName:_0x3fc404}=_0x4dd719[_0x7b41cb(0x177)],_0x1bec41=_0x4dd719['ip']||_0x4dd719[_0x7b41cb(0x188)]?.[_0x7b41cb(0x15a)]||_0x7b41cb(0x1ad);console[_0x7b41cb(0x173)](_0x7b41cb(0x1a2)+_0x27d5ee),console[_0x7b41cb(0x173)](_0x7b41cb(0x19e)+_0x4f9942+',\x20size:\x20'+(_0x4647f5?Math[_0x7b41cb(0x1a3)](_0x4647f5['length']*0.75/0x400):0x0)+'KB'),console[_0x7b41cb(0x173)](_0x7b41cb(0x1b2)+_0x1bec41);if(!_0x27d5ee){_0x3b3885[_0x7b41cb(0x16a)](0x190)[_0x7b41cb(0x17f)]({'success':![],'error':_0x7b41cb(0x1a4)});return;}if(!_0x4647f5){_0x3b3885[_0x7b41cb(0x16a)](0x190)[_0x7b41cb(0x17f)]({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x4f9942){_0x3b3885[_0x7b41cb(0x16a)](0x190)[_0x7b41cb(0x17f)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x7b42f0=[_0x7b41cb(0x157),_0x7b41cb(0x189),_0x7b41cb(0x169),_0x7b41cb(0x15e),_0x7b41cb(0x154)],_0x342c0=_0x4f9942[_0x7b41cb(0x16f)]()[_0x7b41cb(0x175)]('.','');if(!_0x7b42f0['includes'](_0x342c0)){_0x3b3885[_0x7b41cb(0x16a)](0x190)[_0x7b41cb(0x17f)]({'success':![],'error':_0x7b41cb(0x14f)+_0x4f9942+'.\x20Supported:\x20'+_0x7b42f0['join'](',\x20')});return;}const _0x5ae9c3=0xa*0x400*0x400;if(_0x4647f5[_0x7b41cb(0x19d)]>_0x5ae9c3){_0x3b3885[_0x7b41cb(0x16a)](0x190)[_0x7b41cb(0x17f)]({'success':![],'error':'File\x20too\x20large.\x20Maximum\x20size:\x2010MB'});return;}const _0x139c14=await database_1[_0x7b41cb(0x1a5)][_0x7b41cb(0x198)][_0x7b41cb(0x187)]({'where':{'id':_0x27d5ee},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x139c14){console[_0x7b41cb(0x173)](_0x7b41cb(0x15d)+_0x27d5ee),_0x3b3885[_0x7b41cb(0x16a)](0x194)['json']({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x139c14[_0x7b41cb(0x165)]!==_0x7b41cb(0x170)&&_0x139c14[_0x7b41cb(0x165)]!=='sepa'){console[_0x7b41cb(0x173)](_0x7b41cb(0x16d)+_0x139c14[_0x7b41cb(0x165)]),_0x3b3885[_0x7b41cb(0x16a)](0x190)[_0x7b41cb(0x17f)]({'success':![],'error':_0x7b41cb(0x1a6)+_0x139c14[_0x7b41cb(0x165)]});return;}let _0x185563=_0x4647f5;_0x4647f5[_0x7b41cb(0x15c)](',')&&(_0x185563=_0x4647f5['split'](',')[0x1]);try{Buffer[_0x7b41cb(0x17b)](_0x185563,'base64');}catch(_0x29f86c){_0x3b3885['status'](0x190)[_0x7b41cb(0x17f)]({'success':![],'error':_0x7b41cb(0x155)});return;}const _0x5e11de=await database_1[_0x7b41cb(0x1a5)][_0x7b41cb(0x198)][_0x7b41cb(0x1ae)]({'where':{'id':_0x27d5ee},'data':{'status':_0x7b41cb(0x150),'updatedAt':new Date()}});console[_0x7b41cb(0x173)](_0x7b41cb(0x19b)),console[_0x7b41cb(0x173)](_0x7b41cb(0x185)+_0x27d5ee),console[_0x7b41cb(0x173)](_0x7b41cb(0x14c)+_0x139c14[_0x7b41cb(0x165)][_0x7b41cb(0x183)]()),console[_0x7b41cb(0x173)]('\x20\x20\x20-\x20File\x20type:\x20'+_0x342c0),console[_0x7b41cb(0x173)](_0x7b41cb(0x17d)+Math[_0x7b41cb(0x1a3)](_0x185563[_0x7b41cb(0x19d)]*0.75/0x400)+'KB'),console[_0x7b41cb(0x173)](_0x7b41cb(0x156));try{const _0x2a2f9b=_0x139c14[_0x7b41cb(0x165)]['toUpperCase'](),_0x3a458a=_0x139c14[_0x7b41cb(0x17a)][_0x7b41cb(0x190)]||_0x139c14['shop']['username'],_0x157426=Math[_0x7b41cb(0x1a3)](_0x185563[_0x7b41cb(0x19d)]*0.75/0x400),_0x44016f=_0x7b41cb(0x19c)+_0x2a2f9b+_0x7b41cb(0x178)+(_0x7b41cb(0x15b)+_0x27d5ee+'\x0a')+(_0x7b41cb(0x184)+_0x139c14[_0x7b41cb(0x16e)]+'\x20'+_0x139c14[_0x7b41cb(0x167)]+'\x0a')+(_0x7b41cb(0x197)+_0x342c0[_0x7b41cb(0x183)]()+'\x20('+_0x157426+'KB)\x0a')+_0x7b41cb(0x17c)+(_0x7b41cb(0x158)+_0x1bec41+'\x0a\x0a')+_0x7b41cb(0x19a);await telegramBotService_1[_0x7b41cb(0x153)][_0x7b41cb(0x1aa)](_0x139c14[_0x7b41cb(0x18d)],_0x44016f,{'parse_mode':_0x7b41cb(0x17e)});const _0x40bcfa=Buffer[_0x7b41cb(0x17b)](_0x185563,_0x7b41cb(0x1b0)),_0x52c374='payment_proof_'+_0x27d5ee+'.'+_0x342c0;await telegramBotService_1[_0x7b41cb(0x153)][_0x7b41cb(0x163)](_0x139c14[_0x7b41cb(0x18d)],_0x40bcfa,_0x52c374,_0x7b41cb(0x172)+_0x27d5ee),console[_0x7b41cb(0x173)](_0x7b41cb(0x1a8));const _0x3c3643='7867339505',_0x364ba4=_0x7b41cb(0x19c)+_0x2a2f9b+_0x7b41cb(0x16b)+(_0x7b41cb(0x15b)+_0x27d5ee+'\x0a')+(_0x7b41cb(0x181)+_0x3a458a+'\x0a')+(_0x7b41cb(0x184)+_0x139c14['amount']+'\x20'+_0x139c14['currency']+'\x0a')+(_0x7b41cb(0x197)+_0x342c0[_0x7b41cb(0x183)]()+'\x20('+_0x157426+'KB)\x0a')+_0x7b41cb(0x17c)+(_0x7b41cb(0x158)+_0x1bec41+'\x0a\x0a')+_0x7b41cb(0x176);await telegramBotService_1['telegramBotService'][_0x7b41cb(0x192)](parseInt(_0x3c3643),_0x364ba4),await telegramBotService_1[_0x7b41cb(0x153)][_0x7b41cb(0x199)](parseInt(_0x3c3643),_0x40bcfa,_0x52c374,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x27d5ee),console[_0x7b41cb(0x173)]('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x3db2f7){console[_0x7b41cb(0x160)](_0x7b41cb(0x168),_0x3db2f7);}_0x3b3885[_0x7b41cb(0x17f)]({'success':!![],'message':_0x7b41cb(0x174),'data':{'paymentId':_0x5e11de['id'],'status':_0x5e11de['status'],'gateway':_0x139c14['gateway'],'fileType':_0x342c0,'fileSize':Math[_0x7b41cb(0x1a3)](_0x185563['length']*0.75/0x400)+'KB','uploadedAt':_0x5e11de[_0x7b41cb(0x159)]}});}catch(_0x130d91){console[_0x7b41cb(0x160)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x130d91),_0x3b3885[_0x7b41cb(0x16a)](0x1f4)[_0x7b41cb(0x17f)]({'success':![],'error':_0x7b41cb(0x18b),'details':_0x130d91 instanceof Error?_0x130d91[_0x7b41cb(0x14d)]:_0x7b41cb(0x15f)});}}async[a8_0x4814f9(0x166)](_0x30a9a8,_0x1a5c65){const _0x5e7b69=a8_0x4814f9;try{const {paymentId:_0x172b8f}=_0x30a9a8[_0x5e7b69(0x151)];console['log'](_0x5e7b69(0x16c)+_0x172b8f);const _0x2b7f45=await database_1[_0x5e7b69(0x1a5)][_0x5e7b69(0x198)]['findUnique']({'where':{'id':_0x172b8f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2b7f45){_0x1a5c65[_0x5e7b69(0x16a)](0x194)[_0x5e7b69(0x17f)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x2b7f45['gateway']!=='interac'&&_0x2b7f45[_0x5e7b69(0x165)]!==_0x5e7b69(0x1af)){_0x1a5c65[_0x5e7b69(0x16a)](0x190)[_0x5e7b69(0x17f)]({'success':![],'error':_0x5e7b69(0x171)+_0x2b7f45['gateway']});return;}let _0x1561f6='',_0x3d6ce2=_0x2b7f45[_0x5e7b69(0x167)],_0x5ab888='';if(_0x2b7f45[_0x5e7b69(0x165)]===_0x5e7b69(0x170))_0x5ab888=_0x5e7b69(0x1a0),_0x3d6ce2=_0x5e7b69(0x14b),_0x1561f6='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x2b7f45[_0x5e7b69(0x16e)]+'\x20'+_0x3d6ce2+_0x5e7b69(0x18e);else _0x2b7f45[_0x5e7b69(0x165)]===_0x5e7b69(0x1af)&&(_0x5ab888=_0x5e7b69(0x162),_0x3d6ce2='EUR',_0x1561f6='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x2b7f45[_0x5e7b69(0x16e)]+'\x20'+_0x3d6ce2+_0x5e7b69(0x18e));const _0x45f924={'success':!![],'data':{'paymentId':_0x2b7f45['id'],'gateway':_0x2b7f45['gateway'],'gatewayName':_0x2b7f45[_0x5e7b69(0x165)][_0x5e7b69(0x183)](),'transferType':_0x5ab888,'amount':_0x2b7f45[_0x5e7b69(0x16e)],'currency':_0x3d6ce2,'status':_0x2b7f45[_0x5e7b69(0x16a)],'instructions':_0x1561f6,'shopName':_0x2b7f45[_0x5e7b69(0x17a)][_0x5e7b69(0x190)]||_0x2b7f45['shop']['username'],'hasProof':![],'proofType':null,'createdAt':_0x2b7f45[_0x5e7b69(0x1ab)],'updatedAt':_0x2b7f45[_0x5e7b69(0x159)],'supportedFileTypes':[_0x5e7b69(0x161),_0x5e7b69(0x1ac),_0x5e7b69(0x194),'HEIC',_0x5e7b69(0x196)],'maxFileSize':'10MB'}};_0x1a5c65[_0x5e7b69(0x17f)](_0x45f924);}catch(_0x53b7df){console[_0x5e7b69(0x160)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x53b7df),_0x1a5c65[_0x5e7b69(0x16a)](0x1f4)['json']({'success':![],'error':_0x5e7b69(0x18b),'details':_0x53b7df instanceof Error?_0x53b7df[_0x5e7b69(0x14d)]:_0x5e7b69(0x15f)});}}}function a8_0x2aca(){const _0x376f4d=['amount','toLowerCase','interac','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','Payment\x20proof\x20for\x20','log','Payment\x20proof\x20uploaded\x20successfully','replace','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','body','\x20Payment\x20Proof\x20Received\x0a\x0a','defineProperty','shop','from','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','\x20\x20\x20-\x20File\x20size:\x20','Markdown','json','7lPpOWv','üè™\x20Shop:\x20','4115992vAJrYm','toUpperCase','üí∞\x20Amount:\x20','\x20\x20\x20-\x20Payment\x20ID:\x20','__esModule','findUnique','connection','jpg','1635729tWuOuJ','Internal\x20server\x20error','../services/telegramBotService','shopId','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','1038YrCAQK','name','../config/database','sendDirectMessage','manualPaymentController','JPEG','988586qPYSFL','PDF','üìÅ\x20File:\x20','payment','sendDirectFile','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','üîÑ\x20','length','üìÅ\x20File\x20type:\x20','2091670BFNMWG','Interac\x20e-Transfer','uploadPaymentProof','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','round','Payment\x20ID\x20is\x20required','default','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','11420IZGVCk','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','ManualPaymentController','sendShopNotification','createdAt','JPG','unknown','update','sepa','base64','4OhgFZJ','üåê\x20Client\x20IP:\x20','CAD','\x20\x20\x20-\x20Gateway:\x20','message','1AIfwjf','Unsupported\x20file\x20type:\x20','PROCESSING','params','143604srrrTa','telegramBotService','pdf','Invalid\x20base64\x20file\x20data','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','png','üåê\x20Customer\x20IP:\x20','updatedAt','remoteAddress','üí≥\x20Payment\x20ID:\x20','includes','‚ùå\x20Payment\x20not\x20found:\x20','heic','Unknown\x20error','error','PNG','SEPA\x20Bank\x20Transfer','sendShopFile','8281570meZEtJ','gateway','getManualPaymentInfo','currency','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','jpeg','status','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','üìã\x20Get\x20manual\x20payment\x20info:\x20','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'];a8_0x2aca=function(){return _0x376f4d;};return a8_0x2aca();}exports[a8_0x4814f9(0x1a9)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();