'use strict';const a10_0x380f17=a10_0x9e9e;function a10_0x9e9e(_0xad2ce3,_0x3a1db1){_0xad2ce3=_0xad2ce3-0xc2;const _0x133a88=a10_0x133a();let _0x9e9e58=_0x133a88[_0xad2ce3];return _0x9e9e58;}(function(_0x1bb53f,_0x41a7dc){const _0x15648e=a10_0x9e9e,_0x3d5408=_0x1bb53f();while(!![]){try{const _0x28c284=-parseInt(_0x15648e(0xf3))/0x1*(-parseInt(_0x15648e(0xe5))/0x2)+parseInt(_0x15648e(0xea))/0x3+-parseInt(_0x15648e(0x12e))/0x4*(-parseInt(_0x15648e(0xe3))/0x5)+parseInt(_0x15648e(0xdb))/0x6+-parseInt(_0x15648e(0x120))/0x7*(-parseInt(_0x15648e(0x123))/0x8)+parseInt(_0x15648e(0x11b))/0x9+parseInt(_0x15648e(0x128))/0xa*(-parseInt(_0x15648e(0xee))/0xb);if(_0x28c284===_0x41a7dc)break;else _0x3d5408['push'](_0x3d5408['shift']());}catch(_0x45481e){_0x3d5408['push'](_0x3d5408['shift']());}}}(a10_0x133a,0x7904c));function a10_0x133a(){const _0x1a5f68=['sendDirectMessage','round','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','update','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','Payment\x20ID\x20is\x20required','Unknown\x20error','üìã\x20Get\x20manual\x20payment\x20info:\x20','\x20\x20\x20-\x20Gateway:\x20','üåê\x20Customer\x20IP:\x20','KB)\x0a','error','ManualPaymentController','3313896acaotT','shopId','join','Payment\x20proof\x20for\x20','length','üí≥\x20Payment\x20ID:\x20','jpeg','../config/database','190HmhyIR','../services/telegramBotService','2PxwAsS','pdf','body','Payment\x20proof\x20uploaded\x20successfully','‚ùå\x20Upload\x20payment\x20proof\x20error:','1120092uiKImw','interac','PNG','telegramBotService','33iKtSBJ','from','File\x20data\x20is\x20required','üì±\x20Admin\x20notification\x20and\x20file\x20sent','üí∞\x20Amount:\x20','479164eaCqFJ','getManualPaymentInfo','includes','CAD','name','üåê\x20Client\x20IP:\x20','toUpperCase','Interac\x20e-Transfer','Unsupported\x20file\x20type:\x20','sendDirectFile','createdAt','Invalid\x20base64\x20file\x20data','Internal\x20server\x20error','status','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','üîÑ\x20','amount','toLowerCase','base64','File\x20type\x20is\x20required','__importDefault','EUR','.\x20Supported:\x20','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','currency','üìÅ\x20File:\x20','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','sendShopNotification','payment','sepa','gateway','\x20\x20\x20-\x20Payment\x20ID:\x20','\x20\x20\x20-\x20File\x20size:\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','Payment\x20not\x20found','json','üìÅ\x20File\x20type:\x20','manualPaymentController','split','__esModule','2130633TSVuqy','SEPA\x20Bank\x20Transfer','10MB','default','PROCESSING','913766CyqzRO','username','üè™\x20Shop:\x20','40iAIhWy','‚ùå\x20Payment\x20not\x20found:\x20','shop','\x20Payment\x20Proof\x20Received\x0a\x0a','log','9045650OPqmHB','params','heic','JPG','JPEG','connection','96328TypdQS','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20',',\x20size:\x20','findUnique','jpg','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','unknown','defineProperty','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','replace','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','7867339505','png'];a10_0x133a=function(){return _0x1a5f68;};return a10_0x133a();}var __importDefault=this&&this[a10_0x380f17(0x107)]||function(_0x4633a9){const _0x123cb3=a10_0x380f17;return _0x4633a9&&_0x4633a9[_0x123cb3(0x11a)]?_0x4633a9:{'default':_0x4633a9};};Object[a10_0x380f17(0xc7)](exports,a10_0x380f17(0x11a),{'value':!![]}),exports[a10_0x380f17(0x118)]=exports[a10_0x380f17(0xda)]=void 0x0;const database_1=__importDefault(require(a10_0x380f17(0xe2))),telegramBotService_1=require(a10_0x380f17(0xe4));class ManualPaymentController{async['uploadPaymentProof'](_0x37fad7,_0x310fe7){const _0x8293c0=a10_0x380f17;try{const {paymentId:_0x4ef931,fileData:_0x357bab,fileType:_0xdd9659,fileName:_0x4f6db8}=_0x37fad7[_0x8293c0(0xe7)],_0x286109=_0x37fad7['ip']||_0x37fad7[_0x8293c0(0x12d)]?.['remoteAddress']||_0x8293c0(0xc6);console[_0x8293c0(0x127)]('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x4ef931),console[_0x8293c0(0x127)](_0x8293c0(0x117)+_0xdd9659+_0x8293c0(0x130)+(_0x357bab?Math['round'](_0x357bab['length']*0.75/0x400):0x0)+'KB'),console[_0x8293c0(0x127)](_0x8293c0(0xf8)+_0x286109);if(!_0x4ef931){_0x310fe7['status'](0x190)[_0x8293c0(0x116)]({'success':![],'error':_0x8293c0(0xd3)});return;}if(!_0x357bab){_0x310fe7[_0x8293c0(0x100)](0x190)[_0x8293c0(0x116)]({'success':![],'error':_0x8293c0(0xf0)});return;}if(!_0xdd9659){_0x310fe7['status'](0x190)['json']({'success':![],'error':_0x8293c0(0x106)});return;}const _0x1521fe=[_0x8293c0(0xcc),_0x8293c0(0xc2),_0x8293c0(0xe1),_0x8293c0(0x12a),_0x8293c0(0xe6)],_0x4b5e4e=_0xdd9659[_0x8293c0(0x104)]()[_0x8293c0(0xc9)]('.','');if(!_0x1521fe[_0x8293c0(0xf5)](_0x4b5e4e)){_0x310fe7[_0x8293c0(0x100)](0x190)[_0x8293c0(0x116)]({'success':![],'error':_0x8293c0(0xfb)+_0xdd9659+_0x8293c0(0x109)+_0x1521fe[_0x8293c0(0xdd)](',\x20')});return;}const _0x30bced=0xa*0x400*0x400;if(_0x357bab['length']>_0x30bced){_0x310fe7[_0x8293c0(0x100)](0x190)[_0x8293c0(0x116)]({'success':![],'error':_0x8293c0(0xd2)});return;}const _0x111db6=await database_1[_0x8293c0(0x11e)][_0x8293c0(0x10f)][_0x8293c0(0x131)]({'where':{'id':_0x4ef931},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x111db6){console[_0x8293c0(0x127)](_0x8293c0(0x124)+_0x4ef931),_0x310fe7['status'](0x194)['json']({'success':![],'error':_0x8293c0(0x115)});return;}if(_0x111db6['gateway']!==_0x8293c0(0xeb)&&_0x111db6[_0x8293c0(0x111)]!==_0x8293c0(0x110)){console['log']('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x111db6['gateway']),_0x310fe7[_0x8293c0(0x100)](0x190)['json']({'success':![],'error':_0x8293c0(0xc5)+_0x111db6['gateway']});return;}let _0x2bbcee=_0x357bab;_0x357bab[_0x8293c0(0xf5)](',')&&(_0x2bbcee=_0x357bab[_0x8293c0(0x119)](',')[0x1]);try{Buffer[_0x8293c0(0xef)](_0x2bbcee,_0x8293c0(0x105));}catch(_0x551b25){_0x310fe7[_0x8293c0(0x100)](0x190)['json']({'success':![],'error':_0x8293c0(0xfe)});return;}const _0x3d400e=await database_1['default'][_0x8293c0(0x10f)][_0x8293c0(0xd1)]({'where':{'id':_0x4ef931},'data':{'status':_0x8293c0(0x11f),'updatedAt':new Date()}});console['log'](_0x8293c0(0xc4)),console[_0x8293c0(0x127)](_0x8293c0(0x112)+_0x4ef931),console[_0x8293c0(0x127)](_0x8293c0(0xd6)+_0x111db6[_0x8293c0(0x111)][_0x8293c0(0xf9)]()),console[_0x8293c0(0x127)]('\x20\x20\x20-\x20File\x20type:\x20'+_0x4b5e4e),console[_0x8293c0(0x127)](_0x8293c0(0x113)+Math[_0x8293c0(0xce)](_0x2bbcee[_0x8293c0(0xdf)]*0.75/0x400)+'KB'),console[_0x8293c0(0x127)](_0x8293c0(0x114));try{const _0x5afb4d=_0x111db6[_0x8293c0(0x111)][_0x8293c0(0xf9)](),_0x808682=_0x111db6[_0x8293c0(0x125)]['name']||_0x111db6[_0x8293c0(0x125)][_0x8293c0(0x121)],_0x559bd8=Math[_0x8293c0(0xce)](_0x2bbcee[_0x8293c0(0xdf)]*0.75/0x400),_0x2984b9='üîÑ\x20'+_0x5afb4d+_0x8293c0(0x126)+(_0x8293c0(0xe0)+_0x4ef931+'\x0a')+(_0x8293c0(0xf2)+_0x111db6[_0x8293c0(0x103)]+'\x20'+_0x111db6[_0x8293c0(0x10b)]+'\x0a')+(_0x8293c0(0x10c)+_0x4b5e4e[_0x8293c0(0xf9)]()+'\x20('+_0x559bd8+'KB)\x0a')+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+('üåê\x20Customer\x20IP:\x20'+_0x286109+'\x0a\x0a')+_0x8293c0(0xca);await telegramBotService_1[_0x8293c0(0xed)][_0x8293c0(0x10e)](_0x111db6[_0x8293c0(0xdc)],_0x2984b9,{'parse_mode':'Markdown'});const _0x8e7b02=Buffer[_0x8293c0(0xef)](_0x2bbcee,_0x8293c0(0x105)),_0x1e03b7='payment_proof_'+_0x4ef931+'.'+_0x4b5e4e;await telegramBotService_1[_0x8293c0(0xed)]['sendShopFile'](_0x111db6[_0x8293c0(0xdc)],_0x8e7b02,_0x1e03b7,_0x8293c0(0xde)+_0x4ef931),console[_0x8293c0(0x127)](_0x8293c0(0x101));const _0x2c3a24=_0x8293c0(0xcb),_0x5111db=_0x8293c0(0x102)+_0x5afb4d+_0x8293c0(0x10a)+(_0x8293c0(0xe0)+_0x4ef931+'\x0a')+(_0x8293c0(0x122)+_0x808682+'\x0a')+('üí∞\x20Amount:\x20'+_0x111db6[_0x8293c0(0x103)]+'\x20'+_0x111db6['currency']+'\x0a')+(_0x8293c0(0x10c)+_0x4b5e4e[_0x8293c0(0xf9)]()+'\x20('+_0x559bd8+_0x8293c0(0xd8))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x8293c0(0xd7)+_0x286109+'\x0a\x0a')+_0x8293c0(0xcf);await telegramBotService_1[_0x8293c0(0xed)][_0x8293c0(0xcd)](parseInt(_0x2c3a24),_0x5111db),await telegramBotService_1[_0x8293c0(0xed)][_0x8293c0(0xfc)](parseInt(_0x2c3a24),_0x8e7b02,_0x1e03b7,_0x8293c0(0xc3)+_0x4ef931),console[_0x8293c0(0x127)](_0x8293c0(0xf1));}catch(_0x1b310c){console[_0x8293c0(0xd9)](_0x8293c0(0xd0),_0x1b310c);}_0x310fe7[_0x8293c0(0x116)]({'success':!![],'message':_0x8293c0(0xe8),'data':{'paymentId':_0x3d400e['id'],'status':_0x3d400e[_0x8293c0(0x100)],'gateway':_0x111db6[_0x8293c0(0x111)],'fileType':_0x4b5e4e,'fileSize':Math[_0x8293c0(0xce)](_0x2bbcee['length']*0.75/0x400)+'KB','uploadedAt':_0x3d400e['updatedAt']}});}catch(_0x2c666b){console[_0x8293c0(0xd9)](_0x8293c0(0xe9),_0x2c666b),_0x310fe7[_0x8293c0(0x100)](0x1f4)[_0x8293c0(0x116)]({'success':![],'error':_0x8293c0(0xff),'details':_0x2c666b instanceof Error?_0x2c666b['message']:_0x8293c0(0xd4)});}}async[a10_0x380f17(0xf4)](_0x408dc2,_0x5c7f93){const _0x5bd8b7=a10_0x380f17;try{const {paymentId:_0x4810cd}=_0x408dc2[_0x5bd8b7(0x129)];console[_0x5bd8b7(0x127)](_0x5bd8b7(0xd5)+_0x4810cd);const _0x276152=await database_1[_0x5bd8b7(0x11e)][_0x5bd8b7(0x10f)]['findUnique']({'where':{'id':_0x4810cd},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x276152){_0x5c7f93[_0x5bd8b7(0x100)](0x194)[_0x5bd8b7(0x116)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x276152['gateway']!==_0x5bd8b7(0xeb)&&_0x276152['gateway']!==_0x5bd8b7(0x110)){_0x5c7f93[_0x5bd8b7(0x100)](0x190)['json']({'success':![],'error':_0x5bd8b7(0x12f)+_0x276152[_0x5bd8b7(0x111)]});return;}let _0x1fda31='',_0x98b26e=_0x276152['currency'],_0x4a368d='';if(_0x276152[_0x5bd8b7(0x111)]==='interac')_0x4a368d=_0x5bd8b7(0xfa),_0x98b26e=_0x5bd8b7(0xf6),_0x1fda31='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x276152[_0x5bd8b7(0x103)]+'\x20'+_0x98b26e+_0x5bd8b7(0xc8);else _0x276152[_0x5bd8b7(0x111)]==='sepa'&&(_0x4a368d=_0x5bd8b7(0x11c),_0x98b26e=_0x5bd8b7(0x108),_0x1fda31=_0x5bd8b7(0x10d)+_0x276152['amount']+'\x20'+_0x98b26e+_0x5bd8b7(0xc8));const _0x2dc40a={'success':!![],'data':{'paymentId':_0x276152['id'],'gateway':_0x276152[_0x5bd8b7(0x111)],'gatewayName':_0x276152[_0x5bd8b7(0x111)][_0x5bd8b7(0xf9)](),'transferType':_0x4a368d,'amount':_0x276152[_0x5bd8b7(0x103)],'currency':_0x98b26e,'status':_0x276152[_0x5bd8b7(0x100)],'instructions':_0x1fda31,'shopName':_0x276152['shop'][_0x5bd8b7(0xf7)]||_0x276152[_0x5bd8b7(0x125)][_0x5bd8b7(0x121)],'hasProof':![],'proofType':null,'createdAt':_0x276152[_0x5bd8b7(0xfd)],'updatedAt':_0x276152['updatedAt'],'supportedFileTypes':[_0x5bd8b7(0xec),_0x5bd8b7(0x12b),_0x5bd8b7(0x12c),'HEIC','PDF'],'maxFileSize':_0x5bd8b7(0x11d)}};_0x5c7f93[_0x5bd8b7(0x116)](_0x2dc40a);}catch(_0x20c789){console[_0x5bd8b7(0xd9)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x20c789),_0x5c7f93['status'](0x1f4)[_0x5bd8b7(0x116)]({'success':![],'error':_0x5bd8b7(0xff),'details':_0x20c789 instanceof Error?_0x20c789['message']:_0x5bd8b7(0xd4)});}}}exports[a10_0x380f17(0xda)]=ManualPaymentController,exports[a10_0x380f17(0x118)]=new ManualPaymentController();