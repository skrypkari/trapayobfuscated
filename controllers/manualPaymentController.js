'use strict';const a9_0x212098=a9_0x3063;(function(_0x1644a0,_0x14f8b3){const _0xa7d587=a9_0x3063,_0x3fda16=_0x1644a0();while(!![]){try{const _0x41a363=-parseInt(_0xa7d587(0xd7))/0x1*(-parseInt(_0xa7d587(0xb6))/0x2)+parseInt(_0xa7d587(0xb2))/0x3*(parseInt(_0xa7d587(0xe2))/0x4)+-parseInt(_0xa7d587(0x8a))/0x5*(parseInt(_0xa7d587(0xe6))/0x6)+parseInt(_0xa7d587(0xef))/0x7*(-parseInt(_0xa7d587(0xd5))/0x8)+parseInt(_0xa7d587(0x89))/0x9+-parseInt(_0xa7d587(0xa6))/0xa+-parseInt(_0xa7d587(0xcb))/0xb*(-parseInt(_0xa7d587(0xd2))/0xc);if(_0x41a363===_0x14f8b3)break;else _0x3fda16['push'](_0x3fda16['shift']());}catch(_0x2cb0fd){_0x3fda16['push'](_0x3fda16['shift']());}}}(a9_0x5c49,0x27633));var __importDefault=this&&this[a9_0x212098(0xd9)]||function(_0x19ccb4){const _0xd8cf20=a9_0x212098;return _0x19ccb4&&_0x19ccb4[_0xd8cf20(0xed)]?_0x19ccb4:{'default':_0x19ccb4};};Object[a9_0x212098(0xbd)](exports,'__esModule',{'value':!![]}),exports['manualPaymentController']=exports[a9_0x212098(0xcc)]=void 0x0;const database_1=__importDefault(require(a9_0x212098(0xe7))),telegramBotService_1=require(a9_0x212098(0x9b));function a9_0x3063(_0x244940,_0x4ba7d7){_0x244940=_0x244940-0x89;const _0x5c49eb=a9_0x5c49();let _0x306338=_0x5c49eb[_0x244940];return _0x306338;}function a9_0x5c49(){const _0x5b640b=['Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','5071eAwlkL','ManualPaymentController','\x20Payment\x20Proof\x20Received\x0a\x0a','Payment\x20ID\x20is\x20required','.\x20Supported:\x20','replace','üì±\x20Admin\x20notification\x20and\x20file\x20sent','10668swZtyz','sepa','üí∞\x20Amount:\x20','296pBhApU','telegramBotService','104123XlwvdK','uploadPaymentProof','__importDefault','10MB','updatedAt','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','Payment\x20proof\x20for\x20','message','File\x20type\x20is\x20required','toUpperCase','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','5692GTbwxw','gateway','join','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','6JJvbJN','../config/database','sendShopFile','üìÅ\x20File\x20type:\x20','payment','base64','jpeg','__esModule','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','59535tNXxwn','JPG','shop','username','1906200axQxuC','1518395RywGtz','status','SEPA\x20Bank\x20Transfer','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','shopId','Unknown\x20error','getManualPaymentInfo','json','manualPaymentController','üåê\x20Customer\x20IP:\x20','\x20\x20\x20-\x20File\x20size:\x20','JPEG','‚ùå\x20Upload\x20payment\x20proof\x20error:','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','findUnique','pdf','../services/telegramBotService','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','amount','body','Markdown','Payment\x20not\x20found','currency','update','interac','error','includes','1580840NMUAOu','sendDirectFile','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','7867339505','params','sendDirectMessage','createdAt','üîÑ\x20','üìã\x20Get\x20manual\x20payment\x20info:\x20','PNG','\x20\x20\x20-\x20Payment\x20ID:\x20','sendShopNotification','447tDPNuF','jpg','log','Invalid\x20base64\x20file\x20data','2ScXZJt','remoteAddress','length','name','üìÅ\x20File:\x20','round','split','defineProperty','File\x20data\x20is\x20required','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','from','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','default','Internal\x20server\x20error','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','png','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','PDF','üí≥\x20Payment\x20ID:\x20'];a9_0x5c49=function(){return _0x5b640b;};return a9_0x5c49();}class ManualPaymentController{async[a9_0x212098(0xd8)](_0x39cdfd,_0x41b854){const _0x16fc1b=a9_0x212098;try{const {paymentId:_0x3e9bbb,fileData:_0x5421e4,fileType:_0x540052,fileName:_0x194ee3}=_0x39cdfd[_0x16fc1b(0x9e)],_0x2d7f90=_0x39cdfd['ip']||_0x39cdfd['connection']?.[_0x16fc1b(0xb7)]||'unknown';console[_0x16fc1b(0xb4)](_0x16fc1b(0x98)+_0x3e9bbb),console[_0x16fc1b(0xb4)](_0x16fc1b(0xe9)+_0x540052+',\x20size:\x20'+(_0x5421e4?Math['round'](_0x5421e4[_0x16fc1b(0xb8)]*0.75/0x400):0x0)+'KB'),console['log']('üåê\x20Client\x20IP:\x20'+_0x2d7f90);if(!_0x3e9bbb){_0x41b854['status'](0x190)[_0x16fc1b(0x92)]({'success':![],'error':_0x16fc1b(0xce)});return;}if(!_0x5421e4){_0x41b854[_0x16fc1b(0x8b)](0x190)['json']({'success':![],'error':_0x16fc1b(0xbe)});return;}if(!_0x540052){_0x41b854['status'](0x190)[_0x16fc1b(0x92)]({'success':![],'error':_0x16fc1b(0xdf)});return;}const _0xf71beb=[_0x16fc1b(0xc6),_0x16fc1b(0xb3),_0x16fc1b(0xec),'heic',_0x16fc1b(0x9a)],_0x1435e2=_0x540052['toLowerCase']()[_0x16fc1b(0xd0)]('.','');if(!_0xf71beb['includes'](_0x1435e2)){_0x41b854[_0x16fc1b(0x8b)](0x190)[_0x16fc1b(0x92)]({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x540052+_0x16fc1b(0xcf)+_0xf71beb[_0x16fc1b(0xe4)](',\x20')});return;}const _0x4da390=0xa*0x400*0x400;if(_0x5421e4[_0x16fc1b(0xb8)]>_0x4da390){_0x41b854[_0x16fc1b(0x8b)](0x190)['json']({'success':![],'error':_0x16fc1b(0xc2)});return;}const _0x2d55b4=await database_1[_0x16fc1b(0xc3)][_0x16fc1b(0xea)][_0x16fc1b(0x99)]({'where':{'id':_0x3e9bbb},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2d55b4){console[_0x16fc1b(0xb4)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x3e9bbb),_0x41b854[_0x16fc1b(0x8b)](0x194)[_0x16fc1b(0x92)]({'success':![],'error':_0x16fc1b(0xa0)});return;}if(_0x2d55b4[_0x16fc1b(0xe3)]!==_0x16fc1b(0xa3)&&_0x2d55b4[_0x16fc1b(0xe3)]!==_0x16fc1b(0xd3)){console[_0x16fc1b(0xb4)]('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x2d55b4[_0x16fc1b(0xe3)]),_0x41b854['status'](0x190)[_0x16fc1b(0x92)]({'success':![],'error':_0x16fc1b(0xca)+_0x2d55b4['gateway']});return;}let _0x5b4135=_0x5421e4;_0x5421e4[_0x16fc1b(0xa5)](',')&&(_0x5b4135=_0x5421e4[_0x16fc1b(0xbc)](',')[0x1]);try{Buffer[_0x16fc1b(0xc0)](_0x5b4135,_0x16fc1b(0xeb));}catch(_0x414a37){_0x41b854['status'](0x190)[_0x16fc1b(0x92)]({'success':![],'error':_0x16fc1b(0xb5)});return;}const _0x4a5f6b=await database_1[_0x16fc1b(0xc3)][_0x16fc1b(0xea)][_0x16fc1b(0xa2)]({'where':{'id':_0x3e9bbb},'data':{'status':'PROCESSING','updatedAt':new Date()}});console['log'](_0x16fc1b(0xc7)),console['log'](_0x16fc1b(0xb0)+_0x3e9bbb),console[_0x16fc1b(0xb4)]('\x20\x20\x20-\x20Gateway:\x20'+_0x2d55b4['gateway']['toUpperCase']()),console['log']('\x20\x20\x20-\x20File\x20type:\x20'+_0x1435e2),console[_0x16fc1b(0xb4)](_0x16fc1b(0x95)+Math[_0x16fc1b(0xbb)](_0x5b4135['length']*0.75/0x400)+'KB'),console['log']('\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING');try{const _0x477379=_0x2d55b4[_0x16fc1b(0xe3)][_0x16fc1b(0xe0)](),_0x1b2f6d=_0x2d55b4['shop']['name']||_0x2d55b4[_0x16fc1b(0xf1)][_0x16fc1b(0xf2)],_0x2f2fdb=Math[_0x16fc1b(0xbb)](_0x5b4135[_0x16fc1b(0xb8)]*0.75/0x400),_0x16bdd1=_0x16fc1b(0xad)+_0x477379+_0x16fc1b(0xcd)+(_0x16fc1b(0xc9)+_0x3e9bbb+'\x0a')+('üí∞\x20Amount:\x20'+_0x2d55b4[_0x16fc1b(0x9d)]+'\x20'+_0x2d55b4['currency']+'\x0a')+(_0x16fc1b(0xba)+_0x1435e2[_0x16fc1b(0xe0)]()+'\x20('+_0x2f2fdb+'KB)\x0a')+_0x16fc1b(0xee)+(_0x16fc1b(0x94)+_0x2d7f90+'\x0a\x0a')+_0x16fc1b(0x9c);await telegramBotService_1['telegramBotService'][_0x16fc1b(0xb1)](_0x2d55b4[_0x16fc1b(0x8f)],_0x16bdd1,{'parse_mode':_0x16fc1b(0x9f)});const _0x1806d8=Buffer[_0x16fc1b(0xc0)](_0x5b4135,_0x16fc1b(0xeb)),_0x14ee21='payment_proof_'+_0x3e9bbb+'.'+_0x1435e2;await telegramBotService_1[_0x16fc1b(0xd6)][_0x16fc1b(0xe8)](_0x2d55b4[_0x16fc1b(0x8f)],_0x1806d8,_0x14ee21,_0x16fc1b(0xdd)+_0x3e9bbb),console['log'](_0x16fc1b(0xbf));const _0x3caf39=_0x16fc1b(0xa9),_0x460f74=_0x16fc1b(0xad)+_0x477379+_0x16fc1b(0xa8)+(_0x16fc1b(0xc9)+_0x3e9bbb+'\x0a')+('üè™\x20Shop:\x20'+_0x1b2f6d+'\x0a')+(_0x16fc1b(0xd4)+_0x2d55b4[_0x16fc1b(0x9d)]+'\x20'+_0x2d55b4[_0x16fc1b(0xa1)]+'\x0a')+('üìÅ\x20File:\x20'+_0x1435e2[_0x16fc1b(0xe0)]()+'\x20('+_0x2f2fdb+'KB)\x0a')+_0x16fc1b(0xee)+(_0x16fc1b(0x94)+_0x2d7f90+'\x0a\x0a')+_0x16fc1b(0xdc);await telegramBotService_1[_0x16fc1b(0xd6)][_0x16fc1b(0xab)](parseInt(_0x3caf39),_0x460f74),await telegramBotService_1[_0x16fc1b(0xd6)][_0x16fc1b(0xa7)](parseInt(_0x3caf39),_0x1806d8,_0x14ee21,_0x16fc1b(0x8e)+_0x3e9bbb),console['log'](_0x16fc1b(0xd1));}catch(_0x54c235){console[_0x16fc1b(0xa4)](_0x16fc1b(0xc5),_0x54c235);}_0x41b854[_0x16fc1b(0x92)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x4a5f6b['id'],'status':_0x4a5f6b[_0x16fc1b(0x8b)],'gateway':_0x2d55b4[_0x16fc1b(0xe3)],'fileType':_0x1435e2,'fileSize':Math['round'](_0x5b4135[_0x16fc1b(0xb8)]*0.75/0x400)+'KB','uploadedAt':_0x4a5f6b['updatedAt']}});}catch(_0x2160d9){console[_0x16fc1b(0xa4)](_0x16fc1b(0x97),_0x2160d9),_0x41b854['status'](0x1f4)[_0x16fc1b(0x92)]({'success':![],'error':_0x16fc1b(0xc4),'details':_0x2160d9 instanceof Error?_0x2160d9[_0x16fc1b(0xde)]:_0x16fc1b(0x90)});}}async[a9_0x212098(0x91)](_0x1c68ec,_0x9665e0){const _0x4a411a=a9_0x212098;try{const {paymentId:_0x1836b0}=_0x1c68ec[_0x4a411a(0xaa)];console['log'](_0x4a411a(0xae)+_0x1836b0);const _0xbf1ddf=await database_1[_0x4a411a(0xc3)][_0x4a411a(0xea)]['findUnique']({'where':{'id':_0x1836b0},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xbf1ddf){_0x9665e0[_0x4a411a(0x8b)](0x194)[_0x4a411a(0x92)]({'success':![],'error':_0x4a411a(0xa0)});return;}if(_0xbf1ddf['gateway']!=='interac'&&_0xbf1ddf[_0x4a411a(0xe3)]!==_0x4a411a(0xd3)){_0x9665e0['status'](0x190)['json']({'success':![],'error':_0x4a411a(0xc1)+_0xbf1ddf[_0x4a411a(0xe3)]});return;}let _0x4a55aa='',_0x31780d=_0xbf1ddf[_0x4a411a(0xa1)],_0x49eec8='';if(_0xbf1ddf[_0x4a411a(0xe3)]===_0x4a411a(0xa3))_0x49eec8='Interac\x20e-Transfer',_0x31780d='CAD',_0x4a55aa=_0x4a411a(0xe5)+_0xbf1ddf[_0x4a411a(0x9d)]+'\x20'+_0x31780d+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.';else _0xbf1ddf[_0x4a411a(0xe3)]===_0x4a411a(0xd3)&&(_0x49eec8=_0x4a411a(0x8c),_0x31780d='EUR',_0x4a55aa='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0xbf1ddf[_0x4a411a(0x9d)]+'\x20'+_0x31780d+_0x4a411a(0x8d));const _0x15b7f5={'success':!![],'data':{'paymentId':_0xbf1ddf['id'],'gateway':_0xbf1ddf['gateway'],'gatewayName':_0xbf1ddf[_0x4a411a(0xe3)][_0x4a411a(0xe0)](),'transferType':_0x49eec8,'amount':_0xbf1ddf[_0x4a411a(0x9d)],'currency':_0x31780d,'status':_0xbf1ddf[_0x4a411a(0x8b)],'instructions':_0x4a55aa,'shopName':_0xbf1ddf[_0x4a411a(0xf1)][_0x4a411a(0xb9)]||_0xbf1ddf[_0x4a411a(0xf1)][_0x4a411a(0xf2)],'hasProof':![],'proofType':null,'createdAt':_0xbf1ddf[_0x4a411a(0xac)],'updatedAt':_0xbf1ddf[_0x4a411a(0xdb)],'supportedFileTypes':[_0x4a411a(0xaf),_0x4a411a(0xf0),_0x4a411a(0x96),'HEIC',_0x4a411a(0xc8)],'maxFileSize':_0x4a411a(0xda)}};_0x9665e0[_0x4a411a(0x92)](_0x15b7f5);}catch(_0x4f5af9){console['error'](_0x4a411a(0xe1),_0x4f5af9),_0x9665e0['status'](0x1f4)[_0x4a411a(0x92)]({'success':![],'error':_0x4a411a(0xc4),'details':_0x4f5af9 instanceof Error?_0x4f5af9[_0x4a411a(0xde)]:_0x4a411a(0x90)});}}}exports['ManualPaymentController']=ManualPaymentController,exports[a9_0x212098(0x93)]=new ManualPaymentController();