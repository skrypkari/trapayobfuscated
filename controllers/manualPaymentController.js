'use strict';function a10_0x6de7(){const _0x260638=['PROCESSING','sendShopNotification','username','1510648cJIbBL','2221924fvcDIK','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','JPG','telegramBotService','includes','üåê\x20Customer\x20IP:\x20','30nUlCNX','manualPaymentController','Internal\x20server\x20error','toUpperCase','findUnique','Interac\x20e-Transfer','name','üè™\x20Shop:\x20','body','log','from','JPEG','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','CAD','Invalid\x20base64\x20file\x20data','224625XFNtES','3912aIPACz','\x20\x20\x20-\x20Gateway:\x20','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','params','üí∞\x20Amount:\x20','sendDirectMessage','__importDefault','10MB','jpeg','gateway','shop','File\x20data\x20is\x20required','base64','Unsupported\x20file\x20type:\x20','default','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','Payment\x20proof\x20for\x20','json','split','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','shopId','currency','183912LGbyqN','interac','pdf','error','üí≥\x20Payment\x20ID:\x20','Unknown\x20error','unknown','toLowerCase','üì±\x20Admin\x20notification\x20and\x20file\x20sent','../services/telegramBotService','message','jpg','amount','üåê\x20Client\x20IP:\x20','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','üìÅ\x20File\x20type:\x20','round','Payment\x20proof\x20uploaded\x20successfully','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','updatedAt','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','createdAt','Markdown','getManualPaymentInfo','payment','EUR','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','5151076hkhdJc','join','‚ùå\x20Payment\x20not\x20found:\x20','\x20Payment\x20Proof\x20Received\x0a\x0a','ManualPaymentController','sepa','Payment\x20not\x20found','status','heic','961858XHiEYC','defineProperty','7867339505','üìÅ\x20File:\x20','File\x20type\x20is\x20required','üîÑ\x20','__esModule','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','length','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'];a10_0x6de7=function(){return _0x260638;};return a10_0x6de7();}const a10_0x2619d7=a10_0x1d7f;(function(_0x12d7f1,_0xde91f){const _0x2b675b=a10_0x1d7f,_0x128a4b=_0x12d7f1();while(!![]){try{const _0x2e4f08=-parseInt(_0x2b675b(0x213))/0x1+-parseInt(_0x2b675b(0x23b))/0x2+parseInt(_0x2b675b(0x1fb))/0x3+parseInt(_0x2b675b(0x1e6))/0x4+parseInt(_0x2b675b(0x1ec))/0x5*(-parseInt(_0x2b675b(0x1fc))/0x6)+parseInt(_0x2b675b(0x232))/0x7+-parseInt(_0x2b675b(0x1e5))/0x8;if(_0x2e4f08===_0xde91f)break;else _0x128a4b['push'](_0x128a4b['shift']());}catch(_0x13ac90){_0x128a4b['push'](_0x128a4b['shift']());}}}(a10_0x6de7,0x7c2e0));var __importDefault=this&&this[a10_0x2619d7(0x202)]||function(_0x548b61){const _0x3d853b=a10_0x2619d7;return _0x548b61&&_0x548b61[_0x3d853b(0x241)]?_0x548b61:{'default':_0x548b61};};function a10_0x1d7f(_0x4804e4,_0x352475){_0x4804e4=_0x4804e4-0x1e5;const _0x6de79e=a10_0x6de7();let _0x1d7fab=_0x6de79e[_0x4804e4];return _0x1d7fab;}Object[a10_0x2619d7(0x23c)](exports,a10_0x2619d7(0x241),{'value':!![]}),exports[a10_0x2619d7(0x1ed)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a10_0x2619d7(0x21c));class ManualPaymentController{async['uploadPaymentProof'](_0x4da796,_0x2a85de){const _0x6a3425=a10_0x2619d7;try{const {paymentId:_0x439759,fileData:_0x37004b,fileType:_0x2714b8,fileName:_0x189bc1}=_0x4da796[_0x6a3425(0x1f4)],_0x5658c3=_0x4da796['ip']||_0x4da796['connection']?.['remoteAddress']||_0x6a3425(0x219);console['log'](_0x6a3425(0x20b)+_0x439759),console[_0x6a3425(0x1f5)](_0x6a3425(0x222)+_0x2714b8+',\x20size:\x20'+(_0x37004b?Math[_0x6a3425(0x223)](_0x37004b[_0x6a3425(0x243)]*0.75/0x400):0x0)+'KB'),console[_0x6a3425(0x1f5)](_0x6a3425(0x220)+_0x5658c3);if(!_0x439759){_0x2a85de['status'](0x190)[_0x6a3425(0x20e)]({'success':![],'error':'Payment\x20ID\x20is\x20required'});return;}if(!_0x37004b){_0x2a85de['status'](0x190)[_0x6a3425(0x20e)]({'success':![],'error':_0x6a3425(0x207)});return;}if(!_0x2714b8){_0x2a85de['status'](0x190)[_0x6a3425(0x20e)]({'success':![],'error':_0x6a3425(0x23f)});return;}const _0x390034=['png',_0x6a3425(0x21e),_0x6a3425(0x204),_0x6a3425(0x23a),_0x6a3425(0x215)],_0x575d11=_0x2714b8[_0x6a3425(0x21a)]()['replace']('.','');if(!_0x390034[_0x6a3425(0x1ea)](_0x575d11)){_0x2a85de[_0x6a3425(0x239)](0x190)[_0x6a3425(0x20e)]({'success':![],'error':_0x6a3425(0x209)+_0x2714b8+'.\x20Supported:\x20'+_0x390034[_0x6a3425(0x233)](',\x20')});return;}const _0x18006b=0xa*0x400*0x400;if(_0x37004b['length']>_0x18006b){_0x2a85de[_0x6a3425(0x239)](0x190)[_0x6a3425(0x20e)]({'success':![],'error':_0x6a3425(0x1e7)});return;}const _0x10b766=await database_1['default'][_0x6a3425(0x22f)][_0x6a3425(0x1f0)]({'where':{'id':_0x439759},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x10b766){console[_0x6a3425(0x1f5)](_0x6a3425(0x234)+_0x439759),_0x2a85de[_0x6a3425(0x239)](0x194)[_0x6a3425(0x20e)]({'success':![],'error':_0x6a3425(0x238)});return;}if(_0x10b766[_0x6a3425(0x205)]!=='interac'&&_0x10b766[_0x6a3425(0x205)]!==_0x6a3425(0x237)){console[_0x6a3425(0x1f5)](_0x6a3425(0x22a)+_0x10b766[_0x6a3425(0x205)]),_0x2a85de[_0x6a3425(0x239)](0x190)['json']({'success':![],'error':_0x6a3425(0x1f8)+_0x10b766[_0x6a3425(0x205)]});return;}let _0x27106a=_0x37004b;_0x37004b[_0x6a3425(0x1ea)](',')&&(_0x27106a=_0x37004b[_0x6a3425(0x20f)](',')[0x1]);try{Buffer['from'](_0x27106a,_0x6a3425(0x208));}catch(_0x15429d){_0x2a85de[_0x6a3425(0x239)](0x190)[_0x6a3425(0x20e)]({'success':![],'error':_0x6a3425(0x1fa)});return;}const _0x5b8197=await database_1[_0x6a3425(0x20a)][_0x6a3425(0x22f)]['update']({'where':{'id':_0x439759},'data':{'status':_0x6a3425(0x245),'updatedAt':new Date()}});console[_0x6a3425(0x1f5)](_0x6a3425(0x229)),console['log']('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x439759),console['log'](_0x6a3425(0x1fd)+_0x10b766['gateway'][_0x6a3425(0x1ef)]()),console[_0x6a3425(0x1f5)]('\x20\x20\x20-\x20File\x20type:\x20'+_0x575d11),console[_0x6a3425(0x1f5)]('\x20\x20\x20-\x20File\x20size:\x20'+Math[_0x6a3425(0x223)](_0x27106a[_0x6a3425(0x243)]*0.75/0x400)+'KB'),console['log'](_0x6a3425(0x228));try{const _0x47eb4c=_0x10b766['gateway']['toUpperCase'](),_0x195b30=_0x10b766[_0x6a3425(0x206)][_0x6a3425(0x1f2)]||_0x10b766['shop'][_0x6a3425(0x247)],_0x534c88=Math[_0x6a3425(0x223)](_0x27106a[_0x6a3425(0x243)]*0.75/0x400),_0x1d92cb=_0x6a3425(0x240)+_0x47eb4c+_0x6a3425(0x235)+(_0x6a3425(0x217)+_0x439759+'\x0a')+(_0x6a3425(0x200)+_0x10b766[_0x6a3425(0x21f)]+'\x20'+_0x10b766[_0x6a3425(0x212)]+'\x0a')+(_0x6a3425(0x23e)+_0x575d11[_0x6a3425(0x1ef)]()+'\x20('+_0x534c88+'KB)\x0a')+_0x6a3425(0x1fe)+(_0x6a3425(0x1eb)+_0x5658c3+'\x0a\x0a')+_0x6a3425(0x225);await telegramBotService_1['telegramBotService'][_0x6a3425(0x246)](_0x10b766[_0x6a3425(0x211)],_0x1d92cb,{'parse_mode':_0x6a3425(0x22d)});const _0x3cedfd=Buffer[_0x6a3425(0x1f6)](_0x27106a,'base64'),_0xb9c28c='payment_proof_'+_0x439759+'.'+_0x575d11;await telegramBotService_1['telegramBotService']['sendShopFile'](_0x10b766[_0x6a3425(0x211)],_0x3cedfd,_0xb9c28c,_0x6a3425(0x20d)+_0x439759),console['log']('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x1fcf41=_0x6a3425(0x23d),_0x1cf559=_0x6a3425(0x240)+_0x47eb4c+_0x6a3425(0x221)+('üí≥\x20Payment\x20ID:\x20'+_0x439759+'\x0a')+(_0x6a3425(0x1f3)+_0x195b30+'\x0a')+(_0x6a3425(0x200)+_0x10b766['amount']+'\x20'+_0x10b766['currency']+'\x0a')+(_0x6a3425(0x23e)+_0x575d11[_0x6a3425(0x1ef)]()+'\x20('+_0x534c88+'KB)\x0a')+_0x6a3425(0x1fe)+(_0x6a3425(0x1eb)+_0x5658c3+'\x0a\x0a')+_0x6a3425(0x226);await telegramBotService_1['telegramBotService'][_0x6a3425(0x201)](parseInt(_0x1fcf41),_0x1cf559),await telegramBotService_1[_0x6a3425(0x1e9)]['sendDirectFile'](parseInt(_0x1fcf41),_0x3cedfd,_0xb9c28c,_0x6a3425(0x244)+_0x439759),console[_0x6a3425(0x1f5)](_0x6a3425(0x21b));}catch(_0x4569b3){console['error']('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:',_0x4569b3);}_0x2a85de[_0x6a3425(0x20e)]({'success':!![],'message':_0x6a3425(0x224),'data':{'paymentId':_0x5b8197['id'],'status':_0x5b8197['status'],'gateway':_0x10b766[_0x6a3425(0x205)],'fileType':_0x575d11,'fileSize':Math[_0x6a3425(0x223)](_0x27106a[_0x6a3425(0x243)]*0.75/0x400)+'KB','uploadedAt':_0x5b8197[_0x6a3425(0x227)]}});}catch(_0x25eba0){console['error']('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x25eba0),_0x2a85de[_0x6a3425(0x239)](0x1f4)[_0x6a3425(0x20e)]({'success':![],'error':_0x6a3425(0x1ee),'details':_0x25eba0 instanceof Error?_0x25eba0[_0x6a3425(0x21d)]:'Unknown\x20error'});}}async[a10_0x2619d7(0x22e)](_0x523b1d,_0x307174){const _0x35de91=a10_0x2619d7;try{const {paymentId:_0x27ebce}=_0x523b1d[_0x35de91(0x1ff)];console[_0x35de91(0x1f5)]('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x27ebce);const _0x43c4d2=await database_1[_0x35de91(0x20a)][_0x35de91(0x22f)]['findUnique']({'where':{'id':_0x27ebce},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x43c4d2){_0x307174[_0x35de91(0x239)](0x194)[_0x35de91(0x20e)]({'success':![],'error':_0x35de91(0x238)});return;}if(_0x43c4d2[_0x35de91(0x205)]!==_0x35de91(0x214)&&_0x43c4d2[_0x35de91(0x205)]!=='sepa'){_0x307174[_0x35de91(0x239)](0x190)[_0x35de91(0x20e)]({'success':![],'error':_0x35de91(0x210)+_0x43c4d2[_0x35de91(0x205)]});return;}let _0x41a816='',_0x15cf56=_0x43c4d2['currency'],_0x5e06ce='';if(_0x43c4d2[_0x35de91(0x205)]===_0x35de91(0x214))_0x5e06ce=_0x35de91(0x1f1),_0x15cf56=_0x35de91(0x1f9),_0x41a816=_0x35de91(0x20c)+_0x43c4d2[_0x35de91(0x21f)]+'\x20'+_0x15cf56+_0x35de91(0x242);else _0x43c4d2[_0x35de91(0x205)]===_0x35de91(0x237)&&(_0x5e06ce='SEPA\x20Bank\x20Transfer',_0x15cf56=_0x35de91(0x230),_0x41a816=_0x35de91(0x231)+_0x43c4d2['amount']+'\x20'+_0x15cf56+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x1414e3={'success':!![],'data':{'paymentId':_0x43c4d2['id'],'gateway':_0x43c4d2[_0x35de91(0x205)],'gatewayName':_0x43c4d2[_0x35de91(0x205)]['toUpperCase'](),'transferType':_0x5e06ce,'amount':_0x43c4d2[_0x35de91(0x21f)],'currency':_0x15cf56,'status':_0x43c4d2[_0x35de91(0x239)],'instructions':_0x41a816,'shopName':_0x43c4d2[_0x35de91(0x206)]['name']||_0x43c4d2[_0x35de91(0x206)]['username'],'hasProof':![],'proofType':null,'createdAt':_0x43c4d2[_0x35de91(0x22c)],'updatedAt':_0x43c4d2[_0x35de91(0x227)],'supportedFileTypes':['PNG',_0x35de91(0x1e8),_0x35de91(0x1f7),'HEIC','PDF'],'maxFileSize':_0x35de91(0x203)}};_0x307174['json'](_0x1414e3);}catch(_0x31e43b){console[_0x35de91(0x216)](_0x35de91(0x22b),_0x31e43b),_0x307174[_0x35de91(0x239)](0x1f4)[_0x35de91(0x20e)]({'success':![],'error':_0x35de91(0x1ee),'details':_0x31e43b instanceof Error?_0x31e43b[_0x35de91(0x21d)]:_0x35de91(0x218)});}}}exports[a10_0x2619d7(0x236)]=ManualPaymentController,exports[a10_0x2619d7(0x1ed)]=new ManualPaymentController();