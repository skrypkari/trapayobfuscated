'use strict';function a10_0x3664(){const _0xe466ea=['updatedAt','Interac\x20e-Transfer','2992024Bumnhw','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','SEPA\x20Bank\x20Transfer','sepa','üîÑ\x20','Markdown','Unsupported\x20file\x20type:\x20','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','üí≥\x20Payment\x20ID:\x20','../services/telegramBotService','sendDirectMessage','shopId','join','pdf','telegramBotService','üìÅ\x20File\x20type:\x20','gateway','‚ùå\x20Upload\x20payment\x20proof\x20error:','ManualPaymentController','png','includes','PNG','__esModule','23142845ZAMeyS','Unknown\x20error','shop','manualPaymentController','HEIC','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','error','../config/database','\x20\x20\x20-\x20File\x20size:\x20','log','üí∞\x20Amount:\x20','Payment\x20proof\x20uploaded\x20successfully','base64','currency','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','7867339505','CAD',',\x20size:\x20','1312548HJkIxV','jpeg','306dTpwWj','from','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','status','jpg','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','default','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','10DwyQdV','Payment\x20not\x20found','params','File\x20data\x20is\x20required','KB)\x0a','amount','json','body','\x20\x20\x20-\x20Gateway:\x20','\x20\x20\x20-\x20Payment\x20ID:\x20','Internal\x20server\x20error','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','7631ePGcsG','40saptIJ','776447zuNyxT','üì±\x20Admin\x20notification\x20and\x20file\x20sent','üè™\x20Shop:\x20','‚ùå\x20Payment\x20not\x20found:\x20','toLowerCase','.\x20Supported:\x20','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','unknown','12cEIbVg','username','Payment\x20ID\x20is\x20required','File\x20type\x20is\x20required','heic','name','üåê\x20Client\x20IP:\x20','üåê\x20Customer\x20IP:\x20','6737490wwmYAV','655156rgphla','toUpperCase','message','üìÅ\x20File:\x20','replace','PDF','payment_proof_','üìã\x20Get\x20manual\x20payment\x20info:\x20','interac','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','round','payment','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','sendDirectFile','Invalid\x20base64\x20file\x20data','uploadPaymentProof','length'];a10_0x3664=function(){return _0xe466ea;};return a10_0x3664();}const a10_0x41c837=a10_0x12ea;function a10_0x12ea(_0x3c65d0,_0x14ddf8){_0x3c65d0=_0x3c65d0-0x95;const _0x366486=a10_0x3664();let _0x12ea5f=_0x366486[_0x3c65d0];return _0x12ea5f;}(function(_0x23ce2c,_0x5e0f73){const _0x1d2958=a10_0x12ea,_0x1a3a6=_0x23ce2c();while(!![]){try{const _0x607da=parseInt(_0x1d2958(0xb2))/0x1*(parseInt(_0x1d2958(0x9c))/0x2)+parseInt(_0x1d2958(0x9a))/0x3+parseInt(_0x1d2958(0xc6))/0x4*(parseInt(_0x1d2958(0xb3))/0x5)+parseInt(_0x1d2958(0xbd))/0x6*(parseInt(_0x1d2958(0xb4))/0x7)+parseInt(_0x1d2958(0xd9))/0x8+parseInt(_0x1d2958(0xc5))/0x9*(-parseInt(_0x1d2958(0xa6))/0xa)+-parseInt(_0x1d2958(0xf1))/0xb;if(_0x607da===_0x5e0f73)break;else _0x1a3a6['push'](_0x1a3a6['shift']());}catch(_0x56d0ce){_0x1a3a6['push'](_0x1a3a6['shift']());}}}(a10_0x3664,0xa0d17));var __importDefault=this&&this['__importDefault']||function(_0x4cb207){const _0x5e7384=a10_0x12ea;return _0x4cb207&&_0x4cb207[_0x5e7384(0xf0)]?_0x4cb207:{'default':_0x4cb207};};Object['defineProperty'](exports,a10_0x41c837(0xf0),{'value':!![]}),exports[a10_0x41c837(0xf4)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a10_0x41c837(0xf8))),telegramBotService_1=require(a10_0x41c837(0xe3));class ManualPaymentController{async[a10_0x41c837(0xd5)](_0x5a6e4c,_0x34caf7){const _0x443794=a10_0x41c837;try{const {paymentId:_0x499c25,fileData:_0x2b3915,fileType:_0x1c40d3,fileName:_0x4ca1c2}=_0x5a6e4c[_0x443794(0xad)],_0x5968e5=_0x5a6e4c['ip']||_0x5a6e4c['connection']?.['remoteAddress']||_0x443794(0xbc);console[_0x443794(0xfa)](_0x443794(0xda)+_0x499c25),console['log'](_0x443794(0xe9)+_0x1c40d3+_0x443794(0x99)+(_0x2b3915?Math['round'](_0x2b3915[_0x443794(0xd6)]*0.75/0x400):0x0)+'KB'),console[_0x443794(0xfa)](_0x443794(0xc3)+_0x5968e5);if(!_0x499c25){_0x34caf7[_0x443794(0x9f)](0x190)['json']({'success':![],'error':_0x443794(0xbf)});return;}if(!_0x2b3915){_0x34caf7[_0x443794(0x9f)](0x190)[_0x443794(0xac)]({'success':![],'error':_0x443794(0xa9)});return;}if(!_0x1c40d3){_0x34caf7['status'](0x190)['json']({'success':![],'error':_0x443794(0xc0)});return;}const _0x1b6ca4=[_0x443794(0xed),_0x443794(0xa0),_0x443794(0x9b),_0x443794(0xc1),_0x443794(0xe7)],_0x1c4cf7=_0x1c40d3[_0x443794(0xb8)]()[_0x443794(0xca)]('.','');if(!_0x1b6ca4[_0x443794(0xee)](_0x1c4cf7)){_0x34caf7[_0x443794(0x9f)](0x190)[_0x443794(0xac)]({'success':![],'error':_0x443794(0xe0)+_0x1c40d3+_0x443794(0xb9)+_0x1b6ca4[_0x443794(0xe6)](',\x20')});return;}const _0x3f20c4=0xa*0x400*0x400;if(_0x2b3915[_0x443794(0xd6)]>_0x3f20c4){_0x34caf7[_0x443794(0x9f)](0x190)[_0x443794(0xac)]({'success':![],'error':'File\x20too\x20large.\x20Maximum\x20size:\x2010MB'});return;}const _0xea3bc=await database_1[_0x443794(0xa2)][_0x443794(0xd1)]['findUnique']({'where':{'id':_0x499c25},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xea3bc){console[_0x443794(0xfa)](_0x443794(0xb7)+_0x499c25),_0x34caf7[_0x443794(0x9f)](0x194)[_0x443794(0xac)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0xea3bc[_0x443794(0xea)]!==_0x443794(0xce)&&_0xea3bc[_0x443794(0xea)]!==_0x443794(0xdd)){console[_0x443794(0xfa)]('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0xea3bc[_0x443794(0xea)]),_0x34caf7[_0x443794(0x9f)](0x190)[_0x443794(0xac)]({'success':![],'error':_0x443794(0xba)+_0xea3bc['gateway']});return;}let _0x31415e=_0x2b3915;_0x2b3915['includes'](',')&&(_0x31415e=_0x2b3915['split'](',')[0x1]);try{Buffer['from'](_0x31415e,_0x443794(0xfd));}catch(_0x16501d){_0x34caf7[_0x443794(0x9f)](0x190)[_0x443794(0xac)]({'success':![],'error':_0x443794(0xd4)});return;}const _0xeac769=await database_1[_0x443794(0xa2)][_0x443794(0xd1)]['update']({'where':{'id':_0x499c25},'data':{'status':'PROCESSING','updatedAt':new Date()}});console[_0x443794(0xfa)](_0x443794(0xdb)),console[_0x443794(0xfa)](_0x443794(0xaf)+_0x499c25),console[_0x443794(0xfa)](_0x443794(0xae)+_0xea3bc[_0x443794(0xea)]['toUpperCase']()),console[_0x443794(0xfa)]('\x20\x20\x20-\x20File\x20type:\x20'+_0x1c4cf7),console[_0x443794(0xfa)](_0x443794(0xf9)+Math[_0x443794(0xd0)](_0x31415e[_0x443794(0xd6)]*0.75/0x400)+'KB'),console[_0x443794(0xfa)](_0x443794(0xa4));try{const _0x2ddb73=_0xea3bc['gateway']['toUpperCase'](),_0x415e40=_0xea3bc[_0x443794(0xf3)][_0x443794(0xc2)]||_0xea3bc[_0x443794(0xf3)]['username'],_0x26a99b=Math[_0x443794(0xd0)](_0x31415e[_0x443794(0xd6)]*0.75/0x400),_0x59528b=_0x443794(0xde)+_0x2ddb73+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0x443794(0xe2)+_0x499c25+'\x0a')+(_0x443794(0xfb)+_0xea3bc[_0x443794(0xab)]+'\x20'+_0xea3bc['currency']+'\x0a')+(_0x443794(0xc9)+_0x1c4cf7['toUpperCase']()+'\x20('+_0x26a99b+_0x443794(0xaa))+_0x443794(0xbb)+('üåê\x20Customer\x20IP:\x20'+_0x5968e5+'\x0a\x0a')+_0x443794(0xa5);await telegramBotService_1['telegramBotService']['sendShopNotification'](_0xea3bc[_0x443794(0xe5)],_0x59528b,{'parse_mode':_0x443794(0xdf)});const _0x5884fb=Buffer[_0x443794(0x9d)](_0x31415e,_0x443794(0xfd)),_0x1ab3e2=_0x443794(0xcc)+_0x499c25+'.'+_0x1c4cf7;await telegramBotService_1[_0x443794(0xe8)]['sendShopFile'](_0xea3bc[_0x443794(0xe5)],_0x5884fb,_0x1ab3e2,'Payment\x20proof\x20for\x20'+_0x499c25),console['log'](_0x443794(0xb1));const _0x5adb0d=_0x443794(0x97),_0x49b8ab=_0x443794(0xde)+_0x2ddb73+_0x443794(0xa3)+(_0x443794(0xe2)+_0x499c25+'\x0a')+(_0x443794(0xb6)+_0x415e40+'\x0a')+('üí∞\x20Amount:\x20'+_0xea3bc[_0x443794(0xab)]+'\x20'+_0xea3bc[_0x443794(0x95)]+'\x0a')+(_0x443794(0xc9)+_0x1c4cf7[_0x443794(0xc7)]()+'\x20('+_0x26a99b+_0x443794(0xaa))+_0x443794(0xbb)+(_0x443794(0xc4)+_0x5968e5+'\x0a\x0a')+_0x443794(0xe1);await telegramBotService_1[_0x443794(0xe8)][_0x443794(0xe4)](parseInt(_0x5adb0d),_0x49b8ab),await telegramBotService_1[_0x443794(0xe8)][_0x443794(0xd3)](parseInt(_0x5adb0d),_0x5884fb,_0x1ab3e2,_0x443794(0x9e)+_0x499c25),console['log'](_0x443794(0xb5));}catch(_0x197634){console['error'](_0x443794(0xa1),_0x197634);}_0x34caf7[_0x443794(0xac)]({'success':!![],'message':_0x443794(0xfc),'data':{'paymentId':_0xeac769['id'],'status':_0xeac769[_0x443794(0x9f)],'gateway':_0xea3bc[_0x443794(0xea)],'fileType':_0x1c4cf7,'fileSize':Math[_0x443794(0xd0)](_0x31415e[_0x443794(0xd6)]*0.75/0x400)+'KB','uploadedAt':_0xeac769[_0x443794(0xd7)]}});}catch(_0x54c9d0){console[_0x443794(0xf7)](_0x443794(0xeb),_0x54c9d0),_0x34caf7[_0x443794(0x9f)](0x1f4)['json']({'success':![],'error':'Internal\x20server\x20error','details':_0x54c9d0 instanceof Error?_0x54c9d0[_0x443794(0xc8)]:_0x443794(0xf2)});}}async['getManualPaymentInfo'](_0x1f561c,_0x5f2f05){const _0x1c23e4=a10_0x41c837;try{const {paymentId:_0x52ef50}=_0x1f561c[_0x1c23e4(0xa8)];console[_0x1c23e4(0xfa)](_0x1c23e4(0xcd)+_0x52ef50);const _0x1ea9b5=await database_1[_0x1c23e4(0xa2)][_0x1c23e4(0xd1)]['findUnique']({'where':{'id':_0x52ef50},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1ea9b5){_0x5f2f05['status'](0x194)[_0x1c23e4(0xac)]({'success':![],'error':_0x1c23e4(0xa7)});return;}if(_0x1ea9b5[_0x1c23e4(0xea)]!==_0x1c23e4(0xce)&&_0x1ea9b5[_0x1c23e4(0xea)]!==_0x1c23e4(0xdd)){_0x5f2f05[_0x1c23e4(0x9f)](0x190)['json']({'success':![],'error':_0x1c23e4(0xf6)+_0x1ea9b5[_0x1c23e4(0xea)]});return;}let _0x39d533='',_0x4c43fd=_0x1ea9b5[_0x1c23e4(0x95)],_0x15eb99='';if(_0x1ea9b5[_0x1c23e4(0xea)]===_0x1c23e4(0xce))_0x15eb99=_0x1c23e4(0xd8),_0x4c43fd=_0x1c23e4(0x98),_0x39d533='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x1ea9b5[_0x1c23e4(0xab)]+'\x20'+_0x4c43fd+_0x1c23e4(0x96);else _0x1ea9b5[_0x1c23e4(0xea)]===_0x1c23e4(0xdd)&&(_0x15eb99=_0x1c23e4(0xdc),_0x4c43fd='EUR',_0x39d533=_0x1c23e4(0xd2)+_0x1ea9b5[_0x1c23e4(0xab)]+'\x20'+_0x4c43fd+_0x1c23e4(0x96));const _0xf594a2={'success':!![],'data':{'paymentId':_0x1ea9b5['id'],'gateway':_0x1ea9b5[_0x1c23e4(0xea)],'gatewayName':_0x1ea9b5['gateway'][_0x1c23e4(0xc7)](),'transferType':_0x15eb99,'amount':_0x1ea9b5[_0x1c23e4(0xab)],'currency':_0x4c43fd,'status':_0x1ea9b5[_0x1c23e4(0x9f)],'instructions':_0x39d533,'shopName':_0x1ea9b5[_0x1c23e4(0xf3)]['name']||_0x1ea9b5[_0x1c23e4(0xf3)][_0x1c23e4(0xbe)],'hasProof':![],'proofType':null,'createdAt':_0x1ea9b5['createdAt'],'updatedAt':_0x1ea9b5['updatedAt'],'supportedFileTypes':[_0x1c23e4(0xef),'JPG','JPEG',_0x1c23e4(0xf5),_0x1c23e4(0xcb)],'maxFileSize':'10MB'}};_0x5f2f05[_0x1c23e4(0xac)](_0xf594a2);}catch(_0x190fd8){console[_0x1c23e4(0xf7)](_0x1c23e4(0xcf),_0x190fd8),_0x5f2f05[_0x1c23e4(0x9f)](0x1f4)['json']({'success':![],'error':_0x1c23e4(0xb0),'details':_0x190fd8 instanceof Error?_0x190fd8['message']:'Unknown\x20error'});}}}exports[a10_0x41c837(0xec)]=ManualPaymentController,exports[a10_0x41c837(0xf4)]=new ManualPaymentController();