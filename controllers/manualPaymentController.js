'use strict';const a8_0x55962e=a8_0x56c0;(function(_0x49d36b,_0x331ebe){const _0x1c6e3b=a8_0x56c0,_0x12aa4a=_0x49d36b();while(!![]){try{const _0x161848=parseInt(_0x1c6e3b(0x208))/0x1*(parseInt(_0x1c6e3b(0x231))/0x2)+-parseInt(_0x1c6e3b(0x1ed))/0x3*(-parseInt(_0x1c6e3b(0x21a))/0x4)+-parseInt(_0x1c6e3b(0x1ee))/0x5+-parseInt(_0x1c6e3b(0x1fe))/0x6+-parseInt(_0x1c6e3b(0x20d))/0x7*(-parseInt(_0x1c6e3b(0x21c))/0x8)+-parseInt(_0x1c6e3b(0x221))/0x9+parseInt(_0x1c6e3b(0x225))/0xa*(parseInt(_0x1c6e3b(0x213))/0xb);if(_0x161848===_0x331ebe)break;else _0x12aa4a['push'](_0x12aa4a['shift']());}catch(_0x511ef6){_0x12aa4a['push'](_0x12aa4a['shift']());}}}(a8_0x2cc8,0xd36f7));function a8_0x2cc8(){const _0x5d1ddf=['currency','Markdown','210JcPLbc','status','sendDirectFile','EUR','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','split','uploadPaymentProof','shopId','includes','remoteAddress','üí∞\x20Amount:\x20','File\x20type\x20is\x20required','418492axJuNP','.\x20Supported:\x20','interac','üì±\x20Admin\x20notification\x20and\x20file\x20sent',',\x20size:\x20','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','üìÅ\x20File:\x20','heic','join','body','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','payment_proof_','amount','üè™\x20Shop:\x20','log','sendShopNotification','‚ùå\x20Upload\x20payment\x20proof\x20error:','Unsupported\x20file\x20type:\x20','PROCESSING','Payment\x20ID\x20is\x20required','json','toUpperCase','PDF','round','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','üîÑ\x20','length','SEPA\x20Bank\x20Transfer','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','name','ManualPaymentController','üåê\x20Customer\x20IP:\x20','343533NBQuyT','230100QGwwCE','defineProperty','username','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','\x20\x20\x20-\x20Gateway:\x20','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','JPG','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','Interac\x20e-Transfer','telegramBotService','message','base64','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','Unknown\x20error','updatedAt','__esModule','10367388OtusAc','Payment\x20proof\x20for\x20','sepa','üåê\x20Client\x20IP:\x20','Payment\x20not\x20found','from','replace','shop','unknown','manualPaymentController','1oVrutP','Payment\x20proof\x20uploaded\x20successfully','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','\x20\x20\x20-\x20File\x20size:\x20','../config/database','3479UWoKLt','sendDirectMessage','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','KB)\x0a','error','246741JdcrjQ','gateway','pdf','\x20\x20\x20-\x20Payment\x20ID:\x20','getManualPaymentInfo','üí≥\x20Payment\x20ID:\x20','\x20\x20\x20-\x20File\x20type:\x20','60nIevfo','CAD','17768rbJVVD','sendShopFile','connection','createdAt','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','7756578PZuxzO','Internal\x20server\x20error'];a8_0x2cc8=function(){return _0x5d1ddf;};return a8_0x2cc8();}var __importDefault=this&&this['__importDefault']||function(_0x5e5e64){const _0x51665f=a8_0x56c0;return _0x5e5e64&&_0x5e5e64[_0x51665f(0x1fd)]?_0x5e5e64:{'default':_0x5e5e64};};function a8_0x56c0(_0x5eb4a8,_0x276942){const _0x2cc880=a8_0x2cc8();return a8_0x56c0=function(_0x56c051,_0x3f7b06){_0x56c051=_0x56c051-0x1e0;let _0x5af1a4=_0x2cc880[_0x56c051];return _0x5af1a4;},a8_0x56c0(_0x5eb4a8,_0x276942);}Object[a8_0x55962e(0x1ef)](exports,'__esModule',{'value':!![]}),exports[a8_0x55962e(0x207)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a8_0x55962e(0x20c))),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async[a8_0x55962e(0x22b)](_0x44a3c5,_0x4878aa){const _0x42d62d=a8_0x55962e;try{const {paymentId:_0x26651e,fileData:_0x16f616,fileType:_0x551737,fileName:_0x5c0a50}=_0x44a3c5[_0x42d62d(0x23a)],_0x42e3f4=_0x44a3c5['ip']||_0x44a3c5[_0x42d62d(0x21e)]?.[_0x42d62d(0x22e)]||_0x42d62d(0x206);console['log']('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x26651e),console[_0x42d62d(0x23f)]('üìÅ\x20File\x20type:\x20'+_0x551737+_0x42d62d(0x235)+(_0x16f616?Math[_0x42d62d(0x1e4)](_0x16f616[_0x42d62d(0x1e7)]*0.75/0x400):0x0)+'KB'),console['log'](_0x42d62d(0x201)+_0x42e3f4);if(!_0x26651e){_0x4878aa[_0x42d62d(0x226)](0x190)[_0x42d62d(0x1e1)]({'success':![],'error':_0x42d62d(0x1e0)});return;}if(!_0x16f616){_0x4878aa['status'](0x190)[_0x42d62d(0x1e1)]({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x551737){_0x4878aa[_0x42d62d(0x226)](0x190)['json']({'success':![],'error':_0x42d62d(0x230)});return;}const _0x2bdf15=['png','jpg','jpeg',_0x42d62d(0x238),_0x42d62d(0x215)],_0x572735=_0x551737['toLowerCase']()[_0x42d62d(0x204)]('.','');if(!_0x2bdf15[_0x42d62d(0x22d)](_0x572735)){_0x4878aa[_0x42d62d(0x226)](0x190)[_0x42d62d(0x1e1)]({'success':![],'error':_0x42d62d(0x242)+_0x551737+_0x42d62d(0x232)+_0x2bdf15[_0x42d62d(0x239)](',\x20')});return;}const _0x4a7d9a=0xa*0x400*0x400;if(_0x16f616[_0x42d62d(0x1e7)]>_0x4a7d9a){_0x4878aa[_0x42d62d(0x226)](0x190)['json']({'success':![],'error':'File\x20too\x20large.\x20Maximum\x20size:\x2010MB'});return;}const _0x295a46=await database_1['default']['payment']['findUnique']({'where':{'id':_0x26651e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x295a46){console[_0x42d62d(0x23f)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x26651e),_0x4878aa['status'](0x194)['json']({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x295a46[_0x42d62d(0x214)]!=='interac'&&_0x295a46[_0x42d62d(0x214)]!==_0x42d62d(0x200)){console[_0x42d62d(0x23f)]('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x295a46[_0x42d62d(0x214)]),_0x4878aa[_0x42d62d(0x226)](0x190)[_0x42d62d(0x1e1)]({'success':![],'error':_0x42d62d(0x220)+_0x295a46[_0x42d62d(0x214)]});return;}let _0x463fb7=_0x16f616;_0x16f616['includes'](',')&&(_0x463fb7=_0x16f616[_0x42d62d(0x22a)](',')[0x1]);try{Buffer['from'](_0x463fb7,_0x42d62d(0x1f9));}catch(_0x383278){_0x4878aa['status'](0x190)[_0x42d62d(0x1e1)]({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x1d7de3=await database_1['default']['payment']['update']({'where':{'id':_0x26651e},'data':{'status':_0x42d62d(0x243),'updatedAt':new Date()}});console[_0x42d62d(0x23f)]('‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:'),console[_0x42d62d(0x23f)](_0x42d62d(0x216)+_0x26651e),console[_0x42d62d(0x23f)](_0x42d62d(0x1f2)+_0x295a46['gateway'][_0x42d62d(0x1e2)]()),console[_0x42d62d(0x23f)](_0x42d62d(0x219)+_0x572735),console['log'](_0x42d62d(0x20b)+Math[_0x42d62d(0x1e4)](_0x463fb7[_0x42d62d(0x1e7)]*0.75/0x400)+'KB'),console['log'](_0x42d62d(0x1f1));try{const _0x4a618e=_0x295a46[_0x42d62d(0x214)]['toUpperCase'](),_0x38604f=_0x295a46[_0x42d62d(0x205)][_0x42d62d(0x1ea)]||_0x295a46[_0x42d62d(0x205)][_0x42d62d(0x1f0)],_0x3a026b=Math[_0x42d62d(0x1e4)](_0x463fb7[_0x42d62d(0x1e7)]*0.75/0x400),_0x5a4bc4=_0x42d62d(0x1e6)+_0x4a618e+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0x42d62d(0x218)+_0x26651e+'\x0a')+(_0x42d62d(0x22f)+_0x295a46[_0x42d62d(0x23d)]+'\x20'+_0x295a46['currency']+'\x0a')+('üìÅ\x20File:\x20'+_0x572735[_0x42d62d(0x1e2)]()+'\x20('+_0x3a026b+_0x42d62d(0x211))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x42d62d(0x1ec)+_0x42e3f4+'\x0a\x0a')+_0x42d62d(0x1fa);await telegramBotService_1[_0x42d62d(0x1f7)][_0x42d62d(0x240)](_0x295a46[_0x42d62d(0x22c)],_0x5a4bc4,{'parse_mode':_0x42d62d(0x224)});const _0x3eaba0=Buffer[_0x42d62d(0x203)](_0x463fb7,_0x42d62d(0x1f9)),_0x493375=_0x42d62d(0x23c)+_0x26651e+'.'+_0x572735;await telegramBotService_1['telegramBotService'][_0x42d62d(0x21d)](_0x295a46['shopId'],_0x3eaba0,_0x493375,_0x42d62d(0x1ff)+_0x26651e),console[_0x42d62d(0x23f)](_0x42d62d(0x20a));const _0x3f93c4='7867339505',_0x1723a2=_0x42d62d(0x1e6)+_0x4a618e+_0x42d62d(0x20f)+('üí≥\x20Payment\x20ID:\x20'+_0x26651e+'\x0a')+(_0x42d62d(0x23e)+_0x38604f+'\x0a')+(_0x42d62d(0x22f)+_0x295a46['amount']+'\x20'+_0x295a46[_0x42d62d(0x223)]+'\x0a')+(_0x42d62d(0x237)+_0x572735['toUpperCase']()+'\x20('+_0x3a026b+_0x42d62d(0x211))+_0x42d62d(0x229)+(_0x42d62d(0x1ec)+_0x42e3f4+'\x0a\x0a')+_0x42d62d(0x236);await telegramBotService_1[_0x42d62d(0x1f7)][_0x42d62d(0x20e)](parseInt(_0x3f93c4),_0x1723a2),await telegramBotService_1['telegramBotService'][_0x42d62d(0x227)](parseInt(_0x3f93c4),_0x3eaba0,_0x493375,_0x42d62d(0x1e9)+_0x26651e),console[_0x42d62d(0x23f)](_0x42d62d(0x234));}catch(_0x51f6a3){console[_0x42d62d(0x212)](_0x42d62d(0x23b),_0x51f6a3);}_0x4878aa['json']({'success':!![],'message':_0x42d62d(0x209),'data':{'paymentId':_0x1d7de3['id'],'status':_0x1d7de3[_0x42d62d(0x226)],'gateway':_0x295a46[_0x42d62d(0x214)],'fileType':_0x572735,'fileSize':Math[_0x42d62d(0x1e4)](_0x463fb7[_0x42d62d(0x1e7)]*0.75/0x400)+'KB','uploadedAt':_0x1d7de3['updatedAt']}});}catch(_0x3de3fb){console['error'](_0x42d62d(0x241),_0x3de3fb),_0x4878aa[_0x42d62d(0x226)](0x1f4)[_0x42d62d(0x1e1)]({'success':![],'error':'Internal\x20server\x20error','details':_0x3de3fb instanceof Error?_0x3de3fb[_0x42d62d(0x1f8)]:'Unknown\x20error'});}}async[a8_0x55962e(0x217)](_0x5e50ad,_0x203dcb){const _0x5d0190=a8_0x55962e;try{const {paymentId:_0xad8e7b}=_0x5e50ad['params'];console[_0x5d0190(0x23f)]('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0xad8e7b);const _0x271f46=await database_1['default']['payment']['findUnique']({'where':{'id':_0xad8e7b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x271f46){_0x203dcb[_0x5d0190(0x226)](0x194)['json']({'success':![],'error':_0x5d0190(0x202)});return;}if(_0x271f46[_0x5d0190(0x214)]!==_0x5d0190(0x233)&&_0x271f46[_0x5d0190(0x214)]!=='sepa'){_0x203dcb[_0x5d0190(0x226)](0x190)[_0x5d0190(0x1e1)]({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x271f46['gateway']});return;}let _0x19a129='',_0x35ebae=_0x271f46[_0x5d0190(0x223)],_0x2478c0='';if(_0x271f46[_0x5d0190(0x214)]==='interac')_0x2478c0=_0x5d0190(0x1f6),_0x35ebae=_0x5d0190(0x21b),_0x19a129=_0x5d0190(0x1e5)+_0x271f46[_0x5d0190(0x23d)]+'\x20'+_0x35ebae+_0x5d0190(0x1f3);else _0x271f46[_0x5d0190(0x214)]==='sepa'&&(_0x2478c0=_0x5d0190(0x1e8),_0x35ebae=_0x5d0190(0x228),_0x19a129=_0x5d0190(0x1f5)+_0x271f46[_0x5d0190(0x23d)]+'\x20'+_0x35ebae+_0x5d0190(0x1f3));const _0x53c268={'success':!![],'data':{'paymentId':_0x271f46['id'],'gateway':_0x271f46[_0x5d0190(0x214)],'gatewayName':_0x271f46[_0x5d0190(0x214)][_0x5d0190(0x1e2)](),'transferType':_0x2478c0,'amount':_0x271f46[_0x5d0190(0x23d)],'currency':_0x35ebae,'status':_0x271f46['status'],'instructions':_0x19a129,'shopName':_0x271f46['shop'][_0x5d0190(0x1ea)]||_0x271f46[_0x5d0190(0x205)][_0x5d0190(0x1f0)],'hasProof':![],'proofType':null,'createdAt':_0x271f46[_0x5d0190(0x21f)],'updatedAt':_0x271f46[_0x5d0190(0x1fc)],'supportedFileTypes':['PNG',_0x5d0190(0x1f4),'JPEG','HEIC',_0x5d0190(0x1e3)],'maxFileSize':'10MB'}};_0x203dcb[_0x5d0190(0x1e1)](_0x53c268);}catch(_0x903fbe){console[_0x5d0190(0x212)](_0x5d0190(0x210),_0x903fbe),_0x203dcb['status'](0x1f4)[_0x5d0190(0x1e1)]({'success':![],'error':_0x5d0190(0x222),'details':_0x903fbe instanceof Error?_0x903fbe[_0x5d0190(0x1f8)]:_0x5d0190(0x1fb)});}}}exports[a8_0x55962e(0x1eb)]=ManualPaymentController,exports[a8_0x55962e(0x207)]=new ManualPaymentController();