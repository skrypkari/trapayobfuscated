'use strict';const a8_0x595982=a8_0x36fa;(function(_0xdcb84e,_0x2d41bf){const _0x35b74e=a8_0x36fa,_0x569030=_0xdcb84e();while(!![]){try{const _0x347e40=-parseInt(_0x35b74e(0xaf))/0x1*(parseInt(_0x35b74e(0xbe))/0x2)+-parseInt(_0x35b74e(0xd4))/0x3*(parseInt(_0x35b74e(0xd7))/0x4)+-parseInt(_0x35b74e(0xce))/0x5*(parseInt(_0x35b74e(0xc1))/0x6)+-parseInt(_0x35b74e(0xe5))/0x7*(parseInt(_0x35b74e(0xad))/0x8)+parseInt(_0x35b74e(0xc3))/0x9+-parseInt(_0x35b74e(0xb1))/0xa*(parseInt(_0x35b74e(0xb9))/0xb)+parseInt(_0x35b74e(0xc4))/0xc;if(_0x347e40===_0x2d41bf)break;else _0x569030['push'](_0x569030['shift']());}catch(_0x2b589f){_0x569030['push'](_0x569030['shift']());}}}(a8_0x1403,0xd8143));function a8_0x36fa(_0x4d0bd0,_0x390155){const _0x140324=a8_0x1403();return a8_0x36fa=function(_0x36fa07,_0x3a6f9e){_0x36fa07=_0x36fa07-0x99;let _0x4167ca=_0x140324[_0x36fa07];return _0x4167ca;},a8_0x36fa(_0x4d0bd0,_0x390155);}function a8_0x1403(){const _0xc9e19f=['connection','sendShopNotification','üìÅ\x20File:\x20','67004BfeQwX','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','getManualPaymentInfo','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','Payment\x20proof\x20for\x20','split','PDF','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','../services/telegramBotService','uploadPaymentProof','manualPaymentController','remoteAddress','length','jpeg','defineProperty','HEIC','üì±\x20Admin\x20notification\x20and\x20file\x20sent','\x20\x20\x20-\x20File\x20type:\x20','__importDefault','üìÅ\x20File\x20type:\x20','PROCESSING','message','name','Payment\x20not\x20found','üîÑ\x20','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','username','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','SEPA\x20Bank\x20Transfer','üåê\x20Client\x20IP:\x20','png','amount','ManualPaymentController','../config/database','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','json','payment_proof_','params','base64','__esModule','updatedAt','Unknown\x20error','sepa','heic','log','shopId','shop','replace','join','currency','round','1032kerrKc','pdf','1gMLNfk','üìã\x20Get\x20manual\x20payment\x20info:\x20','1037530FvWtDV','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','Invalid\x20base64\x20file\x20data','Internal\x20server\x20error','interac','üí≥\x20Payment\x20ID:\x20','default','10MB','11JkaRtW','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','File\x20type\x20is\x20required','üí∞\x20Amount:\x20','7867339505','2992446ZAvdiK','toLowerCase','error','5983062AeRoTf','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','4392324FFMLMk','70487340mLJkcl','unknown','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','findUnique','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','from','Payment\x20ID\x20is\x20required','JPG','sendDirectMessage','sendShopFile','5ksZbCE','includes','File\x20data\x20is\x20required','üè™\x20Shop:\x20','gateway','üåê\x20Customer\x20IP:\x20','117QzkZaS','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','payment','168716mAtYRl','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','jpg','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','Unsupported\x20file\x20type:\x20','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','KB)\x0a','\x20\x20\x20-\x20Payment\x20ID:\x20','toUpperCase','telegramBotService','status'];a8_0x1403=function(){return _0xc9e19f;};return a8_0x1403();}var __importDefault=this&&this[a8_0x595982(0xf7)]||function(_0x482fc5){const _0x2f3147=a8_0x595982;return _0x482fc5&&_0x482fc5[_0x2f3147(0xa1)]?_0x482fc5:{'default':_0x482fc5};};Object[a8_0x595982(0xf3)](exports,'__esModule',{'value':!![]}),exports[a8_0x595982(0xef)]=exports[a8_0x595982(0x9a)]=void 0x0;const database_1=__importDefault(require(a8_0x595982(0x9b))),telegramBotService_1=require(a8_0x595982(0xed));class ManualPaymentController{async[a8_0x595982(0xee)](_0x56972a,_0x12e95f){const _0x53e677=a8_0x595982;try{const {paymentId:_0x5deb9a,fileData:_0x4b96e4,fileType:_0x115d50,fileName:_0x31823d}=_0x56972a['body'],_0x29cf50=_0x56972a['ip']||_0x56972a[_0x53e677(0xe2)]?.[_0x53e677(0xf0)]||_0x53e677(0xc5);console['log'](_0x53e677(0x9c)+_0x5deb9a),console['log'](_0x53e677(0xf8)+_0x115d50+',\x20size:\x20'+(_0x4b96e4?Math[_0x53e677(0xac)](_0x4b96e4[_0x53e677(0xf1)]*0.75/0x400):0x0)+'KB'),console[_0x53e677(0xa6)](_0x53e677(0x102)+_0x29cf50);if(!_0x5deb9a){_0x12e95f[_0x53e677(0xe1)](0x190)[_0x53e677(0x9d)]({'success':![],'error':_0x53e677(0xca)});return;}if(!_0x4b96e4){_0x12e95f[_0x53e677(0xe1)](0x190)[_0x53e677(0x9d)]({'success':![],'error':_0x53e677(0xd0)});return;}if(!_0x115d50){_0x12e95f[_0x53e677(0xe1)](0x190)[_0x53e677(0x9d)]({'success':![],'error':_0x53e677(0xbb)});return;}const _0x4c9343=[_0x53e677(0x103),_0x53e677(0xd9),_0x53e677(0xf2),_0x53e677(0xa5),_0x53e677(0xae)],_0xacb898=_0x115d50[_0x53e677(0xbf)]()[_0x53e677(0xa9)]('.','');if(!_0x4c9343[_0x53e677(0xcf)](_0xacb898)){_0x12e95f[_0x53e677(0xe1)](0x190)['json']({'success':![],'error':_0x53e677(0xdb)+_0x115d50+'.\x20Supported:\x20'+_0x4c9343[_0x53e677(0xaa)](',\x20')});return;}const _0x53246e=0xa*0x400*0x400;if(_0x4b96e4[_0x53e677(0xf1)]>_0x53246e){_0x12e95f[_0x53e677(0xe1)](0x190)[_0x53e677(0x9d)]({'success':![],'error':'File\x20too\x20large.\x20Maximum\x20size:\x2010MB'});return;}const _0x3cc31b=await database_1[_0x53e677(0xb7)][_0x53e677(0xd6)][_0x53e677(0xc7)]({'where':{'id':_0x5deb9a},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3cc31b){console[_0x53e677(0xa6)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x5deb9a),_0x12e95f[_0x53e677(0xe1)](0x194)[_0x53e677(0x9d)]({'success':![],'error':_0x53e677(0xfc)});return;}if(_0x3cc31b['gateway']!==_0x53e677(0xb5)&&_0x3cc31b[_0x53e677(0xd2)]!==_0x53e677(0xa4)){console[_0x53e677(0xa6)](_0x53e677(0xd8)+_0x3cc31b['gateway']),_0x12e95f[_0x53e677(0xe1)](0x190)[_0x53e677(0x9d)]({'success':![],'error':_0x53e677(0xe6)+_0x3cc31b[_0x53e677(0xd2)]});return;}let _0x250ab5=_0x4b96e4;_0x4b96e4['includes'](',')&&(_0x250ab5=_0x4b96e4[_0x53e677(0xea)](',')[0x1]);try{Buffer[_0x53e677(0xc9)](_0x250ab5,_0x53e677(0xa0));}catch(_0x371e1e){_0x12e95f[_0x53e677(0xe1)](0x190)[_0x53e677(0x9d)]({'success':![],'error':_0x53e677(0xb3)});return;}const _0x325e08=await database_1[_0x53e677(0xb7)][_0x53e677(0xd6)]['update']({'where':{'id':_0x5deb9a},'data':{'status':_0x53e677(0xf9),'updatedAt':new Date()}});console[_0x53e677(0xa6)](_0x53e677(0xba)),console[_0x53e677(0xa6)](_0x53e677(0xde)+_0x5deb9a),console['log']('\x20\x20\x20-\x20Gateway:\x20'+_0x3cc31b[_0x53e677(0xd2)][_0x53e677(0xdf)]()),console[_0x53e677(0xa6)](_0x53e677(0xf6)+_0xacb898),console[_0x53e677(0xa6)]('\x20\x20\x20-\x20File\x20size:\x20'+Math[_0x53e677(0xac)](_0x250ab5['length']*0.75/0x400)+'KB'),console[_0x53e677(0xa6)](_0x53e677(0xd5));try{const _0x1f8ffa=_0x3cc31b[_0x53e677(0xd2)][_0x53e677(0xdf)](),_0x2a8bc6=_0x3cc31b[_0x53e677(0xa8)][_0x53e677(0xfb)]||_0x3cc31b[_0x53e677(0xa8)][_0x53e677(0xff)],_0x5c4b92=Math[_0x53e677(0xac)](_0x250ab5[_0x53e677(0xf1)]*0.75/0x400),_0x544888=_0x53e677(0xfd)+_0x1f8ffa+'\x20Payment\x20Proof\x20Received\x0a\x0a'+('üí≥\x20Payment\x20ID:\x20'+_0x5deb9a+'\x0a')+(_0x53e677(0xbc)+_0x3cc31b[_0x53e677(0x99)]+'\x20'+_0x3cc31b['currency']+'\x0a')+(_0x53e677(0xe4)+_0xacb898[_0x53e677(0xdf)]()+'\x20('+_0x5c4b92+_0x53e677(0xdd))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x53e677(0xd3)+_0x29cf50+'\x0a\x0a')+_0x53e677(0xec);await telegramBotService_1['telegramBotService'][_0x53e677(0xe3)](_0x3cc31b['shopId'],_0x544888,{'parse_mode':'Markdown'});const _0x1470f3=Buffer[_0x53e677(0xc9)](_0x250ab5,_0x53e677(0xa0)),_0x15f4f6=_0x53e677(0x9e)+_0x5deb9a+'.'+_0xacb898;await telegramBotService_1[_0x53e677(0xe0)][_0x53e677(0xcd)](_0x3cc31b[_0x53e677(0xa7)],_0x1470f3,_0x15f4f6,_0x53e677(0xe9)+_0x5deb9a),console[_0x53e677(0xa6)](_0x53e677(0xc8));const _0x2b436c=_0x53e677(0xbd),_0x1acac8='üîÑ\x20'+_0x1f8ffa+_0x53e677(0x100)+(_0x53e677(0xb6)+_0x5deb9a+'\x0a')+(_0x53e677(0xd1)+_0x2a8bc6+'\x0a')+(_0x53e677(0xbc)+_0x3cc31b[_0x53e677(0x99)]+'\x20'+_0x3cc31b[_0x53e677(0xab)]+'\x0a')+(_0x53e677(0xe4)+_0xacb898['toUpperCase']()+'\x20('+_0x5c4b92+'KB)\x0a')+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x53e677(0xd3)+_0x29cf50+'\x0a\x0a')+_0x53e677(0xdc);await telegramBotService_1[_0x53e677(0xe0)][_0x53e677(0xcc)](parseInt(_0x2b436c),_0x1acac8),await telegramBotService_1[_0x53e677(0xe0)]['sendDirectFile'](parseInt(_0x2b436c),_0x1470f3,_0x15f4f6,_0x53e677(0xb2)+_0x5deb9a),console['log'](_0x53e677(0xf5));}catch(_0x1a498f){console[_0x53e677(0xc0)](_0x53e677(0xc2),_0x1a498f);}_0x12e95f[_0x53e677(0x9d)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x325e08['id'],'status':_0x325e08[_0x53e677(0xe1)],'gateway':_0x3cc31b[_0x53e677(0xd2)],'fileType':_0xacb898,'fileSize':Math[_0x53e677(0xac)](_0x250ab5[_0x53e677(0xf1)]*0.75/0x400)+'KB','uploadedAt':_0x325e08[_0x53e677(0xa2)]}});}catch(_0x1b22f0){console[_0x53e677(0xc0)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x1b22f0),_0x12e95f['status'](0x1f4)[_0x53e677(0x9d)]({'success':![],'error':_0x53e677(0xb4),'details':_0x1b22f0 instanceof Error?_0x1b22f0['message']:_0x53e677(0xa3)});}}async[a8_0x595982(0xe7)](_0x4952af,_0x3ef384){const _0x4cfa9e=a8_0x595982;try{const {paymentId:_0x25b19b}=_0x4952af[_0x4cfa9e(0x9f)];console[_0x4cfa9e(0xa6)](_0x4cfa9e(0xb0)+_0x25b19b);const _0x45e429=await database_1[_0x4cfa9e(0xb7)]['payment'][_0x4cfa9e(0xc7)]({'where':{'id':_0x25b19b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x45e429){_0x3ef384[_0x4cfa9e(0xe1)](0x194)[_0x4cfa9e(0x9d)]({'success':![],'error':_0x4cfa9e(0xfc)});return;}if(_0x45e429[_0x4cfa9e(0xd2)]!==_0x4cfa9e(0xb5)&&_0x45e429[_0x4cfa9e(0xd2)]!==_0x4cfa9e(0xa4)){_0x3ef384['status'](0x190)['json']({'success':![],'error':_0x4cfa9e(0xe8)+_0x45e429[_0x4cfa9e(0xd2)]});return;}let _0x4547dd='',_0x144fd6=_0x45e429[_0x4cfa9e(0xab)],_0x508a23='';if(_0x45e429['gateway']===_0x4cfa9e(0xb5))_0x508a23='Interac\x20e-Transfer',_0x144fd6='CAD',_0x4547dd='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x45e429[_0x4cfa9e(0x99)]+'\x20'+_0x144fd6+_0x4cfa9e(0xfe);else _0x45e429[_0x4cfa9e(0xd2)]===_0x4cfa9e(0xa4)&&(_0x508a23=_0x4cfa9e(0x101),_0x144fd6='EUR',_0x4547dd=_0x4cfa9e(0xc6)+_0x45e429[_0x4cfa9e(0x99)]+'\x20'+_0x144fd6+_0x4cfa9e(0xfe));const _0xb1af3b={'success':!![],'data':{'paymentId':_0x45e429['id'],'gateway':_0x45e429[_0x4cfa9e(0xd2)],'gatewayName':_0x45e429['gateway'][_0x4cfa9e(0xdf)](),'transferType':_0x508a23,'amount':_0x45e429[_0x4cfa9e(0x99)],'currency':_0x144fd6,'status':_0x45e429[_0x4cfa9e(0xe1)],'instructions':_0x4547dd,'shopName':_0x45e429[_0x4cfa9e(0xa8)]['name']||_0x45e429[_0x4cfa9e(0xa8)][_0x4cfa9e(0xff)],'hasProof':![],'proofType':null,'createdAt':_0x45e429['createdAt'],'updatedAt':_0x45e429['updatedAt'],'supportedFileTypes':['PNG',_0x4cfa9e(0xcb),'JPEG',_0x4cfa9e(0xf4),_0x4cfa9e(0xeb)],'maxFileSize':_0x4cfa9e(0xb8)}};_0x3ef384[_0x4cfa9e(0x9d)](_0xb1af3b);}catch(_0x5c01a7){console[_0x4cfa9e(0xc0)](_0x4cfa9e(0xda),_0x5c01a7),_0x3ef384[_0x4cfa9e(0xe1)](0x1f4)[_0x4cfa9e(0x9d)]({'success':![],'error':_0x4cfa9e(0xb4),'details':_0x5c01a7 instanceof Error?_0x5c01a7[_0x4cfa9e(0xfa)]:_0x4cfa9e(0xa3)});}}}exports['ManualPaymentController']=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();