'use strict';const a11_0x347c53=a11_0x3e87;(function(_0x3f9e70,_0x1ce037){const _0x62ff9a=a11_0x3e87,_0x39d33a=_0x3f9e70();while(!![]){try{const _0x3aa992=parseInt(_0x62ff9a(0xd4))/0x1+parseInt(_0x62ff9a(0xe8))/0x2+-parseInt(_0x62ff9a(0xbb))/0x3*(-parseInt(_0x62ff9a(0xdf))/0x4)+-parseInt(_0x62ff9a(0xc2))/0x5+-parseInt(_0x62ff9a(0x10f))/0x6*(-parseInt(_0x62ff9a(0xc7))/0x7)+-parseInt(_0x62ff9a(0xe2))/0x8*(parseInt(_0x62ff9a(0xe1))/0x9)+-parseInt(_0x62ff9a(0xc4))/0xa*(parseInt(_0x62ff9a(0xeb))/0xb);if(_0x3aa992===_0x1ce037)break;else _0x39d33a['push'](_0x39d33a['shift']());}catch(_0x168cfe){_0x39d33a['push'](_0x39d33a['shift']());}}}(a11_0x3b48,0xc86ea));function a11_0x3b48(){const _0x33e64a=['üí∞\x20Amount:\x20','Internal\x20server\x20error','gateway','toUpperCase','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','üìã\x20Get\x20manual\x20payment\x20info:\x20','error','sendDirectFile','JPEG','pdf','findUnique','Payment\x20proof\x20for\x20','getManualPaymentInfo','sendDirectMessage','shopId','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','../services/telegramBotService','defineProperty','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','from','KB)\x0a','ManualPaymentController','base64','status','payment_proof_','üåê\x20Customer\x20IP:\x20','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','__esModule','default','manualPaymentController','6ecZDxA','heic','üí≥\x20Payment\x20ID:\x20','PROCESSING','includes','üì±\x20Admin\x20notification\x20and\x20file\x20sent','json','jpg','HEIC','sendShopNotification','updatedAt','currency','amount','üìÅ\x20File\x20type:\x20','10MB','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','join','round','üè™\x20Shop:\x20','createdAt','Payment\x20not\x20found','CAD','3763407CUgvhz','log','name','\x20\x20\x20-\x20Gateway:\x20','‚ùå\x20Payment\x20not\x20found:\x20','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','__importDefault','6127145eECTch','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','590frcjKS','remoteAddress','username','2828791fYgVuH','interac','Invalid\x20base64\x20file\x20data','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','PNG','SEPA\x20Bank\x20Transfer','\x20Payment\x20Proof\x20Received\x0a\x0a','unknown','PDF','\x20\x20\x20-\x20File\x20size:\x20','../config/database','params','message','500765GoEAKs','Payment\x20proof\x20uploaded\x20successfully','replace','File\x20data\x20is\x20required','jpeg','uploadPaymentProof','JPG',',\x20size:\x20','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','body','shop','4HebWYK','.\x20Supported:\x20','586287QGyMcE','24XQXhaa','telegramBotService','sepa','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','\x20\x20\x20-\x20Payment\x20ID:\x20','Unknown\x20error','1552406RESLCm','üîÑ\x20','update','129338XNrVRC','üìÅ\x20File:\x20','length','\x20\x20\x20-\x20File\x20type:\x20','payment'];a11_0x3b48=function(){return _0x33e64a;};return a11_0x3b48();}var __importDefault=this&&this[a11_0x347c53(0xc1)]||function(_0x38cfb3){const _0xb2a63e=a11_0x347c53;return _0x38cfb3&&_0x38cfb3[_0xb2a63e(0x10c)]?_0x38cfb3:{'default':_0x38cfb3};};Object[a11_0x347c53(0x101)](exports,a11_0x347c53(0x10c),{'value':!![]}),exports[a11_0x347c53(0x10e)]=exports[a11_0x347c53(0x105)]=void 0x0;const database_1=__importDefault(require(a11_0x347c53(0xd1))),telegramBotService_1=require(a11_0x347c53(0x100));class ManualPaymentController{async[a11_0x347c53(0xd9)](_0x596ceb,_0x3bc949){const _0x51259f=a11_0x347c53;try{const {paymentId:_0x5ae606,fileData:_0x556fff,fileType:_0x3355ca,fileName:_0x168a74}=_0x596ceb[_0x51259f(0xdd)],_0x14afb1=_0x596ceb['ip']||_0x596ceb['connection']?.[_0x51259f(0xc5)]||_0x51259f(0xce);console[_0x51259f(0xbc)]('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x5ae606),console[_0x51259f(0xbc)](_0x51259f(0x11c)+_0x3355ca+_0x51259f(0xdb)+(_0x556fff?Math[_0x51259f(0xb6)](_0x556fff['length']*0.75/0x400):0x0)+'KB'),console[_0x51259f(0xbc)]('üåê\x20Client\x20IP:\x20'+_0x14afb1);if(!_0x5ae606){_0x3bc949[_0x51259f(0x107)](0x190)[_0x51259f(0x115)]({'success':![],'error':'Payment\x20ID\x20is\x20required'});return;}if(!_0x556fff){_0x3bc949[_0x51259f(0x107)](0x190)[_0x51259f(0x115)]({'success':![],'error':_0x51259f(0xd7)});return;}if(!_0x3355ca){_0x3bc949[_0x51259f(0x107)](0x190)['json']({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x216298=['png',_0x51259f(0x116),_0x51259f(0xd8),_0x51259f(0x110),_0x51259f(0xf9)],_0x19641e=_0x3355ca['toLowerCase']()[_0x51259f(0xd6)]('.','');if(!_0x216298['includes'](_0x19641e)){_0x3bc949['status'](0x190)[_0x51259f(0x115)]({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x3355ca+_0x51259f(0xe0)+_0x216298[_0x51259f(0xb5)](',\x20')});return;}const _0x300795=0xa*0x400*0x400;if(_0x556fff[_0x51259f(0xed)]>_0x300795){_0x3bc949['status'](0x190)['json']({'success':![],'error':_0x51259f(0xe5)});return;}const _0x3321ed=await database_1[_0x51259f(0x10d)][_0x51259f(0xef)][_0x51259f(0xfa)]({'where':{'id':_0x5ae606},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3321ed){console[_0x51259f(0xbc)](_0x51259f(0xbf)+_0x5ae606),_0x3bc949[_0x51259f(0x107)](0x194)[_0x51259f(0x115)]({'success':![],'error':_0x51259f(0xb9)});return;}if(_0x3321ed[_0x51259f(0xf2)]!==_0x51259f(0xc8)&&_0x3321ed['gateway']!==_0x51259f(0xe4)){console['log']('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x3321ed[_0x51259f(0xf2)]),_0x3bc949[_0x51259f(0x107)](0x190)[_0x51259f(0x115)]({'success':![],'error':_0x51259f(0xff)+_0x3321ed[_0x51259f(0xf2)]});return;}let _0x11dc5c=_0x556fff;_0x556fff[_0x51259f(0x113)](',')&&(_0x11dc5c=_0x556fff['split'](',')[0x1]);try{Buffer[_0x51259f(0x103)](_0x11dc5c,'base64');}catch(_0x1a0895){_0x3bc949['status'](0x190)[_0x51259f(0x115)]({'success':![],'error':_0x51259f(0xc9)});return;}const _0x33a21e=await database_1[_0x51259f(0x10d)]['payment'][_0x51259f(0xea)]({'where':{'id':_0x5ae606},'data':{'status':_0x51259f(0x112),'updatedAt':new Date()}});console[_0x51259f(0xbc)]('‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:'),console[_0x51259f(0xbc)](_0x51259f(0xe6)+_0x5ae606),console['log'](_0x51259f(0xbe)+_0x3321ed['gateway'][_0x51259f(0xf3)]()),console[_0x51259f(0xbc)](_0x51259f(0xee)+_0x19641e),console[_0x51259f(0xbc)](_0x51259f(0xd0)+Math[_0x51259f(0xb6)](_0x11dc5c[_0x51259f(0xed)]*0.75/0x400)+'KB'),console[_0x51259f(0xbc)](_0x51259f(0x10b));try{const _0x1924d7=_0x3321ed['gateway']['toUpperCase'](),_0x4abb50=_0x3321ed[_0x51259f(0xde)][_0x51259f(0xbd)]||_0x3321ed[_0x51259f(0xde)][_0x51259f(0xc6)],_0x4b2f2d=Math['round'](_0x11dc5c[_0x51259f(0xed)]*0.75/0x400),_0x13e28a=_0x51259f(0xe9)+_0x1924d7+_0x51259f(0xcd)+(_0x51259f(0x111)+_0x5ae606+'\x0a')+(_0x51259f(0xf0)+_0x3321ed[_0x51259f(0x11b)]+'\x20'+_0x3321ed[_0x51259f(0x11a)]+'\x0a')+(_0x51259f(0xec)+_0x19641e[_0x51259f(0xf3)]()+'\x20('+_0x4b2f2d+_0x51259f(0x104))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x51259f(0x109)+_0x14afb1+'\x0a\x0a')+'‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1[_0x51259f(0xe3)][_0x51259f(0x118)](_0x3321ed[_0x51259f(0xfe)],_0x13e28a,{'parse_mode':'Markdown'});const _0x56b152=Buffer[_0x51259f(0x103)](_0x11dc5c,_0x51259f(0x106)),_0x55bcc7=_0x51259f(0x108)+_0x5ae606+'.'+_0x19641e;await telegramBotService_1[_0x51259f(0xe3)]['sendShopFile'](_0x3321ed['shopId'],_0x56b152,_0x55bcc7,_0x51259f(0xfb)+_0x5ae606),console[_0x51259f(0xbc)](_0x51259f(0x10a));const _0x5f37bb='7867339505',_0x58c0d5=_0x51259f(0xe9)+_0x1924d7+'\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a'+(_0x51259f(0x111)+_0x5ae606+'\x0a')+(_0x51259f(0xb7)+_0x4abb50+'\x0a')+(_0x51259f(0xf0)+_0x3321ed['amount']+'\x20'+_0x3321ed['currency']+'\x0a')+(_0x51259f(0xec)+_0x19641e[_0x51259f(0xf3)]()+'\x20('+_0x4b2f2d+_0x51259f(0x104))+_0x51259f(0xca)+(_0x51259f(0x109)+_0x14afb1+'\x0a\x0a')+_0x51259f(0xc3);await telegramBotService_1[_0x51259f(0xe3)][_0x51259f(0xfd)](parseInt(_0x5f37bb),_0x58c0d5),await telegramBotService_1[_0x51259f(0xe3)][_0x51259f(0xf7)](parseInt(_0x5f37bb),_0x56b152,_0x55bcc7,_0x51259f(0xb4)+_0x5ae606),console[_0x51259f(0xbc)](_0x51259f(0x114));}catch(_0x28ffbe){console[_0x51259f(0xf6)]('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:',_0x28ffbe);}_0x3bc949[_0x51259f(0x115)]({'success':!![],'message':_0x51259f(0xd5),'data':{'paymentId':_0x33a21e['id'],'status':_0x33a21e['status'],'gateway':_0x3321ed['gateway'],'fileType':_0x19641e,'fileSize':Math[_0x51259f(0xb6)](_0x11dc5c[_0x51259f(0xed)]*0.75/0x400)+'KB','uploadedAt':_0x33a21e[_0x51259f(0x119)]}});}catch(_0x46e717){console[_0x51259f(0xf6)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x46e717),_0x3bc949[_0x51259f(0x107)](0x1f4)[_0x51259f(0x115)]({'success':![],'error':'Internal\x20server\x20error','details':_0x46e717 instanceof Error?_0x46e717[_0x51259f(0xd3)]:_0x51259f(0xe7)});}}async[a11_0x347c53(0xfc)](_0x5c61db,_0x46de27){const _0x7f3d59=a11_0x347c53;try{const {paymentId:_0x3221f6}=_0x5c61db[_0x7f3d59(0xd2)];console[_0x7f3d59(0xbc)](_0x7f3d59(0xf5)+_0x3221f6);const _0x5944f5=await database_1[_0x7f3d59(0x10d)][_0x7f3d59(0xef)][_0x7f3d59(0xfa)]({'where':{'id':_0x3221f6},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5944f5){_0x46de27[_0x7f3d59(0x107)](0x194)[_0x7f3d59(0x115)]({'success':![],'error':_0x7f3d59(0xb9)});return;}if(_0x5944f5[_0x7f3d59(0xf2)]!=='interac'&&_0x5944f5['gateway']!==_0x7f3d59(0xe4)){_0x46de27['status'](0x190)['json']({'success':![],'error':_0x7f3d59(0xf4)+_0x5944f5[_0x7f3d59(0xf2)]});return;}let _0x1c96bf='',_0x2b4d54=_0x5944f5['currency'],_0x5ed715='';if(_0x5944f5[_0x7f3d59(0xf2)]===_0x7f3d59(0xc8))_0x5ed715='Interac\x20e-Transfer',_0x2b4d54=_0x7f3d59(0xba),_0x1c96bf=_0x7f3d59(0xdc)+_0x5944f5[_0x7f3d59(0x11b)]+'\x20'+_0x2b4d54+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.';else _0x5944f5[_0x7f3d59(0xf2)]===_0x7f3d59(0xe4)&&(_0x5ed715=_0x7f3d59(0xcc),_0x2b4d54='EUR',_0x1c96bf='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x5944f5[_0x7f3d59(0x11b)]+'\x20'+_0x2b4d54+_0x7f3d59(0xc0));const _0x2c0b8c={'success':!![],'data':{'paymentId':_0x5944f5['id'],'gateway':_0x5944f5[_0x7f3d59(0xf2)],'gatewayName':_0x5944f5[_0x7f3d59(0xf2)][_0x7f3d59(0xf3)](),'transferType':_0x5ed715,'amount':_0x5944f5['amount'],'currency':_0x2b4d54,'status':_0x5944f5[_0x7f3d59(0x107)],'instructions':_0x1c96bf,'shopName':_0x5944f5['shop']['name']||_0x5944f5['shop']['username'],'hasProof':![],'proofType':null,'createdAt':_0x5944f5[_0x7f3d59(0xb8)],'updatedAt':_0x5944f5['updatedAt'],'supportedFileTypes':[_0x7f3d59(0xcb),_0x7f3d59(0xda),_0x7f3d59(0xf8),_0x7f3d59(0x117),_0x7f3d59(0xcf)],'maxFileSize':_0x7f3d59(0xb3)}};_0x46de27[_0x7f3d59(0x115)](_0x2c0b8c);}catch(_0x196d27){console[_0x7f3d59(0xf6)](_0x7f3d59(0x102),_0x196d27),_0x46de27[_0x7f3d59(0x107)](0x1f4)[_0x7f3d59(0x115)]({'success':![],'error':_0x7f3d59(0xf1),'details':_0x196d27 instanceof Error?_0x196d27[_0x7f3d59(0xd3)]:_0x7f3d59(0xe7)});}}}function a11_0x3e87(_0x5e9958,_0xfa0c9e){_0x5e9958=_0x5e9958-0xb3;const _0x3b486e=a11_0x3b48();let _0x3e87bb=_0x3b486e[_0x5e9958];return _0x3e87bb;}exports[a11_0x347c53(0x105)]=ManualPaymentController,exports[a11_0x347c53(0x10e)]=new ManualPaymentController();