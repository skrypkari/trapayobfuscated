'use strict';function a9_0x5530(_0x4279cb,_0x22f1f9){_0x4279cb=_0x4279cb-0xa1;const _0x520fb2=a9_0x520f();let _0x5530fc=_0x520fb2[_0x4279cb];return _0x5530fc;}const a9_0x125288=a9_0x5530;(function(_0x5976fd,_0xb4d71){const _0x4bd952=a9_0x5530,_0x2230a5=_0x5976fd();while(!![]){try{const _0x53ffc2=-parseInt(_0x4bd952(0xc1))/0x1*(parseInt(_0x4bd952(0xec))/0x2)+-parseInt(_0x4bd952(0xa3))/0x3+-parseInt(_0x4bd952(0xe4))/0x4*(parseInt(_0x4bd952(0xe5))/0x5)+-parseInt(_0x4bd952(0xdc))/0x6*(parseInt(_0x4bd952(0xa8))/0x7)+parseInt(_0x4bd952(0xb3))/0x8+-parseInt(_0x4bd952(0xe1))/0x9+parseInt(_0x4bd952(0x104))/0xa*(parseInt(_0x4bd952(0xa6))/0xb);if(_0x53ffc2===_0xb4d71)break;else _0x2230a5['push'](_0x2230a5['shift']());}catch(_0x172c86){_0x2230a5['push'](_0x2230a5['shift']());}}}(a9_0x520f,0x6ea56));function a9_0x520f(){const _0x5db1eb=['message','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','getManualPaymentInfo','üîÑ\x20','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','üí≥\x20Payment\x20ID:\x20','10MB','\x20\x20\x20-\x20File\x20size:\x20','jpg','findUnique','../services/telegramBotService','üìÅ\x20File:\x20','ManualPaymentController','‚ùå\x20Upload\x20payment\x20proof\x20error:','20DWEeay','üåê\x20Customer\x20IP:\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent','__importDefault','üìÅ\x20File\x20type:\x20','1898841pwPtBm','üåê\x20Client\x20IP:\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','10113213OjFRLx','log','1819559QSflqi','PDF','update','currency','\x20\x20\x20-\x20Payment\x20ID:\x20','SEPA\x20Bank\x20Transfer','unknown','default','üìã\x20Get\x20manual\x20payment\x20info:\x20','Markdown','name','3757256RmljNH',',\x20size:\x20','../config/database','uploadPaymentProof','üí∞\x20Amount:\x20','connection','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','\x20\x20\x20-\x20Gateway:\x20','telegramBotService','shopId','sendShopFile','replace','\x20Payment\x20Proof\x20Received\x0a\x0a','461081kxfIeY','manualPaymentController','Payment\x20ID\x20is\x20required','error','json','File\x20data\x20is\x20required','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','updatedAt','pdf','from','round','Internal\x20server\x20error','length','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','shop','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','includes','defineProperty','heic','‚ùå\x20Payment\x20not\x20found:\x20','CAD','amount','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','interac','EUR','KB)\x0a','username','6obpKKA','Unknown\x20error','payment','toUpperCase','base64','3618117gpQfTW','üè™\x20Shop:\x20','payment_proof_','4BFXDVo','496195DIETop','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','sepa','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','toLowerCase','status','gateway','2vPrLRD','JPEG','__esModule','File\x20type\x20is\x20required','join','Payment\x20not\x20found','HEIC','Interac\x20e-Transfer','split'];a9_0x520f=function(){return _0x5db1eb;};return a9_0x520f();}var __importDefault=this&&this[a9_0x125288(0xa1)]||function(_0x38c9ea){const _0x2ea7d5=a9_0x125288;return _0x38c9ea&&_0x38c9ea[_0x2ea7d5(0xee)]?_0x38c9ea:{'default':_0x38c9ea};};Object[a9_0x125288(0xd2)](exports,a9_0x125288(0xee),{'value':!![]}),exports[a9_0x125288(0xc2)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a9_0x125288(0xb5))),telegramBotService_1=require(a9_0x125288(0x100));class ManualPaymentController{async[a9_0x125288(0xb6)](_0x17b5fc,_0x293c47){const _0x4247c7=a9_0x125288;try{const {paymentId:_0x1a52c0,fileData:_0x29daff,fileType:_0x49f5fd,fileName:_0x1d3fa8}=_0x17b5fc['body'],_0x5ddb7a=_0x17b5fc['ip']||_0x17b5fc[_0x4247c7(0xb8)]?.['remoteAddress']||_0x4247c7(0xae);console['log'](_0x4247c7(0xf6)+_0x1a52c0),console[_0x4247c7(0xa7)](_0x4247c7(0xa2)+_0x49f5fd+_0x4247c7(0xb4)+(_0x29daff?Math[_0x4247c7(0xcb)](_0x29daff[_0x4247c7(0xcd)]*0.75/0x400):0x0)+'KB'),console['log'](_0x4247c7(0xa4)+_0x5ddb7a);if(!_0x1a52c0){_0x293c47[_0x4247c7(0xea)](0x190)['json']({'success':![],'error':_0x4247c7(0xc3)});return;}if(!_0x29daff){_0x293c47[_0x4247c7(0xea)](0x190)[_0x4247c7(0xc5)]({'success':![],'error':_0x4247c7(0xc6)});return;}if(!_0x49f5fd){_0x293c47[_0x4247c7(0xea)](0x190)['json']({'success':![],'error':_0x4247c7(0xef)});return;}const _0x5415a7=['png',_0x4247c7(0xfe),'jpeg',_0x4247c7(0xd3),_0x4247c7(0xc9)],_0x492b21=_0x49f5fd[_0x4247c7(0xe9)]()[_0x4247c7(0xbf)]('.','');if(!_0x5415a7[_0x4247c7(0xd1)](_0x492b21)){_0x293c47['status'](0x190)[_0x4247c7(0xc5)]({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x49f5fd+'.\x20Supported:\x20'+_0x5415a7[_0x4247c7(0xf0)](',\x20')});return;}const _0x412a2e=0xa*0x400*0x400;if(_0x29daff['length']>_0x412a2e){_0x293c47[_0x4247c7(0xea)](0x190)[_0x4247c7(0xc5)]({'success':![],'error':'File\x20too\x20large.\x20Maximum\x20size:\x2010MB'});return;}const _0x4fb62b=await database_1[_0x4247c7(0xaf)]['payment'][_0x4247c7(0xff)]({'where':{'id':_0x1a52c0},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4fb62b){console[_0x4247c7(0xa7)](_0x4247c7(0xd4)+_0x1a52c0),_0x293c47[_0x4247c7(0xea)](0x194)[_0x4247c7(0xc5)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x4fb62b[_0x4247c7(0xeb)]!==_0x4247c7(0xd8)&&_0x4fb62b['gateway']!==_0x4247c7(0xe7)){console[_0x4247c7(0xa7)](_0x4247c7(0xe6)+_0x4fb62b['gateway']),_0x293c47[_0x4247c7(0xea)](0x190)[_0x4247c7(0xc5)]({'success':![],'error':_0x4247c7(0xe8)+_0x4fb62b['gateway']});return;}let _0x8c324e=_0x29daff;_0x29daff[_0x4247c7(0xd1)](',')&&(_0x8c324e=_0x29daff[_0x4247c7(0xf4)](',')[0x1]);try{Buffer[_0x4247c7(0xca)](_0x8c324e,_0x4247c7(0xe0));}catch(_0x4fcad5){_0x293c47[_0x4247c7(0xea)](0x190)[_0x4247c7(0xc5)]({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x5584a2=await database_1[_0x4247c7(0xaf)][_0x4247c7(0xde)][_0x4247c7(0xaa)]({'where':{'id':_0x1a52c0},'data':{'status':'PROCESSING','updatedAt':new Date()}});console[_0x4247c7(0xa7)](_0x4247c7(0xce)),console[_0x4247c7(0xa7)](_0x4247c7(0xac)+_0x1a52c0),console[_0x4247c7(0xa7)](_0x4247c7(0xbb)+_0x4fb62b[_0x4247c7(0xeb)][_0x4247c7(0xdf)]()),console[_0x4247c7(0xa7)]('\x20\x20\x20-\x20File\x20type:\x20'+_0x492b21),console[_0x4247c7(0xa7)](_0x4247c7(0xfd)+Math['round'](_0x8c324e[_0x4247c7(0xcd)]*0.75/0x400)+'KB'),console[_0x4247c7(0xa7)](_0x4247c7(0xa5));try{const _0x3a89ef=_0x4fb62b['gateway'][_0x4247c7(0xdf)](),_0xb85eff=_0x4fb62b['shop'][_0x4247c7(0xb2)]||_0x4fb62b['shop']['username'],_0x526ef9=Math['round'](_0x8c324e[_0x4247c7(0xcd)]*0.75/0x400),_0x549893=_0x4247c7(0xf8)+_0x3a89ef+_0x4247c7(0xc0)+(_0x4247c7(0xfb)+_0x1a52c0+'\x0a')+(_0x4247c7(0xb7)+_0x4fb62b[_0x4247c7(0xd6)]+'\x20'+_0x4fb62b[_0x4247c7(0xab)]+'\x0a')+(_0x4247c7(0x101)+_0x492b21[_0x4247c7(0xdf)]()+'\x20('+_0x526ef9+_0x4247c7(0xda))+_0x4247c7(0xfa)+(_0x4247c7(0x105)+_0x5ddb7a+'\x0a\x0a')+'‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x4fb62b[_0x4247c7(0xbd)],_0x549893,{'parse_mode':_0x4247c7(0xb1)});const _0x435b1a=Buffer['from'](_0x8c324e,'base64'),_0x4b59fb=_0x4247c7(0xe3)+_0x1a52c0+'.'+_0x492b21;await telegramBotService_1['telegramBotService'][_0x4247c7(0xbe)](_0x4fb62b[_0x4247c7(0xbd)],_0x435b1a,_0x4b59fb,'Payment\x20proof\x20for\x20'+_0x1a52c0),console[_0x4247c7(0xa7)](_0x4247c7(0xd7));const _0x5394f0='7867339505',_0x36314c='üîÑ\x20'+_0x3a89ef+_0x4247c7(0xf9)+(_0x4247c7(0xfb)+_0x1a52c0+'\x0a')+(_0x4247c7(0xe2)+_0xb85eff+'\x0a')+('üí∞\x20Amount:\x20'+_0x4fb62b[_0x4247c7(0xd6)]+'\x20'+_0x4fb62b['currency']+'\x0a')+('üìÅ\x20File:\x20'+_0x492b21['toUpperCase']()+'\x20('+_0x526ef9+_0x4247c7(0xda))+_0x4247c7(0xfa)+(_0x4247c7(0x105)+_0x5ddb7a+'\x0a\x0a')+'‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.';await telegramBotService_1['telegramBotService']['sendDirectMessage'](parseInt(_0x5394f0),_0x36314c),await telegramBotService_1[_0x4247c7(0xbc)]['sendDirectFile'](parseInt(_0x5394f0),_0x435b1a,_0x4b59fb,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x1a52c0),console[_0x4247c7(0xa7)](_0x4247c7(0x106));}catch(_0x47c8aa){console['error'](_0x4247c7(0xc7),_0x47c8aa);}_0x293c47[_0x4247c7(0xc5)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x5584a2['id'],'status':_0x5584a2['status'],'gateway':_0x4fb62b[_0x4247c7(0xeb)],'fileType':_0x492b21,'fileSize':Math[_0x4247c7(0xcb)](_0x8c324e[_0x4247c7(0xcd)]*0.75/0x400)+'KB','uploadedAt':_0x5584a2[_0x4247c7(0xc8)]}});}catch(_0x446036){console[_0x4247c7(0xc4)](_0x4247c7(0x103),_0x446036),_0x293c47[_0x4247c7(0xea)](0x1f4)['json']({'success':![],'error':'Internal\x20server\x20error','details':_0x446036 instanceof Error?_0x446036[_0x4247c7(0xf5)]:_0x4247c7(0xdd)});}}async[a9_0x125288(0xf7)](_0xe7d8ed,_0x39e880){const _0x50cab1=a9_0x125288;try{const {paymentId:_0x3116d9}=_0xe7d8ed['params'];console[_0x50cab1(0xa7)](_0x50cab1(0xb0)+_0x3116d9);const _0x27be38=await database_1[_0x50cab1(0xaf)][_0x50cab1(0xde)]['findUnique']({'where':{'id':_0x3116d9},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x27be38){_0x39e880[_0x50cab1(0xea)](0x194)[_0x50cab1(0xc5)]({'success':![],'error':_0x50cab1(0xf1)});return;}if(_0x27be38[_0x50cab1(0xeb)]!==_0x50cab1(0xd8)&&_0x27be38['gateway']!==_0x50cab1(0xe7)){_0x39e880[_0x50cab1(0xea)](0x190)[_0x50cab1(0xc5)]({'success':![],'error':_0x50cab1(0xba)+_0x27be38[_0x50cab1(0xeb)]});return;}let _0x4e2b13='',_0x3e1175=_0x27be38['currency'],_0x58b807='';if(_0x27be38[_0x50cab1(0xeb)]===_0x50cab1(0xd8))_0x58b807=_0x50cab1(0xf3),_0x3e1175=_0x50cab1(0xd5),_0x4e2b13='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x27be38[_0x50cab1(0xd6)]+'\x20'+_0x3e1175+_0x50cab1(0xd0);else _0x27be38[_0x50cab1(0xeb)]===_0x50cab1(0xe7)&&(_0x58b807=_0x50cab1(0xad),_0x3e1175=_0x50cab1(0xd9),_0x4e2b13='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x27be38[_0x50cab1(0xd6)]+'\x20'+_0x3e1175+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0xf7c082={'success':!![],'data':{'paymentId':_0x27be38['id'],'gateway':_0x27be38[_0x50cab1(0xeb)],'gatewayName':_0x27be38[_0x50cab1(0xeb)][_0x50cab1(0xdf)](),'transferType':_0x58b807,'amount':_0x27be38[_0x50cab1(0xd6)],'currency':_0x3e1175,'status':_0x27be38[_0x50cab1(0xea)],'instructions':_0x4e2b13,'shopName':_0x27be38[_0x50cab1(0xcf)][_0x50cab1(0xb2)]||_0x27be38['shop'][_0x50cab1(0xdb)],'hasProof':![],'proofType':null,'createdAt':_0x27be38['createdAt'],'updatedAt':_0x27be38['updatedAt'],'supportedFileTypes':['PNG','JPG',_0x50cab1(0xed),_0x50cab1(0xf2),_0x50cab1(0xa9)],'maxFileSize':_0x50cab1(0xfc)}};_0x39e880['json'](_0xf7c082);}catch(_0x2d8b3e){console['error'](_0x50cab1(0xb9),_0x2d8b3e),_0x39e880[_0x50cab1(0xea)](0x1f4)[_0x50cab1(0xc5)]({'success':![],'error':_0x50cab1(0xcc),'details':_0x2d8b3e instanceof Error?_0x2d8b3e[_0x50cab1(0xf5)]:_0x50cab1(0xdd)});}}}exports[a9_0x125288(0x102)]=ManualPaymentController,exports[a9_0x125288(0xc2)]=new ManualPaymentController();