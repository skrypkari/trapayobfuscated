'use strict';const a11_0x386b0a=a11_0x4f7f;(function(_0x48b4dd,_0x3d170d){const _0x4dd4ac=a11_0x4f7f,_0x641978=_0x48b4dd();while(!![]){try{const _0xe61c25=-parseInt(_0x4dd4ac(0xd1))/0x1*(-parseInt(_0x4dd4ac(0xa8))/0x2)+parseInt(_0x4dd4ac(0xcd))/0x3+-parseInt(_0x4dd4ac(0xd3))/0x4*(parseInt(_0x4dd4ac(0x7d))/0x5)+-parseInt(_0x4dd4ac(0xac))/0x6*(-parseInt(_0x4dd4ac(0xe4))/0x7)+parseInt(_0x4dd4ac(0xad))/0x8*(-parseInt(_0x4dd4ac(0x8b))/0x9)+parseInt(_0x4dd4ac(0x88))/0xa*(-parseInt(_0x4dd4ac(0xc7))/0xb)+parseInt(_0x4dd4ac(0x9b))/0xc*(parseInt(_0x4dd4ac(0xc0))/0xd);if(_0xe61c25===_0x3d170d)break;else _0x641978['push'](_0x641978['shift']());}catch(_0x4a192c){_0x641978['push'](_0x641978['shift']());}}}(a11_0x2c05,0xdf850));function a11_0x4f7f(_0x41f8be,_0x28f160){_0x41f8be=_0x41f8be-0x7c;const _0x2c056d=a11_0x2c05();let _0x4f7f4c=_0x2c056d[_0x41f8be];return _0x4f7f4c;}function a11_0x2c05(){const _0x43c35f=['4294255yzuODe','üí≥\x20Payment\x20ID:\x20','getManualPaymentInfo','üí∞\x20Amount:\x20','uploadPaymentProof','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','name','KB)\x0a','üîÑ\x20','toLowerCase','9565540VZRYsl','round','Unsupported\x20file\x20type:\x20','1812816ibZkZW','status','Payment\x20ID\x20is\x20required','JPEG','shopId','heic','payment','Invalid\x20base64\x20file\x20data','CAD','Payment\x20proof\x20uploaded\x20successfully','üìÅ\x20File\x20type:\x20','currency','findUnique','updatedAt','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','jpeg','948fUnUmr','PROCESSING','username','Payment\x20not\x20found','toUpperCase','üè™\x20Shop:\x20','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','from','shop','üìÅ\x20File:\x20','base64',',\x20size:\x20','connection','3170294aEMLxr','../services/telegramBotService','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','join','18IavDJn','16SpRQis','interac','SEPA\x20Bank\x20Transfer','createdAt','default','message','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','length','pdf','defineProperty','sendDirectMessage','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','manualPaymentController','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','__esModule','JPG','gateway','unknown','134459riRTYk','error','remoteAddress','üåê\x20Client\x20IP:\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent','telegramBotService','\x20\x20\x20-\x20File\x20size:\x20','11YDQOFC','includes','log','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','7867339505','Internal\x20server\x20error','3358242bSWGXU','ManualPaymentController','PDF','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','1qWExIG','amount','8lyPLIQ','png','Unknown\x20error','Markdown','update','‚ùå\x20Upload\x20payment\x20proof\x20error:','.\x20Supported:\x20','sepa','json','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','../config/database','\x20\x20\x20-\x20File\x20type:\x20','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','10MB','‚ùå\x20Payment\x20not\x20found:\x20','File\x20data\x20is\x20required','PNG','1098958PGYPoB','Payment\x20proof\x20for\x20','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'];a11_0x2c05=function(){return _0x43c35f;};return a11_0x2c05();}var __importDefault=this&&this['__importDefault']||function(_0x235f6c){return _0x235f6c&&_0x235f6c['__esModule']?_0x235f6c:{'default':_0x235f6c};};Object[a11_0x386b0a(0xb6)](exports,a11_0x386b0a(0xbc),{'value':!![]}),exports[a11_0x386b0a(0xba)]=exports[a11_0x386b0a(0xce)]=void 0x0;const database_1=__importDefault(require(a11_0x386b0a(0xdd))),telegramBotService_1=require(a11_0x386b0a(0xa9));class ManualPaymentController{async[a11_0x386b0a(0x81)](_0x4dd08d,_0x15b2dc){const _0x509578=a11_0x386b0a;try{const {paymentId:_0x5a30d6,fileData:_0x53e0c0,fileType:_0xe185a5,fileName:_0x3466e9}=_0x4dd08d['body'],_0x11390f=_0x4dd08d['ip']||_0x4dd08d[_0x509578(0xa7)]?.[_0x509578(0xc2)]||_0x509578(0xbf);console[_0x509578(0xc9)]('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x5a30d6),console[_0x509578(0xc9)](_0x509578(0x95)+_0xe185a5+_0x509578(0xa6)+(_0x53e0c0?Math[_0x509578(0x89)](_0x53e0c0[_0x509578(0xb4)]*0.75/0x400):0x0)+'KB'),console[_0x509578(0xc9)](_0x509578(0xc3)+_0x11390f);if(!_0x5a30d6){_0x15b2dc[_0x509578(0x8c)](0x190)['json']({'success':![],'error':_0x509578(0x8d)});return;}if(!_0x53e0c0){_0x15b2dc['status'](0x190)[_0x509578(0xdb)]({'success':![],'error':_0x509578(0xe2)});return;}if(!_0xe185a5){_0x15b2dc[_0x509578(0x8c)](0x190)[_0x509578(0xdb)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x1a33a2=[_0x509578(0xd4),'jpg',_0x509578(0x9a),_0x509578(0x90),_0x509578(0xb5)],_0xaa7345=_0xe185a5[_0x509578(0x87)]()['replace']('.','');if(!_0x1a33a2[_0x509578(0xc8)](_0xaa7345)){_0x15b2dc[_0x509578(0x8c)](0x190)[_0x509578(0xdb)]({'success':![],'error':_0x509578(0x8a)+_0xe185a5+_0x509578(0xd9)+_0x1a33a2[_0x509578(0xab)](',\x20')});return;}const _0x53900f=0xa*0x400*0x400;if(_0x53e0c0[_0x509578(0xb4)]>_0x53900f){_0x15b2dc[_0x509578(0x8c)](0x190)[_0x509578(0xdb)]({'success':![],'error':_0x509578(0xdf)});return;}const _0x38bb37=await database_1[_0x509578(0xb1)][_0x509578(0x91)]['findUnique']({'where':{'id':_0x5a30d6},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x38bb37){console[_0x509578(0xc9)](_0x509578(0xe1)+_0x5a30d6),_0x15b2dc[_0x509578(0x8c)](0x194)[_0x509578(0xdb)]({'success':![],'error':_0x509578(0x9e)});return;}if(_0x38bb37[_0x509578(0xbe)]!=='interac'&&_0x38bb37[_0x509578(0xbe)]!=='sepa'){console[_0x509578(0xc9)](_0x509578(0x99)+_0x38bb37[_0x509578(0xbe)]),_0x15b2dc[_0x509578(0x8c)](0x190)[_0x509578(0xdb)]({'success':![],'error':_0x509578(0xaa)+_0x38bb37[_0x509578(0xbe)]});return;}let _0x248fc5=_0x53e0c0;_0x53e0c0[_0x509578(0xc8)](',')&&(_0x248fc5=_0x53e0c0['split'](',')[0x1]);try{Buffer[_0x509578(0xa2)](_0x248fc5,'base64');}catch(_0x5be264){_0x15b2dc[_0x509578(0x8c)](0x190)[_0x509578(0xdb)]({'success':![],'error':_0x509578(0x92)});return;}const _0x150d25=await database_1[_0x509578(0xb1)][_0x509578(0x91)][_0x509578(0xd7)]({'where':{'id':_0x5a30d6},'data':{'status':_0x509578(0x9c),'updatedAt':new Date()}});console['log']('‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:'),console[_0x509578(0xc9)]('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x5a30d6),console['log']('\x20\x20\x20-\x20Gateway:\x20'+_0x38bb37[_0x509578(0xbe)][_0x509578(0x9f)]()),console[_0x509578(0xc9)](_0x509578(0xde)+_0xaa7345),console[_0x509578(0xc9)](_0x509578(0xc6)+Math[_0x509578(0x89)](_0x248fc5[_0x509578(0xb4)]*0.75/0x400)+'KB'),console[_0x509578(0xc9)](_0x509578(0x83));try{const _0x5d0f43=_0x38bb37[_0x509578(0xbe)][_0x509578(0x9f)](),_0x27d00b=_0x38bb37[_0x509578(0xa3)][_0x509578(0x84)]||_0x38bb37[_0x509578(0xa3)][_0x509578(0x9d)],_0x3e078d=Math[_0x509578(0x89)](_0x248fc5[_0x509578(0xb4)]*0.75/0x400),_0x38e221=_0x509578(0x86)+_0x5d0f43+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0x509578(0x7e)+_0x5a30d6+'\x0a')+(_0x509578(0x80)+_0x38bb37[_0x509578(0xd2)]+'\x20'+_0x38bb37[_0x509578(0x96)]+'\x0a')+(_0x509578(0xa4)+_0xaa7345[_0x509578(0x9f)]()+'\x20('+_0x3e078d+_0x509578(0x85))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+('üåê\x20Customer\x20IP:\x20'+_0x11390f+'\x0a\x0a')+'‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1[_0x509578(0xc5)]['sendShopNotification'](_0x38bb37[_0x509578(0x8f)],_0x38e221,{'parse_mode':_0x509578(0xd6)});const _0x3b7c2c=Buffer['from'](_0x248fc5,_0x509578(0xa5)),_0x2095a9='payment_proof_'+_0x5a30d6+'.'+_0xaa7345;await telegramBotService_1[_0x509578(0xc5)]['sendShopFile'](_0x38bb37[_0x509578(0x8f)],_0x3b7c2c,_0x2095a9,_0x509578(0xe5)+_0x5a30d6),console[_0x509578(0xc9)](_0x509578(0xd0));const _0x4228f0=_0x509578(0xcb),_0x3a29fe=_0x509578(0x86)+_0x5d0f43+_0x509578(0xb8)+(_0x509578(0x7e)+_0x5a30d6+'\x0a')+(_0x509578(0xa0)+_0x27d00b+'\x0a')+(_0x509578(0x80)+_0x38bb37[_0x509578(0xd2)]+'\x20'+_0x38bb37['currency']+'\x0a')+('üìÅ\x20File:\x20'+_0xaa7345[_0x509578(0x9f)]()+'\x20('+_0x3e078d+_0x509578(0x85))+_0x509578(0xca)+('üåê\x20Customer\x20IP:\x20'+_0x11390f+'\x0a\x0a')+_0x509578(0xa1);await telegramBotService_1['telegramBotService'][_0x509578(0xb7)](parseInt(_0x4228f0),_0x3a29fe),await telegramBotService_1[_0x509578(0xc5)]['sendDirectFile'](parseInt(_0x4228f0),_0x3b7c2c,_0x2095a9,_0x509578(0xb9)+_0x5a30d6),console[_0x509578(0xc9)](_0x509578(0xc4));}catch(_0xb86b39){console[_0x509578(0xc1)](_0x509578(0xb3),_0xb86b39);}_0x15b2dc[_0x509578(0xdb)]({'success':!![],'message':_0x509578(0x94),'data':{'paymentId':_0x150d25['id'],'status':_0x150d25[_0x509578(0x8c)],'gateway':_0x38bb37[_0x509578(0xbe)],'fileType':_0xaa7345,'fileSize':Math['round'](_0x248fc5[_0x509578(0xb4)]*0.75/0x400)+'KB','uploadedAt':_0x150d25[_0x509578(0x98)]}});}catch(_0x43188d){console[_0x509578(0xc1)](_0x509578(0xd8),_0x43188d),_0x15b2dc[_0x509578(0x8c)](0x1f4)[_0x509578(0xdb)]({'success':![],'error':_0x509578(0xcc),'details':_0x43188d instanceof Error?_0x43188d[_0x509578(0xb2)]:_0x509578(0xd5)});}}async[a11_0x386b0a(0x7f)](_0x2f2ff8,_0x4daeb6){const _0x26640e=a11_0x386b0a;try{const {paymentId:_0x1a7119}=_0x2f2ff8['params'];console[_0x26640e(0xc9)]('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x1a7119);const _0x23f7e7=await database_1[_0x26640e(0xb1)][_0x26640e(0x91)][_0x26640e(0x97)]({'where':{'id':_0x1a7119},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x23f7e7){_0x4daeb6[_0x26640e(0x8c)](0x194)['json']({'success':![],'error':_0x26640e(0x9e)});return;}if(_0x23f7e7[_0x26640e(0xbe)]!==_0x26640e(0xae)&&_0x23f7e7[_0x26640e(0xbe)]!==_0x26640e(0xda)){_0x4daeb6[_0x26640e(0x8c)](0x190)[_0x26640e(0xdb)]({'success':![],'error':_0x26640e(0x82)+_0x23f7e7[_0x26640e(0xbe)]});return;}let _0x3fc6a2='',_0x15458c=_0x23f7e7[_0x26640e(0x96)],_0xd16044='';if(_0x23f7e7[_0x26640e(0xbe)]===_0x26640e(0xae))_0xd16044='Interac\x20e-Transfer',_0x15458c=_0x26640e(0x93),_0x3fc6a2='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x23f7e7['amount']+'\x20'+_0x15458c+_0x26640e(0xdc);else _0x23f7e7[_0x26640e(0xbe)]===_0x26640e(0xda)&&(_0xd16044=_0x26640e(0xaf),_0x15458c='EUR',_0x3fc6a2=_0x26640e(0x7c)+_0x23f7e7[_0x26640e(0xd2)]+'\x20'+_0x15458c+_0x26640e(0xdc));const _0x10055d={'success':!![],'data':{'paymentId':_0x23f7e7['id'],'gateway':_0x23f7e7[_0x26640e(0xbe)],'gatewayName':_0x23f7e7[_0x26640e(0xbe)][_0x26640e(0x9f)](),'transferType':_0xd16044,'amount':_0x23f7e7['amount'],'currency':_0x15458c,'status':_0x23f7e7[_0x26640e(0x8c)],'instructions':_0x3fc6a2,'shopName':_0x23f7e7['shop'][_0x26640e(0x84)]||_0x23f7e7['shop'][_0x26640e(0x9d)],'hasProof':![],'proofType':null,'createdAt':_0x23f7e7[_0x26640e(0xb0)],'updatedAt':_0x23f7e7['updatedAt'],'supportedFileTypes':[_0x26640e(0xe3),_0x26640e(0xbd),_0x26640e(0x8e),'HEIC',_0x26640e(0xcf)],'maxFileSize':_0x26640e(0xe0)}};_0x4daeb6[_0x26640e(0xdb)](_0x10055d);}catch(_0x1c615b){console[_0x26640e(0xc1)](_0x26640e(0xbb),_0x1c615b),_0x4daeb6[_0x26640e(0x8c)](0x1f4)[_0x26640e(0xdb)]({'success':![],'error':_0x26640e(0xcc),'details':_0x1c615b instanceof Error?_0x1c615b[_0x26640e(0xb2)]:_0x26640e(0xd5)});}}}exports[a11_0x386b0a(0xce)]=ManualPaymentController,exports[a11_0x386b0a(0xba)]=new ManualPaymentController();