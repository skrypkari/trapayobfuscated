'use strict';const a8_0x2ac866=a8_0x27dc;(function(_0x15dfff,_0x268db2){const _0xd07915=a8_0x27dc,_0x49c0a9=_0x15dfff();while(!![]){try{const _0x584efe=-parseInt(_0xd07915(0x1b5))/0x1*(-parseInt(_0xd07915(0x19a))/0x2)+parseInt(_0xd07915(0x1f3))/0x3*(parseInt(_0xd07915(0x1a8))/0x4)+parseInt(_0xd07915(0x1ce))/0x5+-parseInt(_0xd07915(0x1a2))/0x6*(-parseInt(_0xd07915(0x1b3))/0x7)+-parseInt(_0xd07915(0x1b7))/0x8+parseInt(_0xd07915(0x201))/0x9*(-parseInt(_0xd07915(0x1bd))/0xa)+-parseInt(_0xd07915(0x1d2))/0xb*(parseInt(_0xd07915(0x1f0))/0xc);if(_0x584efe===_0x268db2)break;else _0x49c0a9['push'](_0x49c0a9['shift']());}catch(_0xf67cf3){_0x49c0a9['push'](_0x49c0a9['shift']());}}}(a8_0x4932,0x3b813));var __importDefault=this&&this[a8_0x2ac866(0x1f8)]||function(_0x597f9e){const _0x16ffee=a8_0x2ac866;return _0x597f9e&&_0x597f9e[_0x16ffee(0x1d8)]?_0x597f9e:{'default':_0x597f9e};};function a8_0x27dc(_0x37bdb6,_0x3a6147){const _0x493278=a8_0x4932();return a8_0x27dc=function(_0x27dcb6,_0xd10c64){_0x27dcb6=_0x27dcb6-0x19a;let _0x240133=_0x493278[_0x27dcb6];return _0x240133;},a8_0x27dc(_0x37bdb6,_0x3a6147);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a8_0x2ac866(0x19b)]=exports[a8_0x2ac866(0x1c6)]=void 0x0;const database_1=__importDefault(require(a8_0x2ac866(0x1ba))),telegramBotService_1=require(a8_0x2ac866(0x1c2));function a8_0x4932(){const _0x1f5006=['‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','üìÅ\x20File:\x20','üåê\x20Client\x20IP:\x20','üí∞\x20Amount:\x20','\x20\x20\x20-\x20File\x20type:\x20','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','sendDirectMessage','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','body','Internal\x20server\x20error','createdAt','gateway','10MB','PROCESSING','588IVnGcl','uploadPaymentProof','sendShopFile','1069779jTCIWz','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','Payment\x20not\x20found','payment','log','__importDefault','join','shop','png','status','shopId','base64','interac','File\x20type\x20is\x20required','9FxfVSB','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','PNG','11732VLiVCF','manualPaymentController','currency','length','username','sepa','CAD','üè™\x20Shop:\x20','174eLMnjS','error','round','params','update','message','4REluzx','HEIC','üîÑ\x20','default','sendDirectFile','EUR','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','jpg','findUnique','20951xewtVq','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','53tWcqOX','Interac\x20e-Transfer','1477608fcPBiG','getManualPaymentInfo',',\x20size:\x20','../config/database','üí≥\x20Payment\x20ID:\x20','telegramBotService','2356610SYNqOv','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','pdf','‚ùå\x20Payment\x20not\x20found:\x20','from','../services/telegramBotService','sendShopNotification','remoteAddress','\x20Payment\x20Proof\x20Received\x0a\x0a','ManualPaymentController','replace','split','json','connection','toUpperCase','\x20\x20\x20-\x20File\x20size:\x20','Unknown\x20error','355320PDTyjC','heic','unknown','amount','36201zkIMCQ','‚ùå\x20Upload\x20payment\x20proof\x20error:','includes','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','KB)\x0a','Invalid\x20base64\x20file\x20data','__esModule','Payment\x20proof\x20for\x20','File\x20data\x20is\x20required','7867339505','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','\x20\x20\x20-\x20Gateway:\x20','toLowerCase','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','PDF','updatedAt'];a8_0x4932=function(){return _0x1f5006;};return a8_0x4932();}class ManualPaymentController{async[a8_0x2ac866(0x1f1)](_0x7cd423,_0x975876){const _0x5404c0=a8_0x2ac866;try{const {paymentId:_0x297fcb,fileData:_0x28d96b,fileType:_0x593049,fileName:_0x4b5d71}=_0x7cd423[_0x5404c0(0x1ea)],_0x3b2a8e=_0x7cd423['ip']||_0x7cd423[_0x5404c0(0x1ca)]?.[_0x5404c0(0x1c4)]||_0x5404c0(0x1d0);console[_0x5404c0(0x1f7)]('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x297fcb),console[_0x5404c0(0x1f7)]('üìÅ\x20File\x20type:\x20'+_0x593049+_0x5404c0(0x1b9)+(_0x28d96b?Math[_0x5404c0(0x1a4)](_0x28d96b[_0x5404c0(0x19d)]*0.75/0x400):0x0)+'KB'),console['log'](_0x5404c0(0x1e4)+_0x3b2a8e);if(!_0x297fcb){_0x975876[_0x5404c0(0x1fc)](0x190)[_0x5404c0(0x1c9)]({'success':![],'error':'Payment\x20ID\x20is\x20required'});return;}if(!_0x28d96b){_0x975876[_0x5404c0(0x1fc)](0x190)[_0x5404c0(0x1c9)]({'success':![],'error':_0x5404c0(0x1da)});return;}if(!_0x593049){_0x975876[_0x5404c0(0x1fc)](0x190)[_0x5404c0(0x1c9)]({'success':![],'error':_0x5404c0(0x200)});return;}const _0x4d2765=[_0x5404c0(0x1fb),_0x5404c0(0x1b1),'jpeg',_0x5404c0(0x1cf),_0x5404c0(0x1bf)],_0xed0337=_0x593049[_0x5404c0(0x1de)]()[_0x5404c0(0x1c7)]('.','');if(!_0x4d2765['includes'](_0xed0337)){_0x975876[_0x5404c0(0x1fc)](0x190)['json']({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x593049+'.\x20Supported:\x20'+_0x4d2765[_0x5404c0(0x1f9)](',\x20')});return;}const _0x4088c5=0xa*0x400*0x400;if(_0x28d96b[_0x5404c0(0x19d)]>_0x4088c5){_0x975876['status'](0x190)[_0x5404c0(0x1c9)]({'success':![],'error':_0x5404c0(0x1b4)});return;}const _0x540a38=await database_1['default'][_0x5404c0(0x1f6)]['findUnique']({'where':{'id':_0x297fcb},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x540a38){console['log'](_0x5404c0(0x1c0)+_0x297fcb),_0x975876['status'](0x194)['json']({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x540a38[_0x5404c0(0x1ed)]!==_0x5404c0(0x1ff)&&_0x540a38[_0x5404c0(0x1ed)]!==_0x5404c0(0x19f)){console[_0x5404c0(0x1f7)]('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x540a38[_0x5404c0(0x1ed)]),_0x975876[_0x5404c0(0x1fc)](0x190)['json']({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x540a38[_0x5404c0(0x1ed)]});return;}let _0x45ac43=_0x28d96b;_0x28d96b[_0x5404c0(0x1d4)](',')&&(_0x45ac43=_0x28d96b[_0x5404c0(0x1c8)](',')[0x1]);try{Buffer[_0x5404c0(0x1c1)](_0x45ac43,_0x5404c0(0x1fe));}catch(_0x5d9f09){_0x975876[_0x5404c0(0x1fc)](0x190)['json']({'success':![],'error':_0x5404c0(0x1d7)});return;}const _0x3d074e=await database_1[_0x5404c0(0x1ab)][_0x5404c0(0x1f6)][_0x5404c0(0x1a6)]({'where':{'id':_0x297fcb},'data':{'status':_0x5404c0(0x1ef),'updatedAt':new Date()}});console['log'](_0x5404c0(0x1be)),console[_0x5404c0(0x1f7)]('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x297fcb),console[_0x5404c0(0x1f7)](_0x5404c0(0x1dd)+_0x540a38[_0x5404c0(0x1ed)]['toUpperCase']()),console[_0x5404c0(0x1f7)](_0x5404c0(0x1e6)+_0xed0337),console[_0x5404c0(0x1f7)](_0x5404c0(0x1cc)+Math[_0x5404c0(0x1a4)](_0x45ac43['length']*0.75/0x400)+'KB'),console[_0x5404c0(0x1f7)](_0x5404c0(0x1b0));try{const _0x375c38=_0x540a38[_0x5404c0(0x1ed)]['toUpperCase'](),_0x54b9ce=_0x540a38['shop']['name']||_0x540a38[_0x5404c0(0x1fa)]['username'],_0x148bd1=Math[_0x5404c0(0x1a4)](_0x45ac43[_0x5404c0(0x19d)]*0.75/0x400),_0x1fd08a=_0x5404c0(0x1aa)+_0x375c38+_0x5404c0(0x1c5)+(_0x5404c0(0x1bb)+_0x297fcb+'\x0a')+(_0x5404c0(0x1e5)+_0x540a38[_0x5404c0(0x1d1)]+'\x20'+_0x540a38[_0x5404c0(0x19c)]+'\x0a')+(_0x5404c0(0x1e3)+_0xed0337[_0x5404c0(0x1cb)]()+'\x20('+_0x148bd1+_0x5404c0(0x1d6))+_0x5404c0(0x1af)+('üåê\x20Customer\x20IP:\x20'+_0x3b2a8e+'\x0a\x0a')+_0x5404c0(0x1e7);await telegramBotService_1[_0x5404c0(0x1bc)][_0x5404c0(0x1c3)](_0x540a38['shopId'],_0x1fd08a,{'parse_mode':'Markdown'});const _0x108993=Buffer[_0x5404c0(0x1c1)](_0x45ac43,_0x5404c0(0x1fe)),_0x503711='payment_proof_'+_0x297fcb+'.'+_0xed0337;await telegramBotService_1[_0x5404c0(0x1bc)][_0x5404c0(0x1f2)](_0x540a38[_0x5404c0(0x1fd)],_0x108993,_0x503711,_0x5404c0(0x1d9)+_0x297fcb),console[_0x5404c0(0x1f7)](_0x5404c0(0x1e9));const _0x23d42b=_0x5404c0(0x1db),_0x2720d6=_0x5404c0(0x1aa)+_0x375c38+_0x5404c0(0x1ae)+(_0x5404c0(0x1bb)+_0x297fcb+'\x0a')+(_0x5404c0(0x1a1)+_0x54b9ce+'\x0a')+(_0x5404c0(0x1e5)+_0x540a38['amount']+'\x20'+_0x540a38['currency']+'\x0a')+('üìÅ\x20File:\x20'+_0xed0337[_0x5404c0(0x1cb)]()+'\x20('+_0x148bd1+_0x5404c0(0x1d6))+_0x5404c0(0x1af)+('üåê\x20Customer\x20IP:\x20'+_0x3b2a8e+'\x0a\x0a')+_0x5404c0(0x1d5);await telegramBotService_1['telegramBotService'][_0x5404c0(0x1e8)](parseInt(_0x23d42b),_0x2720d6),await telegramBotService_1[_0x5404c0(0x1bc)][_0x5404c0(0x1ac)](parseInt(_0x23d42b),_0x108993,_0x503711,_0x5404c0(0x1dc)+_0x297fcb),console['log']('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x45f7b1){console['error'](_0x5404c0(0x1e2),_0x45f7b1);}_0x975876['json']({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x3d074e['id'],'status':_0x3d074e['status'],'gateway':_0x540a38[_0x5404c0(0x1ed)],'fileType':_0xed0337,'fileSize':Math[_0x5404c0(0x1a4)](_0x45ac43[_0x5404c0(0x19d)]*0.75/0x400)+'KB','uploadedAt':_0x3d074e[_0x5404c0(0x1e1)]}});}catch(_0x35f6c6){console[_0x5404c0(0x1a3)](_0x5404c0(0x1d3),_0x35f6c6),_0x975876[_0x5404c0(0x1fc)](0x1f4)['json']({'success':![],'error':_0x5404c0(0x1eb),'details':_0x35f6c6 instanceof Error?_0x35f6c6['message']:_0x5404c0(0x1cd)});}}async[a8_0x2ac866(0x1b8)](_0x4568de,_0x19fae8){const _0x47b92b=a8_0x2ac866;try{const {paymentId:_0x388eda}=_0x4568de[_0x47b92b(0x1a5)];console[_0x47b92b(0x1f7)]('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x388eda);const _0x2e1547=await database_1[_0x47b92b(0x1ab)][_0x47b92b(0x1f6)][_0x47b92b(0x1b2)]({'where':{'id':_0x388eda},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2e1547){_0x19fae8[_0x47b92b(0x1fc)](0x194)[_0x47b92b(0x1c9)]({'success':![],'error':_0x47b92b(0x1f5)});return;}if(_0x2e1547[_0x47b92b(0x1ed)]!==_0x47b92b(0x1ff)&&_0x2e1547['gateway']!==_0x47b92b(0x19f)){_0x19fae8[_0x47b92b(0x1fc)](0x190)[_0x47b92b(0x1c9)]({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x2e1547['gateway']});return;}let _0x2281eb='',_0x458c5b=_0x2e1547['currency'],_0x10d2c7='';if(_0x2e1547[_0x47b92b(0x1ed)]===_0x47b92b(0x1ff))_0x10d2c7=_0x47b92b(0x1b6),_0x458c5b=_0x47b92b(0x1a0),_0x2281eb=_0x47b92b(0x1f4)+_0x2e1547['amount']+'\x20'+_0x458c5b+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.';else _0x2e1547[_0x47b92b(0x1ed)]===_0x47b92b(0x19f)&&(_0x10d2c7='SEPA\x20Bank\x20Transfer',_0x458c5b=_0x47b92b(0x1ad),_0x2281eb=_0x47b92b(0x202)+_0x2e1547[_0x47b92b(0x1d1)]+'\x20'+_0x458c5b+_0x47b92b(0x1df));const _0x5c0d07={'success':!![],'data':{'paymentId':_0x2e1547['id'],'gateway':_0x2e1547[_0x47b92b(0x1ed)],'gatewayName':_0x2e1547[_0x47b92b(0x1ed)][_0x47b92b(0x1cb)](),'transferType':_0x10d2c7,'amount':_0x2e1547[_0x47b92b(0x1d1)],'currency':_0x458c5b,'status':_0x2e1547[_0x47b92b(0x1fc)],'instructions':_0x2281eb,'shopName':_0x2e1547['shop']['name']||_0x2e1547[_0x47b92b(0x1fa)][_0x47b92b(0x19e)],'hasProof':![],'proofType':null,'createdAt':_0x2e1547[_0x47b92b(0x1ec)],'updatedAt':_0x2e1547[_0x47b92b(0x1e1)],'supportedFileTypes':[_0x47b92b(0x203),'JPG','JPEG',_0x47b92b(0x1a9),_0x47b92b(0x1e0)],'maxFileSize':_0x47b92b(0x1ee)}};_0x19fae8[_0x47b92b(0x1c9)](_0x5c0d07);}catch(_0x33628f){console[_0x47b92b(0x1a3)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x33628f),_0x19fae8['status'](0x1f4)['json']({'success':![],'error':'Internal\x20server\x20error','details':_0x33628f instanceof Error?_0x33628f[_0x47b92b(0x1a7)]:'Unknown\x20error'});}}}exports['ManualPaymentController']=ManualPaymentController,exports[a8_0x2ac866(0x19b)]=new ManualPaymentController();