'use strict';const a8_0x55b118=a8_0x4a3b;(function(_0x1d76b4,_0x2d2610){const _0x335e61=a8_0x4a3b,_0x53c88c=_0x1d76b4();while(!![]){try{const _0x2a7885=-parseInt(_0x335e61(0xe2))/0x1+-parseInt(_0x335e61(0xb0))/0x2+parseInt(_0x335e61(0xd4))/0x3*(parseInt(_0x335e61(0xf3))/0x4)+-parseInt(_0x335e61(0xb9))/0x5*(parseInt(_0x335e61(0xb7))/0x6)+-parseInt(_0x335e61(0xea))/0x7+-parseInt(_0x335e61(0xd6))/0x8+parseInt(_0x335e61(0xd5))/0x9;if(_0x2a7885===_0x2d2610)break;else _0x53c88c['push'](_0x53c88c['shift']());}catch(_0x7a60bb){_0x53c88c['push'](_0x53c88c['shift']());}}}(a8_0x1ded,0xb63ce));function a8_0x4a3b(_0x43f5fb,_0x16bef1){const _0x1deda8=a8_0x1ded();return a8_0x4a3b=function(_0x4a3bd6,_0x1f4a12){_0x4a3bd6=_0x4a3bd6-0xaa;let _0x43da4b=_0x1deda8[_0x4a3bd6];return _0x43da4b;},a8_0x4a3b(_0x43f5fb,_0x16bef1);}var __importDefault=this&&this[a8_0x55b118(0xb4)]||function(_0x56f8d3){const _0x7fff05=a8_0x55b118;return _0x56f8d3&&_0x56f8d3[_0x7fff05(0xe8)]?_0x56f8d3:{'default':_0x56f8d3};};Object[a8_0x55b118(0xc2)](exports,a8_0x55b118(0xe8),{'value':!![]}),exports['manualPaymentController']=exports[a8_0x55b118(0xc7)]=void 0x0;const database_1=__importDefault(require(a8_0x55b118(0xbc)));function a8_0x1ded(){const _0x3cb47e=['\x20\x20\x20-\x20Payment\x20ID:\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','__esModule','default','5812436SUkxZC','findUnique','body','interac','name','uploadPaymentProof','PNG','\x20\x20\x20-\x20File\x20size:\x20','amount','441272ewVKGN','join','params','Payment\x20not\x20found','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','currency','getManualPaymentInfo','connection','replace','round','153874mLJwxa','jpg','json','Unsupported\x20file\x20type:\x20','__importDefault','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','üåê\x20Client\x20IP:\x20','5806158LQsHQs','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','5SiaUoC','message','payment','../config/database','shop','Internal\x20server\x20error','üìÅ\x20File\x20type:\x20','update','includes','defineProperty','length','üìã\x20Get\x20manual\x20payment\x20info:\x20','log','EUR','ManualPaymentController','PDF','error','createdAt',',\x20size:\x20','.\x20Supported:\x20','sepa','10MB','gateway','toLowerCase','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','png','Payment\x20proof\x20uploaded\x20successfully','12ipFMYj','39323574ieFepJ','5848424BCGpjB','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','‚ùå\x20Payment\x20not\x20found:\x20','JPEG','updatedAt','remoteAddress','HEIC','toUpperCase','Unknown\x20error','status','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','CAD','1458081BnSQoK','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','Payment\x20ID\x20is\x20required'];a8_0x1ded=function(){return _0x3cb47e;};return a8_0x1ded();}class ManualPaymentController{async[a8_0x55b118(0xef)](_0x5095c0,_0x4d6473){const _0x211d2f=a8_0x55b118;try{const {paymentId:_0x207bbf,fileData:_0x5aa470,fileType:_0x493143,fileName:_0x27140a}=_0x5095c0[_0x211d2f(0xec)],_0x2a93c8=_0x5095c0['ip']||_0x5095c0[_0x211d2f(0xad)]?.[_0x211d2f(0xdb)]||'unknown';console[_0x211d2f(0xc5)](_0x211d2f(0xe0)+_0x207bbf),console[_0x211d2f(0xc5)](_0x211d2f(0xbf)+_0x493143+_0x211d2f(0xcb)+(_0x5aa470?Math[_0x211d2f(0xaf)](_0x5aa470[_0x211d2f(0xc3)]*0.75/0x400):0x0)+'KB'),console[_0x211d2f(0xc5)](_0x211d2f(0xb6)+_0x2a93c8);if(!_0x207bbf){_0x4d6473[_0x211d2f(0xdf)](0x190)['json']({'success':![],'error':_0x211d2f(0xe4)});return;}if(!_0x5aa470){_0x4d6473[_0x211d2f(0xdf)](0x190)[_0x211d2f(0xb2)]({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x493143){_0x4d6473['status'](0x190)[_0x211d2f(0xb2)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x1131c2=[_0x211d2f(0xd2),_0x211d2f(0xb1),'jpeg','heic','pdf'],_0x2f9711=_0x493143[_0x211d2f(0xd0)]()[_0x211d2f(0xae)]('.','');if(!_0x1131c2['includes'](_0x2f9711)){_0x4d6473[_0x211d2f(0xdf)](0x190)[_0x211d2f(0xb2)]({'success':![],'error':_0x211d2f(0xb3)+_0x493143+_0x211d2f(0xcc)+_0x1131c2[_0x211d2f(0xf4)](',\x20')});return;}const _0xa0aa8e=0xa*0x400*0x400;if(_0x5aa470[_0x211d2f(0xc3)]>_0xa0aa8e){_0x4d6473['status'](0x190)[_0x211d2f(0xb2)]({'success':![],'error':_0x211d2f(0xd1)});return;}const _0x31632c=await database_1[_0x211d2f(0xe9)][_0x211d2f(0xbb)][_0x211d2f(0xeb)]({'where':{'id':_0x207bbf},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x31632c){console[_0x211d2f(0xc5)](_0x211d2f(0xd8)+_0x207bbf),_0x4d6473[_0x211d2f(0xdf)](0x194)[_0x211d2f(0xb2)]({'success':![],'error':_0x211d2f(0xf6)});return;}if(_0x31632c[_0x211d2f(0xcf)]!==_0x211d2f(0xed)&&_0x31632c['gateway']!=='sepa'){console[_0x211d2f(0xc5)](_0x211d2f(0xd7)+_0x31632c[_0x211d2f(0xcf)]),_0x4d6473[_0x211d2f(0xdf)](0x190)[_0x211d2f(0xb2)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x31632c[_0x211d2f(0xcf)]});return;}let _0x4d9050=_0x5aa470;_0x5aa470[_0x211d2f(0xc1)](',')&&(_0x4d9050=_0x5aa470['split'](',')[0x1]);try{Buffer['from'](_0x4d9050,'base64');}catch(_0x13e6c5){_0x4d6473['status'](0x190)[_0x211d2f(0xb2)]({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x6950e6=await database_1[_0x211d2f(0xe9)][_0x211d2f(0xbb)][_0x211d2f(0xc0)]({'where':{'id':_0x207bbf},'data':{'paymentProof':_0x4d9050,'paymentProofType':_0x2f9711,'status':'PROCESSING','updatedAt':new Date()}});console[_0x211d2f(0xc5)](_0x211d2f(0xe3)),console[_0x211d2f(0xc5)](_0x211d2f(0xe5)+_0x207bbf),console['log']('\x20\x20\x20-\x20Gateway:\x20'+_0x31632c['gateway'][_0x211d2f(0xdd)]()),console[_0x211d2f(0xc5)]('\x20\x20\x20-\x20File\x20type:\x20'+_0x2f9711),console[_0x211d2f(0xc5)](_0x211d2f(0xf1)+Math['round'](_0x4d9050[_0x211d2f(0xc3)]*0.75/0x400)+'KB'),console['log'](_0x211d2f(0xe6)),_0x4d6473['json']({'success':!![],'message':_0x211d2f(0xd3),'data':{'paymentId':_0x6950e6['id'],'status':_0x6950e6[_0x211d2f(0xdf)],'gateway':_0x31632c['gateway'],'fileType':_0x2f9711,'fileSize':Math[_0x211d2f(0xaf)](_0x4d9050[_0x211d2f(0xc3)]*0.75/0x400)+'KB','uploadedAt':_0x6950e6['updatedAt']}});}catch(_0x4e3f4a){console[_0x211d2f(0xc9)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x4e3f4a),_0x4d6473['status'](0x1f4)[_0x211d2f(0xb2)]({'success':![],'error':_0x211d2f(0xbe),'details':_0x4e3f4a instanceof Error?_0x4e3f4a[_0x211d2f(0xba)]:_0x211d2f(0xde)});}}async[a8_0x55b118(0xac)](_0x5c0c2b,_0x46e185){const _0x22cd43=a8_0x55b118;try{const {paymentId:_0x2b8e73}=_0x5c0c2b[_0x22cd43(0xf5)];console['log'](_0x22cd43(0xc4)+_0x2b8e73);const _0x149f83=await database_1[_0x22cd43(0xe9)][_0x22cd43(0xbb)][_0x22cd43(0xeb)]({'where':{'id':_0x2b8e73},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x149f83){_0x46e185[_0x22cd43(0xdf)](0x194)[_0x22cd43(0xb2)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x149f83[_0x22cd43(0xcf)]!==_0x22cd43(0xed)&&_0x149f83['gateway']!==_0x22cd43(0xcd)){_0x46e185[_0x22cd43(0xdf)](0x190)[_0x22cd43(0xb2)]({'success':![],'error':_0x22cd43(0xb5)+_0x149f83['gateway']});return;}let _0x2cad0c='',_0x1e1fc3=_0x149f83[_0x22cd43(0xab)],_0x58b3a5='';if(_0x149f83[_0x22cd43(0xcf)]===_0x22cd43(0xed))_0x58b3a5='Interac\x20e-Transfer',_0x1e1fc3=_0x22cd43(0xe1),_0x2cad0c=_0x22cd43(0xb8)+_0x149f83[_0x22cd43(0xf2)]+'\x20'+_0x1e1fc3+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.';else _0x149f83[_0x22cd43(0xcf)]==='sepa'&&(_0x58b3a5='SEPA\x20Bank\x20Transfer',_0x1e1fc3=_0x22cd43(0xc6),_0x2cad0c=_0x22cd43(0xaa)+_0x149f83['amount']+'\x20'+_0x1e1fc3+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x250065={'success':!![],'data':{'paymentId':_0x149f83['id'],'gateway':_0x149f83[_0x22cd43(0xcf)],'gatewayName':_0x149f83[_0x22cd43(0xcf)]['toUpperCase'](),'transferType':_0x58b3a5,'amount':_0x149f83[_0x22cd43(0xf2)],'currency':_0x1e1fc3,'status':_0x149f83[_0x22cd43(0xdf)],'instructions':_0x2cad0c,'shopName':_0x149f83[_0x22cd43(0xbd)][_0x22cd43(0xee)]||_0x149f83['shop']['username'],'hasProof':![],'proofType':null,'createdAt':_0x149f83[_0x22cd43(0xca)],'updatedAt':_0x149f83[_0x22cd43(0xda)],'supportedFileTypes':[_0x22cd43(0xf0),'JPG',_0x22cd43(0xd9),_0x22cd43(0xdc),_0x22cd43(0xc8)],'maxFileSize':_0x22cd43(0xce)}};_0x46e185[_0x22cd43(0xb2)](_0x250065);}catch(_0x350678){console[_0x22cd43(0xc9)](_0x22cd43(0xe7),_0x350678),_0x46e185[_0x22cd43(0xdf)](0x1f4)['json']({'success':![],'error':_0x22cd43(0xbe),'details':_0x350678 instanceof Error?_0x350678[_0x22cd43(0xba)]:_0x22cd43(0xde)});}}}exports['ManualPaymentController']=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();