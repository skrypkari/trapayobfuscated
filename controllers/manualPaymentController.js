'use strict';function a11_0x5478(){const _0x556c4c=['length','‚ùå\x20Upload\x20payment\x20proof\x20error:','12UOeuww','10MB','Markdown','File\x20data\x20is\x20required','Payment\x20ID\x20is\x20required','defineProperty','../config/database','split','üåê\x20Customer\x20IP:\x20','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','png','jpg','16PGkVjc','4LHWcVX','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','üîÑ\x20','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','Unknown\x20error','35295469fXajJj','shopId','üåê\x20Client\x20IP:\x20','EUR','status','\x20Payment\x20Proof\x20Received\x0a\x0a','remoteAddress','interac','shop','error','üìÅ\x20File\x20type:\x20','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','7867339505','json','jpeg','toUpperCase','sendDirectMessage','KB)\x0a','getManualPaymentInfo','\x20\x20\x20-\x20File\x20type:\x20','2912600CvQSfn','\x20\x20\x20-\x20Payment\x20ID:\x20','sepa','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','includes','manualPaymentController','username','sendShopNotification','üìÅ\x20File:\x20','10dKvaGf','2509423bwjIdX','CAD','‚ùå\x20Payment\x20not\x20found:\x20','Internal\x20server\x20error','body','üì±\x20Admin\x20notification\x20and\x20file\x20sent','Interac\x20e-Transfer','gateway','Payment\x20proof\x20for\x20','\x20\x20\x20-\x20Gateway:\x20','amount','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','toLowerCase','2FMnFog','createdAt','name','base64','unknown','12341331XVjBQR','Payment\x20not\x20found','round','PNG','HEIC','updatedAt','ManualPaymentController','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','üí≥\x20Payment\x20ID:\x20','345435DnvZaG','__importDefault','default','üí∞\x20Amount:\x20','log','1258219qWdMhD','payment','connection','payment_proof_','\x20\x20\x20-\x20File\x20size:\x20','currency','params','sendDirectFile','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','sendShopFile',',\x20size:\x20','__esModule','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','7131972SnsUMV','Invalid\x20base64\x20file\x20data','PROCESSING','telegramBotService','join','message','.\x20Supported:\x20','JPEG','File\x20type\x20is\x20required','findUnique','PDF','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','from'];a11_0x5478=function(){return _0x556c4c;};return a11_0x5478();}const a11_0x1350f7=a11_0x78aa;function a11_0x78aa(_0x18d2ef,_0x6de9fa){_0x18d2ef=_0x18d2ef-0x1ac;const _0x5478c4=a11_0x5478();let _0x78aae4=_0x5478c4[_0x18d2ef];return _0x78aae4;}(function(_0x1238b1,_0x4ce216){const _0x49f69f=a11_0x78aa,_0x1b3664=_0x1238b1();while(!![]){try{const _0x2f627e=parseInt(_0x49f69f(0x1ba))/0x1*(-parseInt(_0x49f69f(0x217))/0x2)+-parseInt(_0x49f69f(0x1b5))/0x3*(parseInt(_0x49f69f(0x1e3))/0x4)+-parseInt(_0x49f69f(0x200))/0x5+-parseInt(_0x49f69f(0x1c7))/0x6+-parseInt(_0x49f69f(0x20a))/0x7*(parseInt(_0x49f69f(0x1e2))/0x8)+parseInt(_0x49f69f(0x1ac))/0x9*(parseInt(_0x49f69f(0x209))/0xa)+parseInt(_0x49f69f(0x1ea))/0xb*(parseInt(_0x49f69f(0x1d6))/0xc);if(_0x2f627e===_0x4ce216)break;else _0x1b3664['push'](_0x1b3664['shift']());}catch(_0x11bb68){_0x1b3664['push'](_0x1b3664['shift']());}}}(a11_0x5478,0xaf64e));var __importDefault=this&&this[a11_0x1350f7(0x1b6)]||function(_0x24707c){const _0x3dcf69=a11_0x1350f7;return _0x24707c&&_0x24707c[_0x3dcf69(0x1c5)]?_0x24707c:{'default':_0x24707c};};Object[a11_0x1350f7(0x1db)](exports,'__esModule',{'value':!![]}),exports[a11_0x1350f7(0x205)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a11_0x1350f7(0x1dc))),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async['uploadPaymentProof'](_0xd2de7,_0x49b538){const _0x500848=a11_0x1350f7;try{const {paymentId:_0x415906,fileData:_0x5b7947,fileType:_0x2d97f7,fileName:_0x5cf96c}=_0xd2de7[_0x500848(0x20e)],_0x243788=_0xd2de7['ip']||_0xd2de7[_0x500848(0x1bc)]?.[_0x500848(0x1f0)]||_0x500848(0x21b);console[_0x500848(0x1b9)]('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x415906),console[_0x500848(0x1b9)](_0x500848(0x1f4)+_0x2d97f7+_0x500848(0x1c4)+(_0x5b7947?Math['round'](_0x5b7947[_0x500848(0x1d4)]*0.75/0x400):0x0)+'KB'),console[_0x500848(0x1b9)](_0x500848(0x1ec)+_0x243788);if(!_0x415906){_0x49b538[_0x500848(0x1ee)](0x190)[_0x500848(0x1f9)]({'success':![],'error':_0x500848(0x1da)});return;}if(!_0x5b7947){_0x49b538[_0x500848(0x1ee)](0x190)['json']({'success':![],'error':_0x500848(0x1d9)});return;}if(!_0x2d97f7){_0x49b538[_0x500848(0x1ee)](0x190)[_0x500848(0x1f9)]({'success':![],'error':_0x500848(0x1cf)});return;}const _0x4cfad8=[_0x500848(0x1e0),_0x500848(0x1e1),_0x500848(0x1fa),'heic','pdf'],_0x24bb0c=_0x2d97f7[_0x500848(0x216)]()['replace']('.','');if(!_0x4cfad8[_0x500848(0x204)](_0x24bb0c)){_0x49b538[_0x500848(0x1ee)](0x190)['json']({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x2d97f7+_0x500848(0x1cd)+_0x4cfad8[_0x500848(0x1cb)](',\x20')});return;}const _0x44a412=0xa*0x400*0x400;if(_0x5b7947[_0x500848(0x1d4)]>_0x44a412){_0x49b538['status'](0x190)[_0x500848(0x1f9)]({'success':![],'error':_0x500848(0x203)});return;}const _0x530b21=await database_1[_0x500848(0x1b7)]['payment'][_0x500848(0x1d0)]({'where':{'id':_0x415906},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x530b21){console[_0x500848(0x1b9)](_0x500848(0x20c)+_0x415906),_0x49b538[_0x500848(0x1ee)](0x194)[_0x500848(0x1f9)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x530b21[_0x500848(0x211)]!==_0x500848(0x1f1)&&_0x530b21['gateway']!=='sepa'){console[_0x500848(0x1b9)](_0x500848(0x215)+_0x530b21[_0x500848(0x211)]),_0x49b538[_0x500848(0x1ee)](0x190)[_0x500848(0x1f9)]({'success':![],'error':_0x500848(0x1c2)+_0x530b21[_0x500848(0x211)]});return;}let _0x556b55=_0x5b7947;_0x5b7947['includes'](',')&&(_0x556b55=_0x5b7947[_0x500848(0x1dd)](',')[0x1]);try{Buffer[_0x500848(0x1d3)](_0x556b55,_0x500848(0x21a));}catch(_0x5d9548){_0x49b538[_0x500848(0x1ee)](0x190)[_0x500848(0x1f9)]({'success':![],'error':_0x500848(0x1c8)});return;}const _0x73197b=await database_1[_0x500848(0x1b7)][_0x500848(0x1bb)]['update']({'where':{'id':_0x415906},'data':{'status':_0x500848(0x1c9),'updatedAt':new Date()}});console['log']('‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:'),console[_0x500848(0x1b9)](_0x500848(0x201)+_0x415906),console['log'](_0x500848(0x213)+_0x530b21[_0x500848(0x211)][_0x500848(0x1fb)]()),console['log'](_0x500848(0x1ff)+_0x24bb0c),console[_0x500848(0x1b9)](_0x500848(0x1be)+Math[_0x500848(0x1ae)](_0x556b55[_0x500848(0x1d4)]*0.75/0x400)+'KB'),console['log']('\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING');try{const _0x36692e=_0x530b21[_0x500848(0x211)][_0x500848(0x1fb)](),_0x4257a0=_0x530b21[_0x500848(0x1f2)]['name']||_0x530b21[_0x500848(0x1f2)][_0x500848(0x206)],_0x26d01f=Math[_0x500848(0x1ae)](_0x556b55[_0x500848(0x1d4)]*0.75/0x400),_0x2a7975=_0x500848(0x1e5)+_0x36692e+_0x500848(0x1ef)+(_0x500848(0x1b4)+_0x415906+'\x0a')+(_0x500848(0x1b8)+_0x530b21['amount']+'\x20'+_0x530b21['currency']+'\x0a')+(_0x500848(0x208)+_0x24bb0c[_0x500848(0x1fb)]()+'\x20('+_0x26d01f+_0x500848(0x1fd))+_0x500848(0x1d2)+(_0x500848(0x1de)+_0x243788+'\x0a\x0a')+_0x500848(0x1df);await telegramBotService_1[_0x500848(0x1ca)][_0x500848(0x207)](_0x530b21[_0x500848(0x1eb)],_0x2a7975,{'parse_mode':_0x500848(0x1d8)});const _0x489e59=Buffer[_0x500848(0x1d3)](_0x556b55,_0x500848(0x21a)),_0x13ce14=_0x500848(0x1bd)+_0x415906+'.'+_0x24bb0c;await telegramBotService_1[_0x500848(0x1ca)][_0x500848(0x1c3)](_0x530b21[_0x500848(0x1eb)],_0x489e59,_0x13ce14,_0x500848(0x212)+_0x415906),console[_0x500848(0x1b9)](_0x500848(0x1e4));const _0x263669=_0x500848(0x1f8),_0x1a92d8='üîÑ\x20'+_0x36692e+_0x500848(0x1f7)+(_0x500848(0x1b4)+_0x415906+'\x0a')+('üè™\x20Shop:\x20'+_0x4257a0+'\x0a')+(_0x500848(0x1b8)+_0x530b21['amount']+'\x20'+_0x530b21[_0x500848(0x1bf)]+'\x0a')+(_0x500848(0x208)+_0x24bb0c[_0x500848(0x1fb)]()+'\x20('+_0x26d01f+_0x500848(0x1fd))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x500848(0x1de)+_0x243788+'\x0a\x0a')+_0x500848(0x1c6);await telegramBotService_1[_0x500848(0x1ca)][_0x500848(0x1fc)](parseInt(_0x263669),_0x1a92d8),await telegramBotService_1['telegramBotService'][_0x500848(0x1c1)](parseInt(_0x263669),_0x489e59,_0x13ce14,_0x500848(0x1f6)+_0x415906),console[_0x500848(0x1b9)](_0x500848(0x20f));}catch(_0x1c4757){console[_0x500848(0x1f3)](_0x500848(0x1e7),_0x1c4757);}_0x49b538[_0x500848(0x1f9)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x73197b['id'],'status':_0x73197b[_0x500848(0x1ee)],'gateway':_0x530b21[_0x500848(0x211)],'fileType':_0x24bb0c,'fileSize':Math['round'](_0x556b55[_0x500848(0x1d4)]*0.75/0x400)+'KB','uploadedAt':_0x73197b['updatedAt']}});}catch(_0x13daa0){console['error'](_0x500848(0x1d5),_0x13daa0),_0x49b538[_0x500848(0x1ee)](0x1f4)[_0x500848(0x1f9)]({'success':![],'error':_0x500848(0x20d),'details':_0x13daa0 instanceof Error?_0x13daa0[_0x500848(0x1cc)]:_0x500848(0x1e9)});}}async[a11_0x1350f7(0x1fe)](_0x20e12c,_0x57eb2f){const _0x6a26c5=a11_0x1350f7;try{const {paymentId:_0x4329d4}=_0x20e12c[_0x6a26c5(0x1c0)];console['log']('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x4329d4);const _0xa8b266=await database_1['default'][_0x6a26c5(0x1bb)][_0x6a26c5(0x1d0)]({'where':{'id':_0x4329d4},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xa8b266){_0x57eb2f['status'](0x194)[_0x6a26c5(0x1f9)]({'success':![],'error':_0x6a26c5(0x1ad)});return;}if(_0xa8b266[_0x6a26c5(0x211)]!==_0x6a26c5(0x1f1)&&_0xa8b266[_0x6a26c5(0x211)]!==_0x6a26c5(0x202)){_0x57eb2f['status'](0x190)[_0x6a26c5(0x1f9)]({'success':![],'error':_0x6a26c5(0x1b3)+_0xa8b266[_0x6a26c5(0x211)]});return;}let _0x9f1815='',_0x562f66=_0xa8b266[_0x6a26c5(0x1bf)],_0x484bf5='';if(_0xa8b266['gateway']===_0x6a26c5(0x1f1))_0x484bf5=_0x6a26c5(0x210),_0x562f66=_0x6a26c5(0x20b),_0x9f1815='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0xa8b266[_0x6a26c5(0x214)]+'\x20'+_0x562f66+_0x6a26c5(0x1e8);else _0xa8b266[_0x6a26c5(0x211)]===_0x6a26c5(0x202)&&(_0x484bf5='SEPA\x20Bank\x20Transfer',_0x562f66=_0x6a26c5(0x1ed),_0x9f1815=_0x6a26c5(0x1e6)+_0xa8b266[_0x6a26c5(0x214)]+'\x20'+_0x562f66+_0x6a26c5(0x1e8));const _0x1cbac6={'success':!![],'data':{'paymentId':_0xa8b266['id'],'gateway':_0xa8b266['gateway'],'gatewayName':_0xa8b266[_0x6a26c5(0x211)][_0x6a26c5(0x1fb)](),'transferType':_0x484bf5,'amount':_0xa8b266[_0x6a26c5(0x214)],'currency':_0x562f66,'status':_0xa8b266[_0x6a26c5(0x1ee)],'instructions':_0x9f1815,'shopName':_0xa8b266[_0x6a26c5(0x1f2)][_0x6a26c5(0x219)]||_0xa8b266[_0x6a26c5(0x1f2)]['username'],'hasProof':![],'proofType':null,'createdAt':_0xa8b266[_0x6a26c5(0x218)],'updatedAt':_0xa8b266[_0x6a26c5(0x1b1)],'supportedFileTypes':[_0x6a26c5(0x1af),'JPG',_0x6a26c5(0x1ce),_0x6a26c5(0x1b0),_0x6a26c5(0x1d1)],'maxFileSize':_0x6a26c5(0x1d7)}};_0x57eb2f[_0x6a26c5(0x1f9)](_0x1cbac6);}catch(_0x1e6918){console['error'](_0x6a26c5(0x1f5),_0x1e6918),_0x57eb2f[_0x6a26c5(0x1ee)](0x1f4)['json']({'success':![],'error':_0x6a26c5(0x20d),'details':_0x1e6918 instanceof Error?_0x1e6918[_0x6a26c5(0x1cc)]:_0x6a26c5(0x1e9)});}}}exports[a11_0x1350f7(0x1b2)]=ManualPaymentController,exports[a11_0x1350f7(0x205)]=new ManualPaymentController();