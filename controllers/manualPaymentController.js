'use strict';const a10_0x552fa0=a10_0xd43b;(function(_0x3ef822,_0x36fd07){const _0x4a638b=a10_0xd43b,_0x3e1079=_0x3ef822();while(!![]){try{const _0x54f6c6=parseInt(_0x4a638b(0xdd))/0x1+parseInt(_0x4a638b(0x100))/0x2+parseInt(_0x4a638b(0x122))/0x3+-parseInt(_0x4a638b(0xf3))/0x4+-parseInt(_0x4a638b(0x10e))/0x5*(-parseInt(_0x4a638b(0xe0))/0x6)+-parseInt(_0x4a638b(0x111))/0x7*(parseInt(_0x4a638b(0x11f))/0x8)+-parseInt(_0x4a638b(0x127))/0x9*(parseInt(_0x4a638b(0xec))/0xa);if(_0x54f6c6===_0x36fd07)break;else _0x3e1079['push'](_0x3e1079['shift']());}catch(_0x5e8075){_0x3e1079['push'](_0x3e1079['shift']());}}}(a10_0x5366,0xae51c));var __importDefault=this&&this[a10_0x552fa0(0x101)]||function(_0x2d680a){const _0x4a1fc6=a10_0x552fa0;return _0x2d680a&&_0x2d680a[_0x4a1fc6(0x13e)]?_0x2d680a:{'default':_0x2d680a};};Object[a10_0x552fa0(0x10a)](exports,a10_0x552fa0(0x13e),{'value':!![]}),exports[a10_0x552fa0(0x137)]=exports[a10_0x552fa0(0x102)]=void 0x0;const database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a10_0x552fa0(0x103));function a10_0x5366(){const _0xa16ead=['update','heic','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','2103672ovbhjd','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','default','updatedAt','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','\x20\x20\x20-\x20File\x20type:\x20','round','üåê\x20Customer\x20IP:\x20','remoteAddress','2793974MXtSBz','__importDefault','ManualPaymentController','../services/telegramBotService','10MB','üè™\x20Shop:\x20','Internal\x20server\x20error','shopId','from','üí∞\x20Amount:\x20','defineProperty','connection','JPEG','png','5WutPca','Payment\x20not\x20found','currency','161217fBINnP','params','\x20\x20\x20-\x20Payment\x20ID:\x20','File\x20type\x20is\x20required','split','sendShopFile','EUR','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','7867339505','üìÅ\x20File:\x20','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','findUnique','interac','base64','456tnvHfQ','KB)\x0a','payment','3427374zNIDvM','amount','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','Unknown\x20error','JPG','228267yggcjR','File\x20data\x20is\x20required','Payment\x20proof\x20uploaded\x20successfully','üí≥\x20Payment\x20ID:\x20','‚ùå\x20Upload\x20payment\x20proof\x20error:','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','toLowerCase','sendShopNotification','name','status','üîÑ\x20','Invalid\x20base64\x20file\x20data','json','replace','üåê\x20Client\x20IP:\x20','Unsupported\x20file\x20type:\x20','manualPaymentController','error',',\x20size:\x20','length','includes','jpeg','\x20\x20\x20-\x20File\x20size:\x20','__esModule','getManualPaymentInfo','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','log','toUpperCase','sepa','‚ùå\x20Payment\x20not\x20found:\x20','Payment\x20ID\x20is\x20required','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','\x20Payment\x20Proof\x20Received\x0a\x0a','telegramBotService','Payment\x20proof\x20for\x20','369447qGNdzW','createdAt','message','5928264gNwjhY','\x20\x20\x20-\x20Gateway:\x20','shop','PDF','payment_proof_','body','CAD','.\x20Supported:\x20','Markdown','username','üìÅ\x20File\x20type:\x20','Interac\x20e-Transfer','530egYxmD','gateway','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:'];a10_0x5366=function(){return _0xa16ead;};return a10_0x5366();}class ManualPaymentController{async['uploadPaymentProof'](_0x4fa7c6,_0x56e3d1){const _0x42e766=a10_0x552fa0;try{const {paymentId:_0x3252a4,fileData:_0x1f4d9b,fileType:_0x4751bb,fileName:_0x50eb22}=_0x4fa7c6[_0x42e766(0xe5)],_0x11af73=_0x4fa7c6['ip']||_0x4fa7c6[_0x42e766(0x10b)]?.[_0x42e766(0xff)]||'unknown';console['log'](_0x42e766(0xd3)+_0x3252a4),console[_0x42e766(0xd4)](_0x42e766(0xea)+_0x4751bb+_0x42e766(0x139)+(_0x1f4d9b?Math[_0x42e766(0xfd)](_0x1f4d9b[_0x42e766(0x13a)]*0.75/0x400):0x0)+'KB'),console[_0x42e766(0xd4)](_0x42e766(0x135)+_0x11af73);if(!_0x3252a4){_0x56e3d1['status'](0x190)[_0x42e766(0x133)]({'success':![],'error':_0x42e766(0xd8)});return;}if(!_0x1f4d9b){_0x56e3d1['status'](0x190)[_0x42e766(0x133)]({'success':![],'error':_0x42e766(0x128)});return;}if(!_0x4751bb){_0x56e3d1[_0x42e766(0x130)](0x190)['json']({'success':![],'error':_0x42e766(0x114)});return;}const _0x205489=[_0x42e766(0x10d),'jpg',_0x42e766(0x13c),_0x42e766(0xf0),'pdf'],_0x54ec89=_0x4751bb[_0x42e766(0x12d)]()[_0x42e766(0x134)]('.','');if(!_0x205489['includes'](_0x54ec89)){_0x56e3d1[_0x42e766(0x130)](0x190)[_0x42e766(0x133)]({'success':![],'error':_0x42e766(0x136)+_0x4751bb+_0x42e766(0xe7)+_0x205489['join'](',\x20')});return;}const _0x361bc8=0xa*0x400*0x400;if(_0x1f4d9b[_0x42e766(0x13a)]>_0x361bc8){_0x56e3d1[_0x42e766(0x130)](0x190)[_0x42e766(0x133)]({'success':![],'error':_0x42e766(0xf2)});return;}const _0x2040c9=await database_1[_0x42e766(0xf9)]['payment']['findUnique']({'where':{'id':_0x3252a4},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2040c9){console[_0x42e766(0xd4)](_0x42e766(0xd7)+_0x3252a4),_0x56e3d1[_0x42e766(0x130)](0x194)[_0x42e766(0x133)]({'success':![],'error':_0x42e766(0x10f)});return;}if(_0x2040c9['gateway']!=='interac'&&_0x2040c9['gateway']!==_0x42e766(0xd6)){console['log']('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x2040c9[_0x42e766(0xed)]),_0x56e3d1[_0x42e766(0x130)](0x190)[_0x42e766(0x133)]({'success':![],'error':_0x42e766(0x118)+_0x2040c9[_0x42e766(0xed)]});return;}let _0x48fe23=_0x1f4d9b;_0x1f4d9b[_0x42e766(0x13b)](',')&&(_0x48fe23=_0x1f4d9b[_0x42e766(0x115)](',')[0x1]);try{Buffer[_0x42e766(0x108)](_0x48fe23,'base64');}catch(_0x432f1c){_0x56e3d1[_0x42e766(0x130)](0x190)[_0x42e766(0x133)]({'success':![],'error':_0x42e766(0x132)});return;}const _0x23a716=await database_1[_0x42e766(0xf9)][_0x42e766(0x121)][_0x42e766(0xef)]({'where':{'id':_0x3252a4},'data':{'status':'PROCESSING','updatedAt':new Date()}});console[_0x42e766(0xd4)](_0x42e766(0xfb)),console[_0x42e766(0xd4)](_0x42e766(0x113)+_0x3252a4),console[_0x42e766(0xd4)](_0x42e766(0xe1)+_0x2040c9[_0x42e766(0xed)][_0x42e766(0xd5)]()),console[_0x42e766(0xd4)](_0x42e766(0xfc)+_0x54ec89),console['log'](_0x42e766(0x13d)+Math['round'](_0x48fe23[_0x42e766(0x13a)]*0.75/0x400)+'KB'),console['log'](_0x42e766(0xf7));try{const _0x1a5408=_0x2040c9[_0x42e766(0xed)][_0x42e766(0xd5)](),_0x8937d0=_0x2040c9[_0x42e766(0xe2)][_0x42e766(0x12f)]||_0x2040c9[_0x42e766(0xe2)][_0x42e766(0xe9)],_0x160b48=Math['round'](_0x48fe23[_0x42e766(0x13a)]*0.75/0x400),_0x321047=_0x42e766(0x131)+_0x1a5408+_0x42e766(0xda)+(_0x42e766(0x12a)+_0x3252a4+'\x0a')+('üí∞\x20Amount:\x20'+_0x2040c9['amount']+'\x20'+_0x2040c9['currency']+'\x0a')+(_0x42e766(0x11a)+_0x54ec89[_0x42e766(0xd5)]()+'\x20('+_0x160b48+_0x42e766(0x120))+_0x42e766(0x11b)+(_0x42e766(0xfe)+_0x11af73+'\x0a\x0a')+_0x42e766(0xf1);await telegramBotService_1[_0x42e766(0xdb)][_0x42e766(0x12e)](_0x2040c9[_0x42e766(0x107)],_0x321047,{'parse_mode':_0x42e766(0xe8)});const _0x12bd24=Buffer[_0x42e766(0x108)](_0x48fe23,_0x42e766(0x11e)),_0x2392cf=_0x42e766(0xe4)+_0x3252a4+'.'+_0x54ec89;await telegramBotService_1['telegramBotService'][_0x42e766(0x116)](_0x2040c9[_0x42e766(0x107)],_0x12bd24,_0x2392cf,_0x42e766(0xdc)+_0x3252a4),console['log']('üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x2d8baf=_0x42e766(0x119),_0x51cafd=_0x42e766(0x131)+_0x1a5408+_0x42e766(0x12c)+(_0x42e766(0x12a)+_0x3252a4+'\x0a')+(_0x42e766(0x105)+_0x8937d0+'\x0a')+(_0x42e766(0x109)+_0x2040c9[_0x42e766(0x123)]+'\x20'+_0x2040c9[_0x42e766(0x110)]+'\x0a')+(_0x42e766(0x11a)+_0x54ec89[_0x42e766(0xd5)]()+'\x20('+_0x160b48+_0x42e766(0x120))+_0x42e766(0x11b)+(_0x42e766(0xfe)+_0x11af73+'\x0a\x0a')+'‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.';await telegramBotService_1['telegramBotService']['sendDirectMessage'](parseInt(_0x2d8baf),_0x51cafd),await telegramBotService_1[_0x42e766(0xdb)]['sendDirectFile'](parseInt(_0x2d8baf),_0x12bd24,_0x2392cf,_0x42e766(0xf5)+_0x3252a4),console[_0x42e766(0xd4)]('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x4ec63c){console[_0x42e766(0x138)](_0x42e766(0xf8),_0x4ec63c);}_0x56e3d1[_0x42e766(0x133)]({'success':!![],'message':_0x42e766(0x129),'data':{'paymentId':_0x23a716['id'],'status':_0x23a716[_0x42e766(0x130)],'gateway':_0x2040c9['gateway'],'fileType':_0x54ec89,'fileSize':Math[_0x42e766(0xfd)](_0x48fe23[_0x42e766(0x13a)]*0.75/0x400)+'KB','uploadedAt':_0x23a716[_0x42e766(0xfa)]}});}catch(_0x4e989b){console[_0x42e766(0x138)](_0x42e766(0x12b),_0x4e989b),_0x56e3d1[_0x42e766(0x130)](0x1f4)['json']({'success':![],'error':_0x42e766(0x106),'details':_0x4e989b instanceof Error?_0x4e989b[_0x42e766(0xdf)]:_0x42e766(0x125)});}}async[a10_0x552fa0(0xd2)](_0x127022,_0x4cbeee){const _0x8c31d4=a10_0x552fa0;try{const {paymentId:_0x24e7f7}=_0x127022[_0x8c31d4(0x112)];console[_0x8c31d4(0xd4)]('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x24e7f7);const _0x53d728=await database_1[_0x8c31d4(0xf9)][_0x8c31d4(0x121)][_0x8c31d4(0x11c)]({'where':{'id':_0x24e7f7},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x53d728){_0x4cbeee[_0x8c31d4(0x130)](0x194)['json']({'success':![],'error':_0x8c31d4(0x10f)});return;}if(_0x53d728[_0x8c31d4(0xed)]!=='interac'&&_0x53d728[_0x8c31d4(0xed)]!==_0x8c31d4(0xd6)){_0x4cbeee[_0x8c31d4(0x130)](0x190)[_0x8c31d4(0x133)]({'success':![],'error':_0x8c31d4(0xf6)+_0x53d728[_0x8c31d4(0xed)]});return;}let _0x240e7d='',_0x38a725=_0x53d728[_0x8c31d4(0x110)],_0x1b52de='';if(_0x53d728[_0x8c31d4(0xed)]===_0x8c31d4(0x11d))_0x1b52de=_0x8c31d4(0xeb),_0x38a725=_0x8c31d4(0xe6),_0x240e7d=_0x8c31d4(0xf4)+_0x53d728['amount']+'\x20'+_0x38a725+_0x8c31d4(0xd9);else _0x53d728['gateway']===_0x8c31d4(0xd6)&&(_0x1b52de='SEPA\x20Bank\x20Transfer',_0x38a725=_0x8c31d4(0x117),_0x240e7d=_0x8c31d4(0x124)+_0x53d728[_0x8c31d4(0x123)]+'\x20'+_0x38a725+_0x8c31d4(0xd9));const _0xb39fa2={'success':!![],'data':{'paymentId':_0x53d728['id'],'gateway':_0x53d728['gateway'],'gatewayName':_0x53d728[_0x8c31d4(0xed)][_0x8c31d4(0xd5)](),'transferType':_0x1b52de,'amount':_0x53d728[_0x8c31d4(0x123)],'currency':_0x38a725,'status':_0x53d728[_0x8c31d4(0x130)],'instructions':_0x240e7d,'shopName':_0x53d728[_0x8c31d4(0xe2)]['name']||_0x53d728[_0x8c31d4(0xe2)][_0x8c31d4(0xe9)],'hasProof':![],'proofType':null,'createdAt':_0x53d728[_0x8c31d4(0xde)],'updatedAt':_0x53d728[_0x8c31d4(0xfa)],'supportedFileTypes':['PNG',_0x8c31d4(0x126),_0x8c31d4(0x10c),'HEIC',_0x8c31d4(0xe3)],'maxFileSize':_0x8c31d4(0x104)}};_0x4cbeee[_0x8c31d4(0x133)](_0xb39fa2);}catch(_0x548172){console['error'](_0x8c31d4(0xee),_0x548172),_0x4cbeee[_0x8c31d4(0x130)](0x1f4)[_0x8c31d4(0x133)]({'success':![],'error':'Internal\x20server\x20error','details':_0x548172 instanceof Error?_0x548172['message']:'Unknown\x20error'});}}}function a10_0xd43b(_0x553c17,_0x20ebcb){_0x553c17=_0x553c17-0xd2;const _0x536687=a10_0x5366();let _0xd43b7e=_0x536687[_0x553c17];return _0xd43b7e;}exports[a10_0x552fa0(0x102)]=ManualPaymentController,exports[a10_0x552fa0(0x137)]=new ManualPaymentController();