'use strict';const a10_0x284a28=a10_0x4cd8;(function(_0x28001f,_0x140512){const _0x4d8b2a=a10_0x4cd8,_0x3b1939=_0x28001f();while(!![]){try{const _0x25b4d3=parseInt(_0x4d8b2a(0x1ad))/0x1+-parseInt(_0x4d8b2a(0x203))/0x2+-parseInt(_0x4d8b2a(0x1ae))/0x3+-parseInt(_0x4d8b2a(0x1cf))/0x4*(-parseInt(_0x4d8b2a(0x1d9))/0x5)+parseInt(_0x4d8b2a(0x1cd))/0x6+parseInt(_0x4d8b2a(0x1de))/0x7+parseInt(_0x4d8b2a(0x1c5))/0x8*(-parseInt(_0x4d8b2a(0x1c7))/0x9);if(_0x25b4d3===_0x140512)break;else _0x3b1939['push'](_0x3b1939['shift']());}catch(_0x41f0e8){_0x3b1939['push'](_0x3b1939['shift']());}}}(a10_0x1cc3,0x8d37f));function a10_0x4cd8(_0x467308,_0x38dbc5){_0x467308=_0x467308-0x1a1;const _0x1cc32a=a10_0x1cc3();let _0x4cd85a=_0x1cc32a[_0x467308];return _0x4cd85a;}var __importDefault=this&&this['__importDefault']||function(_0x9091fc){const _0x5342e8=a10_0x4cd8;return _0x9091fc&&_0x9091fc[_0x5342e8(0x1d7)]?_0x9091fc:{'default':_0x9091fc};};function a10_0x1cc3(){const _0x101d56=['Internal\x20server\x20error','üìÅ\x20File\x20type:\x20','interac','File\x20type\x20is\x20required','CAD','\x20\x20\x20-\x20File\x20size:\x20','payment','json','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','üåê\x20Customer\x20IP:\x20','PNG','round','\x20\x20\x20-\x20File\x20type:\x20','remoteAddress','Payment\x20proof\x20for\x20','File\x20data\x20is\x20required','length','../config/database','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','error','updatedAt','üîÑ\x20','jpeg','Payment\x20not\x20found','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','base64','Interac\x20e-Transfer','from','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','../services/telegramBotService','SEPA\x20Bank\x20Transfer','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','telegramBotService','.\x20Supported:\x20','522060UIHnAZ','PDF','body','name','heic','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','findUnique','log','sendShopFile','gateway','shop','amount','sepa','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','join','params','connection','10MB','üì±\x20Admin\x20notification\x20and\x20file\x20sent','108003mOookl','2907135dXpXKa','‚ùå\x20Upload\x20payment\x20proof\x20error:','EUR','uploadPaymentProof','message','toUpperCase','PROCESSING','sendDirectFile','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','üìÅ\x20File:\x20','‚ùå\x20Payment\x20not\x20found:\x20','sendDirectMessage','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','png','defineProperty','split','Payment\x20ID\x20is\x20required','manualPaymentController','unknown','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','üè™\x20Shop:\x20','update','currency','41976mMLMFN','üí∞\x20Amount:\x20','369BobGnc','KB)\x0a','ManualPaymentController','Invalid\x20base64\x20file\x20data','default','\x20\x20\x20-\x20Gateway:\x20','1437510ySFWwX',',\x20size:\x20','3296704JLPnHJ','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','JPG','includes','jpg','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','shopId','üìã\x20Get\x20manual\x20payment\x20info:\x20','__esModule','\x20Payment\x20Proof\x20Received\x0a\x0a','5ZWYrtT','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','üí≥\x20Payment\x20ID:\x20','status','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','5963083gcrNKK','Markdown'];a10_0x1cc3=function(){return _0x101d56;};return a10_0x1cc3();}Object[a10_0x284a28(0x1bc)](exports,a10_0x284a28(0x1d7),{'value':!![]}),exports[a10_0x284a28(0x1bf)]=exports[a10_0x284a28(0x1c9)]=void 0x0;const database_1=__importDefault(require(a10_0x284a28(0x1f1))),telegramBotService_1=require(a10_0x284a28(0x1fe));class ManualPaymentController{async[a10_0x284a28(0x1b1)](_0x34ce1d,_0x10768b){const _0x423d4e=a10_0x284a28;try{const {paymentId:_0x434c0d,fileData:_0x567315,fileType:_0x1e9cff,fileName:_0x389576}=_0x34ce1d[_0x423d4e(0x205)],_0x2db6ad=_0x34ce1d['ip']||_0x34ce1d[_0x423d4e(0x1aa)]?.[_0x423d4e(0x1ed)]||_0x423d4e(0x1c0);console[_0x423d4e(0x1a1)](_0x423d4e(0x1fc)+_0x434c0d),console['log'](_0x423d4e(0x1e1)+_0x1e9cff+_0x423d4e(0x1ce)+(_0x567315?Math[_0x423d4e(0x1eb)](_0x567315[_0x423d4e(0x1f0)]*0.75/0x400):0x0)+'KB'),console['log']('üåê\x20Client\x20IP:\x20'+_0x2db6ad);if(!_0x434c0d){_0x10768b[_0x423d4e(0x1dc)](0x190)[_0x423d4e(0x1e7)]({'success':![],'error':_0x423d4e(0x1be)});return;}if(!_0x567315){_0x10768b[_0x423d4e(0x1dc)](0x190)[_0x423d4e(0x1e7)]({'success':![],'error':_0x423d4e(0x1ef)});return;}if(!_0x1e9cff){_0x10768b[_0x423d4e(0x1dc)](0x190)['json']({'success':![],'error':_0x423d4e(0x1e3)});return;}const _0x73012a=[_0x423d4e(0x1bb),_0x423d4e(0x1d3),_0x423d4e(0x1f6),_0x423d4e(0x207),'pdf'],_0x42d9ca=_0x1e9cff['toLowerCase']()['replace']('.','');if(!_0x73012a[_0x423d4e(0x1d2)](_0x42d9ca)){_0x10768b[_0x423d4e(0x1dc)](0x190)[_0x423d4e(0x1e7)]({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x1e9cff+_0x423d4e(0x202)+_0x73012a[_0x423d4e(0x1a8)](',\x20')});return;}const _0x11a3eb=0xa*0x400*0x400;if(_0x567315[_0x423d4e(0x1f0)]>_0x11a3eb){_0x10768b[_0x423d4e(0x1dc)](0x190)[_0x423d4e(0x1e7)]({'success':![],'error':_0x423d4e(0x1f8)});return;}const _0x5ac57c=await database_1[_0x423d4e(0x1cb)][_0x423d4e(0x1e6)]['findUnique']({'where':{'id':_0x434c0d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5ac57c){console[_0x423d4e(0x1a1)](_0x423d4e(0x1b8)+_0x434c0d),_0x10768b[_0x423d4e(0x1dc)](0x194)['json']({'success':![],'error':_0x423d4e(0x1f7)});return;}if(_0x5ac57c['gateway']!==_0x423d4e(0x1e2)&&_0x5ac57c['gateway']!==_0x423d4e(0x1a6)){console[_0x423d4e(0x1a1)](_0x423d4e(0x1dd)+_0x5ac57c[_0x423d4e(0x1a3)]),_0x10768b[_0x423d4e(0x1dc)](0x190)[_0x423d4e(0x1e7)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x5ac57c[_0x423d4e(0x1a3)]});return;}let _0x3a1f8a=_0x567315;_0x567315['includes'](',')&&(_0x3a1f8a=_0x567315[_0x423d4e(0x1bd)](',')[0x1]);try{Buffer[_0x423d4e(0x1fb)](_0x3a1f8a,_0x423d4e(0x1f9));}catch(_0x58c366){_0x10768b[_0x423d4e(0x1dc)](0x190)['json']({'success':![],'error':_0x423d4e(0x1ca)});return;}const _0xd2d14b=await database_1[_0x423d4e(0x1cb)][_0x423d4e(0x1e6)][_0x423d4e(0x1c3)]({'where':{'id':_0x434c0d},'data':{'status':_0x423d4e(0x1b4),'updatedAt':new Date()}});console['log'](_0x423d4e(0x1e8)),console[_0x423d4e(0x1a1)]('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x434c0d),console[_0x423d4e(0x1a1)](_0x423d4e(0x1cc)+_0x5ac57c[_0x423d4e(0x1a3)][_0x423d4e(0x1b3)]()),console[_0x423d4e(0x1a1)](_0x423d4e(0x1ec)+_0x42d9ca),console[_0x423d4e(0x1a1)](_0x423d4e(0x1e5)+Math['round'](_0x3a1f8a[_0x423d4e(0x1f0)]*0.75/0x400)+'KB'),console['log'](_0x423d4e(0x1f2));try{const _0x5a86e3=_0x5ac57c[_0x423d4e(0x1a3)][_0x423d4e(0x1b3)](),_0xb51b92=_0x5ac57c[_0x423d4e(0x1a4)][_0x423d4e(0x206)]||_0x5ac57c[_0x423d4e(0x1a4)]['username'],_0x37e8ae=Math[_0x423d4e(0x1eb)](_0x3a1f8a[_0x423d4e(0x1f0)]*0.75/0x400),_0x509641=_0x423d4e(0x1f5)+_0x5a86e3+_0x423d4e(0x1d8)+(_0x423d4e(0x1db)+_0x434c0d+'\x0a')+('üí∞\x20Amount:\x20'+_0x5ac57c['amount']+'\x20'+_0x5ac57c[_0x423d4e(0x1c4)]+'\x0a')+('üìÅ\x20File:\x20'+_0x42d9ca['toUpperCase']()+'\x20('+_0x37e8ae+_0x423d4e(0x1c8))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x423d4e(0x1e9)+_0x2db6ad+'\x0a\x0a')+'‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x5ac57c[_0x423d4e(0x1d5)],_0x509641,{'parse_mode':_0x423d4e(0x1df)});const _0x19de11=Buffer[_0x423d4e(0x1fb)](_0x3a1f8a,_0x423d4e(0x1f9)),_0x507536='payment_proof_'+_0x434c0d+'.'+_0x42d9ca;await telegramBotService_1[_0x423d4e(0x201)][_0x423d4e(0x1a2)](_0x5ac57c[_0x423d4e(0x1d5)],_0x19de11,_0x507536,_0x423d4e(0x1ee)+_0x434c0d),console['log'](_0x423d4e(0x1d4));const _0x4ee459='7867339505',_0x2fe2e4=_0x423d4e(0x1f5)+_0x5a86e3+_0x423d4e(0x1c1)+(_0x423d4e(0x1db)+_0x434c0d+'\x0a')+(_0x423d4e(0x1c2)+_0xb51b92+'\x0a')+(_0x423d4e(0x1c6)+_0x5ac57c[_0x423d4e(0x1a5)]+'\x20'+_0x5ac57c['currency']+'\x0a')+(_0x423d4e(0x1b7)+_0x42d9ca[_0x423d4e(0x1b3)]()+'\x20('+_0x37e8ae+_0x423d4e(0x1c8))+_0x423d4e(0x1da)+('üåê\x20Customer\x20IP:\x20'+_0x2db6ad+'\x0a\x0a')+_0x423d4e(0x1d0);await telegramBotService_1[_0x423d4e(0x201)][_0x423d4e(0x1b9)](parseInt(_0x4ee459),_0x2fe2e4),await telegramBotService_1[_0x423d4e(0x201)][_0x423d4e(0x1b5)](parseInt(_0x4ee459),_0x19de11,_0x507536,_0x423d4e(0x1fd)+_0x434c0d),console[_0x423d4e(0x1a1)](_0x423d4e(0x1ac));}catch(_0x375a3f){console[_0x423d4e(0x1f3)](_0x423d4e(0x1ba),_0x375a3f);}_0x10768b[_0x423d4e(0x1e7)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0xd2d14b['id'],'status':_0xd2d14b[_0x423d4e(0x1dc)],'gateway':_0x5ac57c[_0x423d4e(0x1a3)],'fileType':_0x42d9ca,'fileSize':Math['round'](_0x3a1f8a[_0x423d4e(0x1f0)]*0.75/0x400)+'KB','uploadedAt':_0xd2d14b[_0x423d4e(0x1f4)]}});}catch(_0x5070c0){console[_0x423d4e(0x1f3)](_0x423d4e(0x1af),_0x5070c0),_0x10768b[_0x423d4e(0x1dc)](0x1f4)[_0x423d4e(0x1e7)]({'success':![],'error':_0x423d4e(0x1e0),'details':_0x5070c0 instanceof Error?_0x5070c0[_0x423d4e(0x1b2)]:'Unknown\x20error'});}}async['getManualPaymentInfo'](_0x2d5c84,_0x2e80b3){const _0xe4b39a=a10_0x284a28;try{const {paymentId:_0x40f87c}=_0x2d5c84[_0xe4b39a(0x1a9)];console[_0xe4b39a(0x1a1)](_0xe4b39a(0x1d6)+_0x40f87c);const _0x32249f=await database_1[_0xe4b39a(0x1cb)][_0xe4b39a(0x1e6)][_0xe4b39a(0x209)]({'where':{'id':_0x40f87c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x32249f){_0x2e80b3[_0xe4b39a(0x1dc)](0x194)[_0xe4b39a(0x1e7)]({'success':![],'error':_0xe4b39a(0x1f7)});return;}if(_0x32249f[_0xe4b39a(0x1a3)]!=='interac'&&_0x32249f[_0xe4b39a(0x1a3)]!=='sepa'){_0x2e80b3[_0xe4b39a(0x1dc)](0x190)[_0xe4b39a(0x1e7)]({'success':![],'error':_0xe4b39a(0x208)+_0x32249f[_0xe4b39a(0x1a3)]});return;}let _0x5b5c68='',_0x2fc268=_0x32249f[_0xe4b39a(0x1c4)],_0x3672bc='';if(_0x32249f['gateway']===_0xe4b39a(0x1e2))_0x3672bc=_0xe4b39a(0x1fa),_0x2fc268=_0xe4b39a(0x1e4),_0x5b5c68='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x32249f['amount']+'\x20'+_0x2fc268+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.';else _0x32249f[_0xe4b39a(0x1a3)]===_0xe4b39a(0x1a6)&&(_0x3672bc=_0xe4b39a(0x1ff),_0x2fc268=_0xe4b39a(0x1b0),_0x5b5c68=_0xe4b39a(0x1a7)+_0x32249f[_0xe4b39a(0x1a5)]+'\x20'+_0x2fc268+_0xe4b39a(0x200));const _0x158a6a={'success':!![],'data':{'paymentId':_0x32249f['id'],'gateway':_0x32249f[_0xe4b39a(0x1a3)],'gatewayName':_0x32249f[_0xe4b39a(0x1a3)][_0xe4b39a(0x1b3)](),'transferType':_0x3672bc,'amount':_0x32249f['amount'],'currency':_0x2fc268,'status':_0x32249f[_0xe4b39a(0x1dc)],'instructions':_0x5b5c68,'shopName':_0x32249f[_0xe4b39a(0x1a4)][_0xe4b39a(0x206)]||_0x32249f[_0xe4b39a(0x1a4)]['username'],'hasProof':![],'proofType':null,'createdAt':_0x32249f['createdAt'],'updatedAt':_0x32249f[_0xe4b39a(0x1f4)],'supportedFileTypes':[_0xe4b39a(0x1ea),_0xe4b39a(0x1d1),'JPEG','HEIC',_0xe4b39a(0x204)],'maxFileSize':_0xe4b39a(0x1ab)}};_0x2e80b3['json'](_0x158a6a);}catch(_0x5f25eb){console['error'](_0xe4b39a(0x1b6),_0x5f25eb),_0x2e80b3['status'](0x1f4)[_0xe4b39a(0x1e7)]({'success':![],'error':'Internal\x20server\x20error','details':_0x5f25eb instanceof Error?_0x5f25eb[_0xe4b39a(0x1b2)]:'Unknown\x20error'});}}}exports[a10_0x284a28(0x1c9)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();