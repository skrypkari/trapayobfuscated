'use strict';const a10_0x2c9f55=a10_0x4b40;(function(_0x33d112,_0x267ffe){const _0x52e8f0=a10_0x4b40,_0x2753e8=_0x33d112();while(!![]){try{const _0x2a3872=-parseInt(_0x52e8f0(0x17d))/0x1+parseInt(_0x52e8f0(0x19a))/0x2+-parseInt(_0x52e8f0(0x1c0))/0x3+-parseInt(_0x52e8f0(0x193))/0x4*(-parseInt(_0x52e8f0(0x19e))/0x5)+parseInt(_0x52e8f0(0x1da))/0x6+-parseInt(_0x52e8f0(0x1ae))/0x7+parseInt(_0x52e8f0(0x1e0))/0x8;if(_0x2a3872===_0x267ffe)break;else _0x2753e8['push'](_0x2753e8['shift']());}catch(_0x58020f){_0x2753e8['push'](_0x2753e8['shift']());}}}(a10_0x11f2,0x89432));var __importDefault=this&&this[a10_0x2c9f55(0x1ab)]||function(_0x3c61de){const _0x47e56c=a10_0x2c9f55;return _0x3c61de&&_0x3c61de[_0x47e56c(0x184)]?_0x3c61de:{'default':_0x3c61de};};Object[a10_0x2c9f55(0x196)](exports,'__esModule',{'value':!![]}),exports[a10_0x2c9f55(0x17c)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a10_0x2c9f55(0x181))),telegramBotService_1=require('../services/telegramBotService');function a10_0x4b40(_0x56ef78,_0x24b3d9){_0x56ef78=_0x56ef78-0x177;const _0x11f2a6=a10_0x11f2();let _0x4b409c=_0x11f2a6[_0x56ef78];return _0x4b409c;}function a10_0x11f2(){const _0x2a59b5=['‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','replace','1978965ToSksw','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','PROCESSING','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','EUR','unknown','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','includes','Payment\x20ID\x20is\x20required','File\x20type\x20is\x20required','amount','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','sendShopNotification','üåê\x20Client\x20IP:\x20','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','Interac\x20e-Transfer','üåê\x20Customer\x20IP:\x20','CAD','üì±\x20Admin\x20notification\x20and\x20file\x20sent','Invalid\x20base64\x20file\x20data','jpg','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','üìÅ\x20File:\x20','uploadPaymentProof','findUnique','1607502QzgNDr','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','JPG','update','\x20\x20\x20-\x20Payment\x20ID:\x20','6818496QVEZDa','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','params','‚ùå\x20Payment\x20not\x20found:\x20','body','7867339505','manualPaymentController','179023ypvRoz','getManualPaymentInfo','Unknown\x20error','10MB','../config/database','sendDirectMessage','payment_proof_','__esModule','\x20\x20\x20-\x20Gateway:\x20','üìã\x20Get\x20manual\x20payment\x20info:\x20','message','currency','default','üí∞\x20Amount:\x20','from','Payment\x20not\x20found','base64','Payment\x20proof\x20uploaded\x20successfully','PDF','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','jpeg','heic','4XCcdqX','length','\x20\x20\x20-\x20File\x20size:\x20','defineProperty','Markdown','üí≥\x20Payment\x20ID:\x20','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','330288SKsJCX','File\x20data\x20is\x20required','KB)\x0a','telegramBotService','4434435ZjTvkQ','connection','remoteAddress','json','error','.\x20Supported:\x20','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','ManualPaymentController','gateway','round','interac','pdf','status','__importDefault','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','png','5399492ZqoydD','name','shop','\x20\x20\x20-\x20File\x20type:\x20','shopId','üè™\x20Shop:\x20','SEPA\x20Bank\x20Transfer','createdAt','payment','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','log','username','toUpperCase','\x20Payment\x20Proof\x20Received\x0a\x0a','join','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.'];a10_0x11f2=function(){return _0x2a59b5;};return a10_0x11f2();}class ManualPaymentController{async[a10_0x2c9f55(0x1d8)](_0x29468f,_0x4377eb){const _0x1bb4f5=a10_0x2c9f55;try{const {paymentId:_0x5784ef,fileData:_0x1d2abb,fileType:_0x4e7d23,fileName:_0x3409f9}=_0x29468f[_0x1bb4f5(0x17a)],_0x1ebddf=_0x29468f['ip']||_0x29468f[_0x1bb4f5(0x19f)]?.[_0x1bb4f5(0x1a0)]||_0x1bb4f5(0x1c5);console[_0x1bb4f5(0x1b8)](_0x1bb4f5(0x177)+_0x5784ef),console[_0x1bb4f5(0x1b8)]('üìÅ\x20File\x20type:\x20'+_0x4e7d23+',\x20size:\x20'+(_0x1d2abb?Math[_0x1bb4f5(0x1a7)](_0x1d2abb[_0x1bb4f5(0x194)]*0.75/0x400):0x0)+'KB'),console[_0x1bb4f5(0x1b8)](_0x1bb4f5(0x1ce)+_0x1ebddf);if(!_0x5784ef){_0x4377eb['status'](0x190)['json']({'success':![],'error':_0x1bb4f5(0x1c9)});return;}if(!_0x1d2abb){_0x4377eb[_0x1bb4f5(0x1aa)](0x190)['json']({'success':![],'error':_0x1bb4f5(0x19b)});return;}if(!_0x4e7d23){_0x4377eb[_0x1bb4f5(0x1aa)](0x190)[_0x1bb4f5(0x1a1)]({'success':![],'error':_0x1bb4f5(0x1ca)});return;}const _0x1b991c=[_0x1bb4f5(0x1ad),_0x1bb4f5(0x1d5),_0x1bb4f5(0x191),_0x1bb4f5(0x192),_0x1bb4f5(0x1a9)],_0x1e0ec2=_0x4e7d23['toLowerCase']()[_0x1bb4f5(0x1bf)]('.','');if(!_0x1b991c[_0x1bb4f5(0x1c8)](_0x1e0ec2)){_0x4377eb[_0x1bb4f5(0x1aa)](0x190)[_0x1bb4f5(0x1a1)]({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x4e7d23+_0x1bb4f5(0x1a3)+_0x1b991c[_0x1bb4f5(0x1bc)](',\x20')});return;}const _0x2f681f=0xa*0x400*0x400;if(_0x1d2abb[_0x1bb4f5(0x194)]>_0x2f681f){_0x4377eb[_0x1bb4f5(0x1aa)](0x190)['json']({'success':![],'error':_0x1bb4f5(0x190)});return;}const _0x393b59=await database_1['default'][_0x1bb4f5(0x1b6)][_0x1bb4f5(0x1d9)]({'where':{'id':_0x5784ef},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x393b59){console[_0x1bb4f5(0x1b8)](_0x1bb4f5(0x179)+_0x5784ef),_0x4377eb['status'](0x194)[_0x1bb4f5(0x1a1)]({'success':![],'error':_0x1bb4f5(0x18c)});return;}if(_0x393b59[_0x1bb4f5(0x1a6)]!==_0x1bb4f5(0x1a8)&&_0x393b59['gateway']!=='sepa'){console[_0x1bb4f5(0x1b8)](_0x1bb4f5(0x1db)+_0x393b59[_0x1bb4f5(0x1a6)]),_0x4377eb['status'](0x190)[_0x1bb4f5(0x1a1)]({'success':![],'error':_0x1bb4f5(0x1d6)+_0x393b59[_0x1bb4f5(0x1a6)]});return;}let _0x3bfb69=_0x1d2abb;_0x1d2abb['includes'](',')&&(_0x3bfb69=_0x1d2abb['split'](',')[0x1]);try{Buffer[_0x1bb4f5(0x18b)](_0x3bfb69,'base64');}catch(_0x306837){_0x4377eb[_0x1bb4f5(0x1aa)](0x190)['json']({'success':![],'error':_0x1bb4f5(0x1d4)});return;}const _0x42029b=await database_1[_0x1bb4f5(0x189)][_0x1bb4f5(0x1b6)][_0x1bb4f5(0x1de)]({'where':{'id':_0x5784ef},'data':{'status':_0x1bb4f5(0x1c2),'updatedAt':new Date()}});console[_0x1bb4f5(0x1b8)](_0x1bb4f5(0x1be)),console[_0x1bb4f5(0x1b8)](_0x1bb4f5(0x1df)+_0x5784ef),console[_0x1bb4f5(0x1b8)](_0x1bb4f5(0x185)+_0x393b59[_0x1bb4f5(0x1a6)][_0x1bb4f5(0x1ba)]()),console[_0x1bb4f5(0x1b8)](_0x1bb4f5(0x1b1)+_0x1e0ec2),console[_0x1bb4f5(0x1b8)](_0x1bb4f5(0x195)+Math['round'](_0x3bfb69[_0x1bb4f5(0x194)]*0.75/0x400)+'KB'),console[_0x1bb4f5(0x1b8)](_0x1bb4f5(0x1c1));try{const _0x1e58d6=_0x393b59[_0x1bb4f5(0x1a6)][_0x1bb4f5(0x1ba)](),_0x9f562d=_0x393b59[_0x1bb4f5(0x1b0)][_0x1bb4f5(0x1af)]||_0x393b59[_0x1bb4f5(0x1b0)][_0x1bb4f5(0x1b9)],_0x295e1a=Math['round'](_0x3bfb69['length']*0.75/0x400),_0x36f499='üîÑ\x20'+_0x1e58d6+_0x1bb4f5(0x1bb)+(_0x1bb4f5(0x198)+_0x5784ef+'\x0a')+(_0x1bb4f5(0x18a)+_0x393b59['amount']+'\x20'+_0x393b59[_0x1bb4f5(0x188)]+'\x0a')+('üìÅ\x20File:\x20'+_0x1e0ec2['toUpperCase']()+'\x20('+_0x295e1a+_0x1bb4f5(0x19c))+_0x1bb4f5(0x1dc)+(_0x1bb4f5(0x1d1)+_0x1ebddf+'\x0a\x0a')+_0x1bb4f5(0x1cc);await telegramBotService_1[_0x1bb4f5(0x19d)][_0x1bb4f5(0x1cd)](_0x393b59[_0x1bb4f5(0x1b2)],_0x36f499,{'parse_mode':_0x1bb4f5(0x197)});const _0x1cc4f9=Buffer[_0x1bb4f5(0x18b)](_0x3bfb69,_0x1bb4f5(0x18d)),_0xa197d1=_0x1bb4f5(0x183)+_0x5784ef+'.'+_0x1e0ec2;await telegramBotService_1['telegramBotService']['sendShopFile'](_0x393b59[_0x1bb4f5(0x1b2)],_0x1cc4f9,_0xa197d1,'Payment\x20proof\x20for\x20'+_0x5784ef),console[_0x1bb4f5(0x1b8)](_0x1bb4f5(0x1cf));const _0x49f931=_0x1bb4f5(0x17b),_0xd63e6e='üîÑ\x20'+_0x1e58d6+_0x1bb4f5(0x1ac)+(_0x1bb4f5(0x198)+_0x5784ef+'\x0a')+(_0x1bb4f5(0x1b3)+_0x9f562d+'\x0a')+(_0x1bb4f5(0x18a)+_0x393b59[_0x1bb4f5(0x1cb)]+'\x20'+_0x393b59[_0x1bb4f5(0x188)]+'\x0a')+(_0x1bb4f5(0x1d7)+_0x1e0ec2[_0x1bb4f5(0x1ba)]()+'\x20('+_0x295e1a+'KB)\x0a')+_0x1bb4f5(0x1dc)+(_0x1bb4f5(0x1d1)+_0x1ebddf+'\x0a\x0a')+_0x1bb4f5(0x1a4);await telegramBotService_1[_0x1bb4f5(0x19d)][_0x1bb4f5(0x182)](parseInt(_0x49f931),_0xd63e6e),await telegramBotService_1[_0x1bb4f5(0x19d)]['sendDirectFile'](parseInt(_0x49f931),_0x1cc4f9,_0xa197d1,_0x1bb4f5(0x1b7)+_0x5784ef),console['log'](_0x1bb4f5(0x1d3));}catch(_0xad7bc1){console[_0x1bb4f5(0x1a2)](_0x1bb4f5(0x199),_0xad7bc1);}_0x4377eb[_0x1bb4f5(0x1a1)]({'success':!![],'message':_0x1bb4f5(0x18e),'data':{'paymentId':_0x42029b['id'],'status':_0x42029b[_0x1bb4f5(0x1aa)],'gateway':_0x393b59['gateway'],'fileType':_0x1e0ec2,'fileSize':Math[_0x1bb4f5(0x1a7)](_0x3bfb69[_0x1bb4f5(0x194)]*0.75/0x400)+'KB','uploadedAt':_0x42029b['updatedAt']}});}catch(_0x547570){console[_0x1bb4f5(0x1a2)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x547570),_0x4377eb[_0x1bb4f5(0x1aa)](0x1f4)[_0x1bb4f5(0x1a1)]({'success':![],'error':'Internal\x20server\x20error','details':_0x547570 instanceof Error?_0x547570[_0x1bb4f5(0x187)]:_0x1bb4f5(0x17f)});}}async[a10_0x2c9f55(0x17e)](_0x5b93e9,_0x50eeb1){const _0x166d1c=a10_0x2c9f55;try{const {paymentId:_0x34cc7a}=_0x5b93e9[_0x166d1c(0x178)];console[_0x166d1c(0x1b8)](_0x166d1c(0x186)+_0x34cc7a);const _0x5a94b1=await database_1[_0x166d1c(0x189)][_0x166d1c(0x1b6)][_0x166d1c(0x1d9)]({'where':{'id':_0x34cc7a},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5a94b1){_0x50eeb1[_0x166d1c(0x1aa)](0x194)[_0x166d1c(0x1a1)]({'success':![],'error':_0x166d1c(0x18c)});return;}if(_0x5a94b1[_0x166d1c(0x1a6)]!==_0x166d1c(0x1a8)&&_0x5a94b1[_0x166d1c(0x1a6)]!=='sepa'){_0x50eeb1[_0x166d1c(0x1aa)](0x190)[_0x166d1c(0x1a1)]({'success':![],'error':_0x166d1c(0x1c3)+_0x5a94b1[_0x166d1c(0x1a6)]});return;}let _0x48ab5c='',_0x26eca7=_0x5a94b1['currency'],_0x56056f='';if(_0x5a94b1[_0x166d1c(0x1a6)]===_0x166d1c(0x1a8))_0x56056f=_0x166d1c(0x1d0),_0x26eca7=_0x166d1c(0x1d2),_0x48ab5c=_0x166d1c(0x1c7)+_0x5a94b1[_0x166d1c(0x1cb)]+'\x20'+_0x26eca7+_0x166d1c(0x1bd);else _0x5a94b1[_0x166d1c(0x1a6)]==='sepa'&&(_0x56056f=_0x166d1c(0x1b4),_0x26eca7=_0x166d1c(0x1c4),_0x48ab5c=_0x166d1c(0x1c6)+_0x5a94b1[_0x166d1c(0x1cb)]+'\x20'+_0x26eca7+_0x166d1c(0x1bd));const _0x80adc3={'success':!![],'data':{'paymentId':_0x5a94b1['id'],'gateway':_0x5a94b1[_0x166d1c(0x1a6)],'gatewayName':_0x5a94b1[_0x166d1c(0x1a6)]['toUpperCase'](),'transferType':_0x56056f,'amount':_0x5a94b1[_0x166d1c(0x1cb)],'currency':_0x26eca7,'status':_0x5a94b1['status'],'instructions':_0x48ab5c,'shopName':_0x5a94b1['shop'][_0x166d1c(0x1af)]||_0x5a94b1[_0x166d1c(0x1b0)][_0x166d1c(0x1b9)],'hasProof':![],'proofType':null,'createdAt':_0x5a94b1[_0x166d1c(0x1b5)],'updatedAt':_0x5a94b1['updatedAt'],'supportedFileTypes':['PNG',_0x166d1c(0x1dd),'JPEG','HEIC',_0x166d1c(0x18f)],'maxFileSize':_0x166d1c(0x180)}};_0x50eeb1[_0x166d1c(0x1a1)](_0x80adc3);}catch(_0x13fa69){console[_0x166d1c(0x1a2)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0x13fa69),_0x50eeb1[_0x166d1c(0x1aa)](0x1f4)[_0x166d1c(0x1a1)]({'success':![],'error':'Internal\x20server\x20error','details':_0x13fa69 instanceof Error?_0x13fa69[_0x166d1c(0x187)]:_0x166d1c(0x17f)});}}}exports[a10_0x2c9f55(0x1a5)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();