'use strict';const a8_0x46474b=a8_0x42a6;(function(_0x1b6fc6,_0x4e632e){const _0x49f5b3=a8_0x42a6,_0xe830b0=_0x1b6fc6();while(!![]){try{const _0x5cdcbf=-parseInt(_0x49f5b3(0xc1))/0x1+parseInt(_0x49f5b3(0xb0))/0x2*(parseInt(_0x49f5b3(0xa3))/0x3)+-parseInt(_0x49f5b3(0xd9))/0x4+-parseInt(_0x49f5b3(0xef))/0x5*(-parseInt(_0x49f5b3(0xb1))/0x6)+-parseInt(_0x49f5b3(0xe2))/0x7+-parseInt(_0x49f5b3(0xff))/0x8*(parseInt(_0x49f5b3(0xab))/0x9)+parseInt(_0x49f5b3(0xc5))/0xa;if(_0x5cdcbf===_0x4e632e)break;else _0xe830b0['push'](_0xe830b0['shift']());}catch(_0x36a464){_0xe830b0['push'](_0xe830b0['shift']());}}}(a8_0x308b,0xc8ec3));function a8_0x42a6(_0x2bb5a6,_0x20d977){const _0x308ba8=a8_0x308b();return a8_0x42a6=function(_0x42a6e9,_0x2eaeb8){_0x42a6e9=_0x42a6e9-0x9a;let _0x305fd5=_0x308ba8[_0x42a6e9];return _0x305fd5;},a8_0x42a6(_0x2bb5a6,_0x20d977);}function a8_0x308b(){const _0x172c84=['__esModule','telegramBotService','sendShopFile','HEIC','heic','üè™\x20Shop:\x20','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','manualPaymentController','File\x20data\x20is\x20required','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','üí∞\x20Amount:\x20','sendShopNotification','error','138lGzjWr','JPEG','üåê\x20Customer\x20IP:\x20','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','jpeg','payment','../services/telegramBotService','message','45DRYIUx','SEPA\x20Bank\x20Transfer','sendDirectMessage','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','2854fwnsaw','189498hEjQRu','‚ùå\x20Payment\x20not\x20found:\x20','PDF','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','uploadPaymentProof','jpg','status','body','amount','round','name','log','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','üí≥\x20Payment\x20ID:\x20','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','66333fohsvQ','Interac\x20e-Transfer','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','üì±\x20Admin\x20notification\x20and\x20file\x20sent','42017350qghFRN','png','from','pdf','PNG','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','toLowerCase','Unsupported\x20file\x20type:\x20','params','sepa','Payment\x20proof\x20uploaded\x20successfully','\x20\x20\x20-\x20Gateway:\x20','ManualPaymentController','CAD','Payment\x20ID\x20is\x20required',',\x20size:\x20','7867339505','\x20\x20\x20-\x20File\x20size:\x20','\x20Payment\x20Proof\x20Received\x0a\x0a','split','4507576wackaJ','JPG','üåê\x20Client\x20IP:\x20','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','\x20\x20\x20-\x20Payment\x20ID:\x20','Markdown','üìã\x20Get\x20manual\x20payment\x20info:\x20','Unknown\x20error','includes','10721641XAcNbi','üìÅ\x20File:\x20','gateway','.\x20Supported:\x20','__importDefault','createdAt','update','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','defineProperty','EUR','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','interac','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','95WDthOA','Internal\x20server\x20error','username','üîÑ\x20','default','json','length','base64','KB)\x0a','updatedAt','shop','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','shopId','Payment\x20proof\x20for\x20','toUpperCase','\x20\x20\x20-\x20File\x20type:\x20','2111336NCWgaj','remoteAddress','findUnique','currency'];a8_0x308b=function(){return _0x172c84;};return a8_0x308b();}var __importDefault=this&&this[a8_0x46474b(0xe6)]||function(_0x5cee75){const _0x4efb6b=a8_0x46474b;return _0x5cee75&&_0x5cee75[_0x4efb6b(0x103)]?_0x5cee75:{'default':_0x5cee75};};Object[a8_0x46474b(0xea)](exports,a8_0x46474b(0x103),{'value':!![]}),exports[a8_0x46474b(0x9d)]=exports[a8_0x46474b(0xd1)]=void 0x0;const database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a8_0x46474b(0xa9));class ManualPaymentController{async[a8_0x46474b(0xb5)](_0x7681e8,_0x57e789){const _0x16c630=a8_0x46474b;try{const {paymentId:_0x94873,fileData:_0x4a26d2,fileType:_0x97e9af,fileName:_0x5ba791}=_0x7681e8[_0x16c630(0xb8)],_0x2917e4=_0x7681e8['ip']||_0x7681e8['connection']?.[_0x16c630(0x100)]||'unknown';console[_0x16c630(0xbc)](_0x16c630(0xee)+_0x94873),console[_0x16c630(0xbc)]('üìÅ\x20File\x20type:\x20'+_0x97e9af+_0x16c630(0xd4)+(_0x4a26d2?Math[_0x16c630(0xba)](_0x4a26d2[_0x16c630(0xf5)]*0.75/0x400):0x0)+'KB'),console[_0x16c630(0xbc)](_0x16c630(0xdb)+_0x2917e4);if(!_0x94873){_0x57e789['status'](0x190)[_0x16c630(0xf4)]({'success':![],'error':_0x16c630(0xd3)});return;}if(!_0x4a26d2){_0x57e789[_0x16c630(0xb7)](0x190)['json']({'success':![],'error':_0x16c630(0x9e)});return;}if(!_0x97e9af){_0x57e789[_0x16c630(0xb7)](0x190)[_0x16c630(0xf4)]({'success':![],'error':'File\x20type\x20is\x20required'});return;}const _0x3f8393=[_0x16c630(0xc6),_0x16c630(0xb6),_0x16c630(0xa7),_0x16c630(0x9a),_0x16c630(0xc8)],_0x2f9644=_0x97e9af[_0x16c630(0xcb)]()['replace']('.','');if(!_0x3f8393[_0x16c630(0xe1)](_0x2f9644)){_0x57e789['status'](0x190)[_0x16c630(0xf4)]({'success':![],'error':_0x16c630(0xcc)+_0x97e9af+_0x16c630(0xe5)+_0x3f8393['join'](',\x20')});return;}const _0x2a1446=0xa*0x400*0x400;if(_0x4a26d2['length']>_0x2a1446){_0x57e789[_0x16c630(0xb7)](0x190)['json']({'success':![],'error':_0x16c630(0xfa)});return;}const _0x30b6df=await database_1[_0x16c630(0xf3)][_0x16c630(0xa8)][_0x16c630(0x101)]({'where':{'id':_0x94873},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x30b6df){console['log'](_0x16c630(0xb2)+_0x94873),_0x57e789[_0x16c630(0xb7)](0x194)[_0x16c630(0xf4)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x30b6df[_0x16c630(0xe4)]!==_0x16c630(0xed)&&_0x30b6df[_0x16c630(0xe4)]!=='sepa'){console[_0x16c630(0xbc)](_0x16c630(0xdc)+_0x30b6df['gateway']),_0x57e789['status'](0x190)[_0x16c630(0xf4)]({'success':![],'error':_0x16c630(0xae)+_0x30b6df[_0x16c630(0xe4)]});return;}let _0x5f3cec=_0x4a26d2;_0x4a26d2[_0x16c630(0xe1)](',')&&(_0x5f3cec=_0x4a26d2[_0x16c630(0xd8)](',')[0x1]);try{Buffer[_0x16c630(0xc7)](_0x5f3cec,_0x16c630(0xf6));}catch(_0x14a265){_0x57e789[_0x16c630(0xb7)](0x190)[_0x16c630(0xf4)]({'success':![],'error':'Invalid\x20base64\x20file\x20data'});return;}const _0x1e8b8d=await database_1[_0x16c630(0xf3)][_0x16c630(0xa8)][_0x16c630(0xe8)]({'where':{'id':_0x94873},'data':{'status':'PROCESSING','updatedAt':new Date()}});console[_0x16c630(0xbc)](_0x16c630(0xe9)),console[_0x16c630(0xbc)](_0x16c630(0xdd)+_0x94873),console['log'](_0x16c630(0xd0)+_0x30b6df['gateway'][_0x16c630(0xfd)]()),console['log'](_0x16c630(0xfe)+_0x2f9644),console[_0x16c630(0xbc)](_0x16c630(0xd6)+Math[_0x16c630(0xba)](_0x5f3cec[_0x16c630(0xf5)]*0.75/0x400)+'KB'),console[_0x16c630(0xbc)](_0x16c630(0xbd));try{const _0x26719e=_0x30b6df['gateway'][_0x16c630(0xfd)](),_0x4e411a=_0x30b6df['shop'][_0x16c630(0xbb)]||_0x30b6df[_0x16c630(0xf9)][_0x16c630(0xf1)],_0x24196f=Math['round'](_0x5f3cec[_0x16c630(0xf5)]*0.75/0x400),_0x54e0db=_0x16c630(0xf2)+_0x26719e+_0x16c630(0xd7)+(_0x16c630(0xbe)+_0x94873+'\x0a')+(_0x16c630(0xa0)+_0x30b6df[_0x16c630(0xb9)]+'\x20'+_0x30b6df[_0x16c630(0x102)]+'\x0a')+(_0x16c630(0xe3)+_0x2f9644[_0x16c630(0xfd)]()+'\x20('+_0x24196f+_0x16c630(0xf7))+_0x16c630(0x9f)+('üåê\x20Customer\x20IP:\x20'+_0x2917e4+'\x0a\x0a')+'‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1[_0x16c630(0x104)][_0x16c630(0xa1)](_0x30b6df[_0x16c630(0xfb)],_0x54e0db,{'parse_mode':_0x16c630(0xde)});const _0x278477=Buffer[_0x16c630(0xc7)](_0x5f3cec,_0x16c630(0xf6)),_0xd7481e='payment_proof_'+_0x94873+'.'+_0x2f9644;await telegramBotService_1[_0x16c630(0x104)][_0x16c630(0x105)](_0x30b6df[_0x16c630(0xfb)],_0x278477,_0xd7481e,_0x16c630(0xfc)+_0x94873),console[_0x16c630(0xbc)](_0x16c630(0xec));const _0x57fb19=_0x16c630(0xd5),_0x4e126e=_0x16c630(0xf2)+_0x26719e+_0x16c630(0xaf)+(_0x16c630(0xbe)+_0x94873+'\x0a')+(_0x16c630(0x9b)+_0x4e411a+'\x0a')+(_0x16c630(0xa0)+_0x30b6df[_0x16c630(0xb9)]+'\x20'+_0x30b6df['currency']+'\x0a')+(_0x16c630(0xe3)+_0x2f9644[_0x16c630(0xfd)]()+'\x20('+_0x24196f+_0x16c630(0xf7))+_0x16c630(0x9f)+(_0x16c630(0xa5)+_0x2917e4+'\x0a\x0a')+_0x16c630(0xc3);await telegramBotService_1[_0x16c630(0x104)][_0x16c630(0xad)](parseInt(_0x57fb19),_0x4e126e),await telegramBotService_1[_0x16c630(0x104)]['sendDirectFile'](parseInt(_0x57fb19),_0x278477,_0xd7481e,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x94873),console[_0x16c630(0xbc)](_0x16c630(0xc4));}catch(_0x1e06eb){console[_0x16c630(0xa2)](_0x16c630(0x9c),_0x1e06eb);}_0x57e789[_0x16c630(0xf4)]({'success':!![],'message':_0x16c630(0xcf),'data':{'paymentId':_0x1e8b8d['id'],'status':_0x1e8b8d[_0x16c630(0xb7)],'gateway':_0x30b6df['gateway'],'fileType':_0x2f9644,'fileSize':Math['round'](_0x5f3cec[_0x16c630(0xf5)]*0.75/0x400)+'KB','uploadedAt':_0x1e8b8d[_0x16c630(0xf8)]}});}catch(_0x3f962f){console[_0x16c630(0xa2)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x3f962f),_0x57e789[_0x16c630(0xb7)](0x1f4)[_0x16c630(0xf4)]({'success':![],'error':'Internal\x20server\x20error','details':_0x3f962f instanceof Error?_0x3f962f[_0x16c630(0xaa)]:_0x16c630(0xe0)});}}async['getManualPaymentInfo'](_0x1fcc4e,_0xc360b3){const _0x48e3f4=a8_0x46474b;try{const {paymentId:_0xce9280}=_0x1fcc4e[_0x48e3f4(0xcd)];console[_0x48e3f4(0xbc)](_0x48e3f4(0xdf)+_0xce9280);const _0x28c4c2=await database_1[_0x48e3f4(0xf3)][_0x48e3f4(0xa8)][_0x48e3f4(0x101)]({'where':{'id':_0xce9280},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x28c4c2){_0xc360b3[_0x48e3f4(0xb7)](0x194)[_0x48e3f4(0xf4)]({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x28c4c2[_0x48e3f4(0xe4)]!=='interac'&&_0x28c4c2[_0x48e3f4(0xe4)]!==_0x48e3f4(0xce)){_0xc360b3[_0x48e3f4(0xb7)](0x190)[_0x48e3f4(0xf4)]({'success':![],'error':_0x48e3f4(0xc0)+_0x28c4c2[_0x48e3f4(0xe4)]});return;}let _0x4a08ad='',_0x1735f3=_0x28c4c2['currency'],_0x1f7a61='';if(_0x28c4c2[_0x48e3f4(0xe4)]===_0x48e3f4(0xed))_0x1f7a61=_0x48e3f4(0xc2),_0x1735f3=_0x48e3f4(0xd2),_0x4a08ad=_0x48e3f4(0xca)+_0x28c4c2[_0x48e3f4(0xb9)]+'\x20'+_0x1735f3+_0x48e3f4(0xb4);else _0x28c4c2[_0x48e3f4(0xe4)]===_0x48e3f4(0xce)&&(_0x1f7a61=_0x48e3f4(0xac),_0x1735f3=_0x48e3f4(0xeb),_0x4a08ad=_0x48e3f4(0xbf)+_0x28c4c2[_0x48e3f4(0xb9)]+'\x20'+_0x1735f3+_0x48e3f4(0xb4));const _0x5a78d3={'success':!![],'data':{'paymentId':_0x28c4c2['id'],'gateway':_0x28c4c2[_0x48e3f4(0xe4)],'gatewayName':_0x28c4c2['gateway']['toUpperCase'](),'transferType':_0x1f7a61,'amount':_0x28c4c2[_0x48e3f4(0xb9)],'currency':_0x1735f3,'status':_0x28c4c2['status'],'instructions':_0x4a08ad,'shopName':_0x28c4c2[_0x48e3f4(0xf9)][_0x48e3f4(0xbb)]||_0x28c4c2[_0x48e3f4(0xf9)]['username'],'hasProof':![],'proofType':null,'createdAt':_0x28c4c2[_0x48e3f4(0xe7)],'updatedAt':_0x28c4c2[_0x48e3f4(0xf8)],'supportedFileTypes':[_0x48e3f4(0xc9),_0x48e3f4(0xda),_0x48e3f4(0xa4),_0x48e3f4(0x106),_0x48e3f4(0xb3)],'maxFileSize':'10MB'}};_0xc360b3['json'](_0x5a78d3);}catch(_0x4d163e){console[_0x48e3f4(0xa2)](_0x48e3f4(0xa6),_0x4d163e),_0xc360b3[_0x48e3f4(0xb7)](0x1f4)[_0x48e3f4(0xf4)]({'success':![],'error':_0x48e3f4(0xf0),'details':_0x4d163e instanceof Error?_0x4d163e[_0x48e3f4(0xaa)]:_0x48e3f4(0xe0)});}}}exports[a8_0x46474b(0xd1)]=ManualPaymentController,exports[a8_0x46474b(0x9d)]=new ManualPaymentController();