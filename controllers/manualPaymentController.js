'use strict';const a8_0x5e1ea3=a8_0x1874;(function(_0x4ae643,_0x45cefc){const _0x319a34=a8_0x1874,_0x2e501f=_0x4ae643();while(!![]){try{const _0x578b81=parseInt(_0x319a34(0xdd))/0x1*(-parseInt(_0x319a34(0x106))/0x2)+-parseInt(_0x319a34(0xe2))/0x3*(parseInt(_0x319a34(0xaa))/0x4)+-parseInt(_0x319a34(0xff))/0x5*(parseInt(_0x319a34(0xa3))/0x6)+parseInt(_0x319a34(0xa6))/0x7+parseInt(_0x319a34(0x111))/0x8*(parseInt(_0x319a34(0x10c))/0x9)+parseInt(_0x319a34(0xfc))/0xa*(-parseInt(_0x319a34(0xaf))/0xb)+parseInt(_0x319a34(0xcf))/0xc;if(_0x578b81===_0x45cefc)break;else _0x2e501f['push'](_0x2e501f['shift']());}catch(_0xeda60a){_0x2e501f['push'](_0x2e501f['shift']());}}}(a8_0xb634,0x665bc));function a8_0xb634(){const _0x471f97=['default','shop','File\x20type\x20is\x20required','shopId','remoteAddress','Unsupported\x20file\x20type:\x20','File\x20data\x20is\x20required','connection','‚ùå\x20Upload\x20payment\x20proof\x20error:','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','7867339505','../config/database','manualPaymentController','\x20\x20\x20-\x20File\x20type:\x20','name','1504240RCQuXA','telegramBotService','üåê\x20Client\x20IP:\x20','277105xwQwJE','message','sendDirectMessage','EUR','join','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','sendShopFile','299382WUYSlM','defineProperty','amount','status','sendShopNotification','heic','39645pkoLNa','üåê\x20Customer\x20IP:\x20','\x20\x20\x20-\x20Payment\x20ID:\x20','Invalid\x20base64\x20file\x20data','createdAt','424uXXgoU','replace','log','üí≥\x20Payment\x20ID:\x20','18szfAGw','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','HEIC','142002iteTFq','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','length','from','706796ZxTgLo','\x20Payment\x20Proof\x20Received\x0a\x0a','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','üì±\x20Admin\x20notification\x20and\x20file\x20sent','base64','22eObjDl','toUpperCase','payment','getManualPaymentInfo','üìÅ\x20File:\x20','../services/telegramBotService','üè™\x20Shop:\x20','KB)\x0a','gateway','Payment\x20proof\x20for\x20','.\x20Supported:\x20','PROCESSING','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','jpeg','findUnique','‚ùå\x20Payment\x20not\x20found:\x20','JPEG','updatedAt','10MB','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','SEPA\x20Bank\x20Transfer','\x20\x20\x20-\x20File\x20size:\x20','username','unknown','split','Markdown','pdf','üìÅ\x20File\x20type:\x20','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','CAD','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','includes','20813676DEOxsx','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','body','Unknown\x20error','sendDirectFile','sepa','üìã\x20Get\x20manual\x20payment\x20info:\x20','interac','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','Payment\x20not\x20found','currency','Payment\x20proof\x20uploaded\x20successfully','json','round','5splQcs','ManualPaymentController','uploadPaymentProof','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','params','6IgVnmg','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','update','Payment\x20ID\x20is\x20required','error','üí∞\x20Amount:\x20','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','png','Internal\x20server\x20error','__esModule','üîÑ\x20'];a8_0xb634=function(){return _0x471f97;};return a8_0xb634();}var __importDefault=this&&this['__importDefault']||function(_0x1ca689){const _0x33b5a8=a8_0x1874;return _0x1ca689&&_0x1ca689[_0x33b5a8(0xeb)]?_0x1ca689:{'default':_0x1ca689};};Object[a8_0x5e1ea3(0x107)](exports,a8_0x5e1ea3(0xeb),{'value':!![]}),exports[a8_0x5e1ea3(0xf9)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require(a8_0x5e1ea3(0xf8))),telegramBotService_1=require(a8_0x5e1ea3(0xb4));class ManualPaymentController{async[a8_0x5e1ea3(0xdf)](_0x1317a3,_0x14ff9a){const _0x53d172=a8_0x5e1ea3;try{const {paymentId:_0x40788a,fileData:_0x2b3c2b,fileType:_0x463e64,fileName:_0x237c0e}=_0x1317a3[_0x53d172(0xd1)],_0x8c7bba=_0x1317a3['ip']||_0x1317a3[_0x53d172(0xf4)]?.[_0x53d172(0xf1)]||_0x53d172(0xc6);console['log'](_0x53d172(0xe8)+_0x40788a),console[_0x53d172(0x113)](_0x53d172(0xca)+_0x463e64+',\x20size:\x20'+(_0x2b3c2b?Math['round'](_0x2b3c2b[_0x53d172(0xa8)]*0.75/0x400):0x0)+'KB'),console[_0x53d172(0x113)](_0x53d172(0xfe)+_0x8c7bba);if(!_0x40788a){_0x14ff9a['status'](0x190)['json']({'success':![],'error':_0x53d172(0xe5)});return;}if(!_0x2b3c2b){_0x14ff9a[_0x53d172(0x109)](0x190)['json']({'success':![],'error':_0x53d172(0xf3)});return;}if(!_0x463e64){_0x14ff9a[_0x53d172(0x109)](0x190)['json']({'success':![],'error':_0x53d172(0xef)});return;}const _0x3b17e5=[_0x53d172(0xe9),'jpg',_0x53d172(0xbc),_0x53d172(0x10b),_0x53d172(0xc9)],_0x109dda=_0x463e64['toLowerCase']()[_0x53d172(0x112)]('.','');if(!_0x3b17e5['includes'](_0x109dda)){_0x14ff9a[_0x53d172(0x109)](0x190)[_0x53d172(0xdb)]({'success':![],'error':_0x53d172(0xf2)+_0x463e64+_0x53d172(0xb9)+_0x3b17e5[_0x53d172(0x103)](',\x20')});return;}const _0x21f157=0xa*0x400*0x400;if(_0x2b3c2b[_0x53d172(0xa8)]>_0x21f157){_0x14ff9a[_0x53d172(0x109)](0x190)[_0x53d172(0xdb)]({'success':![],'error':_0x53d172(0xcd)});return;}const _0x295022=await database_1[_0x53d172(0xed)][_0x53d172(0xb1)][_0x53d172(0xbd)]({'where':{'id':_0x40788a},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x295022){console[_0x53d172(0x113)](_0x53d172(0xbe)+_0x40788a),_0x14ff9a[_0x53d172(0x109)](0x194)['json']({'success':![],'error':_0x53d172(0xd8)});return;}if(_0x295022['gateway']!==_0x53d172(0xd6)&&_0x295022['gateway']!=='sepa'){console[_0x53d172(0x113)]('‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x295022[_0x53d172(0xb7)]),_0x14ff9a[_0x53d172(0x109)](0x190)['json']({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x295022['gateway']});return;}let _0x197fb6=_0x2b3c2b;_0x2b3c2b[_0x53d172(0xce)](',')&&(_0x197fb6=_0x2b3c2b[_0x53d172(0xc7)](',')[0x1]);try{Buffer[_0x53d172(0xa9)](_0x197fb6,_0x53d172(0xae));}catch(_0x403826){_0x14ff9a[_0x53d172(0x109)](0x190)[_0x53d172(0xdb)]({'success':![],'error':_0x53d172(0x10f)});return;}const _0x4173f0=await database_1[_0x53d172(0xed)][_0x53d172(0xb1)][_0x53d172(0xe4)]({'where':{'id':_0x40788a},'data':{'status':_0x53d172(0xba),'updatedAt':new Date()}});console[_0x53d172(0x113)](_0x53d172(0xf6)),console[_0x53d172(0x113)](_0x53d172(0x10e)+_0x40788a),console[_0x53d172(0x113)]('\x20\x20\x20-\x20Gateway:\x20'+_0x295022[_0x53d172(0xb7)][_0x53d172(0xb0)]()),console[_0x53d172(0x113)](_0x53d172(0xfa)+_0x109dda),console[_0x53d172(0x113)](_0x53d172(0xc4)+Math['round'](_0x197fb6[_0x53d172(0xa8)]*0.75/0x400)+'KB'),console[_0x53d172(0x113)](_0x53d172(0xa7));try{const _0x45cd03=_0x295022['gateway'][_0x53d172(0xb0)](),_0x482967=_0x295022['shop'][_0x53d172(0xfb)]||_0x295022[_0x53d172(0xee)][_0x53d172(0xc5)],_0x2f8038=Math[_0x53d172(0xdc)](_0x197fb6[_0x53d172(0xa8)]*0.75/0x400),_0xc31593=_0x53d172(0xec)+_0x45cd03+_0x53d172(0xab)+(_0x53d172(0x114)+_0x40788a+'\x0a')+(_0x53d172(0xe7)+_0x295022[_0x53d172(0x108)]+'\x20'+_0x295022[_0x53d172(0xd9)]+'\x0a')+(_0x53d172(0xb3)+_0x109dda['toUpperCase']()+'\x20('+_0x2f8038+_0x53d172(0xb6))+_0x53d172(0xc2)+(_0x53d172(0x10d)+_0x8c7bba+'\x0a\x0a')+_0x53d172(0xa4);await telegramBotService_1[_0x53d172(0xfd)][_0x53d172(0x10a)](_0x295022['shopId'],_0xc31593,{'parse_mode':_0x53d172(0xc8)});const _0x5311fd=Buffer[_0x53d172(0xa9)](_0x197fb6,_0x53d172(0xae)),_0x12f33d='payment_proof_'+_0x40788a+'.'+_0x109dda;await telegramBotService_1[_0x53d172(0xfd)][_0x53d172(0x105)](_0x295022[_0x53d172(0xf0)],_0x5311fd,_0x12f33d,_0x53d172(0xb8)+_0x40788a),console[_0x53d172(0x113)](_0x53d172(0xe0));const _0x4f44f4=_0x53d172(0xf7),_0x59bcc8=_0x53d172(0xec)+_0x45cd03+_0x53d172(0xe3)+(_0x53d172(0x114)+_0x40788a+'\x0a')+(_0x53d172(0xb5)+_0x482967+'\x0a')+(_0x53d172(0xe7)+_0x295022[_0x53d172(0x108)]+'\x20'+_0x295022[_0x53d172(0xd9)]+'\x0a')+('üìÅ\x20File:\x20'+_0x109dda['toUpperCase']()+'\x20('+_0x2f8038+_0x53d172(0xb6))+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x53d172(0x10d)+_0x8c7bba+'\x0a\x0a')+_0x53d172(0x104);await telegramBotService_1[_0x53d172(0xfd)][_0x53d172(0x101)](parseInt(_0x4f44f4),_0x59bcc8),await telegramBotService_1[_0x53d172(0xfd)][_0x53d172(0xd3)](parseInt(_0x4f44f4),_0x5311fd,_0x12f33d,_0x53d172(0xbb)+_0x40788a),console['log'](_0x53d172(0xad));}catch(_0x1240be){console[_0x53d172(0xe6)](_0x53d172(0xcb),_0x1240be);}_0x14ff9a[_0x53d172(0xdb)]({'success':!![],'message':_0x53d172(0xda),'data':{'paymentId':_0x4173f0['id'],'status':_0x4173f0['status'],'gateway':_0x295022['gateway'],'fileType':_0x109dda,'fileSize':Math[_0x53d172(0xdc)](_0x197fb6['length']*0.75/0x400)+'KB','uploadedAt':_0x4173f0[_0x53d172(0xc0)]}});}catch(_0x26b2cd){console[_0x53d172(0xe6)](_0x53d172(0xf5),_0x26b2cd),_0x14ff9a['status'](0x1f4)[_0x53d172(0xdb)]({'success':![],'error':_0x53d172(0xea),'details':_0x26b2cd instanceof Error?_0x26b2cd[_0x53d172(0x100)]:'Unknown\x20error'});}}async[a8_0x5e1ea3(0xb2)](_0x3e13b0,_0x51f47d){const _0x272bec=a8_0x5e1ea3;try{const {paymentId:_0x504049}=_0x3e13b0[_0x272bec(0xe1)];console['log'](_0x272bec(0xd5)+_0x504049);const _0x30d579=await database_1[_0x272bec(0xed)][_0x272bec(0xb1)][_0x272bec(0xbd)]({'where':{'id':_0x504049},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x30d579){_0x51f47d[_0x272bec(0x109)](0x194)[_0x272bec(0xdb)]({'success':![],'error':_0x272bec(0xd8)});return;}if(_0x30d579['gateway']!=='interac'&&_0x30d579['gateway']!=='sepa'){_0x51f47d[_0x272bec(0x109)](0x190)[_0x272bec(0xdb)]({'success':![],'error':_0x272bec(0xac)+_0x30d579[_0x272bec(0xb7)]});return;}let _0x8b6a6c='',_0x186404=_0x30d579[_0x272bec(0xd9)],_0x314c55='';if(_0x30d579['gateway']===_0x272bec(0xd6))_0x314c55='Interac\x20e-Transfer',_0x186404=_0x272bec(0xcc),_0x8b6a6c=_0x272bec(0xd0)+_0x30d579[_0x272bec(0x108)]+'\x20'+_0x186404+_0x272bec(0xd7);else _0x30d579[_0x272bec(0xb7)]===_0x272bec(0xd4)&&(_0x314c55=_0x272bec(0xc3),_0x186404=_0x272bec(0x102),_0x8b6a6c='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x30d579[_0x272bec(0x108)]+'\x20'+_0x186404+_0x272bec(0xd7));const _0x3042e3={'success':!![],'data':{'paymentId':_0x30d579['id'],'gateway':_0x30d579[_0x272bec(0xb7)],'gatewayName':_0x30d579[_0x272bec(0xb7)][_0x272bec(0xb0)](),'transferType':_0x314c55,'amount':_0x30d579[_0x272bec(0x108)],'currency':_0x186404,'status':_0x30d579[_0x272bec(0x109)],'instructions':_0x8b6a6c,'shopName':_0x30d579[_0x272bec(0xee)][_0x272bec(0xfb)]||_0x30d579[_0x272bec(0xee)][_0x272bec(0xc5)],'hasProof':![],'proofType':null,'createdAt':_0x30d579[_0x272bec(0x110)],'updatedAt':_0x30d579['updatedAt'],'supportedFileTypes':['PNG','JPG',_0x272bec(0xbf),_0x272bec(0xa5),'PDF'],'maxFileSize':_0x272bec(0xc1)}};_0x51f47d['json'](_0x3042e3);}catch(_0xa46cc8){console[_0x272bec(0xe6)]('‚ùå\x20Get\x20manual\x20payment\x20info\x20error:',_0xa46cc8),_0x51f47d[_0x272bec(0x109)](0x1f4)['json']({'success':![],'error':_0x272bec(0xea),'details':_0xa46cc8 instanceof Error?_0xa46cc8[_0x272bec(0x100)]:_0x272bec(0xd2)});}}}function a8_0x1874(_0x5c085a,_0x5bfc18){const _0xb634bf=a8_0xb634();return a8_0x1874=function(_0x1874d9,_0x4389e5){_0x1874d9=_0x1874d9-0xa3;let _0xb498c2=_0xb634bf[_0x1874d9];return _0xb498c2;},a8_0x1874(_0x5c085a,_0x5bfc18);}exports[a8_0x5e1ea3(0xde)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();