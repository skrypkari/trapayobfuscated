'use strict';const a10_0x24ca45=a10_0x4e20;function a10_0x4e20(_0xcecac6,_0x3e2742){_0xcecac6=_0xcecac6-0x1d7;const _0x3b3845=a10_0x3b38();let _0x4e200d=_0x3b3845[_0xcecac6];return _0x4e200d;}(function(_0x334db4,_0x58ff24){const _0x544d4b=a10_0x4e20,_0x26ee8c=_0x334db4();while(!![]){try{const _0x3cf7c4=-parseInt(_0x544d4b(0x1df))/0x1+-parseInt(_0x544d4b(0x1e4))/0x2+-parseInt(_0x544d4b(0x227))/0x3*(parseInt(_0x544d4b(0x1f4))/0x4)+-parseInt(_0x544d4b(0x1eb))/0x5*(parseInt(_0x544d4b(0x22b))/0x6)+parseInt(_0x544d4b(0x1e3))/0x7*(-parseInt(_0x544d4b(0x213))/0x8)+-parseInt(_0x544d4b(0x1de))/0x9+-parseInt(_0x544d4b(0x1f0))/0xa*(-parseInt(_0x544d4b(0x1e9))/0xb);if(_0x3cf7c4===_0x58ff24)break;else _0x26ee8c['push'](_0x26ee8c['shift']());}catch(_0x2653ae){_0x26ee8c['push'](_0x26ee8c['shift']());}}}(a10_0x3b38,0x7231f));var __importDefault=this&&this[a10_0x24ca45(0x20b)]||function(_0x5d296b){const _0x58de0f=a10_0x24ca45;return _0x5d296b&&_0x5d296b[_0x58de0f(0x229)]?_0x5d296b:{'default':_0x5d296b};};Object[a10_0x24ca45(0x231)](exports,a10_0x24ca45(0x229),{'value':!![]}),exports[a10_0x24ca45(0x219)]=exports[a10_0x24ca45(0x1ea)]=void 0x0;const database_1=__importDefault(require(a10_0x24ca45(0x225))),telegramBotService_1=require(a10_0x24ca45(0x22a));class ManualPaymentController{async[a10_0x24ca45(0x226)](_0x28128a,_0x8dce70){const _0x1d5589=a10_0x24ca45;try{const {paymentId:_0x2529e5,fileData:_0x6203de,fileType:_0x3114d9,fileName:_0x553e82}=_0x28128a['body'],_0xa28b2=_0x28128a['ip']||_0x28128a['connection']?.[_0x1d5589(0x203)]||_0x1d5589(0x228);console[_0x1d5589(0x217)]('ğŸ“¤\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x2529e5),console[_0x1d5589(0x217)](_0x1d5589(0x224)+_0x3114d9+_0x1d5589(0x205)+(_0x6203de?Math[_0x1d5589(0x1e8)](_0x6203de[_0x1d5589(0x235)]*0.75/0x400):0x0)+'KB'),console[_0x1d5589(0x217)](_0x1d5589(0x1e1)+_0xa28b2);if(!_0x2529e5){_0x8dce70[_0x1d5589(0x241)](0x190)[_0x1d5589(0x21c)]({'success':![],'error':_0x1d5589(0x1f8)});return;}if(!_0x6203de){_0x8dce70[_0x1d5589(0x241)](0x190)[_0x1d5589(0x21c)]({'success':![],'error':_0x1d5589(0x220)});return;}if(!_0x3114d9){_0x8dce70['status'](0x190)[_0x1d5589(0x21c)]({'success':![],'error':_0x1d5589(0x1ff)});return;}const _0x5401fb=[_0x1d5589(0x1dc),_0x1d5589(0x20c),_0x1d5589(0x1f2),_0x1d5589(0x208),_0x1d5589(0x215)],_0xa2ca97=_0x3114d9['toLowerCase']()[_0x1d5589(0x1ee)]('.','');if(!_0x5401fb['includes'](_0xa2ca97)){_0x8dce70['status'](0x190)[_0x1d5589(0x21c)]({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x3114d9+_0x1d5589(0x23d)+_0x5401fb[_0x1d5589(0x232)](',\x20')});return;}const _0x34444a=0xa*0x400*0x400;if(_0x6203de[_0x1d5589(0x235)]>_0x34444a){_0x8dce70[_0x1d5589(0x241)](0x190)[_0x1d5589(0x21c)]({'success':![],'error':_0x1d5589(0x216)});return;}const _0x2abfc2=await database_1[_0x1d5589(0x1ef)][_0x1d5589(0x23b)][_0x1d5589(0x1ec)]({'where':{'id':_0x2529e5},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2abfc2){console[_0x1d5589(0x217)](_0x1d5589(0x222)+_0x2529e5),_0x8dce70[_0x1d5589(0x241)](0x194)[_0x1d5589(0x21c)]({'success':![],'error':_0x1d5589(0x22f)});return;}if(_0x2abfc2['gateway']!=='interac'&&_0x2abfc2[_0x1d5589(0x211)]!==_0x1d5589(0x1d9)){console[_0x1d5589(0x217)]('âŒ\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20'+_0x2abfc2['gateway']),_0x8dce70[_0x1d5589(0x241)](0x190)[_0x1d5589(0x21c)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x2abfc2['gateway']});return;}let _0x2fed75=_0x6203de;_0x6203de[_0x1d5589(0x1e5)](',')&&(_0x2fed75=_0x6203de['split'](',')[0x1]);try{Buffer['from'](_0x2fed75,_0x1d5589(0x1fa));}catch(_0x35b098){_0x8dce70[_0x1d5589(0x241)](0x190)['json']({'success':![],'error':_0x1d5589(0x206)});return;}const _0x6ae850=await database_1[_0x1d5589(0x1ef)][_0x1d5589(0x23b)][_0x1d5589(0x21b)]({'where':{'id':_0x2529e5},'data':{'status':_0x1d5589(0x23f),'updatedAt':new Date()}});console[_0x1d5589(0x217)]('âœ…\x20Payment\x20proof\x20uploaded\x20successfully:'),console[_0x1d5589(0x217)](_0x1d5589(0x1e7)+_0x2529e5),console[_0x1d5589(0x217)](_0x1d5589(0x1f3)+_0x2abfc2[_0x1d5589(0x211)][_0x1d5589(0x23e)]()),console[_0x1d5589(0x217)](_0x1d5589(0x21d)+_0xa2ca97),console[_0x1d5589(0x217)]('\x20\x20\x20-\x20File\x20size:\x20'+Math[_0x1d5589(0x1e8)](_0x2fed75[_0x1d5589(0x235)]*0.75/0x400)+'KB'),console[_0x1d5589(0x217)](_0x1d5589(0x1f1));try{const _0x59c2f5=_0x2abfc2['gateway'][_0x1d5589(0x23e)](),_0x5afce8=_0x2abfc2[_0x1d5589(0x23a)][_0x1d5589(0x236)]||_0x2abfc2[_0x1d5589(0x23a)][_0x1d5589(0x204)],_0x4e0179=Math[_0x1d5589(0x1e8)](_0x2fed75[_0x1d5589(0x235)]*0.75/0x400),_0x3eab84=_0x1d5589(0x221)+_0x59c2f5+_0x1d5589(0x1fc)+('ğŸ’³\x20Payment\x20ID:\x20'+_0x2529e5+'\x0a')+('ğŸ’°\x20Amount:\x20'+_0x2abfc2['amount']+'\x20'+_0x2abfc2[_0x1d5589(0x243)]+'\x0a')+(_0x1d5589(0x21e)+_0xa2ca97[_0x1d5589(0x23e)]()+'\x20('+_0x4e0179+_0x1d5589(0x223))+'ğŸ“Š\x20Status:\x20PENDING\x20â†’\x20PROCESSING\x0a'+(_0x1d5589(0x200)+_0xa28b2+'\x0a\x0a')+_0x1d5589(0x1ed);await telegramBotService_1[_0x1d5589(0x20d)][_0x1d5589(0x1d8)](_0x2abfc2[_0x1d5589(0x20f)],_0x3eab84,{'parse_mode':_0x1d5589(0x234)});const _0x52620f=Buffer[_0x1d5589(0x1fd)](_0x2fed75,_0x1d5589(0x1fa)),_0x3a7478='payment_proof_'+_0x2529e5+'.'+_0xa2ca97;await telegramBotService_1[_0x1d5589(0x20d)][_0x1d5589(0x1e6)](_0x2abfc2[_0x1d5589(0x20f)],_0x52620f,_0x3a7478,'Payment\x20proof\x20for\x20'+_0x2529e5),console[_0x1d5589(0x217)](_0x1d5589(0x209));const _0x57d67d=_0x1d5589(0x1f6),_0x91c71f=_0x1d5589(0x221)+_0x59c2f5+_0x1d5589(0x20e)+('ğŸ’³\x20Payment\x20ID:\x20'+_0x2529e5+'\x0a')+(_0x1d5589(0x22c)+_0x5afce8+'\x0a')+(_0x1d5589(0x21f)+_0x2abfc2['amount']+'\x20'+_0x2abfc2['currency']+'\x0a')+(_0x1d5589(0x21e)+_0xa2ca97[_0x1d5589(0x23e)]()+'\x20('+_0x4e0179+'KB)\x0a')+'ğŸ“Š\x20Status:\x20PENDING\x20â†’\x20PROCESSING\x0a'+(_0x1d5589(0x200)+_0xa28b2+'\x0a\x0a')+_0x1d5589(0x20a);await telegramBotService_1['telegramBotService']['sendDirectMessage'](parseInt(_0x57d67d),_0x91c71f),await telegramBotService_1[_0x1d5589(0x20d)][_0x1d5589(0x22e)](parseInt(_0x57d67d),_0x52620f,_0x3a7478,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x2529e5),console['log'](_0x1d5589(0x1f5));}catch(_0xb3eda5){console[_0x1d5589(0x240)](_0x1d5589(0x1e0),_0xb3eda5);}_0x8dce70[_0x1d5589(0x21c)]({'success':!![],'message':_0x1d5589(0x1e2),'data':{'paymentId':_0x6ae850['id'],'status':_0x6ae850[_0x1d5589(0x241)],'gateway':_0x2abfc2[_0x1d5589(0x211)],'fileType':_0xa2ca97,'fileSize':Math[_0x1d5589(0x1e8)](_0x2fed75[_0x1d5589(0x235)]*0.75/0x400)+'KB','uploadedAt':_0x6ae850[_0x1d5589(0x242)]}});}catch(_0x58636f){console[_0x1d5589(0x240)](_0x1d5589(0x237),_0x58636f),_0x8dce70[_0x1d5589(0x241)](0x1f4)[_0x1d5589(0x21c)]({'success':![],'error':_0x1d5589(0x207),'details':_0x58636f instanceof Error?_0x58636f[_0x1d5589(0x1f7)]:_0x1d5589(0x210)});}}async[a10_0x24ca45(0x201)](_0x51575b,_0x1d34e6){const _0x4bf3b3=a10_0x24ca45;try{const {paymentId:_0x3a4d54}=_0x51575b[_0x4bf3b3(0x1f9)];console[_0x4bf3b3(0x217)](_0x4bf3b3(0x202)+_0x3a4d54);const _0x3765be=await database_1[_0x4bf3b3(0x1ef)][_0x4bf3b3(0x23b)]['findUnique']({'where':{'id':_0x3a4d54},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3765be){_0x1d34e6[_0x4bf3b3(0x241)](0x194)['json']({'success':![],'error':_0x4bf3b3(0x22f)});return;}if(_0x3765be[_0x4bf3b3(0x211)]!=='interac'&&_0x3765be[_0x4bf3b3(0x211)]!==_0x4bf3b3(0x1d9)){_0x1d34e6[_0x4bf3b3(0x241)](0x190)[_0x4bf3b3(0x21c)]({'success':![],'error':_0x4bf3b3(0x239)+_0x3765be[_0x4bf3b3(0x211)]});return;}let _0x14b745='',_0x301a3d=_0x3765be['currency'],_0x348313='';if(_0x3765be[_0x4bf3b3(0x211)]===_0x4bf3b3(0x1fe))_0x348313='Interac\x20e-Transfer',_0x301a3d=_0x4bf3b3(0x212),_0x14b745=_0x4bf3b3(0x218)+_0x3765be[_0x4bf3b3(0x230)]+'\x20'+_0x301a3d+_0x4bf3b3(0x23c);else _0x3765be[_0x4bf3b3(0x211)]==='sepa'&&(_0x348313=_0x4bf3b3(0x1db),_0x301a3d=_0x4bf3b3(0x1fb),_0x14b745=_0x4bf3b3(0x1dd)+_0x3765be['amount']+'\x20'+_0x301a3d+_0x4bf3b3(0x23c));const _0x22c263={'success':!![],'data':{'paymentId':_0x3765be['id'],'gateway':_0x3765be[_0x4bf3b3(0x211)],'gatewayName':_0x3765be[_0x4bf3b3(0x211)]['toUpperCase'](),'transferType':_0x348313,'amount':_0x3765be['amount'],'currency':_0x301a3d,'status':_0x3765be[_0x4bf3b3(0x241)],'instructions':_0x14b745,'shopName':_0x3765be[_0x4bf3b3(0x23a)][_0x4bf3b3(0x236)]||_0x3765be[_0x4bf3b3(0x23a)][_0x4bf3b3(0x204)],'hasProof':![],'proofType':null,'createdAt':_0x3765be[_0x4bf3b3(0x22d)],'updatedAt':_0x3765be[_0x4bf3b3(0x242)],'supportedFileTypes':[_0x4bf3b3(0x1da),'JPG',_0x4bf3b3(0x238),_0x4bf3b3(0x214),_0x4bf3b3(0x1d7)],'maxFileSize':_0x4bf3b3(0x21a)}};_0x1d34e6[_0x4bf3b3(0x21c)](_0x22c263);}catch(_0x220c43){console[_0x4bf3b3(0x240)](_0x4bf3b3(0x233),_0x220c43),_0x1d34e6['status'](0x1f4)[_0x4bf3b3(0x21c)]({'success':![],'error':_0x4bf3b3(0x207),'details':_0x220c43 instanceof Error?_0x220c43[_0x4bf3b3(0x1f7)]:'Unknown\x20error'});}}}exports[a10_0x24ca45(0x1ea)]=ManualPaymentController,exports[a10_0x24ca45(0x219)]=new ManualPaymentController();function a10_0x3b38(){const _0x2cf205=['PROCESSING','error','status','updatedAt','currency','PDF','sendShopNotification','sepa','PNG','SEPA\x20Bank\x20Transfer','png','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','5962824OhVYUA','9337SuYfZJ','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notifications:','ğŸŒ\x20Client\x20IP:\x20','Payment\x20proof\x20uploaded\x20successfully','21cjrnVO','1350112SbdAQs','includes','sendShopFile','\x20\x20\x20-\x20Payment\x20ID:\x20','round','1804kqOkgI','ManualPaymentController','602710SptfGk','findUnique','â³\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','replace','default','171830MlhkZm','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','jpeg','\x20\x20\x20-\x20Gateway:\x20','3540ExMaui','ğŸ“±\x20Admin\x20notification\x20and\x20file\x20sent','7867339505','message','Payment\x20ID\x20is\x20required','params','base64','EUR','\x20Payment\x20Proof\x20Received\x0a\x0a','from','interac','File\x20type\x20is\x20required','ğŸŒ\x20Customer\x20IP:\x20','getManualPaymentInfo','ğŸ“‹\x20Get\x20manual\x20payment\x20info:\x20','remoteAddress','username',',\x20size:\x20','Invalid\x20base64\x20file\x20data','Internal\x20server\x20error','heic','ğŸ“±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','âš ï¸\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','__importDefault','jpg','telegramBotService','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','shopId','Unknown\x20error','gateway','CAD','475568GORdmZ','HEIC','pdf','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','log','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','manualPaymentController','10MB','update','json','\x20\x20\x20-\x20File\x20type:\x20','ğŸ“\x20File:\x20','ğŸ’°\x20Amount:\x20','File\x20data\x20is\x20required','ğŸ”„\x20','âŒ\x20Payment\x20not\x20found:\x20','KB)\x0a','ğŸ“\x20File\x20type:\x20','../config/database','uploadPaymentProof','2388nLrZZx','unknown','__esModule','../services/telegramBotService','6TCSxKU','ğŸª\x20Shop:\x20','createdAt','sendDirectFile','Payment\x20not\x20found','amount','defineProperty','join','âŒ\x20Get\x20manual\x20payment\x20info\x20error:','Markdown','length','name','âŒ\x20Upload\x20payment\x20proof\x20error:','JPEG','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','shop','payment','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','.\x20Supported:\x20','toUpperCase'];a10_0x3b38=function(){return _0x2cf205;};return a10_0x3b38();}