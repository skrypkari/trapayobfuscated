'use strict';function a8_0x166e(_0x145561,_0x15b994){const _0x2fc897=a8_0x2fc8();return a8_0x166e=function(_0x166ede,_0x5c5cf9){_0x166ede=_0x166ede-0xbe;let _0x1487c3=_0x2fc897[_0x166ede];return _0x1487c3;},a8_0x166e(_0x145561,_0x15b994);}function a8_0x2fc8(){const _0x6c7d95=['shop','json','from','SEPA\x20Bank\x20Transfer','gateway','error','Payment\x20not\x20found','shopId','22543272BvJZni','HEIC','remoteAddress','heic','üîÑ\x20','params','connection',',\x20size:\x20','1813364iyIFLx','toLowerCase','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','3374412EBkAUw','Unsupported\x20file\x20type:\x20','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','telegramBotService','findUnique','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','JPEG','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','üè™\x20Shop:\x20','pdf','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','CAD','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','PDF','__esModule','Unknown\x20error','length','Payment\x20proof\x20for\x20','../config/database','unknown','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','20tGiWrO','includes','sendDirectMessage','message','PNG','Markdown','payment','JPG','\x20\x20\x20-\x20File\x20size:\x20','split','1577518YlMraE','üì±\x20Admin\x20notification\x20and\x20file\x20sent','File\x20type\x20is\x20required','KB)\x0a','\x20\x20\x20-\x20Gateway:\x20','PROCESSING','png','Payment\x20ID\x20is\x20required','default','10MB','join','update','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','updatedAt','interac','toUpperCase','round','manualPaymentController','üåê\x20Customer\x20IP:\x20','defineProperty','username','sepa','status','__importDefault','sendShopFile','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','log','Invalid\x20base64\x20file\x20data','Internal\x20server\x20error','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','currency','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','52296PzReHJ','amount','sendDirectFile','971379egxRmq','413bCODke','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','üí≥\x20Payment\x20ID:\x20','base64','\x20\x20\x20-\x20File\x20type:\x20','replace','üåê\x20Client\x20IP:\x20','jpeg','.\x20Supported:\x20','‚ùå\x20Upload\x20payment\x20proof\x20error:','Interac\x20e-Transfer','üìã\x20Get\x20manual\x20payment\x20info:\x20','sendShopNotification','906420YYMVfi','ManualPaymentController','üí∞\x20Amount:\x20','payment_proof_'];a8_0x2fc8=function(){return _0x6c7d95;};return a8_0x2fc8();}const a8_0x3ec276=a8_0x166e;(function(_0x633037,_0xaf1c2a){const _0x477a74=a8_0x166e,_0x43b8b2=_0x633037();while(!![]){try{const _0x2477ff=-parseInt(_0x477a74(0x108))/0x1+parseInt(_0x477a74(0xe4))/0x2+parseInt(_0x477a74(0x116))/0x3+parseInt(_0x477a74(0xc2))/0x4*(-parseInt(_0x477a74(0xda))/0x5)+parseInt(_0x477a74(0xc5))/0x6+-parseInt(_0x477a74(0x109))/0x7*(parseInt(_0x477a74(0x105))/0x8)+parseInt(_0x477a74(0x122))/0x9;if(_0x2477ff===_0xaf1c2a)break;else _0x43b8b2['push'](_0x43b8b2['shift']());}catch(_0x478087){_0x43b8b2['push'](_0x43b8b2['shift']());}}}(a8_0x2fc8,0xf1223));var __importDefault=this&&this[a8_0x3ec276(0xfc)]||function(_0x398bb7){const _0x51367e=a8_0x3ec276;return _0x398bb7&&_0x398bb7[_0x51367e(0xd3)]?_0x398bb7:{'default':_0x398bb7};};Object[a8_0x3ec276(0xf8)](exports,'__esModule',{'value':!![]}),exports[a8_0x3ec276(0xf6)]=exports[a8_0x3ec276(0x117)]=void 0x0;const database_1=__importDefault(require(a8_0x3ec276(0xd7))),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async['uploadPaymentProof'](_0x33b6f9,_0x1c08ce){const _0x114338=a8_0x3ec276;try{const {paymentId:_0x4dfb0c,fileData:_0x599a00,fileType:_0x6138b6,fileName:_0x5892f2}=_0x33b6f9['body'],_0x28f607=_0x33b6f9['ip']||_0x33b6f9[_0x114338(0xc0)]?.[_0x114338(0x124)]||_0x114338(0xd8);console['log'](_0x114338(0xcc)+_0x4dfb0c),console[_0x114338(0xff)]('üìÅ\x20File\x20type:\x20'+_0x6138b6+_0x114338(0xc1)+(_0x599a00?Math[_0x114338(0xf5)](_0x599a00[_0x114338(0xd5)]*0.75/0x400):0x0)+'KB'),console[_0x114338(0xff)](_0x114338(0x10f)+_0x28f607);if(!_0x4dfb0c){_0x1c08ce[_0x114338(0xfb)](0x190)[_0x114338(0x11b)]({'success':![],'error':_0x114338(0xeb)});return;}if(!_0x599a00){_0x1c08ce['status'](0x190)[_0x114338(0x11b)]({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x6138b6){_0x1c08ce['status'](0x190)[_0x114338(0x11b)]({'success':![],'error':_0x114338(0xe6)});return;}const _0x268506=[_0x114338(0xea),'jpg',_0x114338(0x110),_0x114338(0x125),_0x114338(0xce)],_0x3126c1=_0x6138b6[_0x114338(0xc3)]()[_0x114338(0x10e)]('.','');if(!_0x268506[_0x114338(0xdb)](_0x3126c1)){_0x1c08ce[_0x114338(0xfb)](0x190)[_0x114338(0x11b)]({'success':![],'error':_0x114338(0xc6)+_0x6138b6+_0x114338(0x111)+_0x268506[_0x114338(0xee)](',\x20')});return;}const _0x43d5c5=0xa*0x400*0x400;if(_0x599a00[_0x114338(0xd5)]>_0x43d5c5){_0x1c08ce[_0x114338(0xfb)](0x190)[_0x114338(0x11b)]({'success':![],'error':_0x114338(0x104)});return;}const _0x224374=await database_1[_0x114338(0xec)][_0x114338(0xe0)][_0x114338(0xc9)]({'where':{'id':_0x4dfb0c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x224374){console[_0x114338(0xff)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x4dfb0c),_0x1c08ce['status'](0x194)['json']({'success':![],'error':'Payment\x20not\x20found'});return;}if(_0x224374[_0x114338(0x11e)]!=='interac'&&_0x224374[_0x114338(0x11e)]!=='sepa'){console[_0x114338(0xff)](_0x114338(0x10a)+_0x224374[_0x114338(0x11e)]),_0x1c08ce[_0x114338(0xfb)](0x190)[_0x114338(0x11b)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x224374[_0x114338(0x11e)]});return;}let _0x375da=_0x599a00;_0x599a00[_0x114338(0xdb)](',')&&(_0x375da=_0x599a00[_0x114338(0xe3)](',')[0x1]);try{Buffer[_0x114338(0x11c)](_0x375da,_0x114338(0x10c));}catch(_0x2b7352){_0x1c08ce[_0x114338(0xfb)](0x190)[_0x114338(0x11b)]({'success':![],'error':_0x114338(0x100)});return;}const _0x193c8b=await database_1['default'][_0x114338(0xe0)][_0x114338(0xef)]({'where':{'id':_0x4dfb0c},'data':{'status':_0x114338(0xe9),'updatedAt':new Date()}});console[_0x114338(0xff)](_0x114338(0xc7)),console[_0x114338(0xff)]('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x4dfb0c),console[_0x114338(0xff)](_0x114338(0xe8)+_0x224374['gateway'][_0x114338(0xf4)]()),console[_0x114338(0xff)](_0x114338(0x10d)+_0x3126c1),console[_0x114338(0xff)](_0x114338(0xe2)+Math[_0x114338(0xf5)](_0x375da['length']*0.75/0x400)+'KB'),console['log'](_0x114338(0xfe));try{const _0x7b399f=_0x224374[_0x114338(0x11e)]['toUpperCase'](),_0x181145=_0x224374['shop']['name']||_0x224374['shop']['username'],_0xdba26a=Math[_0x114338(0xf5)](_0x375da[_0x114338(0xd5)]*0.75/0x400),_0x23bef6=_0x114338(0xbe)+_0x7b399f+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0x114338(0x10b)+_0x4dfb0c+'\x0a')+('üí∞\x20Amount:\x20'+_0x224374[_0x114338(0x106)]+'\x20'+_0x224374[_0x114338(0x103)]+'\x0a')+('üìÅ\x20File:\x20'+_0x3126c1['toUpperCase']()+'\x20('+_0xdba26a+_0x114338(0xe7))+_0x114338(0xc4)+(_0x114338(0xf7)+_0x28f607+'\x0a\x0a')+'‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1[_0x114338(0xc8)][_0x114338(0x115)](_0x224374['shopId'],_0x23bef6,{'parse_mode':_0x114338(0xdf)});const _0xf7f4d3=Buffer[_0x114338(0x11c)](_0x375da,_0x114338(0x10c)),_0x352960=_0x114338(0x119)+_0x4dfb0c+'.'+_0x3126c1;await telegramBotService_1[_0x114338(0xc8)][_0x114338(0xfd)](_0x224374[_0x114338(0x121)],_0xf7f4d3,_0x352960,_0x114338(0xd6)+_0x4dfb0c),console['log'](_0x114338(0xd9));const _0x38674f='7867339505',_0x5a5fc3=_0x114338(0xbe)+_0x7b399f+_0x114338(0x102)+(_0x114338(0x10b)+_0x4dfb0c+'\x0a')+(_0x114338(0xcd)+_0x181145+'\x0a')+(_0x114338(0x118)+_0x224374['amount']+'\x20'+_0x224374[_0x114338(0x103)]+'\x0a')+('üìÅ\x20File:\x20'+_0x3126c1[_0x114338(0xf4)]()+'\x20('+_0xdba26a+_0x114338(0xe7))+_0x114338(0xc4)+(_0x114338(0xf7)+_0x28f607+'\x0a\x0a')+_0x114338(0xf0);await telegramBotService_1[_0x114338(0xc8)][_0x114338(0xdc)](parseInt(_0x38674f),_0x5a5fc3),await telegramBotService_1[_0x114338(0xc8)][_0x114338(0x107)](parseInt(_0x38674f),_0xf7f4d3,_0x352960,_0x114338(0xca)+_0x4dfb0c),console[_0x114338(0xff)](_0x114338(0xe5));}catch(_0x9a461c){console[_0x114338(0x11f)]('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:',_0x9a461c);}_0x1c08ce[_0x114338(0x11b)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x193c8b['id'],'status':_0x193c8b[_0x114338(0xfb)],'gateway':_0x224374[_0x114338(0x11e)],'fileType':_0x3126c1,'fileSize':Math[_0x114338(0xf5)](_0x375da[_0x114338(0xd5)]*0.75/0x400)+'KB','uploadedAt':_0x193c8b[_0x114338(0xf2)]}});}catch(_0x5340c8){console[_0x114338(0x11f)](_0x114338(0x112),_0x5340c8),_0x1c08ce[_0x114338(0xfb)](0x1f4)['json']({'success':![],'error':_0x114338(0x101),'details':_0x5340c8 instanceof Error?_0x5340c8[_0x114338(0xdd)]:_0x114338(0xd4)});}}async['getManualPaymentInfo'](_0x25b036,_0x507c04){const _0x2a475c=a8_0x3ec276;try{const {paymentId:_0x4f7348}=_0x25b036[_0x2a475c(0xbf)];console[_0x2a475c(0xff)](_0x2a475c(0x114)+_0x4f7348);const _0x2677d5=await database_1['default']['payment'][_0x2a475c(0xc9)]({'where':{'id':_0x4f7348},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2677d5){_0x507c04['status'](0x194)[_0x2a475c(0x11b)]({'success':![],'error':_0x2a475c(0x120)});return;}if(_0x2677d5[_0x2a475c(0x11e)]!=='interac'&&_0x2677d5[_0x2a475c(0x11e)]!==_0x2a475c(0xfa)){_0x507c04['status'](0x190)['json']({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x2677d5[_0x2a475c(0x11e)]});return;}let _0x5aa47b='',_0x4a7d20=_0x2677d5['currency'],_0x453159='';if(_0x2677d5[_0x2a475c(0x11e)]===_0x2a475c(0xf3))_0x453159=_0x2a475c(0x113),_0x4a7d20=_0x2a475c(0xd0),_0x5aa47b='Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20'+_0x2677d5[_0x2a475c(0x106)]+'\x20'+_0x4a7d20+_0x2a475c(0xf1);else _0x2677d5[_0x2a475c(0x11e)]===_0x2a475c(0xfa)&&(_0x453159=_0x2a475c(0x11d),_0x4a7d20='EUR',_0x5aa47b=_0x2a475c(0xcf)+_0x2677d5['amount']+'\x20'+_0x4a7d20+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x4e44bd={'success':!![],'data':{'paymentId':_0x2677d5['id'],'gateway':_0x2677d5['gateway'],'gatewayName':_0x2677d5['gateway']['toUpperCase'](),'transferType':_0x453159,'amount':_0x2677d5[_0x2a475c(0x106)],'currency':_0x4a7d20,'status':_0x2677d5[_0x2a475c(0xfb)],'instructions':_0x5aa47b,'shopName':_0x2677d5[_0x2a475c(0x11a)]['name']||_0x2677d5[_0x2a475c(0x11a)][_0x2a475c(0xf9)],'hasProof':![],'proofType':null,'createdAt':_0x2677d5['createdAt'],'updatedAt':_0x2677d5['updatedAt'],'supportedFileTypes':[_0x2a475c(0xde),_0x2a475c(0xe1),_0x2a475c(0xcb),_0x2a475c(0x123),_0x2a475c(0xd2)],'maxFileSize':_0x2a475c(0xed)}};_0x507c04[_0x2a475c(0x11b)](_0x4e44bd);}catch(_0x18377e){console[_0x2a475c(0x11f)](_0x2a475c(0xd1),_0x18377e),_0x507c04['status'](0x1f4)['json']({'success':![],'error':_0x2a475c(0x101),'details':_0x18377e instanceof Error?_0x18377e['message']:'Unknown\x20error'});}}}exports[a8_0x3ec276(0x117)]=ManualPaymentController,exports[a8_0x3ec276(0xf6)]=new ManualPaymentController();