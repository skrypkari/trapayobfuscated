'use strict';const a8_0x40616e=a8_0x395e;(function(_0x44d5a4,_0x51817d){const _0x5aa567=a8_0x395e,_0x41d48a=_0x44d5a4();while(!![]){try{const _0x11ec6a=-parseInt(_0x5aa567(0x103))/0x1+parseInt(_0x5aa567(0xe7))/0x2+-parseInt(_0x5aa567(0xfe))/0x3*(-parseInt(_0x5aa567(0x106))/0x4)+-parseInt(_0x5aa567(0x10a))/0x5+-parseInt(_0x5aa567(0xf4))/0x6*(parseInt(_0x5aa567(0xf0))/0x7)+parseInt(_0x5aa567(0xfc))/0x8*(-parseInt(_0x5aa567(0xe3))/0x9)+parseInt(_0x5aa567(0x127))/0xa;if(_0x11ec6a===_0x51817d)break;else _0x41d48a['push'](_0x41d48a['shift']());}catch(_0x6864d0){_0x41d48a['push'](_0x41d48a['shift']());}}}(a8_0x2a02,0x4f72d));function a8_0x2a02(){const _0xc86f28=['\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','__esModule','3571040EpHsZk','sepa','7867339505','round','error','updatedAt','Payment\x20not\x20found','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','default','ManualPaymentController','shopId','telegramBotService','../config/database','üîÑ\x20','getManualPaymentInfo','üåê\x20Client\x20IP:\x20','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','‚ùå\x20Upload\x20payment\x20proof\x20error:','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','JPG','File\x20data\x20is\x20required','heic','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','findUnique','Invalid\x20base64\x20file\x20data','../services/telegramBotService','pdf','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','jpeg','4564737rPoQki','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','__importDefault','üí∞\x20Amount:\x20','698612VkYcNW','png','name','\x20\x20\x20-\x20Gateway:\x20','username','status','HEIC','üì±\x20Admin\x20notification\x20and\x20file\x20sent','gateway','2408dJumgu','üè™\x20Shop:\x20','Internal\x20server\x20error','Payment\x20proof\x20for\x20','6504rQjTlf','toUpperCase','length','includes','from','\x20\x20\x20-\x20Payment\x20ID:\x20','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','8yKLiTm','defineProperty','495OYqGaS','üåê\x20Customer\x20IP:\x20','sendDirectFile','replace','currency','15354ToSaMS','JPEG','unknown','14708AbOtJS','Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20','KB)\x0a','join','461255FXubVz','base64','interac','shop','File\x20type\x20is\x20required','SEPA\x20Bank\x20Transfer','connection','message','PROCESSING','amount','log','Unknown\x20error','json','PDF','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','body','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','uploadPaymentProof','üìÅ\x20File:\x20','sendShopFile','10MB','\x20\x20\x20-\x20File\x20size:\x20','payment','üí≥\x20Payment\x20ID:\x20','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','EUR','split'];a8_0x2a02=function(){return _0xc86f28;};return a8_0x2a02();}var __importDefault=this&&this[a8_0x40616e(0xe5)]||function(_0x40a485){const _0x5c22b1=a8_0x40616e;return _0x40a485&&_0x40a485[_0x5c22b1(0x126)]?_0x40a485:{'default':_0x40a485};};Object[a8_0x40616e(0xfd)](exports,a8_0x40616e(0x126),{'value':!![]}),exports['manualPaymentController']=exports[a8_0x40616e(0x130)]=void 0x0;function a8_0x395e(_0x49a32e,_0x496184){const _0x2a029e=a8_0x2a02();return a8_0x395e=function(_0x395e49,_0x34fb94){_0x395e49=_0x395e49-0xd7;let _0x3267a3=_0x2a029e[_0x395e49];return _0x3267a3;},a8_0x395e(_0x49a32e,_0x496184);}const database_1=__importDefault(require(a8_0x40616e(0x133))),telegramBotService_1=require(a8_0x40616e(0xde));class ManualPaymentController{async[a8_0x40616e(0x11b)](_0x5673b4,_0x4ba5e8){const _0x5a8bfe=a8_0x40616e;try{const {paymentId:_0x55ff72,fileData:_0x63ffff,fileType:_0x3ce448,fileName:_0x3203d3}=_0x5673b4[_0x5a8bfe(0x119)],_0x436347=_0x5673b4['ip']||_0x5673b4[_0x5a8bfe(0x110)]?.['remoteAddress']||_0x5a8bfe(0x105);console[_0x5a8bfe(0x114)]('üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20'+_0x55ff72),console[_0x5a8bfe(0x114)]('üìÅ\x20File\x20type:\x20'+_0x3ce448+',\x20size:\x20'+(_0x63ffff?Math[_0x5a8bfe(0x12a)](_0x63ffff[_0x5a8bfe(0xf6)]*0.75/0x400):0x0)+'KB'),console[_0x5a8bfe(0x114)](_0x5a8bfe(0x136)+_0x436347);if(!_0x55ff72){_0x4ba5e8[_0x5a8bfe(0xec)](0x190)['json']({'success':![],'error':'Payment\x20ID\x20is\x20required'});return;}if(!_0x63ffff){_0x4ba5e8['status'](0x190)['json']({'success':![],'error':_0x5a8bfe(0xd9)});return;}if(!_0x3ce448){_0x4ba5e8[_0x5a8bfe(0xec)](0x190)[_0x5a8bfe(0x116)]({'success':![],'error':_0x5a8bfe(0x10e)});return;}const _0x164f23=[_0x5a8bfe(0xe8),'jpg',_0x5a8bfe(0xe2),_0x5a8bfe(0xda),_0x5a8bfe(0xdf)],_0xd7c161=_0x3ce448['toLowerCase']()[_0x5a8bfe(0x101)]('.','');if(!_0x164f23[_0x5a8bfe(0xf7)](_0xd7c161)){_0x4ba5e8[_0x5a8bfe(0xec)](0x190)['json']({'success':![],'error':'Unsupported\x20file\x20type:\x20'+_0x3ce448+'.\x20Supported:\x20'+_0x164f23[_0x5a8bfe(0x109)](',\x20')});return;}const _0x59105c=0xa*0x400*0x400;if(_0x63ffff[_0x5a8bfe(0xf6)]>_0x59105c){_0x4ba5e8[_0x5a8bfe(0xec)](0x190)[_0x5a8bfe(0x116)]({'success':![],'error':_0x5a8bfe(0xe0)});return;}const _0x451de5=await database_1['default'][_0x5a8bfe(0x120)][_0x5a8bfe(0xdc)]({'where':{'id':_0x55ff72},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x451de5){console[_0x5a8bfe(0x114)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x55ff72),_0x4ba5e8[_0x5a8bfe(0xec)](0x194)[_0x5a8bfe(0x116)]({'success':![],'error':_0x5a8bfe(0x12d)});return;}if(_0x451de5[_0x5a8bfe(0xef)]!==_0x5a8bfe(0x10c)&&_0x451de5[_0x5a8bfe(0xef)]!==_0x5a8bfe(0x128)){console['log'](_0x5a8bfe(0xe1)+_0x451de5[_0x5a8bfe(0xef)]),_0x4ba5e8['status'](0x190)['json']({'success':![],'error':_0x5a8bfe(0x107)+_0x451de5[_0x5a8bfe(0xef)]});return;}let _0x188b53=_0x63ffff;_0x63ffff[_0x5a8bfe(0xf7)](',')&&(_0x188b53=_0x63ffff[_0x5a8bfe(0x124)](',')[0x1]);try{Buffer[_0x5a8bfe(0xf8)](_0x188b53,_0x5a8bfe(0x10b));}catch(_0x292a4f){_0x4ba5e8[_0x5a8bfe(0xec)](0x190)[_0x5a8bfe(0x116)]({'success':![],'error':_0x5a8bfe(0xdd)});return;}const _0x2c0fad=await database_1[_0x5a8bfe(0x12f)][_0x5a8bfe(0x120)]['update']({'where':{'id':_0x55ff72},'data':{'status':_0x5a8bfe(0x112),'updatedAt':new Date()}});console[_0x5a8bfe(0x114)](_0x5a8bfe(0x12e)),console[_0x5a8bfe(0x114)](_0x5a8bfe(0xf9)+_0x55ff72),console[_0x5a8bfe(0x114)](_0x5a8bfe(0xea)+_0x451de5[_0x5a8bfe(0xef)][_0x5a8bfe(0xf5)]()),console[_0x5a8bfe(0x114)]('\x20\x20\x20-\x20File\x20type:\x20'+_0xd7c161),console[_0x5a8bfe(0x114)](_0x5a8bfe(0x11f)+Math['round'](_0x188b53['length']*0.75/0x400)+'KB'),console[_0x5a8bfe(0x114)](_0x5a8bfe(0xfb));try{const _0x2503be=_0x451de5['gateway'][_0x5a8bfe(0xf5)](),_0x39b7a4=_0x451de5[_0x5a8bfe(0x10d)][_0x5a8bfe(0xe9)]||_0x451de5['shop'][_0x5a8bfe(0xeb)],_0x5bfd9b=Math['round'](_0x188b53[_0x5a8bfe(0xf6)]*0.75/0x400),_0x47fa81=_0x5a8bfe(0x134)+_0x2503be+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0x5a8bfe(0x121)+_0x55ff72+'\x0a')+(_0x5a8bfe(0xe6)+_0x451de5['amount']+'\x20'+_0x451de5[_0x5a8bfe(0x102)]+'\x0a')+('üìÅ\x20File:\x20'+_0xd7c161[_0x5a8bfe(0xf5)]()+'\x20('+_0x5bfd9b+_0x5a8bfe(0x108))+_0x5a8bfe(0x118)+('üåê\x20Customer\x20IP:\x20'+_0x436347+'\x0a\x0a')+'‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1['telegramBotService']['sendShopNotification'](_0x451de5['shopId'],_0x47fa81,{'parse_mode':'Markdown'});const _0x2946b3=Buffer[_0x5a8bfe(0xf8)](_0x188b53,'base64'),_0x2fb41a='payment_proof_'+_0x55ff72+'.'+_0xd7c161;await telegramBotService_1[_0x5a8bfe(0x132)][_0x5a8bfe(0x11d)](_0x451de5[_0x5a8bfe(0x131)],_0x2946b3,_0x2fb41a,_0x5a8bfe(0xf3)+_0x55ff72),console['log'](_0x5a8bfe(0xfa));const _0x18b235=_0x5a8bfe(0x129),_0x8b5fd3=_0x5a8bfe(0x134)+_0x2503be+_0x5a8bfe(0x137)+(_0x5a8bfe(0x121)+_0x55ff72+'\x0a')+(_0x5a8bfe(0xf1)+_0x39b7a4+'\x0a')+(_0x5a8bfe(0xe6)+_0x451de5[_0x5a8bfe(0x113)]+'\x20'+_0x451de5['currency']+'\x0a')+(_0x5a8bfe(0x11c)+_0xd7c161['toUpperCase']()+'\x20('+_0x5bfd9b+'KB)\x0a')+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x5a8bfe(0xff)+_0x436347+'\x0a\x0a')+_0x5a8bfe(0xd7);await telegramBotService_1[_0x5a8bfe(0x132)]['sendDirectMessage'](parseInt(_0x18b235),_0x8b5fd3),await telegramBotService_1[_0x5a8bfe(0x132)][_0x5a8bfe(0x100)](parseInt(_0x18b235),_0x2946b3,_0x2fb41a,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x55ff72),console[_0x5a8bfe(0x114)](_0x5a8bfe(0xee));}catch(_0xf7bb85){console['error'](_0x5a8bfe(0xdb),_0xf7bb85);}_0x4ba5e8[_0x5a8bfe(0x116)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x2c0fad['id'],'status':_0x2c0fad['status'],'gateway':_0x451de5[_0x5a8bfe(0xef)],'fileType':_0xd7c161,'fileSize':Math[_0x5a8bfe(0x12a)](_0x188b53['length']*0.75/0x400)+'KB','uploadedAt':_0x2c0fad[_0x5a8bfe(0x12c)]}});}catch(_0xc37e3){console[_0x5a8bfe(0x12b)](_0x5a8bfe(0x138),_0xc37e3),_0x4ba5e8[_0x5a8bfe(0xec)](0x1f4)[_0x5a8bfe(0x116)]({'success':![],'error':_0x5a8bfe(0xf2),'details':_0xc37e3 instanceof Error?_0xc37e3[_0x5a8bfe(0x111)]:_0x5a8bfe(0x115)});}}async[a8_0x40616e(0x135)](_0x19b003,_0x35c908){const _0x3c3cb6=a8_0x40616e;try{const {paymentId:_0x103fcb}=_0x19b003['params'];console[_0x3c3cb6(0x114)]('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x103fcb);const _0x480fdb=await database_1[_0x3c3cb6(0x12f)][_0x3c3cb6(0x120)][_0x3c3cb6(0xdc)]({'where':{'id':_0x103fcb},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x480fdb){_0x35c908[_0x3c3cb6(0xec)](0x194)['json']({'success':![],'error':_0x3c3cb6(0x12d)});return;}if(_0x480fdb['gateway']!=='interac'&&_0x480fdb[_0x3c3cb6(0xef)]!==_0x3c3cb6(0x128)){_0x35c908[_0x3c3cb6(0xec)](0x190)['json']({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x480fdb[_0x3c3cb6(0xef)]});return;}let _0x1f36fa='',_0x31703e=_0x480fdb[_0x3c3cb6(0x102)],_0xb45b8d='';if(_0x480fdb['gateway']===_0x3c3cb6(0x10c))_0xb45b8d='Interac\x20e-Transfer',_0x31703e='CAD',_0x1f36fa=_0x3c3cb6(0xe4)+_0x480fdb[_0x3c3cb6(0x113)]+'\x20'+_0x31703e+_0x3c3cb6(0x125);else _0x480fdb[_0x3c3cb6(0xef)]===_0x3c3cb6(0x128)&&(_0xb45b8d=_0x3c3cb6(0x10f),_0x31703e=_0x3c3cb6(0x123),_0x1f36fa=_0x3c3cb6(0x122)+_0x480fdb[_0x3c3cb6(0x113)]+'\x20'+_0x31703e+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x49833d={'success':!![],'data':{'paymentId':_0x480fdb['id'],'gateway':_0x480fdb['gateway'],'gatewayName':_0x480fdb[_0x3c3cb6(0xef)][_0x3c3cb6(0xf5)](),'transferType':_0xb45b8d,'amount':_0x480fdb[_0x3c3cb6(0x113)],'currency':_0x31703e,'status':_0x480fdb[_0x3c3cb6(0xec)],'instructions':_0x1f36fa,'shopName':_0x480fdb[_0x3c3cb6(0x10d)][_0x3c3cb6(0xe9)]||_0x480fdb[_0x3c3cb6(0x10d)][_0x3c3cb6(0xeb)],'hasProof':![],'proofType':null,'createdAt':_0x480fdb['createdAt'],'updatedAt':_0x480fdb[_0x3c3cb6(0x12c)],'supportedFileTypes':['PNG',_0x3c3cb6(0xd8),_0x3c3cb6(0x104),_0x3c3cb6(0xed),_0x3c3cb6(0x117)],'maxFileSize':_0x3c3cb6(0x11e)}};_0x35c908[_0x3c3cb6(0x116)](_0x49833d);}catch(_0x32c860){console[_0x3c3cb6(0x12b)](_0x3c3cb6(0x11a),_0x32c860),_0x35c908['status'](0x1f4)[_0x3c3cb6(0x116)]({'success':![],'error':_0x3c3cb6(0xf2),'details':_0x32c860 instanceof Error?_0x32c860[_0x3c3cb6(0x111)]:_0x3c3cb6(0x115)});}}}exports[a8_0x40616e(0x130)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();