'use strict';function a10_0x42d5(_0x4eb47e,_0x504d0a){_0x4eb47e=_0x4eb47e-0x158;const _0x2e39a9=a10_0x2e39();let _0x42d535=_0x2e39a9[_0x4eb47e];return _0x42d535;}function a10_0x2e39(){const _0x43c728=['from','params','../services/telegramBotService','Payment\x20proof\x20for\x20','defineProperty','Internal\x20server\x20error','getManualPaymentInfo','9860bvhsIF','üè™\x20Shop:\x20','ManualPaymentController','../config/database','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','File\x20type\x20is\x20required','132bENeEj','sepa','error','üìÅ\x20File\x20type:\x20','join','sendShopFile','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','CAD','‚ùå\x20Upload\x20payment\x20proof\x20error:','uploadPaymentProof','amount','\x20\x20\x20-\x20Gateway:\x20','log','‚ùå\x20Payment\x20not\x20found:\x20','pdf','.\x20Supported:\x20','payment_proof_','sendShopNotification','JPG','currency','üåê\x20Client\x20IP:\x20','interac','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','createdAt','png','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','Interac\x20e-Transfer','üåê\x20Customer\x20IP:\x20','Payment\x20ID\x20is\x20required','length','connection','Unknown\x20error','round','__esModule','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','Payment\x20not\x20found','\x20\x20\x20-\x20File\x20size:\x20','JPEG','manualPaymentController','__importDefault','update','message','split','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','121086GPNegv','üí∞\x20Amount:\x20','shopId','730571NmOutQ','PROCESSING','Markdown','findUnique','10MB','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','unknown','\x20\x20\x20-\x20File\x20type:\x20','Invalid\x20base64\x20file\x20data','name','toUpperCase','telegramBotService','\x20Payment\x20Proof\x20Received\x0a\x0a','jpg','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','payment','253295wrNoEy','155gwHkAZ','8016760mngBEy','\x20\x20\x20-\x20Payment\x20ID:\x20','json','gateway','Unsupported\x20file\x20type:\x20','remoteAddress','base64','PNG','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','sendDirectMessage','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','2350qcPrGb','‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','KB)\x0a','1528202xwyZPi','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','heic','default','updatedAt','üìÅ\x20File:\x20','status','üí≥\x20Payment\x20ID:\x20','üîÑ\x20','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','2267031klRMkW','SEPA\x20Bank\x20Transfer','username','includes','shop'];a10_0x2e39=function(){return _0x43c728;};return a10_0x2e39();}const a10_0xe3457f=a10_0x42d5;(function(_0x45412b,_0x545818){const _0x5079dc=a10_0x42d5,_0x2bbb0b=_0x45412b();while(!![]){try{const _0x475fee=-parseInt(_0x5079dc(0x194))/0x1+parseInt(_0x5079dc(0x1b5))/0x2+-parseInt(_0x5079dc(0x1bf))/0x3+parseInt(_0x5079dc(0x15e))/0x4*(-parseInt(_0x5079dc(0x1a5))/0x5)+parseInt(_0x5079dc(0x164))/0x6*(-parseInt(_0x5079dc(0x1a4))/0x7)+-parseInt(_0x5079dc(0x1a6))/0x8+-parseInt(_0x5079dc(0x191))/0x9*(-parseInt(_0x5079dc(0x1b1))/0xa);if(_0x475fee===_0x545818)break;else _0x2bbb0b['push'](_0x2bbb0b['shift']());}catch(_0x233b0d){_0x2bbb0b['push'](_0x2bbb0b['shift']());}}}(a10_0x2e39,0x89ee3));var __importDefault=this&&this[a10_0xe3457f(0x18c)]||function(_0x50d8e2){const _0x3c2b48=a10_0xe3457f;return _0x50d8e2&&_0x50d8e2[_0x3c2b48(0x185)]?_0x50d8e2:{'default':_0x50d8e2};};Object[a10_0xe3457f(0x15b)](exports,a10_0xe3457f(0x185),{'value':!![]}),exports[a10_0xe3457f(0x18b)]=exports[a10_0xe3457f(0x160)]=void 0x0;const database_1=__importDefault(require(a10_0xe3457f(0x161))),telegramBotService_1=require(a10_0xe3457f(0x159));class ManualPaymentController{async[a10_0xe3457f(0x16d)](_0x54edb5,_0x53c007){const _0x404faa=a10_0xe3457f;try{const {paymentId:_0x4fa50d,fileData:_0x3edf4c,fileType:_0x4921ac,fileName:_0x430d8d}=_0x54edb5['body'],_0x35d90=_0x54edb5['ip']||_0x54edb5[_0x404faa(0x182)]?.[_0x404faa(0x1ab)]||_0x404faa(0x19a);console[_0x404faa(0x170)](_0x404faa(0x187)+_0x4fa50d),console['log'](_0x404faa(0x167)+_0x4921ac+',\x20size:\x20'+(_0x3edf4c?Math[_0x404faa(0x184)](_0x3edf4c[_0x404faa(0x181)]*0.75/0x400):0x0)+'KB'),console['log'](_0x404faa(0x178)+_0x35d90);if(!_0x4fa50d){_0x53c007['status'](0x190)['json']({'success':![],'error':_0x404faa(0x180)});return;}if(!_0x3edf4c){_0x53c007['status'](0x190)[_0x404faa(0x1a8)]({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x4921ac){_0x53c007[_0x404faa(0x1bb)](0x190)[_0x404faa(0x1a8)]({'success':![],'error':_0x404faa(0x163)});return;}const _0x398376=[_0x404faa(0x17c),_0x404faa(0x1a1),'jpeg',_0x404faa(0x1b7),_0x404faa(0x172)],_0x3cceef=_0x4921ac['toLowerCase']()['replace']('.','');if(!_0x398376[_0x404faa(0x1c2)](_0x3cceef)){_0x53c007[_0x404faa(0x1bb)](0x190)[_0x404faa(0x1a8)]({'success':![],'error':_0x404faa(0x1aa)+_0x4921ac+_0x404faa(0x173)+_0x398376[_0x404faa(0x168)](',\x20')});return;}const _0x9aea8f=0xa*0x400*0x400;if(_0x3edf4c[_0x404faa(0x181)]>_0x9aea8f){_0x53c007[_0x404faa(0x1bb)](0x190)[_0x404faa(0x1a8)]({'success':![],'error':_0x404faa(0x1b3)});return;}const _0x4c15eb=await database_1['default']['payment'][_0x404faa(0x197)]({'where':{'id':_0x4fa50d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4c15eb){console[_0x404faa(0x170)](_0x404faa(0x171)+_0x4fa50d),_0x53c007[_0x404faa(0x1bb)](0x194)[_0x404faa(0x1a8)]({'success':![],'error':_0x404faa(0x188)});return;}if(_0x4c15eb[_0x404faa(0x1a9)]!==_0x404faa(0x179)&&_0x4c15eb[_0x404faa(0x1a9)]!==_0x404faa(0x165)){console[_0x404faa(0x170)](_0x404faa(0x17d)+_0x4c15eb[_0x404faa(0x1a9)]),_0x53c007[_0x404faa(0x1bb)](0x190)[_0x404faa(0x1a8)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x4c15eb['gateway']});return;}let _0x56c1ce=_0x3edf4c;_0x3edf4c['includes'](',')&&(_0x56c1ce=_0x3edf4c[_0x404faa(0x18f)](',')[0x1]);try{Buffer[_0x404faa(0x1c4)](_0x56c1ce,'base64');}catch(_0x54291a){_0x53c007[_0x404faa(0x1bb)](0x190)[_0x404faa(0x1a8)]({'success':![],'error':_0x404faa(0x19c)});return;}const _0x25861a=await database_1[_0x404faa(0x1b8)][_0x404faa(0x1a3)][_0x404faa(0x18d)]({'where':{'id':_0x4fa50d},'data':{'status':_0x404faa(0x195),'updatedAt':new Date()}});console[_0x404faa(0x170)](_0x404faa(0x1b2)),console[_0x404faa(0x170)](_0x404faa(0x1a7)+_0x4fa50d),console[_0x404faa(0x170)](_0x404faa(0x16f)+_0x4c15eb[_0x404faa(0x1a9)][_0x404faa(0x19e)]()),console[_0x404faa(0x170)](_0x404faa(0x19b)+_0x3cceef),console[_0x404faa(0x170)](_0x404faa(0x189)+Math[_0x404faa(0x184)](_0x56c1ce['length']*0.75/0x400)+'KB'),console[_0x404faa(0x170)]('\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING');try{const _0x21a63f=_0x4c15eb['gateway'][_0x404faa(0x19e)](),_0x5739da=_0x4c15eb[_0x404faa(0x1c3)][_0x404faa(0x19d)]||_0x4c15eb[_0x404faa(0x1c3)][_0x404faa(0x1c1)],_0x2aefbb=Math['round'](_0x56c1ce[_0x404faa(0x181)]*0.75/0x400),_0x388cde='üîÑ\x20'+_0x21a63f+_0x404faa(0x1a0)+(_0x404faa(0x1bc)+_0x4fa50d+'\x0a')+(_0x404faa(0x192)+_0x4c15eb[_0x404faa(0x16e)]+'\x20'+_0x4c15eb[_0x404faa(0x177)]+'\x0a')+(_0x404faa(0x1ba)+_0x3cceef[_0x404faa(0x19e)]()+'\x20('+_0x2aefbb+_0x404faa(0x1b4))+_0x404faa(0x1b0)+(_0x404faa(0x17f)+_0x35d90+'\x0a\x0a')+_0x404faa(0x186);await telegramBotService_1[_0x404faa(0x19f)][_0x404faa(0x175)](_0x4c15eb[_0x404faa(0x193)],_0x388cde,{'parse_mode':_0x404faa(0x196)});const _0x494396=Buffer[_0x404faa(0x1c4)](_0x56c1ce,_0x404faa(0x1ac)),_0xe7bed5=_0x404faa(0x174)+_0x4fa50d+'.'+_0x3cceef;await telegramBotService_1['telegramBotService'][_0x404faa(0x169)](_0x4c15eb[_0x404faa(0x193)],_0x494396,_0xe7bed5,_0x404faa(0x15a)+_0x4fa50d),console[_0x404faa(0x170)](_0x404faa(0x162));const _0x37f213='7867339505',_0x3c9712=_0x404faa(0x1bd)+_0x21a63f+_0x404faa(0x190)+(_0x404faa(0x1bc)+_0x4fa50d+'\x0a')+(_0x404faa(0x15f)+_0x5739da+'\x0a')+(_0x404faa(0x192)+_0x4c15eb['amount']+'\x20'+_0x4c15eb['currency']+'\x0a')+('üìÅ\x20File:\x20'+_0x3cceef[_0x404faa(0x19e)]()+'\x20('+_0x2aefbb+_0x404faa(0x1b4))+_0x404faa(0x1b0)+(_0x404faa(0x17f)+_0x35d90+'\x0a\x0a')+_0x404faa(0x1b6);await telegramBotService_1['telegramBotService'][_0x404faa(0x1af)](parseInt(_0x37f213),_0x3c9712),await telegramBotService_1['telegramBotService']['sendDirectFile'](parseInt(_0x37f213),_0x494396,_0xe7bed5,_0x404faa(0x199)+_0x4fa50d),console['log']('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x18e763){console[_0x404faa(0x166)](_0x404faa(0x1be),_0x18e763);}_0x53c007[_0x404faa(0x1a8)]({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x25861a['id'],'status':_0x25861a[_0x404faa(0x1bb)],'gateway':_0x4c15eb[_0x404faa(0x1a9)],'fileType':_0x3cceef,'fileSize':Math[_0x404faa(0x184)](_0x56c1ce[_0x404faa(0x181)]*0.75/0x400)+'KB','uploadedAt':_0x25861a[_0x404faa(0x1b9)]}});}catch(_0x25802b){console['error'](_0x404faa(0x16c),_0x25802b),_0x53c007['status'](0x1f4)[_0x404faa(0x1a8)]({'success':![],'error':_0x404faa(0x15c),'details':_0x25802b instanceof Error?_0x25802b[_0x404faa(0x18e)]:_0x404faa(0x183)});}}async[a10_0xe3457f(0x15d)](_0x243930,_0x2c4add){const _0x306af9=a10_0xe3457f;try{const {paymentId:_0x411131}=_0x243930[_0x306af9(0x158)];console[_0x306af9(0x170)]('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x411131);const _0x4ddd4c=await database_1[_0x306af9(0x1b8)]['payment'][_0x306af9(0x197)]({'where':{'id':_0x411131},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4ddd4c){_0x2c4add[_0x306af9(0x1bb)](0x194)[_0x306af9(0x1a8)]({'success':![],'error':_0x306af9(0x188)});return;}if(_0x4ddd4c[_0x306af9(0x1a9)]!==_0x306af9(0x179)&&_0x4ddd4c['gateway']!==_0x306af9(0x165)){_0x2c4add[_0x306af9(0x1bb)](0x190)[_0x306af9(0x1a8)]({'success':![],'error':_0x306af9(0x16a)+_0x4ddd4c[_0x306af9(0x1a9)]});return;}let _0x299936='',_0x2baf85=_0x4ddd4c[_0x306af9(0x177)],_0x2a1af7='';if(_0x4ddd4c[_0x306af9(0x1a9)]==='interac')_0x2a1af7=_0x306af9(0x17e),_0x2baf85=_0x306af9(0x16b),_0x299936=_0x306af9(0x1a2)+_0x4ddd4c[_0x306af9(0x16e)]+'\x20'+_0x2baf85+_0x306af9(0x1ae);else _0x4ddd4c[_0x306af9(0x1a9)]==='sepa'&&(_0x2a1af7=_0x306af9(0x1c0),_0x2baf85='EUR',_0x299936='Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20'+_0x4ddd4c['amount']+'\x20'+_0x2baf85+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x1a2d44={'success':!![],'data':{'paymentId':_0x4ddd4c['id'],'gateway':_0x4ddd4c[_0x306af9(0x1a9)],'gatewayName':_0x4ddd4c[_0x306af9(0x1a9)]['toUpperCase'](),'transferType':_0x2a1af7,'amount':_0x4ddd4c[_0x306af9(0x16e)],'currency':_0x2baf85,'status':_0x4ddd4c[_0x306af9(0x1bb)],'instructions':_0x299936,'shopName':_0x4ddd4c[_0x306af9(0x1c3)][_0x306af9(0x19d)]||_0x4ddd4c['shop'][_0x306af9(0x1c1)],'hasProof':![],'proofType':null,'createdAt':_0x4ddd4c[_0x306af9(0x17b)],'updatedAt':_0x4ddd4c['updatedAt'],'supportedFileTypes':[_0x306af9(0x1ad),_0x306af9(0x176),_0x306af9(0x18a),'HEIC','PDF'],'maxFileSize':_0x306af9(0x198)}};_0x2c4add[_0x306af9(0x1a8)](_0x1a2d44);}catch(_0x19fe59){console[_0x306af9(0x166)](_0x306af9(0x17a),_0x19fe59),_0x2c4add[_0x306af9(0x1bb)](0x1f4)[_0x306af9(0x1a8)]({'success':![],'error':_0x306af9(0x15c),'details':_0x19fe59 instanceof Error?_0x19fe59['message']:_0x306af9(0x183)});}}}exports[a10_0xe3457f(0x160)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();