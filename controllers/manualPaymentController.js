'use strict';const a9_0x1afb0e=a9_0x5d0a;(function(_0x2acdda,_0x30216d){const _0x53d7e6=a9_0x5d0a,_0x198dde=_0x2acdda();while(!![]){try{const _0x4a2584=-parseInt(_0x53d7e6(0xea))/0x1*(-parseInt(_0x53d7e6(0xeb))/0x2)+-parseInt(_0x53d7e6(0xc0))/0x3+-parseInt(_0x53d7e6(0xbf))/0x4*(parseInt(_0x53d7e6(0xe1))/0x5)+parseInt(_0x53d7e6(0xe0))/0x6+-parseInt(_0x53d7e6(0xd7))/0x7+parseInt(_0x53d7e6(0xe8))/0x8+parseInt(_0x53d7e6(0x10f))/0x9;if(_0x4a2584===_0x30216d)break;else _0x198dde['push'](_0x198dde['shift']());}catch(_0x52494c){_0x198dde['push'](_0x198dde['shift']());}}}(a9_0x2ad5,0x79243));var __importDefault=this&&this[a9_0x1afb0e(0x113)]||function(_0x4e5472){const _0x43ce6e=a9_0x1afb0e;return _0x4e5472&&_0x4e5472[_0x43ce6e(0xd9)]?_0x4e5472:{'default':_0x4e5472};};Object[a9_0x1afb0e(0xfb)](exports,a9_0x1afb0e(0xd9),{'value':!![]}),exports[a9_0x1afb0e(0xb7)]=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a9_0x1afb0e(0xc9));function a9_0x5d0a(_0xb96539,_0x4e0aa6){_0xb96539=_0xb96539-0xb6;const _0x2ad5fa=a9_0x2ad5();let _0x5d0ad9=_0x2ad5fa[_0xb96539];return _0x5d0ad9;}class ManualPaymentController{async[a9_0x1afb0e(0xfa)](_0x5b71dc,_0x52a22f){const _0x141a0d=a9_0x1afb0e;try{const {paymentId:_0x22f80c,fileData:_0x30a610,fileType:_0xc85819,fileName:_0x18277c}=_0x5b71dc['body'],_0x3fc5dc=_0x5b71dc['ip']||_0x5b71dc['connection']?.[_0x141a0d(0xdd)]||_0x141a0d(0x112);console[_0x141a0d(0xda)](_0x141a0d(0xc6)+_0x22f80c),console[_0x141a0d(0xda)](_0x141a0d(0xd8)+_0xc85819+_0x141a0d(0xca)+(_0x30a610?Math[_0x141a0d(0xed)](_0x30a610[_0x141a0d(0xfe)]*0.75/0x400):0x0)+'KB'),console[_0x141a0d(0xda)](_0x141a0d(0xbd)+_0x3fc5dc);if(!_0x22f80c){_0x52a22f[_0x141a0d(0xb6)](0x190)[_0x141a0d(0x101)]({'success':![],'error':_0x141a0d(0x111)});return;}if(!_0x30a610){_0x52a22f[_0x141a0d(0xb6)](0x190)[_0x141a0d(0x101)]({'success':![],'error':_0x141a0d(0xe6)});return;}if(!_0xc85819){_0x52a22f['status'](0x190)[_0x141a0d(0x101)]({'success':![],'error':_0x141a0d(0xc3)});return;}const _0x409888=[_0x141a0d(0x11c),_0x141a0d(0x10c),_0x141a0d(0x105),_0x141a0d(0x116),_0x141a0d(0xc2)],_0x151772=_0xc85819[_0x141a0d(0xce)]()[_0x141a0d(0xb8)]('.','');if(!_0x409888[_0x141a0d(0xdc)](_0x151772)){_0x52a22f['status'](0x190)[_0x141a0d(0x101)]({'success':![],'error':_0x141a0d(0x10b)+_0xc85819+_0x141a0d(0xf0)+_0x409888['join'](',\x20')});return;}const _0x5f25cc=0xa*0x400*0x400;if(_0x30a610['length']>_0x5f25cc){_0x52a22f['status'](0x190)[_0x141a0d(0x101)]({'success':![],'error':_0x141a0d(0xc5)});return;}const _0x5473db=await database_1[_0x141a0d(0x109)][_0x141a0d(0xc7)]['findUnique']({'where':{'id':_0x22f80c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5473db){console['log'](_0x141a0d(0xfc)+_0x22f80c),_0x52a22f[_0x141a0d(0xb6)](0x194)['json']({'success':![],'error':_0x141a0d(0xf3)});return;}if(_0x5473db[_0x141a0d(0xcd)]!==_0x141a0d(0x10d)&&_0x5473db[_0x141a0d(0xcd)]!=='sepa'){console[_0x141a0d(0xda)](_0x141a0d(0xdf)+_0x5473db[_0x141a0d(0xcd)]),_0x52a22f[_0x141a0d(0xb6)](0x190)[_0x141a0d(0x101)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x5473db[_0x141a0d(0xcd)]});return;}let _0x54c806=_0x30a610;_0x30a610[_0x141a0d(0xdc)](',')&&(_0x54c806=_0x30a610[_0x141a0d(0xd3)](',')[0x1]);try{Buffer[_0x141a0d(0xfd)](_0x54c806,'base64');}catch(_0x2a6e90){_0x52a22f[_0x141a0d(0xb6)](0x190)[_0x141a0d(0x101)]({'success':![],'error':_0x141a0d(0xc1)});return;}const _0x5b339f=await database_1[_0x141a0d(0x109)]['payment'][_0x141a0d(0x11d)]({'where':{'id':_0x22f80c},'data':{'status':'PROCESSING','updatedAt':new Date()}});console['log']('âœ…\x20Payment\x20proof\x20uploaded\x20successfully:'),console[_0x141a0d(0xda)]('\x20\x20\x20-\x20Payment\x20ID:\x20'+_0x22f80c),console[_0x141a0d(0xda)](_0x141a0d(0xcf)+_0x5473db[_0x141a0d(0xcd)][_0x141a0d(0xcb)]()),console['log'](_0x141a0d(0x11a)+_0x151772),console[_0x141a0d(0xda)](_0x141a0d(0xff)+Math['round'](_0x54c806[_0x141a0d(0xfe)]*0.75/0x400)+'KB'),console[_0x141a0d(0xda)](_0x141a0d(0xbe));try{const _0x593c36=_0x5473db[_0x141a0d(0xcd)]['toUpperCase'](),_0x5b5b84=_0x5473db['shop'][_0x141a0d(0xe7)]||_0x5473db[_0x141a0d(0x106)]['username'],_0x567f93=Math[_0x141a0d(0xed)](_0x54c806[_0x141a0d(0xfe)]*0.75/0x400),_0x174cc0=_0x141a0d(0x114)+_0x593c36+_0x141a0d(0xf9)+('ğŸ’³\x20Payment\x20ID:\x20'+_0x22f80c+'\x0a')+('ğŸ’°\x20Amount:\x20'+_0x5473db[_0x141a0d(0x108)]+'\x20'+_0x5473db[_0x141a0d(0xd2)]+'\x0a')+(_0x141a0d(0xd0)+_0x151772[_0x141a0d(0xcb)]()+'\x20('+_0x567f93+_0x141a0d(0xba))+_0x141a0d(0xef)+(_0x141a0d(0x10a)+_0x3fc5dc+'\x0a\x0a')+'â³\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...';await telegramBotService_1[_0x141a0d(0xe3)][_0x141a0d(0x102)](_0x5473db[_0x141a0d(0x103)],_0x174cc0,{'parse_mode':_0x141a0d(0x104)});const _0xc52e32=Buffer[_0x141a0d(0xfd)](_0x54c806,_0x141a0d(0xf5)),_0x2aa387='payment_proof_'+_0x22f80c+'.'+_0x151772;await telegramBotService_1['telegramBotService']['sendShopFile'](_0x5473db[_0x141a0d(0x103)],_0xc52e32,_0x2aa387,_0x141a0d(0xf4)+_0x22f80c),console[_0x141a0d(0xda)]('ğŸ“±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant');const _0x578d0c=_0x141a0d(0xbc),_0x489bf4=_0x141a0d(0x114)+_0x593c36+_0x141a0d(0x110)+(_0x141a0d(0xe4)+_0x22f80c+'\x0a')+(_0x141a0d(0xd4)+_0x5b5b84+'\x0a')+(_0x141a0d(0xd1)+_0x5473db['amount']+'\x20'+_0x5473db[_0x141a0d(0xd2)]+'\x0a')+(_0x141a0d(0xd0)+_0x151772[_0x141a0d(0xcb)]()+'\x20('+_0x567f93+'KB)\x0a')+_0x141a0d(0xef)+(_0x141a0d(0x10a)+_0x3fc5dc+'\x0a\x0a')+_0x141a0d(0x10e);await telegramBotService_1[_0x141a0d(0xe3)][_0x141a0d(0xe5)](parseInt(_0x578d0c),_0x489bf4),await telegramBotService_1['telegramBotService'][_0x141a0d(0xe2)](parseInt(_0x578d0c),_0xc52e32,_0x2aa387,_0x141a0d(0x107)+_0x22f80c),console[_0x141a0d(0xda)](_0x141a0d(0xe9));}catch(_0x5875d9){console[_0x141a0d(0x11b)](_0x141a0d(0xd6),_0x5875d9);}_0x52a22f[_0x141a0d(0x101)]({'success':!![],'message':_0x141a0d(0x115),'data':{'paymentId':_0x5b339f['id'],'status':_0x5b339f['status'],'gateway':_0x5473db[_0x141a0d(0xcd)],'fileType':_0x151772,'fileSize':Math[_0x141a0d(0xed)](_0x54c806[_0x141a0d(0xfe)]*0.75/0x400)+'KB','uploadedAt':_0x5b339f[_0x141a0d(0xb9)]}});}catch(_0x18d935){console[_0x141a0d(0x11b)](_0x141a0d(0xcc),_0x18d935),_0x52a22f[_0x141a0d(0xb6)](0x1f4)[_0x141a0d(0x101)]({'success':![],'error':_0x141a0d(0x100),'details':_0x18d935 instanceof Error?_0x18d935[_0x141a0d(0xc8)]:_0x141a0d(0x117)});}}async[a9_0x1afb0e(0x118)](_0x29b2a6,_0x54e852){const _0x52d3d7=a9_0x1afb0e;try{const {paymentId:_0x2c459f}=_0x29b2a6[_0x52d3d7(0xc4)];console[_0x52d3d7(0xda)](_0x52d3d7(0xf1)+_0x2c459f);const _0x58360f=await database_1[_0x52d3d7(0x109)][_0x52d3d7(0xc7)]['findUnique']({'where':{'id':_0x2c459f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x58360f){_0x54e852['status'](0x194)['json']({'success':![],'error':_0x52d3d7(0xf3)});return;}if(_0x58360f[_0x52d3d7(0xcd)]!=='interac'&&_0x58360f[_0x52d3d7(0xcd)]!==_0x52d3d7(0xf8)){_0x54e852[_0x52d3d7(0xb6)](0x190)[_0x52d3d7(0x101)]({'success':![],'error':_0x52d3d7(0xf6)+_0x58360f['gateway']});return;}let _0x27d1a2='',_0x56e9f0=_0x58360f['currency'],_0x146b9e='';if(_0x58360f[_0x52d3d7(0xcd)]==='interac')_0x146b9e='Interac\x20e-Transfer',_0x56e9f0=_0x52d3d7(0xde),_0x27d1a2=_0x52d3d7(0x119)+_0x58360f['amount']+'\x20'+_0x56e9f0+_0x52d3d7(0xf2);else _0x58360f[_0x52d3d7(0xcd)]===_0x52d3d7(0xf8)&&(_0x146b9e='SEPA\x20Bank\x20Transfer',_0x56e9f0=_0x52d3d7(0xec),_0x27d1a2=_0x52d3d7(0xd5)+_0x58360f['amount']+'\x20'+_0x56e9f0+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.');const _0x1b5ad0={'success':!![],'data':{'paymentId':_0x58360f['id'],'gateway':_0x58360f[_0x52d3d7(0xcd)],'gatewayName':_0x58360f['gateway'][_0x52d3d7(0xcb)](),'transferType':_0x146b9e,'amount':_0x58360f[_0x52d3d7(0x108)],'currency':_0x56e9f0,'status':_0x58360f[_0x52d3d7(0xb6)],'instructions':_0x27d1a2,'shopName':_0x58360f['shop']['name']||_0x58360f[_0x52d3d7(0x106)][_0x52d3d7(0xbb)],'hasProof':![],'proofType':null,'createdAt':_0x58360f['createdAt'],'updatedAt':_0x58360f[_0x52d3d7(0xb9)],'supportedFileTypes':['PNG',_0x52d3d7(0x11e),_0x52d3d7(0x11f),_0x52d3d7(0xdb),'PDF'],'maxFileSize':'10MB'}};_0x54e852['json'](_0x1b5ad0);}catch(_0x463b84){console['error'](_0x52d3d7(0xee),_0x463b84),_0x54e852[_0x52d3d7(0xb6)](0x1f4)['json']({'success':![],'error':'Internal\x20server\x20error','details':_0x463b84 instanceof Error?_0x463b84['message']:_0x52d3d7(0x117)});}}}exports[a9_0x1afb0e(0xf7)]=ManualPaymentController,exports[a9_0x1afb0e(0xb7)]=new ManualPaymentController();function a9_0x2ad5(){const _0x3716b6=['Internal\x20server\x20error','json','sendShopNotification','shopId','Markdown','jpeg','shop','Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20','amount','default','ğŸŒ\x20Customer\x20IP:\x20','Unsupported\x20file\x20type:\x20','jpg','interac','âš ï¸\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','13417200JPDCDK','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','Payment\x20ID\x20is\x20required','unknown','__importDefault','ğŸ”„\x20','Payment\x20proof\x20uploaded\x20successfully','heic','Unknown\x20error','getManualPaymentInfo','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','\x20\x20\x20-\x20File\x20type:\x20','error','png','update','JPG','JPEG','status','manualPaymentController','replace','updatedAt','KB)\x0a','username','7867339505','ğŸŒ\x20Client\x20IP:\x20','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','4etPDBy','2196075VElelv','Invalid\x20base64\x20file\x20data','pdf','File\x20type\x20is\x20required','params','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','ğŸ“¤\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','payment','message','../services/telegramBotService',',\x20size:\x20','toUpperCase','âŒ\x20Upload\x20payment\x20proof\x20error:','gateway','toLowerCase','\x20\x20\x20-\x20Gateway:\x20','ğŸ“\x20File:\x20','ğŸ’°\x20Amount:\x20','currency','split','ğŸª\x20Shop:\x20','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notifications:','6099884XppiLN','ğŸ“\x20File\x20type:\x20','__esModule','log','HEIC','includes','remoteAddress','CAD','âŒ\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','4081470TmhFBe','2070570swlqQB','sendDirectFile','telegramBotService','ğŸ’³\x20Payment\x20ID:\x20','sendDirectMessage','File\x20data\x20is\x20required','name','223384VBLFsK','ğŸ“±\x20Admin\x20notification\x20and\x20file\x20sent','104926gAeSlC','6xnSloF','EUR','round','âŒ\x20Get\x20manual\x20payment\x20info\x20error:','ğŸ“Š\x20Status:\x20PENDING\x20â†’\x20PROCESSING\x0a','.\x20Supported:\x20','ğŸ“‹\x20Get\x20manual\x20payment\x20info:\x20','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','Payment\x20not\x20found','Payment\x20proof\x20for\x20','base64','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','ManualPaymentController','sepa','\x20Payment\x20Proof\x20Received\x0a\x0a','uploadPaymentProof','defineProperty','âŒ\x20Payment\x20not\x20found:\x20','from','length','\x20\x20\x20-\x20File\x20size:\x20'];a9_0x2ad5=function(){return _0x3716b6;};return a9_0x2ad5();}