'use strict';const a9_0x21b893=a9_0x4f39;(function(_0x5b62cf,_0xa898e6){const _0x14c7d3=a9_0x4f39,_0x46ef55=_0x5b62cf();while(!![]){try{const _0x1ed38f=-parseInt(_0x14c7d3(0x201))/0x1*(-parseInt(_0x14c7d3(0x230))/0x2)+-parseInt(_0x14c7d3(0x224))/0x3+-parseInt(_0x14c7d3(0x209))/0x4+-parseInt(_0x14c7d3(0x210))/0x5+-parseInt(_0x14c7d3(0x1d9))/0x6*(-parseInt(_0x14c7d3(0x233))/0x7)+parseInt(_0x14c7d3(0x1fe))/0x8+-parseInt(_0x14c7d3(0x1db))/0x9*(-parseInt(_0x14c7d3(0x1fb))/0xa);if(_0x1ed38f===_0xa898e6)break;else _0x46ef55['push'](_0x46ef55['shift']());}catch(_0x28e97c){_0x46ef55['push'](_0x46ef55['shift']());}}}(a9_0x1f33,0xcbd19));var __importDefault=this&&this[a9_0x21b893(0x1e2)]||function(_0x42eb06){const _0x2757b5=a9_0x21b893;return _0x42eb06&&_0x42eb06[_0x2757b5(0x1fa)]?_0x42eb06:{'default':_0x42eb06};};function a9_0x1f33(){const _0x482468=['gateway','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','10MB','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','7867339505','üåê\x20Client\x20IP:\x20','Unsupported\x20file\x20type:\x20','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','Payment\x20proof\x20uploaded\x20successfully','2yEeNti','Internal\x20server\x20error','PDF','8561qmHqby','\x20\x20\x20-\x20File\x20size:\x20','telegramBotService','username','üí∞\x20Amount:\x20','png','getManualPaymentInfo','2694JEUcIv','amount','281493RWGVHX','Payment\x20not\x20found','findUnique','unknown','log','interac','default','__importDefault','sepa','json','PROCESSING','name','toUpperCase','JPG','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','Markdown','sendDirectMessage','File\x20type\x20is\x20required','\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING','shop','sendShopFile','error','JPEG','jpeg','defineProperty','\x20\x20\x20-\x20Payment\x20ID:\x20','updatedAt','shopId','Payment\x20proof\x20for\x20','jpg','uploadPaymentProof','__esModule','520SFTgdu','from','CAD','4084832uuuCHb','üìÅ\x20File\x20type:\x20','connection','1429243mBMXrg','üìÅ\x20File:\x20','includes','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','length','Payment\x20ID\x20is\x20required','üîÑ\x20','base64','3734448tfliYo','body','üí≥\x20Payment\x20ID:\x20','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','replace','üè™\x20Shop:\x20','üåê\x20Customer\x20IP:\x20','7736280APnlSK','round','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','message','heic','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','payment','ManualPaymentController','‚ùå\x20Upload\x20payment\x20proof\x20error:','Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20','toLowerCase','KB)\x0a','Invalid\x20base64\x20file\x20data','.\x20Supported:\x20','currency','‚ùå\x20Payment\x20not\x20found:\x20','Unknown\x20error','status','2399007xUjGJg'];a9_0x1f33=function(){return _0x482468;};return a9_0x1f33();}Object[a9_0x21b893(0x1f3)](exports,a9_0x21b893(0x1fa),{'value':!![]}),exports['manualPaymentController']=exports['ManualPaymentController']=void 0x0;const database_1=__importDefault(require('../config/database')),telegramBotService_1=require('../services/telegramBotService');class ManualPaymentController{async[a9_0x21b893(0x1f9)](_0x5bce13,_0x1d998c){const _0xa2a72d=a9_0x21b893;try{const {paymentId:_0x3254d2,fileData:_0x4af829,fileType:_0x25e3f1,fileName:_0x6303c1}=_0x5bce13[_0xa2a72d(0x20a)],_0x7d5e40=_0x5bce13['ip']||_0x5bce13[_0xa2a72d(0x200)]?.['remoteAddress']||_0xa2a72d(0x1de);console[_0xa2a72d(0x1df)](_0xa2a72d(0x22a)+_0x3254d2),console[_0xa2a72d(0x1df)](_0xa2a72d(0x1ff)+_0x25e3f1+',\x20size:\x20'+(_0x4af829?Math[_0xa2a72d(0x211)](_0x4af829[_0xa2a72d(0x205)]*0.75/0x400):0x0)+'KB'),console[_0xa2a72d(0x1df)](_0xa2a72d(0x22c)+_0x7d5e40);if(!_0x3254d2){_0x1d998c[_0xa2a72d(0x223)](0x190)[_0xa2a72d(0x1e4)]({'success':![],'error':_0xa2a72d(0x206)});return;}if(!_0x4af829){_0x1d998c[_0xa2a72d(0x223)](0x190)[_0xa2a72d(0x1e4)]({'success':![],'error':'File\x20data\x20is\x20required'});return;}if(!_0x25e3f1){_0x1d998c[_0xa2a72d(0x223)](0x190)[_0xa2a72d(0x1e4)]({'success':![],'error':_0xa2a72d(0x1ec)});return;}const _0x5789e5=[_0xa2a72d(0x238),_0xa2a72d(0x1f8),_0xa2a72d(0x1f2),_0xa2a72d(0x216),'pdf'],_0x4a6c51=_0x25e3f1[_0xa2a72d(0x21c)]()[_0xa2a72d(0x20d)]('.','');if(!_0x5789e5[_0xa2a72d(0x203)](_0x4a6c51)){_0x1d998c[_0xa2a72d(0x223)](0x190)[_0xa2a72d(0x1e4)]({'success':![],'error':_0xa2a72d(0x22d)+_0x25e3f1+_0xa2a72d(0x21f)+_0x5789e5['join'](',\x20')});return;}const _0x4ae822=0xa*0x400*0x400;if(_0x4af829['length']>_0x4ae822){_0x1d998c[_0xa2a72d(0x223)](0x190)[_0xa2a72d(0x1e4)]({'success':![],'error':_0xa2a72d(0x22e)});return;}const _0x5e2017=await database_1[_0xa2a72d(0x1e1)]['payment'][_0xa2a72d(0x1dd)]({'where':{'id':_0x3254d2},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5e2017){console[_0xa2a72d(0x1df)](_0xa2a72d(0x221)+_0x3254d2),_0x1d998c[_0xa2a72d(0x223)](0x194)['json']({'success':![],'error':_0xa2a72d(0x1dc)});return;}if(_0x5e2017[_0xa2a72d(0x225)]!==_0xa2a72d(0x1e0)&&_0x5e2017[_0xa2a72d(0x225)]!==_0xa2a72d(0x1e3)){console['log'](_0xa2a72d(0x227)+_0x5e2017[_0xa2a72d(0x225)]),_0x1d998c[_0xa2a72d(0x223)](0x190)[_0xa2a72d(0x1e4)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x5e2017[_0xa2a72d(0x225)]});return;}let _0x35a712=_0x4af829;_0x4af829['includes'](',')&&(_0x35a712=_0x4af829['split'](',')[0x1]);try{Buffer[_0xa2a72d(0x1fc)](_0x35a712,_0xa2a72d(0x208));}catch(_0x3a3e87){_0x1d998c[_0xa2a72d(0x223)](0x190)[_0xa2a72d(0x1e4)]({'success':![],'error':_0xa2a72d(0x21e)});return;}const _0xd3b7cf=await database_1['default']['payment']['update']({'where':{'id':_0x3254d2},'data':{'status':_0xa2a72d(0x1e5),'updatedAt':new Date()}});console[_0xa2a72d(0x1df)]('‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:'),console['log'](_0xa2a72d(0x1f4)+_0x3254d2),console[_0xa2a72d(0x1df)]('\x20\x20\x20-\x20Gateway:\x20'+_0x5e2017[_0xa2a72d(0x225)][_0xa2a72d(0x1e7)]()),console['log']('\x20\x20\x20-\x20File\x20type:\x20'+_0x4a6c51),console[_0xa2a72d(0x1df)](_0xa2a72d(0x234)+Math[_0xa2a72d(0x211)](_0x35a712[_0xa2a72d(0x205)]*0.75/0x400)+'KB'),console[_0xa2a72d(0x1df)](_0xa2a72d(0x1ed));try{const _0x2e9325=_0x5e2017[_0xa2a72d(0x225)][_0xa2a72d(0x1e7)](),_0x2f3f38=_0x5e2017[_0xa2a72d(0x1ee)]['name']||_0x5e2017[_0xa2a72d(0x1ee)][_0xa2a72d(0x236)],_0x5e54a6=Math['round'](_0x35a712[_0xa2a72d(0x205)]*0.75/0x400),_0xf9dbd1=_0xa2a72d(0x207)+_0x2e9325+'\x20Payment\x20Proof\x20Received\x0a\x0a'+(_0xa2a72d(0x20b)+_0x3254d2+'\x0a')+(_0xa2a72d(0x237)+_0x5e2017[_0xa2a72d(0x1da)]+'\x20'+_0x5e2017[_0xa2a72d(0x220)]+'\x0a')+(_0xa2a72d(0x202)+_0x4a6c51['toUpperCase']()+'\x20('+_0x5e54a6+_0xa2a72d(0x21d))+_0xa2a72d(0x1e9)+('üåê\x20Customer\x20IP:\x20'+_0x7d5e40+'\x0a\x0a')+_0xa2a72d(0x20c);await telegramBotService_1[_0xa2a72d(0x235)]['sendShopNotification'](_0x5e2017['shopId'],_0xf9dbd1,{'parse_mode':_0xa2a72d(0x1ea)});const _0xddadf9=Buffer[_0xa2a72d(0x1fc)](_0x35a712,'base64'),_0x48f3f5='payment_proof_'+_0x3254d2+'.'+_0x4a6c51;await telegramBotService_1[_0xa2a72d(0x235)][_0xa2a72d(0x1ef)](_0x5e2017[_0xa2a72d(0x1f6)],_0xddadf9,_0x48f3f5,_0xa2a72d(0x1f7)+_0x3254d2),console[_0xa2a72d(0x1df)](_0xa2a72d(0x213));const _0x4fb293=_0xa2a72d(0x22b),_0x15de74=_0xa2a72d(0x207)+_0x2e9325+'\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a'+('üí≥\x20Payment\x20ID:\x20'+_0x3254d2+'\x0a')+(_0xa2a72d(0x20e)+_0x2f3f38+'\x0a')+(_0xa2a72d(0x237)+_0x5e2017[_0xa2a72d(0x1da)]+'\x20'+_0x5e2017[_0xa2a72d(0x220)]+'\x0a')+(_0xa2a72d(0x202)+_0x4a6c51['toUpperCase']()+'\x20('+_0x5e54a6+_0xa2a72d(0x21d))+_0xa2a72d(0x1e9)+(_0xa2a72d(0x20f)+_0x7d5e40+'\x0a\x0a')+_0xa2a72d(0x204);await telegramBotService_1[_0xa2a72d(0x235)][_0xa2a72d(0x1eb)](parseInt(_0x4fb293),_0x15de74),await telegramBotService_1['telegramBotService']['sendDirectFile'](parseInt(_0x4fb293),_0xddadf9,_0x48f3f5,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x3254d2),console[_0xa2a72d(0x1df)]('üì±\x20Admin\x20notification\x20and\x20file\x20sent');}catch(_0x33c65c){console[_0xa2a72d(0x1f0)](_0xa2a72d(0x226),_0x33c65c);}_0x1d998c[_0xa2a72d(0x1e4)]({'success':!![],'message':_0xa2a72d(0x22f),'data':{'paymentId':_0xd3b7cf['id'],'status':_0xd3b7cf[_0xa2a72d(0x223)],'gateway':_0x5e2017[_0xa2a72d(0x225)],'fileType':_0x4a6c51,'fileSize':Math[_0xa2a72d(0x211)](_0x35a712[_0xa2a72d(0x205)]*0.75/0x400)+'KB','uploadedAt':_0xd3b7cf[_0xa2a72d(0x1f5)]}});}catch(_0x585399){console[_0xa2a72d(0x1f0)](_0xa2a72d(0x21a),_0x585399),_0x1d998c[_0xa2a72d(0x223)](0x1f4)[_0xa2a72d(0x1e4)]({'success':![],'error':_0xa2a72d(0x231),'details':_0x585399 instanceof Error?_0x585399[_0xa2a72d(0x215)]:'Unknown\x20error'});}}async[a9_0x21b893(0x239)](_0x1e5b52,_0x4834a9){const _0x2831f7=a9_0x21b893;try{const {paymentId:_0x160e83}=_0x1e5b52['params'];console['log']('üìã\x20Get\x20manual\x20payment\x20info:\x20'+_0x160e83);const _0x4e5ce4=await database_1['default'][_0x2831f7(0x218)][_0x2831f7(0x1dd)]({'where':{'id':_0x160e83},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4e5ce4){_0x4834a9[_0x2831f7(0x223)](0x194)['json']({'success':![],'error':_0x2831f7(0x1dc)});return;}if(_0x4e5ce4['gateway']!==_0x2831f7(0x1e0)&&_0x4e5ce4['gateway']!=='sepa'){_0x4834a9['status'](0x190)[_0x2831f7(0x1e4)]({'success':![],'error':_0x2831f7(0x21b)+_0x4e5ce4[_0x2831f7(0x225)]});return;}let _0x1a8f52='',_0x37bc55=_0x4e5ce4[_0x2831f7(0x220)],_0x3916d8='';if(_0x4e5ce4['gateway']==='interac')_0x3916d8='Interac\x20e-Transfer',_0x37bc55=_0x2831f7(0x1fd),_0x1a8f52=_0x2831f7(0x214)+_0x4e5ce4[_0x2831f7(0x1da)]+'\x20'+_0x37bc55+'\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.';else _0x4e5ce4[_0x2831f7(0x225)]==='sepa'&&(_0x3916d8='SEPA\x20Bank\x20Transfer',_0x37bc55='EUR',_0x1a8f52=_0x2831f7(0x212)+_0x4e5ce4[_0x2831f7(0x1da)]+'\x20'+_0x37bc55+_0x2831f7(0x229));const _0x4d5864={'success':!![],'data':{'paymentId':_0x4e5ce4['id'],'gateway':_0x4e5ce4[_0x2831f7(0x225)],'gatewayName':_0x4e5ce4['gateway']['toUpperCase'](),'transferType':_0x3916d8,'amount':_0x4e5ce4[_0x2831f7(0x1da)],'currency':_0x37bc55,'status':_0x4e5ce4[_0x2831f7(0x223)],'instructions':_0x1a8f52,'shopName':_0x4e5ce4[_0x2831f7(0x1ee)][_0x2831f7(0x1e6)]||_0x4e5ce4[_0x2831f7(0x1ee)]['username'],'hasProof':![],'proofType':null,'createdAt':_0x4e5ce4['createdAt'],'updatedAt':_0x4e5ce4[_0x2831f7(0x1f5)],'supportedFileTypes':['PNG',_0x2831f7(0x1e8),_0x2831f7(0x1f1),'HEIC',_0x2831f7(0x232)],'maxFileSize':_0x2831f7(0x228)}};_0x4834a9['json'](_0x4d5864);}catch(_0x5b1fad){console['error'](_0x2831f7(0x217),_0x5b1fad),_0x4834a9[_0x2831f7(0x223)](0x1f4)[_0x2831f7(0x1e4)]({'success':![],'error':_0x2831f7(0x231),'details':_0x5b1fad instanceof Error?_0x5b1fad[_0x2831f7(0x215)]:_0x2831f7(0x222)});}}}function a9_0x4f39(_0x3c224f,_0x28e1a9){_0x3c224f=_0x3c224f-0x1d9;const _0x1f33c1=a9_0x1f33();let _0x4f3902=_0x1f33c1[_0x3c224f];return _0x4f3902;}exports[a9_0x21b893(0x219)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();