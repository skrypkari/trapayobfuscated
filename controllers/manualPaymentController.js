'use strict';const a8_0x79bc9a=a8_0x3af6;(function(_0x55cd99,_0x3768f9){const _0x2bcba1=a8_0x3af6,_0x47f71e=_0x55cd99();while(!![]){try{const _0xca04d7=parseInt(_0x2bcba1(0x159))/0x1*(parseInt(_0x2bcba1(0x186))/0x2)+-parseInt(_0x2bcba1(0x188))/0x3*(-parseInt(_0x2bcba1(0x19e))/0x4)+-parseInt(_0x2bcba1(0x14a))/0x5*(-parseInt(_0x2bcba1(0x18b))/0x6)+-parseInt(_0x2bcba1(0x1a0))/0x7*(-parseInt(_0x2bcba1(0x18a))/0x8)+-parseInt(_0x2bcba1(0x197))/0x9*(-parseInt(_0x2bcba1(0x181))/0xa)+-parseInt(_0x2bcba1(0x185))/0xb*(-parseInt(_0x2bcba1(0x156))/0xc)+-parseInt(_0x2bcba1(0x195))/0xd;if(_0xca04d7===_0x3768f9)break;else _0x47f71e['push'](_0x47f71e['shift']());}catch(_0x19f99c){_0x47f71e['push'](_0x47f71e['shift']());}}}(a8_0x42cb,0x58a11));var __importDefault=this&&this[a8_0x79bc9a(0x17c)]||function(_0x42f338){return _0x42f338&&_0x42f338['__esModule']?_0x42f338:{'default':_0x42f338};};Object[a8_0x79bc9a(0x168)](exports,'__esModule',{'value':!![]}),exports[a8_0x79bc9a(0x141)]=exports[a8_0x79bc9a(0x17f)]=void 0x0;const database_1=__importDefault(require(a8_0x79bc9a(0x15d))),telegramBotService_1=require(a8_0x79bc9a(0x161));function a8_0x3af6(_0x290a71,_0x4fbb9){const _0x42cba1=a8_0x42cb();return a8_0x3af6=function(_0x3af60f,_0x2f0f96){_0x3af60f=_0x3af60f-0x13c;let _0x392bdb=_0x42cba1[_0x3af60f];return _0x392bdb;},a8_0x3af6(_0x290a71,_0x4fbb9);}function a8_0x42cb(){const _0x153e46=['jpg','Please\x20complete\x20an\x20Interac\x20e-Transfer\x20for\x20','‚ùå\x20Invalid\x20gateway\x20for\x20manual\x20payment:\x20','Payment\x20ID\x20is\x20required','4ByOmiH','File\x20data\x20is\x20required','1757qwkQBW','name','üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a','updatedAt','heic','from','CAD','shopId','Unsupported\x20file\x20type:\x20','üè™\x20Shop:\x20','File\x20type\x20is\x20required','\x20\x20\x20-\x20File\x20type:\x20','telegramBotService','Payment\x20proof\x20for\x20','manualPaymentController','üìã\x20Get\x20manual\x20payment\x20info:\x20','sendDirectMessage','sendShopNotification','üìÅ\x20File\x20type:\x20','message','currency','Invalid\x20base64\x20file\x20data','pdf','2075UEWcLZ','üì±\x20Notification\x20and\x20file\x20sent\x20to\x20merchant','log','7867339505','body','üìÅ\x20File:\x20','üåê\x20Client\x20IP:\x20','Markdown','png','shop','KB)\x0a','round','444qGRVMD',',\x20size:\x20','update','182933BFtpMv','payment','.\x20Supported:\x20','‚ùå\x20Get\x20manual\x20payment\x20info\x20error:','../config/database','\x20and\x20upload\x20a\x20screenshot\x20of\x20the\x20confirmation.','üì±\x20Admin\x20notification\x20and\x20file\x20sent','\x20\x20\x20-\x20Payment\x20ID:\x20','../services/telegramBotService','toUpperCase','Internal\x20server\x20error','\x20Payment\x20Proof\x20(Admin\x20Copy)\x0a\x0a','üí≥\x20Payment\x20ID:\x20','Unknown\x20error','interac','defineProperty','\x20\x20\x20-\x20File\x20size:\x20','üì§\x20Upload\x20payment\x20proof\x20request\x20for\x20payment:\x20','Payment\x20not\x20found','HEIC','üí∞\x20Amount:\x20','10MB','File\x20too\x20large.\x20Maximum\x20size:\x2010MB','toLowerCase','sepa','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notifications:','replace','JPEG','createdAt','includes','findUnique','remoteAddress','\x20Payment\x20Proof\x20Received\x0a\x0a','‚ö†Ô∏è\x20Please\x20verify\x20and\x20approve\x20this\x20payment\x20manually.','PNG','__importDefault','json','PDF','ManualPaymentController','length','570010oFqhTZ','JPG','username','params','195019PGIjLC','4KUJkxU','Please\x20complete\x20a\x20SEPA\x20bank\x20transfer\x20for\x20','292713OVmVIk','error','21944gQzGOI','4212xkclDX','üåê\x20Customer\x20IP:\x20','gateway','sendShopFile','uploadPaymentProof','sendDirectFile','status','default','üîÑ\x20','‚è≥\x20Payment\x20is\x20now\x20awaiting\x20manual\x20verification...','23311717mEroTg','EUR','9CoQxQI','amount','join'];a8_0x42cb=function(){return _0x153e46;};return a8_0x42cb();}class ManualPaymentController{async[a8_0x79bc9a(0x18f)](_0x4ed6de,_0x144987){const _0x35e18b=a8_0x79bc9a;try{const {paymentId:_0x38ed11,fileData:_0x216de1,fileType:_0x48be06,fileName:_0x42f2d2}=_0x4ed6de[_0x35e18b(0x14e)],_0x448c0b=_0x4ed6de['ip']||_0x4ed6de['connection']?.[_0x35e18b(0x178)]||'unknown';console['log'](_0x35e18b(0x16a)+_0x38ed11),console[_0x35e18b(0x14c)](_0x35e18b(0x145)+_0x48be06+_0x35e18b(0x157)+(_0x216de1?Math[_0x35e18b(0x155)](_0x216de1['length']*0.75/0x400):0x0)+'KB'),console['log'](_0x35e18b(0x150)+_0x448c0b);if(!_0x38ed11){_0x144987['status'](0x190)[_0x35e18b(0x17d)]({'success':![],'error':_0x35e18b(0x19d)});return;}if(!_0x216de1){_0x144987[_0x35e18b(0x191)](0x190)['json']({'success':![],'error':_0x35e18b(0x19f)});return;}if(!_0x48be06){_0x144987[_0x35e18b(0x191)](0x190)['json']({'success':![],'error':_0x35e18b(0x13d)});return;}const _0xa156dd=[_0x35e18b(0x152),_0x35e18b(0x19a),'jpeg',_0x35e18b(0x1a4),_0x35e18b(0x149)],_0x5b7f3f=_0x48be06[_0x35e18b(0x170)]()[_0x35e18b(0x173)]('.','');if(!_0xa156dd[_0x35e18b(0x176)](_0x5b7f3f)){_0x144987[_0x35e18b(0x191)](0x190)[_0x35e18b(0x17d)]({'success':![],'error':_0x35e18b(0x1a8)+_0x48be06+_0x35e18b(0x15b)+_0xa156dd[_0x35e18b(0x199)](',\x20')});return;}const _0x4f7e5d=0xa*0x400*0x400;if(_0x216de1[_0x35e18b(0x180)]>_0x4f7e5d){_0x144987['status'](0x190)[_0x35e18b(0x17d)]({'success':![],'error':_0x35e18b(0x16f)});return;}const _0x471af8=await database_1[_0x35e18b(0x192)]['payment'][_0x35e18b(0x177)]({'where':{'id':_0x38ed11},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x471af8){console['log']('‚ùå\x20Payment\x20not\x20found:\x20'+_0x38ed11),_0x144987['status'](0x194)[_0x35e18b(0x17d)]({'success':![],'error':_0x35e18b(0x16b)});return;}if(_0x471af8[_0x35e18b(0x18d)]!==_0x35e18b(0x167)&&_0x471af8['gateway']!==_0x35e18b(0x171)){console['log'](_0x35e18b(0x19c)+_0x471af8['gateway']),_0x144987[_0x35e18b(0x191)](0x190)[_0x35e18b(0x17d)]({'success':![],'error':'Manual\x20proof\x20upload\x20not\x20supported\x20for\x20gateway:\x20'+_0x471af8[_0x35e18b(0x18d)]});return;}let _0x313879=_0x216de1;_0x216de1[_0x35e18b(0x176)](',')&&(_0x313879=_0x216de1['split'](',')[0x1]);try{Buffer[_0x35e18b(0x1a5)](_0x313879,'base64');}catch(_0x2791a0){_0x144987['status'](0x190)[_0x35e18b(0x17d)]({'success':![],'error':_0x35e18b(0x148)});return;}const _0x320b34=await database_1[_0x35e18b(0x192)]['payment'][_0x35e18b(0x158)]({'where':{'id':_0x38ed11},'data':{'status':'PROCESSING','updatedAt':new Date()}});console[_0x35e18b(0x14c)]('‚úÖ\x20Payment\x20proof\x20uploaded\x20successfully:'),console[_0x35e18b(0x14c)](_0x35e18b(0x160)+_0x38ed11),console[_0x35e18b(0x14c)]('\x20\x20\x20-\x20Gateway:\x20'+_0x471af8['gateway'][_0x35e18b(0x162)]()),console[_0x35e18b(0x14c)](_0x35e18b(0x13e)+_0x5b7f3f),console[_0x35e18b(0x14c)](_0x35e18b(0x169)+Math[_0x35e18b(0x155)](_0x313879['length']*0.75/0x400)+'KB'),console[_0x35e18b(0x14c)]('\x20\x20\x20-\x20Status:\x20PENDING\x20->\x20PROCESSING');try{const _0xf24d04=_0x471af8[_0x35e18b(0x18d)][_0x35e18b(0x162)](),_0x3093ed=_0x471af8[_0x35e18b(0x153)][_0x35e18b(0x1a1)]||_0x471af8['shop'][_0x35e18b(0x183)],_0x92ed92=Math['round'](_0x313879['length']*0.75/0x400),_0x3ef48f=_0x35e18b(0x193)+_0xf24d04+_0x35e18b(0x179)+(_0x35e18b(0x165)+_0x38ed11+'\x0a')+(_0x35e18b(0x16d)+_0x471af8['amount']+'\x20'+_0x471af8['currency']+'\x0a')+(_0x35e18b(0x14f)+_0x5b7f3f['toUpperCase']()+'\x20('+_0x92ed92+_0x35e18b(0x154))+_0x35e18b(0x1a2)+(_0x35e18b(0x18c)+_0x448c0b+'\x0a\x0a')+_0x35e18b(0x194);await telegramBotService_1[_0x35e18b(0x13f)][_0x35e18b(0x144)](_0x471af8[_0x35e18b(0x1a7)],_0x3ef48f,{'parse_mode':_0x35e18b(0x151)});const _0x35e08d=Buffer[_0x35e18b(0x1a5)](_0x313879,'base64'),_0x5658f4='payment_proof_'+_0x38ed11+'.'+_0x5b7f3f;await telegramBotService_1[_0x35e18b(0x13f)][_0x35e18b(0x18e)](_0x471af8[_0x35e18b(0x1a7)],_0x35e08d,_0x5658f4,_0x35e18b(0x140)+_0x38ed11),console[_0x35e18b(0x14c)](_0x35e18b(0x14b));const _0x1dbebb=_0x35e18b(0x14d),_0x3f8b87='üîÑ\x20'+_0xf24d04+_0x35e18b(0x164)+(_0x35e18b(0x165)+_0x38ed11+'\x0a')+(_0x35e18b(0x13c)+_0x3093ed+'\x0a')+(_0x35e18b(0x16d)+_0x471af8['amount']+'\x20'+_0x471af8[_0x35e18b(0x147)]+'\x0a')+(_0x35e18b(0x14f)+_0x5b7f3f[_0x35e18b(0x162)]()+'\x20('+_0x92ed92+'KB)\x0a')+'üìä\x20Status:\x20PENDING\x20‚Üí\x20PROCESSING\x0a'+(_0x35e18b(0x18c)+_0x448c0b+'\x0a\x0a')+_0x35e18b(0x17a);await telegramBotService_1[_0x35e18b(0x13f)][_0x35e18b(0x143)](parseInt(_0x1dbebb),_0x3f8b87),await telegramBotService_1[_0x35e18b(0x13f)][_0x35e18b(0x190)](parseInt(_0x1dbebb),_0x35e08d,_0x5658f4,'Admin\x20copy\x20-\x20Payment\x20proof\x20for\x20'+_0x38ed11),console[_0x35e18b(0x14c)](_0x35e18b(0x15f));}catch(_0x2c7bd8){console['error'](_0x35e18b(0x172),_0x2c7bd8);}_0x144987['json']({'success':!![],'message':'Payment\x20proof\x20uploaded\x20successfully','data':{'paymentId':_0x320b34['id'],'status':_0x320b34[_0x35e18b(0x191)],'gateway':_0x471af8[_0x35e18b(0x18d)],'fileType':_0x5b7f3f,'fileSize':Math[_0x35e18b(0x155)](_0x313879['length']*0.75/0x400)+'KB','uploadedAt':_0x320b34[_0x35e18b(0x1a3)]}});}catch(_0x5a1738){console[_0x35e18b(0x189)]('‚ùå\x20Upload\x20payment\x20proof\x20error:',_0x5a1738),_0x144987[_0x35e18b(0x191)](0x1f4)[_0x35e18b(0x17d)]({'success':![],'error':_0x35e18b(0x163),'details':_0x5a1738 instanceof Error?_0x5a1738[_0x35e18b(0x146)]:_0x35e18b(0x166)});}}async['getManualPaymentInfo'](_0x2584d6,_0x25aca4){const _0x499f54=a8_0x79bc9a;try{const {paymentId:_0x155a39}=_0x2584d6[_0x499f54(0x184)];console['log'](_0x499f54(0x142)+_0x155a39);const _0x25c602=await database_1[_0x499f54(0x192)][_0x499f54(0x15a)][_0x499f54(0x177)]({'where':{'id':_0x155a39},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x25c602){_0x25aca4['status'](0x194)[_0x499f54(0x17d)]({'success':![],'error':_0x499f54(0x16b)});return;}if(_0x25c602[_0x499f54(0x18d)]!=='interac'&&_0x25c602[_0x499f54(0x18d)]!==_0x499f54(0x171)){_0x25aca4[_0x499f54(0x191)](0x190)[_0x499f54(0x17d)]({'success':![],'error':'Manual\x20payment\x20info\x20not\x20available\x20for\x20gateway:\x20'+_0x25c602['gateway']});return;}let _0x14b2bc='',_0x34af9b=_0x25c602[_0x499f54(0x147)],_0x15d8eb='';if(_0x25c602[_0x499f54(0x18d)]==='interac')_0x15d8eb='Interac\x20e-Transfer',_0x34af9b=_0x499f54(0x1a6),_0x14b2bc=_0x499f54(0x19b)+_0x25c602[_0x499f54(0x198)]+'\x20'+_0x34af9b+_0x499f54(0x15e);else _0x25c602[_0x499f54(0x18d)]===_0x499f54(0x171)&&(_0x15d8eb='SEPA\x20Bank\x20Transfer',_0x34af9b=_0x499f54(0x196),_0x14b2bc=_0x499f54(0x187)+_0x25c602['amount']+'\x20'+_0x34af9b+_0x499f54(0x15e));const _0x463d97={'success':!![],'data':{'paymentId':_0x25c602['id'],'gateway':_0x25c602[_0x499f54(0x18d)],'gatewayName':_0x25c602['gateway'][_0x499f54(0x162)](),'transferType':_0x15d8eb,'amount':_0x25c602[_0x499f54(0x198)],'currency':_0x34af9b,'status':_0x25c602[_0x499f54(0x191)],'instructions':_0x14b2bc,'shopName':_0x25c602[_0x499f54(0x153)][_0x499f54(0x1a1)]||_0x25c602['shop']['username'],'hasProof':![],'proofType':null,'createdAt':_0x25c602[_0x499f54(0x175)],'updatedAt':_0x25c602[_0x499f54(0x1a3)],'supportedFileTypes':[_0x499f54(0x17b),_0x499f54(0x182),_0x499f54(0x174),_0x499f54(0x16c),_0x499f54(0x17e)],'maxFileSize':_0x499f54(0x16e)}};_0x25aca4[_0x499f54(0x17d)](_0x463d97);}catch(_0x5278d8){console[_0x499f54(0x189)](_0x499f54(0x15c),_0x5278d8),_0x25aca4['status'](0x1f4)['json']({'success':![],'error':'Internal\x20server\x20error','details':_0x5278d8 instanceof Error?_0x5278d8[_0x499f54(0x146)]:'Unknown\x20error'});}}}exports[a8_0x79bc9a(0x17f)]=ManualPaymentController,exports['manualPaymentController']=new ManualPaymentController();