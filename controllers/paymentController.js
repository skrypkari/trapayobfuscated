'use strict';const a10_0x40dfa7=a10_0x278f;function a10_0x46aa(){const _0x532d56=['üí∞\x20Gateway\x20','failUrl','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','customerCountry','configurable','sendPaymentNotification','defineProperty','customerEmail',',\x20cannot\x20process','\x20\x20Original:\x20\x22','convertToUSDT','__importDefault','PaymentController','shop','webhookEvents','payment','../services/currencyService','update','sendPaymentStatusNotification','Failed\x20to\x20send\x20','1022030bSZeau','POST','customerIp','currency','updatedAt','sendShopWebhook','Payment\x20processed\x20successfully','FAILED','processMasterCardPayment','json','visaMasterCardService','user_agent','__esModule','\x20became\x20PAID,\x20updating\x20payment\x20link\x20counter','49539HeeuHg','number','currencyService','gatewayCommissionRate','startsWith','stringify','toLowerCase','2NfNegD','702960FxXkEn','../services/webhookService','PENDING','üí∞\x20Updated\x20merchant\x20balance\x20for\x20payment\x20','Card\x20payment\x20failed','\x20with\x20status\x20','\x20URLs:','üí≥\x20','failureMessage','Payment\x20failed','‚ùå\x20Payment\x20failed\x20with\x20message:\x20','Webhook\x20event\x20','createdAt','handleSuccessfulPayment','\x20->\x20','Payment\x20is\x20not\x20for\x20VISA/MasterCard\x20gateway','getGatewayCommission','updatePaymentCustomerDataPublic','updatePaymentCustomer','\x20payment\x20','../services/paymentLinkService','paymentService','threeds_url','1111','191875JAxFNT','1818584RqPzKP','../config/database','\x20\x20\x20Result\x20URL\x20(webhook):\x20','call','amountUSDT','898576SEZUfB','toFixed','__createBinding','üí≥\x20Saving\x20card\x20last\x204\x20digits:\x20****','hasOwnProperty','trim','body','üßπ\x20Customer\x20names\x20cleaned:','üí≥\x20Browser\x20IP:\x20','webhookLog','isArray','&payment_id=','parse','amountAfterGatewayCommissionUSDT','getOwnPropertyNames','toUpperCase','replace','VISA/MasterCard','findUnique','\x20processed:\x20','\x22\x20|\x20\x22','cardLast4','writable','102HcwMKz','includes','\x20payment:','log','paid','‚úÖ\x20Payment\x20link\x20counter\x20updated\x20for\x20','paidAt','visa','‚ùå\x20Payment\x20gateway\x20mismatch:\x20expected\x20\x27visa/mastercard\x27,\x20got\x20\x27','WebhookService','toISOString','updatePaymentStatus','üìà\x20','shopId','createPublicPayment','requires_3ds','resolve','webhookService','processCardPayment','üí≥\x20Processing\x20MasterCard\x20payment:\x20','gateway','\x20webhook\x20sent\x20to\x20','Payment\x20created\x20successfully','email','ms)','üí≥\x20Saving\x20MasterCard\x20gateway\x20payment\x20ID:\x20','params','\x20not\x20enabled\x20for\x20shop\x20','üí≥\x20Card\x20holder:\x20','gatewayPaymentId','Customer\x20data\x20updated\x20successfully','default','now','create','gateway_payment_id','first_name','customerUa','Payment\x20not\x20found','last_name','errorMessage','getPaymentById','üí≥\x20MasterCard\x20result:','webhookUrl','../services/gateways/mastercardService','amount','\x20USDT','getPaymentStatus','then','length','PAID','Payment\x20System/1.0\x20(','getOwnPropertyDescriptor','üí∞\x20Converting\x20','gatewayOrderId','154737VOdfEA','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','https://app.trapay.uk/payment/pending?id=','\x20\x20Cleaned:\x20\x20\x22','error','üí∞\x20Amount\x20after\x20gateway\x20commission:\x20','9mmYLjm','https://api.trapay.uk/api/webhooks/gateway/','\x20webhook:','status','Error\x20parsing\x20webhook\x20events:'];a10_0x46aa=function(){return _0x532d56;};return a10_0x46aa();}function a10_0x278f(_0x25837b,_0x3f3874){const _0x46aa92=a10_0x46aa();return a10_0x278f=function(_0x278fb2,_0xcf121b){_0x278fb2=_0x278fb2-0x171;let _0x4c5ebd=_0x46aa92[_0x278fb2];return _0x4c5ebd;},a10_0x278f(_0x25837b,_0x3f3874);}(function(_0x36d2ab,_0x30fc92){const _0xb76018=a10_0x278f,_0xc793fe=_0x36d2ab();while(!![]){try{const _0xbde3b6=parseInt(_0xb76018(0x1d7))/0x1+-parseInt(_0xb76018(0x1be))/0x2*(parseInt(_0xb76018(0x18a))/0x3)+parseInt(_0xb76018(0x1dd))/0x4+-parseInt(_0xb76018(0x1a9))/0x5+parseInt(_0xb76018(0x1f4))/0x6*(parseInt(_0xb76018(0x1b7))/0x7)+parseInt(_0xb76018(0x1d8))/0x8*(-parseInt(_0xb76018(0x190))/0x9)+parseInt(_0xb76018(0x1bf))/0xa;if(_0xbde3b6===_0x30fc92)break;else _0xc793fe['push'](_0xc793fe['shift']());}catch(_0x188062){_0xc793fe['push'](_0xc793fe['shift']());}}}(a10_0x46aa,0x1e3a8));var __createBinding=this&&this[a10_0x40dfa7(0x1df)]||(Object[a10_0x40dfa7(0x175)]?function(_0x4a3a0f,_0x3c9383,_0x3ad1ad,_0x20c77e){const _0x310fda=a10_0x40dfa7;if(_0x20c77e===undefined)_0x20c77e=_0x3ad1ad;var _0x174e90=Object[_0x310fda(0x187)](_0x3c9383,_0x3ad1ad);(!_0x174e90||('get'in _0x174e90?!_0x3c9383[_0x310fda(0x1b5)]:_0x174e90[_0x310fda(0x1f3)]||_0x174e90[_0x310fda(0x199)]))&&(_0x174e90={'enumerable':!![],'get':function(){return _0x3c9383[_0x3ad1ad];}}),Object['defineProperty'](_0x4a3a0f,_0x20c77e,_0x174e90);}:function(_0x184856,_0x15ccd2,_0x57b1c8,_0x433fdc){if(_0x433fdc===undefined)_0x433fdc=_0x57b1c8;_0x184856[_0x433fdc]=_0x15ccd2[_0x57b1c8];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a10_0x40dfa7(0x175)]?function(_0xf4fd4d,_0x16e17f){const _0x2ad756=a10_0x40dfa7;Object['defineProperty'](_0xf4fd4d,_0x2ad756(0x173),{'enumerable':!![],'value':_0x16e17f});}:function(_0xe07430,_0x4976bd){const _0x27b816=a10_0x40dfa7;_0xe07430[_0x27b816(0x173)]=_0x4976bd;}),__importStar=this&&this['__importStar']||(function(){var _0xfa559b=function(_0x1dabd7){const _0x5cb2fe=a10_0x278f;return _0xfa559b=Object[_0x5cb2fe(0x1eb)]||function(_0x2a7406){const _0xc48c1f=_0x5cb2fe;var _0x584547=[];for(var _0x43d0d7 in _0x2a7406)if(Object['prototype'][_0xc48c1f(0x1e1)][_0xc48c1f(0x1db)](_0x2a7406,_0x43d0d7))_0x584547[_0x584547[_0xc48c1f(0x184)]]=_0x43d0d7;return _0x584547;},_0xfa559b(_0x1dabd7);};return function(_0x26018b){const _0xb1ec29=a10_0x278f;if(_0x26018b&&_0x26018b[_0xb1ec29(0x1b5)])return _0x26018b;var _0x5d94b4={};if(_0x26018b!=null){for(var _0x18d66a=_0xfa559b(_0x26018b),_0x5b26e4=0x0;_0x5b26e4<_0x18d66a[_0xb1ec29(0x184)];_0x5b26e4++)if(_0x18d66a[_0x5b26e4]!==_0xb1ec29(0x173))__createBinding(_0x5d94b4,_0x26018b,_0x18d66a[_0x5b26e4]);}return __setModuleDefault(_0x5d94b4,_0x26018b),_0x5d94b4;};}()),__importDefault=this&&this[a10_0x40dfa7(0x1a0)]||function(_0x5f22e7){const _0xb8dbfe=a10_0x40dfa7;return _0x5f22e7&&_0x5f22e7[_0xb8dbfe(0x1b5)]?_0x5f22e7:{'default':_0x5f22e7};};Object[a10_0x40dfa7(0x19b)](exports,a10_0x40dfa7(0x1b5),{'value':!![]}),exports[a10_0x40dfa7(0x1a1)]=void 0x0;const paymentService_1=require('../services/paymentService'),mastercardService_1=require(a10_0x40dfa7(0x17f)),webhookService_1=require(a10_0x40dfa7(0x1c0)),currencyService_1=require(a10_0x40dfa7(0x1a5)),database_1=__importDefault(require(a10_0x40dfa7(0x1d9)));class PaymentController{constructor(){const _0x292146=a10_0x40dfa7;this[_0x292146(0x202)]=async(_0x2111ad,_0x196254,_0x26ebe9)=>{const _0x4cb233=_0x292146;try{const _0x4f2a07=_0x2111ad[_0x4cb233(0x1e3)],_0x4e4513=await this['paymentService'][_0x4cb233(0x202)](_0x4f2a07);_0x196254['status'](0xc9)[_0x4cb233(0x1b2)]({'success':!![],'message':_0x4cb233(0x20a),'result':_0x4e4513});}catch(_0x2b152a){_0x26ebe9(_0x2b152a);}},this[_0x292146(0x182)]=async(_0x20a58e,_0x23fc25,_0x2ce7f1)=>{const _0xf5eecc=_0x292146;try{const {id:_0x316207}=_0x20a58e[_0xf5eecc(0x20e)],_0x44e206=await this[_0xf5eecc(0x1d4)][_0xf5eecc(0x182)](_0x316207);if(!_0x44e206)return _0x23fc25[_0xf5eecc(0x193)](0x194)[_0xf5eecc(0x1b2)]({'success':![],'message':_0xf5eecc(0x179)});_0x23fc25['json']({'success':!![],'result':_0x44e206});}catch(_0x56a156){_0x2ce7f1(_0x56a156);}},this[_0x292146(0x17c)]=async(_0x45233b,_0x2ce222,_0x481317)=>{const _0x1a6d44=_0x292146;try{const {id:_0x34baa1}=_0x45233b[_0x1a6d44(0x20e)],_0x38ffe=await this['paymentService'][_0x1a6d44(0x17c)](_0x34baa1);if(!_0x38ffe)return _0x2ce222['status'](0x194)[_0x1a6d44(0x1b2)]({'success':![],'message':_0x1a6d44(0x179)});_0x2ce222[_0x1a6d44(0x1b2)]({'success':!![],'result':_0x38ffe});}catch(_0x2ebb40){_0x481317(_0x2ebb40);}},this[_0x292146(0x1d1)]=async(_0x306470,_0x4d0ffe,_0x232a74)=>{const _0x46eacb=_0x292146;try{const {id:_0x3fc5c0}=_0x306470['params'],_0x2a2cfa=_0x306470['body'];console[_0x46eacb(0x1f7)]('üîÑ\x20Updating\x20customer\x20data\x20for\x20payment:\x20'+_0x3fc5c0),console['log']('üìù\x20Customer\x20data:',_0x2a2cfa);const _0x97ad78=await this[_0x46eacb(0x1d4)][_0x46eacb(0x1d0)](_0x3fc5c0,_0x2a2cfa);if(!_0x97ad78)return _0x4d0ffe['status'](0x194)[_0x46eacb(0x1b2)]({'success':![],'message':_0x46eacb(0x179)});_0x4d0ffe[_0x46eacb(0x1b2)]({'success':!![],'message':_0x46eacb(0x172),'result':{'paymentId':_0x97ad78['id'],'customerIp':_0x97ad78[_0x46eacb(0x1ab)],'customerUa':_0x97ad78[_0x46eacb(0x178)],'customerCountry':_0x97ad78[_0x46eacb(0x198)],'updatedAt':_0x97ad78[_0x46eacb(0x1ad)]}});}catch(_0x29c61f){_0x232a74(_0x29c61f);}},this[_0x292146(0x1b1)]=async(_0x5d5ee2,_0x44a923,_0x20e80d)=>{const _0x23ba3a=_0x292146;try{const {id:_0x3013f1}=_0x5d5ee2[_0x23ba3a(0x20e)],{cardData:_0x1ae221,cardHolder:_0x492c7c,browser:_0x58edf7}=_0x5d5ee2[_0x23ba3a(0x1e3)];console[_0x23ba3a(0x1f7)](_0x23ba3a(0x207)+_0x3013f1),console[_0x23ba3a(0x1f7)](_0x23ba3a(0x210)+_0x492c7c['first_name']+'\x20'+_0x492c7c[_0x23ba3a(0x17a)]+'\x20('+_0x492c7c['email']+')'),console[_0x23ba3a(0x1f7)](_0x23ba3a(0x1e5)+_0x58edf7['ip']);const _0x559136=_0x492c7c[_0x23ba3a(0x177)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x23ba3a(0x1e2)]()||'',_0x34c00f=_0x492c7c['last_name']?.[_0x23ba3a(0x1ed)](/[\t\n\r\f\v]/g,'\x20')[_0x23ba3a(0x1e2)]()||'';console[_0x23ba3a(0x1f7)](_0x23ba3a(0x1e4)),console[_0x23ba3a(0x1f7)](_0x23ba3a(0x19e)+_0x492c7c[_0x23ba3a(0x177)]+'\x22\x20|\x20\x22'+_0x492c7c[_0x23ba3a(0x17a)]+'\x22'),console['log'](_0x23ba3a(0x18d)+_0x559136+_0x23ba3a(0x1f1)+_0x34c00f+'\x22');const _0x3d6ec9={'customerName':_0x559136+'\x20'+_0x34c00f,'customerEmail':_0x492c7c[_0x23ba3a(0x20b)],'customerIp':_0x58edf7['ip'],'customerUa':_0x58edf7[_0x23ba3a(0x1b4)]},_0x36b43c=await database_1[_0x23ba3a(0x173)]['payment'][_0x23ba3a(0x1ef)]({'where':{'id':_0x3013f1},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x36b43c)return _0x44a923[_0x23ba3a(0x193)](0x194)[_0x23ba3a(0x1b2)]({'success':![],'message':_0x23ba3a(0x179)});if(_0x36b43c['gateway']!=='visa/mastercard')return console[_0x23ba3a(0x1f7)](_0x23ba3a(0x1fc)+_0x36b43c['gateway']+'\x27'),_0x44a923['status'](0x190)[_0x23ba3a(0x1b2)]({'success':![],'message':_0x23ba3a(0x1ce)});if(_0x36b43c['status']!==_0x23ba3a(0x1c1))return _0x44a923['status'](0x190)[_0x23ba3a(0x1b2)]({'success':![],'message':'Payment\x20status\x20is\x20'+_0x36b43c[_0x23ba3a(0x193)]+_0x23ba3a(0x19d)});await database_1['default'][_0x23ba3a(0x1a4)][_0x23ba3a(0x1a6)]({'where':{'id':_0x3013f1},'data':{..._0x3d6ec9,'updatedAt':new Date()}});const _0x185c76=_0x1ae221[_0x23ba3a(0x1b8)]['replace'](/[\s-]/g,''),_0xbda8e4=_0x185c76[_0x23ba3a(0x1bb)]('4')?_0x23ba3a(0x1fb):'mastercard',_0x50896a=_0x23ba3a(0x191)+_0xbda8e4,_0x4fe0a6=_0x23ba3a(0x18c)+_0x36b43c['id']+_0x23ba3a(0x1e8)+_0x36b43c[_0x23ba3a(0x189)];console['log'](_0x23ba3a(0x1c6)+_0xbda8e4[_0x23ba3a(0x1ec)]()+_0x23ba3a(0x1c5)),console[_0x23ba3a(0x1f7)](_0x23ba3a(0x1da)+_0x50896a),console[_0x23ba3a(0x1f7)]('\x20\x20\x20Return\x20URL:\x20'+_0x4fe0a6);const _0x38eadd={'first_name':_0x492c7c[_0x23ba3a(0x177)],'last_name':_0x492c7c[_0x23ba3a(0x17a)],'email':_0x492c7c['email']},_0x378679=await this[_0x23ba3a(0x1b3)][_0x23ba3a(0x206)]({'paymentId':_0x36b43c['id'],'orderId':_0x36b43c[_0x23ba3a(0x189)]||_0x36b43c['id'],'amount':_0x36b43c[_0x23ba3a(0x180)],'currency':_0x36b43c[_0x23ba3a(0x1ac)],'cardData':_0x1ae221,'resultUrl':_0x50896a,'returnUrl':_0x4fe0a6,'cardHolder':_0x38eadd,'browser':_0x58edf7});console[_0x23ba3a(0x1f7)](_0x23ba3a(0x17d),_0x378679);const _0x2db72f={'status':_0x378679[_0x23ba3a(0x193)],'updatedAt':new Date(),'statusChangedBy':'system','statusChangedAt':new Date()};_0x378679[_0x23ba3a(0x176)]&&(_0x2db72f[_0x23ba3a(0x171)]=_0x378679[_0x23ba3a(0x176)],console[_0x23ba3a(0x1f7)](_0x23ba3a(0x20d)+_0x378679['gateway_payment_id']));if(_0x378679[_0x23ba3a(0x193)]===_0x23ba3a(0x185)){_0x2db72f[_0x23ba3a(0x1fa)]=new Date();const _0x921cb3=await this['currencyService'][_0x23ba3a(0x19f)](_0x36b43c[_0x23ba3a(0x180)],_0x36b43c[_0x23ba3a(0x1ac)]),_0x5aa5ce=await this[_0x23ba3a(0x205)][_0x23ba3a(0x1cf)](_0x36b43c[_0x23ba3a(0x201)],_0x36b43c[_0x23ba3a(0x208)]),_0x18596b=_0x921cb3*(0x1-_0x5aa5ce/0x64);_0x2db72f[_0x23ba3a(0x1dc)]=_0x921cb3,_0x2db72f[_0x23ba3a(0x1ea)]=_0x18596b,_0x2db72f[_0x23ba3a(0x1ba)]=_0x5aa5ce,console[_0x23ba3a(0x1f7)](_0x23ba3a(0x188)+_0x36b43c['amount']+'\x20'+_0x36b43c[_0x23ba3a(0x1ac)]+_0x23ba3a(0x1cd)+_0x921cb3['toFixed'](0x6)+_0x23ba3a(0x181)),console[_0x23ba3a(0x1f7)](_0x23ba3a(0x195)+_0x36b43c[_0x23ba3a(0x208)]+'\x20commission:\x20'+_0x5aa5ce+'%'),console[_0x23ba3a(0x1f7)](_0x23ba3a(0x18f)+_0x18596b[_0x23ba3a(0x1de)](0x6)+_0x23ba3a(0x181));}else _0x378679['status']===_0x23ba3a(0x1b0)&&(_0x2db72f[_0x23ba3a(0x1c7)]=_0x378679[_0x23ba3a(0x17b)]||_0x23ba3a(0x1c3),console[_0x23ba3a(0x1f7)](_0x23ba3a(0x1c9)+_0x2db72f[_0x23ba3a(0x1c7)]));_0x2db72f['paymentMethod']='mastercard';if(_0x1ae221[_0x23ba3a(0x1b8)]){const _0x248be1=_0x1ae221['number'][_0x23ba3a(0x1ed)](/[\s-]/g,'');_0x2db72f[_0x23ba3a(0x1f2)]=_0x248be1['slice'](-0x4),console['log'](_0x23ba3a(0x1e0)+_0x2db72f[_0x23ba3a(0x1f2)]);}await database_1['default']['payment']['update']({'where':{'id':_0x36b43c['id']},'data':_0x2db72f});_0x378679[_0x23ba3a(0x193)]===_0x23ba3a(0x185)&&(await this['webhookService'][_0x23ba3a(0x1ff)](_0x36b43c['id'],_0x23ba3a(0x185)),console[_0x23ba3a(0x1f7)](_0x23ba3a(0x1c2)+_0x36b43c['id']));await database_1[_0x23ba3a(0x173)][_0x23ba3a(0x1e6)][_0x23ba3a(0x175)]({'data':{'paymentId':_0x36b43c['id'],'shopId':_0x36b43c[_0x23ba3a(0x201)],'event':_0xbda8e4+'_'+_0x378679[_0x23ba3a(0x193)]?.[_0x23ba3a(0x1bd)](),'statusCode':0xc8,'responseBody':JSON[_0x23ba3a(0x1bc)]({'oldStatus':'PENDING','newStatus':_0x378679[_0x23ba3a(0x193)],'gatewayPaymentId':_0x378679[_0x23ba3a(0x176)],'requires3ds':_0x378679[_0x23ba3a(0x203)],'cardType':_0xbda8e4[_0x23ba3a(0x1ec)](),'processedAt':new Date()[_0x23ba3a(0x1fe)]()})}});if(_0x378679['final']){await this[_0x23ba3a(0x1ae)](_0x36b43c,_0x378679['status'],_0x378679[_0x23ba3a(0x176)],_0xbda8e4),await this[_0x23ba3a(0x1a7)](_0x36b43c,_0x378679[_0x23ba3a(0x193)]);if(_0x378679[_0x23ba3a(0x193)]==='PAID'){console[_0x23ba3a(0x1f7)](_0x23ba3a(0x200)+_0xbda8e4['toUpperCase']()+_0x23ba3a(0x1d2)+_0x3013f1+_0x23ba3a(0x1b6));try{const {PaymentLinkService:_0x1078ba}=await Promise['resolve']()[_0x23ba3a(0x183)](()=>__importStar(require(_0x23ba3a(0x1d3)))),_0x59378e=new _0x1078ba();await _0x59378e[_0x23ba3a(0x1cc)](_0x3013f1),console[_0x23ba3a(0x1f7)](_0x23ba3a(0x1f9)+_0xbda8e4[_0x23ba3a(0x1ec)]()+_0x23ba3a(0x1d2)+_0x3013f1);}catch(_0x10f64d){console[_0x23ba3a(0x18e)]('Failed\x20to\x20update\x20payment\x20link\x20counter\x20for\x20'+_0xbda8e4['toUpperCase']()+_0x23ba3a(0x1f6),_0x10f64d);}}}console[_0x23ba3a(0x1f7)]('‚úÖ\x20'+_0xbda8e4[_0x23ba3a(0x1ec)]()+_0x23ba3a(0x1d2)+_0x3013f1+_0x23ba3a(0x1f0)+_0x378679[_0x23ba3a(0x193)]);if(_0x378679[_0x23ba3a(0x193)]==='PAID')_0x44a923[_0x23ba3a(0x1b2)]({'success':!![],'message':_0x23ba3a(0x1af),'result':{'status':_0x23ba3a(0x185),'gatewayPaymentId':_0x378679[_0x23ba3a(0x176)],'redirectUrl':_0x4fe0a6,'final':!![]}});else _0x378679['requires_3ds']&&_0x378679[_0x23ba3a(0x1d5)]?_0x44a923[_0x23ba3a(0x1b2)]({'success':!![],'message':'3DS\x20verification\x20required','result':{'status':_0x23ba3a(0x1c1),'gatewayPaymentId':_0x378679[_0x23ba3a(0x176)],'redirectUrl':_0x378679['threeds_url'],'requires3ds':!![],'final':![]}}):_0x44a923[_0x23ba3a(0x193)](0x190)[_0x23ba3a(0x1b2)]({'success':![],'message':_0x23ba3a(0x1c8),'result':{'status':'FAILED','gatewayPaymentId':_0x378679[_0x23ba3a(0x176)],'redirectUrl':_0x36b43c[_0x23ba3a(0x196)],'final':!![]}});}catch(_0x19461c){_0x20e80d(_0x19461c);}},this[_0x292146(0x1d4)]=new paymentService_1['PaymentService'](),this[_0x292146(0x1b3)]=new mastercardService_1['VisaMasterCardService'](),this[_0x292146(0x205)]=new webhookService_1[(_0x292146(0x1fd))](),this[_0x292146(0x1b9)]=new currencyService_1['CurrencyService']();}async[a10_0x40dfa7(0x1ae)](_0x327976,_0x4fb3a7,_0x4e9801,_0x544637){const _0x249ce4=a10_0x40dfa7,_0x52ef51=Date[_0x249ce4(0x174)]();try{const _0x9f1709=_0x327976[_0x249ce4(0x1a2)],_0x4f128e=_0x9f1709['settings'];if(!_0x4f128e?.['webhookUrl']){console[_0x249ce4(0x1f7)](_0x249ce4(0x18b)+_0x9f1709['id']);return;}const _0x432f28=_0x4fb3a7===_0x249ce4(0x185)?'payment.success':'payment.failed';let _0x1bf2b7=[];if(_0x4f128e[_0x249ce4(0x1a3)])try{_0x1bf2b7=Array[_0x249ce4(0x1e7)](_0x4f128e[_0x249ce4(0x1a3)])?_0x4f128e[_0x249ce4(0x1a3)]:JSON[_0x249ce4(0x1e9)](_0x4f128e[_0x249ce4(0x1a3)]);}catch(_0x27f350){console[_0x249ce4(0x18e)](_0x249ce4(0x194),_0x27f350),_0x1bf2b7=[];}if(!_0x1bf2b7[_0x249ce4(0x1f5)](_0x432f28)){console['log'](_0x249ce4(0x1ca)+_0x432f28+_0x249ce4(0x20f)+_0x9f1709['id']);return;}const _0x1164c3={'event':_0x432f28,'payment':{'id':_0x327976['id'],'order_id':_0x327976['orderId'],'gateway_order_id':_0x327976[_0x249ce4(0x189)],'gateway':_0x249ce4(0x1d6),'card_type':_0x544637?.[_0x249ce4(0x1ec)]()||'UNKNOWN','amount':_0x327976[_0x249ce4(0x180)],'currency':_0x327976[_0x249ce4(0x1ac)],'status':_0x4fb3a7['toLowerCase'](),'customer_email':_0x327976[_0x249ce4(0x19c)],'customer_name':_0x327976['customerName'],'gateway_payment_id':_0x4e9801,'created_at':_0x327976[_0x249ce4(0x1cb)],'updated_at':new Date()}},_0x15b8f7=await fetch(_0x4f128e[_0x249ce4(0x17e)],{'method':_0x249ce4(0x1aa),'headers':{'Content-Type':'application/json','User-Agent':_0x249ce4(0x186)+(_0x544637?.[_0x249ce4(0x1ec)]()||'VISA/MasterCard')+')'},'body':JSON[_0x249ce4(0x1bc)](_0x1164c3)}),_0x46b114=Date[_0x249ce4(0x174)]()-_0x52ef51;console[_0x249ce4(0x1f7)]((_0x544637?.[_0x249ce4(0x1ec)]()||_0x249ce4(0x1ee))+_0x249ce4(0x209)+_0x4f128e[_0x249ce4(0x17e)]+_0x249ce4(0x1c4)+_0x15b8f7['status']+'\x20('+_0x46b114+_0x249ce4(0x20c));}catch(_0x250537){console[_0x249ce4(0x18e)](_0x249ce4(0x1a8)+(_0x544637?.[_0x249ce4(0x1ec)]()||_0x249ce4(0x1ee))+_0x249ce4(0x192),_0x250537);}}async[a10_0x40dfa7(0x1a7)](_0x20d082,_0x1b93b9){const _0x5eb157=a10_0x40dfa7;try{const {telegramBotService:_0x43cfe5}=await Promise[_0x5eb157(0x204)]()['then'](()=>__importStar(require('../services/telegramBotService'))),_0x12368b={'PAID':_0x5eb157(0x1f8),'FAILED':'failed'},_0x2ec154=_0x12368b[_0x1b93b9];if(!_0x2ec154)return;await _0x43cfe5[_0x5eb157(0x19a)](_0x20d082[_0x5eb157(0x201)],_0x20d082,_0x2ec154);}catch(_0x57fc06){console['error'](_0x5eb157(0x197),_0x57fc06);}}}exports['PaymentController']=PaymentController;