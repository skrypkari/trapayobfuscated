'use strict';const a12_0x596f94=a12_0xdb62;(function(_0x3eaffa,_0x3ac8ff){const _0x38ff93=a12_0xdb62,_0x11d7b8=_0x3eaffa();while(!![]){try{const _0x2b5c46=-parseInt(_0x38ff93(0x139))/0x1*(parseInt(_0x38ff93(0xe4))/0x2)+parseInt(_0x38ff93(0x135))/0x3*(-parseInt(_0x38ff93(0x122))/0x4)+-parseInt(_0x38ff93(0x13f))/0x5+-parseInt(_0x38ff93(0x12a))/0x6*(parseInt(_0x38ff93(0xdc))/0x7)+parseInt(_0x38ff93(0xac))/0x8+-parseInt(_0x38ff93(0x125))/0x9+parseInt(_0x38ff93(0x101))/0xa*(parseInt(_0x38ff93(0x106))/0xb);if(_0x2b5c46===_0x3ac8ff)break;else _0x11d7b8['push'](_0x11d7b8['shift']());}catch(_0x1d718a){_0x11d7b8['push'](_0x11d7b8['shift']());}}}(a12_0x2b51,0x74af1));function a12_0xdb62(_0x21b298,_0x295d80){_0x21b298=_0x21b298-0x9e;const _0x2b5126=a12_0x2b51();let _0xdb6250=_0x2b5126[_0x21b298];return _0xdb6250;}var __createBinding=this&&this[a12_0x596f94(0x11d)]||(Object[a12_0x596f94(0xef)]?function(_0x3964bd,_0x4c1b63,_0x3ef6dc,_0x4fc89a){const _0x3b971a=a12_0x596f94;if(_0x4fc89a===undefined)_0x4fc89a=_0x3ef6dc;var _0x4ec639=Object[_0x3b971a(0xf5)](_0x4c1b63,_0x3ef6dc);(!_0x4ec639||(_0x3b971a(0xf2)in _0x4ec639?!_0x4c1b63[_0x3b971a(0x12d)]:_0x4ec639[_0x3b971a(0xa7)]||_0x4ec639[_0x3b971a(0xb2)]))&&(_0x4ec639={'enumerable':!![],'get':function(){return _0x4c1b63[_0x3ef6dc];}}),Object[_0x3b971a(0x136)](_0x3964bd,_0x4fc89a,_0x4ec639);}:function(_0x472761,_0x3cbbd1,_0x4a9940,_0x160cde){if(_0x160cde===undefined)_0x160cde=_0x4a9940;_0x472761[_0x160cde]=_0x3cbbd1[_0x4a9940];}),__setModuleDefault=this&&this[a12_0x596f94(0xc6)]||(Object[a12_0x596f94(0xef)]?function(_0x2600d0,_0x328e9e){const _0x4543af=a12_0x596f94;Object[_0x4543af(0x136)](_0x2600d0,_0x4543af(0xe2),{'enumerable':!![],'value':_0x328e9e});}:function(_0x2b90b3,_0x15dba9){const _0x386b53=a12_0x596f94;_0x2b90b3[_0x386b53(0xe2)]=_0x15dba9;}),__importStar=this&&this['__importStar']||(function(){var _0x1d5126=function(_0x49df16){return _0x1d5126=Object['getOwnPropertyNames']||function(_0x2e1376){const _0x552d9d=a12_0xdb62;var _0x163df6=[];for(var _0x58111 in _0x2e1376)if(Object[_0x552d9d(0xf4)][_0x552d9d(0xfe)]['call'](_0x2e1376,_0x58111))_0x163df6[_0x163df6[_0x552d9d(0xcd)]]=_0x58111;return _0x163df6;},_0x1d5126(_0x49df16);};return function(_0x3b9262){const _0x3fc9c4=a12_0xdb62;if(_0x3b9262&&_0x3b9262[_0x3fc9c4(0x12d)])return _0x3b9262;var _0x10361c={};if(_0x3b9262!=null){for(var _0x4b9c62=_0x1d5126(_0x3b9262),_0x3fc7c4=0x0;_0x3fc7c4<_0x4b9c62[_0x3fc9c4(0xcd)];_0x3fc7c4++)if(_0x4b9c62[_0x3fc7c4]!==_0x3fc9c4(0xe2))__createBinding(_0x10361c,_0x3b9262,_0x4b9c62[_0x3fc7c4]);}return __setModuleDefault(_0x10361c,_0x3b9262),_0x10361c;};}()),__importDefault=this&&this[a12_0x596f94(0xa8)]||function(_0x11b581){const _0x3fc415=a12_0x596f94;return _0x11b581&&_0x11b581[_0x3fc415(0x12d)]?_0x11b581:{'default':_0x11b581};};function a12_0x2b51(){const _0x2fac30=['&payment_id=','ðŸ’³\x20Saving\x20MasterCard\x20gateway\x20payment\x20ID:\x20','processCardPayment','getPaymentById','ðŸ’³\x20Processing\x20MasterCard\x20payment:\x20','ðŸ’³\x20Browser\x20IP:\x20','visa/mastercard','UNKNOWN','__setModuleDefault','\x20webhook:','customerEmail','Payment\x20processed\x20successfully','payment','ðŸ’³\x20','failed','length','Payment\x20status\x20is\x20','visa','isArray','log','Card\x20payment\x20failed','Failed\x20to\x20send\x20','webhookLog','stringify','processMasterCardPayment','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment:\x20','VisaMasterCardService','then','user_agent','final','298291OwTVBm','Payment\x20not\x20found','1111','customerCountry','ðŸ’³\x20Saving\x20card\x20last\x204\x20digits:\x20****','first_name','default','payment.failed','191942JrHmeC','sendShopWebhook','WebhookService','PAID','\x20processed:\x20','body','sendPaymentStatusNotification','now','threeds_url','https://app.trapay.uk/payment/pending?id=','handleSuccessfulPayment','create',',\x20cannot\x20process','updatedAt','get','\x22\x20|\x20\x22','prototype','getOwnPropertyDescriptor','gateway','toUpperCase','\x20->\x20','trim','../services/webhookService','ðŸ’°\x20Gateway\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20\x20\x20Result\x20URL\x20(webhook):\x20','hasOwnProperty','failureMessage','ðŸ§¹\x20Customer\x20names\x20cleaned:','2398570ebuVul','paymentMethod','3DS\x20verification\x20required','Payment\x20failed','Payment\x20is\x20not\x20for\x20VISA/MasterCard\x20gateway','132hErhOM','number','\x20with\x20status\x20','failUrl','\x20not\x20enabled\x20for\x20shop\x20','../services/paymentService','ðŸ“\x20Customer\x20data:','PENDING','amount','params','\x20USDT','visaMasterCardService','orderId','\x20webhook\x20sent\x20to\x20','amountUSDT','webhookUrl','shop','../services/telegramBotService','error','updatePaymentCustomerDataPublic','CurrencyService','startsWith','\x20\x20\x20Return\x20URL:\x20','__createBinding','gatewayOrderId','webhookEvents','parse','paymentService','2145628cShUYo','application/json','ðŸ“ˆ\x20','6040026hCOyqb','getGatewayCommission','update','Payment\x20System/1.0\x20(','Bank\x20Card','90oFPYPD','\x20\x20Cleaned:\x20\x20\x22','https://api.trapay.uk/api/webhooks/gateway/','__esModule','replace','last_name','gatewayPaymentId','currency','toFixed','shopId','customerIp','3JnXKIb','defineProperty','\x20payment\x20','gatewayCommissionRate','7CikCCk','Customer\x20data\x20updated\x20successfully','resolve','âŒ\x20Payment\x20failed\x20with\x20message:\x20','\x20commission:\x20','json','3449795GuylkX','FAILED','âŒ\x20Payment\x20gateway\x20mismatch:\x20expected\x20\x27visa/mastercard\x27,\x20got\x20\x27','system','VISA/MasterCard','../services/paymentLinkService','convertToUSDT','includes','sendPaymentNotification','âœ…\x20Payment\x20link\x20counter\x20updated\x20for\x20','writable','__importDefault','email','ðŸ’°\x20Updated\x20merchant\x20balance\x20for\x20payment\x20','gateway_payment_id','6465000VjFWRk','currencyService','paidAt','../config/database','Payment\x20created\x20successfully','paid','configurable','\x20URLs:','requires_3ds','status','getPaymentStatus','Webhook\x20event\x20','toISOString','findUnique','mastercard','\x20payment:','webhookService','payment.success'];a12_0x2b51=function(){return _0x2fac30;};return a12_0x2b51();}Object[a12_0x596f94(0x136)](exports,a12_0x596f94(0x12d),{'value':!![]}),exports['PaymentController']=void 0x0;const paymentService_1=require(a12_0x596f94(0x10b)),mastercardService_1=require('../services/gateways/mastercardService'),webhookService_1=require(a12_0x596f94(0xfa)),currencyService_1=require('../services/currencyService'),database_1=__importDefault(require(a12_0x596f94(0xaf)));class PaymentController{constructor(){const _0x37875e=a12_0x596f94;this['createPublicPayment']=async(_0x2984ad,_0x2c52cf,_0x4d467a)=>{const _0x43c3c8=a12_0xdb62;try{const _0x5cc907=_0x2984ad[_0x43c3c8(0xe9)],_0x39b274=await this[_0x43c3c8(0x121)]['createPublicPayment'](_0x5cc907);_0x2c52cf[_0x43c3c8(0xb5)](0xc9)[_0x43c3c8(0x13e)]({'success':!![],'message':_0x43c3c8(0xb0),'result':_0x39b274});}catch(_0xfa8024){_0x4d467a(_0xfa8024);}},this[_0x37875e(0xb6)]=async(_0xa8736a,_0x22784c,_0xbed928)=>{const _0x33e981=_0x37875e;try{const {id:_0x387f3f}=_0xa8736a['params'],_0x4ff512=await this[_0x33e981(0x121)]['getPaymentStatus'](_0x387f3f);if(!_0x4ff512)return _0x22784c[_0x33e981(0xb5)](0x194)[_0x33e981(0x13e)]({'success':![],'message':_0x33e981(0xdd)});_0x22784c[_0x33e981(0x13e)]({'success':!![],'result':_0x4ff512});}catch(_0x72b489){_0xbed928(_0x72b489);}},this[_0x37875e(0xc1)]=async(_0x196bcd,_0x4207f4,_0xc56324)=>{const _0x138fbb=_0x37875e;try{const {id:_0x239047}=_0x196bcd['params'],_0x5e8059=await this[_0x138fbb(0x121)][_0x138fbb(0xc1)](_0x239047);if(!_0x5e8059)return _0x4207f4['status'](0x194)[_0x138fbb(0x13e)]({'success':![],'message':'Payment\x20not\x20found'});_0x4207f4[_0x138fbb(0x13e)]({'success':!![],'result':_0x5e8059});}catch(_0x19a086){_0xc56324(_0x19a086);}},this['updatePaymentCustomer']=async(_0x1a25f3,_0x1d88b1,_0x8907)=>{const _0x187f2f=_0x37875e;try{const {id:_0x1c8f42}=_0x1a25f3[_0x187f2f(0x10f)],_0xba6515=_0x1a25f3[_0x187f2f(0xe9)];console[_0x187f2f(0xd1)](_0x187f2f(0xd7)+_0x1c8f42),console[_0x187f2f(0xd1)](_0x187f2f(0x10c),_0xba6515);const _0x4e1878=await this['paymentService'][_0x187f2f(0x119)](_0x1c8f42,_0xba6515);if(!_0x4e1878)return _0x1d88b1[_0x187f2f(0xb5)](0x194)[_0x187f2f(0x13e)]({'success':![],'message':_0x187f2f(0xdd)});_0x1d88b1[_0x187f2f(0x13e)]({'success':!![],'message':_0x187f2f(0x13a),'result':{'paymentId':_0x4e1878['id'],'customerIp':_0x4e1878[_0x187f2f(0x134)],'customerUa':_0x4e1878['customerUa'],'customerCountry':_0x4e1878[_0x187f2f(0xdf)],'updatedAt':_0x4e1878[_0x187f2f(0xf1)]}});}catch(_0x459dc3){_0x8907(_0x459dc3);}},this[_0x37875e(0xd6)]=async(_0x431c7f,_0xd70e81,_0x5d8b3e)=>{const _0x33295c=_0x37875e;try{const {id:_0x2233b0}=_0x431c7f['params'],{cardData:_0x3a4034,cardHolder:_0x3c76da,browser:_0x5d9721}=_0x431c7f[_0x33295c(0xe9)];console[_0x33295c(0xd1)](_0x33295c(0xc2)+_0x2233b0),console[_0x33295c(0xd1)]('ðŸ’³\x20Card\x20holder:\x20'+_0x3c76da['first_name']+'\x20'+_0x3c76da[_0x33295c(0x12f)]+'\x20('+_0x3c76da[_0x33295c(0xa9)]+')'),console['log'](_0x33295c(0xc3)+_0x5d9721['ip']);const _0x3fdb84=_0x3c76da[_0x33295c(0xe1)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')[_0x33295c(0xf9)]()||'',_0x3cdafb=_0x3c76da[_0x33295c(0x12f)]?.['replace'](/[\t\n\r\f\v]/g,'\x20')['trim']()||'';console[_0x33295c(0xd1)](_0x33295c(0x100)),console[_0x33295c(0xd1)]('\x20\x20Original:\x20\x22'+_0x3c76da['first_name']+_0x33295c(0xf3)+_0x3c76da[_0x33295c(0x12f)]+'\x22'),console[_0x33295c(0xd1)](_0x33295c(0x12b)+_0x3fdb84+_0x33295c(0xf3)+_0x3cdafb+'\x22');const _0x3be867={'customerName':_0x3fdb84+'\x20'+_0x3cdafb,'customerEmail':_0x3c76da[_0x33295c(0xa9)],'customerIp':_0x5d9721['ip'],'customerUa':_0x5d9721[_0x33295c(0xda)]},_0x597955=await database_1['default'][_0x33295c(0xca)][_0x33295c(0xb9)]({'where':{'id':_0x2233b0},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x597955)return _0xd70e81['status'](0x194)[_0x33295c(0x13e)]({'success':![],'message':_0x33295c(0xdd)});if(_0x597955[_0x33295c(0xf6)]!==_0x33295c(0xc4))return console[_0x33295c(0xd1)](_0x33295c(0x9f)+_0x597955['gateway']+'\x27'),_0xd70e81[_0x33295c(0xb5)](0x190)['json']({'success':![],'message':_0x33295c(0x105)});if(_0x597955[_0x33295c(0xb5)]!==_0x33295c(0x10d))return _0xd70e81['status'](0x190)['json']({'success':![],'message':_0x33295c(0xce)+_0x597955[_0x33295c(0xb5)]+_0x33295c(0xf0)});await database_1[_0x33295c(0xe2)][_0x33295c(0xca)]['update']({'where':{'id':_0x2233b0},'data':{..._0x3be867,'updatedAt':new Date()}});const _0x3e8c2a=_0x3a4034['number'][_0x33295c(0x12e)](/[\s-]/g,''),_0x27d69d=_0x3e8c2a[_0x33295c(0x11b)]('4')?_0x33295c(0xcf):_0x33295c(0xba),_0x367754=_0x33295c(0x12c)+_0x27d69d,_0x24c6aa=_0x33295c(0xed)+_0x597955['id']+_0x33295c(0xbe)+_0x597955[_0x33295c(0x11e)];console['log'](_0x33295c(0xcb)+_0x27d69d[_0x33295c(0xf7)]()+_0x33295c(0xb3)),console['log'](_0x33295c(0xfd)+_0x367754),console['log'](_0x33295c(0x11c)+_0x24c6aa);const _0x25fd56={'first_name':_0x3c76da[_0x33295c(0xe1)],'last_name':_0x3c76da[_0x33295c(0x12f)],'email':_0x3c76da[_0x33295c(0xa9)]},_0x3dd57a=await this['visaMasterCardService'][_0x33295c(0xc0)]({'paymentId':_0x597955['id'],'orderId':_0x597955[_0x33295c(0x11e)]||_0x597955['id'],'amount':_0x597955[_0x33295c(0x10e)],'currency':_0x597955[_0x33295c(0x131)],'cardData':_0x3a4034,'resultUrl':_0x367754,'returnUrl':_0x24c6aa,'cardHolder':_0x25fd56,'browser':_0x5d9721});console[_0x33295c(0xd1)]('ðŸ’³\x20MasterCard\x20result:',_0x3dd57a);const _0x547732={'status':_0x3dd57a[_0x33295c(0xb5)],'updatedAt':new Date(),'statusChangedBy':_0x33295c(0xa0),'statusChangedAt':new Date()};_0x3dd57a[_0x33295c(0xab)]&&(_0x547732[_0x33295c(0x130)]=_0x3dd57a[_0x33295c(0xab)],console[_0x33295c(0xd1)](_0x33295c(0xbf)+_0x3dd57a[_0x33295c(0xab)]));if(_0x3dd57a[_0x33295c(0xb5)]===_0x33295c(0xe7)){_0x547732[_0x33295c(0xae)]=new Date();const _0x13eab3=await this['currencyService'][_0x33295c(0xa3)](_0x597955['amount'],_0x597955[_0x33295c(0x131)]),_0x2560f6=await this['webhookService'][_0x33295c(0x126)](_0x597955[_0x33295c(0x133)],_0x597955['gateway']),_0x32f643=_0x13eab3*(0x1-_0x2560f6/0x64);_0x547732[_0x33295c(0x114)]=_0x13eab3,_0x547732['amountAfterGatewayCommissionUSDT']=_0x32f643,_0x547732[_0x33295c(0x138)]=_0x2560f6,console['log']('ðŸ’°\x20Converting\x20'+_0x597955[_0x33295c(0x10e)]+'\x20'+_0x597955[_0x33295c(0x131)]+_0x33295c(0xf8)+_0x13eab3[_0x33295c(0x132)](0x6)+_0x33295c(0x110)),console[_0x33295c(0xd1)](_0x33295c(0xfb)+_0x597955[_0x33295c(0xf6)]+_0x33295c(0x13d)+_0x2560f6+'%'),console[_0x33295c(0xd1)]('ðŸ’°\x20Amount\x20after\x20gateway\x20commission:\x20'+_0x32f643[_0x33295c(0x132)](0x6)+_0x33295c(0x110));}else _0x3dd57a[_0x33295c(0xb5)]===_0x33295c(0x9e)&&(_0x547732[_0x33295c(0xff)]=_0x3dd57a['errorMessage']||_0x33295c(0xd2),console[_0x33295c(0xd1)](_0x33295c(0x13c)+_0x547732['failureMessage']));_0x547732[_0x33295c(0x102)]=_0x33295c(0x129);if(_0x3a4034[_0x33295c(0x107)]){const _0x283a90=_0x3a4034[_0x33295c(0x107)]['replace'](/[\s-]/g,'');_0x547732['cardLast4']=_0x283a90['slice'](-0x4),console[_0x33295c(0xd1)](_0x33295c(0xe0)+_0x547732['cardLast4']);}await database_1[_0x33295c(0xe2)][_0x33295c(0xca)][_0x33295c(0x127)]({'where':{'id':_0x597955['id']},'data':_0x547732});_0x3dd57a[_0x33295c(0xb5)]===_0x33295c(0xe7)&&(await this['webhookService']['updatePaymentStatus'](_0x597955['id'],'PAID'),console['log'](_0x33295c(0xaa)+_0x597955['id']));await database_1[_0x33295c(0xe2)][_0x33295c(0xd4)]['create']({'data':{'paymentId':_0x597955['id'],'shopId':_0x597955[_0x33295c(0x133)],'event':_0x27d69d+'_'+_0x3dd57a[_0x33295c(0xb5)]?.['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x33295c(0xd5)]({'oldStatus':_0x33295c(0x10d),'newStatus':_0x3dd57a[_0x33295c(0xb5)],'gatewayPaymentId':_0x3dd57a[_0x33295c(0xab)],'requires3ds':_0x3dd57a[_0x33295c(0xb4)],'cardType':_0x27d69d[_0x33295c(0xf7)](),'processedAt':new Date()[_0x33295c(0xb8)]()})}});if(_0x3dd57a[_0x33295c(0xdb)]){await this[_0x33295c(0xe5)](_0x597955,_0x3dd57a[_0x33295c(0xb5)],_0x3dd57a[_0x33295c(0xab)],_0x27d69d),await this[_0x33295c(0xea)](_0x597955,_0x3dd57a[_0x33295c(0xb5)]);if(_0x3dd57a['status']==='PAID'){console[_0x33295c(0xd1)](_0x33295c(0x124)+_0x27d69d['toUpperCase']()+'\x20payment\x20'+_0x2233b0+'\x20became\x20PAID,\x20updating\x20payment\x20link\x20counter');try{const {PaymentLinkService:_0xcc0f10}=await Promise[_0x33295c(0x13b)]()['then'](()=>__importStar(require(_0x33295c(0xa2)))),_0x5850b6=new _0xcc0f10();await _0x5850b6[_0x33295c(0xee)](_0x2233b0),console[_0x33295c(0xd1)](_0x33295c(0xa6)+_0x27d69d[_0x33295c(0xf7)]()+'\x20payment\x20'+_0x2233b0);}catch(_0x6db52){console['error']('Failed\x20to\x20update\x20payment\x20link\x20counter\x20for\x20'+_0x27d69d[_0x33295c(0xf7)]()+_0x33295c(0xbb),_0x6db52);}}}console[_0x33295c(0xd1)]('âœ…\x20'+_0x27d69d[_0x33295c(0xf7)]()+_0x33295c(0x137)+_0x2233b0+_0x33295c(0xe8)+_0x3dd57a[_0x33295c(0xb5)]);if(_0x3dd57a[_0x33295c(0xb5)]===_0x33295c(0xe7))_0xd70e81[_0x33295c(0x13e)]({'success':!![],'message':_0x33295c(0xc9),'result':{'status':_0x33295c(0xe7),'gatewayPaymentId':_0x3dd57a[_0x33295c(0xab)],'redirectUrl':_0x24c6aa,'final':!![]}});else _0x3dd57a[_0x33295c(0xb4)]&&_0x3dd57a[_0x33295c(0xec)]?_0xd70e81[_0x33295c(0x13e)]({'success':!![],'message':_0x33295c(0x103),'result':{'status':_0x33295c(0x10d),'gatewayPaymentId':_0x3dd57a[_0x33295c(0xab)],'redirectUrl':_0x3dd57a[_0x33295c(0xec)],'requires3ds':!![],'final':![]}}):_0xd70e81[_0x33295c(0xb5)](0x190)[_0x33295c(0x13e)]({'success':![],'message':_0x33295c(0x104),'result':{'status':'FAILED','gatewayPaymentId':_0x3dd57a[_0x33295c(0xab)],'redirectUrl':_0x597955[_0x33295c(0x109)],'final':!![]}});}catch(_0x5784e4){_0x5d8b3e(_0x5784e4);}},this[_0x37875e(0x121)]=new paymentService_1['PaymentService'](),this[_0x37875e(0x111)]=new mastercardService_1[(_0x37875e(0xd8))](),this[_0x37875e(0xbc)]=new webhookService_1[(_0x37875e(0xe6))](),this[_0x37875e(0xad)]=new currencyService_1[(_0x37875e(0x11a))]();}async[a12_0x596f94(0xe5)](_0x41ea0b,_0x285bca,_0x50f45c,_0x16af71){const _0x1c3bc4=a12_0x596f94,_0xff152b=Date[_0x1c3bc4(0xeb)]();try{const _0x554bdb=_0x41ea0b[_0x1c3bc4(0x116)],_0x524ce3=_0x554bdb['settings'];if(!_0x524ce3?.[_0x1c3bc4(0x115)]){console[_0x1c3bc4(0xd1)](_0x1c3bc4(0xfc)+_0x554bdb['id']);return;}const _0xb70ba5=_0x285bca===_0x1c3bc4(0xe7)?_0x1c3bc4(0xbd):_0x1c3bc4(0xe3);let _0x1d5414=[];if(_0x524ce3[_0x1c3bc4(0x11f)])try{_0x1d5414=Array[_0x1c3bc4(0xd0)](_0x524ce3[_0x1c3bc4(0x11f)])?_0x524ce3[_0x1c3bc4(0x11f)]:JSON[_0x1c3bc4(0x120)](_0x524ce3[_0x1c3bc4(0x11f)]);}catch(_0x61cef){console[_0x1c3bc4(0x118)]('Error\x20parsing\x20webhook\x20events:',_0x61cef),_0x1d5414=[];}if(!_0x1d5414[_0x1c3bc4(0xa4)](_0xb70ba5)){console[_0x1c3bc4(0xd1)](_0x1c3bc4(0xb7)+_0xb70ba5+_0x1c3bc4(0x10a)+_0x554bdb['id']);return;}const _0x2dc81b={'event':_0xb70ba5,'payment':{'id':_0x41ea0b['id'],'order_id':_0x41ea0b[_0x1c3bc4(0x112)],'gateway_order_id':_0x41ea0b[_0x1c3bc4(0x11e)],'gateway':_0x1c3bc4(0xde),'card_type':_0x16af71?.[_0x1c3bc4(0xf7)]()||_0x1c3bc4(0xc5),'amount':_0x41ea0b[_0x1c3bc4(0x10e)],'currency':_0x41ea0b['currency'],'status':_0x285bca['toLowerCase'](),'customer_email':_0x41ea0b[_0x1c3bc4(0xc8)],'customer_name':_0x41ea0b['customerName'],'gateway_payment_id':_0x50f45c,'created_at':_0x41ea0b['createdAt'],'updated_at':new Date()}},_0x24c5fd=await fetch(_0x524ce3['webhookUrl'],{'method':'POST','headers':{'Content-Type':_0x1c3bc4(0x123),'User-Agent':_0x1c3bc4(0x128)+(_0x16af71?.[_0x1c3bc4(0xf7)]()||'VISA/MasterCard')+')'},'body':JSON[_0x1c3bc4(0xd5)](_0x2dc81b)}),_0x1d45a0=Date[_0x1c3bc4(0xeb)]()-_0xff152b;console[_0x1c3bc4(0xd1)]((_0x16af71?.[_0x1c3bc4(0xf7)]()||'VISA/MasterCard')+_0x1c3bc4(0x113)+_0x524ce3[_0x1c3bc4(0x115)]+_0x1c3bc4(0x108)+_0x24c5fd['status']+'\x20('+_0x1d45a0+'ms)');}catch(_0x4bc2d3){console[_0x1c3bc4(0x118)](_0x1c3bc4(0xd3)+(_0x16af71?.[_0x1c3bc4(0xf7)]()||_0x1c3bc4(0xa1))+_0x1c3bc4(0xc7),_0x4bc2d3);}}async['sendPaymentStatusNotification'](_0x1f41c5,_0x1e90c4){const _0x5d7d06=a12_0x596f94;try{const {telegramBotService:_0xe24422}=await Promise[_0x5d7d06(0x13b)]()[_0x5d7d06(0xd9)](()=>__importStar(require(_0x5d7d06(0x117)))),_0x1c12d7={'PAID':_0x5d7d06(0xb1),'FAILED':_0x5d7d06(0xcc)},_0x18af48=_0x1c12d7[_0x1e90c4];if(!_0x18af48)return;await _0xe24422[_0x5d7d06(0xa5)](_0x1f41c5[_0x5d7d06(0x133)],_0x1f41c5,_0x18af48);}catch(_0x1dc04d){console[_0x5d7d06(0x118)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x1dc04d);}}}exports['PaymentController']=PaymentController;