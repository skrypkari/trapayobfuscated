'use strict';const a4_0x27b05f=a4_0x2861;(function(_0x2406fe,_0x58e91d){const _0x5724f5=a4_0x2861,_0x5cdb35=_0x2406fe();while(!![]){try{const _0x17a4cf=-parseInt(_0x5724f5(0x138))/0x1+parseInt(_0x5724f5(0xe9))/0x2*(-parseInt(_0x5724f5(0xf6))/0x3)+-parseInt(_0x5724f5(0x165))/0x4+parseInt(_0x5724f5(0xc9))/0x5*(parseInt(_0x5724f5(0x123))/0x6)+-parseInt(_0x5724f5(0x14e))/0x7*(parseInt(_0x5724f5(0x140))/0x8)+-parseInt(_0x5724f5(0x139))/0x9+parseInt(_0x5724f5(0xee))/0xa;if(_0x17a4cf===_0x58e91d)break;else _0x5cdb35['push'](_0x5cdb35['shift']());}catch(_0x400f36){_0x5cdb35['push'](_0x5cdb35['shift']());}}}(a4_0x36c5,0xaa0ba));function a4_0x36c5(){const _0x3354b6=['getPayoutStats','getPaymentById','getPayouts','true','getMerchantsAwaitingPayout','getMerchantsSelection','Payment\x20link\x20expiration\x20check\x20completed\x20successfully',',\x20sending\x20Telegram\x20notification','json','getPayoutReports','Token\x20is\x20required','status','log','üì±\x20Payment\x20','223154AlWPFw','changeAdminPassword','refund','deletePayout','Payment\x20not\x20found','20643640brGTzV','gateway','PROCESSING','üîÑ\x20Admin\x20updating\x20customer\x20data\x20for\x20payment\x20','default','üì±\x20Skipping\x20Telegram\x20notification\x20for\x20status\x20change\x20to:\x20','PAID','__importStar','12NEvVhb','getOwnPropertyNames','\x20with\x20data:','toUpperCase','cleanupStaleProcessingPayments','Admin\x20access\x20confirmed','updatePayment','üí∏\x20[GATEWAY\x20STATS]\x20Refund\x20count:\x20','writable','EXPIRED','Admin\x202FA\x20disabled\x20successfully','hasPayoutHistory','\x20\x20\x20-\x20Total\x20Commission:\x20','amountUSDT','gatewayCommission','adminService','errors','toFixed','createPayout','__setModuleDefault','statistics','shopId','cleanupStalePayments','paymentCleanupService','User\x20deleted\x20successfully','expirePaymentLinks','‚úÖ\x20Payment\x20link\x20counter\x20updated\x20for\x20payment\x20','getSystemStatistics','getGatewaySettings','Admin\x20password\x20changed\x20successfully','suspendUser','PaymentLinkService','User\x20suspended\x20successfully','enableAdmin2FA','üìà\x20Admin\x20changed\x20payment\x20','paymentLinkService','paid','checkAuth','createUser','desc','\x20->\x20','getUserById','updatePaymentStatus','\x20->\x20Gateway\x20Name:\x20','stringify','6ZUPRcN','updateGatewaySettings','setupAdmin2FA','../services/adminService','summary','üìä\x20Manual\x20payment\x20cleanup\x20(PROCESSING\x20+\x20PENDING)\x20with\x20report\x20initiated\x20by\x20admin:\x20','resolve','length','total','cleanupStalePendingPayments','expireSinglePaymentLinks','\x20\x20\x20-\x20Total\x20Turnover:\x20','getAllPayouts','../services/telegramBotService','shopId\x20and\x20amount\x20are\x20required','handleSuccessfulPayment','Failed\x20to\x20update\x20payment\x20link\x20counter:','getProcessingPaymentsStats','failed','findMany','\x20to\x20PAID,\x20updating\x20payment\x20link\x20counter','489176xDJrNI','2077083FaIsMe','getShopWallets','FAILED','Customer\x20data\x20updated\x20successfully','getLoginLogs','üîç\x20[GATEWAY\x20STATS]\x20Sample\x20payments\x20for\x20','updateCustomerData','3960520BiBxVP','get2FASettings','updatePayout','error','month','get','üìä\x20[GATEWAY\x20STATS]\x20Gateway\x20commission:\x20','../services/gatewaySettingsService','disableAdmin2FA','Payout\x20updated\x20successfully','üí∞\x20[GATEWAY\x20STATS]\x20Found\x20','REFUND','User\x20created\x20successfully','Payment\x20cleanup\x20(PROCESSING\x20+\x20PENDING)\x20with\x20report\x20completed\x20successfully','7gNFbRT','PENDING\x20payment\x20cleanup\x20completed\x20successfully','__esModule','AdminController','setup2FA','activateUser','Gateway\x20settings\x20updated\x20successfully','‚è∞\x20Manual\x20PENDING\x20payment\x20cleanup\x20initiated\x20by\x20admin:\x20','username','\x20paid\x20payments\x20for\x20','Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20status\x20change:','\x20\x20\x20-\x20Successful\x20Payments:\x20','create','loginLog','count','getUsers','../types/gateway','chargeback','getAllGatewaysWithSettings','cleanupStalePaymentsWithReport','CHARGEBACK','User\x20updated\x20successfully','\x20\x20\x20-\x20Chargeback\x20Rate:\x20','3432736Dtnkmf','payouts','getStatistics','getOwnPropertyDescriptor','2FA\x20enabled\x20successfully','query','getSettingsByGatewayId','üéØ\x20[CONTROLLER]\x20Updating\x20payout\x20','params','Payment\x20updated\x20successfully','merchants','üîç\x20[GATEWAY\x20STATS]\x20Querying\x20payments\x20with\x20gateway=\x22','üìä\x20Admin\x20requesting\x20payout\x20reports:','updateUser','2FA\x20disabled\x20successfully','\x20to\x20','enable2FA','role','processed','getAllPayments','pagination','body','User\x20not\x20found','payments','getPayoutById','5758310zzZHiG','defineProperty','üìä\x20Admin\x20requesting\x20merchant\x20statistics\x20with\x20filters:','payment','telegramBotService','users','gatewaySettingsService','Amount\x20must\x20be\x20greater\x20than\x200','expired','processing','user','../config/database','then','30d','../services/paymentLinkService','depositBalance','getMerchantStatistics','disable2FA'];a4_0x36c5=function(){return _0x3354b6;};return a4_0x36c5();}var __createBinding=this&&this['__createBinding']||(Object[a4_0x27b05f(0x15a)]?function(_0x23171b,_0x1686c1,_0x22707e,_0x319b92){const _0x385562=a4_0x27b05f;if(_0x319b92===undefined)_0x319b92=_0x22707e;var _0x1dce58=Object[_0x385562(0x168)](_0x1686c1,_0x22707e);(!_0x1dce58||(_0x385562(0x145)in _0x1dce58?!_0x1686c1[_0x385562(0x150)]:_0x1dce58[_0x385562(0xfe)]||_0x1dce58['configurable']))&&(_0x1dce58={'enumerable':!![],'get':function(){return _0x1686c1[_0x22707e];}}),Object[_0x385562(0xca)](_0x23171b,_0x319b92,_0x1dce58);}:function(_0x5b8229,_0x2d37c0,_0x33f615,_0x39caa8){if(_0x39caa8===undefined)_0x39caa8=_0x33f615;_0x5b8229[_0x39caa8]=_0x2d37c0[_0x33f615];}),__setModuleDefault=this&&this[a4_0x27b05f(0x109)]||(Object[a4_0x27b05f(0x15a)]?function(_0x4ebf1d,_0x578451){const _0x4dbca2=a4_0x27b05f;Object[_0x4dbca2(0xca)](_0x4ebf1d,_0x4dbca2(0xf2),{'enumerable':!![],'value':_0x578451});}:function(_0x7a8f07,_0x43c6ae){const _0x2dfec5=a4_0x27b05f;_0x7a8f07[_0x2dfec5(0xf2)]=_0x43c6ae;}),__importStar=this&&this[a4_0x27b05f(0xf5)]||(function(){var _0x11f414=function(_0x2e153c){const _0x181fc0=a4_0x2861;return _0x11f414=Object[_0x181fc0(0xf7)]||function(_0x1deb07){const _0x486975=_0x181fc0;var _0xaa9fc8=[];for(var _0x4b5ab2 in _0x1deb07)if(Object['prototype']['hasOwnProperty']['call'](_0x1deb07,_0x4b5ab2))_0xaa9fc8[_0xaa9fc8[_0x486975(0x12a)]]=_0x4b5ab2;return _0xaa9fc8;},_0x11f414(_0x2e153c);};return function(_0x50f7fd){const _0x3052b1=a4_0x2861;if(_0x50f7fd&&_0x50f7fd['__esModule'])return _0x50f7fd;var _0xaf679c={};if(_0x50f7fd!=null){for(var _0x78cab=_0x11f414(_0x50f7fd),_0x5040a7=0x0;_0x5040a7<_0x78cab['length'];_0x5040a7++)if(_0x78cab[_0x5040a7]!==_0x3052b1(0xf2))__createBinding(_0xaf679c,_0x50f7fd,_0x78cab[_0x5040a7]);}return __setModuleDefault(_0xaf679c,_0x50f7fd),_0xaf679c;};}()),__importDefault=this&&this['__importDefault']||function(_0xd32bba){const _0x2e79b7=a4_0x27b05f;return _0xd32bba&&_0xd32bba[_0x2e79b7(0x150)]?_0xd32bba:{'default':_0xd32bba};};Object[a4_0x27b05f(0xca)](exports,a4_0x27b05f(0x150),{'value':!![]}),exports['AdminController']=void 0x0;const adminService_1=require(a4_0x27b05f(0x126)),paymentLinkService_1=require(a4_0x27b05f(0xd7)),paymentCleanupService_1=require('../services/paymentCleanupService'),telegramBotService_1=require(a4_0x27b05f(0x130)),gatewaySettingsService_1=require(a4_0x27b05f(0x147)),database_1=__importDefault(require(a4_0x27b05f(0xd4)));function a4_0x2861(_0x512b29,_0x24fd18){_0x512b29=_0x512b29-0xc8;const _0x36c55d=a4_0x36c5();let _0x286152=_0x36c55d[_0x512b29];return _0x286152;}class AdminController{constructor(){const _0x5028f4=a4_0x27b05f;this[_0x5028f4(0x11b)]=async(_0x7aa465,_0x246efb,_0x582ac5)=>{const _0x21ed77=_0x5028f4;try{const _0x505bf6=_0x7aa465['user'];_0x246efb['json']({'success':!![],'message':_0x21ed77(0xfb),'user':{'id':_0x505bf6?.['id'],'username':_0x505bf6?.[_0x21ed77(0x156)],'role':_0x505bf6?.[_0x21ed77(0x176)]}});}catch(_0x5754de){_0x582ac5(_0x5754de);}},this[_0x5028f4(0x167)]=async(_0x5b5e8b,_0x4a491f,_0x1d3b04)=>{const _0xbeb034=_0x5028f4;try{const {period:period=_0xbeb034(0xd6),currentDate:_0x3e4fe4}=_0x5b5e8b[_0xbeb034(0x16a)],_0x56af05=await this[_0xbeb034(0x105)][_0xbeb034(0x111)](period,_0x3e4fe4);_0x4a491f[_0xbeb034(0xe3)]({'success':!![],'result':_0x56af05});}catch(_0x22c92d){_0x1d3b04(_0x22c92d);}},this[_0x5028f4(0xd9)]=async(_0x5401b7,_0x3061cf,_0x1f0327)=>{const _0x21e2a7=_0x5028f4;try{const {shopId:_0x248824,period:period=_0x21e2a7(0x144),dateFrom:_0x9a877e,dateTo:_0x144749}=_0x5401b7[_0x21e2a7(0x16a)],_0x21e663={'shopId':_0x248824,'period':period,'dateFrom':_0x9a877e,'dateTo':_0x144749};console[_0x21e2a7(0xe7)](_0x21e2a7(0xcb),_0x21e663);const _0x4ac1ac=await this['adminService'][_0x21e2a7(0xd9)](_0x21e663);_0x3061cf[_0x21e2a7(0xe3)]({'success':!![],'result':_0x4ac1ac});}catch(_0x5ea570){_0x1f0327(_0x5ea570);}},this[_0x5028f4(0xe4)]=async(_0x288e3d,_0x5137b8,_0xf1aa9f)=>{const _0x1f55a8=_0x5028f4;try{const {periodFrom:_0x3196c2,periodTo:_0x2b149f,gateway:_0x2f6f2c}=_0x288e3d['query'];if(!_0x3196c2||!_0x2b149f||!_0x2f6f2c)return _0x5137b8['status'](0x190)['json']({'success':![],'message':'periodFrom,\x20periodTo,\x20and\x20gateway\x20are\x20required'});console[_0x1f55a8(0xe7)](_0x1f55a8(0x171),{'periodFrom':_0x3196c2,'periodTo':_0x2b149f,'gateway':_0x2f6f2c});const _0x18bea1=await this[_0x1f55a8(0x105)][_0x1f55a8(0xe4)]({'periodFrom':_0x3196c2,'periodTo':_0x2b149f,'gateway':_0x2f6f2c});_0x5137b8[_0x1f55a8(0xe3)]({'success':!![],'reports':_0x18bea1});}catch(_0x2d10ed){_0xf1aa9f(_0x2d10ed);}},this[_0x5028f4(0xdb)]=async(_0x3a19ab,_0x3466b2,_0x1c7145)=>{const _0x51cf5a=_0x5028f4;try{const _0x4bc5fd=await this[_0x51cf5a(0x105)]['getPayoutStats']();_0x3466b2[_0x51cf5a(0xe3)]({'success':!![],'result':_0x4bc5fd});}catch(_0x4c3081){_0x1c7145(_0x4c3081);}},this[_0x5028f4(0xdf)]=async(_0x2e9e6b,_0x44df79,_0x30d8c6)=>{const _0x2cdb16=_0x5028f4;try{const {page:page=0x1,limit:limit=0x14,minAmount:_0xceedb5,search:_0x285ad1}=_0x2e9e6b[_0x2cdb16(0x16a)],_0x1cc02a={'page':Number(page),'limit':Number(limit),'minAmount':_0xceedb5?Number(_0xceedb5):undefined,'search':_0x285ad1},_0x211807=await this[_0x2cdb16(0x105)]['getMerchantsAwaitingPayout'](_0x1cc02a);_0x44df79[_0x2cdb16(0xe3)]({'success':!![],'merchants':_0x211807[_0x2cdb16(0x16f)],'pagination':_0x211807['pagination'],'summary':_0x211807[_0x2cdb16(0x127)]});}catch(_0x2f836e){_0x30d8c6(_0x2f836e);}},this[_0x5028f4(0xe0)]=async(_0x5cecf6,_0x5cdc98,_0x19f0ba)=>{const _0x5c1910=_0x5028f4;try{const _0x5b610d=_0x5cecf6[_0x5c1910(0x16a)][_0x5c1910(0x101)]===_0x5c1910(0xde),_0xaa1c5a=await this['adminService'][_0x5c1910(0xe0)](_0x5b610d);_0x5cdc98[_0x5c1910(0xe3)]({'success':!![],'result':_0xaa1c5a});}catch(_0x25eb5e){_0x19f0ba(_0x25eb5e);}},this[_0x5028f4(0x108)]=async(_0x559e29,_0x5ed0a1,_0x329afe)=>{const _0x49458f=_0x5028f4;try{const _0x6e4bef=_0x559e29[_0x49458f(0x17a)];console[_0x49458f(0xe7)]('üéØ\x20[CONTROLLER]\x20Creating\x20payout\x20with\x20data:',_0x6e4bef);const _0x390a0c=await this['adminService'][_0x49458f(0x108)](_0x6e4bef);_0x5ed0a1[_0x49458f(0xe6)](0xc9)['json']({'success':!![],'message':'Payout\x20created\x20successfully','result':_0x390a0c});}catch(_0x57554b){_0x329afe(_0x57554b);}},this[_0x5028f4(0x142)]=async(_0x51a106,_0x167561,_0x2a6f97)=>{const _0x1a2ba3=_0x5028f4;try{const {id:_0x9529a2}=_0x51a106[_0x1a2ba3(0x16d)],_0x1aa11d=_0x51a106['body'];console['log'](_0x1a2ba3(0x16c)+_0x9529a2+_0x1a2ba3(0xf8),_0x1aa11d);const _0x3ae300=await this[_0x1a2ba3(0x105)]['updatePayout'](_0x9529a2,_0x1aa11d);_0x167561[_0x1a2ba3(0xe3)]({'success':!![],'message':_0x1a2ba3(0x149),'result':_0x3ae300});}catch(_0x38b9e2){_0x2a6f97(_0x38b9e2);}},this[_0x5028f4(0xdd)]=async(_0x2b4870,_0x5953f0,_0x45fa34)=>{const _0x4534a7=_0x5028f4;try{const {page:page=0x1,limit:limit=0x14,shopId:_0x3e08f9,network:_0x335418,dateFrom:_0x599dde,dateTo:_0x2b11d5,search:_0x41208a}=_0x2b4870[_0x4534a7(0x16a)],_0x35ffb0={'page':Number(page),'limit':Number(limit),'shopId':_0x3e08f9,'network':_0x335418,'dateFrom':_0x599dde,'dateTo':_0x2b11d5,'search':_0x41208a},_0x367cf6=await this[_0x4534a7(0x105)][_0x4534a7(0x12f)](_0x35ffb0);_0x5953f0[_0x4534a7(0xe3)]({'success':!![],'payouts':_0x367cf6[_0x4534a7(0x166)],'pagination':_0x367cf6[_0x4534a7(0x179)]});}catch(_0x2a4d5d){_0x45fa34(_0x2a4d5d);}},this[_0x5028f4(0xc8)]=async(_0x2ed96f,_0x5db34c,_0x4bfc5b)=>{const _0x4cb7c9=_0x5028f4;try{const {id:_0x1e9db2}=_0x2ed96f[_0x4cb7c9(0x16d)],_0x493469=await this[_0x4cb7c9(0x105)][_0x4cb7c9(0xc8)](_0x1e9db2);if(!_0x493469)return _0x5db34c[_0x4cb7c9(0xe6)](0x194)[_0x4cb7c9(0xe3)]({'success':![],'message':'Payout\x20not\x20found'});_0x5db34c[_0x4cb7c9(0xe3)]({'success':!![],'result':_0x493469});}catch(_0x25a4ea){_0x4bfc5b(_0x25a4ea);}},this[_0x5028f4(0xec)]=async(_0x24f0c5,_0x5f1051,_0x46682d)=>{const _0xda9a8b=_0x5028f4;try{const {id:_0x433094}=_0x24f0c5['params'];await this['adminService'][_0xda9a8b(0xec)](_0x433094),_0x5f1051[_0xda9a8b(0xe3)]({'success':!![],'message':'Payout\x20deleted\x20successfully'});}catch(_0x4d88e){_0x46682d(_0x4d88e);}},this['getPayments']=async(_0x5482a6,_0x5832c6,_0x545616)=>{const _0x545ce4=_0x5028f4;try{const {page:page=0x1,limit:limit=0x14,status:_0x2f0c85,gateway:_0x3013eb,shopId:_0x33aba1,dateFrom:_0x57a77d,dateTo:_0x9bb3d1,search:_0xdba18c,currency:_0x2452e4,sortBy:_0x3fb655,sortOrder:_0x2630a}=_0x5482a6[_0x545ce4(0x16a)],_0x25bdc5={'page':Number(page),'limit':Number(limit),'status':_0x2f0c85,'gateway':_0x3013eb,'shopId':_0x33aba1,'dateFrom':_0x57a77d,'dateTo':_0x9bb3d1,'search':_0xdba18c,'currency':_0x2452e4,'sortBy':_0x3fb655,'sortOrder':_0x2630a},_0x426e4c=await this[_0x545ce4(0x105)][_0x545ce4(0x178)](_0x25bdc5);_0x5832c6[_0x545ce4(0xe3)]({'success':!![],'payments':_0x426e4c[_0x545ce4(0x17c)],'pagination':_0x426e4c[_0x545ce4(0x179)],'statistics':_0x426e4c[_0x545ce4(0x10a)]});}catch(_0xe462c3){_0x545616(_0xe462c3);}},this['getPaymentById']=async(_0x3c177f,_0x5f2c45,_0x29d938)=>{const _0x3adcdc=_0x5028f4;try{const {id:_0x7725f3}=_0x3c177f[_0x3adcdc(0x16d)],_0x3df3d7=await this[_0x3adcdc(0x105)][_0x3adcdc(0xdc)](_0x7725f3);if(!_0x3df3d7)return _0x5f2c45[_0x3adcdc(0xe6)](0x194)[_0x3adcdc(0xe3)]({'success':![],'message':_0x3adcdc(0xed)});_0x5f2c45[_0x3adcdc(0xe3)]({'success':!![],'result':_0x3df3d7});}catch(_0x48cd31){_0x29d938(_0x48cd31);}},this[_0x5028f4(0xfc)]=async(_0x24a9bb,_0x4505aa,_0x1dd6e4)=>{const _0x350812=_0x5028f4;try{const {id:_0xdfc1b3}=_0x24a9bb[_0x350812(0x16d)],{status:_0x37d687,notes:_0x208cf3,chargebackAmount:_0x2b8933}=_0x24a9bb[_0x350812(0x17a)],_0x16dba4=await this[_0x350812(0x105)]['getPaymentById'](_0xdfc1b3);if(!_0x16dba4)return _0x4505aa[_0x350812(0xe6)](0x194)[_0x350812(0xe3)]({'success':![],'message':'Payment\x20not\x20found'});const _0x52646a=await this[_0x350812(0x105)][_0x350812(0x120)](_0xdfc1b3,_0x37d687,_0x208cf3,_0x2b8933);if(_0x16dba4[_0x350812(0xe6)]!==_0x37d687&&_0x37d687[_0x350812(0xf9)]()===_0x350812(0xf4)){console[_0x350812(0xe7)](_0x350812(0x118)+_0xdfc1b3+_0x350812(0x137));try{await this['paymentLinkService'][_0x350812(0x132)](_0xdfc1b3),console[_0x350812(0xe7)](_0x350812(0x110)+_0xdfc1b3);}catch(_0x55e4ac){console[_0x350812(0x143)](_0x350812(0x133),_0x55e4ac);}}if(_0x16dba4[_0x350812(0xe6)]!==_0x37d687){console['log'](_0x350812(0xe8)+_0xdfc1b3+'\x20status\x20changed\x20from\x20'+_0x16dba4[_0x350812(0xe6)]+_0x350812(0x174)+_0x37d687+_0x350812(0xe2));try{let _0x312050;switch(_0x37d687[_0x350812(0xf9)]()){case'PAID':_0x312050=_0x350812(0x11a);break;case _0x350812(0xf0):_0x312050=_0x350812(0xd2);break;case _0x350812(0x13b):_0x312050='failed';break;case _0x350812(0xff):_0x312050=_0x350812(0xd1);break;case _0x350812(0x14b):_0x312050=_0x350812(0xeb);break;case'CHARGEBACK':_0x312050=_0x350812(0x15f);break;default:console[_0x350812(0xe7)](_0x350812(0xf3)+_0x37d687);break;}if(_0x312050){const _0x3f96ce={..._0x52646a,'shopId':_0x16dba4['shopId'],'gateway':_0x16dba4[_0x350812(0xef)],'createdAt':_0x16dba4['createdAt'],'chargebackAmount':_0x2b8933};await telegramBotService_1[_0x350812(0xcd)]['sendPaymentNotification'](_0x16dba4[_0x350812(0x10b)],_0x3f96ce,_0x312050),console[_0x350812(0xe7)]('‚úÖ\x20Telegram\x20notification\x20sent\x20for\x20status\x20change:\x20'+_0x16dba4[_0x350812(0xe6)]+_0x350812(0x11e)+_0x37d687);}}catch(_0x140a5e){console[_0x350812(0x143)](_0x350812(0x158),_0x140a5e);}}_0x4505aa[_0x350812(0xe3)]({'success':!![],'message':_0x350812(0x16e),'result':_0x52646a});}catch(_0xac871a){_0x1dd6e4(_0xac871a);}},this[_0x5028f4(0x13f)]=async(_0x1ac3f1,_0x2ac560,_0x4811ec)=>{const _0x19b407=_0x5028f4;try{const {id:_0xdb9648}=_0x1ac3f1[_0x19b407(0x16d)],_0x27bd5e=_0x1ac3f1[_0x19b407(0x17a)];console[_0x19b407(0xe7)](_0x19b407(0xf1)+_0xdb9648+':',_0x27bd5e);const _0x484cda=await this[_0x19b407(0x105)][_0x19b407(0x13f)](_0xdb9648,_0x27bd5e);_0x2ac560['json']({'success':!![],'message':_0x19b407(0x13c),'result':_0x484cda});}catch(_0x498e32){_0x4811ec(_0x498e32);}},this['updateUser']=async(_0x432a85,_0x32f487,_0x204b25)=>{const _0x503ca2=_0x5028f4;try{const {id:_0x946901}=_0x432a85[_0x503ca2(0x16d)],_0x2e9334=_0x432a85[_0x503ca2(0x17a)],_0x4c4b8a=await this[_0x503ca2(0x105)][_0x503ca2(0x172)](_0x946901,_0x2e9334);_0x32f487[_0x503ca2(0xe3)]({'success':!![],'message':_0x503ca2(0x163),'result':_0x4c4b8a});}catch(_0x134850){_0x204b25(_0x134850);}},this[_0x5028f4(0x114)]=async(_0x510832,_0x156559,_0x168bb7)=>{const _0x298bbb=_0x5028f4;try{const {id:_0x1d9815}=_0x510832[_0x298bbb(0x16d)],_0xfe14c9=await this[_0x298bbb(0x105)]['suspendUser'](_0x1d9815);_0x156559['json']({'success':!![],'message':_0x298bbb(0x116),'result':_0xfe14c9});}catch(_0x19a33e){_0x168bb7(_0x19a33e);}},this['activateUser']=async(_0x3300ce,_0x4ec5d3,_0x20afb8)=>{const _0x2f37f3=_0x5028f4;try{const {id:_0xa0fb97}=_0x3300ce[_0x2f37f3(0x16d)],_0x87c99c=await this[_0x2f37f3(0x105)][_0x2f37f3(0x153)](_0xa0fb97);_0x4ec5d3[_0x2f37f3(0xe3)]({'success':!![],'message':'User\x20activated\x20successfully','result':_0x87c99c});}catch(_0x506c5c){_0x20afb8(_0x506c5c);}},this[_0x5028f4(0x15d)]=async(_0x2b8644,_0x2a4af2,_0x4a87cc)=>{const _0x43182b=_0x5028f4;try{const {page:page=0x1,limit:limit=0x14,status:_0x34c5ed,search:_0x56b374}=_0x2b8644[_0x43182b(0x16a)],_0x118c03={'page':Number(page),'limit':Number(limit),'status':_0x34c5ed,'search':_0x56b374},_0x27a9c4=await this[_0x43182b(0x105)]['getAllUsers'](_0x118c03);_0x2a4af2[_0x43182b(0xe3)]({'success':!![],'users':_0x27a9c4[_0x43182b(0xce)],'pagination':_0x27a9c4[_0x43182b(0x179)]});}catch(_0x299d08){_0x4a87cc(_0x299d08);}},this[_0x5028f4(0x11f)]=async(_0x12a39e,_0x759a07,_0x2cf6ab)=>{const _0x16b6d8=_0x5028f4;try{const {id:_0xb76671}=_0x12a39e['params'],_0xfd9240=await this['adminService'][_0x16b6d8(0x11f)](_0xb76671);if(!_0xfd9240)return _0x759a07['status'](0x194)[_0x16b6d8(0xe3)]({'success':![],'message':_0x16b6d8(0x17b)});_0x759a07[_0x16b6d8(0xe3)]({'success':!![],'result':_0xfd9240});}catch(_0x52f5e1){_0x2cf6ab(_0x52f5e1);}},this[_0x5028f4(0x11c)]=async(_0x56e33f,_0x1f3e88,_0x2c1891)=>{const _0x5cd65f=_0x5028f4;try{const _0x32b756=_0x56e33f[_0x5cd65f(0x17a)],_0xa58d26=await this['adminService'][_0x5cd65f(0x11c)](_0x32b756);_0x1f3e88[_0x5cd65f(0xe6)](0xc9)[_0x5cd65f(0xe3)]({'success':!![],'message':_0x5cd65f(0x14c),'result':_0xa58d26});}catch(_0x123e85){_0x2c1891(_0x123e85);}},this['deleteUser']=async(_0x2e673a,_0x167a70,_0x36db86)=>{const _0x17a5fb=_0x5028f4;try{const {id:_0x141b94}=_0x2e673a['params'],{twoFactorToken:_0x1764d6}=_0x2e673a['body'];await this[_0x17a5fb(0x105)]['deleteUser'](_0x141b94,_0x1764d6),_0x167a70[_0x17a5fb(0xe3)]({'success':!![],'message':_0x17a5fb(0x10e)});}catch(_0x3463fb){_0x36db86(_0x3463fb);}},this[_0x5028f4(0x13a)]=async(_0x2be176,_0x1a7c5f,_0x1d78ad)=>{const _0x3b10c2=_0x5028f4;try{const {shopId:_0x4ddd18}=_0x2be176[_0x3b10c2(0x16d)],_0x27f7a0=await this[_0x3b10c2(0x105)][_0x3b10c2(0x13a)](_0x4ddd18);_0x1a7c5f[_0x3b10c2(0xe3)]({'success':!![],'wallets':_0x27f7a0});}catch(_0x25e95a){_0x1d78ad(_0x25e95a);}},this['setup2FA']=async(_0x3f108b,_0x49a165,_0x3354aa)=>{const _0x393715=_0x5028f4;try{const {shopId:_0x478523}=_0x3f108b[_0x393715(0x16d)],_0x489ad5=await this[_0x393715(0x105)][_0x393715(0x152)](_0x478523);_0x49a165['json']({'success':!![],'result':_0x489ad5});}catch(_0x4680d9){_0x3354aa(_0x4680d9);}},this[_0x5028f4(0x175)]=async(_0x185467,_0x26d68e,_0x4f21d6)=>{const _0x4d63a8=_0x5028f4;try{const {shopId:_0x2f41fc}=_0x185467[_0x4d63a8(0x16d)],{token:_0x36dc3b}=_0x185467[_0x4d63a8(0x17a)];if(!_0x36dc3b)return _0x26d68e['status'](0x190)['json']({'success':![],'message':_0x4d63a8(0xe5)});const _0x473bc8=await this['adminService'][_0x4d63a8(0x175)](_0x2f41fc,_0x36dc3b);_0x26d68e[_0x4d63a8(0xe3)]({'success':!![],'message':_0x4d63a8(0x169),'result':_0x473bc8});}catch(_0x5a671f){_0x4f21d6(_0x5a671f);}},this[_0x5028f4(0xda)]=async(_0x342b2f,_0x524cf0,_0x2f2f01)=>{const _0x57cf2b=_0x5028f4;try{const {shopId:_0x59f918}=_0x342b2f['params'];await this[_0x57cf2b(0x105)]['disable2FA'](_0x59f918),_0x524cf0[_0x57cf2b(0xe3)]({'success':!![],'message':_0x57cf2b(0x173)});}catch(_0x309b01){_0x2f2f01(_0x309b01);}},this['getProcessingPaymentsStats']=async(_0x45e0cd,_0x3ba5fc,_0x21c30f)=>{const _0x43c900=_0x5028f4;try{const _0x1e165a=await paymentCleanupService_1[_0x43c900(0x10d)][_0x43c900(0x134)]();_0x3ba5fc['json']({'success':!![],'result':_0x1e165a});}catch(_0x1f8610){_0x21c30f(_0x1f8610);}},this[_0x5028f4(0x10c)]=async(_0x245e46,_0x22ded3,_0x581459)=>{const _0xe8c45a=_0x5028f4;try{console['log']('üßπ\x20Manual\x20PROCESSING\x20payment\x20cleanup\x20initiated\x20by\x20admin:\x20'+_0x245e46[_0xe8c45a(0xd3)]?.['username']+'\x20('+_0x245e46['user']?.['id']+')');const _0x277798=await paymentCleanupService_1[_0xe8c45a(0x10d)][_0xe8c45a(0xfa)]();_0x22ded3[_0xe8c45a(0xe3)]({'success':!![],'message':'PROCESSING\x20payment\x20cleanup\x20completed\x20successfully','result':{'processed':_0x277798[_0xe8c45a(0x177)],'failed':_0x277798[_0xe8c45a(0x135)],'errors':_0x277798[_0xe8c45a(0x106)]}});}catch(_0x453202){_0x581459(_0x453202);}},this[_0x5028f4(0x12c)]=async(_0x220a66,_0x391de6,_0x11c771)=>{const _0x9b246c=_0x5028f4;try{console['log'](_0x9b246c(0x155)+_0x220a66[_0x9b246c(0xd3)]?.['username']+'\x20('+_0x220a66[_0x9b246c(0xd3)]?.['id']+')');const _0x33b9ed=await paymentCleanupService_1[_0x9b246c(0x10d)][_0x9b246c(0x12c)]();_0x391de6[_0x9b246c(0xe3)]({'success':!![],'message':_0x9b246c(0x14f),'result':{'processed':_0x33b9ed['processed'],'failed':_0x33b9ed[_0x9b246c(0x135)],'errors':_0x33b9ed[_0x9b246c(0x106)]}});}catch(_0x4c1913){_0x11c771(_0x4c1913);}},this[_0x5028f4(0x161)]=async(_0x22bd85,_0x2d07de,_0x7f7120)=>{const _0x282c0b=_0x5028f4;try{console['log'](_0x282c0b(0x128)+_0x22bd85[_0x282c0b(0xd3)]?.[_0x282c0b(0x156)]+'\x20('+_0x22bd85['user']?.['id']+')');const _0x2aa951=await paymentCleanupService_1['paymentCleanupService']['getProcessingPaymentsStats'](),_0x2f23c2=await paymentCleanupService_1['paymentCleanupService'][_0x282c0b(0xfa)](),_0x3897cc=await paymentCleanupService_1['paymentCleanupService'][_0x282c0b(0x12c)](),_0x200b8a=await paymentCleanupService_1[_0x282c0b(0x10d)]['getProcessingPaymentsStats']();_0x2d07de[_0x282c0b(0xe3)]({'success':!![],'message':_0x282c0b(0x14d),'result':{'cleanup':{'processing':{'processed':_0x2f23c2[_0x282c0b(0x177)],'failed':_0x2f23c2[_0x282c0b(0x135)],'errors':_0x2f23c2[_0x282c0b(0x106)]},'pending':{'processed':_0x3897cc[_0x282c0b(0x177)],'failed':_0x3897cc[_0x282c0b(0x135)],'errors':_0x3897cc[_0x282c0b(0x106)]},'total':{'processed':_0x2f23c2[_0x282c0b(0x177)]+_0x3897cc[_0x282c0b(0x177)],'failed':_0x2f23c2[_0x282c0b(0x135)]+_0x3897cc[_0x282c0b(0x135)],'errors':[..._0x2f23c2[_0x282c0b(0x106)],..._0x3897cc[_0x282c0b(0x106)]]}},'statistics':{'before':_0x2aa951,'after':_0x200b8a,'reduced':_0x2aa951['total']-_0x200b8a[_0x282c0b(0x12b)]}}});}catch(_0x1794ef){_0x7f7120(_0x1794ef);}},this[_0x5028f4(0x10f)]=async(_0x199ce0,_0x42a232,_0x20353c)=>{const _0x45d119=_0x5028f4;try{const _0x5da51c=await paymentCleanupService_1['paymentCleanupService'][_0x45d119(0x12d)]();_0x42a232[_0x45d119(0xe3)]({'success':!![],'message':_0x45d119(0xe1),'result':{'expired':_0x5da51c[_0x45d119(0xd1)],'errors':_0x5da51c['errors']}});}catch(_0x18c9ab){_0x20353c(_0x18c9ab);}},this[_0x5028f4(0xea)]=async(_0x1fca67,_0x5f0360,_0x18cab6)=>{const _0x5cdfe4=_0x5028f4;try{const {currentPassword:_0x38e12b,newPassword:_0x1c1b8a,confirmNewPassword:_0x38ce66,twoFactorToken:_0x5a0771}=_0x1fca67[_0x5cdfe4(0x17a)];await this[_0x5cdfe4(0x105)][_0x5cdfe4(0xea)](_0x38e12b,_0x1c1b8a,_0x38ce66,_0x5a0771),_0x5f0360[_0x5cdfe4(0xe3)]({'success':!![],'message':_0x5cdfe4(0x113)});}catch(_0x2161fe){_0x18cab6(_0x2161fe);}},this[_0x5028f4(0x141)]=async(_0x58ad59,_0x2fbb83,_0x59925b)=>{const _0x5f3571=_0x5028f4;try{const _0x273ea9=await this[_0x5f3571(0x105)][_0x5f3571(0x141)]();_0x2fbb83['json']({'success':!![],'result':_0x273ea9});}catch(_0x321de6){_0x59925b(_0x321de6);}},this[_0x5028f4(0x125)]=async(_0x59fe2c,_0x126040,_0x28d3fd)=>{const _0x4aa2dc=_0x5028f4;try{const _0x203ed9=await this[_0x4aa2dc(0x105)][_0x4aa2dc(0x125)]();_0x126040[_0x4aa2dc(0xe3)]({'success':!![],'result':_0x203ed9});}catch(_0x838bb7){_0x28d3fd(_0x838bb7);}},this[_0x5028f4(0x117)]=async(_0x2e14c3,_0x50250a,_0x1a04ef)=>{const _0x2d0a1c=_0x5028f4;try{const {token:_0x1ca53b}=_0x2e14c3[_0x2d0a1c(0x17a)],_0x43c742=await this[_0x2d0a1c(0x105)][_0x2d0a1c(0x117)](_0x1ca53b);_0x50250a[_0x2d0a1c(0xe3)]({'success':!![],'result':_0x43c742});}catch(_0x56ea1a){_0x1a04ef(_0x56ea1a);}},this[_0x5028f4(0x148)]=async(_0x3e768f,_0x2cbb42,_0x355fe6)=>{const _0x4cf6b3=_0x5028f4;try{await this[_0x4cf6b3(0x105)][_0x4cf6b3(0x148)](),_0x2cbb42['json']({'success':!![],'message':_0x4cf6b3(0x100)});}catch(_0x29409d){_0x355fe6(_0x29409d);}},this[_0x5028f4(0xd8)]=async(_0x3e419a,_0x4a057e,_0x5a66e5)=>{const _0x297f70=_0x5028f4;try{const {shopId:_0xf3fbbb,amount:_0x4df4f9,notes:_0x23a184}=_0x3e419a[_0x297f70(0x17a)];if(!_0xf3fbbb||!_0x4df4f9)return _0x4a057e[_0x297f70(0xe6)](0x190)['json']({'success':![],'message':_0x297f70(0x131)});if(_0x4df4f9<=0x0)return _0x4a057e[_0x297f70(0xe6)](0x190)[_0x297f70(0xe3)]({'success':![],'message':_0x297f70(0xd0)});await this[_0x297f70(0x105)][_0x297f70(0xd8)](_0xf3fbbb,_0x4df4f9,_0x23a184),_0x4a057e[_0x297f70(0xe3)]({'success':!![],'message':'Balance\x20deposited\x20successfully'});}catch(_0x5b3a02){_0x5a66e5(_0x5b3a02);}},this[_0x5028f4(0x13d)]=async(_0x12e997,_0xb13e5,_0x26fb73)=>{const _0x413cb4=_0x5028f4;try{const {shopId:_0x201a1f}=_0x12e997[_0x413cb4(0x16d)],{page:page='1',limit:limit='20'}=_0x12e997['query'],_0x24bef4=(await Promise[_0x413cb4(0x129)]()[_0x413cb4(0xd5)](()=>__importStar(require(_0x413cb4(0xd4)))))[_0x413cb4(0xf2)],_0x6e9c32=parseInt(page,0xa),_0x31b372=parseInt(limit,0xa),_0x1d393e=(_0x6e9c32-0x1)*_0x31b372,[_0x219b89,_0x4673fc]=await Promise['all']([_0x24bef4['loginLog'][_0x413cb4(0x136)]({'where':{'shopId':_0x201a1f},'orderBy':{'createdAt':_0x413cb4(0x11d)},'skip':_0x1d393e,'take':_0x31b372}),_0x24bef4[_0x413cb4(0x15b)][_0x413cb4(0x15c)]({'where':{'shopId':_0x201a1f}})]);_0xb13e5[_0x413cb4(0xe3)]({'success':!![],'result':{'logs':_0x219b89,'pagination':{'page':_0x6e9c32,'limit':_0x31b372,'total':_0x4673fc,'totalPages':Math['ceil'](_0x4673fc/_0x31b372)}}});}catch(_0x257882){_0x26fb73(_0x257882);}},this[_0x5028f4(0x112)]=async(_0x3a85eb,_0x21d2bf,_0x462814)=>{const _0x3a8c2b=_0x5028f4;try{const _0x132031=gatewaySettingsService_1[_0x3a8c2b(0xcf)][_0x3a8c2b(0x160)]();_0x21d2bf[_0x3a8c2b(0xe3)]({'success':!![],'result':_0x132031});}catch(_0x1885bc){_0x462814(_0x1885bc);}},this[_0x5028f4(0x124)]=async(_0x41dcee,_0x1c57e0,_0x272680)=>{const _0x36b408=_0x5028f4;try{const {gatewayId:_0x5c8fd8}=_0x41dcee['params'],{minAmount:_0x2fc987,maxAmount:_0x3ccef5,payoutDelay:_0x1f9691,gatewayCommission:_0x44d118}=_0x41dcee[_0x36b408(0x17a)],_0x150eda=gatewaySettingsService_1[_0x36b408(0xcf)]['updateSettings'](_0x5c8fd8,{'minAmount':_0x2fc987!==undefined?Number(_0x2fc987):undefined,'maxAmount':_0x3ccef5!==undefined?Number(_0x3ccef5):undefined,'payoutDelay':_0x1f9691!==undefined?Number(_0x1f9691):undefined,'gatewayCommission':_0x44d118!==undefined?Number(_0x44d118):undefined});_0x1c57e0[_0x36b408(0xe3)]({'success':!![],'message':_0x36b408(0x154),'result':_0x150eda});}catch(_0x5a561c){_0x272680(_0x5a561c);}},this['getGatewayStatistics']=async(_0x18a42f,_0x4e3f7a,_0x4cfa2f)=>{const _0x557ad8=_0x5028f4;try{const {gatewayId:_0x3a5395}=_0x18a42f['params'];console[_0x557ad8(0xe7)]('üìä\x20[GATEWAY\x20STATS]\x20Requesting\x20statistics\x20for\x20gateway\x20ID:\x20'+_0x3a5395);const {GATEWAY_ID_MAP:_0x22381f}=await Promise[_0x557ad8(0x129)]()[_0x557ad8(0xd5)](()=>__importStar(require(_0x557ad8(0x15e)))),_0x2add71=_0x22381f[_0x3a5395];console[_0x557ad8(0xe7)]('üìä\x20[GATEWAY\x20STATS]\x20Gateway\x20ID\x20'+_0x3a5395+_0x557ad8(0x121)+_0x2add71);if(!_0x2add71)return console[_0x557ad8(0xe7)]('‚ùå\x20[GATEWAY\x20STATS]\x20Gateway\x20not\x20found\x20for\x20ID:\x20'+_0x3a5395),_0x4e3f7a[_0x557ad8(0xe6)](0x194)[_0x557ad8(0xe3)]({'success':![],'message':'Gateway\x20not\x20found'});console['log'](_0x557ad8(0x170)+_0x2add71+'\x22\x20and\x20status=\x22PAID\x22');const _0x3a2491=await database_1[_0x557ad8(0xf2)][_0x557ad8(0xcc)]['findMany']({'where':{'gateway':_0x2add71},'select':{'id':!![],'status':!![],'amountUSDT':!![]},'take':0x5});console[_0x557ad8(0xe7)](_0x557ad8(0x13e)+_0x2add71+':',JSON[_0x557ad8(0x122)](_0x3a2491,null,0x2));const _0x4f461f=await database_1[_0x557ad8(0xf2)][_0x557ad8(0xcc)]['findMany']({'where':{'gateway':_0x2add71,'status':_0x557ad8(0xf4)},'select':{'amountUSDT':!![]}});console[_0x557ad8(0xe7)](_0x557ad8(0x14a)+_0x4f461f['length']+_0x557ad8(0x157)+_0x2add71);const _0x2abfb9=await database_1[_0x557ad8(0xf2)]['payment'][_0x557ad8(0x15c)]({'where':{'gateway':_0x2add71,'status':_0x557ad8(0xf4)}}),_0x85c7e1=await database_1['default']['payment'][_0x557ad8(0x15c)]({'where':{'gateway':_0x2add71,'status':_0x557ad8(0x162)}});console[_0x557ad8(0xe7)]('üîô\x20[GATEWAY\x20STATS]\x20Chargeback\x20count:\x20'+_0x85c7e1);const _0xbb1f28=await database_1[_0x557ad8(0xf2)][_0x557ad8(0xcc)][_0x557ad8(0x15c)]({'where':{'gateway':_0x2add71,'status':_0x557ad8(0x14b)}});console[_0x557ad8(0xe7)](_0x557ad8(0xfd)+_0xbb1f28);const {gatewaySettingsService:_0xd27862}=await Promise[_0x557ad8(0x129)]()[_0x557ad8(0xd5)](()=>__importStar(require(_0x557ad8(0x147)))),_0x593fb0=_0xd27862[_0x557ad8(0x16b)](_0x3a5395),_0x2e4a97=_0x593fb0?.[_0x557ad8(0x104)]||0x0;console[_0x557ad8(0xe7)](_0x557ad8(0x146)+_0x2e4a97+'%');let _0x1fe76a=0x0,_0x56809c=0x0;_0x4f461f['forEach'](_0x4c4bd4=>{const _0x5e6ff8=_0x557ad8,_0x4d9561=_0x4c4bd4[_0x5e6ff8(0x103)]||0x0;_0x1fe76a+=_0x4d9561;const _0x2f9292=_0x4d9561*(_0x2e4a97/0x64);_0x56809c+=_0x2f9292;});const _0xad652f=_0x2abfb9,_0x4f7476=_0xad652f>0x0?_0x85c7e1/_0xad652f*0x64:0x0;console[_0x557ad8(0xe7)]('üìà\x20[GATEWAY\x20STATS]\x20Calculated\x20statistics:'),console[_0x557ad8(0xe7)](_0x557ad8(0x12e)+_0x1fe76a),console['log'](_0x557ad8(0x102)+_0x56809c),console[_0x557ad8(0xe7)](_0x557ad8(0x159)+_0xad652f),console[_0x557ad8(0xe7)](_0x557ad8(0x164)+_0x4f7476+'%'),_0x4e3f7a[_0x557ad8(0xe3)]({'success':!![],'result':{'gatewayId':_0x3a5395,'totalTurnover':Number(_0x1fe76a['toFixed'](0x2)),'totalCommission':Number(_0x56809c[_0x557ad8(0x107)](0x2)),'successfulPayments':_0xad652f,'chargebackCount':_0x85c7e1,'chargebackRate':Number(_0x4f7476['toFixed'](0x2)),'refundCount':_0xbb1f28}});}catch(_0x49945c){console[_0x557ad8(0x143)]('‚ùå\x20[GATEWAY\x20STATS]\x20Error:',_0x49945c),_0x4cfa2f(_0x49945c);}},this[_0x5028f4(0x105)]=new adminService_1['AdminService'](),this[_0x5028f4(0x119)]=new paymentLinkService_1[(_0x5028f4(0x115))]();}}exports[a4_0x27b05f(0x151)]=AdminController;