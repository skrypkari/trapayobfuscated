'use strict';function a3_0x63e7(){const _0x114f18=['PAID','32NIdBvS','User\x20activated\x20successfully','updatePaymentStatus','ðŸ“Š\x20Manual\x20payment\x20cleanup\x20with\x20report\x20initiated\x20by\x20admin:\x20','User\x20suspended\x20successfully','defineProperty','role','updateCustomerData','Payout\x20deleted\x20successfully','Customer\x20data\x20updated\x20successfully','FAILED','getUserById','Payment\x20cleanup\x20with\x20report\x20completed\x20successfully','status','getPaymentById','getProcessingPaymentsStats','âœ…\x20Payment\x20link\x20counter\x20updated\x20for\x20payment\x20','ðŸ“Š\x20Admin\x20requesting\x20merchant\x20statistics\x20with\x20filters:','createdAt','ðŸ§¹\x20Manual\x20payment\x20cleanup\x20initiated\x20by\x20admin:\x20','../services/telegramBotService','query','getUsers','getMerchantsSelection','User\x20updated\x20successfully','ðŸ“±\x20Payment\x20','User\x20not\x20found','50270SQMGOM','9270cdfPDH','checkAuth','total','Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20status\x20change:','4716NrfKnm','432117lImqmr','log','updateUser','cleanupStalePayments','Payment\x20not\x20found','CHARGEBACK','telegramBotService','users','\x20to\x20','json','User\x20created\x20successfully','getPayments','getMerchantStatistics','summary','failed','paymentCleanupService','processed','createPayout','PaymentLinkService','ðŸ”„\x20Admin\x20updating\x20customer\x20data\x20for\x20payment\x20','suspendUser','4980468PMXjgy','../services/paymentCleanupService','deletePayout',',\x20sending\x20Telegram\x20notification','deleteUser','getPayouts','payouts','user','shopId','getSystemStatistics','5eDZTcb','4032912DEdSCP','params','errors','551244iHYxBW','paid','getPayoutStats','Failed\x20to\x20update\x20payment\x20link\x20counter:','getMerchantsAwaitingPayout','cleanupStaleProcessingPayments','Payout\x20not\x20found','body','AdminService','User\x20deleted\x20successfully','paymentLinkService','createUser','getAllUsers','âœ…\x20Telegram\x20notification\x20sent\x20for\x20status\x20change:\x20','5398815VfrIwR','\x20->\x20','AdminController','activateUser','Payout\x20created\x20successfully','6237xMoKvE','REFUND','getPayoutById','month','cleanupStalePaymentsWithReport','pagination','username','toUpperCase','Payment\x20updated\x20successfully','getAllPayouts','../services/adminService','getStatistics','30d','ðŸ“±\x20Skipping\x20Telegram\x20notification\x20for\x20status\x20change\x20to:\x20','adminService','\x20to\x20PAID,\x20updating\x20payment\x20link\x20counter','ðŸ“ˆ\x20Admin\x20changed\x20payment\x20','chargeback'];a3_0x63e7=function(){return _0x114f18;};return a3_0x63e7();}const a3_0x12b8c4=a3_0x1a88;function a3_0x1a88(_0xc2b564,_0x530c10){const _0x63e7b8=a3_0x63e7();return a3_0x1a88=function(_0x1a88e3,_0x4b9c58){_0x1a88e3=_0x1a88e3-0x1d0;let _0x28f534=_0x63e7b8[_0x1a88e3];return _0x28f534;},a3_0x1a88(_0xc2b564,_0x530c10);}(function(_0xaa391c,_0x3446aa){const _0xc17fdd=a3_0x1a88,_0x553712=_0xaa391c();while(!![]){try{const _0xd6efe5=-parseInt(_0xc17fdd(0x212))/0x1*(-parseInt(_0xc17fdd(0x216))/0x2)+-parseInt(_0xc17fdd(0x208))/0x3+-parseInt(_0xc17fdd(0x213))/0x4+-parseInt(_0xc17fdd(0x224))/0x5+-parseInt(_0xc17fdd(0x1f2))/0x6*(parseInt(_0xc17fdd(0x229))/0x7)+parseInt(_0xc17fdd(0x1d2))/0x8*(-parseInt(_0xc17fdd(0x1f3))/0x9)+-parseInt(_0xc17fdd(0x1ee))/0xa*(-parseInt(_0xc17fdd(0x1ed))/0xb);if(_0xd6efe5===_0x3446aa)break;else _0x553712['push'](_0x553712['shift']());}catch(_0xb22a14){_0x553712['push'](_0x553712['shift']());}}}(a3_0x63e7,0xedc97));Object[a3_0x12b8c4(0x1d7)](exports,'__esModule',{'value':!![]}),exports[a3_0x12b8c4(0x226)]=void 0x0;const adminService_1=require(a3_0x12b8c4(0x233)),paymentLinkService_1=require('../services/paymentLinkService'),paymentCleanupService_1=require(a3_0x12b8c4(0x209)),telegramBotService_1=require(a3_0x12b8c4(0x1e6));class AdminController{constructor(){const _0x2d9003=a3_0x12b8c4;this[_0x2d9003(0x1ef)]=async(_0x3054c7,_0x53a28b,_0x22be47)=>{const _0x43faf2=_0x2d9003;try{const _0x52238e=_0x3054c7[_0x43faf2(0x20f)];_0x53a28b[_0x43faf2(0x1fc)]({'success':!![],'message':'Admin\x20access\x20confirmed','user':{'id':_0x52238e?.['id'],'username':_0x52238e?.[_0x43faf2(0x22f)],'role':_0x52238e?.[_0x43faf2(0x1d8)]}});}catch(_0xa31dcb){_0x22be47(_0xa31dcb);}},this[_0x2d9003(0x234)]=async(_0x52b95e,_0x3886e9,_0x50cc2a)=>{const _0x2a9d24=_0x2d9003;try{const {period:period=_0x2a9d24(0x235)}=_0x52b95e[_0x2a9d24(0x1e7)],_0x15033b=await this[_0x2a9d24(0x237)][_0x2a9d24(0x211)](period);_0x3886e9[_0x2a9d24(0x1fc)]({'success':!![],'result':_0x15033b});}catch(_0x484ab1){_0x50cc2a(_0x484ab1);}},this[_0x2d9003(0x1ff)]=async(_0x4713d0,_0x245db7,_0x4ba741)=>{const _0x339165=_0x2d9003;try{const {shopId:_0x52253c,period:period=_0x339165(0x22c),dateFrom:_0x5a97a5,dateTo:_0x4c0d11}=_0x4713d0[_0x339165(0x1e7)],_0x24a566={'shopId':_0x52253c,'period':period,'dateFrom':_0x5a97a5,'dateTo':_0x4c0d11};console[_0x339165(0x1f4)](_0x339165(0x1e3),_0x24a566);const _0x3500bc=await this[_0x339165(0x237)][_0x339165(0x1ff)](_0x24a566);_0x245db7[_0x339165(0x1fc)]({'success':!![],'result':_0x3500bc});}catch(_0x5dbe55){_0x4ba741(_0x5dbe55);}},this[_0x2d9003(0x218)]=async(_0x3e8e95,_0x1a50f8,_0x4e1356)=>{const _0x51458c=_0x2d9003;try{const _0x3f08ef=await this[_0x51458c(0x237)]['getPayoutStats']();_0x1a50f8['json']({'success':!![],'result':_0x3f08ef});}catch(_0x5df11c){_0x4e1356(_0x5df11c);}},this[_0x2d9003(0x21a)]=async(_0x18bc84,_0x50daba,_0x2c213c)=>{const _0x81179c=_0x2d9003;try{const {page:page=0x1,limit:limit=0x14,minAmount:_0x3f142e,search:_0x53a7e6}=_0x18bc84[_0x81179c(0x1e7)],_0x4f2d90={'page':Number(page),'limit':Number(limit),'minAmount':_0x3f142e?Number(_0x3f142e):undefined,'search':_0x53a7e6},_0xcd6af0=await this[_0x81179c(0x237)]['getMerchantsAwaitingPayout'](_0x4f2d90);_0x50daba['json']({'success':!![],'merchants':_0xcd6af0['merchants'],'pagination':_0xcd6af0['pagination'],'summary':_0xcd6af0[_0x81179c(0x200)]});}catch(_0x43df90){_0x2c213c(_0x43df90);}},this[_0x2d9003(0x1e9)]=async(_0x1db11d,_0x35ff71,_0x58b8aa)=>{const _0x491d6f=_0x2d9003;try{const _0x215529=await this['adminService'][_0x491d6f(0x1e9)]();_0x35ff71[_0x491d6f(0x1fc)]({'success':!![],'result':_0x215529});}catch(_0x2c605b){_0x58b8aa(_0x2c605b);}},this[_0x2d9003(0x204)]=async(_0x1e8a96,_0x2741e8,_0x2d7d1b)=>{const _0xee36bc=_0x2d9003;try{const _0x5f222a=_0x1e8a96[_0xee36bc(0x21d)],_0x425d00=await this['adminService'][_0xee36bc(0x204)](_0x5f222a);_0x2741e8['status'](0xc9)[_0xee36bc(0x1fc)]({'success':!![],'message':_0xee36bc(0x228),'result':_0x425d00});}catch(_0x4c111d){_0x2d7d1b(_0x4c111d);}},this[_0x2d9003(0x20d)]=async(_0x2d15fb,_0xd72e0f,_0x2f1c2d)=>{const _0x5a0790=_0x2d9003;try{const {page:page=0x1,limit:limit=0x14,shopId:_0xa9b97f,network:_0x31d9ec,dateFrom:_0x45badd,dateTo:_0xeb73aa,search:_0x55cc38}=_0x2d15fb[_0x5a0790(0x1e7)],_0x17fb29={'page':Number(page),'limit':Number(limit),'shopId':_0xa9b97f,'network':_0x31d9ec,'dateFrom':_0x45badd,'dateTo':_0xeb73aa,'search':_0x55cc38},_0x271730=await this[_0x5a0790(0x237)][_0x5a0790(0x232)](_0x17fb29);_0xd72e0f['json']({'success':!![],'payouts':_0x271730[_0x5a0790(0x20e)],'pagination':_0x271730['pagination']});}catch(_0x5a6c84){_0x2f1c2d(_0x5a6c84);}},this[_0x2d9003(0x22b)]=async(_0x1315d1,_0xe04f41,_0xfb5465)=>{const _0x28976b=_0x2d9003;try{const {id:_0x1d1a4b}=_0x1315d1['params'],_0x485226=await this[_0x28976b(0x237)][_0x28976b(0x22b)](_0x1d1a4b);if(!_0x485226)return _0xe04f41[_0x28976b(0x1df)](0x194)['json']({'success':![],'message':_0x28976b(0x21c)});_0xe04f41[_0x28976b(0x1fc)]({'success':!![],'result':_0x485226});}catch(_0xb9d66d){_0xfb5465(_0xb9d66d);}},this['deletePayout']=async(_0x34b18b,_0x3b3bd5,_0x35d0b1)=>{const _0x573be5=_0x2d9003;try{const {id:_0x1bc344}=_0x34b18b[_0x573be5(0x214)];await this[_0x573be5(0x237)][_0x573be5(0x20a)](_0x1bc344),_0x3b3bd5[_0x573be5(0x1fc)]({'success':!![],'message':_0x573be5(0x1da)});}catch(_0x2dd5a3){_0x35d0b1(_0x2dd5a3);}},this[_0x2d9003(0x1fe)]=async(_0x49574c,_0x1d2473,_0x41b215)=>{const _0x552e01=_0x2d9003;try{const {page:page=0x1,limit:limit=0x14,status:_0x4cf856,gateway:_0x5c37e7,shopId:_0x5c2d41,dateFrom:_0x835feb,dateTo:_0x513030,search:_0xd58a27,currency:_0x26ed12,sortBy:_0x49702c,sortOrder:_0x419a37}=_0x49574c[_0x552e01(0x1e7)],_0x2076c1={'page':Number(page),'limit':Number(limit),'status':_0x4cf856,'gateway':_0x5c37e7,'shopId':_0x5c2d41,'dateFrom':_0x835feb,'dateTo':_0x513030,'search':_0xd58a27,'currency':_0x26ed12,'sortBy':_0x49702c,'sortOrder':_0x419a37},_0x3c61de=await this['adminService']['getAllPayments'](_0x2076c1);_0x1d2473[_0x552e01(0x1fc)]({'success':!![],'payments':_0x3c61de['payments'],'pagination':_0x3c61de['pagination']});}catch(_0x351ed0){_0x41b215(_0x351ed0);}},this[_0x2d9003(0x1e0)]=async(_0x488965,_0x3f6ecd,_0x1eee07)=>{const _0x10943b=_0x2d9003;try{const {id:_0x2ad19c}=_0x488965[_0x10943b(0x214)],_0x250dc0=await this[_0x10943b(0x237)][_0x10943b(0x1e0)](_0x2ad19c);if(!_0x250dc0)return _0x3f6ecd[_0x10943b(0x1df)](0x194)['json']({'success':![],'message':_0x10943b(0x1f7)});_0x3f6ecd[_0x10943b(0x1fc)]({'success':!![],'result':_0x250dc0});}catch(_0x311187){_0x1eee07(_0x311187);}},this['updatePayment']=async(_0x4bcd17,_0x36d7be,_0x2c217f)=>{const _0x204321=_0x2d9003;try{const {id:_0x369930}=_0x4bcd17[_0x204321(0x214)],{status:_0x5cadea,notes:_0x2c0421,chargebackAmount:_0x141521}=_0x4bcd17[_0x204321(0x21d)],_0x4de698=await this['adminService']['getPaymentById'](_0x369930);if(!_0x4de698)return _0x36d7be[_0x204321(0x1df)](0x194)['json']({'success':![],'message':'Payment\x20not\x20found'});const _0x4450cf=await this[_0x204321(0x237)][_0x204321(0x1d4)](_0x369930,_0x5cadea,_0x2c0421,_0x141521);if(_0x4de698[_0x204321(0x1df)]!==_0x5cadea&&_0x5cadea[_0x204321(0x230)]()===_0x204321(0x1d1)){console[_0x204321(0x1f4)](_0x204321(0x239)+_0x369930+_0x204321(0x238));try{await this[_0x204321(0x220)]['handleSuccessfulPayment'](_0x369930),console[_0x204321(0x1f4)](_0x204321(0x1e2)+_0x369930);}catch(_0x44d26a){console['error'](_0x204321(0x219),_0x44d26a);}}if(_0x4de698[_0x204321(0x1df)]!==_0x5cadea){console[_0x204321(0x1f4)](_0x204321(0x1eb)+_0x369930+'\x20status\x20changed\x20from\x20'+_0x4de698[_0x204321(0x1df)]+_0x204321(0x1fb)+_0x5cadea+_0x204321(0x20b));try{let _0x4f26b5;switch(_0x5cadea[_0x204321(0x230)]()){case'PAID':_0x4f26b5=_0x204321(0x217);break;case'PROCESSING':_0x4f26b5='processing';break;case _0x204321(0x1dc):_0x4f26b5=_0x204321(0x201);break;case'EXPIRED':_0x4f26b5='expired';break;case _0x204321(0x22a):_0x4f26b5='refund';break;case _0x204321(0x1f8):_0x4f26b5=_0x204321(0x1d0);break;default:console[_0x204321(0x1f4)](_0x204321(0x236)+_0x5cadea);break;}if(_0x4f26b5){const _0x3b4827={..._0x4450cf,'shopId':_0x4de698[_0x204321(0x210)],'gateway':_0x4de698['gateway'],'createdAt':_0x4de698[_0x204321(0x1e4)],'chargebackAmount':_0x141521};await telegramBotService_1[_0x204321(0x1f9)]['sendPaymentNotification'](_0x4de698['shopId'],_0x3b4827,_0x4f26b5),console[_0x204321(0x1f4)](_0x204321(0x223)+_0x4de698[_0x204321(0x1df)]+_0x204321(0x225)+_0x5cadea);}}catch(_0x2ba717){console['error'](_0x204321(0x1f1),_0x2ba717);}}_0x36d7be[_0x204321(0x1fc)]({'success':!![],'message':_0x204321(0x231),'result':_0x4450cf});}catch(_0x2fa055){_0x2c217f(_0x2fa055);}},this[_0x2d9003(0x1d9)]=async(_0xb7fb4b,_0x33ee9c,_0xf0a752)=>{const _0x5c5231=_0x2d9003;try{const {id:_0x2aa671}=_0xb7fb4b['params'],_0x491640=_0xb7fb4b[_0x5c5231(0x21d)];console[_0x5c5231(0x1f4)](_0x5c5231(0x206)+_0x2aa671+':',_0x491640);const _0x371bf5=await this['adminService'][_0x5c5231(0x1d9)](_0x2aa671,_0x491640);_0x33ee9c[_0x5c5231(0x1fc)]({'success':!![],'message':_0x5c5231(0x1db),'result':_0x371bf5});}catch(_0x2bf0b8){_0xf0a752(_0x2bf0b8);}},this['updateUser']=async(_0xcde2f1,_0x209f92,_0x5a8904)=>{const _0x3642e3=_0x2d9003;try{const {id:_0x34dea9}=_0xcde2f1['params'],_0x2aff2c=_0xcde2f1['body'],_0x354dcd=await this['adminService'][_0x3642e3(0x1f5)](_0x34dea9,_0x2aff2c);_0x209f92[_0x3642e3(0x1fc)]({'success':!![],'message':_0x3642e3(0x1ea),'result':_0x354dcd});}catch(_0x299d41){_0x5a8904(_0x299d41);}},this[_0x2d9003(0x207)]=async(_0x10facc,_0x4e1243,_0x297649)=>{const _0x6c140b=_0x2d9003;try{const {id:_0x57de29}=_0x10facc['params'],_0x4496be=await this[_0x6c140b(0x237)]['suspendUser'](_0x57de29);_0x4e1243['json']({'success':!![],'message':_0x6c140b(0x1d6),'result':_0x4496be});}catch(_0x4725a9){_0x297649(_0x4725a9);}},this[_0x2d9003(0x227)]=async(_0x2c9fab,_0x395b65,_0x505f7f)=>{const _0x1d105b=_0x2d9003;try{const {id:_0x3da03b}=_0x2c9fab['params'],_0x3888ae=await this[_0x1d105b(0x237)][_0x1d105b(0x227)](_0x3da03b);_0x395b65[_0x1d105b(0x1fc)]({'success':!![],'message':_0x1d105b(0x1d3),'result':_0x3888ae});}catch(_0x29a333){_0x505f7f(_0x29a333);}},this[_0x2d9003(0x1e8)]=async(_0x1eea62,_0x33d5fb,_0x30041b)=>{const _0x5cdc1a=_0x2d9003;try{const {page:page=0x1,limit:limit=0x14,status:_0x214ed5}=_0x1eea62['query'],_0x43f92a={'page':Number(page),'limit':Number(limit),'status':_0x214ed5},_0x596551=await this['adminService'][_0x5cdc1a(0x222)](_0x43f92a);_0x33d5fb[_0x5cdc1a(0x1fc)]({'success':!![],'users':_0x596551[_0x5cdc1a(0x1fa)],'pagination':_0x596551[_0x5cdc1a(0x22e)]});}catch(_0x489c5b){_0x30041b(_0x489c5b);}},this[_0x2d9003(0x1dd)]=async(_0x34b2d8,_0x27ac44,_0x192663)=>{const _0x4a95f5=_0x2d9003;try{const {id:_0x8d3a95}=_0x34b2d8[_0x4a95f5(0x214)],_0x2c5ab0=await this[_0x4a95f5(0x237)][_0x4a95f5(0x1dd)](_0x8d3a95);if(!_0x2c5ab0)return _0x27ac44[_0x4a95f5(0x1df)](0x194)[_0x4a95f5(0x1fc)]({'success':![],'message':_0x4a95f5(0x1ec)});_0x27ac44[_0x4a95f5(0x1fc)]({'success':!![],'result':_0x2c5ab0});}catch(_0x27528d){_0x192663(_0x27528d);}},this[_0x2d9003(0x221)]=async(_0x3a6e1b,_0x148b47,_0x5599b2)=>{const _0x2a2932=_0x2d9003;try{const _0x13da05=_0x3a6e1b[_0x2a2932(0x21d)],_0x4917f4=await this[_0x2a2932(0x237)][_0x2a2932(0x221)](_0x13da05);_0x148b47[_0x2a2932(0x1df)](0xc9)[_0x2a2932(0x1fc)]({'success':!![],'message':_0x2a2932(0x1fd),'result':_0x4917f4});}catch(_0x7497f3){_0x5599b2(_0x7497f3);}},this[_0x2d9003(0x20c)]=async(_0x1d97d9,_0x399a6e,_0x1058d5)=>{const _0xc5330e=_0x2d9003;try{const {id:_0x4b3e91}=_0x1d97d9[_0xc5330e(0x214)];await this[_0xc5330e(0x237)][_0xc5330e(0x20c)](_0x4b3e91),_0x399a6e[_0xc5330e(0x1fc)]({'success':!![],'message':_0xc5330e(0x21f)});}catch(_0xf0e932){_0x1058d5(_0xf0e932);}},this[_0x2d9003(0x1e1)]=async(_0x5ce6e3,_0x537057,_0x47ab41)=>{const _0x5e4b60=_0x2d9003;try{const _0x1e20ea=await paymentCleanupService_1[_0x5e4b60(0x202)][_0x5e4b60(0x1e1)]();_0x537057[_0x5e4b60(0x1fc)]({'success':!![],'result':_0x1e20ea});}catch(_0x4e5631){_0x47ab41(_0x4e5631);}},this[_0x2d9003(0x1f6)]=async(_0x4996cc,_0x6cdb86,_0x13d709)=>{const _0x3dc18f=_0x2d9003;try{console[_0x3dc18f(0x1f4)](_0x3dc18f(0x1e5)+_0x4996cc[_0x3dc18f(0x20f)]?.[_0x3dc18f(0x22f)]+'\x20('+_0x4996cc[_0x3dc18f(0x20f)]?.['id']+')');const _0x50bfe7=await paymentCleanupService_1[_0x3dc18f(0x202)][_0x3dc18f(0x21b)]();_0x6cdb86[_0x3dc18f(0x1fc)]({'success':!![],'message':'Payment\x20cleanup\x20completed\x20successfully','result':{'processed':_0x50bfe7[_0x3dc18f(0x203)],'failed':_0x50bfe7[_0x3dc18f(0x201)],'errors':_0x50bfe7[_0x3dc18f(0x215)]}});}catch(_0x247f08){_0x13d709(_0x247f08);}},this[_0x2d9003(0x22d)]=async(_0x5b0a4d,_0x35db48,_0x2c5bd0)=>{const _0x5d480d=_0x2d9003;try{console[_0x5d480d(0x1f4)](_0x5d480d(0x1d5)+_0x5b0a4d[_0x5d480d(0x20f)]?.['username']+'\x20('+_0x5b0a4d[_0x5d480d(0x20f)]?.['id']+')');const _0x555a2a=await paymentCleanupService_1['paymentCleanupService']['getProcessingPaymentsStats'](),_0x39e4b7=await paymentCleanupService_1[_0x5d480d(0x202)][_0x5d480d(0x21b)](),_0x78ac0f=await paymentCleanupService_1[_0x5d480d(0x202)][_0x5d480d(0x1e1)]();_0x35db48[_0x5d480d(0x1fc)]({'success':!![],'message':_0x5d480d(0x1de),'result':{'cleanup':{'processed':_0x39e4b7['processed'],'failed':_0x39e4b7['failed'],'errors':_0x39e4b7[_0x5d480d(0x215)]},'statistics':{'before':_0x555a2a,'after':_0x78ac0f,'reduced':_0x555a2a[_0x5d480d(0x1f0)]-_0x78ac0f[_0x5d480d(0x1f0)]}}});}catch(_0x3454d9){_0x2c5bd0(_0x3454d9);}},this[_0x2d9003(0x237)]=new adminService_1[(_0x2d9003(0x21e))](),this[_0x2d9003(0x220)]=new paymentLinkService_1[(_0x2d9003(0x205))]();}}exports[a3_0x12b8c4(0x226)]=AdminController;