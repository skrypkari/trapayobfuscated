'use strict';const a3_0x37af86=a3_0x44c0;function a3_0x5e00(){const _0xa959ba=['defineProperty','activateUser','updateCustomerData','json','deleteUser','status','Payment\x20not\x20found','payments','54ofZEcS','User\x20not\x20found','getStatistics','adminService','User\x20activated\x20successfully','chargeback','getUserById','users','ðŸ”„\x20Admin\x20updating\x20customer\x20data\x20for\x20payment\x20','User\x20deleted\x20successfully','100DtnNuV','getMerchantsAwaitingPayout','body','512iDWGaM','getMerchantStatistics','gateway','role','log','../services/telegramBotService','ðŸ“ˆ\x20Admin\x20changed\x20payment\x20','CHARGEBACK','updatePayment','shopId','query','../services/paymentLinkService','Payout\x20deleted\x20successfully','paid','11445lEbyyZ','createdAt','suspendUser','\x20to\x20PAID,\x20updating\x20payment\x20link\x20counter','createPayout','Payout\x20created\x20successfully','âœ…\x20Payment\x20link\x20counter\x20updated\x20for\x20payment\x20','getPaymentById','Payment\x20updated\x20successfully','ðŸ“Š\x20Admin\x20requesting\x20merchant\x20statistics\x20with\x20filters:','createUser','400477amMRvT','deletePayout','\x20to\x20','getAllUsers','5667MSNwwg','updateUser','âœ…\x20Telegram\x20notification\x20sent\x20for\x20status\x20change:\x20','toUpperCase','99778hgpdEq','PaymentLinkService','getAllPayments','629317iofRwE','30d',',\x20sending\x20Telegram\x20notification','summary','handleSuccessfulPayment','getPayoutById','getMerchantsSelection','getPayoutStats','paymentLinkService','checkAuth','username','Payout\x20not\x20found','ðŸ“±\x20Skipping\x20Telegram\x20notification\x20for\x20status\x20change\x20to:\x20','error','Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20status\x20change:','\x20->\x20','AdminController','User\x20updated\x20successfully','pagination','getSystemStatistics','10758888HvPMWJ','Failed\x20to\x20update\x20payment\x20link\x20counter:','PAID','486wBWxSx','\x20status\x20changed\x20from\x20','User\x20suspended\x20successfully','getPayouts','params','payouts','failed','715685psZJKH','getUsers','60HThgAJ','telegramBotService','__esModule','10KiwIip','Customer\x20data\x20updated\x20successfully'];a3_0x5e00=function(){return _0xa959ba;};return a3_0x5e00();}function a3_0x44c0(_0x2d1a7c,_0x20ad61){const _0x5e0061=a3_0x5e00();return a3_0x44c0=function(_0x44c084,_0x3398ee){_0x44c084=_0x44c084-0xcf;let _0x12838d=_0x5e0061[_0x44c084];return _0x12838d;},a3_0x44c0(_0x2d1a7c,_0x20ad61);}(function(_0x2b7041,_0x58bc00){const _0x547c6b=a3_0x44c0,_0x1f8186=_0x2b7041();while(!![]){try{const _0x408013=parseInt(_0x547c6b(0x118))/0x1*(parseInt(_0x547c6b(0xd8))/0x2)+parseInt(_0x547c6b(0x109))/0x3*(parseInt(_0x547c6b(0xf8))/0x4)+parseInt(_0x547c6b(0xdf))/0x5*(-parseInt(_0x547c6b(0xee))/0x6)+-parseInt(_0x547c6b(0x11c))/0x7*(parseInt(_0x547c6b(0xfb))/0x8)+parseInt(_0x547c6b(0xd5))/0x9+parseInt(_0x547c6b(0xe4))/0xa*(parseInt(_0x547c6b(0x114))/0xb)+-parseInt(_0x547c6b(0xe1))/0xc*(-parseInt(_0x547c6b(0x11f))/0xd);if(_0x408013===_0x58bc00)break;else _0x1f8186['push'](_0x1f8186['shift']());}catch(_0x477e70){_0x1f8186['push'](_0x1f8186['shift']());}}}(a3_0x5e00,0xb617b));Object[a3_0x37af86(0xe6)](exports,a3_0x37af86(0xe3),{'value':!![]}),exports[a3_0x37af86(0xd1)]=void 0x0;const adminService_1=require('../services/adminService'),paymentLinkService_1=require(a3_0x37af86(0x106)),telegramBotService_1=require(a3_0x37af86(0x100));class AdminController{constructor(){const _0x4960e2=a3_0x37af86;this[_0x4960e2(0x128)]=async(_0x43546a,_0x279b41,_0xec7eef)=>{const _0x23571d=_0x4960e2;try{const _0xe21cad=_0x43546a['user'];_0x279b41[_0x23571d(0xe9)]({'success':!![],'message':'Admin\x20access\x20confirmed','user':{'id':_0xe21cad?.['id'],'username':_0xe21cad?.[_0x23571d(0x129)],'role':_0xe21cad?.[_0x23571d(0xfe)]}});}catch(_0x4d1ad0){_0xec7eef(_0x4d1ad0);}},this[_0x4960e2(0xf0)]=async(_0x45cb67,_0x4978e3,_0x3b8f15)=>{const _0x1456a5=_0x4960e2;try{const {period:period=_0x1456a5(0x120)}=_0x45cb67['query'],_0x461a22=await this['adminService'][_0x1456a5(0xd4)](period);_0x4978e3['json']({'success':!![],'result':_0x461a22});}catch(_0x2827c0){_0x3b8f15(_0x2827c0);}},this[_0x4960e2(0xfc)]=async(_0x1a64d4,_0x2f427f,_0xd094b9)=>{const _0x421c6f=_0x4960e2;try{const {shopId:_0x5ab6e4,period:period='month',dateFrom:_0x50db75,dateTo:_0x1a000c}=_0x1a64d4[_0x421c6f(0x105)],_0x47c220={'shopId':_0x5ab6e4,'period':period,'dateFrom':_0x50db75,'dateTo':_0x1a000c};console[_0x421c6f(0xff)](_0x421c6f(0x112),_0x47c220);const _0x515775=await this['adminService'][_0x421c6f(0xfc)](_0x47c220);_0x2f427f[_0x421c6f(0xe9)]({'success':!![],'result':_0x515775});}catch(_0x134a32){_0xd094b9(_0x134a32);}},this['getPayoutStats']=async(_0x179cda,_0x4dcd49,_0x56578c)=>{const _0x48a9dd=_0x4960e2;try{const _0x250172=await this[_0x48a9dd(0xf1)][_0x48a9dd(0x126)]();_0x4dcd49['json']({'success':!![],'result':_0x250172});}catch(_0x41c8f8){_0x56578c(_0x41c8f8);}},this[_0x4960e2(0xf9)]=async(_0x291a62,_0x4e22fe,_0x43e2bb)=>{const _0x9034d=_0x4960e2;try{const {page:page=0x1,limit:limit=0x14,minAmount:_0x3622a2,search:_0x9e3f17}=_0x291a62['query'],_0x5a1551={'page':Number(page),'limit':Number(limit),'minAmount':_0x3622a2?Number(_0x3622a2):undefined,'search':_0x9e3f17},_0x4ec44a=await this[_0x9034d(0xf1)][_0x9034d(0xf9)](_0x5a1551);_0x4e22fe[_0x9034d(0xe9)]({'success':!![],'merchants':_0x4ec44a['merchants'],'pagination':_0x4ec44a[_0x9034d(0xd3)],'summary':_0x4ec44a[_0x9034d(0x122)]});}catch(_0x5d7e84){_0x43e2bb(_0x5d7e84);}},this['getMerchantsSelection']=async(_0x42b239,_0x197823,_0xd345a3)=>{const _0xda6496=_0x4960e2;try{const _0x368f87=await this[_0xda6496(0xf1)][_0xda6496(0x125)]();_0x197823['json']({'success':!![],'result':_0x368f87});}catch(_0x2e8611){_0xd345a3(_0x2e8611);}},this[_0x4960e2(0x10d)]=async(_0x374f0f,_0x47c94d,_0x11bb54)=>{const _0x2c522c=_0x4960e2;try{const _0x4f799c=_0x374f0f['body'],_0x51b79e=await this[_0x2c522c(0xf1)][_0x2c522c(0x10d)](_0x4f799c);_0x47c94d['status'](0xc9)['json']({'success':!![],'message':_0x2c522c(0x10e),'result':_0x51b79e});}catch(_0x1be311){_0x11bb54(_0x1be311);}},this[_0x4960e2(0xdb)]=async(_0x17f47c,_0x428b6d,_0x2e5500)=>{const _0xbc71bd=_0x4960e2;try{const {page:page=0x1,limit:limit=0x14,shopId:_0x32ee95,network:_0x165c1c,dateFrom:_0x47b12c,dateTo:_0x1525c6,search:_0x349ecf}=_0x17f47c['query'],_0x5cf336={'page':Number(page),'limit':Number(limit),'shopId':_0x32ee95,'network':_0x165c1c,'dateFrom':_0x47b12c,'dateTo':_0x1525c6,'search':_0x349ecf},_0x107d89=await this[_0xbc71bd(0xf1)]['getAllPayouts'](_0x5cf336);_0x428b6d[_0xbc71bd(0xe9)]({'success':!![],'payouts':_0x107d89[_0xbc71bd(0xdd)],'pagination':_0x107d89['pagination']});}catch(_0x1b68ad){_0x2e5500(_0x1b68ad);}},this['getPayoutById']=async(_0x53db2b,_0x5914de,_0x2f4888)=>{const _0x2ec268=_0x4960e2;try{const {id:_0x4fac64}=_0x53db2b['params'],_0x3541fb=await this[_0x2ec268(0xf1)][_0x2ec268(0x124)](_0x4fac64);if(!_0x3541fb)return _0x5914de[_0x2ec268(0xeb)](0x194)[_0x2ec268(0xe9)]({'success':![],'message':_0x2ec268(0x12a)});_0x5914de[_0x2ec268(0xe9)]({'success':!![],'result':_0x3541fb});}catch(_0x11ca83){_0x2f4888(_0x11ca83);}},this[_0x4960e2(0x115)]=async(_0x1bafb2,_0x2e8648,_0x11a515)=>{const _0x42ed59=_0x4960e2;try{const {id:_0x15349c}=_0x1bafb2['params'];await this[_0x42ed59(0xf1)][_0x42ed59(0x115)](_0x15349c),_0x2e8648['json']({'success':!![],'message':_0x42ed59(0x107)});}catch(_0x25a3e6){_0x11a515(_0x25a3e6);}},this['getPayments']=async(_0x17787e,_0xeb0a8c,_0x133881)=>{const _0xcfa721=_0x4960e2;try{const {page:page=0x1,limit:limit=0x14,status:_0x360e52,gateway:_0x222f1a,shopId:_0x3b1bd4,dateFrom:_0x4e505f,dateTo:_0x50a20d,search:_0x461a55,currency:_0xf20b54,sortBy:_0x5b3443,sortOrder:_0x509738}=_0x17787e['query'],_0x3fba5d={'page':Number(page),'limit':Number(limit),'status':_0x360e52,'gateway':_0x222f1a,'shopId':_0x3b1bd4,'dateFrom':_0x4e505f,'dateTo':_0x50a20d,'search':_0x461a55,'currency':_0xf20b54,'sortBy':_0x5b3443,'sortOrder':_0x509738},_0x2dcb10=await this['adminService'][_0xcfa721(0x11e)](_0x3fba5d);_0xeb0a8c['json']({'success':!![],'payments':_0x2dcb10[_0xcfa721(0xed)],'pagination':_0x2dcb10[_0xcfa721(0xd3)]});}catch(_0x52f9bb){_0x133881(_0x52f9bb);}},this[_0x4960e2(0x110)]=async(_0x476c11,_0x5d34bb,_0xf766a4)=>{const _0x56add9=_0x4960e2;try{const {id:_0x2dfea6}=_0x476c11['params'],_0xa006f1=await this[_0x56add9(0xf1)][_0x56add9(0x110)](_0x2dfea6);if(!_0xa006f1)return _0x5d34bb['status'](0x194)[_0x56add9(0xe9)]({'success':![],'message':_0x56add9(0xec)});_0x5d34bb[_0x56add9(0xe9)]({'success':!![],'result':_0xa006f1});}catch(_0x2b58d6){_0xf766a4(_0x2b58d6);}},this[_0x4960e2(0x103)]=async(_0x43ac96,_0x46d557,_0x596a21)=>{const _0x4c1eb8=_0x4960e2;try{const {id:_0x39b43a}=_0x43ac96[_0x4c1eb8(0xdc)],{status:_0x4aba96,notes:_0x2a98fb,chargebackAmount:_0x269762}=_0x43ac96[_0x4c1eb8(0xfa)],_0x21172b=await this['adminService']['getPaymentById'](_0x39b43a);if(!_0x21172b)return _0x46d557[_0x4c1eb8(0xeb)](0x194)[_0x4c1eb8(0xe9)]({'success':![],'message':_0x4c1eb8(0xec)});const _0x8f97e=await this['adminService']['updatePaymentStatus'](_0x39b43a,_0x4aba96,_0x2a98fb,_0x269762);if(_0x21172b['status']!==_0x4aba96&&_0x4aba96[_0x4c1eb8(0x11b)]()===_0x4c1eb8(0xd7)){console['log'](_0x4c1eb8(0x101)+_0x39b43a+_0x4c1eb8(0x10c));try{await this[_0x4c1eb8(0x127)][_0x4c1eb8(0x123)](_0x39b43a),console[_0x4c1eb8(0xff)](_0x4c1eb8(0x10f)+_0x39b43a);}catch(_0x244bc6){console[_0x4c1eb8(0x12c)](_0x4c1eb8(0xd6),_0x244bc6);}}if(_0x21172b['status']!==_0x4aba96){console[_0x4c1eb8(0xff)]('ðŸ“±\x20Payment\x20'+_0x39b43a+_0x4c1eb8(0xd9)+_0x21172b['status']+_0x4c1eb8(0x116)+_0x4aba96+_0x4c1eb8(0x121));try{let _0x49f9c3;switch(_0x4aba96[_0x4c1eb8(0x11b)]()){case _0x4c1eb8(0xd7):_0x49f9c3=_0x4c1eb8(0x108);break;case'PROCESSING':_0x49f9c3='processing';break;case'FAILED':_0x49f9c3=_0x4c1eb8(0xde);break;case'EXPIRED':_0x49f9c3='expired';break;case'REFUND':_0x49f9c3='refund';break;case _0x4c1eb8(0x102):_0x49f9c3=_0x4c1eb8(0xf3);break;default:console['log'](_0x4c1eb8(0x12b)+_0x4aba96);break;}if(_0x49f9c3){const _0x2983ce={..._0x8f97e,'shopId':_0x21172b['shopId'],'gateway':_0x21172b[_0x4c1eb8(0xfd)],'createdAt':_0x21172b[_0x4c1eb8(0x10a)],'chargebackAmount':_0x269762};await telegramBotService_1[_0x4c1eb8(0xe2)]['sendPaymentNotification'](_0x21172b[_0x4c1eb8(0x104)],_0x2983ce,_0x49f9c3),console[_0x4c1eb8(0xff)](_0x4c1eb8(0x11a)+_0x21172b[_0x4c1eb8(0xeb)]+_0x4c1eb8(0xd0)+_0x4aba96);}}catch(_0x373095){console[_0x4c1eb8(0x12c)](_0x4c1eb8(0xcf),_0x373095);}}_0x46d557[_0x4c1eb8(0xe9)]({'success':!![],'message':_0x4c1eb8(0x111),'result':_0x8f97e});}catch(_0x4113a3){_0x596a21(_0x4113a3);}},this['updateCustomerData']=async(_0xb162e7,_0x3caee6,_0x42b61c)=>{const _0xf790fd=_0x4960e2;try{const {id:_0x397247}=_0xb162e7['params'],_0x47589e=_0xb162e7[_0xf790fd(0xfa)];console[_0xf790fd(0xff)](_0xf790fd(0xf6)+_0x397247+':',_0x47589e);const _0x1d2b93=await this['adminService'][_0xf790fd(0xe8)](_0x397247,_0x47589e);_0x3caee6[_0xf790fd(0xe9)]({'success':!![],'message':_0xf790fd(0xe5),'result':_0x1d2b93});}catch(_0x12b81d){_0x42b61c(_0x12b81d);}},this[_0x4960e2(0x119)]=async(_0x44333e,_0x1826ce,_0x144113)=>{const _0x37a0f1=_0x4960e2;try{const {id:_0x463ef6}=_0x44333e[_0x37a0f1(0xdc)],_0x1de2ef=_0x44333e[_0x37a0f1(0xfa)],_0x378c18=await this[_0x37a0f1(0xf1)][_0x37a0f1(0x119)](_0x463ef6,_0x1de2ef);_0x1826ce['json']({'success':!![],'message':_0x37a0f1(0xd2),'result':_0x378c18});}catch(_0x48f0ca){_0x144113(_0x48f0ca);}},this[_0x4960e2(0x10b)]=async(_0x4b0b0f,_0x570ae5,_0x517b1f)=>{const _0x53288b=_0x4960e2;try{const {id:_0x2d579a}=_0x4b0b0f[_0x53288b(0xdc)],_0x4bad8f=await this['adminService'][_0x53288b(0x10b)](_0x2d579a);_0x570ae5[_0x53288b(0xe9)]({'success':!![],'message':_0x53288b(0xda),'result':_0x4bad8f});}catch(_0x2a0e6c){_0x517b1f(_0x2a0e6c);}},this[_0x4960e2(0xe7)]=async(_0x491b3c,_0x12291a,_0x229243)=>{const _0x2ad716=_0x4960e2;try{const {id:_0xf8aed6}=_0x491b3c['params'],_0x4e00c8=await this[_0x2ad716(0xf1)]['activateUser'](_0xf8aed6);_0x12291a[_0x2ad716(0xe9)]({'success':!![],'message':_0x2ad716(0xf2),'result':_0x4e00c8});}catch(_0x13fd2f){_0x229243(_0x13fd2f);}},this[_0x4960e2(0xe0)]=async(_0x24a4c1,_0x3c4cc8,_0xfcf9d7)=>{const _0x2ab8e3=_0x4960e2;try{const {page:page=0x1,limit:limit=0x14,status:_0x4a17df}=_0x24a4c1[_0x2ab8e3(0x105)],_0x3d96d8={'page':Number(page),'limit':Number(limit),'status':_0x4a17df},_0x308c18=await this[_0x2ab8e3(0xf1)][_0x2ab8e3(0x117)](_0x3d96d8);_0x3c4cc8[_0x2ab8e3(0xe9)]({'success':!![],'users':_0x308c18[_0x2ab8e3(0xf5)],'pagination':_0x308c18[_0x2ab8e3(0xd3)]});}catch(_0x167895){_0xfcf9d7(_0x167895);}},this[_0x4960e2(0xf4)]=async(_0x43a2f9,_0xdc4a2b,_0x287a05)=>{const _0xa0849e=_0x4960e2;try{const {id:_0x3f7f87}=_0x43a2f9['params'],_0x4302f0=await this[_0xa0849e(0xf1)][_0xa0849e(0xf4)](_0x3f7f87);if(!_0x4302f0)return _0xdc4a2b[_0xa0849e(0xeb)](0x194)[_0xa0849e(0xe9)]({'success':![],'message':_0xa0849e(0xef)});_0xdc4a2b[_0xa0849e(0xe9)]({'success':!![],'result':_0x4302f0});}catch(_0x1144d8){_0x287a05(_0x1144d8);}},this[_0x4960e2(0x113)]=async(_0x26fe9b,_0x2b2b67,_0x8d50e0)=>{const _0x2fd685=_0x4960e2;try{const _0x4e02a6=_0x26fe9b[_0x2fd685(0xfa)],_0x3daaf9=await this['adminService']['createUser'](_0x4e02a6);_0x2b2b67[_0x2fd685(0xeb)](0xc9)[_0x2fd685(0xe9)]({'success':!![],'message':'User\x20created\x20successfully','result':_0x3daaf9});}catch(_0x24c0d3){_0x8d50e0(_0x24c0d3);}},this['deleteUser']=async(_0x1e9f66,_0x1cb890,_0xc035f0)=>{const _0x33f315=_0x4960e2;try{const {id:_0x292cdc}=_0x1e9f66[_0x33f315(0xdc)];await this[_0x33f315(0xf1)][_0x33f315(0xea)](_0x292cdc),_0x1cb890[_0x33f315(0xe9)]({'success':!![],'message':_0x33f315(0xf7)});}catch(_0x535d3f){_0xc035f0(_0x535d3f);}},this['adminService']=new adminService_1['AdminService'](),this['paymentLinkService']=new paymentLinkService_1[(_0x4960e2(0x11d))]();}}exports['AdminController']=AdminController;