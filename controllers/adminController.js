'use strict';function a3_0x1ab5(_0x389bb4,_0x4fd016){const _0x258290=a3_0x2582();return a3_0x1ab5=function(_0x1ab573,_0x4b5226){_0x1ab573=_0x1ab573-0x165;let _0x594674=_0x258290[_0x1ab573];return _0x594674;},a3_0x1ab5(_0x389bb4,_0x4fd016);}function a3_0x2582(){const _0x5f4f58=['Failed\x20to\x20update\x20payment\x20link\x20counter:','getPayouts','params','activateUser','refund','getAllUsers','AdminController','query','createPayout','defineProperty','getAllPayments','../services/paymentLinkService','getUsers','getAllPayouts','../services/telegramBotService','adminService','âœ…\x20Telegram\x20notification\x20sent\x20for\x20status\x20change:\x20','deleteUser','getPayoutStats','processing','getPaymentById','suspendUser','merchants','âœ…\x20Payment\x20link\x20counter\x20updated\x20for\x20payment\x20','paid','shopId','User\x20suspended\x20successfully','body','pagination','PaymentLinkService','payouts','getPayments','getMerchantsSelection',',\x20sending\x20Telegram\x20notification','chargeback','User\x20activated\x20successfully','sendPaymentNotification','getUserById','34FgvIta','error','278872qddZyv','gateway','ðŸ“Š\x20Admin\x20requesting\x20merchant\x20statistics\x20with\x20filters:','getMerchantStatistics','getMerchantsAwaitingPayout','Payout\x20deleted\x20successfully','updateUser','updatePaymentStatus','PROCESSING','23289129FUbvhr','user','status','User\x20deleted\x20successfully','30d','\x20to\x20PAID,\x20updating\x20payment\x20link\x20counter','json','\x20to\x20','REFUND','log','FAILED','expired','Customer\x20data\x20updated\x20successfully','getPayoutById','telegramBotService','summary','8725592WgvHdG','username','Payout\x20not\x20found','deletePayout','860652AkqugH','5823642EdvOBj','53899TZAhlb','7VXfyrm','EXPIRED','getSystemStatistics','updateCustomerData','5007525XHUWSK','PAID','__esModule','Payment\x20not\x20found','toUpperCase','paymentLinkService','createUser'];a3_0x2582=function(){return _0x5f4f58;};return a3_0x2582();}const a3_0x4d6548=a3_0x1ab5;(function(_0x36608d,_0x55869e){const _0x5bd9aa=a3_0x1ab5,_0x5dea2c=_0x36608d();while(!![]){try{const _0x4c5532=parseInt(_0x5bd9aa(0x188))/0x1*(-parseInt(_0x5bd9aa(0x167))/0x2)+-parseInt(_0x5bd9aa(0x186))/0x3+parseInt(_0x5bd9aa(0x169))/0x4+-parseInt(_0x5bd9aa(0x18d))/0x5+-parseInt(_0x5bd9aa(0x187))/0x6*(parseInt(_0x5bd9aa(0x189))/0x7)+parseInt(_0x5bd9aa(0x182))/0x8+parseInt(_0x5bd9aa(0x172))/0x9;if(_0x4c5532===_0x55869e)break;else _0x5dea2c['push'](_0x5dea2c['shift']());}catch(_0x59c00f){_0x5dea2c['push'](_0x5dea2c['shift']());}}}(a3_0x2582,0x8bd93));Object[a3_0x4d6548(0x19d)](exports,a3_0x4d6548(0x18f),{'value':!![]}),exports[a3_0x4d6548(0x19a)]=void 0x0;const adminService_1=require('../services/adminService'),paymentLinkService_1=require(a3_0x4d6548(0x19f)),telegramBotService_1=require(a3_0x4d6548(0x1a2));class AdminController{constructor(){const _0x5133ad=a3_0x4d6548;this['checkAuth']=async(_0x343c88,_0x718e77,_0x122110)=>{const _0x336f90=a3_0x1ab5;try{const _0x405dd2=_0x343c88[_0x336f90(0x173)];_0x718e77['json']({'success':!![],'message':'Admin\x20access\x20confirmed','user':{'id':_0x405dd2?.['id'],'username':_0x405dd2?.[_0x336f90(0x183)],'role':_0x405dd2?.['role']}});}catch(_0x1a8c84){_0x122110(_0x1a8c84);}},this['getStatistics']=async(_0x12ac6b,_0x25c363,_0x1a6748)=>{const _0x2da736=a3_0x1ab5;try{const {period:period=_0x2da736(0x176)}=_0x12ac6b[_0x2da736(0x19b)],_0x10bbe9=await this[_0x2da736(0x1a3)][_0x2da736(0x18b)](period);_0x25c363[_0x2da736(0x178)]({'success':!![],'result':_0x10bbe9});}catch(_0x33058b){_0x1a6748(_0x33058b);}},this[_0x5133ad(0x16c)]=async(_0x296aac,_0x3d854a,_0x5baa96)=>{const _0x3c3f85=_0x5133ad;try{const {shopId:_0x2d0427,period:period='month',dateFrom:_0x5f2cc5,dateTo:_0x30716a}=_0x296aac[_0x3c3f85(0x19b)],_0x52d2a6={'shopId':_0x2d0427,'period':period,'dateFrom':_0x5f2cc5,'dateTo':_0x30716a};console[_0x3c3f85(0x17b)](_0x3c3f85(0x16b),_0x52d2a6);const _0x506ae4=await this[_0x3c3f85(0x1a3)][_0x3c3f85(0x16c)](_0x52d2a6);_0x3d854a[_0x3c3f85(0x178)]({'success':!![],'result':_0x506ae4});}catch(_0x4058fd){_0x5baa96(_0x4058fd);}},this['getPayoutStats']=async(_0x38b295,_0x5a274e,_0x49c6f4)=>{const _0x4ec055=_0x5133ad;try{const _0x47cc1c=await this[_0x4ec055(0x1a3)][_0x4ec055(0x1a6)]();_0x5a274e['json']({'success':!![],'result':_0x47cc1c});}catch(_0x2bd846){_0x49c6f4(_0x2bd846);}},this['getMerchantsAwaitingPayout']=async(_0x2fc86a,_0x1d7be2,_0x13e36e)=>{const _0x415656=_0x5133ad;try{const {page:page=0x1,limit:limit=0x14,minAmount:_0x49f0cb,search:_0x308cc6}=_0x2fc86a[_0x415656(0x19b)],_0x139000={'page':Number(page),'limit':Number(limit),'minAmount':_0x49f0cb?Number(_0x49f0cb):undefined,'search':_0x308cc6},_0x2d7905=await this[_0x415656(0x1a3)][_0x415656(0x16d)](_0x139000);_0x1d7be2[_0x415656(0x178)]({'success':!![],'merchants':_0x2d7905[_0x415656(0x1aa)],'pagination':_0x2d7905[_0x415656(0x1b0)],'summary':_0x2d7905[_0x415656(0x181)]});}catch(_0x48b456){_0x13e36e(_0x48b456);}},this[_0x5133ad(0x1b4)]=async(_0x39db20,_0xe0b48,_0x380cf3)=>{const _0x29ca01=_0x5133ad;try{const _0x328f4f=await this[_0x29ca01(0x1a3)][_0x29ca01(0x1b4)]();_0xe0b48[_0x29ca01(0x178)]({'success':!![],'result':_0x328f4f});}catch(_0x2fa1d8){_0x380cf3(_0x2fa1d8);}},this['createPayout']=async(_0x5c91cf,_0x4d00a2,_0x22363c)=>{const _0x599ca0=_0x5133ad;try{const _0x58e953=_0x5c91cf['body'],_0x2b909d=await this[_0x599ca0(0x1a3)][_0x599ca0(0x19c)](_0x58e953);_0x4d00a2['status'](0xc9)[_0x599ca0(0x178)]({'success':!![],'message':'Payout\x20created\x20successfully','result':_0x2b909d});}catch(_0xa6132c){_0x22363c(_0xa6132c);}},this[_0x5133ad(0x195)]=async(_0xe662d2,_0x47f458,_0x5424a3)=>{const _0x41e26a=_0x5133ad;try{const {page:page=0x1,limit:limit=0x14,shopId:_0x21eedc,network:_0xc7508a,dateFrom:_0x571733,dateTo:_0x599ef6,search:_0x238276}=_0xe662d2[_0x41e26a(0x19b)],_0x144fbf={'page':Number(page),'limit':Number(limit),'shopId':_0x21eedc,'network':_0xc7508a,'dateFrom':_0x571733,'dateTo':_0x599ef6,'search':_0x238276},_0x3d262c=await this[_0x41e26a(0x1a3)][_0x41e26a(0x1a1)](_0x144fbf);_0x47f458[_0x41e26a(0x178)]({'success':!![],'payouts':_0x3d262c[_0x41e26a(0x1b2)],'pagination':_0x3d262c[_0x41e26a(0x1b0)]});}catch(_0x239ac8){_0x5424a3(_0x239ac8);}},this[_0x5133ad(0x17f)]=async(_0x80244a,_0x752bd6,_0x489e3f)=>{const _0x146847=_0x5133ad;try{const {id:_0x172fd0}=_0x80244a[_0x146847(0x196)],_0x22c813=await this[_0x146847(0x1a3)][_0x146847(0x17f)](_0x172fd0);if(!_0x22c813)return _0x752bd6[_0x146847(0x174)](0x194)[_0x146847(0x178)]({'success':![],'message':_0x146847(0x184)});_0x752bd6[_0x146847(0x178)]({'success':!![],'result':_0x22c813});}catch(_0x304a2a){_0x489e3f(_0x304a2a);}},this[_0x5133ad(0x185)]=async(_0xbe9ebd,_0xc53b66,_0x22468f)=>{const _0x48bb5d=_0x5133ad;try{const {id:_0x2ddff8}=_0xbe9ebd[_0x48bb5d(0x196)];await this['adminService']['deletePayout'](_0x2ddff8),_0xc53b66[_0x48bb5d(0x178)]({'success':!![],'message':_0x48bb5d(0x16e)});}catch(_0x43516c){_0x22468f(_0x43516c);}},this[_0x5133ad(0x1b3)]=async(_0x43187a,_0x2526aa,_0x59546d)=>{const _0x1e5145=_0x5133ad;try{const {page:page=0x1,limit:limit=0x14,status:_0x32fbca,gateway:_0x3d1691,shopId:_0xddaa88,dateFrom:_0x56af3d,dateTo:_0x5947f5,search:_0x16001c,currency:_0x18326d,sortBy:_0x22c8fc,sortOrder:_0x2b54b4}=_0x43187a[_0x1e5145(0x19b)],_0x7cc746={'page':Number(page),'limit':Number(limit),'status':_0x32fbca,'gateway':_0x3d1691,'shopId':_0xddaa88,'dateFrom':_0x56af3d,'dateTo':_0x5947f5,'search':_0x16001c,'currency':_0x18326d,'sortBy':_0x22c8fc,'sortOrder':_0x2b54b4},_0xbc0b24=await this['adminService'][_0x1e5145(0x19e)](_0x7cc746);_0x2526aa['json']({'success':!![],'payments':_0xbc0b24['payments'],'pagination':_0xbc0b24['pagination']});}catch(_0x36e2e6){_0x59546d(_0x36e2e6);}},this[_0x5133ad(0x1a8)]=async(_0x6bfb48,_0x9fba0d,_0x19ae3c)=>{const _0xe4c176=_0x5133ad;try{const {id:_0x21941e}=_0x6bfb48['params'],_0x577c34=await this[_0xe4c176(0x1a3)]['getPaymentById'](_0x21941e);if(!_0x577c34)return _0x9fba0d[_0xe4c176(0x174)](0x194)['json']({'success':![],'message':_0xe4c176(0x190)});_0x9fba0d[_0xe4c176(0x178)]({'success':!![],'result':_0x577c34});}catch(_0x35026c){_0x19ae3c(_0x35026c);}},this['updatePayment']=async(_0x2939df,_0x45182f,_0x3ae8a8)=>{const _0x51ae79=_0x5133ad;try{const {id:_0x390f5e}=_0x2939df[_0x51ae79(0x196)],{status:_0x6ec9db,notes:_0x44bed0,chargebackAmount:_0x107724}=_0x2939df[_0x51ae79(0x1af)],_0x2276ce=await this['adminService'][_0x51ae79(0x1a8)](_0x390f5e);if(!_0x2276ce)return _0x45182f['status'](0x194)[_0x51ae79(0x178)]({'success':![],'message':_0x51ae79(0x190)});const _0x6f51d9=await this[_0x51ae79(0x1a3)][_0x51ae79(0x170)](_0x390f5e,_0x6ec9db,_0x44bed0,_0x107724);if(_0x2276ce['status']!==_0x6ec9db&&_0x6ec9db[_0x51ae79(0x191)]()===_0x51ae79(0x18e)){console[_0x51ae79(0x17b)]('ðŸ“ˆ\x20Admin\x20changed\x20payment\x20'+_0x390f5e+_0x51ae79(0x177));try{await this[_0x51ae79(0x192)]['handleSuccessfulPayment'](_0x390f5e),console[_0x51ae79(0x17b)](_0x51ae79(0x1ab)+_0x390f5e);}catch(_0x2f712f){console['error'](_0x51ae79(0x194),_0x2f712f);}}if(_0x2276ce[_0x51ae79(0x174)]!==_0x6ec9db){console[_0x51ae79(0x17b)]('ðŸ“±\x20Payment\x20'+_0x390f5e+'\x20status\x20changed\x20from\x20'+_0x2276ce['status']+_0x51ae79(0x179)+_0x6ec9db+_0x51ae79(0x1b5));try{let _0x335b4e;switch(_0x6ec9db[_0x51ae79(0x191)]()){case'PAID':_0x335b4e=_0x51ae79(0x1ac);break;case _0x51ae79(0x171):_0x335b4e=_0x51ae79(0x1a7);break;case _0x51ae79(0x17c):_0x335b4e='failed';break;case _0x51ae79(0x18a):_0x335b4e=_0x51ae79(0x17d);break;case _0x51ae79(0x17a):_0x335b4e=_0x51ae79(0x198);break;case'CHARGEBACK':_0x335b4e=_0x51ae79(0x1b6);break;default:console[_0x51ae79(0x17b)]('ðŸ“±\x20Skipping\x20Telegram\x20notification\x20for\x20status\x20change\x20to:\x20'+_0x6ec9db);break;}if(_0x335b4e){const _0x4d1298={..._0x6f51d9,'shopId':_0x2276ce[_0x51ae79(0x1ad)],'gateway':_0x2276ce[_0x51ae79(0x16a)],'createdAt':_0x2276ce['createdAt'],'chargebackAmount':_0x107724};await telegramBotService_1[_0x51ae79(0x180)][_0x51ae79(0x165)](_0x2276ce['shopId'],_0x4d1298,_0x335b4e),console['log'](_0x51ae79(0x1a4)+_0x2276ce[_0x51ae79(0x174)]+'\x20->\x20'+_0x6ec9db);}}catch(_0x1f8e51){console[_0x51ae79(0x168)]('Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20status\x20change:',_0x1f8e51);}}_0x45182f[_0x51ae79(0x178)]({'success':!![],'message':'Payment\x20updated\x20successfully','result':_0x6f51d9});}catch(_0x290339){_0x3ae8a8(_0x290339);}},this['updateCustomerData']=async(_0x2d9b4a,_0x4a4d9f,_0x193ef6)=>{const _0x4a3a47=_0x5133ad;try{const {id:_0x5b7f71}=_0x2d9b4a[_0x4a3a47(0x196)],_0x2b91f0=_0x2d9b4a['body'];console[_0x4a3a47(0x17b)]('ðŸ”„\x20Admin\x20updating\x20customer\x20data\x20for\x20payment\x20'+_0x5b7f71+':',_0x2b91f0);const _0x3fe69b=await this[_0x4a3a47(0x1a3)][_0x4a3a47(0x18c)](_0x5b7f71,_0x2b91f0);_0x4a4d9f[_0x4a3a47(0x178)]({'success':!![],'message':_0x4a3a47(0x17e),'result':_0x3fe69b});}catch(_0x1b837c){_0x193ef6(_0x1b837c);}},this[_0x5133ad(0x16f)]=async(_0x56f4c8,_0x121a2b,_0xb443e3)=>{const _0x58205e=_0x5133ad;try{const {id:_0xeb435d}=_0x56f4c8['params'],_0x1a1611=_0x56f4c8['body'],_0x4234dc=await this[_0x58205e(0x1a3)][_0x58205e(0x16f)](_0xeb435d,_0x1a1611);_0x121a2b[_0x58205e(0x178)]({'success':!![],'message':'User\x20updated\x20successfully','result':_0x4234dc});}catch(_0x4984e9){_0xb443e3(_0x4984e9);}},this[_0x5133ad(0x1a9)]=async(_0x113fc8,_0x14997f,_0x5affc7)=>{const _0x3a7ef7=_0x5133ad;try{const {id:_0x3488a4}=_0x113fc8[_0x3a7ef7(0x196)],_0x35e984=await this[_0x3a7ef7(0x1a3)][_0x3a7ef7(0x1a9)](_0x3488a4);_0x14997f[_0x3a7ef7(0x178)]({'success':!![],'message':_0x3a7ef7(0x1ae),'result':_0x35e984});}catch(_0x5c5846){_0x5affc7(_0x5c5846);}},this[_0x5133ad(0x197)]=async(_0x32ab56,_0x1575f4,_0x5c0d0a)=>{const _0x26833c=_0x5133ad;try{const {id:_0x1ce0ea}=_0x32ab56[_0x26833c(0x196)],_0x561746=await this[_0x26833c(0x1a3)][_0x26833c(0x197)](_0x1ce0ea);_0x1575f4['json']({'success':!![],'message':_0x26833c(0x1b7),'result':_0x561746});}catch(_0x18eb58){_0x5c0d0a(_0x18eb58);}},this[_0x5133ad(0x1a0)]=async(_0x3c99c1,_0x1a1531,_0x5863f7)=>{const _0x28e113=_0x5133ad;try{const {page:page=0x1,limit:limit=0x14,status:_0x55e4f2}=_0x3c99c1[_0x28e113(0x19b)],_0x548eb7={'page':Number(page),'limit':Number(limit),'status':_0x55e4f2},_0x2ed496=await this[_0x28e113(0x1a3)][_0x28e113(0x199)](_0x548eb7);_0x1a1531[_0x28e113(0x178)]({'success':!![],'users':_0x2ed496['users'],'pagination':_0x2ed496[_0x28e113(0x1b0)]});}catch(_0x454a6a){_0x5863f7(_0x454a6a);}},this['getUserById']=async(_0x29bcde,_0x1867f3,_0x396570)=>{const _0x25b03f=_0x5133ad;try{const {id:_0x1e36e7}=_0x29bcde[_0x25b03f(0x196)],_0x3732c3=await this[_0x25b03f(0x1a3)][_0x25b03f(0x166)](_0x1e36e7);if(!_0x3732c3)return _0x1867f3[_0x25b03f(0x174)](0x194)[_0x25b03f(0x178)]({'success':![],'message':'User\x20not\x20found'});_0x1867f3[_0x25b03f(0x178)]({'success':!![],'result':_0x3732c3});}catch(_0x5bc180){_0x396570(_0x5bc180);}},this[_0x5133ad(0x193)]=async(_0x53b755,_0x105dd8,_0x29723a)=>{const _0x55b571=_0x5133ad;try{const _0x9e09=_0x53b755[_0x55b571(0x1af)],_0x8eb489=await this[_0x55b571(0x1a3)][_0x55b571(0x193)](_0x9e09);_0x105dd8['status'](0xc9)[_0x55b571(0x178)]({'success':!![],'message':'User\x20created\x20successfully','result':_0x8eb489});}catch(_0x55b703){_0x29723a(_0x55b703);}},this[_0x5133ad(0x1a5)]=async(_0x1bf370,_0x336243,_0x1e43ec)=>{const _0x51b50d=_0x5133ad;try{const {id:_0x40bd34}=_0x1bf370[_0x51b50d(0x196)];await this[_0x51b50d(0x1a3)][_0x51b50d(0x1a5)](_0x40bd34),_0x336243[_0x51b50d(0x178)]({'success':!![],'message':_0x51b50d(0x175)});}catch(_0x55992a){_0x1e43ec(_0x55992a);}},this[_0x5133ad(0x1a3)]=new adminService_1['AdminService'](),this[_0x5133ad(0x192)]=new paymentLinkService_1[(_0x5133ad(0x1b1))]();}}exports[a3_0x4d6548(0x19a)]=AdminController;