'use strict';const a4_0x34b0aa=a4_0x103c;(function(_0x925fea,_0xd4a425){const _0x1d770c=a4_0x103c,_0x5dc8af=_0x925fea();while(!![]){try{const _0x14a8c5=-parseInt(_0x1d770c(0x16a))/0x1*(parseInt(_0x1d770c(0x188))/0x2)+-parseInt(_0x1d770c(0x192))/0x3+-parseInt(_0x1d770c(0x1cf))/0x4*(parseInt(_0x1d770c(0x181))/0x5)+-parseInt(_0x1d770c(0x14e))/0x6+parseInt(_0x1d770c(0x1ce))/0x7+parseInt(_0x1d770c(0x158))/0x8*(-parseInt(_0x1d770c(0x1c8))/0x9)+parseInt(_0x1d770c(0x18f))/0xa;if(_0x14a8c5===_0xd4a425)break;else _0x5dc8af['push'](_0x5dc8af['shift']());}catch(_0x31c30d){_0x5dc8af['push'](_0x5dc8af['shift']());}}}(a4_0x1e69,0x71265));var __createBinding=this&&this[a4_0x34b0aa(0x15b)]||(Object[a4_0x34b0aa(0x1b7)]?function(_0x3c585d,_0x44f709,_0x27af8d,_0x7564b4){const _0x36f3f4=a4_0x34b0aa;if(_0x7564b4===undefined)_0x7564b4=_0x27af8d;var _0x18463c=Object[_0x36f3f4(0x1bb)](_0x44f709,_0x27af8d);(!_0x18463c||('get'in _0x18463c?!_0x44f709[_0x36f3f4(0x1f2)]:_0x18463c['writable']||_0x18463c['configurable']))&&(_0x18463c={'enumerable':!![],'get':function(){return _0x44f709[_0x27af8d];}}),Object[_0x36f3f4(0x184)](_0x3c585d,_0x7564b4,_0x18463c);}:function(_0x1576a1,_0x271dd1,_0x272b46,_0x9eca15){if(_0x9eca15===undefined)_0x9eca15=_0x272b46;_0x1576a1[_0x9eca15]=_0x271dd1[_0x272b46];}),__setModuleDefault=this&&this[a4_0x34b0aa(0x182)]||(Object[a4_0x34b0aa(0x1b7)]?function(_0x39c848,_0x3603f1){const _0x2c4bbe=a4_0x34b0aa;Object[_0x2c4bbe(0x184)](_0x39c848,'default',{'enumerable':!![],'value':_0x3603f1});}:function(_0x2087dd,_0x1b884d){_0x2087dd['default']=_0x1b884d;}),__importStar=this&&this[a4_0x34b0aa(0x14b)]||(function(){var _0x574fa4=function(_0x579bf0){const _0x127792=a4_0x103c;return _0x574fa4=Object[_0x127792(0x1fe)]||function(_0x1f9dbe){const _0x4a64cf=_0x127792;var _0x4b872a=[];for(var _0x47bd0b in _0x1f9dbe)if(Object[_0x4a64cf(0x1d8)][_0x4a64cf(0x1da)][_0x4a64cf(0x1af)](_0x1f9dbe,_0x47bd0b))_0x4b872a[_0x4b872a['length']]=_0x47bd0b;return _0x4b872a;},_0x574fa4(_0x579bf0);};return function(_0x11adeb){const _0x21f258=a4_0x103c;if(_0x11adeb&&_0x11adeb[_0x21f258(0x1f2)])return _0x11adeb;var _0x393b68={};if(_0x11adeb!=null){for(var _0x2015be=_0x574fa4(_0x11adeb),_0x5517c5=0x0;_0x5517c5<_0x2015be[_0x21f258(0x175)];_0x5517c5++)if(_0x2015be[_0x5517c5]!=='default')__createBinding(_0x393b68,_0x11adeb,_0x2015be[_0x5517c5]);}return __setModuleDefault(_0x393b68,_0x11adeb),_0x393b68;};}()),__importDefault=this&&this[a4_0x34b0aa(0x1c3)]||function(_0x5e9f3b){return _0x5e9f3b&&_0x5e9f3b['__esModule']?_0x5e9f3b:{'default':_0x5e9f3b};};Object[a4_0x34b0aa(0x184)](exports,a4_0x34b0aa(0x1f2),{'value':!![]}),exports[a4_0x34b0aa(0x16e)]=void 0x0;const adminService_1=require(a4_0x34b0aa(0x151)),paymentLinkService_1=require(a4_0x34b0aa(0x1b5)),paymentCleanupService_1=require(a4_0x34b0aa(0x1d0)),telegramBotService_1=require(a4_0x34b0aa(0x1ca)),gatewaySettingsService_1=require('../services/gatewaySettingsService'),database_1=__importDefault(require(a4_0x34b0aa(0x187)));class AdminController{constructor(){const _0x4c01e5=a4_0x34b0aa;this['checkAuth']=async(_0xa823c0,_0x594896,_0x4c0b22)=>{const _0x3f33fb=a4_0x103c;try{const _0x371c2c=_0xa823c0[_0x3f33fb(0x199)];_0x594896[_0x3f33fb(0x14d)]({'success':!![],'message':_0x3f33fb(0x180),'user':{'id':_0x371c2c?.['id'],'username':_0x371c2c?.['username'],'role':_0x371c2c?.[_0x3f33fb(0x16c)]}});}catch(_0x19afbd){_0x4c0b22(_0x19afbd);}},this[_0x4c01e5(0x1fa)]=async(_0x178b18,_0x40ee41,_0x1e263a)=>{const _0x47a363=_0x4c01e5;try{const {period:period='30d',currentDate:_0x12663f}=_0x178b18[_0x47a363(0x15c)],_0x48de3b=await this[_0x47a363(0x164)][_0x47a363(0x1a4)](period,_0x12663f);_0x40ee41[_0x47a363(0x14d)]({'success':!![],'result':_0x48de3b});}catch(_0x2474ab){_0x1e263a(_0x2474ab);}},this[_0x4c01e5(0x191)]=async(_0x3af488,_0x15f2a5,_0xf02060)=>{const _0x2ea8eb=_0x4c01e5;try{const {shopId:_0x1e5587,period:period=_0x2ea8eb(0x15a),dateFrom:_0xc85e16,dateTo:_0x4d79ba}=_0x3af488['query'],_0x460341={'shopId':_0x1e5587,'period':period,'dateFrom':_0xc85e16,'dateTo':_0x4d79ba};console[_0x2ea8eb(0x19c)](_0x2ea8eb(0x156),_0x460341);const _0x4becfe=await this[_0x2ea8eb(0x164)][_0x2ea8eb(0x191)](_0x460341);_0x15f2a5[_0x2ea8eb(0x14d)]({'success':!![],'result':_0x4becfe});}catch(_0x53ab1d){_0xf02060(_0x53ab1d);}},this[_0x4c01e5(0x178)]=async(_0x257bc7,_0x348a26,_0x4961f2)=>{const _0x49f6de=_0x4c01e5;try{const {periodFrom:_0x311969,periodTo:_0x2681fa,gateway:_0x4b8239}=_0x257bc7[_0x49f6de(0x15c)];if(!_0x311969||!_0x2681fa||!_0x4b8239)return _0x348a26[_0x49f6de(0x1e9)](0x190)[_0x49f6de(0x14d)]({'success':![],'message':'periodFrom,\x20periodTo,\x20and\x20gateway\x20are\x20required'});console['log'](_0x49f6de(0x179),{'periodFrom':_0x311969,'periodTo':_0x2681fa,'gateway':_0x4b8239});const _0x350566=await this[_0x49f6de(0x164)][_0x49f6de(0x178)]({'periodFrom':_0x311969,'periodTo':_0x2681fa,'gateway':_0x4b8239});_0x348a26[_0x49f6de(0x14d)]({'success':!![],'reports':_0x350566});}catch(_0x2b0a55){_0x4961f2(_0x2b0a55);}},this['getPayoutStats']=async(_0x15483e,_0x2344c9,_0x50fb09)=>{const _0x13e573=_0x4c01e5;try{const _0x4fa720=await this[_0x13e573(0x164)]['getPayoutStats']();_0x2344c9['json']({'success':!![],'result':_0x4fa720});}catch(_0x3bd1aa){_0x50fb09(_0x3bd1aa);}},this[_0x4c01e5(0x194)]=async(_0x40a652,_0x3f452c,_0x581105)=>{const _0x520b8c=_0x4c01e5;try{const {page:page=0x1,limit:limit=0x14,minAmount:_0x2fc1e2,search:_0x4d7771}=_0x40a652[_0x520b8c(0x15c)],_0x55f4b2={'page':Number(page),'limit':Number(limit),'minAmount':_0x2fc1e2?Number(_0x2fc1e2):undefined,'search':_0x4d7771},_0x15d0e5=await this[_0x520b8c(0x164)][_0x520b8c(0x194)](_0x55f4b2);_0x3f452c['json']({'success':!![],'merchants':_0x15d0e5[_0x520b8c(0x1e5)],'pagination':_0x15d0e5[_0x520b8c(0x1f9)],'summary':_0x15d0e5[_0x520b8c(0x1e6)]});}catch(_0x1a5046){_0x581105(_0x1a5046);}},this[_0x4c01e5(0x1fc)]=async(_0x756c8b,_0x1a8aa6,_0x2d185d)=>{const _0x578f4e=_0x4c01e5;try{const _0xd47cc1=_0x756c8b[_0x578f4e(0x15c)][_0x578f4e(0x195)]==='true',_0x1eedc1=await this[_0x578f4e(0x164)][_0x578f4e(0x1fc)](_0xd47cc1);_0x1a8aa6[_0x578f4e(0x14d)]({'success':!![],'result':_0x1eedc1});}catch(_0x8c236){_0x2d185d(_0x8c236);}},this['createPayout']=async(_0x58e953,_0x171c86,_0x432340)=>{const _0x110550=_0x4c01e5;try{const _0x3730a3=_0x58e953[_0x110550(0x1b0)];console['log']('üéØ\x20[CONTROLLER]\x20Creating\x20payout\x20with\x20data:',_0x3730a3);const _0x138468=await this[_0x110550(0x164)]['createPayout'](_0x3730a3);_0x171c86[_0x110550(0x1e9)](0xc9)[_0x110550(0x14d)]({'success':!![],'message':_0x110550(0x160),'result':_0x138468});}catch(_0x23db76){_0x432340(_0x23db76);}},this[_0x4c01e5(0x1be)]=async(_0x2a61dd,_0x224c4c,_0x5ed040)=>{const _0x46d727=_0x4c01e5;try{const {id:_0x218267}=_0x2a61dd['params'],_0x4324c5=_0x2a61dd[_0x46d727(0x1b0)];console[_0x46d727(0x19c)](_0x46d727(0x19b)+_0x218267+'\x20with\x20data:',_0x4324c5);const _0x5ca506=await this[_0x46d727(0x164)][_0x46d727(0x1be)](_0x218267,_0x4324c5);_0x224c4c[_0x46d727(0x14d)]({'success':!![],'message':_0x46d727(0x150),'result':_0x5ca506});}catch(_0x2e38f5){_0x5ed040(_0x2e38f5);}},this[_0x4c01e5(0x183)]=async(_0x266bf6,_0x1eee92,_0x264dd2)=>{const _0x1aaae1=_0x4c01e5;try{const {page:page=0x1,limit:limit=0x14,shopId:_0x590fcc,network:_0x2333f1,dateFrom:_0x1f415a,dateTo:_0x4c25ae,search:_0xd4f9db}=_0x266bf6[_0x1aaae1(0x15c)],_0x4a8dbe={'page':Number(page),'limit':Number(limit),'shopId':_0x590fcc,'network':_0x2333f1,'dateFrom':_0x1f415a,'dateTo':_0x4c25ae,'search':_0xd4f9db},_0x5ad908=await this[_0x1aaae1(0x164)]['getAllPayouts'](_0x4a8dbe);_0x1eee92[_0x1aaae1(0x14d)]({'success':!![],'payouts':_0x5ad908[_0x1aaae1(0x16d)],'pagination':_0x5ad908[_0x1aaae1(0x1f9)]});}catch(_0x28a6f4){_0x264dd2(_0x28a6f4);}},this[_0x4c01e5(0x169)]=async(_0x25e577,_0x4cc394,_0x3b2e94)=>{const _0x5767c8=_0x4c01e5;try{const {id:_0x532ebc}=_0x25e577['params'],_0x5521a0=await this[_0x5767c8(0x164)]['getPayoutById'](_0x532ebc);if(!_0x5521a0)return _0x4cc394[_0x5767c8(0x1e9)](0x194)['json']({'success':![],'message':_0x5767c8(0x1f5)});_0x4cc394[_0x5767c8(0x14d)]({'success':!![],'result':_0x5521a0});}catch(_0x425142){_0x3b2e94(_0x425142);}},this[_0x4c01e5(0x17a)]=async(_0x58ab36,_0x3aff1d,_0x49a1ad)=>{const _0x5cf9d9=_0x4c01e5;try{const {id:_0x2389d9}=_0x58ab36[_0x5cf9d9(0x1f1)];await this['adminService'][_0x5cf9d9(0x17a)](_0x2389d9),_0x3aff1d['json']({'success':!![],'message':_0x5cf9d9(0x189)});}catch(_0x5cdf2d){_0x49a1ad(_0x5cdf2d);}},this[_0x4c01e5(0x165)]=async(_0x10e64e,_0x1e495e,_0x184b06)=>{const _0x1ed2fd=_0x4c01e5;try{const {page:page=0x1,limit:limit=0x14,status:_0x774b2a,gateway:_0x447933,shopId:_0x3b6374,dateFrom:_0x3eb86a,dateTo:_0x2f550e,search:_0x57f12a,currency:_0x2542de,sortBy:_0x3540ed,sortOrder:_0x5c8ffe}=_0x10e64e['query'],_0x3d8c29={'page':Number(page),'limit':Number(limit),'status':_0x774b2a,'gateway':_0x447933,'shopId':_0x3b6374,'dateFrom':_0x3eb86a,'dateTo':_0x2f550e,'search':_0x57f12a,'currency':_0x2542de,'sortBy':_0x3540ed,'sortOrder':_0x5c8ffe},_0x593ec4=await this['adminService']['getAllPayments'](_0x3d8c29);_0x1e495e[_0x1ed2fd(0x14d)]({'success':!![],'payments':_0x593ec4[_0x1ed2fd(0x1d3)],'pagination':_0x593ec4[_0x1ed2fd(0x1f9)],'statistics':_0x593ec4['statistics']});}catch(_0x148282){_0x184b06(_0x148282);}},this[_0x4c01e5(0x1a9)]=async(_0x9e0482,_0x2dcb02,_0x2c2153)=>{const _0x3ec8fd=_0x4c01e5;try{const {id:_0xfa4a73}=_0x9e0482['params'],_0xb4ab7f=await this[_0x3ec8fd(0x164)][_0x3ec8fd(0x1a9)](_0xfa4a73);if(!_0xb4ab7f)return _0x2dcb02[_0x3ec8fd(0x1e9)](0x194)[_0x3ec8fd(0x14d)]({'success':![],'message':_0x3ec8fd(0x174)});_0x2dcb02[_0x3ec8fd(0x14d)]({'success':!![],'result':_0xb4ab7f});}catch(_0x161207){_0x2c2153(_0x161207);}},this[_0x4c01e5(0x1a1)]=async(_0x4c7c43,_0x547c1b,_0x5a2653)=>{const _0x25b5b1=_0x4c01e5;try{const {id:_0x2f11e9}=_0x4c7c43[_0x25b5b1(0x1f1)],{status:_0x390413,notes:_0xf782ae,chargebackAmount:_0x542a14}=_0x4c7c43[_0x25b5b1(0x1b0)],_0x32ff84=await this[_0x25b5b1(0x164)]['getPaymentById'](_0x2f11e9);if(!_0x32ff84)return _0x547c1b['status'](0x194)[_0x25b5b1(0x14d)]({'success':![],'message':_0x25b5b1(0x174)});const _0x4306a0=await this[_0x25b5b1(0x164)]['updatePaymentStatus'](_0x2f11e9,_0x390413,_0xf782ae,_0x542a14);if(_0x32ff84[_0x25b5b1(0x1e9)]!==_0x390413&&_0x390413['toUpperCase']()==='PAID'){console[_0x25b5b1(0x19c)](_0x25b5b1(0x1ff)+_0x2f11e9+_0x25b5b1(0x17b));try{await this['paymentLinkService'][_0x25b5b1(0x1d9)](_0x2f11e9),console[_0x25b5b1(0x19c)](_0x25b5b1(0x163)+_0x2f11e9);}catch(_0x5376c4){console[_0x25b5b1(0x1fd)](_0x25b5b1(0x1e0),_0x5376c4);}}if(_0x32ff84[_0x25b5b1(0x1e9)]!==_0x390413){console[_0x25b5b1(0x19c)](_0x25b5b1(0x1d1)+_0x2f11e9+'\x20status\x20changed\x20from\x20'+_0x32ff84[_0x25b5b1(0x1e9)]+_0x25b5b1(0x177)+_0x390413+_0x25b5b1(0x19e));try{let _0x37fdb2;switch(_0x390413[_0x25b5b1(0x16b)]()){case'PAID':_0x37fdb2=_0x25b5b1(0x1dc);break;case _0x25b5b1(0x17c):_0x37fdb2=_0x25b5b1(0x1ba);break;case _0x25b5b1(0x1b3):_0x37fdb2=_0x25b5b1(0x1f8);break;case'EXPIRED':_0x37fdb2=_0x25b5b1(0x18a);break;case _0x25b5b1(0x168):_0x37fdb2=_0x25b5b1(0x154);break;case'CHARGEBACK':_0x37fdb2=_0x25b5b1(0x1c5);break;default:console['log'](_0x25b5b1(0x1ec)+_0x390413);break;}if(_0x37fdb2){const _0xc3ec06={..._0x4306a0,'shopId':_0x32ff84[_0x25b5b1(0x1b4)],'gateway':_0x32ff84[_0x25b5b1(0x16f)],'createdAt':_0x32ff84[_0x25b5b1(0x1ef)],'chargebackAmount':_0x542a14};await telegramBotService_1[_0x25b5b1(0x1bd)][_0x25b5b1(0x162)](_0x32ff84[_0x25b5b1(0x1b4)],_0xc3ec06,_0x37fdb2),console[_0x25b5b1(0x19c)]('‚úÖ\x20Telegram\x20notification\x20sent\x20for\x20status\x20change:\x20'+_0x32ff84[_0x25b5b1(0x1e9)]+_0x25b5b1(0x15d)+_0x390413);}}catch(_0x42f5b8){console[_0x25b5b1(0x1fd)]('Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20status\x20change:',_0x42f5b8);}}_0x547c1b[_0x25b5b1(0x14d)]({'success':!![],'message':_0x25b5b1(0x17f),'result':_0x4306a0});}catch(_0x17d041){_0x5a2653(_0x17d041);}},this[_0x4c01e5(0x1c2)]=async(_0x47ada8,_0x54a887,_0x4c81f5)=>{const _0x15ad0f=_0x4c01e5;try{const {id:_0xb1968f}=_0x47ada8[_0x15ad0f(0x1f1)],_0x578e5a=_0x47ada8[_0x15ad0f(0x1b0)];console[_0x15ad0f(0x19c)](_0x15ad0f(0x193)+_0xb1968f+':',_0x578e5a);const _0x1ceea0=await this['adminService'][_0x15ad0f(0x1c2)](_0xb1968f,_0x578e5a);_0x54a887[_0x15ad0f(0x14d)]({'success':!![],'message':_0x15ad0f(0x185),'result':_0x1ceea0});}catch(_0x140309){_0x4c81f5(_0x140309);}},this[_0x4c01e5(0x1a7)]=async(_0x33b139,_0x20bb29,_0x45e6c8)=>{const _0x231890=_0x4c01e5;try{const {id:_0x6f3a3a}=_0x33b139[_0x231890(0x1f1)],_0x3f24ca=_0x33b139['body'],_0x181dbd=await this['adminService']['updateUser'](_0x6f3a3a,_0x3f24ca);_0x20bb29[_0x231890(0x14d)]({'success':!![],'message':_0x231890(0x167),'result':_0x181dbd});}catch(_0x112019){_0x45e6c8(_0x112019);}},this[_0x4c01e5(0x1c1)]=async(_0x9fb5c4,_0x3da822,_0x4d3e1e)=>{const _0x3b43e3=_0x4c01e5;try{const {id:_0x58c8ef}=_0x9fb5c4[_0x3b43e3(0x1f1)],_0x3850c7=await this[_0x3b43e3(0x164)]['suspendUser'](_0x58c8ef);_0x3da822[_0x3b43e3(0x14d)]({'success':!![],'message':_0x3b43e3(0x1d4),'result':_0x3850c7});}catch(_0x11a819){_0x4d3e1e(_0x11a819);}},this[_0x4c01e5(0x15f)]=async(_0x429c47,_0x51d52a,_0x1c7f3b)=>{const _0x382b34=_0x4c01e5;try{const {id:_0x393667}=_0x429c47[_0x382b34(0x1f1)],_0x7931c=await this[_0x382b34(0x164)]['activateUser'](_0x393667);_0x51d52a[_0x382b34(0x14d)]({'success':!![],'message':_0x382b34(0x152),'result':_0x7931c});}catch(_0x4ff51a){_0x1c7f3b(_0x4ff51a);}},this[_0x4c01e5(0x19d)]=async(_0x34c652,_0x1fffdd,_0x25c6cd)=>{const _0x5e2287=_0x4c01e5;try{const {page:page=0x1,limit:limit=0x14,status:_0x408379,search:_0x525a7e}=_0x34c652[_0x5e2287(0x15c)],_0x12bcef={'page':Number(page),'limit':Number(limit),'status':_0x408379,'search':_0x525a7e},_0x65126e=await this['adminService'][_0x5e2287(0x1c0)](_0x12bcef);_0x1fffdd[_0x5e2287(0x14d)]({'success':!![],'users':_0x65126e[_0x5e2287(0x14a)],'pagination':_0x65126e[_0x5e2287(0x1f9)]});}catch(_0x15d170){_0x25c6cd(_0x15d170);}},this[_0x4c01e5(0x1aa)]=async(_0x39e165,_0x43be34,_0x4736ed)=>{const _0x347123=_0x4c01e5;try{const {id:_0x41a15f}=_0x39e165[_0x347123(0x1f1)],_0x15dc0e=await this[_0x347123(0x164)][_0x347123(0x1aa)](_0x41a15f);if(!_0x15dc0e)return _0x43be34['status'](0x194)[_0x347123(0x14d)]({'success':![],'message':'User\x20not\x20found'});_0x43be34[_0x347123(0x14d)]({'success':!![],'result':_0x15dc0e});}catch(_0x432737){_0x4736ed(_0x432737);}},this[_0x4c01e5(0x176)]=async(_0x1dd2af,_0x4be119,_0x1c7a61)=>{const _0x50837c=_0x4c01e5;try{const _0x25f8c4=_0x1dd2af[_0x50837c(0x1b0)],_0x34cfa0=await this['adminService']['createUser'](_0x25f8c4);_0x4be119[_0x50837c(0x1e9)](0xc9)[_0x50837c(0x14d)]({'success':!![],'message':_0x50837c(0x157),'result':_0x34cfa0});}catch(_0x3ab44d){_0x1c7a61(_0x3ab44d);}},this[_0x4c01e5(0x1d2)]=async(_0x209578,_0x5039fe,_0x5803b3)=>{const _0x487350=_0x4c01e5;try{const {id:_0x515f79}=_0x209578[_0x487350(0x1f1)],{twoFactorToken:_0xd04f2d}=_0x209578[_0x487350(0x1b0)];await this[_0x487350(0x164)]['deleteUser'](_0x515f79,_0xd04f2d),_0x5039fe[_0x487350(0x14d)]({'success':!![],'message':_0x487350(0x1b1)});}catch(_0x339e8c){_0x5803b3(_0x339e8c);}},this[_0x4c01e5(0x1e8)]=async(_0x1220cd,_0x2aa832,_0x184163)=>{const _0x5b6e72=_0x4c01e5;try{const {shopId:_0x528938}=_0x1220cd[_0x5b6e72(0x1f1)],_0x80b09d=await this['adminService']['getShopWallets'](_0x528938);_0x2aa832[_0x5b6e72(0x14d)]({'success':!![],'wallets':_0x80b09d});}catch(_0x4061ed){_0x184163(_0x4061ed);}},this['setup2FA']=async(_0x254362,_0x5f31a1,_0x3420f8)=>{const _0xd72b9d=_0x4c01e5;try{const {shopId:_0x116295}=_0x254362['params'],_0x4978c3=await this[_0xd72b9d(0x164)][_0xd72b9d(0x1b8)](_0x116295);_0x5f31a1[_0xd72b9d(0x14d)]({'success':!![],'result':_0x4978c3});}catch(_0x703a38){_0x3420f8(_0x703a38);}},this[_0x4c01e5(0x171)]=async(_0x21d1ea,_0x43202e,_0x21c3bd)=>{const _0x4e8edd=_0x4c01e5;try{const {shopId:_0x25e9d2}=_0x21d1ea[_0x4e8edd(0x1f1)],{token:_0x249aca}=_0x21d1ea[_0x4e8edd(0x1b0)];if(!_0x249aca)return _0x43202e['status'](0x190)[_0x4e8edd(0x14d)]({'success':![],'message':_0x4e8edd(0x1cb)});const _0x3168b2=await this['adminService']['enable2FA'](_0x25e9d2,_0x249aca);_0x43202e[_0x4e8edd(0x14d)]({'success':!![],'message':_0x4e8edd(0x1df),'result':_0x3168b2});}catch(_0x653272){_0x21c3bd(_0x653272);}},this[_0x4c01e5(0x1ae)]=async(_0x30838,_0x3f49d3,_0x37c133)=>{const _0x227d1a=_0x4c01e5;try{const {shopId:_0x11244e}=_0x30838[_0x227d1a(0x1f1)];await this[_0x227d1a(0x164)][_0x227d1a(0x1ae)](_0x11244e),_0x3f49d3[_0x227d1a(0x14d)]({'success':!![],'message':_0x227d1a(0x1a5)});}catch(_0x5237a8){_0x37c133(_0x5237a8);}},this[_0x4c01e5(0x1e4)]=async(_0x26dd73,_0x147ec2,_0x490a74)=>{const _0x4b48c1=_0x4c01e5;try{const _0x564429=await paymentCleanupService_1['paymentCleanupService'][_0x4b48c1(0x1e4)]();_0x147ec2['json']({'success':!![],'result':_0x564429});}catch(_0x571e78){_0x490a74(_0x571e78);}},this['cleanupStalePayments']=async(_0x3f9632,_0xcdb71c,_0x5d5113)=>{const _0x288e10=_0x4c01e5;try{console[_0x288e10(0x19c)](_0x288e10(0x1c4)+_0x3f9632[_0x288e10(0x199)]?.[_0x288e10(0x1e1)]+'\x20('+_0x3f9632['user']?.['id']+')');const _0x1d43b6=await paymentCleanupService_1[_0x288e10(0x19a)][_0x288e10(0x155)]();_0xcdb71c['json']({'success':!![],'message':_0x288e10(0x1ed),'result':{'processed':_0x1d43b6[_0x288e10(0x1a8)],'failed':_0x1d43b6[_0x288e10(0x1f8)],'errors':_0x1d43b6[_0x288e10(0x1f7)]}});}catch(_0x1d998e){_0x5d5113(_0x1d998e);}},this[_0x4c01e5(0x1e3)]=async(_0xfcf854,_0x2f3dd1,_0x3a2e00)=>{const _0x1381fb=_0x4c01e5;try{console[_0x1381fb(0x19c)](_0x1381fb(0x18e)+_0xfcf854['user']?.[_0x1381fb(0x1e1)]+'\x20('+_0xfcf854[_0x1381fb(0x199)]?.['id']+')');const _0x2950f4=await paymentCleanupService_1[_0x1381fb(0x19a)]['cleanupStalePendingPayments']();_0x2f3dd1[_0x1381fb(0x14d)]({'success':!![],'message':_0x1381fb(0x1ab),'result':{'processed':_0x2950f4[_0x1381fb(0x1a8)],'failed':_0x2950f4[_0x1381fb(0x1f8)],'errors':_0x2950f4[_0x1381fb(0x1f7)]}});}catch(_0x13207b){_0x3a2e00(_0x13207b);}},this[_0x4c01e5(0x14c)]=async(_0x58b792,_0x291d7d,_0x2a9af7)=>{const _0x5e306a=_0x4c01e5;try{console['log'](_0x5e306a(0x1a2)+_0x58b792['user']?.['username']+'\x20('+_0x58b792[_0x5e306a(0x199)]?.['id']+')');const _0x1961a6=await paymentCleanupService_1[_0x5e306a(0x19a)][_0x5e306a(0x1e4)](),_0x430e3e=await paymentCleanupService_1[_0x5e306a(0x19a)][_0x5e306a(0x155)](),_0x185ceb=await paymentCleanupService_1[_0x5e306a(0x19a)][_0x5e306a(0x1e3)](),_0x6f540e=await paymentCleanupService_1[_0x5e306a(0x19a)][_0x5e306a(0x1e4)]();_0x291d7d['json']({'success':!![],'message':'Payment\x20cleanup\x20(PROCESSING\x20+\x20PENDING)\x20with\x20report\x20completed\x20successfully','result':{'cleanup':{'processing':{'processed':_0x430e3e[_0x5e306a(0x1a8)],'failed':_0x430e3e['failed'],'errors':_0x430e3e[_0x5e306a(0x1f7)]},'pending':{'processed':_0x185ceb['processed'],'failed':_0x185ceb[_0x5e306a(0x1f8)],'errors':_0x185ceb[_0x5e306a(0x1f7)]},'total':{'processed':_0x430e3e[_0x5e306a(0x1a8)]+_0x185ceb[_0x5e306a(0x1a8)],'failed':_0x430e3e[_0x5e306a(0x1f8)]+_0x185ceb[_0x5e306a(0x1f8)],'errors':[..._0x430e3e[_0x5e306a(0x1f7)],..._0x185ceb['errors']]}},'statistics':{'before':_0x1961a6,'after':_0x6f540e,'reduced':_0x1961a6['total']-_0x6f540e[_0x5e306a(0x166)]}}});}catch(_0x150a1b){_0x2a9af7(_0x150a1b);}},this[_0x4c01e5(0x1cd)]=async(_0x50e886,_0x4d6edf,_0x2c3d9e)=>{const _0x2bf533=_0x4c01e5;try{const _0x53c72b=await paymentCleanupService_1[_0x2bf533(0x19a)]['expireSinglePaymentLinks']();_0x4d6edf[_0x2bf533(0x14d)]({'success':!![],'message':_0x2bf533(0x1a0),'result':{'expired':_0x53c72b[_0x2bf533(0x18a)],'errors':_0x53c72b[_0x2bf533(0x1f7)]}});}catch(_0x3bbe06){_0x2c3d9e(_0x3bbe06);}},this[_0x4c01e5(0x1de)]=async(_0x160c68,_0x492c5c,_0x1b3d32)=>{const _0x37683d=_0x4c01e5;try{const {currentPassword:_0xe52c25,newPassword:_0x455dd7,confirmNewPassword:_0x4ee475,twoFactorToken:_0x464244}=_0x160c68['body'];await this[_0x37683d(0x164)][_0x37683d(0x1de)](_0xe52c25,_0x455dd7,_0x4ee475,_0x464244),_0x492c5c[_0x37683d(0x14d)]({'success':!![],'message':_0x37683d(0x1f3)});}catch(_0x258529){_0x1b3d32(_0x258529);}},this[_0x4c01e5(0x173)]=async(_0x2030b2,_0x45a718,_0x3c3dad)=>{const _0x48aa05=_0x4c01e5;try{const _0x652988=await this['adminService'][_0x48aa05(0x173)]();_0x45a718['json']({'success':!![],'result':_0x652988});}catch(_0x2a96e9){_0x3c3dad(_0x2a96e9);}},this[_0x4c01e5(0x1b2)]=async(_0x9bda07,_0x324ff7,_0x1ebc89)=>{const _0x2235c6=_0x4c01e5;try{const _0x43072d=await this[_0x2235c6(0x164)][_0x2235c6(0x1b2)]();_0x324ff7[_0x2235c6(0x14d)]({'success':!![],'result':_0x43072d});}catch(_0x37602e){_0x1ebc89(_0x37602e);}},this[_0x4c01e5(0x18d)]=async(_0x2849dc,_0x5c8ae5,_0x4370a7)=>{const _0x134c7b=_0x4c01e5;try{const {token:_0x18fef5}=_0x2849dc['body'],_0x340872=await this[_0x134c7b(0x164)][_0x134c7b(0x18d)](_0x18fef5);_0x5c8ae5['json']({'success':!![],'result':_0x340872});}catch(_0x146b50){_0x4370a7(_0x146b50);}},this[_0x4c01e5(0x1f4)]=async(_0x70b872,_0x11382d,_0xb6b9de)=>{const _0x160480=_0x4c01e5;try{await this[_0x160480(0x164)][_0x160480(0x1f4)](),_0x11382d[_0x160480(0x14d)]({'success':!![],'message':_0x160480(0x1bc)});}catch(_0x67e10f){_0xb6b9de(_0x67e10f);}},this['depositBalance']=async(_0x202ace,_0x40c0ef,_0x2ef2a7)=>{const _0x417445=_0x4c01e5;try{const {shopId:_0x508a0b,amount:_0x13e31d,notes:_0x26294a}=_0x202ace['body'];if(!_0x508a0b||!_0x13e31d)return _0x40c0ef[_0x417445(0x1e9)](0x190)[_0x417445(0x14d)]({'success':![],'message':_0x417445(0x18c)});if(_0x13e31d<=0x0)return _0x40c0ef[_0x417445(0x1e9)](0x190)[_0x417445(0x14d)]({'success':![],'message':_0x417445(0x1b9)});await this[_0x417445(0x164)]['depositBalance'](_0x508a0b,_0x13e31d,_0x26294a),_0x40c0ef[_0x417445(0x14d)]({'success':!![],'message':_0x417445(0x1e7)});}catch(_0x3fa19d){_0x2ef2a7(_0x3fa19d);}},this[_0x4c01e5(0x1a3)]=async(_0x68beb2,_0x50c141,_0x549b7d)=>{const _0x3d2add=_0x4c01e5;try{const {shopId:_0xd0fc53}=_0x68beb2['params'],{page:page='1',limit:limit='20'}=_0x68beb2[_0x3d2add(0x15c)],_0x2d1852=(await Promise[_0x3d2add(0x14f)]()[_0x3d2add(0x1ea)](()=>__importStar(require('../config/database'))))['default'],_0x19fdbe=parseInt(page,0xa),_0x408ab7=parseInt(limit,0xa),_0xea70cc=(_0x19fdbe-0x1)*_0x408ab7,[_0x4db1d5,_0x87715b]=await Promise[_0x3d2add(0x1cc)]([_0x2d1852[_0x3d2add(0x1ac)][_0x3d2add(0x186)]({'where':{'shopId':_0xd0fc53},'orderBy':{'createdAt':_0x3d2add(0x1d6)},'skip':_0xea70cc,'take':_0x408ab7}),_0x2d1852['loginLog'][_0x3d2add(0x161)]({'where':{'shopId':_0xd0fc53}})]);_0x50c141[_0x3d2add(0x14d)]({'success':!![],'result':{'logs':_0x4db1d5,'pagination':{'page':_0x19fdbe,'limit':_0x408ab7,'total':_0x87715b,'totalPages':Math[_0x3d2add(0x170)](_0x87715b/_0x408ab7)}}});}catch(_0x3f4501){_0x549b7d(_0x3f4501);}},this[_0x4c01e5(0x1ee)]=async(_0x1a4888,_0x2708eb,_0x11deb9)=>{const _0x19bb5d=_0x4c01e5;try{const _0x165f0e=gatewaySettingsService_1[_0x19bb5d(0x17e)][_0x19bb5d(0x1d5)]();_0x2708eb[_0x19bb5d(0x14d)]({'success':!![],'result':_0x165f0e});}catch(_0x1ff2ef){_0x11deb9(_0x1ff2ef);}},this[_0x4c01e5(0x1fb)]=async(_0xd43b69,_0x1fcfe2,_0x43c5ce)=>{const _0xce2908=_0x4c01e5;try{const {gatewayId:_0x436d32}=_0xd43b69[_0xce2908(0x1f1)],{minAmount:_0xda13a2,maxAmount:_0x85da0a,payoutDelay:_0x5061e9,gatewayCommission:_0x1dc648}=_0xd43b69[_0xce2908(0x1b0)],_0x17f94f=gatewaySettingsService_1['gatewaySettingsService']['updateSettings'](_0x436d32,{'minAmount':_0xda13a2!==undefined?Number(_0xda13a2):undefined,'maxAmount':_0x85da0a!==undefined?Number(_0x85da0a):undefined,'payoutDelay':_0x5061e9!==undefined?Number(_0x5061e9):undefined,'gatewayCommission':_0x1dc648!==undefined?Number(_0x1dc648):undefined});_0x1fcfe2[_0xce2908(0x14d)]({'success':!![],'message':'Gateway\x20settings\x20updated\x20successfully','result':_0x17f94f});}catch(_0x579b64){_0x43c5ce(_0x579b64);}},this[_0x4c01e5(0x1a6)]=async(_0x4ae98d,_0x4462f0,_0xb729b7)=>{const _0x362689=_0x4c01e5;try{const {gatewayId:_0x217637}=_0x4ae98d[_0x362689(0x1f1)];console[_0x362689(0x19c)]('üìä\x20[GATEWAY\x20STATS]\x20Requesting\x20statistics\x20for\x20gateway\x20ID:\x20'+_0x217637);const {GATEWAY_ID_MAP:_0x8fa8c6}=await Promise[_0x362689(0x14f)]()[_0x362689(0x1ea)](()=>__importStar(require(_0x362689(0x1d7)))),_0x152aec=_0x8fa8c6[_0x217637];console[_0x362689(0x19c)](_0x362689(0x1ad)+_0x217637+_0x362689(0x153)+_0x152aec);if(!_0x152aec)return console['log']('‚ùå\x20[GATEWAY\x20STATS]\x20Gateway\x20not\x20found\x20for\x20ID:\x20'+_0x217637),_0x4462f0[_0x362689(0x1e9)](0x194)[_0x362689(0x14d)]({'success':![],'message':_0x362689(0x172)});console[_0x362689(0x19c)](_0x362689(0x1dd)+_0x152aec+_0x362689(0x1db));const _0xcea183=await database_1[_0x362689(0x190)][_0x362689(0x1b6)][_0x362689(0x186)]({'where':{'gateway':_0x152aec},'select':{'id':!![],'status':!![],'amountUSDT':!![]},'take':0x5});console[_0x362689(0x19c)]('üîç\x20[GATEWAY\x20STATS]\x20Sample\x20payments\x20for\x20'+_0x152aec+':',JSON[_0x362689(0x1f6)](_0xcea183,null,0x2));const _0x508767=await database_1[_0x362689(0x190)][_0x362689(0x1b6)][_0x362689(0x17d)]({'where':{'gateway':_0x152aec,'status':_0x362689(0x1c9)},'_sum':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]},'_count':{'_all':!![]}});console['log']('üí∞\x20[GATEWAY\x20STATS]\x20Paid\x20payments\x20result:',JSON[_0x362689(0x1f6)](_0x508767,null,0x2));const _0x48209f=await database_1[_0x362689(0x190)]['payment']['count']({'where':{'gateway':_0x152aec,'status':'CHARGEBACK'}});console[_0x362689(0x19c)]('üîô\x20[GATEWAY\x20STATS]\x20Chargeback\x20count:\x20'+_0x48209f);const _0x42266a=await database_1['default'][_0x362689(0x1b6)][_0x362689(0x161)]({'where':{'gateway':_0x152aec,'status':_0x362689(0x168)}});console['log']('üí∏\x20[GATEWAY\x20STATS]\x20Refund\x20count:\x20'+_0x42266a);const _0x2d423b=_0x508767[_0x362689(0x1f0)]['amountUSDT']||0x0,_0x55200a=(_0x508767[_0x362689(0x1f0)][_0x362689(0x198)]||0x0)-(_0x508767['_sum'][_0x362689(0x18b)]||0x0),_0xb194ba=_0x508767[_0x362689(0x1c6)][_0x362689(0x1c7)],_0x4ced0e=_0xb194ba>0x0?_0x48209f/_0xb194ba*0x64:0x0;console[_0x362689(0x19c)]('üìà\x20[GATEWAY\x20STATS]\x20Calculated\x20statistics:'),console[_0x362689(0x19c)](_0x362689(0x159)+_0x2d423b),console['log']('\x20\x20\x20-\x20Total\x20Commission:\x20'+_0x55200a),console[_0x362689(0x19c)](_0x362689(0x19f)+_0xb194ba),console[_0x362689(0x19c)](_0x362689(0x1eb)+_0x4ced0e+'%'),_0x4462f0[_0x362689(0x14d)]({'success':!![],'result':{'gatewayId':_0x217637,'totalTurnover':Number(_0x2d423b['toFixed'](0x2)),'totalCommission':Number(_0x55200a[_0x362689(0x1bf)](0x2)),'successfulPayments':_0xb194ba,'chargebackCount':_0x48209f,'chargebackRate':Number(_0x4ced0e['toFixed'](0x2)),'refundCount':_0x42266a}});}catch(_0x59ce46){console['error'](_0x362689(0x15e),_0x59ce46),_0xb729b7(_0x59ce46);}},this[_0x4c01e5(0x164)]=new adminService_1[(_0x4c01e5(0x1e2))](),this[_0x4c01e5(0x196)]=new paymentLinkService_1[(_0x4c01e5(0x197))]();}}function a4_0x103c(_0xdb5243,_0x5925c6){_0xdb5243=_0xdb5243-0x14a;const _0x1e6925=a4_0x1e69();let _0x103cd0=_0x1e6925[_0xdb5243];return _0x103cd0;}exports['AdminController']=AdminController;function a4_0x1e69(){const _0x2342a0=['activateUser','Payout\x20created\x20successfully','count','sendPaymentNotification','‚úÖ\x20Payment\x20link\x20counter\x20updated\x20for\x20payment\x20','adminService','getPayments','total','User\x20updated\x20successfully','REFUND','getPayoutById','8uCIEHW','toUpperCase','role','payouts','AdminController','gateway','ceil','enable2FA','Gateway\x20not\x20found','get2FASettings','Payment\x20not\x20found','length','createUser','\x20to\x20','getPayoutReports','üìä\x20Admin\x20requesting\x20payout\x20reports:','deletePayout','\x20to\x20PAID,\x20updating\x20payment\x20link\x20counter','PROCESSING','aggregate','gatewaySettingsService','Payment\x20updated\x20successfully','Admin\x20access\x20confirmed','5wNreqy','__setModuleDefault','getPayouts','defineProperty','Customer\x20data\x20updated\x20successfully','findMany','../config/database','147484cdMpam','Payout\x20deleted\x20successfully','expired','amountAfterGatewayCommissionUSDT','shopId\x20and\x20amount\x20are\x20required','enableAdmin2FA','‚è∞\x20Manual\x20PENDING\x20payment\x20cleanup\x20initiated\x20by\x20admin:\x20','23897680KkvDeK','default','getMerchantStatistics','2590482ODwgfe','üîÑ\x20Admin\x20updating\x20customer\x20data\x20for\x20payment\x20','getMerchantsAwaitingPayout','hasPayoutHistory','paymentLinkService','PaymentLinkService','amountUSDT','user','paymentCleanupService','üéØ\x20[CONTROLLER]\x20Updating\x20payout\x20','log','getUsers',',\x20sending\x20Telegram\x20notification','\x20\x20\x20-\x20Successful\x20Payments:\x20','Payment\x20link\x20expiration\x20check\x20completed\x20successfully','updatePayment','üìä\x20Manual\x20payment\x20cleanup\x20(PROCESSING\x20+\x20PENDING)\x20with\x20report\x20initiated\x20by\x20admin:\x20','getLoginLogs','getSystemStatistics','2FA\x20disabled\x20successfully','getGatewayStatistics','updateUser','processed','getPaymentById','getUserById','PENDING\x20payment\x20cleanup\x20completed\x20successfully','loginLog','üìä\x20[GATEWAY\x20STATS]\x20Gateway\x20ID\x20','disable2FA','call','body','User\x20deleted\x20successfully','setupAdmin2FA','FAILED','shopId','../services/paymentLinkService','payment','create','setup2FA','Amount\x20must\x20be\x20greater\x20than\x200','processing','getOwnPropertyDescriptor','Admin\x202FA\x20disabled\x20successfully','telegramBotService','updatePayout','toFixed','getAllUsers','suspendUser','updateCustomerData','__importDefault','üßπ\x20Manual\x20PROCESSING\x20payment\x20cleanup\x20initiated\x20by\x20admin:\x20','chargeback','_count','_all','30258NhbJgr','PAID','../services/telegramBotService','Token\x20is\x20required','all','expirePaymentLinks','4950813qZFThz','3417028SAAwHw','../services/paymentCleanupService','üì±\x20Payment\x20','deleteUser','payments','User\x20suspended\x20successfully','getAllGatewaysWithSettings','desc','../types/gateway','prototype','handleSuccessfulPayment','hasOwnProperty','\x22\x20and\x20status=\x22PAID\x22','paid','üîç\x20[GATEWAY\x20STATS]\x20Querying\x20payments\x20with\x20gateway=\x22','changeAdminPassword','2FA\x20enabled\x20successfully','Failed\x20to\x20update\x20payment\x20link\x20counter:','username','AdminService','cleanupStalePendingPayments','getProcessingPaymentsStats','merchants','summary','Balance\x20deposited\x20successfully','getShopWallets','status','then','\x20\x20\x20-\x20Chargeback\x20Rate:\x20','üì±\x20Skipping\x20Telegram\x20notification\x20for\x20status\x20change\x20to:\x20','PROCESSING\x20payment\x20cleanup\x20completed\x20successfully','getGatewaySettings','createdAt','_sum','params','__esModule','Admin\x20password\x20changed\x20successfully','disableAdmin2FA','Payout\x20not\x20found','stringify','errors','failed','pagination','getStatistics','updateGatewaySettings','getMerchantsSelection','error','getOwnPropertyNames','üìà\x20Admin\x20changed\x20payment\x20','users','__importStar','cleanupStalePaymentsWithReport','json','1672866KpqhcQ','resolve','Payout\x20updated\x20successfully','../services/adminService','User\x20activated\x20successfully','\x20->\x20Gateway\x20Name:\x20','refund','cleanupStaleProcessingPayments','üìä\x20Admin\x20requesting\x20merchant\x20statistics\x20with\x20filters:','User\x20created\x20successfully','112aIGwst','\x20\x20\x20-\x20Total\x20Turnover:\x20','month','__createBinding','query','\x20->\x20','‚ùå\x20[GATEWAY\x20STATS]\x20Error:'];a4_0x1e69=function(){return _0x2342a0;};return a4_0x1e69();}