'use strict';const a3_0x324eb8=a3_0x22e8;(function(_0x4b6d51,_0x4948f4){const _0x48c180=a3_0x22e8,_0x2e2545=_0x4b6d51();while(!![]){try{const _0x509408=-parseInt(_0x48c180(0x210))/0x1+parseInt(_0x48c180(0x239))/0x2+-parseInt(_0x48c180(0x1fd))/0x3+parseInt(_0x48c180(0x247))/0x4+parseInt(_0x48c180(0x252))/0x5+-parseInt(_0x48c180(0x254))/0x6+parseInt(_0x48c180(0x223))/0x7*(parseInt(_0x48c180(0x229))/0x8);if(_0x509408===_0x4948f4)break;else _0x2e2545['push'](_0x2e2545['shift']());}catch(_0xeb5889){_0x2e2545['push'](_0x2e2545['shift']());}}}(a3_0x5035,0x82e24));function a3_0x22e8(_0x3eba9d,_0x4c260b){const _0x503597=a3_0x5035();return a3_0x22e8=function(_0x22e8f9,_0x1380ab){_0x22e8f9=_0x22e8f9-0x1f2;let _0x436e1b=_0x503597[_0x22e8f9];return _0x436e1b;},a3_0x22e8(_0x3eba9d,_0x4c260b);}Object['defineProperty'](exports,a3_0x324eb8(0x21e),{'value':!![]}),exports[a3_0x324eb8(0x207)]=void 0x0;const adminService_1=require(a3_0x324eb8(0x209)),paymentLinkService_1=require(a3_0x324eb8(0x255)),paymentCleanupService_1=require(a3_0x324eb8(0x245)),telegramBotService_1=require('../services/telegramBotService');class AdminController{constructor(){const _0x3a481f=a3_0x324eb8;this[_0x3a481f(0x20c)]=async(_0x4d56bf,_0x221c6f,_0x2f214d)=>{const _0x2c8c34=_0x3a481f;try{const _0x428daf=_0x4d56bf[_0x2c8c34(0x20a)];_0x221c6f[_0x2c8c34(0x21c)]({'success':!![],'message':_0x2c8c34(0x23d),'user':{'id':_0x428daf?.['id'],'username':_0x428daf?.[_0x2c8c34(0x204)],'role':_0x428daf?.['role']}});}catch(_0x3f2051){_0x2f214d(_0x3f2051);}},this[_0x3a481f(0x20b)]=async(_0x3671a8,_0x4737f2,_0x50af45)=>{const _0x1be010=_0x3a481f;try{const {period:period=_0x1be010(0x249)}=_0x3671a8['query'],_0x370d0c=await this[_0x1be010(0x24d)][_0x1be010(0x20d)](period);_0x4737f2[_0x1be010(0x21c)]({'success':!![],'result':_0x370d0c});}catch(_0x16c6e1){_0x50af45(_0x16c6e1);}},this[_0x3a481f(0x250)]=async(_0x531bdd,_0x105fb6,_0xfc13f5)=>{const _0x4e56ff=_0x3a481f;try{const {shopId:_0x2a3da2,period:period='month',dateFrom:_0x509e71,dateTo:_0x25a52b}=_0x531bdd[_0x4e56ff(0x21b)],_0x1d63dd={'shopId':_0x2a3da2,'period':period,'dateFrom':_0x509e71,'dateTo':_0x25a52b};console[_0x4e56ff(0x24e)](_0x4e56ff(0x236),_0x1d63dd);const _0x325807=await this[_0x4e56ff(0x24d)][_0x4e56ff(0x250)](_0x1d63dd);_0x105fb6['json']({'success':!![],'result':_0x325807});}catch(_0x45dff7){_0xfc13f5(_0x45dff7);}},this[_0x3a481f(0x20f)]=async(_0x68e9cd,_0x41d9a0,_0x2814eb)=>{const _0x117026=_0x3a481f;try{const _0x2f9463=await this[_0x117026(0x24d)][_0x117026(0x20f)]();_0x41d9a0[_0x117026(0x21c)]({'success':!![],'result':_0x2f9463});}catch(_0x32096b){_0x2814eb(_0x32096b);}},this[_0x3a481f(0x256)]=async(_0x104949,_0x41ea9f,_0x376091)=>{const _0x36e533=_0x3a481f;try{const {page:page=0x1,limit:limit=0x14,minAmount:_0x165c56,search:_0x377cb6}=_0x104949[_0x36e533(0x21b)],_0x361182={'page':Number(page),'limit':Number(limit),'minAmount':_0x165c56?Number(_0x165c56):undefined,'search':_0x377cb6},_0x390447=await this[_0x36e533(0x24d)][_0x36e533(0x256)](_0x361182);_0x41ea9f[_0x36e533(0x21c)]({'success':!![],'merchants':_0x390447[_0x36e533(0x23f)],'pagination':_0x390447[_0x36e533(0x234)],'summary':_0x390447[_0x36e533(0x201)]});}catch(_0xb9b1e3){_0x376091(_0xb9b1e3);}},this[_0x3a481f(0x222)]=async(_0x2926ab,_0x5daf32,_0x30b680)=>{const _0x16ee42=_0x3a481f;try{const _0x43bf8e=await this[_0x16ee42(0x24d)][_0x16ee42(0x222)]();_0x5daf32[_0x16ee42(0x21c)]({'success':!![],'result':_0x43bf8e});}catch(_0x117595){_0x30b680(_0x117595);}},this[_0x3a481f(0x203)]=async(_0x1b187d,_0x536d30,_0x286f08)=>{const _0x3ccfe6=_0x3a481f;try{const _0x5caf54=_0x1b187d[_0x3ccfe6(0x202)],_0x26ab79=await this[_0x3ccfe6(0x24d)][_0x3ccfe6(0x203)](_0x5caf54);_0x536d30['status'](0xc9)['json']({'success':!![],'message':_0x3ccfe6(0x228),'result':_0x26ab79});}catch(_0x3ef575){_0x286f08(_0x3ef575);}},this[_0x3a481f(0x21a)]=async(_0x32fdde,_0x47b04d,_0x11fd73)=>{const _0x2075ab=_0x3a481f;try{const {page:page=0x1,limit:limit=0x14,shopId:_0x3f8def,network:_0x3d3def,dateFrom:_0x420abf,dateTo:_0x4253b7,search:_0x3f7382}=_0x32fdde['query'],_0x517ed4={'page':Number(page),'limit':Number(limit),'shopId':_0x3f8def,'network':_0x3d3def,'dateFrom':_0x420abf,'dateTo':_0x4253b7,'search':_0x3f7382},_0x1b4671=await this[_0x2075ab(0x24d)][_0x2075ab(0x224)](_0x517ed4);_0x47b04d['json']({'success':!![],'payouts':_0x1b4671['payouts'],'pagination':_0x1b4671[_0x2075ab(0x234)]});}catch(_0x5e87de){_0x11fd73(_0x5e87de);}},this[_0x3a481f(0x200)]=async(_0x56be61,_0x211b0b,_0x198dcc)=>{const _0x4a9286=_0x3a481f;try{const {id:_0x48ea49}=_0x56be61['params'],_0xf9f99e=await this[_0x4a9286(0x24d)]['getPayoutById'](_0x48ea49);if(!_0xf9f99e)return _0x211b0b[_0x4a9286(0x231)](0x194)['json']({'success':![],'message':_0x4a9286(0x218)});_0x211b0b[_0x4a9286(0x21c)]({'success':!![],'result':_0xf9f99e});}catch(_0x42bb2e){_0x198dcc(_0x42bb2e);}},this[_0x3a481f(0x1f6)]=async(_0x3ddfc5,_0x194bff,_0x2981e0)=>{const _0x4f525b=_0x3a481f;try{const {id:_0xb2135f}=_0x3ddfc5[_0x4f525b(0x221)];await this[_0x4f525b(0x24d)][_0x4f525b(0x1f6)](_0xb2135f),_0x194bff[_0x4f525b(0x21c)]({'success':!![],'message':_0x4f525b(0x22f)});}catch(_0x460302){_0x2981e0(_0x460302);}},this['getPayments']=async(_0x26a310,_0xfe4143,_0x4bbc1e)=>{const _0x34fd09=_0x3a481f;try{const {page:page=0x1,limit:limit=0x14,status:_0x429629,gateway:_0x3d8e50,shopId:_0x4bbb96,dateFrom:_0x5f4a64,dateTo:_0x4a157f,search:_0x5aea84,currency:_0x1de342,sortBy:_0x3cae5,sortOrder:_0x10a7d8}=_0x26a310[_0x34fd09(0x21b)],_0x586e77={'page':Number(page),'limit':Number(limit),'status':_0x429629,'gateway':_0x3d8e50,'shopId':_0x4bbb96,'dateFrom':_0x5f4a64,'dateTo':_0x4a157f,'search':_0x5aea84,'currency':_0x1de342,'sortBy':_0x3cae5,'sortOrder':_0x10a7d8},_0x441c16=await this[_0x34fd09(0x24d)][_0x34fd09(0x226)](_0x586e77);_0xfe4143[_0x34fd09(0x21c)]({'success':!![],'payments':_0x441c16[_0x34fd09(0x22e)],'pagination':_0x441c16[_0x34fd09(0x234)]});}catch(_0x49b77f){_0x4bbc1e(_0x49b77f);}},this[_0x3a481f(0x20e)]=async(_0x6e76a6,_0x511f39,_0x5b2154)=>{const _0x9bcc80=_0x3a481f;try{const {id:_0x464058}=_0x6e76a6[_0x9bcc80(0x221)],_0x3ba13a=await this[_0x9bcc80(0x24d)][_0x9bcc80(0x20e)](_0x464058);if(!_0x3ba13a)return _0x511f39['status'](0x194)[_0x9bcc80(0x21c)]({'success':![],'message':_0x9bcc80(0x1f3)});_0x511f39[_0x9bcc80(0x21c)]({'success':!![],'result':_0x3ba13a});}catch(_0x56470f){_0x5b2154(_0x56470f);}},this[_0x3a481f(0x22d)]=async(_0x4a26c9,_0x45b20a,_0x556035)=>{const _0x37eaab=_0x3a481f;try{const {id:_0x30495c}=_0x4a26c9['params'],{status:_0xed2939,notes:_0x3b24a3,chargebackAmount:_0xa7e02f}=_0x4a26c9[_0x37eaab(0x202)],_0x1f2353=await this[_0x37eaab(0x24d)][_0x37eaab(0x20e)](_0x30495c);if(!_0x1f2353)return _0x45b20a[_0x37eaab(0x231)](0x194)[_0x37eaab(0x21c)]({'success':![],'message':_0x37eaab(0x1f3)});const _0x4065eb=await this['adminService'][_0x37eaab(0x1fc)](_0x30495c,_0xed2939,_0x3b24a3,_0xa7e02f);if(_0x1f2353[_0x37eaab(0x231)]!==_0xed2939&&_0xed2939[_0x37eaab(0x232)]()===_0x37eaab(0x1fe)){console['log'](_0x37eaab(0x24b)+_0x30495c+'\x20to\x20PAID,\x20updating\x20payment\x20link\x20counter');try{await this[_0x37eaab(0x211)]['handleSuccessfulPayment'](_0x30495c),console[_0x37eaab(0x24e)]('âœ…\x20Payment\x20link\x20counter\x20updated\x20for\x20payment\x20'+_0x30495c);}catch(_0x530add){console[_0x37eaab(0x213)](_0x37eaab(0x253),_0x530add);}}if(_0x1f2353['status']!==_0xed2939){console['log'](_0x37eaab(0x22a)+_0x30495c+_0x37eaab(0x24a)+_0x1f2353[_0x37eaab(0x231)]+_0x37eaab(0x225)+_0xed2939+',\x20sending\x20Telegram\x20notification');try{let _0x367ecc;switch(_0xed2939['toUpperCase']()){case _0x37eaab(0x1fe):_0x367ecc='paid';break;case _0x37eaab(0x246):_0x367ecc=_0x37eaab(0x251);break;case _0x37eaab(0x244):_0x367ecc=_0x37eaab(0x240);break;case'EXPIRED':_0x367ecc=_0x37eaab(0x23a);break;case'REFUND':_0x367ecc=_0x37eaab(0x241);break;case _0x37eaab(0x248):_0x367ecc=_0x37eaab(0x237);break;default:console['log'](_0x37eaab(0x23e)+_0xed2939);break;}if(_0x367ecc){const _0x432978={..._0x4065eb,'shopId':_0x1f2353[_0x37eaab(0x235)],'gateway':_0x1f2353[_0x37eaab(0x24f)],'createdAt':_0x1f2353[_0x37eaab(0x23c)],'chargebackAmount':_0xa7e02f};await telegramBotService_1['telegramBotService'][_0x37eaab(0x23b)](_0x1f2353['shopId'],_0x432978,_0x367ecc),console[_0x37eaab(0x24e)](_0x37eaab(0x21f)+_0x1f2353[_0x37eaab(0x231)]+_0x37eaab(0x230)+_0xed2939);}}catch(_0x37809d){console[_0x37eaab(0x213)](_0x37eaab(0x206),_0x37809d);}}_0x45b20a[_0x37eaab(0x21c)]({'success':!![],'message':_0x37eaab(0x217),'result':_0x4065eb});}catch(_0xa2c719){_0x556035(_0xa2c719);}},this[_0x3a481f(0x257)]=async(_0x28ec94,_0x128ba8,_0x3386c5)=>{const _0x470cc5=_0x3a481f;try{const {id:_0x7e06ac}=_0x28ec94['params'],_0x11c49a=_0x28ec94[_0x470cc5(0x202)];console[_0x470cc5(0x24e)]('ðŸ”„\x20Admin\x20updating\x20customer\x20data\x20for\x20payment\x20'+_0x7e06ac+':',_0x11c49a);const _0x1a84bd=await this[_0x470cc5(0x24d)][_0x470cc5(0x257)](_0x7e06ac,_0x11c49a);_0x128ba8[_0x470cc5(0x21c)]({'success':!![],'message':_0x470cc5(0x25a),'result':_0x1a84bd});}catch(_0x1e31f5){_0x3386c5(_0x1e31f5);}},this[_0x3a481f(0x242)]=async(_0x21c588,_0x157e36,_0x1dca2a)=>{const _0x1ebe98=_0x3a481f;try{const {id:_0x474d94}=_0x21c588['params'],_0xe4e1bd=_0x21c588[_0x1ebe98(0x202)],_0x6ec734=await this['adminService'][_0x1ebe98(0x242)](_0x474d94,_0xe4e1bd);_0x157e36[_0x1ebe98(0x21c)]({'success':!![],'message':_0x1ebe98(0x215),'result':_0x6ec734});}catch(_0x1e5cf1){_0x1dca2a(_0x1e5cf1);}},this[_0x3a481f(0x1ff)]=async(_0x5eaf81,_0x38b3c5,_0xec1ada)=>{const _0x41d01d=_0x3a481f;try{const {id:_0x37a7d8}=_0x5eaf81[_0x41d01d(0x221)],_0x5d7d93=await this['adminService'][_0x41d01d(0x1ff)](_0x37a7d8);_0x38b3c5[_0x41d01d(0x21c)]({'success':!![],'message':_0x41d01d(0x220),'result':_0x5d7d93});}catch(_0x4a73a6){_0xec1ada(_0x4a73a6);}},this[_0x3a481f(0x22b)]=async(_0xb51805,_0x1a660b,_0xfacf19)=>{const _0x2c1ae1=_0x3a481f;try{const {id:_0x58a7fc}=_0xb51805[_0x2c1ae1(0x221)],_0x4fd579=await this[_0x2c1ae1(0x24d)][_0x2c1ae1(0x22b)](_0x58a7fc);_0x1a660b['json']({'success':!![],'message':_0x2c1ae1(0x1f8),'result':_0x4fd579});}catch(_0x50d84e){_0xfacf19(_0x50d84e);}},this[_0x3a481f(0x219)]=async(_0x134ad0,_0x10df42,_0x4ebab0)=>{const _0xf96e11=_0x3a481f;try{const {page:page=0x1,limit:limit=0x14,status:_0x19d92e}=_0x134ad0['query'],_0x83fd88={'page':Number(page),'limit':Number(limit),'status':_0x19d92e},_0x55652b=await this['adminService'][_0xf96e11(0x238)](_0x83fd88);_0x10df42[_0xf96e11(0x21c)]({'success':!![],'users':_0x55652b[_0xf96e11(0x1f9)],'pagination':_0x55652b[_0xf96e11(0x234)]});}catch(_0x42c798){_0x4ebab0(_0x42c798);}},this[_0x3a481f(0x214)]=async(_0x293aca,_0x490592,_0x1f437a)=>{const _0x46e695=_0x3a481f;try{const {id:_0x26c9f0}=_0x293aca[_0x46e695(0x221)],_0x49f696=await this['adminService'][_0x46e695(0x214)](_0x26c9f0);if(!_0x49f696)return _0x490592[_0x46e695(0x231)](0x194)[_0x46e695(0x21c)]({'success':![],'message':_0x46e695(0x22c)});_0x490592[_0x46e695(0x21c)]({'success':!![],'result':_0x49f696});}catch(_0x5f044e){_0x1f437a(_0x5f044e);}},this['createUser']=async(_0x46184f,_0x2fb052,_0x256818)=>{const _0x30bb29=_0x3a481f;try{const _0x5057f1=_0x46184f['body'],_0x2d13c6=await this['adminService']['createUser'](_0x5057f1);_0x2fb052[_0x30bb29(0x231)](0xc9)[_0x30bb29(0x21c)]({'success':!![],'message':_0x30bb29(0x259),'result':_0x2d13c6});}catch(_0x56760c){_0x256818(_0x56760c);}},this[_0x3a481f(0x21d)]=async(_0x51399b,_0x5d2373,_0x5bfe9b)=>{const _0x385a0d=_0x3a481f;try{const {id:_0x137bb0}=_0x51399b[_0x385a0d(0x221)];await this[_0x385a0d(0x24d)][_0x385a0d(0x21d)](_0x137bb0),_0x5d2373[_0x385a0d(0x21c)]({'success':!![],'message':_0x385a0d(0x1f5)});}catch(_0x96546f){_0x5bfe9b(_0x96546f);}},this['getProcessingPaymentsStats']=async(_0x5f4b48,_0x1eeffc,_0x7c9718)=>{const _0x2786ab=_0x3a481f;try{const _0x155e6a=await paymentCleanupService_1[_0x2786ab(0x1f2)][_0x2786ab(0x1fb)]();_0x1eeffc[_0x2786ab(0x21c)]({'success':!![],'result':_0x155e6a});}catch(_0x2e93cd){_0x7c9718(_0x2e93cd);}},this[_0x3a481f(0x1f7)]=async(_0x11ce92,_0x53a64c,_0x4d8517)=>{const _0x15940d=_0x3a481f;try{console['log'](_0x15940d(0x1fa)+_0x11ce92[_0x15940d(0x20a)]?.[_0x15940d(0x204)]+'\x20('+_0x11ce92[_0x15940d(0x20a)]?.['id']+')');const _0x4a3022=await paymentCleanupService_1['paymentCleanupService'][_0x15940d(0x205)]();_0x53a64c[_0x15940d(0x21c)]({'success':!![],'message':_0x15940d(0x243),'result':{'processed':_0x4a3022[_0x15940d(0x212)],'failed':_0x4a3022['failed'],'errors':_0x4a3022[_0x15940d(0x233)]}});}catch(_0x3a7fb0){_0x4d8517(_0x3a7fb0);}},this[_0x3a481f(0x227)]=async(_0xea60c7,_0x282dfc,_0x2bb2dd)=>{const _0x1155b1=_0x3a481f;try{console[_0x1155b1(0x24e)](_0x1155b1(0x208)+_0xea60c7[_0x1155b1(0x20a)]?.[_0x1155b1(0x204)]+'\x20('+_0xea60c7[_0x1155b1(0x20a)]?.['id']+')');const _0x16a528=await paymentCleanupService_1[_0x1155b1(0x1f2)][_0x1155b1(0x1fb)](),_0x5c3086=await paymentCleanupService_1[_0x1155b1(0x1f2)][_0x1155b1(0x205)](),_0x20d37d=await paymentCleanupService_1[_0x1155b1(0x1f2)][_0x1155b1(0x1fb)]();_0x282dfc[_0x1155b1(0x21c)]({'success':!![],'message':_0x1155b1(0x24c),'result':{'cleanup':{'processed':_0x5c3086['processed'],'failed':_0x5c3086['failed'],'errors':_0x5c3086[_0x1155b1(0x233)]},'statistics':{'before':_0x16a528,'after':_0x20d37d,'reduced':_0x16a528[_0x1155b1(0x216)]-_0x20d37d[_0x1155b1(0x216)]}}});}catch(_0x53b082){_0x2bb2dd(_0x53b082);}},this[_0x3a481f(0x24d)]=new adminService_1[(_0x3a481f(0x1f4))](),this[_0x3a481f(0x211)]=new paymentLinkService_1[(_0x3a481f(0x258))]();}}exports[a3_0x324eb8(0x207)]=AdminController;function a3_0x5035(){const _0x5b7cb0=['ðŸ“Š\x20Admin\x20requesting\x20merchant\x20statistics\x20with\x20filters:','chargeback','getAllUsers','1225278bXVAHn','expired','sendPaymentNotification','createdAt','Admin\x20access\x20confirmed','ðŸ“±\x20Skipping\x20Telegram\x20notification\x20for\x20status\x20change\x20to:\x20','merchants','failed','refund','updateUser','Payment\x20cleanup\x20completed\x20successfully','FAILED','../services/paymentCleanupService','PROCESSING','3850200WlZWNT','CHARGEBACK','30d','\x20status\x20changed\x20from\x20','ðŸ“ˆ\x20Admin\x20changed\x20payment\x20','Payment\x20cleanup\x20with\x20report\x20completed\x20successfully','adminService','log','gateway','getMerchantStatistics','processing','3447670AmHujX','Failed\x20to\x20update\x20payment\x20link\x20counter:','4148124vwSTAo','../services/paymentLinkService','getMerchantsAwaitingPayout','updateCustomerData','PaymentLinkService','User\x20created\x20successfully','Customer\x20data\x20updated\x20successfully','paymentCleanupService','Payment\x20not\x20found','AdminService','User\x20deleted\x20successfully','deletePayout','cleanupStalePayments','User\x20activated\x20successfully','users','ðŸ§¹\x20Manual\x20payment\x20cleanup\x20initiated\x20by\x20admin:\x20','getProcessingPaymentsStats','updatePaymentStatus','2085849VGJDiA','PAID','suspendUser','getPayoutById','summary','body','createPayout','username','cleanupStaleProcessingPayments','Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20status\x20change:','AdminController','ðŸ“Š\x20Manual\x20payment\x20cleanup\x20with\x20report\x20initiated\x20by\x20admin:\x20','../services/adminService','user','getStatistics','checkAuth','getSystemStatistics','getPaymentById','getPayoutStats','1013987PtkQYu','paymentLinkService','processed','error','getUserById','User\x20updated\x20successfully','total','Payment\x20updated\x20successfully','Payout\x20not\x20found','getUsers','getPayouts','query','json','deleteUser','__esModule','âœ…\x20Telegram\x20notification\x20sent\x20for\x20status\x20change:\x20','User\x20suspended\x20successfully','params','getMerchantsSelection','427637uTALfg','getAllPayouts','\x20to\x20','getAllPayments','cleanupStalePaymentsWithReport','Payout\x20created\x20successfully','88ywSEbr','ðŸ“±\x20Payment\x20','activateUser','User\x20not\x20found','updatePayment','payments','Payout\x20deleted\x20successfully','\x20->\x20','status','toUpperCase','errors','pagination','shopId'];a3_0x5035=function(){return _0x5b7cb0;};return a3_0x5035();}