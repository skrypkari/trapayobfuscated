'use strict';const a4_0x29d040=a4_0x295a;(function(_0x5dc443,_0x5d1ec5){const _0x55780c=a4_0x295a,_0xb2e7e7=_0x5dc443();while(!![]){try{const _0x1af1aa=parseInt(_0x55780c(0xa7))/0x1+-parseInt(_0x55780c(0xc1))/0x2+parseInt(_0x55780c(0xaa))/0x3+-parseInt(_0x55780c(0xf1))/0x4*(-parseInt(_0x55780c(0x89))/0x5)+parseInt(_0x55780c(0x10f))/0x6*(parseInt(_0x55780c(0x8c))/0x7)+parseInt(_0x55780c(0xb6))/0x8*(-parseInt(_0x55780c(0x81))/0x9)+-parseInt(_0x55780c(0xbc))/0xa;if(_0x1af1aa===_0x5d1ec5)break;else _0xb2e7e7['push'](_0xb2e7e7['shift']());}catch(_0x5ce3b2){_0xb2e7e7['push'](_0xb2e7e7['shift']());}}}(a4_0x3852,0xe4eb1));var __createBinding=this&&this[a4_0x29d040(0x9e)]||(Object[a4_0x29d040(0x129)]?function(_0x47ac37,_0x5af4d8,_0x33ec62,_0x34a97f){const _0x5bd1c7=a4_0x29d040;if(_0x34a97f===undefined)_0x34a97f=_0x33ec62;var _0x1ab40f=Object[_0x5bd1c7(0x91)](_0x5af4d8,_0x33ec62);(!_0x1ab40f||(_0x5bd1c7(0x116)in _0x1ab40f?!_0x5af4d8[_0x5bd1c7(0x7f)]:_0x1ab40f[_0x5bd1c7(0x87)]||_0x1ab40f['configurable']))&&(_0x1ab40f={'enumerable':!![],'get':function(){return _0x5af4d8[_0x33ec62];}}),Object[_0x5bd1c7(0x111)](_0x47ac37,_0x34a97f,_0x1ab40f);}:function(_0x3d516a,_0x41f60a,_0x461a2b,_0x1e26e7){if(_0x1e26e7===undefined)_0x1e26e7=_0x461a2b;_0x3d516a[_0x1e26e7]=_0x41f60a[_0x461a2b];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a4_0x29d040(0x129)]?function(_0x26d197,_0xaeb7c1){const _0x4cc6ee=a4_0x29d040;Object[_0x4cc6ee(0x111)](_0x26d197,_0x4cc6ee(0xd6),{'enumerable':!![],'value':_0xaeb7c1});}:function(_0xfac0b5,_0x40c49c){const _0x37e2ba=a4_0x29d040;_0xfac0b5[_0x37e2ba(0xd6)]=_0x40c49c;}),__importStar=this&&this[a4_0x29d040(0x11c)]||(function(){var _0x1f22cc=function(_0x343d81){return _0x1f22cc=Object['getOwnPropertyNames']||function(_0x228fb){const _0x566b64=a4_0x295a;var _0x2c3907=[];for(var _0x43edd5 in _0x228fb)if(Object[_0x566b64(0xdd)]['hasOwnProperty'][_0x566b64(0x11a)](_0x228fb,_0x43edd5))_0x2c3907[_0x2c3907[_0x566b64(0xf6)]]=_0x43edd5;return _0x2c3907;},_0x1f22cc(_0x343d81);};return function(_0xfe164d){const _0x557adf=a4_0x295a;if(_0xfe164d&&_0xfe164d[_0x557adf(0x7f)])return _0xfe164d;var _0x3db783={};if(_0xfe164d!=null){for(var _0x564e5b=_0x1f22cc(_0xfe164d),_0x8a4d56=0x0;_0x8a4d56<_0x564e5b[_0x557adf(0xf6)];_0x8a4d56++)if(_0x564e5b[_0x8a4d56]!=='default')__createBinding(_0x3db783,_0xfe164d,_0x564e5b[_0x8a4d56]);}return __setModuleDefault(_0x3db783,_0xfe164d),_0x3db783;};}()),__importDefault=this&&this[a4_0x29d040(0x10e)]||function(_0x65bc0e){return _0x65bc0e&&_0x65bc0e['__esModule']?_0x65bc0e:{'default':_0x65bc0e};};Object[a4_0x29d040(0x111)](exports,a4_0x29d040(0x7f),{'value':!![]}),exports[a4_0x29d040(0x112)]=void 0x0;function a4_0x3852(){const _0x13b668=['disable2FA','suspendUser','length','shopId','getGatewaySettings','payments','getUsers','getMerchantStatistics','shopId\x20and\x20amount\x20are\x20required','Payout\x20created\x20successfully','Admin\x20access\x20confirmed','User\x20deleted\x20successfully','getPaymentById','PROCESSING','disableAdmin2FA','count','../services/gatewaySettingsService','\x22\x20and\x20status=\x22PAID\x22','getPayoutReports','\x20\x20\x20-\x20Total\x20Turnover:\x20','ðŸ§¹\x20Manual\x20PROCESSING\x20payment\x20cleanup\x20initiated\x20by\x20admin:\x20','Payout\x20deleted\x20successfully','â°\x20Manual\x20PENDING\x20payment\x20cleanup\x20initiated\x20by\x20admin:\x20','payouts','toUpperCase','createUser','__importDefault','4974KaCQtO','getMerchantsAwaitingPayout','defineProperty','AdminController','errors','gateway','ðŸ“±\x20Skipping\x20Telegram\x20notification\x20for\x20status\x20change\x20to:\x20','get','adminService','ðŸ’°\x20[GATEWAY\x20STATS]\x20Paid\x20payments\x20result:','resolve','call','cleanupStalePaymentsWithReport','__importStar','getLoginLogs','REFUND','toFixed','payment','getPayoutStats','cleanupStalePendingPayments','updatePayout','Balance\x20deposited\x20successfully','username','ðŸ“ˆ\x20[GATEWAY\x20STATS]\x20Calculated\x20statistics:','body','ðŸ“Š\x20[GATEWAY\x20STATS]\x20Requesting\x20statistics\x20for\x20gateway\x20ID:\x20','create','Payment\x20link\x20expiration\x20check\x20completed\x20successfully','ðŸ“Š\x20Admin\x20requesting\x20payout\x20reports:','expired','PAID','getAllPayouts','Payout\x20updated\x20successfully','__esModule','Payment\x20updated\x20successfully','90diFoWH','pagination','\x20\x20\x20-\x20Chargeback\x20Rate:\x20','failed','getAllGatewaysWithSettings','_all','writable','Gateway\x20settings\x20updated\x20successfully','695dYkUKq','getShopWallets','âœ…\x20Payment\x20link\x20counter\x20updated\x20for\x20payment\x20','8589melCFP','updateCustomerData','âŒ\x20[GATEWAY\x20STATS]\x20Error:','enable2FA','paymentCleanupService','getOwnPropertyDescriptor','PENDING\x20payment\x20cleanup\x20completed\x20successfully','findMany','âœ…\x20Telegram\x20notification\x20sent\x20for\x20status\x20change:\x20','role','cleanupStalePayments','getPayments','deletePayout','handleSuccessfulPayment','getAllPayments','amountUSDT','updateSettings','ðŸ“Š\x20Admin\x20requesting\x20merchant\x20statistics\x20with\x20filters:','__createBinding','merchants','Payout\x20not\x20found','Failed\x20to\x20update\x20payment\x20link\x20counter:','\x20\x20\x20-\x20Successful\x20Payments:\x20','ceil','getStatistics','setupAdmin2FA','log','1705212sRMogG','processed','paid','1416345LppmZp','getPayoutById','ðŸ”„\x20Admin\x20updating\x20customer\x20data\x20for\x20payment\x20','month','getAllUsers','ðŸ”\x20[GATEWAY\x20STATS]\x20Sample\x20payments\x20for\x20','get2FASettings','PaymentLinkService','PROCESSING\x20payment\x20cleanup\x20completed\x20successfully','gatewaySettingsService','ðŸ“±\x20Payment\x20','periodFrom,\x20periodTo,\x20and\x20gateway\x20are\x20required','1353592lzaIfn','getProcessingPaymentsStats','../services/paymentCleanupService','error','CHARGEBACK','sendPaymentNotification','9068350vWlkjM','cleanupStaleProcessingPayments','\x20->\x20Gateway\x20Name:\x20','Payment\x20not\x20found','chargeback','1030498eVnvcD','deleteUser','ðŸ“Š\x20Manual\x20payment\x20cleanup\x20(PROCESSING\x20+\x20PENDING)\x20with\x20report\x20initiated\x20by\x20admin:\x20','loginLog','getMerchantsSelection','EXPIRED','params','hasPayoutHistory','checkAuth','users','\x20with\x20data:','setup2FA','_sum','activateUser','User\x20suspended\x20successfully','_count','expirePaymentLinks','json','updateUser','User\x20updated\x20successfully','Payment\x20cleanup\x20(PROCESSING\x20+\x20PENDING)\x20with\x20report\x20completed\x20successfully','default','AdminService','getPayouts','statistics','getUserById','âŒ\x20[GATEWAY\x20STATS]\x20Gateway\x20not\x20found\x20for\x20ID:\x20','FAILED','prototype','Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20status\x20change:','user','stringify','Amount\x20must\x20be\x20greater\x20than\x200','Customer\x20data\x20updated\x20successfully','processing','desc','createPayout','depositBalance','updateGatewaySettings','ðŸ’¸\x20[GATEWAY\x20STATS]\x20Refund\x20count:\x20','then','telegramBotService','../services/paymentLinkService','changeAdminPassword','\x20\x20\x20-\x20Total\x20Commission:\x20','query','true','../types/gateway','24668qDtKaV','status','total'];a4_0x3852=function(){return _0x13b668;};return a4_0x3852();}const adminService_1=require('../services/adminService'),paymentLinkService_1=require(a4_0x29d040(0xeb)),paymentCleanupService_1=require(a4_0x29d040(0xb8)),telegramBotService_1=require('../services/telegramBotService'),gatewaySettingsService_1=require(a4_0x29d040(0x104)),database_1=__importDefault(require('../config/database'));function a4_0x295a(_0x326273,_0x57bc27){_0x326273=_0x326273-0x7e;const _0x3852d4=a4_0x3852();let _0x295ab7=_0x3852d4[_0x326273];return _0x295ab7;}class AdminController{constructor(){const _0x7ff6f8=a4_0x29d040;this[_0x7ff6f8(0xc9)]=async(_0x30d17f,_0x45f555,_0x3e2808)=>{const _0x33ea79=_0x7ff6f8;try{const _0x142438=_0x30d17f['user'];_0x45f555['json']({'success':!![],'message':_0x33ea79(0xfe),'user':{'id':_0x142438?.['id'],'username':_0x142438?.[_0x33ea79(0x125)],'role':_0x142438?.[_0x33ea79(0x95)]}});}catch(_0x41c370){_0x3e2808(_0x41c370);}},this[_0x7ff6f8(0xa4)]=async(_0x2bbb97,_0x371bcf,_0x13ab91)=>{const _0x1c2a21=_0x7ff6f8;try{const {period:period='30d',currentDate:_0x58b42a}=_0x2bbb97['query'],_0x2b56be=await this[_0x1c2a21(0x117)]['getSystemStatistics'](period,_0x58b42a);_0x371bcf[_0x1c2a21(0xd2)]({'success':!![],'result':_0x2b56be});}catch(_0x4b3e1c){_0x13ab91(_0x4b3e1c);}},this[_0x7ff6f8(0xfb)]=async(_0x10dfa0,_0x205b16,_0x20fcf1)=>{const _0x7f0eaf=_0x7ff6f8;try{const {shopId:_0xaa2d78,period:period=_0x7f0eaf(0xad),dateFrom:_0x1bb26a,dateTo:_0x408efa}=_0x10dfa0[_0x7f0eaf(0xee)],_0x25de70={'shopId':_0xaa2d78,'period':period,'dateFrom':_0x1bb26a,'dateTo':_0x408efa};console['log'](_0x7f0eaf(0x9d),_0x25de70);const _0x3ce2c6=await this[_0x7f0eaf(0x117)][_0x7f0eaf(0xfb)](_0x25de70);_0x205b16['json']({'success':!![],'result':_0x3ce2c6});}catch(_0x42be2c){_0x20fcf1(_0x42be2c);}},this[_0x7ff6f8(0x106)]=async(_0x2693a0,_0x368331,_0x278a54)=>{const _0x2e2308=_0x7ff6f8;try{const {periodFrom:_0xc53221,periodTo:_0x499360,gateway:_0x51d0c7}=_0x2693a0[_0x2e2308(0xee)];if(!_0xc53221||!_0x499360||!_0x51d0c7)return _0x368331[_0x2e2308(0xf2)](0x190)[_0x2e2308(0xd2)]({'success':![],'message':_0x2e2308(0xb5)});console[_0x2e2308(0xa6)](_0x2e2308(0x12b),{'periodFrom':_0xc53221,'periodTo':_0x499360,'gateway':_0x51d0c7});const _0x1ef1cb=await this[_0x2e2308(0x117)][_0x2e2308(0x106)]({'periodFrom':_0xc53221,'periodTo':_0x499360,'gateway':_0x51d0c7});_0x368331[_0x2e2308(0xd2)]({'success':!![],'reports':_0x1ef1cb});}catch(_0x3ed2df){_0x278a54(_0x3ed2df);}},this['getPayoutStats']=async(_0x36b1b7,_0x2f632c,_0x1c078b)=>{const _0x73a241=_0x7ff6f8;try{const _0xc2929c=await this[_0x73a241(0x117)][_0x73a241(0x121)]();_0x2f632c['json']({'success':!![],'result':_0xc2929c});}catch(_0x110ff2){_0x1c078b(_0x110ff2);}},this['getMerchantsAwaitingPayout']=async(_0x5debb1,_0x44b856,_0xf7b9e4)=>{const _0x1aaf0c=_0x7ff6f8;try{const {page:page=0x1,limit:limit=0x14,minAmount:_0x407554,search:_0x4aea3d}=_0x5debb1[_0x1aaf0c(0xee)],_0x2e8c45={'page':Number(page),'limit':Number(limit),'minAmount':_0x407554?Number(_0x407554):undefined,'search':_0x4aea3d},_0x4f05e8=await this['adminService'][_0x1aaf0c(0x110)](_0x2e8c45);_0x44b856[_0x1aaf0c(0xd2)]({'success':!![],'merchants':_0x4f05e8[_0x1aaf0c(0x9f)],'pagination':_0x4f05e8['pagination'],'summary':_0x4f05e8['summary']});}catch(_0x1dc479){_0xf7b9e4(_0x1dc479);}},this[_0x7ff6f8(0xc5)]=async(_0x2716f7,_0x1ee476,_0x346f4c)=>{const _0x2b3f7e=_0x7ff6f8;try{const _0x503026=_0x2716f7[_0x2b3f7e(0xee)][_0x2b3f7e(0xc8)]===_0x2b3f7e(0xef),_0x400de2=await this[_0x2b3f7e(0x117)]['getMerchantsSelection'](_0x503026);_0x1ee476[_0x2b3f7e(0xd2)]({'success':!![],'result':_0x400de2});}catch(_0x56a23f){_0x346f4c(_0x56a23f);}},this[_0x7ff6f8(0xe5)]=async(_0x509ef8,_0x5d3ac0,_0x33c988)=>{const _0x31ffb5=_0x7ff6f8;try{const _0x3dea3e=_0x509ef8['body'];console['log']('ðŸŽ¯\x20[CONTROLLER]\x20Creating\x20payout\x20with\x20data:',_0x3dea3e);const _0x1ecc5b=await this[_0x31ffb5(0x117)]['createPayout'](_0x3dea3e);_0x5d3ac0[_0x31ffb5(0xf2)](0xc9)[_0x31ffb5(0xd2)]({'success':!![],'message':_0x31ffb5(0xfd),'result':_0x1ecc5b});}catch(_0x21cbbf){_0x33c988(_0x21cbbf);}},this[_0x7ff6f8(0x123)]=async(_0x132030,_0x2ee676,_0x49a21b)=>{const _0x18dd91=_0x7ff6f8;try{const {id:_0x54c905}=_0x132030[_0x18dd91(0xc7)],_0x4daad5=_0x132030[_0x18dd91(0x127)];console[_0x18dd91(0xa6)]('ðŸŽ¯\x20[CONTROLLER]\x20Updating\x20payout\x20'+_0x54c905+_0x18dd91(0xcb),_0x4daad5);const _0x5c6e08=await this[_0x18dd91(0x117)][_0x18dd91(0x123)](_0x54c905,_0x4daad5);_0x2ee676[_0x18dd91(0xd2)]({'success':!![],'message':_0x18dd91(0x7e),'result':_0x5c6e08});}catch(_0xc4ccc7){_0x49a21b(_0xc4ccc7);}},this[_0x7ff6f8(0xd8)]=async(_0x20573f,_0x350ced,_0x46d37d)=>{const _0xec82f1=_0x7ff6f8;try{const {page:page=0x1,limit:limit=0x14,shopId:_0x20005a,network:_0x5b8bff,dateFrom:_0xdfdfe,dateTo:_0x30d187,search:_0x281a5d}=_0x20573f['query'],_0x443839={'page':Number(page),'limit':Number(limit),'shopId':_0x20005a,'network':_0x5b8bff,'dateFrom':_0xdfdfe,'dateTo':_0x30d187,'search':_0x281a5d},_0x4cfe09=await this[_0xec82f1(0x117)][_0xec82f1(0x12e)](_0x443839);_0x350ced[_0xec82f1(0xd2)]({'success':!![],'payouts':_0x4cfe09[_0xec82f1(0x10b)],'pagination':_0x4cfe09[_0xec82f1(0x82)]});}catch(_0x1b2ccf){_0x46d37d(_0x1b2ccf);}},this['getPayoutById']=async(_0x5c2785,_0x6dddd1,_0x3bddef)=>{const _0x25a61e=_0x7ff6f8;try{const {id:_0x814e9b}=_0x5c2785['params'],_0x2facc7=await this['adminService'][_0x25a61e(0xab)](_0x814e9b);if(!_0x2facc7)return _0x6dddd1['status'](0x194)['json']({'success':![],'message':_0x25a61e(0xa0)});_0x6dddd1[_0x25a61e(0xd2)]({'success':!![],'result':_0x2facc7});}catch(_0x32a916){_0x3bddef(_0x32a916);}},this[_0x7ff6f8(0x98)]=async(_0x4b4fcc,_0x32de12,_0x1a9c97)=>{const _0x1c6e2f=_0x7ff6f8;try{const {id:_0x53c45b}=_0x4b4fcc['params'];await this[_0x1c6e2f(0x117)]['deletePayout'](_0x53c45b),_0x32de12[_0x1c6e2f(0xd2)]({'success':!![],'message':_0x1c6e2f(0x109)});}catch(_0x3cc777){_0x1a9c97(_0x3cc777);}},this[_0x7ff6f8(0x97)]=async(_0x7fb212,_0x2c4c12,_0x4f52cf)=>{const _0x597e62=_0x7ff6f8;try{const {page:page=0x1,limit:limit=0x14,status:_0x285a5f,gateway:_0x1d3a83,shopId:_0x5eed63,dateFrom:_0x21798b,dateTo:_0x378e6d,search:_0x11d13e,currency:_0x19feb2,sortBy:_0x3eb4cd,sortOrder:_0x48fad5}=_0x7fb212[_0x597e62(0xee)],_0x565422={'page':Number(page),'limit':Number(limit),'status':_0x285a5f,'gateway':_0x1d3a83,'shopId':_0x5eed63,'dateFrom':_0x21798b,'dateTo':_0x378e6d,'search':_0x11d13e,'currency':_0x19feb2,'sortBy':_0x3eb4cd,'sortOrder':_0x48fad5},_0x17d592=await this[_0x597e62(0x117)][_0x597e62(0x9a)](_0x565422);_0x2c4c12[_0x597e62(0xd2)]({'success':!![],'payments':_0x17d592[_0x597e62(0xf9)],'pagination':_0x17d592[_0x597e62(0x82)],'statistics':_0x17d592[_0x597e62(0xd9)]});}catch(_0x39faf4){_0x4f52cf(_0x39faf4);}},this[_0x7ff6f8(0x100)]=async(_0x9b7a4e,_0x24eadc,_0x4bb862)=>{const _0x82d267=_0x7ff6f8;try{const {id:_0x264f3f}=_0x9b7a4e[_0x82d267(0xc7)],_0x12091e=await this[_0x82d267(0x117)][_0x82d267(0x100)](_0x264f3f);if(!_0x12091e)return _0x24eadc['status'](0x194)[_0x82d267(0xd2)]({'success':![],'message':'Payment\x20not\x20found'});_0x24eadc[_0x82d267(0xd2)]({'success':!![],'result':_0x12091e});}catch(_0x46d1bb){_0x4bb862(_0x46d1bb);}},this['updatePayment']=async(_0x534094,_0xcfc999,_0x4ad81d)=>{const _0x3996d5=_0x7ff6f8;try{const {id:_0x27897d}=_0x534094['params'],{status:_0xc3d5a1,notes:_0x2920f1,chargebackAmount:_0x59fc2e}=_0x534094[_0x3996d5(0x127)],_0x29ae6e=await this[_0x3996d5(0x117)][_0x3996d5(0x100)](_0x27897d);if(!_0x29ae6e)return _0xcfc999[_0x3996d5(0xf2)](0x194)[_0x3996d5(0xd2)]({'success':![],'message':_0x3996d5(0xbf)});const _0x3b415e=await this[_0x3996d5(0x117)]['updatePaymentStatus'](_0x27897d,_0xc3d5a1,_0x2920f1,_0x59fc2e);if(_0x29ae6e[_0x3996d5(0xf2)]!==_0xc3d5a1&&_0xc3d5a1[_0x3996d5(0x10c)]()===_0x3996d5(0x12d)){console[_0x3996d5(0xa6)]('ðŸ“ˆ\x20Admin\x20changed\x20payment\x20'+_0x27897d+'\x20to\x20PAID,\x20updating\x20payment\x20link\x20counter');try{await this['paymentLinkService'][_0x3996d5(0x99)](_0x27897d),console['log'](_0x3996d5(0x8b)+_0x27897d);}catch(_0x464625){console[_0x3996d5(0xb9)](_0x3996d5(0xa1),_0x464625);}}if(_0x29ae6e[_0x3996d5(0xf2)]!==_0xc3d5a1){console[_0x3996d5(0xa6)](_0x3996d5(0xb4)+_0x27897d+'\x20status\x20changed\x20from\x20'+_0x29ae6e['status']+'\x20to\x20'+_0xc3d5a1+',\x20sending\x20Telegram\x20notification');try{let _0x3fe3d5;switch(_0xc3d5a1[_0x3996d5(0x10c)]()){case'PAID':_0x3fe3d5=_0x3996d5(0xa9);break;case _0x3996d5(0x101):_0x3fe3d5=_0x3996d5(0xe3);break;case _0x3996d5(0xdc):_0x3fe3d5='failed';break;case _0x3996d5(0xc6):_0x3fe3d5=_0x3996d5(0x12c);break;case _0x3996d5(0x11e):_0x3fe3d5='refund';break;case _0x3996d5(0xba):_0x3fe3d5=_0x3996d5(0xc0);break;default:console[_0x3996d5(0xa6)](_0x3996d5(0x115)+_0xc3d5a1);break;}if(_0x3fe3d5){const _0x17d207={..._0x3b415e,'shopId':_0x29ae6e[_0x3996d5(0xf7)],'gateway':_0x29ae6e[_0x3996d5(0x114)],'createdAt':_0x29ae6e['createdAt'],'chargebackAmount':_0x59fc2e};await telegramBotService_1[_0x3996d5(0xea)][_0x3996d5(0xbb)](_0x29ae6e['shopId'],_0x17d207,_0x3fe3d5),console[_0x3996d5(0xa6)](_0x3996d5(0x94)+_0x29ae6e[_0x3996d5(0xf2)]+'\x20->\x20'+_0xc3d5a1);}}catch(_0xbff766){console[_0x3996d5(0xb9)](_0x3996d5(0xde),_0xbff766);}}_0xcfc999[_0x3996d5(0xd2)]({'success':!![],'message':_0x3996d5(0x80),'result':_0x3b415e});}catch(_0x2b0454){_0x4ad81d(_0x2b0454);}},this[_0x7ff6f8(0x8d)]=async(_0x2c3713,_0x4d66a1,_0x49888a)=>{const _0x382d12=_0x7ff6f8;try{const {id:_0x341a0c}=_0x2c3713['params'],_0x34f54b=_0x2c3713[_0x382d12(0x127)];console[_0x382d12(0xa6)](_0x382d12(0xac)+_0x341a0c+':',_0x34f54b);const _0x4f9fa6=await this[_0x382d12(0x117)]['updateCustomerData'](_0x341a0c,_0x34f54b);_0x4d66a1['json']({'success':!![],'message':_0x382d12(0xe2),'result':_0x4f9fa6});}catch(_0x3d61c3){_0x49888a(_0x3d61c3);}},this['updateUser']=async(_0x2c3268,_0x33330a,_0x59c601)=>{const _0x4ba730=_0x7ff6f8;try{const {id:_0x4ee008}=_0x2c3268['params'],_0x38278d=_0x2c3268[_0x4ba730(0x127)],_0x258cfc=await this['adminService'][_0x4ba730(0xd3)](_0x4ee008,_0x38278d);_0x33330a[_0x4ba730(0xd2)]({'success':!![],'message':_0x4ba730(0xd4),'result':_0x258cfc});}catch(_0xff6ac1){_0x59c601(_0xff6ac1);}},this[_0x7ff6f8(0xf5)]=async(_0x236d6c,_0x909f4c,_0x2f3b43)=>{const _0x3e207d=_0x7ff6f8;try{const {id:_0x4fc09a}=_0x236d6c[_0x3e207d(0xc7)],_0x24d8a6=await this['adminService']['suspendUser'](_0x4fc09a);_0x909f4c[_0x3e207d(0xd2)]({'success':!![],'message':_0x3e207d(0xcf),'result':_0x24d8a6});}catch(_0x23cc66){_0x2f3b43(_0x23cc66);}},this[_0x7ff6f8(0xce)]=async(_0x682ed9,_0x5f5519,_0x19e983)=>{const _0x51186e=_0x7ff6f8;try{const {id:_0x2a2797}=_0x682ed9[_0x51186e(0xc7)],_0x32c2b3=await this[_0x51186e(0x117)][_0x51186e(0xce)](_0x2a2797);_0x5f5519['json']({'success':!![],'message':'User\x20activated\x20successfully','result':_0x32c2b3});}catch(_0x5affc8){_0x19e983(_0x5affc8);}},this[_0x7ff6f8(0xfa)]=async(_0x549d5c,_0x2a4619,_0x100400)=>{const _0x2c0fd0=_0x7ff6f8;try{const {page:page=0x1,limit:limit=0x14,status:_0x4b9d4b,search:_0x24be17}=_0x549d5c[_0x2c0fd0(0xee)],_0x185d46={'page':Number(page),'limit':Number(limit),'status':_0x4b9d4b,'search':_0x24be17},_0x3e5800=await this[_0x2c0fd0(0x117)][_0x2c0fd0(0xae)](_0x185d46);_0x2a4619[_0x2c0fd0(0xd2)]({'success':!![],'users':_0x3e5800[_0x2c0fd0(0xca)],'pagination':_0x3e5800['pagination']});}catch(_0x10d7b6){_0x100400(_0x10d7b6);}},this['getUserById']=async(_0x43d18b,_0x4b9a29,_0x3f5ad0)=>{const _0x566bdf=_0x7ff6f8;try{const {id:_0x49ea7a}=_0x43d18b[_0x566bdf(0xc7)],_0x315e82=await this['adminService'][_0x566bdf(0xda)](_0x49ea7a);if(!_0x315e82)return _0x4b9a29[_0x566bdf(0xf2)](0x194)['json']({'success':![],'message':'User\x20not\x20found'});_0x4b9a29[_0x566bdf(0xd2)]({'success':!![],'result':_0x315e82});}catch(_0x2806b1){_0x3f5ad0(_0x2806b1);}},this[_0x7ff6f8(0x10d)]=async(_0x308c60,_0x3dbacd,_0x1460ae)=>{const _0x4d9224=_0x7ff6f8;try{const _0x23d901=_0x308c60[_0x4d9224(0x127)],_0x18933e=await this[_0x4d9224(0x117)][_0x4d9224(0x10d)](_0x23d901);_0x3dbacd[_0x4d9224(0xf2)](0xc9)['json']({'success':!![],'message':'User\x20created\x20successfully','result':_0x18933e});}catch(_0x361756){_0x1460ae(_0x361756);}},this['deleteUser']=async(_0x3541a9,_0x5dfee5,_0x68258e)=>{const _0x3e1aa0=_0x7ff6f8;try{const {id:_0x5cd019}=_0x3541a9[_0x3e1aa0(0xc7)],{twoFactorToken:_0xe47353}=_0x3541a9[_0x3e1aa0(0x127)];await this[_0x3e1aa0(0x117)][_0x3e1aa0(0xc2)](_0x5cd019,_0xe47353),_0x5dfee5[_0x3e1aa0(0xd2)]({'success':!![],'message':_0x3e1aa0(0xff)});}catch(_0xffdc17){_0x68258e(_0xffdc17);}},this[_0x7ff6f8(0x8a)]=async(_0x3859a8,_0x3c0758,_0x8a753d)=>{const _0x251f4e=_0x7ff6f8;try{const {shopId:_0x503597}=_0x3859a8[_0x251f4e(0xc7)],_0x2c965a=await this['adminService'][_0x251f4e(0x8a)](_0x503597);_0x3c0758[_0x251f4e(0xd2)]({'success':!![],'wallets':_0x2c965a});}catch(_0x367bb8){_0x8a753d(_0x367bb8);}},this[_0x7ff6f8(0xcc)]=async(_0x5df9c9,_0x24ecb8,_0x4b9f21)=>{const _0x6024bc=_0x7ff6f8;try{const {shopId:_0x108c43}=_0x5df9c9[_0x6024bc(0xc7)],_0x1af18b=await this[_0x6024bc(0x117)][_0x6024bc(0xcc)](_0x108c43);_0x24ecb8[_0x6024bc(0xd2)]({'success':!![],'result':_0x1af18b});}catch(_0x4448c1){_0x4b9f21(_0x4448c1);}},this[_0x7ff6f8(0x8f)]=async(_0x5299a5,_0x5dba7e,_0x7fdc8)=>{const _0x3e5e64=_0x7ff6f8;try{const {shopId:_0x42203e}=_0x5299a5[_0x3e5e64(0xc7)],{token:_0x2a6168}=_0x5299a5[_0x3e5e64(0x127)];if(!_0x2a6168)return _0x5dba7e[_0x3e5e64(0xf2)](0x190)[_0x3e5e64(0xd2)]({'success':![],'message':'Token\x20is\x20required'});const _0x402010=await this[_0x3e5e64(0x117)][_0x3e5e64(0x8f)](_0x42203e,_0x2a6168);_0x5dba7e['json']({'success':!![],'message':'2FA\x20enabled\x20successfully','result':_0x402010});}catch(_0x3f3e02){_0x7fdc8(_0x3f3e02);}},this[_0x7ff6f8(0xf4)]=async(_0x4f4af2,_0x94062f,_0x1de6c6)=>{const _0x188b05=_0x7ff6f8;try{const {shopId:_0x3c5364}=_0x4f4af2[_0x188b05(0xc7)];await this[_0x188b05(0x117)][_0x188b05(0xf4)](_0x3c5364),_0x94062f['json']({'success':!![],'message':'2FA\x20disabled\x20successfully'});}catch(_0x53583c){_0x1de6c6(_0x53583c);}},this[_0x7ff6f8(0xb7)]=async(_0x335b37,_0x31d3a4,_0x4459a8)=>{const _0x5c89ae=_0x7ff6f8;try{const _0x2164eb=await paymentCleanupService_1[_0x5c89ae(0x90)]['getProcessingPaymentsStats']();_0x31d3a4[_0x5c89ae(0xd2)]({'success':!![],'result':_0x2164eb});}catch(_0xd2f408){_0x4459a8(_0xd2f408);}},this[_0x7ff6f8(0x96)]=async(_0x10b939,_0x3fa7b0,_0x125ddd)=>{const _0x2825a4=_0x7ff6f8;try{console[_0x2825a4(0xa6)](_0x2825a4(0x108)+_0x10b939[_0x2825a4(0xdf)]?.[_0x2825a4(0x125)]+'\x20('+_0x10b939[_0x2825a4(0xdf)]?.['id']+')');const _0x2f2f00=await paymentCleanupService_1['paymentCleanupService'][_0x2825a4(0xbd)]();_0x3fa7b0[_0x2825a4(0xd2)]({'success':!![],'message':_0x2825a4(0xb2),'result':{'processed':_0x2f2f00[_0x2825a4(0xa8)],'failed':_0x2f2f00[_0x2825a4(0x84)],'errors':_0x2f2f00[_0x2825a4(0x113)]}});}catch(_0x800fa2){_0x125ddd(_0x800fa2);}},this[_0x7ff6f8(0x122)]=async(_0x4d8907,_0x46f75c,_0xa0cff3)=>{const _0x5aa373=_0x7ff6f8;try{console['log'](_0x5aa373(0x10a)+_0x4d8907[_0x5aa373(0xdf)]?.['username']+'\x20('+_0x4d8907[_0x5aa373(0xdf)]?.['id']+')');const _0x58a237=await paymentCleanupService_1[_0x5aa373(0x90)][_0x5aa373(0x122)]();_0x46f75c[_0x5aa373(0xd2)]({'success':!![],'message':_0x5aa373(0x92),'result':{'processed':_0x58a237[_0x5aa373(0xa8)],'failed':_0x58a237[_0x5aa373(0x84)],'errors':_0x58a237[_0x5aa373(0x113)]}});}catch(_0x396c2b){_0xa0cff3(_0x396c2b);}},this[_0x7ff6f8(0x11b)]=async(_0x1a8d96,_0x148715,_0x428848)=>{const _0x9918a=_0x7ff6f8;try{console[_0x9918a(0xa6)](_0x9918a(0xc3)+_0x1a8d96[_0x9918a(0xdf)]?.['username']+'\x20('+_0x1a8d96['user']?.['id']+')');const _0x4b214d=await paymentCleanupService_1[_0x9918a(0x90)]['getProcessingPaymentsStats'](),_0x5751f4=await paymentCleanupService_1[_0x9918a(0x90)][_0x9918a(0xbd)](),_0x18a2df=await paymentCleanupService_1[_0x9918a(0x90)][_0x9918a(0x122)](),_0x28849e=await paymentCleanupService_1[_0x9918a(0x90)][_0x9918a(0xb7)]();_0x148715[_0x9918a(0xd2)]({'success':!![],'message':_0x9918a(0xd5),'result':{'cleanup':{'processing':{'processed':_0x5751f4['processed'],'failed':_0x5751f4[_0x9918a(0x84)],'errors':_0x5751f4[_0x9918a(0x113)]},'pending':{'processed':_0x18a2df[_0x9918a(0xa8)],'failed':_0x18a2df[_0x9918a(0x84)],'errors':_0x18a2df['errors']},'total':{'processed':_0x5751f4[_0x9918a(0xa8)]+_0x18a2df[_0x9918a(0xa8)],'failed':_0x5751f4['failed']+_0x18a2df['failed'],'errors':[..._0x5751f4[_0x9918a(0x113)],..._0x18a2df[_0x9918a(0x113)]]}},'statistics':{'before':_0x4b214d,'after':_0x28849e,'reduced':_0x4b214d[_0x9918a(0xf3)]-_0x28849e[_0x9918a(0xf3)]}}});}catch(_0x1fac36){_0x428848(_0x1fac36);}},this[_0x7ff6f8(0xd1)]=async(_0x1b8590,_0x1ec08e,_0x64ea69)=>{const _0x4352ef=_0x7ff6f8;try{const _0x3a77e1=await paymentCleanupService_1[_0x4352ef(0x90)]['expireSinglePaymentLinks']();_0x1ec08e[_0x4352ef(0xd2)]({'success':!![],'message':_0x4352ef(0x12a),'result':{'expired':_0x3a77e1[_0x4352ef(0x12c)],'errors':_0x3a77e1[_0x4352ef(0x113)]}});}catch(_0x497a12){_0x64ea69(_0x497a12);}},this[_0x7ff6f8(0xec)]=async(_0x19568b,_0x5d9fa9,_0x1865af)=>{const _0x1e09c1=_0x7ff6f8;try{const {currentPassword:_0x37c928,newPassword:_0xf1ba21,confirmNewPassword:_0x4f9751,twoFactorToken:_0x67c828}=_0x19568b[_0x1e09c1(0x127)];await this[_0x1e09c1(0x117)][_0x1e09c1(0xec)](_0x37c928,_0xf1ba21,_0x4f9751,_0x67c828),_0x5d9fa9[_0x1e09c1(0xd2)]({'success':!![],'message':'Admin\x20password\x20changed\x20successfully'});}catch(_0x853944){_0x1865af(_0x853944);}},this[_0x7ff6f8(0xb0)]=async(_0x25234a,_0x3458e3,_0x2d27a9)=>{const _0x297ec7=_0x7ff6f8;try{const _0x5c5774=await this[_0x297ec7(0x117)][_0x297ec7(0xb0)]();_0x3458e3[_0x297ec7(0xd2)]({'success':!![],'result':_0x5c5774});}catch(_0x2d9cc6){_0x2d27a9(_0x2d9cc6);}},this[_0x7ff6f8(0xa5)]=async(_0x180592,_0x14562a,_0x4ee0ed)=>{const _0x5e3f46=_0x7ff6f8;try{const _0x480f89=await this['adminService'][_0x5e3f46(0xa5)]();_0x14562a[_0x5e3f46(0xd2)]({'success':!![],'result':_0x480f89});}catch(_0x41c659){_0x4ee0ed(_0x41c659);}},this['enableAdmin2FA']=async(_0x3221d3,_0x1423d2,_0x882710)=>{const _0x17e127=_0x7ff6f8;try{const {token:_0x554c7e}=_0x3221d3[_0x17e127(0x127)],_0x4ec434=await this[_0x17e127(0x117)]['enableAdmin2FA'](_0x554c7e);_0x1423d2[_0x17e127(0xd2)]({'success':!![],'result':_0x4ec434});}catch(_0x12b27d){_0x882710(_0x12b27d);}},this[_0x7ff6f8(0x102)]=async(_0x1c16cb,_0x49c3b0,_0x51d0cb)=>{const _0x41ca7f=_0x7ff6f8;try{await this[_0x41ca7f(0x117)][_0x41ca7f(0x102)](),_0x49c3b0['json']({'success':!![],'message':'Admin\x202FA\x20disabled\x20successfully'});}catch(_0x479ae0){_0x51d0cb(_0x479ae0);}},this['depositBalance']=async(_0x33782a,_0x5e1a61,_0x2203da)=>{const _0x1088c6=_0x7ff6f8;try{const {shopId:_0x3c60dd,amount:_0xe4405f,notes:_0x47694e}=_0x33782a[_0x1088c6(0x127)];if(!_0x3c60dd||!_0xe4405f)return _0x5e1a61['status'](0x190)['json']({'success':![],'message':_0x1088c6(0xfc)});if(_0xe4405f<=0x0)return _0x5e1a61['status'](0x190)[_0x1088c6(0xd2)]({'success':![],'message':_0x1088c6(0xe1)});await this[_0x1088c6(0x117)][_0x1088c6(0xe6)](_0x3c60dd,_0xe4405f,_0x47694e),_0x5e1a61['json']({'success':!![],'message':_0x1088c6(0x124)});}catch(_0x2b60af){_0x2203da(_0x2b60af);}},this[_0x7ff6f8(0x11d)]=async(_0x2fceb5,_0x1de778,_0x3c055f)=>{const _0x2d6f7c=_0x7ff6f8;try{const {shopId:_0x13514a}=_0x2fceb5[_0x2d6f7c(0xc7)],{page:page='1',limit:limit='20'}=_0x2fceb5[_0x2d6f7c(0xee)],_0x1a58a3=(await Promise[_0x2d6f7c(0x119)]()[_0x2d6f7c(0xe9)](()=>__importStar(require('../config/database'))))[_0x2d6f7c(0xd6)],_0x5cd989=parseInt(page,0xa),_0x7919=parseInt(limit,0xa),_0x431b4e=(_0x5cd989-0x1)*_0x7919,[_0x5319c1,_0x195053]=await Promise['all']([_0x1a58a3[_0x2d6f7c(0xc4)]['findMany']({'where':{'shopId':_0x13514a},'orderBy':{'createdAt':_0x2d6f7c(0xe4)},'skip':_0x431b4e,'take':_0x7919}),_0x1a58a3[_0x2d6f7c(0xc4)][_0x2d6f7c(0x103)]({'where':{'shopId':_0x13514a}})]);_0x1de778[_0x2d6f7c(0xd2)]({'success':!![],'result':{'logs':_0x5319c1,'pagination':{'page':_0x5cd989,'limit':_0x7919,'total':_0x195053,'totalPages':Math[_0x2d6f7c(0xa3)](_0x195053/_0x7919)}}});}catch(_0xbeb983){_0x3c055f(_0xbeb983);}},this[_0x7ff6f8(0xf8)]=async(_0x1d7b33,_0xd8b2d7,_0x8b2dba)=>{const _0x12dc0e=_0x7ff6f8;try{const _0x304fb5=gatewaySettingsService_1['gatewaySettingsService'][_0x12dc0e(0x85)]();_0xd8b2d7[_0x12dc0e(0xd2)]({'success':!![],'result':_0x304fb5});}catch(_0x4b80ce){_0x8b2dba(_0x4b80ce);}},this[_0x7ff6f8(0xe7)]=async(_0x230094,_0x23554b,_0x2cdbc7)=>{const _0x35509f=_0x7ff6f8;try{const {gatewayId:_0x25966f}=_0x230094[_0x35509f(0xc7)],{minAmount:_0x1d1744,maxAmount:_0x1d28d6,payoutDelay:_0x3f1a47,gatewayCommission:_0x3ee633}=_0x230094['body'],_0x34aef6=gatewaySettingsService_1[_0x35509f(0xb3)][_0x35509f(0x9c)](_0x25966f,{'minAmount':_0x1d1744!==undefined?Number(_0x1d1744):undefined,'maxAmount':_0x1d28d6!==undefined?Number(_0x1d28d6):undefined,'payoutDelay':_0x3f1a47!==undefined?Number(_0x3f1a47):undefined,'gatewayCommission':_0x3ee633!==undefined?Number(_0x3ee633):undefined});_0x23554b[_0x35509f(0xd2)]({'success':!![],'message':_0x35509f(0x88),'result':_0x34aef6});}catch(_0x53c084){_0x2cdbc7(_0x53c084);}},this['getGatewayStatistics']=async(_0x3b57ab,_0x430be6,_0x31cf86)=>{const _0x298aec=_0x7ff6f8;try{const {gatewayId:_0x518b97}=_0x3b57ab[_0x298aec(0xc7)];console[_0x298aec(0xa6)](_0x298aec(0x128)+_0x518b97);const {GATEWAY_ID_MAP:_0x1a12e6}=await Promise['resolve']()[_0x298aec(0xe9)](()=>__importStar(require(_0x298aec(0xf0)))),_0x4fc19e=_0x1a12e6[_0x518b97];console[_0x298aec(0xa6)]('ðŸ“Š\x20[GATEWAY\x20STATS]\x20Gateway\x20ID\x20'+_0x518b97+_0x298aec(0xbe)+_0x4fc19e);if(!_0x4fc19e)return console[_0x298aec(0xa6)](_0x298aec(0xdb)+_0x518b97),_0x430be6[_0x298aec(0xf2)](0x194)['json']({'success':![],'message':'Gateway\x20not\x20found'});console[_0x298aec(0xa6)]('ðŸ”\x20[GATEWAY\x20STATS]\x20Querying\x20payments\x20with\x20gateway=\x22'+_0x4fc19e+_0x298aec(0x105));const _0x10aa78=await database_1[_0x298aec(0xd6)][_0x298aec(0x120)][_0x298aec(0x93)]({'where':{'gateway':_0x4fc19e},'select':{'id':!![],'status':!![],'amountUSDT':!![]},'take':0x5});console['log'](_0x298aec(0xaf)+_0x4fc19e+':',JSON[_0x298aec(0xe0)](_0x10aa78,null,0x2));const _0x473654=await database_1['default'][_0x298aec(0x120)]['aggregate']({'where':{'gateway':_0x4fc19e,'status':_0x298aec(0x12d)},'_sum':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]},'_count':{'_all':!![]}});console[_0x298aec(0xa6)](_0x298aec(0x118),JSON['stringify'](_0x473654,null,0x2));const _0x2afaa3=await database_1['default'][_0x298aec(0x120)]['count']({'where':{'gateway':_0x4fc19e,'status':'CHARGEBACK'}});console[_0x298aec(0xa6)]('ðŸ”™\x20[GATEWAY\x20STATS]\x20Chargeback\x20count:\x20'+_0x2afaa3);const _0x510435=await database_1['default']['payment']['count']({'where':{'gateway':_0x4fc19e,'status':_0x298aec(0x11e)}});console[_0x298aec(0xa6)](_0x298aec(0xe8)+_0x510435);const _0x3e7988=_0x473654[_0x298aec(0xcd)]['amountUSDT']||0x0,_0x211622=(_0x473654[_0x298aec(0xcd)][_0x298aec(0x9b)]||0x0)-(_0x473654[_0x298aec(0xcd)]['amountAfterGatewayCommissionUSDT']||0x0),_0x31065b=_0x473654[_0x298aec(0xd0)][_0x298aec(0x86)],_0x164dc6=_0x31065b>0x0?_0x2afaa3/_0x31065b*0x64:0x0;console[_0x298aec(0xa6)](_0x298aec(0x126)),console[_0x298aec(0xa6)](_0x298aec(0x107)+_0x3e7988),console['log'](_0x298aec(0xed)+_0x211622),console[_0x298aec(0xa6)](_0x298aec(0xa2)+_0x31065b),console[_0x298aec(0xa6)](_0x298aec(0x83)+_0x164dc6+'%'),_0x430be6['json']({'success':!![],'result':{'gatewayId':_0x518b97,'totalTurnover':Number(_0x3e7988['toFixed'](0x2)),'totalCommission':Number(_0x211622[_0x298aec(0x11f)](0x2)),'successfulPayments':_0x31065b,'chargebackCount':_0x2afaa3,'chargebackRate':Number(_0x164dc6[_0x298aec(0x11f)](0x2)),'refundCount':_0x510435}});}catch(_0x3187c6){console[_0x298aec(0xb9)](_0x298aec(0x8e),_0x3187c6),_0x31cf86(_0x3187c6);}},this[_0x7ff6f8(0x117)]=new adminService_1[(_0x7ff6f8(0xd7))](),this['paymentLinkService']=new paymentLinkService_1[(_0x7ff6f8(0xb1))]();}}exports[a4_0x29d040(0x112)]=AdminController;