'use strict';const a3_0x3a883b=a3_0x4f16;function a3_0x2aa3(){const _0x564816=['chargeback','CHARGEBACK','\x20to\x20PAID,\x20updating\x20payment\x20link\x20counter','User\x20not\x20found','ðŸ“±\x20Payment\x20','Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20status\x20change:','refund','telegramBotService','suspendUser','4699656RqMNpE','defineProperty','938667OlswFb','processing','getSystemStatistics','createPayout','Payout\x20deleted\x20successfully','ðŸ“±\x20Skipping\x20Telegram\x20notification\x20for\x20status\x20change\x20to:\x20','updateCustomerData','getAllPayouts','195vVEVzn','4999288sIPxxJ','getPayoutById','âœ…\x20Payment\x20link\x20counter\x20updated\x20for\x20payment\x20','getAllUsers','FAILED','PaymentLinkService','getAllPayments','âœ…\x20Telegram\x20notification\x20sent\x20for\x20status\x20change:\x20','Payment\x20updated\x20successfully','updatePayment','toUpperCase','User\x20created\x20successfully','failed','../services/telegramBotService','pagination','Payment\x20not\x20found','18FTvPGU','Failed\x20to\x20update\x20payment\x20link\x20counter:','json','AdminController','user','getUsers','getPaymentById','4786030DnASVZ','users','240164zPMYeY','updateUser','paymentLinkService','\x20->\x20','getPayments','shopId','Payout\x20not\x20found','payments','body','Payout\x20created\x20successfully','\x20status\x20changed\x20from\x20','getPayouts','3MzbzKP','User\x20deleted\x20successfully','getMerchantStatistics','createUser','getUserById','sendPaymentNotification','error','month','role','deletePayout','getMerchantsAwaitingPayout','3762BHDAGm','log','paid','../services/adminService','PROCESSING','../services/paymentLinkService','REFUND','payouts','30d','__esModule','2910400lNMdJv','getPayoutStats','deleteUser','ðŸ“ˆ\x20Admin\x20changed\x20payment\x20','activateUser','adminService','query','status','params','PAID'];a3_0x2aa3=function(){return _0x564816;};return a3_0x2aa3();}(function(_0x78340b,_0x3d203b){const _0x1cda27=a3_0x4f16,_0x381145=_0x78340b();while(!![]){try{const _0x1ff195=parseInt(_0x1cda27(0x173))/0x1+parseInt(_0x1cda27(0x13d))/0x2*(-parseInt(_0x1cda27(0x149))/0x3)+parseInt(_0x1cda27(0x15e))/0x4+parseInt(_0x1cda27(0x123))/0x5*(parseInt(_0x1cda27(0x154))/0x6)+-parseInt(_0x1cda27(0x124))/0x7+parseInt(_0x1cda27(0x171))/0x8+parseInt(_0x1cda27(0x134))/0x9*(-parseInt(_0x1cda27(0x13b))/0xa);if(_0x1ff195===_0x3d203b)break;else _0x381145['push'](_0x381145['shift']());}catch(_0x231377){_0x381145['push'](_0x381145['shift']());}}}(a3_0x2aa3,0x76d31));function a3_0x4f16(_0x1dbf2c,_0x4957d3){const _0x2aa340=a3_0x2aa3();return a3_0x4f16=function(_0x4f1649,_0x3e8386){_0x4f1649=_0x4f1649-0x122;let _0x348110=_0x2aa340[_0x4f1649];return _0x348110;},a3_0x4f16(_0x1dbf2c,_0x4957d3);}Object[a3_0x3a883b(0x172)](exports,a3_0x3a883b(0x15d),{'value':!![]}),exports['AdminController']=void 0x0;const adminService_1=require(a3_0x3a883b(0x157)),paymentLinkService_1=require(a3_0x3a883b(0x159)),telegramBotService_1=require(a3_0x3a883b(0x131));class AdminController{constructor(){const _0x21572f=a3_0x3a883b;this['checkAuth']=async(_0x2b1a38,_0x19ec1e,_0x45210a)=>{const _0x27daa4=a3_0x4f16;try{const _0x1d1313=_0x2b1a38[_0x27daa4(0x138)];_0x19ec1e['json']({'success':!![],'message':'Admin\x20access\x20confirmed','user':{'id':_0x1d1313?.['id'],'username':_0x1d1313?.['username'],'role':_0x1d1313?.[_0x27daa4(0x151)]}});}catch(_0x35a6ae){_0x45210a(_0x35a6ae);}},this['getStatistics']=async(_0xb30e03,_0x38791a,_0x59d0c8)=>{const _0x50c4f0=a3_0x4f16;try{const {period:period=_0x50c4f0(0x15c)}=_0xb30e03['query'],_0x191cd4=await this[_0x50c4f0(0x163)][_0x50c4f0(0x175)](period);_0x38791a[_0x50c4f0(0x136)]({'success':!![],'result':_0x191cd4});}catch(_0x3f1fb6){_0x59d0c8(_0x3f1fb6);}},this[_0x21572f(0x14b)]=async(_0x29eba2,_0x33473c,_0x38595e)=>{const _0x55eadf=_0x21572f;try{const {shopId:_0x43878a,period:period=_0x55eadf(0x150),dateFrom:_0xa8865,dateTo:_0x1306ff}=_0x29eba2['query'],_0x3efbe3={'shopId':_0x43878a,'period':period,'dateFrom':_0xa8865,'dateTo':_0x1306ff};console['log']('ðŸ“Š\x20Admin\x20requesting\x20merchant\x20statistics\x20with\x20filters:',_0x3efbe3);const _0x5c8d62=await this[_0x55eadf(0x163)][_0x55eadf(0x14b)](_0x3efbe3);_0x33473c[_0x55eadf(0x136)]({'success':!![],'result':_0x5c8d62});}catch(_0x40c1f7){_0x38595e(_0x40c1f7);}},this[_0x21572f(0x15f)]=async(_0x24b30f,_0x5d0aa0,_0x215cdc)=>{const _0x2c7152=_0x21572f;try{const _0x552ab9=await this['adminService']['getPayoutStats']();_0x5d0aa0[_0x2c7152(0x136)]({'success':!![],'result':_0x552ab9});}catch(_0x559add){_0x215cdc(_0x559add);}},this[_0x21572f(0x153)]=async(_0x5cb0c5,_0x1ceaa9,_0x27bc5f)=>{const _0x4cf840=_0x21572f;try{const {page:page=0x1,limit:limit=0x14,minAmount:_0x473081,search:_0x33c6d6}=_0x5cb0c5[_0x4cf840(0x164)],_0x5c26fc={'page':Number(page),'limit':Number(limit),'minAmount':_0x473081?Number(_0x473081):undefined,'search':_0x33c6d6},_0x1b2976=await this[_0x4cf840(0x163)][_0x4cf840(0x153)](_0x5c26fc);_0x1ceaa9[_0x4cf840(0x136)]({'success':!![],'merchants':_0x1b2976['merchants'],'pagination':_0x1b2976[_0x4cf840(0x132)],'summary':_0x1b2976['summary']});}catch(_0x19b6b3){_0x27bc5f(_0x19b6b3);}},this[_0x21572f(0x176)]=async(_0x3e759d,_0x235e70,_0x310a18)=>{const _0x53bb75=_0x21572f;try{const _0x16b328=_0x3e759d[_0x53bb75(0x145)],_0x4f76af=await this[_0x53bb75(0x163)]['createPayout'](_0x16b328);_0x235e70['status'](0xc9)[_0x53bb75(0x136)]({'success':!![],'message':_0x53bb75(0x146),'result':_0x4f76af});}catch(_0x8fce8){_0x310a18(_0x8fce8);}},this[_0x21572f(0x148)]=async(_0x26955b,_0x4a0efb,_0x380f1d)=>{const _0x37cabe=_0x21572f;try{const {page:page=0x1,limit:limit=0x14,shopId:_0x585618,network:_0x3bd085,dateFrom:_0xc140e4,dateTo:_0x78fd27,search:_0x3033a6}=_0x26955b[_0x37cabe(0x164)],_0x141bb2={'page':Number(page),'limit':Number(limit),'shopId':_0x585618,'network':_0x3bd085,'dateFrom':_0xc140e4,'dateTo':_0x78fd27,'search':_0x3033a6},_0x559b06=await this[_0x37cabe(0x163)][_0x37cabe(0x122)](_0x141bb2);_0x4a0efb[_0x37cabe(0x136)]({'success':!![],'payouts':_0x559b06[_0x37cabe(0x15b)],'pagination':_0x559b06[_0x37cabe(0x132)]});}catch(_0x4cf5d4){_0x380f1d(_0x4cf5d4);}},this[_0x21572f(0x125)]=async(_0x5573a5,_0x306ee9,_0x401c83)=>{const _0x5ead81=_0x21572f;try{const {id:_0x5a1274}=_0x5573a5['params'],_0x896565=await this['adminService'][_0x5ead81(0x125)](_0x5a1274);if(!_0x896565)return _0x306ee9[_0x5ead81(0x165)](0x194)['json']({'success':![],'message':_0x5ead81(0x143)});_0x306ee9[_0x5ead81(0x136)]({'success':!![],'result':_0x896565});}catch(_0x8e9f92){_0x401c83(_0x8e9f92);}},this['deletePayout']=async(_0xf6074,_0x4ad9c1,_0x6c3004)=>{const _0x3b4370=_0x21572f;try{const {id:_0x62f91b}=_0xf6074[_0x3b4370(0x166)];await this[_0x3b4370(0x163)][_0x3b4370(0x152)](_0x62f91b),_0x4ad9c1[_0x3b4370(0x136)]({'success':!![],'message':_0x3b4370(0x177)});}catch(_0xdf2ff7){_0x6c3004(_0xdf2ff7);}},this[_0x21572f(0x141)]=async(_0x9db6dc,_0x5a5ffa,_0x41fd53)=>{const _0x341284=_0x21572f;try{const {page:page=0x1,limit:limit=0x14,status:_0x29f6c8,gateway:_0x1511ac,shopId:_0x494d95,dateFrom:_0x189023,dateTo:_0x2876e7,search:_0x5699a3}=_0x9db6dc['query'],_0x13e73e={'page':Number(page),'limit':Number(limit),'status':_0x29f6c8,'gateway':_0x1511ac,'shopId':_0x494d95,'dateFrom':_0x189023,'dateTo':_0x2876e7,'search':_0x5699a3},_0x513880=await this[_0x341284(0x163)][_0x341284(0x12a)](_0x13e73e);_0x5a5ffa[_0x341284(0x136)]({'success':!![],'payments':_0x513880[_0x341284(0x144)],'pagination':_0x513880['pagination']});}catch(_0x3b95cd){_0x41fd53(_0x3b95cd);}},this[_0x21572f(0x13a)]=async(_0x145aa8,_0x3e268d,_0x2eec1b)=>{const _0x4106c9=_0x21572f;try{const {id:_0x2fc604}=_0x145aa8['params'],_0x105783=await this['adminService'][_0x4106c9(0x13a)](_0x2fc604);if(!_0x105783)return _0x3e268d[_0x4106c9(0x165)](0x194)[_0x4106c9(0x136)]({'success':![],'message':'Payment\x20not\x20found'});_0x3e268d[_0x4106c9(0x136)]({'success':!![],'result':_0x105783});}catch(_0x14f46c){_0x2eec1b(_0x14f46c);}},this[_0x21572f(0x12d)]=async(_0x4a42a0,_0x24f451,_0x3ddb88)=>{const _0x40b287=_0x21572f;try{const {id:_0x37ffc5}=_0x4a42a0[_0x40b287(0x166)],{status:_0x992f15,notes:_0x52ae64,chargebackAmount:_0x238f04}=_0x4a42a0['body'],_0x3026c7=await this[_0x40b287(0x163)]['getPaymentById'](_0x37ffc5);if(!_0x3026c7)return _0x24f451['status'](0x194)[_0x40b287(0x136)]({'success':![],'message':_0x40b287(0x133)});const _0xc7b08b=await this[_0x40b287(0x163)]['updatePaymentStatus'](_0x37ffc5,_0x992f15,_0x52ae64,_0x238f04);if(_0x3026c7[_0x40b287(0x165)]!==_0x992f15&&_0x992f15[_0x40b287(0x12e)]()===_0x40b287(0x167)){console[_0x40b287(0x155)](_0x40b287(0x161)+_0x37ffc5+_0x40b287(0x16a));try{await this[_0x40b287(0x13f)]['handleSuccessfulPayment'](_0x37ffc5),console['log'](_0x40b287(0x126)+_0x37ffc5);}catch(_0x3acebe){console[_0x40b287(0x14f)](_0x40b287(0x135),_0x3acebe);}}if(_0x3026c7['status']!==_0x992f15){console[_0x40b287(0x155)](_0x40b287(0x16c)+_0x37ffc5+_0x40b287(0x147)+_0x3026c7[_0x40b287(0x165)]+'\x20to\x20'+_0x992f15+',\x20sending\x20Telegram\x20notification');try{let _0x3ac9f7;switch(_0x992f15['toUpperCase']()){case'PAID':_0x3ac9f7=_0x40b287(0x156);break;case _0x40b287(0x158):_0x3ac9f7=_0x40b287(0x174);break;case _0x40b287(0x128):_0x3ac9f7=_0x40b287(0x130);break;case'EXPIRED':_0x3ac9f7='expired';break;case _0x40b287(0x15a):_0x3ac9f7=_0x40b287(0x16e);break;case _0x40b287(0x169):_0x3ac9f7=_0x40b287(0x168);break;default:console[_0x40b287(0x155)](_0x40b287(0x178)+_0x992f15);break;}if(_0x3ac9f7){const _0x1e153c={..._0xc7b08b,'shopId':_0x3026c7[_0x40b287(0x142)],'gateway':_0x3026c7['gateway'],'createdAt':_0x3026c7['createdAt'],'chargebackAmount':_0x238f04};await telegramBotService_1[_0x40b287(0x16f)][_0x40b287(0x14e)](_0x3026c7['shopId'],_0x1e153c,_0x3ac9f7),console['log'](_0x40b287(0x12b)+_0x3026c7['status']+_0x40b287(0x140)+_0x992f15);}}catch(_0x33efb5){console[_0x40b287(0x14f)](_0x40b287(0x16d),_0x33efb5);}}_0x24f451[_0x40b287(0x136)]({'success':!![],'message':_0x40b287(0x12c),'result':_0xc7b08b});}catch(_0x3274d5){_0x3ddb88(_0x3274d5);}},this['updateCustomerData']=async(_0x1bfa8d,_0x3c5aa2,_0x26857b)=>{const _0x4e27d7=_0x21572f;try{const {id:_0x1260aa}=_0x1bfa8d[_0x4e27d7(0x166)],_0x53043c=_0x1bfa8d[_0x4e27d7(0x145)];console[_0x4e27d7(0x155)]('ðŸ”„\x20Admin\x20updating\x20customer\x20data\x20for\x20payment\x20'+_0x1260aa+':',_0x53043c);const _0x32d63c=await this[_0x4e27d7(0x163)][_0x4e27d7(0x179)](_0x1260aa,_0x53043c);_0x3c5aa2[_0x4e27d7(0x136)]({'success':!![],'message':'Customer\x20data\x20updated\x20successfully','result':_0x32d63c});}catch(_0x48ee46){_0x26857b(_0x48ee46);}},this[_0x21572f(0x13e)]=async(_0x32e897,_0x580c8b,_0x107ab9)=>{const _0x54ace5=_0x21572f;try{const {id:_0x1059d2}=_0x32e897[_0x54ace5(0x166)],_0x310c2d=_0x32e897['body'],_0x3e3e2b=await this[_0x54ace5(0x163)]['updateUser'](_0x1059d2,_0x310c2d);_0x580c8b['json']({'success':!![],'message':'User\x20updated\x20successfully','result':_0x3e3e2b});}catch(_0x184702){_0x107ab9(_0x184702);}},this['suspendUser']=async(_0x4d67d3,_0x3fe0a0,_0x1ba58f)=>{const _0x2b5cd5=_0x21572f;try{const {id:_0x33d515}=_0x4d67d3[_0x2b5cd5(0x166)],_0x5e430a=await this['adminService'][_0x2b5cd5(0x170)](_0x33d515);_0x3fe0a0['json']({'success':!![],'message':'User\x20suspended\x20successfully','result':_0x5e430a});}catch(_0x567b9f){_0x1ba58f(_0x567b9f);}},this['activateUser']=async(_0x3f93f4,_0x2e2666,_0x5349d2)=>{const _0x226bd3=_0x21572f;try{const {id:_0x27ab9b}=_0x3f93f4[_0x226bd3(0x166)],_0x3e41f3=await this['adminService'][_0x226bd3(0x162)](_0x27ab9b);_0x2e2666['json']({'success':!![],'message':'User\x20activated\x20successfully','result':_0x3e41f3});}catch(_0x22b884){_0x5349d2(_0x22b884);}},this[_0x21572f(0x139)]=async(_0x4a3109,_0x202abd,_0x316969)=>{const _0x20b6e3=_0x21572f;try{const {page:page=0x1,limit:limit=0x14,status:_0x457abf}=_0x4a3109[_0x20b6e3(0x164)],_0x16a292={'page':Number(page),'limit':Number(limit),'status':_0x457abf},_0x20fac8=await this[_0x20b6e3(0x163)][_0x20b6e3(0x127)](_0x16a292);_0x202abd[_0x20b6e3(0x136)]({'success':!![],'users':_0x20fac8[_0x20b6e3(0x13c)],'pagination':_0x20fac8[_0x20b6e3(0x132)]});}catch(_0x158bf9){_0x316969(_0x158bf9);}},this[_0x21572f(0x14d)]=async(_0x26f425,_0xc20bb4,_0x250941)=>{const _0x2016a9=_0x21572f;try{const {id:_0x4520d8}=_0x26f425[_0x2016a9(0x166)],_0x39dc47=await this[_0x2016a9(0x163)][_0x2016a9(0x14d)](_0x4520d8);if(!_0x39dc47)return _0xc20bb4[_0x2016a9(0x165)](0x194)['json']({'success':![],'message':_0x2016a9(0x16b)});_0xc20bb4['json']({'success':!![],'result':_0x39dc47});}catch(_0x52b371){_0x250941(_0x52b371);}},this[_0x21572f(0x14c)]=async(_0x198f56,_0x92d734,_0xcd4014)=>{const _0x2e04e0=_0x21572f;try{const _0x4e9ee2=_0x198f56['body'],_0x2a1e9e=await this['adminService'][_0x2e04e0(0x14c)](_0x4e9ee2);_0x92d734[_0x2e04e0(0x165)](0xc9)[_0x2e04e0(0x136)]({'success':!![],'message':_0x2e04e0(0x12f),'result':_0x2a1e9e});}catch(_0x298202){_0xcd4014(_0x298202);}},this[_0x21572f(0x160)]=async(_0x42d29d,_0x8318df,_0x12b855)=>{const _0x1c7536=_0x21572f;try{const {id:_0x2c58c7}=_0x42d29d['params'];await this[_0x1c7536(0x163)]['deleteUser'](_0x2c58c7),_0x8318df[_0x1c7536(0x136)]({'success':!![],'message':_0x1c7536(0x14a)});}catch(_0x70ff25){_0x12b855(_0x70ff25);}},this[_0x21572f(0x163)]=new adminService_1['AdminService'](),this[_0x21572f(0x13f)]=new paymentLinkService_1[(_0x21572f(0x129))]();}}exports[a3_0x3a883b(0x137)]=AdminController;