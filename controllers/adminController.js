'use strict';const a3_0x48ce6c=a3_0x5912;function a3_0x4bd5(){const _0x4e0526=['failed','updateCustomerData','378682mZYmzG','ðŸ“ˆ\x20Admin\x20changed\x20payment\x20','shopId','5339305LyCdhV','Payment\x20not\x20found','toUpperCase','getUsers','Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20status\x20change:','\x20status\x20changed\x20from\x20','body','getSystemStatistics','getPayouts','payouts','PaymentLinkService',',\x20sending\x20Telegram\x20notification','PROCESSING','createdAt','855501qmUhrF','createUser','expired','âœ…\x20Telegram\x20notification\x20sent\x20for\x20status\x20change:\x20','User\x20created\x20successfully','handleSuccessfulPayment','getAllUsers','Customer\x20data\x20updated\x20successfully','ðŸ”„\x20Admin\x20updating\x20customer\x20data\x20for\x20payment\x20','30d','3524224iPPxPN','8MIxESV','deleteUser','refund','AdminController','deletePayout','error','855211QRYNGU','2xnHtAJ','\x20->\x20','suspendUser','chargeback','EXPIRED','merchants','createPayout','getPaymentById','getPayments','âœ…\x20Payment\x20link\x20counter\x20updated\x20for\x20payment\x20','19919120OxsAPS','params','defineProperty','log','summary','pagination','User\x20activated\x20successfully','../services/paymentLinkService','ðŸ“±\x20Payment\x20','user','../services/adminService','updatePaymentStatus','status','gateway','getMerchantsSelection','json','username','activateUser','getPayoutStats','getStatistics','updateUser','getUserById','REFUND','9piIvoA','processing','Payout\x20created\x20successfully','month','paymentLinkService','getPayoutById','PAID','adminService','\x20to\x20','6997434SsYdZC','getAllPayments','__esModule','getAllPayouts','AdminService','User\x20deleted\x20successfully','query','User\x20suspended\x20successfully','CHARGEBACK'];a3_0x4bd5=function(){return _0x4e0526;};return a3_0x4bd5();}function a3_0x5912(_0x817d12,_0x37c93e){const _0x4bd566=a3_0x4bd5();return a3_0x5912=function(_0x5912dc,_0x25b0c7){_0x5912dc=_0x5912dc-0x78;let _0xdfa581=_0x4bd566[_0x5912dc];return _0xdfa581;},a3_0x5912(_0x817d12,_0x37c93e);}(function(_0x48811f,_0x31882e){const _0x3f7c45=a3_0x5912,_0x5b92a0=_0x48811f();while(!![]){try{const _0x2d4989=parseInt(_0x3f7c45(0xc3))/0x1*(parseInt(_0x3f7c45(0xa0))/0x2)+-parseInt(_0x3f7c45(0xb1))/0x3+parseInt(_0x3f7c45(0xbb))/0x4+-parseInt(_0x3f7c45(0xa3))/0x5+-parseInt(_0x3f7c45(0x95))/0x6+parseInt(_0x3f7c45(0xc2))/0x7*(parseInt(_0x3f7c45(0xbc))/0x8)+-parseInt(_0x3f7c45(0x8c))/0x9*(-parseInt(_0x3f7c45(0xcd))/0xa);if(_0x2d4989===_0x31882e)break;else _0x5b92a0['push'](_0x5b92a0['shift']());}catch(_0x4b96eb){_0x5b92a0['push'](_0x5b92a0['shift']());}}}(a3_0x4bd5,0xd0a1c));Object[a3_0x48ce6c(0xcf)](exports,a3_0x48ce6c(0x97),{'value':!![]}),exports[a3_0x48ce6c(0xbf)]=void 0x0;const adminService_1=require(a3_0x48ce6c(0x7f)),paymentLinkService_1=require(a3_0x48ce6c(0x7c)),telegramBotService_1=require('../services/telegramBotService');class AdminController{constructor(){const _0x3b307d=a3_0x48ce6c;this['checkAuth']=async(_0x35658a,_0x4fc348,_0x5b22fa)=>{const _0x3d0d4d=a3_0x5912;try{const _0x1b94f0=_0x35658a[_0x3d0d4d(0x7e)];_0x4fc348['json']({'success':!![],'message':'Admin\x20access\x20confirmed','user':{'id':_0x1b94f0?.['id'],'username':_0x1b94f0?.[_0x3d0d4d(0x85)],'role':_0x1b94f0?.['role']}});}catch(_0x8a3f86){_0x5b22fa(_0x8a3f86);}},this[_0x3b307d(0x88)]=async(_0xbc759d,_0x359c42,_0x59a367)=>{const _0x9cbc7c=_0x3b307d;try{const {period:period=_0x9cbc7c(0xba)}=_0xbc759d[_0x9cbc7c(0x9b)],_0x26ab9f=await this['adminService'][_0x9cbc7c(0xaa)](period);_0x359c42['json']({'success':!![],'result':_0x26ab9f});}catch(_0x5719a7){_0x59a367(_0x5719a7);}},this['getMerchantStatistics']=async(_0x23b270,_0x3a8ba8,_0x64c72e)=>{const _0x1fd4aa=_0x3b307d;try{const {shopId:_0x50722f,period:period=_0x1fd4aa(0x8f),dateFrom:_0x2983d8,dateTo:_0x139098}=_0x23b270['query'],_0x1f14c5={'shopId':_0x50722f,'period':period,'dateFrom':_0x2983d8,'dateTo':_0x139098};console[_0x1fd4aa(0x78)]('ðŸ“Š\x20Admin\x20requesting\x20merchant\x20statistics\x20with\x20filters:',_0x1f14c5);const _0x13b315=await this['adminService']['getMerchantStatistics'](_0x1f14c5);_0x3a8ba8['json']({'success':!![],'result':_0x13b315});}catch(_0x2ba033){_0x64c72e(_0x2ba033);}},this[_0x3b307d(0x87)]=async(_0x58fc8d,_0x5c8cb9,_0x5c6ce2)=>{const _0x4bf0f2=_0x3b307d;try{const _0xf25a32=await this['adminService'][_0x4bf0f2(0x87)]();_0x5c8cb9[_0x4bf0f2(0x84)]({'success':!![],'result':_0xf25a32});}catch(_0x386755){_0x5c6ce2(_0x386755);}},this['getMerchantsAwaitingPayout']=async(_0x3ea7dd,_0x7320ca,_0x1d0a8d)=>{const _0x16595a=_0x3b307d;try{const {page:page=0x1,limit:limit=0x14,minAmount:_0xf22cf4,search:_0x408adf}=_0x3ea7dd[_0x16595a(0x9b)],_0x596bc5={'page':Number(page),'limit':Number(limit),'minAmount':_0xf22cf4?Number(_0xf22cf4):undefined,'search':_0x408adf},_0x29d7e6=await this[_0x16595a(0x93)]['getMerchantsAwaitingPayout'](_0x596bc5);_0x7320ca['json']({'success':!![],'merchants':_0x29d7e6[_0x16595a(0xc8)],'pagination':_0x29d7e6[_0x16595a(0x7a)],'summary':_0x29d7e6[_0x16595a(0x79)]});}catch(_0x336edd){_0x1d0a8d(_0x336edd);}},this[_0x3b307d(0x83)]=async(_0x53fcc1,_0x44669c,_0xddf004)=>{const _0x21c9c0=_0x3b307d;try{const _0x1445ba=await this['adminService'][_0x21c9c0(0x83)]();_0x44669c['json']({'success':!![],'result':_0x1445ba});}catch(_0x56d42d){_0xddf004(_0x56d42d);}},this['createPayout']=async(_0x436977,_0x1b5ab5,_0x42c4a8)=>{const _0x2b8832=_0x3b307d;try{const _0x1c59c2=_0x436977[_0x2b8832(0xa9)],_0x318787=await this[_0x2b8832(0x93)][_0x2b8832(0xc9)](_0x1c59c2);_0x1b5ab5[_0x2b8832(0x81)](0xc9)['json']({'success':!![],'message':_0x2b8832(0x8e),'result':_0x318787});}catch(_0xf94e25){_0x42c4a8(_0xf94e25);}},this[_0x3b307d(0xab)]=async(_0x82765a,_0x49a990,_0x287b79)=>{const _0x47014a=_0x3b307d;try{const {page:page=0x1,limit:limit=0x14,shopId:_0x5b8c40,network:_0x4eb976,dateFrom:_0x1c82e2,dateTo:_0x325bc6,search:_0x1d4836}=_0x82765a[_0x47014a(0x9b)],_0x4266b9={'page':Number(page),'limit':Number(limit),'shopId':_0x5b8c40,'network':_0x4eb976,'dateFrom':_0x1c82e2,'dateTo':_0x325bc6,'search':_0x1d4836},_0x26cde2=await this['adminService'][_0x47014a(0x98)](_0x4266b9);_0x49a990['json']({'success':!![],'payouts':_0x26cde2[_0x47014a(0xac)],'pagination':_0x26cde2['pagination']});}catch(_0x3750ba){_0x287b79(_0x3750ba);}},this[_0x3b307d(0x91)]=async(_0x34bd8b,_0x56e80e,_0x2af2d2)=>{const _0x46feb3=_0x3b307d;try{const {id:_0x3df677}=_0x34bd8b[_0x46feb3(0xce)],_0x3e37bb=await this[_0x46feb3(0x93)][_0x46feb3(0x91)](_0x3df677);if(!_0x3e37bb)return _0x56e80e[_0x46feb3(0x81)](0x194)[_0x46feb3(0x84)]({'success':![],'message':'Payout\x20not\x20found'});_0x56e80e['json']({'success':!![],'result':_0x3e37bb});}catch(_0x1c15a7){_0x2af2d2(_0x1c15a7);}},this[_0x3b307d(0xc0)]=async(_0x463415,_0x599c10,_0x11d42a)=>{const _0x18396b=_0x3b307d;try{const {id:_0x21853c}=_0x463415[_0x18396b(0xce)];await this[_0x18396b(0x93)]['deletePayout'](_0x21853c),_0x599c10[_0x18396b(0x84)]({'success':!![],'message':'Payout\x20deleted\x20successfully'});}catch(_0x1152b4){_0x11d42a(_0x1152b4);}},this[_0x3b307d(0xcb)]=async(_0x50b7c6,_0x42827a,_0x30f42c)=>{const _0x184cb4=_0x3b307d;try{const {page:page=0x1,limit:limit=0x14,status:_0x5b27a1,gateway:_0x29dce8,shopId:_0x501e5d,dateFrom:_0x210998,dateTo:_0x1f64ec,search:_0xe3cd5f,currency:_0x1262e3,sortBy:_0x186c8c,sortOrder:_0x1568cb}=_0x50b7c6['query'],_0x391595={'page':Number(page),'limit':Number(limit),'status':_0x5b27a1,'gateway':_0x29dce8,'shopId':_0x501e5d,'dateFrom':_0x210998,'dateTo':_0x1f64ec,'search':_0xe3cd5f,'currency':_0x1262e3,'sortBy':_0x186c8c,'sortOrder':_0x1568cb},_0x168ce0=await this[_0x184cb4(0x93)][_0x184cb4(0x96)](_0x391595);_0x42827a[_0x184cb4(0x84)]({'success':!![],'payments':_0x168ce0['payments'],'pagination':_0x168ce0[_0x184cb4(0x7a)]});}catch(_0x219d14){_0x30f42c(_0x219d14);}},this[_0x3b307d(0xca)]=async(_0x546d17,_0x1aeaba,_0x9bb64b)=>{const _0x5e6a92=_0x3b307d;try{const {id:_0x36a273}=_0x546d17[_0x5e6a92(0xce)],_0x482fe4=await this[_0x5e6a92(0x93)][_0x5e6a92(0xca)](_0x36a273);if(!_0x482fe4)return _0x1aeaba[_0x5e6a92(0x81)](0x194)[_0x5e6a92(0x84)]({'success':![],'message':_0x5e6a92(0xa4)});_0x1aeaba[_0x5e6a92(0x84)]({'success':!![],'result':_0x482fe4});}catch(_0x2e34b3){_0x9bb64b(_0x2e34b3);}},this['updatePayment']=async(_0x44f25e,_0x5d48a8,_0x5ed2e1)=>{const _0x470e6e=_0x3b307d;try{const {id:_0xd2b13}=_0x44f25e['params'],{status:_0x3aaab8,notes:_0x157d3d,chargebackAmount:_0x329d30}=_0x44f25e['body'],_0x157c02=await this[_0x470e6e(0x93)][_0x470e6e(0xca)](_0xd2b13);if(!_0x157c02)return _0x5d48a8[_0x470e6e(0x81)](0x194)[_0x470e6e(0x84)]({'success':![],'message':_0x470e6e(0xa4)});const _0x2af13e=await this[_0x470e6e(0x93)][_0x470e6e(0x80)](_0xd2b13,_0x3aaab8,_0x157d3d,_0x329d30);if(_0x157c02[_0x470e6e(0x81)]!==_0x3aaab8&&_0x3aaab8[_0x470e6e(0xa5)]()===_0x470e6e(0x92)){console[_0x470e6e(0x78)](_0x470e6e(0xa1)+_0xd2b13+'\x20to\x20PAID,\x20updating\x20payment\x20link\x20counter');try{await this['paymentLinkService'][_0x470e6e(0xb6)](_0xd2b13),console[_0x470e6e(0x78)](_0x470e6e(0xcc)+_0xd2b13);}catch(_0xffca96){console[_0x470e6e(0xc1)]('Failed\x20to\x20update\x20payment\x20link\x20counter:',_0xffca96);}}if(_0x157c02['status']!==_0x3aaab8){console[_0x470e6e(0x78)](_0x470e6e(0x7d)+_0xd2b13+_0x470e6e(0xa8)+_0x157c02['status']+_0x470e6e(0x94)+_0x3aaab8+_0x470e6e(0xae));try{let _0x394d51;switch(_0x3aaab8[_0x470e6e(0xa5)]()){case _0x470e6e(0x92):_0x394d51='paid';break;case _0x470e6e(0xaf):_0x394d51=_0x470e6e(0x8d);break;case'FAILED':_0x394d51=_0x470e6e(0x9e);break;case _0x470e6e(0xc7):_0x394d51=_0x470e6e(0xb3);break;case _0x470e6e(0x8b):_0x394d51=_0x470e6e(0xbe);break;case _0x470e6e(0x9d):_0x394d51=_0x470e6e(0xc6);break;default:console[_0x470e6e(0x78)]('ðŸ“±\x20Skipping\x20Telegram\x20notification\x20for\x20status\x20change\x20to:\x20'+_0x3aaab8);break;}if(_0x394d51){const _0x39a1cf={..._0x2af13e,'shopId':_0x157c02[_0x470e6e(0xa2)],'gateway':_0x157c02[_0x470e6e(0x82)],'createdAt':_0x157c02[_0x470e6e(0xb0)],'chargebackAmount':_0x329d30};await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x157c02['shopId'],_0x39a1cf,_0x394d51),console[_0x470e6e(0x78)](_0x470e6e(0xb4)+_0x157c02[_0x470e6e(0x81)]+_0x470e6e(0xc4)+_0x3aaab8);}}catch(_0x59eb77){console[_0x470e6e(0xc1)](_0x470e6e(0xa7),_0x59eb77);}}_0x5d48a8[_0x470e6e(0x84)]({'success':!![],'message':'Payment\x20updated\x20successfully','result':_0x2af13e});}catch(_0x12c76f){_0x5ed2e1(_0x12c76f);}},this[_0x3b307d(0x9f)]=async(_0x2dd813,_0x1f2586,_0x4b05d1)=>{const _0x1f66ac=_0x3b307d;try{const {id:_0x5e54a8}=_0x2dd813['params'],_0x319174=_0x2dd813[_0x1f66ac(0xa9)];console[_0x1f66ac(0x78)](_0x1f66ac(0xb9)+_0x5e54a8+':',_0x319174);const _0xaeea8=await this['adminService'][_0x1f66ac(0x9f)](_0x5e54a8,_0x319174);_0x1f2586[_0x1f66ac(0x84)]({'success':!![],'message':_0x1f66ac(0xb8),'result':_0xaeea8});}catch(_0x59513e){_0x4b05d1(_0x59513e);}},this[_0x3b307d(0x89)]=async(_0x418223,_0x2363ea,_0x23b5f4)=>{const _0x327f96=_0x3b307d;try{const {id:_0x4c565d}=_0x418223[_0x327f96(0xce)],_0x59140c=_0x418223[_0x327f96(0xa9)],_0x2f53ae=await this[_0x327f96(0x93)][_0x327f96(0x89)](_0x4c565d,_0x59140c);_0x2363ea['json']({'success':!![],'message':'User\x20updated\x20successfully','result':_0x2f53ae});}catch(_0x1b1fd7){_0x23b5f4(_0x1b1fd7);}},this[_0x3b307d(0xc5)]=async(_0x33014a,_0x23a928,_0x412b62)=>{const _0x3c0adb=_0x3b307d;try{const {id:_0x5ab4d9}=_0x33014a[_0x3c0adb(0xce)],_0x511a93=await this[_0x3c0adb(0x93)][_0x3c0adb(0xc5)](_0x5ab4d9);_0x23a928[_0x3c0adb(0x84)]({'success':!![],'message':_0x3c0adb(0x9c),'result':_0x511a93});}catch(_0x4117c2){_0x412b62(_0x4117c2);}},this[_0x3b307d(0x86)]=async(_0x402c2d,_0x5784e6,_0x47862f)=>{const _0x437791=_0x3b307d;try{const {id:_0x27592c}=_0x402c2d[_0x437791(0xce)],_0x4b78bd=await this[_0x437791(0x93)][_0x437791(0x86)](_0x27592c);_0x5784e6['json']({'success':!![],'message':_0x437791(0x7b),'result':_0x4b78bd});}catch(_0x337305){_0x47862f(_0x337305);}},this[_0x3b307d(0xa6)]=async(_0x5e4eb4,_0x20ad83,_0x45a781)=>{const _0x249f92=_0x3b307d;try{const {page:page=0x1,limit:limit=0x14,status:_0x3ae440}=_0x5e4eb4['query'],_0x201bf8={'page':Number(page),'limit':Number(limit),'status':_0x3ae440},_0x572c3b=await this['adminService'][_0x249f92(0xb7)](_0x201bf8);_0x20ad83[_0x249f92(0x84)]({'success':!![],'users':_0x572c3b['users'],'pagination':_0x572c3b[_0x249f92(0x7a)]});}catch(_0x51569d){_0x45a781(_0x51569d);}},this[_0x3b307d(0x8a)]=async(_0x3ede33,_0x5bd640,_0x23beca)=>{const _0x5e00c9=_0x3b307d;try{const {id:_0x27769c}=_0x3ede33[_0x5e00c9(0xce)],_0x2fce0c=await this[_0x5e00c9(0x93)][_0x5e00c9(0x8a)](_0x27769c);if(!_0x2fce0c)return _0x5bd640[_0x5e00c9(0x81)](0x194)[_0x5e00c9(0x84)]({'success':![],'message':'User\x20not\x20found'});_0x5bd640['json']({'success':!![],'result':_0x2fce0c});}catch(_0x1b2dea){_0x23beca(_0x1b2dea);}},this[_0x3b307d(0xb2)]=async(_0x5eab1b,_0x3bd57b,_0x34d5bc)=>{const _0x1c684c=_0x3b307d;try{const _0x2349b8=_0x5eab1b[_0x1c684c(0xa9)],_0x171b64=await this[_0x1c684c(0x93)]['createUser'](_0x2349b8);_0x3bd57b['status'](0xc9)[_0x1c684c(0x84)]({'success':!![],'message':_0x1c684c(0xb5),'result':_0x171b64});}catch(_0x177f02){_0x34d5bc(_0x177f02);}},this[_0x3b307d(0xbd)]=async(_0x24f2a7,_0x18c734,_0x430be1)=>{const _0x459f88=_0x3b307d;try{const {id:_0x436076}=_0x24f2a7[_0x459f88(0xce)];await this[_0x459f88(0x93)][_0x459f88(0xbd)](_0x436076),_0x18c734['json']({'success':!![],'message':_0x459f88(0x9a)});}catch(_0xa6e997){_0x430be1(_0xa6e997);}},this['adminService']=new adminService_1[(_0x3b307d(0x99))](),this[_0x3b307d(0x90)]=new paymentLinkService_1[(_0x3b307d(0xad))]();}}exports[a3_0x48ce6c(0xbf)]=AdminController;