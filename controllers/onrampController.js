'use strict';var a11_0x2ddddd=a11_0x57d8;function a11_0x57d8(_0x12d76b,_0x4a6d45){_0x12d76b=_0x12d76b-0x18f;var _0x51dbcf=a11_0x51db();var _0x57d817=_0x51dbcf[_0x12d76b];return _0x57d817;}(function(_0x5790a6,_0x47fd87){var _0x4529ee=a11_0x57d8,_0x51716f=_0x5790a6();while(!![]){try{var _0x51c15f=-parseInt(_0x4529ee(0x1c0))/0x1+-parseInt(_0x4529ee(0x18f))/0x2+-parseInt(_0x4529ee(0x1ca))/0x3+parseInt(_0x4529ee(0x197))/0x4+parseInt(_0x4529ee(0x19a))/0x5+-parseInt(_0x4529ee(0x1b6))/0x6+parseInt(_0x4529ee(0x1ab))/0x7*(parseInt(_0x4529ee(0x1b1))/0x8);if(_0x51c15f===_0x47fd87)break;else _0x51716f['push'](_0x51716f['shift']());}catch(_0x2372cb){_0x51716f['push'](_0x51716f['shift']());}}}(a11_0x51db,0xc80e3));function a11_0x51db(){var _0x5eb3e5=['gatewayOrderId','gateway','Payment\x20ID\x20and\x20status\x20are\x20required','customerEmail','1113752bXqYWo','OnRampController','call','3294415GAjqYw','hasOwnProperty','shopId','\x20USDT\x20(after\x20','error','length','payment','findFirst','onramp','updatePaymentStatus','message','status','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','gatewayPaymentId','createdAt','writable','üìù\x20Data:','520807peIJvD','%\x20commission)','Payment\x20status\x20updated\x20successfully','USD','currency','successUrl','376qgQrGI','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','amount','create','name','9657942nuAkgk','PAID','log','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','convertToUSDT','json','toUpperCase','default','getOwnPropertyNames','\x20updated\x20to\x20','1228041csAwnc','update','../services/currencyService','getOwnPropertyDescriptor','then','prototype','__importStar','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','getPaymentData','updateMerchantBalanceForPaidPayment','1390977HkouzV','__setModuleDefault','updatedAt','customerName','invoiceTotalSum','defineProperty','Internal\x20server\x20error','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','__esModule','‚ùå\x20OnRamp\x20status\x20update\x20error:','pendingUrl','626768AXVISX','params','Unknown\x20error','Payment\x20not\x20found'];a11_0x51db=function(){return _0x5eb3e5;};return a11_0x51db();}var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x4b97e5,_0x1327bf,_0x3a4d5d,_0x5422af){var _0x61c799=a11_0x57d8;if(_0x5422af===undefined)_0x5422af=_0x3a4d5d;var _0x326c17=Object[_0x61c799(0x1c3)](_0x1327bf,_0x3a4d5d);(!_0x326c17||('get'in _0x326c17?!_0x1327bf[_0x61c799(0x1d2)]:_0x326c17[_0x61c799(0x1a9)]||_0x326c17['configurable']))&&(_0x326c17={'enumerable':!![],'get':function(){return _0x1327bf[_0x3a4d5d];}}),Object[_0x61c799(0x1cf)](_0x4b97e5,_0x5422af,_0x326c17);}:function(_0x50d574,_0x4f0df7,_0x7c9a34,_0x49b007){if(_0x49b007===undefined)_0x49b007=_0x7c9a34;_0x50d574[_0x49b007]=_0x4f0df7[_0x7c9a34];}),__setModuleDefault=this&&this[a11_0x2ddddd(0x1cb)]||(Object[a11_0x2ddddd(0x1b4)]?function(_0x2817e3,_0x549967){var _0x1eb807=a11_0x2ddddd;Object[_0x1eb807(0x1cf)](_0x2817e3,_0x1eb807(0x1bd),{'enumerable':!![],'value':_0x549967});}:function(_0x517789,_0x4ebaaa){_0x517789['default']=_0x4ebaaa;}),__importStar=this&&this[a11_0x2ddddd(0x1c6)]||(function(){var _0x448d8f=function(_0x270a97){var _0x20404a=a11_0x57d8;return _0x448d8f=Object[_0x20404a(0x1be)]||function(_0x48d3a2){var _0x37c998=_0x20404a,_0xdf9fe=[];for(var _0x36e27b in _0x48d3a2)if(Object[_0x37c998(0x1c5)][_0x37c998(0x19b)][_0x37c998(0x199)](_0x48d3a2,_0x36e27b))_0xdf9fe[_0xdf9fe[_0x37c998(0x19f)]]=_0x36e27b;return _0xdf9fe;},_0x448d8f(_0x270a97);};return function(_0x29005a){var _0x9c8f6e=a11_0x57d8;if(_0x29005a&&_0x29005a[_0x9c8f6e(0x1d2)])return _0x29005a;var _0x410893={};if(_0x29005a!=null){for(var _0x21440f=_0x448d8f(_0x29005a),_0x5b3b70=0x0;_0x5b3b70<_0x21440f['length'];_0x5b3b70++)if(_0x21440f[_0x5b3b70]!==_0x9c8f6e(0x1bd))__createBinding(_0x410893,_0x29005a,_0x21440f[_0x5b3b70]);}return __setModuleDefault(_0x410893,_0x29005a),_0x410893;};}()),__importDefault=this&&this['__importDefault']||function(_0x509d90){return _0x509d90&&_0x509d90['__esModule']?_0x509d90:{'default':_0x509d90};};Object['defineProperty'](exports,a11_0x2ddddd(0x1d2),{'value':!![]}),exports[a11_0x2ddddd(0x198)]=void 0x0;const database_1=__importDefault(require('../config/database'));class OnRampController{async[a11_0x2ddddd(0x1a3)](_0xbcbac0,_0x4382f7){var _0x1f5e5d=a11_0x2ddddd;try{const {paymentId:_0x120694,status:_0x2cd6ba,referenceId:_0x21b370,transactionHash:_0x110806,actualCryptoAmount:_0xe23759,orderId:_0x452212}=_0xbcbac0['body'];if(!_0x120694||!_0x2cd6ba){_0x4382f7[_0x1f5e5d(0x1a5)](0x190)[_0x1f5e5d(0x1bb)]({'success':![],'message':_0x1f5e5d(0x195)});return;}console['log']('üöÄ\x20OnRamp\x20status\x20update:\x20'+_0x120694+'\x20->\x20'+_0x2cd6ba),console[_0x1f5e5d(0x1b8)](_0x1f5e5d(0x1aa),{'referenceId':_0x21b370,'transactionHash':_0x110806,'actualCryptoAmount':_0xe23759,'orderId':_0x452212});const _0x910c21=await database_1[_0x1f5e5d(0x1bd)][_0x1f5e5d(0x1a0)][_0x1f5e5d(0x1a1)]({'where':{'OR':[{'id':_0x120694},{'orderId':_0x120694},{'gatewayOrderId':_0x120694},{'gatewayPaymentId':_0x120694}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x910c21){_0x4382f7[_0x1f5e5d(0x1a5)](0x194)['json']({'success':![],'message':_0x1f5e5d(0x192)});return;}if(_0x910c21[_0x1f5e5d(0x194)]!==_0x1f5e5d(0x1a2)){_0x4382f7[_0x1f5e5d(0x1a5)](0x190)[_0x1f5e5d(0x1bb)]({'success':![],'message':_0x1f5e5d(0x1b2)});return;}const _0x1cb5cf={'status':_0x2cd6ba[_0x1f5e5d(0x1bc)](),'statusChangedAt':new Date(),'statusChangedBy':'onramp_system'};_0x21b370&&(_0x1cb5cf['gatewayOrderId']=_0x21b370);_0x110806&&(_0x1cb5cf[_0x1f5e5d(0x1a7)]=_0x110806);_0xe23759&&(_0x1cb5cf[_0x1f5e5d(0x1ce)]=_0xe23759);const _0x53ea80=await database_1[_0x1f5e5d(0x1bd)][_0x1f5e5d(0x1a0)][_0x1f5e5d(0x1c1)]({'where':{'id':_0x910c21['id']},'data':_0x1cb5cf});console['log']('‚úÖ\x20OnRamp\x20payment\x20'+_0x910c21['id']+_0x1f5e5d(0x1bf)+_0x2cd6ba),_0x2cd6ba[_0x1f5e5d(0x1bc)]()===_0x1f5e5d(0x1b7)&&_0x910c21[_0x1f5e5d(0x1a5)]!==_0x1f5e5d(0x1b7)&&await this[_0x1f5e5d(0x1c9)](_0x910c21),_0x4382f7[_0x1f5e5d(0x1bb)]({'success':!![],'message':_0x1f5e5d(0x1ad),'data':{'paymentId':_0x53ea80['id'],'status':_0x53ea80[_0x1f5e5d(0x1a5)],'referenceId':_0x21b370,'transactionHash':_0x110806,'actualCryptoAmount':_0xe23759}});}catch(_0x447d48){console[_0x1f5e5d(0x19e)](_0x1f5e5d(0x1d3),_0x447d48),_0x4382f7[_0x1f5e5d(0x1a5)](0x1f4)[_0x1f5e5d(0x1bb)]({'success':![],'message':_0x1f5e5d(0x1d0),'error':_0x447d48 instanceof Error?_0x447d48[_0x1f5e5d(0x1a4)]:_0x1f5e5d(0x191)});}}async[a11_0x2ddddd(0x1c9)](_0x519804){var _0x4567f1=a11_0x2ddddd;try{console['log'](_0x4567f1(0x1b9)+_0x519804['id']);let _0x3a2f46;if(_0x519804[_0x4567f1(0x1af)]===_0x4567f1(0x1ae))_0x3a2f46=_0x519804[_0x4567f1(0x1b3)];else{const {currencyService:_0x227994}=await Promise['resolve']()[_0x4567f1(0x1c4)](()=>__importStar(require(_0x4567f1(0x1c2))));_0x3a2f46=await _0x227994[_0x4567f1(0x1ba)](_0x519804['amount'],_0x519804[_0x4567f1(0x1af)]);}await database_1[_0x4567f1(0x1bd)]['payment'][_0x4567f1(0x1c1)]({'where':{'id':_0x519804['id']},'data':{'amountUSDT':_0x3a2f46,'paidAt':new Date()}});const _0x1f932d=0xa,_0x41975d=_0x3a2f46*(0x1-_0x1f932d/0x64);await database_1[_0x4567f1(0x1bd)]['shop'][_0x4567f1(0x1c1)]({'where':{'id':_0x519804[_0x4567f1(0x19c)]},'data':{'balance':{'increment':_0x41975d}}}),console[_0x4567f1(0x1b8)](_0x4567f1(0x1d1)+_0x41975d['toFixed'](0x6)+_0x4567f1(0x19d)+_0x1f932d+_0x4567f1(0x1ac));}catch(_0x392209){console['error']('‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:',_0x392209);}}async[a11_0x2ddddd(0x1c8)](_0x568856,_0x26b67e){var _0x57897e=a11_0x2ddddd;try{const {id:_0x44808d}=_0x568856[_0x57897e(0x190)];if(!_0x44808d){_0x26b67e[_0x57897e(0x1a5)](0x190)[_0x57897e(0x1bb)]({'success':![],'message':'Payment\x20ID\x20is\x20required'});return;}console[_0x57897e(0x1b8)](_0x57897e(0x1a6)+_0x44808d);const _0xf19566=await database_1[_0x57897e(0x1bd)]['payment'][_0x57897e(0x1a1)]({'where':{'OR':[{'id':_0x44808d},{'orderId':_0x44808d},{'gatewayOrderId':_0x44808d},{'gatewayPaymentId':_0x44808d}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0xf19566){_0x26b67e['status'](0x194)[_0x57897e(0x1bb)]({'success':![],'message':_0x57897e(0x192)});return;}console[_0x57897e(0x1b8)]('‚úÖ\x20Found\x20payment:\x20'+_0xf19566['id']+'\x20('+_0xf19566[_0x57897e(0x1a5)]+')'),_0x26b67e[_0x57897e(0x1bb)]({'success':!![],'data':{'id':_0xf19566['id'],'gateway':_0xf19566[_0x57897e(0x194)],'amount':_0xf19566['amount'],'currency':_0xf19566[_0x57897e(0x1af)],'status':_0xf19566[_0x57897e(0x1a5)],'gatewayOrderId':_0xf19566[_0x57897e(0x193)],'gatewayPaymentId':_0xf19566[_0x57897e(0x1a7)],'successUrl':_0xf19566[_0x57897e(0x1b0)],'failUrl':_0xf19566['failUrl'],'pendingUrl':_0xf19566[_0x57897e(0x1d4)],'customerEmail':_0xf19566[_0x57897e(0x196)],'customerName':_0xf19566[_0x57897e(0x1cd)],'merchantBrand':_0xf19566['shop'][_0x57897e(0x1b5)],'createdAt':_0xf19566[_0x57897e(0x1a8)],'updatedAt':_0xf19566[_0x57897e(0x1cc)]}});}catch(_0xe92134){console[_0x57897e(0x19e)](_0x57897e(0x1c7),_0xe92134),_0x26b67e[_0x57897e(0x1a5)](0x1f4)[_0x57897e(0x1bb)]({'success':![],'message':_0x57897e(0x1d0),'error':_0xe92134 instanceof Error?_0xe92134[_0x57897e(0x1a4)]:_0x57897e(0x191)});}}}exports['OnRampController']=OnRampController;