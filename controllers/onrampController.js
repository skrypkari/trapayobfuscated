'use strict';var a11_0xc60381=a11_0xe6df;(function(_0x13c015,_0x26778d){var _0x358409=a11_0xe6df,_0x4f7ea3=_0x13c015();while(!![]){try{var _0x2d01ce=-parseInt(_0x358409(0x17b))/0x1*(-parseInt(_0x358409(0x197))/0x2)+parseInt(_0x358409(0x18d))/0x3*(-parseInt(_0x358409(0x19d))/0x4)+parseInt(_0x358409(0x19e))/0x5+-parseInt(_0x358409(0x195))/0x6+parseInt(_0x358409(0x1b2))/0x7*(-parseInt(_0x358409(0x188))/0x8)+parseInt(_0x358409(0x191))/0x9*(-parseInt(_0x358409(0x1b0))/0xa)+parseInt(_0x358409(0x17a))/0xb*(parseInt(_0x358409(0x19a))/0xc);if(_0x2d01ce===_0x26778d)break;else _0x4f7ea3['push'](_0x4f7ea3['shift']());}catch(_0x4bb291){_0x4f7ea3['push'](_0x4f7ea3['shift']());}}}(a11_0x168c,0x7ac93));var __createBinding=this&&this['__createBinding']||(Object[a11_0xc60381(0x192)]?function(_0x21a5dc,_0x111c4a,_0x54553a,_0x269eaf){var _0x2b295d=a11_0xc60381;if(_0x269eaf===undefined)_0x269eaf=_0x54553a;var _0x42a66a=Object[_0x2b295d(0x18a)](_0x111c4a,_0x54553a);(!_0x42a66a||('get'in _0x42a66a?!_0x111c4a['__esModule']:_0x42a66a['writable']||_0x42a66a[_0x2b295d(0x1a7)]))&&(_0x42a66a={'enumerable':!![],'get':function(){return _0x111c4a[_0x54553a];}}),Object['defineProperty'](_0x21a5dc,_0x269eaf,_0x42a66a);}:function(_0x3517c8,_0x3ffb28,_0x10257e,_0x3eab7f){if(_0x3eab7f===undefined)_0x3eab7f=_0x10257e;_0x3517c8[_0x3eab7f]=_0x3ffb28[_0x10257e];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a11_0xc60381(0x192)]?function(_0x35cade,_0x50e5f3){var _0x4869d7=a11_0xc60381;Object[_0x4869d7(0x170)](_0x35cade,_0x4869d7(0x1ac),{'enumerable':!![],'value':_0x50e5f3});}:function(_0x22964b,_0x1ef53f){var _0x56da20=a11_0xc60381;_0x22964b[_0x56da20(0x1ac)]=_0x1ef53f;}),__importStar=this&&this[a11_0xc60381(0x173)]||(function(){var _0x3476ab=function(_0x31d137){var _0xbde051=a11_0xe6df;return _0x3476ab=Object[_0xbde051(0x187)]||function(_0xff49dc){var _0x364fbc=_0xbde051,_0x591482=[];for(var _0x22221f in _0xff49dc)if(Object[_0x364fbc(0x199)][_0x364fbc(0x171)][_0x364fbc(0x190)](_0xff49dc,_0x22221f))_0x591482[_0x591482[_0x364fbc(0x1af)]]=_0x22221f;return _0x591482;},_0x3476ab(_0x31d137);};return function(_0x51bdd4){var _0x1a2487=a11_0xe6df;if(_0x51bdd4&&_0x51bdd4['__esModule'])return _0x51bdd4;var _0xd44cd5={};if(_0x51bdd4!=null){for(var _0x28337f=_0x3476ab(_0x51bdd4),_0x19b519=0x0;_0x19b519<_0x28337f[_0x1a2487(0x1af)];_0x19b519++)if(_0x28337f[_0x19b519]!==_0x1a2487(0x1ac))__createBinding(_0xd44cd5,_0x51bdd4,_0x28337f[_0x19b519]);}return __setModuleDefault(_0xd44cd5,_0x51bdd4),_0xd44cd5;};}()),__importDefault=this&&this['__importDefault']||function(_0x4053b5){var _0x12dc0a=a11_0xc60381;return _0x4053b5&&_0x4053b5[_0x12dc0a(0x1ad)]?_0x4053b5:{'default':_0x4053b5};};Object['defineProperty'](exports,a11_0xc60381(0x1ad),{'value':!![]}),exports[a11_0xc60381(0x1a8)]=void 0x0;const database_1=__importDefault(require('../config/database'));class OnRampController{async[a11_0xc60381(0x18c)](_0x2eac0e,_0x458e80){var _0x1d2b17=a11_0xc60381;try{const {paymentId:_0x192848,status:_0x524a83,referenceId:_0x50a619,transactionHash:_0x29614f,actualCryptoAmount:_0x34264b,orderId:_0x187336}=_0x2eac0e[_0x1d2b17(0x17f)];if(!_0x192848||!_0x524a83){_0x458e80['status'](0x190)[_0x1d2b17(0x1b4)]({'success':![],'message':_0x1d2b17(0x1a9)});return;}console[_0x1d2b17(0x18f)](_0x1d2b17(0x17d)+_0x192848+_0x1d2b17(0x183)+_0x524a83),console[_0x1d2b17(0x18f)](_0x1d2b17(0x194),{'referenceId':_0x50a619,'transactionHash':_0x29614f,'actualCryptoAmount':_0x34264b,'orderId':_0x187336});const _0x31a64a=await database_1[_0x1d2b17(0x1ac)]['payment'][_0x1d2b17(0x177)]({'where':{'OR':[{'id':_0x192848},{'orderId':_0x192848},{'gatewayOrderId':_0x192848},{'gatewayPaymentId':_0x192848}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x31a64a){_0x458e80['status'](0x194)[_0x1d2b17(0x1b4)]({'success':![],'message':'Payment\x20not\x20found'});return;}if(_0x31a64a[_0x1d2b17(0x193)]!==_0x1d2b17(0x182)){_0x458e80[_0x1d2b17(0x1a2)](0x190)[_0x1d2b17(0x1b4)]({'success':![],'message':_0x1d2b17(0x1aa)});return;}const _0x5967cb={'status':_0x524a83[_0x1d2b17(0x1b6)](),'statusChangedAt':new Date(),'statusChangedBy':_0x1d2b17(0x181)};_0x50a619&&(_0x5967cb[_0x1d2b17(0x1b3)]=_0x50a619);_0x29614f&&(_0x5967cb[_0x1d2b17(0x19c)]=_0x29614f);_0x34264b&&(_0x5967cb[_0x1d2b17(0x19b)]=_0x34264b);const _0x2c18f2=await database_1[_0x1d2b17(0x1ac)][_0x1d2b17(0x1b1)]['update']({'where':{'id':_0x31a64a['id']},'data':_0x5967cb});console[_0x1d2b17(0x18f)](_0x1d2b17(0x174)+_0x31a64a['id']+_0x1d2b17(0x17c)+_0x524a83),_0x524a83[_0x1d2b17(0x1b6)]()===_0x1d2b17(0x175)&&_0x31a64a['status']!==_0x1d2b17(0x175)&&await this[_0x1d2b17(0x179)](_0x31a64a),_0x458e80[_0x1d2b17(0x1b4)]({'success':!![],'message':'Payment\x20status\x20updated\x20successfully','data':{'paymentId':_0x2c18f2['id'],'status':_0x2c18f2[_0x1d2b17(0x1a2)],'referenceId':_0x50a619,'transactionHash':_0x29614f,'actualCryptoAmount':_0x34264b}});}catch(_0x440561){console[_0x1d2b17(0x184)](_0x1d2b17(0x186),_0x440561),_0x458e80[_0x1d2b17(0x1a2)](0x1f4)[_0x1d2b17(0x1b4)]({'success':![],'message':_0x1d2b17(0x198),'error':_0x440561 instanceof Error?_0x440561['message']:_0x1d2b17(0x18e)});}}async[a11_0xc60381(0x179)](_0x4d2bf1){var _0x4f6b0a=a11_0xc60381;try{console[_0x4f6b0a(0x18f)]('üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20'+_0x4d2bf1['id']);let _0x3e6984;if(_0x4d2bf1[_0x4f6b0a(0x189)]===_0x4f6b0a(0x1a6))_0x3e6984=_0x4d2bf1[_0x4f6b0a(0x180)];else{const {currencyService:_0x1dfa73}=await Promise['resolve']()['then'](()=>__importStar(require(_0x4f6b0a(0x178))));_0x3e6984=await _0x1dfa73[_0x4f6b0a(0x185)](_0x4d2bf1[_0x4f6b0a(0x180)],_0x4d2bf1[_0x4f6b0a(0x189)]);}await database_1[_0x4f6b0a(0x1ac)]['payment'][_0x4f6b0a(0x18b)]({'where':{'id':_0x4d2bf1['id']},'data':{'amountUSDT':_0x3e6984,'paidAt':new Date()}});const _0x19d166=0xa,_0x5e5b0d=_0x3e6984*(0x1-_0x19d166/0x64);await database_1[_0x4f6b0a(0x1ac)]['shop'][_0x4f6b0a(0x18b)]({'where':{'id':_0x4d2bf1[_0x4f6b0a(0x16f)]},'data':{'balance':{'increment':_0x5e5b0d}}}),console['log'](_0x4f6b0a(0x16e)+_0x5e5b0d[_0x4f6b0a(0x1ae)](0x6)+_0x4f6b0a(0x1a3)+_0x19d166+_0x4f6b0a(0x1a4));}catch(_0x3a3290){console[_0x4f6b0a(0x184)](_0x4f6b0a(0x1ab),_0x3a3290);}}async[a11_0xc60381(0x19f)](_0xf913bf,_0x11cc5f){var _0x5e9000=a11_0xc60381;try{const {id:_0x2a40f7}=_0xf913bf[_0x5e9000(0x172)];if(!_0x2a40f7){_0x11cc5f[_0x5e9000(0x1a2)](0x190)[_0x5e9000(0x1b4)]({'success':![],'message':'Payment\x20ID\x20is\x20required'});return;}console['log'](_0x5e9000(0x1a1)+_0x2a40f7);const _0x5e0899=await database_1[_0x5e9000(0x1ac)][_0x5e9000(0x1b1)][_0x5e9000(0x177)]({'where':{'OR':[{'id':_0x2a40f7},{'orderId':_0x2a40f7},{'gatewayOrderId':_0x2a40f7},{'gatewayPaymentId':_0x2a40f7}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x5e0899){_0x11cc5f['status'](0x194)[_0x5e9000(0x1b4)]({'success':![],'message':'Payment\x20not\x20found'});return;}console[_0x5e9000(0x18f)](_0x5e9000(0x1b7)+_0x5e0899['id']+'\x20('+_0x5e0899['status']+')'),_0x11cc5f['json']({'success':!![],'data':{'id':_0x5e0899['id'],'gateway':_0x5e0899[_0x5e9000(0x193)],'amount':_0x5e0899[_0x5e9000(0x180)],'currency':_0x5e0899['currency'],'status':_0x5e0899['status'],'gatewayOrderId':_0x5e0899['gatewayOrderId'],'gatewayPaymentId':_0x5e0899['gatewayPaymentId'],'successUrl':_0x5e0899[_0x5e9000(0x1b5)],'failUrl':_0x5e0899[_0x5e9000(0x1a0)],'pendingUrl':_0x5e0899[_0x5e9000(0x176)],'customerEmail':_0x5e0899['customerEmail'],'customerName':_0x5e0899['customerName'],'merchantBrand':_0x5e0899[_0x5e9000(0x17e)]['name'],'createdAt':_0x5e0899['createdAt'],'updatedAt':_0x5e0899[_0x5e9000(0x196)]}});}catch(_0x29d969){console[_0x5e9000(0x184)](_0x5e9000(0x1a5),_0x29d969),_0x11cc5f['status'](0x1f4)['json']({'success':![],'message':_0x5e9000(0x198),'error':_0x29d969 instanceof Error?_0x29d969['message']:_0x5e9000(0x18e)});}}}function a11_0x168c(){var _0x2422fb=['üìù\x20Data:','4492332AocoMt','updatedAt','70roVVcI','Internal\x20server\x20error','prototype','187908lHeBSK','invoiceTotalSum','gatewayPaymentId','2438328aiGAef','1092050OvQwAt','getPaymentData','failUrl','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','status','\x20USDT\x20(after\x20','%\x20commission)','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','USD','configurable','OnRampController','Payment\x20ID\x20and\x20status\x20are\x20required','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','default','__esModule','toFixed','length','30vNwSgo','payment','21QAJnyQ','gatewayOrderId','json','successUrl','toUpperCase','‚úÖ\x20Found\x20payment:\x20','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','shopId','defineProperty','hasOwnProperty','params','__importStar','‚úÖ\x20OnRamp\x20payment\x20','PAID','pendingUrl','findFirst','../services/currencyService','updateMerchantBalanceForPaidPayment','1782AagSAI','2885ewXssP','\x20updated\x20to\x20','üöÄ\x20OnRamp\x20status\x20update:\x20','shop','body','amount','onramp_system','onramp','\x20->\x20','error','convertToUSDT','‚ùå\x20OnRamp\x20status\x20update\x20error:','getOwnPropertyNames','278888qxjGKv','currency','getOwnPropertyDescriptor','update','updatePaymentStatus','3puXfWP','Unknown\x20error','log','call','2670975bqYNna','create','gateway'];a11_0x168c=function(){return _0x2422fb;};return a11_0x168c();}function a11_0xe6df(_0x41eace,_0x5bc97e){_0x41eace=_0x41eace-0x16e;var _0x168c9c=a11_0x168c();var _0xe6dfc=_0x168c9c[_0x41eace];return _0xe6dfc;}exports[a11_0xc60381(0x1a8)]=OnRampController;