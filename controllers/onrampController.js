'use strict';var a12_0x25c648=a12_0x4023;(function(_0xd5ca54,_0x12de62){var _0x5ed4c5=a12_0x4023,_0x6ba19e=_0xd5ca54();while(!![]){try{var _0x1c80d5=-parseInt(_0x5ed4c5(0xcf))/0x1+-parseInt(_0x5ed4c5(0xeb))/0x2*(-parseInt(_0x5ed4c5(0x100))/0x3)+-parseInt(_0x5ed4c5(0xec))/0x4+-parseInt(_0x5ed4c5(0x104))/0x5+-parseInt(_0x5ed4c5(0xf9))/0x6+-parseInt(_0x5ed4c5(0xea))/0x7*(-parseInt(_0x5ed4c5(0xdf))/0x8)+parseInt(_0x5ed4c5(0xbd))/0x9*(parseInt(_0x5ed4c5(0xc8))/0xa);if(_0x1c80d5===_0x12de62)break;else _0x6ba19e['push'](_0x6ba19e['shift']());}catch(_0x5b82e5){_0x6ba19e['push'](_0x6ba19e['shift']());}}}(a12_0x15e8,0x8179a));function a12_0x15e8(){var _0xd4a1b9=['‚úÖ\x20OnRamp\x20payment\x20','createdAt','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','298792KVoYQP','\x20->\x20','toFixed','hasOwnProperty','status','getPaymentData','Payment\x20ID\x20is\x20required','gatewayOrderId','../services/currencyService','default','OnRampController','77NuAVpN','2DowaYV','802172UIVoNW','Payment\x20ID\x20and\x20status\x20are\x20required','__esModule','__createBinding','%\x20commission)','call','gatewayPaymentId','Payment\x20not\x20found','amount','customerName','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','log','successUrl','4934004omwmEJ','failUrl','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','currency','__importStar','findFirst','onramp_system','1599645gkpuZS','\x20USDT\x20(after\x20','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','convertToUSDT','3739165DHqUgf','error','üìù\x20Data:','shop','resolve','create','updateMerchantBalanceForPaidPayment','189tdmgve','getOwnPropertyNames','__importDefault','update','pendingUrl','toUpperCase','‚ùå\x20OnRamp\x20status\x20update\x20error:','payment','Unknown\x20error','USD','updatePaymentStatus','655970IgpyZc','invoiceTotalSum','onramp','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','params','get','__setModuleDefault','20551uyIkhL','Internal\x20server\x20error','length','PAID','../config/database','updatedAt','‚úÖ\x20Found\x20payment:\x20','Payment\x20status\x20updated\x20successfully','json','message','defineProperty','gateway','customerEmail'];a12_0x15e8=function(){return _0xd4a1b9;};return a12_0x15e8();}function a12_0x4023(_0x1ae57f,_0x12e985){_0x1ae57f=_0x1ae57f-0xbd;var _0x15e8f0=a12_0x15e8();var _0x40232f=_0x15e8f0[_0x1ae57f];return _0x40232f;}var __createBinding=this&&this[a12_0x25c648(0xef)]||(Object['create']?function(_0x47ea41,_0x3b4f90,_0x20ee6b,_0x29c38f){var _0x4edadc=a12_0x25c648;if(_0x29c38f===undefined)_0x29c38f=_0x20ee6b;var _0x4ccd4f=Object['getOwnPropertyDescriptor'](_0x3b4f90,_0x20ee6b);(!_0x4ccd4f||(_0x4edadc(0xcd)in _0x4ccd4f?!_0x3b4f90[_0x4edadc(0xee)]:_0x4ccd4f['writable']||_0x4ccd4f['configurable']))&&(_0x4ccd4f={'enumerable':!![],'get':function(){return _0x3b4f90[_0x20ee6b];}}),Object[_0x4edadc(0xd9)](_0x47ea41,_0x29c38f,_0x4ccd4f);}:function(_0x1d45d0,_0x401387,_0x1ca938,_0x2e139a){if(_0x2e139a===undefined)_0x2e139a=_0x1ca938;_0x1d45d0[_0x2e139a]=_0x401387[_0x1ca938];}),__setModuleDefault=this&&this[a12_0x25c648(0xce)]||(Object[a12_0x25c648(0x109)]?function(_0x339532,_0x59f5ab){var _0x5f2963=a12_0x25c648;Object[_0x5f2963(0xd9)](_0x339532,_0x5f2963(0xe8),{'enumerable':!![],'value':_0x59f5ab});}:function(_0x8a2c24,_0x5e4941){var _0x13e30d=a12_0x25c648;_0x8a2c24[_0x13e30d(0xe8)]=_0x5e4941;}),__importStar=this&&this[a12_0x25c648(0xfd)]||(function(){var _0x2b7c67=function(_0x149020){var _0x4291fd=a12_0x4023;return _0x2b7c67=Object[_0x4291fd(0xbe)]||function(_0x3fd75b){var _0x384a63=_0x4291fd,_0x3d2886=[];for(var _0x4c737a in _0x3fd75b)if(Object['prototype'][_0x384a63(0xe2)][_0x384a63(0xf1)](_0x3fd75b,_0x4c737a))_0x3d2886[_0x3d2886[_0x384a63(0xd1)]]=_0x4c737a;return _0x3d2886;},_0x2b7c67(_0x149020);};return function(_0x1e3f07){var _0x5af728=a12_0x4023;if(_0x1e3f07&&_0x1e3f07['__esModule'])return _0x1e3f07;var _0x3585e1={};if(_0x1e3f07!=null){for(var _0x4a725a=_0x2b7c67(_0x1e3f07),_0x1c8adc=0x0;_0x1c8adc<_0x4a725a[_0x5af728(0xd1)];_0x1c8adc++)if(_0x4a725a[_0x1c8adc]!==_0x5af728(0xe8))__createBinding(_0x3585e1,_0x1e3f07,_0x4a725a[_0x1c8adc]);}return __setModuleDefault(_0x3585e1,_0x1e3f07),_0x3585e1;};}()),__importDefault=this&&this[a12_0x25c648(0xbf)]||function(_0x2175bc){var _0x1fb06d=a12_0x25c648;return _0x2175bc&&_0x2175bc[_0x1fb06d(0xee)]?_0x2175bc:{'default':_0x2175bc};};Object[a12_0x25c648(0xd9)](exports,a12_0x25c648(0xee),{'value':!![]}),exports[a12_0x25c648(0xe9)]=void 0x0;const database_1=__importDefault(require(a12_0x25c648(0xd3)));class OnRampController{async[a12_0x25c648(0xc7)](_0x4e726a,_0x111d59){var _0x24b89f=a12_0x25c648;try{const {paymentId:_0x26c05c,status:_0x332c06,referenceId:_0x1048d1,transactionHash:_0x3beb8f,actualCryptoAmount:_0x136751,orderId:_0x556e77}=_0x4e726a['body'];if(!_0x26c05c||!_0x332c06){_0x111d59[_0x24b89f(0xe3)](0x190)[_0x24b89f(0xd7)]({'success':![],'message':_0x24b89f(0xed)});return;}console[_0x24b89f(0xf7)]('üöÄ\x20OnRamp\x20status\x20update:\x20'+_0x26c05c+_0x24b89f(0xe0)+_0x332c06),console[_0x24b89f(0xf7)](_0x24b89f(0x106),{'referenceId':_0x1048d1,'transactionHash':_0x3beb8f,'actualCryptoAmount':_0x136751,'orderId':_0x556e77});const _0x46e8fc=await database_1[_0x24b89f(0xe8)][_0x24b89f(0xc4)][_0x24b89f(0xfe)]({'where':{'OR':[{'id':_0x26c05c},{'orderId':_0x26c05c},{'gatewayOrderId':_0x26c05c},{'gatewayPaymentId':_0x26c05c}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x46e8fc){_0x111d59[_0x24b89f(0xe3)](0x194)[_0x24b89f(0xd7)]({'success':![],'message':_0x24b89f(0xf3)});return;}if(_0x46e8fc[_0x24b89f(0xda)]!==_0x24b89f(0xca)){_0x111d59[_0x24b89f(0xe3)](0x190)[_0x24b89f(0xd7)]({'success':![],'message':_0x24b89f(0xfb)});return;}const _0x230b79={'status':_0x332c06[_0x24b89f(0xc2)](),'statusChangedAt':new Date(),'statusChangedBy':_0x24b89f(0xff)};_0x1048d1&&(_0x230b79[_0x24b89f(0xe6)]=_0x1048d1);_0x3beb8f&&(_0x230b79['gatewayPaymentId']=_0x3beb8f);_0x136751&&(_0x230b79[_0x24b89f(0xc9)]=_0x136751);const _0x20fff2=await database_1[_0x24b89f(0xe8)][_0x24b89f(0xc4)][_0x24b89f(0xc0)]({'where':{'id':_0x46e8fc['id']},'data':_0x230b79});console[_0x24b89f(0xf7)](_0x24b89f(0xdc)+_0x46e8fc['id']+'\x20updated\x20to\x20'+_0x332c06),_0x332c06['toUpperCase']()==='PAID'&&_0x46e8fc['status']!==_0x24b89f(0xd2)&&await this[_0x24b89f(0x10a)](_0x46e8fc),_0x111d59[_0x24b89f(0xd7)]({'success':!![],'message':_0x24b89f(0xd6),'data':{'paymentId':_0x20fff2['id'],'status':_0x20fff2[_0x24b89f(0xe3)],'referenceId':_0x1048d1,'transactionHash':_0x3beb8f,'actualCryptoAmount':_0x136751}});}catch(_0x353aaf){console[_0x24b89f(0x105)](_0x24b89f(0xc3),_0x353aaf),_0x111d59['status'](0x1f4)['json']({'success':![],'message':_0x24b89f(0xd0),'error':_0x353aaf instanceof Error?_0x353aaf[_0x24b89f(0xd8)]:_0x24b89f(0xc5)});}}async[a12_0x25c648(0x10a)](_0x4bbf91){var _0xb47bce=a12_0x25c648;try{console[_0xb47bce(0xf7)](_0xb47bce(0xf6)+_0x4bbf91['id']);let _0x1f36db;if(_0x4bbf91['currency']===_0xb47bce(0xc6))_0x1f36db=_0x4bbf91['amount'];else{const {currencyService:_0x286a34}=await Promise[_0xb47bce(0x108)]()['then'](()=>__importStar(require(_0xb47bce(0xe7))));_0x1f36db=await _0x286a34[_0xb47bce(0x103)](_0x4bbf91[_0xb47bce(0xf4)],_0x4bbf91[_0xb47bce(0xfc)]);}await database_1[_0xb47bce(0xe8)][_0xb47bce(0xc4)][_0xb47bce(0xc0)]({'where':{'id':_0x4bbf91['id']},'data':{'amountUSDT':_0x1f36db,'paidAt':new Date()}});const _0x2067ce=0xa,_0x5f38a4=_0x1f36db*(0x1-_0x2067ce/0x64);await database_1[_0xb47bce(0xe8)]['shop']['update']({'where':{'id':_0x4bbf91['shopId']},'data':{'balance':{'increment':_0x5f38a4}}}),console['log'](_0xb47bce(0x102)+_0x5f38a4[_0xb47bce(0xe1)](0x6)+_0xb47bce(0x101)+_0x2067ce+_0xb47bce(0xf0));}catch(_0x19188b){console['error']('‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:',_0x19188b);}}async[a12_0x25c648(0xe4)](_0x1aa34f,_0xda8f4d){var _0x384097=a12_0x25c648;try{const {id:_0x357990}=_0x1aa34f[_0x384097(0xcc)];if(!_0x357990){_0xda8f4d[_0x384097(0xe3)](0x190)[_0x384097(0xd7)]({'success':![],'message':_0x384097(0xe5)});return;}console[_0x384097(0xf7)](_0x384097(0xcb)+_0x357990);const _0xfcf736=await database_1[_0x384097(0xe8)]['payment']['findFirst']({'where':{'OR':[{'id':_0x357990},{'orderId':_0x357990},{'gatewayOrderId':_0x357990},{'gatewayPaymentId':_0x357990}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0xfcf736){_0xda8f4d[_0x384097(0xe3)](0x194)[_0x384097(0xd7)]({'success':![],'message':_0x384097(0xf3)});return;}console[_0x384097(0xf7)](_0x384097(0xd5)+_0xfcf736['id']+'\x20('+_0xfcf736[_0x384097(0xe3)]+')'),_0xda8f4d[_0x384097(0xd7)]({'success':!![],'data':{'id':_0xfcf736['id'],'gateway':_0xfcf736['gateway'],'amount':_0xfcf736['amount'],'currency':_0xfcf736[_0x384097(0xfc)],'status':_0xfcf736['status'],'gatewayOrderId':_0xfcf736[_0x384097(0xe6)],'gatewayPaymentId':_0xfcf736[_0x384097(0xf2)],'successUrl':_0xfcf736[_0x384097(0xf8)],'failUrl':_0xfcf736[_0x384097(0xfa)],'pendingUrl':_0xfcf736[_0x384097(0xc1)],'customerEmail':_0xfcf736[_0x384097(0xdb)],'customerName':_0xfcf736[_0x384097(0xf5)],'merchantBrand':_0xfcf736[_0x384097(0x107)]['name'],'createdAt':_0xfcf736[_0x384097(0xdd)],'updatedAt':_0xfcf736[_0x384097(0xd4)]}});}catch(_0x4b9d07){console[_0x384097(0x105)](_0x384097(0xde),_0x4b9d07),_0xda8f4d[_0x384097(0xe3)](0x1f4)['json']({'success':![],'message':_0x384097(0xd0),'error':_0x4b9d07 instanceof Error?_0x4b9d07[_0x384097(0xd8)]:_0x384097(0xc5)});}}}exports[a12_0x25c648(0xe9)]=OnRampController;