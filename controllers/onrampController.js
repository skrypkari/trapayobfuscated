'use strict';function a12_0x3373(_0x175419,_0x385102){_0x175419=_0x175419-0xe0;var _0x3cdf3=a12_0x3cdf();var _0x3373da=_0x3cdf3[_0x175419];return _0x3373da;}var a12_0x4af9a7=a12_0x3373;function a12_0x3cdf(){var _0x1be445=['‚úÖ\x20Found\x20payment:\x20','currency','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','create','Payment\x20ID\x20is\x20required','shop','__createBinding','USD','log','Internal\x20server\x20error','Payment\x20not\x20found','updatedAt','772032UwaLls','successUrl','body','error','675290QYbrMA','length','12XZEsmA','getPaymentData','%\x20commission)','3055768JUoKBw','Unknown\x20error','convertToUSDT','gatewayPaymentId','defineProperty','default','json','PAID','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','4307429BnuceI','763932mDvyVw','resolve','configurable','gateway','__importDefault','../config/database','onramp','165qSJtCR','failUrl','then','updateMerchantBalanceForPaidPayment','\x20updated\x20to\x20','toUpperCase','amount','writable','156072frNgaz','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','findFirst','getOwnPropertyDescriptor','gatewayOrderId','81LQtBwh','30zcYotJ','call','OnRampController','__importStar','24jkDeaN','__esModule','params','updatePaymentStatus','‚ùå\x20OnRamp\x20status\x20update\x20error:','name','message','Payment\x20status\x20updated\x20successfully','status','3532PFPwZF','üöÄ\x20OnRamp\x20status\x20update:\x20','payment','customerName','customerEmail','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20'];a12_0x3cdf=function(){return _0x1be445;};return a12_0x3cdf();}(function(_0x198d70,_0x484c57){var _0x71e17a=a12_0x3373,_0x44ba6c=_0x198d70();while(!![]){try{var _0x5bdbdb=parseInt(_0x71e17a(0x116))/0x1*(parseInt(_0x71e17a(0x10d))/0x2)+parseInt(_0x71e17a(0xe7))/0x3*(parseInt(_0x71e17a(0x103))/0x4)+parseInt(_0x71e17a(0x109))/0x5*(parseInt(_0x71e17a(0xe1))/0x6)+-parseInt(_0x71e17a(0xf3))/0x7+parseInt(_0x71e17a(0xea))/0x8+-parseInt(_0x71e17a(0x108))/0x9*(-parseInt(_0x71e17a(0xe5))/0xa)+parseInt(_0x71e17a(0xfb))/0xb*(-parseInt(_0x71e17a(0xf4))/0xc);if(_0x5bdbdb===_0x484c57)break;else _0x44ba6c['push'](_0x44ba6c['shift']());}catch(_0x43b0c8){_0x44ba6c['push'](_0x44ba6c['shift']());}}}(a12_0x3cdf,0x5f346));var __createBinding=this&&this[a12_0x4af9a7(0x123)]||(Object[a12_0x4af9a7(0x120)]?function(_0x1b4256,_0x1d72fb,_0x20c6b6,_0xb9e6c3){var _0x31da5e=a12_0x4af9a7;if(_0xb9e6c3===undefined)_0xb9e6c3=_0x20c6b6;var _0x374e2b=Object[_0x31da5e(0x106)](_0x1d72fb,_0x20c6b6);(!_0x374e2b||('get'in _0x374e2b?!_0x1d72fb['__esModule']:_0x374e2b[_0x31da5e(0x102)]||_0x374e2b[_0x31da5e(0xf6)]))&&(_0x374e2b={'enumerable':!![],'get':function(){return _0x1d72fb[_0x20c6b6];}}),Object[_0x31da5e(0xee)](_0x1b4256,_0xb9e6c3,_0x374e2b);}:function(_0x404c41,_0x1bb004,_0x16f51f,_0x1b62af){if(_0x1b62af===undefined)_0x1b62af=_0x16f51f;_0x404c41[_0x1b62af]=_0x1bb004[_0x16f51f];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a12_0x4af9a7(0x120)]?function(_0x4ddd92,_0x377518){var _0x4e9bee=a12_0x4af9a7;Object[_0x4e9bee(0xee)](_0x4ddd92,_0x4e9bee(0xef),{'enumerable':!![],'value':_0x377518});}:function(_0x176f3c,_0x198bbc){var _0x3d4c47=a12_0x4af9a7;_0x176f3c[_0x3d4c47(0xef)]=_0x198bbc;}),__importStar=this&&this[a12_0x4af9a7(0x10c)]||(function(){var _0x540a5b=function(_0x517696){return _0x540a5b=Object['getOwnPropertyNames']||function(_0x88ad7d){var _0x4aa78e=a12_0x3373,_0x2dbe4f=[];for(var _0xa01713 in _0x88ad7d)if(Object['prototype']['hasOwnProperty'][_0x4aa78e(0x10a)](_0x88ad7d,_0xa01713))_0x2dbe4f[_0x2dbe4f[_0x4aa78e(0xe6)]]=_0xa01713;return _0x2dbe4f;},_0x540a5b(_0x517696);};return function(_0x258037){var _0x43d1b7=a12_0x3373;if(_0x258037&&_0x258037[_0x43d1b7(0x10e)])return _0x258037;var _0x104d08={};if(_0x258037!=null){for(var _0x52061c=_0x540a5b(_0x258037),_0x1f566f=0x0;_0x1f566f<_0x52061c[_0x43d1b7(0xe6)];_0x1f566f++)if(_0x52061c[_0x1f566f]!==_0x43d1b7(0xef))__createBinding(_0x104d08,_0x258037,_0x52061c[_0x1f566f]);}return __setModuleDefault(_0x104d08,_0x258037),_0x104d08;};}()),__importDefault=this&&this[a12_0x4af9a7(0xf8)]||function(_0x43aaf7){var _0x104e30=a12_0x4af9a7;return _0x43aaf7&&_0x43aaf7[_0x104e30(0x10e)]?_0x43aaf7:{'default':_0x43aaf7};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a12_0x4af9a7(0x10b)]=void 0x0;const database_1=__importDefault(require(a12_0x4af9a7(0xf9)));class OnRampController{async[a12_0x4af9a7(0x110)](_0x28dea6,_0x13da77){var _0x26018b=a12_0x4af9a7;try{const {paymentId:_0x17ab58,status:_0x30ea55,referenceId:_0x12f86d,transactionHash:_0x5e780e,actualCryptoAmount:_0x34bc1e,orderId:_0x54e02d}=_0x28dea6[_0x26018b(0xe3)];if(!_0x17ab58||!_0x30ea55){_0x13da77[_0x26018b(0x115)](0x190)[_0x26018b(0xf0)]({'success':![],'message':'Payment\x20ID\x20and\x20status\x20are\x20required'});return;}console[_0x26018b(0x125)](_0x26018b(0x117)+_0x17ab58+'\x20->\x20'+_0x30ea55),console[_0x26018b(0x125)]('üìù\x20Data:',{'referenceId':_0x12f86d,'transactionHash':_0x5e780e,'actualCryptoAmount':_0x34bc1e,'orderId':_0x54e02d});const _0x5079fa=await database_1[_0x26018b(0xef)][_0x26018b(0x118)][_0x26018b(0x105)]({'where':{'OR':[{'id':_0x17ab58},{'orderId':_0x17ab58},{'gatewayOrderId':_0x17ab58},{'gatewayPaymentId':_0x17ab58}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5079fa){_0x13da77[_0x26018b(0x115)](0x194)['json']({'success':![],'message':_0x26018b(0x127)});return;}if(_0x5079fa['gateway']!==_0x26018b(0xfa)){_0x13da77[_0x26018b(0x115)](0x190)['json']({'success':![],'message':_0x26018b(0x11b)});return;}const _0x3a24a4={'status':_0x30ea55[_0x26018b(0x100)](),'statusChangedAt':new Date(),'statusChangedBy':'onramp_system'};_0x12f86d&&(_0x3a24a4['gatewayOrderId']=_0x12f86d);_0x5e780e&&(_0x3a24a4[_0x26018b(0xed)]=_0x5e780e);_0x34bc1e&&(_0x3a24a4['invoiceTotalSum']=_0x34bc1e);const _0x44ca92=await database_1['default'][_0x26018b(0x118)]['update']({'where':{'id':_0x5079fa['id']},'data':_0x3a24a4});console[_0x26018b(0x125)]('‚úÖ\x20OnRamp\x20payment\x20'+_0x5079fa['id']+_0x26018b(0xff)+_0x30ea55),_0x30ea55[_0x26018b(0x100)]()===_0x26018b(0xf1)&&_0x5079fa[_0x26018b(0x115)]!=='PAID'&&await this[_0x26018b(0xfe)](_0x5079fa),_0x13da77[_0x26018b(0xf0)]({'success':!![],'message':_0x26018b(0x114),'data':{'paymentId':_0x44ca92['id'],'status':_0x44ca92[_0x26018b(0x115)],'referenceId':_0x12f86d,'transactionHash':_0x5e780e,'actualCryptoAmount':_0x34bc1e}});}catch(_0x3bccf3){console[_0x26018b(0xe4)](_0x26018b(0x111),_0x3bccf3),_0x13da77['status'](0x1f4)[_0x26018b(0xf0)]({'success':![],'message':_0x26018b(0x126),'error':_0x3bccf3 instanceof Error?_0x3bccf3[_0x26018b(0x113)]:_0x26018b(0xeb)});}}async[a12_0x4af9a7(0xfe)](_0x26917b){var _0x1d7547=a12_0x4af9a7;try{console[_0x1d7547(0x125)](_0x1d7547(0xf2)+_0x26917b['id']);let _0x2c9e6b;if(_0x26917b[_0x1d7547(0x11e)]===_0x1d7547(0x124))_0x2c9e6b=_0x26917b[_0x1d7547(0x101)];else{const {currencyService:_0x159825}=await Promise[_0x1d7547(0xf5)]()[_0x1d7547(0xfd)](()=>__importStar(require('../services/currencyService')));_0x2c9e6b=await _0x159825[_0x1d7547(0xec)](_0x26917b[_0x1d7547(0x101)],_0x26917b['currency']);}await database_1[_0x1d7547(0xef)][_0x1d7547(0x118)]['update']({'where':{'id':_0x26917b['id']},'data':{'amountUSDT':_0x2c9e6b,'paidAt':new Date()}});const _0x8add3c=0xa,_0x283e64=_0x2c9e6b*(0x1-_0x8add3c/0x64);await database_1[_0x1d7547(0xef)][_0x1d7547(0x122)]['update']({'where':{'id':_0x26917b['shopId']},'data':{'balance':{'increment':_0x283e64}}}),console[_0x1d7547(0x125)]('‚úÖ\x20Merchant\x20balance\x20updated:\x20+'+_0x283e64['toFixed'](0x6)+'\x20USDT\x20(after\x20'+_0x8add3c+_0x1d7547(0xe9));}catch(_0x187c5e){console[_0x1d7547(0xe4)](_0x1d7547(0x11f),_0x187c5e);}}async[a12_0x4af9a7(0xe8)](_0x34922d,_0x1a8feb){var _0xdef79a=a12_0x4af9a7;try{const {id:_0x4455cd}=_0x34922d[_0xdef79a(0x10f)];if(!_0x4455cd){_0x1a8feb['status'](0x190)[_0xdef79a(0xf0)]({'success':![],'message':_0xdef79a(0x121)});return;}console['log'](_0xdef79a(0x11c)+_0x4455cd);const _0xe5b3fb=await database_1['default'][_0xdef79a(0x118)][_0xdef79a(0x105)]({'where':{'OR':[{'id':_0x4455cd},{'orderId':_0x4455cd},{'gatewayOrderId':_0x4455cd},{'gatewayPaymentId':_0x4455cd}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0xe5b3fb){_0x1a8feb[_0xdef79a(0x115)](0x194)[_0xdef79a(0xf0)]({'success':![],'message':_0xdef79a(0x127)});return;}console[_0xdef79a(0x125)](_0xdef79a(0x11d)+_0xe5b3fb['id']+'\x20('+_0xe5b3fb[_0xdef79a(0x115)]+')'),_0x1a8feb[_0xdef79a(0xf0)]({'success':!![],'data':{'id':_0xe5b3fb['id'],'gateway':_0xe5b3fb[_0xdef79a(0xf7)],'amount':_0xe5b3fb[_0xdef79a(0x101)],'currency':_0xe5b3fb[_0xdef79a(0x11e)],'status':_0xe5b3fb['status'],'gatewayOrderId':_0xe5b3fb[_0xdef79a(0x107)],'gatewayPaymentId':_0xe5b3fb[_0xdef79a(0xed)],'successUrl':_0xe5b3fb[_0xdef79a(0xe2)],'failUrl':_0xe5b3fb[_0xdef79a(0xfc)],'pendingUrl':_0xe5b3fb['pendingUrl'],'customerEmail':_0xe5b3fb[_0xdef79a(0x11a)],'customerName':_0xe5b3fb[_0xdef79a(0x119)],'merchantBrand':_0xe5b3fb['shop'][_0xdef79a(0x112)],'createdAt':_0xe5b3fb['createdAt'],'updatedAt':_0xe5b3fb[_0xdef79a(0xe0)]}});}catch(_0x74d5f0){console[_0xdef79a(0xe4)](_0xdef79a(0x104),_0x74d5f0),_0x1a8feb[_0xdef79a(0x115)](0x1f4)[_0xdef79a(0xf0)]({'success':![],'message':'Internal\x20server\x20error','error':_0x74d5f0 instanceof Error?_0x74d5f0[_0xdef79a(0x113)]:_0xdef79a(0xeb)});}}}exports[a12_0x4af9a7(0x10b)]=OnRampController;