'use strict';var a12_0x464b47=a12_0x2402;function a12_0x2402(_0x585fe8,_0x28763c){_0x585fe8=_0x585fe8-0x134;var _0x4b6062=a12_0x4b60();var _0x24020b=_0x4b6062[_0x585fe8];return _0x24020b;}(function(_0x4d9df4,_0x597111){var _0x1c0c49=a12_0x2402,_0x4ffc48=_0x4d9df4();while(!![]){try{var _0x167a55=-parseInt(_0x1c0c49(0x166))/0x1*(-parseInt(_0x1c0c49(0x170))/0x2)+-parseInt(_0x1c0c49(0x154))/0x3+parseInt(_0x1c0c49(0x15b))/0x4*(parseInt(_0x1c0c49(0x16d))/0x5)+parseInt(_0x1c0c49(0x15f))/0x6*(-parseInt(_0x1c0c49(0x140))/0x7)+-parseInt(_0x1c0c49(0x159))/0x8+parseInt(_0x1c0c49(0x13f))/0x9+parseInt(_0x1c0c49(0x155))/0xa;if(_0x167a55===_0x597111)break;else _0x4ffc48['push'](_0x4ffc48['shift']());}catch(_0x182732){_0x4ffc48['push'](_0x4ffc48['shift']());}}}(a12_0x4b60,0x7e1c9));var __createBinding=this&&this[a12_0x464b47(0x16e)]||(Object['create']?function(_0x44c044,_0x3c1899,_0x4cc52f,_0x2aa6ba){var _0x2954d4=a12_0x464b47;if(_0x2aa6ba===undefined)_0x2aa6ba=_0x4cc52f;var _0x4a5f4e=Object['getOwnPropertyDescriptor'](_0x3c1899,_0x4cc52f);(!_0x4a5f4e||(_0x2954d4(0x139)in _0x4a5f4e?!_0x3c1899[_0x2954d4(0x14c)]:_0x4a5f4e[_0x2954d4(0x178)]||_0x4a5f4e[_0x2954d4(0x13a)]))&&(_0x4a5f4e={'enumerable':!![],'get':function(){return _0x3c1899[_0x4cc52f];}}),Object[_0x2954d4(0x175)](_0x44c044,_0x2aa6ba,_0x4a5f4e);}:function(_0xfca1b5,_0x35a959,_0x4b688a,_0x5838e0){if(_0x5838e0===undefined)_0x5838e0=_0x4b688a;_0xfca1b5[_0x5838e0]=_0x35a959[_0x4b688a];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x31945a,_0x76ca6d){var _0x258e7f=a12_0x464b47;Object[_0x258e7f(0x175)](_0x31945a,_0x258e7f(0x169),{'enumerable':!![],'value':_0x76ca6d});}:function(_0x276e26,_0x3c3189){var _0xfc80da=a12_0x464b47;_0x276e26[_0xfc80da(0x169)]=_0x3c3189;}),__importStar=this&&this['__importStar']||(function(){var _0x51ba3c=function(_0xe7d098){var _0x4afe5e=a12_0x2402;return _0x51ba3c=Object[_0x4afe5e(0x14a)]||function(_0x27bc14){var _0x2af386=_0x4afe5e,_0x3bdc0f=[];for(var _0x886c1e in _0x27bc14)if(Object[_0x2af386(0x145)][_0x2af386(0x136)][_0x2af386(0x14b)](_0x27bc14,_0x886c1e))_0x3bdc0f[_0x3bdc0f[_0x2af386(0x165)]]=_0x886c1e;return _0x3bdc0f;},_0x51ba3c(_0xe7d098);};return function(_0x2c1545){var _0x418438=a12_0x2402;if(_0x2c1545&&_0x2c1545[_0x418438(0x14c)])return _0x2c1545;var _0x5a1f6b={};if(_0x2c1545!=null){for(var _0x211418=_0x51ba3c(_0x2c1545),_0xe6d05=0x0;_0xe6d05<_0x211418['length'];_0xe6d05++)if(_0x211418[_0xe6d05]!==_0x418438(0x169))__createBinding(_0x5a1f6b,_0x2c1545,_0x211418[_0xe6d05]);}return __setModuleDefault(_0x5a1f6b,_0x2c1545),_0x5a1f6b;};}()),__importDefault=this&&this[a12_0x464b47(0x17d)]||function(_0x469ff2){var _0xd5dced=a12_0x464b47;return _0x469ff2&&_0x469ff2[_0xd5dced(0x14c)]?_0x469ff2:{'default':_0x469ff2};};Object[a12_0x464b47(0x175)](exports,'__esModule',{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require(a12_0x464b47(0x16f)));class OnRampController{async['updatePaymentStatus'](_0x1a90cd,_0x3dc425){var _0x1627d7=a12_0x464b47;try{const {paymentId:_0x1eef7e,status:_0x110d45,referenceId:_0x3ffb8c,transactionHash:_0x377c51,actualCryptoAmount:_0x9d1195,orderId:_0xd3339e}=_0x1a90cd['body'];if(!_0x1eef7e||!_0x110d45){_0x3dc425['status'](0x190)[_0x1627d7(0x171)]({'success':![],'message':_0x1627d7(0x15d)});return;}console[_0x1627d7(0x14e)]('üöÄ\x20OnRamp\x20status\x20update:\x20'+_0x1eef7e+_0x1627d7(0x146)+_0x110d45),console[_0x1627d7(0x14e)](_0x1627d7(0x17c),{'referenceId':_0x3ffb8c,'transactionHash':_0x377c51,'actualCryptoAmount':_0x9d1195,'orderId':_0xd3339e});const _0x5671e5=await database_1[_0x1627d7(0x169)][_0x1627d7(0x144)][_0x1627d7(0x143)]({'where':{'OR':[{'id':_0x1eef7e},{'orderId':_0x1eef7e},{'gatewayOrderId':_0x1eef7e},{'gatewayPaymentId':_0x1eef7e}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5671e5){_0x3dc425['status'](0x194)[_0x1627d7(0x171)]({'success':![],'message':_0x1627d7(0x14d)});return;}if(_0x5671e5[_0x1627d7(0x142)]!==_0x1627d7(0x176)){_0x3dc425[_0x1627d7(0x162)](0x190)[_0x1627d7(0x171)]({'success':![],'message':_0x1627d7(0x151)});return;}const _0x323200={'status':_0x110d45[_0x1627d7(0x13e)](),'statusChangedAt':new Date(),'statusChangedBy':_0x1627d7(0x149)};_0x3ffb8c&&(_0x323200['gatewayOrderId']=_0x3ffb8c);_0x377c51&&(_0x323200[_0x1627d7(0x160)]=_0x377c51);_0x9d1195&&(_0x323200['invoiceTotalSum']=_0x9d1195);const _0x3057b0=await database_1[_0x1627d7(0x169)][_0x1627d7(0x144)][_0x1627d7(0x13b)]({'where':{'id':_0x5671e5['id']},'data':_0x323200});console[_0x1627d7(0x14e)](_0x1627d7(0x15a)+_0x5671e5['id']+_0x1627d7(0x152)+_0x110d45),_0x110d45[_0x1627d7(0x13e)]()===_0x1627d7(0x14f)&&_0x5671e5['status']!==_0x1627d7(0x14f)&&await this[_0x1627d7(0x137)](_0x5671e5),_0x3dc425[_0x1627d7(0x171)]({'success':!![],'message':_0x1627d7(0x13d),'data':{'paymentId':_0x3057b0['id'],'status':_0x3057b0['status'],'referenceId':_0x3ffb8c,'transactionHash':_0x377c51,'actualCryptoAmount':_0x9d1195}});}catch(_0x5b27df){console[_0x1627d7(0x172)](_0x1627d7(0x17b),_0x5b27df),_0x3dc425[_0x1627d7(0x162)](0x1f4)[_0x1627d7(0x171)]({'success':![],'message':_0x1627d7(0x158),'error':_0x5b27df instanceof Error?_0x5b27df['message']:_0x1627d7(0x138)});}}async[a12_0x464b47(0x137)](_0x584279){var _0x555157=a12_0x464b47;try{console['log'](_0x555157(0x167)+_0x584279['id']);let _0x2623e0;if(_0x584279['currency']===_0x555157(0x134))_0x2623e0=_0x584279[_0x555157(0x135)];else{const {currencyService:_0x9e0cd9}=await Promise['resolve']()[_0x555157(0x164)](()=>__importStar(require('../services/currencyService')));_0x2623e0=await _0x9e0cd9[_0x555157(0x17a)](_0x584279[_0x555157(0x135)],_0x584279[_0x555157(0x16b)]);}await database_1[_0x555157(0x169)][_0x555157(0x144)][_0x555157(0x13b)]({'where':{'id':_0x584279['id']},'data':{'amountUSDT':_0x2623e0,'paidAt':new Date()}});const _0x21ac32=0xa,_0x313318=_0x2623e0*(0x1-_0x21ac32/0x64);await database_1[_0x555157(0x169)][_0x555157(0x161)][_0x555157(0x13b)]({'where':{'id':_0x584279['shopId']},'data':{'balance':{'increment':_0x313318}}}),console[_0x555157(0x14e)]('‚úÖ\x20Merchant\x20balance\x20updated:\x20+'+_0x313318[_0x555157(0x147)](0x6)+_0x555157(0x15e)+_0x21ac32+_0x555157(0x157));}catch(_0x44e2c4){console[_0x555157(0x172)](_0x555157(0x150),_0x44e2c4);}}async[a12_0x464b47(0x16c)](_0x113eee,_0x3418d2){var _0x3c3120=a12_0x464b47;try{const {id:_0x119aa4}=_0x113eee[_0x3c3120(0x174)];if(!_0x119aa4){_0x3418d2[_0x3c3120(0x162)](0x190)[_0x3c3120(0x171)]({'success':![],'message':'Payment\x20ID\x20is\x20required'});return;}console[_0x3c3120(0x14e)](_0x3c3120(0x148)+_0x119aa4);const _0x3ae28e=await database_1[_0x3c3120(0x169)][_0x3c3120(0x144)][_0x3c3120(0x143)]({'where':{'OR':[{'id':_0x119aa4},{'orderId':_0x119aa4},{'gatewayOrderId':_0x119aa4},{'gatewayPaymentId':_0x119aa4}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x3ae28e){_0x3418d2['status'](0x194)[_0x3c3120(0x171)]({'success':![],'message':_0x3c3120(0x14d)});return;}console['log'](_0x3c3120(0x16a)+_0x3ae28e['id']+'\x20('+_0x3ae28e[_0x3c3120(0x162)]+')'),_0x3418d2[_0x3c3120(0x171)]({'success':!![],'data':{'id':_0x3ae28e['id'],'gateway':_0x3ae28e['gateway'],'amount':_0x3ae28e[_0x3c3120(0x135)],'currency':_0x3ae28e[_0x3c3120(0x16b)],'status':_0x3ae28e['status'],'gatewayOrderId':_0x3ae28e[_0x3c3120(0x13c)],'gatewayPaymentId':_0x3ae28e[_0x3c3120(0x160)],'successUrl':_0x3ae28e[_0x3c3120(0x168)],'failUrl':_0x3ae28e[_0x3c3120(0x173)],'pendingUrl':_0x3ae28e[_0x3c3120(0x163)],'customerEmail':_0x3ae28e[_0x3c3120(0x141)],'customerName':_0x3ae28e['customerName'],'merchantBrand':_0x3ae28e['shop']['name'],'createdAt':_0x3ae28e[_0x3c3120(0x153)],'updatedAt':_0x3ae28e[_0x3c3120(0x179)]}});}catch(_0xedd058){console[_0x3c3120(0x172)](_0x3c3120(0x177),_0xedd058),_0x3418d2[_0x3c3120(0x162)](0x1f4)['json']({'success':![],'message':_0x3c3120(0x158),'error':_0xedd058 instanceof Error?_0xedd058[_0x3c3120(0x156)]:_0x3c3120(0x138)});}}}exports[a12_0x464b47(0x15c)]=OnRampController;function a12_0x4b60(){var _0x5a39b7=['log','PAID','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','\x20updated\x20to\x20','createdAt','2341320ubITNc','5351690geVwQn','message','%\x20commission)','Internal\x20server\x20error','4278416sJCQUL','‚úÖ\x20OnRamp\x20payment\x20','20BuXTmU','OnRampController','Payment\x20ID\x20and\x20status\x20are\x20required','\x20USDT\x20(after\x20','106218DgUPjI','gatewayPaymentId','shop','status','pendingUrl','then','length','452351SvMYgT','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','successUrl','default','‚úÖ\x20Found\x20payment:\x20','currency','getPaymentData','1030205tiDbRn','__createBinding','../config/database','2VMYOHy','json','error','failUrl','params','defineProperty','onramp','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','writable','updatedAt','convertToUSDT','‚ùå\x20OnRamp\x20status\x20update\x20error:','üìù\x20Data:','__importDefault','USD','amount','hasOwnProperty','updateMerchantBalanceForPaidPayment','Unknown\x20error','get','configurable','update','gatewayOrderId','Payment\x20status\x20updated\x20successfully','toUpperCase','4540383osbQlc','273xbKFab','customerEmail','gateway','findFirst','payment','prototype','\x20->\x20','toFixed','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','onramp_system','getOwnPropertyNames','call','__esModule','Payment\x20not\x20found'];a12_0x4b60=function(){return _0x5a39b7;};return a12_0x4b60();}