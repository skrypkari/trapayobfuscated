'use strict';var a13_0x191006=a13_0x8b5d;(function(_0x5b9055,_0x510e62){var _0x5d59de=a13_0x8b5d,_0x4a9484=_0x5b9055();while(!![]){try{var _0x4f4714=parseInt(_0x5d59de(0x15c))/0x1*(parseInt(_0x5d59de(0x142))/0x2)+parseInt(_0x5d59de(0x162))/0x3+-parseInt(_0x5d59de(0x14d))/0x4*(parseInt(_0x5d59de(0x127))/0x5)+parseInt(_0x5d59de(0x145))/0x6+parseInt(_0x5d59de(0x167))/0x7*(parseInt(_0x5d59de(0x13e))/0x8)+parseInt(_0x5d59de(0x157))/0x9*(-parseInt(_0x5d59de(0x12f))/0xa)+-parseInt(_0x5d59de(0x140))/0xb;if(_0x4f4714===_0x510e62)break;else _0x4a9484['push'](_0x4a9484['shift']());}catch(_0x191622){_0x4a9484['push'](_0x4a9484['shift']());}}}(a13_0x3763,0x5ef34));var __createBinding=this&&this[a13_0x191006(0x14a)]||(Object['create']?function(_0x46e5a0,_0x2ff4f4,_0xce9259,_0xc4d7e1){var _0x3618f4=a13_0x191006;if(_0xc4d7e1===undefined)_0xc4d7e1=_0xce9259;var _0x39f554=Object[_0x3618f4(0x14b)](_0x2ff4f4,_0xce9259);(!_0x39f554||(_0x3618f4(0x12a)in _0x39f554?!_0x2ff4f4['__esModule']:_0x39f554['writable']||_0x39f554[_0x3618f4(0x16e)]))&&(_0x39f554={'enumerable':!![],'get':function(){return _0x2ff4f4[_0xce9259];}}),Object[_0x3618f4(0x135)](_0x46e5a0,_0xc4d7e1,_0x39f554);}:function(_0x47f231,_0x122d50,_0x3e3557,_0x5d5980){if(_0x5d5980===undefined)_0x5d5980=_0x3e3557;_0x47f231[_0x5d5980]=_0x122d50[_0x3e3557];}),__setModuleDefault=this&&this[a13_0x191006(0x16a)]||(Object[a13_0x191006(0x139)]?function(_0x145677,_0x3bbdd1){var _0x2aa2e6=a13_0x191006;Object[_0x2aa2e6(0x135)](_0x145677,_0x2aa2e6(0x150),{'enumerable':!![],'value':_0x3bbdd1});}:function(_0x2b56a6,_0x5cbfac){var _0x58f1a2=a13_0x191006;_0x2b56a6[_0x58f1a2(0x150)]=_0x5cbfac;}),__importStar=this&&this[a13_0x191006(0x146)]||(function(){var _0x7cb125=function(_0x4cf5b8){var _0x3bffe2=a13_0x8b5d;return _0x7cb125=Object[_0x3bffe2(0x13c)]||function(_0x1c2064){var _0x54330b=_0x3bffe2,_0x459360=[];for(var _0x188ef1 in _0x1c2064)if(Object[_0x54330b(0x132)]['hasOwnProperty'][_0x54330b(0x16f)](_0x1c2064,_0x188ef1))_0x459360[_0x459360['length']]=_0x188ef1;return _0x459360;},_0x7cb125(_0x4cf5b8);};return function(_0xb86385){var _0x2aa510=a13_0x8b5d;if(_0xb86385&&_0xb86385[_0x2aa510(0x170)])return _0xb86385;var _0x5a7fb0={};if(_0xb86385!=null){for(var _0x56d8f7=_0x7cb125(_0xb86385),_0x192b18=0x0;_0x192b18<_0x56d8f7['length'];_0x192b18++)if(_0x56d8f7[_0x192b18]!==_0x2aa510(0x150))__createBinding(_0x5a7fb0,_0xb86385,_0x56d8f7[_0x192b18]);}return __setModuleDefault(_0x5a7fb0,_0xb86385),_0x5a7fb0;};}()),__importDefault=this&&this['__importDefault']||function(_0x223ea0){var _0x4d4e7c=a13_0x191006;return _0x223ea0&&_0x223ea0[_0x4d4e7c(0x170)]?_0x223ea0:{'default':_0x223ea0};};Object['defineProperty'](exports,a13_0x191006(0x170),{'value':!![]}),exports[a13_0x191006(0x160)]=void 0x0;function a13_0x8b5d(_0x333594,_0x199d0f){_0x333594=_0x333594-0x127;var _0x37635a=a13_0x3763();var _0x8b5dbd=_0x37635a[_0x333594];return _0x8b5dbd;}const database_1=__importDefault(require(a13_0x191006(0x152)));class OnRampController{async[a13_0x191006(0x13d)](_0x1ba3b4,_0x555c03){var _0x30aad5=a13_0x191006;try{const {paymentId:_0x589f0d,status:_0x23b003,referenceId:_0x1a968f,transactionHash:_0x303abb,actualCryptoAmount:_0x103027,orderId:_0x18da2f}=_0x1ba3b4[_0x30aad5(0x128)];if(!_0x589f0d||!_0x23b003){_0x555c03[_0x30aad5(0x14f)](0x190)[_0x30aad5(0x15f)]({'success':![],'message':_0x30aad5(0x14e)});return;}console[_0x30aad5(0x15b)]('üöÄ\x20OnRamp\x20status\x20update:\x20'+_0x589f0d+'\x20->\x20'+_0x23b003),console[_0x30aad5(0x15b)](_0x30aad5(0x131),{'referenceId':_0x1a968f,'transactionHash':_0x303abb,'actualCryptoAmount':_0x103027,'orderId':_0x18da2f});const _0xe6fcf=await database_1['default'][_0x30aad5(0x12e)]['findFirst']({'where':{'OR':[{'id':_0x589f0d},{'orderId':_0x589f0d},{'gatewayOrderId':_0x589f0d},{'gatewayPaymentId':_0x589f0d}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0xe6fcf){_0x555c03[_0x30aad5(0x14f)](0x194)[_0x30aad5(0x15f)]({'success':![],'message':_0x30aad5(0x168)});return;}if(_0xe6fcf[_0x30aad5(0x144)]!==_0x30aad5(0x12d)){_0x555c03[_0x30aad5(0x14f)](0x190)[_0x30aad5(0x15f)]({'success':![],'message':'This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway'});return;}const _0x24e50c={'status':_0x23b003['toUpperCase'](),'statusChangedAt':new Date(),'statusChangedBy':'onramp_system'};_0x1a968f&&(_0x24e50c[_0x30aad5(0x147)]=_0x1a968f);_0x303abb&&(_0x24e50c[_0x30aad5(0x130)]=_0x303abb);_0x103027&&(_0x24e50c[_0x30aad5(0x163)]=_0x103027);const _0x1adf6f=await database_1[_0x30aad5(0x150)]['payment']['update']({'where':{'id':_0xe6fcf['id']},'data':_0x24e50c});console['log'](_0x30aad5(0x149)+_0xe6fcf['id']+_0x30aad5(0x16d)+_0x23b003),_0x23b003[_0x30aad5(0x14c)]()==='PAID'&&_0xe6fcf[_0x30aad5(0x14f)]!=='PAID'&&await this['updateMerchantBalanceForPaidPayment'](_0xe6fcf),_0x555c03[_0x30aad5(0x15f)]({'success':!![],'message':_0x30aad5(0x13b),'data':{'paymentId':_0x1adf6f['id'],'status':_0x1adf6f[_0x30aad5(0x14f)],'referenceId':_0x1a968f,'transactionHash':_0x303abb,'actualCryptoAmount':_0x103027}});}catch(_0x4d29b0){console[_0x30aad5(0x159)](_0x30aad5(0x13a),_0x4d29b0),_0x555c03[_0x30aad5(0x14f)](0x1f4)[_0x30aad5(0x15f)]({'success':![],'message':_0x30aad5(0x134),'error':_0x4d29b0 instanceof Error?_0x4d29b0[_0x30aad5(0x16b)]:_0x30aad5(0x151)});}}async[a13_0x191006(0x166)](_0x138444){var _0x206e2b=a13_0x191006;try{console[_0x206e2b(0x15b)](_0x206e2b(0x15e)+_0x138444['id']);let _0x2adff3;if(_0x138444['currency']===_0x206e2b(0x143))_0x2adff3=_0x138444[_0x206e2b(0x12b)];else{const {currencyService:_0x45aeb0}=await Promise['resolve']()[_0x206e2b(0x156)](()=>__importStar(require(_0x206e2b(0x138))));_0x2adff3=await _0x45aeb0[_0x206e2b(0x169)](_0x138444['amount'],_0x138444[_0x206e2b(0x137)]);}await database_1[_0x206e2b(0x150)][_0x206e2b(0x12e)][_0x206e2b(0x136)]({'where':{'id':_0x138444['id']},'data':{'amountUSDT':_0x2adff3,'paidAt':new Date()}});const _0x590f55=0xa,_0x5d44b0=_0x2adff3*(0x1-_0x590f55/0x64);await database_1[_0x206e2b(0x150)][_0x206e2b(0x129)][_0x206e2b(0x136)]({'where':{'id':_0x138444['shopId']},'data':{'balance':{'increment':_0x5d44b0}}}),console['log']('‚úÖ\x20Merchant\x20balance\x20updated:\x20+'+_0x5d44b0[_0x206e2b(0x16c)](0x6)+_0x206e2b(0x141)+_0x590f55+_0x206e2b(0x12c));}catch(_0x29ffb9){console[_0x206e2b(0x159)](_0x206e2b(0x154),_0x29ffb9);}}async['getPaymentData'](_0x2c5b10,_0x33923d){var _0x573a10=a13_0x191006;try{const {id:_0x1f95d6}=_0x2c5b10[_0x573a10(0x165)];if(!_0x1f95d6){_0x33923d['status'](0x190)[_0x573a10(0x15f)]({'success':![],'message':'Payment\x20ID\x20is\x20required'});return;}console[_0x573a10(0x15b)]('üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20'+_0x1f95d6);const _0x224619=await database_1['default'][_0x573a10(0x12e)][_0x573a10(0x15a)]({'where':{'OR':[{'id':_0x1f95d6},{'orderId':_0x1f95d6},{'gatewayOrderId':_0x1f95d6},{'gatewayPaymentId':_0x1f95d6}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x224619){_0x33923d[_0x573a10(0x14f)](0x194)[_0x573a10(0x15f)]({'success':![],'message':_0x573a10(0x168)});return;}console[_0x573a10(0x15b)](_0x573a10(0x161)+_0x224619['id']+'\x20('+_0x224619[_0x573a10(0x14f)]+')'),_0x33923d['json']({'success':!![],'data':{'id':_0x224619['id'],'gateway':_0x224619[_0x573a10(0x144)],'amount':_0x224619[_0x573a10(0x12b)],'currency':_0x224619[_0x573a10(0x137)],'status':_0x224619['status'],'gatewayOrderId':_0x224619['gatewayOrderId'],'gatewayPaymentId':_0x224619[_0x573a10(0x130)],'successUrl':_0x224619[_0x573a10(0x133)],'failUrl':_0x224619[_0x573a10(0x153)],'pendingUrl':_0x224619[_0x573a10(0x171)],'customerEmail':_0x224619[_0x573a10(0x13f)],'customerName':_0x224619[_0x573a10(0x164)],'merchantBrand':_0x224619[_0x573a10(0x129)][_0x573a10(0x158)],'createdAt':_0x224619[_0x573a10(0x15d)],'updatedAt':_0x224619[_0x573a10(0x155)]}});}catch(_0x10e053){console[_0x573a10(0x159)](_0x573a10(0x148),_0x10e053),_0x33923d[_0x573a10(0x14f)](0x1f4)[_0x573a10(0x15f)]({'success':![],'message':_0x573a10(0x134),'error':_0x10e053 instanceof Error?_0x10e053[_0x573a10(0x16b)]:_0x573a10(0x151)});}}}function a13_0x3763(){var _0x28e351=['getOwnPropertyNames','updatePaymentStatus','44712DryLsw','customerEmail','13975995Mxwdhq','\x20USDT\x20(after\x20','1182304hfeGpc','USD','gateway','1050684XXRfWA','__importStar','gatewayOrderId','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','‚úÖ\x20OnRamp\x20payment\x20','__createBinding','getOwnPropertyDescriptor','toUpperCase','172WeACxv','Payment\x20ID\x20and\x20status\x20are\x20required','status','default','Unknown\x20error','../config/database','failUrl','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','updatedAt','then','42129PolBwM','name','error','findFirst','log','1xFEywE','createdAt','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','json','OnRampController','‚úÖ\x20Found\x20payment:\x20','1982085hqDCdk','invoiceTotalSum','customerName','params','updateMerchantBalanceForPaidPayment','714Tuuvvb','Payment\x20not\x20found','convertToUSDT','__setModuleDefault','message','toFixed','\x20updated\x20to\x20','configurable','call','__esModule','pendingUrl','2785mMtpLL','body','shop','get','amount','%\x20commission)','onramp','payment','670iVZsle','gatewayPaymentId','üìù\x20Data:','prototype','successUrl','Internal\x20server\x20error','defineProperty','update','currency','../services/currencyService','create','‚ùå\x20OnRamp\x20status\x20update\x20error:','Payment\x20status\x20updated\x20successfully'];a13_0x3763=function(){return _0x28e351;};return a13_0x3763();}exports[a13_0x191006(0x160)]=OnRampController;