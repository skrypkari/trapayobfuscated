'use strict';var a13_0x10f345=a13_0x17aa;function a13_0x103c(){var _0xfe911e=['7956144SzwCWy','1749051GRwfds','customerName','invoiceTotalSum','\x20USDT\x20(after\x20','üìù\x20Data:','pendingUrl','975006dSLnEe','Payment\x20ID\x20and\x20status\x20are\x20required','onramp_system','__importStar','params','updateMerchantBalanceForPaidPayment','error','currency','3gbhlGF','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','PAID','failUrl','‚úÖ\x20Found\x20payment:\x20','toUpperCase','create','../config/database','üöÄ\x20OnRamp\x20status\x20update:\x20','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','findFirst','‚ùå\x20OnRamp\x20status\x20update\x20error:','default','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','updatePaymentStatus','‚úÖ\x20OnRamp\x20payment\x20','Payment\x20status\x20updated\x20successfully','Unknown\x20error','defineProperty','181784moUaOp','updatedAt','2263672bBKCbg','shop','name','status','update','../services/currencyService','__esModule','7467186pZedPm','convertToUSDT','5dObLBr','amount','160EPapWx','json','gateway','hasOwnProperty','gatewayOrderId','getPaymentData','getOwnPropertyNames','Internal\x20server\x20error','call','log','prototype','length','\x20->\x20','writable','__importDefault','gatewayPaymentId','payment','Payment\x20not\x20found','11659128qqiKya','onramp','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','getOwnPropertyDescriptor','\x20updated\x20to\x20'];a13_0x103c=function(){return _0xfe911e;};return a13_0x103c();}(function(_0x1822e8,_0x111766){var _0xc1f153=a13_0x17aa,_0x2fbf23=_0x1822e8();while(!![]){try{var _0x250f99=-parseInt(_0xc1f153(0x203))/0x1+parseInt(_0xc1f153(0x1d7))/0x2+-parseInt(_0xc1f153(0x20b))/0x3*(parseInt(_0xc1f153(0x1d9))/0x4)+parseInt(_0xc1f153(0x1e2))/0x5*(-parseInt(_0xc1f153(0x1e0))/0x6)+-parseInt(_0xc1f153(0x1fc))/0x7+parseInt(_0xc1f153(0x1f6))/0x8+-parseInt(_0xc1f153(0x1fd))/0x9*(-parseInt(_0xc1f153(0x1e4))/0xa);if(_0x250f99===_0x111766)break;else _0x2fbf23['push'](_0x2fbf23['shift']());}catch(_0x13e6b9){_0x2fbf23['push'](_0x2fbf23['shift']());}}}(a13_0x103c,0xb39ac));var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x30d512,_0x2a570e,_0x19bbcf,_0x47b578){var _0x4e7bf7=a13_0x17aa;if(_0x47b578===undefined)_0x47b578=_0x19bbcf;var _0x27fe20=Object[_0x4e7bf7(0x1fa)](_0x2a570e,_0x19bbcf);(!_0x27fe20||('get'in _0x27fe20?!_0x2a570e['__esModule']:_0x27fe20[_0x4e7bf7(0x1f1)]||_0x27fe20['configurable']))&&(_0x27fe20={'enumerable':!![],'get':function(){return _0x2a570e[_0x19bbcf];}}),Object[_0x4e7bf7(0x1d6)](_0x30d512,_0x47b578,_0x27fe20);}:function(_0x28fb0f,_0x25e9d1,_0x3a1af5,_0x15c1e0){if(_0x15c1e0===undefined)_0x15c1e0=_0x3a1af5;_0x28fb0f[_0x15c1e0]=_0x25e9d1[_0x3a1af5];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a13_0x10f345(0x211)]?function(_0x19383b,_0x5ab8b0){var _0x4277fe=a13_0x10f345;Object['defineProperty'](_0x19383b,_0x4277fe(0x1d0),{'enumerable':!![],'value':_0x5ab8b0});}:function(_0x54a7b2,_0x1d332e){var _0x46391b=a13_0x10f345;_0x54a7b2[_0x46391b(0x1d0)]=_0x1d332e;}),__importStar=this&&this[a13_0x10f345(0x206)]||(function(){var _0x26daf6=function(_0x409348){var _0x3a99c4=a13_0x17aa;return _0x26daf6=Object[_0x3a99c4(0x1ea)]||function(_0x563fc9){var _0x16e1b4=_0x3a99c4,_0x145c4f=[];for(var _0x1b937 in _0x563fc9)if(Object[_0x16e1b4(0x1ee)][_0x16e1b4(0x1e7)][_0x16e1b4(0x1ec)](_0x563fc9,_0x1b937))_0x145c4f[_0x145c4f[_0x16e1b4(0x1ef)]]=_0x1b937;return _0x145c4f;},_0x26daf6(_0x409348);};return function(_0x2d47ff){var _0x268ea5=a13_0x17aa;if(_0x2d47ff&&_0x2d47ff[_0x268ea5(0x1df)])return _0x2d47ff;var _0x261180={};if(_0x2d47ff!=null){for(var _0x151ed4=_0x26daf6(_0x2d47ff),_0x307d56=0x0;_0x307d56<_0x151ed4['length'];_0x307d56++)if(_0x151ed4[_0x307d56]!==_0x268ea5(0x1d0))__createBinding(_0x261180,_0x2d47ff,_0x151ed4[_0x307d56]);}return __setModuleDefault(_0x261180,_0x2d47ff),_0x261180;};}()),__importDefault=this&&this[a13_0x10f345(0x1f2)]||function(_0xb86a18){var _0xd6792f=a13_0x10f345;return _0xb86a18&&_0xb86a18[_0xd6792f(0x1df)]?_0xb86a18:{'default':_0xb86a18};};function a13_0x17aa(_0x1d994,_0x2a22a9){_0x1d994=_0x1d994-0x1ce;var _0x103cbc=a13_0x103c();var _0x17aaad=_0x103cbc[_0x1d994];return _0x17aaad;}Object['defineProperty'](exports,a13_0x10f345(0x1df),{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require(a13_0x10f345(0x212)));class OnRampController{async[a13_0x10f345(0x1d2)](_0x283163,_0x4d6368){var _0x5984b0=a13_0x10f345;try{const {paymentId:_0x42e722,status:_0x1fdaa4,referenceId:_0x23ea86,transactionHash:_0x42e875,actualCryptoAmount:_0x5eb4c8,orderId:_0x57e19a}=_0x283163['body'];if(!_0x42e722||!_0x1fdaa4){_0x4d6368[_0x5984b0(0x1dc)](0x190)[_0x5984b0(0x1e5)]({'success':![],'message':_0x5984b0(0x204)});return;}console[_0x5984b0(0x1ed)](_0x5984b0(0x213)+_0x42e722+_0x5984b0(0x1f0)+_0x1fdaa4),console['log'](_0x5984b0(0x201),{'referenceId':_0x23ea86,'transactionHash':_0x42e875,'actualCryptoAmount':_0x5eb4c8,'orderId':_0x57e19a});const _0x2d7083=await database_1[_0x5984b0(0x1d0)][_0x5984b0(0x1f4)][_0x5984b0(0x1ce)]({'where':{'OR':[{'id':_0x42e722},{'orderId':_0x42e722},{'gatewayOrderId':_0x42e722},{'gatewayPaymentId':_0x42e722}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2d7083){_0x4d6368[_0x5984b0(0x1dc)](0x194)[_0x5984b0(0x1e5)]({'success':![],'message':_0x5984b0(0x1f5)});return;}if(_0x2d7083['gateway']!==_0x5984b0(0x1f7)){_0x4d6368['status'](0x190)['json']({'success':![],'message':_0x5984b0(0x214)});return;}const _0x910e29={'status':_0x1fdaa4[_0x5984b0(0x210)](),'statusChangedAt':new Date(),'statusChangedBy':_0x5984b0(0x205)};_0x23ea86&&(_0x910e29['gatewayOrderId']=_0x23ea86);_0x42e875&&(_0x910e29['gatewayPaymentId']=_0x42e875);_0x5eb4c8&&(_0x910e29[_0x5984b0(0x1ff)]=_0x5eb4c8);const _0x5881dd=await database_1[_0x5984b0(0x1d0)][_0x5984b0(0x1f4)]['update']({'where':{'id':_0x2d7083['id']},'data':_0x910e29});console[_0x5984b0(0x1ed)](_0x5984b0(0x1d3)+_0x2d7083['id']+_0x5984b0(0x1fb)+_0x1fdaa4),_0x1fdaa4[_0x5984b0(0x210)]()===_0x5984b0(0x20d)&&_0x2d7083[_0x5984b0(0x1dc)]!==_0x5984b0(0x20d)&&await this[_0x5984b0(0x208)](_0x2d7083),_0x4d6368[_0x5984b0(0x1e5)]({'success':!![],'message':_0x5984b0(0x1d4),'data':{'paymentId':_0x5881dd['id'],'status':_0x5881dd[_0x5984b0(0x1dc)],'referenceId':_0x23ea86,'transactionHash':_0x42e875,'actualCryptoAmount':_0x5eb4c8}});}catch(_0x2febda){console[_0x5984b0(0x209)](_0x5984b0(0x1cf),_0x2febda),_0x4d6368['status'](0x1f4)[_0x5984b0(0x1e5)]({'success':![],'message':_0x5984b0(0x1eb),'error':_0x2febda instanceof Error?_0x2febda['message']:_0x5984b0(0x1d5)});}}async['updateMerchantBalanceForPaidPayment'](_0x53abca){var _0x337664=a13_0x10f345;try{console[_0x337664(0x1ed)](_0x337664(0x1d1)+_0x53abca['id']);let _0x2de634;if(_0x53abca['currency']==='USD')_0x2de634=_0x53abca[_0x337664(0x1e3)];else{const {currencyService:_0x25740e}=await Promise['resolve']()['then'](()=>__importStar(require(_0x337664(0x1de))));_0x2de634=await _0x25740e[_0x337664(0x1e1)](_0x53abca['amount'],_0x53abca[_0x337664(0x20a)]);}await database_1[_0x337664(0x1d0)]['payment'][_0x337664(0x1dd)]({'where':{'id':_0x53abca['id']},'data':{'amountUSDT':_0x2de634,'paidAt':new Date()}});const _0x6bac24=0xa,_0x3dd6b1=_0x2de634*(0x1-_0x6bac24/0x64);await database_1['default'][_0x337664(0x1da)][_0x337664(0x1dd)]({'where':{'id':_0x53abca['shopId']},'data':{'balance':{'increment':_0x3dd6b1}}}),console[_0x337664(0x1ed)](_0x337664(0x1f9)+_0x3dd6b1['toFixed'](0x6)+_0x337664(0x200)+_0x6bac24+'%\x20commission)');}catch(_0x7245ba){console['error'](_0x337664(0x1f8),_0x7245ba);}}async[a13_0x10f345(0x1e9)](_0x411be1,_0x196644){var _0x47731d=a13_0x10f345;try{const {id:_0x419e87}=_0x411be1[_0x47731d(0x207)];if(!_0x419e87){_0x196644[_0x47731d(0x1dc)](0x190)['json']({'success':![],'message':'Payment\x20ID\x20is\x20required'});return;}console[_0x47731d(0x1ed)]('üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20'+_0x419e87);const _0x26ed10=await database_1[_0x47731d(0x1d0)][_0x47731d(0x1f4)][_0x47731d(0x1ce)]({'where':{'OR':[{'id':_0x419e87},{'orderId':_0x419e87},{'gatewayOrderId':_0x419e87},{'gatewayPaymentId':_0x419e87}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x26ed10){_0x196644[_0x47731d(0x1dc)](0x194)[_0x47731d(0x1e5)]({'success':![],'message':_0x47731d(0x1f5)});return;}console[_0x47731d(0x1ed)](_0x47731d(0x20f)+_0x26ed10['id']+'\x20('+_0x26ed10[_0x47731d(0x1dc)]+')'),_0x196644[_0x47731d(0x1e5)]({'success':!![],'data':{'id':_0x26ed10['id'],'gateway':_0x26ed10[_0x47731d(0x1e6)],'amount':_0x26ed10[_0x47731d(0x1e3)],'currency':_0x26ed10[_0x47731d(0x20a)],'status':_0x26ed10[_0x47731d(0x1dc)],'gatewayOrderId':_0x26ed10[_0x47731d(0x1e8)],'gatewayPaymentId':_0x26ed10[_0x47731d(0x1f3)],'successUrl':_0x26ed10['successUrl'],'failUrl':_0x26ed10[_0x47731d(0x20e)],'pendingUrl':_0x26ed10[_0x47731d(0x202)],'customerEmail':_0x26ed10['customerEmail'],'customerName':_0x26ed10[_0x47731d(0x1fe)],'merchantBrand':_0x26ed10['shop'][_0x47731d(0x1db)],'createdAt':_0x26ed10['createdAt'],'updatedAt':_0x26ed10[_0x47731d(0x1d8)]}});}catch(_0x8e5fd0){console[_0x47731d(0x209)](_0x47731d(0x20c),_0x8e5fd0),_0x196644[_0x47731d(0x1dc)](0x1f4)[_0x47731d(0x1e5)]({'success':![],'message':_0x47731d(0x1eb),'error':_0x8e5fd0 instanceof Error?_0x8e5fd0['message']:_0x47731d(0x1d5)});}}}exports['OnRampController']=OnRampController;