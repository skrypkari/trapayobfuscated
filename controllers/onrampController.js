'use strict';var a12_0x5c8bcc=a12_0x25be;(function(_0x109bdb,_0xe3e0c2){var _0x3cce86=a12_0x25be,_0x2e817b=_0x109bdb();while(!![]){try{var _0x5a3bb4=parseInt(_0x3cce86(0xc9))/0x1+-parseInt(_0x3cce86(0xc3))/0x2+-parseInt(_0x3cce86(0xc2))/0x3*(parseInt(_0x3cce86(0xa4))/0x4)+parseInt(_0x3cce86(0xc7))/0x5+parseInt(_0x3cce86(0xde))/0x6*(parseInt(_0x3cce86(0xe1))/0x7)+parseInt(_0x3cce86(0xa7))/0x8*(parseInt(_0x3cce86(0xe3))/0x9)+parseInt(_0x3cce86(0xb2))/0xa*(-parseInt(_0x3cce86(0xe0))/0xb);if(_0x5a3bb4===_0xe3e0c2)break;else _0x2e817b['push'](_0x2e817b['shift']());}catch(_0x1301b4){_0x2e817b['push'](_0x2e817b['shift']());}}}(a12_0x5e00,0xe7410));function a12_0x5e00(){var _0x1452f3=['findFirst','getPaymentData','Payment\x20ID\x20and\x20status\x20are\x20required','onramp','USD','Unknown\x20error','log','\x20->\x20','payment','12twtksh','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','getOwnPropertyDescriptor','196816fKYqSv','gateway','customerEmail','default','update','defineProperty','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','__esModule','message','gatewayPaymentId','createdAt','40240QfTXUv','\x20USDT\x20(after\x20','status','__importStar','shopId','OnRampController','__setModuleDefault','length','toFixed','pendingUrl','get','onramp_system','create','writable','customerName','params','231126kgCMlC','459876PGEFpv','then','toUpperCase','updatePaymentStatus','3948820HettLR','updatedAt','1330572dtXWMv','updateMerchantBalanceForPaidPayment','currency','__importDefault','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','PAID','‚úÖ\x20Found\x20payment:\x20','üöÄ\x20OnRamp\x20status\x20update:\x20','failUrl','configurable','Payment\x20status\x20updated\x20successfully','getOwnPropertyNames','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','%\x20commission)','Internal\x20server\x20error','../config/database','hasOwnProperty','gatewayOrderId','../services/currencyService','call','successUrl','40836DgnBBh','amount','11935wtegsX','1911LyQKrw','convertToUSDT','657HimgIQ','Payment\x20ID\x20is\x20required','prototype','error','shop','json','Payment\x20not\x20found','body'];a12_0x5e00=function(){return _0x1452f3;};return a12_0x5e00();}var __createBinding=this&&this['__createBinding']||(Object[a12_0x5c8bcc(0xbe)]?function(_0x216a72,_0x109e5e,_0x599ade,_0x1756ce){var _0x524148=a12_0x5c8bcc;if(_0x1756ce===undefined)_0x1756ce=_0x599ade;var _0x1b2209=Object[_0x524148(0xa6)](_0x109e5e,_0x599ade);(!_0x1b2209||(_0x524148(0xbc)in _0x1b2209?!_0x109e5e[_0x524148(0xae)]:_0x1b2209[_0x524148(0xbf)]||_0x1b2209[_0x524148(0xd2)]))&&(_0x1b2209={'enumerable':!![],'get':function(){return _0x109e5e[_0x599ade];}}),Object[_0x524148(0xac)](_0x216a72,_0x1756ce,_0x1b2209);}:function(_0x19ccfe,_0x2d4871,_0x4f7ce3,_0x4f7e72){if(_0x4f7e72===undefined)_0x4f7e72=_0x4f7ce3;_0x19ccfe[_0x4f7e72]=_0x2d4871[_0x4f7ce3];}),__setModuleDefault=this&&this[a12_0x5c8bcc(0xb8)]||(Object[a12_0x5c8bcc(0xbe)]?function(_0x37362c,_0x3f536e){var _0x5e341d=a12_0x5c8bcc;Object[_0x5e341d(0xac)](_0x37362c,'default',{'enumerable':!![],'value':_0x3f536e});}:function(_0x533ef8,_0xa430c5){var _0x56ae2c=a12_0x5c8bcc;_0x533ef8[_0x56ae2c(0xaa)]=_0xa430c5;}),__importStar=this&&this[a12_0x5c8bcc(0xb5)]||(function(){var _0x189241=function(_0x5ad837){var _0x4ff46c=a12_0x25be;return _0x189241=Object[_0x4ff46c(0xd4)]||function(_0x2365a2){var _0x1a0c5e=_0x4ff46c,_0x33c94e=[];for(var _0x118a43 in _0x2365a2)if(Object[_0x1a0c5e(0xe5)][_0x1a0c5e(0xd9)][_0x1a0c5e(0xdc)](_0x2365a2,_0x118a43))_0x33c94e[_0x33c94e[_0x1a0c5e(0xb9)]]=_0x118a43;return _0x33c94e;},_0x189241(_0x5ad837);};return function(_0x53d0df){var _0x311830=a12_0x25be;if(_0x53d0df&&_0x53d0df[_0x311830(0xae)])return _0x53d0df;var _0x2ca173={};if(_0x53d0df!=null){for(var _0x1c407d=_0x189241(_0x53d0df),_0x4e268f=0x0;_0x4e268f<_0x1c407d[_0x311830(0xb9)];_0x4e268f++)if(_0x1c407d[_0x4e268f]!==_0x311830(0xaa))__createBinding(_0x2ca173,_0x53d0df,_0x1c407d[_0x4e268f]);}return __setModuleDefault(_0x2ca173,_0x53d0df),_0x2ca173;};}()),__importDefault=this&&this[a12_0x5c8bcc(0xcc)]||function(_0x2d9699){return _0x2d9699&&_0x2d9699['__esModule']?_0x2d9699:{'default':_0x2d9699};};Object[a12_0x5c8bcc(0xac)](exports,'__esModule',{'value':!![]}),exports[a12_0x5c8bcc(0xb7)]=void 0x0;const database_1=__importDefault(require(a12_0x5c8bcc(0xd8)));function a12_0x25be(_0xd36c8d,_0x37a072){_0xd36c8d=_0xd36c8d-0x9a;var _0x5e0099=a12_0x5e00();var _0x25be2b=_0x5e0099[_0xd36c8d];return _0x25be2b;}class OnRampController{async[a12_0x5c8bcc(0xc6)](_0x320848,_0x3feee2){var _0x2e34e3=a12_0x5c8bcc;try{const {paymentId:_0x596b79,status:_0x23ca12,referenceId:_0x34800e,transactionHash:_0x5d01f2,actualCryptoAmount:_0x4bf38c,orderId:_0x29072a}=_0x320848[_0x2e34e3(0x9a)];if(!_0x596b79||!_0x23ca12){_0x3feee2[_0x2e34e3(0xb4)](0x190)['json']({'success':![],'message':_0x2e34e3(0x9d)});return;}console[_0x2e34e3(0xa1)](_0x2e34e3(0xd0)+_0x596b79+_0x2e34e3(0xa2)+_0x23ca12),console[_0x2e34e3(0xa1)]('üìù\x20Data:',{'referenceId':_0x34800e,'transactionHash':_0x5d01f2,'actualCryptoAmount':_0x4bf38c,'orderId':_0x29072a});const _0xecfe69=await database_1[_0x2e34e3(0xaa)][_0x2e34e3(0xa3)][_0x2e34e3(0x9b)]({'where':{'OR':[{'id':_0x596b79},{'orderId':_0x596b79},{'gatewayOrderId':_0x596b79},{'gatewayPaymentId':_0x596b79}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0xecfe69){_0x3feee2['status'](0x194)[_0x2e34e3(0xe8)]({'success':![],'message':_0x2e34e3(0xe9)});return;}if(_0xecfe69[_0x2e34e3(0xa8)]!==_0x2e34e3(0x9e)){_0x3feee2[_0x2e34e3(0xb4)](0x190)[_0x2e34e3(0xe8)]({'success':![],'message':_0x2e34e3(0xd5)});return;}const _0xc2b038={'status':_0x23ca12['toUpperCase'](),'statusChangedAt':new Date(),'statusChangedBy':_0x2e34e3(0xbd)};_0x34800e&&(_0xc2b038[_0x2e34e3(0xda)]=_0x34800e);_0x5d01f2&&(_0xc2b038['gatewayPaymentId']=_0x5d01f2);_0x4bf38c&&(_0xc2b038['invoiceTotalSum']=_0x4bf38c);const _0x1b6e5f=await database_1[_0x2e34e3(0xaa)]['payment'][_0x2e34e3(0xab)]({'where':{'id':_0xecfe69['id']},'data':_0xc2b038});console[_0x2e34e3(0xa1)]('‚úÖ\x20OnRamp\x20payment\x20'+_0xecfe69['id']+'\x20updated\x20to\x20'+_0x23ca12),_0x23ca12[_0x2e34e3(0xc5)]()===_0x2e34e3(0xce)&&_0xecfe69['status']!==_0x2e34e3(0xce)&&await this[_0x2e34e3(0xca)](_0xecfe69),_0x3feee2[_0x2e34e3(0xe8)]({'success':!![],'message':_0x2e34e3(0xd3),'data':{'paymentId':_0x1b6e5f['id'],'status':_0x1b6e5f[_0x2e34e3(0xb4)],'referenceId':_0x34800e,'transactionHash':_0x5d01f2,'actualCryptoAmount':_0x4bf38c}});}catch(_0x2bc147){console[_0x2e34e3(0xe6)]('‚ùå\x20OnRamp\x20status\x20update\x20error:',_0x2bc147),_0x3feee2[_0x2e34e3(0xb4)](0x1f4)[_0x2e34e3(0xe8)]({'success':![],'message':_0x2e34e3(0xd7),'error':_0x2bc147 instanceof Error?_0x2bc147[_0x2e34e3(0xaf)]:_0x2e34e3(0xa0)});}}async[a12_0x5c8bcc(0xca)](_0x6ad724){var _0x407646=a12_0x5c8bcc;try{console[_0x407646(0xa1)](_0x407646(0xcd)+_0x6ad724['id']);let _0x5873ca;if(_0x6ad724['currency']===_0x407646(0x9f))_0x5873ca=_0x6ad724[_0x407646(0xdf)];else{const {currencyService:_0x56c2ef}=await Promise['resolve']()[_0x407646(0xc4)](()=>__importStar(require(_0x407646(0xdb))));_0x5873ca=await _0x56c2ef[_0x407646(0xe2)](_0x6ad724[_0x407646(0xdf)],_0x6ad724[_0x407646(0xcb)]);}await database_1['default']['payment']['update']({'where':{'id':_0x6ad724['id']},'data':{'amountUSDT':_0x5873ca,'paidAt':new Date()}});const _0x27b3d9=0xa,_0x4e817b=_0x5873ca*(0x1-_0x27b3d9/0x64);await database_1[_0x407646(0xaa)][_0x407646(0xe7)][_0x407646(0xab)]({'where':{'id':_0x6ad724[_0x407646(0xb6)]},'data':{'balance':{'increment':_0x4e817b}}}),console[_0x407646(0xa1)]('‚úÖ\x20Merchant\x20balance\x20updated:\x20+'+_0x4e817b[_0x407646(0xba)](0x6)+_0x407646(0xb3)+_0x27b3d9+_0x407646(0xd6));}catch(_0x2e1746){console[_0x407646(0xe6)]('‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:',_0x2e1746);}}async[a12_0x5c8bcc(0x9c)](_0xeed844,_0x36f381){var _0xc69a43=a12_0x5c8bcc;try{const {id:_0x7be897}=_0xeed844[_0xc69a43(0xc1)];if(!_0x7be897){_0x36f381['status'](0x190)[_0xc69a43(0xe8)]({'success':![],'message':_0xc69a43(0xe4)});return;}console[_0xc69a43(0xa1)](_0xc69a43(0xad)+_0x7be897);const _0xbb6ef7=await database_1[_0xc69a43(0xaa)][_0xc69a43(0xa3)][_0xc69a43(0x9b)]({'where':{'OR':[{'id':_0x7be897},{'orderId':_0x7be897},{'gatewayOrderId':_0x7be897},{'gatewayPaymentId':_0x7be897}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0xbb6ef7){_0x36f381[_0xc69a43(0xb4)](0x194)[_0xc69a43(0xe8)]({'success':![],'message':_0xc69a43(0xe9)});return;}console['log'](_0xc69a43(0xcf)+_0xbb6ef7['id']+'\x20('+_0xbb6ef7['status']+')'),_0x36f381[_0xc69a43(0xe8)]({'success':!![],'data':{'id':_0xbb6ef7['id'],'gateway':_0xbb6ef7['gateway'],'amount':_0xbb6ef7[_0xc69a43(0xdf)],'currency':_0xbb6ef7[_0xc69a43(0xcb)],'status':_0xbb6ef7[_0xc69a43(0xb4)],'gatewayOrderId':_0xbb6ef7[_0xc69a43(0xda)],'gatewayPaymentId':_0xbb6ef7[_0xc69a43(0xb0)],'successUrl':_0xbb6ef7[_0xc69a43(0xdd)],'failUrl':_0xbb6ef7[_0xc69a43(0xd1)],'pendingUrl':_0xbb6ef7[_0xc69a43(0xbb)],'customerEmail':_0xbb6ef7[_0xc69a43(0xa9)],'customerName':_0xbb6ef7[_0xc69a43(0xc0)],'merchantBrand':_0xbb6ef7[_0xc69a43(0xe7)]['name'],'createdAt':_0xbb6ef7[_0xc69a43(0xb1)],'updatedAt':_0xbb6ef7[_0xc69a43(0xc8)]}});}catch(_0x2aed7f){console[_0xc69a43(0xe6)](_0xc69a43(0xa5),_0x2aed7f),_0x36f381[_0xc69a43(0xb4)](0x1f4)['json']({'success':![],'message':'Internal\x20server\x20error','error':_0x2aed7f instanceof Error?_0x2aed7f['message']:'Unknown\x20error'});}}}exports[a12_0x5c8bcc(0xb7)]=OnRampController;