'use strict';var a9_0x3f573d=a9_0x5a40;function a9_0x2899(){var _0x186067=['createdAt','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','276FmZcob','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','customerEmail','1509LAscoK','status','amount','‚úÖ\x20Found\x20payment:\x20','currency','shop','‚ùå\x20OnRamp\x20status\x20update\x20error:','body','json','name','Internal\x20server\x20error','Payment\x20not\x20found','failUrl','36fveNQK','Payment\x20ID\x20and\x20status\x20are\x20required','toUpperCase','%\x20commission)','36078VsAWVh','890xUCxwe','2936080VrsOrU','PAID','prototype','getOwnPropertyNames','shopId','../config/database','../services/currencyService','gatewayOrderId','log','configurable','gateway','message','__setModuleDefault','\x20->\x20','customerName','create','üöÄ\x20OnRamp\x20status\x20update:\x20','Payment\x20status\x20updated\x20successfully','107679XMkCXt','successUrl','Payment\x20ID\x20is\x20required','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','toFixed','length','resolve','2230LgpLHV','USD','OnRampController','Unknown\x20error','default','onramp_system','1460wqMjkp','\x20USDT\x20(after\x20','__importStar','28FkXpgY','error','invoiceTotalSum','defineProperty','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','onramp','convertToUSDT','285629CRCsKk','\x20updated\x20to\x20','get','__esModule','updateMerchantBalanceForPaidPayment','findFirst','payment','__importDefault','update','116368nzaYhw'];a9_0x2899=function(){return _0x186067;};return a9_0x2899();}(function(_0x6a0ba2,_0x33b9e8){var _0x5c21f4=a9_0x5a40,_0x5e2d5a=_0x6a0ba2();while(!![]){try{var _0x62baca=-parseInt(_0x5c21f4(0x1a1))/0x1+-parseInt(_0x5c21f4(0x177))/0x2*(-parseInt(_0x5c21f4(0x1b1))/0x3)+parseInt(_0x5c21f4(0x197))/0x4*(-parseInt(_0x5c21f4(0x191))/0x5)+parseInt(_0x5c21f4(0x176))/0x6*(parseInt(_0x5c21f4(0x19a))/0x7)+parseInt(_0x5c21f4(0x1aa))/0x8*(-parseInt(_0x5c21f4(0x172))/0x9)+parseInt(_0x5c21f4(0x178))/0xa+-parseInt(_0x5c21f4(0x18a))/0xb*(-parseInt(_0x5c21f4(0x1ae))/0xc);if(_0x62baca===_0x33b9e8)break;else _0x5e2d5a['push'](_0x5e2d5a['shift']());}catch(_0x114039){_0x5e2d5a['push'](_0x5e2d5a['shift']());}}}(a9_0x2899,0x3f7c7));var __createBinding=this&&this['__createBinding']||(Object[a9_0x3f573d(0x187)]?function(_0x5f07ac,_0x476e58,_0x4d6e6e,_0x5acf89){var _0x24378f=a9_0x3f573d;if(_0x5acf89===undefined)_0x5acf89=_0x4d6e6e;var _0x1bd06c=Object['getOwnPropertyDescriptor'](_0x476e58,_0x4d6e6e);(!_0x1bd06c||(_0x24378f(0x1a3)in _0x1bd06c?!_0x476e58[_0x24378f(0x1a4)]:_0x1bd06c['writable']||_0x1bd06c[_0x24378f(0x181)]))&&(_0x1bd06c={'enumerable':!![],'get':function(){return _0x476e58[_0x4d6e6e];}}),Object[_0x24378f(0x19d)](_0x5f07ac,_0x5acf89,_0x1bd06c);}:function(_0x29b4c8,_0x60c339,_0x43474a,_0x5a6004){if(_0x5a6004===undefined)_0x5a6004=_0x43474a;_0x29b4c8[_0x5a6004]=_0x60c339[_0x43474a];}),__setModuleDefault=this&&this[a9_0x3f573d(0x184)]||(Object['create']?function(_0x4c62f2,_0x27118c){var _0x3b1d8a=a9_0x3f573d;Object[_0x3b1d8a(0x19d)](_0x4c62f2,_0x3b1d8a(0x195),{'enumerable':!![],'value':_0x27118c});}:function(_0x47f348,_0x3e63f2){_0x47f348['default']=_0x3e63f2;}),__importStar=this&&this[a9_0x3f573d(0x199)]||(function(){var _0x5b4635=function(_0x3d12fb){var _0xa81999=a9_0x5a40;return _0x5b4635=Object[_0xa81999(0x17b)]||function(_0x166dc9){var _0x1f92bc=_0xa81999,_0x3af1c8=[];for(var _0x3ba0e2 in _0x166dc9)if(Object[_0x1f92bc(0x17a)]['hasOwnProperty']['call'](_0x166dc9,_0x3ba0e2))_0x3af1c8[_0x3af1c8[_0x1f92bc(0x18f)]]=_0x3ba0e2;return _0x3af1c8;},_0x5b4635(_0x3d12fb);};return function(_0x1df5ac){var _0x3fc99b=a9_0x5a40;if(_0x1df5ac&&_0x1df5ac[_0x3fc99b(0x1a4)])return _0x1df5ac;var _0x1f5458={};if(_0x1df5ac!=null){for(var _0x2784ff=_0x5b4635(_0x1df5ac),_0x57b604=0x0;_0x57b604<_0x2784ff[_0x3fc99b(0x18f)];_0x57b604++)if(_0x2784ff[_0x57b604]!==_0x3fc99b(0x195))__createBinding(_0x1f5458,_0x1df5ac,_0x2784ff[_0x57b604]);}return __setModuleDefault(_0x1f5458,_0x1df5ac),_0x1f5458;};}()),__importDefault=this&&this[a9_0x3f573d(0x1a8)]||function(_0x1eae30){var _0x46c85d=a9_0x3f573d;return _0x1eae30&&_0x1eae30[_0x46c85d(0x1a4)]?_0x1eae30:{'default':_0x1eae30};};Object[a9_0x3f573d(0x19d)](exports,a9_0x3f573d(0x1a4),{'value':!![]}),exports[a9_0x3f573d(0x193)]=void 0x0;const database_1=__importDefault(require(a9_0x3f573d(0x17d)));function a9_0x5a40(_0x3e0cde,_0x1a820d){var _0x289948=a9_0x2899();return a9_0x5a40=function(_0x5a405f,_0x45a6a6){_0x5a405f=_0x5a405f-0x167;var _0xffb6ba=_0x289948[_0x5a405f];return _0xffb6ba;},a9_0x5a40(_0x3e0cde,_0x1a820d);}class OnRampController{async['updatePaymentStatus'](_0x3c6555,_0x1705e5){var _0x57b128=a9_0x3f573d;try{const {paymentId:_0x18b4e3,status:_0x14838b,referenceId:_0x2b10d1,transactionHash:_0x1772db,actualCryptoAmount:_0x5d2032,orderId:_0x11ec6c}=_0x3c6555[_0x57b128(0x16c)];if(!_0x18b4e3||!_0x14838b){_0x1705e5[_0x57b128(0x1b2)](0x190)[_0x57b128(0x16d)]({'success':![],'message':_0x57b128(0x173)});return;}console['log'](_0x57b128(0x188)+_0x18b4e3+_0x57b128(0x185)+_0x14838b),console[_0x57b128(0x180)]('üìù\x20Data:',{'referenceId':_0x2b10d1,'transactionHash':_0x1772db,'actualCryptoAmount':_0x5d2032,'orderId':_0x11ec6c});const _0x514830=await database_1['default'][_0x57b128(0x1a7)][_0x57b128(0x1a6)]({'where':{'OR':[{'id':_0x18b4e3},{'orderId':_0x18b4e3},{'gatewayOrderId':_0x18b4e3},{'gatewayPaymentId':_0x18b4e3}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x514830){_0x1705e5['status'](0x194)[_0x57b128(0x16d)]({'success':![],'message':_0x57b128(0x170)});return;}if(_0x514830[_0x57b128(0x182)]!==_0x57b128(0x19f)){_0x1705e5['status'](0x190)['json']({'success':![],'message':_0x57b128(0x1af)});return;}const _0x23415={'status':_0x14838b[_0x57b128(0x174)](),'statusChangedAt':new Date(),'statusChangedBy':_0x57b128(0x196)};_0x2b10d1&&(_0x23415[_0x57b128(0x17f)]=_0x2b10d1);_0x1772db&&(_0x23415['gatewayPaymentId']=_0x1772db);_0x5d2032&&(_0x23415[_0x57b128(0x19c)]=_0x5d2032);const _0x172383=await database_1[_0x57b128(0x195)][_0x57b128(0x1a7)][_0x57b128(0x1a9)]({'where':{'id':_0x514830['id']},'data':_0x23415});console[_0x57b128(0x180)]('‚úÖ\x20OnRamp\x20payment\x20'+_0x514830['id']+_0x57b128(0x1a2)+_0x14838b),_0x14838b[_0x57b128(0x174)]()==='PAID'&&_0x514830[_0x57b128(0x1b2)]!==_0x57b128(0x179)&&await this[_0x57b128(0x1a5)](_0x514830),_0x1705e5[_0x57b128(0x16d)]({'success':!![],'message':_0x57b128(0x189),'data':{'paymentId':_0x172383['id'],'status':_0x172383[_0x57b128(0x1b2)],'referenceId':_0x2b10d1,'transactionHash':_0x1772db,'actualCryptoAmount':_0x5d2032}});}catch(_0x344c98){console[_0x57b128(0x19b)](_0x57b128(0x16b),_0x344c98),_0x1705e5[_0x57b128(0x1b2)](0x1f4)[_0x57b128(0x16d)]({'success':![],'message':'Internal\x20server\x20error','error':_0x344c98 instanceof Error?_0x344c98[_0x57b128(0x183)]:_0x57b128(0x194)});}}async['updateMerchantBalanceForPaidPayment'](_0x188642){var _0x324065=a9_0x3f573d;try{console['log'](_0x324065(0x19e)+_0x188642['id']);let _0x46d11f;if(_0x188642[_0x324065(0x169)]===_0x324065(0x192))_0x46d11f=_0x188642[_0x324065(0x167)];else{const {currencyService:_0x51b6bc}=await Promise[_0x324065(0x190)]()['then'](()=>__importStar(require(_0x324065(0x17e))));_0x46d11f=await _0x51b6bc[_0x324065(0x1a0)](_0x188642[_0x324065(0x167)],_0x188642['currency']);}await database_1[_0x324065(0x195)][_0x324065(0x1a7)]['update']({'where':{'id':_0x188642['id']},'data':{'amountUSDT':_0x46d11f,'paidAt':new Date()}});const _0x10aea4=0xa,_0x4967f7=_0x46d11f*(0x1-_0x10aea4/0x64);await database_1[_0x324065(0x195)][_0x324065(0x16a)][_0x324065(0x1a9)]({'where':{'id':_0x188642[_0x324065(0x17c)]},'data':{'balance':{'increment':_0x4967f7}}}),console[_0x324065(0x180)](_0x324065(0x18d)+_0x4967f7[_0x324065(0x18e)](0x6)+_0x324065(0x198)+_0x10aea4+_0x324065(0x175));}catch(_0x3aff14){console['error'](_0x324065(0x1ad),_0x3aff14);}}async['getPaymentData'](_0x2dc8bc,_0x458406){var _0x1d3f43=a9_0x3f573d;try{const {id:_0x19b602}=_0x2dc8bc['params'];if(!_0x19b602){_0x458406['status'](0x190)['json']({'success':![],'message':_0x1d3f43(0x18c)});return;}console[_0x1d3f43(0x180)](_0x1d3f43(0x1ac)+_0x19b602);const _0x159257=await database_1[_0x1d3f43(0x195)]['payment'][_0x1d3f43(0x1a6)]({'where':{'OR':[{'id':_0x19b602},{'orderId':_0x19b602},{'gatewayOrderId':_0x19b602},{'gatewayPaymentId':_0x19b602}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x159257){_0x458406['status'](0x194)[_0x1d3f43(0x16d)]({'success':![],'message':_0x1d3f43(0x170)});return;}console[_0x1d3f43(0x180)](_0x1d3f43(0x168)+_0x159257['id']+'\x20('+_0x159257[_0x1d3f43(0x1b2)]+')'),_0x458406[_0x1d3f43(0x16d)]({'success':!![],'data':{'id':_0x159257['id'],'gateway':_0x159257['gateway'],'amount':_0x159257[_0x1d3f43(0x167)],'currency':_0x159257['currency'],'status':_0x159257[_0x1d3f43(0x1b2)],'gatewayOrderId':_0x159257[_0x1d3f43(0x17f)],'gatewayPaymentId':_0x159257['gatewayPaymentId'],'successUrl':_0x159257[_0x1d3f43(0x18b)],'failUrl':_0x159257[_0x1d3f43(0x171)],'pendingUrl':_0x159257['pendingUrl'],'customerEmail':_0x159257[_0x1d3f43(0x1b0)],'customerName':_0x159257[_0x1d3f43(0x186)],'merchantBrand':_0x159257[_0x1d3f43(0x16a)][_0x1d3f43(0x16e)],'createdAt':_0x159257[_0x1d3f43(0x1ab)],'updatedAt':_0x159257['updatedAt']}});}catch(_0x1562c2){console[_0x1d3f43(0x19b)]('‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:',_0x1562c2),_0x458406[_0x1d3f43(0x1b2)](0x1f4)[_0x1d3f43(0x16d)]({'success':![],'message':_0x1d3f43(0x16f),'error':_0x1562c2 instanceof Error?_0x1562c2[_0x1d3f43(0x183)]:_0x1d3f43(0x194)});}}}exports[a9_0x3f573d(0x193)]=OnRampController;