'use strict';function a13_0x5346(_0x47f8ab,_0x4a7c8f){_0x47f8ab=_0x47f8ab-0x1d3;var _0x47917a=a13_0x4791();var _0x534641=_0x47917a[_0x47f8ab];return _0x534641;}var a13_0x1d04d9=a13_0x5346;(function(_0x3d6fd0,_0x3f2773){var _0x5c5506=a13_0x5346,_0x50ebf8=_0x3d6fd0();while(!![]){try{var _0x2a1f5f=-parseInt(_0x5c5506(0x1d3))/0x1+-parseInt(_0x5c5506(0x1f2))/0x2+parseInt(_0x5c5506(0x20c))/0x3+parseInt(_0x5c5506(0x1d5))/0x4*(parseInt(_0x5c5506(0x1e7))/0x5)+parseInt(_0x5c5506(0x203))/0x6+parseInt(_0x5c5506(0x20a))/0x7*(parseInt(_0x5c5506(0x1f1))/0x8)+-parseInt(_0x5c5506(0x222))/0x9;if(_0x2a1f5f===_0x3f2773)break;else _0x50ebf8['push'](_0x50ebf8['shift']());}catch(_0x44f2a9){_0x50ebf8['push'](_0x50ebf8['shift']());}}}(a13_0x4791,0xcd5ee));var __createBinding=this&&this[a13_0x1d04d9(0x1dc)]||(Object['create']?function(_0x123fd5,_0x3e61e3,_0x16f989,_0x54fbaa){var _0x43b313=a13_0x1d04d9;if(_0x54fbaa===undefined)_0x54fbaa=_0x16f989;var _0x321712=Object[_0x43b313(0x20e)](_0x3e61e3,_0x16f989);(!_0x321712||(_0x43b313(0x1f4)in _0x321712?!_0x3e61e3[_0x43b313(0x1ec)]:_0x321712[_0x43b313(0x1e8)]||_0x321712[_0x43b313(0x1ef)]))&&(_0x321712={'enumerable':!![],'get':function(){return _0x3e61e3[_0x16f989];}}),Object[_0x43b313(0x20f)](_0x123fd5,_0x54fbaa,_0x321712);}:function(_0x5309c4,_0x21701c,_0x1d3ce0,_0x5b9fef){if(_0x5b9fef===undefined)_0x5b9fef=_0x1d3ce0;_0x5309c4[_0x5b9fef]=_0x21701c[_0x1d3ce0];}),__setModuleDefault=this&&this[a13_0x1d04d9(0x221)]||(Object[a13_0x1d04d9(0x216)]?function(_0xed971c,_0x5b8279){var _0x2fbd88=a13_0x1d04d9;Object['defineProperty'](_0xed971c,_0x2fbd88(0x213),{'enumerable':!![],'value':_0x5b8279});}:function(_0x1f2eab,_0x40c62d){var _0x541e4d=a13_0x1d04d9;_0x1f2eab[_0x541e4d(0x213)]=_0x40c62d;}),__importStar=this&&this['__importStar']||(function(){var _0x147ebc=function(_0x49b29b){var _0x5678fc=a13_0x5346;return _0x147ebc=Object[_0x5678fc(0x1ea)]||function(_0x396837){var _0x3924ca=_0x5678fc,_0x34d017=[];for(var _0x28abe4 in _0x396837)if(Object[_0x3924ca(0x212)][_0x3924ca(0x1ed)][_0x3924ca(0x217)](_0x396837,_0x28abe4))_0x34d017[_0x34d017[_0x3924ca(0x1d7)]]=_0x28abe4;return _0x34d017;},_0x147ebc(_0x49b29b);};return function(_0x27406f){var _0x5ea1c3=a13_0x5346;if(_0x27406f&&_0x27406f[_0x5ea1c3(0x1ec)])return _0x27406f;var _0x37b7aa={};if(_0x27406f!=null){for(var _0x21fa29=_0x147ebc(_0x27406f),_0x2b7ccf=0x0;_0x2b7ccf<_0x21fa29[_0x5ea1c3(0x1d7)];_0x2b7ccf++)if(_0x21fa29[_0x2b7ccf]!==_0x5ea1c3(0x213))__createBinding(_0x37b7aa,_0x27406f,_0x21fa29[_0x2b7ccf]);}return __setModuleDefault(_0x37b7aa,_0x27406f),_0x37b7aa;};}()),__importDefault=this&&this[a13_0x1d04d9(0x205)]||function(_0x518af5){var _0x33f726=a13_0x1d04d9;return _0x518af5&&_0x518af5[_0x33f726(0x1ec)]?_0x518af5:{'default':_0x518af5};};Object[a13_0x1d04d9(0x20f)](exports,'__esModule',{'value':!![]}),exports[a13_0x1d04d9(0x1da)]=void 0x0;const database_1=__importDefault(require('../config/database'));class OnRampController{async['updatePaymentStatus'](_0x4e637a,_0x2eb333){var _0x5e2c08=a13_0x1d04d9;try{const {paymentId:_0x358198,status:_0x1c6b47,referenceId:_0x52db0c,transactionHash:_0x1e1375,actualCryptoAmount:_0x1d1dcc,orderId:_0x3413bd}=_0x4e637a[_0x5e2c08(0x1d4)];if(!_0x358198||!_0x1c6b47){_0x2eb333[_0x5e2c08(0x208)](0x190)[_0x5e2c08(0x21e)]({'success':![],'message':_0x5e2c08(0x1d6)});return;}console[_0x5e2c08(0x209)]('üöÄ\x20OnRamp\x20status\x20update:\x20'+_0x358198+_0x5e2c08(0x1f7)+_0x1c6b47),console[_0x5e2c08(0x209)](_0x5e2c08(0x202),{'referenceId':_0x52db0c,'transactionHash':_0x1e1375,'actualCryptoAmount':_0x1d1dcc,'orderId':_0x3413bd});const _0x2fbfba=await database_1[_0x5e2c08(0x213)]['payment'][_0x5e2c08(0x21f)]({'where':{'OR':[{'id':_0x358198},{'orderId':_0x358198},{'gatewayOrderId':_0x358198},{'gatewayPaymentId':_0x358198}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2fbfba){_0x2eb333[_0x5e2c08(0x208)](0x194)[_0x5e2c08(0x21e)]({'success':![],'message':'Payment\x20not\x20found'});return;}if(_0x2fbfba['gateway']!=='onramp'){_0x2eb333[_0x5e2c08(0x208)](0x190)[_0x5e2c08(0x21e)]({'success':![],'message':_0x5e2c08(0x204)});return;}const _0x44494e={'status':_0x1c6b47[_0x5e2c08(0x1df)](),'statusChangedAt':new Date(),'statusChangedBy':'onramp_system'};_0x52db0c&&(_0x44494e[_0x5e2c08(0x1e5)]=_0x52db0c);_0x1e1375&&(_0x44494e['gatewayPaymentId']=_0x1e1375);_0x1d1dcc&&(_0x44494e[_0x5e2c08(0x201)]=_0x1d1dcc);const _0x2b9433=await database_1[_0x5e2c08(0x213)][_0x5e2c08(0x1eb)]['update']({'where':{'id':_0x2fbfba['id']},'data':_0x44494e});console[_0x5e2c08(0x209)](_0x5e2c08(0x206)+_0x2fbfba['id']+_0x5e2c08(0x207)+_0x1c6b47),_0x1c6b47['toUpperCase']()===_0x5e2c08(0x1f3)&&_0x2fbfba[_0x5e2c08(0x208)]!==_0x5e2c08(0x1f3)&&await this['updateMerchantBalanceForPaidPayment'](_0x2fbfba),_0x2eb333[_0x5e2c08(0x21e)]({'success':!![],'message':_0x5e2c08(0x1fc),'data':{'paymentId':_0x2b9433['id'],'status':_0x2b9433[_0x5e2c08(0x208)],'referenceId':_0x52db0c,'transactionHash':_0x1e1375,'actualCryptoAmount':_0x1d1dcc}});}catch(_0x51beda){console[_0x5e2c08(0x211)](_0x5e2c08(0x1d9),_0x51beda),_0x2eb333['status'](0x1f4)['json']({'success':![],'message':_0x5e2c08(0x1e9),'error':_0x51beda instanceof Error?_0x51beda[_0x5e2c08(0x1fe)]:'Unknown\x20error'});}}async[a13_0x1d04d9(0x1f6)](_0x3b381c){var _0x3e877b=a13_0x1d04d9;try{console[_0x3e877b(0x209)](_0x3e877b(0x1ee)+_0x3b381c['id']);let _0x53ecf1;if(_0x3b381c[_0x3e877b(0x1d8)]===_0x3e877b(0x21d))_0x53ecf1=_0x3b381c['amount'];else{const {currencyService:_0x795322}=await Promise[_0x3e877b(0x1db)]()[_0x3e877b(0x1e2)](()=>__importStar(require(_0x3e877b(0x1e3))));_0x53ecf1=await _0x795322[_0x3e877b(0x1dd)](_0x3b381c[_0x3e877b(0x214)],_0x3b381c[_0x3e877b(0x1d8)]);}await database_1[_0x3e877b(0x213)][_0x3e877b(0x1eb)]['update']({'where':{'id':_0x3b381c['id']},'data':{'amountUSDT':_0x53ecf1,'paidAt':new Date()}});const _0x30e42d=0xa,_0x4a5e2c=_0x53ecf1*(0x1-_0x30e42d/0x64);await database_1[_0x3e877b(0x213)]['shop'][_0x3e877b(0x21c)]({'where':{'id':_0x3b381c[_0x3e877b(0x1f8)]},'data':{'balance':{'increment':_0x4a5e2c}}}),console['log'](_0x3e877b(0x215)+_0x4a5e2c[_0x3e877b(0x210)](0x6)+_0x3e877b(0x21a)+_0x30e42d+_0x3e877b(0x220));}catch(_0x217658){console[_0x3e877b(0x211)](_0x3e877b(0x1e0),_0x217658);}}async[a13_0x1d04d9(0x219)](_0x310c2e,_0x3cab3c){var _0x3b7a1d=a13_0x1d04d9;try{const {id:_0x4cc577}=_0x310c2e[_0x3b7a1d(0x1fd)];if(!_0x4cc577){_0x3cab3c['status'](0x190)[_0x3b7a1d(0x21e)]({'success':![],'message':_0x3b7a1d(0x1ff)});return;}console[_0x3b7a1d(0x209)](_0x3b7a1d(0x1e1)+_0x4cc577);const _0x5c5378=await database_1[_0x3b7a1d(0x213)][_0x3b7a1d(0x1eb)][_0x3b7a1d(0x21f)]({'where':{'OR':[{'id':_0x4cc577},{'orderId':_0x4cc577},{'gatewayOrderId':_0x4cc577},{'gatewayPaymentId':_0x4cc577}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x5c5378){_0x3cab3c[_0x3b7a1d(0x208)](0x194)[_0x3b7a1d(0x21e)]({'success':![],'message':'Payment\x20not\x20found'});return;}console[_0x3b7a1d(0x209)](_0x3b7a1d(0x200)+_0x5c5378['id']+'\x20('+_0x5c5378[_0x3b7a1d(0x208)]+')'),_0x3cab3c[_0x3b7a1d(0x21e)]({'success':!![],'data':{'id':_0x5c5378['id'],'gateway':_0x5c5378[_0x3b7a1d(0x1f0)],'amount':_0x5c5378[_0x3b7a1d(0x214)],'currency':_0x5c5378['currency'],'status':_0x5c5378[_0x3b7a1d(0x208)],'gatewayOrderId':_0x5c5378[_0x3b7a1d(0x1e5)],'gatewayPaymentId':_0x5c5378[_0x3b7a1d(0x20d)],'successUrl':_0x5c5378[_0x3b7a1d(0x1fa)],'failUrl':_0x5c5378[_0x3b7a1d(0x1f9)],'pendingUrl':_0x5c5378['pendingUrl'],'customerEmail':_0x5c5378[_0x3b7a1d(0x1fb)],'customerName':_0x5c5378[_0x3b7a1d(0x1de)],'merchantBrand':_0x5c5378[_0x3b7a1d(0x1e4)][_0x3b7a1d(0x218)],'createdAt':_0x5c5378[_0x3b7a1d(0x1f5)],'updatedAt':_0x5c5378[_0x3b7a1d(0x20b)]}});}catch(_0x487a75){console[_0x3b7a1d(0x211)](_0x3b7a1d(0x1e6),_0x487a75),_0x3cab3c[_0x3b7a1d(0x208)](0x1f4)['json']({'success':![],'message':_0x3b7a1d(0x1e9),'error':_0x487a75 instanceof Error?_0x487a75['message']:_0x3b7a1d(0x21b)});}}}function a13_0x4791(){var _0x407264=['1246091VBmCww','updatedAt','1856490KHExyQ','gatewayPaymentId','getOwnPropertyDescriptor','defineProperty','toFixed','error','prototype','default','amount','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','create','call','name','getPaymentData','\x20USDT\x20(after\x20','Unknown\x20error','update','USD','json','findFirst','%\x20commission)','__setModuleDefault','15018246UdawqM','86586AKcFIQ','body','221420tJIbyq','Payment\x20ID\x20and\x20status\x20are\x20required','length','currency','‚ùå\x20OnRamp\x20status\x20update\x20error:','OnRampController','resolve','__createBinding','convertToUSDT','customerName','toUpperCase','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','then','../services/currencyService','shop','gatewayOrderId','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','75gigkNF','writable','Internal\x20server\x20error','getOwnPropertyNames','payment','__esModule','hasOwnProperty','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','configurable','gateway','56dFefOG','2913896SRIDSn','PAID','get','createdAt','updateMerchantBalanceForPaidPayment','\x20->\x20','shopId','failUrl','successUrl','customerEmail','Payment\x20status\x20updated\x20successfully','params','message','Payment\x20ID\x20is\x20required','‚úÖ\x20Found\x20payment:\x20','invoiceTotalSum','üìù\x20Data:','8149080sfUtZA','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','__importDefault','‚úÖ\x20OnRamp\x20payment\x20','\x20updated\x20to\x20','status','log'];a13_0x4791=function(){return _0x407264;};return a13_0x4791();}exports[a13_0x1d04d9(0x1da)]=OnRampController;