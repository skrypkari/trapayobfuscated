'use strict';var a11_0x2260e8=a11_0xef6d;(function(_0x2bf3af,_0x149ccb){var _0x3d963f=a11_0xef6d,_0x21b706=_0x2bf3af();while(!![]){try{var _0x56fbef=parseInt(_0x3d963f(0x192))/0x1*(-parseInt(_0x3d963f(0x1ca))/0x2)+-parseInt(_0x3d963f(0x1bd))/0x3+-parseInt(_0x3d963f(0x1a2))/0x4+-parseInt(_0x3d963f(0x195))/0x5*(parseInt(_0x3d963f(0x197))/0x6)+parseInt(_0x3d963f(0x1ac))/0x7+-parseInt(_0x3d963f(0x1d2))/0x8*(-parseInt(_0x3d963f(0x1a6))/0x9)+parseInt(_0x3d963f(0x1bc))/0xa;if(_0x56fbef===_0x149ccb)break;else _0x21b706['push'](_0x21b706['shift']());}catch(_0x418236){_0x21b706['push'](_0x21b706['shift']());}}}(a11_0x233a,0x74c4c));var __createBinding=this&&this[a11_0x2260e8(0x1b2)]||(Object['create']?function(_0x372ce8,_0x48fc14,_0x416bc5,_0x512e8a){var _0x348e61=a11_0x2260e8;if(_0x512e8a===undefined)_0x512e8a=_0x416bc5;var _0x2ca367=Object[_0x348e61(0x198)](_0x48fc14,_0x416bc5);(!_0x2ca367||('get'in _0x2ca367?!_0x48fc14[_0x348e61(0x1c0)]:_0x2ca367[_0x348e61(0x1aa)]||_0x2ca367['configurable']))&&(_0x2ca367={'enumerable':!![],'get':function(){return _0x48fc14[_0x416bc5];}}),Object[_0x348e61(0x1b8)](_0x372ce8,_0x512e8a,_0x2ca367);}:function(_0x3e616e,_0x445e0a,_0x3e10ca,_0x4178ba){if(_0x4178ba===undefined)_0x4178ba=_0x3e10ca;_0x3e616e[_0x4178ba]=_0x445e0a[_0x3e10ca];}),__setModuleDefault=this&&this[a11_0x2260e8(0x1d5)]||(Object[a11_0x2260e8(0x1d7)]?function(_0x501ff9,_0x135617){var _0x7c89de=a11_0x2260e8;Object['defineProperty'](_0x501ff9,_0x7c89de(0x1a5),{'enumerable':!![],'value':_0x135617});}:function(_0x16e858,_0x2b81fc){var _0xa189d=a11_0x2260e8;_0x16e858[_0xa189d(0x1a5)]=_0x2b81fc;}),__importStar=this&&this[a11_0x2260e8(0x1ba)]||(function(){var _0x43e046=function(_0x38a7df){var _0x4db88c=a11_0xef6d;return _0x43e046=Object[_0x4db88c(0x1a8)]||function(_0xb2108e){var _0x7be70b=_0x4db88c,_0x118300=[];for(var _0x3ed88a in _0xb2108e)if(Object[_0x7be70b(0x196)][_0x7be70b(0x1c8)]['call'](_0xb2108e,_0x3ed88a))_0x118300[_0x118300[_0x7be70b(0x1c6)]]=_0x3ed88a;return _0x118300;},_0x43e046(_0x38a7df);};return function(_0x26ff47){var _0x23d62d=a11_0xef6d;if(_0x26ff47&&_0x26ff47[_0x23d62d(0x1c0)])return _0x26ff47;var _0x4c6a5f={};if(_0x26ff47!=null){for(var _0x411f17=_0x43e046(_0x26ff47),_0x139818=0x0;_0x139818<_0x411f17['length'];_0x139818++)if(_0x411f17[_0x139818]!==_0x23d62d(0x1a5))__createBinding(_0x4c6a5f,_0x26ff47,_0x411f17[_0x139818]);}return __setModuleDefault(_0x4c6a5f,_0x26ff47),_0x4c6a5f;};}()),__importDefault=this&&this[a11_0x2260e8(0x19d)]||function(_0x46870d){return _0x46870d&&_0x46870d['__esModule']?_0x46870d:{'default':_0x46870d};};function a11_0xef6d(_0x3ce6c9,_0x30a2f9){_0x3ce6c9=_0x3ce6c9-0x18f;var _0x233a9c=a11_0x233a();var _0xef6d88=_0x233a9c[_0x3ce6c9];return _0xef6d88;}Object[a11_0x2260e8(0x1b8)](exports,a11_0x2260e8(0x1c0),{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require(a11_0x2260e8(0x1c3)));class OnRampController{async[a11_0x2260e8(0x19f)](_0x47c9d0,_0x3f7622){var _0x4a9cc3=a11_0x2260e8;try{const {paymentId:_0x54e39e,status:_0x162b37,referenceId:_0x45936c,transactionHash:_0x4ac31a,actualCryptoAmount:_0x218b07,orderId:_0x3fc4c8}=_0x47c9d0[_0x4a9cc3(0x1bf)];if(!_0x54e39e||!_0x162b37){_0x3f7622['status'](0x190)[_0x4a9cc3(0x190)]({'success':![],'message':_0x4a9cc3(0x199)});return;}console[_0x4a9cc3(0x1cf)](_0x4a9cc3(0x1be)+_0x54e39e+_0x4a9cc3(0x18f)+_0x162b37),console[_0x4a9cc3(0x1cf)](_0x4a9cc3(0x1d1),{'referenceId':_0x45936c,'transactionHash':_0x4ac31a,'actualCryptoAmount':_0x218b07,'orderId':_0x3fc4c8});const _0x22d6e6=await database_1['default'][_0x4a9cc3(0x1b5)]['findFirst']({'where':{'OR':[{'id':_0x54e39e},{'orderId':_0x54e39e},{'gatewayOrderId':_0x54e39e},{'gatewayPaymentId':_0x54e39e}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x22d6e6){_0x3f7622['status'](0x194)[_0x4a9cc3(0x190)]({'success':![],'message':_0x4a9cc3(0x1cb)});return;}if(_0x22d6e6[_0x4a9cc3(0x19c)]!==_0x4a9cc3(0x1ce)){_0x3f7622['status'](0x190)[_0x4a9cc3(0x190)]({'success':![],'message':_0x4a9cc3(0x1d6)});return;}const _0x189aaa={'status':_0x162b37[_0x4a9cc3(0x1d8)](),'statusChangedAt':new Date(),'statusChangedBy':_0x4a9cc3(0x1af)};_0x45936c&&(_0x189aaa[_0x4a9cc3(0x1a9)]=_0x45936c);_0x4ac31a&&(_0x189aaa[_0x4a9cc3(0x1a1)]=_0x4ac31a);_0x218b07&&(_0x189aaa[_0x4a9cc3(0x1c4)]=_0x218b07);const _0x33a379=await database_1[_0x4a9cc3(0x1a5)][_0x4a9cc3(0x1b5)]['update']({'where':{'id':_0x22d6e6['id']},'data':_0x189aaa});console[_0x4a9cc3(0x1cf)](_0x4a9cc3(0x19e)+_0x22d6e6['id']+_0x4a9cc3(0x19b)+_0x162b37),_0x162b37[_0x4a9cc3(0x1d8)]()===_0x4a9cc3(0x1d4)&&_0x22d6e6['status']!=='PAID'&&await this['updateMerchantBalanceForPaidPayment'](_0x22d6e6),_0x3f7622[_0x4a9cc3(0x190)]({'success':!![],'message':_0x4a9cc3(0x1cd),'data':{'paymentId':_0x33a379['id'],'status':_0x33a379[_0x4a9cc3(0x1b4)],'referenceId':_0x45936c,'transactionHash':_0x4ac31a,'actualCryptoAmount':_0x218b07}});}catch(_0x560af0){console[_0x4a9cc3(0x1bb)](_0x4a9cc3(0x191),_0x560af0),_0x3f7622['status'](0x1f4)['json']({'success':![],'message':_0x4a9cc3(0x1a3),'error':_0x560af0 instanceof Error?_0x560af0['message']:'Unknown\x20error'});}}async[a11_0x2260e8(0x1d9)](_0x4983e9){var _0x4a6568=a11_0x2260e8;try{console[_0x4a6568(0x1cf)](_0x4a6568(0x1ad)+_0x4983e9['id']);let _0x5db0b7;if(_0x4983e9[_0x4a6568(0x1c1)]==='USD')_0x5db0b7=_0x4983e9[_0x4a6568(0x1b9)];else{const {currencyService:_0x130c45}=await Promise[_0x4a6568(0x1b1)]()['then'](()=>__importStar(require(_0x4a6568(0x1a0))));_0x5db0b7=await _0x130c45[_0x4a6568(0x1d3)](_0x4983e9[_0x4a6568(0x1b9)],_0x4983e9['currency']);}await database_1[_0x4a6568(0x1a5)]['payment'][_0x4a6568(0x1b3)]({'where':{'id':_0x4983e9['id']},'data':{'amountUSDT':_0x5db0b7,'paidAt':new Date()}});const _0x3f7776=0xa,_0x12a981=_0x5db0b7*(0x1-_0x3f7776/0x64);await database_1[_0x4a6568(0x1a5)][_0x4a6568(0x194)][_0x4a6568(0x1b3)]({'where':{'id':_0x4983e9[_0x4a6568(0x1c7)]},'data':{'balance':{'increment':_0x12a981}}}),console[_0x4a6568(0x1cf)](_0x4a6568(0x19a)+_0x12a981['toFixed'](0x6)+_0x4a6568(0x1da)+_0x3f7776+_0x4a6568(0x1b0));}catch(_0x4f5eb3){console[_0x4a6568(0x1bb)]('‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:',_0x4f5eb3);}}async['getPaymentData'](_0x408844,_0x193c35){var _0x1d972d=a11_0x2260e8;try{const {id:_0x986693}=_0x408844[_0x1d972d(0x1c9)];if(!_0x986693){_0x193c35[_0x1d972d(0x1b4)](0x190)[_0x1d972d(0x190)]({'success':![],'message':'Payment\x20ID\x20is\x20required'});return;}console['log'](_0x1d972d(0x1b7)+_0x986693);const _0x5a28e1=await database_1[_0x1d972d(0x1a5)][_0x1d972d(0x1b5)]['findFirst']({'where':{'OR':[{'id':_0x986693},{'orderId':_0x986693},{'gatewayOrderId':_0x986693},{'gatewayPaymentId':_0x986693}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x5a28e1){_0x193c35['status'](0x194)[_0x1d972d(0x190)]({'success':![],'message':_0x1d972d(0x1cb)});return;}console['log'](_0x1d972d(0x1c5)+_0x5a28e1['id']+'\x20('+_0x5a28e1[_0x1d972d(0x1b4)]+')'),_0x193c35[_0x1d972d(0x190)]({'success':!![],'data':{'id':_0x5a28e1['id'],'gateway':_0x5a28e1[_0x1d972d(0x19c)],'amount':_0x5a28e1[_0x1d972d(0x1b9)],'currency':_0x5a28e1['currency'],'status':_0x5a28e1[_0x1d972d(0x1b4)],'gatewayOrderId':_0x5a28e1[_0x1d972d(0x1a9)],'gatewayPaymentId':_0x5a28e1[_0x1d972d(0x1a1)],'successUrl':_0x5a28e1[_0x1d972d(0x1d0)],'failUrl':_0x5a28e1[_0x1d972d(0x1a7)],'pendingUrl':_0x5a28e1[_0x1d972d(0x193)],'customerEmail':_0x5a28e1[_0x1d972d(0x1b6)],'customerName':_0x5a28e1[_0x1d972d(0x1cc)],'merchantBrand':_0x5a28e1[_0x1d972d(0x194)][_0x1d972d(0x1ae)],'createdAt':_0x5a28e1['createdAt'],'updatedAt':_0x5a28e1['updatedAt']}});}catch(_0x209598){console[_0x1d972d(0x1bb)](_0x1d972d(0x1c2),_0x209598),_0x193c35[_0x1d972d(0x1b4)](0x1f4)[_0x1d972d(0x190)]({'success':![],'message':_0x1d972d(0x1a3),'error':_0x209598 instanceof Error?_0x209598['message']:_0x1d972d(0x1a4)});}}}exports[a11_0x2260e8(0x1ab)]=OnRampController;function a11_0x233a(){var _0x4fb0d4=['__createBinding','update','status','payment','customerEmail','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','defineProperty','amount','__importStar','error','18375860SZGkEr','1681779MQrmtY','üöÄ\x20OnRamp\x20status\x20update:\x20','body','__esModule','currency','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','../config/database','invoiceTotalSum','‚úÖ\x20Found\x20payment:\x20','length','shopId','hasOwnProperty','params','519542LhtxUy','Payment\x20not\x20found','customerName','Payment\x20status\x20updated\x20successfully','onramp','log','successUrl','üìù\x20Data:','70696YYCozG','convertToUSDT','PAID','__setModuleDefault','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','create','toUpperCase','updateMerchantBalanceForPaidPayment','\x20USDT\x20(after\x20','\x20->\x20','json','‚ùå\x20OnRamp\x20status\x20update\x20error:','3WLtuNq','pendingUrl','shop','230MJPcTZ','prototype','31026fNoNEl','getOwnPropertyDescriptor','Payment\x20ID\x20and\x20status\x20are\x20required','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','\x20updated\x20to\x20','gateway','__importDefault','‚úÖ\x20OnRamp\x20payment\x20','updatePaymentStatus','../services/currencyService','gatewayPaymentId','1686004iAVMjX','Internal\x20server\x20error','Unknown\x20error','default','567ATUfiu','failUrl','getOwnPropertyNames','gatewayOrderId','writable','OnRampController','582680vhDqjm','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','name','onramp_system','%\x20commission)','resolve'];a11_0x233a=function(){return _0x4fb0d4;};return a11_0x233a();}