'use strict';var a12_0x532723=a12_0x3bb9;(function(_0xe3d037,_0xce62dd){var _0x3bd8cb=a12_0x3bb9,_0xa1236=_0xe3d037();while(!![]){try{var _0xd61428=parseInt(_0x3bd8cb(0x10d))/0x1+parseInt(_0x3bd8cb(0xdd))/0x2+parseInt(_0x3bd8cb(0xde))/0x3+parseInt(_0x3bd8cb(0x10e))/0x4*(-parseInt(_0x3bd8cb(0xf5))/0x5)+-parseInt(_0x3bd8cb(0xed))/0x6*(parseInt(_0x3bd8cb(0xce))/0x7)+-parseInt(_0x3bd8cb(0xd1))/0x8*(-parseInt(_0x3bd8cb(0xf3))/0x9)+-parseInt(_0x3bd8cb(0x106))/0xa*(parseInt(_0x3bd8cb(0x103))/0xb);if(_0xd61428===_0xce62dd)break;else _0xa1236['push'](_0xa1236['shift']());}catch(_0xac8494){_0xa1236['push'](_0xa1236['shift']());}}}(a12_0x592c,0xb2082));var __createBinding=this&&this[a12_0x532723(0xda)]||(Object[a12_0x532723(0x104)]?function(_0x468c83,_0x50fe29,_0x744c50,_0x90ef82){var _0xcac5ea=a12_0x532723;if(_0x90ef82===undefined)_0x90ef82=_0x744c50;var _0x506409=Object[_0xcac5ea(0x105)](_0x50fe29,_0x744c50);(!_0x506409||(_0xcac5ea(0x113)in _0x506409?!_0x50fe29[_0xcac5ea(0xe2)]:_0x506409['writable']||_0x506409[_0xcac5ea(0xf6)]))&&(_0x506409={'enumerable':!![],'get':function(){return _0x50fe29[_0x744c50];}}),Object[_0xcac5ea(0xc7)](_0x468c83,_0x90ef82,_0x506409);}:function(_0x275913,_0x46ee65,_0x39d459,_0x4f8bc0){if(_0x4f8bc0===undefined)_0x4f8bc0=_0x39d459;_0x275913[_0x4f8bc0]=_0x46ee65[_0x39d459];}),__setModuleDefault=this&&this[a12_0x532723(0xc8)]||(Object[a12_0x532723(0x104)]?function(_0x581eea,_0x2e70fa){var _0x2fa253=a12_0x532723;Object[_0x2fa253(0xc7)](_0x581eea,'default',{'enumerable':!![],'value':_0x2e70fa});}:function(_0x40951f,_0x17510a){var _0x5e0fe4=a12_0x532723;_0x40951f[_0x5e0fe4(0x10c)]=_0x17510a;}),__importStar=this&&this[a12_0x532723(0xd2)]||(function(){var _0x40369b=function(_0x56c83d){var _0x423960=a12_0x3bb9;return _0x40369b=Object[_0x423960(0xcf)]||function(_0x110119){var _0x5c7bec=_0x423960,_0x4283be=[];for(var _0x41128e in _0x110119)if(Object[_0x5c7bec(0x10a)][_0x5c7bec(0x10f)][_0x5c7bec(0xf8)](_0x110119,_0x41128e))_0x4283be[_0x4283be[_0x5c7bec(0xf4)]]=_0x41128e;return _0x4283be;},_0x40369b(_0x56c83d);};return function(_0x56dcfb){var _0x43565a=a12_0x3bb9;if(_0x56dcfb&&_0x56dcfb[_0x43565a(0xe2)])return _0x56dcfb;var _0x4318e1={};if(_0x56dcfb!=null){for(var _0x576d78=_0x40369b(_0x56dcfb),_0x2b437b=0x0;_0x2b437b<_0x576d78[_0x43565a(0xf4)];_0x2b437b++)if(_0x576d78[_0x2b437b]!==_0x43565a(0x10c))__createBinding(_0x4318e1,_0x56dcfb,_0x576d78[_0x2b437b]);}return __setModuleDefault(_0x4318e1,_0x56dcfb),_0x4318e1;};}()),__importDefault=this&&this[a12_0x532723(0xee)]||function(_0x22e5da){var _0x5bb10b=a12_0x532723;return _0x22e5da&&_0x22e5da[_0x5bb10b(0xe2)]?_0x22e5da:{'default':_0x22e5da};};Object[a12_0x532723(0xc7)](exports,a12_0x532723(0xe2),{'value':!![]}),exports[a12_0x532723(0xfc)]=void 0x0;const database_1=__importDefault(require(a12_0x532723(0xd6)));class OnRampController{async['updatePaymentStatus'](_0x51eb74,_0x976703){var _0x12d4e4=a12_0x532723;try{const {paymentId:_0xae7a4e,status:_0x4ad567,referenceId:_0x24ad01,transactionHash:_0x573cfc,actualCryptoAmount:_0x266de9,orderId:_0x3971ca}=_0x51eb74[_0x12d4e4(0xeb)];if(!_0xae7a4e||!_0x4ad567){_0x976703[_0x12d4e4(0xe0)](0x190)[_0x12d4e4(0xc6)]({'success':![],'message':'Payment\x20ID\x20and\x20status\x20are\x20required'});return;}console['log'](_0x12d4e4(0x111)+_0xae7a4e+_0x12d4e4(0xd5)+_0x4ad567),console[_0x12d4e4(0xff)](_0x12d4e4(0xfb),{'referenceId':_0x24ad01,'transactionHash':_0x573cfc,'actualCryptoAmount':_0x266de9,'orderId':_0x3971ca});const _0x3e409d=await database_1[_0x12d4e4(0x10c)][_0x12d4e4(0xe4)][_0x12d4e4(0xe8)]({'where':{'OR':[{'id':_0xae7a4e},{'orderId':_0xae7a4e},{'gatewayOrderId':_0xae7a4e},{'gatewayPaymentId':_0xae7a4e}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3e409d){_0x976703[_0x12d4e4(0xe0)](0x194)[_0x12d4e4(0xc6)]({'success':![],'message':_0x12d4e4(0x101)});return;}if(_0x3e409d['gateway']!==_0x12d4e4(0x100)){_0x976703['status'](0x190)[_0x12d4e4(0xc6)]({'success':![],'message':'This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway'});return;}const _0x33f0fc={'status':_0x4ad567[_0x12d4e4(0xdf)](),'statusChangedAt':new Date(),'statusChangedBy':_0x12d4e4(0x110)};_0x24ad01&&(_0x33f0fc[_0x12d4e4(0xca)]=_0x24ad01);_0x573cfc&&(_0x33f0fc[_0x12d4e4(0xd3)]=_0x573cfc);_0x266de9&&(_0x33f0fc['invoiceTotalSum']=_0x266de9);const _0x2ff4da=await database_1[_0x12d4e4(0x10c)][_0x12d4e4(0xe4)]['update']({'where':{'id':_0x3e409d['id']},'data':_0x33f0fc});console[_0x12d4e4(0xff)](_0x12d4e4(0xcb)+_0x3e409d['id']+_0x12d4e4(0x102)+_0x4ad567),_0x4ad567['toUpperCase']()===_0x12d4e4(0x108)&&_0x3e409d['status']!==_0x12d4e4(0x108)&&await this[_0x12d4e4(0xea)](_0x3e409d),_0x976703[_0x12d4e4(0xc6)]({'success':!![],'message':'Payment\x20status\x20updated\x20successfully','data':{'paymentId':_0x2ff4da['id'],'status':_0x2ff4da[_0x12d4e4(0xe0)],'referenceId':_0x24ad01,'transactionHash':_0x573cfc,'actualCryptoAmount':_0x266de9}});}catch(_0x13af45){console[_0x12d4e4(0xe9)](_0x12d4e4(0xdc),_0x13af45),_0x976703[_0x12d4e4(0xe0)](0x1f4)['json']({'success':![],'message':_0x12d4e4(0x10b),'error':_0x13af45 instanceof Error?_0x13af45[_0x12d4e4(0xe3)]:_0x12d4e4(0xd9)});}}async['updateMerchantBalanceForPaidPayment'](_0x382856){var _0x3c91b4=a12_0x532723;try{console[_0x3c91b4(0xff)](_0x3c91b4(0xc5)+_0x382856['id']);let _0x1f6e09;if(_0x382856[_0x3c91b4(0xc9)]===_0x3c91b4(0xef))_0x1f6e09=_0x382856[_0x3c91b4(0xd0)];else{const {currencyService:_0x3c1bf5}=await Promise[_0x3c91b4(0x109)]()[_0x3c91b4(0xe1)](()=>__importStar(require(_0x3c91b4(0xf2))));_0x1f6e09=await _0x3c1bf5[_0x3c91b4(0xe7)](_0x382856['amount'],_0x382856[_0x3c91b4(0xc9)]);}await database_1[_0x3c91b4(0x10c)][_0x3c91b4(0xe4)][_0x3c91b4(0xfe)]({'where':{'id':_0x382856['id']},'data':{'amountUSDT':_0x1f6e09,'paidAt':new Date()}});const _0x1628d3=0xa,_0x378654=_0x1f6e09*(0x1-_0x1628d3/0x64);await database_1[_0x3c91b4(0x10c)][_0x3c91b4(0xe6)][_0x3c91b4(0xfe)]({'where':{'id':_0x382856[_0x3c91b4(0xc4)]},'data':{'balance':{'increment':_0x378654}}}),console[_0x3c91b4(0xff)](_0x3c91b4(0x112)+_0x378654[_0x3c91b4(0xcd)](0x6)+_0x3c91b4(0xfa)+_0x1628d3+_0x3c91b4(0xfd));}catch(_0x1cf9f2){console['error'](_0x3c91b4(0xd7),_0x1cf9f2);}}async[a12_0x532723(0xe5)](_0x1d71f1,_0x4ad04c){var _0x2689d4=a12_0x532723;try{const {id:_0x807b6e}=_0x1d71f1[_0x2689d4(0xf9)];if(!_0x807b6e){_0x4ad04c[_0x2689d4(0xe0)](0x190)[_0x2689d4(0xc6)]({'success':![],'message':_0x2689d4(0xd4)});return;}console[_0x2689d4(0xff)]('üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20'+_0x807b6e);const _0x486092=await database_1[_0x2689d4(0x10c)][_0x2689d4(0xe4)][_0x2689d4(0xe8)]({'where':{'OR':[{'id':_0x807b6e},{'orderId':_0x807b6e},{'gatewayOrderId':_0x807b6e},{'gatewayPaymentId':_0x807b6e}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x486092){_0x4ad04c['status'](0x194)['json']({'success':![],'message':_0x2689d4(0x101)});return;}console[_0x2689d4(0xff)]('‚úÖ\x20Found\x20payment:\x20'+_0x486092['id']+'\x20('+_0x486092[_0x2689d4(0xe0)]+')'),_0x4ad04c[_0x2689d4(0xc6)]({'success':!![],'data':{'id':_0x486092['id'],'gateway':_0x486092[_0x2689d4(0x107)],'amount':_0x486092[_0x2689d4(0xd0)],'currency':_0x486092['currency'],'status':_0x486092[_0x2689d4(0xe0)],'gatewayOrderId':_0x486092[_0x2689d4(0xca)],'gatewayPaymentId':_0x486092[_0x2689d4(0xd3)],'successUrl':_0x486092[_0x2689d4(0xf0)],'failUrl':_0x486092[_0x2689d4(0xec)],'pendingUrl':_0x486092['pendingUrl'],'customerEmail':_0x486092[_0x2689d4(0xdb)],'customerName':_0x486092[_0x2689d4(0xcc)],'merchantBrand':_0x486092[_0x2689d4(0xe6)][_0x2689d4(0xd8)],'createdAt':_0x486092['createdAt'],'updatedAt':_0x486092[_0x2689d4(0xf1)]}});}catch(_0x10d505){console[_0x2689d4(0xe9)](_0x2689d4(0xf7),_0x10d505),_0x4ad04c[_0x2689d4(0xe0)](0x1f4)[_0x2689d4(0xc6)]({'success':![],'message':_0x2689d4(0x10b),'error':_0x10d505 instanceof Error?_0x10d505[_0x2689d4(0xe3)]:'Unknown\x20error'});}}}function a12_0x3bb9(_0x2b5b76,_0x3985b9){_0x2b5b76=_0x2b5b76-0xc4;var _0x592c28=a12_0x592c();var _0x3bb942=_0x592c28[_0x2b5b76];return _0x3bb942;}exports['OnRampController']=OnRampController;function a12_0x592c(){var _0x2774a4=['Unknown\x20error','__createBinding','customerEmail','‚ùå\x20OnRamp\x20status\x20update\x20error:','772606CvedLV','2835330rZBIOk','toUpperCase','status','then','__esModule','message','payment','getPaymentData','shop','convertToUSDT','findFirst','error','updateMerchantBalanceForPaidPayment','body','failUrl','369246jzyvJr','__importDefault','USD','successUrl','updatedAt','../services/currencyService','9954iGvmiu','length','25hSzqmp','configurable','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','call','params','\x20USDT\x20(after\x20','üìù\x20Data:','OnRampController','%\x20commission)','update','log','onramp','Payment\x20not\x20found','\x20updated\x20to\x20','77pejCfW','create','getOwnPropertyDescriptor','651620ZNcwUv','gateway','PAID','resolve','prototype','Internal\x20server\x20error','default','1053849sbOegc','1100548nmIVyb','hasOwnProperty','onramp_system','üöÄ\x20OnRamp\x20status\x20update:\x20','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','get','shopId','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','json','defineProperty','__setModuleDefault','currency','gatewayOrderId','‚úÖ\x20OnRamp\x20payment\x20','customerName','toFixed','77UdCjty','getOwnPropertyNames','amount','6168kAokvp','__importStar','gatewayPaymentId','Payment\x20ID\x20is\x20required','\x20->\x20','../config/database','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','name'];a12_0x592c=function(){return _0x2774a4;};return a12_0x592c();}