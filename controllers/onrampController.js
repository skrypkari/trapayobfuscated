'use strict';var a11_0xa9544d=a11_0x18ac;(function(_0x5e74f1,_0x1e769a){var _0x44eb46=a11_0x18ac,_0x24eda6=_0x5e74f1();while(!![]){try{var _0x16045a=parseInt(_0x44eb46(0xd9))/0x1*(-parseInt(_0x44eb46(0xe1))/0x2)+-parseInt(_0x44eb46(0xec))/0x3+-parseInt(_0x44eb46(0xb0))/0x4+-parseInt(_0x44eb46(0xed))/0x5*(-parseInt(_0x44eb46(0xe4))/0x6)+-parseInt(_0x44eb46(0xbb))/0x7+-parseInt(_0x44eb46(0xac))/0x8+parseInt(_0x44eb46(0xd3))/0x9;if(_0x16045a===_0x1e769a)break;else _0x24eda6['push'](_0x24eda6['shift']());}catch(_0x5c55b9){_0x24eda6['push'](_0x24eda6['shift']());}}}(a11_0x398f,0x1ec91));var __createBinding=this&&this[a11_0xa9544d(0xb6)]||(Object[a11_0xa9544d(0xd1)]?function(_0x28162a,_0x2b9fcb,_0x4784e0,_0x15f1a7){var _0x2fae8d=a11_0xa9544d;if(_0x15f1a7===undefined)_0x15f1a7=_0x4784e0;var _0x3fbdee=Object[_0x2fae8d(0xc1)](_0x2b9fcb,_0x4784e0);(!_0x3fbdee||('get'in _0x3fbdee?!_0x2b9fcb[_0x2fae8d(0xde)]:_0x3fbdee[_0x2fae8d(0xab)]||_0x3fbdee[_0x2fae8d(0xf0)]))&&(_0x3fbdee={'enumerable':!![],'get':function(){return _0x2b9fcb[_0x4784e0];}}),Object[_0x2fae8d(0xf5)](_0x28162a,_0x15f1a7,_0x3fbdee);}:function(_0x557d5,_0x8faa9e,_0x4b2eb3,_0x45188){if(_0x45188===undefined)_0x45188=_0x4b2eb3;_0x557d5[_0x45188]=_0x8faa9e[_0x4b2eb3];}),__setModuleDefault=this&&this[a11_0xa9544d(0xaf)]||(Object[a11_0xa9544d(0xd1)]?function(_0xa5f330,_0x14519e){var _0x4f3004=a11_0xa9544d;Object[_0x4f3004(0xf5)](_0xa5f330,'default',{'enumerable':!![],'value':_0x14519e});}:function(_0x298806,_0x3f0256){var _0x5c9894=a11_0xa9544d;_0x298806[_0x5c9894(0xc3)]=_0x3f0256;}),__importStar=this&&this[a11_0xa9544d(0xef)]||(function(){var _0x1a7722=function(_0x50f574){return _0x1a7722=Object['getOwnPropertyNames']||function(_0x5a1915){var _0x2be362=a11_0x18ac,_0x15ed9f=[];for(var _0x1811bc in _0x5a1915)if(Object[_0x2be362(0xf2)]['hasOwnProperty'][_0x2be362(0xf3)](_0x5a1915,_0x1811bc))_0x15ed9f[_0x15ed9f[_0x2be362(0xdb)]]=_0x1811bc;return _0x15ed9f;},_0x1a7722(_0x50f574);};return function(_0x41ab92){var _0x2306d5=a11_0x18ac;if(_0x41ab92&&_0x41ab92['__esModule'])return _0x41ab92;var _0x1ab588={};if(_0x41ab92!=null){for(var _0xf6906a=_0x1a7722(_0x41ab92),_0x35d2be=0x0;_0x35d2be<_0xf6906a[_0x2306d5(0xdb)];_0x35d2be++)if(_0xf6906a[_0x35d2be]!==_0x2306d5(0xc3))__createBinding(_0x1ab588,_0x41ab92,_0xf6906a[_0x35d2be]);}return __setModuleDefault(_0x1ab588,_0x41ab92),_0x1ab588;};}()),__importDefault=this&&this[a11_0xa9544d(0xda)]||function(_0x37cd24){return _0x37cd24&&_0x37cd24['__esModule']?_0x37cd24:{'default':_0x37cd24};};function a11_0x18ac(_0x455389,_0x2a1a11){_0x455389=_0x455389-0xab;var _0x398f15=a11_0x398f();var _0x18acac=_0x398f15[_0x455389];return _0x18acac;}Object[a11_0xa9544d(0xf5)](exports,a11_0xa9544d(0xde),{'value':!![]}),exports['OnRampController']=void 0x0;function a11_0x398f(){var _0x51b0e0=['customerName','36quUsSQ','__importDefault','length','currency','Internal\x20server\x20error','__esModule','Payment\x20ID\x20is\x20required','\x20->\x20','13094yJLXPh','gatewayPaymentId','%\x20commission)','540114veSgnr','updatedAt','message','name','onramp','convertToUSDT','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','gateway','322197lfNawR','5fFBLTJ','Payment\x20ID\x20and\x20status\x20are\x20required','__importStar','configurable','Unknown\x20error','prototype','call','pendingUrl','defineProperty','‚úÖ\x20OnRamp\x20payment\x20','writable','1520488SzDSpF','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','update','__setModuleDefault','42116QUPfeb','‚úÖ\x20Found\x20payment:\x20','gatewayOrderId','amount','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','then','__createBinding','customerEmail','createdAt','payment','PAID','1168839zkFNGB','shopId','\x20updated\x20to\x20','Payment\x20status\x20updated\x20successfully','\x20USDT\x20(after\x20','onramp_system','getOwnPropertyDescriptor','json','default','../config/database','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','invoiceTotalSum','üìù\x20Data:','params','../services/currencyService','üöÄ\x20OnRamp\x20status\x20update:\x20','resolve','getPaymentData','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','log','updateMerchantBalanceForPaidPayment','body','create','error','6720624mTuvIU','findFirst','status','updatePaymentStatus','toUpperCase'];a11_0x398f=function(){return _0x51b0e0;};return a11_0x398f();}const database_1=__importDefault(require(a11_0xa9544d(0xc4)));class OnRampController{async[a11_0xa9544d(0xd6)](_0xfa3236,_0x1e03cf){var _0x2ed3d9=a11_0xa9544d;try{const {paymentId:_0x4bd28f,status:_0x2fad46,referenceId:_0x517537,transactionHash:_0x539c57,actualCryptoAmount:_0x9b3437,orderId:_0x3c0ebe}=_0xfa3236[_0x2ed3d9(0xd0)];if(!_0x4bd28f||!_0x2fad46){_0x1e03cf['status'](0x190)['json']({'success':![],'message':_0x2ed3d9(0xee)});return;}console[_0x2ed3d9(0xce)](_0x2ed3d9(0xca)+_0x4bd28f+_0x2ed3d9(0xe0)+_0x2fad46),console[_0x2ed3d9(0xce)](_0x2ed3d9(0xc7),{'referenceId':_0x517537,'transactionHash':_0x539c57,'actualCryptoAmount':_0x9b3437,'orderId':_0x3c0ebe});const _0x40b6d6=await database_1[_0x2ed3d9(0xc3)][_0x2ed3d9(0xb9)][_0x2ed3d9(0xd4)]({'where':{'OR':[{'id':_0x4bd28f},{'orderId':_0x4bd28f},{'gatewayOrderId':_0x4bd28f},{'gatewayPaymentId':_0x4bd28f}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x40b6d6){_0x1e03cf[_0x2ed3d9(0xd5)](0x194)['json']({'success':![],'message':'Payment\x20not\x20found'});return;}if(_0x40b6d6['gateway']!==_0x2ed3d9(0xe8)){_0x1e03cf[_0x2ed3d9(0xd5)](0x190)[_0x2ed3d9(0xc2)]({'success':![],'message':_0x2ed3d9(0xad)});return;}const _0x9eee48={'status':_0x2fad46[_0x2ed3d9(0xd7)](),'statusChangedAt':new Date(),'statusChangedBy':_0x2ed3d9(0xc0)};_0x517537&&(_0x9eee48['gatewayOrderId']=_0x517537);_0x539c57&&(_0x9eee48[_0x2ed3d9(0xe2)]=_0x539c57);_0x9b3437&&(_0x9eee48[_0x2ed3d9(0xc6)]=_0x9b3437);const _0x3ea2bf=await database_1[_0x2ed3d9(0xc3)][_0x2ed3d9(0xb9)][_0x2ed3d9(0xae)]({'where':{'id':_0x40b6d6['id']},'data':_0x9eee48});console['log'](_0x2ed3d9(0xf6)+_0x40b6d6['id']+_0x2ed3d9(0xbd)+_0x2fad46),_0x2fad46['toUpperCase']()===_0x2ed3d9(0xba)&&_0x40b6d6[_0x2ed3d9(0xd5)]!=='PAID'&&await this[_0x2ed3d9(0xcf)](_0x40b6d6),_0x1e03cf[_0x2ed3d9(0xc2)]({'success':!![],'message':_0x2ed3d9(0xbe),'data':{'paymentId':_0x3ea2bf['id'],'status':_0x3ea2bf['status'],'referenceId':_0x517537,'transactionHash':_0x539c57,'actualCryptoAmount':_0x9b3437}});}catch(_0x1befa6){console['error']('‚ùå\x20OnRamp\x20status\x20update\x20error:',_0x1befa6),_0x1e03cf['status'](0x1f4)[_0x2ed3d9(0xc2)]({'success':![],'message':_0x2ed3d9(0xdd),'error':_0x1befa6 instanceof Error?_0x1befa6[_0x2ed3d9(0xe6)]:'Unknown\x20error'});}}async[a11_0xa9544d(0xcf)](_0x442f07){var _0x3f894d=a11_0xa9544d;try{console[_0x3f894d(0xce)](_0x3f894d(0xea)+_0x442f07['id']);let _0x59ca43;if(_0x442f07[_0x3f894d(0xdc)]==='USD')_0x59ca43=_0x442f07[_0x3f894d(0xb3)];else{const {currencyService:_0x4582d3}=await Promise[_0x3f894d(0xcb)]()[_0x3f894d(0xb5)](()=>__importStar(require(_0x3f894d(0xc9))));_0x59ca43=await _0x4582d3[_0x3f894d(0xe9)](_0x442f07[_0x3f894d(0xb3)],_0x442f07['currency']);}await database_1[_0x3f894d(0xc3)][_0x3f894d(0xb9)][_0x3f894d(0xae)]({'where':{'id':_0x442f07['id']},'data':{'amountUSDT':_0x59ca43,'paidAt':new Date()}});const _0x3ecaa4=0xa,_0x5cd35f=_0x59ca43*(0x1-_0x3ecaa4/0x64);await database_1[_0x3f894d(0xc3)]['shop'][_0x3f894d(0xae)]({'where':{'id':_0x442f07[_0x3f894d(0xbc)]},'data':{'balance':{'increment':_0x5cd35f}}}),console[_0x3f894d(0xce)](_0x3f894d(0xc5)+_0x5cd35f['toFixed'](0x6)+_0x3f894d(0xbf)+_0x3ecaa4+_0x3f894d(0xe3));}catch(_0xf6c97a){console['error'](_0x3f894d(0xcd),_0xf6c97a);}}async[a11_0xa9544d(0xcc)](_0x580025,_0x1c4fbb){var _0x4f83ee=a11_0xa9544d;try{const {id:_0x2499e7}=_0x580025[_0x4f83ee(0xc8)];if(!_0x2499e7){_0x1c4fbb['status'](0x190)[_0x4f83ee(0xc2)]({'success':![],'message':_0x4f83ee(0xdf)});return;}console['log']('üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20'+_0x2499e7);const _0xac39c9=await database_1[_0x4f83ee(0xc3)][_0x4f83ee(0xb9)][_0x4f83ee(0xd4)]({'where':{'OR':[{'id':_0x2499e7},{'orderId':_0x2499e7},{'gatewayOrderId':_0x2499e7},{'gatewayPaymentId':_0x2499e7}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0xac39c9){_0x1c4fbb[_0x4f83ee(0xd5)](0x194)['json']({'success':![],'message':'Payment\x20not\x20found'});return;}console[_0x4f83ee(0xce)](_0x4f83ee(0xb1)+_0xac39c9['id']+'\x20('+_0xac39c9[_0x4f83ee(0xd5)]+')'),_0x1c4fbb[_0x4f83ee(0xc2)]({'success':!![],'data':{'id':_0xac39c9['id'],'gateway':_0xac39c9[_0x4f83ee(0xeb)],'amount':_0xac39c9[_0x4f83ee(0xb3)],'currency':_0xac39c9['currency'],'status':_0xac39c9[_0x4f83ee(0xd5)],'gatewayOrderId':_0xac39c9[_0x4f83ee(0xb2)],'gatewayPaymentId':_0xac39c9[_0x4f83ee(0xe2)],'successUrl':_0xac39c9['successUrl'],'failUrl':_0xac39c9['failUrl'],'pendingUrl':_0xac39c9[_0x4f83ee(0xf4)],'customerEmail':_0xac39c9[_0x4f83ee(0xb7)],'customerName':_0xac39c9[_0x4f83ee(0xd8)],'merchantBrand':_0xac39c9['shop'][_0x4f83ee(0xe7)],'createdAt':_0xac39c9[_0x4f83ee(0xb8)],'updatedAt':_0xac39c9[_0x4f83ee(0xe5)]}});}catch(_0x29ac8f){console[_0x4f83ee(0xd2)](_0x4f83ee(0xb4),_0x29ac8f),_0x1c4fbb['status'](0x1f4)[_0x4f83ee(0xc2)]({'success':![],'message':_0x4f83ee(0xdd),'error':_0x29ac8f instanceof Error?_0x29ac8f[_0x4f83ee(0xe6)]:_0x4f83ee(0xf1)});}}}exports['OnRampController']=OnRampController;