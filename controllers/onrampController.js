'use strict';function a9_0x4c88(){var _0x50b199=['resolve','134380gbkBsM','failUrl','gatewayOrderId','üöÄ\x20OnRamp\x20status\x20update:\x20','hasOwnProperty','__setModuleDefault','successUrl','currency','updatedAt','Internal\x20server\x20error','30XVQLIq','then','log','19123dmPrTE','body','\x20updated\x20to\x20','writable','getOwnPropertyDescriptor','shop','gatewayPaymentId','call','\x20USDT\x20(after\x20','getPaymentData','customerName','Payment\x20ID\x20is\x20required','3139240kcgpWJ','4968OhNnnl','toUpperCase','message','Payment\x20ID\x20and\x20status\x20are\x20required','USD','Payment\x20status\x20updated\x20successfully','__createBinding','56OULKMo','6738327hnARiX','customerEmail','convertToUSDT','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','createdAt','‚úÖ\x20Found\x20payment:\x20','8SIEbhF','7nxZTTY','create','toFixed','configurable','getOwnPropertyNames','__importStar','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','gateway','amount','üìù\x20Data:','../config/database','__esModule','updatePaymentStatus','defineProperty','shopId','onramp_system','findFirst','payment','error','default','update','945327kkhvdU','4641774KLEINP','OnRampController','Unknown\x20error','json','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','71797LzLsWW','updateMerchantBalanceForPaidPayment','status','Payment\x20not\x20found','length'];a9_0x4c88=function(){return _0x50b199;};return a9_0x4c88();}function a9_0x5975(_0x4700b9,_0x4892c9){var _0x4c8860=a9_0x4c88();return a9_0x5975=function(_0x5975d4,_0x3acca8){_0x5975d4=_0x5975d4-0x1ec;var _0x210c7f=_0x4c8860[_0x5975d4];return _0x210c7f;},a9_0x5975(_0x4700b9,_0x4892c9);}var a9_0x10e343=a9_0x5975;(function(_0x20ddd2,_0x45fa8){var _0x2b001a=a9_0x5975,_0x43c3f6=_0x20ddd2();while(!![]){try{var _0x445aa7=parseInt(_0x2b001a(0x1ff))/0x1*(-parseInt(_0x2b001a(0x1fc))/0x2)+-parseInt(_0x2b001a(0x230))/0x3+parseInt(_0x2b001a(0x213))/0x4*(-parseInt(_0x2b001a(0x1f2))/0x5)+parseInt(_0x2b001a(0x231))/0x6*(-parseInt(_0x2b001a(0x21b))/0x7)+parseInt(_0x2b001a(0x21a))/0x8*(-parseInt(_0x2b001a(0x214))/0x9)+parseInt(_0x2b001a(0x20b))/0xa+parseInt(_0x2b001a(0x1ec))/0xb*(parseInt(_0x2b001a(0x20c))/0xc);if(_0x445aa7===_0x45fa8)break;else _0x43c3f6['push'](_0x43c3f6['shift']());}catch(_0x1adc15){_0x43c3f6['push'](_0x43c3f6['shift']());}}}(a9_0x4c88,0x7dde0));var __createBinding=this&&this[a9_0x10e343(0x212)]||(Object[a9_0x10e343(0x21c)]?function(_0x198a3a,_0xc9201c,_0x5e5e2a,_0x11b751){var _0x1f8d4e=a9_0x10e343;if(_0x11b751===undefined)_0x11b751=_0x5e5e2a;var _0xb9e41=Object[_0x1f8d4e(0x203)](_0xc9201c,_0x5e5e2a);(!_0xb9e41||('get'in _0xb9e41?!_0xc9201c[_0x1f8d4e(0x226)]:_0xb9e41[_0x1f8d4e(0x202)]||_0xb9e41[_0x1f8d4e(0x21e)]))&&(_0xb9e41={'enumerable':!![],'get':function(){return _0xc9201c[_0x5e5e2a];}}),Object[_0x1f8d4e(0x228)](_0x198a3a,_0x11b751,_0xb9e41);}:function(_0x4dc782,_0x1cbc38,_0x2bca88,_0x2b9e8f){if(_0x2b9e8f===undefined)_0x2b9e8f=_0x2bca88;_0x4dc782[_0x2b9e8f]=_0x1cbc38[_0x2bca88];}),__setModuleDefault=this&&this[a9_0x10e343(0x1f7)]||(Object['create']?function(_0x1c9f48,_0x1603c3){var _0x5cc696=a9_0x10e343;Object['defineProperty'](_0x1c9f48,_0x5cc696(0x22e),{'enumerable':!![],'value':_0x1603c3});}:function(_0x366e4b,_0x4ffa6a){var _0xf4dd5b=a9_0x10e343;_0x366e4b[_0xf4dd5b(0x22e)]=_0x4ffa6a;}),__importStar=this&&this[a9_0x10e343(0x220)]||(function(){var _0x5e8e6b=function(_0x4b7849){var _0xf3233d=a9_0x5975;return _0x5e8e6b=Object[_0xf3233d(0x21f)]||function(_0x336d81){var _0x455fcb=_0xf3233d,_0xe7e58f=[];for(var _0x456ce1 in _0x336d81)if(Object['prototype'][_0x455fcb(0x1f6)][_0x455fcb(0x206)](_0x336d81,_0x456ce1))_0xe7e58f[_0xe7e58f[_0x455fcb(0x1f0)]]=_0x456ce1;return _0xe7e58f;},_0x5e8e6b(_0x4b7849);};return function(_0x27f18d){var _0x3ad20e=a9_0x5975;if(_0x27f18d&&_0x27f18d['__esModule'])return _0x27f18d;var _0x10def2={};if(_0x27f18d!=null){for(var _0x27acad=_0x5e8e6b(_0x27f18d),_0x35e3d7=0x0;_0x35e3d7<_0x27acad[_0x3ad20e(0x1f0)];_0x35e3d7++)if(_0x27acad[_0x35e3d7]!==_0x3ad20e(0x22e))__createBinding(_0x10def2,_0x27f18d,_0x27acad[_0x35e3d7]);}return __setModuleDefault(_0x10def2,_0x27f18d),_0x10def2;};}()),__importDefault=this&&this['__importDefault']||function(_0x43d06e){var _0x4a84c9=a9_0x10e343;return _0x43d06e&&_0x43d06e[_0x4a84c9(0x226)]?_0x43d06e:{'default':_0x43d06e};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a9_0x10e343(0x232)]=void 0x0;const database_1=__importDefault(require(a9_0x10e343(0x225)));class OnRampController{async[a9_0x10e343(0x227)](_0x451d4f,_0x46fd4f){var _0x19256d=a9_0x10e343;try{const {paymentId:_0x3dc5c9,status:_0x204c57,referenceId:_0x595016,transactionHash:_0x187fb3,actualCryptoAmount:_0x312b66,orderId:_0x1eb971}=_0x451d4f[_0x19256d(0x200)];if(!_0x3dc5c9||!_0x204c57){_0x46fd4f[_0x19256d(0x1ee)](0x190)['json']({'success':![],'message':_0x19256d(0x20f)});return;}console['log'](_0x19256d(0x1f5)+_0x3dc5c9+'\x20->\x20'+_0x204c57),console['log'](_0x19256d(0x224),{'referenceId':_0x595016,'transactionHash':_0x187fb3,'actualCryptoAmount':_0x312b66,'orderId':_0x1eb971});const _0x59237b=await database_1[_0x19256d(0x22e)][_0x19256d(0x22c)][_0x19256d(0x22b)]({'where':{'OR':[{'id':_0x3dc5c9},{'orderId':_0x3dc5c9},{'gatewayOrderId':_0x3dc5c9},{'gatewayPaymentId':_0x3dc5c9}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x59237b){_0x46fd4f[_0x19256d(0x1ee)](0x194)['json']({'success':![],'message':_0x19256d(0x1ef)});return;}if(_0x59237b[_0x19256d(0x222)]!=='onramp'){_0x46fd4f['status'](0x190)[_0x19256d(0x234)]({'success':![],'message':'This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway'});return;}const _0x521ca1={'status':_0x204c57[_0x19256d(0x20d)](),'statusChangedAt':new Date(),'statusChangedBy':_0x19256d(0x22a)};_0x595016&&(_0x521ca1[_0x19256d(0x1f4)]=_0x595016);_0x187fb3&&(_0x521ca1[_0x19256d(0x205)]=_0x187fb3);_0x312b66&&(_0x521ca1['invoiceTotalSum']=_0x312b66);const _0x2c97f1=await database_1['default'][_0x19256d(0x22c)][_0x19256d(0x22f)]({'where':{'id':_0x59237b['id']},'data':_0x521ca1});console[_0x19256d(0x1fe)]('‚úÖ\x20OnRamp\x20payment\x20'+_0x59237b['id']+_0x19256d(0x201)+_0x204c57),_0x204c57['toUpperCase']()==='PAID'&&_0x59237b[_0x19256d(0x1ee)]!=='PAID'&&await this[_0x19256d(0x1ed)](_0x59237b),_0x46fd4f['json']({'success':!![],'message':_0x19256d(0x211),'data':{'paymentId':_0x2c97f1['id'],'status':_0x2c97f1['status'],'referenceId':_0x595016,'transactionHash':_0x187fb3,'actualCryptoAmount':_0x312b66}});}catch(_0x1c6708){console[_0x19256d(0x22d)]('‚ùå\x20OnRamp\x20status\x20update\x20error:',_0x1c6708),_0x46fd4f['status'](0x1f4)[_0x19256d(0x234)]({'success':![],'message':_0x19256d(0x1fb),'error':_0x1c6708 instanceof Error?_0x1c6708[_0x19256d(0x20e)]:_0x19256d(0x233)});}}async['updateMerchantBalanceForPaidPayment'](_0xfb5e33){var _0x4ae319=a9_0x10e343;try{console[_0x4ae319(0x1fe)](_0x4ae319(0x235)+_0xfb5e33['id']);let _0x4f9ad6;if(_0xfb5e33[_0x4ae319(0x1f9)]===_0x4ae319(0x210))_0x4f9ad6=_0xfb5e33['amount'];else{const {currencyService:_0x3cf10b}=await Promise[_0x4ae319(0x1f1)]()[_0x4ae319(0x1fd)](()=>__importStar(require('../services/currencyService')));_0x4f9ad6=await _0x3cf10b[_0x4ae319(0x216)](_0xfb5e33['amount'],_0xfb5e33[_0x4ae319(0x1f9)]);}await database_1['default'][_0x4ae319(0x22c)][_0x4ae319(0x22f)]({'where':{'id':_0xfb5e33['id']},'data':{'amountUSDT':_0x4f9ad6,'paidAt':new Date()}});const _0x175520=0xa,_0x3f9049=_0x4f9ad6*(0x1-_0x175520/0x64);await database_1['default']['shop'][_0x4ae319(0x22f)]({'where':{'id':_0xfb5e33[_0x4ae319(0x229)]},'data':{'balance':{'increment':_0x3f9049}}}),console[_0x4ae319(0x1fe)]('‚úÖ\x20Merchant\x20balance\x20updated:\x20+'+_0x3f9049[_0x4ae319(0x21d)](0x6)+_0x4ae319(0x207)+_0x175520+'%\x20commission)');}catch(_0x164be6){console[_0x4ae319(0x22d)](_0x4ae319(0x217),_0x164be6);}}async[a9_0x10e343(0x208)](_0x87f321,_0x1cac74){var _0x3e08f3=a9_0x10e343;try{const {id:_0x38600a}=_0x87f321['params'];if(!_0x38600a){_0x1cac74[_0x3e08f3(0x1ee)](0x190)['json']({'success':![],'message':_0x3e08f3(0x20a)});return;}console[_0x3e08f3(0x1fe)](_0x3e08f3(0x221)+_0x38600a);const _0x34e198=await database_1[_0x3e08f3(0x22e)]['payment'][_0x3e08f3(0x22b)]({'where':{'OR':[{'id':_0x38600a},{'orderId':_0x38600a},{'gatewayOrderId':_0x38600a},{'gatewayPaymentId':_0x38600a}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x34e198){_0x1cac74[_0x3e08f3(0x1ee)](0x194)[_0x3e08f3(0x234)]({'success':![],'message':_0x3e08f3(0x1ef)});return;}console[_0x3e08f3(0x1fe)](_0x3e08f3(0x219)+_0x34e198['id']+'\x20('+_0x34e198[_0x3e08f3(0x1ee)]+')'),_0x1cac74['json']({'success':!![],'data':{'id':_0x34e198['id'],'gateway':_0x34e198[_0x3e08f3(0x222)],'amount':_0x34e198[_0x3e08f3(0x223)],'currency':_0x34e198[_0x3e08f3(0x1f9)],'status':_0x34e198[_0x3e08f3(0x1ee)],'gatewayOrderId':_0x34e198[_0x3e08f3(0x1f4)],'gatewayPaymentId':_0x34e198[_0x3e08f3(0x205)],'successUrl':_0x34e198[_0x3e08f3(0x1f8)],'failUrl':_0x34e198[_0x3e08f3(0x1f3)],'pendingUrl':_0x34e198['pendingUrl'],'customerEmail':_0x34e198[_0x3e08f3(0x215)],'customerName':_0x34e198[_0x3e08f3(0x209)],'merchantBrand':_0x34e198[_0x3e08f3(0x204)]['name'],'createdAt':_0x34e198[_0x3e08f3(0x218)],'updatedAt':_0x34e198[_0x3e08f3(0x1fa)]}});}catch(_0x5a8432){console[_0x3e08f3(0x22d)](_0x3e08f3(0x236),_0x5a8432),_0x1cac74[_0x3e08f3(0x1ee)](0x1f4)['json']({'success':![],'message':_0x3e08f3(0x1fb),'error':_0x5a8432 instanceof Error?_0x5a8432[_0x3e08f3(0x20e)]:'Unknown\x20error'});}}}exports[a9_0x10e343(0x232)]=OnRampController;