'use strict';function a11_0x3a5a(){var _0x38ff37=['gateway','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','resolve','message','failUrl','Payment\x20not\x20found','getOwnPropertyNames','configurable','Payment\x20ID\x20is\x20required','updateMerchantBalanceForPaidPayment','\x20USDT\x20(after\x20','then','Payment\x20ID\x20and\x20status\x20are\x20required','length','30Iigfgm','‚ùå\x20OnRamp\x20status\x20update\x20error:','getPaymentData','üöÄ\x20OnRamp\x20status\x20update:\x20','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','customerEmail','\x20->\x20','gatewayPaymentId','8xnwtIv','9882496WwAzpd','json','\x20updated\x20to\x20','currency','OnRampController','gatewayOrderId','findFirst','update','__setModuleDefault','invoiceTotalSum','59101JIgYdk','shopId','convertToUSDT','200fvvdQI','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','amount','defineProperty','__importStar','343500kmJzag','6153616LAxhtm','1910515hBQsbe','updatedAt','‚úÖ\x20Found\x20payment:\x20','name','log','get','payment','onramp_system','status','1278324KcWbQZ','__esModule','Unknown\x20error','1455687qEXofU','PAID','default','__importDefault','../config/database','USD','toUpperCase','create','error','getOwnPropertyDescriptor'];a11_0x3a5a=function(){return _0x38ff37;};return a11_0x3a5a();}var a11_0x15c24=a11_0xa93c;function a11_0xa93c(_0x41dec0,_0x4db82e){_0x41dec0=_0x41dec0-0x80;var _0x3a5a90=a11_0x3a5a();var _0xa93cb0=_0x3a5a90[_0x41dec0];return _0xa93cb0;}(function(_0x91568d,_0x13b1a6){var _0x31f085=a11_0xa93c,_0x408504=_0x91568d();while(!![]){try{var _0x3b6f8f=parseInt(_0x31f085(0xa1))/0x1*(parseInt(_0x31f085(0x8e))/0x2)+-parseInt(_0x31f085(0xa9))/0x3+-parseInt(_0x31f085(0x96))/0x4*(-parseInt(_0x31f085(0xab))/0x5)+parseInt(_0x31f085(0xb4))/0x6+parseInt(_0x31f085(0xaa))/0x7+parseInt(_0x31f085(0x97))/0x8+-parseInt(_0x31f085(0xb7))/0x9*(parseInt(_0x31f085(0xa4))/0xa);if(_0x3b6f8f===_0x13b1a6)break;else _0x408504['push'](_0x408504['shift']());}catch(_0x411941){_0x408504['push'](_0x408504['shift']());}}}(a11_0x3a5a,0x9984f));var __createBinding=this&&this['__createBinding']||(Object[a11_0x15c24(0xbe)]?function(_0x5953a3,_0x4f005b,_0x2e236d,_0x2cbd64){var _0xf12c6d=a11_0x15c24;if(_0x2cbd64===undefined)_0x2cbd64=_0x2e236d;var _0x5d9109=Object[_0xf12c6d(0xc0)](_0x4f005b,_0x2e236d);(!_0x5d9109||(_0xf12c6d(0xb0)in _0x5d9109?!_0x4f005b[_0xf12c6d(0xb5)]:_0x5d9109['writable']||_0x5d9109[_0xf12c6d(0x87)]))&&(_0x5d9109={'enumerable':!![],'get':function(){return _0x4f005b[_0x2e236d];}}),Object[_0xf12c6d(0xa7)](_0x5953a3,_0x2cbd64,_0x5d9109);}:function(_0x370821,_0x3f6f9f,_0x3af3ae,_0x4b0e70){if(_0x4b0e70===undefined)_0x4b0e70=_0x3af3ae;_0x370821[_0x4b0e70]=_0x3f6f9f[_0x3af3ae];}),__setModuleDefault=this&&this[a11_0x15c24(0x9f)]||(Object[a11_0x15c24(0xbe)]?function(_0x4f55f7,_0x249a9b){var _0x598ff6=a11_0x15c24;Object[_0x598ff6(0xa7)](_0x4f55f7,'default',{'enumerable':!![],'value':_0x249a9b});}:function(_0x64a7df,_0x4dd4ae){var _0x568eda=a11_0x15c24;_0x64a7df[_0x568eda(0xb9)]=_0x4dd4ae;}),__importStar=this&&this[a11_0x15c24(0xa8)]||(function(){var _0x4094f2=function(_0x588e99){var _0x58bb4c=a11_0xa93c;return _0x4094f2=Object[_0x58bb4c(0x86)]||function(_0x20e254){var _0x4b0140=_0x58bb4c,_0x1a85d3=[];for(var _0x27b503 in _0x20e254)if(Object['prototype']['hasOwnProperty']['call'](_0x20e254,_0x27b503))_0x1a85d3[_0x1a85d3[_0x4b0140(0x8d)]]=_0x27b503;return _0x1a85d3;},_0x4094f2(_0x588e99);};return function(_0x23cc7c){var _0x43fc6e=a11_0xa93c;if(_0x23cc7c&&_0x23cc7c['__esModule'])return _0x23cc7c;var _0x57873d={};if(_0x23cc7c!=null){for(var _0x111e20=_0x4094f2(_0x23cc7c),_0x3a1832=0x0;_0x3a1832<_0x111e20[_0x43fc6e(0x8d)];_0x3a1832++)if(_0x111e20[_0x3a1832]!=='default')__createBinding(_0x57873d,_0x23cc7c,_0x111e20[_0x3a1832]);}return __setModuleDefault(_0x57873d,_0x23cc7c),_0x57873d;};}()),__importDefault=this&&this[a11_0x15c24(0xba)]||function(_0x14e00c){var _0x1be35d=a11_0x15c24;return _0x14e00c&&_0x14e00c[_0x1be35d(0xb5)]?_0x14e00c:{'default':_0x14e00c};};Object[a11_0x15c24(0xa7)](exports,a11_0x15c24(0xb5),{'value':!![]}),exports[a11_0x15c24(0x9b)]=void 0x0;const database_1=__importDefault(require(a11_0x15c24(0xbb)));class OnRampController{async['updatePaymentStatus'](_0x4f8ca3,_0x344e67){var _0x286f89=a11_0x15c24;try{const {paymentId:_0x46b3e2,status:_0x36d796,referenceId:_0x375052,transactionHash:_0xfb82a5,actualCryptoAmount:_0x1cd3bd,orderId:_0x5f2d27}=_0x4f8ca3['body'];if(!_0x46b3e2||!_0x36d796){_0x344e67[_0x286f89(0xb3)](0x190)[_0x286f89(0x98)]({'success':![],'message':_0x286f89(0x8c)});return;}console[_0x286f89(0xaf)](_0x286f89(0x91)+_0x46b3e2+_0x286f89(0x94)+_0x36d796),console[_0x286f89(0xaf)]('üìù\x20Data:',{'referenceId':_0x375052,'transactionHash':_0xfb82a5,'actualCryptoAmount':_0x1cd3bd,'orderId':_0x5f2d27});const _0x5d9fce=await database_1[_0x286f89(0xb9)][_0x286f89(0xb1)]['findFirst']({'where':{'OR':[{'id':_0x46b3e2},{'orderId':_0x46b3e2},{'gatewayOrderId':_0x46b3e2},{'gatewayPaymentId':_0x46b3e2}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5d9fce){_0x344e67[_0x286f89(0xb3)](0x194)[_0x286f89(0x98)]({'success':![],'message':_0x286f89(0x85)});return;}if(_0x5d9fce[_0x286f89(0x80)]!=='onramp'){_0x344e67['status'](0x190)[_0x286f89(0x98)]({'success':![],'message':'This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway'});return;}const _0x26962d={'status':_0x36d796[_0x286f89(0xbd)](),'statusChangedAt':new Date(),'statusChangedBy':_0x286f89(0xb2)};_0x375052&&(_0x26962d[_0x286f89(0x9c)]=_0x375052);_0xfb82a5&&(_0x26962d[_0x286f89(0x95)]=_0xfb82a5);_0x1cd3bd&&(_0x26962d[_0x286f89(0xa0)]=_0x1cd3bd);const _0x277527=await database_1[_0x286f89(0xb9)]['payment'][_0x286f89(0x9e)]({'where':{'id':_0x5d9fce['id']},'data':_0x26962d});console[_0x286f89(0xaf)]('‚úÖ\x20OnRamp\x20payment\x20'+_0x5d9fce['id']+_0x286f89(0x99)+_0x36d796),_0x36d796['toUpperCase']()===_0x286f89(0xb8)&&_0x5d9fce[_0x286f89(0xb3)]!==_0x286f89(0xb8)&&await this[_0x286f89(0x89)](_0x5d9fce),_0x344e67['json']({'success':!![],'message':'Payment\x20status\x20updated\x20successfully','data':{'paymentId':_0x277527['id'],'status':_0x277527[_0x286f89(0xb3)],'referenceId':_0x375052,'transactionHash':_0xfb82a5,'actualCryptoAmount':_0x1cd3bd}});}catch(_0x11f0f9){console[_0x286f89(0xbf)](_0x286f89(0x8f),_0x11f0f9),_0x344e67[_0x286f89(0xb3)](0x1f4)[_0x286f89(0x98)]({'success':![],'message':'Internal\x20server\x20error','error':_0x11f0f9 instanceof Error?_0x11f0f9[_0x286f89(0x83)]:_0x286f89(0xb6)});}}async['updateMerchantBalanceForPaidPayment'](_0x5676b3){var _0xb6c31c=a11_0x15c24;try{console['log']('üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20'+_0x5676b3['id']);let _0x2d22b6;if(_0x5676b3['currency']===_0xb6c31c(0xbc))_0x2d22b6=_0x5676b3[_0xb6c31c(0xa6)];else{const {currencyService:_0x4dd8bd}=await Promise[_0xb6c31c(0x82)]()[_0xb6c31c(0x8b)](()=>__importStar(require('../services/currencyService')));_0x2d22b6=await _0x4dd8bd[_0xb6c31c(0xa3)](_0x5676b3[_0xb6c31c(0xa6)],_0x5676b3[_0xb6c31c(0x9a)]);}await database_1[_0xb6c31c(0xb9)][_0xb6c31c(0xb1)][_0xb6c31c(0x9e)]({'where':{'id':_0x5676b3['id']},'data':{'amountUSDT':_0x2d22b6,'paidAt':new Date()}});const _0x4eb060=0xa,_0x3bdae2=_0x2d22b6*(0x1-_0x4eb060/0x64);await database_1[_0xb6c31c(0xb9)]['shop'][_0xb6c31c(0x9e)]({'where':{'id':_0x5676b3[_0xb6c31c(0xa2)]},'data':{'balance':{'increment':_0x3bdae2}}}),console[_0xb6c31c(0xaf)](_0xb6c31c(0x92)+_0x3bdae2['toFixed'](0x6)+_0xb6c31c(0x8a)+_0x4eb060+'%\x20commission)');}catch(_0x4cbce3){console[_0xb6c31c(0xbf)](_0xb6c31c(0x81),_0x4cbce3);}}async[a11_0x15c24(0x90)](_0x2abe15,_0x225126){var _0x9c55bd=a11_0x15c24;try{const {id:_0x2cde36}=_0x2abe15['params'];if(!_0x2cde36){_0x225126[_0x9c55bd(0xb3)](0x190)['json']({'success':![],'message':_0x9c55bd(0x88)});return;}console['log']('üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20'+_0x2cde36);const _0x57430a=await database_1['default'][_0x9c55bd(0xb1)][_0x9c55bd(0x9d)]({'where':{'OR':[{'id':_0x2cde36},{'orderId':_0x2cde36},{'gatewayOrderId':_0x2cde36},{'gatewayPaymentId':_0x2cde36}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x57430a){_0x225126[_0x9c55bd(0xb3)](0x194)[_0x9c55bd(0x98)]({'success':![],'message':_0x9c55bd(0x85)});return;}console[_0x9c55bd(0xaf)](_0x9c55bd(0xad)+_0x57430a['id']+'\x20('+_0x57430a[_0x9c55bd(0xb3)]+')'),_0x225126[_0x9c55bd(0x98)]({'success':!![],'data':{'id':_0x57430a['id'],'gateway':_0x57430a[_0x9c55bd(0x80)],'amount':_0x57430a['amount'],'currency':_0x57430a['currency'],'status':_0x57430a['status'],'gatewayOrderId':_0x57430a[_0x9c55bd(0x9c)],'gatewayPaymentId':_0x57430a['gatewayPaymentId'],'successUrl':_0x57430a['successUrl'],'failUrl':_0x57430a[_0x9c55bd(0x84)],'pendingUrl':_0x57430a['pendingUrl'],'customerEmail':_0x57430a[_0x9c55bd(0x93)],'customerName':_0x57430a['customerName'],'merchantBrand':_0x57430a['shop'][_0x9c55bd(0xae)],'createdAt':_0x57430a['createdAt'],'updatedAt':_0x57430a[_0x9c55bd(0xac)]}});}catch(_0x57e762){console[_0x9c55bd(0xbf)](_0x9c55bd(0xa5),_0x57e762),_0x225126[_0x9c55bd(0xb3)](0x1f4)[_0x9c55bd(0x98)]({'success':![],'message':'Internal\x20server\x20error','error':_0x57e762 instanceof Error?_0x57e762[_0x9c55bd(0x83)]:'Unknown\x20error'});}}}exports[a11_0x15c24(0x9b)]=OnRampController;