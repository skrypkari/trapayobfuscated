'use strict';function a9_0x1d5d(_0x382875,_0x357589){var _0x3e659e=a9_0x3e65();return a9_0x1d5d=function(_0x1d5d39,_0x32fc02){_0x1d5d39=_0x1d5d39-0x74;var _0x486933=_0x3e659e[_0x1d5d39];return _0x486933;},a9_0x1d5d(_0x382875,_0x357589);}var a9_0x437b6e=a9_0x1d5d;(function(_0x57c176,_0xf2a185){var _0x3238c5=a9_0x1d5d,_0x426632=_0x57c176();while(!![]){try{var _0x5310a8=-parseInt(_0x3238c5(0xb2))/0x1*(-parseInt(_0x3238c5(0xb7))/0x2)+-parseInt(_0x3238c5(0xa0))/0x3*(-parseInt(_0x3238c5(0x78))/0x4)+parseInt(_0x3238c5(0xbb))/0x5+-parseInt(_0x3238c5(0x9a))/0x6*(-parseInt(_0x3238c5(0x76))/0x7)+-parseInt(_0x3238c5(0xa5))/0x8+parseInt(_0x3238c5(0x84))/0x9+-parseInt(_0x3238c5(0xb6))/0xa;if(_0x5310a8===_0xf2a185)break;else _0x426632['push'](_0x426632['shift']());}catch(_0x5134ef){_0x426632['push'](_0x426632['shift']());}}}(a9_0x3e65,0xe72bb));var __createBinding=this&&this[a9_0x437b6e(0x77)]||(Object[a9_0x437b6e(0x87)]?function(_0x6f8c7b,_0x2c7e0f,_0x5d50cf,_0x39361c){var _0x28b97f=a9_0x437b6e;if(_0x39361c===undefined)_0x39361c=_0x5d50cf;var _0x2990c4=Object[_0x28b97f(0x8a)](_0x2c7e0f,_0x5d50cf);(!_0x2990c4||(_0x28b97f(0x7a)in _0x2990c4?!_0x2c7e0f['__esModule']:_0x2990c4['writable']||_0x2990c4[_0x28b97f(0x91)]))&&(_0x2990c4={'enumerable':!![],'get':function(){return _0x2c7e0f[_0x5d50cf];}}),Object[_0x28b97f(0x99)](_0x6f8c7b,_0x39361c,_0x2990c4);}:function(_0x143e2c,_0x2f1527,_0x522eb6,_0x3e5443){if(_0x3e5443===undefined)_0x3e5443=_0x522eb6;_0x143e2c[_0x3e5443]=_0x2f1527[_0x522eb6];}),__setModuleDefault=this&&this[a9_0x437b6e(0xa8)]||(Object[a9_0x437b6e(0x87)]?function(_0x4c4478,_0x3dc9fe){var _0x426079=a9_0x437b6e;Object[_0x426079(0x99)](_0x4c4478,_0x426079(0x81),{'enumerable':!![],'value':_0x3dc9fe});}:function(_0x1c7d54,_0x505155){_0x1c7d54['default']=_0x505155;}),__importStar=this&&this[a9_0x437b6e(0xa7)]||(function(){var _0x163cfa=function(_0x55cc20){var _0x221156=a9_0x1d5d;return _0x163cfa=Object[_0x221156(0xb9)]||function(_0x41fd03){var _0x8d1e42=_0x221156,_0x43e810=[];for(var _0x30253f in _0x41fd03)if(Object[_0x8d1e42(0x9d)][_0x8d1e42(0x93)][_0x8d1e42(0xbd)](_0x41fd03,_0x30253f))_0x43e810[_0x43e810[_0x8d1e42(0x7f)]]=_0x30253f;return _0x43e810;},_0x163cfa(_0x55cc20);};return function(_0x4894a7){var _0x3a7538=a9_0x1d5d;if(_0x4894a7&&_0x4894a7['__esModule'])return _0x4894a7;var _0x414026={};if(_0x4894a7!=null){for(var _0x39f092=_0x163cfa(_0x4894a7),_0x418a58=0x0;_0x418a58<_0x39f092[_0x3a7538(0x7f)];_0x418a58++)if(_0x39f092[_0x418a58]!==_0x3a7538(0x81))__createBinding(_0x414026,_0x4894a7,_0x39f092[_0x418a58]);}return __setModuleDefault(_0x414026,_0x4894a7),_0x414026;};}()),__importDefault=this&&this[a9_0x437b6e(0xa4)]||function(_0xedc746){var _0x3bf5b8=a9_0x437b6e;return _0xedc746&&_0xedc746[_0x3bf5b8(0x90)]?_0xedc746:{'default':_0xedc746};};Object[a9_0x437b6e(0x99)](exports,'__esModule',{'value':!![]}),exports[a9_0x437b6e(0x7e)]=void 0x0;function a9_0x3e65(){var _0xfad286=['currency','__esModule','configurable','updatedAt','hasOwnProperty','update','message','shop','Payment\x20ID\x20and\x20status\x20are\x20required','status','defineProperty','831012Lzvcwd','Payment\x20ID\x20is\x20required','toUpperCase','prototype','✅\x20Found\x20payment:\x20','❌\x20OnRamp\x20get\x20payment\x20data\x20error:','3oqckTX','onramp_system','createdAt','🔍\x20Getting\x20OnRamp\x20payment\x20data:\x20','__importDefault','6451464gWPaWO','\x20->\x20','__importStar','__setModuleDefault','updateMerchantBalanceForPaidPayment','gatewayPaymentId','amount','log','Unknown\x20error','USD','gatewayOrderId','findFirst','json','23YBCJMy','onramp','Internal\x20server\x20error','failUrl','25029460BisGjA','149034skhMkh','payment','getOwnPropertyNames','resolve','2476215SCOpqr','params','call','shopId','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','7QhHPKa','__createBinding','6664196nwzOib','❌\x20Failed\x20to\x20update\x20merchant\x20balance:','get','body','Payment\x20not\x20found','convertToUSDT','OnRampController','length','error','default','gateway','pendingUrl','2183121MLnybp','successUrl','\x20USDT\x20(after\x20','create','PAID','name','getOwnPropertyDescriptor','invoiceTotalSum','❌\x20OnRamp\x20status\x20update\x20error:','Payment\x20status\x20updated\x20successfully','../config/database'];a9_0x3e65=function(){return _0xfad286;};return a9_0x3e65();}const database_1=__importDefault(require(a9_0x437b6e(0x8e)));class OnRampController{async['updatePaymentStatus'](_0x583692,_0x175dd1){var _0x5d71b7=a9_0x437b6e;try{const {paymentId:_0x544547,status:_0x1768e2,referenceId:_0x3196cf,transactionHash:_0x33a86d,actualCryptoAmount:_0x2dfcec,orderId:_0x5d1c0f}=_0x583692[_0x5d71b7(0x7b)];if(!_0x544547||!_0x1768e2){_0x175dd1[_0x5d71b7(0x98)](0x190)[_0x5d71b7(0xb1)]({'success':![],'message':_0x5d71b7(0x97)});return;}console['log']('🚀\x20OnRamp\x20status\x20update:\x20'+_0x544547+_0x5d71b7(0xa6)+_0x1768e2),console[_0x5d71b7(0xac)]('📝\x20Data:',{'referenceId':_0x3196cf,'transactionHash':_0x33a86d,'actualCryptoAmount':_0x2dfcec,'orderId':_0x5d1c0f});const _0x28c5c2=await database_1[_0x5d71b7(0x81)][_0x5d71b7(0xb8)]['findFirst']({'where':{'OR':[{'id':_0x544547},{'orderId':_0x544547},{'gatewayOrderId':_0x544547},{'gatewayPaymentId':_0x544547}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x28c5c2){_0x175dd1['status'](0x194)['json']({'success':![],'message':_0x5d71b7(0x7c)});return;}if(_0x28c5c2[_0x5d71b7(0x82)]!==_0x5d71b7(0xb3)){_0x175dd1[_0x5d71b7(0x98)](0x190)['json']({'success':![],'message':_0x5d71b7(0x75)});return;}const _0x4e76d2={'status':_0x1768e2['toUpperCase'](),'statusChangedAt':new Date(),'statusChangedBy':_0x5d71b7(0xa1)};_0x3196cf&&(_0x4e76d2['gatewayOrderId']=_0x3196cf);_0x33a86d&&(_0x4e76d2['gatewayPaymentId']=_0x33a86d);_0x2dfcec&&(_0x4e76d2[_0x5d71b7(0x8b)]=_0x2dfcec);const _0xc3960=await database_1[_0x5d71b7(0x81)][_0x5d71b7(0xb8)][_0x5d71b7(0x94)]({'where':{'id':_0x28c5c2['id']},'data':_0x4e76d2});console[_0x5d71b7(0xac)]('✅\x20OnRamp\x20payment\x20'+_0x28c5c2['id']+'\x20updated\x20to\x20'+_0x1768e2),_0x1768e2[_0x5d71b7(0x9c)]()==='PAID'&&_0x28c5c2[_0x5d71b7(0x98)]!==_0x5d71b7(0x88)&&await this['updateMerchantBalanceForPaidPayment'](_0x28c5c2),_0x175dd1[_0x5d71b7(0xb1)]({'success':!![],'message':_0x5d71b7(0x8d),'data':{'paymentId':_0xc3960['id'],'status':_0xc3960[_0x5d71b7(0x98)],'referenceId':_0x3196cf,'transactionHash':_0x33a86d,'actualCryptoAmount':_0x2dfcec}});}catch(_0x2249e6){console[_0x5d71b7(0x80)](_0x5d71b7(0x8c),_0x2249e6),_0x175dd1[_0x5d71b7(0x98)](0x1f4)[_0x5d71b7(0xb1)]({'success':![],'message':_0x5d71b7(0xb4),'error':_0x2249e6 instanceof Error?_0x2249e6[_0x5d71b7(0x95)]:_0x5d71b7(0xad)});}}async[a9_0x437b6e(0xa9)](_0xb654a7){var _0xade207=a9_0x437b6e;try{console[_0xade207(0xac)]('💰\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20'+_0xb654a7['id']);let _0x2f9a6a;if(_0xb654a7[_0xade207(0x8f)]===_0xade207(0xae))_0x2f9a6a=_0xb654a7[_0xade207(0xab)];else{const {currencyService:_0x437eed}=await Promise[_0xade207(0xba)]()['then'](()=>__importStar(require('../services/currencyService')));_0x2f9a6a=await _0x437eed[_0xade207(0x7d)](_0xb654a7['amount'],_0xb654a7[_0xade207(0x8f)]);}await database_1[_0xade207(0x81)][_0xade207(0xb8)][_0xade207(0x94)]({'where':{'id':_0xb654a7['id']},'data':{'amountUSDT':_0x2f9a6a,'paidAt':new Date()}});const _0x55c91a=0xa,_0x235a40=_0x2f9a6a*(0x1-_0x55c91a/0x64);await database_1[_0xade207(0x81)]['shop'][_0xade207(0x94)]({'where':{'id':_0xb654a7[_0xade207(0x74)]},'data':{'balance':{'increment':_0x235a40}}}),console['log']('✅\x20Merchant\x20balance\x20updated:\x20+'+_0x235a40['toFixed'](0x6)+_0xade207(0x86)+_0x55c91a+'%\x20commission)');}catch(_0x14b2db){console[_0xade207(0x80)](_0xade207(0x79),_0x14b2db);}}async['getPaymentData'](_0x112999,_0x566eaf){var _0x364038=a9_0x437b6e;try{const {id:_0x28ab7b}=_0x112999[_0x364038(0xbc)];if(!_0x28ab7b){_0x566eaf[_0x364038(0x98)](0x190)['json']({'success':![],'message':_0x364038(0x9b)});return;}console['log'](_0x364038(0xa3)+_0x28ab7b);const _0x14380a=await database_1['default'][_0x364038(0xb8)][_0x364038(0xb0)]({'where':{'OR':[{'id':_0x28ab7b},{'orderId':_0x28ab7b},{'gatewayOrderId':_0x28ab7b},{'gatewayPaymentId':_0x28ab7b}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x14380a){_0x566eaf[_0x364038(0x98)](0x194)['json']({'success':![],'message':_0x364038(0x7c)});return;}console[_0x364038(0xac)](_0x364038(0x9e)+_0x14380a['id']+'\x20('+_0x14380a['status']+')'),_0x566eaf[_0x364038(0xb1)]({'success':!![],'data':{'id':_0x14380a['id'],'gateway':_0x14380a[_0x364038(0x82)],'amount':_0x14380a['amount'],'currency':_0x14380a['currency'],'status':_0x14380a[_0x364038(0x98)],'gatewayOrderId':_0x14380a[_0x364038(0xaf)],'gatewayPaymentId':_0x14380a[_0x364038(0xaa)],'successUrl':_0x14380a[_0x364038(0x85)],'failUrl':_0x14380a[_0x364038(0xb5)],'pendingUrl':_0x14380a[_0x364038(0x83)],'customerEmail':_0x14380a['customerEmail'],'customerName':_0x14380a['customerName'],'merchantBrand':_0x14380a[_0x364038(0x96)][_0x364038(0x89)],'createdAt':_0x14380a[_0x364038(0xa2)],'updatedAt':_0x14380a[_0x364038(0x92)]}});}catch(_0x3e9872){console[_0x364038(0x80)](_0x364038(0x9f),_0x3e9872),_0x566eaf['status'](0x1f4)[_0x364038(0xb1)]({'success':![],'message':_0x364038(0xb4),'error':_0x3e9872 instanceof Error?_0x3e9872[_0x364038(0x95)]:'Unknown\x20error'});}}}exports[a9_0x437b6e(0x7e)]=OnRampController;