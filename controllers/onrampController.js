'use strict';var a9_0x279a5c=a9_0x5a2b;function a9_0x5a2b(_0x5e25ad,_0x45a2e7){var _0x54f8ce=a9_0x54f8();return a9_0x5a2b=function(_0x5a2b05,_0x4d525b){_0x5a2b05=_0x5a2b05-0x99;var _0x2f237e=_0x54f8ce[_0x5a2b05];return _0x2f237e;},a9_0x5a2b(_0x5e25ad,_0x45a2e7);}function a9_0x54f8(){var _0x161b89=['shopId','__setModuleDefault','log','getOwnPropertyNames','updatedAt','payment','prototype','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','3481083aDLhXj','hasOwnProperty','1382165BusREK','206FgrdeF','successUrl','gatewayOrderId','Payment\x20not\x20found','updateMerchantBalanceForPaidPayment','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','gatewayPaymentId','OnRampController','currency','Payment\x20ID\x20and\x20status\x20are\x20required','name','1331302Lkppqg','getPaymentData','json','../services/currencyService','358474PaLPvs','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','getOwnPropertyDescriptor','length','createdAt','__importStar','message','‚úÖ\x20Found\x20payment:\x20','PAID','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','Payment\x20ID\x20is\x20required','Internal\x20server\x20error','shop','‚úÖ\x20OnRamp\x20payment\x20','\x20USDT\x20(after\x20','__esModule','amount','resolve','591500FPiCse','1189600uEfhEW','‚ùå\x20OnRamp\x20status\x20update\x20error:','pendingUrl','failUrl','customerEmail','defineProperty','6puWvRA','body','\x20updated\x20to\x20','params','create','convertToUSDT','__importDefault','üìù\x20Data:','../config/database','error','USD','\x20->\x20','updatePaymentStatus','Unknown\x20error','11148nvfMlk','invoiceTotalSum','writable','findFirst','gateway','update','status','default','%\x20commission)','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:'];a9_0x54f8=function(){return _0x161b89;};return a9_0x54f8();}(function(_0x5d5e91,_0x4c1e80){var _0x2e68e2=a9_0x5a2b,_0x4633ee=_0x5d5e91();while(!![]){try{var _0x575afe=-parseInt(_0x2e68e2(0xd8))/0x1+parseInt(_0x2e68e2(0xc8))/0x2*(parseInt(_0x2e68e2(0xb3))/0x3)+parseInt(_0x2e68e2(0x9e))/0x4+-parseInt(_0x2e68e2(0xc7))/0x5+-parseInt(_0x2e68e2(0xa5))/0x6*(parseInt(_0x2e68e2(0xd4))/0x7)+parseInt(_0x2e68e2(0x9f))/0x8+parseInt(_0x2e68e2(0xc5))/0x9;if(_0x575afe===_0x4c1e80)break;else _0x4633ee['push'](_0x4633ee['shift']());}catch(_0x33f6fb){_0x4633ee['push'](_0x4633ee['shift']());}}}(a9_0x54f8,0x3ad79));var __createBinding=this&&this['__createBinding']||(Object[a9_0x279a5c(0xa9)]?function(_0x5707b2,_0x46d8a8,_0x356c51,_0x12f7ce){var _0x50c111=a9_0x279a5c;if(_0x12f7ce===undefined)_0x12f7ce=_0x356c51;var _0x2d045a=Object[_0x50c111(0xda)](_0x46d8a8,_0x356c51);(!_0x2d045a||('get'in _0x2d045a?!_0x46d8a8['__esModule']:_0x2d045a[_0x50c111(0xb5)]||_0x2d045a['configurable']))&&(_0x2d045a={'enumerable':!![],'get':function(){return _0x46d8a8[_0x356c51];}}),Object[_0x50c111(0xa4)](_0x5707b2,_0x12f7ce,_0x2d045a);}:function(_0x2b6470,_0x2b2317,_0x12c94c,_0x5dcd25){if(_0x5dcd25===undefined)_0x5dcd25=_0x12c94c;_0x2b6470[_0x5dcd25]=_0x2b2317[_0x12c94c];}),__setModuleDefault=this&&this[a9_0x279a5c(0xbe)]||(Object['create']?function(_0x408e62,_0x1759a3){var _0x3be96c=a9_0x279a5c;Object[_0x3be96c(0xa4)](_0x408e62,_0x3be96c(0xba),{'enumerable':!![],'value':_0x1759a3});}:function(_0x3b76c7,_0x284b15){var _0x5ed4f7=a9_0x279a5c;_0x3b76c7[_0x5ed4f7(0xba)]=_0x284b15;}),__importStar=this&&this[a9_0x279a5c(0xdd)]||(function(){var _0x5d62a3=function(_0x5e0dff){var _0x5b07fe=a9_0x5a2b;return _0x5d62a3=Object[_0x5b07fe(0xc0)]||function(_0x343ddf){var _0x2f4546=_0x5b07fe,_0x1b8fb0=[];for(var _0xda2652 in _0x343ddf)if(Object[_0x2f4546(0xc3)][_0x2f4546(0xc6)]['call'](_0x343ddf,_0xda2652))_0x1b8fb0[_0x1b8fb0[_0x2f4546(0xdb)]]=_0xda2652;return _0x1b8fb0;},_0x5d62a3(_0x5e0dff);};return function(_0x13e017){var _0x54512b=a9_0x5a2b;if(_0x13e017&&_0x13e017[_0x54512b(0x9b)])return _0x13e017;var _0x29ca9e={};if(_0x13e017!=null){for(var _0xe82212=_0x5d62a3(_0x13e017),_0x57cbcd=0x0;_0x57cbcd<_0xe82212[_0x54512b(0xdb)];_0x57cbcd++)if(_0xe82212[_0x57cbcd]!==_0x54512b(0xba))__createBinding(_0x29ca9e,_0x13e017,_0xe82212[_0x57cbcd]);}return __setModuleDefault(_0x29ca9e,_0x13e017),_0x29ca9e;};}()),__importDefault=this&&this[a9_0x279a5c(0xab)]||function(_0x2973f8){return _0x2973f8&&_0x2973f8['__esModule']?_0x2973f8:{'default':_0x2973f8};};Object[a9_0x279a5c(0xa4)](exports,'__esModule',{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require(a9_0x279a5c(0xad)));class OnRampController{async[a9_0x279a5c(0xb1)](_0x3c34a0,_0x4418c9){var _0x4e67b8=a9_0x279a5c;try{const {paymentId:_0x56e7df,status:_0x282b5d,referenceId:_0x19b454,transactionHash:_0x1b147f,actualCryptoAmount:_0x2ddda0,orderId:_0x4e6785}=_0x3c34a0[_0x4e67b8(0xa6)];if(!_0x56e7df||!_0x282b5d){_0x4418c9[_0x4e67b8(0xb9)](0x190)[_0x4e67b8(0xd6)]({'success':![],'message':_0x4e67b8(0xd2)});return;}console['log']('üöÄ\x20OnRamp\x20status\x20update:\x20'+_0x56e7df+_0x4e67b8(0xb0)+_0x282b5d),console['log'](_0x4e67b8(0xac),{'referenceId':_0x19b454,'transactionHash':_0x1b147f,'actualCryptoAmount':_0x2ddda0,'orderId':_0x4e6785});const _0x34e851=await database_1['default'][_0x4e67b8(0xc2)]['findFirst']({'where':{'OR':[{'id':_0x56e7df},{'orderId':_0x56e7df},{'gatewayOrderId':_0x56e7df},{'gatewayPaymentId':_0x56e7df}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x34e851){_0x4418c9[_0x4e67b8(0xb9)](0x194)[_0x4e67b8(0xd6)]({'success':![],'message':_0x4e67b8(0xcb)});return;}if(_0x34e851[_0x4e67b8(0xb7)]!=='onramp'){_0x4418c9[_0x4e67b8(0xb9)](0x190)[_0x4e67b8(0xd6)]({'success':![],'message':_0x4e67b8(0xcd)});return;}const _0x5da2e8={'status':_0x282b5d['toUpperCase'](),'statusChangedAt':new Date(),'statusChangedBy':'onramp_system'};_0x19b454&&(_0x5da2e8[_0x4e67b8(0xca)]=_0x19b454);_0x1b147f&&(_0x5da2e8[_0x4e67b8(0xcf)]=_0x1b147f);_0x2ddda0&&(_0x5da2e8[_0x4e67b8(0xb4)]=_0x2ddda0);const _0x11b371=await database_1[_0x4e67b8(0xba)][_0x4e67b8(0xc2)][_0x4e67b8(0xb8)]({'where':{'id':_0x34e851['id']},'data':_0x5da2e8});console['log'](_0x4e67b8(0x99)+_0x34e851['id']+_0x4e67b8(0xa7)+_0x282b5d),_0x282b5d['toUpperCase']()===_0x4e67b8(0xe0)&&_0x34e851[_0x4e67b8(0xb9)]!==_0x4e67b8(0xe0)&&await this['updateMerchantBalanceForPaidPayment'](_0x34e851),_0x4418c9[_0x4e67b8(0xd6)]({'success':!![],'message':'Payment\x20status\x20updated\x20successfully','data':{'paymentId':_0x11b371['id'],'status':_0x11b371[_0x4e67b8(0xb9)],'referenceId':_0x19b454,'transactionHash':_0x1b147f,'actualCryptoAmount':_0x2ddda0}});}catch(_0x34314b){console[_0x4e67b8(0xae)](_0x4e67b8(0xa0),_0x34314b),_0x4418c9[_0x4e67b8(0xb9)](0x1f4)[_0x4e67b8(0xd6)]({'success':![],'message':'Internal\x20server\x20error','error':_0x34314b instanceof Error?_0x34314b['message']:_0x4e67b8(0xb2)});}}async[a9_0x279a5c(0xcc)](_0x1889e3){var _0x46c192=a9_0x279a5c;try{console['log'](_0x46c192(0xd9)+_0x1889e3['id']);let _0x4e176c;if(_0x1889e3[_0x46c192(0xd1)]===_0x46c192(0xaf))_0x4e176c=_0x1889e3[_0x46c192(0x9c)];else{const {currencyService:_0x3dccd5}=await Promise[_0x46c192(0x9d)]()['then'](()=>__importStar(require(_0x46c192(0xd7))));_0x4e176c=await _0x3dccd5[_0x46c192(0xaa)](_0x1889e3[_0x46c192(0x9c)],_0x1889e3[_0x46c192(0xd1)]);}await database_1['default'][_0x46c192(0xc2)][_0x46c192(0xb8)]({'where':{'id':_0x1889e3['id']},'data':{'amountUSDT':_0x4e176c,'paidAt':new Date()}});const _0x5ab931=0xa,_0x5c7e42=_0x4e176c*(0x1-_0x5ab931/0x64);await database_1['default'][_0x46c192(0xe4)]['update']({'where':{'id':_0x1889e3[_0x46c192(0xbd)]},'data':{'balance':{'increment':_0x5c7e42}}}),console['log'](_0x46c192(0xce)+_0x5c7e42['toFixed'](0x6)+_0x46c192(0x9a)+_0x5ab931+_0x46c192(0xbb));}catch(_0x166c48){console[_0x46c192(0xae)](_0x46c192(0xc4),_0x166c48);}}async[a9_0x279a5c(0xd5)](_0x4d41e8,_0x15a99e){var _0x32b2c4=a9_0x279a5c;try{const {id:_0x2b0d31}=_0x4d41e8[_0x32b2c4(0xa8)];if(!_0x2b0d31){_0x15a99e[_0x32b2c4(0xb9)](0x190)[_0x32b2c4(0xd6)]({'success':![],'message':_0x32b2c4(0xe2)});return;}console[_0x32b2c4(0xbf)](_0x32b2c4(0xe1)+_0x2b0d31);const _0x47fe19=await database_1['default'][_0x32b2c4(0xc2)][_0x32b2c4(0xb6)]({'where':{'OR':[{'id':_0x2b0d31},{'orderId':_0x2b0d31},{'gatewayOrderId':_0x2b0d31},{'gatewayPaymentId':_0x2b0d31}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x47fe19){_0x15a99e['status'](0x194)[_0x32b2c4(0xd6)]({'success':![],'message':_0x32b2c4(0xcb)});return;}console[_0x32b2c4(0xbf)](_0x32b2c4(0xdf)+_0x47fe19['id']+'\x20('+_0x47fe19['status']+')'),_0x15a99e[_0x32b2c4(0xd6)]({'success':!![],'data':{'id':_0x47fe19['id'],'gateway':_0x47fe19[_0x32b2c4(0xb7)],'amount':_0x47fe19[_0x32b2c4(0x9c)],'currency':_0x47fe19[_0x32b2c4(0xd1)],'status':_0x47fe19[_0x32b2c4(0xb9)],'gatewayOrderId':_0x47fe19[_0x32b2c4(0xca)],'gatewayPaymentId':_0x47fe19['gatewayPaymentId'],'successUrl':_0x47fe19[_0x32b2c4(0xc9)],'failUrl':_0x47fe19[_0x32b2c4(0xa2)],'pendingUrl':_0x47fe19[_0x32b2c4(0xa1)],'customerEmail':_0x47fe19[_0x32b2c4(0xa3)],'customerName':_0x47fe19['customerName'],'merchantBrand':_0x47fe19[_0x32b2c4(0xe4)][_0x32b2c4(0xd3)],'createdAt':_0x47fe19[_0x32b2c4(0xdc)],'updatedAt':_0x47fe19[_0x32b2c4(0xc1)]}});}catch(_0x25909a){console[_0x32b2c4(0xae)](_0x32b2c4(0xbc),_0x25909a),_0x15a99e['status'](0x1f4)[_0x32b2c4(0xd6)]({'success':![],'message':_0x32b2c4(0xe3),'error':_0x25909a instanceof Error?_0x25909a[_0x32b2c4(0xde)]:'Unknown\x20error'});}}}exports[a9_0x279a5c(0xd0)]=OnRampController;