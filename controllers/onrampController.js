'use strict';var a11_0x5325ff=a11_0x4975;(function(_0x32b6de,_0x5c5cdd){var _0x170813=a11_0x4975,_0x5c3c5b=_0x32b6de();while(!![]){try{var _0x299ce6=parseInt(_0x170813(0x12c))/0x1*(-parseInt(_0x170813(0x130))/0x2)+-parseInt(_0x170813(0x13e))/0x3*(parseInt(_0x170813(0x12a))/0x4)+-parseInt(_0x170813(0x11b))/0x5*(parseInt(_0x170813(0x157))/0x6)+parseInt(_0x170813(0x149))/0x7*(-parseInt(_0x170813(0x150))/0x8)+-parseInt(_0x170813(0x13f))/0x9*(parseInt(_0x170813(0x139))/0xa)+parseInt(_0x170813(0x12d))/0xb+parseInt(_0x170813(0x11c))/0xc*(parseInt(_0x170813(0x144))/0xd);if(_0x299ce6===_0x5c5cdd)break;else _0x5c3c5b['push'](_0x5c3c5b['shift']());}catch(_0x3e9f9e){_0x5c3c5b['push'](_0x5c3c5b['shift']());}}}(a11_0x4d7d,0x2a99b));var __createBinding=this&&this[a11_0x5325ff(0x15b)]||(Object[a11_0x5325ff(0x154)]?function(_0x53810f,_0x2a70af,_0x2ebf53,_0x35b541){var _0xc475c7=a11_0x5325ff;if(_0x35b541===undefined)_0x35b541=_0x2ebf53;var _0x5c62ad=Object[_0xc475c7(0x112)](_0x2a70af,_0x2ebf53);(!_0x5c62ad||('get'in _0x5c62ad?!_0x2a70af[_0xc475c7(0x117)]:_0x5c62ad[_0xc475c7(0x114)]||_0x5c62ad[_0xc475c7(0x142)]))&&(_0x5c62ad={'enumerable':!![],'get':function(){return _0x2a70af[_0x2ebf53];}}),Object[_0xc475c7(0x11d)](_0x53810f,_0x35b541,_0x5c62ad);}:function(_0x36ea61,_0x161069,_0x20a4c1,_0x598199){if(_0x598199===undefined)_0x598199=_0x20a4c1;_0x36ea61[_0x598199]=_0x161069[_0x20a4c1];}),__setModuleDefault=this&&this[a11_0x5325ff(0x134)]||(Object[a11_0x5325ff(0x154)]?function(_0x9cff9c,_0x538be6){var _0x3bae10=a11_0x5325ff;Object[_0x3bae10(0x11d)](_0x9cff9c,_0x3bae10(0x13c),{'enumerable':!![],'value':_0x538be6});}:function(_0x3da49c,_0x11d3a3){var _0x181268=a11_0x5325ff;_0x3da49c[_0x181268(0x13c)]=_0x11d3a3;}),__importStar=this&&this[a11_0x5325ff(0x158)]||(function(){var _0x47b0a1=function(_0x1e346a){return _0x47b0a1=Object['getOwnPropertyNames']||function(_0x364826){var _0x483321=a11_0x4975,_0x5e86ed=[];for(var _0xaa2622 in _0x364826)if(Object[_0x483321(0x13d)][_0x483321(0x137)][_0x483321(0x147)](_0x364826,_0xaa2622))_0x5e86ed[_0x5e86ed[_0x483321(0x141)]]=_0xaa2622;return _0x5e86ed;},_0x47b0a1(_0x1e346a);};return function(_0x2fc870){var _0x423e8f=a11_0x4975;if(_0x2fc870&&_0x2fc870['__esModule'])return _0x2fc870;var _0x25d9f2={};if(_0x2fc870!=null){for(var _0x52adc2=_0x47b0a1(_0x2fc870),_0x4981a4=0x0;_0x4981a4<_0x52adc2[_0x423e8f(0x141)];_0x4981a4++)if(_0x52adc2[_0x4981a4]!==_0x423e8f(0x13c))__createBinding(_0x25d9f2,_0x2fc870,_0x52adc2[_0x4981a4]);}return __setModuleDefault(_0x25d9f2,_0x2fc870),_0x25d9f2;};}()),__importDefault=this&&this[a11_0x5325ff(0x11a)]||function(_0x2de33b){var _0x224865=a11_0x5325ff;return _0x2de33b&&_0x2de33b[_0x224865(0x117)]?_0x2de33b:{'default':_0x2de33b};};Object[a11_0x5325ff(0x11d)](exports,a11_0x5325ff(0x117),{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require(a11_0x5325ff(0x14c)));function a11_0x4d7d(){var _0x96b1a6=['customerEmail','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','__createBinding','âŒ\x20OnRamp\x20status\x20update\x20error:','gateway','getPaymentData','Unknown\x20error','âœ…\x20Merchant\x20balance\x20updated:\x20+','onramp_system','Internal\x20server\x20error','getOwnPropertyDescriptor','successUrl','writable','%\x20commission)','updateMerchantBalanceForPaidPayment','__esModule','Payment\x20ID\x20and\x20status\x20are\x20required','payment','__importDefault','1595kpDPAp','228Lsbrjf','defineProperty','createdAt','\x20->\x20','failUrl','âŒ\x20Failed\x20to\x20update\x20merchant\x20balance:','PAID','body','gatewayOrderId','amount','gatewayPaymentId','\x20updated\x20to\x20','convertToUSDT','message','65672UCdKNT','customerName','137350PVJChq','3806825fHasBU','ðŸ“\x20Data:','USD','2qXDKsD','toUpperCase','âŒ\x20OnRamp\x20get\x20payment\x20data\x20error:','updatePaymentStatus','__setModuleDefault','json','resolve','hasOwnProperty','\x20USDT\x20(after\x20','257680SRVzCA','status','âœ…\x20OnRamp\x20payment\x20','default','prototype','51BuSRUE','90yuWVve','updatedAt','length','configurable','log','758823eapNlV','error','then','call','Payment\x20not\x20found','7Tgcway','params','ðŸš€\x20OnRamp\x20status\x20update:\x20','../config/database','shop','findFirst','currency','2782304BTFbzt','name','onramp','Payment\x20ID\x20is\x20required','create','ðŸ”\x20Getting\x20OnRamp\x20payment\x20data:\x20','pendingUrl','4866Vzwohw','__importStar'];a11_0x4d7d=function(){return _0x96b1a6;};return a11_0x4d7d();}function a11_0x4975(_0xd10d1d,_0x2fff16){_0xd10d1d=_0xd10d1d-0x10c;var _0x4d7db3=a11_0x4d7d();var _0x497582=_0x4d7db3[_0xd10d1d];return _0x497582;}class OnRampController{async[a11_0x5325ff(0x133)](_0xf2578d,_0x159b1e){var _0x497c5d=a11_0x5325ff;try{const {paymentId:_0x219e79,status:_0xe5432f,referenceId:_0x3cbee2,transactionHash:_0xd97570,actualCryptoAmount:_0x2bf755,orderId:_0x40231f}=_0xf2578d[_0x497c5d(0x123)];if(!_0x219e79||!_0xe5432f){_0x159b1e[_0x497c5d(0x13a)](0x190)[_0x497c5d(0x135)]({'success':![],'message':_0x497c5d(0x118)});return;}console[_0x497c5d(0x143)](_0x497c5d(0x14b)+_0x219e79+_0x497c5d(0x11f)+_0xe5432f),console[_0x497c5d(0x143)](_0x497c5d(0x12e),{'referenceId':_0x3cbee2,'transactionHash':_0xd97570,'actualCryptoAmount':_0x2bf755,'orderId':_0x40231f});const _0x3e07ae=await database_1['default'][_0x497c5d(0x119)][_0x497c5d(0x14e)]({'where':{'OR':[{'id':_0x219e79},{'orderId':_0x219e79},{'gatewayOrderId':_0x219e79},{'gatewayPaymentId':_0x219e79}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3e07ae){_0x159b1e[_0x497c5d(0x13a)](0x194)['json']({'success':![],'message':_0x497c5d(0x148)});return;}if(_0x3e07ae['gateway']!==_0x497c5d(0x152)){_0x159b1e[_0x497c5d(0x13a)](0x190)[_0x497c5d(0x135)]({'success':![],'message':_0x497c5d(0x15a)});return;}const _0x48ab77={'status':_0xe5432f[_0x497c5d(0x131)](),'statusChangedAt':new Date(),'statusChangedBy':_0x497c5d(0x110)};_0x3cbee2&&(_0x48ab77[_0x497c5d(0x124)]=_0x3cbee2);_0xd97570&&(_0x48ab77[_0x497c5d(0x126)]=_0xd97570);_0x2bf755&&(_0x48ab77['invoiceTotalSum']=_0x2bf755);const _0x4c044e=await database_1[_0x497c5d(0x13c)][_0x497c5d(0x119)]['update']({'where':{'id':_0x3e07ae['id']},'data':_0x48ab77});console[_0x497c5d(0x143)](_0x497c5d(0x13b)+_0x3e07ae['id']+_0x497c5d(0x127)+_0xe5432f),_0xe5432f['toUpperCase']()===_0x497c5d(0x122)&&_0x3e07ae[_0x497c5d(0x13a)]!==_0x497c5d(0x122)&&await this[_0x497c5d(0x116)](_0x3e07ae),_0x159b1e['json']({'success':!![],'message':'Payment\x20status\x20updated\x20successfully','data':{'paymentId':_0x4c044e['id'],'status':_0x4c044e['status'],'referenceId':_0x3cbee2,'transactionHash':_0xd97570,'actualCryptoAmount':_0x2bf755}});}catch(_0x427ab3){console[_0x497c5d(0x145)](_0x497c5d(0x15c),_0x427ab3),_0x159b1e[_0x497c5d(0x13a)](0x1f4)[_0x497c5d(0x135)]({'success':![],'message':_0x497c5d(0x111),'error':_0x427ab3 instanceof Error?_0x427ab3[_0x497c5d(0x129)]:_0x497c5d(0x10e)});}}async[a11_0x5325ff(0x116)](_0x3696d1){var _0x479bae=a11_0x5325ff;try{console[_0x479bae(0x143)]('ðŸ’°\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20'+_0x3696d1['id']);let _0x5b2554;if(_0x3696d1['currency']===_0x479bae(0x12f))_0x5b2554=_0x3696d1[_0x479bae(0x125)];else{const {currencyService:_0x38fac2}=await Promise[_0x479bae(0x136)]()[_0x479bae(0x146)](()=>__importStar(require('../services/currencyService')));_0x5b2554=await _0x38fac2[_0x479bae(0x128)](_0x3696d1[_0x479bae(0x125)],_0x3696d1[_0x479bae(0x14f)]);}await database_1[_0x479bae(0x13c)][_0x479bae(0x119)]['update']({'where':{'id':_0x3696d1['id']},'data':{'amountUSDT':_0x5b2554,'paidAt':new Date()}});const _0xf8aa46=0xa,_0x550779=_0x5b2554*(0x1-_0xf8aa46/0x64);await database_1[_0x479bae(0x13c)][_0x479bae(0x14d)]['update']({'where':{'id':_0x3696d1['shopId']},'data':{'balance':{'increment':_0x550779}}}),console['log'](_0x479bae(0x10f)+_0x550779['toFixed'](0x6)+_0x479bae(0x138)+_0xf8aa46+_0x479bae(0x115));}catch(_0x363a1c){console[_0x479bae(0x145)](_0x479bae(0x121),_0x363a1c);}}async[a11_0x5325ff(0x10d)](_0x3985ac,_0x28818d){var _0x282a92=a11_0x5325ff;try{const {id:_0xcdf9b8}=_0x3985ac[_0x282a92(0x14a)];if(!_0xcdf9b8){_0x28818d[_0x282a92(0x13a)](0x190)[_0x282a92(0x135)]({'success':![],'message':_0x282a92(0x153)});return;}console[_0x282a92(0x143)](_0x282a92(0x155)+_0xcdf9b8);const _0x11daee=await database_1[_0x282a92(0x13c)][_0x282a92(0x119)][_0x282a92(0x14e)]({'where':{'OR':[{'id':_0xcdf9b8},{'orderId':_0xcdf9b8},{'gatewayOrderId':_0xcdf9b8},{'gatewayPaymentId':_0xcdf9b8}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x11daee){_0x28818d['status'](0x194)[_0x282a92(0x135)]({'success':![],'message':_0x282a92(0x148)});return;}console[_0x282a92(0x143)]('âœ…\x20Found\x20payment:\x20'+_0x11daee['id']+'\x20('+_0x11daee['status']+')'),_0x28818d['json']({'success':!![],'data':{'id':_0x11daee['id'],'gateway':_0x11daee[_0x282a92(0x10c)],'amount':_0x11daee[_0x282a92(0x125)],'currency':_0x11daee[_0x282a92(0x14f)],'status':_0x11daee[_0x282a92(0x13a)],'gatewayOrderId':_0x11daee['gatewayOrderId'],'gatewayPaymentId':_0x11daee[_0x282a92(0x126)],'successUrl':_0x11daee[_0x282a92(0x113)],'failUrl':_0x11daee[_0x282a92(0x120)],'pendingUrl':_0x11daee[_0x282a92(0x156)],'customerEmail':_0x11daee[_0x282a92(0x159)],'customerName':_0x11daee[_0x282a92(0x12b)],'merchantBrand':_0x11daee[_0x282a92(0x14d)][_0x282a92(0x151)],'createdAt':_0x11daee[_0x282a92(0x11e)],'updatedAt':_0x11daee[_0x282a92(0x140)]}});}catch(_0x2002ee){console['error'](_0x282a92(0x132),_0x2002ee),_0x28818d[_0x282a92(0x13a)](0x1f4)[_0x282a92(0x135)]({'success':![],'message':'Internal\x20server\x20error','error':_0x2002ee instanceof Error?_0x2002ee[_0x282a92(0x129)]:_0x282a92(0x10e)});}}}exports['OnRampController']=OnRampController;