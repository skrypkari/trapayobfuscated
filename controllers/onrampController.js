'use strict';var a9_0x2b55c4=a9_0x3f6b;function a9_0x1685(){var _0x522d4e=['üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','length','create','3HDqhah','7386EOqofa','defineProperty','../services/currencyService','updateMerchantBalanceForPaidPayment','4638855cEmwwx','then','shop','currency','onramp_system','\x20updated\x20to\x20','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','payment','‚úÖ\x20OnRamp\x20payment\x20','üìù\x20Data:','log','getOwnPropertyDescriptor','1908864ogRDfQ','1bMgDgH','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','5574006XWgTrt','failUrl','default','__createBinding','165aQffMH','Unknown\x20error','9863OdrEge','get','__importDefault','%\x20commission)','gatewayOrderId','amount','invoiceTotalSum','\x20USDT\x20(after\x20','\x20->\x20','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','status','13222592ksUKeu','Payment\x20not\x20found','Internal\x20server\x20error','toUpperCase','json','__setModuleDefault','resolve','Payment\x20status\x20updated\x20successfully','error','3209824HMIJKH','toFixed','__esModule','update','OnRampController','getPaymentData','gatewayPaymentId','convertToUSDT','gateway','successUrl','5723488RRWspA','‚ùå\x20OnRamp\x20status\x20update\x20error:','10yMlLlB','../config/database','findFirst','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','üöÄ\x20OnRamp\x20status\x20update:\x20','pendingUrl','call','PAID','message','name','createdAt','prototype','USD'];a9_0x1685=function(){return _0x522d4e;};return a9_0x1685();}(function(_0x5146c6,_0x74521e){var _0x5a542d=a9_0x3f6b,_0xd798b8=_0x5146c6();while(!![]){try{var _0x19e0bd=-parseInt(_0x5a542d(0x188))/0x1*(-parseInt(_0x5a542d(0x15a))/0x2)+parseInt(_0x5a542d(0x176))/0x3*(-parseInt(_0x5a542d(0x164))/0x4)+-parseInt(_0x5a542d(0x17b))/0x5+-parseInt(_0x5a542d(0x177))/0x6*(parseInt(_0x5a542d(0x190))/0x7)+parseInt(_0x5a542d(0x19b))/0x8+-parseInt(_0x5a542d(0x18a))/0x9*(parseInt(_0x5a542d(0x166))/0xa)+-parseInt(_0x5a542d(0x18e))/0xb*(-parseInt(_0x5a542d(0x187))/0xc);if(_0x19e0bd===_0x74521e)break;else _0xd798b8['push'](_0xd798b8['shift']());}catch(_0x1c2e8f){_0xd798b8['push'](_0xd798b8['shift']());}}}(a9_0x1685,0xe3620));function a9_0x3f6b(_0xb89e8c,_0x23f83f){var _0x1685f0=a9_0x1685();return a9_0x3f6b=function(_0x3f6bb3,_0x43ed0d){_0x3f6bb3=_0x3f6bb3-0x153;var _0x31e52e=_0x1685f0[_0x3f6bb3];return _0x31e52e;},a9_0x3f6b(_0xb89e8c,_0x23f83f);}var __createBinding=this&&this[a9_0x2b55c4(0x18d)]||(Object[a9_0x2b55c4(0x175)]?function(_0x3b2a6e,_0x49a2f9,_0x2458a2,_0x31f910){var _0x1b399b=a9_0x2b55c4;if(_0x31f910===undefined)_0x31f910=_0x2458a2;var _0x46d1ed=Object[_0x1b399b(0x186)](_0x49a2f9,_0x2458a2);(!_0x46d1ed||(_0x1b399b(0x191)in _0x46d1ed?!_0x49a2f9['__esModule']:_0x46d1ed['writable']||_0x46d1ed['configurable']))&&(_0x46d1ed={'enumerable':!![],'get':function(){return _0x49a2f9[_0x2458a2];}}),Object[_0x1b399b(0x178)](_0x3b2a6e,_0x31f910,_0x46d1ed);}:function(_0xafd221,_0x494493,_0x6d3fbb,_0x4192bb){if(_0x4192bb===undefined)_0x4192bb=_0x6d3fbb;_0xafd221[_0x4192bb]=_0x494493[_0x6d3fbb];}),__setModuleDefault=this&&this[a9_0x2b55c4(0x156)]||(Object[a9_0x2b55c4(0x175)]?function(_0x1fca01,_0x4580cd){var _0x3773f6=a9_0x2b55c4;Object[_0x3773f6(0x178)](_0x1fca01,_0x3773f6(0x18c),{'enumerable':!![],'value':_0x4580cd});}:function(_0x8f1537,_0x202e1b){var _0x525825=a9_0x2b55c4;_0x8f1537[_0x525825(0x18c)]=_0x202e1b;}),__importStar=this&&this['__importStar']||(function(){var _0x2ba94f=function(_0x11add4){return _0x2ba94f=Object['getOwnPropertyNames']||function(_0x4ef131){var _0x3a6403=a9_0x3f6b,_0x156a91=[];for(var _0x239221 in _0x4ef131)if(Object[_0x3a6403(0x171)]['hasOwnProperty'][_0x3a6403(0x16c)](_0x4ef131,_0x239221))_0x156a91[_0x156a91[_0x3a6403(0x174)]]=_0x239221;return _0x156a91;},_0x2ba94f(_0x11add4);};return function(_0x23c6d8){var _0x830a23=a9_0x3f6b;if(_0x23c6d8&&_0x23c6d8[_0x830a23(0x15c)])return _0x23c6d8;var _0x137e78={};if(_0x23c6d8!=null){for(var _0x54c542=_0x2ba94f(_0x23c6d8),_0x9d7d7c=0x0;_0x9d7d7c<_0x54c542[_0x830a23(0x174)];_0x9d7d7c++)if(_0x54c542[_0x9d7d7c]!==_0x830a23(0x18c))__createBinding(_0x137e78,_0x23c6d8,_0x54c542[_0x9d7d7c]);}return __setModuleDefault(_0x137e78,_0x23c6d8),_0x137e78;};}()),__importDefault=this&&this[a9_0x2b55c4(0x192)]||function(_0x19ffcc){var _0x2d4e53=a9_0x2b55c4;return _0x19ffcc&&_0x19ffcc[_0x2d4e53(0x15c)]?_0x19ffcc:{'default':_0x19ffcc};};Object[a9_0x2b55c4(0x178)](exports,a9_0x2b55c4(0x15c),{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require(a9_0x2b55c4(0x167)));class OnRampController{async['updatePaymentStatus'](_0x3b6fd6,_0x1a355c){var _0x51bccc=a9_0x2b55c4;try{const {paymentId:_0x138858,status:_0x30aec9,referenceId:_0x3e7f08,transactionHash:_0x476f33,actualCryptoAmount:_0x383cd7,orderId:_0x3f33d4}=_0x3b6fd6['body'];if(!_0x138858||!_0x30aec9){_0x1a355c[_0x51bccc(0x19a)](0x190)[_0x51bccc(0x155)]({'success':![],'message':'Payment\x20ID\x20and\x20status\x20are\x20required'});return;}console[_0x51bccc(0x185)](_0x51bccc(0x16a)+_0x138858+_0x51bccc(0x198)+_0x30aec9),console[_0x51bccc(0x185)](_0x51bccc(0x184),{'referenceId':_0x3e7f08,'transactionHash':_0x476f33,'actualCryptoAmount':_0x383cd7,'orderId':_0x3f33d4});const _0x3dba7b=await database_1[_0x51bccc(0x18c)][_0x51bccc(0x182)][_0x51bccc(0x168)]({'where':{'OR':[{'id':_0x138858},{'orderId':_0x138858},{'gatewayOrderId':_0x138858},{'gatewayPaymentId':_0x138858}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3dba7b){_0x1a355c['status'](0x194)[_0x51bccc(0x155)]({'success':![],'message':'Payment\x20not\x20found'});return;}if(_0x3dba7b[_0x51bccc(0x162)]!=='onramp'){_0x1a355c['status'](0x190)[_0x51bccc(0x155)]({'success':![],'message':'This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway'});return;}const _0x29e9ed={'status':_0x30aec9[_0x51bccc(0x154)](),'statusChangedAt':new Date(),'statusChangedBy':_0x51bccc(0x17f)};_0x3e7f08&&(_0x29e9ed[_0x51bccc(0x194)]=_0x3e7f08);_0x476f33&&(_0x29e9ed[_0x51bccc(0x160)]=_0x476f33);_0x383cd7&&(_0x29e9ed[_0x51bccc(0x196)]=_0x383cd7);const _0x46f96e=await database_1[_0x51bccc(0x18c)]['payment']['update']({'where':{'id':_0x3dba7b['id']},'data':_0x29e9ed});console[_0x51bccc(0x185)](_0x51bccc(0x183)+_0x3dba7b['id']+_0x51bccc(0x180)+_0x30aec9),_0x30aec9['toUpperCase']()===_0x51bccc(0x16d)&&_0x3dba7b[_0x51bccc(0x19a)]!=='PAID'&&await this[_0x51bccc(0x17a)](_0x3dba7b),_0x1a355c[_0x51bccc(0x155)]({'success':!![],'message':_0x51bccc(0x158),'data':{'paymentId':_0x46f96e['id'],'status':_0x46f96e[_0x51bccc(0x19a)],'referenceId':_0x3e7f08,'transactionHash':_0x476f33,'actualCryptoAmount':_0x383cd7}});}catch(_0x5ed820){console[_0x51bccc(0x159)](_0x51bccc(0x165),_0x5ed820),_0x1a355c[_0x51bccc(0x19a)](0x1f4)[_0x51bccc(0x155)]({'success':![],'message':_0x51bccc(0x153),'error':_0x5ed820 instanceof Error?_0x5ed820['message']:_0x51bccc(0x18f)});}}async[a9_0x2b55c4(0x17a)](_0x797c81){var _0x312563=a9_0x2b55c4;try{console['log'](_0x312563(0x199)+_0x797c81['id']);let _0xac222e;if(_0x797c81[_0x312563(0x17e)]===_0x312563(0x172))_0xac222e=_0x797c81[_0x312563(0x195)];else{const {currencyService:_0x483c15}=await Promise[_0x312563(0x157)]()[_0x312563(0x17c)](()=>__importStar(require(_0x312563(0x179))));_0xac222e=await _0x483c15[_0x312563(0x161)](_0x797c81[_0x312563(0x195)],_0x797c81[_0x312563(0x17e)]);}await database_1[_0x312563(0x18c)][_0x312563(0x182)][_0x312563(0x15d)]({'where':{'id':_0x797c81['id']},'data':{'amountUSDT':_0xac222e,'paidAt':new Date()}});const _0x4b2b3d=0xa,_0x147a91=_0xac222e*(0x1-_0x4b2b3d/0x64);await database_1[_0x312563(0x18c)][_0x312563(0x17d)][_0x312563(0x15d)]({'where':{'id':_0x797c81['shopId']},'data':{'balance':{'increment':_0x147a91}}}),console[_0x312563(0x185)](_0x312563(0x169)+_0x147a91[_0x312563(0x15b)](0x6)+_0x312563(0x197)+_0x4b2b3d+_0x312563(0x193));}catch(_0x2c732d){console[_0x312563(0x159)](_0x312563(0x189),_0x2c732d);}}async[a9_0x2b55c4(0x15f)](_0x5d6147,_0x24d978){var _0x3838b5=a9_0x2b55c4;try{const {id:_0x2c94b8}=_0x5d6147['params'];if(!_0x2c94b8){_0x24d978['status'](0x190)[_0x3838b5(0x155)]({'success':![],'message':'Payment\x20ID\x20is\x20required'});return;}console[_0x3838b5(0x185)](_0x3838b5(0x173)+_0x2c94b8);const _0x53d224=await database_1[_0x3838b5(0x18c)][_0x3838b5(0x182)][_0x3838b5(0x168)]({'where':{'OR':[{'id':_0x2c94b8},{'orderId':_0x2c94b8},{'gatewayOrderId':_0x2c94b8},{'gatewayPaymentId':_0x2c94b8}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x53d224){_0x24d978[_0x3838b5(0x19a)](0x194)[_0x3838b5(0x155)]({'success':![],'message':_0x3838b5(0x19c)});return;}console[_0x3838b5(0x185)]('‚úÖ\x20Found\x20payment:\x20'+_0x53d224['id']+'\x20('+_0x53d224[_0x3838b5(0x19a)]+')'),_0x24d978['json']({'success':!![],'data':{'id':_0x53d224['id'],'gateway':_0x53d224[_0x3838b5(0x162)],'amount':_0x53d224[_0x3838b5(0x195)],'currency':_0x53d224[_0x3838b5(0x17e)],'status':_0x53d224['status'],'gatewayOrderId':_0x53d224[_0x3838b5(0x194)],'gatewayPaymentId':_0x53d224['gatewayPaymentId'],'successUrl':_0x53d224[_0x3838b5(0x163)],'failUrl':_0x53d224[_0x3838b5(0x18b)],'pendingUrl':_0x53d224[_0x3838b5(0x16b)],'customerEmail':_0x53d224['customerEmail'],'customerName':_0x53d224['customerName'],'merchantBrand':_0x53d224[_0x3838b5(0x17d)][_0x3838b5(0x16f)],'createdAt':_0x53d224[_0x3838b5(0x170)],'updatedAt':_0x53d224['updatedAt']}});}catch(_0x314985){console[_0x3838b5(0x159)](_0x3838b5(0x181),_0x314985),_0x24d978['status'](0x1f4)[_0x3838b5(0x155)]({'success':![],'message':_0x3838b5(0x153),'error':_0x314985 instanceof Error?_0x314985[_0x3838b5(0x16e)]:_0x3838b5(0x18f)});}}}exports[a9_0x2b55c4(0x15e)]=OnRampController;