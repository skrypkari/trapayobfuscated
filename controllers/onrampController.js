'use strict';var a12_0xd8e966=a12_0x1805;(function(_0x2a7d6a,_0x848853){var _0x399e4c=a12_0x1805,_0x193435=_0x2a7d6a();while(!![]){try{var _0x564e3e=parseInt(_0x399e4c(0x9b))/0x1+parseInt(_0x399e4c(0xda))/0x2+-parseInt(_0x399e4c(0xa5))/0x3*(-parseInt(_0x399e4c(0xe0))/0x4)+parseInt(_0x399e4c(0xca))/0x5+parseInt(_0x399e4c(0x9e))/0x6*(parseInt(_0x399e4c(0xa3))/0x7)+-parseInt(_0x399e4c(0xcb))/0x8*(-parseInt(_0x399e4c(0xae))/0x9)+parseInt(_0x399e4c(0x99))/0xa*(-parseInt(_0x399e4c(0xcc))/0xb);if(_0x564e3e===_0x848853)break;else _0x193435['push'](_0x193435['shift']());}catch(_0x5844eb){_0x193435['push'](_0x193435['shift']());}}}(a12_0x51bd,0x1bceb));var __createBinding=this&&this[a12_0xd8e966(0xbc)]||(Object[a12_0xd8e966(0xb2)]?function(_0x29fb45,_0x3e583e,_0xab88c7,_0x3dd37f){var _0x47f84a=a12_0xd8e966;if(_0x3dd37f===undefined)_0x3dd37f=_0xab88c7;var _0x215048=Object[_0x47f84a(0xba)](_0x3e583e,_0xab88c7);(!_0x215048||('get'in _0x215048?!_0x3e583e[_0x47f84a(0x9d)]:_0x215048[_0x47f84a(0xa7)]||_0x215048['configurable']))&&(_0x215048={'enumerable':!![],'get':function(){return _0x3e583e[_0xab88c7];}}),Object[_0x47f84a(0xc8)](_0x29fb45,_0x3dd37f,_0x215048);}:function(_0x34ecbd,_0x55d7f7,_0x4d0aa2,_0x5cd8bd){if(_0x5cd8bd===undefined)_0x5cd8bd=_0x4d0aa2;_0x34ecbd[_0x5cd8bd]=_0x55d7f7[_0x4d0aa2];}),__setModuleDefault=this&&this[a12_0xd8e966(0xc7)]||(Object[a12_0xd8e966(0xb2)]?function(_0x39dab5,_0x414933){var _0x4d4c85=a12_0xd8e966;Object[_0x4d4c85(0xc8)](_0x39dab5,'default',{'enumerable':!![],'value':_0x414933});}:function(_0x1bffdb,_0x55ba22){_0x1bffdb['default']=_0x55ba22;}),__importStar=this&&this[a12_0xd8e966(0xd0)]||(function(){var _0x2d5dea=function(_0x3b8130){var _0x527a46=a12_0x1805;return _0x2d5dea=Object[_0x527a46(0x94)]||function(_0x3d32db){var _0x5a2408=_0x527a46,_0xda1f7b=[];for(var _0x22e73e in _0x3d32db)if(Object[_0x5a2408(0xbf)][_0x5a2408(0xb4)][_0x5a2408(0xcf)](_0x3d32db,_0x22e73e))_0xda1f7b[_0xda1f7b[_0x5a2408(0xaa)]]=_0x22e73e;return _0xda1f7b;},_0x2d5dea(_0x3b8130);};return function(_0x46ba00){var _0x31eb3d=a12_0x1805;if(_0x46ba00&&_0x46ba00[_0x31eb3d(0x9d)])return _0x46ba00;var _0x3f89b6={};if(_0x46ba00!=null){for(var _0x4be2dd=_0x2d5dea(_0x46ba00),_0x5dd156=0x0;_0x5dd156<_0x4be2dd[_0x31eb3d(0xaa)];_0x5dd156++)if(_0x4be2dd[_0x5dd156]!=='default')__createBinding(_0x3f89b6,_0x46ba00,_0x4be2dd[_0x5dd156]);}return __setModuleDefault(_0x3f89b6,_0x46ba00),_0x3f89b6;};}()),__importDefault=this&&this[a12_0xd8e966(0xc0)]||function(_0x481e94){return _0x481e94&&_0x481e94['__esModule']?_0x481e94:{'default':_0x481e94};};function a12_0x1805(_0x11d36a,_0x573574){_0x11d36a=_0x11d36a-0x94;var _0x51bd6b=a12_0x51bd();var _0x18059d=_0x51bd6b[_0x11d36a];return _0x18059d;}Object[a12_0xd8e966(0xc8)](exports,'__esModule',{'value':!![]}),exports[a12_0xd8e966(0xaf)]=void 0x0;const database_1=__importDefault(require('../config/database'));class OnRampController{async[a12_0xd8e966(0xa8)](_0x3735a2,_0x3e9def){var _0x5009e5=a12_0xd8e966;try{const {paymentId:_0x411c7b,status:_0x4dc52f,referenceId:_0x54d16c,transactionHash:_0x364dc3,actualCryptoAmount:_0x310f62,orderId:_0x27a9f5}=_0x3735a2[_0x5009e5(0xac)];if(!_0x411c7b||!_0x4dc52f){_0x3e9def[_0x5009e5(0xe3)](0x190)[_0x5009e5(0xd4)]({'success':![],'message':_0x5009e5(0xc6)});return;}console['log'](_0x5009e5(0xb7)+_0x411c7b+_0x5009e5(0xb8)+_0x4dc52f),console[_0x5009e5(0xd2)]('üìù\x20Data:',{'referenceId':_0x54d16c,'transactionHash':_0x364dc3,'actualCryptoAmount':_0x310f62,'orderId':_0x27a9f5});const _0x4c2aa8=await database_1[_0x5009e5(0xbe)]['payment'][_0x5009e5(0xd8)]({'where':{'OR':[{'id':_0x411c7b},{'orderId':_0x411c7b},{'gatewayOrderId':_0x411c7b},{'gatewayPaymentId':_0x411c7b}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x4c2aa8){_0x3e9def[_0x5009e5(0xe3)](0x194)[_0x5009e5(0xd4)]({'success':![],'message':_0x5009e5(0xc1)});return;}if(_0x4c2aa8[_0x5009e5(0xbd)]!=='onramp'){_0x3e9def[_0x5009e5(0xe3)](0x190)[_0x5009e5(0xd4)]({'success':![],'message':'This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway'});return;}const _0x118d39={'status':_0x4dc52f[_0x5009e5(0xb6)](),'statusChangedAt':new Date(),'statusChangedBy':_0x5009e5(0xc3)};_0x54d16c&&(_0x118d39[_0x5009e5(0xad)]=_0x54d16c);_0x364dc3&&(_0x118d39[_0x5009e5(0xce)]=_0x364dc3);_0x310f62&&(_0x118d39[_0x5009e5(0xd9)]=_0x310f62);const _0x3f0306=await database_1[_0x5009e5(0xbe)][_0x5009e5(0x9c)][_0x5009e5(0xc4)]({'where':{'id':_0x4c2aa8['id']},'data':_0x118d39});console['log'](_0x5009e5(0xc9)+_0x4c2aa8['id']+_0x5009e5(0xe5)+_0x4dc52f),_0x4dc52f['toUpperCase']()===_0x5009e5(0xdb)&&_0x4c2aa8['status']!==_0x5009e5(0xdb)&&await this['updateMerchantBalanceForPaidPayment'](_0x4c2aa8),_0x3e9def['json']({'success':!![],'message':_0x5009e5(0xcd),'data':{'paymentId':_0x3f0306['id'],'status':_0x3f0306[_0x5009e5(0xe3)],'referenceId':_0x54d16c,'transactionHash':_0x364dc3,'actualCryptoAmount':_0x310f62}});}catch(_0x31736b){console[_0x5009e5(0x95)](_0x5009e5(0xe4),_0x31736b),_0x3e9def[_0x5009e5(0xe3)](0x1f4)['json']({'success':![],'message':_0x5009e5(0xd3),'error':_0x31736b instanceof Error?_0x31736b[_0x5009e5(0xbb)]:_0x5009e5(0xb5)});}}async[a12_0xd8e966(0xb1)](_0x5d4fcc){var _0x10dd0e=a12_0xd8e966;try{console[_0x10dd0e(0xd2)](_0x10dd0e(0xb9)+_0x5d4fcc['id']);let _0x3ca153;if(_0x5d4fcc['currency']===_0x10dd0e(0xa6))_0x3ca153=_0x5d4fcc[_0x10dd0e(0xb0)];else{const {currencyService:_0x1b7e32}=await Promise[_0x10dd0e(0x9f)]()[_0x10dd0e(0x98)](()=>__importStar(require(_0x10dd0e(0xab))));_0x3ca153=await _0x1b7e32[_0x10dd0e(0xdc)](_0x5d4fcc[_0x10dd0e(0xb0)],_0x5d4fcc[_0x10dd0e(0xd5)]);}await database_1['default'][_0x10dd0e(0x9c)][_0x10dd0e(0xc4)]({'where':{'id':_0x5d4fcc['id']},'data':{'amountUSDT':_0x3ca153,'paidAt':new Date()}});const _0x5b1826=0xa,_0x2286ec=_0x3ca153*(0x1-_0x5b1826/0x64);await database_1[_0x10dd0e(0xbe)]['shop'][_0x10dd0e(0xc4)]({'where':{'id':_0x5d4fcc[_0x10dd0e(0xdf)]},'data':{'balance':{'increment':_0x2286ec}}}),console[_0x10dd0e(0xd2)](_0x10dd0e(0xe2)+_0x2286ec[_0x10dd0e(0xe1)](0x6)+_0x10dd0e(0xd7)+_0x5b1826+_0x10dd0e(0xa2));}catch(_0x1a307e){console[_0x10dd0e(0x95)](_0x10dd0e(0xa4),_0x1a307e);}}async[a12_0xd8e966(0x97)](_0x3ef136,_0x2dc546){var _0x213621=a12_0xd8e966;try{const {id:_0x2a0a18}=_0x3ef136['params'];if(!_0x2a0a18){_0x2dc546[_0x213621(0xe3)](0x190)[_0x213621(0xd4)]({'success':![],'message':_0x213621(0xa1)});return;}console[_0x213621(0xd2)](_0x213621(0xb3)+_0x2a0a18);const _0x808deb=await database_1[_0x213621(0xbe)][_0x213621(0x9c)][_0x213621(0xd8)]({'where':{'OR':[{'id':_0x2a0a18},{'orderId':_0x2a0a18},{'gatewayOrderId':_0x2a0a18},{'gatewayPaymentId':_0x2a0a18}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x808deb){_0x2dc546[_0x213621(0xe3)](0x194)[_0x213621(0xd4)]({'success':![],'message':_0x213621(0xc1)});return;}console['log'](_0x213621(0xde)+_0x808deb['id']+'\x20('+_0x808deb[_0x213621(0xe3)]+')'),_0x2dc546[_0x213621(0xd4)]({'success':!![],'data':{'id':_0x808deb['id'],'gateway':_0x808deb[_0x213621(0xbd)],'amount':_0x808deb['amount'],'currency':_0x808deb[_0x213621(0xd5)],'status':_0x808deb[_0x213621(0xe3)],'gatewayOrderId':_0x808deb[_0x213621(0xad)],'gatewayPaymentId':_0x808deb[_0x213621(0xce)],'successUrl':_0x808deb[_0x213621(0xa0)],'failUrl':_0x808deb['failUrl'],'pendingUrl':_0x808deb[_0x213621(0xd1)],'customerEmail':_0x808deb[_0x213621(0x9a)],'customerName':_0x808deb[_0x213621(0xd6)],'merchantBrand':_0x808deb[_0x213621(0x96)][_0x213621(0xc2)],'createdAt':_0x808deb[_0x213621(0xdd)],'updatedAt':_0x808deb[_0x213621(0xc5)]}});}catch(_0x15fda2){console['error'](_0x213621(0xa9),_0x15fda2),_0x2dc546[_0x213621(0xe3)](0x1f4)['json']({'success':![],'message':_0x213621(0xd3),'error':_0x15fda2 instanceof Error?_0x15fda2[_0x213621(0xbb)]:'Unknown\x20error'});}}}function a12_0x51bd(){var _0x4d3ff9=['getPaymentData','then','3136670HTxdyT','customerEmail','112706QxmwcS','payment','__esModule','36042BuGMpb','resolve','successUrl','Payment\x20ID\x20is\x20required','%\x20commission)','35IjGMgQ','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','3372pIhjAv','USD','writable','updatePaymentStatus','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','length','../services/currencyService','body','gatewayOrderId','831222KnqctX','OnRampController','amount','updateMerchantBalanceForPaidPayment','create','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','hasOwnProperty','Unknown\x20error','toUpperCase','üöÄ\x20OnRamp\x20status\x20update:\x20','\x20->\x20','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','getOwnPropertyDescriptor','message','__createBinding','gateway','default','prototype','__importDefault','Payment\x20not\x20found','name','onramp_system','update','updatedAt','Payment\x20ID\x20and\x20status\x20are\x20required','__setModuleDefault','defineProperty','‚úÖ\x20OnRamp\x20payment\x20','1033815jryynv','16HGrGAv','22BUUdcF','Payment\x20status\x20updated\x20successfully','gatewayPaymentId','call','__importStar','pendingUrl','log','Internal\x20server\x20error','json','currency','customerName','\x20USDT\x20(after\x20','findFirst','invoiceTotalSum','387050CdaTbM','PAID','convertToUSDT','createdAt','‚úÖ\x20Found\x20payment:\x20','shopId','48nCIWKi','toFixed','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','status','‚ùå\x20OnRamp\x20status\x20update\x20error:','\x20updated\x20to\x20','getOwnPropertyNames','error','shop'];a12_0x51bd=function(){return _0x4d3ff9;};return a12_0x51bd();}exports[a12_0xd8e966(0xaf)]=OnRampController;