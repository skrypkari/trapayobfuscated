'use strict';var a11_0x48b594=a11_0x395b;(function(_0x104a55,_0x505682){var _0x364dc4=a11_0x395b,_0x1eb436=_0x104a55();while(!![]){try{var _0x565518=-parseInt(_0x364dc4(0x12a))/0x1+-parseInt(_0x364dc4(0x10e))/0x2+parseInt(_0x364dc4(0x119))/0x3+parseInt(_0x364dc4(0x13b))/0x4+-parseInt(_0x364dc4(0x115))/0x5*(parseInt(_0x364dc4(0x133))/0x6)+-parseInt(_0x364dc4(0x12b))/0x7*(-parseInt(_0x364dc4(0xfc))/0x8)+parseInt(_0x364dc4(0x126))/0x9;if(_0x565518===_0x505682)break;else _0x1eb436['push'](_0x1eb436['shift']());}catch(_0xa521ec){_0x1eb436['push'](_0x1eb436['shift']());}}}(a11_0x541f,0x4d794));var __createBinding=this&&this['__createBinding']||(Object[a11_0x48b594(0x116)]?function(_0x41872c,_0x5e95e2,_0x4ea22b,_0x40ab76){var _0x298507=a11_0x48b594;if(_0x40ab76===undefined)_0x40ab76=_0x4ea22b;var _0x376b6c=Object[_0x298507(0x103)](_0x5e95e2,_0x4ea22b);(!_0x376b6c||(_0x298507(0x122)in _0x376b6c?!_0x5e95e2[_0x298507(0x11b)]:_0x376b6c[_0x298507(0x123)]||_0x376b6c[_0x298507(0x10a)]))&&(_0x376b6c={'enumerable':!![],'get':function(){return _0x5e95e2[_0x4ea22b];}}),Object[_0x298507(0x12f)](_0x41872c,_0x40ab76,_0x376b6c);}:function(_0x5e4bb5,_0x101c7a,_0x295d03,_0x2d2610){if(_0x2d2610===undefined)_0x2d2610=_0x295d03;_0x5e4bb5[_0x2d2610]=_0x101c7a[_0x295d03];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x2b88a6,_0x1dec67){var _0x4e9f29=a11_0x48b594;Object[_0x4e9f29(0x12f)](_0x2b88a6,_0x4e9f29(0x132),{'enumerable':!![],'value':_0x1dec67});}:function(_0x1d8471,_0xbce490){var _0x6bd61f=a11_0x48b594;_0x1d8471[_0x6bd61f(0x132)]=_0xbce490;}),__importStar=this&&this[a11_0x48b594(0x129)]||(function(){var _0x5dab48=function(_0x1e2d32){var _0x51274e=a11_0x395b;return _0x5dab48=Object[_0x51274e(0x139)]||function(_0x241956){var _0x19d0e5=_0x51274e,_0x19b0ea=[];for(var _0x306acb in _0x241956)if(Object[_0x19d0e5(0x125)]['hasOwnProperty']['call'](_0x241956,_0x306acb))_0x19b0ea[_0x19b0ea[_0x19d0e5(0x134)]]=_0x306acb;return _0x19b0ea;},_0x5dab48(_0x1e2d32);};return function(_0x47618f){var _0x52ab73=a11_0x395b;if(_0x47618f&&_0x47618f[_0x52ab73(0x11b)])return _0x47618f;var _0x9d035d={};if(_0x47618f!=null){for(var _0x415775=_0x5dab48(_0x47618f),_0x1dad92=0x0;_0x1dad92<_0x415775[_0x52ab73(0x134)];_0x1dad92++)if(_0x415775[_0x1dad92]!=='default')__createBinding(_0x9d035d,_0x47618f,_0x415775[_0x1dad92]);}return __setModuleDefault(_0x9d035d,_0x47618f),_0x9d035d;};}()),__importDefault=this&&this['__importDefault']||function(_0x5847d6){var _0x5271b8=a11_0x48b594;return _0x5847d6&&_0x5847d6[_0x5271b8(0x11b)]?_0x5847d6:{'default':_0x5847d6};};Object[a11_0x48b594(0x12f)](exports,'__esModule',{'value':!![]}),exports['OnRampController']=void 0x0;function a11_0x395b(_0x4907e7,_0x1edbe9){_0x4907e7=_0x4907e7-0xf5;var _0x541f67=a11_0x541f();var _0x395b35=_0x541f67[_0x4907e7];return _0x395b35;}const database_1=__importDefault(require(a11_0x48b594(0x11c)));function a11_0x541f(){var _0x42dd25=['successUrl','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','\x20USDT\x20(after\x20','configurable','name','customerEmail','OnRampController','964490UUaKfN','body','\x20updated\x20to\x20','currency','%\x20commission)','onramp','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','5NNVIne','create','PAID','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','1503354WMHyKP','getPaymentData','__esModule','../config/database','resolve','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','shop','Payment\x20not\x20found','error','get','writable','onramp_system','prototype','3093381cXmgJs','USD','üöÄ\x20OnRamp\x20status\x20update:\x20','__importStar','530457ruuqug','364eJEnPp','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','log','then','defineProperty','gateway','params','default','357402kFsivD','length','updateMerchantBalanceForPaidPayment','../services/currencyService','toUpperCase','createdAt','getOwnPropertyNames','shopId','1106440wspNih','convertToUSDT','json','update','Unknown\x20error','Payment\x20ID\x20and\x20status\x20are\x20required','Internal\x20server\x20error','status','gatewayOrderId','41256WoDuIJ','gatewayPaymentId','amount','üìù\x20Data:','updatedAt','‚úÖ\x20Found\x20payment:\x20','updatePaymentStatus','getOwnPropertyDescriptor','payment','findFirst','pendingUrl'];a11_0x541f=function(){return _0x42dd25;};return a11_0x541f();}class OnRampController{async[a11_0x48b594(0x102)](_0x3cc6ef,_0x1eea1b){var _0x22c8c3=a11_0x48b594;try{const {paymentId:_0x3dec27,status:_0x520848,referenceId:_0x37395d,transactionHash:_0x3646fc,actualCryptoAmount:_0x20a771,orderId:_0x1a4368}=_0x3cc6ef[_0x22c8c3(0x10f)];if(!_0x3dec27||!_0x520848){_0x1eea1b['status'](0x190)[_0x22c8c3(0xf5)]({'success':![],'message':_0x22c8c3(0xf8)});return;}console[_0x22c8c3(0x12d)](_0x22c8c3(0x128)+_0x3dec27+'\x20->\x20'+_0x520848),console['log'](_0x22c8c3(0xff),{'referenceId':_0x37395d,'transactionHash':_0x3646fc,'actualCryptoAmount':_0x20a771,'orderId':_0x1a4368});const _0x176767=await database_1[_0x22c8c3(0x132)][_0x22c8c3(0x104)][_0x22c8c3(0x105)]({'where':{'OR':[{'id':_0x3dec27},{'orderId':_0x3dec27},{'gatewayOrderId':_0x3dec27},{'gatewayPaymentId':_0x3dec27}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x176767){_0x1eea1b['status'](0x194)[_0x22c8c3(0xf5)]({'success':![],'message':_0x22c8c3(0x120)});return;}if(_0x176767[_0x22c8c3(0x130)]!==_0x22c8c3(0x113)){_0x1eea1b[_0x22c8c3(0xfa)](0x190)[_0x22c8c3(0xf5)]({'success':![],'message':_0x22c8c3(0x108)});return;}const _0x3c5730={'status':_0x520848[_0x22c8c3(0x137)](),'statusChangedAt':new Date(),'statusChangedBy':_0x22c8c3(0x124)};_0x37395d&&(_0x3c5730[_0x22c8c3(0xfb)]=_0x37395d);_0x3646fc&&(_0x3c5730[_0x22c8c3(0xfd)]=_0x3646fc);_0x20a771&&(_0x3c5730['invoiceTotalSum']=_0x20a771);const _0x1d8990=await database_1[_0x22c8c3(0x132)][_0x22c8c3(0x104)][_0x22c8c3(0xf6)]({'where':{'id':_0x176767['id']},'data':_0x3c5730});console['log']('‚úÖ\x20OnRamp\x20payment\x20'+_0x176767['id']+_0x22c8c3(0x110)+_0x520848),_0x520848[_0x22c8c3(0x137)]()===_0x22c8c3(0x117)&&_0x176767[_0x22c8c3(0xfa)]!==_0x22c8c3(0x117)&&await this[_0x22c8c3(0x135)](_0x176767),_0x1eea1b['json']({'success':!![],'message':'Payment\x20status\x20updated\x20successfully','data':{'paymentId':_0x1d8990['id'],'status':_0x1d8990[_0x22c8c3(0xfa)],'referenceId':_0x37395d,'transactionHash':_0x3646fc,'actualCryptoAmount':_0x20a771}});}catch(_0x2b3555){console['error']('‚ùå\x20OnRamp\x20status\x20update\x20error:',_0x2b3555),_0x1eea1b[_0x22c8c3(0xfa)](0x1f4)[_0x22c8c3(0xf5)]({'success':![],'message':'Internal\x20server\x20error','error':_0x2b3555 instanceof Error?_0x2b3555['message']:'Unknown\x20error'});}}async[a11_0x48b594(0x135)](_0xb187b3){var _0x3c7a9a=a11_0x48b594;try{console['log'](_0x3c7a9a(0x114)+_0xb187b3['id']);let _0x35aaf7;if(_0xb187b3[_0x3c7a9a(0x111)]===_0x3c7a9a(0x127))_0x35aaf7=_0xb187b3[_0x3c7a9a(0xfe)];else{const {currencyService:_0x23e7ce}=await Promise[_0x3c7a9a(0x11d)]()[_0x3c7a9a(0x12e)](()=>__importStar(require(_0x3c7a9a(0x136))));_0x35aaf7=await _0x23e7ce[_0x3c7a9a(0x13c)](_0xb187b3[_0x3c7a9a(0xfe)],_0xb187b3[_0x3c7a9a(0x111)]);}await database_1[_0x3c7a9a(0x132)][_0x3c7a9a(0x104)][_0x3c7a9a(0xf6)]({'where':{'id':_0xb187b3['id']},'data':{'amountUSDT':_0x35aaf7,'paidAt':new Date()}});const _0x22759b=0xa,_0x4c333b=_0x35aaf7*(0x1-_0x22759b/0x64);await database_1[_0x3c7a9a(0x132)][_0x3c7a9a(0x11f)][_0x3c7a9a(0xf6)]({'where':{'id':_0xb187b3[_0x3c7a9a(0x13a)]},'data':{'balance':{'increment':_0x4c333b}}}),console[_0x3c7a9a(0x12d)](_0x3c7a9a(0x118)+_0x4c333b['toFixed'](0x6)+_0x3c7a9a(0x109)+_0x22759b+_0x3c7a9a(0x112));}catch(_0x271f44){console['error'](_0x3c7a9a(0x11e),_0x271f44);}}async[a11_0x48b594(0x11a)](_0x5cac56,_0x307ac6){var _0x44a6ff=a11_0x48b594;try{const {id:_0x32c8d0}=_0x5cac56[_0x44a6ff(0x131)];if(!_0x32c8d0){_0x307ac6[_0x44a6ff(0xfa)](0x190)[_0x44a6ff(0xf5)]({'success':![],'message':'Payment\x20ID\x20is\x20required'});return;}console[_0x44a6ff(0x12d)]('üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20'+_0x32c8d0);const _0x1e6b22=await database_1['default'][_0x44a6ff(0x104)][_0x44a6ff(0x105)]({'where':{'OR':[{'id':_0x32c8d0},{'orderId':_0x32c8d0},{'gatewayOrderId':_0x32c8d0},{'gatewayPaymentId':_0x32c8d0}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x1e6b22){_0x307ac6[_0x44a6ff(0xfa)](0x194)['json']({'success':![],'message':_0x44a6ff(0x120)});return;}console['log'](_0x44a6ff(0x101)+_0x1e6b22['id']+'\x20('+_0x1e6b22[_0x44a6ff(0xfa)]+')'),_0x307ac6[_0x44a6ff(0xf5)]({'success':!![],'data':{'id':_0x1e6b22['id'],'gateway':_0x1e6b22[_0x44a6ff(0x130)],'amount':_0x1e6b22[_0x44a6ff(0xfe)],'currency':_0x1e6b22[_0x44a6ff(0x111)],'status':_0x1e6b22[_0x44a6ff(0xfa)],'gatewayOrderId':_0x1e6b22['gatewayOrderId'],'gatewayPaymentId':_0x1e6b22['gatewayPaymentId'],'successUrl':_0x1e6b22[_0x44a6ff(0x107)],'failUrl':_0x1e6b22['failUrl'],'pendingUrl':_0x1e6b22[_0x44a6ff(0x106)],'customerEmail':_0x1e6b22[_0x44a6ff(0x10c)],'customerName':_0x1e6b22['customerName'],'merchantBrand':_0x1e6b22[_0x44a6ff(0x11f)][_0x44a6ff(0x10b)],'createdAt':_0x1e6b22[_0x44a6ff(0x138)],'updatedAt':_0x1e6b22[_0x44a6ff(0x100)]}});}catch(_0x462ea1){console[_0x44a6ff(0x121)](_0x44a6ff(0x12c),_0x462ea1),_0x307ac6['status'](0x1f4)[_0x44a6ff(0xf5)]({'success':![],'message':_0x44a6ff(0xf9),'error':_0x462ea1 instanceof Error?_0x462ea1['message']:_0x44a6ff(0xf7)});}}}exports[a11_0x48b594(0x10d)]=OnRampController;