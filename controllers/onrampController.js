'use strict';var a11_0x382968=a11_0x3ffa;(function(_0x3cbf90,_0x5b65d6){var _0x1c495f=a11_0x3ffa,_0x34ab73=_0x3cbf90();while(!![]){try{var _0x410702=-parseInt(_0x1c495f(0x19b))/0x1+-parseInt(_0x1c495f(0x1ae))/0x2*(-parseInt(_0x1c495f(0x182))/0x3)+parseInt(_0x1c495f(0x17e))/0x4+-parseInt(_0x1c495f(0x1af))/0x5+parseInt(_0x1c495f(0x180))/0x6*(parseInt(_0x1c495f(0x1ab))/0x7)+parseInt(_0x1c495f(0x1b0))/0x8+-parseInt(_0x1c495f(0x19c))/0x9;if(_0x410702===_0x5b65d6)break;else _0x34ab73['push'](_0x34ab73['shift']());}catch(_0x56865d){_0x34ab73['push'](_0x34ab73['shift']());}}}(a11_0x2b6e,0xd6d09));var __createBinding=this&&this[a11_0x382968(0x1a0)]||(Object['create']?function(_0x5dc2f6,_0x3af443,_0x39d97d,_0x469520){var _0x23ed40=a11_0x382968;if(_0x469520===undefined)_0x469520=_0x39d97d;var _0x494a93=Object[_0x23ed40(0x18b)](_0x3af443,_0x39d97d);(!_0x494a93||(_0x23ed40(0x17d)in _0x494a93?!_0x3af443[_0x23ed40(0x19a)]:_0x494a93[_0x23ed40(0x1b6)]||_0x494a93[_0x23ed40(0x18e)]))&&(_0x494a93={'enumerable':!![],'get':function(){return _0x3af443[_0x39d97d];}}),Object[_0x23ed40(0x1bf)](_0x5dc2f6,_0x469520,_0x494a93);}:function(_0x4c0c05,_0x1fe0ff,_0x271fbd,_0x37f514){if(_0x37f514===undefined)_0x37f514=_0x271fbd;_0x4c0c05[_0x37f514]=_0x1fe0ff[_0x271fbd];}),__setModuleDefault=this&&this[a11_0x382968(0x1c6)]||(Object[a11_0x382968(0x1c1)]?function(_0x4a716a,_0x260704){var _0xf78617=a11_0x382968;Object[_0xf78617(0x1bf)](_0x4a716a,_0xf78617(0x1c7),{'enumerable':!![],'value':_0x260704});}:function(_0x2f0da6,_0x3dd632){_0x2f0da6['default']=_0x3dd632;}),__importStar=this&&this[a11_0x382968(0x1ba)]||(function(){var _0x21942=function(_0xa419e7){var _0x4afed4=a11_0x3ffa;return _0x21942=Object[_0x4afed4(0x1a6)]||function(_0x3aa612){var _0x265e57=_0x4afed4,_0x371dd5=[];for(var _0x2169bd in _0x3aa612)if(Object[_0x265e57(0x1a8)][_0x265e57(0x18c)][_0x265e57(0x18a)](_0x3aa612,_0x2169bd))_0x371dd5[_0x371dd5[_0x265e57(0x190)]]=_0x2169bd;return _0x371dd5;},_0x21942(_0xa419e7);};return function(_0x27843f){var _0x54836e=a11_0x3ffa;if(_0x27843f&&_0x27843f[_0x54836e(0x19a)])return _0x27843f;var _0x5de9a4={};if(_0x27843f!=null){for(var _0x44c14b=_0x21942(_0x27843f),_0x4277f8=0x0;_0x4277f8<_0x44c14b[_0x54836e(0x190)];_0x4277f8++)if(_0x44c14b[_0x4277f8]!=='default')__createBinding(_0x5de9a4,_0x27843f,_0x44c14b[_0x4277f8]);}return __setModuleDefault(_0x5de9a4,_0x27843f),_0x5de9a4;};}()),__importDefault=this&&this['__importDefault']||function(_0x289d3a){var _0x304e01=a11_0x382968;return _0x289d3a&&_0x289d3a[_0x304e01(0x19a)]?_0x289d3a:{'default':_0x289d3a};};function a11_0x2b6e(){var _0x1aec00=['prototype','shop','log','19901wJrPfz','customerEmail','gatewayPaymentId','883672gjvqlL','2464180PJrNoG','12121328oDHCpw','Payment\x20ID\x20and\x20status\x20are\x20required','âœ…\x20OnRamp\x20payment\x20','gatewayOrderId','updateMerchantBalanceForPaidPayment','getPaymentData','writable','../services/currencyService','failUrl','createdAt','__importStar','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','onramp','error','âŒ\x20OnRamp\x20status\x20update\x20error:','defineProperty','../config/database','create','params','\x20->\x20','body','customerName','__setModuleDefault','default','status','updatePaymentStatus','âŒ\x20OnRamp\x20get\x20payment\x20data\x20error:','get','4096936DwlzUS','convertToUSDT','798slFVqR','pendingUrl','3SFAxiS','amount','shopId','findFirst','USD','payment','Payment\x20ID\x20is\x20required','âœ…\x20Merchant\x20balance\x20updated:\x20+','call','getOwnPropertyDescriptor','hasOwnProperty','currency','configurable','âŒ\x20Failed\x20to\x20update\x20merchant\x20balance:','length','invoiceTotalSum','Payment\x20not\x20found','ðŸ”\x20Getting\x20OnRamp\x20payment\x20data:\x20','toUpperCase','Internal\x20server\x20error','update','ðŸ“\x20Data:','resolve','%\x20commission)','__esModule','785369pOTeIa','10811421BaeXJO','PAID','json','name','__createBinding','OnRampController','\x20USDT\x20(after\x20','toFixed','updatedAt','âœ…\x20Found\x20payment:\x20','getOwnPropertyNames','message'];a11_0x2b6e=function(){return _0x1aec00;};return a11_0x2b6e();}Object[a11_0x382968(0x1bf)](exports,a11_0x382968(0x19a),{'value':!![]}),exports[a11_0x382968(0x1a1)]=void 0x0;const database_1=__importDefault(require(a11_0x382968(0x1c0)));class OnRampController{async[a11_0x382968(0x17b)](_0x4cbd51,_0x18a3be){var _0x2c010f=a11_0x382968;try{const {paymentId:_0x18ef5c,status:_0x535efb,referenceId:_0x4b007d,transactionHash:_0x5b6c85,actualCryptoAmount:_0x4f2c98,orderId:_0x1393e1}=_0x4cbd51[_0x2c010f(0x1c4)];if(!_0x18ef5c||!_0x535efb){_0x18a3be['status'](0x190)[_0x2c010f(0x19e)]({'success':![],'message':_0x2c010f(0x1b1)});return;}console[_0x2c010f(0x1aa)]('ðŸš€\x20OnRamp\x20status\x20update:\x20'+_0x18ef5c+_0x2c010f(0x1c3)+_0x535efb),console['log'](_0x2c010f(0x197),{'referenceId':_0x4b007d,'transactionHash':_0x5b6c85,'actualCryptoAmount':_0x4f2c98,'orderId':_0x1393e1});const _0x5f2c35=await database_1[_0x2c010f(0x1c7)]['payment'][_0x2c010f(0x185)]({'where':{'OR':[{'id':_0x18ef5c},{'orderId':_0x18ef5c},{'gatewayOrderId':_0x18ef5c},{'gatewayPaymentId':_0x18ef5c}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5f2c35){_0x18a3be['status'](0x194)[_0x2c010f(0x19e)]({'success':![],'message':_0x2c010f(0x192)});return;}if(_0x5f2c35['gateway']!==_0x2c010f(0x1bc)){_0x18a3be[_0x2c010f(0x17a)](0x190)[_0x2c010f(0x19e)]({'success':![],'message':_0x2c010f(0x1bb)});return;}const _0x413d4b={'status':_0x535efb[_0x2c010f(0x194)](),'statusChangedAt':new Date(),'statusChangedBy':'onramp_system'};_0x4b007d&&(_0x413d4b[_0x2c010f(0x1b3)]=_0x4b007d);_0x5b6c85&&(_0x413d4b[_0x2c010f(0x1ad)]=_0x5b6c85);_0x4f2c98&&(_0x413d4b[_0x2c010f(0x191)]=_0x4f2c98);const _0x5a07ec=await database_1[_0x2c010f(0x1c7)]['payment'][_0x2c010f(0x196)]({'where':{'id':_0x5f2c35['id']},'data':_0x413d4b});console['log'](_0x2c010f(0x1b2)+_0x5f2c35['id']+'\x20updated\x20to\x20'+_0x535efb),_0x535efb[_0x2c010f(0x194)]()===_0x2c010f(0x19d)&&_0x5f2c35['status']!=='PAID'&&await this[_0x2c010f(0x1b4)](_0x5f2c35),_0x18a3be[_0x2c010f(0x19e)]({'success':!![],'message':'Payment\x20status\x20updated\x20successfully','data':{'paymentId':_0x5a07ec['id'],'status':_0x5a07ec[_0x2c010f(0x17a)],'referenceId':_0x4b007d,'transactionHash':_0x5b6c85,'actualCryptoAmount':_0x4f2c98}});}catch(_0x47606){console[_0x2c010f(0x1bd)](_0x2c010f(0x1be),_0x47606),_0x18a3be['status'](0x1f4)[_0x2c010f(0x19e)]({'success':![],'message':'Internal\x20server\x20error','error':_0x47606 instanceof Error?_0x47606[_0x2c010f(0x1a7)]:'Unknown\x20error'});}}async[a11_0x382968(0x1b4)](_0x186655){var _0x27addd=a11_0x382968;try{console['log']('ðŸ’°\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20'+_0x186655['id']);let _0xb12e72;if(_0x186655[_0x27addd(0x18d)]===_0x27addd(0x186))_0xb12e72=_0x186655[_0x27addd(0x183)];else{const {currencyService:_0x372f9d}=await Promise[_0x27addd(0x198)]()['then'](()=>__importStar(require(_0x27addd(0x1b7))));_0xb12e72=await _0x372f9d[_0x27addd(0x17f)](_0x186655[_0x27addd(0x183)],_0x186655[_0x27addd(0x18d)]);}await database_1[_0x27addd(0x1c7)][_0x27addd(0x187)]['update']({'where':{'id':_0x186655['id']},'data':{'amountUSDT':_0xb12e72,'paidAt':new Date()}});const _0x287083=0xa,_0x27832a=_0xb12e72*(0x1-_0x287083/0x64);await database_1[_0x27addd(0x1c7)][_0x27addd(0x1a9)][_0x27addd(0x196)]({'where':{'id':_0x186655[_0x27addd(0x184)]},'data':{'balance':{'increment':_0x27832a}}}),console[_0x27addd(0x1aa)](_0x27addd(0x189)+_0x27832a[_0x27addd(0x1a3)](0x6)+_0x27addd(0x1a2)+_0x287083+_0x27addd(0x199));}catch(_0x17142c){console[_0x27addd(0x1bd)](_0x27addd(0x18f),_0x17142c);}}async[a11_0x382968(0x1b5)](_0x12edfa,_0x368819){var _0x230191=a11_0x382968;try{const {id:_0x2bbba7}=_0x12edfa[_0x230191(0x1c2)];if(!_0x2bbba7){_0x368819['status'](0x190)[_0x230191(0x19e)]({'success':![],'message':_0x230191(0x188)});return;}console['log'](_0x230191(0x193)+_0x2bbba7);const _0x5b7667=await database_1[_0x230191(0x1c7)][_0x230191(0x187)][_0x230191(0x185)]({'where':{'OR':[{'id':_0x2bbba7},{'orderId':_0x2bbba7},{'gatewayOrderId':_0x2bbba7},{'gatewayPaymentId':_0x2bbba7}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x5b7667){_0x368819[_0x230191(0x17a)](0x194)[_0x230191(0x19e)]({'success':![],'message':_0x230191(0x192)});return;}console['log'](_0x230191(0x1a5)+_0x5b7667['id']+'\x20('+_0x5b7667[_0x230191(0x17a)]+')'),_0x368819[_0x230191(0x19e)]({'success':!![],'data':{'id':_0x5b7667['id'],'gateway':_0x5b7667['gateway'],'amount':_0x5b7667[_0x230191(0x183)],'currency':_0x5b7667[_0x230191(0x18d)],'status':_0x5b7667[_0x230191(0x17a)],'gatewayOrderId':_0x5b7667['gatewayOrderId'],'gatewayPaymentId':_0x5b7667['gatewayPaymentId'],'successUrl':_0x5b7667['successUrl'],'failUrl':_0x5b7667[_0x230191(0x1b8)],'pendingUrl':_0x5b7667[_0x230191(0x181)],'customerEmail':_0x5b7667[_0x230191(0x1ac)],'customerName':_0x5b7667[_0x230191(0x1c5)],'merchantBrand':_0x5b7667[_0x230191(0x1a9)][_0x230191(0x19f)],'createdAt':_0x5b7667[_0x230191(0x1b9)],'updatedAt':_0x5b7667[_0x230191(0x1a4)]}});}catch(_0x45caa0){console[_0x230191(0x1bd)](_0x230191(0x17c),_0x45caa0),_0x368819['status'](0x1f4)['json']({'success':![],'message':_0x230191(0x195),'error':_0x45caa0 instanceof Error?_0x45caa0[_0x230191(0x1a7)]:'Unknown\x20error'});}}}function a11_0x3ffa(_0x1adf66,_0x410b2d){_0x1adf66=_0x1adf66-0x17a;var _0x2b6e61=a11_0x2b6e();var _0x3ffa62=_0x2b6e61[_0x1adf66];return _0x3ffa62;}exports['OnRampController']=OnRampController;