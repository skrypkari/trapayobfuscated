'use strict';var a11_0x1573fd=a11_0x5ede;function a11_0x5ede(_0x3a116a,_0x1b1d32){_0x3a116a=_0x3a116a-0xe3;var _0x157123=a11_0x1571();var _0x5ede03=_0x157123[_0x3a116a];return _0x5ede03;}(function(_0x5843e9,_0x7d89fc){var _0x510e8a=a11_0x5ede,_0x2ee651=_0x5843e9();while(!![]){try{var _0x4a3ed0=-parseInt(_0x510e8a(0x121))/0x1*(-parseInt(_0x510e8a(0xf3))/0x2)+parseInt(_0x510e8a(0x110))/0x3+-parseInt(_0x510e8a(0xfc))/0x4*(parseInt(_0x510e8a(0x114))/0x5)+-parseInt(_0x510e8a(0xfa))/0x6+parseInt(_0x510e8a(0x116))/0x7*(-parseInt(_0x510e8a(0xe9))/0x8)+parseInt(_0x510e8a(0x10d))/0x9*(parseInt(_0x510e8a(0xe4))/0xa)+-parseInt(_0x510e8a(0x11d))/0xb*(parseInt(_0x510e8a(0x12d))/0xc);if(_0x4a3ed0===_0x7d89fc)break;else _0x2ee651['push'](_0x2ee651['shift']());}catch(_0x1199cb){_0x2ee651['push'](_0x2ee651['shift']());}}}(a11_0x1571,0x5f59d));var __createBinding=this&&this[a11_0x1573fd(0x112)]||(Object['create']?function(_0x5f1a99,_0x1e4e3e,_0x314e97,_0x452dd1){var _0xb02688=a11_0x1573fd;if(_0x452dd1===undefined)_0x452dd1=_0x314e97;var _0x438c7d=Object['getOwnPropertyDescriptor'](_0x1e4e3e,_0x314e97);(!_0x438c7d||(_0xb02688(0x12a)in _0x438c7d?!_0x1e4e3e[_0xb02688(0x11e)]:_0x438c7d[_0xb02688(0x126)]||_0x438c7d['configurable']))&&(_0x438c7d={'enumerable':!![],'get':function(){return _0x1e4e3e[_0x314e97];}}),Object[_0xb02688(0x115)](_0x5f1a99,_0x452dd1,_0x438c7d);}:function(_0x3173ad,_0x8ee17,_0xcf60b3,_0x4d5b17){if(_0x4d5b17===undefined)_0x4d5b17=_0xcf60b3;_0x3173ad[_0x4d5b17]=_0x8ee17[_0xcf60b3];}),__setModuleDefault=this&&this[a11_0x1573fd(0x102)]||(Object[a11_0x1573fd(0xfe)]?function(_0x300012,_0x9a2ba2){var _0x27a4d6=a11_0x1573fd;Object[_0x27a4d6(0x115)](_0x300012,_0x27a4d6(0x109),{'enumerable':!![],'value':_0x9a2ba2});}:function(_0xf1633b,_0x47f6c1){var _0xd46d1b=a11_0x1573fd;_0xf1633b[_0xd46d1b(0x109)]=_0x47f6c1;}),__importStar=this&&this[a11_0x1573fd(0xf5)]||(function(){var _0x174bd2=function(_0xe09668){var _0x183a64=a11_0x5ede;return _0x174bd2=Object[_0x183a64(0x127)]||function(_0x42e818){var _0x5b63e0=_0x183a64,_0x283e1b=[];for(var _0x54cb4d in _0x42e818)if(Object[_0x5b63e0(0x106)][_0x5b63e0(0xee)][_0x5b63e0(0x11a)](_0x42e818,_0x54cb4d))_0x283e1b[_0x283e1b[_0x5b63e0(0x10a)]]=_0x54cb4d;return _0x283e1b;},_0x174bd2(_0xe09668);};return function(_0x5d81c4){var _0xaeb388=a11_0x5ede;if(_0x5d81c4&&_0x5d81c4[_0xaeb388(0x11e)])return _0x5d81c4;var _0x551f74={};if(_0x5d81c4!=null){for(var _0x3bfbee=_0x174bd2(_0x5d81c4),_0x134511=0x0;_0x134511<_0x3bfbee[_0xaeb388(0x10a)];_0x134511++)if(_0x3bfbee[_0x134511]!=='default')__createBinding(_0x551f74,_0x5d81c4,_0x3bfbee[_0x134511]);}return __setModuleDefault(_0x551f74,_0x5d81c4),_0x551f74;};}()),__importDefault=this&&this[a11_0x1573fd(0x123)]||function(_0x15d79c){var _0x4194aa=a11_0x1573fd;return _0x15d79c&&_0x15d79c[_0x4194aa(0x11e)]?_0x15d79c:{'default':_0x15d79c};};Object[a11_0x1573fd(0x115)](exports,a11_0x1573fd(0x11e),{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require(a11_0x1573fd(0x107)));class OnRampController{async[a11_0x1573fd(0xf7)](_0x24cbca,_0x541dbc){var _0xb00b42=a11_0x1573fd;try{const {paymentId:_0x3c5ad9,status:_0x427288,referenceId:_0x2893f6,transactionHash:_0xaf3de6,actualCryptoAmount:_0x2affa6,orderId:_0x402182}=_0x24cbca['body'];if(!_0x3c5ad9||!_0x427288){_0x541dbc[_0xb00b42(0x12f)](0x190)[_0xb00b42(0x120)]({'success':![],'message':_0xb00b42(0xeb)});return;}console[_0xb00b42(0xe3)](_0xb00b42(0x122)+_0x3c5ad9+_0xb00b42(0x118)+_0x427288),console[_0xb00b42(0xe3)]('üìù\x20Data:',{'referenceId':_0x2893f6,'transactionHash':_0xaf3de6,'actualCryptoAmount':_0x2affa6,'orderId':_0x402182});const _0x4aa280=await database_1[_0xb00b42(0x109)][_0xb00b42(0x124)][_0xb00b42(0xe5)]({'where':{'OR':[{'id':_0x3c5ad9},{'orderId':_0x3c5ad9},{'gatewayOrderId':_0x3c5ad9},{'gatewayPaymentId':_0x3c5ad9}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x4aa280){_0x541dbc[_0xb00b42(0x12f)](0x194)['json']({'success':![],'message':_0xb00b42(0x12c)});return;}if(_0x4aa280['gateway']!=='onramp'){_0x541dbc[_0xb00b42(0x12f)](0x190)[_0xb00b42(0x120)]({'success':![],'message':'This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway'});return;}const _0x5c4382={'status':_0x427288[_0xb00b42(0xf6)](),'statusChangedAt':new Date(),'statusChangedBy':_0xb00b42(0xff)};_0x2893f6&&(_0x5c4382['gatewayOrderId']=_0x2893f6);_0xaf3de6&&(_0x5c4382[_0xb00b42(0x100)]=_0xaf3de6);_0x2affa6&&(_0x5c4382[_0xb00b42(0x10b)]=_0x2affa6);const _0x5b7141=await database_1[_0xb00b42(0x109)][_0xb00b42(0x124)]['update']({'where':{'id':_0x4aa280['id']},'data':_0x5c4382});console[_0xb00b42(0xe3)](_0xb00b42(0x101)+_0x4aa280['id']+_0xb00b42(0x10e)+_0x427288),_0x427288['toUpperCase']()===_0xb00b42(0xed)&&_0x4aa280[_0xb00b42(0x12f)]!==_0xb00b42(0xed)&&await this[_0xb00b42(0xf0)](_0x4aa280),_0x541dbc[_0xb00b42(0x120)]({'success':!![],'message':_0xb00b42(0xe6),'data':{'paymentId':_0x5b7141['id'],'status':_0x5b7141[_0xb00b42(0x12f)],'referenceId':_0x2893f6,'transactionHash':_0xaf3de6,'actualCryptoAmount':_0x2affa6}});}catch(_0x417350){console[_0xb00b42(0x128)](_0xb00b42(0xea),_0x417350),_0x541dbc[_0xb00b42(0x12f)](0x1f4)[_0xb00b42(0x120)]({'success':![],'message':_0xb00b42(0x12b),'error':_0x417350 instanceof Error?_0x417350[_0xb00b42(0x131)]:_0xb00b42(0xef)});}}async['updateMerchantBalanceForPaidPayment'](_0x47206e){var _0x1b11c2=a11_0x1573fd;try{console['log'](_0x1b11c2(0x117)+_0x47206e['id']);let _0x32f076;if(_0x47206e['currency']===_0x1b11c2(0x11f))_0x32f076=_0x47206e[_0x1b11c2(0x11b)];else{const {currencyService:_0x126eed}=await Promise[_0x1b11c2(0x103)]()[_0x1b11c2(0xfb)](()=>__importStar(require('../services/currencyService')));_0x32f076=await _0x126eed[_0x1b11c2(0x12e)](_0x47206e[_0x1b11c2(0x11b)],_0x47206e[_0x1b11c2(0x105)]);}await database_1[_0x1b11c2(0x109)][_0x1b11c2(0x124)]['update']({'where':{'id':_0x47206e['id']},'data':{'amountUSDT':_0x32f076,'paidAt':new Date()}});const _0x5cc2c9=0xa,_0xe06134=_0x32f076*(0x1-_0x5cc2c9/0x64);await database_1[_0x1b11c2(0x109)][_0x1b11c2(0xf9)][_0x1b11c2(0x111)]({'where':{'id':_0x47206e['shopId']},'data':{'balance':{'increment':_0xe06134}}}),console[_0x1b11c2(0xe3)](_0x1b11c2(0xf8)+_0xe06134[_0x1b11c2(0x119)](0x6)+_0x1b11c2(0xf1)+_0x5cc2c9+_0x1b11c2(0xf2));}catch(_0x581794){console[_0x1b11c2(0x128)](_0x1b11c2(0xe8),_0x581794);}}async[a11_0x1573fd(0xec)](_0x2ec8a8,_0x2352cf){var _0x5be506=a11_0x1573fd;try{const {id:_0x59b016}=_0x2ec8a8[_0x5be506(0x108)];if(!_0x59b016){_0x2352cf[_0x5be506(0x12f)](0x190)[_0x5be506(0x120)]({'success':![],'message':_0x5be506(0x129)});return;}console['log'](_0x5be506(0xe7)+_0x59b016);const _0x299bbe=await database_1[_0x5be506(0x109)]['payment'][_0x5be506(0xe5)]({'where':{'OR':[{'id':_0x59b016},{'orderId':_0x59b016},{'gatewayOrderId':_0x59b016},{'gatewayPaymentId':_0x59b016}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x299bbe){_0x2352cf[_0x5be506(0x12f)](0x194)[_0x5be506(0x120)]({'success':![],'message':_0x5be506(0x12c)});return;}console['log']('‚úÖ\x20Found\x20payment:\x20'+_0x299bbe['id']+'\x20('+_0x299bbe[_0x5be506(0x12f)]+')'),_0x2352cf[_0x5be506(0x120)]({'success':!![],'data':{'id':_0x299bbe['id'],'gateway':_0x299bbe[_0x5be506(0x125)],'amount':_0x299bbe[_0x5be506(0x11b)],'currency':_0x299bbe[_0x5be506(0x105)],'status':_0x299bbe[_0x5be506(0x12f)],'gatewayOrderId':_0x299bbe['gatewayOrderId'],'gatewayPaymentId':_0x299bbe['gatewayPaymentId'],'successUrl':_0x299bbe[_0x5be506(0x113)],'failUrl':_0x299bbe[_0x5be506(0x11c)],'pendingUrl':_0x299bbe[_0x5be506(0xfd)],'customerEmail':_0x299bbe[_0x5be506(0xf4)],'customerName':_0x299bbe[_0x5be506(0x104)],'merchantBrand':_0x299bbe[_0x5be506(0xf9)][_0x5be506(0x10c)],'createdAt':_0x299bbe[_0x5be506(0x130)],'updatedAt':_0x299bbe['updatedAt']}});}catch(_0x27122a){console['error'](_0x5be506(0x10f),_0x27122a),_0x2352cf[_0x5be506(0x12f)](0x1f4)[_0x5be506(0x120)]({'success':![],'message':_0x5be506(0x12b),'error':_0x27122a instanceof Error?_0x27122a[_0x5be506(0x131)]:_0x5be506(0xef)});}}}function a11_0x1571(){var _0xc53cf4=['\x20updated\x20to\x20','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','2051208BrvXbv','update','__createBinding','successUrl','50GADrSX','defineProperty','257306GYneRy','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','\x20->\x20','toFixed','call','amount','failUrl','121011KnwPCc','__esModule','USD','json','24004jQkBvU','üöÄ\x20OnRamp\x20status\x20update:\x20','__importDefault','payment','gateway','writable','getOwnPropertyNames','error','Payment\x20ID\x20is\x20required','get','Internal\x20server\x20error','Payment\x20not\x20found','492dCRpgB','convertToUSDT','status','createdAt','message','log','1501160HihFPk','findFirst','Payment\x20status\x20updated\x20successfully','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','56iGSRJh','‚ùå\x20OnRamp\x20status\x20update\x20error:','Payment\x20ID\x20and\x20status\x20are\x20required','getPaymentData','PAID','hasOwnProperty','Unknown\x20error','updateMerchantBalanceForPaidPayment','\x20USDT\x20(after\x20','%\x20commission)','52JDfFbv','customerEmail','__importStar','toUpperCase','updatePaymentStatus','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','shop','1531284QizGyb','then','161628lfXnWT','pendingUrl','create','onramp_system','gatewayPaymentId','‚úÖ\x20OnRamp\x20payment\x20','__setModuleDefault','resolve','customerName','currency','prototype','../config/database','params','default','length','invoiceTotalSum','name','27DFqVCg'];a11_0x1571=function(){return _0xc53cf4;};return a11_0x1571();}exports['OnRampController']=OnRampController;