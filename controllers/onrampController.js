'use strict';var a9_0x506c61=a9_0x3168;(function(_0x1be32b,_0x11a86c){var _0x5d5732=a9_0x3168,_0x1d9f33=_0x1be32b();while(!![]){try{var _0x57f297=-parseInt(_0x5d5732(0x169))/0x1+parseInt(_0x5d5732(0x15a))/0x2*(parseInt(_0x5d5732(0x154))/0x3)+parseInt(_0x5d5732(0x14b))/0x4+-parseInt(_0x5d5732(0x178))/0x5*(parseInt(_0x5d5732(0x15e))/0x6)+-parseInt(_0x5d5732(0x166))/0x7+-parseInt(_0x5d5732(0x14a))/0x8*(parseInt(_0x5d5732(0x180))/0x9)+-parseInt(_0x5d5732(0x15c))/0xa*(-parseInt(_0x5d5732(0x18c))/0xb);if(_0x57f297===_0x11a86c)break;else _0x1d9f33['push'](_0x1d9f33['shift']());}catch(_0x4e7f7d){_0x1d9f33['push'](_0x1d9f33['shift']());}}}(a9_0x2a8b,0x51603));function a9_0x3168(_0xaf27ed,_0x1bae4f){var _0x2a8b5d=a9_0x2a8b();return a9_0x3168=function(_0x31686d,_0x45ed39){_0x31686d=_0x31686d-0x147;var _0x36a5c9=_0x2a8b5d[_0x31686d];return _0x36a5c9;},a9_0x3168(_0xaf27ed,_0x1bae4f);}function a9_0x2a8b(){var _0x2e25af=['length','params','pendingUrl','payment','3099SkjNHO','convertToUSDT','currency','%\x20commission)','toUpperCase','successUrl','562rSnOaw','‚úÖ\x20OnRamp\x20payment\x20','3328930VukFHf','gateway','1842lVTVjN','‚úÖ\x20Found\x20payment:\x20','Internal\x20server\x20error','\x20updated\x20to\x20','create','../services/currencyService','üìù\x20Data:','failUrl','1532167AgFnoq','OnRampController','getOwnPropertyDescriptor','483618wiAeVt','updateMerchantBalanceForPaidPayment','üöÄ\x20OnRamp\x20status\x20update:\x20','Payment\x20ID\x20and\x20status\x20are\x20required','\x20->\x20','status','amount','defineProperty','get','shop','Payment\x20not\x20found','‚ùå\x20OnRamp\x20status\x20update\x20error:','gatewayOrderId','getOwnPropertyNames','message','995HPiEpZ','findFirst','Payment\x20status\x20updated\x20successfully','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','../config/database','invoiceTotalSum','configurable','Payment\x20ID\x20is\x20required','9TIGrKF','__createBinding','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','gatewayPaymentId','resolve','__esModule','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','then','body','update','json','default','22NsixnO','PAID','log','error','updatePaymentStatus','USD','onramp_system','3803816sPnHSj','2465300pNCudd','\x20USDT\x20(after\x20','hasOwnProperty','getPaymentData','createdAt'];a9_0x2a8b=function(){return _0x2e25af;};return a9_0x2a8b();}var __createBinding=this&&this[a9_0x506c61(0x181)]||(Object[a9_0x506c61(0x162)]?function(_0x45c5b1,_0xd88664,_0x28a458,_0x5b5a82){var _0x32d256=a9_0x506c61;if(_0x5b5a82===undefined)_0x5b5a82=_0x28a458;var _0x497b89=Object[_0x32d256(0x168)](_0xd88664,_0x28a458);(!_0x497b89||(_0x32d256(0x171)in _0x497b89?!_0xd88664[_0x32d256(0x185)]:_0x497b89['writable']||_0x497b89[_0x32d256(0x17e)]))&&(_0x497b89={'enumerable':!![],'get':function(){return _0xd88664[_0x28a458];}}),Object[_0x32d256(0x170)](_0x45c5b1,_0x5b5a82,_0x497b89);}:function(_0x3f2c68,_0x33713f,_0x3d27b5,_0x5ab919){if(_0x5ab919===undefined)_0x5ab919=_0x3d27b5;_0x3f2c68[_0x5ab919]=_0x33713f[_0x3d27b5];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a9_0x506c61(0x162)]?function(_0x4107d3,_0x3d45c3){var _0x443d63=a9_0x506c61;Object['defineProperty'](_0x4107d3,_0x443d63(0x18b),{'enumerable':!![],'value':_0x3d45c3});}:function(_0x1c9b2c,_0x57d3a2){var _0x3c09dc=a9_0x506c61;_0x1c9b2c[_0x3c09dc(0x18b)]=_0x57d3a2;}),__importStar=this&&this['__importStar']||(function(){var _0x46dae9=function(_0x445d68){var _0x2f0e0d=a9_0x3168;return _0x46dae9=Object[_0x2f0e0d(0x176)]||function(_0x3f04fc){var _0x53296d=_0x2f0e0d,_0x37d628=[];for(var _0x21c1c4 in _0x3f04fc)if(Object['prototype'][_0x53296d(0x14d)]['call'](_0x3f04fc,_0x21c1c4))_0x37d628[_0x37d628['length']]=_0x21c1c4;return _0x37d628;},_0x46dae9(_0x445d68);};return function(_0x5cf45b){var _0x213b42=a9_0x3168;if(_0x5cf45b&&_0x5cf45b[_0x213b42(0x185)])return _0x5cf45b;var _0x40c6ad={};if(_0x5cf45b!=null){for(var _0x2c0271=_0x46dae9(_0x5cf45b),_0xdb9f0=0x0;_0xdb9f0<_0x2c0271[_0x213b42(0x150)];_0xdb9f0++)if(_0x2c0271[_0xdb9f0]!==_0x213b42(0x18b))__createBinding(_0x40c6ad,_0x5cf45b,_0x2c0271[_0xdb9f0]);}return __setModuleDefault(_0x40c6ad,_0x5cf45b),_0x40c6ad;};}()),__importDefault=this&&this['__importDefault']||function(_0x428a5f){var _0x4970bb=a9_0x506c61;return _0x428a5f&&_0x428a5f[_0x4970bb(0x185)]?_0x428a5f:{'default':_0x428a5f};};Object[a9_0x506c61(0x170)](exports,a9_0x506c61(0x185),{'value':!![]}),exports[a9_0x506c61(0x167)]=void 0x0;const database_1=__importDefault(require(a9_0x506c61(0x17c)));class OnRampController{async[a9_0x506c61(0x147)](_0x48d091,_0x47f6b0){var _0x186024=a9_0x506c61;try{const {paymentId:_0x42c308,status:_0xb3e718,referenceId:_0x30378f,transactionHash:_0x227313,actualCryptoAmount:_0x13a308,orderId:_0x4c008b}=_0x48d091[_0x186024(0x188)];if(!_0x42c308||!_0xb3e718){_0x47f6b0['status'](0x190)['json']({'success':![],'message':_0x186024(0x16c)});return;}console[_0x186024(0x18e)](_0x186024(0x16b)+_0x42c308+_0x186024(0x16d)+_0xb3e718),console[_0x186024(0x18e)](_0x186024(0x164),{'referenceId':_0x30378f,'transactionHash':_0x227313,'actualCryptoAmount':_0x13a308,'orderId':_0x4c008b});const _0x50a868=await database_1[_0x186024(0x18b)][_0x186024(0x153)][_0x186024(0x179)]({'where':{'OR':[{'id':_0x42c308},{'orderId':_0x42c308},{'gatewayOrderId':_0x42c308},{'gatewayPaymentId':_0x42c308}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x50a868){_0x47f6b0[_0x186024(0x16e)](0x194)[_0x186024(0x18a)]({'success':![],'message':_0x186024(0x173)});return;}if(_0x50a868[_0x186024(0x15d)]!=='onramp'){_0x47f6b0['status'](0x190)[_0x186024(0x18a)]({'success':![],'message':_0x186024(0x17b)});return;}const _0x27f5b4={'status':_0xb3e718[_0x186024(0x158)](),'statusChangedAt':new Date(),'statusChangedBy':_0x186024(0x149)};_0x30378f&&(_0x27f5b4[_0x186024(0x175)]=_0x30378f);_0x227313&&(_0x27f5b4['gatewayPaymentId']=_0x227313);_0x13a308&&(_0x27f5b4[_0x186024(0x17d)]=_0x13a308);const _0x3de258=await database_1[_0x186024(0x18b)]['payment'][_0x186024(0x189)]({'where':{'id':_0x50a868['id']},'data':_0x27f5b4});console[_0x186024(0x18e)](_0x186024(0x15b)+_0x50a868['id']+_0x186024(0x161)+_0xb3e718),_0xb3e718[_0x186024(0x158)]()===_0x186024(0x18d)&&_0x50a868['status']!=='PAID'&&await this[_0x186024(0x16a)](_0x50a868),_0x47f6b0[_0x186024(0x18a)]({'success':!![],'message':_0x186024(0x17a),'data':{'paymentId':_0x3de258['id'],'status':_0x3de258['status'],'referenceId':_0x30378f,'transactionHash':_0x227313,'actualCryptoAmount':_0x13a308}});}catch(_0x2b9b49){console['error'](_0x186024(0x174),_0x2b9b49),_0x47f6b0[_0x186024(0x16e)](0x1f4)[_0x186024(0x18a)]({'success':![],'message':_0x186024(0x160),'error':_0x2b9b49 instanceof Error?_0x2b9b49[_0x186024(0x177)]:'Unknown\x20error'});}}async[a9_0x506c61(0x16a)](_0x32dbe7){var _0x21b9e8=a9_0x506c61;try{console[_0x21b9e8(0x18e)](_0x21b9e8(0x186)+_0x32dbe7['id']);let _0x30f81b;if(_0x32dbe7[_0x21b9e8(0x156)]===_0x21b9e8(0x148))_0x30f81b=_0x32dbe7[_0x21b9e8(0x16f)];else{const {currencyService:_0x48f494}=await Promise[_0x21b9e8(0x184)]()[_0x21b9e8(0x187)](()=>__importStar(require(_0x21b9e8(0x163))));_0x30f81b=await _0x48f494[_0x21b9e8(0x155)](_0x32dbe7[_0x21b9e8(0x16f)],_0x32dbe7[_0x21b9e8(0x156)]);}await database_1[_0x21b9e8(0x18b)][_0x21b9e8(0x153)][_0x21b9e8(0x189)]({'where':{'id':_0x32dbe7['id']},'data':{'amountUSDT':_0x30f81b,'paidAt':new Date()}});const _0xd6c561=0xa,_0x140b27=_0x30f81b*(0x1-_0xd6c561/0x64);await database_1[_0x21b9e8(0x18b)]['shop'][_0x21b9e8(0x189)]({'where':{'id':_0x32dbe7['shopId']},'data':{'balance':{'increment':_0x140b27}}}),console[_0x21b9e8(0x18e)]('‚úÖ\x20Merchant\x20balance\x20updated:\x20+'+_0x140b27['toFixed'](0x6)+_0x21b9e8(0x14c)+_0xd6c561+_0x21b9e8(0x157));}catch(_0x6a562c){console[_0x21b9e8(0x18f)]('‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:',_0x6a562c);}}async[a9_0x506c61(0x14e)](_0x767f61,_0x3fd767){var _0x57a875=a9_0x506c61;try{const {id:_0x362d21}=_0x767f61[_0x57a875(0x151)];if(!_0x362d21){_0x3fd767[_0x57a875(0x16e)](0x190)[_0x57a875(0x18a)]({'success':![],'message':_0x57a875(0x17f)});return;}console['log']('üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20'+_0x362d21);const _0xd5f21c=await database_1[_0x57a875(0x18b)][_0x57a875(0x153)]['findFirst']({'where':{'OR':[{'id':_0x362d21},{'orderId':_0x362d21},{'gatewayOrderId':_0x362d21},{'gatewayPaymentId':_0x362d21}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0xd5f21c){_0x3fd767[_0x57a875(0x16e)](0x194)[_0x57a875(0x18a)]({'success':![],'message':'Payment\x20not\x20found'});return;}console['log'](_0x57a875(0x15f)+_0xd5f21c['id']+'\x20('+_0xd5f21c[_0x57a875(0x16e)]+')'),_0x3fd767[_0x57a875(0x18a)]({'success':!![],'data':{'id':_0xd5f21c['id'],'gateway':_0xd5f21c[_0x57a875(0x15d)],'amount':_0xd5f21c['amount'],'currency':_0xd5f21c['currency'],'status':_0xd5f21c[_0x57a875(0x16e)],'gatewayOrderId':_0xd5f21c[_0x57a875(0x175)],'gatewayPaymentId':_0xd5f21c[_0x57a875(0x183)],'successUrl':_0xd5f21c[_0x57a875(0x159)],'failUrl':_0xd5f21c[_0x57a875(0x165)],'pendingUrl':_0xd5f21c[_0x57a875(0x152)],'customerEmail':_0xd5f21c['customerEmail'],'customerName':_0xd5f21c['customerName'],'merchantBrand':_0xd5f21c[_0x57a875(0x172)]['name'],'createdAt':_0xd5f21c[_0x57a875(0x14f)],'updatedAt':_0xd5f21c['updatedAt']}});}catch(_0x27f888){console[_0x57a875(0x18f)](_0x57a875(0x182),_0x27f888),_0x3fd767[_0x57a875(0x16e)](0x1f4)['json']({'success':![],'message':_0x57a875(0x160),'error':_0x27f888 instanceof Error?_0x27f888[_0x57a875(0x177)]:'Unknown\x20error'});}}}exports[a9_0x506c61(0x167)]=OnRampController;