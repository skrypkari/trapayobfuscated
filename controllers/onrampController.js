'use strict';var a12_0x5377d9=a12_0x27b2;(function(_0x16b8cf,_0x5b1385){var _0x3f6ed1=a12_0x27b2,_0x45d16b=_0x16b8cf();while(!![]){try{var _0x424c4f=-parseInt(_0x3f6ed1(0x1bd))/0x1+-parseInt(_0x3f6ed1(0x1ac))/0x2+parseInt(_0x3f6ed1(0x182))/0x3+-parseInt(_0x3f6ed1(0x186))/0x4*(parseInt(_0x3f6ed1(0x18d))/0x5)+-parseInt(_0x3f6ed1(0x18f))/0x6*(-parseInt(_0x3f6ed1(0x1bf))/0x7)+-parseInt(_0x3f6ed1(0x1a0))/0x8+parseInt(_0x3f6ed1(0x17e))/0x9;if(_0x424c4f===_0x5b1385)break;else _0x45d16b['push'](_0x45d16b['shift']());}catch(_0x388065){_0x45d16b['push'](_0x45d16b['shift']());}}}(a12_0x1b4d,0xc16fa));function a12_0x1b4d(){var _0x24a52b=['470262SvXxTQ','customerEmail','onramp','name','4yDEWza','json','USD','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','gatewayPaymentId','status','log','7118995posoJj','updatedAt','30qlaxzd','Unknown\x20error','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','üìù\x20Data:','\x20USDT\x20(after\x20','‚úÖ\x20OnRamp\x20payment\x20','gatewayOrderId','error','shop','Payment\x20status\x20updated\x20successfully','findFirst','default','OnRampController','length','Internal\x20server\x20error','onramp_system','getOwnPropertyDescriptor','6554352QhUsLA','then','../services/currencyService','configurable','successUrl','message','‚úÖ\x20Found\x20payment:\x20','PAID','params','writable','payment','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','2807510teyPEc','\x20->\x20','create','amount','defineProperty','__importDefault','toUpperCase','üöÄ\x20OnRamp\x20status\x20update:\x20','hasOwnProperty','convertToUSDT','updateMerchantBalanceForPaidPayment','get','update','Payment\x20not\x20found','failUrl','shopId','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','1466938THBvPY','__esModule','1825124ouwKaf','__createBinding','getOwnPropertyNames','\x20updated\x20to\x20','pendingUrl','customerName','gateway','invoiceTotalSum','resolve','call','%\x20commission)','40011174hFuBxD','__setModuleDefault','Payment\x20ID\x20and\x20status\x20are\x20required','currency'];a12_0x1b4d=function(){return _0x24a52b;};return a12_0x1b4d();}var __createBinding=this&&this[a12_0x5377d9(0x1c0)]||(Object[a12_0x5377d9(0x1ae)]?function(_0x18c02a,_0xe75b49,_0x5215f6,_0x3d26c7){var _0x5f5206=a12_0x5377d9;if(_0x3d26c7===undefined)_0x3d26c7=_0x5215f6;var _0x49078f=Object[_0x5f5206(0x19f)](_0xe75b49,_0x5215f6);(!_0x49078f||(_0x5f5206(0x1b7)in _0x49078f?!_0xe75b49[_0x5f5206(0x1be)]:_0x49078f[_0x5f5206(0x1a9)]||_0x49078f[_0x5f5206(0x1a3)]))&&(_0x49078f={'enumerable':!![],'get':function(){return _0xe75b49[_0x5215f6];}}),Object[_0x5f5206(0x1b0)](_0x18c02a,_0x3d26c7,_0x49078f);}:function(_0x4d7b11,_0x278065,_0x3fc17c,_0x353bad){if(_0x353bad===undefined)_0x353bad=_0x3fc17c;_0x4d7b11[_0x353bad]=_0x278065[_0x3fc17c];}),__setModuleDefault=this&&this[a12_0x5377d9(0x17f)]||(Object[a12_0x5377d9(0x1ae)]?function(_0x557898,_0x1a6403){var _0x210dd9=a12_0x5377d9;Object['defineProperty'](_0x557898,_0x210dd9(0x19a),{'enumerable':!![],'value':_0x1a6403});}:function(_0xb643d4,_0x46d8a9){var _0x1fea1a=a12_0x5377d9;_0xb643d4[_0x1fea1a(0x19a)]=_0x46d8a9;}),__importStar=this&&this['__importStar']||(function(){var _0xdfafd4=function(_0x216bc5){var _0x3c0ff5=a12_0x27b2;return _0xdfafd4=Object[_0x3c0ff5(0x1c1)]||function(_0x439368){var _0x4722cf=_0x3c0ff5,_0x4ee0a3=[];for(var _0x2570c7 in _0x439368)if(Object['prototype'][_0x4722cf(0x1b4)][_0x4722cf(0x17c)](_0x439368,_0x2570c7))_0x4ee0a3[_0x4ee0a3[_0x4722cf(0x19c)]]=_0x2570c7;return _0x4ee0a3;},_0xdfafd4(_0x216bc5);};return function(_0x29f769){var _0x1c6300=a12_0x27b2;if(_0x29f769&&_0x29f769['__esModule'])return _0x29f769;var _0xb363b6={};if(_0x29f769!=null){for(var _0x24a785=_0xdfafd4(_0x29f769),_0xca062e=0x0;_0xca062e<_0x24a785['length'];_0xca062e++)if(_0x24a785[_0xca062e]!==_0x1c6300(0x19a))__createBinding(_0xb363b6,_0x29f769,_0x24a785[_0xca062e]);}return __setModuleDefault(_0xb363b6,_0x29f769),_0xb363b6;};}()),__importDefault=this&&this[a12_0x5377d9(0x1b1)]||function(_0x4a13ef){return _0x4a13ef&&_0x4a13ef['__esModule']?_0x4a13ef:{'default':_0x4a13ef};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a12_0x5377d9(0x19b)]=void 0x0;const database_1=__importDefault(require('../config/database'));class OnRampController{async['updatePaymentStatus'](_0x5a4249,_0x1a0222){var _0x32d109=a12_0x5377d9;try{const {paymentId:_0x191fe2,status:_0x153c78,referenceId:_0x21a88a,transactionHash:_0x11f29a,actualCryptoAmount:_0x1be8b1,orderId:_0x3c2946}=_0x5a4249['body'];if(!_0x191fe2||!_0x153c78){_0x1a0222[_0x32d109(0x18b)](0x190)[_0x32d109(0x187)]({'success':![],'message':_0x32d109(0x180)});return;}console[_0x32d109(0x18c)](_0x32d109(0x1b3)+_0x191fe2+_0x32d109(0x1ad)+_0x153c78),console[_0x32d109(0x18c)](_0x32d109(0x192),{'referenceId':_0x21a88a,'transactionHash':_0x11f29a,'actualCryptoAmount':_0x1be8b1,'orderId':_0x3c2946});const _0x5ce5ec=await database_1[_0x32d109(0x19a)][_0x32d109(0x1aa)][_0x32d109(0x199)]({'where':{'OR':[{'id':_0x191fe2},{'orderId':_0x191fe2},{'gatewayOrderId':_0x191fe2},{'gatewayPaymentId':_0x191fe2}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5ce5ec){_0x1a0222[_0x32d109(0x18b)](0x194)['json']({'success':![],'message':'Payment\x20not\x20found'});return;}if(_0x5ce5ec[_0x32d109(0x1c5)]!==_0x32d109(0x184)){_0x1a0222['status'](0x190)[_0x32d109(0x187)]({'success':![],'message':_0x32d109(0x189)});return;}const _0x1334f3={'status':_0x153c78[_0x32d109(0x1b2)](),'statusChangedAt':new Date(),'statusChangedBy':_0x32d109(0x19e)};_0x21a88a&&(_0x1334f3[_0x32d109(0x195)]=_0x21a88a);_0x11f29a&&(_0x1334f3[_0x32d109(0x18a)]=_0x11f29a);_0x1be8b1&&(_0x1334f3[_0x32d109(0x17a)]=_0x1be8b1);const _0x37a8f1=await database_1['default'][_0x32d109(0x1aa)]['update']({'where':{'id':_0x5ce5ec['id']},'data':_0x1334f3});console[_0x32d109(0x18c)](_0x32d109(0x194)+_0x5ce5ec['id']+_0x32d109(0x1c2)+_0x153c78),_0x153c78[_0x32d109(0x1b2)]()==='PAID'&&_0x5ce5ec['status']!==_0x32d109(0x1a7)&&await this['updateMerchantBalanceForPaidPayment'](_0x5ce5ec),_0x1a0222['json']({'success':!![],'message':_0x32d109(0x198),'data':{'paymentId':_0x37a8f1['id'],'status':_0x37a8f1['status'],'referenceId':_0x21a88a,'transactionHash':_0x11f29a,'actualCryptoAmount':_0x1be8b1}});}catch(_0x2708b9){console[_0x32d109(0x196)]('‚ùå\x20OnRamp\x20status\x20update\x20error:',_0x2708b9),_0x1a0222['status'](0x1f4)[_0x32d109(0x187)]({'success':![],'message':_0x32d109(0x19d),'error':_0x2708b9 instanceof Error?_0x2708b9[_0x32d109(0x1a5)]:'Unknown\x20error'});}}async[a12_0x5377d9(0x1b6)](_0xc0ab07){var _0x4faa8b=a12_0x5377d9;try{console[_0x4faa8b(0x18c)](_0x4faa8b(0x1bc)+_0xc0ab07['id']);let _0x430b9c;if(_0xc0ab07['currency']===_0x4faa8b(0x188))_0x430b9c=_0xc0ab07[_0x4faa8b(0x1af)];else{const {currencyService:_0x51a4a}=await Promise[_0x4faa8b(0x17b)]()[_0x4faa8b(0x1a1)](()=>__importStar(require(_0x4faa8b(0x1a2))));_0x430b9c=await _0x51a4a[_0x4faa8b(0x1b5)](_0xc0ab07[_0x4faa8b(0x1af)],_0xc0ab07['currency']);}await database_1[_0x4faa8b(0x19a)]['payment'][_0x4faa8b(0x1b8)]({'where':{'id':_0xc0ab07['id']},'data':{'amountUSDT':_0x430b9c,'paidAt':new Date()}});const _0x363d51=0xa,_0x2312ea=_0x430b9c*(0x1-_0x363d51/0x64);await database_1['default'][_0x4faa8b(0x197)]['update']({'where':{'id':_0xc0ab07[_0x4faa8b(0x1bb)]},'data':{'balance':{'increment':_0x2312ea}}}),console[_0x4faa8b(0x18c)](_0x4faa8b(0x1ab)+_0x2312ea['toFixed'](0x6)+_0x4faa8b(0x193)+_0x363d51+_0x4faa8b(0x17d));}catch(_0x2c3b77){console[_0x4faa8b(0x196)](_0x4faa8b(0x191),_0x2c3b77);}}async['getPaymentData'](_0x574eeb,_0x1c0a48){var _0x52569e=a12_0x5377d9;try{const {id:_0x52874e}=_0x574eeb[_0x52569e(0x1a8)];if(!_0x52874e){_0x1c0a48['status'](0x190)[_0x52569e(0x187)]({'success':![],'message':'Payment\x20ID\x20is\x20required'});return;}console[_0x52569e(0x18c)]('üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20'+_0x52874e);const _0x47095c=await database_1[_0x52569e(0x19a)][_0x52569e(0x1aa)][_0x52569e(0x199)]({'where':{'OR':[{'id':_0x52874e},{'orderId':_0x52874e},{'gatewayOrderId':_0x52874e},{'gatewayPaymentId':_0x52874e}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x47095c){_0x1c0a48[_0x52569e(0x18b)](0x194)[_0x52569e(0x187)]({'success':![],'message':_0x52569e(0x1b9)});return;}console[_0x52569e(0x18c)](_0x52569e(0x1a6)+_0x47095c['id']+'\x20('+_0x47095c['status']+')'),_0x1c0a48[_0x52569e(0x187)]({'success':!![],'data':{'id':_0x47095c['id'],'gateway':_0x47095c['gateway'],'amount':_0x47095c[_0x52569e(0x1af)],'currency':_0x47095c[_0x52569e(0x181)],'status':_0x47095c[_0x52569e(0x18b)],'gatewayOrderId':_0x47095c[_0x52569e(0x195)],'gatewayPaymentId':_0x47095c[_0x52569e(0x18a)],'successUrl':_0x47095c[_0x52569e(0x1a4)],'failUrl':_0x47095c[_0x52569e(0x1ba)],'pendingUrl':_0x47095c[_0x52569e(0x1c3)],'customerEmail':_0x47095c[_0x52569e(0x183)],'customerName':_0x47095c[_0x52569e(0x1c4)],'merchantBrand':_0x47095c[_0x52569e(0x197)][_0x52569e(0x185)],'createdAt':_0x47095c['createdAt'],'updatedAt':_0x47095c[_0x52569e(0x18e)]}});}catch(_0x208b21){console['error']('‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:',_0x208b21),_0x1c0a48[_0x52569e(0x18b)](0x1f4)[_0x52569e(0x187)]({'success':![],'message':_0x52569e(0x19d),'error':_0x208b21 instanceof Error?_0x208b21[_0x52569e(0x1a5)]:_0x52569e(0x190)});}}}function a12_0x27b2(_0x498100,_0x47e1c5){_0x498100=_0x498100-0x17a;var _0x1b4dfd=a12_0x1b4d();var _0x27b2b3=_0x1b4dfd[_0x498100];return _0x27b2b3;}exports[a12_0x5377d9(0x19b)]=OnRampController;