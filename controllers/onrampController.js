'use strict';var a9_0x4596b3=a9_0x2601;function a9_0x4c57(){var _0x3f5bf7=['error','951310iWsOyv','gatewayPaymentId','__esModule','successUrl','invoiceTotalSum','Unknown\x20error','getOwnPropertyNames','%\x20commission)','gatewayOrderId','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','updateMerchantBalanceForPaidPayment','length','7hZEzlI','get','USD','109049jayFgG','109728mHSBtr','‚úÖ\x20OnRamp\x20payment\x20','Internal\x20server\x20error','findFirst','\x20updated\x20to\x20','hasOwnProperty','3238456oVzAXG','PAID','message','shopId','toUpperCase','\x20->\x20','convertToUSDT','../services/currencyService','status','resolve','defineProperty','toFixed','Payment\x20ID\x20is\x20required','create','json','90LSgfoP','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','updatedAt','getOwnPropertyDescriptor','52370VvDLVe','shop','payment','__importStar','36XyuaHA','‚ùå\x20OnRamp\x20status\x20update\x20error:','55JenHdo','Payment\x20status\x20updated\x20successfully','prototype','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','gateway','call','default','currency','OnRampController','__createBinding','amount','onramp','üìù\x20Data:','customerEmail','updatePaymentStatus','writable','Payment\x20ID\x20and\x20status\x20are\x20required','customerName','103873CtTjSi','111486JdOkbt','log','getPaymentData','failUrl','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','‚úÖ\x20Found\x20payment:\x20','update','üöÄ\x20OnRamp\x20status\x20update:\x20','Payment\x20not\x20found'];a9_0x4c57=function(){return _0x3f5bf7;};return a9_0x4c57();}(function(_0x57f4e6,_0x428477){var _0x4a9591=a9_0x2601,_0x307978=_0x57f4e6();while(!![]){try{var _0x2d343f=parseInt(_0x4a9591(0x119))/0x1+parseInt(_0x4a9591(0x157))/0x2+parseInt(_0x4a9591(0x137))/0x3*(parseInt(_0x4a9591(0x11a))/0x4)+-parseInt(_0x4a9591(0x139))/0x5*(parseInt(_0x4a9591(0x14c))/0x6)+-parseInt(_0x4a9591(0x116))/0x7*(parseInt(_0x4a9591(0x120))/0x8)+-parseInt(_0x4a9591(0x12f))/0x9*(parseInt(_0x4a9591(0x133))/0xa)+-parseInt(_0x4a9591(0x14b))/0xb;if(_0x2d343f===_0x428477)break;else _0x307978['push'](_0x307978['shift']());}catch(_0x1af200){_0x307978['push'](_0x307978['shift']());}}}(a9_0x4c57,0x3b4bd));function a9_0x2601(_0x18bdff,_0x132b92){var _0x4c5747=a9_0x4c57();return a9_0x2601=function(_0x260150,_0x3b7e22){_0x260150=_0x260150-0x10f;var _0x56fb11=_0x4c5747[_0x260150];return _0x56fb11;},a9_0x2601(_0x18bdff,_0x132b92);}var __createBinding=this&&this[a9_0x4596b3(0x142)]||(Object[a9_0x4596b3(0x12d)]?function(_0x4abfcc,_0x45c86f,_0x197226,_0x2003c8){var _0x4c144e=a9_0x4596b3;if(_0x2003c8===undefined)_0x2003c8=_0x197226;var _0x215ae6=Object[_0x4c144e(0x132)](_0x45c86f,_0x197226);(!_0x215ae6||(_0x4c144e(0x117)in _0x215ae6?!_0x45c86f['__esModule']:_0x215ae6[_0x4c144e(0x148)]||_0x215ae6['configurable']))&&(_0x215ae6={'enumerable':!![],'get':function(){return _0x45c86f[_0x197226];}}),Object[_0x4c144e(0x12a)](_0x4abfcc,_0x2003c8,_0x215ae6);}:function(_0x453fd3,_0x2e33ef,_0x501ec4,_0x529fe9){if(_0x529fe9===undefined)_0x529fe9=_0x501ec4;_0x453fd3[_0x529fe9]=_0x2e33ef[_0x501ec4];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x504b8c,_0x3b1262){var _0x58793a=a9_0x4596b3;Object[_0x58793a(0x12a)](_0x504b8c,_0x58793a(0x13f),{'enumerable':!![],'value':_0x3b1262});}:function(_0x3ebc26,_0x212ad3){var _0x4a1a94=a9_0x4596b3;_0x3ebc26[_0x4a1a94(0x13f)]=_0x212ad3;}),__importStar=this&&this[a9_0x4596b3(0x136)]||(function(){var _0x3ae052=function(_0x4b4d79){var _0x19b6d3=a9_0x2601;return _0x3ae052=Object[_0x19b6d3(0x110)]||function(_0x1da118){var _0x1a6e8d=_0x19b6d3,_0x48408f=[];for(var _0x418ce8 in _0x1da118)if(Object[_0x1a6e8d(0x13b)][_0x1a6e8d(0x11f)][_0x1a6e8d(0x13e)](_0x1da118,_0x418ce8))_0x48408f[_0x48408f[_0x1a6e8d(0x115)]]=_0x418ce8;return _0x48408f;},_0x3ae052(_0x4b4d79);};return function(_0x432b79){var _0xfd971=a9_0x2601;if(_0x432b79&&_0x432b79[_0xfd971(0x159)])return _0x432b79;var _0x5d9bc4={};if(_0x432b79!=null){for(var _0xf7a95f=_0x3ae052(_0x432b79),_0x471765=0x0;_0x471765<_0xf7a95f[_0xfd971(0x115)];_0x471765++)if(_0xf7a95f[_0x471765]!=='default')__createBinding(_0x5d9bc4,_0x432b79,_0xf7a95f[_0x471765]);}return __setModuleDefault(_0x5d9bc4,_0x432b79),_0x5d9bc4;};}()),__importDefault=this&&this['__importDefault']||function(_0x577774){var _0x57bddb=a9_0x4596b3;return _0x577774&&_0x577774[_0x57bddb(0x159)]?_0x577774:{'default':_0x577774};};Object[a9_0x4596b3(0x12a)](exports,a9_0x4596b3(0x159),{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require('../config/database'));class OnRampController{async[a9_0x4596b3(0x147)](_0x44dbbf,_0x41df9e){var _0x3e3761=a9_0x4596b3;try{const {paymentId:_0x14e9ac,status:_0x4c9188,referenceId:_0x53bf81,transactionHash:_0x2b0ae6,actualCryptoAmount:_0x51a9ca,orderId:_0x144580}=_0x44dbbf['body'];if(!_0x14e9ac||!_0x4c9188){_0x41df9e[_0x3e3761(0x128)](0x190)[_0x3e3761(0x12e)]({'success':![],'message':_0x3e3761(0x149)});return;}console['log'](_0x3e3761(0x154)+_0x14e9ac+_0x3e3761(0x125)+_0x4c9188),console[_0x3e3761(0x14d)](_0x3e3761(0x145),{'referenceId':_0x53bf81,'transactionHash':_0x2b0ae6,'actualCryptoAmount':_0x51a9ca,'orderId':_0x144580});const _0x19330f=await database_1['default']['payment'][_0x3e3761(0x11d)]({'where':{'OR':[{'id':_0x14e9ac},{'orderId':_0x14e9ac},{'gatewayOrderId':_0x14e9ac},{'gatewayPaymentId':_0x14e9ac}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x19330f){_0x41df9e[_0x3e3761(0x128)](0x194)['json']({'success':![],'message':_0x3e3761(0x155)});return;}if(_0x19330f[_0x3e3761(0x13d)]!==_0x3e3761(0x144)){_0x41df9e[_0x3e3761(0x128)](0x190)[_0x3e3761(0x12e)]({'success':![],'message':'This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway'});return;}const _0x2efbeb={'status':_0x4c9188[_0x3e3761(0x124)](),'statusChangedAt':new Date(),'statusChangedBy':'onramp_system'};_0x53bf81&&(_0x2efbeb[_0x3e3761(0x112)]=_0x53bf81);_0x2b0ae6&&(_0x2efbeb['gatewayPaymentId']=_0x2b0ae6);_0x51a9ca&&(_0x2efbeb[_0x3e3761(0x15b)]=_0x51a9ca);const _0x1dc778=await database_1['default'][_0x3e3761(0x135)][_0x3e3761(0x153)]({'where':{'id':_0x19330f['id']},'data':_0x2efbeb});console['log'](_0x3e3761(0x11b)+_0x19330f['id']+_0x3e3761(0x11e)+_0x4c9188),_0x4c9188['toUpperCase']()===_0x3e3761(0x121)&&_0x19330f[_0x3e3761(0x128)]!==_0x3e3761(0x121)&&await this[_0x3e3761(0x114)](_0x19330f),_0x41df9e[_0x3e3761(0x12e)]({'success':!![],'message':_0x3e3761(0x13a),'data':{'paymentId':_0x1dc778['id'],'status':_0x1dc778['status'],'referenceId':_0x53bf81,'transactionHash':_0x2b0ae6,'actualCryptoAmount':_0x51a9ca}});}catch(_0x31b87a){console[_0x3e3761(0x156)](_0x3e3761(0x138),_0x31b87a),_0x41df9e[_0x3e3761(0x128)](0x1f4)[_0x3e3761(0x12e)]({'success':![],'message':'Internal\x20server\x20error','error':_0x31b87a instanceof Error?_0x31b87a[_0x3e3761(0x122)]:_0x3e3761(0x10f)});}}async[a9_0x4596b3(0x114)](_0x2a6c4d){var _0x5ab7ec=a9_0x4596b3;try{console[_0x5ab7ec(0x14d)](_0x5ab7ec(0x151)+_0x2a6c4d['id']);let _0x4f2bbb;if(_0x2a6c4d[_0x5ab7ec(0x140)]===_0x5ab7ec(0x118))_0x4f2bbb=_0x2a6c4d[_0x5ab7ec(0x143)];else{const {currencyService:_0x6a60e9}=await Promise[_0x5ab7ec(0x129)]()['then'](()=>__importStar(require(_0x5ab7ec(0x127))));_0x4f2bbb=await _0x6a60e9[_0x5ab7ec(0x126)](_0x2a6c4d[_0x5ab7ec(0x143)],_0x2a6c4d[_0x5ab7ec(0x140)]);}await database_1['default'][_0x5ab7ec(0x135)]['update']({'where':{'id':_0x2a6c4d['id']},'data':{'amountUSDT':_0x4f2bbb,'paidAt':new Date()}});const _0x11d0ba=0xa,_0xbaa110=_0x4f2bbb*(0x1-_0x11d0ba/0x64);await database_1[_0x5ab7ec(0x13f)][_0x5ab7ec(0x134)][_0x5ab7ec(0x153)]({'where':{'id':_0x2a6c4d[_0x5ab7ec(0x123)]},'data':{'balance':{'increment':_0xbaa110}}}),console[_0x5ab7ec(0x14d)](_0x5ab7ec(0x13c)+_0xbaa110[_0x5ab7ec(0x12b)](0x6)+'\x20USDT\x20(after\x20'+_0x11d0ba+_0x5ab7ec(0x111));}catch(_0x2e6ee0){console[_0x5ab7ec(0x156)](_0x5ab7ec(0x113),_0x2e6ee0);}}async[a9_0x4596b3(0x14e)](_0x451527,_0xbdf63a){var _0x25f485=a9_0x4596b3;try{const {id:_0x51db16}=_0x451527['params'];if(!_0x51db16){_0xbdf63a[_0x25f485(0x128)](0x190)[_0x25f485(0x12e)]({'success':![],'message':_0x25f485(0x12c)});return;}console[_0x25f485(0x14d)](_0x25f485(0x150)+_0x51db16);const _0x320be8=await database_1[_0x25f485(0x13f)]['payment'][_0x25f485(0x11d)]({'where':{'OR':[{'id':_0x51db16},{'orderId':_0x51db16},{'gatewayOrderId':_0x51db16},{'gatewayPaymentId':_0x51db16}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x320be8){_0xbdf63a[_0x25f485(0x128)](0x194)['json']({'success':![],'message':_0x25f485(0x155)});return;}console['log'](_0x25f485(0x152)+_0x320be8['id']+'\x20('+_0x320be8[_0x25f485(0x128)]+')'),_0xbdf63a[_0x25f485(0x12e)]({'success':!![],'data':{'id':_0x320be8['id'],'gateway':_0x320be8['gateway'],'amount':_0x320be8[_0x25f485(0x143)],'currency':_0x320be8[_0x25f485(0x140)],'status':_0x320be8['status'],'gatewayOrderId':_0x320be8['gatewayOrderId'],'gatewayPaymentId':_0x320be8[_0x25f485(0x158)],'successUrl':_0x320be8[_0x25f485(0x15a)],'failUrl':_0x320be8[_0x25f485(0x14f)],'pendingUrl':_0x320be8['pendingUrl'],'customerEmail':_0x320be8[_0x25f485(0x146)],'customerName':_0x320be8[_0x25f485(0x14a)],'merchantBrand':_0x320be8[_0x25f485(0x134)]['name'],'createdAt':_0x320be8['createdAt'],'updatedAt':_0x320be8[_0x25f485(0x131)]}});}catch(_0x3e9353){console[_0x25f485(0x156)](_0x25f485(0x130),_0x3e9353),_0xbdf63a[_0x25f485(0x128)](0x1f4)['json']({'success':![],'message':_0x25f485(0x11c),'error':_0x3e9353 instanceof Error?_0x3e9353['message']:'Unknown\x20error'});}}}exports[a9_0x4596b3(0x141)]=OnRampController;