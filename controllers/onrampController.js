'use strict';var a11_0x2fe0e5=a11_0x19f7;(function(_0x576fd7,_0x4a3463){var _0x4c16df=a11_0x19f7,_0x2241ca=_0x576fd7();while(!![]){try{var _0x1edafd=parseInt(_0x4c16df(0xaa))/0x1+parseInt(_0x4c16df(0x98))/0x2+parseInt(_0x4c16df(0xab))/0x3*(parseInt(_0x4c16df(0x8b))/0x4)+-parseInt(_0x4c16df(0x8d))/0x5*(-parseInt(_0x4c16df(0xa5))/0x6)+parseInt(_0x4c16df(0x91))/0x7*(parseInt(_0x4c16df(0xbd))/0x8)+parseInt(_0x4c16df(0xb8))/0x9*(parseInt(_0x4c16df(0x8e))/0xa)+-parseInt(_0x4c16df(0x9e))/0xb*(parseInt(_0x4c16df(0xa0))/0xc);if(_0x1edafd===_0x4a3463)break;else _0x2241ca['push'](_0x2241ca['shift']());}catch(_0x1834cd){_0x2241ca['push'](_0x2241ca['shift']());}}}(a11_0x4229,0x717f5));function a11_0x4229(){var _0x5810e5=['gatewayPaymentId','default','176kwfpRQ','‚úÖ\x20OnRamp\x20payment\x20','1746096KsXaFD','get','__importDefault','create','log','2216652eLnxup','__esModule','createdAt','update','failUrl','24630ZqxcZq','1979997cmpCJu','call','customerEmail','\x20updated\x20to\x20','customerName','findFirst','shopId','configurable','PAID','toFixed','params','updatedAt','defineProperty','7473483poqtKi','‚ùå\x20OnRamp\x20status\x20update\x20error:','../services/currencyService','getOwnPropertyNames','currency','12784WsgKpU','USD','gateway','message','body','üöÄ\x20OnRamp\x20status\x20update:\x20','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','status','‚úÖ\x20Found\x20payment:\x20','\x20USDT\x20(after\x20','invoiceTotalSum','updatePaymentStatus','gatewayOrderId','__setModuleDefault','error','Internal\x20server\x20error','\x20->\x20','__importStar','üìù\x20Data:','updateMerchantBalanceForPaidPayment','length','pendingUrl','then','4ohHxTl','onramp','5tNbggU','10YgzdPq','successUrl','payment','1421FooJfy','toUpperCase','Payment\x20not\x20found','getPaymentData','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','amount','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','1168322jBIybz','json','Unknown\x20error','convertToUSDT'];a11_0x4229=function(){return _0x5810e5;};return a11_0x4229();}var __createBinding=this&&this['__createBinding']||(Object[a11_0x2fe0e5(0xa3)]?function(_0x1a2df8,_0x36fd77,_0x5d7e24,_0x4e8d1e){var _0x371e46=a11_0x2fe0e5;if(_0x4e8d1e===undefined)_0x4e8d1e=_0x5d7e24;var _0x37808a=Object['getOwnPropertyDescriptor'](_0x36fd77,_0x5d7e24);(!_0x37808a||(_0x371e46(0xa1)in _0x37808a?!_0x36fd77['__esModule']:_0x37808a['writable']||_0x37808a[_0x371e46(0xb2)]))&&(_0x37808a={'enumerable':!![],'get':function(){return _0x36fd77[_0x5d7e24];}}),Object['defineProperty'](_0x1a2df8,_0x4e8d1e,_0x37808a);}:function(_0x155404,_0x4b22c3,_0x49b3d5,_0x336e83){if(_0x336e83===undefined)_0x336e83=_0x49b3d5;_0x155404[_0x336e83]=_0x4b22c3[_0x49b3d5];}),__setModuleDefault=this&&this[a11_0x2fe0e5(0xcb)]||(Object[a11_0x2fe0e5(0xa3)]?function(_0x3eb88b,_0x505ccd){var _0xccd826=a11_0x2fe0e5;Object[_0xccd826(0xb7)](_0x3eb88b,'default',{'enumerable':!![],'value':_0x505ccd});}:function(_0x35070b,_0x5daa12){_0x35070b['default']=_0x5daa12;}),__importStar=this&&this[a11_0x2fe0e5(0x85)]||(function(){var _0x1566d3=function(_0x4e4721){var _0x4072e6=a11_0x19f7;return _0x1566d3=Object[_0x4072e6(0xbb)]||function(_0xbf8743){var _0x31e4e2=_0x4072e6,_0x1769c3=[];for(var _0x2dd089 in _0xbf8743)if(Object['prototype']['hasOwnProperty'][_0x31e4e2(0xac)](_0xbf8743,_0x2dd089))_0x1769c3[_0x1769c3[_0x31e4e2(0x88)]]=_0x2dd089;return _0x1769c3;},_0x1566d3(_0x4e4721);};return function(_0xda4704){var _0x508922=a11_0x19f7;if(_0xda4704&&_0xda4704[_0x508922(0xa6)])return _0xda4704;var _0x5e7ecf={};if(_0xda4704!=null){for(var _0x2440ef=_0x1566d3(_0xda4704),_0x2ba863=0x0;_0x2ba863<_0x2440ef[_0x508922(0x88)];_0x2ba863++)if(_0x2440ef[_0x2ba863]!=='default')__createBinding(_0x5e7ecf,_0xda4704,_0x2440ef[_0x2ba863]);}return __setModuleDefault(_0x5e7ecf,_0xda4704),_0x5e7ecf;};}()),__importDefault=this&&this[a11_0x2fe0e5(0xa2)]||function(_0x5881f4){var _0x39dfb0=a11_0x2fe0e5;return _0x5881f4&&_0x5881f4[_0x39dfb0(0xa6)]?_0x5881f4:{'default':_0x5881f4};};Object[a11_0x2fe0e5(0xb7)](exports,a11_0x2fe0e5(0xa6),{'value':!![]}),exports['OnRampController']=void 0x0;function a11_0x19f7(_0x5e2ecc,_0x166e1f){_0x5e2ecc=_0x5e2ecc-0x82;var _0x422990=a11_0x4229();var _0x19f7bb=_0x422990[_0x5e2ecc];return _0x19f7bb;}const database_1=__importDefault(require('../config/database'));class OnRampController{async[a11_0x2fe0e5(0xc9)](_0x513d58,_0x90a9f){var _0x4dffe0=a11_0x2fe0e5;try{const {paymentId:_0x7186e,status:_0x3c3e6a,referenceId:_0x20369b,transactionHash:_0x5b4b42,actualCryptoAmount:_0x489297,orderId:_0x85b151}=_0x513d58[_0x4dffe0(0xc1)];if(!_0x7186e||!_0x3c3e6a){_0x90a9f[_0x4dffe0(0xc5)](0x190)['json']({'success':![],'message':'Payment\x20ID\x20and\x20status\x20are\x20required'});return;}console[_0x4dffe0(0xa4)](_0x4dffe0(0xc2)+_0x7186e+_0x4dffe0(0x84)+_0x3c3e6a),console[_0x4dffe0(0xa4)](_0x4dffe0(0x86),{'referenceId':_0x20369b,'transactionHash':_0x5b4b42,'actualCryptoAmount':_0x489297,'orderId':_0x85b151});const _0xabb800=await database_1[_0x4dffe0(0x9d)][_0x4dffe0(0x90)][_0x4dffe0(0xb0)]({'where':{'OR':[{'id':_0x7186e},{'orderId':_0x7186e},{'gatewayOrderId':_0x7186e},{'gatewayPaymentId':_0x7186e}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0xabb800){_0x90a9f[_0x4dffe0(0xc5)](0x194)['json']({'success':![],'message':_0x4dffe0(0x93)});return;}if(_0xabb800[_0x4dffe0(0xbf)]!==_0x4dffe0(0x8c)){_0x90a9f[_0x4dffe0(0xc5)](0x190)[_0x4dffe0(0x99)]({'success':![],'message':_0x4dffe0(0x95)});return;}const _0x2dbc50={'status':_0x3c3e6a[_0x4dffe0(0x92)](),'statusChangedAt':new Date(),'statusChangedBy':'onramp_system'};_0x20369b&&(_0x2dbc50['gatewayOrderId']=_0x20369b);_0x5b4b42&&(_0x2dbc50['gatewayPaymentId']=_0x5b4b42);_0x489297&&(_0x2dbc50[_0x4dffe0(0xc8)]=_0x489297);const _0x5268d6=await database_1['default'][_0x4dffe0(0x90)][_0x4dffe0(0xa8)]({'where':{'id':_0xabb800['id']},'data':_0x2dbc50});console[_0x4dffe0(0xa4)](_0x4dffe0(0x9f)+_0xabb800['id']+_0x4dffe0(0xae)+_0x3c3e6a),_0x3c3e6a['toUpperCase']()===_0x4dffe0(0xb3)&&_0xabb800[_0x4dffe0(0xc5)]!==_0x4dffe0(0xb3)&&await this['updateMerchantBalanceForPaidPayment'](_0xabb800),_0x90a9f[_0x4dffe0(0x99)]({'success':!![],'message':'Payment\x20status\x20updated\x20successfully','data':{'paymentId':_0x5268d6['id'],'status':_0x5268d6[_0x4dffe0(0xc5)],'referenceId':_0x20369b,'transactionHash':_0x5b4b42,'actualCryptoAmount':_0x489297}});}catch(_0x464ca5){console[_0x4dffe0(0x82)](_0x4dffe0(0xb9),_0x464ca5),_0x90a9f[_0x4dffe0(0xc5)](0x1f4)[_0x4dffe0(0x99)]({'success':![],'message':'Internal\x20server\x20error','error':_0x464ca5 instanceof Error?_0x464ca5[_0x4dffe0(0xc0)]:_0x4dffe0(0x9a)});}}async[a11_0x2fe0e5(0x87)](_0x17fe00){var _0x273279=a11_0x2fe0e5;try{console[_0x273279(0xa4)]('üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20'+_0x17fe00['id']);let _0x504784;if(_0x17fe00[_0x273279(0xbc)]===_0x273279(0xbe))_0x504784=_0x17fe00[_0x273279(0x96)];else{const {currencyService:_0x459428}=await Promise['resolve']()[_0x273279(0x8a)](()=>__importStar(require(_0x273279(0xba))));_0x504784=await _0x459428[_0x273279(0x9b)](_0x17fe00['amount'],_0x17fe00[_0x273279(0xbc)]);}await database_1[_0x273279(0x9d)][_0x273279(0x90)][_0x273279(0xa8)]({'where':{'id':_0x17fe00['id']},'data':{'amountUSDT':_0x504784,'paidAt':new Date()}});const _0x4b195b=0xa,_0x2f383f=_0x504784*(0x1-_0x4b195b/0x64);await database_1[_0x273279(0x9d)]['shop']['update']({'where':{'id':_0x17fe00[_0x273279(0xb1)]},'data':{'balance':{'increment':_0x2f383f}}}),console[_0x273279(0xa4)](_0x273279(0xc3)+_0x2f383f[_0x273279(0xb4)](0x6)+_0x273279(0xc7)+_0x4b195b+'%\x20commission)');}catch(_0x46ff80){console[_0x273279(0x82)](_0x273279(0x97),_0x46ff80);}}async[a11_0x2fe0e5(0x94)](_0x508298,_0x4c518c){var _0x502d17=a11_0x2fe0e5;try{const {id:_0x25cc01}=_0x508298[_0x502d17(0xb5)];if(!_0x25cc01){_0x4c518c[_0x502d17(0xc5)](0x190)[_0x502d17(0x99)]({'success':![],'message':'Payment\x20ID\x20is\x20required'});return;}console['log']('üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20'+_0x25cc01);const _0x4ce985=await database_1[_0x502d17(0x9d)][_0x502d17(0x90)][_0x502d17(0xb0)]({'where':{'OR':[{'id':_0x25cc01},{'orderId':_0x25cc01},{'gatewayOrderId':_0x25cc01},{'gatewayPaymentId':_0x25cc01}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x4ce985){_0x4c518c['status'](0x194)[_0x502d17(0x99)]({'success':![],'message':_0x502d17(0x93)});return;}console[_0x502d17(0xa4)](_0x502d17(0xc6)+_0x4ce985['id']+'\x20('+_0x4ce985[_0x502d17(0xc5)]+')'),_0x4c518c[_0x502d17(0x99)]({'success':!![],'data':{'id':_0x4ce985['id'],'gateway':_0x4ce985[_0x502d17(0xbf)],'amount':_0x4ce985[_0x502d17(0x96)],'currency':_0x4ce985['currency'],'status':_0x4ce985[_0x502d17(0xc5)],'gatewayOrderId':_0x4ce985[_0x502d17(0xca)],'gatewayPaymentId':_0x4ce985[_0x502d17(0x9c)],'successUrl':_0x4ce985[_0x502d17(0x8f)],'failUrl':_0x4ce985[_0x502d17(0xa9)],'pendingUrl':_0x4ce985[_0x502d17(0x89)],'customerEmail':_0x4ce985[_0x502d17(0xad)],'customerName':_0x4ce985[_0x502d17(0xaf)],'merchantBrand':_0x4ce985['shop']['name'],'createdAt':_0x4ce985[_0x502d17(0xa7)],'updatedAt':_0x4ce985[_0x502d17(0xb6)]}});}catch(_0x255c39){console[_0x502d17(0x82)](_0x502d17(0xc4),_0x255c39),_0x4c518c[_0x502d17(0xc5)](0x1f4)[_0x502d17(0x99)]({'success':![],'message':_0x502d17(0x83),'error':_0x255c39 instanceof Error?_0x255c39['message']:'Unknown\x20error'});}}}exports['OnRampController']=OnRampController;