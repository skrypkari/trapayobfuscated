'use strict';var a9_0x29eff3=a9_0xcfc4;(function(_0x1f3c30,_0x2fc219){var _0xcdc8b7=a9_0xcfc4,_0x1e7be9=_0x1f3c30();while(!![]){try{var _0xeddf63=parseInt(_0xcdc8b7(0xac))/0x1+-parseInt(_0xcdc8b7(0x92))/0x2*(parseInt(_0xcdc8b7(0x69))/0x3)+parseInt(_0xcdc8b7(0xa2))/0x4+parseInt(_0xcdc8b7(0x80))/0x5+parseInt(_0xcdc8b7(0x6a))/0x6+parseInt(_0xcdc8b7(0xa3))/0x7*(parseInt(_0xcdc8b7(0xa8))/0x8)+-parseInt(_0xcdc8b7(0x74))/0x9*(parseInt(_0xcdc8b7(0xab))/0xa);if(_0xeddf63===_0x2fc219)break;else _0x1e7be9['push'](_0x1e7be9['shift']());}catch(_0x2620a0){_0x1e7be9['push'](_0x1e7be9['shift']());}}}(a9_0x1ec0,0x98812));var __createBinding=this&&this[a9_0x29eff3(0x98)]||(Object[a9_0x29eff3(0x8b)]?function(_0x245fb2,_0x31bd9d,_0x2c6ad9,_0x1a8872){var _0x2747e5=a9_0x29eff3;if(_0x1a8872===undefined)_0x1a8872=_0x2c6ad9;var _0x389de2=Object[_0x2747e5(0x6c)](_0x31bd9d,_0x2c6ad9);(!_0x389de2||(_0x2747e5(0x86)in _0x389de2?!_0x31bd9d[_0x2747e5(0x91)]:_0x389de2['writable']||_0x389de2['configurable']))&&(_0x389de2={'enumerable':!![],'get':function(){return _0x31bd9d[_0x2c6ad9];}}),Object[_0x2747e5(0x7c)](_0x245fb2,_0x1a8872,_0x389de2);}:function(_0x2d7049,_0x322a12,_0x21df0e,_0x20073e){if(_0x20073e===undefined)_0x20073e=_0x21df0e;_0x2d7049[_0x20073e]=_0x322a12[_0x21df0e];}),__setModuleDefault=this&&this[a9_0x29eff3(0x99)]||(Object[a9_0x29eff3(0x8b)]?function(_0x47941b,_0x6a1116){var _0x250f41=a9_0x29eff3;Object['defineProperty'](_0x47941b,_0x250f41(0x90),{'enumerable':!![],'value':_0x6a1116});}:function(_0x5585a4,_0x3d0c69){_0x5585a4['default']=_0x3d0c69;}),__importStar=this&&this[a9_0x29eff3(0x70)]||(function(){var _0x2f0c50=function(_0x3dc3f3){var _0x93c992=a9_0xcfc4;return _0x2f0c50=Object[_0x93c992(0x6b)]||function(_0x25112e){var _0x108ddc=_0x93c992,_0x1d7480=[];for(var _0x48d2ec in _0x25112e)if(Object[_0x108ddc(0x96)][_0x108ddc(0xb1)][_0x108ddc(0x7f)](_0x25112e,_0x48d2ec))_0x1d7480[_0x1d7480[_0x108ddc(0x77)]]=_0x48d2ec;return _0x1d7480;},_0x2f0c50(_0x3dc3f3);};return function(_0x119e83){var _0x3c0848=a9_0xcfc4;if(_0x119e83&&_0x119e83[_0x3c0848(0x91)])return _0x119e83;var _0x498b61={};if(_0x119e83!=null){for(var _0x1f3267=_0x2f0c50(_0x119e83),_0x1be082=0x0;_0x1be082<_0x1f3267[_0x3c0848(0x77)];_0x1be082++)if(_0x1f3267[_0x1be082]!==_0x3c0848(0x90))__createBinding(_0x498b61,_0x119e83,_0x1f3267[_0x1be082]);}return __setModuleDefault(_0x498b61,_0x119e83),_0x498b61;};}()),__importDefault=this&&this[a9_0x29eff3(0x9b)]||function(_0x28df76){var _0x3dfa7a=a9_0x29eff3;return _0x28df76&&_0x28df76[_0x3dfa7a(0x91)]?_0x28df76:{'default':_0x28df76};};function a9_0xcfc4(_0x5256d9,_0x4947eb){var _0x1ec047=a9_0x1ec0();return a9_0xcfc4=function(_0xcfc49,_0x4fd07b){_0xcfc49=_0xcfc49-0x68;var _0x9050fc=_0x1ec047[_0xcfc49];return _0x9050fc;},a9_0xcfc4(_0x5256d9,_0x4947eb);}Object[a9_0x29eff3(0x7c)](exports,a9_0x29eff3(0x91),{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require(a9_0x29eff3(0x73)));class OnRampController{async[a9_0x29eff3(0xae)](_0x4ed318,_0x29c195){var _0x22cde9=a9_0x29eff3;try{const {paymentId:_0x3ff1ad,status:_0x494af5,referenceId:_0x3ecfda,transactionHash:_0x4c6dfb,actualCryptoAmount:_0x11813b,orderId:_0x4f1a06}=_0x4ed318[_0x22cde9(0x7b)];if(!_0x3ff1ad||!_0x494af5){_0x29c195[_0x22cde9(0xaa)](0x190)[_0x22cde9(0xa4)]({'success':![],'message':_0x22cde9(0x75)});return;}console[_0x22cde9(0x76)]('üöÄ\x20OnRamp\x20status\x20update:\x20'+_0x3ff1ad+_0x22cde9(0x7d)+_0x494af5),console[_0x22cde9(0x76)](_0x22cde9(0xb3),{'referenceId':_0x3ecfda,'transactionHash':_0x4c6dfb,'actualCryptoAmount':_0x11813b,'orderId':_0x4f1a06});const _0x30b035=await database_1['default'][_0x22cde9(0xa5)][_0x22cde9(0x8a)]({'where':{'OR':[{'id':_0x3ff1ad},{'orderId':_0x3ff1ad},{'gatewayOrderId':_0x3ff1ad},{'gatewayPaymentId':_0x3ff1ad}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x30b035){_0x29c195[_0x22cde9(0xaa)](0x194)[_0x22cde9(0xa4)]({'success':![],'message':_0x22cde9(0x72)});return;}if(_0x30b035['gateway']!==_0x22cde9(0x8c)){_0x29c195[_0x22cde9(0xaa)](0x190)[_0x22cde9(0xa4)]({'success':![],'message':_0x22cde9(0x83)});return;}const _0x2013e4={'status':_0x494af5[_0x22cde9(0xa1)](),'statusChangedAt':new Date(),'statusChangedBy':_0x22cde9(0x97)};_0x3ecfda&&(_0x2013e4['gatewayOrderId']=_0x3ecfda);_0x4c6dfb&&(_0x2013e4[_0x22cde9(0x68)]=_0x4c6dfb);_0x11813b&&(_0x2013e4[_0x22cde9(0xa7)]=_0x11813b);const _0x25def1=await database_1['default']['payment'][_0x22cde9(0x95)]({'where':{'id':_0x30b035['id']},'data':_0x2013e4});console['log'](_0x22cde9(0x8f)+_0x30b035['id']+_0x22cde9(0x82)+_0x494af5),_0x494af5[_0x22cde9(0xa1)]()===_0x22cde9(0x7e)&&_0x30b035['status']!=='PAID'&&await this[_0x22cde9(0xa9)](_0x30b035),_0x29c195[_0x22cde9(0xa4)]({'success':!![],'message':_0x22cde9(0xaf),'data':{'paymentId':_0x25def1['id'],'status':_0x25def1[_0x22cde9(0xaa)],'referenceId':_0x3ecfda,'transactionHash':_0x4c6dfb,'actualCryptoAmount':_0x11813b}});}catch(_0x143da8){console[_0x22cde9(0x81)]('‚ùå\x20OnRamp\x20status\x20update\x20error:',_0x143da8),_0x29c195[_0x22cde9(0xaa)](0x1f4)[_0x22cde9(0xa4)]({'success':![],'message':_0x22cde9(0x94),'error':_0x143da8 instanceof Error?_0x143da8[_0x22cde9(0x9c)]:'Unknown\x20error'});}}async['updateMerchantBalanceForPaidPayment'](_0x3dc9f0){var _0x5c0623=a9_0x29eff3;try{console[_0x5c0623(0x76)](_0x5c0623(0x9f)+_0x3dc9f0['id']);let _0x58d201;if(_0x3dc9f0[_0x5c0623(0x6d)]===_0x5c0623(0x6e))_0x58d201=_0x3dc9f0[_0x5c0623(0x9e)];else{const {currencyService:_0xe11c96}=await Promise['resolve']()[_0x5c0623(0x85)](()=>__importStar(require(_0x5c0623(0x8d))));_0x58d201=await _0xe11c96[_0x5c0623(0x84)](_0x3dc9f0[_0x5c0623(0x9e)],_0x3dc9f0['currency']);}await database_1[_0x5c0623(0x90)][_0x5c0623(0xa5)][_0x5c0623(0x95)]({'where':{'id':_0x3dc9f0['id']},'data':{'amountUSDT':_0x58d201,'paidAt':new Date()}});const _0xe3d076=0xa,_0x52ae80=_0x58d201*(0x1-_0xe3d076/0x64);await database_1['default'][_0x5c0623(0x71)][_0x5c0623(0x95)]({'where':{'id':_0x3dc9f0[_0x5c0623(0x8e)]},'data':{'balance':{'increment':_0x52ae80}}}),console['log']('‚úÖ\x20Merchant\x20balance\x20updated:\x20+'+_0x52ae80[_0x5c0623(0x79)](0x6)+_0x5c0623(0x88)+_0xe3d076+_0x5c0623(0x9a));}catch(_0x1e4e94){console[_0x5c0623(0x81)](_0x5c0623(0x93),_0x1e4e94);}}async[a9_0x29eff3(0x87)](_0x103525,_0x49c4ac){var _0x2735cd=a9_0x29eff3;try{const {id:_0x390abd}=_0x103525[_0x2735cd(0xa0)];if(!_0x390abd){_0x49c4ac[_0x2735cd(0xaa)](0x190)['json']({'success':![],'message':_0x2735cd(0x78)});return;}console[_0x2735cd(0x76)](_0x2735cd(0x9d)+_0x390abd);const _0x98d81f=await database_1['default'][_0x2735cd(0xa5)][_0x2735cd(0x8a)]({'where':{'OR':[{'id':_0x390abd},{'orderId':_0x390abd},{'gatewayOrderId':_0x390abd},{'gatewayPaymentId':_0x390abd}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x98d81f){_0x49c4ac['status'](0x194)['json']({'success':![],'message':_0x2735cd(0x72)});return;}console['log'](_0x2735cd(0x6f)+_0x98d81f['id']+'\x20('+_0x98d81f[_0x2735cd(0xaa)]+')'),_0x49c4ac[_0x2735cd(0xa4)]({'success':!![],'data':{'id':_0x98d81f['id'],'gateway':_0x98d81f['gateway'],'amount':_0x98d81f[_0x2735cd(0x9e)],'currency':_0x98d81f[_0x2735cd(0x6d)],'status':_0x98d81f['status'],'gatewayOrderId':_0x98d81f['gatewayOrderId'],'gatewayPaymentId':_0x98d81f['gatewayPaymentId'],'successUrl':_0x98d81f[_0x2735cd(0xa6)],'failUrl':_0x98d81f[_0x2735cd(0x89)],'pendingUrl':_0x98d81f[_0x2735cd(0xad)],'customerEmail':_0x98d81f['customerEmail'],'customerName':_0x98d81f[_0x2735cd(0xb2)],'merchantBrand':_0x98d81f[_0x2735cd(0x71)]['name'],'createdAt':_0x98d81f['createdAt'],'updatedAt':_0x98d81f[_0x2735cd(0x7a)]}});}catch(_0x2fd227){console[_0x2735cd(0x81)](_0x2735cd(0xb0),_0x2fd227),_0x49c4ac[_0x2735cd(0xaa)](0x1f4)['json']({'success':![],'message':_0x2735cd(0x94),'error':_0x2fd227 instanceof Error?_0x2fd227[_0x2735cd(0x9c)]:'Unknown\x20error'});}}}function a9_0x1ec0(){var _0x23b17b=['toUpperCase','966156NJOvKf','41062qwTbOi','json','payment','successUrl','invoiceTotalSum','584uEZYaT','updateMerchantBalanceForPaidPayment','status','8143750iqXlCW','32270UjQMLP','pendingUrl','updatePaymentStatus','Payment\x20status\x20updated\x20successfully','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','hasOwnProperty','customerName','üìù\x20Data:','gatewayPaymentId','10887ERawtf','1902360hqTSNx','getOwnPropertyNames','getOwnPropertyDescriptor','currency','USD','‚úÖ\x20Found\x20payment:\x20','__importStar','shop','Payment\x20not\x20found','../config/database','9rpLDyi','Payment\x20ID\x20and\x20status\x20are\x20required','log','length','Payment\x20ID\x20is\x20required','toFixed','updatedAt','body','defineProperty','\x20->\x20','PAID','call','2843675YAqPMs','error','\x20updated\x20to\x20','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','convertToUSDT','then','get','getPaymentData','\x20USDT\x20(after\x20','failUrl','findFirst','create','onramp','../services/currencyService','shopId','‚úÖ\x20OnRamp\x20payment\x20','default','__esModule','82GTlSoT','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','Internal\x20server\x20error','update','prototype','onramp_system','__createBinding','__setModuleDefault','%\x20commission)','__importDefault','message','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','amount','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','params'];a9_0x1ec0=function(){return _0x23b17b;};return a9_0x1ec0();}exports['OnRampController']=OnRampController;