'use strict';var a11_0xa3f706=a11_0x3fe0;(function(_0x108d77,_0x1a6b29){var _0xb0e879=a11_0x3fe0,_0x2ff0fa=_0x108d77();while(!![]){try{var _0x36e840=-parseInt(_0xb0e879(0xc9))/0x1*(parseInt(_0xb0e879(0xb3))/0x2)+-parseInt(_0xb0e879(0x8e))/0x3*(-parseInt(_0xb0e879(0xab))/0x4)+-parseInt(_0xb0e879(0x9b))/0x5*(-parseInt(_0xb0e879(0xa9))/0x6)+parseInt(_0xb0e879(0x99))/0x7*(parseInt(_0xb0e879(0xb6))/0x8)+-parseInt(_0xb0e879(0xa1))/0x9+-parseInt(_0xb0e879(0xdb))/0xa*(parseInt(_0xb0e879(0xc6))/0xb)+parseInt(_0xb0e879(0xdc))/0xc;if(_0x36e840===_0x1a6b29)break;else _0x2ff0fa['push'](_0x2ff0fa['shift']());}catch(_0x380e63){_0x2ff0fa['push'](_0x2ff0fa['shift']());}}}(a11_0x221f,0x8ad34));function a11_0x221f(){var _0x1a6483=['prototype','error','432929iSdUEt','resolve','4472105OxjcVM','update','payment','updatePaymentStatus','shop','failUrl','353754DaPwes','%\x20commission)','default','json','gateway','__createBinding','‚úÖ\x20Found\x20payment:\x20','\x20updated\x20to\x20','6MedMfL','Internal\x20server\x20error','99256UgJeRD','then','‚ùå\x20OnRamp\x20status\x20update\x20error:','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','Payment\x20ID\x20and\x20status\x20are\x20required','Payment\x20not\x20found','‚úÖ\x20OnRamp\x20payment\x20','findFirst','1388JCDhJO','create','pendingUrl','24JkBTCp','üöÄ\x20OnRamp\x20status\x20update:\x20','configurable','gatewayPaymentId','customerName','USD','length','updateMerchantBalanceForPaidPayment','status','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','\x20USDT\x20(after\x20','__importStar','currency','defineProperty','call','1210187BqYwdP','OnRampController','../services/currencyService','85lTdKLt','log','params','invoiceTotalSum','successUrl','__setModuleDefault','get','__esModule','Unknown\x20error','createdAt','getPaymentData','body','toFixed','shopId','customerEmail','\x20->\x20','Payment\x20ID\x20is\x20required','getOwnPropertyNames','70urfGyq','1605060BIJlrQ','message','getOwnPropertyDescriptor','27LzQIKI','gatewayOrderId','Payment\x20status\x20updated\x20successfully','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','toUpperCase','üìù\x20Data:','amount','onramp','__importDefault'];a11_0x221f=function(){return _0x1a6483;};return a11_0x221f();}var __createBinding=this&&this[a11_0xa3f706(0xa6)]||(Object[a11_0xa3f706(0xb4)]?function(_0x4d66da,_0x4eabbe,_0x3d75bf,_0x125042){var _0xd0048a=a11_0xa3f706;if(_0x125042===undefined)_0x125042=_0x3d75bf;var _0x1176da=Object[_0xd0048a(0x8d)](_0x4eabbe,_0x3d75bf);(!_0x1176da||(_0xd0048a(0xcf)in _0x1176da?!_0x4eabbe[_0xd0048a(0xd0)]:_0x1176da['writable']||_0x1176da[_0xd0048a(0xb8)]))&&(_0x1176da={'enumerable':!![],'get':function(){return _0x4eabbe[_0x3d75bf];}}),Object[_0xd0048a(0xc4)](_0x4d66da,_0x125042,_0x1176da);}:function(_0x5274da,_0x22fb3b,_0x4d7725,_0x831f58){if(_0x831f58===undefined)_0x831f58=_0x4d7725;_0x5274da[_0x831f58]=_0x22fb3b[_0x4d7725];}),__setModuleDefault=this&&this[a11_0xa3f706(0xce)]||(Object[a11_0xa3f706(0xb4)]?function(_0x55fd54,_0x28f87a){var _0x1dfdcb=a11_0xa3f706;Object[_0x1dfdcb(0xc4)](_0x55fd54,_0x1dfdcb(0xa3),{'enumerable':!![],'value':_0x28f87a});}:function(_0x2cbbd2,_0x2b2a50){_0x2cbbd2['default']=_0x2b2a50;}),__importStar=this&&this[a11_0xa3f706(0xc2)]||(function(){var _0x227ece=function(_0x14c4d9){var _0x25afb3=a11_0x3fe0;return _0x227ece=Object[_0x25afb3(0xda)]||function(_0x335783){var _0x46d8a6=_0x25afb3,_0x21c3e2=[];for(var _0x1d139e in _0x335783)if(Object[_0x46d8a6(0x97)]['hasOwnProperty'][_0x46d8a6(0xc5)](_0x335783,_0x1d139e))_0x21c3e2[_0x21c3e2[_0x46d8a6(0xbc)]]=_0x1d139e;return _0x21c3e2;},_0x227ece(_0x14c4d9);};return function(_0x1e677d){var _0x55074d=a11_0x3fe0;if(_0x1e677d&&_0x1e677d['__esModule'])return _0x1e677d;var _0xd6aed5={};if(_0x1e677d!=null){for(var _0x4a490a=_0x227ece(_0x1e677d),_0x1cd064=0x0;_0x1cd064<_0x4a490a[_0x55074d(0xbc)];_0x1cd064++)if(_0x4a490a[_0x1cd064]!=='default')__createBinding(_0xd6aed5,_0x1e677d,_0x4a490a[_0x1cd064]);}return __setModuleDefault(_0xd6aed5,_0x1e677d),_0xd6aed5;};}()),__importDefault=this&&this[a11_0xa3f706(0x96)]||function(_0x1a0837){var _0x51cfe3=a11_0xa3f706;return _0x1a0837&&_0x1a0837[_0x51cfe3(0xd0)]?_0x1a0837:{'default':_0x1a0837};};function a11_0x3fe0(_0x450007,_0x113e2f){_0x450007=_0x450007-0x8d;var _0x221f91=a11_0x221f();var _0x3fe007=_0x221f91[_0x450007];return _0x3fe007;}Object['defineProperty'](exports,a11_0xa3f706(0xd0),{'value':!![]}),exports[a11_0xa3f706(0xc7)]=void 0x0;const database_1=__importDefault(require('../config/database'));class OnRampController{async[a11_0xa3f706(0x9e)](_0x5d9c70,_0x3d12d7){var _0x168ca4=a11_0xa3f706;try{const {paymentId:_0x1877df,status:_0x5e5f62,referenceId:_0x8bc608,transactionHash:_0x140b42,actualCryptoAmount:_0x1d6310,orderId:_0x1c7f6a}=_0x5d9c70[_0x168ca4(0xd4)];if(!_0x1877df||!_0x5e5f62){_0x3d12d7[_0x168ca4(0xbe)](0x190)[_0x168ca4(0xa4)]({'success':![],'message':_0x168ca4(0xaf)});return;}console[_0x168ca4(0xca)](_0x168ca4(0xb7)+_0x1877df+_0x168ca4(0xd8)+_0x5e5f62),console[_0x168ca4(0xca)](_0x168ca4(0x93),{'referenceId':_0x8bc608,'transactionHash':_0x140b42,'actualCryptoAmount':_0x1d6310,'orderId':_0x1c7f6a});const _0x5aef2c=await database_1['default']['payment'][_0x168ca4(0xb2)]({'where':{'OR':[{'id':_0x1877df},{'orderId':_0x1877df},{'gatewayOrderId':_0x1877df},{'gatewayPaymentId':_0x1877df}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5aef2c){_0x3d12d7[_0x168ca4(0xbe)](0x194)['json']({'success':![],'message':_0x168ca4(0xb0)});return;}if(_0x5aef2c[_0x168ca4(0xa5)]!==_0x168ca4(0x95)){_0x3d12d7[_0x168ca4(0xbe)](0x190)[_0x168ca4(0xa4)]({'success':![],'message':_0x168ca4(0xbf)});return;}const _0x448c7e={'status':_0x5e5f62[_0x168ca4(0x92)](),'statusChangedAt':new Date(),'statusChangedBy':'onramp_system'};_0x8bc608&&(_0x448c7e[_0x168ca4(0x8f)]=_0x8bc608);_0x140b42&&(_0x448c7e[_0x168ca4(0xb9)]=_0x140b42);_0x1d6310&&(_0x448c7e[_0x168ca4(0xcc)]=_0x1d6310);const _0x273c91=await database_1['default'][_0x168ca4(0x9d)][_0x168ca4(0x9c)]({'where':{'id':_0x5aef2c['id']},'data':_0x448c7e});console[_0x168ca4(0xca)](_0x168ca4(0xb1)+_0x5aef2c['id']+_0x168ca4(0xa8)+_0x5e5f62),_0x5e5f62[_0x168ca4(0x92)]()==='PAID'&&_0x5aef2c[_0x168ca4(0xbe)]!=='PAID'&&await this[_0x168ca4(0xbd)](_0x5aef2c),_0x3d12d7['json']({'success':!![],'message':_0x168ca4(0x90),'data':{'paymentId':_0x273c91['id'],'status':_0x273c91[_0x168ca4(0xbe)],'referenceId':_0x8bc608,'transactionHash':_0x140b42,'actualCryptoAmount':_0x1d6310}});}catch(_0x459449){console[_0x168ca4(0x98)](_0x168ca4(0xad),_0x459449),_0x3d12d7[_0x168ca4(0xbe)](0x1f4)[_0x168ca4(0xa4)]({'success':![],'message':_0x168ca4(0xaa),'error':_0x459449 instanceof Error?_0x459449[_0x168ca4(0xdd)]:_0x168ca4(0xd1)});}}async['updateMerchantBalanceForPaidPayment'](_0x2d1464){var _0x2980c9=a11_0xa3f706;try{console[_0x2980c9(0xca)]('üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20'+_0x2d1464['id']);let _0x1e43b9;if(_0x2d1464[_0x2980c9(0xc3)]===_0x2980c9(0xbb))_0x1e43b9=_0x2d1464[_0x2980c9(0x94)];else{const {currencyService:_0x9290eb}=await Promise[_0x2980c9(0x9a)]()[_0x2980c9(0xac)](()=>__importStar(require(_0x2980c9(0xc8))));_0x1e43b9=await _0x9290eb['convertToUSDT'](_0x2d1464[_0x2980c9(0x94)],_0x2d1464['currency']);}await database_1[_0x2980c9(0xa3)][_0x2980c9(0x9d)][_0x2980c9(0x9c)]({'where':{'id':_0x2d1464['id']},'data':{'amountUSDT':_0x1e43b9,'paidAt':new Date()}});const _0x11f474=0xa,_0x1b4ed=_0x1e43b9*(0x1-_0x11f474/0x64);await database_1[_0x2980c9(0xa3)][_0x2980c9(0x9f)][_0x2980c9(0x9c)]({'where':{'id':_0x2d1464[_0x2980c9(0xd6)]},'data':{'balance':{'increment':_0x1b4ed}}}),console[_0x2980c9(0xca)](_0x2980c9(0xc0)+_0x1b4ed[_0x2980c9(0xd5)](0x6)+_0x2980c9(0xc1)+_0x11f474+_0x2980c9(0xa2));}catch(_0x1617c4){console[_0x2980c9(0x98)](_0x2980c9(0xae),_0x1617c4);}}async[a11_0xa3f706(0xd3)](_0xf7148a,_0x537642){var _0x36c92e=a11_0xa3f706;try{const {id:_0x554dd0}=_0xf7148a[_0x36c92e(0xcb)];if(!_0x554dd0){_0x537642[_0x36c92e(0xbe)](0x190)[_0x36c92e(0xa4)]({'success':![],'message':_0x36c92e(0xd9)});return;}console[_0x36c92e(0xca)](_0x36c92e(0x91)+_0x554dd0);const _0x4e9fcb=await database_1[_0x36c92e(0xa3)][_0x36c92e(0x9d)][_0x36c92e(0xb2)]({'where':{'OR':[{'id':_0x554dd0},{'orderId':_0x554dd0},{'gatewayOrderId':_0x554dd0},{'gatewayPaymentId':_0x554dd0}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x4e9fcb){_0x537642[_0x36c92e(0xbe)](0x194)['json']({'success':![],'message':_0x36c92e(0xb0)});return;}console[_0x36c92e(0xca)](_0x36c92e(0xa7)+_0x4e9fcb['id']+'\x20('+_0x4e9fcb[_0x36c92e(0xbe)]+')'),_0x537642[_0x36c92e(0xa4)]({'success':!![],'data':{'id':_0x4e9fcb['id'],'gateway':_0x4e9fcb[_0x36c92e(0xa5)],'amount':_0x4e9fcb[_0x36c92e(0x94)],'currency':_0x4e9fcb[_0x36c92e(0xc3)],'status':_0x4e9fcb[_0x36c92e(0xbe)],'gatewayOrderId':_0x4e9fcb[_0x36c92e(0x8f)],'gatewayPaymentId':_0x4e9fcb[_0x36c92e(0xb9)],'successUrl':_0x4e9fcb[_0x36c92e(0xcd)],'failUrl':_0x4e9fcb[_0x36c92e(0xa0)],'pendingUrl':_0x4e9fcb[_0x36c92e(0xb5)],'customerEmail':_0x4e9fcb[_0x36c92e(0xd7)],'customerName':_0x4e9fcb[_0x36c92e(0xba)],'merchantBrand':_0x4e9fcb[_0x36c92e(0x9f)]['name'],'createdAt':_0x4e9fcb[_0x36c92e(0xd2)],'updatedAt':_0x4e9fcb['updatedAt']}});}catch(_0x3bd6e3){console[_0x36c92e(0x98)]('‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:',_0x3bd6e3),_0x537642[_0x36c92e(0xbe)](0x1f4)[_0x36c92e(0xa4)]({'success':![],'message':_0x36c92e(0xaa),'error':_0x3bd6e3 instanceof Error?_0x3bd6e3[_0x36c92e(0xdd)]:'Unknown\x20error'});}}}exports[a11_0xa3f706(0xc7)]=OnRampController;