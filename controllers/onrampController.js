'use strict';var a13_0x14db36=a13_0x5ef4;(function(_0x523ad9,_0x440d48){var _0x14391e=a13_0x5ef4,_0x5d163c=_0x523ad9();while(!![]){try{var _0x574c36=parseInt(_0x14391e(0x19f))/0x1*(parseInt(_0x14391e(0x1d5))/0x2)+parseInt(_0x14391e(0x19c))/0x3+-parseInt(_0x14391e(0x1e5))/0x4+-parseInt(_0x14391e(0x1b8))/0x5*(parseInt(_0x14391e(0x1c5))/0x6)+-parseInt(_0x14391e(0x1bb))/0x7+-parseInt(_0x14391e(0x1b1))/0x8+parseInt(_0x14391e(0x1b4))/0x9;if(_0x574c36===_0x440d48)break;else _0x5d163c['push'](_0x5d163c['shift']());}catch(_0x54fd4b){_0x5d163c['push'](_0x5d163c['shift']());}}}(a13_0x5182,0xbcc4a));var __createBinding=this&&this[a13_0x14db36(0x1cb)]||(Object[a13_0x14db36(0x1cf)]?function(_0x360c4c,_0x2a2389,_0x36a42b,_0x3c27fa){var _0x801888=a13_0x14db36;if(_0x3c27fa===undefined)_0x3c27fa=_0x36a42b;var _0x4c0650=Object[_0x801888(0x1be)](_0x2a2389,_0x36a42b);(!_0x4c0650||(_0x801888(0x197)in _0x4c0650?!_0x2a2389[_0x801888(0x1dc)]:_0x4c0650[_0x801888(0x1a8)]||_0x4c0650[_0x801888(0x1cd)]))&&(_0x4c0650={'enumerable':!![],'get':function(){return _0x2a2389[_0x36a42b];}}),Object[_0x801888(0x1df)](_0x360c4c,_0x3c27fa,_0x4c0650);}:function(_0x1c93c0,_0xf189f2,_0x1802d9,_0x17696b){if(_0x17696b===undefined)_0x17696b=_0x1802d9;_0x1c93c0[_0x17696b]=_0xf189f2[_0x1802d9];}),__setModuleDefault=this&&this[a13_0x14db36(0x1a6)]||(Object['create']?function(_0x51784d,_0x4465f7){var _0x3d8b9a=a13_0x14db36;Object[_0x3d8b9a(0x1df)](_0x51784d,_0x3d8b9a(0x19b),{'enumerable':!![],'value':_0x4465f7});}:function(_0xd513e9,_0xa5f264){var _0x255c28=a13_0x14db36;_0xd513e9[_0x255c28(0x19b)]=_0xa5f264;}),__importStar=this&&this[a13_0x14db36(0x1c7)]||(function(){var _0x2b625a=function(_0x30eec6){var _0x3d5818=a13_0x5ef4;return _0x2b625a=Object[_0x3d5818(0x1ba)]||function(_0xf800d2){var _0x58917b=_0x3d5818,_0xe4fb02=[];for(var _0x1f792d in _0xf800d2)if(Object[_0x58917b(0x1c4)]['hasOwnProperty'][_0x58917b(0x1b3)](_0xf800d2,_0x1f792d))_0xe4fb02[_0xe4fb02['length']]=_0x1f792d;return _0xe4fb02;},_0x2b625a(_0x30eec6);};return function(_0x237c55){var _0x5442ed=a13_0x5ef4;if(_0x237c55&&_0x237c55[_0x5442ed(0x1dc)])return _0x237c55;var _0x19ef9b={};if(_0x237c55!=null){for(var _0x44b3b3=_0x2b625a(_0x237c55),_0x535859=0x0;_0x535859<_0x44b3b3[_0x5442ed(0x1e2)];_0x535859++)if(_0x44b3b3[_0x535859]!==_0x5442ed(0x19b))__createBinding(_0x19ef9b,_0x237c55,_0x44b3b3[_0x535859]);}return __setModuleDefault(_0x19ef9b,_0x237c55),_0x19ef9b;};}()),__importDefault=this&&this[a13_0x14db36(0x1bf)]||function(_0x5d8618){var _0x2d922=a13_0x14db36;return _0x5d8618&&_0x5d8618[_0x2d922(0x1dc)]?_0x5d8618:{'default':_0x5d8618};};Object['defineProperty'](exports,a13_0x14db36(0x1dc),{'value':!![]}),exports[a13_0x14db36(0x1b9)]=void 0x0;function a13_0x5182(){var _0xcca233=['3861440jYUlBF','onramp_system','ðŸ“\x20Data:','get','../config/database','shop','../services/currencyService','default','602715OLvTWO','updatePaymentStatus','getPaymentData','9283WWcxdh','message','toUpperCase','failUrl','error','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','json','__setModuleDefault','ðŸš€\x20OnRamp\x20status\x20update:\x20','writable','âŒ\x20OnRamp\x20get\x20payment\x20data\x20error:','updateMerchantBalanceForPaidPayment','Payment\x20ID\x20is\x20required','%\x20commission)','createdAt','USD','âœ…\x20OnRamp\x20payment\x20','âœ…\x20Found\x20payment:\x20','10494584ONaJag','onramp','call','39026070KIblbT','ðŸ”\x20Getting\x20OnRamp\x20payment\x20data:\x20','pendingUrl','Unknown\x20error','3001055UrMZte','OnRampController','getOwnPropertyNames','9259936ZtgGoD','params','invoiceTotalSum','getOwnPropertyDescriptor','__importDefault','âŒ\x20OnRamp\x20status\x20update\x20error:','gatewayOrderId','currency','status','prototype','6WUSgzG','update','__importStar','Internal\x20server\x20error','gatewayPaymentId','\x20updated\x20to\x20','__createBinding','updatedAt','configurable','log','create','payment','amount','successUrl','name','convertToUSDT','94BfINlF','Payment\x20ID\x20and\x20status\x20are\x20required','then','resolve','body','ðŸ’°\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','Payment\x20status\x20updated\x20successfully','__esModule','findFirst','gateway','defineProperty','customerEmail','PAID','length','âŒ\x20Failed\x20to\x20update\x20merchant\x20balance:','Payment\x20not\x20found'];a13_0x5182=function(){return _0xcca233;};return a13_0x5182();}function a13_0x5ef4(_0x156229,_0x2e34f6){_0x156229=_0x156229-0x196;var _0x5182c2=a13_0x5182();var _0x5ef4ba=_0x5182c2[_0x156229];return _0x5ef4ba;}const database_1=__importDefault(require(a13_0x14db36(0x198)));class OnRampController{async[a13_0x14db36(0x19d)](_0xba4ba2,_0x5b0e11){var _0x2e8665=a13_0x14db36;try{const {paymentId:_0x209620,status:_0x38793b,referenceId:_0xcf34e4,transactionHash:_0x58f816,actualCryptoAmount:_0x5d30a2,orderId:_0x1195ca}=_0xba4ba2[_0x2e8665(0x1d9)];if(!_0x209620||!_0x38793b){_0x5b0e11[_0x2e8665(0x1c3)](0x190)['json']({'success':![],'message':_0x2e8665(0x1d6)});return;}console[_0x2e8665(0x1ce)](_0x2e8665(0x1a7)+_0x209620+'\x20->\x20'+_0x38793b),console[_0x2e8665(0x1ce)](_0x2e8665(0x196),{'referenceId':_0xcf34e4,'transactionHash':_0x58f816,'actualCryptoAmount':_0x5d30a2,'orderId':_0x1195ca});const _0x2476af=await database_1['default'][_0x2e8665(0x1d0)][_0x2e8665(0x1dd)]({'where':{'OR':[{'id':_0x209620},{'orderId':_0x209620},{'gatewayOrderId':_0x209620},{'gatewayPaymentId':_0x209620}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2476af){_0x5b0e11[_0x2e8665(0x1c3)](0x194)[_0x2e8665(0x1a5)]({'success':![],'message':'Payment\x20not\x20found'});return;}if(_0x2476af[_0x2e8665(0x1de)]!==_0x2e8665(0x1b2)){_0x5b0e11['status'](0x190)[_0x2e8665(0x1a5)]({'success':![],'message':_0x2e8665(0x1a4)});return;}const _0x251432={'status':_0x38793b[_0x2e8665(0x1a1)](),'statusChangedAt':new Date(),'statusChangedBy':_0x2e8665(0x1e6)};_0xcf34e4&&(_0x251432['gatewayOrderId']=_0xcf34e4);_0x58f816&&(_0x251432[_0x2e8665(0x1c9)]=_0x58f816);_0x5d30a2&&(_0x251432[_0x2e8665(0x1bd)]=_0x5d30a2);const _0x557986=await database_1[_0x2e8665(0x19b)][_0x2e8665(0x1d0)][_0x2e8665(0x1c6)]({'where':{'id':_0x2476af['id']},'data':_0x251432});console['log'](_0x2e8665(0x1af)+_0x2476af['id']+_0x2e8665(0x1ca)+_0x38793b),_0x38793b[_0x2e8665(0x1a1)]()===_0x2e8665(0x1e1)&&_0x2476af[_0x2e8665(0x1c3)]!=='PAID'&&await this['updateMerchantBalanceForPaidPayment'](_0x2476af),_0x5b0e11[_0x2e8665(0x1a5)]({'success':!![],'message':_0x2e8665(0x1db),'data':{'paymentId':_0x557986['id'],'status':_0x557986['status'],'referenceId':_0xcf34e4,'transactionHash':_0x58f816,'actualCryptoAmount':_0x5d30a2}});}catch(_0x15f4a8){console['error'](_0x2e8665(0x1c0),_0x15f4a8),_0x5b0e11[_0x2e8665(0x1c3)](0x1f4)[_0x2e8665(0x1a5)]({'success':![],'message':_0x2e8665(0x1c8),'error':_0x15f4a8 instanceof Error?_0x15f4a8[_0x2e8665(0x1a0)]:_0x2e8665(0x1b7)});}}async[a13_0x14db36(0x1aa)](_0x4ea536){var _0x3f9d9d=a13_0x14db36;try{console[_0x3f9d9d(0x1ce)](_0x3f9d9d(0x1da)+_0x4ea536['id']);let _0x4c6d1a;if(_0x4ea536[_0x3f9d9d(0x1c2)]===_0x3f9d9d(0x1ae))_0x4c6d1a=_0x4ea536[_0x3f9d9d(0x1d1)];else{const {currencyService:_0x694c9f}=await Promise[_0x3f9d9d(0x1d8)]()[_0x3f9d9d(0x1d7)](()=>__importStar(require(_0x3f9d9d(0x19a))));_0x4c6d1a=await _0x694c9f[_0x3f9d9d(0x1d4)](_0x4ea536[_0x3f9d9d(0x1d1)],_0x4ea536['currency']);}await database_1[_0x3f9d9d(0x19b)][_0x3f9d9d(0x1d0)][_0x3f9d9d(0x1c6)]({'where':{'id':_0x4ea536['id']},'data':{'amountUSDT':_0x4c6d1a,'paidAt':new Date()}});const _0x2c72f0=0xa,_0x5bad1e=_0x4c6d1a*(0x1-_0x2c72f0/0x64);await database_1[_0x3f9d9d(0x19b)]['shop'][_0x3f9d9d(0x1c6)]({'where':{'id':_0x4ea536['shopId']},'data':{'balance':{'increment':_0x5bad1e}}}),console[_0x3f9d9d(0x1ce)]('âœ…\x20Merchant\x20balance\x20updated:\x20+'+_0x5bad1e['toFixed'](0x6)+'\x20USDT\x20(after\x20'+_0x2c72f0+_0x3f9d9d(0x1ac));}catch(_0x7c70ee){console[_0x3f9d9d(0x1a3)](_0x3f9d9d(0x1e3),_0x7c70ee);}}async[a13_0x14db36(0x19e)](_0x4a9eba,_0x4a9a9e){var _0x20ddcf=a13_0x14db36;try{const {id:_0x30dc7c}=_0x4a9eba[_0x20ddcf(0x1bc)];if(!_0x30dc7c){_0x4a9a9e[_0x20ddcf(0x1c3)](0x190)[_0x20ddcf(0x1a5)]({'success':![],'message':_0x20ddcf(0x1ab)});return;}console[_0x20ddcf(0x1ce)](_0x20ddcf(0x1b5)+_0x30dc7c);const _0x2a8595=await database_1[_0x20ddcf(0x19b)]['payment']['findFirst']({'where':{'OR':[{'id':_0x30dc7c},{'orderId':_0x30dc7c},{'gatewayOrderId':_0x30dc7c},{'gatewayPaymentId':_0x30dc7c}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x2a8595){_0x4a9a9e[_0x20ddcf(0x1c3)](0x194)[_0x20ddcf(0x1a5)]({'success':![],'message':_0x20ddcf(0x1e4)});return;}console[_0x20ddcf(0x1ce)](_0x20ddcf(0x1b0)+_0x2a8595['id']+'\x20('+_0x2a8595['status']+')'),_0x4a9a9e[_0x20ddcf(0x1a5)]({'success':!![],'data':{'id':_0x2a8595['id'],'gateway':_0x2a8595['gateway'],'amount':_0x2a8595[_0x20ddcf(0x1d1)],'currency':_0x2a8595[_0x20ddcf(0x1c2)],'status':_0x2a8595['status'],'gatewayOrderId':_0x2a8595[_0x20ddcf(0x1c1)],'gatewayPaymentId':_0x2a8595[_0x20ddcf(0x1c9)],'successUrl':_0x2a8595[_0x20ddcf(0x1d2)],'failUrl':_0x2a8595[_0x20ddcf(0x1a2)],'pendingUrl':_0x2a8595[_0x20ddcf(0x1b6)],'customerEmail':_0x2a8595[_0x20ddcf(0x1e0)],'customerName':_0x2a8595['customerName'],'merchantBrand':_0x2a8595[_0x20ddcf(0x199)][_0x20ddcf(0x1d3)],'createdAt':_0x2a8595[_0x20ddcf(0x1ad)],'updatedAt':_0x2a8595[_0x20ddcf(0x1cc)]}});}catch(_0x13e423){console[_0x20ddcf(0x1a3)](_0x20ddcf(0x1a9),_0x13e423),_0x4a9a9e[_0x20ddcf(0x1c3)](0x1f4)[_0x20ddcf(0x1a5)]({'success':![],'message':_0x20ddcf(0x1c8),'error':_0x13e423 instanceof Error?_0x13e423[_0x20ddcf(0x1a0)]:_0x20ddcf(0x1b7)});}}}exports[a13_0x14db36(0x1b9)]=OnRampController;