'use strict';var a9_0x706180=a9_0x2d5d;function a9_0x2d5d(_0x416fa9,_0x10d81f){var _0x48e3cb=a9_0x48e3();return a9_0x2d5d=function(_0x2d5d88,_0x1da354){_0x2d5d88=_0x2d5d88-0x9d;var _0x2818cd=_0x48e3cb[_0x2d5d88];return _0x2818cd;},a9_0x2d5d(_0x416fa9,_0x10d81f);}(function(_0x2c90b4,_0x28bea7){var _0x9a2c8b=a9_0x2d5d,_0x162507=_0x2c90b4();while(!![]){try{var _0x153e12=parseInt(_0x9a2c8b(0xcf))/0x1+parseInt(_0x9a2c8b(0xaa))/0x2+-parseInt(_0x9a2c8b(0xd9))/0x3*(-parseInt(_0x9a2c8b(0xcd))/0x4)+-parseInt(_0x9a2c8b(0xaf))/0x5*(parseInt(_0x9a2c8b(0xe7))/0x6)+-parseInt(_0x9a2c8b(0xbb))/0x7+-parseInt(_0x9a2c8b(0xc5))/0x8*(-parseInt(_0x9a2c8b(0xa6))/0x9)+-parseInt(_0x9a2c8b(0xdf))/0xa;if(_0x153e12===_0x28bea7)break;else _0x162507['push'](_0x162507['shift']());}catch(_0x3bd6cd){_0x162507['push'](_0x162507['shift']());}}}(a9_0x48e3,0x3198a));var __createBinding=this&&this['__createBinding']||(Object[a9_0x706180(0xb9)]?function(_0x1c7985,_0x3bb2a5,_0xa5dfb5,_0x3da950){var _0x262985=a9_0x706180;if(_0x3da950===undefined)_0x3da950=_0xa5dfb5;var _0x5e7621=Object[_0x262985(0xa5)](_0x3bb2a5,_0xa5dfb5);(!_0x5e7621||(_0x262985(0xea)in _0x5e7621?!_0x3bb2a5['__esModule']:_0x5e7621['writable']||_0x5e7621[_0x262985(0xcc)]))&&(_0x5e7621={'enumerable':!![],'get':function(){return _0x3bb2a5[_0xa5dfb5];}}),Object[_0x262985(0xe2)](_0x1c7985,_0x3da950,_0x5e7621);}:function(_0x196fc1,_0x2870b9,_0x326fa6,_0x33610f){if(_0x33610f===undefined)_0x33610f=_0x326fa6;_0x196fc1[_0x33610f]=_0x2870b9[_0x326fa6];}),__setModuleDefault=this&&this[a9_0x706180(0xe4)]||(Object[a9_0x706180(0xb9)]?function(_0x27ae44,_0x9350f5){var _0x21de67=a9_0x706180;Object['defineProperty'](_0x27ae44,_0x21de67(0xb8),{'enumerable':!![],'value':_0x9350f5});}:function(_0x54591c,_0x275bef){var _0x5741ac=a9_0x706180;_0x54591c[_0x5741ac(0xb8)]=_0x275bef;}),__importStar=this&&this[a9_0x706180(0xd5)]||(function(){var _0x2a765b=function(_0x1dd393){var _0x20fead=a9_0x2d5d;return _0x2a765b=Object[_0x20fead(0xd6)]||function(_0x5d344d){var _0x573cad=_0x20fead,_0x26f448=[];for(var _0x42ab5b in _0x5d344d)if(Object[_0x573cad(0xbd)][_0x573cad(0xd2)][_0x573cad(0xe8)](_0x5d344d,_0x42ab5b))_0x26f448[_0x26f448[_0x573cad(0xc0)]]=_0x42ab5b;return _0x26f448;},_0x2a765b(_0x1dd393);};return function(_0x4ff56c){var _0x1a5970=a9_0x2d5d;if(_0x4ff56c&&_0x4ff56c['__esModule'])return _0x4ff56c;var _0x373961={};if(_0x4ff56c!=null){for(var _0x1fb37b=_0x2a765b(_0x4ff56c),_0x333b46=0x0;_0x333b46<_0x1fb37b[_0x1a5970(0xc0)];_0x333b46++)if(_0x1fb37b[_0x333b46]!==_0x1a5970(0xb8))__createBinding(_0x373961,_0x4ff56c,_0x1fb37b[_0x333b46]);}return __setModuleDefault(_0x373961,_0x4ff56c),_0x373961;};}()),__importDefault=this&&this[a9_0x706180(0xc1)]||function(_0x3137e6){var _0x160287=a9_0x706180;return _0x3137e6&&_0x3137e6[_0x160287(0xbe)]?_0x3137e6:{'default':_0x3137e6};};Object[a9_0x706180(0xe2)](exports,a9_0x706180(0xbe),{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require(a9_0x706180(0xdb)));class OnRampController{async[a9_0x706180(0xa1)](_0x50c3ff,_0x4acaf){var _0x437529=a9_0x706180;try{const {paymentId:_0x1ef02f,status:_0x464354,referenceId:_0x430dc0,transactionHash:_0x2ab227,actualCryptoAmount:_0xa5b46d,orderId:_0x481c6c}=_0x50c3ff['body'];if(!_0x1ef02f||!_0x464354){_0x4acaf[_0x437529(0xa7)](0x190)['json']({'success':![],'message':_0x437529(0xa9)});return;}console[_0x437529(0xac)](_0x437529(0xe6)+_0x1ef02f+_0x437529(0xd3)+_0x464354),console[_0x437529(0xac)](_0x437529(0xc6),{'referenceId':_0x430dc0,'transactionHash':_0x2ab227,'actualCryptoAmount':_0xa5b46d,'orderId':_0x481c6c});const _0x1c038f=await database_1['default'][_0x437529(0xb4)]['findFirst']({'where':{'OR':[{'id':_0x1ef02f},{'orderId':_0x1ef02f},{'gatewayOrderId':_0x1ef02f},{'gatewayPaymentId':_0x1ef02f}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x1c038f){_0x4acaf['status'](0x194)[_0x437529(0xc4)]({'success':![],'message':_0x437529(0xa8)});return;}if(_0x1c038f[_0x437529(0xca)]!==_0x437529(0xbc)){_0x4acaf[_0x437529(0xa7)](0x190)['json']({'success':![],'message':_0x437529(0xb1)});return;}const _0x261943={'status':_0x464354[_0x437529(0xba)](),'statusChangedAt':new Date(),'statusChangedBy':'onramp_system'};_0x430dc0&&(_0x261943['gatewayOrderId']=_0x430dc0);_0x2ab227&&(_0x261943[_0x437529(0xa4)]=_0x2ab227);_0xa5b46d&&(_0x261943[_0x437529(0xbf)]=_0xa5b46d);const _0x5a74b6=await database_1['default']['payment'][_0x437529(0xd0)]({'where':{'id':_0x1c038f['id']},'data':_0x261943});console['log'](_0x437529(0xdc)+_0x1c038f['id']+_0x437529(0xab)+_0x464354),_0x464354[_0x437529(0xba)]()===_0x437529(0xda)&&_0x1c038f[_0x437529(0xa7)]!==_0x437529(0xda)&&await this[_0x437529(0x9f)](_0x1c038f),_0x4acaf['json']({'success':!![],'message':_0x437529(0x9d),'data':{'paymentId':_0x5a74b6['id'],'status':_0x5a74b6[_0x437529(0xa7)],'referenceId':_0x430dc0,'transactionHash':_0x2ab227,'actualCryptoAmount':_0xa5b46d}});}catch(_0x454f6b){console[_0x437529(0xd7)]('❌\x20OnRamp\x20status\x20update\x20error:',_0x454f6b),_0x4acaf[_0x437529(0xa7)](0x1f4)[_0x437529(0xc4)]({'success':![],'message':_0x437529(0xdd),'error':_0x454f6b instanceof Error?_0x454f6b['message']:_0x437529(0xe0)});}}async['updateMerchantBalanceForPaidPayment'](_0x36aca0){var _0x5ddbfa=a9_0x706180;try{console[_0x5ddbfa(0xac)](_0x5ddbfa(0xc7)+_0x36aca0['id']);let _0x49f143;if(_0x36aca0[_0x5ddbfa(0xa3)]===_0x5ddbfa(0xd1))_0x49f143=_0x36aca0[_0x5ddbfa(0xb6)];else{const {currencyService:_0x45f8a1}=await Promise[_0x5ddbfa(0xae)]()[_0x5ddbfa(0xe9)](()=>__importStar(require(_0x5ddbfa(0xe1))));_0x49f143=await _0x45f8a1[_0x5ddbfa(0xa2)](_0x36aca0[_0x5ddbfa(0xb6)],_0x36aca0[_0x5ddbfa(0xa3)]);}await database_1['default'][_0x5ddbfa(0xb4)][_0x5ddbfa(0xd0)]({'where':{'id':_0x36aca0['id']},'data':{'amountUSDT':_0x49f143,'paidAt':new Date()}});const _0xbadaf=0xa,_0x4329bd=_0x49f143*(0x1-_0xbadaf/0x64);await database_1[_0x5ddbfa(0xb8)]['shop'][_0x5ddbfa(0xd0)]({'where':{'id':_0x36aca0['shopId']},'data':{'balance':{'increment':_0x4329bd}}}),console[_0x5ddbfa(0xac)]('✅\x20Merchant\x20balance\x20updated:\x20+'+_0x4329bd[_0x5ddbfa(0xc3)](0x6)+_0x5ddbfa(0xd8)+_0xbadaf+_0x5ddbfa(0xde));}catch(_0x5a46b9){console[_0x5ddbfa(0xd7)](_0x5ddbfa(0xb7),_0x5a46b9);}}async[a9_0x706180(0xe3)](_0x2ddadf,_0x273c27){var _0x1c5941=a9_0x706180;try{const {id:_0x47642b}=_0x2ddadf['params'];if(!_0x47642b){_0x273c27[_0x1c5941(0xa7)](0x190)[_0x1c5941(0xc4)]({'success':![],'message':'Payment\x20ID\x20is\x20required'});return;}console[_0x1c5941(0xac)](_0x1c5941(0xcb)+_0x47642b);const _0xe4046c=await database_1[_0x1c5941(0xb8)][_0x1c5941(0xb4)][_0x1c5941(0xc8)]({'where':{'OR':[{'id':_0x47642b},{'orderId':_0x47642b},{'gatewayOrderId':_0x47642b},{'gatewayPaymentId':_0x47642b}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0xe4046c){_0x273c27[_0x1c5941(0xa7)](0x194)[_0x1c5941(0xc4)]({'success':![],'message':_0x1c5941(0xa8)});return;}console[_0x1c5941(0xac)](_0x1c5941(0xb5)+_0xe4046c['id']+'\x20('+_0xe4046c['status']+')'),_0x273c27[_0x1c5941(0xc4)]({'success':!![],'data':{'id':_0xe4046c['id'],'gateway':_0xe4046c['gateway'],'amount':_0xe4046c[_0x1c5941(0xb6)],'currency':_0xe4046c[_0x1c5941(0xa3)],'status':_0xe4046c[_0x1c5941(0xa7)],'gatewayOrderId':_0xe4046c[_0x1c5941(0xad)],'gatewayPaymentId':_0xe4046c[_0x1c5941(0xa4)],'successUrl':_0xe4046c[_0x1c5941(0xc2)],'failUrl':_0xe4046c[_0x1c5941(0xb0)],'pendingUrl':_0xe4046c[_0x1c5941(0xe5)],'customerEmail':_0xe4046c[_0x1c5941(0x9e)],'customerName':_0xe4046c[_0x1c5941(0xc9)],'merchantBrand':_0xe4046c[_0x1c5941(0xb2)][_0x1c5941(0xd4)],'createdAt':_0xe4046c[_0x1c5941(0xb3)],'updatedAt':_0xe4046c['updatedAt']}});}catch(_0x2b2cb6){console[_0x1c5941(0xd7)]('❌\x20OnRamp\x20get\x20payment\x20data\x20error:',_0x2b2cb6),_0x273c27[_0x1c5941(0xa7)](0x1f4)[_0x1c5941(0xc4)]({'success':![],'message':'Internal\x20server\x20error','error':_0x2b2cb6 instanceof Error?_0x2b2cb6[_0x1c5941(0xce)]:_0x1c5941(0xe0)});}}}exports[a9_0x706180(0xa0)]=OnRampController;function a9_0x48e3(){var _0x48c9a1=['shop','createdAt','payment','✅\x20Found\x20payment:\x20','amount','❌\x20Failed\x20to\x20update\x20merchant\x20balance:','default','create','toUpperCase','1230691uUBYqd','onramp','prototype','__esModule','invoiceTotalSum','length','__importDefault','successUrl','toFixed','json','2992184pgohnK','📝\x20Data:','💰\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','findFirst','customerName','gateway','🔍\x20Getting\x20OnRamp\x20payment\x20data:\x20','configurable','1193708ulalzW','message','197010YdJcba','update','USD','hasOwnProperty','\x20->\x20','name','__importStar','getOwnPropertyNames','error','\x20USDT\x20(after\x20','3KVSuEh','PAID','../config/database','✅\x20OnRamp\x20payment\x20','Internal\x20server\x20error','%\x20commission)','6017450CMilCl','Unknown\x20error','../services/currencyService','defineProperty','getPaymentData','__setModuleDefault','pendingUrl','🚀\x20OnRamp\x20status\x20update:\x20','18ToVffV','call','then','get','Payment\x20status\x20updated\x20successfully','customerEmail','updateMerchantBalanceForPaidPayment','OnRampController','updatePaymentStatus','convertToUSDT','currency','gatewayPaymentId','getOwnPropertyDescriptor','9gFGmWr','status','Payment\x20not\x20found','Payment\x20ID\x20and\x20status\x20are\x20required','808736tmIrcQ','\x20updated\x20to\x20','log','gatewayOrderId','resolve','488540InhuKF','failUrl','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway'];a9_0x48e3=function(){return _0x48c9a1;};return a9_0x48e3();}