'use strict';var a13_0x1bba9c=a13_0x1c0f;(function(_0x1cc19f,_0x324538){var _0x463b17=a13_0x1c0f,_0xa5da47=_0x1cc19f();while(!![]){try{var _0x59db61=parseInt(_0x463b17(0x1c5))/0x1*(-parseInt(_0x463b17(0x1b2))/0x2)+parseInt(_0x463b17(0x1bc))/0x3+parseInt(_0x463b17(0x1ae))/0x4+-parseInt(_0x463b17(0x1b3))/0x5*(-parseInt(_0x463b17(0x196))/0x6)+parseInt(_0x463b17(0x1a3))/0x7*(-parseInt(_0x463b17(0x1ab))/0x8)+-parseInt(_0x463b17(0x1ad))/0x9*(parseInt(_0x463b17(0x19f))/0xa)+-parseInt(_0x463b17(0x1ce))/0xb*(-parseInt(_0x463b17(0x1bd))/0xc);if(_0x59db61===_0x324538)break;else _0xa5da47['push'](_0xa5da47['shift']());}catch(_0x21a116){_0xa5da47['push'](_0xa5da47['shift']());}}}(a13_0x3167,0xe69c5));var __createBinding=this&&this[a13_0x1bba9c(0x1c9)]||(Object[a13_0x1bba9c(0x19e)]?function(_0x29e4fd,_0x5a4244,_0xc275d6,_0x2335d9){var _0x5ef3f1=a13_0x1bba9c;if(_0x2335d9===undefined)_0x2335d9=_0xc275d6;var _0x3d2e8d=Object[_0x5ef3f1(0x1bf)](_0x5a4244,_0xc275d6);(!_0x3d2e8d||(_0x5ef3f1(0x197)in _0x3d2e8d?!_0x5a4244[_0x5ef3f1(0x1b5)]:_0x3d2e8d[_0x5ef3f1(0x193)]||_0x3d2e8d['configurable']))&&(_0x3d2e8d={'enumerable':!![],'get':function(){return _0x5a4244[_0xc275d6];}}),Object['defineProperty'](_0x29e4fd,_0x2335d9,_0x3d2e8d);}:function(_0x5e1d5a,_0x7ce565,_0x1c851c,_0x192783){if(_0x192783===undefined)_0x192783=_0x1c851c;_0x5e1d5a[_0x192783]=_0x7ce565[_0x1c851c];}),__setModuleDefault=this&&this[a13_0x1bba9c(0x198)]||(Object[a13_0x1bba9c(0x19e)]?function(_0x453876,_0x516a2d){var _0x4372b3=a13_0x1bba9c;Object[_0x4372b3(0x18d)](_0x453876,_0x4372b3(0x1cf),{'enumerable':!![],'value':_0x516a2d});}:function(_0x2970bb,_0x3bf11a){var _0x3014bc=a13_0x1bba9c;_0x2970bb[_0x3014bc(0x1cf)]=_0x3bf11a;}),__importStar=this&&this[a13_0x1bba9c(0x191)]||(function(){var _0x48533d=function(_0xc4fbea){return _0x48533d=Object['getOwnPropertyNames']||function(_0x2bd46e){var _0x52d45c=a13_0x1c0f,_0x393910=[];for(var _0x37e45f in _0x2bd46e)if(Object['prototype'][_0x52d45c(0x1bb)][_0x52d45c(0x190)](_0x2bd46e,_0x37e45f))_0x393910[_0x393910[_0x52d45c(0x1ba)]]=_0x37e45f;return _0x393910;},_0x48533d(_0xc4fbea);};return function(_0x3b7a6c){var _0x5a9df1=a13_0x1c0f;if(_0x3b7a6c&&_0x3b7a6c[_0x5a9df1(0x1b5)])return _0x3b7a6c;var _0x470182={};if(_0x3b7a6c!=null){for(var _0x4edae6=_0x48533d(_0x3b7a6c),_0x6f3ae2=0x0;_0x6f3ae2<_0x4edae6[_0x5a9df1(0x1ba)];_0x6f3ae2++)if(_0x4edae6[_0x6f3ae2]!==_0x5a9df1(0x1cf))__createBinding(_0x470182,_0x3b7a6c,_0x4edae6[_0x6f3ae2]);}return __setModuleDefault(_0x470182,_0x3b7a6c),_0x470182;};}()),__importDefault=this&&this['__importDefault']||function(_0x590d46){var _0x452974=a13_0x1bba9c;return _0x590d46&&_0x590d46[_0x452974(0x1b5)]?_0x590d46:{'default':_0x590d46};};Object[a13_0x1bba9c(0x18d)](exports,a13_0x1bba9c(0x1b5),{'value':!![]}),exports[a13_0x1bba9c(0x1b4)]=void 0x0;const database_1=__importDefault(require(a13_0x1bba9c(0x1a0)));class OnRampController{async[a13_0x1bba9c(0x186)](_0x15c2c4,_0x591073){var _0x5740e9=a13_0x1bba9c;try{const {paymentId:_0x246dd5,status:_0x5edc2b,referenceId:_0x4d5b42,transactionHash:_0x4df580,actualCryptoAmount:_0x241757,orderId:_0x51cafb}=_0x15c2c4['body'];if(!_0x246dd5||!_0x5edc2b){_0x591073[_0x5740e9(0x1cb)](0x190)[_0x5740e9(0x1c0)]({'success':![],'message':_0x5740e9(0x188)});return;}console['log']('üöÄ\x20OnRamp\x20status\x20update:\x20'+_0x246dd5+_0x5740e9(0x1b1)+_0x5edc2b),console['log'](_0x5740e9(0x1cc),{'referenceId':_0x4d5b42,'transactionHash':_0x4df580,'actualCryptoAmount':_0x241757,'orderId':_0x51cafb});const _0x8f9299=await database_1[_0x5740e9(0x1cf)]['payment'][_0x5740e9(0x1a1)]({'where':{'OR':[{'id':_0x246dd5},{'orderId':_0x246dd5},{'gatewayOrderId':_0x246dd5},{'gatewayPaymentId':_0x246dd5}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x8f9299){_0x591073[_0x5740e9(0x1cb)](0x194)[_0x5740e9(0x1c0)]({'success':![],'message':_0x5740e9(0x194)});return;}if(_0x8f9299[_0x5740e9(0x1c6)]!=='onramp'){_0x591073[_0x5740e9(0x1cb)](0x190)[_0x5740e9(0x1c0)]({'success':![],'message':'This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway'});return;}const _0x5bf6bb={'status':_0x5edc2b[_0x5740e9(0x187)](),'statusChangedAt':new Date(),'statusChangedBy':_0x5740e9(0x195)};_0x4d5b42&&(_0x5bf6bb[_0x5740e9(0x1c7)]=_0x4d5b42);_0x4df580&&(_0x5bf6bb[_0x5740e9(0x18c)]=_0x4df580);_0x241757&&(_0x5bf6bb[_0x5740e9(0x1cd)]=_0x241757);const _0x473443=await database_1[_0x5740e9(0x1cf)][_0x5740e9(0x18a)]['update']({'where':{'id':_0x8f9299['id']},'data':_0x5bf6bb});console['log'](_0x5740e9(0x1c3)+_0x8f9299['id']+_0x5740e9(0x1c4)+_0x5edc2b),_0x5edc2b['toUpperCase']()===_0x5740e9(0x1c8)&&_0x8f9299['status']!==_0x5740e9(0x1c8)&&await this[_0x5740e9(0x192)](_0x8f9299),_0x591073[_0x5740e9(0x1c0)]({'success':!![],'message':'Payment\x20status\x20updated\x20successfully','data':{'paymentId':_0x473443['id'],'status':_0x473443[_0x5740e9(0x1cb)],'referenceId':_0x4d5b42,'transactionHash':_0x4df580,'actualCryptoAmount':_0x241757}});}catch(_0x2b5022){console[_0x5740e9(0x1c1)]('‚ùå\x20OnRamp\x20status\x20update\x20error:',_0x2b5022),_0x591073[_0x5740e9(0x1cb)](0x1f4)[_0x5740e9(0x1c0)]({'success':![],'message':_0x5740e9(0x1aa),'error':_0x2b5022 instanceof Error?_0x2b5022['message']:_0x5740e9(0x19c)});}}async[a13_0x1bba9c(0x192)](_0x306303){var _0x36f8b2=a13_0x1bba9c;try{console['log'](_0x36f8b2(0x1a9)+_0x306303['id']);let _0x52afcf;if(_0x306303['currency']===_0x36f8b2(0x1b8))_0x52afcf=_0x306303['amount'];else{const {currencyService:_0x2a6387}=await Promise[_0x36f8b2(0x1ca)]()[_0x36f8b2(0x1b0)](()=>__importStar(require(_0x36f8b2(0x18f))));_0x52afcf=await _0x2a6387[_0x36f8b2(0x1a2)](_0x306303[_0x36f8b2(0x18b)],_0x306303['currency']);}await database_1[_0x36f8b2(0x1cf)][_0x36f8b2(0x18a)]['update']({'where':{'id':_0x306303['id']},'data':{'amountUSDT':_0x52afcf,'paidAt':new Date()}});const _0x107752=0xa,_0x13b493=_0x52afcf*(0x1-_0x107752/0x64);await database_1[_0x36f8b2(0x1cf)][_0x36f8b2(0x1c2)][_0x36f8b2(0x1a8)]({'where':{'id':_0x306303[_0x36f8b2(0x1a7)]},'data':{'balance':{'increment':_0x13b493}}}),console[_0x36f8b2(0x1a6)](_0x36f8b2(0x1b6)+_0x13b493[_0x36f8b2(0x18e)](0x6)+'\x20USDT\x20(after\x20'+_0x107752+_0x36f8b2(0x19d));}catch(_0x2c9051){console[_0x36f8b2(0x1c1)]('‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:',_0x2c9051);}}async[a13_0x1bba9c(0x1af)](_0x282166,_0x2a8df5){var _0x5c5a8b=a13_0x1bba9c;try{const {id:_0x2f1ef9}=_0x282166[_0x5c5a8b(0x199)];if(!_0x2f1ef9){_0x2a8df5[_0x5c5a8b(0x1cb)](0x190)[_0x5c5a8b(0x1c0)]({'success':![],'message':_0x5c5a8b(0x19b)});return;}console[_0x5c5a8b(0x1a6)](_0x5c5a8b(0x1a5)+_0x2f1ef9);const _0x4cd0c3=await database_1['default'][_0x5c5a8b(0x18a)][_0x5c5a8b(0x1a1)]({'where':{'OR':[{'id':_0x2f1ef9},{'orderId':_0x2f1ef9},{'gatewayOrderId':_0x2f1ef9},{'gatewayPaymentId':_0x2f1ef9}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x4cd0c3){_0x2a8df5[_0x5c5a8b(0x1cb)](0x194)[_0x5c5a8b(0x1c0)]({'success':![],'message':_0x5c5a8b(0x194)});return;}console['log'](_0x5c5a8b(0x19a)+_0x4cd0c3['id']+'\x20('+_0x4cd0c3['status']+')'),_0x2a8df5[_0x5c5a8b(0x1c0)]({'success':!![],'data':{'id':_0x4cd0c3['id'],'gateway':_0x4cd0c3[_0x5c5a8b(0x1c6)],'amount':_0x4cd0c3[_0x5c5a8b(0x18b)],'currency':_0x4cd0c3['currency'],'status':_0x4cd0c3['status'],'gatewayOrderId':_0x4cd0c3['gatewayOrderId'],'gatewayPaymentId':_0x4cd0c3['gatewayPaymentId'],'successUrl':_0x4cd0c3[_0x5c5a8b(0x1be)],'failUrl':_0x4cd0c3['failUrl'],'pendingUrl':_0x4cd0c3[_0x5c5a8b(0x1ac)],'customerEmail':_0x4cd0c3['customerEmail'],'customerName':_0x4cd0c3['customerName'],'merchantBrand':_0x4cd0c3['shop'][_0x5c5a8b(0x1b7)],'createdAt':_0x4cd0c3[_0x5c5a8b(0x1a4)],'updatedAt':_0x4cd0c3['updatedAt']}});}catch(_0x2e4717){console['error'](_0x5c5a8b(0x1b9),_0x2e4717),_0x2a8df5[_0x5c5a8b(0x1cb)](0x1f4)[_0x5c5a8b(0x1c0)]({'success':![],'message':_0x5c5a8b(0x1aa),'error':_0x2e4717 instanceof Error?_0x2e4717[_0x5c5a8b(0x189)]:_0x5c5a8b(0x19c)});}}}function a13_0x3167(){var _0xbfe3b5=['defineProperty','toFixed','../services/currencyService','call','__importStar','updateMerchantBalanceForPaidPayment','writable','Payment\x20not\x20found','onramp_system','1194QAmnML','get','__setModuleDefault','params','‚úÖ\x20Found\x20payment:\x20','Payment\x20ID\x20is\x20required','Unknown\x20error','%\x20commission)','create','10SgsfpJ','../config/database','findFirst','convertToUSDT','326543ntUVRV','createdAt','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','log','shopId','update','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','Internal\x20server\x20error','232VgahiB','pendingUrl','1394415NPboKR','5142384BuKXjL','getPaymentData','then','\x20->\x20','2dMculI','8630bnNhAD','OnRampController','__esModule','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','name','USD','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','length','hasOwnProperty','3138414BBBXEQ','1202268zKnqtt','successUrl','getOwnPropertyDescriptor','json','error','shop','‚úÖ\x20OnRamp\x20payment\x20','\x20updated\x20to\x20','924194kvcJJR','gateway','gatewayOrderId','PAID','__createBinding','resolve','status','üìù\x20Data:','invoiceTotalSum','77BPlcgO','default','updatePaymentStatus','toUpperCase','Payment\x20ID\x20and\x20status\x20are\x20required','message','payment','amount','gatewayPaymentId'];a13_0x3167=function(){return _0xbfe3b5;};return a13_0x3167();}function a13_0x1c0f(_0x290def,_0x566ca5){_0x290def=_0x290def-0x186;var _0x3167e5=a13_0x3167();var _0x1c0ff5=_0x3167e5[_0x290def];return _0x1c0ff5;}exports['OnRampController']=OnRampController;