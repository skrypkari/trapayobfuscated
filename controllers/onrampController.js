'use strict';var a13_0x3da579=a13_0x6c39;(function(_0x289ded,_0x15c0be){var _0x51edf8=a13_0x6c39,_0x25434b=_0x289ded();while(!![]){try{var _0x47a8d2=-parseInt(_0x51edf8(0x113))/0x1*(parseInt(_0x51edf8(0x127))/0x2)+-parseInt(_0x51edf8(0x14a))/0x3*(-parseInt(_0x51edf8(0x109))/0x4)+parseInt(_0x51edf8(0x121))/0x5+-parseInt(_0x51edf8(0x142))/0x6+parseInt(_0x51edf8(0x136))/0x7+-parseInt(_0x51edf8(0x123))/0x8+parseInt(_0x51edf8(0x115))/0x9;if(_0x47a8d2===_0x15c0be)break;else _0x25434b['push'](_0x25434b['shift']());}catch(_0x495757){_0x25434b['push'](_0x25434b['shift']());}}}(a13_0x1927,0x37e48));var __createBinding=this&&this[a13_0x3da579(0x147)]||(Object[a13_0x3da579(0x149)]?function(_0x3b6ba4,_0x4b0ea8,_0x3d02a4,_0xfd74bd){var _0x164842=a13_0x3da579;if(_0xfd74bd===undefined)_0xfd74bd=_0x3d02a4;var _0x270b63=Object[_0x164842(0x135)](_0x4b0ea8,_0x3d02a4);(!_0x270b63||(_0x164842(0x13a)in _0x270b63?!_0x4b0ea8[_0x164842(0x12e)]:_0x270b63[_0x164842(0x138)]||_0x270b63['configurable']))&&(_0x270b63={'enumerable':!![],'get':function(){return _0x4b0ea8[_0x3d02a4];}}),Object[_0x164842(0x13d)](_0x3b6ba4,_0xfd74bd,_0x270b63);}:function(_0xbb3a4d,_0x24d896,_0x6e4962,_0x12560e){if(_0x12560e===undefined)_0x12560e=_0x6e4962;_0xbb3a4d[_0x12560e]=_0x24d896[_0x6e4962];}),__setModuleDefault=this&&this[a13_0x3da579(0x134)]||(Object['create']?function(_0x3bb31,_0x4e772c){var _0x48513a=a13_0x3da579;Object[_0x48513a(0x13d)](_0x3bb31,_0x48513a(0x131),{'enumerable':!![],'value':_0x4e772c});}:function(_0x4dc6f2,_0x485769){_0x4dc6f2['default']=_0x485769;}),__importStar=this&&this[a13_0x3da579(0x122)]||(function(){var _0x401e99=function(_0x33bd2f){return _0x401e99=Object['getOwnPropertyNames']||function(_0x4a1d47){var _0x293b40=a13_0x6c39,_0x68a736=[];for(var _0x3e56c0 in _0x4a1d47)if(Object[_0x293b40(0x12a)]['hasOwnProperty'][_0x293b40(0x112)](_0x4a1d47,_0x3e56c0))_0x68a736[_0x68a736[_0x293b40(0x11a)]]=_0x3e56c0;return _0x68a736;},_0x401e99(_0x33bd2f);};return function(_0xb1ec9c){var _0x5ad33b=a13_0x6c39;if(_0xb1ec9c&&_0xb1ec9c[_0x5ad33b(0x12e)])return _0xb1ec9c;var _0x76bf7a={};if(_0xb1ec9c!=null){for(var _0x5f3d11=_0x401e99(_0xb1ec9c),_0x349535=0x0;_0x349535<_0x5f3d11[_0x5ad33b(0x11a)];_0x349535++)if(_0x5f3d11[_0x349535]!==_0x5ad33b(0x131))__createBinding(_0x76bf7a,_0xb1ec9c,_0x5f3d11[_0x349535]);}return __setModuleDefault(_0x76bf7a,_0xb1ec9c),_0x76bf7a;};}()),__importDefault=this&&this[a13_0x3da579(0x108)]||function(_0x3ae647){var _0x264297=a13_0x3da579;return _0x3ae647&&_0x3ae647[_0x264297(0x12e)]?_0x3ae647:{'default':_0x3ae647};};Object['defineProperty'](exports,a13_0x3da579(0x12e),{'value':!![]}),exports[a13_0x3da579(0x111)]=void 0x0;const database_1=__importDefault(require(a13_0x3da579(0x119)));class OnRampController{async['updatePaymentStatus'](_0x5f0e6d,_0x230339){var _0x1f9375=a13_0x3da579;try{const {paymentId:_0x121c1d,status:_0x3adeac,referenceId:_0x3cb631,transactionHash:_0x4452bd,actualCryptoAmount:_0x1a00cd,orderId:_0x320010}=_0x5f0e6d[_0x1f9375(0x10d)];if(!_0x121c1d||!_0x3adeac){_0x230339[_0x1f9375(0x148)](0x190)[_0x1f9375(0x129)]({'success':![],'message':_0x1f9375(0x13e)});return;}console[_0x1f9375(0x10c)](_0x1f9375(0x116)+_0x121c1d+_0x1f9375(0x114)+_0x3adeac),console['log'](_0x1f9375(0x11b),{'referenceId':_0x3cb631,'transactionHash':_0x4452bd,'actualCryptoAmount':_0x1a00cd,'orderId':_0x320010});const _0x3bfda6=await database_1[_0x1f9375(0x131)][_0x1f9375(0x110)]['findFirst']({'where':{'OR':[{'id':_0x121c1d},{'orderId':_0x121c1d},{'gatewayOrderId':_0x121c1d},{'gatewayPaymentId':_0x121c1d}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3bfda6){_0x230339[_0x1f9375(0x148)](0x194)[_0x1f9375(0x129)]({'success':![],'message':_0x1f9375(0x126)});return;}if(_0x3bfda6[_0x1f9375(0x139)]!=='onramp'){_0x230339[_0x1f9375(0x148)](0x190)['json']({'success':![],'message':_0x1f9375(0x137)});return;}const _0x1ebae6={'status':_0x3adeac['toUpperCase'](),'statusChangedAt':new Date(),'statusChangedBy':_0x1f9375(0x120)};_0x3cb631&&(_0x1ebae6[_0x1f9375(0x150)]=_0x3cb631);_0x4452bd&&(_0x1ebae6[_0x1f9375(0x13c)]=_0x4452bd);_0x1a00cd&&(_0x1ebae6[_0x1f9375(0x14e)]=_0x1a00cd);const _0x1c481a=await database_1['default'][_0x1f9375(0x110)][_0x1f9375(0x130)]({'where':{'id':_0x3bfda6['id']},'data':_0x1ebae6});console['log'](_0x1f9375(0x11c)+_0x3bfda6['id']+_0x1f9375(0x12f)+_0x3adeac),_0x3adeac[_0x1f9375(0x11d)]()==='PAID'&&_0x3bfda6[_0x1f9375(0x148)]!==_0x1f9375(0x10f)&&await this['updateMerchantBalanceForPaidPayment'](_0x3bfda6),_0x230339['json']({'success':!![],'message':_0x1f9375(0x141),'data':{'paymentId':_0x1c481a['id'],'status':_0x1c481a[_0x1f9375(0x148)],'referenceId':_0x3cb631,'transactionHash':_0x4452bd,'actualCryptoAmount':_0x1a00cd}});}catch(_0x3de618){console[_0x1f9375(0x10b)](_0x1f9375(0x132),_0x3de618),_0x230339['status'](0x1f4)['json']({'success':![],'message':_0x1f9375(0x143),'error':_0x3de618 instanceof Error?_0x3de618['message']:_0x1f9375(0x145)});}}async[a13_0x3da579(0x12d)](_0x2d91f5){var _0x4518ad=a13_0x3da579;try{console[_0x4518ad(0x10c)](_0x4518ad(0x144)+_0x2d91f5['id']);let _0x35954e;if(_0x2d91f5[_0x4518ad(0x124)]==='USD')_0x35954e=_0x2d91f5[_0x4518ad(0x10a)];else{const {currencyService:_0x4a691b}=await Promise[_0x4518ad(0x11f)]()[_0x4518ad(0x13f)](()=>__importStar(require(_0x4518ad(0x125))));_0x35954e=await _0x4a691b[_0x4518ad(0x14c)](_0x2d91f5['amount'],_0x2d91f5[_0x4518ad(0x124)]);}await database_1[_0x4518ad(0x131)][_0x4518ad(0x110)][_0x4518ad(0x130)]({'where':{'id':_0x2d91f5['id']},'data':{'amountUSDT':_0x35954e,'paidAt':new Date()}});const _0x23a2ca=0xa,_0x550d4e=_0x35954e*(0x1-_0x23a2ca/0x64);await database_1[_0x4518ad(0x131)]['shop'][_0x4518ad(0x130)]({'where':{'id':_0x2d91f5[_0x4518ad(0x128)]},'data':{'balance':{'increment':_0x550d4e}}}),console[_0x4518ad(0x10c)](_0x4518ad(0x152)+_0x550d4e[_0x4518ad(0x10e)](0x6)+'\x20USDT\x20(after\x20'+_0x23a2ca+'%\x20commission)');}catch(_0x28bcff){console[_0x4518ad(0x10b)](_0x4518ad(0x118),_0x28bcff);}}async[a13_0x3da579(0x13b)](_0x2843fe,_0x3946a2){var _0x50d6c9=a13_0x3da579;try{const {id:_0x48825b}=_0x2843fe[_0x50d6c9(0x146)];if(!_0x48825b){_0x3946a2[_0x50d6c9(0x148)](0x190)['json']({'success':![],'message':'Payment\x20ID\x20is\x20required'});return;}console[_0x50d6c9(0x10c)](_0x50d6c9(0x14b)+_0x48825b);const _0x30e4ee=await database_1[_0x50d6c9(0x131)][_0x50d6c9(0x110)][_0x50d6c9(0x14d)]({'where':{'OR':[{'id':_0x48825b},{'orderId':_0x48825b},{'gatewayOrderId':_0x48825b},{'gatewayPaymentId':_0x48825b}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x30e4ee){_0x3946a2[_0x50d6c9(0x148)](0x194)['json']({'success':![],'message':_0x50d6c9(0x126)});return;}console[_0x50d6c9(0x10c)]('‚úÖ\x20Found\x20payment:\x20'+_0x30e4ee['id']+'\x20('+_0x30e4ee[_0x50d6c9(0x148)]+')'),_0x3946a2[_0x50d6c9(0x129)]({'success':!![],'data':{'id':_0x30e4ee['id'],'gateway':_0x30e4ee[_0x50d6c9(0x139)],'amount':_0x30e4ee[_0x50d6c9(0x10a)],'currency':_0x30e4ee['currency'],'status':_0x30e4ee['status'],'gatewayOrderId':_0x30e4ee['gatewayOrderId'],'gatewayPaymentId':_0x30e4ee[_0x50d6c9(0x13c)],'successUrl':_0x30e4ee['successUrl'],'failUrl':_0x30e4ee[_0x50d6c9(0x140)],'pendingUrl':_0x30e4ee[_0x50d6c9(0x153)],'customerEmail':_0x30e4ee['customerEmail'],'customerName':_0x30e4ee[_0x50d6c9(0x14f)],'merchantBrand':_0x30e4ee[_0x50d6c9(0x117)][_0x50d6c9(0x12b)],'createdAt':_0x30e4ee[_0x50d6c9(0x151)],'updatedAt':_0x30e4ee[_0x50d6c9(0x11e)]}});}catch(_0x37d778){console['error'](_0x50d6c9(0x12c),_0x37d778),_0x3946a2[_0x50d6c9(0x148)](0x1f4)[_0x50d6c9(0x129)]({'success':![],'message':_0x50d6c9(0x143),'error':_0x37d778 instanceof Error?_0x37d778[_0x50d6c9(0x133)]:_0x50d6c9(0x145)});}}}function a13_0x6c39(_0x587338,_0x41f612){_0x587338=_0x587338-0x108;var _0x192788=a13_0x1927();var _0x6c39df=_0x192788[_0x587338];return _0x6c39df;}function a13_0x1927(){var _0xd27da1=['__setModuleDefault','getOwnPropertyDescriptor','650300sLRgdh','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','writable','gateway','get','getPaymentData','gatewayPaymentId','defineProperty','Payment\x20ID\x20and\x20status\x20are\x20required','then','failUrl','Payment\x20status\x20updated\x20successfully','1320900vCTvDh','Internal\x20server\x20error','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','Unknown\x20error','params','__createBinding','status','create','599046mYSaqt','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','convertToUSDT','findFirst','invoiceTotalSum','customerName','gatewayOrderId','createdAt','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','pendingUrl','__importDefault','4wqqLxw','amount','error','log','body','toFixed','PAID','payment','OnRampController','call','3xSpCCe','\x20->\x20','2278125iFKdOb','üöÄ\x20OnRamp\x20status\x20update:\x20','shop','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','../config/database','length','üìù\x20Data:','‚úÖ\x20OnRamp\x20payment\x20','toUpperCase','updatedAt','resolve','onramp_system','979135oTmqIz','__importStar','1707928odyNgW','currency','../services/currencyService','Payment\x20not\x20found','52638gXbBnb','shopId','json','prototype','name','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','updateMerchantBalanceForPaidPayment','__esModule','\x20updated\x20to\x20','update','default','‚ùå\x20OnRamp\x20status\x20update\x20error:','message'];a13_0x1927=function(){return _0xd27da1;};return a13_0x1927();}exports[a13_0x3da579(0x111)]=OnRampController;