'use strict';var a11_0x571a76=a11_0x46ce;function a11_0x46ce(_0x3375e1,_0x5b88a2){_0x3375e1=_0x3375e1-0xb6;var _0x4df622=a11_0x4df6();var _0x46ce73=_0x4df622[_0x3375e1];return _0x46ce73;}(function(_0x5a2770,_0x3c580f){var _0x465a45=a11_0x46ce,_0x163351=_0x5a2770();while(!![]){try{var _0x3a912a=-parseInt(_0x465a45(0xbe))/0x1*(parseInt(_0x465a45(0xd1))/0x2)+-parseInt(_0x465a45(0xee))/0x3*(-parseInt(_0x465a45(0xbc))/0x4)+parseInt(_0x465a45(0xcd))/0x5+parseInt(_0x465a45(0xdf))/0x6*(parseInt(_0x465a45(0xc1))/0x7)+parseInt(_0x465a45(0xdb))/0x8+parseInt(_0x465a45(0xcf))/0x9*(-parseInt(_0x465a45(0xe0))/0xa)+parseInt(_0x465a45(0x103))/0xb*(-parseInt(_0x465a45(0xc3))/0xc);if(_0x3a912a===_0x3c580f)break;else _0x163351['push'](_0x163351['shift']());}catch(_0x21c626){_0x163351['push'](_0x163351['shift']());}}}(a11_0x4df6,0x26b64));var __createBinding=this&&this[a11_0x571a76(0xf6)]||(Object[a11_0x571a76(0xd0)]?function(_0xe99ee7,_0x328ecf,_0x5f98cd,_0x5ecb64){var _0x44df65=a11_0x571a76;if(_0x5ecb64===undefined)_0x5ecb64=_0x5f98cd;var _0x4b2aad=Object[_0x44df65(0xb6)](_0x328ecf,_0x5f98cd);(!_0x4b2aad||('get'in _0x4b2aad?!_0x328ecf[_0x44df65(0xfb)]:_0x4b2aad[_0x44df65(0xc6)]||_0x4b2aad[_0x44df65(0xcb)]))&&(_0x4b2aad={'enumerable':!![],'get':function(){return _0x328ecf[_0x5f98cd];}}),Object[_0x44df65(0xba)](_0xe99ee7,_0x5ecb64,_0x4b2aad);}:function(_0x4c319c,_0x156a88,_0x3e7d19,_0x3fef6f){if(_0x3fef6f===undefined)_0x3fef6f=_0x3e7d19;_0x4c319c[_0x3fef6f]=_0x156a88[_0x3e7d19];}),__setModuleDefault=this&&this[a11_0x571a76(0xf4)]||(Object[a11_0x571a76(0xd0)]?function(_0x4add87,_0x1e98eb){var _0x3630ed=a11_0x571a76;Object[_0x3630ed(0xba)](_0x4add87,_0x3630ed(0xed),{'enumerable':!![],'value':_0x1e98eb});}:function(_0x448395,_0x510a8b){_0x448395['default']=_0x510a8b;}),__importStar=this&&this[a11_0x571a76(0xe6)]||(function(){var _0x1c26c3=function(_0x2510f0){var _0x593d09=a11_0x46ce;return _0x1c26c3=Object[_0x593d09(0xe2)]||function(_0x4c3e0d){var _0x26decb=_0x593d09,_0x990009=[];for(var _0xc7a8f0 in _0x4c3e0d)if(Object[_0x26decb(0xda)][_0x26decb(0x100)]['call'](_0x4c3e0d,_0xc7a8f0))_0x990009[_0x990009[_0x26decb(0xbb)]]=_0xc7a8f0;return _0x990009;},_0x1c26c3(_0x2510f0);};return function(_0x5d5005){var _0x57322d=a11_0x46ce;if(_0x5d5005&&_0x5d5005[_0x57322d(0xfb)])return _0x5d5005;var _0x2dfd39={};if(_0x5d5005!=null){for(var _0xc978f4=_0x1c26c3(_0x5d5005),_0x18ce2d=0x0;_0x18ce2d<_0xc978f4[_0x57322d(0xbb)];_0x18ce2d++)if(_0xc978f4[_0x18ce2d]!==_0x57322d(0xed))__createBinding(_0x2dfd39,_0x5d5005,_0xc978f4[_0x18ce2d]);}return __setModuleDefault(_0x2dfd39,_0x5d5005),_0x2dfd39;};}()),__importDefault=this&&this[a11_0x571a76(0xf2)]||function(_0x454550){return _0x454550&&_0x454550['__esModule']?_0x454550:{'default':_0x454550};};function a11_0x4df6(){var _0x239921=['invoiceTotalSum','writable','OnRampController','gatewayPaymentId','update','ðŸ”\x20Getting\x20OnRamp\x20payment\x20data:\x20','configurable','âœ…\x20OnRamp\x20payment\x20','647905iLjQqf','Payment\x20ID\x20is\x20required','27aRHNHf','create','94006cJFhxA','log','message','createdAt','failUrl','\x20USDT\x20(after\x20','params','then','error','prototype','1610392IGaUBL','updateMerchantBalanceForPaidPayment','Payment\x20not\x20found','onramp','34806zWvjwQ','532910DXTdTK','âœ…\x20Found\x20payment:\x20','getOwnPropertyNames','getPaymentData','shop','amount','__importStar','customerName','gatewayOrderId','Internal\x20server\x20error','toFixed','\x20updated\x20to\x20','ðŸ’°\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','default','457953JXYPlQ','toUpperCase','%\x20commission)','status','__importDefault','ðŸ“\x20Data:','__setModuleDefault','findFirst','__createBinding','json','âŒ\x20Failed\x20to\x20update\x20merchant\x20balance:','Unknown\x20error','âœ…\x20Merchant\x20balance\x20updated:\x20+','__esModule','USD','../services/currencyService','currency','resolve','hasOwnProperty','\x20->\x20','Payment\x20ID\x20and\x20status\x20are\x20required','68893ddlstl','âŒ\x20OnRamp\x20get\x20payment\x20data\x20error:','getOwnPropertyDescriptor','PAID','../config/database','onramp_system','defineProperty','length','4yLdKlR','updatePaymentStatus','5vINpXB','payment','gateway','364naAyLu','Payment\x20status\x20updated\x20successfully','444dPvhoO','shopId'];a11_0x4df6=function(){return _0x239921;};return a11_0x4df6();}Object[a11_0x571a76(0xba)](exports,a11_0x571a76(0xfb),{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require(a11_0x571a76(0xb8)));class OnRampController{async[a11_0x571a76(0xbd)](_0x5e63fa,_0x20d83b){var _0x17f47c=a11_0x571a76;try{const {paymentId:_0x226266,status:_0x11b34d,referenceId:_0x44e0b7,transactionHash:_0x318eae,actualCryptoAmount:_0x3cc6ff,orderId:_0x5b22c0}=_0x5e63fa['body'];if(!_0x226266||!_0x11b34d){_0x20d83b[_0x17f47c(0xf1)](0x190)[_0x17f47c(0xf7)]({'success':![],'message':_0x17f47c(0x102)});return;}console[_0x17f47c(0xd2)]('ðŸš€\x20OnRamp\x20status\x20update:\x20'+_0x226266+_0x17f47c(0x101)+_0x11b34d),console[_0x17f47c(0xd2)](_0x17f47c(0xf3),{'referenceId':_0x44e0b7,'transactionHash':_0x318eae,'actualCryptoAmount':_0x3cc6ff,'orderId':_0x5b22c0});const _0x107fc6=await database_1[_0x17f47c(0xed)][_0x17f47c(0xbf)][_0x17f47c(0xf5)]({'where':{'OR':[{'id':_0x226266},{'orderId':_0x226266},{'gatewayOrderId':_0x226266},{'gatewayPaymentId':_0x226266}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x107fc6){_0x20d83b[_0x17f47c(0xf1)](0x194)[_0x17f47c(0xf7)]({'success':![],'message':_0x17f47c(0xdd)});return;}if(_0x107fc6[_0x17f47c(0xc0)]!==_0x17f47c(0xde)){_0x20d83b['status'](0x190)['json']({'success':![],'message':'This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway'});return;}const _0x3b5d87={'status':_0x11b34d[_0x17f47c(0xef)](),'statusChangedAt':new Date(),'statusChangedBy':_0x17f47c(0xb9)};_0x44e0b7&&(_0x3b5d87['gatewayOrderId']=_0x44e0b7);_0x318eae&&(_0x3b5d87['gatewayPaymentId']=_0x318eae);_0x3cc6ff&&(_0x3b5d87[_0x17f47c(0xc5)]=_0x3cc6ff);const _0x49730e=await database_1[_0x17f47c(0xed)][_0x17f47c(0xbf)]['update']({'where':{'id':_0x107fc6['id']},'data':_0x3b5d87});console['log'](_0x17f47c(0xcc)+_0x107fc6['id']+_0x17f47c(0xeb)+_0x11b34d),_0x11b34d['toUpperCase']()==='PAID'&&_0x107fc6[_0x17f47c(0xf1)]!==_0x17f47c(0xb7)&&await this[_0x17f47c(0xdc)](_0x107fc6),_0x20d83b[_0x17f47c(0xf7)]({'success':!![],'message':_0x17f47c(0xc2),'data':{'paymentId':_0x49730e['id'],'status':_0x49730e[_0x17f47c(0xf1)],'referenceId':_0x44e0b7,'transactionHash':_0x318eae,'actualCryptoAmount':_0x3cc6ff}});}catch(_0x362997){console[_0x17f47c(0xd9)]('âŒ\x20OnRamp\x20status\x20update\x20error:',_0x362997),_0x20d83b['status'](0x1f4)['json']({'success':![],'message':'Internal\x20server\x20error','error':_0x362997 instanceof Error?_0x362997[_0x17f47c(0xd3)]:_0x17f47c(0xf9)});}}async[a11_0x571a76(0xdc)](_0x5de96c){var _0x5b3e80=a11_0x571a76;try{console[_0x5b3e80(0xd2)](_0x5b3e80(0xec)+_0x5de96c['id']);let _0x1c7019;if(_0x5de96c['currency']===_0x5b3e80(0xfc))_0x1c7019=_0x5de96c['amount'];else{const {currencyService:_0x9bbac5}=await Promise[_0x5b3e80(0xff)]()[_0x5b3e80(0xd8)](()=>__importStar(require(_0x5b3e80(0xfd))));_0x1c7019=await _0x9bbac5['convertToUSDT'](_0x5de96c[_0x5b3e80(0xe5)],_0x5de96c[_0x5b3e80(0xfe)]);}await database_1[_0x5b3e80(0xed)]['payment'][_0x5b3e80(0xc9)]({'where':{'id':_0x5de96c['id']},'data':{'amountUSDT':_0x1c7019,'paidAt':new Date()}});const _0x1cec18=0xa,_0x481a22=_0x1c7019*(0x1-_0x1cec18/0x64);await database_1[_0x5b3e80(0xed)][_0x5b3e80(0xe4)][_0x5b3e80(0xc9)]({'where':{'id':_0x5de96c[_0x5b3e80(0xc4)]},'data':{'balance':{'increment':_0x481a22}}}),console['log'](_0x5b3e80(0xfa)+_0x481a22[_0x5b3e80(0xea)](0x6)+_0x5b3e80(0xd6)+_0x1cec18+_0x5b3e80(0xf0));}catch(_0x4bf26c){console[_0x5b3e80(0xd9)](_0x5b3e80(0xf8),_0x4bf26c);}}async[a11_0x571a76(0xe3)](_0x1b736e,_0x1d740e){var _0x4c0226=a11_0x571a76;try{const {id:_0x174bfa}=_0x1b736e[_0x4c0226(0xd7)];if(!_0x174bfa){_0x1d740e[_0x4c0226(0xf1)](0x190)[_0x4c0226(0xf7)]({'success':![],'message':_0x4c0226(0xce)});return;}console[_0x4c0226(0xd2)](_0x4c0226(0xca)+_0x174bfa);const _0x45af8c=await database_1[_0x4c0226(0xed)][_0x4c0226(0xbf)]['findFirst']({'where':{'OR':[{'id':_0x174bfa},{'orderId':_0x174bfa},{'gatewayOrderId':_0x174bfa},{'gatewayPaymentId':_0x174bfa}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x45af8c){_0x1d740e[_0x4c0226(0xf1)](0x194)['json']({'success':![],'message':'Payment\x20not\x20found'});return;}console[_0x4c0226(0xd2)](_0x4c0226(0xe1)+_0x45af8c['id']+'\x20('+_0x45af8c[_0x4c0226(0xf1)]+')'),_0x1d740e[_0x4c0226(0xf7)]({'success':!![],'data':{'id':_0x45af8c['id'],'gateway':_0x45af8c[_0x4c0226(0xc0)],'amount':_0x45af8c[_0x4c0226(0xe5)],'currency':_0x45af8c[_0x4c0226(0xfe)],'status':_0x45af8c[_0x4c0226(0xf1)],'gatewayOrderId':_0x45af8c[_0x4c0226(0xe8)],'gatewayPaymentId':_0x45af8c[_0x4c0226(0xc8)],'successUrl':_0x45af8c['successUrl'],'failUrl':_0x45af8c[_0x4c0226(0xd5)],'pendingUrl':_0x45af8c['pendingUrl'],'customerEmail':_0x45af8c['customerEmail'],'customerName':_0x45af8c[_0x4c0226(0xe7)],'merchantBrand':_0x45af8c[_0x4c0226(0xe4)]['name'],'createdAt':_0x45af8c[_0x4c0226(0xd4)],'updatedAt':_0x45af8c['updatedAt']}});}catch(_0x59fb7d){console['error'](_0x4c0226(0x104),_0x59fb7d),_0x1d740e[_0x4c0226(0xf1)](0x1f4)[_0x4c0226(0xf7)]({'success':![],'message':_0x4c0226(0xe9),'error':_0x59fb7d instanceof Error?_0x59fb7d[_0x4c0226(0xd3)]:_0x4c0226(0xf9)});}}}exports[a11_0x571a76(0xc7)]=OnRampController;