'use strict';function a12_0x424d(){var _0x1a81ff=['call','Internal\x20server\x20error','850100aGVAGX','default','\x20->\x20','__setModuleDefault','getOwnPropertyDescriptor','\x20updated\x20to\x20','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','PAID','then','writable','defineProperty','currency','status','message','create','prototype','findFirst','Payment\x20status\x20updated\x20successfully','getPaymentData','amount','customerEmail','__esModule','\x20USDT\x20(after\x20','Unknown\x20error','üöÄ\x20OnRamp\x20status\x20update:\x20','error','updatePaymentStatus','onramp','756hOPjCi','update','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','payment','shopId','configurable','2774530tuOWmU','body','../services/currencyService','‚ùå\x20OnRamp\x20status\x20update\x20error:','onramp_system','gatewayOrderId','get','successUrl','Payment\x20ID\x20is\x20required','USD','3009796DprokC','updateMerchantBalanceForPaidPayment','12pIJJpO','‚úÖ\x20Found\x20payment:\x20','gatewayPaymentId','getOwnPropertyNames','%\x20commission)','length','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','‚úÖ\x20OnRamp\x20payment\x20','5061112iJBEug','6529026opAJym','createdAt','591ZEYMaC','__createBinding','updatedAt','gateway','toUpperCase','json','üìù\x20Data:','17289882FYkDXO','log','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20'];a12_0x424d=function(){return _0x1a81ff;};return a12_0x424d();}var a12_0x5854f6=a12_0x3879;(function(_0xb1929e,_0x34be92){var _0x27c3f4=a12_0x3879,_0x49fc40=_0xb1929e();while(!![]){try{var _0x24a9cb=parseInt(_0x27c3f4(0x18c))/0x1+parseInt(_0x27c3f4(0x1a8))/0x2*(parseInt(_0x27c3f4(0x180))/0x3)+parseInt(_0x27c3f4(0x173))/0x4+-parseInt(_0x27c3f4(0x1b0))/0x5*(-parseInt(_0x27c3f4(0x175))/0x6)+-parseInt(_0x27c3f4(0x17e))/0x7+parseInt(_0x27c3f4(0x17d))/0x8+-parseInt(_0x27c3f4(0x187))/0x9;if(_0x24a9cb===_0x34be92)break;else _0x49fc40['push'](_0x49fc40['shift']());}catch(_0x3cc7f4){_0x49fc40['push'](_0x49fc40['shift']());}}}(a12_0x424d,0x8a192));function a12_0x3879(_0x94c8a0,_0x40380b){_0x94c8a0=_0x94c8a0-0x171;var _0x424d52=a12_0x424d();var _0x387971=_0x424d52[_0x94c8a0];return _0x387971;}var __createBinding=this&&this[a12_0x5854f6(0x181)]||(Object[a12_0x5854f6(0x19a)]?function(_0x404edb,_0x14cf25,_0x4770a0,_0xcbdb9d){var _0x262fe8=a12_0x5854f6;if(_0xcbdb9d===undefined)_0xcbdb9d=_0x4770a0;var _0x1c6813=Object[_0x262fe8(0x190)](_0x14cf25,_0x4770a0);(!_0x1c6813||(_0x262fe8(0x1b6)in _0x1c6813?!_0x14cf25['__esModule']:_0x1c6813[_0x262fe8(0x195)]||_0x1c6813[_0x262fe8(0x1af)]))&&(_0x1c6813={'enumerable':!![],'get':function(){return _0x14cf25[_0x4770a0];}}),Object[_0x262fe8(0x196)](_0x404edb,_0xcbdb9d,_0x1c6813);}:function(_0x591d7c,_0x2f8b6b,_0x49fe08,_0x2b91cc){if(_0x2b91cc===undefined)_0x2b91cc=_0x49fe08;_0x591d7c[_0x2b91cc]=_0x2f8b6b[_0x49fe08];}),__setModuleDefault=this&&this[a12_0x5854f6(0x18f)]||(Object['create']?function(_0x4fd43c,_0x23183c){var _0x48629b=a12_0x5854f6;Object[_0x48629b(0x196)](_0x4fd43c,_0x48629b(0x18d),{'enumerable':!![],'value':_0x23183c});}:function(_0x22be0c,_0xbf6347){var _0x1d6172=a12_0x5854f6;_0x22be0c[_0x1d6172(0x18d)]=_0xbf6347;}),__importStar=this&&this['__importStar']||(function(){var _0x45b0b5=function(_0xb029ac){var _0x1ed9da=a12_0x3879;return _0x45b0b5=Object[_0x1ed9da(0x178)]||function(_0x44e37b){var _0x2ffa29=_0x1ed9da,_0x5343e9=[];for(var _0x499451 in _0x44e37b)if(Object[_0x2ffa29(0x19b)]['hasOwnProperty'][_0x2ffa29(0x18a)](_0x44e37b,_0x499451))_0x5343e9[_0x5343e9[_0x2ffa29(0x17a)]]=_0x499451;return _0x5343e9;},_0x45b0b5(_0xb029ac);};return function(_0x1a542d){var _0x3633e4=a12_0x3879;if(_0x1a542d&&_0x1a542d[_0x3633e4(0x1a1)])return _0x1a542d;var _0x124ef1={};if(_0x1a542d!=null){for(var _0x47e052=_0x45b0b5(_0x1a542d),_0x2bbfd0=0x0;_0x2bbfd0<_0x47e052[_0x3633e4(0x17a)];_0x2bbfd0++)if(_0x47e052[_0x2bbfd0]!==_0x3633e4(0x18d))__createBinding(_0x124ef1,_0x1a542d,_0x47e052[_0x2bbfd0]);}return __setModuleDefault(_0x124ef1,_0x1a542d),_0x124ef1;};}()),__importDefault=this&&this['__importDefault']||function(_0x2236c2){var _0x4e2923=a12_0x5854f6;return _0x2236c2&&_0x2236c2[_0x4e2923(0x1a1)]?_0x2236c2:{'default':_0x2236c2};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require('../config/database'));class OnRampController{async[a12_0x5854f6(0x1a6)](_0x1aba08,_0x59ff3a){var _0x307bc7=a12_0x5854f6;try{const {paymentId:_0x593e91,status:_0x309e19,referenceId:_0xf23459,transactionHash:_0x5483eb,actualCryptoAmount:_0xc02cc4,orderId:_0x5e145c}=_0x1aba08[_0x307bc7(0x1b1)];if(!_0x593e91||!_0x309e19){_0x59ff3a[_0x307bc7(0x198)](0x190)['json']({'success':![],'message':'Payment\x20ID\x20and\x20status\x20are\x20required'});return;}console[_0x307bc7(0x188)](_0x307bc7(0x1a4)+_0x593e91+_0x307bc7(0x18e)+_0x309e19),console['log'](_0x307bc7(0x186),{'referenceId':_0xf23459,'transactionHash':_0x5483eb,'actualCryptoAmount':_0xc02cc4,'orderId':_0x5e145c});const _0x2e5737=await database_1['default'][_0x307bc7(0x1ad)][_0x307bc7(0x19c)]({'where':{'OR':[{'id':_0x593e91},{'orderId':_0x593e91},{'gatewayOrderId':_0x593e91},{'gatewayPaymentId':_0x593e91}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2e5737){_0x59ff3a['status'](0x194)[_0x307bc7(0x185)]({'success':![],'message':'Payment\x20not\x20found'});return;}if(_0x2e5737[_0x307bc7(0x183)]!==_0x307bc7(0x1a7)){_0x59ff3a[_0x307bc7(0x198)](0x190)[_0x307bc7(0x185)]({'success':![],'message':_0x307bc7(0x1ab)});return;}const _0x1f14ed={'status':_0x309e19[_0x307bc7(0x184)](),'statusChangedAt':new Date(),'statusChangedBy':_0x307bc7(0x1b4)};_0xf23459&&(_0x1f14ed[_0x307bc7(0x1b5)]=_0xf23459);_0x5483eb&&(_0x1f14ed['gatewayPaymentId']=_0x5483eb);_0xc02cc4&&(_0x1f14ed['invoiceTotalSum']=_0xc02cc4);const _0x3510b7=await database_1[_0x307bc7(0x18d)][_0x307bc7(0x1ad)]['update']({'where':{'id':_0x2e5737['id']},'data':_0x1f14ed});console['log'](_0x307bc7(0x17c)+_0x2e5737['id']+_0x307bc7(0x191)+_0x309e19),_0x309e19[_0x307bc7(0x184)]()===_0x307bc7(0x193)&&_0x2e5737[_0x307bc7(0x198)]!==_0x307bc7(0x193)&&await this[_0x307bc7(0x174)](_0x2e5737),_0x59ff3a['json']({'success':!![],'message':_0x307bc7(0x19d),'data':{'paymentId':_0x3510b7['id'],'status':_0x3510b7[_0x307bc7(0x198)],'referenceId':_0xf23459,'transactionHash':_0x5483eb,'actualCryptoAmount':_0xc02cc4}});}catch(_0x4dc316){console[_0x307bc7(0x1a5)](_0x307bc7(0x1b3),_0x4dc316),_0x59ff3a[_0x307bc7(0x198)](0x1f4)[_0x307bc7(0x185)]({'success':![],'message':_0x307bc7(0x18b),'error':_0x4dc316 instanceof Error?_0x4dc316[_0x307bc7(0x199)]:_0x307bc7(0x1a3)});}}async[a12_0x5854f6(0x174)](_0x6a44bf){var _0xb4cbf2=a12_0x5854f6;try{console[_0xb4cbf2(0x188)](_0xb4cbf2(0x1aa)+_0x6a44bf['id']);let _0x50c456;if(_0x6a44bf[_0xb4cbf2(0x197)]===_0xb4cbf2(0x172))_0x50c456=_0x6a44bf[_0xb4cbf2(0x19f)];else{const {currencyService:_0x54401b}=await Promise['resolve']()[_0xb4cbf2(0x194)](()=>__importStar(require(_0xb4cbf2(0x1b2))));_0x50c456=await _0x54401b['convertToUSDT'](_0x6a44bf[_0xb4cbf2(0x19f)],_0x6a44bf[_0xb4cbf2(0x197)]);}await database_1[_0xb4cbf2(0x18d)]['payment'][_0xb4cbf2(0x1a9)]({'where':{'id':_0x6a44bf['id']},'data':{'amountUSDT':_0x50c456,'paidAt':new Date()}});const _0x342ebd=0xa,_0x57bbad=_0x50c456*(0x1-_0x342ebd/0x64);await database_1[_0xb4cbf2(0x18d)]['shop'][_0xb4cbf2(0x1a9)]({'where':{'id':_0x6a44bf[_0xb4cbf2(0x1ae)]},'data':{'balance':{'increment':_0x57bbad}}}),console[_0xb4cbf2(0x188)](_0xb4cbf2(0x17b)+_0x57bbad['toFixed'](0x6)+_0xb4cbf2(0x1a2)+_0x342ebd+_0xb4cbf2(0x179));}catch(_0x40d4c4){console[_0xb4cbf2(0x1a5)](_0xb4cbf2(0x1ac),_0x40d4c4);}}async[a12_0x5854f6(0x19e)](_0x351938,_0x311936){var _0x4fe1d0=a12_0x5854f6;try{const {id:_0x184646}=_0x351938['params'];if(!_0x184646){_0x311936[_0x4fe1d0(0x198)](0x190)['json']({'success':![],'message':_0x4fe1d0(0x171)});return;}console[_0x4fe1d0(0x188)](_0x4fe1d0(0x189)+_0x184646);const _0x5d59f6=await database_1[_0x4fe1d0(0x18d)][_0x4fe1d0(0x1ad)]['findFirst']({'where':{'OR':[{'id':_0x184646},{'orderId':_0x184646},{'gatewayOrderId':_0x184646},{'gatewayPaymentId':_0x184646}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x5d59f6){_0x311936[_0x4fe1d0(0x198)](0x194)['json']({'success':![],'message':'Payment\x20not\x20found'});return;}console['log'](_0x4fe1d0(0x176)+_0x5d59f6['id']+'\x20('+_0x5d59f6['status']+')'),_0x311936['json']({'success':!![],'data':{'id':_0x5d59f6['id'],'gateway':_0x5d59f6[_0x4fe1d0(0x183)],'amount':_0x5d59f6['amount'],'currency':_0x5d59f6[_0x4fe1d0(0x197)],'status':_0x5d59f6[_0x4fe1d0(0x198)],'gatewayOrderId':_0x5d59f6[_0x4fe1d0(0x1b5)],'gatewayPaymentId':_0x5d59f6[_0x4fe1d0(0x177)],'successUrl':_0x5d59f6[_0x4fe1d0(0x1b7)],'failUrl':_0x5d59f6['failUrl'],'pendingUrl':_0x5d59f6['pendingUrl'],'customerEmail':_0x5d59f6[_0x4fe1d0(0x1a0)],'customerName':_0x5d59f6['customerName'],'merchantBrand':_0x5d59f6['shop']['name'],'createdAt':_0x5d59f6[_0x4fe1d0(0x17f)],'updatedAt':_0x5d59f6[_0x4fe1d0(0x182)]}});}catch(_0x9acc7e){console['error'](_0x4fe1d0(0x192),_0x9acc7e),_0x311936[_0x4fe1d0(0x198)](0x1f4)[_0x4fe1d0(0x185)]({'success':![],'message':_0x4fe1d0(0x18b),'error':_0x9acc7e instanceof Error?_0x9acc7e[_0x4fe1d0(0x199)]:_0x4fe1d0(0x1a3)});}}}exports['OnRampController']=OnRampController;