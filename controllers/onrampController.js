'use strict';var a13_0x58ed8f=a13_0x47cf;(function(_0xa3768c,_0x56bc99){var _0x5548a0=a13_0x47cf,_0x16e171=_0xa3768c();while(!![]){try{var _0x32771e=parseInt(_0x5548a0(0x14f))/0x1+parseInt(_0x5548a0(0x14e))/0x2+parseInt(_0x5548a0(0x139))/0x3*(-parseInt(_0x5548a0(0x137))/0x4)+-parseInt(_0x5548a0(0x14d))/0x5*(-parseInt(_0x5548a0(0x13e))/0x6)+parseInt(_0x5548a0(0x140))/0x7+-parseInt(_0x5548a0(0x129))/0x8+-parseInt(_0x5548a0(0x114))/0x9;if(_0x32771e===_0x56bc99)break;else _0x16e171['push'](_0x16e171['shift']());}catch(_0x2f2576){_0x16e171['push'](_0x16e171['shift']());}}}(a13_0x3bd6,0x2d80f));function a13_0x47cf(_0x261e90,_0x4f7547){_0x261e90=_0x261e90-0x110;var _0x3bd6fd=a13_0x3bd6();var _0x47cf65=_0x3bd6fd[_0x261e90];return _0x47cf65;}var __createBinding=this&&this[a13_0x58ed8f(0x138)]||(Object[a13_0x58ed8f(0x11a)]?function(_0xdf393f,_0x1583fc,_0x4e6bd0,_0xf3c7a2){var _0x3993e7=a13_0x58ed8f;if(_0xf3c7a2===undefined)_0xf3c7a2=_0x4e6bd0;var _0x472f5e=Object['getOwnPropertyDescriptor'](_0x1583fc,_0x4e6bd0);(!_0x472f5e||(_0x3993e7(0x113)in _0x472f5e?!_0x1583fc['__esModule']:_0x472f5e[_0x3993e7(0x156)]||_0x472f5e[_0x3993e7(0x119)]))&&(_0x472f5e={'enumerable':!![],'get':function(){return _0x1583fc[_0x4e6bd0];}}),Object[_0x3993e7(0x159)](_0xdf393f,_0xf3c7a2,_0x472f5e);}:function(_0x491dd2,_0x1df918,_0x4e257c,_0x5d2137){if(_0x5d2137===undefined)_0x5d2137=_0x4e257c;_0x491dd2[_0x5d2137]=_0x1df918[_0x4e257c];}),__setModuleDefault=this&&this[a13_0x58ed8f(0x126)]||(Object[a13_0x58ed8f(0x11a)]?function(_0x24e2a1,_0x204279){var _0x163bb0=a13_0x58ed8f;Object['defineProperty'](_0x24e2a1,_0x163bb0(0x110),{'enumerable':!![],'value':_0x204279});}:function(_0x431dba,_0x15194d){var _0x3a7989=a13_0x58ed8f;_0x431dba[_0x3a7989(0x110)]=_0x15194d;}),__importStar=this&&this['__importStar']||(function(){var _0x221e65=function(_0xa342b9){var _0x249ba4=a13_0x47cf;return _0x221e65=Object[_0x249ba4(0x151)]||function(_0x42b409){var _0x2efc40=_0x249ba4,_0x422423=[];for(var _0x479b01 in _0x42b409)if(Object[_0x2efc40(0x157)][_0x2efc40(0x158)][_0x2efc40(0x115)](_0x42b409,_0x479b01))_0x422423[_0x422423['length']]=_0x479b01;return _0x422423;},_0x221e65(_0xa342b9);};return function(_0x3da81b){var _0x2877f8=a13_0x47cf;if(_0x3da81b&&_0x3da81b[_0x2877f8(0x124)])return _0x3da81b;var _0x1a09b9={};if(_0x3da81b!=null){for(var _0x36ab50=_0x221e65(_0x3da81b),_0x1a721f=0x0;_0x1a721f<_0x36ab50[_0x2877f8(0x143)];_0x1a721f++)if(_0x36ab50[_0x1a721f]!==_0x2877f8(0x110))__createBinding(_0x1a09b9,_0x3da81b,_0x36ab50[_0x1a721f]);}return __setModuleDefault(_0x1a09b9,_0x3da81b),_0x1a09b9;};}()),__importDefault=this&&this[a13_0x58ed8f(0x11e)]||function(_0x5bc347){var _0x4148da=a13_0x58ed8f;return _0x5bc347&&_0x5bc347[_0x4148da(0x124)]?_0x5bc347:{'default':_0x5bc347};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a13_0x58ed8f(0x13d)]=void 0x0;const database_1=__importDefault(require('../config/database'));class OnRampController{async['updatePaymentStatus'](_0x5e648d,_0x4a3478){var _0x25dd2c=a13_0x58ed8f;try{const {paymentId:_0x2ac01d,status:_0x7c5b1d,referenceId:_0xc2031,transactionHash:_0x134f19,actualCryptoAmount:_0x33aa12,orderId:_0x1d252a}=_0x5e648d[_0x25dd2c(0x142)];if(!_0x2ac01d||!_0x7c5b1d){_0x4a3478['status'](0x190)[_0x25dd2c(0x12f)]({'success':![],'message':_0x25dd2c(0x122)});return;}console[_0x25dd2c(0x12d)]('ðŸš€\x20OnRamp\x20status\x20update:\x20'+_0x2ac01d+_0x25dd2c(0x112)+_0x7c5b1d),console['log'](_0x25dd2c(0x12b),{'referenceId':_0xc2031,'transactionHash':_0x134f19,'actualCryptoAmount':_0x33aa12,'orderId':_0x1d252a});const _0x460721=await database_1['default'][_0x25dd2c(0x149)][_0x25dd2c(0x12e)]({'where':{'OR':[{'id':_0x2ac01d},{'orderId':_0x2ac01d},{'gatewayOrderId':_0x2ac01d},{'gatewayPaymentId':_0x2ac01d}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x460721){_0x4a3478[_0x25dd2c(0x111)](0x194)['json']({'success':![],'message':_0x25dd2c(0x136)});return;}if(_0x460721[_0x25dd2c(0x153)]!=='onramp'){_0x4a3478[_0x25dd2c(0x111)](0x190)['json']({'success':![],'message':_0x25dd2c(0x150)});return;}const _0x48968b={'status':_0x7c5b1d['toUpperCase'](),'statusChangedAt':new Date(),'statusChangedBy':'onramp_system'};_0xc2031&&(_0x48968b[_0x25dd2c(0x128)]=_0xc2031);_0x134f19&&(_0x48968b['gatewayPaymentId']=_0x134f19);_0x33aa12&&(_0x48968b[_0x25dd2c(0x127)]=_0x33aa12);const _0x39e738=await database_1[_0x25dd2c(0x110)]['payment']['update']({'where':{'id':_0x460721['id']},'data':_0x48968b});console[_0x25dd2c(0x12d)](_0x25dd2c(0x11f)+_0x460721['id']+_0x25dd2c(0x155)+_0x7c5b1d),_0x7c5b1d[_0x25dd2c(0x13b)]()===_0x25dd2c(0x134)&&_0x460721[_0x25dd2c(0x111)]!=='PAID'&&await this[_0x25dd2c(0x12c)](_0x460721),_0x4a3478[_0x25dd2c(0x12f)]({'success':!![],'message':_0x25dd2c(0x132),'data':{'paymentId':_0x39e738['id'],'status':_0x39e738[_0x25dd2c(0x111)],'referenceId':_0xc2031,'transactionHash':_0x134f19,'actualCryptoAmount':_0x33aa12}});}catch(_0x9670ef){console[_0x25dd2c(0x152)]('âŒ\x20OnRamp\x20status\x20update\x20error:',_0x9670ef),_0x4a3478[_0x25dd2c(0x111)](0x1f4)[_0x25dd2c(0x12f)]({'success':![],'message':'Internal\x20server\x20error','error':_0x9670ef instanceof Error?_0x9670ef[_0x25dd2c(0x141)]:_0x25dd2c(0x117)});}}async[a13_0x58ed8f(0x12c)](_0x3120bb){var _0x91b9f4=a13_0x58ed8f;try{console[_0x91b9f4(0x12d)](_0x91b9f4(0x135)+_0x3120bb['id']);let _0x3e8722;if(_0x3120bb[_0x91b9f4(0x120)]==='USD')_0x3e8722=_0x3120bb[_0x91b9f4(0x148)];else{const {currencyService:_0x2dfca4}=await Promise[_0x91b9f4(0x133)]()[_0x91b9f4(0x144)](()=>__importStar(require('../services/currencyService')));_0x3e8722=await _0x2dfca4[_0x91b9f4(0x123)](_0x3120bb[_0x91b9f4(0x148)],_0x3120bb[_0x91b9f4(0x120)]);}await database_1[_0x91b9f4(0x110)][_0x91b9f4(0x149)]['update']({'where':{'id':_0x3120bb['id']},'data':{'amountUSDT':_0x3e8722,'paidAt':new Date()}});const _0x4bf55c=0xa,_0x1d8e24=_0x3e8722*(0x1-_0x4bf55c/0x64);await database_1[_0x91b9f4(0x110)][_0x91b9f4(0x11c)][_0x91b9f4(0x154)]({'where':{'id':_0x3120bb[_0x91b9f4(0x14a)]},'data':{'balance':{'increment':_0x1d8e24}}}),console[_0x91b9f4(0x12d)](_0x91b9f4(0x130)+_0x1d8e24[_0x91b9f4(0x11d)](0x6)+_0x91b9f4(0x13f)+_0x4bf55c+_0x91b9f4(0x14c));}catch(_0x128f78){console['error'](_0x91b9f4(0x14b),_0x128f78);}}async[a13_0x58ed8f(0x13c)](_0x517d01,_0x77642b){var _0x388c64=a13_0x58ed8f;try{const {id:_0x25fdaf}=_0x517d01[_0x388c64(0x12a)];if(!_0x25fdaf){_0x77642b[_0x388c64(0x111)](0x190)[_0x388c64(0x12f)]({'success':![],'message':_0x388c64(0x118)});return;}console['log']('ðŸ”\x20Getting\x20OnRamp\x20payment\x20data:\x20'+_0x25fdaf);const _0x229d02=await database_1[_0x388c64(0x110)][_0x388c64(0x149)][_0x388c64(0x12e)]({'where':{'OR':[{'id':_0x25fdaf},{'orderId':_0x25fdaf},{'gatewayOrderId':_0x25fdaf},{'gatewayPaymentId':_0x25fdaf}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x229d02){_0x77642b['status'](0x194)[_0x388c64(0x12f)]({'success':![],'message':'Payment\x20not\x20found'});return;}console[_0x388c64(0x12d)](_0x388c64(0x11b)+_0x229d02['id']+'\x20('+_0x229d02[_0x388c64(0x111)]+')'),_0x77642b[_0x388c64(0x12f)]({'success':!![],'data':{'id':_0x229d02['id'],'gateway':_0x229d02[_0x388c64(0x153)],'amount':_0x229d02[_0x388c64(0x148)],'currency':_0x229d02['currency'],'status':_0x229d02[_0x388c64(0x111)],'gatewayOrderId':_0x229d02[_0x388c64(0x128)],'gatewayPaymentId':_0x229d02[_0x388c64(0x147)],'successUrl':_0x229d02[_0x388c64(0x145)],'failUrl':_0x229d02['failUrl'],'pendingUrl':_0x229d02[_0x388c64(0x13a)],'customerEmail':_0x229d02[_0x388c64(0x121)],'customerName':_0x229d02[_0x388c64(0x146)],'merchantBrand':_0x229d02[_0x388c64(0x11c)][_0x388c64(0x116)],'createdAt':_0x229d02['createdAt'],'updatedAt':_0x229d02['updatedAt']}});}catch(_0x17ad67){console['error'](_0x388c64(0x125),_0x17ad67),_0x77642b[_0x388c64(0x111)](0x1f4)[_0x388c64(0x12f)]({'success':![],'message':_0x388c64(0x131),'error':_0x17ad67 instanceof Error?_0x17ad67[_0x388c64(0x141)]:'Unknown\x20error'});}}}function a13_0x3bd6(){var _0x89cb48=['âœ…\x20Found\x20payment:\x20','shop','toFixed','__importDefault','âœ…\x20OnRamp\x20payment\x20','currency','customerEmail','Payment\x20ID\x20and\x20status\x20are\x20required','convertToUSDT','__esModule','âŒ\x20OnRamp\x20get\x20payment\x20data\x20error:','__setModuleDefault','invoiceTotalSum','gatewayOrderId','1441416dslsjA','params','ðŸ“\x20Data:','updateMerchantBalanceForPaidPayment','log','findFirst','json','âœ…\x20Merchant\x20balance\x20updated:\x20+','Internal\x20server\x20error','Payment\x20status\x20updated\x20successfully','resolve','PAID','ðŸ’°\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','Payment\x20not\x20found','1904CYnmdQ','__createBinding','1890uoXepu','pendingUrl','toUpperCase','getPaymentData','OnRampController','844134cLZacj','\x20USDT\x20(after\x20','2584218bNicOX','message','body','length','then','successUrl','customerName','gatewayPaymentId','amount','payment','shopId','âŒ\x20Failed\x20to\x20update\x20merchant\x20balance:','%\x20commission)','5SRDKdv','421942sIYrme','212912rRvmpI','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','getOwnPropertyNames','error','gateway','update','\x20updated\x20to\x20','writable','prototype','hasOwnProperty','defineProperty','default','status','\x20->\x20','get','2405754AVqyTp','call','name','Unknown\x20error','Payment\x20ID\x20is\x20required','configurable','create'];a13_0x3bd6=function(){return _0x89cb48;};return a13_0x3bd6();}exports[a13_0x58ed8f(0x13d)]=OnRampController;