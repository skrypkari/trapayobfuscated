'use strict';var a12_0xe24bca=a12_0x2eed;function a12_0x2eed(_0x2fc1fe,_0x5cf4e8){_0x2fc1fe=_0x2fc1fe-0x9c;var _0x34e0cb=a12_0x34e0();var _0x2eed97=_0x34e0cb[_0x2fc1fe];return _0x2eed97;}(function(_0xd82b0d,_0x3986fb){var _0x3fee71=a12_0x2eed,_0x42bb09=_0xd82b0d();while(!![]){try{var _0x5df7b4=parseInt(_0x3fee71(0xd0))/0x1*(-parseInt(_0x3fee71(0xcd))/0x2)+parseInt(_0x3fee71(0xde))/0x3*(-parseInt(_0x3fee71(0xdb))/0x4)+parseInt(_0x3fee71(0xb6))/0x5+-parseInt(_0x3fee71(0xd8))/0x6+parseInt(_0x3fee71(0xc0))/0x7+-parseInt(_0x3fee71(0xa2))/0x8+-parseInt(_0x3fee71(0x9d))/0x9*(-parseInt(_0x3fee71(0xd7))/0xa);if(_0x5df7b4===_0x3986fb)break;else _0x42bb09['push'](_0x42bb09['shift']());}catch(_0x3bbd5e){_0x42bb09['push'](_0x42bb09['shift']());}}}(a12_0x34e0,0x2f85f));var __createBinding=this&&this[a12_0xe24bca(0x9c)]||(Object[a12_0xe24bca(0xae)]?function(_0x5e70ba,_0x3223a4,_0x2cff1a,_0x2a0692){var _0x56a818=a12_0xe24bca;if(_0x2a0692===undefined)_0x2a0692=_0x2cff1a;var _0x412fdb=Object[_0x56a818(0xa8)](_0x3223a4,_0x2cff1a);(!_0x412fdb||(_0x56a818(0xc2)in _0x412fdb?!_0x3223a4[_0x56a818(0xe2)]:_0x412fdb[_0x56a818(0xa0)]||_0x412fdb[_0x56a818(0x9f)]))&&(_0x412fdb={'enumerable':!![],'get':function(){return _0x3223a4[_0x2cff1a];}}),Object['defineProperty'](_0x5e70ba,_0x2a0692,_0x412fdb);}:function(_0x2cfdde,_0x4f6ef2,_0xe6d6da,_0x104031){if(_0x104031===undefined)_0x104031=_0xe6d6da;_0x2cfdde[_0x104031]=_0x4f6ef2[_0xe6d6da];}),__setModuleDefault=this&&this[a12_0xe24bca(0xc9)]||(Object[a12_0xe24bca(0xae)]?function(_0x3bff7e,_0x3d73b1){var _0x353221=a12_0xe24bca;Object[_0x353221(0xaf)](_0x3bff7e,'default',{'enumerable':!![],'value':_0x3d73b1});}:function(_0x577e70,_0xb893d0){var _0x436454=a12_0xe24bca;_0x577e70[_0x436454(0xb5)]=_0xb893d0;}),__importStar=this&&this[a12_0xe24bca(0xb4)]||(function(){var _0x4d323f=function(_0x5e0d1c){var _0xbecf62=a12_0x2eed;return _0x4d323f=Object[_0xbecf62(0xd3)]||function(_0x3f423c){var _0x411615=_0xbecf62,_0x376d91=[];for(var _0x4a88b3 in _0x3f423c)if(Object[_0x411615(0xa3)][_0x411615(0xe8)][_0x411615(0xba)](_0x3f423c,_0x4a88b3))_0x376d91[_0x376d91[_0x411615(0xc5)]]=_0x4a88b3;return _0x376d91;},_0x4d323f(_0x5e0d1c);};return function(_0x3abe9a){var _0x4d7afa=a12_0x2eed;if(_0x3abe9a&&_0x3abe9a[_0x4d7afa(0xe2)])return _0x3abe9a;var _0x3c1c8f={};if(_0x3abe9a!=null){for(var _0x423f57=_0x4d323f(_0x3abe9a),_0x216e4e=0x0;_0x216e4e<_0x423f57[_0x4d7afa(0xc5)];_0x216e4e++)if(_0x423f57[_0x216e4e]!==_0x4d7afa(0xb5))__createBinding(_0x3c1c8f,_0x3abe9a,_0x423f57[_0x216e4e]);}return __setModuleDefault(_0x3c1c8f,_0x3abe9a),_0x3c1c8f;};}()),__importDefault=this&&this[a12_0xe24bca(0xda)]||function(_0x29d18f){var _0x1da019=a12_0xe24bca;return _0x29d18f&&_0x29d18f[_0x1da019(0xe2)]?_0x29d18f:{'default':_0x29d18f};};Object[a12_0xe24bca(0xaf)](exports,a12_0xe24bca(0xe2),{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require(a12_0xe24bca(0xbe)));class OnRampController{async[a12_0xe24bca(0xc7)](_0x5643b6,_0x3236fe){var _0xcac1ff=a12_0xe24bca;try{const {paymentId:_0x56a844,status:_0x308d91,referenceId:_0x47c5bb,transactionHash:_0x4e8b83,actualCryptoAmount:_0xd6af2d,orderId:_0x103ee}=_0x5643b6['body'];if(!_0x56a844||!_0x308d91){_0x3236fe[_0xcac1ff(0xa5)](0x190)['json']({'success':![],'message':'Payment\x20ID\x20and\x20status\x20are\x20required'});return;}console[_0xcac1ff(0xe3)](_0xcac1ff(0xbf)+_0x56a844+_0xcac1ff(0xe0)+_0x308d91),console[_0xcac1ff(0xe3)]('üìù\x20Data:',{'referenceId':_0x47c5bb,'transactionHash':_0x4e8b83,'actualCryptoAmount':_0xd6af2d,'orderId':_0x103ee});const _0x58e858=await database_1[_0xcac1ff(0xb5)][_0xcac1ff(0xbd)][_0xcac1ff(0xa6)]({'where':{'OR':[{'id':_0x56a844},{'orderId':_0x56a844},{'gatewayOrderId':_0x56a844},{'gatewayPaymentId':_0x56a844}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x58e858){_0x3236fe[_0xcac1ff(0xa5)](0x194)[_0xcac1ff(0xad)]({'success':![],'message':_0xcac1ff(0xc3)});return;}if(_0x58e858[_0xcac1ff(0xd1)]!=='onramp'){_0x3236fe['status'](0x190)[_0xcac1ff(0xad)]({'success':![],'message':_0xcac1ff(0xd4)});return;}const _0x39a54b={'status':_0x308d91[_0xcac1ff(0xc4)](),'statusChangedAt':new Date(),'statusChangedBy':_0xcac1ff(0xc8)};_0x47c5bb&&(_0x39a54b[_0xcac1ff(0xa9)]=_0x47c5bb);_0x4e8b83&&(_0x39a54b[_0xcac1ff(0xb1)]=_0x4e8b83);_0xd6af2d&&(_0x39a54b['invoiceTotalSum']=_0xd6af2d);const _0x501979=await database_1[_0xcac1ff(0xb5)]['payment'][_0xcac1ff(0xbb)]({'where':{'id':_0x58e858['id']},'data':_0x39a54b});console[_0xcac1ff(0xe3)](_0xcac1ff(0xa7)+_0x58e858['id']+_0xcac1ff(0xe7)+_0x308d91),_0x308d91['toUpperCase']()===_0xcac1ff(0xc1)&&_0x58e858[_0xcac1ff(0xa5)]!==_0xcac1ff(0xc1)&&await this['updateMerchantBalanceForPaidPayment'](_0x58e858),_0x3236fe[_0xcac1ff(0xad)]({'success':!![],'message':'Payment\x20status\x20updated\x20successfully','data':{'paymentId':_0x501979['id'],'status':_0x501979[_0xcac1ff(0xa5)],'referenceId':_0x47c5bb,'transactionHash':_0x4e8b83,'actualCryptoAmount':_0xd6af2d}});}catch(_0x175ee2){console[_0xcac1ff(0xa4)](_0xcac1ff(0x9e),_0x175ee2),_0x3236fe[_0xcac1ff(0xa5)](0x1f4)[_0xcac1ff(0xad)]({'success':![],'message':_0xcac1ff(0xe1),'error':_0x175ee2 instanceof Error?_0x175ee2['message']:'Unknown\x20error'});}}async[a12_0xe24bca(0xe6)](_0x5795bc){var _0x33afd4=a12_0xe24bca;try{console[_0x33afd4(0xe3)](_0x33afd4(0xb0)+_0x5795bc['id']);let _0x24094b;if(_0x5795bc[_0x33afd4(0xd2)]===_0x33afd4(0xca))_0x24094b=_0x5795bc[_0x33afd4(0xb9)];else{const {currencyService:_0x42b105}=await Promise[_0x33afd4(0xb3)]()[_0x33afd4(0xb8)](()=>__importStar(require(_0x33afd4(0xb2))));_0x24094b=await _0x42b105[_0x33afd4(0xc6)](_0x5795bc[_0x33afd4(0xb9)],_0x5795bc[_0x33afd4(0xd2)]);}await database_1['default']['payment']['update']({'where':{'id':_0x5795bc['id']},'data':{'amountUSDT':_0x24094b,'paidAt':new Date()}});const _0x359c4d=0xa,_0x1d641a=_0x24094b*(0x1-_0x359c4d/0x64);await database_1[_0x33afd4(0xb5)][_0x33afd4(0xdf)][_0x33afd4(0xbb)]({'where':{'id':_0x5795bc[_0x33afd4(0xac)]},'data':{'balance':{'increment':_0x1d641a}}}),console['log'](_0x33afd4(0xce)+_0x1d641a[_0x33afd4(0xcc)](0x6)+'\x20USDT\x20(after\x20'+_0x359c4d+_0x33afd4(0xd6));}catch(_0x558da6){console[_0x33afd4(0xa4)](_0x33afd4(0xb7),_0x558da6);}}async[a12_0xe24bca(0xa1)](_0x178274,_0x169a7e){var _0xce2da5=a12_0xe24bca;try{const {id:_0x497c07}=_0x178274[_0xce2da5(0xd9)];if(!_0x497c07){_0x169a7e['status'](0x190)[_0xce2da5(0xad)]({'success':![],'message':'Payment\x20ID\x20is\x20required'});return;}console[_0xce2da5(0xe3)](_0xce2da5(0xcb)+_0x497c07);const _0x4431ab=await database_1['default'][_0xce2da5(0xbd)]['findFirst']({'where':{'OR':[{'id':_0x497c07},{'orderId':_0x497c07},{'gatewayOrderId':_0x497c07},{'gatewayPaymentId':_0x497c07}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x4431ab){_0x169a7e['status'](0x194)[_0xce2da5(0xad)]({'success':![],'message':_0xce2da5(0xc3)});return;}console[_0xce2da5(0xe3)](_0xce2da5(0xe5)+_0x4431ab['id']+'\x20('+_0x4431ab[_0xce2da5(0xa5)]+')'),_0x169a7e['json']({'success':!![],'data':{'id':_0x4431ab['id'],'gateway':_0x4431ab[_0xce2da5(0xd1)],'amount':_0x4431ab[_0xce2da5(0xb9)],'currency':_0x4431ab[_0xce2da5(0xd2)],'status':_0x4431ab[_0xce2da5(0xa5)],'gatewayOrderId':_0x4431ab[_0xce2da5(0xa9)],'gatewayPaymentId':_0x4431ab['gatewayPaymentId'],'successUrl':_0x4431ab['successUrl'],'failUrl':_0x4431ab[_0xce2da5(0xcf)],'pendingUrl':_0x4431ab[_0xce2da5(0xdd)],'customerEmail':_0x4431ab[_0xce2da5(0xdc)],'customerName':_0x4431ab[_0xce2da5(0xab)],'merchantBrand':_0x4431ab[_0xce2da5(0xdf)]['name'],'createdAt':_0x4431ab['createdAt'],'updatedAt':_0x4431ab[_0xce2da5(0xd5)]}});}catch(_0x1524a9){console[_0xce2da5(0xa4)](_0xce2da5(0xaa),_0x1524a9),_0x169a7e['status'](0x1f4)['json']({'success':![],'message':_0xce2da5(0xe1),'error':_0x1524a9 instanceof Error?_0x1524a9[_0xce2da5(0xe4)]:'Unknown\x20error'});}}}function a12_0x34e0(){var _0x3d62c0=['configurable','writable','getPaymentData','796232HapcAN','prototype','error','status','findFirst','‚úÖ\x20OnRamp\x20payment\x20','getOwnPropertyDescriptor','gatewayOrderId','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','customerName','shopId','json','create','defineProperty','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','gatewayPaymentId','../services/currencyService','resolve','__importStar','default','1942910JpwZmJ','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','then','amount','call','update','OnRampController','payment','../config/database','üöÄ\x20OnRamp\x20status\x20update:\x20','2328459LCxAgX','PAID','get','Payment\x20not\x20found','toUpperCase','length','convertToUSDT','updatePaymentStatus','onramp_system','__setModuleDefault','USD','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','toFixed','476998igCKbI','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','failUrl','1AAEsyK','gateway','currency','getOwnPropertyNames','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','updatedAt','%\x20commission)','10FGzNUu','586182acFcZi','params','__importDefault','29576tFvrdF','customerEmail','pendingUrl','51lJarmF','shop','\x20->\x20','Internal\x20server\x20error','__esModule','log','message','‚úÖ\x20Found\x20payment:\x20','updateMerchantBalanceForPaidPayment','\x20updated\x20to\x20','hasOwnProperty','__createBinding','313731ysQlTl','‚ùå\x20OnRamp\x20status\x20update\x20error:'];a12_0x34e0=function(){return _0x3d62c0;};return a12_0x34e0();}exports[a12_0xe24bca(0xbc)]=OnRampController;