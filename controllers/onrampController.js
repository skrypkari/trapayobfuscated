'use strict';function a9_0x1688(_0x1dadc3,_0x41eee7){var _0x53677f=a9_0x5367();return a9_0x1688=function(_0x16885c,_0x37dd28){_0x16885c=_0x16885c-0x109;var _0x27d973=_0x53677f[_0x16885c];return _0x27d973;},a9_0x1688(_0x1dadc3,_0x41eee7);}var a9_0x15d55a=a9_0x1688;(function(_0xa682f1,_0x382ffa){var _0x1945c4=a9_0x1688,_0x448bbd=_0xa682f1();while(!![]){try{var _0x44524c=parseInt(_0x1945c4(0x114))/0x1+-parseInt(_0x1945c4(0x150))/0x2+parseInt(_0x1945c4(0x125))/0x3*(-parseInt(_0x1945c4(0x123))/0x4)+-parseInt(_0x1945c4(0x12c))/0x5+-parseInt(_0x1945c4(0x14b))/0x6*(-parseInt(_0x1945c4(0x154))/0x7)+-parseInt(_0x1945c4(0x141))/0x8*(parseInt(_0x1945c4(0x122))/0x9)+parseInt(_0x1945c4(0x133))/0xa;if(_0x44524c===_0x382ffa)break;else _0x448bbd['push'](_0x448bbd['shift']());}catch(_0x3770e7){_0x448bbd['push'](_0x448bbd['shift']());}}}(a9_0x5367,0xb3af8));var __createBinding=this&&this[a9_0x15d55a(0x155)]||(Object['create']?function(_0x5f44c6,_0x532ec,_0x1fa6dd,_0x19fdb8){var _0x22c39c=a9_0x15d55a;if(_0x19fdb8===undefined)_0x19fdb8=_0x1fa6dd;var _0x54bf30=Object[_0x22c39c(0x121)](_0x532ec,_0x1fa6dd);(!_0x54bf30||(_0x22c39c(0x146)in _0x54bf30?!_0x532ec[_0x22c39c(0x11b)]:_0x54bf30[_0x22c39c(0x11e)]||_0x54bf30[_0x22c39c(0x112)]))&&(_0x54bf30={'enumerable':!![],'get':function(){return _0x532ec[_0x1fa6dd];}}),Object['defineProperty'](_0x5f44c6,_0x19fdb8,_0x54bf30);}:function(_0x5e186f,_0x336a98,_0xf00368,_0x585d35){if(_0x585d35===undefined)_0x585d35=_0xf00368;_0x5e186f[_0x585d35]=_0x336a98[_0xf00368];}),__setModuleDefault=this&&this[a9_0x15d55a(0x12b)]||(Object[a9_0x15d55a(0x10c)]?function(_0x48e027,_0x456606){var _0x16714e=a9_0x15d55a;Object[_0x16714e(0x10e)](_0x48e027,_0x16714e(0x12d),{'enumerable':!![],'value':_0x456606});}:function(_0x10eaee,_0x5ec4ad){_0x10eaee['default']=_0x5ec4ad;}),__importStar=this&&this['__importStar']||(function(){var _0x5cbf68=function(_0x532d90){return _0x5cbf68=Object['getOwnPropertyNames']||function(_0x2a01e9){var _0x5a7f15=a9_0x1688,_0x1783c=[];for(var _0x5603e3 in _0x2a01e9)if(Object['prototype'][_0x5a7f15(0x149)][_0x5a7f15(0x116)](_0x2a01e9,_0x5603e3))_0x1783c[_0x1783c[_0x5a7f15(0x140)]]=_0x5603e3;return _0x1783c;},_0x5cbf68(_0x532d90);};return function(_0x40440b){var _0x28f108=a9_0x1688;if(_0x40440b&&_0x40440b[_0x28f108(0x11b)])return _0x40440b;var _0x5df529={};if(_0x40440b!=null){for(var _0x17d75f=_0x5cbf68(_0x40440b),_0x169e1b=0x0;_0x169e1b<_0x17d75f['length'];_0x169e1b++)if(_0x17d75f[_0x169e1b]!==_0x28f108(0x12d))__createBinding(_0x5df529,_0x40440b,_0x17d75f[_0x169e1b]);}return __setModuleDefault(_0x5df529,_0x40440b),_0x5df529;};}()),__importDefault=this&&this['__importDefault']||function(_0x285539){var _0x4ea754=a9_0x15d55a;return _0x285539&&_0x285539[_0x4ea754(0x11b)]?_0x285539:{'default':_0x285539};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a9_0x15d55a(0x134)]=void 0x0;const database_1=__importDefault(require(a9_0x15d55a(0x14c)));class OnRampController{async[a9_0x15d55a(0x14e)](_0x1eedbd,_0x5cbfc3){var _0x7115d3=a9_0x15d55a;try{const {paymentId:_0x29c747,status:_0x24ece8,referenceId:_0x6d231d,transactionHash:_0x37ebbb,actualCryptoAmount:_0x47e877,orderId:_0x339b47}=_0x1eedbd[_0x7115d3(0x136)];if(!_0x29c747||!_0x24ece8){_0x5cbfc3[_0x7115d3(0x12f)](0x190)[_0x7115d3(0x109)]({'success':![],'message':_0x7115d3(0x135)});return;}console['log'](_0x7115d3(0x138)+_0x29c747+'\x20->\x20'+_0x24ece8),console['log'](_0x7115d3(0x10a),{'referenceId':_0x6d231d,'transactionHash':_0x37ebbb,'actualCryptoAmount':_0x47e877,'orderId':_0x339b47});const _0x419964=await database_1[_0x7115d3(0x12d)][_0x7115d3(0x13c)]['findFirst']({'where':{'OR':[{'id':_0x29c747},{'orderId':_0x29c747},{'gatewayOrderId':_0x29c747},{'gatewayPaymentId':_0x29c747}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x419964){_0x5cbfc3[_0x7115d3(0x12f)](0x194)[_0x7115d3(0x109)]({'success':![],'message':_0x7115d3(0x13e)});return;}if(_0x419964[_0x7115d3(0x12a)]!==_0x7115d3(0x132)){_0x5cbfc3[_0x7115d3(0x12f)](0x190)[_0x7115d3(0x109)]({'success':![],'message':_0x7115d3(0x11c)});return;}const _0x226666={'status':_0x24ece8[_0x7115d3(0x151)](),'statusChangedAt':new Date(),'statusChangedBy':'onramp_system'};_0x6d231d&&(_0x226666[_0x7115d3(0x11a)]=_0x6d231d);_0x37ebbb&&(_0x226666[_0x7115d3(0x131)]=_0x37ebbb);_0x47e877&&(_0x226666[_0x7115d3(0x117)]=_0x47e877);const _0x18b0ff=await database_1[_0x7115d3(0x12d)][_0x7115d3(0x13c)][_0x7115d3(0x10f)]({'where':{'id':_0x419964['id']},'data':_0x226666});console[_0x7115d3(0x11f)](_0x7115d3(0x14a)+_0x419964['id']+_0x7115d3(0x115)+_0x24ece8),_0x24ece8[_0x7115d3(0x151)]()===_0x7115d3(0x110)&&_0x419964[_0x7115d3(0x12f)]!=='PAID'&&await this[_0x7115d3(0x142)](_0x419964),_0x5cbfc3[_0x7115d3(0x109)]({'success':!![],'message':_0x7115d3(0x130),'data':{'paymentId':_0x18b0ff['id'],'status':_0x18b0ff[_0x7115d3(0x12f)],'referenceId':_0x6d231d,'transactionHash':_0x37ebbb,'actualCryptoAmount':_0x47e877}});}catch(_0xa8e825){console[_0x7115d3(0x145)](_0x7115d3(0x11d),_0xa8e825),_0x5cbfc3[_0x7115d3(0x12f)](0x1f4)[_0x7115d3(0x109)]({'success':![],'message':_0x7115d3(0x137),'error':_0xa8e825 instanceof Error?_0xa8e825['message']:'Unknown\x20error'});}}async[a9_0x15d55a(0x142)](_0x27503c){var _0x4b961a=a9_0x15d55a;try{console[_0x4b961a(0x11f)](_0x4b961a(0x139)+_0x27503c['id']);let _0x277ec1;if(_0x27503c[_0x4b961a(0x111)]===_0x4b961a(0x126))_0x277ec1=_0x27503c[_0x4b961a(0x13d)];else{const {currencyService:_0x2082e1}=await Promise[_0x4b961a(0x119)]()[_0x4b961a(0x13f)](()=>__importStar(require('../services/currencyService')));_0x277ec1=await _0x2082e1['convertToUSDT'](_0x27503c[_0x4b961a(0x13d)],_0x27503c[_0x4b961a(0x111)]);}await database_1[_0x4b961a(0x12d)][_0x4b961a(0x13c)][_0x4b961a(0x10f)]({'where':{'id':_0x27503c['id']},'data':{'amountUSDT':_0x277ec1,'paidAt':new Date()}});const _0x22eb07=0xa,_0x519f1e=_0x277ec1*(0x1-_0x22eb07/0x64);await database_1[_0x4b961a(0x12d)][_0x4b961a(0x14d)][_0x4b961a(0x10f)]({'where':{'id':_0x27503c[_0x4b961a(0x13a)]},'data':{'balance':{'increment':_0x519f1e}}}),console[_0x4b961a(0x11f)](_0x4b961a(0x113)+_0x519f1e[_0x4b961a(0x153)](0x6)+_0x4b961a(0x13b)+_0x22eb07+'%\x20commission)');}catch(_0x230e51){console[_0x4b961a(0x145)]('‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:',_0x230e51);}}async['getPaymentData'](_0x4ccbc4,_0x398448){var _0x1cd7cb=a9_0x15d55a;try{const {id:_0x1e069}=_0x4ccbc4[_0x1cd7cb(0x143)];if(!_0x1e069){_0x398448[_0x1cd7cb(0x12f)](0x190)[_0x1cd7cb(0x109)]({'success':![],'message':_0x1cd7cb(0x152)});return;}console['log'](_0x1cd7cb(0x129)+_0x1e069);const _0x478ce0=await database_1[_0x1cd7cb(0x12d)][_0x1cd7cb(0x13c)][_0x1cd7cb(0x14f)]({'where':{'OR':[{'id':_0x1e069},{'orderId':_0x1e069},{'gatewayOrderId':_0x1e069},{'gatewayPaymentId':_0x1e069}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x478ce0){_0x398448[_0x1cd7cb(0x12f)](0x194)[_0x1cd7cb(0x109)]({'success':![],'message':_0x1cd7cb(0x13e)});return;}console['log'](_0x1cd7cb(0x144)+_0x478ce0['id']+'\x20('+_0x478ce0[_0x1cd7cb(0x12f)]+')'),_0x398448[_0x1cd7cb(0x109)]({'success':!![],'data':{'id':_0x478ce0['id'],'gateway':_0x478ce0[_0x1cd7cb(0x12a)],'amount':_0x478ce0[_0x1cd7cb(0x13d)],'currency':_0x478ce0[_0x1cd7cb(0x111)],'status':_0x478ce0[_0x1cd7cb(0x12f)],'gatewayOrderId':_0x478ce0[_0x1cd7cb(0x11a)],'gatewayPaymentId':_0x478ce0[_0x1cd7cb(0x131)],'successUrl':_0x478ce0[_0x1cd7cb(0x147)],'failUrl':_0x478ce0[_0x1cd7cb(0x10d)],'pendingUrl':_0x478ce0[_0x1cd7cb(0x127)],'customerEmail':_0x478ce0[_0x1cd7cb(0x12e)],'customerName':_0x478ce0[_0x1cd7cb(0x120)],'merchantBrand':_0x478ce0[_0x1cd7cb(0x14d)][_0x1cd7cb(0x124)],'createdAt':_0x478ce0[_0x1cd7cb(0x118)],'updatedAt':_0x478ce0[_0x1cd7cb(0x128)]}});}catch(_0x3cf1cf){console[_0x1cd7cb(0x145)](_0x1cd7cb(0x148),_0x3cf1cf),_0x398448[_0x1cd7cb(0x12f)](0x1f4)[_0x1cd7cb(0x109)]({'success':![],'message':_0x1cd7cb(0x137),'error':_0x3cf1cf instanceof Error?_0x3cf1cf[_0x1cd7cb(0x10b)]:'Unknown\x20error'});}}}function a9_0x5367(){var _0x7ea609=['7924600LDOLKl','updateMerchantBalanceForPaidPayment','params','‚úÖ\x20Found\x20payment:\x20','error','get','successUrl','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','hasOwnProperty','‚úÖ\x20OnRamp\x20payment\x20','78iFDJJv','../config/database','shop','updatePaymentStatus','findFirst','516958GhPvEu','toUpperCase','Payment\x20ID\x20is\x20required','toFixed','55587jwPPbV','__createBinding','json','üìù\x20Data:','message','create','failUrl','defineProperty','update','PAID','currency','configurable','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','1122811oxHJHM','\x20updated\x20to\x20','call','invoiceTotalSum','createdAt','resolve','gatewayOrderId','__esModule','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','‚ùå\x20OnRamp\x20status\x20update\x20error:','writable','log','customerName','getOwnPropertyDescriptor','9XBeLMl','16136bfMEKK','name','249OrVFqD','USD','pendingUrl','updatedAt','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','gateway','__setModuleDefault','48085wQPZvn','default','customerEmail','status','Payment\x20status\x20updated\x20successfully','gatewayPaymentId','onramp','11034410Acihid','OnRampController','Payment\x20ID\x20and\x20status\x20are\x20required','body','Internal\x20server\x20error','üöÄ\x20OnRamp\x20status\x20update:\x20','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','shopId','\x20USDT\x20(after\x20','payment','amount','Payment\x20not\x20found','then','length'];a9_0x5367=function(){return _0x7ea609;};return a9_0x5367();}exports['OnRampController']=OnRampController;