'use strict';var a12_0xf264e0=a12_0x3af5;function a12_0x3af5(_0x1d5151,_0x4758eb){_0x1d5151=_0x1d5151-0x11d;var _0x584c38=a12_0x584c();var _0x3af5f0=_0x584c38[_0x1d5151];return _0x3af5f0;}(function(_0x2c07df,_0x31cf16){var _0x1f1b93=a12_0x3af5,_0x11feea=_0x2c07df();while(!![]){try{var _0x3f5b10=parseInt(_0x1f1b93(0x11d))/0x1*(parseInt(_0x1f1b93(0x15c))/0x2)+parseInt(_0x1f1b93(0x164))/0x3+parseInt(_0x1f1b93(0x12e))/0x4*(-parseInt(_0x1f1b93(0x159))/0x5)+parseInt(_0x1f1b93(0x148))/0x6*(parseInt(_0x1f1b93(0x12b))/0x7)+-parseInt(_0x1f1b93(0x156))/0x8+parseInt(_0x1f1b93(0x143))/0x9+-parseInt(_0x1f1b93(0x15f))/0xa;if(_0x3f5b10===_0x31cf16)break;else _0x11feea['push'](_0x11feea['shift']());}catch(_0x2b8c60){_0x11feea['push'](_0x11feea['shift']());}}}(a12_0x584c,0xab76e));var __createBinding=this&&this['__createBinding']||(Object[a12_0xf264e0(0x134)]?function(_0x182c82,_0x543c97,_0x52f187,_0xfe51ca){var _0x386d1e=a12_0xf264e0;if(_0xfe51ca===undefined)_0xfe51ca=_0x52f187;var _0x502ba4=Object[_0x386d1e(0x162)](_0x543c97,_0x52f187);(!_0x502ba4||('get'in _0x502ba4?!_0x543c97[_0x386d1e(0x13f)]:_0x502ba4[_0x386d1e(0x168)]||_0x502ba4[_0x386d1e(0x123)]))&&(_0x502ba4={'enumerable':!![],'get':function(){return _0x543c97[_0x52f187];}}),Object['defineProperty'](_0x182c82,_0xfe51ca,_0x502ba4);}:function(_0x4f4039,_0x1256a9,_0x176694,_0x28b52c){if(_0x28b52c===undefined)_0x28b52c=_0x176694;_0x4f4039[_0x28b52c]=_0x1256a9[_0x176694];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a12_0xf264e0(0x134)]?function(_0x22591e,_0x55799a){var _0x542a62=a12_0xf264e0;Object[_0x542a62(0x128)](_0x22591e,'default',{'enumerable':!![],'value':_0x55799a});}:function(_0x31af46,_0x12f2d3){var _0x5e8ae5=a12_0xf264e0;_0x31af46[_0x5e8ae5(0x132)]=_0x12f2d3;}),__importStar=this&&this[a12_0xf264e0(0x154)]||(function(){var _0x372591=function(_0x2aca51){var _0x56ec72=a12_0x3af5;return _0x372591=Object[_0x56ec72(0x138)]||function(_0x33b4d6){var _0x26b88a=_0x56ec72,_0x2fddb5=[];for(var _0x4dd0d9 in _0x33b4d6)if(Object[_0x26b88a(0x151)][_0x26b88a(0x127)][_0x26b88a(0x15a)](_0x33b4d6,_0x4dd0d9))_0x2fddb5[_0x2fddb5[_0x26b88a(0x12c)]]=_0x4dd0d9;return _0x2fddb5;},_0x372591(_0x2aca51);};return function(_0x2d2e34){var _0x53dd8c=a12_0x3af5;if(_0x2d2e34&&_0x2d2e34[_0x53dd8c(0x13f)])return _0x2d2e34;var _0x5aafc5={};if(_0x2d2e34!=null){for(var _0x152696=_0x372591(_0x2d2e34),_0x1e5aed=0x0;_0x1e5aed<_0x152696['length'];_0x1e5aed++)if(_0x152696[_0x1e5aed]!==_0x53dd8c(0x132))__createBinding(_0x5aafc5,_0x2d2e34,_0x152696[_0x1e5aed]);}return __setModuleDefault(_0x5aafc5,_0x2d2e34),_0x5aafc5;};}()),__importDefault=this&&this[a12_0xf264e0(0x16a)]||function(_0x49ad6f){var _0xabcaf=a12_0xf264e0;return _0x49ad6f&&_0x49ad6f[_0xabcaf(0x13f)]?_0x49ad6f:{'default':_0x49ad6f};};Object[a12_0xf264e0(0x128)](exports,'__esModule',{'value':!![]}),exports['OnRampController']=void 0x0;const database_1=__importDefault(require(a12_0xf264e0(0x145)));class OnRampController{async['updatePaymentStatus'](_0x2a50ae,_0x42e52a){var _0x5a6837=a12_0xf264e0;try{const {paymentId:_0xcf6f21,status:_0x556647,referenceId:_0x464adf,transactionHash:_0x5edfcf,actualCryptoAmount:_0x18e43f,orderId:_0x481868}=_0x2a50ae[_0x5a6837(0x149)];if(!_0xcf6f21||!_0x556647){_0x42e52a['status'](0x190)[_0x5a6837(0x13b)]({'success':![],'message':_0x5a6837(0x14a)});return;}console[_0x5a6837(0x150)](_0x5a6837(0x144)+_0xcf6f21+'\x20->\x20'+_0x556647),console[_0x5a6837(0x150)](_0x5a6837(0x163),{'referenceId':_0x464adf,'transactionHash':_0x5edfcf,'actualCryptoAmount':_0x18e43f,'orderId':_0x481868});const _0x204a53=await database_1[_0x5a6837(0x132)]['payment'][_0x5a6837(0x15d)]({'where':{'OR':[{'id':_0xcf6f21},{'orderId':_0xcf6f21},{'gatewayOrderId':_0xcf6f21},{'gatewayPaymentId':_0xcf6f21}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x204a53){_0x42e52a[_0x5a6837(0x11e)](0x194)[_0x5a6837(0x13b)]({'success':![],'message':_0x5a6837(0x13d)});return;}if(_0x204a53['gateway']!==_0x5a6837(0x137)){_0x42e52a['status'](0x190)['json']({'success':![],'message':_0x5a6837(0x131)});return;}const _0x3013e4={'status':_0x556647[_0x5a6837(0x160)](),'statusChangedAt':new Date(),'statusChangedBy':_0x5a6837(0x142)};_0x464adf&&(_0x3013e4[_0x5a6837(0x14f)]=_0x464adf);_0x5edfcf&&(_0x3013e4['gatewayPaymentId']=_0x5edfcf);_0x18e43f&&(_0x3013e4[_0x5a6837(0x12f)]=_0x18e43f);const _0x2e99e7=await database_1[_0x5a6837(0x132)]['payment'][_0x5a6837(0x146)]({'where':{'id':_0x204a53['id']},'data':_0x3013e4});console[_0x5a6837(0x150)](_0x5a6837(0x161)+_0x204a53['id']+_0x5a6837(0x13e)+_0x556647),_0x556647[_0x5a6837(0x160)]()===_0x5a6837(0x135)&&_0x204a53[_0x5a6837(0x11e)]!==_0x5a6837(0x135)&&await this[_0x5a6837(0x147)](_0x204a53),_0x42e52a[_0x5a6837(0x13b)]({'success':!![],'message':_0x5a6837(0x15e),'data':{'paymentId':_0x2e99e7['id'],'status':_0x2e99e7['status'],'referenceId':_0x464adf,'transactionHash':_0x5edfcf,'actualCryptoAmount':_0x18e43f}});}catch(_0x50cea6){console[_0x5a6837(0x126)](_0x5a6837(0x15b),_0x50cea6),_0x42e52a['status'](0x1f4)[_0x5a6837(0x13b)]({'success':![],'message':_0x5a6837(0x165),'error':_0x50cea6 instanceof Error?_0x50cea6[_0x5a6837(0x14e)]:_0x5a6837(0x14b)});}}async['updateMerchantBalanceForPaidPayment'](_0x415c9b){var _0x2008c9=a12_0xf264e0;try{console['log'](_0x2008c9(0x158)+_0x415c9b['id']);let _0x136e30;if(_0x415c9b[_0x2008c9(0x166)]===_0x2008c9(0x14d))_0x136e30=_0x415c9b[_0x2008c9(0x125)];else{const {currencyService:_0x52404e}=await Promise[_0x2008c9(0x155)]()['then'](()=>__importStar(require(_0x2008c9(0x11f))));_0x136e30=await _0x52404e[_0x2008c9(0x133)](_0x415c9b['amount'],_0x415c9b['currency']);}await database_1[_0x2008c9(0x132)]['payment'][_0x2008c9(0x146)]({'where':{'id':_0x415c9b['id']},'data':{'amountUSDT':_0x136e30,'paidAt':new Date()}});const _0x1cb485=0xa,_0x4a7774=_0x136e30*(0x1-_0x1cb485/0x64);await database_1['default'][_0x2008c9(0x129)][_0x2008c9(0x146)]({'where':{'id':_0x415c9b['shopId']},'data':{'balance':{'increment':_0x4a7774}}}),console[_0x2008c9(0x150)](_0x2008c9(0x121)+_0x4a7774[_0x2008c9(0x136)](0x6)+_0x2008c9(0x139)+_0x1cb485+_0x2008c9(0x169));}catch(_0x3d5a30){console[_0x2008c9(0x126)](_0x2008c9(0x16b),_0x3d5a30);}}async[a12_0xf264e0(0x141)](_0x28deb0,_0x2817cb){var _0x5426a0=a12_0xf264e0;try{const {id:_0x4be552}=_0x28deb0['params'];if(!_0x4be552){_0x2817cb[_0x5426a0(0x11e)](0x190)[_0x5426a0(0x13b)]({'success':![],'message':_0x5426a0(0x122)});return;}console['log'](_0x5426a0(0x157)+_0x4be552);const _0x41bbf0=await database_1['default'][_0x5426a0(0x120)]['findFirst']({'where':{'OR':[{'id':_0x4be552},{'orderId':_0x4be552},{'gatewayOrderId':_0x4be552},{'gatewayPaymentId':_0x4be552}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x41bbf0){_0x2817cb[_0x5426a0(0x11e)](0x194)[_0x5426a0(0x13b)]({'success':![],'message':_0x5426a0(0x13d)});return;}console[_0x5426a0(0x150)](_0x5426a0(0x12d)+_0x41bbf0['id']+'\x20('+_0x41bbf0[_0x5426a0(0x11e)]+')'),_0x2817cb['json']({'success':!![],'data':{'id':_0x41bbf0['id'],'gateway':_0x41bbf0[_0x5426a0(0x13c)],'amount':_0x41bbf0['amount'],'currency':_0x41bbf0['currency'],'status':_0x41bbf0[_0x5426a0(0x11e)],'gatewayOrderId':_0x41bbf0['gatewayOrderId'],'gatewayPaymentId':_0x41bbf0[_0x5426a0(0x167)],'successUrl':_0x41bbf0[_0x5426a0(0x12a)],'failUrl':_0x41bbf0[_0x5426a0(0x13a)],'pendingUrl':_0x41bbf0['pendingUrl'],'customerEmail':_0x41bbf0[_0x5426a0(0x14c)],'customerName':_0x41bbf0[_0x5426a0(0x130)],'merchantBrand':_0x41bbf0[_0x5426a0(0x129)][_0x5426a0(0x153)],'createdAt':_0x41bbf0[_0x5426a0(0x140)],'updatedAt':_0x41bbf0[_0x5426a0(0x124)]}});}catch(_0x5ea5e9){console['error']('‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:',_0x5ea5e9),_0x2817cb[_0x5426a0(0x11e)](0x1f4)[_0x5426a0(0x13b)]({'success':![],'message':_0x5426a0(0x165),'error':_0x5ea5e9 instanceof Error?_0x5ea5e9[_0x5426a0(0x14e)]:_0x5426a0(0x14b)});}}}function a12_0x584c(){var _0xfe2d46=['‚ùå\x20OnRamp\x20status\x20update\x20error:','4XsXWZZ','findFirst','Payment\x20status\x20updated\x20successfully','24845950YdpPhw','toUpperCase','‚úÖ\x20OnRamp\x20payment\x20','getOwnPropertyDescriptor','üìù\x20Data:','2144436lerxeT','Internal\x20server\x20error','currency','gatewayPaymentId','writable','%\x20commission)','__importDefault','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','676187MGMMlS','status','../services/currencyService','payment','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','Payment\x20ID\x20is\x20required','configurable','updatedAt','amount','error','hasOwnProperty','defineProperty','shop','successUrl','632114nMAECP','length','‚úÖ\x20Found\x20payment:\x20','1869612AnCwdU','invoiceTotalSum','customerName','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','default','convertToUSDT','create','PAID','toFixed','onramp','getOwnPropertyNames','\x20USDT\x20(after\x20','failUrl','json','gateway','Payment\x20not\x20found','\x20updated\x20to\x20','__esModule','createdAt','getPaymentData','onramp_system','12453597YtiCWo','üöÄ\x20OnRamp\x20status\x20update:\x20','../config/database','update','updateMerchantBalanceForPaidPayment','78rsLGVJ','body','Payment\x20ID\x20and\x20status\x20are\x20required','Unknown\x20error','customerEmail','USD','message','gatewayOrderId','log','prototype','OnRampController','name','__importStar','resolve','7764232ZyQgEf','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','5qOHFEu','call'];a12_0x584c=function(){return _0xfe2d46;};return a12_0x584c();}exports[a12_0xf264e0(0x152)]=OnRampController;