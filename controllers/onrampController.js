'use strict';var a11_0x946bee=a11_0x16dd;function a11_0x16dd(_0x586efc,_0x4e79e4){_0x586efc=_0x586efc-0x130;var _0x313aa7=a11_0x313a();var _0x16dde8=_0x313aa7[_0x586efc];return _0x16dde8;}(function(_0x4e9796,_0x124f64){var _0x43e1d6=a11_0x16dd,_0x3c8558=_0x4e9796();while(!![]){try{var _0x1fae28=parseInt(_0x43e1d6(0x155))/0x1*(parseInt(_0x43e1d6(0x144))/0x2)+parseInt(_0x43e1d6(0x149))/0x3*(parseInt(_0x43e1d6(0x13d))/0x4)+parseInt(_0x43e1d6(0x13c))/0x5+parseInt(_0x43e1d6(0x14f))/0x6+parseInt(_0x43e1d6(0x148))/0x7+parseInt(_0x43e1d6(0x13b))/0x8+-parseInt(_0x43e1d6(0x16f))/0x9*(parseInt(_0x43e1d6(0x170))/0xa);if(_0x1fae28===_0x124f64)break;else _0x3c8558['push'](_0x3c8558['shift']());}catch(_0x49b0d9){_0x3c8558['push'](_0x3c8558['shift']());}}}(a11_0x313a,0xba934));function a11_0x313a(){var _0x36c10b=['hasOwnProperty','status','call','default','invoiceTotalSum','4283256bYCakr','Payment\x20not\x20found','createdAt','json','body','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','1UWmsDX','üìù\x20Data:','gatewayPaymentId','pendingUrl','updatePaymentStatus','Internal\x20server\x20error','getOwnPropertyDescriptor','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','Unknown\x20error','successUrl','updateMerchantBalanceForPaidPayment','defineProperty','currency','shop','%\x20commission)','Payment\x20ID\x20and\x20status\x20are\x20required','‚ùå\x20OnRamp\x20status\x20update\x20error:','error','__esModule','length','customerEmail','onramp_system','prototype','resolve','log','USD','27TbzvRL','12106670WJiYcP','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','updatedAt','shopId','../services/currencyService','OnRampController','gatewayOrderId','amount','create','__setModuleDefault','get','Payment\x20status\x20updated\x20successfully','\x20USDT\x20(after\x20','Payment\x20ID\x20is\x20required','üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20','PAID','payment','findFirst','writable','__importDefault','4881312xJYxwk','1122985ZVmTYG','2532KlSOPU','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','‚úÖ\x20OnRamp\x20payment\x20','toFixed','message','getPaymentData','\x20updated\x20to\x20','1590934QcFnCM','__createBinding','toUpperCase','update','10336984jcHmrt','2727XkdlJw'];a11_0x313a=function(){return _0x36c10b;};return a11_0x313a();}var __createBinding=this&&this[a11_0x946bee(0x145)]||(Object[a11_0x946bee(0x178)]?function(_0x334659,_0x4a23a2,_0x25fb40,_0x497162){var _0x51e287=a11_0x946bee;if(_0x497162===undefined)_0x497162=_0x25fb40;var _0x553085=Object[_0x51e287(0x15b)](_0x4a23a2,_0x25fb40);(!_0x553085||(_0x51e287(0x131)in _0x553085?!_0x4a23a2[_0x51e287(0x167)]:_0x553085[_0x51e287(0x139)]||_0x553085['configurable']))&&(_0x553085={'enumerable':!![],'get':function(){return _0x4a23a2[_0x25fb40];}}),Object[_0x51e287(0x160)](_0x334659,_0x497162,_0x553085);}:function(_0x476812,_0x5a8e63,_0x533250,_0x5476fa){if(_0x5476fa===undefined)_0x5476fa=_0x533250;_0x476812[_0x5476fa]=_0x5a8e63[_0x533250];}),__setModuleDefault=this&&this[a11_0x946bee(0x130)]||(Object['create']?function(_0x32fff6,_0x3e3f7f){Object['defineProperty'](_0x32fff6,'default',{'enumerable':!![],'value':_0x3e3f7f});}:function(_0x3428f2,_0x434bee){var _0x32b045=a11_0x946bee;_0x3428f2[_0x32b045(0x14d)]=_0x434bee;}),__importStar=this&&this['__importStar']||(function(){var _0x5bcaf8=function(_0x13228e){return _0x5bcaf8=Object['getOwnPropertyNames']||function(_0x6c3282){var _0x40a596=a11_0x16dd,_0x4dd69b=[];for(var _0x308638 in _0x6c3282)if(Object[_0x40a596(0x16b)][_0x40a596(0x14a)][_0x40a596(0x14c)](_0x6c3282,_0x308638))_0x4dd69b[_0x4dd69b[_0x40a596(0x168)]]=_0x308638;return _0x4dd69b;},_0x5bcaf8(_0x13228e);};return function(_0x30e8e4){var _0x43bed7=a11_0x16dd;if(_0x30e8e4&&_0x30e8e4[_0x43bed7(0x167)])return _0x30e8e4;var _0x922f6f={};if(_0x30e8e4!=null){for(var _0x23ce7f=_0x5bcaf8(_0x30e8e4),_0x4a473c=0x0;_0x4a473c<_0x23ce7f[_0x43bed7(0x168)];_0x4a473c++)if(_0x23ce7f[_0x4a473c]!==_0x43bed7(0x14d))__createBinding(_0x922f6f,_0x30e8e4,_0x23ce7f[_0x4a473c]);}return __setModuleDefault(_0x922f6f,_0x30e8e4),_0x922f6f;};}()),__importDefault=this&&this[a11_0x946bee(0x13a)]||function(_0x4e46){var _0x445d01=a11_0x946bee;return _0x4e46&&_0x4e46[_0x445d01(0x167)]?_0x4e46:{'default':_0x4e46};};Object[a11_0x946bee(0x160)](exports,'__esModule',{'value':!![]}),exports[a11_0x946bee(0x175)]=void 0x0;const database_1=__importDefault(require('../config/database'));class OnRampController{async[a11_0x946bee(0x159)](_0xcfd7b1,_0x12f624){var _0x53ee4c=a11_0x946bee;try{const {paymentId:_0x5ce960,status:_0xfab71b,referenceId:_0x464da0,transactionHash:_0x4ca531,actualCryptoAmount:_0x5879d3,orderId:_0x2f2a9c}=_0xcfd7b1[_0x53ee4c(0x153)];if(!_0x5ce960||!_0xfab71b){_0x12f624[_0x53ee4c(0x14b)](0x190)[_0x53ee4c(0x152)]({'success':![],'message':_0x53ee4c(0x164)});return;}console['log']('üöÄ\x20OnRamp\x20status\x20update:\x20'+_0x5ce960+'\x20->\x20'+_0xfab71b),console['log'](_0x53ee4c(0x156),{'referenceId':_0x464da0,'transactionHash':_0x4ca531,'actualCryptoAmount':_0x5879d3,'orderId':_0x2f2a9c});const _0x2b1fac=await database_1[_0x53ee4c(0x14d)][_0x53ee4c(0x137)]['findFirst']({'where':{'OR':[{'id':_0x5ce960},{'orderId':_0x5ce960},{'gatewayOrderId':_0x5ce960},{'gatewayPaymentId':_0x5ce960}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2b1fac){_0x12f624[_0x53ee4c(0x14b)](0x194)[_0x53ee4c(0x152)]({'success':![],'message':_0x53ee4c(0x150)});return;}if(_0x2b1fac['gateway']!=='onramp'){_0x12f624[_0x53ee4c(0x14b)](0x190)[_0x53ee4c(0x152)]({'success':![],'message':'This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway'});return;}const _0x16d675={'status':_0xfab71b[_0x53ee4c(0x146)](),'statusChangedAt':new Date(),'statusChangedBy':_0x53ee4c(0x16a)};_0x464da0&&(_0x16d675[_0x53ee4c(0x176)]=_0x464da0);_0x4ca531&&(_0x16d675[_0x53ee4c(0x157)]=_0x4ca531);_0x5879d3&&(_0x16d675[_0x53ee4c(0x14e)]=_0x5879d3);const _0xf6363b=await database_1[_0x53ee4c(0x14d)][_0x53ee4c(0x137)][_0x53ee4c(0x147)]({'where':{'id':_0x2b1fac['id']},'data':_0x16d675});console[_0x53ee4c(0x16d)](_0x53ee4c(0x13f)+_0x2b1fac['id']+_0x53ee4c(0x143)+_0xfab71b),_0xfab71b['toUpperCase']()===_0x53ee4c(0x136)&&_0x2b1fac[_0x53ee4c(0x14b)]!==_0x53ee4c(0x136)&&await this['updateMerchantBalanceForPaidPayment'](_0x2b1fac),_0x12f624[_0x53ee4c(0x152)]({'success':!![],'message':_0x53ee4c(0x132),'data':{'paymentId':_0xf6363b['id'],'status':_0xf6363b[_0x53ee4c(0x14b)],'referenceId':_0x464da0,'transactionHash':_0x4ca531,'actualCryptoAmount':_0x5879d3}});}catch(_0x130e82){console[_0x53ee4c(0x166)](_0x53ee4c(0x165),_0x130e82),_0x12f624[_0x53ee4c(0x14b)](0x1f4)[_0x53ee4c(0x152)]({'success':![],'message':_0x53ee4c(0x15a),'error':_0x130e82 instanceof Error?_0x130e82[_0x53ee4c(0x141)]:_0x53ee4c(0x15d)});}}async[a11_0x946bee(0x15f)](_0x59bfdf){var _0x417b0b=a11_0x946bee;try{console['log'](_0x417b0b(0x13e)+_0x59bfdf['id']);let _0x5f0bab;if(_0x59bfdf[_0x417b0b(0x161)]===_0x417b0b(0x16e))_0x5f0bab=_0x59bfdf['amount'];else{const {currencyService:_0xbfcd34}=await Promise[_0x417b0b(0x16c)]()['then'](()=>__importStar(require(_0x417b0b(0x174))));_0x5f0bab=await _0xbfcd34['convertToUSDT'](_0x59bfdf[_0x417b0b(0x177)],_0x59bfdf[_0x417b0b(0x161)]);}await database_1[_0x417b0b(0x14d)][_0x417b0b(0x137)]['update']({'where':{'id':_0x59bfdf['id']},'data':{'amountUSDT':_0x5f0bab,'paidAt':new Date()}});const _0x1893d3=0xa,_0x428c86=_0x5f0bab*(0x1-_0x1893d3/0x64);await database_1[_0x417b0b(0x14d)][_0x417b0b(0x162)][_0x417b0b(0x147)]({'where':{'id':_0x59bfdf[_0x417b0b(0x173)]},'data':{'balance':{'increment':_0x428c86}}}),console[_0x417b0b(0x16d)](_0x417b0b(0x171)+_0x428c86[_0x417b0b(0x140)](0x6)+_0x417b0b(0x133)+_0x1893d3+_0x417b0b(0x163));}catch(_0x390272){console[_0x417b0b(0x166)](_0x417b0b(0x154),_0x390272);}}async[a11_0x946bee(0x142)](_0x36f179,_0xfd5c30){var _0xc5b273=a11_0x946bee;try{const {id:_0xa00028}=_0x36f179['params'];if(!_0xa00028){_0xfd5c30[_0xc5b273(0x14b)](0x190)[_0xc5b273(0x152)]({'success':![],'message':_0xc5b273(0x134)});return;}console[_0xc5b273(0x16d)](_0xc5b273(0x135)+_0xa00028);const _0x1d2076=await database_1[_0xc5b273(0x14d)][_0xc5b273(0x137)][_0xc5b273(0x138)]({'where':{'OR':[{'id':_0xa00028},{'orderId':_0xa00028},{'gatewayOrderId':_0xa00028},{'gatewayPaymentId':_0xa00028}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x1d2076){_0xfd5c30[_0xc5b273(0x14b)](0x194)['json']({'success':![],'message':_0xc5b273(0x150)});return;}console['log']('‚úÖ\x20Found\x20payment:\x20'+_0x1d2076['id']+'\x20('+_0x1d2076[_0xc5b273(0x14b)]+')'),_0xfd5c30[_0xc5b273(0x152)]({'success':!![],'data':{'id':_0x1d2076['id'],'gateway':_0x1d2076['gateway'],'amount':_0x1d2076['amount'],'currency':_0x1d2076['currency'],'status':_0x1d2076['status'],'gatewayOrderId':_0x1d2076[_0xc5b273(0x176)],'gatewayPaymentId':_0x1d2076[_0xc5b273(0x157)],'successUrl':_0x1d2076[_0xc5b273(0x15e)],'failUrl':_0x1d2076['failUrl'],'pendingUrl':_0x1d2076[_0xc5b273(0x158)],'customerEmail':_0x1d2076[_0xc5b273(0x169)],'customerName':_0x1d2076['customerName'],'merchantBrand':_0x1d2076[_0xc5b273(0x162)]['name'],'createdAt':_0x1d2076[_0xc5b273(0x151)],'updatedAt':_0x1d2076[_0xc5b273(0x172)]}});}catch(_0x4bb867){console[_0xc5b273(0x166)](_0xc5b273(0x15c),_0x4bb867),_0xfd5c30[_0xc5b273(0x14b)](0x1f4)[_0xc5b273(0x152)]({'success':![],'message':_0xc5b273(0x15a),'error':_0x4bb867 instanceof Error?_0x4bb867['message']:'Unknown\x20error'});}}}exports[a11_0x946bee(0x175)]=OnRampController;