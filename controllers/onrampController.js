'use strict';var a9_0x9db442=a9_0x2f4e;(function(_0x15943f,_0xe3b04c){var _0x1b63bf=a9_0x2f4e,_0x4e683e=_0x15943f();while(!![]){try{var _0x13ccca=-parseInt(_0x1b63bf(0x187))/0x1*(-parseInt(_0x1b63bf(0x15a))/0x2)+parseInt(_0x1b63bf(0x184))/0x3+-parseInt(_0x1b63bf(0x17c))/0x4*(-parseInt(_0x1b63bf(0x17e))/0x5)+-parseInt(_0x1b63bf(0x14d))/0x6+-parseInt(_0x1b63bf(0x14c))/0x7+-parseInt(_0x1b63bf(0x158))/0x8*(-parseInt(_0x1b63bf(0x157))/0x9)+-parseInt(_0x1b63bf(0x162))/0xa;if(_0x13ccca===_0xe3b04c)break;else _0x4e683e['push'](_0x4e683e['shift']());}catch(_0x5e776e){_0x4e683e['push'](_0x4e683e['shift']());}}}(a9_0x2bd8,0x80306));function a9_0x2bd8(){var _0x4ef37e=['Payment\x20status\x20updated\x20successfully','9rjoqil','üí∞\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20','call','update','‚ùå\x20OnRamp\x20get\x20payment\x20data\x20error:','getOwnPropertyDescriptor','onramp','hasOwnProperty','updatePaymentStatus','‚úÖ\x20Merchant\x20balance\x20updated:\x20+','updatedAt','‚úÖ\x20Found\x20payment:\x20','convertToUSDT','‚ùå\x20Failed\x20to\x20update\x20merchant\x20balance:','currency','pendingUrl','611709EDqHug','4576902npetyx','üöÄ\x20OnRamp\x20status\x20update:\x20','json','__esModule','USD','PAID','This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway','gateway','body','shop','90iojERp','607304wnQkNQ','error','233098iuKjWu','getOwnPropertyNames','create','get','length','amount','params','gatewayOrderId','10169160qHkyje','toUpperCase','invoiceTotalSum','name','payment','findFirst','‚úÖ\x20OnRamp\x20payment\x20','toFixed','onramp_system','Internal\x20server\x20error','Unknown\x20error','createdAt','__importDefault','status','gatewayPaymentId','defineProperty','OnRampController','Payment\x20ID\x20is\x20required','updateMerchantBalanceForPaidPayment','Payment\x20ID\x20and\x20status\x20are\x20required','\x20->\x20','default','../config/database','configurable','Payment\x20not\x20found','writable','1684fbyPJS','\x20updated\x20to\x20','3965gDXiwT','message','%\x20commission)','log','then','customerEmail','750774zlDLeD','shopId'];a9_0x2bd8=function(){return _0x4ef37e;};return a9_0x2bd8();}var __createBinding=this&&this['__createBinding']||(Object[a9_0x9db442(0x15c)]?function(_0x5e8adb,_0x8a35dc,_0x4c0e4d,_0x37130f){var _0x42dd20=a9_0x9db442;if(_0x37130f===undefined)_0x37130f=_0x4c0e4d;var _0x3ae8c6=Object[_0x42dd20(0x18c)](_0x8a35dc,_0x4c0e4d);(!_0x3ae8c6||(_0x42dd20(0x15d)in _0x3ae8c6?!_0x8a35dc['__esModule']:_0x3ae8c6[_0x42dd20(0x17b)]||_0x3ae8c6[_0x42dd20(0x179)]))&&(_0x3ae8c6={'enumerable':!![],'get':function(){return _0x8a35dc[_0x4c0e4d];}}),Object['defineProperty'](_0x5e8adb,_0x37130f,_0x3ae8c6);}:function(_0x3087a6,_0x3ebfc7,_0x1a9d0e,_0x3b3560){if(_0x3b3560===undefined)_0x3b3560=_0x1a9d0e;_0x3087a6[_0x3b3560]=_0x3ebfc7[_0x1a9d0e];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a9_0x9db442(0x15c)]?function(_0x35c185,_0x297363){var _0x4ae2a1=a9_0x9db442;Object[_0x4ae2a1(0x171)](_0x35c185,_0x4ae2a1(0x177),{'enumerable':!![],'value':_0x297363});}:function(_0x1c4a0b,_0x1761c2){_0x1c4a0b['default']=_0x1761c2;}),__importStar=this&&this['__importStar']||(function(){var _0x4f4b04=function(_0x151cd1){var _0x3f920a=a9_0x2f4e;return _0x4f4b04=Object[_0x3f920a(0x15b)]||function(_0x4b3649){var _0x3072b9=_0x3f920a,_0x1b82d7=[];for(var _0x56fa16 in _0x4b3649)if(Object['prototype'][_0x3072b9(0x143)][_0x3072b9(0x189)](_0x4b3649,_0x56fa16))_0x1b82d7[_0x1b82d7[_0x3072b9(0x15e)]]=_0x56fa16;return _0x1b82d7;},_0x4f4b04(_0x151cd1);};return function(_0x5780f3){var _0x4e8465=a9_0x2f4e;if(_0x5780f3&&_0x5780f3[_0x4e8465(0x150)])return _0x5780f3;var _0x15342d={};if(_0x5780f3!=null){for(var _0x336bab=_0x4f4b04(_0x5780f3),_0xac9a9d=0x0;_0xac9a9d<_0x336bab[_0x4e8465(0x15e)];_0xac9a9d++)if(_0x336bab[_0xac9a9d]!==_0x4e8465(0x177))__createBinding(_0x15342d,_0x5780f3,_0x336bab[_0xac9a9d]);}return __setModuleDefault(_0x15342d,_0x5780f3),_0x15342d;};}()),__importDefault=this&&this[a9_0x9db442(0x16e)]||function(_0x3bf9f6){return _0x3bf9f6&&_0x3bf9f6['__esModule']?_0x3bf9f6:{'default':_0x3bf9f6};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a9_0x9db442(0x172)]=void 0x0;const database_1=__importDefault(require(a9_0x9db442(0x178)));function a9_0x2f4e(_0x466cf6,_0x11f9d5){var _0x2bd825=a9_0x2bd8();return a9_0x2f4e=function(_0x2f4ea0,_0x57102c){_0x2f4ea0=_0x2f4ea0-0x143;var _0x5271e8=_0x2bd825[_0x2f4ea0];return _0x5271e8;},a9_0x2f4e(_0x466cf6,_0x11f9d5);}class OnRampController{async[a9_0x9db442(0x144)](_0x14ea0c,_0x364c10){var _0x42d024=a9_0x9db442;try{const {paymentId:_0x1e84a4,status:_0x1de1cf,referenceId:_0x295b67,transactionHash:_0x393f00,actualCryptoAmount:_0x1e2c67,orderId:_0x49f9e9}=_0x14ea0c[_0x42d024(0x155)];if(!_0x1e84a4||!_0x1de1cf){_0x364c10[_0x42d024(0x16f)](0x190)[_0x42d024(0x14f)]({'success':![],'message':_0x42d024(0x175)});return;}console['log'](_0x42d024(0x14e)+_0x1e84a4+_0x42d024(0x176)+_0x1de1cf),console['log']('üìù\x20Data:',{'referenceId':_0x295b67,'transactionHash':_0x393f00,'actualCryptoAmount':_0x1e2c67,'orderId':_0x49f9e9});const _0x324872=await database_1['default'][_0x42d024(0x166)]['findFirst']({'where':{'OR':[{'id':_0x1e84a4},{'orderId':_0x1e84a4},{'gatewayOrderId':_0x1e84a4},{'gatewayPaymentId':_0x1e84a4}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x324872){_0x364c10[_0x42d024(0x16f)](0x194)[_0x42d024(0x14f)]({'success':![],'message':_0x42d024(0x17a)});return;}if(_0x324872[_0x42d024(0x154)]!==_0x42d024(0x18d)){_0x364c10[_0x42d024(0x16f)](0x190)[_0x42d024(0x14f)]({'success':![],'message':_0x42d024(0x153)});return;}const _0x25044e={'status':_0x1de1cf[_0x42d024(0x163)](),'statusChangedAt':new Date(),'statusChangedBy':_0x42d024(0x16a)};_0x295b67&&(_0x25044e[_0x42d024(0x161)]=_0x295b67);_0x393f00&&(_0x25044e['gatewayPaymentId']=_0x393f00);_0x1e2c67&&(_0x25044e[_0x42d024(0x164)]=_0x1e2c67);const _0x4f12c2=await database_1[_0x42d024(0x177)][_0x42d024(0x166)]['update']({'where':{'id':_0x324872['id']},'data':_0x25044e});console['log'](_0x42d024(0x168)+_0x324872['id']+_0x42d024(0x17d)+_0x1de1cf),_0x1de1cf['toUpperCase']()===_0x42d024(0x152)&&_0x324872[_0x42d024(0x16f)]!=='PAID'&&await this[_0x42d024(0x174)](_0x324872),_0x364c10[_0x42d024(0x14f)]({'success':!![],'message':_0x42d024(0x186),'data':{'paymentId':_0x4f12c2['id'],'status':_0x4f12c2[_0x42d024(0x16f)],'referenceId':_0x295b67,'transactionHash':_0x393f00,'actualCryptoAmount':_0x1e2c67}});}catch(_0x368b77){console[_0x42d024(0x159)]('‚ùå\x20OnRamp\x20status\x20update\x20error:',_0x368b77),_0x364c10[_0x42d024(0x16f)](0x1f4)[_0x42d024(0x14f)]({'success':![],'message':_0x42d024(0x16b),'error':_0x368b77 instanceof Error?_0x368b77['message']:_0x42d024(0x16c)});}}async['updateMerchantBalanceForPaidPayment'](_0x2db5a4){var _0x4f8643=a9_0x9db442;try{console[_0x4f8643(0x181)](_0x4f8643(0x188)+_0x2db5a4['id']);let _0x955dc5;if(_0x2db5a4['currency']===_0x4f8643(0x151))_0x955dc5=_0x2db5a4[_0x4f8643(0x15f)];else{const {currencyService:_0x2ab102}=await Promise['resolve']()[_0x4f8643(0x182)](()=>__importStar(require('../services/currencyService')));_0x955dc5=await _0x2ab102[_0x4f8643(0x148)](_0x2db5a4[_0x4f8643(0x15f)],_0x2db5a4[_0x4f8643(0x14a)]);}await database_1[_0x4f8643(0x177)]['payment'][_0x4f8643(0x18a)]({'where':{'id':_0x2db5a4['id']},'data':{'amountUSDT':_0x955dc5,'paidAt':new Date()}});const _0x41dcdd=0xa,_0x33ccb5=_0x955dc5*(0x1-_0x41dcdd/0x64);await database_1['default'][_0x4f8643(0x156)]['update']({'where':{'id':_0x2db5a4[_0x4f8643(0x185)]},'data':{'balance':{'increment':_0x33ccb5}}}),console[_0x4f8643(0x181)](_0x4f8643(0x145)+_0x33ccb5[_0x4f8643(0x169)](0x6)+'\x20USDT\x20(after\x20'+_0x41dcdd+_0x4f8643(0x180));}catch(_0x7eac98){console[_0x4f8643(0x159)](_0x4f8643(0x149),_0x7eac98);}}async['getPaymentData'](_0x28d574,_0x1c8b5a){var _0x5e555c=a9_0x9db442;try{const {id:_0x3487a9}=_0x28d574[_0x5e555c(0x160)];if(!_0x3487a9){_0x1c8b5a[_0x5e555c(0x16f)](0x190)[_0x5e555c(0x14f)]({'success':![],'message':_0x5e555c(0x173)});return;}console['log']('üîç\x20Getting\x20OnRamp\x20payment\x20data:\x20'+_0x3487a9);const _0x43c67f=await database_1['default'][_0x5e555c(0x166)][_0x5e555c(0x167)]({'where':{'OR':[{'id':_0x3487a9},{'orderId':_0x3487a9},{'gatewayOrderId':_0x3487a9},{'gatewayPaymentId':_0x3487a9}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x43c67f){_0x1c8b5a['status'](0x194)['json']({'success':![],'message':_0x5e555c(0x17a)});return;}console[_0x5e555c(0x181)](_0x5e555c(0x147)+_0x43c67f['id']+'\x20('+_0x43c67f[_0x5e555c(0x16f)]+')'),_0x1c8b5a['json']({'success':!![],'data':{'id':_0x43c67f['id'],'gateway':_0x43c67f[_0x5e555c(0x154)],'amount':_0x43c67f[_0x5e555c(0x15f)],'currency':_0x43c67f['currency'],'status':_0x43c67f['status'],'gatewayOrderId':_0x43c67f[_0x5e555c(0x161)],'gatewayPaymentId':_0x43c67f[_0x5e555c(0x170)],'successUrl':_0x43c67f['successUrl'],'failUrl':_0x43c67f['failUrl'],'pendingUrl':_0x43c67f[_0x5e555c(0x14b)],'customerEmail':_0x43c67f[_0x5e555c(0x183)],'customerName':_0x43c67f['customerName'],'merchantBrand':_0x43c67f[_0x5e555c(0x156)][_0x5e555c(0x165)],'createdAt':_0x43c67f[_0x5e555c(0x16d)],'updatedAt':_0x43c67f[_0x5e555c(0x146)]}});}catch(_0x5a56aa){console[_0x5e555c(0x159)](_0x5e555c(0x18b),_0x5a56aa),_0x1c8b5a[_0x5e555c(0x16f)](0x1f4)['json']({'success':![],'message':_0x5e555c(0x16b),'error':_0x5a56aa instanceof Error?_0x5a56aa[_0x5e555c(0x17f)]:'Unknown\x20error'});}}}exports[a9_0x9db442(0x172)]=OnRampController;