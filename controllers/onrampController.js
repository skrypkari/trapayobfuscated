'use strict';var a9_0x2bf153=a9_0x2a94;(function(_0xad4cde,_0x2c9c04){var _0x189b27=a9_0x2a94,_0xbb65ce=_0xad4cde();while(!![]){try{var _0x43c2e9=parseInt(_0x189b27(0xe0))/0x1*(parseInt(_0x189b27(0xe1))/0x2)+-parseInt(_0x189b27(0xf6))/0x3*(-parseInt(_0x189b27(0xe6))/0x4)+parseInt(_0x189b27(0xda))/0x5+parseInt(_0x189b27(0xd8))/0x6+-parseInt(_0x189b27(0xf2))/0x7*(-parseInt(_0x189b27(0xcb))/0x8)+parseInt(_0x189b27(0xe9))/0x9*(parseInt(_0x189b27(0xdf))/0xa)+-parseInt(_0x189b27(0xc1))/0xb;if(_0x43c2e9===_0x2c9c04)break;else _0xbb65ce['push'](_0xbb65ce['shift']());}catch(_0x396719){_0xbb65ce['push'](_0xbb65ce['shift']());}}}(a9_0xd342,0x32c50));function a9_0x2a94(_0xbe01cb,_0xa7d9eb){var _0xd342=a9_0xd342();return a9_0x2a94=function(_0x2a94f5,_0x587cc6){_0x2a94f5=_0x2a94f5-0xad;var _0x5d1653=_0xd342[_0x2a94f5];return _0x5d1653;},a9_0x2a94(_0xbe01cb,_0xa7d9eb);}var __createBinding=this&&this['__createBinding']||(Object[a9_0x2bf153(0xb3)]?function(_0x1e3954,_0x1abf1e,_0x26c6af,_0x30e0b4){var _0x116c12=a9_0x2bf153;if(_0x30e0b4===undefined)_0x30e0b4=_0x26c6af;var _0x2db8a5=Object[_0x116c12(0xad)](_0x1abf1e,_0x26c6af);(!_0x2db8a5||(_0x116c12(0xd9)in _0x2db8a5?!_0x1abf1e[_0x116c12(0xcf)]:_0x2db8a5[_0x116c12(0xb1)]||_0x2db8a5['configurable']))&&(_0x2db8a5={'enumerable':!![],'get':function(){return _0x1abf1e[_0x26c6af];}}),Object[_0x116c12(0xe8)](_0x1e3954,_0x30e0b4,_0x2db8a5);}:function(_0x58f47d,_0x565065,_0x2517d1,_0x49536b){if(_0x49536b===undefined)_0x49536b=_0x2517d1;_0x58f47d[_0x49536b]=_0x565065[_0x2517d1];}),__setModuleDefault=this&&this[a9_0x2bf153(0xc4)]||(Object[a9_0x2bf153(0xb3)]?function(_0x325c46,_0x5c3d4f){var _0x47cf83=a9_0x2bf153;Object[_0x47cf83(0xe8)](_0x325c46,_0x47cf83(0xb8),{'enumerable':!![],'value':_0x5c3d4f});}:function(_0x35dfb,_0x5c10f2){var _0x3ad7fb=a9_0x2bf153;_0x35dfb[_0x3ad7fb(0xb8)]=_0x5c10f2;}),__importStar=this&&this[a9_0x2bf153(0xc3)]||(function(){var _0x188ece=function(_0x4c2bf2){var _0x187fbe=a9_0x2a94;return _0x188ece=Object[_0x187fbe(0xec)]||function(_0x2c4a9a){var _0x3680cc=_0x187fbe,_0x960b14=[];for(var _0x3846c9 in _0x2c4a9a)if(Object['prototype']['hasOwnProperty'][_0x3680cc(0xe4)](_0x2c4a9a,_0x3846c9))_0x960b14[_0x960b14['length']]=_0x3846c9;return _0x960b14;},_0x188ece(_0x4c2bf2);};return function(_0x27e21c){var _0x61a27b=a9_0x2a94;if(_0x27e21c&&_0x27e21c['__esModule'])return _0x27e21c;var _0x2bfdc1={};if(_0x27e21c!=null){for(var _0x354553=_0x188ece(_0x27e21c),_0x561844=0x0;_0x561844<_0x354553[_0x61a27b(0xc7)];_0x561844++)if(_0x354553[_0x561844]!=='default')__createBinding(_0x2bfdc1,_0x27e21c,_0x354553[_0x561844]);}return __setModuleDefault(_0x2bfdc1,_0x27e21c),_0x2bfdc1;};}()),__importDefault=this&&this['__importDefault']||function(_0x1f0cca){return _0x1f0cca&&_0x1f0cca['__esModule']?_0x1f0cca:{'default':_0x1f0cca};};Object['defineProperty'](exports,a9_0x2bf153(0xcf),{'value':!![]}),exports[a9_0x2bf153(0xc2)]=void 0x0;const database_1=__importDefault(require(a9_0x2bf153(0xd1)));function a9_0xd342(){var _0x13223d=['375327HbBEIB','updatedAt','json','getOwnPropertyDescriptor','Payment\x20status\x20updated\x20successfully','Payment\x20ID\x20is\x20required','❌\x20OnRamp\x20get\x20payment\x20data\x20error:','writable','findFirst','create','Internal\x20server\x20error','name','failUrl','\x20updated\x20to\x20','default','updatePaymentStatus','gatewayPaymentId','🚀\x20OnRamp\x20status\x20update:\x20','🔍\x20Getting\x20OnRamp\x20payment\x20data:\x20','successUrl','gateway','onramp','getPaymentData','10559120sjaLic','OnRampController','__importStar','__setModuleDefault','shop','❌\x20OnRamp\x20status\x20update\x20error:','length','then','updateMerchantBalanceForPaidPayment','Payment\x20not\x20found','9272CGpqZt','USD','Payment\x20ID\x20and\x20status\x20are\x20required','PAID','__esModule','customerEmail','../config/database','status','shopId','convertToUSDT','body','amount','\x20USDT\x20(after\x20','1611492WdLCeZ','get','484735qIwFeV','payment','params','gatewayOrderId','onramp_system','200CbOnBa','807gDaNqM','566DmxlQu','%\x20commission)','\x20->\x20','call','log','4CPNICZ','Unknown\x20error','defineProperty','135747RTtiBv','../services/currencyService','customerName','getOwnPropertyNames','currency','📝\x20Data:','❌\x20Failed\x20to\x20update\x20merchant\x20balance:','error','invoiceTotalSum','889BvRwAg','✅\x20Merchant\x20balance\x20updated:\x20+','✅\x20OnRamp\x20payment\x20','toUpperCase'];a9_0xd342=function(){return _0x13223d;};return a9_0xd342();}class OnRampController{async[a9_0x2bf153(0xb9)](_0x165bbf,_0x4845c8){var _0x2392f7=a9_0x2bf153;try{const {paymentId:_0x4ff9ed,status:_0x4b2bf5,referenceId:_0x4f49e6,transactionHash:_0x2c9148,actualCryptoAmount:_0x5c63da,orderId:_0x4b5db1}=_0x165bbf[_0x2392f7(0xd5)];if(!_0x4ff9ed||!_0x4b2bf5){_0x4845c8[_0x2392f7(0xd2)](0x190)[_0x2392f7(0xf8)]({'success':![],'message':_0x2392f7(0xcd)});return;}console[_0x2392f7(0xe5)](_0x2392f7(0xbb)+_0x4ff9ed+_0x2392f7(0xe3)+_0x4b2bf5),console['log'](_0x2392f7(0xee),{'referenceId':_0x4f49e6,'transactionHash':_0x2c9148,'actualCryptoAmount':_0x5c63da,'orderId':_0x4b5db1});const _0x3ebccd=await database_1['default'][_0x2392f7(0xdb)][_0x2392f7(0xb2)]({'where':{'OR':[{'id':_0x4ff9ed},{'orderId':_0x4ff9ed},{'gatewayOrderId':_0x4ff9ed},{'gatewayPaymentId':_0x4ff9ed}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3ebccd){_0x4845c8['status'](0x194)[_0x2392f7(0xf8)]({'success':![],'message':_0x2392f7(0xca)});return;}if(_0x3ebccd['gateway']!==_0x2392f7(0xbf)){_0x4845c8[_0x2392f7(0xd2)](0x190)[_0x2392f7(0xf8)]({'success':![],'message':'This\x20payment\x20is\x20not\x20for\x20OnRamp\x20gateway'});return;}const _0x5a6a2b={'status':_0x4b2bf5['toUpperCase'](),'statusChangedAt':new Date(),'statusChangedBy':_0x2392f7(0xde)};_0x4f49e6&&(_0x5a6a2b[_0x2392f7(0xdd)]=_0x4f49e6);_0x2c9148&&(_0x5a6a2b[_0x2392f7(0xba)]=_0x2c9148);_0x5c63da&&(_0x5a6a2b[_0x2392f7(0xf1)]=_0x5c63da);const _0x5a1965=await database_1['default']['payment']['update']({'where':{'id':_0x3ebccd['id']},'data':_0x5a6a2b});console['log'](_0x2392f7(0xf4)+_0x3ebccd['id']+_0x2392f7(0xb7)+_0x4b2bf5),_0x4b2bf5[_0x2392f7(0xf5)]()===_0x2392f7(0xce)&&_0x3ebccd[_0x2392f7(0xd2)]!=='PAID'&&await this[_0x2392f7(0xc9)](_0x3ebccd),_0x4845c8['json']({'success':!![],'message':_0x2392f7(0xae),'data':{'paymentId':_0x5a1965['id'],'status':_0x5a1965[_0x2392f7(0xd2)],'referenceId':_0x4f49e6,'transactionHash':_0x2c9148,'actualCryptoAmount':_0x5c63da}});}catch(_0x152f9c){console[_0x2392f7(0xf0)](_0x2392f7(0xc6),_0x152f9c),_0x4845c8[_0x2392f7(0xd2)](0x1f4)[_0x2392f7(0xf8)]({'success':![],'message':_0x2392f7(0xb4),'error':_0x152f9c instanceof Error?_0x152f9c['message']:'Unknown\x20error'});}}async[a9_0x2bf153(0xc9)](_0x104620){var _0x1bb2f5=a9_0x2bf153;try{console[_0x1bb2f5(0xe5)]('💰\x20Updating\x20merchant\x20balance\x20for\x20paid\x20OnRamp\x20payment:\x20'+_0x104620['id']);let _0x23d2a1;if(_0x104620[_0x1bb2f5(0xed)]===_0x1bb2f5(0xcc))_0x23d2a1=_0x104620[_0x1bb2f5(0xd6)];else{const {currencyService:_0x354a2b}=await Promise['resolve']()[_0x1bb2f5(0xc8)](()=>__importStar(require(_0x1bb2f5(0xea))));_0x23d2a1=await _0x354a2b[_0x1bb2f5(0xd4)](_0x104620[_0x1bb2f5(0xd6)],_0x104620['currency']);}await database_1[_0x1bb2f5(0xb8)]['payment']['update']({'where':{'id':_0x104620['id']},'data':{'amountUSDT':_0x23d2a1,'paidAt':new Date()}});const _0x5adddd=0xa,_0x438be2=_0x23d2a1*(0x1-_0x5adddd/0x64);await database_1[_0x1bb2f5(0xb8)][_0x1bb2f5(0xc5)]['update']({'where':{'id':_0x104620[_0x1bb2f5(0xd3)]},'data':{'balance':{'increment':_0x438be2}}}),console[_0x1bb2f5(0xe5)](_0x1bb2f5(0xf3)+_0x438be2['toFixed'](0x6)+_0x1bb2f5(0xd7)+_0x5adddd+_0x1bb2f5(0xe2));}catch(_0x22aa8e){console[_0x1bb2f5(0xf0)](_0x1bb2f5(0xef),_0x22aa8e);}}async[a9_0x2bf153(0xc0)](_0x149c7f,_0x1a2d88){var _0x4324bc=a9_0x2bf153;try{const {id:_0x33acff}=_0x149c7f[_0x4324bc(0xdc)];if(!_0x33acff){_0x1a2d88[_0x4324bc(0xd2)](0x190)[_0x4324bc(0xf8)]({'success':![],'message':_0x4324bc(0xaf)});return;}console[_0x4324bc(0xe5)](_0x4324bc(0xbc)+_0x33acff);const _0x2d9798=await database_1[_0x4324bc(0xb8)][_0x4324bc(0xdb)][_0x4324bc(0xb2)]({'where':{'OR':[{'id':_0x33acff},{'orderId':_0x33acff},{'gatewayOrderId':_0x33acff},{'gatewayPaymentId':_0x33acff}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});if(!_0x2d9798){_0x1a2d88['status'](0x194)['json']({'success':![],'message':_0x4324bc(0xca)});return;}console[_0x4324bc(0xe5)]('✅\x20Found\x20payment:\x20'+_0x2d9798['id']+'\x20('+_0x2d9798[_0x4324bc(0xd2)]+')'),_0x1a2d88[_0x4324bc(0xf8)]({'success':!![],'data':{'id':_0x2d9798['id'],'gateway':_0x2d9798[_0x4324bc(0xbe)],'amount':_0x2d9798[_0x4324bc(0xd6)],'currency':_0x2d9798[_0x4324bc(0xed)],'status':_0x2d9798[_0x4324bc(0xd2)],'gatewayOrderId':_0x2d9798[_0x4324bc(0xdd)],'gatewayPaymentId':_0x2d9798[_0x4324bc(0xba)],'successUrl':_0x2d9798[_0x4324bc(0xbd)],'failUrl':_0x2d9798[_0x4324bc(0xb6)],'pendingUrl':_0x2d9798['pendingUrl'],'customerEmail':_0x2d9798[_0x4324bc(0xd0)],'customerName':_0x2d9798[_0x4324bc(0xeb)],'merchantBrand':_0x2d9798[_0x4324bc(0xc5)][_0x4324bc(0xb5)],'createdAt':_0x2d9798['createdAt'],'updatedAt':_0x2d9798[_0x4324bc(0xf7)]}});}catch(_0x2f85be){console[_0x4324bc(0xf0)](_0x4324bc(0xb0),_0x2f85be),_0x1a2d88[_0x4324bc(0xd2)](0x1f4)['json']({'success':![],'message':_0x4324bc(0xb4),'error':_0x2f85be instanceof Error?_0x2f85be['message']:_0x4324bc(0xe7)});}}}exports[a9_0x2bf153(0xc2)]=OnRampController;