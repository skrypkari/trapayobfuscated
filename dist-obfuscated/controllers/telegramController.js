'use strict';const a12_0x5332b7=a12_0x18c8;(function(_0x12da88,_0x206c4e){const _0x2c7818=a12_0x18c8,_0xd8e550=_0x12da88();while(!![]){try{const _0x5688e1=parseInt(_0x2c7818(0x1c0))/0x1*(-parseInt(_0x2c7818(0x183))/0x2)+parseInt(_0x2c7818(0x189))/0x3+parseInt(_0x2c7818(0x1c3))/0x4*(parseInt(_0x2c7818(0x181))/0x5)+-parseInt(_0x2c7818(0x1a9))/0x6*(parseInt(_0x2c7818(0x196))/0x7)+-parseInt(_0x2c7818(0x19a))/0x8+-parseInt(_0x2c7818(0x1be))/0x9+-parseInt(_0x2c7818(0x17f))/0xa*(-parseInt(_0x2c7818(0x17c))/0xb);if(_0x5688e1===_0x206c4e)break;else _0xd8e550['push'](_0xd8e550['shift']());}catch(_0x56b0b7){_0xd8e550['push'](_0xd8e550['shift']());}}}(a12_0x4db8,0x8ab34));var __importDefault=this&&this[a12_0x5332b7(0x191)]||function(_0xcd7b7e){const _0x36111d=a12_0x5332b7;return _0xcd7b7e&&_0xcd7b7e[_0x36111d(0x1b2)]?_0xcd7b7e:{'default':_0xcd7b7e};};function a12_0x18c8(_0x460bd6,_0x1fce8a){const _0x4db8fd=a12_0x4db8();return a12_0x18c8=function(_0x18c82e,_0x27c99b){_0x18c82e=_0x18c82e-0x17c;let _0x2d2b8e=_0x4db8fd[_0x18c82e];return _0x2d2b8e;},a12_0x18c8(_0x460bd6,_0x1fce8a);}Object[a12_0x5332b7(0x1a2)](exports,a12_0x5332b7(0x1b2),{'value':!![]}),exports[a12_0x5332b7(0x1c1)]=void 0x0;const telegramBotService_1=require(a12_0x5332b7(0x19e)),database_1=__importDefault(require(a12_0x5332b7(0x18a)));class TelegramController{constructor(){const _0x5618ba=a12_0x5332b7;this[_0x5618ba(0x1a5)]=async(_0x204f46,_0x2eb1ca,_0x4b0ef6)=>{const _0x26d7b3=_0x5618ba;try{const _0x433940=telegramBotService_1[_0x26d7b3(0x199)]['getBotInfo'](),_0x243d54=await database_1[_0x26d7b3(0x198)]['telegramUser'][_0x26d7b3(0x1a4)](),_0x281ed5=await database_1['default'][_0x26d7b3(0x192)]['count']({'where':{'isVerified':!![]}}),_0x34713b=await database_1['default']['telegramUser']['groupBy']({'by':['shopId'],'where':{'isVerified':!![],'shopId':{'not':null}},'_count':{'shopId':!![]}});_0x2eb1ca[_0x26d7b3(0x1ac)]({'success':!![],'result':{'bot':{'isActive':_0x433940[_0x26d7b3(0x1b8)],'username':_0x433940[_0x26d7b3(0x1a7)]},'statistics':{'totalUsers':_0x243d54,'verifiedUsers':_0x281ed5,'unverifiedUsers':_0x243d54-_0x281ed5,'connectedShops':_0x34713b[_0x26d7b3(0x1ab)]}}});}catch(_0x4803d2){_0x4b0ef6(_0x4803d2);}},this['getTelegramUsers']=async(_0x5cc6a5,_0x3bf0dc,_0x3fa875)=>{const _0x3b4b1f=_0x5618ba;try{const {page:page=0x1,limit:limit=0x14,verified:_0x2ad1d8}=_0x5cc6a5[_0x3b4b1f(0x197)],_0x1ff557=(Number(page)-0x1)*Number(limit),_0x2e48f9={};_0x2ad1d8!==undefined&&(_0x2e48f9['isVerified']=_0x2ad1d8==='true');const [_0x1b2e68,_0x37be64]=await Promise['all']([database_1[_0x3b4b1f(0x198)]['telegramUser'][_0x3b4b1f(0x18e)]({'where':_0x2e48f9,'skip':_0x1ff557,'take':Number(limit),'orderBy':{'createdAt':_0x3b4b1f(0x19d)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x3b4b1f(0x192)][_0x3b4b1f(0x1a4)]({'where':_0x2e48f9})]);_0x3bf0dc['json']({'success':!![],'users':_0x1b2e68[_0x3b4b1f(0x1a6)](_0x11f767=>({'id':_0x11f767['id'],'telegramId':_0x11f767[_0x3b4b1f(0x194)],'username':_0x11f767['username'],'firstName':_0x11f767['firstName'],'lastName':_0x11f767[_0x3b4b1f(0x1b6)],'isVerified':_0x11f767[_0x3b4b1f(0x187)],'shop':_0x11f767[_0x3b4b1f(0x1c2)],'createdAt':_0x11f767[_0x3b4b1f(0x1b4)],'updatedAt':_0x11f767['updatedAt']})),'pagination':{'page':Number(page),'limit':Number(limit),'total':_0x37be64,'totalPages':Math[_0x3b4b1f(0x1a0)](_0x37be64/Number(limit))}});}catch(_0x55c597){_0x3fa875(_0x55c597);}},this[_0x5618ba(0x1a3)]=async(_0x2bd690,_0x573c7c,_0x2daeeb)=>{const _0x4ceead=_0x5618ba;try{const {message:_0x2faa05,shopId:_0x5ca494}=_0x2bd690[_0x4ceead(0x18d)];if(!_0x2faa05)return _0x573c7c[_0x4ceead(0x182)](0x190)['json']({'success':![],'message':'Message\x20is\x20required'});if(_0x5ca494)await telegramBotService_1[_0x4ceead(0x199)][_0x4ceead(0x1ae)](_0x5ca494,_0x2faa05,{'parse_mode':_0x4ceead(0x1aa)});else{const _0x3aab08=await database_1[_0x4ceead(0x198)][_0x4ceead(0x192)]['findMany']({'where':{'isVerified':!![]},'select':{'shopId':!![]}}),_0x27a1c4=[...new Set(_0x3aab08[_0x4ceead(0x1a6)](_0x5c5699=>_0x5c5699[_0x4ceead(0x195)])['filter'](Boolean))];for(const _0x242c65 of _0x27a1c4){_0x242c65&&await telegramBotService_1[_0x4ceead(0x199)]['sendShopNotification'](_0x242c65,_0x2faa05,{'parse_mode':_0x4ceead(0x1aa)});}}_0x573c7c['json']({'success':!![],'message':_0x4ceead(0x185)});}catch(_0xe8cff1){_0x2daeeb(_0xe8cff1);}},this[_0x5618ba(0x1ad)]=async(_0xf1496e,_0x1bf23b,_0x41097a)=>{const _0x19ffbe=_0x5618ba;try{const {telegramId:_0x2e7712}=_0xf1496e[_0x19ffbe(0x1b5)],_0x2745b1=await database_1[_0x19ffbe(0x198)][_0x19ffbe(0x192)][_0x19ffbe(0x17e)]({'where':{'telegramId':_0x2e7712},'include':{'shop':!![]}});if(!_0x2745b1)return _0x1bf23b[_0x19ffbe(0x182)](0x194)[_0x19ffbe(0x1ac)]({'success':![],'message':_0x19ffbe(0x18c)});await database_1[_0x19ffbe(0x198)]['telegramUser'][_0x19ffbe(0x19f)]({'where':{'telegramId':_0x2e7712},'data':{'shopId':null,'isVerified':![]}}),_0x1bf23b['json']({'success':!![],'message':_0x19ffbe(0x1bc)});}catch(_0x5b3375){_0x41097a(_0x5b3375);}},this[_0x5618ba(0x1bd)]=async(_0x1e6a28,_0x4a5117,_0x5ce230)=>{const _0x50c549=_0x5618ba;try{const {shopId:_0x5ab67a,type:type=_0x50c549(0x1c4),testData:_0x703414}=_0x1e6a28[_0x50c549(0x18d)];if(!_0x5ab67a)return _0x4a5117['status'](0x190)[_0x50c549(0x1ac)]({'success':![],'message':_0x50c549(0x186)});const _0x4e56f9=await database_1[_0x50c549(0x198)][_0x50c549(0x1c2)][_0x50c549(0x17e)]({'where':{'id':_0x5ab67a},'select':{'id':!![],'name':!![]}});if(!_0x4e56f9)return _0x4a5117['status'](0x194)[_0x50c549(0x1ac)]({'success':![],'message':'Shop\x20not\x20found'});switch(type){case _0x50c549(0x1c4):const _0x3c9c13={'id':_0x50c549(0x17d),'amount':_0x703414?.['amount']||0x64,'currency':_0x703414?.[_0x50c549(0x188)]||_0x50c549(0x1a1),'productName':_0x703414?.[_0x50c549(0x1b0)]||_0x50c549(0x1b7),'gateway':_0x703414?.[_0x50c549(0x18f)]||_0x50c549(0x1b3),'createdAt':new Date(),..._0x703414};await telegramBotService_1['telegramBotService'][_0x50c549(0x1bb)](_0x5ab67a,_0x3c9c13,_0x50c549(0x19b));break;case'payout':const _0x5c8f8f={'id':_0x50c549(0x1ba),'amount':_0x703414?.['amount']||0x1f4,'method':_0x703414?.[_0x50c549(0x19c)]||'bank_transfer','createdAt':new Date(),..._0x703414};await telegramBotService_1['telegramBotService'][_0x50c549(0x1bf)](_0x5ab67a,_0x5c8f8f,'completed');break;case _0x50c549(0x193):await telegramBotService_1['telegramBotService'][_0x50c549(0x18b)](_0x5ab67a,_0x703414?.[_0x50c549(0x1b9)]||_0x50c549(0x1b1),_0x703414?.[_0x50c549(0x184)]||{'message':_0x50c549(0x1af)});break;default:return _0x4a5117[_0x50c549(0x182)](0x190)[_0x50c549(0x1ac)]({'success':![],'message':_0x50c549(0x180)});}_0x4a5117[_0x50c549(0x1ac)]({'success':!![],'message':_0x50c549(0x190)+type+_0x50c549(0x1a8)});}catch(_0x3edb90){_0x5ce230(_0x3edb90);}};}}exports[a12_0x5332b7(0x1c1)]=TelegramController;function a12_0x4db8(){const _0x1734a3=['7PfPFSI','query','default','telegramBotService','3295064xcyeCc','paid','method','desc','../services/telegramBotService','update','ceil','USD','defineProperty','sendBroadcast','count','getBotStatus','map','username','\x20notification\x20sent\x20successfully','6598680FYWlRM','Markdown','length','json','disconnectUser','sendShopNotification','This\x20is\x20a\x20test\x20notification','productName','Test\x20Notification','__esModule','plisio','createdAt','params','lastName','Test\x20Product','isActive','title','test_payout_123','sendPaymentNotification','User\x20disconnected\x20successfully','sendTestNotification','9247248IRWUBj','sendPayoutNotification','1sqyPCk','TelegramController','shop','32IETEWY','payment','11cClkdU','test_payment_123','findUnique','17461070nmoVnf','Invalid\x20notification\x20type.\x20Use:\x20payment,\x20payout,\x20or\x20custom','399710LYBtjF','status','756534WiyFxG','details','Broadcast\x20message\x20sent\x20successfully','Shop\x20ID\x20is\x20required','isVerified','currency','3299625ONNrHS','../config/database','sendCustomNotification','Telegram\x20user\x20not\x20found','body','findMany','gateway','Test\x20','__importDefault','telegramUser','custom','telegramId','shopId'];a12_0x4db8=function(){return _0x1734a3;};return a12_0x4db8();}