'use strict';function a36_0x8021(){const _0x24aba9=['default','huf','💱\x20Converted\x20','Initial\x20currency\x20rates\x20update\x20failed:','status','eos','?ids=tether&vs_currencies=','170kDXNVa','51849xiYLIU','xag','143XZLlyo','statusText','jpy','idr','aud','map','log','hkd','❌\x20Failed\x20to\x20update\x20currency\x20rates:','🛑\x20Currency\x20rates\x20periodic\x20updates\x20stopped','xau','join','dkk','length','CurrencyService','rate','updatedAt','getRatesStatus','xdr','%\x20markup\x20=\x20','136233gXtTAg','kwd','toFixed','sgd','currency','184CUGELk','keys','pkr','thb','brl','ars','\x20to\x20USDT:','__esModule','updateInterval','%\x20markup\x20to\x20','\x20USDT\x20(rate:\x20','mmk','bits','sek','bch','gel','btc','sar','cad','tether','TesSoft\x20Payment\x20System/1.0','convertToUSDT','desc','startPeriodicUpdates','vnd','600ostcKe','all','findUnique','bnb','cny','getCurrencyRate','CoinGecko\x20API\x20error:\x20','lkr','findFirst','error','toLowerCase','forEach','Error\x20getting\x20rate\x20for\x20currency\x20','CURRENCIES','102364jedqfg','zar','COINGECKO_URL','eur',',\x20using\x201\x20as\x20fallback','updateCurrencyRates','MARKUP_PERCENTAGE','gbp','usdt','🔄\x20Updating\x20currency\x20rates\x20from\x20CoinGecko...','\x20currencies','Error\x20converting\x20','asc','\x20USDT,\x20with\x20','czk','allSettled','Invalid\x20response\x20format\x20from\x20CoinGecko\x20API','9336sOriAv','xrp','No\x20rate\x20found\x20for\x20currency:\x20','\x20USDT','findMany','2rmDnLd','📊\x20Received\x20rates\x20for\x20','\x20USDT\x20=\x20','../config/database','krw','1185345EsOqyv','https://api.coingecko.com/api/v3/simple/price','💱\x20Applied\x20','getAllRates','catch','entries','sats','✅\x20Currency\x20rates\x20updated\x20successfully','twd','convertMultipleToUSDT','usd','stopPeriodicUpdates','pln','myr','2063290HZhCLA','currencyRate','xlm','mxn','json','aed','191425LdrjKu','getMarkupPercentage'];a36_0x8021=function(){return _0x24aba9;};return a36_0x8021();}const a36_0x159978=a36_0x2bc1;(function(_0xc7da0c,_0x38eddc){const _0x27aa29=a36_0x2bc1,_0x342bfe=_0xc7da0c();while(!![]){try{const _0xad475c=parseInt(_0x27aa29(0x173))/0x1*(parseInt(_0x27aa29(0x15a))/0x2)+parseInt(_0x27aa29(0x15f))/0x3+-parseInt(_0x27aa29(0x144))/0x4*(parseInt(_0x27aa29(0x17c))/0x5)+parseInt(_0x27aa29(0x1b1))/0x6*(parseInt(_0x27aa29(0x17d))/0x7)+parseInt(_0x27aa29(0x198))/0x8*(parseInt(_0x27aa29(0x193))/0x9)+-parseInt(_0x27aa29(0x16d))/0xa+parseInt(_0x27aa29(0x17f))/0xb*(-parseInt(_0x27aa29(0x155))/0xc);if(_0xad475c===_0x38eddc)break;else _0x342bfe['push'](_0x342bfe['shift']());}catch(_0x140a98){_0x342bfe['push'](_0x342bfe['shift']());}}}(a36_0x8021,0x8fc36));var __importDefault=this&&this['__importDefault']||function(_0x52aad9){const _0x6265f1=a36_0x2bc1;return _0x52aad9&&_0x52aad9[_0x6265f1(0x19f)]?_0x52aad9:{'default':_0x52aad9};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['currencyService']=exports['CurrencyService']=void 0x0;function a36_0x2bc1(_0x1478e7,_0x12def2){const _0x80219c=a36_0x8021();return a36_0x2bc1=function(_0x2bc1c5,_0x105f30){_0x2bc1c5=_0x2bc1c5-0x13e;let _0x39e65d=_0x80219c[_0x2bc1c5];return _0x39e65d;},a36_0x2bc1(_0x1478e7,_0x12def2);}const database_1=__importDefault(require(a36_0x159978(0x15d)));class CurrencyService{constructor(){const _0x45e957=a36_0x159978;this['COINGECKO_URL']=_0x45e957(0x160),this[_0x45e957(0x143)]=[_0x45e957(0x1a8),'eth','ltc',_0x45e957(0x1a6),_0x45e957(0x1b4),_0x45e957(0x17a),_0x45e957(0x156),_0x45e957(0x16f),'link','dot','yfi',_0x45e957(0x169),_0x45e957(0x172),_0x45e957(0x19d),_0x45e957(0x183),'bdt','bhd','bmd',_0x45e957(0x19c),_0x45e957(0x1aa),'chf','clp',_0x45e957(0x1b5),_0x45e957(0x152),_0x45e957(0x18b),_0x45e957(0x147),_0x45e957(0x14b),_0x45e957(0x1a7),_0x45e957(0x186),_0x45e957(0x176),_0x45e957(0x182),'ils','inr',_0x45e957(0x181),_0x45e957(0x15e),_0x45e957(0x194),_0x45e957(0x1b8),_0x45e957(0x1a3),_0x45e957(0x170),_0x45e957(0x16c),'ngn','nok','nzd','php',_0x45e957(0x19a),_0x45e957(0x16b),'rub',_0x45e957(0x1a9),_0x45e957(0x1a5),_0x45e957(0x196),_0x45e957(0x19b),'try',_0x45e957(0x167),'uah','vef',_0x45e957(0x1b0),_0x45e957(0x145),_0x45e957(0x191),_0x45e957(0x17e),_0x45e957(0x189),_0x45e957(0x1a4),_0x45e957(0x165)],this['updateInterval']=null,this['MARKUP_PERCENTAGE']=0x3,this[_0x45e957(0x1af)]();}[a36_0x159978(0x1af)](){const _0x46eec2=a36_0x159978;this['updateCurrencyRates']()[_0x46eec2(0x163)](_0x519252=>{const _0xc2a801=_0x46eec2;console[_0xc2a801(0x13f)](_0xc2a801(0x178),_0x519252);}),this['updateInterval']=setInterval(async()=>{const _0x1f32e4=_0x46eec2;try{await this[_0x1f32e4(0x149)]();}catch(_0x3ff355){console['error']('Periodic\x20currency\x20rates\x20update\x20failed:',_0x3ff355);}},0x3c*0x3c*0x3e8),console[_0x46eec2(0x185)]('✅\x20Currency\x20rates\x20service\x20started\x20with\x20hourly\x20updates');}[a36_0x159978(0x16a)](){const _0xa46bc7=a36_0x159978;this[_0xa46bc7(0x1a0)]&&(clearInterval(this['updateInterval']),this[_0xa46bc7(0x1a0)]=null,console[_0xa46bc7(0x185)](_0xa46bc7(0x188)));}async['updateCurrencyRates'](){const _0x281f48=a36_0x159978;try{console['log'](_0x281f48(0x14d));const _0x4424d2=this[_0x281f48(0x143)][_0x281f48(0x18a)](','),_0x4802e4=this[_0x281f48(0x146)]+_0x281f48(0x17b)+_0x4424d2,_0x479b2b=await fetch(_0x4802e4,{'headers':{'Accept':'application/json','User-Agent':_0x281f48(0x1ac)}});if(!_0x479b2b['ok'])throw new Error(_0x281f48(0x1b7)+_0x479b2b[_0x281f48(0x179)]+'\x20'+_0x479b2b[_0x281f48(0x180)]);const _0x5c0233=await _0x479b2b[_0x281f48(0x171)]();if(!_0x5c0233[_0x281f48(0x1ab)])throw new Error(_0x281f48(0x154));const _0x3f5c66=_0x5c0233[_0x281f48(0x1ab)];console[_0x281f48(0x185)](_0x281f48(0x15b)+Object[_0x281f48(0x199)](_0x3f5c66)[_0x281f48(0x18c)]+_0x281f48(0x14e));const _0x1cfd6b=Object[_0x281f48(0x164)](_0x3f5c66)[_0x281f48(0x184)](async([_0x440c17,_0x3c2ee1])=>{const _0x3c0e84=_0x281f48;try{await database_1[_0x3c0e84(0x175)][_0x3c0e84(0x16e)]['upsert']({'where':{'currency':_0x440c17[_0x3c0e84(0x140)]()},'update':{'rate':_0x3c2ee1},'create':{'currency':_0x440c17[_0x3c0e84(0x140)](),'rate':_0x3c2ee1}});}catch(_0x54ce04){console['error']('Failed\x20to\x20update\x20rate\x20for\x20'+_0x440c17+':',_0x54ce04);}});await Promise[_0x281f48(0x153)](_0x1cfd6b),console[_0x281f48(0x185)](_0x281f48(0x166));}catch(_0x5da26d){console[_0x281f48(0x13f)](_0x281f48(0x187),_0x5da26d);throw _0x5da26d;}}async[a36_0x159978(0x1b6)](_0x590fc4){const _0x7f4e79=a36_0x159978,_0x335032=_0x590fc4[_0x7f4e79(0x140)]();if(_0x335032==='usdt')return 0x1;try{const _0xb2c8da=await database_1['default'][_0x7f4e79(0x16e)][_0x7f4e79(0x1b3)]({'where':{'currency':_0x335032}});if(!_0xb2c8da)return console['warn'](_0x7f4e79(0x157)+_0x590fc4+_0x7f4e79(0x148)),0x1;return _0xb2c8da[_0x7f4e79(0x18e)];}catch(_0x12f6ae){return console['error'](_0x7f4e79(0x142)+_0x590fc4+':',_0x12f6ae),0x1;}}async['convertToUSDT'](_0x435761,_0xe98af8){const _0x153caa=a36_0x159978,_0x4c7298=_0xe98af8[_0x153caa(0x140)]();if(_0x4c7298===_0x153caa(0x14c)){const _0x3d7af0=_0x435761*(0x1+this[_0x153caa(0x14a)]/0x64);return console[_0x153caa(0x185)](_0x153caa(0x161)+this[_0x153caa(0x14a)]+_0x153caa(0x1a1)+_0x435761+_0x153caa(0x15c)+_0x3d7af0[_0x153caa(0x195)](0x6)+_0x153caa(0x158)),_0x3d7af0;}try{const _0x1a3f86=await this[_0x153caa(0x1b6)](_0x4c7298),_0x1521e9=_0x435761/_0x1a3f86,_0x1bc402=_0x1521e9*(0x1+this[_0x153caa(0x14a)]/0x64);return console[_0x153caa(0x185)](_0x153caa(0x177)+_0x435761+'\x20'+_0xe98af8['toUpperCase']()+'\x20to\x20'+_0x1521e9[_0x153caa(0x195)](0x6)+_0x153caa(0x151)+this[_0x153caa(0x14a)]+_0x153caa(0x192)+_0x1bc402[_0x153caa(0x195)](0x6)+_0x153caa(0x1a2)+_0x1a3f86+')'),_0x1bc402;}catch(_0x5778f0){console['error'](_0x153caa(0x14f)+_0x435761+'\x20'+_0xe98af8+_0x153caa(0x19e),_0x5778f0);const _0x1cfb3f=_0x435761*(0x1+this['MARKUP_PERCENTAGE']/0x64);return _0x1cfb3f;}}async[a36_0x159978(0x168)](_0xdf3e4c){const _0x2ca8de=a36_0x159978;let _0x413872=0x0;for(const {amount:_0x34cb4d,currency:_0x4da5bd}of _0xdf3e4c){const _0x2fb983=await this[_0x2ca8de(0x1ad)](_0x34cb4d,_0x4da5bd);_0x413872+=_0x2fb983;}return _0x413872;}async[a36_0x159978(0x162)](){const _0x2edf1b=a36_0x159978;try{const _0x3c4647=await database_1[_0x2edf1b(0x175)][_0x2edf1b(0x16e)][_0x2edf1b(0x159)]({'select':{'currency':!![],'rate':!![]}}),_0x446319={'usdt':0x1};return _0x3c4647[_0x2edf1b(0x141)](_0x5f0e9d=>{const _0x2a3189=_0x2edf1b;_0x446319[_0x5f0e9d[_0x2a3189(0x197)]]=_0x5f0e9d[_0x2a3189(0x18e)];}),_0x446319;}catch(_0x52ad81){return console['error']('Error\x20getting\x20all\x20rates:',_0x52ad81),{'usdt':0x1};}}async[a36_0x159978(0x190)](){const _0x54e172=a36_0x159978;try{const [_0x30eb59,_0x4d7f94,_0xd76199]=await Promise[_0x54e172(0x1b2)]([database_1[_0x54e172(0x175)][_0x54e172(0x16e)]['count'](),database_1['default'][_0x54e172(0x16e)]['findFirst']({'orderBy':{'updatedAt':_0x54e172(0x1ae)},'select':{'updatedAt':!![]}}),database_1['default']['currencyRate'][_0x54e172(0x13e)]({'orderBy':{'updatedAt':_0x54e172(0x150)},'select':{'updatedAt':!![]}})]);return{'totalRates':_0x30eb59,'lastUpdated':_0x4d7f94?.[_0x54e172(0x18f)]||null,'oldestRate':_0xd76199?.[_0x54e172(0x18f)]||null,'markupPercentage':this[_0x54e172(0x14a)]};}catch(_0x3619e1){return console['error']('Error\x20getting\x20rates\x20status:',_0x3619e1),{'totalRates':0x0,'lastUpdated':null,'oldestRate':null,'markupPercentage':this[_0x54e172(0x14a)]};}}[a36_0x159978(0x174)](){const _0x59a1c5=a36_0x159978;return this[_0x59a1c5(0x14a)];}}exports[a36_0x159978(0x18d)]=CurrencyService,exports['currencyService']=new CurrencyService();