'use strict';const a51_0x4af9bb=a51_0x1926;function a51_0x1406(){const _0x34c445=['default','10413600dUTNTj','usdcPolygonWallet','hex','paymentGateways','bcryptjs','randomBytes','status','toString','getUserById','name','desc','2798196OGRbza','37457MxKTYp','parse','publicKey','crypto','gatewaySettings','telegramId','getAllUsers','10roILqc','password','create','UserService','2007531oHwDmU','hash','fullName','generateApiKeys','createdAt','findMany','createUser','usdtErcWallet','deleteUser','__esModule','findUnique','telegram','username','10MtduDV','2389992dFIdIY','wallets','1346552KqauxU','updateUser','usdtTrcWallet','ACTIVE','shopUrl','gateways','usdtPolygonWallet','stringify','defineProperty','__importDefault','Username\x20already\x20exists','205425QpLAII','shop','merchantUrl','7HZuuwB'];a51_0x1406=function(){return _0x34c445;};return a51_0x1406();}(function(_0x1a36ad,_0x297ead){const _0x5f60bd=a51_0x1926,_0x73283b=_0x1a36ad();while(!![]){try{const _0x339275=parseInt(_0x5f60bd(0x15d))/0x1+parseInt(_0x5f60bd(0x164))/0x2*(parseInt(_0x5f60bd(0x183))/0x3)+parseInt(_0x5f60bd(0x178))/0x4*(-parseInt(_0x5f60bd(0x175))/0x5)+-parseInt(_0x5f60bd(0x15c))/0x6+parseInt(_0x5f60bd(0x186))/0x7*(parseInt(_0x5f60bd(0x176))/0x8)+-parseInt(_0x5f60bd(0x168))/0x9+parseInt(_0x5f60bd(0x188))/0xa;if(_0x339275===_0x297ead)break;else _0x73283b['push'](_0x73283b['shift']());}catch(_0x458ac5){_0x73283b['push'](_0x73283b['shift']());}}}(a51_0x1406,0x57378));var __importDefault=this&&this[a51_0x4af9bb(0x181)]||function(_0x19ba1f){const _0x3a9b73=a51_0x4af9bb;return _0x19ba1f&&_0x19ba1f[_0x3a9b73(0x171)]?_0x19ba1f:{'default':_0x19ba1f};};Object[a51_0x4af9bb(0x180)](exports,'__esModule',{'value':!![]}),exports[a51_0x4af9bb(0x167)]=void 0x0;const bcryptjs_1=__importDefault(require(a51_0x4af9bb(0x155))),crypto_1=__importDefault(require(a51_0x4af9bb(0x160))),database_1=__importDefault(require('../config/database'));class UserService{[a51_0x4af9bb(0x16b)](){const _0x3aba61=a51_0x4af9bb,_0x59cb78='pk_'+crypto_1[_0x3aba61(0x187)][_0x3aba61(0x156)](0x20)['toString']('hex'),_0x396fca='sk_'+crypto_1['default']['randomBytes'](0x20)[_0x3aba61(0x158)](_0x3aba61(0x18a));return{'publicKey':_0x59cb78,'secretKey':_0x396fca};}async[a51_0x4af9bb(0x16e)](_0x2feeff){const _0x7afb60=a51_0x4af9bb,{fullName:_0x44e435,username:_0xc90f7,password:_0x4f356c,telegramId:_0x38b4f5,merchantUrl:_0x1941fa,gateways:_0x22a0ce,gatewaySettings:_0x1b9318,wallets:_0x4ffe1d}=_0x2feeff,_0x1047b5=await database_1[_0x7afb60(0x187)][_0x7afb60(0x184)][_0x7afb60(0x172)]({'where':{'username':_0xc90f7}});if(_0x1047b5)throw new Error(_0x7afb60(0x182));if(_0x38b4f5){const _0x5859be=await database_1[_0x7afb60(0x187)][_0x7afb60(0x184)][_0x7afb60(0x172)]({'where':{'telegram':_0x38b4f5}});if(_0x5859be)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x4754cb=await bcryptjs_1[_0x7afb60(0x187)][_0x7afb60(0x169)](_0x4f356c,0xc),{publicKey:_0x4e6981,secretKey:_0x45f162}=this[_0x7afb60(0x16b)](),_0x584a89=await database_1[_0x7afb60(0x187)][_0x7afb60(0x184)][_0x7afb60(0x166)]({'data':{'name':_0x44e435,'username':_0xc90f7,'password':_0x4754cb,'telegram':_0x38b4f5,'shopUrl':_0x1941fa,'paymentGateways':_0x22a0ce?JSON[_0x7afb60(0x17f)](_0x22a0ce):null,'gatewaySettings':_0x1b9318?JSON[_0x7afb60(0x17f)](_0x1b9318):null,'usdtPolygonWallet':_0x4ffe1d?.[_0x7afb60(0x17e)]||null,'usdtTrcWallet':_0x4ffe1d?.[_0x7afb60(0x17a)]||null,'usdtErcWallet':_0x4ffe1d?.[_0x7afb60(0x16f)]||null,'usdcPolygonWallet':_0x4ffe1d?.[_0x7afb60(0x189)]||null,'publicKey':_0x4e6981,'secretKey':_0x45f162,'status':_0x7afb60(0x17b)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x584a89['id'],'fullName':_0x584a89[_0x7afb60(0x15a)],'username':_0x584a89['username'],'telegramId':_0x584a89[_0x7afb60(0x173)],'merchantUrl':_0x584a89[_0x7afb60(0x17c)],'gateways':_0x584a89[_0x7afb60(0x154)]?JSON[_0x7afb60(0x15e)](_0x584a89[_0x7afb60(0x154)]):null,'gatewaySettings':_0x584a89['gatewaySettings']?JSON[_0x7afb60(0x15e)](_0x584a89['gatewaySettings']):null,'publicKey':_0x584a89[_0x7afb60(0x15f)],'wallets':{'usdtPolygonWallet':_0x584a89[_0x7afb60(0x17e)],'usdtTrcWallet':_0x584a89['usdtTrcWallet'],'usdtErcWallet':_0x584a89[_0x7afb60(0x16f)],'usdcPolygonWallet':_0x584a89[_0x7afb60(0x189)]},'status':_0x584a89[_0x7afb60(0x157)],'createdAt':_0x584a89[_0x7afb60(0x16c)]};}async[a51_0x4af9bb(0x163)](){const _0xee2f32=a51_0x4af9bb,_0x3b1f49=await database_1[_0xee2f32(0x187)][_0xee2f32(0x184)][_0xee2f32(0x16d)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0xee2f32(0x15b)}});return _0x3b1f49['map'](_0x8a06c7=>({'id':_0x8a06c7['id'],'fullName':_0x8a06c7[_0xee2f32(0x15a)],'username':_0x8a06c7['username'],'telegramId':_0x8a06c7['telegram'],'merchantUrl':_0x8a06c7['shopUrl'],'gateways':_0x8a06c7[_0xee2f32(0x154)]?JSON['parse'](_0x8a06c7[_0xee2f32(0x154)]):null,'gatewaySettings':_0x8a06c7[_0xee2f32(0x161)]?JSON[_0xee2f32(0x15e)](_0x8a06c7['gatewaySettings']):null,'publicKey':_0x8a06c7[_0xee2f32(0x15f)],'wallets':{'usdtPolygonWallet':_0x8a06c7[_0xee2f32(0x17e)],'usdtTrcWallet':_0x8a06c7[_0xee2f32(0x17a)],'usdtErcWallet':_0x8a06c7[_0xee2f32(0x16f)],'usdcPolygonWallet':_0x8a06c7[_0xee2f32(0x189)]},'status':_0x8a06c7[_0xee2f32(0x157)],'createdAt':_0x8a06c7['createdAt']}));}async[a51_0x4af9bb(0x159)](_0x210ffb){const _0x3f7312=a51_0x4af9bb,_0x18d119=await database_1[_0x3f7312(0x187)]['shop'][_0x3f7312(0x172)]({'where':{'id':_0x210ffb},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x18d119)return null;return{'id':_0x18d119['id'],'fullName':_0x18d119[_0x3f7312(0x15a)],'username':_0x18d119['username'],'telegramId':_0x18d119[_0x3f7312(0x173)],'merchantUrl':_0x18d119[_0x3f7312(0x17c)],'gateways':_0x18d119['paymentGateways']?JSON[_0x3f7312(0x15e)](_0x18d119[_0x3f7312(0x154)]):null,'gatewaySettings':_0x18d119['gatewaySettings']?JSON['parse'](_0x18d119[_0x3f7312(0x161)]):null,'publicKey':_0x18d119[_0x3f7312(0x15f)],'wallets':{'usdtPolygonWallet':_0x18d119[_0x3f7312(0x17e)],'usdtTrcWallet':_0x18d119['usdtTrcWallet'],'usdtErcWallet':_0x18d119[_0x3f7312(0x16f)],'usdcPolygonWallet':_0x18d119[_0x3f7312(0x189)]},'status':_0x18d119[_0x3f7312(0x157)],'createdAt':_0x18d119[_0x3f7312(0x16c)]};}async[a51_0x4af9bb(0x179)](_0x54b666,_0x21ac62){const _0x253b2c=a51_0x4af9bb,_0x490f25={..._0x21ac62};_0x21ac62[_0x253b2c(0x165)]&&(_0x490f25[_0x253b2c(0x165)]=await bcryptjs_1[_0x253b2c(0x187)][_0x253b2c(0x169)](_0x21ac62[_0x253b2c(0x165)],0xc));_0x21ac62['fullName']&&(_0x490f25[_0x253b2c(0x15a)]=_0x21ac62[_0x253b2c(0x16a)],delete _0x490f25[_0x253b2c(0x16a)]);_0x21ac62[_0x253b2c(0x162)]&&(_0x490f25[_0x253b2c(0x173)]=_0x21ac62[_0x253b2c(0x162)],delete _0x490f25['telegramId']);_0x21ac62[_0x253b2c(0x185)]&&(_0x490f25[_0x253b2c(0x17c)]=_0x21ac62[_0x253b2c(0x185)],delete _0x490f25['merchantUrl']);_0x21ac62[_0x253b2c(0x17d)]&&(_0x490f25[_0x253b2c(0x154)]=JSON[_0x253b2c(0x17f)](_0x21ac62[_0x253b2c(0x17d)]),delete _0x490f25[_0x253b2c(0x17d)]);_0x21ac62[_0x253b2c(0x161)]&&(_0x490f25[_0x253b2c(0x161)]=JSON[_0x253b2c(0x17f)](_0x21ac62[_0x253b2c(0x161)]),delete _0x490f25[_0x253b2c(0x161)]);_0x21ac62[_0x253b2c(0x177)]&&(_0x21ac62[_0x253b2c(0x177)][_0x253b2c(0x17e)]!==undefined&&(_0x490f25[_0x253b2c(0x17e)]=_0x21ac62['wallets'][_0x253b2c(0x17e)]||null),_0x21ac62[_0x253b2c(0x177)][_0x253b2c(0x17a)]!==undefined&&(_0x490f25['usdtTrcWallet']=_0x21ac62[_0x253b2c(0x177)][_0x253b2c(0x17a)]||null),_0x21ac62[_0x253b2c(0x177)][_0x253b2c(0x16f)]!==undefined&&(_0x490f25[_0x253b2c(0x16f)]=_0x21ac62[_0x253b2c(0x177)]['usdtErcWallet']||null),_0x21ac62[_0x253b2c(0x177)][_0x253b2c(0x189)]!==undefined&&(_0x490f25[_0x253b2c(0x189)]=_0x21ac62['wallets'][_0x253b2c(0x189)]||null),delete _0x490f25[_0x253b2c(0x177)]);const _0x1ea049=await database_1[_0x253b2c(0x187)][_0x253b2c(0x184)]['update']({'where':{'id':_0x54b666},'data':_0x490f25,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1ea049['id'],'fullName':_0x1ea049['name'],'username':_0x1ea049[_0x253b2c(0x174)],'telegramId':_0x1ea049[_0x253b2c(0x173)],'merchantUrl':_0x1ea049[_0x253b2c(0x17c)],'gateways':_0x1ea049[_0x253b2c(0x154)]?JSON['parse'](_0x1ea049[_0x253b2c(0x154)]):null,'gatewaySettings':_0x1ea049[_0x253b2c(0x161)]?JSON[_0x253b2c(0x15e)](_0x1ea049[_0x253b2c(0x161)]):null,'publicKey':_0x1ea049['publicKey'],'wallets':{'usdtPolygonWallet':_0x1ea049['usdtPolygonWallet'],'usdtTrcWallet':_0x1ea049[_0x253b2c(0x17a)],'usdtErcWallet':_0x1ea049[_0x253b2c(0x16f)],'usdcPolygonWallet':_0x1ea049['usdcPolygonWallet']},'status':_0x1ea049[_0x253b2c(0x157)],'createdAt':_0x1ea049['createdAt']};}async[a51_0x4af9bb(0x170)](_0x243242){const _0x1ce3f6=a51_0x4af9bb;await database_1[_0x1ce3f6(0x187)]['shop']['delete']({'where':{'id':_0x243242}});}}function a51_0x1926(_0x144dc6,_0x129070){const _0x1406db=a51_0x1406();return a51_0x1926=function(_0x1926e4,_0x48b726){_0x1926e4=_0x1926e4-0x154;let _0x212248=_0x1406db[_0x1926e4];return _0x212248;},a51_0x1926(_0x144dc6,_0x129070);}exports[a51_0x4af9bb(0x167)]=UserService;