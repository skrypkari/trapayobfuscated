'use strict';function a38_0x1823(_0x4e2494,_0xa656dd){const _0x9c27de=a38_0x9c27();return a38_0x1823=function(_0x182391,_0x4c1add){_0x182391=_0x182391-0xf6;let _0x4f7ccf=_0x9c27de[_0x182391];return _0x4f7ccf;},a38_0x1823(_0x4e2494,_0xa656dd);}const a38_0x7a3d08=a38_0x1823;(function(_0x38019c,_0x3343e1){const _0x5ce1f2=a38_0x1823,_0x217796=_0x38019c();while(!![]){try{const _0x5f42fe=-parseInt(_0x5ce1f2(0x152))/0x1*(-parseInt(_0x5ce1f2(0x16a))/0x2)+parseInt(_0x5ce1f2(0x10e))/0x3+-parseInt(_0x5ce1f2(0x13a))/0x4*(parseInt(_0x5ce1f2(0x12d))/0x5)+parseInt(_0x5ce1f2(0x106))/0x6*(-parseInt(_0x5ce1f2(0x128))/0x7)+-parseInt(_0x5ce1f2(0x120))/0x8+parseInt(_0x5ce1f2(0x15e))/0x9+parseInt(_0x5ce1f2(0x12c))/0xa;if(_0x5f42fe===_0x3343e1)break;else _0x217796['push'](_0x217796['shift']());}catch(_0x13d1ac){_0x217796['push'](_0x217796['shift']());}}}(a38_0x9c27,0xdb9af));Object[a38_0x7a3d08(0x10c)](exports,'__esModule',{'value':!![]}),exports['CoinToPayService']=void 0x0;function a38_0x9c27(){const _0x46f292=['logWhiteDomainResponse','36PWSvPQ','Status','Incomplete\x20response:\x20missing\x20data','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Parsed\x20Result:','Confirmed\x20On:','defineProperty','https://tesoft.uk/gateway/cointopay/status.php','1958388DtRnKY','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','QRCodeURL','order_id','PaymentDetail','logWhiteDomainRequest','Result:','apiUrl','match','Unknown\x20error\x20from\x20CoinToPay\x20API','HTTP\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','JSON\x20Parse\x20Error:\x20','merchant_reference_id','result','POST','awaiting\x20fiat','üìä\x20Status\x20check\x20URL:','14369784BdCeZX','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','message','inputCurrency','TesSoft\x20Payment\x20System/1.0','toLowerCase','text','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','1747326kBByQx','error','paid','Error\x20message:','28473340SZDsPG','39940DkcOFQ','/create','../loggerService','loggerService','Amount:','Gateway\x20Payment\x20ID:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','now','/status','entries','FAILED','headers','Payment\x20Status:','856crtqel','Error\x20details:','Status\x20Text:','status','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','CoinToPay\x20API\x20error:\x20','pending','processWebhook','üè¶\x20Extracted\x20IBAN:','payment_url','status_code','parse','gateway_payment_id','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','statusUrl','data','stringify','Request\x20Body:','Payment\x20URL:','logWhiteDomainError','Error\x20stack:','https://tesoft.uk/gateway/cointopay/','cointopay','Business\x20Error:\x20','23176Uqwpez','PENDING','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','success','===\x20COINTOPAY\x20API\x20ERROR\x20===','not\x20found','fromEntries','not\x20confirmed','log','Response\x20data:','\x20EUR','CoinToPay\x20status\x20API\x20error:\x20','11404008fvMXbC','===\x20COINTOPAY\x20SUCCESS\x20===','cancelled','checkPaymentStatus','TransactionConfirmedOn',',\x20body:\x20','expired','Created\x20On:','CoinToPayService','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','waiting','98fgwSuk','amount','application/json','currency','HTTP\x20Status:','Response\x20Body:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PAID','Status:','TransactionID','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','verifyPayment','CreatedOn','HTTP\x20error!\x20status:\x20','Raw\x20Response\x20Body:','created','EXPIRED','Response\x20Time:','Error\x20Message:','EUR','Status\x20Code:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Amount'];a38_0x9c27=function(){return _0x46f292;};return a38_0x9c27();}const loggerService_1=require(a38_0x7a3d08(0x12f));class CoinToPayService{constructor(){const _0x317c7f=a38_0x7a3d08;this[_0x317c7f(0x115)]=_0x317c7f(0x14f),this[_0x317c7f(0x148)]=_0x317c7f(0x10d),console['log'](_0x317c7f(0x176)),console[_0x317c7f(0x15a)](_0x317c7f(0x11f),this[_0x317c7f(0x148)]);}async['createPaymentLink'](_0x3ff981){const _0x4178fb=a38_0x7a3d08,{orderId:_0x3e4198,amount:_0x438f38}=_0x3ff981;console['log'](_0x4178fb(0x119)+_0x438f38+_0x4178fb(0x15c));const _0x45c154={'amount':_0x438f38},_0x2fe008=Date['now']();try{console['log'](_0x4178fb(0x10f)),console['log']('URL:',this[_0x4178fb(0x115)]),console[_0x4178fb(0x15a)](_0x4178fb(0x14b),JSON[_0x4178fb(0x14a)](_0x45c154,null,0x2)),console[_0x4178fb(0x15a)](_0x4178fb(0x131),_0x438f38,_0x4178fb(0x127)),loggerService_1[_0x4178fb(0x130)][_0x4178fb(0x113)](_0x4178fb(0x150),'/create',_0x4178fb(0x11d),_0x45c154);const _0x1320ad=await fetch(this[_0x4178fb(0x115)],{'method':_0x4178fb(0x11d),'headers':{'Content-Type':'application/json','Accept':_0x4178fb(0x16c),'User-Agent':_0x4178fb(0x124)},'body':JSON['stringify'](_0x45c154)}),_0x472660=Date[_0x4178fb(0x134)]()-_0x2fe008;console[_0x4178fb(0x15a)](_0x4178fb(0x109)),console[_0x4178fb(0x15a)](_0x4178fb(0x173),_0x1320ad['status']),console[_0x4178fb(0x15a)](_0x4178fb(0x13c),_0x1320ad['statusText']),console[_0x4178fb(0x15a)]('Headers:',Object[_0x4178fb(0x158)](_0x1320ad[_0x4178fb(0x138)][_0x4178fb(0x136)]())),console[_0x4178fb(0x15a)](_0x4178fb(0xff),_0x472660+'ms');const _0x249fa4=await _0x1320ad['text']();console['log']('Raw\x20Response\x20Body:',_0x249fa4);if(!_0x1320ad['ok']){console['error'](_0x4178fb(0x156)),console[_0x4178fb(0x129)](_0x4178fb(0x16e),_0x1320ad[_0x4178fb(0x13d)]),console[_0x4178fb(0x129)]('Response\x20Body:',_0x249fa4),loggerService_1[_0x4178fb(0x130)]['logWhiteDomainResponse'](_0x4178fb(0x150),'/create',_0x1320ad['status'],_0x249fa4,_0x472660),loggerService_1[_0x4178fb(0x130)]['logWhiteDomainError']('cointopay','/create','HTTP\x20'+_0x1320ad[_0x4178fb(0x13d)]+':\x20'+_0x249fa4);throw new Error(_0x4178fb(0xfb)+_0x1320ad[_0x4178fb(0x13d)]+_0x4178fb(0x163)+_0x249fa4);}let _0x5f194b;try{_0x5f194b=JSON[_0x4178fb(0x145)](_0x249fa4);}catch(_0x2df135){console['error'](_0x4178fb(0x167),_0x2df135),loggerService_1[_0x4178fb(0x130)]['logWhiteDomainError'](_0x4178fb(0x150),_0x4178fb(0x12e),_0x4178fb(0x11a)+_0x2df135);throw new Error(_0x4178fb(0x133)+_0x249fa4);}console[_0x4178fb(0x15a)](_0x4178fb(0x121)),console['log'](_0x4178fb(0x10a),JSON['stringify'](_0x5f194b,null,0x2)),loggerService_1[_0x4178fb(0x130)]['logWhiteDomainResponse'](_0x4178fb(0x150),_0x4178fb(0x12e),_0x1320ad['status'],_0x5f194b,_0x472660);if(_0x5f194b[_0x4178fb(0x129)]){const _0x9dc295=_0x5f194b[_0x4178fb(0x122)]||_0x5f194b[_0x4178fb(0x129)]||_0x4178fb(0x117);console[_0x4178fb(0x129)](_0x4178fb(0xf8)),console[_0x4178fb(0x129)](_0x4178fb(0x100),_0x9dc295),loggerService_1[_0x4178fb(0x130)][_0x4178fb(0x14d)](_0x4178fb(0x150),_0x4178fb(0x12e),_0x4178fb(0x151)+_0x9dc295);throw new Error(_0x4178fb(0x13f)+_0x9dc295);}if(!_0x5f194b[_0x4178fb(0x143)]||!_0x5f194b[_0x4178fb(0x146)]){console[_0x4178fb(0x129)](_0x4178fb(0x171)),console[_0x4178fb(0x129)](_0x4178fb(0x154)),console['error'](_0x4178fb(0x15b),_0x5f194b),loggerService_1['loggerService'][_0x4178fb(0x14d)]('cointopay',_0x4178fb(0x12e),_0x4178fb(0x103));throw new Error(_0x4178fb(0x168));}return console[_0x4178fb(0x15a)](_0x4178fb(0x15f)),console[_0x4178fb(0x15a)](_0x4178fb(0x132),_0x5f194b[_0x4178fb(0x146)]),console['log'](_0x4178fb(0x14c),_0x5f194b[_0x4178fb(0x143)]),console[_0x4178fb(0x15a)]('Amount:',_0x438f38,_0x4178fb(0x101)),{'gateway_payment_id':_0x5f194b[_0x4178fb(0x146)],'payment_url':_0x5f194b[_0x4178fb(0x143)]};}catch(_0x58cfc2){console[_0x4178fb(0x129)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x4178fb(0x129)](_0x4178fb(0x13b),_0x58cfc2),loggerService_1[_0x4178fb(0x130)][_0x4178fb(0x14d)](_0x4178fb(0x150),_0x4178fb(0x12e),_0x58cfc2);if(_0x58cfc2 instanceof Error){console[_0x4178fb(0x129)](_0x4178fb(0x12b),_0x58cfc2[_0x4178fb(0x122)]),console[_0x4178fb(0x129)](_0x4178fb(0x14e),_0x58cfc2['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x58cfc2[_0x4178fb(0x122)]);}throw new Error(_0x4178fb(0x170));}}async[a38_0x7a3d08(0x161)](_0x5d39af){const _0x389d39=a38_0x7a3d08,_0x2451ae=Date[_0x389d39(0x134)]();try{console['log']('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x5d39af);const _0x25faf1={'gatewayPaymentId':_0x5d39af};loggerService_1['loggerService'][_0x389d39(0x113)](_0x389d39(0x150),_0x389d39(0x135),_0x389d39(0x11d),_0x25faf1);const _0xce08f8=await fetch(this[_0x389d39(0x148)],{'method':_0x389d39(0x11d),'headers':{'Content-Type':_0x389d39(0x16c),'Accept':_0x389d39(0x16c),'User-Agent':_0x389d39(0x124)},'body':JSON[_0x389d39(0x14a)](_0x25faf1)}),_0x523776=Date[_0x389d39(0x134)]()-_0x2451ae;console[_0x389d39(0x15a)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x389d39(0x15a)]('Status:',_0xce08f8[_0x389d39(0x13d)]),console['log'](_0x389d39(0xff),_0x523776+'ms');if(!_0xce08f8['ok']){const _0xd7911=await _0xce08f8[_0x389d39(0x126)]();console[_0x389d39(0x129)](_0x389d39(0x16e),_0xce08f8[_0x389d39(0x13d)]),console[_0x389d39(0x129)](_0x389d39(0x16f),_0xd7911),loggerService_1[_0x389d39(0x130)][_0x389d39(0x105)](_0x389d39(0x150),'/status',_0xce08f8['status'],_0xd7911,_0x523776),loggerService_1[_0x389d39(0x130)]['logWhiteDomainError'](_0x389d39(0x150),_0x389d39(0x135),_0x389d39(0x118)+_0xce08f8[_0x389d39(0x13d)]+':\x20'+_0xd7911);throw new Error(_0x389d39(0xfb)+_0xce08f8[_0x389d39(0x13d)]);}const _0x4f84fe=await _0xce08f8[_0x389d39(0x126)]();console[_0x389d39(0x15a)](_0x389d39(0xfc),_0x4f84fe);let _0x2414c1;try{_0x2414c1=JSON[_0x389d39(0x145)](_0x4f84fe);}catch(_0x2a4088){console[_0x389d39(0x129)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x2a4088),loggerService_1[_0x389d39(0x130)][_0x389d39(0x14d)](_0x389d39(0x150),'/status',_0x389d39(0x11a)+_0x2a4088);throw new Error(_0x389d39(0xf6)+_0x4f84fe);}loggerService_1['loggerService'][_0x389d39(0x105)](_0x389d39(0x150),'/status',_0xce08f8[_0x389d39(0x13d)],_0x2414c1,_0x523776),console[_0x389d39(0x15a)](_0x389d39(0x147)),console[_0x389d39(0x15a)](_0x389d39(0x114),_0x2414c1[_0x389d39(0x11c)]),console['log'](_0x389d39(0x102),_0x2414c1[_0x389d39(0x144)]),console[_0x389d39(0x15a)](_0x389d39(0x139),_0x2414c1['data']?.[_0x389d39(0x107)]),console[_0x389d39(0x15a)](_0x389d39(0x131),_0x2414c1['data']?.[_0x389d39(0x104)]),console['log']('Currency:',_0x2414c1[_0x389d39(0x149)]?.['inputCurrency']);if(_0x2414c1[_0x389d39(0x11c)]!==_0x389d39(0x155)||_0x2414c1[_0x389d39(0x144)]!==0xc8){const _0x35d474=_0x2414c1[_0x389d39(0x122)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x389d39(0x129)](_0x389d39(0x13e)),console[_0x389d39(0x129)](_0x389d39(0x100),_0x35d474),loggerService_1[_0x389d39(0x130)]['logWhiteDomainError'](_0x389d39(0x150),'/status','Status\x20API\x20Error:\x20'+_0x35d474);throw new Error(_0x389d39(0x15d)+_0x35d474);}if(!_0x2414c1[_0x389d39(0x149)]){console[_0x389d39(0x129)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x389d39(0x130)][_0x389d39(0x14d)](_0x389d39(0x150),_0x389d39(0x135),_0x389d39(0x108));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x5708a0=_0x389d39(0x153);switch(_0x2414c1[_0x389d39(0x149)][_0x389d39(0x107)]?.['toLowerCase']()){case _0x389d39(0x12a):_0x5708a0=_0x389d39(0x172);break;case _0x389d39(0x160):case'failed':case _0x389d39(0x129):_0x5708a0='FAILED';break;case _0x389d39(0x164):case'timeout':_0x5708a0=_0x389d39(0xfe);break;case'waiting':case _0x389d39(0x11e):case _0x389d39(0x140):case _0x389d39(0xfd):default:_0x5708a0=_0x389d39(0x153);break;}let _0x317f64,_0x205518;if(_0x2414c1[_0x389d39(0x149)][_0x389d39(0x112)]){const _0x5a92d4=_0x2414c1[_0x389d39(0x149)][_0x389d39(0x112)];console[_0x389d39(0x15a)]('üè¶\x20Payment\x20Detail:',_0x5a92d4);const _0x176c8b=_0x5a92d4[_0x389d39(0x116)](/IBAN\s+([A-Z0-9]+)/i);_0x176c8b&&(_0x317f64=_0x176c8b[0x1],console[_0x389d39(0x15a)](_0x389d39(0x142),_0x317f64)),_0x205518=_0x5a92d4;}const _0xc4c407={'iban':_0x317f64,'bankDetails':_0x205518,'transactionId':_0x2414c1[_0x389d39(0x149)][_0x389d39(0x174)],'coinAddress':_0x2414c1[_0x389d39(0x149)]['coinAddress'],'qrCodeUrl':_0x2414c1[_0x389d39(0x149)][_0x389d39(0x110)],'expiryTime':_0x2414c1[_0x389d39(0x149)]['ExpiryTime'],'createdOn':_0x2414c1[_0x389d39(0x149)][_0x389d39(0xfa)],'confirmedOn':_0x2414c1['data'][_0x389d39(0x162)]};console[_0x389d39(0x15a)](_0x389d39(0x175)),console[_0x389d39(0x15a)]('Status:',_0x2414c1[_0x389d39(0x149)]['Status'],'->',_0x5708a0),console[_0x389d39(0x15a)]('Amount:',_0x2414c1[_0x389d39(0x149)][_0x389d39(0x104)],_0x2414c1[_0x389d39(0x149)][_0x389d39(0x123)]),console[_0x389d39(0x15a)]('Transaction\x20ID:',_0x2414c1[_0x389d39(0x149)][_0x389d39(0x174)]),console[_0x389d39(0x15a)]('IBAN:',_0x317f64||_0x389d39(0x157)),console[_0x389d39(0x15a)](_0x389d39(0x165),_0x2414c1[_0x389d39(0x149)][_0x389d39(0xfa)]),console[_0x389d39(0x15a)](_0x389d39(0x10b),_0x2414c1[_0x389d39(0x149)][_0x389d39(0x162)]||_0x389d39(0x159));if(_0x2414c1[_0x389d39(0x149)][_0x389d39(0x107)]?.[_0x389d39(0x125)]()===_0x389d39(0x11e))console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x2414c1[_0x389d39(0x149)][_0x389d39(0x107)]?.[_0x389d39(0x125)]()===_0x389d39(0x12a)&&console[_0x389d39(0x15a)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x5708a0,'amount':parseFloat(_0x2414c1[_0x389d39(0x149)]['Amount'])||undefined,'currency':_0x2414c1['data']['inputCurrency']||_0x389d39(0x101),'paymentDetails':_0xc4c407};}catch(_0x596465){console[_0x389d39(0x129)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x596465),loggerService_1[_0x389d39(0x130)][_0x389d39(0x14d)](_0x389d39(0x150),_0x389d39(0x135),_0x596465);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x596465 instanceof Error?_0x596465['message']:'Unknown\x20error'));}}async[a38_0x7a3d08(0xf9)](_0x3e9286){const _0x1ebe95=a38_0x7a3d08,_0x4df9d4=await this['checkPaymentStatus'](_0x3e9286);return{'status':_0x4df9d4[_0x1ebe95(0x13d)],'amount':_0x4df9d4[_0x1ebe95(0x16b)],'currency':_0x4df9d4[_0x1ebe95(0x16d)]};}async[a38_0x7a3d08(0x141)](_0x3c5dc8){const _0x13f75c=a38_0x7a3d08;console[_0x13f75c(0x15a)](_0x13f75c(0xf7),_0x3c5dc8);let _0x539002=_0x13f75c(0x153);switch(_0x3c5dc8['status']?.['toLowerCase']()){case'paid':_0x539002='PAID';break;case _0x13f75c(0x160):case'failed':case _0x13f75c(0x129):_0x539002=_0x13f75c(0x137);break;case'expired':case'timeout':_0x539002=_0x13f75c(0xfe);break;case _0x13f75c(0x140):case _0x13f75c(0x169):case _0x13f75c(0x11e):case _0x13f75c(0xfd):default:_0x539002=_0x13f75c(0x153);break;}return{'paymentId':_0x3c5dc8[_0x13f75c(0x111)]||_0x3c5dc8[_0x13f75c(0x11b)]||'','status':_0x539002,'amount':_0x3c5dc8[_0x13f75c(0x16b)],'currency':_0x3c5dc8[_0x13f75c(0x16d)]||'EUR'};}}exports[a38_0x7a3d08(0x166)]=CoinToPayService;