'use strict';const a41_0x5e0b27=a41_0x1090;(function(_0x160ccf,_0x5ef149){const _0x2a694e=a41_0x1090,_0xc25d04=_0x160ccf();while(!![]){try{const _0x26549d=-parseInt(_0x2a694e(0x188))/0x1*(parseInt(_0x2a694e(0x1a5))/0x2)+-parseInt(_0x2a694e(0x160))/0x3*(-parseInt(_0x2a694e(0x17e))/0x4)+-parseInt(_0x2a694e(0x163))/0x5*(-parseInt(_0x2a694e(0x151))/0x6)+-parseInt(_0x2a694e(0x1a7))/0x7*(parseInt(_0x2a694e(0x1aa))/0x8)+-parseInt(_0x2a694e(0x19d))/0x9*(-parseInt(_0x2a694e(0x173))/0xa)+-parseInt(_0x2a694e(0x183))/0xb*(-parseInt(_0x2a694e(0x146))/0xc)+parseInt(_0x2a694e(0x180))/0xd*(-parseInt(_0x2a694e(0x194))/0xe);if(_0x26549d===_0x5ef149)break;else _0xc25d04['push'](_0xc25d04['shift']());}catch(_0x4230ee){_0xc25d04['push'](_0xc25d04['shift']());}}}(a41_0x3aec,0xaefa7));Object['defineProperty'](exports,a41_0x5e0b27(0x172),{'value':!![]}),exports[a41_0x5e0b27(0x15d)]=void 0x0;function a41_0x3aec(){const _0x133512=['entries','createPayment','plisio_direct','Unknown\x20error','GET','Missing\x20txn_id\x20or\x20invoice_url\x20in\x20response','data','188636YgaVZC','üí∞\x20Plisio\x20service\x20initialized\x20with\x20direct\x20API','7GUhdgH','Error\x20details:','Response\x20Body:','6040240iemXQh','qr_url','Error\x20Message:','2292kDLDAK','order_number','error','URL:','env','expired','Target\x20Currency:','Failed\x20to\x20parse\x20JSON\x20response:','application/json','/operations/','parse','7683762PLTOav','===\x20PLISIO\x20DIRECT\x20API\x20RESPONSE\x20===','===\x20PLISIO\x20API\x20BUSINESS\x20ERROR\x20===','new',',\x20body:\x20','fromEntries','Invoice\x20URL:','warn','now','statusText','Failed\x20to\x20verify\x20Plisio\x20payment:\x20','TesSoft\x20Payment\x20System/1.0','PlisioService','===\x20PLISIO\x20API\x20ERROR\x20===','logWhiteDomainResponse','3uOmhCg','Failed\x20to\x20create\x20Plisio\x20payment:\x20Unknown\x20error','/invoices/new','5LgTtKY','processWebhook','text','Parsed\x20Result:','apiUrl','name','amount','Invalid\x20JSON\x20response\x20from\x20Plisio\x20API:\x20','Full\x20URL\x20(without\x20API\x20key):','https://api.trapay.uk/api/webhooks/gateway/plisio','logWhiteDomainError','txn_id','invoice_total_sum','(crypto\x20for\x20payment)','Raw\x20Response\x20Body:','__esModule','610HNuYVF','append','‚ö†Ô∏è\x20PLISIO_API_KEY\x20not\x20found\x20in\x20environment\x20variables','PENDING','log','Amount:','Response\x20data:','Response\x20Time:','json','invoice_url','cancelled','4942064YqphTf','currency','201851OmGerb','Status\x20Text:','source_amount','66363HeJBtz','Plisio\x20API\x20error:\x20','toString','Processing\x20Plisio\x20webhook:','source_currency','5iZiuuA','Transaction\x20ID:','qr_code','status','===\x20PLISIO\x20API\x20INCOMPLETE\x20RESPONSE\x20===','message','HIDDEN','loggerService','logWhiteDomainRequest','HTTP\x20error!\x20status:\x20','PLISIO_API_KEY','success','1904RNkAiw','apiKey','===\x20PLISIO\x20SUCCESS\x20===','https://api.plisio.net/api/v1/invoices/new','Plisio\x20API\x20key\x20is\x20not\x20configured','../loggerService','HTTP\x20Status:','toLowerCase','===\x20PLISIO\x20SERVICE\x20ERROR\x20===','57033RWtRkc'];a41_0x3aec=function(){return _0x133512;};return a41_0x3aec();}const loggerService_1=require(a41_0x5e0b27(0x199));function a41_0x1090(_0x66e982,_0x36174d){const _0x3aec4f=a41_0x3aec();return a41_0x1090=function(_0x109091,_0x4d79a1){_0x109091=_0x109091-0x145;let _0x8c8bee=_0x3aec4f[_0x109091];return _0x8c8bee;},a41_0x1090(_0x66e982,_0x36174d);}class PlisioService{constructor(){const _0x251e57=a41_0x5e0b27;this[_0x251e57(0x167)]=_0x251e57(0x197),this[_0x251e57(0x195)]=process[_0x251e57(0x14a)][_0x251e57(0x192)]||'',!this['apiKey']?console[_0x251e57(0x158)](_0x251e57(0x175)):console[_0x251e57(0x177)](_0x251e57(0x1a6));}async[a41_0x5e0b27(0x19f)](_0x5dd84a){const _0x3e8842=a41_0x5e0b27,{orderId:_0x2436c8,amount:_0x34b21e,currency:_0x483020,productName:_0x4eb457,description:_0x2f682c,successUrl:_0x452909,failUrl:_0x1b57f5,customerEmail:_0x2e272d,customerName:_0x2754cf,isSourceCurrency:_0x5584ff,sourceCurrency:_0x273a39}=_0x5dd84a;if(!this[_0x3e8842(0x195)])throw new Error(_0x3e8842(0x198));const _0x2fd89c=new URLSearchParams({'api_key':this[_0x3e8842(0x195)],'order_number':_0x2436c8,'order_name':_0x4eb457,'description':_0x2f682c,'success_url':_0x452909,'fail_url':_0x1b57f5,'callback_url':_0x3e8842(0x16c)});_0x273a39?(_0x2fd89c[_0x3e8842(0x174)]('currency',_0x273a39),_0x2fd89c[_0x3e8842(0x174)](_0x3e8842(0x187),_0x483020),_0x2fd89c['append'](_0x3e8842(0x182),_0x34b21e[_0x3e8842(0x185)]())):(_0x2fd89c[_0x3e8842(0x174)](_0x3e8842(0x17f),_0x483020),_0x2fd89c[_0x3e8842(0x174)]('amount',_0x34b21e['toString']()));_0x2e272d&&_0x2fd89c['append']('email',_0x2e272d);_0x2754cf&&_0x2fd89c[_0x3e8842(0x174)](_0x3e8842(0x168),_0x2754cf);const _0x28d53a=this[_0x3e8842(0x167)]+'?'+_0x2fd89c[_0x3e8842(0x185)](),_0x1685ed=Date[_0x3e8842(0x159)]();try{console[_0x3e8842(0x177)]('===\x20PLISIO\x20DIRECT\x20API\x20REQUEST\x20==='),console[_0x3e8842(0x177)](_0x3e8842(0x149),this[_0x3e8842(0x167)]),console[_0x3e8842(0x177)]('Parameters:',Object[_0x3e8842(0x156)](_0x2fd89c['entries']())),console[_0x3e8842(0x177)](_0x3e8842(0x16b),_0x28d53a['replace'](this[_0x3e8842(0x195)],_0x3e8842(0x18e))),loggerService_1[_0x3e8842(0x18f)][_0x3e8842(0x190)](_0x3e8842(0x1a0),_0x3e8842(0x162),'GET',Object[_0x3e8842(0x156)](_0x2fd89c[_0x3e8842(0x19e)]()));const _0x25c40a=await fetch(_0x28d53a,{'method':_0x3e8842(0x1a2),'headers':{'Accept':_0x3e8842(0x14e),'User-Agent':_0x3e8842(0x15c)}}),_0x4339c1=Date[_0x3e8842(0x159)]()-_0x1685ed;console[_0x3e8842(0x177)](_0x3e8842(0x152)),console[_0x3e8842(0x177)]('Status:',_0x25c40a[_0x3e8842(0x18b)]),console[_0x3e8842(0x177)](_0x3e8842(0x181),_0x25c40a[_0x3e8842(0x15a)]),console[_0x3e8842(0x177)](_0x3e8842(0x17a),_0x4339c1+'ms');const _0x4eca87=await _0x25c40a[_0x3e8842(0x165)]();console[_0x3e8842(0x177)](_0x3e8842(0x171),_0x4eca87);if(!_0x25c40a['ok']){console[_0x3e8842(0x148)](_0x3e8842(0x15e)),console[_0x3e8842(0x148)](_0x3e8842(0x19a),_0x25c40a[_0x3e8842(0x18b)]),console[_0x3e8842(0x148)](_0x3e8842(0x1a9),_0x4eca87),loggerService_1[_0x3e8842(0x18f)]['logWhiteDomainResponse'](_0x3e8842(0x1a0),_0x3e8842(0x162),_0x25c40a[_0x3e8842(0x18b)],_0x4eca87,_0x4339c1),loggerService_1[_0x3e8842(0x18f)]['logWhiteDomainError'](_0x3e8842(0x1a0),'/invoices/new','HTTP\x20'+_0x25c40a[_0x3e8842(0x18b)]+':\x20'+_0x4eca87);throw new Error(_0x3e8842(0x191)+_0x25c40a['status']+_0x3e8842(0x155)+_0x4eca87);}let _0x2c3196;try{_0x2c3196=JSON[_0x3e8842(0x150)](_0x4eca87);}catch(_0x500990){console[_0x3e8842(0x148)](_0x3e8842(0x14d),_0x500990),loggerService_1['loggerService']['logWhiteDomainError'](_0x3e8842(0x1a0),'/invoices/new','JSON\x20Parse\x20Error:\x20'+_0x500990);throw new Error(_0x3e8842(0x16a)+_0x4eca87);}console[_0x3e8842(0x177)]('===\x20PARSED\x20PLISIO\x20RESPONSE\x20==='),console[_0x3e8842(0x177)](_0x3e8842(0x166),JSON['stringify'](_0x2c3196,null,0x2)),loggerService_1[_0x3e8842(0x18f)]['logWhiteDomainResponse'](_0x3e8842(0x1a0),'/invoices/new',_0x25c40a[_0x3e8842(0x18b)],_0x2c3196,_0x4339c1);if(_0x2c3196[_0x3e8842(0x18b)]!==_0x3e8842(0x193)){const _0x12bbfe=_0x2c3196[_0x3e8842(0x18d)]||_0x2c3196[_0x3e8842(0x148)]||'Unknown\x20error\x20from\x20Plisio\x20API';console[_0x3e8842(0x148)](_0x3e8842(0x153)),console[_0x3e8842(0x148)](_0x3e8842(0x145),_0x12bbfe),loggerService_1[_0x3e8842(0x18f)][_0x3e8842(0x16d)](_0x3e8842(0x1a0),_0x3e8842(0x162),'Business\x20Error:\x20'+_0x12bbfe);throw new Error(_0x3e8842(0x184)+_0x12bbfe);}if(!_0x2c3196['data']?.[_0x3e8842(0x16e)]||!_0x2c3196['data']?.[_0x3e8842(0x17c)]){console[_0x3e8842(0x148)](_0x3e8842(0x18c)),console['error'](_0x3e8842(0x1a3)),console[_0x3e8842(0x148)](_0x3e8842(0x179),_0x2c3196[_0x3e8842(0x1a4)]),loggerService_1['loggerService'][_0x3e8842(0x16d)](_0x3e8842(0x1a0),'/invoices/new','Incomplete\x20response:\x20missing\x20txn_id\x20or\x20invoice_url');throw new Error('Invalid\x20response\x20from\x20Plisio\x20API:\x20missing\x20txn_id\x20or\x20invoice_url');}return console[_0x3e8842(0x177)](_0x3e8842(0x196)),console[_0x3e8842(0x177)](_0x3e8842(0x189),_0x2c3196[_0x3e8842(0x1a4)][_0x3e8842(0x16e)]),console[_0x3e8842(0x177)](_0x3e8842(0x157),_0x2c3196[_0x3e8842(0x1a4)][_0x3e8842(0x17c)]),console[_0x3e8842(0x177)](_0x3e8842(0x178),_0x34b21e,_0x483020),_0x273a39&&(console[_0x3e8842(0x177)]('Source\x20Currency:',_0x273a39,_0x3e8842(0x170)),console[_0x3e8842(0x177)](_0x3e8842(0x14c),_0x483020,'(fiat\x20for\x20merchant)')),{'gateway_payment_id':_0x2c3196[_0x3e8842(0x1a4)][_0x3e8842(0x16e)],'payment_url':_0x2c3196['data'][_0x3e8842(0x17c)],'invoice_total_sum':_0x2c3196[_0x3e8842(0x1a4)][_0x3e8842(0x16f)],'qr_code':_0x2c3196[_0x3e8842(0x1a4)][_0x3e8842(0x18a)],'qr_url':_0x2c3196[_0x3e8842(0x1a4)][_0x3e8842(0x1ab)]};}catch(_0x34dfda){console[_0x3e8842(0x148)](_0x3e8842(0x19c)),console['error'](_0x3e8842(0x1a8),_0x34dfda),loggerService_1[_0x3e8842(0x18f)][_0x3e8842(0x16d)]('plisio_direct',_0x3e8842(0x162),_0x34dfda);if(_0x34dfda instanceof Error){console[_0x3e8842(0x148)]('Error\x20message:',_0x34dfda[_0x3e8842(0x18d)]),console[_0x3e8842(0x148)]('Error\x20stack:',_0x34dfda['stack']);throw new Error('Failed\x20to\x20create\x20Plisio\x20payment:\x20'+_0x34dfda[_0x3e8842(0x18d)]);}throw new Error(_0x3e8842(0x161));}}async['verifyPayment'](_0x29d5b2){const _0x10ec28=a41_0x5e0b27,_0x51eab3=Date[_0x10ec28(0x159)]();try{if(!this[_0x10ec28(0x195)])throw new Error(_0x10ec28(0x198));const _0x1bc427=new URLSearchParams({'api_key':this[_0x10ec28(0x195)],'txn_id':_0x29d5b2}),_0x18193e='https://api.plisio.net/api/v1/operations/'+_0x29d5b2+'?'+_0x1bc427[_0x10ec28(0x185)]();loggerService_1[_0x10ec28(0x18f)][_0x10ec28(0x190)]('plisio_direct',_0x10ec28(0x14f)+_0x29d5b2,_0x10ec28(0x1a2),Object['fromEntries'](_0x1bc427[_0x10ec28(0x19e)]()));const _0x211c49=await fetch(_0x18193e,{'method':'GET','headers':{'Accept':_0x10ec28(0x14e),'User-Agent':_0x10ec28(0x15c)}}),_0x3222dd=Date[_0x10ec28(0x159)]()-_0x51eab3;if(!_0x211c49['ok']){const _0x487e36=await _0x211c49[_0x10ec28(0x165)]();loggerService_1[_0x10ec28(0x18f)][_0x10ec28(0x15f)](_0x10ec28(0x1a0),_0x10ec28(0x14f)+_0x29d5b2,_0x211c49['status'],_0x487e36,_0x3222dd);throw new Error(_0x10ec28(0x191)+_0x211c49[_0x10ec28(0x18b)]);}const _0x362ce2=await _0x211c49[_0x10ec28(0x17b)]();loggerService_1[_0x10ec28(0x18f)][_0x10ec28(0x15f)](_0x10ec28(0x1a0),'/operations/'+_0x29d5b2,_0x211c49[_0x10ec28(0x18b)],_0x362ce2,_0x3222dd);if(_0x362ce2[_0x10ec28(0x18b)]!==_0x10ec28(0x193)){loggerService_1['loggerService'][_0x10ec28(0x16d)](_0x10ec28(0x1a0),_0x10ec28(0x14f)+_0x29d5b2,_0x10ec28(0x184)+(_0x362ce2[_0x10ec28(0x18d)]||_0x362ce2['error']||_0x10ec28(0x1a1)));throw new Error(_0x10ec28(0x184)+(_0x362ce2['message']||_0x362ce2[_0x10ec28(0x148)]||_0x10ec28(0x1a1)));}let _0xf4119e=_0x10ec28(0x176);return{'status':_0xf4119e};}catch(_0x271111){console[_0x10ec28(0x148)]('Plisio\x20payment\x20verification\x20error:',_0x271111),loggerService_1[_0x10ec28(0x18f)][_0x10ec28(0x16d)]('plisio_direct',_0x10ec28(0x14f)+_0x29d5b2,_0x271111);throw new Error(_0x10ec28(0x15b)+(_0x271111 instanceof Error?_0x271111[_0x10ec28(0x18d)]:'Unknown\x20error'));}}async[a41_0x5e0b27(0x164)](_0x21d07c){const _0x2d3781=a41_0x5e0b27;console[_0x2d3781(0x177)](_0x2d3781(0x186),_0x21d07c);let _0x27a16d='PENDING';switch(_0x21d07c[_0x2d3781(0x18b)]?.[_0x2d3781(0x19b)]()){case'completed':case'mismatch':_0x27a16d='PAID';break;case _0x2d3781(0x14b):_0x27a16d='EXPIRED';break;case _0x2d3781(0x148):case _0x2d3781(0x17d):_0x27a16d='FAILED';break;case _0x2d3781(0x154):case'pending':default:_0x27a16d='PENDING';break;}return{'paymentId':_0x21d07c[_0x2d3781(0x147)]||'','status':_0x27a16d,'amount':_0x21d07c[_0x2d3781(0x169)],'currency':_0x21d07c['currency']};}}exports[a41_0x5e0b27(0x15d)]=PlisioService;