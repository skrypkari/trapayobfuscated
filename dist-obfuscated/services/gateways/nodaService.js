'use strict';const a40_0x4229e2=a40_0x3769;function a40_0x3769(_0xeb3f2c,_0x435f77){const _0x28690c=a40_0x2869();return a40_0x3769=function(_0x37695c,_0x411d67){_0x37695c=_0x37695c-0xb7;let _0x39a50e=_0x28690c[_0x37695c];return _0x39a50e;},a40_0x3769(_0xeb3f2c,_0x435f77);}(function(_0x522ff4,_0x1341f9){const _0x174df6=a40_0x3769,_0x193596=_0x522ff4();while(!![]){try{const _0x482a88=-parseInt(_0x174df6(0xeb))/0x1+-parseInt(_0x174df6(0xfa))/0x2*(-parseInt(_0x174df6(0xee))/0x3)+parseInt(_0x174df6(0x11e))/0x4+-parseInt(_0x174df6(0x11b))/0x5*(-parseInt(_0x174df6(0x129))/0x6)+parseInt(_0x174df6(0xbf))/0x7+parseInt(_0x174df6(0x117))/0x8+parseInt(_0x174df6(0xd3))/0x9*(-parseInt(_0x174df6(0x128))/0xa);if(_0x482a88===_0x1341f9)break;else _0x193596['push'](_0x193596['shift']());}catch(_0x1a454b){_0x193596['push'](_0x193596['shift']());}}}(a40_0x2869,0x1d377));Object[a40_0x4229e2(0xc2)](exports,a40_0x4229e2(0xd4),{'value':!![]}),exports[a40_0x4229e2(0x110)]=void 0x0;const loggerService_1=require('../loggerService');class NodaService{constructor(){const _0x44bf27=a40_0x4229e2;this[_0x44bf27(0xef)]=_0x44bf27(0xd0),console['log'](_0x44bf27(0x112));}async[a40_0x4229e2(0xb9)](_0x1b6f3e){const _0x3a2009=a40_0x4229e2,{orderId:_0x10c247,name:_0x3746af,paymentDescription:_0x495e13,amount:_0x52bf54,currency:_0x34a386,webhookUrl:_0x3ce493,returnUrl:_0x565d43,expiryDate:_0x1d5ac0}=_0x1b6f3e,_0x40f136=_0x34a386[_0x3a2009(0x11d)](),_0x51cc35=_0x3a2009(0x121),_0x351215=_0x3a2009(0x105)+_0x10c247,_0x52cba4={'name':_0x3746af,'paymentDescription':_0x495e13,'amount':_0x52bf54,'currency':_0x40f136,'paymentId':_0x10c247,'webhookUrl':_0x51cc35,'returnUrl':_0x351215};_0x1d5ac0&&(_0x52cba4[_0x3a2009(0xb7)]=_0x1d5ac0);const _0x160222=Date[_0x3a2009(0xe6)]();try{console[_0x3a2009(0xd8)](_0x3a2009(0xf8)),console[_0x3a2009(0xd8)]('URL:',this['apiUrl']),console[_0x3a2009(0xd8)](_0x3a2009(0xc3),JSON[_0x3a2009(0x10d)](_0x52cba4,null,0x2)),console[_0x3a2009(0xd8)](_0x3a2009(0x10a),_0x10c247,_0x3a2009(0x116)),loggerService_1[_0x3a2009(0xf3)]['logWhiteDomainRequest'](_0x3a2009(0x111),'/payment-links',_0x3a2009(0xfc),_0x52cba4);const _0x4a70d0=await fetch(this[_0x3a2009(0xef)],{'method':_0x3a2009(0xfc),'headers':{'Content-Type':_0x3a2009(0xf9),'Accept':_0x3a2009(0xf9),'User-Agent':_0x3a2009(0x10b)},'body':JSON[_0x3a2009(0x10d)](_0x52cba4)}),_0x4481fc=Date[_0x3a2009(0xe6)]()-_0x160222;console[_0x3a2009(0xd8)](_0x3a2009(0xdd)),console[_0x3a2009(0xd8)](_0x3a2009(0xe0),_0x4a70d0[_0x3a2009(0x124)]),console['log']('Status\x20Text:',_0x4a70d0['statusText']),console[_0x3a2009(0xd8)](_0x3a2009(0xfe),Object['fromEntries'](_0x4a70d0[_0x3a2009(0xc9)][_0x3a2009(0xdc)]())),console[_0x3a2009(0xd8)]('Response\x20Time:',_0x4481fc+'ms');const _0xc080ad=await _0x4a70d0['text']();console['log']('Raw\x20Response\x20Body:',_0xc080ad);if(!_0x4a70d0['ok']){console[_0x3a2009(0xc7)](_0x3a2009(0x127)),console[_0x3a2009(0xc7)](_0x3a2009(0xbd),_0x4a70d0['status']),console[_0x3a2009(0xc7)](_0x3a2009(0x106),_0xc080ad),loggerService_1[_0x3a2009(0xf3)]['logWhiteDomainResponse'](_0x3a2009(0x111),_0x3a2009(0xe3),_0x4a70d0[_0x3a2009(0x124)],_0xc080ad,_0x4481fc),loggerService_1[_0x3a2009(0xf3)][_0x3a2009(0xed)]('noda',_0x3a2009(0xe3),_0x3a2009(0xe4)+_0x4a70d0[_0x3a2009(0x124)]+':\x20'+_0xc080ad);if(_0x4a70d0[_0x3a2009(0x124)]===0x190)throw new Error('One\x20of\x20the\x20required\x20parameters\x20is\x20missing\x20or\x20has\x20an\x20incorrect\x20value');else{if(_0x4a70d0[_0x3a2009(0x124)]===0x1f4)throw new Error(_0x3a2009(0xff));}throw new Error('HTTP\x20error!\x20status:\x20'+_0x4a70d0[_0x3a2009(0x124)]+_0x3a2009(0xf6)+_0xc080ad);}let _0x30222a;try{_0x30222a=JSON[_0x3a2009(0x108)](_0xc080ad);}catch(_0x16dfad){console[_0x3a2009(0xc7)](_0x3a2009(0x102),_0x16dfad),loggerService_1[_0x3a2009(0xf3)][_0x3a2009(0xed)](_0x3a2009(0x111),_0x3a2009(0xe3),_0x3a2009(0xe8)+_0x16dfad);throw new Error(_0x3a2009(0x109)+_0xc080ad);}console[_0x3a2009(0xd8)](_0x3a2009(0xcc)),console[_0x3a2009(0xd8)](_0x3a2009(0xe7),JSON[_0x3a2009(0x10d)](_0x30222a,null,0x2)),loggerService_1[_0x3a2009(0xf3)][_0x3a2009(0x113)](_0x3a2009(0x111),'/payment-links',_0x4a70d0[_0x3a2009(0x124)],_0x30222a,_0x4481fc);if(_0x30222a['error']||_0x30222a['statusCode']){const _0x5bf3cf=_0x30222a[_0x3a2009(0x120)]||_0x30222a['error']||_0x3a2009(0xdf);console[_0x3a2009(0xc7)]('===\x20NODA\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x3a2009(0xc7)](_0x3a2009(0xe5),_0x5bf3cf),console[_0x3a2009(0xc7)](_0x3a2009(0x125),_0x30222a['statusCode']),loggerService_1['loggerService'][_0x3a2009(0xed)]('noda',_0x3a2009(0xe3),_0x3a2009(0xfb)+_0x5bf3cf);throw new Error(_0x3a2009(0xbe)+_0x5bf3cf);}if(!_0x30222a['id']||!_0x30222a[_0x3a2009(0xd5)]?.['shortLink']){console[_0x3a2009(0xc7)]('===\x20NODA\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3a2009(0xc7)]('Missing\x20id\x20or\x20shortLink\x20in\x20response'),console[_0x3a2009(0xc7)](_0x3a2009(0x11c),_0x30222a),loggerService_1[_0x3a2009(0xf3)]['logWhiteDomainError']('noda',_0x3a2009(0xe3),_0x3a2009(0xda));throw new Error(_0x3a2009(0x107));}return console['log']('===\x20NODA\x20SUCCESS\x20==='),console[_0x3a2009(0xd8)](_0x3a2009(0x126),_0x30222a['id']),console[_0x3a2009(0xd8)](_0x3a2009(0x100),_0x30222a[_0x3a2009(0xd5)][_0x3a2009(0xe2)]),console['log'](_0x3a2009(0xd9),_0x30222a['shortLinkUrls'][_0x3a2009(0xf1)]||_0x3a2009(0xd2)),console[_0x3a2009(0xd8)](_0x3a2009(0xba),_0x10c247,_0x3a2009(0xca)),{'gateway_payment_id':_0x30222a['id'],'payment_url':_0x30222a['shortLinkUrls'][_0x3a2009(0xe2)],'qr_code_url':_0x30222a[_0x3a2009(0xd5)]['qrCodeLink'],'expiry_date':_0x30222a[_0x3a2009(0xb7)]};}catch(_0x160d99){console[_0x3a2009(0xc7)]('===\x20NODA\x20SERVICE\x20ERROR\x20==='),console[_0x3a2009(0xc7)](_0x3a2009(0x10c),_0x160d99),loggerService_1[_0x3a2009(0xf3)][_0x3a2009(0xed)](_0x3a2009(0x111),_0x3a2009(0xe3),_0x160d99);if(_0x160d99 instanceof Error){console[_0x3a2009(0xc7)](_0x3a2009(0xde),_0x160d99[_0x3a2009(0x120)]),console[_0x3a2009(0xc7)](_0x3a2009(0xbb),_0x160d99[_0x3a2009(0xd6)]);throw new Error(_0x3a2009(0x101)+_0x160d99[_0x3a2009(0x120)]);}throw new Error('Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x4229e2(0xc8)](_0x55e9e8){const _0x256e46=a40_0x4229e2,_0x397e01=Date[_0x256e46(0xe6)]();try{loggerService_1['loggerService'][_0x256e46(0xf2)](_0x256e46(0x111),_0x256e46(0xcd)+_0x55e9e8,'GET',{});const _0x595b3f=await fetch(this[_0x256e46(0xef)]+'/'+_0x55e9e8,{'method':'GET','headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'}}),_0x52b9e4=Date[_0x256e46(0xe6)]()-_0x397e01;if(!_0x595b3f['ok']){const _0x286af9=await _0x595b3f[_0x256e46(0xfd)]();loggerService_1['loggerService'][_0x256e46(0x113)](_0x256e46(0x111),_0x256e46(0xcd)+_0x55e9e8,_0x595b3f[_0x256e46(0x124)],_0x286af9,_0x52b9e4);throw new Error('HTTP\x20error!\x20status:\x20'+_0x595b3f[_0x256e46(0x124)]);}const _0x47ff90=await _0x595b3f[_0x256e46(0xbc)]();loggerService_1[_0x256e46(0xf3)][_0x256e46(0x113)]('noda',_0x256e46(0xcd)+_0x55e9e8,_0x595b3f[_0x256e46(0x124)],_0x47ff90,_0x52b9e4);if(_0x47ff90[_0x256e46(0xc7)]||_0x47ff90[_0x256e46(0xf7)]){loggerService_1[_0x256e46(0xf3)][_0x256e46(0xed)](_0x256e46(0x111),_0x256e46(0xcd)+_0x55e9e8,'Noda\x20API\x20error:\x20'+(_0x47ff90[_0x256e46(0x120)]||_0x47ff90[_0x256e46(0xc7)]||_0x256e46(0x11f)));throw new Error(_0x256e46(0xbe)+(_0x47ff90[_0x256e46(0x120)]||_0x47ff90[_0x256e46(0xc7)]||'Unknown\x20error'));}let _0x5b883a=_0x256e46(0xc6);if(_0x47ff90[_0x256e46(0xec)]===![]){if(_0x47ff90[_0x256e46(0xb7)]){const _0x338ee8=new Date(_0x47ff90[_0x256e46(0xb7)]),_0xbce41b=new Date();_0x338ee8<_0xbce41b?_0x5b883a=_0x256e46(0x104):_0x5b883a=_0x256e46(0xea);}else _0x5b883a='FAILED';}else _0x5b883a=_0x256e46(0xc6);return{'status':_0x5b883a,'amount':_0x47ff90[_0x256e46(0xb8)],'currency':_0x47ff90[_0x256e46(0xf0)],'isActive':_0x47ff90[_0x256e46(0xec)]};}catch(_0x4e1a32){console[_0x256e46(0xc7)]('Noda\x20payment\x20verification\x20error:',_0x4e1a32),loggerService_1[_0x256e46(0xf3)][_0x256e46(0xed)]('noda',_0x256e46(0xcd)+_0x55e9e8,_0x4e1a32);throw new Error(_0x256e46(0xc5)+(_0x4e1a32 instanceof Error?_0x4e1a32['message']:_0x256e46(0x11f)));}}async[a40_0x4229e2(0x118)](_0x1655f6){const _0x83cb4f=a40_0x4229e2;console[_0x83cb4f(0xd8)](_0x83cb4f(0x123),_0x1655f6);let _0x58de74=_0x83cb4f(0xc6);switch(_0x1655f6['Status']?.['toLowerCase']()){case _0x83cb4f(0x10e):case'completed':case _0x83cb4f(0xc1):case'success':case'successful':_0x1655f6[_0x83cb4f(0xe9)]===_0x83cb4f(0xe1)?_0x58de74=_0x83cb4f(0x10f):_0x58de74='PENDING';break;case _0x83cb4f(0x122):case _0x83cb4f(0xc0):case'failed':case _0x83cb4f(0xc7):case'rejected':_0x58de74=_0x83cb4f(0xea);break;case'expired':case'timeout':_0x58de74='EXPIRED';break;case _0x83cb4f(0x119):case'created':case _0x83cb4f(0xd7):case _0x83cb4f(0xdb):case'in_progress':default:_0x58de74=_0x83cb4f(0xc6);break;}return{'paymentId':_0x1655f6[_0x83cb4f(0x114)]||_0x1655f6[_0x83cb4f(0xcb)],'status':_0x58de74,'amount':_0x1655f6[_0x83cb4f(0x103)],'currency':_0x1655f6[_0x83cb4f(0x11a)],'additionalInfo':{'method':_0x1655f6[_0x83cb4f(0x115)],'bankId':_0x1655f6[_0x83cb4f(0xf5)],'settled':_0x1655f6[_0x83cb4f(0xe9)],'settlementDate':_0x1655f6['SettlementDate'],'remitterName':_0x1655f6['Remitter']?.[_0x83cb4f(0xce)],'remitterIban':_0x1655f6[_0x83cb4f(0xf4)]?.['Iban'],'bankTransactionId':_0x1655f6[_0x83cb4f(0xc4)]}};}[a40_0x4229e2(0xcf)](_0x14c125,_0x144562){const _0x1baff3=a40_0x4229e2;return console[_0x1baff3(0xd8)](_0x1baff3(0xd1),{'receivedSignature':_0x144562,'paymentId':_0x14c125[_0x1baff3(0xcb)],'merchantPaymentId':_0x14c125[_0x1baff3(0x114)]}),!![];}}function a40_0x2869(){const _0x334547=['Yes','shortLink','/payment-links','HTTP\x20','Error\x20Message:','now','Parsed\x20Result:','JSON\x20Parse\x20Error:\x20','Settled','FAILED','9248NGMeah','isActive','logWhiteDomainError','91359jtuPVI','apiUrl','currency','qrCodeLink','logWhiteDomainRequest','loggerService','Remitter','BankId',',\x20body:\x20','statusCode','===\x20NODA\x20API\x20REQUEST\x20(White\x20Domain\x20-\x20Direct\x20JSON)\x20===','application/json','14HgEmnQ','Business\x20Error:\x20','POST','text','Headers:','All\x20the\x20required\x20parameters\x20are\x20missing,\x20so\x20the\x20request\x20is\x20invalid','Short\x20Link:','Failed\x20to\x20create\x20Noda\x20payment\x20link:\x20','Failed\x20to\x20parse\x20JSON\x20response:','Amount','EXPIRED','https://tesoft.uk/gateway/success.php?id=','Response\x20Body:','Invalid\x20response\x20from\x20Noda\x20API:\x20missing\x20id\x20or\x20shortLink','parse','Invalid\x20JSON\x20response\x20from\x20Noda\x20API:\x20','Order\x20ID\x20Format:','TesSoft\x20Payment\x20System/1.0','Error\x20details:','stringify','done','PAID','NodaService','noda','ðŸŒ\x20Noda\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','logWhiteDomainResponse','MerchantPaymentId','Method','(8digits-8digits\x20format\x20for\x20Noda)','434896YYfQdM','processWebhook','pending','Currency','95iDGUnW','Response\x20data:','toUpperCase','677704WCJHIh','Unknown\x20error','message','https://tesoft.uk/gateway/noda/webhook/','cancelled','Processing\x20Noda\x20webhook:','status','Status\x20Code:','Payment\x20Link\x20ID:','===\x20NODA\x20API\x20ERROR\x20===','380SCEiwp','2454aKoCpz','expiryDate','amount','createPaymentLink','Order\x20ID\x20Used:','Error\x20stack:','json','HTTP\x20Status:','Noda\x20API\x20error:\x20','1377929GdaRvn','canceled','paid','defineProperty','Request\x20Body\x20(Direct\x20JSON):','BankTransactionId','Failed\x20to\x20verify\x20Noda\x20payment:\x20','PENDING','error','verifyPayment','headers','(8digits-8digits\x20format)','PaymentId','===\x20PARSED\x20NODA\x20RESPONSE\x20===','/payment-links/','Name','verifyWebhookSignature','https://tesoft.uk/gateway/noda/','Noda\x20webhook\x20signature\x20verification:','Not\x20provided','121419chHBoS','__esModule','shortLinkUrls','stack','active','log','QR\x20Code\x20Link:','Incomplete\x20response:\x20missing\x20id\x20or\x20shortLink','processing','entries','===\x20NODA\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20message:','Unknown\x20error\x20from\x20Noda\x20API','Status:'];a40_0x2869=function(){return _0x334547;};return a40_0x2869();}exports[a40_0x4229e2(0x110)]=NodaService;