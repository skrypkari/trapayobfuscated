'use strict';const a61_0x327f3f=a61_0x36fa;(function(_0x303079,_0x59e18b){const _0x430afc=a61_0x36fa,_0x14f58c=_0x303079();while(!![]){try{const _0x3bd11c=parseInt(_0x430afc(0x1ec))/0x1*(parseInt(_0x430afc(0x295))/0x2)+-parseInt(_0x430afc(0x299))/0x3*(parseInt(_0x430afc(0x219))/0x4)+parseInt(_0x430afc(0x1e5))/0x5+-parseInt(_0x430afc(0x261))/0x6+-parseInt(_0x430afc(0x27f))/0x7*(parseInt(_0x430afc(0x25c))/0x8)+-parseInt(_0x430afc(0x220))/0x9+parseInt(_0x430afc(0x26b))/0xa*(parseInt(_0x430afc(0x258))/0xb);if(_0x3bd11c===_0x59e18b)break;else _0x14f58c['push'](_0x14f58c['shift']());}catch(_0x671039){_0x14f58c['push'](_0x14f58c['shift']());}}}(a61_0x59b3,0xb5259));var __importDefault=this&&this[a61_0x327f3f(0x238)]||function(_0x1a403b){const _0x11b249=a61_0x327f3f;return _0x1a403b&&_0x1a403b[_0x11b249(0x237)]?_0x1a403b:{'default':_0x1a403b};};Object['defineProperty'](exports,a61_0x327f3f(0x237),{'value':!![]}),exports[a61_0x327f3f(0x29e)]=exports[a61_0x327f3f(0x1d2)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a61_0x327f3f(0x1de))),database_1=__importDefault(require('../config/database')),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x2bed26=a61_0x327f3f;this[_0x2bed26(0x22c)]=null,this['botToken']=process['env'][_0x2bed26(0x2b5)]||'',this[_0x2bed26(0x1d7)]=process['env'][_0x2bed26(0x1e2)]||_0x2bed26(0x29a),this[_0x2bed26(0x270)]?this[_0x2bed26(0x24e)]():console['warn'](_0x2bed26(0x1fd));}[a61_0x327f3f(0x24e)](){const _0x5838fc=a61_0x327f3f;try{this['bot']=new node_telegram_bot_api_1[(_0x5838fc(0x207))](this['botToken'],{'polling':!![]}),this[_0x5838fc(0x241)](),console[_0x5838fc(0x1eb)](_0x5838fc(0x23f)+this[_0x5838fc(0x1d7)]+_0x5838fc(0x1f5));}catch(_0x2e4e06){console[_0x5838fc(0x1e7)](_0x5838fc(0x224),_0x2e4e06);}}[a61_0x327f3f(0x241)](){const _0x4ddc1b=a61_0x327f3f;if(!this[_0x4ddc1b(0x22c)])return;this[_0x4ddc1b(0x22c)][_0x4ddc1b(0x253)](/\/start/,async _0x2b6e01=>{const _0x35992f=_0x4ddc1b,_0x218d3e=_0x2b6e01[_0x35992f(0x210)]['id'],_0xf6e989=_0x2b6e01['from']?.['id'][_0x35992f(0x1ed)](),_0x5ece44=_0x2b6e01[_0x35992f(0x269)]?.[_0x35992f(0x1db)],_0x432595=_0x2b6e01[_0x35992f(0x269)]?.[_0x35992f(0x2a9)],_0x4277b3=_0x2b6e01[_0x35992f(0x269)]?.[_0x35992f(0x288)];if(!_0xf6e989)return;try{let _0x3c4560=await database_1['default'][_0x35992f(0x262)][_0x35992f(0x20b)]({'where':{'telegramId':_0xf6e989},'include':{'shop':!![]}});!_0x3c4560?(_0x3c4560=await database_1[_0x35992f(0x207)][_0x35992f(0x262)][_0x35992f(0x23d)]({'data':{'telegramId':_0xf6e989,'username':_0x5ece44,'firstName':_0x432595,'lastName':_0x4277b3,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x35992f(0x1eb)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0xf6e989+'\x20(@'+_0x5ece44+')')):_0x3c4560=await database_1[_0x35992f(0x207)][_0x35992f(0x262)][_0x35992f(0x221)]({'where':{'telegramId':_0xf6e989},'data':{'username':_0x5ece44,'firstName':_0x432595,'lastName':_0x4277b3},'include':{'shop':!![]}}),_0x3c4560['isVerified']&&_0x3c4560[_0x35992f(0x2a4)]&&_0x3c4560['shop']?await this['bot']?.['sendMessage'](_0x218d3e,_0x35992f(0x1e4)+(_0x35992f(0x208)+_0x3c4560[_0x35992f(0x211)][_0x35992f(0x2b1)]+'*\x0a')+(_0x35992f(0x214)+_0x3c4560[_0x35992f(0x211)][_0x35992f(0x1db)]+_0x35992f(0x1e6))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x35992f(0x1f6)+_0x35992f(0x252)+_0x35992f(0x1d5)+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x35992f(0x28f),{'parse_mode':_0x35992f(0x2aa)}):(_0x3c4560[_0x35992f(0x2a4)]&&!_0x3c4560[_0x35992f(0x29f)]&&(await database_1[_0x35992f(0x207)]['telegramUser'][_0x35992f(0x221)]({'where':{'telegramId':_0xf6e989},'data':{'shopId':null,'isVerified':![]}}),console[_0x35992f(0x1eb)](_0x35992f(0x25e)+_0xf6e989)),await this['bot']?.[_0x35992f(0x1d9)](_0x218d3e,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x35992f(0x21e)+_0x35992f(0x23c)+'Example:\x0a'+_0x35992f(0x29d)+_0x35992f(0x235),{'parse_mode':_0x35992f(0x2aa)}));}catch(_0x1e52df){console[_0x35992f(0x1e7)]('Error\x20handling\x20/start\x20command:',_0x1e52df),await this[_0x35992f(0x22c)]?.['sendMessage'](_0x218d3e,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x4ddc1b(0x22c)][_0x4ddc1b(0x253)](/\/disconnect/,async _0x322466=>{const _0x553155=_0x4ddc1b,_0x74834a=_0x322466[_0x553155(0x210)]['id'],_0x5e9cbb=_0x322466[_0x553155(0x269)]?.['id'][_0x553155(0x1ed)]();if(!_0x5e9cbb)return;try{const _0x1345db=await database_1[_0x553155(0x207)][_0x553155(0x262)][_0x553155(0x20b)]({'where':{'telegramId':_0x5e9cbb},'include':{'shop':!![]}});if(!_0x1345db||!_0x1345db[_0x553155(0x29f)]||!_0x1345db['shopId']){await this['bot']?.[_0x553155(0x1d9)](_0x74834a,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x201b96=_0x1345db[_0x553155(0x211)]?.[_0x553155(0x2b1)]||_0x553155(0x265);await database_1[_0x553155(0x207)]['telegramUser'][_0x553155(0x221)]({'where':{'telegramId':_0x5e9cbb},'data':{'shopId':null,'isVerified':![]}}),console[_0x553155(0x1eb)](_0x553155(0x290)+_0x5e9cbb+_0x553155(0x242)+_0x1345db[_0x553155(0x2a4)]),await this[_0x553155(0x22c)]?.[_0x553155(0x1d9)](_0x74834a,_0x553155(0x233)+_0x201b96+_0x553155(0x27e)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x553155(0x2aa)});}catch(_0x8b1584){console[_0x553155(0x1e7)]('Error\x20handling\x20/disconnect\x20command:',_0x8b1584),await this['bot']?.[_0x553155(0x1d9)](_0x74834a,_0x553155(0x22d));}}),this['bot'][_0x4ddc1b(0x253)](/\/status/,async _0x4a309b=>{const _0xb1b16e=_0x4ddc1b,_0x19fcb2=_0x4a309b['chat']['id'],_0x55ea65=_0x4a309b[_0xb1b16e(0x269)]?.['id'][_0xb1b16e(0x1ed)]();if(!_0x55ea65)return;try{const _0x39475b=await database_1['default'][_0xb1b16e(0x262)][_0xb1b16e(0x20b)]({'where':{'telegramId':_0x55ea65},'include':{'shop':!![]}});if(!_0x39475b){await this[_0xb1b16e(0x22c)]?.[_0xb1b16e(0x1d9)](_0x19fcb2,_0xb1b16e(0x256)+_0xb1b16e(0x1f3));return;}if(!_0x39475b[_0xb1b16e(0x29f)]||!_0x39475b[_0xb1b16e(0x2a4)]||!_0x39475b[_0xb1b16e(0x211)]){await this[_0xb1b16e(0x22c)]?.[_0xb1b16e(0x1d9)](_0x19fcb2,_0xb1b16e(0x21b)+_0xb1b16e(0x280));return;}await this[_0xb1b16e(0x22c)]?.[_0xb1b16e(0x1d9)](_0x19fcb2,_0xb1b16e(0x205)+(_0xb1b16e(0x298)+_0x39475b[_0xb1b16e(0x211)][_0xb1b16e(0x2b1)]+'*\x0a')+(_0xb1b16e(0x1d3)+_0x39475b[_0xb1b16e(0x211)][_0xb1b16e(0x1db)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x39475b['updatedAt'][_0xb1b16e(0x24c)](_0xb1b16e(0x1ff))+'\x0a\x0a')+_0xb1b16e(0x213)+_0xb1b16e(0x28a)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0xb1b16e(0x2aa)});}catch(_0x205087){console[_0xb1b16e(0x1e7)](_0xb1b16e(0x2ab),_0x205087),await this[_0xb1b16e(0x22c)]?.[_0xb1b16e(0x1d9)](_0x19fcb2,_0xb1b16e(0x22d));}}),this[_0x4ddc1b(0x22c)][_0x4ddc1b(0x253)](/\/debug/,async _0x55e772=>{const _0x297534=_0x4ddc1b,_0x38f1ab=_0x55e772[_0x297534(0x210)]['id'],_0x11bfac=_0x55e772['from']?.['id']['toString']();if(!_0x11bfac)return;try{const _0x400965=await database_1[_0x297534(0x207)][_0x297534(0x211)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x32daa2=_0x297534(0x2ae);_0x32daa2+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x11bfac+'`\x0a\x0a',_0x32daa2+=_0x297534(0x297),_0x400965[_0x297534(0x1fa)]((_0x32b4f8,_0x184247)=>{const _0x22006a=_0x297534;_0x32daa2+=_0x184247+0x1+'.\x20*'+_0x32b4f8[_0x22006a(0x2b1)]+'*\x0a',_0x32daa2+=_0x22006a(0x218)+_0x32b4f8[_0x22006a(0x1db)]+'`\x0a',_0x32daa2+=_0x22006a(0x275)+_0x32b4f8[_0x22006a(0x2b7)]+'\x0a',_0x32daa2+='\x20\x20\x20Public\x20Key:\x20`'+_0x32b4f8[_0x22006a(0x223)]['substring'](0x0,0xf)+'...`\x0a\x0a';}),await this['bot']?.[_0x297534(0x1d9)](_0x38f1ab,_0x32daa2,{'parse_mode':_0x297534(0x2aa)});}catch(_0x672ecb){console[_0x297534(0x1e7)]('Error\x20handling\x20/debug\x20command:',_0x672ecb),await this[_0x297534(0x22c)]?.[_0x297534(0x1d9)](_0x38f1ab,'❌\x20Error\x20getting\x20debug\x20information.');}}),this['bot']['on'](_0x4ddc1b(0x263),async _0x5f4a2a=>{const _0x1fc7ce=_0x4ddc1b;if(_0x5f4a2a[_0x1fc7ce(0x294)]?.[_0x1fc7ce(0x29b)]('/'))return;const _0x24d31b=_0x5f4a2a['chat']['id'],_0x308887=_0x5f4a2a[_0x1fc7ce(0x269)]?.['id']['toString'](),_0x780ee1=_0x5f4a2a['text']?.[_0x1fc7ce(0x273)]();if(!_0x308887||!_0x780ee1)return;try{const _0x5ea5c3=await database_1['default'][_0x1fc7ce(0x262)]['findUnique']({'where':{'telegramId':_0x308887},'include':{'shop':!![]}});if(!_0x5ea5c3){await this['bot']?.[_0x1fc7ce(0x1d9)](_0x24d31b,_0x1fc7ce(0x25a));return;}if(_0x5ea5c3[_0x1fc7ce(0x29f)]&&_0x5ea5c3[_0x1fc7ce(0x2a4)]&&_0x5ea5c3[_0x1fc7ce(0x211)]){await this[_0x1fc7ce(0x22c)]?.['sendMessage'](_0x24d31b,_0x1fc7ce(0x23e)+_0x5ea5c3['shop'][_0x1fc7ce(0x2b1)]+_0x1fc7ce(0x27e)+_0x1fc7ce(0x1df),{'parse_mode':'Markdown'});return;}const _0x286d8c=_0x780ee1[_0x1fc7ce(0x21d)](/\s+/);if(_0x286d8c[_0x1fc7ce(0x209)]!==0x2){await this['bot']?.['sendMessage'](_0x24d31b,_0x1fc7ce(0x204)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x1fc7ce(0x24f)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x1fc7ce(0x1d8)+_0x286d8c['length']+_0x1fc7ce(0x245)+_0x286d8c[_0x1fc7ce(0x201)](_0x32c05c=>'`'+_0x32c05c+'`')[_0x1fc7ce(0x203)](',\x20')),{'parse_mode':_0x1fc7ce(0x2aa)});return;}const [_0x2871c8,_0x41cf0d]=_0x286d8c;console[_0x1fc7ce(0x1eb)](_0x1fc7ce(0x264)+_0x308887+_0x1fc7ce(0x20a)+_0x2871c8+_0x1fc7ce(0x281)+_0x41cf0d['substring'](0x0,0xa)+_0x1fc7ce(0x27b)),await this[_0x1fc7ce(0x292)](_0x24d31b,_0x308887,_0x2871c8,_0x41cf0d);}catch(_0x5c9085){console[_0x1fc7ce(0x1e7)](_0x1fc7ce(0x282),_0x5c9085),await this[_0x1fc7ce(0x22c)]?.[_0x1fc7ce(0x1d9)](_0x24d31b,_0x1fc7ce(0x22d));}}),this[_0x4ddc1b(0x22c)]['on'](_0x4ddc1b(0x1e7),_0x13c562=>{const _0x13350e=_0x4ddc1b;console[_0x13350e(0x1e7)](_0x13350e(0x260),_0x13c562);}),this['bot']['on'](_0x4ddc1b(0x22f),_0x182c37=>{const _0x3d458d=_0x4ddc1b;console[_0x3d458d(0x1e7)]('Telegram\x20bot\x20polling\x20error:',_0x182c37);});}async[a61_0x327f3f(0x292)](_0x429e53,_0x13c085,_0x416c5d,_0x9a0af0){const _0x800289=a61_0x327f3f;try{console[_0x800289(0x1eb)](_0x800289(0x264)+_0x13c085+':\x20username=\x22'+_0x416c5d+_0x800289(0x281)+_0x9a0af0[_0x800289(0x222)](0x0,0xa)+_0x800289(0x27b));if(!_0x416c5d||_0x416c5d[_0x800289(0x209)]<0x3||_0x416c5d[_0x800289(0x209)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x416c5d)){await this[_0x800289(0x22c)]?.[_0x800289(0x1d9)](_0x429e53,_0x800289(0x284)+_0x416c5d+_0x800289(0x1e6)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':'Markdown'});return;}if(!_0x9a0af0||!_0x9a0af0[_0x800289(0x29b)](_0x800289(0x25f))&&!_0x9a0af0[_0x800289(0x29b)]('sk_')){await this[_0x800289(0x22c)]?.[_0x800289(0x1d9)](_0x429e53,_0x800289(0x293)+_0x800289(0x23b),{'parse_mode':_0x800289(0x2aa)});return;}const _0xd185f0=await database_1[_0x800289(0x207)][_0x800289(0x211)]['findUnique']({'where':{'username':_0x416c5d},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0xd185f0){const _0x2ca969=await database_1[_0x800289(0x207)]['shop'][_0x800289(0x2af)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x3840e2=_0x800289(0x277)+_0x416c5d+_0x800289(0x283);_0x2ca969[_0x800289(0x209)]>0x0?(_0x3840e2+=_0x800289(0x1f0),_0x2ca969['forEach'](_0x58c702=>{const _0x1a509c=_0x800289;_0x3840e2+='•\x20`'+_0x58c702[_0x1a509c(0x1db)]+'`\x20('+_0x58c702[_0x1a509c(0x2b1)]+')\x0a';}),_0x3840e2+=_0x800289(0x234)):_0x3840e2+=_0x800289(0x24b);await this[_0x800289(0x22c)]?.[_0x800289(0x1d9)](_0x429e53,_0x3840e2,{'parse_mode':_0x800289(0x2aa)});return;}if(_0xd185f0[_0x800289(0x2b7)]!==_0x800289(0x24a)){await this[_0x800289(0x22c)]?.[_0x800289(0x1d9)](_0x429e53,'❌\x20Shop\x20`'+_0x416c5d+_0x800289(0x1fb)+_0x800289(0x236),{'parse_mode':_0x800289(0x2aa)});return;}if(_0xd185f0[_0x800289(0x223)]!==_0x9a0af0&&_0xd185f0[_0x800289(0x1fe)]!==_0x9a0af0){await this[_0x800289(0x22c)]?.[_0x800289(0x1d9)](_0x429e53,_0x800289(0x1fc)+_0x416c5d+_0x800289(0x230)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':'Markdown'});return;}const _0x2ab6d9=await database_1[_0x800289(0x207)][_0x800289(0x262)][_0x800289(0x1ea)]({'where':{'shopId':_0xd185f0['id'],'isVerified':!![],'telegramId':{'not':_0x13c085}}});if(_0x2ab6d9){await this['bot']?.[_0x800289(0x1d9)](_0x429e53,_0x800289(0x1e0)+_0x416c5d+_0x800289(0x230)+_0x800289(0x22e),{'parse_mode':_0x800289(0x2aa)});return;}await database_1[_0x800289(0x207)][_0x800289(0x262)][_0x800289(0x221)]({'where':{'telegramId':_0x13c085},'data':{'shopId':_0xd185f0['id'],'isVerified':!![]}}),await this['bot']?.[_0x800289(0x1d9)](_0x429e53,_0x800289(0x24d)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('📱\x20Shop:\x20*'+_0xd185f0[_0x800289(0x2b1)]+'*\x0a')+(_0x800289(0x1d3)+_0xd185f0[_0x800289(0x1db)]+_0x800289(0x1e6))+_0x800289(0x2b4)+_0x800289(0x1f6)+_0x800289(0x252)+_0x800289(0x2ad)+_0x800289(0x26f)+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}),console[_0x800289(0x1eb)](_0x800289(0x267)+_0x13c085+_0x800289(0x249)+_0xd185f0[_0x800289(0x1db)]+_0x800289(0x240));}catch(_0x57e280){console['error'](_0x800289(0x21f),_0x57e280),await this['bot']?.[_0x800289(0x1d9)](_0x429e53,_0x800289(0x28c));}}async[a61_0x327f3f(0x216)](_0x1f0048,_0x539a4c,_0x1b7b51){const _0x50ae95=a61_0x327f3f;if(!this['bot']){console[_0x50ae95(0x1f4)](_0x50ae95(0x296));return;}try{const _0x416e14=await database_1[_0x50ae95(0x207)][_0x50ae95(0x262)][_0x50ae95(0x2af)]({'where':{'shopId':_0x1f0048,'isVerified':!![]}});if(_0x416e14['length']===0x0){console[_0x50ae95(0x1eb)](_0x50ae95(0x200)+_0x1f0048);return;}const _0x534775=_0x416e14[_0x50ae95(0x201)](async _0x1870a6=>{const _0x123022=_0x50ae95;try{await this[_0x123022(0x22c)]?.[_0x123022(0x1d9)](_0x1870a6[_0x123022(0x274)],_0x539a4c,_0x1b7b51),console[_0x123022(0x1eb)](_0x123022(0x1e3)+_0x1870a6[_0x123022(0x274)]);}catch(_0x368747){console[_0x123022(0x1e7)](_0x123022(0x232)+_0x1870a6['telegramId']+':',_0x368747),_0x368747 instanceof Error&&(_0x368747[_0x123022(0x263)][_0x123022(0x28d)](_0x123022(0x231))||_0x368747[_0x123022(0x263)]['includes'](_0x123022(0x20f))||_0x368747[_0x123022(0x263)][_0x123022(0x28d)](_0x123022(0x25d)))&&(await database_1[_0x123022(0x207)][_0x123022(0x262)][_0x123022(0x221)]({'where':{'id':_0x1870a6['id']},'data':{'isVerified':![]}}),console[_0x123022(0x1eb)](_0x123022(0x1f8)+_0x1870a6[_0x123022(0x274)]+_0x123022(0x250)));}});await Promise[_0x50ae95(0x239)](_0x534775);}catch(_0x22b3b3){console[_0x50ae95(0x1e7)](_0x50ae95(0x248),_0x22b3b3);}}async['sendPaymentNotification'](_0x310520,_0x4bfdc3,_0x435453){const _0x469620=a61_0x327f3f,_0x12b839={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x480347={'created':'New\x20payment\x20created','paid':_0x469620(0x20d),'failed':_0x469620(0x28b),'expired':_0x469620(0x276),'refund':'Payment\x20refund','chargeback':_0x469620(0x271),'processing':_0x469620(0x21c)},_0x276348=_0x12b839[_0x435453],_0x58b96c=_0x480347[_0x435453],_0x5ba2f2=(0x0,gateway_1[_0x469620(0x1d4)])(_0x4bfdc3[_0x469620(0x279)]);console[_0x469620(0x1eb)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x4bfdc3[_0x469620(0x279)]+_0x469620(0x2b3)+_0x5ba2f2+'\x22');let _0x1bc11e=_0x276348+'\x20*'+_0x58b96c+_0x469620(0x29c)+(_0x469620(0x27a)+_0x4bfdc3[_0x469620(0x2a2)]+'\x20'+_0x4bfdc3[_0x469620(0x206)]+'*\x0a')+(_0x469620(0x1f7)+(_0x4bfdc3[_0x469620(0x229)]||_0x4bfdc3['id'])+'`\x0a')+(_0x469620(0x2b2)+_0x4bfdc3['id']+'`\x0a')+(_0x469620(0x254)+_0x5ba2f2+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x4bfdc3['createdAt'])['toLocaleString']('en-US')+'\x0a');if(_0x4bfdc3[_0x469620(0x268)]||_0x4bfdc3['customerEmail']||_0x4bfdc3[_0x469620(0x28e)]||_0x4bfdc3[_0x469620(0x26c)]||_0x4bfdc3[_0x469620(0x217)]){_0x1bc11e+=_0x469620(0x228);_0x4bfdc3['customerName']&&(_0x1bc11e+=_0x469620(0x1e1)+_0x4bfdc3[_0x469620(0x268)]+'`\x0a');_0x4bfdc3['customerEmail']&&(_0x1bc11e+=_0x469620(0x255)+_0x4bfdc3[_0x469620(0x2a7)]+'`\x0a');_0x4bfdc3[_0x469620(0x28e)]&&(_0x1bc11e+='🏦\x20IBAN:\x20`'+_0x4bfdc3[_0x469620(0x28e)]+'`\x0a');_0x4bfdc3[_0x469620(0x26c)]&&(_0x1bc11e+=_0x469620(0x227)+_0x4bfdc3[_0x469620(0x26c)]+'`\x0a');if(_0x4bfdc3[_0x469620(0x217)]){const _0x10d982=_0x4bfdc3[_0x469620(0x217)][_0x469620(0x209)]>0x32?_0x4bfdc3[_0x469620(0x217)]['substring'](0x0,0x32)+_0x469620(0x251):_0x4bfdc3[_0x469620(0x217)];_0x1bc11e+='💻\x20Browser:\x20`'+_0x10d982+'`\x0a';}}_0x435453===_0x469620(0x259)&&_0x4bfdc3['chargebackAmount']&&(_0x1bc11e+=_0x469620(0x2a0)+_0x4bfdc3['chargebackAmount']+_0x469620(0x2b8)),_0x435453==='processing'&&(_0x1bc11e+=_0x469620(0x286)),_0x4bfdc3[_0x469620(0x2b0)]&&(_0x1bc11e+=_0x469620(0x257)+_0x4bfdc3['adminNotes']+'\x0a'),await this['sendShopNotification'](_0x310520,_0x1bc11e,{'parse_mode':'Markdown'});}async[a61_0x327f3f(0x1dc)](_0x3a6253,_0x192ba8,_0x1406c1){const _0x57386=a61_0x327f3f,_0x3f679e={'created':'📤','completed':'✅','rejected':'❌'},_0x4f17c7={'created':_0x57386(0x1dd),'completed':'Payout\x20completed','rejected':_0x57386(0x2a8)},_0x42645b=_0x3f679e[_0x1406c1],_0xea6bfa=_0x4f17c7[_0x1406c1],_0x53dcd3=_0x42645b+'\x20*'+_0xea6bfa+_0x57386(0x29c)+(_0x57386(0x291)+_0x192ba8[_0x57386(0x2a2)]+_0x57386(0x247))+('🏦\x20Method:\x20`'+_0x192ba8['method']+'`\x0a')+(_0x57386(0x2ac)+_0x192ba8['id']+'`\x0a')+(_0x57386(0x1f1)+new Date(_0x192ba8[_0x57386(0x2a6)])[_0x57386(0x2b6)]('en-US')+'\x0a')+(_0x192ba8[_0x57386(0x287)]?_0x57386(0x212)+_0x192ba8['txid']+'`':'');await this[_0x57386(0x216)](_0x3a6253,_0x53dcd3,{'parse_mode':_0x57386(0x2aa)});}async['sendLoginNotification'](_0x2708c0,_0x19123b){const _0x45f2be=a61_0x327f3f;try{const _0xadcedd=await database_1[_0x45f2be(0x207)]['shopSettings'][_0x45f2be(0x20b)]({'where':{'shopId':_0x2708c0},'select':{'notificationLogin':!![]}});if(!_0xadcedd?.['notificationLogin']){console[_0x45f2be(0x1eb)](_0x45f2be(0x244)+_0x2708c0);return;}const _0x13c487=_0x19123b['success']?'🔐':'🚨',_0x5f3783=_0x19123b[_0x45f2be(0x1da)]?_0x45f2be(0x20e):'Failed\x20login\x20attempt';let _0x146823=_0x13c487+'\x20*'+_0x5f3783+_0x45f2be(0x29c)+(_0x45f2be(0x1d3)+_0x19123b['username']+'`\x0a')+('📅\x20Time:\x20'+_0x19123b[_0x45f2be(0x1e9)]['toLocaleString'](_0x45f2be(0x1ff))+'\x0a');_0x19123b['ipAddress']&&(_0x146823+=_0x45f2be(0x26a)+_0x19123b['ipAddress']+'`\x0a');if(_0x19123b['userAgent']){const _0x15dbeb=_0x19123b[_0x45f2be(0x215)][_0x45f2be(0x209)]>0x32?_0x19123b['userAgent'][_0x45f2be(0x222)](0x0,0x32)+_0x45f2be(0x251):_0x19123b[_0x45f2be(0x215)];_0x146823+=_0x45f2be(0x25b)+_0x15dbeb+'`\x0a';}!_0x19123b['success']&&(_0x146823+=_0x45f2be(0x272)),await this[_0x45f2be(0x216)](_0x2708c0,_0x146823,{'parse_mode':_0x45f2be(0x2aa)}),console[_0x45f2be(0x1eb)](_0x45f2be(0x1f9)+_0x2708c0+':\x20'+(_0x19123b['success']?'success':_0x45f2be(0x226)));}catch(_0x8868a6){console[_0x45f2be(0x1e7)](_0x45f2be(0x2a5),_0x8868a6);}}async[a61_0x327f3f(0x26e)](_0x3d0b1f,_0x3c93ea){const _0x32d041=a61_0x327f3f;try{const _0x3e98b7=await database_1['default'][_0x32d041(0x1ef)][_0x32d041(0x20b)]({'where':{'shopId':_0x3d0b1f},'select':{'notificationApiError':!![]}});if(!_0x3e98b7?.['notificationApiError']){console[_0x32d041(0x1eb)](_0x32d041(0x20c)+_0x3d0b1f);return;}let _0x5349e8=_0x32d041(0x289)+(_0x32d041(0x278)+_0x3c93ea[_0x32d041(0x246)]+'\x20'+_0x3c93ea[_0x32d041(0x26d)]+'`\x0a')+(_0x32d041(0x1f2)+_0x3c93ea[_0x32d041(0x1e9)]['toLocaleString']('en-US')+'\x0a');_0x3c93ea['statusCode']&&(_0x5349e8+=_0x32d041(0x266)+_0x3c93ea[_0x32d041(0x1ee)]+'`\x0a'),_0x5349e8+=_0x32d041(0x243)+_0x3c93ea['errorMessage']+'`\x0a',_0x3c93ea[_0x32d041(0x225)]&&(_0x5349e8+=_0x32d041(0x1d6)+_0x3c93ea[_0x32d041(0x225)]+'`\x0a'),_0x5349e8+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x32d041(0x216)](_0x3d0b1f,_0x5349e8,{'parse_mode':'Markdown'}),console[_0x32d041(0x1eb)](_0x32d041(0x2a3)+_0x3d0b1f+':\x20'+_0x3c93ea[_0x32d041(0x26d)]);}catch(_0x1d16ce){console[_0x32d041(0x1e7)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x1d16ce);}}async[a61_0x327f3f(0x285)](_0x552128,_0x3c57b3,_0x151fec){const _0x29ea0e=a61_0x327f3f;let _0x1e46d4=_0x29ea0e(0x2a1)+_0x3c57b3+_0x29ea0e(0x29c);for(const [_0x4596f3,_0x59d95f]of Object['entries'](_0x151fec)){_0x59d95f!==null&&_0x59d95f!==undefined&&(_0x1e46d4+=_0x4596f3+_0x29ea0e(0x22b)+_0x59d95f+'`\x0a');}await this[_0x29ea0e(0x216)](_0x552128,_0x1e46d4,{'parse_mode':_0x29ea0e(0x2aa)});}async[a61_0x327f3f(0x202)](_0x2b8f2c){const _0x1e4225=a61_0x327f3f;try{console[_0x1e4225(0x1eb)](_0x1e4225(0x22a)+_0x2b8f2c[_0x1e4225(0x222)](0x0,0x32)+'...');const _0x123e7a=await database_1[_0x1e4225(0x207)]['telegramUser'][_0x1e4225(0x2af)]({'select':{'telegramId':!![]}});if(_0x123e7a[_0x1e4225(0x209)]===0x0){console['log'](_0x1e4225(0x1e8));return;}for(const _0x2675fd of _0x123e7a){try{await this['bot']?.['sendMessage'](_0x2675fd[_0x1e4225(0x274)],_0x2b8f2c,{'parse_mode':_0x1e4225(0x2aa)});}catch(_0x1bc4f1){console[_0x1e4225(0x1e7)]('❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20'+_0x2675fd[_0x1e4225(0x274)]+':',_0x1bc4f1);}}console['log'](_0x1e4225(0x27c)+_0x123e7a[_0x1e4225(0x209)]+'\x20users');}catch(_0x227732){console[_0x1e4225(0x1e7)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:',_0x227732);}}['getBotInfo'](){const _0x16ed83=a61_0x327f3f;return{'isActive':!!this[_0x16ed83(0x22c)],'username':this['botUsername']};}[a61_0x327f3f(0x21a)](){const _0x138a94=a61_0x327f3f;this[_0x138a94(0x22c)]&&(this['bot'][_0x138a94(0x27d)](),this[_0x138a94(0x22c)]=null,console[_0x138a94(0x1eb)](_0x138a94(0x23a)));}}function a61_0x36fa(_0x1fc7fd,_0x43e9c7){const _0x59b3e9=a61_0x59b3();return a61_0x36fa=function(_0x36fa21,_0x1820dd){_0x36fa21=_0x36fa21-0x1d2;let _0xc17d94=_0x59b3e9[_0x36fa21];return _0xc17d94;},a61_0x36fa(_0x1fc7fd,_0x43e9c7);}exports[a61_0x327f3f(0x1d2)]=TelegramBotService,exports[a61_0x327f3f(0x29e)]=new TelegramBotService();function a61_0x59b3(){const _0x1b3930=['split','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Error\x20in\x20handleSingleLineVerification:','4485087ExtIax','update','substring','publicKey','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','requestId','failed','🌐\x20IP:\x20`','\x0a👤\x20*Customer\x20Information:*\x0a','orderId','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20',':\x20`','bot','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','polling_error','`.\x0a\x0a','blocked','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','\x0aCheck\x20spelling\x20and\x20try\x20again.','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','Contact\x20administrator.','__esModule','__importDefault','allSettled','🛑\x20Telegram\x20bot\x20stopped','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','create','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','✅\x20Telegram\x20bot\x20@','\x20via\x20single-line\x20input','setupBotHandlers','\x20disconnected\x20from\x20shop\x20','❌\x20Error:\x20`','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','\x20parts:\x20','method','\x20USD*\x0a','Error\x20sending\x20shop\x20notification:','\x20verified\x20for\x20shop\x20','ACTIVE','Check\x20spelling\x20and\x20try\x20again.','toLocaleDateString','🎉\x20*Congratulations!*\x0a\x0a','initializeBot','Example:\x0a','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','...','•\x20Payment\x20status\x20changes\x0a','onText','🏪\x20Gateway:\x20`','📧\x20Email:\x20`','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','📝\x20Notes:\x20','14219623QwzSpe','chargeback','❌\x20Please\x20use\x20/start\x20command\x20first','💻\x20Browser:\x20`','8zQqgFs','user\x20is\x20deactivated','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','pk_','Telegram\x20bot\x20error:','1222638kCBWBO','telegramUser','message','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','unknown\x20shop','📊\x20Error\x20code:\x20`','✅\x20Telegram\x20user\x20','customerName','from','🌐\x20IP\x20address:\x20`','10wSgVZa','customerIp','endpoint','sendApiErrorNotification','•\x20Important\x20events\x0a\x0a','botToken','Payment\x20chargeback','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','trim','telegramId','\x20\x20\x20Status:\x20','Payment\x20expired','❌\x20Shop\x20with\x20username\x20`','🔗\x20Endpoint:\x20`','gateway','💰\x20Amount:\x20*','...\x22','📱\x20Notification\x20sent\x20to\x20','stopPolling','*.\x0a\x0a','4592350iDRcjY','Use\x20/start\x20to\x20connect.','\x22,\x20apiKey=\x22','Error\x20handling\x20message:','`\x20not\x20found.\x0a\x0a','❌\x20Invalid\x20username\x20format:\x20`','sendCustomNotification','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','txid','last_name','🚨\x20*API\x20Error*\x0a\x0a','Commands:\x0a','Payment\x20failed','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','includes','remitterIban','/disconnect\x20-\x20disconnect\x20from\x20notifications','🔌\x20User\x20','💸\x20Amount:\x20*','handleSingleLineVerification','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','text','390706XQeuOZ','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','🏪\x20Available\x20shops\x20in\x20system:\x0a','✅\x20Connected\x20to\x20shop:\x20*','3YJRhtE','trapay_bot','startsWith','*\x0a\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','telegramBotService','isVerified','💸\x20Penalty\x20amount:\x20*','🔔\x20*','amount','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','shopId','Failed\x20to\x20send\x20login\x20notification:','createdAt','customerEmail','Payout\x20rejected','first_name','Markdown','Error\x20handling\x20/status\x20command:','🆔\x20Payout\x20ID:\x20`','•\x20Payouts\x0a','🔍\x20*Debug\x20Information*\x0a\x0a','findMany','adminNotes','name','🆔\x20Payment\x20ID:\x20`','\x22\x20->\x20display\x20\x22','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','TELEGRAM_BOT_TOKEN','toLocaleString','status','\x20USDT*\x0a','TelegramBotService','👤\x20Username:\x20`','getGatewayDisplayNameForTelegram','•\x20Payouts\x0a\x0a','🆔\x20Request\x20ID:\x20`','botUsername','You\x20sent\x20','sendMessage','success','username','sendPayoutNotification','New\x20payout\x20created','node-telegram-bot-api','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','📛\x20Name:\x20`','TELEGRAM_BOT_USERNAME','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','✅\x20Welcome\x20back!\x0a\x0a','4765875FkyFQZ','`\x0a\x0a','error','📱\x20No\x20active\x20Telegram\x20users\x20found','timestamp','findFirst','log','4djVoxq','toString','statusCode','shopSettings','Available\x20usernames:\x0a','📅\x20Date:\x20','📅\x20Time:\x20','Use\x20/start\x20to\x20begin.','warn','\x20initialized\x20successfully','•\x20New\x20payments\x0a','📝\x20Order\x20ID:\x20`','User\x20','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','forEach','`\x20is\x20inactive.\x0a\x0a','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','secretKey','en-US','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','map','sendNotificationToAll','join','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','📊\x20*Connection\x20Status*\x0a\x0a','currency','default','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','length',':\x20username=\x22','findUnique','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Payment\x20successfully\x20paid','Successful\x20login','chat\x20not\x20found','chat','shop','🔗\x20TXID:\x20`','🔔\x20Notifications\x20are\x20active\x0a\x0a','Username:\x20`','userAgent','sendShopNotification','customerUa','\x20\x20\x20Username:\x20`','3708548UOmTAY','stopBot','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','Payment\x20is\x20being\x20processed'];a61_0x59b3=function(){return _0x1b3930;};return a61_0x59b3();}