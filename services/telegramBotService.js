'use strict';const a55_0x16b278=a55_0x5dd9;(function(_0x34c8fc,_0x3c9c4e){const _0x228ea1=a55_0x5dd9,_0x3657b1=_0x34c8fc();while(!![]){try{const _0x3aceaa=parseInt(_0x228ea1(0x10a))/0x1*(-parseInt(_0x228ea1(0x14e))/0x2)+-parseInt(_0x228ea1(0x12a))/0x3+parseInt(_0x228ea1(0xac))/0x4+-parseInt(_0x228ea1(0xde))/0x5*(parseInt(_0x228ea1(0x14a))/0x6)+parseInt(_0x228ea1(0x90))/0x7+parseInt(_0x228ea1(0x106))/0x8*(parseInt(_0x228ea1(0xd0))/0x9)+-parseInt(_0x228ea1(0x14d))/0xa*(-parseInt(_0x228ea1(0x13d))/0xb);if(_0x3aceaa===_0x3c9c4e)break;else _0x3657b1['push'](_0x3657b1['shift']());}catch(_0x4722be){_0x3657b1['push'](_0x3657b1['shift']());}}}(a55_0x57f1,0x1f490));function a55_0x57f1(){const _0x3cdb9e=['getGatewayDisplayNameForTelegram','Payment\x20failed','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','text','Error\x20sending\x20shop\x20notification:','Payment\x20expired','You\x20sent\x20','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','success','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','shopSettings','Contact\x20administrator.','toLocaleString','warn','•\x20Payment\x20status\x20changes\x0a','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','startsWith','90tIPIBA','`\x20is\x20inactive.\x0a\x0a','📅\x20Time:\x20','`\x20(','TELEGRAM_BOT_USERNAME','toString','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','Successful\x20login','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','handleSingleLineVerification','Commands:\x0a','Example:\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','611885dRKmNl','shop','🌐\x20IP\x20address:\x20`','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','findUnique','error','📝\x20Notes:\x20','Failed\x20to\x20send\x20API\x20error\x20notification:','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','❌\x20Error\x20getting\x20debug\x20information.','/disconnect\x20-\x20disconnect\x20from\x20notifications','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','customerName','ACTIVE','timestamp','name','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','telegramUser','👤\x20Username:\x20`','notificationApiError','Markdown','💻\x20Browser:\x20`','✅\x20Telegram\x20user\x20','•\x20Payouts\x0a\x0a','*\x0a\x0a','\x20\x20\x20Username:\x20`','isVerified','endpoint','findFirst','📊\x20*Connection\x20Status*\x0a\x0a','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','/status\x20-\x20check\x20connection\x20status\x0a','chat','userAgent','log','chat\x20not\x20found','sk_','sendApiErrorNotification','txid','69376gMjyIO','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','\x20parts:\x20','📅\x20Date:\x20','2UPTuMl','Username:\x20`','Payment\x20refund','allSettled','join','first_name','Use\x20/start\x20to\x20connect.','\x22,\x20apiKey=\x22','processing','stopBot','secretKey','default','telegramId','en-US','../types/gateway','💰\x20Amount:\x20*','Error\x20handling\x20message:','❌\x20Invalid\x20username\x20format:\x20`','•\x20New\x20payments\x0a','🎉\x20*Congratulations!*\x0a\x0a','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','sendMessage','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','sendShopNotification','toLocaleDateString','Failed\x20login\x20attempt','.\x20*','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','✅\x20Welcome\x20back!\x0a\x0a','customerIp','initializeBot','update','260835TFrFdg','statusCode',':\x20`','node-telegram-bot-api','botUsername','sendPayoutNotification','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','New\x20payment\x20created','🔔\x20*','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','Payment\x20is\x20being\x20processed','*.\x0a\x0a','\x20verified\x20for\x20shop\x20','\x20\x20\x20Status:\x20','🆔\x20Request\x20ID:\x20`','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','🆔\x20Payment\x20ID:\x20`','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','❌\x20Shop\x20`','280907fuvYjd','adminNotes','\x20(@','user\x20is\x20deactivated','last_name','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','\x20initialized\x20successfully','📝\x20Order\x20ID:\x20`','amount','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','stopPolling','🔗\x20Endpoint:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','6CrVZPh','unknown\x20shop','getBotInfo','30YTRkOY','152264TwATCC','length','notificationLogin','method','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','gateway','forEach','bot','trim','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','map','customerEmail','\x20USDT*\x0a','🏪\x20Available\x20shops\x20in\x20system:\x0a','\x0a👤\x20*Customer\x20Information:*\x0a','❌\x20Shop\x20with\x20username\x20`','Payout\x20completed','📊\x20Error\x20code:\x20`','❌\x20Error:\x20`','🌐\x20IP:\x20`','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','username','blocked','Available\x20usernames:\x0a','customerUa','`.\x0a\x0a','...','•\x20`','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','env','includes','Error\x20handling\x20/disconnect\x20command:','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','errorMessage','split','telegramBotService','sendLoginNotification','ipAddress','1160845hUANdU','Failed\x20to\x20send\x20login\x20notification:','Payout\x20rejected','\x20\x20\x20Public\x20Key:\x20`','`\x0a\x0a','entries','✅\x20Telegram\x20bot\x20@','requestId','trapay_bot','Error\x20handling\x20/start\x20command:','Error\x20handling\x20/debug\x20command:','botToken','updatedAt','test','onText','🔔\x20Notifications\x20are\x20active\x0a\x0a','TELEGRAM_BOT_TOKEN','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.',':\x20username=\x22','shopId','✅\x20Connected\x20to\x20shop:\x20*','from','TelegramBotService','•\x20Payouts\x0a','📱\x20Shop:\x20*','sendCustomNotification','__importDefault','📧\x20Email:\x20`','642256qTWJfg','📛\x20Name:\x20`','chargebackAmount','🔔\x20You\x20receive\x20notifications\x20about:\x0a','__esModule','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','substring','publicKey','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','findMany','setupBotHandlers','Payment\x20chargeback','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','🔌\x20User\x20','remitterIban','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','message','📅\x20Connection\x20date:\x20','Payment\x20successfully\x20paid'];a55_0x57f1=function(){return _0x3cdb9e;};return a55_0x57f1();}var __importDefault=this&&this[a55_0x16b278(0xaa)]||function(_0x585168){return _0x585168&&_0x585168['__esModule']?_0x585168:{'default':_0x585168};};Object['defineProperty'](exports,a55_0x16b278(0xb0),{'value':!![]}),exports[a55_0x16b278(0x8d)]=exports['TelegramBotService']=void 0x0;function a55_0x5dd9(_0x19fb6c,_0x3ba79a){const _0x57f1a3=a55_0x57f1();return a55_0x5dd9=function(_0x5dd95b,_0x4bc59d){_0x5dd95b=_0x5dd95b-0x77;let _0x36fbea=_0x57f1a3[_0x5dd95b];return _0x36fbea;},a55_0x5dd9(_0x19fb6c,_0x3ba79a);}const node_telegram_bot_api_1=__importDefault(require(a55_0x16b278(0x12d))),database_1=__importDefault(require('../config/database')),gateway_1=require(a55_0x16b278(0x118));class TelegramBotService{constructor(){const _0x379f5b=a55_0x16b278;this[_0x379f5b(0x155)]=null,this[_0x379f5b(0x9b)]=process[_0x379f5b(0x87)][_0x379f5b(0xa0)]||'',this[_0x379f5b(0x12e)]=process['env'][_0x379f5b(0xd4)]||_0x379f5b(0x98),this[_0x379f5b(0x9b)]?this[_0x379f5b(0x128)]():console['warn']('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a55_0x16b278(0x128)](){const _0x59f97c=a55_0x16b278;try{this[_0x59f97c(0x155)]=new node_telegram_bot_api_1['default'](this[_0x59f97c(0x9b)],{'polling':!![]}),this[_0x59f97c(0xb6)](),console[_0x59f97c(0x101)](_0x59f97c(0x96)+this[_0x59f97c(0x12e)]+_0x59f97c(0x143));}catch(_0xc38092){console[_0x59f97c(0xe4)](_0x59f97c(0x7d),_0xc38092);}}[a55_0x16b278(0xb6)](){const _0x2d80ab=a55_0x16b278;if(!this['bot'])return;this['bot']['onText'](/\/start/,async _0x308ad6=>{const _0x5dc7a8=a55_0x5dd9,_0x255bf9=_0x308ad6[_0x5dc7a8(0xff)]['id'],_0x231501=_0x308ad6[_0x5dc7a8(0xa5)]?.['id']['toString'](),_0x2b1b70=_0x308ad6[_0x5dc7a8(0xa5)]?.[_0x5dc7a8(0x7f)],_0x518306=_0x308ad6[_0x5dc7a8(0xa5)]?.[_0x5dc7a8(0x10f)],_0x107ada=_0x308ad6[_0x5dc7a8(0xa5)]?.[_0x5dc7a8(0x141)];if(!_0x231501)return;try{let _0x3588b6=await database_1['default'][_0x5dc7a8(0xf0)][_0x5dc7a8(0xe3)]({'where':{'telegramId':_0x231501},'include':{'shop':!![]}});!_0x3588b6?(_0x3588b6=await database_1[_0x5dc7a8(0x115)][_0x5dc7a8(0xf0)]['create']({'data':{'telegramId':_0x231501,'username':_0x2b1b70,'firstName':_0x518306,'lastName':_0x107ada,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x5dc7a8(0x101)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x231501+_0x5dc7a8(0x13f)+_0x2b1b70+')')):_0x3588b6=await database_1['default'][_0x5dc7a8(0xf0)][_0x5dc7a8(0x129)]({'where':{'telegramId':_0x231501},'data':{'username':_0x2b1b70,'firstName':_0x518306,'lastName':_0x107ada},'include':{'shop':!![]}}),_0x3588b6[_0x5dc7a8(0xf9)]&&_0x3588b6[_0x5dc7a8(0xa3)]&&_0x3588b6['shop']?await this[_0x5dc7a8(0x155)]?.[_0x5dc7a8(0x11f)](_0x255bf9,_0x5dc7a8(0x126)+(_0x5dc7a8(0x125)+_0x3588b6[_0x5dc7a8(0xdf)][_0x5dc7a8(0xee)]+'*\x0a')+(_0x5dc7a8(0x10b)+_0x3588b6[_0x5dc7a8(0xdf)][_0x5dc7a8(0x7f)]+'`\x0a\x0a')+_0x5dc7a8(0xaf)+'•\x20New\x20payments\x0a'+_0x5dc7a8(0xcd)+_0x5dc7a8(0xf6)+_0x5dc7a8(0xdb)+_0x5dc7a8(0xfe)+_0x5dc7a8(0xe9),{'parse_mode':_0x5dc7a8(0xf3)}):(_0x3588b6[_0x5dc7a8(0xa3)]&&!_0x3588b6[_0x5dc7a8(0xf9)]&&(await database_1[_0x5dc7a8(0x115)][_0x5dc7a8(0xf0)]['update']({'where':{'telegramId':_0x231501},'data':{'shopId':null,'isVerified':![]}}),console[_0x5dc7a8(0x101)](_0x5dc7a8(0x107)+_0x231501)),await this[_0x5dc7a8(0x155)]?.[_0x5dc7a8(0x11f)](_0x255bf9,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x5dc7a8(0x130)+_0x5dc7a8(0xb8)+_0x5dc7a8(0xdc)+_0x5dc7a8(0xd9)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x5dc7a8(0xf3)}));}catch(_0x217908){console[_0x5dc7a8(0xe4)](_0x5dc7a8(0x99),_0x217908),await this['bot']?.[_0x5dc7a8(0x11f)](_0x255bf9,_0x5dc7a8(0xa1));}}),this[_0x2d80ab(0x155)][_0x2d80ab(0x9e)](/\/disconnect/,async _0x2e91e3=>{const _0xa3138f=_0x2d80ab,_0x5ba7f1=_0x2e91e3[_0xa3138f(0xff)]['id'],_0x2c5428=_0x2e91e3['from']?.['id']['toString']();if(!_0x2c5428)return;try{const _0x1d0d2f=await database_1['default'][_0xa3138f(0xf0)][_0xa3138f(0xe3)]({'where':{'telegramId':_0x2c5428},'include':{'shop':!![]}});if(!_0x1d0d2f||!_0x1d0d2f['isVerified']||!_0x1d0d2f[_0xa3138f(0xa3)]){await this[_0xa3138f(0x155)]?.[_0xa3138f(0x11f)](_0x5ba7f1,_0xa3138f(0x120));return;}const _0x52fc7e=_0x1d0d2f[_0xa3138f(0xdf)]?.[_0xa3138f(0xee)]||_0xa3138f(0x14b);await database_1[_0xa3138f(0x115)][_0xa3138f(0xf0)][_0xa3138f(0x129)]({'where':{'telegramId':_0x2c5428},'data':{'shopId':null,'isVerified':![]}}),console[_0xa3138f(0x101)](_0xa3138f(0xb9)+_0x2c5428+'\x20disconnected\x20from\x20shop\x20'+_0x1d0d2f[_0xa3138f(0xa3)]),await this[_0xa3138f(0x155)]?.[_0xa3138f(0x11f)](_0x5ba7f1,_0xa3138f(0x139)+_0x52fc7e+_0xa3138f(0x135)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0xa3138f(0xf3)});}catch(_0x144860){console[_0xa3138f(0xe4)](_0xa3138f(0x89),_0x144860),await this[_0xa3138f(0x155)]?.['sendMessage'](_0x5ba7f1,_0xa3138f(0xa1));}}),this[_0x2d80ab(0x155)]['onText'](/\/status/,async _0x368e56=>{const _0x3bdecf=_0x2d80ab,_0x2074d5=_0x368e56[_0x3bdecf(0xff)]['id'],_0x1d14ce=_0x368e56['from']?.['id'][_0x3bdecf(0xd5)]();if(!_0x1d14ce)return;try{const _0x3fcc4b=await database_1[_0x3bdecf(0x115)][_0x3bdecf(0xf0)][_0x3bdecf(0xe3)]({'where':{'telegramId':_0x1d14ce},'include':{'shop':!![]}});if(!_0x3fcc4b){await this['bot']?.[_0x3bdecf(0x11f)](_0x2074d5,_0x3bdecf(0x142)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x3fcc4b[_0x3bdecf(0xf9)]||!_0x3fcc4b[_0x3bdecf(0xa3)]||!_0x3fcc4b[_0x3bdecf(0xdf)]){await this[_0x3bdecf(0x155)]?.['sendMessage'](_0x2074d5,_0x3bdecf(0x149)+_0x3bdecf(0x110));return;}await this[_0x3bdecf(0x155)]?.[_0x3bdecf(0x11f)](_0x2074d5,_0x3bdecf(0xfc)+(_0x3bdecf(0xa4)+_0x3fcc4b[_0x3bdecf(0xdf)]['name']+'*\x0a')+(_0x3bdecf(0xf1)+_0x3fcc4b[_0x3bdecf(0xdf)][_0x3bdecf(0x7f)]+'`\x0a')+(_0x3bdecf(0xbd)+_0x3fcc4b[_0x3bdecf(0x9c)][_0x3bdecf(0x122)](_0x3bdecf(0x117))+'\x0a\x0a')+_0x3bdecf(0x9f)+_0x3bdecf(0xdb)+_0x3bdecf(0xe9),{'parse_mode':'Markdown'});}catch(_0xcaa44c){console[_0x3bdecf(0xe4)]('Error\x20handling\x20/status\x20command:',_0xcaa44c),await this[_0x3bdecf(0x155)]?.['sendMessage'](_0x2074d5,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x2d80ab(0x155)][_0x2d80ab(0x9e)](/\/debug/,async _0x32b06e=>{const _0x98b30f=_0x2d80ab,_0x3f5148=_0x32b06e['chat']['id'],_0x45c8db=_0x32b06e[_0x98b30f(0xa5)]?.['id']['toString']();if(!_0x45c8db)return;try{const _0x5a0a42=await database_1[_0x98b30f(0x115)]['shop'][_0x98b30f(0xb5)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x549014='🔍\x20*Debug\x20Information*\x0a\x0a';_0x549014+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x45c8db+'`\x0a\x0a',_0x549014+=_0x98b30f(0x15b),_0x5a0a42[_0x98b30f(0x154)]((_0x2c756f,_0x2d440d)=>{const _0x5c035e=_0x98b30f;_0x549014+=_0x2d440d+0x1+_0x5c035e(0x124)+_0x2c756f[_0x5c035e(0xee)]+'*\x0a',_0x549014+=_0x5c035e(0xf8)+_0x2c756f[_0x5c035e(0x7f)]+'`\x0a',_0x549014+=_0x5c035e(0x137)+_0x2c756f['status']+'\x0a',_0x549014+=_0x5c035e(0x93)+_0x2c756f['publicKey'][_0x5c035e(0xb2)](0x0,0xf)+'...`\x0a\x0a';}),await this['bot']?.[_0x98b30f(0x11f)](_0x3f5148,_0x549014,{'parse_mode':_0x98b30f(0xf3)});}catch(_0x3beca2){console[_0x98b30f(0xe4)](_0x98b30f(0x9a),_0x3beca2),await this[_0x98b30f(0x155)]?.[_0x98b30f(0x11f)](_0x3f5148,_0x98b30f(0xe8));}}),this[_0x2d80ab(0x155)]['on']('message',async _0x136a15=>{const _0x14320e=_0x2d80ab;if(_0x136a15[_0x14320e(0xc2)]?.[_0x14320e(0xcf)]('/'))return;const _0x5e3e3c=_0x136a15[_0x14320e(0xff)]['id'],_0x34b200=_0x136a15[_0x14320e(0xa5)]?.['id'][_0x14320e(0xd5)](),_0x463064=_0x136a15[_0x14320e(0xc2)]?.[_0x14320e(0x156)]();if(!_0x34b200||!_0x463064)return;try{const _0xd005ad=await database_1[_0x14320e(0x115)][_0x14320e(0xf0)][_0x14320e(0xe3)]({'where':{'telegramId':_0x34b200},'include':{'shop':!![]}});if(!_0xd005ad){await this['bot']?.[_0x14320e(0x11f)](_0x5e3e3c,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0xd005ad['isVerified']&&_0xd005ad[_0x14320e(0xa3)]&&_0xd005ad[_0x14320e(0xdf)]){await this[_0x14320e(0x155)]?.[_0x14320e(0x11f)](_0x5e3e3c,_0x14320e(0x13b)+_0xd005ad['shop']['name']+_0x14320e(0x135)+_0x14320e(0x11e),{'parse_mode':_0x14320e(0xf3)});return;}const _0x4d2baa=_0x463064[_0x14320e(0x8c)](/\s+/);if(_0x4d2baa[_0x14320e(0x14f)]!==0x2){await this[_0x14320e(0x155)]?.[_0x14320e(0x11f)](_0x5e3e3c,_0x14320e(0x7e)+_0x14320e(0xb8)+_0x14320e(0xdc)+_0x14320e(0xd9)+(_0x14320e(0xc5)+_0x4d2baa[_0x14320e(0x14f)]+_0x14320e(0x108)+_0x4d2baa[_0x14320e(0x158)](_0x457e2b=>'`'+_0x457e2b+'`')[_0x14320e(0x10e)](',\x20')),{'parse_mode':_0x14320e(0xf3)});return;}const [_0x3b8123,_0x40954d]=_0x4d2baa;console['log'](_0x14320e(0x86)+_0x34b200+_0x14320e(0xa2)+_0x3b8123+_0x14320e(0x111)+_0x40954d['substring'](0x0,0xa)+'...\x22'),await this[_0x14320e(0xda)](_0x5e3e3c,_0x34b200,_0x3b8123,_0x40954d);}catch(_0x22e408){console[_0x14320e(0xe4)](_0x14320e(0x11a),_0x22e408),await this[_0x14320e(0x155)]?.[_0x14320e(0x11f)](_0x5e3e3c,_0x14320e(0xa1));}}),this[_0x2d80ab(0x155)]['on'](_0x2d80ab(0xe4),_0xcfc16b=>{const _0x1728e8=_0x2d80ab;console[_0x1728e8(0xe4)]('Telegram\x20bot\x20error:',_0xcfc16b);}),this['bot']['on']('polling_error',_0x5c13aa=>{console['error']('Telegram\x20bot\x20polling\x20error:',_0x5c13aa);});}async[a55_0x16b278(0xda)](_0x2501b6,_0x3c5904,_0x11dd92,_0x5ea021){const _0x56ee60=a55_0x16b278;try{console[_0x56ee60(0x101)](_0x56ee60(0x86)+_0x3c5904+_0x56ee60(0xa2)+_0x11dd92+_0x56ee60(0x111)+_0x5ea021[_0x56ee60(0xb2)](0x0,0xa)+'...\x22');if(!_0x11dd92||_0x11dd92[_0x56ee60(0x14f)]<0x3||_0x11dd92[_0x56ee60(0x14f)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x56ee60(0x9d)](_0x11dd92)){await this[_0x56ee60(0x155)]?.['sendMessage'](_0x2501b6,_0x56ee60(0x11b)+_0x11dd92+_0x56ee60(0x94)+_0x56ee60(0xe2),{'parse_mode':_0x56ee60(0xf3)});return;}if(!_0x5ea021||!_0x5ea021[_0x56ee60(0xcf)]('pk_')&&!_0x5ea021[_0x56ee60(0xcf)](_0x56ee60(0x103))){await this[_0x56ee60(0x155)]?.['sendMessage'](_0x2501b6,_0x56ee60(0xbb)+_0x56ee60(0x157),{'parse_mode':_0x56ee60(0xf3)});return;}const _0x4d3acc=await database_1['default'][_0x56ee60(0xdf)]['findUnique']({'where':{'username':_0x11dd92},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x4d3acc){const _0xea05a5=await database_1[_0x56ee60(0x115)]['shop'][_0x56ee60(0xb5)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0xc0180c=_0x56ee60(0x78)+_0x11dd92+'`\x20not\x20found.\x0a\x0a';_0xea05a5[_0x56ee60(0x14f)]>0x0?(_0xc0180c+=_0x56ee60(0x81),_0xea05a5[_0x56ee60(0x154)](_0x4b05b8=>{const _0x3d2a19=_0x56ee60;_0xc0180c+=_0x3d2a19(0x85)+_0x4b05b8[_0x3d2a19(0x7f)]+_0x3d2a19(0xd3)+_0x4b05b8[_0x3d2a19(0xee)]+')\x0a';}),_0xc0180c+=_0x56ee60(0xd7)):_0xc0180c+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x56ee60(0x155)]?.['sendMessage'](_0x2501b6,_0xc0180c,{'parse_mode':'Markdown'});return;}if(_0x4d3acc['status']!==_0x56ee60(0xec)){await this[_0x56ee60(0x155)]?.[_0x56ee60(0x11f)](_0x2501b6,_0x56ee60(0x13c)+_0x11dd92+_0x56ee60(0xd1)+_0x56ee60(0xca),{'parse_mode':_0x56ee60(0xf3)});return;}if(_0x4d3acc[_0x56ee60(0xb3)]!==_0x5ea021&&_0x4d3acc[_0x56ee60(0x114)]!==_0x5ea021){await this[_0x56ee60(0x155)]?.[_0x56ee60(0x11f)](_0x2501b6,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x11dd92+_0x56ee60(0x83)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x56ee60(0xef),{'parse_mode':_0x56ee60(0xf3)});return;}const _0xcfdb28=await database_1[_0x56ee60(0x115)][_0x56ee60(0xf0)][_0x56ee60(0xfb)]({'where':{'shopId':_0x4d3acc['id'],'isVerified':!![],'telegramId':{'not':_0x3c5904}}});if(_0xcfdb28){await this['bot']?.[_0x56ee60(0x11f)](_0x2501b6,_0x56ee60(0xb4)+_0x11dd92+_0x56ee60(0x83)+_0x56ee60(0xea),{'parse_mode':_0x56ee60(0xf3)});return;}await database_1[_0x56ee60(0x115)][_0x56ee60(0xf0)]['update']({'where':{'telegramId':_0x3c5904},'data':{'shopId':_0x4d3acc['id'],'isVerified':!![]}}),await this[_0x56ee60(0x155)]?.[_0x56ee60(0x11f)](_0x2501b6,_0x56ee60(0x11d)+_0x56ee60(0xd6)+(_0x56ee60(0xa8)+_0x4d3acc['name']+'*\x0a')+(_0x56ee60(0xf1)+_0x4d3acc[_0x56ee60(0x7f)]+'`\x0a\x0a')+_0x56ee60(0xc6)+_0x56ee60(0x11c)+_0x56ee60(0xcd)+_0x56ee60(0xa7)+'•\x20Important\x20events\x0a\x0a'+_0x56ee60(0xdb)+_0x56ee60(0xfe)+_0x56ee60(0xe9),{'parse_mode':_0x56ee60(0xf3)}),console[_0x56ee60(0x101)](_0x56ee60(0xf5)+_0x3c5904+_0x56ee60(0x136)+_0x4d3acc[_0x56ee60(0x7f)]+'\x20via\x20single-line\x20input');}catch(_0x4599f7){console['error']('Error\x20in\x20handleSingleLineVerification:',_0x4599f7),await this[_0x56ee60(0x155)]?.[_0x56ee60(0x11f)](_0x2501b6,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a55_0x16b278(0x121)](_0x936d4e,_0x2e5945,_0x595c15){const _0x39603f=a55_0x16b278;if(!this[_0x39603f(0x155)]){console[_0x39603f(0xcc)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x564004=await database_1[_0x39603f(0x115)]['telegramUser'][_0x39603f(0xb5)]({'where':{'shopId':_0x936d4e,'isVerified':!![]}});if(_0x564004['length']===0x0){console[_0x39603f(0x101)](_0x39603f(0x146)+_0x936d4e);return;}const _0x4de9b5=_0x564004[_0x39603f(0x158)](async _0x18ab4c=>{const _0x25ac33=_0x39603f;try{await this[_0x25ac33(0x155)]?.[_0x25ac33(0x11f)](_0x18ab4c[_0x25ac33(0x116)],_0x2e5945,_0x595c15),console[_0x25ac33(0x101)](_0x25ac33(0xe1)+_0x18ab4c[_0x25ac33(0x116)]);}catch(_0x4527a8){console[_0x25ac33(0xe4)](_0x25ac33(0x152)+_0x18ab4c[_0x25ac33(0x116)]+':',_0x4527a8),_0x4527a8 instanceof Error&&(_0x4527a8[_0x25ac33(0xbc)][_0x25ac33(0x88)](_0x25ac33(0x80))||_0x4527a8[_0x25ac33(0xbc)][_0x25ac33(0x88)](_0x25ac33(0x102))||_0x4527a8[_0x25ac33(0xbc)][_0x25ac33(0x88)](_0x25ac33(0x140)))&&(await database_1[_0x25ac33(0x115)][_0x25ac33(0xf0)][_0x25ac33(0x129)]({'where':{'id':_0x18ab4c['id']},'data':{'isVerified':![]}}),console['log']('User\x20'+_0x18ab4c[_0x25ac33(0x116)]+_0x25ac33(0xb1)));}});await Promise[_0x39603f(0x10d)](_0x4de9b5);}catch(_0x15520b){console['error'](_0x39603f(0xc3),_0x15520b);}}async['sendPaymentNotification'](_0x3bd294,_0xdbc401,_0x31aafc){const _0x4d90c9=a55_0x16b278,_0x25b527={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x38bd08={'created':_0x4d90c9(0x131),'paid':_0x4d90c9(0xbe),'failed':_0x4d90c9(0xc0),'expired':_0x4d90c9(0xc4),'refund':_0x4d90c9(0x10c),'chargeback':_0x4d90c9(0xb7),'processing':_0x4d90c9(0x134)},_0x3666d4=_0x25b527[_0x31aafc],_0x30fb73=_0x38bd08[_0x31aafc],_0x337ac0=(0x0,gateway_1[_0x4d90c9(0xbf)])(_0xdbc401[_0x4d90c9(0x153)]);console[_0x4d90c9(0x101)](_0x4d90c9(0xdd)+_0xdbc401[_0x4d90c9(0x153)]+'\x22\x20->\x20display\x20\x22'+_0x337ac0+'\x22');let _0x624726=_0x3666d4+'\x20*'+_0x30fb73+_0x4d90c9(0xf7)+(_0x4d90c9(0x119)+_0xdbc401[_0x4d90c9(0x145)]+'\x20'+_0xdbc401['currency']+'*\x0a')+(_0x4d90c9(0x144)+(_0xdbc401['orderId']||_0xdbc401['id'])+'`\x0a')+(_0x4d90c9(0x13a)+_0xdbc401['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x337ac0+'`\x0a')+(_0x4d90c9(0x109)+new Date(_0xdbc401['createdAt'])[_0x4d90c9(0xcb)](_0x4d90c9(0x117))+'\x0a');if(_0xdbc401['customerName']||_0xdbc401[_0x4d90c9(0x159)]||_0xdbc401['remitterIban']||_0xdbc401[_0x4d90c9(0x127)]||_0xdbc401['customerUa']){_0x624726+=_0x4d90c9(0x77);_0xdbc401[_0x4d90c9(0xeb)]&&(_0x624726+=_0x4d90c9(0xad)+_0xdbc401[_0x4d90c9(0xeb)]+'`\x0a');_0xdbc401[_0x4d90c9(0x159)]&&(_0x624726+=_0x4d90c9(0xab)+_0xdbc401[_0x4d90c9(0x159)]+'`\x0a');_0xdbc401[_0x4d90c9(0xba)]&&(_0x624726+='🏦\x20IBAN:\x20`'+_0xdbc401[_0x4d90c9(0xba)]+'`\x0a');_0xdbc401['customerIp']&&(_0x624726+=_0x4d90c9(0x7c)+_0xdbc401[_0x4d90c9(0x127)]+'`\x0a');if(_0xdbc401[_0x4d90c9(0x82)]){const _0x232229=_0xdbc401['customerUa'][_0x4d90c9(0x14f)]>0x32?_0xdbc401[_0x4d90c9(0x82)][_0x4d90c9(0xb2)](0x0,0x32)+_0x4d90c9(0x84):_0xdbc401[_0x4d90c9(0x82)];_0x624726+=_0x4d90c9(0xf4)+_0x232229+'`\x0a';}}_0x31aafc==='chargeback'&&_0xdbc401[_0x4d90c9(0xae)]&&(_0x624726+='💸\x20Penalty\x20amount:\x20*'+_0xdbc401[_0x4d90c9(0xae)]+_0x4d90c9(0x15a)),_0x31aafc===_0x4d90c9(0x112)&&(_0x624726+=_0x4d90c9(0xc1)),_0xdbc401['adminNotes']&&(_0x624726+=_0x4d90c9(0xe5)+_0xdbc401[_0x4d90c9(0x13e)]+'\x0a'),await this['sendShopNotification'](_0x3bd294,_0x624726,{'parse_mode':_0x4d90c9(0xf3)});}async[a55_0x16b278(0x12f)](_0x12adfd,_0x15562a,_0x19f768){const _0x47ed43=a55_0x16b278,_0x229024={'created':'📤','completed':'✅','rejected':'❌'},_0x203bca={'created':'New\x20payout\x20created','completed':_0x47ed43(0x79),'rejected':_0x47ed43(0x92)},_0x218c9e=_0x229024[_0x19f768],_0x24ab4d=_0x203bca[_0x19f768],_0x5ef78d=_0x218c9e+'\x20*'+_0x24ab4d+_0x47ed43(0xf7)+('💸\x20Amount:\x20*'+_0x15562a[_0x47ed43(0x145)]+'\x20USD*\x0a')+('🏦\x20Method:\x20`'+_0x15562a[_0x47ed43(0x151)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x15562a['id']+'`\x0a')+(_0x47ed43(0x109)+new Date(_0x15562a['createdAt'])[_0x47ed43(0xcb)](_0x47ed43(0x117))+'\x0a')+(_0x15562a[_0x47ed43(0x105)]?'🔗\x20TXID:\x20`'+_0x15562a[_0x47ed43(0x105)]+'`':'');await this[_0x47ed43(0x121)](_0x12adfd,_0x5ef78d,{'parse_mode':_0x47ed43(0xf3)});}async[a55_0x16b278(0x8e)](_0x4b61a4,_0x43e2b9){const _0x1bcfd5=a55_0x16b278;try{const _0x55a424=await database_1[_0x1bcfd5(0x115)][_0x1bcfd5(0xc9)][_0x1bcfd5(0xe3)]({'where':{'shopId':_0x4b61a4},'select':{'notificationLogin':!![]}});if(!_0x55a424?.[_0x1bcfd5(0x150)]){console[_0x1bcfd5(0x101)](_0x1bcfd5(0xfd)+_0x4b61a4);return;}const _0x24955f=_0x43e2b9[_0x1bcfd5(0xc7)]?'🔐':'🚨',_0x9eea2f=_0x43e2b9['success']?_0x1bcfd5(0xd8):_0x1bcfd5(0x123);let _0x2c32ef=_0x24955f+'\x20*'+_0x9eea2f+_0x1bcfd5(0xf7)+(_0x1bcfd5(0xf1)+_0x43e2b9[_0x1bcfd5(0x7f)]+'`\x0a')+('📅\x20Time:\x20'+_0x43e2b9[_0x1bcfd5(0xed)][_0x1bcfd5(0xcb)]('en-US')+'\x0a');_0x43e2b9[_0x1bcfd5(0x8f)]&&(_0x2c32ef+=_0x1bcfd5(0xe0)+_0x43e2b9[_0x1bcfd5(0x8f)]+'`\x0a');if(_0x43e2b9[_0x1bcfd5(0x100)]){const _0x1b4030=_0x43e2b9[_0x1bcfd5(0x100)][_0x1bcfd5(0x14f)]>0x32?_0x43e2b9[_0x1bcfd5(0x100)][_0x1bcfd5(0xb2)](0x0,0x32)+_0x1bcfd5(0x84):_0x43e2b9[_0x1bcfd5(0x100)];_0x2c32ef+=_0x1bcfd5(0xf4)+_0x1b4030+'`\x0a';}!_0x43e2b9[_0x1bcfd5(0xc7)]&&(_0x2c32ef+=_0x1bcfd5(0x133)),await this[_0x1bcfd5(0x121)](_0x4b61a4,_0x2c32ef,{'parse_mode':_0x1bcfd5(0xf3)}),console[_0x1bcfd5(0x101)](_0x1bcfd5(0x8a)+_0x4b61a4+':\x20'+(_0x43e2b9[_0x1bcfd5(0xc7)]?_0x1bcfd5(0xc7):'failed'));}catch(_0x5edc5b){console[_0x1bcfd5(0xe4)](_0x1bcfd5(0x91),_0x5edc5b);}}async[a55_0x16b278(0x104)](_0x93c8f3,_0x24837d){const _0x448469=a55_0x16b278;try{const _0x34d85c=await database_1[_0x448469(0x115)][_0x448469(0xc9)]['findUnique']({'where':{'shopId':_0x93c8f3},'select':{'notificationApiError':!![]}});if(!_0x34d85c?.[_0x448469(0xf2)]){console[_0x448469(0x101)](_0x448469(0xc8)+_0x93c8f3);return;}let _0x4fd660='🚨\x20*API\x20Error*\x0a\x0a'+(_0x448469(0x148)+_0x24837d[_0x448469(0x151)]+'\x20'+_0x24837d[_0x448469(0xfa)]+'`\x0a')+(_0x448469(0xd2)+_0x24837d[_0x448469(0xed)][_0x448469(0xcb)](_0x448469(0x117))+'\x0a');_0x24837d[_0x448469(0x12b)]&&(_0x4fd660+=_0x448469(0x7a)+_0x24837d['statusCode']+'`\x0a'),_0x4fd660+=_0x448469(0x7b)+_0x24837d[_0x448469(0x8b)]+'`\x0a',_0x24837d[_0x448469(0x97)]&&(_0x4fd660+=_0x448469(0x138)+_0x24837d['requestId']+'`\x0a'),_0x4fd660+=_0x448469(0xe7),await this[_0x448469(0x121)](_0x93c8f3,_0x4fd660,{'parse_mode':'Markdown'}),console['log'](_0x448469(0xce)+_0x93c8f3+':\x20'+_0x24837d['endpoint']);}catch(_0x2e7c1f){console[_0x448469(0xe4)](_0x448469(0xe6),_0x2e7c1f);}}async[a55_0x16b278(0xa9)](_0x3ed594,_0x85554d,_0x33c1cd){const _0x469e98=a55_0x16b278;let _0x1358af=_0x469e98(0x132)+_0x85554d+_0x469e98(0xf7);for(const [_0x5d58ed,_0x4ab55a]of Object[_0x469e98(0x95)](_0x33c1cd)){_0x4ab55a!==null&&_0x4ab55a!==undefined&&(_0x1358af+=_0x5d58ed+_0x469e98(0x12c)+_0x4ab55a+'`\x0a');}await this[_0x469e98(0x121)](_0x3ed594,_0x1358af,{'parse_mode':_0x469e98(0xf3)});}[a55_0x16b278(0x14c)](){const _0x17d96f=a55_0x16b278;return{'isActive':!!this[_0x17d96f(0x155)],'username':this['botUsername']};}[a55_0x16b278(0x113)](){const _0x3c96af=a55_0x16b278;this[_0x3c96af(0x155)]&&(this[_0x3c96af(0x155)][_0x3c96af(0x147)](),this['bot']=null,console[_0x3c96af(0x101)]('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a55_0x16b278(0xa6)]=TelegramBotService,exports[a55_0x16b278(0x8d)]=new TelegramBotService();