'use strict';const a66_0x9cdb6b=a66_0x4cbb;(function(_0x4e2d2f,_0x5968e2){const _0x1a2899=a66_0x4cbb,_0x2c36b0=_0x4e2d2f();while(!![]){try{const _0x26b770=parseInt(_0x1a2899(0xef))/0x1*(parseInt(_0x1a2899(0x140))/0x2)+-parseInt(_0x1a2899(0x154))/0x3*(parseInt(_0x1a2899(0x78))/0x4)+parseInt(_0x1a2899(0x14f))/0x5*(-parseInt(_0x1a2899(0x16f))/0x6)+parseInt(_0x1a2899(0x170))/0x7*(parseInt(_0x1a2899(0x110))/0x8)+-parseInt(_0x1a2899(0x12f))/0x9*(parseInt(_0x1a2899(0x163))/0xa)+-parseInt(_0x1a2899(0x116))/0xb*(-parseInt(_0x1a2899(0x12b))/0xc)+-parseInt(_0x1a2899(0x12e))/0xd*(-parseInt(_0x1a2899(0x166))/0xe);if(_0x26b770===_0x5968e2)break;else _0x2c36b0['push'](_0x2c36b0['shift']());}catch(_0x3773c6){_0x2c36b0['push'](_0x2c36b0['shift']());}}}(a66_0x5c60,0x95a46));var __importDefault=this&&this[a66_0x9cdb6b(0x94)]||function(_0x3a26da){const _0x273b39=a66_0x9cdb6b;return _0x3a26da&&_0x3a26da[_0x273b39(0xc8)]?_0x3a26da:{'default':_0x3a26da};};Object['defineProperty'](exports,a66_0x9cdb6b(0xc8),{'value':!![]}),exports[a66_0x9cdb6b(0x8a)]=exports[a66_0x9cdb6b(0x136)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a66_0x9cdb6b(0xc2))),database_1=__importDefault(require(a66_0x9cdb6b(0x167))),gateway_1=require(a66_0x9cdb6b(0xbe));function a66_0x4cbb(_0x295ff6,_0x5312d7){const _0x5c60f4=a66_0x5c60();return a66_0x4cbb=function(_0x4cbbef,_0x2fc370){_0x4cbbef=_0x4cbbef-0x74;let _0x4119c3=_0x5c60f4[_0x4cbbef];return _0x4119c3;},a66_0x4cbb(_0x295ff6,_0x5312d7);}function a66_0x5c60(){const _0x93a4b3=['userAgent','❌\x20Invalid\x20username\x20format:\x20`','Payment\x20failed','length','customerEmail','.jpg','❌\x20Shop\x20`','chargeback','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','sendApiErrorNotification','\x20parts:\x20','first_name','sendDocument','toLocaleString','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','allSettled','👤\x20Username:\x20`','❌\x20Error\x20sending\x20file\x20to\x20shop:','New\x20payment\x20created','map','`\x0a\x0a','💸\x20Penalty\x20amount:\x20*','Failed\x20login\x20attempt','getGatewayDisplayNameForTelegram','text','\x0a👤\x20*Customer\x20Information:*\x0a','../types/gateway','customerName','stopPolling','shop','node-telegram-bot-api','sendMessage','❌\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a','Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','remitterIban','__esModule','chat','📱\x20Shop:\x20*','sendCustomNotification','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','To\x20reconnect,\x20use\x20the\x20/start\x20command','Failed\x20to\x20send\x20login\x20notification:','📝\x20Order\x20ID:\x20`','includes','Not\x20specified','Example:\x0a','🌐\x20IP\x20address:\x20`','sendShopNotification','\x20\x20\x20Username:\x20`','TELEGRAM_BOT_USERNAME','chargebackAmount','ACTIVE','🔗\x20*Transaction\x20Link:*\x20Pending','❌\x20Please\x20use\x20/start\x20command\x20first','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','sendPaymentNotification','🔗\x20Endpoint:\x20`','env','You\x20sent\x20','getBotInfo','🌐\x20*Network:*\x20','geo','adminNotes','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','findUnique','join','Username:\x20`','polling_error','customerIp','updatedAt','application/pdf','notificationLogin','toLocaleDateString','username','2386asKQdn','telegramId','.png','wallet','trim','botUsername','.jpeg','2-digit','trapay_bot','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','success','❌\x20Error\x20getting\x20debug\x20information.','method','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','\x20disconnected\x20from\x20shop\x20','Error\x20handling\x20/start\x20command:','...','🔗\x20*Transaction\x20Link:*\x20`','\x20users','user\x20is\x20deactivated','Payment\x20successfully\x20paid','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','Markdown','📱\x20Telegram\x20notification:\x20gateway\x20\x22','findMany','🆔\x20Request\x20ID:\x20`','failed','\x20initialized\x20successfully','log','Error\x20in\x20handleSingleLineVerification:','Error\x20handling\x20/debug\x20command:','6169832yHakll','message','default','🔌\x20User\x20','\x20users\x20of\x20shop\x20','/disconnect\x20-\x20disconnect\x20from\x20notifications','11DhuASV','blocked','error','📱\x20Your\x20Telegram\x20ID:\x20`','numeric','customerUa','✅\x20Connected\x20to\x20shop:\x20*','chat\x20not\x20found','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','sendLoginNotification','📅\x20Time:\x20','startsWith','Payment\x20is\x20being\x20processed','errorMessage','❌\x20Telegram\x20bot\x20not\x20initialized','📱\x20Notification\x20sent\x20to\x20','botToken','🔔\x20Notifications\x20are\x20active\x0a\x0a','Use\x20/start\x20to\x20connect.','bot','Failed\x20to\x20send\x20API\x20error\x20notification:','7756308qVEetu','split','❌\x20Error:\x20`','370123ECmJAk','1333269NlGHEh','🆔\x20Payment\x20ID:\x20`','isVerified','📛\x20Name:\x20`','en-US','User\x20','Payment\x20expired','TelegramBotService','shopSettings','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','notificationApiError','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','amount','toString','statusCode','sendDirectFile','currency','2YvQsMN','Successful\x20login','•\x20Payment\x20status\x20changes\x0a','\x20USDT*\x0a','from','📊\x20*Connection\x20Status*\x0a\x0a','orderId','endsWith','processing','update','🏪\x20Your\x20connected\x20shop:\x0a','requestId','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','138225FTKMvx','\x20\x20\x20Status:\x20','createdAt','\x22,\x20apiKey=\x22','💸\x20*New\x20Payout*\x0a\x0a','1117587ZSOsNu','Commands:\x0a','network','ipAddress','📊\x20Error\x20code:\x20`','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','💰\x20*Amount:*\x20','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*',':\x20username=\x22','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','timestamp','sk_','📅\x20Connection\x20date:\x20','📱\x20No\x20active\x20Telegram\x20users\x20found','*\x0a\x0a','30Ujdowi','🌍\x20Country:\x20','secretKey','168aDgDtV','../config/database','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','stopBot','setupBotHandlers','🛑\x20Telegram\x20bot\x20stopped',':\x20`','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','72PXNEdT','7DXIzQM','Contact\x20administrator.','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','•\x20New\x20payments\x0a','entries','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','📱\x20Created\x20new\x20Telegram\x20user:\x20','✅\x20Welcome\x20back!\x0a\x0a','📝\x20Notes:\x20','shopId','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','TELEGRAM_BOT_TOKEN','4OPlYjS','*.\x0a\x0a','status','txid','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','initializeBot','Error\x20sending\x20shop\x20notification:','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','\x20via\x20single-line\x20input','📧\x20Email:\x20`','pk_','`.\x0a\x0a','Error\x20handling\x20/disconnect\x20command:','sendPayoutNotification','findFirst','/status\x20-\x20check\x20connection\x20status\x0a','telegramUser','✅\x20Telegram\x20user\x20','telegramBotService','Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.','handleSingleLineVerification','🔔\x20You\x20receive\x20notifications\x20about:\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','endpoint','`\x20not\x20found.\x0a\x0a','image/png','substring','💰\x20Amount:\x20*','__importDefault','💻\x20Browser:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','❌\x20Error\x20sending\x20file\x20to\x20chat:','•\x20Payouts\x0a\x0a','name','gateway','\x22\x20->\x20display\x20\x22','Error\x20handling\x20/status\x20command:','image/jpeg','onText','publicKey','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','application/octet-stream','\x20\x20\x20Name:\x20*'];a66_0x5c60=function(){return _0x93a4b3;};return a66_0x5c60();}class TelegramBotService{constructor(){const _0x526407=a66_0x9cdb6b;this['bot']=null,this[_0x526407(0x126)]=process[_0x526407(0xde)][_0x526407(0x77)]||'',this[_0x526407(0xf4)]=process[_0x526407(0xde)][_0x526407(0xd6)]||_0x526407(0xf7),this[_0x526407(0x126)]?this[_0x526407(0x7d)]():console['warn'](_0x526407(0x159));}['initializeBot'](){const _0x1c56c7=a66_0x9cdb6b;try{this[_0x1c56c7(0x129)]=new node_telegram_bot_api_1[(_0x1c56c7(0x112))](this['botToken'],{'polling':!![]}),this['setupBotHandlers'](),console[_0x1c56c7(0x10d)]('✅\x20Telegram\x20bot\x20@'+this['botUsername']+_0x1c56c7(0x10c));}catch(_0x30c6f3){console[_0x1c56c7(0x118)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x30c6f3);}}[a66_0x9cdb6b(0x16a)](){const _0x1d58c5=a66_0x9cdb6b;if(!this[_0x1d58c5(0x129)])return;this[_0x1d58c5(0x129)][_0x1d58c5(0x9e)](/\/start/,async _0x56e997=>{const _0x434af6=_0x1d58c5,_0x54a0c9=_0x56e997[_0x434af6(0xc9)]['id'],_0x2b88d4=_0x56e997[_0x434af6(0x144)]?.['id'][_0x434af6(0x13c)](),_0x477baa=_0x56e997[_0x434af6(0x144)]?.[_0x434af6(0xee)],_0x52da69=_0x56e997['from']?.[_0x434af6(0xae)],_0x47106b=_0x56e997[_0x434af6(0x144)]?.['last_name'];if(!_0x2b88d4)return;try{let _0x42c34c=await database_1['default'][_0x434af6(0x88)][_0x434af6(0xe5)]({'where':{'telegramId':_0x2b88d4},'include':{'shop':!![]}});!_0x42c34c?(_0x42c34c=await database_1['default'][_0x434af6(0x88)]['create']({'data':{'telegramId':_0x2b88d4,'username':_0x477baa,'firstName':_0x52da69,'lastName':_0x47106b,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x434af6(0x10d)](_0x434af6(0x176)+_0x2b88d4+'\x20(@'+_0x477baa+')')):_0x42c34c=await database_1[_0x434af6(0x112)][_0x434af6(0x88)][_0x434af6(0x149)]({'where':{'telegramId':_0x2b88d4},'data':{'username':_0x477baa,'firstName':_0x52da69,'lastName':_0x47106b},'include':{'shop':!![]}}),_0x42c34c[_0x434af6(0x131)]&&_0x42c34c[_0x434af6(0x75)]&&_0x42c34c['shop']?await this[_0x434af6(0x129)]?.[_0x434af6(0xc3)](_0x54a0c9,_0x434af6(0x177)+(_0x434af6(0xb1)+_0x42c34c[_0x434af6(0xc1)][_0x434af6(0x99)]+'*\x0a')+(_0x434af6(0xe7)+_0x42c34c[_0x434af6(0xc1)]['username']+_0x434af6(0xb8))+_0x434af6(0x8d)+_0x434af6(0x173)+_0x434af6(0x142)+_0x434af6(0x98)+_0x434af6(0x155)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x434af6(0x115),{'parse_mode':'Markdown'}):(_0x42c34c[_0x434af6(0x75)]&&!_0x42c34c[_0x434af6(0x131)]&&(await database_1[_0x434af6(0x112)]['telegramUser'][_0x434af6(0x149)]({'where':{'telegramId':_0x2b88d4},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x434af6(0xab)+_0x2b88d4)),await this[_0x434af6(0x129)]?.['sendMessage'](_0x54a0c9,_0x434af6(0x106)+_0x434af6(0xfc)+_0x434af6(0x175)+_0x434af6(0xd2)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x434af6(0xcc),{'parse_mode':_0x434af6(0x107)}));}catch(_0x4e26cd){console[_0x434af6(0x118)](_0x434af6(0xfe),_0x4e26cd),await this[_0x434af6(0x129)]?.['sendMessage'](_0x54a0c9,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot'][_0x1d58c5(0x9e)](/\/disconnect/,async _0x9b75b8=>{const _0x38b12e=_0x1d58c5,_0x337aa6=_0x9b75b8[_0x38b12e(0xc9)]['id'],_0x5dbcca=_0x9b75b8[_0x38b12e(0x144)]?.['id'][_0x38b12e(0x13c)]();if(!_0x5dbcca)return;try{const _0x427adb=await database_1[_0x38b12e(0x112)][_0x38b12e(0x88)][_0x38b12e(0xe5)]({'where':{'telegramId':_0x5dbcca},'include':{'shop':!![]}});if(!_0x427adb||!_0x427adb['isVerified']||!_0x427adb[_0x38b12e(0x75)]){await this[_0x38b12e(0x129)]?.[_0x38b12e(0xc3)](_0x337aa6,_0x38b12e(0x96));return;}const _0x39c78e=_0x427adb[_0x38b12e(0xc1)]?.['name']||'unknown\x20shop';await database_1[_0x38b12e(0x112)]['telegramUser']['update']({'where':{'telegramId':_0x5dbcca},'data':{'shopId':null,'isVerified':![]}}),console[_0x38b12e(0x10d)](_0x38b12e(0x113)+_0x5dbcca+_0x38b12e(0xfd)+_0x427adb['shopId']),await this[_0x38b12e(0x129)]?.[_0x38b12e(0xc3)](_0x337aa6,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x39c78e+_0x38b12e(0x79)+_0x38b12e(0xcd),{'parse_mode':_0x38b12e(0x107)});}catch(_0xebf672){console[_0x38b12e(0x118)](_0x38b12e(0x84),_0xebf672),await this[_0x38b12e(0x129)]?.['sendMessage'](_0x337aa6,_0x38b12e(0x14e));}}),this[_0x1d58c5(0x129)]['onText'](/\/status/,async _0x1e9190=>{const _0x360a27=_0x1d58c5,_0x1824b0=_0x1e9190['chat']['id'],_0x24932b=_0x1e9190[_0x360a27(0x144)]?.['id'][_0x360a27(0x13c)]();if(!_0x24932b)return;try{const _0x1b08c6=await database_1[_0x360a27(0x112)][_0x360a27(0x88)][_0x360a27(0xe5)]({'where':{'telegramId':_0x24932b},'include':{'shop':!![]}});if(!_0x1b08c6){await this[_0x360a27(0x129)]?.[_0x360a27(0xc3)](_0x1824b0,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+'Use\x20/start\x20to\x20begin.');return;}if(!_0x1b08c6['isVerified']||!_0x1b08c6[_0x360a27(0x75)]||!_0x1b08c6[_0x360a27(0xc1)]){await this['bot']?.[_0x360a27(0xc3)](_0x1824b0,_0x360a27(0x8e)+_0x360a27(0x128));return;}await this['bot']?.[_0x360a27(0xc3)](_0x1824b0,_0x360a27(0x145)+(_0x360a27(0x11c)+_0x1b08c6[_0x360a27(0xc1)][_0x360a27(0x99)]+'*\x0a')+(_0x360a27(0xb4)+_0x1b08c6[_0x360a27(0xc1)][_0x360a27(0xee)]+'`\x0a')+(_0x360a27(0x160)+_0x1b08c6[_0x360a27(0xea)][_0x360a27(0xed)]('en-US')+'\x0a\x0a')+_0x360a27(0x127)+_0x360a27(0x155)+_0x360a27(0x115),{'parse_mode':_0x360a27(0x107)});}catch(_0x518931){console['error'](_0x360a27(0x9c),_0x518931),await this[_0x360a27(0x129)]?.[_0x360a27(0xc3)](_0x1824b0,_0x360a27(0x14e));}}),this[_0x1d58c5(0x129)]['onText'](/\/debug/,async _0x4953ba=>{const _0x103a41=_0x1d58c5,_0x4c0caa=_0x4953ba[_0x103a41(0xc9)]['id'],_0x239b70=_0x4953ba['from']?.['id'][_0x103a41(0x13c)]();if(!_0x239b70)return;try{const _0x5399cc=await database_1['default'][_0x103a41(0x88)]['findUnique']({'where':{'telegramId':_0x239b70},'include':{'shop':!![]}});let _0x99b1ca='🔍\x20*Debug\x20Information*\x0a\x0a';_0x99b1ca+=_0x103a41(0x119)+_0x239b70+_0x103a41(0xb8),_0x5399cc?.[_0x103a41(0x131)]&&_0x5399cc['shop']?(_0x99b1ca+=_0x103a41(0x14a),_0x99b1ca+=_0x103a41(0xa2)+_0x5399cc[_0x103a41(0xc1)][_0x103a41(0x99)]+'*\x0a',_0x99b1ca+=_0x103a41(0xd5)+_0x5399cc['shop']['username']+'`\x0a',_0x99b1ca+=_0x103a41(0x150)+_0x5399cc[_0x103a41(0xc1)][_0x103a41(0x7a)]+'\x0a\x0a'):_0x99b1ca+=_0x103a41(0xc4),_0x99b1ca+=_0x103a41(0x8b),await this[_0x103a41(0x129)]?.[_0x103a41(0xc3)](_0x4c0caa,_0x99b1ca,{'parse_mode':'Markdown'});}catch(_0x6681ba){console[_0x103a41(0x118)](_0x103a41(0x10f),_0x6681ba),await this['bot']?.[_0x103a41(0xc3)](_0x4c0caa,_0x103a41(0xfa));}}),this[_0x1d58c5(0x129)]['on'](_0x1d58c5(0x111),async _0x3b067e=>{const _0x16a491=_0x1d58c5;if(_0x3b067e[_0x16a491(0xbc)]?.[_0x16a491(0x121)]('/'))return;const _0x431f31=_0x3b067e[_0x16a491(0xc9)]['id'],_0x1ff30e=_0x3b067e[_0x16a491(0x144)]?.['id']['toString'](),_0x1642ef=_0x3b067e[_0x16a491(0xbc)]?.[_0x16a491(0xf3)]();if(!_0x1ff30e||!_0x1642ef)return;try{const _0xe9e011=await database_1[_0x16a491(0x112)][_0x16a491(0x88)][_0x16a491(0xe5)]({'where':{'telegramId':_0x1ff30e},'include':{'shop':!![]}});if(!_0xe9e011){await this[_0x16a491(0x129)]?.[_0x16a491(0xc3)](_0x431f31,_0x16a491(0xda));return;}if(_0xe9e011['isVerified']&&_0xe9e011[_0x16a491(0x75)]&&_0xe9e011['shop']){await this[_0x16a491(0x129)]?.[_0x16a491(0xc3)](_0x431f31,_0x16a491(0x15b)+_0xe9e011[_0x16a491(0xc1)]['name']+_0x16a491(0x79)+_0x16a491(0x172),{'parse_mode':_0x16a491(0x107)});return;}const _0x15615c=_0x1642ef[_0x16a491(0x12c)](/\s+/);if(_0x15615c[_0x16a491(0xa6)]!==0x2){await this[_0x16a491(0x129)]?.[_0x16a491(0xc3)](_0x431f31,_0x16a491(0x7f)+_0x16a491(0x175)+_0x16a491(0xd2)+_0x16a491(0x138)+(_0x16a491(0xdf)+_0x15615c[_0x16a491(0xa6)]+_0x16a491(0xad)+_0x15615c[_0x16a491(0xb7)](_0x3bf148=>'`'+_0x3bf148+'`')[_0x16a491(0xe6)](',\x20')),{'parse_mode':_0x16a491(0x107)});return;}const [_0x43718f,_0x3c835f]=_0x15615c;console['log']('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x1ff30e+':\x20username=\x22'+_0x43718f+_0x16a491(0x152)+_0x3c835f[_0x16a491(0x92)](0x0,0xa)+'...\x22'),await this[_0x16a491(0x8c)](_0x431f31,_0x1ff30e,_0x43718f,_0x3c835f);}catch(_0x37c8b2){console[_0x16a491(0x118)]('Error\x20handling\x20message:',_0x37c8b2),await this['bot']?.[_0x16a491(0xc3)](_0x431f31,_0x16a491(0x14e));}}),this[_0x1d58c5(0x129)]['on'](_0x1d58c5(0x118),_0xfe2dbc=>{const _0x2f885f=_0x1d58c5;console[_0x2f885f(0x118)]('Telegram\x20bot\x20error:',_0xfe2dbc);}),this[_0x1d58c5(0x129)]['on'](_0x1d58c5(0xe8),_0x3b9d89=>{const _0x57a8ee=_0x1d58c5;console[_0x57a8ee(0x118)]('Telegram\x20bot\x20polling\x20error:',_0x3b9d89);});}async[a66_0x9cdb6b(0x8c)](_0x3fe1bb,_0x2ae66b,_0xd35319,_0x5bd168){const _0x211e78=a66_0x9cdb6b;try{console['log'](_0x211e78(0x7c)+_0x2ae66b+_0x211e78(0x15c)+_0xd35319+_0x211e78(0x152)+_0x5bd168[_0x211e78(0x92)](0x0,0xa)+'...\x22');if(!_0xd35319||_0xd35319['length']<0x3||_0xd35319[_0x211e78(0xa6)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0xd35319)){await this[_0x211e78(0x129)]?.[_0x211e78(0xc3)](_0x3fe1bb,_0x211e78(0xa4)+_0xd35319+_0x211e78(0xb8)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x211e78(0x107)});return;}if(!_0x5bd168||!_0x5bd168[_0x211e78(0x121)](_0x211e78(0x82))&&!_0x5bd168[_0x211e78(0x121)](_0x211e78(0x15f))){await this[_0x211e78(0x129)]?.[_0x211e78(0xc3)](_0x3fe1bb,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x211e78(0x76),{'parse_mode':_0x211e78(0x107)});return;}const _0xffb575=await database_1['default']['shop']['findUnique']({'where':{'username':_0xd35319},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0xffb575){const _0x1876f9='❌\x20Shop\x20with\x20username\x20`'+_0xd35319+_0x211e78(0x90)+_0x211e78(0xc5)+'Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.';await this[_0x211e78(0x129)]?.[_0x211e78(0xc3)](_0x3fe1bb,_0x1876f9,{'parse_mode':'Markdown'});return;}if(_0xffb575[_0x211e78(0x7a)]!==_0x211e78(0xd8)){await this[_0x211e78(0x129)]?.[_0x211e78(0xc3)](_0x3fe1bb,_0x211e78(0xa9)+_0xd35319+'`\x20is\x20inactive.\x0a\x0a'+_0x211e78(0x171),{'parse_mode':_0x211e78(0x107)});return;}if(_0xffb575[_0x211e78(0x9f)]!==_0x5bd168&&_0xffb575[_0x211e78(0x165)]!==_0x5bd168){await this[_0x211e78(0x129)]?.[_0x211e78(0xc3)](_0x3fe1bb,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0xd35319+_0x211e78(0x83)+_0x211e78(0x13a)+_0x211e78(0x15d),{'parse_mode':_0x211e78(0x107)});return;}const _0x253490=await database_1[_0x211e78(0x112)][_0x211e78(0x88)][_0x211e78(0x86)]({'where':{'shopId':_0xffb575['id'],'isVerified':!![],'telegramId':{'not':_0x2ae66b}}});if(_0x253490){await this['bot']?.[_0x211e78(0xc3)](_0x3fe1bb,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0xd35319+_0x211e78(0x83)+_0x211e78(0x104),{'parse_mode':_0x211e78(0x107)});return;}await database_1[_0x211e78(0x112)]['telegramUser'][_0x211e78(0x149)]({'where':{'telegramId':_0x2ae66b},'data':{'shopId':_0xffb575['id'],'isVerified':!![]}}),await this[_0x211e78(0x129)]?.['sendMessage'](_0x3fe1bb,'🎉\x20*Congratulations!*\x0a\x0a'+_0x211e78(0xb2)+(_0x211e78(0xca)+_0xffb575[_0x211e78(0x99)]+'*\x0a')+(_0x211e78(0xb4)+_0xffb575[_0x211e78(0xee)]+_0x211e78(0xb8))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x211e78(0x173)+_0x211e78(0x142)+'•\x20Payouts\x0a'+'•\x20Important\x20events\x0a\x0a'+_0x211e78(0x155)+_0x211e78(0x87)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}),console[_0x211e78(0x10d)](_0x211e78(0x89)+_0x2ae66b+'\x20verified\x20for\x20shop\x20'+_0xffb575[_0x211e78(0xee)]+_0x211e78(0x80));}catch(_0x74b7dc){console[_0x211e78(0x118)](_0x211e78(0x10e),_0x74b7dc),await this['bot']?.['sendMessage'](_0x3fe1bb,_0x211e78(0xc6));}}async[a66_0x9cdb6b(0xd4)](_0x312059,_0x930585,_0x46c095){const _0x1d0ca7=a66_0x9cdb6b;if(!this['bot']){console['warn']('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x1f1b8c=await database_1[_0x1d0ca7(0x112)][_0x1d0ca7(0x88)][_0x1d0ca7(0x109)]({'where':{'shopId':_0x312059,'isVerified':!![]}});if(_0x1f1b8c[_0x1d0ca7(0xa6)]===0x0){console[_0x1d0ca7(0x10d)](_0x1d0ca7(0x168)+_0x312059);return;}const _0x17bd08=_0x1f1b8c['map'](async _0x551208=>{const _0x153bc3=_0x1d0ca7;try{await this['bot']?.[_0x153bc3(0xc3)](_0x551208[_0x153bc3(0xf0)],_0x930585,_0x46c095),console[_0x153bc3(0x10d)](_0x153bc3(0xa0)+_0x551208[_0x153bc3(0xf0)]);}catch(_0x4ba9d1){console[_0x153bc3(0x118)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x551208[_0x153bc3(0xf0)]+':',_0x4ba9d1),_0x4ba9d1 instanceof Error&&(_0x4ba9d1[_0x153bc3(0x111)][_0x153bc3(0xd0)](_0x153bc3(0x117))||_0x4ba9d1['message'][_0x153bc3(0xd0)](_0x153bc3(0x11d))||_0x4ba9d1[_0x153bc3(0x111)]['includes'](_0x153bc3(0x102)))&&(await database_1[_0x153bc3(0x112)][_0x153bc3(0x88)][_0x153bc3(0x149)]({'where':{'id':_0x551208['id']},'data':{'isVerified':![]}}),console[_0x153bc3(0x10d)](_0x153bc3(0x134)+_0x551208[_0x153bc3(0xf0)]+_0x153bc3(0xf8)));}});await Promise[_0x1d0ca7(0xb3)](_0x17bd08);}catch(_0x34279d){console[_0x1d0ca7(0x118)](_0x1d0ca7(0x7e),_0x34279d);}}async[a66_0x9cdb6b(0xdc)](_0xb6008a,_0x29040d,_0x94a18d){const _0x16cd75=a66_0x9cdb6b,_0x20ba13={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x848f04={'created':_0x16cd75(0xb6),'paid':_0x16cd75(0x103),'failed':_0x16cd75(0xa5),'expired':_0x16cd75(0x135),'refund':'Payment\x20refund','chargeback':'Payment\x20chargeback','processing':_0x16cd75(0x122)},_0x27684e=_0x20ba13[_0x94a18d],_0x3a1a3a=_0x848f04[_0x94a18d],_0x2b02d3=(0x0,gateway_1[_0x16cd75(0xbb)])(_0x29040d[_0x16cd75(0x9a)]);console[_0x16cd75(0x10d)](_0x16cd75(0x108)+_0x29040d[_0x16cd75(0x9a)]+_0x16cd75(0x9b)+_0x2b02d3+'\x22');let _0x3d489c=_0x27684e+'\x20*'+_0x3a1a3a+_0x16cd75(0x162)+(_0x16cd75(0x93)+_0x29040d[_0x16cd75(0x13b)]+'\x20'+_0x29040d[_0x16cd75(0x13f)]+'*\x0a')+(_0x16cd75(0xcf)+(_0x29040d[_0x16cd75(0x146)]||_0x29040d['id'])+'`\x0a')+(_0x16cd75(0x130)+_0x29040d['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x2b02d3+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x29040d[_0x16cd75(0x151)])[_0x16cd75(0xb0)](_0x16cd75(0x133))+'\x0a');if(_0x29040d[_0x16cd75(0xbf)]||_0x29040d[_0x16cd75(0xa7)]||_0x29040d[_0x16cd75(0xc7)]||_0x29040d[_0x16cd75(0xe9)]||_0x29040d[_0x16cd75(0x11b)]){_0x3d489c+=_0x16cd75(0xbd);_0x29040d['customerName']&&(_0x3d489c+=_0x16cd75(0x132)+_0x29040d[_0x16cd75(0xbf)]+'`\x0a');_0x29040d['customerEmail']&&(_0x3d489c+=_0x16cd75(0x81)+_0x29040d['customerEmail']+'`\x0a');_0x29040d[_0x16cd75(0xc7)]&&(_0x3d489c+='🏦\x20IBAN:\x20`'+_0x29040d[_0x16cd75(0xc7)]+'`\x0a');_0x29040d['customerIp']&&(_0x3d489c+='🌐\x20IP:\x20`'+_0x29040d[_0x16cd75(0xe9)]+'`\x0a');if(_0x29040d[_0x16cd75(0x11b)]){const _0x80d99=_0x29040d[_0x16cd75(0x11b)][_0x16cd75(0xa6)]>0x32?_0x29040d[_0x16cd75(0x11b)][_0x16cd75(0x92)](0x0,0x32)+_0x16cd75(0xff):_0x29040d[_0x16cd75(0x11b)];_0x3d489c+=_0x16cd75(0x95)+_0x80d99+'`\x0a';}}_0x94a18d===_0x16cd75(0xaa)&&_0x29040d[_0x16cd75(0xd7)]&&(_0x3d489c+=_0x16cd75(0xb9)+_0x29040d[_0x16cd75(0xd7)]+_0x16cd75(0x143)),_0x94a18d===_0x16cd75(0x148)&&(_0x3d489c+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x29040d['adminNotes']&&(_0x3d489c+=_0x16cd75(0x74)+_0x29040d[_0x16cd75(0xe3)]+'\x0a'),await this[_0x16cd75(0xd4)](_0xb6008a,_0x3d489c,{'parse_mode':_0x16cd75(0x107)});}async[a66_0x9cdb6b(0x85)](_0x9e68c5,_0x1f39c2){const _0x51089f=a66_0x9cdb6b,_0x3f5a60=new Date(_0x1f39c2[_0x51089f(0x151)])[_0x51089f(0xb0)](_0x51089f(0x133),{'year':_0x51089f(0x11a),'month':_0x51089f(0xf6),'day':_0x51089f(0xf6),'hour':'2-digit','minute':_0x51089f(0xf6),'second':'2-digit'}),_0x3345e3=_0x51089f(0x153)+('📅\x20*Payout\x20Date:*\x20'+_0x3f5a60+'\x0a')+(_0x51089f(0x15a)+_0x1f39c2['amount']+'\x20USD\x0a')+('⏱️\x20*Period:*\x20'+(_0x1f39c2['period']||'Not\x20specified')+'\x0a')+(_0x51089f(0xe1)+(_0x1f39c2[_0x51089f(0x156)]||'Not\x20specified')+'\x0a')+('💳\x20*Wallet:*\x20`'+(_0x1f39c2[_0x51089f(0xf2)]||_0x51089f(0xd1))+'`\x0a')+(_0x1f39c2[_0x51089f(0x7b)]?_0x51089f(0x100)+_0x1f39c2[_0x51089f(0x7b)]+'`':_0x51089f(0xd9));await this['sendShopNotification'](_0x9e68c5,_0x3345e3,{'parse_mode':_0x51089f(0x107)});}async[a66_0x9cdb6b(0x11f)](_0x2f9f28,_0x15a7d8){const _0x548484=a66_0x9cdb6b;try{const _0x186928=await database_1[_0x548484(0x112)]['shopSettings'][_0x548484(0xe5)]({'where':{'shopId':_0x2f9f28},'select':{'notificationLogin':!![]}});if(!_0x186928?.[_0x548484(0xec)]){console[_0x548484(0x10d)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x2f9f28);return;}const _0x1f3eb4=_0x15a7d8['success']?'🔐':'🚨',_0x2bdd23=_0x15a7d8[_0x548484(0xf9)]?_0x548484(0x141):_0x548484(0xba);let _0x1c9233=_0x1f3eb4+'\x20*'+_0x2bdd23+'*\x0a\x0a'+('👤\x20Username:\x20`'+_0x15a7d8['username']+'`\x0a')+('📅\x20Time:\x20'+_0x15a7d8['timestamp'][_0x548484(0xb0)](_0x548484(0x133))+'\x0a');_0x15a7d8['ipAddress']&&(_0x1c9233+=_0x548484(0xd3)+_0x15a7d8[_0x548484(0x157)]+'`\x0a');_0x15a7d8[_0x548484(0xe2)]&&(_0x1c9233+=_0x548484(0x164)+_0x15a7d8[_0x548484(0xe2)]+'\x0a');if(_0x15a7d8[_0x548484(0xa3)]){const _0x33becc=_0x15a7d8[_0x548484(0xa3)]['length']>0x32?_0x15a7d8['userAgent'][_0x548484(0x92)](0x0,0x32)+_0x548484(0xff):_0x15a7d8[_0x548484(0xa3)];_0x1c9233+=_0x548484(0x95)+_0x33becc+'`\x0a';}!_0x15a7d8[_0x548484(0xf9)]&&(_0x1c9233+=_0x548484(0xe4)),await this[_0x548484(0xd4)](_0x2f9f28,_0x1c9233,{'parse_mode':_0x548484(0x107)}),console[_0x548484(0x10d)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x2f9f28+':\x20'+(_0x15a7d8[_0x548484(0xf9)]?_0x548484(0xf9):_0x548484(0x10b)));}catch(_0x4af58c){console[_0x548484(0x118)](_0x548484(0xce),_0x4af58c);}}async[a66_0x9cdb6b(0xac)](_0x3b3547,_0x340302){const _0x1fbea4=a66_0x9cdb6b;try{const _0x4f946b=await database_1['default'][_0x1fbea4(0x137)][_0x1fbea4(0xe5)]({'where':{'shopId':_0x3b3547},'select':{'notificationApiError':!![]}});if(!_0x4f946b?.[_0x1fbea4(0x139)]){console[_0x1fbea4(0x10d)](_0x1fbea4(0x105)+_0x3b3547);return;}let _0x5cf797='🚨\x20*API\x20Error*\x0a\x0a'+(_0x1fbea4(0xdd)+_0x340302[_0x1fbea4(0xfb)]+'\x20'+_0x340302[_0x1fbea4(0x8f)]+'`\x0a')+(_0x1fbea4(0x120)+_0x340302[_0x1fbea4(0x15e)][_0x1fbea4(0xb0)](_0x1fbea4(0x133))+'\x0a');_0x340302[_0x1fbea4(0x13d)]&&(_0x5cf797+=_0x1fbea4(0x158)+_0x340302[_0x1fbea4(0x13d)]+'`\x0a'),_0x5cf797+=_0x1fbea4(0x12d)+_0x340302[_0x1fbea4(0x123)]+'`\x0a',_0x340302[_0x1fbea4(0x14b)]&&(_0x5cf797+=_0x1fbea4(0x10a)+_0x340302['requestId']+'`\x0a'),_0x5cf797+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this['sendShopNotification'](_0x3b3547,_0x5cf797,{'parse_mode':_0x1fbea4(0x107)}),console[_0x1fbea4(0x10d)](_0x1fbea4(0x14c)+_0x3b3547+':\x20'+_0x340302[_0x1fbea4(0x8f)]);}catch(_0x194bc6){console[_0x1fbea4(0x118)](_0x1fbea4(0x12a),_0x194bc6);}}async[a66_0x9cdb6b(0xcb)](_0x3aa379,_0x53f2c6,_0xca3e3a){const _0x5b58e3=a66_0x9cdb6b;let _0x50cdc9='🔔\x20*'+_0x53f2c6+_0x5b58e3(0x162);for(const [_0x5d8042,_0x3b2062]of Object[_0x5b58e3(0x174)](_0xca3e3a)){_0x3b2062!==null&&_0x3b2062!==undefined&&(_0x50cdc9+=_0x5d8042+_0x5b58e3(0x16c)+_0x3b2062+'`\x0a');}await this[_0x5b58e3(0xd4)](_0x3aa379,_0x50cdc9,{'parse_mode':'Markdown'});}async['sendNotificationToAll'](_0x3aa600){const _0x54b46d=a66_0x9cdb6b;try{console[_0x54b46d(0x10d)](_0x54b46d(0xdb)+_0x3aa600[_0x54b46d(0x92)](0x0,0x32)+_0x54b46d(0xff));const _0x273ea1=await database_1[_0x54b46d(0x112)][_0x54b46d(0x88)]['findMany']({'select':{'telegramId':!![]}});if(_0x273ea1[_0x54b46d(0xa6)]===0x0){console[_0x54b46d(0x10d)](_0x54b46d(0x161));return;}for(const _0x952f2 of _0x273ea1){try{await this[_0x54b46d(0x129)]?.[_0x54b46d(0xc3)](_0x952f2[_0x54b46d(0xf0)],_0x3aa600,{'parse_mode':'Markdown'});}catch(_0x3ba44c){console['error'](_0x54b46d(0x16e)+_0x952f2[_0x54b46d(0xf0)]+':',_0x3ba44c);}}console['log'](_0x54b46d(0x125)+_0x273ea1['length']+_0x54b46d(0x101));}catch(_0x232271){console[_0x54b46d(0x118)](_0x54b46d(0x14d),_0x232271);}}[a66_0x9cdb6b(0xe0)](){const _0x18dce9=a66_0x9cdb6b;return{'isActive':!!this[_0x18dce9(0x129)],'username':this['botUsername']};}async['sendShopFile'](_0x194ccb,_0x5c8d6b,_0x2e1341,_0x38c6e5){const _0xf942d9=a66_0x9cdb6b;try{if(!this['bot'])return console[_0xf942d9(0x118)](_0xf942d9(0x124)),![];const _0x3cbfa8=await database_1['default'][_0xf942d9(0x88)][_0xf942d9(0x109)]({'where':{'shopId':_0x194ccb,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x3cbfa8['length']===0x0)return console[_0xf942d9(0x118)](_0xf942d9(0x11e)+_0x194ccb),![];let _0x5e2646=0x0;for(const _0x2f78b5 of _0x3cbfa8){try{await this[_0xf942d9(0x129)][_0xf942d9(0xaf)](_0x2f78b5['telegramId'],_0x5c8d6b,{},{'filename':_0x2e1341,'contentType':_0x2e1341[_0xf942d9(0x147)]('.png')?_0xf942d9(0x91):_0x2e1341[_0xf942d9(0x147)](_0xf942d9(0xa8))||_0x2e1341[_0xf942d9(0x147)](_0xf942d9(0xf5))?'image/jpeg':_0x2e1341[_0xf942d9(0x147)]('.pdf')?'application/pdf':'application/octet-stream'}),_0x38c6e5&&await this[_0xf942d9(0x129)][_0xf942d9(0xc3)](_0x2f78b5['telegramId'],_0x38c6e5),_0x5e2646++;}catch(_0x9e8163){console[_0xf942d9(0x118)]('❌\x20Error\x20sending\x20file\x20to\x20user\x20'+_0x2f78b5[_0xf942d9(0xf0)]+':',_0x9e8163);}}return console[_0xf942d9(0x10d)]('✅\x20File\x20sent\x20to\x20'+_0x5e2646+'/'+_0x3cbfa8[_0xf942d9(0xa6)]+_0xf942d9(0x114)+_0x194ccb+':\x20'+_0x2e1341),_0x5e2646>0x0;}catch(_0x34428e){return console[_0xf942d9(0x118)](_0xf942d9(0xb5),_0x34428e),![];}}async['sendDirectMessage'](_0x5be057,_0x531327){const _0x2bf9dd=a66_0x9cdb6b;try{if(!this['bot'])return console['error'](_0x2bf9dd(0x124)),![];return await this[_0x2bf9dd(0x129)][_0x2bf9dd(0xc3)](_0x5be057,_0x531327),console[_0x2bf9dd(0x10d)](_0x2bf9dd(0x16d)+_0x5be057),!![];}catch(_0x21b65a){return console[_0x2bf9dd(0x118)]('❌\x20Error\x20sending\x20direct\x20message:',_0x21b65a),![];}}async[a66_0x9cdb6b(0x13e)](_0x1482d9,_0x499c2a,_0x362228,_0x457096){const _0x4779d9=a66_0x9cdb6b;try{if(!this[_0x4779d9(0x129)])return console[_0x4779d9(0x118)](_0x4779d9(0x124)),![];return await this[_0x4779d9(0x129)][_0x4779d9(0xaf)](_0x1482d9,_0x499c2a,{},{'filename':_0x362228,'contentType':_0x362228[_0x4779d9(0x147)](_0x4779d9(0xf1))?_0x4779d9(0x91):_0x362228[_0x4779d9(0x147)](_0x4779d9(0xa8))||_0x362228[_0x4779d9(0x147)](_0x4779d9(0xf5))?_0x4779d9(0x9d):_0x362228[_0x4779d9(0x147)]('.pdf')?_0x4779d9(0xeb):_0x4779d9(0xa1)}),_0x457096&&await this[_0x4779d9(0x129)]['sendMessage'](_0x1482d9,_0x457096),console[_0x4779d9(0x10d)]('✅\x20File\x20sent\x20to\x20chat\x20'+_0x1482d9+':\x20'+_0x362228),!![];}catch(_0x2fcf0f){return console[_0x4779d9(0x118)](_0x4779d9(0x97),_0x2fcf0f),![];}}[a66_0x9cdb6b(0x169)](){const _0x4b56db=a66_0x9cdb6b;this[_0x4b56db(0x129)]&&(this[_0x4b56db(0x129)][_0x4b56db(0xc0)](),this[_0x4b56db(0x129)]=null,console[_0x4b56db(0x10d)](_0x4b56db(0x16b)));}}exports['TelegramBotService']=TelegramBotService,exports[a66_0x9cdb6b(0x8a)]=new TelegramBotService();