'use strict';const a57_0x43c09c=a57_0x46e8;(function(_0x329b04,_0x1fc434){const _0x57f19e=a57_0x46e8,_0x39b324=_0x329b04();while(!![]){try{const _0x1b93ca=parseInt(_0x57f19e(0x172))/0x1*(parseInt(_0x57f19e(0x1ad))/0x2)+parseInt(_0x57f19e(0x1bb))/0x3*(-parseInt(_0x57f19e(0x1cf))/0x4)+parseInt(_0x57f19e(0x1e9))/0x5*(-parseInt(_0x57f19e(0x1c1))/0x6)+-parseInt(_0x57f19e(0x165))/0x7+-parseInt(_0x57f19e(0x19f))/0x8+-parseInt(_0x57f19e(0x155))/0x9*(-parseInt(_0x57f19e(0x163))/0xa)+-parseInt(_0x57f19e(0x1b8))/0xb*(-parseInt(_0x57f19e(0x1be))/0xc);if(_0x1b93ca===_0x1fc434)break;else _0x39b324['push'](_0x39b324['shift']());}catch(_0x37463f){_0x39b324['push'](_0x39b324['shift']());}}}(a57_0x3b38,0x642b7));var __importDefault=this&&this[a57_0x43c09c(0x1a5)]||function(_0x3dec62){const _0x3990c7=a57_0x43c09c;return _0x3dec62&&_0x3dec62[_0x3990c7(0x18c)]?_0x3dec62:{'default':_0x3dec62};};function a57_0x3b38(){const _0x461246=['length','*.\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','setupBotHandlers','•\x20Important\x20events\x0a\x0a','getGatewayDisplayNameForTelegram','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','test','❌\x20Shop\x20with\x20username\x20`','🌐\x20IP\x20address:\x20`','botToken','bot','🔔\x20*','toLocaleString','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','telegramBotService','🔔\x20Notifications\x20are\x20active\x0a\x0a','name','Contact\x20administrator.','__esModule','text','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','Error\x20in\x20handleSingleLineVerification:','method','en-US','❌\x20Error\x20getting\x20debug\x20information.','entries','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','🏦\x20Method:\x20`','Payment\x20refund','remitterIban','\x20\x20\x20Username:\x20`','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','Payment\x20is\x20being\x20processed','notificationLogin','stopPolling','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','statusCode','5830736aXKzyh','\x20parts:\x20','Example:\x0a','shopId','TELEGRAM_BOT_USERNAME','chargebackAmount','__importDefault','✅\x20Telegram\x20user\x20','`.\x0a\x0a','🔌\x20User\x20','telegramUser','sendApiErrorNotification','publicKey','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','36USTROv','sendMessage','user\x20is\x20deactivated','shopSettings','forEach','customerName','💻\x20Browser:\x20`','🆔\x20Payment\x20ID:\x20`','unknown\x20shop','Available\x20usernames:\x0a','shop','2589290AvPqEM','orderId','initializeBot','1532901oMfJsP','📅\x20Time:\x20','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','84pJYpvd','🏦\x20IBAN:\x20`','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','2072922eVWJDb','../types/gateway','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','blocked','customerIp','\x0aCheck\x20spelling\x20and\x20try\x20again.','...','Markdown','sendPaymentNotification','/disconnect\x20-\x20disconnect\x20from\x20notifications','`\x20(','•\x20Payment\x20status\x20changes\x0a','Error\x20handling\x20/status\x20command:','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','4HHsibp','username','👤\x20Username:\x20`','customerEmail','last_name','substring','New\x20payment\x20created','userAgent','📛\x20Name:\x20`','from','TELEGRAM_BOT_TOKEN','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','telegramId','gateway','join','warn','toLocaleDateString','📧\x20Email:\x20`','📊\x20Error\x20code:\x20`','•\x20New\x20payments\x0a','...\x22','handleSingleLineVerification','\x20disconnected\x20from\x20shop\x20','...`\x0a\x0a','\x20verified\x20for\x20shop\x20','`\x0a\x0a','10QeLUvE','\x20USD*\x0a','🎉\x20*Congratulations!*\x0a\x0a','endpoint','allSettled','\x20initialized\x20successfully','log','✅\x20Telegram\x20bot\x20@','sendPayoutNotification','amount','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','\x20\x20\x20Public\x20Key:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','📱\x20Shop:\x20*','chat','createdAt','Commands:\x0a','\x22,\x20apiKey=\x22','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','📱\x20Telegram\x20notification:\x20gateway\x20\x22','chat\x20not\x20found','\x22\x20->\x20display\x20\x22','create','env','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','onText','•\x20`','Payment\x20chargeback','Use\x20/start\x20to\x20begin.','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','toString','processing','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','📊\x20*Connection\x20Status*\x0a\x0a','To\x20reconnect,\x20use\x20the\x20/start\x20command','map','ipAddress',':\x20username=\x22','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','Error\x20handling\x20/start\x20command:','*\x0a\x0a','includes','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','Error\x20sending\x20shop\x20notification:','default','🚨\x20*API\x20Error*\x0a\x0a','/status\x20-\x20check\x20connection\x20status\x0a','timestamp','getBotInfo','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','Error\x20handling\x20message:','split','📝\x20Notes:\x20','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Failed\x20to\x20send\x20API\x20error\x20notification:','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','.\x20*','status',':\x20`','update','Error\x20handling\x20/disconnect\x20command:','Use\x20/start\x20to\x20connect.','💰\x20Amount:\x20*','isVerified','sendShopNotification','❌\x20Invalid\x20username\x20format:\x20`','pk_','📅\x20Date:\x20','adminNotes','❌\x20Error:\x20`','requestId','findMany','startsWith','\x0a👤\x20*Customer\x20Information:*\x0a','🌐\x20IP:\x20`','success','TelegramBotService','3136734KJbcXd','\x20USDT*\x0a','📝\x20Order\x20ID:\x20`','customerUa','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','findUnique','💸\x20Amount:\x20*','Failed\x20to\x20send\x20login\x20notification:','error','🔔\x20You\x20receive\x20notifications\x20about:\x0a','message','ACTIVE','secretKey','10iWnXAW','Payout\x20completed','347284OEDsqN','Payment\x20successfully\x20paid','🔍\x20*Debug\x20Information*\x0a\x0a','📱\x20Created\x20new\x20Telegram\x20user:\x20','sendCustomNotification','🆔\x20Request\x20ID:\x20`','Failed\x20login\x20attempt','botUsername','`\x20not\x20found.\x0a\x0a','errorMessage','\x20\x20\x20Status:\x20','sk_','New\x20payout\x20created','21913UrKPTC','Telegram\x20bot\x20polling\x20error:','defineProperty','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','`\x20is\x20inactive.\x0a\x0a','Payment\x20expired'];a57_0x3b38=function(){return _0x461246;};return a57_0x3b38();}Object[a57_0x43c09c(0x174)](exports,'__esModule',{'value':!![]}),exports[a57_0x43c09c(0x188)]=exports[a57_0x43c09c(0x154)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require('../config/database')),gateway_1=require(a57_0x43c09c(0x1c2));class TelegramBotService{constructor(){const _0x1d57a0=a57_0x43c09c;this['bot']=null,this[_0x1d57a0(0x183)]=process[_0x1d57a0(0x201)][_0x1d57a0(0x1d9)]||'',this[_0x1d57a0(0x16c)]=process[_0x1d57a0(0x201)][_0x1d57a0(0x1a3)]||'trapay_bot',this['botToken']?this[_0x1d57a0(0x1ba)]():console[_0x1d57a0(0x1de)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a57_0x43c09c(0x1ba)](){const _0x1dc588=a57_0x43c09c;try{this['bot']=new node_telegram_bot_api_1['default'](this[_0x1dc588(0x183)],{'polling':!![]}),this[_0x1dc588(0x17b)](),console[_0x1dc588(0x1ef)](_0x1dc588(0x1f0)+this[_0x1dc588(0x16c)]+_0x1dc588(0x1ee));}catch(_0xed55d4){console[_0x1dc588(0x15e)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0xed55d4);}}[a57_0x43c09c(0x17b)](){const _0x1f047b=a57_0x43c09c;if(!this['bot'])return;this[_0x1f047b(0x184)][_0x1f047b(0x203)](/\/start/,async _0x3eb49f=>{const _0x5b9282=_0x1f047b,_0x406a5d=_0x3eb49f[_0x5b9282(0x1f8)]['id'],_0x455956=_0x3eb49f[_0x5b9282(0x1d8)]?.['id'][_0x5b9282(0x208)](),_0x113348=_0x3eb49f[_0x5b9282(0x1d8)]?.['username'],_0xae614a=_0x3eb49f[_0x5b9282(0x1d8)]?.['first_name'],_0x386028=_0x3eb49f[_0x5b9282(0x1d8)]?.[_0x5b9282(0x1d3)];if(!_0x455956)return;try{let _0x324443=await database_1[_0x5b9282(0x134)][_0x5b9282(0x1a9)][_0x5b9282(0x15b)]({'where':{'telegramId':_0x455956},'include':{'shop':!![]}});!_0x324443?(_0x324443=await database_1[_0x5b9282(0x134)][_0x5b9282(0x1a9)][_0x5b9282(0x200)]({'data':{'telegramId':_0x455956,'username':_0x113348,'firstName':_0xae614a,'lastName':_0x386028,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x5b9282(0x168)+_0x455956+'\x20(@'+_0x113348+')')):_0x324443=await database_1['default'][_0x5b9282(0x1a9)][_0x5b9282(0x143)]({'where':{'telegramId':_0x455956},'data':{'username':_0x113348,'firstName':_0xae614a,'lastName':_0x386028},'include':{'shop':!![]}}),_0x324443[_0x5b9282(0x147)]&&_0x324443['shopId']&&_0x324443[_0x5b9282(0x1b7)]?await this[_0x5b9282(0x184)]?.[_0x5b9282(0x1ae)](_0x406a5d,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x5b9282(0x194)+_0x324443[_0x5b9282(0x1b7)][_0x5b9282(0x18a)]+'*\x0a')+('Username:\x20`'+_0x324443['shop'][_0x5b9282(0x1d0)]+'`\x0a\x0a')+_0x5b9282(0x15f)+_0x5b9282(0x1e2)+_0x5b9282(0x1cc)+'•\x20Payouts\x0a\x0a'+_0x5b9282(0x1fa)+_0x5b9282(0x136)+_0x5b9282(0x1ca),{'parse_mode':_0x5b9282(0x1c8)}):(_0x324443[_0x5b9282(0x1a2)]&&!_0x324443[_0x5b9282(0x147)]&&(await database_1['default'][_0x5b9282(0x1a9)][_0x5b9282(0x143)]({'where':{'telegramId':_0x455956},'data':{'shopId':null,'isVerified':![]}}),console[_0x5b9282(0x1ef)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x455956)),await this[_0x5b9282(0x184)]?.['sendMessage'](_0x406a5d,_0x5b9282(0x1ce)+_0x5b9282(0x187)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x5b9282(0x1a1)+_0x5b9282(0x17f)+_0x5b9282(0x18e),{'parse_mode':'Markdown'}));}catch(_0x219d67){console['error'](_0x5b9282(0x12f),_0x219d67),await this[_0x5b9282(0x184)]?.[_0x5b9282(0x1ae)](_0x406a5d,_0x5b9282(0x1ac));}}),this['bot']['onText'](/\/disconnect/,async _0x51ab99=>{const _0x1db739=_0x1f047b,_0x1297c8=_0x51ab99[_0x1db739(0x1f8)]['id'],_0x3f6697=_0x51ab99[_0x1db739(0x1d8)]?.['id'][_0x1db739(0x208)]();if(!_0x3f6697)return;try{const _0x122792=await database_1[_0x1db739(0x134)][_0x1db739(0x1a9)][_0x1db739(0x15b)]({'where':{'telegramId':_0x3f6697},'include':{'shop':!![]}});if(!_0x122792||!_0x122792[_0x1db739(0x147)]||!_0x122792[_0x1db739(0x1a2)]){await this[_0x1db739(0x184)]?.[_0x1db739(0x1ae)](_0x1297c8,_0x1db739(0x19d));return;}const _0x32c550=_0x122792[_0x1db739(0x1b7)]?.[_0x1db739(0x18a)]||_0x1db739(0x1b5);await database_1[_0x1db739(0x134)][_0x1db739(0x1a9)][_0x1db739(0x143)]({'where':{'telegramId':_0x3f6697},'data':{'shopId':null,'isVerified':![]}}),console[_0x1db739(0x1ef)](_0x1db739(0x1a8)+_0x3f6697+_0x1db739(0x1e5)+_0x122792['shopId']),await this['bot']?.[_0x1db739(0x1ae)](_0x1297c8,_0x1db739(0x1fc)+_0x32c550+_0x1db739(0x179)+_0x1db739(0x20c),{'parse_mode':_0x1db739(0x1c8)});}catch(_0x49475a){console[_0x1db739(0x15e)](_0x1db739(0x144),_0x49475a),await this[_0x1db739(0x184)]?.[_0x1db739(0x1ae)](_0x1297c8,_0x1db739(0x1ac));}}),this[_0x1f047b(0x184)][_0x1f047b(0x203)](/\/status/,async _0x58df4b=>{const _0xeffd15=_0x1f047b,_0x1f0ed9=_0x58df4b[_0xeffd15(0x1f8)]['id'],_0x173c18=_0x58df4b[_0xeffd15(0x1d8)]?.['id'][_0xeffd15(0x208)]();if(!_0x173c18)return;try{const _0xbb65b5=await database_1[_0xeffd15(0x134)][_0xeffd15(0x1a9)][_0xeffd15(0x15b)]({'where':{'telegramId':_0x173c18},'include':{'shop':!![]}});if(!_0xbb65b5){await this[_0xeffd15(0x184)]?.['sendMessage'](_0x1f0ed9,_0xeffd15(0x132)+_0xeffd15(0x206));return;}if(!_0xbb65b5[_0xeffd15(0x147)]||!_0xbb65b5[_0xeffd15(0x1a2)]||!_0xbb65b5[_0xeffd15(0x1b7)]){await this[_0xeffd15(0x184)]?.[_0xeffd15(0x1ae)](_0x1f0ed9,_0xeffd15(0x1f5)+_0xeffd15(0x145));return;}await this[_0xeffd15(0x184)]?.['sendMessage'](_0x1f0ed9,_0xeffd15(0x20b)+('✅\x20Connected\x20to\x20shop:\x20*'+_0xbb65b5[_0xeffd15(0x1b7)][_0xeffd15(0x18a)]+'*\x0a')+(_0xeffd15(0x1d1)+_0xbb65b5[_0xeffd15(0x1b7)][_0xeffd15(0x1d0)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0xbb65b5['updatedAt'][_0xeffd15(0x1df)](_0xeffd15(0x191))+'\x0a\x0a')+_0xeffd15(0x189)+_0xeffd15(0x1fa)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'});}catch(_0xd049be){console['error'](_0xeffd15(0x1cd),_0xd049be),await this[_0xeffd15(0x184)]?.[_0xeffd15(0x1ae)](_0x1f0ed9,_0xeffd15(0x1ac));}}),this[_0x1f047b(0x184)]['onText'](/\/debug/,async _0x2672cc=>{const _0x54e1c6=_0x1f047b,_0x21fb31=_0x2672cc[_0x54e1c6(0x1f8)]['id'],_0x5514c2=_0x2672cc[_0x54e1c6(0x1d8)]?.['id'][_0x54e1c6(0x208)]();if(!_0x5514c2)return;try{const _0x41ec24=await database_1[_0x54e1c6(0x134)][_0x54e1c6(0x1b7)][_0x54e1c6(0x14f)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4fcc48=_0x54e1c6(0x167);_0x4fcc48+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x5514c2+_0x54e1c6(0x1e8),_0x4fcc48+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x41ec24[_0x54e1c6(0x1b1)]((_0x325566,_0x5b119d)=>{const _0x4d0b2a=_0x54e1c6;_0x4fcc48+=_0x5b119d+0x1+_0x4d0b2a(0x140)+_0x325566[_0x4d0b2a(0x18a)]+'*\x0a',_0x4fcc48+=_0x4d0b2a(0x198)+_0x325566[_0x4d0b2a(0x1d0)]+'`\x0a',_0x4fcc48+=_0x4d0b2a(0x16f)+_0x325566['status']+'\x0a',_0x4fcc48+=_0x4d0b2a(0x1f4)+_0x325566[_0x4d0b2a(0x1ab)][_0x4d0b2a(0x1d4)](0x0,0xf)+_0x4d0b2a(0x1e6);}),await this[_0x54e1c6(0x184)]?.[_0x54e1c6(0x1ae)](_0x21fb31,_0x4fcc48,{'parse_mode':'Markdown'});}catch(_0x560ecc){console['error']('Error\x20handling\x20/debug\x20command:',_0x560ecc),await this['bot']?.[_0x54e1c6(0x1ae)](_0x21fb31,_0x54e1c6(0x192));}}),this[_0x1f047b(0x184)]['on'](_0x1f047b(0x160),async _0x1f04b0=>{const _0x10f553=_0x1f047b;if(_0x1f04b0[_0x10f553(0x18d)]?.[_0x10f553(0x150)]('/'))return;const _0x5421de=_0x1f04b0[_0x10f553(0x1f8)]['id'],_0x4d07e8=_0x1f04b0[_0x10f553(0x1d8)]?.['id'][_0x10f553(0x208)](),_0x1daeaf=_0x1f04b0[_0x10f553(0x18d)]?.['trim']();if(!_0x4d07e8||!_0x1daeaf)return;try{const _0x1b0e0d=await database_1[_0x10f553(0x134)][_0x10f553(0x1a9)]['findUnique']({'where':{'telegramId':_0x4d07e8},'include':{'shop':!![]}});if(!_0x1b0e0d){await this[_0x10f553(0x184)]?.[_0x10f553(0x1ae)](_0x5421de,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x1b0e0d['isVerified']&&_0x1b0e0d[_0x10f553(0x1a2)]&&_0x1b0e0d[_0x10f553(0x1b7)]){await this[_0x10f553(0x184)]?.[_0x10f553(0x1ae)](_0x5421de,_0x10f553(0x13f)+_0x1b0e0d[_0x10f553(0x1b7)][_0x10f553(0x18a)]+_0x10f553(0x179)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x10f553(0x1c8)});return;}const _0x1462a1=_0x1daeaf[_0x10f553(0x13b)](/\s+/);if(_0x1462a1[_0x10f553(0x178)]!==0x2){await this[_0x10f553(0x184)]?.[_0x10f553(0x1ae)](_0x5421de,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x10f553(0x1a1)+_0x10f553(0x17f)+('You\x20sent\x20'+_0x1462a1[_0x10f553(0x178)]+_0x10f553(0x1a0)+_0x1462a1['map'](_0x55018e=>'`'+_0x55018e+'`')[_0x10f553(0x1dd)](',\x20')),{'parse_mode':_0x10f553(0x1c8)});return;}const [_0x541aa7,_0x171ccd]=_0x1462a1;console[_0x10f553(0x1ef)](_0x10f553(0x159)+_0x4d07e8+_0x10f553(0x20f)+_0x541aa7+_0x10f553(0x1fb)+_0x171ccd[_0x10f553(0x1d4)](0x0,0xa)+_0x10f553(0x1e3)),await this[_0x10f553(0x1e4)](_0x5421de,_0x4d07e8,_0x541aa7,_0x171ccd);}catch(_0x2e5d86){console[_0x10f553(0x15e)](_0x10f553(0x13a),_0x2e5d86),await this[_0x10f553(0x184)]?.['sendMessage'](_0x5421de,_0x10f553(0x1ac));}}),this['bot']['on']('error',_0x51a942=>{console['error']('Telegram\x20bot\x20error:',_0x51a942);}),this[_0x1f047b(0x184)]['on']('polling_error',_0x2120d8=>{const _0x4b4186=_0x1f047b;console[_0x4b4186(0x15e)](_0x4b4186(0x173),_0x2120d8);});}async[a57_0x43c09c(0x1e4)](_0x464239,_0x5e80e6,_0x3a44ae,_0x597de9){const _0x37fd4d=a57_0x43c09c;try{console[_0x37fd4d(0x1ef)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x5e80e6+_0x37fd4d(0x20f)+_0x3a44ae+_0x37fd4d(0x1fb)+_0x597de9[_0x37fd4d(0x1d4)](0x0,0xa)+_0x37fd4d(0x1e3));if(!_0x3a44ae||_0x3a44ae[_0x37fd4d(0x178)]<0x3||_0x3a44ae[_0x37fd4d(0x178)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x37fd4d(0x180)](_0x3a44ae)){await this[_0x37fd4d(0x184)]?.['sendMessage'](_0x464239,_0x37fd4d(0x149)+_0x3a44ae+_0x37fd4d(0x1e8)+_0x37fd4d(0x1f3),{'parse_mode':_0x37fd4d(0x1c8)});return;}if(!_0x597de9||!_0x597de9[_0x37fd4d(0x150)](_0x37fd4d(0x14a))&&!_0x597de9[_0x37fd4d(0x150)](_0x37fd4d(0x170))){await this[_0x37fd4d(0x184)]?.[_0x37fd4d(0x1ae)](_0x464239,_0x37fd4d(0x1c3)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':'Markdown'});return;}const _0x28d017=await database_1['default']['shop'][_0x37fd4d(0x15b)]({'where':{'username':_0x3a44ae},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x28d017){const _0x488f96=await database_1[_0x37fd4d(0x134)][_0x37fd4d(0x1b7)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x48e58b=_0x37fd4d(0x181)+_0x3a44ae+_0x37fd4d(0x16d);_0x488f96['length']>0x0?(_0x48e58b+=_0x37fd4d(0x1b6),_0x488f96[_0x37fd4d(0x1b1)](_0x50e887=>{const _0x580d78=_0x37fd4d;_0x48e58b+=_0x580d78(0x204)+_0x50e887[_0x580d78(0x1d0)]+_0x580d78(0x1cb)+_0x50e887[_0x580d78(0x18a)]+')\x0a';}),_0x48e58b+=_0x37fd4d(0x1c6)):_0x48e58b+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x37fd4d(0x184)]?.[_0x37fd4d(0x1ae)](_0x464239,_0x48e58b,{'parse_mode':_0x37fd4d(0x1c8)});return;}if(_0x28d017[_0x37fd4d(0x141)]!==_0x37fd4d(0x161)){await this['bot']?.[_0x37fd4d(0x1ae)](_0x464239,'❌\x20Shop\x20`'+_0x3a44ae+_0x37fd4d(0x176)+_0x37fd4d(0x18b),{'parse_mode':_0x37fd4d(0x1c8)});return;}if(_0x28d017[_0x37fd4d(0x1ab)]!==_0x597de9&&_0x28d017[_0x37fd4d(0x162)]!==_0x597de9){await this['bot']?.[_0x37fd4d(0x1ae)](_0x464239,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x3a44ae+'`.\x0a\x0a'+_0x37fd4d(0x207)+_0x37fd4d(0x202),{'parse_mode':_0x37fd4d(0x1c8)});return;}const _0x3c1aff=await database_1[_0x37fd4d(0x134)][_0x37fd4d(0x1a9)]['findFirst']({'where':{'shopId':_0x28d017['id'],'isVerified':!![],'telegramId':{'not':_0x5e80e6}}});if(_0x3c1aff){await this[_0x37fd4d(0x184)]?.[_0x37fd4d(0x1ae)](_0x464239,_0x37fd4d(0x139)+_0x3a44ae+_0x37fd4d(0x1a7)+_0x37fd4d(0x1bd),{'parse_mode':_0x37fd4d(0x1c8)});return;}await database_1[_0x37fd4d(0x134)]['telegramUser'][_0x37fd4d(0x143)]({'where':{'telegramId':_0x5e80e6},'data':{'shopId':_0x28d017['id'],'isVerified':!![]}}),await this['bot']?.[_0x37fd4d(0x1ae)](_0x464239,_0x37fd4d(0x1eb)+_0x37fd4d(0x17a)+(_0x37fd4d(0x1f7)+_0x28d017[_0x37fd4d(0x18a)]+'*\x0a')+(_0x37fd4d(0x1d1)+_0x28d017['username']+'`\x0a\x0a')+_0x37fd4d(0x17e)+_0x37fd4d(0x1e2)+_0x37fd4d(0x1cc)+'•\x20Payouts\x0a'+_0x37fd4d(0x17c)+_0x37fd4d(0x1fa)+_0x37fd4d(0x136)+_0x37fd4d(0x1ca),{'parse_mode':'Markdown'}),console['log'](_0x37fd4d(0x1a6)+_0x5e80e6+_0x37fd4d(0x1e7)+_0x28d017[_0x37fd4d(0x1d0)]+'\x20via\x20single-line\x20input');}catch(_0x361f1f){console[_0x37fd4d(0x15e)](_0x37fd4d(0x18f),_0x361f1f),await this[_0x37fd4d(0x184)]?.['sendMessage'](_0x464239,_0x37fd4d(0x13d));}}async[a57_0x43c09c(0x148)](_0x5bdc2a,_0x10ec84,_0x1dd029){const _0x2e5f7e=a57_0x43c09c;if(!this[_0x2e5f7e(0x184)]){console[_0x2e5f7e(0x1de)](_0x2e5f7e(0x15a));return;}try{const _0x118f6f=await database_1[_0x2e5f7e(0x134)]['telegramUser'][_0x2e5f7e(0x14f)]({'where':{'shopId':_0x5bdc2a,'isVerified':!![]}});if(_0x118f6f[_0x2e5f7e(0x178)]===0x0){console[_0x2e5f7e(0x1ef)](_0x2e5f7e(0x175)+_0x5bdc2a);return;}const _0x5a4225=_0x118f6f[_0x2e5f7e(0x20d)](async _0x589ae5=>{const _0x2358e2=_0x2e5f7e;try{await this[_0x2358e2(0x184)]?.[_0x2358e2(0x1ae)](_0x589ae5[_0x2358e2(0x1db)],_0x10ec84,_0x1dd029),console[_0x2358e2(0x1ef)](_0x2358e2(0x20a)+_0x589ae5['telegramId']);}catch(_0x108f06){console[_0x2358e2(0x15e)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x589ae5[_0x2358e2(0x1db)]+':',_0x108f06),_0x108f06 instanceof Error&&(_0x108f06[_0x2358e2(0x160)][_0x2358e2(0x131)](_0x2358e2(0x1c4))||_0x108f06[_0x2358e2(0x160)][_0x2358e2(0x131)](_0x2358e2(0x1fe))||_0x108f06[_0x2358e2(0x160)][_0x2358e2(0x131)](_0x2358e2(0x1af)))&&(await database_1['default'][_0x2358e2(0x1a9)][_0x2358e2(0x143)]({'where':{'id':_0x589ae5['id']},'data':{'isVerified':![]}}),console[_0x2358e2(0x1ef)]('User\x20'+_0x589ae5[_0x2358e2(0x1db)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x2e5f7e(0x1ed)](_0x5a4225);}catch(_0x41e507){console[_0x2e5f7e(0x15e)](_0x2e5f7e(0x133),_0x41e507);}}async[a57_0x43c09c(0x1c9)](_0x127bc1,_0x448b48,_0x25a73d){const _0x480967=a57_0x43c09c,_0x45259d={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x215e43={'created':_0x480967(0x1d5),'paid':_0x480967(0x166),'failed':'Payment\x20failed','expired':_0x480967(0x177),'refund':_0x480967(0x196),'chargeback':_0x480967(0x205),'processing':_0x480967(0x19a)},_0x3684a3=_0x45259d[_0x25a73d],_0x37204e=_0x215e43[_0x25a73d],_0x5e1e45=(0x0,gateway_1[_0x480967(0x17d)])(_0x448b48[_0x480967(0x1dc)]);console['log'](_0x480967(0x1fd)+_0x448b48[_0x480967(0x1dc)]+_0x480967(0x1ff)+_0x5e1e45+'\x22');let _0x276640=_0x3684a3+'\x20*'+_0x37204e+_0x480967(0x130)+(_0x480967(0x146)+_0x448b48[_0x480967(0x1f2)]+'\x20'+_0x448b48['currency']+'*\x0a')+(_0x480967(0x157)+(_0x448b48[_0x480967(0x1b9)]||_0x448b48['id'])+'`\x0a')+(_0x480967(0x1b4)+_0x448b48['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x5e1e45+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x448b48['createdAt'])[_0x480967(0x186)](_0x480967(0x191))+'\x0a');if(_0x448b48[_0x480967(0x1b2)]||_0x448b48[_0x480967(0x1d2)]||_0x448b48[_0x480967(0x197)]||_0x448b48['customerIp']||_0x448b48[_0x480967(0x158)]){_0x276640+=_0x480967(0x151);_0x448b48['customerName']&&(_0x276640+=_0x480967(0x1d7)+_0x448b48['customerName']+'`\x0a');_0x448b48[_0x480967(0x1d2)]&&(_0x276640+=_0x480967(0x1e0)+_0x448b48['customerEmail']+'`\x0a');_0x448b48[_0x480967(0x197)]&&(_0x276640+=_0x480967(0x1bf)+_0x448b48[_0x480967(0x197)]+'`\x0a');_0x448b48['customerIp']&&(_0x276640+=_0x480967(0x152)+_0x448b48[_0x480967(0x1c5)]+'`\x0a');if(_0x448b48[_0x480967(0x158)]){const _0x5d1321=_0x448b48['customerUa'][_0x480967(0x178)]>0x32?_0x448b48[_0x480967(0x158)][_0x480967(0x1d4)](0x0,0x32)+_0x480967(0x1c7):_0x448b48['customerUa'];_0x276640+=_0x480967(0x1b3)+_0x5d1321+'`\x0a';}}_0x25a73d==='chargeback'&&_0x448b48[_0x480967(0x1a4)]&&(_0x276640+='💸\x20Penalty\x20amount:\x20*'+_0x448b48['chargebackAmount']+_0x480967(0x156)),_0x25a73d===_0x480967(0x209)&&(_0x276640+=_0x480967(0x1da)),_0x448b48[_0x480967(0x14c)]&&(_0x276640+=_0x480967(0x13c)+_0x448b48['adminNotes']+'\x0a'),await this[_0x480967(0x148)](_0x127bc1,_0x276640,{'parse_mode':'Markdown'});}async[a57_0x43c09c(0x1f1)](_0x24e6e2,_0x471084,_0x5a3488){const _0x392c23=a57_0x43c09c,_0x4e4584={'created':'📤','completed':'✅','rejected':'❌'},_0x3baecc={'created':_0x392c23(0x171),'completed':_0x392c23(0x164),'rejected':'Payout\x20rejected'},_0x107be9=_0x4e4584[_0x5a3488],_0x418344=_0x3baecc[_0x5a3488],_0x45705d=_0x107be9+'\x20*'+_0x418344+_0x392c23(0x130)+(_0x392c23(0x15c)+_0x471084['amount']+_0x392c23(0x1ea))+(_0x392c23(0x195)+_0x471084[_0x392c23(0x190)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x471084['id']+'`\x0a')+(_0x392c23(0x14b)+new Date(_0x471084[_0x392c23(0x1f9)])[_0x392c23(0x186)]('en-US')+'\x0a')+(_0x471084['txid']?'🔗\x20TXID:\x20`'+_0x471084['txid']+'`':'');await this[_0x392c23(0x148)](_0x24e6e2,_0x45705d,{'parse_mode':_0x392c23(0x1c8)});}async['sendLoginNotification'](_0x1ce28f,_0x2e383c){const _0xff0c94=a57_0x43c09c;try{const _0x5cd51a=await database_1['default'][_0xff0c94(0x1b0)][_0xff0c94(0x15b)]({'where':{'shopId':_0x1ce28f},'select':{'notificationLogin':!![]}});if(!_0x5cd51a?.[_0xff0c94(0x19b)]){console[_0xff0c94(0x1ef)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x1ce28f);return;}const _0x32df99=_0x2e383c[_0xff0c94(0x153)]?'🔐':'🚨',_0x1ae30f=_0x2e383c[_0xff0c94(0x153)]?'Successful\x20login':_0xff0c94(0x16b);let _0x525aeb=_0x32df99+'\x20*'+_0x1ae30f+'*\x0a\x0a'+('👤\x20Username:\x20`'+_0x2e383c[_0xff0c94(0x1d0)]+'`\x0a')+(_0xff0c94(0x1bc)+_0x2e383c['timestamp']['toLocaleString'](_0xff0c94(0x191))+'\x0a');_0x2e383c[_0xff0c94(0x20e)]&&(_0x525aeb+=_0xff0c94(0x182)+_0x2e383c[_0xff0c94(0x20e)]+'`\x0a');if(_0x2e383c[_0xff0c94(0x1d6)]){const _0x23024d=_0x2e383c['userAgent']['length']>0x32?_0x2e383c[_0xff0c94(0x1d6)][_0xff0c94(0x1d4)](0x0,0x32)+_0xff0c94(0x1c7):_0x2e383c[_0xff0c94(0x1d6)];_0x525aeb+=_0xff0c94(0x1b3)+_0x23024d+'`\x0a';}!_0x2e383c[_0xff0c94(0x153)]&&(_0x525aeb+=_0xff0c94(0x199)),await this['sendShopNotification'](_0x1ce28f,_0x525aeb,{'parse_mode':_0xff0c94(0x1c8)}),console[_0xff0c94(0x1ef)](_0xff0c94(0x1c0)+_0x1ce28f+':\x20'+(_0x2e383c[_0xff0c94(0x153)]?_0xff0c94(0x153):'failed'));}catch(_0x32e667){console[_0xff0c94(0x15e)](_0xff0c94(0x15d),_0x32e667);}}async[a57_0x43c09c(0x1aa)](_0x47aa2f,_0x178758){const _0x119cb4=a57_0x43c09c;try{const _0x538fee=await database_1[_0x119cb4(0x134)][_0x119cb4(0x1b0)][_0x119cb4(0x15b)]({'where':{'shopId':_0x47aa2f},'select':{'notificationApiError':!![]}});if(!_0x538fee?.['notificationApiError']){console[_0x119cb4(0x1ef)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x47aa2f);return;}let _0x1a33ba=_0x119cb4(0x135)+('🔗\x20Endpoint:\x20`'+_0x178758[_0x119cb4(0x190)]+'\x20'+_0x178758[_0x119cb4(0x1ec)]+'`\x0a')+(_0x119cb4(0x1bc)+_0x178758[_0x119cb4(0x137)][_0x119cb4(0x186)](_0x119cb4(0x191))+'\x0a');_0x178758[_0x119cb4(0x19e)]&&(_0x1a33ba+=_0x119cb4(0x1e1)+_0x178758['statusCode']+'`\x0a'),_0x1a33ba+=_0x119cb4(0x14d)+_0x178758[_0x119cb4(0x16e)]+'`\x0a',_0x178758[_0x119cb4(0x14e)]&&(_0x1a33ba+=_0x119cb4(0x16a)+_0x178758['requestId']+'`\x0a'),_0x1a33ba+=_0x119cb4(0x12e),await this['sendShopNotification'](_0x47aa2f,_0x1a33ba,{'parse_mode':_0x119cb4(0x1c8)}),console[_0x119cb4(0x1ef)](_0x119cb4(0x1f6)+_0x47aa2f+':\x20'+_0x178758[_0x119cb4(0x1ec)]);}catch(_0x4416f6){console['error'](_0x119cb4(0x13e),_0x4416f6);}}async[a57_0x43c09c(0x169)](_0x35f86c,_0x4fdb4e,_0x44353c){const _0x2e6b39=a57_0x43c09c;let _0xf874f9=_0x2e6b39(0x185)+_0x4fdb4e+_0x2e6b39(0x130);for(const [_0x85bf91,_0x59d804]of Object[_0x2e6b39(0x193)](_0x44353c)){_0x59d804!==null&&_0x59d804!==undefined&&(_0xf874f9+=_0x85bf91+_0x2e6b39(0x142)+_0x59d804+'`\x0a');}await this[_0x2e6b39(0x148)](_0x35f86c,_0xf874f9,{'parse_mode':'Markdown'});}[a57_0x43c09c(0x138)](){const _0x493bad=a57_0x43c09c;return{'isActive':!!this[_0x493bad(0x184)],'username':this[_0x493bad(0x16c)]};}['stopBot'](){const _0x35d96e=a57_0x43c09c;this[_0x35d96e(0x184)]&&(this[_0x35d96e(0x184)][_0x35d96e(0x19c)](),this[_0x35d96e(0x184)]=null,console[_0x35d96e(0x1ef)]('🛑\x20Telegram\x20bot\x20stopped'));}}function a57_0x46e8(_0x363d65,_0x5c5f16){const _0x3b3888=a57_0x3b38();return a57_0x46e8=function(_0x46e832,_0x485c05){_0x46e832=_0x46e832-0x12e;let _0x10dfce=_0x3b3888[_0x46e832];return _0x10dfce;},a57_0x46e8(_0x363d65,_0x5c5f16);}exports[a57_0x43c09c(0x154)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();