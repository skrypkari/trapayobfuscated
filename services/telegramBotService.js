'use strict';const a54_0x283071=a54_0x30c3;(function(_0x64628e,_0x11c465){const _0x258ec7=a54_0x30c3,_0x3e6381=_0x64628e();while(!![]){try{const _0x1baef4=-parseInt(_0x258ec7(0x1c4))/0x1*(parseInt(_0x258ec7(0x1e0))/0x2)+parseInt(_0x258ec7(0x135))/0x3*(parseInt(_0x258ec7(0x1e3))/0x4)+-parseInt(_0x258ec7(0x140))/0x5+parseInt(_0x258ec7(0x18d))/0x6+-parseInt(_0x258ec7(0x1ef))/0x7*(-parseInt(_0x258ec7(0x1bb))/0x8)+-parseInt(_0x258ec7(0x1e9))/0x9*(parseInt(_0x258ec7(0x1e2))/0xa)+parseInt(_0x258ec7(0x13a))/0xb*(parseInt(_0x258ec7(0x1a7))/0xc);if(_0x1baef4===_0x11c465)break;else _0x3e6381['push'](_0x3e6381['shift']());}catch(_0x3f6754){_0x3e6381['push'](_0x3e6381['shift']());}}}(a54_0xc585,0x41e9a));var __importDefault=this&&this[a54_0x283071(0x11c)]||function(_0x348998){const _0x432d4b=a54_0x283071;return _0x348998&&_0x348998[_0x432d4b(0x1eb)]?_0x348998:{'default':_0x348998};};Object[a54_0x283071(0x1e5)](exports,a54_0x283071(0x1eb),{'value':!![]}),exports[a54_0x283071(0x113)]=exports[a54_0x283071(0x159)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x283071(0x14f))),database_1=__importDefault(require(a54_0x283071(0x13d))),gateway_1=require(a54_0x283071(0x13f));function a54_0x30c3(_0x1c1be5,_0xe72d71){const _0xc58552=a54_0xc585();return a54_0x30c3=function(_0x30c374,_0x5595a4){_0x30c374=_0x30c374-0x107;let _0x39e53b=_0xc58552[_0x30c374];return _0x39e53b;},a54_0x30c3(_0x1c1be5,_0xe72d71);}class TelegramBotService{constructor(){const _0x38e63f=a54_0x283071;this[_0x38e63f(0x137)]=null,this['botToken']=process[_0x38e63f(0x192)]['TELEGRAM_BOT_TOKEN']||'',this[_0x38e63f(0x1c6)]=process['env']['TELEGRAM_BOT_USERNAME']||_0x38e63f(0x16f),this[_0x38e63f(0x176)]?this[_0x38e63f(0x1aa)]():console[_0x38e63f(0x143)](_0x38e63f(0x12f));}[a54_0x283071(0x1aa)](){const _0x3a08c8=a54_0x283071;try{this[_0x3a08c8(0x137)]=new node_telegram_bot_api_1[(_0x3a08c8(0x155))](this[_0x3a08c8(0x176)],{'polling':!![]}),this[_0x3a08c8(0x16c)](),console['log'](_0x3a08c8(0x187)+this[_0x3a08c8(0x1c6)]+_0x3a08c8(0x178));}catch(_0x570537){console[_0x3a08c8(0x1a9)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x570537);}}[a54_0x283071(0x16c)](){const _0x29a75f=a54_0x283071;if(!this[_0x29a75f(0x137)])return;this[_0x29a75f(0x137)][_0x29a75f(0x1c9)](/\/start/,async _0x5db8da=>{const _0x376e0f=_0x29a75f,_0x4cac95=_0x5db8da[_0x376e0f(0x1ee)]['id'],_0x24dcf8=_0x5db8da[_0x376e0f(0x191)]?.['id']['toString'](),_0x265d20=_0x5db8da[_0x376e0f(0x191)]?.[_0x376e0f(0x17e)],_0x8c94d2=_0x5db8da[_0x376e0f(0x191)]?.[_0x376e0f(0x185)],_0x28d4cf=_0x5db8da[_0x376e0f(0x191)]?.[_0x376e0f(0x11f)];if(!_0x24dcf8)return;try{let _0x274cdf=await database_1[_0x376e0f(0x155)][_0x376e0f(0x170)][_0x376e0f(0x17d)]({'where':{'telegramId':_0x24dcf8},'include':{'shop':!![]}});!_0x274cdf?(_0x274cdf=await database_1[_0x376e0f(0x155)][_0x376e0f(0x170)][_0x376e0f(0x107)]({'data':{'telegramId':_0x24dcf8,'username':_0x265d20,'firstName':_0x8c94d2,'lastName':_0x28d4cf,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x376e0f(0x19a)+_0x24dcf8+_0x376e0f(0x18c)+_0x265d20+')')):_0x274cdf=await database_1[_0x376e0f(0x155)][_0x376e0f(0x170)][_0x376e0f(0x145)]({'where':{'telegramId':_0x24dcf8},'data':{'username':_0x265d20,'firstName':_0x8c94d2,'lastName':_0x28d4cf},'include':{'shop':!![]}}),_0x274cdf[_0x376e0f(0x122)]&&_0x274cdf[_0x376e0f(0x173)]&&_0x274cdf[_0x376e0f(0x175)]?await this['bot']?.[_0x376e0f(0x1ca)](_0x4cac95,_0x376e0f(0x15c)+(_0x376e0f(0x1d0)+_0x274cdf[_0x376e0f(0x175)][_0x376e0f(0x1b7)]+'*\x0a')+(_0x376e0f(0x156)+_0x274cdf['shop'][_0x376e0f(0x17e)]+_0x376e0f(0x128))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x376e0f(0x117)+_0x376e0f(0x1de)+_0x376e0f(0x150)+_0x376e0f(0x15e)+_0x376e0f(0x119)+_0x376e0f(0x164),{'parse_mode':_0x376e0f(0x15d)}):(_0x274cdf[_0x376e0f(0x173)]&&!_0x274cdf['isVerified']&&(await database_1[_0x376e0f(0x155)][_0x376e0f(0x170)][_0x376e0f(0x145)]({'where':{'telegramId':_0x24dcf8},'data':{'shopId':null,'isVerified':![]}}),console[_0x376e0f(0x11b)](_0x376e0f(0x17c)+_0x24dcf8)),await this['bot']?.[_0x376e0f(0x1ca)](_0x4cac95,_0x376e0f(0x163)+_0x376e0f(0x167)+_0x376e0f(0x16d)+_0x376e0f(0x1e1)+_0x376e0f(0x126)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x376e0f(0x15d)}));}catch(_0x328a20){console['error']('Error\x20handling\x20/start\x20command:',_0x328a20),await this[_0x376e0f(0x137)]?.[_0x376e0f(0x1ca)](_0x4cac95,_0x376e0f(0x1d9));}}),this[_0x29a75f(0x137)][_0x29a75f(0x1c9)](/\/disconnect/,async _0x2a0a5f=>{const _0x525ade=_0x29a75f,_0x94036c=_0x2a0a5f[_0x525ade(0x1ee)]['id'],_0x26d388=_0x2a0a5f[_0x525ade(0x191)]?.['id'][_0x525ade(0x125)]();if(!_0x26d388)return;try{const _0x54683f=await database_1['default']['telegramUser'][_0x525ade(0x17d)]({'where':{'telegramId':_0x26d388},'include':{'shop':!![]}});if(!_0x54683f||!_0x54683f[_0x525ade(0x122)]||!_0x54683f[_0x525ade(0x173)]){await this[_0x525ade(0x137)]?.[_0x525ade(0x1ca)](_0x94036c,_0x525ade(0x18f));return;}const _0x4b42ff=_0x54683f[_0x525ade(0x175)]?.['name']||'unknown\x20shop';await database_1[_0x525ade(0x155)]['telegramUser'][_0x525ade(0x145)]({'where':{'telegramId':_0x26d388},'data':{'shopId':null,'isVerified':![]}}),console[_0x525ade(0x11b)](_0x525ade(0x196)+_0x26d388+'\x20disconnected\x20from\x20shop\x20'+_0x54683f[_0x525ade(0x173)]),await this[_0x525ade(0x137)]?.[_0x525ade(0x1ca)](_0x94036c,_0x525ade(0x116)+_0x4b42ff+_0x525ade(0x1ae)+_0x525ade(0x1c7),{'parse_mode':_0x525ade(0x15d)});}catch(_0x103088){console['error'](_0x525ade(0x183),_0x103088),await this['bot']?.['sendMessage'](_0x94036c,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x29a75f(0x137)][_0x29a75f(0x1c9)](/\/status/,async _0x1f4250=>{const _0x494b23=_0x29a75f,_0x5db408=_0x1f4250[_0x494b23(0x1ee)]['id'],_0x57c298=_0x1f4250['from']?.['id'][_0x494b23(0x125)]();if(!_0x57c298)return;try{const _0x43e1cb=await database_1[_0x494b23(0x155)][_0x494b23(0x170)][_0x494b23(0x17d)]({'where':{'telegramId':_0x57c298},'include':{'shop':!![]}});if(!_0x43e1cb){await this[_0x494b23(0x137)]?.[_0x494b23(0x1ca)](_0x5db408,_0x494b23(0x1b2)+_0x494b23(0x172));return;}if(!_0x43e1cb[_0x494b23(0x122)]||!_0x43e1cb[_0x494b23(0x173)]||!_0x43e1cb['shop']){await this[_0x494b23(0x137)]?.[_0x494b23(0x1ca)](_0x5db408,_0x494b23(0x142)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x494b23(0x137)]?.[_0x494b23(0x1ca)](_0x5db408,_0x494b23(0x10f)+(_0x494b23(0x1ab)+_0x43e1cb[_0x494b23(0x175)][_0x494b23(0x1b7)]+'*\x0a')+(_0x494b23(0x158)+_0x43e1cb[_0x494b23(0x175)][_0x494b23(0x17e)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x43e1cb['updatedAt'][_0x494b23(0x111)]('en-US')+'\x0a\x0a')+_0x494b23(0x1cd)+_0x494b23(0x15e)+_0x494b23(0x164),{'parse_mode':_0x494b23(0x15d)});}catch(_0x504434){console[_0x494b23(0x1a9)](_0x494b23(0x194),_0x504434),await this[_0x494b23(0x137)]?.[_0x494b23(0x1ca)](_0x5db408,_0x494b23(0x1d9));}}),this['bot'][_0x29a75f(0x1c9)](/\/debug/,async _0x45bb13=>{const _0x2494b8=_0x29a75f,_0x1a167a=_0x45bb13[_0x2494b8(0x1ee)]['id'],_0xd84877=_0x45bb13[_0x2494b8(0x191)]?.['id'][_0x2494b8(0x125)]();if(!_0xd84877)return;try{const _0x1f22dc=await database_1[_0x2494b8(0x155)][_0x2494b8(0x175)][_0x2494b8(0x1a0)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x24fcba=_0x2494b8(0x19c);_0x24fcba+=_0x2494b8(0x1a5)+_0xd84877+_0x2494b8(0x128),_0x24fcba+=_0x2494b8(0x14a),_0x1f22dc[_0x2494b8(0x1b6)]((_0x58419d,_0x1447df)=>{const _0x58bf84=_0x2494b8;_0x24fcba+=_0x1447df+0x1+_0x58bf84(0x114)+_0x58419d[_0x58bf84(0x1b7)]+'*\x0a',_0x24fcba+=_0x58bf84(0x1db)+_0x58419d[_0x58bf84(0x17e)]+'`\x0a',_0x24fcba+=_0x58bf84(0x13b)+_0x58419d[_0x58bf84(0x1e6)]+'\x0a',_0x24fcba+=_0x58bf84(0x120)+_0x58419d['publicKey'][_0x58bf84(0x1cf)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x2494b8(0x137)]?.['sendMessage'](_0x1a167a,_0x24fcba,{'parse_mode':'Markdown'});}catch(_0x2dfa14){console[_0x2494b8(0x1a9)](_0x2494b8(0x1bd),_0x2dfa14),await this[_0x2494b8(0x137)]?.[_0x2494b8(0x1ca)](_0x1a167a,_0x2494b8(0x1a6));}}),this[_0x29a75f(0x137)]['on']('message',async _0x3d096a=>{const _0x184dcd=_0x29a75f;if(_0x3d096a[_0x184dcd(0x1d7)]?.[_0x184dcd(0x1f1)]('/'))return;const _0x1d9460=_0x3d096a[_0x184dcd(0x1ee)]['id'],_0x106858=_0x3d096a['from']?.['id']['toString'](),_0x5edf6c=_0x3d096a['text']?.[_0x184dcd(0x14d)]();if(!_0x106858||!_0x5edf6c)return;try{const _0x497139=await database_1[_0x184dcd(0x155)][_0x184dcd(0x170)][_0x184dcd(0x17d)]({'where':{'telegramId':_0x106858},'include':{'shop':!![]}});if(!_0x497139){await this[_0x184dcd(0x137)]?.['sendMessage'](_0x1d9460,_0x184dcd(0x12e));return;}if(_0x497139['isVerified']&&_0x497139[_0x184dcd(0x173)]&&_0x497139['shop']){await this[_0x184dcd(0x137)]?.[_0x184dcd(0x1ca)](_0x1d9460,_0x184dcd(0x168)+_0x497139['shop'][_0x184dcd(0x1b7)]+_0x184dcd(0x1ae)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':'Markdown'});return;}const _0x19f13f=_0x5edf6c[_0x184dcd(0x10b)](/\s+/);if(_0x19f13f[_0x184dcd(0x1d6)]!==0x2){await this[_0x184dcd(0x137)]?.[_0x184dcd(0x1ca)](_0x1d9460,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x184dcd(0x16d)+'Example:\x0a'+_0x184dcd(0x126)+(_0x184dcd(0x12b)+_0x19f13f[_0x184dcd(0x1d6)]+_0x184dcd(0x18a)+_0x19f13f[_0x184dcd(0x134)](_0x286fde=>'`'+_0x286fde+'`')['join'](',\x20')),{'parse_mode':_0x184dcd(0x15d)});return;}const [_0x396b21,_0x60bcde]=_0x19f13f;console[_0x184dcd(0x11b)](_0x184dcd(0x181)+_0x106858+':\x20username=\x22'+_0x396b21+_0x184dcd(0x1b5)+_0x60bcde[_0x184dcd(0x1cf)](0x0,0xa)+_0x184dcd(0x112)),await this['handleSingleLineVerification'](_0x1d9460,_0x106858,_0x396b21,_0x60bcde);}catch(_0x4d8de4){console[_0x184dcd(0x1a9)](_0x184dcd(0x16b),_0x4d8de4),await this[_0x184dcd(0x137)]?.[_0x184dcd(0x1ca)](_0x1d9460,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['on'](_0x29a75f(0x1a9),_0x3875d2=>{const _0x29560a=_0x29a75f;console[_0x29560a(0x1a9)](_0x29560a(0x1ba),_0x3875d2);}),this[_0x29a75f(0x137)]['on'](_0x29a75f(0x109),_0x15f871=>{const _0x1e2acf=_0x29a75f;console[_0x1e2acf(0x1a9)]('Telegram\x20bot\x20polling\x20error:',_0x15f871);});}async[a54_0x283071(0x1d1)](_0x4c8bde,_0x4f3bdd,_0x1e362d,_0x1f1d71){const _0x24ee33=a54_0x283071;try{console[_0x24ee33(0x11b)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x4f3bdd+_0x24ee33(0x1d3)+_0x1e362d+_0x24ee33(0x1b5)+_0x1f1d71['substring'](0x0,0xa)+'...\x22');if(!_0x1e362d||_0x1e362d['length']<0x3||_0x1e362d[_0x24ee33(0x1d6)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x24ee33(0x157)](_0x1e362d)){await this[_0x24ee33(0x137)]?.[_0x24ee33(0x1ca)](_0x4c8bde,'❌\x20Invalid\x20username\x20format:\x20`'+_0x1e362d+_0x24ee33(0x128)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':'Markdown'});return;}if(!_0x1f1d71||!_0x1f1d71[_0x24ee33(0x1f1)](_0x24ee33(0x149))&&!_0x1f1d71['startsWith'](_0x24ee33(0x171))){await this['bot']?.[_0x24ee33(0x1ca)](_0x4c8bde,_0x24ee33(0x1dc)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x24ee33(0x15d)});return;}const _0x1a2731=await database_1[_0x24ee33(0x155)][_0x24ee33(0x175)]['findUnique']({'where':{'username':_0x1e362d},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x1a2731){const _0x439281=await database_1['default'][_0x24ee33(0x175)][_0x24ee33(0x1a0)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x207a6d=_0x24ee33(0x121)+_0x1e362d+_0x24ee33(0x1c5);_0x439281['length']>0x0?(_0x207a6d+=_0x24ee33(0x110),_0x439281[_0x24ee33(0x1b6)](_0x357cec=>{const _0x36d960=_0x24ee33;_0x207a6d+='•\x20`'+_0x357cec['username']+'`\x20('+_0x357cec[_0x36d960(0x1b7)]+')\x0a';}),_0x207a6d+=_0x24ee33(0x17f)):_0x207a6d+=_0x24ee33(0x15f);await this['bot']?.[_0x24ee33(0x1ca)](_0x4c8bde,_0x207a6d,{'parse_mode':_0x24ee33(0x15d)});return;}if(_0x1a2731[_0x24ee33(0x1e6)]!==_0x24ee33(0x195)){await this['bot']?.['sendMessage'](_0x4c8bde,_0x24ee33(0x193)+_0x1e362d+_0x24ee33(0x1cc)+_0x24ee33(0x169),{'parse_mode':_0x24ee33(0x15d)});return;}if(_0x1a2731[_0x24ee33(0x1a8)]!==_0x1f1d71&&_0x1a2731[_0x24ee33(0x1ce)]!==_0x1f1d71){await this['bot']?.['sendMessage'](_0x4c8bde,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x1e362d+_0x24ee33(0x1d5)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x24ee33(0x147),{'parse_mode':_0x24ee33(0x15d)});return;}const _0x3078d9=await database_1['default'][_0x24ee33(0x170)][_0x24ee33(0x180)]({'where':{'shopId':_0x1a2731['id'],'isVerified':!![],'telegramId':{'not':_0x4f3bdd}}});if(_0x3078d9){await this[_0x24ee33(0x137)]?.['sendMessage'](_0x4c8bde,_0x24ee33(0x1cb)+_0x1e362d+_0x24ee33(0x1d5)+_0x24ee33(0x1c8),{'parse_mode':'Markdown'});return;}await database_1[_0x24ee33(0x155)][_0x24ee33(0x170)][_0x24ee33(0x145)]({'where':{'telegramId':_0x4f3bdd},'data':{'shopId':_0x1a2731['id'],'isVerified':!![]}}),await this[_0x24ee33(0x137)]?.[_0x24ee33(0x1ca)](_0x4c8bde,_0x24ee33(0x136)+_0x24ee33(0x190)+(_0x24ee33(0x15a)+_0x1a2731[_0x24ee33(0x1b7)]+'*\x0a')+(_0x24ee33(0x158)+_0x1a2731[_0x24ee33(0x17e)]+_0x24ee33(0x128))+_0x24ee33(0x160)+'•\x20New\x20payments\x0a'+_0x24ee33(0x1de)+_0x24ee33(0x1b0)+_0x24ee33(0x151)+_0x24ee33(0x15e)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x24ee33(0x164),{'parse_mode':'Markdown'}),console[_0x24ee33(0x11b)](_0x24ee33(0x10c)+_0x4f3bdd+_0x24ee33(0x1ed)+_0x1a2731[_0x24ee33(0x17e)]+_0x24ee33(0x11a));}catch(_0x5073e6){console[_0x24ee33(0x1a9)](_0x24ee33(0x1c3),_0x5073e6),await this['bot']?.[_0x24ee33(0x1ca)](_0x4c8bde,_0x24ee33(0x1d4));}}async['sendShopNotification'](_0xb03975,_0x5c8a87,_0x34d29a){const _0x11638e=a54_0x283071;if(!this[_0x11638e(0x137)]){console['warn'](_0x11638e(0x17b));return;}try{const _0x1b3a56=await database_1[_0x11638e(0x155)][_0x11638e(0x170)]['findMany']({'where':{'shopId':_0xb03975,'isVerified':!![]}});if(_0x1b3a56[_0x11638e(0x1d6)]===0x0){console[_0x11638e(0x11b)](_0x11638e(0x177)+_0xb03975);return;}const _0x1e8dd1=_0x1b3a56[_0x11638e(0x134)](async _0xf16773=>{const _0x2bba09=_0x11638e;try{await this[_0x2bba09(0x137)]?.[_0x2bba09(0x1ca)](_0xf16773[_0x2bba09(0x13e)],_0x5c8a87,_0x34d29a),console['log'](_0x2bba09(0x19d)+_0xf16773['telegramId']);}catch(_0xa9324a){console['error']('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0xf16773[_0x2bba09(0x13e)]+':',_0xa9324a),_0xa9324a instanceof Error&&(_0xa9324a[_0x2bba09(0x19f)][_0x2bba09(0x161)]('blocked')||_0xa9324a['message'][_0x2bba09(0x161)](_0x2bba09(0x1bc))||_0xa9324a[_0x2bba09(0x19f)][_0x2bba09(0x161)](_0x2bba09(0x1c1)))&&(await database_1[_0x2bba09(0x155)][_0x2bba09(0x170)][_0x2bba09(0x145)]({'where':{'id':_0xf16773['id']},'data':{'isVerified':![]}}),console[_0x2bba09(0x11b)](_0x2bba09(0x19b)+_0xf16773[_0x2bba09(0x13e)]+_0x2bba09(0x1b3)));}});await Promise['allSettled'](_0x1e8dd1);}catch(_0x432e38){console['error'](_0x11638e(0x148),_0x432e38);}}async[a54_0x283071(0x1c0)](_0x3f3d7a,_0x4182f2,_0x26770e){const _0x6c9e83=a54_0x283071,_0x520bb3={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x436baf={'created':'New\x20payment\x20created','paid':'Payment\x20successfully\x20paid','failed':'Payment\x20failed','expired':_0x6c9e83(0x1dd),'refund':_0x6c9e83(0x179),'chargeback':'Payment\x20chargeback','processing':_0x6c9e83(0x123)},_0x31e187=_0x520bb3[_0x26770e],_0x3da784=_0x436baf[_0x26770e],_0xdc90e=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x4182f2[_0x6c9e83(0x12a)]);console[_0x6c9e83(0x11b)](_0x6c9e83(0x153)+_0x4182f2[_0x6c9e83(0x12a)]+_0x6c9e83(0x1af)+_0xdc90e+'\x22');let _0x26f676=_0x31e187+'\x20*'+_0x3da784+_0x6c9e83(0x14e)+(_0x6c9e83(0x1e4)+_0x4182f2[_0x6c9e83(0x1ea)]+'\x20'+_0x4182f2['currency']+'*\x0a')+(_0x6c9e83(0x127)+(_0x4182f2[_0x6c9e83(0x1bf)]||_0x4182f2['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x4182f2['id']+'`\x0a')+(_0x6c9e83(0x11e)+_0xdc90e+'`\x0a')+(_0x6c9e83(0x1a2)+new Date(_0x4182f2[_0x6c9e83(0x16a)])[_0x6c9e83(0x154)](_0x6c9e83(0x131))+'\x0a');if(_0x4182f2[_0x6c9e83(0x19e)]||_0x4182f2['customerEmail']||_0x4182f2[_0x6c9e83(0x11d)]||_0x4182f2[_0x6c9e83(0x1a1)]||_0x4182f2[_0x6c9e83(0x186)]){_0x26f676+=_0x6c9e83(0x1df);_0x4182f2['customerName']&&(_0x26f676+=_0x6c9e83(0x162)+_0x4182f2[_0x6c9e83(0x19e)]+'`\x0a');_0x4182f2[_0x6c9e83(0x118)]&&(_0x26f676+='📧\x20Email:\x20`'+_0x4182f2[_0x6c9e83(0x118)]+'`\x0a');_0x4182f2[_0x6c9e83(0x11d)]&&(_0x26f676+='🏦\x20IBAN:\x20`'+_0x4182f2[_0x6c9e83(0x11d)]+'`\x0a');_0x4182f2[_0x6c9e83(0x1a1)]&&(_0x26f676+=_0x6c9e83(0x132)+_0x4182f2[_0x6c9e83(0x1a1)]+'`\x0a');if(_0x4182f2[_0x6c9e83(0x186)]){const _0x3b4001=_0x4182f2[_0x6c9e83(0x186)][_0x6c9e83(0x1d6)]>0x32?_0x4182f2[_0x6c9e83(0x186)]['substring'](0x0,0x32)+_0x6c9e83(0x13c):_0x4182f2['customerUa'];_0x26f676+=_0x6c9e83(0x16e)+_0x3b4001+'`\x0a';}}_0x26770e==='chargeback'&&_0x4182f2[_0x6c9e83(0x166)]&&(_0x26f676+=_0x6c9e83(0x108)+_0x4182f2[_0x6c9e83(0x166)]+_0x6c9e83(0x1b1)),_0x26770e==='processing'&&(_0x26f676+=_0x6c9e83(0x12c)),_0x4182f2['adminNotes']&&(_0x26f676+=_0x6c9e83(0x1b8)+_0x4182f2[_0x6c9e83(0x188)]+'\x0a'),await this[_0x6c9e83(0x139)](_0x3f3d7a,_0x26f676,{'parse_mode':_0x6c9e83(0x15d)});}async[a54_0x283071(0x18b)](_0x23192b,_0x24627e,_0x5b67b7){const _0x20bcb7=a54_0x283071,_0x53991e={'created':'📤','completed':'✅','rejected':'❌'},_0xd7e90d={'created':_0x20bcb7(0x129),'completed':'Payout\x20completed','rejected':_0x20bcb7(0x1ec)},_0x559e94=_0x53991e[_0x5b67b7],_0x1ce186=_0xd7e90d[_0x5b67b7],_0x4c1dcc=_0x559e94+'\x20*'+_0x1ce186+'*\x0a\x0a'+(_0x20bcb7(0x124)+_0x24627e[_0x20bcb7(0x1ea)]+_0x20bcb7(0x146))+('🏦\x20Method:\x20`'+_0x24627e['method']+'`\x0a')+(_0x20bcb7(0x1ad)+_0x24627e['id']+'`\x0a')+(_0x20bcb7(0x1a2)+new Date(_0x24627e['createdAt'])[_0x20bcb7(0x154)](_0x20bcb7(0x131))+'\x0a')+(_0x24627e[_0x20bcb7(0x1b9)]?_0x20bcb7(0x14b)+_0x24627e['txid']+'`':'');await this[_0x20bcb7(0x139)](_0x23192b,_0x4c1dcc,{'parse_mode':_0x20bcb7(0x15d)});}async[a54_0x283071(0x10e)](_0x55bcee,_0x1e4810){const _0x6c0f88=a54_0x283071;try{const _0x5708ec=await database_1['default'][_0x6c0f88(0x152)]['findUnique']({'where':{'shopId':_0x55bcee},'select':{'notificationLogin':!![]}});if(!_0x5708ec?.[_0x6c0f88(0x1d8)]){console[_0x6c0f88(0x11b)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x55bcee);return;}const _0x482a52=_0x1e4810[_0x6c0f88(0x182)]?'🔐':'🚨',_0x4d25bc=_0x1e4810['success']?_0x6c0f88(0x1e8):_0x6c0f88(0x189);let _0x1ffb04=_0x482a52+'\x20*'+_0x4d25bc+_0x6c0f88(0x14e)+(_0x6c0f88(0x158)+_0x1e4810['username']+'`\x0a')+(_0x6c0f88(0x12d)+_0x1e4810[_0x6c0f88(0x1a4)][_0x6c0f88(0x154)](_0x6c0f88(0x131))+'\x0a');_0x1e4810[_0x6c0f88(0x133)]&&(_0x1ffb04+=_0x6c0f88(0x141)+_0x1e4810['ipAddress']+'`\x0a');if(_0x1e4810['userAgent']){const _0x258da2=_0x1e4810[_0x6c0f88(0x10a)][_0x6c0f88(0x1d6)]>0x32?_0x1e4810[_0x6c0f88(0x10a)]['substring'](0x0,0x32)+_0x6c0f88(0x13c):_0x1e4810[_0x6c0f88(0x10a)];_0x1ffb04+=_0x6c0f88(0x16e)+_0x258da2+'`\x0a';}!_0x1e4810[_0x6c0f88(0x182)]&&(_0x1ffb04+=_0x6c0f88(0x1d2)),await this[_0x6c0f88(0x139)](_0x55bcee,_0x1ffb04,{'parse_mode':_0x6c0f88(0x15d)}),console[_0x6c0f88(0x11b)](_0x6c0f88(0x18e)+_0x55bcee+':\x20'+(_0x1e4810['success']?_0x6c0f88(0x182):_0x6c0f88(0x174)));}catch(_0x2e6ef1){console[_0x6c0f88(0x1a9)](_0x6c0f88(0x197),_0x2e6ef1);}}async[a54_0x283071(0x1da)](_0x4171d4,_0x44cf7a){const _0x3dfad5=a54_0x283071;try{const _0x25eb7c=await database_1[_0x3dfad5(0x155)][_0x3dfad5(0x152)]['findUnique']({'where':{'shopId':_0x4171d4},'select':{'notificationApiError':!![]}});if(!_0x25eb7c?.['notificationApiError']){console[_0x3dfad5(0x11b)](_0x3dfad5(0x144)+_0x4171d4);return;}let _0x38df83=_0x3dfad5(0x1b4)+('🔗\x20Endpoint:\x20`'+_0x44cf7a['method']+'\x20'+_0x44cf7a[_0x3dfad5(0x130)]+'`\x0a')+('📅\x20Time:\x20'+_0x44cf7a[_0x3dfad5(0x1a4)][_0x3dfad5(0x154)](_0x3dfad5(0x131))+'\x0a');_0x44cf7a['statusCode']&&(_0x38df83+=_0x3dfad5(0x17a)+_0x44cf7a[_0x3dfad5(0x1f0)]+'`\x0a'),_0x38df83+='❌\x20Error:\x20`'+_0x44cf7a[_0x3dfad5(0x165)]+'`\x0a',_0x44cf7a[_0x3dfad5(0x115)]&&(_0x38df83+=_0x3dfad5(0x138)+_0x44cf7a['requestId']+'`\x0a'),_0x38df83+=_0x3dfad5(0x14c),await this[_0x3dfad5(0x139)](_0x4171d4,_0x38df83,{'parse_mode':_0x3dfad5(0x15d)}),console[_0x3dfad5(0x11b)](_0x3dfad5(0x1c2)+_0x4171d4+':\x20'+_0x44cf7a[_0x3dfad5(0x130)]);}catch(_0x2c16cc){console['error'](_0x3dfad5(0x15b),_0x2c16cc);}}async[a54_0x283071(0x1e7)](_0x48abc5,_0x1abeb1,_0x59451d){const _0x5cd387=a54_0x283071;let _0x1ca1aa=_0x5cd387(0x1be)+_0x1abeb1+_0x5cd387(0x14e);for(const [_0x5365f9,_0x5e4188]of Object[_0x5cd387(0x1a3)](_0x59451d)){_0x5e4188!==null&&_0x5e4188!==undefined&&(_0x1ca1aa+=_0x5365f9+_0x5cd387(0x10d)+_0x5e4188+'`\x0a');}await this[_0x5cd387(0x139)](_0x48abc5,_0x1ca1aa,{'parse_mode':_0x5cd387(0x15d)});}[a54_0x283071(0x1ac)](){const _0x5172c0=a54_0x283071;return{'isActive':!!this[_0x5172c0(0x137)],'username':this[_0x5172c0(0x1c6)]};}[a54_0x283071(0x199)](){const _0xc77efd=a54_0x283071;this[_0xc77efd(0x137)]&&(this['bot'][_0xc77efd(0x198)](),this['bot']=null,console['log'](_0xc77efd(0x184)));}}exports[a54_0x283071(0x159)]=TelegramBotService,exports[a54_0x283071(0x113)]=new TelegramBotService();function a54_0xc585(){const _0x5f5a7f=['❌\x20Shop\x20with\x20username\x20`','isVerified','Payment\x20is\x20being\x20processed','💸\x20Amount:\x20*','toString','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','📝\x20Order\x20ID:\x20`','`\x0a\x0a','New\x20payout\x20created','gateway','You\x20sent\x20','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','📅\x20Time:\x20','❌\x20Please\x20use\x20/start\x20command\x20first','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','endpoint','en-US','🌐\x20IP:\x20`','ipAddress','map','90PgdbmQ','🎉\x20*Congratulations!*\x0a\x0a','bot','🆔\x20Request\x20ID:\x20`','sendShopNotification','1606693cYPGGa','\x20\x20\x20Status:\x20','...','../config/database','telegramId','../types/gateway','1182275qcdoio','🌐\x20IP\x20address:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','warn','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','update','\x20USD*\x0a','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','Error\x20sending\x20shop\x20notification:','pk_','🏪\x20Available\x20shops\x20in\x20system:\x0a','🔗\x20TXID:\x20`','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','trim','*\x0a\x0a','node-telegram-bot-api','•\x20Payouts\x0a\x0a','•\x20Important\x20events\x0a\x0a','shopSettings','📱\x20Telegram\x20notification:\x20gateway\x20\x22','toLocaleString','default','Username:\x20`','test','👤\x20Username:\x20`','TelegramBotService','📱\x20Shop:\x20*','Failed\x20to\x20send\x20API\x20error\x20notification:','✅\x20Welcome\x20back!\x0a\x0a','Markdown','Commands:\x0a','Check\x20spelling\x20and\x20try\x20again.','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','includes','📛\x20Name:\x20`','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','/disconnect\x20-\x20disconnect\x20from\x20notifications','errorMessage','chargebackAmount','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Contact\x20administrator.','createdAt','Error\x20handling\x20message:','setupBotHandlers','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','💻\x20Browser:\x20`','trapay_bot','telegramUser','sk_','Use\x20/start\x20to\x20begin.','shopId','failed','shop','botToken','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','\x20initialized\x20successfully','Payment\x20refund','📊\x20Error\x20code:\x20`','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','findUnique','username','\x0aCheck\x20spelling\x20and\x20try\x20again.','findFirst','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','success','Error\x20handling\x20/disconnect\x20command:','🛑\x20Telegram\x20bot\x20stopped','first_name','customerUa','✅\x20Telegram\x20bot\x20@','adminNotes','Failed\x20login\x20attempt','\x20parts:\x20','sendPayoutNotification','\x20(@','1153716bKdcAD','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','from','env','❌\x20Shop\x20`','Error\x20handling\x20/status\x20command:','ACTIVE','🔌\x20User\x20','Failed\x20to\x20send\x20login\x20notification:','stopPolling','stopBot','📱\x20Created\x20new\x20Telegram\x20user:\x20','User\x20','🔍\x20*Debug\x20Information*\x0a\x0a','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','customerName','message','findMany','customerIp','📅\x20Date:\x20','entries','timestamp','📱\x20Your\x20Telegram\x20ID:\x20`','❌\x20Error\x20getting\x20debug\x20information.','60mxmMtr','publicKey','error','initializeBot','✅\x20Connected\x20to\x20shop:\x20*','getBotInfo','🆔\x20Payout\x20ID:\x20`','*.\x0a\x0a','\x22\x20->\x20display\x20\x22','•\x20Payouts\x0a','\x20USDT*\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','🚨\x20*API\x20Error*\x0a\x0a','\x22,\x20apiKey=\x22','forEach','name','📝\x20Notes:\x20','txid','Telegram\x20bot\x20error:','40RQhxDK','chat\x20not\x20found','Error\x20handling\x20/debug\x20command:','🔔\x20*','orderId','sendPaymentNotification','user\x20is\x20deactivated','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','Error\x20in\x20handleSingleLineVerification:','13991JtvFLr','`\x20not\x20found.\x0a\x0a','botUsername','To\x20reconnect,\x20use\x20the\x20/start\x20command','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','onText','sendMessage','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','`\x20is\x20inactive.\x0a\x0a','🔔\x20Notifications\x20are\x20active\x0a\x0a','secretKey','substring','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','handleSingleLineVerification','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!',':\x20username=\x22','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','`.\x0a\x0a','length','text','notificationLogin','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','sendApiErrorNotification','\x20\x20\x20Username:\x20`','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','Payment\x20expired','•\x20Payment\x20status\x20changes\x0a','\x0a👤\x20*Customer\x20Information:*\x0a','10JXTcBT','Example:\x0a','1270HJhTye','17676ElfWEC','💰\x20Amount:\x20*','defineProperty','status','sendCustomNotification','Successful\x20login','34011xYVogE','amount','__esModule','Payout\x20rejected','\x20verified\x20for\x20shop\x20','chat','1610onArHi','statusCode','startsWith','create','💸\x20Penalty\x20amount:\x20*','polling_error','userAgent','split','✅\x20Telegram\x20user\x20',':\x20`','sendLoginNotification','📊\x20*Connection\x20Status*\x0a\x0a','Available\x20usernames:\x0a','toLocaleDateString','...\x22','telegramBotService','.\x20*','requestId','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','•\x20New\x20payments\x0a','customerEmail','/status\x20-\x20check\x20connection\x20status\x0a','\x20via\x20single-line\x20input','log','__importDefault','remitterIban','🏪\x20Gateway:\x20`','last_name','\x20\x20\x20Public\x20Key:\x20`'];a54_0xc585=function(){return _0x5f5a7f;};return a54_0xc585();}