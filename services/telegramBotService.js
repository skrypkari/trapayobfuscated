'use strict';const a57_0x55babd=a57_0x1a63;function a57_0x2b21(){const _0x4a6c2d=['statusCode','create','143NnZaDc','amount','gateway','telegramUser','from','652633sjxIwK','stopBot','•\x20Payouts\x0a\x0a','failed','telegramId','sendApiErrorNotification','createdAt','•\x20`','...`\x0a\x0a','/disconnect\x20-\x20disconnect\x20from\x20notifications','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','🆔\x20Payment\x20ID:\x20`','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','❌\x20Please\x20use\x20/start\x20command\x20first','userAgent','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','•\x20Payouts\x0a','endpoint','success','🏦\x20IBAN:\x20`','__esModule','\x20via\x20single-line\x20input','setupBotHandlers','Successful\x20login','📅\x20Time:\x20','last_name','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','✅\x20Telegram\x20bot\x20@','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','👤\x20Username:\x20`','🆔\x20Request\x20ID:\x20`','Payout\x20rejected','orderId','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','*.\x0a\x0a','shopId',':\x20`','requestId','chat\x20not\x20found','toLocaleDateString','split','✅\x20Connected\x20to\x20shop:\x20*','📱\x20Shop:\x20*','•\x20New\x20payments\x0a','en-US','includes','🔔\x20You\x20receive\x20notifications\x20about:\x0a','processing','🔌\x20User\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','isVerified','4390225UJtVtw','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','substring','toLocaleString','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','test','📊\x20*Connection\x20Status*\x0a\x0a','🛑\x20Telegram\x20bot\x20stopped','chargeback','update','pk_','📱\x20Telegram\x20notification:\x20gateway\x20\x22','method','Failed\x20to\x20send\x20API\x20error\x20notification:','trapay_bot','8gPOrKt','Username:\x20`','length','🏪\x20Gateway:\x20`','timestamp','defineProperty','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','454730zPKLGc','Use\x20/start\x20to\x20begin.','botToken','`\x20(','📊\x20Error\x20code:\x20`','💻\x20Browser:\x20`','New\x20payment\x20created','❌\x20Shop\x20`','customerUa','first_name','Error\x20handling\x20/disconnect\x20command:','default','TELEGRAM_BOT_USERNAME','💸\x20Penalty\x20amount:\x20*','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','Use\x20/start\x20to\x20connect.','trim','Error\x20in\x20handleSingleLineVerification:','•\x20Payment\x20status\x20changes\x0a','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','.\x20*','❌\x20Error\x20getting\x20debug\x20information.','📱\x20Your\x20Telegram\x20ID:\x20`','log','...','adminNotes','Example:\x0a','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','🌐\x20IP\x20address:\x20`','\x22\x20->\x20display\x20\x22','❌\x20Shop\x20with\x20username\x20`','remitterIban','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','📅\x20Date:\x20','📛\x20Name:\x20`','3210zyMwFl','text','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','sendPayoutNotification','🎉\x20*Congratulations!*\x0a\x0a','687294kCncMq','chat','Error\x20handling\x20/debug\x20command:','*\x0a\x0a','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Error\x20handling\x20/start\x20command:','\x20\x20\x20Public\x20Key:\x20`','error','telegramBotService','errorMessage','notificationLogin','username','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','customerIp','🚨\x20*API\x20Error*\x0a\x0a','\x20(@','sendMessage','User\x20','Payment\x20refund','message','../types/gateway','TELEGRAM_BOT_TOKEN','customerName','Commands:\x0a','currency','warn','🏪\x20Available\x20shops\x20in\x20system:\x0a','name','🔔\x20Notifications\x20are\x20active\x0a\x0a','chargebackAmount','Payment\x20failed','Check\x20spelling\x20and\x20try\x20again.','ACTIVE','454gbLoOl','\x20\x20\x20Username:\x20`','`\x0a\x0a','notificationApiError','Payment\x20successfully\x20paid','findUnique','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','\x20disconnected\x20from\x20shop\x20','__importDefault','handleSingleLineVerification','updatedAt','polling_error','515444RIkPaV','\x20parts:\x20','💰\x20Amount:\x20*','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','\x20USDT*\x0a','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','...\x22','toString','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','botUsername','42rsVvoD','getBotInfo','`\x20is\x20inactive.\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','10ocDqKV','sendCustomNotification','\x22,\x20apiKey=\x22','💸\x20Amount:\x20*','/status\x20-\x20check\x20connection\x20status\x0a','initializeBot','onText','sendLoginNotification','Available\x20usernames:\x0a','bot','forEach','../config/database','Payment\x20is\x20being\x20processed','Markdown','🔗\x20TXID:\x20`','\x20verified\x20for\x20shop\x20','blocked','Payment\x20chargeback','Error\x20sending\x20shop\x20notification:','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','🌐\x20IP:\x20`','`.\x0a\x0a','findMany','shopSettings','✅\x20Telegram\x20user\x20','map','Payment\x20expired','sendShopNotification','shop','Payout\x20completed','TelegramBotService','publicKey','getGatewayDisplayNameForTelegram','✅\x20Welcome\x20back!\x0a\x0a','987720GuPulv','🔗\x20Endpoint:\x20`','status','\x20initialized\x20successfully','🔔\x20*','join','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','txid','startsWith','entries','Telegram\x20bot\x20error:','New\x20payout\x20created','unknown\x20shop'];a57_0x2b21=function(){return _0x4a6c2d;};return a57_0x2b21();}function a57_0x1a63(_0x2f65c7,_0x301214){const _0x2b2133=a57_0x2b21();return a57_0x1a63=function(_0x1a63f8,_0x592cc3){_0x1a63f8=_0x1a63f8-0x94;let _0x3a1661=_0x2b2133[_0x1a63f8];return _0x3a1661;},a57_0x1a63(_0x2f65c7,_0x301214);}(function(_0xdf82cc,_0x2c1685){const _0x1b8627=a57_0x1a63,_0x59cafd=_0xdf82cc();while(!![]){try{const _0x4955c7=-parseInt(_0x1b8627(0x111))/0x1+-parseInt(_0x1b8627(0xbc))/0x2*(-parseInt(_0x1b8627(0x96))/0x3)+-parseInt(_0x1b8627(0xca))/0x4+parseInt(_0x1b8627(0x15e))/0x5*(-parseInt(_0x1b8627(0xd6))/0x6)+parseInt(_0x1b8627(0x148))/0x7*(parseInt(_0x1b8627(0x157))/0x8)+-parseInt(_0x1b8627(0x9b))/0x9*(parseInt(_0x1b8627(0xdb))/0xa)+parseInt(_0x1b8627(0x10c))/0xb*(parseInt(_0x1b8627(0xfd))/0xc);if(_0x4955c7===_0x2c1685)break;else _0x59cafd['push'](_0x59cafd['shift']());}catch(_0x38b074){_0x59cafd['push'](_0x59cafd['shift']());}}}(a57_0x2b21,0x6ccad));var __importDefault=this&&this[a57_0x55babd(0xc6)]||function(_0x1e312e){const _0x4a0714=a57_0x55babd;return _0x1e312e&&_0x1e312e[_0x4a0714(0x126)]?_0x1e312e:{'default':_0x1e312e};};Object[a57_0x55babd(0x15c)](exports,a57_0x55babd(0x126),{'value':!![]}),exports['telegramBotService']=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a57_0x55babd(0xe6))),gateway_1=require(a57_0x55babd(0xaf));class TelegramBotService{constructor(){const _0xfe6fee=a57_0x55babd;this[_0xfe6fee(0xe4)]=null,this[_0xfe6fee(0x160)]=process['env'][_0xfe6fee(0xb0)]||'',this[_0xfe6fee(0xd5)]=process['env'][_0xfe6fee(0x16a)]||_0xfe6fee(0x156),this[_0xfe6fee(0x160)]?this[_0xfe6fee(0xe0)]():console['warn'](_0xfe6fee(0xda));}['initializeBot'](){const _0x1bec4a=a57_0x55babd;try{this['bot']=new node_telegram_bot_api_1[(_0x1bec4a(0x169))](this[_0x1bec4a(0x160)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x1bec4a(0x175)](_0x1bec4a(0x12d)+this[_0x1bec4a(0xd5)]+_0x1bec4a(0x100));}catch(_0x43e83b){console[_0x1bec4a(0xa2)](_0x1bec4a(0x11d),_0x43e83b);}}[a57_0x55babd(0x128)](){const _0x388304=a57_0x55babd;if(!this[_0x388304(0xe4)])return;this[_0x388304(0xe4)][_0x388304(0xe1)](/\/start/,async _0x3ca8cb=>{const _0x2ab49c=_0x388304,_0x4e0456=_0x3ca8cb['chat']['id'],_0x27b2ed=_0x3ca8cb[_0x2ab49c(0x110)]?.['id'][_0x2ab49c(0xd3)](),_0x367201=_0x3ca8cb[_0x2ab49c(0x110)]?.[_0x2ab49c(0xa6)],_0x4c2579=_0x3ca8cb['from']?.[_0x2ab49c(0x167)],_0x15f270=_0x3ca8cb[_0x2ab49c(0x110)]?.[_0x2ab49c(0x12b)];if(!_0x27b2ed)return;try{let _0x56c902=await database_1[_0x2ab49c(0x169)][_0x2ab49c(0x10f)][_0x2ab49c(0xc1)]({'where':{'telegramId':_0x27b2ed},'include':{'shop':!![]}});!_0x56c902?(_0x56c902=await database_1[_0x2ab49c(0x169)][_0x2ab49c(0x10f)][_0x2ab49c(0x10b)]({'data':{'telegramId':_0x27b2ed,'username':_0x367201,'firstName':_0x4c2579,'lastName':_0x15f270,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log']('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x27b2ed+_0x2ab49c(0xaa)+_0x367201+')')):_0x56c902=await database_1[_0x2ab49c(0x169)][_0x2ab49c(0x10f)][_0x2ab49c(0x151)]({'where':{'telegramId':_0x27b2ed},'data':{'username':_0x367201,'firstName':_0x4c2579,'lastName':_0x15f270},'include':{'shop':!![]}}),_0x56c902[_0x2ab49c(0x147)]&&_0x56c902[_0x2ab49c(0x137)]&&_0x56c902[_0x2ab49c(0xf7)]?await this[_0x2ab49c(0xe4)]?.[_0x2ab49c(0xab)](_0x4e0456,_0x2ab49c(0xfc)+(_0x2ab49c(0x146)+_0x56c902[_0x2ab49c(0xf7)]['name']+'*\x0a')+(_0x2ab49c(0x158)+_0x56c902[_0x2ab49c(0xf7)][_0x2ab49c(0xa6)]+_0x2ab49c(0xbe))+_0x2ab49c(0x142)+_0x2ab49c(0x13f)+_0x2ab49c(0x170)+_0x2ab49c(0x113)+_0x2ab49c(0xb2)+_0x2ab49c(0xdf)+_0x2ab49c(0x11a),{'parse_mode':_0x2ab49c(0xe8)}):(_0x56c902[_0x2ab49c(0x137)]&&!_0x56c902['isVerified']&&(await database_1['default'][_0x2ab49c(0x10f)][_0x2ab49c(0x151)]({'where':{'telegramId':_0x27b2ed},'data':{'shopId':null,'isVerified':![]}}),console[_0x2ab49c(0x175)](_0x2ab49c(0xc4)+_0x27b2ed)),await this[_0x2ab49c(0xe4)]?.['sendMessage'](_0x4e0456,_0x2ab49c(0xcf)+_0x2ab49c(0x179)+_0x2ab49c(0x171)+_0x2ab49c(0x178)+_0x2ab49c(0xd4)+_0x2ab49c(0x12e),{'parse_mode':'Markdown'}));}catch(_0x4d6783){console[_0x2ab49c(0xa2)](_0x2ab49c(0xa0),_0x4d6783),await this[_0x2ab49c(0xe4)]?.[_0x2ab49c(0xab)](_0x4e0456,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x388304(0xe4)][_0x388304(0xe1)](/\/disconnect/,async _0x6c66d9=>{const _0x40c61b=_0x388304,_0x4f024f=_0x6c66d9[_0x40c61b(0x9c)]['id'],_0xc89d51=_0x6c66d9['from']?.['id'][_0x40c61b(0xd3)]();if(!_0xc89d51)return;try{const _0x489f0a=await database_1[_0x40c61b(0x169)][_0x40c61b(0x10f)][_0x40c61b(0xc1)]({'where':{'telegramId':_0xc89d51},'include':{'shop':!![]}});if(!_0x489f0a||!_0x489f0a['isVerified']||!_0x489f0a[_0x40c61b(0x137)]){await this[_0x40c61b(0xe4)]?.[_0x40c61b(0xab)](_0x4f024f,_0x40c61b(0x134));return;}const _0xf6dbe8=_0x489f0a['shop']?.[_0x40c61b(0xb6)]||_0x40c61b(0x109);await database_1['default'][_0x40c61b(0x10f)][_0x40c61b(0x151)]({'where':{'telegramId':_0xc89d51},'data':{'shopId':null,'isVerified':![]}}),console[_0x40c61b(0x175)](_0x40c61b(0x144)+_0xc89d51+_0x40c61b(0xc5)+_0x489f0a[_0x40c61b(0x137)]),await this[_0x40c61b(0xe4)]?.[_0x40c61b(0xab)](_0x4f024f,_0x40c61b(0xd9)+_0xf6dbe8+_0x40c61b(0x136)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x40c61b(0xe8)});}catch(_0x2f47df){console[_0x40c61b(0xa2)](_0x40c61b(0x168),_0x2f47df),await this[_0x40c61b(0xe4)]?.[_0x40c61b(0xab)](_0x4f024f,_0x40c61b(0xc2));}}),this['bot'][_0x388304(0xe1)](/\/status/,async _0x16bb86=>{const _0x1974e5=_0x388304,_0x48caf2=_0x16bb86['chat']['id'],_0x3f64d8=_0x16bb86['from']?.['id'][_0x1974e5(0xd3)]();if(!_0x3f64d8)return;try{const _0x508802=await database_1[_0x1974e5(0x169)][_0x1974e5(0x10f)][_0x1974e5(0xc1)]({'where':{'telegramId':_0x3f64d8},'include':{'shop':!![]}});if(!_0x508802){await this['bot']?.[_0x1974e5(0xab)](_0x48caf2,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x1974e5(0x15f));return;}if(!_0x508802[_0x1974e5(0x147)]||!_0x508802[_0x1974e5(0x137)]||!_0x508802[_0x1974e5(0xf7)]){await this[_0x1974e5(0xe4)]?.[_0x1974e5(0xab)](_0x48caf2,_0x1974e5(0x145)+_0x1974e5(0x16d));return;}await this[_0x1974e5(0xe4)]?.[_0x1974e5(0xab)](_0x48caf2,_0x1974e5(0x14e)+(_0x1974e5(0x13d)+_0x508802[_0x1974e5(0xf7)]['name']+'*\x0a')+(_0x1974e5(0x12f)+_0x508802[_0x1974e5(0xf7)]['username']+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x508802[_0x1974e5(0xc8)][_0x1974e5(0x13b)](_0x1974e5(0x140))+'\x0a\x0a')+_0x1974e5(0xb7)+_0x1974e5(0xb2)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x1974e5(0xe8)});}catch(_0x5bd8b1){console[_0x1974e5(0xa2)]('Error\x20handling\x20/status\x20command:',_0x5bd8b1),await this[_0x1974e5(0xe4)]?.[_0x1974e5(0xab)](_0x48caf2,_0x1974e5(0xc2));}}),this[_0x388304(0xe4)][_0x388304(0xe1)](/\/debug/,async _0x17da0a=>{const _0xbb888c=_0x388304,_0x2adb0c=_0x17da0a[_0xbb888c(0x9c)]['id'],_0x598ac5=_0x17da0a[_0xbb888c(0x110)]?.['id']['toString']();if(!_0x598ac5)return;try{const _0x2b9327=await database_1[_0xbb888c(0x169)][_0xbb888c(0xf7)][_0xbb888c(0xf1)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x5cc2f1='🔍\x20*Debug\x20Information*\x0a\x0a';_0x5cc2f1+=_0xbb888c(0x174)+_0x598ac5+_0xbb888c(0xbe),_0x5cc2f1+=_0xbb888c(0xb5),_0x2b9327[_0xbb888c(0xe5)]((_0x1cb3ec,_0x514657)=>{const _0x31a38a=_0xbb888c;_0x5cc2f1+=_0x514657+0x1+_0x31a38a(0x172)+_0x1cb3ec[_0x31a38a(0xb6)]+'*\x0a',_0x5cc2f1+=_0x31a38a(0xbd)+_0x1cb3ec[_0x31a38a(0xa6)]+'`\x0a',_0x5cc2f1+='\x20\x20\x20Status:\x20'+_0x1cb3ec['status']+'\x0a',_0x5cc2f1+=_0x31a38a(0xa1)+_0x1cb3ec['publicKey'][_0x31a38a(0x14a)](0x0,0xf)+_0x31a38a(0x119);}),await this[_0xbb888c(0xe4)]?.['sendMessage'](_0x2adb0c,_0x5cc2f1,{'parse_mode':_0xbb888c(0xe8)});}catch(_0x51cc1f){console[_0xbb888c(0xa2)](_0xbb888c(0x9d),_0x51cc1f),await this['bot']?.[_0xbb888c(0xab)](_0x2adb0c,_0xbb888c(0x173));}}),this[_0x388304(0xe4)]['on'](_0x388304(0xae),async _0xaea080=>{const _0x5b6d19=_0x388304;if(_0xaea080[_0x5b6d19(0x97)]?.[_0x5b6d19(0x105)]('/'))return;const _0x39bd70=_0xaea080[_0x5b6d19(0x9c)]['id'],_0x375f86=_0xaea080[_0x5b6d19(0x110)]?.['id'][_0x5b6d19(0xd3)](),_0x42f1ed=_0xaea080['text']?.[_0x5b6d19(0x16e)]();if(!_0x375f86||!_0x42f1ed)return;try{const _0x1ca779=await database_1['default'][_0x5b6d19(0x10f)][_0x5b6d19(0xc1)]({'where':{'telegramId':_0x375f86},'include':{'shop':!![]}});if(!_0x1ca779){await this[_0x5b6d19(0xe4)]?.['sendMessage'](_0x39bd70,_0x5b6d19(0x11f));return;}if(_0x1ca779['isVerified']&&_0x1ca779[_0x5b6d19(0x137)]&&_0x1ca779[_0x5b6d19(0xf7)]){await this[_0x5b6d19(0xe4)]?.[_0x5b6d19(0xab)](_0x39bd70,_0x5b6d19(0x135)+_0x1ca779[_0x5b6d19(0xf7)]['name']+_0x5b6d19(0x136)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':'Markdown'});return;}const _0x17eaf3=_0x42f1ed[_0x5b6d19(0x13c)](/\s+/);if(_0x17eaf3[_0x5b6d19(0x159)]!==0x2){await this[_0x5b6d19(0xe4)]?.[_0x5b6d19(0xab)](_0x39bd70,_0x5b6d19(0x9f)+_0x5b6d19(0x171)+_0x5b6d19(0x178)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+('You\x20sent\x20'+_0x17eaf3[_0x5b6d19(0x159)]+_0x5b6d19(0xcb)+_0x17eaf3[_0x5b6d19(0xf4)](_0x1dc120=>'`'+_0x1dc120+'`')[_0x5b6d19(0x102)](',\x20')),{'parse_mode':_0x5b6d19(0xe8)});return;}const [_0x3c5af0,_0x268181]=_0x17eaf3;console['log'](_0x5b6d19(0x12c)+_0x375f86+':\x20username=\x22'+_0x3c5af0+_0x5b6d19(0xdd)+_0x268181[_0x5b6d19(0x14a)](0x0,0xa)+'...\x22'),await this['handleSingleLineVerification'](_0x39bd70,_0x375f86,_0x3c5af0,_0x268181);}catch(_0x2ac9c4){console[_0x5b6d19(0xa2)]('Error\x20handling\x20message:',_0x2ac9c4),await this['bot']?.['sendMessage'](_0x39bd70,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x388304(0xe4)]['on']('error',_0x3b905f=>{const _0x33e189=_0x388304;console['error'](_0x33e189(0x107),_0x3b905f);}),this['bot']['on'](_0x388304(0xc9),_0x2562ae=>{const _0x3e6e6c=_0x388304;console[_0x3e6e6c(0xa2)]('Telegram\x20bot\x20polling\x20error:',_0x2562ae);});}async[a57_0x55babd(0xc7)](_0x52f974,_0x1a65b5,_0x963be8,_0x11b96b){const _0x3b9bbe=a57_0x55babd;try{console[_0x3b9bbe(0x175)](_0x3b9bbe(0x12c)+_0x1a65b5+':\x20username=\x22'+_0x963be8+'\x22,\x20apiKey=\x22'+_0x11b96b[_0x3b9bbe(0x14a)](0x0,0xa)+_0x3b9bbe(0xd2));if(!_0x963be8||_0x963be8[_0x3b9bbe(0x159)]<0x3||_0x963be8[_0x3b9bbe(0x159)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x3b9bbe(0x14d)](_0x963be8)){await this[_0x3b9bbe(0xe4)]?.['sendMessage'](_0x52f974,'❌\x20Invalid\x20username\x20format:\x20`'+_0x963be8+_0x3b9bbe(0xbe)+_0x3b9bbe(0x103),{'parse_mode':_0x3b9bbe(0xe8)});return;}if(!_0x11b96b||!_0x11b96b['startsWith'](_0x3b9bbe(0x152))&&!_0x11b96b[_0x3b9bbe(0x105)]('sk_')){await this[_0x3b9bbe(0xe4)]?.[_0x3b9bbe(0xab)](_0x52f974,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x3b9bbe(0x17e),{'parse_mode':_0x3b9bbe(0xe8)});return;}const _0x4edbb4=await database_1['default'][_0x3b9bbe(0xf7)][_0x3b9bbe(0xc1)]({'where':{'username':_0x963be8},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x4edbb4){const _0x38006c=await database_1['default'][_0x3b9bbe(0xf7)][_0x3b9bbe(0xf1)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x527875=_0x3b9bbe(0x17c)+_0x963be8+'`\x20not\x20found.\x0a\x0a';_0x38006c[_0x3b9bbe(0x159)]>0x0?(_0x527875+=_0x3b9bbe(0xe3),_0x38006c[_0x3b9bbe(0xe5)](_0x305f2d=>{const _0x345291=_0x3b9bbe;_0x527875+=_0x345291(0x118)+_0x305f2d[_0x345291(0xa6)]+_0x345291(0x161)+_0x305f2d[_0x345291(0xb6)]+')\x0a';}),_0x527875+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x527875+=_0x3b9bbe(0xba);await this['bot']?.[_0x3b9bbe(0xab)](_0x52f974,_0x527875,{'parse_mode':_0x3b9bbe(0xe8)});return;}if(_0x4edbb4[_0x3b9bbe(0xff)]!==_0x3b9bbe(0xbb)){await this[_0x3b9bbe(0xe4)]?.['sendMessage'](_0x52f974,_0x3b9bbe(0x165)+_0x963be8+_0x3b9bbe(0xd8)+'Contact\x20administrator.',{'parse_mode':_0x3b9bbe(0xe8)});return;}if(_0x4edbb4[_0x3b9bbe(0xfa)]!==_0x11b96b&&_0x4edbb4['secretKey']!==_0x11b96b){await this[_0x3b9bbe(0xe4)]?.[_0x3b9bbe(0xab)](_0x52f974,_0x3b9bbe(0xc3)+_0x963be8+_0x3b9bbe(0xf0)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x3b9bbe(0x14c),{'parse_mode':_0x3b9bbe(0xe8)});return;}const _0x396722=await database_1[_0x3b9bbe(0x169)]['telegramUser']['findFirst']({'where':{'shopId':_0x4edbb4['id'],'isVerified':!![],'telegramId':{'not':_0x1a65b5}}});if(_0x396722){await this['bot']?.[_0x3b9bbe(0xab)](_0x52f974,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x963be8+_0x3b9bbe(0xf0)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':'Markdown'});return;}await database_1[_0x3b9bbe(0x169)][_0x3b9bbe(0x10f)]['update']({'where':{'telegramId':_0x1a65b5},'data':{'shopId':_0x4edbb4['id'],'isVerified':!![]}}),await this['bot']?.[_0x3b9bbe(0xab)](_0x52f974,_0x3b9bbe(0x9a)+_0x3b9bbe(0x11e)+(_0x3b9bbe(0x13e)+_0x4edbb4[_0x3b9bbe(0xb6)]+'*\x0a')+(_0x3b9bbe(0x12f)+_0x4edbb4[_0x3b9bbe(0xa6)]+_0x3b9bbe(0xbe))+_0x3b9bbe(0x121)+_0x3b9bbe(0x13f)+'•\x20Payment\x20status\x20changes\x0a'+_0x3b9bbe(0x122)+'•\x20Important\x20events\x0a\x0a'+_0x3b9bbe(0xb2)+_0x3b9bbe(0xdf)+_0x3b9bbe(0x11a),{'parse_mode':'Markdown'}),console[_0x3b9bbe(0x175)](_0x3b9bbe(0xf3)+_0x1a65b5+_0x3b9bbe(0xea)+_0x4edbb4[_0x3b9bbe(0xa6)]+_0x3b9bbe(0x127));}catch(_0x2d17e9){console[_0x3b9bbe(0xa2)](_0x3b9bbe(0x16f),_0x2d17e9),await this['bot']?.['sendMessage'](_0x52f974,_0x3b9bbe(0xce));}}async[a57_0x55babd(0xf6)](_0x3a1607,_0x14db5d,_0x8f6561){const _0x356f58=a57_0x55babd;if(!this[_0x356f58(0xe4)]){console[_0x356f58(0xb4)](_0x356f58(0x11b));return;}try{const _0x216347=await database_1[_0x356f58(0x169)][_0x356f58(0x10f)][_0x356f58(0xf1)]({'where':{'shopId':_0x3a1607,'isVerified':!![]}});if(_0x216347['length']===0x0){console[_0x356f58(0x175)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x3a1607);return;}const _0xa2970c=_0x216347['map'](async _0x2cd775=>{const _0x295914=_0x356f58;try{await this[_0x295914(0xe4)]?.['sendMessage'](_0x2cd775[_0x295914(0x115)],_0x14db5d,_0x8f6561),console[_0x295914(0x175)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x2cd775[_0x295914(0x115)]);}catch(_0xfe21d6){console['error'](_0x295914(0xee)+_0x2cd775[_0x295914(0x115)]+':',_0xfe21d6),_0xfe21d6 instanceof Error&&(_0xfe21d6['message'][_0x295914(0x141)](_0x295914(0xeb))||_0xfe21d6['message'][_0x295914(0x141)](_0x295914(0x13a))||_0xfe21d6['message']['includes']('user\x20is\x20deactivated'))&&(await database_1[_0x295914(0x169)][_0x295914(0x10f)][_0x295914(0x151)]({'where':{'id':_0x2cd775['id']},'data':{'isVerified':![]}}),console[_0x295914(0x175)](_0x295914(0xac)+_0x2cd775[_0x295914(0x115)]+_0x295914(0x16c)));}});await Promise['allSettled'](_0xa2970c);}catch(_0x2a6827){console[_0x356f58(0xa2)](_0x356f58(0xed),_0x2a6827);}}async['sendPaymentNotification'](_0x4e247d,_0x372db6,_0x51416a){const _0x3ceb87=a57_0x55babd,_0xeb500d={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x1d2197={'created':_0x3ceb87(0x164),'paid':_0x3ceb87(0xc0),'failed':_0x3ceb87(0xb9),'expired':_0x3ceb87(0xf5),'refund':_0x3ceb87(0xad),'chargeback':_0x3ceb87(0xec),'processing':_0x3ceb87(0xe7)},_0x4eac48=_0xeb500d[_0x51416a],_0x1fce84=_0x1d2197[_0x51416a],_0x38cb22=(0x0,gateway_1[_0x3ceb87(0xfb)])(_0x372db6[_0x3ceb87(0x10e)]);console[_0x3ceb87(0x175)](_0x3ceb87(0x153)+_0x372db6[_0x3ceb87(0x10e)]+_0x3ceb87(0x17b)+_0x38cb22+'\x22');let _0x1667d1=_0x4eac48+'\x20*'+_0x1fce84+_0x3ceb87(0x9e)+(_0x3ceb87(0xcc)+_0x372db6['amount']+'\x20'+_0x372db6[_0x3ceb87(0xb3)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x372db6[_0x3ceb87(0x132)]||_0x372db6['id'])+'`\x0a')+(_0x3ceb87(0x11c)+_0x372db6['id']+'`\x0a')+(_0x3ceb87(0x15a)+_0x38cb22+'`\x0a')+(_0x3ceb87(0x94)+new Date(_0x372db6[_0x3ceb87(0x117)])[_0x3ceb87(0x14b)](_0x3ceb87(0x140))+'\x0a');if(_0x372db6[_0x3ceb87(0xb1)]||_0x372db6['customerEmail']||_0x372db6['remitterIban']||_0x372db6[_0x3ceb87(0xa8)]||_0x372db6[_0x3ceb87(0x166)]){_0x1667d1+='\x0a👤\x20*Customer\x20Information:*\x0a';_0x372db6[_0x3ceb87(0xb1)]&&(_0x1667d1+=_0x3ceb87(0x95)+_0x372db6[_0x3ceb87(0xb1)]+'`\x0a');_0x372db6['customerEmail']&&(_0x1667d1+='📧\x20Email:\x20`'+_0x372db6['customerEmail']+'`\x0a');_0x372db6[_0x3ceb87(0x17d)]&&(_0x1667d1+=_0x3ceb87(0x125)+_0x372db6[_0x3ceb87(0x17d)]+'`\x0a');_0x372db6[_0x3ceb87(0xa8)]&&(_0x1667d1+=_0x3ceb87(0xef)+_0x372db6[_0x3ceb87(0xa8)]+'`\x0a');if(_0x372db6[_0x3ceb87(0x166)]){const _0x32674c=_0x372db6[_0x3ceb87(0x166)][_0x3ceb87(0x159)]>0x32?_0x372db6[_0x3ceb87(0x166)]['substring'](0x0,0x32)+_0x3ceb87(0x176):_0x372db6[_0x3ceb87(0x166)];_0x1667d1+=_0x3ceb87(0x163)+_0x32674c+'`\x0a';}}_0x51416a===_0x3ceb87(0x150)&&_0x372db6[_0x3ceb87(0xb8)]&&(_0x1667d1+=_0x3ceb87(0x16b)+_0x372db6[_0x3ceb87(0xb8)]+_0x3ceb87(0xd0)),_0x51416a===_0x3ceb87(0x143)&&(_0x1667d1+=_0x3ceb87(0x98)),_0x372db6[_0x3ceb87(0x177)]&&(_0x1667d1+='📝\x20Notes:\x20'+_0x372db6[_0x3ceb87(0x177)]+'\x0a'),await this[_0x3ceb87(0xf6)](_0x4e247d,_0x1667d1,{'parse_mode':'Markdown'});}async[a57_0x55babd(0x99)](_0x11fe06,_0x31a744,_0x29339c){const _0x275aad=a57_0x55babd,_0x3f4ce0={'created':'📤','completed':'✅','rejected':'❌'},_0x4c050a={'created':_0x275aad(0x108),'completed':_0x275aad(0xf8),'rejected':_0x275aad(0x131)},_0x30521c=_0x3f4ce0[_0x29339c],_0x176420=_0x4c050a[_0x29339c],_0x5de2b0=_0x30521c+'\x20*'+_0x176420+_0x275aad(0x9e)+(_0x275aad(0xde)+_0x31a744[_0x275aad(0x10d)]+'\x20USD*\x0a')+('🏦\x20Method:\x20`'+_0x31a744[_0x275aad(0x154)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x31a744['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x31a744[_0x275aad(0x117)])[_0x275aad(0x14b)](_0x275aad(0x140))+'\x0a')+(_0x31a744[_0x275aad(0x104)]?_0x275aad(0xe9)+_0x31a744[_0x275aad(0x104)]+'`':'');await this[_0x275aad(0xf6)](_0x11fe06,_0x5de2b0,{'parse_mode':'Markdown'});}async[a57_0x55babd(0xe2)](_0x4ce0ff,_0x5a494a){const _0x366e58=a57_0x55babd;try{const _0x561abb=await database_1[_0x366e58(0x169)]['shopSettings']['findUnique']({'where':{'shopId':_0x4ce0ff},'select':{'notificationLogin':!![]}});if(!_0x561abb?.[_0x366e58(0xa5)]){console[_0x366e58(0x175)](_0x366e58(0xcd)+_0x4ce0ff);return;}const _0x450d89=_0x5a494a[_0x366e58(0x124)]?'🔐':'🚨',_0x1807a1=_0x5a494a['success']?_0x366e58(0x129):'Failed\x20login\x20attempt';let _0x3ec322=_0x450d89+'\x20*'+_0x1807a1+'*\x0a\x0a'+('👤\x20Username:\x20`'+_0x5a494a[_0x366e58(0xa6)]+'`\x0a')+(_0x366e58(0x12a)+_0x5a494a['timestamp']['toLocaleString'](_0x366e58(0x140))+'\x0a');_0x5a494a['ipAddress']&&(_0x3ec322+=_0x366e58(0x17a)+_0x5a494a['ipAddress']+'`\x0a');if(_0x5a494a[_0x366e58(0x120)]){const _0x28cf01=_0x5a494a['userAgent']['length']>0x32?_0x5a494a[_0x366e58(0x120)][_0x366e58(0x14a)](0x0,0x32)+_0x366e58(0x176):_0x5a494a['userAgent'];_0x3ec322+=_0x366e58(0x163)+_0x28cf01+'`\x0a';}!_0x5a494a[_0x366e58(0x124)]&&(_0x3ec322+=_0x366e58(0x149)),await this[_0x366e58(0xf6)](_0x4ce0ff,_0x3ec322,{'parse_mode':_0x366e58(0xe8)}),console[_0x366e58(0x175)](_0x366e58(0x133)+_0x4ce0ff+':\x20'+(_0x5a494a[_0x366e58(0x124)]?'success':_0x366e58(0x114)));}catch(_0x27fbdf){console[_0x366e58(0xa2)]('Failed\x20to\x20send\x20login\x20notification:',_0x27fbdf);}}async[a57_0x55babd(0x116)](_0x57f99b,_0x2fec24){const _0x373960=a57_0x55babd;try{const _0x598232=await database_1[_0x373960(0x169)][_0x373960(0xf2)][_0x373960(0xc1)]({'where':{'shopId':_0x57f99b},'select':{'notificationApiError':!![]}});if(!_0x598232?.[_0x373960(0xbf)]){console[_0x373960(0x175)](_0x373960(0xa7)+_0x57f99b);return;}let _0x11b9ea=_0x373960(0xa9)+(_0x373960(0xfe)+_0x2fec24[_0x373960(0x154)]+'\x20'+_0x2fec24[_0x373960(0x123)]+'`\x0a')+('📅\x20Time:\x20'+_0x2fec24[_0x373960(0x15b)]['toLocaleString'](_0x373960(0x140))+'\x0a');_0x2fec24[_0x373960(0x10a)]&&(_0x11b9ea+=_0x373960(0x162)+_0x2fec24[_0x373960(0x10a)]+'`\x0a'),_0x11b9ea+='❌\x20Error:\x20`'+_0x2fec24[_0x373960(0xa4)]+'`\x0a',_0x2fec24['requestId']&&(_0x11b9ea+=_0x373960(0x130)+_0x2fec24[_0x373960(0x139)]+'`\x0a'),_0x11b9ea+=_0x373960(0x15d),await this[_0x373960(0xf6)](_0x57f99b,_0x11b9ea,{'parse_mode':_0x373960(0xe8)}),console[_0x373960(0x175)](_0x373960(0xd1)+_0x57f99b+':\x20'+_0x2fec24[_0x373960(0x123)]);}catch(_0xfeade5){console[_0x373960(0xa2)](_0x373960(0x155),_0xfeade5);}}async[a57_0x55babd(0xdc)](_0x5689a3,_0x113463,_0x16b464){const _0x1f6c55=a57_0x55babd;let _0x4ee7ef=_0x1f6c55(0x101)+_0x113463+_0x1f6c55(0x9e);for(const [_0x4a3ca4,_0x4f1b80]of Object[_0x1f6c55(0x106)](_0x16b464)){_0x4f1b80!==null&&_0x4f1b80!==undefined&&(_0x4ee7ef+=_0x4a3ca4+_0x1f6c55(0x138)+_0x4f1b80+'`\x0a');}await this[_0x1f6c55(0xf6)](_0x5689a3,_0x4ee7ef,{'parse_mode':_0x1f6c55(0xe8)});}[a57_0x55babd(0xd7)](){const _0x336f35=a57_0x55babd;return{'isActive':!!this['bot'],'username':this[_0x336f35(0xd5)]};}[a57_0x55babd(0x112)](){const _0x4b392c=a57_0x55babd;this[_0x4b392c(0xe4)]&&(this[_0x4b392c(0xe4)]['stopPolling'](),this[_0x4b392c(0xe4)]=null,console[_0x4b392c(0x175)](_0x4b392c(0x14f)));}}exports[a57_0x55babd(0xf9)]=TelegramBotService,exports[a57_0x55babd(0xa3)]=new TelegramBotService();