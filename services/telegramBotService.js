'use strict';const a54_0x135384=a54_0x29f1;(function(_0x1c3b70,_0x35eb35){const _0x107a37=a54_0x29f1,_0x4e6329=_0x1c3b70();while(!![]){try{const _0x5a02cd=-parseInt(_0x107a37(0xd3))/0x1*(parseInt(_0x107a37(0x155))/0x2)+parseInt(_0x107a37(0x138))/0x3+parseInt(_0x107a37(0xbf))/0x4*(parseInt(_0x107a37(0x8b))/0x5)+-parseInt(_0x107a37(0x92))/0x6*(parseInt(_0x107a37(0xa2))/0x7)+parseInt(_0x107a37(0x9e))/0x8*(parseInt(_0x107a37(0xf0))/0x9)+-parseInt(_0x107a37(0xa7))/0xa*(parseInt(_0x107a37(0xd5))/0xb)+-parseInt(_0x107a37(0x13f))/0xc;if(_0x5a02cd===_0x35eb35)break;else _0x4e6329['push'](_0x4e6329['shift']());}catch(_0x44227b){_0x4e6329['push'](_0x4e6329['shift']());}}}(a54_0x6883,0x51c20));var __importDefault=this&&this['__importDefault']||function(_0x32c44f){const _0x20bf29=a54_0x29f1;return _0x32c44f&&_0x32c44f[_0x20bf29(0x10e)]?_0x32c44f:{'default':_0x32c44f};};Object[a54_0x135384(0xd6)](exports,a54_0x135384(0x10e),{'value':!![]}),exports[a54_0x135384(0xe9)]=exports[a54_0x135384(0x85)]=void 0x0;function a54_0x6883(){const _0x15bce3=['chat','❌\x20Invalid\x20username\x20format:\x20`','1693935VIWtyp','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','sendCustomNotification','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','text','stopPolling','Commands:\x0a','🚨\x20*API\x20Error*\x0a\x0a','•\x20Payouts\x0a','*.\x0a\x0a','entries','getBotInfo','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','success','customerUa','Payout\x20rejected','\x22,\x20apiKey=\x22','toString','Contact\x20administrator.','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','customerName','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','🏦\x20IBAN:\x20`','startsWith','💸\x20Amount:\x20*','🌐\x20IP\x20address:\x20`','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','remitterIban','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','trapay_bot','__esModule','Telegram\x20bot\x20error:','findFirst','onText','message','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','\x20\x20\x20Status:\x20','📝\x20Format:\x20`username\x20api_key`\x0a\x0a',':\x20username=\x22','`.\x0a\x0a','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','🆔\x20Request\x20ID:\x20`','To\x20reconnect,\x20use\x20the\x20/start\x20command','/disconnect\x20-\x20disconnect\x20from\x20notifications','name','`\x20is\x20inactive.\x0a\x0a','polling_error','ipAddress','chargeback','txid','notificationApiError','getGatewayDisplayNameForTelegram','../types/gateway','customerIp','\x20verified\x20for\x20shop\x20','stopBot','New\x20payment\x20created','Failed\x20to\x20send\x20API\x20error\x20notification:','Payment\x20chargeback','sendMessage','isVerified','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','💻\x20Browser:\x20`','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','telegramUser','✅\x20Telegram\x20bot\x20@','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','📝\x20Notes:\x20','📅\x20Time:\x20','Check\x20spelling\x20and\x20try\x20again.','✅\x20Telegram\x20user\x20','153534tTMiKF','blocked','...`\x0a\x0a','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','🔌\x20User\x20','endpoint','1581828InpglT','/status\x20-\x20check\x20connection\x20status\x0a','\x20(@','\x20USD*\x0a','Markdown','📅\x20Connection\x20date:\x20','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','\x20USDT*\x0a','🔗\x20TXID:\x20`','en-US','Use\x20/start\x20to\x20begin.','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','📧\x20Email:\x20`','Example:\x0a','trim','updatedAt','log','TELEGRAM_BOT_USERNAME','📱\x20Your\x20Telegram\x20ID:\x20`','Telegram\x20bot\x20polling\x20error:','🎉\x20*Congratulations!*\x0a\x0a','method','19278sRQpQa','🏪\x20Gateway:\x20`','default','🔔\x20*','test','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','orderId','Failed\x20to\x20send\x20login\x20notification:','Payment\x20expired','chat\x20not\x20found','sendShopNotification','warn','toLocaleDateString','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','\x0aCheck\x20spelling\x20and\x20try\x20again.','Error\x20in\x20handleSingleLineVerification:','\x20via\x20single-line\x20input','update','createdAt','customerEmail','TelegramBotService','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','❌\x20Error:\x20`','pk_','bot','Payment\x20is\x20being\x20processed','15070MDNtiM','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','map','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Available\x20usernames:\x0a','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Error\x20sending\x20shop\x20notification:','6wobfmb','processing','❌\x20Shop\x20with\x20username\x20`','botUsername','Payment\x20successfully\x20paid','\x20\x20\x20Public\x20Key:\x20`','Error\x20handling\x20/disconnect\x20command:','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','includes','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','🛑\x20Telegram\x20bot\x20stopped','Payment\x20failed','16NslHqO','user\x20is\x20deactivated','timestamp','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','510286UMAcYf','../config/database','🌐\x20IP:\x20`','shopSettings','New\x20payout\x20created','160LTMTos','status','•\x20New\x20payments\x0a','error','`\x20not\x20found.\x0a\x0a','statusCode','🔍\x20*Debug\x20Information*\x0a\x0a','*\x0a\x0a','`\x0a\x0a','👤\x20Username:\x20`','from','amount','allSettled','substring','Error\x20handling\x20/status\x20command:','toLocaleString','Error\x20handling\x20/start\x20command:','🔔\x20Notifications\x20are\x20active\x0a\x0a','findMany','adminNotes','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','requestId','...\x22','536alnmLG','🏦\x20Method:\x20`','Use\x20/start\x20to\x20connect.','split','✅\x20Welcome\x20back!\x0a\x0a','username','📅\x20Date:\x20','setupBotHandlers','📱\x20Created\x20new\x20Telegram\x20user:\x20','errorMessage','Error\x20handling\x20message:','findUnique','💰\x20Amount:\x20*','botToken','Payment\x20refund','sendApiErrorNotification','length','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','User\x20','9iTSUZr','publicKey','141031wgbzUv','defineProperty','sk_','📝\x20Order\x20ID:\x20`','❌\x20Shop\x20`','shop','userAgent','•\x20Payment\x20status\x20changes\x0a','🆔\x20Payout\x20ID:\x20`','create','...','gateway','first_name','•\x20`','initializeBot','shopId','.\x20*','📱\x20Telegram\x20notification:\x20gateway\x20\x22','TELEGRAM_BOT_TOKEN','Failed\x20login\x20attempt','telegramBotService','\x20initialized\x20successfully','Error\x20handling\x20/debug\x20command:','handleSingleLineVerification','📛\x20Name:\x20`'];a54_0x6883=function(){return _0x15bce3;};return a54_0x6883();}const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a54_0x135384(0xa3))),gateway_1=require(a54_0x135384(0x124));function a54_0x29f1(_0x13c4ff,_0xed3cea){const _0x6883cb=a54_0x6883();return a54_0x29f1=function(_0x29f102,_0x404683){_0x29f102=_0x29f102-0x73;let _0x2bbcce=_0x6883cb[_0x29f102];return _0x2bbcce;},a54_0x29f1(_0x13c4ff,_0xed3cea);}class TelegramBotService{constructor(){const _0x46fb39=a54_0x135384;this[_0x46fb39(0x89)]=null,this[_0x46fb39(0xcc)]=process['env'][_0x46fb39(0xe7)]||'',this[_0x46fb39(0x95)]=process['env'][_0x46fb39(0x150)]||_0x46fb39(0x10d),this[_0x46fb39(0xcc)]?this[_0x46fb39(0xe3)]():console['warn'](_0x46fb39(0x118));}[a54_0x135384(0xe3)](){const _0x3158a4=a54_0x135384;try{this['bot']=new node_telegram_bot_api_1['default'](this['botToken'],{'polling':!![]}),this[_0x3158a4(0xc6)](),console[_0x3158a4(0x14f)](_0x3158a4(0x132)+this[_0x3158a4(0x95)]+_0x3158a4(0xea));}catch(_0x4c35e8){console['error']('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x4c35e8);}}[a54_0x135384(0xc6)](){const _0x146a93=a54_0x135384;if(!this['bot'])return;this['bot'][_0x146a93(0x111)](/\/start/,async _0x381c24=>{const _0x59937f=_0x146a93,_0x117ac2=_0x381c24[_0x59937f(0xee)]['id'],_0xfdb105=_0x381c24['from']?.['id'][_0x59937f(0x101)](),_0x137a7e=_0x381c24[_0x59937f(0xb1)]?.[_0x59937f(0xc4)],_0x21665e=_0x381c24[_0x59937f(0xb1)]?.[_0x59937f(0xe1)],_0x278a09=_0x381c24[_0x59937f(0xb1)]?.['last_name'];if(!_0xfdb105)return;try{let _0x375874=await database_1[_0x59937f(0x73)][_0x59937f(0x131)][_0x59937f(0xca)]({'where':{'telegramId':_0xfdb105},'include':{'shop':!![]}});!_0x375874?(_0x375874=await database_1['default'][_0x59937f(0x131)][_0x59937f(0xde)]({'data':{'telegramId':_0xfdb105,'username':_0x137a7e,'firstName':_0x21665e,'lastName':_0x278a09,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x59937f(0x14f)](_0x59937f(0xc7)+_0xfdb105+_0x59937f(0x141)+_0x137a7e+')')):_0x375874=await database_1[_0x59937f(0x73)][_0x59937f(0x131)][_0x59937f(0x82)]({'where':{'telegramId':_0xfdb105},'data':{'username':_0x137a7e,'firstName':_0x21665e,'lastName':_0x278a09},'include':{'shop':!![]}}),_0x375874[_0x59937f(0x12c)]&&_0x375874[_0x59937f(0xe4)]&&_0x375874['shop']?await this['bot']?.[_0x59937f(0x12b)](_0x117ac2,_0x59937f(0xc3)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x375874[_0x59937f(0xda)][_0x59937f(0x11c)]+'*\x0a')+('Username:\x20`'+_0x375874['shop'][_0x59937f(0xc4)]+_0x59937f(0xaf))+_0x59937f(0x8e)+_0x59937f(0xa9)+'•\x20Payment\x20status\x20changes\x0a'+'•\x20Payouts\x0a\x0a'+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x59937f(0x11b),{'parse_mode':'Markdown'}):(_0x375874[_0x59937f(0xe4)]&&!_0x375874[_0x59937f(0x12c)]&&(await database_1[_0x59937f(0x73)]['telegramUser'][_0x59937f(0x82)]({'where':{'telegramId':_0xfdb105},'data':{'shopId':null,'isVerified':![]}}),console[_0x59937f(0x14f)](_0x59937f(0xf3)+_0xfdb105)),await this[_0x59937f(0x89)]?.[_0x59937f(0x12b)](_0x117ac2,_0x59937f(0x13c)+_0x59937f(0xa1)+_0x59937f(0x115)+_0x59937f(0x14c)+_0x59937f(0xd1)+_0x59937f(0x12f),{'parse_mode':_0x59937f(0x143)}));}catch(_0x3b558f){console[_0x59937f(0xaa)](_0x59937f(0xb7),_0x3b558f),await this[_0x59937f(0x89)]?.[_0x59937f(0x12b)](_0x117ac2,_0x59937f(0x133));}}),this['bot'][_0x146a93(0x111)](/\/disconnect/,async _0x1c513f=>{const _0x1cff34=_0x146a93,_0x5d5ae9=_0x1c513f[_0x1cff34(0xee)]['id'],_0x4dd2f3=_0x1c513f['from']?.['id'][_0x1cff34(0x101)]();if(!_0x4dd2f3)return;try{const _0x15337e=await database_1[_0x1cff34(0x73)][_0x1cff34(0x131)][_0x1cff34(0xca)]({'where':{'telegramId':_0x4dd2f3},'include':{'shop':!![]}});if(!_0x15337e||!_0x15337e[_0x1cff34(0x12c)]||!_0x15337e[_0x1cff34(0xe4)]){await this[_0x1cff34(0x89)]?.[_0x1cff34(0x12b)](_0x5d5ae9,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x146577=_0x15337e['shop']?.[_0x1cff34(0x11c)]||'unknown\x20shop';await database_1['default'][_0x1cff34(0x131)]['update']({'where':{'telegramId':_0x4dd2f3},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x1cff34(0x13d)+_0x4dd2f3+'\x20disconnected\x20from\x20shop\x20'+_0x15337e[_0x1cff34(0xe4)]),await this['bot']?.['sendMessage'](_0x5d5ae9,_0x1cff34(0x12d)+_0x146577+'*.\x0a\x0a'+_0x1cff34(0x11a),{'parse_mode':'Markdown'});}catch(_0x5bfa5c){console[_0x1cff34(0xaa)](_0x1cff34(0x98),_0x5bfa5c),await this[_0x1cff34(0x89)]?.[_0x1cff34(0x12b)](_0x5d5ae9,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x146a93(0x89)][_0x146a93(0x111)](/\/status/,async _0x29cf5c=>{const _0x3d73a6=_0x146a93,_0x2def03=_0x29cf5c[_0x3d73a6(0xee)]['id'],_0x24bf85=_0x29cf5c[_0x3d73a6(0xb1)]?.['id'][_0x3d73a6(0x101)]();if(!_0x24bf85)return;try{const _0x8a9c3b=await database_1[_0x3d73a6(0x73)]['telegramUser'][_0x3d73a6(0xca)]({'where':{'telegramId':_0x24bf85},'include':{'shop':!![]}});if(!_0x8a9c3b){await this['bot']?.[_0x3d73a6(0x12b)](_0x2def03,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x3d73a6(0x149));return;}if(!_0x8a9c3b[_0x3d73a6(0x12c)]||!_0x8a9c3b['shopId']||!_0x8a9c3b[_0x3d73a6(0xda)]){await this[_0x3d73a6(0x89)]?.['sendMessage'](_0x2def03,_0x3d73a6(0x113)+_0x3d73a6(0xc1));return;}await this[_0x3d73a6(0x89)]?.['sendMessage'](_0x2def03,'📊\x20*Connection\x20Status*\x0a\x0a'+('✅\x20Connected\x20to\x20shop:\x20*'+_0x8a9c3b['shop'][_0x3d73a6(0x11c)]+'*\x0a')+('👤\x20Username:\x20`'+_0x8a9c3b[_0x3d73a6(0xda)][_0x3d73a6(0xc4)]+'`\x0a')+(_0x3d73a6(0x144)+_0x8a9c3b[_0x3d73a6(0x14e)][_0x3d73a6(0x7d)](_0x3d73a6(0x148))+'\x0a\x0a')+_0x3d73a6(0xb8)+_0x3d73a6(0xf6)+_0x3d73a6(0x11b),{'parse_mode':_0x3d73a6(0x143)});}catch(_0x2f8641){console[_0x3d73a6(0xaa)](_0x3d73a6(0xb5),_0x2f8641),await this[_0x3d73a6(0x89)]?.[_0x3d73a6(0x12b)](_0x2def03,_0x3d73a6(0x133));}}),this[_0x146a93(0x89)]['onText'](/\/debug/,async _0x5790a2=>{const _0x3172e3=_0x146a93,_0x2a0c04=_0x5790a2[_0x3172e3(0xee)]['id'],_0x332e62=_0x5790a2[_0x3172e3(0xb1)]?.['id'][_0x3172e3(0x101)]();if(!_0x332e62)return;try{const _0x39b948=await database_1[_0x3172e3(0x73)]['shop'][_0x3172e3(0xb9)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x3be30a=_0x3172e3(0xad);_0x3be30a+=_0x3172e3(0x151)+_0x332e62+_0x3172e3(0xaf),_0x3be30a+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x39b948['forEach']((_0x3b5f1a,_0x5825c5)=>{const _0xba5672=_0x3172e3;_0x3be30a+=_0x5825c5+0x1+_0xba5672(0xe5)+_0x3b5f1a['name']+'*\x0a',_0x3be30a+='\x20\x20\x20Username:\x20`'+_0x3b5f1a[_0xba5672(0xc4)]+'`\x0a',_0x3be30a+=_0xba5672(0x114)+_0x3b5f1a['status']+'\x0a',_0x3be30a+=_0xba5672(0x97)+_0x3b5f1a[_0xba5672(0xd4)][_0xba5672(0xb4)](0x0,0xf)+_0xba5672(0x13a);}),await this[_0x3172e3(0x89)]?.['sendMessage'](_0x2a0c04,_0x3be30a,{'parse_mode':'Markdown'});}catch(_0x38f7db){console[_0x3172e3(0xaa)](_0x3172e3(0xeb),_0x38f7db),await this['bot']?.[_0x3172e3(0x12b)](_0x2a0c04,'❌\x20Error\x20getting\x20debug\x20information.');}}),this['bot']['on'](_0x146a93(0x112),async _0x24da43=>{const _0x2e4853=_0x146a93;if(_0x24da43[_0x2e4853(0xf4)]?.[_0x2e4853(0x107)]('/'))return;const _0xc3e5d0=_0x24da43['chat']['id'],_0x5ac88c=_0x24da43[_0x2e4853(0xb1)]?.['id'][_0x2e4853(0x101)](),_0x551345=_0x24da43['text']?.[_0x2e4853(0x14d)]();if(!_0x5ac88c||!_0x551345)return;try{const _0xba198e=await database_1['default']['telegramUser'][_0x2e4853(0xca)]({'where':{'telegramId':_0x5ac88c},'include':{'shop':!![]}});if(!_0xba198e){await this['bot']?.[_0x2e4853(0x12b)](_0xc3e5d0,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0xba198e[_0x2e4853(0x12c)]&&_0xba198e[_0x2e4853(0xe4)]&&_0xba198e['shop']){await this[_0x2e4853(0x89)]?.['sendMessage'](_0xc3e5d0,_0x2e4853(0x145)+_0xba198e[_0x2e4853(0xda)][_0x2e4853(0x11c)]+_0x2e4853(0xf9)+_0x2e4853(0xbc),{'parse_mode':'Markdown'});return;}const _0xf8d757=_0x551345[_0x2e4853(0xc2)](/\s+/);if(_0xf8d757[_0x2e4853(0xcf)]!==0x2){await this[_0x2e4853(0x89)]?.['sendMessage'](_0xc3e5d0,_0x2e4853(0x90)+_0x2e4853(0x115)+_0x2e4853(0x14c)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+('You\x20sent\x20'+_0xf8d757['length']+'\x20parts:\x20'+_0xf8d757['map'](_0x205998=>'`'+_0x205998+'`')['join'](',\x20')),{'parse_mode':_0x2e4853(0x143)});return;}const [_0x4606e0,_0x3fa9ac]=_0xf8d757;console[_0x2e4853(0x14f)](_0x2e4853(0x103)+_0x5ac88c+':\x20username=\x22'+_0x4606e0+_0x2e4853(0x100)+_0x3fa9ac[_0x2e4853(0xb4)](0x0,0xa)+_0x2e4853(0xbe)),await this[_0x2e4853(0xec)](_0xc3e5d0,_0x5ac88c,_0x4606e0,_0x3fa9ac);}catch(_0x1124e1){console[_0x2e4853(0xaa)](_0x2e4853(0xc9),_0x1124e1),await this[_0x2e4853(0x89)]?.[_0x2e4853(0x12b)](_0xc3e5d0,_0x2e4853(0x133));}}),this[_0x146a93(0x89)]['on'](_0x146a93(0xaa),_0x126868=>{const _0xaa92e5=_0x146a93;console[_0xaa92e5(0xaa)](_0xaa92e5(0x10f),_0x126868);}),this['bot']['on'](_0x146a93(0x11e),_0x1237b6=>{const _0x92c693=_0x146a93;console[_0x92c693(0xaa)](_0x92c693(0x152),_0x1237b6);});}async[a54_0x135384(0xec)](_0x1779fd,_0x250617,_0x33cf1e,_0x79b7c2){const _0x7236da=a54_0x135384;try{console[_0x7236da(0x14f)](_0x7236da(0x103)+_0x250617+_0x7236da(0x116)+_0x33cf1e+_0x7236da(0x100)+_0x79b7c2['substring'](0x0,0xa)+_0x7236da(0xbe));if(!_0x33cf1e||_0x33cf1e[_0x7236da(0xcf)]<0x3||_0x33cf1e[_0x7236da(0xcf)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x7236da(0x75)](_0x33cf1e)){await this[_0x7236da(0x89)]?.[_0x7236da(0x12b)](_0x1779fd,_0x7236da(0xef)+_0x33cf1e+'`\x0a\x0a'+_0x7236da(0xf1),{'parse_mode':_0x7236da(0x143)});return;}if(!_0x79b7c2||!_0x79b7c2[_0x7236da(0x107)](_0x7236da(0x88))&&!_0x79b7c2[_0x7236da(0x107)](_0x7236da(0xd7))){await this[_0x7236da(0x89)]?.[_0x7236da(0x12b)](_0x1779fd,_0x7236da(0x76)+_0x7236da(0x130),{'parse_mode':_0x7236da(0x143)});return;}const _0x524a4c=await database_1[_0x7236da(0x73)][_0x7236da(0xda)][_0x7236da(0xca)]({'where':{'username':_0x33cf1e},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x524a4c){const _0x53d652=await database_1['default'][_0x7236da(0xda)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0xaf46a4=_0x7236da(0x94)+_0x33cf1e+_0x7236da(0xab);_0x53d652['length']>0x0?(_0xaf46a4+=_0x7236da(0x8f),_0x53d652['forEach'](_0x49e520=>{const _0x29935c=_0x7236da;_0xaf46a4+=_0x29935c(0xe2)+_0x49e520[_0x29935c(0xc4)]+'`\x20('+_0x49e520[_0x29935c(0x11c)]+')\x0a';}),_0xaf46a4+=_0x7236da(0x7f)):_0xaf46a4+=_0x7236da(0x136);await this[_0x7236da(0x89)]?.[_0x7236da(0x12b)](_0x1779fd,_0xaf46a4,{'parse_mode':_0x7236da(0x143)});return;}if(_0x524a4c[_0x7236da(0xa8)]!=='ACTIVE'){await this[_0x7236da(0x89)]?.[_0x7236da(0x12b)](_0x1779fd,_0x7236da(0xd9)+_0x33cf1e+_0x7236da(0x11d)+_0x7236da(0x102),{'parse_mode':_0x7236da(0x143)});return;}if(_0x524a4c[_0x7236da(0xd4)]!==_0x79b7c2&&_0x524a4c['secretKey']!==_0x79b7c2){await this['bot']?.['sendMessage'](_0x1779fd,_0x7236da(0x7e)+_0x33cf1e+_0x7236da(0x117)+_0x7236da(0x99)+_0x7236da(0xd0),{'parse_mode':_0x7236da(0x143)});return;}const _0x59aa76=await database_1[_0x7236da(0x73)][_0x7236da(0x131)][_0x7236da(0x110)]({'where':{'shopId':_0x524a4c['id'],'isVerified':!![],'telegramId':{'not':_0x250617}}});if(_0x59aa76){await this[_0x7236da(0x89)]?.[_0x7236da(0x12b)](_0x1779fd,_0x7236da(0x86)+_0x33cf1e+'`.\x0a\x0a'+_0x7236da(0x10c),{'parse_mode':'Markdown'});return;}await database_1[_0x7236da(0x73)][_0x7236da(0x131)]['update']({'where':{'telegramId':_0x250617},'data':{'shopId':_0x524a4c['id'],'isVerified':!![]}}),await this[_0x7236da(0x89)]?.[_0x7236da(0x12b)](_0x1779fd,_0x7236da(0x153)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('📱\x20Shop:\x20*'+_0x524a4c['name']+'*\x0a')+(_0x7236da(0xb0)+_0x524a4c[_0x7236da(0xc4)]+_0x7236da(0xaf))+_0x7236da(0xfc)+_0x7236da(0xa9)+_0x7236da(0xdc)+_0x7236da(0xf8)+'•\x20Important\x20events\x0a\x0a'+_0x7236da(0xf6)+_0x7236da(0x140)+_0x7236da(0x11b),{'parse_mode':_0x7236da(0x143)}),console[_0x7236da(0x14f)](_0x7236da(0x137)+_0x250617+_0x7236da(0x126)+_0x524a4c[_0x7236da(0xc4)]+_0x7236da(0x81));}catch(_0x38cbf1){console[_0x7236da(0xaa)](_0x7236da(0x80),_0x38cbf1),await this['bot']?.[_0x7236da(0x12b)](_0x1779fd,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a54_0x135384(0x7b)](_0x5ec4e6,_0x1c83b2,_0x3f0c0f){const _0x4f4dae=a54_0x135384;if(!this[_0x4f4dae(0x89)]){console[_0x4f4dae(0x7c)](_0x4f4dae(0x105));return;}try{const _0x33cd75=await database_1['default'][_0x4f4dae(0x131)][_0x4f4dae(0xb9)]({'where':{'shopId':_0x5ec4e6,'isVerified':!![]}});if(_0x33cd75[_0x4f4dae(0xcf)]===0x0){console[_0x4f4dae(0x14f)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x5ec4e6);return;}const _0x5696a3=_0x33cd75[_0x4f4dae(0x8d)](async _0x48b73a=>{const _0x52093c=_0x4f4dae;try{await this[_0x52093c(0x89)]?.[_0x52093c(0x12b)](_0x48b73a['telegramId'],_0x1c83b2,_0x3f0c0f),console[_0x52093c(0x14f)](_0x52093c(0x8c)+_0x48b73a['telegramId']);}catch(_0x529a42){console[_0x52093c(0xaa)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x48b73a['telegramId']+':',_0x529a42),_0x529a42 instanceof Error&&(_0x529a42[_0x52093c(0x112)][_0x52093c(0x9a)](_0x52093c(0x139))||_0x529a42['message'][_0x52093c(0x9a)](_0x52093c(0x7a))||_0x529a42[_0x52093c(0x112)]['includes'](_0x52093c(0x9f)))&&(await database_1['default']['telegramUser'][_0x52093c(0x82)]({'where':{'id':_0x48b73a['id']},'data':{'isVerified':![]}}),console[_0x52093c(0x14f)](_0x52093c(0xd2)+_0x48b73a['telegramId']+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x4f4dae(0xb3)](_0x5696a3);}catch(_0x3ef93e){console[_0x4f4dae(0xaa)](_0x4f4dae(0x91),_0x3ef93e);}}async['sendPaymentNotification'](_0x469df9,_0x3feea0,_0x20988c){const _0x312bba=a54_0x135384,_0x282280={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x19e8e2={'created':_0x312bba(0x128),'paid':_0x312bba(0x96),'failed':_0x312bba(0x9d),'expired':_0x312bba(0x79),'refund':_0x312bba(0xcd),'chargeback':_0x312bba(0x12a),'processing':_0x312bba(0x8a)},_0x1cd0ec=_0x282280[_0x20988c],_0x399c1=_0x19e8e2[_0x20988c],_0xe4aa06=(0x0,gateway_1[_0x312bba(0x123)])(_0x3feea0[_0x312bba(0xe0)]);console[_0x312bba(0x14f)](_0x312bba(0xe6)+_0x3feea0['gateway']+'\x22\x20->\x20display\x20\x22'+_0xe4aa06+'\x22');let _0x49a75b=_0x1cd0ec+'\x20*'+_0x399c1+_0x312bba(0xae)+(_0x312bba(0xcb)+_0x3feea0[_0x312bba(0xb2)]+'\x20'+_0x3feea0['currency']+'*\x0a')+(_0x312bba(0xd8)+(_0x3feea0[_0x312bba(0x77)]||_0x3feea0['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x3feea0['id']+'`\x0a')+(_0x312bba(0x156)+_0xe4aa06+'`\x0a')+(_0x312bba(0xc5)+new Date(_0x3feea0['createdAt'])[_0x312bba(0xb6)](_0x312bba(0x148))+'\x0a');if(_0x3feea0['customerName']||_0x3feea0[_0x312bba(0x84)]||_0x3feea0[_0x312bba(0x10b)]||_0x3feea0[_0x312bba(0x125)]||_0x3feea0[_0x312bba(0xfe)]){_0x49a75b+='\x0a👤\x20*Customer\x20Information:*\x0a';_0x3feea0[_0x312bba(0x104)]&&(_0x49a75b+=_0x312bba(0xed)+_0x3feea0[_0x312bba(0x104)]+'`\x0a');_0x3feea0['customerEmail']&&(_0x49a75b+=_0x312bba(0x14b)+_0x3feea0['customerEmail']+'`\x0a');_0x3feea0[_0x312bba(0x10b)]&&(_0x49a75b+=_0x312bba(0x106)+_0x3feea0['remitterIban']+'`\x0a');_0x3feea0[_0x312bba(0x125)]&&(_0x49a75b+=_0x312bba(0xa4)+_0x3feea0[_0x312bba(0x125)]+'`\x0a');if(_0x3feea0[_0x312bba(0xfe)]){const _0x51f8fd=_0x3feea0[_0x312bba(0xfe)][_0x312bba(0xcf)]>0x32?_0x3feea0['customerUa']['substring'](0x0,0x32)+_0x312bba(0xdf):_0x3feea0[_0x312bba(0xfe)];_0x49a75b+=_0x312bba(0x12e)+_0x51f8fd+'`\x0a';}}_0x20988c===_0x312bba(0x120)&&_0x3feea0['chargebackAmount']&&(_0x49a75b+='💸\x20Penalty\x20amount:\x20*'+_0x3feea0['chargebackAmount']+_0x312bba(0x146)),_0x20988c===_0x312bba(0x93)&&(_0x49a75b+=_0x312bba(0xbb)),_0x3feea0[_0x312bba(0xba)]&&(_0x49a75b+=_0x312bba(0x134)+_0x3feea0[_0x312bba(0xba)]+'\x0a'),await this[_0x312bba(0x7b)](_0x469df9,_0x49a75b,{'parse_mode':_0x312bba(0x143)});}async['sendPayoutNotification'](_0x2d2c44,_0x3c0028,_0x2cbf38){const _0x4633cb=a54_0x135384,_0x51a04d={'created':'📤','completed':'✅','rejected':'❌'},_0x2ca583={'created':_0x4633cb(0xa6),'completed':'Payout\x20completed','rejected':_0x4633cb(0xff)},_0x34f35c=_0x51a04d[_0x2cbf38],_0x7983fe=_0x2ca583[_0x2cbf38],_0xe15068=_0x34f35c+'\x20*'+_0x7983fe+_0x4633cb(0xae)+(_0x4633cb(0x108)+_0x3c0028[_0x4633cb(0xb2)]+_0x4633cb(0x142))+(_0x4633cb(0xc0)+_0x3c0028[_0x4633cb(0x154)]+'`\x0a')+(_0x4633cb(0xdd)+_0x3c0028['id']+'`\x0a')+(_0x4633cb(0xc5)+new Date(_0x3c0028[_0x4633cb(0x83)])['toLocaleString'](_0x4633cb(0x148))+'\x0a')+(_0x3c0028[_0x4633cb(0x121)]?_0x4633cb(0x147)+_0x3c0028['txid']+'`':'');await this['sendShopNotification'](_0x2d2c44,_0xe15068,{'parse_mode':'Markdown'});}async['sendLoginNotification'](_0x486b58,_0x35a9f1){const _0x3f8dca=a54_0x135384;try{const _0x5bb60e=await database_1['default'][_0x3f8dca(0xa5)][_0x3f8dca(0xca)]({'where':{'shopId':_0x486b58},'select':{'notificationLogin':!![]}});if(!_0x5bb60e?.['notificationLogin']){console[_0x3f8dca(0x14f)](_0x3f8dca(0x10a)+_0x486b58);return;}const _0x26489f=_0x35a9f1[_0x3f8dca(0xfd)]?'🔐':'🚨',_0x1e1de2=_0x35a9f1[_0x3f8dca(0xfd)]?'Successful\x20login':_0x3f8dca(0xe8);let _0x57cbe6=_0x26489f+'\x20*'+_0x1e1de2+_0x3f8dca(0xae)+('👤\x20Username:\x20`'+_0x35a9f1[_0x3f8dca(0xc4)]+'`\x0a')+(_0x3f8dca(0x135)+_0x35a9f1[_0x3f8dca(0xa0)][_0x3f8dca(0xb6)](_0x3f8dca(0x148))+'\x0a');_0x35a9f1[_0x3f8dca(0x11f)]&&(_0x57cbe6+=_0x3f8dca(0x109)+_0x35a9f1[_0x3f8dca(0x11f)]+'`\x0a');if(_0x35a9f1[_0x3f8dca(0xdb)]){const _0x1cf64e=_0x35a9f1[_0x3f8dca(0xdb)][_0x3f8dca(0xcf)]>0x32?_0x35a9f1['userAgent'][_0x3f8dca(0xb4)](0x0,0x32)+_0x3f8dca(0xdf):_0x35a9f1['userAgent'];_0x57cbe6+=_0x3f8dca(0x12e)+_0x1cf64e+'`\x0a';}!_0x35a9f1['success']&&(_0x57cbe6+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x3f8dca(0x7b)](_0x486b58,_0x57cbe6,{'parse_mode':'Markdown'}),console[_0x3f8dca(0x14f)](_0x3f8dca(0x13b)+_0x486b58+':\x20'+(_0x35a9f1[_0x3f8dca(0xfd)]?'success':'failed'));}catch(_0x384218){console[_0x3f8dca(0xaa)](_0x3f8dca(0x78),_0x384218);}}async[a54_0x135384(0xce)](_0x46f35f,_0x225ef6){const _0x5f12af=a54_0x135384;try{const _0xbdb974=await database_1[_0x5f12af(0x73)][_0x5f12af(0xa5)][_0x5f12af(0xca)]({'where':{'shopId':_0x46f35f},'select':{'notificationApiError':!![]}});if(!_0xbdb974?.[_0x5f12af(0x122)]){console[_0x5f12af(0x14f)](_0x5f12af(0x14a)+_0x46f35f);return;}let _0x7cb57=_0x5f12af(0xf7)+('🔗\x20Endpoint:\x20`'+_0x225ef6[_0x5f12af(0x154)]+'\x20'+_0x225ef6[_0x5f12af(0x13e)]+'`\x0a')+(_0x5f12af(0x135)+_0x225ef6[_0x5f12af(0xa0)][_0x5f12af(0xb6)]('en-US')+'\x0a');_0x225ef6[_0x5f12af(0xac)]&&(_0x7cb57+='📊\x20Error\x20code:\x20`'+_0x225ef6[_0x5f12af(0xac)]+'`\x0a'),_0x7cb57+=_0x5f12af(0x87)+_0x225ef6[_0x5f12af(0xc8)]+'`\x0a',_0x225ef6[_0x5f12af(0xbd)]&&(_0x7cb57+=_0x5f12af(0x119)+_0x225ef6[_0x5f12af(0xbd)]+'`\x0a'),_0x7cb57+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x5f12af(0x7b)](_0x46f35f,_0x7cb57,{'parse_mode':_0x5f12af(0x143)}),console['log'](_0x5f12af(0x9b)+_0x46f35f+':\x20'+_0x225ef6['endpoint']);}catch(_0x39f433){console[_0x5f12af(0xaa)](_0x5f12af(0x129),_0x39f433);}}async[a54_0x135384(0xf2)](_0x2a508c,_0x4a18b2,_0x5ac75e){const _0x567e36=a54_0x135384;let _0x59c620=_0x567e36(0x74)+_0x4a18b2+_0x567e36(0xae);for(const [_0x3b5659,_0x39c027]of Object[_0x567e36(0xfa)](_0x5ac75e)){_0x39c027!==null&&_0x39c027!==undefined&&(_0x59c620+=_0x3b5659+':\x20`'+_0x39c027+'`\x0a');}await this['sendShopNotification'](_0x2a508c,_0x59c620,{'parse_mode':_0x567e36(0x143)});}[a54_0x135384(0xfb)](){const _0x1d8d26=a54_0x135384;return{'isActive':!!this[_0x1d8d26(0x89)],'username':this[_0x1d8d26(0x95)]};}[a54_0x135384(0x127)](){const _0x12e3cd=a54_0x135384;this[_0x12e3cd(0x89)]&&(this[_0x12e3cd(0x89)][_0x12e3cd(0xf5)](),this[_0x12e3cd(0x89)]=null,console['log'](_0x12e3cd(0x9c)));}}exports['TelegramBotService']=TelegramBotService,exports[a54_0x135384(0xe9)]=new TelegramBotService();