'use strict';const a53_0x39f111=a53_0x22db;(function(_0x48fe00,_0x47cdd9){const _0x29a400=a53_0x22db,_0x3a2973=_0x48fe00();while(!![]){try{const _0xb9f343=parseInt(_0x29a400(0x1be))/0x1*(parseInt(_0x29a400(0x218))/0x2)+-parseInt(_0x29a400(0x1d2))/0x3*(-parseInt(_0x29a400(0x22e))/0x4)+-parseInt(_0x29a400(0x1ef))/0x5*(parseInt(_0x29a400(0x1c0))/0x6)+parseInt(_0x29a400(0x1d6))/0x7*(-parseInt(_0x29a400(0x212))/0x8)+-parseInt(_0x29a400(0x1a0))/0x9*(parseInt(_0x29a400(0x1de))/0xa)+parseInt(_0x29a400(0x1ab))/0xb*(-parseInt(_0x29a400(0x15e))/0xc)+-parseInt(_0x29a400(0x1c7))/0xd*(-parseInt(_0x29a400(0x198))/0xe);if(_0xb9f343===_0x47cdd9)break;else _0x3a2973['push'](_0x3a2973['shift']());}catch(_0xceaf4a){_0x3a2973['push'](_0x3a2973['shift']());}}}(a53_0x3188,0xa8b9b));var __importDefault=this&&this[a53_0x39f111(0x205)]||function(_0x262135){const _0x43ed88=a53_0x39f111;return _0x262135&&_0x262135[_0x43ed88(0x1b0)]?_0x262135:{'default':_0x262135};};Object[a53_0x39f111(0x188)](exports,a53_0x39f111(0x1b0),{'value':!![]}),exports[a53_0x39f111(0x16b)]=exports[a53_0x39f111(0x1b9)]=void 0x0;function a53_0x3188(){const _0x23367a=['\x20\x20\x20Username:\x20`','warn','1340159vOtsIu','📅\x20Time:\x20','7209822FnEiSO','Commands:\x0a','stopBot','statusCode','📱\x20Created\x20new\x20Telegram\x20user:\x20','...\x22','Error\x20handling\x20message:','1336556vWoEDH','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','.\x20*','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','from','`\x0a\x0a','getGatewayDisplayNameForTelegram','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','test','adminNotes','processing','1284lCiOjm',':\x20`','New\x20payment\x20created','...`\x0a\x0a','7IWyWQA','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','userAgent','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','🚨\x20*API\x20Error*\x0a\x0a','*.\x0a\x0a','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','allSettled','170SIwLBT','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','chargebackAmount','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','forEach','map','/disconnect\x20-\x20disconnect\x20from\x20notifications','update','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','requestId','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','sendCustomNotification','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','text','🏦\x20Method:\x20`','Payment\x20refund','🎉\x20*Congratulations!*\x0a\x0a','5RhkRRk','Payment\x20expired','`\x20is\x20inactive.\x0a\x0a','handleSingleLineVerification','../config/database','success','Example:\x0a','join','chat\x20not\x20found','sendMessage','shop','username','Check\x20spelling\x20and\x20try\x20again.','📝\x20Order\x20ID:\x20`','env','status','txid','customerEmail','\x20USDT*\x0a','getBotInfo','Payment\x20successfully\x20paid','stopPolling','__importDefault','New\x20payout\x20created','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','ACTIVE','bot','To\x20reconnect,\x20use\x20the\x20/start\x20command','🔌\x20User\x20','unknown\x20shop','\x0aCheck\x20spelling\x20and\x20try\x20again.','•\x20Payouts\x0a\x0a','findUnique','Successful\x20login','Markdown','8824984iwFeZp','method','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','telegramUser','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','2DBBWts','Error\x20handling\x20/disconnect\x20command:','startsWith','Use\x20/start\x20to\x20begin.','customerName','create','findMany','botUsername','📧\x20Email:\x20`','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','*\x0a\x0a','Payment\x20is\x20being\x20processed','notificationLogin','name','default','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','❌\x20Invalid\x20username\x20format:\x20`','✅\x20Connected\x20to\x20shop:\x20*','Telegram\x20bot\x20error:','💸\x20Penalty\x20amount:\x20*','chargeback','4036kzOLWw','\x22\x20->\x20display\x20\x22','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','ipAddress','shopId','📛\x20Name:\x20`','Payment\x20chargeback','secretKey','notificationApiError','\x20verified\x20for\x20shop\x20','TELEGRAM_BOT_TOKEN','timestamp','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','message','\x20disconnected\x20from\x20shop\x20','5264532YUOqkn','Payment\x20failed','•\x20Payment\x20status\x20changes\x0a','\x20\x20\x20Public\x20Key:\x20`','../types/gateway','🔔\x20You\x20receive\x20notifications\x20about:\x0a','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','Use\x20/start\x20to\x20connect.','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','length','\x20initialized\x20successfully','telegramId','🆔\x20Payment\x20ID:\x20`','telegramBotService','findFirst','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','📅\x20Date:\x20','🌐\x20IP\x20address:\x20`','errorMessage','Username:\x20`','👤\x20Username:\x20`','en-US','🏪\x20Gateway:\x20`','🛑\x20Telegram\x20bot\x20stopped','\x20USD*\x0a','trapay_bot','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','toLocaleDateString','amount',':\x20username=\x22','\x20parts:\x20','Error\x20handling\x20/start\x20command:','•\x20Important\x20events\x0a\x0a','initializeBot','Failed\x20to\x20send\x20API\x20error\x20notification:','user\x20is\x20deactivated','sendPaymentNotification','📅\x20Connection\x20date:\x20','substring','•\x20Payouts\x0a','✅\x20Telegram\x20user\x20','defineProperty','TELEGRAM_BOT_USERNAME','sendLoginNotification','orderId','updatedAt','🔔\x20*','toLocaleString','✅\x20Telegram\x20bot\x20@','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','Error\x20in\x20handleSingleLineVerification:','chat','❌\x20Shop\x20with\x20username\x20`','onText','💰\x20Amount:\x20*','log','error','378GJZVqf','toString','`.\x0a\x0a','blocked','sendShopNotification','first_name','📊\x20*Connection\x20Status*\x0a\x0a','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','124911WYPgeR','Payout\x20rejected','publicKey','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','🆔\x20Payout\x20ID:\x20`','•\x20New\x20payments\x0a','💸\x20Amount:\x20*','entries','`\x20not\x20found.\x0a\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','isVerified','33zgJceJ','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','🏪\x20Available\x20shops\x20in\x20system:\x0a','sendPayoutNotification','💻\x20Browser:\x20`','__esModule','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','endpoint','createdAt','sendApiErrorNotification','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Error\x20sending\x20shop\x20notification:','shopSettings','botToken','TelegramBotService','includes','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.'];a53_0x3188=function(){return _0x23367a;};return a53_0x3188();}function a53_0x22db(_0x24adf5,_0x3705a4){const _0x3188fc=a53_0x3188();return a53_0x22db=function(_0x22dbdf,_0x4f9bfd){_0x22dbdf=_0x22dbdf-0x153;let _0x4d9ee1=_0x3188fc[_0x22dbdf];return _0x4d9ee1;},a53_0x22db(_0x24adf5,_0x3705a4);}const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a53_0x39f111(0x1f3))),gateway_1=require(a53_0x39f111(0x162));class TelegramBotService{constructor(){const _0x4f4398=a53_0x39f111;this['bot']=null,this[_0x4f4398(0x1b8)]=process['env'][_0x4f4398(0x159)]||'',this[_0x4f4398(0x21f)]=process[_0x4f4398(0x1fd)][_0x4f4398(0x189)]||_0x4f4398(0x177),this[_0x4f4398(0x1b8)]?this['initializeBot']():console['warn'](_0x4f4398(0x178));}[a53_0x39f111(0x180)](){const _0x161dbb=a53_0x39f111;try{this[_0x161dbb(0x209)]=new node_telegram_bot_api_1[(_0x161dbb(0x227))](this[_0x161dbb(0x1b8)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x161dbb(0x196)](_0x161dbb(0x18f)+this['botUsername']+_0x161dbb(0x168));}catch(_0x1b4f17){console[_0x161dbb(0x197)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x1b4f17);}}['setupBotHandlers'](){const _0x25ad4e=a53_0x39f111;if(!this[_0x25ad4e(0x209)])return;this[_0x25ad4e(0x209)][_0x25ad4e(0x194)](/\/start/,async _0x1b493b=>{const _0x84fcc8=_0x25ad4e,_0x3d87b2=_0x1b493b[_0x84fcc8(0x192)]['id'],_0x40ba3e=_0x1b493b['from']?.['id'][_0x84fcc8(0x199)](),_0x214509=_0x1b493b[_0x84fcc8(0x1cb)]?.[_0x84fcc8(0x1fa)],_0xa1124=_0x1b493b[_0x84fcc8(0x1cb)]?.[_0x84fcc8(0x19d)],_0x2fda79=_0x1b493b[_0x84fcc8(0x1cb)]?.['last_name'];if(!_0x40ba3e)return;try{let _0x677113=await database_1[_0x84fcc8(0x227)][_0x84fcc8(0x216)][_0x84fcc8(0x20f)]({'where':{'telegramId':_0x40ba3e},'include':{'shop':!![]}});!_0x677113?(_0x677113=await database_1[_0x84fcc8(0x227)][_0x84fcc8(0x216)][_0x84fcc8(0x21d)]({'data':{'telegramId':_0x40ba3e,'username':_0x214509,'firstName':_0xa1124,'lastName':_0x2fda79,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x84fcc8(0x196)](_0x84fcc8(0x1c4)+_0x40ba3e+'\x20(@'+_0x214509+')')):_0x677113=await database_1[_0x84fcc8(0x227)][_0x84fcc8(0x216)][_0x84fcc8(0x1e5)]({'where':{'telegramId':_0x40ba3e},'data':{'username':_0x214509,'firstName':_0xa1124,'lastName':_0x2fda79},'include':{'shop':!![]}}),_0x677113[_0x84fcc8(0x1aa)]&&_0x677113['shopId']&&_0x677113['shop']?await this['bot']?.['sendMessage'](_0x3d87b2,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x84fcc8(0x214)+_0x677113['shop'][_0x84fcc8(0x226)]+'*\x0a')+(_0x84fcc8(0x171)+_0x677113[_0x84fcc8(0x1f9)][_0x84fcc8(0x1fa)]+_0x84fcc8(0x1cc))+_0x84fcc8(0x163)+_0x84fcc8(0x1a5)+_0x84fcc8(0x160)+_0x84fcc8(0x20e)+_0x84fcc8(0x1c1)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x84fcc8(0x1e4),{'parse_mode':_0x84fcc8(0x211)}):(_0x677113[_0x84fcc8(0x153)]&&!_0x677113['isVerified']&&(await database_1[_0x84fcc8(0x227)][_0x84fcc8(0x216)][_0x84fcc8(0x1e5)]({'where':{'telegramId':_0x40ba3e},'data':{'shopId':null,'isVerified':![]}}),console[_0x84fcc8(0x196)](_0x84fcc8(0x221)+_0x40ba3e)),await this[_0x84fcc8(0x209)]?.[_0x84fcc8(0x1f8)](_0x3d87b2,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x84fcc8(0x1b5)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x84fcc8(0x1f5)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x84fcc8(0x1ea),{'parse_mode':_0x84fcc8(0x211)}));}catch(_0x7a2eea){console[_0x84fcc8(0x197)](_0x84fcc8(0x17e),_0x7a2eea),await this[_0x84fcc8(0x209)]?.[_0x84fcc8(0x1f8)](_0x3d87b2,_0x84fcc8(0x207));}}),this[_0x25ad4e(0x209)][_0x25ad4e(0x194)](/\/disconnect/,async _0x4267a6=>{const _0x319c4c=_0x25ad4e,_0x284f6a=_0x4267a6['chat']['id'],_0x59dc13=_0x4267a6[_0x319c4c(0x1cb)]?.['id']['toString']();if(!_0x59dc13)return;try{const _0x15b752=await database_1[_0x319c4c(0x227)]['telegramUser']['findUnique']({'where':{'telegramId':_0x59dc13},'include':{'shop':!![]}});if(!_0x15b752||!_0x15b752['isVerified']||!_0x15b752[_0x319c4c(0x153)]){await this[_0x319c4c(0x209)]?.[_0x319c4c(0x1f8)](_0x284f6a,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x3e156d=_0x15b752[_0x319c4c(0x1f9)]?.[_0x319c4c(0x226)]||_0x319c4c(0x20c);await database_1[_0x319c4c(0x227)][_0x319c4c(0x216)][_0x319c4c(0x1e5)]({'where':{'telegramId':_0x59dc13},'data':{'shopId':null,'isVerified':![]}}),console[_0x319c4c(0x196)](_0x319c4c(0x20b)+_0x59dc13+_0x319c4c(0x15d)+_0x15b752[_0x319c4c(0x153)]),await this[_0x319c4c(0x209)]?.[_0x319c4c(0x1f8)](_0x284f6a,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x3e156d+_0x319c4c(0x1db)+_0x319c4c(0x20a),{'parse_mode':_0x319c4c(0x211)});}catch(_0x417294){console[_0x319c4c(0x197)](_0x319c4c(0x219),_0x417294),await this[_0x319c4c(0x209)]?.[_0x319c4c(0x1f8)](_0x284f6a,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x25ad4e(0x209)][_0x25ad4e(0x194)](/\/status/,async _0x56104c=>{const _0x36658f=_0x25ad4e,_0x2a30d1=_0x56104c['chat']['id'],_0x4f483a=_0x56104c[_0x36658f(0x1cb)]?.['id'][_0x36658f(0x199)]();if(!_0x4f483a)return;try{const _0x2a96e0=await database_1[_0x36658f(0x227)][_0x36658f(0x216)][_0x36658f(0x20f)]({'where':{'telegramId':_0x4f483a},'include':{'shop':!![]}});if(!_0x2a96e0){await this[_0x36658f(0x209)]?.[_0x36658f(0x1f8)](_0x2a30d1,_0x36658f(0x179)+_0x36658f(0x21b));return;}if(!_0x2a96e0[_0x36658f(0x1aa)]||!_0x2a96e0[_0x36658f(0x153)]||!_0x2a96e0[_0x36658f(0x1f9)]){await this[_0x36658f(0x209)]?.['sendMessage'](_0x2a30d1,_0x36658f(0x1a3)+_0x36658f(0x165));return;}await this[_0x36658f(0x209)]?.[_0x36658f(0x1f8)](_0x2a30d1,_0x36658f(0x19e)+(_0x36658f(0x22a)+_0x2a96e0[_0x36658f(0x1f9)][_0x36658f(0x226)]+'*\x0a')+(_0x36658f(0x172)+_0x2a96e0[_0x36658f(0x1f9)]['username']+'`\x0a')+(_0x36658f(0x184)+_0x2a96e0[_0x36658f(0x18c)][_0x36658f(0x17a)](_0x36658f(0x173))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+'Commands:\x0a'+_0x36658f(0x1e4),{'parse_mode':_0x36658f(0x211)});}catch(_0x137c6a){console[_0x36658f(0x197)]('Error\x20handling\x20/status\x20command:',_0x137c6a),await this[_0x36658f(0x209)]?.[_0x36658f(0x1f8)](_0x2a30d1,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x25ad4e(0x209)][_0x25ad4e(0x194)](/\/debug/,async _0x599636=>{const _0x250402=_0x25ad4e,_0x460fa9=_0x599636['chat']['id'],_0x34ab0d=_0x599636[_0x250402(0x1cb)]?.['id'][_0x250402(0x199)]();if(!_0x34ab0d)return;try{const _0x2024d4=await database_1[_0x250402(0x227)][_0x250402(0x1f9)][_0x250402(0x21e)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x2a9b2d='🔍\x20*Debug\x20Information*\x0a\x0a';_0x2a9b2d+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x34ab0d+_0x250402(0x1cc),_0x2a9b2d+=_0x250402(0x1ad),_0x2024d4['forEach']((_0x1798f5,_0x58a6c8)=>{const _0x599dee=_0x250402;_0x2a9b2d+=_0x58a6c8+0x1+_0x599dee(0x1c9)+_0x1798f5[_0x599dee(0x226)]+'*\x0a',_0x2a9b2d+=_0x599dee(0x1bc)+_0x1798f5[_0x599dee(0x1fa)]+'`\x0a',_0x2a9b2d+='\x20\x20\x20Status:\x20'+_0x1798f5[_0x599dee(0x1fe)]+'\x0a',_0x2a9b2d+=_0x599dee(0x161)+_0x1798f5[_0x599dee(0x1a2)][_0x599dee(0x185)](0x0,0xf)+_0x599dee(0x1d5);}),await this[_0x250402(0x209)]?.[_0x250402(0x1f8)](_0x460fa9,_0x2a9b2d,{'parse_mode':'Markdown'});}catch(_0x4ef16c){console[_0x250402(0x197)]('Error\x20handling\x20/debug\x20command:',_0x4ef16c),await this[_0x250402(0x209)]?.[_0x250402(0x1f8)](_0x460fa9,'❌\x20Error\x20getting\x20debug\x20information.');}}),this['bot']['on']('message',async _0x26c4ed=>{const _0xf8b8cd=_0x25ad4e;if(_0x26c4ed['text']?.['startsWith']('/'))return;const _0x100a31=_0x26c4ed[_0xf8b8cd(0x192)]['id'],_0x3f01f2=_0x26c4ed[_0xf8b8cd(0x1cb)]?.['id']['toString'](),_0x5418ea=_0x26c4ed[_0xf8b8cd(0x1eb)]?.['trim']();if(!_0x3f01f2||!_0x5418ea)return;try{const _0x53d66f=await database_1[_0xf8b8cd(0x227)][_0xf8b8cd(0x216)][_0xf8b8cd(0x20f)]({'where':{'telegramId':_0x3f01f2},'include':{'shop':!![]}});if(!_0x53d66f){await this['bot']?.[_0xf8b8cd(0x1f8)](_0x100a31,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x53d66f[_0xf8b8cd(0x1aa)]&&_0x53d66f[_0xf8b8cd(0x153)]&&_0x53d66f[_0xf8b8cd(0x1f9)]){await this[_0xf8b8cd(0x209)]?.['sendMessage'](_0x100a31,_0xf8b8cd(0x16d)+_0x53d66f[_0xf8b8cd(0x1f9)][_0xf8b8cd(0x226)]+_0xf8b8cd(0x1db)+_0xf8b8cd(0x217),{'parse_mode':_0xf8b8cd(0x211)});return;}const _0x568105=_0x5418ea['split'](/\s+/);if(_0x568105[_0xf8b8cd(0x167)]!==0x2){await this['bot']?.['sendMessage'](_0x100a31,_0xf8b8cd(0x1dc)+_0xf8b8cd(0x1ca)+_0xf8b8cd(0x1f5)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+('You\x20sent\x20'+_0x568105['length']+_0xf8b8cd(0x17d)+_0x568105[_0xf8b8cd(0x1e3)](_0x500b6b=>'`'+_0x500b6b+'`')[_0xf8b8cd(0x1f6)](',\x20')),{'parse_mode':_0xf8b8cd(0x211)});return;}const [_0xdde17d,_0x178630]=_0x568105;console['log'](_0xf8b8cd(0x1d9)+_0x3f01f2+_0xf8b8cd(0x17c)+_0xdde17d+'\x22,\x20apiKey=\x22'+_0x178630[_0xf8b8cd(0x185)](0x0,0xa)+_0xf8b8cd(0x1c5)),await this[_0xf8b8cd(0x1f2)](_0x100a31,_0x3f01f2,_0xdde17d,_0x178630);}catch(_0x2a3560){console[_0xf8b8cd(0x197)](_0xf8b8cd(0x1c6),_0x2a3560),await this[_0xf8b8cd(0x209)]?.[_0xf8b8cd(0x1f8)](_0x100a31,_0xf8b8cd(0x207));}}),this['bot']['on'](_0x25ad4e(0x197),_0x15e422=>{const _0x186518=_0x25ad4e;console['error'](_0x186518(0x22b),_0x15e422);}),this['bot']['on']('polling_error',_0x5880fe=>{const _0x3eb529=_0x25ad4e;console[_0x3eb529(0x197)]('Telegram\x20bot\x20polling\x20error:',_0x5880fe);});}async[a53_0x39f111(0x1f2)](_0x40f73c,_0x54a645,_0x18e13e,_0x2bb7f2){const _0x18ab5b=a53_0x39f111;try{console['log'](_0x18ab5b(0x1d9)+_0x54a645+_0x18ab5b(0x17c)+_0x18e13e+'\x22,\x20apiKey=\x22'+_0x2bb7f2['substring'](0x0,0xa)+_0x18ab5b(0x1c5));if(!_0x18e13e||_0x18e13e[_0x18ab5b(0x167)]<0x3||_0x18e13e[_0x18ab5b(0x167)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x18ab5b(0x1cf)](_0x18e13e)){await this[_0x18ab5b(0x209)]?.[_0x18ab5b(0x1f8)](_0x40f73c,_0x18ab5b(0x229)+_0x18e13e+'`\x0a\x0a'+_0x18ab5b(0x215),{'parse_mode':_0x18ab5b(0x211)});return;}if(!_0x2bb7f2||!_0x2bb7f2[_0x18ab5b(0x21a)]('pk_')&&!_0x2bb7f2[_0x18ab5b(0x21a)]('sk_')){await this[_0x18ab5b(0x209)]?.['sendMessage'](_0x40f73c,_0x18ab5b(0x230)+_0x18ab5b(0x164),{'parse_mode':_0x18ab5b(0x211)});return;}const _0x39a01a=await database_1[_0x18ab5b(0x227)][_0x18ab5b(0x1f9)][_0x18ab5b(0x20f)]({'where':{'username':_0x18e13e},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x39a01a){const _0x36ca86=await database_1[_0x18ab5b(0x227)]['shop'][_0x18ab5b(0x21e)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x1e3203=_0x18ab5b(0x193)+_0x18e13e+_0x18ab5b(0x1a8);_0x36ca86[_0x18ab5b(0x167)]>0x0?(_0x1e3203+='Available\x20usernames:\x0a',_0x36ca86[_0x18ab5b(0x1e2)](_0x42d67e=>{const _0x2e54e5=_0x18ab5b;_0x1e3203+='•\x20`'+_0x42d67e[_0x2e54e5(0x1fa)]+'`\x20('+_0x42d67e[_0x2e54e5(0x226)]+')\x0a';}),_0x1e3203+=_0x18ab5b(0x20d)):_0x1e3203+=_0x18ab5b(0x1fb);await this['bot']?.[_0x18ab5b(0x1f8)](_0x40f73c,_0x1e3203,{'parse_mode':_0x18ab5b(0x211)});return;}if(_0x39a01a['status']!==_0x18ab5b(0x208)){await this[_0x18ab5b(0x209)]?.[_0x18ab5b(0x1f8)](_0x40f73c,'❌\x20Shop\x20`'+_0x18e13e+_0x18ab5b(0x1f1)+'Contact\x20administrator.',{'parse_mode':_0x18ab5b(0x211)});return;}if(_0x39a01a[_0x18ab5b(0x1a2)]!==_0x2bb7f2&&_0x39a01a[_0x18ab5b(0x156)]!==_0x2bb7f2){await this[_0x18ab5b(0x209)]?.['sendMessage'](_0x40f73c,_0x18ab5b(0x1df)+_0x18e13e+_0x18ab5b(0x19a)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x18ab5b(0x190),{'parse_mode':_0x18ab5b(0x211)});return;}const _0x2cb9a8=await database_1[_0x18ab5b(0x227)][_0x18ab5b(0x216)][_0x18ab5b(0x16c)]({'where':{'shopId':_0x39a01a['id'],'isVerified':!![],'telegramId':{'not':_0x54a645}}});if(_0x2cb9a8){await this[_0x18ab5b(0x209)]?.[_0x18ab5b(0x1f8)](_0x40f73c,_0x18ab5b(0x1e6)+_0x18e13e+'`.\x0a\x0a'+_0x18ab5b(0x19f),{'parse_mode':'Markdown'});return;}await database_1[_0x18ab5b(0x227)]['telegramUser'][_0x18ab5b(0x1e5)]({'where':{'telegramId':_0x54a645},'data':{'shopId':_0x39a01a['id'],'isVerified':!![]}}),await this['bot']?.['sendMessage'](_0x40f73c,_0x18ab5b(0x1ee)+_0x18ab5b(0x15b)+('📱\x20Shop:\x20*'+_0x39a01a['name']+'*\x0a')+(_0x18ab5b(0x172)+_0x39a01a[_0x18ab5b(0x1fa)]+_0x18ab5b(0x1cc))+_0x18ab5b(0x1b1)+_0x18ab5b(0x1a5)+_0x18ab5b(0x160)+_0x18ab5b(0x186)+_0x18ab5b(0x17f)+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x18ab5b(0x1e4),{'parse_mode':_0x18ab5b(0x211)}),console['log'](_0x18ab5b(0x187)+_0x54a645+_0x18ab5b(0x158)+_0x39a01a[_0x18ab5b(0x1fa)]+'\x20via\x20single-line\x20input');}catch(_0x28e3fc){console[_0x18ab5b(0x197)](_0x18ab5b(0x191),_0x28e3fc),await this[_0x18ab5b(0x209)]?.[_0x18ab5b(0x1f8)](_0x40f73c,_0x18ab5b(0x1bb));}}async[a53_0x39f111(0x19c)](_0x148b24,_0x283722,_0xbc8be2){const _0x2a76b5=a53_0x39f111;if(!this[_0x2a76b5(0x209)]){console[_0x2a76b5(0x1bd)](_0x2a76b5(0x1d7));return;}try{const _0x1b7c00=await database_1[_0x2a76b5(0x227)][_0x2a76b5(0x216)][_0x2a76b5(0x21e)]({'where':{'shopId':_0x148b24,'isVerified':!![]}});if(_0x1b7c00[_0x2a76b5(0x167)]===0x0){console['log']('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x148b24);return;}const _0x333161=_0x1b7c00[_0x2a76b5(0x1e3)](async _0x33d928=>{const _0x381e76=_0x2a76b5;try{await this[_0x381e76(0x209)]?.['sendMessage'](_0x33d928['telegramId'],_0x283722,_0xbc8be2),console[_0x381e76(0x196)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x33d928[_0x381e76(0x169)]);}catch(_0x9ee1a7){console[_0x381e76(0x197)](_0x381e76(0x222)+_0x33d928[_0x381e76(0x169)]+':',_0x9ee1a7),_0x9ee1a7 instanceof Error&&(_0x9ee1a7[_0x381e76(0x15c)][_0x381e76(0x1ba)](_0x381e76(0x19b))||_0x9ee1a7[_0x381e76(0x15c)]['includes'](_0x381e76(0x1f7))||_0x9ee1a7['message'][_0x381e76(0x1ba)](_0x381e76(0x182)))&&(await database_1[_0x381e76(0x227)][_0x381e76(0x216)][_0x381e76(0x1e5)]({'where':{'id':_0x33d928['id']},'data':{'isVerified':![]}}),console[_0x381e76(0x196)]('User\x20'+_0x33d928[_0x381e76(0x169)]+_0x381e76(0x228)));}});await Promise[_0x2a76b5(0x1dd)](_0x333161);}catch(_0x440cfc){console['error'](_0x2a76b5(0x1b6),_0x440cfc);}}async[a53_0x39f111(0x183)](_0x445911,_0x4ed172,_0x202c2c){const _0x12a513=a53_0x39f111,_0x5c6824={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x118a2f={'created':_0x12a513(0x1d4),'paid':_0x12a513(0x203),'failed':_0x12a513(0x15f),'expired':_0x12a513(0x1f0),'refund':_0x12a513(0x1ed),'chargeback':_0x12a513(0x155),'processing':_0x12a513(0x224)},_0x2625f8=_0x5c6824[_0x202c2c],_0x24853b=_0x118a2f[_0x202c2c],_0x4fcf87=(0x0,gateway_1[_0x12a513(0x1cd)])(_0x4ed172['gateway']);console['log'](_0x12a513(0x1a9)+_0x4ed172['gateway']+_0x12a513(0x22f)+_0x4fcf87+'\x22');let _0x20c6e4=_0x2625f8+'\x20*'+_0x24853b+_0x12a513(0x223)+(_0x12a513(0x195)+_0x4ed172['amount']+'\x20'+_0x4ed172['currency']+'*\x0a')+(_0x12a513(0x1fc)+(_0x4ed172[_0x12a513(0x18b)]||_0x4ed172['id'])+'`\x0a')+(_0x12a513(0x16a)+_0x4ed172['id']+'`\x0a')+(_0x12a513(0x174)+_0x4fcf87+'`\x0a')+(_0x12a513(0x16e)+new Date(_0x4ed172[_0x12a513(0x1b3)])[_0x12a513(0x18e)](_0x12a513(0x173))+'\x0a');(_0x4ed172[_0x12a513(0x21c)]||_0x4ed172[_0x12a513(0x200)])&&(_0x20c6e4+='\x0a👤\x20*Customer\x20Information:*\x0a',_0x4ed172[_0x12a513(0x21c)]&&(_0x20c6e4+=_0x12a513(0x154)+_0x4ed172[_0x12a513(0x21c)]+'`\x0a'),_0x4ed172[_0x12a513(0x200)]&&(_0x20c6e4+=_0x12a513(0x220)+_0x4ed172['customerEmail']+'`\x0a')),_0x202c2c===_0x12a513(0x22d)&&_0x4ed172['chargebackAmount']&&(_0x20c6e4+=_0x12a513(0x22c)+_0x4ed172[_0x12a513(0x1e0)]+_0x12a513(0x201)),_0x202c2c===_0x12a513(0x1d1)&&(_0x20c6e4+=_0x12a513(0x1c8)),_0x4ed172[_0x12a513(0x1d0)]&&(_0x20c6e4+='📝\x20Notes:\x20'+_0x4ed172[_0x12a513(0x1d0)]+'\x0a'),await this['sendShopNotification'](_0x445911,_0x20c6e4,{'parse_mode':_0x12a513(0x211)});}async[a53_0x39f111(0x1ae)](_0x3333af,_0x36bd21,_0x40c72a){const _0xe5f4a9=a53_0x39f111,_0x4816f1={'created':'📤','completed':'✅','rejected':'❌'},_0x296676={'created':_0xe5f4a9(0x206),'completed':'Payout\x20completed','rejected':_0xe5f4a9(0x1a1)},_0x16e3ef=_0x4816f1[_0x40c72a],_0x126717=_0x296676[_0x40c72a],_0x439091=_0x16e3ef+'\x20*'+_0x126717+'*\x0a\x0a'+(_0xe5f4a9(0x1a6)+_0x36bd21[_0xe5f4a9(0x17b)]+_0xe5f4a9(0x176))+(_0xe5f4a9(0x1ec)+_0x36bd21['method']+'`\x0a')+(_0xe5f4a9(0x1a4)+_0x36bd21['id']+'`\x0a')+(_0xe5f4a9(0x16e)+new Date(_0x36bd21[_0xe5f4a9(0x1b3)])[_0xe5f4a9(0x18e)]('en-US')+'\x0a')+(_0x36bd21[_0xe5f4a9(0x1ff)]?'🔗\x20TXID:\x20`'+_0x36bd21[_0xe5f4a9(0x1ff)]+'`':'');await this[_0xe5f4a9(0x19c)](_0x3333af,_0x439091,{'parse_mode':_0xe5f4a9(0x211)});}async[a53_0x39f111(0x18a)](_0xae0e92,_0x1dbc85){const _0x3719a7=a53_0x39f111;try{const _0x5d6881=await database_1[_0x3719a7(0x227)][_0x3719a7(0x1b7)][_0x3719a7(0x20f)]({'where':{'shopId':_0xae0e92},'select':{'notificationLogin':!![]}});if(!_0x5d6881?.[_0x3719a7(0x225)]){console[_0x3719a7(0x196)](_0x3719a7(0x1ce)+_0xae0e92);return;}const _0x5eca17=_0x1dbc85[_0x3719a7(0x1f4)]?'🔐':'🚨',_0x43039f=_0x1dbc85['success']?_0x3719a7(0x210):'Failed\x20login\x20attempt';let _0x3cf159=_0x5eca17+'\x20*'+_0x43039f+_0x3719a7(0x223)+(_0x3719a7(0x172)+_0x1dbc85[_0x3719a7(0x1fa)]+'`\x0a')+(_0x3719a7(0x1bf)+_0x1dbc85['timestamp'][_0x3719a7(0x18e)](_0x3719a7(0x173))+'\x0a');_0x1dbc85['ipAddress']&&(_0x3cf159+=_0x3719a7(0x16f)+_0x1dbc85[_0x3719a7(0x231)]+'`\x0a');if(_0x1dbc85[_0x3719a7(0x1d8)]){const _0x4af720=_0x1dbc85[_0x3719a7(0x1d8)][_0x3719a7(0x167)]>0x32?_0x1dbc85[_0x3719a7(0x1d8)][_0x3719a7(0x185)](0x0,0x32)+'...':_0x1dbc85[_0x3719a7(0x1d8)];_0x3cf159+=_0x3719a7(0x1af)+_0x4af720+'`\x0a';}!_0x1dbc85[_0x3719a7(0x1f4)]&&(_0x3cf159+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x3719a7(0x19c)](_0xae0e92,_0x3cf159,{'parse_mode':'Markdown'}),console['log'](_0x3719a7(0x1e8)+_0xae0e92+':\x20'+(_0x1dbc85[_0x3719a7(0x1f4)]?_0x3719a7(0x1f4):'failed'));}catch(_0x2d4080){console[_0x3719a7(0x197)]('Failed\x20to\x20send\x20login\x20notification:',_0x2d4080);}}async[a53_0x39f111(0x1b4)](_0x2ca3e7,_0x45dad9){const _0x21f36b=a53_0x39f111;try{const _0x139d6b=await database_1[_0x21f36b(0x227)][_0x21f36b(0x1b7)][_0x21f36b(0x20f)]({'where':{'shopId':_0x2ca3e7},'select':{'notificationApiError':!![]}});if(!_0x139d6b?.[_0x21f36b(0x157)]){console[_0x21f36b(0x196)](_0x21f36b(0x1ac)+_0x2ca3e7);return;}let _0x5afbe8=_0x21f36b(0x1da)+('🔗\x20Endpoint:\x20`'+_0x45dad9[_0x21f36b(0x213)]+'\x20'+_0x45dad9[_0x21f36b(0x1b2)]+'`\x0a')+('📅\x20Time:\x20'+_0x45dad9[_0x21f36b(0x15a)][_0x21f36b(0x18e)](_0x21f36b(0x173))+'\x0a');_0x45dad9[_0x21f36b(0x1c3)]&&(_0x5afbe8+='📊\x20Error\x20code:\x20`'+_0x45dad9[_0x21f36b(0x1c3)]+'`\x0a'),_0x5afbe8+='❌\x20Error:\x20`'+_0x45dad9[_0x21f36b(0x170)]+'`\x0a',_0x45dad9['requestId']&&(_0x5afbe8+='🆔\x20Request\x20ID:\x20`'+_0x45dad9[_0x21f36b(0x1e7)]+'`\x0a'),_0x5afbe8+=_0x21f36b(0x166),await this[_0x21f36b(0x19c)](_0x2ca3e7,_0x5afbe8,{'parse_mode':'Markdown'}),console['log'](_0x21f36b(0x1e1)+_0x2ca3e7+':\x20'+_0x45dad9['endpoint']);}catch(_0x187946){console[_0x21f36b(0x197)](_0x21f36b(0x181),_0x187946);}}async[a53_0x39f111(0x1e9)](_0x2f8af1,_0x4405ec,_0x1a5ba0){const _0x9f87d6=a53_0x39f111;let _0x349c81=_0x9f87d6(0x18d)+_0x4405ec+_0x9f87d6(0x223);for(const [_0x2a99b8,_0x46a17e]of Object[_0x9f87d6(0x1a7)](_0x1a5ba0)){_0x46a17e!==null&&_0x46a17e!==undefined&&(_0x349c81+=_0x2a99b8+_0x9f87d6(0x1d3)+_0x46a17e+'`\x0a');}await this[_0x9f87d6(0x19c)](_0x2f8af1,_0x349c81,{'parse_mode':_0x9f87d6(0x211)});}[a53_0x39f111(0x202)](){const _0x24a4bd=a53_0x39f111;return{'isActive':!!this[_0x24a4bd(0x209)],'username':this['botUsername']};}[a53_0x39f111(0x1c2)](){const _0x2e8970=a53_0x39f111;this['bot']&&(this[_0x2e8970(0x209)][_0x2e8970(0x204)](),this[_0x2e8970(0x209)]=null,console[_0x2e8970(0x196)](_0x2e8970(0x175)));}}exports['TelegramBotService']=TelegramBotService,exports[a53_0x39f111(0x16b)]=new TelegramBotService();