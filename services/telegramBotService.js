'use strict';const a53_0x2136dd=a53_0x455d;(function(_0xd5274f,_0x194a6a){const _0x4dce9e=a53_0x455d,_0x2a048b=_0xd5274f();while(!![]){try{const _0xc1dc7d=parseInt(_0x4dce9e(0x11d))/0x1*(parseInt(_0x4dce9e(0xf7))/0x2)+-parseInt(_0x4dce9e(0xbb))/0x3+parseInt(_0x4dce9e(0xbd))/0x4+parseInt(_0x4dce9e(0xed))/0x5+-parseInt(_0x4dce9e(0x117))/0x6*(parseInt(_0x4dce9e(0xcc))/0x7)+parseInt(_0x4dce9e(0x111))/0x8*(-parseInt(_0x4dce9e(0xd0))/0x9)+parseInt(_0x4dce9e(0x189))/0xa*(parseInt(_0x4dce9e(0x142))/0xb);if(_0xc1dc7d===_0x194a6a)break;else _0x2a048b['push'](_0x2a048b['shift']());}catch(_0x42159){_0x2a048b['push'](_0x2a048b['shift']());}}}(a53_0x4bf0,0xa4c63));function a53_0x4bf0(){const _0x448267=['toString','✅\x20Telegram\x20bot\x20@','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','\x20(@','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','16523070XSLCbf','endpoint','includes','•\x20Payment\x20status\x20changes\x0a','stopBot','•\x20Payouts\x0a\x0a','shopId','Failed\x20to\x20send\x20API\x20error\x20notification:','📱\x20Telegram\x20notification:\x20gateway\x20\x22','timestamp','sk_','node-telegram-bot-api','Payment\x20chargeback','📊\x20Error\x20code:\x20`','Payout\x20rejected','Payment\x20failed','📝\x20Notes:\x20','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','message','Payment\x20successfully\x20paid','/disconnect\x20-\x20disconnect\x20from\x20notifications','New\x20payout\x20created','957930dpJuVQ','Successful\x20login','3681476HCNfRZ','ACTIVE','chargebackAmount','onText','Payment\x20refund','trapay_bot','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','User\x20','🌐\x20IP\x20address:\x20`','secretKey','.\x20*','chargeback','...\x22','stopPolling','substring','35140TLWcOF','`\x20(','Error\x20handling\x20/start\x20command:','💸\x20Penalty\x20amount:\x20*','678123HygmOf','📧\x20Email:\x20`','🆔\x20Payment\x20ID:\x20`','success','log','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','failed','ipAddress','txid','❌\x20Shop\x20`','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Check\x20spelling\x20and\x20try\x20again.','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','\x20\x20\x20Status:\x20','sendMessage','split','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','*.\x0a\x0a','\x20USD*\x0a','../types/gateway','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','TelegramBotService','📱\x20Your\x20Telegram\x20ID:\x20`','forEach','getBotInfo','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','customerEmail','2594770JNkrdL','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','🔔\x20Notifications\x20are\x20active\x0a\x0a','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','•\x20`','isVerified','create','error','Username:\x20`','\x20via\x20single-line\x20input','2NWkBfm','chat\x20not\x20found','sendPayoutNotification','warn','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','💻\x20Browser:\x20`','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','statusCode','Commands:\x0a','default','📅\x20Connection\x20date:\x20','length','\x20verified\x20for\x20shop\x20','errorMessage','\x20\x20\x20Username:\x20`','`\x0a\x0a','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Payout\x20completed','Use\x20/start\x20to\x20begin.','findMany','•\x20Payouts\x0a','username','/status\x20-\x20check\x20connection\x20status\x0a','update','currency','Payment\x20expired','136GEcpzM','publicKey','TELEGRAM_BOT_TOKEN','env','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','orderId','1188wPyGMK','from','Use\x20/start\x20to\x20connect.','To\x20reconnect,\x20use\x20the\x20/start\x20command','shop','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','177454rjWYWj','pk_','text','initializeBot','first_name','Available\x20usernames:\x0a','botToken','name','\x0a👤\x20*Customer\x20Information:*\x0a','userAgent','🔗\x20Endpoint:\x20`','__esModule','Example:\x0a','`\x20not\x20found.\x0a\x0a','setupBotHandlers','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','You\x20sent\x20','shopSettings','telegramBotService','adminNotes','trim','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','telegramUser','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','notificationLogin','\x0aCheck\x20spelling\x20and\x20try\x20again.','Markdown','💸\x20Amount:\x20*','bot','❌\x20Please\x20use\x20/start\x20command\x20first',':\x20`','notificationApiError','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','📝\x20Order\x20ID:\x20`','\x20disconnected\x20from\x20shop\x20','📱\x20Created\x20new\x20Telegram\x20user:\x20','Contact\x20administrator.','11kyDVMV','processing','🏪\x20Gateway:\x20`','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Error\x20handling\x20/debug\x20command:','amount','requestId','❌\x20Invalid\x20username\x20format:\x20`','blocked','telegramId','🆔\x20Request\x20ID:\x20`','📊\x20*Connection\x20Status*\x0a\x0a','🎉\x20*Congratulations!*\x0a\x0a','Error\x20handling\x20/status\x20command:','📅\x20Time:\x20','Error\x20sending\x20shop\x20notification:','Telegram\x20bot\x20polling\x20error:','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','en-US','sendShopNotification','method','findUnique','*\x0a\x0a','\x20USDT*\x0a','👤\x20Username:\x20`','❌\x20Error\x20getting\x20debug\x20information.','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','findFirst','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','toLocaleDateString','toLocaleString','user\x20is\x20deactivated','sendPaymentNotification','Failed\x20login\x20attempt','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','\x20parts:\x20','gateway','botUsername','../config/database','customerName','🔗\x20TXID:\x20`','📅\x20Date:\x20','startsWith','Failed\x20to\x20send\x20login\x20notification:','🛑\x20Telegram\x20bot\x20stopped','defineProperty','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','🏦\x20Method:\x20`','handleSingleLineVerification','\x20\x20\x20Public\x20Key:\x20`','✅\x20Telegram\x20user\x20','join','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','✅\x20Welcome\x20back!\x0a\x0a','status','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','`.\x0a\x0a','\x22,\x20apiKey=\x22',':\x20username=\x22','sendLoginNotification','chat','🔔\x20*'];a53_0x4bf0=function(){return _0x448267;};return a53_0x4bf0();}var __importDefault=this&&this['__importDefault']||function(_0x4700d8){const _0x2927f8=a53_0x455d;return _0x4700d8&&_0x4700d8[_0x2927f8(0x128)]?_0x4700d8:{'default':_0x4700d8};};Object[a53_0x2136dd(0x172)](exports,a53_0x2136dd(0x128),{'value':!![]}),exports[a53_0x2136dd(0x12f)]=exports[a53_0x2136dd(0xe6)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a53_0x2136dd(0xb0))),database_1=__importDefault(require(a53_0x2136dd(0x16b))),gateway_1=require(a53_0x2136dd(0xe4));function a53_0x455d(_0x2d4732,_0xf86835){const _0x4bf0eb=a53_0x4bf0();return a53_0x455d=function(_0x455d33,_0x4632dc){_0x455d33=_0x455d33-0xac;let _0x702925=_0x4bf0eb[_0x455d33];return _0x702925;},a53_0x455d(_0x2d4732,_0xf86835);}class TelegramBotService{constructor(){const _0x58fe71=a53_0x2136dd;this['bot']=null,this[_0x58fe71(0x123)]=process[_0x58fe71(0x114)][_0x58fe71(0x113)]||'',this[_0x58fe71(0x16a)]=process[_0x58fe71(0x114)]['TELEGRAM_BOT_USERNAME']||_0x58fe71(0xc2),this[_0x58fe71(0x123)]?this[_0x58fe71(0x120)]():console[_0x58fe71(0xfa)](_0x58fe71(0x185));}[a53_0x2136dd(0x120)](){const _0xbd8688=a53_0x2136dd;try{this['bot']=new node_telegram_bot_api_1[(_0xbd8688(0x100))](this[_0xbd8688(0x123)],{'polling':!![]}),this[_0xbd8688(0x12b)](),console[_0xbd8688(0xd4)](_0xbd8688(0x184)+this['botUsername']+'\x20initialized\x20successfully');}catch(_0x40029b){console['error'](_0xbd8688(0xd5),_0x40029b);}}[a53_0x2136dd(0x12b)](){const _0x479278=a53_0x2136dd;if(!this[_0x479278(0x139)])return;this[_0x479278(0x139)]['onText'](/\/start/,async _0x2ff342=>{const _0x2fd29e=_0x479278,_0x1538d1=_0x2ff342['chat']['id'],_0x37602a=_0x2ff342[_0x2fd29e(0x118)]?.['id']['toString'](),_0x9b6c56=_0x2ff342[_0x2fd29e(0x118)]?.[_0x2fd29e(0x10c)],_0x376d25=_0x2ff342[_0x2fd29e(0x118)]?.[_0x2fd29e(0x121)],_0x6b0fa3=_0x2ff342[_0x2fd29e(0x118)]?.['last_name'];if(!_0x37602a)return;try{let _0x2d47e7=await database_1[_0x2fd29e(0x100)][_0x2fd29e(0x133)][_0x2fd29e(0x158)]({'where':{'telegramId':_0x37602a},'include':{'shop':!![]}});!_0x2d47e7?(_0x2d47e7=await database_1[_0x2fd29e(0x100)]['telegramUser'][_0x2fd29e(0xf3)]({'data':{'telegramId':_0x37602a,'username':_0x9b6c56,'firstName':_0x376d25,'lastName':_0x6b0fa3,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x2fd29e(0xd4)](_0x2fd29e(0x140)+_0x37602a+_0x2fd29e(0x187)+_0x9b6c56+')')):_0x2d47e7=await database_1[_0x2fd29e(0x100)][_0x2fd29e(0x133)][_0x2fd29e(0x10e)]({'where':{'telegramId':_0x37602a},'data':{'username':_0x9b6c56,'firstName':_0x376d25,'lastName':_0x6b0fa3},'include':{'shop':!![]}}),_0x2d47e7['isVerified']&&_0x2d47e7[_0x2fd29e(0x18f)]&&_0x2d47e7[_0x2fd29e(0x11b)]?await this[_0x2fd29e(0x139)]?.[_0x2fd29e(0xdf)](_0x1538d1,_0x2fd29e(0x17a)+(_0x2fd29e(0x188)+_0x2d47e7['shop'][_0x2fd29e(0x124)]+'*\x0a')+(_0x2fd29e(0xf5)+_0x2d47e7['shop'][_0x2fd29e(0x10c)]+_0x2fd29e(0x106))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x2fd29e(0x18c)+_0x2fd29e(0x18e)+'Commands:\x0a'+_0x2fd29e(0x10d)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x2fd29e(0x137)}):(_0x2d47e7[_0x2fd29e(0x18f)]&&!_0x2d47e7[_0x2fd29e(0xf2)]&&(await database_1[_0x2fd29e(0x100)]['telegramUser']['update']({'where':{'telegramId':_0x37602a},'data':{'shopId':null,'isVerified':![]}}),console[_0x2fd29e(0xd4)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x37602a)),await this[_0x2fd29e(0x139)]?.['sendMessage'](_0x1538d1,_0x2fd29e(0x165)+_0x2fd29e(0xdb)+_0x2fd29e(0x107)+_0x2fd29e(0x129)+_0x2fd29e(0x154)+_0x2fd29e(0xee),{'parse_mode':_0x2fd29e(0x137)}));}catch(_0x1079cb){console[_0x2fd29e(0xf4)](_0x2fd29e(0xce),_0x1079cb),await this[_0x2fd29e(0x139)]?.[_0x2fd29e(0xdf)](_0x1538d1,_0x2fd29e(0xea));}}),this['bot']['onText'](/\/disconnect/,async _0x10d9ea=>{const _0x6d16c8=_0x479278,_0x4475e8=_0x10d9ea['chat']['id'],_0x43c8bf=_0x10d9ea['from']?.['id'][_0x6d16c8(0x183)]();if(!_0x43c8bf)return;try{const _0x3558ea=await database_1[_0x6d16c8(0x100)][_0x6d16c8(0x133)][_0x6d16c8(0x158)]({'where':{'telegramId':_0x43c8bf},'include':{'shop':!![]}});if(!_0x3558ea||!_0x3558ea[_0x6d16c8(0xf2)]||!_0x3558ea[_0x6d16c8(0x18f)]){await this[_0x6d16c8(0x139)]?.[_0x6d16c8(0xdf)](_0x4475e8,_0x6d16c8(0x13d));return;}const _0x1a719d=_0x3558ea[_0x6d16c8(0x11b)]?.[_0x6d16c8(0x124)]||'unknown\x20shop';await database_1[_0x6d16c8(0x100)]['telegramUser'][_0x6d16c8(0x10e)]({'where':{'telegramId':_0x43c8bf},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔌\x20User\x20'+_0x43c8bf+_0x6d16c8(0x13f)+_0x3558ea[_0x6d16c8(0x18f)]),await this[_0x6d16c8(0x139)]?.[_0x6d16c8(0xdf)](_0x4475e8,_0x6d16c8(0x167)+_0x1a719d+_0x6d16c8(0xe2)+_0x6d16c8(0x11a),{'parse_mode':_0x6d16c8(0x137)});}catch(_0xaf7705){console[_0x6d16c8(0xf4)]('Error\x20handling\x20/disconnect\x20command:',_0xaf7705),await this[_0x6d16c8(0x139)]?.[_0x6d16c8(0xdf)](_0x4475e8,_0x6d16c8(0xea));}}),this['bot']['onText'](/\/status/,async _0x5c6adc=>{const _0x16f338=_0x479278,_0x350bda=_0x5c6adc[_0x16f338(0x181)]['id'],_0x359beb=_0x5c6adc['from']?.['id'][_0x16f338(0x183)]();if(!_0x359beb)return;try{const _0x7ca2d2=await database_1['default']['telegramUser'][_0x16f338(0x158)]({'where':{'telegramId':_0x359beb},'include':{'shop':!![]}});if(!_0x7ca2d2){await this['bot']?.[_0x16f338(0xdf)](_0x350bda,_0x16f338(0x186)+_0x16f338(0x109));return;}if(!_0x7ca2d2['isVerified']||!_0x7ca2d2[_0x16f338(0x18f)]||!_0x7ca2d2['shop']){await this[_0x16f338(0x139)]?.['sendMessage'](_0x350bda,_0x16f338(0x11c)+_0x16f338(0x119));return;}await this['bot']?.[_0x16f338(0xdf)](_0x350bda,_0x16f338(0x14e)+('✅\x20Connected\x20to\x20shop:\x20*'+_0x7ca2d2[_0x16f338(0x11b)][_0x16f338(0x124)]+'*\x0a')+(_0x16f338(0x15b)+_0x7ca2d2[_0x16f338(0x11b)][_0x16f338(0x10c)]+'`\x0a')+(_0x16f338(0x101)+_0x7ca2d2['updatedAt'][_0x16f338(0x160)](_0x16f338(0x155))+'\x0a\x0a')+_0x16f338(0xef)+_0x16f338(0xff)+_0x16f338(0xb9),{'parse_mode':_0x16f338(0x137)});}catch(_0x242c42){console[_0x16f338(0xf4)](_0x16f338(0x150),_0x242c42),await this[_0x16f338(0x139)]?.[_0x16f338(0xdf)](_0x350bda,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot'][_0x479278(0xc0)](/\/debug/,async _0x191458=>{const _0x4cd0bc=_0x479278,_0x1847e7=_0x191458[_0x4cd0bc(0x181)]['id'],_0x1c4e21=_0x191458[_0x4cd0bc(0x118)]?.['id'][_0x4cd0bc(0x183)]();if(!_0x1c4e21)return;try{const _0x1c3a28=await database_1[_0x4cd0bc(0x100)][_0x4cd0bc(0x11b)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x1d8e12='🔍\x20*Debug\x20Information*\x0a\x0a';_0x1d8e12+=_0x4cd0bc(0xe7)+_0x1c4e21+'`\x0a\x0a',_0x1d8e12+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x1c3a28[_0x4cd0bc(0xe8)]((_0x2f45d6,_0xb52b95)=>{const _0x59038a=_0x4cd0bc;_0x1d8e12+=_0xb52b95+0x1+_0x59038a(0xc7)+_0x2f45d6[_0x59038a(0x124)]+'*\x0a',_0x1d8e12+=_0x59038a(0x105)+_0x2f45d6['username']+'`\x0a',_0x1d8e12+=_0x59038a(0xde)+_0x2f45d6[_0x59038a(0x17b)]+'\x0a',_0x1d8e12+=_0x59038a(0x176)+_0x2f45d6[_0x59038a(0x112)][_0x59038a(0xcb)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x4cd0bc(0x139)]?.[_0x4cd0bc(0xdf)](_0x1847e7,_0x1d8e12,{'parse_mode':_0x4cd0bc(0x137)});}catch(_0x1b1db5){console[_0x4cd0bc(0xf4)](_0x4cd0bc(0x147),_0x1b1db5),await this[_0x4cd0bc(0x139)]?.[_0x4cd0bc(0xdf)](_0x1847e7,_0x4cd0bc(0x15c));}}),this[_0x479278(0x139)]['on'](_0x479278(0xb7),async _0x24480f=>{const _0x17cedd=_0x479278;if(_0x24480f['text']?.['startsWith']('/'))return;const _0x5eb1f6=_0x24480f[_0x17cedd(0x181)]['id'],_0xb107f4=_0x24480f['from']?.['id']['toString'](),_0x3208e6=_0x24480f[_0x17cedd(0x11f)]?.[_0x17cedd(0x131)]();if(!_0xb107f4||!_0x3208e6)return;try{const _0x2ae109=await database_1['default'][_0x17cedd(0x133)][_0x17cedd(0x158)]({'where':{'telegramId':_0xb107f4},'include':{'shop':!![]}});if(!_0x2ae109){await this['bot']?.[_0x17cedd(0xdf)](_0x5eb1f6,_0x17cedd(0x13a));return;}if(_0x2ae109[_0x17cedd(0xf2)]&&_0x2ae109['shopId']&&_0x2ae109[_0x17cedd(0x11b)]){await this[_0x17cedd(0x139)]?.[_0x17cedd(0xdf)](_0x5eb1f6,_0x17cedd(0x132)+_0x2ae109[_0x17cedd(0x11b)]['name']+'*.\x0a\x0a'+_0x17cedd(0x173),{'parse_mode':_0x17cedd(0x137)});return;}const _0x4bd5d2=_0x3208e6[_0x17cedd(0xe0)](/\s+/);if(_0x4bd5d2[_0x17cedd(0x102)]!==0x2){await this[_0x17cedd(0x139)]?.[_0x17cedd(0xdf)](_0x5eb1f6,_0x17cedd(0x166)+_0x17cedd(0x107)+_0x17cedd(0x129)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x17cedd(0x12d)+_0x4bd5d2[_0x17cedd(0x102)]+_0x17cedd(0x168)+_0x4bd5d2['map'](_0x4d35a0=>'`'+_0x4d35a0+'`')[_0x17cedd(0x178)](',\x20')),{'parse_mode':_0x17cedd(0x137)});return;}const [_0x3a1b1b,_0x21ee0f]=_0x4bd5d2;console[_0x17cedd(0xd4)](_0x17cedd(0x134)+_0xb107f4+_0x17cedd(0x17f)+_0x3a1b1b+_0x17cedd(0x17e)+_0x21ee0f[_0x17cedd(0xcb)](0x0,0xa)+_0x17cedd(0xc9)),await this[_0x17cedd(0x175)](_0x5eb1f6,_0xb107f4,_0x3a1b1b,_0x21ee0f);}catch(_0x3826b2){console[_0x17cedd(0xf4)]('Error\x20handling\x20message:',_0x3826b2),await this[_0x17cedd(0x139)]?.[_0x17cedd(0xdf)](_0x5eb1f6,_0x17cedd(0xea));}}),this[_0x479278(0x139)]['on'](_0x479278(0xf4),_0x5d3e6b=>{const _0x4b56d5=_0x479278;console[_0x4b56d5(0xf4)]('Telegram\x20bot\x20error:',_0x5d3e6b);}),this[_0x479278(0x139)]['on']('polling_error',_0x3e6e3e=>{const _0x16b116=_0x479278;console['error'](_0x16b116(0x153),_0x3e6e3e);});}async[a53_0x2136dd(0x175)](_0x46a88c,_0x477eb8,_0x1cf0b8,_0x15a19e){const _0x40fb39=a53_0x2136dd;try{console[_0x40fb39(0xd4)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x477eb8+_0x40fb39(0x17f)+_0x1cf0b8+_0x40fb39(0x17e)+_0x15a19e['substring'](0x0,0xa)+_0x40fb39(0xc9));if(!_0x1cf0b8||_0x1cf0b8[_0x40fb39(0x102)]<0x3||_0x1cf0b8['length']>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x1cf0b8)){await this[_0x40fb39(0x139)]?.[_0x40fb39(0xdf)](_0x46a88c,_0x40fb39(0x14a)+_0x1cf0b8+_0x40fb39(0x106)+_0x40fb39(0x12c),{'parse_mode':_0x40fb39(0x137)});return;}if(!_0x15a19e||!_0x15a19e[_0x40fb39(0x16f)](_0x40fb39(0x11e))&&!_0x15a19e[_0x40fb39(0x16f)](_0x40fb39(0xaf))){await this['bot']?.[_0x40fb39(0xdf)](_0x46a88c,_0x40fb39(0xeb)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x40fb39(0x137)});return;}const _0x2b678d=await database_1[_0x40fb39(0x100)][_0x40fb39(0x11b)][_0x40fb39(0x158)]({'where':{'username':_0x1cf0b8},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x2b678d){const _0xbbab90=await database_1[_0x40fb39(0x100)][_0x40fb39(0x11b)][_0x40fb39(0x10a)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x32dece='❌\x20Shop\x20with\x20username\x20`'+_0x1cf0b8+_0x40fb39(0x12a);_0xbbab90[_0x40fb39(0x102)]>0x0?(_0x32dece+=_0x40fb39(0x122),_0xbbab90['forEach'](_0xe765ad=>{const _0x3af550=_0x40fb39;_0x32dece+=_0x3af550(0xf1)+_0xe765ad[_0x3af550(0x10c)]+_0x3af550(0xcd)+_0xe765ad['name']+')\x0a';}),_0x32dece+=_0x40fb39(0x136)):_0x32dece+=_0x40fb39(0xdc);await this['bot']?.['sendMessage'](_0x46a88c,_0x32dece,{'parse_mode':_0x40fb39(0x137)});return;}if(_0x2b678d['status']!==_0x40fb39(0xbe)){await this[_0x40fb39(0x139)]?.[_0x40fb39(0xdf)](_0x46a88c,_0x40fb39(0xda)+_0x1cf0b8+'`\x20is\x20inactive.\x0a\x0a'+_0x40fb39(0x141),{'parse_mode':_0x40fb39(0x137)});return;}if(_0x2b678d[_0x40fb39(0x112)]!==_0x15a19e&&_0x2b678d[_0x40fb39(0xc6)]!==_0x15a19e){await this['bot']?.[_0x40fb39(0xdf)](_0x46a88c,_0x40fb39(0x15d)+_0x1cf0b8+_0x40fb39(0x17d)+_0x40fb39(0xb6)+_0x40fb39(0x17c),{'parse_mode':_0x40fb39(0x137)});return;}const _0x41ea6d=await database_1[_0x40fb39(0x100)][_0x40fb39(0x133)][_0x40fb39(0x15e)]({'where':{'shopId':_0x2b678d['id'],'isVerified':!![],'telegramId':{'not':_0x477eb8}}});if(_0x41ea6d){await this[_0x40fb39(0x139)]?.[_0x40fb39(0xdf)](_0x46a88c,_0x40fb39(0xdd)+_0x1cf0b8+'`.\x0a\x0a'+_0x40fb39(0xe5),{'parse_mode':_0x40fb39(0x137)});return;}await database_1[_0x40fb39(0x100)][_0x40fb39(0x133)][_0x40fb39(0x10e)]({'where':{'telegramId':_0x477eb8},'data':{'shopId':_0x2b678d['id'],'isVerified':!![]}}),await this[_0x40fb39(0x139)]?.['sendMessage'](_0x46a88c,_0x40fb39(0x14f)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('📱\x20Shop:\x20*'+_0x2b678d[_0x40fb39(0x124)]+'*\x0a')+('👤\x20Username:\x20`'+_0x2b678d['username']+'`\x0a\x0a')+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+_0x40fb39(0x10b)+'•\x20Important\x20events\x0a\x0a'+_0x40fb39(0xff)+_0x40fb39(0x10d)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x40fb39(0x137)}),console[_0x40fb39(0xd4)](_0x40fb39(0x177)+_0x477eb8+_0x40fb39(0x103)+_0x2b678d[_0x40fb39(0x10c)]+_0x40fb39(0xf6));}catch(_0x4fc2e1){console[_0x40fb39(0xf4)]('Error\x20in\x20handleSingleLineVerification:',_0x4fc2e1),await this[_0x40fb39(0x139)]?.[_0x40fb39(0xdf)](_0x46a88c,_0x40fb39(0xc3));}}async[a53_0x2136dd(0x156)](_0x582bf6,_0x2e5199,_0x39f8f5){const _0x28e311=a53_0x2136dd;if(!this[_0x28e311(0x139)]){console[_0x28e311(0xfa)](_0x28e311(0xf0));return;}try{const _0x100a22=await database_1[_0x28e311(0x100)][_0x28e311(0x133)][_0x28e311(0x10a)]({'where':{'shopId':_0x582bf6,'isVerified':!![]}});if(_0x100a22[_0x28e311(0x102)]===0x0){console[_0x28e311(0xd4)](_0x28e311(0x15f)+_0x582bf6);return;}const _0x5dcf02=_0x100a22['map'](async _0x182f1f=>{const _0x100806=_0x28e311;try{await this[_0x100806(0x139)]?.[_0x100806(0xdf)](_0x182f1f[_0x100806(0x14c)],_0x2e5199,_0x39f8f5),console['log'](_0x100806(0xe1)+_0x182f1f['telegramId']);}catch(_0x33e60c){console[_0x100806(0xf4)](_0x100806(0x145)+_0x182f1f['telegramId']+':',_0x33e60c),_0x33e60c instanceof Error&&(_0x33e60c[_0x100806(0xb7)]['includes'](_0x100806(0x14b))||_0x33e60c['message']['includes'](_0x100806(0xf8))||_0x33e60c[_0x100806(0xb7)][_0x100806(0x18b)](_0x100806(0x162)))&&(await database_1[_0x100806(0x100)][_0x100806(0x133)]['update']({'where':{'id':_0x182f1f['id']},'data':{'isVerified':![]}}),console[_0x100806(0xd4)](_0x100806(0xc4)+_0x182f1f['telegramId']+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise['allSettled'](_0x5dcf02);}catch(_0x59e738){console[_0x28e311(0xf4)](_0x28e311(0x152),_0x59e738);}}async[a53_0x2136dd(0x163)](_0x502a48,_0x3abd51,_0x49b0e0){const _0x3b1d17=a53_0x2136dd,_0x504850={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x303185={'created':'New\x20payment\x20created','paid':_0x3b1d17(0xb8),'failed':_0x3b1d17(0xb4),'expired':_0x3b1d17(0x110),'refund':_0x3b1d17(0xc1),'chargeback':_0x3b1d17(0xb1),'processing':'Payment\x20is\x20being\x20processed'},_0x1c1fe8=_0x504850[_0x49b0e0],_0x425f0c=_0x303185[_0x49b0e0],_0x454951=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x3abd51[_0x3b1d17(0x169)]);console['log'](_0x3b1d17(0xad)+_0x3abd51[_0x3b1d17(0x169)]+'\x22\x20->\x20display\x20\x22'+_0x454951+'\x22');let _0x4c84eb=_0x1c1fe8+'\x20*'+_0x425f0c+_0x3b1d17(0x159)+('💰\x20Amount:\x20*'+_0x3abd51[_0x3b1d17(0x148)]+'\x20'+_0x3abd51[_0x3b1d17(0x10f)]+'*\x0a')+(_0x3b1d17(0x13e)+(_0x3abd51[_0x3b1d17(0x116)]||_0x3abd51['id'])+'`\x0a')+(_0x3b1d17(0xd2)+_0x3abd51['id']+'`\x0a')+(_0x3b1d17(0x144)+_0x454951+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x3abd51['createdAt'])[_0x3b1d17(0x161)](_0x3b1d17(0x155))+'\x0a');(_0x3abd51[_0x3b1d17(0x16c)]||_0x3abd51[_0x3b1d17(0xec)])&&(_0x4c84eb+=_0x3b1d17(0x125),_0x3abd51['customerName']&&(_0x4c84eb+='📛\x20Name:\x20`'+_0x3abd51[_0x3b1d17(0x16c)]+'`\x0a'),_0x3abd51[_0x3b1d17(0xec)]&&(_0x4c84eb+=_0x3b1d17(0xd1)+_0x3abd51[_0x3b1d17(0xec)]+'`\x0a')),_0x49b0e0===_0x3b1d17(0xc8)&&_0x3abd51[_0x3b1d17(0xbf)]&&(_0x4c84eb+=_0x3b1d17(0xcf)+_0x3abd51['chargebackAmount']+_0x3b1d17(0x15a)),_0x49b0e0===_0x3b1d17(0x143)&&(_0x4c84eb+=_0x3b1d17(0x179)),_0x3abd51[_0x3b1d17(0x130)]&&(_0x4c84eb+=_0x3b1d17(0xb5)+_0x3abd51[_0x3b1d17(0x130)]+'\x0a'),await this[_0x3b1d17(0x156)](_0x502a48,_0x4c84eb,{'parse_mode':'Markdown'});}async[a53_0x2136dd(0xf9)](_0x556beb,_0x145821,_0x48acc4){const _0x4518c4=a53_0x2136dd,_0x2a7b59={'created':'📤','completed':'✅','rejected':'❌'},_0x3b990c={'created':_0x4518c4(0xba),'completed':_0x4518c4(0x108),'rejected':_0x4518c4(0xb3)},_0x3906c4=_0x2a7b59[_0x48acc4],_0x54d9ef=_0x3b990c[_0x48acc4],_0x14cf2a=_0x3906c4+'\x20*'+_0x54d9ef+_0x4518c4(0x159)+(_0x4518c4(0x138)+_0x145821[_0x4518c4(0x148)]+_0x4518c4(0xe3))+(_0x4518c4(0x174)+_0x145821[_0x4518c4(0x157)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x145821['id']+'`\x0a')+(_0x4518c4(0x16e)+new Date(_0x145821['createdAt'])[_0x4518c4(0x161)]('en-US')+'\x0a')+(_0x145821[_0x4518c4(0xd9)]?_0x4518c4(0x16d)+_0x145821['txid']+'`':'');await this[_0x4518c4(0x156)](_0x556beb,_0x14cf2a,{'parse_mode':_0x4518c4(0x137)});}async[a53_0x2136dd(0x180)](_0x334330,_0x178058){const _0x147214=a53_0x2136dd;try{const _0x3d85f4=await database_1['default'][_0x147214(0x12e)][_0x147214(0x158)]({'where':{'shopId':_0x334330},'select':{'notificationLogin':!![]}});if(!_0x3d85f4?.[_0x147214(0x135)]){console[_0x147214(0xd4)](_0x147214(0xfb)+_0x334330);return;}const _0x42afac=_0x178058[_0x147214(0xd3)]?'🔐':'🚨',_0x46099b=_0x178058['success']?_0x147214(0xbc):_0x147214(0x164);let _0x4ddf35=_0x42afac+'\x20*'+_0x46099b+'*\x0a\x0a'+(_0x147214(0x15b)+_0x178058[_0x147214(0x10c)]+'`\x0a')+(_0x147214(0x151)+_0x178058[_0x147214(0xae)][_0x147214(0x161)](_0x147214(0x155))+'\x0a');_0x178058[_0x147214(0xd8)]&&(_0x4ddf35+=_0x147214(0xc5)+_0x178058[_0x147214(0xd8)]+'`\x0a');if(_0x178058[_0x147214(0x126)]){const _0x420c4f=_0x178058[_0x147214(0x126)]['length']>0x32?_0x178058[_0x147214(0x126)][_0x147214(0xcb)](0x0,0x32)+'...':_0x178058[_0x147214(0x126)];_0x4ddf35+=_0x147214(0xfc)+_0x420c4f+'`\x0a';}!_0x178058['success']&&(_0x4ddf35+=_0x147214(0xfd)),await this[_0x147214(0x156)](_0x334330,_0x4ddf35,{'parse_mode':_0x147214(0x137)}),console[_0x147214(0xd4)](_0x147214(0x115)+_0x334330+':\x20'+(_0x178058['success']?_0x147214(0xd3):_0x147214(0xd7)));}catch(_0xaca82){console[_0x147214(0xf4)](_0x147214(0x170),_0xaca82);}}async['sendApiErrorNotification'](_0x9e6f7a,_0x2c5b32){const _0x387382=a53_0x2136dd;try{const _0x3ebc10=await database_1['default']['shopSettings'][_0x387382(0x158)]({'where':{'shopId':_0x9e6f7a},'select':{'notificationApiError':!![]}});if(!_0x3ebc10?.[_0x387382(0x13c)]){console['log'](_0x387382(0x146)+_0x9e6f7a);return;}let _0x60a068='🚨\x20*API\x20Error*\x0a\x0a'+(_0x387382(0x127)+_0x2c5b32[_0x387382(0x157)]+'\x20'+_0x2c5b32[_0x387382(0x18a)]+'`\x0a')+(_0x387382(0x151)+_0x2c5b32[_0x387382(0xae)][_0x387382(0x161)](_0x387382(0x155))+'\x0a');_0x2c5b32[_0x387382(0xfe)]&&(_0x60a068+=_0x387382(0xb2)+_0x2c5b32['statusCode']+'`\x0a'),_0x60a068+='❌\x20Error:\x20`'+_0x2c5b32[_0x387382(0x104)]+'`\x0a',_0x2c5b32['requestId']&&(_0x60a068+=_0x387382(0x14d)+_0x2c5b32[_0x387382(0x149)]+'`\x0a'),_0x60a068+=_0x387382(0xd6),await this[_0x387382(0x156)](_0x9e6f7a,_0x60a068,{'parse_mode':_0x387382(0x137)}),console['log']('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x9e6f7a+':\x20'+_0x2c5b32[_0x387382(0x18a)]);}catch(_0x26ec3){console[_0x387382(0xf4)](_0x387382(0xac),_0x26ec3);}}async['sendCustomNotification'](_0xc8ab4f,_0x535ae2,_0x589918){const _0x211d83=a53_0x2136dd;let _0x97fda4=_0x211d83(0x182)+_0x535ae2+_0x211d83(0x159);for(const [_0x32fa3b,_0x5d2aa9]of Object['entries'](_0x589918)){_0x5d2aa9!==null&&_0x5d2aa9!==undefined&&(_0x97fda4+=_0x32fa3b+_0x211d83(0x13b)+_0x5d2aa9+'`\x0a');}await this[_0x211d83(0x156)](_0xc8ab4f,_0x97fda4,{'parse_mode':_0x211d83(0x137)});}[a53_0x2136dd(0xe9)](){const _0x1bd06f=a53_0x2136dd;return{'isActive':!!this[_0x1bd06f(0x139)],'username':this[_0x1bd06f(0x16a)]};}[a53_0x2136dd(0x18d)](){const _0x556512=a53_0x2136dd;this[_0x556512(0x139)]&&(this[_0x556512(0x139)][_0x556512(0xca)](),this[_0x556512(0x139)]=null,console['log'](_0x556512(0x171)));}}exports[a53_0x2136dd(0xe6)]=TelegramBotService,exports[a53_0x2136dd(0x12f)]=new TelegramBotService();