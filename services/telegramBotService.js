'use strict';const a55_0x343c55=a55_0x5bf6;function a55_0x402d(){const _0x3b88f3=['Payment\x20chargeback','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','sendShopNotification','🏪\x20Available\x20shops\x20in\x20system:\x0a','\x20via\x20single-line\x20input','length','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','108094CvpNKV','en-US','polling_error','🏦\x20IBAN:\x20`','📅\x20Date:\x20','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','New\x20payout\x20created','split','stopPolling','create','__esModule','📧\x20Email:\x20`','*.\x0a\x0a','chargeback','❌\x20Error:\x20`','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','requestId','•\x20Important\x20events\x0a\x0a','\x20\x20\x20Status:\x20','botUsername','🛑\x20Telegram\x20bot\x20stopped','Username:\x20`','telegramUser','sendMessage','__importDefault','success','secretKey','createdAt','remitterIban','shopId','notificationLogin','.\x20*','orderId','Contact\x20administrator.','📅\x20Connection\x20date:\x20','...\x22','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','from','`\x0a\x0a','45gkhhDf','log','14203776ghaVgI','Successful\x20login','failed','•\x20New\x20payments\x0a','method','🎉\x20*Congratulations!*\x0a\x0a','/disconnect\x20-\x20disconnect\x20from\x20notifications','publicKey','📱\x20Your\x20Telegram\x20ID:\x20`','...','amount','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20',':\x20username=\x22','userAgent','forEach','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','👤\x20Username:\x20`','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','TelegramBotService','🌐\x20IP\x20address:\x20`','updatedAt','🆔\x20Payout\x20ID:\x20`','trapay_bot','🌐\x20IP:\x20`','❌\x20Invalid\x20username\x20format:\x20`','\x22\x20->\x20display\x20\x22','startsWith','\x20initialized\x20successfully','Payout\x20completed','🔗\x20Endpoint:\x20`','customerIp','📊\x20*Connection\x20Status*\x0a\x0a','📱\x20Shop:\x20*','/status\x20-\x20check\x20connection\x20status\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Error\x20handling\x20/status\x20command:','shopSettings','Failed\x20to\x20send\x20login\x20notification:','Payout\x20rejected','TELEGRAM_BOT_USERNAME','defineProperty','Example:\x0a','Payment\x20expired','🔌\x20User\x20','Error\x20handling\x20/debug\x20command:','notificationApiError','setupBotHandlers','📱\x20Created\x20new\x20Telegram\x20user:\x20','errorMessage','substring','findFirst','includes','Commands:\x0a','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','../config/database','message','Error\x20handling\x20/start\x20command:','ipAddress','Failed\x20to\x20send\x20API\x20error\x20notification:','pk_','\x20USDT*\x0a','Use\x20/start\x20to\x20begin.','\x20disconnected\x20from\x20shop\x20','handleSingleLineVerification','test','Payment\x20failed','customerUa','trim','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','chat','1073140LgVpkT','toString','stopBot','isVerified','user\x20is\x20deactivated','You\x20sent\x20','ACTIVE','✅\x20Telegram\x20bot\x20@','sendPayoutNotification','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','getGatewayDisplayNameForTelegram','statusCode','`.\x0a\x0a','customerEmail','📊\x20Error\x20code:\x20`','Markdown','Error\x20sending\x20shop\x20notification:','bot','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Error\x20handling\x20/disconnect\x20command:','•\x20Payouts\x0a','*\x0a\x0a','processing','642qiLkqY','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','Payment\x20is\x20being\x20processed','Failed\x20login\x20attempt','339170xiQaaF','🔗\x20TXID:\x20`','Payment\x20successfully\x20paid','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','Check\x20spelling\x20and\x20try\x20again.','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','error','telegramId','🆔\x20Request\x20ID:\x20`','🏪\x20Gateway:\x20`','❌\x20Error\x20getting\x20debug\x20information.','txid','❌\x20Shop\x20with\x20username\x20`','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','3oPmTIx','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','❌\x20Please\x20use\x20/start\x20command\x20first','sendApiErrorNotification','💻\x20Browser:\x20`','656092sYpMIO','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','env','✅\x20Welcome\x20back!\x0a\x0a','toLocaleString','botToken','text','allSettled','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','`\x20(','telegramBotService','50395NlWBNp','endpoint','\x0aCheck\x20spelling\x20and\x20try\x20again.','Available\x20usernames:\x0a','findUnique','\x20(@','28IwIBWB','🔔\x20*','•\x20`','\x20\x20\x20Username:\x20`','📝\x20Order\x20ID:\x20`','../types/gateway','status','node-telegram-bot-api','✅\x20Telegram\x20user\x20','shop','...`\x0a\x0a','onText','customerName','findMany','`\x20not\x20found.\x0a\x0a','join','initializeBot','Error\x20in\x20handleSingleLineVerification:','12YYgbrF','1763883xNDLlR','name','adminNotes','🔍\x20*Debug\x20Information*\x0a\x0a','To\x20reconnect,\x20use\x20the\x20/start\x20command','default','timestamp','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','\x22,\x20apiKey=\x22','📝\x20Notes:\x20','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','update','entries','💸\x20Amount:\x20*','🔔\x20Notifications\x20are\x20active\x0a\x0a','📅\x20Time:\x20','•\x20Payment\x20status\x20changes\x0a','first_name','warn','TELEGRAM_BOT_TOKEN','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','map','getBotInfo','username'];a55_0x402d=function(){return _0x3b88f3;};return a55_0x402d();}function a55_0x5bf6(_0x27cc89,_0x370f56){const _0x402d04=a55_0x402d();return a55_0x5bf6=function(_0x5bf6f9,_0x1c7e3f){_0x5bf6f9=_0x5bf6f9-0xa6;let _0x41561b=_0x402d04[_0x5bf6f9];return _0x41561b;},a55_0x5bf6(_0x27cc89,_0x370f56);}(function(_0x31c5e2,_0x48740d){const _0x46361d=a55_0x5bf6,_0x46a064=_0x31c5e2();while(!![]){try{const _0x15be9b=parseInt(_0x46361d(0x17a))/0x1+-parseInt(_0x46361d(0xc4))/0x2*(parseInt(_0x46361d(0xbf))/0x3)+parseInt(_0x46361d(0xd6))/0x4*(parseInt(_0x46361d(0xd0))/0x5)+-parseInt(_0x46361d(0xad))/0x6*(parseInt(_0x46361d(0x109))/0x7)+parseInt(_0x46361d(0x133))/0x8+-parseInt(_0x46361d(0x131))/0x9*(parseInt(_0x46361d(0xb1))/0xa)+parseInt(_0x46361d(0xe9))/0xb*(parseInt(_0x46361d(0xe8))/0xc);if(_0x15be9b===_0x48740d)break;else _0x46a064['push'](_0x46a064['shift']());}catch(_0x233c42){_0x46a064['push'](_0x46a064['shift']());}}}(a55_0x402d,0xe2f39));var __importDefault=this&&this[a55_0x343c55(0x121)]||function(_0x1f7f4d){const _0x4e3aea=a55_0x343c55;return _0x1f7f4d&&_0x1f7f4d[_0x4e3aea(0x113)]?_0x1f7f4d:{'default':_0x1f7f4d};};Object[a55_0x343c55(0x15c)](exports,a55_0x343c55(0x113),{'value':!![]}),exports[a55_0x343c55(0xcf)]=exports[a55_0x343c55(0x146)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a55_0x343c55(0xdd))),database_1=__importDefault(require(a55_0x343c55(0x16a))),gateway_1=require(a55_0x343c55(0xdb));class TelegramBotService{constructor(){const _0x194f65=a55_0x343c55;this['bot']=null,this[_0x194f65(0xca)]=process[_0x194f65(0xc7)][_0x194f65(0xfc)]||'',this[_0x194f65(0x11c)]=process['env'][_0x194f65(0x15b)]||_0x194f65(0x14a),this[_0x194f65(0xca)]?this['initializeBot']():console[_0x194f65(0xfb)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a55_0x343c55(0xe6)](){const _0x25f124=a55_0x343c55;try{this['bot']=new node_telegram_bot_api_1['default'](this['botToken'],{'polling':!![]}),this['setupBotHandlers'](),console[_0x25f124(0x132)](_0x25f124(0x181)+this[_0x25f124(0x11c)]+_0x25f124(0x14f));}catch(_0x439455){console[_0x25f124(0xb7)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x439455);}}[a55_0x343c55(0x162)](){const _0x22d58b=a55_0x343c55;if(!this['bot'])return;this[_0x22d58b(0xa7)][_0x22d58b(0xe1)](/\/start/,async _0x531108=>{const _0x50ad6b=_0x22d58b,_0x60856e=_0x531108[_0x50ad6b(0x179)]['id'],_0x45eab7=_0x531108['from']?.['id'][_0x50ad6b(0x17b)](),_0x2a78e1=_0x531108[_0x50ad6b(0x12f)]?.['username'],_0x2a00fe=_0x531108['from']?.[_0x50ad6b(0xfa)],_0xff73db=_0x531108[_0x50ad6b(0x12f)]?.['last_name'];if(!_0x45eab7)return;try{let _0x2771b3=await database_1[_0x50ad6b(0xee)]['telegramUser'][_0x50ad6b(0xd4)]({'where':{'telegramId':_0x45eab7},'include':{'shop':!![]}});!_0x2771b3?(_0x2771b3=await database_1[_0x50ad6b(0xee)]['telegramUser'][_0x50ad6b(0x112)]({'data':{'telegramId':_0x45eab7,'username':_0x2a78e1,'firstName':_0x2a00fe,'lastName':_0xff73db,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x50ad6b(0x132)](_0x50ad6b(0x163)+_0x45eab7+_0x50ad6b(0xd5)+_0x2a78e1+')')):_0x2771b3=await database_1[_0x50ad6b(0xee)][_0x50ad6b(0x11f)][_0x50ad6b(0xf4)]({'where':{'telegramId':_0x45eab7},'data':{'username':_0x2a78e1,'firstName':_0x2a00fe,'lastName':_0xff73db},'include':{'shop':!![]}}),_0x2771b3['isVerified']&&_0x2771b3[_0x50ad6b(0x126)]&&_0x2771b3[_0x50ad6b(0xdf)]?await this[_0x50ad6b(0xa7)]?.[_0x50ad6b(0x120)](_0x60856e,_0x50ad6b(0xc8)+(_0x50ad6b(0xc6)+_0x2771b3[_0x50ad6b(0xdf)][_0x50ad6b(0xea)]+'*\x0a')+(_0x50ad6b(0x11e)+_0x2771b3[_0x50ad6b(0xdf)][_0x50ad6b(0x101)]+_0x50ad6b(0x130))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x50ad6b(0x136)+_0x50ad6b(0xf9)+'•\x20Payouts\x0a\x0a'+_0x50ad6b(0x168)+_0x50ad6b(0x155)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}):(_0x2771b3[_0x50ad6b(0x126)]&&!_0x2771b3[_0x50ad6b(0x17d)]&&(await database_1['default']['telegramUser'][_0x50ad6b(0xf4)]({'where':{'telegramId':_0x45eab7},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x50ad6b(0x145)+_0x45eab7)),await this[_0x50ad6b(0xa7)]?.[_0x50ad6b(0x120)](_0x60856e,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x50ad6b(0x103)+_0x50ad6b(0xa8)+_0x50ad6b(0x15d)+_0x50ad6b(0xf0)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x50ad6b(0x189)}));}catch(_0x570140){console[_0x50ad6b(0xb7)](_0x50ad6b(0x16c),_0x570140),await this[_0x50ad6b(0xa7)]?.[_0x50ad6b(0x120)](_0x60856e,_0x50ad6b(0x10e));}}),this[_0x22d58b(0xa7)][_0x22d58b(0xe1)](/\/disconnect/,async _0x3d0aa8=>{const _0x3a85bc=_0x22d58b,_0xaf6595=_0x3d0aa8[_0x3a85bc(0x179)]['id'],_0x47cf40=_0x3d0aa8[_0x3a85bc(0x12f)]?.['id'][_0x3a85bc(0x17b)]();if(!_0x47cf40)return;try{const _0x4dd2d3=await database_1['default'][_0x3a85bc(0x11f)][_0x3a85bc(0xd4)]({'where':{'telegramId':_0x47cf40},'include':{'shop':!![]}});if(!_0x4dd2d3||!_0x4dd2d3[_0x3a85bc(0x17d)]||!_0x4dd2d3[_0x3a85bc(0x126)]){await this[_0x3a85bc(0xa7)]?.[_0x3a85bc(0x120)](_0xaf6595,_0x3a85bc(0x12e));return;}const _0x108859=_0x4dd2d3[_0x3a85bc(0xdf)]?.[_0x3a85bc(0xea)]||'unknown\x20shop';await database_1[_0x3a85bc(0xee)][_0x3a85bc(0x11f)][_0x3a85bc(0xf4)]({'where':{'telegramId':_0x47cf40},'data':{'shopId':null,'isVerified':![]}}),console[_0x3a85bc(0x132)](_0x3a85bc(0x15f)+_0x47cf40+_0x3a85bc(0x172)+_0x4dd2d3[_0x3a85bc(0x126)]),await this[_0x3a85bc(0xa7)]?.[_0x3a85bc(0x120)](_0xaf6595,_0x3a85bc(0x12d)+_0x108859+'*.\x0a\x0a'+_0x3a85bc(0xed),{'parse_mode':'Markdown'});}catch(_0x571ef6){console['error'](_0x3a85bc(0xa9),_0x571ef6),await this['bot']?.['sendMessage'](_0xaf6595,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x22d58b(0xa7)]['onText'](/\/status/,async _0x3fb587=>{const _0x227acb=_0x22d58b,_0x12ea33=_0x3fb587[_0x227acb(0x179)]['id'],_0x4e7c4b=_0x3fb587[_0x227acb(0x12f)]?.['id'][_0x227acb(0x17b)]();if(!_0x4e7c4b)return;try{const _0x29b16b=await database_1['default']['telegramUser']['findUnique']({'where':{'telegramId':_0x4e7c4b},'include':{'shop':!![]}});if(!_0x29b16b){await this[_0x227acb(0xa7)]?.[_0x227acb(0x120)](_0x12ea33,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x227acb(0x171));return;}if(!_0x29b16b[_0x227acb(0x17d)]||!_0x29b16b[_0x227acb(0x126)]||!_0x29b16b[_0x227acb(0xdf)]){await this['bot']?.[_0x227acb(0x120)](_0x12ea33,_0x227acb(0x178)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x227acb(0xa7)]?.['sendMessage'](_0x12ea33,_0x227acb(0x153)+('✅\x20Connected\x20to\x20shop:\x20*'+_0x29b16b[_0x227acb(0xdf)][_0x227acb(0xea)]+'*\x0a')+(_0x227acb(0x144)+_0x29b16b[_0x227acb(0xdf)]['username']+'`\x0a')+(_0x227acb(0x12b)+_0x29b16b[_0x227acb(0x148)]['toLocaleDateString'](_0x227acb(0x10a))+'\x0a\x0a')+_0x227acb(0xf7)+_0x227acb(0x168)+_0x227acb(0x139),{'parse_mode':_0x227acb(0x189)});}catch(_0x18e4c3){console[_0x227acb(0xb7)](_0x227acb(0x157),_0x18e4c3),await this[_0x227acb(0xa7)]?.['sendMessage'](_0x12ea33,_0x227acb(0x10e));}}),this[_0x22d58b(0xa7)][_0x22d58b(0xe1)](/\/debug/,async _0x577282=>{const _0x4a1a44=_0x22d58b,_0x332a24=_0x577282['chat']['id'],_0x2b0eb4=_0x577282[_0x4a1a44(0x12f)]?.['id']['toString']();if(!_0x2b0eb4)return;try{const _0x275acc=await database_1[_0x4a1a44(0xee)][_0x4a1a44(0xdf)][_0x4a1a44(0xe3)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x3c7425=_0x4a1a44(0xec);_0x3c7425+=_0x4a1a44(0x13b)+_0x2b0eb4+_0x4a1a44(0x130),_0x3c7425+=_0x4a1a44(0x105),_0x275acc[_0x4a1a44(0x141)]((_0x259068,_0x17945d)=>{const _0x48bea8=_0x4a1a44;_0x3c7425+=_0x17945d+0x1+_0x48bea8(0x128)+_0x259068['name']+'*\x0a',_0x3c7425+=_0x48bea8(0xd9)+_0x259068[_0x48bea8(0x101)]+'`\x0a',_0x3c7425+=_0x48bea8(0x11b)+_0x259068[_0x48bea8(0xdc)]+'\x0a',_0x3c7425+='\x20\x20\x20Public\x20Key:\x20`'+_0x259068['publicKey'][_0x48bea8(0x165)](0x0,0xf)+_0x48bea8(0xe0);}),await this[_0x4a1a44(0xa7)]?.[_0x4a1a44(0x120)](_0x332a24,_0x3c7425,{'parse_mode':'Markdown'});}catch(_0x8afb46){console[_0x4a1a44(0xb7)](_0x4a1a44(0x160),_0x8afb46),await this['bot']?.[_0x4a1a44(0x120)](_0x332a24,_0x4a1a44(0xbb));}}),this[_0x22d58b(0xa7)]['on'](_0x22d58b(0x16b),async _0xcd72c7=>{const _0x512e5d=_0x22d58b;if(_0xcd72c7[_0x512e5d(0xcb)]?.[_0x512e5d(0x14e)]('/'))return;const _0x656fcb=_0xcd72c7[_0x512e5d(0x179)]['id'],_0x5bcce4=_0xcd72c7['from']?.['id']['toString'](),_0xb8d9d2=_0xcd72c7[_0x512e5d(0xcb)]?.[_0x512e5d(0x177)]();if(!_0x5bcce4||!_0xb8d9d2)return;try{const _0x5342a1=await database_1[_0x512e5d(0xee)][_0x512e5d(0x11f)][_0x512e5d(0xd4)]({'where':{'telegramId':_0x5bcce4},'include':{'shop':!![]}});if(!_0x5342a1){await this[_0x512e5d(0xa7)]?.[_0x512e5d(0x120)](_0x656fcb,_0x512e5d(0xc1));return;}if(_0x5342a1[_0x512e5d(0x17d)]&&_0x5342a1[_0x512e5d(0x126)]&&_0x5342a1['shop']){await this[_0x512e5d(0xa7)]?.[_0x512e5d(0x120)](_0x656fcb,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x5342a1[_0x512e5d(0xdf)][_0x512e5d(0xea)]+_0x512e5d(0x115)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x512e5d(0x189)});return;}const _0x158f27=_0xb8d9d2[_0x512e5d(0x110)](/\s+/);if(_0x158f27[_0x512e5d(0x107)]!==0x2){await this[_0x512e5d(0xa7)]?.[_0x512e5d(0x120)](_0x656fcb,_0x512e5d(0xb6)+_0x512e5d(0xa8)+_0x512e5d(0x15d)+_0x512e5d(0xf0)+(_0x512e5d(0x17f)+_0x158f27[_0x512e5d(0x107)]+'\x20parts:\x20'+_0x158f27['map'](_0x1bf883=>'`'+_0x1bf883+'`')[_0x512e5d(0xe5)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x16413a,_0x1a429c]=_0x158f27;console[_0x512e5d(0x132)](_0x512e5d(0xc0)+_0x5bcce4+_0x512e5d(0x13f)+_0x16413a+'\x22,\x20apiKey=\x22'+_0x1a429c[_0x512e5d(0x165)](0x0,0xa)+_0x512e5d(0x12c)),await this[_0x512e5d(0x173)](_0x656fcb,_0x5bcce4,_0x16413a,_0x1a429c);}catch(_0x277d14){console[_0x512e5d(0xb7)]('Error\x20handling\x20message:',_0x277d14),await this[_0x512e5d(0xa7)]?.[_0x512e5d(0x120)](_0x656fcb,_0x512e5d(0x10e));}}),this[_0x22d58b(0xa7)]['on'](_0x22d58b(0xb7),_0x5491b8=>{const _0x1b50e7=_0x22d58b;console[_0x1b50e7(0xb7)]('Telegram\x20bot\x20error:',_0x5491b8);}),this[_0x22d58b(0xa7)]['on'](_0x22d58b(0x10b),_0x3bc1c8=>{const _0x7e3f14=_0x22d58b;console[_0x7e3f14(0xb7)]('Telegram\x20bot\x20polling\x20error:',_0x3bc1c8);});}async[a55_0x343c55(0x173)](_0x2e3e54,_0x345bec,_0x2d9e05,_0x19302d){const _0x4bfe11=a55_0x343c55;try{console[_0x4bfe11(0x132)](_0x4bfe11(0xc0)+_0x345bec+_0x4bfe11(0x13f)+_0x2d9e05+_0x4bfe11(0xf1)+_0x19302d['substring'](0x0,0xa)+_0x4bfe11(0x12c));if(!_0x2d9e05||_0x2d9e05[_0x4bfe11(0x107)]<0x3||_0x2d9e05[_0x4bfe11(0x107)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x4bfe11(0x174)](_0x2d9e05)){await this[_0x4bfe11(0xa7)]?.['sendMessage'](_0x2e3e54,_0x4bfe11(0x14c)+_0x2d9e05+_0x4bfe11(0x130)+_0x4bfe11(0xb4),{'parse_mode':_0x4bfe11(0x189)});return;}if(!_0x19302d||!_0x19302d[_0x4bfe11(0x14e)](_0x4bfe11(0x16f))&&!_0x19302d['startsWith']('sk_')){await this[_0x4bfe11(0xa7)]?.[_0x4bfe11(0x120)](_0x2e3e54,_0x4bfe11(0xbe)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x4bfe11(0x189)});return;}const _0x5ac785=await database_1[_0x4bfe11(0xee)][_0x4bfe11(0xdf)][_0x4bfe11(0xd4)]({'where':{'username':_0x2d9e05},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x5ac785){const _0x236959=await database_1[_0x4bfe11(0xee)][_0x4bfe11(0xdf)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x175216=_0x4bfe11(0xbd)+_0x2d9e05+_0x4bfe11(0xe4);_0x236959[_0x4bfe11(0x107)]>0x0?(_0x175216+=_0x4bfe11(0xd3),_0x236959['forEach'](_0x4a9c81=>{const _0x4042f7=_0x4bfe11;_0x175216+=_0x4042f7(0xd8)+_0x4a9c81[_0x4042f7(0x101)]+_0x4042f7(0xce)+_0x4a9c81[_0x4042f7(0xea)]+')\x0a';}),_0x175216+=_0x4bfe11(0xd2)):_0x175216+=_0x4bfe11(0xb5);await this[_0x4bfe11(0xa7)]?.[_0x4bfe11(0x120)](_0x2e3e54,_0x175216,{'parse_mode':_0x4bfe11(0x189)});return;}if(_0x5ac785[_0x4bfe11(0xdc)]!==_0x4bfe11(0x180)){await this[_0x4bfe11(0xa7)]?.[_0x4bfe11(0x120)](_0x2e3e54,'❌\x20Shop\x20`'+_0x2d9e05+'`\x20is\x20inactive.\x0a\x0a'+_0x4bfe11(0x12a),{'parse_mode':_0x4bfe11(0x189)});return;}if(_0x5ac785[_0x4bfe11(0x13a)]!==_0x19302d&&_0x5ac785[_0x4bfe11(0x123)]!==_0x19302d){await this[_0x4bfe11(0xa7)]?.[_0x4bfe11(0x120)](_0x2e3e54,_0x4bfe11(0x118)+_0x2d9e05+_0x4bfe11(0x186)+_0x4bfe11(0x142)+_0x4bfe11(0x108),{'parse_mode':_0x4bfe11(0x189)});return;}const _0x1a07c8=await database_1[_0x4bfe11(0xee)]['telegramUser'][_0x4bfe11(0x166)]({'where':{'shopId':_0x5ac785['id'],'isVerified':!![],'telegramId':{'not':_0x345bec}}});if(_0x1a07c8){await this[_0x4bfe11(0xa7)]?.[_0x4bfe11(0x120)](_0x2e3e54,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x2d9e05+_0x4bfe11(0x186)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x4bfe11(0x189)});return;}await database_1['default'][_0x4bfe11(0x11f)][_0x4bfe11(0xf4)]({'where':{'telegramId':_0x345bec},'data':{'shopId':_0x5ac785['id'],'isVerified':!![]}}),await this[_0x4bfe11(0xa7)]?.['sendMessage'](_0x2e3e54,_0x4bfe11(0x138)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x4bfe11(0x154)+_0x5ac785[_0x4bfe11(0xea)]+'*\x0a')+(_0x4bfe11(0x144)+_0x5ac785[_0x4bfe11(0x101)]+_0x4bfe11(0x130))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x4bfe11(0x136)+_0x4bfe11(0xf9)+_0x4bfe11(0xaa)+_0x4bfe11(0x11a)+_0x4bfe11(0x168)+_0x4bfe11(0x155)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}),console[_0x4bfe11(0x132)](_0x4bfe11(0xde)+_0x345bec+'\x20verified\x20for\x20shop\x20'+_0x5ac785['username']+_0x4bfe11(0x106));}catch(_0x4a7f0e){console[_0x4bfe11(0xb7)](_0x4bfe11(0xe7),_0x4a7f0e),await this['bot']?.['sendMessage'](_0x2e3e54,_0x4bfe11(0x156));}}async[a55_0x343c55(0x104)](_0xd640ee,_0x565e2c,_0x3a6bd3){const _0x59fa27=a55_0x343c55;if(!this[_0x59fa27(0xa7)]){console['warn']('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x4a33b0=await database_1['default'][_0x59fa27(0x11f)][_0x59fa27(0xe3)]({'where':{'shopId':_0xd640ee,'isVerified':!![]}});if(_0x4a33b0[_0x59fa27(0x107)]===0x0){console[_0x59fa27(0x132)](_0x59fa27(0xcd)+_0xd640ee);return;}const _0x57dc03=_0x4a33b0[_0x59fa27(0xff)](async _0xb93334=>{const _0x1fcaa8=_0x59fa27;try{await this[_0x1fcaa8(0xa7)]?.[_0x1fcaa8(0x120)](_0xb93334['telegramId'],_0x565e2c,_0x3a6bd3),console['log']('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0xb93334[_0x1fcaa8(0xb8)]);}catch(_0x6a4349){console['error'](_0x1fcaa8(0x169)+_0xb93334[_0x1fcaa8(0xb8)]+':',_0x6a4349),_0x6a4349 instanceof Error&&(_0x6a4349[_0x1fcaa8(0x16b)][_0x1fcaa8(0x167)]('blocked')||_0x6a4349[_0x1fcaa8(0x16b)][_0x1fcaa8(0x167)]('chat\x20not\x20found')||_0x6a4349['message']['includes'](_0x1fcaa8(0x17e)))&&(await database_1[_0x1fcaa8(0xee)]['telegramUser']['update']({'where':{'id':_0xb93334['id']},'data':{'isVerified':![]}}),console[_0x1fcaa8(0x132)]('User\x20'+_0xb93334[_0x1fcaa8(0xb8)]+_0x1fcaa8(0x183)));}});await Promise[_0x59fa27(0xcc)](_0x57dc03);}catch(_0x4eb7f7){console[_0x59fa27(0xb7)](_0x59fa27(0xa6),_0x4eb7f7);}}async['sendPaymentNotification'](_0x1349cb,_0x51efce,_0x58f87c){const _0x308872=a55_0x343c55,_0x3af1ba={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x52709b={'created':'New\x20payment\x20created','paid':_0x308872(0xb3),'failed':_0x308872(0x175),'expired':_0x308872(0x15e),'refund':'Payment\x20refund','chargeback':_0x308872(0x102),'processing':_0x308872(0xaf)},_0x313d47=_0x3af1ba[_0x58f87c],_0xb5ae14=_0x52709b[_0x58f87c],_0x55877c=(0x0,gateway_1[_0x308872(0x184)])(_0x51efce['gateway']);console[_0x308872(0x132)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x51efce['gateway']+_0x308872(0x14d)+_0x55877c+'\x22');let _0x4ef315=_0x313d47+'\x20*'+_0xb5ae14+_0x308872(0xab)+('💰\x20Amount:\x20*'+_0x51efce[_0x308872(0x13d)]+'\x20'+_0x51efce['currency']+'*\x0a')+(_0x308872(0xda)+(_0x51efce[_0x308872(0x129)]||_0x51efce['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x51efce['id']+'`\x0a')+(_0x308872(0xba)+_0x55877c+'`\x0a')+(_0x308872(0x10d)+new Date(_0x51efce['createdAt'])[_0x308872(0xc9)](_0x308872(0x10a))+'\x0a');if(_0x51efce[_0x308872(0xe2)]||_0x51efce['customerEmail']||_0x51efce[_0x308872(0x125)]||_0x51efce['customerIp']||_0x51efce[_0x308872(0x176)]){_0x4ef315+='\x0a👤\x20*Customer\x20Information:*\x0a';_0x51efce['customerName']&&(_0x4ef315+='📛\x20Name:\x20`'+_0x51efce[_0x308872(0xe2)]+'`\x0a');_0x51efce['customerEmail']&&(_0x4ef315+=_0x308872(0x114)+_0x51efce[_0x308872(0x187)]+'`\x0a');_0x51efce[_0x308872(0x125)]&&(_0x4ef315+=_0x308872(0x10c)+_0x51efce[_0x308872(0x125)]+'`\x0a');_0x51efce[_0x308872(0x152)]&&(_0x4ef315+=_0x308872(0x14b)+_0x51efce[_0x308872(0x152)]+'`\x0a');if(_0x51efce[_0x308872(0x176)]){const _0x2d1d16=_0x51efce[_0x308872(0x176)]['length']>0x32?_0x51efce[_0x308872(0x176)][_0x308872(0x165)](0x0,0x32)+_0x308872(0x13c):_0x51efce['customerUa'];_0x4ef315+=_0x308872(0xc3)+_0x2d1d16+'`\x0a';}}_0x58f87c===_0x308872(0x116)&&_0x51efce['chargebackAmount']&&(_0x4ef315+='💸\x20Penalty\x20amount:\x20*'+_0x51efce['chargebackAmount']+_0x308872(0x170)),_0x58f87c===_0x308872(0xac)&&(_0x4ef315+=_0x308872(0xfe)),_0x51efce[_0x308872(0xeb)]&&(_0x4ef315+=_0x308872(0xf2)+_0x51efce['adminNotes']+'\x0a'),await this[_0x308872(0x104)](_0x1349cb,_0x4ef315,{'parse_mode':_0x308872(0x189)});}async[a55_0x343c55(0x182)](_0x23ae40,_0x48cdf3,_0x58a01b){const _0xff866b=a55_0x343c55,_0x14124e={'created':'📤','completed':'✅','rejected':'❌'},_0x3abe56={'created':_0xff866b(0x10f),'completed':_0xff866b(0x150),'rejected':_0xff866b(0x15a)},_0x23319c=_0x14124e[_0x58a01b],_0x3fa4b0=_0x3abe56[_0x58a01b],_0x26d7f8=_0x23319c+'\x20*'+_0x3fa4b0+'*\x0a\x0a'+(_0xff866b(0xf6)+_0x48cdf3['amount']+'\x20USD*\x0a')+('🏦\x20Method:\x20`'+_0x48cdf3[_0xff866b(0x137)]+'`\x0a')+(_0xff866b(0x149)+_0x48cdf3['id']+'`\x0a')+(_0xff866b(0x10d)+new Date(_0x48cdf3[_0xff866b(0x124)])[_0xff866b(0xc9)](_0xff866b(0x10a))+'\x0a')+(_0x48cdf3[_0xff866b(0xbc)]?_0xff866b(0xb2)+_0x48cdf3[_0xff866b(0xbc)]+'`':'');await this['sendShopNotification'](_0x23ae40,_0x26d7f8,{'parse_mode':'Markdown'});}async['sendLoginNotification'](_0x5248ef,_0x4fc57a){const _0x288ab2=a55_0x343c55;try{const _0x34caa1=await database_1[_0x288ab2(0xee)][_0x288ab2(0x158)][_0x288ab2(0xd4)]({'where':{'shopId':_0x5248ef},'select':{'notificationLogin':!![]}});if(!_0x34caa1?.[_0x288ab2(0x127)]){console[_0x288ab2(0x132)](_0x288ab2(0xfd)+_0x5248ef);return;}const _0x2bb533=_0x4fc57a[_0x288ab2(0x122)]?'🔐':'🚨',_0x53ab8a=_0x4fc57a[_0x288ab2(0x122)]?_0x288ab2(0x134):_0x288ab2(0xb0);let _0x3ee064=_0x2bb533+'\x20*'+_0x53ab8a+'*\x0a\x0a'+(_0x288ab2(0x144)+_0x4fc57a['username']+'`\x0a')+(_0x288ab2(0xf8)+_0x4fc57a[_0x288ab2(0xef)][_0x288ab2(0xc9)](_0x288ab2(0x10a))+'\x0a');_0x4fc57a[_0x288ab2(0x16d)]&&(_0x3ee064+=_0x288ab2(0x147)+_0x4fc57a[_0x288ab2(0x16d)]+'`\x0a');if(_0x4fc57a[_0x288ab2(0x140)]){const _0x27b107=_0x4fc57a[_0x288ab2(0x140)][_0x288ab2(0x107)]>0x32?_0x4fc57a[_0x288ab2(0x140)]['substring'](0x0,0x32)+_0x288ab2(0x13c):_0x4fc57a[_0x288ab2(0x140)];_0x3ee064+=_0x288ab2(0xc3)+_0x27b107+'`\x0a';}!_0x4fc57a['success']&&(_0x3ee064+=_0x288ab2(0x143)),await this['sendShopNotification'](_0x5248ef,_0x3ee064,{'parse_mode':'Markdown'}),console[_0x288ab2(0x132)](_0x288ab2(0x13e)+_0x5248ef+':\x20'+(_0x4fc57a[_0x288ab2(0x122)]?_0x288ab2(0x122):_0x288ab2(0x135)));}catch(_0x231033){console[_0x288ab2(0xb7)](_0x288ab2(0x159),_0x231033);}}async[a55_0x343c55(0xc2)](_0x175af9,_0x13a517){const _0x2cfa78=a55_0x343c55;try{const _0x4dab0=await database_1[_0x2cfa78(0xee)][_0x2cfa78(0x158)][_0x2cfa78(0xd4)]({'where':{'shopId':_0x175af9},'select':{'notificationApiError':!![]}});if(!_0x4dab0?.[_0x2cfa78(0x161)]){console[_0x2cfa78(0x132)](_0x2cfa78(0xf3)+_0x175af9);return;}let _0x5f169b='🚨\x20*API\x20Error*\x0a\x0a'+(_0x2cfa78(0x151)+_0x13a517[_0x2cfa78(0x137)]+'\x20'+_0x13a517[_0x2cfa78(0xd1)]+'`\x0a')+(_0x2cfa78(0xf8)+_0x13a517[_0x2cfa78(0xef)][_0x2cfa78(0xc9)](_0x2cfa78(0x10a))+'\x0a');_0x13a517['statusCode']&&(_0x5f169b+=_0x2cfa78(0x188)+_0x13a517[_0x2cfa78(0x185)]+'`\x0a'),_0x5f169b+=_0x2cfa78(0x117)+_0x13a517[_0x2cfa78(0x164)]+'`\x0a',_0x13a517[_0x2cfa78(0x119)]&&(_0x5f169b+=_0x2cfa78(0xb9)+_0x13a517[_0x2cfa78(0x119)]+'`\x0a'),_0x5f169b+=_0x2cfa78(0xc5),await this[_0x2cfa78(0x104)](_0x175af9,_0x5f169b,{'parse_mode':_0x2cfa78(0x189)}),console[_0x2cfa78(0x132)](_0x2cfa78(0xae)+_0x175af9+':\x20'+_0x13a517['endpoint']);}catch(_0x37473d){console['error'](_0x2cfa78(0x16e),_0x37473d);}}async['sendCustomNotification'](_0x38685d,_0x2657ec,_0x5c6f8e){const _0x2c64fc=a55_0x343c55;let _0x2448bf=_0x2c64fc(0xd7)+_0x2657ec+_0x2c64fc(0xab);for(const [_0x235e96,_0x4e4a83]of Object[_0x2c64fc(0xf5)](_0x5c6f8e)){_0x4e4a83!==null&&_0x4e4a83!==undefined&&(_0x2448bf+=_0x235e96+':\x20`'+_0x4e4a83+'`\x0a');}await this[_0x2c64fc(0x104)](_0x38685d,_0x2448bf,{'parse_mode':_0x2c64fc(0x189)});}[a55_0x343c55(0x100)](){return{'isActive':!!this['bot'],'username':this['botUsername']};}[a55_0x343c55(0x17c)](){const _0x18cfa3=a55_0x343c55;this[_0x18cfa3(0xa7)]&&(this[_0x18cfa3(0xa7)][_0x18cfa3(0x111)](),this[_0x18cfa3(0xa7)]=null,console[_0x18cfa3(0x132)](_0x18cfa3(0x11d)));}}exports[a55_0x343c55(0x146)]=TelegramBotService,exports[a55_0x343c55(0xcf)]=new TelegramBotService();