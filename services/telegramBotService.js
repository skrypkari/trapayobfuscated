'use strict';const a54_0x4aae2b=a54_0x147b;function a54_0x88df(){const _0x5a1a20=['includes','customerUa','📊\x20*Connection\x20Status*\x0a\x0a','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','failed','•\x20New\x20payments\x0a','substring','Failed\x20to\x20send\x20login\x20notification:','notificationApiError','Username:\x20`','name','✅\x20Connected\x20to\x20shop:\x20*','error','4382397KZwWVb','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Error\x20handling\x20/debug\x20command:','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','24GxYzhB','defineProperty','💸\x20Amount:\x20*','1044DNYFts','Payment\x20expired','\x0aCheck\x20spelling\x20and\x20try\x20again.','•\x20Payouts\x0a\x0a','chargebackAmount','Markdown','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','🆔\x20Payment\x20ID:\x20`','👤\x20Username:\x20`','📅\x20Connection\x20date:\x20','🌐\x20IP:\x20`','🔗\x20TXID:\x20`','../types/gateway','•\x20Important\x20events\x0a\x0a','telegramBotService','\x20parts:\x20','findFirst','•\x20`','`\x0a\x0a','username','unknown\x20shop','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','*.\x0a\x0a','default','🔔\x20Notifications\x20are\x20active\x0a\x0a','2154YZkFAs','Payout\x20completed','New\x20payout\x20created','toLocaleString','❌\x20Please\x20use\x20/start\x20command\x20first','\x22\x20->\x20display\x20\x22','chat','🆔\x20Payout\x20ID:\x20`','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','startsWith','Error\x20handling\x20message:','stopPolling','`\x20(','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','`.\x0a\x0a','Use\x20/start\x20to\x20connect.','\x20initialized\x20successfully','getBotInfo','map','timestamp','35nicudu','\x0a👤\x20*Customer\x20Information:*\x0a','626395qlVKxw','endpoint','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','📅\x20Time:\x20','currency','userAgent','•\x20Payment\x20status\x20changes\x0a','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','Failed\x20login\x20attempt','Failed\x20to\x20send\x20API\x20error\x20notification:','`\x20is\x20inactive.\x0a\x0a','forEach','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','log','/status\x20-\x20check\x20connection\x20status\x0a','To\x20reconnect,\x20use\x20the\x20/start\x20command','🔔\x20*','findMany','blocked','secretKey','status','customerName',':\x20`','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','Use\x20/start\x20to\x20begin.','from','method','trapay_bot','handleSingleLineVerification','Payment\x20chargeback','...','/disconnect\x20-\x20disconnect\x20from\x20notifications','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','text','remitterIban','📅\x20Date:\x20','\x20verified\x20for\x20shop\x20','✅\x20Welcome\x20back!\x0a\x0a','Error\x20handling\x20/status\x20command:','Error\x20in\x20handleSingleLineVerification:','Payment\x20failed','sendLoginNotification','test','requestId','env','processing','💸\x20Penalty\x20amount:\x20*','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','📧\x20Email:\x20`','sk_','message','49444VhVGLd','❌\x20Shop\x20with\x20username\x20`','../config/database','📱\x20Your\x20Telegram\x20ID:\x20`','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','\x20disconnected\x20from\x20shop\x20','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','🛑\x20Telegram\x20bot\x20stopped','Check\x20spelling\x20and\x20try\x20again.','success','ACTIVE','findUnique','📝\x20Notes:\x20','*\x0a\x0a','setupBotHandlers','toLocaleDateString','shopId','entries','warn','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','🔗\x20Endpoint:\x20`','✅\x20Telegram\x20user\x20','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','TELEGRAM_BOT_USERNAME','user\x20is\x20deactivated','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','gateway','🏪\x20Available\x20shops\x20in\x20system:\x0a','shopSettings','💻\x20Browser:\x20`','botUsername','sendApiErrorNotification','trim','\x20\x20\x20Status:\x20','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','\x20USD*\x0a','25095FogIix','initializeBot','Telegram\x20bot\x20error:','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','🏪\x20Gateway:\x20`','•\x20Payouts\x0a','update','🆔\x20Request\x20ID:\x20`','Payment\x20refund','telegramUser','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','❌\x20Error:\x20`','95244fGtQRv','Payment\x20successfully\x20paid','statusCode','Error\x20sending\x20shop\x20notification:','.\x20*','🚨\x20*API\x20Error*\x0a\x0a','chargeback','📛\x20Name:\x20`','Payment\x20is\x20being\x20processed','TELEGRAM_BOT_TOKEN','\x20(@','allSettled','🎉\x20*Congratulations!*\x0a\x0a','split','✅\x20Telegram\x20bot\x20@','❌\x20Error\x20getting\x20debug\x20information.','`\x20not\x20found.\x0a\x0a','chat\x20not\x20found','customerEmail','createdAt','Commands:\x0a','length','110CFYoFm','isVerified','sendMessage','2348IjlRbh','txid','publicKey','🏦\x20IBAN:\x20`','customerIp','ipAddress','telegramId',':\x20username=\x22','Error\x20handling\x20/disconnect\x20command:','en-US','shop','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','sendShopNotification','Telegram\x20bot\x20polling\x20error:','polling_error','adminNotes','New\x20payment\x20created','join','28509168nWSWmz','botToken','last_name','onText','...`\x0a\x0a','...\x22','toString','\x22,\x20apiKey=\x22','TelegramBotService','Error\x20handling\x20/start\x20command:','bot','❌\x20Invalid\x20username\x20format:\x20`','💰\x20Amount:\x20*','amount'];a54_0x88df=function(){return _0x5a1a20;};return a54_0x88df();}function a54_0x147b(_0x3ab3c3,_0x447c73){const _0x88dfaa=a54_0x88df();return a54_0x147b=function(_0x147bd0,_0x323506){_0x147bd0=_0x147bd0-0xa4;let _0x571b93=_0x88dfaa[_0x147bd0];return _0x571b93;},a54_0x147b(_0x3ab3c3,_0x447c73);}(function(_0x4811fd,_0x1f4fe2){const _0x471e19=a54_0x147b,_0x4f6435=_0x4811fd();while(!![]){try{const _0x3a39be=-parseInt(_0x471e19(0xc7))/0x1*(parseInt(_0x471e19(0x177))/0x2)+-parseInt(_0x471e19(0x15e))/0x3+parseInt(_0x471e19(0x12b))/0x4*(parseInt(_0x471e19(0xf4))/0x5)+parseInt(_0x471e19(0xe0))/0x6*(-parseInt(_0x471e19(0x150))/0x7)+-parseInt(_0x471e19(0xc4))/0x8*(-parseInt(_0x471e19(0xbf))/0x9)+parseInt(_0x471e19(0x174))/0xa*(-parseInt(_0x471e19(0xf6))/0xb)+parseInt(_0x471e19(0xa4))/0xc;if(_0x3a39be===_0x1f4fe2)break;else _0x4f6435['push'](_0x4f6435['shift']());}catch(_0x38009e){_0x4f6435['push'](_0x4f6435['shift']());}}}(a54_0x88df,0xb7a94));var __importDefault=this&&this['__importDefault']||function(_0x54bf22){return _0x54bf22&&_0x54bf22['__esModule']?_0x54bf22:{'default':_0x54bf22};};Object[a54_0x4aae2b(0xc5)](exports,'__esModule',{'value':!![]}),exports['telegramBotService']=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a54_0x4aae2b(0x12d))),gateway_1=require(a54_0x4aae2b(0xd3));class TelegramBotService{constructor(){const _0x1bf184=a54_0x4aae2b;this[_0x1bf184(0xae)]=null,this[_0x1bf184(0xa5)]=process[_0x1bf184(0x124)][_0x1bf184(0x167)]||'',this[_0x1bf184(0x14a)]=process['env'][_0x1bf184(0x143)]||_0x1bf184(0x113),this[_0x1bf184(0xa5)]?this['initializeBot']():console[_0x1bf184(0x13d)](_0x1bf184(0x10f));}[a54_0x4aae2b(0x151)](){const _0x53066e=a54_0x4aae2b;try{this['bot']=new node_telegram_bot_api_1[(_0x53066e(0xde))](this['botToken'],{'polling':!![]}),this[_0x53066e(0x139)](),console['log'](_0x53066e(0x16c)+this['botUsername']+_0x53066e(0xf0));}catch(_0x245e3b){console['error'](_0x53066e(0xc2),_0x245e3b);}}[a54_0x4aae2b(0x139)](){const _0x177584=a54_0x4aae2b;if(!this['bot'])return;this[_0x177584(0xae)][_0x177584(0xa7)](/\/start/,async _0x1c716d=>{const _0x30ef8e=_0x177584,_0x5dc19a=_0x1c716d[_0x30ef8e(0xe6)]['id'],_0x2d97b8=_0x1c716d['from']?.['id'][_0x30ef8e(0xaa)](),_0x3da8eb=_0x1c716d[_0x30ef8e(0x111)]?.[_0x30ef8e(0xda)],_0x2c98d0=_0x1c716d[_0x30ef8e(0x111)]?.['first_name'],_0x13d34d=_0x1c716d[_0x30ef8e(0x111)]?.[_0x30ef8e(0xa6)];if(!_0x2d97b8)return;try{let _0x16b2e8=await database_1['default']['telegramUser'][_0x30ef8e(0x136)]({'where':{'telegramId':_0x2d97b8},'include':{'shop':!![]}});!_0x16b2e8?(_0x16b2e8=await database_1['default']['telegramUser']['create']({'data':{'telegramId':_0x2d97b8,'username':_0x3da8eb,'firstName':_0x2c98d0,'lastName':_0x13d34d,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log']('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x2d97b8+_0x30ef8e(0x168)+_0x3da8eb+')')):_0x16b2e8=await database_1[_0x30ef8e(0xde)][_0x30ef8e(0x15b)]['update']({'where':{'telegramId':_0x2d97b8},'data':{'username':_0x3da8eb,'firstName':_0x2c98d0,'lastName':_0x13d34d},'include':{'shop':!![]}}),_0x16b2e8[_0x30ef8e(0x175)]&&_0x16b2e8[_0x30ef8e(0x13b)]&&_0x16b2e8[_0x30ef8e(0x181)]?await this[_0x30ef8e(0xae)]?.[_0x30ef8e(0x176)](_0x5dc19a,_0x30ef8e(0x11d)+(_0x30ef8e(0x145)+_0x16b2e8[_0x30ef8e(0x181)][_0x30ef8e(0xbc)]+'*\x0a')+(_0x30ef8e(0xbb)+_0x16b2e8[_0x30ef8e(0x181)][_0x30ef8e(0xda)]+_0x30ef8e(0xd9))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x30ef8e(0xb7)+_0x30ef8e(0xfe)+_0x30ef8e(0xca)+_0x30ef8e(0x172)+_0x30ef8e(0x106)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x30ef8e(0xcc)}):(_0x16b2e8[_0x30ef8e(0x13b)]&&!_0x16b2e8['isVerified']&&(await database_1[_0x30ef8e(0xde)][_0x30ef8e(0x15b)][_0x30ef8e(0x158)]({'where':{'telegramId':_0x2d97b8},'data':{'shopId':null,'isVerified':![]}}),console[_0x30ef8e(0x105)](_0x30ef8e(0x141)+_0x2d97b8)),await this[_0x30ef8e(0xae)]?.[_0x30ef8e(0x176)](_0x5dc19a,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x30ef8e(0x104)+_0x30ef8e(0x153)+'Example:\x0a'+_0x30ef8e(0x13e)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':'Markdown'}));}catch(_0x2e49a3){console[_0x30ef8e(0xbe)](_0x30ef8e(0xad),_0x2e49a3),await this[_0x30ef8e(0xae)]?.['sendMessage'](_0x5dc19a,_0x30ef8e(0x118));}}),this[_0x177584(0xae)][_0x177584(0xa7)](/\/disconnect/,async _0x24cc11=>{const _0x531ba5=_0x177584,_0x1c846f=_0x24cc11['chat']['id'],_0x5b4b0f=_0x24cc11[_0x531ba5(0x111)]?.['id'][_0x531ba5(0xaa)]();if(!_0x5b4b0f)return;try{const _0x114247=await database_1[_0x531ba5(0xde)]['telegramUser'][_0x531ba5(0x136)]({'where':{'telegramId':_0x5b4b0f},'include':{'shop':!![]}});if(!_0x114247||!_0x114247['isVerified']||!_0x114247[_0x531ba5(0x13b)]){await this['bot']?.[_0x531ba5(0x176)](_0x1c846f,_0x531ba5(0x142));return;}const _0x415302=_0x114247[_0x531ba5(0x181)]?.['name']||_0x531ba5(0xdb);await database_1[_0x531ba5(0xde)][_0x531ba5(0x15b)]['update']({'where':{'telegramId':_0x5b4b0f},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔌\x20User\x20'+_0x5b4b0f+_0x531ba5(0x130)+_0x114247[_0x531ba5(0x13b)]),await this[_0x531ba5(0xae)]?.['sendMessage'](_0x1c846f,_0x531ba5(0xcd)+_0x415302+_0x531ba5(0xdd)+_0x531ba5(0x107),{'parse_mode':_0x531ba5(0xcc)});}catch(_0x29bb4a){console[_0x531ba5(0xbe)](_0x531ba5(0x17f),_0x29bb4a),await this[_0x531ba5(0xae)]?.['sendMessage'](_0x1c846f,_0x531ba5(0x118));}}),this[_0x177584(0xae)][_0x177584(0xa7)](/\/status/,async _0x4b0bcd=>{const _0x1fc163=_0x177584,_0x3df32a=_0x4b0bcd[_0x1fc163(0xe6)]['id'],_0x52d6f7=_0x4b0bcd[_0x1fc163(0x111)]?.['id'][_0x1fc163(0xaa)]();if(!_0x52d6f7)return;try{const _0x694293=await database_1[_0x1fc163(0xde)][_0x1fc163(0x15b)][_0x1fc163(0x136)]({'where':{'telegramId':_0x52d6f7},'include':{'shop':!![]}});if(!_0x694293){await this[_0x1fc163(0xae)]?.['sendMessage'](_0x3df32a,_0x1fc163(0xfa)+_0x1fc163(0x110));return;}if(!_0x694293['isVerified']||!_0x694293['shopId']||!_0x694293['shop']){await this['bot']?.[_0x1fc163(0x176)](_0x3df32a,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x1fc163(0xef));return;}await this[_0x1fc163(0xae)]?.[_0x1fc163(0x176)](_0x3df32a,_0x1fc163(0xb4)+(_0x1fc163(0xbd)+_0x694293['shop'][_0x1fc163(0xbc)]+'*\x0a')+(_0x1fc163(0xcf)+_0x694293[_0x1fc163(0x181)][_0x1fc163(0xda)]+'`\x0a')+(_0x1fc163(0xd0)+_0x694293['updatedAt'][_0x1fc163(0x13a)](_0x1fc163(0x180))+'\x0a\x0a')+_0x1fc163(0xdf)+'Commands:\x0a'+_0x1fc163(0x117),{'parse_mode':_0x1fc163(0xcc)});}catch(_0x1863d6){console[_0x1fc163(0xbe)](_0x1fc163(0x11e),_0x1863d6),await this[_0x1fc163(0xae)]?.[_0x1fc163(0x176)](_0x3df32a,_0x1fc163(0x118));}}),this['bot'][_0x177584(0xa7)](/\/debug/,async _0x4fea79=>{const _0x5ca3ae=_0x177584,_0x5c824b=_0x4fea79[_0x5ca3ae(0xe6)]['id'],_0x21734b=_0x4fea79['from']?.['id']['toString']();if(!_0x21734b)return;try{const _0x43b21e=await database_1['default'][_0x5ca3ae(0x181)][_0x5ca3ae(0x109)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x17acea='🔍\x20*Debug\x20Information*\x0a\x0a';_0x17acea+=_0x5ca3ae(0x12e)+_0x21734b+_0x5ca3ae(0xd9),_0x17acea+=_0x5ca3ae(0x147),_0x43b21e[_0x5ca3ae(0x103)]((_0x1029a1,_0x3ad2b0)=>{const _0xea2aa9=_0x5ca3ae;_0x17acea+=_0x3ad2b0+0x1+_0xea2aa9(0x162)+_0x1029a1[_0xea2aa9(0xbc)]+'*\x0a',_0x17acea+='\x20\x20\x20Username:\x20`'+_0x1029a1[_0xea2aa9(0xda)]+'`\x0a',_0x17acea+=_0xea2aa9(0x14d)+_0x1029a1[_0xea2aa9(0x10c)]+'\x0a',_0x17acea+='\x20\x20\x20Public\x20Key:\x20`'+_0x1029a1[_0xea2aa9(0x179)][_0xea2aa9(0xb8)](0x0,0xf)+_0xea2aa9(0xa8);}),await this['bot']?.['sendMessage'](_0x5c824b,_0x17acea,{'parse_mode':_0x5ca3ae(0xcc)});}catch(_0x55f6ea){console['error'](_0x5ca3ae(0xc1),_0x55f6ea),await this[_0x5ca3ae(0xae)]?.[_0x5ca3ae(0x176)](_0x5c824b,_0x5ca3ae(0x16d));}}),this['bot']['on'](_0x177584(0x12a),async _0x3417a2=>{const _0x587d59=_0x177584;if(_0x3417a2[_0x587d59(0x119)]?.['startsWith']('/'))return;const _0x2e6676=_0x3417a2['chat']['id'],_0x200af2=_0x3417a2[_0x587d59(0x111)]?.['id'][_0x587d59(0xaa)](),_0x1c0f4d=_0x3417a2[_0x587d59(0x119)]?.[_0x587d59(0x14c)]();if(!_0x200af2||!_0x1c0f4d)return;try{const _0x1c617e=await database_1[_0x587d59(0xde)][_0x587d59(0x15b)][_0x587d59(0x136)]({'where':{'telegramId':_0x200af2},'include':{'shop':!![]}});if(!_0x1c617e){await this[_0x587d59(0xae)]?.['sendMessage'](_0x2e6676,_0x587d59(0xe4));return;}if(_0x1c617e[_0x587d59(0x175)]&&_0x1c617e[_0x587d59(0x13b)]&&_0x1c617e[_0x587d59(0x181)]){await this[_0x587d59(0xae)]?.[_0x587d59(0x176)](_0x2e6676,_0x587d59(0x131)+_0x1c617e[_0x587d59(0x181)][_0x587d59(0xbc)]+_0x587d59(0xdd)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':'Markdown'});return;}const _0x3657a6=_0x1c0f4d[_0x587d59(0x16b)](/\s+/);if(_0x3657a6[_0x587d59(0x173)]!==0x2){await this[_0x587d59(0xae)]?.[_0x587d59(0x176)](_0x2e6676,_0x587d59(0xe8)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+'Example:\x0a'+_0x587d59(0x13e)+('You\x20sent\x20'+_0x3657a6['length']+_0x587d59(0xd6)+_0x3657a6[_0x587d59(0xf2)](_0x58d99d=>'`'+_0x58d99d+'`')[_0x587d59(0x188)](',\x20')),{'parse_mode':_0x587d59(0xcc)});return;}const [_0x634d6a,_0x36b95a]=_0x3657a6;console[_0x587d59(0x105)](_0x587d59(0xc3)+_0x200af2+_0x587d59(0x17e)+_0x634d6a+_0x587d59(0xab)+_0x36b95a[_0x587d59(0xb8)](0x0,0xa)+_0x587d59(0xa9)),await this[_0x587d59(0x114)](_0x2e6676,_0x200af2,_0x634d6a,_0x36b95a);}catch(_0x514db3){console[_0x587d59(0xbe)](_0x587d59(0xea),_0x514db3),await this['bot']?.[_0x587d59(0x176)](_0x2e6676,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x177584(0xae)]['on'](_0x177584(0xbe),_0x57622b=>{const _0x56e0ce=_0x177584;console['error'](_0x56e0ce(0x152),_0x57622b);}),this[_0x177584(0xae)]['on'](_0x177584(0x185),_0x4edd24=>{const _0x5dc363=_0x177584;console[_0x5dc363(0xbe)](_0x5dc363(0x184),_0x4edd24);});}async['handleSingleLineVerification'](_0x4f188f,_0x3ca6b6,_0x4f05e0,_0xd7a401){const _0x5d40f5=a54_0x4aae2b;try{console[_0x5d40f5(0x105)](_0x5d40f5(0xc3)+_0x3ca6b6+_0x5d40f5(0x17e)+_0x4f05e0+_0x5d40f5(0xab)+_0xd7a401[_0x5d40f5(0xb8)](0x0,0xa)+_0x5d40f5(0xa9));if(!_0x4f05e0||_0x4f05e0[_0x5d40f5(0x173)]<0x3||_0x4f05e0[_0x5d40f5(0x173)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x5d40f5(0x122)](_0x4f05e0)){await this[_0x5d40f5(0xae)]?.[_0x5d40f5(0x176)](_0x4f188f,_0x5d40f5(0xaf)+_0x4f05e0+_0x5d40f5(0xd9)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':'Markdown'});return;}if(!_0xd7a401||!_0xd7a401[_0x5d40f5(0xe9)]('pk_')&&!_0xd7a401[_0x5d40f5(0xe9)](_0x5d40f5(0x129))){await this[_0x5d40f5(0xae)]?.[_0x5d40f5(0x176)](_0x4f188f,_0x5d40f5(0x14e)+_0x5d40f5(0x12f),{'parse_mode':_0x5d40f5(0xcc)});return;}const _0xb1cab7=await database_1['default'][_0x5d40f5(0x181)][_0x5d40f5(0x136)]({'where':{'username':_0x4f05e0},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0xb1cab7){const _0x2905d9=await database_1[_0x5d40f5(0xde)]['shop'][_0x5d40f5(0x109)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x496eb9=_0x5d40f5(0x12c)+_0x4f05e0+_0x5d40f5(0x16e);_0x2905d9[_0x5d40f5(0x173)]>0x0?(_0x496eb9+='Available\x20usernames:\x0a',_0x2905d9[_0x5d40f5(0x103)](_0x52ad3a=>{const _0xdf0c4e=_0x5d40f5;_0x496eb9+=_0xdf0c4e(0xd8)+_0x52ad3a[_0xdf0c4e(0xda)]+_0xdf0c4e(0xec)+_0x52ad3a['name']+')\x0a';}),_0x496eb9+=_0x5d40f5(0xc9)):_0x496eb9+=_0x5d40f5(0x133);await this[_0x5d40f5(0xae)]?.[_0x5d40f5(0x176)](_0x4f188f,_0x496eb9,{'parse_mode':_0x5d40f5(0xcc)});return;}if(_0xb1cab7['status']!==_0x5d40f5(0x135)){await this[_0x5d40f5(0xae)]?.[_0x5d40f5(0x176)](_0x4f188f,'❌\x20Shop\x20`'+_0x4f05e0+_0x5d40f5(0x102)+'Contact\x20administrator.',{'parse_mode':_0x5d40f5(0xcc)});return;}if(_0xb1cab7['publicKey']!==_0xd7a401&&_0xb1cab7[_0x5d40f5(0x10b)]!==_0xd7a401){await this[_0x5d40f5(0xae)]?.['sendMessage'](_0x4f188f,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x4f05e0+_0x5d40f5(0xee)+_0x5d40f5(0x182)+_0x5d40f5(0xf8),{'parse_mode':_0x5d40f5(0xcc)});return;}const _0x391b16=await database_1[_0x5d40f5(0xde)][_0x5d40f5(0x15b)][_0x5d40f5(0xd7)]({'where':{'shopId':_0xb1cab7['id'],'isVerified':!![],'telegramId':{'not':_0x3ca6b6}}});if(_0x391b16){await this[_0x5d40f5(0xae)]?.[_0x5d40f5(0x176)](_0x4f188f,_0x5d40f5(0xf9)+_0x4f05e0+_0x5d40f5(0xee)+_0x5d40f5(0xed),{'parse_mode':'Markdown'});return;}await database_1[_0x5d40f5(0xde)]['telegramUser'][_0x5d40f5(0x158)]({'where':{'telegramId':_0x3ca6b6},'data':{'shopId':_0xb1cab7['id'],'isVerified':!![]}}),await this[_0x5d40f5(0xae)]?.[_0x5d40f5(0x176)](_0x4f188f,_0x5d40f5(0x16a)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('📱\x20Shop:\x20*'+_0xb1cab7['name']+'*\x0a')+(_0x5d40f5(0xcf)+_0xb1cab7[_0x5d40f5(0xda)]+_0x5d40f5(0xd9))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x5d40f5(0xfe)+_0x5d40f5(0x157)+_0x5d40f5(0xd4)+_0x5d40f5(0x172)+_0x5d40f5(0x106)+_0x5d40f5(0x117),{'parse_mode':_0x5d40f5(0xcc)}),console[_0x5d40f5(0x105)](_0x5d40f5(0x140)+_0x3ca6b6+_0x5d40f5(0x11c)+_0xb1cab7['username']+'\x20via\x20single-line\x20input');}catch(_0x569578){console[_0x5d40f5(0xbe)](_0x5d40f5(0x11f),_0x569578),await this[_0x5d40f5(0xae)]?.['sendMessage'](_0x4f188f,_0x5d40f5(0xc0));}}async[a54_0x4aae2b(0x183)](_0x54aa0b,_0x57c014,_0x5e3930){const _0x5ae08f=a54_0x4aae2b;if(!this[_0x5ae08f(0xae)]){console[_0x5ae08f(0x13d)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x20dc9a=await database_1[_0x5ae08f(0xde)][_0x5ae08f(0x15b)][_0x5ae08f(0x109)]({'where':{'shopId':_0x54aa0b,'isVerified':!![]}});if(_0x20dc9a[_0x5ae08f(0x173)]===0x0){console['log'](_0x5ae08f(0x15c)+_0x54aa0b);return;}const _0x2ca642=_0x20dc9a['map'](async _0x2a2202=>{const _0x429cdc=_0x5ae08f;try{await this[_0x429cdc(0xae)]?.[_0x429cdc(0x176)](_0x2a2202[_0x429cdc(0x17d)],_0x57c014,_0x5e3930),console['log'](_0x429cdc(0x127)+_0x2a2202['telegramId']);}catch(_0x13e379){console['error']('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x2a2202[_0x429cdc(0x17d)]+':',_0x13e379),_0x13e379 instanceof Error&&(_0x13e379[_0x429cdc(0x12a)]['includes'](_0x429cdc(0x10a))||_0x13e379[_0x429cdc(0x12a)][_0x429cdc(0xb2)](_0x429cdc(0x16f))||_0x13e379[_0x429cdc(0x12a)][_0x429cdc(0xb2)](_0x429cdc(0x144)))&&(await database_1[_0x429cdc(0xde)]['telegramUser']['update']({'where':{'id':_0x2a2202['id']},'data':{'isVerified':![]}}),console[_0x429cdc(0x105)]('User\x20'+_0x2a2202[_0x429cdc(0x17d)]+_0x429cdc(0x154)));}});await Promise[_0x5ae08f(0x169)](_0x2ca642);}catch(_0x327397){console[_0x5ae08f(0xbe)](_0x5ae08f(0x161),_0x327397);}}async['sendPaymentNotification'](_0x318082,_0x1012af,_0x522d50){const _0x48cafa=a54_0x4aae2b,_0xe21c8b={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x20ac05={'created':_0x48cafa(0x187),'paid':_0x48cafa(0x15f),'failed':_0x48cafa(0x120),'expired':_0x48cafa(0xc8),'refund':_0x48cafa(0x15a),'chargeback':_0x48cafa(0x115),'processing':_0x48cafa(0x166)},_0x3898fe=_0xe21c8b[_0x522d50],_0x32c023=_0x20ac05[_0x522d50],_0x1bdbca=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x1012af[_0x48cafa(0x146)]);console[_0x48cafa(0x105)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x1012af['gateway']+_0x48cafa(0xe5)+_0x1bdbca+'\x22');let _0x445533=_0x3898fe+'\x20*'+_0x32c023+_0x48cafa(0x138)+(_0x48cafa(0xb0)+_0x1012af[_0x48cafa(0xb1)]+'\x20'+_0x1012af[_0x48cafa(0xfc)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x1012af['orderId']||_0x1012af['id'])+'`\x0a')+(_0x48cafa(0xce)+_0x1012af['id']+'`\x0a')+(_0x48cafa(0x156)+_0x1bdbca+'`\x0a')+(_0x48cafa(0x11b)+new Date(_0x1012af[_0x48cafa(0x171)])[_0x48cafa(0xe3)](_0x48cafa(0x180))+'\x0a');if(_0x1012af['customerName']||_0x1012af[_0x48cafa(0x170)]||_0x1012af[_0x48cafa(0x11a)]||_0x1012af['customerIp']||_0x1012af[_0x48cafa(0xb3)]){_0x445533+=_0x48cafa(0xf5);_0x1012af['customerName']&&(_0x445533+=_0x48cafa(0x165)+_0x1012af[_0x48cafa(0x10d)]+'`\x0a');_0x1012af[_0x48cafa(0x170)]&&(_0x445533+=_0x48cafa(0x128)+_0x1012af[_0x48cafa(0x170)]+'`\x0a');_0x1012af['remitterIban']&&(_0x445533+=_0x48cafa(0x17a)+_0x1012af[_0x48cafa(0x11a)]+'`\x0a');_0x1012af[_0x48cafa(0x17b)]&&(_0x445533+=_0x48cafa(0xd1)+_0x1012af['customerIp']+'`\x0a');if(_0x1012af[_0x48cafa(0xb3)]){const _0x1adc3f=_0x1012af[_0x48cafa(0xb3)][_0x48cafa(0x173)]>0x32?_0x1012af[_0x48cafa(0xb3)][_0x48cafa(0xb8)](0x0,0x32)+_0x48cafa(0x116):_0x1012af[_0x48cafa(0xb3)];_0x445533+=_0x48cafa(0x149)+_0x1adc3f+'`\x0a';}}_0x522d50===_0x48cafa(0x164)&&_0x1012af[_0x48cafa(0xcb)]&&(_0x445533+=_0x48cafa(0x126)+_0x1012af['chargebackAmount']+'\x20USDT*\x0a'),_0x522d50===_0x48cafa(0x125)&&(_0x445533+=_0x48cafa(0xdc)),_0x1012af['adminNotes']&&(_0x445533+=_0x48cafa(0x137)+_0x1012af[_0x48cafa(0x186)]+'\x0a'),await this[_0x48cafa(0x183)](_0x318082,_0x445533,{'parse_mode':_0x48cafa(0xcc)});}async['sendPayoutNotification'](_0x35a05f,_0x58f9c1,_0xadefcd){const _0x440dd5=a54_0x4aae2b,_0xb1a1ab={'created':'📤','completed':'✅','rejected':'❌'},_0x95022b={'created':_0x440dd5(0xe2),'completed':_0x440dd5(0xe1),'rejected':'Payout\x20rejected'},_0x12e4e0=_0xb1a1ab[_0xadefcd],_0x2a8e80=_0x95022b[_0xadefcd],_0xf71bfb=_0x12e4e0+'\x20*'+_0x2a8e80+_0x440dd5(0x138)+(_0x440dd5(0xc6)+_0x58f9c1[_0x440dd5(0xb1)]+_0x440dd5(0x14f))+('🏦\x20Method:\x20`'+_0x58f9c1[_0x440dd5(0x112)]+'`\x0a')+(_0x440dd5(0xe7)+_0x58f9c1['id']+'`\x0a')+(_0x440dd5(0x11b)+new Date(_0x58f9c1[_0x440dd5(0x171)])['toLocaleString']('en-US')+'\x0a')+(_0x58f9c1[_0x440dd5(0x178)]?_0x440dd5(0xd2)+_0x58f9c1['txid']+'`':'');await this[_0x440dd5(0x183)](_0x35a05f,_0xf71bfb,{'parse_mode':_0x440dd5(0xcc)});}async[a54_0x4aae2b(0x121)](_0x229db5,_0x2926f4){const _0x15c1a3=a54_0x4aae2b;try{const _0x29d3f7=await database_1[_0x15c1a3(0xde)][_0x15c1a3(0x148)]['findUnique']({'where':{'shopId':_0x229db5},'select':{'notificationLogin':!![]}});if(!_0x29d3f7?.['notificationLogin']){console[_0x15c1a3(0x105)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x229db5);return;}const _0x2eb396=_0x2926f4[_0x15c1a3(0x134)]?'🔐':'🚨',_0x2fa6d5=_0x2926f4['success']?'Successful\x20login':_0x15c1a3(0x100);let _0x45bd2b=_0x2eb396+'\x20*'+_0x2fa6d5+'*\x0a\x0a'+('👤\x20Username:\x20`'+_0x2926f4[_0x15c1a3(0xda)]+'`\x0a')+(_0x15c1a3(0xfb)+_0x2926f4[_0x15c1a3(0xf3)][_0x15c1a3(0xe3)](_0x15c1a3(0x180))+'\x0a');_0x2926f4[_0x15c1a3(0x17c)]&&(_0x45bd2b+='🌐\x20IP\x20address:\x20`'+_0x2926f4[_0x15c1a3(0x17c)]+'`\x0a');if(_0x2926f4[_0x15c1a3(0xfd)]){const _0x27951=_0x2926f4[_0x15c1a3(0xfd)][_0x15c1a3(0x173)]>0x32?_0x2926f4[_0x15c1a3(0xfd)][_0x15c1a3(0xb8)](0x0,0x32)+_0x15c1a3(0x116):_0x2926f4['userAgent'];_0x45bd2b+='💻\x20Browser:\x20`'+_0x27951+'`\x0a';}!_0x2926f4[_0x15c1a3(0x134)]&&(_0x45bd2b+=_0x15c1a3(0x155)),await this[_0x15c1a3(0x183)](_0x229db5,_0x45bd2b,{'parse_mode':_0x15c1a3(0xcc)}),console['log'](_0x15c1a3(0xff)+_0x229db5+':\x20'+(_0x2926f4[_0x15c1a3(0x134)]?'success':_0x15c1a3(0xb6)));}catch(_0x20d583){console[_0x15c1a3(0xbe)](_0x15c1a3(0xb9),_0x20d583);}}async[a54_0x4aae2b(0x14b)](_0x258bbb,_0x261bb7){const _0x3bea08=a54_0x4aae2b;try{const _0x5a8fd3=await database_1['default'][_0x3bea08(0x148)]['findUnique']({'where':{'shopId':_0x258bbb},'select':{'notificationApiError':!![]}});if(!_0x5a8fd3?.[_0x3bea08(0xba)]){console[_0x3bea08(0x105)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x258bbb);return;}let _0x21a811=_0x3bea08(0x163)+(_0x3bea08(0x13f)+_0x261bb7['method']+'\x20'+_0x261bb7[_0x3bea08(0xf7)]+'`\x0a')+(_0x3bea08(0xfb)+_0x261bb7[_0x3bea08(0xf3)][_0x3bea08(0xe3)](_0x3bea08(0x180))+'\x0a');_0x261bb7['statusCode']&&(_0x21a811+='📊\x20Error\x20code:\x20`'+_0x261bb7[_0x3bea08(0x160)]+'`\x0a'),_0x21a811+=_0x3bea08(0x15d)+_0x261bb7['errorMessage']+'`\x0a',_0x261bb7[_0x3bea08(0x123)]&&(_0x21a811+=_0x3bea08(0x159)+_0x261bb7[_0x3bea08(0x123)]+'`\x0a'),_0x21a811+=_0x3bea08(0xb5),await this[_0x3bea08(0x183)](_0x258bbb,_0x21a811,{'parse_mode':_0x3bea08(0xcc)}),console['log']('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x258bbb+':\x20'+_0x261bb7['endpoint']);}catch(_0xedf325){console[_0x3bea08(0xbe)](_0x3bea08(0x101),_0xedf325);}}async['sendCustomNotification'](_0x183cbe,_0x14eb5f,_0x31b643){const _0x1bf666=a54_0x4aae2b;let _0x44bdfa=_0x1bf666(0x108)+_0x14eb5f+_0x1bf666(0x138);for(const [_0x400a3d,_0x140c3d]of Object[_0x1bf666(0x13c)](_0x31b643)){_0x140c3d!==null&&_0x140c3d!==undefined&&(_0x44bdfa+=_0x400a3d+_0x1bf666(0x10e)+_0x140c3d+'`\x0a');}await this[_0x1bf666(0x183)](_0x183cbe,_0x44bdfa,{'parse_mode':_0x1bf666(0xcc)});}[a54_0x4aae2b(0xf1)](){const _0x1a500d=a54_0x4aae2b;return{'isActive':!!this[_0x1a500d(0xae)],'username':this[_0x1a500d(0x14a)]};}['stopBot'](){const _0x233310=a54_0x4aae2b;this[_0x233310(0xae)]&&(this[_0x233310(0xae)][_0x233310(0xeb)](),this['bot']=null,console['log'](_0x233310(0x132)));}}exports[a54_0x4aae2b(0xac)]=TelegramBotService,exports[a54_0x4aae2b(0xd5)]=new TelegramBotService();