'use strict';const a54_0x1ab925=a54_0xc7da;(function(_0x1bef16,_0xe8873d){const _0x4a1a32=a54_0xc7da,_0xd1d686=_0x1bef16();while(!![]){try{const _0x5ce3fb=parseInt(_0x4a1a32(0x247))/0x1*(-parseInt(_0x4a1a32(0x28d))/0x2)+-parseInt(_0x4a1a32(0x209))/0x3+-parseInt(_0x4a1a32(0x1f9))/0x4*(parseInt(_0x4a1a32(0x2cc))/0x5)+-parseInt(_0x4a1a32(0x26c))/0x6*(parseInt(_0x4a1a32(0x2c1))/0x7)+parseInt(_0x4a1a32(0x28c))/0x8+-parseInt(_0x4a1a32(0x284))/0x9+parseInt(_0x4a1a32(0x2b4))/0xa*(parseInt(_0x4a1a32(0x24c))/0xb);if(_0x5ce3fb===_0xe8873d)break;else _0xd1d686['push'](_0xd1d686['shift']());}catch(_0xddd4e3){_0xd1d686['push'](_0xd1d686['shift']());}}}(a54_0x522c,0xd6226));var __importDefault=this&&this[a54_0x1ab925(0x281)]||function(_0x22db2a){const _0x148cb9=a54_0x1ab925;return _0x22db2a&&_0x22db2a[_0x148cb9(0x2b5)]?_0x22db2a:{'default':_0x22db2a};};function a54_0x522c(){const _0x3db301=['1QsqGkL','🔌\x20User\x20','publicKey','`\x0a\x0a','\x20initialized\x20successfully','11fOEFCH','amount','Failed\x20login\x20attempt','sendLoginNotification','trim','substring','🛑\x20Telegram\x20bot\x20stopped','map','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','✅\x20Telegram\x20user\x20','📅\x20Date:\x20','Error\x20handling\x20/disconnect\x20command:','botUsername','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','findFirst','❌\x20Please\x20use\x20/start\x20command\x20first','*\x0a\x0a','🏪\x20Gateway:\x20`','❌\x20Error:\x20`','\x22\x20->\x20display\x20\x22','includes','📱\x20Created\x20new\x20Telegram\x20user:\x20','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','default','ACTIVE','Payout\x20completed','create','chargeback','stopPolling','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','🆔\x20Payout\x20ID:\x20`','234lTrxXH','✅\x20Telegram\x20bot\x20@','getBotInfo',':\x20`','update','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','`\x20(','📊\x20*Connection\x20Status*\x0a\x0a','👤\x20Username:\x20`','en-US','timestamp','isVerified','customerEmail','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','...','updatedAt','Use\x20/start\x20to\x20begin.','\x22,\x20apiKey=\x22','•\x20New\x20payments\x0a','name','findUnique','__importDefault','sendApiErrorNotification','📧\x20Email:\x20`','2824434yaThQd','❌\x20Error\x20getting\x20debug\x20information.','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','setupBotHandlers','currency','❌\x20Shop\x20with\x20username\x20`','Contact\x20administrator.','customerUa','8230400amyOwC','2794450ugZtwv','Failed\x20to\x20send\x20API\x20error\x20notification:','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','toLocaleString','findMany','TELEGRAM_BOT_USERNAME','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','polling_error','orderId','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','Error\x20sending\x20shop\x20notification:','statusCode','•\x20Important\x20events\x0a\x0a','Example:\x0a','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Payout\x20rejected','stopBot','error','📱\x20Telegram\x20notification:\x20gateway\x20\x22','sendMessage','../config/database','💻\x20Browser:\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a',':\x20username=\x22','toString','length','message','/status\x20-\x20check\x20connection\x20status\x0a','User\x20','To\x20reconnect,\x20use\x20the\x20/start\x20command','handleSingleLineVerification','telegramUser','status','Available\x20usernames:\x0a','Error\x20in\x20handleSingleLineVerification:','defineProperty','errorMessage','35705170TGBAro','__esModule','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','🌐\x20IP:\x20`','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','ipAddress','shop','TELEGRAM_BOT_TOKEN','Error\x20handling\x20message:','blocked','🔗\x20TXID:\x20`','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','108451RnfKEj','\x20disconnected\x20from\x20shop\x20','Check\x20spelling\x20and\x20try\x20again.','•\x20`','chat','getGatewayDisplayNameForTelegram','log','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','Payment\x20failed','\x20\x20\x20Status:\x20','\x0aCheck\x20spelling\x20and\x20try\x20again.','5uTacQA','username','🔗\x20Endpoint:\x20`','\x20parts:\x20','bot','Markdown','🏦\x20Method:\x20`','createdAt','from','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','📊\x20Error\x20code:\x20`','../types/gateway','user\x20is\x20deactivated','userAgent','env','botToken','🔍\x20*Debug\x20Information*\x0a\x0a','chargebackAmount','sk_','sendShopNotification','2493044kEqKzr','Payment\x20refund','forEach','\x20\x20\x20Username:\x20`','📅\x20Time:\x20','.\x20*','requestId','gateway','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','text','\x20verified\x20for\x20shop\x20','`.\x0a\x0a','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','toLocaleDateString','customerName','notificationApiError','2351052bckBoA','node-telegram-bot-api','warn','onText','last_name','Username:\x20`','startsWith','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','remitterIban','secretKey','\x20USDT*\x0a','Payment\x20expired','join','customerIp','txid','🆔\x20Request\x20ID:\x20`','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','•\x20Payouts\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','adminNotes','💰\x20Amount:\x20*','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','notificationLogin','initializeBot','first_name','unknown\x20shop','🎉\x20*Congratulations!*\x0a\x0a','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','telegramId','🔔\x20*','❌\x20Shop\x20`','sendPaymentNotification','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','Error\x20handling\x20/debug\x20command:','*.\x0a\x0a','New\x20payment\x20created','pk_','shopId','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','processing','method','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','...\x22','📛\x20Name:\x20`','sendCustomNotification','✅\x20Welcome\x20back!\x0a\x0a','New\x20payout\x20created','/disconnect\x20-\x20disconnect\x20from\x20notifications','🔔\x20You\x20receive\x20notifications\x20about:\x0a','You\x20sent\x20','...`\x0a\x0a','\x20(@','🏦\x20IBAN:\x20`','chat\x20not\x20found','split','💸\x20Amount:\x20*','success','Commands:\x0a','`\x20not\x20found.\x0a\x0a','failed','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','endpoint'];a54_0x522c=function(){return _0x3db301;};return a54_0x522c();}Object[a54_0x1ab925(0x2b2)](exports,a54_0x1ab925(0x2b5),{'value':!![]}),exports['telegramBotService']=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x1ab925(0x20a))),database_1=__importDefault(require(a54_0x1ab925(0x2a3))),gateway_1=require(a54_0x1ab925(0x1f0));class TelegramBotService{constructor(){const _0x2323f2=a54_0x1ab925;this[_0x2323f2(0x2d0)]=null,this[_0x2323f2(0x1f4)]=process['env'][_0x2323f2(0x2bc)]||'',this[_0x2323f2(0x258)]=process[_0x2323f2(0x1f3)][_0x2323f2(0x292)]||'trapay_bot',this[_0x2323f2(0x1f4)]?this['initializeBot']():console[_0x2323f2(0x20b)](_0x2323f2(0x2b6));}[a54_0x1ab925(0x220)](){const _0x1456b1=a54_0x1ab925;try{this['bot']=new node_telegram_bot_api_1[(_0x1456b1(0x264))](this['botToken'],{'polling':!![]}),this[_0x1456b1(0x287)](),console[_0x1456b1(0x2c7)](_0x1456b1(0x26d)+this['botUsername']+_0x1456b1(0x24b));}catch(_0x2bac6c){console[_0x1456b1(0x2a0)](_0x1456b1(0x210),_0x2bac6c);}}[a54_0x1ab925(0x287)](){const _0x472b8e=a54_0x1ab925;if(!this['bot'])return;this['bot']['onText'](/\/start/,async _0x422fd8=>{const _0x2274ad=a54_0xc7da,_0x3b834f=_0x422fd8[_0x2274ad(0x2c5)]['id'],_0x51cec3=_0x422fd8[_0x2274ad(0x2d4)]?.['id'][_0x2274ad(0x2a7)](),_0x2fdcb8=_0x422fd8[_0x2274ad(0x2d4)]?.[_0x2274ad(0x2cd)],_0x2274aa=_0x422fd8[_0x2274ad(0x2d4)]?.[_0x2274ad(0x221)],_0x466143=_0x422fd8[_0x2274ad(0x2d4)]?.[_0x2274ad(0x20d)];if(!_0x51cec3)return;try{let _0x4e0dfa=await database_1['default'][_0x2274ad(0x2ae)][_0x2274ad(0x280)]({'where':{'telegramId':_0x51cec3},'include':{'shop':!![]}});!_0x4e0dfa?(_0x4e0dfa=await database_1['default'][_0x2274ad(0x2ae)][_0x2274ad(0x267)]({'data':{'telegramId':_0x51cec3,'username':_0x2fdcb8,'firstName':_0x2274aa,'lastName':_0x466143,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x2274ad(0x2c7)](_0x2274ad(0x262)+_0x51cec3+_0x2274ad(0x23c)+_0x2fdcb8+')')):_0x4e0dfa=await database_1['default'][_0x2274ad(0x2ae)][_0x2274ad(0x270)]({'where':{'telegramId':_0x51cec3},'data':{'username':_0x2fdcb8,'firstName':_0x2274aa,'lastName':_0x466143},'include':{'shop':!![]}}),_0x4e0dfa[_0x2274ad(0x277)]&&_0x4e0dfa[_0x2274ad(0x22e)]&&_0x4e0dfa['shop']?await this[_0x2274ad(0x2d0)]?.[_0x2274ad(0x2a2)](_0x3b834f,_0x2274ad(0x236)+(_0x2274ad(0x298)+_0x4e0dfa[_0x2274ad(0x2bb)][_0x2274ad(0x27f)]+'*\x0a')+(_0x2274ad(0x20e)+_0x4e0dfa['shop'][_0x2274ad(0x2cd)]+'`\x0a\x0a')+_0x2274ad(0x239)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+'•\x20Payouts\x0a\x0a'+_0x2274ad(0x242)+_0x2274ad(0x2aa)+_0x2274ad(0x238),{'parse_mode':_0x2274ad(0x2d1)}):(_0x4e0dfa[_0x2274ad(0x22e)]&&!_0x4e0dfa[_0x2274ad(0x277)]&&(await database_1[_0x2274ad(0x264)][_0x2274ad(0x2ae)][_0x2274ad(0x270)]({'where':{'telegramId':_0x51cec3},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x51cec3)),await this[_0x2274ad(0x2d0)]?.['sendMessage'](_0x3b834f,_0x2274ad(0x254)+_0x2274ad(0x2b9)+_0x2274ad(0x293)+_0x2274ad(0x29c)+_0x2274ad(0x2c8)+_0x2274ad(0x2b7),{'parse_mode':_0x2274ad(0x2d1)}));}catch(_0x223129){console[_0x2274ad(0x2a0)]('Error\x20handling\x20/start\x20command:',_0x223129),await this['bot']?.[_0x2274ad(0x2a2)](_0x3b834f,_0x2274ad(0x2d5));}}),this[_0x472b8e(0x2d0)][_0x472b8e(0x20c)](/\/disconnect/,async _0x1a9c91=>{const _0x3ff2c3=_0x472b8e,_0x396b3d=_0x1a9c91[_0x3ff2c3(0x2c5)]['id'],_0x34c58b=_0x1a9c91[_0x3ff2c3(0x2d4)]?.['id'][_0x3ff2c3(0x2a7)]();if(!_0x34c58b)return;try{const _0x31ba9c=await database_1[_0x3ff2c3(0x264)][_0x3ff2c3(0x2ae)][_0x3ff2c3(0x280)]({'where':{'telegramId':_0x34c58b},'include':{'shop':!![]}});if(!_0x31ba9c||!_0x31ba9c[_0x3ff2c3(0x277)]||!_0x31ba9c[_0x3ff2c3(0x22e)]){await this[_0x3ff2c3(0x2d0)]?.[_0x3ff2c3(0x2a2)](_0x396b3d,_0x3ff2c3(0x21e));return;}const _0x41f75a=_0x31ba9c[_0x3ff2c3(0x2bb)]?.[_0x3ff2c3(0x27f)]||_0x3ff2c3(0x222);await database_1[_0x3ff2c3(0x264)][_0x3ff2c3(0x2ae)][_0x3ff2c3(0x270)]({'where':{'telegramId':_0x34c58b},'data':{'shopId':null,'isVerified':![]}}),console[_0x3ff2c3(0x2c7)](_0x3ff2c3(0x248)+_0x34c58b+_0x3ff2c3(0x2c2)+_0x31ba9c[_0x3ff2c3(0x22e)]),await this[_0x3ff2c3(0x2d0)]?.[_0x3ff2c3(0x2a2)](_0x396b3d,_0x3ff2c3(0x263)+_0x41f75a+_0x3ff2c3(0x22b)+_0x3ff2c3(0x2ac),{'parse_mode':_0x3ff2c3(0x2d1)});}catch(_0x47ceda){console[_0x3ff2c3(0x2a0)](_0x3ff2c3(0x257),_0x47ceda),await this['bot']?.[_0x3ff2c3(0x2a2)](_0x396b3d,_0x3ff2c3(0x2d5));}}),this[_0x472b8e(0x2d0)][_0x472b8e(0x20c)](/\/status/,async _0x2402eb=>{const _0x493805=_0x472b8e,_0x26b827=_0x2402eb[_0x493805(0x2c5)]['id'],_0x229421=_0x2402eb['from']?.['id'][_0x493805(0x2a7)]();if(!_0x229421)return;try{const _0x1f1173=await database_1[_0x493805(0x264)][_0x493805(0x2ae)][_0x493805(0x280)]({'where':{'telegramId':_0x229421},'include':{'shop':!![]}});if(!_0x1f1173){await this[_0x493805(0x2d0)]?.[_0x493805(0x2a2)](_0x26b827,_0x493805(0x201)+_0x493805(0x27c));return;}if(!_0x1f1173[_0x493805(0x277)]||!_0x1f1173[_0x493805(0x22e)]||!_0x1f1173[_0x493805(0x2bb)]){await this[_0x493805(0x2d0)]?.[_0x493805(0x2a2)](_0x26b827,_0x493805(0x271)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x493805(0x2d0)]?.[_0x493805(0x2a2)](_0x26b827,_0x493805(0x273)+('✅\x20Connected\x20to\x20shop:\x20*'+_0x1f1173['shop'][_0x493805(0x27f)]+'*\x0a')+(_0x493805(0x274)+_0x1f1173[_0x493805(0x2bb)][_0x493805(0x2cd)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x1f1173[_0x493805(0x27b)][_0x493805(0x206)](_0x493805(0x275))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+_0x493805(0x242)+_0x493805(0x238),{'parse_mode':_0x493805(0x2d1)});}catch(_0x2cbd4c){console[_0x493805(0x2a0)]('Error\x20handling\x20/status\x20command:',_0x2cbd4c),await this[_0x493805(0x2d0)]?.[_0x493805(0x2a2)](_0x26b827,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot'][_0x472b8e(0x20c)](/\/debug/,async _0x529c18=>{const _0x507415=_0x472b8e,_0x241790=_0x529c18[_0x507415(0x2c5)]['id'],_0x307a11=_0x529c18[_0x507415(0x2d4)]?.['id'][_0x507415(0x2a7)]();if(!_0x307a11)return;try{const _0x10663d=await database_1[_0x507415(0x264)][_0x507415(0x2bb)][_0x507415(0x291)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x1b932b=_0x507415(0x1f5);_0x1b932b+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x307a11+_0x507415(0x24a),_0x1b932b+=_0x507415(0x2a5),_0x10663d[_0x507415(0x1fb)]((_0x2a0d52,_0x2d95e1)=>{const _0x4edbf4=_0x507415;_0x1b932b+=_0x2d95e1+0x1+_0x4edbf4(0x1fe)+_0x2a0d52[_0x4edbf4(0x27f)]+'*\x0a',_0x1b932b+=_0x4edbf4(0x1fc)+_0x2a0d52['username']+'`\x0a',_0x1b932b+=_0x4edbf4(0x2ca)+_0x2a0d52[_0x4edbf4(0x2af)]+'\x0a',_0x1b932b+='\x20\x20\x20Public\x20Key:\x20`'+_0x2a0d52[_0x4edbf4(0x249)]['substring'](0x0,0xf)+_0x4edbf4(0x23b);}),await this['bot']?.[_0x507415(0x2a2)](_0x241790,_0x1b932b,{'parse_mode':_0x507415(0x2d1)});}catch(_0x45c4c8){console[_0x507415(0x2a0)](_0x507415(0x22a),_0x45c4c8),await this[_0x507415(0x2d0)]?.[_0x507415(0x2a2)](_0x241790,_0x507415(0x285));}}),this[_0x472b8e(0x2d0)]['on']('message',async _0x4dfa80=>{const _0x527c8a=_0x472b8e;if(_0x4dfa80[_0x527c8a(0x202)]?.[_0x527c8a(0x20f)]('/'))return;const _0x43934e=_0x4dfa80[_0x527c8a(0x2c5)]['id'],_0x599843=_0x4dfa80[_0x527c8a(0x2d4)]?.['id'][_0x527c8a(0x2a7)](),_0x4e36f0=_0x4dfa80[_0x527c8a(0x202)]?.[_0x527c8a(0x250)]();if(!_0x599843||!_0x4e36f0)return;try{const _0x462f2d=await database_1[_0x527c8a(0x264)]['telegramUser'][_0x527c8a(0x280)]({'where':{'telegramId':_0x599843},'include':{'shop':!![]}});if(!_0x462f2d){await this[_0x527c8a(0x2d0)]?.[_0x527c8a(0x2a2)](_0x43934e,_0x527c8a(0x25c));return;}if(_0x462f2d[_0x527c8a(0x277)]&&_0x462f2d[_0x527c8a(0x22e)]&&_0x462f2d[_0x527c8a(0x2bb)]){await this['bot']?.[_0x527c8a(0x2a2)](_0x43934e,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x462f2d['shop'][_0x527c8a(0x27f)]+'*.\x0a\x0a'+_0x527c8a(0x279),{'parse_mode':_0x527c8a(0x2d1)});return;}const _0x2652ea=_0x4e36f0[_0x527c8a(0x23f)](/\s+/);if(_0x2652ea[_0x527c8a(0x2a8)]!==0x2){await this[_0x527c8a(0x2d0)]?.['sendMessage'](_0x43934e,_0x527c8a(0x219)+_0x527c8a(0x293)+_0x527c8a(0x29c)+_0x527c8a(0x2c8)+(_0x527c8a(0x23a)+_0x2652ea[_0x527c8a(0x2a8)]+_0x527c8a(0x2cf)+_0x2652ea[_0x527c8a(0x253)](_0x3c4f1f=>'`'+_0x3c4f1f+'`')[_0x527c8a(0x215)](',\x20')),{'parse_mode':_0x527c8a(0x2d1)});return;}const [_0x1f2ab2,_0xcd7d9]=_0x2652ea;console[_0x527c8a(0x2c7)](_0x527c8a(0x29d)+_0x599843+_0x527c8a(0x2a6)+_0x1f2ab2+_0x527c8a(0x27d)+_0xcd7d9['substring'](0x0,0xa)+_0x527c8a(0x233)),await this[_0x527c8a(0x2ad)](_0x43934e,_0x599843,_0x1f2ab2,_0xcd7d9);}catch(_0x56ee4c){console[_0x527c8a(0x2a0)](_0x527c8a(0x2bd),_0x56ee4c),await this['bot']?.[_0x527c8a(0x2a2)](_0x43934e,_0x527c8a(0x2d5));}}),this['bot']['on']('error',_0x523919=>{const _0x5cd541=_0x472b8e;console[_0x5cd541(0x2a0)]('Telegram\x20bot\x20error:',_0x523919);}),this[_0x472b8e(0x2d0)]['on'](_0x472b8e(0x295),_0x14e120=>{const _0x36b313=_0x472b8e;console[_0x36b313(0x2a0)]('Telegram\x20bot\x20polling\x20error:',_0x14e120);});}async[a54_0x1ab925(0x2ad)](_0xdf7c83,_0x2363f3,_0x536a1b,_0x33a1f9){const _0x21f8e1=a54_0x1ab925;try{console[_0x21f8e1(0x2c7)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x2363f3+_0x21f8e1(0x2a6)+_0x536a1b+_0x21f8e1(0x27d)+_0x33a1f9[_0x21f8e1(0x251)](0x0,0xa)+_0x21f8e1(0x233));if(!_0x536a1b||_0x536a1b[_0x21f8e1(0x2a8)]<0x3||_0x536a1b[_0x21f8e1(0x2a8)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x536a1b)){await this[_0x21f8e1(0x2d0)]?.[_0x21f8e1(0x2a2)](_0xdf7c83,'❌\x20Invalid\x20username\x20format:\x20`'+_0x536a1b+'`\x0a\x0a'+_0x21f8e1(0x2c0),{'parse_mode':_0x21f8e1(0x2d1)});return;}if(!_0x33a1f9||!_0x33a1f9[_0x21f8e1(0x20f)](_0x21f8e1(0x22d))&&!_0x33a1f9[_0x21f8e1(0x20f)](_0x21f8e1(0x1f7))){await this[_0x21f8e1(0x2d0)]?.[_0x21f8e1(0x2a2)](_0xdf7c83,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x21f8e1(0x2d1)});return;}const _0x4b6c83=await database_1[_0x21f8e1(0x264)][_0x21f8e1(0x2bb)][_0x21f8e1(0x280)]({'where':{'username':_0x536a1b},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x4b6c83){const _0x5ab70d=await database_1[_0x21f8e1(0x264)]['shop'][_0x21f8e1(0x291)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x277774=_0x21f8e1(0x289)+_0x536a1b+_0x21f8e1(0x243);_0x5ab70d[_0x21f8e1(0x2a8)]>0x0?(_0x277774+=_0x21f8e1(0x2b0),_0x5ab70d[_0x21f8e1(0x1fb)](_0x13f142=>{const _0x16280c=_0x21f8e1;_0x277774+=_0x16280c(0x2c4)+_0x13f142[_0x16280c(0x2cd)]+_0x16280c(0x272)+_0x13f142[_0x16280c(0x27f)]+')\x0a';}),_0x277774+=_0x21f8e1(0x2cb)):_0x277774+=_0x21f8e1(0x2c3);await this[_0x21f8e1(0x2d0)]?.[_0x21f8e1(0x2a2)](_0xdf7c83,_0x277774,{'parse_mode':'Markdown'});return;}if(_0x4b6c83['status']!==_0x21f8e1(0x265)){await this[_0x21f8e1(0x2d0)]?.[_0x21f8e1(0x2a2)](_0xdf7c83,_0x21f8e1(0x227)+_0x536a1b+'`\x20is\x20inactive.\x0a\x0a'+_0x21f8e1(0x28a),{'parse_mode':_0x21f8e1(0x2d1)});return;}if(_0x4b6c83['publicKey']!==_0x33a1f9&&_0x4b6c83[_0x21f8e1(0x212)]!==_0x33a1f9){await this['bot']?.[_0x21f8e1(0x2a2)](_0xdf7c83,_0x21f8e1(0x245)+_0x536a1b+_0x21f8e1(0x204)+_0x21f8e1(0x28f)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x21f8e1(0x2d1)});return;}const _0xb77c27=await database_1[_0x21f8e1(0x264)][_0x21f8e1(0x2ae)][_0x21f8e1(0x25b)]({'where':{'shopId':_0x4b6c83['id'],'isVerified':!![],'telegramId':{'not':_0x2363f3}}});if(_0xb77c27){await this['bot']?.[_0x21f8e1(0x2a2)](_0xdf7c83,_0x21f8e1(0x232)+_0x536a1b+_0x21f8e1(0x204)+_0x21f8e1(0x22f),{'parse_mode':_0x21f8e1(0x2d1)});return;}await database_1[_0x21f8e1(0x264)][_0x21f8e1(0x2ae)][_0x21f8e1(0x270)]({'where':{'telegramId':_0x2363f3},'data':{'shopId':_0x4b6c83['id'],'isVerified':!![]}}),await this[_0x21f8e1(0x2d0)]?.['sendMessage'](_0xdf7c83,_0x21f8e1(0x223)+_0x21f8e1(0x259)+('📱\x20Shop:\x20*'+_0x4b6c83[_0x21f8e1(0x27f)]+'*\x0a')+(_0x21f8e1(0x274)+_0x4b6c83[_0x21f8e1(0x2cd)]+'`\x0a\x0a')+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x21f8e1(0x27e)+'•\x20Payment\x20status\x20changes\x0a'+_0x21f8e1(0x21a)+_0x21f8e1(0x29b)+_0x21f8e1(0x242)+_0x21f8e1(0x2aa)+_0x21f8e1(0x238),{'parse_mode':'Markdown'}),console[_0x21f8e1(0x2c7)](_0x21f8e1(0x255)+_0x2363f3+_0x21f8e1(0x203)+_0x4b6c83[_0x21f8e1(0x2cd)]+'\x20via\x20single-line\x20input');}catch(_0x434531){console[_0x21f8e1(0x2a0)](_0x21f8e1(0x2b1),_0x434531),await this['bot']?.[_0x21f8e1(0x2a2)](_0xdf7c83,_0x21f8e1(0x21b));}}async['sendShopNotification'](_0x252847,_0x6e96e3,_0xea75e6){const _0x564ed3=a54_0x1ab925;if(!this['bot']){console['warn']('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x57d4af=await database_1['default']['telegramUser'][_0x564ed3(0x291)]({'where':{'shopId':_0x252847,'isVerified':!![]}});if(_0x57d4af[_0x564ed3(0x2a8)]===0x0){console[_0x564ed3(0x2c7)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x252847);return;}const _0x23e68d=_0x57d4af[_0x564ed3(0x253)](async _0x1e53be=>{const _0xbdaf73=_0x564ed3;try{await this['bot']?.[_0xbdaf73(0x2a2)](_0x1e53be[_0xbdaf73(0x225)],_0x6e96e3,_0xea75e6),console[_0xbdaf73(0x2c7)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x1e53be[_0xbdaf73(0x225)]);}catch(_0x5b13e9){console[_0xbdaf73(0x2a0)](_0xbdaf73(0x294)+_0x1e53be[_0xbdaf73(0x225)]+':',_0x5b13e9),_0x5b13e9 instanceof Error&&(_0x5b13e9[_0xbdaf73(0x2a9)][_0xbdaf73(0x261)](_0xbdaf73(0x2be))||_0x5b13e9[_0xbdaf73(0x2a9)][_0xbdaf73(0x261)](_0xbdaf73(0x23e))||_0x5b13e9[_0xbdaf73(0x2a9)][_0xbdaf73(0x261)](_0xbdaf73(0x1f1)))&&(await database_1[_0xbdaf73(0x264)][_0xbdaf73(0x2ae)][_0xbdaf73(0x270)]({'where':{'id':_0x1e53be['id']},'data':{'isVerified':![]}}),console[_0xbdaf73(0x2c7)](_0xbdaf73(0x2ab)+_0x1e53be[_0xbdaf73(0x225)]+_0xbdaf73(0x25a)));}});await Promise['allSettled'](_0x23e68d);}catch(_0x3a4302){console['error'](_0x564ed3(0x299),_0x3a4302);}}async[a54_0x1ab925(0x228)](_0x117121,_0x48bba6,_0x15905a){const _0xf00bb7=a54_0x1ab925,_0x59448b={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x4f7f6d={'created':_0xf00bb7(0x22c),'paid':'Payment\x20successfully\x20paid','failed':_0xf00bb7(0x2c9),'expired':_0xf00bb7(0x214),'refund':_0xf00bb7(0x1fa),'chargeback':'Payment\x20chargeback','processing':'Payment\x20is\x20being\x20processed'},_0x57ec57=_0x59448b[_0x15905a],_0x4cc8e5=_0x4f7f6d[_0x15905a],_0x2b27cb=(0x0,gateway_1[_0xf00bb7(0x2c6)])(_0x48bba6[_0xf00bb7(0x200)]);console[_0xf00bb7(0x2c7)](_0xf00bb7(0x2a1)+_0x48bba6['gateway']+_0xf00bb7(0x260)+_0x2b27cb+'\x22');let _0x267ec0=_0x57ec57+'\x20*'+_0x4cc8e5+_0xf00bb7(0x25d)+(_0xf00bb7(0x21d)+_0x48bba6[_0xf00bb7(0x24d)]+'\x20'+_0x48bba6[_0xf00bb7(0x288)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x48bba6[_0xf00bb7(0x296)]||_0x48bba6['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x48bba6['id']+'`\x0a')+(_0xf00bb7(0x25e)+_0x2b27cb+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x48bba6['createdAt'])[_0xf00bb7(0x290)](_0xf00bb7(0x275))+'\x0a');if(_0x48bba6[_0xf00bb7(0x207)]||_0x48bba6['customerEmail']||_0x48bba6[_0xf00bb7(0x211)]||_0x48bba6[_0xf00bb7(0x216)]||_0x48bba6['customerUa']){_0x267ec0+='\x0a👤\x20*Customer\x20Information:*\x0a';_0x48bba6[_0xf00bb7(0x207)]&&(_0x267ec0+=_0xf00bb7(0x234)+_0x48bba6[_0xf00bb7(0x207)]+'`\x0a');_0x48bba6[_0xf00bb7(0x278)]&&(_0x267ec0+=_0xf00bb7(0x283)+_0x48bba6[_0xf00bb7(0x278)]+'`\x0a');_0x48bba6[_0xf00bb7(0x211)]&&(_0x267ec0+=_0xf00bb7(0x23d)+_0x48bba6['remitterIban']+'`\x0a');_0x48bba6[_0xf00bb7(0x216)]&&(_0x267ec0+=_0xf00bb7(0x2b8)+_0x48bba6[_0xf00bb7(0x216)]+'`\x0a');if(_0x48bba6[_0xf00bb7(0x28b)]){const _0xc97332=_0x48bba6[_0xf00bb7(0x28b)][_0xf00bb7(0x2a8)]>0x32?_0x48bba6['customerUa'][_0xf00bb7(0x251)](0x0,0x32)+'...':_0x48bba6[_0xf00bb7(0x28b)];_0x267ec0+='💻\x20Browser:\x20`'+_0xc97332+'`\x0a';}}_0x15905a===_0xf00bb7(0x268)&&_0x48bba6[_0xf00bb7(0x1f6)]&&(_0x267ec0+='💸\x20Penalty\x20amount:\x20*'+_0x48bba6[_0xf00bb7(0x1f6)]+_0xf00bb7(0x213)),_0x15905a===_0xf00bb7(0x230)&&(_0x267ec0+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x48bba6[_0xf00bb7(0x21c)]&&(_0x267ec0+='📝\x20Notes:\x20'+_0x48bba6[_0xf00bb7(0x21c)]+'\x0a'),await this[_0xf00bb7(0x1f8)](_0x117121,_0x267ec0,{'parse_mode':_0xf00bb7(0x2d1)});}async['sendPayoutNotification'](_0x1b0c4f,_0x372166,_0x4117a8){const _0x58bbe4=a54_0x1ab925,_0x11cca9={'created':'📤','completed':'✅','rejected':'❌'},_0x51e228={'created':_0x58bbe4(0x237),'completed':_0x58bbe4(0x266),'rejected':_0x58bbe4(0x29e)},_0x469060=_0x11cca9[_0x4117a8],_0x374467=_0x51e228[_0x4117a8],_0x298f8d=_0x469060+'\x20*'+_0x374467+_0x58bbe4(0x25d)+(_0x58bbe4(0x240)+_0x372166[_0x58bbe4(0x24d)]+'\x20USD*\x0a')+(_0x58bbe4(0x2d2)+_0x372166['method']+'`\x0a')+(_0x58bbe4(0x26b)+_0x372166['id']+'`\x0a')+(_0x58bbe4(0x256)+new Date(_0x372166[_0x58bbe4(0x2d3)])[_0x58bbe4(0x290)](_0x58bbe4(0x275))+'\x0a')+(_0x372166[_0x58bbe4(0x217)]?_0x58bbe4(0x2bf)+_0x372166[_0x58bbe4(0x217)]+'`':'');await this[_0x58bbe4(0x1f8)](_0x1b0c4f,_0x298f8d,{'parse_mode':_0x58bbe4(0x2d1)});}async[a54_0x1ab925(0x24f)](_0x214bcf,_0x10901e){const _0x109c36=a54_0x1ab925;try{const _0x21f8ab=await database_1['default']['shopSettings'][_0x109c36(0x280)]({'where':{'shopId':_0x214bcf},'select':{'notificationLogin':!![]}});if(!_0x21f8ab?.[_0x109c36(0x21f)]){console['log'](_0x109c36(0x229)+_0x214bcf);return;}const _0x5c37f4=_0x10901e['success']?'🔐':'🚨',_0x28d2e4=_0x10901e[_0x109c36(0x241)]?'Successful\x20login':_0x109c36(0x24e);let _0x447a5b=_0x5c37f4+'\x20*'+_0x28d2e4+_0x109c36(0x25d)+(_0x109c36(0x274)+_0x10901e[_0x109c36(0x2cd)]+'`\x0a')+(_0x109c36(0x1fd)+_0x10901e[_0x109c36(0x276)][_0x109c36(0x290)]('en-US')+'\x0a');_0x10901e[_0x109c36(0x2ba)]&&(_0x447a5b+='🌐\x20IP\x20address:\x20`'+_0x10901e[_0x109c36(0x2ba)]+'`\x0a');if(_0x10901e[_0x109c36(0x1f2)]){const _0x3c11c1=_0x10901e[_0x109c36(0x1f2)]['length']>0x32?_0x10901e[_0x109c36(0x1f2)][_0x109c36(0x251)](0x0,0x32)+_0x109c36(0x27a):_0x10901e[_0x109c36(0x1f2)];_0x447a5b+=_0x109c36(0x2a4)+_0x3c11c1+'`\x0a';}!_0x10901e[_0x109c36(0x241)]&&(_0x447a5b+=_0x109c36(0x26a)),await this[_0x109c36(0x1f8)](_0x214bcf,_0x447a5b,{'parse_mode':_0x109c36(0x2d1)}),console['log'](_0x109c36(0x205)+_0x214bcf+':\x20'+(_0x10901e[_0x109c36(0x241)]?_0x109c36(0x241):_0x109c36(0x244)));}catch(_0x9e4926){console['error']('Failed\x20to\x20send\x20login\x20notification:',_0x9e4926);}}async[a54_0x1ab925(0x282)](_0x201d78,_0x390100){const _0x171db4=a54_0x1ab925;try{const _0x7940bf=await database_1['default']['shopSettings']['findUnique']({'where':{'shopId':_0x201d78},'select':{'notificationApiError':!![]}});if(!_0x7940bf?.[_0x171db4(0x208)]){console['log'](_0x171db4(0x286)+_0x201d78);return;}let _0x3df273='🚨\x20*API\x20Error*\x0a\x0a'+(_0x171db4(0x2ce)+_0x390100[_0x171db4(0x231)]+'\x20'+_0x390100[_0x171db4(0x246)]+'`\x0a')+(_0x171db4(0x1fd)+_0x390100['timestamp'][_0x171db4(0x290)](_0x171db4(0x275))+'\x0a');_0x390100['statusCode']&&(_0x3df273+=_0x171db4(0x1ef)+_0x390100[_0x171db4(0x29a)]+'`\x0a'),_0x3df273+=_0x171db4(0x25f)+_0x390100[_0x171db4(0x2b3)]+'`\x0a',_0x390100[_0x171db4(0x1ff)]&&(_0x3df273+=_0x171db4(0x218)+_0x390100[_0x171db4(0x1ff)]+'`\x0a'),_0x3df273+=_0x171db4(0x297),await this[_0x171db4(0x1f8)](_0x201d78,_0x3df273,{'parse_mode':_0x171db4(0x2d1)}),console[_0x171db4(0x2c7)](_0x171db4(0x224)+_0x201d78+':\x20'+_0x390100[_0x171db4(0x246)]);}catch(_0x26a8af){console[_0x171db4(0x2a0)](_0x171db4(0x28e),_0x26a8af);}}async[a54_0x1ab925(0x235)](_0x4f34e9,_0x3bf454,_0x632e70){const _0x53a3a2=a54_0x1ab925;let _0x502171=_0x53a3a2(0x226)+_0x3bf454+_0x53a3a2(0x25d);for(const [_0x37768f,_0x32db82]of Object['entries'](_0x632e70)){_0x32db82!==null&&_0x32db82!==undefined&&(_0x502171+=_0x37768f+_0x53a3a2(0x26f)+_0x32db82+'`\x0a');}await this[_0x53a3a2(0x1f8)](_0x4f34e9,_0x502171,{'parse_mode':_0x53a3a2(0x2d1)});}[a54_0x1ab925(0x26e)](){const _0x68f829=a54_0x1ab925;return{'isActive':!!this[_0x68f829(0x2d0)],'username':this[_0x68f829(0x258)]};}[a54_0x1ab925(0x29f)](){const _0x570e43=a54_0x1ab925;this[_0x570e43(0x2d0)]&&(this[_0x570e43(0x2d0)][_0x570e43(0x269)](),this[_0x570e43(0x2d0)]=null,console[_0x570e43(0x2c7)](_0x570e43(0x252)));}}function a54_0xc7da(_0x1aec9b,_0x2799c1){const _0x522cd6=a54_0x522c();return a54_0xc7da=function(_0xc7daa9,_0x15fac6){_0xc7daa9=_0xc7daa9-0x1ef;let _0x4e51d3=_0x522cd6[_0xc7daa9];return _0x4e51d3;},a54_0xc7da(_0x1aec9b,_0x2799c1);}exports['TelegramBotService']=TelegramBotService,exports['telegramBotService']=new TelegramBotService();