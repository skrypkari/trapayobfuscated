'use strict';const a59_0x27e52d=a59_0x1657;function a59_0x16c4(){const _0x1f40b3=['Failed\x20to\x20send\x20login\x20notification:','1669600Vozvwt','Telegram\x20bot\x20polling\x20error:','currency','✅\x20Connected\x20to\x20shop:\x20*','Use\x20/start\x20to\x20begin.','findUnique','New\x20payment\x20created','TelegramBotService','\x20USDT*\x0a','chat','toString','publicKey','💻\x20Browser:\x20`','5sWGLSx','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','🎉\x20*Congratulations!*\x0a\x0a','Error\x20in\x20handleSingleLineVerification:','chargeback','length','❌\x20Shop\x20`','❌\x20Error\x20getting\x20debug\x20information.','572070Ngdftk','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','sendMessage','status','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','`\x20(','polling_error','shop','•\x20Important\x20events\x0a\x0a','New\x20payout\x20created','951302HbDtbz','🌐\x20IP\x20address:\x20`','allSettled','🏦\x20IBAN:\x20`','📊\x20Error\x20code:\x20`','4375721Pmbiwe','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','en-US','botUsername','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','\x0a👤\x20*Customer\x20Information:*\x0a','🆔\x20Payout\x20ID:\x20`','txid','substring','\x20\x20\x20Status:\x20','👤\x20Username:\x20`','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','`.\x0a\x0a','../types/gateway','Username:\x20`','ACTIVE','Use\x20/start\x20to\x20connect.','trapay_bot','•\x20New\x20payments\x0a','shopId','\x20parts:\x20','📱\x20Telegram\x20notification:\x20gateway\x20\x22','message','`\x20not\x20found.\x0a\x0a','Error\x20handling\x20message:','botToken','findFirst','\x20\x20\x20Public\x20Key:\x20`','You\x20sent\x20','from','customerName','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','amount','36YVRYnw','Markdown','📧\x20Email:\x20`','sendLoginNotification','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','*\x0a\x0a','customerIp','Available\x20usernames:\x0a','username','📅\x20Time:\x20','🔗\x20Endpoint:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','💸\x20Penalty\x20amount:\x20*','📅\x20Date:\x20','user\x20is\x20deactivated','trim','toLocaleDateString','join','...','unknown\x20shop','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','adminNotes','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','•\x20Payouts\x0a\x0a','timestamp','🔍\x20*Debug\x20Information*\x0a\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','log','Payment\x20is\x20being\x20processed','📅\x20Connection\x20date:\x20','endpoint','onText','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','getGatewayDisplayNameForTelegram','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','🆔\x20Payment\x20ID:\x20`','customerUa','first_name','errorMessage','processing','8clBqst','update','remitterIban','Commands:\x0a','stopBot','🔔\x20*','blocked','...\x22','startsWith','entries','/status\x20-\x20check\x20connection\x20status\x0a','create','requestId','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','sendPayoutNotification','🆔\x20Request\x20ID:\x20`','createdAt','💸\x20Amount:\x20*','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','customerEmail','•\x20`','sk_','\x20verified\x20for\x20shop\x20','telegramUser','../config/database','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','🔔\x20You\x20receive\x20notifications\x20about:\x0a','orderId','...`\x0a\x0a','chargebackAmount','5151234hUjsMu','Error\x20handling\x20/disconnect\x20command:','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','telegramBotService','userAgent','shopSettings','Payment\x20successfully\x20paid','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','bot','success',':\x20username=\x22','node-telegram-bot-api','🏦\x20Method:\x20`','✅\x20Welcome\x20back!\x0a\x0a','notificationApiError','stopPolling','•\x20Payment\x20status\x20changes\x0a','findMany','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','isVerified','Telegram\x20bot\x20error:','toLocaleString','getBotInfo','gateway','Example:\x0a','\x20initialized\x20successfully','map','Error\x20handling\x20/start\x20command:','error','__importDefault','text','🏪\x20Available\x20shops\x20in\x20system:\x0a','\x20disconnected\x20from\x20shop\x20','statusCode','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','name','test','env','\x22\x20->\x20display\x20\x22','pk_','\x20via\x20single-line\x20input','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','TELEGRAM_BOT_TOKEN','\x20USD*\x0a','✅\x20Telegram\x20user\x20','📊\x20*Connection\x20Status*\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','❌\x20Error:\x20`','🔗\x20TXID:\x20`','setupBotHandlers','❌\x20Please\x20use\x20/start\x20command\x20first','🌐\x20IP:\x20`','🛑\x20Telegram\x20bot\x20stopped','/disconnect\x20-\x20disconnect\x20from\x20notifications','.\x20*','User\x20','sendShopNotification','sendApiErrorNotification','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','Error\x20handling\x20/debug\x20command:','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','📛\x20Name:\x20`','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','*.\x0a\x0a','split','default','includes','telegramId','🔔\x20Notifications\x20are\x20active\x0a\x0a','1KZJBZI','Check\x20spelling\x20and\x20try\x20again.','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','forEach','✅\x20Telegram\x20bot\x20@','📝\x20Order\x20ID:\x20`','Payout\x20completed','461048JJgPJR','4414135TlsJbF','initializeBot','__esModule','updatedAt','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','warn','`\x0a\x0a','sendCustomNotification','📱\x20Shop:\x20*'];a59_0x16c4=function(){return _0x1f40b3;};return a59_0x16c4();}(function(_0x3c8deb,_0x300534){const _0x380d92=a59_0x1657,_0x28f1f0=_0x3c8deb();while(!![]){try{const _0x42480d=parseInt(_0x380d92(0xfa))/0x1*(parseInt(_0x380d92(0x12c))/0x2)+parseInt(_0x380d92(0x122))/0x3*(-parseInt(_0x380d92(0x96))/0x4)+parseInt(_0x380d92(0x11a))/0x5*(-parseInt(_0x380d92(0xb4))/0x6)+parseInt(_0x380d92(0x131))/0x7+-parseInt(_0x380d92(0x102))/0x8*(-parseInt(_0x380d92(0x154))/0x9)+parseInt(_0x380d92(0x10d))/0xa+parseInt(_0x380d92(0x103))/0xb;if(_0x42480d===_0x300534)break;else _0x28f1f0['push'](_0x28f1f0['shift']());}catch(_0x39c504){_0x28f1f0['push'](_0x28f1f0['shift']());}}}(a59_0x16c4,0xa1094));var __importDefault=this&&this[a59_0x27e52d(0xd1)]||function(_0x5cf881){return _0x5cf881&&_0x5cf881['__esModule']?_0x5cf881:{'default':_0x5cf881};};Object['defineProperty'](exports,a59_0x27e52d(0x105),{'value':!![]}),exports['telegramBotService']=exports[a59_0x27e52d(0x114)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a59_0x27e52d(0xbf))),database_1=__importDefault(require(a59_0x27e52d(0xae))),gateway_1=require(a59_0x27e52d(0x13e));class TelegramBotService{constructor(){const _0x471450=a59_0x27e52d;this[_0x471450(0xbc)]=null,this[_0x471450(0x14a)]=process[_0x471450(0xd9)][_0x471450(0xdf)]||'',this[_0x471450(0x134)]=process[_0x471450(0xd9)]['TELEGRAM_BOT_USERNAME']||_0x471450(0x142),this['botToken']?this[_0x471450(0x104)]():console[_0x471450(0x108)](_0x471450(0x152));}[a59_0x27e52d(0x104)](){const _0x294d26=a59_0x27e52d;try{this[_0x294d26(0xbc)]=new node_telegram_bot_api_1['default'](this[_0x294d26(0x14a)],{'polling':!![]}),this[_0x294d26(0xe6)](),console[_0x294d26(0x16f)](_0x294d26(0xff)+this[_0x294d26(0x134)]+_0x294d26(0xcd));}catch(_0x284a64){console[_0x294d26(0xd0)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x284a64);}}['setupBotHandlers'](){const _0x2d43e3=a59_0x27e52d;if(!this['bot'])return;this[_0x2d43e3(0xbc)][_0x2d43e3(0x173)](/\/start/,async _0x32a931=>{const _0xaa4a=_0x2d43e3,_0x2b4eaf=_0x32a931['chat']['id'],_0x10dd87=_0x32a931[_0xaa4a(0x14e)]?.['id'][_0xaa4a(0x117)](),_0x12bbc8=_0x32a931['from']?.[_0xaa4a(0x15c)],_0x2f8466=_0x32a931[_0xaa4a(0x14e)]?.[_0xaa4a(0x179)],_0x9bd20c=_0x32a931[_0xaa4a(0x14e)]?.['last_name'];if(!_0x10dd87)return;try{let _0x7d1804=await database_1[_0xaa4a(0xf6)][_0xaa4a(0xad)]['findUnique']({'where':{'telegramId':_0x10dd87},'include':{'shop':!![]}});!_0x7d1804?(_0x7d1804=await database_1[_0xaa4a(0xf6)][_0xaa4a(0xad)][_0xaa4a(0xa1)]({'data':{'telegramId':_0x10dd87,'username':_0x12bbc8,'firstName':_0x2f8466,'lastName':_0x9bd20c,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0xaa4a(0x16f)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x10dd87+'\x20(@'+_0x12bbc8+')')):_0x7d1804=await database_1['default'][_0xaa4a(0xad)][_0xaa4a(0x97)]({'where':{'telegramId':_0x10dd87},'data':{'username':_0x12bbc8,'firstName':_0x2f8466,'lastName':_0x9bd20c},'include':{'shop':!![]}}),_0x7d1804[_0xaa4a(0xc7)]&&_0x7d1804[_0xaa4a(0x144)]&&_0x7d1804['shop']?await this[_0xaa4a(0xbc)]?.[_0xaa4a(0x124)](_0x2b4eaf,_0xaa4a(0xc1)+(_0xaa4a(0x168)+_0x7d1804[_0xaa4a(0x129)][_0xaa4a(0xd7)]+'*\x0a')+(_0xaa4a(0x13f)+_0x7d1804[_0xaa4a(0x129)][_0xaa4a(0x15c)]+_0xaa4a(0x109))+_0xaa4a(0xb0)+_0xaa4a(0x143)+_0xaa4a(0xc4)+_0xaa4a(0x16b)+_0xaa4a(0x99)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0xaa4a(0xea),{'parse_mode':_0xaa4a(0x155)}):(_0x7d1804[_0xaa4a(0x144)]&&!_0x7d1804[_0xaa4a(0xc7)]&&(await database_1[_0xaa4a(0xf6)][_0xaa4a(0xad)][_0xaa4a(0x97)]({'where':{'telegramId':_0x10dd87},'data':{'shopId':null,'isVerified':![]}}),console[_0xaa4a(0x16f)](_0xaa4a(0xa3)+_0x10dd87)),await this['bot']?.[_0xaa4a(0x124)](_0x2b4eaf,_0xaa4a(0x150)+_0xaa4a(0xfd)+_0xaa4a(0xfc)+'Example:\x0a'+_0xaa4a(0x123)+_0xaa4a(0x107),{'parse_mode':_0xaa4a(0x155)}));}catch(_0x2bc1fe){console['error'](_0xaa4a(0xcf),_0x2bc1fe),await this['bot']?.[_0xaa4a(0x124)](_0x2b4eaf,_0xaa4a(0x135));}}),this['bot'][_0x2d43e3(0x173)](/\/disconnect/,async _0x5c60a4=>{const _0x5dc00d=_0x2d43e3,_0x2e1815=_0x5c60a4['chat']['id'],_0xf4592d=_0x5c60a4['from']?.['id']['toString']();if(!_0xf4592d)return;try{const _0x12cc48=await database_1[_0x5dc00d(0xf6)][_0x5dc00d(0xad)][_0x5dc00d(0x112)]({'where':{'telegramId':_0xf4592d},'include':{'shop':!![]}});if(!_0x12cc48||!_0x12cc48[_0x5dc00d(0xc7)]||!_0x12cc48[_0x5dc00d(0x144)]){await this[_0x5dc00d(0xbc)]?.[_0x5dc00d(0x124)](_0x2e1815,_0x5dc00d(0x15f));return;}const _0x5676ea=_0x12cc48[_0x5dc00d(0x129)]?.[_0x5dc00d(0xd7)]||_0x5dc00d(0x167);await database_1[_0x5dc00d(0xf6)][_0x5dc00d(0xad)][_0x5dc00d(0x97)]({'where':{'telegramId':_0xf4592d},'data':{'shopId':null,'isVerified':![]}}),console[_0x5dc00d(0x16f)]('🔌\x20User\x20'+_0xf4592d+_0x5dc00d(0xd4)+_0x12cc48[_0x5dc00d(0x144)]),await this[_0x5dc00d(0xbc)]?.[_0x5dc00d(0x124)](_0x2e1815,_0x5dc00d(0x11b)+_0x5676ea+_0x5dc00d(0xf4)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':'Markdown'});}catch(_0x2d14f6){console[_0x5dc00d(0xd0)](_0x5dc00d(0xb5),_0x2d14f6),await this[_0x5dc00d(0xbc)]?.['sendMessage'](_0x2e1815,_0x5dc00d(0x135));}}),this[_0x2d43e3(0xbc)][_0x2d43e3(0x173)](/\/status/,async _0x41170f=>{const _0x41a70f=_0x2d43e3,_0x3cd547=_0x41170f[_0x41a70f(0x116)]['id'],_0x3facdb=_0x41170f['from']?.['id'][_0x41a70f(0x117)]();if(!_0x3facdb)return;try{const _0x618d5c=await database_1[_0x41a70f(0xf6)][_0x41a70f(0xad)]['findUnique']({'where':{'telegramId':_0x3facdb},'include':{'shop':!![]}});if(!_0x618d5c){await this[_0x41a70f(0xbc)]?.[_0x41a70f(0x124)](_0x3cd547,_0x41a70f(0x13c)+_0x41a70f(0x111));return;}if(!_0x618d5c[_0x41a70f(0xc7)]||!_0x618d5c['shopId']||!_0x618d5c[_0x41a70f(0x129)]){await this[_0x41a70f(0xbc)]?.['sendMessage'](_0x3cd547,_0x41a70f(0xe3)+_0x41a70f(0x141));return;}await this[_0x41a70f(0xbc)]?.[_0x41a70f(0x124)](_0x3cd547,_0x41a70f(0xe2)+(_0x41a70f(0x110)+_0x618d5c[_0x41a70f(0x129)]['name']+'*\x0a')+(_0x41a70f(0x13b)+_0x618d5c[_0x41a70f(0x129)]['username']+'`\x0a')+(_0x41a70f(0x171)+_0x618d5c[_0x41a70f(0x106)][_0x41a70f(0x164)]('en-US')+'\x0a\x0a')+_0x41a70f(0xf9)+'Commands:\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x41a70f(0x155)});}catch(_0x22ec25){console[_0x41a70f(0xd0)]('Error\x20handling\x20/status\x20command:',_0x22ec25),await this['bot']?.[_0x41a70f(0x124)](_0x3cd547,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x2d43e3(0xbc)][_0x2d43e3(0x173)](/\/debug/,async _0x1d915d=>{const _0x351c30=_0x2d43e3,_0x2f5c3d=_0x1d915d[_0x351c30(0x116)]['id'],_0x3970c8=_0x1d915d['from']?.['id'][_0x351c30(0x117)]();if(!_0x3970c8)return;try{const _0x223252=await database_1[_0x351c30(0xf6)][_0x351c30(0x129)][_0x351c30(0xc5)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x40a2ed=_0x351c30(0x16d);_0x40a2ed+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x3970c8+_0x351c30(0x109),_0x40a2ed+=_0x351c30(0xd3),_0x223252[_0x351c30(0xfe)]((_0x19ce45,_0x5ea53f)=>{const _0x19ef82=_0x351c30;_0x40a2ed+=_0x5ea53f+0x1+_0x19ef82(0xeb)+_0x19ce45[_0x19ef82(0xd7)]+'*\x0a',_0x40a2ed+='\x20\x20\x20Username:\x20`'+_0x19ce45[_0x19ef82(0x15c)]+'`\x0a',_0x40a2ed+=_0x19ef82(0x13a)+_0x19ce45[_0x19ef82(0x125)]+'\x0a',_0x40a2ed+=_0x19ef82(0x14c)+_0x19ce45[_0x19ef82(0x118)]['substring'](0x0,0xf)+_0x19ef82(0xb2);}),await this[_0x351c30(0xbc)]?.[_0x351c30(0x124)](_0x2f5c3d,_0x40a2ed,{'parse_mode':_0x351c30(0x155)});}catch(_0x4f454d){console[_0x351c30(0xd0)](_0x351c30(0xf0),_0x4f454d),await this[_0x351c30(0xbc)]?.[_0x351c30(0x124)](_0x2f5c3d,_0x351c30(0x121));}}),this[_0x2d43e3(0xbc)]['on']('message',async _0x2c41be=>{const _0x564d0d=_0x2d43e3;if(_0x2c41be[_0x564d0d(0xd2)]?.[_0x564d0d(0x9e)]('/'))return;const _0x3dfe4c=_0x2c41be[_0x564d0d(0x116)]['id'],_0x204db2=_0x2c41be[_0x564d0d(0x14e)]?.['id'][_0x564d0d(0x117)](),_0x56053d=_0x2c41be[_0x564d0d(0xd2)]?.[_0x564d0d(0x163)]();if(!_0x204db2||!_0x56053d)return;try{const _0x1d3744=await database_1[_0x564d0d(0xf6)][_0x564d0d(0xad)][_0x564d0d(0x112)]({'where':{'telegramId':_0x204db2},'include':{'shop':!![]}});if(!_0x1d3744){await this[_0x564d0d(0xbc)]?.[_0x564d0d(0x124)](_0x3dfe4c,_0x564d0d(0xe7));return;}if(_0x1d3744['isVerified']&&_0x1d3744[_0x564d0d(0x144)]&&_0x1d3744[_0x564d0d(0x129)]){await this[_0x564d0d(0xbc)]?.[_0x564d0d(0x124)](_0x3dfe4c,_0x564d0d(0xaf)+_0x1d3744[_0x564d0d(0x129)][_0x564d0d(0xd7)]+_0x564d0d(0xf4)+_0x564d0d(0xc6),{'parse_mode':_0x564d0d(0x155)});return;}const _0x156ab6=_0x56053d[_0x564d0d(0xf5)](/\s+/);if(_0x156ab6[_0x564d0d(0x11f)]!==0x2){await this[_0x564d0d(0xbc)]?.[_0x564d0d(0x124)](_0x3dfe4c,_0x564d0d(0xa8)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x564d0d(0xcc)+_0x564d0d(0x123)+(_0x564d0d(0x14d)+_0x156ab6['length']+_0x564d0d(0x145)+_0x156ab6[_0x564d0d(0xce)](_0x245536=>'`'+_0x245536+'`')[_0x564d0d(0x165)](',\x20')),{'parse_mode':_0x564d0d(0x155)});return;}const [_0x5cac04,_0x12a6ec]=_0x156ab6;console[_0x564d0d(0x16f)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x204db2+_0x564d0d(0xbe)+_0x5cac04+'\x22,\x20apiKey=\x22'+_0x12a6ec['substring'](0x0,0xa)+_0x564d0d(0x9d)),await this['handleSingleLineVerification'](_0x3dfe4c,_0x204db2,_0x5cac04,_0x12a6ec);}catch(_0x37402e){console['error'](_0x564d0d(0x149),_0x37402e),await this[_0x564d0d(0xbc)]?.['sendMessage'](_0x3dfe4c,_0x564d0d(0x135));}}),this['bot']['on'](_0x2d43e3(0xd0),_0x1b2b54=>{const _0x45f6bc=_0x2d43e3;console[_0x45f6bc(0xd0)](_0x45f6bc(0xc8),_0x1b2b54);}),this[_0x2d43e3(0xbc)]['on'](_0x2d43e3(0x128),_0x371b3d=>{const _0x3e90c3=_0x2d43e3;console[_0x3e90c3(0xd0)](_0x3e90c3(0x10e),_0x371b3d);});}async['handleSingleLineVerification'](_0x1c1425,_0x1ec6b4,_0x31e7fc,_0xd829a0){const _0x569578=a59_0x27e52d;try{console['log'](_0x569578(0xb6)+_0x1ec6b4+_0x569578(0xbe)+_0x31e7fc+'\x22,\x20apiKey=\x22'+_0xd829a0[_0x569578(0x139)](0x0,0xa)+_0x569578(0x9d));if(!_0x31e7fc||_0x31e7fc[_0x569578(0x11f)]<0x3||_0x31e7fc[_0x569578(0x11f)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x569578(0xd8)](_0x31e7fc)){await this[_0x569578(0xbc)]?.[_0x569578(0x124)](_0x1c1425,'❌\x20Invalid\x20username\x20format:\x20`'+_0x31e7fc+'`\x0a\x0a'+_0x569578(0x16e),{'parse_mode':_0x569578(0x155)});return;}if(!_0xd829a0||!_0xd829a0[_0x569578(0x9e)](_0x569578(0xdb))&&!_0xd829a0['startsWith'](_0x569578(0xab))){await this[_0x569578(0xbc)]?.[_0x569578(0x124)](_0x1c1425,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x569578(0x155)});return;}const _0x3b6a02=await database_1[_0x569578(0xf6)][_0x569578(0x129)][_0x569578(0x112)]({'where':{'username':_0x31e7fc},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x3b6a02){const _0x42a838=await database_1[_0x569578(0xf6)][_0x569578(0x129)][_0x569578(0xc5)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x4002e9='❌\x20Shop\x20with\x20username\x20`'+_0x31e7fc+_0x569578(0x148);_0x42a838['length']>0x0?(_0x4002e9+=_0x569578(0x15b),_0x42a838['forEach'](_0x4252ac=>{const _0x33ef31=_0x569578;_0x4002e9+=_0x33ef31(0xaa)+_0x4252ac['username']+_0x33ef31(0x127)+_0x4252ac[_0x33ef31(0xd7)]+')\x0a';}),_0x4002e9+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x4002e9+=_0x569578(0xfb);await this[_0x569578(0xbc)]?.[_0x569578(0x124)](_0x1c1425,_0x4002e9,{'parse_mode':_0x569578(0x155)});return;}if(_0x3b6a02[_0x569578(0x125)]!==_0x569578(0x140)){await this[_0x569578(0xbc)]?.[_0x569578(0x124)](_0x1c1425,_0x569578(0x120)+_0x31e7fc+'`\x20is\x20inactive.\x0a\x0a'+'Contact\x20administrator.',{'parse_mode':_0x569578(0x155)});return;}if(_0x3b6a02[_0x569578(0x118)]!==_0xd829a0&&_0x3b6a02['secretKey']!==_0xd829a0){await this[_0x569578(0xbc)]?.[_0x569578(0x124)](_0x1c1425,_0x569578(0x174)+_0x31e7fc+_0x569578(0x13d)+_0x569578(0xf1)+_0x569578(0xdd),{'parse_mode':_0x569578(0x155)});return;}const _0x4ea4a4=await database_1[_0x569578(0xf6)][_0x569578(0xad)][_0x569578(0x14b)]({'where':{'shopId':_0x3b6a02['id'],'isVerified':!![],'telegramId':{'not':_0x1ec6b4}}});if(_0x4ea4a4){await this[_0x569578(0xbc)]?.[_0x569578(0x124)](_0x1c1425,_0x569578(0x132)+_0x31e7fc+_0x569578(0x13d)+_0x569578(0xbb),{'parse_mode':_0x569578(0x155)});return;}await database_1['default']['telegramUser']['update']({'where':{'telegramId':_0x1ec6b4},'data':{'shopId':_0x3b6a02['id'],'isVerified':!![]}}),await this['bot']?.[_0x569578(0x124)](_0x1c1425,_0x569578(0x11c)+_0x569578(0xde)+(_0x569578(0x10b)+_0x3b6a02[_0x569578(0xd7)]+'*\x0a')+(_0x569578(0x13b)+_0x3b6a02['username']+_0x569578(0x109))+_0x569578(0x176)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+'•\x20Payouts\x0a'+_0x569578(0x12a)+_0x569578(0x99)+_0x569578(0xa0)+_0x569578(0xea),{'parse_mode':_0x569578(0x155)}),console[_0x569578(0x16f)](_0x569578(0xe1)+_0x1ec6b4+_0x569578(0xac)+_0x3b6a02['username']+_0x569578(0xdc));}catch(_0x450e85){console[_0x569578(0xd0)](_0x569578(0x11d),_0x450e85),await this[_0x569578(0xbc)]?.[_0x569578(0x124)](_0x1c1425,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async['sendShopNotification'](_0x570140,_0x4c17f0,_0x3a2728){const _0x1a97a8=a59_0x27e52d;if(!this[_0x1a97a8(0xbc)]){console['warn'](_0x1a97a8(0x16a));return;}try{const _0xdea109=await database_1[_0x1a97a8(0xf6)][_0x1a97a8(0xad)]['findMany']({'where':{'shopId':_0x570140,'isVerified':!![]}});if(_0xdea109['length']===0x0){console['log']('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x570140);return;}const _0x40cf50=_0xdea109[_0x1a97a8(0xce)](async _0x430e11=>{const _0x3e8de4=_0x1a97a8;try{await this[_0x3e8de4(0xbc)]?.['sendMessage'](_0x430e11[_0x3e8de4(0xf8)],_0x4c17f0,_0x3a2728),console[_0x3e8de4(0x16f)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x430e11[_0x3e8de4(0xf8)]);}catch(_0x36589f){console['error'](_0x3e8de4(0xef)+_0x430e11[_0x3e8de4(0xf8)]+':',_0x36589f),_0x36589f instanceof Error&&(_0x36589f[_0x3e8de4(0x147)][_0x3e8de4(0xf7)](_0x3e8de4(0x9c))||_0x36589f[_0x3e8de4(0x147)]['includes']('chat\x20not\x20found')||_0x36589f[_0x3e8de4(0x147)][_0x3e8de4(0xf7)](_0x3e8de4(0x162)))&&(await database_1[_0x3e8de4(0xf6)][_0x3e8de4(0xad)][_0x3e8de4(0x97)]({'where':{'id':_0x430e11['id']},'data':{'isVerified':![]}}),console[_0x3e8de4(0x16f)](_0x3e8de4(0xec)+_0x430e11[_0x3e8de4(0xf8)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x1a97a8(0x12e)](_0x40cf50);}catch(_0x430be5){console[_0x1a97a8(0xd0)]('Error\x20sending\x20shop\x20notification:',_0x430be5);}}async['sendPaymentNotification'](_0x2f2fa9,_0x313c1a,_0x388ed6){const _0x4651e0=a59_0x27e52d,_0x1ce427={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x168ae3={'created':_0x4651e0(0x113),'paid':_0x4651e0(0xba),'failed':'Payment\x20failed','expired':'Payment\x20expired','refund':'Payment\x20refund','chargeback':'Payment\x20chargeback','processing':_0x4651e0(0x170)},_0x2cafa7=_0x1ce427[_0x388ed6],_0x549212=_0x168ae3[_0x388ed6],_0x39986b=(0x0,gateway_1[_0x4651e0(0x175)])(_0x313c1a[_0x4651e0(0xcb)]);console[_0x4651e0(0x16f)](_0x4651e0(0x146)+_0x313c1a[_0x4651e0(0xcb)]+_0x4651e0(0xda)+_0x39986b+'\x22');let _0x313e05=_0x2cafa7+'\x20*'+_0x549212+_0x4651e0(0x159)+('💰\x20Amount:\x20*'+_0x313c1a[_0x4651e0(0x153)]+'\x20'+_0x313c1a[_0x4651e0(0x10f)]+'*\x0a')+(_0x4651e0(0x100)+(_0x313c1a[_0x4651e0(0xb1)]||_0x313c1a['id'])+'`\x0a')+(_0x4651e0(0x177)+_0x313c1a['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x39986b+'`\x0a')+(_0x4651e0(0x161)+new Date(_0x313c1a[_0x4651e0(0xa6)])[_0x4651e0(0xc9)](_0x4651e0(0x133))+'\x0a');if(_0x313c1a[_0x4651e0(0x14f)]||_0x313c1a[_0x4651e0(0xa9)]||_0x313c1a[_0x4651e0(0x98)]||_0x313c1a['customerIp']||_0x313c1a[_0x4651e0(0x178)]){_0x313e05+=_0x4651e0(0x136);_0x313c1a['customerName']&&(_0x313e05+=_0x4651e0(0xf2)+_0x313c1a['customerName']+'`\x0a');_0x313c1a[_0x4651e0(0xa9)]&&(_0x313e05+=_0x4651e0(0x156)+_0x313c1a[_0x4651e0(0xa9)]+'`\x0a');_0x313c1a[_0x4651e0(0x98)]&&(_0x313e05+=_0x4651e0(0x12f)+_0x313c1a[_0x4651e0(0x98)]+'`\x0a');_0x313c1a[_0x4651e0(0x15a)]&&(_0x313e05+=_0x4651e0(0xe8)+_0x313c1a[_0x4651e0(0x15a)]+'`\x0a');if(_0x313c1a['customerUa']){const _0xf8689b=_0x313c1a[_0x4651e0(0x178)]['length']>0x32?_0x313c1a[_0x4651e0(0x178)][_0x4651e0(0x139)](0x0,0x32)+_0x4651e0(0x166):_0x313c1a[_0x4651e0(0x178)];_0x313e05+=_0x4651e0(0x119)+_0xf8689b+'`\x0a';}}_0x388ed6===_0x4651e0(0x11e)&&_0x313c1a[_0x4651e0(0xb3)]&&(_0x313e05+=_0x4651e0(0x160)+_0x313c1a[_0x4651e0(0xb3)]+_0x4651e0(0x115)),_0x388ed6===_0x4651e0(0x17b)&&(_0x313e05+=_0x4651e0(0x126)),_0x313c1a[_0x4651e0(0x169)]&&(_0x313e05+='📝\x20Notes:\x20'+_0x313c1a[_0x4651e0(0x169)]+'\x0a'),await this[_0x4651e0(0xed)](_0x2f2fa9,_0x313e05,{'parse_mode':_0x4651e0(0x155)});}async[a59_0x27e52d(0xa4)](_0x1e3ead,_0xc500b2,_0x36486e){const _0x13e633=a59_0x27e52d,_0xe8f943={'created':'📤','completed':'✅','rejected':'❌'},_0x43f4c7={'created':_0x13e633(0x12b),'completed':_0x13e633(0x101),'rejected':'Payout\x20rejected'},_0x48957f=_0xe8f943[_0x36486e],_0x544b4e=_0x43f4c7[_0x36486e],_0x295e30=_0x48957f+'\x20*'+_0x544b4e+'*\x0a\x0a'+(_0x13e633(0xa7)+_0xc500b2[_0x13e633(0x153)]+_0x13e633(0xe0))+(_0x13e633(0xc0)+_0xc500b2['method']+'`\x0a')+(_0x13e633(0x137)+_0xc500b2['id']+'`\x0a')+(_0x13e633(0x161)+new Date(_0xc500b2[_0x13e633(0xa6)])[_0x13e633(0xc9)](_0x13e633(0x133))+'\x0a')+(_0xc500b2['txid']?_0x13e633(0xe5)+_0xc500b2[_0x13e633(0x138)]+'`':'');await this[_0x13e633(0xed)](_0x1e3ead,_0x295e30,{'parse_mode':_0x13e633(0x155)});}async[a59_0x27e52d(0x157)](_0x33f850,_0x4a144f){const _0x39b925=a59_0x27e52d;try{const _0x24004d=await database_1[_0x39b925(0xf6)][_0x39b925(0xb9)][_0x39b925(0x112)]({'where':{'shopId':_0x33f850},'select':{'notificationLogin':!![]}});if(!_0x24004d?.['notificationLogin']){console[_0x39b925(0x16f)](_0x39b925(0xf3)+_0x33f850);return;}const _0x134249=_0x4a144f[_0x39b925(0xbd)]?'🔐':'🚨',_0x5996a3=_0x4a144f[_0x39b925(0xbd)]?'Successful\x20login':'Failed\x20login\x20attempt';let _0x44fb67=_0x134249+'\x20*'+_0x5996a3+_0x39b925(0x159)+(_0x39b925(0x13b)+_0x4a144f[_0x39b925(0x15c)]+'`\x0a')+(_0x39b925(0x15d)+_0x4a144f[_0x39b925(0x16c)]['toLocaleString']('en-US')+'\x0a');_0x4a144f['ipAddress']&&(_0x44fb67+=_0x39b925(0x12d)+_0x4a144f['ipAddress']+'`\x0a');if(_0x4a144f['userAgent']){const _0x40c9cf=_0x4a144f[_0x39b925(0xb8)]['length']>0x32?_0x4a144f[_0x39b925(0xb8)][_0x39b925(0x139)](0x0,0x32)+_0x39b925(0x166):_0x4a144f[_0x39b925(0xb8)];_0x44fb67+='💻\x20Browser:\x20`'+_0x40c9cf+'`\x0a';}!_0x4a144f[_0x39b925(0xbd)]&&(_0x44fb67+=_0x39b925(0x158)),await this[_0x39b925(0xed)](_0x33f850,_0x44fb67,{'parse_mode':_0x39b925(0x155)}),console[_0x39b925(0x16f)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x33f850+':\x20'+(_0x4a144f[_0x39b925(0xbd)]?_0x39b925(0xbd):'failed'));}catch(_0x2b44ef){console[_0x39b925(0xd0)](_0x39b925(0x10c),_0x2b44ef);}}async[a59_0x27e52d(0xee)](_0x12ec67,_0x2976c7){const _0x16c3c1=a59_0x27e52d;try{const _0x5cb1cf=await database_1[_0x16c3c1(0xf6)][_0x16c3c1(0xb9)][_0x16c3c1(0x112)]({'where':{'shopId':_0x12ec67},'select':{'notificationApiError':!![]}});if(!_0x5cb1cf?.[_0x16c3c1(0xc2)]){console[_0x16c3c1(0x16f)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x12ec67);return;}let _0x603f9='🚨\x20*API\x20Error*\x0a\x0a'+(_0x16c3c1(0x15e)+_0x2976c7['method']+'\x20'+_0x2976c7[_0x16c3c1(0x172)]+'`\x0a')+(_0x16c3c1(0x15d)+_0x2976c7['timestamp'][_0x16c3c1(0xc9)](_0x16c3c1(0x133))+'\x0a');_0x2976c7[_0x16c3c1(0xd5)]&&(_0x603f9+=_0x16c3c1(0x130)+_0x2976c7['statusCode']+'`\x0a'),_0x603f9+=_0x16c3c1(0xe4)+_0x2976c7[_0x16c3c1(0x17a)]+'`\x0a',_0x2976c7[_0x16c3c1(0xa2)]&&(_0x603f9+=_0x16c3c1(0xa5)+_0x2976c7[_0x16c3c1(0xa2)]+'`\x0a'),_0x603f9+=_0x16c3c1(0x151),await this[_0x16c3c1(0xed)](_0x12ec67,_0x603f9,{'parse_mode':_0x16c3c1(0x155)}),console['log'](_0x16c3c1(0xd6)+_0x12ec67+':\x20'+_0x2976c7[_0x16c3c1(0x172)]);}catch(_0x1292cb){console[_0x16c3c1(0xd0)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x1292cb);}}async[a59_0x27e52d(0x10a)](_0x11ab54,_0xdd8fa2,_0x51cc62){const _0x196016=a59_0x27e52d;let _0x310f90=_0x196016(0x9b)+_0xdd8fa2+_0x196016(0x159);for(const [_0x34b740,_0x279b3b]of Object[_0x196016(0x9f)](_0x51cc62)){_0x279b3b!==null&&_0x279b3b!==undefined&&(_0x310f90+=_0x34b740+':\x20`'+_0x279b3b+'`\x0a');}await this['sendShopNotification'](_0x11ab54,_0x310f90,{'parse_mode':_0x196016(0x155)});}[a59_0x27e52d(0xca)](){const _0x4652c4=a59_0x27e52d;return{'isActive':!!this[_0x4652c4(0xbc)],'username':this['botUsername']};}[a59_0x27e52d(0x9a)](){const _0x520c3b=a59_0x27e52d;this[_0x520c3b(0xbc)]&&(this[_0x520c3b(0xbc)][_0x520c3b(0xc3)](),this[_0x520c3b(0xbc)]=null,console[_0x520c3b(0x16f)](_0x520c3b(0xe9)));}}function a59_0x1657(_0x333870,_0xc73972){const _0x16c4a1=a59_0x16c4();return a59_0x1657=function(_0x165772,_0x2e5e8a){_0x165772=_0x165772-0x96;let _0x7bd549=_0x16c4a1[_0x165772];return _0x7bd549;},a59_0x1657(_0x333870,_0xc73972);}exports[a59_0x27e52d(0x114)]=TelegramBotService,exports[a59_0x27e52d(0xb7)]=new TelegramBotService();