'use strict';const a55_0x36eda3=a55_0x5ebb;function a55_0x49ad(){const _0x1ed826=['Contact\x20administrator.','💸\x20Amount:\x20*','🛑\x20Telegram\x20bot\x20stopped','\x20\x20\x20Public\x20Key:\x20`','📧\x20Email:\x20`','Payment\x20successfully\x20paid','from','createdAt','currency','You\x20sent\x20','❌\x20Shop\x20`','customerName','Error\x20in\x20handleSingleLineVerification:','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','🔔\x20Notifications\x20are\x20active\x0a\x0a','🔗\x20Endpoint:\x20`','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','adminNotes','customerUa','status','...`\x0a\x0a','substring','stopPolling','customerIp','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','❌\x20Please\x20use\x20/start\x20command\x20first','Payment\x20expired','14995pwHxYd','*\x0a\x0a','sendApiErrorNotification','•\x20Payouts\x0a\x0a','username','errorMessage','📱\x20Created\x20new\x20Telegram\x20user:\x20','notificationLogin','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','requestId','🎉\x20*Congratulations!*\x0a\x0a','isVerified','findFirst','\x0a👤\x20*Customer\x20Information:*\x0a','telegramId','statusCode','8zuMLoH','findUnique','allSettled','sendLoginNotification','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','Check\x20spelling\x20and\x20try\x20again.','blocked','❌\x20Error:\x20`','🆔\x20Payment\x20ID:\x20`','/status\x20-\x20check\x20connection\x20status\x0a','chargebackAmount','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','processing','New\x20payout\x20created','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Commands:\x0a','toLocaleDateString','sendMessage','warn','🔔\x20*','Error\x20sending\x20shop\x20notification:','userAgent','default','🏪\x20Available\x20shops\x20in\x20system:\x0a','en-US','•\x20Payment\x20status\x20changes\x0a','first_name','toString','📅\x20Time:\x20','sendPayoutNotification','8670708LNWkMT','11196luOebg','node-telegram-bot-api','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Payment\x20chargeback','🌐\x20IP:\x20`','`\x20not\x20found.\x0a\x0a','split','\x20verified\x20for\x20shop\x20','handleSingleLineVerification','getBotInfo','.\x20*','secretKey','sk_','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','toLocaleString','\x20disconnected\x20from\x20shop\x20','38twKCoZ','/disconnect\x20-\x20disconnect\x20from\x20notifications','`\x0a\x0a','...\x22','updatedAt','To\x20reconnect,\x20use\x20the\x20/start\x20command','Error\x20handling\x20/status\x20command:','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','Error\x20handling\x20/disconnect\x20command:','Markdown','Example:\x0a','Failed\x20to\x20send\x20API\x20error\x20notification:','publicKey','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','✅\x20Telegram\x20user\x20','TelegramBotService','Error\x20handling\x20/debug\x20command:','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','👤\x20Username:\x20`','sendCustomNotification','🚨\x20*API\x20Error*\x0a\x0a','🏦\x20IBAN:\x20`','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','__esModule','\x20\x20\x20Username:\x20`','Error\x20handling\x20/start\x20command:','entries','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','Payment\x20refund','test','endpoint','length','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','TELEGRAM_BOT_TOKEN','amount','name','telegramBotService','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','...','findMany','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','update','\x20(@','telegramUser','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Failed\x20to\x20send\x20login\x20notification:','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','botUsername','shopSettings','timestamp','\x20initialized\x20successfully','📅\x20Connection\x20date:\x20','startsWith','✅\x20Connected\x20to\x20shop:\x20*','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','*.\x0a\x0a','TELEGRAM_BOT_USERNAME','\x20USD*\x0a','Available\x20usernames:\x0a','bot','join','Error\x20handling\x20message:','stopBot','env','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','13QjBCUM','\x22\x20->\x20display\x20\x22','setupBotHandlers','📊\x20*Connection\x20Status*\x0a\x0a','`.\x0a\x0a','🔍\x20*Debug\x20Information*\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','📛\x20Name:\x20`','remitterIban','log','pk_','sendPaymentNotification','220276rQafVL','🌐\x20IP\x20address:\x20`','•\x20New\x20payments\x0a','forEach','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','error','2597810YSZaOu','onText','botToken','Failed\x20login\x20attempt','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','ipAddress','384LodmLi',':\x20username=\x22','91hHjRIO','💰\x20Amount:\x20*','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','initializeBot','defineProperty','\x22,\x20apiKey=\x22','map','User\x20','method','text','includes','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','chat','message','__importDefault','Use\x20/start\x20to\x20connect.','customerEmail','shop','`\x20is\x20inactive.\x0a\x0a','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','11391CudYIT','11nzvjtq','2881782miiLfp','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','\x0aCheck\x20spelling\x20and\x20try\x20again.','last_name','create','Payout\x20completed','success','chargeback','📊\x20Error\x20code:\x20`','🆔\x20Request\x20ID:\x20`','\x20USDT*\x0a','ACTIVE','❌\x20Error\x20getting\x20debug\x20information.',':\x20`','trapay_bot','sendShopNotification','user\x20is\x20deactivated','../types/gateway','New\x20payment\x20created','shopId','📅\x20Date:\x20','💻\x20Browser:\x20`','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables'];a55_0x49ad=function(){return _0x1ed826;};return a55_0x49ad();}(function(_0x12a874,_0x1744aa){const _0x122d89=a55_0x5ebb,_0x137bf9=_0x12a874();while(!![]){try{const _0x2bb949=-parseInt(_0x122d89(0x177))/0x1+-parseInt(_0x122d89(0x129))/0x2*(parseInt(_0x122d89(0x199))/0x3)+-parseInt(_0x122d89(0x183))/0x4*(parseInt(_0x122d89(0xea))/0x5)+-parseInt(_0x122d89(0x119))/0x6*(parseInt(_0x122d89(0x185))/0x7)+parseInt(_0x122d89(0xfa))/0x8*(parseInt(_0x122d89(0x19b))/0x9)+parseInt(_0x122d89(0x17d))/0xa*(-parseInt(_0x122d89(0x19a))/0xb)+parseInt(_0x122d89(0x118))/0xc*(parseInt(_0x122d89(0x16b))/0xd);if(_0x2bb949===_0x1744aa)break;else _0x137bf9['push'](_0x137bf9['shift']());}catch(_0x41cdf2){_0x137bf9['push'](_0x137bf9['shift']());}}}(a55_0x49ad,0x2b8db));function a55_0x5ebb(_0x306832,_0x43d7b9){const _0x49ad52=a55_0x49ad();return a55_0x5ebb=function(_0x5ebb40,_0x14552d){_0x5ebb40=_0x5ebb40-0xd6;let _0x514dbc=_0x49ad52[_0x5ebb40];return _0x514dbc;},a55_0x5ebb(_0x306832,_0x43d7b9);}var __importDefault=this&&this[a55_0x36eda3(0x193)]||function(_0x9d6dd6){return _0x9d6dd6&&_0x9d6dd6['__esModule']?_0x9d6dd6:{'default':_0x9d6dd6};};Object[a55_0x36eda3(0x189)](exports,a55_0x36eda3(0x140),{'value':!![]}),exports['telegramBotService']=exports[a55_0x36eda3(0x138)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a55_0x36eda3(0x11a))),database_1=__importDefault(require('../config/database')),gateway_1=require(a55_0x36eda3(0x1ac));class TelegramBotService{constructor(){const _0x4e838a=a55_0x36eda3;this[_0x4e838a(0x165)]=null,this['botToken']=process[_0x4e838a(0x169)][_0x4e838a(0x14b)]||'',this[_0x4e838a(0x159)]=process['env'][_0x4e838a(0x162)]||_0x4e838a(0x1a9),this['botToken']?this[_0x4e838a(0x188)]():console['warn'](_0x4e838a(0x1b2));}[a55_0x36eda3(0x188)](){const _0x2d2520=a55_0x36eda3;try{this[_0x2d2520(0x165)]=new node_telegram_bot_api_1[(_0x2d2520(0x110))](this[_0x2d2520(0x17f)],{'polling':!![]}),this[_0x2d2520(0x16d)](),console[_0x2d2520(0x174)]('✅\x20Telegram\x20bot\x20@'+this['botUsername']+_0x2d2520(0x15c));}catch(_0xc735bc){console['error'](_0x2d2520(0x126),_0xc735bc);}}[a55_0x36eda3(0x16d)](){const _0x577946=a55_0x36eda3;if(!this[_0x577946(0x165)])return;this[_0x577946(0x165)][_0x577946(0x17e)](/\/start/,async _0x1fa890=>{const _0x3cc18d=_0x577946,_0x523b0f=_0x1fa890['chat']['id'],_0x3dfeec=_0x1fa890[_0x3cc18d(0x1b9)]?.['id'][_0x3cc18d(0x115)](),_0x34211c=_0x1fa890[_0x3cc18d(0x1b9)]?.[_0x3cc18d(0xee)],_0x29d2f5=_0x1fa890[_0x3cc18d(0x1b9)]?.[_0x3cc18d(0x114)],_0xcd52d8=_0x1fa890[_0x3cc18d(0x1b9)]?.[_0x3cc18d(0x19e)];if(!_0x3dfeec)return;try{let _0x2568bc=await database_1['default']['telegramUser'][_0x3cc18d(0xfb)]({'where':{'telegramId':_0x3dfeec},'include':{'shop':!![]}});!_0x2568bc?(_0x2568bc=await database_1['default'][_0x3cc18d(0x155)][_0x3cc18d(0x19f)]({'data':{'telegramId':_0x3dfeec,'username':_0x34211c,'firstName':_0x29d2f5,'lastName':_0xcd52d8,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x3cc18d(0x174)](_0x3cc18d(0xf0)+_0x3dfeec+_0x3cc18d(0x154)+_0x34211c+')')):_0x2568bc=await database_1[_0x3cc18d(0x110)]['telegramUser']['update']({'where':{'telegramId':_0x3dfeec},'data':{'username':_0x34211c,'firstName':_0x29d2f5,'lastName':_0xcd52d8},'include':{'shop':!![]}}),_0x2568bc[_0x3cc18d(0xf5)]&&_0x2568bc['shopId']&&_0x2568bc['shop']?await this['bot']?.[_0x3cc18d(0x10b)](_0x523b0f,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x3cc18d(0x105)+_0x2568bc['shop']['name']+'*\x0a')+('Username:\x20`'+_0x2568bc[_0x3cc18d(0x196)][_0x3cc18d(0xee)]+_0x3cc18d(0x12b))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x3cc18d(0x179)+_0x3cc18d(0x113)+_0x3cc18d(0xed)+_0x3cc18d(0x109)+_0x3cc18d(0x103)+_0x3cc18d(0x12a),{'parse_mode':_0x3cc18d(0x132)}):(_0x2568bc[_0x3cc18d(0x1ae)]&&!_0x2568bc[_0x3cc18d(0xf5)]&&(await database_1['default']['telegramUser'][_0x3cc18d(0x153)]({'where':{'telegramId':_0x3dfeec},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x3cc18d(0xe7)+_0x3dfeec)),await this['bot']?.[_0x3cc18d(0x10b)](_0x523b0f,_0x3cc18d(0x13f)+_0x3cc18d(0x156)+_0x3cc18d(0x108)+_0x3cc18d(0x133)+_0x3cc18d(0x130)+_0x3cc18d(0x198),{'parse_mode':_0x3cc18d(0x132)}));}catch(_0x23597b){console['error'](_0x3cc18d(0x142),_0x23597b),await this[_0x3cc18d(0x165)]?.[_0x3cc18d(0x10b)](_0x523b0f,_0x3cc18d(0x160));}}),this['bot'][_0x577946(0x17e)](/\/disconnect/,async _0x5ed29f=>{const _0x310da3=_0x577946,_0x5c8084=_0x5ed29f[_0x310da3(0x191)]['id'],_0xe0927e=_0x5ed29f[_0x310da3(0x1b9)]?.['id'][_0x310da3(0x115)]();if(!_0xe0927e)return;try{const _0x386480=await database_1['default']['telegramUser']['findUnique']({'where':{'telegramId':_0xe0927e},'include':{'shop':!![]}});if(!_0x386480||!_0x386480['isVerified']||!_0x386480[_0x310da3(0x1ae)]){await this[_0x310da3(0x165)]?.[_0x310da3(0x10b)](_0x5c8084,_0x310da3(0x181));return;}const _0x2012bd=_0x386480['shop']?.['name']||'unknown\x20shop';await database_1[_0x310da3(0x110)][_0x310da3(0x155)][_0x310da3(0x153)]({'where':{'telegramId':_0xe0927e},'data':{'shopId':null,'isVerified':![]}}),console[_0x310da3(0x174)]('🔌\x20User\x20'+_0xe0927e+_0x310da3(0x128)+_0x386480[_0x310da3(0x1ae)]),await this[_0x310da3(0x165)]?.[_0x310da3(0x10b)](_0x5c8084,_0x310da3(0x1b1)+_0x2012bd+_0x310da3(0x161)+_0x310da3(0x12e),{'parse_mode':_0x310da3(0x132)});}catch(_0x5094ae){console[_0x310da3(0x17c)](_0x310da3(0x131),_0x5094ae),await this[_0x310da3(0x165)]?.[_0x310da3(0x10b)](_0x5c8084,_0x310da3(0x160));}}),this[_0x577946(0x165)][_0x577946(0x17e)](/\/status/,async _0x12ebe8=>{const _0x48bda8=_0x577946,_0x16e26e=_0x12ebe8[_0x48bda8(0x191)]['id'],_0x101a06=_0x12ebe8[_0x48bda8(0x1b9)]?.['id'][_0x48bda8(0x115)]();if(!_0x101a06)return;try{const _0x308a31=await database_1[_0x48bda8(0x110)][_0x48bda8(0x155)][_0x48bda8(0xfb)]({'where':{'telegramId':_0x101a06},'include':{'shop':!![]}});if(!_0x308a31){await this[_0x48bda8(0x165)]?.[_0x48bda8(0x10b)](_0x16e26e,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+'Use\x20/start\x20to\x20begin.');return;}if(!_0x308a31[_0x48bda8(0xf5)]||!_0x308a31['shopId']||!_0x308a31[_0x48bda8(0x196)]){await this[_0x48bda8(0x165)]?.['sendMessage'](_0x16e26e,_0x48bda8(0x171)+_0x48bda8(0x194));return;}await this['bot']?.['sendMessage'](_0x16e26e,_0x48bda8(0x16e)+(_0x48bda8(0x15f)+_0x308a31[_0x48bda8(0x196)][_0x48bda8(0x14d)]+'*\x0a')+(_0x48bda8(0x13b)+_0x308a31[_0x48bda8(0x196)][_0x48bda8(0xee)]+'`\x0a')+(_0x48bda8(0x15d)+_0x308a31[_0x48bda8(0x12d)][_0x48bda8(0x10a)](_0x48bda8(0x112))+'\x0a\x0a')+_0x48bda8(0xdc)+_0x48bda8(0x109)+_0x48bda8(0x12a),{'parse_mode':_0x48bda8(0x132)});}catch(_0x281a8b){console[_0x48bda8(0x17c)](_0x48bda8(0x12f),_0x281a8b),await this[_0x48bda8(0x165)]?.[_0x48bda8(0x10b)](_0x16e26e,_0x48bda8(0x160));}}),this[_0x577946(0x165)][_0x577946(0x17e)](/\/debug/,async _0x55d52f=>{const _0x297526=_0x577946,_0x1e5259=_0x55d52f['chat']['id'],_0x2828da=_0x55d52f[_0x297526(0x1b9)]?.['id'][_0x297526(0x115)]();if(!_0x2828da)return;try{const _0x389f0b=await database_1['default'][_0x297526(0x196)][_0x297526(0x151)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x37864b=_0x297526(0x170);_0x37864b+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x2828da+_0x297526(0x12b),_0x37864b+=_0x297526(0x111),_0x389f0b[_0x297526(0x17a)]((_0xe4ed06,_0x40ba20)=>{const _0xb85587=_0x297526;_0x37864b+=_0x40ba20+0x1+_0xb85587(0x123)+_0xe4ed06['name']+'*\x0a',_0x37864b+=_0xb85587(0x141)+_0xe4ed06['username']+'`\x0a',_0x37864b+='\x20\x20\x20Status:\x20'+_0xe4ed06['status']+'\x0a',_0x37864b+=_0xb85587(0x1b6)+_0xe4ed06[_0xb85587(0x135)][_0xb85587(0xe3)](0x0,0xf)+_0xb85587(0xe2);}),await this[_0x297526(0x165)]?.[_0x297526(0x10b)](_0x1e5259,_0x37864b,{'parse_mode':'Markdown'});}catch(_0x4d3c26){console[_0x297526(0x17c)](_0x297526(0x139),_0x4d3c26),await this[_0x297526(0x165)]?.[_0x297526(0x10b)](_0x1e5259,_0x297526(0x1a7));}}),this[_0x577946(0x165)]['on'](_0x577946(0x192),async _0x777722=>{const _0x4cbb6e=_0x577946;if(_0x777722[_0x4cbb6e(0x18e)]?.[_0x4cbb6e(0x15e)]('/'))return;const _0x17f3c4=_0x777722[_0x4cbb6e(0x191)]['id'],_0x535cda=_0x777722[_0x4cbb6e(0x1b9)]?.['id'][_0x4cbb6e(0x115)](),_0x527f1c=_0x777722[_0x4cbb6e(0x18e)]?.['trim']();if(!_0x535cda||!_0x527f1c)return;try{const _0x27d815=await database_1[_0x4cbb6e(0x110)][_0x4cbb6e(0x155)][_0x4cbb6e(0xfb)]({'where':{'telegramId':_0x535cda},'include':{'shop':!![]}});if(!_0x27d815){await this[_0x4cbb6e(0x165)]?.[_0x4cbb6e(0x10b)](_0x17f3c4,_0x4cbb6e(0xe8));return;}if(_0x27d815['isVerified']&&_0x27d815[_0x4cbb6e(0x1ae)]&&_0x27d815[_0x4cbb6e(0x196)]){await this[_0x4cbb6e(0x165)]?.[_0x4cbb6e(0x10b)](_0x17f3c4,_0x4cbb6e(0xe6)+_0x27d815[_0x4cbb6e(0x196)]['name']+_0x4cbb6e(0x161)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x4cbb6e(0x132)});return;}const _0x544019=_0x527f1c[_0x4cbb6e(0x11f)](/\s+/);if(_0x544019[_0x4cbb6e(0x148)]!==0x2){await this['bot']?.[_0x4cbb6e(0x10b)](_0x17f3c4,_0x4cbb6e(0x158)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x4cbb6e(0x133)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x4cbb6e(0xd7)+_0x544019[_0x4cbb6e(0x148)]+'\x20parts:\x20'+_0x544019[_0x4cbb6e(0x18b)](_0x505a20=>'`'+_0x505a20+'`')[_0x4cbb6e(0x166)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x35aefd,_0x537de2]=_0x544019;console['log'](_0x4cbb6e(0x14a)+_0x535cda+':\x20username=\x22'+_0x35aefd+_0x4cbb6e(0x18a)+_0x537de2[_0x4cbb6e(0xe3)](0x0,0xa)+_0x4cbb6e(0x12c)),await this[_0x4cbb6e(0x121)](_0x17f3c4,_0x535cda,_0x35aefd,_0x537de2);}catch(_0x9b8e06){console[_0x4cbb6e(0x17c)](_0x4cbb6e(0x167),_0x9b8e06),await this[_0x4cbb6e(0x165)]?.[_0x4cbb6e(0x10b)](_0x17f3c4,_0x4cbb6e(0x160));}}),this['bot']['on'](_0x577946(0x17c),_0x222a25=>{const _0x39d554=_0x577946;console[_0x39d554(0x17c)]('Telegram\x20bot\x20error:',_0x222a25);}),this[_0x577946(0x165)]['on']('polling_error',_0x19a62c=>{const _0x410afc=_0x577946;console[_0x410afc(0x17c)]('Telegram\x20bot\x20polling\x20error:',_0x19a62c);});}async[a55_0x36eda3(0x121)](_0x2aa072,_0x49f926,_0x29ed9a,_0x23c93b){const _0x12c47d=a55_0x36eda3;try{console[_0x12c47d(0x174)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x49f926+_0x12c47d(0x184)+_0x29ed9a+_0x12c47d(0x18a)+_0x23c93b[_0x12c47d(0xe3)](0x0,0xa)+_0x12c47d(0x12c));if(!_0x29ed9a||_0x29ed9a[_0x12c47d(0x148)]<0x3||_0x29ed9a[_0x12c47d(0x148)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x12c47d(0x146)](_0x29ed9a)){await this['bot']?.[_0x12c47d(0x10b)](_0x2aa072,'❌\x20Invalid\x20username\x20format:\x20`'+_0x29ed9a+_0x12c47d(0x12b)+_0x12c47d(0x136),{'parse_mode':_0x12c47d(0x132)});return;}if(!_0x23c93b||!_0x23c93b[_0x12c47d(0x15e)](_0x12c47d(0x175))&&!_0x23c93b[_0x12c47d(0x15e)](_0x12c47d(0x125))){await this['bot']?.['sendMessage'](_0x2aa072,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x12c47d(0x132)});return;}const _0x2550c0=await database_1[_0x12c47d(0x110)][_0x12c47d(0x196)][_0x12c47d(0xfb)]({'where':{'username':_0x29ed9a},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x2550c0){const _0x53b20f=await database_1[_0x12c47d(0x110)][_0x12c47d(0x196)][_0x12c47d(0x151)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x5caded='❌\x20Shop\x20with\x20username\x20`'+_0x29ed9a+_0x12c47d(0x11e);_0x53b20f[_0x12c47d(0x148)]>0x0?(_0x5caded+=_0x12c47d(0x164),_0x53b20f[_0x12c47d(0x17a)](_0x2b7e92=>{const _0x26a8d4=_0x12c47d;_0x5caded+='•\x20`'+_0x2b7e92['username']+'`\x20('+_0x2b7e92[_0x26a8d4(0x14d)]+')\x0a';}),_0x5caded+=_0x12c47d(0x19d)):_0x5caded+=_0x12c47d(0xff);await this['bot']?.[_0x12c47d(0x10b)](_0x2aa072,_0x5caded,{'parse_mode':_0x12c47d(0x132)});return;}if(_0x2550c0[_0x12c47d(0xe1)]!==_0x12c47d(0x1a6)){await this[_0x12c47d(0x165)]?.[_0x12c47d(0x10b)](_0x2aa072,_0x12c47d(0xd8)+_0x29ed9a+_0x12c47d(0x197)+_0x12c47d(0x1b3),{'parse_mode':_0x12c47d(0x132)});return;}if(_0x2550c0[_0x12c47d(0x135)]!==_0x23c93b&&_0x2550c0[_0x12c47d(0x124)]!==_0x23c93b){await this[_0x12c47d(0x165)]?.[_0x12c47d(0x10b)](_0x2aa072,_0x12c47d(0x149)+_0x29ed9a+_0x12c47d(0x16f)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x12c47d(0xdb),{'parse_mode':_0x12c47d(0x132)});return;}const _0x164e08=await database_1[_0x12c47d(0x110)]['telegramUser'][_0x12c47d(0xf6)]({'where':{'shopId':_0x2550c0['id'],'isVerified':!![],'telegramId':{'not':_0x49f926}}});if(_0x164e08){await this['bot']?.['sendMessage'](_0x2aa072,_0x12c47d(0x190)+_0x29ed9a+_0x12c47d(0x16f)+_0x12c47d(0x152),{'parse_mode':'Markdown'});return;}await database_1['default'][_0x12c47d(0x155)][_0x12c47d(0x153)]({'where':{'telegramId':_0x49f926},'data':{'shopId':_0x2550c0['id'],'isVerified':!![]}}),await this[_0x12c47d(0x165)]?.[_0x12c47d(0x10b)](_0x2aa072,_0x12c47d(0xf4)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('📱\x20Shop:\x20*'+_0x2550c0[_0x12c47d(0x14d)]+'*\x0a')+('👤\x20Username:\x20`'+_0x2550c0[_0x12c47d(0xee)]+_0x12c47d(0x12b))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x12c47d(0x179)+_0x12c47d(0x113)+'•\x20Payouts\x0a'+'•\x20Important\x20events\x0a\x0a'+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x12c47d(0x12a),{'parse_mode':'Markdown'}),console[_0x12c47d(0x174)](_0x12c47d(0x137)+_0x49f926+_0x12c47d(0x120)+_0x2550c0['username']+'\x20via\x20single-line\x20input');}catch(_0x1011ff){console[_0x12c47d(0x17c)](_0x12c47d(0xda),_0x1011ff),await this['bot']?.[_0x12c47d(0x10b)](_0x2aa072,_0x12c47d(0x11b));}}async['sendShopNotification'](_0x1a8e8d,_0x5223b3,_0x3b3ea3){const _0x231769=a55_0x36eda3;if(!this['bot']){console[_0x231769(0x10c)](_0x231769(0x16a));return;}try{const _0x4d5717=await database_1[_0x231769(0x110)]['telegramUser'][_0x231769(0x151)]({'where':{'shopId':_0x1a8e8d,'isVerified':!![]}});if(_0x4d5717[_0x231769(0x148)]===0x0){console[_0x231769(0x174)](_0x231769(0xfe)+_0x1a8e8d);return;}const _0x58d32b=_0x4d5717[_0x231769(0x18b)](async _0x1521d0=>{const _0x4315c8=_0x231769;try{await this['bot']?.[_0x4315c8(0x10b)](_0x1521d0[_0x4315c8(0xf8)],_0x5223b3,_0x3b3ea3),console['log'](_0x4315c8(0x13a)+_0x1521d0[_0x4315c8(0xf8)]);}catch(_0x1c9b4b){console[_0x4315c8(0x17c)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x1521d0['telegramId']+':',_0x1c9b4b),_0x1c9b4b instanceof Error&&(_0x1c9b4b[_0x4315c8(0x192)][_0x4315c8(0x18f)](_0x4315c8(0x100))||_0x1c9b4b[_0x4315c8(0x192)][_0x4315c8(0x18f)]('chat\x20not\x20found')||_0x1c9b4b['message'][_0x4315c8(0x18f)](_0x4315c8(0x1ab)))&&(await database_1[_0x4315c8(0x110)][_0x4315c8(0x155)][_0x4315c8(0x153)]({'where':{'id':_0x1521d0['id']},'data':{'isVerified':![]}}),console[_0x4315c8(0x174)](_0x4315c8(0x18c)+_0x1521d0[_0x4315c8(0xf8)]+_0x4315c8(0x17b)));}});await Promise[_0x231769(0xfc)](_0x58d32b);}catch(_0x5a3a26){console[_0x231769(0x17c)](_0x231769(0x10e),_0x5a3a26);}}async[a55_0x36eda3(0x176)](_0x2c7fc7,_0x4cfc55,_0x5414ed){const _0x13f636=a55_0x36eda3,_0x15f810={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x528ce8={'created':_0x13f636(0x1ad),'paid':_0x13f636(0x1b8),'failed':'Payment\x20failed','expired':_0x13f636(0xe9),'refund':_0x13f636(0x145),'chargeback':_0x13f636(0x11c),'processing':'Payment\x20is\x20being\x20processed'},_0x268ba4=_0x15f810[_0x5414ed],_0x30a991=_0x528ce8[_0x5414ed],_0x4b3300=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x4cfc55['gateway']);console[_0x13f636(0x174)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x4cfc55['gateway']+_0x13f636(0x16c)+_0x4b3300+'\x22');let _0x2f7fd6=_0x268ba4+'\x20*'+_0x30a991+_0x13f636(0xeb)+(_0x13f636(0x186)+_0x4cfc55[_0x13f636(0x14c)]+'\x20'+_0x4cfc55[_0x13f636(0xd6)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x4cfc55['orderId']||_0x4cfc55['id'])+'`\x0a')+(_0x13f636(0x102)+_0x4cfc55['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x4b3300+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x4cfc55[_0x13f636(0x1ba)])[_0x13f636(0x127)](_0x13f636(0x112))+'\x0a');if(_0x4cfc55[_0x13f636(0xd9)]||_0x4cfc55[_0x13f636(0x195)]||_0x4cfc55[_0x13f636(0x173)]||_0x4cfc55[_0x13f636(0xe5)]||_0x4cfc55['customerUa']){_0x2f7fd6+=_0x13f636(0xf7);_0x4cfc55[_0x13f636(0xd9)]&&(_0x2f7fd6+=_0x13f636(0x172)+_0x4cfc55['customerName']+'`\x0a');_0x4cfc55[_0x13f636(0x195)]&&(_0x2f7fd6+=_0x13f636(0x1b7)+_0x4cfc55[_0x13f636(0x195)]+'`\x0a');_0x4cfc55[_0x13f636(0x173)]&&(_0x2f7fd6+=_0x13f636(0x13e)+_0x4cfc55[_0x13f636(0x173)]+'`\x0a');_0x4cfc55[_0x13f636(0xe5)]&&(_0x2f7fd6+=_0x13f636(0x11d)+_0x4cfc55[_0x13f636(0xe5)]+'`\x0a');if(_0x4cfc55[_0x13f636(0xe0)]){const _0x300220=_0x4cfc55[_0x13f636(0xe0)][_0x13f636(0x148)]>0x32?_0x4cfc55[_0x13f636(0xe0)]['substring'](0x0,0x32)+_0x13f636(0x150):_0x4cfc55[_0x13f636(0xe0)];_0x2f7fd6+=_0x13f636(0x1b0)+_0x300220+'`\x0a';}}_0x5414ed===_0x13f636(0x1a2)&&_0x4cfc55[_0x13f636(0x104)]&&(_0x2f7fd6+='💸\x20Penalty\x20amount:\x20*'+_0x4cfc55[_0x13f636(0x104)]+_0x13f636(0x1a5)),_0x5414ed===_0x13f636(0x106)&&(_0x2f7fd6+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x4cfc55[_0x13f636(0xdf)]&&(_0x2f7fd6+='📝\x20Notes:\x20'+_0x4cfc55[_0x13f636(0xdf)]+'\x0a'),await this[_0x13f636(0x1aa)](_0x2c7fc7,_0x2f7fd6,{'parse_mode':_0x13f636(0x132)});}async[a55_0x36eda3(0x117)](_0x9e72f2,_0x4c44c0,_0x4dd853){const _0x59af92=a55_0x36eda3,_0x2c2bfb={'created':'📤','completed':'✅','rejected':'❌'},_0x6c3b15={'created':_0x59af92(0x107),'completed':_0x59af92(0x1a0),'rejected':'Payout\x20rejected'},_0x33dba0=_0x2c2bfb[_0x4dd853],_0x571316=_0x6c3b15[_0x4dd853],_0x588963=_0x33dba0+'\x20*'+_0x571316+_0x59af92(0xeb)+(_0x59af92(0x1b4)+_0x4c44c0[_0x59af92(0x14c)]+_0x59af92(0x163))+('🏦\x20Method:\x20`'+_0x4c44c0[_0x59af92(0x18d)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x4c44c0['id']+'`\x0a')+(_0x59af92(0x1af)+new Date(_0x4c44c0['createdAt'])[_0x59af92(0x127)](_0x59af92(0x112))+'\x0a')+(_0x4c44c0['txid']?'🔗\x20TXID:\x20`'+_0x4c44c0['txid']+'`':'');await this[_0x59af92(0x1aa)](_0x9e72f2,_0x588963,{'parse_mode':_0x59af92(0x132)});}async[a55_0x36eda3(0xfd)](_0x126e91,_0x3f802d){const _0x239ce2=a55_0x36eda3;try{const _0x5765a4=await database_1[_0x239ce2(0x110)][_0x239ce2(0x15a)][_0x239ce2(0xfb)]({'where':{'shopId':_0x126e91},'select':{'notificationLogin':!![]}});if(!_0x5765a4?.[_0x239ce2(0xf1)]){console[_0x239ce2(0x174)](_0x239ce2(0xde)+_0x126e91);return;}const _0x2077a6=_0x3f802d[_0x239ce2(0x1a1)]?'🔐':'🚨',_0x15dde2=_0x3f802d[_0x239ce2(0x1a1)]?'Successful\x20login':_0x239ce2(0x180);let _0x1ade98=_0x2077a6+'\x20*'+_0x15dde2+_0x239ce2(0xeb)+(_0x239ce2(0x13b)+_0x3f802d[_0x239ce2(0xee)]+'`\x0a')+(_0x239ce2(0x116)+_0x3f802d[_0x239ce2(0x15b)][_0x239ce2(0x127)](_0x239ce2(0x112))+'\x0a');_0x3f802d[_0x239ce2(0x182)]&&(_0x1ade98+=_0x239ce2(0x178)+_0x3f802d['ipAddress']+'`\x0a');if(_0x3f802d[_0x239ce2(0x10f)]){const _0x434433=_0x3f802d['userAgent']['length']>0x32?_0x3f802d[_0x239ce2(0x10f)][_0x239ce2(0xe3)](0x0,0x32)+'...':_0x3f802d[_0x239ce2(0x10f)];_0x1ade98+='💻\x20Browser:\x20`'+_0x434433+'`\x0a';}!_0x3f802d[_0x239ce2(0x1a1)]&&(_0x1ade98+=_0x239ce2(0x14f)),await this[_0x239ce2(0x1aa)](_0x126e91,_0x1ade98,{'parse_mode':_0x239ce2(0x132)}),console['log'](_0x239ce2(0x19c)+_0x126e91+':\x20'+(_0x3f802d[_0x239ce2(0x1a1)]?_0x239ce2(0x1a1):'failed'));}catch(_0x30c26e){console['error'](_0x239ce2(0x157),_0x30c26e);}}async[a55_0x36eda3(0xec)](_0x21ee18,_0x4e4e35){const _0x289c2f=a55_0x36eda3;try{const _0x45a835=await database_1['default'][_0x289c2f(0x15a)]['findUnique']({'where':{'shopId':_0x21ee18},'select':{'notificationApiError':!![]}});if(!_0x45a835?.['notificationApiError']){console[_0x289c2f(0x174)](_0x289c2f(0x187)+_0x21ee18);return;}let _0x2a58ce=_0x289c2f(0x13d)+(_0x289c2f(0xdd)+_0x4e4e35[_0x289c2f(0x18d)]+'\x20'+_0x4e4e35[_0x289c2f(0x147)]+'`\x0a')+(_0x289c2f(0x116)+_0x4e4e35[_0x289c2f(0x15b)][_0x289c2f(0x127)](_0x289c2f(0x112))+'\x0a');_0x4e4e35[_0x289c2f(0xf9)]&&(_0x2a58ce+=_0x289c2f(0x1a3)+_0x4e4e35[_0x289c2f(0xf9)]+'`\x0a'),_0x2a58ce+=_0x289c2f(0x101)+_0x4e4e35[_0x289c2f(0xef)]+'`\x0a',_0x4e4e35[_0x289c2f(0xf3)]&&(_0x2a58ce+=_0x289c2f(0x1a4)+_0x4e4e35[_0x289c2f(0xf3)]+'`\x0a'),_0x2a58ce+=_0x289c2f(0xf2),await this[_0x289c2f(0x1aa)](_0x21ee18,_0x2a58ce,{'parse_mode':'Markdown'}),console[_0x289c2f(0x174)](_0x289c2f(0x144)+_0x21ee18+':\x20'+_0x4e4e35[_0x289c2f(0x147)]);}catch(_0x5027cb){console[_0x289c2f(0x17c)](_0x289c2f(0x134),_0x5027cb);}}async[a55_0x36eda3(0x13c)](_0x48caee,_0x4aaa3f,_0x5abcdf){const _0x32f8eb=a55_0x36eda3;let _0x4cc4ae=_0x32f8eb(0x10d)+_0x4aaa3f+'*\x0a\x0a';for(const [_0x32c9cb,_0x861253]of Object[_0x32f8eb(0x143)](_0x5abcdf)){_0x861253!==null&&_0x861253!==undefined&&(_0x4cc4ae+=_0x32c9cb+_0x32f8eb(0x1a8)+_0x861253+'`\x0a');}await this['sendShopNotification'](_0x48caee,_0x4cc4ae,{'parse_mode':'Markdown'});}[a55_0x36eda3(0x122)](){const _0x14d3e7=a55_0x36eda3;return{'isActive':!!this[_0x14d3e7(0x165)],'username':this[_0x14d3e7(0x159)]};}[a55_0x36eda3(0x168)](){const _0x54e49e=a55_0x36eda3;this[_0x54e49e(0x165)]&&(this[_0x54e49e(0x165)][_0x54e49e(0xe4)](),this[_0x54e49e(0x165)]=null,console[_0x54e49e(0x174)](_0x54e49e(0x1b5)));}}exports['TelegramBotService']=TelegramBotService,exports[a55_0x36eda3(0x14e)]=new TelegramBotService();