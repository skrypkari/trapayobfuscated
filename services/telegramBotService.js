'use strict';const a57_0x2ba6d8=a57_0x39ab;(function(_0x3ce065,_0x30d8bc){const _0x5e6f82=a57_0x39ab,_0x415a88=_0x3ce065();while(!![]){try{const _0x5478ed=-parseInt(_0x5e6f82(0x20a))/0x1*(parseInt(_0x5e6f82(0x19c))/0x2)+parseInt(_0x5e6f82(0x19e))/0x3+parseInt(_0x5e6f82(0x1b5))/0x4*(-parseInt(_0x5e6f82(0x1ae))/0x5)+parseInt(_0x5e6f82(0x237))/0x6*(parseInt(_0x5e6f82(0x219))/0x7)+parseInt(_0x5e6f82(0x240))/0x8+-parseInt(_0x5e6f82(0x236))/0x9*(parseInt(_0x5e6f82(0x1e7))/0xa)+parseInt(_0x5e6f82(0x1b9))/0xb*(parseInt(_0x5e6f82(0x182))/0xc);if(_0x5478ed===_0x30d8bc)break;else _0x415a88['push'](_0x415a88['shift']());}catch(_0x1d2ab8){_0x415a88['push'](_0x415a88['shift']());}}}(a57_0x1389,0x56cd8));function a57_0x39ab(_0x25b7d1,_0x3391a1){const _0x1389da=a57_0x1389();return a57_0x39ab=function(_0x39ab1d,_0x2ff727){_0x39ab1d=_0x39ab1d-0x156;let _0x2948ef=_0x1389da[_0x39ab1d];return _0x2948ef;},a57_0x39ab(_0x25b7d1,_0x3391a1);}var __importDefault=this&&this[a57_0x2ba6d8(0x1a8)]||function(_0x7fae71){const _0x4a4380=a57_0x2ba6d8;return _0x7fae71&&_0x7fae71[_0x4a4380(0x1a7)]?_0x7fae71:{'default':_0x7fae71};};Object[a57_0x2ba6d8(0x175)](exports,a57_0x2ba6d8(0x1a7),{'value':!![]}),exports[a57_0x2ba6d8(0x215)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a57_0x2ba6d8(0x1fa))),database_1=__importDefault(require('../config/database')),gateway_1=require(a57_0x2ba6d8(0x213));class TelegramBotService{constructor(){const _0x49ede1=a57_0x2ba6d8;this[_0x49ede1(0x199)]=null,this['botToken']=process[_0x49ede1(0x17e)][_0x49ede1(0x1e4)]||'',this['botUsername']=process['env'][_0x49ede1(0x1fe)]||'trapay_bot',this[_0x49ede1(0x20e)]?this[_0x49ede1(0x20d)]():console[_0x49ede1(0x19a)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a57_0x2ba6d8(0x20d)](){const _0x36866a=a57_0x2ba6d8;try{this[_0x36866a(0x199)]=new node_telegram_bot_api_1[(_0x36866a(0x1f5))](this['botToken'],{'polling':!![]}),this['setupBotHandlers'](),console['log'](_0x36866a(0x1fb)+this[_0x36866a(0x1ec)]+_0x36866a(0x17b));}catch(_0x11c019){console[_0x36866a(0x21a)](_0x36866a(0x22d),_0x11c019);}}[a57_0x2ba6d8(0x1e9)](){const _0x5421d2=a57_0x2ba6d8;if(!this[_0x5421d2(0x199)])return;this['bot'][_0x5421d2(0x1e1)](/\/start/,async _0xf305cd=>{const _0x6a5df2=_0x5421d2,_0x438172=_0xf305cd[_0x6a5df2(0x16a)]['id'],_0x2c8850=_0xf305cd[_0x6a5df2(0x1f1)]?.['id']['toString'](),_0x534886=_0xf305cd['from']?.[_0x6a5df2(0x177)],_0x43036e=_0xf305cd[_0x6a5df2(0x1f1)]?.['first_name'],_0x3f6339=_0xf305cd[_0x6a5df2(0x1f1)]?.[_0x6a5df2(0x1f3)];if(!_0x2c8850)return;try{let _0x203bf1=await database_1[_0x6a5df2(0x1f5)]['telegramUser'][_0x6a5df2(0x20b)]({'where':{'telegramId':_0x2c8850},'include':{'shop':!![]}});!_0x203bf1?(_0x203bf1=await database_1[_0x6a5df2(0x1f5)][_0x6a5df2(0x1aa)][_0x6a5df2(0x1ba)]({'data':{'telegramId':_0x2c8850,'username':_0x534886,'firstName':_0x43036e,'lastName':_0x3f6339,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x6a5df2(0x1b7)+_0x2c8850+_0x6a5df2(0x18a)+_0x534886+')')):_0x203bf1=await database_1['default'][_0x6a5df2(0x1aa)][_0x6a5df2(0x1f0)]({'where':{'telegramId':_0x2c8850},'data':{'username':_0x534886,'firstName':_0x43036e,'lastName':_0x3f6339},'include':{'shop':!![]}}),_0x203bf1[_0x6a5df2(0x1b6)]&&_0x203bf1[_0x6a5df2(0x17c)]&&_0x203bf1[_0x6a5df2(0x189)]?await this['bot']?.[_0x6a5df2(0x1ce)](_0x438172,_0x6a5df2(0x204)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x203bf1[_0x6a5df2(0x189)][_0x6a5df2(0x16d)]+'*\x0a')+(_0x6a5df2(0x22b)+_0x203bf1['shop'][_0x6a5df2(0x177)]+_0x6a5df2(0x19d))+_0x6a5df2(0x210)+_0x6a5df2(0x229)+_0x6a5df2(0x174)+_0x6a5df2(0x1cd)+_0x6a5df2(0x161)+_0x6a5df2(0x1f4)+_0x6a5df2(0x1a3),{'parse_mode':_0x6a5df2(0x224)}):(_0x203bf1['shopId']&&!_0x203bf1[_0x6a5df2(0x1b6)]&&(await database_1[_0x6a5df2(0x1f5)][_0x6a5df2(0x1aa)]['update']({'where':{'telegramId':_0x2c8850},'data':{'shopId':null,'isVerified':![]}}),console[_0x6a5df2(0x15e)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x2c8850)),await this[_0x6a5df2(0x199)]?.[_0x6a5df2(0x1ce)](_0x438172,_0x6a5df2(0x190)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x6a5df2(0x218)+'Example:\x0a'+_0x6a5df2(0x1a2)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x6a5df2(0x224)}));}catch(_0x1ae6dc){console[_0x6a5df2(0x21a)]('Error\x20handling\x20/start\x20command:',_0x1ae6dc),await this['bot']?.[_0x6a5df2(0x1ce)](_0x438172,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['onText'](/\/disconnect/,async _0x594ab8=>{const _0x5802d7=_0x5421d2,_0x1b6f4f=_0x594ab8[_0x5802d7(0x16a)]['id'],_0x5e2ad1=_0x594ab8[_0x5802d7(0x1f1)]?.['id']['toString']();if(!_0x5e2ad1)return;try{const _0x571533=await database_1['default'][_0x5802d7(0x1aa)][_0x5802d7(0x20b)]({'where':{'telegramId':_0x5e2ad1},'include':{'shop':!![]}});if(!_0x571533||!_0x571533[_0x5802d7(0x1b6)]||!_0x571533[_0x5802d7(0x17c)]){await this[_0x5802d7(0x199)]?.['sendMessage'](_0x1b6f4f,_0x5802d7(0x1c2));return;}const _0x4797f0=_0x571533['shop']?.[_0x5802d7(0x16d)]||_0x5802d7(0x1da);await database_1[_0x5802d7(0x1f5)][_0x5802d7(0x1aa)][_0x5802d7(0x1f0)]({'where':{'telegramId':_0x5e2ad1},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x5802d7(0x16c)+_0x5e2ad1+'\x20disconnected\x20from\x20shop\x20'+_0x571533[_0x5802d7(0x17c)]),await this[_0x5802d7(0x199)]?.['sendMessage'](_0x1b6f4f,_0x5802d7(0x1a0)+_0x4797f0+_0x5802d7(0x1b8)+_0x5802d7(0x1d5),{'parse_mode':_0x5802d7(0x224)});}catch(_0x4303d4){console[_0x5802d7(0x21a)](_0x5802d7(0x1ef),_0x4303d4),await this[_0x5802d7(0x199)]?.[_0x5802d7(0x1ce)](_0x1b6f4f,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x5421d2(0x199)][_0x5421d2(0x1e1)](/\/status/,async _0x70cadb=>{const _0x30f574=_0x5421d2,_0x5ae0f5=_0x70cadb[_0x30f574(0x16a)]['id'],_0x715a21=_0x70cadb[_0x30f574(0x1f1)]?.['id']['toString']();if(!_0x715a21)return;try{const _0xdb5261=await database_1[_0x30f574(0x1f5)][_0x30f574(0x1aa)][_0x30f574(0x20b)]({'where':{'telegramId':_0x715a21},'include':{'shop':!![]}});if(!_0xdb5261){await this[_0x30f574(0x199)]?.[_0x30f574(0x1ce)](_0x5ae0f5,_0x30f574(0x1d8)+_0x30f574(0x19b));return;}if(!_0xdb5261[_0x30f574(0x1b6)]||!_0xdb5261[_0x30f574(0x17c)]||!_0xdb5261[_0x30f574(0x189)]){await this['bot']?.[_0x30f574(0x1ce)](_0x5ae0f5,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x30f574(0x200));return;}await this[_0x30f574(0x199)]?.[_0x30f574(0x1ce)](_0x5ae0f5,_0x30f574(0x16b)+(_0x30f574(0x191)+_0xdb5261[_0x30f574(0x189)][_0x30f574(0x16d)]+'*\x0a')+(_0x30f574(0x18e)+_0xdb5261[_0x30f574(0x189)][_0x30f574(0x177)]+'`\x0a')+(_0x30f574(0x244)+_0xdb5261['updatedAt'][_0x30f574(0x1fd)]('en-US')+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+'Commands:\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x30f574(0x224)});}catch(_0x5b4e63){console[_0x30f574(0x21a)](_0x30f574(0x21e),_0x5b4e63),await this[_0x30f574(0x199)]?.['sendMessage'](_0x5ae0f5,_0x30f574(0x226));}}),this['bot'][_0x5421d2(0x1e1)](/\/debug/,async _0xb42cde=>{const _0x536d2b=_0x5421d2,_0x37dbb7=_0xb42cde[_0x536d2b(0x16a)]['id'],_0x167ff8=_0xb42cde[_0x536d2b(0x1f1)]?.['id'][_0x536d2b(0x1bd)]();if(!_0x167ff8)return;try{const _0x75459=await database_1[_0x536d2b(0x1f5)][_0x536d2b(0x189)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x256e21=_0x536d2b(0x198);_0x256e21+=_0x536d2b(0x1d6)+_0x167ff8+'`\x0a\x0a',_0x256e21+=_0x536d2b(0x197),_0x75459['forEach']((_0x5c1de2,_0x3f8e0e)=>{const _0x523f59=_0x536d2b;_0x256e21+=_0x3f8e0e+0x1+'.\x20*'+_0x5c1de2[_0x523f59(0x16d)]+'*\x0a',_0x256e21+='\x20\x20\x20Username:\x20`'+_0x5c1de2['username']+'`\x0a',_0x256e21+=_0x523f59(0x193)+_0x5c1de2[_0x523f59(0x209)]+'\x0a',_0x256e21+=_0x523f59(0x230)+_0x5c1de2[_0x523f59(0x21f)][_0x523f59(0x201)](0x0,0xf)+_0x523f59(0x234);}),await this[_0x536d2b(0x199)]?.[_0x536d2b(0x1ce)](_0x37dbb7,_0x256e21,{'parse_mode':_0x536d2b(0x224)});}catch(_0x2348de){console[_0x536d2b(0x21a)]('Error\x20handling\x20/debug\x20command:',_0x2348de),await this[_0x536d2b(0x199)]?.['sendMessage'](_0x37dbb7,_0x536d2b(0x217));}}),this[_0x5421d2(0x199)]['on']('message',async _0x3aff06=>{const _0x5396f0=_0x5421d2;if(_0x3aff06[_0x5396f0(0x1ea)]?.[_0x5396f0(0x1a1)]('/'))return;const _0x38a564=_0x3aff06[_0x5396f0(0x16a)]['id'],_0x1fa7ee=_0x3aff06[_0x5396f0(0x1f1)]?.['id'][_0x5396f0(0x1bd)](),_0x417c59=_0x3aff06[_0x5396f0(0x1ea)]?.[_0x5396f0(0x227)]();if(!_0x1fa7ee||!_0x417c59)return;try{const _0x3d816e=await database_1[_0x5396f0(0x1f5)][_0x5396f0(0x1aa)][_0x5396f0(0x20b)]({'where':{'telegramId':_0x1fa7ee},'include':{'shop':!![]}});if(!_0x3d816e){await this[_0x5396f0(0x199)]?.['sendMessage'](_0x38a564,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x3d816e[_0x5396f0(0x1b6)]&&_0x3d816e[_0x5396f0(0x17c)]&&_0x3d816e[_0x5396f0(0x189)]){await this[_0x5396f0(0x199)]?.[_0x5396f0(0x1ce)](_0x38a564,_0x5396f0(0x1e0)+_0x3d816e[_0x5396f0(0x189)][_0x5396f0(0x16d)]+_0x5396f0(0x1b8)+_0x5396f0(0x17a),{'parse_mode':'Markdown'});return;}const _0x1c9ea4=_0x417c59[_0x5396f0(0x1e3)](/\s+/);if(_0x1c9ea4[_0x5396f0(0x195)]!==0x2){await this[_0x5396f0(0x199)]?.['sendMessage'](_0x38a564,_0x5396f0(0x159)+_0x5396f0(0x218)+_0x5396f0(0x1e6)+_0x5396f0(0x1a2)+(_0x5396f0(0x173)+_0x1c9ea4[_0x5396f0(0x195)]+_0x5396f0(0x211)+_0x1c9ea4[_0x5396f0(0x22f)](_0x284e04=>'`'+_0x284e04+'`')['join'](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x4a156f,_0x51e994]=_0x1c9ea4;console[_0x5396f0(0x15e)](_0x5396f0(0x18d)+_0x1fa7ee+_0x5396f0(0x172)+_0x4a156f+_0x5396f0(0x21d)+_0x51e994[_0x5396f0(0x201)](0x0,0xa)+_0x5396f0(0x192)),await this['handleSingleLineVerification'](_0x38a564,_0x1fa7ee,_0x4a156f,_0x51e994);}catch(_0x38e1b4){console[_0x5396f0(0x21a)](_0x5396f0(0x1a9),_0x38e1b4),await this[_0x5396f0(0x199)]?.[_0x5396f0(0x1ce)](_0x38a564,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x5421d2(0x199)]['on']('error',_0x3ccd8f=>{const _0x1af43d=_0x5421d2;console[_0x1af43d(0x21a)](_0x1af43d(0x180),_0x3ccd8f);}),this['bot']['on'](_0x5421d2(0x1d0),_0x2ac6e1=>{const _0x1ba918=_0x5421d2;console[_0x1ba918(0x21a)](_0x1ba918(0x1c6),_0x2ac6e1);});}async[a57_0x2ba6d8(0x1dc)](_0x4ee163,_0x374c8f,_0x47fa77,_0x803ff8){const _0xbac814=a57_0x2ba6d8;try{console[_0xbac814(0x15e)](_0xbac814(0x18d)+_0x374c8f+_0xbac814(0x172)+_0x47fa77+_0xbac814(0x21d)+_0x803ff8['substring'](0x0,0xa)+'...\x22');if(!_0x47fa77||_0x47fa77[_0xbac814(0x195)]<0x3||_0x47fa77[_0xbac814(0x195)]>0x32||!/^[a-zA-Z0-9_]+$/[_0xbac814(0x22a)](_0x47fa77)){await this[_0xbac814(0x199)]?.['sendMessage'](_0x4ee163,_0xbac814(0x18c)+_0x47fa77+_0xbac814(0x19d)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0xbac814(0x224)});return;}if(!_0x803ff8||!_0x803ff8[_0xbac814(0x1a1)](_0xbac814(0x1d1))&&!_0x803ff8[_0xbac814(0x1a1)](_0xbac814(0x196))){await this[_0xbac814(0x199)]?.['sendMessage'](_0x4ee163,_0xbac814(0x243)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':'Markdown'});return;}const _0x306368=await database_1[_0xbac814(0x1f5)][_0xbac814(0x189)][_0xbac814(0x20b)]({'where':{'username':_0x47fa77},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x306368){const _0x4e80cc=await database_1['default'][_0xbac814(0x189)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x5aa6a6=_0xbac814(0x17f)+_0x47fa77+_0xbac814(0x246);_0x4e80cc[_0xbac814(0x195)]>0x0?(_0x5aa6a6+=_0xbac814(0x1c5),_0x4e80cc[_0xbac814(0x21b)](_0x22a2e7=>{const _0xf5bf9c=_0xbac814;_0x5aa6a6+='•\x20`'+_0x22a2e7[_0xf5bf9c(0x177)]+_0xf5bf9c(0x1cf)+_0x22a2e7[_0xf5bf9c(0x16d)]+')\x0a';}),_0x5aa6a6+=_0xbac814(0x170)):_0x5aa6a6+=_0xbac814(0x214);await this[_0xbac814(0x199)]?.[_0xbac814(0x1ce)](_0x4ee163,_0x5aa6a6,{'parse_mode':_0xbac814(0x224)});return;}if(_0x306368['status']!=='ACTIVE'){await this['bot']?.[_0xbac814(0x1ce)](_0x4ee163,_0xbac814(0x23a)+_0x47fa77+'`\x20is\x20inactive.\x0a\x0a'+_0xbac814(0x1cc),{'parse_mode':_0xbac814(0x224)});return;}if(_0x306368[_0xbac814(0x21f)]!==_0x803ff8&&_0x306368['secretKey']!==_0x803ff8){await this[_0xbac814(0x199)]?.[_0xbac814(0x1ce)](_0x4ee163,_0xbac814(0x22c)+_0x47fa77+_0xbac814(0x22e)+_0xbac814(0x1c4)+_0xbac814(0x241),{'parse_mode':_0xbac814(0x224)});return;}const _0x28e1bd=await database_1[_0xbac814(0x1f5)][_0xbac814(0x1aa)]['findFirst']({'where':{'shopId':_0x306368['id'],'isVerified':!![],'telegramId':{'not':_0x374c8f}}});if(_0x28e1bd){await this['bot']?.[_0xbac814(0x1ce)](_0x4ee163,_0xbac814(0x216)+_0x47fa77+_0xbac814(0x22e)+_0xbac814(0x232),{'parse_mode':_0xbac814(0x224)});return;}await database_1[_0xbac814(0x1f5)][_0xbac814(0x1aa)][_0xbac814(0x1f0)]({'where':{'telegramId':_0x374c8f},'data':{'shopId':_0x306368['id'],'isVerified':!![]}}),await this['bot']?.['sendMessage'](_0x4ee163,_0xbac814(0x18b)+_0xbac814(0x1f8)+('📱\x20Shop:\x20*'+_0x306368[_0xbac814(0x16d)]+'*\x0a')+('👤\x20Username:\x20`'+_0x306368[_0xbac814(0x177)]+_0xbac814(0x19d))+_0xbac814(0x1f7)+_0xbac814(0x229)+_0xbac814(0x174)+_0xbac814(0x1e2)+_0xbac814(0x185)+_0xbac814(0x161)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0xbac814(0x1a3),{'parse_mode':_0xbac814(0x224)}),console[_0xbac814(0x15e)]('✅\x20Telegram\x20user\x20'+_0x374c8f+_0xbac814(0x238)+_0x306368[_0xbac814(0x177)]+_0xbac814(0x20c));}catch(_0xbebcbe){console[_0xbac814(0x21a)](_0xbac814(0x178),_0xbebcbe),await this[_0xbac814(0x199)]?.[_0xbac814(0x1ce)](_0x4ee163,_0xbac814(0x162));}}async['sendShopNotification'](_0x5f42eb,_0x147480,_0x32428c){const _0x309c4d=a57_0x2ba6d8;if(!this[_0x309c4d(0x199)]){console[_0x309c4d(0x19a)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x28454e=await database_1[_0x309c4d(0x1f5)][_0x309c4d(0x1aa)][_0x309c4d(0x1ff)]({'where':{'shopId':_0x5f42eb,'isVerified':!![]}});if(_0x28454e[_0x309c4d(0x195)]===0x0){console[_0x309c4d(0x15e)](_0x309c4d(0x1ad)+_0x5f42eb);return;}const _0x132b37=_0x28454e['map'](async _0x8e5030=>{const _0x1dabd5=_0x309c4d;try{await this['bot']?.['sendMessage'](_0x8e5030[_0x1dabd5(0x203)],_0x147480,_0x32428c),console[_0x1dabd5(0x15e)](_0x1dabd5(0x181)+_0x8e5030[_0x1dabd5(0x203)]);}catch(_0x3bd72c){console[_0x1dabd5(0x21a)](_0x1dabd5(0x1c8)+_0x8e5030['telegramId']+':',_0x3bd72c),_0x3bd72c instanceof Error&&(_0x3bd72c[_0x1dabd5(0x1ac)][_0x1dabd5(0x231)]('blocked')||_0x3bd72c['message'][_0x1dabd5(0x231)](_0x1dabd5(0x1d7))||_0x3bd72c[_0x1dabd5(0x1ac)][_0x1dabd5(0x231)](_0x1dabd5(0x222)))&&(await database_1[_0x1dabd5(0x1f5)][_0x1dabd5(0x1aa)]['update']({'where':{'id':_0x8e5030['id']},'data':{'isVerified':![]}}),console[_0x1dabd5(0x15e)](_0x1dabd5(0x1c1)+_0x8e5030[_0x1dabd5(0x203)]+_0x1dabd5(0x15a)));}});await Promise[_0x309c4d(0x225)](_0x132b37);}catch(_0x467215){console[_0x309c4d(0x21a)](_0x309c4d(0x16f),_0x467215);}}async[a57_0x2ba6d8(0x233)](_0x65dd1,_0x57a62b,_0x200367){const _0x48df1a=a57_0x2ba6d8,_0x4fb719={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x30c437={'created':_0x48df1a(0x1a5),'paid':_0x48df1a(0x187),'failed':_0x48df1a(0x171),'expired':_0x48df1a(0x205),'refund':_0x48df1a(0x23e),'chargeback':_0x48df1a(0x1a4),'processing':_0x48df1a(0x167)},_0x21cbc9=_0x4fb719[_0x200367],_0x1ed8cb=_0x30c437[_0x200367],_0x1541ed=(0x0,gateway_1[_0x48df1a(0x1af)])(_0x57a62b['gateway']);console[_0x48df1a(0x15e)](_0x48df1a(0x245)+_0x57a62b[_0x48df1a(0x164)]+_0x48df1a(0x15d)+_0x1541ed+'\x22');let _0x458de9=_0x21cbc9+'\x20*'+_0x1ed8cb+_0x48df1a(0x228)+(_0x48df1a(0x1d3)+_0x57a62b['amount']+'\x20'+_0x57a62b['currency']+'*\x0a')+(_0x48df1a(0x1b3)+(_0x57a62b[_0x48df1a(0x1c0)]||_0x57a62b['id'])+'`\x0a')+(_0x48df1a(0x1db)+_0x57a62b['id']+'`\x0a')+(_0x48df1a(0x1de)+_0x1541ed+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x57a62b[_0x48df1a(0x194)])[_0x48df1a(0x186)]('en-US')+'\x0a');if(_0x57a62b['customerName']||_0x57a62b[_0x48df1a(0x184)]||_0x57a62b[_0x48df1a(0x221)]||_0x57a62b[_0x48df1a(0x1e5)]||_0x57a62b[_0x48df1a(0x18f)]){_0x458de9+=_0x48df1a(0x1c7);_0x57a62b[_0x48df1a(0x223)]&&(_0x458de9+=_0x48df1a(0x208)+_0x57a62b['customerName']+'`\x0a');_0x57a62b[_0x48df1a(0x184)]&&(_0x458de9+=_0x48df1a(0x23c)+_0x57a62b['customerEmail']+'`\x0a');_0x57a62b['remitterIban']&&(_0x458de9+=_0x48df1a(0x179)+_0x57a62b[_0x48df1a(0x221)]+'`\x0a');_0x57a62b[_0x48df1a(0x1e5)]&&(_0x458de9+='🌐\x20IP:\x20`'+_0x57a62b['customerIp']+'`\x0a');if(_0x57a62b[_0x48df1a(0x18f)]){const _0x1d51da=_0x57a62b['customerUa'][_0x48df1a(0x195)]>0x32?_0x57a62b['customerUa'][_0x48df1a(0x201)](0x0,0x32)+_0x48df1a(0x1eb):_0x57a62b[_0x48df1a(0x18f)];_0x458de9+=_0x48df1a(0x235)+_0x1d51da+'`\x0a';}}_0x200367===_0x48df1a(0x1ed)&&_0x57a62b[_0x48df1a(0x1bf)]&&(_0x458de9+='💸\x20Penalty\x20amount:\x20*'+_0x57a62b[_0x48df1a(0x1bf)]+_0x48df1a(0x168)),_0x200367===_0x48df1a(0x1df)&&(_0x458de9+=_0x48df1a(0x1dd)),_0x57a62b[_0x48df1a(0x1bc)]&&(_0x458de9+=_0x48df1a(0x1bb)+_0x57a62b[_0x48df1a(0x1bc)]+'\x0a'),await this['sendShopNotification'](_0x65dd1,_0x458de9,{'parse_mode':_0x48df1a(0x224)});}async[a57_0x2ba6d8(0x21c)](_0x72a3f8,_0x32a981,_0x1fa0da){const _0x574f2a=a57_0x2ba6d8,_0xe3949c={'created':'📤','completed':'✅','rejected':'❌'},_0x3c539f={'created':_0x574f2a(0x158),'completed':_0x574f2a(0x1b1),'rejected':_0x574f2a(0x166)},_0x80a84e=_0xe3949c[_0x1fa0da],_0x1bfe9a=_0x3c539f[_0x1fa0da],_0x2f110a=_0x80a84e+'\x20*'+_0x1bfe9a+_0x574f2a(0x228)+(_0x574f2a(0x23d)+_0x32a981[_0x574f2a(0x1ca)]+'\x20USD*\x0a')+(_0x574f2a(0x1ab)+_0x32a981[_0x574f2a(0x16e)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x32a981['id']+'`\x0a')+(_0x574f2a(0x239)+new Date(_0x32a981['createdAt'])[_0x574f2a(0x186)](_0x574f2a(0x1d4))+'\x0a')+(_0x32a981[_0x574f2a(0x1f2)]?'🔗\x20TXID:\x20`'+_0x32a981[_0x574f2a(0x1f2)]+'`':'');await this[_0x574f2a(0x160)](_0x72a3f8,_0x2f110a,{'parse_mode':_0x574f2a(0x224)});}async['sendLoginNotification'](_0x540a72,_0x50e7e6){const _0x138b40=a57_0x2ba6d8;try{const _0x3b04e0=await database_1[_0x138b40(0x1f5)][_0x138b40(0x15c)][_0x138b40(0x20b)]({'where':{'shopId':_0x540a72},'select':{'notificationLogin':!![]}});if(!_0x3b04e0?.['notificationLogin']){console[_0x138b40(0x15e)](_0x138b40(0x156)+_0x540a72);return;}const _0x3cc214=_0x50e7e6[_0x138b40(0x202)]?'🔐':'🚨',_0x4df039=_0x50e7e6[_0x138b40(0x202)]?_0x138b40(0x1b0):_0x138b40(0x19f);let _0x4e25e5=_0x3cc214+'\x20*'+_0x4df039+_0x138b40(0x228)+(_0x138b40(0x18e)+_0x50e7e6[_0x138b40(0x177)]+'`\x0a')+('📅\x20Time:\x20'+_0x50e7e6[_0x138b40(0x206)][_0x138b40(0x186)](_0x138b40(0x1d4))+'\x0a');_0x50e7e6[_0x138b40(0x15b)]&&(_0x4e25e5+=_0x138b40(0x1d2)+_0x50e7e6[_0x138b40(0x15b)]+'`\x0a');if(_0x50e7e6[_0x138b40(0x220)]){const _0xd8c970=_0x50e7e6[_0x138b40(0x220)][_0x138b40(0x195)]>0x32?_0x50e7e6[_0x138b40(0x220)][_0x138b40(0x201)](0x0,0x32)+_0x138b40(0x1eb):_0x50e7e6['userAgent'];_0x4e25e5+=_0x138b40(0x235)+_0xd8c970+'`\x0a';}!_0x50e7e6[_0x138b40(0x202)]&&(_0x4e25e5+=_0x138b40(0x1be)),await this['sendShopNotification'](_0x540a72,_0x4e25e5,{'parse_mode':_0x138b40(0x224)}),console['log'](_0x138b40(0x1e8)+_0x540a72+':\x20'+(_0x50e7e6[_0x138b40(0x202)]?_0x138b40(0x202):_0x138b40(0x15f)));}catch(_0x1f9645){console['error'](_0x138b40(0x207),_0x1f9645);}}async[a57_0x2ba6d8(0x169)](_0x1ed43e,_0x5e38b6){const _0x596983=a57_0x2ba6d8;try{const _0x568673=await database_1[_0x596983(0x1f5)][_0x596983(0x15c)][_0x596983(0x20b)]({'where':{'shopId':_0x1ed43e},'select':{'notificationApiError':!![]}});if(!_0x568673?.[_0x596983(0x242)]){console['log'](_0x596983(0x157)+_0x1ed43e);return;}let _0x14220f=_0x596983(0x176)+(_0x596983(0x17d)+_0x5e38b6[_0x596983(0x16e)]+'\x20'+_0x5e38b6[_0x596983(0x1c3)]+'`\x0a')+(_0x596983(0x1ee)+_0x5e38b6[_0x596983(0x206)][_0x596983(0x186)](_0x596983(0x1d4))+'\x0a');_0x5e38b6[_0x596983(0x20f)]&&(_0x14220f+=_0x596983(0x1f6)+_0x5e38b6['statusCode']+'`\x0a'),_0x14220f+=_0x596983(0x23b)+_0x5e38b6[_0x596983(0x1b2)]+'`\x0a',_0x5e38b6[_0x596983(0x183)]&&(_0x14220f+=_0x596983(0x1f9)+_0x5e38b6[_0x596983(0x183)]+'`\x0a'),_0x14220f+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x596983(0x160)](_0x1ed43e,_0x14220f,{'parse_mode':_0x596983(0x224)}),console['log'](_0x596983(0x23f)+_0x1ed43e+':\x20'+_0x5e38b6[_0x596983(0x1c3)]);}catch(_0x3bf3af){console[_0x596983(0x21a)](_0x596983(0x1d9),_0x3bf3af);}}async[a57_0x2ba6d8(0x1a6)](_0xb4855d,_0x47a9eb,_0x180e3c){const _0x218bcd=a57_0x2ba6d8;let _0x1b4e81=_0x218bcd(0x212)+_0x47a9eb+'*\x0a\x0a';for(const [_0x1d1b5a,_0x382f21]of Object[_0x218bcd(0x1c9)](_0x180e3c)){_0x382f21!==null&&_0x382f21!==undefined&&(_0x1b4e81+=_0x1d1b5a+_0x218bcd(0x1fc)+_0x382f21+'`\x0a');}await this[_0x218bcd(0x160)](_0xb4855d,_0x1b4e81,{'parse_mode':_0x218bcd(0x224)});}[a57_0x2ba6d8(0x188)](){const _0x393ac9=a57_0x2ba6d8;return{'isActive':!!this[_0x393ac9(0x199)],'username':this['botUsername']};}[a57_0x2ba6d8(0x163)](){const _0x35039c=a57_0x2ba6d8;this['bot']&&(this[_0x35039c(0x199)][_0x35039c(0x1cb)](),this[_0x35039c(0x199)]=null,console[_0x35039c(0x15e)](_0x35039c(0x1b4)));}}exports[a57_0x2ba6d8(0x165)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();function a57_0x1389(){const _0x980129=['Commands:\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','stopBot','gateway','TelegramBotService','Payout\x20rejected','Payment\x20is\x20being\x20processed','\x20USDT*\x0a','sendApiErrorNotification','chat','📊\x20*Connection\x20Status*\x0a\x0a','🔌\x20User\x20','name','method','Error\x20sending\x20shop\x20notification:','\x0aCheck\x20spelling\x20and\x20try\x20again.','Payment\x20failed',':\x20username=\x22','You\x20sent\x20','•\x20Payment\x20status\x20changes\x0a','defineProperty','🚨\x20*API\x20Error*\x0a\x0a','username','Error\x20in\x20handleSingleLineVerification:','🏦\x20IBAN:\x20`','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','\x20initialized\x20successfully','shopId','🔗\x20Endpoint:\x20`','env','❌\x20Shop\x20with\x20username\x20`','Telegram\x20bot\x20error:','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','418452PUAyKX','requestId','customerEmail','•\x20Important\x20events\x0a\x0a','toLocaleString','Payment\x20successfully\x20paid','getBotInfo','shop','\x20(@','🎉\x20*Congratulations!*\x0a\x0a','❌\x20Invalid\x20username\x20format:\x20`','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','👤\x20Username:\x20`','customerUa','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','✅\x20Connected\x20to\x20shop:\x20*','...\x22','\x20\x20\x20Status:\x20','createdAt','length','sk_','🏪\x20Available\x20shops\x20in\x20system:\x0a','🔍\x20*Debug\x20Information*\x0a\x0a','bot','warn','Use\x20/start\x20to\x20begin.','2LuFMXn','`\x0a\x0a','375060uIMMBr','Failed\x20login\x20attempt','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','startsWith','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','/disconnect\x20-\x20disconnect\x20from\x20notifications','Payment\x20chargeback','New\x20payment\x20created','sendCustomNotification','__esModule','__importDefault','Error\x20handling\x20message:','telegramUser','🏦\x20Method:\x20`','message','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','300KpXxJT','getGatewayDisplayNameForTelegram','Successful\x20login','Payout\x20completed','errorMessage','📝\x20Order\x20ID:\x20`','🛑\x20Telegram\x20bot\x20stopped','3860WemrEm','isVerified','📱\x20Created\x20new\x20Telegram\x20user:\x20','*.\x0a\x0a','143hzvNXm','create','📝\x20Notes:\x20','adminNotes','toString','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','chargebackAmount','orderId','User\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','endpoint','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','Available\x20usernames:\x0a','Telegram\x20bot\x20polling\x20error:','\x0a👤\x20*Customer\x20Information:*\x0a','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','entries','amount','stopPolling','Contact\x20administrator.','•\x20Payouts\x0a\x0a','sendMessage','`\x20(','polling_error','pk_','🌐\x20IP\x20address:\x20`','💰\x20Amount:\x20*','en-US','To\x20reconnect,\x20use\x20the\x20/start\x20command','📱\x20Your\x20Telegram\x20ID:\x20`','chat\x20not\x20found','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','Failed\x20to\x20send\x20API\x20error\x20notification:','unknown\x20shop','🆔\x20Payment\x20ID:\x20`','handleSingleLineVerification','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','🏪\x20Gateway:\x20`','processing','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','onText','•\x20Payouts\x0a','split','TELEGRAM_BOT_TOKEN','customerIp','Example:\x0a','3630tlFchm','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','setupBotHandlers','text','...','botUsername','chargeback','📅\x20Time:\x20','Error\x20handling\x20/disconnect\x20command:','update','from','txid','last_name','/status\x20-\x20check\x20connection\x20status\x0a','default','📊\x20Error\x20code:\x20`','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','🆔\x20Request\x20ID:\x20`','node-telegram-bot-api','✅\x20Telegram\x20bot\x20@',':\x20`','toLocaleDateString','TELEGRAM_BOT_USERNAME','findMany','Use\x20/start\x20to\x20connect.','substring','success','telegramId','✅\x20Welcome\x20back!\x0a\x0a','Payment\x20expired','timestamp','Failed\x20to\x20send\x20login\x20notification:','📛\x20Name:\x20`','status','238534yPrgiE','findUnique','\x20via\x20single-line\x20input','initializeBot','botToken','statusCode','🔔\x20You\x20receive\x20notifications\x20about:\x0a','\x20parts:\x20','🔔\x20*','../types/gateway','Check\x20spelling\x20and\x20try\x20again.','telegramBotService','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','❌\x20Error\x20getting\x20debug\x20information.','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','7GTiMjG','error','forEach','sendPayoutNotification','\x22,\x20apiKey=\x22','Error\x20handling\x20/status\x20command:','publicKey','userAgent','remitterIban','user\x20is\x20deactivated','customerName','Markdown','allSettled','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','trim','*\x0a\x0a','•\x20New\x20payments\x0a','test','Username:\x20`','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','`.\x0a\x0a','map','\x20\x20\x20Public\x20Key:\x20`','includes','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','sendPaymentNotification','...`\x0a\x0a','💻\x20Browser:\x20`','14103tYNdPX','3832740LKvLmh','\x20verified\x20for\x20shop\x20','📅\x20Date:\x20','❌\x20Shop\x20`','❌\x20Error:\x20`','📧\x20Email:\x20`','💸\x20Amount:\x20*','Payment\x20refund','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','29328uzjdSA','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','notificationApiError','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','📅\x20Connection\x20date:\x20','📱\x20Telegram\x20notification:\x20gateway\x20\x22','`\x20not\x20found.\x0a\x0a','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','New\x20payout\x20created','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','ipAddress','shopSettings','\x22\x20->\x20display\x20\x22','log','failed','sendShopNotification'];a57_0x1389=function(){return _0x980129;};return a57_0x1389();}