'use strict';function a53_0x1aee(){const _0x2ea301=['Error\x20in\x20handleSingleLineVerification:','•\x20`','Use\x20/start\x20to\x20begin.','length','❌\x20Invalid\x20username\x20format:\x20`','toLocaleString','✅\x20Telegram\x20bot\x20@','165ejRGwG','Contact\x20administrator.','✅\x20Connected\x20to\x20shop:\x20*','🔗\x20TXID:\x20`','Error\x20handling\x20/start\x20command:','failed','createdAt','\x0a👤\x20*Customer\x20Information:*\x0a','Telegram\x20bot\x20error:','stopBot','TELEGRAM_BOT_USERNAME','chat\x20not\x20found','from','...','👤\x20Username:\x20`','getGatewayDisplayNameForTelegram','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','/disconnect\x20-\x20disconnect\x20from\x20notifications','chargebackAmount','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','shop','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','7604LCDPCh','📱\x20Created\x20new\x20Telegram\x20user:\x20','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','Failed\x20login\x20attempt','*.\x0a\x0a','sendCustomNotification','2WbfPEr','log','📅\x20Connection\x20date:\x20','\x20USD*\x0a','split','\x20\x20\x20Status:\x20','Markdown','🏪\x20Gateway:\x20`','208314wPjPSX','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','Payout\x20rejected','To\x20reconnect,\x20use\x20the\x20/start\x20command','node-telegram-bot-api','256TMHnjp','\x22,\x20apiKey=\x22','user\x20is\x20deactivated','create',':\x20`','bot','265GMUnxP','❌\x20Shop\x20`','2576742DyazpZ','statusCode','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','🔔\x20Notifications\x20are\x20active\x0a\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','🔔\x20*','botToken','💸\x20Amount:\x20*','handleSingleLineVerification','`.\x0a\x0a','sendApiErrorNotification','telegramBotService','7fAjGNe','status','•\x20Payouts\x0a','username','allSettled','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','sendPaymentNotification','📛\x20Name:\x20`','🏦\x20Method:\x20`','setupBotHandlers','name','orderId','🆔\x20Payment\x20ID:\x20`','\x20(@','✅\x20Welcome\x20back!\x0a\x0a','Payout\x20completed','sendMessage','\x0aCheck\x20spelling\x20and\x20try\x20again.','__esModule','first_name','getBotInfo','telegramId','includes','🆔\x20Request\x20ID:\x20`','User\x20','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','/status\x20-\x20check\x20connection\x20status\x0a','amount','📅\x20Date:\x20','📱\x20Your\x20Telegram\x20ID:\x20`','stopPolling','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','•\x20Payment\x20status\x20changes\x0a','findMany','Successful\x20login','requestId','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','📧\x20Email:\x20`','notificationLogin','`\x20not\x20found.\x0a\x0a','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Check\x20spelling\x20and\x20try\x20again.','../config/database','processing','❌\x20Shop\x20with\x20username\x20`','sendShopNotification','🛑\x20Telegram\x20bot\x20stopped','updatedAt','...\x22','findFirst','error','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','../types/gateway','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','update','pk_','env','🔍\x20*Debug\x20Information*\x0a\x0a','Payment\x20expired','shopSettings','unknown\x20shop','ACTIVE','shopId','en-US','📅\x20Time:\x20','\x20disconnected\x20from\x20shop\x20','Available\x20usernames:\x0a','*\x0a\x0a','trapay_bot','success','initializeBot','endpoint','🔗\x20Endpoint:\x20`',':\x20username=\x22','join','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','toLocaleDateString','method','Payment\x20failed','onText','Telegram\x20bot\x20polling\x20error:','Error\x20sending\x20shop\x20notification:','telegramUser','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','🌐\x20IP\x20address:\x20`','144050BLWQxH','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','Error\x20handling\x20/debug\x20command:','🆔\x20Payout\x20ID:\x20`','💻\x20Browser:\x20`','\x20USDT*\x0a','chargeback','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','isVerified','🔔\x20You\x20receive\x20notifications\x20about:\x0a','✅\x20Telegram\x20user\x20','secretKey','toString','gateway','\x20initialized\x20successfully','text','983370fTLwvD','New\x20payment\x20created','txid','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','\x20\x20\x20Public\x20Key:\x20`','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','Use\x20/start\x20to\x20connect.','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','Username:\x20`','Example:\x0a','defineProperty','Error\x20handling\x20/disconnect\x20command:','publicKey','Error\x20handling\x20/status\x20command:','`\x0a\x0a','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','trim','403596mzpyJK','sendPayoutNotification','customerEmail','📱\x20Telegram\x20notification:\x20gateway\x20\x22','currency','message','last_name','chat','map','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','TELEGRAM_BOT_TOKEN','🚨\x20*API\x20Error*\x0a\x0a','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','...`\x0a\x0a','❌\x20Error\x20getting\x20debug\x20information.','🎉\x20*Congratulations!*\x0a\x0a','You\x20sent\x20','114794YQfBVB','TelegramBotService','sendLoginNotification','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','botUsername','findUnique','Failed\x20to\x20send\x20login\x20notification:','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','substring','test','Failed\x20to\x20send\x20API\x20error\x20notification:','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','startsWith','timestamp','warn','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','Commands:\x0a','ipAddress','errorMessage','customerName','📝\x20Notes:\x20','•\x20New\x20payments\x0a','.\x20*','•\x20Payouts\x0a\x0a','userAgent','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','\x22\x20->\x20display\x20\x22','default','Payment\x20refund','❌\x20Error:\x20`','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'];a53_0x1aee=function(){return _0x2ea301;};return a53_0x1aee();}const a53_0x4df1de=a53_0x2526;(function(_0x2e11f5,_0x11c96c){const _0x3399ca=a53_0x2526,_0x161a7b=_0x2e11f5();while(!![]){try{const _0x3136b0=-parseInt(_0x3399ca(0x21b))/0x1*(-parseInt(_0x3399ca(0x25e))/0x2)+-parseInt(_0x3399ca(0x273))/0x3+parseInt(_0x3399ca(0x258))/0x4*(-parseInt(_0x3399ca(0x271))/0x5)+-parseInt(_0x3399ca(0x1f9))/0x6*(-parseInt(_0x3399ca(0x27f))/0x7)+-parseInt(_0x3399ca(0x26b))/0x8*(-parseInt(_0x3399ca(0x266))/0x9)+-parseInt(_0x3399ca(0x1e9))/0xa+-parseInt(_0x3399ca(0x241))/0xb*(-parseInt(_0x3399ca(0x20a))/0xc);if(_0x3136b0===_0x11c96c)break;else _0x161a7b['push'](_0x161a7b['shift']());}catch(_0x5572d6){_0x161a7b['push'](_0x161a7b['shift']());}}}(a53_0x1aee,0x86398));function a53_0x2526(_0x1ed1d6,_0x16c9c1){const _0x1aee95=a53_0x1aee();return a53_0x2526=function(_0x252674,_0x15eeb4){_0x252674=_0x252674-0x1db;let _0x3a37ec=_0x1aee95[_0x252674];return _0x3a37ec;},a53_0x2526(_0x1ed1d6,_0x16c9c1);}var __importDefault=this&&this['__importDefault']||function(_0x16a035){const _0x41656d=a53_0x2526;return _0x16a035&&_0x16a035[_0x41656d(0x291)]?_0x16a035:{'default':_0x16a035};};Object[a53_0x4df1de(0x203)](exports,'__esModule',{'value':!![]}),exports[a53_0x4df1de(0x27e)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a53_0x4df1de(0x26a))),database_1=__importDefault(require(a53_0x4df1de(0x2a9))),gateway_1=require(a53_0x4df1de(0x2b3));class TelegramBotService{constructor(){const _0x446d5f=a53_0x4df1de;this['bot']=null,this['botToken']=process[_0x446d5f(0x2b7)][_0x446d5f(0x214)]||'',this[_0x446d5f(0x21f)]=process['env'][_0x446d5f(0x24b)]||_0x446d5f(0x2c3),this['botToken']?this[_0x446d5f(0x2c5)]():console[_0x446d5f(0x229)](_0x446d5f(0x1e7));}[a53_0x4df1de(0x2c5)](){const _0x35d032=a53_0x4df1de;try{this['bot']=new node_telegram_bot_api_1[(_0x35d032(0x236))](this[_0x35d032(0x279)],{'polling':!![]}),this[_0x35d032(0x288)](),console[_0x35d032(0x25f)](_0x35d032(0x240)+this[_0x35d032(0x21f)]+_0x35d032(0x1f7));}catch(_0x2a4f21){console['error']('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x2a4f21);}}[a53_0x4df1de(0x288)](){const _0x4c1945=a53_0x4df1de;if(!this['bot'])return;this[_0x4c1945(0x270)][_0x4c1945(0x1e3)](/\/start/,async _0xd382b2=>{const _0x1f63ef=_0x4c1945,_0x3c8473=_0xd382b2[_0x1f63ef(0x211)]['id'],_0xe11d5e=_0xd382b2[_0x1f63ef(0x24d)]?.['id'][_0x1f63ef(0x1f5)](),_0x54d84c=_0xd382b2['from']?.['username'],_0x43227c=_0xd382b2[_0x1f63ef(0x24d)]?.[_0x1f63ef(0x292)],_0x2686ee=_0xd382b2[_0x1f63ef(0x24d)]?.[_0x1f63ef(0x210)];if(!_0xe11d5e)return;try{let _0x3c6329=await database_1[_0x1f63ef(0x236)][_0x1f63ef(0x1e6)][_0x1f63ef(0x220)]({'where':{'telegramId':_0xe11d5e},'include':{'shop':!![]}});!_0x3c6329?(_0x3c6329=await database_1[_0x1f63ef(0x236)][_0x1f63ef(0x1e6)][_0x1f63ef(0x26e)]({'data':{'telegramId':_0xe11d5e,'username':_0x54d84c,'firstName':_0x43227c,'lastName':_0x2686ee,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x1f63ef(0x25f)](_0x1f63ef(0x259)+_0xe11d5e+_0x1f63ef(0x28c)+_0x54d84c+')')):_0x3c6329=await database_1[_0x1f63ef(0x236)][_0x1f63ef(0x1e6)][_0x1f63ef(0x2b5)]({'where':{'telegramId':_0xe11d5e},'data':{'username':_0x54d84c,'firstName':_0x43227c,'lastName':_0x2686ee},'include':{'shop':!![]}}),_0x3c6329['isVerified']&&_0x3c6329[_0x1f63ef(0x2bd)]&&_0x3c6329['shop']?await this[_0x1f63ef(0x270)]?.[_0x1f63ef(0x28f)](_0x3c8473,_0x1f63ef(0x28d)+(_0x1f63ef(0x2b4)+_0x3c6329[_0x1f63ef(0x256)][_0x1f63ef(0x289)]+'*\x0a')+(_0x1f63ef(0x201)+_0x3c6329[_0x1f63ef(0x256)][_0x1f63ef(0x282)]+_0x1f63ef(0x207))+_0x1f63ef(0x1f2)+'•\x20New\x20payments\x0a'+_0x1f63ef(0x29f)+_0x1f63ef(0x232)+_0x1f63ef(0x22b)+_0x1f63ef(0x299)+_0x1f63ef(0x253),{'parse_mode':_0x1f63ef(0x264)}):(_0x3c6329['shopId']&&!_0x3c6329[_0x1f63ef(0x1f1)]&&(await database_1[_0x1f63ef(0x236)]['telegramUser'][_0x1f63ef(0x2b5)]({'where':{'telegramId':_0xe11d5e},'data':{'shopId':null,'isVerified':![]}}),console[_0x1f63ef(0x25f)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0xe11d5e)),await this[_0x1f63ef(0x270)]?.['sendMessage'](_0x3c8473,_0x1f63ef(0x21e)+_0x1f63ef(0x222)+_0x1f63ef(0x2a7)+'Example:\x0a'+_0x1f63ef(0x239)+_0x1f63ef(0x213),{'parse_mode':_0x1f63ef(0x264)}));}catch(_0x1d3ede){console[_0x1f63ef(0x2b1)](_0x1f63ef(0x245),_0x1d3ede),await this[_0x1f63ef(0x270)]?.[_0x1f63ef(0x28f)](_0x3c8473,_0x1f63ef(0x1f0));}}),this['bot'][_0x4c1945(0x1e3)](/\/disconnect/,async _0x488f14=>{const _0x3dbb92=_0x4c1945,_0x5e5ae8=_0x488f14[_0x3dbb92(0x211)]['id'],_0x3530af=_0x488f14[_0x3dbb92(0x24d)]?.['id'][_0x3dbb92(0x1f5)]();if(!_0x3530af)return;try{const _0x794c4d=await database_1[_0x3dbb92(0x236)][_0x3dbb92(0x1e6)]['findUnique']({'where':{'telegramId':_0x3530af},'include':{'shop':!![]}});if(!_0x794c4d||!_0x794c4d[_0x3dbb92(0x1f1)]||!_0x794c4d[_0x3dbb92(0x2bd)]){await this[_0x3dbb92(0x270)]?.[_0x3dbb92(0x28f)](_0x5e5ae8,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x4dd6b7=_0x794c4d['shop']?.[_0x3dbb92(0x289)]||_0x3dbb92(0x2bb);await database_1[_0x3dbb92(0x236)][_0x3dbb92(0x1e6)][_0x3dbb92(0x2b5)]({'where':{'telegramId':_0x3530af},'data':{'shopId':null,'isVerified':![]}}),console[_0x3dbb92(0x25f)]('🔌\x20User\x20'+_0x3530af+_0x3dbb92(0x2c0)+_0x794c4d[_0x3dbb92(0x2bd)]),await this[_0x3dbb92(0x270)]?.['sendMessage'](_0x5e5ae8,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x4dd6b7+_0x3dbb92(0x25c)+_0x3dbb92(0x269),{'parse_mode':_0x3dbb92(0x264)});}catch(_0x47f5a1){console[_0x3dbb92(0x2b1)](_0x3dbb92(0x204),_0x47f5a1),await this['bot']?.['sendMessage'](_0x5e5ae8,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x4c1945(0x270)][_0x4c1945(0x1e3)](/\/status/,async _0x2da42d=>{const _0x469cb2=_0x4c1945,_0x160348=_0x2da42d[_0x469cb2(0x211)]['id'],_0x5bc2f1=_0x2da42d['from']?.['id'][_0x469cb2(0x1f5)]();if(!_0x5bc2f1)return;try{const _0x128036=await database_1['default'][_0x469cb2(0x1e6)][_0x469cb2(0x220)]({'where':{'telegramId':_0x5bc2f1},'include':{'shop':!![]}});if(!_0x128036){await this[_0x469cb2(0x270)]?.[_0x469cb2(0x28f)](_0x160348,_0x469cb2(0x277)+_0x469cb2(0x23c));return;}if(!_0x128036[_0x469cb2(0x1f1)]||!_0x128036[_0x469cb2(0x2bd)]||!_0x128036[_0x469cb2(0x256)]){await this[_0x469cb2(0x270)]?.['sendMessage'](_0x160348,_0x469cb2(0x1df)+_0x469cb2(0x1ff));return;}await this[_0x469cb2(0x270)]?.['sendMessage'](_0x160348,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x469cb2(0x243)+_0x128036['shop'][_0x469cb2(0x289)]+'*\x0a')+(_0x469cb2(0x24f)+_0x128036[_0x469cb2(0x256)][_0x469cb2(0x282)]+'`\x0a')+(_0x469cb2(0x260)+_0x128036[_0x469cb2(0x2ae)][_0x469cb2(0x1e0)]('en-US')+'\x0a\x0a')+_0x469cb2(0x276)+_0x469cb2(0x22b)+_0x469cb2(0x253),{'parse_mode':_0x469cb2(0x264)});}catch(_0x56bc76){console[_0x469cb2(0x2b1)](_0x469cb2(0x206),_0x56bc76),await this['bot']?.[_0x469cb2(0x28f)](_0x160348,_0x469cb2(0x1f0));}}),this[_0x4c1945(0x270)][_0x4c1945(0x1e3)](/\/debug/,async _0x5efb97=>{const _0x5acc5c=_0x4c1945,_0x429ad8=_0x5efb97['chat']['id'],_0x5b65d1=_0x5efb97[_0x5acc5c(0x24d)]?.['id']['toString']();if(!_0x5b65d1)return;try{const _0x32d750=await database_1['default'][_0x5acc5c(0x256)][_0x5acc5c(0x2a0)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4b507b=_0x5acc5c(0x2b8);_0x4b507b+=_0x5acc5c(0x29c)+_0x5b65d1+'`\x0a\x0a',_0x4b507b+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x32d750['forEach']((_0x1f4729,_0x1f60b3)=>{const _0x27c5e9=_0x5acc5c;_0x4b507b+=_0x1f60b3+0x1+_0x27c5e9(0x231)+_0x1f4729[_0x27c5e9(0x289)]+'*\x0a',_0x4b507b+='\x20\x20\x20Username:\x20`'+_0x1f4729[_0x27c5e9(0x282)]+'`\x0a',_0x4b507b+=_0x27c5e9(0x263)+_0x1f4729[_0x27c5e9(0x280)]+'\x0a',_0x4b507b+=_0x27c5e9(0x1fd)+_0x1f4729[_0x27c5e9(0x205)]['substring'](0x0,0xf)+_0x27c5e9(0x217);}),await this['bot']?.[_0x5acc5c(0x28f)](_0x429ad8,_0x4b507b,{'parse_mode':_0x5acc5c(0x264)});}catch(_0x1742c5){console[_0x5acc5c(0x2b1)](_0x5acc5c(0x1eb),_0x1742c5),await this[_0x5acc5c(0x270)]?.[_0x5acc5c(0x28f)](_0x429ad8,_0x5acc5c(0x218));}}),this[_0x4c1945(0x270)]['on'](_0x4c1945(0x20f),async _0xb4cdf2=>{const _0x1de83d=_0x4c1945;if(_0xb4cdf2[_0x1de83d(0x1f8)]?.[_0x1de83d(0x227)]('/'))return;const _0x1f97a9=_0xb4cdf2['chat']['id'],_0x3b9ae1=_0xb4cdf2[_0x1de83d(0x24d)]?.['id'][_0x1de83d(0x1f5)](),_0x2abd4c=_0xb4cdf2[_0x1de83d(0x1f8)]?.[_0x1de83d(0x209)]();if(!_0x3b9ae1||!_0x2abd4c)return;try{const _0x35cb8d=await database_1[_0x1de83d(0x236)][_0x1de83d(0x1e6)][_0x1de83d(0x220)]({'where':{'telegramId':_0x3b9ae1},'include':{'shop':!![]}});if(!_0x35cb8d){await this[_0x1de83d(0x270)]?.[_0x1de83d(0x28f)](_0x1f97a9,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x35cb8d[_0x1de83d(0x1f1)]&&_0x35cb8d['shopId']&&_0x35cb8d[_0x1de83d(0x256)]){await this[_0x1de83d(0x270)]?.[_0x1de83d(0x28f)](_0x1f97a9,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x35cb8d[_0x1de83d(0x256)][_0x1de83d(0x289)]+'*.\x0a\x0a'+_0x1de83d(0x1fe),{'parse_mode':_0x1de83d(0x264)});return;}const _0x5b97c4=_0x2abd4c[_0x1de83d(0x262)](/\s+/);if(_0x5b97c4[_0x1de83d(0x23d)]!==0x2){await this['bot']?.[_0x1de83d(0x28f)](_0x1f97a9,_0x1de83d(0x255)+_0x1de83d(0x2a7)+_0x1de83d(0x202)+_0x1de83d(0x239)+(_0x1de83d(0x21a)+_0x5b97c4[_0x1de83d(0x23d)]+'\x20parts:\x20'+_0x5b97c4['map'](_0x422ec1=>'`'+_0x422ec1+'`')[_0x1de83d(0x1de)](',\x20')),{'parse_mode':_0x1de83d(0x264)});return;}const [_0x5b9f99,_0x3896d8]=_0x5b97c4;console[_0x1de83d(0x25f)](_0x1de83d(0x1fc)+_0x3b9ae1+_0x1de83d(0x1dd)+_0x5b9f99+_0x1de83d(0x26c)+_0x3896d8[_0x1de83d(0x223)](0x0,0xa)+_0x1de83d(0x2af)),await this[_0x1de83d(0x27b)](_0x1f97a9,_0x3b9ae1,_0x5b9f99,_0x3896d8);}catch(_0x44f8f7){console[_0x1de83d(0x2b1)]('Error\x20handling\x20message:',_0x44f8f7),await this[_0x1de83d(0x270)]?.[_0x1de83d(0x28f)](_0x1f97a9,_0x1de83d(0x1f0));}}),this[_0x4c1945(0x270)]['on'](_0x4c1945(0x2b1),_0x395763=>{const _0x96b508=_0x4c1945;console[_0x96b508(0x2b1)](_0x96b508(0x249),_0x395763);}),this[_0x4c1945(0x270)]['on']('polling_error',_0x64f8a=>{const _0x1b8307=_0x4c1945;console[_0x1b8307(0x2b1)](_0x1b8307(0x1e4),_0x64f8a);});}async[a53_0x4df1de(0x27b)](_0x1f6230,_0x109bb2,_0x7eb7e0,_0xb915e0){const _0x5417d1=a53_0x4df1de;try{console['log'](_0x5417d1(0x1fc)+_0x109bb2+_0x5417d1(0x1dd)+_0x7eb7e0+'\x22,\x20apiKey=\x22'+_0xb915e0[_0x5417d1(0x223)](0x0,0xa)+'...\x22');if(!_0x7eb7e0||_0x7eb7e0[_0x5417d1(0x23d)]<0x3||_0x7eb7e0[_0x5417d1(0x23d)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x5417d1(0x224)](_0x7eb7e0)){await this[_0x5417d1(0x270)]?.[_0x5417d1(0x28f)](_0x1f6230,_0x5417d1(0x23e)+_0x7eb7e0+_0x5417d1(0x207)+_0x5417d1(0x22a),{'parse_mode':_0x5417d1(0x264)});return;}if(!_0xb915e0||!_0xb915e0[_0x5417d1(0x227)](_0x5417d1(0x2b6))&&!_0xb915e0['startsWith']('sk_')){await this[_0x5417d1(0x270)]?.[_0x5417d1(0x28f)](_0x1f6230,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x5417d1(0x200),{'parse_mode':'Markdown'});return;}const _0x51f687=await database_1['default'][_0x5417d1(0x256)][_0x5417d1(0x220)]({'where':{'username':_0x7eb7e0},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x51f687){const _0x394d74=await database_1[_0x5417d1(0x236)][_0x5417d1(0x256)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x1e0168=_0x5417d1(0x2ab)+_0x7eb7e0+_0x5417d1(0x2a6);_0x394d74[_0x5417d1(0x23d)]>0x0?(_0x1e0168+=_0x5417d1(0x2c1),_0x394d74['forEach'](_0x28e438=>{const _0x24242c=_0x5417d1;_0x1e0168+=_0x24242c(0x23b)+_0x28e438[_0x24242c(0x282)]+'`\x20('+_0x28e438[_0x24242c(0x289)]+')\x0a';}),_0x1e0168+=_0x5417d1(0x290)):_0x1e0168+=_0x5417d1(0x2a8);await this[_0x5417d1(0x270)]?.[_0x5417d1(0x28f)](_0x1f6230,_0x1e0168,{'parse_mode':_0x5417d1(0x264)});return;}if(_0x51f687[_0x5417d1(0x280)]!==_0x5417d1(0x2bc)){await this[_0x5417d1(0x270)]?.[_0x5417d1(0x28f)](_0x1f6230,_0x5417d1(0x272)+_0x7eb7e0+'`\x20is\x20inactive.\x0a\x0a'+_0x5417d1(0x242),{'parse_mode':_0x5417d1(0x264)});return;}if(_0x51f687[_0x5417d1(0x205)]!==_0xb915e0&&_0x51f687[_0x5417d1(0x1f4)]!==_0xb915e0){await this[_0x5417d1(0x270)]?.[_0x5417d1(0x28f)](_0x1f6230,_0x5417d1(0x2b2)+_0x7eb7e0+_0x5417d1(0x27c)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x5417d1(0x1ea),{'parse_mode':_0x5417d1(0x264)});return;}const _0x58b19d=await database_1['default'][_0x5417d1(0x1e6)][_0x5417d1(0x2b0)]({'where':{'shopId':_0x51f687['id'],'isVerified':!![],'telegramId':{'not':_0x109bb2}}});if(_0x58b19d){await this[_0x5417d1(0x270)]?.['sendMessage'](_0x1f6230,_0x5417d1(0x251)+_0x7eb7e0+_0x5417d1(0x27c)+_0x5417d1(0x252),{'parse_mode':_0x5417d1(0x264)});return;}await database_1[_0x5417d1(0x236)][_0x5417d1(0x1e6)][_0x5417d1(0x2b5)]({'where':{'telegramId':_0x109bb2},'data':{'shopId':_0x51f687['id'],'isVerified':!![]}}),await this[_0x5417d1(0x270)]?.[_0x5417d1(0x28f)](_0x1f6230,_0x5417d1(0x219)+_0x5417d1(0x234)+('📱\x20Shop:\x20*'+_0x51f687[_0x5417d1(0x289)]+'*\x0a')+(_0x5417d1(0x24f)+_0x51f687[_0x5417d1(0x282)]+'`\x0a\x0a')+_0x5417d1(0x216)+_0x5417d1(0x230)+_0x5417d1(0x29f)+_0x5417d1(0x281)+'•\x20Important\x20events\x0a\x0a'+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x5417d1(0x253),{'parse_mode':_0x5417d1(0x264)}),console[_0x5417d1(0x25f)](_0x5417d1(0x1f3)+_0x109bb2+'\x20verified\x20for\x20shop\x20'+_0x51f687[_0x5417d1(0x282)]+'\x20via\x20single-line\x20input');}catch(_0x2191a1){console[_0x5417d1(0x2b1)](_0x5417d1(0x23a),_0x2191a1),await this[_0x5417d1(0x270)]?.[_0x5417d1(0x28f)](_0x1f6230,_0x5417d1(0x29e));}}async[a53_0x4df1de(0x2ac)](_0x2d33fa,_0x5e6ffa,_0x3cfd49){const _0x2d8088=a53_0x4df1de;if(!this[_0x2d8088(0x270)]){console[_0x2d8088(0x229)](_0x2d8088(0x267));return;}try{const _0x5ea5b3=await database_1[_0x2d8088(0x236)][_0x2d8088(0x1e6)]['findMany']({'where':{'shopId':_0x2d33fa,'isVerified':!![]}});if(_0x5ea5b3[_0x2d8088(0x23d)]===0x0){console[_0x2d8088(0x25f)](_0x2d8088(0x25a)+_0x2d33fa);return;}const _0x452f97=_0x5ea5b3[_0x2d8088(0x212)](async _0x5af878=>{const _0x4c7f33=_0x2d8088;try{await this[_0x4c7f33(0x270)]?.[_0x4c7f33(0x28f)](_0x5af878['telegramId'],_0x5e6ffa,_0x3cfd49),console[_0x4c7f33(0x25f)](_0x4c7f33(0x298)+_0x5af878['telegramId']);}catch(_0x400619){console[_0x4c7f33(0x2b1)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x5af878[_0x4c7f33(0x294)]+':',_0x400619),_0x400619 instanceof Error&&(_0x400619[_0x4c7f33(0x20f)][_0x4c7f33(0x295)]('blocked')||_0x400619[_0x4c7f33(0x20f)][_0x4c7f33(0x295)](_0x4c7f33(0x24c))||_0x400619[_0x4c7f33(0x20f)][_0x4c7f33(0x295)](_0x4c7f33(0x26d)))&&(await database_1[_0x4c7f33(0x236)]['telegramUser']['update']({'where':{'id':_0x5af878['id']},'data':{'isVerified':![]}}),console['log'](_0x4c7f33(0x297)+_0x5af878[_0x4c7f33(0x294)]+_0x4c7f33(0x284)));}});await Promise[_0x2d8088(0x283)](_0x452f97);}catch(_0x57b7ba){console['error'](_0x2d8088(0x1e5),_0x57b7ba);}}async[a53_0x4df1de(0x285)](_0xef7662,_0x2ab2e3,_0x534856){const _0x342274=a53_0x4df1de,_0xf29db1={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0xfb0e94={'created':_0x342274(0x1fa),'paid':'Payment\x20successfully\x20paid','failed':_0x342274(0x1e2),'expired':_0x342274(0x2b9),'refund':_0x342274(0x237),'chargeback':'Payment\x20chargeback','processing':'Payment\x20is\x20being\x20processed'},_0x2eca9d=_0xf29db1[_0x534856],_0x35d1b9=_0xfb0e94[_0x534856],_0x467e58=(0x0,gateway_1[_0x342274(0x250)])(_0x2ab2e3[_0x342274(0x1f6)]);console['log'](_0x342274(0x20d)+_0x2ab2e3[_0x342274(0x1f6)]+_0x342274(0x235)+_0x467e58+'\x22');let _0x1b0348=_0x2eca9d+'\x20*'+_0x35d1b9+_0x342274(0x2c2)+('💰\x20Amount:\x20*'+_0x2ab2e3[_0x342274(0x29a)]+'\x20'+_0x2ab2e3[_0x342274(0x20e)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x2ab2e3[_0x342274(0x28a)]||_0x2ab2e3['id'])+'`\x0a')+(_0x342274(0x28b)+_0x2ab2e3['id']+'`\x0a')+(_0x342274(0x265)+_0x467e58+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x2ab2e3[_0x342274(0x247)])[_0x342274(0x23f)](_0x342274(0x2be))+'\x0a');(_0x2ab2e3[_0x342274(0x22e)]||_0x2ab2e3[_0x342274(0x20c)])&&(_0x1b0348+=_0x342274(0x248),_0x2ab2e3[_0x342274(0x22e)]&&(_0x1b0348+=_0x342274(0x286)+_0x2ab2e3[_0x342274(0x22e)]+'`\x0a'),_0x2ab2e3['customerEmail']&&(_0x1b0348+=_0x342274(0x2a4)+_0x2ab2e3[_0x342274(0x20c)]+'`\x0a')),_0x534856===_0x342274(0x1ef)&&_0x2ab2e3['chargebackAmount']&&(_0x1b0348+='💸\x20Penalty\x20amount:\x20*'+_0x2ab2e3[_0x342274(0x254)]+_0x342274(0x1ee)),_0x534856===_0x342274(0x2aa)&&(_0x1b0348+=_0x342274(0x2a3)),_0x2ab2e3['adminNotes']&&(_0x1b0348+=_0x342274(0x22f)+_0x2ab2e3['adminNotes']+'\x0a'),await this[_0x342274(0x2ac)](_0xef7662,_0x1b0348,{'parse_mode':'Markdown'});}async[a53_0x4df1de(0x20b)](_0x5dba68,_0x55ead8,_0x2eba94){const _0x4dbe7b=a53_0x4df1de,_0x5acee5={'created':'📤','completed':'✅','rejected':'❌'},_0x34a9ed={'created':'New\x20payout\x20created','completed':_0x4dbe7b(0x28e),'rejected':_0x4dbe7b(0x268)},_0xf75e9=_0x5acee5[_0x2eba94],_0x351bdf=_0x34a9ed[_0x2eba94],_0x6ffdd5=_0xf75e9+'\x20*'+_0x351bdf+'*\x0a\x0a'+(_0x4dbe7b(0x27a)+_0x55ead8[_0x4dbe7b(0x29a)]+_0x4dbe7b(0x261))+(_0x4dbe7b(0x287)+_0x55ead8['method']+'`\x0a')+(_0x4dbe7b(0x1ec)+_0x55ead8['id']+'`\x0a')+(_0x4dbe7b(0x29b)+new Date(_0x55ead8['createdAt'])['toLocaleString'](_0x4dbe7b(0x2be))+'\x0a')+(_0x55ead8[_0x4dbe7b(0x1fb)]?_0x4dbe7b(0x244)+_0x55ead8['txid']+'`':'');await this[_0x4dbe7b(0x2ac)](_0x5dba68,_0x6ffdd5,{'parse_mode':'Markdown'});}async[a53_0x4df1de(0x21d)](_0x340231,_0xe1b3be){const _0x5e2781=a53_0x4df1de;try{const _0x21cbe1=await database_1[_0x5e2781(0x236)][_0x5e2781(0x2ba)][_0x5e2781(0x220)]({'where':{'shopId':_0x340231},'select':{'notificationLogin':!![]}});if(!_0x21cbe1?.[_0x5e2781(0x2a5)]){console['log']('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x340231);return;}const _0x233fdb=_0xe1b3be['success']?'🔐':'🚨',_0x595aca=_0xe1b3be[_0x5e2781(0x2c4)]?_0x5e2781(0x2a1):_0x5e2781(0x25b);let _0x15092b=_0x233fdb+'\x20*'+_0x595aca+_0x5e2781(0x2c2)+(_0x5e2781(0x24f)+_0xe1b3be[_0x5e2781(0x282)]+'`\x0a')+(_0x5e2781(0x2bf)+_0xe1b3be[_0x5e2781(0x228)][_0x5e2781(0x23f)](_0x5e2781(0x2be))+'\x0a');_0xe1b3be[_0x5e2781(0x22c)]&&(_0x15092b+=_0x5e2781(0x1e8)+_0xe1b3be['ipAddress']+'`\x0a');if(_0xe1b3be['userAgent']){const _0x36b53b=_0xe1b3be[_0x5e2781(0x233)][_0x5e2781(0x23d)]>0x32?_0xe1b3be['userAgent'][_0x5e2781(0x223)](0x0,0x32)+_0x5e2781(0x24e):_0xe1b3be[_0x5e2781(0x233)];_0x15092b+=_0x5e2781(0x1ed)+_0x36b53b+'`\x0a';}!_0xe1b3be[_0x5e2781(0x2c4)]&&(_0x15092b+=_0x5e2781(0x208)),await this['sendShopNotification'](_0x340231,_0x15092b,{'parse_mode':_0x5e2781(0x264)}),console['log'](_0x5e2781(0x257)+_0x340231+':\x20'+(_0xe1b3be[_0x5e2781(0x2c4)]?'success':_0x5e2781(0x246)));}catch(_0x15c030){console[_0x5e2781(0x2b1)](_0x5e2781(0x221),_0x15c030);}}async[a53_0x4df1de(0x27d)](_0x4e2e25,_0x1144f3){const _0x4f38ae=a53_0x4df1de;try{const _0x23ef1f=await database_1[_0x4f38ae(0x236)][_0x4f38ae(0x2ba)][_0x4f38ae(0x220)]({'where':{'shopId':_0x4e2e25},'select':{'notificationApiError':!![]}});if(!_0x23ef1f?.['notificationApiError']){console[_0x4f38ae(0x25f)](_0x4f38ae(0x275)+_0x4e2e25);return;}let _0x311b36=_0x4f38ae(0x215)+(_0x4f38ae(0x1dc)+_0x1144f3[_0x4f38ae(0x1e1)]+'\x20'+_0x1144f3[_0x4f38ae(0x1db)]+'`\x0a')+('📅\x20Time:\x20'+_0x1144f3['timestamp'][_0x4f38ae(0x23f)](_0x4f38ae(0x2be))+'\x0a');_0x1144f3['statusCode']&&(_0x311b36+='📊\x20Error\x20code:\x20`'+_0x1144f3[_0x4f38ae(0x274)]+'`\x0a'),_0x311b36+=_0x4f38ae(0x238)+_0x1144f3[_0x4f38ae(0x22d)]+'`\x0a',_0x1144f3[_0x4f38ae(0x2a2)]&&(_0x311b36+=_0x4f38ae(0x296)+_0x1144f3[_0x4f38ae(0x2a2)]+'`\x0a'),_0x311b36+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x4f38ae(0x2ac)](_0x4e2e25,_0x311b36,{'parse_mode':_0x4f38ae(0x264)}),console[_0x4f38ae(0x25f)](_0x4f38ae(0x226)+_0x4e2e25+':\x20'+_0x1144f3[_0x4f38ae(0x1db)]);}catch(_0x3e9312){console[_0x4f38ae(0x2b1)](_0x4f38ae(0x225),_0x3e9312);}}async[a53_0x4df1de(0x25d)](_0x55c220,_0x493230,_0x415465){const _0xdfb586=a53_0x4df1de;let _0x213342=_0xdfb586(0x278)+_0x493230+_0xdfb586(0x2c2);for(const [_0x29e3e9,_0xd9f68f]of Object['entries'](_0x415465)){_0xd9f68f!==null&&_0xd9f68f!==undefined&&(_0x213342+=_0x29e3e9+_0xdfb586(0x26f)+_0xd9f68f+'`\x0a');}await this['sendShopNotification'](_0x55c220,_0x213342,{'parse_mode':'Markdown'});}[a53_0x4df1de(0x293)](){const _0x1148c3=a53_0x4df1de;return{'isActive':!!this[_0x1148c3(0x270)],'username':this['botUsername']};}[a53_0x4df1de(0x24a)](){const _0x26c61d=a53_0x4df1de;this[_0x26c61d(0x270)]&&(this['bot'][_0x26c61d(0x29d)](),this[_0x26c61d(0x270)]=null,console[_0x26c61d(0x25f)](_0x26c61d(0x2ad)));}}exports[a53_0x4df1de(0x21c)]=TelegramBotService,exports[a53_0x4df1de(0x27e)]=new TelegramBotService();