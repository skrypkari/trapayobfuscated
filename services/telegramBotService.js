'use strict';const a66_0x51f8a8=a66_0x4ffc;function a66_0x5784(){const _0x33c4f4=['❌\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a','`\x0a\x0a','toString','Telegram\x20bot\x20error:','telegramUser','\x20\x20\x20Name:\x20*','chat','Payment\x20is\x20being\x20processed','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','❌\x20Shop\x20with\x20username\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','shopId','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','52340ccEvbi','✅\x20File\x20sent\x20to\x20','amount','Commands:\x0a','🏦\x20IBAN:\x20`','`\x20not\x20found.\x0a\x0a','sendMessage','\x20USDT*\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','orderId','application/octet-stream','✅\x20Welcome\x20back!\x0a\x0a','❌\x20Error\x20getting\x20debug\x20information.','success','stopBot','.png','onText','secretKey','🌐\x20IP\x20address:\x20`','Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.','You\x20sent\x20','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','•\x20New\x20payments\x0a','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','sendPayoutNotification','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','To\x20reconnect,\x20use\x20the\x20/start\x20command','sendNotificationToAll','timestamp','processing','💻\x20Browser:\x20`','customerIp','🎉\x20*Congratulations!*\x0a\x0a','\x20\x20\x20Status:\x20','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','initializeBot','log','ipAddress','Payment\x20refund','📱\x20No\x20active\x20Telegram\x20users\x20found','chat\x20not\x20found','sendShopFile','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','1637986rJOeSl','✅\x20Telegram\x20bot\x20@','*.\x0a\x0a','📅\x20Time:\x20','🔍\x20*Debug\x20Information*\x0a\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','Example:\x0a','Payout\x20rejected','1228314jYoMOY','🆔\x20Payout\x20ID:\x20`','substring','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','shop','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','2lHIPRA','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','`.\x0a\x0a','\x20verified\x20for\x20shop\x20','text','sendShopNotification','image/jpeg','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','📅\x20Date:\x20','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Error\x20in\x20handleSingleLineVerification:','telegramBotService','TelegramBotService','sendDirectFile','❌\x20Telegram\x20bot\x20not\x20initialized','trapay_bot','🔌\x20User\x20','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','handleSingleLineVerification','../config/database','❌\x20Error:\x20`','💰\x20Amount:\x20*','sendDocument','📊\x20*Connection\x20Status*\x0a\x0a','🔗\x20Endpoint:\x20`','TELEGRAM_BOT_USERNAME','\x20(@','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','Contact\x20administrator.','default','🆔\x20Payment\x20ID:\x20`','map','•\x20Payment\x20status\x20changes\x0a','from','botUsername','endsWith','Error\x20sending\x20shop\x20notification:','📱\x20Your\x20Telegram\x20ID:\x20`','\x20users\x20of\x20shop\x20','\x0a👤\x20*Customer\x20Information:*\x0a','length','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','trim','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','📱\x20Telegram\x20notification:\x20gateway\x20\x22','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','userAgent','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','test','Markdown','•\x20Important\x20events\x0a\x0a','🛑\x20Telegram\x20bot\x20stopped','txid','sendPaymentNotification','unknown\x20shop','❌\x20Error\x20sending\x20file\x20to\x20shop:','*\x0a\x0a','polling_error','📱\x20Created\x20new\x20Telegram\x20user:\x20','chargeback','isVerified','telegramId','📊\x20Error\x20code:\x20`','botToken','🏦\x20Method:\x20`','adminNotes','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','sendCustomNotification','image/png','updatedAt','chargebackAmount','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','📱\x20Notification\x20sent\x20to\x20','Payment\x20chargeback','Payment\x20expired','\x20via\x20single-line\x20input','.pdf','Failed\x20login\x20attempt','User\x20','../types/gateway','bot','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','\x22\x20->\x20display\x20\x22','username','🌐\x20IP:\x20`','448795kkymWu','create','findUnique','defineProperty','last_name','•\x20Payouts\x0a','/status\x20-\x20check\x20connection\x20status\x0a','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','Successful\x20login','currency','name','New\x20payment\x20created','TELEGRAM_BOT_TOKEN','customerName','customerEmail','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','endpoint','💸\x20Amount:\x20*','New\x20payout\x20created','...\x22','📝\x20Notes:\x20','57NDdDVP','sendLoginNotification','allSettled','__importDefault','remitterIban','📱\x20Shop:\x20*','\x20disconnected\x20from\x20shop\x20','application/pdf','includes','sk_','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','customerUa','en-US','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','error','🆔\x20Request\x20ID:\x20`','toLocaleString','Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','env','findFirst','ACTIVE','📧\x20Email:\x20`','🔔\x20Notifications\x20are\x20active\x0a\x0a','findMany','16634GPliUW','\x20users','Error\x20handling\x20message:','gateway','\x20initialized\x20successfully','startsWith','1134568hKbEux','.jpeg','🏪\x20Gateway:\x20`','sendDirectMessage','👤\x20Username:\x20`','status','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','method','createdAt','update','🏪\x20Your\x20connected\x20shop:\x0a','...','2665071rBJXJo','🔔\x20You\x20receive\x20notifications\x20about:\x0a','warn','setupBotHandlers','message','__esModule','Payment\x20failed','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','requestId','user\x20is\x20deactivated','\x20USD*\x0a'];a66_0x5784=function(){return _0x33c4f4;};return a66_0x5784();}function a66_0x4ffc(_0x5444c8,_0x3001ac){const _0x57845f=a66_0x5784();return a66_0x4ffc=function(_0x4ffc6a,_0x1a572c){_0x4ffc6a=_0x4ffc6a-0xe3;let _0x2c7930=_0x57845f[_0x4ffc6a];return _0x2c7930;},a66_0x4ffc(_0x5444c8,_0x3001ac);}(function(_0x307d1d,_0x150673){const _0x287284=a66_0x4ffc,_0xef011f=_0x307d1d();while(!![]){try{const _0x43f1e2=-parseInt(_0x287284(0x1ae))/0x1*(-parseInt(_0x287284(0x128))/0x2)+parseInt(_0x287284(0x195))/0x3*(-parseInt(_0x287284(0xee))/0x4)+-parseInt(_0x287284(0x17f))/0x5+-parseInt(_0x287284(0x122))/0x6+parseInt(_0x287284(0x11a))/0x7+parseInt(_0x287284(0x1b4))/0x8+parseInt(_0x287284(0x1c2))/0x9;if(_0x43f1e2===_0x150673)break;else _0xef011f['push'](_0xef011f['shift']());}catch(_0x43e28b){_0xef011f['push'](_0xef011f['shift']());}}}(a66_0x5784,0x23847));var __importDefault=this&&this[a66_0x51f8a8(0x198)]||function(_0xce6094){const _0x575388=a66_0x51f8a8;return _0xce6094&&_0xce6094[_0x575388(0x1c7)]?_0xce6094:{'default':_0xce6094};};Object[a66_0x51f8a8(0x182)](exports,'__esModule',{'value':!![]}),exports[a66_0x51f8a8(0x133)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a66_0x51f8a8(0x13b))),gateway_1=require(a66_0x51f8a8(0x178));class TelegramBotService{constructor(){const _0xbff551=a66_0x51f8a8;this[_0xbff551(0x179)]=null,this['botToken']=process[_0xbff551(0x1a8)][_0xbff551(0x18b)]||'',this[_0xbff551(0x14a)]=process[_0xbff551(0x1a8)][_0xbff551(0x141)]||_0xbff551(0x137),this['botToken']?this[_0xbff551(0x112)]():console[_0xbff551(0x1c4)](_0xbff551(0x158));}[a66_0x51f8a8(0x112)](){const _0x12ade9=a66_0x51f8a8;try{this[_0x12ade9(0x179)]=new node_telegram_bot_api_1['default'](this[_0x12ade9(0x168)],{'polling':!![]}),this['setupBotHandlers'](),console['log'](_0x12ade9(0x11b)+this[_0x12ade9(0x14a)]+_0x12ade9(0x1b2));}catch(_0x4bf019){console[_0x12ade9(0x1a3)](_0x12ade9(0x103),_0x4bf019);}}[a66_0x51f8a8(0x1c5)](){const _0x5c23eb=a66_0x51f8a8;if(!this['bot'])return;this['bot'][_0x5c23eb(0xfe)](/\/start/,async _0x1cd66f=>{const _0x3ec219=_0x5c23eb,_0x5e3316=_0x1cd66f['chat']['id'],_0x3ca399=_0x1cd66f[_0x3ec219(0x149)]?.['id'][_0x3ec219(0x1cf)](),_0xe8b641=_0x1cd66f[_0x3ec219(0x149)]?.[_0x3ec219(0x17d)],_0x51b9fb=_0x1cd66f[_0x3ec219(0x149)]?.['first_name'],_0x23f542=_0x1cd66f[_0x3ec219(0x149)]?.[_0x3ec219(0x183)];if(!_0x3ca399)return;try{let _0x1592fe=await database_1['default'][_0x3ec219(0xe4)][_0x3ec219(0x181)]({'where':{'telegramId':_0x3ca399},'include':{'shop':!![]}});!_0x1592fe?(_0x1592fe=await database_1[_0x3ec219(0x145)][_0x3ec219(0xe4)][_0x3ec219(0x180)]({'data':{'telegramId':_0x3ca399,'username':_0xe8b641,'firstName':_0x51b9fb,'lastName':_0x23f542,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x3ec219(0x163)+_0x3ca399+_0x3ec219(0x142)+_0xe8b641+')')):_0x1592fe=await database_1[_0x3ec219(0x145)][_0x3ec219(0xe4)][_0x3ec219(0x1bf)]({'where':{'telegramId':_0x3ca399},'data':{'username':_0xe8b641,'firstName':_0x51b9fb,'lastName':_0x23f542},'include':{'shop':!![]}}),_0x1592fe[_0x3ec219(0x165)]&&_0x1592fe['shopId']&&_0x1592fe[_0x3ec219(0x126)]?await this['bot']?.[_0x3ec219(0xf4)](_0x5e3316,_0x3ec219(0xf9)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x1592fe[_0x3ec219(0x126)][_0x3ec219(0x189)]+'*\x0a')+('Username:\x20`'+_0x1592fe[_0x3ec219(0x126)][_0x3ec219(0x17d)]+'`\x0a\x0a')+_0x3ec219(0x1c3)+'•\x20New\x20payments\x0a'+_0x3ec219(0x148)+'•\x20Payouts\x0a\x0a'+_0x3ec219(0xf1)+_0x3ec219(0x185)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x3ec219(0x15a)}):(_0x1592fe['shopId']&&!_0x1592fe[_0x3ec219(0x165)]&&(await database_1[_0x3ec219(0x145)][_0x3ec219(0xe4)]['update']({'where':{'telegramId':_0x3ca399},'data':{'shopId':null,'isVerified':![]}}),console[_0x3ec219(0x113)](_0x3ec219(0x139)+_0x3ca399)),await this[_0x3ec219(0x179)]?.[_0x3ec219(0xf4)](_0x5e3316,_0x3ec219(0x17a)+_0x3ec219(0x119)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x3ec219(0x120)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x3ec219(0x111),{'parse_mode':'Markdown'}));}catch(_0x42ef74){console[_0x3ec219(0x1a3)]('Error\x20handling\x20/start\x20command:',_0x42ef74),await this[_0x3ec219(0x179)]?.[_0x3ec219(0xf4)](_0x5e3316,_0x3ec219(0x170));}}),this[_0x5c23eb(0x179)]['onText'](/\/disconnect/,async _0x3ec901=>{const _0x3c6b60=_0x5c23eb,_0x484129=_0x3ec901[_0x3c6b60(0xe6)]['id'],_0x1eff4e=_0x3ec901['from']?.['id']['toString']();if(!_0x1eff4e)return;try{const _0x3062e5=await database_1[_0x3c6b60(0x145)][_0x3c6b60(0xe4)]['findUnique']({'where':{'telegramId':_0x1eff4e},'include':{'shop':!![]}});if(!_0x3062e5||!_0x3062e5[_0x3c6b60(0x165)]||!_0x3062e5['shopId']){await this[_0x3c6b60(0x179)]?.[_0x3c6b60(0xf4)](_0x484129,_0x3c6b60(0x1a7));return;}const _0x186c4c=_0x3062e5[_0x3c6b60(0x126)]?.[_0x3c6b60(0x189)]||_0x3c6b60(0x15f);await database_1[_0x3c6b60(0x145)]['telegramUser'][_0x3c6b60(0x1bf)]({'where':{'telegramId':_0x1eff4e},'data':{'shopId':null,'isVerified':![]}}),console[_0x3c6b60(0x113)](_0x3c6b60(0x138)+_0x1eff4e+_0x3c6b60(0x19b)+_0x3062e5[_0x3c6b60(0xeb)]),await this[_0x3c6b60(0x179)]?.['sendMessage'](_0x484129,_0x3c6b60(0x1bb)+_0x186c4c+_0x3c6b60(0x11c)+_0x3c6b60(0x109),{'parse_mode':_0x3c6b60(0x15a)});}catch(_0x23b391){console[_0x3c6b60(0x1a3)]('Error\x20handling\x20/disconnect\x20command:',_0x23b391),await this[_0x3c6b60(0x179)]?.[_0x3c6b60(0xf4)](_0x484129,_0x3c6b60(0x170));}}),this[_0x5c23eb(0x179)][_0x5c23eb(0xfe)](/\/status/,async _0x3d3866=>{const _0x38637b=_0x5c23eb,_0x3bc98a=_0x3d3866['chat']['id'],_0x53f467=_0x3d3866[_0x38637b(0x149)]?.['id'][_0x38637b(0x1cf)]();if(!_0x53f467)return;try{const _0x39b690=await database_1[_0x38637b(0x145)]['telegramUser'][_0x38637b(0x181)]({'where':{'telegramId':_0x53f467},'include':{'shop':!![]}});if(!_0x39b690){await this['bot']?.['sendMessage'](_0x3bc98a,_0x38637b(0x11f)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x39b690[_0x38637b(0x165)]||!_0x39b690[_0x38637b(0xeb)]||!_0x39b690[_0x38637b(0x126)]){await this[_0x38637b(0x179)]?.[_0x38637b(0xf4)](_0x3bc98a,_0x38637b(0x125)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x38637b(0x179)]?.['sendMessage'](_0x3bc98a,_0x38637b(0x13f)+('✅\x20Connected\x20to\x20shop:\x20*'+_0x39b690[_0x38637b(0x126)][_0x38637b(0x189)]+'*\x0a')+(_0x38637b(0x1b8)+_0x39b690[_0x38637b(0x126)][_0x38637b(0x17d)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x39b690[_0x38637b(0x16e)]['toLocaleDateString'](_0x38637b(0x1a1))+'\x0a\x0a')+_0x38637b(0x1ac)+'Commands:\x0a'+_0x38637b(0xea),{'parse_mode':'Markdown'});}catch(_0x20f955){console[_0x38637b(0x1a3)]('Error\x20handling\x20/status\x20command:',_0x20f955),await this['bot']?.['sendMessage'](_0x3bc98a,_0x38637b(0x170));}}),this['bot'][_0x5c23eb(0xfe)](/\/debug/,async _0xb8f1b0=>{const _0x13f1ce=_0x5c23eb,_0x48e8bc=_0xb8f1b0[_0x13f1ce(0xe6)]['id'],_0x480eb9=_0xb8f1b0[_0x13f1ce(0x149)]?.['id'][_0x13f1ce(0x1cf)]();if(!_0x480eb9)return;try{const _0x48e06b=await database_1[_0x13f1ce(0x145)][_0x13f1ce(0xe4)]['findUnique']({'where':{'telegramId':_0x480eb9},'include':{'shop':!![]}});let _0x43c1c5=_0x13f1ce(0x11e);_0x43c1c5+=_0x13f1ce(0x14d)+_0x480eb9+_0x13f1ce(0x1ce),_0x48e06b?.['isVerified']&&_0x48e06b[_0x13f1ce(0x126)]?(_0x43c1c5+=_0x13f1ce(0x1c0),_0x43c1c5+=_0x13f1ce(0xe5)+_0x48e06b['shop']['name']+'*\x0a',_0x43c1c5+='\x20\x20\x20Username:\x20`'+_0x48e06b[_0x13f1ce(0x126)][_0x13f1ce(0x17d)]+'`\x0a',_0x43c1c5+=_0x13f1ce(0x110)+_0x48e06b[_0x13f1ce(0x126)][_0x13f1ce(0x1b9)]+'\x0a\x0a'):_0x43c1c5+=_0x13f1ce(0x1cd),_0x43c1c5+=_0x13f1ce(0x1a6),await this['bot']?.[_0x13f1ce(0xf4)](_0x48e8bc,_0x43c1c5,{'parse_mode':_0x13f1ce(0x15a)});}catch(_0x42e550){console[_0x13f1ce(0x1a3)]('Error\x20handling\x20/debug\x20command:',_0x42e550),await this[_0x13f1ce(0x179)]?.[_0x13f1ce(0xf4)](_0x48e8bc,_0x13f1ce(0xfa));}}),this['bot']['on'](_0x5c23eb(0x1c6),async _0x2f504c=>{const _0x5c73cc=_0x5c23eb;if(_0x2f504c[_0x5c73cc(0x12c)]?.[_0x5c73cc(0x1b3)]('/'))return;const _0x21ad5c=_0x2f504c['chat']['id'],_0x4cacca=_0x2f504c[_0x5c73cc(0x149)]?.['id'][_0x5c73cc(0x1cf)](),_0x3552e0=_0x2f504c[_0x5c73cc(0x12c)]?.[_0x5c73cc(0x152)]();if(!_0x4cacca||!_0x3552e0)return;try{const _0x17111=await database_1[_0x5c73cc(0x145)][_0x5c73cc(0xe4)]['findUnique']({'where':{'telegramId':_0x4cacca},'include':{'shop':!![]}});if(!_0x17111){await this[_0x5c73cc(0x179)]?.['sendMessage'](_0x21ad5c,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x17111[_0x5c73cc(0x165)]&&_0x17111[_0x5c73cc(0xeb)]&&_0x17111[_0x5c73cc(0x126)]){await this[_0x5c73cc(0x179)]?.[_0x5c73cc(0xf4)](_0x21ad5c,_0x5c73cc(0xe8)+_0x17111[_0x5c73cc(0x126)][_0x5c73cc(0x189)]+'*.\x0a\x0a'+_0x5c73cc(0x108),{'parse_mode':_0x5c73cc(0x15a)});return;}const _0x44b84d=_0x3552e0['split'](/\s+/);if(_0x44b84d[_0x5c73cc(0x150)]!==0x2){await this['bot']?.[_0x5c73cc(0xf4)](_0x21ad5c,_0x5c73cc(0x131)+_0x5c73cc(0x1c9)+_0x5c73cc(0x120)+_0x5c73cc(0x155)+(_0x5c73cc(0x102)+_0x44b84d[_0x5c73cc(0x150)]+'\x20parts:\x20'+_0x44b84d[_0x5c73cc(0x147)](_0x1e937b=>'`'+_0x1e937b+'`')['join'](',\x20')),{'parse_mode':_0x5c73cc(0x15a)});return;}const [_0x1ca670,_0x1ef281]=_0x44b84d;console['log'](_0x5c73cc(0x129)+_0x4cacca+':\x20username=\x22'+_0x1ca670+'\x22,\x20apiKey=\x22'+_0x1ef281[_0x5c73cc(0x124)](0x0,0xa)+_0x5c73cc(0x193)),await this[_0x5c73cc(0x13a)](_0x21ad5c,_0x4cacca,_0x1ca670,_0x1ef281);}catch(_0x29eea0){console[_0x5c73cc(0x1a3)](_0x5c73cc(0x1b0),_0x29eea0),await this[_0x5c73cc(0x179)]?.[_0x5c73cc(0xf4)](_0x21ad5c,_0x5c73cc(0x170));}}),this[_0x5c23eb(0x179)]['on'](_0x5c23eb(0x1a3),_0x49b33e=>{const _0x1d1e59=_0x5c23eb;console[_0x1d1e59(0x1a3)](_0x1d1e59(0xe3),_0x49b33e);}),this[_0x5c23eb(0x179)]['on'](_0x5c23eb(0x162),_0x4bef1e=>{const _0x12d455=_0x5c23eb;console[_0x12d455(0x1a3)]('Telegram\x20bot\x20polling\x20error:',_0x4bef1e);});}async[a66_0x51f8a8(0x13a)](_0x5939ca,_0x1071c3,_0x433d1f,_0x497928){const _0x24879b=a66_0x51f8a8;try{console[_0x24879b(0x113)](_0x24879b(0x129)+_0x1071c3+':\x20username=\x22'+_0x433d1f+'\x22,\x20apiKey=\x22'+_0x497928['substring'](0x0,0xa)+'...\x22');if(!_0x433d1f||_0x433d1f[_0x24879b(0x150)]<0x3||_0x433d1f[_0x24879b(0x150)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x24879b(0x159)](_0x433d1f)){await this[_0x24879b(0x179)]?.[_0x24879b(0xf4)](_0x5939ca,'❌\x20Invalid\x20username\x20format:\x20`'+_0x433d1f+'`\x0a\x0a'+_0x24879b(0xf6),{'parse_mode':_0x24879b(0x15a)});return;}if(!_0x497928||!_0x497928['startsWith']('pk_')&&!_0x497928[_0x24879b(0x1b3)](_0x24879b(0x19e))){await this[_0x24879b(0x179)]?.[_0x24879b(0xf4)](_0x5939ca,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x24879b(0x143),{'parse_mode':'Markdown'});return;}const _0x5b374e=await database_1[_0x24879b(0x145)][_0x24879b(0x126)][_0x24879b(0x181)]({'where':{'username':_0x433d1f},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x5b374e){const _0x210fbe=_0x24879b(0xe9)+_0x433d1f+_0x24879b(0xf3)+'Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a'+_0x24879b(0x101);await this['bot']?.[_0x24879b(0xf4)](_0x5939ca,_0x210fbe,{'parse_mode':_0x24879b(0x15a)});return;}if(_0x5b374e[_0x24879b(0x1b9)]!==_0x24879b(0x1aa)){await this['bot']?.[_0x24879b(0xf4)](_0x5939ca,'❌\x20Shop\x20`'+_0x433d1f+'`\x20is\x20inactive.\x0a\x0a'+_0x24879b(0x144),{'parse_mode':_0x24879b(0x15a)});return;}if(_0x5b374e['publicKey']!==_0x497928&&_0x5b374e[_0x24879b(0xff)]!==_0x497928){await this[_0x24879b(0x179)]?.[_0x24879b(0xf4)](_0x5939ca,_0x24879b(0x1bc)+_0x433d1f+'`.\x0a\x0a'+_0x24879b(0x16b)+_0x24879b(0xed),{'parse_mode':_0x24879b(0x15a)});return;}const _0x338a89=await database_1['default'][_0x24879b(0xe4)][_0x24879b(0x1a9)]({'where':{'shopId':_0x5b374e['id'],'isVerified':!![],'telegramId':{'not':_0x1071c3}}});if(_0x338a89){await this[_0x24879b(0x179)]?.[_0x24879b(0xf4)](_0x5939ca,_0x24879b(0x105)+_0x433d1f+_0x24879b(0x12a)+_0x24879b(0x18e),{'parse_mode':_0x24879b(0x15a)});return;}await database_1[_0x24879b(0x145)]['telegramUser'][_0x24879b(0x1bf)]({'where':{'telegramId':_0x1071c3},'data':{'shopId':_0x5b374e['id'],'isVerified':!![]}}),await this['bot']?.[_0x24879b(0xf4)](_0x5939ca,_0x24879b(0x10f)+_0x24879b(0x127)+(_0x24879b(0x19a)+_0x5b374e['name']+'*\x0a')+('👤\x20Username:\x20`'+_0x5b374e[_0x24879b(0x17d)]+'`\x0a\x0a')+_0x24879b(0x12f)+_0x24879b(0x104)+_0x24879b(0x148)+_0x24879b(0x184)+_0x24879b(0x15b)+_0x24879b(0xf1)+_0x24879b(0x185)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x24879b(0x15a)}),console[_0x24879b(0x113)]('✅\x20Telegram\x20user\x20'+_0x1071c3+_0x24879b(0x12b)+_0x5b374e[_0x24879b(0x17d)]+_0x24879b(0x174));}catch(_0x3adb1b){console['error'](_0x24879b(0x132),_0x3adb1b),await this[_0x24879b(0x179)]?.[_0x24879b(0xf4)](_0x5939ca,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a66_0x51f8a8(0x12d)](_0x1fe804,_0x46bbba,_0x29a8c9){const _0x402047=a66_0x51f8a8;if(!this['bot']){console[_0x402047(0x1c4)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x5f3d5a=await database_1[_0x402047(0x145)][_0x402047(0xe4)][_0x402047(0x1ad)]({'where':{'shopId':_0x1fe804,'isVerified':!![]}});if(_0x5f3d5a[_0x402047(0x150)]===0x0){console['log'](_0x402047(0x1a2)+_0x1fe804);return;}const _0x17a196=_0x5f3d5a[_0x402047(0x147)](async _0x590fdf=>{const _0x634862=_0x402047;try{await this[_0x634862(0x179)]?.[_0x634862(0xf4)](_0x590fdf['telegramId'],_0x46bbba,_0x29a8c9),console[_0x634862(0x113)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x590fdf[_0x634862(0x166)]);}catch(_0x1a336d){console[_0x634862(0x1a3)](_0x634862(0x19f)+_0x590fdf[_0x634862(0x166)]+':',_0x1a336d),_0x1a336d instanceof Error&&(_0x1a336d[_0x634862(0x1c6)]['includes']('blocked')||_0x1a336d[_0x634862(0x1c6)][_0x634862(0x19d)](_0x634862(0x117))||_0x1a336d['message'][_0x634862(0x19d)](_0x634862(0x1cb)))&&(await database_1[_0x634862(0x145)][_0x634862(0xe4)]['update']({'where':{'id':_0x590fdf['id']},'data':{'isVerified':![]}}),console[_0x634862(0x113)](_0x634862(0x177)+_0x590fdf['telegramId']+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x402047(0x197)](_0x17a196);}catch(_0x152a1d){console[_0x402047(0x1a3)](_0x402047(0x14c),_0x152a1d);}}async[a66_0x51f8a8(0x15e)](_0x46f76f,_0xe8f3e2,_0x330943){const _0x39011a=a66_0x51f8a8,_0x4af02a={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x56ac97={'created':_0x39011a(0x18a),'paid':'Payment\x20successfully\x20paid','failed':_0x39011a(0x1c8),'expired':_0x39011a(0x173),'refund':_0x39011a(0x115),'chargeback':_0x39011a(0x172),'processing':_0x39011a(0xe7)},_0x98be9c=_0x4af02a[_0x330943],_0x16ea07=_0x56ac97[_0x330943],_0x507c2b=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0xe8f3e2[_0x39011a(0x1b1)]);console[_0x39011a(0x113)](_0x39011a(0x154)+_0xe8f3e2[_0x39011a(0x1b1)]+_0x39011a(0x17c)+_0x507c2b+'\x22');let _0x3dff78=_0x98be9c+'\x20*'+_0x16ea07+'*\x0a\x0a'+(_0x39011a(0x13d)+_0xe8f3e2['amount']+'\x20'+_0xe8f3e2[_0x39011a(0x188)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0xe8f3e2[_0x39011a(0xf7)]||_0xe8f3e2['id'])+'`\x0a')+(_0x39011a(0x146)+_0xe8f3e2['id']+'`\x0a')+(_0x39011a(0x1b6)+_0x507c2b+'`\x0a')+(_0x39011a(0x130)+new Date(_0xe8f3e2[_0x39011a(0x1be)])[_0x39011a(0x1a5)]('en-US')+'\x0a');if(_0xe8f3e2[_0x39011a(0x18c)]||_0xe8f3e2[_0x39011a(0x18d)]||_0xe8f3e2['remitterIban']||_0xe8f3e2['customerIp']||_0xe8f3e2[_0x39011a(0x1a0)]){_0x3dff78+=_0x39011a(0x14f);_0xe8f3e2[_0x39011a(0x18c)]&&(_0x3dff78+='📛\x20Name:\x20`'+_0xe8f3e2[_0x39011a(0x18c)]+'`\x0a');_0xe8f3e2['customerEmail']&&(_0x3dff78+=_0x39011a(0x1ab)+_0xe8f3e2[_0x39011a(0x18d)]+'`\x0a');_0xe8f3e2[_0x39011a(0x199)]&&(_0x3dff78+=_0x39011a(0xf2)+_0xe8f3e2[_0x39011a(0x199)]+'`\x0a');_0xe8f3e2[_0x39011a(0x10e)]&&(_0x3dff78+=_0x39011a(0x17e)+_0xe8f3e2[_0x39011a(0x10e)]+'`\x0a');if(_0xe8f3e2[_0x39011a(0x1a0)]){const _0x44c419=_0xe8f3e2[_0x39011a(0x1a0)]['length']>0x32?_0xe8f3e2[_0x39011a(0x1a0)][_0x39011a(0x124)](0x0,0x32)+_0x39011a(0x1c1):_0xe8f3e2[_0x39011a(0x1a0)];_0x3dff78+=_0x39011a(0x10d)+_0x44c419+'`\x0a';}}_0x330943===_0x39011a(0x164)&&_0xe8f3e2['chargebackAmount']&&(_0x3dff78+='💸\x20Penalty\x20amount:\x20*'+_0xe8f3e2[_0x39011a(0x16f)]+_0x39011a(0xf5)),_0x330943===_0x39011a(0x10c)&&(_0x3dff78+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0xe8f3e2[_0x39011a(0x16a)]&&(_0x3dff78+=_0x39011a(0x194)+_0xe8f3e2[_0x39011a(0x16a)]+'\x0a'),await this[_0x39011a(0x12d)](_0x46f76f,_0x3dff78,{'parse_mode':_0x39011a(0x15a)});}async[a66_0x51f8a8(0x106)](_0x43cf81,_0xde1699,_0x346c4b){const _0x5f5533=a66_0x51f8a8,_0xc5a3b6={'created':'📤','completed':'✅','rejected':'❌'},_0x197374={'created':_0x5f5533(0x192),'completed':'Payout\x20completed','rejected':_0x5f5533(0x121)},_0x33ee8f=_0xc5a3b6[_0x346c4b],_0x58a640=_0x197374[_0x346c4b],_0x3fd6c4=_0x33ee8f+'\x20*'+_0x58a640+'*\x0a\x0a'+(_0x5f5533(0x191)+_0xde1699[_0x5f5533(0xf0)]+_0x5f5533(0x1cc))+(_0x5f5533(0x169)+_0xde1699[_0x5f5533(0x1bd)]+'`\x0a')+(_0x5f5533(0x123)+_0xde1699['id']+'`\x0a')+(_0x5f5533(0x130)+new Date(_0xde1699[_0x5f5533(0x1be)])[_0x5f5533(0x1a5)](_0x5f5533(0x1a1))+'\x0a')+(_0xde1699[_0x5f5533(0x15d)]?'🔗\x20TXID:\x20`'+_0xde1699[_0x5f5533(0x15d)]+'`':'');await this['sendShopNotification'](_0x43cf81,_0x3fd6c4,{'parse_mode':'Markdown'});}async[a66_0x51f8a8(0x196)](_0x204154,_0x3cb7aa){const _0x62701a=a66_0x51f8a8;try{const _0xa2dc99=await database_1[_0x62701a(0x145)]['shopSettings'][_0x62701a(0x181)]({'where':{'shopId':_0x204154},'select':{'notificationLogin':!![]}});if(!_0xa2dc99?.['notificationLogin']){console['log'](_0x62701a(0x18f)+_0x204154);return;}const _0xb0ac1b=_0x3cb7aa[_0x62701a(0xfb)]?'🔐':'🚨',_0x38bd11=_0x3cb7aa[_0x62701a(0xfb)]?_0x62701a(0x187):_0x62701a(0x176);let _0x3e04bd=_0xb0ac1b+'\x20*'+_0x38bd11+_0x62701a(0x161)+(_0x62701a(0x1b8)+_0x3cb7aa[_0x62701a(0x17d)]+'`\x0a')+(_0x62701a(0x11d)+_0x3cb7aa[_0x62701a(0x10b)][_0x62701a(0x1a5)](_0x62701a(0x1a1))+'\x0a');_0x3cb7aa[_0x62701a(0x114)]&&(_0x3e04bd+=_0x62701a(0x100)+_0x3cb7aa[_0x62701a(0x114)]+'`\x0a');if(_0x3cb7aa['userAgent']){const _0xfadf01=_0x3cb7aa[_0x62701a(0x157)][_0x62701a(0x150)]>0x32?_0x3cb7aa[_0x62701a(0x157)][_0x62701a(0x124)](0x0,0x32)+_0x62701a(0x1c1):_0x3cb7aa['userAgent'];_0x3e04bd+=_0x62701a(0x10d)+_0xfadf01+'`\x0a';}!_0x3cb7aa[_0x62701a(0xfb)]&&(_0x3e04bd+=_0x62701a(0x1ba)),await this[_0x62701a(0x12d)](_0x204154,_0x3e04bd,{'parse_mode':_0x62701a(0x15a)}),console[_0x62701a(0x113)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x204154+':\x20'+(_0x3cb7aa[_0x62701a(0xfb)]?_0x62701a(0xfb):'failed'));}catch(_0x1fc2bf){console['error']('Failed\x20to\x20send\x20login\x20notification:',_0x1fc2bf);}}async['sendApiErrorNotification'](_0x32e597,_0x50208c){const _0x4a76df=a66_0x51f8a8;try{const _0x5905c9=await database_1[_0x4a76df(0x145)]['shopSettings'][_0x4a76df(0x181)]({'where':{'shopId':_0x32e597},'select':{'notificationApiError':!![]}});if(!_0x5905c9?.['notificationApiError']){console[_0x4a76df(0x113)](_0x4a76df(0x156)+_0x32e597);return;}let _0x27a8c8='🚨\x20*API\x20Error*\x0a\x0a'+(_0x4a76df(0x140)+_0x50208c[_0x4a76df(0x1bd)]+'\x20'+_0x50208c[_0x4a76df(0x190)]+'`\x0a')+(_0x4a76df(0x11d)+_0x50208c[_0x4a76df(0x10b)][_0x4a76df(0x1a5)](_0x4a76df(0x1a1))+'\x0a');_0x50208c['statusCode']&&(_0x27a8c8+=_0x4a76df(0x167)+_0x50208c['statusCode']+'`\x0a'),_0x27a8c8+=_0x4a76df(0x13c)+_0x50208c['errorMessage']+'`\x0a',_0x50208c[_0x4a76df(0x1ca)]&&(_0x27a8c8+=_0x4a76df(0x1a4)+_0x50208c[_0x4a76df(0x1ca)]+'`\x0a'),_0x27a8c8+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this['sendShopNotification'](_0x32e597,_0x27a8c8,{'parse_mode':_0x4a76df(0x15a)}),console[_0x4a76df(0x113)](_0x4a76df(0x17b)+_0x32e597+':\x20'+_0x50208c[_0x4a76df(0x190)]);}catch(_0x19e26f){console[_0x4a76df(0x1a3)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x19e26f);}}async[a66_0x51f8a8(0x16c)](_0x1c9ad8,_0x536fe6,_0x186a1a){const _0x2596b3=a66_0x51f8a8;let _0x18f4f4='🔔\x20*'+_0x536fe6+_0x2596b3(0x161);for(const [_0x4ae354,_0x858773]of Object['entries'](_0x186a1a)){_0x858773!==null&&_0x858773!==undefined&&(_0x18f4f4+=_0x4ae354+':\x20`'+_0x858773+'`\x0a');}await this[_0x2596b3(0x12d)](_0x1c9ad8,_0x18f4f4,{'parse_mode':'Markdown'});}async[a66_0x51f8a8(0x10a)](_0x445c39){const _0x5f26c4=a66_0x51f8a8;try{console['log'](_0x5f26c4(0x153)+_0x445c39[_0x5f26c4(0x124)](0x0,0x32)+_0x5f26c4(0x1c1));const _0xd6ed9b=await database_1[_0x5f26c4(0x145)][_0x5f26c4(0xe4)][_0x5f26c4(0x1ad)]({'select':{'telegramId':!![]}});if(_0xd6ed9b[_0x5f26c4(0x150)]===0x0){console[_0x5f26c4(0x113)](_0x5f26c4(0x116));return;}for(const _0x1f0d18 of _0xd6ed9b){try{await this[_0x5f26c4(0x179)]?.[_0x5f26c4(0xf4)](_0x1f0d18[_0x5f26c4(0x166)],_0x445c39,{'parse_mode':_0x5f26c4(0x15a)});}catch(_0x27423a){console[_0x5f26c4(0x1a3)](_0x5f26c4(0xec)+_0x1f0d18[_0x5f26c4(0x166)]+':',_0x27423a);}}console[_0x5f26c4(0x113)](_0x5f26c4(0x171)+_0xd6ed9b['length']+_0x5f26c4(0x1af));}catch(_0x527af7){console['error'](_0x5f26c4(0x107),_0x527af7);}}['getBotInfo'](){const _0x2a3faf=a66_0x51f8a8;return{'isActive':!!this[_0x2a3faf(0x179)],'username':this[_0x2a3faf(0x14a)]};}async[a66_0x51f8a8(0x118)](_0x254033,_0x3289e0,_0x47ee43,_0x4f6377){const _0x35a399=a66_0x51f8a8;try{if(!this[_0x35a399(0x179)])return console[_0x35a399(0x1a3)](_0x35a399(0x136)),![];const _0x2d7ab6=await database_1[_0x35a399(0x145)]['telegramUser'][_0x35a399(0x1ad)]({'where':{'shopId':_0x254033,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x2d7ab6[_0x35a399(0x150)]===0x0)return console[_0x35a399(0x1a3)](_0x35a399(0x151)+_0x254033),![];let _0x399950=0x0;for(const _0x533392 of _0x2d7ab6){try{await this['bot'][_0x35a399(0x13e)](_0x533392[_0x35a399(0x166)],_0x3289e0,{},{'filename':_0x47ee43,'contentType':_0x47ee43[_0x35a399(0x14b)]('.png')?_0x35a399(0x16d):_0x47ee43[_0x35a399(0x14b)]('.jpg')||_0x47ee43[_0x35a399(0x14b)](_0x35a399(0x1b5))?'image/jpeg':_0x47ee43['endsWith'](_0x35a399(0x175))?_0x35a399(0x19c):_0x35a399(0xf8)}),_0x4f6377&&await this[_0x35a399(0x179)][_0x35a399(0xf4)](_0x533392[_0x35a399(0x166)],_0x4f6377),_0x399950++;}catch(_0x3775ad){console[_0x35a399(0x1a3)]('❌\x20Error\x20sending\x20file\x20to\x20user\x20'+_0x533392[_0x35a399(0x166)]+':',_0x3775ad);}}return console['log'](_0x35a399(0xef)+_0x399950+'/'+_0x2d7ab6['length']+_0x35a399(0x14e)+_0x254033+':\x20'+_0x47ee43),_0x399950>0x0;}catch(_0x4bc73a){return console['error'](_0x35a399(0x160),_0x4bc73a),![];}}async[a66_0x51f8a8(0x1b7)](_0x33dd6e,_0xd76613){const _0x48e9a5=a66_0x51f8a8;try{if(!this[_0x48e9a5(0x179)])return console[_0x48e9a5(0x1a3)](_0x48e9a5(0x136)),![];return await this['bot'][_0x48e9a5(0xf4)](_0x33dd6e,_0xd76613),console[_0x48e9a5(0x113)](_0x48e9a5(0x186)+_0x33dd6e),!![];}catch(_0x292392){return console[_0x48e9a5(0x1a3)]('❌\x20Error\x20sending\x20direct\x20message:',_0x292392),![];}}async[a66_0x51f8a8(0x135)](_0x2ccb30,_0x298d1e,_0x453a85,_0x22a1ec){const _0x15928b=a66_0x51f8a8;try{if(!this[_0x15928b(0x179)])return console[_0x15928b(0x1a3)](_0x15928b(0x136)),![];return await this[_0x15928b(0x179)][_0x15928b(0x13e)](_0x2ccb30,_0x298d1e,{},{'filename':_0x453a85,'contentType':_0x453a85[_0x15928b(0x14b)](_0x15928b(0xfd))?_0x15928b(0x16d):_0x453a85[_0x15928b(0x14b)]('.jpg')||_0x453a85[_0x15928b(0x14b)]('.jpeg')?_0x15928b(0x12e):_0x453a85[_0x15928b(0x14b)](_0x15928b(0x175))?'application/pdf':_0x15928b(0xf8)}),_0x22a1ec&&await this[_0x15928b(0x179)][_0x15928b(0xf4)](_0x2ccb30,_0x22a1ec),console[_0x15928b(0x113)]('✅\x20File\x20sent\x20to\x20chat\x20'+_0x2ccb30+':\x20'+_0x453a85),!![];}catch(_0x32988a){return console[_0x15928b(0x1a3)]('❌\x20Error\x20sending\x20file\x20to\x20chat:',_0x32988a),![];}}[a66_0x51f8a8(0xfc)](){const _0x28c8c8=a66_0x51f8a8;this[_0x28c8c8(0x179)]&&(this[_0x28c8c8(0x179)]['stopPolling'](),this[_0x28c8c8(0x179)]=null,console[_0x28c8c8(0x113)](_0x28c8c8(0x15c)));}}exports[a66_0x51f8a8(0x134)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();