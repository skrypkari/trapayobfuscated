'use strict';function a53_0x52cd(_0x3ebca3,_0x35858f){const _0x1b90b7=a53_0x1b90();return a53_0x52cd=function(_0x52cd71,_0x4f7c2b){_0x52cd71=_0x52cd71-0x1cb;let _0x477910=_0x1b90b7[_0x52cd71];return _0x477910;},a53_0x52cd(_0x3ebca3,_0x35858f);}const a53_0x125af6=a53_0x52cd;(function(_0x3673a4,_0x101479){const _0x1b2cd1=a53_0x52cd,_0x8f3475=_0x3673a4();while(!![]){try{const _0x2b33ce=-parseInt(_0x1b2cd1(0x245))/0x1*(-parseInt(_0x1b2cd1(0x21f))/0x2)+parseInt(_0x1b2cd1(0x2b1))/0x3+parseInt(_0x1b2cd1(0x252))/0x4+parseInt(_0x1b2cd1(0x1e3))/0x5+parseInt(_0x1b2cd1(0x1ce))/0x6+parseInt(_0x1b2cd1(0x1ed))/0x7*(-parseInt(_0x1b2cd1(0x2a2))/0x8)+-parseInt(_0x1b2cd1(0x205))/0x9;if(_0x2b33ce===_0x101479)break;else _0x8f3475['push'](_0x8f3475['shift']());}catch(_0x46e062){_0x8f3475['push'](_0x8f3475['shift']());}}}(a53_0x1b90,0x36251));function a53_0x1b90(){const _0x5b3f89=['Payment\x20is\x20being\x20processed','🔌\x20User\x20','Markdown','1473140BqYnDu','createdAt','•\x20Payouts\x0a','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','setupBotHandlers','\x20USD*\x0a','split','sendPayoutNotification','•\x20Payment\x20status\x20changes\x0a','4949iGJHsW','🔔\x20*','🎉\x20*Congratulations!*\x0a\x0a','failed','endpoint','📱\x20Your\x20Telegram\x20ID:\x20`','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Example:\x0a','New\x20payout\x20created','findMany','toString','shop','__esModule','Error\x20handling\x20/start\x20command:','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','\x20parts:\x20','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','🏦\x20Method:\x20`','includes','length','*\x0a\x0a','errorMessage','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','status','5965047gDHnOv','User\x20','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','📱\x20Created\x20new\x20Telegram\x20user:\x20','Telegram\x20bot\x20error:','\x0aCheck\x20spelling\x20and\x20try\x20again.','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','📝\x20Order\x20ID:\x20`','❌\x20Error\x20getting\x20debug\x20information.','telegramUser','sendLoginNotification','notificationLogin','Use\x20/start\x20to\x20connect.','pk_','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','`.\x0a\x0a','To\x20reconnect,\x20use\x20the\x20/start\x20command','Available\x20usernames:\x0a','test','forEach','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','from','orderId','🆔\x20Request\x20ID:\x20`','blocked','...','8RGhyir','Error\x20in\x20handleSingleLineVerification:','handleSingleLineVerification','\x20\x20\x20Public\x20Key:\x20`','method','__importDefault','getBotInfo','amount','timestamp','username','TELEGRAM_BOT_TOKEN','📱\x20Telegram\x20notification:\x20gateway\x20\x22','default','warn','sendPaymentNotification','trapay_bot','sendCustomNotification','en-US','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','❌\x20Shop\x20`','telegramId','\x20(@','customerEmail','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!',':\x20`','Successful\x20login','stopBot','ipAddress','.\x20*','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','chargeback','log','stopPolling','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','🆔\x20Payout\x20ID:\x20`','✅\x20Telegram\x20bot\x20@','Error\x20sending\x20shop\x20notification:','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','97545OBChEk','chat','ACTIVE','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','toLocaleString','✅\x20Connected\x20to\x20shop:\x20*','name','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','isVerified','adminNotes','toLocaleDateString','🔔\x20You\x20receive\x20notifications\x20about:\x0a','229840xhGnxf','...\x22','onText','\x20verified\x20for\x20shop\x20','\x20\x20\x20Status:\x20','update','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','🔍\x20*Debug\x20Information*\x0a\x0a','/status\x20-\x20check\x20connection\x20status\x0a','Error\x20handling\x20/debug\x20command:','💸\x20Amount:\x20*','`\x20is\x20inactive.\x0a\x0a','📅\x20Date:\x20','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','../types/gateway','success','publicKey','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','join','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','startsWith','Failed\x20to\x20send\x20API\x20error\x20notification:','🌐\x20IP\x20address:\x20`','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','•\x20New\x20payments\x0a','Username:\x20`','customerName','last_name','findUnique','💻\x20Browser:\x20`','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','notificationApiError','initializeBot','\x22,\x20apiKey=\x22','✅\x20Telegram\x20user\x20','secretKey','📱\x20Shop:\x20*',':\x20username=\x22','sendApiErrorNotification','botToken','🏪\x20Available\x20shops\x20in\x20system:\x0a','user\x20is\x20deactivated','Telegram\x20bot\x20polling\x20error:','bot','map','allSettled','botUsername','\x20\x20\x20Username:\x20`','shopSettings','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','/disconnect\x20-\x20disconnect\x20from\x20notifications','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','chargebackAmount','\x0a👤\x20*Customer\x20Information:*\x0a','👤\x20Username:\x20`','TELEGRAM_BOT_USERNAME','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','Error\x20handling\x20message:','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Check\x20spelling\x20and\x20try\x20again.','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','`\x0a\x0a','first_name','❌\x20Error:\x20`','•\x20Payouts\x0a\x0a','currency','trim','\x20disconnected\x20from\x20shop\x20','Payment\x20expired','New\x20payment\x20created','Payout\x20rejected','\x20USDT*\x0a','Payment\x20failed','create','🔔\x20Notifications\x20are\x20active\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','You\x20sent\x20','📊\x20Error\x20code:\x20`','shopId','1816jcGpKU','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','findFirst','chat\x20not\x20found','defineProperty','sendMessage','\x20initialized\x20successfully','entries','telegramBotService','text','sendShopNotification','message','Failed\x20login\x20attempt','📛\x20Name:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','347808nclqTV','polling_error','TelegramBotService','🏪\x20Gateway:\x20`','error','1121070hdJJxm','gateway','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','node-telegram-bot-api','Failed\x20to\x20send\x20login\x20notification:','updatedAt','getGatewayDisplayNameForTelegram','env','userAgent','sk_','Commands:\x0a','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','📅\x20Connection\x20date:\x20','statusCode','Payment\x20successfully\x20paid','substring','Payment\x20chargeback'];a53_0x1b90=function(){return _0x5b3f89;};return a53_0x1b90();}var __importDefault=this&&this[a53_0x125af6(0x224)]||function(_0x275e28){return _0x275e28&&_0x275e28['__esModule']?_0x275e28:{'default':_0x275e28};};Object[a53_0x125af6(0x2a6)](exports,a53_0x125af6(0x1f9),{'value':!![]}),exports[a53_0x125af6(0x2aa)]=exports[a53_0x125af6(0x1cb)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a53_0x125af6(0x1d1))),database_1=__importDefault(require('../config/database')),gateway_1=require(a53_0x125af6(0x260));class TelegramBotService{constructor(){const _0x415a61=a53_0x125af6;this[_0x415a61(0x27e)]=null,this[_0x415a61(0x27a)]=process[_0x415a61(0x1d5)][_0x415a61(0x229)]||'',this['botUsername']=process[_0x415a61(0x1d5)][_0x415a61(0x28a)]||_0x415a61(0x22e),this[_0x415a61(0x27a)]?this[_0x415a61(0x273)]():console[_0x415a61(0x22c)](_0x415a61(0x25f));}[a53_0x125af6(0x273)](){const _0x3b4ad4=a53_0x125af6;try{this[_0x3b4ad4(0x27e)]=new node_telegram_bot_api_1[(_0x3b4ad4(0x22b))](this[_0x3b4ad4(0x27a)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x3b4ad4(0x23e)](_0x3b4ad4(0x242)+this[_0x3b4ad4(0x281)]+_0x3b4ad4(0x2a8));}catch(_0x45a6a2){console['error'](_0x3b4ad4(0x1e6),_0x45a6a2);}}[a53_0x125af6(0x1e8)](){const _0x1e10f5=a53_0x125af6;if(!this[_0x1e10f5(0x27e)])return;this[_0x1e10f5(0x27e)][_0x1e10f5(0x254)](/\/start/,async _0x3c9fd8=>{const _0x368a4e=_0x1e10f5,_0x5d93f9=_0x3c9fd8[_0x368a4e(0x246)]['id'],_0x4231b2=_0x3c9fd8[_0x368a4e(0x21a)]?.['id'][_0x368a4e(0x1f7)](),_0x5b86dd=_0x3c9fd8[_0x368a4e(0x21a)]?.[_0x368a4e(0x228)],_0x41c678=_0x3c9fd8[_0x368a4e(0x21a)]?.[_0x368a4e(0x291)],_0x52f980=_0x3c9fd8['from']?.[_0x368a4e(0x26d)];if(!_0x4231b2)return;try{let _0x1811fb=await database_1[_0x368a4e(0x22b)]['telegramUser'][_0x368a4e(0x26e)]({'where':{'telegramId':_0x4231b2},'include':{'shop':!![]}});!_0x1811fb?(_0x1811fb=await database_1[_0x368a4e(0x22b)][_0x368a4e(0x20e)][_0x368a4e(0x29c)]({'data':{'telegramId':_0x4231b2,'username':_0x5b86dd,'firstName':_0x41c678,'lastName':_0x52f980,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x368a4e(0x23e)](_0x368a4e(0x208)+_0x4231b2+_0x368a4e(0x234)+_0x5b86dd+')')):_0x1811fb=await database_1[_0x368a4e(0x22b)][_0x368a4e(0x20e)][_0x368a4e(0x257)]({'where':{'telegramId':_0x4231b2},'data':{'username':_0x5b86dd,'firstName':_0x41c678,'lastName':_0x52f980},'include':{'shop':!![]}}),_0x1811fb[_0x368a4e(0x24e)]&&_0x1811fb[_0x368a4e(0x2a1)]&&_0x1811fb['shop']?await this['bot']?.[_0x368a4e(0x2a7)](_0x5d93f9,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x368a4e(0x240)+_0x1811fb[_0x368a4e(0x1f8)][_0x368a4e(0x24b)]+'*\x0a')+(_0x368a4e(0x26b)+_0x1811fb[_0x368a4e(0x1f8)][_0x368a4e(0x228)]+_0x368a4e(0x290))+_0x368a4e(0x251)+_0x368a4e(0x26a)+'•\x20Payment\x20status\x20changes\x0a'+_0x368a4e(0x293)+_0x368a4e(0x1d8)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x368a4e(0x285),{'parse_mode':'Markdown'}):(_0x1811fb['shopId']&&!_0x1811fb[_0x368a4e(0x24e)]&&(await database_1[_0x368a4e(0x22b)][_0x368a4e(0x20e)][_0x368a4e(0x257)]({'where':{'telegramId':_0x4231b2},'data':{'shopId':null,'isVerified':![]}}),console[_0x368a4e(0x23e)](_0x368a4e(0x28f)+_0x4231b2)),await this[_0x368a4e(0x27e)]?.[_0x368a4e(0x2a7)](_0x5d93f9,_0x368a4e(0x1fb)+_0x368a4e(0x28d)+_0x368a4e(0x269)+_0x368a4e(0x1f4)+_0x368a4e(0x23c)+_0x368a4e(0x265),{'parse_mode':_0x368a4e(0x1e2)}));}catch(_0x166850){console[_0x368a4e(0x1cd)](_0x368a4e(0x1fa),_0x166850),await this[_0x368a4e(0x27e)]?.['sendMessage'](_0x5d93f9,_0x368a4e(0x1e7));}}),this['bot'][_0x1e10f5(0x254)](/\/disconnect/,async _0x231a18=>{const _0x4e742e=_0x1e10f5,_0x574f50=_0x231a18[_0x4e742e(0x246)]['id'],_0x52302e=_0x231a18[_0x4e742e(0x21a)]?.['id']['toString']();if(!_0x52302e)return;try{const _0x3e6d57=await database_1['default'][_0x4e742e(0x20e)][_0x4e742e(0x26e)]({'where':{'telegramId':_0x52302e},'include':{'shop':!![]}});if(!_0x3e6d57||!_0x3e6d57['isVerified']||!_0x3e6d57['shopId']){await this[_0x4e742e(0x27e)]?.[_0x4e742e(0x2a7)](_0x574f50,_0x4e742e(0x2b0));return;}const _0x29f067=_0x3e6d57[_0x4e742e(0x1f8)]?.[_0x4e742e(0x24b)]||'unknown\x20shop';await database_1[_0x4e742e(0x22b)][_0x4e742e(0x20e)][_0x4e742e(0x257)]({'where':{'telegramId':_0x52302e},'data':{'shopId':null,'isVerified':![]}}),console[_0x4e742e(0x23e)](_0x4e742e(0x1e1)+_0x52302e+_0x4e742e(0x296)+_0x3e6d57[_0x4e742e(0x2a1)]),await this[_0x4e742e(0x27e)]?.['sendMessage'](_0x574f50,_0x4e742e(0x231)+_0x29f067+'*.\x0a\x0a'+_0x4e742e(0x215),{'parse_mode':_0x4e742e(0x1e2)});}catch(_0xeb48d7){console[_0x4e742e(0x1cd)]('Error\x20handling\x20/disconnect\x20command:',_0xeb48d7),await this[_0x4e742e(0x27e)]?.[_0x4e742e(0x2a7)](_0x574f50,_0x4e742e(0x1e7));}}),this['bot'][_0x1e10f5(0x254)](/\/status/,async _0x1d72a0=>{const _0x4091a3=_0x1e10f5,_0x359037=_0x1d72a0[_0x4091a3(0x246)]['id'],_0x45e175=_0x1d72a0[_0x4091a3(0x21a)]?.['id'][_0x4091a3(0x1f7)]();if(!_0x45e175)return;try{const _0x3a7cc1=await database_1['default'][_0x4091a3(0x20e)][_0x4091a3(0x26e)]({'where':{'telegramId':_0x45e175},'include':{'shop':!![]}});if(!_0x3a7cc1){await this[_0x4091a3(0x27e)]?.[_0x4091a3(0x2a7)](_0x359037,_0x4091a3(0x219)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x3a7cc1[_0x4091a3(0x24e)]||!_0x3a7cc1[_0x4091a3(0x2a1)]||!_0x3a7cc1[_0x4091a3(0x1f8)]){await this[_0x4091a3(0x27e)]?.[_0x4091a3(0x2a7)](_0x359037,_0x4091a3(0x29e)+_0x4091a3(0x211));return;}await this[_0x4091a3(0x27e)]?.[_0x4091a3(0x2a7)](_0x359037,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x4091a3(0x24a)+_0x3a7cc1[_0x4091a3(0x1f8)][_0x4091a3(0x24b)]+'*\x0a')+(_0x4091a3(0x289)+_0x3a7cc1['shop'][_0x4091a3(0x228)]+'`\x0a')+(_0x4091a3(0x1db)+_0x3a7cc1[_0x4091a3(0x1d3)][_0x4091a3(0x250)](_0x4091a3(0x230))+'\x0a\x0a')+_0x4091a3(0x29d)+_0x4091a3(0x1d8)+_0x4091a3(0x285),{'parse_mode':_0x4091a3(0x1e2)});}catch(_0x324570){console[_0x4091a3(0x1cd)]('Error\x20handling\x20/status\x20command:',_0x324570),await this[_0x4091a3(0x27e)]?.[_0x4091a3(0x2a7)](_0x359037,_0x4091a3(0x1e7));}}),this[_0x1e10f5(0x27e)]['onText'](/\/debug/,async _0x399ac3=>{const _0x46508a=_0x1e10f5,_0x5850a2=_0x399ac3[_0x46508a(0x246)]['id'],_0x1716ea=_0x399ac3['from']?.['id']['toString']();if(!_0x1716ea)return;try{const _0xe96806=await database_1[_0x46508a(0x22b)]['shop'][_0x46508a(0x1f6)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x3011f4=_0x46508a(0x259);_0x3011f4+=_0x46508a(0x1f2)+_0x1716ea+_0x46508a(0x290),_0x3011f4+=_0x46508a(0x27b),_0xe96806[_0x46508a(0x218)]((_0x5ca923,_0x31ad6e)=>{const _0x18a951=_0x46508a;_0x3011f4+=_0x31ad6e+0x1+_0x18a951(0x23b)+_0x5ca923[_0x18a951(0x24b)]+'*\x0a',_0x3011f4+=_0x18a951(0x282)+_0x5ca923['username']+'`\x0a',_0x3011f4+=_0x18a951(0x256)+_0x5ca923[_0x18a951(0x204)]+'\x0a',_0x3011f4+=_0x18a951(0x222)+_0x5ca923[_0x18a951(0x262)]['substring'](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x46508a(0x27e)]?.[_0x46508a(0x2a7)](_0x5850a2,_0x3011f4,{'parse_mode':'Markdown'});}catch(_0x15a497){console[_0x46508a(0x1cd)](_0x46508a(0x25b),_0x15a497),await this[_0x46508a(0x27e)]?.[_0x46508a(0x2a7)](_0x5850a2,_0x46508a(0x20d));}}),this['bot']['on'](_0x1e10f5(0x2ad),async _0x3667b7=>{const _0x288794=_0x1e10f5;if(_0x3667b7[_0x288794(0x2ab)]?.[_0x288794(0x266)]('/'))return;const _0x28f845=_0x3667b7['chat']['id'],_0x4f20fe=_0x3667b7['from']?.['id']['toString'](),_0x550c60=_0x3667b7[_0x288794(0x2ab)]?.[_0x288794(0x295)]();if(!_0x4f20fe||!_0x550c60)return;try{const _0x51a867=await database_1[_0x288794(0x22b)][_0x288794(0x20e)][_0x288794(0x26e)]({'where':{'telegramId':_0x4f20fe},'include':{'shop':!![]}});if(!_0x51a867){await this['bot']?.['sendMessage'](_0x28f845,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x51a867[_0x288794(0x24e)]&&_0x51a867[_0x288794(0x2a1)]&&_0x51a867[_0x288794(0x1f8)]){await this[_0x288794(0x27e)]?.[_0x288794(0x2a7)](_0x28f845,_0x288794(0x1d9)+_0x51a867[_0x288794(0x1f8)][_0x288794(0x24b)]+'*.\x0a\x0a'+_0x288794(0x1da),{'parse_mode':_0x288794(0x1e2)});return;}const _0x4cea8a=_0x550c60[_0x288794(0x1ea)](/\s+/);if(_0x4cea8a['length']!==0x2){await this[_0x288794(0x27e)]?.[_0x288794(0x2a7)](_0x28f845,_0x288794(0x1f3)+_0x288794(0x269)+_0x288794(0x1f4)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x288794(0x29f)+_0x4cea8a['length']+_0x288794(0x1fc)+_0x4cea8a[_0x288794(0x27f)](_0x5010ab=>'`'+_0x5010ab+'`')[_0x288794(0x264)](',\x20')),{'parse_mode':_0x288794(0x1e2)});return;}const [_0x5b5245,_0x40a854]=_0x4cea8a;console[_0x288794(0x23e)](_0x288794(0x284)+_0x4f20fe+_0x288794(0x278)+_0x5b5245+_0x288794(0x274)+_0x40a854[_0x288794(0x1de)](0x0,0xa)+_0x288794(0x253)),await this[_0x288794(0x221)](_0x28f845,_0x4f20fe,_0x5b5245,_0x40a854);}catch(_0xc0e33c){console[_0x288794(0x1cd)](_0x288794(0x28c),_0xc0e33c),await this[_0x288794(0x27e)]?.[_0x288794(0x2a7)](_0x28f845,_0x288794(0x1e7));}}),this[_0x1e10f5(0x27e)]['on'](_0x1e10f5(0x1cd),_0x4cc915=>{const _0x48f0e1=_0x1e10f5;console[_0x48f0e1(0x1cd)](_0x48f0e1(0x209),_0x4cc915);}),this[_0x1e10f5(0x27e)]['on'](_0x1e10f5(0x2b2),_0x8631fd=>{const _0x20a707=_0x1e10f5;console['error'](_0x20a707(0x27d),_0x8631fd);});}async[a53_0x125af6(0x221)](_0x1423f4,_0x585943,_0x1ce9f6,_0x159e2e){const _0x5122b9=a53_0x125af6;try{console[_0x5122b9(0x23e)](_0x5122b9(0x284)+_0x585943+_0x5122b9(0x278)+_0x1ce9f6+_0x5122b9(0x274)+_0x159e2e[_0x5122b9(0x1de)](0x0,0xa)+_0x5122b9(0x253));if(!_0x1ce9f6||_0x1ce9f6['length']<0x3||_0x1ce9f6[_0x5122b9(0x200)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x5122b9(0x217)](_0x1ce9f6)){await this['bot']?.[_0x5122b9(0x2a7)](_0x1423f4,'❌\x20Invalid\x20username\x20format:\x20`'+_0x1ce9f6+_0x5122b9(0x290)+_0x5122b9(0x213),{'parse_mode':_0x5122b9(0x1e2)});return;}if(!_0x159e2e||!_0x159e2e['startsWith'](_0x5122b9(0x212))&&!_0x159e2e[_0x5122b9(0x266)](_0x5122b9(0x1d7))){await this[_0x5122b9(0x27e)]?.['sendMessage'](_0x1423f4,_0x5122b9(0x1d0)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x5122b9(0x1e2)});return;}const _0x3c5b4c=await database_1[_0x5122b9(0x22b)][_0x5122b9(0x1f8)][_0x5122b9(0x26e)]({'where':{'username':_0x1ce9f6},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x3c5b4c){const _0x5940f7=await database_1[_0x5122b9(0x22b)]['shop'][_0x5122b9(0x1f6)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x141529='❌\x20Shop\x20with\x20username\x20`'+_0x1ce9f6+'`\x20not\x20found.\x0a\x0a';_0x5940f7[_0x5122b9(0x200)]>0x0?(_0x141529+=_0x5122b9(0x216),_0x5940f7['forEach'](_0x213e23=>{const _0x482858=_0x5122b9;_0x141529+='•\x20`'+_0x213e23['username']+'`\x20('+_0x213e23[_0x482858(0x24b)]+')\x0a';}),_0x141529+=_0x5122b9(0x20a)):_0x141529+=_0x5122b9(0x28e);await this[_0x5122b9(0x27e)]?.[_0x5122b9(0x2a7)](_0x1423f4,_0x141529,{'parse_mode':_0x5122b9(0x1e2)});return;}if(_0x3c5b4c[_0x5122b9(0x204)]!==_0x5122b9(0x247)){await this[_0x5122b9(0x27e)]?.[_0x5122b9(0x2a7)](_0x1423f4,_0x5122b9(0x232)+_0x1ce9f6+_0x5122b9(0x25d)+'Contact\x20administrator.',{'parse_mode':_0x5122b9(0x1e2)});return;}if(_0x3c5b4c['publicKey']!==_0x159e2e&&_0x3c5b4c[_0x5122b9(0x276)]!==_0x159e2e){await this[_0x5122b9(0x27e)]?.[_0x5122b9(0x2a7)](_0x1423f4,_0x5122b9(0x28b)+_0x1ce9f6+_0x5122b9(0x214)+_0x5122b9(0x286)+_0x5122b9(0x263),{'parse_mode':'Markdown'});return;}const _0x58f7b5=await database_1[_0x5122b9(0x22b)][_0x5122b9(0x20e)][_0x5122b9(0x2a4)]({'where':{'shopId':_0x3c5b4c['id'],'isVerified':!![],'telegramId':{'not':_0x585943}}});if(_0x58f7b5){await this[_0x5122b9(0x27e)]?.['sendMessage'](_0x1423f4,_0x5122b9(0x271)+_0x1ce9f6+_0x5122b9(0x214)+_0x5122b9(0x24d),{'parse_mode':_0x5122b9(0x1e2)});return;}await database_1[_0x5122b9(0x22b)][_0x5122b9(0x20e)][_0x5122b9(0x257)]({'where':{'telegramId':_0x585943},'data':{'shopId':_0x3c5b4c['id'],'isVerified':!![]}}),await this[_0x5122b9(0x27e)]?.[_0x5122b9(0x2a7)](_0x1423f4,_0x5122b9(0x1ef)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x5122b9(0x277)+_0x3c5b4c[_0x5122b9(0x24b)]+'*\x0a')+(_0x5122b9(0x289)+_0x3c5b4c['username']+_0x5122b9(0x290))+_0x5122b9(0x203)+_0x5122b9(0x26a)+_0x5122b9(0x1ec)+_0x5122b9(0x1e5)+'•\x20Important\x20events\x0a\x0a'+'Commands:\x0a'+_0x5122b9(0x25a)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x5122b9(0x1e2)}),console[_0x5122b9(0x23e)](_0x5122b9(0x275)+_0x585943+_0x5122b9(0x255)+_0x3c5b4c[_0x5122b9(0x228)]+'\x20via\x20single-line\x20input');}catch(_0x1c4e02){console[_0x5122b9(0x1cd)](_0x5122b9(0x220),_0x1c4e02),await this['bot']?.['sendMessage'](_0x1423f4,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a53_0x125af6(0x2ac)](_0x19feab,_0x128111,_0x43bfb3){const _0x440901=a53_0x125af6;if(!this['bot']){console[_0x440901(0x22c)](_0x440901(0x270));return;}try{const _0x497147=await database_1[_0x440901(0x22b)]['telegramUser'][_0x440901(0x1f6)]({'where':{'shopId':_0x19feab,'isVerified':!![]}});if(_0x497147[_0x440901(0x200)]===0x0){console[_0x440901(0x23e)](_0x440901(0x248)+_0x19feab);return;}const _0x1c0d88=_0x497147[_0x440901(0x27f)](async _0x3af2af=>{const _0x61cf19=_0x440901;try{await this[_0x61cf19(0x27e)]?.[_0x61cf19(0x2a7)](_0x3af2af[_0x61cf19(0x233)],_0x128111,_0x43bfb3),console[_0x61cf19(0x23e)](_0x61cf19(0x20b)+_0x3af2af[_0x61cf19(0x233)]);}catch(_0x246d79){console[_0x61cf19(0x1cd)](_0x61cf19(0x2a3)+_0x3af2af[_0x61cf19(0x233)]+':',_0x246d79),_0x246d79 instanceof Error&&(_0x246d79[_0x61cf19(0x2ad)][_0x61cf19(0x1ff)](_0x61cf19(0x21d))||_0x246d79['message'][_0x61cf19(0x1ff)](_0x61cf19(0x2a5))||_0x246d79[_0x61cf19(0x2ad)][_0x61cf19(0x1ff)](_0x61cf19(0x27c)))&&(await database_1[_0x61cf19(0x22b)]['telegramUser'][_0x61cf19(0x257)]({'where':{'id':_0x3af2af['id']},'data':{'isVerified':![]}}),console[_0x61cf19(0x23e)](_0x61cf19(0x206)+_0x3af2af[_0x61cf19(0x233)]+_0x61cf19(0x1fd)));}});await Promise[_0x440901(0x280)](_0x1c0d88);}catch(_0x55602a){console['error'](_0x440901(0x243),_0x55602a);}}async[a53_0x125af6(0x22d)](_0x6b802e,_0x1464f9,_0x131e7a){const _0x12b7da=a53_0x125af6,_0xf946e2={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0xe6df0d={'created':_0x12b7da(0x298),'paid':_0x12b7da(0x1dd),'failed':_0x12b7da(0x29b),'expired':_0x12b7da(0x297),'refund':'Payment\x20refund','chargeback':_0x12b7da(0x1df),'processing':_0x12b7da(0x1e0)},_0x3eae9b=_0xf946e2[_0x131e7a],_0xdadc6c=_0xe6df0d[_0x131e7a],_0x31047a=(0x0,gateway_1[_0x12b7da(0x1d4)])(_0x1464f9[_0x12b7da(0x1cf)]);console['log'](_0x12b7da(0x22a)+_0x1464f9[_0x12b7da(0x1cf)]+'\x22\x20->\x20display\x20\x22'+_0x31047a+'\x22');let _0x54864f=_0x3eae9b+'\x20*'+_0xdadc6c+_0x12b7da(0x201)+('💰\x20Amount:\x20*'+_0x1464f9[_0x12b7da(0x226)]+'\x20'+_0x1464f9[_0x12b7da(0x294)]+'*\x0a')+(_0x12b7da(0x20c)+(_0x1464f9[_0x12b7da(0x21b)]||_0x1464f9['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x1464f9['id']+'`\x0a')+(_0x12b7da(0x1cc)+_0x31047a+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x1464f9['createdAt'])[_0x12b7da(0x249)](_0x12b7da(0x230))+'\x0a');(_0x1464f9['customerName']||_0x1464f9[_0x12b7da(0x235)])&&(_0x54864f+=_0x12b7da(0x288),_0x1464f9[_0x12b7da(0x26c)]&&(_0x54864f+=_0x12b7da(0x2af)+_0x1464f9[_0x12b7da(0x26c)]+'`\x0a'),_0x1464f9[_0x12b7da(0x235)]&&(_0x54864f+='📧\x20Email:\x20`'+_0x1464f9[_0x12b7da(0x235)]+'`\x0a')),_0x131e7a===_0x12b7da(0x23d)&&_0x1464f9[_0x12b7da(0x287)]&&(_0x54864f+='💸\x20Penalty\x20amount:\x20*'+_0x1464f9['chargebackAmount']+_0x12b7da(0x29a)),_0x131e7a==='processing'&&(_0x54864f+=_0x12b7da(0x24c)),_0x1464f9['adminNotes']&&(_0x54864f+='📝\x20Notes:\x20'+_0x1464f9[_0x12b7da(0x24f)]+'\x0a'),await this['sendShopNotification'](_0x6b802e,_0x54864f,{'parse_mode':'Markdown'});}async[a53_0x125af6(0x1eb)](_0x4ba913,_0xa13da1,_0x3479e6){const _0x3bb810=a53_0x125af6,_0x196b7b={'created':'📤','completed':'✅','rejected':'❌'},_0x247fbb={'created':_0x3bb810(0x1f5),'completed':'Payout\x20completed','rejected':_0x3bb810(0x299)},_0x3ea67d=_0x196b7b[_0x3479e6],_0x43be4d=_0x247fbb[_0x3479e6],_0xf61f96=_0x3ea67d+'\x20*'+_0x43be4d+_0x3bb810(0x201)+(_0x3bb810(0x25c)+_0xa13da1['amount']+_0x3bb810(0x1e9))+(_0x3bb810(0x1fe)+_0xa13da1[_0x3bb810(0x223)]+'`\x0a')+(_0x3bb810(0x241)+_0xa13da1['id']+'`\x0a')+(_0x3bb810(0x25e)+new Date(_0xa13da1[_0x3bb810(0x1e4)])[_0x3bb810(0x249)](_0x3bb810(0x230))+'\x0a')+(_0xa13da1['txid']?'🔗\x20TXID:\x20`'+_0xa13da1['txid']+'`':'');await this['sendShopNotification'](_0x4ba913,_0xf61f96,{'parse_mode':_0x3bb810(0x1e2)});}async[a53_0x125af6(0x20f)](_0x33e071,_0x247eb6){const _0x4af933=a53_0x125af6;try{const _0x383b3d=await database_1['default'][_0x4af933(0x283)][_0x4af933(0x26e)]({'where':{'shopId':_0x33e071},'select':{'notificationLogin':!![]}});if(!_0x383b3d?.[_0x4af933(0x210)]){console['log']('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x33e071);return;}const _0x213790=_0x247eb6[_0x4af933(0x261)]?'🔐':'🚨',_0x36440c=_0x247eb6['success']?_0x4af933(0x238):_0x4af933(0x2ae);let _0x3208f6=_0x213790+'\x20*'+_0x36440c+'*\x0a\x0a'+(_0x4af933(0x289)+_0x247eb6['username']+'`\x0a')+('📅\x20Time:\x20'+_0x247eb6['timestamp'][_0x4af933(0x249)]('en-US')+'\x0a');_0x247eb6[_0x4af933(0x23a)]&&(_0x3208f6+=_0x4af933(0x268)+_0x247eb6['ipAddress']+'`\x0a');if(_0x247eb6[_0x4af933(0x1d6)]){const _0x283fd9=_0x247eb6[_0x4af933(0x1d6)]['length']>0x32?_0x247eb6[_0x4af933(0x1d6)][_0x4af933(0x1de)](0x0,0x32)+_0x4af933(0x21e):_0x247eb6[_0x4af933(0x1d6)];_0x3208f6+=_0x4af933(0x26f)+_0x283fd9+'`\x0a';}!_0x247eb6[_0x4af933(0x261)]&&(_0x3208f6+=_0x4af933(0x236)),await this['sendShopNotification'](_0x33e071,_0x3208f6,{'parse_mode':_0x4af933(0x1e2)}),console[_0x4af933(0x23e)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x33e071+':\x20'+(_0x247eb6[_0x4af933(0x261)]?_0x4af933(0x261):_0x4af933(0x1f0)));}catch(_0x4407c2){console['error'](_0x4af933(0x1d2),_0x4407c2);}}async[a53_0x125af6(0x279)](_0x7534c4,_0x57a325){const _0x106838=a53_0x125af6;try{const _0x3abc92=await database_1[_0x106838(0x22b)][_0x106838(0x283)][_0x106838(0x26e)]({'where':{'shopId':_0x7534c4},'select':{'notificationApiError':!![]}});if(!_0x3abc92?.[_0x106838(0x272)]){console[_0x106838(0x23e)](_0x106838(0x258)+_0x7534c4);return;}let _0x172c8a='🚨\x20*API\x20Error*\x0a\x0a'+('🔗\x20Endpoint:\x20`'+_0x57a325['method']+'\x20'+_0x57a325[_0x106838(0x1f1)]+'`\x0a')+('📅\x20Time:\x20'+_0x57a325[_0x106838(0x227)][_0x106838(0x249)](_0x106838(0x230))+'\x0a');_0x57a325[_0x106838(0x1dc)]&&(_0x172c8a+=_0x106838(0x2a0)+_0x57a325[_0x106838(0x1dc)]+'`\x0a'),_0x172c8a+=_0x106838(0x292)+_0x57a325[_0x106838(0x202)]+'`\x0a',_0x57a325['requestId']&&(_0x172c8a+=_0x106838(0x21c)+_0x57a325['requestId']+'`\x0a'),_0x172c8a+=_0x106838(0x244),await this[_0x106838(0x2ac)](_0x7534c4,_0x172c8a,{'parse_mode':_0x106838(0x1e2)}),console['log'](_0x106838(0x207)+_0x7534c4+':\x20'+_0x57a325[_0x106838(0x1f1)]);}catch(_0x38c01d){console[_0x106838(0x1cd)](_0x106838(0x267),_0x38c01d);}}async[a53_0x125af6(0x22f)](_0x40ad10,_0x5a3473,_0x4272e5){const _0x2fe8f1=a53_0x125af6;let _0x406a41=_0x2fe8f1(0x1ee)+_0x5a3473+'*\x0a\x0a';for(const [_0x57e46a,_0x1388aa]of Object[_0x2fe8f1(0x2a9)](_0x4272e5)){_0x1388aa!==null&&_0x1388aa!==undefined&&(_0x406a41+=_0x57e46a+_0x2fe8f1(0x237)+_0x1388aa+'`\x0a');}await this[_0x2fe8f1(0x2ac)](_0x40ad10,_0x406a41,{'parse_mode':_0x2fe8f1(0x1e2)});}[a53_0x125af6(0x225)](){const _0x5074d6=a53_0x125af6;return{'isActive':!!this['bot'],'username':this[_0x5074d6(0x281)]};}[a53_0x125af6(0x239)](){const _0x29a705=a53_0x125af6;this[_0x29a705(0x27e)]&&(this[_0x29a705(0x27e)][_0x29a705(0x23f)](),this[_0x29a705(0x27e)]=null,console[_0x29a705(0x23e)]('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a53_0x125af6(0x1cb)]=TelegramBotService,exports[a53_0x125af6(0x2aa)]=new TelegramBotService();