'use strict';const a57_0x486e57=a57_0x200a;(function(_0x7aad73,_0x595364){const _0x42cd88=a57_0x200a,_0x134079=_0x7aad73();while(!![]){try{const _0x2e35a1=-parseInt(_0x42cd88(0x23f))/0x1+parseInt(_0x42cd88(0x241))/0x2*(-parseInt(_0x42cd88(0x233))/0x3)+-parseInt(_0x42cd88(0x243))/0x4+-parseInt(_0x42cd88(0x1f9))/0x5*(-parseInt(_0x42cd88(0x1c0))/0x6)+-parseInt(_0x42cd88(0x213))/0x7+-parseInt(_0x42cd88(0x205))/0x8+parseInt(_0x42cd88(0x204))/0x9*(parseInt(_0x42cd88(0x1ea))/0xa);if(_0x2e35a1===_0x595364)break;else _0x134079['push'](_0x134079['shift']());}catch(_0x3b2c54){_0x134079['push'](_0x134079['shift']());}}}(a57_0x59ed,0xf421f));function a57_0x59ed(){const _0x534a1c=['Error\x20handling\x20/status\x20command:','\x20disconnected\x20from\x20shop\x20','Error\x20handling\x20/start\x20command:','customerIp','env','test','`\x20not\x20found.\x0a\x0a','✅\x20Connected\x20to\x20shop:\x20*','username','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','Use\x20/start\x20to\x20begin.','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','📝\x20Notes:\x20','customerName','errorMessage','last_name','\x20verified\x20for\x20shop\x20','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','text','pk_','Error\x20in\x20handleSingleLineVerification:','substring','ACTIVE','toLocaleString','chat','•\x20Payment\x20status\x20changes\x0a','chargebackAmount','entries','Payout\x20completed','notificationLogin','length','Failed\x20login\x20attempt','•\x20Payouts\x0a\x0a','processing','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','endpoint','log','*.\x0a\x0a','6EJvJnB','adminNotes','🏪\x20Available\x20shops\x20in\x20system:\x0a','customerEmail','join','💸\x20Penalty\x20amount:\x20*','stopPolling','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20',':\x20username=\x22','🆔\x20Payout\x20ID:\x20`','\x20initialized\x20successfully','🔍\x20*Debug\x20Information*\x0a\x0a','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','statusCode','Payment\x20chargeback','publicKey','findUnique','Telegram\x20bot\x20polling\x20error:','•\x20New\x20payments\x0a','createdAt','userAgent','toLocaleDateString','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','polling_error','warn','txid','requestId','❌\x20Shop\x20with\x20username\x20`','map','🎉\x20*Congratulations!*\x0a\x0a','failed','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','\x22,\x20apiKey=\x22','Payment\x20refund','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','📱\x20Shop:\x20*','node-telegram-bot-api','TelegramBotService','sendLoginNotification','/disconnect\x20-\x20disconnect\x20from\x20notifications','.\x20*','14260IQgstj','amount','🌐\x20IP:\x20`','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Contact\x20administrator.','Error\x20handling\x20message:','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','*\x0a\x0a','findMany','🏪\x20Gateway:\x20`','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','getGatewayDisplayNameForTelegram','telegramBotService','📅\x20Date:\x20','Failed\x20to\x20send\x20API\x20error\x20notification:','5346210cJqZgW','chargeback','❌\x20Invalid\x20username\x20format:\x20`','gateway','name','🆔\x20Request\x20ID:\x20`','`\x20(','from','🌐\x20IP\x20address:\x20`','onText','Example:\x0a','22500WSUAHa','9563776bTXVRw','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','📝\x20Order\x20ID:\x20`','✅\x20Welcome\x20back!\x0a\x0a','Telegram\x20bot\x20error:','botToken','User\x20','New\x20payment\x20created','💰\x20Amount:\x20*','🏦\x20Method:\x20`','📱\x20Your\x20Telegram\x20ID:\x20`','🔗\x20TXID:\x20`','`.\x0a\x0a','Payment\x20failed','8785434fgzIVP','sendMessage','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','sendShopNotification','Payment\x20is\x20being\x20processed','setupBotHandlers','💸\x20Amount:\x20*','•\x20Payouts\x0a','sendApiErrorNotification','status','update','includes','`\x20is\x20inactive.\x0a\x0a','\x20USDT*\x0a','message','\x22\x20->\x20display\x20\x22','toString','...\x22','Markdown','chat\x20not\x20found','📅\x20Time:\x20','`\x0a\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','🔔\x20You\x20receive\x20notifications\x20about:\x0a','stopBot','...','telegramUser','❌\x20Error:\x20`','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','success',':\x20`','❌\x20Please\x20use\x20/start\x20command\x20first','6693OPuQoq','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','default','initializeBot','defineProperty','telegramId','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','\x20\x20\x20Username:\x20`','customerUa','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','❌\x20Shop\x20`','Payout\x20rejected','425340uYrSEF','trim','26yVNAXz','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','2917592gExufg','🔔\x20Notifications\x20are\x20active\x0a\x0a','../config/database','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','allSettled','👤\x20Username:\x20`','🔌\x20User\x20','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','orderId','startsWith','📊\x20*Connection\x20Status*\x0a\x0a','💻\x20Browser:\x20`','getBotInfo','🆔\x20Payment\x20ID:\x20`','forEach','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','remitterIban','findFirst','TELEGRAM_BOT_TOKEN','handleSingleLineVerification','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','Available\x20usernames:\x0a','/status\x20-\x20check\x20connection\x20status\x0a','New\x20payout\x20created','✅\x20Telegram\x20user\x20','ipAddress','\x0aCheck\x20spelling\x20and\x20try\x20again.','secretKey','📱\x20Created\x20new\x20Telegram\x20user:\x20','Error\x20handling\x20/debug\x20command:','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','shop','🏦\x20IBAN:\x20`','user\x20is\x20deactivated','📧\x20Email:\x20`','isVerified','botUsername','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','currency','error','en-US','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','sendPaymentNotification','•\x20`','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','../types/gateway','\x20USD*\x0a','\x20parts:\x20','📛\x20Name:\x20`','__esModule','shopId','❌\x20Error\x20getting\x20debug\x20information.','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','bot','\x20\x20\x20Public\x20Key:\x20`','📅\x20Connection\x20date:\x20','Commands:\x0a','sk_','shopSettings','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','timestamp'];a57_0x59ed=function(){return _0x534a1c;};return a57_0x59ed();}var __importDefault=this&&this['__importDefault']||function(_0x58b13a){return _0x58b13a&&_0x58b13a['__esModule']?_0x58b13a:{'default':_0x58b13a};};Object[a57_0x486e57(0x237)](exports,a57_0x486e57(0x277),{'value':!![]}),exports[a57_0x486e57(0x1f6)]=exports[a57_0x486e57(0x1e6)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a57_0x486e57(0x1e5))),database_1=__importDefault(require(a57_0x486e57(0x245))),gateway_1=require(a57_0x486e57(0x273));class TelegramBotService{constructor(){const _0x5ebe57=a57_0x486e57;this['bot']=null,this['botToken']=process[_0x5ebe57(0x287)][_0x5ebe57(0x256)]||'',this[_0x5ebe57(0x269)]=process[_0x5ebe57(0x287)]['TELEGRAM_BOT_USERNAME']||'trapay_bot',this[_0x5ebe57(0x20a)]?this[_0x5ebe57(0x236)]():console[_0x5ebe57(0x1d9)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}['initializeBot'](){const _0x4c90d4=a57_0x486e57;try{this[_0x4c90d4(0x27b)]=new node_telegram_bot_api_1[(_0x4c90d4(0x235))](this[_0x4c90d4(0x20a)],{'polling':!![]}),this['setupBotHandlers'](),console['log']('✅\x20Telegram\x20bot\x20@'+this[_0x4c90d4(0x269)]+_0x4c90d4(0x1cb));}catch(_0xb98c44){console[_0x4c90d4(0x26d)](_0x4c90d4(0x22f),_0xb98c44);}}[a57_0x486e57(0x218)](){const _0x30c480=a57_0x486e57;if(!this['bot'])return;this['bot'][_0x30c480(0x202)](/\/start/,async _0x4819c1=>{const _0x1db578=_0x30c480,_0x427968=_0x4819c1[_0x1db578(0x1b2)]['id'],_0x5521d7=_0x4819c1[_0x1db578(0x200)]?.['id']['toString'](),_0x525434=_0x4819c1[_0x1db578(0x200)]?.[_0x1db578(0x28b)],_0xa585c4=_0x4819c1[_0x1db578(0x200)]?.['first_name'],_0x1ccc16=_0x4819c1[_0x1db578(0x200)]?.[_0x1db578(0x1a9)];if(!_0x5521d7)return;try{let _0x317f9a=await database_1[_0x1db578(0x235)][_0x1db578(0x22d)]['findUnique']({'where':{'telegramId':_0x5521d7},'include':{'shop':!![]}});!_0x317f9a?(_0x317f9a=await database_1[_0x1db578(0x235)][_0x1db578(0x22d)]['create']({'data':{'telegramId':_0x5521d7,'username':_0x525434,'firstName':_0xa585c4,'lastName':_0x1ccc16,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x1db578(0x1be)](_0x1db578(0x261)+_0x5521d7+'\x20(@'+_0x525434+')')):_0x317f9a=await database_1[_0x1db578(0x235)][_0x1db578(0x22d)][_0x1db578(0x21d)]({'where':{'telegramId':_0x5521d7},'data':{'username':_0x525434,'firstName':_0xa585c4,'lastName':_0x1ccc16},'include':{'shop':!![]}}),_0x317f9a[_0x1db578(0x268)]&&_0x317f9a[_0x1db578(0x278)]&&_0x317f9a[_0x1db578(0x264)]?await this[_0x1db578(0x27b)]?.['sendMessage'](_0x427968,_0x1db578(0x208)+(_0x1db578(0x1d7)+_0x317f9a[_0x1db578(0x264)][_0x1db578(0x1fd)]+'*\x0a')+('Username:\x20`'+_0x317f9a['shop'][_0x1db578(0x28b)]+'`\x0a\x0a')+_0x1db578(0x22a)+_0x1db578(0x1d3)+_0x1db578(0x1b3)+_0x1db578(0x1ba)+'Commands:\x0a'+_0x1db578(0x25b)+_0x1db578(0x1e8),{'parse_mode':_0x1db578(0x225)}):(_0x317f9a['shopId']&&!_0x317f9a['isVerified']&&(await database_1['default']['telegramUser'][_0x1db578(0x21d)]({'where':{'telegramId':_0x5521d7},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x1db578(0x239)+_0x5521d7)),await this['bot']?.[_0x1db578(0x214)](_0x427968,_0x1db578(0x258)+_0x1db578(0x246)+_0x1db578(0x1f4)+_0x1db578(0x203)+_0x1db578(0x229)+_0x1db578(0x1e3),{'parse_mode':_0x1db578(0x225)}));}catch(_0x5ddb11){console[_0x1db578(0x26d)](_0x1db578(0x285),_0x5ddb11),await this[_0x1db578(0x27b)]?.[_0x1db578(0x214)](_0x427968,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x30c480(0x27b)][_0x30c480(0x202)](/\/disconnect/,async _0x2cccd1=>{const _0x201ad3=_0x30c480,_0x322b1b=_0x2cccd1['chat']['id'],_0x2a2dbb=_0x2cccd1[_0x201ad3(0x200)]?.['id'][_0x201ad3(0x223)]();if(!_0x2a2dbb)return;try{const _0x33c129=await database_1[_0x201ad3(0x235)][_0x201ad3(0x22d)][_0x201ad3(0x1d1)]({'where':{'telegramId':_0x2a2dbb},'include':{'shop':!![]}});if(!_0x33c129||!_0x33c129[_0x201ad3(0x268)]||!_0x33c129[_0x201ad3(0x278)]){await this[_0x201ad3(0x27b)]?.['sendMessage'](_0x322b1b,_0x201ad3(0x247));return;}const _0x33a4fe=_0x33c129[_0x201ad3(0x264)]?.[_0x201ad3(0x1fd)]||'unknown\x20shop';await database_1['default'][_0x201ad3(0x22d)]['update']({'where':{'telegramId':_0x2a2dbb},'data':{'shopId':null,'isVerified':![]}}),console[_0x201ad3(0x1be)](_0x201ad3(0x24a)+_0x2a2dbb+_0x201ad3(0x284)+_0x33c129[_0x201ad3(0x278)]),await this[_0x201ad3(0x27b)]?.[_0x201ad3(0x214)](_0x322b1b,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x33a4fe+'*.\x0a\x0a'+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x201ad3(0x225)});}catch(_0x7cb315){console['error']('Error\x20handling\x20/disconnect\x20command:',_0x7cb315),await this[_0x201ad3(0x27b)]?.[_0x201ad3(0x214)](_0x322b1b,_0x201ad3(0x28c));}}),this[_0x30c480(0x27b)][_0x30c480(0x202)](/\/status/,async _0x2acad9=>{const _0x5672be=_0x30c480,_0x3bb05f=_0x2acad9[_0x5672be(0x1b2)]['id'],_0x51c6ec=_0x2acad9[_0x5672be(0x200)]?.['id'][_0x5672be(0x223)]();if(!_0x51c6ec)return;try{const _0x2bdaac=await database_1[_0x5672be(0x235)][_0x5672be(0x22d)][_0x5672be(0x1d1)]({'where':{'telegramId':_0x51c6ec},'include':{'shop':!![]}});if(!_0x2bdaac){await this['bot']?.[_0x5672be(0x214)](_0x3bb05f,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x5672be(0x28d));return;}if(!_0x2bdaac[_0x5672be(0x268)]||!_0x2bdaac[_0x5672be(0x278)]||!_0x2bdaac['shop']){await this[_0x5672be(0x27b)]?.[_0x5672be(0x214)](_0x3bb05f,_0x5672be(0x1c7)+'Use\x20/start\x20to\x20connect.');return;}await this['bot']?.[_0x5672be(0x214)](_0x3bb05f,_0x5672be(0x24e)+(_0x5672be(0x28a)+_0x2bdaac[_0x5672be(0x264)][_0x5672be(0x1fd)]+'*\x0a')+(_0x5672be(0x249)+_0x2bdaac[_0x5672be(0x264)][_0x5672be(0x28b)]+'`\x0a')+(_0x5672be(0x27d)+_0x2bdaac['updatedAt'][_0x5672be(0x1d6)]('en-US')+'\x0a\x0a')+_0x5672be(0x244)+_0x5672be(0x27e)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'});}catch(_0x4dd9f2){console[_0x5672be(0x26d)](_0x5672be(0x283),_0x4dd9f2),await this[_0x5672be(0x27b)]?.[_0x5672be(0x214)](_0x3bb05f,_0x5672be(0x28c));}}),this[_0x30c480(0x27b)][_0x30c480(0x202)](/\/debug/,async _0xca1fcd=>{const _0xd9f20=_0x30c480,_0x29fefe=_0xca1fcd[_0xd9f20(0x1b2)]['id'],_0x15fbfb=_0xca1fcd[_0xd9f20(0x200)]?.['id']['toString']();if(!_0x15fbfb)return;try{const _0x24961a=await database_1['default'][_0xd9f20(0x264)][_0xd9f20(0x1f2)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x992e1=_0xd9f20(0x1cc);_0x992e1+=_0xd9f20(0x20f)+_0x15fbfb+_0xd9f20(0x228),_0x992e1+=_0xd9f20(0x1c2),_0x24961a[_0xd9f20(0x252)]((_0x12bbc2,_0x2e5bd0)=>{const _0x11762f=_0xd9f20;_0x992e1+=_0x2e5bd0+0x1+_0x11762f(0x1e9)+_0x12bbc2['name']+'*\x0a',_0x992e1+=_0x11762f(0x23a)+_0x12bbc2[_0x11762f(0x28b)]+'`\x0a',_0x992e1+='\x20\x20\x20Status:\x20'+_0x12bbc2[_0x11762f(0x21c)]+'\x0a',_0x992e1+=_0x11762f(0x27c)+_0x12bbc2[_0x11762f(0x1d0)][_0x11762f(0x1af)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0xd9f20(0x27b)]?.[_0xd9f20(0x214)](_0x29fefe,_0x992e1,{'parse_mode':_0xd9f20(0x225)});}catch(_0x4ff794){console[_0xd9f20(0x26d)](_0xd9f20(0x262),_0x4ff794),await this['bot']?.[_0xd9f20(0x214)](_0x29fefe,_0xd9f20(0x279));}}),this['bot']['on'](_0x30c480(0x221),async _0x490314=>{const _0x8b04d7=_0x30c480;if(_0x490314[_0x8b04d7(0x1ac)]?.[_0x8b04d7(0x24d)]('/'))return;const _0x39195a=_0x490314[_0x8b04d7(0x1b2)]['id'],_0x4fc4ea=_0x490314[_0x8b04d7(0x200)]?.['id'][_0x8b04d7(0x223)](),_0xe719b3=_0x490314[_0x8b04d7(0x1ac)]?.[_0x8b04d7(0x240)]();if(!_0x4fc4ea||!_0xe719b3)return;try{const _0x246f12=await database_1['default']['telegramUser'][_0x8b04d7(0x1d1)]({'where':{'telegramId':_0x4fc4ea},'include':{'shop':!![]}});if(!_0x246f12){await this[_0x8b04d7(0x27b)]?.[_0x8b04d7(0x214)](_0x39195a,_0x8b04d7(0x232));return;}if(_0x246f12[_0x8b04d7(0x268)]&&_0x246f12[_0x8b04d7(0x278)]&&_0x246f12[_0x8b04d7(0x264)]){await this['bot']?.[_0x8b04d7(0x214)](_0x39195a,_0x8b04d7(0x1ed)+_0x246f12[_0x8b04d7(0x264)][_0x8b04d7(0x1fd)]+_0x8b04d7(0x1bf)+_0x8b04d7(0x28e),{'parse_mode':_0x8b04d7(0x225)});return;}const _0x475777=_0xe719b3['split'](/\s+/);if(_0x475777['length']!==0x2){await this['bot']?.['sendMessage'](_0x39195a,_0x8b04d7(0x26b)+_0x8b04d7(0x1f4)+_0x8b04d7(0x203)+_0x8b04d7(0x229)+('You\x20sent\x20'+_0x475777[_0x8b04d7(0x1b8)]+_0x8b04d7(0x275)+_0x475777['map'](_0x4bc6ed=>'`'+_0x4bc6ed+'`')[_0x8b04d7(0x1c4)](',\x20')),{'parse_mode':_0x8b04d7(0x225)});return;}const [_0x5cc529,_0x2b439a]=_0x475777;console['log'](_0x8b04d7(0x242)+_0x4fc4ea+_0x8b04d7(0x1c9)+_0x5cc529+_0x8b04d7(0x1e1)+_0x2b439a[_0x8b04d7(0x1af)](0x0,0xa)+_0x8b04d7(0x224)),await this[_0x8b04d7(0x257)](_0x39195a,_0x4fc4ea,_0x5cc529,_0x2b439a);}catch(_0x55cc1e){console[_0x8b04d7(0x26d)](_0x8b04d7(0x1ef),_0x55cc1e),await this[_0x8b04d7(0x27b)]?.[_0x8b04d7(0x214)](_0x39195a,_0x8b04d7(0x28c));}}),this[_0x30c480(0x27b)]['on'](_0x30c480(0x26d),_0x526e95=>{const _0x4e5f93=_0x30c480;console[_0x4e5f93(0x26d)](_0x4e5f93(0x209),_0x526e95);}),this[_0x30c480(0x27b)]['on'](_0x30c480(0x1d8),_0x4c7d52=>{const _0xeb2d1b=_0x30c480;console[_0xeb2d1b(0x26d)](_0xeb2d1b(0x1d2),_0x4c7d52);});}async[a57_0x486e57(0x257)](_0x22bc46,_0x1ccf93,_0x1fc86b,_0x31cdca){const _0x534cfb=a57_0x486e57;try{console[_0x534cfb(0x1be)](_0x534cfb(0x242)+_0x1ccf93+_0x534cfb(0x1c9)+_0x1fc86b+_0x534cfb(0x1e1)+_0x31cdca[_0x534cfb(0x1af)](0x0,0xa)+'...\x22');if(!_0x1fc86b||_0x1fc86b[_0x534cfb(0x1b8)]<0x3||_0x1fc86b[_0x534cfb(0x1b8)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x534cfb(0x288)](_0x1fc86b)){await this[_0x534cfb(0x27b)]?.[_0x534cfb(0x214)](_0x22bc46,_0x534cfb(0x1fb)+_0x1fc86b+_0x534cfb(0x228)+_0x534cfb(0x1f0),{'parse_mode':_0x534cfb(0x225)});return;}if(!_0x31cdca||!_0x31cdca['startsWith'](_0x534cfb(0x1ad))&&!_0x31cdca[_0x534cfb(0x24d)](_0x534cfb(0x27f))){await this['bot']?.[_0x534cfb(0x214)](_0x22bc46,_0x534cfb(0x24b)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x534cfb(0x225)});return;}const _0x143bfc=await database_1[_0x534cfb(0x235)][_0x534cfb(0x264)]['findUnique']({'where':{'username':_0x1fc86b},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x143bfc){const _0x19dc0e=await database_1['default'][_0x534cfb(0x264)][_0x534cfb(0x1f2)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x588121=_0x534cfb(0x1dc)+_0x1fc86b+_0x534cfb(0x289);_0x19dc0e['length']>0x0?(_0x588121+=_0x534cfb(0x25a),_0x19dc0e[_0x534cfb(0x252)](_0x5e223f=>{const _0x18580f=_0x534cfb;_0x588121+=_0x18580f(0x271)+_0x5e223f['username']+_0x18580f(0x1ff)+_0x5e223f[_0x18580f(0x1fd)]+')\x0a';}),_0x588121+=_0x534cfb(0x25f)):_0x588121+='Check\x20spelling\x20and\x20try\x20again.';await this['bot']?.[_0x534cfb(0x214)](_0x22bc46,_0x588121,{'parse_mode':_0x534cfb(0x225)});return;}if(_0x143bfc[_0x534cfb(0x21c)]!==_0x534cfb(0x1b0)){await this['bot']?.['sendMessage'](_0x22bc46,_0x534cfb(0x23d)+_0x1fc86b+_0x534cfb(0x21f)+_0x534cfb(0x1ee),{'parse_mode':'Markdown'});return;}if(_0x143bfc[_0x534cfb(0x1d0)]!==_0x31cdca&&_0x143bfc[_0x534cfb(0x260)]!==_0x31cdca){await this['bot']?.[_0x534cfb(0x214)](_0x22bc46,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x1fc86b+_0x534cfb(0x211)+_0x534cfb(0x1cd)+_0x534cfb(0x1ab),{'parse_mode':_0x534cfb(0x225)});return;}const _0x1184a7=await database_1['default'][_0x534cfb(0x22d)][_0x534cfb(0x255)]({'where':{'shopId':_0x143bfc['id'],'isVerified':!![],'telegramId':{'not':_0x1ccf93}}});if(_0x1184a7){await this['bot']?.[_0x534cfb(0x214)](_0x22bc46,_0x534cfb(0x263)+_0x1fc86b+_0x534cfb(0x211)+_0x534cfb(0x1bc),{'parse_mode':_0x534cfb(0x225)});return;}await database_1[_0x534cfb(0x235)][_0x534cfb(0x22d)][_0x534cfb(0x21d)]({'where':{'telegramId':_0x1ccf93},'data':{'shopId':_0x143bfc['id'],'isVerified':!![]}}),await this[_0x534cfb(0x27b)]?.[_0x534cfb(0x214)](_0x22bc46,_0x534cfb(0x1de)+_0x534cfb(0x23c)+(_0x534cfb(0x1e4)+_0x143bfc['name']+'*\x0a')+(_0x534cfb(0x249)+_0x143bfc[_0x534cfb(0x28b)]+_0x534cfb(0x228))+_0x534cfb(0x206)+_0x534cfb(0x1d3)+'•\x20Payment\x20status\x20changes\x0a'+_0x534cfb(0x21a)+'•\x20Important\x20events\x0a\x0a'+_0x534cfb(0x27e)+_0x534cfb(0x25b)+_0x534cfb(0x1e8),{'parse_mode':_0x534cfb(0x225)}),console['log'](_0x534cfb(0x25d)+_0x1ccf93+_0x534cfb(0x1aa)+_0x143bfc['username']+'\x20via\x20single-line\x20input');}catch(_0xa05d12){console['error'](_0x534cfb(0x1ae),_0xa05d12),await this[_0x534cfb(0x27b)]?.[_0x534cfb(0x214)](_0x22bc46,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async['sendShopNotification'](_0x563b1f,_0x2e4ceb,_0x27f169){const _0x3bc131=a57_0x486e57;if(!this[_0x3bc131(0x27b)]){console[_0x3bc131(0x1d9)](_0x3bc131(0x26f));return;}try{const _0x1cf349=await database_1[_0x3bc131(0x235)][_0x3bc131(0x22d)][_0x3bc131(0x1f2)]({'where':{'shopId':_0x563b1f,'isVerified':!![]}});if(_0x1cf349[_0x3bc131(0x1b8)]===0x0){console[_0x3bc131(0x1be)](_0x3bc131(0x27a)+_0x563b1f);return;}const _0x410177=_0x1cf349[_0x3bc131(0x1dd)](async _0x2fb164=>{const _0x322167=_0x3bc131;try{await this[_0x322167(0x27b)]?.[_0x322167(0x214)](_0x2fb164['telegramId'],_0x2e4ceb,_0x27f169),console[_0x322167(0x1be)](_0x322167(0x1c8)+_0x2fb164[_0x322167(0x238)]);}catch(_0x52f010){console[_0x322167(0x26d)](_0x322167(0x1e0)+_0x2fb164[_0x322167(0x238)]+':',_0x52f010),_0x52f010 instanceof Error&&(_0x52f010['message']['includes']('blocked')||_0x52f010['message'][_0x322167(0x21e)](_0x322167(0x226))||_0x52f010[_0x322167(0x221)]['includes'](_0x322167(0x266)))&&(await database_1[_0x322167(0x235)]['telegramUser']['update']({'where':{'id':_0x2fb164['id']},'data':{'isVerified':![]}}),console[_0x322167(0x1be)](_0x322167(0x20b)+_0x2fb164[_0x322167(0x238)]+_0x322167(0x26a)));}});await Promise[_0x3bc131(0x248)](_0x410177);}catch(_0x23b90c){console[_0x3bc131(0x26d)]('Error\x20sending\x20shop\x20notification:',_0x23b90c);}}async[a57_0x486e57(0x270)](_0x2025ec,_0x1950bb,_0x386096){const _0x258c12=a57_0x486e57,_0x31d51c={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x2c7a66={'created':_0x258c12(0x20c),'paid':'Payment\x20successfully\x20paid','failed':_0x258c12(0x212),'expired':'Payment\x20expired','refund':_0x258c12(0x1e2),'chargeback':_0x258c12(0x1cf),'processing':_0x258c12(0x217)},_0x40bbb6=_0x31d51c[_0x386096],_0x1b7a6c=_0x2c7a66[_0x386096],_0x5b25fd=(0x0,gateway_1[_0x258c12(0x1f5)])(_0x1950bb[_0x258c12(0x1fc)]);console['log']('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x1950bb[_0x258c12(0x1fc)]+_0x258c12(0x222)+_0x5b25fd+'\x22');let _0x1a3600=_0x40bbb6+'\x20*'+_0x1b7a6c+_0x258c12(0x1f1)+(_0x258c12(0x20d)+_0x1950bb[_0x258c12(0x1eb)]+'\x20'+_0x1950bb[_0x258c12(0x26c)]+'*\x0a')+(_0x258c12(0x207)+(_0x1950bb[_0x258c12(0x24c)]||_0x1950bb['id'])+'`\x0a')+(_0x258c12(0x251)+_0x1950bb['id']+'`\x0a')+(_0x258c12(0x1f3)+_0x5b25fd+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x1950bb['createdAt'])[_0x258c12(0x1b1)]('en-US')+'\x0a');if(_0x1950bb[_0x258c12(0x1a7)]||_0x1950bb['customerEmail']||_0x1950bb[_0x258c12(0x254)]||_0x1950bb['customerIp']||_0x1950bb[_0x258c12(0x23b)]){_0x1a3600+='\x0a👤\x20*Customer\x20Information:*\x0a';_0x1950bb[_0x258c12(0x1a7)]&&(_0x1a3600+=_0x258c12(0x276)+_0x1950bb[_0x258c12(0x1a7)]+'`\x0a');_0x1950bb[_0x258c12(0x1c3)]&&(_0x1a3600+=_0x258c12(0x267)+_0x1950bb[_0x258c12(0x1c3)]+'`\x0a');_0x1950bb['remitterIban']&&(_0x1a3600+=_0x258c12(0x265)+_0x1950bb[_0x258c12(0x254)]+'`\x0a');_0x1950bb[_0x258c12(0x286)]&&(_0x1a3600+=_0x258c12(0x1ec)+_0x1950bb['customerIp']+'`\x0a');if(_0x1950bb['customerUa']){const _0x271620=_0x1950bb[_0x258c12(0x23b)][_0x258c12(0x1b8)]>0x32?_0x1950bb[_0x258c12(0x23b)][_0x258c12(0x1af)](0x0,0x32)+_0x258c12(0x22c):_0x1950bb[_0x258c12(0x23b)];_0x1a3600+=_0x258c12(0x24f)+_0x271620+'`\x0a';}}_0x386096===_0x258c12(0x1fa)&&_0x1950bb[_0x258c12(0x1b4)]&&(_0x1a3600+=_0x258c12(0x1c5)+_0x1950bb[_0x258c12(0x1b4)]+_0x258c12(0x220)),_0x386096===_0x258c12(0x1bb)&&(_0x1a3600+=_0x258c12(0x259)),_0x1950bb[_0x258c12(0x1c1)]&&(_0x1a3600+=_0x258c12(0x28f)+_0x1950bb[_0x258c12(0x1c1)]+'\x0a'),await this[_0x258c12(0x216)](_0x2025ec,_0x1a3600,{'parse_mode':_0x258c12(0x225)});}async['sendPayoutNotification'](_0x12723c,_0x319121,_0x3638fd){const _0x522279=a57_0x486e57,_0x5913c3={'created':'📤','completed':'✅','rejected':'❌'},_0x17cd8a={'created':_0x522279(0x25c),'completed':_0x522279(0x1b6),'rejected':_0x522279(0x23e)},_0x4d9c56=_0x5913c3[_0x3638fd],_0x21e981=_0x17cd8a[_0x3638fd],_0x4c5522=_0x4d9c56+'\x20*'+_0x21e981+'*\x0a\x0a'+(_0x522279(0x219)+_0x319121[_0x522279(0x1eb)]+_0x522279(0x274))+(_0x522279(0x20e)+_0x319121['method']+'`\x0a')+(_0x522279(0x1ca)+_0x319121['id']+'`\x0a')+(_0x522279(0x1f7)+new Date(_0x319121[_0x522279(0x1d4)])['toLocaleString'](_0x522279(0x26e))+'\x0a')+(_0x319121['txid']?_0x522279(0x210)+_0x319121[_0x522279(0x1da)]+'`':'');await this[_0x522279(0x216)](_0x12723c,_0x4c5522,{'parse_mode':_0x522279(0x225)});}async[a57_0x486e57(0x1e7)](_0x2bdbd1,_0x2de25a){const _0x364e60=a57_0x486e57;try{const _0x35dd2f=await database_1[_0x364e60(0x235)]['shopSettings'][_0x364e60(0x1d1)]({'where':{'shopId':_0x2bdbd1},'select':{'notificationLogin':!![]}});if(!_0x35dd2f?.[_0x364e60(0x1b7)]){console['log'](_0x364e60(0x253)+_0x2bdbd1);return;}const _0x4f4e7c=_0x2de25a['success']?'🔐':'🚨',_0x1fa324=_0x2de25a['success']?'Successful\x20login':_0x364e60(0x1b9);let _0x5497fd=_0x4f4e7c+'\x20*'+_0x1fa324+_0x364e60(0x1f1)+(_0x364e60(0x249)+_0x2de25a[_0x364e60(0x28b)]+'`\x0a')+('📅\x20Time:\x20'+_0x2de25a[_0x364e60(0x282)][_0x364e60(0x1b1)](_0x364e60(0x26e))+'\x0a');_0x2de25a['ipAddress']&&(_0x5497fd+=_0x364e60(0x201)+_0x2de25a[_0x364e60(0x25e)]+'`\x0a');if(_0x2de25a[_0x364e60(0x1d5)]){const _0x39af9e=_0x2de25a['userAgent'][_0x364e60(0x1b8)]>0x32?_0x2de25a['userAgent'][_0x364e60(0x1af)](0x0,0x32)+_0x364e60(0x22c):_0x2de25a[_0x364e60(0x1d5)];_0x5497fd+='💻\x20Browser:\x20`'+_0x39af9e+'`\x0a';}!_0x2de25a[_0x364e60(0x230)]&&(_0x5497fd+=_0x364e60(0x281)),await this[_0x364e60(0x216)](_0x2bdbd1,_0x5497fd,{'parse_mode':_0x364e60(0x225)}),console[_0x364e60(0x1be)](_0x364e60(0x234)+_0x2bdbd1+':\x20'+(_0x2de25a[_0x364e60(0x230)]?_0x364e60(0x230):_0x364e60(0x1df)));}catch(_0x36aacb){console['error']('Failed\x20to\x20send\x20login\x20notification:',_0x36aacb);}}async[a57_0x486e57(0x21b)](_0x4e7b21,_0x35bb9a){const _0x5e598e=a57_0x486e57;try{const _0x26bfa6=await database_1[_0x5e598e(0x235)][_0x5e598e(0x280)]['findUnique']({'where':{'shopId':_0x4e7b21},'select':{'notificationApiError':!![]}});if(!_0x26bfa6?.['notificationApiError']){console['log'](_0x5e598e(0x215)+_0x4e7b21);return;}let _0x13bee5='🚨\x20*API\x20Error*\x0a\x0a'+('🔗\x20Endpoint:\x20`'+_0x35bb9a['method']+'\x20'+_0x35bb9a[_0x5e598e(0x1bd)]+'`\x0a')+(_0x5e598e(0x227)+_0x35bb9a['timestamp'][_0x5e598e(0x1b1)]('en-US')+'\x0a');_0x35bb9a['statusCode']&&(_0x13bee5+='📊\x20Error\x20code:\x20`'+_0x35bb9a[_0x5e598e(0x1ce)]+'`\x0a'),_0x13bee5+=_0x5e598e(0x22e)+_0x35bb9a[_0x5e598e(0x1a8)]+'`\x0a',_0x35bb9a[_0x5e598e(0x1db)]&&(_0x13bee5+=_0x5e598e(0x1fe)+_0x35bb9a[_0x5e598e(0x1db)]+'`\x0a'),_0x13bee5+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x5e598e(0x216)](_0x4e7b21,_0x13bee5,{'parse_mode':_0x5e598e(0x225)}),console[_0x5e598e(0x1be)](_0x5e598e(0x272)+_0x4e7b21+':\x20'+_0x35bb9a[_0x5e598e(0x1bd)]);}catch(_0x22d9c2){console[_0x5e598e(0x26d)](_0x5e598e(0x1f8),_0x22d9c2);}}async['sendCustomNotification'](_0xb1f953,_0x181bc5,_0x2ebceb){const _0x818985=a57_0x486e57;let _0x1fed9c='🔔\x20*'+_0x181bc5+_0x818985(0x1f1);for(const [_0x482dec,_0x386a01]of Object[_0x818985(0x1b5)](_0x2ebceb)){_0x386a01!==null&&_0x386a01!==undefined&&(_0x1fed9c+=_0x482dec+_0x818985(0x231)+_0x386a01+'`\x0a');}await this[_0x818985(0x216)](_0xb1f953,_0x1fed9c,{'parse_mode':_0x818985(0x225)});}[a57_0x486e57(0x250)](){const _0x4ed419=a57_0x486e57;return{'isActive':!!this[_0x4ed419(0x27b)],'username':this[_0x4ed419(0x269)]};}[a57_0x486e57(0x22b)](){const _0x83721=a57_0x486e57;this[_0x83721(0x27b)]&&(this[_0x83721(0x27b)][_0x83721(0x1c6)](),this[_0x83721(0x27b)]=null,console['log']('🛑\x20Telegram\x20bot\x20stopped'));}}function a57_0x200a(_0x4c1f2b,_0x2015ba){const _0x59ed64=a57_0x59ed();return a57_0x200a=function(_0x200a36,_0x3b79c2){_0x200a36=_0x200a36-0x1a7;let _0x465676=_0x59ed64[_0x200a36];return _0x465676;},a57_0x200a(_0x4c1f2b,_0x2015ba);}exports[a57_0x486e57(0x1e6)]=TelegramBotService,exports[a57_0x486e57(0x1f6)]=new TelegramBotService();