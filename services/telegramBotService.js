'use strict';const a52_0x2b439c=a52_0x148e;(function(_0x552f3c,_0x36f949){const _0x595f6a=a52_0x148e,_0x2baef1=_0x552f3c();while(!![]){try{const _0x308039=parseInt(_0x595f6a(0x1f1))/0x1+-parseInt(_0x595f6a(0x1ad))/0x2+-parseInt(_0x595f6a(0x1ac))/0x3+parseInt(_0x595f6a(0x19b))/0x4+parseInt(_0x595f6a(0x176))/0x5*(-parseInt(_0x595f6a(0x21b))/0x6)+-parseInt(_0x595f6a(0x152))/0x7+-parseInt(_0x595f6a(0x1f8))/0x8*(-parseInt(_0x595f6a(0x1b2))/0x9);if(_0x308039===_0x36f949)break;else _0x2baef1['push'](_0x2baef1['shift']());}catch(_0x560b1b){_0x2baef1['push'](_0x2baef1['shift']());}}}(a52_0x2287,0x5164c));function a52_0x148e(_0x35f810,_0x442994){const _0x2287a8=a52_0x2287();return a52_0x148e=function(_0x148e1c,_0x600334){_0x148e1c=_0x148e1c-0x13d;let _0x3043fe=_0x2287a8[_0x148e1c];return _0x3043fe;},a52_0x148e(_0x35f810,_0x442994);}function a52_0x2287(){const _0x48f380=['Payment\x20failed','stopPolling','✅\x20Welcome\x20back!\x0a\x0a','1836960xTDRVE','toString','Failed\x20to\x20send\x20API\x20error\x20notification:','•\x20`','*.\x0a\x0a','botToken','Error\x20handling\x20/start\x20command:','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','\x22\x20->\x20display\x20\x22','\x0a👤\x20*Customer\x20Information:*\x0a','💸\x20Penalty\x20amount:\x20*','Check\x20spelling\x20and\x20try\x20again.','unknown\x20shop','requestId','`.\x0a\x0a','timestamp','🏦\x20Method:\x20`','\x20disconnected\x20from\x20shop\x20','sendPayoutNotification','name','processing','\x20\x20\x20Public\x20Key:\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','1712172qVMzYm','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','pk_','currency','env','\x20verified\x20for\x20shop\x20','default','🏪\x20Gateway:\x20`','trim','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','txid','username','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','polling_error','chargeback','getGatewayDisplayNameForTelegram','failed','Error\x20handling\x20/debug\x20command:','🔔\x20*','includes','📝\x20Notes:\x20','Available\x20usernames:\x0a','customerName','Successful\x20login','Payment\x20successfully\x20paid','telegramUser','customerEmail','Failed\x20to\x20send\x20login\x20notification:','isVerified','📛\x20Name:\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a','from','🆔\x20Payout\x20ID:\x20`','allSettled','📊\x20Error\x20code:\x20`','5sgjAyK','gateway','Payment\x20chargeback',':\x20username=\x22','💰\x20Amount:\x20*','New\x20payout\x20created','en-US','🔗\x20TXID:\x20`','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','ipAddress','handleSingleLineVerification','join','bot','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','❌\x20Invalid\x20username\x20format:\x20`','...\x22','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','❌\x20Shop\x20`','Use\x20/start\x20to\x20begin.','orderId','Error\x20handling\x20message:','warn',':\x20`','errorMessage','`\x0a\x0a','✅\x20Connected\x20to\x20shop:\x20*','startsWith','sk_','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','success','telegramBotService','📊\x20*Connection\x20Status*\x0a\x0a','\x20via\x20single-line\x20input','Markdown','TelegramBotService','first_name','483628dOeASk','endpoint','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','📝\x20Order\x20ID:\x20`','\x20initialized\x20successfully','🛑\x20Telegram\x20bot\x20stopped','findMany','../config/database','telegramId','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','sendShopNotification','last_name','status','updatedAt','👤\x20Username:\x20`','To\x20reconnect,\x20use\x20the\x20/start\x20command','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','692403ssQiHl','913482MfpZcD','Username:\x20`','`\x20(','chargebackAmount','Payout\x20rejected','18lehKxi','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','...`\x0a\x0a','📱\x20Created\x20new\x20Telegram\x20user:\x20','botUsername','map','🔍\x20*Debug\x20Information*\x0a\x0a','user\x20is\x20deactivated','📱\x20Shop:\x20*','/status\x20-\x20check\x20connection\x20status\x0a','defineProperty','🔌\x20User\x20','statusCode','📅\x20Connection\x20date:\x20','📅\x20Time:\x20','\x20\x20\x20Status:\x20','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Commands:\x0a','Payment\x20is\x20being\x20processed','Telegram\x20bot\x20polling\x20error:','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','shop','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','`\x20is\x20inactive.\x0a\x0a','Payment\x20expired','Error\x20in\x20handleSingleLineVerification:','text','\x22,\x20apiKey=\x22','__importDefault','•\x20Payouts\x0a\x0a','userAgent','sendPaymentNotification','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Telegram\x20bot\x20error:','\x20USD*\x0a','User\x20','amount','log','shopSettings','•\x20Important\x20events\x0a\x0a','length','../types/gateway','\x20(@','method','createdAt','onText','forEach','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','secretKey','❌\x20Error\x20getting\x20debug\x20information.','📅\x20Date:\x20','sendApiErrorNotification','notificationApiError','findFirst','initializeBot','sendMessage','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','•\x20Payouts\x0a','test','TELEGRAM_BOT_USERNAME','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','400771LzSoZc','🔔\x20Notifications\x20are\x20active\x0a\x0a','Error\x20sending\x20shop\x20notification:','❌\x20Shop\x20with\x20username\x20`','setupBotHandlers','\x0aCheck\x20spelling\x20and\x20try\x20again.','💸\x20Amount:\x20*','4200032VqVUwf','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','publicKey','🚨\x20*API\x20Error*\x0a\x0a','shopId','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','adminNotes','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','notificationLogin','sendLoginNotification','❌\x20Error:\x20`','update','chat','findUnique','*\x0a\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','•\x20New\x20payments\x0a','create','substring','node-telegram-bot-api','You\x20sent\x20','toLocaleDateString','toLocaleString','Example:\x0a','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','error','message','...'];a52_0x2287=function(){return _0x48f380;};return a52_0x2287();}var __importDefault=this&&this[a52_0x2b439c(0x1cf)]||function(_0x573fd0){return _0x573fd0&&_0x573fd0['__esModule']?_0x573fd0:{'default':_0x573fd0};};Object[a52_0x2b439c(0x1bc)](exports,'__esModule',{'value':!![]}),exports['telegramBotService']=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a52_0x2b439c(0x20f))),database_1=__importDefault(require(a52_0x2b439c(0x1a2))),gateway_1=require(a52_0x2b439c(0x1dd));class TelegramBotService{constructor(){const _0x1c0559=a52_0x2b439c;this[_0x1c0559(0x183)]=null,this[_0x1c0559(0x13f)]=process[_0x1c0559(0x156)]['TELEGRAM_BOT_TOKEN']||'',this['botUsername']=process[_0x1c0559(0x156)][_0x1c0559(0x1ef)]||'trapay_bot',this['botToken']?this[_0x1c0559(0x1ea)]():console[_0x1c0559(0x18c)](_0x1c0559(0x1ab));}[a52_0x2b439c(0x1ea)](){const _0x48f858=a52_0x2b439c;try{this[_0x48f858(0x183)]=new node_telegram_bot_api_1[(_0x48f858(0x158))](this[_0x48f858(0x13f)],{'polling':!![]}),this[_0x48f858(0x1f5)](),console[_0x48f858(0x1d9)]('✅\x20Telegram\x20bot\x20@'+this['botUsername']+_0x48f858(0x19f));}catch(_0x37c3d9){console[_0x48f858(0x215)](_0x48f858(0x151),_0x37c3d9);}}['setupBotHandlers'](){const _0x42f4f4=a52_0x2b439c;if(!this[_0x42f4f4(0x183)])return;this[_0x42f4f4(0x183)][_0x42f4f4(0x1e1)](/\/start/,async _0x477f74=>{const _0x31615b=_0x42f4f4,_0x1fda96=_0x477f74[_0x31615b(0x206)]['id'],_0x2a982b=_0x477f74[_0x31615b(0x172)]?.['id'][_0x31615b(0x21c)](),_0x383d46=_0x477f74[_0x31615b(0x172)]?.['username'],_0x1e11ad=_0x477f74[_0x31615b(0x172)]?.[_0x31615b(0x19a)],_0x39da7c=_0x477f74['from']?.[_0x31615b(0x1a6)];if(!_0x2a982b)return;try{let _0x12cb97=await database_1[_0x31615b(0x158)][_0x31615b(0x16c)]['findUnique']({'where':{'telegramId':_0x2a982b},'include':{'shop':!![]}});!_0x12cb97?(_0x12cb97=await database_1[_0x31615b(0x158)][_0x31615b(0x16c)][_0x31615b(0x20d)]({'data':{'telegramId':_0x2a982b,'username':_0x383d46,'firstName':_0x1e11ad,'lastName':_0x39da7c,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x31615b(0x1d9)](_0x31615b(0x1b5)+_0x2a982b+_0x31615b(0x1de)+_0x383d46+')')):_0x12cb97=await database_1[_0x31615b(0x158)][_0x31615b(0x16c)]['update']({'where':{'telegramId':_0x2a982b},'data':{'username':_0x383d46,'firstName':_0x1e11ad,'lastName':_0x39da7c},'include':{'shop':!![]}}),_0x12cb97[_0x31615b(0x16f)]&&_0x12cb97[_0x31615b(0x1fc)]&&_0x12cb97[_0x31615b(0x1c8)]?await this[_0x31615b(0x183)]?.[_0x31615b(0x1eb)](_0x1fda96,_0x31615b(0x21a)+(_0x31615b(0x141)+_0x12cb97[_0x31615b(0x1c8)][_0x31615b(0x14d)]+'*\x0a')+(_0x31615b(0x1ae)+_0x12cb97[_0x31615b(0x1c8)][_0x31615b(0x15e)]+_0x31615b(0x18f))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x31615b(0x20c)+'•\x20Payment\x20status\x20changes\x0a'+_0x31615b(0x1d0)+_0x31615b(0x1c4)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x31615b(0x150),{'parse_mode':_0x31615b(0x198)}):(_0x12cb97[_0x31615b(0x1fc)]&&!_0x12cb97[_0x31615b(0x16f)]&&(await database_1['default'][_0x31615b(0x16c)][_0x31615b(0x205)]({'where':{'telegramId':_0x2a982b},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x31615b(0x1fe)+_0x2a982b)),await this[_0x31615b(0x183)]?.[_0x31615b(0x1eb)](_0x1fda96,_0x31615b(0x1ec)+_0x31615b(0x1c2)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x31615b(0x213)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x31615b(0x1a4),{'parse_mode':_0x31615b(0x198)}));}catch(_0x56ef0b){console['error'](_0x31615b(0x140),_0x56ef0b),await this['bot']?.['sendMessage'](_0x1fda96,_0x31615b(0x1e3));}}),this['bot'][_0x42f4f4(0x1e1)](/\/disconnect/,async _0x502e48=>{const _0x931d48=_0x42f4f4,_0x273ffc=_0x502e48[_0x931d48(0x206)]['id'],_0x4753c5=_0x502e48['from']?.['id'][_0x931d48(0x21c)]();if(!_0x4753c5)return;try{const _0x2258cd=await database_1[_0x931d48(0x158)][_0x931d48(0x16c)][_0x931d48(0x207)]({'where':{'telegramId':_0x4753c5},'include':{'shop':!![]}});if(!_0x2258cd||!_0x2258cd['isVerified']||!_0x2258cd[_0x931d48(0x1fc)]){await this[_0x931d48(0x183)]?.['sendMessage'](_0x273ffc,_0x931d48(0x193));return;}const _0x2253ce=_0x2258cd[_0x931d48(0x1c8)]?.[_0x931d48(0x14d)]||_0x931d48(0x146);await database_1[_0x931d48(0x158)][_0x931d48(0x16c)][_0x931d48(0x205)]({'where':{'telegramId':_0x4753c5},'data':{'shopId':null,'isVerified':![]}}),console[_0x931d48(0x1d9)](_0x931d48(0x1bd)+_0x4753c5+_0x931d48(0x14b)+_0x2258cd[_0x931d48(0x1fc)]),await this[_0x931d48(0x183)]?.[_0x931d48(0x1eb)](_0x273ffc,_0x931d48(0x153)+_0x2253ce+_0x931d48(0x13e)+_0x931d48(0x1aa),{'parse_mode':_0x931d48(0x198)});}catch(_0x3689ef){console[_0x931d48(0x215)]('Error\x20handling\x20/disconnect\x20command:',_0x3689ef),await this[_0x931d48(0x183)]?.[_0x931d48(0x1eb)](_0x273ffc,_0x931d48(0x1e3));}}),this['bot']['onText'](/\/status/,async _0x1188d2=>{const _0x4a4d75=_0x42f4f4,_0x4534aa=_0x1188d2[_0x4a4d75(0x206)]['id'],_0x9a3ab3=_0x1188d2[_0x4a4d75(0x172)]?.['id'][_0x4a4d75(0x21c)]();if(!_0x9a3ab3)return;try{const _0x86b6e=await database_1[_0x4a4d75(0x158)][_0x4a4d75(0x16c)][_0x4a4d75(0x207)]({'where':{'telegramId':_0x9a3ab3},'include':{'shop':!![]}});if(!_0x86b6e){await this[_0x4a4d75(0x183)]?.[_0x4a4d75(0x1eb)](_0x4534aa,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x4a4d75(0x189));return;}if(!_0x86b6e[_0x4a4d75(0x16f)]||!_0x86b6e[_0x4a4d75(0x1fc)]||!_0x86b6e[_0x4a4d75(0x1c8)]){await this[_0x4a4d75(0x183)]?.[_0x4a4d75(0x1eb)](_0x4534aa,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+'Use\x20/start\x20to\x20connect.');return;}await this[_0x4a4d75(0x183)]?.[_0x4a4d75(0x1eb)](_0x4534aa,_0x4a4d75(0x196)+(_0x4a4d75(0x190)+_0x86b6e[_0x4a4d75(0x1c8)]['name']+'*\x0a')+(_0x4a4d75(0x1a9)+_0x86b6e['shop']['username']+'`\x0a')+(_0x4a4d75(0x1bf)+_0x86b6e[_0x4a4d75(0x1a8)][_0x4a4d75(0x211)](_0x4a4d75(0x17c))+'\x0a\x0a')+_0x4a4d75(0x1f2)+_0x4a4d75(0x1c4)+_0x4a4d75(0x150),{'parse_mode':_0x4a4d75(0x198)});}catch(_0x3c8fc3){console[_0x4a4d75(0x215)]('Error\x20handling\x20/status\x20command:',_0x3c8fc3),await this[_0x4a4d75(0x183)]?.[_0x4a4d75(0x1eb)](_0x4534aa,_0x4a4d75(0x1e3));}}),this[_0x42f4f4(0x183)][_0x42f4f4(0x1e1)](/\/debug/,async _0x60f557=>{const _0x1bb57b=_0x42f4f4,_0x4e7e7f=_0x60f557[_0x1bb57b(0x206)]['id'],_0x33e121=_0x60f557[_0x1bb57b(0x172)]?.['id'][_0x1bb57b(0x21c)]();if(!_0x33e121)return;try{const _0x1c848d=await database_1[_0x1bb57b(0x158)][_0x1bb57b(0x1c8)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0xe0c043=_0x1bb57b(0x1b8);_0xe0c043+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x33e121+_0x1bb57b(0x18f),_0xe0c043+=_0x1bb57b(0x171),_0x1c848d[_0x1bb57b(0x1e2)]((_0x11d24c,_0x3cfa5b)=>{const _0x1dfcd6=_0x1bb57b;_0xe0c043+=_0x3cfa5b+0x1+'.\x20*'+_0x11d24c[_0x1dfcd6(0x14d)]+'*\x0a',_0xe0c043+='\x20\x20\x20Username:\x20`'+_0x11d24c[_0x1dfcd6(0x15e)]+'`\x0a',_0xe0c043+=_0x1dfcd6(0x1c1)+_0x11d24c[_0x1dfcd6(0x1a7)]+'\x0a',_0xe0c043+=_0x1dfcd6(0x14f)+_0x11d24c[_0x1dfcd6(0x1fa)][_0x1dfcd6(0x20e)](0x0,0xf)+_0x1dfcd6(0x1b4);}),await this['bot']?.[_0x1bb57b(0x1eb)](_0x4e7e7f,_0xe0c043,{'parse_mode':'Markdown'});}catch(_0x3b2b4a){console[_0x1bb57b(0x215)](_0x1bb57b(0x164),_0x3b2b4a),await this[_0x1bb57b(0x183)]?.[_0x1bb57b(0x1eb)](_0x4e7e7f,_0x1bb57b(0x1e5));}}),this[_0x42f4f4(0x183)]['on'](_0x42f4f4(0x216),async _0x18aba4=>{const _0x4d1a7c=_0x42f4f4;if(_0x18aba4[_0x4d1a7c(0x1cd)]?.[_0x4d1a7c(0x191)]('/'))return;const _0x3db9d5=_0x18aba4[_0x4d1a7c(0x206)]['id'],_0x21612d=_0x18aba4['from']?.['id'][_0x4d1a7c(0x21c)](),_0x509bde=_0x18aba4[_0x4d1a7c(0x1cd)]?.[_0x4d1a7c(0x15a)]();if(!_0x21612d||!_0x509bde)return;try{const _0x4e43a3=await database_1[_0x4d1a7c(0x158)][_0x4d1a7c(0x16c)]['findUnique']({'where':{'telegramId':_0x21612d},'include':{'shop':!![]}});if(!_0x4e43a3){await this[_0x4d1a7c(0x183)]?.[_0x4d1a7c(0x1eb)](_0x3db9d5,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x4e43a3[_0x4d1a7c(0x16f)]&&_0x4e43a3['shopId']&&_0x4e43a3[_0x4d1a7c(0x1c8)]){await this[_0x4d1a7c(0x183)]?.['sendMessage'](_0x3db9d5,_0x4d1a7c(0x1f0)+_0x4e43a3[_0x4d1a7c(0x1c8)][_0x4d1a7c(0x14d)]+_0x4d1a7c(0x13e)+_0x4d1a7c(0x15c),{'parse_mode':_0x4d1a7c(0x198)});return;}const _0x10fd11=_0x509bde['split'](/\s+/);if(_0x10fd11['length']!==0x2){await this[_0x4d1a7c(0x183)]?.['sendMessage'](_0x3db9d5,_0x4d1a7c(0x1c3)+_0x4d1a7c(0x184)+'Example:\x0a'+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x4d1a7c(0x210)+_0x10fd11[_0x4d1a7c(0x1dc)]+'\x20parts:\x20'+_0x10fd11['map'](_0x253161=>'`'+_0x253161+'`')[_0x4d1a7c(0x182)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x2fd577,_0x45e5ad]=_0x10fd11;console['log']('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x21612d+':\x20username=\x22'+_0x2fd577+_0x4d1a7c(0x1ce)+_0x45e5ad[_0x4d1a7c(0x20e)](0x0,0xa)+_0x4d1a7c(0x186)),await this[_0x4d1a7c(0x181)](_0x3db9d5,_0x21612d,_0x2fd577,_0x45e5ad);}catch(_0x581c00){console['error'](_0x4d1a7c(0x18b),_0x581c00),await this[_0x4d1a7c(0x183)]?.['sendMessage'](_0x3db9d5,_0x4d1a7c(0x1e3));}}),this[_0x42f4f4(0x183)]['on']('error',_0x508927=>{const _0x6540fc=_0x42f4f4;console[_0x6540fc(0x215)](_0x6540fc(0x1d5),_0x508927);}),this['bot']['on'](_0x42f4f4(0x160),_0x7d225f=>{const _0x32df26=_0x42f4f4;console[_0x32df26(0x215)](_0x32df26(0x1c6),_0x7d225f);});}async[a52_0x2b439c(0x181)](_0x4bc3f8,_0x3779d0,_0x18373a,_0x12b2ea){const _0x10c32e=a52_0x2b439c;try{console[_0x10c32e(0x1d9)](_0x10c32e(0x1f9)+_0x3779d0+_0x10c32e(0x179)+_0x18373a+_0x10c32e(0x1ce)+_0x12b2ea[_0x10c32e(0x20e)](0x0,0xa)+_0x10c32e(0x186));if(!_0x18373a||_0x18373a[_0x10c32e(0x1dc)]<0x3||_0x18373a[_0x10c32e(0x1dc)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x10c32e(0x1ee)](_0x18373a)){await this[_0x10c32e(0x183)]?.[_0x10c32e(0x1eb)](_0x4bc3f8,_0x10c32e(0x185)+_0x18373a+_0x10c32e(0x18f)+_0x10c32e(0x1ff),{'parse_mode':_0x10c32e(0x198)});return;}if(!_0x12b2ea||!_0x12b2ea[_0x10c32e(0x191)](_0x10c32e(0x154))&&!_0x12b2ea['startsWith'](_0x10c32e(0x192))){await this[_0x10c32e(0x183)]?.[_0x10c32e(0x1eb)](_0x4bc3f8,_0x10c32e(0x1c9)+_0x10c32e(0x19d),{'parse_mode':_0x10c32e(0x198)});return;}const _0x2dca79=await database_1['default'][_0x10c32e(0x1c8)][_0x10c32e(0x207)]({'where':{'username':_0x18373a},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x2dca79){const _0x5c8a19=await database_1[_0x10c32e(0x158)]['shop'][_0x10c32e(0x1a1)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0xa8267e=_0x10c32e(0x1f4)+_0x18373a+'`\x20not\x20found.\x0a\x0a';_0x5c8a19['length']>0x0?(_0xa8267e+=_0x10c32e(0x168),_0x5c8a19[_0x10c32e(0x1e2)](_0x13213f=>{const _0x36c138=_0x10c32e;_0xa8267e+=_0x36c138(0x13d)+_0x13213f[_0x36c138(0x15e)]+_0x36c138(0x1af)+_0x13213f['name']+')\x0a';}),_0xa8267e+=_0x10c32e(0x1f6)):_0xa8267e+=_0x10c32e(0x145);await this[_0x10c32e(0x183)]?.[_0x10c32e(0x1eb)](_0x4bc3f8,_0xa8267e,{'parse_mode':_0x10c32e(0x198)});return;}if(_0x2dca79['status']!=='ACTIVE'){await this[_0x10c32e(0x183)]?.[_0x10c32e(0x1eb)](_0x4bc3f8,_0x10c32e(0x188)+_0x18373a+_0x10c32e(0x1ca)+'Contact\x20administrator.',{'parse_mode':_0x10c32e(0x198)});return;}if(_0x2dca79[_0x10c32e(0x1fa)]!==_0x12b2ea&&_0x2dca79[_0x10c32e(0x1e4)]!==_0x12b2ea){await this[_0x10c32e(0x183)]?.['sendMessage'](_0x4bc3f8,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x18373a+'`.\x0a\x0a'+_0x10c32e(0x1c7)+_0x10c32e(0x20b),{'parse_mode':_0x10c32e(0x198)});return;}const _0x114219=await database_1[_0x10c32e(0x158)]['telegramUser'][_0x10c32e(0x1e9)]({'where':{'shopId':_0x2dca79['id'],'isVerified':!![],'telegramId':{'not':_0x3779d0}}});if(_0x114219){await this[_0x10c32e(0x183)]?.[_0x10c32e(0x1eb)](_0x4bc3f8,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x18373a+_0x10c32e(0x148)+_0x10c32e(0x1b3),{'parse_mode':'Markdown'});return;}await database_1[_0x10c32e(0x158)][_0x10c32e(0x16c)]['update']({'where':{'telegramId':_0x3779d0},'data':{'shopId':_0x2dca79['id'],'isVerified':!![]}}),await this[_0x10c32e(0x183)]?.['sendMessage'](_0x4bc3f8,'🎉\x20*Congratulations!*\x0a\x0a'+_0x10c32e(0x15b)+(_0x10c32e(0x1ba)+_0x2dca79[_0x10c32e(0x14d)]+'*\x0a')+(_0x10c32e(0x1a9)+_0x2dca79['username']+_0x10c32e(0x18f))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x10c32e(0x20c)+'•\x20Payment\x20status\x20changes\x0a'+_0x10c32e(0x1ed)+_0x10c32e(0x1db)+_0x10c32e(0x1c4)+_0x10c32e(0x1bb)+_0x10c32e(0x150),{'parse_mode':_0x10c32e(0x198)}),console['log']('✅\x20Telegram\x20user\x20'+_0x3779d0+_0x10c32e(0x157)+_0x2dca79[_0x10c32e(0x15e)]+_0x10c32e(0x197));}catch(_0x57c965){console['error'](_0x10c32e(0x1cc),_0x57c965),await this['bot']?.['sendMessage'](_0x4bc3f8,_0x10c32e(0x17e));}}async['sendShopNotification'](_0x4fe529,_0xa0e09,_0x2d824b){const _0x5972d8=a52_0x2b439c;if(!this[_0x5972d8(0x183)]){console[_0x5972d8(0x18c)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x43f2cf=await database_1[_0x5972d8(0x158)]['telegramUser'][_0x5972d8(0x1a1)]({'where':{'shopId':_0x4fe529,'isVerified':!![]}});if(_0x43f2cf[_0x5972d8(0x1dc)]===0x0){console[_0x5972d8(0x1d9)](_0x5972d8(0x201)+_0x4fe529);return;}const _0x27962b=_0x43f2cf[_0x5972d8(0x1b7)](async _0x54727a=>{const _0x2ef69a=_0x5972d8;try{await this[_0x2ef69a(0x183)]?.[_0x2ef69a(0x1eb)](_0x54727a[_0x2ef69a(0x1a3)],_0xa0e09,_0x2d824b),console[_0x2ef69a(0x1d9)](_0x2ef69a(0x1fd)+_0x54727a[_0x2ef69a(0x1a3)]);}catch(_0x584b71){console['error']('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x54727a[_0x2ef69a(0x1a3)]+':',_0x584b71),_0x584b71 instanceof Error&&(_0x584b71[_0x2ef69a(0x216)][_0x2ef69a(0x166)]('blocked')||_0x584b71['message'][_0x2ef69a(0x166)]('chat\x20not\x20found')||_0x584b71[_0x2ef69a(0x216)]['includes'](_0x2ef69a(0x1b9)))&&(await database_1[_0x2ef69a(0x158)][_0x2ef69a(0x16c)][_0x2ef69a(0x205)]({'where':{'id':_0x54727a['id']},'data':{'isVerified':![]}}),console['log'](_0x2ef69a(0x1d7)+_0x54727a[_0x2ef69a(0x1a3)]+_0x2ef69a(0x187)));}});await Promise[_0x5972d8(0x174)](_0x27962b);}catch(_0x1f4df4){console['error'](_0x5972d8(0x1f3),_0x1f4df4);}}async[a52_0x2b439c(0x1d2)](_0x8e6183,_0x7ad3b9,_0x1cb296){const _0x3a8eae=a52_0x2b439c,_0x1122ed={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x379be8={'created':'New\x20payment\x20created','paid':_0x3a8eae(0x16b),'failed':_0x3a8eae(0x218),'expired':_0x3a8eae(0x1cb),'refund':'Payment\x20refund','chargeback':_0x3a8eae(0x178),'processing':_0x3a8eae(0x1c5)},_0x46f13a=_0x1122ed[_0x1cb296],_0x32b69c=_0x379be8[_0x1cb296],_0xc7317a=(0x0,gateway_1[_0x3a8eae(0x162)])(_0x7ad3b9[_0x3a8eae(0x177)]);console[_0x3a8eae(0x1d9)](_0x3a8eae(0x209)+_0x7ad3b9[_0x3a8eae(0x177)]+_0x3a8eae(0x142)+_0xc7317a+'\x22');let _0x223eff=_0x46f13a+'\x20*'+_0x32b69c+_0x3a8eae(0x208)+(_0x3a8eae(0x17a)+_0x7ad3b9[_0x3a8eae(0x1d8)]+'\x20'+_0x7ad3b9[_0x3a8eae(0x155)]+'*\x0a')+(_0x3a8eae(0x19e)+(_0x7ad3b9[_0x3a8eae(0x18a)]||_0x7ad3b9['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x7ad3b9['id']+'`\x0a')+(_0x3a8eae(0x159)+_0xc7317a+'`\x0a')+(_0x3a8eae(0x1e6)+new Date(_0x7ad3b9['createdAt'])['toLocaleString'](_0x3a8eae(0x17c))+'\x0a');(_0x7ad3b9['customerName']||_0x7ad3b9[_0x3a8eae(0x16d)])&&(_0x223eff+=_0x3a8eae(0x143),_0x7ad3b9[_0x3a8eae(0x169)]&&(_0x223eff+=_0x3a8eae(0x170)+_0x7ad3b9[_0x3a8eae(0x169)]+'`\x0a'),_0x7ad3b9['customerEmail']&&(_0x223eff+='📧\x20Email:\x20`'+_0x7ad3b9[_0x3a8eae(0x16d)]+'`\x0a')),_0x1cb296===_0x3a8eae(0x161)&&_0x7ad3b9[_0x3a8eae(0x1b0)]&&(_0x223eff+=_0x3a8eae(0x144)+_0x7ad3b9[_0x3a8eae(0x1b0)]+'\x20USDT*\x0a'),_0x1cb296===_0x3a8eae(0x14e)&&(_0x223eff+=_0x3a8eae(0x17f)),_0x7ad3b9[_0x3a8eae(0x200)]&&(_0x223eff+=_0x3a8eae(0x167)+_0x7ad3b9[_0x3a8eae(0x200)]+'\x0a'),await this['sendShopNotification'](_0x8e6183,_0x223eff,{'parse_mode':'Markdown'});}async[a52_0x2b439c(0x14c)](_0x1fcd75,_0x56ad79,_0x57060f){const _0x4d5f42=a52_0x2b439c,_0x5ea940={'created':'📤','completed':'✅','rejected':'❌'},_0x2cf792={'created':_0x4d5f42(0x17b),'completed':'Payout\x20completed','rejected':_0x4d5f42(0x1b1)},_0x25dae1=_0x5ea940[_0x57060f],_0x36ed5a=_0x2cf792[_0x57060f],_0x17dc08=_0x25dae1+'\x20*'+_0x36ed5a+_0x4d5f42(0x208)+(_0x4d5f42(0x1f7)+_0x56ad79[_0x4d5f42(0x1d8)]+_0x4d5f42(0x1d6))+(_0x4d5f42(0x14a)+_0x56ad79[_0x4d5f42(0x1df)]+'`\x0a')+(_0x4d5f42(0x173)+_0x56ad79['id']+'`\x0a')+(_0x4d5f42(0x1e6)+new Date(_0x56ad79[_0x4d5f42(0x1e0)])['toLocaleString'](_0x4d5f42(0x17c))+'\x0a')+(_0x56ad79[_0x4d5f42(0x15d)]?_0x4d5f42(0x17d)+_0x56ad79['txid']+'`':'');await this[_0x4d5f42(0x1a5)](_0x1fcd75,_0x17dc08,{'parse_mode':_0x4d5f42(0x198)});}async[a52_0x2b439c(0x203)](_0x5714e4,_0x1b8660){const _0x4891ff=a52_0x2b439c;try{const _0x5f5bab=await database_1['default'][_0x4891ff(0x1da)][_0x4891ff(0x207)]({'where':{'shopId':_0x5714e4},'select':{'notificationLogin':!![]}});if(!_0x5f5bab?.[_0x4891ff(0x202)]){console['log'](_0x4891ff(0x20a)+_0x5714e4);return;}const _0x37bb83=_0x1b8660[_0x4891ff(0x194)]?'🔐':'🚨',_0x25e3c8=_0x1b8660[_0x4891ff(0x194)]?_0x4891ff(0x16a):'Failed\x20login\x20attempt';let _0x2c2ef3=_0x37bb83+'\x20*'+_0x25e3c8+'*\x0a\x0a'+(_0x4891ff(0x1a9)+_0x1b8660[_0x4891ff(0x15e)]+'`\x0a')+(_0x4891ff(0x1c0)+_0x1b8660[_0x4891ff(0x149)][_0x4891ff(0x212)](_0x4891ff(0x17c))+'\x0a');_0x1b8660[_0x4891ff(0x180)]&&(_0x2c2ef3+='🌐\x20IP\x20address:\x20`'+_0x1b8660[_0x4891ff(0x180)]+'`\x0a');if(_0x1b8660[_0x4891ff(0x1d1)]){const _0x4f6c60=_0x1b8660[_0x4891ff(0x1d1)]['length']>0x32?_0x1b8660[_0x4891ff(0x1d1)][_0x4891ff(0x20e)](0x0,0x32)+_0x4891ff(0x217):_0x1b8660[_0x4891ff(0x1d1)];_0x2c2ef3+='💻\x20Browser:\x20`'+_0x4f6c60+'`\x0a';}!_0x1b8660['success']&&(_0x2c2ef3+=_0x4891ff(0x15f)),await this[_0x4891ff(0x1a5)](_0x5714e4,_0x2c2ef3,{'parse_mode':_0x4891ff(0x198)}),console['log'](_0x4891ff(0x1d3)+_0x5714e4+':\x20'+(_0x1b8660[_0x4891ff(0x194)]?_0x4891ff(0x194):_0x4891ff(0x163)));}catch(_0x35c1a1){console[_0x4891ff(0x215)](_0x4891ff(0x16e),_0x35c1a1);}}async[a52_0x2b439c(0x1e7)](_0x56ae44,_0x1a9f03){const _0x4e0702=a52_0x2b439c;try{const _0x48429f=await database_1[_0x4e0702(0x158)][_0x4e0702(0x1da)][_0x4e0702(0x207)]({'where':{'shopId':_0x56ae44},'select':{'notificationApiError':!![]}});if(!_0x48429f?.[_0x4e0702(0x1e8)]){console['log'](_0x4e0702(0x1d4)+_0x56ae44);return;}let _0x3ec53b=_0x4e0702(0x1fb)+('🔗\x20Endpoint:\x20`'+_0x1a9f03[_0x4e0702(0x1df)]+'\x20'+_0x1a9f03[_0x4e0702(0x19c)]+'`\x0a')+(_0x4e0702(0x1c0)+_0x1a9f03[_0x4e0702(0x149)]['toLocaleString'](_0x4e0702(0x17c))+'\x0a');_0x1a9f03[_0x4e0702(0x1be)]&&(_0x3ec53b+=_0x4e0702(0x175)+_0x1a9f03[_0x4e0702(0x1be)]+'`\x0a'),_0x3ec53b+=_0x4e0702(0x204)+_0x1a9f03[_0x4e0702(0x18e)]+'`\x0a',_0x1a9f03['requestId']&&(_0x3ec53b+='🆔\x20Request\x20ID:\x20`'+_0x1a9f03[_0x4e0702(0x147)]+'`\x0a'),_0x3ec53b+=_0x4e0702(0x214),await this[_0x4e0702(0x1a5)](_0x56ae44,_0x3ec53b,{'parse_mode':_0x4e0702(0x198)}),console[_0x4e0702(0x1d9)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x56ae44+':\x20'+_0x1a9f03[_0x4e0702(0x19c)]);}catch(_0x550b07){console['error'](_0x4e0702(0x21d),_0x550b07);}}async['sendCustomNotification'](_0x64b744,_0x179270,_0x5c1a75){const _0x36ae2b=a52_0x2b439c;let _0x559cc2=_0x36ae2b(0x165)+_0x179270+_0x36ae2b(0x208);for(const [_0x2b329b,_0x5055cd]of Object['entries'](_0x5c1a75)){_0x5055cd!==null&&_0x5055cd!==undefined&&(_0x559cc2+=_0x2b329b+_0x36ae2b(0x18d)+_0x5055cd+'`\x0a');}await this[_0x36ae2b(0x1a5)](_0x64b744,_0x559cc2,{'parse_mode':_0x36ae2b(0x198)});}['getBotInfo'](){const _0x28f2c3=a52_0x2b439c;return{'isActive':!!this['bot'],'username':this[_0x28f2c3(0x1b6)]};}['stopBot'](){const _0x26b5e9=a52_0x2b439c;this[_0x26b5e9(0x183)]&&(this[_0x26b5e9(0x183)][_0x26b5e9(0x219)](),this[_0x26b5e9(0x183)]=null,console[_0x26b5e9(0x1d9)](_0x26b5e9(0x1a0)));}}exports[a52_0x2b439c(0x199)]=TelegramBotService,exports[a52_0x2b439c(0x195)]=new TelegramBotService();