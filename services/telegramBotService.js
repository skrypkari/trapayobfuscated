'use strict';const a54_0x4a5b1e=a54_0x424b;(function(_0x4f7bc7,_0x46b616){const _0x4bf4fb=a54_0x424b,_0x4502ea=_0x4f7bc7();while(!![]){try{const _0x118fde=-parseInt(_0x4bf4fb(0x176))/0x1*(-parseInt(_0x4bf4fb(0xfb))/0x2)+parseInt(_0x4bf4fb(0x107))/0x3+parseInt(_0x4bf4fb(0x152))/0x4*(parseInt(_0x4bf4fb(0xba))/0x5)+-parseInt(_0x4bf4fb(0x13f))/0x6*(-parseInt(_0x4bf4fb(0x177))/0x7)+-parseInt(_0x4bf4fb(0xe2))/0x8*(parseInt(_0x4bf4fb(0xf8))/0x9)+-parseInt(_0x4bf4fb(0x10f))/0xa*(parseInt(_0x4bf4fb(0x125))/0xb)+-parseInt(_0x4bf4fb(0xeb))/0xc*(parseInt(_0x4bf4fb(0xc8))/0xd);if(_0x118fde===_0x46b616)break;else _0x4502ea['push'](_0x4502ea['shift']());}catch(_0x65845c){_0x4502ea['push'](_0x4502ea['shift']());}}}(a54_0x2de4,0x64ac3));function a54_0x424b(_0xb069de,_0x27b5c9){const _0x2de41f=a54_0x2de4();return a54_0x424b=function(_0x424b7b,_0xceed4){_0x424b7b=_0x424b7b-0xba;let _0x1515b2=_0x2de41f[_0x424b7b];return _0x1515b2;},a54_0x424b(_0xb069de,_0x27b5c9);}var __importDefault=this&&this[a54_0x4a5b1e(0x171)]||function(_0x33564b){const _0x1bb1fa=a54_0x4a5b1e;return _0x33564b&&_0x33564b[_0x1bb1fa(0x187)]?_0x33564b:{'default':_0x33564b};};Object['defineProperty'](exports,a54_0x4a5b1e(0x187),{'value':!![]}),exports[a54_0x4a5b1e(0x12a)]=exports[a54_0x4a5b1e(0x134)]=void 0x0;function a54_0x2de4(){const _0x200146=['TelegramBotService','length','gateway','✅\x20Telegram\x20user\x20','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','pk_','sendShopNotification','📅\x20Date:\x20','ipAddress','Available\x20usernames:\x0a','\x20(@','3789498iGPOYv','🔔\x20*','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','🆔\x20Payment\x20ID:\x20`','👤\x20Username:\x20`','Successful\x20login','create','New\x20payment\x20created','...`\x0a\x0a','findUnique','text','...','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','Payout\x20completed','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','initializeBot','\x0a👤\x20*Customer\x20Information:*\x0a','bot','method','1052776NCGrXO','update','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','•\x20Payouts\x0a\x0a','Commands:\x0a','message','userAgent','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','*\x0a\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','•\x20`','🏪\x20Gateway:\x20`','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','📛\x20Name:\x20`','To\x20reconnect,\x20use\x20the\x20/start\x20command','customerIp','Payment\x20is\x20being\x20processed','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','shopSettings','publicKey','📱\x20Your\x20Telegram\x20ID:\x20`','forEach','getGatewayDisplayNameForTelegram',':\x20username=\x22','last_name','setupBotHandlers','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','💻\x20Browser:\x20`','sendApiErrorNotification','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','isVerified','__importDefault','/status\x20-\x20check\x20connection\x20status\x0a','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','\x20USDT*\x0a','Use\x20/start\x20to\x20connect.','1rzDGme','7WnXwvj','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','processing','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','Error\x20handling\x20/status\x20command:','\x20initialized\x20successfully','\x20via\x20single-line\x20input','\x20USD*\x0a','\x20\x20\x20Status:\x20','\x0aCheck\x20spelling\x20and\x20try\x20again.','Use\x20/start\x20to\x20begin.','`\x20(','•\x20Payment\x20status\x20changes\x0a','success','🔗\x20Endpoint:\x20`','__esModule','📝\x20Notes:\x20','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','shopId','customerUa','🚨\x20*API\x20Error*\x0a\x0a',':\x20`','stopPolling','toLocaleDateString','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','`\x0a\x0a','📱\x20Shop:\x20*','📊\x20Error\x20code:\x20`','orderId','name','sendCustomNotification','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','🔌\x20User\x20','Error\x20sending\x20shop\x20notification:','Telegram\x20bot\x20error:','Payment\x20failed','Failed\x20login\x20attempt','stopBot','sendMessage','TELEGRAM_BOT_TOKEN','secretKey','📊\x20*Connection\x20Status*\x0a\x0a','username','📅\x20Time:\x20','`\x20is\x20inactive.\x0a\x0a','Failed\x20to\x20send\x20API\x20error\x20notification:','📝\x20Order\x20ID:\x20`','❌\x20Shop\x20`','5pMIVWS','log','New\x20payout\x20created','Payout\x20rejected','toString','findMany','createdAt','endpoint','sendPayoutNotification','botUsername','findFirst','✅\x20Telegram\x20bot\x20@','map','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','91knNOgs','txid','toLocaleString','🛑\x20Telegram\x20bot\x20stopped','Contact\x20administrator.','❌\x20Please\x20use\x20/start\x20command\x20first','🎉\x20*Congratulations!*\x0a\x0a','includes','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','error','❌\x20Shop\x20with\x20username\x20`','notificationLogin','`\x20not\x20found.\x0a\x0a','📧\x20Email:\x20`','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','first_name','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','•\x20Payouts\x0a','from','telegramId','allSettled','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','chargebackAmount','notificationApiError','8WUBFcy','updatedAt','substring','telegramUser','sendPaymentNotification','Error\x20in\x20handleSingleLineVerification:','📱\x20Created\x20new\x20Telegram\x20user:\x20','❌\x20Error:\x20`','handleSingleLineVerification','862572mqDFAI','🏪\x20Available\x20shops\x20in\x20system:\x0a','🏦\x20IBAN:\x20`','🆔\x20Payout\x20ID:\x20`','test','chargeback','amount','polling_error','timestamp','User\x20','🔗\x20TXID:\x20`','You\x20sent\x20','🔔\x20Notifications\x20are\x20active\x0a\x0a','6717816ipymCQ','failed','en-US','164334ofROZq','user\x20is\x20deactivated','errorMessage','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','blocked','/disconnect\x20-\x20disconnect\x20from\x20notifications','chat\x20not\x20found','Payment\x20expired','join','chat','Error\x20handling\x20message:','2067873CxLDgD','📅\x20Connection\x20date:\x20','onText','Payment\x20refund','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','📱\x20Telegram\x20notification:\x20gateway\x20\x22','env','\x20disconnected\x20from\x20shop\x20','10xlintj','\x22,\x20apiKey=\x22','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','💸\x20Penalty\x20amount:\x20*','startsWith','Check\x20spelling\x20and\x20try\x20again.','trapay_bot','adminNotes','Example:\x0a','ACTIVE','default','status','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','🔔\x20You\x20receive\x20notifications\x20about:\x0a','botToken','unknown\x20shop','split','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','remitterIban','\x20parts:\x20','statusCode','47179IMVazJ','shop','•\x20New\x20payments\x0a','...\x22','🌐\x20IP\x20address:\x20`','telegramBotService','getBotInfo','sk_','🆔\x20Request\x20ID:\x20`','Markdown','requestId','customerName','warn','❌\x20Invalid\x20username\x20format:\x20`','💸\x20Amount:\x20*'];a54_0x2de4=function(){return _0x200146;};return a54_0x2de4();}const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require('../config/database')),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0xfdfb24=a54_0x4a5b1e;this[_0xfdfb24(0x150)]=null,this[_0xfdfb24(0x11e)]=process[_0xfdfb24(0x10d)][_0xfdfb24(0x19f)]||'',this[_0xfdfb24(0xc3)]=process['env']['TELEGRAM_BOT_USERNAME']||_0xfdfb24(0x116),this[_0xfdfb24(0x11e)]?this[_0xfdfb24(0x14e)]():console[_0xfdfb24(0x131)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a54_0x4a5b1e(0x14e)](){const _0x21522b=a54_0x4a5b1e;try{this[_0x21522b(0x150)]=new node_telegram_bot_api_1[(_0x21522b(0x11a))](this[_0x21522b(0x11e)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x21522b(0xbb)](_0x21522b(0xc5)+this[_0x21522b(0xc3)]+_0x21522b(0x17d));}catch(_0x2bfb7f){console[_0x21522b(0xd2)](_0x21522b(0x189),_0x2bfb7f);}}[a54_0x4a5b1e(0x16b)](){const _0x510a2d=a54_0x4a5b1e;if(!this[_0x510a2d(0x150)])return;this['bot'][_0x510a2d(0x109)](/\/start/,async _0x5242fa=>{const _0x1285a0=_0x510a2d,_0x120b89=_0x5242fa[_0x1285a0(0x105)]['id'],_0x5a4b6e=_0x5242fa[_0x1285a0(0xdc)]?.['id'][_0x1285a0(0xbe)](),_0x2360e5=_0x5242fa[_0x1285a0(0xdc)]?.[_0x1285a0(0x1a2)],_0x26d62e=_0x5242fa[_0x1285a0(0xdc)]?.[_0x1285a0(0xd9)],_0x58893b=_0x5242fa[_0x1285a0(0xdc)]?.[_0x1285a0(0x16a)];if(!_0x5a4b6e)return;try{let _0x12001f=await database_1[_0x1285a0(0x11a)][_0x1285a0(0xe5)]['findUnique']({'where':{'telegramId':_0x5a4b6e},'include':{'shop':!![]}});!_0x12001f?(_0x12001f=await database_1[_0x1285a0(0x11a)][_0x1285a0(0xe5)][_0x1285a0(0x145)]({'data':{'telegramId':_0x5a4b6e,'username':_0x2360e5,'firstName':_0x26d62e,'lastName':_0x58893b,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x1285a0(0xbb)](_0x1285a0(0xe8)+_0x5a4b6e+_0x1285a0(0x13e)+_0x2360e5+')')):_0x12001f=await database_1[_0x1285a0(0x11a)][_0x1285a0(0xe5)]['update']({'where':{'telegramId':_0x5a4b6e},'data':{'username':_0x2360e5,'firstName':_0x26d62e,'lastName':_0x58893b},'include':{'shop':!![]}}),_0x12001f[_0x1285a0(0x170)]&&_0x12001f[_0x1285a0(0x18a)]&&_0x12001f[_0x1285a0(0x126)]?await this[_0x1285a0(0x150)]?.['sendMessage'](_0x120b89,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x1285a0(0x111)+_0x12001f['shop'][_0x1285a0(0x195)]+'*\x0a')+('Username:\x20`'+_0x12001f[_0x1285a0(0x126)][_0x1285a0(0x1a2)]+_0x1285a0(0x191))+_0x1285a0(0x11d)+_0x1285a0(0x127)+'•\x20Payment\x20status\x20changes\x0a'+_0x1285a0(0x155)+_0x1285a0(0x156)+_0x1285a0(0x172)+_0x1285a0(0x101),{'parse_mode':_0x1285a0(0x12e)}):(_0x12001f[_0x1285a0(0x18a)]&&!_0x12001f[_0x1285a0(0x170)]&&(await database_1[_0x1285a0(0x11a)][_0x1285a0(0xe5)][_0x1285a0(0x153)]({'where':{'telegramId':_0x5a4b6e},'data':{'shopId':null,'isVerified':![]}}),console[_0x1285a0(0xbb)](_0x1285a0(0xdf)+_0x5a4b6e)),await this[_0x1285a0(0x150)]?.[_0x1285a0(0x19e)](_0x120b89,_0x1285a0(0xda)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x1285a0(0xd8)+_0x1285a0(0x118)+_0x1285a0(0x154)+_0x1285a0(0x10b),{'parse_mode':_0x1285a0(0x12e)}));}catch(_0x435a67){console['error']('Error\x20handling\x20/start\x20command:',_0x435a67),await this[_0x1285a0(0x150)]?.[_0x1285a0(0x19e)](_0x120b89,_0x1285a0(0x173));}}),this[_0x510a2d(0x150)][_0x510a2d(0x109)](/\/disconnect/,async _0x633b3d=>{const _0x57264e=_0x510a2d,_0x312b61=_0x633b3d[_0x57264e(0x105)]['id'],_0x1ca8ca=_0x633b3d[_0x57264e(0xdc)]?.['id'][_0x57264e(0xbe)]();if(!_0x1ca8ca)return;try{const _0x3077a4=await database_1[_0x57264e(0x11a)][_0x57264e(0xe5)][_0x57264e(0x148)]({'where':{'telegramId':_0x1ca8ca},'include':{'shop':!![]}});if(!_0x3077a4||!_0x3077a4[_0x57264e(0x170)]||!_0x3077a4[_0x57264e(0x18a)]){await this[_0x57264e(0x150)]?.[_0x57264e(0x19e)](_0x312b61,_0x57264e(0x11c));return;}const _0x2e92e6=_0x3077a4[_0x57264e(0x126)]?.[_0x57264e(0x195)]||_0x57264e(0x11f);await database_1[_0x57264e(0x11a)][_0x57264e(0xe5)][_0x57264e(0x153)]({'where':{'telegramId':_0x1ca8ca},'data':{'shopId':null,'isVerified':![]}}),console[_0x57264e(0xbb)](_0x57264e(0x198)+_0x1ca8ca+_0x57264e(0x10e)+_0x3077a4[_0x57264e(0x18a)]),await this[_0x57264e(0x150)]?.[_0x57264e(0x19e)](_0x312b61,_0x57264e(0xff)+_0x2e92e6+'*.\x0a\x0a'+_0x57264e(0x160),{'parse_mode':'Markdown'});}catch(_0xded9d){console[_0x57264e(0xd2)]('Error\x20handling\x20/disconnect\x20command:',_0xded9d),await this[_0x57264e(0x150)]?.[_0x57264e(0x19e)](_0x312b61,_0x57264e(0x173));}}),this['bot'][_0x510a2d(0x109)](/\/status/,async _0x3c91c5=>{const _0x1f8a8d=_0x510a2d,_0x47587c=_0x3c91c5['chat']['id'],_0x21f131=_0x3c91c5['from']?.['id']['toString']();if(!_0x21f131)return;try{const _0x52618e=await database_1[_0x1f8a8d(0x11a)]['telegramUser']['findUnique']({'where':{'telegramId':_0x21f131},'include':{'shop':!![]}});if(!_0x52618e){await this[_0x1f8a8d(0x150)]?.[_0x1f8a8d(0x19e)](_0x47587c,_0x1f8a8d(0x15b)+_0x1f8a8d(0x182));return;}if(!_0x52618e[_0x1f8a8d(0x170)]||!_0x52618e['shopId']||!_0x52618e[_0x1f8a8d(0x126)]){await this[_0x1f8a8d(0x150)]?.[_0x1f8a8d(0x19e)](_0x47587c,_0x1f8a8d(0x17a)+_0x1f8a8d(0x175));return;}await this[_0x1f8a8d(0x150)]?.[_0x1f8a8d(0x19e)](_0x47587c,_0x1f8a8d(0x1a1)+('✅\x20Connected\x20to\x20shop:\x20*'+_0x52618e['shop'][_0x1f8a8d(0x195)]+'*\x0a')+('👤\x20Username:\x20`'+_0x52618e['shop'][_0x1f8a8d(0x1a2)]+'`\x0a')+(_0x1f8a8d(0x108)+_0x52618e[_0x1f8a8d(0xe3)][_0x1f8a8d(0x18f)]('en-US')+'\x0a\x0a')+_0x1f8a8d(0xf7)+_0x1f8a8d(0x156)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x1f8a8d(0x12e)});}catch(_0x311128){console[_0x1f8a8d(0xd2)](_0x1f8a8d(0x17c),_0x311128),await this[_0x1f8a8d(0x150)]?.[_0x1f8a8d(0x19e)](_0x47587c,_0x1f8a8d(0x173));}}),this[_0x510a2d(0x150)]['onText'](/\/debug/,async _0x4c0634=>{const _0x58a69f=_0x510a2d,_0x14cfa1=_0x4c0634[_0x58a69f(0x105)]['id'],_0x5bfa9d=_0x4c0634[_0x58a69f(0xdc)]?.['id'][_0x58a69f(0xbe)]();if(!_0x5bfa9d)return;try{const _0x41a0ac=await database_1[_0x58a69f(0x11a)][_0x58a69f(0x126)][_0x58a69f(0xbf)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x334259='🔍\x20*Debug\x20Information*\x0a\x0a';_0x334259+=_0x58a69f(0x166)+_0x5bfa9d+'`\x0a\x0a',_0x334259+=_0x58a69f(0xec),_0x41a0ac[_0x58a69f(0x167)]((_0x2f8c6e,_0x3bbc45)=>{const _0x4c66e0=_0x58a69f;_0x334259+=_0x3bbc45+0x1+'.\x20*'+_0x2f8c6e[_0x4c66e0(0x195)]+'*\x0a',_0x334259+='\x20\x20\x20Username:\x20`'+_0x2f8c6e[_0x4c66e0(0x1a2)]+'`\x0a',_0x334259+=_0x4c66e0(0x180)+_0x2f8c6e[_0x4c66e0(0x11b)]+'\x0a',_0x334259+='\x20\x20\x20Public\x20Key:\x20`'+_0x2f8c6e[_0x4c66e0(0x165)][_0x4c66e0(0xe4)](0x0,0xf)+_0x4c66e0(0x147);}),await this[_0x58a69f(0x150)]?.[_0x58a69f(0x19e)](_0x14cfa1,_0x334259,{'parse_mode':_0x58a69f(0x12e)});}catch(_0x12441a){console[_0x58a69f(0xd2)]('Error\x20handling\x20/debug\x20command:',_0x12441a),await this[_0x58a69f(0x150)]?.[_0x58a69f(0x19e)](_0x14cfa1,'❌\x20Error\x20getting\x20debug\x20information.');}}),this['bot']['on'](_0x510a2d(0x157),async _0x29314c=>{const _0x5592dc=_0x510a2d;if(_0x29314c['text']?.[_0x5592dc(0x114)]('/'))return;const _0x24d0ad=_0x29314c[_0x5592dc(0x105)]['id'],_0x17d8a0=_0x29314c['from']?.['id'][_0x5592dc(0xbe)](),_0x1bd0cc=_0x29314c[_0x5592dc(0x149)]?.['trim']();if(!_0x17d8a0||!_0x1bd0cc)return;try{const _0x4d9b9d=await database_1['default'][_0x5592dc(0xe5)][_0x5592dc(0x148)]({'where':{'telegramId':_0x17d8a0},'include':{'shop':!![]}});if(!_0x4d9b9d){await this[_0x5592dc(0x150)]?.['sendMessage'](_0x24d0ad,_0x5592dc(0xcd));return;}if(_0x4d9b9d[_0x5592dc(0x170)]&&_0x4d9b9d[_0x5592dc(0x18a)]&&_0x4d9b9d['shop']){await this[_0x5592dc(0x150)]?.[_0x5592dc(0x19e)](_0x24d0ad,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x4d9b9d[_0x5592dc(0x126)][_0x5592dc(0x195)]+'*.\x0a\x0a'+_0x5592dc(0x16f),{'parse_mode':_0x5592dc(0x12e)});return;}const _0x123339=_0x1bd0cc[_0x5592dc(0x120)](/\s+/);if(_0x123339[_0x5592dc(0x135)]!==0x2){await this[_0x5592dc(0x150)]?.[_0x5592dc(0x19e)](_0x24d0ad,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x5592dc(0x118)+_0x5592dc(0x154)+(_0x5592dc(0xf6)+_0x123339[_0x5592dc(0x135)]+_0x5592dc(0x123)+_0x123339[_0x5592dc(0xc6)](_0x531910=>'`'+_0x531910+'`')[_0x5592dc(0x104)](',\x20')),{'parse_mode':_0x5592dc(0x12e)});return;}const [_0x441883,_0x1a8a40]=_0x123339;console['log'](_0x5592dc(0x197)+_0x17d8a0+_0x5592dc(0x169)+_0x441883+_0x5592dc(0x110)+_0x1a8a40[_0x5592dc(0xe4)](0x0,0xa)+_0x5592dc(0x128)),await this[_0x5592dc(0xea)](_0x24d0ad,_0x17d8a0,_0x441883,_0x1a8a40);}catch(_0x110096){console[_0x5592dc(0xd2)](_0x5592dc(0x106),_0x110096),await this[_0x5592dc(0x150)]?.[_0x5592dc(0x19e)](_0x24d0ad,_0x5592dc(0x173));}}),this[_0x510a2d(0x150)]['on'](_0x510a2d(0xd2),_0x295239=>{const _0x50d64c=_0x510a2d;console[_0x50d64c(0xd2)](_0x50d64c(0x19a),_0x295239);}),this[_0x510a2d(0x150)]['on'](_0x510a2d(0xf2),_0x4764ec=>{const _0x4f6647=_0x510a2d;console[_0x4f6647(0xd2)]('Telegram\x20bot\x20polling\x20error:',_0x4764ec);});}async['handleSingleLineVerification'](_0x1aeff0,_0x124e5b,_0x2cd9b5,_0xbfca05){const _0x139594=a54_0x4a5b1e;try{console[_0x139594(0xbb)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x124e5b+_0x139594(0x169)+_0x2cd9b5+_0x139594(0x110)+_0xbfca05['substring'](0x0,0xa)+_0x139594(0x128));if(!_0x2cd9b5||_0x2cd9b5[_0x139594(0x135)]<0x3||_0x2cd9b5[_0x139594(0x135)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x139594(0xef)](_0x2cd9b5)){await this['bot']?.[_0x139594(0x19e)](_0x1aeff0,_0x139594(0x132)+_0x2cd9b5+'`\x0a\x0a'+_0x139594(0xd0),{'parse_mode':_0x139594(0x12e)});return;}if(!_0xbfca05||!_0xbfca05['startsWith'](_0x139594(0x139))&&!_0xbfca05[_0x139594(0x114)](_0x139594(0x12c))){await this[_0x139594(0x150)]?.['sendMessage'](_0x1aeff0,_0x139594(0x14d)+_0x139594(0x112),{'parse_mode':_0x139594(0x12e)});return;}const _0x293ce0=await database_1[_0x139594(0x11a)][_0x139594(0x126)][_0x139594(0x148)]({'where':{'username':_0x2cd9b5},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x293ce0){const _0x2c7339=await database_1[_0x139594(0x11a)][_0x139594(0x126)][_0x139594(0xbf)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x1fbb34=_0x139594(0xd3)+_0x2cd9b5+_0x139594(0xd5);_0x2c7339[_0x139594(0x135)]>0x0?(_0x1fbb34+=_0x139594(0x13d),_0x2c7339[_0x139594(0x167)](_0x40803e=>{const _0x5c05f6=_0x139594;_0x1fbb34+=_0x5c05f6(0x15c)+_0x40803e[_0x5c05f6(0x1a2)]+_0x5c05f6(0x183)+_0x40803e[_0x5c05f6(0x195)]+')\x0a';}),_0x1fbb34+=_0x139594(0x181)):_0x1fbb34+=_0x139594(0x115);await this[_0x139594(0x150)]?.[_0x139594(0x19e)](_0x1aeff0,_0x1fbb34,{'parse_mode':'Markdown'});return;}if(_0x293ce0[_0x139594(0x11b)]!==_0x139594(0x119)){await this[_0x139594(0x150)]?.[_0x139594(0x19e)](_0x1aeff0,_0x139594(0x1a7)+_0x2cd9b5+_0x139594(0x1a4)+_0x139594(0xcc),{'parse_mode':_0x139594(0x12e)});return;}if(_0x293ce0[_0x139594(0x165)]!==_0xbfca05&&_0x293ce0[_0x139594(0x1a0)]!==_0xbfca05){await this['bot']?.[_0x139594(0x19e)](_0x1aeff0,_0x139594(0xfe)+_0x2cd9b5+'`.\x0a\x0a'+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x139594(0xd1),{'parse_mode':_0x139594(0x12e)});return;}const _0x73351c=await database_1[_0x139594(0x11a)][_0x139594(0xe5)][_0x139594(0xc4)]({'where':{'shopId':_0x293ce0['id'],'isVerified':!![],'telegramId':{'not':_0x124e5b}}});if(_0x73351c){await this[_0x139594(0x150)]?.[_0x139594(0x19e)](_0x1aeff0,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x2cd9b5+'`.\x0a\x0a'+_0x139594(0x14b),{'parse_mode':_0x139594(0x12e)});return;}await database_1[_0x139594(0x11a)][_0x139594(0xe5)][_0x139594(0x153)]({'where':{'telegramId':_0x124e5b},'data':{'shopId':_0x293ce0['id'],'isVerified':!![]}}),await this[_0x139594(0x150)]?.['sendMessage'](_0x1aeff0,_0x139594(0xce)+_0x139594(0x159)+(_0x139594(0x192)+_0x293ce0['name']+'*\x0a')+('👤\x20Username:\x20`'+_0x293ce0[_0x139594(0x1a2)]+'`\x0a\x0a')+_0x139594(0x121)+_0x139594(0x127)+_0x139594(0x184)+_0x139594(0xdb)+'•\x20Important\x20events\x0a\x0a'+_0x139594(0x156)+_0x139594(0x172)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x139594(0x12e)}),console['log'](_0x139594(0x137)+_0x124e5b+'\x20verified\x20for\x20shop\x20'+_0x293ce0[_0x139594(0x1a2)]+_0x139594(0x17e));}catch(_0x3e4580){console[_0x139594(0xd2)](_0x139594(0xe7),_0x3e4580),await this[_0x139594(0x150)]?.[_0x139594(0x19e)](_0x1aeff0,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async['sendShopNotification'](_0x1bb7e9,_0x3db23b,_0x5996f2){const _0x4e6c14=a54_0x4a5b1e;if(!this[_0x4e6c14(0x150)]){console[_0x4e6c14(0x131)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x2890cc=await database_1[_0x4e6c14(0x11a)][_0x4e6c14(0xe5)][_0x4e6c14(0xbf)]({'where':{'shopId':_0x1bb7e9,'isVerified':!![]}});if(_0x2890cc[_0x4e6c14(0x135)]===0x0){console[_0x4e6c14(0xbb)](_0x4e6c14(0xc7)+_0x1bb7e9);return;}const _0x328884=_0x2890cc[_0x4e6c14(0xc6)](async _0x25b7bb=>{const _0x35cda7=_0x4e6c14;try{await this['bot']?.[_0x35cda7(0x19e)](_0x25b7bb[_0x35cda7(0xdd)],_0x3db23b,_0x5996f2),console[_0x35cda7(0xbb)](_0x35cda7(0x138)+_0x25b7bb[_0x35cda7(0xdd)]);}catch(_0x4126fc){console[_0x35cda7(0xd2)](_0x35cda7(0x178)+_0x25b7bb['telegramId']+':',_0x4126fc),_0x4126fc instanceof Error&&(_0x4126fc[_0x35cda7(0x157)]['includes'](_0x35cda7(0x100))||_0x4126fc['message']['includes'](_0x35cda7(0x102))||_0x4126fc[_0x35cda7(0x157)][_0x35cda7(0xcf)](_0x35cda7(0xfc)))&&(await database_1[_0x35cda7(0x11a)][_0x35cda7(0xe5)][_0x35cda7(0x153)]({'where':{'id':_0x25b7bb['id']},'data':{'isVerified':![]}}),console[_0x35cda7(0xbb)](_0x35cda7(0xf4)+_0x25b7bb[_0x35cda7(0xdd)]+_0x35cda7(0x163)));}});await Promise[_0x4e6c14(0xde)](_0x328884);}catch(_0x115790){console[_0x4e6c14(0xd2)](_0x4e6c14(0x199),_0x115790);}}async[a54_0x4a5b1e(0xe6)](_0x52eec2,_0x28f22d,_0x5be88a){const _0x1f7b5a=a54_0x4a5b1e,_0xb35d8c={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x29cd48={'created':_0x1f7b5a(0x146),'paid':'Payment\x20successfully\x20paid','failed':_0x1f7b5a(0x19b),'expired':_0x1f7b5a(0x103),'refund':_0x1f7b5a(0x10a),'chargeback':'Payment\x20chargeback','processing':_0x1f7b5a(0x162)},_0x414ec9=_0xb35d8c[_0x5be88a],_0x26e03a=_0x29cd48[_0x5be88a],_0x34eef7=(0x0,gateway_1[_0x1f7b5a(0x168)])(_0x28f22d[_0x1f7b5a(0x136)]);console[_0x1f7b5a(0xbb)](_0x1f7b5a(0x10c)+_0x28f22d['gateway']+'\x22\x20->\x20display\x20\x22'+_0x34eef7+'\x22');let _0x1c515b=_0x414ec9+'\x20*'+_0x26e03a+_0x1f7b5a(0x15a)+('💰\x20Amount:\x20*'+_0x28f22d[_0x1f7b5a(0xf1)]+'\x20'+_0x28f22d['currency']+'*\x0a')+(_0x1f7b5a(0x1a6)+(_0x28f22d[_0x1f7b5a(0x194)]||_0x28f22d['id'])+'`\x0a')+(_0x1f7b5a(0x142)+_0x28f22d['id']+'`\x0a')+(_0x1f7b5a(0x15d)+_0x34eef7+'`\x0a')+(_0x1f7b5a(0x13b)+new Date(_0x28f22d[_0x1f7b5a(0xc0)])[_0x1f7b5a(0xca)](_0x1f7b5a(0xfa))+'\x0a');if(_0x28f22d['customerName']||_0x28f22d['customerEmail']||_0x28f22d['remitterIban']||_0x28f22d[_0x1f7b5a(0x161)]||_0x28f22d[_0x1f7b5a(0x18b)]){_0x1c515b+=_0x1f7b5a(0x14f);_0x28f22d[_0x1f7b5a(0x130)]&&(_0x1c515b+=_0x1f7b5a(0x15f)+_0x28f22d[_0x1f7b5a(0x130)]+'`\x0a');_0x28f22d['customerEmail']&&(_0x1c515b+=_0x1f7b5a(0xd6)+_0x28f22d['customerEmail']+'`\x0a');_0x28f22d[_0x1f7b5a(0x122)]&&(_0x1c515b+=_0x1f7b5a(0xed)+_0x28f22d[_0x1f7b5a(0x122)]+'`\x0a');_0x28f22d[_0x1f7b5a(0x161)]&&(_0x1c515b+='🌐\x20IP:\x20`'+_0x28f22d[_0x1f7b5a(0x161)]+'`\x0a');if(_0x28f22d['customerUa']){const _0x36e745=_0x28f22d[_0x1f7b5a(0x18b)][_0x1f7b5a(0x135)]>0x32?_0x28f22d[_0x1f7b5a(0x18b)][_0x1f7b5a(0xe4)](0x0,0x32)+_0x1f7b5a(0x14a):_0x28f22d[_0x1f7b5a(0x18b)];_0x1c515b+=_0x1f7b5a(0x16d)+_0x36e745+'`\x0a';}}_0x5be88a===_0x1f7b5a(0xf0)&&_0x28f22d[_0x1f7b5a(0xe0)]&&(_0x1c515b+=_0x1f7b5a(0x113)+_0x28f22d['chargebackAmount']+_0x1f7b5a(0x174)),_0x5be88a===_0x1f7b5a(0x179)&&(_0x1c515b+=_0x1f7b5a(0x15e)),_0x28f22d[_0x1f7b5a(0x117)]&&(_0x1c515b+=_0x1f7b5a(0x188)+_0x28f22d[_0x1f7b5a(0x117)]+'\x0a'),await this[_0x1f7b5a(0x13a)](_0x52eec2,_0x1c515b,{'parse_mode':_0x1f7b5a(0x12e)});}async[a54_0x4a5b1e(0xc2)](_0x4cfe32,_0x38c891,_0x450291){const _0x4672a6=a54_0x4a5b1e,_0x48c337={'created':'📤','completed':'✅','rejected':'❌'},_0xf5811a={'created':_0x4672a6(0xbc),'completed':_0x4672a6(0x14c),'rejected':_0x4672a6(0xbd)},_0x1bb5e1=_0x48c337[_0x450291],_0x1d301b=_0xf5811a[_0x450291],_0x5cd5bf=_0x1bb5e1+'\x20*'+_0x1d301b+_0x4672a6(0x15a)+(_0x4672a6(0x133)+_0x38c891[_0x4672a6(0xf1)]+_0x4672a6(0x17f))+('🏦\x20Method:\x20`'+_0x38c891['method']+'`\x0a')+(_0x4672a6(0xee)+_0x38c891['id']+'`\x0a')+(_0x4672a6(0x13b)+new Date(_0x38c891[_0x4672a6(0xc0)])[_0x4672a6(0xca)](_0x4672a6(0xfa))+'\x0a')+(_0x38c891[_0x4672a6(0xc9)]?_0x4672a6(0xf5)+_0x38c891['txid']+'`':'');await this[_0x4672a6(0x13a)](_0x4cfe32,_0x5cd5bf,{'parse_mode':_0x4672a6(0x12e)});}async['sendLoginNotification'](_0x436f0d,_0x41a061){const _0x4dd42d=a54_0x4a5b1e;try{const _0x4b0434=await database_1['default'][_0x4dd42d(0x164)]['findUnique']({'where':{'shopId':_0x436f0d},'select':{'notificationLogin':!![]}});if(!_0x4b0434?.[_0x4dd42d(0xd4)]){console['log']('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x436f0d);return;}const _0x42fff7=_0x41a061[_0x4dd42d(0x185)]?'🔐':'🚨',_0x12c78a=_0x41a061[_0x4dd42d(0x185)]?_0x4dd42d(0x144):_0x4dd42d(0x19c);let _0x91d4ca=_0x42fff7+'\x20*'+_0x12c78a+_0x4dd42d(0x15a)+(_0x4dd42d(0x143)+_0x41a061['username']+'`\x0a')+(_0x4dd42d(0x1a3)+_0x41a061[_0x4dd42d(0xf3)]['toLocaleString'](_0x4dd42d(0xfa))+'\x0a');_0x41a061[_0x4dd42d(0x13c)]&&(_0x91d4ca+=_0x4dd42d(0x129)+_0x41a061[_0x4dd42d(0x13c)]+'`\x0a');if(_0x41a061[_0x4dd42d(0x158)]){const _0x5a2ae9=_0x41a061[_0x4dd42d(0x158)][_0x4dd42d(0x135)]>0x32?_0x41a061['userAgent'][_0x4dd42d(0xe4)](0x0,0x32)+_0x4dd42d(0x14a):_0x41a061[_0x4dd42d(0x158)];_0x91d4ca+=_0x4dd42d(0x16d)+_0x5a2ae9+'`\x0a';}!_0x41a061[_0x4dd42d(0x185)]&&(_0x91d4ca+=_0x4dd42d(0x16c)),await this[_0x4dd42d(0x13a)](_0x436f0d,_0x91d4ca,{'parse_mode':_0x4dd42d(0x12e)}),console[_0x4dd42d(0xbb)](_0x4dd42d(0x141)+_0x436f0d+':\x20'+(_0x41a061[_0x4dd42d(0x185)]?'success':_0x4dd42d(0xf9)));}catch(_0x3011f1){console[_0x4dd42d(0xd2)]('Failed\x20to\x20send\x20login\x20notification:',_0x3011f1);}}async[a54_0x4a5b1e(0x16e)](_0x45259a,_0x33f1b5){const _0x3acf76=a54_0x4a5b1e;try{const _0x477f6e=await database_1[_0x3acf76(0x11a)][_0x3acf76(0x164)][_0x3acf76(0x148)]({'where':{'shopId':_0x45259a},'select':{'notificationApiError':!![]}});if(!_0x477f6e?.[_0x3acf76(0xe1)]){console[_0x3acf76(0xbb)](_0x3acf76(0xd7)+_0x45259a);return;}let _0xabd574=_0x3acf76(0x18c)+(_0x3acf76(0x186)+_0x33f1b5[_0x3acf76(0x151)]+'\x20'+_0x33f1b5[_0x3acf76(0xc1)]+'`\x0a')+('📅\x20Time:\x20'+_0x33f1b5[_0x3acf76(0xf3)][_0x3acf76(0xca)](_0x3acf76(0xfa))+'\x0a');_0x33f1b5[_0x3acf76(0x124)]&&(_0xabd574+=_0x3acf76(0x193)+_0x33f1b5[_0x3acf76(0x124)]+'`\x0a'),_0xabd574+=_0x3acf76(0xe9)+_0x33f1b5[_0x3acf76(0xfd)]+'`\x0a',_0x33f1b5[_0x3acf76(0x12f)]&&(_0xabd574+=_0x3acf76(0x12d)+_0x33f1b5[_0x3acf76(0x12f)]+'`\x0a'),_0xabd574+=_0x3acf76(0x17b),await this[_0x3acf76(0x13a)](_0x45259a,_0xabd574,{'parse_mode':'Markdown'}),console[_0x3acf76(0xbb)](_0x3acf76(0x190)+_0x45259a+':\x20'+_0x33f1b5['endpoint']);}catch(_0x278e6c){console[_0x3acf76(0xd2)](_0x3acf76(0x1a5),_0x278e6c);}}async[a54_0x4a5b1e(0x196)](_0x1fce37,_0x2c9d74,_0x392cd7){const _0x5ba03c=a54_0x4a5b1e;let _0x3c62ca=_0x5ba03c(0x140)+_0x2c9d74+'*\x0a\x0a';for(const [_0x1cfe12,_0x602c6d]of Object['entries'](_0x392cd7)){_0x602c6d!==null&&_0x602c6d!==undefined&&(_0x3c62ca+=_0x1cfe12+_0x5ba03c(0x18d)+_0x602c6d+'`\x0a');}await this['sendShopNotification'](_0x1fce37,_0x3c62ca,{'parse_mode':_0x5ba03c(0x12e)});}[a54_0x4a5b1e(0x12b)](){const _0x4cfd28=a54_0x4a5b1e;return{'isActive':!!this[_0x4cfd28(0x150)],'username':this[_0x4cfd28(0xc3)]};}[a54_0x4a5b1e(0x19d)](){const _0x57e21b=a54_0x4a5b1e;this['bot']&&(this[_0x57e21b(0x150)][_0x57e21b(0x18e)](),this[_0x57e21b(0x150)]=null,console['log'](_0x57e21b(0xcb)));}}exports['TelegramBotService']=TelegramBotService,exports[a54_0x4a5b1e(0x12a)]=new TelegramBotService();