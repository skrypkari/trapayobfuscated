'use strict';const a63_0x471cd1=a63_0x2a89;(function(_0x58d3d3,_0x51dc34){const _0x2a40e5=a63_0x2a89,_0x3fee4c=_0x58d3d3();while(!![]){try{const _0x277260=-parseInt(_0x2a40e5(0xd3))/0x1+-parseInt(_0x2a40e5(0xeb))/0x2+-parseInt(_0x2a40e5(0xd2))/0x3+parseInt(_0x2a40e5(0x144))/0x4+-parseInt(_0x2a40e5(0xe7))/0x5+parseInt(_0x2a40e5(0xfc))/0x6+parseInt(_0x2a40e5(0xcc))/0x7*(parseInt(_0x2a40e5(0x155))/0x8);if(_0x277260===_0x51dc34)break;else _0x3fee4c['push'](_0x3fee4c['shift']());}catch(_0x5921f8){_0x3fee4c['push'](_0x3fee4c['shift']());}}}(a63_0x146e,0xc1a97));function a63_0x146e(){const _0x403066=['❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','bot','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','❌\x20Error\x20sending\x20direct\x20message:','orderId','•\x20Important\x20events\x0a\x0a','3920418zHxamA','.\x20*','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','timestamp','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Use\x20/start\x20to\x20connect.','currency','✅\x20Connected\x20to\x20shop:\x20*','unknown\x20shop','📱\x20Shop:\x20*','setupBotHandlers','startsWith','initializeBot','💸\x20Penalty\x20amount:\x20*','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','update','__importDefault','.jpg','•\x20`','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','telegramId','remitterIban','publicKey','image/jpeg','\x20\x20\x20Public\x20Key:\x20`','last_name','📅\x20Connection\x20date:\x20','botToken','notificationApiError','sk_','Markdown','Payout\x20rejected','toString','shop','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','...','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','split','Telegram\x20bot\x20polling\x20error:','❌\x20Telegram\x20bot\x20not\x20initialized','name','create','🔍\x20*Debug\x20Information*\x0a\x0a','shopId','To\x20reconnect,\x20use\x20the\x20/start\x20command','method','.png','Failed\x20to\x20send\x20login\x20notification:','default','sendApiErrorNotification','Example:\x0a','🌐\x20IP\x20address:\x20`','sendCustomNotification','sendMessage','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','Error\x20sending\x20shop\x20notification:','•\x20Payment\x20status\x20changes\x0a','Payment\x20chargeback','❌\x20Error\x20sending\x20file\x20to\x20chat:','📝\x20Order\x20ID:\x20`','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`',':\x20username=\x22','findUnique','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','telegramUser','Failed\x20to\x20send\x20API\x20error\x20notification:','•\x20New\x20payments\x0a','TELEGRAM_BOT_TOKEN','polling_error','customerIp','substring','1739532zsGqwu','Telegram\x20bot\x20error:','📊\x20*Connection\x20Status*\x0a\x0a','customerUa','botUsername','test','*\x0a\x0a','log','\x22\x20->\x20display\x20\x22','Error\x20in\x20handleSingleLineVerification:','toLocaleString','join','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','username','findFirst','/disconnect\x20-\x20disconnect\x20from\x20notifications','message','4449496luOWka','💸\x20Amount:\x20*','node-telegram-bot-api','sendDirectFile','warn','pk_','Available\x20usernames:\x0a','endsWith','\x20parts:\x20','Username:\x20`','trim','...`\x0a\x0a','\x20users','...\x22','updatedAt','Payment\x20successfully\x20paid','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','text','📱\x20Telegram\x20notification:\x20gateway\x20\x22','forEach','❌\x20Error\x20sending\x20file\x20to\x20user\x20','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','shopSettings','👤\x20Username:\x20`','🏦\x20Method:\x20`','getBotInfo','map','statusCode','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','sendPayoutNotification','status','error','🔗\x20TXID:\x20`','🏦\x20IBAN:\x20`','🔔\x20*','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','sendDocument','📧\x20Email:\x20`','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','•\x20Payouts\x0a\x0a','Commands:\x0a','❌\x20Invalid\x20username\x20format:\x20`','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','sendShopNotification','`\x20not\x20found.\x0a\x0a','createdAt',':\x20`','chargebackAmount','\x20\x20\x20Username:\x20`','sendNotificationToAll','\x20USDT*\x0a','📅\x20Date:\x20','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','sendLoginNotification','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','🔔\x20Notifications\x20are\x20active\x0a\x0a','isVerified','📅\x20Time:\x20','success','\x0a👤\x20*Customer\x20Information:*\x0a','amount','findMany','TelegramBotService','You\x20sent\x20','blocked','errorMessage','endpoint','../types/gateway','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','processing','/status\x20-\x20check\x20connection\x20status\x0a','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','__esModule','\x20verified\x20for\x20shop\x20','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','toLocaleDateString','adminNotes','txid','💻\x20Browser:\x20`','chat','requestId','allSettled','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','❌\x20Error:\x20`','length','customerName','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Payment\x20refund','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','includes','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','sendPaymentNotification','customerEmail','from','\x0aCheck\x20spelling\x20and\x20try\x20again.','Successful\x20login','56KGOXcP','\x20initialized\x20successfully','Error\x20handling\x20/status\x20command:','env','🛑\x20Telegram\x20bot\x20stopped','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','3778602LZfyGA','1213522SgZpDA','application/octet-stream','.jpeg','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','telegramBotService','`\x0a\x0a','✅\x20Telegram\x20user\x20','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','secretKey','stopPolling','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','`.\x0a\x0a','handleSingleLineVerification','Contact\x20administrator.','user\x20is\x20deactivated','🆔\x20Payment\x20ID:\x20`','Error\x20handling\x20/start\x20command:','.pdf','📛\x20Name:\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a','6672485NfSgOu','sendDirectMessage','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','\x20\x20\x20Status:\x20','1873980QFggYF','📝\x20Notes:\x20','userAgent','🎉\x20*Congratulations!*\x0a\x0a','defineProperty','onText','en-US','\x20(@','🔌\x20User\x20','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification'];a63_0x146e=function(){return _0x403066;};return a63_0x146e();}var __importDefault=this&&this[a63_0x471cd1(0x10c)]||function(_0x3a0e67){const _0x1c20b8=a63_0x471cd1;return _0x3a0e67&&_0x3a0e67[_0x1c20b8(0xb3)]?_0x3a0e67:{'default':_0x3a0e67};};Object[a63_0x471cd1(0xef)](exports,a63_0x471cd1(0xb3),{'value':!![]}),exports[a63_0x471cd1(0xd7)]=exports[a63_0x471cd1(0x195)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a63_0x471cd1(0x157))),database_1=__importDefault(require('../config/database')),gateway_1=require(a63_0x471cd1(0xae));class TelegramBotService{constructor(){const _0x4af016=a63_0x471cd1;this[_0x4af016(0xf6)]=null,this[_0x4af016(0x117)]=process[_0x4af016(0xcf)][_0x4af016(0x140)]||'',this[_0x4af016(0x148)]=process['env']['TELEGRAM_BOT_USERNAME']||'trapay_bot',this[_0x4af016(0x117)]?this[_0x4af016(0x108)]():console[_0x4af016(0x159)](_0x4af016(0x18d));}[a63_0x471cd1(0x108)](){const _0x1e5b21=a63_0x471cd1;try{this[_0x1e5b21(0xf6)]=new node_telegram_bot_api_1[(_0x1e5b21(0x12c))](this[_0x1e5b21(0x117)],{'polling':!![]}),this[_0x1e5b21(0x106)](),console[_0x1e5b21(0x14b)]('✅\x20Telegram\x20bot\x20@'+this[_0x1e5b21(0x148)]+_0x1e5b21(0xcd));}catch(_0x1ab92c){console[_0x1e5b21(0x174)](_0x1e5b21(0xda),_0x1ab92c);}}['setupBotHandlers'](){const _0x2e0332=a63_0x471cd1;if(!this[_0x2e0332(0xf6)])return;this[_0x2e0332(0xf6)][_0x2e0332(0xf0)](/\/start/,async _0x2ae2ff=>{const _0x5f222c=_0x2e0332,_0x22222a=_0x2ae2ff[_0x5f222c(0xba)]['id'],_0x51f9a5=_0x2ae2ff['from']?.['id'][_0x5f222c(0x11c)](),_0x410cb0=_0x2ae2ff[_0x5f222c(0xc9)]?.[_0x5f222c(0x151)],_0x14273c=_0x2ae2ff[_0x5f222c(0xc9)]?.['first_name'],_0x48ea15=_0x2ae2ff[_0x5f222c(0xc9)]?.[_0x5f222c(0x115)];if(!_0x51f9a5)return;try{let _0x348b5a=await database_1[_0x5f222c(0x12c)][_0x5f222c(0x13d)][_0x5f222c(0x13b)]({'where':{'telegramId':_0x51f9a5},'include':{'shop':!![]}});!_0x348b5a?(_0x348b5a=await database_1[_0x5f222c(0x12c)][_0x5f222c(0x13d)][_0x5f222c(0x125)]({'data':{'telegramId':_0x51f9a5,'username':_0x410cb0,'firstName':_0x14273c,'lastName':_0x48ea15,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x5f222c(0x14b)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x51f9a5+_0x5f222c(0xf2)+_0x410cb0+')')):_0x348b5a=await database_1[_0x5f222c(0x12c)][_0x5f222c(0x13d)][_0x5f222c(0x10b)]({'where':{'telegramId':_0x51f9a5},'data':{'username':_0x410cb0,'firstName':_0x14273c,'lastName':_0x48ea15},'include':{'shop':!![]}}),_0x348b5a['isVerified']&&_0x348b5a[_0x5f222c(0x127)]&&_0x348b5a[_0x5f222c(0x11d)]?await this['bot']?.[_0x5f222c(0x131)](_0x22222a,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x5f222c(0xdd)+_0x348b5a['shop'][_0x5f222c(0x124)]+'*\x0a')+(_0x5f222c(0x15e)+_0x348b5a['shop'][_0x5f222c(0x151)]+_0x5f222c(0xd8))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x5f222c(0x13f)+'•\x20Payment\x20status\x20changes\x0a'+_0x5f222c(0x17e)+_0x5f222c(0x17f)+_0x5f222c(0xb1)+_0x5f222c(0x153),{'parse_mode':_0x5f222c(0x11a)}):(_0x348b5a['shopId']&&!_0x348b5a[_0x5f222c(0x18f)]&&(await database_1['default'][_0x5f222c(0x13d)]['update']({'where':{'telegramId':_0x51f9a5},'data':{'shopId':null,'isVerified':![]}}),console[_0x5f222c(0x14b)](_0x5f222c(0x165)+_0x51f9a5)),await this[_0x5f222c(0xf6)]?.[_0x5f222c(0x131)](_0x22222a,_0x5f222c(0xf7)+_0x5f222c(0x132)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x5f222c(0x12e)+_0x5f222c(0x16a)+_0x5f222c(0xf5),{'parse_mode':_0x5f222c(0x11a)}));}catch(_0x5f241d){console[_0x5f222c(0x174)](_0x5f222c(0xe3),_0x5f241d),await this[_0x5f222c(0xf6)]?.['sendMessage'](_0x22222a,_0x5f222c(0x150));}}),this[_0x2e0332(0xf6)]['onText'](/\/disconnect/,async _0xc52448=>{const _0xe7e5fa=_0x2e0332,_0x52fcdc=_0xc52448['chat']['id'],_0x423d74=_0xc52448[_0xe7e5fa(0xc9)]?.['id'][_0xe7e5fa(0x11c)]();if(!_0x423d74)return;try{const _0x527027=await database_1[_0xe7e5fa(0x12c)][_0xe7e5fa(0x13d)][_0xe7e5fa(0x13b)]({'where':{'telegramId':_0x423d74},'include':{'shop':!![]}});if(!_0x527027||!_0x527027['isVerified']||!_0x527027[_0xe7e5fa(0x127)]){await this[_0xe7e5fa(0xf6)]?.[_0xe7e5fa(0x131)](_0x52fcdc,_0xe7e5fa(0x171));return;}const _0x5e7d64=_0x527027[_0xe7e5fa(0x11d)]?.[_0xe7e5fa(0x124)]||_0xe7e5fa(0x104);await database_1[_0xe7e5fa(0x12c)][_0xe7e5fa(0x13d)][_0xe7e5fa(0x10b)]({'where':{'telegramId':_0x423d74},'data':{'shopId':null,'isVerified':![]}}),console[_0xe7e5fa(0x14b)](_0xe7e5fa(0xf3)+_0x423d74+'\x20disconnected\x20from\x20shop\x20'+_0x527027[_0xe7e5fa(0x127)]),await this['bot']?.[_0xe7e5fa(0x131)](_0x52fcdc,_0xe7e5fa(0x11e)+_0x5e7d64+'*.\x0a\x0a'+_0xe7e5fa(0x128),{'parse_mode':_0xe7e5fa(0x11a)});}catch(_0xbb4a4b){console[_0xe7e5fa(0x174)]('Error\x20handling\x20/disconnect\x20command:',_0xbb4a4b),await this[_0xe7e5fa(0xf6)]?.['sendMessage'](_0x52fcdc,_0xe7e5fa(0x150));}}),this[_0x2e0332(0xf6)][_0x2e0332(0xf0)](/\/status/,async _0xe58030=>{const _0x360349=_0x2e0332,_0x2289bd=_0xe58030[_0x360349(0xba)]['id'],_0x14905f=_0xe58030[_0x360349(0xc9)]?.['id'][_0x360349(0x11c)]();if(!_0x14905f)return;try{const _0x4c0941=await database_1[_0x360349(0x12c)]['telegramUser'][_0x360349(0x13b)]({'where':{'telegramId':_0x14905f},'include':{'shop':!![]}});if(!_0x4c0941){await this[_0x360349(0xf6)]?.[_0x360349(0x131)](_0x2289bd,_0x360349(0xc6)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x4c0941[_0x360349(0x18f)]||!_0x4c0941['shopId']||!_0x4c0941[_0x360349(0x11d)]){await this[_0x360349(0xf6)]?.[_0x360349(0x131)](_0x2289bd,_0x360349(0xd1)+_0x360349(0x101));return;}await this['bot']?.[_0x360349(0x131)](_0x2289bd,_0x360349(0x146)+(_0x360349(0x103)+_0x4c0941[_0x360349(0x11d)]['name']+'*\x0a')+('👤\x20Username:\x20`'+_0x4c0941['shop'][_0x360349(0x151)]+'`\x0a')+(_0x360349(0x116)+_0x4c0941[_0x360349(0x163)][_0x360349(0xb6)](_0x360349(0xf1))+'\x0a\x0a')+_0x360349(0x18e)+_0x360349(0x17f)+_0x360349(0x153),{'parse_mode':'Markdown'});}catch(_0x5a628b){console['error'](_0x360349(0xce),_0x5a628b),await this[_0x360349(0xf6)]?.[_0x360349(0x131)](_0x2289bd,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x2e0332(0xf6)][_0x2e0332(0xf0)](/\/debug/,async _0x4d9174=>{const _0x9cd127=_0x2e0332,_0x401030=_0x4d9174['chat']['id'],_0x29d118=_0x4d9174[_0x9cd127(0xc9)]?.['id']['toString']();if(!_0x29d118)return;try{const _0x1add78=await database_1['default'][_0x9cd127(0x11d)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x111ecb=_0x9cd127(0x126);_0x111ecb+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x29d118+_0x9cd127(0xd8),_0x111ecb+=_0x9cd127(0xe6),_0x1add78[_0x9cd127(0x168)]((_0x549ade,_0x271b2c)=>{const _0x12d6e3=_0x9cd127;_0x111ecb+=_0x271b2c+0x1+_0x12d6e3(0xfd)+_0x549ade[_0x12d6e3(0x124)]+'*\x0a',_0x111ecb+=_0x12d6e3(0x187)+_0x549ade[_0x12d6e3(0x151)]+'`\x0a',_0x111ecb+=_0x12d6e3(0xea)+_0x549ade[_0x12d6e3(0x173)]+'\x0a',_0x111ecb+=_0x12d6e3(0x114)+_0x549ade[_0x12d6e3(0x112)][_0x12d6e3(0x143)](0x0,0xf)+_0x12d6e3(0x160);}),await this['bot']?.['sendMessage'](_0x401030,_0x111ecb,{'parse_mode':_0x9cd127(0x11a)});}catch(_0x54e133){console[_0x9cd127(0x174)]('Error\x20handling\x20/debug\x20command:',_0x54e133),await this[_0x9cd127(0xf6)]?.['sendMessage'](_0x401030,'❌\x20Error\x20getting\x20debug\x20information.');}}),this['bot']['on'](_0x2e0332(0x154),async _0x2badf0=>{const _0x48f1d9=_0x2e0332;if(_0x2badf0['text']?.[_0x48f1d9(0x107)]('/'))return;const _0x207b12=_0x2badf0[_0x48f1d9(0xba)]['id'],_0x55f499=_0x2badf0[_0x48f1d9(0xc9)]?.['id'][_0x48f1d9(0x11c)](),_0x3eef90=_0x2badf0[_0x48f1d9(0x166)]?.[_0x48f1d9(0x15f)]();if(!_0x55f499||!_0x3eef90)return;try{const _0x27c86c=await database_1['default'][_0x48f1d9(0x13d)][_0x48f1d9(0x13b)]({'where':{'telegramId':_0x55f499},'include':{'shop':!![]}});if(!_0x27c86c){await this['bot']?.[_0x48f1d9(0x131)](_0x207b12,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x27c86c[_0x48f1d9(0x18f)]&&_0x27c86c[_0x48f1d9(0x127)]&&_0x27c86c['shop']){await this[_0x48f1d9(0xf6)]?.['sendMessage'](_0x207b12,_0x48f1d9(0x100)+_0x27c86c['shop'][_0x48f1d9(0x124)]+'*.\x0a\x0a'+_0x48f1d9(0x10f),{'parse_mode':_0x48f1d9(0x11a)});return;}const _0x13cfb8=_0x3eef90[_0x48f1d9(0x121)](/\s+/);if(_0x13cfb8[_0x48f1d9(0xbf)]!==0x2){await this[_0x48f1d9(0xf6)]?.[_0x48f1d9(0x131)](_0x207b12,_0x48f1d9(0x13c)+_0x48f1d9(0xb2)+_0x48f1d9(0x12e)+_0x48f1d9(0x16a)+(_0x48f1d9(0x196)+_0x13cfb8[_0x48f1d9(0xbf)]+_0x48f1d9(0x15d)+_0x13cfb8[_0x48f1d9(0x16f)](_0x3268fd=>'`'+_0x3268fd+'`')[_0x48f1d9(0x14f)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x49d6a4,_0x22e055]=_0x13cfb8;console[_0x48f1d9(0x14b)](_0x48f1d9(0xc2)+_0x55f499+_0x48f1d9(0x13a)+_0x49d6a4+'\x22,\x20apiKey=\x22'+_0x22e055[_0x48f1d9(0x143)](0x0,0xa)+_0x48f1d9(0x162)),await this[_0x48f1d9(0xdf)](_0x207b12,_0x55f499,_0x49d6a4,_0x22e055);}catch(_0x313bdb){console['error']('Error\x20handling\x20message:',_0x313bdb),await this['bot']?.[_0x48f1d9(0x131)](_0x207b12,_0x48f1d9(0x150));}}),this[_0x2e0332(0xf6)]['on'](_0x2e0332(0x174),_0x28fb8e=>{const _0x3d4610=_0x2e0332;console[_0x3d4610(0x174)](_0x3d4610(0x145),_0x28fb8e);}),this['bot']['on'](_0x2e0332(0x141),_0x32d35c=>{const _0x3d054c=_0x2e0332;console[_0x3d054c(0x174)](_0x3d054c(0x122),_0x32d35c);});}async['handleSingleLineVerification'](_0x22e8be,_0xb60a1a,_0x167ef5,_0x16a81f){const _0x5e4abe=a63_0x471cd1;try{console[_0x5e4abe(0x14b)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0xb60a1a+_0x5e4abe(0x13a)+_0x167ef5+'\x22,\x20apiKey=\x22'+_0x16a81f[_0x5e4abe(0x143)](0x0,0xa)+'...\x22');if(!_0x167ef5||_0x167ef5[_0x5e4abe(0xbf)]<0x3||_0x167ef5[_0x5e4abe(0xbf)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x5e4abe(0x149)](_0x167ef5)){await this[_0x5e4abe(0xf6)]?.[_0x5e4abe(0x131)](_0x22e8be,_0x5e4abe(0x180)+_0x167ef5+_0x5e4abe(0xd8)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x5e4abe(0x11a)});return;}if(!_0x16a81f||!_0x16a81f['startsWith'](_0x5e4abe(0x15a))&&!_0x16a81f[_0x5e4abe(0x107)](_0x5e4abe(0x119))){await this['bot']?.[_0x5e4abe(0x131)](_0x22e8be,_0x5e4abe(0xc1)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':'Markdown'});return;}const _0x45c0b7=await database_1[_0x5e4abe(0x12c)][_0x5e4abe(0x11d)][_0x5e4abe(0x13b)]({'where':{'username':_0x167ef5},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x45c0b7){const _0x428ddf=await database_1[_0x5e4abe(0x12c)]['shop'][_0x5e4abe(0x194)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x1b7d84='❌\x20Shop\x20with\x20username\x20`'+_0x167ef5+_0x5e4abe(0x183);_0x428ddf['length']>0x0?(_0x1b7d84+=_0x5e4abe(0x15b),_0x428ddf[_0x5e4abe(0x168)](_0x7ba12=>{const _0xebad76=_0x5e4abe;_0x1b7d84+=_0xebad76(0x10e)+_0x7ba12['username']+'`\x20('+_0x7ba12[_0xebad76(0x124)]+')\x0a';}),_0x1b7d84+=_0x5e4abe(0xca)):_0x1b7d84+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x5e4abe(0xf6)]?.[_0x5e4abe(0x131)](_0x22e8be,_0x1b7d84,{'parse_mode':'Markdown'});return;}if(_0x45c0b7[_0x5e4abe(0x173)]!=='ACTIVE'){await this[_0x5e4abe(0xf6)]?.[_0x5e4abe(0x131)](_0x22e8be,'❌\x20Shop\x20`'+_0x167ef5+'`\x20is\x20inactive.\x0a\x0a'+_0x5e4abe(0xe0),{'parse_mode':'Markdown'});return;}if(_0x45c0b7[_0x5e4abe(0x112)]!==_0x16a81f&&_0x45c0b7[_0x5e4abe(0xdb)]!==_0x16a81f){await this[_0x5e4abe(0xf6)]?.['sendMessage'](_0x22e8be,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x167ef5+_0x5e4abe(0xde)+_0x5e4abe(0x178)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x5e4abe(0x11a)});return;}const _0x4d0c23=await database_1[_0x5e4abe(0x12c)][_0x5e4abe(0x13d)][_0x5e4abe(0x152)]({'where':{'shopId':_0x45c0b7['id'],'isVerified':!![],'telegramId':{'not':_0xb60a1a}}});if(_0x4d0c23){await this['bot']?.['sendMessage'](_0x22e8be,_0x5e4abe(0x139)+_0x167ef5+_0x5e4abe(0xde)+_0x5e4abe(0x120),{'parse_mode':'Markdown'});return;}await database_1[_0x5e4abe(0x12c)][_0x5e4abe(0x13d)][_0x5e4abe(0x10b)]({'where':{'telegramId':_0xb60a1a},'data':{'shopId':_0x45c0b7['id'],'isVerified':!![]}}),await this[_0x5e4abe(0xf6)]?.[_0x5e4abe(0x131)](_0x22e8be,_0x5e4abe(0xee)+_0x5e4abe(0xd6)+(_0x5e4abe(0x105)+_0x45c0b7[_0x5e4abe(0x124)]+'*\x0a')+('👤\x20Username:\x20`'+_0x45c0b7[_0x5e4abe(0x151)]+_0x5e4abe(0xd8))+_0x5e4abe(0x17a)+'•\x20New\x20payments\x0a'+_0x5e4abe(0x135)+'•\x20Payouts\x0a'+_0x5e4abe(0xfb)+'Commands:\x0a'+_0x5e4abe(0xb1)+_0x5e4abe(0x153),{'parse_mode':'Markdown'}),console[_0x5e4abe(0x14b)](_0x5e4abe(0xd9)+_0xb60a1a+_0x5e4abe(0xb4)+_0x45c0b7[_0x5e4abe(0x151)]+'\x20via\x20single-line\x20input');}catch(_0x4f19da){console['error'](_0x5e4abe(0x14d),_0x4f19da),await this[_0x5e4abe(0xf6)]?.[_0x5e4abe(0x131)](_0x22e8be,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a63_0x471cd1(0x182)](_0x2299de,_0x426c0a,_0x41d8e1){const _0x323313=a63_0x471cd1;if(!this[_0x323313(0xf6)]){console[_0x323313(0x159)](_0x323313(0xf4));return;}try{const _0x3c4f0e=await database_1[_0x323313(0x12c)]['telegramUser'][_0x323313(0x194)]({'where':{'shopId':_0x2299de,'isVerified':!![]}});if(_0x3c4f0e[_0x323313(0xbf)]===0x0){console[_0x323313(0x14b)](_0x323313(0xb5)+_0x2299de);return;}const _0x4c1aa3=_0x3c4f0e[_0x323313(0x16f)](async _0x4791a0=>{const _0x46aad2=_0x323313;try{await this[_0x46aad2(0xf6)]?.[_0x46aad2(0x131)](_0x4791a0[_0x46aad2(0x110)],_0x426c0a,_0x41d8e1),console[_0x46aad2(0x14b)](_0x46aad2(0xe9)+_0x4791a0[_0x46aad2(0x110)]);}catch(_0x550b08){console[_0x46aad2(0x174)](_0x46aad2(0x179)+_0x4791a0[_0x46aad2(0x110)]+':',_0x550b08),_0x550b08 instanceof Error&&(_0x550b08[_0x46aad2(0x154)]['includes'](_0x46aad2(0x197))||_0x550b08[_0x46aad2(0x154)][_0x46aad2(0xc5)]('chat\x20not\x20found')||_0x550b08['message'][_0x46aad2(0xc5)](_0x46aad2(0xe1)))&&(await database_1[_0x46aad2(0x12c)]['telegramUser'][_0x46aad2(0x10b)]({'where':{'id':_0x4791a0['id']},'data':{'isVerified':![]}}),console[_0x46aad2(0x14b)]('User\x20'+_0x4791a0[_0x46aad2(0x110)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x323313(0xbc)](_0x4c1aa3);}catch(_0x58b50b){console[_0x323313(0x174)](_0x323313(0x134),_0x58b50b);}}async[a63_0x471cd1(0xc7)](_0x51f23c,_0xf93de5,_0x1aad80){const _0x431e5f=a63_0x471cd1,_0x28e0be={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x31f69c={'created':'New\x20payment\x20created','paid':_0x431e5f(0x164),'failed':'Payment\x20failed','expired':'Payment\x20expired','refund':_0x431e5f(0xc3),'chargeback':_0x431e5f(0x136),'processing':'Payment\x20is\x20being\x20processed'},_0x118a6c=_0x28e0be[_0x1aad80],_0xc0f265=_0x31f69c[_0x1aad80],_0x1d6f0b=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0xf93de5['gateway']);console[_0x431e5f(0x14b)](_0x431e5f(0x167)+_0xf93de5['gateway']+_0x431e5f(0x14c)+_0x1d6f0b+'\x22');let _0x4d5351=_0x118a6c+'\x20*'+_0xc0f265+'*\x0a\x0a'+('💰\x20Amount:\x20*'+_0xf93de5['amount']+'\x20'+_0xf93de5[_0x431e5f(0x102)]+'*\x0a')+(_0x431e5f(0x138)+(_0xf93de5[_0x431e5f(0xfa)]||_0xf93de5['id'])+'`\x0a')+(_0x431e5f(0xe2)+_0xf93de5['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x1d6f0b+'`\x0a')+('📅\x20Date:\x20'+new Date(_0xf93de5['createdAt'])['toLocaleString']('en-US')+'\x0a');if(_0xf93de5['customerName']||_0xf93de5['customerEmail']||_0xf93de5[_0x431e5f(0x111)]||_0xf93de5[_0x431e5f(0x142)]||_0xf93de5['customerUa']){_0x4d5351+=_0x431e5f(0x192);_0xf93de5[_0x431e5f(0xc0)]&&(_0x4d5351+=_0x431e5f(0xe5)+_0xf93de5[_0x431e5f(0xc0)]+'`\x0a');_0xf93de5[_0x431e5f(0xc8)]&&(_0x4d5351+=_0x431e5f(0x17c)+_0xf93de5[_0x431e5f(0xc8)]+'`\x0a');_0xf93de5[_0x431e5f(0x111)]&&(_0x4d5351+=_0x431e5f(0x176)+_0xf93de5[_0x431e5f(0x111)]+'`\x0a');_0xf93de5[_0x431e5f(0x142)]&&(_0x4d5351+='🌐\x20IP:\x20`'+_0xf93de5['customerIp']+'`\x0a');if(_0xf93de5[_0x431e5f(0x147)]){const _0x3b8b74=_0xf93de5[_0x431e5f(0x147)][_0x431e5f(0xbf)]>0x32?_0xf93de5['customerUa']['substring'](0x0,0x32)+_0x431e5f(0x11f):_0xf93de5[_0x431e5f(0x147)];_0x4d5351+=_0x431e5f(0xb9)+_0x3b8b74+'`\x0a';}}_0x1aad80==='chargeback'&&_0xf93de5[_0x431e5f(0x186)]&&(_0x4d5351+=_0x431e5f(0x109)+_0xf93de5[_0x431e5f(0x186)]+_0x431e5f(0x189)),_0x1aad80===_0x431e5f(0xb0)&&(_0x4d5351+=_0x431e5f(0xc4)),_0xf93de5[_0x431e5f(0xb7)]&&(_0x4d5351+=_0x431e5f(0xec)+_0xf93de5[_0x431e5f(0xb7)]+'\x0a'),await this[_0x431e5f(0x182)](_0x51f23c,_0x4d5351,{'parse_mode':'Markdown'});}async[a63_0x471cd1(0x172)](_0x26e533,_0xebce96,_0x252567){const _0xe95ec6=a63_0x471cd1,_0x185569={'created':'📤','completed':'✅','rejected':'❌'},_0x475cf0={'created':'New\x20payout\x20created','completed':'Payout\x20completed','rejected':_0xe95ec6(0x11b)},_0x188bd9=_0x185569[_0x252567],_0x2f1212=_0x475cf0[_0x252567],_0x158cac=_0x188bd9+'\x20*'+_0x2f1212+_0xe95ec6(0x14a)+(_0xe95ec6(0x156)+_0xebce96[_0xe95ec6(0x193)]+'\x20USD*\x0a')+(_0xe95ec6(0x16d)+_0xebce96[_0xe95ec6(0x129)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0xebce96['id']+'`\x0a')+(_0xe95ec6(0x18a)+new Date(_0xebce96[_0xe95ec6(0x184)])[_0xe95ec6(0x14e)](_0xe95ec6(0xf1))+'\x0a')+(_0xebce96[_0xe95ec6(0xb8)]?_0xe95ec6(0x175)+_0xebce96['txid']+'`':'');await this[_0xe95ec6(0x182)](_0x26e533,_0x158cac,{'parse_mode':'Markdown'});}async[a63_0x471cd1(0x18c)](_0x2a3d25,_0x525899){const _0x39a0dc=a63_0x471cd1;try{const _0x3e347b=await database_1[_0x39a0dc(0x12c)][_0x39a0dc(0x16b)][_0x39a0dc(0x13b)]({'where':{'shopId':_0x2a3d25},'select':{'notificationLogin':!![]}});if(!_0x3e347b?.['notificationLogin']){console[_0x39a0dc(0x14b)](_0x39a0dc(0xaf)+_0x2a3d25);return;}const _0x5bba9c=_0x525899[_0x39a0dc(0x191)]?'🔐':'🚨',_0x5ed977=_0x525899['success']?_0x39a0dc(0xcb):'Failed\x20login\x20attempt';let _0x1922ba=_0x5bba9c+'\x20*'+_0x5ed977+'*\x0a\x0a'+(_0x39a0dc(0x16c)+_0x525899[_0x39a0dc(0x151)]+'`\x0a')+('📅\x20Time:\x20'+_0x525899[_0x39a0dc(0xff)]['toLocaleString']('en-US')+'\x0a');_0x525899['ipAddress']&&(_0x1922ba+=_0x39a0dc(0x12f)+_0x525899['ipAddress']+'`\x0a');if(_0x525899[_0x39a0dc(0xed)]){const _0x398d9e=_0x525899[_0x39a0dc(0xed)]['length']>0x32?_0x525899['userAgent'][_0x39a0dc(0x143)](0x0,0x32)+_0x39a0dc(0x11f):_0x525899[_0x39a0dc(0xed)];_0x1922ba+='💻\x20Browser:\x20`'+_0x398d9e+'`\x0a';}!_0x525899[_0x39a0dc(0x191)]&&(_0x1922ba+=_0x39a0dc(0x17d)),await this[_0x39a0dc(0x182)](_0x2a3d25,_0x1922ba,{'parse_mode':_0x39a0dc(0x11a)}),console['log'](_0x39a0dc(0xbd)+_0x2a3d25+':\x20'+(_0x525899[_0x39a0dc(0x191)]?_0x39a0dc(0x191):'failed'));}catch(_0x18d874){console['error'](_0x39a0dc(0x12b),_0x18d874);}}async[a63_0x471cd1(0x12d)](_0x178063,_0x1f268f){const _0x202e77=a63_0x471cd1;try{const _0x152f63=await database_1[_0x202e77(0x12c)][_0x202e77(0x16b)][_0x202e77(0x13b)]({'where':{'shopId':_0x178063},'select':{'notificationApiError':!![]}});if(!_0x152f63?.[_0x202e77(0x118)]){console[_0x202e77(0x14b)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x178063);return;}let _0x86d3bb='🚨\x20*API\x20Error*\x0a\x0a'+('🔗\x20Endpoint:\x20`'+_0x1f268f['method']+'\x20'+_0x1f268f[_0x202e77(0xad)]+'`\x0a')+(_0x202e77(0x190)+_0x1f268f['timestamp'][_0x202e77(0x14e)]('en-US')+'\x0a');_0x1f268f[_0x202e77(0x170)]&&(_0x86d3bb+='📊\x20Error\x20code:\x20`'+_0x1f268f['statusCode']+'`\x0a'),_0x86d3bb+=_0x202e77(0xbe)+_0x1f268f[_0x202e77(0xac)]+'`\x0a',_0x1f268f[_0x202e77(0xbb)]&&(_0x86d3bb+='🆔\x20Request\x20ID:\x20`'+_0x1f268f[_0x202e77(0xbb)]+'`\x0a'),_0x86d3bb+=_0x202e77(0xfe),await this[_0x202e77(0x182)](_0x178063,_0x86d3bb,{'parse_mode':'Markdown'}),console['log'](_0x202e77(0x181)+_0x178063+':\x20'+_0x1f268f[_0x202e77(0xad)]);}catch(_0x4675ef){console[_0x202e77(0x174)](_0x202e77(0x13e),_0x4675ef);}}async[a63_0x471cd1(0x130)](_0x104fed,_0x3c83d1,_0x5965e0){const _0x1e7b4f=a63_0x471cd1;let _0x4cfa64=_0x1e7b4f(0x177)+_0x3c83d1+'*\x0a\x0a';for(const [_0x465f34,_0x19c5a0]of Object['entries'](_0x5965e0)){_0x19c5a0!==null&&_0x19c5a0!==undefined&&(_0x4cfa64+=_0x465f34+_0x1e7b4f(0x185)+_0x19c5a0+'`\x0a');}await this[_0x1e7b4f(0x182)](_0x104fed,_0x4cfa64,{'parse_mode':_0x1e7b4f(0x11a)});}async[a63_0x471cd1(0x188)](_0x42b01d){const _0x3bfd52=a63_0x471cd1;try{console['log']('📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20'+_0x42b01d[_0x3bfd52(0x143)](0x0,0x32)+_0x3bfd52(0x11f));const _0x32fcc7=await database_1[_0x3bfd52(0x12c)][_0x3bfd52(0x13d)]['findMany']({'select':{'telegramId':!![]}});if(_0x32fcc7[_0x3bfd52(0xbf)]===0x0){console[_0x3bfd52(0x14b)]('📱\x20No\x20active\x20Telegram\x20users\x20found');return;}for(const _0x453af7 of _0x32fcc7){try{await this[_0x3bfd52(0xf6)]?.['sendMessage'](_0x453af7[_0x3bfd52(0x110)],_0x42b01d,{'parse_mode':_0x3bfd52(0x11a)});}catch(_0x1dab4b){console['error'](_0x3bfd52(0x133)+_0x453af7[_0x3bfd52(0x110)]+':',_0x1dab4b);}}console[_0x3bfd52(0x14b)]('📱\x20Notification\x20sent\x20to\x20'+_0x32fcc7[_0x3bfd52(0xbf)]+_0x3bfd52(0x161));}catch(_0x241062){console[_0x3bfd52(0x174)](_0x3bfd52(0x10a),_0x241062);}}[a63_0x471cd1(0x16e)](){const _0x952cf6=a63_0x471cd1;return{'isActive':!!this[_0x952cf6(0xf6)],'username':this[_0x952cf6(0x148)]};}async['sendShopFile'](_0x36fb94,_0x3af4a2,_0x59ffcd,_0x4b63a3){const _0x77f8dd=a63_0x471cd1;try{if(!this[_0x77f8dd(0xf6)])return console['error']('❌\x20Telegram\x20bot\x20not\x20initialized'),![];const _0x341ec4=await database_1[_0x77f8dd(0x12c)][_0x77f8dd(0x13d)][_0x77f8dd(0x194)]({'where':{'shopId':_0x36fb94,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x341ec4[_0x77f8dd(0xbf)]===0x0)return console['error'](_0x77f8dd(0x18b)+_0x36fb94),![];let _0x4aaab0=0x0;for(const _0x25472c of _0x341ec4){try{await this[_0x77f8dd(0xf6)][_0x77f8dd(0x17b)](_0x25472c[_0x77f8dd(0x110)],_0x3af4a2,{},{'filename':_0x59ffcd,'contentType':_0x59ffcd[_0x77f8dd(0x15c)](_0x77f8dd(0x12a))?'image/png':_0x59ffcd[_0x77f8dd(0x15c)](_0x77f8dd(0x10d))||_0x59ffcd[_0x77f8dd(0x15c)](_0x77f8dd(0xd5))?_0x77f8dd(0x113):_0x59ffcd[_0x77f8dd(0x15c)](_0x77f8dd(0xe4))?'application/pdf':_0x77f8dd(0xd4)}),_0x4b63a3&&await this['bot'][_0x77f8dd(0x131)](_0x25472c[_0x77f8dd(0x110)],_0x4b63a3),_0x4aaab0++;}catch(_0x2aa56c){console[_0x77f8dd(0x174)](_0x77f8dd(0x169)+_0x25472c['telegramId']+':',_0x2aa56c);}}return console[_0x77f8dd(0x14b)]('✅\x20File\x20sent\x20to\x20'+_0x4aaab0+'/'+_0x341ec4['length']+'\x20users\x20of\x20shop\x20'+_0x36fb94+':\x20'+_0x59ffcd),_0x4aaab0>0x0;}catch(_0x3d60a4){return console[_0x77f8dd(0x174)]('❌\x20Error\x20sending\x20file\x20to\x20shop:',_0x3d60a4),![];}}async[a63_0x471cd1(0xe8)](_0x10c7bb,_0x46c9a8){const _0x3a69d7=a63_0x471cd1;try{if(!this['bot'])return console[_0x3a69d7(0x174)](_0x3a69d7(0x123)),![];return await this[_0x3a69d7(0xf6)][_0x3a69d7(0x131)](_0x10c7bb,_0x46c9a8),console['log'](_0x3a69d7(0xf8)+_0x10c7bb),!![];}catch(_0x53ebb4){return console[_0x3a69d7(0x174)](_0x3a69d7(0xf9),_0x53ebb4),![];}}async[a63_0x471cd1(0x158)](_0x1ae88d,_0x2f0141,_0x10be56,_0x550335){const _0x1fd187=a63_0x471cd1;try{if(!this[_0x1fd187(0xf6)])return console['error']('❌\x20Telegram\x20bot\x20not\x20initialized'),![];return await this[_0x1fd187(0xf6)][_0x1fd187(0x17b)](_0x1ae88d,_0x2f0141,{},{'filename':_0x10be56,'contentType':_0x10be56[_0x1fd187(0x15c)]('.png')?'image/png':_0x10be56[_0x1fd187(0x15c)]('.jpg')||_0x10be56[_0x1fd187(0x15c)]('.jpeg')?_0x1fd187(0x113):_0x10be56[_0x1fd187(0x15c)](_0x1fd187(0xe4))?'application/pdf':'application/octet-stream'}),_0x550335&&await this[_0x1fd187(0xf6)]['sendMessage'](_0x1ae88d,_0x550335),console[_0x1fd187(0x14b)]('✅\x20File\x20sent\x20to\x20chat\x20'+_0x1ae88d+':\x20'+_0x10be56),!![];}catch(_0x119b77){return console[_0x1fd187(0x174)](_0x1fd187(0x137),_0x119b77),![];}}['stopBot'](){const _0x4dcf0f=a63_0x471cd1;this[_0x4dcf0f(0xf6)]&&(this[_0x4dcf0f(0xf6)][_0x4dcf0f(0xdc)](),this['bot']=null,console[_0x4dcf0f(0x14b)](_0x4dcf0f(0xd0)));}}function a63_0x2a89(_0x46fe40,_0x2d2709){const _0x146ede=a63_0x146e();return a63_0x2a89=function(_0x2a8961,_0x220770){_0x2a8961=_0x2a8961-0xac;let _0x4b6304=_0x146ede[_0x2a8961];return _0x4b6304;},a63_0x2a89(_0x46fe40,_0x2d2709);}exports[a63_0x471cd1(0x195)]=TelegramBotService,exports[a63_0x471cd1(0xd7)]=new TelegramBotService();