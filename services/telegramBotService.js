'use strict';const a66_0x3f7766=a66_0x12d9;function a66_0x1176(){const _0x36cd25=['API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','...','amount','Use\x20/start\x20to\x20begin.','from','warn','TELEGRAM_BOT_USERNAME','\x0a👤\x20*Customer\x20Information:*\x0a','../types/gateway','text','log','stopPolling','💰\x20Amount:\x20*','toLocaleDateString','📊\x20*Connection\x20Status*\x0a\x0a','numeric','`\x0a\x0a','setupBotHandlers','telegramUser','botUsername','shopId','Example:\x0a','name','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','sendDirectFile','timestamp','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','•\x20Payouts\x0a','Error\x20handling\x20/debug\x20command:','🌐\x20IP:\x20`','\x20USDT*\x0a','📅\x20Connection\x20date:\x20','join','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','customerName','Error\x20in\x20handleSingleLineVerification:','✅\x20File\x20sent\x20to\x20chat\x20','method','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','orderId','customerEmail','💻\x20Browser:\x20`','sendPaymentNotification','first_name','__importDefault','`\x20is\x20inactive.\x0a\x0a','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','botToken','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','1118320rqvWfi','customerUa','Payment\x20chargeback',':\x20username=\x22','pk_','defineProperty','message','631849JpObSs','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','chat','initializeBot','findMany','🔔\x20Notifications\x20are\x20active\x0a\x0a','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','image/jpeg','allSettled','2-digit','2791208RSzKJU','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','💰\x20*Amount:*\x20','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','telegramBotService','/disconnect\x20-\x20disconnect\x20from\x20notifications','TELEGRAM_BOT_TOKEN','❌\x20Error\x20sending\x20direct\x20message:','To\x20reconnect,\x20use\x20the\x20/start\x20command','en-US','🔗\x20*Transaction\x20Link:*\x20Pending','application/octet-stream','length','period','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','🔗\x20*Transaction\x20Link:*\x20`','❌\x20Telegram\x20bot\x20not\x20initialized','secretKey','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','endpoint','sendApiErrorNotification','\x20\x20\x20Status:\x20','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','❌\x20Error\x20sending\x20file\x20to\x20shop:','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','🔔\x20You\x20receive\x20notifications\x20about:\x0a','default','🌐\x20*Network:*\x20','❌\x20Invalid\x20username\x20format:\x20`','/status\x20-\x20check\x20connection\x20status\x0a','stopBot','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','sk_','trapay_bot','❌\x20Please\x20use\x20/start\x20command\x20first','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','❌\x20Error\x20getting\x20debug\x20information.','findUnique','username','Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.','bot','\x20disconnected\x20from\x20shop\x20','success','.jpg','\x20(@','🛑\x20Telegram\x20bot\x20stopped','🔔\x20*','update','chargebackAmount','Failed\x20login\x20attempt','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','customerIp','\x20initialized\x20successfully','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','ACTIVE','handleSingleLineVerification','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','Error\x20handling\x20/disconnect\x20command:','errorMessage','adminNotes','startsWith','Telegram\x20bot\x20error:','onText','📱\x20Telegram\x20notification:\x20gateway\x20\x22','sendShopFile','remitterIban','getBotInfo','\x20via\x20single-line\x20input','toString','💳\x20*Wallet:*\x20`','❌\x20Error\x20sending\x20file\x20to\x20chat:','endsWith','You\x20sent\x20','•\x20Payouts\x0a\x0a','Markdown','env','.png','telegramId','map','Failed\x20to\x20send\x20API\x20error\x20notification:','findFirst','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','🏦\x20IBAN:\x20`','trim','gateway','\x20users\x20of\x20shop\x20','txid','📊\x20Error\x20code:\x20`','sendPayoutNotification','substring','400650tbJCMQ','getGatewayDisplayNameForTelegram','sendMessage','Error\x20handling\x20/status\x20command:','application/pdf','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','includes','userAgent','shop','991815QyVwfc','geo','\x20verified\x20for\x20shop\x20','⏱️\x20*Period:*\x20','\x20users','*.\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','\x20\x20\x20Username:\x20`','failed','❌\x20Shop\x20with\x20username\x20`','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','Successful\x20login','•\x20New\x20payments\x0a','statusCode','../config/database','📝\x20Notes:\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','📱\x20Shop:\x20*','Error\x20handling\x20message:','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','updatedAt','Payment\x20expired','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','notificationApiError','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','Failed\x20to\x20send\x20login\x20notification:','.pdf','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Username:\x20`','sendShopNotification','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Payment\x20failed','createdAt','test','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','📅\x20Time:\x20','📅\x20*Payout\x20Date:*\x20','Use\x20/start\x20to\x20connect.','chat\x20not\x20found','toLocaleString','sendDocument','❌\x20Shop\x20`','Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.','Payment\x20is\x20being\x20processed','.jpeg',':\x20`','isVerified','51582kYxptz','📱\x20No\x20active\x20Telegram\x20users\x20found','\x22,\x20apiKey=\x22','TelegramBotService','🎉\x20*Congratulations!*\x0a\x0a','*\x0a\x0a','sendLoginNotification','polling_error','last_name','publicKey','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','Commands:\x0a','...\x22','🔍\x20*Debug\x20Information*\x0a\x0a','requestId','user\x20is\x20deactivated','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','💸\x20Penalty\x20amount:\x20*','error','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','🏪\x20Your\x20connected\x20shop:\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','status','entries','shopSettings','\x20\x20\x20Name:\x20*','sendCustomNotification','🆔\x20Payment\x20ID:\x20`','Not\x20specified','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','__esModule','❌\x20Error:\x20`','`.\x0a\x0a','1000812avhREt','currency','network','notificationLogin'];a66_0x1176=function(){return _0x36cd25;};return a66_0x1176();}function a66_0x12d9(_0x597ef1,_0x25a69b){const _0x11768b=a66_0x1176();return a66_0x12d9=function(_0x12d971,_0x35f8f3){_0x12d971=_0x12d971-0x16e;let _0x2a1b5e=_0x11768b[_0x12d971];return _0x2a1b5e;},a66_0x12d9(_0x597ef1,_0x25a69b);}(function(_0xeffc24,_0x152178){const _0x4d00eb=a66_0x12d9,_0x45edfe=_0xeffc24();while(!![]){try{const _0x39999f=parseInt(_0x4d00eb(0x1c9))/0x1+parseInt(_0x4d00eb(0x22f))/0x2+-parseInt(_0x4d00eb(0x269))/0x3+parseInt(_0x4d00eb(0x1c2))/0x4+-parseInt(_0x4d00eb(0x238))/0x5+-parseInt(_0x4d00eb(0x18d))/0x6+-parseInt(_0x4d00eb(0x1d3))/0x7;if(_0x39999f===_0x152178)break;else _0x45edfe['push'](_0x45edfe['shift']());}catch(_0x92c072){_0x45edfe['push'](_0x45edfe['shift']());}}}(a66_0x1176,0x50b9b));var __importDefault=this&&this[a66_0x3f7766(0x1bd)]||function(_0x118379){return _0x118379&&_0x118379['__esModule']?_0x118379:{'default':_0x118379};};Object[a66_0x3f7766(0x1c7)](exports,a66_0x3f7766(0x18a),{'value':!![]}),exports['telegramBotService']=exports[a66_0x3f7766(0x16f)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a66_0x3f7766(0x246))),gateway_1=require(a66_0x3f7766(0x199));class TelegramBotService{constructor(){const _0x1faaa2=a66_0x3f7766;this[_0x1faaa2(0x1fd)]=null,this[_0x1faaa2(0x1c0)]=process['env'][_0x1faaa2(0x1d9)]||'',this[_0x1faaa2(0x1a4)]=process[_0x1faaa2(0x220)][_0x1faaa2(0x197)]||_0x1faaa2(0x1f4),this[_0x1faaa2(0x1c0)]?this[_0x1faaa2(0x1cc)]():console[_0x1faaa2(0x196)](_0x1faaa2(0x17f));}[a66_0x3f7766(0x1cc)](){const _0x4971cd=a66_0x3f7766;try{this[_0x4971cd(0x1fd)]=new node_telegram_bot_api_1[(_0x4971cd(0x1ed))](this[_0x4971cd(0x1c0)],{'polling':!![]}),this[_0x4971cd(0x1a2)](),console[_0x4971cd(0x19b)]('✅\x20Telegram\x20bot\x20@'+this['botUsername']+_0x4971cd(0x209));}catch(_0x1b616b){console[_0x4971cd(0x17e)](_0x4971cd(0x1cf),_0x1b616b);}}[a66_0x3f7766(0x1a2)](){const _0x1655da=a66_0x3f7766;if(!this[_0x1655da(0x1fd)])return;this['bot'][_0x1655da(0x213)](/\/start/,async _0x2fd508=>{const _0x2127e8=_0x1655da,_0x28fd36=_0x2fd508[_0x2127e8(0x1cb)]['id'],_0x3f82e5=_0x2fd508[_0x2127e8(0x195)]?.['id']['toString'](),_0x205228=_0x2fd508[_0x2127e8(0x195)]?.[_0x2127e8(0x1fb)],_0x5877e3=_0x2fd508['from']?.[_0x2127e8(0x1bc)],_0x6953d9=_0x2fd508[_0x2127e8(0x195)]?.[_0x2127e8(0x174)];if(!_0x3f82e5)return;try{let _0x6d85d6=await database_1[_0x2127e8(0x1ed)]['telegramUser'][_0x2127e8(0x1fa)]({'where':{'telegramId':_0x3f82e5},'include':{'shop':!![]}});!_0x6d85d6?(_0x6d85d6=await database_1['default'][_0x2127e8(0x1a3)]['create']({'data':{'telegramId':_0x3f82e5,'username':_0x205228,'firstName':_0x5877e3,'lastName':_0x6953d9,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x2127e8(0x19b)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x3f82e5+_0x2127e8(0x201)+_0x205228+')')):_0x6d85d6=await database_1['default']['telegramUser'][_0x2127e8(0x204)]({'where':{'telegramId':_0x3f82e5},'data':{'username':_0x205228,'firstName':_0x5877e3,'lastName':_0x6953d9},'include':{'shop':!![]}}),_0x6d85d6[_0x2127e8(0x268)]&&_0x6d85d6[_0x2127e8(0x1a5)]&&_0x6d85d6[_0x2127e8(0x237)]?await this['bot']?.['sendMessage'](_0x28fd36,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x2127e8(0x1e9)+_0x6d85d6[_0x2127e8(0x237)]['name']+'*\x0a')+(_0x2127e8(0x256)+_0x6d85d6[_0x2127e8(0x237)]['username']+'`\x0a\x0a')+_0x2127e8(0x1ec)+_0x2127e8(0x244)+'•\x20Payment\x20status\x20changes\x0a'+_0x2127e8(0x21e)+'Commands:\x0a'+_0x2127e8(0x1f0)+_0x2127e8(0x1d8),{'parse_mode':_0x2127e8(0x21f)}):(_0x6d85d6[_0x2127e8(0x1a5)]&&!_0x6d85d6[_0x2127e8(0x268)]&&(await database_1[_0x2127e8(0x1ed)][_0x2127e8(0x1a3)][_0x2127e8(0x204)]({'where':{'telegramId':_0x3f82e5},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x2127e8(0x1b7)+_0x3f82e5)),await this[_0x2127e8(0x1fd)]?.[_0x2127e8(0x231)](_0x28fd36,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x2127e8(0x250)+_0x2127e8(0x1eb)+_0x2127e8(0x1a6)+_0x2127e8(0x1e5)+_0x2127e8(0x1c1),{'parse_mode':_0x2127e8(0x21f)}));}catch(_0x2d0bd7){console[_0x2127e8(0x17e)]('Error\x20handling\x20/start\x20command:',_0x2d0bd7),await this['bot']?.[_0x2127e8(0x231)](_0x28fd36,_0x2127e8(0x20a));}}),this[_0x1655da(0x1fd)][_0x1655da(0x213)](/\/disconnect/,async _0x3412f2=>{const _0x3f9cda=_0x1655da,_0x85830f=_0x3412f2['chat']['id'],_0x4486e4=_0x3412f2[_0x3f9cda(0x195)]?.['id'][_0x3f9cda(0x219)]();if(!_0x4486e4)return;try{const _0x36f6e0=await database_1['default']['telegramUser']['findUnique']({'where':{'telegramId':_0x4486e4},'include':{'shop':!![]}});if(!_0x36f6e0||!_0x36f6e0['isVerified']||!_0x36f6e0['shopId']){await this['bot']?.[_0x3f9cda(0x231)](_0x85830f,_0x3f9cda(0x23e));return;}const _0x4ee600=_0x36f6e0[_0x3f9cda(0x237)]?.[_0x3f9cda(0x1a7)]||'unknown\x20shop';await database_1[_0x3f9cda(0x1ed)][_0x3f9cda(0x1a3)]['update']({'where':{'telegramId':_0x4486e4},'data':{'shopId':null,'isVerified':![]}}),console[_0x3f9cda(0x19b)]('🔌\x20User\x20'+_0x4486e4+_0x3f9cda(0x1fe)+_0x36f6e0[_0x3f9cda(0x1a5)]),await this[_0x3f9cda(0x1fd)]?.[_0x3f9cda(0x231)](_0x85830f,_0x3f9cda(0x252)+_0x4ee600+'*.\x0a\x0a'+_0x3f9cda(0x1db),{'parse_mode':_0x3f9cda(0x21f)});}catch(_0x4c64e8){console['error'](_0x3f9cda(0x20e),_0x4c64e8),await this[_0x3f9cda(0x1fd)]?.[_0x3f9cda(0x231)](_0x85830f,_0x3f9cda(0x20a));}}),this[_0x1655da(0x1fd)][_0x1655da(0x213)](/\/status/,async _0x335a24=>{const _0xd8af49=_0x1655da,_0xad8089=_0x335a24[_0xd8af49(0x1cb)]['id'],_0x38f217=_0x335a24[_0xd8af49(0x195)]?.['id']['toString']();if(!_0x38f217)return;try{const _0x488db5=await database_1['default']['telegramUser']['findUnique']({'where':{'telegramId':_0x38f217},'include':{'shop':!![]}});if(!_0x488db5){await this['bot']?.[_0xd8af49(0x231)](_0xad8089,_0xd8af49(0x17c)+_0xd8af49(0x194));return;}if(!_0x488db5['isVerified']||!_0x488db5[_0xd8af49(0x1a5)]||!_0x488db5[_0xd8af49(0x237)]){await this['bot']?.[_0xd8af49(0x231)](_0xad8089,_0xd8af49(0x181)+_0xd8af49(0x25f));return;}await this[_0xd8af49(0x1fd)]?.[_0xd8af49(0x231)](_0xad8089,_0xd8af49(0x19f)+('✅\x20Connected\x20to\x20shop:\x20*'+_0x488db5[_0xd8af49(0x237)]['name']+'*\x0a')+('👤\x20Username:\x20`'+_0x488db5['shop'][_0xd8af49(0x1fb)]+'`\x0a')+(_0xd8af49(0x1b0)+_0x488db5[_0xd8af49(0x24d)][_0xd8af49(0x19e)](_0xd8af49(0x1dc))+'\x0a\x0a')+_0xd8af49(0x1ce)+_0xd8af49(0x177)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0xd8af49(0x21f)});}catch(_0x5bfd09){console[_0xd8af49(0x17e)](_0xd8af49(0x232),_0x5bfd09),await this[_0xd8af49(0x1fd)]?.[_0xd8af49(0x231)](_0xad8089,_0xd8af49(0x20a));}}),this[_0x1655da(0x1fd)][_0x1655da(0x213)](/\/debug/,async _0xa239e8=>{const _0x21119a=_0x1655da,_0xe5be06=_0xa239e8['chat']['id'],_0x419b24=_0xa239e8[_0x21119a(0x195)]?.['id'][_0x21119a(0x219)]();if(!_0x419b24)return;try{const _0x463cf1=await database_1[_0x21119a(0x1ed)][_0x21119a(0x1a3)][_0x21119a(0x1fa)]({'where':{'telegramId':_0x419b24},'include':{'shop':!![]}});let _0x3b8f70=_0x21119a(0x179);_0x3b8f70+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x419b24+'`\x0a\x0a',_0x463cf1?.[_0x21119a(0x268)]&&_0x463cf1['shop']?(_0x3b8f70+=_0x21119a(0x180),_0x3b8f70+=_0x21119a(0x185)+_0x463cf1[_0x21119a(0x237)][_0x21119a(0x1a7)]+'*\x0a',_0x3b8f70+=_0x21119a(0x23f)+_0x463cf1[_0x21119a(0x237)][_0x21119a(0x1fb)]+'`\x0a',_0x3b8f70+=_0x21119a(0x1e8)+_0x463cf1['shop'][_0x21119a(0x182)]+'\x0a\x0a'):_0x3b8f70+=_0x21119a(0x248),_0x3b8f70+=_0x21119a(0x1fc),await this[_0x21119a(0x1fd)]?.[_0x21119a(0x231)](_0xe5be06,_0x3b8f70,{'parse_mode':_0x21119a(0x21f)});}catch(_0x42c27f){console[_0x21119a(0x17e)](_0x21119a(0x1ad),_0x42c27f),await this[_0x21119a(0x1fd)]?.[_0x21119a(0x231)](_0xe5be06,_0x21119a(0x1f9));}}),this[_0x1655da(0x1fd)]['on'](_0x1655da(0x1c8),async _0x266d80=>{const _0x4b09bf=_0x1655da;if(_0x266d80[_0x4b09bf(0x19a)]?.['startsWith']('/'))return;const _0x55b739=_0x266d80[_0x4b09bf(0x1cb)]['id'],_0x3d97a1=_0x266d80[_0x4b09bf(0x195)]?.['id'][_0x4b09bf(0x219)](),_0x1d406a=_0x266d80[_0x4b09bf(0x19a)]?.[_0x4b09bf(0x228)]();if(!_0x3d97a1||!_0x1d406a)return;try{const _0x2be51c=await database_1[_0x4b09bf(0x1ed)][_0x4b09bf(0x1a3)][_0x4b09bf(0x1fa)]({'where':{'telegramId':_0x3d97a1},'include':{'shop':!![]}});if(!_0x2be51c){await this['bot']?.[_0x4b09bf(0x231)](_0x55b739,_0x4b09bf(0x1f5));return;}if(_0x2be51c[_0x4b09bf(0x268)]&&_0x2be51c['shopId']&&_0x2be51c[_0x4b09bf(0x237)]){await this[_0x4b09bf(0x1fd)]?.[_0x4b09bf(0x231)](_0x55b739,_0x4b09bf(0x1f2)+_0x2be51c[_0x4b09bf(0x237)][_0x4b09bf(0x1a7)]+_0x4b09bf(0x23d)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x4b09bf(0x21f)});return;}const _0x37c11b=_0x1d406a['split'](/\s+/);if(_0x37c11b[_0x4b09bf(0x1df)]!==0x2){await this[_0x4b09bf(0x1fd)]?.['sendMessage'](_0x55b739,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x4b09bf(0x1eb)+_0x4b09bf(0x1a6)+_0x4b09bf(0x1e5)+(_0x4b09bf(0x21d)+_0x37c11b[_0x4b09bf(0x1df)]+'\x20parts:\x20'+_0x37c11b[_0x4b09bf(0x223)](_0x1b1602=>'`'+_0x1b1602+'`')[_0x4b09bf(0x1b1)](',\x20')),{'parse_mode':_0x4b09bf(0x21f)});return;}const [_0x373936,_0x3d2d41]=_0x37c11b;console[_0x4b09bf(0x19b)](_0x4b09bf(0x258)+_0x3d97a1+':\x20username=\x22'+_0x373936+_0x4b09bf(0x16e)+_0x3d2d41[_0x4b09bf(0x22e)](0x0,0xa)+'...\x22'),await this[_0x4b09bf(0x20c)](_0x55b739,_0x3d97a1,_0x373936,_0x3d2d41);}catch(_0x564597){console[_0x4b09bf(0x17e)](_0x4b09bf(0x24b),_0x564597),await this[_0x4b09bf(0x1fd)]?.[_0x4b09bf(0x231)](_0x55b739,_0x4b09bf(0x20a));}}),this[_0x1655da(0x1fd)]['on']('error',_0x3a1a1e=>{const _0x3acf20=_0x1655da;console[_0x3acf20(0x17e)](_0x3acf20(0x212),_0x3a1a1e);}),this[_0x1655da(0x1fd)]['on'](_0x1655da(0x173),_0x4f458e=>{console['error']('Telegram\x20bot\x20polling\x20error:',_0x4f458e);});}async[a66_0x3f7766(0x20c)](_0x4802e1,_0x372996,_0x4854db,_0x5988bd){const _0x3c14f2=a66_0x3f7766;try{console[_0x3c14f2(0x19b)](_0x3c14f2(0x258)+_0x372996+_0x3c14f2(0x1c5)+_0x4854db+_0x3c14f2(0x16e)+_0x5988bd[_0x3c14f2(0x22e)](0x0,0xa)+_0x3c14f2(0x178));if(!_0x4854db||_0x4854db[_0x3c14f2(0x1df)]<0x3||_0x4854db['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x3c14f2(0x25b)](_0x4854db)){await this[_0x3c14f2(0x1fd)]?.['sendMessage'](_0x4802e1,_0x3c14f2(0x1ef)+_0x4854db+'`\x0a\x0a'+_0x3c14f2(0x226),{'parse_mode':_0x3c14f2(0x21f)});return;}if(!_0x5988bd||!_0x5988bd[_0x3c14f2(0x211)](_0x3c14f2(0x1c6))&&!_0x5988bd[_0x3c14f2(0x211)](_0x3c14f2(0x1f3))){await this[_0x3c14f2(0x1fd)]?.['sendMessage'](_0x4802e1,_0x3c14f2(0x207)+_0x3c14f2(0x191),{'parse_mode':_0x3c14f2(0x21f)});return;}const _0x24e995=await database_1[_0x3c14f2(0x1ed)]['shop'][_0x3c14f2(0x1fa)]({'where':{'username':_0x4854db},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x24e995){const _0x2eca13=_0x3c14f2(0x241)+_0x4854db+'`\x20not\x20found.\x0a\x0a'+'Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a'+_0x3c14f2(0x264);await this[_0x3c14f2(0x1fd)]?.[_0x3c14f2(0x231)](_0x4802e1,_0x2eca13,{'parse_mode':_0x3c14f2(0x21f)});return;}if(_0x24e995[_0x3c14f2(0x182)]!==_0x3c14f2(0x20b)){await this[_0x3c14f2(0x1fd)]?.[_0x3c14f2(0x231)](_0x4802e1,_0x3c14f2(0x263)+_0x4854db+_0x3c14f2(0x1be)+'Contact\x20administrator.',{'parse_mode':_0x3c14f2(0x21f)});return;}if(_0x24e995[_0x3c14f2(0x175)]!==_0x5988bd&&_0x24e995[_0x3c14f2(0x1e4)]!==_0x5988bd){await this['bot']?.[_0x3c14f2(0x231)](_0x4802e1,_0x3c14f2(0x1d4)+_0x4854db+_0x3c14f2(0x18c)+_0x3c14f2(0x1b2)+_0x3c14f2(0x234),{'parse_mode':_0x3c14f2(0x21f)});return;}const _0x867de1=await database_1[_0x3c14f2(0x1ed)]['telegramUser'][_0x3c14f2(0x225)]({'where':{'shopId':_0x24e995['id'],'isVerified':!![],'telegramId':{'not':_0x372996}}});if(_0x867de1){await this[_0x3c14f2(0x1fd)]?.['sendMessage'](_0x4802e1,_0x3c14f2(0x189)+_0x4854db+_0x3c14f2(0x18c)+_0x3c14f2(0x24c),{'parse_mode':_0x3c14f2(0x21f)});return;}await database_1[_0x3c14f2(0x1ed)]['telegramUser']['update']({'where':{'telegramId':_0x372996},'data':{'shopId':_0x24e995['id'],'isVerified':!![]}}),await this['bot']?.[_0x3c14f2(0x231)](_0x4802e1,_0x3c14f2(0x170)+_0x3c14f2(0x1f7)+(_0x3c14f2(0x24a)+_0x24e995[_0x3c14f2(0x1a7)]+'*\x0a')+('👤\x20Username:\x20`'+_0x24e995[_0x3c14f2(0x1fb)]+_0x3c14f2(0x1a1))+_0x3c14f2(0x1ab)+_0x3c14f2(0x244)+'•\x20Payment\x20status\x20changes\x0a'+_0x3c14f2(0x1ac)+'•\x20Important\x20events\x0a\x0a'+_0x3c14f2(0x177)+_0x3c14f2(0x1f0)+_0x3c14f2(0x1d8),{'parse_mode':_0x3c14f2(0x21f)}),console['log']('✅\x20Telegram\x20user\x20'+_0x372996+_0x3c14f2(0x23a)+_0x24e995['username']+_0x3c14f2(0x218));}catch(_0x4614b4){console['error'](_0x3c14f2(0x1b4),_0x4614b4),await this[_0x3c14f2(0x1fd)]?.[_0x3c14f2(0x231)](_0x4802e1,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a66_0x3f7766(0x257)](_0x270d43,_0x26592c,_0x476ec7){const _0x3bd345=a66_0x3f7766;if(!this['bot']){console[_0x3bd345(0x196)](_0x3bd345(0x1ca));return;}try{const _0x7ee6ea=await database_1[_0x3bd345(0x1ed)][_0x3bd345(0x1a3)][_0x3bd345(0x1cd)]({'where':{'shopId':_0x270d43,'isVerified':!![]}});if(_0x7ee6ea[_0x3bd345(0x1df)]===0x0){console['log']('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x270d43);return;}const _0x134a07=_0x7ee6ea[_0x3bd345(0x223)](async _0x442419=>{const _0x293205=_0x3bd345;try{await this[_0x293205(0x1fd)]?.[_0x293205(0x231)](_0x442419[_0x293205(0x222)],_0x26592c,_0x476ec7),console['log'](_0x293205(0x176)+_0x442419[_0x293205(0x222)]);}catch(_0x405272){console['error'](_0x293205(0x25c)+_0x442419[_0x293205(0x222)]+':',_0x405272),_0x405272 instanceof Error&&(_0x405272[_0x293205(0x1c8)][_0x293205(0x235)]('blocked')||_0x405272[_0x293205(0x1c8)][_0x293205(0x235)](_0x293205(0x260))||_0x405272[_0x293205(0x1c8)]['includes'](_0x293205(0x17b)))&&(await database_1[_0x293205(0x1ed)]['telegramUser'][_0x293205(0x204)]({'where':{'id':_0x442419['id']},'data':{'isVerified':![]}}),console[_0x293205(0x19b)]('User\x20'+_0x442419['telegramId']+_0x293205(0x1f8)));}});await Promise[_0x3bd345(0x1d1)](_0x134a07);}catch(_0x2e78d6){console[_0x3bd345(0x17e)]('Error\x20sending\x20shop\x20notification:',_0x2e78d6);}}async[a66_0x3f7766(0x1bb)](_0x292581,_0x3ac923,_0x587136){const _0x5f4868=a66_0x3f7766,_0x4d1e65={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x59c53a={'created':'New\x20payment\x20created','paid':'Payment\x20successfully\x20paid','failed':_0x5f4868(0x259),'expired':_0x5f4868(0x24e),'refund':'Payment\x20refund','chargeback':_0x5f4868(0x1c4),'processing':_0x5f4868(0x265)},_0x525fc7=_0x4d1e65[_0x587136],_0x535c8e=_0x59c53a[_0x587136],_0xe7d7f3=(0x0,gateway_1[_0x5f4868(0x230)])(_0x3ac923[_0x5f4868(0x229)]);console['log'](_0x5f4868(0x214)+_0x3ac923[_0x5f4868(0x229)]+'\x22\x20->\x20display\x20\x22'+_0xe7d7f3+'\x22');let _0x35a819=_0x525fc7+'\x20*'+_0x535c8e+_0x5f4868(0x171)+(_0x5f4868(0x19d)+_0x3ac923[_0x5f4868(0x193)]+'\x20'+_0x3ac923[_0x5f4868(0x18e)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x3ac923[_0x5f4868(0x1b8)]||_0x3ac923['id'])+'`\x0a')+(_0x5f4868(0x187)+_0x3ac923['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0xe7d7f3+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x3ac923['createdAt'])[_0x5f4868(0x261)]('en-US')+'\x0a');if(_0x3ac923[_0x5f4868(0x1b3)]||_0x3ac923[_0x5f4868(0x1b9)]||_0x3ac923[_0x5f4868(0x216)]||_0x3ac923[_0x5f4868(0x208)]||_0x3ac923[_0x5f4868(0x1c3)]){_0x35a819+=_0x5f4868(0x198);_0x3ac923[_0x5f4868(0x1b3)]&&(_0x35a819+='📛\x20Name:\x20`'+_0x3ac923[_0x5f4868(0x1b3)]+'`\x0a');_0x3ac923[_0x5f4868(0x1b9)]&&(_0x35a819+='📧\x20Email:\x20`'+_0x3ac923[_0x5f4868(0x1b9)]+'`\x0a');_0x3ac923[_0x5f4868(0x216)]&&(_0x35a819+=_0x5f4868(0x227)+_0x3ac923[_0x5f4868(0x216)]+'`\x0a');_0x3ac923['customerIp']&&(_0x35a819+=_0x5f4868(0x1ae)+_0x3ac923[_0x5f4868(0x208)]+'`\x0a');if(_0x3ac923['customerUa']){const _0x4db519=_0x3ac923[_0x5f4868(0x1c3)]['length']>0x32?_0x3ac923[_0x5f4868(0x1c3)]['substring'](0x0,0x32)+_0x5f4868(0x192):_0x3ac923[_0x5f4868(0x1c3)];_0x35a819+='💻\x20Browser:\x20`'+_0x4db519+'`\x0a';}}_0x587136==='chargeback'&&_0x3ac923[_0x5f4868(0x205)]&&(_0x35a819+=_0x5f4868(0x17d)+_0x3ac923[_0x5f4868(0x205)]+_0x5f4868(0x1af)),_0x587136==='processing'&&(_0x35a819+=_0x5f4868(0x1e1)),_0x3ac923[_0x5f4868(0x210)]&&(_0x35a819+=_0x5f4868(0x247)+_0x3ac923[_0x5f4868(0x210)]+'\x0a'),await this['sendShopNotification'](_0x292581,_0x35a819,{'parse_mode':_0x5f4868(0x21f)});}async[a66_0x3f7766(0x22d)](_0x4235ec,_0x260623){const _0x1a35cc=a66_0x3f7766,_0x3a0e4b=new Date(_0x260623[_0x1a35cc(0x25a)])[_0x1a35cc(0x261)](_0x1a35cc(0x1dc),{'year':_0x1a35cc(0x1a0),'month':_0x1a35cc(0x1d2),'day':'2-digit','hour':_0x1a35cc(0x1d2),'minute':'2-digit','second':'2-digit'}),_0x50e9bd='💸\x20*New\x20Payout*\x0a\x0a'+(_0x1a35cc(0x25e)+_0x3a0e4b+'\x0a')+(_0x1a35cc(0x1d5)+_0x260623[_0x1a35cc(0x193)]+'\x20USD\x0a')+(_0x1a35cc(0x23b)+(_0x260623[_0x1a35cc(0x1e0)]||_0x1a35cc(0x188))+'\x0a')+(_0x1a35cc(0x1ee)+(_0x260623[_0x1a35cc(0x18f)]||_0x1a35cc(0x188))+'\x0a')+(_0x1a35cc(0x21a)+(_0x260623['wallet']||_0x1a35cc(0x188))+'`\x0a')+(_0x260623[_0x1a35cc(0x22b)]?_0x1a35cc(0x1e2)+_0x260623['txid']+'`':_0x1a35cc(0x1dd));await this[_0x1a35cc(0x257)](_0x4235ec,_0x50e9bd,{'parse_mode':'Markdown'});}async[a66_0x3f7766(0x172)](_0x3ae4f2,_0x2d036f){const _0x48a469=a66_0x3f7766;try{const _0x499c72=await database_1[_0x48a469(0x1ed)][_0x48a469(0x184)]['findUnique']({'where':{'shopId':_0x3ae4f2},'select':{'notificationLogin':!![]}});if(!_0x499c72?.[_0x48a469(0x190)]){console[_0x48a469(0x19b)](_0x48a469(0x1bf)+_0x3ae4f2);return;}const _0x16a623=_0x2d036f[_0x48a469(0x1ff)]?'🔐':'🚨',_0x1aa416=_0x2d036f[_0x48a469(0x1ff)]?_0x48a469(0x243):_0x48a469(0x206);let _0xad3509=_0x16a623+'\x20*'+_0x1aa416+_0x48a469(0x171)+('👤\x20Username:\x20`'+_0x2d036f[_0x48a469(0x1fb)]+'`\x0a')+(_0x48a469(0x25d)+_0x2d036f[_0x48a469(0x1aa)]['toLocaleString'](_0x48a469(0x1dc))+'\x0a');_0x2d036f['ipAddress']&&(_0xad3509+='🌐\x20IP\x20address:\x20`'+_0x2d036f['ipAddress']+'`\x0a');_0x2d036f[_0x48a469(0x239)]&&(_0xad3509+='🌍\x20Country:\x20'+_0x2d036f['geo']+'\x0a');if(_0x2d036f[_0x48a469(0x236)]){const _0x29e799=_0x2d036f[_0x48a469(0x236)][_0x48a469(0x1df)]>0x32?_0x2d036f['userAgent'][_0x48a469(0x22e)](0x0,0x32)+_0x48a469(0x192):_0x2d036f[_0x48a469(0x236)];_0xad3509+=_0x48a469(0x1ba)+_0x29e799+'`\x0a';}!_0x2d036f[_0x48a469(0x1ff)]&&(_0xad3509+=_0x48a469(0x1f6)),await this['sendShopNotification'](_0x3ae4f2,_0xad3509,{'parse_mode':_0x48a469(0x21f)}),console[_0x48a469(0x19b)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x3ae4f2+':\x20'+(_0x2d036f[_0x48a469(0x1ff)]?_0x48a469(0x1ff):_0x48a469(0x240)));}catch(_0x31f32d){console[_0x48a469(0x17e)](_0x48a469(0x253),_0x31f32d);}}async[a66_0x3f7766(0x1e7)](_0x31f6b2,_0x1e1809){const _0x1e7d2f=a66_0x3f7766;try{const _0x4e8748=await database_1[_0x1e7d2f(0x1ed)][_0x1e7d2f(0x184)][_0x1e7d2f(0x1fa)]({'where':{'shopId':_0x31f6b2},'select':{'notificationApiError':!![]}});if(!_0x4e8748?.[_0x1e7d2f(0x251)]){console['log'](_0x1e7d2f(0x255)+_0x31f6b2);return;}let _0x4b37ec='🚨\x20*API\x20Error*\x0a\x0a'+('🔗\x20Endpoint:\x20`'+_0x1e1809[_0x1e7d2f(0x1b6)]+'\x20'+_0x1e1809['endpoint']+'`\x0a')+(_0x1e7d2f(0x25d)+_0x1e1809[_0x1e7d2f(0x1aa)][_0x1e7d2f(0x261)](_0x1e7d2f(0x1dc))+'\x0a');_0x1e1809[_0x1e7d2f(0x245)]&&(_0x4b37ec+=_0x1e7d2f(0x22c)+_0x1e1809[_0x1e7d2f(0x245)]+'`\x0a'),_0x4b37ec+=_0x1e7d2f(0x18b)+_0x1e1809[_0x1e7d2f(0x20f)]+'`\x0a',_0x1e1809[_0x1e7d2f(0x17a)]&&(_0x4b37ec+='🆔\x20Request\x20ID:\x20`'+_0x1e1809['requestId']+'`\x0a'),_0x4b37ec+=_0x1e7d2f(0x249),await this[_0x1e7d2f(0x257)](_0x31f6b2,_0x4b37ec,{'parse_mode':_0x1e7d2f(0x21f)}),console[_0x1e7d2f(0x19b)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x31f6b2+':\x20'+_0x1e1809[_0x1e7d2f(0x1e6)]);}catch(_0x500bb0){console[_0x1e7d2f(0x17e)](_0x1e7d2f(0x224),_0x500bb0);}}async[a66_0x3f7766(0x186)](_0x4ce9e8,_0x29439f,_0x10f381){const _0x410fec=a66_0x3f7766;let _0x5c2ce6=_0x410fec(0x203)+_0x29439f+'*\x0a\x0a';for(const [_0x2d0aec,_0x3eafd8]of Object[_0x410fec(0x183)](_0x10f381)){_0x3eafd8!==null&&_0x3eafd8!==undefined&&(_0x5c2ce6+=_0x2d0aec+_0x410fec(0x267)+_0x3eafd8+'`\x0a');}await this['sendShopNotification'](_0x4ce9e8,_0x5c2ce6,{'parse_mode':_0x410fec(0x21f)});}async['sendNotificationToAll'](_0x1e3852){const _0x472d8d=a66_0x3f7766;try{console['log'](_0x472d8d(0x24f)+_0x1e3852['substring'](0x0,0x32)+_0x472d8d(0x192));const _0x495d47=await database_1[_0x472d8d(0x1ed)]['telegramUser'][_0x472d8d(0x1cd)]({'select':{'telegramId':!![]}});if(_0x495d47[_0x472d8d(0x1df)]===0x0){console[_0x472d8d(0x19b)](_0x472d8d(0x26a));return;}for(const _0x2dc2c4 of _0x495d47){try{await this['bot']?.[_0x472d8d(0x231)](_0x2dc2c4['telegramId'],_0x1e3852,{'parse_mode':_0x472d8d(0x21f)});}catch(_0x332692){console[_0x472d8d(0x17e)](_0x472d8d(0x20d)+_0x2dc2c4['telegramId']+':',_0x332692);}}console[_0x472d8d(0x19b)]('📱\x20Notification\x20sent\x20to\x20'+_0x495d47[_0x472d8d(0x1df)]+_0x472d8d(0x23c));}catch(_0x5a0223){console[_0x472d8d(0x17e)](_0x472d8d(0x242),_0x5a0223);}}[a66_0x3f7766(0x217)](){const _0x19901c=a66_0x3f7766;return{'isActive':!!this[_0x19901c(0x1fd)],'username':this[_0x19901c(0x1a4)]};}async[a66_0x3f7766(0x215)](_0x3d3a6b,_0x2e1820,_0x28e17a,_0x136aa0){const _0x4b0b03=a66_0x3f7766;try{if(!this[_0x4b0b03(0x1fd)])return console[_0x4b0b03(0x17e)](_0x4b0b03(0x1e3)),![];const _0x574058=await database_1[_0x4b0b03(0x1ed)][_0x4b0b03(0x1a3)][_0x4b0b03(0x1cd)]({'where':{'shopId':_0x3d3a6b,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x574058[_0x4b0b03(0x1df)]===0x0)return console['error'](_0x4b0b03(0x1d6)+_0x3d3a6b),![];let _0x3082ef=0x0;for(const _0x10decd of _0x574058){try{await this['bot'][_0x4b0b03(0x262)](_0x10decd[_0x4b0b03(0x222)],_0x2e1820,{},{'filename':_0x28e17a,'contentType':_0x28e17a[_0x4b0b03(0x21c)](_0x4b0b03(0x221))?'image/png':_0x28e17a[_0x4b0b03(0x21c)](_0x4b0b03(0x200))||_0x28e17a[_0x4b0b03(0x21c)](_0x4b0b03(0x266))?'image/jpeg':_0x28e17a[_0x4b0b03(0x21c)](_0x4b0b03(0x254))?'application/pdf':_0x4b0b03(0x1de)}),_0x136aa0&&await this[_0x4b0b03(0x1fd)][_0x4b0b03(0x231)](_0x10decd[_0x4b0b03(0x222)],_0x136aa0),_0x3082ef++;}catch(_0x1ac4a9){console[_0x4b0b03(0x17e)]('❌\x20Error\x20sending\x20file\x20to\x20user\x20'+_0x10decd['telegramId']+':',_0x1ac4a9);}}return console[_0x4b0b03(0x19b)]('✅\x20File\x20sent\x20to\x20'+_0x3082ef+'/'+_0x574058['length']+_0x4b0b03(0x22a)+_0x3d3a6b+':\x20'+_0x28e17a),_0x3082ef>0x0;}catch(_0xa75dce){return console[_0x4b0b03(0x17e)](_0x4b0b03(0x1ea),_0xa75dce),![];}}async['sendDirectMessage'](_0x359742,_0x57887e){const _0x1ef83a=a66_0x3f7766;try{if(!this['bot'])return console['error'](_0x1ef83a(0x1e3)),![];return await this[_0x1ef83a(0x1fd)][_0x1ef83a(0x231)](_0x359742,_0x57887e),console[_0x1ef83a(0x19b)](_0x1ef83a(0x1a8)+_0x359742),!![];}catch(_0x2a08f8){return console[_0x1ef83a(0x17e)](_0x1ef83a(0x1da),_0x2a08f8),![];}}async[a66_0x3f7766(0x1a9)](_0xd85219,_0x4d9d25,_0x18e45e,_0x189b54){const _0x115b01=a66_0x3f7766;try{if(!this[_0x115b01(0x1fd)])return console[_0x115b01(0x17e)](_0x115b01(0x1e3)),![];return await this[_0x115b01(0x1fd)]['sendDocument'](_0xd85219,_0x4d9d25,{},{'filename':_0x18e45e,'contentType':_0x18e45e[_0x115b01(0x21c)](_0x115b01(0x221))?'image/png':_0x18e45e[_0x115b01(0x21c)](_0x115b01(0x200))||_0x18e45e[_0x115b01(0x21c)]('.jpeg')?_0x115b01(0x1d0):_0x18e45e['endsWith'](_0x115b01(0x254))?_0x115b01(0x233):'application/octet-stream'}),_0x189b54&&await this['bot'][_0x115b01(0x231)](_0xd85219,_0x189b54),console[_0x115b01(0x19b)](_0x115b01(0x1b5)+_0xd85219+':\x20'+_0x18e45e),!![];}catch(_0x1cb8d2){return console[_0x115b01(0x17e)](_0x115b01(0x21b),_0x1cb8d2),![];}}[a66_0x3f7766(0x1f1)](){const _0x4a2f28=a66_0x3f7766;this[_0x4a2f28(0x1fd)]&&(this['bot'][_0x4a2f28(0x19c)](),this['bot']=null,console[_0x4a2f28(0x19b)](_0x4a2f28(0x202)));}}exports[a66_0x3f7766(0x16f)]=TelegramBotService,exports[a66_0x3f7766(0x1d7)]=new TelegramBotService();