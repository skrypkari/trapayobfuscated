'use strict';const a57_0x2ca902=a57_0x2acc;(function(_0x39a4a5,_0x3874c7){const _0x473416=a57_0x2acc,_0x131c81=_0x39a4a5();while(!![]){try{const _0x27e827=parseInt(_0x473416(0xa3))/0x1*(parseInt(_0x473416(0x13d))/0x2)+-parseInt(_0x473416(0x13b))/0x3+parseInt(_0x473416(0x12e))/0x4+parseInt(_0x473416(0x113))/0x5+-parseInt(_0x473416(0xad))/0x6+-parseInt(_0x473416(0xff))/0x7+parseInt(_0x473416(0xde))/0x8*(parseInt(_0x473416(0xba))/0x9);if(_0x27e827===_0x3874c7)break;else _0x131c81['push'](_0x131c81['shift']());}catch(_0x43a906){_0x131c81['push'](_0x131c81['shift']());}}}(a57_0x2cc7,0x41c35));function a57_0x2acc(_0x55641f,_0x6e77a6){const _0x2cc7eb=a57_0x2cc7();return a57_0x2acc=function(_0x2accd6,_0x5a0817){_0x2accd6=_0x2accd6-0x91;let _0x471598=_0x2cc7eb[_0x2accd6];return _0x471598;},a57_0x2acc(_0x55641f,_0x6e77a6);}var __importDefault=this&&this[a57_0x2ca902(0xf9)]||function(_0x364714){const _0x4a311f=a57_0x2ca902;return _0x364714&&_0x364714[_0x4a311f(0x144)]?_0x364714:{'default':_0x364714};};Object[a57_0x2ca902(0x119)](exports,a57_0x2ca902(0x144),{'value':!![]}),exports['telegramBotService']=exports[a57_0x2ca902(0xd0)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a57_0x2ca902(0x99))),gateway_1=require('../types/gateway');function a57_0x2cc7(){const _0x36df9c=['entries','🏪\x20Available\x20shops\x20in\x20system:\x0a','📱\x20Created\x20new\x20Telegram\x20user:\x20','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','onText','errorMessage','📊\x20Error\x20code:\x20`','🆔\x20Request\x20ID:\x20`','Payment\x20is\x20being\x20processed','chargebackAmount','Telegram\x20bot\x20polling\x20error:','•\x20Payouts\x0a','method','•\x20Payouts\x0a\x0a','❌\x20Error\x20getting\x20debug\x20information.','failed','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','New\x20payment\x20created','*\x0a\x0a','New\x20payout\x20created','requestId','Error\x20handling\x20/debug\x20command:','Username:\x20`','You\x20sent\x20','`.\x0a\x0a','customerName','endpoint','Payment\x20expired','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','../config/database','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','🔔\x20*','🔌\x20User\x20','toString','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','log','bot','\x0aCheck\x20spelling\x20and\x20try\x20again.','chat','53TpvgGl','\x20\x20\x20Status:\x20','shopSettings','test','📅\x20Date:\x20','userAgent','polling_error','createdAt','\x20via\x20single-line\x20input','Failed\x20to\x20send\x20API\x20error\x20notification:','402840bkuPAa','stopPolling','notificationApiError','📱\x20Telegram\x20notification:\x20gateway\x20\x22','telegramBotService','\x20parts:\x20','update','botToken','/status\x20-\x20check\x20connection\x20status\x0a','🔗\x20Endpoint:\x20`','🌐\x20IP\x20address:\x20`','❌\x20Shop\x20with\x20username\x20`','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','170055kUnnBI','sendShopNotification','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','✅\x20Welcome\x20back!\x0a\x0a','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','/disconnect\x20-\x20disconnect\x20from\x20notifications','chargeback','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','📊\x20*Connection\x20Status*\x0a\x0a','botUsername','Payout\x20completed','🏦\x20Method:\x20`','length','To\x20reconnect,\x20use\x20the\x20/start\x20command','Commands:\x0a','trim','\x20(@','Example:\x0a','📱\x20Your\x20Telegram\x20ID:\x20`','TelegramBotService','unknown\x20shop','txid','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','•\x20New\x20payments\x0a','currency','👤\x20Username:\x20`','shopId',':\x20`','Error\x20handling\x20/disconnect\x20command:',':\x20username=\x22','✅\x20Connected\x20to\x20shop:\x20*','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','customerEmail','80eIzbTT','•\x20Important\x20events\x0a\x0a','🔔\x20Notifications\x20are\x20active\x0a\x0a','sendPayoutNotification','ACTIVE','Check\x20spelling\x20and\x20try\x20again.','error','Failed\x20login\x20attempt','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','telegramUser','`\x20(','remitterIban','last_name','env','🏪\x20Gateway:\x20`','🔗\x20TXID:\x20`','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','en-US','Successful\x20login','sendMessage','setupBotHandlers','Telegram\x20bot\x20error:','TELEGRAM_BOT_TOKEN','includes','name','🎉\x20*Congratulations!*\x0a\x0a','sendPaymentNotification','__importDefault','`\x20not\x20found.\x0a\x0a','statusCode','Payment\x20chargeback','`\x20is\x20inactive.\x0a\x0a','TELEGRAM_BOT_USERNAME','1415288MelzOx','💰\x20Amount:\x20*','🏦\x20IBAN:\x20`','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','•\x20`','trapay_bot','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','join','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','Payment\x20successfully\x20paid','📅\x20Time:\x20','telegramId','startsWith','success','🛑\x20Telegram\x20bot\x20stopped','🚨\x20*API\x20Error*\x0a\x0a','❌\x20Error:\x20`','💸\x20Amount:\x20*','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','user\x20is\x20deactivated','673230hwYFhL','📝\x20Order\x20ID:\x20`','toLocaleString','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','from','...','defineProperty','split','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','orderId','create','initializeBot','default','blocked','customerIp','•\x20Payment\x20status\x20changes\x0a','processing','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','text','🆔\x20Payment\x20ID:\x20`','gateway','updatedAt','warn','\x20\x20\x20Username:\x20`','amount','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','Error\x20handling\x20/status\x20command:','1696724WbArOf','*.\x0a\x0a','\x22,\x20apiKey=\x22','findMany','message','sendLoginNotification','handleSingleLineVerification','Error\x20handling\x20/start\x20command:','📧\x20Email:\x20`','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','substring','customerUa','1475211OSRiaz','pk_','10666nUdrqB','\x22\x20->\x20display\x20\x22','Markdown','findUnique','❌\x20Invalid\x20username\x20format:\x20`','isVerified','...\x22','__esModule','username','Failed\x20to\x20send\x20login\x20notification:','📝\x20Notes:\x20','Contact\x20administrator.','.\x20*','secretKey','📛\x20Name:\x20`','forEach','Error\x20sending\x20shop\x20notification:','`\x0a\x0a','🌐\x20IP:\x20`','shop','adminNotes','map','Payment\x20refund'];a57_0x2cc7=function(){return _0x36df9c;};return a57_0x2cc7();}class TelegramBotService{constructor(){const _0x425582=a57_0x2ca902;this[_0x425582(0xa0)]=null,this['botToken']=process[_0x425582(0xeb)][_0x425582(0xf4)]||'',this[_0x425582(0xc6)]=process['env'][_0x425582(0xfe)]||_0x425582(0x104),this[_0x425582(0xb4)]?this[_0x425582(0x11e)]():console[_0x425582(0x129)](_0x425582(0x166));}[a57_0x2ca902(0x11e)](){const _0x59eb40=a57_0x2ca902;try{this['bot']=new node_telegram_bot_api_1[(_0x59eb40(0x11f))](this[_0x59eb40(0xb4)],{'polling':!![]}),this[_0x59eb40(0xf2)](),console[_0x59eb40(0x9f)]('✅\x20Telegram\x20bot\x20@'+this['botUsername']+'\x20initialized\x20successfully');}catch(_0x416060){console['error']('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x416060);}}[a57_0x2ca902(0xf2)](){const _0x49d09f=a57_0x2ca902;if(!this[_0x49d09f(0xa0)])return;this[_0x49d09f(0xa0)]['onText'](/\/start/,async _0x61fcd9=>{const _0x37578f=_0x49d09f,_0x7964b4=_0x61fcd9[_0x37578f(0xa2)]['id'],_0x42a905=_0x61fcd9['from']?.['id'][_0x37578f(0x9d)](),_0x51a9fa=_0x61fcd9['from']?.[_0x37578f(0x145)],_0x34313b=_0x61fcd9[_0x37578f(0x117)]?.['first_name'],_0x27bfc6=_0x61fcd9[_0x37578f(0x117)]?.[_0x37578f(0xea)];if(!_0x42a905)return;try{let _0x351b1c=await database_1[_0x37578f(0x11f)][_0x37578f(0xe7)][_0x37578f(0x140)]({'where':{'telegramId':_0x42a905},'include':{'shop':!![]}});!_0x351b1c?(_0x351b1c=await database_1['default']['telegramUser'][_0x37578f(0x11d)]({'data':{'telegramId':_0x42a905,'username':_0x51a9fa,'firstName':_0x34313b,'lastName':_0x27bfc6,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x37578f(0x9f)](_0x37578f(0x156)+_0x42a905+_0x37578f(0xcd)+_0x51a9fa+')')):_0x351b1c=await database_1[_0x37578f(0x11f)]['telegramUser'][_0x37578f(0xb3)]({'where':{'telegramId':_0x42a905},'data':{'username':_0x51a9fa,'firstName':_0x34313b,'lastName':_0x27bfc6},'include':{'shop':!![]}}),_0x351b1c[_0x37578f(0x142)]&&_0x351b1c[_0x37578f(0xd7)]&&_0x351b1c[_0x37578f(0x150)]?await this['bot']?.['sendMessage'](_0x7964b4,_0x37578f(0xbe)+(_0x37578f(0x102)+_0x351b1c[_0x37578f(0x150)][_0x37578f(0xf6)]+'*\x0a')+(_0x37578f(0x92)+_0x351b1c[_0x37578f(0x150)][_0x37578f(0x145)]+_0x37578f(0x14e))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x37578f(0x122)+_0x37578f(0x163)+_0x37578f(0xcb)+_0x37578f(0xb5)+_0x37578f(0xc2),{'parse_mode':_0x37578f(0x13f)}):(_0x351b1c['shopId']&&!_0x351b1c['isVerified']&&(await database_1['default'][_0x37578f(0xe7)][_0x37578f(0xb3)]({'where':{'telegramId':_0x42a905},'data':{'shopId':null,'isVerified':![]}}),console[_0x37578f(0x9f)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x42a905)),await this[_0x37578f(0xa0)]?.[_0x37578f(0xf1)](_0x7964b4,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x37578f(0x137)+_0x37578f(0xc4)+_0x37578f(0xce)+_0x37578f(0x124)+_0x37578f(0x12c),{'parse_mode':_0x37578f(0x13f)}));}catch(_0x490663){console['error'](_0x37578f(0x135),_0x490663),await this[_0x37578f(0xa0)]?.['sendMessage'](_0x7964b4,_0x37578f(0x111));}}),this[_0x49d09f(0xa0)][_0x49d09f(0x15a)](/\/disconnect/,async _0x16df84=>{const _0x3f24a7=_0x49d09f,_0x3813bf=_0x16df84['chat']['id'],_0x18102a=_0x16df84['from']?.['id']['toString']();if(!_0x18102a)return;try{const _0x122b3a=await database_1[_0x3f24a7(0x11f)]['telegramUser'][_0x3f24a7(0x140)]({'where':{'telegramId':_0x18102a},'include':{'shop':!![]}});if(!_0x122b3a||!_0x122b3a['isVerified']||!_0x122b3a[_0x3f24a7(0xd7)]){await this['bot']?.[_0x3f24a7(0xf1)](_0x3813bf,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x4426e5=_0x122b3a[_0x3f24a7(0x150)]?.[_0x3f24a7(0xf6)]||_0x3f24a7(0xd1);await database_1[_0x3f24a7(0x11f)]['telegramUser'][_0x3f24a7(0xb3)]({'where':{'telegramId':_0x18102a},'data':{'shopId':null,'isVerified':![]}}),console[_0x3f24a7(0x9f)](_0x3f24a7(0x9c)+_0x18102a+'\x20disconnected\x20from\x20shop\x20'+_0x122b3a[_0x3f24a7(0xd7)]),await this[_0x3f24a7(0xa0)]?.[_0x3f24a7(0xf1)](_0x3813bf,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x4426e5+_0x3f24a7(0x12f)+_0x3f24a7(0xca),{'parse_mode':'Markdown'});}catch(_0x892c13){console[_0x3f24a7(0xe4)](_0x3f24a7(0xd9),_0x892c13),await this[_0x3f24a7(0xa0)]?.[_0x3f24a7(0xf1)](_0x3813bf,_0x3f24a7(0x111));}}),this['bot']['onText'](/\/status/,async _0x1fe221=>{const _0x9472e8=_0x49d09f,_0x23f8f4=_0x1fe221[_0x9472e8(0xa2)]['id'],_0x3b4c88=_0x1fe221['from']?.['id'][_0x9472e8(0x9d)]();if(!_0x3b4c88)return;try{const _0x3de325=await database_1[_0x9472e8(0x11f)][_0x9472e8(0xe7)][_0x9472e8(0x140)]({'where':{'telegramId':_0x3b4c88},'include':{'shop':!![]}});if(!_0x3de325){await this['bot']?.[_0x9472e8(0xf1)](_0x23f8f4,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+'Use\x20/start\x20to\x20begin.');return;}if(!_0x3de325[_0x9472e8(0x142)]||!_0x3de325[_0x9472e8(0xd7)]||!_0x3de325[_0x9472e8(0x150)]){await this[_0x9472e8(0xa0)]?.[_0x9472e8(0xf1)](_0x23f8f4,_0x9472e8(0x107)+'Use\x20/start\x20to\x20connect.');return;}await this['bot']?.[_0x9472e8(0xf1)](_0x23f8f4,_0x9472e8(0xc5)+(_0x9472e8(0xdb)+_0x3de325[_0x9472e8(0x150)][_0x9472e8(0xf6)]+'*\x0a')+(_0x9472e8(0xd6)+_0x3de325['shop'][_0x9472e8(0x145)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x3de325[_0x9472e8(0x128)]['toLocaleDateString']('en-US')+'\x0a\x0a')+_0x9472e8(0xe0)+_0x9472e8(0xcb)+_0x9472e8(0xc2),{'parse_mode':_0x9472e8(0x13f)});}catch(_0x5c669d){console[_0x9472e8(0xe4)](_0x9472e8(0x12d),_0x5c669d),await this['bot']?.[_0x9472e8(0xf1)](_0x23f8f4,_0x9472e8(0x111));}}),this[_0x49d09f(0xa0)][_0x49d09f(0x15a)](/\/debug/,async _0x5e7d5c=>{const _0x38dafa=_0x49d09f,_0xdbc3c7=_0x5e7d5c[_0x38dafa(0xa2)]['id'],_0x364579=_0x5e7d5c[_0x38dafa(0x117)]?.['id'][_0x38dafa(0x9d)]();if(!_0x364579)return;try{const _0xadbe13=await database_1[_0x38dafa(0x11f)][_0x38dafa(0x150)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x139400='🔍\x20*Debug\x20Information*\x0a\x0a';_0x139400+=_0x38dafa(0xcf)+_0x364579+_0x38dafa(0x14e),_0x139400+=_0x38dafa(0x155),_0xadbe13[_0x38dafa(0x14c)]((_0x344f1f,_0x4204fc)=>{const _0x22fe3d=_0x38dafa;_0x139400+=_0x4204fc+0x1+_0x22fe3d(0x149)+_0x344f1f[_0x22fe3d(0xf6)]+'*\x0a',_0x139400+=_0x22fe3d(0x12a)+_0x344f1f[_0x22fe3d(0x145)]+'`\x0a',_0x139400+=_0x22fe3d(0xa4)+_0x344f1f['status']+'\x0a',_0x139400+='\x20\x20\x20Public\x20Key:\x20`'+_0x344f1f['publicKey']['substring'](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x38dafa(0xa0)]?.[_0x38dafa(0xf1)](_0xdbc3c7,_0x139400,{'parse_mode':_0x38dafa(0x13f)});}catch(_0x43a8ce){console[_0x38dafa(0xe4)](_0x38dafa(0x91),_0x43a8ce),await this[_0x38dafa(0xa0)]?.[_0x38dafa(0xf1)](_0xdbc3c7,_0x38dafa(0x164));}}),this[_0x49d09f(0xa0)]['on'](_0x49d09f(0x132),async _0x19ac4d=>{const _0x18f9c6=_0x49d09f;if(_0x19ac4d[_0x18f9c6(0x125)]?.['startsWith']('/'))return;const _0x3e53f9=_0x19ac4d[_0x18f9c6(0xa2)]['id'],_0x2ab76c=_0x19ac4d[_0x18f9c6(0x117)]?.['id'][_0x18f9c6(0x9d)](),_0x55a06e=_0x19ac4d[_0x18f9c6(0x125)]?.[_0x18f9c6(0xcc)]();if(!_0x2ab76c||!_0x55a06e)return;try{const _0x1df731=await database_1['default']['telegramUser'][_0x18f9c6(0x140)]({'where':{'telegramId':_0x2ab76c},'include':{'shop':!![]}});if(!_0x1df731){await this[_0x18f9c6(0xa0)]?.[_0x18f9c6(0xf1)](_0x3e53f9,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x1df731[_0x18f9c6(0x142)]&&_0x1df731[_0x18f9c6(0xd7)]&&_0x1df731[_0x18f9c6(0x150)]){await this['bot']?.[_0x18f9c6(0xf1)](_0x3e53f9,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x1df731[_0x18f9c6(0x150)][_0x18f9c6(0xf6)]+_0x18f9c6(0x12f)+_0x18f9c6(0x138),{'parse_mode':_0x18f9c6(0x13f)});return;}const _0x41005e=_0x55a06e[_0x18f9c6(0x11a)](/\s+/);if(_0x41005e[_0x18f9c6(0xc9)]!==0x2){await this[_0x18f9c6(0xa0)]?.[_0x18f9c6(0xf1)](_0x3e53f9,_0x18f9c6(0xb9)+_0x18f9c6(0xc4)+'Example:\x0a'+_0x18f9c6(0x124)+(_0x18f9c6(0x93)+_0x41005e[_0x18f9c6(0xc9)]+_0x18f9c6(0xb2)+_0x41005e[_0x18f9c6(0x152)](_0xcabd50=>'`'+_0xcabd50+'`')[_0x18f9c6(0x106)](',\x20')),{'parse_mode':_0x18f9c6(0x13f)});return;}const [_0x34d34d,_0x2417fb]=_0x41005e;console['log']('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x2ab76c+_0x18f9c6(0xda)+_0x34d34d+'\x22,\x20apiKey=\x22'+_0x2417fb[_0x18f9c6(0x139)](0x0,0xa)+_0x18f9c6(0x143)),await this[_0x18f9c6(0x134)](_0x3e53f9,_0x2ab76c,_0x34d34d,_0x2417fb);}catch(_0x26caa7){console['error']('Error\x20handling\x20message:',_0x26caa7),await this[_0x18f9c6(0xa0)]?.['sendMessage'](_0x3e53f9,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['on']('error',_0x190eaa=>{const _0x142d9b=_0x49d09f;console[_0x142d9b(0xe4)](_0x142d9b(0xf3),_0x190eaa);}),this[_0x49d09f(0xa0)]['on'](_0x49d09f(0xa9),_0x164fb0=>{const _0x3cc1b0=_0x49d09f;console['error'](_0x3cc1b0(0x160),_0x164fb0);});}async[a57_0x2ca902(0x134)](_0x208364,_0x430481,_0x39d5b8,_0x3819b3){const _0x488dc2=a57_0x2ca902;try{console[_0x488dc2(0x9f)](_0x488dc2(0x9e)+_0x430481+_0x488dc2(0xda)+_0x39d5b8+_0x488dc2(0x130)+_0x3819b3[_0x488dc2(0x139)](0x0,0xa)+'...\x22');if(!_0x39d5b8||_0x39d5b8[_0x488dc2(0xc9)]<0x3||_0x39d5b8[_0x488dc2(0xc9)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x488dc2(0xa6)](_0x39d5b8)){await this['bot']?.[_0x488dc2(0xf1)](_0x208364,_0x488dc2(0x141)+_0x39d5b8+_0x488dc2(0x14e)+_0x488dc2(0x168),{'parse_mode':_0x488dc2(0x13f)});return;}if(!_0x3819b3||!_0x3819b3[_0x488dc2(0x10b)](_0x488dc2(0x13c))&&!_0x3819b3[_0x488dc2(0x10b)]('sk_')){await this[_0x488dc2(0xa0)]?.[_0x488dc2(0xf1)](_0x208364,_0x488dc2(0x157)+_0x488dc2(0xc0),{'parse_mode':_0x488dc2(0x13f)});return;}const _0x49daf4=await database_1[_0x488dc2(0x11f)]['shop'][_0x488dc2(0x140)]({'where':{'username':_0x39d5b8},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x49daf4){const _0x1da0a3=await database_1['default'][_0x488dc2(0x150)][_0x488dc2(0x131)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x2a4bea=_0x488dc2(0xb8)+_0x39d5b8+_0x488dc2(0xfa);_0x1da0a3[_0x488dc2(0xc9)]>0x0?(_0x2a4bea+='Available\x20usernames:\x0a',_0x1da0a3[_0x488dc2(0x14c)](_0x45ed33=>{const _0x5eb69c=_0x488dc2;_0x2a4bea+=_0x5eb69c(0x103)+_0x45ed33[_0x5eb69c(0x145)]+_0x5eb69c(0xe8)+_0x45ed33['name']+')\x0a';}),_0x2a4bea+=_0x488dc2(0xa1)):_0x2a4bea+=_0x488dc2(0xe3);await this['bot']?.[_0x488dc2(0xf1)](_0x208364,_0x2a4bea,{'parse_mode':'Markdown'});return;}if(_0x49daf4['status']!==_0x488dc2(0xe2)){await this[_0x488dc2(0xa0)]?.['sendMessage'](_0x208364,'❌\x20Shop\x20`'+_0x39d5b8+_0x488dc2(0xfd)+_0x488dc2(0x148),{'parse_mode':'Markdown'});return;}if(_0x49daf4['publicKey']!==_0x3819b3&&_0x49daf4[_0x488dc2(0x14a)]!==_0x3819b3){await this['bot']?.[_0x488dc2(0xf1)](_0x208364,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x39d5b8+'`.\x0a\x0a'+_0x488dc2(0x11b)+_0x488dc2(0x98),{'parse_mode':_0x488dc2(0x13f)});return;}const _0x1c1cfb=await database_1[_0x488dc2(0x11f)][_0x488dc2(0xe7)]['findFirst']({'where':{'shopId':_0x49daf4['id'],'isVerified':!![],'telegramId':{'not':_0x430481}}});if(_0x1c1cfb){await this[_0x488dc2(0xa0)]?.[_0x488dc2(0xf1)](_0x208364,_0x488dc2(0x116)+_0x39d5b8+_0x488dc2(0x94)+_0x488dc2(0x159),{'parse_mode':_0x488dc2(0x13f)});return;}await database_1[_0x488dc2(0x11f)][_0x488dc2(0xe7)][_0x488dc2(0xb3)]({'where':{'telegramId':_0x430481},'data':{'shopId':_0x49daf4['id'],'isVerified':!![]}}),await this[_0x488dc2(0xa0)]?.[_0x488dc2(0xf1)](_0x208364,_0x488dc2(0xf7)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('📱\x20Shop:\x20*'+_0x49daf4['name']+'*\x0a')+(_0x488dc2(0xd6)+_0x49daf4[_0x488dc2(0x145)]+'`\x0a\x0a')+_0x488dc2(0x167)+_0x488dc2(0xd4)+'•\x20Payment\x20status\x20changes\x0a'+_0x488dc2(0x161)+_0x488dc2(0xdf)+_0x488dc2(0xcb)+_0x488dc2(0xb5)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x488dc2(0x13f)}),console[_0x488dc2(0x9f)]('✅\x20Telegram\x20user\x20'+_0x430481+'\x20verified\x20for\x20shop\x20'+_0x49daf4[_0x488dc2(0x145)]+_0x488dc2(0xab));}catch(_0x38816c){console[_0x488dc2(0xe4)]('Error\x20in\x20handleSingleLineVerification:',_0x38816c),await this['bot']?.[_0x488dc2(0xf1)](_0x208364,_0x488dc2(0xc1));}}async['sendShopNotification'](_0x25a0b8,_0x97659b,_0x1509cf){const _0x4f4124=a57_0x2ca902;if(!this[_0x4f4124(0xa0)]){console[_0x4f4124(0x129)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x45726c=await database_1[_0x4f4124(0x11f)]['telegramUser'][_0x4f4124(0x131)]({'where':{'shopId':_0x25a0b8,'isVerified':!![]}});if(_0x45726c[_0x4f4124(0xc9)]===0x0){console[_0x4f4124(0x9f)](_0x4f4124(0xdc)+_0x25a0b8);return;}const _0x267f70=_0x45726c['map'](async _0x4aa5c6=>{const _0x2aba84=_0x4f4124;try{await this[_0x2aba84(0xa0)]?.['sendMessage'](_0x4aa5c6[_0x2aba84(0x10a)],_0x97659b,_0x1509cf),console[_0x2aba84(0x9f)](_0x2aba84(0x158)+_0x4aa5c6['telegramId']);}catch(_0x2d9d62){console[_0x2aba84(0xe4)](_0x2aba84(0xe6)+_0x4aa5c6['telegramId']+':',_0x2d9d62),_0x2d9d62 instanceof Error&&(_0x2d9d62[_0x2aba84(0x132)][_0x2aba84(0xf5)](_0x2aba84(0x120))||_0x2d9d62['message'][_0x2aba84(0xf5)]('chat\x20not\x20found')||_0x2d9d62[_0x2aba84(0x132)]['includes'](_0x2aba84(0x112)))&&(await database_1[_0x2aba84(0x11f)][_0x2aba84(0xe7)][_0x2aba84(0xb3)]({'where':{'id':_0x4aa5c6['id']},'data':{'isVerified':![]}}),console['log']('User\x20'+_0x4aa5c6['telegramId']+_0x2aba84(0xbc)));}});await Promise['allSettled'](_0x267f70);}catch(_0x47795d){console[_0x4f4124(0xe4)](_0x4f4124(0x14d),_0x47795d);}}async[a57_0x2ca902(0xf8)](_0x12908b,_0x2b9f33,_0x59cc1c){const _0x153c24=a57_0x2ca902,_0x151690={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x55203b={'created':_0x153c24(0x169),'paid':_0x153c24(0x108),'failed':'Payment\x20failed','expired':_0x153c24(0x97),'refund':_0x153c24(0x153),'chargeback':_0x153c24(0xfc),'processing':_0x153c24(0x15e)},_0x2433f4=_0x151690[_0x59cc1c],_0x230b7c=_0x55203b[_0x59cc1c],_0x4aa2f9=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x2b9f33[_0x153c24(0x127)]);console[_0x153c24(0x9f)](_0x153c24(0xb0)+_0x2b9f33['gateway']+_0x153c24(0x13e)+_0x4aa2f9+'\x22');let _0x3a1fba=_0x2433f4+'\x20*'+_0x230b7c+_0x153c24(0x16a)+(_0x153c24(0x100)+_0x2b9f33[_0x153c24(0x12b)]+'\x20'+_0x2b9f33[_0x153c24(0xd5)]+'*\x0a')+(_0x153c24(0x114)+(_0x2b9f33[_0x153c24(0x11c)]||_0x2b9f33['id'])+'`\x0a')+(_0x153c24(0x126)+_0x2b9f33['id']+'`\x0a')+(_0x153c24(0xec)+_0x4aa2f9+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x2b9f33[_0x153c24(0xaa)])[_0x153c24(0x115)](_0x153c24(0xef))+'\x0a');if(_0x2b9f33[_0x153c24(0x95)]||_0x2b9f33[_0x153c24(0xdd)]||_0x2b9f33['remitterIban']||_0x2b9f33[_0x153c24(0x121)]||_0x2b9f33[_0x153c24(0x13a)]){_0x3a1fba+='\x0a👤\x20*Customer\x20Information:*\x0a';_0x2b9f33[_0x153c24(0x95)]&&(_0x3a1fba+=_0x153c24(0x14b)+_0x2b9f33[_0x153c24(0x95)]+'`\x0a');_0x2b9f33[_0x153c24(0xdd)]&&(_0x3a1fba+=_0x153c24(0x136)+_0x2b9f33[_0x153c24(0xdd)]+'`\x0a');_0x2b9f33[_0x153c24(0xe9)]&&(_0x3a1fba+=_0x153c24(0x101)+_0x2b9f33[_0x153c24(0xe9)]+'`\x0a');_0x2b9f33[_0x153c24(0x121)]&&(_0x3a1fba+=_0x153c24(0x14f)+_0x2b9f33[_0x153c24(0x121)]+'`\x0a');if(_0x2b9f33[_0x153c24(0x13a)]){const _0x94179a=_0x2b9f33[_0x153c24(0x13a)]['length']>0x32?_0x2b9f33[_0x153c24(0x13a)][_0x153c24(0x139)](0x0,0x32)+_0x153c24(0x118):_0x2b9f33[_0x153c24(0x13a)];_0x3a1fba+='💻\x20Browser:\x20`'+_0x94179a+'`\x0a';}}_0x59cc1c===_0x153c24(0xc3)&&_0x2b9f33[_0x153c24(0x15f)]&&(_0x3a1fba+='💸\x20Penalty\x20amount:\x20*'+_0x2b9f33[_0x153c24(0x15f)]+'\x20USDT*\x0a'),_0x59cc1c===_0x153c24(0x123)&&(_0x3a1fba+=_0x153c24(0xd3)),_0x2b9f33[_0x153c24(0x151)]&&(_0x3a1fba+=_0x153c24(0x147)+_0x2b9f33[_0x153c24(0x151)]+'\x0a'),await this[_0x153c24(0xbb)](_0x12908b,_0x3a1fba,{'parse_mode':_0x153c24(0x13f)});}async[a57_0x2ca902(0xe1)](_0x57124c,_0x4d4eca,_0x470bb){const _0x3fd2af=a57_0x2ca902,_0x495318={'created':'📤','completed':'✅','rejected':'❌'},_0x46992f={'created':_0x3fd2af(0x16b),'completed':_0x3fd2af(0xc7),'rejected':'Payout\x20rejected'},_0x338994=_0x495318[_0x470bb],_0x1466e4=_0x46992f[_0x470bb],_0x4a12b3=_0x338994+'\x20*'+_0x1466e4+_0x3fd2af(0x16a)+(_0x3fd2af(0x110)+_0x4d4eca[_0x3fd2af(0x12b)]+'\x20USD*\x0a')+(_0x3fd2af(0xc8)+_0x4d4eca[_0x3fd2af(0x162)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x4d4eca['id']+'`\x0a')+(_0x3fd2af(0xa7)+new Date(_0x4d4eca[_0x3fd2af(0xaa)])[_0x3fd2af(0x115)](_0x3fd2af(0xef))+'\x0a')+(_0x4d4eca[_0x3fd2af(0xd2)]?_0x3fd2af(0xed)+_0x4d4eca[_0x3fd2af(0xd2)]+'`':'');await this[_0x3fd2af(0xbb)](_0x57124c,_0x4a12b3,{'parse_mode':_0x3fd2af(0x13f)});}async[a57_0x2ca902(0x133)](_0x164ba9,_0x125cc1){const _0x1c40dc=a57_0x2ca902;try{const _0x13e661=await database_1[_0x1c40dc(0x11f)]['shopSettings'][_0x1c40dc(0x140)]({'where':{'shopId':_0x164ba9},'select':{'notificationLogin':!![]}});if(!_0x13e661?.['notificationLogin']){console[_0x1c40dc(0x9f)](_0x1c40dc(0x9a)+_0x164ba9);return;}const _0x51917b=_0x125cc1['success']?'🔐':'🚨',_0x15033d=_0x125cc1[_0x1c40dc(0x10c)]?_0x1c40dc(0xf0):_0x1c40dc(0xe5);let _0x3e0495=_0x51917b+'\x20*'+_0x15033d+'*\x0a\x0a'+('👤\x20Username:\x20`'+_0x125cc1[_0x1c40dc(0x145)]+'`\x0a')+(_0x1c40dc(0x109)+_0x125cc1['timestamp'][_0x1c40dc(0x115)]('en-US')+'\x0a');_0x125cc1['ipAddress']&&(_0x3e0495+=_0x1c40dc(0xb7)+_0x125cc1['ipAddress']+'`\x0a');if(_0x125cc1[_0x1c40dc(0xa8)]){const _0x530f35=_0x125cc1[_0x1c40dc(0xa8)][_0x1c40dc(0xc9)]>0x32?_0x125cc1[_0x1c40dc(0xa8)][_0x1c40dc(0x139)](0x0,0x32)+_0x1c40dc(0x118):_0x125cc1['userAgent'];_0x3e0495+='💻\x20Browser:\x20`'+_0x530f35+'`\x0a';}!_0x125cc1['success']&&(_0x3e0495+=_0x1c40dc(0xee)),await this[_0x1c40dc(0xbb)](_0x164ba9,_0x3e0495,{'parse_mode':'Markdown'}),console[_0x1c40dc(0x9f)](_0x1c40dc(0xbf)+_0x164ba9+':\x20'+(_0x125cc1['success']?_0x1c40dc(0x10c):_0x1c40dc(0x165)));}catch(_0x57b7b5){console[_0x1c40dc(0xe4)](_0x1c40dc(0x146),_0x57b7b5);}}async['sendApiErrorNotification'](_0x42e4c1,_0x20b7ea){const _0x1209ba=a57_0x2ca902;try{const _0xf56ae6=await database_1[_0x1209ba(0x11f)][_0x1209ba(0xa5)][_0x1209ba(0x140)]({'where':{'shopId':_0x42e4c1},'select':{'notificationApiError':!![]}});if(!_0xf56ae6?.[_0x1209ba(0xaf)]){console[_0x1209ba(0x9f)](_0x1209ba(0xbd)+_0x42e4c1);return;}let _0x28e9e9=_0x1209ba(0x10e)+(_0x1209ba(0xb6)+_0x20b7ea[_0x1209ba(0x162)]+'\x20'+_0x20b7ea[_0x1209ba(0x96)]+'`\x0a')+(_0x1209ba(0x109)+_0x20b7ea['timestamp'][_0x1209ba(0x115)](_0x1209ba(0xef))+'\x0a');_0x20b7ea['statusCode']&&(_0x28e9e9+=_0x1209ba(0x15c)+_0x20b7ea[_0x1209ba(0xfb)]+'`\x0a'),_0x28e9e9+=_0x1209ba(0x10f)+_0x20b7ea[_0x1209ba(0x15b)]+'`\x0a',_0x20b7ea[_0x1209ba(0x16c)]&&(_0x28e9e9+=_0x1209ba(0x15d)+_0x20b7ea['requestId']+'`\x0a'),_0x28e9e9+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x1209ba(0xbb)](_0x42e4c1,_0x28e9e9,{'parse_mode':_0x1209ba(0x13f)}),console['log'](_0x1209ba(0x105)+_0x42e4c1+':\x20'+_0x20b7ea[_0x1209ba(0x96)]);}catch(_0x13163d){console[_0x1209ba(0xe4)](_0x1209ba(0xac),_0x13163d);}}async['sendCustomNotification'](_0x5c61d3,_0x1a4768,_0x3df295){const _0x3b8ae0=a57_0x2ca902;let _0x375888=_0x3b8ae0(0x9b)+_0x1a4768+_0x3b8ae0(0x16a);for(const [_0x289511,_0x56a778]of Object[_0x3b8ae0(0x154)](_0x3df295)){_0x56a778!==null&&_0x56a778!==undefined&&(_0x375888+=_0x289511+_0x3b8ae0(0xd8)+_0x56a778+'`\x0a');}await this[_0x3b8ae0(0xbb)](_0x5c61d3,_0x375888,{'parse_mode':_0x3b8ae0(0x13f)});}['getBotInfo'](){const _0x7d8ed9=a57_0x2ca902;return{'isActive':!!this[_0x7d8ed9(0xa0)],'username':this[_0x7d8ed9(0xc6)]};}['stopBot'](){const _0x288735=a57_0x2ca902;this[_0x288735(0xa0)]&&(this[_0x288735(0xa0)][_0x288735(0xae)](),this['bot']=null,console['log'](_0x288735(0x10d)));}}exports['TelegramBotService']=TelegramBotService,exports[a57_0x2ca902(0xb1)]=new TelegramBotService();