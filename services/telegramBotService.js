'use strict';const a54_0x39e796=a54_0x514a;(function(_0x1990b1,_0x398ea1){const _0x2281bb=a54_0x514a,_0x1fffcc=_0x1990b1();while(!![]){try{const _0x1af2af=parseInt(_0x2281bb(0x1dc))/0x1*(parseInt(_0x2281bb(0x166))/0x2)+-parseInt(_0x2281bb(0x1f2))/0x3+parseInt(_0x2281bb(0x1e2))/0x4+parseInt(_0x2281bb(0x1df))/0x5+parseInt(_0x2281bb(0x178))/0x6*(-parseInt(_0x2281bb(0x1d1))/0x7)+parseInt(_0x2281bb(0x1c9))/0x8+parseInt(_0x2281bb(0x192))/0x9*(parseInt(_0x2281bb(0x119))/0xa);if(_0x1af2af===_0x398ea1)break;else _0x1fffcc['push'](_0x1fffcc['shift']());}catch(_0x213898){_0x1fffcc['push'](_0x1fffcc['shift']());}}}(a54_0x367b,0x3f1cc));var __importDefault=this&&this[a54_0x39e796(0x186)]||function(_0x266558){return _0x266558&&_0x266558['__esModule']?_0x266558:{'default':_0x266558};};Object['defineProperty'](exports,a54_0x39e796(0x150),{'value':!![]}),exports[a54_0x39e796(0x1f1)]=exports[a54_0x39e796(0x113)]=void 0x0;function a54_0x514a(_0x16ec8c,_0x51a535){const _0x367b87=a54_0x367b();return a54_0x514a=function(_0x514a18,_0x5197af){_0x514a18=_0x514a18-0x111;let _0x196090=_0x367b87[_0x514a18];return _0x196090;},a54_0x514a(_0x16ec8c,_0x51a535);}const node_telegram_bot_api_1=__importDefault(require(a54_0x39e796(0x1e4))),database_1=__importDefault(require('../config/database')),gateway_1=require(a54_0x39e796(0x1a8));function a54_0x367b(){const _0x51d88a=['statusCode','node-telegram-bot-api','•\x20`','customerIp','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','warn','📅\x20Date:\x20','getGatewayDisplayNameForTelegram','bot','❌\x20Error:\x20`','trim','\x0aCheck\x20spelling\x20and\x20try\x20again.','User\x20','from','telegramBotService','1393740dUlTfy','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','*\x0a\x0a','✅\x20Connected\x20to\x20shop:\x20*','🔗\x20Endpoint:\x20`',':\x20username=\x22','onText','join','customerName','length','📊\x20*Connection\x20Status*\x0a\x0a','updatedAt','✅\x20Telegram\x20user\x20','telegramId','•\x20Important\x20events\x0a\x0a','TelegramBotService','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','username','TELEGRAM_BOT_TOKEN','remitterIban','setupBotHandlers','30rXBXOW','🔌\x20User\x20','Telegram\x20bot\x20error:','📝\x20Order\x20ID:\x20`','last_name','create','name','processing','🌐\x20IP:\x20`','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','telegramUser','\x22,\x20apiKey=\x22','Error\x20handling\x20/start\x20command:','Markdown','Check\x20spelling\x20and\x20try\x20again.','Payment\x20chargeback','💸\x20Penalty\x20amount:\x20*','error','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','botUsername','map','💸\x20Amount:\x20*','✅\x20Telegram\x20bot\x20@','*.\x0a\x0a','update','New\x20payment\x20created','TELEGRAM_BOT_USERNAME','Error\x20in\x20handleSingleLineVerification:','Payment\x20failed','Error\x20sending\x20shop\x20notification:','❌\x20Please\x20use\x20/start\x20command\x20first','default','polling_error','\x20disconnected\x20from\x20shop\x20','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','initializeBot','Error\x20handling\x20/status\x20command:','toLocaleDateString','Payment\x20is\x20being\x20processed','🔔\x20Notifications\x20are\x20active\x0a\x0a','substring','notificationApiError','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','🚨\x20*API\x20Error*\x0a\x0a','🆔\x20Payment\x20ID:\x20`','sendApiErrorNotification','/disconnect\x20-\x20disconnect\x20from\x20notifications','🏪\x20Available\x20shops\x20in\x20system:\x0a','findMany','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','🔔\x20You\x20receive\x20notifications\x20about:\x0a','💰\x20Amount:\x20*','requestId','method','__esModule','userAgent','log','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','Error\x20handling\x20/debug\x20command:','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','text','botToken','failed','\x20parts:\x20',':\x20`','📅\x20Connection\x20date:\x20','\x20initialized\x20successfully','🎉\x20*Congratulations!*\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','chargebackAmount','\x20via\x20single-line\x20input','📱\x20Telegram\x20notification:\x20gateway\x20\x22','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','en-US','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','2IhXiVP','sk_','\x0a👤\x20*Customer\x20Information:*\x0a','success','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','🔍\x20*Debug\x20Information*\x0a\x0a','notificationLogin','Contact\x20administrator.','Commands:\x0a','\x22\x20->\x20display\x20\x22','includes','customerEmail','📊\x20Error\x20code:\x20`','toString','test','chat','ipAddress','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','2095404GxfRll','status','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','orderId','Payment\x20expired','customerUa','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','Payment\x20successfully\x20paid','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','\x20\x20\x20Username:\x20`','createdAt','Use\x20/start\x20to\x20connect.','adminNotes','__importDefault','•\x20New\x20payments\x0a','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','message','txid','Failed\x20login\x20attempt','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','📧\x20Email:\x20`','\x20\x20\x20Public\x20Key:\x20`','•\x20Payment\x20status\x20changes\x0a','split','265941ZvcYOM','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','📛\x20Name:\x20`','.\x20*','\x20verified\x20for\x20shop\x20','•\x20Payouts\x0a\x0a','...\x22','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','Error\x20handling\x20/disconnect\x20command:','🆔\x20Request\x20ID:\x20`','...','❌\x20Shop\x20with\x20username\x20`','...`\x0a\x0a','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','Example:\x0a','errorMessage','forEach','findUnique','sendMessage','Telegram\x20bot\x20polling\x20error:','../types/gateway','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','📱\x20Your\x20Telegram\x20ID:\x20`','amount','allSettled','Failed\x20to\x20send\x20login\x20notification:','\x20\x20\x20Status:\x20','Error\x20handling\x20message:','❌\x20Error\x20getting\x20debug\x20information.','isVerified','👤\x20Username:\x20`','shopId','user\x20is\x20deactivated','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','trapay_bot','endpoint','publicKey','getBotInfo','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','env','gateway','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','Use\x20/start\x20to\x20begin.','🔔\x20*','`\x20(','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','Payout\x20completed','🏦\x20IBAN:\x20`','findFirst','entries','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','shop','Successful\x20login','3523176OLSKdR','💻\x20Browser:\x20`','ACTIVE','startsWith','📱\x20Shop:\x20*','`.\x0a\x0a','/status\x20-\x20check\x20connection\x20status\x0a','•\x20Payouts\x0a','7PKXtjl','toLocaleString','stopPolling','pk_','✅\x20Welcome\x20back!\x0a\x0a','timestamp','\x20(@','secretKey','`\x0a\x0a','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','blocked','10391FIlGca','handleSingleLineVerification','stopBot','2071745cyugqJ','sendShopNotification','You\x20sent\x20','474152ErFxwR'];a54_0x367b=function(){return _0x51d88a;};return a54_0x367b();}class TelegramBotService{constructor(){const _0x55323d=a54_0x39e796;this[_0x55323d(0x1eb)]=null,this[_0x55323d(0x157)]=process[_0x55323d(0x1bb)][_0x55323d(0x116)]||'',this[_0x55323d(0x12c)]=process[_0x55323d(0x1bb)][_0x55323d(0x133)]||_0x55323d(0x1b6),this[_0x55323d(0x157)]?this[_0x55323d(0x13d)]():console[_0x55323d(0x1e8)](_0x55323d(0x19a));}['initializeBot'](){const _0x1f04e5=a54_0x39e796;try{this['bot']=new node_telegram_bot_api_1[(_0x1f04e5(0x138))](this[_0x1f04e5(0x157)],{'polling':!![]}),this[_0x1f04e5(0x118)](),console[_0x1f04e5(0x152)](_0x1f04e5(0x12f)+this['botUsername']+_0x1f04e5(0x15c));}catch(_0xb1d3a1){console['error'](_0x1f04e5(0x181),_0xb1d3a1);}}[a54_0x39e796(0x118)](){const _0x33b221=a54_0x39e796;if(!this[_0x33b221(0x1eb)])return;this[_0x33b221(0x1eb)]['onText'](/\/start/,async _0x2a928f=>{const _0x530e80=_0x33b221,_0x551ea2=_0x2a928f['chat']['id'],_0x569cec=_0x2a928f[_0x530e80(0x1f0)]?.['id'][_0x530e80(0x173)](),_0x8da1c0=_0x2a928f[_0x530e80(0x1f0)]?.['username'],_0x3d13d7=_0x2a928f[_0x530e80(0x1f0)]?.['first_name'],_0x8b6810=_0x2a928f['from']?.[_0x530e80(0x11d)];if(!_0x569cec)return;try{let _0x4f6b21=await database_1[_0x530e80(0x138)][_0x530e80(0x123)][_0x530e80(0x1a5)]({'where':{'telegramId':_0x569cec},'include':{'shop':!![]}});!_0x4f6b21?(_0x4f6b21=await database_1[_0x530e80(0x138)][_0x530e80(0x123)][_0x530e80(0x11e)]({'data':{'telegramId':_0x569cec,'username':_0x8da1c0,'firstName':_0x3d13d7,'lastName':_0x8b6810,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x530e80(0x152)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x569cec+_0x530e80(0x1d7)+_0x8da1c0+')')):_0x4f6b21=await database_1[_0x530e80(0x138)][_0x530e80(0x123)]['update']({'where':{'telegramId':_0x569cec},'data':{'username':_0x8da1c0,'firstName':_0x3d13d7,'lastName':_0x8b6810},'include':{'shop':!![]}}),_0x4f6b21[_0x530e80(0x1b1)]&&_0x4f6b21['shopId']&&_0x4f6b21[_0x530e80(0x1c7)]?await this[_0x530e80(0x1eb)]?.[_0x530e80(0x1a6)](_0x551ea2,_0x530e80(0x1d5)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x4f6b21[_0x530e80(0x1c7)][_0x530e80(0x11f)]+'*\x0a')+('Username:\x20`'+_0x4f6b21[_0x530e80(0x1c7)]['username']+_0x530e80(0x1d9))+_0x530e80(0x14c)+_0x530e80(0x187)+_0x530e80(0x190)+_0x530e80(0x197)+_0x530e80(0x16e)+_0x530e80(0x1cf)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}):(_0x4f6b21[_0x530e80(0x1b3)]&&!_0x4f6b21[_0x530e80(0x1b1)]&&(await database_1['default'][_0x530e80(0x123)][_0x530e80(0x131)]({'where':{'telegramId':_0x569cec},'data':{'shopId':null,'isVerified':![]}}),console[_0x530e80(0x152)](_0x530e80(0x155)+_0x569cec)),await this[_0x530e80(0x1eb)]?.[_0x530e80(0x1a6)](_0x551ea2,_0x530e80(0x1da)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x530e80(0x17a)+_0x530e80(0x1a2)+_0x530e80(0x13c)+_0x530e80(0x14b),{'parse_mode':_0x530e80(0x126)}));}catch(_0x2ed6ee){console[_0x530e80(0x12a)](_0x530e80(0x125),_0x2ed6ee),await this[_0x530e80(0x1eb)]?.[_0x530e80(0x1a6)](_0x551ea2,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['onText'](/\/disconnect/,async _0x5631bc=>{const _0x5a725e=_0x33b221,_0x42ee84=_0x5631bc['chat']['id'],_0x278c37=_0x5631bc['from']?.['id'][_0x5a725e(0x173)]();if(!_0x278c37)return;try{const _0x53c69b=await database_1[_0x5a725e(0x138)][_0x5a725e(0x123)][_0x5a725e(0x1a5)]({'where':{'telegramId':_0x278c37},'include':{'shop':!![]}});if(!_0x53c69b||!_0x53c69b[_0x5a725e(0x1b1)]||!_0x53c69b[_0x5a725e(0x1b3)]){await this[_0x5a725e(0x1eb)]?.[_0x5a725e(0x1a6)](_0x42ee84,_0x5a725e(0x15e));return;}const _0x5e96f9=_0x53c69b['shop']?.[_0x5a725e(0x11f)]||'unknown\x20shop';await database_1[_0x5a725e(0x138)][_0x5a725e(0x123)][_0x5a725e(0x131)]({'where':{'telegramId':_0x278c37},'data':{'shopId':null,'isVerified':![]}}),console[_0x5a725e(0x152)](_0x5a725e(0x11a)+_0x278c37+_0x5a725e(0x13a)+_0x53c69b['shopId']),await this[_0x5a725e(0x1eb)]?.[_0x5a725e(0x1a6)](_0x42ee84,_0x5a725e(0x1f3)+_0x5e96f9+_0x5a725e(0x130)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x5a725e(0x126)});}catch(_0x468871){console[_0x5a725e(0x12a)](_0x5a725e(0x19b),_0x468871),await this[_0x5a725e(0x1eb)]?.['sendMessage'](_0x42ee84,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x33b221(0x1eb)][_0x33b221(0x1f8)](/\/status/,async _0x44a1f5=>{const _0xa98570=_0x33b221,_0x1f01c1=_0x44a1f5[_0xa98570(0x175)]['id'],_0x21d559=_0x44a1f5[_0xa98570(0x1f0)]?.['id'][_0xa98570(0x173)]();if(!_0x21d559)return;try{const _0x15fe19=await database_1['default']['telegramUser'][_0xa98570(0x1a5)]({'where':{'telegramId':_0x21d559},'include':{'shop':!![]}});if(!_0x15fe19){await this['bot']?.[_0xa98570(0x1a6)](_0x1f01c1,_0xa98570(0x1a1)+_0xa98570(0x1be));return;}if(!_0x15fe19[_0xa98570(0x1b1)]||!_0x15fe19[_0xa98570(0x1b3)]||!_0x15fe19[_0xa98570(0x1c7)]){await this['bot']?.[_0xa98570(0x1a6)](_0x1f01c1,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0xa98570(0x184));return;}await this['bot']?.[_0xa98570(0x1a6)](_0x1f01c1,_0xa98570(0x1fc)+(_0xa98570(0x1f5)+_0x15fe19['shop'][_0xa98570(0x11f)]+'*\x0a')+(_0xa98570(0x1b2)+_0x15fe19['shop'][_0xa98570(0x115)]+'`\x0a')+(_0xa98570(0x15b)+_0x15fe19[_0xa98570(0x1fd)][_0xa98570(0x13f)](_0xa98570(0x164))+'\x0a\x0a')+_0xa98570(0x141)+_0xa98570(0x16e)+_0xa98570(0x148),{'parse_mode':_0xa98570(0x126)});}catch(_0x59f565){console[_0xa98570(0x12a)](_0xa98570(0x13e),_0x59f565),await this[_0xa98570(0x1eb)]?.[_0xa98570(0x1a6)](_0x1f01c1,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x33b221(0x1eb)][_0x33b221(0x1f8)](/\/debug/,async _0x1e8f34=>{const _0x1df58a=_0x33b221,_0x38d97e=_0x1e8f34['chat']['id'],_0x39d4b7=_0x1e8f34[_0x1df58a(0x1f0)]?.['id']['toString']();if(!_0x39d4b7)return;try{const _0x495d10=await database_1[_0x1df58a(0x138)][_0x1df58a(0x1c7)][_0x1df58a(0x14a)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x5ace51=_0x1df58a(0x16b);_0x5ace51+=_0x1df58a(0x1aa)+_0x39d4b7+_0x1df58a(0x1d9),_0x5ace51+=_0x1df58a(0x149),_0x495d10[_0x1df58a(0x1a4)]((_0x450eec,_0xeb5e21)=>{const _0x29f0b6=_0x1df58a;_0x5ace51+=_0xeb5e21+0x1+_0x29f0b6(0x195)+_0x450eec[_0x29f0b6(0x11f)]+'*\x0a',_0x5ace51+=_0x29f0b6(0x182)+_0x450eec[_0x29f0b6(0x115)]+'`\x0a',_0x5ace51+=_0x29f0b6(0x1ae)+_0x450eec['status']+'\x0a',_0x5ace51+=_0x29f0b6(0x18f)+_0x450eec[_0x29f0b6(0x1b8)][_0x29f0b6(0x142)](0x0,0xf)+_0x29f0b6(0x19f);}),await this[_0x1df58a(0x1eb)]?.['sendMessage'](_0x38d97e,_0x5ace51,{'parse_mode':_0x1df58a(0x126)});}catch(_0x40eee1){console['error'](_0x1df58a(0x154),_0x40eee1),await this[_0x1df58a(0x1eb)]?.[_0x1df58a(0x1a6)](_0x38d97e,_0x1df58a(0x1b0));}}),this[_0x33b221(0x1eb)]['on'](_0x33b221(0x18a),async _0x3cd350=>{const _0x3fb6d1=_0x33b221;if(_0x3cd350['text']?.[_0x3fb6d1(0x1cc)]('/'))return;const _0x47e7ff=_0x3cd350['chat']['id'],_0x2341a3=_0x3cd350[_0x3fb6d1(0x1f0)]?.['id'][_0x3fb6d1(0x173)](),_0x209a3d=_0x3cd350[_0x3fb6d1(0x156)]?.[_0x3fb6d1(0x1ed)]();if(!_0x2341a3||!_0x209a3d)return;try{const _0x25afc6=await database_1[_0x3fb6d1(0x138)]['telegramUser'][_0x3fb6d1(0x1a5)]({'where':{'telegramId':_0x2341a3},'include':{'shop':!![]}});if(!_0x25afc6){await this[_0x3fb6d1(0x1eb)]?.[_0x3fb6d1(0x1a6)](_0x47e7ff,_0x3fb6d1(0x137));return;}if(_0x25afc6[_0x3fb6d1(0x1b1)]&&_0x25afc6[_0x3fb6d1(0x1b3)]&&_0x25afc6[_0x3fb6d1(0x1c7)]){await this['bot']?.[_0x3fb6d1(0x1a6)](_0x47e7ff,_0x3fb6d1(0x188)+_0x25afc6[_0x3fb6d1(0x1c7)][_0x3fb6d1(0x11f)]+_0x3fb6d1(0x130)+_0x3fb6d1(0x1e7),{'parse_mode':_0x3fb6d1(0x126)});return;}const _0x3ea573=_0x209a3d[_0x3fb6d1(0x191)](/\s+/);if(_0x3ea573[_0x3fb6d1(0x1fb)]!==0x2){await this[_0x3fb6d1(0x1eb)]?.[_0x3fb6d1(0x1a6)](_0x47e7ff,_0x3fb6d1(0x144)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x3fb6d1(0x1a2)+_0x3fb6d1(0x13c)+(_0x3fb6d1(0x1e1)+_0x3ea573[_0x3fb6d1(0x1fb)]+_0x3fb6d1(0x159)+_0x3ea573[_0x3fb6d1(0x12d)](_0x84b56c=>'`'+_0x84b56c+'`')[_0x3fb6d1(0x1f9)](',\x20')),{'parse_mode':_0x3fb6d1(0x126)});return;}const [_0x3d5f0b,_0xa5d950]=_0x3ea573;console[_0x3fb6d1(0x152)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x2341a3+_0x3fb6d1(0x1f7)+_0x3d5f0b+_0x3fb6d1(0x124)+_0xa5d950[_0x3fb6d1(0x142)](0x0,0xa)+_0x3fb6d1(0x198)),await this[_0x3fb6d1(0x1dd)](_0x47e7ff,_0x2341a3,_0x3d5f0b,_0xa5d950);}catch(_0x1950e2){console[_0x3fb6d1(0x12a)](_0x3fb6d1(0x1af),_0x1950e2),await this[_0x3fb6d1(0x1eb)]?.[_0x3fb6d1(0x1a6)](_0x47e7ff,_0x3fb6d1(0x189));}}),this[_0x33b221(0x1eb)]['on'](_0x33b221(0x12a),_0x23b5ec=>{const _0x4e2ec7=_0x33b221;console[_0x4e2ec7(0x12a)](_0x4e2ec7(0x11b),_0x23b5ec);}),this['bot']['on'](_0x33b221(0x139),_0x5801cc=>{const _0x3abced=_0x33b221;console[_0x3abced(0x12a)](_0x3abced(0x1a7),_0x5801cc);});}async['handleSingleLineVerification'](_0x516bb7,_0x5c6eaa,_0x267293,_0x5ad311){const _0x1f11ae=a54_0x39e796;try{console[_0x1f11ae(0x152)](_0x1f11ae(0x114)+_0x5c6eaa+_0x1f11ae(0x1f7)+_0x267293+'\x22,\x20apiKey=\x22'+_0x5ad311['substring'](0x0,0xa)+_0x1f11ae(0x198));if(!_0x267293||_0x267293[_0x1f11ae(0x1fb)]<0x3||_0x267293[_0x1f11ae(0x1fb)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x1f11ae(0x174)](_0x267293)){await this[_0x1f11ae(0x1eb)]?.['sendMessage'](_0x516bb7,'❌\x20Invalid\x20username\x20format:\x20`'+_0x267293+_0x1f11ae(0x1d9)+_0x1f11ae(0x193),{'parse_mode':_0x1f11ae(0x126)});return;}if(!_0x5ad311||!_0x5ad311[_0x1f11ae(0x1cc)](_0x1f11ae(0x1d4))&&!_0x5ad311[_0x1f11ae(0x1cc)](_0x1f11ae(0x167))){await this['bot']?.['sendMessage'](_0x516bb7,_0x1f11ae(0x153)+_0x1f11ae(0x12b),{'parse_mode':'Markdown'});return;}const _0x4e5daf=await database_1[_0x1f11ae(0x138)][_0x1f11ae(0x1c7)][_0x1f11ae(0x1a5)]({'where':{'username':_0x267293},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x4e5daf){const _0x24584c=await database_1[_0x1f11ae(0x138)]['shop']['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x4e3e9e=_0x1f11ae(0x19e)+_0x267293+'`\x20not\x20found.\x0a\x0a';_0x24584c[_0x1f11ae(0x1fb)]>0x0?(_0x4e3e9e+='Available\x20usernames:\x0a',_0x24584c['forEach'](_0x5c8406=>{const _0x16bca3=_0x1f11ae;_0x4e3e9e+=_0x16bca3(0x1e5)+_0x5c8406[_0x16bca3(0x115)]+_0x16bca3(0x1c0)+_0x5c8406[_0x16bca3(0x11f)]+')\x0a';}),_0x4e3e9e+=_0x1f11ae(0x1ee)):_0x4e3e9e+=_0x1f11ae(0x127);await this[_0x1f11ae(0x1eb)]?.[_0x1f11ae(0x1a6)](_0x516bb7,_0x4e3e9e,{'parse_mode':_0x1f11ae(0x126)});return;}if(_0x4e5daf[_0x1f11ae(0x179)]!==_0x1f11ae(0x1cb)){await this[_0x1f11ae(0x1eb)]?.[_0x1f11ae(0x1a6)](_0x516bb7,'❌\x20Shop\x20`'+_0x267293+'`\x20is\x20inactive.\x0a\x0a'+_0x1f11ae(0x16d),{'parse_mode':_0x1f11ae(0x126)});return;}if(_0x4e5daf[_0x1f11ae(0x1b8)]!==_0x5ad311&&_0x4e5daf[_0x1f11ae(0x1d8)]!==_0x5ad311){await this[_0x1f11ae(0x1eb)]?.[_0x1f11ae(0x1a6)](_0x516bb7,_0x1f11ae(0x17f)+_0x267293+_0x1f11ae(0x1ce)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x1f11ae(0x1bd),{'parse_mode':'Markdown'});return;}const _0x4e3991=await database_1[_0x1f11ae(0x138)]['telegramUser'][_0x1f11ae(0x1c4)]({'where':{'shopId':_0x4e5daf['id'],'isVerified':!![],'telegramId':{'not':_0x5c6eaa}}});if(_0x4e3991){await this[_0x1f11ae(0x1eb)]?.[_0x1f11ae(0x1a6)](_0x516bb7,_0x1f11ae(0x1c6)+_0x267293+'`.\x0a\x0a'+_0x1f11ae(0x18d),{'parse_mode':_0x1f11ae(0x126)});return;}await database_1['default'][_0x1f11ae(0x123)][_0x1f11ae(0x131)]({'where':{'telegramId':_0x5c6eaa},'data':{'shopId':_0x4e5daf['id'],'isVerified':!![]}}),await this[_0x1f11ae(0x1eb)]?.['sendMessage'](_0x516bb7,_0x1f11ae(0x15d)+_0x1f11ae(0x162)+(_0x1f11ae(0x1cd)+_0x4e5daf['name']+'*\x0a')+(_0x1f11ae(0x1b2)+_0x4e5daf[_0x1f11ae(0x115)]+'`\x0a\x0a')+_0x1f11ae(0x122)+_0x1f11ae(0x187)+'•\x20Payment\x20status\x20changes\x0a'+_0x1f11ae(0x1d0)+_0x1f11ae(0x112)+_0x1f11ae(0x16e)+_0x1f11ae(0x1cf)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}),console[_0x1f11ae(0x152)](_0x1f11ae(0x1fe)+_0x5c6eaa+_0x1f11ae(0x196)+_0x4e5daf['username']+_0x1f11ae(0x160));}catch(_0x28971d){console[_0x1f11ae(0x12a)](_0x1f11ae(0x134),_0x28971d),await this[_0x1f11ae(0x1eb)]?.[_0x1f11ae(0x1a6)](_0x516bb7,_0x1f11ae(0x199));}}async[a54_0x39e796(0x1e0)](_0x506c53,_0x58944e,_0x5bf1c8){const _0x4f2a80=a54_0x39e796;if(!this[_0x4f2a80(0x1eb)]){console[_0x4f2a80(0x1e8)](_0x4f2a80(0x1a9));return;}try{const _0x13c17f=await database_1['default'][_0x4f2a80(0x123)]['findMany']({'where':{'shopId':_0x506c53,'isVerified':!![]}});if(_0x13c17f[_0x4f2a80(0x1fb)]===0x0){console[_0x4f2a80(0x152)](_0x4f2a80(0x177)+_0x506c53);return;}const _0x3a8c6d=_0x13c17f[_0x4f2a80(0x12d)](async _0x550568=>{const _0x534c71=_0x4f2a80;try{await this[_0x534c71(0x1eb)]?.[_0x534c71(0x1a6)](_0x550568['telegramId'],_0x58944e,_0x5bf1c8),console[_0x534c71(0x152)](_0x534c71(0x1c1)+_0x550568[_0x534c71(0x111)]);}catch(_0x2b4db5){console['error'](_0x534c71(0x163)+_0x550568[_0x534c71(0x111)]+':',_0x2b4db5),_0x2b4db5 instanceof Error&&(_0x2b4db5['message'][_0x534c71(0x170)](_0x534c71(0x1db))||_0x2b4db5['message'][_0x534c71(0x170)]('chat\x20not\x20found')||_0x2b4db5[_0x534c71(0x18a)]['includes'](_0x534c71(0x1b4)))&&(await database_1[_0x534c71(0x138)]['telegramUser'][_0x534c71(0x131)]({'where':{'id':_0x550568['id']},'data':{'isVerified':![]}}),console['log'](_0x534c71(0x1ef)+_0x550568[_0x534c71(0x111)]+_0x534c71(0x17b)));}});await Promise[_0x4f2a80(0x1ac)](_0x3a8c6d);}catch(_0x37b63d){console[_0x4f2a80(0x12a)](_0x4f2a80(0x136),_0x37b63d);}}async['sendPaymentNotification'](_0x382f19,_0x309822,_0x3d6023){const _0x4dcc26=a54_0x39e796,_0x25f581={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x36de79={'created':_0x4dcc26(0x132),'paid':_0x4dcc26(0x180),'failed':_0x4dcc26(0x135),'expired':_0x4dcc26(0x17d),'refund':'Payment\x20refund','chargeback':_0x4dcc26(0x128),'processing':_0x4dcc26(0x140)},_0xad3fe2=_0x25f581[_0x3d6023],_0x3c960f=_0x36de79[_0x3d6023],_0x2d5ef1=(0x0,gateway_1[_0x4dcc26(0x1ea)])(_0x309822[_0x4dcc26(0x1bc)]);console[_0x4dcc26(0x152)](_0x4dcc26(0x161)+_0x309822[_0x4dcc26(0x1bc)]+_0x4dcc26(0x16f)+_0x2d5ef1+'\x22');let _0x2a4710=_0xad3fe2+'\x20*'+_0x3c960f+_0x4dcc26(0x1f4)+(_0x4dcc26(0x14d)+_0x309822[_0x4dcc26(0x1ab)]+'\x20'+_0x309822['currency']+'*\x0a')+(_0x4dcc26(0x11c)+(_0x309822[_0x4dcc26(0x17c)]||_0x309822['id'])+'`\x0a')+(_0x4dcc26(0x146)+_0x309822['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x2d5ef1+'`\x0a')+(_0x4dcc26(0x1e9)+new Date(_0x309822['createdAt'])[_0x4dcc26(0x1d2)](_0x4dcc26(0x164))+'\x0a');if(_0x309822[_0x4dcc26(0x1fa)]||_0x309822[_0x4dcc26(0x171)]||_0x309822[_0x4dcc26(0x117)]||_0x309822[_0x4dcc26(0x1e6)]||_0x309822[_0x4dcc26(0x17e)]){_0x2a4710+=_0x4dcc26(0x168);_0x309822[_0x4dcc26(0x1fa)]&&(_0x2a4710+=_0x4dcc26(0x194)+_0x309822[_0x4dcc26(0x1fa)]+'`\x0a');_0x309822[_0x4dcc26(0x171)]&&(_0x2a4710+=_0x4dcc26(0x18e)+_0x309822[_0x4dcc26(0x171)]+'`\x0a');_0x309822[_0x4dcc26(0x117)]&&(_0x2a4710+=_0x4dcc26(0x1c3)+_0x309822[_0x4dcc26(0x117)]+'`\x0a');_0x309822[_0x4dcc26(0x1e6)]&&(_0x2a4710+=_0x4dcc26(0x121)+_0x309822[_0x4dcc26(0x1e6)]+'`\x0a');if(_0x309822[_0x4dcc26(0x17e)]){const _0x125543=_0x309822[_0x4dcc26(0x17e)]['length']>0x32?_0x309822['customerUa'][_0x4dcc26(0x142)](0x0,0x32)+'...':_0x309822['customerUa'];_0x2a4710+=_0x4dcc26(0x1ca)+_0x125543+'`\x0a';}}_0x3d6023==='chargeback'&&_0x309822['chargebackAmount']&&(_0x2a4710+=_0x4dcc26(0x129)+_0x309822[_0x4dcc26(0x15f)]+'\x20USDT*\x0a'),_0x3d6023===_0x4dcc26(0x120)&&(_0x2a4710+=_0x4dcc26(0x13b)),_0x309822['adminNotes']&&(_0x2a4710+='📝\x20Notes:\x20'+_0x309822[_0x4dcc26(0x185)]+'\x0a'),await this[_0x4dcc26(0x1e0)](_0x382f19,_0x2a4710,{'parse_mode':_0x4dcc26(0x126)});}async['sendPayoutNotification'](_0x3b837b,_0x38cb51,_0x47c7ca){const _0xbc17b=a54_0x39e796,_0x1002ff={'created':'📤','completed':'✅','rejected':'❌'},_0x17ef1d={'created':'New\x20payout\x20created','completed':_0xbc17b(0x1c2),'rejected':'Payout\x20rejected'},_0x5c889a=_0x1002ff[_0x47c7ca],_0x1112d3=_0x17ef1d[_0x47c7ca],_0x5eeaa4=_0x5c889a+'\x20*'+_0x1112d3+_0xbc17b(0x1f4)+(_0xbc17b(0x12e)+_0x38cb51[_0xbc17b(0x1ab)]+'\x20USD*\x0a')+('🏦\x20Method:\x20`'+_0x38cb51[_0xbc17b(0x14f)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x38cb51['id']+'`\x0a')+(_0xbc17b(0x1e9)+new Date(_0x38cb51[_0xbc17b(0x183)])[_0xbc17b(0x1d2)](_0xbc17b(0x164))+'\x0a')+(_0x38cb51['txid']?'🔗\x20TXID:\x20`'+_0x38cb51[_0xbc17b(0x18b)]+'`':'');await this[_0xbc17b(0x1e0)](_0x3b837b,_0x5eeaa4,{'parse_mode':_0xbc17b(0x126)});}async['sendLoginNotification'](_0x13089c,_0x3767d8){const _0x358234=a54_0x39e796;try{const _0x352807=await database_1[_0x358234(0x138)]['shopSettings'][_0x358234(0x1a5)]({'where':{'shopId':_0x13089c},'select':{'notificationLogin':!![]}});if(!_0x352807?.[_0x358234(0x16c)]){console[_0x358234(0x152)](_0x358234(0x16a)+_0x13089c);return;}const _0x295496=_0x3767d8[_0x358234(0x169)]?'🔐':'🚨',_0x45b29a=_0x3767d8[_0x358234(0x169)]?_0x358234(0x1c8):_0x358234(0x18c);let _0x5e1eab=_0x295496+'\x20*'+_0x45b29a+'*\x0a\x0a'+('👤\x20Username:\x20`'+_0x3767d8[_0x358234(0x115)]+'`\x0a')+('📅\x20Time:\x20'+_0x3767d8[_0x358234(0x1d6)][_0x358234(0x1d2)](_0x358234(0x164))+'\x0a');_0x3767d8[_0x358234(0x176)]&&(_0x5e1eab+='🌐\x20IP\x20address:\x20`'+_0x3767d8['ipAddress']+'`\x0a');if(_0x3767d8[_0x358234(0x151)]){const _0xd70f0a=_0x3767d8['userAgent'][_0x358234(0x1fb)]>0x32?_0x3767d8['userAgent']['substring'](0x0,0x32)+_0x358234(0x19d):_0x3767d8['userAgent'];_0x5e1eab+=_0x358234(0x1ca)+_0xd70f0a+'`\x0a';}!_0x3767d8[_0x358234(0x169)]&&(_0x5e1eab+=_0x358234(0x1a0)),await this[_0x358234(0x1e0)](_0x13089c,_0x5e1eab,{'parse_mode':_0x358234(0x126)}),console[_0x358234(0x152)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x13089c+':\x20'+(_0x3767d8[_0x358234(0x169)]?'success':_0x358234(0x158)));}catch(_0x2b3171){console[_0x358234(0x12a)](_0x358234(0x1ad),_0x2b3171);}}async[a54_0x39e796(0x147)](_0x209a1c,_0x1d3dac){const _0x112198=a54_0x39e796;try{const _0x1c69db=await database_1[_0x112198(0x138)]['shopSettings'][_0x112198(0x1a5)]({'where':{'shopId':_0x209a1c},'select':{'notificationApiError':!![]}});if(!_0x1c69db?.[_0x112198(0x143)]){console[_0x112198(0x152)](_0x112198(0x165)+_0x209a1c);return;}let _0x5ee227=_0x112198(0x145)+(_0x112198(0x1f6)+_0x1d3dac[_0x112198(0x14f)]+'\x20'+_0x1d3dac[_0x112198(0x1b7)]+'`\x0a')+('📅\x20Time:\x20'+_0x1d3dac['timestamp'][_0x112198(0x1d2)](_0x112198(0x164))+'\x0a');_0x1d3dac[_0x112198(0x1e3)]&&(_0x5ee227+=_0x112198(0x172)+_0x1d3dac[_0x112198(0x1e3)]+'`\x0a'),_0x5ee227+=_0x112198(0x1ec)+_0x1d3dac[_0x112198(0x1a3)]+'`\x0a',_0x1d3dac[_0x112198(0x14e)]&&(_0x5ee227+=_0x112198(0x19c)+_0x1d3dac[_0x112198(0x14e)]+'`\x0a'),_0x5ee227+=_0x112198(0x1b5),await this[_0x112198(0x1e0)](_0x209a1c,_0x5ee227,{'parse_mode':_0x112198(0x126)}),console['log'](_0x112198(0x1ba)+_0x209a1c+':\x20'+_0x1d3dac[_0x112198(0x1b7)]);}catch(_0x5e2448){console['error']('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x5e2448);}}async['sendCustomNotification'](_0x2a8648,_0x4452fc,_0x116c8f){const _0x3db82a=a54_0x39e796;let _0x2d771d=_0x3db82a(0x1bf)+_0x4452fc+_0x3db82a(0x1f4);for(const [_0x28cbba,_0x5ba839]of Object[_0x3db82a(0x1c5)](_0x116c8f)){_0x5ba839!==null&&_0x5ba839!==undefined&&(_0x2d771d+=_0x28cbba+_0x3db82a(0x15a)+_0x5ba839+'`\x0a');}await this[_0x3db82a(0x1e0)](_0x2a8648,_0x2d771d,{'parse_mode':_0x3db82a(0x126)});}[a54_0x39e796(0x1b9)](){const _0x1dd0a7=a54_0x39e796;return{'isActive':!!this[_0x1dd0a7(0x1eb)],'username':this[_0x1dd0a7(0x12c)]};}[a54_0x39e796(0x1de)](){const _0x39c231=a54_0x39e796;this[_0x39c231(0x1eb)]&&(this[_0x39c231(0x1eb)][_0x39c231(0x1d3)](),this[_0x39c231(0x1eb)]=null,console['log']('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a54_0x39e796(0x113)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();