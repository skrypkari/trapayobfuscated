'use strict';const a57_0x7dc03f=a57_0x5124;function a57_0x5124(_0x465535,_0x1221e6){const _0x5918ad=a57_0x5918();return a57_0x5124=function(_0x51248a,_0x1f6bdc){_0x51248a=_0x51248a-0x96;let _0x618a49=_0x5918ad[_0x51248a];return _0x618a49;},a57_0x5124(_0x465535,_0x1221e6);}(function(_0x3b0f32,_0x35aaf0){const _0x2a4bc7=a57_0x5124,_0x30dda0=_0x3b0f32();while(!![]){try{const _0x1bdc61=parseInt(_0x2a4bc7(0xa3))/0x1+parseInt(_0x2a4bc7(0xce))/0x2*(parseInt(_0x2a4bc7(0x11d))/0x3)+-parseInt(_0x2a4bc7(0xf2))/0x4+-parseInt(_0x2a4bc7(0x166))/0x5*(-parseInt(_0x2a4bc7(0xee))/0x6)+parseInt(_0x2a4bc7(0xbc))/0x7+-parseInt(_0x2a4bc7(0xe6))/0x8+-parseInt(_0x2a4bc7(0xd2))/0x9;if(_0x1bdc61===_0x35aaf0)break;else _0x30dda0['push'](_0x30dda0['shift']());}catch(_0x572be2){_0x30dda0['push'](_0x30dda0['shift']());}}}(a57_0x5918,0xe01cd));var __importDefault=this&&this[a57_0x7dc03f(0xba)]||function(_0x2be8ca){const _0x2af2db=a57_0x7dc03f;return _0x2be8ca&&_0x2be8ca[_0x2af2db(0xf6)]?_0x2be8ca:{'default':_0x2be8ca};};function a57_0x5918(){const _0x23ec36=['🆔\x20Payment\x20ID:\x20`','botToken','❌\x20Error\x20getting\x20debug\x20information.','log','\x20\x20\x20Public\x20Key:\x20`','findUnique','customerName','../types/gateway','processing','chargebackAmount','onText','failed','🌐\x20IP\x20address:\x20`','pk_','isVerified','from','User\x20','gateway','sendPayoutNotification','startsWith','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','`.\x0a\x0a','•\x20Payouts\x0a\x0a','shop','•\x20New\x20payments\x0a','1317638PpxDSS','`\x20not\x20found.\x0a\x0a','Payout\x20rejected','🏪\x20Available\x20shops\x20in\x20system:\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','🏪\x20Gateway:\x20`','❌\x20Shop\x20with\x20username\x20`','customerUa','Contact\x20administrator.','\x20disconnected\x20from\x20shop\x20','telegramBotService','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','*\x0a\x0a','name','join','\x20\x20\x20Username:\x20`','username','Use\x20/start\x20to\x20begin.','create','Successful\x20login','defineProperty','Payment\x20failed','__importDefault','TELEGRAM_BOT_USERNAME','6969956tPjHjI','orderId','Markdown','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','setupBotHandlers','💸\x20Amount:\x20*','/status\x20-\x20check\x20connection\x20status\x0a','\x0a👤\x20*Customer\x20Information:*\x0a','remitterIban','error','map','forEach','createdAt','You\x20sent\x20','errorMessage','✅\x20Telegram\x20user\x20','🆔\x20Request\x20ID:\x20`','Error\x20in\x20handleSingleLineVerification:','2ifiPPK','chat','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','message','4639815ACtEsc','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','❌\x20Error:\x20`','env','🔗\x20TXID:\x20`','notificationLogin','customerIp','sendLoginNotification','\x20USD*\x0a','toString','🔗\x20Endpoint:\x20`','Example:\x0a','...\x22','🎉\x20*Congratulations!*\x0a\x0a','Payment\x20expired','Payment\x20successfully\x20paid','customerEmail','getBotInfo',':\x20username=\x22','.\x20*','11408840cawgig','•\x20`','Telegram\x20bot\x20polling\x20error:','split','txid','💸\x20Penalty\x20amount:\x20*','\x20via\x20single-line\x20input','timestamp','6Evfkqx','*.\x0a\x0a','🔔\x20You\x20receive\x20notifications\x20about:\x0a','•\x20Important\x20events\x0a\x0a','2895452LQjNrW','\x20(@','🔔\x20*','toLocaleString','__esModule','Payment\x20refund','📱\x20Shop:\x20*','userAgent','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','update','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','TELEGRAM_BOT_TOKEN','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','📝\x20Notes:\x20','\x20verified\x20for\x20shop\x20','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','botUsername','New\x20payout\x20created','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','findMany','🌐\x20IP:\x20`','adminNotes','\x22,\x20apiKey=\x22','initializeBot','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','📝\x20Order\x20ID:\x20`','TelegramBotService','shopSettings','✅\x20Connected\x20to\x20shop:\x20*','secretKey','sk_','first_name','en-US','chat\x20not\x20found','📅\x20Date:\x20','...','notificationApiError','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','💻\x20Browser:\x20`','sendApiErrorNotification','`\x0a\x0a','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','637269bJgqiI','\x20initialized\x20successfully','success','📱\x20Your\x20Telegram\x20ID:\x20`','endpoint','ipAddress','sendShopNotification','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','polling_error','default','•\x20Payouts\x0a','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','text','sendPaymentNotification','📊\x20Error\x20code:\x20`','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','publicKey','Commands:\x0a','👤\x20Username:\x20`','warn','Use\x20/start\x20to\x20connect.','handleSingleLineVerification','Error\x20handling\x20/start\x20command:','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','❌\x20Shop\x20`','🆔\x20Payout\x20ID:\x20`','❌\x20Please\x20use\x20/start\x20command\x20first','shopId','Check\x20spelling\x20and\x20try\x20again.','substring','Failed\x20login\x20attempt','\x22\x20->\x20display\x20\x22','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','stopBot','Payout\x20completed','To\x20reconnect,\x20use\x20the\x20/start\x20command','📅\x20Time:\x20','Error\x20handling\x20/debug\x20command:','🏦\x20Method:\x20`','Username:\x20`','sendMessage','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','telegramId','telegramUser','✅\x20Telegram\x20bot\x20@','Telegram\x20bot\x20error:','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','📅\x20Connection\x20date:\x20','chargeback','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','amount','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','\x20USDT*\x0a','/disconnect\x20-\x20disconnect\x20from\x20notifications','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','unknown\x20shop','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','stopPolling','Available\x20usernames:\x0a','requestId','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Error\x20handling\x20/status\x20command:','includes','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','`\x20(','🔌\x20User\x20','method','...`\x0a\x0a','length','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','5288495arRmgG','Failed\x20to\x20send\x20login\x20notification:','bot','📱\x20Telegram\x20notification:\x20gateway\x20\x22','user\x20is\x20deactivated','currency','allSettled','toLocaleDateString','🛑\x20Telegram\x20bot\x20stopped','❌\x20Invalid\x20username\x20format:\x20`','\x20parts:\x20'];a57_0x5918=function(){return _0x23ec36;};return a57_0x5918();}Object[a57_0x7dc03f(0xb8)](exports,a57_0x7dc03f(0xf6),{'value':!![]}),exports[a57_0x7dc03f(0xae)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require('../config/database')),gateway_1=require(a57_0x7dc03f(0x178));class TelegramBotService{constructor(){const _0x4d1920=a57_0x7dc03f;this[_0x4d1920(0x168)]=null,this['botToken']=process['env'][_0x4d1920(0xfe)]||'',this['botUsername']=process[_0x4d1920(0xd5)][_0x4d1920(0xbb)]||'trapay_bot',this[_0x4d1920(0x172)]?this[_0x4d1920(0x10a)]():console[_0x4d1920(0x130)](_0x4d1920(0xfa));}[a57_0x7dc03f(0x10a)](){const _0x4c2f2a=a57_0x7dc03f;try{this[_0x4c2f2a(0x168)]=new node_telegram_bot_api_1[(_0x4c2f2a(0x126))](this[_0x4c2f2a(0x172)],{'polling':!![]}),this[_0x4c2f2a(0xc0)](),console[_0x4c2f2a(0x174)](_0x4c2f2a(0x14a)+this[_0x4c2f2a(0x103)]+_0x4c2f2a(0x11e));}catch(_0xa67a31){console[_0x4c2f2a(0xc5)](_0x4c2f2a(0x124),_0xa67a31);}}[a57_0x7dc03f(0xc0)](){const _0x4698a6=a57_0x7dc03f;if(!this[_0x4698a6(0x168)])return;this[_0x4698a6(0x168)]['onText'](/\/start/,async _0x56d98a=>{const _0x30c252=_0x4698a6,_0x3e2f07=_0x56d98a[_0x30c252(0xcf)]['id'],_0x5e4480=_0x56d98a['from']?.['id'][_0x30c252(0xdb)](),_0x29ecd4=_0x56d98a[_0x30c252(0x99)]?.[_0x30c252(0xb4)],_0x4e0817=_0x56d98a['from']?.[_0x30c252(0x112)],_0x3bd47d=_0x56d98a[_0x30c252(0x99)]?.['last_name'];if(!_0x5e4480)return;try{let _0x44ea87=await database_1[_0x30c252(0x126)][_0x30c252(0x149)][_0x30c252(0x176)]({'where':{'telegramId':_0x5e4480},'include':{'shop':!![]}});!_0x44ea87?(_0x44ea87=await database_1[_0x30c252(0x126)][_0x30c252(0x149)][_0x30c252(0xb6)]({'data':{'telegramId':_0x5e4480,'username':_0x29ecd4,'firstName':_0x4e0817,'lastName':_0x3bd47d,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log']('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x5e4480+_0x30c252(0xf3)+_0x29ecd4+')')):_0x44ea87=await database_1[_0x30c252(0x126)]['telegramUser'][_0x30c252(0xfb)]({'where':{'telegramId':_0x5e4480},'data':{'username':_0x29ecd4,'firstName':_0x4e0817,'lastName':_0x3bd47d},'include':{'shop':!![]}}),_0x44ea87[_0x30c252(0x98)]&&_0x44ea87[_0x30c252(0x138)]&&_0x44ea87['shop']?await this[_0x30c252(0x168)]?.['sendMessage'](_0x3e2f07,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x30c252(0x13e)+_0x44ea87[_0x30c252(0xa1)]['name']+'*\x0a')+(_0x30c252(0x145)+_0x44ea87[_0x30c252(0xa1)]['username']+_0x30c252(0x11b))+_0x30c252(0xf0)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+_0x30c252(0xa0)+_0x30c252(0x12e)+_0x30c252(0xc2)+_0x30c252(0x154),{'parse_mode':_0x30c252(0xbe)}):(_0x44ea87['shopId']&&!_0x44ea87[_0x30c252(0x98)]&&(await database_1['default'][_0x30c252(0x149)]['update']({'where':{'telegramId':_0x5e4480},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x30c252(0x12c)+_0x5e4480)),await this['bot']?.['sendMessage'](_0x3e2f07,_0x30c252(0x9e)+_0x30c252(0x128)+_0x30c252(0x15c)+_0x30c252(0xdd)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x30c252(0xd3),{'parse_mode':'Markdown'}));}catch(_0x2ef79f){console['error'](_0x30c252(0x133),_0x2ef79f),await this[_0x30c252(0x168)]?.[_0x30c252(0x146)](_0x3e2f07,_0x30c252(0x102));}}),this['bot']['onText'](/\/disconnect/,async _0x3c5a9e=>{const _0x853657=_0x4698a6,_0x296394=_0x3c5a9e[_0x853657(0xcf)]['id'],_0x5d4d9c=_0x3c5a9e[_0x853657(0x99)]?.['id'][_0x853657(0xdb)]();if(!_0x5d4d9c)return;try{const _0x5106b6=await database_1[_0x853657(0x126)]['telegramUser'][_0x853657(0x176)]({'where':{'telegramId':_0x5d4d9c},'include':{'shop':!![]}});if(!_0x5106b6||!_0x5106b6[_0x853657(0x98)]||!_0x5106b6[_0x853657(0x138)]){await this[_0x853657(0x168)]?.[_0x853657(0x146)](_0x296394,_0x853657(0x14c));return;}const _0x4ba0f6=_0x5106b6[_0x853657(0xa1)]?.[_0x853657(0xb1)]||_0x853657(0x156);await database_1[_0x853657(0x126)][_0x853657(0x149)][_0x853657(0xfb)]({'where':{'telegramId':_0x5d4d9c},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x853657(0x161)+_0x5d4d9c+_0x853657(0xad)+_0x5106b6[_0x853657(0x138)]),await this['bot']?.[_0x853657(0x146)](_0x296394,_0x853657(0x105)+_0x4ba0f6+_0x853657(0xef)+_0x853657(0x141),{'parse_mode':_0x853657(0xbe)});}catch(_0x55e8eb){console['error']('Error\x20handling\x20/disconnect\x20command:',_0x55e8eb),await this[_0x853657(0x168)]?.[_0x853657(0x146)](_0x296394,_0x853657(0x102));}}),this[_0x4698a6(0x168)][_0x4698a6(0x17b)](/\/status/,async _0x3bc969=>{const _0x4d19e2=_0x4698a6,_0x11eebf=_0x3bc969[_0x4d19e2(0xcf)]['id'],_0x36031a=_0x3bc969[_0x4d19e2(0x99)]?.['id'][_0x4d19e2(0xdb)]();if(!_0x36031a)return;try{const _0x3ed843=await database_1['default'][_0x4d19e2(0x149)][_0x4d19e2(0x176)]({'where':{'telegramId':_0x36031a},'include':{'shop':!![]}});if(!_0x3ed843){await this['bot']?.[_0x4d19e2(0x146)](_0x11eebf,_0x4d19e2(0x147)+_0x4d19e2(0xb5));return;}if(!_0x3ed843[_0x4d19e2(0x98)]||!_0x3ed843[_0x4d19e2(0x138)]||!_0x3ed843['shop']){await this['bot']?.['sendMessage'](_0x11eebf,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x4d19e2(0x131));return;}await this['bot']?.[_0x4d19e2(0x146)](_0x11eebf,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x4d19e2(0x10f)+_0x3ed843['shop'][_0x4d19e2(0xb1)]+'*\x0a')+(_0x4d19e2(0x12f)+_0x3ed843[_0x4d19e2(0xa1)][_0x4d19e2(0xb4)]+'`\x0a')+(_0x4d19e2(0x14e)+_0x3ed843['updatedAt'][_0x4d19e2(0x16d)](_0x4d19e2(0x113))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+_0x4d19e2(0x12e)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x4d19e2(0xbe)});}catch(_0x1dea72){console[_0x4d19e2(0xc5)](_0x4d19e2(0x15d),_0x1dea72),await this['bot']?.[_0x4d19e2(0x146)](_0x11eebf,_0x4d19e2(0x102));}}),this[_0x4698a6(0x168)][_0x4698a6(0x17b)](/\/debug/,async _0x5dad49=>{const _0x153baa=_0x4698a6,_0x4decd4=_0x5dad49[_0x153baa(0xcf)]['id'],_0x54177f=_0x5dad49[_0x153baa(0x99)]?.['id'][_0x153baa(0xdb)]();if(!_0x54177f)return;try{const _0x3a1245=await database_1['default']['shop'][_0x153baa(0x106)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4e2afe='🔍\x20*Debug\x20Information*\x0a\x0a';_0x4e2afe+=_0x153baa(0x120)+_0x54177f+_0x153baa(0x11b),_0x4e2afe+=_0x153baa(0xa6),_0x3a1245[_0x153baa(0xc7)]((_0x2ec333,_0x58d49f)=>{const _0x3fbcf8=_0x153baa;_0x4e2afe+=_0x58d49f+0x1+_0x3fbcf8(0xe5)+_0x2ec333['name']+'*\x0a',_0x4e2afe+=_0x3fbcf8(0xb3)+_0x2ec333['username']+'`\x0a',_0x4e2afe+='\x20\x20\x20Status:\x20'+_0x2ec333['status']+'\x0a',_0x4e2afe+=_0x3fbcf8(0x175)+_0x2ec333[_0x3fbcf8(0x12d)]['substring'](0x0,0xf)+_0x3fbcf8(0x163);}),await this[_0x153baa(0x168)]?.[_0x153baa(0x146)](_0x4decd4,_0x4e2afe,{'parse_mode':_0x153baa(0xbe)});}catch(_0x192439){console['error'](_0x153baa(0x143),_0x192439),await this[_0x153baa(0x168)]?.[_0x153baa(0x146)](_0x4decd4,_0x153baa(0x173));}}),this[_0x4698a6(0x168)]['on'](_0x4698a6(0xd1),async _0x2efbc5=>{const _0x3d41da=_0x4698a6;if(_0x2efbc5[_0x3d41da(0x129)]?.[_0x3d41da(0x9d)]('/'))return;const _0x325249=_0x2efbc5[_0x3d41da(0xcf)]['id'],_0x1768f0=_0x2efbc5[_0x3d41da(0x99)]?.['id'][_0x3d41da(0xdb)](),_0x23dc07=_0x2efbc5[_0x3d41da(0x129)]?.['trim']();if(!_0x1768f0||!_0x23dc07)return;try{const _0x2b90e4=await database_1[_0x3d41da(0x126)][_0x3d41da(0x149)][_0x3d41da(0x176)]({'where':{'telegramId':_0x1768f0},'include':{'shop':!![]}});if(!_0x2b90e4){await this[_0x3d41da(0x168)]?.[_0x3d41da(0x146)](_0x325249,_0x3d41da(0x137));return;}if(_0x2b90e4[_0x3d41da(0x98)]&&_0x2b90e4['shopId']&&_0x2b90e4[_0x3d41da(0xa1)]){await this[_0x3d41da(0x168)]?.[_0x3d41da(0x146)](_0x325249,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x2b90e4[_0x3d41da(0xa1)][_0x3d41da(0xb1)]+_0x3d41da(0xef)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':'Markdown'});return;}const _0x185723=_0x23dc07[_0x3d41da(0xe9)](/\s+/);if(_0x185723[_0x3d41da(0x164)]!==0x2){await this[_0x3d41da(0x168)]?.['sendMessage'](_0x325249,_0x3d41da(0x15b)+_0x3d41da(0x15c)+_0x3d41da(0xdd)+_0x3d41da(0x134)+(_0x3d41da(0xc9)+_0x185723['length']+_0x3d41da(0x170)+_0x185723[_0x3d41da(0xc6)](_0x5a32f6=>'`'+_0x5a32f6+'`')[_0x3d41da(0xb2)](',\x20')),{'parse_mode':_0x3d41da(0xbe)});return;}const [_0x5c3eee,_0x480a8e]=_0x185723;console[_0x3d41da(0x174)](_0x3d41da(0xa8)+_0x1768f0+_0x3d41da(0xe4)+_0x5c3eee+_0x3d41da(0x109)+_0x480a8e[_0x3d41da(0x13a)](0x0,0xa)+_0x3d41da(0xde)),await this[_0x3d41da(0x132)](_0x325249,_0x1768f0,_0x5c3eee,_0x480a8e);}catch(_0x3bcefb){console[_0x3d41da(0xc5)]('Error\x20handling\x20message:',_0x3bcefb),await this[_0x3d41da(0x168)]?.[_0x3d41da(0x146)](_0x325249,_0x3d41da(0x102));}}),this[_0x4698a6(0x168)]['on']('error',_0x341e89=>{const _0x1fc993=_0x4698a6;console[_0x1fc993(0xc5)](_0x1fc993(0x14b),_0x341e89);}),this[_0x4698a6(0x168)]['on'](_0x4698a6(0x125),_0x9bc83b=>{const _0x51c8d5=_0x4698a6;console['error'](_0x51c8d5(0xe8),_0x9bc83b);});}async[a57_0x7dc03f(0x132)](_0x1b1dbe,_0x4a8cb2,_0x4e5162,_0x340d2f){const _0x184372=a57_0x7dc03f;try{console[_0x184372(0x174)](_0x184372(0xa8)+_0x4a8cb2+_0x184372(0xe4)+_0x4e5162+_0x184372(0x109)+_0x340d2f['substring'](0x0,0xa)+_0x184372(0xde));if(!_0x4e5162||_0x4e5162[_0x184372(0x164)]<0x3||_0x4e5162[_0x184372(0x164)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x4e5162)){await this[_0x184372(0x168)]?.['sendMessage'](_0x1b1dbe,_0x184372(0x16f)+_0x4e5162+_0x184372(0x11b)+_0x184372(0x157),{'parse_mode':'Markdown'});return;}if(!_0x340d2f||!_0x340d2f[_0x184372(0x9d)](_0x184372(0x97))&&!_0x340d2f[_0x184372(0x9d)](_0x184372(0x111))){await this[_0x184372(0x168)]?.['sendMessage'](_0x1b1dbe,_0x184372(0xaf)+_0x184372(0xfc),{'parse_mode':_0x184372(0xbe)});return;}const _0x4ae9ea=await database_1[_0x184372(0x126)]['shop'][_0x184372(0x176)]({'where':{'username':_0x4e5162},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x4ae9ea){const _0xca1c29=await database_1['default'][_0x184372(0xa1)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x2caf27=_0x184372(0xaa)+_0x4e5162+_0x184372(0xa4);_0xca1c29['length']>0x0?(_0x2caf27+=_0x184372(0x159),_0xca1c29[_0x184372(0xc7)](_0x385909=>{const _0x166d2e=_0x184372;_0x2caf27+=_0x166d2e(0xe7)+_0x385909['username']+_0x166d2e(0x160)+_0x385909[_0x166d2e(0xb1)]+')\x0a';}),_0x2caf27+=_0x184372(0xa7)):_0x2caf27+=_0x184372(0x139);await this['bot']?.['sendMessage'](_0x1b1dbe,_0x2caf27,{'parse_mode':_0x184372(0xbe)});return;}if(_0x4ae9ea['status']!=='ACTIVE'){await this[_0x184372(0x168)]?.['sendMessage'](_0x1b1dbe,_0x184372(0x135)+_0x4e5162+'`\x20is\x20inactive.\x0a\x0a'+_0x184372(0xac),{'parse_mode':_0x184372(0xbe)});return;}if(_0x4ae9ea['publicKey']!==_0x340d2f&&_0x4ae9ea[_0x184372(0x110)]!==_0x340d2f){await this['bot']?.['sendMessage'](_0x1b1dbe,_0x184372(0x165)+_0x4e5162+_0x184372(0x9f)+_0x184372(0xff)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x184372(0xbe)});return;}const _0x5d33e4=await database_1[_0x184372(0x126)][_0x184372(0x149)]['findFirst']({'where':{'shopId':_0x4ae9ea['id'],'isVerified':!![],'telegramId':{'not':_0x4a8cb2}}});if(_0x5d33e4){await this[_0x184372(0x168)]?.['sendMessage'](_0x1b1dbe,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x4e5162+_0x184372(0x9f)+_0x184372(0xbf),{'parse_mode':_0x184372(0xbe)});return;}await database_1[_0x184372(0x126)][_0x184372(0x149)]['update']({'where':{'telegramId':_0x4a8cb2},'data':{'shopId':_0x4ae9ea['id'],'isVerified':!![]}}),await this[_0x184372(0x168)]?.[_0x184372(0x146)](_0x1b1dbe,_0x184372(0xdf)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x184372(0xf8)+_0x4ae9ea[_0x184372(0xb1)]+'*\x0a')+('👤\x20Username:\x20`'+_0x4ae9ea[_0x184372(0xb4)]+'`\x0a\x0a')+_0x184372(0x13d)+_0x184372(0xa2)+'•\x20Payment\x20status\x20changes\x0a'+_0x184372(0x127)+_0x184372(0xf1)+'Commands:\x0a'+_0x184372(0xc2)+_0x184372(0x154),{'parse_mode':'Markdown'}),console[_0x184372(0x174)](_0x184372(0xcb)+_0x4a8cb2+_0x184372(0x101)+_0x4ae9ea[_0x184372(0xb4)]+_0x184372(0xec));}catch(_0x193702){console[_0x184372(0xc5)](_0x184372(0xcd),_0x193702),await this[_0x184372(0x168)]?.[_0x184372(0x146)](_0x1b1dbe,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async['sendShopNotification'](_0x32c1fc,_0x23199d,_0x53155b){const _0x313fe2=a57_0x7dc03f;if(!this['bot']){console[_0x313fe2(0x130)](_0x313fe2(0x14d));return;}try{const _0x283733=await database_1[_0x313fe2(0x126)][_0x313fe2(0x149)]['findMany']({'where':{'shopId':_0x32c1fc,'isVerified':!![]}});if(_0x283733[_0x313fe2(0x164)]===0x0){console[_0x313fe2(0x174)](_0x313fe2(0x118)+_0x32c1fc);return;}const _0x794e7=_0x283733['map'](async _0x2a2836=>{const _0x594d8b=_0x313fe2;try{await this['bot']?.[_0x594d8b(0x146)](_0x2a2836[_0x594d8b(0x148)],_0x23199d,_0x53155b),console[_0x594d8b(0x174)](_0x594d8b(0x10b)+_0x2a2836['telegramId']);}catch(_0x297603){console[_0x594d8b(0xc5)](_0x594d8b(0x15f)+_0x2a2836[_0x594d8b(0x148)]+':',_0x297603),_0x297603 instanceof Error&&(_0x297603[_0x594d8b(0xd1)][_0x594d8b(0x15e)]('blocked')||_0x297603[_0x594d8b(0xd1)][_0x594d8b(0x15e)](_0x594d8b(0x114))||_0x297603['message']['includes'](_0x594d8b(0x16a)))&&(await database_1['default'][_0x594d8b(0x149)][_0x594d8b(0xfb)]({'where':{'id':_0x2a2836['id']},'data':{'isVerified':![]}}),console[_0x594d8b(0x174)](_0x594d8b(0x9a)+_0x2a2836[_0x594d8b(0x148)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x313fe2(0x16c)](_0x794e7);}catch(_0x3cd989){console['error']('Error\x20sending\x20shop\x20notification:',_0x3cd989);}}async[a57_0x7dc03f(0x12a)](_0x70759c,_0x3587e7,_0x15b3e8){const _0x175ffe=a57_0x7dc03f,_0x4c453f={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x43f914={'created':'New\x20payment\x20created','paid':_0x175ffe(0xe1),'failed':_0x175ffe(0xb9),'expired':_0x175ffe(0xe0),'refund':_0x175ffe(0xf7),'chargeback':'Payment\x20chargeback','processing':'Payment\x20is\x20being\x20processed'},_0x1a8b88=_0x4c453f[_0x15b3e8],_0x160b63=_0x43f914[_0x15b3e8],_0x465e9a=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x3587e7[_0x175ffe(0x9b)]);console[_0x175ffe(0x174)](_0x175ffe(0x169)+_0x3587e7['gateway']+_0x175ffe(0x13c)+_0x465e9a+'\x22');let _0x1d097c=_0x1a8b88+'\x20*'+_0x160b63+_0x175ffe(0xb0)+('💰\x20Amount:\x20*'+_0x3587e7[_0x175ffe(0x151)]+'\x20'+_0x3587e7[_0x175ffe(0x16b)]+'*\x0a')+(_0x175ffe(0x10c)+(_0x3587e7[_0x175ffe(0xbd)]||_0x3587e7['id'])+'`\x0a')+(_0x175ffe(0x171)+_0x3587e7['id']+'`\x0a')+(_0x175ffe(0xa9)+_0x465e9a+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x3587e7['createdAt'])['toLocaleString'](_0x175ffe(0x113))+'\x0a');if(_0x3587e7[_0x175ffe(0x177)]||_0x3587e7[_0x175ffe(0xe2)]||_0x3587e7['remitterIban']||_0x3587e7[_0x175ffe(0xd8)]||_0x3587e7['customerUa']){_0x1d097c+=_0x175ffe(0xc3);_0x3587e7['customerName']&&(_0x1d097c+='📛\x20Name:\x20`'+_0x3587e7['customerName']+'`\x0a');_0x3587e7['customerEmail']&&(_0x1d097c+='📧\x20Email:\x20`'+_0x3587e7[_0x175ffe(0xe2)]+'`\x0a');_0x3587e7[_0x175ffe(0xc4)]&&(_0x1d097c+='🏦\x20IBAN:\x20`'+_0x3587e7[_0x175ffe(0xc4)]+'`\x0a');_0x3587e7[_0x175ffe(0xd8)]&&(_0x1d097c+=_0x175ffe(0x107)+_0x3587e7['customerIp']+'`\x0a');if(_0x3587e7['customerUa']){const _0xf268d2=_0x3587e7[_0x175ffe(0xab)][_0x175ffe(0x164)]>0x32?_0x3587e7['customerUa'][_0x175ffe(0x13a)](0x0,0x32)+_0x175ffe(0x116):_0x3587e7['customerUa'];_0x1d097c+=_0x175ffe(0x119)+_0xf268d2+'`\x0a';}}_0x15b3e8===_0x175ffe(0x14f)&&_0x3587e7[_0x175ffe(0x17a)]&&(_0x1d097c+=_0x175ffe(0xeb)+_0x3587e7[_0x175ffe(0x17a)]+_0x175ffe(0x153)),_0x15b3e8===_0x175ffe(0x179)&&(_0x1d097c+=_0x175ffe(0x150)),_0x3587e7[_0x175ffe(0x108)]&&(_0x1d097c+=_0x175ffe(0x100)+_0x3587e7[_0x175ffe(0x108)]+'\x0a'),await this[_0x175ffe(0x123)](_0x70759c,_0x1d097c,{'parse_mode':_0x175ffe(0xbe)});}async[a57_0x7dc03f(0x9c)](_0x2a4f2a,_0x5c119b,_0x50d1a4){const _0x5badfc=a57_0x7dc03f,_0x109267={'created':'📤','completed':'✅','rejected':'❌'},_0x3e2e37={'created':_0x5badfc(0x104),'completed':_0x5badfc(0x140),'rejected':_0x5badfc(0xa5)},_0xca2853=_0x109267[_0x50d1a4],_0x3bb6c7=_0x3e2e37[_0x50d1a4],_0x27a3a4=_0xca2853+'\x20*'+_0x3bb6c7+_0x5badfc(0xb0)+(_0x5badfc(0xc1)+_0x5c119b['amount']+_0x5badfc(0xda))+(_0x5badfc(0x144)+_0x5c119b[_0x5badfc(0x162)]+'`\x0a')+(_0x5badfc(0x136)+_0x5c119b['id']+'`\x0a')+(_0x5badfc(0x115)+new Date(_0x5c119b[_0x5badfc(0xc8)])[_0x5badfc(0xf5)](_0x5badfc(0x113))+'\x0a')+(_0x5c119b[_0x5badfc(0xea)]?_0x5badfc(0xd6)+_0x5c119b[_0x5badfc(0xea)]+'`':'');await this[_0x5badfc(0x123)](_0x2a4f2a,_0x27a3a4,{'parse_mode':_0x5badfc(0xbe)});}async[a57_0x7dc03f(0xd9)](_0xf05382,_0x4c7ba0){const _0x269e2c=a57_0x7dc03f;try{const _0x29e3cd=await database_1[_0x269e2c(0x126)][_0x269e2c(0x10e)]['findUnique']({'where':{'shopId':_0xf05382},'select':{'notificationLogin':!![]}});if(!_0x29e3cd?.[_0x269e2c(0xd7)]){console[_0x269e2c(0x174)](_0x269e2c(0x152)+_0xf05382);return;}const _0xe91813=_0x4c7ba0[_0x269e2c(0x11f)]?'🔐':'🚨',_0x4dfae0=_0x4c7ba0[_0x269e2c(0x11f)]?_0x269e2c(0xb7):_0x269e2c(0x13b);let _0x28f0fc=_0xe91813+'\x20*'+_0x4dfae0+_0x269e2c(0xb0)+(_0x269e2c(0x12f)+_0x4c7ba0[_0x269e2c(0xb4)]+'`\x0a')+(_0x269e2c(0x142)+_0x4c7ba0['timestamp'][_0x269e2c(0xf5)](_0x269e2c(0x113))+'\x0a');_0x4c7ba0[_0x269e2c(0x122)]&&(_0x28f0fc+=_0x269e2c(0x96)+_0x4c7ba0['ipAddress']+'`\x0a');if(_0x4c7ba0['userAgent']){const _0x150fbe=_0x4c7ba0[_0x269e2c(0xf9)]['length']>0x32?_0x4c7ba0['userAgent'][_0x269e2c(0x13a)](0x0,0x32)+_0x269e2c(0x116):_0x4c7ba0[_0x269e2c(0xf9)];_0x28f0fc+=_0x269e2c(0x119)+_0x150fbe+'`\x0a';}!_0x4c7ba0[_0x269e2c(0x11f)]&&(_0x28f0fc+=_0x269e2c(0xd0)),await this[_0x269e2c(0x123)](_0xf05382,_0x28f0fc,{'parse_mode':_0x269e2c(0xbe)}),console['log'](_0x269e2c(0x11c)+_0xf05382+':\x20'+(_0x4c7ba0[_0x269e2c(0x11f)]?_0x269e2c(0x11f):_0x269e2c(0x17c)));}catch(_0x27cec2){console['error'](_0x269e2c(0x167),_0x27cec2);}}async[a57_0x7dc03f(0x11a)](_0x555980,_0xbad5f2){const _0x1f4e80=a57_0x7dc03f;try{const _0x5cedd0=await database_1[_0x1f4e80(0x126)][_0x1f4e80(0x10e)][_0x1f4e80(0x176)]({'where':{'shopId':_0x555980},'select':{'notificationApiError':!![]}});if(!_0x5cedd0?.[_0x1f4e80(0x117)]){console['log'](_0x1f4e80(0x155)+_0x555980);return;}let _0x46ea26='🚨\x20*API\x20Error*\x0a\x0a'+(_0x1f4e80(0xdc)+_0xbad5f2[_0x1f4e80(0x162)]+'\x20'+_0xbad5f2['endpoint']+'`\x0a')+(_0x1f4e80(0x142)+_0xbad5f2[_0x1f4e80(0xed)][_0x1f4e80(0xf5)]('en-US')+'\x0a');_0xbad5f2['statusCode']&&(_0x46ea26+=_0x1f4e80(0x12b)+_0xbad5f2['statusCode']+'`\x0a'),_0x46ea26+=_0x1f4e80(0xd4)+_0xbad5f2[_0x1f4e80(0xca)]+'`\x0a',_0xbad5f2[_0x1f4e80(0x15a)]&&(_0x46ea26+=_0x1f4e80(0xcc)+_0xbad5f2[_0x1f4e80(0x15a)]+'`\x0a'),_0x46ea26+=_0x1f4e80(0xfd),await this[_0x1f4e80(0x123)](_0x555980,_0x46ea26,{'parse_mode':_0x1f4e80(0xbe)}),console[_0x1f4e80(0x174)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x555980+':\x20'+_0xbad5f2[_0x1f4e80(0x121)]);}catch(_0x412b3d){console['error']('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x412b3d);}}async['sendCustomNotification'](_0x209525,_0xf6d577,_0x49d556){const _0x2b2f59=a57_0x7dc03f;let _0x35c281=_0x2b2f59(0xf4)+_0xf6d577+'*\x0a\x0a';for(const [_0x235edf,_0xe2b901]of Object['entries'](_0x49d556)){_0xe2b901!==null&&_0xe2b901!==undefined&&(_0x35c281+=_0x235edf+':\x20`'+_0xe2b901+'`\x0a');}await this[_0x2b2f59(0x123)](_0x209525,_0x35c281,{'parse_mode':'Markdown'});}[a57_0x7dc03f(0xe3)](){const _0x97960c=a57_0x7dc03f;return{'isActive':!!this[_0x97960c(0x168)],'username':this['botUsername']};}[a57_0x7dc03f(0x13f)](){const _0x3dd113=a57_0x7dc03f;this[_0x3dd113(0x168)]&&(this[_0x3dd113(0x168)][_0x3dd113(0x158)](),this[_0x3dd113(0x168)]=null,console[_0x3dd113(0x174)](_0x3dd113(0x16e)));}}exports[a57_0x7dc03f(0x10d)]=TelegramBotService,exports[a57_0x7dc03f(0xae)]=new TelegramBotService();