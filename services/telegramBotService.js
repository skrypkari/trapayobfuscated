'use strict';const a61_0x308698=a61_0x5ce0;(function(_0x24efde,_0x59283e){const _0x308b1b=a61_0x5ce0,_0x93d3de=_0x24efde();while(!![]){try{const _0x36e8f4=-parseInt(_0x308b1b(0x256))/0x1+-parseInt(_0x308b1b(0x1d7))/0x2+parseInt(_0x308b1b(0x2a6))/0x3*(-parseInt(_0x308b1b(0x1c2))/0x4)+parseInt(_0x308b1b(0x1cf))/0x5*(-parseInt(_0x308b1b(0x23f))/0x6)+-parseInt(_0x308b1b(0x253))/0x7+parseInt(_0x308b1b(0x224))/0x8+parseInt(_0x308b1b(0x25c))/0x9;if(_0x36e8f4===_0x59283e)break;else _0x93d3de['push'](_0x93d3de['shift']());}catch(_0x344fc0){_0x93d3de['push'](_0x93d3de['shift']());}}}(a61_0x2bca,0x75596));var __importDefault=this&&this[a61_0x308698(0x1f3)]||function(_0x433d6c){const _0x2b2793=a61_0x308698;return _0x433d6c&&_0x433d6c[_0x2b2793(0x297)]?_0x433d6c:{'default':_0x433d6c};};function a61_0x5ce0(_0x478577,_0x5af83a){const _0x2bca20=a61_0x2bca();return a61_0x5ce0=function(_0x5ce0a6,_0x29720d){_0x5ce0a6=_0x5ce0a6-0x1a8;let _0x5de287=_0x2bca20[_0x5ce0a6];return _0x5de287;},a61_0x5ce0(_0x478577,_0x5af83a);}Object[a61_0x308698(0x1d1)](exports,a61_0x308698(0x297),{'value':!![]}),exports[a61_0x308698(0x1bd)]=exports[a61_0x308698(0x231)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a61_0x308698(0x22d))),database_1=__importDefault(require('../config/database')),gateway_1=require(a61_0x308698(0x1c7));class TelegramBotService{constructor(){const _0x1edf18=a61_0x308698;this['bot']=null,this['botToken']=process[_0x1edf18(0x268)][_0x1edf18(0x214)]||'',this[_0x1edf18(0x26a)]=process[_0x1edf18(0x268)][_0x1edf18(0x1e5)]||_0x1edf18(0x1ed),this[_0x1edf18(0x28e)]?this[_0x1edf18(0x1ef)]():console[_0x1edf18(0x21b)](_0x1edf18(0x29b));}[a61_0x308698(0x1ef)](){const _0x2977fa=a61_0x308698;try{this['bot']=new node_telegram_bot_api_1['default'](this[_0x2977fa(0x28e)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x2977fa(0x1ca)](_0x2977fa(0x21c)+this['botUsername']+_0x2977fa(0x287));}catch(_0x326f47){console[_0x2977fa(0x249)](_0x2977fa(0x28a),_0x326f47);}}[a61_0x308698(0x288)](){const _0x35a34d=a61_0x308698;if(!this[_0x35a34d(0x1d4)])return;this['bot'][_0x35a34d(0x203)](/\/start/,async _0x35992a=>{const _0x2e2b1b=_0x35a34d,_0x24ccbc=_0x35992a[_0x2e2b1b(0x1b0)]['id'],_0x4b150a=_0x35992a[_0x2e2b1b(0x1f8)]?.['id'][_0x2e2b1b(0x222)](),_0x3c6b19=_0x35992a[_0x2e2b1b(0x1f8)]?.['username'],_0x2e72e3=_0x35992a[_0x2e2b1b(0x1f8)]?.[_0x2e2b1b(0x206)],_0x5963a2=_0x35992a['from']?.['last_name'];if(!_0x4b150a)return;try{let _0x10aac7=await database_1[_0x2e2b1b(0x28f)]['telegramUser']['findUnique']({'where':{'telegramId':_0x4b150a},'include':{'shop':!![]}});!_0x10aac7?(_0x10aac7=await database_1['default']['telegramUser']['create']({'data':{'telegramId':_0x4b150a,'username':_0x3c6b19,'firstName':_0x2e72e3,'lastName':_0x5963a2,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x2e2b1b(0x1e4)+_0x4b150a+'\x20(@'+_0x3c6b19+')')):_0x10aac7=await database_1[_0x2e2b1b(0x28f)][_0x2e2b1b(0x2a2)]['update']({'where':{'telegramId':_0x4b150a},'data':{'username':_0x3c6b19,'firstName':_0x2e72e3,'lastName':_0x5963a2},'include':{'shop':!![]}}),_0x10aac7['isVerified']&&_0x10aac7[_0x2e2b1b(0x23e)]&&_0x10aac7[_0x2e2b1b(0x1f4)]?await this[_0x2e2b1b(0x1d4)]?.[_0x2e2b1b(0x258)](_0x24ccbc,_0x2e2b1b(0x232)+(_0x2e2b1b(0x1f5)+_0x10aac7[_0x2e2b1b(0x1f4)][_0x2e2b1b(0x209)]+'*\x0a')+(_0x2e2b1b(0x228)+_0x10aac7[_0x2e2b1b(0x1f4)][_0x2e2b1b(0x271)]+_0x2e2b1b(0x27a))+_0x2e2b1b(0x1c5)+_0x2e2b1b(0x263)+'•\x20Payment\x20status\x20changes\x0a'+_0x2e2b1b(0x1fc)+'Commands:\x0a'+_0x2e2b1b(0x285)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x2e2b1b(0x226)}):(_0x10aac7[_0x2e2b1b(0x23e)]&&!_0x10aac7['isVerified']&&(await database_1[_0x2e2b1b(0x28f)][_0x2e2b1b(0x2a2)]['update']({'where':{'telegramId':_0x4b150a},'data':{'shopId':null,'isVerified':![]}}),console[_0x2e2b1b(0x1ca)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x4b150a)),await this[_0x2e2b1b(0x1d4)]?.[_0x2e2b1b(0x258)](_0x24ccbc,_0x2e2b1b(0x1c0)+_0x2e2b1b(0x26f)+_0x2e2b1b(0x237)+_0x2e2b1b(0x1f9)+_0x2e2b1b(0x26d)+_0x2e2b1b(0x20b),{'parse_mode':_0x2e2b1b(0x226)}));}catch(_0x2ac91c){console[_0x2e2b1b(0x249)](_0x2e2b1b(0x235),_0x2ac91c),await this[_0x2e2b1b(0x1d4)]?.[_0x2e2b1b(0x258)](_0x24ccbc,_0x2e2b1b(0x1b9));}}),this['bot'][_0x35a34d(0x203)](/\/disconnect/,async _0x52c38c=>{const _0x836019=_0x35a34d,_0x535a9a=_0x52c38c[_0x836019(0x1b0)]['id'],_0x1691ee=_0x52c38c[_0x836019(0x1f8)]?.['id'][_0x836019(0x222)]();if(!_0x1691ee)return;try{const _0x212b13=await database_1[_0x836019(0x28f)][_0x836019(0x2a2)][_0x836019(0x25b)]({'where':{'telegramId':_0x1691ee},'include':{'shop':!![]}});if(!_0x212b13||!_0x212b13[_0x836019(0x1bf)]||!_0x212b13['shopId']){await this[_0x836019(0x1d4)]?.['sendMessage'](_0x535a9a,_0x836019(0x1d3));return;}const _0x26cc3e=_0x212b13[_0x836019(0x1f4)]?.[_0x836019(0x209)]||'unknown\x20shop';await database_1[_0x836019(0x28f)]['telegramUser'][_0x836019(0x2a5)]({'where':{'telegramId':_0x1691ee},'data':{'shopId':null,'isVerified':![]}}),console[_0x836019(0x1ca)](_0x836019(0x1dc)+_0x1691ee+'\x20disconnected\x20from\x20shop\x20'+_0x212b13[_0x836019(0x23e)]),await this['bot']?.[_0x836019(0x258)](_0x535a9a,_0x836019(0x27e)+_0x26cc3e+_0x836019(0x1ce)+_0x836019(0x1eb),{'parse_mode':_0x836019(0x226)});}catch(_0x41cc3){console['error'](_0x836019(0x273),_0x41cc3),await this[_0x836019(0x1d4)]?.[_0x836019(0x258)](_0x535a9a,_0x836019(0x1b9));}}),this['bot'][_0x35a34d(0x203)](/\/status/,async _0xcbb3ba=>{const _0x2a4826=_0x35a34d,_0x8442ba=_0xcbb3ba['chat']['id'],_0x352d3b=_0xcbb3ba[_0x2a4826(0x1f8)]?.['id'][_0x2a4826(0x222)]();if(!_0x352d3b)return;try{const _0x435749=await database_1[_0x2a4826(0x28f)][_0x2a4826(0x2a2)][_0x2a4826(0x25b)]({'where':{'telegramId':_0x352d3b},'include':{'shop':!![]}});if(!_0x435749){await this[_0x2a4826(0x1d4)]?.[_0x2a4826(0x258)](_0x8442ba,_0x2a4826(0x25f)+_0x2a4826(0x28d));return;}if(!_0x435749['isVerified']||!_0x435749['shopId']||!_0x435749['shop']){await this[_0x2a4826(0x1d4)]?.[_0x2a4826(0x258)](_0x8442ba,_0x2a4826(0x251)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x2a4826(0x1d4)]?.[_0x2a4826(0x258)](_0x8442ba,_0x2a4826(0x2aa)+(_0x2a4826(0x227)+_0x435749[_0x2a4826(0x1f4)][_0x2a4826(0x209)]+'*\x0a')+('👤\x20Username:\x20`'+_0x435749['shop'][_0x2a4826(0x271)]+'`\x0a')+(_0x2a4826(0x239)+_0x435749['updatedAt'][_0x2a4826(0x1bb)](_0x2a4826(0x244))+'\x0a\x0a')+_0x2a4826(0x1b3)+'Commands:\x0a'+_0x2a4826(0x25e),{'parse_mode':'Markdown'});}catch(_0x1dcb73){console[_0x2a4826(0x249)](_0x2a4826(0x264),_0x1dcb73),await this['bot']?.[_0x2a4826(0x258)](_0x8442ba,_0x2a4826(0x1b9));}}),this[_0x35a34d(0x1d4)]['onText'](/\/debug/,async _0x15aa78=>{const _0x5495ae=_0x35a34d,_0x5ed666=_0x15aa78[_0x5495ae(0x1b0)]['id'],_0x12e61a=_0x15aa78[_0x5495ae(0x1f8)]?.['id'][_0x5495ae(0x222)]();if(!_0x12e61a)return;try{const _0x5b61a1=await database_1[_0x5495ae(0x28f)][_0x5495ae(0x1f4)][_0x5495ae(0x200)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x51ed67=_0x5495ae(0x1fe);_0x51ed67+=_0x5495ae(0x298)+_0x12e61a+'`\x0a\x0a',_0x51ed67+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x5b61a1[_0x5495ae(0x23c)]((_0x13e26b,_0x1a5457)=>{const _0x1d7b18=_0x5495ae;_0x51ed67+=_0x1a5457+0x1+_0x1d7b18(0x29c)+_0x13e26b['name']+'*\x0a',_0x51ed67+='\x20\x20\x20Username:\x20`'+_0x13e26b[_0x1d7b18(0x271)]+'`\x0a',_0x51ed67+='\x20\x20\x20Status:\x20'+_0x13e26b['status']+'\x0a',_0x51ed67+='\x20\x20\x20Public\x20Key:\x20`'+_0x13e26b[_0x1d7b18(0x1cc)][_0x1d7b18(0x24c)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x5495ae(0x1d4)]?.['sendMessage'](_0x5ed666,_0x51ed67,{'parse_mode':'Markdown'});}catch(_0x3ba8d6){console['error'](_0x5495ae(0x20f),_0x3ba8d6),await this[_0x5495ae(0x1d4)]?.[_0x5495ae(0x258)](_0x5ed666,_0x5495ae(0x289));}}),this[_0x35a34d(0x1d4)]['on'](_0x35a34d(0x1c8),async _0x4ebd15=>{const _0x1cdb94=_0x35a34d;if(_0x4ebd15[_0x1cdb94(0x2ab)]?.[_0x1cdb94(0x1c3)]('/'))return;const _0x18cecb=_0x4ebd15[_0x1cdb94(0x1b0)]['id'],_0x45473e=_0x4ebd15[_0x1cdb94(0x1f8)]?.['id'][_0x1cdb94(0x222)](),_0x599b73=_0x4ebd15['text']?.[_0x1cdb94(0x294)]();if(!_0x45473e||!_0x599b73)return;try{const _0x409780=await database_1[_0x1cdb94(0x28f)][_0x1cdb94(0x2a2)]['findUnique']({'where':{'telegramId':_0x45473e},'include':{'shop':!![]}});if(!_0x409780){await this[_0x1cdb94(0x1d4)]?.[_0x1cdb94(0x258)](_0x18cecb,_0x1cdb94(0x276));return;}if(_0x409780['isVerified']&&_0x409780[_0x1cdb94(0x23e)]&&_0x409780[_0x1cdb94(0x1f4)]){await this[_0x1cdb94(0x1d4)]?.[_0x1cdb94(0x258)](_0x18cecb,_0x1cdb94(0x265)+_0x409780[_0x1cdb94(0x1f4)][_0x1cdb94(0x209)]+_0x1cdb94(0x1ce)+_0x1cdb94(0x1de),{'parse_mode':_0x1cdb94(0x226)});return;}const _0x53d2c3=_0x599b73[_0x1cdb94(0x229)](/\s+/);if(_0x53d2c3['length']!==0x2){await this[_0x1cdb94(0x1d4)]?.[_0x1cdb94(0x258)](_0x18cecb,_0x1cdb94(0x2a1)+_0x1cdb94(0x237)+'Example:\x0a'+_0x1cdb94(0x26d)+(_0x1cdb94(0x1ee)+_0x53d2c3[_0x1cdb94(0x2ac)]+_0x1cdb94(0x28c)+_0x53d2c3['map'](_0x1f6c84=>'`'+_0x1f6c84+'`')['join'](',\x20')),{'parse_mode':_0x1cdb94(0x226)});return;}const [_0x5d503e,_0x5426d5]=_0x53d2c3;console['log']('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x45473e+_0x1cdb94(0x278)+_0x5d503e+_0x1cdb94(0x1b4)+_0x5426d5[_0x1cdb94(0x24c)](0x0,0xa)+_0x1cdb94(0x1d9)),await this[_0x1cdb94(0x1b6)](_0x18cecb,_0x45473e,_0x5d503e,_0x5426d5);}catch(_0x39275f){console[_0x1cdb94(0x249)](_0x1cdb94(0x1e2),_0x39275f),await this[_0x1cdb94(0x1d4)]?.[_0x1cdb94(0x258)](_0x18cecb,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x35a34d(0x1d4)]['on'](_0x35a34d(0x249),_0x53d032=>{const _0x2ba95f=_0x35a34d;console[_0x2ba95f(0x249)](_0x2ba95f(0x1ea),_0x53d032);}),this[_0x35a34d(0x1d4)]['on'](_0x35a34d(0x29e),_0x28487f=>{const _0x2a69d7=_0x35a34d;console[_0x2a69d7(0x249)](_0x2a69d7(0x207),_0x28487f);});}async['handleSingleLineVerification'](_0x1ab212,_0x3b2329,_0x46a4a2,_0x493795){const _0xa756c0=a61_0x308698;try{console[_0xa756c0(0x1ca)](_0xa756c0(0x20d)+_0x3b2329+':\x20username=\x22'+_0x46a4a2+_0xa756c0(0x1b4)+_0x493795['substring'](0x0,0xa)+_0xa756c0(0x1d9));if(!_0x46a4a2||_0x46a4a2[_0xa756c0(0x2ac)]<0x3||_0x46a4a2['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0xa756c0(0x2a0)](_0x46a4a2)){await this[_0xa756c0(0x1d4)]?.[_0xa756c0(0x258)](_0x1ab212,_0xa756c0(0x242)+_0x46a4a2+'`\x0a\x0a'+_0xa756c0(0x204),{'parse_mode':_0xa756c0(0x226)});return;}if(!_0x493795||!_0x493795[_0xa756c0(0x1c3)](_0xa756c0(0x1c6))&&!_0x493795['startsWith'](_0xa756c0(0x210))){await this['bot']?.['sendMessage'](_0x1ab212,_0xa756c0(0x2a3)+_0xa756c0(0x270),{'parse_mode':_0xa756c0(0x226)});return;}const _0x185ae4=await database_1['default'][_0xa756c0(0x1f4)][_0xa756c0(0x25b)]({'where':{'username':_0x46a4a2},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x185ae4){const _0x2b1313=await database_1[_0xa756c0(0x28f)][_0xa756c0(0x1f4)][_0xa756c0(0x200)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x539544=_0xa756c0(0x27c)+_0x46a4a2+_0xa756c0(0x1cd);_0x2b1313[_0xa756c0(0x2ac)]>0x0?(_0x539544+=_0xa756c0(0x220),_0x2b1313[_0xa756c0(0x23c)](_0x100731=>{const _0x47781c=_0xa756c0;_0x539544+=_0x47781c(0x21d)+_0x100731[_0x47781c(0x271)]+_0x47781c(0x23b)+_0x100731[_0x47781c(0x209)]+')\x0a';}),_0x539544+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x539544+='Check\x20spelling\x20and\x20try\x20again.';await this[_0xa756c0(0x1d4)]?.['sendMessage'](_0x1ab212,_0x539544,{'parse_mode':_0xa756c0(0x226)});return;}if(_0x185ae4[_0xa756c0(0x1ae)]!==_0xa756c0(0x1d8)){await this['bot']?.[_0xa756c0(0x258)](_0x1ab212,'❌\x20Shop\x20`'+_0x46a4a2+'`\x20is\x20inactive.\x0a\x0a'+_0xa756c0(0x2a8),{'parse_mode':_0xa756c0(0x226)});return;}if(_0x185ae4['publicKey']!==_0x493795&&_0x185ae4[_0xa756c0(0x295)]!==_0x493795){await this[_0xa756c0(0x1d4)]?.['sendMessage'](_0x1ab212,_0xa756c0(0x1b5)+_0x46a4a2+_0xa756c0(0x1b1)+_0xa756c0(0x281)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0xa756c0(0x226)});return;}const _0x227cf1=await database_1[_0xa756c0(0x28f)][_0xa756c0(0x2a2)][_0xa756c0(0x1db)]({'where':{'shopId':_0x185ae4['id'],'isVerified':!![],'telegramId':{'not':_0x3b2329}}});if(_0x227cf1){await this[_0xa756c0(0x1d4)]?.['sendMessage'](_0x1ab212,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x46a4a2+_0xa756c0(0x1b1)+_0xa756c0(0x1e3),{'parse_mode':_0xa756c0(0x226)});return;}await database_1[_0xa756c0(0x28f)][_0xa756c0(0x2a2)]['update']({'where':{'telegramId':_0x3b2329},'data':{'shopId':_0x185ae4['id'],'isVerified':!![]}}),await this[_0xa756c0(0x1d4)]?.[_0xa756c0(0x258)](_0x1ab212,_0xa756c0(0x217)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0xa756c0(0x1e1)+_0x185ae4[_0xa756c0(0x209)]+'*\x0a')+(_0xa756c0(0x277)+_0x185ae4[_0xa756c0(0x271)]+_0xa756c0(0x27a))+_0xa756c0(0x1b2)+_0xa756c0(0x263)+_0xa756c0(0x1c9)+_0xa756c0(0x233)+_0xa756c0(0x24a)+_0xa756c0(0x269)+_0xa756c0(0x285)+_0xa756c0(0x25e),{'parse_mode':_0xa756c0(0x226)}),console[_0xa756c0(0x1ca)](_0xa756c0(0x1fd)+_0x3b2329+_0xa756c0(0x23d)+_0x185ae4[_0xa756c0(0x271)]+_0xa756c0(0x1fa));}catch(_0x375d86){console[_0xa756c0(0x249)](_0xa756c0(0x215),_0x375d86),await this['bot']?.[_0xa756c0(0x258)](_0x1ab212,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a61_0x308698(0x223)](_0xf0299c,_0x875b9e,_0x263085){const _0x3cbdb7=a61_0x308698;if(!this[_0x3cbdb7(0x1d4)]){console[_0x3cbdb7(0x21b)](_0x3cbdb7(0x1f2));return;}try{const _0x2a51d2=await database_1['default'][_0x3cbdb7(0x2a2)][_0x3cbdb7(0x200)]({'where':{'shopId':_0xf0299c,'isVerified':!![]}});if(_0x2a51d2['length']===0x0){console[_0x3cbdb7(0x1ca)](_0x3cbdb7(0x1ab)+_0xf0299c);return;}const _0x555982=_0x2a51d2[_0x3cbdb7(0x218)](async _0x370972=>{const _0x2e04b7=_0x3cbdb7;try{await this[_0x2e04b7(0x1d4)]?.[_0x2e04b7(0x258)](_0x370972[_0x2e04b7(0x1b7)],_0x875b9e,_0x263085),console['log'](_0x2e04b7(0x29d)+_0x370972[_0x2e04b7(0x1b7)]);}catch(_0x35fb50){console['error'](_0x2e04b7(0x245)+_0x370972['telegramId']+':',_0x35fb50),_0x35fb50 instanceof Error&&(_0x35fb50[_0x2e04b7(0x1c8)][_0x2e04b7(0x202)](_0x2e04b7(0x243))||_0x35fb50[_0x2e04b7(0x1c8)][_0x2e04b7(0x202)](_0x2e04b7(0x252))||_0x35fb50[_0x2e04b7(0x1c8)][_0x2e04b7(0x202)]('user\x20is\x20deactivated'))&&(await database_1['default']['telegramUser'][_0x2e04b7(0x2a5)]({'where':{'id':_0x370972['id']},'data':{'isVerified':![]}}),console[_0x2e04b7(0x1ca)](_0x2e04b7(0x284)+_0x370972[_0x2e04b7(0x1b7)]+_0x2e04b7(0x262)));}});await Promise[_0x3cbdb7(0x1cb)](_0x555982);}catch(_0x3edd37){console[_0x3cbdb7(0x249)](_0x3cbdb7(0x2ad),_0x3edd37);}}async[a61_0x308698(0x2a9)](_0x7f158f,_0x2180c1,_0x51d23d){const _0x5d4bba=a61_0x308698,_0x28e84f={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x57f274={'created':_0x5d4bba(0x208),'paid':_0x5d4bba(0x1f7),'failed':_0x5d4bba(0x261),'expired':'Payment\x20expired','refund':_0x5d4bba(0x2a7),'chargeback':'Payment\x20chargeback','processing':_0x5d4bba(0x216)},_0x5ed7e3=_0x28e84f[_0x51d23d],_0x472136=_0x57f274[_0x51d23d],_0x4756b7=(0x0,gateway_1[_0x5d4bba(0x27b)])(_0x2180c1['gateway']);console[_0x5d4bba(0x1ca)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x2180c1[_0x5d4bba(0x29f)]+_0x5d4bba(0x21e)+_0x4756b7+'\x22');let _0x2648a5=_0x5ed7e3+'\x20*'+_0x472136+_0x5d4bba(0x26e)+(_0x5d4bba(0x299)+_0x2180c1[_0x5d4bba(0x246)]+'\x20'+_0x2180c1[_0x5d4bba(0x240)]+'*\x0a')+(_0x5d4bba(0x1ba)+(_0x2180c1[_0x5d4bba(0x260)]||_0x2180c1['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x2180c1['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x4756b7+'`\x0a')+(_0x5d4bba(0x266)+new Date(_0x2180c1['createdAt'])[_0x5d4bba(0x1df)](_0x5d4bba(0x244))+'\x0a');if(_0x2180c1[_0x5d4bba(0x26b)]||_0x2180c1[_0x5d4bba(0x20a)]||_0x2180c1['remitterIban']||_0x2180c1['customerIp']||_0x2180c1[_0x5d4bba(0x283)]){_0x2648a5+=_0x5d4bba(0x24b);_0x2180c1[_0x5d4bba(0x26b)]&&(_0x2648a5+='📛\x20Name:\x20`'+_0x2180c1[_0x5d4bba(0x26b)]+'`\x0a');_0x2180c1['customerEmail']&&(_0x2648a5+='📧\x20Email:\x20`'+_0x2180c1['customerEmail']+'`\x0a');_0x2180c1['remitterIban']&&(_0x2648a5+=_0x5d4bba(0x250)+_0x2180c1[_0x5d4bba(0x230)]+'`\x0a');_0x2180c1[_0x5d4bba(0x1a9)]&&(_0x2648a5+=_0x5d4bba(0x255)+_0x2180c1[_0x5d4bba(0x1a9)]+'`\x0a');if(_0x2180c1[_0x5d4bba(0x283)]){const _0x582b22=_0x2180c1[_0x5d4bba(0x283)]['length']>0x32?_0x2180c1['customerUa'][_0x5d4bba(0x24c)](0x0,0x32)+'...':_0x2180c1[_0x5d4bba(0x283)];_0x2648a5+=_0x5d4bba(0x1fb)+_0x582b22+'`\x0a';}}_0x51d23d===_0x5d4bba(0x20c)&&_0x2180c1[_0x5d4bba(0x1a8)]&&(_0x2648a5+=_0x5d4bba(0x293)+_0x2180c1[_0x5d4bba(0x1a8)]+_0x5d4bba(0x234)),_0x51d23d==='processing'&&(_0x2648a5+=_0x5d4bba(0x238)),_0x2180c1[_0x5d4bba(0x1ec)]&&(_0x2648a5+=_0x5d4bba(0x241)+_0x2180c1[_0x5d4bba(0x1ec)]+'\x0a'),await this[_0x5d4bba(0x223)](_0x7f158f,_0x2648a5,{'parse_mode':_0x5d4bba(0x226)});}async['sendPayoutNotification'](_0x4b9531,_0x5a7ee0,_0x2c8763){const _0x1917f6=a61_0x308698,_0x3defaa={'created':'📤','completed':'✅','rejected':'❌'},_0x5f5a44={'created':_0x1917f6(0x21f),'completed':_0x1917f6(0x296),'rejected':'Payout\x20rejected'},_0x393386=_0x3defaa[_0x2c8763],_0x28f71c=_0x5f5a44[_0x2c8763],_0x2e2a93=_0x393386+'\x20*'+_0x28f71c+_0x1917f6(0x26e)+('💸\x20Amount:\x20*'+_0x5a7ee0[_0x1917f6(0x246)]+_0x1917f6(0x1e8))+(_0x1917f6(0x24e)+_0x5a7ee0['method']+'`\x0a')+(_0x1917f6(0x28b)+_0x5a7ee0['id']+'`\x0a')+(_0x1917f6(0x266)+new Date(_0x5a7ee0[_0x1917f6(0x212)])['toLocaleString'](_0x1917f6(0x244))+'\x0a')+(_0x5a7ee0[_0x1917f6(0x24d)]?_0x1917f6(0x1e7)+_0x5a7ee0[_0x1917f6(0x24d)]+'`':'');await this['sendShopNotification'](_0x4b9531,_0x2e2a93,{'parse_mode':_0x1917f6(0x226)});}async[a61_0x308698(0x292)](_0x4911c2,_0x272e6d){const _0x11bc16=a61_0x308698;try{const _0x118b00=await database_1[_0x11bc16(0x28f)]['shopSettings']['findUnique']({'where':{'shopId':_0x4911c2},'select':{'notificationLogin':!![]}});if(!_0x118b00?.[_0x11bc16(0x1f0)]){console[_0x11bc16(0x1ca)](_0x11bc16(0x22e)+_0x4911c2);return;}const _0x4b1d29=_0x272e6d[_0x11bc16(0x205)]?'🔐':'🚨',_0x4c2223=_0x272e6d[_0x11bc16(0x205)]?_0x11bc16(0x1f1):'Failed\x20login\x20attempt';let _0x4c5c47=_0x4b1d29+'\x20*'+_0x4c2223+_0x11bc16(0x26e)+(_0x11bc16(0x277)+_0x272e6d['username']+'`\x0a')+(_0x11bc16(0x275)+_0x272e6d[_0x11bc16(0x1bc)][_0x11bc16(0x1df)](_0x11bc16(0x244))+'\x0a');_0x272e6d[_0x11bc16(0x23a)]&&(_0x4c5c47+=_0x11bc16(0x274)+_0x272e6d[_0x11bc16(0x23a)]+'`\x0a');if(_0x272e6d[_0x11bc16(0x248)]){const _0x432748=_0x272e6d[_0x11bc16(0x248)][_0x11bc16(0x2ac)]>0x32?_0x272e6d['userAgent'][_0x11bc16(0x24c)](0x0,0x32)+_0x11bc16(0x1ac):_0x272e6d[_0x11bc16(0x248)];_0x4c5c47+=_0x11bc16(0x1fb)+_0x432748+'`\x0a';}!_0x272e6d[_0x11bc16(0x205)]&&(_0x4c5c47+=_0x11bc16(0x1d0)),await this[_0x11bc16(0x223)](_0x4911c2,_0x4c5c47,{'parse_mode':'Markdown'}),console[_0x11bc16(0x1ca)](_0x11bc16(0x21a)+_0x4911c2+':\x20'+(_0x272e6d[_0x11bc16(0x205)]?'success':'failed'));}catch(_0x263e20){console['error'](_0x11bc16(0x211),_0x263e20);}}async[a61_0x308698(0x26c)](_0x5866c5,_0x1f5150){const _0x52a24e=a61_0x308698;try{const _0x865046=await database_1[_0x52a24e(0x28f)][_0x52a24e(0x20e)][_0x52a24e(0x25b)]({'where':{'shopId':_0x5866c5},'select':{'notificationApiError':!![]}});if(!_0x865046?.[_0x52a24e(0x272)]){console[_0x52a24e(0x1ca)](_0x52a24e(0x1da)+_0x5866c5);return;}let _0x493b0c='🚨\x20*API\x20Error*\x0a\x0a'+('🔗\x20Endpoint:\x20`'+_0x1f5150[_0x52a24e(0x1ff)]+'\x20'+_0x1f5150[_0x52a24e(0x1d2)]+'`\x0a')+('📅\x20Time:\x20'+_0x1f5150['timestamp']['toLocaleString'](_0x52a24e(0x244))+'\x0a');_0x1f5150['statusCode']&&(_0x493b0c+=_0x52a24e(0x1c1)+_0x1f5150['statusCode']+'`\x0a'),_0x493b0c+=_0x52a24e(0x1be)+_0x1f5150[_0x52a24e(0x25a)]+'`\x0a',_0x1f5150['requestId']&&(_0x493b0c+=_0x52a24e(0x254)+_0x1f5150[_0x52a24e(0x221)]+'`\x0a'),_0x493b0c+=_0x52a24e(0x1af),await this[_0x52a24e(0x223)](_0x5866c5,_0x493b0c,{'parse_mode':_0x52a24e(0x226)}),console[_0x52a24e(0x1ca)](_0x52a24e(0x1c4)+_0x5866c5+':\x20'+_0x1f5150[_0x52a24e(0x1d2)]);}catch(_0x413d2c){console['error'](_0x52a24e(0x22a),_0x413d2c);}}async[a61_0x308698(0x280)](_0x5d86d0,_0x3e6ffa,_0x58baec){const _0x30dd36=a61_0x308698;let _0x4055cc='🔔\x20*'+_0x3e6ffa+_0x30dd36(0x26e);for(const [_0x1224e7,_0x5313e3]of Object[_0x30dd36(0x257)](_0x58baec)){_0x5313e3!==null&&_0x5313e3!==undefined&&(_0x4055cc+=_0x1224e7+_0x30dd36(0x291)+_0x5313e3+'`\x0a');}await this['sendShopNotification'](_0x5d86d0,_0x4055cc,{'parse_mode':'Markdown'});}async['sendNotificationToAll'](_0x13934c){const _0x37ee71=a61_0x308698;try{console[_0x37ee71(0x1ca)]('📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20'+_0x13934c['substring'](0x0,0x32)+'...');const _0x2e1011=await database_1['default'][_0x37ee71(0x2a2)][_0x37ee71(0x200)]({'select':{'telegramId':!![]}});if(_0x2e1011[_0x37ee71(0x2ac)]===0x0){console[_0x37ee71(0x1ca)](_0x37ee71(0x1f6));return;}for(const _0x1367f3 of _0x2e1011){try{await this[_0x37ee71(0x1d4)]?.[_0x37ee71(0x258)](_0x1367f3[_0x37ee71(0x1b7)],_0x13934c,{'parse_mode':_0x37ee71(0x226)});}catch(_0x38403b){console[_0x37ee71(0x249)](_0x37ee71(0x279)+_0x1367f3[_0x37ee71(0x1b7)]+':',_0x38403b);}}console[_0x37ee71(0x1ca)](_0x37ee71(0x286)+_0x2e1011[_0x37ee71(0x2ac)]+_0x37ee71(0x24f));}catch(_0x3b6c9f){console[_0x37ee71(0x249)](_0x37ee71(0x259),_0x3b6c9f);}}['getBotInfo'](){const _0x474cc1=a61_0x308698;return{'isActive':!!this['bot'],'username':this[_0x474cc1(0x26a)]};}async[a61_0x308698(0x1b8)](_0xe27625,_0x2b214b,_0x34d4dc,_0x3724a9){const _0x152007=a61_0x308698;try{if(!this['bot'])return console[_0x152007(0x249)](_0x152007(0x1e9)),![];const _0x51e4ca=await database_1[_0x152007(0x28f)][_0x152007(0x2a2)][_0x152007(0x200)]({'where':{'shopId':_0xe27625,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x51e4ca['length']===0x0)return console[_0x152007(0x249)](_0x152007(0x25d)+_0xe27625),![];let _0x1afd52=0x0;for(const _0xe1c9af of _0x51e4ca){try{await this[_0x152007(0x1d4)][_0x152007(0x282)](_0xe1c9af[_0x152007(0x1b7)],_0x2b214b,{},{'filename':_0x34d4dc,'contentType':_0x34d4dc[_0x152007(0x1d5)](_0x152007(0x219))?_0x152007(0x27d):_0x34d4dc['endsWith']('.jpg')||_0x34d4dc[_0x152007(0x1d5)](_0x152007(0x201))?_0x152007(0x1dd):_0x34d4dc[_0x152007(0x1d5)](_0x152007(0x22b))?'application/pdf':_0x152007(0x247)}),_0x3724a9&&await this[_0x152007(0x1d4)][_0x152007(0x258)](_0xe1c9af['telegramId'],_0x3724a9),_0x1afd52++;}catch(_0x23cfa8){console[_0x152007(0x249)](_0x152007(0x1aa)+_0xe1c9af[_0x152007(0x1b7)]+':',_0x23cfa8);}}return console['log'](_0x152007(0x22c)+_0x1afd52+'/'+_0x51e4ca[_0x152007(0x2ac)]+_0x152007(0x225)+_0xe27625+':\x20'+_0x34d4dc),_0x1afd52>0x0;}catch(_0x1468dc){return console[_0x152007(0x249)](_0x152007(0x1e0),_0x1468dc),![];}}async[a61_0x308698(0x1d6)](_0x121ad7,_0x46d0be){const _0x5e0819=a61_0x308698;try{if(!this['bot'])return console[_0x5e0819(0x249)](_0x5e0819(0x1e9)),![];return await this['bot'][_0x5e0819(0x258)](_0x121ad7,_0x46d0be),console[_0x5e0819(0x1ca)](_0x5e0819(0x1ad)+_0x121ad7),!![];}catch(_0x29ab48){return console['error'](_0x5e0819(0x290),_0x29ab48),![];}}async[a61_0x308698(0x22f)](_0x2ad919,_0x5cb804,_0x54fc85,_0xb4cee6){const _0x16cd0e=a61_0x308698;try{if(!this[_0x16cd0e(0x1d4)])return console[_0x16cd0e(0x249)](_0x16cd0e(0x1e9)),![];return await this['bot'][_0x16cd0e(0x282)](_0x2ad919,_0x5cb804,{},{'filename':_0x54fc85,'contentType':_0x54fc85[_0x16cd0e(0x1d5)](_0x16cd0e(0x219))?_0x16cd0e(0x27d):_0x54fc85['endsWith'](_0x16cd0e(0x2a4))||_0x54fc85[_0x16cd0e(0x1d5)](_0x16cd0e(0x201))?'image/jpeg':_0x54fc85[_0x16cd0e(0x1d5)](_0x16cd0e(0x22b))?_0x16cd0e(0x236):_0x16cd0e(0x247)}),_0xb4cee6&&await this['bot']['sendMessage'](_0x2ad919,_0xb4cee6),console['log'](_0x16cd0e(0x267)+_0x2ad919+':\x20'+_0x54fc85),!![];}catch(_0x31fade){return console[_0x16cd0e(0x249)](_0x16cd0e(0x27f),_0x31fade),![];}}[a61_0x308698(0x1e6)](){const _0x552756=a61_0x308698;this[_0x552756(0x1d4)]&&(this['bot'][_0x552756(0x213)](),this[_0x552756(0x1d4)]=null,console[_0x552756(0x1ca)](_0x552756(0x29a)));}}function a61_0x2bca(){const _0x1a3a53=['substring','txid','🏦\x20Method:\x20`','\x20users','🏦\x20IBAN:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','chat\x20not\x20found','5128802kxfqQs','🆔\x20Request\x20ID:\x20`','🌐\x20IP:\x20`','702722cPTSbA','entries','sendMessage','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','errorMessage','findUnique','40859604cnYVjk','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','/disconnect\x20-\x20disconnect\x20from\x20notifications','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','orderId','Payment\x20failed','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','•\x20New\x20payments\x0a','Error\x20handling\x20/status\x20command:','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','📅\x20Date:\x20','✅\x20File\x20sent\x20to\x20chat\x20','env','Commands:\x0a','botUsername','customerName','sendApiErrorNotification','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','*\x0a\x0a','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','username','notificationApiError','Error\x20handling\x20/disconnect\x20command:','🌐\x20IP\x20address:\x20`','📅\x20Time:\x20','❌\x20Please\x20use\x20/start\x20command\x20first','👤\x20Username:\x20`',':\x20username=\x22','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','`\x0a\x0a','getGatewayDisplayNameForTelegram','❌\x20Shop\x20with\x20username\x20`','image/png','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','❌\x20Error\x20sending\x20file\x20to\x20chat:','sendCustomNotification','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','sendDocument','customerUa','User\x20','/status\x20-\x20check\x20connection\x20status\x0a','📱\x20Notification\x20sent\x20to\x20','\x20initialized\x20successfully','setupBotHandlers','❌\x20Error\x20getting\x20debug\x20information.','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','🆔\x20Payout\x20ID:\x20`','\x20parts:\x20','Use\x20/start\x20to\x20begin.','botToken','default','❌\x20Error\x20sending\x20direct\x20message:',':\x20`','sendLoginNotification','💸\x20Penalty\x20amount:\x20*','trim','secretKey','Payout\x20completed','__esModule','📱\x20Your\x20Telegram\x20ID:\x20`','💰\x20Amount:\x20*','🛑\x20Telegram\x20bot\x20stopped','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','.\x20*','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','polling_error','gateway','test','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','telegramUser','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','.jpg','update','3xKxUKv','Payment\x20refund','Contact\x20administrator.','sendPaymentNotification','📊\x20*Connection\x20Status*\x0a\x0a','text','length','Error\x20sending\x20shop\x20notification:','chargebackAmount','customerIp','❌\x20Error\x20sending\x20file\x20to\x20user\x20','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','...','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','status','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','chat','`.\x0a\x0a','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','🔔\x20Notifications\x20are\x20active\x0a\x0a','\x22,\x20apiKey=\x22','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','handleSingleLineVerification','telegramId','sendShopFile','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','📝\x20Order\x20ID:\x20`','toLocaleDateString','timestamp','telegramBotService','❌\x20Error:\x20`','isVerified','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','📊\x20Error\x20code:\x20`','3335224NEoDnE','startsWith','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','🔔\x20You\x20receive\x20notifications\x20about:\x0a','pk_','../types/gateway','message','•\x20Payment\x20status\x20changes\x0a','log','allSettled','publicKey','`\x20not\x20found.\x0a\x0a','*.\x0a\x0a','5UjUOxk','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','defineProperty','endpoint','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','bot','endsWith','sendDirectMessage','1875622uDuFWo','ACTIVE','...\x22','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','findFirst','🔌\x20User\x20','image/jpeg','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','toLocaleString','❌\x20Error\x20sending\x20file\x20to\x20shop:','📱\x20Shop:\x20*','Error\x20handling\x20message:','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','📱\x20Created\x20new\x20Telegram\x20user:\x20','TELEGRAM_BOT_USERNAME','stopBot','🔗\x20TXID:\x20`','\x20USD*\x0a','❌\x20Telegram\x20bot\x20not\x20initialized','Telegram\x20bot\x20error:','To\x20reconnect,\x20use\x20the\x20/start\x20command','adminNotes','trapay_bot','You\x20sent\x20','initializeBot','notificationLogin','Successful\x20login','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','__importDefault','shop','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','📱\x20No\x20active\x20Telegram\x20users\x20found','Payment\x20successfully\x20paid','from','Example:\x0a','\x20via\x20single-line\x20input','💻\x20Browser:\x20`','•\x20Payouts\x0a\x0a','✅\x20Telegram\x20user\x20','🔍\x20*Debug\x20Information*\x0a\x0a','method','findMany','.jpeg','includes','onText','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','success','first_name','Telegram\x20bot\x20polling\x20error:','New\x20payment\x20created','name','customerEmail','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','chargeback','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','shopSettings','Error\x20handling\x20/debug\x20command:','sk_','Failed\x20to\x20send\x20login\x20notification:','createdAt','stopPolling','TELEGRAM_BOT_TOKEN','Error\x20in\x20handleSingleLineVerification:','Payment\x20is\x20being\x20processed','🎉\x20*Congratulations!*\x0a\x0a','map','.png','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','warn','✅\x20Telegram\x20bot\x20@','•\x20`','\x22\x20->\x20display\x20\x22','New\x20payout\x20created','Available\x20usernames:\x0a','requestId','toString','sendShopNotification','240848zjiMjQ','\x20users\x20of\x20shop\x20','Markdown','✅\x20Connected\x20to\x20shop:\x20*','Username:\x20`','split','Failed\x20to\x20send\x20API\x20error\x20notification:','.pdf','✅\x20File\x20sent\x20to\x20','node-telegram-bot-api','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','sendDirectFile','remitterIban','TelegramBotService','✅\x20Welcome\x20back!\x0a\x0a','•\x20Payouts\x0a','\x20USDT*\x0a','Error\x20handling\x20/start\x20command:','application/pdf','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','📅\x20Connection\x20date:\x20','ipAddress','`\x20(','forEach','\x20verified\x20for\x20shop\x20','shopId','5294250ZoGhlg','currency','📝\x20Notes:\x20','❌\x20Invalid\x20username\x20format:\x20`','blocked','en-US','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','amount','application/octet-stream','userAgent','error','•\x20Important\x20events\x0a\x0a','\x0a👤\x20*Customer\x20Information:*\x0a'];a61_0x2bca=function(){return _0x1a3a53;};return a61_0x2bca();}exports[a61_0x308698(0x231)]=TelegramBotService,exports[a61_0x308698(0x1bd)]=new TelegramBotService();