'use strict';const a54_0x1e0331=a54_0x23e3;function a54_0x57fc(){const _0x1385e0=['chat\x20not\x20found','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','createdAt','remitterName','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','🎉\x20*Congratulations!*\x0a\x0a','sendPaymentNotification','unknown\x20shop','trim','customerIp','Example:\x0a','ACTIVE','\x20via\x20single-line\x20input','Use\x20/start\x20to\x20begin.','shopId','secretKey','•\x20Payouts\x0a\x0a','🛑\x20Telegram\x20bot\x20stopped','•\x20Payouts\x0a','shop','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','Markdown','`.\x0a\x0a','🌐\x20IP:\x20`','🚨\x20*API\x20Error*\x0a\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','telegramUser','You\x20sent\x20','defineProperty','notificationApiError','Error\x20handling\x20/status\x20command:','💸\x20Penalty\x20amount:\x20*','Payment\x20successfully\x20paid','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','requestId','12798520KQvTHF','38185103pmJwbv','Error\x20sending\x20shop\x20notification:','🔗\x20Endpoint:\x20`','ipAddress','Failed\x20login\x20attempt','🆔\x20Request\x20ID:\x20`','🏦\x20IBAN:\x20`','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','SUSPENDED','log','statusCode','Telegram\x20bot\x20polling\x20error:','/status\x20-\x20check\x20connection\x20status\x0a','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','remitterIban','message','\x20verified\x20for\x20shop\x20','startsWith','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','💻\x20Browser:\x20`','getGatewayDisplayNameForTelegram','`\x20is\x20suspended.\x0a\x0a','sendShopNotification','\x20disconnected\x20from\x20shop\x20','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','toString','📝\x20Notes:\x20','\x20initialized\x20successfully','\x0a👤\x20*Customer\x20Information:*\x0a','*\x0a\x0a','last_name','trapay_bot','../types/gateway','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','102490kdSlCg','TELEGRAM_BOT_TOKEN','🌐\x20IP\x20address:\x20`','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','customerName','name','❌\x20Error:\x20`','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','/disconnect\x20-\x20disconnect\x20from\x20notifications','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Error\x20handling\x20/disconnect\x20command:','\x20(@','errorMessage','💳\x20Card:\x20`****','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','bot','18ewbKcL','handleSingleLineVerification','148839IMaapy','orderId','chargebackAmount','botUsername','Payout\x20completed','create','👤\x20Sender:\x20`','🔍\x20*Debug\x20Information*\x0a\x0a','•\x20Payment\x20status\x20changes\x0a','includes','customerCountry','txid','getBotInfo','text','cardLast4','from','Payment\x20failed','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','bankId','🗺️\x20Country:\x20`','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','sk_','👤\x20Username:\x20`','findUnique','📱\x20Your\x20Telegram\x20ID:\x20`','`\x20is\x20inactive.\x0a\x0a','split','•\x20`','telegramBotService','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','🔌\x20User\x20','5753520bnCmkq','Successful\x20login','`\x20(IP:\x20`','`\x0a\x0a','\x20\x20\x20Public\x20Key:\x20`','\x20\x20\x20Username:\x20`','📛\x20Name:\x20`','Payment\x20chargeback','updatedAt','Available\x20usernames:\x0a','toLocaleString','✅\x20Welcome\x20back!\x0a\x0a','publicKey','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','botToken','❌\x20Invalid\x20username\x20format:\x20`','✅\x20Connected\x20to\x20shop:\x20*','chargeback','../config/database','❌\x20Please\x20use\x20/start\x20command\x20first','Telegram\x20bot\x20error:','sendApiErrorNotification','isVerified','onText','Contact\x20administrator\x20to\x20restore\x20full\x20access.','1770zXmkKi','processing','entries','Username:\x20`','error','To\x20reconnect,\x20use\x20the\x20/start\x20command','status','7fMmbqJ','chat','🏦\x20Bank\x20ID:\x20`','13972716hSjtCY','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','sendLoginNotification','🔔\x20*','initializeBot','Payment\x20is\x20being\x20processed','📊\x20Error\x20code:\x20`','warn','currency','🏦\x20Method:\x20`','success','telegramId','•\x20New\x20payments\x0a','endpoint','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','👤\x20Remitter:\x20`','Contact\x20administrator.','Payout\x20rejected','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','update','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','map','en-US','❌\x20Shop\x20`','📝\x20Order\x20ID:\x20`','You\x20are\x20already\x20connected\x20to\x20shop:\x20*',':\x20`','test','sendMessage','adminNotes','forEach','📱\x20Shop:\x20*','length','💸\x20Amount:\x20*','findMany','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','polling_error','__esModule','shopSettings','\x0a🪙\x20*CoinToPay\x20Details:*\x0a','substring','...\x22','customerEmail','Commands:\x0a','failed','🆔\x20Payout\x20ID:\x20`','Failed\x20to\x20send\x20API\x20error\x20notification:','amount','join','🏪\x20Available\x20shops\x20in\x20system:\x0a','*.\x0a\x0a','TelegramBotService','setupBotHandlers','🔗\x20TXID:\x20`','💰\x20Amount:\x20*','7145CSxpDE','sendPayoutNotification','✅\x20Telegram\x20bot\x20@','toLocaleDateString',':\x20username=\x22','128RgAXdO','🌍\x20From:\x20`','username','timestamp','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','userAgent','\x20\x20\x20Status:\x20','⚠️\x20Shop\x20`','🏪\x20Gateway:\x20`','\x0aCheck\x20spelling\x20and\x20try\x20again.','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','🆔\x20Payment\x20ID:\x20`','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','first_name','New\x20payout\x20created','Error\x20handling\x20/debug\x20command:','`\x20(','🔔\x20You\x20receive\x20notifications\x20about:\x0a','gateway','Error\x20handling\x20message:','env','user\x20is\x20deactivated','paymentMethod','📱\x20Telegram\x20notification:\x20gateway\x20\x22','`)\x0a','❌\x20Error\x20getting\x20debug\x20information.','\x20USDT*\x0a','default','node-telegram-bot-api','...`\x0a\x0a','🔔\x20Notifications\x20are\x20active\x0a\x0a','📊\x20*Connection\x20Status*\x0a\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','💰\x20Method:\x20`','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','\x20USD*\x0a','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'];a54_0x57fc=function(){return _0x1385e0;};return a54_0x57fc();}(function(_0x6c264a,_0x1cd344){const _0x3d6e10=a54_0x23e3,_0x2d69e5=_0x6c264a();while(!![]){try{const _0x1e0f1a=-parseInt(_0x3d6e10(0xd0))/0x1*(parseInt(_0x3d6e10(0xc0))/0x2)+parseInt(_0x3d6e10(0xd2))/0x3*(parseInt(_0x3d6e10(0x151))/0x4)+parseInt(_0x3d6e10(0x14c))/0x5*(parseInt(_0x3d6e10(0x10a))/0x6)+parseInt(_0x3d6e10(0x111))/0x7*(-parseInt(_0x3d6e10(0x9d))/0x8)+-parseInt(_0x3d6e10(0x114))/0x9+-parseInt(_0x3d6e10(0xf1))/0xa+parseInt(_0x3d6e10(0x9e))/0xb;if(_0x1e0f1a===_0x1cd344)break;else _0x2d69e5['push'](_0x2d69e5['shift']());}catch(_0x502173){_0x2d69e5['push'](_0x2d69e5['shift']());}}}(a54_0x57fc,0xcabeb));var __importDefault=this&&this['__importDefault']||function(_0x39ec11){const _0x1126f9=a54_0x23e3;return _0x39ec11&&_0x39ec11[_0x1126f9(0x13a)]?_0x39ec11:{'default':_0x39ec11};};Object[a54_0x1e0331(0x96)](exports,'__esModule',{'value':!![]}),exports[a54_0x1e0331(0xee)]=exports[a54_0x1e0331(0x148)]=void 0x0;function a54_0x23e3(_0x24415f,_0x3cf10c){const _0x57fcb3=a54_0x57fc();return a54_0x23e3=function(_0x23e3a4,_0x22e2a6){_0x23e3a4=_0x23e3a4-0x66;let _0xe3c4f7=_0x57fcb3[_0x23e3a4];return _0xe3c4f7;},a54_0x23e3(_0x24415f,_0x3cf10c);}const node_telegram_bot_api_1=__importDefault(require(a54_0x1e0331(0x6f))),database_1=__importDefault(require(a54_0x1e0331(0x103))),gateway_1=require(a54_0x1e0331(0xbe));class TelegramBotService{constructor(){const _0x316292=a54_0x1e0331;this[_0x316292(0xcf)]=null,this[_0x316292(0xff)]=process['env'][_0x316292(0xc1)]||'',this[_0x316292(0xd5)]=process[_0x316292(0x67)]['TELEGRAM_BOT_USERNAME']||_0x316292(0xbd),this[_0x316292(0xff)]?this[_0x316292(0x118)]():console[_0x316292(0x11b)](_0x316292(0x15d));}['initializeBot'](){const _0x5567e3=a54_0x1e0331;try{this[_0x5567e3(0xcf)]=new node_telegram_bot_api_1['default'](this[_0x5567e3(0xff)],{'polling':!![]}),this[_0x5567e3(0x149)](),console[_0x5567e3(0xa7)](_0x5567e3(0x14e)+this[_0x5567e3(0xd5)]+_0x5567e3(0xb9));}catch(_0x11161b){console[_0x5567e3(0x10e)](_0x5567e3(0xfe),_0x11161b);}}['setupBotHandlers'](){const _0xd259b4=a54_0x1e0331;if(!this['bot'])return;this[_0xd259b4(0xcf)][_0xd259b4(0x108)](/\/start/,async _0x55fd13=>{const _0xa9ff65=_0xd259b4,_0x2b883c=_0x55fd13['chat']['id'],_0xe9ac59=_0x55fd13[_0xa9ff65(0xe1)]?.['id'][_0xa9ff65(0xb7)](),_0x311d1f=_0x55fd13[_0xa9ff65(0xe1)]?.[_0xa9ff65(0x153)],_0x2cfb11=_0x55fd13[_0xa9ff65(0xe1)]?.[_0xa9ff65(0x15f)],_0x58b33a=_0x55fd13['from']?.[_0xa9ff65(0xbc)];if(!_0xe9ac59)return;try{let _0x331193=await database_1[_0xa9ff65(0x6e)][_0xa9ff65(0x94)][_0xa9ff65(0xe9)]({'where':{'telegramId':_0xe9ac59},'include':{'shop':!![]}});!_0x331193?(_0x331193=await database_1['default'][_0xa9ff65(0x94)][_0xa9ff65(0xd7)]({'data':{'telegramId':_0xe9ac59,'username':_0x311d1f,'firstName':_0x2cfb11,'lastName':_0x58b33a,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0xa9ff65(0xa7)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0xe9ac59+_0xa9ff65(0xcb)+_0x311d1f+')')):_0x331193=await database_1[_0xa9ff65(0x6e)][_0xa9ff65(0x94)][_0xa9ff65(0x128)]({'where':{'telegramId':_0xe9ac59},'data':{'username':_0x311d1f,'firstName':_0x2cfb11,'lastName':_0x58b33a},'include':{'shop':!![]}}),_0x331193[_0xa9ff65(0x107)]&&_0x331193[_0xa9ff65(0x88)]&&_0x331193['shop']?await this[_0xa9ff65(0xcf)]?.[_0xa9ff65(0x131)](_0x2b883c,_0xa9ff65(0xfc)+(_0xa9ff65(0x12e)+_0x331193[_0xa9ff65(0x8d)]['name']+'*\x0a')+(_0xa9ff65(0x10d)+_0x331193[_0xa9ff65(0x8d)][_0xa9ff65(0x153)]+_0xa9ff65(0xf4))+_0xa9ff65(0x163)+'•\x20New\x20payments\x0a'+_0xa9ff65(0xda)+_0xa9ff65(0x8a)+_0xa9ff65(0x140)+_0xa9ff65(0xaa)+_0xa9ff65(0xc8),{'parse_mode':_0xa9ff65(0x8f)}):(_0x331193[_0xa9ff65(0x88)]&&!_0x331193['isVerified']&&(await database_1['default'][_0xa9ff65(0x94)][_0xa9ff65(0x128)]({'where':{'telegramId':_0xe9ac59},'data':{'shopId':null,'isVerified':![]}}),console[_0xa9ff65(0xa7)](_0xa9ff65(0x77)+_0xe9ac59)),await this['bot']?.[_0xa9ff65(0x131)](_0x2b883c,_0xa9ff65(0x75)+_0xa9ff65(0xc9)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0xa9ff65(0x84)+_0xa9ff65(0x74)+_0xa9ff65(0xb6),{'parse_mode':'Markdown'}));}catch(_0x25265c){console[_0xa9ff65(0x10e)]('Error\x20handling\x20/start\x20command:',_0x25265c),await this[_0xa9ff65(0xcf)]?.[_0xa9ff65(0x131)](_0x2b883c,_0xa9ff65(0x15e));}}),this[_0xd259b4(0xcf)][_0xd259b4(0x108)](/\/disconnect/,async _0x56b226=>{const _0x354f69=_0xd259b4,_0xe964f2=_0x56b226[_0x354f69(0x112)]['id'],_0x42f5eb=_0x56b226[_0x354f69(0xe1)]?.['id']['toString']();if(!_0x42f5eb)return;try{const _0x1208db=await database_1['default'][_0x354f69(0x94)][_0x354f69(0xe9)]({'where':{'telegramId':_0x42f5eb},'include':{'shop':!![]}});if(!_0x1208db||!_0x1208db[_0x354f69(0x107)]||!_0x1208db[_0x354f69(0x88)]){await this['bot']?.[_0x354f69(0x131)](_0xe964f2,_0x354f69(0x155));return;}const _0x6d0e0a=_0x1208db[_0x354f69(0x8d)]?.[_0x354f69(0xc5)]||_0x354f69(0x81);await database_1['default'][_0x354f69(0x94)][_0x354f69(0x128)]({'where':{'telegramId':_0x42f5eb},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x354f69(0xf0)+_0x42f5eb+_0x354f69(0xb5)+_0x1208db[_0x354f69(0x88)]),await this[_0x354f69(0xcf)]?.[_0x354f69(0x131)](_0xe964f2,_0x354f69(0xb0)+_0x6d0e0a+'*.\x0a\x0a'+_0x354f69(0x10f),{'parse_mode':_0x354f69(0x8f)});}catch(_0x20a8d5){console[_0x354f69(0x10e)](_0x354f69(0xca),_0x20a8d5),await this['bot']?.[_0x354f69(0x131)](_0xe964f2,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0xd259b4(0xcf)][_0xd259b4(0x108)](/\/status/,async _0xcbb0a0=>{const _0x26db5a=_0xd259b4,_0x9060ac=_0xcbb0a0[_0x26db5a(0x112)]['id'],_0x25c769=_0xcbb0a0[_0x26db5a(0xe1)]?.['id']['toString']();if(!_0x25c769)return;try{const _0x28f3ce=await database_1[_0x26db5a(0x6e)][_0x26db5a(0x94)][_0x26db5a(0xe9)]({'where':{'telegramId':_0x25c769},'include':{'shop':!![]}});if(!_0x28f3ce){await this[_0x26db5a(0xcf)]?.['sendMessage'](_0x9060ac,_0x26db5a(0x73)+_0x26db5a(0x87));return;}if(!_0x28f3ce[_0x26db5a(0x107)]||!_0x28f3ce['shopId']||!_0x28f3ce[_0x26db5a(0x8d)]){await this[_0x26db5a(0xcf)]?.[_0x26db5a(0x131)](_0x9060ac,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+'Use\x20/start\x20to\x20connect.');return;}await this['bot']?.[_0x26db5a(0x131)](_0x9060ac,_0x26db5a(0x72)+(_0x26db5a(0x101)+_0x28f3ce['shop'][_0x26db5a(0xc5)]+'*\x0a')+(_0x26db5a(0xe8)+_0x28f3ce[_0x26db5a(0x8d)][_0x26db5a(0x153)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x28f3ce[_0x26db5a(0xf9)][_0x26db5a(0x14f)](_0x26db5a(0x12b))+'\x0a\x0a')+_0x26db5a(0x71)+_0x26db5a(0x140)+_0x26db5a(0xc8),{'parse_mode':'Markdown'});}catch(_0x3161ec){console['error'](_0x26db5a(0x98),_0x3161ec),await this[_0x26db5a(0xcf)]?.['sendMessage'](_0x9060ac,_0x26db5a(0x15e));}}),this[_0xd259b4(0xcf)]['onText'](/\/debug/,async _0x32115a=>{const _0x4bfef3=_0xd259b4,_0x1f5ef5=_0x32115a[_0x4bfef3(0x112)]['id'],_0x42ac79=_0x32115a[_0x4bfef3(0xe1)]?.['id'][_0x4bfef3(0xb7)]();if(!_0x42ac79)return;try{const _0x2963fc=await database_1[_0x4bfef3(0x6e)][_0x4bfef3(0x8d)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x2e8e13=_0x4bfef3(0xd9);_0x2e8e13+=_0x4bfef3(0xea)+_0x42ac79+_0x4bfef3(0xf4),_0x2e8e13+=_0x4bfef3(0x146),_0x2963fc['forEach']((_0x2a8d5a,_0x5ae9f6)=>{const _0x450ca8=_0x4bfef3;_0x2e8e13+=_0x5ae9f6+0x1+'.\x20*'+_0x2a8d5a[_0x450ca8(0xc5)]+'*\x0a',_0x2e8e13+=_0x450ca8(0xf6)+_0x2a8d5a[_0x450ca8(0x153)]+'`\x0a',_0x2e8e13+=_0x450ca8(0x157)+_0x2a8d5a[_0x450ca8(0x110)]+'\x0a',_0x2e8e13+=_0x450ca8(0xf5)+_0x2a8d5a[_0x450ca8(0xfd)][_0x450ca8(0x13d)](0x0,0xf)+_0x450ca8(0x70);}),await this[_0x4bfef3(0xcf)]?.[_0x4bfef3(0x131)](_0x1f5ef5,_0x2e8e13,{'parse_mode':_0x4bfef3(0x8f)});}catch(_0x97020d){console[_0x4bfef3(0x10e)](_0x4bfef3(0x161),_0x97020d),await this[_0x4bfef3(0xcf)]?.[_0x4bfef3(0x131)](_0x1f5ef5,_0x4bfef3(0x6c));}}),this[_0xd259b4(0xcf)]['on'](_0xd259b4(0xad),async _0x118c2b=>{const _0x18acca=_0xd259b4;if(_0x118c2b[_0x18acca(0xdf)]?.[_0x18acca(0xaf)]('/'))return;const _0x2cff39=_0x118c2b[_0x18acca(0x112)]['id'],_0x4d460c=_0x118c2b[_0x18acca(0xe1)]?.['id']['toString'](),_0x394163=_0x118c2b[_0x18acca(0xdf)]?.[_0x18acca(0x82)]();if(!_0x4d460c||!_0x394163)return;try{const _0x1b63c8=await database_1[_0x18acca(0x6e)][_0x18acca(0x94)]['findUnique']({'where':{'telegramId':_0x4d460c},'include':{'shop':!![]}});if(!_0x1b63c8){await this[_0x18acca(0xcf)]?.[_0x18acca(0x131)](_0x2cff39,_0x18acca(0x104));return;}if(_0x1b63c8[_0x18acca(0x107)]&&_0x1b63c8['shopId']&&_0x1b63c8[_0x18acca(0x8d)]){await this[_0x18acca(0xcf)]?.[_0x18acca(0x131)](_0x2cff39,_0x18acca(0xef)+_0x1b63c8[_0x18acca(0x8d)][_0x18acca(0xc5)]+_0x18acca(0x147)+_0x18acca(0x127),{'parse_mode':_0x18acca(0x8f)});return;}const _0x46db34=_0x394163[_0x18acca(0xec)](/\s+/);if(_0x46db34[_0x18acca(0x135)]!==0x2){await this[_0x18acca(0xcf)]?.[_0x18acca(0x131)](_0x2cff39,_0x18acca(0xce)+_0x18acca(0x122)+_0x18acca(0x84)+_0x18acca(0x74)+(_0x18acca(0x95)+_0x46db34[_0x18acca(0x135)]+'\x20parts:\x20'+_0x46db34[_0x18acca(0x12a)](_0xc4d216=>'`'+_0xc4d216+'`')[_0x18acca(0x145)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x1bec4d,_0x3467d6]=_0x46db34;console[_0x18acca(0xa7)](_0x18acca(0x79)+_0x4d460c+':\x20username=\x22'+_0x1bec4d+'\x22,\x20apiKey=\x22'+_0x3467d6[_0x18acca(0x13d)](0x0,0xa)+'...\x22'),await this[_0x18acca(0xd1)](_0x2cff39,_0x4d460c,_0x1bec4d,_0x3467d6);}catch(_0x19e182){console['error'](_0x18acca(0x66),_0x19e182),await this[_0x18acca(0xcf)]?.['sendMessage'](_0x2cff39,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0xd259b4(0xcf)]['on'](_0xd259b4(0x10e),_0x2b7e2c=>{const _0x45fb0a=_0xd259b4;console[_0x45fb0a(0x10e)](_0x45fb0a(0x105),_0x2b7e2c);}),this[_0xd259b4(0xcf)]['on'](_0xd259b4(0x139),_0x266452=>{const _0x362745=_0xd259b4;console[_0x362745(0x10e)](_0x362745(0xa9),_0x266452);});}async[a54_0x1e0331(0xd1)](_0xf57c2f,_0x17265d,_0x21c7ae,_0x546a77){const _0x1a57d2=a54_0x1e0331;try{console[_0x1a57d2(0xa7)](_0x1a57d2(0x79)+_0x17265d+_0x1a57d2(0x150)+_0x21c7ae+'\x22,\x20apiKey=\x22'+_0x546a77[_0x1a57d2(0x13d)](0x0,0xa)+_0x1a57d2(0x13e));if(!_0x21c7ae||_0x21c7ae[_0x1a57d2(0x135)]<0x3||_0x21c7ae['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x1a57d2(0x130)](_0x21c7ae)){await this[_0x1a57d2(0xcf)]?.[_0x1a57d2(0x131)](_0xf57c2f,_0x1a57d2(0x100)+_0x21c7ae+_0x1a57d2(0xf4)+_0x1a57d2(0xbf),{'parse_mode':'Markdown'});return;}if(!_0x546a77||!_0x546a77[_0x1a57d2(0xaf)]('pk_')&&!_0x546a77['startsWith'](_0x1a57d2(0xe7))){await this['bot']?.[_0x1a57d2(0x131)](_0xf57c2f,_0x1a57d2(0x9b)+_0x1a57d2(0x7e),{'parse_mode':_0x1a57d2(0x8f)});return;}const _0x23c347=await database_1[_0x1a57d2(0x6e)][_0x1a57d2(0x8d)][_0x1a57d2(0xe9)]({'where':{'username':_0x21c7ae},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x23c347){const _0x517045=await database_1[_0x1a57d2(0x6e)]['shop'][_0x1a57d2(0x137)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0xad1e0d='❌\x20Shop\x20with\x20username\x20`'+_0x21c7ae+'`\x20not\x20found.\x0a\x0a';_0x517045[_0x1a57d2(0x135)]>0x0?(_0xad1e0d+=_0x1a57d2(0xfa),_0x517045[_0x1a57d2(0x133)](_0x4fec7e=>{const _0x48107d=_0x1a57d2;_0xad1e0d+=_0x48107d(0xed)+_0x4fec7e[_0x48107d(0x153)]+_0x48107d(0x162)+_0x4fec7e[_0x48107d(0xc5)]+')\x0a';}),_0xad1e0d+=_0x1a57d2(0x15a)):_0xad1e0d+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x1a57d2(0xcf)]?.[_0x1a57d2(0x131)](_0xf57c2f,_0xad1e0d,{'parse_mode':_0x1a57d2(0x8f)});return;}if(_0x23c347['status']!==_0x1a57d2(0x85)){const _0x2f24f6=_0x23c347[_0x1a57d2(0x110)]===_0x1a57d2(0xa6)?_0x1a57d2(0x158)+_0x21c7ae+_0x1a57d2(0xb3)+'Your\x20account\x20is\x20temporarily\x20suspended.\x20You\x20can\x20view\x20your\x20dashboard\x20but\x20cannot\x20process\x20new\x20payments.\x0a\x0a'+_0x1a57d2(0x109):_0x1a57d2(0x12c)+_0x21c7ae+_0x1a57d2(0xeb)+_0x1a57d2(0x125);await this[_0x1a57d2(0xcf)]?.[_0x1a57d2(0x131)](_0xf57c2f,_0x2f24f6,{'parse_mode':_0x1a57d2(0x8f)});return;}if(_0x23c347['publicKey']!==_0x546a77&&_0x23c347[_0x1a57d2(0x89)]!==_0x546a77){await this[_0x1a57d2(0xcf)]?.[_0x1a57d2(0x131)](_0xf57c2f,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x21c7ae+'`.\x0a\x0a'+_0x1a57d2(0x115)+_0x1a57d2(0x15b),{'parse_mode':_0x1a57d2(0x8f)});return;}const _0x539025=await database_1[_0x1a57d2(0x6e)][_0x1a57d2(0x94)]['findFirst']({'where':{'shopId':_0x23c347['id'],'isVerified':!![],'telegramId':{'not':_0x17265d}}});if(_0x539025){await this[_0x1a57d2(0xcf)]?.['sendMessage'](_0xf57c2f,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x21c7ae+_0x1a57d2(0x90)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x1a57d2(0x8f)});return;}await database_1[_0x1a57d2(0x6e)]['telegramUser']['update']({'where':{'telegramId':_0x17265d},'data':{'shopId':_0x23c347['id'],'isVerified':!![]}}),await this[_0x1a57d2(0xcf)]?.[_0x1a57d2(0x131)](_0xf57c2f,_0x1a57d2(0x7f)+_0x1a57d2(0xab)+(_0x1a57d2(0x134)+_0x23c347[_0x1a57d2(0xc5)]+'*\x0a')+(_0x1a57d2(0xe8)+_0x23c347[_0x1a57d2(0x153)]+_0x1a57d2(0xf4))+_0x1a57d2(0x138)+_0x1a57d2(0x120)+'•\x20Payment\x20status\x20changes\x0a'+_0x1a57d2(0x8c)+'•\x20Important\x20events\x0a\x0a'+_0x1a57d2(0x140)+_0x1a57d2(0xaa)+_0x1a57d2(0xc8),{'parse_mode':_0x1a57d2(0x8f)}),console[_0x1a57d2(0xa7)]('✅\x20Telegram\x20user\x20'+_0x17265d+_0x1a57d2(0xae)+_0x23c347['username']+_0x1a57d2(0x86));}catch(_0x4a6d16){console['error']('Error\x20in\x20handleSingleLineVerification:',_0x4a6d16),await this[_0x1a57d2(0xcf)]?.[_0x1a57d2(0x131)](_0xf57c2f,_0x1a57d2(0x93));}}async[a54_0x1e0331(0xb4)](_0x105bee,_0x37a182,_0x2254da){const _0x30f9a2=a54_0x1e0331;if(!this[_0x30f9a2(0xcf)]){console[_0x30f9a2(0x11b)](_0x30f9a2(0xc7));return;}try{const _0x3e794b=await database_1['default'][_0x30f9a2(0x94)][_0x30f9a2(0x137)]({'where':{'shopId':_0x105bee,'isVerified':!![]}});if(_0x3e794b['length']===0x0){console[_0x30f9a2(0xa7)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x105bee);return;}const _0x21bb88=_0x3e794b[_0x30f9a2(0x12a)](async _0x54f374=>{const _0x2fa724=_0x30f9a2;try{await this[_0x2fa724(0xcf)]?.[_0x2fa724(0x131)](_0x54f374[_0x2fa724(0x11f)],_0x37a182,_0x2254da),console['log'](_0x2fa724(0xa5)+_0x54f374[_0x2fa724(0x11f)]);}catch(_0x283ffe){console[_0x2fa724(0x10e)](_0x2fa724(0x8e)+_0x54f374[_0x2fa724(0x11f)]+':',_0x283ffe),_0x283ffe instanceof Error&&(_0x283ffe[_0x2fa724(0xad)][_0x2fa724(0xdb)]('blocked')||_0x283ffe[_0x2fa724(0xad)][_0x2fa724(0xdb)](_0x2fa724(0x7a))||_0x283ffe['message'][_0x2fa724(0xdb)](_0x2fa724(0x68)))&&(await database_1[_0x2fa724(0x6e)][_0x2fa724(0x94)]['update']({'where':{'id':_0x54f374['id']},'data':{'isVerified':![]}}),console[_0x2fa724(0xa7)]('User\x20'+_0x54f374[_0x2fa724(0x11f)]+_0x2fa724(0x129)));}});await Promise['allSettled'](_0x21bb88);}catch(_0x438722){console[_0x30f9a2(0x10e)](_0x30f9a2(0x9f),_0x438722);}}async[a54_0x1e0331(0x80)](_0x4fbc66,_0x127175,_0x4545f5){const _0x3e6a0f=a54_0x1e0331,_0x5ae9c5={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x3e66d1={'created':'New\x20payment\x20created','paid':_0x3e6a0f(0x9a),'failed':_0x3e6a0f(0xe2),'expired':'Payment\x20expired','refund':'Payment\x20refund','chargeback':_0x3e6a0f(0xf8),'processing':_0x3e6a0f(0x119)},_0x5d71e1=_0x5ae9c5[_0x4545f5],_0x71d52e=_0x3e66d1[_0x4545f5],_0x1ea907=(0x0,gateway_1[_0x3e6a0f(0xb2)])(_0x127175[_0x3e6a0f(0x164)]);console[_0x3e6a0f(0xa7)](_0x3e6a0f(0x6a)+_0x127175[_0x3e6a0f(0x164)]+'\x22\x20->\x20display\x20\x22'+_0x1ea907+'\x22');let _0x4aab7e=_0x5d71e1+'\x20*'+_0x71d52e+_0x3e6a0f(0xbb)+(_0x3e6a0f(0x14b)+_0x127175[_0x3e6a0f(0x144)]+'\x20'+_0x127175[_0x3e6a0f(0x11c)]+'*\x0a')+(_0x3e6a0f(0x12d)+(_0x127175[_0x3e6a0f(0xd3)]||_0x127175['id'])+'`\x0a')+(_0x3e6a0f(0x15c)+_0x127175['id']+'`\x0a')+(_0x3e6a0f(0x159)+_0x1ea907+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x127175[_0x3e6a0f(0x7c)])[_0x3e6a0f(0xfb)](_0x3e6a0f(0x12b))+'\x0a');(_0x127175[_0x3e6a0f(0xc4)]||_0x127175[_0x3e6a0f(0x13f)]||_0x127175[_0x3e6a0f(0x83)]||_0x127175[_0x3e6a0f(0xdc)])&&(_0x4aab7e+=_0x3e6a0f(0xba),_0x127175['customerName']&&(_0x4aab7e+=_0x3e6a0f(0xf7)+_0x127175[_0x3e6a0f(0xc4)]+'`\x0a'),_0x127175[_0x3e6a0f(0x13f)]&&(_0x4aab7e+='📧\x20Email:\x20`'+_0x127175[_0x3e6a0f(0x13f)]+'`\x0a'),_0x127175['customerIp']&&(_0x4aab7e+=_0x3e6a0f(0x91)+_0x127175['customerIp']+'`\x0a'),_0x127175['customerCountry']&&(_0x4aab7e+='🗺️\x20Country:\x20`'+_0x127175[_0x3e6a0f(0xdc)]+'`\x0a'));if(_0x127175['gateway']==='cointopay'&&_0x127175['remitterIban']){_0x4aab7e+=_0x3e6a0f(0x13c),_0x4aab7e+='🏦\x20IBAN:\x20`'+_0x127175[_0x3e6a0f(0xac)]+'`\x0a';_0x127175[_0x3e6a0f(0x7d)]&&(_0x4aab7e+=_0x3e6a0f(0xd8)+_0x127175[_0x3e6a0f(0x7d)]+'`\x0a');if(_0x127175['customerIp']&&_0x127175[_0x3e6a0f(0xdc)])_0x4aab7e+=_0x3e6a0f(0x152)+_0x127175['customerCountry']+_0x3e6a0f(0xf3)+_0x127175[_0x3e6a0f(0x83)]+_0x3e6a0f(0x6b);else{if(_0x127175[_0x3e6a0f(0x83)])_0x4aab7e+='🌐\x20IP:\x20`'+_0x127175[_0x3e6a0f(0x83)]+'`\x0a';else _0x127175['customerCountry']&&(_0x4aab7e+=_0x3e6a0f(0xe5)+_0x127175[_0x3e6a0f(0xdc)]+'`\x0a');}}else(_0x127175[_0x3e6a0f(0x69)]||_0x127175['cardLast4']||_0x127175['bankId']||_0x127175['remitterIban'])&&(_0x4aab7e+='\x0a💳\x20*Payment\x20Details:*\x0a',_0x127175[_0x3e6a0f(0x69)]&&(_0x4aab7e+=_0x3e6a0f(0x76)+_0x127175[_0x3e6a0f(0x69)]+'`\x0a'),_0x127175[_0x3e6a0f(0xe0)]&&(_0x4aab7e+=_0x3e6a0f(0xcd)+_0x127175[_0x3e6a0f(0xe0)]+'`\x0a'),_0x127175['bankId']&&(_0x4aab7e+=_0x3e6a0f(0x113)+_0x127175[_0x3e6a0f(0xe4)]+'`\x0a'),_0x127175[_0x3e6a0f(0xac)]&&(_0x4aab7e+=_0x3e6a0f(0xa4)+_0x127175[_0x3e6a0f(0xac)]+'`\x0a'),_0x127175[_0x3e6a0f(0x7d)]&&(_0x4aab7e+=_0x3e6a0f(0x124)+_0x127175[_0x3e6a0f(0x7d)]+'`\x0a'));_0x4545f5===_0x3e6a0f(0x102)&&_0x127175[_0x3e6a0f(0xd4)]&&(_0x4aab7e+=_0x3e6a0f(0x99)+_0x127175[_0x3e6a0f(0xd4)]+_0x3e6a0f(0x6d)),_0x4545f5===_0x3e6a0f(0x10b)&&(_0x4aab7e+=_0x3e6a0f(0x7b)),_0x127175[_0x3e6a0f(0x132)]&&(_0x4aab7e+=_0x3e6a0f(0xb8)+_0x127175[_0x3e6a0f(0x132)]+'\x0a'),await this[_0x3e6a0f(0xb4)](_0x4fbc66,_0x4aab7e,{'parse_mode':_0x3e6a0f(0x8f)});}async[a54_0x1e0331(0x14d)](_0x2c31d8,_0x3f61d5,_0x26a6e4){const _0x45a4e8=a54_0x1e0331,_0x375274={'created':'📤','completed':'✅','rejected':'❌'},_0x45d785={'created':_0x45a4e8(0x160),'completed':_0x45a4e8(0xd6),'rejected':_0x45a4e8(0x126)},_0x1fddc3=_0x375274[_0x26a6e4],_0x529a52=_0x45d785[_0x26a6e4],_0xecc630=_0x1fddc3+'\x20*'+_0x529a52+'*\x0a\x0a'+(_0x45a4e8(0x136)+_0x3f61d5[_0x45a4e8(0x144)]+_0x45a4e8(0x78))+(_0x45a4e8(0x11d)+_0x3f61d5['method']+'`\x0a')+(_0x45a4e8(0x142)+_0x3f61d5['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x3f61d5[_0x45a4e8(0x7c)])['toLocaleString'](_0x45a4e8(0x12b))+'\x0a')+(_0x3f61d5['txid']?_0x45a4e8(0x14a)+_0x3f61d5[_0x45a4e8(0xdd)]+'`':'');await this[_0x45a4e8(0xb4)](_0x2c31d8,_0xecc630,{'parse_mode':'Markdown'});}async[a54_0x1e0331(0x116)](_0xab3655,_0x1dde65){const _0x32aa59=a54_0x1e0331;try{const _0x2d8abb=await database_1['default'][_0x32aa59(0x13b)][_0x32aa59(0xe9)]({'where':{'shopId':_0xab3655},'select':{'notificationLogin':!![]}});if(!_0x2d8abb?.['notificationLogin']){console[_0x32aa59(0xa7)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0xab3655);return;}const _0x7c62ef=_0x1dde65[_0x32aa59(0x11e)]?'🔐':'🚨',_0x5131b6=_0x1dde65[_0x32aa59(0x11e)]?_0x32aa59(0xf2):_0x32aa59(0xa2);let _0x4590c2=_0x7c62ef+'\x20*'+_0x5131b6+'*\x0a\x0a'+('👤\x20Username:\x20`'+_0x1dde65[_0x32aa59(0x153)]+'`\x0a')+('📅\x20Time:\x20'+_0x1dde65['timestamp'][_0x32aa59(0xfb)](_0x32aa59(0x12b))+'\x0a');_0x1dde65['ipAddress']&&(_0x4590c2+=_0x32aa59(0xc2)+_0x1dde65[_0x32aa59(0xa1)]+'`\x0a');if(_0x1dde65[_0x32aa59(0x156)]){const _0x10561d=_0x1dde65[_0x32aa59(0x156)][_0x32aa59(0x135)]>0x32?_0x1dde65[_0x32aa59(0x156)][_0x32aa59(0x13d)](0x0,0x32)+'...':_0x1dde65[_0x32aa59(0x156)];_0x4590c2+=_0x32aa59(0xb1)+_0x10561d+'`\x0a';}!_0x1dde65[_0x32aa59(0x11e)]&&(_0x4590c2+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x32aa59(0xb4)](_0xab3655,_0x4590c2,{'parse_mode':_0x32aa59(0x8f)}),console['log'](_0x32aa59(0xe3)+_0xab3655+':\x20'+(_0x1dde65['success']?_0x32aa59(0x11e):_0x32aa59(0x141)));}catch(_0x425cc0){console[_0x32aa59(0x10e)]('Failed\x20to\x20send\x20login\x20notification:',_0x425cc0);}}async[a54_0x1e0331(0x106)](_0x1e67b8,_0x459778){const _0x5784c7=a54_0x1e0331;try{const _0x182469=await database_1[_0x5784c7(0x6e)]['shopSettings'][_0x5784c7(0xe9)]({'where':{'shopId':_0x1e67b8},'select':{'notificationApiError':!![]}});if(!_0x182469?.[_0x5784c7(0x97)]){console[_0x5784c7(0xa7)](_0x5784c7(0x123)+_0x1e67b8);return;}let _0x28d164=_0x5784c7(0x92)+(_0x5784c7(0xa0)+_0x459778['method']+'\x20'+_0x459778[_0x5784c7(0x121)]+'`\x0a')+('📅\x20Time:\x20'+_0x459778[_0x5784c7(0x154)][_0x5784c7(0xfb)](_0x5784c7(0x12b))+'\x0a');_0x459778[_0x5784c7(0xa8)]&&(_0x28d164+=_0x5784c7(0x11a)+_0x459778[_0x5784c7(0xa8)]+'`\x0a'),_0x28d164+=_0x5784c7(0xc6)+_0x459778[_0x5784c7(0xcc)]+'`\x0a',_0x459778[_0x5784c7(0x9c)]&&(_0x28d164+=_0x5784c7(0xa3)+_0x459778['requestId']+'`\x0a'),_0x28d164+=_0x5784c7(0xe6),await this[_0x5784c7(0xb4)](_0x1e67b8,_0x28d164,{'parse_mode':_0x5784c7(0x8f)}),console[_0x5784c7(0xa7)](_0x5784c7(0xc3)+_0x1e67b8+':\x20'+_0x459778[_0x5784c7(0x121)]);}catch(_0x50ff30){console[_0x5784c7(0x10e)](_0x5784c7(0x143),_0x50ff30);}}async['sendCustomNotification'](_0x516371,_0x24f800,_0x228f0c){const _0x16f5bb=a54_0x1e0331;let _0x576815=_0x16f5bb(0x117)+_0x24f800+_0x16f5bb(0xbb);for(const [_0x439932,_0xc8b0f5]of Object[_0x16f5bb(0x10c)](_0x228f0c)){_0xc8b0f5!==null&&_0xc8b0f5!==undefined&&(_0x576815+=_0x439932+_0x16f5bb(0x12f)+_0xc8b0f5+'`\x0a');}await this[_0x16f5bb(0xb4)](_0x516371,_0x576815,{'parse_mode':_0x16f5bb(0x8f)});}[a54_0x1e0331(0xde)](){const _0x176a44=a54_0x1e0331;return{'isActive':!!this[_0x176a44(0xcf)],'username':this['botUsername']};}['stopBot'](){const _0x5e1f64=a54_0x1e0331;this[_0x5e1f64(0xcf)]&&(this[_0x5e1f64(0xcf)]['stopPolling'](),this[_0x5e1f64(0xcf)]=null,console['log'](_0x5e1f64(0x8b)));}}exports[a54_0x1e0331(0x148)]=TelegramBotService,exports[a54_0x1e0331(0xee)]=new TelegramBotService();