'use strict';const a54_0x15baaa=a54_0x277b;(function(_0x399916,_0x456d67){const _0x4dc756=a54_0x277b,_0x56d1ed=_0x399916();while(!![]){try{const _0x4ddd04=parseInt(_0x4dc756(0x200))/0x1+parseInt(_0x4dc756(0x223))/0x2*(parseInt(_0x4dc756(0x1d3))/0x3)+-parseInt(_0x4dc756(0x243))/0x4*(-parseInt(_0x4dc756(0x27e))/0x5)+parseInt(_0x4dc756(0x254))/0x6*(parseInt(_0x4dc756(0x29c))/0x7)+parseInt(_0x4dc756(0x25c))/0x8*(-parseInt(_0x4dc756(0x256))/0x9)+-parseInt(_0x4dc756(0x234))/0xa*(-parseInt(_0x4dc756(0x270))/0xb)+-parseInt(_0x4dc756(0x24b))/0xc;if(_0x4ddd04===_0x456d67)break;else _0x56d1ed['push'](_0x56d1ed['shift']());}catch(_0x579799){_0x56d1ed['push'](_0x56d1ed['shift']());}}}(a54_0x2346,0xbc7d0));function a54_0x2346(){const _0x38a724=['To\x20reconnect,\x20use\x20the\x20/start\x20command','•\x20Payouts\x0a','Commands:\x0a','651DuPwPP','Successful\x20login','telegramBotService','env','🎉\x20*Congratulations!*\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','last_name','timestamp','Payment\x20successfully\x20paid','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','failed',':\x20username=\x22','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','\x20\x20\x20Public\x20Key:\x20`','status','node-telegram-bot-api','secretKey','Telegram\x20bot\x20error:','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','📱\x20Telegram\x20notification:\x20gateway\x20\x22','🆔\x20Payment\x20ID:\x20`','remitterIban','/disconnect\x20-\x20disconnect\x20from\x20notifications','createdAt','📅\x20Date:\x20','👤\x20Username:\x20`','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','📊\x20Error\x20code:\x20`','unknown\x20shop','368655aejpsa','\x0aCheck\x20spelling\x20and\x20try\x20again.','shopId','sendMessage','📛\x20Name:\x20`','Check\x20spelling\x20and\x20try\x20again.','Available\x20usernames:\x0a','💰\x20Amount:\x20*','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','📊\x20*Connection\x20Status*\x0a\x0a','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','Error\x20handling\x20/start\x20command:','❌\x20Invalid\x20username\x20format:\x20`','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','📧\x20Email:\x20`','📱\x20Created\x20new\x20Telegram\x20user:\x20','📝\x20Order\x20ID:\x20`','✅\x20Welcome\x20back!\x0a\x0a','\x20initialized\x20successfully','botUsername','bot','\x20USD*\x0a','Error\x20handling\x20/debug\x20command:','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','customerIp','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','Example:\x0a','*.\x0a\x0a','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','Markdown','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','sendPayoutNotification','ipAddress','`\x0a\x0a','findMany','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','✅\x20Connected\x20to\x20shop:\x20*','🔔\x20Notifications\x20are\x20active\x0a\x0a','`\x20not\x20found.\x0a\x0a','method','from','isVerified','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','requestId','230894gYbxuU','❌\x20Shop\x20with\x20username\x20`','...','Use\x20/start\x20to\x20connect.','amount','includes','TELEGRAM_BOT_TOKEN','setupBotHandlers','notificationApiError','message','telegramUser','•\x20New\x20payments\x0a','map','create','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','sk_','Error\x20handling\x20message:','name','🔍\x20*Debug\x20Information*\x0a\x0a','initializeBot','...`\x0a\x0a','Error\x20in\x20handleSingleLineVerification:','trapay_bot','🏦\x20Method:\x20`','Payment\x20is\x20being\x20processed','Telegram\x20bot\x20polling\x20error:','customerName','Use\x20/start\x20to\x20begin.','entries','__esModule','\x20\x20\x20Status:\x20','🔌\x20User\x20','gateway','Payment\x20refund','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','14LzZFOp','telegramId','first_name','Payment\x20expired','📱\x20Your\x20Telegram\x20ID:\x20`','warn','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','sendLoginNotification','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','log','length','`\x20(','substring','statusCode','botToken','💸\x20Penalty\x20amount:\x20*','shop','10UYGiYU','📱\x20Shop:\x20*','handleSingleLineVerification','success','Error\x20handling\x20/disconnect\x20command:','update','🏪\x20Gateway:\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a','Payout\x20rejected','join','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','\x0a👤\x20*Customer\x20Information:*\x0a','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','endpoint','\x20\x20\x20Username:\x20`','13796aEPvTD','toString','.\x20*','blocked','•\x20Important\x20events\x0a\x0a','chargebackAmount','/status\x20-\x20check\x20connection\x20status\x0a','getGatewayDisplayNameForTelegram','11134008JlQXhw','TELEGRAM_BOT_USERNAME','New\x20payment\x20created','default','✅\x20Telegram\x20user\x20','findUnique','username','ACTIVE','\x20(@','71682QgxhRd','user\x20is\x20deactivated','156699flFpPe','text','\x20via\x20single-line\x20input','...\x22','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','`\x20is\x20inactive.\x0a\x0a','424Skwcxr','stopBot','📅\x20Connection\x20date:\x20','\x22,\x20apiKey=\x22','toLocaleDateString','sendApiErrorNotification','currency','\x20USDT*\x0a','customerEmail','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','You\x20sent\x20','Failed\x20to\x20send\x20login\x20notification:','💻\x20Browser:\x20`','New\x20payout\x20created','notificationLogin','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','Error\x20sending\x20shop\x20notification:','startsWith','Payment\x20failed','🛑\x20Telegram\x20bot\x20stopped','2994178AHNfRs','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','🆔\x20Request\x20ID:\x20`','❌\x20Error\x20getting\x20debug\x20information.','allSettled','\x22\x20->\x20display\x20\x22','publicKey','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','`.\x0a\x0a','sendShopNotification','🌐\x20IP:\x20`','onText','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','chat\x20not\x20found','215vqzFDC','userAgent','adminNotes','txid','toLocaleString','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','defineProperty','en-US','chat','✅\x20Telegram\x20bot\x20@','❌\x20Please\x20use\x20/start\x20command\x20first','test','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','__importDefault','error','💸\x20Amount:\x20*','customerUa','❌\x20Error:\x20`','Failed\x20login\x20attempt','\x20parts:\x20','🔗\x20TXID:\x20`','🚨\x20*API\x20Error*\x0a\x0a','*\x0a\x0a','trim','📅\x20Time:\x20','🔔\x20You\x20receive\x20notifications\x20about:\x0a','sendCustomNotification'];a54_0x2346=function(){return _0x38a724;};return a54_0x2346();}var __importDefault=this&&this[a54_0x15baaa(0x28b)]||function(_0x65b37b){return _0x65b37b&&_0x65b37b['__esModule']?_0x65b37b:{'default':_0x65b37b};};Object[a54_0x15baaa(0x284)](exports,a54_0x15baaa(0x21d),{'value':!![]}),exports[a54_0x15baaa(0x29e)]=exports['TelegramBotService']=void 0x0;function a54_0x277b(_0x3b4c75,_0x523c77){const _0x234683=a54_0x2346();return a54_0x277b=function(_0x277bc1,_0x4ec04d){_0x277bc1=_0x277bc1-0x1c2;let _0x10b236=_0x234683[_0x277bc1];return _0x10b236;},a54_0x277b(_0x3b4c75,_0x523c77);}const node_telegram_bot_api_1=__importDefault(require(a54_0x15baaa(0x1c5))),database_1=__importDefault(require('../config/database')),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x52cf47=a54_0x15baaa;this[_0x52cf47(0x1e7)]=null,this[_0x52cf47(0x231)]=process[_0x52cf47(0x29f)][_0x52cf47(0x206)]||'',this[_0x52cf47(0x1e6)]=process[_0x52cf47(0x29f)][_0x52cf47(0x24c)]||_0x52cf47(0x216),this['botToken']?this[_0x52cf47(0x213)]():console[_0x52cf47(0x228)](_0x52cf47(0x1fe));}['initializeBot'](){const _0x19df14=a54_0x15baaa;try{this[_0x19df14(0x1e7)]=new node_telegram_bot_api_1[(_0x19df14(0x24e))](this[_0x19df14(0x231)],{'polling':!![]}),this[_0x19df14(0x207)](),console['log'](_0x19df14(0x287)+this['botUsername']+_0x19df14(0x1e5));}catch(_0x1f7df3){console[_0x19df14(0x28c)](_0x19df14(0x1ec),_0x1f7df3);}}[a54_0x15baaa(0x207)](){const _0x5bd321=a54_0x15baaa;if(!this['bot'])return;this[_0x5bd321(0x1e7)][_0x5bd321(0x27b)](/\/start/,async _0x53b796=>{const _0x447404=_0x5bd321,_0x10fcde=_0x53b796[_0x447404(0x286)]['id'],_0x47f4c2=_0x53b796[_0x447404(0x1fb)]?.['id'][_0x447404(0x244)](),_0x551a7a=_0x53b796[_0x447404(0x1fb)]?.[_0x447404(0x251)],_0x237431=_0x53b796['from']?.[_0x447404(0x225)],_0x584fbb=_0x53b796['from']?.[_0x447404(0x2a2)];if(!_0x47f4c2)return;try{let _0x5e044f=await database_1[_0x447404(0x24e)][_0x447404(0x20a)][_0x447404(0x250)]({'where':{'telegramId':_0x47f4c2},'include':{'shop':!![]}});!_0x5e044f?(_0x5e044f=await database_1['default'][_0x447404(0x20a)][_0x447404(0x20d)]({'data':{'telegramId':_0x47f4c2,'username':_0x551a7a,'firstName':_0x237431,'lastName':_0x584fbb,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x447404(0x1e2)+_0x47f4c2+_0x447404(0x253)+_0x551a7a+')')):_0x5e044f=await database_1[_0x447404(0x24e)][_0x447404(0x20a)][_0x447404(0x239)]({'where':{'telegramId':_0x47f4c2},'data':{'username':_0x551a7a,'firstName':_0x237431,'lastName':_0x584fbb},'include':{'shop':!![]}}),_0x5e044f[_0x447404(0x1fc)]&&_0x5e044f['shopId']&&_0x5e044f[_0x447404(0x233)]?await this['bot']?.[_0x447404(0x1d6)](_0x10fcde,_0x447404(0x1e4)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x5e044f[_0x447404(0x233)][_0x447404(0x211)]+'*\x0a')+('Username:\x20`'+_0x5e044f[_0x447404(0x233)][_0x447404(0x251)]+_0x447404(0x1f4))+_0x447404(0x297)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+'•\x20Payouts\x0a\x0a'+_0x447404(0x29b)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x447404(0x1cc),{'parse_mode':_0x447404(0x1f0)}):(_0x5e044f[_0x447404(0x1d5)]&&!_0x5e044f[_0x447404(0x1fc)]&&(await database_1[_0x447404(0x24e)][_0x447404(0x20a)][_0x447404(0x239)]({'where':{'telegramId':_0x47f4c2},'data':{'shopId':null,'isVerified':![]}}),console[_0x447404(0x22c)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x47f4c2)),await this['bot']?.[_0x447404(0x1d6)](_0x10fcde,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x447404(0x1e0)+_0x447404(0x25a)+_0x447404(0x1ed)+_0x447404(0x26b)+_0x447404(0x27c),{'parse_mode':_0x447404(0x1f0)}));}catch(_0x1d2813){console[_0x447404(0x28c)](_0x447404(0x1de),_0x1d2813),await this['bot']?.[_0x447404(0x1d6)](_0x10fcde,_0x447404(0x265));}}),this[_0x5bd321(0x1e7)]['onText'](/\/disconnect/,async _0xd20b97=>{const _0x63c89d=_0x5bd321,_0x101dc1=_0xd20b97[_0x63c89d(0x286)]['id'],_0x605e74=_0xd20b97[_0x63c89d(0x1fb)]?.['id'][_0x63c89d(0x244)]();if(!_0x605e74)return;try{const _0x223eaf=await database_1[_0x63c89d(0x24e)]['telegramUser'][_0x63c89d(0x250)]({'where':{'telegramId':_0x605e74},'include':{'shop':!![]}});if(!_0x223eaf||!_0x223eaf[_0x63c89d(0x1fc)]||!_0x223eaf['shopId']){await this['bot']?.[_0x63c89d(0x1d6)](_0x101dc1,_0x63c89d(0x1f6));return;}const _0xa07ecc=_0x223eaf[_0x63c89d(0x233)]?.[_0x63c89d(0x211)]||_0x63c89d(0x1d2);await database_1['default']['telegramUser']['update']({'where':{'telegramId':_0x605e74},'data':{'shopId':null,'isVerified':![]}}),console[_0x63c89d(0x22c)](_0x63c89d(0x21f)+_0x605e74+'\x20disconnected\x20from\x20shop\x20'+_0x223eaf[_0x63c89d(0x1d5)]),await this['bot']?.['sendMessage'](_0x101dc1,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0xa07ecc+_0x63c89d(0x1ee)+_0x63c89d(0x299),{'parse_mode':'Markdown'});}catch(_0x43315d){console['error'](_0x63c89d(0x238),_0x43315d),await this['bot']?.[_0x63c89d(0x1d6)](_0x101dc1,_0x63c89d(0x265));}}),this['bot'][_0x5bd321(0x27b)](/\/status/,async _0x43a6ac=>{const _0x4dd473=_0x5bd321,_0x462d17=_0x43a6ac[_0x4dd473(0x286)]['id'],_0x79d6d6=_0x43a6ac[_0x4dd473(0x1fb)]?.['id'][_0x4dd473(0x244)]();if(!_0x79d6d6)return;try{const _0x1f9de1=await database_1[_0x4dd473(0x24e)][_0x4dd473(0x20a)][_0x4dd473(0x250)]({'where':{'telegramId':_0x79d6d6},'include':{'shop':!![]}});if(!_0x1f9de1){await this[_0x4dd473(0x1e7)]?.['sendMessage'](_0x462d17,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x4dd473(0x21b));return;}if(!_0x1f9de1[_0x4dd473(0x1fc)]||!_0x1f9de1[_0x4dd473(0x1d5)]||!_0x1f9de1[_0x4dd473(0x233)]){await this[_0x4dd473(0x1e7)]?.[_0x4dd473(0x1d6)](_0x462d17,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x4dd473(0x203));return;}await this[_0x4dd473(0x1e7)]?.['sendMessage'](_0x462d17,_0x4dd473(0x1dc)+(_0x4dd473(0x1f7)+_0x1f9de1[_0x4dd473(0x233)][_0x4dd473(0x211)]+'*\x0a')+(_0x4dd473(0x1cf)+_0x1f9de1[_0x4dd473(0x233)][_0x4dd473(0x251)]+'`\x0a')+(_0x4dd473(0x25e)+_0x1f9de1['updatedAt'][_0x4dd473(0x260)](_0x4dd473(0x285))+'\x0a\x0a')+_0x4dd473(0x1f8)+'Commands:\x0a'+_0x4dd473(0x1cc),{'parse_mode':_0x4dd473(0x1f0)});}catch(_0x15ae76){console[_0x4dd473(0x28c)]('Error\x20handling\x20/status\x20command:',_0x15ae76),await this[_0x4dd473(0x1e7)]?.['sendMessage'](_0x462d17,_0x4dd473(0x265));}}),this[_0x5bd321(0x1e7)][_0x5bd321(0x27b)](/\/debug/,async _0x425624=>{const _0xd712b6=_0x5bd321,_0x2eb880=_0x425624[_0xd712b6(0x286)]['id'],_0x2b5407=_0x425624['from']?.['id'][_0xd712b6(0x244)]();if(!_0x2b5407)return;try{const _0x2a1036=await database_1[_0xd712b6(0x24e)][_0xd712b6(0x233)][_0xd712b6(0x1f5)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4fbbee=_0xd712b6(0x212);_0x4fbbee+=_0xd712b6(0x227)+_0x2b5407+'`\x0a\x0a',_0x4fbbee+=_0xd712b6(0x23b),_0x2a1036['forEach']((_0x4d9bf5,_0x1c1db7)=>{const _0x24bd65=_0xd712b6;_0x4fbbee+=_0x1c1db7+0x1+_0x24bd65(0x245)+_0x4d9bf5['name']+'*\x0a',_0x4fbbee+=_0x24bd65(0x242)+_0x4d9bf5[_0x24bd65(0x251)]+'`\x0a',_0x4fbbee+=_0x24bd65(0x21e)+_0x4d9bf5['status']+'\x0a',_0x4fbbee+=_0x24bd65(0x1c3)+_0x4d9bf5['publicKey']['substring'](0x0,0xf)+_0x24bd65(0x214);}),await this['bot']?.[_0xd712b6(0x1d6)](_0x2eb880,_0x4fbbee,{'parse_mode':_0xd712b6(0x1f0)});}catch(_0xda06f3){console['error'](_0xd712b6(0x1e9),_0xda06f3),await this[_0xd712b6(0x1e7)]?.[_0xd712b6(0x1d6)](_0x2eb880,_0xd712b6(0x273));}}),this[_0x5bd321(0x1e7)]['on'](_0x5bd321(0x209),async _0x330e3d=>{const _0x4cbcf8=_0x5bd321;if(_0x330e3d[_0x4cbcf8(0x257)]?.['startsWith']('/'))return;const _0xa01e2f=_0x330e3d[_0x4cbcf8(0x286)]['id'],_0x32c011=_0x330e3d['from']?.['id'][_0x4cbcf8(0x244)](),_0x5709aa=_0x330e3d['text']?.[_0x4cbcf8(0x295)]();if(!_0x32c011||!_0x5709aa)return;try{const _0x18e240=await database_1['default'][_0x4cbcf8(0x20a)][_0x4cbcf8(0x250)]({'where':{'telegramId':_0x32c011},'include':{'shop':!![]}});if(!_0x18e240){await this[_0x4cbcf8(0x1e7)]?.['sendMessage'](_0xa01e2f,_0x4cbcf8(0x288));return;}if(_0x18e240[_0x4cbcf8(0x1fc)]&&_0x18e240[_0x4cbcf8(0x1d5)]&&_0x18e240[_0x4cbcf8(0x233)]){await this[_0x4cbcf8(0x1e7)]?.[_0x4cbcf8(0x1d6)](_0xa01e2f,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x18e240[_0x4cbcf8(0x233)][_0x4cbcf8(0x211)]+'*.\x0a\x0a'+_0x4cbcf8(0x2a5),{'parse_mode':_0x4cbcf8(0x1f0)});return;}const _0x175a4f=_0x5709aa['split'](/\s+/);if(_0x175a4f[_0x4cbcf8(0x22d)]!==0x2){await this['bot']?.[_0x4cbcf8(0x1d6)](_0xa01e2f,_0x4cbcf8(0x240)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x4cbcf8(0x1ed)+_0x4cbcf8(0x26b)+(_0x4cbcf8(0x266)+_0x175a4f[_0x4cbcf8(0x22d)]+_0x4cbcf8(0x291)+_0x175a4f['map'](_0x155850=>'`'+_0x155850+'`')[_0x4cbcf8(0x23d)](',\x20')),{'parse_mode':_0x4cbcf8(0x1f0)});return;}const [_0x10133f,_0x3487ef]=_0x175a4f;console[_0x4cbcf8(0x22c)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x32c011+_0x4cbcf8(0x2a7)+_0x10133f+_0x4cbcf8(0x25f)+_0x3487ef['substring'](0x0,0xa)+_0x4cbcf8(0x259)),await this[_0x4cbcf8(0x236)](_0xa01e2f,_0x32c011,_0x10133f,_0x3487ef);}catch(_0x435f71){console[_0x4cbcf8(0x28c)](_0x4cbcf8(0x210),_0x435f71),await this[_0x4cbcf8(0x1e7)]?.[_0x4cbcf8(0x1d6)](_0xa01e2f,_0x4cbcf8(0x265));}}),this[_0x5bd321(0x1e7)]['on']('error',_0x4047d4=>{const _0x35b1c3=_0x5bd321;console['error'](_0x35b1c3(0x1c7),_0x4047d4);}),this[_0x5bd321(0x1e7)]['on']('polling_error',_0x4b4366=>{const _0x5a5d7e=_0x5bd321;console[_0x5a5d7e(0x28c)](_0x5a5d7e(0x219),_0x4b4366);});}async[a54_0x15baaa(0x236)](_0x3badc3,_0x16f249,_0x23dec1,_0x19ae5c){const _0x34bdc6=a54_0x15baaa;try{console[_0x34bdc6(0x22c)](_0x34bdc6(0x283)+_0x16f249+':\x20username=\x22'+_0x23dec1+_0x34bdc6(0x25f)+_0x19ae5c[_0x34bdc6(0x22f)](0x0,0xa)+'...\x22');if(!_0x23dec1||_0x23dec1[_0x34bdc6(0x22d)]<0x3||_0x23dec1[_0x34bdc6(0x22d)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x34bdc6(0x289)](_0x23dec1)){await this[_0x34bdc6(0x1e7)]?.[_0x34bdc6(0x1d6)](_0x3badc3,_0x34bdc6(0x1df)+_0x23dec1+'`\x0a\x0a'+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x34bdc6(0x1f0)});return;}if(!_0x19ae5c||!_0x19ae5c['startsWith']('pk_')&&!_0x19ae5c[_0x34bdc6(0x26d)](_0x34bdc6(0x20f))){await this[_0x34bdc6(0x1e7)]?.['sendMessage'](_0x3badc3,_0x34bdc6(0x1ea)+_0x34bdc6(0x1c2),{'parse_mode':_0x34bdc6(0x1f0)});return;}const _0xba4bd1=await database_1[_0x34bdc6(0x24e)][_0x34bdc6(0x233)][_0x34bdc6(0x250)]({'where':{'username':_0x23dec1},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0xba4bd1){const _0x5e6d9b=await database_1[_0x34bdc6(0x24e)][_0x34bdc6(0x233)][_0x34bdc6(0x1f5)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x4b34b1=_0x34bdc6(0x201)+_0x23dec1+_0x34bdc6(0x1f9);_0x5e6d9b[_0x34bdc6(0x22d)]>0x0?(_0x4b34b1+=_0x34bdc6(0x1d9),_0x5e6d9b['forEach'](_0x450007=>{const _0x57b455=_0x34bdc6;_0x4b34b1+='•\x20`'+_0x450007[_0x57b455(0x251)]+_0x57b455(0x22e)+_0x450007[_0x57b455(0x211)]+')\x0a';}),_0x4b34b1+=_0x34bdc6(0x1d4)):_0x4b34b1+=_0x34bdc6(0x1d8);await this[_0x34bdc6(0x1e7)]?.[_0x34bdc6(0x1d6)](_0x3badc3,_0x4b34b1,{'parse_mode':_0x34bdc6(0x1f0)});return;}if(_0xba4bd1[_0x34bdc6(0x1c4)]!==_0x34bdc6(0x252)){await this[_0x34bdc6(0x1e7)]?.[_0x34bdc6(0x1d6)](_0x3badc3,'❌\x20Shop\x20`'+_0x23dec1+_0x34bdc6(0x25b)+'Contact\x20administrator.',{'parse_mode':_0x34bdc6(0x1f0)});return;}if(_0xba4bd1[_0x34bdc6(0x276)]!==_0x19ae5c&&_0xba4bd1[_0x34bdc6(0x1c6)]!==_0x19ae5c){await this[_0x34bdc6(0x1e7)]?.[_0x34bdc6(0x1d6)](_0x3badc3,_0x34bdc6(0x1fd)+_0x23dec1+'`.\x0a\x0a'+_0x34bdc6(0x23e)+_0x34bdc6(0x1dd),{'parse_mode':'Markdown'});return;}const _0x15b4b0=await database_1[_0x34bdc6(0x24e)][_0x34bdc6(0x20a)]['findFirst']({'where':{'shopId':_0xba4bd1['id'],'isVerified':!![],'telegramId':{'not':_0x16f249}}});if(_0x15b4b0){await this[_0x34bdc6(0x1e7)]?.[_0x34bdc6(0x1d6)](_0x3badc3,_0x34bdc6(0x28a)+_0x23dec1+_0x34bdc6(0x278)+_0x34bdc6(0x22b),{'parse_mode':_0x34bdc6(0x1f0)});return;}await database_1[_0x34bdc6(0x24e)][_0x34bdc6(0x20a)]['update']({'where':{'telegramId':_0x16f249},'data':{'shopId':_0xba4bd1['id'],'isVerified':!![]}}),await this[_0x34bdc6(0x1e7)]?.[_0x34bdc6(0x1d6)](_0x3badc3,_0x34bdc6(0x2a0)+_0x34bdc6(0x2a1)+(_0x34bdc6(0x235)+_0xba4bd1[_0x34bdc6(0x211)]+'*\x0a')+(_0x34bdc6(0x1cf)+_0xba4bd1[_0x34bdc6(0x251)]+_0x34bdc6(0x1f4))+_0x34bdc6(0x222)+_0x34bdc6(0x20b)+'•\x20Payment\x20status\x20changes\x0a'+_0x34bdc6(0x29a)+_0x34bdc6(0x247)+'Commands:\x0a'+_0x34bdc6(0x249)+_0x34bdc6(0x1cc),{'parse_mode':_0x34bdc6(0x1f0)}),console[_0x34bdc6(0x22c)](_0x34bdc6(0x24f)+_0x16f249+'\x20verified\x20for\x20shop\x20'+_0xba4bd1[_0x34bdc6(0x251)]+_0x34bdc6(0x258));}catch(_0x28e618){console['error'](_0x34bdc6(0x215),_0x28e618),await this[_0x34bdc6(0x1e7)]?.[_0x34bdc6(0x1d6)](_0x3badc3,_0x34bdc6(0x20e));}}async['sendShopNotification'](_0x14103a,_0x19e7f0,_0x45ee35){const _0x26819e=a54_0x15baaa;if(!this[_0x26819e(0x1e7)]){console[_0x26819e(0x228)](_0x26819e(0x277));return;}try{const _0x23b843=await database_1[_0x26819e(0x24e)][_0x26819e(0x20a)]['findMany']({'where':{'shopId':_0x14103a,'isVerified':!![]}});if(_0x23b843[_0x26819e(0x22d)]===0x0){console[_0x26819e(0x22c)](_0x26819e(0x1c8)+_0x14103a);return;}const _0x10521e=_0x23b843[_0x26819e(0x20c)](async _0x1c0998=>{const _0x5670b6=_0x26819e;try{await this[_0x5670b6(0x1e7)]?.[_0x5670b6(0x1d6)](_0x1c0998[_0x5670b6(0x224)],_0x19e7f0,_0x45ee35),console['log'](_0x5670b6(0x229)+_0x1c0998['telegramId']);}catch(_0x3e21dc){console[_0x5670b6(0x28c)](_0x5670b6(0x1db)+_0x1c0998[_0x5670b6(0x224)]+':',_0x3e21dc),_0x3e21dc instanceof Error&&(_0x3e21dc[_0x5670b6(0x209)][_0x5670b6(0x205)](_0x5670b6(0x246))||_0x3e21dc[_0x5670b6(0x209)]['includes'](_0x5670b6(0x27d))||_0x3e21dc['message'][_0x5670b6(0x205)](_0x5670b6(0x255)))&&(await database_1['default'][_0x5670b6(0x20a)][_0x5670b6(0x239)]({'where':{'id':_0x1c0998['id']},'data':{'isVerified':![]}}),console[_0x5670b6(0x22c)]('User\x20'+_0x1c0998[_0x5670b6(0x224)]+_0x5670b6(0x271)));}});await Promise[_0x26819e(0x274)](_0x10521e);}catch(_0x4c1f61){console[_0x26819e(0x28c)](_0x26819e(0x26c),_0x4c1f61);}}async['sendPaymentNotification'](_0xb1e78d,_0x124ddf,_0x7997c6){const _0x4a16c2=a54_0x15baaa,_0x238e4e={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x522269={'created':_0x4a16c2(0x24d),'paid':_0x4a16c2(0x2a4),'failed':_0x4a16c2(0x26e),'expired':_0x4a16c2(0x226),'refund':_0x4a16c2(0x221),'chargeback':'Payment\x20chargeback','processing':_0x4a16c2(0x218)},_0x447666=_0x238e4e[_0x7997c6],_0x31c959=_0x522269[_0x7997c6],_0x4c40da=(0x0,gateway_1[_0x4a16c2(0x24a)])(_0x124ddf[_0x4a16c2(0x220)]);console[_0x4a16c2(0x22c)](_0x4a16c2(0x1c9)+_0x124ddf[_0x4a16c2(0x220)]+_0x4a16c2(0x275)+_0x4c40da+'\x22');let _0x18059e=_0x447666+'\x20*'+_0x31c959+_0x4a16c2(0x294)+(_0x4a16c2(0x1da)+_0x124ddf['amount']+'\x20'+_0x124ddf[_0x4a16c2(0x262)]+'*\x0a')+(_0x4a16c2(0x1e3)+(_0x124ddf['orderId']||_0x124ddf['id'])+'`\x0a')+(_0x4a16c2(0x1ca)+_0x124ddf['id']+'`\x0a')+(_0x4a16c2(0x23a)+_0x4c40da+'`\x0a')+(_0x4a16c2(0x1ce)+new Date(_0x124ddf[_0x4a16c2(0x1cd)])[_0x4a16c2(0x282)](_0x4a16c2(0x285))+'\x0a');if(_0x124ddf[_0x4a16c2(0x21a)]||_0x124ddf['customerEmail']||_0x124ddf[_0x4a16c2(0x1cb)]||_0x124ddf[_0x4a16c2(0x1eb)]||_0x124ddf[_0x4a16c2(0x28e)]){_0x18059e+=_0x4a16c2(0x23f);_0x124ddf[_0x4a16c2(0x21a)]&&(_0x18059e+=_0x4a16c2(0x1d7)+_0x124ddf['customerName']+'`\x0a');_0x124ddf[_0x4a16c2(0x264)]&&(_0x18059e+=_0x4a16c2(0x1e1)+_0x124ddf[_0x4a16c2(0x264)]+'`\x0a');_0x124ddf['remitterIban']&&(_0x18059e+='🏦\x20IBAN:\x20`'+_0x124ddf[_0x4a16c2(0x1cb)]+'`\x0a');_0x124ddf['customerIp']&&(_0x18059e+=_0x4a16c2(0x27a)+_0x124ddf['customerIp']+'`\x0a');if(_0x124ddf[_0x4a16c2(0x28e)]){const _0x54e256=_0x124ddf[_0x4a16c2(0x28e)][_0x4a16c2(0x22d)]>0x32?_0x124ddf[_0x4a16c2(0x28e)][_0x4a16c2(0x22f)](0x0,0x32)+_0x4a16c2(0x202):_0x124ddf[_0x4a16c2(0x28e)];_0x18059e+='💻\x20Browser:\x20`'+_0x54e256+'`\x0a';}}_0x7997c6==='chargeback'&&_0x124ddf[_0x4a16c2(0x248)]&&(_0x18059e+=_0x4a16c2(0x232)+_0x124ddf['chargebackAmount']+_0x4a16c2(0x263)),_0x7997c6==='processing'&&(_0x18059e+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x124ddf[_0x4a16c2(0x280)]&&(_0x18059e+='📝\x20Notes:\x20'+_0x124ddf['adminNotes']+'\x0a'),await this[_0x4a16c2(0x279)](_0xb1e78d,_0x18059e,{'parse_mode':_0x4a16c2(0x1f0)});}async[a54_0x15baaa(0x1f2)](_0x51890c,_0x32e4d8,_0x56f37b){const _0x2036ce=a54_0x15baaa,_0x5929c3={'created':'📤','completed':'✅','rejected':'❌'},_0x3398b5={'created':_0x2036ce(0x269),'completed':'Payout\x20completed','rejected':_0x2036ce(0x23c)},_0x15d000=_0x5929c3[_0x56f37b],_0x5a0426=_0x3398b5[_0x56f37b],_0x59284c=_0x15d000+'\x20*'+_0x5a0426+_0x2036ce(0x294)+(_0x2036ce(0x28d)+_0x32e4d8[_0x2036ce(0x204)]+_0x2036ce(0x1e8))+(_0x2036ce(0x217)+_0x32e4d8[_0x2036ce(0x1fa)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x32e4d8['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x32e4d8[_0x2036ce(0x1cd)])[_0x2036ce(0x282)](_0x2036ce(0x285))+'\x0a')+(_0x32e4d8['txid']?_0x2036ce(0x292)+_0x32e4d8[_0x2036ce(0x281)]+'`':'');await this[_0x2036ce(0x279)](_0x51890c,_0x59284c,{'parse_mode':_0x2036ce(0x1f0)});}async[a54_0x15baaa(0x22a)](_0x24810f,_0xfe1575){const _0x1950fc=a54_0x15baaa;try{const _0x16e028=await database_1['default']['shopSettings'][_0x1950fc(0x250)]({'where':{'shopId':_0x24810f},'select':{'notificationLogin':!![]}});if(!_0x16e028?.[_0x1950fc(0x26a)]){console[_0x1950fc(0x22c)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x24810f);return;}const _0x202571=_0xfe1575[_0x1950fc(0x237)]?'🔐':'🚨',_0x54a249=_0xfe1575[_0x1950fc(0x237)]?_0x1950fc(0x29d):_0x1950fc(0x290);let _0x46960a=_0x202571+'\x20*'+_0x54a249+'*\x0a\x0a'+(_0x1950fc(0x1cf)+_0xfe1575[_0x1950fc(0x251)]+'`\x0a')+(_0x1950fc(0x296)+_0xfe1575[_0x1950fc(0x2a3)]['toLocaleString']('en-US')+'\x0a');_0xfe1575[_0x1950fc(0x1f3)]&&(_0x46960a+='🌐\x20IP\x20address:\x20`'+_0xfe1575[_0x1950fc(0x1f3)]+'`\x0a');if(_0xfe1575['userAgent']){const _0x2a9f6b=_0xfe1575['userAgent'][_0x1950fc(0x22d)]>0x32?_0xfe1575[_0x1950fc(0x27f)][_0x1950fc(0x22f)](0x0,0x32)+_0x1950fc(0x202):_0xfe1575['userAgent'];_0x46960a+=_0x1950fc(0x268)+_0x2a9f6b+'`\x0a';}!_0xfe1575[_0x1950fc(0x237)]&&(_0x46960a+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x1950fc(0x279)](_0x24810f,_0x46960a,{'parse_mode':_0x1950fc(0x1f0)}),console[_0x1950fc(0x22c)](_0x1950fc(0x1ef)+_0x24810f+':\x20'+(_0xfe1575[_0x1950fc(0x237)]?_0x1950fc(0x237):_0x1950fc(0x2a6)));}catch(_0x758d27){console[_0x1950fc(0x28c)](_0x1950fc(0x267),_0x758d27);}}async[a54_0x15baaa(0x261)](_0x90a505,_0x4d7c3f){const _0x5075fd=a54_0x15baaa;try{const _0x3f1eef=await database_1['default']['shopSettings'][_0x5075fd(0x250)]({'where':{'shopId':_0x90a505},'select':{'notificationApiError':!![]}});if(!_0x3f1eef?.[_0x5075fd(0x208)]){console[_0x5075fd(0x22c)](_0x5075fd(0x1d0)+_0x90a505);return;}let _0x191aec=_0x5075fd(0x293)+('🔗\x20Endpoint:\x20`'+_0x4d7c3f['method']+'\x20'+_0x4d7c3f[_0x5075fd(0x241)]+'`\x0a')+(_0x5075fd(0x296)+_0x4d7c3f[_0x5075fd(0x2a3)][_0x5075fd(0x282)](_0x5075fd(0x285))+'\x0a');_0x4d7c3f[_0x5075fd(0x230)]&&(_0x191aec+=_0x5075fd(0x1d1)+_0x4d7c3f[_0x5075fd(0x230)]+'`\x0a'),_0x191aec+=_0x5075fd(0x28f)+_0x4d7c3f['errorMessage']+'`\x0a',_0x4d7c3f[_0x5075fd(0x1ff)]&&(_0x191aec+=_0x5075fd(0x272)+_0x4d7c3f[_0x5075fd(0x1ff)]+'`\x0a'),_0x191aec+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this['sendShopNotification'](_0x90a505,_0x191aec,{'parse_mode':_0x5075fd(0x1f0)}),console[_0x5075fd(0x22c)](_0x5075fd(0x1f1)+_0x90a505+':\x20'+_0x4d7c3f[_0x5075fd(0x241)]);}catch(_0x1c6f0d){console['error']('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x1c6f0d);}}async[a54_0x15baaa(0x298)](_0x24ee59,_0x536496,_0x471820){const _0x2bf209=a54_0x15baaa;let _0x168b28='🔔\x20*'+_0x536496+_0x2bf209(0x294);for(const [_0x297473,_0x299f26]of Object[_0x2bf209(0x21c)](_0x471820)){_0x299f26!==null&&_0x299f26!==undefined&&(_0x168b28+=_0x297473+':\x20`'+_0x299f26+'`\x0a');}await this['sendShopNotification'](_0x24ee59,_0x168b28,{'parse_mode':_0x2bf209(0x1f0)});}['getBotInfo'](){const _0x1e1ce4=a54_0x15baaa;return{'isActive':!!this['bot'],'username':this[_0x1e1ce4(0x1e6)]};}[a54_0x15baaa(0x25d)](){const _0x4e5e6d=a54_0x15baaa;this[_0x4e5e6d(0x1e7)]&&(this[_0x4e5e6d(0x1e7)]['stopPolling'](),this[_0x4e5e6d(0x1e7)]=null,console['log'](_0x4e5e6d(0x26f)));}}exports['TelegramBotService']=TelegramBotService,exports[a54_0x15baaa(0x29e)]=new TelegramBotService();