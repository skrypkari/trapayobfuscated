'use strict';const a57_0x2bcfd1=a57_0x2ceb;function a57_0x2e7e(){const _0x2b6372=['Failed\x20login\x20attempt','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','forEach','update','remitterIban','❌\x20Invalid\x20username\x20format:\x20`','Error\x20in\x20handleSingleLineVerification:','customerUa','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','bot','warn','🏦\x20Method:\x20`','chat\x20not\x20found','allSettled','customerName','45TDgIVK','/status\x20-\x20check\x20connection\x20status\x0a','statusCode','🔗\x20TXID:\x20`','substring','onText','•\x20`','Payment\x20chargeback','chargebackAmount','👤\x20Username:\x20`','Check\x20spelling\x20and\x20try\x20again.','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','/disconnect\x20-\x20disconnect\x20from\x20notifications','*.\x0a\x0a','...\x22','\x20\x20\x20Public\x20Key:\x20`','`.\x0a\x0a','Commands:\x0a','You\x20sent\x20','TelegramBotService','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','trapay_bot','currency','entries','🛑\x20Telegram\x20bot\x20stopped','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','\x20via\x20single-line\x20input','ipAddress','\x20verified\x20for\x20shop\x20','1105990gxhIll','amount','*\x0a\x0a','username','Payout\x20completed','from','`\x0a\x0a','New\x20payment\x20created','startsWith','Error\x20handling\x20/status\x20command:','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','TELEGRAM_BOT_TOKEN','findUnique','initializeBot','📱\x20Your\x20Telegram\x20ID:\x20`','Payment\x20is\x20being\x20processed','sendLoginNotification','\x22,\x20apiKey=\x22','📅\x20Time:\x20','\x20(@','timestamp','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','getGatewayDisplayNameForTelegram','5692304ksXbbD','12ptUuZI','📅\x20Date:\x20','\x20parts:\x20','Telegram\x20bot\x20polling\x20error:','gateway','chat','shopSettings','success','publicKey','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','•\x20Payment\x20status\x20changes\x0a','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','\x20USDT*\x0a','error','Payment\x20refund','log','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','Telegram\x20bot\x20error:','🔍\x20*Debug\x20Information*\x0a\x0a','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','unknown\x20shop','sendShopNotification','🆔\x20Request\x20ID:\x20`','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','Use\x20/start\x20to\x20connect.','notificationApiError','__importDefault','requestId','`\x20is\x20inactive.\x0a\x0a','`\x20not\x20found.\x0a\x0a','user\x20is\x20deactivated','🌐\x20IP\x20address:\x20`','🔗\x20Endpoint:\x20`','•\x20New\x20payments\x0a','toString','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','🔔\x20*','🏪\x20Available\x20shops\x20in\x20system:\x0a','customerIp','telegramUser','🏪\x20Gateway:\x20`','❌\x20Error:\x20`','To\x20reconnect,\x20use\x20the\x20/start\x20command','📛\x20Name:\x20`','\x20initialized\x20successfully','💸\x20Amount:\x20*','🏦\x20IBAN:\x20`','Failed\x20to\x20send\x20login\x20notification:','\x20\x20\x20Username:\x20`','pk_','env','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','`\x20(','map','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a',':\x20username=\x22','\x0a👤\x20*Customer\x20Information:*\x0a','createdAt','findFirst','includes','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','sendMessage','🆔\x20Payment\x20ID:\x20`','botToken','Error\x20handling\x20message:','19888495zAzqTi','endpoint','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','sendCustomNotification','telegramId','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','en-US','last_name','defineProperty','Error\x20sending\x20shop\x20notification:','trim','ACTIVE','Payment\x20failed','isVerified','✅\x20Telegram\x20user\x20','89RiMxSg','Example:\x0a','Error\x20handling\x20/disconnect\x20command:','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','5545596TqLppO','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','adminNotes','handleSingleLineVerification','userAgent','split','notificationLogin','📝\x20Notes:\x20','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','findMany','8049ZpiaUi','stopPolling','text','shop','sendPayoutNotification','status','🔌\x20User\x20','sendPaymentNotification','🔔\x20Notifications\x20are\x20active\x0a\x0a','getBotInfo','✅\x20Welcome\x20back!\x0a\x0a','setupBotHandlers','customerEmail','chargeback','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','TELEGRAM_BOT_USERNAME','14362NEVNQe','toLocaleString','shopId','Error\x20handling\x20/start\x20command:','Error\x20handling\x20/debug\x20command:','788JdzLaR','📅\x20Connection\x20date:\x20','processing','stopBot','method','Available\x20usernames:\x0a','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','❌\x20Error\x20getting\x20debug\x20information.','Payment\x20expired','txid','sk_','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','.\x20*','message','test','default','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','botUsername','Markdown','create','Use\x20/start\x20to\x20begin.','✅\x20Connected\x20to\x20shop:\x20*','__esModule',':\x20`','../config/database','❌\x20Shop\x20with\x20username\x20`','\x22\x20->\x20display\x20\x22','polling_error','💰\x20Amount:\x20*','telegramBotService','length','1247165HaUnll','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','❌\x20Please\x20use\x20/start\x20command\x20first','failed','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','...','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','name'];a57_0x2e7e=function(){return _0x2b6372;};return a57_0x2e7e();}(function(_0x10fd32,_0x4a2e8f){const _0x5407ab=a57_0x2ceb,_0x322627=_0x10fd32();while(!![]){try{const _0x18795d=-parseInt(_0x5407ab(0x293))/0x1*(-parseInt(_0x5407ab(0x1cd))/0x2)+parseInt(_0x5407ab(0x1bd))/0x3*(parseInt(_0x5407ab(0x1d2))/0x4)+-parseInt(_0x5407ab(0x1f1))/0x5*(parseInt(_0x5407ab(0x23e))/0x6)+-parseInt(_0x5407ab(0x297))/0x7+-parseInt(_0x5407ab(0x23d))/0x8+-parseInt(_0x5407ab(0x208))/0x9*(parseInt(_0x5407ab(0x225))/0xa)+parseInt(_0x5407ab(0x281))/0xb;if(_0x18795d===_0x4a2e8f)break;else _0x322627['push'](_0x322627['shift']());}catch(_0x2736fb){_0x322627['push'](_0x322627['shift']());}}}(a57_0x2e7e,0x668ee));var __importDefault=this&&this[a57_0x2bcfd1(0x259)]||function(_0xd0eeaa){const _0x2b880a=a57_0x2bcfd1;return _0xd0eeaa&&_0xd0eeaa[_0x2b880a(0x1e8)]?_0xd0eeaa:{'default':_0xd0eeaa};};Object[a57_0x2bcfd1(0x28c)](exports,a57_0x2bcfd1(0x1e8),{'value':!![]}),exports[a57_0x2bcfd1(0x1ef)]=exports[a57_0x2bcfd1(0x21b)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a57_0x2bcfd1(0x1ea))),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x8d1e0c=a57_0x2bcfd1;this[_0x8d1e0c(0x202)]=null,this[_0x8d1e0c(0x27f)]=process[_0x8d1e0c(0x271)][_0x8d1e0c(0x230)]||'',this[_0x8d1e0c(0x1e3)]=process[_0x8d1e0c(0x271)][_0x8d1e0c(0x1cc)]||_0x8d1e0c(0x21d),this[_0x8d1e0c(0x27f)]?this[_0x8d1e0c(0x232)]():console[_0x8d1e0c(0x203)](_0x8d1e0c(0x1f2));}['initializeBot'](){const _0x48e43e=a57_0x2bcfd1;try{this[_0x48e43e(0x202)]=new node_telegram_bot_api_1[(_0x48e43e(0x1e1))](this[_0x48e43e(0x27f)],{'polling':!![]}),this[_0x48e43e(0x1c8)](),console[_0x48e43e(0x24d)]('✅\x20Telegram\x20bot\x20@'+this[_0x48e43e(0x1e3)]+_0x48e43e(0x26b));}catch(_0x25796d){console[_0x48e43e(0x24b)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x25796d);}}['setupBotHandlers'](){const _0x573fae=a57_0x2bcfd1;if(!this[_0x573fae(0x202)])return;this['bot']['onText'](/\/start/,async _0x2a99e4=>{const _0xa560e3=_0x573fae,_0x143e22=_0x2a99e4[_0xa560e3(0x243)]['id'],_0x38a53f=_0x2a99e4['from']?.['id'][_0xa560e3(0x261)](),_0x500a00=_0x2a99e4[_0xa560e3(0x22a)]?.['username'],_0x4382c9=_0x2a99e4[_0xa560e3(0x22a)]?.['first_name'],_0x1f15fe=_0x2a99e4[_0xa560e3(0x22a)]?.[_0xa560e3(0x28b)];if(!_0x38a53f)return;try{let _0x534151=await database_1[_0xa560e3(0x1e1)][_0xa560e3(0x266)][_0xa560e3(0x231)]({'where':{'telegramId':_0x38a53f},'include':{'shop':!![]}});!_0x534151?(_0x534151=await database_1[_0xa560e3(0x1e1)][_0xa560e3(0x266)][_0xa560e3(0x1e5)]({'data':{'telegramId':_0x38a53f,'username':_0x500a00,'firstName':_0x4382c9,'lastName':_0x1f15fe,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0xa560e3(0x24d)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x38a53f+_0xa560e3(0x238)+_0x500a00+')')):_0x534151=await database_1[_0xa560e3(0x1e1)][_0xa560e3(0x266)][_0xa560e3(0x1fc)]({'where':{'telegramId':_0x38a53f},'data':{'username':_0x500a00,'firstName':_0x4382c9,'lastName':_0x1f15fe},'include':{'shop':!![]}}),_0x534151[_0xa560e3(0x291)]&&_0x534151[_0xa560e3(0x1cf)]&&_0x534151[_0xa560e3(0x1c0)]?await this[_0xa560e3(0x202)]?.['sendMessage'](_0x143e22,_0xa560e3(0x1c7)+(_0xa560e3(0x289)+_0x534151['shop'][_0xa560e3(0x1f8)]+'*\x0a')+('Username:\x20`'+_0x534151[_0xa560e3(0x1c0)][_0xa560e3(0x228)]+'`\x0a\x0a')+_0xa560e3(0x1ba)+_0xa560e3(0x260)+_0xa560e3(0x248)+'•\x20Payouts\x0a\x0a'+_0xa560e3(0x219)+_0xa560e3(0x209)+_0xa560e3(0x214),{'parse_mode':_0xa560e3(0x1e4)}):(_0x534151[_0xa560e3(0x1cf)]&&!_0x534151[_0xa560e3(0x291)]&&(await database_1['default']['telegramUser']['update']({'where':{'telegramId':_0x38a53f},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x38a53f)),await this[_0xa560e3(0x202)]?.['sendMessage'](_0x143e22,_0xa560e3(0x221)+_0xa560e3(0x276)+_0xa560e3(0x1dd)+_0xa560e3(0x294)+_0xa560e3(0x256)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0xa560e3(0x1e4)}));}catch(_0x4d8155){console[_0xa560e3(0x24b)](_0xa560e3(0x1d0),_0x4d8155),await this[_0xa560e3(0x202)]?.['sendMessage'](_0x143e22,_0xa560e3(0x286));}}),this[_0x573fae(0x202)][_0x573fae(0x20d)](/\/disconnect/,async _0x181102=>{const _0x545b73=_0x573fae,_0xb0986c=_0x181102[_0x545b73(0x243)]['id'],_0x57e837=_0x181102[_0x545b73(0x22a)]?.['id'][_0x545b73(0x261)]();if(!_0x57e837)return;try{const _0x57a98f=await database_1[_0x545b73(0x1e1)][_0x545b73(0x266)][_0x545b73(0x231)]({'where':{'telegramId':_0x57e837},'include':{'shop':!![]}});if(!_0x57a98f||!_0x57a98f['isVerified']||!_0x57a98f[_0x545b73(0x1cf)]){await this['bot']?.['sendMessage'](_0xb0986c,_0x545b73(0x1cb));return;}const _0x1ffd1d=_0x57a98f[_0x545b73(0x1c0)]?.[_0x545b73(0x1f8)]||_0x545b73(0x253);await database_1[_0x545b73(0x1e1)][_0x545b73(0x266)][_0x545b73(0x1fc)]({'where':{'telegramId':_0x57e837},'data':{'shopId':null,'isVerified':![]}}),console[_0x545b73(0x24d)](_0x545b73(0x1c3)+_0x57e837+'\x20disconnected\x20from\x20shop\x20'+_0x57a98f[_0x545b73(0x1cf)]),await this[_0x545b73(0x202)]?.[_0x545b73(0x27d)](_0xb0986c,_0x545b73(0x273)+_0x1ffd1d+_0x545b73(0x215)+_0x545b73(0x269),{'parse_mode':_0x545b73(0x1e4)});}catch(_0x390fc6){console[_0x545b73(0x24b)](_0x545b73(0x295),_0x390fc6),await this[_0x545b73(0x202)]?.[_0x545b73(0x27d)](_0xb0986c,_0x545b73(0x286));}}),this[_0x573fae(0x202)][_0x573fae(0x20d)](/\/status/,async _0x5a7a0d=>{const _0x4aba68=_0x573fae,_0x506c35=_0x5a7a0d[_0x4aba68(0x243)]['id'],_0x5e9844=_0x5a7a0d[_0x4aba68(0x22a)]?.['id'][_0x4aba68(0x261)]();if(!_0x5e9844)return;try{const _0x485cda=await database_1['default'][_0x4aba68(0x266)]['findUnique']({'where':{'telegramId':_0x5e9844},'include':{'shop':!![]}});if(!_0x485cda){await this['bot']?.[_0x4aba68(0x27d)](_0x506c35,_0x4aba68(0x298)+_0x4aba68(0x1e6));return;}if(!_0x485cda[_0x4aba68(0x291)]||!_0x485cda[_0x4aba68(0x1cf)]||!_0x485cda['shop']){await this[_0x4aba68(0x202)]?.[_0x4aba68(0x27d)](_0x506c35,_0x4aba68(0x24f)+_0x4aba68(0x257));return;}await this[_0x4aba68(0x202)]?.[_0x4aba68(0x27d)](_0x506c35,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x4aba68(0x1e7)+_0x485cda['shop'][_0x4aba68(0x1f8)]+'*\x0a')+(_0x4aba68(0x211)+_0x485cda[_0x4aba68(0x1c0)][_0x4aba68(0x228)]+'`\x0a')+(_0x4aba68(0x1d3)+_0x485cda['updatedAt']['toLocaleDateString']('en-US')+'\x0a\x0a')+_0x4aba68(0x1c5)+_0x4aba68(0x219)+_0x4aba68(0x214),{'parse_mode':_0x4aba68(0x1e4)});}catch(_0x901a92){console[_0x4aba68(0x24b)](_0x4aba68(0x22e),_0x901a92),await this[_0x4aba68(0x202)]?.[_0x4aba68(0x27d)](_0x506c35,_0x4aba68(0x286));}}),this[_0x573fae(0x202)][_0x573fae(0x20d)](/\/debug/,async _0x4c3c72=>{const _0x7e862a=_0x573fae,_0x309d15=_0x4c3c72['chat']['id'],_0x31db94=_0x4c3c72[_0x7e862a(0x22a)]?.['id'][_0x7e862a(0x261)]();if(!_0x31db94)return;try{const _0x6193af=await database_1[_0x7e862a(0x1e1)][_0x7e862a(0x1c0)][_0x7e862a(0x1bc)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x33f5c8=_0x7e862a(0x251);_0x33f5c8+=_0x7e862a(0x233)+_0x31db94+_0x7e862a(0x22b),_0x33f5c8+=_0x7e862a(0x264),_0x6193af[_0x7e862a(0x1fb)]((_0x154480,_0x9373ea)=>{const _0x40d2c6=_0x7e862a;_0x33f5c8+=_0x9373ea+0x1+_0x40d2c6(0x1de)+_0x154480[_0x40d2c6(0x1f8)]+'*\x0a',_0x33f5c8+=_0x40d2c6(0x26f)+_0x154480[_0x40d2c6(0x228)]+'`\x0a',_0x33f5c8+='\x20\x20\x20Status:\x20'+_0x154480[_0x40d2c6(0x1c2)]+'\x0a',_0x33f5c8+=_0x40d2c6(0x217)+_0x154480[_0x40d2c6(0x246)][_0x40d2c6(0x20c)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x7e862a(0x202)]?.[_0x7e862a(0x27d)](_0x309d15,_0x33f5c8,{'parse_mode':_0x7e862a(0x1e4)});}catch(_0x8b91d7){console[_0x7e862a(0x24b)](_0x7e862a(0x1d1),_0x8b91d7),await this[_0x7e862a(0x202)]?.[_0x7e862a(0x27d)](_0x309d15,_0x7e862a(0x1d9));}}),this[_0x573fae(0x202)]['on']('message',async _0x455233=>{const _0x420ba8=_0x573fae;if(_0x455233[_0x420ba8(0x1bf)]?.[_0x420ba8(0x22d)]('/'))return;const _0x15e2a1=_0x455233[_0x420ba8(0x243)]['id'],_0x55f8b7=_0x455233[_0x420ba8(0x22a)]?.['id'][_0x420ba8(0x261)](),_0x58ec1c=_0x455233[_0x420ba8(0x1bf)]?.[_0x420ba8(0x28e)]();if(!_0x55f8b7||!_0x58ec1c)return;try{const _0x1bbb25=await database_1[_0x420ba8(0x1e1)][_0x420ba8(0x266)][_0x420ba8(0x231)]({'where':{'telegramId':_0x55f8b7},'include':{'shop':!![]}});if(!_0x1bbb25){await this[_0x420ba8(0x202)]?.[_0x420ba8(0x27d)](_0x15e2a1,_0x420ba8(0x1f3));return;}if(_0x1bbb25[_0x420ba8(0x291)]&&_0x1bbb25[_0x420ba8(0x1cf)]&&_0x1bbb25[_0x420ba8(0x1c0)]){await this[_0x420ba8(0x202)]?.[_0x420ba8(0x27d)](_0x15e2a1,_0x420ba8(0x1f7)+_0x1bbb25[_0x420ba8(0x1c0)]['name']+_0x420ba8(0x215)+_0x420ba8(0x1bb),{'parse_mode':_0x420ba8(0x1e4)});return;}const _0xbb95d4=_0x58ec1c[_0x420ba8(0x29c)](/\s+/);if(_0xbb95d4[_0x420ba8(0x1f0)]!==0x2){await this[_0x420ba8(0x202)]?.[_0x420ba8(0x27d)](_0x15e2a1,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x420ba8(0x1dd)+'Example:\x0a'+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x420ba8(0x21a)+_0xbb95d4[_0x420ba8(0x1f0)]+_0x420ba8(0x240)+_0xbb95d4[_0x420ba8(0x275)](_0x192ad2=>'`'+_0x192ad2+'`')['join'](',\x20')),{'parse_mode':_0x420ba8(0x1e4)});return;}const [_0x295c4e,_0x205a03]=_0xbb95d4;console[_0x420ba8(0x24d)](_0x420ba8(0x262)+_0x55f8b7+_0x420ba8(0x277)+_0x295c4e+_0x420ba8(0x236)+_0x205a03[_0x420ba8(0x20c)](0x0,0xa)+'...\x22'),await this[_0x420ba8(0x29a)](_0x15e2a1,_0x55f8b7,_0x295c4e,_0x205a03);}catch(_0x491fdb){console[_0x420ba8(0x24b)](_0x420ba8(0x280),_0x491fdb),await this[_0x420ba8(0x202)]?.['sendMessage'](_0x15e2a1,_0x420ba8(0x286));}}),this[_0x573fae(0x202)]['on'](_0x573fae(0x24b),_0x30f1bb=>{const _0x4ae710=_0x573fae;console[_0x4ae710(0x24b)](_0x4ae710(0x250),_0x30f1bb);}),this['bot']['on'](_0x573fae(0x1ed),_0xd3a6ad=>{const _0x4e7d51=_0x573fae;console['error'](_0x4e7d51(0x241),_0xd3a6ad);});}async[a57_0x2bcfd1(0x29a)](_0x500eed,_0x297c4a,_0x5eb8bc,_0x1f485e){const _0x5f4fef=a57_0x2bcfd1;try{console[_0x5f4fef(0x24d)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x297c4a+_0x5f4fef(0x277)+_0x5eb8bc+'\x22,\x20apiKey=\x22'+_0x1f485e[_0x5f4fef(0x20c)](0x0,0xa)+_0x5f4fef(0x216));if(!_0x5eb8bc||_0x5eb8bc[_0x5f4fef(0x1f0)]<0x3||_0x5eb8bc['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x5f4fef(0x1e0)](_0x5eb8bc)){await this[_0x5f4fef(0x202)]?.[_0x5f4fef(0x27d)](_0x500eed,_0x5f4fef(0x1fe)+_0x5eb8bc+_0x5f4fef(0x22b)+_0x5f4fef(0x27c),{'parse_mode':'Markdown'});return;}if(!_0x1f485e||!_0x1f485e[_0x5f4fef(0x22d)](_0x5f4fef(0x270))&&!_0x1f485e['startsWith'](_0x5f4fef(0x1dc))){await this[_0x5f4fef(0x202)]?.[_0x5f4fef(0x27d)](_0x500eed,_0x5f4fef(0x1d8)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x5f4fef(0x1e4)});return;}const _0x28d7a5=await database_1['default'][_0x5f4fef(0x1c0)][_0x5f4fef(0x231)]({'where':{'username':_0x5eb8bc},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x28d7a5){const _0x3755be=await database_1[_0x5f4fef(0x1e1)][_0x5f4fef(0x1c0)][_0x5f4fef(0x1bc)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x3838e6=_0x5f4fef(0x1eb)+_0x5eb8bc+_0x5f4fef(0x25c);_0x3755be[_0x5f4fef(0x1f0)]>0x0?(_0x3838e6+=_0x5f4fef(0x1d7),_0x3755be['forEach'](_0x2c9e6f=>{const _0x207e96=_0x5f4fef;_0x3838e6+=_0x207e96(0x20e)+_0x2c9e6f['username']+_0x207e96(0x274)+_0x2c9e6f[_0x207e96(0x1f8)]+')\x0a';}),_0x3838e6+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x3838e6+=_0x5f4fef(0x212);await this[_0x5f4fef(0x202)]?.['sendMessage'](_0x500eed,_0x3838e6,{'parse_mode':_0x5f4fef(0x1e4)});return;}if(_0x28d7a5[_0x5f4fef(0x1c2)]!==_0x5f4fef(0x28f)){await this[_0x5f4fef(0x202)]?.[_0x5f4fef(0x27d)](_0x500eed,'❌\x20Shop\x20`'+_0x5eb8bc+_0x5f4fef(0x25b)+'Contact\x20administrator.',{'parse_mode':_0x5f4fef(0x1e4)});return;}if(_0x28d7a5[_0x5f4fef(0x246)]!==_0x1f485e&&_0x28d7a5['secretKey']!==_0x1f485e){await this['bot']?.[_0x5f4fef(0x27d)](_0x500eed,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x5eb8bc+'`.\x0a\x0a'+_0x5f4fef(0x249)+_0x5f4fef(0x213),{'parse_mode':_0x5f4fef(0x1e4)});return;}const _0x18ae3f=await database_1[_0x5f4fef(0x1e1)][_0x5f4fef(0x266)][_0x5f4fef(0x27a)]({'where':{'shopId':_0x28d7a5['id'],'isVerified':!![],'telegramId':{'not':_0x297c4a}}});if(_0x18ae3f){await this[_0x5f4fef(0x202)]?.['sendMessage'](_0x500eed,_0x5f4fef(0x201)+_0x5eb8bc+_0x5f4fef(0x218)+_0x5f4fef(0x21c),{'parse_mode':_0x5f4fef(0x1e4)});return;}await database_1[_0x5f4fef(0x1e1)]['telegramUser'][_0x5f4fef(0x1fc)]({'where':{'telegramId':_0x297c4a},'data':{'shopId':_0x28d7a5['id'],'isVerified':!![]}}),await this[_0x5f4fef(0x202)]?.[_0x5f4fef(0x27d)](_0x500eed,'🎉\x20*Congratulations!*\x0a\x0a'+_0x5f4fef(0x22f)+('📱\x20Shop:\x20*'+_0x28d7a5[_0x5f4fef(0x1f8)]+'*\x0a')+(_0x5f4fef(0x211)+_0x28d7a5[_0x5f4fef(0x228)]+'`\x0a\x0a')+_0x5f4fef(0x247)+_0x5f4fef(0x260)+_0x5f4fef(0x248)+'•\x20Payouts\x0a'+'•\x20Important\x20events\x0a\x0a'+_0x5f4fef(0x219)+_0x5f4fef(0x209)+_0x5f4fef(0x214),{'parse_mode':_0x5f4fef(0x1e4)}),console[_0x5f4fef(0x24d)](_0x5f4fef(0x292)+_0x297c4a+_0x5f4fef(0x224)+_0x28d7a5[_0x5f4fef(0x228)]+_0x5f4fef(0x222));}catch(_0x12193b){console[_0x5f4fef(0x24b)](_0x5f4fef(0x1ff),_0x12193b),await this['bot']?.[_0x5f4fef(0x27d)](_0x500eed,_0x5f4fef(0x296));}}async[a57_0x2bcfd1(0x254)](_0x5c8136,_0x4c044e,_0x50dfc4){const _0x16a998=a57_0x2bcfd1;if(!this[_0x16a998(0x202)]){console[_0x16a998(0x203)](_0x16a998(0x272));return;}try{const _0x4482b9=await database_1[_0x16a998(0x1e1)]['telegramUser']['findMany']({'where':{'shopId':_0x5c8136,'isVerified':!![]}});if(_0x4482b9[_0x16a998(0x1f0)]===0x0){console[_0x16a998(0x24d)](_0x16a998(0x1e2)+_0x5c8136);return;}const _0x5e87b5=_0x4482b9[_0x16a998(0x275)](async _0xeb354f=>{const _0x26063d=_0x16a998;try{await this['bot']?.[_0x26063d(0x27d)](_0xeb354f['telegramId'],_0x4c044e,_0x50dfc4),console[_0x26063d(0x24d)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0xeb354f['telegramId']);}catch(_0x19929d){console[_0x26063d(0x24b)](_0x26063d(0x287)+_0xeb354f[_0x26063d(0x285)]+':',_0x19929d),_0x19929d instanceof Error&&(_0x19929d[_0x26063d(0x1df)][_0x26063d(0x27b)]('blocked')||_0x19929d[_0x26063d(0x1df)][_0x26063d(0x27b)](_0x26063d(0x205))||_0x19929d['message']['includes'](_0x26063d(0x25d)))&&(await database_1[_0x26063d(0x1e1)]['telegramUser']['update']({'where':{'id':_0xeb354f['id']},'data':{'isVerified':![]}}),console[_0x26063d(0x24d)]('User\x20'+_0xeb354f[_0x26063d(0x285)]+_0x26063d(0x23b)));}});await Promise[_0x16a998(0x206)](_0x5e87b5);}catch(_0x26138a){console[_0x16a998(0x24b)](_0x16a998(0x28d),_0x26138a);}}async[a57_0x2bcfd1(0x1c4)](_0x3f20d4,_0x4e523b,_0x53a60b){const _0x2540bc=a57_0x2bcfd1,_0x14940a={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x5255ac={'created':_0x2540bc(0x22c),'paid':'Payment\x20successfully\x20paid','failed':_0x2540bc(0x290),'expired':_0x2540bc(0x1da),'refund':_0x2540bc(0x24c),'chargeback':_0x2540bc(0x20f),'processing':_0x2540bc(0x234)},_0x4c685f=_0x14940a[_0x53a60b],_0x5aaf9f=_0x5255ac[_0x53a60b],_0x561cd0=(0x0,gateway_1[_0x2540bc(0x23c)])(_0x4e523b[_0x2540bc(0x242)]);console[_0x2540bc(0x24d)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x4e523b[_0x2540bc(0x242)]+_0x2540bc(0x1ec)+_0x561cd0+'\x22');let _0x1e7152=_0x4c685f+'\x20*'+_0x5aaf9f+_0x2540bc(0x227)+(_0x2540bc(0x1ee)+_0x4e523b['amount']+'\x20'+_0x4e523b[_0x2540bc(0x21e)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x4e523b['orderId']||_0x4e523b['id'])+'`\x0a')+(_0x2540bc(0x27e)+_0x4e523b['id']+'`\x0a')+(_0x2540bc(0x267)+_0x561cd0+'`\x0a')+(_0x2540bc(0x23f)+new Date(_0x4e523b['createdAt'])[_0x2540bc(0x1ce)]('en-US')+'\x0a');if(_0x4e523b[_0x2540bc(0x207)]||_0x4e523b[_0x2540bc(0x1c9)]||_0x4e523b['remitterIban']||_0x4e523b['customerIp']||_0x4e523b[_0x2540bc(0x200)]){_0x1e7152+=_0x2540bc(0x278);_0x4e523b[_0x2540bc(0x207)]&&(_0x1e7152+=_0x2540bc(0x26a)+_0x4e523b[_0x2540bc(0x207)]+'`\x0a');_0x4e523b[_0x2540bc(0x1c9)]&&(_0x1e7152+='📧\x20Email:\x20`'+_0x4e523b[_0x2540bc(0x1c9)]+'`\x0a');_0x4e523b['remitterIban']&&(_0x1e7152+=_0x2540bc(0x26d)+_0x4e523b[_0x2540bc(0x1fd)]+'`\x0a');_0x4e523b['customerIp']&&(_0x1e7152+='🌐\x20IP:\x20`'+_0x4e523b[_0x2540bc(0x265)]+'`\x0a');if(_0x4e523b[_0x2540bc(0x200)]){const _0x4309b0=_0x4e523b[_0x2540bc(0x200)]['length']>0x32?_0x4e523b['customerUa'][_0x2540bc(0x20c)](0x0,0x32)+'...':_0x4e523b[_0x2540bc(0x200)];_0x1e7152+='💻\x20Browser:\x20`'+_0x4309b0+'`\x0a';}}_0x53a60b===_0x2540bc(0x1ca)&&_0x4e523b[_0x2540bc(0x210)]&&(_0x1e7152+='💸\x20Penalty\x20amount:\x20*'+_0x4e523b[_0x2540bc(0x210)]+_0x2540bc(0x24a)),_0x53a60b===_0x2540bc(0x1d4)&&(_0x1e7152+=_0x2540bc(0x1fa)),_0x4e523b[_0x2540bc(0x299)]&&(_0x1e7152+=_0x2540bc(0x29e)+_0x4e523b[_0x2540bc(0x299)]+'\x0a'),await this[_0x2540bc(0x254)](_0x3f20d4,_0x1e7152,{'parse_mode':_0x2540bc(0x1e4)});}async[a57_0x2bcfd1(0x1c1)](_0x4c962e,_0x3846a8,_0x74d465){const _0x181af6=a57_0x2bcfd1,_0x21d0e3={'created':'📤','completed':'✅','rejected':'❌'},_0x275f38={'created':'New\x20payout\x20created','completed':_0x181af6(0x229),'rejected':'Payout\x20rejected'},_0x45ef67=_0x21d0e3[_0x74d465],_0x1f563b=_0x275f38[_0x74d465],_0x294ae9=_0x45ef67+'\x20*'+_0x1f563b+'*\x0a\x0a'+(_0x181af6(0x26c)+_0x3846a8[_0x181af6(0x226)]+'\x20USD*\x0a')+(_0x181af6(0x204)+_0x3846a8[_0x181af6(0x1d6)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x3846a8['id']+'`\x0a')+(_0x181af6(0x23f)+new Date(_0x3846a8[_0x181af6(0x279)])[_0x181af6(0x1ce)](_0x181af6(0x28a))+'\x0a')+(_0x3846a8[_0x181af6(0x1db)]?_0x181af6(0x20b)+_0x3846a8[_0x181af6(0x1db)]+'`':'');await this['sendShopNotification'](_0x4c962e,_0x294ae9,{'parse_mode':_0x181af6(0x1e4)});}async[a57_0x2bcfd1(0x235)](_0x18675b,_0x441aa){const _0x570a9b=a57_0x2bcfd1;try{const _0x39a789=await database_1[_0x570a9b(0x1e1)][_0x570a9b(0x244)][_0x570a9b(0x231)]({'where':{'shopId':_0x18675b},'select':{'notificationLogin':!![]}});if(!_0x39a789?.[_0x570a9b(0x29d)]){console[_0x570a9b(0x24d)](_0x570a9b(0x283)+_0x18675b);return;}const _0x382c18=_0x441aa[_0x570a9b(0x245)]?'🔐':'🚨',_0x2c9e26=_0x441aa[_0x570a9b(0x245)]?'Successful\x20login':_0x570a9b(0x1f9);let _0x2a3bf6=_0x382c18+'\x20*'+_0x2c9e26+_0x570a9b(0x227)+(_0x570a9b(0x211)+_0x441aa['username']+'`\x0a')+(_0x570a9b(0x237)+_0x441aa[_0x570a9b(0x239)][_0x570a9b(0x1ce)](_0x570a9b(0x28a))+'\x0a');_0x441aa[_0x570a9b(0x223)]&&(_0x2a3bf6+=_0x570a9b(0x25e)+_0x441aa['ipAddress']+'`\x0a');if(_0x441aa[_0x570a9b(0x29b)]){const _0x14bed3=_0x441aa['userAgent']['length']>0x32?_0x441aa[_0x570a9b(0x29b)][_0x570a9b(0x20c)](0x0,0x32)+_0x570a9b(0x1f6):_0x441aa[_0x570a9b(0x29b)];_0x2a3bf6+='💻\x20Browser:\x20`'+_0x14bed3+'`\x0a';}!_0x441aa['success']&&(_0x2a3bf6+=_0x570a9b(0x252)),await this[_0x570a9b(0x254)](_0x18675b,_0x2a3bf6,{'parse_mode':'Markdown'}),console['log'](_0x570a9b(0x23a)+_0x18675b+':\x20'+(_0x441aa[_0x570a9b(0x245)]?_0x570a9b(0x245):_0x570a9b(0x1f4)));}catch(_0x3fb3d9){console['error'](_0x570a9b(0x26e),_0x3fb3d9);}}async['sendApiErrorNotification'](_0x1da00b,_0x430a3b){const _0x14c639=a57_0x2bcfd1;try{const _0x2f2c6d=await database_1[_0x14c639(0x1e1)]['shopSettings'][_0x14c639(0x231)]({'where':{'shopId':_0x1da00b},'select':{'notificationApiError':!![]}});if(!_0x2f2c6d?.[_0x14c639(0x258)]){console[_0x14c639(0x24d)](_0x14c639(0x1f5)+_0x1da00b);return;}let _0x13b1ee='🚨\x20*API\x20Error*\x0a\x0a'+(_0x14c639(0x25f)+_0x430a3b[_0x14c639(0x1d6)]+'\x20'+_0x430a3b[_0x14c639(0x282)]+'`\x0a')+('📅\x20Time:\x20'+_0x430a3b[_0x14c639(0x239)][_0x14c639(0x1ce)](_0x14c639(0x28a))+'\x0a');_0x430a3b[_0x14c639(0x20a)]&&(_0x13b1ee+='📊\x20Error\x20code:\x20`'+_0x430a3b[_0x14c639(0x20a)]+'`\x0a'),_0x13b1ee+=_0x14c639(0x268)+_0x430a3b['errorMessage']+'`\x0a',_0x430a3b[_0x14c639(0x25a)]&&(_0x13b1ee+=_0x14c639(0x255)+_0x430a3b['requestId']+'`\x0a'),_0x13b1ee+=_0x14c639(0x288),await this[_0x14c639(0x254)](_0x1da00b,_0x13b1ee,{'parse_mode':_0x14c639(0x1e4)}),console['log'](_0x14c639(0x24e)+_0x1da00b+':\x20'+_0x430a3b[_0x14c639(0x282)]);}catch(_0x4ed5ae){console['error']('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x4ed5ae);}}async[a57_0x2bcfd1(0x284)](_0x149e11,_0x564e70,_0x2a378d){const _0x24a92b=a57_0x2bcfd1;let _0x41c388=_0x24a92b(0x263)+_0x564e70+_0x24a92b(0x227);for(const [_0x47645c,_0x2672ce]of Object[_0x24a92b(0x21f)](_0x2a378d)){_0x2672ce!==null&&_0x2672ce!==undefined&&(_0x41c388+=_0x47645c+_0x24a92b(0x1e9)+_0x2672ce+'`\x0a');}await this['sendShopNotification'](_0x149e11,_0x41c388,{'parse_mode':_0x24a92b(0x1e4)});}[a57_0x2bcfd1(0x1c6)](){const _0x5902d9=a57_0x2bcfd1;return{'isActive':!!this[_0x5902d9(0x202)],'username':this['botUsername']};}[a57_0x2bcfd1(0x1d5)](){const _0x3ff219=a57_0x2bcfd1;this[_0x3ff219(0x202)]&&(this[_0x3ff219(0x202)][_0x3ff219(0x1be)](),this[_0x3ff219(0x202)]=null,console[_0x3ff219(0x24d)](_0x3ff219(0x220)));}}function a57_0x2ceb(_0x144bba,_0x5a9579){const _0x2e7eee=a57_0x2e7e();return a57_0x2ceb=function(_0x2ceb93,_0x4593a5){_0x2ceb93=_0x2ceb93-0x1ba;let _0x4190f2=_0x2e7eee[_0x2ceb93];return _0x4190f2;},a57_0x2ceb(_0x144bba,_0x5a9579);}exports[a57_0x2bcfd1(0x21b)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();