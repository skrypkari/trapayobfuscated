'use strict';function a55_0x4a00(_0x969d8,_0xdb82a2){const _0xf7568b=a55_0xf756();return a55_0x4a00=function(_0x4a0032,_0x26f189){_0x4a0032=_0x4a0032-0x170;let _0x213bf0=_0xf7568b[_0x4a0032];return _0x213bf0;},a55_0x4a00(_0x969d8,_0xdb82a2);}function a55_0xf756(){const _0x1b712f=['\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','user\x20is\x20deactivated','secretKey','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','last_name','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','/status\x20-\x20check\x20connection\x20status\x0a','📊\x20*Connection\x20Status*\x0a\x0a','...`\x0a\x0a','`\x20not\x20found.\x0a\x0a','📅\x20Time:\x20','default','\x20initialized\x20successfully','trim','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','telegramBotService','🌐\x20IP\x20address:\x20`','784434SSQQNV','298729YGesUy','📱\x20Shop:\x20*','\x20parts:\x20','💰\x20Amount:\x20*','text','telegramId','2140HeDmFm','Error\x20handling\x20message:','createdAt','📅\x20Connection\x20date:\x20','findFirst','method','getBotInfo','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Failed\x20login\x20attempt','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','🔌\x20User\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','\x22,\x20apiKey=\x22','...\x22','Payment\x20expired','User\x20','Payout\x20completed','Username:\x20`','•\x20Payment\x20status\x20changes\x0a','substring','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','Commands:\x0a','log','stopBot','📱\x20Your\x20Telegram\x20ID:\x20`','bot','notificationApiError','test','\x20USD*\x0a','Error\x20handling\x20/debug\x20command:','shop','🏦\x20Method:\x20`','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','Error\x20handling\x20/status\x20command:','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','adminNotes','Contact\x20administrator.','initializeBot','first_name','🆔\x20Payout\x20ID:\x20`','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a',':\x20username=\x22','username','customerName','currency','Payment\x20is\x20being\x20processed','Telegram\x20bot\x20error:',':\x20`','\x20verified\x20for\x20shop\x20','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','toString','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','To\x20reconnect,\x20use\x20the\x20/start\x20command','Payout\x20rejected','Error\x20handling\x20/start\x20command:','updatedAt','📊\x20Error\x20code:\x20`','entries','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','📅\x20Date:\x20','customerUa','711436MKCPTv','Use\x20/start\x20to\x20begin.','📧\x20Email:\x20`','New\x20payout\x20created','sendMessage','❌\x20Shop\x20`','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','•\x20New\x20payments\x0a','You\x20sent\x20','statusCode','botUsername','endpoint','sendCustomNotification','✅\x20Telegram\x20user\x20','toLocaleString','❌\x20Invalid\x20username\x20format:\x20`','Failed\x20to\x20send\x20login\x20notification:','sendApiErrorNotification','Markdown','getGatewayDisplayNameForTelegram','/disconnect\x20-\x20disconnect\x20from\x20notifications','toLocaleDateString','findMany','sendPaymentNotification','length','\x0a👤\x20*Customer\x20Information:*\x0a','📝\x20Notes:\x20','`\x0a\x0a','gateway','Payment\x20failed','telegramUser','errorMessage','🔔\x20Notifications\x20are\x20active\x0a\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','includes','🌐\x20IP:\x20`','split','en-US','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','`.\x0a\x0a','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','handleSingleLineVerification','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','🎉\x20*Congratulations!*\x0a\x0a','\x20via\x20single-line\x20input','477555sAjexo','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','Failed\x20to\x20send\x20API\x20error\x20notification:','788140wBCgfh','✅\x20Welcome\x20back!\x0a\x0a','publicKey','../types/gateway','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','forEach','TELEGRAM_BOT_USERNAME','Example:\x0a','allSettled','TELEGRAM_BOT_TOKEN','message','notificationLogin','setupBotHandlers','*\x0a\x0a','chargeback','Telegram\x20bot\x20polling\x20error:','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','💸\x20Penalty\x20amount:\x20*','🔗\x20Endpoint:\x20`','\x20\x20\x20Username:\x20`','warn','unknown\x20shop','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','ipAddress','📝\x20Order\x20ID:\x20`','Successful\x20login','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','🔔\x20*','ACTIVE','error','🔗\x20TXID:\x20`','status','🏪\x20Gateway:\x20`','🆔\x20Payment\x20ID:\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a','shopId','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','customerIp','amount','txid','botToken','sendPayoutNotification','❌\x20Shop\x20with\x20username\x20`','isVerified','chat','*.\x0a\x0a','Check\x20spelling\x20and\x20try\x20again.','32LXqEaX','3rhkYDn','shopSettings','sendShopNotification','🆔\x20Request\x20ID:\x20`','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','timestamp','\x0aCheck\x20spelling\x20and\x20try\x20again.','defineProperty','\x20\x20\x20Public\x20Key:\x20`','✅\x20Connected\x20to\x20shop:\x20*','\x20USDT*\x0a','6381mLcSgS','New\x20payment\x20created','remitterIban','pk_','...','TelegramBotService','💻\x20Browser:\x20`','findUnique','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','📛\x20Name:\x20`','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','success','\x20\x20\x20Status:\x20','chargebackAmount','map','startsWith','customerEmail','Available\x20usernames:\x0a','__esModule','🔔\x20You\x20receive\x20notifications\x20about:\x0a','from','name','`\x20is\x20inactive.\x0a\x0a','userAgent','orderId','join','👤\x20Username:\x20`','•\x20Payouts\x0a\x0a','❌\x20Error:\x20`','update','777168HoSnvQ','../config/database','onText','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'];a55_0xf756=function(){return _0x1b712f;};return a55_0xf756();}const a55_0x3b9791=a55_0x4a00;(function(_0x30514e,_0x13c54a){const _0x550b63=a55_0x4a00,_0x4066a3=_0x30514e();while(!![]){try{const _0x3fac52=-parseInt(_0x550b63(0x24d))/0x1+parseInt(_0x550b63(0x1aa))/0x2+-parseInt(_0x550b63(0x20a))/0x3*(-parseInt(_0x550b63(0x1da))/0x4)+-parseInt(_0x550b63(0x1d7))/0x5+-parseInt(_0x550b63(0x24c))/0x6+parseInt(_0x550b63(0x234))/0x7*(parseInt(_0x550b63(0x209))/0x8)+-parseInt(_0x550b63(0x215))/0x9*(parseInt(_0x550b63(0x253))/0xa);if(_0x3fac52===_0x13c54a)break;else _0x4066a3['push'](_0x4066a3['shift']());}catch(_0x53498a){_0x4066a3['push'](_0x4066a3['shift']());}}}(a55_0xf756,0x4e290));var __importDefault=this&&this['__importDefault']||function(_0x1a4f25){const _0x33d3c0=a55_0x4a00;return _0x1a4f25&&_0x1a4f25[_0x33d3c0(0x228)]?_0x1a4f25:{'default':_0x1a4f25};};Object[a55_0x3b9791(0x211)](exports,'__esModule',{'value':!![]}),exports['telegramBotService']=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a55_0x3b9791(0x235))),gateway_1=require(a55_0x3b9791(0x1dd));class TelegramBotService{constructor(){const _0x5eb06d=a55_0x3b9791;this['bot']=null,this['botToken']=process['env'][_0x5eb06d(0x1e3)]||'',this[_0x5eb06d(0x1b4)]=process['env'][_0x5eb06d(0x1e0)]||'trapay_bot',this[_0x5eb06d(0x202)]?this[_0x5eb06d(0x192)]():console[_0x5eb06d(0x1ee)](_0x5eb06d(0x1a0));}['initializeBot'](){const _0xeae3c6=a55_0x3b9791;try{this['bot']=new node_telegram_bot_api_1[(_0xeae3c6(0x246))](this['botToken'],{'polling':!![]}),this['setupBotHandlers'](),console[_0xeae3c6(0x182)]('✅\x20Telegram\x20bot\x20@'+this['botUsername']+_0xeae3c6(0x247));}catch(_0x39602d){console[_0xeae3c6(0x1f7)](_0xeae3c6(0x238),_0x39602d);}}[a55_0x3b9791(0x1e6)](){const _0x56401d=a55_0x3b9791;if(!this['bot'])return;this[_0x56401d(0x185)][_0x56401d(0x236)](/\/start/,async _0xa9e99f=>{const _0x1dafc8=_0x56401d,_0x2555b8=_0xa9e99f[_0x1dafc8(0x206)]['id'],_0x3f3739=_0xa9e99f[_0x1dafc8(0x22a)]?.['id']['toString'](),_0x5c46c8=_0xa9e99f['from']?.[_0x1dafc8(0x197)],_0xd79432=_0xa9e99f[_0x1dafc8(0x22a)]?.[_0x1dafc8(0x193)],_0x3ac005=_0xa9e99f[_0x1dafc8(0x22a)]?.[_0x1dafc8(0x23f)];if(!_0x3f3739)return;try{let _0x470b51=await database_1[_0x1dafc8(0x246)]['telegramUser'][_0x1dafc8(0x21c)]({'where':{'telegramId':_0x3f3739},'include':{'shop':!![]}});!_0x470b51?(_0x470b51=await database_1[_0x1dafc8(0x246)]['telegramUser']['create']({'data':{'telegramId':_0x3f3739,'username':_0x5c46c8,'firstName':_0xd79432,'lastName':_0x3ac005,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x1dafc8(0x182)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x3f3739+'\x20(@'+_0x5c46c8+')')):_0x470b51=await database_1[_0x1dafc8(0x246)]['telegramUser'][_0x1dafc8(0x233)]({'where':{'telegramId':_0x3f3739},'data':{'username':_0x5c46c8,'firstName':_0xd79432,'lastName':_0x3ac005},'include':{'shop':!![]}}),_0x470b51[_0x1dafc8(0x205)]&&_0x470b51['shopId']&&_0x470b51[_0x1dafc8(0x18a)]?await this[_0x1dafc8(0x185)]?.[_0x1dafc8(0x1ae)](_0x2555b8,_0x1dafc8(0x1db)+(_0x1dafc8(0x23d)+_0x470b51[_0x1dafc8(0x18a)]['name']+'*\x0a')+(_0x1dafc8(0x17d)+_0x470b51[_0x1dafc8(0x18a)][_0x1dafc8(0x197)]+'`\x0a\x0a')+_0x1dafc8(0x229)+_0x1dafc8(0x1b1)+_0x1dafc8(0x17e)+_0x1dafc8(0x231)+_0x1dafc8(0x181)+_0x1dafc8(0x241)+_0x1dafc8(0x1be),{'parse_mode':_0x1dafc8(0x1bc)}):(_0x470b51[_0x1dafc8(0x1fd)]&&!_0x470b51[_0x1dafc8(0x205)]&&(await database_1['default'][_0x1dafc8(0x1c8)][_0x1dafc8(0x233)]({'where':{'telegramId':_0x3f3739},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x3f3739)),await this[_0x1dafc8(0x185)]?.['sendMessage'](_0x2555b8,_0x1dafc8(0x23e)+_0x1dafc8(0x1f0)+_0x1dafc8(0x173)+'Example:\x0a'+_0x1dafc8(0x21e)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x1dafc8(0x1bc)}));}catch(_0x1d0b3c){console[_0x1dafc8(0x1f7)](_0x1dafc8(0x1a3),_0x1d0b3c),await this[_0x1dafc8(0x185)]?.[_0x1dafc8(0x1ae)](_0x2555b8,_0x1dafc8(0x220));}}),this['bot'][_0x56401d(0x236)](/\/disconnect/,async _0x30a934=>{const _0xd8fd89=_0x56401d,_0xf7050a=_0x30a934[_0xd8fd89(0x206)]['id'],_0x5d1ac3=_0x30a934['from']?.['id'][_0xd8fd89(0x19f)]();if(!_0x5d1ac3)return;try{const _0xbac6e7=await database_1[_0xd8fd89(0x246)][_0xd8fd89(0x1c8)][_0xd8fd89(0x21c)]({'where':{'telegramId':_0x5d1ac3},'include':{'shop':!![]}});if(!_0xbac6e7||!_0xbac6e7[_0xd8fd89(0x205)]||!_0xbac6e7[_0xd8fd89(0x1fd)]){await this[_0xd8fd89(0x185)]?.[_0xd8fd89(0x1ae)](_0xf7050a,_0xd8fd89(0x1d8));return;}const _0x278420=_0xbac6e7[_0xd8fd89(0x18a)]?.['name']||_0xd8fd89(0x1ef);await database_1[_0xd8fd89(0x246)][_0xd8fd89(0x1c8)][_0xd8fd89(0x233)]({'where':{'telegramId':_0x5d1ac3},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0xd8fd89(0x176)+_0x5d1ac3+'\x20disconnected\x20from\x20shop\x20'+_0xbac6e7['shopId']),await this[_0xd8fd89(0x185)]?.['sendMessage'](_0xf7050a,_0xd8fd89(0x1de)+_0x278420+_0xd8fd89(0x207)+_0xd8fd89(0x1a1),{'parse_mode':_0xd8fd89(0x1bc)});}catch(_0x276795){console[_0xd8fd89(0x1f7)]('Error\x20handling\x20/disconnect\x20command:',_0x276795),await this[_0xd8fd89(0x185)]?.['sendMessage'](_0xf7050a,_0xd8fd89(0x220));}}),this[_0x56401d(0x185)][_0x56401d(0x236)](/\/status/,async _0x452f31=>{const _0xfc040e=_0x56401d,_0x46790c=_0x452f31[_0xfc040e(0x206)]['id'],_0x5beb96=_0x452f31[_0xfc040e(0x22a)]?.['id'][_0xfc040e(0x19f)]();if(!_0x5beb96)return;try{const _0x4dab66=await database_1[_0xfc040e(0x246)][_0xfc040e(0x1c8)][_0xfc040e(0x21c)]({'where':{'telegramId':_0x5beb96},'include':{'shop':!![]}});if(!_0x4dab66){await this[_0xfc040e(0x185)]?.[_0xfc040e(0x1ae)](_0x46790c,_0xfc040e(0x1a7)+_0xfc040e(0x1ab));return;}if(!_0x4dab66[_0xfc040e(0x205)]||!_0x4dab66[_0xfc040e(0x1fd)]||!_0x4dab66[_0xfc040e(0x18a)]){await this['bot']?.[_0xfc040e(0x1ae)](_0x46790c,_0xfc040e(0x177)+'Use\x20/start\x20to\x20connect.');return;}await this[_0xfc040e(0x185)]?.[_0xfc040e(0x1ae)](_0x46790c,_0xfc040e(0x242)+(_0xfc040e(0x213)+_0x4dab66[_0xfc040e(0x18a)]['name']+'*\x0a')+(_0xfc040e(0x230)+_0x4dab66[_0xfc040e(0x18a)][_0xfc040e(0x197)]+'`\x0a')+(_0xfc040e(0x256)+_0x4dab66[_0xfc040e(0x1a4)][_0xfc040e(0x1bf)](_0xfc040e(0x1cf))+'\x0a\x0a')+_0xfc040e(0x1ca)+_0xfc040e(0x181)+_0xfc040e(0x1be),{'parse_mode':_0xfc040e(0x1bc)});}catch(_0x1309b7){console[_0xfc040e(0x1f7)](_0xfc040e(0x18d),_0x1309b7),await this['bot']?.[_0xfc040e(0x1ae)](_0x46790c,_0xfc040e(0x220));}}),this['bot'][_0x56401d(0x236)](/\/debug/,async _0x1897ae=>{const _0x49f971=_0x56401d,_0x2ecf68=_0x1897ae[_0x49f971(0x206)]['id'],_0x3c5170=_0x1897ae['from']?.['id'][_0x49f971(0x19f)]();if(!_0x3c5170)return;try{const _0xf0ca5c=await database_1[_0x49f971(0x246)][_0x49f971(0x18a)][_0x49f971(0x1c0)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x447b02='🔍\x20*Debug\x20Information*\x0a\x0a';_0x447b02+=_0x49f971(0x184)+_0x3c5170+_0x49f971(0x1c5),_0x447b02+=_0x49f971(0x1fc),_0xf0ca5c[_0x49f971(0x1df)]((_0x232805,_0x4cdfb0)=>{const _0x38db38=_0x49f971;_0x447b02+=_0x4cdfb0+0x1+'.\x20*'+_0x232805['name']+'*\x0a',_0x447b02+=_0x38db38(0x1ed)+_0x232805[_0x38db38(0x197)]+'`\x0a',_0x447b02+=_0x38db38(0x222)+_0x232805[_0x38db38(0x1f9)]+'\x0a',_0x447b02+=_0x38db38(0x212)+_0x232805[_0x38db38(0x1dc)][_0x38db38(0x17f)](0x0,0xf)+_0x38db38(0x243);}),await this[_0x49f971(0x185)]?.[_0x49f971(0x1ae)](_0x2ecf68,_0x447b02,{'parse_mode':_0x49f971(0x1bc)});}catch(_0x2a9dc5){console[_0x49f971(0x1f7)](_0x49f971(0x189),_0x2a9dc5),await this['bot']?.[_0x49f971(0x1ae)](_0x2ecf68,'❌\x20Error\x20getting\x20debug\x20information.');}}),this[_0x56401d(0x185)]['on'](_0x56401d(0x1e4),async _0x4f32e2=>{const _0x13d0c4=_0x56401d;if(_0x4f32e2[_0x13d0c4(0x251)]?.[_0x13d0c4(0x225)]('/'))return;const _0x58ccfc=_0x4f32e2['chat']['id'],_0x17a45c=_0x4f32e2[_0x13d0c4(0x22a)]?.['id'][_0x13d0c4(0x19f)](),_0xa77f8f=_0x4f32e2['text']?.[_0x13d0c4(0x248)]();if(!_0x17a45c||!_0xa77f8f)return;try{const _0x438dea=await database_1[_0x13d0c4(0x246)][_0x13d0c4(0x1c8)][_0x13d0c4(0x21c)]({'where':{'telegramId':_0x17a45c},'include':{'shop':!![]}});if(!_0x438dea){await this[_0x13d0c4(0x185)]?.['sendMessage'](_0x58ccfc,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x438dea[_0x13d0c4(0x205)]&&_0x438dea['shopId']&&_0x438dea[_0x13d0c4(0x18a)]){await this[_0x13d0c4(0x185)]?.['sendMessage'](_0x58ccfc,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x438dea[_0x13d0c4(0x18a)]['name']+_0x13d0c4(0x207)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x13d0c4(0x1bc)});return;}const _0x33b666=_0xa77f8f[_0x13d0c4(0x1ce)](/\s+/);if(_0x33b666[_0x13d0c4(0x1c2)]!==0x2){await this[_0x13d0c4(0x185)]?.[_0x13d0c4(0x1ae)](_0x58ccfc,_0x13d0c4(0x175)+_0x13d0c4(0x173)+_0x13d0c4(0x1e1)+_0x13d0c4(0x21e)+(_0x13d0c4(0x1b2)+_0x33b666[_0x13d0c4(0x1c2)]+_0x13d0c4(0x24f)+_0x33b666[_0x13d0c4(0x224)](_0x1e4bdf=>'`'+_0x1e4bdf+'`')[_0x13d0c4(0x22f)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x5b2f32,_0x31cf2c]=_0x33b666;console[_0x13d0c4(0x182)](_0x13d0c4(0x18e)+_0x17a45c+_0x13d0c4(0x196)+_0x5b2f32+'\x22,\x20apiKey=\x22'+_0x31cf2c[_0x13d0c4(0x17f)](0x0,0xa)+_0x13d0c4(0x179)),await this['handleSingleLineVerification'](_0x58ccfc,_0x17a45c,_0x5b2f32,_0x31cf2c);}catch(_0x1d33cf){console[_0x13d0c4(0x1f7)](_0x13d0c4(0x254),_0x1d33cf),await this[_0x13d0c4(0x185)]?.[_0x13d0c4(0x1ae)](_0x58ccfc,_0x13d0c4(0x220));}}),this['bot']['on'](_0x56401d(0x1f7),_0x2a5108=>{const _0x3d52bf=_0x56401d;console[_0x3d52bf(0x1f7)](_0x3d52bf(0x19b),_0x2a5108);}),this[_0x56401d(0x185)]['on']('polling_error',_0x94fd74=>{const _0x408f1d=_0x56401d;console[_0x408f1d(0x1f7)](_0x408f1d(0x1e9),_0x94fd74);});}async[a55_0x3b9791(0x1d3)](_0x540f67,_0x5b79ab,_0x4f3f7b,_0x3854cd){const _0x12224a=a55_0x3b9791;try{console[_0x12224a(0x182)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x5b79ab+_0x12224a(0x196)+_0x4f3f7b+_0x12224a(0x178)+_0x3854cd[_0x12224a(0x17f)](0x0,0xa)+_0x12224a(0x179));if(!_0x4f3f7b||_0x4f3f7b[_0x12224a(0x1c2)]<0x3||_0x4f3f7b[_0x12224a(0x1c2)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x12224a(0x187)](_0x4f3f7b)){await this[_0x12224a(0x185)]?.[_0x12224a(0x1ae)](_0x540f67,_0x12224a(0x1b9)+_0x4f3f7b+_0x12224a(0x1c5)+_0x12224a(0x18f),{'parse_mode':'Markdown'});return;}if(!_0x3854cd||!_0x3854cd['startsWith'](_0x12224a(0x218))&&!_0x3854cd[_0x12224a(0x225)]('sk_')){await this[_0x12224a(0x185)]?.[_0x12224a(0x1ae)](_0x540f67,_0x12224a(0x1d4)+_0x12224a(0x1f4),{'parse_mode':_0x12224a(0x1bc)});return;}const _0x28a3f8=await database_1[_0x12224a(0x246)][_0x12224a(0x18a)][_0x12224a(0x21c)]({'where':{'username':_0x4f3f7b},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x28a3f8){const _0x1a3ad1=await database_1[_0x12224a(0x246)]['shop'][_0x12224a(0x1c0)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x331e25=_0x12224a(0x204)+_0x4f3f7b+_0x12224a(0x244);_0x1a3ad1[_0x12224a(0x1c2)]>0x0?(_0x331e25+=_0x12224a(0x227),_0x1a3ad1[_0x12224a(0x1df)](_0x1aa4b8=>{const _0x13d5fe=_0x12224a;_0x331e25+='•\x20`'+_0x1aa4b8[_0x13d5fe(0x197)]+'`\x20('+_0x1aa4b8[_0x13d5fe(0x22b)]+')\x0a';}),_0x331e25+=_0x12224a(0x210)):_0x331e25+=_0x12224a(0x208);await this[_0x12224a(0x185)]?.['sendMessage'](_0x540f67,_0x331e25,{'parse_mode':'Markdown'});return;}if(_0x28a3f8['status']!==_0x12224a(0x1f6)){await this['bot']?.['sendMessage'](_0x540f67,_0x12224a(0x1af)+_0x4f3f7b+_0x12224a(0x22c)+_0x12224a(0x191),{'parse_mode':_0x12224a(0x1bc)});return;}if(_0x28a3f8[_0x12224a(0x1dc)]!==_0x3854cd&&_0x28a3f8[_0x12224a(0x23c)]!==_0x3854cd){await this[_0x12224a(0x185)]?.[_0x12224a(0x1ae)](_0x540f67,_0x12224a(0x237)+_0x4f3f7b+'`.\x0a\x0a'+_0x12224a(0x249)+_0x12224a(0x1d0),{'parse_mode':'Markdown'});return;}const _0x497f41=await database_1['default'][_0x12224a(0x1c8)][_0x12224a(0x170)]({'where':{'shopId':_0x28a3f8['id'],'isVerified':!![],'telegramId':{'not':_0x5b79ab}}});if(_0x497f41){await this[_0x12224a(0x185)]?.['sendMessage'](_0x540f67,_0x12224a(0x18c)+_0x4f3f7b+_0x12224a(0x1d1)+_0x12224a(0x180),{'parse_mode':_0x12224a(0x1bc)});return;}await database_1[_0x12224a(0x246)][_0x12224a(0x1c8)][_0x12224a(0x233)]({'where':{'telegramId':_0x5b79ab},'data':{'shopId':_0x28a3f8['id'],'isVerified':!![]}}),await this[_0x12224a(0x185)]?.[_0x12224a(0x1ae)](_0x540f67,_0x12224a(0x1d5)+_0x12224a(0x195)+(_0x12224a(0x24e)+_0x28a3f8['name']+'*\x0a')+(_0x12224a(0x230)+_0x28a3f8[_0x12224a(0x197)]+_0x12224a(0x1c5))+_0x12224a(0x240)+_0x12224a(0x1b1)+_0x12224a(0x17e)+'•\x20Payouts\x0a'+'•\x20Important\x20events\x0a\x0a'+_0x12224a(0x181)+'/status\x20-\x20check\x20connection\x20status\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x12224a(0x1bc)}),console[_0x12224a(0x182)](_0x12224a(0x1b7)+_0x5b79ab+_0x12224a(0x19d)+_0x28a3f8[_0x12224a(0x197)]+_0x12224a(0x1d6));}catch(_0x15854a){console[_0x12224a(0x1f7)]('Error\x20in\x20handleSingleLineVerification:',_0x15854a),await this[_0x12224a(0x185)]?.[_0x12224a(0x1ae)](_0x540f67,_0x12224a(0x1cb));}}async[a55_0x3b9791(0x20c)](_0x3d2078,_0x222406,_0x128aa8){const _0x88e58a=a55_0x3b9791;if(!this[_0x88e58a(0x185)]){console[_0x88e58a(0x1ee)](_0x88e58a(0x19e));return;}try{const _0x463f4c=await database_1['default'][_0x88e58a(0x1c8)][_0x88e58a(0x1c0)]({'where':{'shopId':_0x3d2078,'isVerified':!![]}});if(_0x463f4c['length']===0x0){console['log'](_0x88e58a(0x1fe)+_0x3d2078);return;}const _0x2d79d6=_0x463f4c[_0x88e58a(0x224)](async _0x397c84=>{const _0x227be9=_0x88e58a;try{await this['bot']?.[_0x227be9(0x1ae)](_0x397c84[_0x227be9(0x252)],_0x222406,_0x128aa8),console[_0x227be9(0x182)](_0x227be9(0x21d)+_0x397c84[_0x227be9(0x252)]);}catch(_0x32a10e){console[_0x227be9(0x1f7)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x397c84[_0x227be9(0x252)]+':',_0x32a10e),_0x32a10e instanceof Error&&(_0x32a10e[_0x227be9(0x1e4)][_0x227be9(0x1cc)]('blocked')||_0x32a10e[_0x227be9(0x1e4)]['includes']('chat\x20not\x20found')||_0x32a10e['message'][_0x227be9(0x1cc)](_0x227be9(0x23b)))&&(await database_1[_0x227be9(0x246)][_0x227be9(0x1c8)][_0x227be9(0x233)]({'where':{'id':_0x397c84['id']},'data':{'isVerified':![]}}),console[_0x227be9(0x182)](_0x227be9(0x17b)+_0x397c84[_0x227be9(0x252)]+_0x227be9(0x23a)));}});await Promise[_0x88e58a(0x1e2)](_0x2d79d6);}catch(_0xa3f687){console[_0x88e58a(0x1f7)]('Error\x20sending\x20shop\x20notification:',_0xa3f687);}}async[a55_0x3b9791(0x1c1)](_0x17f608,_0x20f0d0,_0x2083fd){const _0x3d7422=a55_0x3b9791,_0xd23580={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x2ad403={'created':_0x3d7422(0x216),'paid':'Payment\x20successfully\x20paid','failed':_0x3d7422(0x1c7),'expired':_0x3d7422(0x17a),'refund':'Payment\x20refund','chargeback':'Payment\x20chargeback','processing':_0x3d7422(0x19a)},_0x226f4a=_0xd23580[_0x2083fd],_0x111ca5=_0x2ad403[_0x2083fd],_0x1122e7=(0x0,gateway_1[_0x3d7422(0x1bd)])(_0x20f0d0[_0x3d7422(0x1c6)]);console[_0x3d7422(0x182)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x20f0d0['gateway']+'\x22\x20->\x20display\x20\x22'+_0x1122e7+'\x22');let _0x3c6866=_0x226f4a+'\x20*'+_0x111ca5+_0x3d7422(0x1e7)+(_0x3d7422(0x250)+_0x20f0d0[_0x3d7422(0x200)]+'\x20'+_0x20f0d0[_0x3d7422(0x199)]+'*\x0a')+(_0x3d7422(0x1f2)+(_0x20f0d0[_0x3d7422(0x22e)]||_0x20f0d0['id'])+'`\x0a')+(_0x3d7422(0x1fb)+_0x20f0d0['id']+'`\x0a')+(_0x3d7422(0x1fa)+_0x1122e7+'`\x0a')+(_0x3d7422(0x1a8)+new Date(_0x20f0d0[_0x3d7422(0x255)])[_0x3d7422(0x1b8)](_0x3d7422(0x1cf))+'\x0a');if(_0x20f0d0[_0x3d7422(0x198)]||_0x20f0d0['customerEmail']||_0x20f0d0[_0x3d7422(0x217)]||_0x20f0d0[_0x3d7422(0x1ff)]||_0x20f0d0[_0x3d7422(0x1a9)]){_0x3c6866+=_0x3d7422(0x1c3);_0x20f0d0['customerName']&&(_0x3c6866+=_0x3d7422(0x21f)+_0x20f0d0['customerName']+'`\x0a');_0x20f0d0[_0x3d7422(0x226)]&&(_0x3c6866+=_0x3d7422(0x1ac)+_0x20f0d0[_0x3d7422(0x226)]+'`\x0a');_0x20f0d0[_0x3d7422(0x217)]&&(_0x3c6866+='🏦\x20IBAN:\x20`'+_0x20f0d0[_0x3d7422(0x217)]+'`\x0a');_0x20f0d0['customerIp']&&(_0x3c6866+=_0x3d7422(0x1cd)+_0x20f0d0[_0x3d7422(0x1ff)]+'`\x0a');if(_0x20f0d0['customerUa']){const _0x1720a1=_0x20f0d0['customerUa'][_0x3d7422(0x1c2)]>0x32?_0x20f0d0[_0x3d7422(0x1a9)][_0x3d7422(0x17f)](0x0,0x32)+_0x3d7422(0x219):_0x20f0d0[_0x3d7422(0x1a9)];_0x3c6866+=_0x3d7422(0x21b)+_0x1720a1+'`\x0a';}}_0x2083fd===_0x3d7422(0x1e8)&&_0x20f0d0['chargebackAmount']&&(_0x3c6866+=_0x3d7422(0x1eb)+_0x20f0d0[_0x3d7422(0x223)]+_0x3d7422(0x214)),_0x2083fd==='processing'&&(_0x3c6866+=_0x3d7422(0x1d2)),_0x20f0d0[_0x3d7422(0x190)]&&(_0x3c6866+=_0x3d7422(0x1c4)+_0x20f0d0[_0x3d7422(0x190)]+'\x0a'),await this[_0x3d7422(0x20c)](_0x17f608,_0x3c6866,{'parse_mode':_0x3d7422(0x1bc)});}async[a55_0x3b9791(0x203)](_0x2cf960,_0x4d9878,_0x3071aa){const _0x3eddc7=a55_0x3b9791,_0x1beb49={'created':'📤','completed':'✅','rejected':'❌'},_0x16ade6={'created':_0x3eddc7(0x1ad),'completed':_0x3eddc7(0x17c),'rejected':_0x3eddc7(0x1a2)},_0x3794dd=_0x1beb49[_0x3071aa],_0x1f3aa2=_0x16ade6[_0x3071aa],_0x38b309=_0x3794dd+'\x20*'+_0x1f3aa2+_0x3eddc7(0x1e7)+('💸\x20Amount:\x20*'+_0x4d9878['amount']+_0x3eddc7(0x188))+(_0x3eddc7(0x18b)+_0x4d9878[_0x3eddc7(0x171)]+'`\x0a')+(_0x3eddc7(0x194)+_0x4d9878['id']+'`\x0a')+(_0x3eddc7(0x1a8)+new Date(_0x4d9878[_0x3eddc7(0x255)])[_0x3eddc7(0x1b8)](_0x3eddc7(0x1cf))+'\x0a')+(_0x4d9878[_0x3eddc7(0x201)]?_0x3eddc7(0x1f8)+_0x4d9878[_0x3eddc7(0x201)]+'`':'');await this[_0x3eddc7(0x20c)](_0x2cf960,_0x38b309,{'parse_mode':_0x3eddc7(0x1bc)});}async['sendLoginNotification'](_0x251155,_0x4b82a4){const _0x3461b6=a55_0x3b9791;try{const _0x3b1579=await database_1['default'][_0x3461b6(0x20b)][_0x3461b6(0x21c)]({'where':{'shopId':_0x251155},'select':{'notificationLogin':!![]}});if(!_0x3b1579?.[_0x3461b6(0x1e5)]){console[_0x3461b6(0x182)](_0x3461b6(0x1ea)+_0x251155);return;}const _0x2c05e1=_0x4b82a4[_0x3461b6(0x221)]?'🔐':'🚨',_0x5a4fb2=_0x4b82a4[_0x3461b6(0x221)]?_0x3461b6(0x1f3):_0x3461b6(0x174);let _0x4c7544=_0x2c05e1+'\x20*'+_0x5a4fb2+'*\x0a\x0a'+(_0x3461b6(0x230)+_0x4b82a4[_0x3461b6(0x197)]+'`\x0a')+('📅\x20Time:\x20'+_0x4b82a4[_0x3461b6(0x20f)]['toLocaleString']('en-US')+'\x0a');_0x4b82a4[_0x3461b6(0x1f1)]&&(_0x4c7544+=_0x3461b6(0x24b)+_0x4b82a4['ipAddress']+'`\x0a');if(_0x4b82a4[_0x3461b6(0x22d)]){const _0x81bb58=_0x4b82a4[_0x3461b6(0x22d)][_0x3461b6(0x1c2)]>0x32?_0x4b82a4[_0x3461b6(0x22d)][_0x3461b6(0x17f)](0x0,0x32)+_0x3461b6(0x219):_0x4b82a4[_0x3461b6(0x22d)];_0x4c7544+=_0x3461b6(0x21b)+_0x81bb58+'`\x0a';}!_0x4b82a4[_0x3461b6(0x221)]&&(_0x4c7544+=_0x3461b6(0x239)),await this[_0x3461b6(0x20c)](_0x251155,_0x4c7544,{'parse_mode':_0x3461b6(0x1bc)}),console['log'](_0x3461b6(0x1b0)+_0x251155+':\x20'+(_0x4b82a4['success']?_0x3461b6(0x221):'failed'));}catch(_0x3906b4){console[_0x3461b6(0x1f7)](_0x3461b6(0x1ba),_0x3906b4);}}async[a55_0x3b9791(0x1bb)](_0xb9a869,_0x37646b){const _0x4de8fb=a55_0x3b9791;try{const _0x66913=await database_1['default']['shopSettings'][_0x4de8fb(0x21c)]({'where':{'shopId':_0xb9a869},'select':{'notificationApiError':!![]}});if(!_0x66913?.[_0x4de8fb(0x186)]){console['log']('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0xb9a869);return;}let _0x3fd98a='🚨\x20*API\x20Error*\x0a\x0a'+(_0x4de8fb(0x1ec)+_0x37646b['method']+'\x20'+_0x37646b[_0x4de8fb(0x1b5)]+'`\x0a')+(_0x4de8fb(0x245)+_0x37646b[_0x4de8fb(0x20f)][_0x4de8fb(0x1b8)](_0x4de8fb(0x1cf))+'\x0a');_0x37646b[_0x4de8fb(0x1b3)]&&(_0x3fd98a+=_0x4de8fb(0x1a5)+_0x37646b['statusCode']+'`\x0a'),_0x3fd98a+=_0x4de8fb(0x232)+_0x37646b[_0x4de8fb(0x1c9)]+'`\x0a',_0x37646b['requestId']&&(_0x3fd98a+=_0x4de8fb(0x20d)+_0x37646b['requestId']+'`\x0a'),_0x3fd98a+=_0x4de8fb(0x20e),await this[_0x4de8fb(0x20c)](_0xb9a869,_0x3fd98a,{'parse_mode':_0x4de8fb(0x1bc)}),console[_0x4de8fb(0x182)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0xb9a869+':\x20'+_0x37646b[_0x4de8fb(0x1b5)]);}catch(_0x2c2211){console[_0x4de8fb(0x1f7)](_0x4de8fb(0x1d9),_0x2c2211);}}async[a55_0x3b9791(0x1b6)](_0x137e90,_0x455f8e,_0x530c2e){const _0x21a2a4=a55_0x3b9791;let _0x5b970c=_0x21a2a4(0x1f5)+_0x455f8e+_0x21a2a4(0x1e7);for(const [_0x28d848,_0x1a029c]of Object[_0x21a2a4(0x1a6)](_0x530c2e)){_0x1a029c!==null&&_0x1a029c!==undefined&&(_0x5b970c+=_0x28d848+_0x21a2a4(0x19c)+_0x1a029c+'`\x0a');}await this[_0x21a2a4(0x20c)](_0x137e90,_0x5b970c,{'parse_mode':_0x21a2a4(0x1bc)});}[a55_0x3b9791(0x172)](){const _0x39a106=a55_0x3b9791;return{'isActive':!!this[_0x39a106(0x185)],'username':this[_0x39a106(0x1b4)]};}[a55_0x3b9791(0x183)](){const _0x32abb9=a55_0x3b9791;this[_0x32abb9(0x185)]&&(this['bot']['stopPolling'](),this[_0x32abb9(0x185)]=null,console[_0x32abb9(0x182)]('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a55_0x3b9791(0x21a)]=TelegramBotService,exports[a55_0x3b9791(0x24a)]=new TelegramBotService();