'use strict';const a54_0x332f0c=a54_0x2cbd;function a54_0x2cbd(_0x3c111e,_0x32d34b){const _0x179c2a=a54_0x179c();return a54_0x2cbd=function(_0x2cbd91,_0x5bdc86){_0x2cbd91=_0x2cbd91-0x9a;let _0x4da709=_0x179c2a[_0x2cbd91];return _0x4da709;},a54_0x2cbd(_0x3c111e,_0x32d34b);}(function(_0x3a45b6,_0x267256){const _0x5a4eb0=a54_0x2cbd,_0x3e52e0=_0x3a45b6();while(!![]){try{const _0xeddee2=parseInt(_0x5a4eb0(0x165))/0x1+parseInt(_0x5a4eb0(0xd9))/0x2+parseInt(_0x5a4eb0(0x9a))/0x3+-parseInt(_0x5a4eb0(0x122))/0x4+-parseInt(_0x5a4eb0(0xb5))/0x5+parseInt(_0x5a4eb0(0x15a))/0x6*(-parseInt(_0x5a4eb0(0x16e))/0x7)+parseInt(_0x5a4eb0(0xca))/0x8;if(_0xeddee2===_0x267256)break;else _0x3e52e0['push'](_0x3e52e0['shift']());}catch(_0x4945f9){_0x3e52e0['push'](_0x3e52e0['shift']());}}}(a54_0x179c,0xa200f));var __importDefault=this&&this['__importDefault']||function(_0x290a16){const _0x12d64d=a54_0x2cbd;return _0x290a16&&_0x290a16[_0x12d64d(0x139)]?_0x290a16:{'default':_0x290a16};};Object[a54_0x332f0c(0x186)](exports,a54_0x332f0c(0x139),{'value':!![]}),exports['telegramBotService']=exports[a54_0x332f0c(0x181)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x332f0c(0x192))),database_1=__importDefault(require(a54_0x332f0c(0x170))),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x4e3cf1=a54_0x332f0c;this[_0x4e3cf1(0xc5)]=null,this[_0x4e3cf1(0xf2)]=process[_0x4e3cf1(0x168)][_0x4e3cf1(0x115)]||'',this['botUsername']=process[_0x4e3cf1(0x168)][_0x4e3cf1(0x111)]||_0x4e3cf1(0xe1),this['botToken']?this[_0x4e3cf1(0x15c)]():console['warn']('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}['initializeBot'](){const _0x2f4bb8=a54_0x332f0c;try{this[_0x2f4bb8(0xc5)]=new node_telegram_bot_api_1[(_0x2f4bb8(0xb8))](this[_0x2f4bb8(0xf2)],{'polling':!![]}),this[_0x2f4bb8(0x10a)](),console[_0x2f4bb8(0x10f)](_0x2f4bb8(0x10b)+this[_0x2f4bb8(0x185)]+_0x2f4bb8(0x157));}catch(_0x5750f7){console[_0x2f4bb8(0x18f)](_0x2f4bb8(0x127),_0x5750f7);}}[a54_0x332f0c(0x10a)](){const _0x1984a9=a54_0x332f0c;if(!this[_0x1984a9(0xc5)])return;this['bot']['onText'](/\/start/,async _0x4e4ce9=>{const _0x5449d1=_0x1984a9,_0x2ab650=_0x4e4ce9['chat']['id'],_0x1991a8=_0x4e4ce9[_0x5449d1(0xaa)]?.['id']['toString'](),_0x14fbef=_0x4e4ce9['from']?.['username'],_0x5c7554=_0x4e4ce9['from']?.[_0x5449d1(0x12a)],_0x5cfe49=_0x4e4ce9[_0x5449d1(0xaa)]?.[_0x5449d1(0xfd)];if(!_0x1991a8)return;try{let _0x5858e8=await database_1[_0x5449d1(0xb8)]['telegramUser'][_0x5449d1(0x11f)]({'where':{'telegramId':_0x1991a8},'include':{'shop':!![]}});!_0x5858e8?(_0x5858e8=await database_1['default']['telegramUser'][_0x5449d1(0xb2)]({'data':{'telegramId':_0x1991a8,'username':_0x14fbef,'firstName':_0x5c7554,'lastName':_0x5cfe49,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x5449d1(0xa4)+_0x1991a8+_0x5449d1(0x109)+_0x14fbef+')')):_0x5858e8=await database_1[_0x5449d1(0xb8)][_0x5449d1(0x12e)]['update']({'where':{'telegramId':_0x1991a8},'data':{'username':_0x14fbef,'firstName':_0x5c7554,'lastName':_0x5cfe49},'include':{'shop':!![]}}),_0x5858e8[_0x5449d1(0x152)]&&_0x5858e8[_0x5449d1(0xda)]&&_0x5858e8[_0x5449d1(0x117)]?await this[_0x5449d1(0xc5)]?.['sendMessage'](_0x2ab650,_0x5449d1(0xb1)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x5858e8[_0x5449d1(0x117)]['name']+'*\x0a')+(_0x5449d1(0x14a)+_0x5858e8[_0x5449d1(0x117)][_0x5449d1(0xe3)]+_0x5449d1(0x187))+_0x5449d1(0x13b)+'•\x20New\x20payments\x0a'+_0x5449d1(0x16d)+_0x5449d1(0x176)+'Commands:\x0a'+_0x5449d1(0x124)+_0x5449d1(0xff),{'parse_mode':_0x5449d1(0x145)}):(_0x5858e8[_0x5449d1(0xda)]&&!_0x5858e8[_0x5449d1(0x152)]&&(await database_1[_0x5449d1(0xb8)]['telegramUser'][_0x5449d1(0xd2)]({'where':{'telegramId':_0x1991a8},'data':{'shopId':null,'isVerified':![]}}),console[_0x5449d1(0x10f)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x1991a8)),await this[_0x5449d1(0xc5)]?.[_0x5449d1(0x182)](_0x2ab650,_0x5449d1(0xd5)+_0x5449d1(0xd3)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x5449d1(0x116)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x5449d1(0x175),{'parse_mode':_0x5449d1(0x145)}));}catch(_0x13bbbd){console['error']('Error\x20handling\x20/start\x20command:',_0x13bbbd),await this[_0x5449d1(0xc5)]?.[_0x5449d1(0x182)](_0x2ab650,_0x5449d1(0x166));}}),this['bot'][_0x1984a9(0xd4)](/\/disconnect/,async _0x206652=>{const _0x2527ba=_0x1984a9,_0x209240=_0x206652[_0x2527ba(0xc7)]['id'],_0x58ccc6=_0x206652[_0x2527ba(0xaa)]?.['id'][_0x2527ba(0xae)]();if(!_0x58ccc6)return;try{const _0x5b5d59=await database_1[_0x2527ba(0xb8)][_0x2527ba(0x12e)]['findUnique']({'where':{'telegramId':_0x58ccc6},'include':{'shop':!![]}});if(!_0x5b5d59||!_0x5b5d59[_0x2527ba(0x152)]||!_0x5b5d59[_0x2527ba(0xda)]){await this[_0x2527ba(0xc5)]?.[_0x2527ba(0x182)](_0x209240,_0x2527ba(0x177));return;}const _0x1a19d3=_0x5b5d59[_0x2527ba(0x117)]?.[_0x2527ba(0x100)]||_0x2527ba(0xa9);await database_1['default'][_0x2527ba(0x12e)]['update']({'where':{'telegramId':_0x58ccc6},'data':{'shopId':null,'isVerified':![]}}),console[_0x2527ba(0x10f)](_0x2527ba(0x9f)+_0x58ccc6+'\x20disconnected\x20from\x20shop\x20'+_0x5b5d59[_0x2527ba(0xda)]),await this['bot']?.[_0x2527ba(0x182)](_0x209240,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x1a19d3+_0x2527ba(0x18a)+_0x2527ba(0xc2),{'parse_mode':_0x2527ba(0x145)});}catch(_0x2d6f86){console[_0x2527ba(0x18f)](_0x2527ba(0x163),_0x2d6f86),await this[_0x2527ba(0xc5)]?.[_0x2527ba(0x182)](_0x209240,_0x2527ba(0x166));}}),this[_0x1984a9(0xc5)]['onText'](/\/status/,async _0x52c9e8=>{const _0x3d8d89=_0x1984a9,_0x2b903c=_0x52c9e8[_0x3d8d89(0xc7)]['id'],_0x39519e=_0x52c9e8[_0x3d8d89(0xaa)]?.['id'][_0x3d8d89(0xae)]();if(!_0x39519e)return;try{const _0x15b560=await database_1[_0x3d8d89(0xb8)][_0x3d8d89(0x12e)][_0x3d8d89(0x11f)]({'where':{'telegramId':_0x39519e},'include':{'shop':!![]}});if(!_0x15b560){await this[_0x3d8d89(0xc5)]?.[_0x3d8d89(0x182)](_0x2b903c,_0x3d8d89(0x136)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x15b560[_0x3d8d89(0x152)]||!_0x15b560[_0x3d8d89(0xda)]||!_0x15b560[_0x3d8d89(0x117)]){await this[_0x3d8d89(0xc5)]?.[_0x3d8d89(0x182)](_0x2b903c,_0x3d8d89(0x16c)+_0x3d8d89(0x9e));return;}await this[_0x3d8d89(0xc5)]?.[_0x3d8d89(0x182)](_0x2b903c,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x3d8d89(0x193)+_0x15b560[_0x3d8d89(0x117)][_0x3d8d89(0x100)]+'*\x0a')+(_0x3d8d89(0x14d)+_0x15b560['shop'][_0x3d8d89(0xe3)]+'`\x0a')+(_0x3d8d89(0x18e)+_0x15b560[_0x3d8d89(0x161)][_0x3d8d89(0xab)](_0x3d8d89(0x11c))+'\x0a\x0a')+_0x3d8d89(0xcb)+_0x3d8d89(0x9b)+_0x3d8d89(0xff),{'parse_mode':'Markdown'});}catch(_0x204b9b){console[_0x3d8d89(0x18f)](_0x3d8d89(0xbb),_0x204b9b),await this[_0x3d8d89(0xc5)]?.['sendMessage'](_0x2b903c,_0x3d8d89(0x166));}}),this[_0x1984a9(0xc5)][_0x1984a9(0xd4)](/\/debug/,async _0x40ad97=>{const _0x2ebd8f=_0x1984a9,_0x1c7757=_0x40ad97[_0x2ebd8f(0xc7)]['id'],_0x28fa5b=_0x40ad97[_0x2ebd8f(0xaa)]?.['id'][_0x2ebd8f(0xae)]();if(!_0x28fa5b)return;try{const _0x26ad2e=await database_1[_0x2ebd8f(0xb8)]['shop'][_0x2ebd8f(0xfe)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x2ab931='🔍\x20*Debug\x20Information*\x0a\x0a';_0x2ab931+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x28fa5b+_0x2ebd8f(0x187),_0x2ab931+=_0x2ebd8f(0x10d),_0x26ad2e[_0x2ebd8f(0x13d)]((_0x1698f3,_0x1b2a6c)=>{const _0x4bc834=_0x2ebd8f;_0x2ab931+=_0x1b2a6c+0x1+_0x4bc834(0xea)+_0x1698f3[_0x4bc834(0x100)]+'*\x0a',_0x2ab931+='\x20\x20\x20Username:\x20`'+_0x1698f3[_0x4bc834(0xe3)]+'`\x0a',_0x2ab931+='\x20\x20\x20Status:\x20'+_0x1698f3[_0x4bc834(0xa0)]+'\x0a',_0x2ab931+=_0x4bc834(0x125)+_0x1698f3[_0x4bc834(0xec)][_0x4bc834(0x146)](0x0,0xf)+_0x4bc834(0x102);}),await this['bot']?.[_0x2ebd8f(0x182)](_0x1c7757,_0x2ab931,{'parse_mode':'Markdown'});}catch(_0x5c9066){console['error'](_0x2ebd8f(0xef),_0x5c9066),await this[_0x2ebd8f(0xc5)]?.[_0x2ebd8f(0x182)](_0x1c7757,_0x2ebd8f(0xb4));}}),this[_0x1984a9(0xc5)]['on']('message',async _0x52e3f8=>{const _0x1cce32=_0x1984a9;if(_0x52e3f8[_0x1cce32(0x110)]?.[_0x1cce32(0x179)]('/'))return;const _0x4768a2=_0x52e3f8['chat']['id'],_0x59558a=_0x52e3f8['from']?.['id'][_0x1cce32(0xae)](),_0x4f4564=_0x52e3f8[_0x1cce32(0x110)]?.[_0x1cce32(0xf1)]();if(!_0x59558a||!_0x4f4564)return;try{const _0x9f45b3=await database_1['default']['telegramUser'][_0x1cce32(0x11f)]({'where':{'telegramId':_0x59558a},'include':{'shop':!![]}});if(!_0x9f45b3){await this[_0x1cce32(0xc5)]?.['sendMessage'](_0x4768a2,_0x1cce32(0x128));return;}if(_0x9f45b3[_0x1cce32(0x152)]&&_0x9f45b3[_0x1cce32(0xda)]&&_0x9f45b3[_0x1cce32(0x117)]){await this[_0x1cce32(0xc5)]?.[_0x1cce32(0x182)](_0x4768a2,_0x1cce32(0x14c)+_0x9f45b3['shop'][_0x1cce32(0x100)]+_0x1cce32(0x18a)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x1cce32(0x145)});return;}const _0x3d79f2=_0x4f4564[_0x1cce32(0x151)](/\s+/);if(_0x3d79f2[_0x1cce32(0x132)]!==0x2){await this[_0x1cce32(0xc5)]?.[_0x1cce32(0x182)](_0x4768a2,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x1cce32(0x15d)+_0x1cce32(0x116)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x1cce32(0xba)+_0x3d79f2[_0x1cce32(0x132)]+_0x1cce32(0xe9)+_0x3d79f2['map'](_0x4792bf=>'`'+_0x4792bf+'`')[_0x1cce32(0x10c)](',\x20')),{'parse_mode':_0x1cce32(0x145)});return;}const [_0x102d9e,_0x443704]=_0x3d79f2;console[_0x1cce32(0x10f)](_0x1cce32(0x10e)+_0x59558a+':\x20username=\x22'+_0x102d9e+_0x1cce32(0xc9)+_0x443704[_0x1cce32(0x146)](0x0,0xa)+'...\x22'),await this['handleSingleLineVerification'](_0x4768a2,_0x59558a,_0x102d9e,_0x443704);}catch(_0x16b73a){console['error'](_0x1cce32(0x14e),_0x16b73a),await this[_0x1cce32(0xc5)]?.[_0x1cce32(0x182)](_0x4768a2,_0x1cce32(0x166));}}),this[_0x1984a9(0xc5)]['on'](_0x1984a9(0x18f),_0x36e7cf=>{const _0x9a55da=_0x1984a9;console[_0x9a55da(0x18f)](_0x9a55da(0xe8),_0x36e7cf);}),this[_0x1984a9(0xc5)]['on']('polling_error',_0x123b24=>{const _0x570e58=_0x1984a9;console[_0x570e58(0x18f)](_0x570e58(0xee),_0x123b24);});}async[a54_0x332f0c(0x164)](_0x540fc2,_0x3f0591,_0x284fc0,_0x456156){const _0x3c6802=a54_0x332f0c;try{console[_0x3c6802(0x10f)](_0x3c6802(0x10e)+_0x3f0591+':\x20username=\x22'+_0x284fc0+'\x22,\x20apiKey=\x22'+_0x456156['substring'](0x0,0xa)+_0x3c6802(0x130));if(!_0x284fc0||_0x284fc0[_0x3c6802(0x132)]<0x3||_0x284fc0[_0x3c6802(0x132)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x3c6802(0x174)](_0x284fc0)){await this[_0x3c6802(0xc5)]?.['sendMessage'](_0x540fc2,_0x3c6802(0x134)+_0x284fc0+_0x3c6802(0x187)+_0x3c6802(0x105),{'parse_mode':_0x3c6802(0x145)});return;}if(!_0x456156||!_0x456156[_0x3c6802(0x179)](_0x3c6802(0x160))&&!_0x456156[_0x3c6802(0x179)](_0x3c6802(0x15e))){await this[_0x3c6802(0xc5)]?.[_0x3c6802(0x182)](_0x540fc2,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x3c6802(0x16a),{'parse_mode':'Markdown'});return;}const _0x110f96=await database_1[_0x3c6802(0xb8)][_0x3c6802(0x117)][_0x3c6802(0x11f)]({'where':{'username':_0x284fc0},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x110f96){const _0x56ac80=await database_1[_0x3c6802(0xb8)][_0x3c6802(0x117)][_0x3c6802(0xfe)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x3b2de8=_0x3c6802(0x106)+_0x284fc0+_0x3c6802(0x112);_0x56ac80[_0x3c6802(0x132)]>0x0?(_0x3b2de8+=_0x3c6802(0x142),_0x56ac80[_0x3c6802(0x13d)](_0x24f3f6=>{const _0x1a9c2a=_0x3c6802;_0x3b2de8+=_0x1a9c2a(0x159)+_0x24f3f6['username']+'`\x20('+_0x24f3f6['name']+')\x0a';}),_0x3b2de8+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x3b2de8+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x3c6802(0xc5)]?.[_0x3c6802(0x182)](_0x540fc2,_0x3b2de8,{'parse_mode':_0x3c6802(0x145)});return;}if(_0x110f96['status']!==_0x3c6802(0x15b)){const _0x12f775=_0x110f96[_0x3c6802(0xa0)]===_0x3c6802(0xf9)?_0x3c6802(0x190)+_0x284fc0+_0x3c6802(0xa2)+'Your\x20account\x20is\x20temporarily\x20suspended.\x20You\x20can\x20view\x20your\x20dashboard\x20but\x20cannot\x20process\x20new\x20payments.\x0a\x0a'+_0x3c6802(0xe5):_0x3c6802(0x172)+_0x284fc0+_0x3c6802(0x119)+_0x3c6802(0xcd);await this[_0x3c6802(0xc5)]?.[_0x3c6802(0x182)](_0x540fc2,_0x12f775,{'parse_mode':'Markdown'});return;}if(_0x110f96[_0x3c6802(0xec)]!==_0x456156&&_0x110f96['secretKey']!==_0x456156){await this[_0x3c6802(0xc5)]?.[_0x3c6802(0x182)](_0x540fc2,_0x3c6802(0x13a)+_0x284fc0+'`.\x0a\x0a'+_0x3c6802(0xd7)+_0x3c6802(0xfa),{'parse_mode':_0x3c6802(0x145)});return;}const _0x3700bb=await database_1[_0x3c6802(0xb8)][_0x3c6802(0x12e)]['findFirst']({'where':{'shopId':_0x110f96['id'],'isVerified':!![],'telegramId':{'not':_0x3f0591}}});if(_0x3700bb){await this[_0x3c6802(0xc5)]?.[_0x3c6802(0x182)](_0x540fc2,_0x3c6802(0x18b)+_0x284fc0+_0x3c6802(0xb0)+_0x3c6802(0xc4),{'parse_mode':'Markdown'});return;}await database_1[_0x3c6802(0xb8)][_0x3c6802(0x12e)]['update']({'where':{'telegramId':_0x3f0591},'data':{'shopId':_0x110f96['id'],'isVerified':!![]}}),await this[_0x3c6802(0xc5)]?.[_0x3c6802(0x182)](_0x540fc2,_0x3c6802(0x154)+_0x3c6802(0x141)+('📱\x20Shop:\x20*'+_0x110f96['name']+'*\x0a')+(_0x3c6802(0x14d)+_0x110f96[_0x3c6802(0xe3)]+'`\x0a\x0a')+_0x3c6802(0x138)+_0x3c6802(0x101)+_0x3c6802(0x16d)+'•\x20Payouts\x0a'+_0x3c6802(0x14f)+_0x3c6802(0x9b)+_0x3c6802(0x124)+_0x3c6802(0xff),{'parse_mode':_0x3c6802(0x145)}),console['log'](_0x3c6802(0x153)+_0x3f0591+_0x3c6802(0xbe)+_0x110f96[_0x3c6802(0xe3)]+_0x3c6802(0x158));}catch(_0x43b3df){console[_0x3c6802(0x18f)](_0x3c6802(0xed),_0x43b3df),await this[_0x3c6802(0xc5)]?.[_0x3c6802(0x182)](_0x540fc2,_0x3c6802(0x121));}}async[a54_0x332f0c(0x135)](_0x2981e9,_0x5dfa56,_0x2e8d21){const _0x4a0b70=a54_0x332f0c;if(!this[_0x4a0b70(0xc5)]){console[_0x4a0b70(0x17c)](_0x4a0b70(0xd8));return;}try{const _0x386a5f=await database_1['default'][_0x4a0b70(0x12e)][_0x4a0b70(0xfe)]({'where':{'shopId':_0x2981e9,'isVerified':!![]}});if(_0x386a5f[_0x4a0b70(0x132)]===0x0){console[_0x4a0b70(0x10f)](_0x4a0b70(0xa1)+_0x2981e9);return;}const _0x58c4f5=_0x386a5f['map'](async _0x2cef32=>{const _0x59aa7d=_0x4a0b70;try{await this[_0x59aa7d(0xc5)]?.[_0x59aa7d(0x182)](_0x2cef32[_0x59aa7d(0xfc)],_0x5dfa56,_0x2e8d21),console[_0x59aa7d(0x10f)](_0x59aa7d(0x14b)+_0x2cef32[_0x59aa7d(0xfc)]);}catch(_0xc5322){console['error'](_0x59aa7d(0x12c)+_0x2cef32[_0x59aa7d(0xfc)]+':',_0xc5322),_0xc5322 instanceof Error&&(_0xc5322[_0x59aa7d(0xc6)][_0x59aa7d(0x167)]('blocked')||_0xc5322['message']['includes']('chat\x20not\x20found')||_0xc5322[_0x59aa7d(0xc6)][_0x59aa7d(0x167)](_0x59aa7d(0x9d)))&&(await database_1[_0x59aa7d(0xb8)][_0x59aa7d(0x12e)][_0x59aa7d(0xd2)]({'where':{'id':_0x2cef32['id']},'data':{'isVerified':![]}}),console[_0x59aa7d(0x10f)](_0x59aa7d(0x17e)+_0x2cef32[_0x59aa7d(0xfc)]+_0x59aa7d(0xf0)));}});await Promise[_0x4a0b70(0x11a)](_0x58c4f5);}catch(_0x3ea793){console[_0x4a0b70(0x18f)](_0x4a0b70(0xdc),_0x3ea793);}}async['sendPaymentNotification'](_0x34bb32,_0x3027cf,_0x36e18e){const _0x457e92=a54_0x332f0c,_0x4db5a6={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x2a40fd={'created':_0x457e92(0x184),'paid':_0x457e92(0xeb),'failed':_0x457e92(0xad),'expired':_0x457e92(0x13f),'refund':_0x457e92(0xb3),'chargeback':_0x457e92(0x162),'processing':_0x457e92(0x156)},_0x289d2a=_0x4db5a6[_0x36e18e],_0x2680b4=_0x2a40fd[_0x36e18e],_0x32c4e7=(0x0,gateway_1[_0x457e92(0xbc)])(_0x3027cf['gateway']);console[_0x457e92(0x10f)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x3027cf[_0x457e92(0xf6)]+_0x457e92(0x13c)+_0x32c4e7+'\x22');let _0x2cd841=_0x289d2a+'\x20*'+_0x2680b4+_0x457e92(0xdf)+(_0x457e92(0x13e)+_0x3027cf[_0x457e92(0xd1)]+'\x20'+_0x3027cf[_0x457e92(0xe0)]+'*\x0a')+(_0x457e92(0x173)+(_0x3027cf[_0x457e92(0x147)]||_0x3027cf['id'])+'`\x0a')+(_0x457e92(0x18c)+_0x3027cf['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x32c4e7+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x3027cf[_0x457e92(0x133)])['toLocaleString'](_0x457e92(0x11c))+'\x0a');(_0x3027cf[_0x457e92(0x18d)]||_0x3027cf[_0x457e92(0xb7)]||_0x3027cf[_0x457e92(0xa3)]||_0x3027cf[_0x457e92(0xc3)])&&(_0x2cd841+=_0x457e92(0xf3),_0x3027cf['customerName']&&(_0x2cd841+=_0x457e92(0x155)+_0x3027cf[_0x457e92(0x18d)]+'`\x0a'),_0x3027cf['customerEmail']&&(_0x2cd841+=_0x457e92(0xb6)+_0x3027cf[_0x457e92(0xb7)]+'`\x0a'),_0x3027cf[_0x457e92(0xa3)]&&(_0x2cd841+='🌐\x20IP:\x20`'+_0x3027cf[_0x457e92(0xa3)]+'`\x0a'),_0x3027cf['customerCountry']&&(_0x2cd841+='🗺️\x20Country:\x20`'+_0x3027cf[_0x457e92(0xc3)]+'`\x0a'));if(_0x3027cf[_0x457e92(0xf6)]===_0x457e92(0xe4)&&_0x3027cf[_0x457e92(0xac)]){_0x2cd841+=_0x457e92(0xcf),_0x2cd841+=_0x457e92(0xa6)+_0x3027cf[_0x457e92(0xac)]+'`\x0a';_0x3027cf['remitterName']&&(_0x2cd841+=_0x457e92(0x149)+_0x3027cf[_0x457e92(0x120)]+'`\x0a');if(_0x3027cf[_0x457e92(0xa3)]&&_0x3027cf[_0x457e92(0xc3)])_0x2cd841+='🌍\x20From:\x20`'+_0x3027cf['customerCountry']+_0x457e92(0x12f)+_0x3027cf[_0x457e92(0xa3)]+_0x457e92(0x180);else{if(_0x3027cf[_0x457e92(0xa3)])_0x2cd841+=_0x457e92(0x16b)+_0x3027cf['customerIp']+'`\x0a';else _0x3027cf[_0x457e92(0xc3)]&&(_0x2cd841+=_0x457e92(0xf4)+_0x3027cf[_0x457e92(0xc3)]+'`\x0a');}}else(_0x3027cf[_0x457e92(0xcc)]||_0x3027cf[_0x457e92(0x123)]||_0x3027cf[_0x457e92(0x103)]||_0x3027cf['remitterIban'])&&(_0x2cd841+=_0x457e92(0x114),_0x3027cf[_0x457e92(0xcc)]&&(_0x2cd841+=_0x457e92(0x108)+_0x3027cf[_0x457e92(0xcc)]+'`\x0a'),_0x3027cf[_0x457e92(0x123)]&&(_0x2cd841+='💳\x20Card:\x20`****'+_0x3027cf['cardLast4']+'`\x0a'),_0x3027cf[_0x457e92(0x103)]&&(_0x2cd841+=_0x457e92(0x129)+_0x3027cf['bankId']+'`\x0a'),_0x3027cf[_0x457e92(0xac)]&&(_0x2cd841+='🏦\x20IBAN:\x20`'+_0x3027cf[_0x457e92(0xac)]+'`\x0a'),_0x3027cf['remitterName']&&(_0x2cd841+='👤\x20Remitter:\x20`'+_0x3027cf[_0x457e92(0x120)]+'`\x0a'));_0x36e18e===_0x457e92(0x12d)&&_0x3027cf[_0x457e92(0x16f)]&&(_0x2cd841+=_0x457e92(0x191)+_0x3027cf[_0x457e92(0x16f)]+'\x20USDT*\x0a'),_0x36e18e===_0x457e92(0xc0)&&(_0x2cd841+=_0x457e92(0xb9)),_0x3027cf['adminNotes']&&(_0x2cd841+=_0x457e92(0xfb)+_0x3027cf[_0x457e92(0xbd)]+'\x0a'),await this[_0x457e92(0x135)](_0x34bb32,_0x2cd841,{'parse_mode':_0x457e92(0x145)});}async[a54_0x332f0c(0x171)](_0x4d7156,_0x367b1d,_0x1bbcf7){const _0x3ab898=a54_0x332f0c,_0x5d6623={'created':'📤','completed':'✅','rejected':'❌'},_0x2549ac={'created':_0x3ab898(0xa5),'completed':_0x3ab898(0xd6),'rejected':_0x3ab898(0xaf)},_0x628924=_0x5d6623[_0x1bbcf7],_0x216ff2=_0x2549ac[_0x1bbcf7],_0x848db3=_0x628924+'\x20*'+_0x216ff2+'*\x0a\x0a'+(_0x3ab898(0x15f)+_0x367b1d[_0x3ab898(0xd1)]+_0x3ab898(0xde))+(_0x3ab898(0x144)+_0x367b1d['method']+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x367b1d['id']+'`\x0a')+(_0x3ab898(0x126)+new Date(_0x367b1d[_0x3ab898(0x133)])[_0x3ab898(0xdd)](_0x3ab898(0x11c))+'\x0a')+(_0x367b1d[_0x3ab898(0x11b)]?_0x3ab898(0x131)+_0x367b1d['txid']+'`':'');await this[_0x3ab898(0x135)](_0x4d7156,_0x848db3,{'parse_mode':_0x3ab898(0x145)});}async[a54_0x332f0c(0xa8)](_0x3209c1,_0x9fbcac){const _0x25e535=a54_0x332f0c;try{const _0x4c6e97=await database_1['default'][_0x25e535(0xe6)][_0x25e535(0x11f)]({'where':{'shopId':_0x3209c1},'select':{'notificationLogin':!![]}});if(!_0x4c6e97?.[_0x25e535(0xf8)]){console[_0x25e535(0x10f)](_0x25e535(0x107)+_0x3209c1);return;}const _0x88cc72=_0x9fbcac[_0x25e535(0x104)]?'🔐':'🚨',_0x51881d=_0x9fbcac[_0x25e535(0x104)]?_0x25e535(0x189):_0x25e535(0xe7);let _0x257923=_0x88cc72+'\x20*'+_0x51881d+_0x25e535(0xdf)+('👤\x20Username:\x20`'+_0x9fbcac[_0x25e535(0xe3)]+'`\x0a')+('📅\x20Time:\x20'+_0x9fbcac[_0x25e535(0x9c)][_0x25e535(0xdd)](_0x25e535(0x11c))+'\x0a');_0x9fbcac[_0x25e535(0x140)]&&(_0x257923+='🌐\x20IP\x20address:\x20`'+_0x9fbcac[_0x25e535(0x140)]+'`\x0a');if(_0x9fbcac[_0x25e535(0xf7)]){const _0x1a9294=_0x9fbcac[_0x25e535(0xf7)][_0x25e535(0x132)]>0x32?_0x9fbcac[_0x25e535(0xf7)][_0x25e535(0x146)](0x0,0x32)+_0x25e535(0x137):_0x9fbcac[_0x25e535(0xf7)];_0x257923+=_0x25e535(0x17a)+_0x1a9294+'`\x0a';}!_0x9fbcac['success']&&(_0x257923+=_0x25e535(0x113)),await this['sendShopNotification'](_0x3209c1,_0x257923,{'parse_mode':'Markdown'}),console[_0x25e535(0x10f)](_0x25e535(0x183)+_0x3209c1+':\x20'+(_0x9fbcac['success']?_0x25e535(0x104):_0x25e535(0xe2)));}catch(_0x21cdd9){console[_0x25e535(0x18f)]('Failed\x20to\x20send\x20login\x20notification:',_0x21cdd9);}}async[a54_0x332f0c(0x12b)](_0x4178fd,_0x59d673){const _0x48a8aa=a54_0x332f0c;try{const _0x2b6d65=await database_1['default']['shopSettings'][_0x48a8aa(0x11f)]({'where':{'shopId':_0x4178fd},'select':{'notificationApiError':!![]}});if(!_0x2b6d65?.[_0x48a8aa(0x178)]){console['log'](_0x48a8aa(0xc8)+_0x4178fd);return;}let _0x2aa925=_0x48a8aa(0xbf)+('🔗\x20Endpoint:\x20`'+_0x59d673[_0x48a8aa(0x188)]+'\x20'+_0x59d673[_0x48a8aa(0x169)]+'`\x0a')+('📅\x20Time:\x20'+_0x59d673[_0x48a8aa(0x9c)][_0x48a8aa(0xdd)](_0x48a8aa(0x11c))+'\x0a');_0x59d673[_0x48a8aa(0x17f)]&&(_0x2aa925+=_0x48a8aa(0xf5)+_0x59d673[_0x48a8aa(0x17f)]+'`\x0a'),_0x2aa925+=_0x48a8aa(0x143)+_0x59d673['errorMessage']+'`\x0a',_0x59d673[_0x48a8aa(0x17b)]&&(_0x2aa925+='🆔\x20Request\x20ID:\x20`'+_0x59d673[_0x48a8aa(0x17b)]+'`\x0a'),_0x2aa925+=_0x48a8aa(0xdb),await this[_0x48a8aa(0x135)](_0x4178fd,_0x2aa925,{'parse_mode':_0x48a8aa(0x145)}),console[_0x48a8aa(0x10f)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x4178fd+':\x20'+_0x59d673[_0x48a8aa(0x169)]);}catch(_0x139020){console[_0x48a8aa(0x18f)](_0x48a8aa(0x11e),_0x139020);}}async[a54_0x332f0c(0x118)](_0x7cc100,_0x200773,_0x43de6c){const _0x397dc0=a54_0x332f0c;let _0x215b51=_0x397dc0(0x17d)+_0x200773+_0x397dc0(0xdf);for(const [_0x27cec6,_0x4ee295]of Object[_0x397dc0(0xce)](_0x43de6c)){_0x4ee295!==null&&_0x4ee295!==undefined&&(_0x215b51+=_0x27cec6+_0x397dc0(0xa7)+_0x4ee295+'`\x0a');}await this[_0x397dc0(0x135)](_0x7cc100,_0x215b51,{'parse_mode':_0x397dc0(0x145)});}[a54_0x332f0c(0xd0)](){const _0x452413=a54_0x332f0c;return{'isActive':!!this[_0x452413(0xc5)],'username':this[_0x452413(0x185)]};}[a54_0x332f0c(0x11d)](){const _0x582324=a54_0x332f0c;this[_0x582324(0xc5)]&&(this[_0x582324(0xc5)][_0x582324(0x148)](),this[_0x582324(0xc5)]=null,console[_0x582324(0x10f)](_0x582324(0xc1)));}}function a54_0x179c(){const _0x2ff5ae=['remitterIban','Payment\x20failed','toString','Payout\x20rejected','`.\x0a\x0a','✅\x20Welcome\x20back!\x0a\x0a','create','Payment\x20refund','❌\x20Error\x20getting\x20debug\x20information.','4392990TQSaCd','📧\x20Email:\x20`','customerEmail','default','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','You\x20sent\x20','Error\x20handling\x20/status\x20command:','getGatewayDisplayNameForTelegram','adminNotes','\x20verified\x20for\x20shop\x20','🚨\x20*API\x20Error*\x0a\x0a','processing','🛑\x20Telegram\x20bot\x20stopped','To\x20reconnect,\x20use\x20the\x20/start\x20command','customerCountry','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','bot','message','chat','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','\x22,\x20apiKey=\x22','8990024UWWjXP','🔔\x20Notifications\x20are\x20active\x0a\x0a','paymentMethod','Contact\x20administrator.','entries','\x0a🪙\x20*CoinToPay\x20Details:*\x0a','getBotInfo','amount','update','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','onText','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','Payout\x20completed','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','2335540MLiqkW','shopId','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','Error\x20sending\x20shop\x20notification:','toLocaleString','\x20USD*\x0a','*\x0a\x0a','currency','trapay_bot','failed','username','cointopay','Contact\x20administrator\x20to\x20restore\x20full\x20access.','shopSettings','Failed\x20login\x20attempt','Telegram\x20bot\x20error:','\x20parts:\x20','.\x20*','Payment\x20successfully\x20paid','publicKey','Error\x20in\x20handleSingleLineVerification:','Telegram\x20bot\x20polling\x20error:','Error\x20handling\x20/debug\x20command:','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','trim','botToken','\x0a👤\x20*Customer\x20Information:*\x0a','🗺️\x20Country:\x20`','📊\x20Error\x20code:\x20`','gateway','userAgent','notificationLogin','SUSPENDED','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','📝\x20Notes:\x20','telegramId','last_name','findMany','/disconnect\x20-\x20disconnect\x20from\x20notifications','name','•\x20New\x20payments\x0a','...`\x0a\x0a','bankId','success','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','❌\x20Shop\x20with\x20username\x20`','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','💰\x20Method:\x20`','\x20(@','setupBotHandlers','✅\x20Telegram\x20bot\x20@','join','🏪\x20Available\x20shops\x20in\x20system:\x0a','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','log','text','TELEGRAM_BOT_USERNAME','`\x20not\x20found.\x0a\x0a','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','\x0a💳\x20*Payment\x20Details:*\x0a','TELEGRAM_BOT_TOKEN','Example:\x0a','shop','sendCustomNotification','`\x20is\x20inactive.\x0a\x0a','allSettled','txid','en-US','stopBot','Failed\x20to\x20send\x20API\x20error\x20notification:','findUnique','remitterName','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','1487368CrmcUq','cardLast4','/status\x20-\x20check\x20connection\x20status\x0a','\x20\x20\x20Public\x20Key:\x20`','📅\x20Date:\x20','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','❌\x20Please\x20use\x20/start\x20command\x20first','🏦\x20Bank\x20ID:\x20`','first_name','sendApiErrorNotification','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','chargeback','telegramUser','`\x20(IP:\x20`','...\x22','🔗\x20TXID:\x20`','length','createdAt','❌\x20Invalid\x20username\x20format:\x20`','sendShopNotification','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','...','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','__esModule','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','🔔\x20You\x20receive\x20notifications\x20about:\x0a','\x22\x20->\x20display\x20\x22','forEach','💰\x20Amount:\x20*','Payment\x20expired','ipAddress','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','Available\x20usernames:\x0a','❌\x20Error:\x20`','🏦\x20Method:\x20`','Markdown','substring','orderId','stopPolling','👤\x20Sender:\x20`','Username:\x20`','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','👤\x20Username:\x20`','Error\x20handling\x20message:','•\x20Important\x20events\x0a\x0a','telegramBotService','split','isVerified','✅\x20Telegram\x20user\x20','🎉\x20*Congratulations!*\x0a\x0a','📛\x20Name:\x20`','Payment\x20is\x20being\x20processed','\x20initialized\x20successfully','\x20via\x20single-line\x20input','•\x20`','12TibVgl','ACTIVE','initializeBot','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','sk_','💸\x20Amount:\x20*','pk_','updatedAt','Payment\x20chargeback','Error\x20handling\x20/disconnect\x20command:','handleSingleLineVerification','798110mOvHrO','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','includes','env','endpoint','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','🌐\x20IP:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','•\x20Payment\x20status\x20changes\x0a','4587499DlJaqO','chargebackAmount','../config/database','sendPayoutNotification','❌\x20Shop\x20`','📝\x20Order\x20ID:\x20`','test','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','•\x20Payouts\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','notificationApiError','startsWith','💻\x20Browser:\x20`','requestId','warn','🔔\x20*','User\x20','statusCode','`)\x0a','TelegramBotService','sendMessage','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','New\x20payment\x20created','botUsername','defineProperty','`\x0a\x0a','method','Successful\x20login','*.\x0a\x0a','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','🆔\x20Payment\x20ID:\x20`','customerName','📅\x20Connection\x20date:\x20','error','⚠️\x20Shop\x20`','💸\x20Penalty\x20amount:\x20*','node-telegram-bot-api','✅\x20Connected\x20to\x20shop:\x20*','405264vWKsqV','Commands:\x0a','timestamp','user\x20is\x20deactivated','Use\x20/start\x20to\x20connect.','🔌\x20User\x20','status','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','`\x20is\x20suspended.\x0a\x0a','customerIp','📱\x20Created\x20new\x20Telegram\x20user:\x20','New\x20payout\x20created','🏦\x20IBAN:\x20`',':\x20`','sendLoginNotification','unknown\x20shop','from','toLocaleDateString'];a54_0x179c=function(){return _0x2ff5ae;};return a54_0x179c();}exports['TelegramBotService']=TelegramBotService,exports[a54_0x332f0c(0x150)]=new TelegramBotService();