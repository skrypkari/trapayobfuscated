'use strict';function a52_0xa3c3(_0x21fa45,_0x8ba912){const _0x35255a=a52_0x3525();return a52_0xa3c3=function(_0xa3c395,_0x20fdd8){_0xa3c395=_0xa3c395-0x184;let _0x3e5e13=_0x35255a[_0xa3c395];return _0x3e5e13;},a52_0xa3c3(_0x21fa45,_0x8ba912);}function a52_0x3525(){const _0x4f6ea1=['Use\x20/start\x20to\x20begin.','stopBot','setupBotHandlers','username','Markdown','sendApiErrorNotification','Failed\x20login\x20attempt','sendShopNotification','•\x20New\x20payments\x0a','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','*\x0a\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','text','Telegram\x20bot\x20polling\x20error:','telegramUser','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','68WlBpoN','shopId','55866KfFzWL','en-US','method','•\x20Important\x20events\x0a\x0a','Error\x20handling\x20/debug\x20command:','warn','toLocaleDateString','Available\x20usernames:\x0a','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','botUsername','includes','env','2522868kHPLUA','Check\x20spelling\x20and\x20try\x20again.','Error\x20handling\x20/start\x20command:','sendPaymentNotification','Failed\x20to\x20send\x20login\x20notification:','isVerified','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','Payment\x20expired','telegramBotService','❌\x20Invalid\x20username\x20format:\x20`','\x20USDT*\x0a','/disconnect\x20-\x20disconnect\x20from\x20notifications','975ZaxrXo','🛑\x20Telegram\x20bot\x20stopped','statusCode','Payment\x20chargeback','•\x20Payment\x20status\x20changes\x0a','\x20\x20\x20Username:\x20`','TELEGRAM_BOT_TOKEN','💻\x20Browser:\x20`','TelegramBotService','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','Error\x20handling\x20/status\x20command:','message','Payout\x20rejected','customerEmail','toLocaleString','\x20disconnected\x20from\x20shop\x20','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','\x20USD*\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','initializeBot','To\x20reconnect,\x20use\x20the\x20/start\x20command','endpoint','📧\x20Email:\x20`','chat','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','sk_','\x20parts:\x20','You\x20sent\x20','polling_error','Successful\x20login','chargebackAmount','\x20initialized\x20successfully','node-telegram-bot-api','currency','Payout\x20completed','🔔\x20Notifications\x20are\x20active\x0a\x0a','sendCustomNotification','🏦\x20Method:\x20`','amount','shop','log','Error\x20handling\x20message:','3455yMWWiM','__esModule','...`\x0a\x0a','allSettled','\x22,\x20apiKey=\x22',':\x20`','botToken','error',':\x20username=\x22','name','\x20via\x20single-line\x20input','findFirst','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','Error\x20sending\x20shop\x20notification:','📝\x20Notes:\x20','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','__importDefault','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','27293bFyLYl','Commands:\x0a','✅\x20Telegram\x20bot\x20@','2514hLSmVW','first_name','📅\x20Date:\x20','stopPolling','\x20\x20\x20Status:\x20','userAgent','•\x20Payouts\x0a\x0a','findUnique','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','telegramId','create','190XRtxSw','findMany','entries','customerName','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','Payment\x20refund','notificationApiError','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','📛\x20Name:\x20`','•\x20`','📝\x20Order\x20ID:\x20`','91718Wrxfsk','2144106oAZXcy','pk_','...\x22','Failed\x20to\x20send\x20API\x20error\x20notification:','`\x20(','❌\x20Error:\x20`','💸\x20Penalty\x20amount:\x20*','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','length','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','join','defineProperty','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','forEach','sendLoginNotification','Payment\x20successfully\x20paid','secretKey','shopSettings','*.\x0a\x0a','Error\x20in\x20handleSingleLineVerification:','810fJeDzB','user\x20is\x20deactivated','Example:\x0a','toString','notificationLogin','split','📅\x20Time:\x20','default','from','../config/database','New\x20payment\x20created','failed','last_name','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','txid','🔌\x20User\x20','onText','8wiIMaW','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Payment\x20failed','📊\x20Error\x20code:\x20`','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','ipAddress','✅\x20Telegram\x20user\x20','trim','Error\x20handling\x20/disconnect\x20command:','Payment\x20is\x20being\x20processed','update','`\x20is\x20inactive.\x0a\x0a','unknown\x20shop','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','🌐\x20IP\x20address:\x20`','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','adminNotes','`.\x0a\x0a','orderId','`\x0a\x0a','👤\x20Username:\x20`','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','substring','publicKey','📱\x20Shop:\x20*','test','🏪\x20Available\x20shops\x20in\x20system:\x0a','/status\x20-\x20check\x20connection\x20status\x0a','User\x20','gateway','handleSingleLineVerification','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','TELEGRAM_BOT_USERNAME','map','startsWith','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','../types/gateway','success','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','🔔\x20*','📱\x20Your\x20Telegram\x20ID:\x20`','createdAt','sendMessage','status','✅\x20Connected\x20to\x20shop:\x20*','📊\x20*Connection\x20Status*\x0a\x0a','🎉\x20*Congratulations!*\x0a\x0a','bot','🔗\x20TXID:\x20`','\x0a👤\x20*Customer\x20Information:*\x0a','❌\x20Shop\x20`','timestamp','💸\x20Amount:\x20*','\x22\x20->\x20display\x20\x22','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','🆔\x20Payout\x20ID:\x20`','requestId','❌\x20Error\x20getting\x20debug\x20information.'];a52_0x3525=function(){return _0x4f6ea1;};return a52_0x3525();}const a52_0xa27843=a52_0xa3c3;(function(_0x17c1ff,_0x27aa3b){const _0x4a0d8f=a52_0xa3c3,_0x470ed0=_0x17c1ff();while(!![]){try{const _0x232172=parseInt(_0x4a0d8f(0x19d))/0x1*(parseInt(_0x4a0d8f(0x20d))/0x2)+-parseInt(_0x4a0d8f(0x184))/0x3*(parseInt(_0x4a0d8f(0x26a))/0x4)+-parseInt(_0x4a0d8f(0x1ca))/0x5*(-parseInt(_0x4a0d8f(0x1df))/0x6)+-parseInt(_0x4a0d8f(0x1dc))/0x7+-parseInt(_0x4a0d8f(0x21e))/0x8*(-parseInt(_0x4a0d8f(0x1f6))/0x9)+-parseInt(_0x4a0d8f(0x1ea))/0xa*(parseInt(_0x4a0d8f(0x1f5))/0xb)+-parseInt(_0x4a0d8f(0x191))/0xc;if(_0x232172===_0x27aa3b)break;else _0x470ed0['push'](_0x470ed0['shift']());}catch(_0x164e38){_0x470ed0['push'](_0x470ed0['shift']());}}}(a52_0x3525,0x39020));var __importDefault=this&&this[a52_0xa27843(0x1da)]||function(_0x2b113e){return _0x2b113e&&_0x2b113e['__esModule']?_0x2b113e:{'default':_0x2b113e};};Object[a52_0xa27843(0x201)](exports,a52_0xa27843(0x1cb),{'value':!![]}),exports[a52_0xa27843(0x199)]=exports[a52_0xa27843(0x1a5)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a52_0xa27843(0x1c0))),database_1=__importDefault(require(a52_0xa27843(0x216))),gateway_1=require(a52_0xa27843(0x243));class TelegramBotService{constructor(){const _0x53612c=a52_0xa27843;this[_0x53612c(0x24e)]=null,this['botToken']=process[_0x53612c(0x190)][_0x53612c(0x1a3)]||'',this[_0x53612c(0x18e)]=process['env'][_0x53612c(0x23f)]||'trapay_bot',this[_0x53612c(0x1d0)]?this[_0x53612c(0x1b0)]():console['warn'](_0x53612c(0x22b));}['initializeBot'](){const _0x504824=a52_0xa27843;try{this[_0x504824(0x24e)]=new node_telegram_bot_api_1[(_0x504824(0x214))](this[_0x504824(0x1d0)],{'polling':!![]}),this[_0x504824(0x25b)](),console[_0x504824(0x1c8)](_0x504824(0x1de)+this[_0x504824(0x18e)]+_0x504824(0x1bf));}catch(_0x5c6c21){console[_0x504824(0x1d1)](_0x504824(0x1d6),_0x5c6c21);}}[a52_0xa27843(0x25b)](){const _0x42751a=a52_0xa27843;if(!this['bot'])return;this[_0x42751a(0x24e)][_0x42751a(0x21d)](/\/start/,async _0x283841=>{const _0x1dd277=_0x42751a,_0x394eb1=_0x283841[_0x1dd277(0x1b4)]['id'],_0x5330c5=_0x283841['from']?.['id'][_0x1dd277(0x210)](),_0x353779=_0x283841['from']?.['username'],_0x2c3d51=_0x283841[_0x1dd277(0x215)]?.[_0x1dd277(0x1e0)],_0x18a778=_0x283841[_0x1dd277(0x215)]?.[_0x1dd277(0x219)];if(!_0x5330c5)return;try{let _0x3e583d=await database_1[_0x1dd277(0x214)][_0x1dd277(0x268)][_0x1dd277(0x1e6)]({'where':{'telegramId':_0x5330c5},'include':{'shop':!![]}});!_0x3e583d?(_0x3e583d=await database_1[_0x1dd277(0x214)]['telegramUser'][_0x1dd277(0x1e9)]({'data':{'telegramId':_0x5330c5,'username':_0x353779,'firstName':_0x2c3d51,'lastName':_0x18a778,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log']('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x5330c5+'\x20(@'+_0x353779+')')):_0x3e583d=await database_1[_0x1dd277(0x214)][_0x1dd277(0x268)]['update']({'where':{'telegramId':_0x5330c5},'data':{'username':_0x353779,'firstName':_0x2c3d51,'lastName':_0x18a778},'include':{'shop':!![]}}),_0x3e583d[_0x1dd277(0x196)]&&_0x3e583d[_0x1dd277(0x26b)]&&_0x3e583d[_0x1dd277(0x1c7)]?await this[_0x1dd277(0x24e)]?.[_0x1dd277(0x249)](_0x394eb1,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x1dd277(0x1b6)+_0x3e583d[_0x1dd277(0x1c7)]['name']+'*\x0a')+('Username:\x20`'+_0x3e583d['shop'][_0x1dd277(0x25c)]+_0x1dd277(0x231))+_0x1dd277(0x21f)+_0x1dd277(0x261)+_0x1dd277(0x1a1)+_0x1dd277(0x1e5)+_0x1dd277(0x1dd)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x1dd277(0x19c),{'parse_mode':_0x1dd277(0x25d)}):(_0x3e583d[_0x1dd277(0x26b)]&&!_0x3e583d['isVerified']&&(await database_1['default']['telegramUser'][_0x1dd277(0x228)]({'where':{'telegramId':_0x5330c5},'data':{'shopId':null,'isVerified':![]}}),console[_0x1dd277(0x1c8)](_0x1dd277(0x18d)+_0x5330c5)),await this[_0x1dd277(0x24e)]?.[_0x1dd277(0x249)](_0x394eb1,_0x1dd277(0x233)+_0x1dd277(0x1b5)+_0x1dd277(0x262)+_0x1dd277(0x20f)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x1dd277(0x23e),{'parse_mode':_0x1dd277(0x25d)}));}catch(_0xfe7556){console[_0x1dd277(0x1d1)](_0x1dd277(0x193),_0xfe7556),await this[_0x1dd277(0x24e)]?.['sendMessage'](_0x394eb1,_0x1dd277(0x245));}}),this[_0x42751a(0x24e)][_0x42751a(0x21d)](/\/disconnect/,async _0x21b9bb=>{const _0x1efd67=_0x42751a,_0x2413cb=_0x21b9bb[_0x1efd67(0x1b4)]['id'],_0xa10cca=_0x21b9bb[_0x1efd67(0x215)]?.['id'][_0x1efd67(0x210)]();if(!_0xa10cca)return;try{const _0x3bf515=await database_1[_0x1efd67(0x214)][_0x1efd67(0x268)][_0x1efd67(0x1e6)]({'where':{'telegramId':_0xa10cca},'include':{'shop':!![]}});if(!_0x3bf515||!_0x3bf515[_0x1efd67(0x196)]||!_0x3bf515[_0x1efd67(0x26b)]){await this[_0x1efd67(0x24e)]?.['sendMessage'](_0x2413cb,_0x1efd67(0x203));return;}const _0x415bc0=_0x3bf515[_0x1efd67(0x1c7)]?.[_0x1efd67(0x1d3)]||_0x1efd67(0x22a);await database_1[_0x1efd67(0x214)][_0x1efd67(0x268)][_0x1efd67(0x228)]({'where':{'telegramId':_0xa10cca},'data':{'shopId':null,'isVerified':![]}}),console[_0x1efd67(0x1c8)](_0x1efd67(0x21c)+_0xa10cca+_0x1efd67(0x1ac)+_0x3bf515[_0x1efd67(0x26b)]),await this[_0x1efd67(0x24e)]?.[_0x1efd67(0x249)](_0x2413cb,_0x1efd67(0x1db)+_0x415bc0+'*.\x0a\x0a'+_0x1efd67(0x1b1),{'parse_mode':_0x1efd67(0x25d)});}catch(_0x438168){console['error'](_0x1efd67(0x226),_0x438168),await this['bot']?.['sendMessage'](_0x2413cb,_0x1efd67(0x245));}}),this[_0x42751a(0x24e)]['onText'](/\/status/,async _0x2ebc2f=>{const _0x4b4297=_0x42751a,_0x47bb41=_0x2ebc2f['chat']['id'],_0x97228a=_0x2ebc2f[_0x4b4297(0x215)]?.['id'][_0x4b4297(0x210)]();if(!_0x97228a)return;try{const _0x201549=await database_1[_0x4b4297(0x214)]['telegramUser'][_0x4b4297(0x1e6)]({'where':{'telegramId':_0x97228a},'include':{'shop':!![]}});if(!_0x201549){await this[_0x4b4297(0x24e)]?.[_0x4b4297(0x249)](_0x47bb41,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x4b4297(0x259));return;}if(!_0x201549['isVerified']||!_0x201549['shopId']||!_0x201549[_0x4b4297(0x1c7)]){await this[_0x4b4297(0x24e)]?.[_0x4b4297(0x249)](_0x47bb41,_0x4b4297(0x255)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x4b4297(0x24e)]?.[_0x4b4297(0x249)](_0x47bb41,_0x4b4297(0x24c)+(_0x4b4297(0x24b)+_0x201549[_0x4b4297(0x1c7)][_0x4b4297(0x1d3)]+'*\x0a')+('👤\x20Username:\x20`'+_0x201549[_0x4b4297(0x1c7)][_0x4b4297(0x25c)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x201549['updatedAt'][_0x4b4297(0x18a)](_0x4b4297(0x185))+'\x0a\x0a')+_0x4b4297(0x1c3)+_0x4b4297(0x1dd)+_0x4b4297(0x19c),{'parse_mode':_0x4b4297(0x25d)});}catch(_0x36d248){console[_0x4b4297(0x1d1)](_0x4b4297(0x1a7),_0x36d248),await this[_0x4b4297(0x24e)]?.[_0x4b4297(0x249)](_0x47bb41,_0x4b4297(0x245));}}),this[_0x42751a(0x24e)][_0x42751a(0x21d)](/\/debug/,async _0x5db8d4=>{const _0x4b3981=_0x42751a,_0x194db5=_0x5db8d4[_0x4b3981(0x1b4)]['id'],_0x4c69b3=_0x5db8d4[_0x4b3981(0x215)]?.['id'][_0x4b3981(0x210)]();if(!_0x4c69b3)return;try{const _0x338812=await database_1[_0x4b3981(0x214)][_0x4b3981(0x1c7)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x6a6129='🔍\x20*Debug\x20Information*\x0a\x0a';_0x6a6129+=_0x4b3981(0x247)+_0x4c69b3+_0x4b3981(0x231),_0x6a6129+=_0x4b3981(0x239),_0x338812[_0x4b3981(0x206)]((_0x2e2fab,_0x2fc2f6)=>{const _0x236da6=_0x4b3981;_0x6a6129+=_0x2fc2f6+0x1+'.\x20*'+_0x2e2fab[_0x236da6(0x1d3)]+'*\x0a',_0x6a6129+=_0x236da6(0x1a2)+_0x2e2fab[_0x236da6(0x25c)]+'`\x0a',_0x6a6129+=_0x236da6(0x1e3)+_0x2e2fab[_0x236da6(0x24a)]+'\x0a',_0x6a6129+='\x20\x20\x20Public\x20Key:\x20`'+_0x2e2fab[_0x236da6(0x236)]['substring'](0x0,0xf)+_0x236da6(0x1cc);}),await this[_0x4b3981(0x24e)]?.['sendMessage'](_0x194db5,_0x6a6129,{'parse_mode':_0x4b3981(0x25d)});}catch(_0xcc4328){console[_0x4b3981(0x1d1)](_0x4b3981(0x188),_0xcc4328),await this['bot']?.[_0x4b3981(0x249)](_0x194db5,_0x4b3981(0x258));}}),this[_0x42751a(0x24e)]['on'](_0x42751a(0x1a8),async _0x534eea=>{const _0x330db3=_0x42751a;if(_0x534eea[_0x330db3(0x266)]?.[_0x330db3(0x241)]('/'))return;const _0x26e4bd=_0x534eea[_0x330db3(0x1b4)]['id'],_0x195c5b=_0x534eea[_0x330db3(0x215)]?.['id'][_0x330db3(0x210)](),_0x2d6256=_0x534eea[_0x330db3(0x266)]?.[_0x330db3(0x225)]();if(!_0x195c5b||!_0x2d6256)return;try{const _0x28801=await database_1['default'][_0x330db3(0x268)][_0x330db3(0x1e6)]({'where':{'telegramId':_0x195c5b},'include':{'shop':!![]}});if(!_0x28801){await this[_0x330db3(0x24e)]?.[_0x330db3(0x249)](_0x26e4bd,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x28801[_0x330db3(0x196)]&&_0x28801[_0x330db3(0x26b)]&&_0x28801[_0x330db3(0x1c7)]){await this[_0x330db3(0x24e)]?.['sendMessage'](_0x26e4bd,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x28801[_0x330db3(0x1c7)][_0x330db3(0x1d3)]+_0x330db3(0x20b)+_0x330db3(0x18c),{'parse_mode':_0x330db3(0x25d)});return;}const _0xa7ef25=_0x2d6256[_0x330db3(0x212)](/\s+/);if(_0xa7ef25['length']!==0x2){await this[_0x330db3(0x24e)]?.[_0x330db3(0x249)](_0x26e4bd,_0x330db3(0x1f1)+_0x330db3(0x262)+_0x330db3(0x20f)+_0x330db3(0x1fd)+(_0x330db3(0x1bb)+_0xa7ef25['length']+_0x330db3(0x1ba)+_0xa7ef25[_0x330db3(0x240)](_0x491244=>'`'+_0x491244+'`')[_0x330db3(0x200)](',\x20')),{'parse_mode':_0x330db3(0x25d)});return;}const [_0x238d0e,_0x2b69c1]=_0xa7ef25;console[_0x330db3(0x1c8)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x195c5b+_0x330db3(0x1d2)+_0x238d0e+_0x330db3(0x1ce)+_0x2b69c1[_0x330db3(0x235)](0x0,0xa)+_0x330db3(0x1f8)),await this['handleSingleLineVerification'](_0x26e4bd,_0x195c5b,_0x238d0e,_0x2b69c1);}catch(_0x283304){console[_0x330db3(0x1d1)](_0x330db3(0x1c9),_0x283304),await this[_0x330db3(0x24e)]?.[_0x330db3(0x249)](_0x26e4bd,_0x330db3(0x245));}}),this[_0x42751a(0x24e)]['on']('error',_0x2fd73e=>{console['error']('Telegram\x20bot\x20error:',_0x2fd73e);}),this[_0x42751a(0x24e)]['on'](_0x42751a(0x1bc),_0x1c189e=>{const _0x796fb5=_0x42751a;console['error'](_0x796fb5(0x267),_0x1c189e);});}async[a52_0xa27843(0x23d)](_0x54dcdb,_0x4b9045,_0xdb5d49,_0x3f7143){const _0x20a76c=a52_0xa27843;try{console[_0x20a76c(0x1c8)](_0x20a76c(0x205)+_0x4b9045+':\x20username=\x22'+_0xdb5d49+'\x22,\x20apiKey=\x22'+_0x3f7143[_0x20a76c(0x235)](0x0,0xa)+'...\x22');if(!_0xdb5d49||_0xdb5d49[_0x20a76c(0x1fe)]<0x3||_0xdb5d49[_0x20a76c(0x1fe)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x20a76c(0x238)](_0xdb5d49)){await this[_0x20a76c(0x24e)]?.['sendMessage'](_0x54dcdb,_0x20a76c(0x19a)+_0xdb5d49+_0x20a76c(0x231)+_0x20a76c(0x202),{'parse_mode':'Markdown'});return;}if(!_0x3f7143||!_0x3f7143['startsWith'](_0x20a76c(0x1f7))&&!_0x3f7143[_0x20a76c(0x241)](_0x20a76c(0x1b9))){await this['bot']?.[_0x20a76c(0x249)](_0x54dcdb,_0x20a76c(0x265)+_0x20a76c(0x22d),{'parse_mode':_0x20a76c(0x25d)});return;}const _0x2eff8a=await database_1['default'][_0x20a76c(0x1c7)][_0x20a76c(0x1e6)]({'where':{'username':_0xdb5d49},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x2eff8a){const _0x1efaa6=await database_1[_0x20a76c(0x214)]['shop'][_0x20a76c(0x1eb)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x31828e='❌\x20Shop\x20with\x20username\x20`'+_0xdb5d49+'`\x20not\x20found.\x0a\x0a';_0x1efaa6[_0x20a76c(0x1fe)]>0x0?(_0x31828e+=_0x20a76c(0x18b),_0x1efaa6['forEach'](_0xf8429e=>{const _0x4a2242=_0x20a76c;_0x31828e+=_0x4a2242(0x1f3)+_0xf8429e[_0x4a2242(0x25c)]+_0x4a2242(0x1fa)+_0xf8429e[_0x4a2242(0x1d3)]+')\x0a';}),_0x31828e+=_0x20a76c(0x234)):_0x31828e+=_0x20a76c(0x192);await this[_0x20a76c(0x24e)]?.[_0x20a76c(0x249)](_0x54dcdb,_0x31828e,{'parse_mode':_0x20a76c(0x25d)});return;}if(_0x2eff8a[_0x20a76c(0x24a)]!=='ACTIVE'){await this['bot']?.[_0x20a76c(0x249)](_0x54dcdb,_0x20a76c(0x251)+_0xdb5d49+_0x20a76c(0x229)+'Contact\x20administrator.',{'parse_mode':'Markdown'});return;}if(_0x2eff8a[_0x20a76c(0x236)]!==_0x3f7143&&_0x2eff8a[_0x20a76c(0x209)]!==_0x3f7143){await this['bot']?.['sendMessage'](_0x54dcdb,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0xdb5d49+'`.\x0a\x0a'+_0x20a76c(0x1ad)+_0x20a76c(0x1b7),{'parse_mode':_0x20a76c(0x25d)});return;}const _0x3fd4dc=await database_1[_0x20a76c(0x214)][_0x20a76c(0x268)][_0x20a76c(0x1d5)]({'where':{'shopId':_0x2eff8a['id'],'isVerified':!![],'telegramId':{'not':_0x4b9045}}});if(_0x3fd4dc){await this[_0x20a76c(0x24e)]?.[_0x20a76c(0x249)](_0x54dcdb,_0x20a76c(0x204)+_0xdb5d49+_0x20a76c(0x22f)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':'Markdown'});return;}await database_1['default'][_0x20a76c(0x268)][_0x20a76c(0x228)]({'where':{'telegramId':_0x4b9045},'data':{'shopId':_0x2eff8a['id'],'isVerified':!![]}}),await this[_0x20a76c(0x24e)]?.['sendMessage'](_0x54dcdb,_0x20a76c(0x24d)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x20a76c(0x237)+_0x2eff8a[_0x20a76c(0x1d3)]+'*\x0a')+(_0x20a76c(0x232)+_0x2eff8a['username']+_0x20a76c(0x231))+_0x20a76c(0x1b8)+_0x20a76c(0x261)+_0x20a76c(0x1a1)+'•\x20Payouts\x0a'+_0x20a76c(0x187)+_0x20a76c(0x1dd)+_0x20a76c(0x23a)+_0x20a76c(0x19c),{'parse_mode':_0x20a76c(0x25d)}),console[_0x20a76c(0x1c8)](_0x20a76c(0x224)+_0x4b9045+'\x20verified\x20for\x20shop\x20'+_0x2eff8a[_0x20a76c(0x25c)]+_0x20a76c(0x1d4));}catch(_0x1e3081){console[_0x20a76c(0x1d1)](_0x20a76c(0x20c),_0x1e3081),await this['bot']?.[_0x20a76c(0x249)](_0x54dcdb,_0x20a76c(0x264));}}async[a52_0xa27843(0x260)](_0x2ad94a,_0x427cb5,_0x49f51c){const _0x2d5839=a52_0xa27843;if(!this[_0x2d5839(0x24e)]){console[_0x2d5839(0x189)](_0x2d5839(0x1ff));return;}try{const _0x139a2f=await database_1[_0x2d5839(0x214)][_0x2d5839(0x268)][_0x2d5839(0x1eb)]({'where':{'shopId':_0x2ad94a,'isVerified':!![]}});if(_0x139a2f[_0x2d5839(0x1fe)]===0x0){console[_0x2d5839(0x1c8)](_0x2d5839(0x222)+_0x2ad94a);return;}const _0x388777=_0x139a2f[_0x2d5839(0x240)](async _0x597943=>{const _0x4d927b=_0x2d5839;try{await this[_0x4d927b(0x24e)]?.[_0x4d927b(0x249)](_0x597943['telegramId'],_0x427cb5,_0x49f51c),console[_0x4d927b(0x1c8)](_0x4d927b(0x1ee)+_0x597943['telegramId']);}catch(_0x72ee79){console[_0x4d927b(0x1d1)](_0x4d927b(0x269)+_0x597943['telegramId']+':',_0x72ee79),_0x72ee79 instanceof Error&&(_0x72ee79[_0x4d927b(0x1a8)]['includes']('blocked')||_0x72ee79['message'][_0x4d927b(0x18f)]('chat\x20not\x20found')||_0x72ee79[_0x4d927b(0x1a8)]['includes'](_0x4d927b(0x20e)))&&(await database_1[_0x4d927b(0x214)][_0x4d927b(0x268)][_0x4d927b(0x228)]({'where':{'id':_0x597943['id']},'data':{'isVerified':![]}}),console[_0x4d927b(0x1c8)](_0x4d927b(0x23b)+_0x597943[_0x4d927b(0x1e8)]+_0x4d927b(0x1a6)));}});await Promise[_0x2d5839(0x1cd)](_0x388777);}catch(_0xe760dd){console[_0x2d5839(0x1d1)](_0x2d5839(0x1d7),_0xe760dd);}}async[a52_0xa27843(0x194)](_0x5723b0,_0x4c7cc0,_0x5d1e39){const _0xad647e=a52_0xa27843,_0x268baf={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x578b50={'created':_0xad647e(0x217),'paid':_0xad647e(0x208),'failed':_0xad647e(0x220),'expired':_0xad647e(0x198),'refund':_0xad647e(0x1ef),'chargeback':_0xad647e(0x1a0),'processing':_0xad647e(0x227)},_0x20ee32=_0x268baf[_0x5d1e39],_0x137670=_0x578b50[_0x5d1e39],_0x514251=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x4c7cc0['gateway']);console[_0xad647e(0x1c8)](_0xad647e(0x1af)+_0x4c7cc0[_0xad647e(0x23c)]+_0xad647e(0x254)+_0x514251+'\x22');let _0x319fd5=_0x20ee32+'\x20*'+_0x137670+_0xad647e(0x263)+('💰\x20Amount:\x20*'+_0x4c7cc0[_0xad647e(0x1c6)]+'\x20'+_0x4c7cc0[_0xad647e(0x1c1)]+'*\x0a')+(_0xad647e(0x1f4)+(_0x4c7cc0[_0xad647e(0x230)]||_0x4c7cc0['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x4c7cc0['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x514251+'`\x0a')+(_0xad647e(0x1e1)+new Date(_0x4c7cc0[_0xad647e(0x248)])[_0xad647e(0x1ab)](_0xad647e(0x185))+'\x0a');(_0x4c7cc0[_0xad647e(0x1ed)]||_0x4c7cc0[_0xad647e(0x1aa)])&&(_0x319fd5+=_0xad647e(0x250),_0x4c7cc0['customerName']&&(_0x319fd5+=_0xad647e(0x1f2)+_0x4c7cc0[_0xad647e(0x1ed)]+'`\x0a'),_0x4c7cc0[_0xad647e(0x1aa)]&&(_0x319fd5+=_0xad647e(0x1b3)+_0x4c7cc0['customerEmail']+'`\x0a')),_0x5d1e39==='chargeback'&&_0x4c7cc0[_0xad647e(0x1be)]&&(_0x319fd5+=_0xad647e(0x1fc)+_0x4c7cc0[_0xad647e(0x1be)]+_0xad647e(0x19b)),_0x5d1e39==='processing'&&(_0x319fd5+=_0xad647e(0x21a)),_0x4c7cc0[_0xad647e(0x22e)]&&(_0x319fd5+=_0xad647e(0x1d8)+_0x4c7cc0[_0xad647e(0x22e)]+'\x0a'),await this[_0xad647e(0x260)](_0x5723b0,_0x319fd5,{'parse_mode':_0xad647e(0x25d)});}async['sendPayoutNotification'](_0x4b577f,_0xb41e53,_0x52ab46){const _0x20eb79=a52_0xa27843,_0x211a1c={'created':'📤','completed':'✅','rejected':'❌'},_0x30c14a={'created':'New\x20payout\x20created','completed':_0x20eb79(0x1c2),'rejected':_0x20eb79(0x1a9)},_0x274699=_0x211a1c[_0x52ab46],_0x583e71=_0x30c14a[_0x52ab46],_0x285615=_0x274699+'\x20*'+_0x583e71+_0x20eb79(0x263)+(_0x20eb79(0x253)+_0xb41e53[_0x20eb79(0x1c6)]+_0x20eb79(0x1ae))+(_0x20eb79(0x1c5)+_0xb41e53[_0x20eb79(0x186)]+'`\x0a')+(_0x20eb79(0x256)+_0xb41e53['id']+'`\x0a')+(_0x20eb79(0x1e1)+new Date(_0xb41e53['createdAt'])[_0x20eb79(0x1ab)](_0x20eb79(0x185))+'\x0a')+(_0xb41e53['txid']?_0x20eb79(0x24f)+_0xb41e53[_0x20eb79(0x21b)]+'`':'');await this[_0x20eb79(0x260)](_0x4b577f,_0x285615,{'parse_mode':_0x20eb79(0x25d)});}async[a52_0xa27843(0x207)](_0x552f04,_0x3fabfe){const _0xa9deff=a52_0xa27843;try{const _0x1760e4=await database_1['default'][_0xa9deff(0x20a)]['findUnique']({'where':{'shopId':_0x552f04},'select':{'notificationLogin':!![]}});if(!_0x1760e4?.[_0xa9deff(0x211)]){console[_0xa9deff(0x1c8)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x552f04);return;}const _0x1be98a=_0x3fabfe[_0xa9deff(0x244)]?'🔐':'🚨',_0x285e87=_0x3fabfe['success']?_0xa9deff(0x1bd):_0xa9deff(0x25f);let _0xb4b61d=_0x1be98a+'\x20*'+_0x285e87+_0xa9deff(0x263)+(_0xa9deff(0x232)+_0x3fabfe[_0xa9deff(0x25c)]+'`\x0a')+(_0xa9deff(0x213)+_0x3fabfe[_0xa9deff(0x252)][_0xa9deff(0x1ab)](_0xa9deff(0x185))+'\x0a');_0x3fabfe[_0xa9deff(0x223)]&&(_0xb4b61d+=_0xa9deff(0x22c)+_0x3fabfe['ipAddress']+'`\x0a');if(_0x3fabfe[_0xa9deff(0x1e4)]){const _0x47593a=_0x3fabfe['userAgent'][_0xa9deff(0x1fe)]>0x32?_0x3fabfe[_0xa9deff(0x1e4)][_0xa9deff(0x235)](0x0,0x32)+'...':_0x3fabfe['userAgent'];_0xb4b61d+=_0xa9deff(0x1a4)+_0x47593a+'`\x0a';}!_0x3fabfe['success']&&(_0xb4b61d+=_0xa9deff(0x242)),await this[_0xa9deff(0x260)](_0x552f04,_0xb4b61d,{'parse_mode':_0xa9deff(0x25d)}),console[_0xa9deff(0x1c8)](_0xa9deff(0x197)+_0x552f04+':\x20'+(_0x3fabfe['success']?'success':_0xa9deff(0x218)));}catch(_0x5b64c8){console[_0xa9deff(0x1d1)](_0xa9deff(0x195),_0x5b64c8);}}async[a52_0xa27843(0x25e)](_0x3f040f,_0x41b5a2){const _0x48bcd6=a52_0xa27843;try{const _0x5ef53c=await database_1[_0x48bcd6(0x214)][_0x48bcd6(0x20a)][_0x48bcd6(0x1e6)]({'where':{'shopId':_0x3f040f},'select':{'notificationApiError':!![]}});if(!_0x5ef53c?.[_0x48bcd6(0x1f0)]){console[_0x48bcd6(0x1c8)](_0x48bcd6(0x1d9)+_0x3f040f);return;}let _0x13dae6='🚨\x20*API\x20Error*\x0a\x0a'+('🔗\x20Endpoint:\x20`'+_0x41b5a2[_0x48bcd6(0x186)]+'\x20'+_0x41b5a2[_0x48bcd6(0x1b2)]+'`\x0a')+(_0x48bcd6(0x213)+_0x41b5a2[_0x48bcd6(0x252)][_0x48bcd6(0x1ab)](_0x48bcd6(0x185))+'\x0a');_0x41b5a2[_0x48bcd6(0x19f)]&&(_0x13dae6+=_0x48bcd6(0x221)+_0x41b5a2[_0x48bcd6(0x19f)]+'`\x0a'),_0x13dae6+=_0x48bcd6(0x1fb)+_0x41b5a2['errorMessage']+'`\x0a',_0x41b5a2[_0x48bcd6(0x257)]&&(_0x13dae6+='🆔\x20Request\x20ID:\x20`'+_0x41b5a2['requestId']+'`\x0a'),_0x13dae6+=_0x48bcd6(0x1e7),await this[_0x48bcd6(0x260)](_0x3f040f,_0x13dae6,{'parse_mode':_0x48bcd6(0x25d)}),console['log']('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x3f040f+':\x20'+_0x41b5a2['endpoint']);}catch(_0xbb303d){console[_0x48bcd6(0x1d1)](_0x48bcd6(0x1f9),_0xbb303d);}}async[a52_0xa27843(0x1c4)](_0x40aec1,_0x33209e,_0x5d662d){const _0x626f66=a52_0xa27843;let _0x4e6192=_0x626f66(0x246)+_0x33209e+_0x626f66(0x263);for(const [_0x1c1f86,_0x31b0b0]of Object[_0x626f66(0x1ec)](_0x5d662d)){_0x31b0b0!==null&&_0x31b0b0!==undefined&&(_0x4e6192+=_0x1c1f86+_0x626f66(0x1cf)+_0x31b0b0+'`\x0a');}await this['sendShopNotification'](_0x40aec1,_0x4e6192,{'parse_mode':'Markdown'});}['getBotInfo'](){const _0x292bdb=a52_0xa27843;return{'isActive':!!this[_0x292bdb(0x24e)],'username':this[_0x292bdb(0x18e)]};}[a52_0xa27843(0x25a)](){const _0x45e8c6=a52_0xa27843;this[_0x45e8c6(0x24e)]&&(this['bot'][_0x45e8c6(0x1e2)](),this['bot']=null,console[_0x45e8c6(0x1c8)](_0x45e8c6(0x19e)));}}exports[a52_0xa27843(0x1a5)]=TelegramBotService,exports[a52_0xa27843(0x199)]=new TelegramBotService();