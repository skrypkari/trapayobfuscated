'use strict';const a54_0x3a0f46=a54_0xdee7;(function(_0x5ad5d3,_0xd1a4cd){const _0x4af531=a54_0xdee7,_0x3e2399=_0x5ad5d3();while(!![]){try{const _0x550582=-parseInt(_0x4af531(0x219))/0x1+parseInt(_0x4af531(0x18a))/0x2*(-parseInt(_0x4af531(0x243))/0x3)+-parseInt(_0x4af531(0x216))/0x4+-parseInt(_0x4af531(0x18c))/0x5+parseInt(_0x4af531(0x1d0))/0x6+-parseInt(_0x4af531(0x237))/0x7+parseInt(_0x4af531(0x167))/0x8*(parseInt(_0x4af531(0x1d8))/0x9);if(_0x550582===_0xd1a4cd)break;else _0x3e2399['push'](_0x3e2399['shift']());}catch(_0xc09b1f){_0x3e2399['push'](_0x3e2399['shift']());}}}(a54_0x42cc,0x347c1));function a54_0xdee7(_0x168daa,_0x8fbe3a){const _0x42cc33=a54_0x42cc();return a54_0xdee7=function(_0xdee728,_0x108f0e){_0xdee728=_0xdee728-0x155;let _0x2f9454=_0x42cc33[_0xdee728];return _0x2f9454;},a54_0xdee7(_0x168daa,_0x8fbe3a);}var __importDefault=this&&this[a54_0x3a0f46(0x1ae)]||function(_0x1c6e1a){const _0x4f6ff7=a54_0x3a0f46;return _0x1c6e1a&&_0x1c6e1a[_0x4f6ff7(0x171)]?_0x1c6e1a:{'default':_0x1c6e1a};};Object[a54_0x3a0f46(0x19c)](exports,'__esModule',{'value':!![]}),exports['telegramBotService']=exports[a54_0x3a0f46(0x210)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x3a0f46(0x1d3))),database_1=__importDefault(require(a54_0x3a0f46(0x177))),gateway_1=require(a54_0x3a0f46(0x159));class TelegramBotService{constructor(){const _0x387756=a54_0x3a0f46;this[_0x387756(0x248)]=null,this[_0x387756(0x192)]=process[_0x387756(0x195)][_0x387756(0x1f3)]||'',this['botUsername']=process['env'][_0x387756(0x21d)]||'trapay_bot',this['botToken']?this[_0x387756(0x19f)]():console[_0x387756(0x16f)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a54_0x3a0f46(0x19f)](){const _0x34b8c6=a54_0x3a0f46;try{this[_0x34b8c6(0x248)]=new node_telegram_bot_api_1[(_0x34b8c6(0x230))](this[_0x34b8c6(0x192)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x34b8c6(0x198)](_0x34b8c6(0x1d9)+this[_0x34b8c6(0x15e)]+_0x34b8c6(0x1bb));}catch(_0x385555){console['error'](_0x34b8c6(0x21a),_0x385555);}}[a54_0x3a0f46(0x1b7)](){const _0x2b44e8=a54_0x3a0f46;if(!this[_0x2b44e8(0x248)])return;this['bot'][_0x2b44e8(0x164)](/\/start/,async _0x5aa48f=>{const _0x401a88=_0x2b44e8,_0x2a8928=_0x5aa48f[_0x401a88(0x213)]['id'],_0x1747bb=_0x5aa48f[_0x401a88(0x196)]?.['id'][_0x401a88(0x235)](),_0x4249b3=_0x5aa48f[_0x401a88(0x196)]?.[_0x401a88(0x1a5)],_0x3bfb74=_0x5aa48f['from']?.['first_name'],_0x57cf69=_0x5aa48f[_0x401a88(0x196)]?.['last_name'];if(!_0x1747bb)return;try{let _0x589f8f=await database_1['default'][_0x401a88(0x20d)][_0x401a88(0x249)]({'where':{'telegramId':_0x1747bb},'include':{'shop':!![]}});!_0x589f8f?(_0x589f8f=await database_1[_0x401a88(0x230)]['telegramUser'][_0x401a88(0x16d)]({'data':{'telegramId':_0x1747bb,'username':_0x4249b3,'firstName':_0x3bfb74,'lastName':_0x57cf69,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x401a88(0x198)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x1747bb+_0x401a88(0x21e)+_0x4249b3+')')):_0x589f8f=await database_1[_0x401a88(0x230)][_0x401a88(0x20d)][_0x401a88(0x1b5)]({'where':{'telegramId':_0x1747bb},'data':{'username':_0x4249b3,'firstName':_0x3bfb74,'lastName':_0x57cf69},'include':{'shop':!![]}}),_0x589f8f[_0x401a88(0x233)]&&_0x589f8f[_0x401a88(0x1f8)]&&_0x589f8f[_0x401a88(0x1cd)]?await this[_0x401a88(0x248)]?.[_0x401a88(0x204)](_0x2a8928,_0x401a88(0x1f6)+(_0x401a88(0x184)+_0x589f8f[_0x401a88(0x1cd)][_0x401a88(0x1d6)]+'*\x0a')+(_0x401a88(0x1dd)+_0x589f8f[_0x401a88(0x1cd)][_0x401a88(0x1a5)]+_0x401a88(0x1cb))+_0x401a88(0x20c)+_0x401a88(0x22e)+_0x401a88(0x231)+_0x401a88(0x157)+'Commands:\x0a'+_0x401a88(0x1b1)+_0x401a88(0x217),{'parse_mode':_0x401a88(0x1bc)}):(_0x589f8f['shopId']&&!_0x589f8f[_0x401a88(0x233)]&&(await database_1[_0x401a88(0x230)][_0x401a88(0x20d)]['update']({'where':{'telegramId':_0x1747bb},'data':{'shopId':null,'isVerified':![]}}),console[_0x401a88(0x198)](_0x401a88(0x206)+_0x1747bb)),await this[_0x401a88(0x248)]?.[_0x401a88(0x204)](_0x2a8928,_0x401a88(0x23e)+_0x401a88(0x20b)+_0x401a88(0x1de)+'Example:\x0a'+_0x401a88(0x1af)+_0x401a88(0x1c8),{'parse_mode':_0x401a88(0x1bc)}));}catch(_0xf4f246){console[_0x401a88(0x166)](_0x401a88(0x240),_0xf4f246),await this[_0x401a88(0x248)]?.[_0x401a88(0x204)](_0x2a8928,_0x401a88(0x18f));}}),this[_0x2b44e8(0x248)][_0x2b44e8(0x164)](/\/disconnect/,async _0x4ac391=>{const _0x7febdf=_0x2b44e8,_0x34445b=_0x4ac391[_0x7febdf(0x213)]['id'],_0x21f864=_0x4ac391[_0x7febdf(0x196)]?.['id'][_0x7febdf(0x235)]();if(!_0x21f864)return;try{const _0x2f4250=await database_1[_0x7febdf(0x230)][_0x7febdf(0x20d)][_0x7febdf(0x249)]({'where':{'telegramId':_0x21f864},'include':{'shop':!![]}});if(!_0x2f4250||!_0x2f4250[_0x7febdf(0x233)]||!_0x2f4250['shopId']){await this[_0x7febdf(0x248)]?.[_0x7febdf(0x204)](_0x34445b,_0x7febdf(0x21c));return;}const _0x202a5a=_0x2f4250['shop']?.[_0x7febdf(0x1d6)]||_0x7febdf(0x17f);await database_1['default'][_0x7febdf(0x20d)][_0x7febdf(0x1b5)]({'where':{'telegramId':_0x21f864},'data':{'shopId':null,'isVerified':![]}}),console[_0x7febdf(0x198)](_0x7febdf(0x16b)+_0x21f864+_0x7febdf(0x156)+_0x2f4250[_0x7febdf(0x1f8)]),await this['bot']?.[_0x7febdf(0x204)](_0x34445b,_0x7febdf(0x15d)+_0x202a5a+_0x7febdf(0x1e8)+_0x7febdf(0x1c5),{'parse_mode':_0x7febdf(0x1bc)});}catch(_0x573108){console[_0x7febdf(0x166)](_0x7febdf(0x228),_0x573108),await this[_0x7febdf(0x248)]?.[_0x7febdf(0x204)](_0x34445b,_0x7febdf(0x18f));}}),this[_0x2b44e8(0x248)][_0x2b44e8(0x164)](/\/status/,async _0x5618f3=>{const _0x5ebd8b=_0x2b44e8,_0x302528=_0x5618f3[_0x5ebd8b(0x213)]['id'],_0x539418=_0x5618f3['from']?.['id']['toString']();if(!_0x539418)return;try{const _0x47db7b=await database_1[_0x5ebd8b(0x230)][_0x5ebd8b(0x20d)][_0x5ebd8b(0x249)]({'where':{'telegramId':_0x539418},'include':{'shop':!![]}});if(!_0x47db7b){await this['bot']?.[_0x5ebd8b(0x204)](_0x302528,_0x5ebd8b(0x15f)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x47db7b['isVerified']||!_0x47db7b[_0x5ebd8b(0x1f8)]||!_0x47db7b[_0x5ebd8b(0x1cd)]){await this[_0x5ebd8b(0x248)]?.[_0x5ebd8b(0x204)](_0x302528,_0x5ebd8b(0x1ab)+_0x5ebd8b(0x1cf));return;}await this['bot']?.[_0x5ebd8b(0x204)](_0x302528,'📊\x20*Connection\x20Status*\x0a\x0a'+('✅\x20Connected\x20to\x20shop:\x20*'+_0x47db7b[_0x5ebd8b(0x1cd)][_0x5ebd8b(0x1d6)]+'*\x0a')+(_0x5ebd8b(0x1eb)+_0x47db7b[_0x5ebd8b(0x1cd)][_0x5ebd8b(0x1a5)]+'`\x0a')+(_0x5ebd8b(0x1fd)+_0x47db7b['updatedAt'][_0x5ebd8b(0x214)](_0x5ebd8b(0x155))+'\x0a\x0a')+_0x5ebd8b(0x1dc)+_0x5ebd8b(0x1ed)+_0x5ebd8b(0x217),{'parse_mode':_0x5ebd8b(0x1bc)});}catch(_0x27226c){console[_0x5ebd8b(0x166)]('Error\x20handling\x20/status\x20command:',_0x27226c),await this['bot']?.['sendMessage'](_0x302528,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x2b44e8(0x248)][_0x2b44e8(0x164)](/\/debug/,async _0x5e1960=>{const _0x4349aa=_0x2b44e8,_0x493b22=_0x5e1960[_0x4349aa(0x213)]['id'],_0x152104=_0x5e1960[_0x4349aa(0x196)]?.['id'][_0x4349aa(0x235)]();if(!_0x152104)return;try{const _0xe8d86e=await database_1[_0x4349aa(0x230)]['shop']['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x191b12=_0x4349aa(0x239);_0x191b12+=_0x4349aa(0x170)+_0x152104+_0x4349aa(0x1cb),_0x191b12+=_0x4349aa(0x223),_0xe8d86e[_0x4349aa(0x180)]((_0x582af4,_0x14b29b)=>{const _0xd061cd=_0x4349aa;_0x191b12+=_0x14b29b+0x1+_0xd061cd(0x1fc)+_0x582af4['name']+'*\x0a',_0x191b12+=_0xd061cd(0x1c0)+_0x582af4[_0xd061cd(0x1a5)]+'`\x0a',_0x191b12+=_0xd061cd(0x188)+_0x582af4[_0xd061cd(0x179)]+'\x0a',_0x191b12+='\x20\x20\x20Public\x20Key:\x20`'+_0x582af4[_0xd061cd(0x197)][_0xd061cd(0x1b3)](0x0,0xf)+_0xd061cd(0x173);}),await this[_0x4349aa(0x248)]?.[_0x4349aa(0x204)](_0x493b22,_0x191b12,{'parse_mode':_0x4349aa(0x1bc)});}catch(_0x5362f7){console[_0x4349aa(0x166)](_0x4349aa(0x1c3),_0x5362f7),await this['bot']?.[_0x4349aa(0x204)](_0x493b22,_0x4349aa(0x1e9));}}),this[_0x2b44e8(0x248)]['on'](_0x2b44e8(0x1c9),async _0x30e11c=>{const _0x2e6186=_0x2b44e8;if(_0x30e11c[_0x2e6186(0x193)]?.['startsWith']('/'))return;const _0xa2a0eb=_0x30e11c[_0x2e6186(0x213)]['id'],_0x2de859=_0x30e11c['from']?.['id'][_0x2e6186(0x235)](),_0x39932c=_0x30e11c[_0x2e6186(0x193)]?.[_0x2e6186(0x232)]();if(!_0x2de859||!_0x39932c)return;try{const _0x28054b=await database_1[_0x2e6186(0x230)][_0x2e6186(0x20d)][_0x2e6186(0x249)]({'where':{'telegramId':_0x2de859},'include':{'shop':!![]}});if(!_0x28054b){await this['bot']?.['sendMessage'](_0xa2a0eb,_0x2e6186(0x221));return;}if(_0x28054b[_0x2e6186(0x233)]&&_0x28054b[_0x2e6186(0x1f8)]&&_0x28054b[_0x2e6186(0x1cd)]){await this[_0x2e6186(0x248)]?.['sendMessage'](_0xa2a0eb,_0x2e6186(0x1e3)+_0x28054b['shop']['name']+_0x2e6186(0x1e8)+_0x2e6186(0x247),{'parse_mode':_0x2e6186(0x1bc)});return;}const _0x278fc4=_0x39932c[_0x2e6186(0x1d5)](/\s+/);if(_0x278fc4[_0x2e6186(0x1fe)]!==0x2){await this[_0x2e6186(0x248)]?.[_0x2e6186(0x204)](_0xa2a0eb,_0x2e6186(0x1da)+_0x2e6186(0x1de)+_0x2e6186(0x23c)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x2e6186(0x18b)+_0x278fc4[_0x2e6186(0x1fe)]+_0x2e6186(0x22f)+_0x278fc4['map'](_0x21973d=>'`'+_0x21973d+'`')[_0x2e6186(0x175)](',\x20')),{'parse_mode':_0x2e6186(0x1bc)});return;}const [_0x31b223,_0x378d59]=_0x278fc4;console['log'](_0x2e6186(0x16c)+_0x2de859+_0x2e6186(0x1f5)+_0x31b223+_0x2e6186(0x1e2)+_0x378d59[_0x2e6186(0x1b3)](0x0,0xa)+_0x2e6186(0x1c2)),await this[_0x2e6186(0x1e0)](_0xa2a0eb,_0x2de859,_0x31b223,_0x378d59);}catch(_0x4311ae){console[_0x2e6186(0x166)](_0x2e6186(0x22b),_0x4311ae),await this['bot']?.[_0x2e6186(0x204)](_0xa2a0eb,_0x2e6186(0x18f));}}),this[_0x2b44e8(0x248)]['on']('error',_0x29a2e4=>{const _0x4f580b=_0x2b44e8;console['error'](_0x4f580b(0x1b9),_0x29a2e4);}),this[_0x2b44e8(0x248)]['on'](_0x2b44e8(0x215),_0x1f470e=>{const _0x1fd737=_0x2b44e8;console['error'](_0x1fd737(0x227),_0x1f470e);});}async[a54_0x3a0f46(0x1e0)](_0x17eb34,_0x5a9306,_0x2ad6fb,_0x3c18b9){const _0x463ad2=a54_0x3a0f46;try{console[_0x463ad2(0x198)](_0x463ad2(0x16c)+_0x5a9306+_0x463ad2(0x1f5)+_0x2ad6fb+'\x22,\x20apiKey=\x22'+_0x3c18b9[_0x463ad2(0x1b3)](0x0,0xa)+_0x463ad2(0x1c2));if(!_0x2ad6fb||_0x2ad6fb[_0x463ad2(0x1fe)]<0x3||_0x2ad6fb[_0x463ad2(0x1fe)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x2ad6fb)){await this[_0x463ad2(0x248)]?.[_0x463ad2(0x204)](_0x17eb34,_0x463ad2(0x18d)+_0x2ad6fb+_0x463ad2(0x1cb)+_0x463ad2(0x22d),{'parse_mode':_0x463ad2(0x1bc)});return;}if(!_0x3c18b9||!_0x3c18b9[_0x463ad2(0x183)]('pk_')&&!_0x3c18b9[_0x463ad2(0x183)](_0x463ad2(0x203))){await this['bot']?.[_0x463ad2(0x204)](_0x17eb34,_0x463ad2(0x174)+_0x463ad2(0x1b6),{'parse_mode':_0x463ad2(0x1bc)});return;}const _0xd13aa3=await database_1[_0x463ad2(0x230)]['shop']['findUnique']({'where':{'username':_0x2ad6fb},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0xd13aa3){const _0x1fd7fa=await database_1[_0x463ad2(0x230)][_0x463ad2(0x1cd)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x321eaa=_0x463ad2(0x23f)+_0x2ad6fb+_0x463ad2(0x1a4);_0x1fd7fa['length']>0x0?(_0x321eaa+=_0x463ad2(0x1e5),_0x1fd7fa[_0x463ad2(0x180)](_0x15686c=>{const _0x1eb4c0=_0x463ad2;_0x321eaa+=_0x1eb4c0(0x23a)+_0x15686c[_0x1eb4c0(0x1a5)]+_0x1eb4c0(0x220)+_0x15686c[_0x1eb4c0(0x1d6)]+')\x0a';}),_0x321eaa+=_0x463ad2(0x1c4)):_0x321eaa+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x463ad2(0x248)]?.['sendMessage'](_0x17eb34,_0x321eaa,{'parse_mode':_0x463ad2(0x1bc)});return;}if(_0xd13aa3['status']!==_0x463ad2(0x1f7)){const _0x396956=_0xd13aa3[_0x463ad2(0x179)]===_0x463ad2(0x207)?_0x463ad2(0x1f1)+_0x2ad6fb+_0x463ad2(0x1ad)+_0x463ad2(0x1b0)+_0x463ad2(0x1df):'❌\x20Shop\x20`'+_0x2ad6fb+_0x463ad2(0x20a)+_0x463ad2(0x17e);await this[_0x463ad2(0x248)]?.[_0x463ad2(0x204)](_0x17eb34,_0x396956,{'parse_mode':_0x463ad2(0x1bc)});return;}if(_0xd13aa3['publicKey']!==_0x3c18b9&&_0xd13aa3['secretKey']!==_0x3c18b9){await this[_0x463ad2(0x248)]?.['sendMessage'](_0x17eb34,_0x463ad2(0x224)+_0x2ad6fb+_0x463ad2(0x1bf)+_0x463ad2(0x241)+_0x463ad2(0x209),{'parse_mode':_0x463ad2(0x1bc)});return;}const _0xaf21fc=await database_1[_0x463ad2(0x230)]['telegramUser'][_0x463ad2(0x245)]({'where':{'shopId':_0xd13aa3['id'],'isVerified':!![],'telegramId':{'not':_0x5a9306}}});if(_0xaf21fc){await this[_0x463ad2(0x248)]?.[_0x463ad2(0x204)](_0x17eb34,_0x463ad2(0x15c)+_0x2ad6fb+_0x463ad2(0x1bf)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':'Markdown'});return;}await database_1[_0x463ad2(0x230)]['telegramUser'][_0x463ad2(0x1b5)]({'where':{'telegramId':_0x5a9306},'data':{'shopId':_0xd13aa3['id'],'isVerified':!![]}}),await this['bot']?.['sendMessage'](_0x17eb34,_0x463ad2(0x161)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('📱\x20Shop:\x20*'+_0xd13aa3[_0x463ad2(0x1d6)]+'*\x0a')+(_0x463ad2(0x1eb)+_0xd13aa3[_0x463ad2(0x1a5)]+_0x463ad2(0x1cb))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x463ad2(0x22e)+'•\x20Payment\x20status\x20changes\x0a'+_0x463ad2(0x1a0)+_0x463ad2(0x205)+'Commands:\x0a'+_0x463ad2(0x1b1)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x463ad2(0x1bc)}),console[_0x463ad2(0x198)]('✅\x20Telegram\x20user\x20'+_0x5a9306+_0x463ad2(0x238)+_0xd13aa3[_0x463ad2(0x1a5)]+_0x463ad2(0x1f2));}catch(_0x125f89){console[_0x463ad2(0x166)](_0x463ad2(0x158),_0x125f89),await this[_0x463ad2(0x248)]?.[_0x463ad2(0x204)](_0x17eb34,_0x463ad2(0x22a));}}async[a54_0x3a0f46(0x1ea)](_0x214ff6,_0x2cd698,_0x20054d){const _0x41be53=a54_0x3a0f46;if(!this[_0x41be53(0x248)]){console[_0x41be53(0x16f)](_0x41be53(0x186));return;}try{const _0x5a4ebb=await database_1[_0x41be53(0x230)][_0x41be53(0x20d)]['findMany']({'where':{'shopId':_0x214ff6,'isVerified':!![]}});if(_0x5a4ebb[_0x41be53(0x1fe)]===0x0){console[_0x41be53(0x198)](_0x41be53(0x1d2)+_0x214ff6);return;}const _0x238667=_0x5a4ebb[_0x41be53(0x201)](async _0x20191a=>{const _0xc25db5=_0x41be53;try{await this['bot']?.[_0xc25db5(0x204)](_0x20191a[_0xc25db5(0x1a6)],_0x2cd698,_0x20054d),console['log'](_0xc25db5(0x1a9)+_0x20191a[_0xc25db5(0x1a6)]);}catch(_0x502046){console['error'](_0xc25db5(0x1fb)+_0x20191a[_0xc25db5(0x1a6)]+':',_0x502046),_0x502046 instanceof Error&&(_0x502046[_0xc25db5(0x1c9)][_0xc25db5(0x1ec)](_0xc25db5(0x20f))||_0x502046[_0xc25db5(0x1c9)][_0xc25db5(0x1ec)](_0xc25db5(0x1bd))||_0x502046[_0xc25db5(0x1c9)][_0xc25db5(0x1ec)](_0xc25db5(0x1c6)))&&(await database_1[_0xc25db5(0x230)][_0xc25db5(0x20d)]['update']({'where':{'id':_0x20191a['id']},'data':{'isVerified':![]}}),console['log'](_0xc25db5(0x194)+_0x20191a['telegramId']+_0xc25db5(0x1aa)));}});await Promise[_0x41be53(0x189)](_0x238667);}catch(_0x27b730){console[_0x41be53(0x166)](_0x41be53(0x211),_0x27b730);}}async[a54_0x3a0f46(0x21f)](_0x3ff6f0,_0x251b09,_0x5147fd){const _0x21d348=a54_0x3a0f46,_0x4493c4={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x375461={'created':'New\x20payment\x20created','paid':_0x21d348(0x1ac),'failed':'Payment\x20failed','expired':'Payment\x20expired','refund':_0x21d348(0x225),'chargeback':_0x21d348(0x172),'processing':_0x21d348(0x19d)},_0x1778a9=_0x4493c4[_0x5147fd],_0x4a4a49=_0x375461[_0x5147fd],_0x5cc4eb=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x251b09[_0x21d348(0x162)]);console[_0x21d348(0x198)](_0x21d348(0x23d)+_0x251b09[_0x21d348(0x162)]+_0x21d348(0x16a)+_0x5cc4eb+'\x22');let _0x32fff4=_0x1778a9+'\x20*'+_0x4a4a49+_0x21d348(0x208)+('💰\x20Amount:\x20*'+_0x251b09['amount']+'\x20'+_0x251b09[_0x21d348(0x1b2)]+'*\x0a')+(_0x21d348(0x168)+(_0x251b09[_0x21d348(0x163)]||_0x251b09['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x251b09['id']+'`\x0a')+(_0x21d348(0x1c7)+_0x5cc4eb+'`\x0a')+(_0x21d348(0x199)+new Date(_0x251b09[_0x21d348(0x1d1)])[_0x21d348(0x182)](_0x21d348(0x155))+'\x0a');(_0x251b09['customerName']||_0x251b09['customerEmail']||_0x251b09[_0x21d348(0x187)]||_0x251b09[_0x21d348(0x1ba)])&&(_0x32fff4+='\x0a👤\x20*Customer\x20Information:*\x0a',_0x251b09[_0x21d348(0x1ee)]&&(_0x32fff4+=_0x21d348(0x160)+_0x251b09[_0x21d348(0x1ee)]+'`\x0a'),_0x251b09[_0x21d348(0x191)]&&(_0x32fff4+=_0x21d348(0x1a1)+_0x251b09[_0x21d348(0x191)]+'`\x0a'),_0x251b09['customerIp']&&(_0x32fff4+=_0x21d348(0x1a8)+_0x251b09['customerIp']+'`\x0a'),_0x251b09[_0x21d348(0x1ba)]&&(_0x32fff4+='🗺️\x20Country:\x20`'+_0x251b09[_0x21d348(0x1ba)]+'`\x0a'));if(_0x251b09[_0x21d348(0x162)]===_0x21d348(0x15a)&&_0x251b09[_0x21d348(0x229)]){_0x32fff4+=_0x21d348(0x17b),_0x32fff4+=_0x21d348(0x185)+_0x251b09[_0x21d348(0x229)]+'`\x0a';_0x251b09[_0x21d348(0x222)]&&(_0x32fff4+=_0x21d348(0x1db)+_0x251b09[_0x21d348(0x222)]+'`\x0a');if(_0x251b09[_0x21d348(0x187)]&&_0x251b09['customerCountry'])_0x32fff4+='🌍\x20From:\x20`'+_0x251b09[_0x21d348(0x1ba)]+_0x21d348(0x244)+_0x251b09[_0x21d348(0x187)]+_0x21d348(0x181);else{if(_0x251b09[_0x21d348(0x187)])_0x32fff4+=_0x21d348(0x1a8)+_0x251b09[_0x21d348(0x187)]+'`\x0a';else _0x251b09[_0x21d348(0x1ba)]&&(_0x32fff4+=_0x21d348(0x218)+_0x251b09[_0x21d348(0x1ba)]+'`\x0a');}}else(_0x251b09[_0x21d348(0x1fa)]||_0x251b09[_0x21d348(0x1e4)]||_0x251b09[_0x21d348(0x21b)]||_0x251b09['remitterIban'])&&(_0x32fff4+=_0x21d348(0x1d4),_0x251b09[_0x21d348(0x1fa)]&&(_0x32fff4+=_0x21d348(0x1ff)+_0x251b09[_0x21d348(0x1fa)]+'`\x0a'),_0x251b09[_0x21d348(0x1e4)]&&(_0x32fff4+=_0x21d348(0x242)+_0x251b09[_0x21d348(0x1e4)]+'`\x0a'),_0x251b09[_0x21d348(0x21b)]&&(_0x32fff4+=_0x21d348(0x165)+_0x251b09[_0x21d348(0x21b)]+'`\x0a'),_0x251b09['remitterIban']&&(_0x32fff4+=_0x21d348(0x185)+_0x251b09[_0x21d348(0x229)]+'`\x0a'),_0x251b09['remitterName']&&(_0x32fff4+=_0x21d348(0x16e)+_0x251b09[_0x21d348(0x222)]+'`\x0a'));_0x5147fd==='chargeback'&&_0x251b09['chargebackAmount']&&(_0x32fff4+='💸\x20Penalty\x20amount:\x20*'+_0x251b09[_0x21d348(0x1e6)]+'\x20USDT*\x0a'),_0x5147fd===_0x21d348(0x1a3)&&(_0x32fff4+=_0x21d348(0x17c)),_0x251b09[_0x21d348(0x212)]&&(_0x32fff4+=_0x21d348(0x1ce)+_0x251b09['adminNotes']+'\x0a'),await this[_0x21d348(0x1ea)](_0x3ff6f0,_0x32fff4,{'parse_mode':'Markdown'});}async[a54_0x3a0f46(0x17a)](_0x51312a,_0x1dab36,_0xf13581){const _0x9af660=a54_0x3a0f46,_0x345eb4={'created':'📤','completed':'✅','rejected':'❌'},_0x1b264c={'created':'New\x20payout\x20created','completed':_0x9af660(0x23b),'rejected':_0x9af660(0x22c)},_0x31fb07=_0x345eb4[_0xf13581],_0x59f6d1=_0x1b264c[_0xf13581],_0x518785=_0x31fb07+'\x20*'+_0x59f6d1+'*\x0a\x0a'+(_0x9af660(0x17d)+_0x1dab36[_0x9af660(0x190)]+_0x9af660(0x19a))+(_0x9af660(0x1ca)+_0x1dab36['method']+'`\x0a')+(_0x9af660(0x202)+_0x1dab36['id']+'`\x0a')+(_0x9af660(0x199)+new Date(_0x1dab36['createdAt'])[_0x9af660(0x182)](_0x9af660(0x155))+'\x0a')+(_0x1dab36['txid']?'🔗\x20TXID:\x20`'+_0x1dab36[_0x9af660(0x15b)]+'`':'');await this[_0x9af660(0x1ea)](_0x51312a,_0x518785,{'parse_mode':_0x9af660(0x1bc)});}async['sendLoginNotification'](_0x52a578,_0x4b3bbe){const _0x2e230a=a54_0x3a0f46;try{const _0x375c67=await database_1[_0x2e230a(0x230)][_0x2e230a(0x19e)][_0x2e230a(0x249)]({'where':{'shopId':_0x52a578},'select':{'notificationLogin':!![]}});if(!_0x375c67?.['notificationLogin']){console[_0x2e230a(0x198)](_0x2e230a(0x1b4)+_0x52a578);return;}const _0x10ba20=_0x4b3bbe['success']?'🔐':'🚨',_0x5b9295=_0x4b3bbe['success']?_0x2e230a(0x1be):'Failed\x20login\x20attempt';let _0x359ba4=_0x10ba20+'\x20*'+_0x5b9295+_0x2e230a(0x208)+(_0x2e230a(0x1eb)+_0x4b3bbe[_0x2e230a(0x1a5)]+'`\x0a')+(_0x2e230a(0x169)+_0x4b3bbe[_0x2e230a(0x1f9)][_0x2e230a(0x182)](_0x2e230a(0x155))+'\x0a');_0x4b3bbe[_0x2e230a(0x1ef)]&&(_0x359ba4+='🌐\x20IP\x20address:\x20`'+_0x4b3bbe['ipAddress']+'`\x0a');if(_0x4b3bbe[_0x2e230a(0x1a7)]){const _0x35fc74=_0x4b3bbe[_0x2e230a(0x1a7)]['length']>0x32?_0x4b3bbe[_0x2e230a(0x1a7)][_0x2e230a(0x1b3)](0x0,0x32)+_0x2e230a(0x178):_0x4b3bbe[_0x2e230a(0x1a7)];_0x359ba4+=_0x2e230a(0x1b8)+_0x35fc74+'`\x0a';}!_0x4b3bbe[_0x2e230a(0x1d7)]&&(_0x359ba4+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x2e230a(0x1ea)](_0x52a578,_0x359ba4,{'parse_mode':_0x2e230a(0x1bc)}),console[_0x2e230a(0x198)](_0x2e230a(0x1f4)+_0x52a578+':\x20'+(_0x4b3bbe['success']?_0x2e230a(0x1d7):_0x2e230a(0x1e7)));}catch(_0xefeb6e){console[_0x2e230a(0x166)]('Failed\x20to\x20send\x20login\x20notification:',_0xefeb6e);}}async['sendApiErrorNotification'](_0x39b4a0,_0x1fc8e7){const _0xfdb0e=a54_0x3a0f46;try{const _0x530e50=await database_1[_0xfdb0e(0x230)][_0xfdb0e(0x19e)][_0xfdb0e(0x249)]({'where':{'shopId':_0x39b4a0},'select':{'notificationApiError':!![]}});if(!_0x530e50?.[_0xfdb0e(0x1c1)]){console[_0xfdb0e(0x198)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x39b4a0);return;}let _0x42446a='🚨\x20*API\x20Error*\x0a\x0a'+(_0xfdb0e(0x234)+_0x1fc8e7['method']+'\x20'+_0x1fc8e7[_0xfdb0e(0x1f0)]+'`\x0a')+('📅\x20Time:\x20'+_0x1fc8e7[_0xfdb0e(0x1f9)][_0xfdb0e(0x182)](_0xfdb0e(0x155))+'\x0a');_0x1fc8e7[_0xfdb0e(0x236)]&&(_0x42446a+=_0xfdb0e(0x1cc)+_0x1fc8e7[_0xfdb0e(0x236)]+'`\x0a'),_0x42446a+=_0xfdb0e(0x19b)+_0x1fc8e7['errorMessage']+'`\x0a',_0x1fc8e7[_0xfdb0e(0x246)]&&(_0x42446a+='🆔\x20Request\x20ID:\x20`'+_0x1fc8e7['requestId']+'`\x0a'),_0x42446a+=_0xfdb0e(0x1a2),await this[_0xfdb0e(0x1ea)](_0x39b4a0,_0x42446a,{'parse_mode':_0xfdb0e(0x1bc)}),console[_0xfdb0e(0x198)](_0xfdb0e(0x200)+_0x39b4a0+':\x20'+_0x1fc8e7['endpoint']);}catch(_0x176afb){console[_0xfdb0e(0x166)](_0xfdb0e(0x20e),_0x176afb);}}async[a54_0x3a0f46(0x18e)](_0x4879f4,_0x536afe,_0x3e7314){const _0x1e4add=a54_0x3a0f46;let _0x17d1f5=_0x1e4add(0x226)+_0x536afe+'*\x0a\x0a';for(const [_0x5e7bb0,_0x197fed]of Object['entries'](_0x3e7314)){_0x197fed!==null&&_0x197fed!==undefined&&(_0x17d1f5+=_0x5e7bb0+':\x20`'+_0x197fed+'`\x0a');}await this[_0x1e4add(0x1ea)](_0x4879f4,_0x17d1f5,{'parse_mode':'Markdown'});}[a54_0x3a0f46(0x1e1)](){const _0x431426=a54_0x3a0f46;return{'isActive':!!this[_0x431426(0x248)],'username':this['botUsername']};}[a54_0x3a0f46(0x176)](){const _0x2cd1f7=a54_0x3a0f46;this[_0x2cd1f7(0x248)]&&(this['bot']['stopPolling'](),this['bot']=null,console['log']('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a54_0x3a0f46(0x210)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();function a54_0x42cc(){const _0x3a1ee3=['Error\x20handling\x20/debug\x20command:','\x0aCheck\x20spelling\x20and\x20try\x20again.','To\x20reconnect,\x20use\x20the\x20/start\x20command','user\x20is\x20deactivated','🏪\x20Gateway:\x20`','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','message','🏦\x20Method:\x20`','`\x0a\x0a','📊\x20Error\x20code:\x20`','shop','📝\x20Notes:\x20','Use\x20/start\x20to\x20connect.','2068080Dyhcat','createdAt','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','node-telegram-bot-api','\x0a💳\x20*Payment\x20Details:*\x0a','split','name','success','7974RRCVuO','✅\x20Telegram\x20bot\x20@','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','👤\x20Sender:\x20`','🔔\x20Notifications\x20are\x20active\x0a\x0a','Username:\x20`','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Contact\x20administrator\x20to\x20restore\x20full\x20access.','handleSingleLineVerification','getBotInfo','\x22,\x20apiKey=\x22','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','cardLast4','Available\x20usernames:\x0a','chargebackAmount','failed','*.\x0a\x0a','❌\x20Error\x20getting\x20debug\x20information.','sendShopNotification','👤\x20Username:\x20`','includes','Commands:\x0a','customerName','ipAddress','endpoint','⚠️\x20Shop\x20`','\x20via\x20single-line\x20input','TELEGRAM_BOT_TOKEN','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20',':\x20username=\x22','✅\x20Welcome\x20back!\x0a\x0a','ACTIVE','shopId','timestamp','paymentMethod','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','.\x20*','📅\x20Connection\x20date:\x20','length','💰\x20Method:\x20`','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','map','🆔\x20Payout\x20ID:\x20`','sk_','sendMessage','•\x20Important\x20events\x0a\x0a','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','SUSPENDED','*\x0a\x0a','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','`\x20is\x20inactive.\x0a\x0a','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','🔔\x20You\x20receive\x20notifications\x20about:\x0a','telegramUser','Failed\x20to\x20send\x20API\x20error\x20notification:','blocked','TelegramBotService','Error\x20sending\x20shop\x20notification:','adminNotes','chat','toLocaleDateString','polling_error','392160bQZQNR','/disconnect\x20-\x20disconnect\x20from\x20notifications','🗺️\x20Country:\x20`','368887AFBUNt','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','bankId','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','TELEGRAM_BOT_USERNAME','\x20(@','sendPaymentNotification','`\x20(','❌\x20Please\x20use\x20/start\x20command\x20first','remitterName','🏪\x20Available\x20shops\x20in\x20system:\x0a','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','Payment\x20refund','🔔\x20*','Telegram\x20bot\x20polling\x20error:','Error\x20handling\x20/disconnect\x20command:','remitterIban','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Error\x20handling\x20message:','Payout\x20rejected','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','•\x20New\x20payments\x0a','\x20parts:\x20','default','•\x20Payment\x20status\x20changes\x0a','trim','isVerified','🔗\x20Endpoint:\x20`','toString','statusCode','575519hfCmUU','\x20verified\x20for\x20shop\x20','🔍\x20*Debug\x20Information*\x0a\x0a','•\x20`','Payout\x20completed','Example:\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','❌\x20Shop\x20with\x20username\x20`','Error\x20handling\x20/start\x20command:','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','💳\x20Card:\x20`****','46839MrcpuH','`\x20(IP:\x20`','findFirst','requestId','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','bot','findUnique','en-US','\x20disconnected\x20from\x20shop\x20','•\x20Payouts\x0a\x0a','Error\x20in\x20handleSingleLineVerification:','../types/gateway','cointopay','txid','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','botUsername','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','📛\x20Name:\x20`','🎉\x20*Congratulations!*\x0a\x0a','gateway','orderId','onText','🏦\x20Bank\x20ID:\x20`','error','7464MvELmX','📝\x20Order\x20ID:\x20`','📅\x20Time:\x20','\x22\x20->\x20display\x20\x22','🔌\x20User\x20','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','create','👤\x20Remitter:\x20`','warn','📱\x20Your\x20Telegram\x20ID:\x20`','__esModule','Payment\x20chargeback','...`\x0a\x0a','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','join','stopBot','../config/database','...','status','sendPayoutNotification','\x0a🪙\x20*CoinToPay\x20Details:*\x0a','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','💸\x20Amount:\x20*','Contact\x20administrator.','unknown\x20shop','forEach','`)\x0a','toLocaleString','startsWith','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','🏦\x20IBAN:\x20`','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','customerIp','\x20\x20\x20Status:\x20','allSettled','30cbmRQy','You\x20sent\x20','865010aLcNne','❌\x20Invalid\x20username\x20format:\x20`','sendCustomNotification','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','amount','customerEmail','botToken','text','User\x20','env','from','publicKey','log','📅\x20Date:\x20','\x20USD*\x0a','❌\x20Error:\x20`','defineProperty','Payment\x20is\x20being\x20processed','shopSettings','initializeBot','•\x20Payouts\x0a','📧\x20Email:\x20`','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','processing','`\x20not\x20found.\x0a\x0a','username','telegramId','userAgent','🌐\x20IP:\x20`','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','Payment\x20successfully\x20paid','`\x20is\x20suspended.\x0a\x0a','__importDefault','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','Your\x20account\x20is\x20temporarily\x20suspended.\x20You\x20can\x20view\x20your\x20dashboard\x20but\x20cannot\x20process\x20new\x20payments.\x0a\x0a','/status\x20-\x20check\x20connection\x20status\x0a','currency','substring','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','update','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','setupBotHandlers','💻\x20Browser:\x20`','Telegram\x20bot\x20error:','customerCountry','\x20initialized\x20successfully','Markdown','chat\x20not\x20found','Successful\x20login','`.\x0a\x0a','\x20\x20\x20Username:\x20`','notificationApiError','...\x22'];a54_0x42cc=function(){return _0x3a1ee3;};return a54_0x42cc();}