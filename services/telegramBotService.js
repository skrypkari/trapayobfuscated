'use strict';function a49_0x2706(_0x46e905,_0x2ffeab){const _0x41ac40=a49_0x41ac();return a49_0x2706=function(_0x2706f7,_0x461f64){_0x2706f7=_0x2706f7-0xcf;let _0x1f49f9=_0x41ac40[_0x2706f7];return _0x1f49f9;},a49_0x2706(_0x46e905,_0x2ffeab);}const a49_0x4dab00=a49_0x2706;(function(_0x247459,_0x45f710){const _0x32a7d9=a49_0x2706,_0x5a249b=_0x247459();while(!![]){try{const _0x39a70b=parseInt(_0x32a7d9(0x138))/0x1*(parseInt(_0x32a7d9(0x1ae))/0x2)+-parseInt(_0x32a7d9(0x158))/0x3+-parseInt(_0x32a7d9(0x13d))/0x4+parseInt(_0x32a7d9(0xe7))/0x5*(parseInt(_0x32a7d9(0x181))/0x6)+-parseInt(_0x32a7d9(0x148))/0x7+-parseInt(_0x32a7d9(0xdc))/0x8+parseInt(_0x32a7d9(0xe3))/0x9;if(_0x39a70b===_0x45f710)break;else _0x5a249b['push'](_0x5a249b['shift']());}catch(_0x2d68f5){_0x5a249b['push'](_0x5a249b['shift']());}}}(a49_0x41ac,0x78898));var __importDefault=this&&this[a49_0x4dab00(0x129)]||function(_0x5998dd){const _0x218b65=a49_0x4dab00;return _0x5998dd&&_0x5998dd[_0x218b65(0x10a)]?_0x5998dd:{'default':_0x5998dd};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['telegramBotService']=exports[a49_0x4dab00(0x199)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a49_0x4dab00(0x16c))),database_1=__importDefault(require(a49_0x4dab00(0x194))),gateway_1=require(a49_0x4dab00(0x1af));class TelegramBotService{constructor(){const _0x4ef779=a49_0x4dab00;this[_0x4ef779(0xda)]=null,this[_0x4ef779(0x156)]=process['env'][_0x4ef779(0x13f)]||'',this[_0x4ef779(0x19b)]=process[_0x4ef779(0xec)]['TELEGRAM_BOT_USERNAME']||_0x4ef779(0x134),this[_0x4ef779(0x156)]?this['initializeBot']():console[_0x4ef779(0x118)](_0x4ef779(0x11d));}[a49_0x4dab00(0xcf)](){const _0x26ad8e=a49_0x4dab00;try{this[_0x26ad8e(0xda)]=new node_telegram_bot_api_1['default'](this[_0x26ad8e(0x156)],{'polling':!![]}),this[_0x26ad8e(0xe6)](),console[_0x26ad8e(0x18c)](_0x26ad8e(0xfb)+this[_0x26ad8e(0x19b)]+_0x26ad8e(0x164));}catch(_0x58a169){console[_0x26ad8e(0x151)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x58a169);}}[a49_0x4dab00(0xe6)](){const _0x522528=a49_0x4dab00;if(!this[_0x522528(0xda)])return;this[_0x522528(0xda)][_0x522528(0xf5)](/\/start/,async _0x58f6df=>{const _0x41ed61=_0x522528,_0x233686=_0x58f6df[_0x41ed61(0x150)]['id'],_0x3ac1e6=_0x58f6df[_0x41ed61(0x192)]?.['id'][_0x41ed61(0x104)](),_0x169fc8=_0x58f6df[_0x41ed61(0x192)]?.[_0x41ed61(0x176)],_0x38690c=_0x58f6df[_0x41ed61(0x192)]?.['first_name'],_0x1e3b30=_0x58f6df['from']?.[_0x41ed61(0x130)];if(!_0x3ac1e6)return;try{let _0xbfbf0a=await database_1[_0x41ed61(0xd4)][_0x41ed61(0x160)][_0x41ed61(0x173)]({'where':{'telegramId':_0x3ac1e6},'include':{'shop':!![]}});!_0xbfbf0a?(_0xbfbf0a=await database_1[_0x41ed61(0xd4)][_0x41ed61(0x160)]['create']({'data':{'telegramId':_0x3ac1e6,'username':_0x169fc8,'firstName':_0x38690c,'lastName':_0x1e3b30,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x41ed61(0x14a)+_0x3ac1e6+_0x41ed61(0x182)+_0x169fc8+')')):_0xbfbf0a=await database_1[_0x41ed61(0xd4)][_0x41ed61(0x160)][_0x41ed61(0x161)]({'where':{'telegramId':_0x3ac1e6},'data':{'username':_0x169fc8,'firstName':_0x38690c,'lastName':_0x1e3b30},'include':{'shop':!![]}}),_0xbfbf0a[_0x41ed61(0x106)]&&_0xbfbf0a['shopId']&&_0xbfbf0a[_0x41ed61(0x128)]?await this['bot']?.[_0x41ed61(0x16d)](_0x233686,_0x41ed61(0x170)+(_0x41ed61(0xff)+_0xbfbf0a[_0x41ed61(0x128)]['name']+'*\x0a')+(_0x41ed61(0x113)+_0xbfbf0a[_0x41ed61(0x128)][_0x41ed61(0x176)]+_0x41ed61(0x114))+_0x41ed61(0xef)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+_0x41ed61(0xfc)+_0x41ed61(0x193)+_0x41ed61(0xf0)+_0x41ed61(0x149),{'parse_mode':'Markdown'}):(_0xbfbf0a[_0x41ed61(0x11c)]&&!_0xbfbf0a[_0x41ed61(0x106)]&&(await database_1[_0x41ed61(0xd4)][_0x41ed61(0x160)][_0x41ed61(0x161)]({'where':{'telegramId':_0x3ac1e6},'data':{'shopId':null,'isVerified':![]}}),console[_0x41ed61(0x18c)](_0x41ed61(0x154)+_0x3ac1e6)),await this[_0x41ed61(0xda)]?.[_0x41ed61(0x16d)](_0x233686,_0x41ed61(0xea)+_0x41ed61(0x100)+_0x41ed61(0xed)+'Example:\x0a'+_0x41ed61(0xe0)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x41ed61(0x12f)}));}catch(_0x429013){console['error'](_0x41ed61(0x16a),_0x429013),await this[_0x41ed61(0xda)]?.[_0x41ed61(0x16d)](_0x233686,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x522528(0xda)][_0x522528(0xf5)](/\/disconnect/,async _0x50b714=>{const _0xdff1e1=_0x522528,_0x1ceba9=_0x50b714[_0xdff1e1(0x150)]['id'],_0x2a02c5=_0x50b714[_0xdff1e1(0x192)]?.['id']['toString']();if(!_0x2a02c5)return;try{const _0x286fc0=await database_1['default'][_0xdff1e1(0x160)][_0xdff1e1(0x173)]({'where':{'telegramId':_0x2a02c5},'include':{'shop':!![]}});if(!_0x286fc0||!_0x286fc0[_0xdff1e1(0x106)]||!_0x286fc0[_0xdff1e1(0x11c)]){await this[_0xdff1e1(0xda)]?.[_0xdff1e1(0x16d)](_0x1ceba9,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x358e29=_0x286fc0[_0xdff1e1(0x128)]?.[_0xdff1e1(0x14e)]||'unknown\x20shop';await database_1[_0xdff1e1(0xd4)][_0xdff1e1(0x160)][_0xdff1e1(0x161)]({'where':{'telegramId':_0x2a02c5},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔌\x20User\x20'+_0x2a02c5+_0xdff1e1(0x1a6)+_0x286fc0[_0xdff1e1(0x11c)]),await this[_0xdff1e1(0xda)]?.['sendMessage'](_0x1ceba9,_0xdff1e1(0xe8)+_0x358e29+_0xdff1e1(0x18d)+_0xdff1e1(0x19f),{'parse_mode':_0xdff1e1(0x12f)});}catch(_0x5ba9e5){console['error'](_0xdff1e1(0x17f),_0x5ba9e5),await this[_0xdff1e1(0xda)]?.[_0xdff1e1(0x16d)](_0x1ceba9,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x522528(0xda)][_0x522528(0xf5)](/\/status/,async _0x3add1b=>{const _0x50b404=_0x522528,_0x59ea37=_0x3add1b[_0x50b404(0x150)]['id'],_0x2edbbc=_0x3add1b['from']?.['id']['toString']();if(!_0x2edbbc)return;try{const _0x335004=await database_1[_0x50b404(0xd4)][_0x50b404(0x160)][_0x50b404(0x173)]({'where':{'telegramId':_0x2edbbc},'include':{'shop':!![]}});if(!_0x335004){await this[_0x50b404(0xda)]?.['sendMessage'](_0x59ea37,_0x50b404(0xd6)+_0x50b404(0x125));return;}if(!_0x335004['isVerified']||!_0x335004[_0x50b404(0x11c)]||!_0x335004[_0x50b404(0x128)]){await this[_0x50b404(0xda)]?.[_0x50b404(0x16d)](_0x59ea37,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+'Use\x20/start\x20to\x20connect.');return;}await this[_0x50b404(0xda)]?.[_0x50b404(0x16d)](_0x59ea37,_0x50b404(0xf9)+(_0x50b404(0x17a)+_0x335004[_0x50b404(0x128)][_0x50b404(0x14e)]+'*\x0a')+(_0x50b404(0x15c)+_0x335004[_0x50b404(0x128)][_0x50b404(0x176)]+'`\x0a')+(_0x50b404(0x10d)+_0x335004[_0x50b404(0x189)][_0x50b404(0x172)]('en-US')+'\x0a\x0a')+_0x50b404(0xe4)+_0x50b404(0x193)+_0x50b404(0x149),{'parse_mode':_0x50b404(0x12f)});}catch(_0x18a760){console[_0x50b404(0x151)](_0x50b404(0x127),_0x18a760),await this['bot']?.['sendMessage'](_0x59ea37,_0x50b404(0x139));}}),this[_0x522528(0xda)]['onText'](/\/debug/,async _0x632208=>{const _0x818e92=_0x522528,_0x3b1ab9=_0x632208[_0x818e92(0x150)]['id'],_0x3560f1=_0x632208[_0x818e92(0x192)]?.['id'][_0x818e92(0x104)]();if(!_0x3560f1)return;try{const _0x470ee9=await database_1[_0x818e92(0xd4)][_0x818e92(0x128)][_0x818e92(0x10e)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0xb42ab1=_0x818e92(0x12c);_0xb42ab1+=_0x818e92(0x111)+_0x3560f1+_0x818e92(0x114),_0xb42ab1+=_0x818e92(0xd3),_0x470ee9['forEach']((_0x51ce15,_0x2e2b1e)=>{const _0x104760=_0x818e92;_0xb42ab1+=_0x2e2b1e+0x1+_0x104760(0x16b)+_0x51ce15[_0x104760(0x14e)]+'*\x0a',_0xb42ab1+=_0x104760(0x157)+_0x51ce15['username']+'`\x0a',_0xb42ab1+=_0x104760(0x195)+_0x51ce15[_0x104760(0x109)]+'\x0a',_0xb42ab1+=_0x104760(0x102)+_0x51ce15[_0x104760(0x185)]['substring'](0x0,0xf)+_0x104760(0x17c);}),await this[_0x818e92(0xda)]?.[_0x818e92(0x16d)](_0x3b1ab9,_0xb42ab1,{'parse_mode':_0x818e92(0x12f)});}catch(_0x1ff880){console[_0x818e92(0x151)](_0x818e92(0xe2),_0x1ff880),await this[_0x818e92(0xda)]?.[_0x818e92(0x16d)](_0x3b1ab9,_0x818e92(0x145));}}),this[_0x522528(0xda)]['on'](_0x522528(0x1ac),async _0x227122=>{const _0x5128ea=_0x522528;if(_0x227122[_0x5128ea(0x1a5)]?.['startsWith']('/'))return;const _0x434f3f=_0x227122[_0x5128ea(0x150)]['id'],_0x2efec7=_0x227122[_0x5128ea(0x192)]?.['id'][_0x5128ea(0x104)](),_0x31456e=_0x227122['text']?.[_0x5128ea(0x135)]();if(!_0x2efec7||!_0x31456e)return;try{const _0x5707ef=await database_1[_0x5128ea(0xd4)][_0x5128ea(0x160)][_0x5128ea(0x173)]({'where':{'telegramId':_0x2efec7},'include':{'shop':!![]}});if(!_0x5707ef){await this[_0x5128ea(0xda)]?.[_0x5128ea(0x16d)](_0x434f3f,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x5707ef[_0x5128ea(0x106)]&&_0x5707ef['shopId']&&_0x5707ef['shop']){await this[_0x5128ea(0xda)]?.[_0x5128ea(0x16d)](_0x434f3f,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x5707ef['shop']['name']+'*.\x0a\x0a'+_0x5128ea(0x187),{'parse_mode':_0x5128ea(0x12f)});return;}const _0x259f32=_0x31456e[_0x5128ea(0x11e)](/\s+/);if(_0x259f32[_0x5128ea(0x1a9)]!==0x2){await this['bot']?.[_0x5128ea(0x16d)](_0x434f3f,_0x5128ea(0x1ad)+_0x5128ea(0xed)+_0x5128ea(0x19e)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x5128ea(0x171)+_0x259f32['length']+'\x20parts:\x20'+_0x259f32[_0x5128ea(0x15e)](_0x1e877b=>'`'+_0x1e877b+'`')[_0x5128ea(0xde)](',\x20')),{'parse_mode':_0x5128ea(0x12f)});return;}const [_0x34d4db,_0x3deda5]=_0x259f32;console['log'](_0x5128ea(0x124)+_0x2efec7+_0x5128ea(0x10f)+_0x34d4db+_0x5128ea(0x12a)+_0x3deda5[_0x5128ea(0x197)](0x0,0xa)+_0x5128ea(0x123)),await this[_0x5128ea(0x190)](_0x434f3f,_0x2efec7,_0x34d4db,_0x3deda5);}catch(_0x35f7f5){console['error'](_0x5128ea(0x1a1),_0x35f7f5),await this[_0x5128ea(0xda)]?.[_0x5128ea(0x16d)](_0x434f3f,_0x5128ea(0x139));}}),this[_0x522528(0xda)]['on'](_0x522528(0x151),_0x29b1de=>{const _0x515b85=_0x522528;console[_0x515b85(0x151)](_0x515b85(0x11f),_0x29b1de);}),this[_0x522528(0xda)]['on']('polling_error',_0x126230=>{const _0x2578a4=_0x522528;console['error'](_0x2578a4(0x16f),_0x126230);});}async[a49_0x4dab00(0x190)](_0x1aaacc,_0x39546d,_0x21228c,_0xbaf2a7){const _0x465971=a49_0x4dab00;try{console['log']('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x39546d+_0x465971(0x10f)+_0x21228c+_0x465971(0x12a)+_0xbaf2a7[_0x465971(0x197)](0x0,0xa)+_0x465971(0x123));if(!_0x21228c||_0x21228c[_0x465971(0x1a9)]<0x3||_0x21228c[_0x465971(0x1a9)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x465971(0x12e)](_0x21228c)){await this[_0x465971(0xda)]?.[_0x465971(0x16d)](_0x1aaacc,_0x465971(0x183)+_0x21228c+_0x465971(0x114)+_0x465971(0x12d),{'parse_mode':_0x465971(0x12f)});return;}if(!_0xbaf2a7||!_0xbaf2a7[_0x465971(0x120)](_0x465971(0x16e))&&!_0xbaf2a7[_0x465971(0x120)]('sk_')){await this['bot']?.[_0x465971(0x16d)](_0x1aaacc,_0x465971(0xd1)+_0x465971(0x1a8),{'parse_mode':'Markdown'});return;}const _0x257b2f=await database_1[_0x465971(0xd4)][_0x465971(0x128)][_0x465971(0x173)]({'where':{'username':_0x21228c},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x257b2f){const _0x3c7771=await database_1[_0x465971(0xd4)][_0x465971(0x128)][_0x465971(0x10e)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x10cf3b=_0x465971(0xd2)+_0x21228c+_0x465971(0xd0);_0x3c7771[_0x465971(0x1a9)]>0x0?(_0x10cf3b+='Available\x20usernames:\x0a',_0x3c7771['forEach'](_0x388d3=>{const _0x593f6c=_0x465971;_0x10cf3b+=_0x593f6c(0x1a3)+_0x388d3[_0x593f6c(0x176)]+_0x593f6c(0x179)+_0x388d3[_0x593f6c(0x14e)]+')\x0a';}),_0x10cf3b+=_0x465971(0xfa)):_0x10cf3b+=_0x465971(0x13a);await this['bot']?.[_0x465971(0x16d)](_0x1aaacc,_0x10cf3b,{'parse_mode':_0x465971(0x12f)});return;}if(_0x257b2f['status']!==_0x465971(0x15b)){await this[_0x465971(0xda)]?.[_0x465971(0x16d)](_0x1aaacc,_0x465971(0x11b)+_0x21228c+_0x465971(0x131)+_0x465971(0x1a4),{'parse_mode':_0x465971(0x12f)});return;}if(_0x257b2f['publicKey']!==_0xbaf2a7&&_0x257b2f[_0x465971(0x105)]!==_0xbaf2a7){await this[_0x465971(0xda)]?.[_0x465971(0x16d)](_0x1aaacc,_0x465971(0x101)+_0x21228c+_0x465971(0x163)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x465971(0x12f)});return;}const _0xb42fce=await database_1[_0x465971(0xd4)]['telegramUser']['findFirst']({'where':{'shopId':_0x257b2f['id'],'isVerified':!![],'telegramId':{'not':_0x39546d}}});if(_0xb42fce){await this[_0x465971(0xda)]?.[_0x465971(0x16d)](_0x1aaacc,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x21228c+_0x465971(0x163)+_0x465971(0x15d),{'parse_mode':_0x465971(0x12f)});return;}await database_1[_0x465971(0xd4)][_0x465971(0x160)][_0x465971(0x161)]({'where':{'telegramId':_0x39546d},'data':{'shopId':_0x257b2f['id'],'isVerified':!![]}}),await this[_0x465971(0xda)]?.['sendMessage'](_0x1aaacc,_0x465971(0xf2)+_0x465971(0x126)+('📱\x20Shop:\x20*'+_0x257b2f['name']+'*\x0a')+(_0x465971(0x15c)+_0x257b2f[_0x465971(0x176)]+'`\x0a\x0a')+_0x465971(0x15f)+_0x465971(0x188)+_0x465971(0xf3)+_0x465971(0x1a0)+_0x465971(0x15a)+_0x465971(0x193)+_0x465971(0xf0)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x465971(0x12f)}),console[_0x465971(0x18c)]('✅\x20Telegram\x20user\x20'+_0x39546d+'\x20verified\x20for\x20shop\x20'+_0x257b2f[_0x465971(0x176)]+_0x465971(0x18b));}catch(_0x41ac25){console[_0x465971(0x151)](_0x465971(0x116),_0x41ac25),await this[_0x465971(0xda)]?.[_0x465971(0x16d)](_0x1aaacc,_0x465971(0x177));}}async[a49_0x4dab00(0x140)](_0x15386e,_0xb0e51c,_0x102656){const _0x1af6c3=a49_0x4dab00;if(!this[_0x1af6c3(0xda)]){console[_0x1af6c3(0x118)](_0x1af6c3(0x137));return;}try{const _0x7f40d0=await database_1['default'][_0x1af6c3(0x160)][_0x1af6c3(0x10e)]({'where':{'shopId':_0x15386e,'isVerified':!![]}});if(_0x7f40d0[_0x1af6c3(0x1a9)]===0x0){console[_0x1af6c3(0x18c)](_0x1af6c3(0xf8)+_0x15386e);return;}const _0x4b0df6=_0x7f40d0[_0x1af6c3(0x15e)](async _0xe886d3=>{const _0x51fb53=_0x1af6c3;try{await this['bot']?.['sendMessage'](_0xe886d3[_0x51fb53(0x1a7)],_0xb0e51c,_0x102656),console[_0x51fb53(0x18c)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0xe886d3[_0x51fb53(0x1a7)]);}catch(_0x5e39f8){console[_0x51fb53(0x151)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0xe886d3['telegramId']+':',_0x5e39f8),_0x5e39f8 instanceof Error&&(_0x5e39f8[_0x51fb53(0x1ac)]['includes'](_0x51fb53(0x159))||_0x5e39f8[_0x51fb53(0x1ac)][_0x51fb53(0x13e)](_0x51fb53(0x12b))||_0x5e39f8['message']['includes'](_0x51fb53(0x10c)))&&(await database_1[_0x51fb53(0xd4)]['telegramUser']['update']({'where':{'id':_0xe886d3['id']},'data':{'isVerified':![]}}),console[_0x51fb53(0x18c)](_0x51fb53(0x18f)+_0xe886d3[_0x51fb53(0x1a7)]+_0x51fb53(0x18e)));}});await Promise[_0x1af6c3(0x153)](_0x4b0df6);}catch(_0x568053){console[_0x1af6c3(0x151)](_0x1af6c3(0x10b),_0x568053);}}async[a49_0x4dab00(0x146)](_0xc21a,_0x5b72c2,_0x2949ed){const _0x1e6f52=a49_0x4dab00,_0x57f79a={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x15dd83={'created':_0x1e6f52(0x17d),'paid':'Payment\x20successfully\x20paid','failed':_0x1e6f52(0xfe),'expired':_0x1e6f52(0x13c),'refund':'Payment\x20refund','chargeback':'Payment\x20chargeback','processing':'Payment\x20is\x20being\x20processed'},_0x260092=_0x57f79a[_0x2949ed],_0x27d6d9=_0x15dd83[_0x2949ed],_0x58f8da=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x5b72c2[_0x1e6f52(0xd5)]);console[_0x1e6f52(0x18c)](_0x1e6f52(0x167)+_0x5b72c2['gateway']+_0x1e6f52(0x196)+_0x58f8da+'\x22');let _0x415260=_0x260092+'\x20*'+_0x27d6d9+_0x1e6f52(0xeb)+(_0x1e6f52(0x141)+_0x5b72c2[_0x1e6f52(0xf1)]+'\x20'+_0x5b72c2[_0x1e6f52(0x143)]+'*\x0a')+(_0x1e6f52(0x1ab)+(_0x5b72c2['orderId']||_0x5b72c2['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x5b72c2['id']+'`\x0a')+(_0x1e6f52(0xdb)+_0x58f8da+'`\x0a')+(_0x1e6f52(0x184)+new Date(_0x5b72c2[_0x1e6f52(0xd9)])[_0x1e6f52(0x142)](_0x1e6f52(0x18a))+'\x0a');(_0x5b72c2[_0x1e6f52(0xd7)]||_0x5b72c2[_0x1e6f52(0x169)])&&(_0x415260+=_0x1e6f52(0xdd),_0x5b72c2[_0x1e6f52(0xd7)]&&(_0x415260+=_0x1e6f52(0x119)+_0x5b72c2[_0x1e6f52(0xd7)]+'`\x0a'),_0x5b72c2[_0x1e6f52(0x169)]&&(_0x415260+='📧\x20Email:\x20`'+_0x5b72c2[_0x1e6f52(0x169)]+'`\x0a')),_0x2949ed===_0x1e6f52(0x108)&&_0x5b72c2[_0x1e6f52(0x17b)]&&(_0x415260+=_0x1e6f52(0x147)+_0x5b72c2[_0x1e6f52(0x17b)]+_0x1e6f52(0x166)),_0x2949ed==='processing'&&(_0x415260+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x5b72c2[_0x1e6f52(0x174)]&&(_0x415260+=_0x1e6f52(0xee)+_0x5b72c2[_0x1e6f52(0x174)]+'\x0a'),await this[_0x1e6f52(0x140)](_0xc21a,_0x415260,{'parse_mode':_0x1e6f52(0x12f)});}async['sendPayoutNotification'](_0x46bf35,_0x403bd1,_0x580c87){const _0x509243=a49_0x4dab00,_0x33da53={'created':'📤','completed':'✅','rejected':'❌'},_0x577fa7={'created':_0x509243(0x178),'completed':_0x509243(0x14f),'rejected':_0x509243(0x115)},_0x3a5e35=_0x33da53[_0x580c87],_0x2a05d0=_0x577fa7[_0x580c87],_0x4b59f4=_0x3a5e35+'\x20*'+_0x2a05d0+_0x509243(0xeb)+(_0x509243(0x186)+_0x403bd1[_0x509243(0xf1)]+_0x509243(0x162))+(_0x509243(0xf4)+_0x403bd1[_0x509243(0x11a)]+'`\x0a')+(_0x509243(0x180)+_0x403bd1['id']+'`\x0a')+(_0x509243(0x184)+new Date(_0x403bd1[_0x509243(0xd9)])['toLocaleString'](_0x509243(0x18a))+'\x0a')+(_0x403bd1['txid']?'🔗\x20TXID:\x20`'+_0x403bd1[_0x509243(0x121)]+'`':'');await this['sendShopNotification'](_0x46bf35,_0x4b59f4,{'parse_mode':'Markdown'});}async[a49_0x4dab00(0xf7)](_0x5bb554,_0x18cd53){const _0x3d6c69=a49_0x4dab00;try{const _0x25ae5d=await database_1[_0x3d6c69(0xd4)][_0x3d6c69(0x19c)][_0x3d6c69(0x173)]({'where':{'shopId':_0x5bb554},'select':{'notificationLogin':!![]}});if(!_0x25ae5d?.[_0x3d6c69(0xd8)]){console[_0x3d6c69(0x18c)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x5bb554);return;}const _0xf329a5=_0x18cd53[_0x3d6c69(0xe9)]?'🔐':'🚨',_0x774e0f=_0x18cd53[_0x3d6c69(0xe9)]?_0x3d6c69(0x14d):_0x3d6c69(0x168);let _0x445749=_0xf329a5+'\x20*'+_0x774e0f+_0x3d6c69(0xeb)+(_0x3d6c69(0x15c)+_0x18cd53['username']+'`\x0a')+(_0x3d6c69(0xe1)+_0x18cd53[_0x3d6c69(0x165)]['toLocaleString'](_0x3d6c69(0x18a))+'\x0a');_0x18cd53['ipAddress']&&(_0x445749+=_0x3d6c69(0x14b)+_0x18cd53['ipAddress']+'`\x0a');if(_0x18cd53['userAgent']){const _0xadb774=_0x18cd53[_0x3d6c69(0xe5)][_0x3d6c69(0x1a9)]>0x32?_0x18cd53[_0x3d6c69(0xe5)][_0x3d6c69(0x197)](0x0,0x32)+_0x3d6c69(0x191):_0x18cd53[_0x3d6c69(0xe5)];_0x445749+=_0x3d6c69(0xfd)+_0xadb774+'`\x0a';}!_0x18cd53[_0x3d6c69(0xe9)]&&(_0x445749+=_0x3d6c69(0x136)),await this[_0x3d6c69(0x140)](_0x5bb554,_0x445749,{'parse_mode':_0x3d6c69(0x12f)}),console[_0x3d6c69(0x18c)](_0x3d6c69(0xdf)+_0x5bb554+':\x20'+(_0x18cd53[_0x3d6c69(0xe9)]?_0x3d6c69(0xe9):_0x3d6c69(0x152)));}catch(_0x57e691){console[_0x3d6c69(0x151)](_0x3d6c69(0x117),_0x57e691);}}async[a49_0x4dab00(0x103)](_0x451eca,_0x4adb09){const _0x558925=a49_0x4dab00;try{const _0x5dcbf6=await database_1[_0x558925(0xd4)][_0x558925(0x19c)][_0x558925(0x173)]({'where':{'shopId':_0x451eca},'select':{'notificationApiError':!![]}});if(!_0x5dcbf6?.[_0x558925(0x112)]){console[_0x558925(0x18c)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x451eca);return;}let _0x213455=_0x558925(0xf6)+(_0x558925(0x19a)+_0x4adb09['method']+'\x20'+_0x4adb09[_0x558925(0x110)]+'`\x0a')+(_0x558925(0xe1)+_0x4adb09['timestamp'][_0x558925(0x142)]('en-US')+'\x0a');_0x4adb09[_0x558925(0x198)]&&(_0x213455+=_0x558925(0x122)+_0x4adb09['statusCode']+'`\x0a'),_0x213455+=_0x558925(0x155)+_0x4adb09[_0x558925(0x132)]+'`\x0a',_0x4adb09['requestId']&&(_0x213455+='🆔\x20Request\x20ID:\x20`'+_0x4adb09[_0x558925(0x19d)]+'`\x0a'),_0x213455+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x558925(0x140)](_0x451eca,_0x213455,{'parse_mode':_0x558925(0x12f)}),console[_0x558925(0x18c)](_0x558925(0x133)+_0x451eca+':\x20'+_0x4adb09[_0x558925(0x110)]);}catch(_0x4edd23){console[_0x558925(0x151)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x4edd23);}}async[a49_0x4dab00(0x1aa)](_0x434e02,_0x38cbdd,_0x39e75a){const _0x3d29a0=a49_0x4dab00;let _0x1dcdca=_0x3d29a0(0x1a2)+_0x38cbdd+'*\x0a\x0a';for(const [_0x3d5eb6,_0x7326fd]of Object[_0x3d29a0(0x13b)](_0x39e75a)){_0x7326fd!==null&&_0x7326fd!==undefined&&(_0x1dcdca+=_0x3d5eb6+_0x3d29a0(0x175)+_0x7326fd+'`\x0a');}await this[_0x3d29a0(0x140)](_0x434e02,_0x1dcdca,{'parse_mode':_0x3d29a0(0x12f)});}[a49_0x4dab00(0x14c)](){const _0x1bde03=a49_0x4dab00;return{'isActive':!!this[_0x1bde03(0xda)],'username':this[_0x1bde03(0x19b)]};}[a49_0x4dab00(0x107)](){const _0x40e6ef=a49_0x4dab00;this[_0x40e6ef(0xda)]&&(this['bot']['stopPolling'](),this['bot']=null,console[_0x40e6ef(0x18c)](_0x40e6ef(0x17e)));}}function a49_0x41ac(){const _0x39769b=['📛\x20Name:\x20`','method','❌\x20Shop\x20`','shopId','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','split','Telegram\x20bot\x20error:','startsWith','txid','📊\x20Error\x20code:\x20`','...\x22','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Use\x20/start\x20to\x20begin.','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','Error\x20handling\x20/status\x20command:','shop','__importDefault','\x22,\x20apiKey=\x22','chat\x20not\x20found','🔍\x20*Debug\x20Information*\x0a\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','test','Markdown','last_name','`\x20is\x20inactive.\x0a\x0a','errorMessage','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','trapay_bot','trim','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','1aOJLyC','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','Check\x20spelling\x20and\x20try\x20again.','entries','Payment\x20expired','341076GrRHHL','includes','TELEGRAM_BOT_TOKEN','sendShopNotification','💰\x20Amount:\x20*','toLocaleString','currency','telegramBotService','❌\x20Error\x20getting\x20debug\x20information.','sendPaymentNotification','💸\x20Penalty\x20amount:\x20*','386407QODycI','/disconnect\x20-\x20disconnect\x20from\x20notifications','📱\x20Created\x20new\x20Telegram\x20user:\x20','🌐\x20IP\x20address:\x20`','getBotInfo','Successful\x20login','name','Payout\x20completed','chat','error','failed','allSettled','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','❌\x20Error:\x20`','botToken','\x20\x20\x20Username:\x20`','1784295BtwCvo','blocked','•\x20Important\x20events\x0a\x0a','ACTIVE','👤\x20Username:\x20`','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','map','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','telegramUser','update','\x20USD*\x0a','`.\x0a\x0a','\x20initialized\x20successfully','timestamp','\x20USDT*\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','Failed\x20login\x20attempt','customerEmail','Error\x20handling\x20/start\x20command:','.\x20*','node-telegram-bot-api','sendMessage','pk_','Telegram\x20bot\x20polling\x20error:','✅\x20Welcome\x20back!\x0a\x0a','You\x20sent\x20','toLocaleDateString','findUnique','adminNotes',':\x20`','username','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','New\x20payout\x20created','`\x20(','✅\x20Connected\x20to\x20shop:\x20*','chargebackAmount','...`\x0a\x0a','New\x20payment\x20created','🛑\x20Telegram\x20bot\x20stopped','Error\x20handling\x20/disconnect\x20command:','🆔\x20Payout\x20ID:\x20`','24FsNfUC','\x20(@','❌\x20Invalid\x20username\x20format:\x20`','📅\x20Date:\x20','publicKey','💸\x20Amount:\x20*','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','•\x20New\x20payments\x0a','updatedAt','en-US','\x20via\x20single-line\x20input','log','*.\x0a\x0a','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','User\x20','handleSingleLineVerification','...','from','Commands:\x0a','../config/database','\x20\x20\x20Status:\x20','\x22\x20->\x20display\x20\x22','substring','statusCode','TelegramBotService','🔗\x20Endpoint:\x20`','botUsername','shopSettings','requestId','Example:\x0a','To\x20reconnect,\x20use\x20the\x20/start\x20command','•\x20Payouts\x0a','Error\x20handling\x20message:','🔔\x20*','•\x20`','Contact\x20administrator.','text','\x20disconnected\x20from\x20shop\x20','telegramId','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','length','sendCustomNotification','📝\x20Order\x20ID:\x20`','message','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','876094hDkByT','../types/gateway','initializeBot','`\x20not\x20found.\x0a\x0a','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','❌\x20Shop\x20with\x20username\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a','default','gateway','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','customerName','notificationLogin','createdAt','bot','🏪\x20Gateway:\x20`','7707096tyVGMB','\x0a👤\x20*Customer\x20Information:*\x0a','join','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','📅\x20Time:\x20','Error\x20handling\x20/debug\x20command:','10375335jJEPkW','🔔\x20Notifications\x20are\x20active\x0a\x0a','userAgent','setupBotHandlers','751850xIrbFv','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','success','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','*\x0a\x0a','env','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','📝\x20Notes:\x20','🔔\x20You\x20receive\x20notifications\x20about:\x0a','/status\x20-\x20check\x20connection\x20status\x0a','amount','🎉\x20*Congratulations!*\x0a\x0a','•\x20Payment\x20status\x20changes\x0a','🏦\x20Method:\x20`','onText','🚨\x20*API\x20Error*\x0a\x0a','sendLoginNotification','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','📊\x20*Connection\x20Status*\x0a\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','✅\x20Telegram\x20bot\x20@','•\x20Payouts\x0a\x0a','💻\x20Browser:\x20`','Payment\x20failed','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','\x20\x20\x20Public\x20Key:\x20`','sendApiErrorNotification','toString','secretKey','isVerified','stopBot','chargeback','status','__esModule','Error\x20sending\x20shop\x20notification:','user\x20is\x20deactivated','📅\x20Connection\x20date:\x20','findMany',':\x20username=\x22','endpoint','📱\x20Your\x20Telegram\x20ID:\x20`','notificationApiError','Username:\x20`','`\x0a\x0a','Payout\x20rejected','Error\x20in\x20handleSingleLineVerification:','Failed\x20to\x20send\x20login\x20notification:','warn'];a49_0x41ac=function(){return _0x39769b;};return a49_0x41ac();}exports[a49_0x4dab00(0x199)]=TelegramBotService,exports[a49_0x4dab00(0x144)]=new TelegramBotService();