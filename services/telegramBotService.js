'use strict';function a66_0x4858(_0x5cbbe0,_0x28e53a){const _0x5d2821=a66_0x5d28();return a66_0x4858=function(_0x4858ab,_0x5226e9){_0x4858ab=_0x4858ab-0x1f1;let _0xc7882c=_0x5d2821[_0x4858ab];return _0xc7882c;},a66_0x4858(_0x5cbbe0,_0x28e53a);}const a66_0x383da2=a66_0x4858;function a66_0x5d28(){const _0x2f3794=['🌐\x20IP\x20address:\x20`','test','customerUa','1351638eWQrIf','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','Payment\x20failed','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','findUnique','Failed\x20login\x20attempt','from','\x20USD*\x0a','.jpeg','`\x20not\x20found.\x0a\x0a','shopSettings','statusCode','.pdf','update','\x20verified\x20for\x20shop\x20','__esModule',':\x20`','👤\x20Username:\x20`','*.\x0a\x0a','telegramId','sendNotificationToAll','...','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','\x0a👤\x20*Customer\x20Information:*\x0a','`\x0a\x0a','endsWith','Error\x20handling\x20/start\x20command:','•\x20Payouts\x0a\x0a','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','🔗\x20Endpoint:\x20`','🆔\x20Payout\x20ID:\x20`','...\x22','❌\x20Error\x20sending\x20file\x20to\x20chat:','shopId','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','🛑\x20Telegram\x20bot\x20stopped','botToken','📅\x20Connection\x20date:\x20','Payout\x20rejected','chargeback','6576iBEhoD','pk_','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','username','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','\x20\x20\x20Username:\x20`','sendApiErrorNotification','failed','\x20\x20\x20Name:\x20*','New\x20payment\x20created','To\x20reconnect,\x20use\x20the\x20/start\x20command','•\x20New\x20payments\x0a','✅\x20File\x20sent\x20to\x20chat\x20','.png','customerEmail','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','handleSingleLineVerification','updatedAt','sendDirectMessage','initializeBot','ACTIVE','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','3504828xRbGDv','warn','`.\x0a\x0a','New\x20payout\x20created','notificationApiError','Contact\x20administrator.','createdAt','currency','sendShopNotification','create','toString','getGatewayDisplayNameForTelegram','default','errorMessage','findMany','../config/database','success','🔍\x20*Debug\x20Information*\x0a\x0a','image/jpeg','Payment\x20is\x20being\x20processed','TelegramBotService','requestId','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','🚨\x20*API\x20Error*\x0a\x0a','Failed\x20to\x20send\x20login\x20notification:','stopPolling','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','Use\x20/start\x20to\x20connect.','❌\x20Invalid\x20username\x20format:\x20`','1796BFLErN','sendMessage','📱\x20Created\x20new\x20Telegram\x20user:\x20','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','•\x20Important\x20events\x0a\x0a','🏪\x20Your\x20connected\x20shop:\x0a','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','application/pdf','method','remitterIban','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','sendPayoutNotification','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','timestamp','customerName','onText',':\x20username=\x22','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','sendLoginNotification','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','join','text','env','•\x20Payouts\x0a','.jpg','userAgent','sendDirectFile','stopBot','\x20via\x20single-line\x20input','orderId','\x20USDT*\x0a','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','trim','sendPaymentNotification','status','toLocaleString','sendDocument','💸\x20Amount:\x20*','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','error','en-US','Payment\x20expired','Error\x20handling\x20/disconnect\x20command:','setupBotHandlers','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','chat','❌\x20Shop\x20`','getBotInfo','Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.','TELEGRAM_BOT_TOKEN','/status\x20-\x20check\x20connection\x20status\x0a','endpoint','last_name','name','__importDefault','botUsername','../types/gateway','toLocaleDateString','Payment\x20successfully\x20paid','❌\x20Shop\x20with\x20username\x20`','7572210GyKorU','❌\x20Error:\x20`','❌\x20Telegram\x20bot\x20not\x20initialized','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','\x20initialized\x20successfully','✅\x20Welcome\x20back!\x0a\x0a','application/octet-stream','Example:\x0a','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','txid','includes','message','shop','🏦\x20Method:\x20`','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','📛\x20Name:\x20`','substring','\x20users','notificationLogin','968192efoUOD','7ZktUKX','ipAddress','telegramUser','entries','4385FtVofm','\x20users\x20of\x20shop\x20','customerIp','📝\x20Notes:\x20','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','Markdown','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','Error\x20handling\x20/debug\x20command:','✅\x20File\x20sent\x20to\x20','📅\x20Time:\x20','❌\x20Error\x20sending\x20file\x20to\x20user\x20','bot','length','🌐\x20IP:\x20`','Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.','❌\x20Error\x20sending\x20file\x20to\x20shop:','trapay_bot','•\x20Payment\x20status\x20changes\x0a','🆔\x20Request\x20ID:\x20`','\x22,\x20apiKey=\x22','processing','first_name','image/png','Commands:\x0a','split','secretKey','✅\x20Telegram\x20bot\x20@','\x20\x20\x20Status:\x20','You\x20sent\x20','sk_','isVerified','Error\x20sending\x20shop\x20notification:','Failed\x20to\x20send\x20API\x20error\x20notification:','\x20disconnected\x20from\x20shop\x20','✅\x20Connected\x20to\x20shop:\x20*','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','chargebackAmount','adminNotes','*\x0a\x0a','map','290457xQeFTx','telegramBotService','`\x20is\x20inactive.\x0a\x0a','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','Telegram\x20bot\x20error:','📧\x20Email:\x20`','polling_error','Use\x20/start\x20to\x20begin.','user\x20is\x20deactivated','❌\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','startsWith','🔔\x20Notifications\x20are\x20active\x0a\x0a','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','Payment\x20chargeback','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','/disconnect\x20-\x20disconnect\x20from\x20notifications','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','node-telegram-bot-api','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','log','publicKey','❌\x20Please\x20use\x20/start\x20command\x20first','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','Payout\x20completed','270nduibF','\x20parts:\x20'];a66_0x5d28=function(){return _0x2f3794;};return a66_0x5d28();}(function(_0xb24efd,_0x358f73){const _0x168b54=a66_0x4858,_0x354a14=_0xb24efd();while(!![]){try{const _0x2c8092=-parseInt(_0x168b54(0x26c))/0x1+parseInt(_0x168b54(0x2b3))/0x2*(-parseInt(_0x168b54(0x286))/0x3)+parseInt(_0x168b54(0x2e6))/0x4*(-parseInt(_0x168b54(0x244))/0x5)+parseInt(_0x168b54(0x2c9))/0x6*(parseInt(_0x168b54(0x240))/0x7)+parseInt(_0x168b54(0x23f))/0x8+-parseInt(_0x168b54(0x28b))/0x9+parseInt(_0x168b54(0x22c))/0xa;if(_0x2c8092===_0x358f73)break;else _0x354a14['push'](_0x354a14['shift']());}catch(_0x4080e1){_0x354a14['push'](_0x354a14['shift']());}}}(a66_0x5d28,0x51113));var __importDefault=this&&this[a66_0x383da2(0x226)]||function(_0x20153c){const _0x49abd2=a66_0x383da2;return _0x20153c&&_0x20153c[_0x49abd2(0x29a)]?_0x20153c:{'default':_0x20153c};};Object['defineProperty'](exports,a66_0x383da2(0x29a),{'value':!![]}),exports[a66_0x383da2(0x26d)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a66_0x383da2(0x27f))),database_1=__importDefault(require(a66_0x383da2(0x2d8))),gateway_1=require(a66_0x383da2(0x228));class TelegramBotService{constructor(){const _0x195554=a66_0x383da2;this[_0x195554(0x24f)]=null,this[_0x195554(0x2af)]=process['env'][_0x195554(0x221)]||'',this[_0x195554(0x227)]=process[_0x195554(0x206)]['TELEGRAM_BOT_USERNAME']||_0x195554(0x254),this[_0x195554(0x2af)]?this['initializeBot']():console['warn'](_0x195554(0x2c8));}[a66_0x383da2(0x2c6)](){const _0x5afa7a=a66_0x383da2;try{this[_0x5afa7a(0x24f)]=new node_telegram_bot_api_1['default'](this[_0x5afa7a(0x2af)],{'polling':!![]}),this[_0x5afa7a(0x21b)](),console[_0x5afa7a(0x281)](_0x5afa7a(0x25e)+this[_0x5afa7a(0x227)]+_0x5afa7a(0x230));}catch(_0x553e9f){console['error'](_0x5afa7a(0x21c),_0x553e9f);}}[a66_0x383da2(0x21b)](){const _0x3734ad=a66_0x383da2;if(!this[_0x3734ad(0x24f)])return;this[_0x3734ad(0x24f)][_0x3734ad(0x1ff)](/\/start/,async _0x59c411=>{const _0x48409d=_0x3734ad,_0xe23c97=_0x59c411['chat']['id'],_0x4bb7a0=_0x59c411[_0x48409d(0x291)]?.['id'][_0x48409d(0x2d3)](),_0x12acff=_0x59c411[_0x48409d(0x291)]?.['username'],_0x22dbcb=_0x59c411[_0x48409d(0x291)]?.[_0x48409d(0x259)],_0xb4028b=_0x59c411[_0x48409d(0x291)]?.[_0x48409d(0x224)];if(!_0x4bb7a0)return;try{let _0x5048b4=await database_1[_0x48409d(0x2d5)][_0x48409d(0x242)][_0x48409d(0x28f)]({'where':{'telegramId':_0x4bb7a0},'include':{'shop':!![]}});!_0x5048b4?(_0x5048b4=await database_1[_0x48409d(0x2d5)][_0x48409d(0x242)][_0x48409d(0x2d2)]({'data':{'telegramId':_0x4bb7a0,'username':_0x12acff,'firstName':_0x22dbcb,'lastName':_0xb4028b,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x48409d(0x281)](_0x48409d(0x1f2)+_0x4bb7a0+'\x20(@'+_0x12acff+')')):_0x5048b4=await database_1[_0x48409d(0x2d5)]['telegramUser'][_0x48409d(0x298)]({'where':{'telegramId':_0x4bb7a0},'data':{'username':_0x12acff,'firstName':_0x22dbcb,'lastName':_0xb4028b},'include':{'shop':!![]}}),_0x5048b4['isVerified']&&_0x5048b4[_0x48409d(0x2ac)]&&_0x5048b4[_0x48409d(0x238)]?await this[_0x48409d(0x24f)]?.['sendMessage'](_0xe23c97,_0x48409d(0x231)+(_0x48409d(0x23a)+_0x5048b4[_0x48409d(0x238)][_0x48409d(0x225)]+'*\x0a')+('Username:\x20`'+_0x5048b4[_0x48409d(0x238)][_0x48409d(0x2b6)]+'`\x0a\x0a')+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x48409d(0x2be)+_0x48409d(0x255)+_0x48409d(0x2a6)+_0x48409d(0x25b)+_0x48409d(0x222)+_0x48409d(0x27d),{'parse_mode':_0x48409d(0x249)}):(_0x5048b4['shopId']&&!_0x5048b4['isVerified']&&(await database_1[_0x48409d(0x2d5)]['telegramUser'][_0x48409d(0x298)]({'where':{'telegramId':_0x4bb7a0},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x48409d(0x276)+_0x4bb7a0)),await this[_0x48409d(0x24f)]?.[_0x48409d(0x1f1)](_0xe23c97,_0x48409d(0x280)+_0x48409d(0x1fa)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+'Example:\x0a'+_0x48409d(0x2a1)+_0x48409d(0x248),{'parse_mode':_0x48409d(0x249)}));}catch(_0x4539a5){console[_0x48409d(0x217)](_0x48409d(0x2a5),_0x4539a5),await this[_0x48409d(0x24f)]?.[_0x48409d(0x1f1)](_0xe23c97,_0x48409d(0x24a));}}),this[_0x3734ad(0x24f)][_0x3734ad(0x1ff)](/\/disconnect/,async _0x1bf532=>{const _0x6243ee=_0x3734ad,_0x10bc75=_0x1bf532['chat']['id'],_0x51bd82=_0x1bf532['from']?.['id']['toString']();if(!_0x51bd82)return;try{const _0x2e8fd9=await database_1[_0x6243ee(0x2d5)][_0x6243ee(0x242)][_0x6243ee(0x28f)]({'where':{'telegramId':_0x51bd82},'include':{'shop':!![]}});if(!_0x2e8fd9||!_0x2e8fd9[_0x6243ee(0x262)]||!_0x2e8fd9[_0x6243ee(0x2ac)]){await this[_0x6243ee(0x24f)]?.[_0x6243ee(0x1f1)](_0x10bc75,_0x6243ee(0x2b7));return;}const _0x5aa09f=_0x2e8fd9['shop']?.['name']||'unknown\x20shop';await database_1[_0x6243ee(0x2d5)][_0x6243ee(0x242)][_0x6243ee(0x298)]({'where':{'telegramId':_0x51bd82},'data':{'shopId':null,'isVerified':![]}}),console[_0x6243ee(0x281)]('🔌\x20User\x20'+_0x51bd82+_0x6243ee(0x265)+_0x2e8fd9['shopId']),await this[_0x6243ee(0x24f)]?.['sendMessage'](_0x10bc75,_0x6243ee(0x28c)+_0x5aa09f+_0x6243ee(0x29d)+_0x6243ee(0x2bd),{'parse_mode':_0x6243ee(0x249)});}catch(_0x1cca09){console[_0x6243ee(0x217)](_0x6243ee(0x21a),_0x1cca09),await this[_0x6243ee(0x24f)]?.['sendMessage'](_0x10bc75,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x3734ad(0x24f)][_0x3734ad(0x1ff)](/\/status/,async _0x406eec=>{const _0x270bdc=_0x3734ad,_0x2f3687=_0x406eec[_0x270bdc(0x21d)]['id'],_0x4d5e8c=_0x406eec[_0x270bdc(0x291)]?.['id'][_0x270bdc(0x2d3)]();if(!_0x4d5e8c)return;try{const _0x45e7f4=await database_1[_0x270bdc(0x2d5)]['telegramUser'][_0x270bdc(0x28f)]({'where':{'telegramId':_0x4d5e8c},'include':{'shop':!![]}});if(!_0x45e7f4){await this[_0x270bdc(0x24f)]?.[_0x270bdc(0x1f1)](_0x2f3687,_0x270bdc(0x277)+_0x270bdc(0x273));return;}if(!_0x45e7f4[_0x270bdc(0x262)]||!_0x45e7f4[_0x270bdc(0x2ac)]||!_0x45e7f4[_0x270bdc(0x238)]){await this[_0x270bdc(0x24f)]?.[_0x270bdc(0x1f1)](_0x2f3687,_0x270bdc(0x2b5)+_0x270bdc(0x2e4));return;}await this[_0x270bdc(0x24f)]?.[_0x270bdc(0x1f1)](_0x2f3687,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x270bdc(0x266)+_0x45e7f4[_0x270bdc(0x238)][_0x270bdc(0x225)]+'*\x0a')+(_0x270bdc(0x29c)+_0x45e7f4[_0x270bdc(0x238)][_0x270bdc(0x2b6)]+'`\x0a')+(_0x270bdc(0x2b0)+_0x45e7f4[_0x270bdc(0x2c4)][_0x270bdc(0x229)](_0x270bdc(0x218))+'\x0a\x0a')+_0x270bdc(0x279)+_0x270bdc(0x25b)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x270bdc(0x249)});}catch(_0x112c9d){console[_0x270bdc(0x217)]('Error\x20handling\x20/status\x20command:',_0x112c9d),await this['bot']?.[_0x270bdc(0x1f1)](_0x2f3687,_0x270bdc(0x24a));}}),this[_0x3734ad(0x24f)][_0x3734ad(0x1ff)](/\/debug/,async _0x3a875a=>{const _0x2c70df=_0x3734ad,_0x591a68=_0x3a875a[_0x2c70df(0x21d)]['id'],_0xb86739=_0x3a875a['from']?.['id']['toString']();if(!_0xb86739)return;try{const _0x1c5bc0=await database_1[_0x2c70df(0x2d5)]['telegramUser'][_0x2c70df(0x28f)]({'where':{'telegramId':_0xb86739},'include':{'shop':!![]}});let _0x43b0f6=_0x2c70df(0x2da);_0x43b0f6+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0xb86739+_0x2c70df(0x2a3),_0x1c5bc0?.[_0x2c70df(0x262)]&&_0x1c5bc0[_0x2c70df(0x238)]?(_0x43b0f6+=_0x2c70df(0x1f5),_0x43b0f6+=_0x2c70df(0x2bb)+_0x1c5bc0[_0x2c70df(0x238)][_0x2c70df(0x225)]+'*\x0a',_0x43b0f6+=_0x2c70df(0x2b8)+_0x1c5bc0[_0x2c70df(0x238)]['username']+'`\x0a',_0x43b0f6+=_0x2c70df(0x25f)+_0x1c5bc0[_0x2c70df(0x238)][_0x2c70df(0x212)]+'\x0a\x0a'):_0x43b0f6+=_0x2c70df(0x275),_0x43b0f6+=_0x2c70df(0x220),await this['bot']?.[_0x2c70df(0x1f1)](_0x591a68,_0x43b0f6,{'parse_mode':'Markdown'});}catch(_0x449b6d){console[_0x2c70df(0x217)](_0x2c70df(0x24b),_0x449b6d),await this[_0x2c70df(0x24f)]?.[_0x2c70df(0x1f1)](_0x591a68,'❌\x20Error\x20getting\x20debug\x20information.');}}),this[_0x3734ad(0x24f)]['on'](_0x3734ad(0x237),async _0x1a4b49=>{const _0x3af102=_0x3734ad;if(_0x1a4b49[_0x3af102(0x205)]?.[_0x3af102(0x278)]('/'))return;const _0x2f9795=_0x1a4b49[_0x3af102(0x21d)]['id'],_0x923327=_0x1a4b49[_0x3af102(0x291)]?.['id'][_0x3af102(0x2d3)](),_0x4eb120=_0x1a4b49[_0x3af102(0x205)]?.[_0x3af102(0x210)]();if(!_0x923327||!_0x4eb120)return;try{const _0x125eed=await database_1[_0x3af102(0x2d5)][_0x3af102(0x242)]['findUnique']({'where':{'telegramId':_0x923327},'include':{'shop':!![]}});if(!_0x125eed){await this[_0x3af102(0x24f)]?.[_0x3af102(0x1f1)](_0x2f9795,_0x3af102(0x283));return;}if(_0x125eed[_0x3af102(0x262)]&&_0x125eed[_0x3af102(0x2ac)]&&_0x125eed['shop']){await this[_0x3af102(0x24f)]?.[_0x3af102(0x1f1)](_0x2f9795,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x125eed[_0x3af102(0x238)][_0x3af102(0x225)]+_0x3af102(0x29d)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x3af102(0x249)});return;}const _0x34bfd7=_0x4eb120[_0x3af102(0x25c)](/\s+/);if(_0x34bfd7[_0x3af102(0x250)]!==0x2){await this[_0x3af102(0x24f)]?.['sendMessage'](_0x2f9795,_0x3af102(0x201)+_0x3af102(0x203)+_0x3af102(0x233)+_0x3af102(0x2a1)+(_0x3af102(0x260)+_0x34bfd7[_0x3af102(0x250)]+_0x3af102(0x287)+_0x34bfd7[_0x3af102(0x26b)](_0x3bfe9b=>'`'+_0x3bfe9b+'`')[_0x3af102(0x204)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x3daed6,_0x553f57]=_0x34bfd7;console[_0x3af102(0x281)](_0x3af102(0x1f6)+_0x923327+_0x3af102(0x200)+_0x3daed6+_0x3af102(0x257)+_0x553f57[_0x3af102(0x23c)](0x0,0xa)+_0x3af102(0x2aa)),await this[_0x3af102(0x2c3)](_0x2f9795,_0x923327,_0x3daed6,_0x553f57);}catch(_0x5c36e5){console[_0x3af102(0x217)]('Error\x20handling\x20message:',_0x5c36e5),await this[_0x3af102(0x24f)]?.[_0x3af102(0x1f1)](_0x2f9795,_0x3af102(0x24a));}}),this[_0x3734ad(0x24f)]['on'](_0x3734ad(0x217),_0x38df78=>{const _0x3cfd89=_0x3734ad;console[_0x3cfd89(0x217)](_0x3cfd89(0x270),_0x38df78);}),this['bot']['on'](_0x3734ad(0x272),_0x79051e=>{const _0x2c4bb3=_0x3734ad;console[_0x2c4bb3(0x217)]('Telegram\x20bot\x20polling\x20error:',_0x79051e);});}async[a66_0x383da2(0x2c3)](_0x5592e4,_0x2a4e01,_0x22cf41,_0x113fa2){const _0x340d93=a66_0x383da2;try{console[_0x340d93(0x281)](_0x340d93(0x1f6)+_0x2a4e01+':\x20username=\x22'+_0x22cf41+_0x340d93(0x257)+_0x113fa2['substring'](0x0,0xa)+_0x340d93(0x2aa));if(!_0x22cf41||_0x22cf41[_0x340d93(0x250)]<0x3||_0x22cf41['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x340d93(0x289)](_0x22cf41)){await this[_0x340d93(0x24f)]?.[_0x340d93(0x1f1)](_0x5592e4,_0x340d93(0x2e5)+_0x22cf41+'`\x0a\x0a'+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x340d93(0x249)});return;}if(!_0x113fa2||!_0x113fa2[_0x340d93(0x278)](_0x340d93(0x2b4))&&!_0x113fa2[_0x340d93(0x278)](_0x340d93(0x261))){await this['bot']?.[_0x340d93(0x1f1)](_0x5592e4,_0x340d93(0x27e)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':'Markdown'});return;}const _0x38afc1=await database_1['default'][_0x340d93(0x238)]['findUnique']({'where':{'username':_0x22cf41},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x38afc1){const _0x4f323f=_0x340d93(0x22b)+_0x22cf41+_0x340d93(0x294)+'Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a'+_0x340d93(0x252);await this[_0x340d93(0x24f)]?.['sendMessage'](_0x5592e4,_0x4f323f,{'parse_mode':_0x340d93(0x249)});return;}if(_0x38afc1[_0x340d93(0x212)]!==_0x340d93(0x2c7)){await this[_0x340d93(0x24f)]?.[_0x340d93(0x1f1)](_0x5592e4,_0x340d93(0x21e)+_0x22cf41+_0x340d93(0x26e)+_0x340d93(0x2ce),{'parse_mode':_0x340d93(0x249)});return;}if(_0x38afc1[_0x340d93(0x282)]!==_0x113fa2&&_0x38afc1[_0x340d93(0x25d)]!==_0x113fa2){await this[_0x340d93(0x24f)]?.[_0x340d93(0x1f1)](_0x5592e4,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x22cf41+_0x340d93(0x2cb)+_0x340d93(0x1fc)+_0x340d93(0x2a7),{'parse_mode':_0x340d93(0x249)});return;}const _0x55c5cd=await database_1['default'][_0x340d93(0x242)]['findFirst']({'where':{'shopId':_0x38afc1['id'],'isVerified':!![],'telegramId':{'not':_0x2a4e01}}});if(_0x55c5cd){await this[_0x340d93(0x24f)]?.[_0x340d93(0x1f1)](_0x5592e4,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x22cf41+_0x340d93(0x2cb)+_0x340d93(0x2c2),{'parse_mode':_0x340d93(0x249)});return;}await database_1[_0x340d93(0x2d5)][_0x340d93(0x242)]['update']({'where':{'telegramId':_0x2a4e01},'data':{'shopId':_0x38afc1['id'],'isVerified':!![]}}),await this[_0x340d93(0x24f)]?.[_0x340d93(0x1f1)](_0x5592e4,'🎉\x20*Congratulations!*\x0a\x0a'+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('📱\x20Shop:\x20*'+_0x38afc1[_0x340d93(0x225)]+'*\x0a')+(_0x340d93(0x29c)+_0x38afc1[_0x340d93(0x2b6)]+_0x340d93(0x2a3))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x340d93(0x2be)+_0x340d93(0x255)+_0x340d93(0x207)+_0x340d93(0x1f4)+_0x340d93(0x25b)+_0x340d93(0x222)+_0x340d93(0x27d),{'parse_mode':'Markdown'}),console['log']('✅\x20Telegram\x20user\x20'+_0x2a4e01+_0x340d93(0x299)+_0x38afc1['username']+_0x340d93(0x20c));}catch(_0x4d0ea9){console['error']('Error\x20in\x20handleSingleLineVerification:',_0x4d0ea9),await this['bot']?.[_0x340d93(0x1f1)](_0x5592e4,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a66_0x383da2(0x2d1)](_0xafdba6,_0x2f6f06,_0x4971cb){const _0x1da783=a66_0x383da2;if(!this[_0x1da783(0x24f)]){console[_0x1da783(0x2ca)](_0x1da783(0x2ad));return;}try{const _0x5e4f14=await database_1['default'][_0x1da783(0x242)]['findMany']({'where':{'shopId':_0xafdba6,'isVerified':!![]}});if(_0x5e4f14[_0x1da783(0x250)]===0x0){console[_0x1da783(0x281)](_0x1da783(0x26f)+_0xafdba6);return;}const _0x4b72c6=_0x5e4f14[_0x1da783(0x26b)](async _0x26b540=>{const _0x48147c=_0x1da783;try{await this[_0x48147c(0x24f)]?.['sendMessage'](_0x26b540['telegramId'],_0x2f6f06,_0x4971cb),console[_0x48147c(0x281)](_0x48147c(0x2df)+_0x26b540[_0x48147c(0x29e)]);}catch(_0x11ed29){console['error'](_0x48147c(0x27c)+_0x26b540[_0x48147c(0x29e)]+':',_0x11ed29),_0x11ed29 instanceof Error&&(_0x11ed29[_0x48147c(0x237)][_0x48147c(0x236)]('blocked')||_0x11ed29[_0x48147c(0x237)][_0x48147c(0x236)]('chat\x20not\x20found')||_0x11ed29[_0x48147c(0x237)][_0x48147c(0x236)](_0x48147c(0x274)))&&(await database_1[_0x48147c(0x2d5)][_0x48147c(0x242)][_0x48147c(0x298)]({'where':{'id':_0x26b540['id']},'data':{'isVerified':![]}}),console['log']('User\x20'+_0x26b540[_0x48147c(0x29e)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise['allSettled'](_0x4b72c6);}catch(_0x9c7cb5){console[_0x1da783(0x217)](_0x1da783(0x263),_0x9c7cb5);}}async[a66_0x383da2(0x211)](_0x21d987,_0x4f0e7e,_0x5b7d74){const _0x4b7370=a66_0x383da2,_0x4a639={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x901f72={'created':_0x4b7370(0x2bc),'paid':_0x4b7370(0x22a),'failed':_0x4b7370(0x28d),'expired':_0x4b7370(0x219),'refund':'Payment\x20refund','chargeback':_0x4b7370(0x27b),'processing':_0x4b7370(0x2dc)},_0xeed89f=_0x4a639[_0x5b7d74],_0x5b050a=_0x901f72[_0x5b7d74],_0x84679f=(0x0,gateway_1[_0x4b7370(0x2d4)])(_0x4f0e7e['gateway']);console['log']('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x4f0e7e['gateway']+'\x22\x20->\x20display\x20\x22'+_0x84679f+'\x22');let _0x367775=_0xeed89f+'\x20*'+_0x5b050a+_0x4b7370(0x26a)+('💰\x20Amount:\x20*'+_0x4f0e7e['amount']+'\x20'+_0x4f0e7e[_0x4b7370(0x2d0)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x4f0e7e[_0x4b7370(0x20d)]||_0x4f0e7e['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x4f0e7e['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x84679f+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x4f0e7e[_0x4b7370(0x2cf)])[_0x4b7370(0x213)](_0x4b7370(0x218))+'\x0a');if(_0x4f0e7e[_0x4b7370(0x1fe)]||_0x4f0e7e[_0x4b7370(0x2c1)]||_0x4f0e7e[_0x4b7370(0x1f9)]||_0x4f0e7e[_0x4b7370(0x246)]||_0x4f0e7e[_0x4b7370(0x28a)]){_0x367775+=_0x4b7370(0x2a2);_0x4f0e7e[_0x4b7370(0x1fe)]&&(_0x367775+=_0x4b7370(0x23b)+_0x4f0e7e[_0x4b7370(0x1fe)]+'`\x0a');_0x4f0e7e[_0x4b7370(0x2c1)]&&(_0x367775+=_0x4b7370(0x271)+_0x4f0e7e[_0x4b7370(0x2c1)]+'`\x0a');_0x4f0e7e[_0x4b7370(0x1f9)]&&(_0x367775+='🏦\x20IBAN:\x20`'+_0x4f0e7e[_0x4b7370(0x1f9)]+'`\x0a');_0x4f0e7e['customerIp']&&(_0x367775+=_0x4b7370(0x251)+_0x4f0e7e['customerIp']+'`\x0a');if(_0x4f0e7e[_0x4b7370(0x28a)]){const _0x2c17e0=_0x4f0e7e[_0x4b7370(0x28a)][_0x4b7370(0x250)]>0x32?_0x4f0e7e[_0x4b7370(0x28a)][_0x4b7370(0x23c)](0x0,0x32)+_0x4b7370(0x2a0):_0x4f0e7e[_0x4b7370(0x28a)];_0x367775+='💻\x20Browser:\x20`'+_0x2c17e0+'`\x0a';}}_0x5b7d74===_0x4b7370(0x2b2)&&_0x4f0e7e[_0x4b7370(0x268)]&&(_0x367775+='💸\x20Penalty\x20amount:\x20*'+_0x4f0e7e[_0x4b7370(0x268)]+_0x4b7370(0x20e)),_0x5b7d74===_0x4b7370(0x258)&&(_0x367775+=_0x4b7370(0x20f)),_0x4f0e7e['adminNotes']&&(_0x367775+=_0x4b7370(0x247)+_0x4f0e7e[_0x4b7370(0x269)]+'\x0a'),await this[_0x4b7370(0x2d1)](_0x21d987,_0x367775,{'parse_mode':'Markdown'});}async[a66_0x383da2(0x1fb)](_0x117bbf,_0x1e0814,_0x2483c6){const _0x2ac979=a66_0x383da2,_0x2600f8={'created':'📤','completed':'✅','rejected':'❌'},_0x629c71={'created':_0x2ac979(0x2cc),'completed':_0x2ac979(0x285),'rejected':_0x2ac979(0x2b1)},_0x4f5ba4=_0x2600f8[_0x2483c6],_0x3ec322=_0x629c71[_0x2483c6],_0x5a9fa7=_0x4f5ba4+'\x20*'+_0x3ec322+'*\x0a\x0a'+(_0x2ac979(0x215)+_0x1e0814['amount']+_0x2ac979(0x292))+(_0x2ac979(0x239)+_0x1e0814['method']+'`\x0a')+(_0x2ac979(0x2a9)+_0x1e0814['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x1e0814[_0x2ac979(0x2cf)])[_0x2ac979(0x213)]('en-US')+'\x0a')+(_0x1e0814[_0x2ac979(0x235)]?'🔗\x20TXID:\x20`'+_0x1e0814[_0x2ac979(0x235)]+'`':'');await this[_0x2ac979(0x2d1)](_0x117bbf,_0x5a9fa7,{'parse_mode':_0x2ac979(0x249)});}async[a66_0x383da2(0x202)](_0x3cd26d,_0x237b00){const _0x4c8033=a66_0x383da2;try{const _0xe9f066=await database_1['default']['shopSettings'][_0x4c8033(0x28f)]({'where':{'shopId':_0x3cd26d},'select':{'notificationLogin':!![]}});if(!_0xe9f066?.[_0x4c8033(0x23e)]){console['log'](_0x4c8033(0x284)+_0x3cd26d);return;}const _0x16a4df=_0x237b00[_0x4c8033(0x2d9)]?'🔐':'🚨',_0x32c16f=_0x237b00['success']?'Successful\x20login':_0x4c8033(0x290);let _0x59af1d=_0x16a4df+'\x20*'+_0x32c16f+_0x4c8033(0x26a)+(_0x4c8033(0x29c)+_0x237b00[_0x4c8033(0x2b6)]+'`\x0a')+(_0x4c8033(0x24d)+_0x237b00[_0x4c8033(0x1fd)]['toLocaleString'](_0x4c8033(0x218))+'\x0a');_0x237b00['ipAddress']&&(_0x59af1d+=_0x4c8033(0x288)+_0x237b00[_0x4c8033(0x241)]+'`\x0a');if(_0x237b00['userAgent']){const _0x53341e=_0x237b00[_0x4c8033(0x209)][_0x4c8033(0x250)]>0x32?_0x237b00[_0x4c8033(0x209)][_0x4c8033(0x23c)](0x0,0x32)+_0x4c8033(0x2a0):_0x237b00['userAgent'];_0x59af1d+='💻\x20Browser:\x20`'+_0x53341e+'`\x0a';}!_0x237b00[_0x4c8033(0x2d9)]&&(_0x59af1d+=_0x4c8033(0x1f3)),await this[_0x4c8033(0x2d1)](_0x3cd26d,_0x59af1d,{'parse_mode':_0x4c8033(0x249)}),console[_0x4c8033(0x281)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x3cd26d+':\x20'+(_0x237b00['success']?_0x4c8033(0x2d9):_0x4c8033(0x2ba)));}catch(_0x4845d7){console[_0x4c8033(0x217)](_0x4c8033(0x2e1),_0x4845d7);}}async[a66_0x383da2(0x2b9)](_0x368b8d,_0x20c7f9){const _0x277dbc=a66_0x383da2;try{const _0x146782=await database_1[_0x277dbc(0x2d5)][_0x277dbc(0x295)][_0x277dbc(0x28f)]({'where':{'shopId':_0x368b8d},'select':{'notificationApiError':!![]}});if(!_0x146782?.[_0x277dbc(0x2cd)]){console['log']('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x368b8d);return;}let _0x21646a=_0x277dbc(0x2e0)+(_0x277dbc(0x2a8)+_0x20c7f9[_0x277dbc(0x1f8)]+'\x20'+_0x20c7f9[_0x277dbc(0x223)]+'`\x0a')+('📅\x20Time:\x20'+_0x20c7f9[_0x277dbc(0x1fd)][_0x277dbc(0x213)](_0x277dbc(0x218))+'\x0a');_0x20c7f9[_0x277dbc(0x296)]&&(_0x21646a+='📊\x20Error\x20code:\x20`'+_0x20c7f9[_0x277dbc(0x296)]+'`\x0a'),_0x21646a+=_0x277dbc(0x22d)+_0x20c7f9[_0x277dbc(0x2d6)]+'`\x0a',_0x20c7f9['requestId']&&(_0x21646a+=_0x277dbc(0x256)+_0x20c7f9[_0x277dbc(0x2de)]+'`\x0a'),_0x21646a+=_0x277dbc(0x267),await this[_0x277dbc(0x2d1)](_0x368b8d,_0x21646a,{'parse_mode':_0x277dbc(0x249)}),console[_0x277dbc(0x281)](_0x277dbc(0x2e3)+_0x368b8d+':\x20'+_0x20c7f9['endpoint']);}catch(_0xcc46c9){console[_0x277dbc(0x217)](_0x277dbc(0x264),_0xcc46c9);}}async['sendCustomNotification'](_0x48d9bb,_0x52a770,_0x1a2318){const _0x4f5feb=a66_0x383da2;let _0x5c6e29='🔔\x20*'+_0x52a770+'*\x0a\x0a';for(const [_0x305371,_0x30c69a]of Object[_0x4f5feb(0x243)](_0x1a2318)){_0x30c69a!==null&&_0x30c69a!==undefined&&(_0x5c6e29+=_0x305371+_0x4f5feb(0x29b)+_0x30c69a+'`\x0a');}await this[_0x4f5feb(0x2d1)](_0x48d9bb,_0x5c6e29,{'parse_mode':_0x4f5feb(0x249)});}async[a66_0x383da2(0x29f)](_0x5e26f1){const _0x1237ed=a66_0x383da2;try{console[_0x1237ed(0x281)](_0x1237ed(0x234)+_0x5e26f1[_0x1237ed(0x23c)](0x0,0x32)+_0x1237ed(0x2a0));const _0x520541=await database_1[_0x1237ed(0x2d5)][_0x1237ed(0x242)][_0x1237ed(0x2d7)]({'select':{'telegramId':!![]}});if(_0x520541['length']===0x0){console[_0x1237ed(0x281)]('📱\x20No\x20active\x20Telegram\x20users\x20found');return;}for(const _0x17d6a1 of _0x520541){try{await this[_0x1237ed(0x24f)]?.[_0x1237ed(0x1f1)](_0x17d6a1[_0x1237ed(0x29e)],_0x5e26f1,{'parse_mode':_0x1237ed(0x249)});}catch(_0x42c701){console['error'](_0x1237ed(0x28e)+_0x17d6a1['telegramId']+':',_0x42c701);}}console[_0x1237ed(0x281)]('📱\x20Notification\x20sent\x20to\x20'+_0x520541['length']+_0x1237ed(0x23d));}catch(_0x49e247){console[_0x1237ed(0x217)](_0x1237ed(0x216),_0x49e247);}}[a66_0x383da2(0x21f)](){const _0x3d90f9=a66_0x383da2;return{'isActive':!!this[_0x3d90f9(0x24f)],'username':this[_0x3d90f9(0x227)]};}async['sendShopFile'](_0x5138ff,_0x1f4c64,_0xd97ce4,_0x3d259d){const _0x305e32=a66_0x383da2;try{if(!this[_0x305e32(0x24f)])return console[_0x305e32(0x217)]('❌\x20Telegram\x20bot\x20not\x20initialized'),![];const _0x398455=await database_1[_0x305e32(0x2d5)][_0x305e32(0x242)][_0x305e32(0x2d7)]({'where':{'shopId':_0x5138ff,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x398455[_0x305e32(0x250)]===0x0)return console[_0x305e32(0x217)](_0x305e32(0x22f)+_0x5138ff),![];let _0x2309d8=0x0;for(const _0x2b3f09 of _0x398455){try{await this[_0x305e32(0x24f)][_0x305e32(0x214)](_0x2b3f09[_0x305e32(0x29e)],_0x1f4c64,{},{'filename':_0xd97ce4,'contentType':_0xd97ce4[_0x305e32(0x2a4)](_0x305e32(0x2c0))?_0x305e32(0x25a):_0xd97ce4['endsWith'](_0x305e32(0x208))||_0xd97ce4[_0x305e32(0x2a4)](_0x305e32(0x293))?_0x305e32(0x2db):_0xd97ce4['endsWith'](_0x305e32(0x297))?_0x305e32(0x1f7):_0x305e32(0x232)}),_0x3d259d&&await this[_0x305e32(0x24f)][_0x305e32(0x1f1)](_0x2b3f09[_0x305e32(0x29e)],_0x3d259d),_0x2309d8++;}catch(_0x2961d5){console[_0x305e32(0x217)](_0x305e32(0x24e)+_0x2b3f09[_0x305e32(0x29e)]+':',_0x2961d5);}}return console['log'](_0x305e32(0x24c)+_0x2309d8+'/'+_0x398455[_0x305e32(0x250)]+_0x305e32(0x245)+_0x5138ff+':\x20'+_0xd97ce4),_0x2309d8>0x0;}catch(_0x2c2652){return console[_0x305e32(0x217)](_0x305e32(0x253),_0x2c2652),![];}}async[a66_0x383da2(0x2c5)](_0x30983d,_0x345f97){const _0x18386f=a66_0x383da2;try{if(!this[_0x18386f(0x24f)])return console['error'](_0x18386f(0x22e)),![];return await this['bot'][_0x18386f(0x1f1)](_0x30983d,_0x345f97),console['log'](_0x18386f(0x27a)+_0x30983d),!![];}catch(_0x2e08e4){return console[_0x18386f(0x217)]('❌\x20Error\x20sending\x20direct\x20message:',_0x2e08e4),![];}}async[a66_0x383da2(0x20a)](_0x97e50e,_0x5243c3,_0x1458cc,_0x44395f){const _0xf09646=a66_0x383da2;try{if(!this[_0xf09646(0x24f)])return console[_0xf09646(0x217)](_0xf09646(0x22e)),![];return await this[_0xf09646(0x24f)][_0xf09646(0x214)](_0x97e50e,_0x5243c3,{},{'filename':_0x1458cc,'contentType':_0x1458cc[_0xf09646(0x2a4)](_0xf09646(0x2c0))?_0xf09646(0x25a):_0x1458cc['endsWith'](_0xf09646(0x208))||_0x1458cc['endsWith'](_0xf09646(0x293))?_0xf09646(0x2db):_0x1458cc['endsWith'](_0xf09646(0x297))?_0xf09646(0x1f7):'application/octet-stream'}),_0x44395f&&await this['bot'][_0xf09646(0x1f1)](_0x97e50e,_0x44395f),console[_0xf09646(0x281)](_0xf09646(0x2bf)+_0x97e50e+':\x20'+_0x1458cc),!![];}catch(_0x34e331){return console[_0xf09646(0x217)](_0xf09646(0x2ab),_0x34e331),![];}}[a66_0x383da2(0x20b)](){const _0xd6c13f=a66_0x383da2;this['bot']&&(this[_0xd6c13f(0x24f)][_0xd6c13f(0x2e2)](),this[_0xd6c13f(0x24f)]=null,console[_0xd6c13f(0x281)](_0xd6c13f(0x2ae)));}}exports[a66_0x383da2(0x2dd)]=TelegramBotService,exports[a66_0x383da2(0x26d)]=new TelegramBotService();