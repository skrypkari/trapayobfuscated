'use strict';const a49_0x3b1875=a49_0x8b72;(function(_0x476df7,_0x57668c){const _0x4759a9=a49_0x8b72,_0x318bd7=_0x476df7();while(!![]){try{const _0x433758=-parseInt(_0x4759a9(0x26a))/0x1+parseInt(_0x4759a9(0x1f6))/0x2*(parseInt(_0x4759a9(0x1d0))/0x3)+parseInt(_0x4759a9(0x1e2))/0x4+parseInt(_0x4759a9(0x229))/0x5*(-parseInt(_0x4759a9(0x1cb))/0x6)+parseInt(_0x4759a9(0x1e0))/0x7+parseInt(_0x4759a9(0x1d1))/0x8*(-parseInt(_0x4759a9(0x26e))/0x9)+-parseInt(_0x4759a9(0x254))/0xa*(-parseInt(_0x4759a9(0x252))/0xb);if(_0x433758===_0x57668c)break;else _0x318bd7['push'](_0x318bd7['shift']());}catch(_0x36af83){_0x318bd7['push'](_0x318bd7['shift']());}}}(a49_0x5b4c,0x97d72));var __importDefault=this&&this[a49_0x3b1875(0x201)]||function(_0x2e153f){const _0x3d7eec=a49_0x3b1875;return _0x2e153f&&_0x2e153f[_0x3d7eec(0x274)]?_0x2e153f:{'default':_0x2e153f};};Object['defineProperty'](exports,a49_0x3b1875(0x274),{'value':!![]}),exports['telegramBotService']=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a49_0x3b1875(0x1a6))),gateway_1=require(a49_0x3b1875(0x238));class TelegramBotService{constructor(){const _0x1c5a13=a49_0x3b1875;this['bot']=null,this[_0x1c5a13(0x276)]=process['env'][_0x1c5a13(0x251)]||'',this[_0x1c5a13(0x1ca)]=process[_0x1c5a13(0x1b0)][_0x1c5a13(0x232)]||_0x1c5a13(0x1d4),this[_0x1c5a13(0x276)]?this[_0x1c5a13(0x1a4)]():console['warn']('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a49_0x3b1875(0x1a4)](){const _0x280c31=a49_0x3b1875;try{this[_0x280c31(0x211)]=new node_telegram_bot_api_1[(_0x280c31(0x27d))](this[_0x280c31(0x276)],{'polling':!![]}),this[_0x280c31(0x223)](),console[_0x280c31(0x216)](_0x280c31(0x272)+this['botUsername']+_0x280c31(0x241));}catch(_0x344698){console['error']('‚ùå\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x344698);}}[a49_0x3b1875(0x223)](){const _0x129028=a49_0x3b1875;if(!this[_0x129028(0x211)])return;this[_0x129028(0x211)][_0x129028(0x1b3)](/\/start/,async _0x45b5b4=>{const _0x3a66ac=_0x129028,_0x4755ae=_0x45b5b4['chat']['id'],_0xf9f787=_0x45b5b4['from']?.['id'][_0x3a66ac(0x279)](),_0x501cde=_0x45b5b4[_0x3a66ac(0x1b8)]?.[_0x3a66ac(0x1fb)],_0x49de86=_0x45b5b4[_0x3a66ac(0x1b8)]?.[_0x3a66ac(0x1c0)],_0x3297da=_0x45b5b4['from']?.[_0x3a66ac(0x261)];if(!_0xf9f787)return;try{let _0x5437bf=await database_1[_0x3a66ac(0x27d)][_0x3a66ac(0x230)][_0x3a66ac(0x1df)]({'where':{'telegramId':_0xf9f787},'include':{'shop':!![]}});!_0x5437bf?(_0x5437bf=await database_1[_0x3a66ac(0x27d)][_0x3a66ac(0x230)][_0x3a66ac(0x1af)]({'data':{'telegramId':_0xf9f787,'username':_0x501cde,'firstName':_0x49de86,'lastName':_0x3297da,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x3a66ac(0x216)](_0x3a66ac(0x27c)+_0xf9f787+_0x3a66ac(0x23b)+_0x501cde+')')):_0x5437bf=await database_1[_0x3a66ac(0x27d)]['telegramUser'][_0x3a66ac(0x1fc)]({'where':{'telegramId':_0xf9f787},'data':{'username':_0x501cde,'firstName':_0x49de86,'lastName':_0x3297da},'include':{'shop':!![]}}),_0x5437bf[_0x3a66ac(0x1ee)]&&_0x5437bf['shopId']&&_0x5437bf[_0x3a66ac(0x228)]?await this[_0x3a66ac(0x211)]?.[_0x3a66ac(0x1bf)](_0x4755ae,_0x3a66ac(0x25c)+(_0x3a66ac(0x24c)+_0x5437bf['shop'][_0x3a66ac(0x24e)]+'*\x0a')+(_0x3a66ac(0x22c)+_0x5437bf['shop'][_0x3a66ac(0x1fb)]+_0x3a66ac(0x1d3))+'üîî\x20You\x20receive\x20notifications\x20about:\x0a'+_0x3a66ac(0x20b)+_0x3a66ac(0x1a9)+_0x3a66ac(0x243)+'Commands:\x0a'+_0x3a66ac(0x204)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x3a66ac(0x22f)}):(_0x5437bf[_0x3a66ac(0x1f3)]&&!_0x5437bf[_0x3a66ac(0x1ee)]&&(await database_1[_0x3a66ac(0x27d)][_0x3a66ac(0x230)]['update']({'where':{'telegramId':_0xf9f787},'data':{'shopId':null,'isVerified':![]}}),console[_0x3a66ac(0x216)](_0x3a66ac(0x240)+_0xf9f787)),await this[_0x3a66ac(0x211)]?.[_0x3a66ac(0x1bf)](_0x4755ae,_0x3a66ac(0x247)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x3a66ac(0x26b)+_0x3a66ac(0x23e)+_0x3a66ac(0x24f)+_0x3a66ac(0x264),{'parse_mode':'Markdown'}));}catch(_0x4961c9){console[_0x3a66ac(0x1e8)](_0x3a66ac(0x262),_0x4961c9),await this[_0x3a66ac(0x211)]?.[_0x3a66ac(0x1bf)](_0x4755ae,_0x3a66ac(0x255));}}),this[_0x129028(0x211)][_0x129028(0x1b3)](/\/disconnect/,async _0x134268=>{const _0x4e7197=_0x129028,_0x4072d4=_0x134268['chat']['id'],_0x383153=_0x134268['from']?.['id']['toString']();if(!_0x383153)return;try{const _0xe2cf66=await database_1['default'][_0x4e7197(0x230)][_0x4e7197(0x1df)]({'where':{'telegramId':_0x383153},'include':{'shop':!![]}});if(!_0xe2cf66||!_0xe2cf66[_0x4e7197(0x1ee)]||!_0xe2cf66[_0x4e7197(0x1f3)]){await this[_0x4e7197(0x211)]?.[_0x4e7197(0x1bf)](_0x4072d4,_0x4e7197(0x1b1));return;}const _0x21cb46=_0xe2cf66[_0x4e7197(0x228)]?.[_0x4e7197(0x24e)]||_0x4e7197(0x244);await database_1[_0x4e7197(0x27d)][_0x4e7197(0x230)]['update']({'where':{'telegramId':_0x383153},'data':{'shopId':null,'isVerified':![]}}),console[_0x4e7197(0x216)]('üîå\x20User\x20'+_0x383153+_0x4e7197(0x25b)+_0xe2cf66['shopId']),await this[_0x4e7197(0x211)]?.[_0x4e7197(0x1bf)](_0x4072d4,_0x4e7197(0x1ec)+_0x21cb46+_0x4e7197(0x20d)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x4e7197(0x22f)});}catch(_0x38f061){console[_0x4e7197(0x1e8)](_0x4e7197(0x265),_0x38f061),await this[_0x4e7197(0x211)]?.['sendMessage'](_0x4072d4,'‚ùå\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['onText'](/\/status/,async _0x572cb2=>{const _0x23c8e8=_0x129028,_0x531320=_0x572cb2[_0x23c8e8(0x227)]['id'],_0x56cc66=_0x572cb2[_0x23c8e8(0x1b8)]?.['id'][_0x23c8e8(0x279)]();if(!_0x56cc66)return;try{const _0x29993b=await database_1['default'][_0x23c8e8(0x230)][_0x23c8e8(0x1df)]({'where':{'telegramId':_0x56cc66},'include':{'shop':!![]}});if(!_0x29993b){await this[_0x23c8e8(0x211)]?.[_0x23c8e8(0x1bf)](_0x531320,_0x23c8e8(0x26c)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x29993b[_0x23c8e8(0x1ee)]||!_0x29993b[_0x23c8e8(0x1f3)]||!_0x29993b[_0x23c8e8(0x228)]){await this[_0x23c8e8(0x211)]?.[_0x23c8e8(0x1bf)](_0x531320,'‚ùå\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x23c8e8(0x220));return;}await this[_0x23c8e8(0x211)]?.['sendMessage'](_0x531320,'üìä\x20*Connection\x20Status*\x0a\x0a'+(_0x23c8e8(0x257)+_0x29993b['shop'][_0x23c8e8(0x24e)]+'*\x0a')+(_0x23c8e8(0x1fa)+_0x29993b[_0x23c8e8(0x228)][_0x23c8e8(0x1fb)]+'`\x0a')+(_0x23c8e8(0x1ad)+_0x29993b['updatedAt'][_0x23c8e8(0x210)](_0x23c8e8(0x1ae))+'\x0a\x0a')+_0x23c8e8(0x1d8)+_0x23c8e8(0x1a7)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'});}catch(_0x317273){console[_0x23c8e8(0x1e8)](_0x23c8e8(0x258),_0x317273),await this[_0x23c8e8(0x211)]?.[_0x23c8e8(0x1bf)](_0x531320,_0x23c8e8(0x255));}}),this[_0x129028(0x211)][_0x129028(0x1b3)](/\/debug/,async _0x2b9a39=>{const _0x468e95=_0x129028,_0x497de1=_0x2b9a39[_0x468e95(0x227)]['id'],_0x18fe70=_0x2b9a39[_0x468e95(0x1b8)]?.['id'][_0x468e95(0x279)]();if(!_0x18fe70)return;try{const _0x50ee4d=await database_1[_0x468e95(0x27d)][_0x468e95(0x228)][_0x468e95(0x21b)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x5cb836=_0x468e95(0x280);_0x5cb836+=_0x468e95(0x25e)+_0x18fe70+'`\x0a\x0a',_0x5cb836+=_0x468e95(0x234),_0x50ee4d[_0x468e95(0x20f)]((_0x3d300e,_0x2f2ba2)=>{const _0x1fdc71=_0x468e95;_0x5cb836+=_0x2f2ba2+0x1+_0x1fdc71(0x1dd)+_0x3d300e[_0x1fdc71(0x24e)]+'*\x0a',_0x5cb836+='\x20\x20\x20Username:\x20`'+_0x3d300e[_0x1fdc71(0x1fb)]+'`\x0a',_0x5cb836+=_0x1fdc71(0x219)+_0x3d300e['status']+'\x0a',_0x5cb836+=_0x1fdc71(0x1fe)+_0x3d300e[_0x1fdc71(0x248)][_0x1fdc71(0x200)](0x0,0xf)+_0x1fdc71(0x1c3);}),await this[_0x468e95(0x211)]?.[_0x468e95(0x1bf)](_0x497de1,_0x5cb836,{'parse_mode':_0x468e95(0x22f)});}catch(_0x4c68ea){console[_0x468e95(0x1e8)](_0x468e95(0x26d),_0x4c68ea),await this['bot']?.[_0x468e95(0x1bf)](_0x497de1,_0x468e95(0x271));}}),this[_0x129028(0x211)]['on'](_0x129028(0x21a),async _0xf054c7=>{const _0x6d6c4f=_0x129028;if(_0xf054c7[_0x6d6c4f(0x20c)]?.['startsWith']('/'))return;const _0x5e7295=_0xf054c7[_0x6d6c4f(0x227)]['id'],_0x413bd5=_0xf054c7[_0x6d6c4f(0x1b8)]?.['id']['toString'](),_0x388fae=_0xf054c7[_0x6d6c4f(0x20c)]?.[_0x6d6c4f(0x1bc)]();if(!_0x413bd5||!_0x388fae)return;try{const _0x58ae47=await database_1[_0x6d6c4f(0x27d)][_0x6d6c4f(0x230)]['findUnique']({'where':{'telegramId':_0x413bd5},'include':{'shop':!![]}});if(!_0x58ae47){await this[_0x6d6c4f(0x211)]?.[_0x6d6c4f(0x1bf)](_0x5e7295,_0x6d6c4f(0x1d2));return;}if(_0x58ae47[_0x6d6c4f(0x1ee)]&&_0x58ae47[_0x6d6c4f(0x1f3)]&&_0x58ae47['shop']){await this[_0x6d6c4f(0x211)]?.[_0x6d6c4f(0x1bf)](_0x5e7295,_0x6d6c4f(0x214)+_0x58ae47[_0x6d6c4f(0x228)]['name']+'*.\x0a\x0a'+_0x6d6c4f(0x1cd),{'parse_mode':_0x6d6c4f(0x22f)});return;}const _0x2469c0=_0x388fae[_0x6d6c4f(0x1b7)](/\s+/);if(_0x2469c0['length']!==0x2){await this[_0x6d6c4f(0x211)]?.[_0x6d6c4f(0x1bf)](_0x5e7295,_0x6d6c4f(0x231)+_0x6d6c4f(0x26b)+_0x6d6c4f(0x23e)+_0x6d6c4f(0x24f)+(_0x6d6c4f(0x1cf)+_0x2469c0[_0x6d6c4f(0x245)]+'\x20parts:\x20'+_0x2469c0[_0x6d6c4f(0x236)](_0x30b1c1=>'`'+_0x30b1c1+'`')['join'](',\x20')),{'parse_mode':_0x6d6c4f(0x22f)});return;}const [_0x2fcbeb,_0x318ca7]=_0x2469c0;console[_0x6d6c4f(0x216)](_0x6d6c4f(0x25d)+_0x413bd5+':\x20username=\x22'+_0x2fcbeb+'\x22,\x20apiKey=\x22'+_0x318ca7[_0x6d6c4f(0x200)](0x0,0xa)+'...\x22'),await this[_0x6d6c4f(0x22e)](_0x5e7295,_0x413bd5,_0x2fcbeb,_0x318ca7);}catch(_0x422d51){console[_0x6d6c4f(0x1e8)]('Error\x20handling\x20message:',_0x422d51),await this[_0x6d6c4f(0x211)]?.[_0x6d6c4f(0x1bf)](_0x5e7295,_0x6d6c4f(0x255));}}),this[_0x129028(0x211)]['on'](_0x129028(0x1e8),_0x4a5161=>{const _0x325393=_0x129028;console[_0x325393(0x1e8)](_0x325393(0x1ba),_0x4a5161);}),this[_0x129028(0x211)]['on'](_0x129028(0x224),_0x47b6cc=>{const _0x331d31=_0x129028;console[_0x331d31(0x1e8)](_0x331d31(0x263),_0x47b6cc);});}async[a49_0x3b1875(0x22e)](_0xec5707,_0xd8d2d8,_0x495c2f,_0x56d2cc){const _0xa43c4e=a49_0x3b1875;try{console[_0xa43c4e(0x216)](_0xa43c4e(0x25d)+_0xd8d2d8+_0xa43c4e(0x21c)+_0x495c2f+'\x22,\x20apiKey=\x22'+_0x56d2cc[_0xa43c4e(0x200)](0x0,0xa)+_0xa43c4e(0x250));if(!_0x495c2f||_0x495c2f['length']<0x3||_0x495c2f[_0xa43c4e(0x245)]>0x32||!/^[a-zA-Z0-9_]+$/[_0xa43c4e(0x242)](_0x495c2f)){await this[_0xa43c4e(0x211)]?.[_0xa43c4e(0x1bf)](_0xec5707,_0xa43c4e(0x1e9)+_0x495c2f+_0xa43c4e(0x1d3)+_0xa43c4e(0x1b5),{'parse_mode':_0xa43c4e(0x22f)});return;}if(!_0x56d2cc||!_0x56d2cc[_0xa43c4e(0x277)]('pk_')&&!_0x56d2cc['startsWith']('sk_')){await this[_0xa43c4e(0x211)]?.['sendMessage'](_0xec5707,_0xa43c4e(0x212)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0xa43c4e(0x22f)});return;}const _0x526fff=await database_1[_0xa43c4e(0x27d)][_0xa43c4e(0x228)][_0xa43c4e(0x1df)]({'where':{'username':_0x495c2f},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x526fff){const _0x40f275=await database_1[_0xa43c4e(0x27d)][_0xa43c4e(0x228)][_0xa43c4e(0x21b)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x4728f1=_0xa43c4e(0x1a5)+_0x495c2f+_0xa43c4e(0x1f8);_0x40f275[_0xa43c4e(0x245)]>0x0?(_0x4728f1+='Available\x20usernames:\x0a',_0x40f275[_0xa43c4e(0x20f)](_0x5e9b83=>{const _0x13e2bd=_0xa43c4e;_0x4728f1+=_0x13e2bd(0x259)+_0x5e9b83[_0x13e2bd(0x1fb)]+_0x13e2bd(0x1c9)+_0x5e9b83['name']+')\x0a';}),_0x4728f1+=_0xa43c4e(0x1f9)):_0x4728f1+=_0xa43c4e(0x239);await this[_0xa43c4e(0x211)]?.[_0xa43c4e(0x1bf)](_0xec5707,_0x4728f1,{'parse_mode':'Markdown'});return;}if(_0x526fff[_0xa43c4e(0x266)]!==_0xa43c4e(0x1c6)){await this[_0xa43c4e(0x211)]?.[_0xa43c4e(0x1bf)](_0xec5707,_0xa43c4e(0x222)+_0x495c2f+_0xa43c4e(0x23f)+'Contact\x20administrator.',{'parse_mode':'Markdown'});return;}if(_0x526fff['publicKey']!==_0x56d2cc&&_0x526fff[_0xa43c4e(0x206)]!==_0x56d2cc){await this[_0xa43c4e(0x211)]?.[_0xa43c4e(0x1bf)](_0xec5707,_0xa43c4e(0x221)+_0x495c2f+'`.\x0a\x0a'+_0xa43c4e(0x1bd)+_0xa43c4e(0x1c2),{'parse_mode':_0xa43c4e(0x22f)});return;}const _0x529ad8=await database_1[_0xa43c4e(0x27d)][_0xa43c4e(0x230)][_0xa43c4e(0x1bb)]({'where':{'shopId':_0x526fff['id'],'isVerified':!![],'telegramId':{'not':_0xd8d2d8}}});if(_0x529ad8){await this[_0xa43c4e(0x211)]?.['sendMessage'](_0xec5707,_0xa43c4e(0x218)+_0x495c2f+_0xa43c4e(0x1b2)+_0xa43c4e(0x27e),{'parse_mode':'Markdown'});return;}await database_1['default'][_0xa43c4e(0x230)][_0xa43c4e(0x1fc)]({'where':{'telegramId':_0xd8d2d8},'data':{'shopId':_0x526fff['id'],'isVerified':!![]}}),await this[_0xa43c4e(0x211)]?.[_0xa43c4e(0x1bf)](_0xec5707,_0xa43c4e(0x20e)+'‚úÖ\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0xa43c4e(0x1c4)+_0x526fff['name']+'*\x0a')+(_0xa43c4e(0x1fa)+_0x526fff[_0xa43c4e(0x1fb)]+_0xa43c4e(0x1d3))+_0xa43c4e(0x27f)+_0xa43c4e(0x20b)+_0xa43c4e(0x1a9)+_0xa43c4e(0x1c8)+_0xa43c4e(0x217)+'Commands:\x0a'+_0xa43c4e(0x204)+_0xa43c4e(0x1dc),{'parse_mode':_0xa43c4e(0x22f)}),console['log']('‚úÖ\x20Telegram\x20user\x20'+_0xd8d2d8+'\x20verified\x20for\x20shop\x20'+_0x526fff[_0xa43c4e(0x1fb)]+_0xa43c4e(0x1d9));}catch(_0x226255){console['error']('Error\x20in\x20handleSingleLineVerification:',_0x226255),await this['bot']?.[_0xa43c4e(0x1bf)](_0xec5707,'‚ùå\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a49_0x3b1875(0x202)](_0x3f1118,_0x33e2f4,_0x44fa36){const _0x33cc73=a49_0x3b1875;if(!this[_0x33cc73(0x211)]){console[_0x33cc73(0x1ea)](_0x33cc73(0x1b4));return;}try{const _0x5be24a=await database_1['default'][_0x33cc73(0x230)]['findMany']({'where':{'shopId':_0x3f1118,'isVerified':!![]}});if(_0x5be24a['length']===0x0){console[_0x33cc73(0x216)](_0x33cc73(0x1ab)+_0x3f1118);return;}const _0x4b5479=_0x5be24a[_0x33cc73(0x236)](async _0x449459=>{const _0x555258=_0x33cc73;try{await this['bot']?.[_0x555258(0x1bf)](_0x449459[_0x555258(0x1f4)],_0x33e2f4,_0x44fa36),console[_0x555258(0x216)](_0x555258(0x24d)+_0x449459[_0x555258(0x1f4)]);}catch(_0xb315a6){console[_0x555258(0x1e8)]('‚ùå\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x449459['telegramId']+':',_0xb315a6),_0xb315a6 instanceof Error&&(_0xb315a6[_0x555258(0x21a)][_0x555258(0x1e6)](_0x555258(0x21d))||_0xb315a6['message'][_0x555258(0x1e6)]('chat\x20not\x20found')||_0xb315a6['message'][_0x555258(0x1e6)](_0x555258(0x1e1)))&&(await database_1[_0x555258(0x27d)][_0x555258(0x230)][_0x555258(0x1fc)]({'where':{'id':_0x449459['id']},'data':{'isVerified':![]}}),console['log']('User\x20'+_0x449459[_0x555258(0x1f4)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x33cc73(0x275)](_0x4b5479);}catch(_0x2d3152){console[_0x33cc73(0x1e8)](_0x33cc73(0x1e3),_0x2d3152);}}async[a49_0x3b1875(0x246)](_0x26466b,_0x5e2f8f,_0x4e3f98){const _0x693525=a49_0x3b1875,_0x222e5b={'created':'üÜï','paid':'‚úÖ','failed':'‚ùå','expired':'‚è∞','refund':'üîÑ','chargeback':'‚ö†Ô∏è','processing':'‚öôÔ∏è'},_0x2b8848={'created':'New\x20payment\x20created','paid':_0x693525(0x23d),'failed':_0x693525(0x1f0),'expired':_0x693525(0x1e5),'refund':_0x693525(0x235),'chargeback':_0x693525(0x20a),'processing':'Payment\x20is\x20being\x20processed'},_0x1c24e8=_0x222e5b[_0x4e3f98],_0x356351=_0x2b8848[_0x4e3f98],_0x2a519d=(0x0,gateway_1[_0x693525(0x1ff)])(_0x5e2f8f['gateway']);console['log']('üì±\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x5e2f8f['gateway']+_0x693525(0x1d7)+_0x2a519d+'\x22');let _0x19472c=_0x1c24e8+'\x20*'+_0x356351+'*\x0a\x0a'+(_0x693525(0x225)+_0x5e2f8f[_0x693525(0x22b)]+'\x20'+_0x5e2f8f[_0x693525(0x25f)]+'*\x0a')+(_0x693525(0x226)+(_0x5e2f8f[_0x693525(0x269)]||_0x5e2f8f['id'])+'`\x0a')+(_0x693525(0x253)+_0x5e2f8f['id']+'`\x0a')+('üè™\x20Gateway:\x20`'+_0x2a519d+'`\x0a')+(_0x693525(0x1b6)+new Date(_0x5e2f8f[_0x693525(0x213)])[_0x693525(0x205)]('en-US')+'\x0a');(_0x5e2f8f[_0x693525(0x21f)]||_0x5e2f8f[_0x693525(0x1da)])&&(_0x19472c+=_0x693525(0x1c5),_0x5e2f8f[_0x693525(0x21f)]&&(_0x19472c+='üìõ\x20Name:\x20`'+_0x5e2f8f['customerName']+'`\x0a'),_0x5e2f8f['customerEmail']&&(_0x19472c+=_0x693525(0x1be)+_0x5e2f8f[_0x693525(0x1da)]+'`\x0a')),_0x4e3f98===_0x693525(0x1e4)&&_0x5e2f8f['chargebackAmount']&&(_0x19472c+=_0x693525(0x273)+_0x5e2f8f[_0x693525(0x267)]+_0x693525(0x1c1)),_0x4e3f98===_0x693525(0x268)&&(_0x19472c+=_0x693525(0x24a)),_0x5e2f8f[_0x693525(0x1f7)]&&(_0x19472c+='üìù\x20Notes:\x20'+_0x5e2f8f[_0x693525(0x1f7)]+'\x0a'),await this[_0x693525(0x202)](_0x26466b,_0x19472c,{'parse_mode':_0x693525(0x22f)});}async[a49_0x3b1875(0x1de)](_0x523271,_0x4019d7,_0x154a48){const _0x3f53aa=a49_0x3b1875,_0x565b77={'created':'üì§','completed':'‚úÖ','rejected':'‚ùå'},_0x1f5973={'created':_0x3f53aa(0x1ed),'completed':'Payout\x20completed','rejected':_0x3f53aa(0x1cc)},_0x30c28a=_0x565b77[_0x154a48],_0x8b09cb=_0x1f5973[_0x154a48],_0x48cf09=_0x30c28a+'\x20*'+_0x8b09cb+'*\x0a\x0a'+(_0x3f53aa(0x27a)+_0x4019d7[_0x3f53aa(0x22b)]+_0x3f53aa(0x1aa))+('üè¶\x20Method:\x20`'+_0x4019d7[_0x3f53aa(0x215)]+'`\x0a')+('üÜî\x20Payout\x20ID:\x20`'+_0x4019d7['id']+'`\x0a')+(_0x3f53aa(0x1b6)+new Date(_0x4019d7['createdAt'])[_0x3f53aa(0x205)]('en-US')+'\x0a')+(_0x4019d7[_0x3f53aa(0x1f5)]?'üîó\x20TXID:\x20`'+_0x4019d7[_0x3f53aa(0x1f5)]+'`':'');await this[_0x3f53aa(0x202)](_0x523271,_0x48cf09,{'parse_mode':'Markdown'});}async[a49_0x3b1875(0x26f)](_0xd6bb81,_0x1eb7d7){const _0x218dfc=a49_0x3b1875;try{const _0x26b2f2=await database_1[_0x218dfc(0x27d)][_0x218dfc(0x208)][_0x218dfc(0x1df)]({'where':{'shopId':_0xd6bb81},'select':{'notificationLogin':!![]}});if(!_0x26b2f2?.['notificationLogin']){console[_0x218dfc(0x216)](_0x218dfc(0x260)+_0xd6bb81);return;}const _0x29df63=_0x1eb7d7[_0x218dfc(0x24b)]?'üîê':'üö®',_0x45e7d5=_0x1eb7d7[_0x218dfc(0x24b)]?_0x218dfc(0x1ac):_0x218dfc(0x23c);let _0x417885=_0x29df63+'\x20*'+_0x45e7d5+_0x218dfc(0x1a3)+(_0x218dfc(0x1fa)+_0x1eb7d7['username']+'`\x0a')+('üìÖ\x20Time:\x20'+_0x1eb7d7[_0x218dfc(0x1c7)][_0x218dfc(0x205)](_0x218dfc(0x1ae))+'\x0a');_0x1eb7d7[_0x218dfc(0x1ef)]&&(_0x417885+='üåê\x20IP\x20address:\x20`'+_0x1eb7d7[_0x218dfc(0x1ef)]+'`\x0a');if(_0x1eb7d7['userAgent']){const _0xa7c9a4=_0x1eb7d7[_0x218dfc(0x249)]['length']>0x32?_0x1eb7d7[_0x218dfc(0x249)][_0x218dfc(0x200)](0x0,0x32)+_0x218dfc(0x1f2):_0x1eb7d7[_0x218dfc(0x249)];_0x417885+=_0x218dfc(0x1d5)+_0xa7c9a4+'`\x0a';}!_0x1eb7d7[_0x218dfc(0x24b)]&&(_0x417885+=_0x218dfc(0x25a)),await this[_0x218dfc(0x202)](_0xd6bb81,_0x417885,{'parse_mode':'Markdown'}),console[_0x218dfc(0x216)](_0x218dfc(0x22a)+_0xd6bb81+':\x20'+(_0x1eb7d7[_0x218dfc(0x24b)]?_0x218dfc(0x24b):_0x218dfc(0x1eb)));}catch(_0x59a8f8){console[_0x218dfc(0x1e8)](_0x218dfc(0x270),_0x59a8f8);}}async[a49_0x3b1875(0x22d)](_0x458172,_0x4eb3be){const _0x4679ed=a49_0x3b1875;try{const _0x3b9154=await database_1['default']['shopSettings'][_0x4679ed(0x1df)]({'where':{'shopId':_0x458172},'select':{'notificationApiError':!![]}});if(!_0x3b9154?.[_0x4679ed(0x1ce)]){console['log'](_0x4679ed(0x256)+_0x458172);return;}let _0xe0b584='üö®\x20*API\x20Error*\x0a\x0a'+(_0x4679ed(0x1f1)+_0x4eb3be['method']+'\x20'+_0x4eb3be[_0x4679ed(0x1a8)]+'`\x0a')+('üìÖ\x20Time:\x20'+_0x4eb3be[_0x4679ed(0x1c7)][_0x4679ed(0x205)](_0x4679ed(0x1ae))+'\x0a');_0x4eb3be[_0x4679ed(0x1db)]&&(_0xe0b584+='üìä\x20Error\x20code:\x20`'+_0x4eb3be[_0x4679ed(0x1db)]+'`\x0a'),_0xe0b584+=_0x4679ed(0x207)+_0x4eb3be[_0x4679ed(0x1e7)]+'`\x0a',_0x4eb3be[_0x4679ed(0x1b9)]&&(_0xe0b584+='üÜî\x20Request\x20ID:\x20`'+_0x4eb3be['requestId']+'`\x0a'),_0xe0b584+=_0x4679ed(0x233),await this['sendShopNotification'](_0x458172,_0xe0b584,{'parse_mode':_0x4679ed(0x22f)}),console[_0x4679ed(0x216)](_0x4679ed(0x21e)+_0x458172+':\x20'+_0x4eb3be[_0x4679ed(0x1a8)]);}catch(_0x35af1f){console[_0x4679ed(0x1e8)](_0x4679ed(0x1d6),_0x35af1f);}}async['sendCustomNotification'](_0x4c388e,_0x337021,_0x8ac7fb){const _0x5718cc=a49_0x3b1875;let _0x5d3441=_0x5718cc(0x1fd)+_0x337021+_0x5718cc(0x1a3);for(const [_0x3be331,_0x38642e]of Object['entries'](_0x8ac7fb)){_0x38642e!==null&&_0x38642e!==undefined&&(_0x5d3441+=_0x3be331+_0x5718cc(0x23a)+_0x38642e+'`\x0a');}await this[_0x5718cc(0x202)](_0x4c388e,_0x5d3441,{'parse_mode':'Markdown'});}['getBotInfo'](){const _0x42d0de=a49_0x3b1875;return{'isActive':!!this[_0x42d0de(0x211)],'username':this[_0x42d0de(0x1ca)]};}[a49_0x3b1875(0x203)](){const _0x2b4570=a49_0x3b1875;this[_0x2b4570(0x211)]&&(this[_0x2b4570(0x211)][_0x2b4570(0x209)](),this[_0x2b4570(0x211)]=null,console[_0x2b4570(0x216)](_0x2b4570(0x27b)));}}exports[a49_0x3b1875(0x278)]=TelegramBotService,exports[a49_0x3b1875(0x237)]=new TelegramBotService();function a49_0x8b72(_0x410568,_0x4bcb8d){const _0x5b4c2b=a49_0x5b4c();return a49_0x8b72=function(_0x8b72a6,_0x2f7931){_0x8b72a6=_0x8b72a6-0x1a3;let _0x2ca733=_0x5b4c2b[_0x8b72a6];return _0x2ca733;},a49_0x8b72(_0x410568,_0x4bcb8d);}function a49_0x5b4c(){const _0x53e232=['/status\x20-\x20check\x20connection\x20status\x0a','toLocaleString','secretKey','‚ùå\x20Error:\x20`','shopSettings','stopPolling','Payment\x20chargeback','‚Ä¢\x20New\x20payments\x0a','text','*.\x0a\x0a','üéâ\x20*Congratulations!*\x0a\x0a','forEach','toLocaleDateString','bot','‚ùå\x20Invalid\x20API\x20key\x20format.\x0a\x0a','createdAt','‚úÖ\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','method','log','‚Ä¢\x20Important\x20events\x0a\x0a','‚ùå\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','\x20\x20\x20Status:\x20','message','findMany',':\x20username=\x22','blocked','‚úÖ\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','customerName','Use\x20/start\x20to\x20connect.','‚ùå\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','‚ùå\x20Shop\x20`','setupBotHandlers','polling_error','üí∞\x20Amount:\x20*','üìù\x20Order\x20ID:\x20`','chat','shop','55EmswMS','‚úÖ\x20Login\x20notification\x20sent\x20for\x20shop\x20','amount','Username:\x20`','sendApiErrorNotification','handleSingleLineVerification','Markdown','telegramUser','‚ùå\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','TELEGRAM_BOT_USERNAME','\x0aüí°\x20Check\x20your\x20request\x20or\x20contact\x20support.','üè™\x20Available\x20shops\x20in\x20system:\x0a','Payment\x20refund','map','telegramBotService','../types/gateway','Check\x20spelling\x20and\x20try\x20again.',':\x20`','\x20(@','Failed\x20login\x20attempt','Payment\x20successfully\x20paid','Example:\x0a','`\x20is\x20inactive.\x0a\x0a','üîÑ\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','\x20initialized\x20successfully','test','‚Ä¢\x20Payouts\x0a\x0a','unknown\x20shop','length','sendPaymentNotification','ü§ñ\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','publicKey','userAgent','‚è≥\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','success','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','‚úÖ\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','name','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','...\x22','TELEGRAM_BOT_TOKEN','99bjKAcG','üÜî\x20Payment\x20ID:\x20`','804490zsjKKI','‚ùå\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','üì±\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','‚úÖ\x20Connected\x20to\x20shop:\x20*','Error\x20handling\x20/status\x20command:','‚Ä¢\x20`','\x0a‚ö†Ô∏è\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','\x20disconnected\x20from\x20shop\x20','‚úÖ\x20Welcome\x20back!\x0a\x0a','üîÑ\x20Processing\x20single-line\x20verification\x20for\x20user\x20','üì±\x20Your\x20Telegram\x20ID:\x20`','currency','üì±\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','last_name','Error\x20handling\x20/start\x20command:','Telegram\x20bot\x20polling\x20error:','‚ùóÔ∏è\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','Error\x20handling\x20/disconnect\x20command:','status','chargebackAmount','processing','orderId','989056cmGGrH','üìù\x20Format:\x20`username\x20api_key`\x0a\x0a','‚ùå\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','Error\x20handling\x20/debug\x20command:','32985HMtxTp','sendLoginNotification','Failed\x20to\x20send\x20login\x20notification:','‚ùå\x20Error\x20getting\x20debug\x20information.','‚úÖ\x20Telegram\x20bot\x20@','üí∏\x20Penalty\x20amount:\x20*','__esModule','allSettled','botToken','startsWith','TelegramBotService','toString','üí∏\x20Amount:\x20*','üõë\x20Telegram\x20bot\x20stopped','üì±\x20Created\x20new\x20Telegram\x20user:\x20','default','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','üîî\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','üîç\x20*Debug\x20Information*\x0a\x0a','*\x0a\x0a','initializeBot','‚ùå\x20Shop\x20with\x20username\x20`','../config/database','Commands:\x0a','endpoint','‚Ä¢\x20Payment\x20status\x20changes\x0a','\x20USD*\x0a','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','Successful\x20login','üìÖ\x20Connection\x20date:\x20','en-US','create','env','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','`.\x0a\x0a','onText','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','üìÖ\x20Date:\x20','split','from','requestId','Telegram\x20bot\x20error:','findFirst','trim','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','üìß\x20Email:\x20`','sendMessage','first_name','\x20USDT*\x0a','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','...`\x0a\x0a','üì±\x20Shop:\x20*','\x0aüë§\x20*Customer\x20Information:*\x0a','ACTIVE','timestamp','‚Ä¢\x20Payouts\x0a','`\x20(','botUsername','468174HatBYZ','Payout\x20rejected','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','notificationApiError','You\x20sent\x20','69GSvHqZ','304PODJuj','‚ùå\x20Please\x20use\x20/start\x20command\x20first','`\x0a\x0a','trapay_bot','üíª\x20Browser:\x20`','Failed\x20to\x20send\x20API\x20error\x20notification:','\x22\x20->\x20display\x20\x22','üîî\x20Notifications\x20are\x20active\x0a\x0a','\x20via\x20single-line\x20input','customerEmail','statusCode','/disconnect\x20-\x20disconnect\x20from\x20notifications','.\x20*','sendPayoutNotification','findUnique','3366167ENwkCU','user\x20is\x20deactivated','3678688CpAOZN','Error\x20sending\x20shop\x20notification:','chargeback','Payment\x20expired','includes','errorMessage','error','‚ùå\x20Invalid\x20username\x20format:\x20`','warn','failed','‚úÖ\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','New\x20payout\x20created','isVerified','ipAddress','Payment\x20failed','üîó\x20Endpoint:\x20`','...','shopId','telegramId','txid','42086wAarBw','adminNotes','`\x20not\x20found.\x0a\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','üë§\x20Username:\x20`','username','update','üîî\x20*','\x20\x20\x20Public\x20Key:\x20`','getGatewayDisplayNameForTelegram','substring','__importDefault','sendShopNotification','stopBot'];a49_0x5b4c=function(){return _0x53e232;};return a49_0x5b4c();}