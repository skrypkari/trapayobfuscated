'use strict';const a54_0xe8ad06=a54_0x401b;(function(_0x32e9ae,_0x352c24){const _0x16ff2a=a54_0x401b,_0x19fc24=_0x32e9ae();while(!![]){try{const _0x354c55=-parseInt(_0x16ff2a(0x19c))/0x1*(parseInt(_0x16ff2a(0xe1))/0x2)+parseInt(_0x16ff2a(0xda))/0x3+-parseInt(_0x16ff2a(0x1b0))/0x4+parseInt(_0x16ff2a(0x118))/0x5*(-parseInt(_0x16ff2a(0x15f))/0x6)+-parseInt(_0x16ff2a(0x159))/0x7+-parseInt(_0x16ff2a(0x10d))/0x8*(parseInt(_0x16ff2a(0x105))/0x9)+parseInt(_0x16ff2a(0x128))/0xa*(parseInt(_0x16ff2a(0x117))/0xb);if(_0x354c55===_0x352c24)break;else _0x19fc24['push'](_0x19fc24['shift']());}catch(_0x459b0c){_0x19fc24['push'](_0x19fc24['shift']());}}}(a54_0x1b2d,0xdd5cf));var __importDefault=this&&this[a54_0xe8ad06(0x106)]||function(_0x2c2681){const _0x551334=a54_0xe8ad06;return _0x2c2681&&_0x2c2681[_0x551334(0xfb)]?_0x2c2681:{'default':_0x2c2681};};Object[a54_0xe8ad06(0x172)](exports,a54_0xe8ad06(0xfb),{'value':!![]}),exports[a54_0xe8ad06(0x13a)]=exports[a54_0xe8ad06(0x176)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0xe8ad06(0x14e))),database_1=__importDefault(require('../config/database')),gateway_1=require(a54_0xe8ad06(0x103));function a54_0x401b(_0x4d298d,_0x1c1094){const _0x1b2d9d=a54_0x1b2d();return a54_0x401b=function(_0x401b44,_0x4721c2){_0x401b44=_0x401b44-0xd4;let _0x1f055b=_0x1b2d9d[_0x401b44];return _0x1f055b;},a54_0x401b(_0x4d298d,_0x1c1094);}class TelegramBotService{constructor(){const _0x420df2=a54_0xe8ad06;this['bot']=null,this[_0x420df2(0x11f)]=process[_0x420df2(0x1aa)][_0x420df2(0xe9)]||'',this[_0x420df2(0x195)]=process[_0x420df2(0x1aa)]['TELEGRAM_BOT_USERNAME']||_0x420df2(0x1ae),this['botToken']?this[_0x420df2(0x1a4)]():console[_0x420df2(0xd5)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a54_0xe8ad06(0x1a4)](){const _0x4fc538=a54_0xe8ad06;try{this[_0x4fc538(0x151)]=new node_telegram_bot_api_1[(_0x4fc538(0xdb))](this[_0x4fc538(0x11f)],{'polling':!![]}),this[_0x4fc538(0x1bc)](),console[_0x4fc538(0x1b6)](_0x4fc538(0x193)+this[_0x4fc538(0x195)]+_0x4fc538(0x18f));}catch(_0x1f0f51){console[_0x4fc538(0xe6)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x1f0f51);}}[a54_0xe8ad06(0x1bc)](){const _0x4c45f9=a54_0xe8ad06;if(!this['bot'])return;this['bot'][_0x4c45f9(0x100)](/\/start/,async _0x12ed0d=>{const _0x3950cc=_0x4c45f9,_0x49970a=_0x12ed0d['chat']['id'],_0x3cc736=_0x12ed0d['from']?.['id'][_0x3950cc(0x194)](),_0x2adeb4=_0x12ed0d[_0x3950cc(0x17f)]?.[_0x3950cc(0x182)],_0x3e20f8=_0x12ed0d[_0x3950cc(0x17f)]?.[_0x3950cc(0x14f)],_0x41c305=_0x12ed0d[_0x3950cc(0x17f)]?.[_0x3950cc(0xe8)];if(!_0x3cc736)return;try{let _0x1f208f=await database_1['default'][_0x3950cc(0x119)][_0x3950cc(0x139)]({'where':{'telegramId':_0x3cc736},'include':{'shop':!![]}});!_0x1f208f?(_0x1f208f=await database_1[_0x3950cc(0xdb)][_0x3950cc(0x119)][_0x3950cc(0x10f)]({'data':{'telegramId':_0x3cc736,'username':_0x2adeb4,'firstName':_0x3e20f8,'lastName':_0x41c305,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x3950cc(0x1b6)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x3cc736+'\x20(@'+_0x2adeb4+')')):_0x1f208f=await database_1['default']['telegramUser']['update']({'where':{'telegramId':_0x3cc736},'data':{'username':_0x2adeb4,'firstName':_0x3e20f8,'lastName':_0x41c305},'include':{'shop':!![]}}),_0x1f208f[_0x3950cc(0x177)]&&_0x1f208f[_0x3950cc(0x12b)]&&_0x1f208f[_0x3950cc(0xf4)]?await this[_0x3950cc(0x151)]?.[_0x3950cc(0x13e)](_0x49970a,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x3950cc(0x11b)+_0x1f208f[_0x3950cc(0xf4)][_0x3950cc(0x16e)]+'*\x0a')+(_0x3950cc(0x17c)+_0x1f208f[_0x3950cc(0xf4)]['username']+_0x3950cc(0xf8))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x3950cc(0xea)+_0x3950cc(0x120)+_0x3950cc(0xfd)+_0x3950cc(0x110)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x3950cc(0xd8)}):(_0x1f208f[_0x3950cc(0x12b)]&&!_0x1f208f[_0x3950cc(0x177)]&&(await database_1[_0x3950cc(0xdb)][_0x3950cc(0x119)][_0x3950cc(0x1a9)]({'where':{'telegramId':_0x3cc736},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x3cc736)),await this[_0x3950cc(0x151)]?.['sendMessage'](_0x49970a,_0x3950cc(0x16f)+_0x3950cc(0x12a)+_0x3950cc(0xf5)+_0x3950cc(0x187)+_0x3950cc(0xf1)+_0x3950cc(0x165),{'parse_mode':_0x3950cc(0xd8)}));}catch(_0x204f21){console[_0x3950cc(0xe6)]('Error\x20handling\x20/start\x20command:',_0x204f21),await this['bot']?.[_0x3950cc(0x13e)](_0x49970a,_0x3950cc(0x132));}}),this['bot']['onText'](/\/disconnect/,async _0x63790b=>{const _0x411572=_0x4c45f9,_0x58540c=_0x63790b['chat']['id'],_0x5d4104=_0x63790b[_0x411572(0x17f)]?.['id'][_0x411572(0x194)]();if(!_0x5d4104)return;try{const _0x2d8a47=await database_1[_0x411572(0xdb)][_0x411572(0x119)][_0x411572(0x139)]({'where':{'telegramId':_0x5d4104},'include':{'shop':!![]}});if(!_0x2d8a47||!_0x2d8a47[_0x411572(0x177)]||!_0x2d8a47[_0x411572(0x12b)]){await this[_0x411572(0x151)]?.['sendMessage'](_0x58540c,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x560bb0=_0x2d8a47[_0x411572(0xf4)]?.[_0x411572(0x16e)]||_0x411572(0x134);await database_1[_0x411572(0xdb)][_0x411572(0x119)][_0x411572(0x1a9)]({'where':{'telegramId':_0x5d4104},'data':{'shopId':null,'isVerified':![]}}),console[_0x411572(0x1b6)](_0x411572(0x15d)+_0x5d4104+'\x20disconnected\x20from\x20shop\x20'+_0x2d8a47[_0x411572(0x12b)]),await this[_0x411572(0x151)]?.[_0x411572(0x13e)](_0x58540c,_0x411572(0x175)+_0x560bb0+_0x411572(0x136)+_0x411572(0x1ad),{'parse_mode':_0x411572(0xd8)});}catch(_0xee453f){console['error'](_0x411572(0x12f),_0xee453f),await this[_0x411572(0x151)]?.[_0x411572(0x13e)](_0x58540c,_0x411572(0x132));}}),this['bot'][_0x4c45f9(0x100)](/\/status/,async _0x1288f8=>{const _0x3ac428=_0x4c45f9,_0x4a6cfd=_0x1288f8[_0x3ac428(0x116)]['id'],_0x3dd436=_0x1288f8['from']?.['id'][_0x3ac428(0x194)]();if(!_0x3dd436)return;try{const _0x312f8c=await database_1[_0x3ac428(0xdb)]['telegramUser'][_0x3ac428(0x139)]({'where':{'telegramId':_0x3dd436},'include':{'shop':!![]}});if(!_0x312f8c){await this['bot']?.[_0x3ac428(0x13e)](_0x4a6cfd,_0x3ac428(0x102)+_0x3ac428(0x126));return;}if(!_0x312f8c[_0x3ac428(0x177)]||!_0x312f8c[_0x3ac428(0x12b)]||!_0x312f8c[_0x3ac428(0xf4)]){await this[_0x3ac428(0x151)]?.[_0x3ac428(0x13e)](_0x4a6cfd,_0x3ac428(0x17a)+_0x3ac428(0x112));return;}await this['bot']?.[_0x3ac428(0x13e)](_0x4a6cfd,_0x3ac428(0x130)+(_0x3ac428(0x1a2)+_0x312f8c[_0x3ac428(0xf4)][_0x3ac428(0x16e)]+'*\x0a')+(_0x3ac428(0x184)+_0x312f8c[_0x3ac428(0xf4)][_0x3ac428(0x182)]+'`\x0a')+(_0x3ac428(0x122)+_0x312f8c[_0x3ac428(0x1ac)][_0x3ac428(0x164)]('en-US')+'\x0a\x0a')+_0x3ac428(0x13c)+_0x3ac428(0xfd)+_0x3ac428(0x1be),{'parse_mode':_0x3ac428(0xd8)});}catch(_0x1054ca){console['error'](_0x3ac428(0x1b2),_0x1054ca),await this[_0x3ac428(0x151)]?.['sendMessage'](_0x4a6cfd,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['onText'](/\/debug/,async _0x6a9785=>{const _0x4fae45=_0x4c45f9,_0x11a619=_0x6a9785[_0x4fae45(0x116)]['id'],_0x258c79=_0x6a9785[_0x4fae45(0x17f)]?.['id'][_0x4fae45(0x194)]();if(!_0x258c79)return;try{const _0x21353a=await database_1[_0x4fae45(0xdb)][_0x4fae45(0xf4)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x3f6f99=_0x4fae45(0xd7);_0x3f6f99+=_0x4fae45(0xec)+_0x258c79+'`\x0a\x0a',_0x3f6f99+=_0x4fae45(0x138),_0x21353a[_0x4fae45(0x15a)]((_0x31ed65,_0x1ee31f)=>{const _0x5525f8=_0x4fae45;_0x3f6f99+=_0x1ee31f+0x1+_0x5525f8(0x1b7)+_0x31ed65[_0x5525f8(0x16e)]+'*\x0a',_0x3f6f99+=_0x5525f8(0x142)+_0x31ed65[_0x5525f8(0x182)]+'`\x0a',_0x3f6f99+=_0x5525f8(0x188)+_0x31ed65[_0x5525f8(0x1a7)]+'\x0a',_0x3f6f99+='\x20\x20\x20Public\x20Key:\x20`'+_0x31ed65[_0x5525f8(0x199)]['substring'](0x0,0xf)+_0x5525f8(0x186);}),await this['bot']?.[_0x4fae45(0x13e)](_0x11a619,_0x3f6f99,{'parse_mode':_0x4fae45(0xd8)});}catch(_0x3d7a86){console[_0x4fae45(0xe6)](_0x4fae45(0x10b),_0x3d7a86),await this[_0x4fae45(0x151)]?.[_0x4fae45(0x13e)](_0x11a619,_0x4fae45(0x131));}}),this[_0x4c45f9(0x151)]['on'](_0x4c45f9(0x189),async _0x1f937d=>{const _0x4bf19c=_0x4c45f9;if(_0x1f937d[_0x4bf19c(0x144)]?.[_0x4bf19c(0x10e)]('/'))return;const _0x1d565e=_0x1f937d[_0x4bf19c(0x116)]['id'],_0x3238ad=_0x1f937d[_0x4bf19c(0x17f)]?.['id'][_0x4bf19c(0x194)](),_0x540359=_0x1f937d[_0x4bf19c(0x144)]?.[_0x4bf19c(0x14d)]();if(!_0x3238ad||!_0x540359)return;try{const _0x3e6219=await database_1[_0x4bf19c(0xdb)][_0x4bf19c(0x119)]['findUnique']({'where':{'telegramId':_0x3238ad},'include':{'shop':!![]}});if(!_0x3e6219){await this['bot']?.[_0x4bf19c(0x13e)](_0x1d565e,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x3e6219[_0x4bf19c(0x177)]&&_0x3e6219[_0x4bf19c(0x12b)]&&_0x3e6219[_0x4bf19c(0xf4)]){await this[_0x4bf19c(0x151)]?.[_0x4bf19c(0x13e)](_0x1d565e,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x3e6219['shop']['name']+_0x4bf19c(0x136)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x4bf19c(0xd8)});return;}const _0x21a2db=_0x540359[_0x4bf19c(0x1a0)](/\s+/);if(_0x21a2db[_0x4bf19c(0x14a)]!==0x2){await this[_0x4bf19c(0x151)]?.[_0x4bf19c(0x13e)](_0x1d565e,_0x4bf19c(0x125)+_0x4bf19c(0xf5)+_0x4bf19c(0x187)+_0x4bf19c(0xf1)+(_0x4bf19c(0x19f)+_0x21a2db['length']+_0x4bf19c(0x1b8)+_0x21a2db[_0x4bf19c(0x111)](_0x36db76=>'`'+_0x36db76+'`')[_0x4bf19c(0x166)](',\x20')),{'parse_mode':_0x4bf19c(0xd8)});return;}const [_0x56ba54,_0x7b6b50]=_0x21a2db;console[_0x4bf19c(0x1b6)](_0x4bf19c(0x16d)+_0x3238ad+_0x4bf19c(0xd9)+_0x56ba54+'\x22,\x20apiKey=\x22'+_0x7b6b50['substring'](0x0,0xa)+_0x4bf19c(0x15e)),await this[_0x4bf19c(0x15c)](_0x1d565e,_0x3238ad,_0x56ba54,_0x7b6b50);}catch(_0x70c7e5){console[_0x4bf19c(0xe6)](_0x4bf19c(0xf6),_0x70c7e5),await this[_0x4bf19c(0x151)]?.[_0x4bf19c(0x13e)](_0x1d565e,_0x4bf19c(0x132));}}),this[_0x4c45f9(0x151)]['on'](_0x4c45f9(0xe6),_0x4efdf1=>{const _0x1538fc=_0x4c45f9;console[_0x1538fc(0xe6)](_0x1538fc(0x16a),_0x4efdf1);}),this[_0x4c45f9(0x151)]['on'](_0x4c45f9(0x11c),_0x4bd051=>{const _0x106b02=_0x4c45f9;console[_0x106b02(0xe6)](_0x106b02(0x123),_0x4bd051);});}async[a54_0xe8ad06(0x15c)](_0x446c77,_0x3f2e91,_0x1875ae,_0x6c2b08){const _0x25fd02=a54_0xe8ad06;try{console[_0x25fd02(0x1b6)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x3f2e91+_0x25fd02(0xd9)+_0x1875ae+_0x25fd02(0x153)+_0x6c2b08[_0x25fd02(0x101)](0x0,0xa)+_0x25fd02(0x15e));if(!_0x1875ae||_0x1875ae[_0x25fd02(0x14a)]<0x3||_0x1875ae[_0x25fd02(0x14a)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x25fd02(0x196)](_0x1875ae)){await this[_0x25fd02(0x151)]?.['sendMessage'](_0x446c77,_0x25fd02(0x15b)+_0x1875ae+'`\x0a\x0a'+_0x25fd02(0x1a6),{'parse_mode':'Markdown'});return;}if(!_0x6c2b08||!_0x6c2b08[_0x25fd02(0x10e)](_0x25fd02(0xf7))&&!_0x6c2b08[_0x25fd02(0x10e)]('sk_')){await this[_0x25fd02(0x151)]?.[_0x25fd02(0x13e)](_0x446c77,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x25fd02(0x197),{'parse_mode':'Markdown'});return;}const _0xaf0690=await database_1[_0x25fd02(0xdb)][_0x25fd02(0xf4)][_0x25fd02(0x139)]({'where':{'username':_0x1875ae},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0xaf0690){const _0x3e4c05=await database_1['default'][_0x25fd02(0xf4)][_0x25fd02(0x13b)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x5db6c8=_0x25fd02(0x161)+_0x1875ae+_0x25fd02(0xff);_0x3e4c05['length']>0x0?(_0x5db6c8+=_0x25fd02(0x191),_0x3e4c05[_0x25fd02(0x15a)](_0xa64d43=>{const _0x4317ef=_0x25fd02;_0x5db6c8+='•\x20`'+_0xa64d43[_0x4317ef(0x182)]+_0x4317ef(0xdd)+_0xa64d43['name']+')\x0a';}),_0x5db6c8+=_0x25fd02(0x1b5)):_0x5db6c8+=_0x25fd02(0x19e);await this[_0x25fd02(0x151)]?.[_0x25fd02(0x13e)](_0x446c77,_0x5db6c8,{'parse_mode':_0x25fd02(0xd8)});return;}if(_0xaf0690['status']!=='ACTIVE'){await this[_0x25fd02(0x151)]?.[_0x25fd02(0x13e)](_0x446c77,_0x25fd02(0x158)+_0x1875ae+_0x25fd02(0xe0)+_0x25fd02(0x13f),{'parse_mode':_0x25fd02(0xd8)});return;}if(_0xaf0690['publicKey']!==_0x6c2b08&&_0xaf0690[_0x25fd02(0xfe)]!==_0x6c2b08){await this['bot']?.[_0x25fd02(0x13e)](_0x446c77,_0x25fd02(0x156)+_0x1875ae+_0x25fd02(0x154)+_0x25fd02(0x1a8)+_0x25fd02(0x11e),{'parse_mode':'Markdown'});return;}const _0x1e5751=await database_1['default'][_0x25fd02(0x119)][_0x25fd02(0x174)]({'where':{'shopId':_0xaf0690['id'],'isVerified':!![],'telegramId':{'not':_0x3f2e91}}});if(_0x1e5751){await this[_0x25fd02(0x151)]?.[_0x25fd02(0x13e)](_0x446c77,_0x25fd02(0x18e)+_0x1875ae+_0x25fd02(0x154)+_0x25fd02(0x198),{'parse_mode':_0x25fd02(0xd8)});return;}await database_1[_0x25fd02(0xdb)][_0x25fd02(0x119)][_0x25fd02(0x1a9)]({'where':{'telegramId':_0x3f2e91},'data':{'shopId':_0xaf0690['id'],'isVerified':!![]}}),await this[_0x25fd02(0x151)]?.[_0x25fd02(0x13e)](_0x446c77,_0x25fd02(0x1b9)+_0x25fd02(0x11d)+('📱\x20Shop:\x20*'+_0xaf0690['name']+'*\x0a')+(_0x25fd02(0x184)+_0xaf0690[_0x25fd02(0x182)]+_0x25fd02(0xf8))+_0x25fd02(0xdf)+_0x25fd02(0xee)+_0x25fd02(0xea)+_0x25fd02(0x190)+_0x25fd02(0x170)+_0x25fd02(0xfd)+_0x25fd02(0x110)+_0x25fd02(0x1be),{'parse_mode':_0x25fd02(0xd8)}),console['log'](_0x25fd02(0x17d)+_0x3f2e91+'\x20verified\x20for\x20shop\x20'+_0xaf0690[_0x25fd02(0x182)]+'\x20via\x20single-line\x20input');}catch(_0x2429f6){console[_0x25fd02(0xe6)](_0x25fd02(0x179),_0x2429f6),await this['bot']?.[_0x25fd02(0x13e)](_0x446c77,_0x25fd02(0x1a5));}}async['sendShopNotification'](_0x5b9e37,_0x34c1a,_0x101a22){const _0x1302f7=a54_0xe8ad06;if(!this['bot']){console[_0x1302f7(0xd5)](_0x1302f7(0x16b));return;}try{const _0x4f84ec=await database_1[_0x1302f7(0xdb)][_0x1302f7(0x119)][_0x1302f7(0x13b)]({'where':{'shopId':_0x5b9e37,'isVerified':!![]}});if(_0x4f84ec[_0x1302f7(0x14a)]===0x0){console['log'](_0x1302f7(0x19d)+_0x5b9e37);return;}const _0x1a1bb9=_0x4f84ec[_0x1302f7(0x111)](async _0x41ea35=>{const _0x4cc559=_0x1302f7;try{await this[_0x4cc559(0x151)]?.['sendMessage'](_0x41ea35[_0x4cc559(0x18a)],_0x34c1a,_0x101a22),console[_0x4cc559(0x1b6)](_0x4cc559(0x108)+_0x41ea35['telegramId']);}catch(_0x5a1872){console[_0x4cc559(0xe6)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x41ea35[_0x4cc559(0x18a)]+':',_0x5a1872),_0x5a1872 instanceof Error&&(_0x5a1872['message'][_0x4cc559(0x1ab)](_0x4cc559(0xeb))||_0x5a1872[_0x4cc559(0x189)][_0x4cc559(0x1ab)](_0x4cc559(0xe3))||_0x5a1872['message'][_0x4cc559(0x1ab)]('user\x20is\x20deactivated'))&&(await database_1[_0x4cc559(0xdb)][_0x4cc559(0x119)][_0x4cc559(0x1a9)]({'where':{'id':_0x41ea35['id']},'data':{'isVerified':![]}}),console[_0x4cc559(0x1b6)](_0x4cc559(0x1a1)+_0x41ea35[_0x4cc559(0x18a)]+_0x4cc559(0xef)));}});await Promise['allSettled'](_0x1a1bb9);}catch(_0x532949){console[_0x1302f7(0xe6)](_0x1302f7(0x149),_0x532949);}}async[a54_0xe8ad06(0x12c)](_0x371012,_0xe65171,_0x5c1624){const _0x5aea04=a54_0xe8ad06,_0xbda975={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x405203={'created':'New\x20payment\x20created','paid':_0x5aea04(0x18b),'failed':_0x5aea04(0xd6),'expired':_0x5aea04(0x113),'refund':_0x5aea04(0x1ba),'chargeback':_0x5aea04(0x10c),'processing':_0x5aea04(0x1bb)},_0x444119=_0xbda975[_0x5c1624],_0x45edb7=_0x405203[_0x5c1624],_0x9c0b51=(0x0,gateway_1[_0x5aea04(0xf2)])(_0xe65171[_0x5aea04(0x192)]);console[_0x5aea04(0x1b6)](_0x5aea04(0x109)+_0xe65171[_0x5aea04(0x192)]+_0x5aea04(0xe7)+_0x9c0b51+'\x22');let _0x35d697=_0x444119+'\x20*'+_0x45edb7+_0x5aea04(0x1b1)+('💰\x20Amount:\x20*'+_0xe65171[_0x5aea04(0xde)]+'\x20'+_0xe65171[_0x5aea04(0x133)]+'*\x0a')+(_0x5aea04(0x13d)+(_0xe65171[_0x5aea04(0xe2)]||_0xe65171['id'])+'`\x0a')+(_0x5aea04(0x140)+_0xe65171['id']+'`\x0a')+(_0x5aea04(0x12d)+_0x9c0b51+'`\x0a')+(_0x5aea04(0x169)+new Date(_0xe65171[_0x5aea04(0x160)])[_0x5aea04(0x14c)](_0x5aea04(0x150))+'\x0a');if(_0xe65171[_0x5aea04(0x147)]||_0xe65171['customerEmail']||_0xe65171[_0x5aea04(0x14b)]||_0xe65171[_0x5aea04(0xe5)]||_0xe65171[_0x5aea04(0x19b)]){_0x35d697+=_0x5aea04(0x141);_0xe65171[_0x5aea04(0x147)]&&(_0x35d697+=_0x5aea04(0x1b4)+_0xe65171[_0x5aea04(0x147)]+'`\x0a');_0xe65171[_0x5aea04(0x180)]&&(_0x35d697+=_0x5aea04(0x1b3)+_0xe65171[_0x5aea04(0x180)]+'`\x0a');_0xe65171['remitterIban']&&(_0x35d697+=_0x5aea04(0x145)+_0xe65171[_0x5aea04(0x14b)]+'`\x0a');_0xe65171[_0x5aea04(0xe5)]&&(_0x35d697+=_0x5aea04(0xfc)+_0xe65171[_0x5aea04(0xe5)]+'`\x0a');if(_0xe65171[_0x5aea04(0x19b)]){const _0x170845=_0xe65171[_0x5aea04(0x19b)]['length']>0x32?_0xe65171[_0x5aea04(0x19b)][_0x5aea04(0x101)](0x0,0x32)+_0x5aea04(0xed):_0xe65171[_0x5aea04(0x19b)];_0x35d697+='💻\x20Browser:\x20`'+_0x170845+'`\x0a';}}_0x5c1624===_0x5aea04(0x181)&&_0xe65171[_0x5aea04(0x1af)]&&(_0x35d697+=_0x5aea04(0xd4)+_0xe65171['chargebackAmount']+'\x20USDT*\x0a'),_0x5c1624===_0x5aea04(0x18d)&&(_0x35d697+=_0x5aea04(0xf0)),_0xe65171[_0x5aea04(0x12e)]&&(_0x35d697+='📝\x20Notes:\x20'+_0xe65171['adminNotes']+'\x0a'),await this[_0x5aea04(0x167)](_0x371012,_0x35d697,{'parse_mode':_0x5aea04(0xd8)});}async[a54_0xe8ad06(0x107)](_0x1ba48c,_0x54d8b9,_0x28bb6d){const _0x193e77=a54_0xe8ad06,_0x104907={'created':'📤','completed':'✅','rejected':'❌'},_0x32f583={'created':_0x193e77(0x157),'completed':_0x193e77(0x16c),'rejected':_0x193e77(0x173)},_0x901b6c=_0x104907[_0x28bb6d],_0x13ff46=_0x32f583[_0x28bb6d],_0x4b2826=_0x901b6c+'\x20*'+_0x13ff46+_0x193e77(0x1b1)+(_0x193e77(0xf3)+_0x54d8b9['amount']+'\x20USD*\x0a')+(_0x193e77(0x185)+_0x54d8b9[_0x193e77(0x121)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x54d8b9['id']+'`\x0a')+(_0x193e77(0x169)+new Date(_0x54d8b9[_0x193e77(0x160)])[_0x193e77(0x14c)]('en-US')+'\x0a')+(_0x54d8b9['txid']?'🔗\x20TXID:\x20`'+_0x54d8b9[_0x193e77(0x17e)]+'`':'');await this[_0x193e77(0x167)](_0x1ba48c,_0x4b2826,{'parse_mode':_0x193e77(0xd8)});}async['sendLoginNotification'](_0xb91b7c,_0x13944b){const _0x3f0d43=a54_0xe8ad06;try{const _0x2e995d=await database_1[_0x3f0d43(0xdb)]['shopSettings']['findUnique']({'where':{'shopId':_0xb91b7c},'select':{'notificationLogin':!![]}});if(!_0x2e995d?.[_0x3f0d43(0x137)]){console[_0x3f0d43(0x1b6)](_0x3f0d43(0x155)+_0xb91b7c);return;}const _0x113162=_0x13944b[_0x3f0d43(0x183)]?'🔐':'🚨',_0x396a24=_0x13944b[_0x3f0d43(0x183)]?_0x3f0d43(0x171):_0x3f0d43(0xfa);let _0x32e093=_0x113162+'\x20*'+_0x396a24+_0x3f0d43(0x1b1)+(_0x3f0d43(0x184)+_0x13944b[_0x3f0d43(0x182)]+'`\x0a')+(_0x3f0d43(0xe4)+_0x13944b[_0x3f0d43(0x1bd)]['toLocaleString'](_0x3f0d43(0x150))+'\x0a');_0x13944b[_0x3f0d43(0x11a)]&&(_0x32e093+=_0x3f0d43(0x127)+_0x13944b[_0x3f0d43(0x11a)]+'`\x0a');if(_0x13944b['userAgent']){const _0x1fd89d=_0x13944b[_0x3f0d43(0x18c)][_0x3f0d43(0x14a)]>0x32?_0x13944b[_0x3f0d43(0x18c)][_0x3f0d43(0x101)](0x0,0x32)+_0x3f0d43(0xed):_0x13944b['userAgent'];_0x32e093+='💻\x20Browser:\x20`'+_0x1fd89d+'`\x0a';}!_0x13944b[_0x3f0d43(0x183)]&&(_0x32e093+=_0x3f0d43(0x19a)),await this[_0x3f0d43(0x167)](_0xb91b7c,_0x32e093,{'parse_mode':_0x3f0d43(0xd8)}),console[_0x3f0d43(0x1b6)](_0x3f0d43(0x1a3)+_0xb91b7c+':\x20'+(_0x13944b[_0x3f0d43(0x183)]?'success':'failed'));}catch(_0x276d5d){console[_0x3f0d43(0xe6)]('Failed\x20to\x20send\x20login\x20notification:',_0x276d5d);}}async[a54_0xe8ad06(0x124)](_0x232316,_0x58d5e1){const _0x5ecc4c=a54_0xe8ad06;try{const _0x1525df=await database_1[_0x5ecc4c(0xdb)]['shopSettings'][_0x5ecc4c(0x139)]({'where':{'shopId':_0x232316},'select':{'notificationApiError':!![]}});if(!_0x1525df?.[_0x5ecc4c(0x178)]){console[_0x5ecc4c(0x1b6)](_0x5ecc4c(0x143)+_0x232316);return;}let _0x44e634=_0x5ecc4c(0x129)+(_0x5ecc4c(0x168)+_0x58d5e1[_0x5ecc4c(0x121)]+'\x20'+_0x58d5e1['endpoint']+'`\x0a')+('📅\x20Time:\x20'+_0x58d5e1['timestamp']['toLocaleString'](_0x5ecc4c(0x150))+'\x0a');_0x58d5e1[_0x5ecc4c(0x135)]&&(_0x44e634+=_0x5ecc4c(0x10a)+_0x58d5e1[_0x5ecc4c(0x135)]+'`\x0a'),_0x44e634+=_0x5ecc4c(0x115)+_0x58d5e1[_0x5ecc4c(0x152)]+'`\x0a',_0x58d5e1['requestId']&&(_0x44e634+=_0x5ecc4c(0xf9)+_0x58d5e1[_0x5ecc4c(0xdc)]+'`\x0a'),_0x44e634+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this['sendShopNotification'](_0x232316,_0x44e634,{'parse_mode':_0x5ecc4c(0xd8)}),console['log']('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x232316+':\x20'+_0x58d5e1['endpoint']);}catch(_0x47e6cb){console[_0x5ecc4c(0xe6)](_0x5ecc4c(0x148),_0x47e6cb);}}async[a54_0xe8ad06(0x162)](_0x2456ee,_0x2c6478,_0x468391){const _0x30f43f=a54_0xe8ad06;let _0x1fd1f6=_0x30f43f(0x146)+_0x2c6478+_0x30f43f(0x1b1);for(const [_0x2e01aa,_0x127387]of Object[_0x30f43f(0x104)](_0x468391)){_0x127387!==null&&_0x127387!==undefined&&(_0x1fd1f6+=_0x2e01aa+_0x30f43f(0x114)+_0x127387+'`\x0a');}await this[_0x30f43f(0x167)](_0x2456ee,_0x1fd1f6,{'parse_mode':'Markdown'});}[a54_0xe8ad06(0x163)](){const _0x519364=a54_0xe8ad06;return{'isActive':!!this[_0x519364(0x151)],'username':this[_0x519364(0x195)]};}['stopBot'](){const _0x20d3f2=a54_0xe8ad06;this[_0x20d3f2(0x151)]&&(this[_0x20d3f2(0x151)]['stopPolling'](),this['bot']=null,console['log'](_0x20d3f2(0x17b)));}}function a54_0x1b2d(){const _0x3dfca6=['*\x0a\x0a','Error\x20handling\x20/status\x20command:','📧\x20Email:\x20`','📛\x20Name:\x20`','\x0aCheck\x20spelling\x20and\x20try\x20again.','log','.\x20*','\x20parts:\x20','🎉\x20*Congratulations!*\x0a\x0a','Payment\x20refund','Payment\x20is\x20being\x20processed','setupBotHandlers','timestamp','/disconnect\x20-\x20disconnect\x20from\x20notifications','💸\x20Penalty\x20amount:\x20*','warn','Payment\x20failed','🔍\x20*Debug\x20Information*\x0a\x0a','Markdown',':\x20username=\x22','3571059AZMTEr','default','requestId','`\x20(','amount','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','`\x20is\x20inactive.\x0a\x0a','3210510Lizscb','orderId','chat\x20not\x20found','📅\x20Time:\x20','customerIp','error','\x22\x20->\x20display\x20\x22','last_name','TELEGRAM_BOT_TOKEN','•\x20Payment\x20status\x20changes\x0a','blocked','📱\x20Your\x20Telegram\x20ID:\x20`','...','•\x20New\x20payments\x0a','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','getGatewayDisplayNameForTelegram','💸\x20Amount:\x20*','shop','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Error\x20handling\x20message:','pk_','`\x0a\x0a','🆔\x20Request\x20ID:\x20`','Failed\x20login\x20attempt','__esModule','🌐\x20IP:\x20`','Commands:\x0a','secretKey','`\x20not\x20found.\x0a\x0a','onText','substring','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','../types/gateway','entries','343323WYugXl','__importDefault','sendPayoutNotification','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','📱\x20Telegram\x20notification:\x20gateway\x20\x22','📊\x20Error\x20code:\x20`','Error\x20handling\x20/debug\x20command:','Payment\x20chargeback','360NQbFJS','startsWith','create','/status\x20-\x20check\x20connection\x20status\x0a','map','Use\x20/start\x20to\x20connect.','Payment\x20expired',':\x20`','❌\x20Error:\x20`','chat','4069945wsVkCQ','320EkMKkv','telegramUser','ipAddress','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','polling_error','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','botToken','•\x20Payouts\x0a\x0a','method','📅\x20Connection\x20date:\x20','Telegram\x20bot\x20polling\x20error:','sendApiErrorNotification','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Use\x20/start\x20to\x20begin.','🌐\x20IP\x20address:\x20`','190YiDsne','🚨\x20*API\x20Error*\x0a\x0a','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','shopId','sendPaymentNotification','🏪\x20Gateway:\x20`','adminNotes','Error\x20handling\x20/disconnect\x20command:','📊\x20*Connection\x20Status*\x0a\x0a','❌\x20Error\x20getting\x20debug\x20information.','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','currency','unknown\x20shop','statusCode','*.\x0a\x0a','notificationLogin','🏪\x20Available\x20shops\x20in\x20system:\x0a','findUnique','telegramBotService','findMany','🔔\x20Notifications\x20are\x20active\x0a\x0a','📝\x20Order\x20ID:\x20`','sendMessage','Contact\x20administrator.','🆔\x20Payment\x20ID:\x20`','\x0a👤\x20*Customer\x20Information:*\x0a','\x20\x20\x20Username:\x20`','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','text','🏦\x20IBAN:\x20`','🔔\x20*','customerName','Failed\x20to\x20send\x20API\x20error\x20notification:','Error\x20sending\x20shop\x20notification:','length','remitterIban','toLocaleString','trim','node-telegram-bot-api','first_name','en-US','bot','errorMessage','\x22,\x20apiKey=\x22','`.\x0a\x0a','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','New\x20payout\x20created','❌\x20Shop\x20`','10547572iQeKSg','forEach','❌\x20Invalid\x20username\x20format:\x20`','handleSingleLineVerification','🔌\x20User\x20','...\x22','126750iaQuaS','createdAt','❌\x20Shop\x20with\x20username\x20`','sendCustomNotification','getBotInfo','toLocaleDateString','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','join','sendShopNotification','🔗\x20Endpoint:\x20`','📅\x20Date:\x20','Telegram\x20bot\x20error:','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','Payout\x20completed','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','name','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','•\x20Important\x20events\x0a\x0a','Successful\x20login','defineProperty','Payout\x20rejected','findFirst','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','TelegramBotService','isVerified','notificationApiError','Error\x20in\x20handleSingleLineVerification:','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','🛑\x20Telegram\x20bot\x20stopped','Username:\x20`','✅\x20Telegram\x20user\x20','txid','from','customerEmail','chargeback','username','success','👤\x20Username:\x20`','🏦\x20Method:\x20`','...`\x0a\x0a','Example:\x0a','\x20\x20\x20Status:\x20','message','telegramId','Payment\x20successfully\x20paid','userAgent','processing','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','\x20initialized\x20successfully','•\x20Payouts\x0a','Available\x20usernames:\x0a','gateway','✅\x20Telegram\x20bot\x20@','toString','botUsername','test','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','publicKey','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','customerUa','1iHrsWp','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','Check\x20spelling\x20and\x20try\x20again.','You\x20sent\x20','split','User\x20','✅\x20Connected\x20to\x20shop:\x20*','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','initializeBot','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','status','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','update','env','includes','updatedAt','To\x20reconnect,\x20use\x20the\x20/start\x20command','trapay_bot','chargebackAmount','4531556zMYVFt'];a54_0x1b2d=function(){return _0x3dfca6;};return a54_0x1b2d();}exports[a54_0xe8ad06(0x176)]=TelegramBotService,exports[a54_0xe8ad06(0x13a)]=new TelegramBotService();