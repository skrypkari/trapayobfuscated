'use strict';const a78_0x380fde=a78_0x29bc;(function(_0x5df152,_0x6cebf){const _0x33f7d4=a78_0x29bc,_0x23570c=_0x5df152();while(!![]){try{const _0x2fc785=-parseInt(_0x33f7d4(0x15e))/0x1*(parseInt(_0x33f7d4(0x161))/0x2)+-parseInt(_0x33f7d4(0xc9))/0x3+-parseInt(_0x33f7d4(0x149))/0x4*(parseInt(_0x33f7d4(0x126))/0x5)+parseInt(_0x33f7d4(0xe4))/0x6*(parseInt(_0x33f7d4(0x8f))/0x7)+-parseInt(_0x33f7d4(0xb8))/0x8*(-parseInt(_0x33f7d4(0x12a))/0x9)+-parseInt(_0x33f7d4(0xf0))/0xa+parseInt(_0x33f7d4(0xbd))/0xb;if(_0x2fc785===_0x6cebf)break;else _0x23570c['push'](_0x23570c['shift']());}catch(_0x556427){_0x23570c['push'](_0x23570c['shift']());}}}(a78_0x1804,0x332d3));var __importDefault=this&&this['__importDefault']||function(_0x1a7985){return _0x1a7985&&_0x1a7985['__esModule']?_0x1a7985:{'default':_0x1a7985};};function a78_0x29bc(_0x1f4600,_0x291bf3){_0x1f4600=_0x1f4600-0x89;const _0x1804de=a78_0x1804();let _0x29bcae=_0x1804de[_0x1f4600];return _0x29bcae;}Object[a78_0x380fde(0x183)](exports,a78_0x380fde(0xd7),{'value':!![]}),exports[a78_0x380fde(0x14d)]=exports[a78_0x380fde(0x134)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a78_0x380fde(0xce))),database_1=__importDefault(require(a78_0x380fde(0xfb))),gateway_1=require('../types/gateway');function a78_0x1804(){const _0x9c7468=['Payment\x20expired','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a','botUsername','log','\x20\x20\x20Status:\x20','includes','...','numeric','../config/database','\x20USDT*\x0a','Failed\x20to\x20send\x20login\x20notification:','‚Ä¢\x20Important\x20events\x0a\x0a','first_name','Commands:\x0a','default','üí∞\x20Amount:\x20*','üìß\x20Email:\x20`','errorMessage','Payment\x20failed','image/jpeg','‚ùå\x20Invalid\x20username\x20format:\x20`','\x20users\x20of\x20shop\x20','network','customerIp','TELEGRAM_BOT_TOKEN','üåê\x20IP\x20address:\x20`','üîÑ\x20Processing\x20single-line\x20verification\x20for\x20user\x20','sendDirectMessage','Error\x20in\x20handleSingleLineVerification:','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','\x20verified\x20for\x20shop\x20','secretKey','Payment\x20successfully\x20paid','sendNotificationToAll','/disconnect\x20-\x20disconnect\x20from\x20notifications','‚Ä¢\x20Payouts\x0a','create','üîç\x20*Debug\x20Information*\x0a\x0a','‚è≥\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','üîå\x20User\x20','You\x20sent\x20','endpoint','‚ùå\x20Error\x20sending\x20file\x20to\x20shop:','‚úÖ\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','üí∞\x20*Amount:*\x20','substring','bot','Payment\x20is\x20being\x20processed','Username:\x20`','botToken','üì±\x20Your\x20Telegram\x20ID:\x20`','1730bhAzyG','üìù\x20Order\x20ID:\x20`','sendShopNotification','`\x20not\x20found.\x0a\x0a','198vKaumQ','shopId','‚ùå\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','user\x20is\x20deactivated','sendLoginNotification','‚ùóÔ∏è\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','Not\x20specified','findMany','sendCustomNotification','createdAt','TelegramBotService','‚ùå\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','üíª\x20Browser:\x20`','‚ùå\x20Telegram\x20bot\x20not\x20initialized','join','/status\x20-\x20check\x20connection\x20status\x0a','\x20\x20\x20Username:\x20`','failed','‚ùå\x20Invalid\x20API\x20key\x20format.\x0a\x0a','üéâ\x20*Congratulations!*\x0a\x0a','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','image/png','sendShopFile','stopBot','period','üì±\x20Created\x20new\x20Telegram\x20user:\x20','‚è±Ô∏è\x20*Period:*\x20','chargebackAmount','\x20users','.png','460tWJMIm','findFirst','‚úÖ\x20Login\x20notification\x20sent\x20for\x20shop\x20','stopPolling','telegramBotService','Telegram\x20bot\x20polling\x20error:','startsWith','üì±\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','‚úÖ\x20Welcome\x20back!\x0a\x0a','üåç\x20Country:\x20','username','endsWith','‚úÖ\x20Telegram\x20user\x20','‚ùå\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','üîó\x20*Transaction\x20Link:*\x20Pending','ipAddress','handleSingleLineVerification','User\x20','toLocaleDateString','shop','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','56958sJQQcr','.pdf','last_name','10qpHgeU','ACTIVE','‚ùå\x20Error:\x20`','üîó\x20*Transaction\x20Link:*\x20`','sendDirectFile','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','‚Ä¢\x20New\x20payments\x0a','Error\x20sending\x20shop\x20notification:','Error\x20handling\x20/start\x20command:','sendDocument','initializeBot','length','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','üìä\x20Error\x20code:\x20`','status','chat\x20not\x20found','customerName','updatedAt','Error\x20handling\x20/disconnect\x20command:','entries','`.\x0a\x0a','üí∏\x20Penalty\x20amount:\x20*','üìÖ\x20Time:\x20','chat','üìÖ\x20Date:\x20','üåê\x20IP:\x20`','üí∏\x20*New\x20Payout*\x0a\x0a','üìõ\x20Name:\x20`','method','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','üîî\x20Notifications\x20are\x20active\x0a\x0a','Contact\x20administrator.','gateway','Error\x20handling\x20/debug\x20command:','defineProperty','...\x22','findUnique','toString','isVerified','üì±\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','Markdown','test','‚ùå\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','‚Ä¢\x20Payment\x20status\x20changes\x0a','timestamp','customerUa','956095ZYfzgO','\x0aüë§\x20*Customer\x20Information:*\x0a','`\x0a\x0a','üÜî\x20Request\x20ID:\x20`','üõë\x20Telegram\x20bot\x20stopped','`\x20is\x20inactive.\x0a\x0a','‚úÖ\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','warn','Successful\x20login','*\x0a\x0a','sendApiErrorNotification','statusCode','‚Ä¢\x20Payouts\x0a\x0a','setupBotHandlers','from','telegramId','update','‚úÖ\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','success','‚úÖ\x20Telegram\x20bot\x20@','üì±\x20No\x20active\x20Telegram\x20users\x20found','‚ùå\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','üìù\x20Notes:\x20','adminNotes','üí≥\x20*Wallet:*\x20`','To\x20reconnect,\x20use\x20the\x20/start\x20command','application/octet-stream','‚ùå\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','ü§ñ\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','üÜî\x20Payment\x20ID:\x20`','publicKey','message','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','getBotInfo','userAgent','üë§\x20Username:\x20`','\x20initialized\x20successfully','‚ùå\x20Shop\x20with\x20username\x20`','üîî\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','‚úÖ\x20Connected\x20to\x20shop:\x20*',':\x20`','77160oPTrxW','map','requestId','trim','remitterIban','3192618MnkpUz','polling_error','üè¶\x20IBAN:\x20`','Example:\x0a','Failed\x20login\x20attempt','‚ùå\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','unknown\x20shop','trapay_bot','üîÑ\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','‚ùå\x20Please\x20use\x20/start\x20command\x20first','‚ùå\x20Error\x20sending\x20direct\x20message:','2-digit','73179RyqZNU','env','sendMessage','üîî\x20You\x20receive\x20notifications\x20about:\x0a','\x20(@','node-telegram-bot-api','notificationLogin','\x22,\x20apiKey=\x22','telegramUser','amount','allSettled','üìù\x20Format:\x20`username\x20api_key`\x0a\x0a','‚úÖ\x20File\x20sent\x20to\x20chat\x20',':\x20username=\x22','__esModule','Payment\x20chargeback','onText','‚ùå\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','‚ùå\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','sendPayoutNotification','toLocaleString','üè™\x20Your\x20connected\x20shop:\x0a','Telegram\x20bot\x20error:','split','New\x20payment\x20created','text','.jpg','18OdbhjS','name','customerEmail','‚ùå\x20Error\x20getting\x20debug\x20information.','application/pdf','geo','en-US','\x20disconnected\x20from\x20shop\x20','üîî\x20*','error','.jpeg','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','3535910glTHrU','üì±\x20Notification\x20sent\x20to\x20','Error\x20handling\x20message:'];a78_0x1804=function(){return _0x9c7468;};return a78_0x1804();}class TelegramBotService{constructor(){const _0x4afc53=a78_0x380fde;this[_0x4afc53(0x121)]=null,this[_0x4afc53(0x124)]=process[_0x4afc53(0xca)][_0x4afc53(0x10b)]||'',this[_0x4afc53(0xf5)]=process[_0x4afc53(0xca)]['TELEGRAM_BOT_USERNAME']||_0x4afc53(0xc4),this['botToken']?this[_0x4afc53(0x16b)]():console[_0x4afc53(0x96)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}['initializeBot'](){const _0x28e5c1=a78_0x380fde;try{this[_0x28e5c1(0x121)]=new node_telegram_bot_api_1[(_0x28e5c1(0x101))](this[_0x28e5c1(0x124)],{'polling':!![]}),this[_0x28e5c1(0x9c)](),console[_0x28e5c1(0xf6)](_0x28e5c1(0xa2)+this[_0x28e5c1(0xf5)]+_0x28e5c1(0xb3));}catch(_0x528fbc){console['error'](_0x28e5c1(0xa4),_0x528fbc);}}[a78_0x380fde(0x9c)](){const _0xa68432=a78_0x380fde;if(!this['bot'])return;this[_0xa68432(0x121)][_0xa68432(0xd9)](/\/start/,async _0x181c3a=>{const _0x45b343=_0xa68432,_0x517b4f=_0x181c3a[_0x45b343(0x178)]['id'],_0x5c0eac=_0x181c3a['from']?.['id']['toString'](),_0x4031d4=_0x181c3a[_0x45b343(0x9d)]?.['username'],_0x2e23d0=_0x181c3a[_0x45b343(0x9d)]?.[_0x45b343(0xff)],_0x39e552=_0x181c3a['from']?.[_0x45b343(0x160)];if(!_0x5c0eac)return;try{let _0x142175=await database_1[_0x45b343(0x101)][_0x45b343(0xd1)][_0x45b343(0x185)]({'where':{'telegramId':_0x5c0eac},'include':{'shop':!![]}});!_0x142175?(_0x142175=await database_1[_0x45b343(0x101)][_0x45b343(0xd1)][_0x45b343(0x117)]({'data':{'telegramId':_0x5c0eac,'username':_0x4031d4,'firstName':_0x2e23d0,'lastName':_0x39e552,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x45b343(0xf6)](_0x45b343(0x144)+_0x5c0eac+_0x45b343(0xcd)+_0x4031d4+')')):_0x142175=await database_1['default']['telegramUser']['update']({'where':{'telegramId':_0x5c0eac},'data':{'username':_0x4031d4,'firstName':_0x2e23d0,'lastName':_0x39e552},'include':{'shop':!![]}}),_0x142175[_0x45b343(0x187)]&&_0x142175[_0x45b343(0x12b)]&&_0x142175[_0x45b343(0x15c)]?await this[_0x45b343(0x121)]?.[_0x45b343(0xcb)](_0x517b4f,_0x45b343(0x151)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x142175[_0x45b343(0x15c)][_0x45b343(0xe5)]+'*\x0a')+(_0x45b343(0x123)+_0x142175['shop'][_0x45b343(0x153)]+_0x45b343(0x91))+_0x45b343(0xcc)+_0x45b343(0x167)+_0x45b343(0x8c)+_0x45b343(0x9b)+'Commands:\x0a'+_0x45b343(0x13a)+_0x45b343(0x115),{'parse_mode':_0x45b343(0x89)}):(_0x142175['shopId']&&!_0x142175['isVerified']&&(await database_1['default'][_0x45b343(0xd1)]['update']({'where':{'telegramId':_0x5c0eac},'data':{'shopId':null,'isVerified':![]}}),console[_0x45b343(0xf6)](_0x45b343(0xc5)+_0x5c0eac)),await this['bot']?.[_0x45b343(0xcb)](_0x517b4f,_0x45b343(0xab)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x45b343(0xd4)+_0x45b343(0xc0)+_0x45b343(0x16d)+_0x45b343(0x12f),{'parse_mode':'Markdown'}));}catch(_0x3ab5f9){console[_0x45b343(0xed)](_0x45b343(0x169),_0x3ab5f9),await this[_0x45b343(0x121)]?.[_0x45b343(0xcb)](_0x517b4f,_0x45b343(0x12c));}}),this['bot'][_0xa68432(0xd9)](/\/disconnect/,async _0x15f4e9=>{const _0x31bb4a=_0xa68432,_0x4bd9a3=_0x15f4e9[_0x31bb4a(0x178)]['id'],_0xe92bf2=_0x15f4e9[_0x31bb4a(0x9d)]?.['id']['toString']();if(!_0xe92bf2)return;try{const _0x1a4440=await database_1['default'][_0x31bb4a(0xd1)][_0x31bb4a(0x185)]({'where':{'telegramId':_0xe92bf2},'include':{'shop':!![]}});if(!_0x1a4440||!_0x1a4440['isVerified']||!_0x1a4440[_0x31bb4a(0x12b)]){await this['bot']?.['sendMessage'](_0x4bd9a3,_0x31bb4a(0x15d));return;}const _0x48906f=_0x1a4440[_0x31bb4a(0x15c)]?.[_0x31bb4a(0xe5)]||_0x31bb4a(0xc3);await database_1[_0x31bb4a(0x101)][_0x31bb4a(0xd1)][_0x31bb4a(0x9f)]({'where':{'telegramId':_0xe92bf2},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x31bb4a(0x11a)+_0xe92bf2+_0x31bb4a(0xeb)+_0x1a4440[_0x31bb4a(0x12b)]),await this[_0x31bb4a(0x121)]?.[_0x31bb4a(0xcb)](_0x4bd9a3,_0x31bb4a(0xa0)+_0x48906f+'*.\x0a\x0a'+_0x31bb4a(0xa8),{'parse_mode':_0x31bb4a(0x89)});}catch(_0x5196d8){console[_0x31bb4a(0xed)](_0x31bb4a(0x173),_0x5196d8),await this[_0x31bb4a(0x121)]?.[_0x31bb4a(0xcb)](_0x4bd9a3,_0x31bb4a(0x12c));}}),this[_0xa68432(0x121)]['onText'](/\/status/,async _0x168bd5=>{const _0x4a2809=_0xa68432,_0x31c776=_0x168bd5['chat']['id'],_0x5c762a=_0x168bd5['from']?.['id'][_0x4a2809(0x186)]();if(!_0x5c762a)return;try{const _0x547918=await database_1[_0x4a2809(0x101)][_0x4a2809(0xd1)][_0x4a2809(0x185)]({'where':{'telegramId':_0x5c762a},'include':{'shop':!![]}});if(!_0x547918){await this['bot']?.[_0x4a2809(0xcb)](_0x31c776,_0x4a2809(0xaa)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x547918[_0x4a2809(0x187)]||!_0x547918[_0x4a2809(0x12b)]||!_0x547918[_0x4a2809(0x15c)]){await this['bot']?.[_0x4a2809(0xcb)](_0x31c776,_0x4a2809(0x136)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x4a2809(0x121)]?.[_0x4a2809(0xcb)](_0x31c776,'üìä\x20*Connection\x20Status*\x0a\x0a'+(_0x4a2809(0xb6)+_0x547918[_0x4a2809(0x15c)][_0x4a2809(0xe5)]+'*\x0a')+(_0x4a2809(0xb2)+_0x547918[_0x4a2809(0x15c)]['username']+'`\x0a')+('üìÖ\x20Connection\x20date:\x20'+_0x547918[_0x4a2809(0x172)][_0x4a2809(0x15b)]('en-US')+'\x0a\x0a')+_0x4a2809(0x17f)+_0x4a2809(0x100)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x4a2809(0x89)});}catch(_0x244389){console[_0x4a2809(0xed)]('Error\x20handling\x20/status\x20command:',_0x244389),await this[_0x4a2809(0x121)]?.[_0x4a2809(0xcb)](_0x31c776,_0x4a2809(0x12c));}}),this['bot'][_0xa68432(0xd9)](/\/debug/,async _0x5e6e8e=>{const _0x5cae33=_0xa68432,_0x24d76b=_0x5e6e8e[_0x5cae33(0x178)]['id'],_0x119289=_0x5e6e8e['from']?.['id']['toString']();if(!_0x119289)return;try{const _0x4fde5b=await database_1[_0x5cae33(0x101)][_0x5cae33(0xd1)][_0x5cae33(0x185)]({'where':{'telegramId':_0x119289},'include':{'shop':!![]}});let _0x27f097=_0x5cae33(0x118);_0x27f097+=_0x5cae33(0x125)+_0x119289+'`\x0a\x0a',_0x4fde5b?.['isVerified']&&_0x4fde5b[_0x5cae33(0x15c)]?(_0x27f097+=_0x5cae33(0xde),_0x27f097+='\x20\x20\x20Name:\x20*'+_0x4fde5b[_0x5cae33(0x15c)][_0x5cae33(0xe5)]+'*\x0a',_0x27f097+=_0x5cae33(0x13b)+_0x4fde5b[_0x5cae33(0x15c)][_0x5cae33(0x153)]+'`\x0a',_0x27f097+=_0x5cae33(0xf7)+_0x4fde5b[_0x5cae33(0x15c)][_0x5cae33(0x16f)]+'\x0a\x0a'):_0x27f097+=_0x5cae33(0xf4),_0x27f097+='Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.',await this[_0x5cae33(0x121)]?.[_0x5cae33(0xcb)](_0x24d76b,_0x27f097,{'parse_mode':_0x5cae33(0x89)});}catch(_0x15e7b4){console['error'](_0x5cae33(0x182),_0x15e7b4),await this['bot']?.[_0x5cae33(0xcb)](_0x24d76b,_0x5cae33(0xe7));}}),this[_0xa68432(0x121)]['on'](_0xa68432(0xae),async _0x331769=>{const _0x43e729=_0xa68432;if(_0x331769[_0x43e729(0xe2)]?.[_0x43e729(0x14f)]('/'))return;const _0x4f2daa=_0x331769[_0x43e729(0x178)]['id'],_0x3cf51c=_0x331769[_0x43e729(0x9d)]?.['id'][_0x43e729(0x186)](),_0x53ea99=_0x331769['text']?.[_0x43e729(0xbb)]();if(!_0x3cf51c||!_0x53ea99)return;try{const _0x58f370=await database_1[_0x43e729(0x101)][_0x43e729(0xd1)]['findUnique']({'where':{'telegramId':_0x3cf51c},'include':{'shop':!![]}});if(!_0x58f370){await this[_0x43e729(0x121)]?.['sendMessage'](_0x4f2daa,_0x43e729(0xc6));return;}if(_0x58f370[_0x43e729(0x187)]&&_0x58f370[_0x43e729(0x12b)]&&_0x58f370[_0x43e729(0x15c)]){await this[_0x43e729(0x121)]?.[_0x43e729(0xcb)](_0x4f2daa,'‚úÖ\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x58f370[_0x43e729(0x15c)][_0x43e729(0xe5)]+'*.\x0a\x0a'+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x43e729(0x89)});return;}const _0x4e8bd7=_0x53ea99[_0x43e729(0xe0)](/\s+/);if(_0x4e8bd7[_0x43e729(0x16c)]!==0x2){await this[_0x43e729(0x121)]?.['sendMessage'](_0x4f2daa,_0x43e729(0x8b)+_0x43e729(0xd4)+_0x43e729(0xc0)+_0x43e729(0x16d)+(_0x43e729(0x11b)+_0x4e8bd7['length']+'\x20parts:\x20'+_0x4e8bd7['map'](_0x36f4cd=>'`'+_0x36f4cd+'`')[_0x43e729(0x139)](',\x20')),{'parse_mode':_0x43e729(0x89)});return;}const [_0x1ae200,_0x48b13f]=_0x4e8bd7;console[_0x43e729(0xf6)](_0x43e729(0x10d)+_0x3cf51c+_0x43e729(0xd6)+_0x1ae200+'\x22,\x20apiKey=\x22'+_0x48b13f[_0x43e729(0x120)](0x0,0xa)+_0x43e729(0x184)),await this[_0x43e729(0x159)](_0x4f2daa,_0x3cf51c,_0x1ae200,_0x48b13f);}catch(_0x2486fc){console[_0x43e729(0xed)](_0x43e729(0xf2),_0x2486fc),await this[_0x43e729(0x121)]?.['sendMessage'](_0x4f2daa,_0x43e729(0x12c));}}),this[_0xa68432(0x121)]['on'](_0xa68432(0xed),_0x3ca0e0=>{const _0x34474c=_0xa68432;console['error'](_0x34474c(0xdf),_0x3ca0e0);}),this['bot']['on'](_0xa68432(0xbe),_0x4da427=>{const _0x3cf2d8=_0xa68432;console[_0x3cf2d8(0xed)](_0x3cf2d8(0x14e),_0x4da427);});}async[a78_0x380fde(0x159)](_0x1ce873,_0x3d785e,_0x342883,_0x271246){const _0x3dd67a=a78_0x380fde;try{console[_0x3dd67a(0xf6)](_0x3dd67a(0x10d)+_0x3d785e+_0x3dd67a(0xd6)+_0x342883+_0x3dd67a(0xd0)+_0x271246[_0x3dd67a(0x120)](0x0,0xa)+'...\x22');if(!_0x342883||_0x342883['length']<0x3||_0x342883['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x3dd67a(0x8a)](_0x342883)){await this[_0x3dd67a(0x121)]?.[_0x3dd67a(0xcb)](_0x1ce873,_0x3dd67a(0x107)+_0x342883+_0x3dd67a(0x91)+_0x3dd67a(0xef),{'parse_mode':_0x3dd67a(0x89)});return;}if(!_0x271246||!_0x271246['startsWith']('pk_')&&!_0x271246[_0x3dd67a(0x14f)]('sk_')){await this[_0x3dd67a(0x121)]?.[_0x3dd67a(0xcb)](_0x1ce873,_0x3dd67a(0x13d)+_0x3dd67a(0x13f),{'parse_mode':'Markdown'});return;}const _0x322e19=await database_1[_0x3dd67a(0x101)][_0x3dd67a(0x15c)][_0x3dd67a(0x185)]({'where':{'username':_0x342883},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x322e19){const _0x59958a=_0x3dd67a(0xb4)+_0x342883+_0x3dd67a(0x129)+'Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a'+'Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.';await this[_0x3dd67a(0x121)]?.[_0x3dd67a(0xcb)](_0x1ce873,_0x59958a,{'parse_mode':'Markdown'});return;}if(_0x322e19['status']!==_0x3dd67a(0x162)){await this['bot']?.[_0x3dd67a(0xcb)](_0x1ce873,'‚ùå\x20Shop\x20`'+_0x342883+_0x3dd67a(0x94)+_0x3dd67a(0x180),{'parse_mode':_0x3dd67a(0x89)});return;}if(_0x322e19[_0x3dd67a(0xad)]!==_0x271246&&_0x322e19[_0x3dd67a(0x112)]!==_0x271246){await this[_0x3dd67a(0x121)]?.[_0x3dd67a(0xcb)](_0x1ce873,_0x3dd67a(0xda)+_0x342883+_0x3dd67a(0x175)+_0x3dd67a(0x17e)+_0x3dd67a(0x110),{'parse_mode':_0x3dd67a(0x89)});return;}const _0x107323=await database_1['default'][_0x3dd67a(0xd1)][_0x3dd67a(0x14a)]({'where':{'shopId':_0x322e19['id'],'isVerified':!![],'telegramId':{'not':_0x3d785e}}});if(_0x107323){await this[_0x3dd67a(0x121)]?.['sendMessage'](_0x1ce873,_0x3dd67a(0xdb)+_0x342883+'`.\x0a\x0a'+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x3dd67a(0x89)});return;}await database_1[_0x3dd67a(0x101)][_0x3dd67a(0xd1)][_0x3dd67a(0x9f)]({'where':{'telegramId':_0x3d785e},'data':{'shopId':_0x322e19['id'],'isVerified':!![]}}),await this['bot']?.[_0x3dd67a(0xcb)](_0x1ce873,_0x3dd67a(0x13e)+_0x3dd67a(0x11e)+('üì±\x20Shop:\x20*'+_0x322e19['name']+'*\x0a')+(_0x3dd67a(0xb2)+_0x322e19[_0x3dd67a(0x153)]+'`\x0a\x0a')+_0x3dd67a(0xb5)+_0x3dd67a(0x167)+_0x3dd67a(0x8c)+_0x3dd67a(0x116)+_0x3dd67a(0xfe)+_0x3dd67a(0x100)+_0x3dd67a(0x13a)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}),console['log'](_0x3dd67a(0x155)+_0x3d785e+_0x3dd67a(0x111)+_0x322e19[_0x3dd67a(0x153)]+'\x20via\x20single-line\x20input');}catch(_0x3d5510){console[_0x3dd67a(0xed)](_0x3dd67a(0x10f),_0x3d5510),await this['bot']?.[_0x3dd67a(0xcb)](_0x1ce873,'‚ùå\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a78_0x380fde(0x128)](_0x4225e3,_0x2794aa,_0x569450){const _0x5a7d01=a78_0x380fde;if(!this[_0x5a7d01(0x121)]){console[_0x5a7d01(0x96)](_0x5a7d01(0x166));return;}try{const _0x28b50a=await database_1['default']['telegramUser'][_0x5a7d01(0x131)]({'where':{'shopId':_0x4225e3,'isVerified':!![]}});if(_0x28b50a['length']===0x0){console[_0x5a7d01(0xf6)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x4225e3);return;}const _0x5f5132=_0x28b50a[_0x5a7d01(0xb9)](async _0x4759dc=>{const _0x4266e2=_0x5a7d01;try{await this[_0x4266e2(0x121)]?.[_0x4266e2(0xcb)](_0x4759dc[_0x4266e2(0x9e)],_0x2794aa,_0x569450),console[_0x4266e2(0xf6)](_0x4266e2(0x95)+_0x4759dc[_0x4266e2(0x9e)]);}catch(_0x1cae73){console[_0x4266e2(0xed)](_0x4266e2(0x156)+_0x4759dc['telegramId']+':',_0x1cae73),_0x1cae73 instanceof Error&&(_0x1cae73[_0x4266e2(0xae)][_0x4266e2(0xf8)]('blocked')||_0x1cae73[_0x4266e2(0xae)]['includes'](_0x4266e2(0x170))||_0x1cae73[_0x4266e2(0xae)]['includes'](_0x4266e2(0x12d)))&&(await database_1[_0x4266e2(0x101)][_0x4266e2(0xd1)][_0x4266e2(0x9f)]({'where':{'id':_0x4759dc['id']},'data':{'isVerified':![]}}),console[_0x4266e2(0xf6)](_0x4266e2(0x15a)+_0x4759dc[_0x4266e2(0x9e)]+_0x4266e2(0xaf)));}});await Promise[_0x5a7d01(0xd3)](_0x5f5132);}catch(_0x3107ec){console['error'](_0x5a7d01(0x168),_0x3107ec);}}async['sendPaymentNotification'](_0x280580,_0x12ab6f,_0x33de38){const _0x45f347=a78_0x380fde,_0x16d5a3={'created':'üÜï','paid':'‚úÖ','failed':'‚ùå','expired':'‚è∞','refund':'üîÑ','chargeback':'‚ö†Ô∏è','processing':'‚öôÔ∏è'},_0x14ca1e={'created':_0x45f347(0xe1),'paid':_0x45f347(0x113),'failed':_0x45f347(0x105),'expired':_0x45f347(0xf3),'refund':'Payment\x20refund','chargeback':_0x45f347(0xd8),'processing':_0x45f347(0x122)},_0x5998ce=_0x16d5a3[_0x33de38],_0x454e36=_0x14ca1e[_0x33de38],_0x15a5a6=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x12ab6f[_0x45f347(0x181)]);console[_0x45f347(0xf6)]('üì±\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x12ab6f[_0x45f347(0x181)]+'\x22\x20->\x20display\x20\x22'+_0x15a5a6+'\x22');let _0x56d9b7=_0x5998ce+'\x20*'+_0x454e36+_0x45f347(0x98)+(_0x45f347(0x102)+_0x12ab6f[_0x45f347(0xd2)]+'\x20'+_0x12ab6f['currency']+'*\x0a')+(_0x45f347(0x127)+(_0x12ab6f['orderId']||_0x12ab6f['id'])+'`\x0a')+(_0x45f347(0xac)+_0x12ab6f['id']+'`\x0a')+('üè™\x20Gateway:\x20`'+_0x15a5a6+'`\x0a')+(_0x45f347(0x179)+new Date(_0x12ab6f[_0x45f347(0x133)])['toLocaleString'](_0x45f347(0xea))+'\x0a');if(_0x12ab6f[_0x45f347(0x171)]||_0x12ab6f[_0x45f347(0xe6)]||_0x12ab6f[_0x45f347(0xbc)]||_0x12ab6f['customerIp']||_0x12ab6f[_0x45f347(0x8e)]){_0x56d9b7+=_0x45f347(0x90);_0x12ab6f['customerName']&&(_0x56d9b7+=_0x45f347(0x17c)+_0x12ab6f[_0x45f347(0x171)]+'`\x0a');_0x12ab6f[_0x45f347(0xe6)]&&(_0x56d9b7+=_0x45f347(0x103)+_0x12ab6f[_0x45f347(0xe6)]+'`\x0a');_0x12ab6f['remitterIban']&&(_0x56d9b7+=_0x45f347(0xbf)+_0x12ab6f[_0x45f347(0xbc)]+'`\x0a');_0x12ab6f[_0x45f347(0x10a)]&&(_0x56d9b7+=_0x45f347(0x17a)+_0x12ab6f[_0x45f347(0x10a)]+'`\x0a');if(_0x12ab6f[_0x45f347(0x8e)]){const _0x8d2ae7=_0x12ab6f['customerUa'][_0x45f347(0x16c)]>0x32?_0x12ab6f[_0x45f347(0x8e)][_0x45f347(0x120)](0x0,0x32)+_0x45f347(0xf9):_0x12ab6f[_0x45f347(0x8e)];_0x56d9b7+=_0x45f347(0x137)+_0x8d2ae7+'`\x0a';}}_0x33de38==='chargeback'&&_0x12ab6f['chargebackAmount']&&(_0x56d9b7+=_0x45f347(0x176)+_0x12ab6f[_0x45f347(0x146)]+_0x45f347(0xfc)),_0x33de38==='processing'&&(_0x56d9b7+=_0x45f347(0x119)),_0x12ab6f[_0x45f347(0xa6)]&&(_0x56d9b7+=_0x45f347(0xa5)+_0x12ab6f[_0x45f347(0xa6)]+'\x0a'),await this[_0x45f347(0x128)](_0x280580,_0x56d9b7,{'parse_mode':_0x45f347(0x89)});}async[a78_0x380fde(0xdc)](_0x56b8b8,_0x7bd4c8){const _0x2ae63f=a78_0x380fde,_0x1cf118=new Date(_0x7bd4c8[_0x2ae63f(0x133)])[_0x2ae63f(0xdd)](_0x2ae63f(0xea),{'year':_0x2ae63f(0xfa),'month':'2-digit','day':_0x2ae63f(0xc8),'hour':_0x2ae63f(0xc8),'minute':_0x2ae63f(0xc8),'second':_0x2ae63f(0xc8)}),_0x2faf50=_0x2ae63f(0x17b)+('üìÖ\x20*Payout\x20Date:*\x20'+_0x1cf118+'\x0a')+(_0x2ae63f(0x11f)+_0x7bd4c8['amount']+'\x20USD\x0a')+(_0x2ae63f(0x145)+(_0x7bd4c8[_0x2ae63f(0x143)]||_0x2ae63f(0x130))+'\x0a')+('üåê\x20*Network:*\x20'+(_0x7bd4c8[_0x2ae63f(0x109)]||_0x2ae63f(0x130))+'\x0a')+(_0x2ae63f(0xa7)+(_0x7bd4c8['wallet']||_0x2ae63f(0x130))+'`\x0a')+(_0x7bd4c8['txid']?_0x2ae63f(0x164)+_0x7bd4c8['txid']+'`':_0x2ae63f(0x157));await this['sendShopNotification'](_0x56b8b8,_0x2faf50,{'parse_mode':_0x2ae63f(0x89)});}async[a78_0x380fde(0x12e)](_0x427d51,_0x1a6ad1){const _0xce5aca=a78_0x380fde;try{const _0x593a81=await database_1['default']['shopSettings'][_0xce5aca(0x185)]({'where':{'shopId':_0x427d51},'select':{'notificationLogin':!![]}});if(!_0x593a81?.[_0xce5aca(0xcf)]){console[_0xce5aca(0xf6)]('üì±\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x427d51);return;}const _0x234f27=_0x1a6ad1[_0xce5aca(0xa1)]?'üîê':'üö®',_0x20820d=_0x1a6ad1[_0xce5aca(0xa1)]?_0xce5aca(0x97):_0xce5aca(0xc1);let _0x31bd56=_0x234f27+'\x20*'+_0x20820d+_0xce5aca(0x98)+(_0xce5aca(0xb2)+_0x1a6ad1[_0xce5aca(0x153)]+'`\x0a')+(_0xce5aca(0x177)+_0x1a6ad1[_0xce5aca(0x8d)]['toLocaleString']('en-US')+'\x0a');_0x1a6ad1['ipAddress']&&(_0x31bd56+=_0xce5aca(0x10c)+_0x1a6ad1[_0xce5aca(0x158)]+'`\x0a');_0x1a6ad1[_0xce5aca(0xe9)]&&(_0x31bd56+=_0xce5aca(0x152)+_0x1a6ad1[_0xce5aca(0xe9)]+'\x0a');if(_0x1a6ad1[_0xce5aca(0xb1)]){const _0x37b863=_0x1a6ad1[_0xce5aca(0xb1)][_0xce5aca(0x16c)]>0x32?_0x1a6ad1[_0xce5aca(0xb1)][_0xce5aca(0x120)](0x0,0x32)+_0xce5aca(0xf9):_0x1a6ad1[_0xce5aca(0xb1)];_0x31bd56+=_0xce5aca(0x137)+_0x37b863+'`\x0a';}!_0x1a6ad1['success']&&(_0x31bd56+='\x0a‚ö†Ô∏è\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0xce5aca(0x128)](_0x427d51,_0x31bd56,{'parse_mode':'Markdown'}),console[_0xce5aca(0xf6)](_0xce5aca(0x14b)+_0x427d51+':\x20'+(_0x1a6ad1[_0xce5aca(0xa1)]?_0xce5aca(0xa1):_0xce5aca(0x13c)));}catch(_0x218949){console[_0xce5aca(0xed)](_0xce5aca(0xfd),_0x218949);}}async[a78_0x380fde(0x99)](_0xd623ec,_0x7a00ed){const _0x5a3c3c=a78_0x380fde;try{const _0x52a1a4=await database_1[_0x5a3c3c(0x101)]['shopSettings'][_0x5a3c3c(0x185)]({'where':{'shopId':_0xd623ec},'select':{'notificationApiError':!![]}});if(!_0x52a1a4?.['notificationApiError']){console[_0x5a3c3c(0xf6)](_0x5a3c3c(0x150)+_0xd623ec);return;}let _0x89cd56='üö®\x20*API\x20Error*\x0a\x0a'+('üîó\x20Endpoint:\x20`'+_0x7a00ed[_0x5a3c3c(0x17d)]+'\x20'+_0x7a00ed[_0x5a3c3c(0x11c)]+'`\x0a')+(_0x5a3c3c(0x177)+_0x7a00ed[_0x5a3c3c(0x8d)][_0x5a3c3c(0xdd)]('en-US')+'\x0a');_0x7a00ed['statusCode']&&(_0x89cd56+=_0x5a3c3c(0x16e)+_0x7a00ed[_0x5a3c3c(0x9a)]+'`\x0a'),_0x89cd56+=_0x5a3c3c(0x163)+_0x7a00ed[_0x5a3c3c(0x104)]+'`\x0a',_0x7a00ed[_0x5a3c3c(0xba)]&&(_0x89cd56+=_0x5a3c3c(0x92)+_0x7a00ed['requestId']+'`\x0a'),_0x89cd56+='\x0aüí°\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x5a3c3c(0x128)](_0xd623ec,_0x89cd56,{'parse_mode':'Markdown'}),console[_0x5a3c3c(0xf6)]('‚úÖ\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0xd623ec+':\x20'+_0x7a00ed[_0x5a3c3c(0x11c)]);}catch(_0x545050){console[_0x5a3c3c(0xed)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x545050);}}async[a78_0x380fde(0x132)](_0x5e7430,_0x452359,_0x52f288){const _0x287199=a78_0x380fde;let _0x6fbfe5=_0x287199(0xec)+_0x452359+_0x287199(0x98);for(const [_0x4a195f,_0x5e6b06]of Object[_0x287199(0x174)](_0x52f288)){_0x5e6b06!==null&&_0x5e6b06!==undefined&&(_0x6fbfe5+=_0x4a195f+_0x287199(0xb7)+_0x5e6b06+'`\x0a');}await this[_0x287199(0x128)](_0x5e7430,_0x6fbfe5,{'parse_mode':_0x287199(0x89)});}async[a78_0x380fde(0x114)](_0x13b97c){const _0x1f7217=a78_0x380fde;try{console[_0x1f7217(0xf6)](_0x1f7217(0x188)+_0x13b97c[_0x1f7217(0x120)](0x0,0x32)+'...');const _0x9b6a6e=await database_1[_0x1f7217(0x101)][_0x1f7217(0xd1)][_0x1f7217(0x131)]({'select':{'telegramId':!![]}});if(_0x9b6a6e[_0x1f7217(0x16c)]===0x0){console['log'](_0x1f7217(0xa3));return;}for(const _0x3c1c98 of _0x9b6a6e){try{await this[_0x1f7217(0x121)]?.[_0x1f7217(0xcb)](_0x3c1c98[_0x1f7217(0x9e)],_0x13b97c,{'parse_mode':_0x1f7217(0x89)});}catch(_0x47e99c){console[_0x1f7217(0xed)](_0x1f7217(0x135)+_0x3c1c98['telegramId']+':',_0x47e99c);}}console[_0x1f7217(0xf6)](_0x1f7217(0xf1)+_0x9b6a6e[_0x1f7217(0x16c)]+_0x1f7217(0x147));}catch(_0x5bf854){console[_0x1f7217(0xed)]('‚ùå\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:',_0x5bf854);}}[a78_0x380fde(0xb0)](){const _0x59cac7=a78_0x380fde;return{'isActive':!!this[_0x59cac7(0x121)],'username':this[_0x59cac7(0xf5)]};}async[a78_0x380fde(0x141)](_0xd1f64b,_0x3016e2,_0x36192d,_0x121066){const _0x16d833=a78_0x380fde;try{if(!this[_0x16d833(0x121)])return console[_0x16d833(0xed)](_0x16d833(0x138)),![];const _0x28a82d=await database_1[_0x16d833(0x101)][_0x16d833(0xd1)][_0x16d833(0x131)]({'where':{'shopId':_0xd1f64b,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x28a82d[_0x16d833(0x16c)]===0x0)return console[_0x16d833(0xed)](_0x16d833(0xc2)+_0xd1f64b),![];let _0x58fee7=0x0;for(const _0x3cf53f of _0x28a82d){try{await this[_0x16d833(0x121)][_0x16d833(0x16a)](_0x3cf53f[_0x16d833(0x9e)],_0x3016e2,{},{'filename':_0x36192d,'contentType':_0x36192d['endsWith'](_0x16d833(0x148))?_0x16d833(0x140):_0x36192d[_0x16d833(0x154)](_0x16d833(0xe3))||_0x36192d[_0x16d833(0x154)](_0x16d833(0xee))?'image/jpeg':_0x36192d['endsWith'](_0x16d833(0x15f))?_0x16d833(0xe8):_0x16d833(0xa9)}),_0x121066&&await this['bot']['sendMessage'](_0x3cf53f[_0x16d833(0x9e)],_0x121066),_0x58fee7++;}catch(_0xb4a88b){console['error']('‚ùå\x20Error\x20sending\x20file\x20to\x20user\x20'+_0x3cf53f[_0x16d833(0x9e)]+':',_0xb4a88b);}}return console['log']('‚úÖ\x20File\x20sent\x20to\x20'+_0x58fee7+'/'+_0x28a82d[_0x16d833(0x16c)]+_0x16d833(0x108)+_0xd1f64b+':\x20'+_0x36192d),_0x58fee7>0x0;}catch(_0x397588){return console[_0x16d833(0xed)](_0x16d833(0x11d),_0x397588),![];}}async[a78_0x380fde(0x10e)](_0x2d9162,_0x164b70){const _0x343706=a78_0x380fde;try{if(!this[_0x343706(0x121)])return console['error'](_0x343706(0x138)),![];return await this[_0x343706(0x121)][_0x343706(0xcb)](_0x2d9162,_0x164b70),console['log']('‚úÖ\x20Direct\x20message\x20sent\x20to\x20chat\x20'+_0x2d9162),!![];}catch(_0x367871){return console['error'](_0x343706(0xc7),_0x367871),![];}}async[a78_0x380fde(0x165)](_0x409a3a,_0x57433f,_0x473bbb,_0x22271e){const _0x2bd593=a78_0x380fde;try{if(!this[_0x2bd593(0x121)])return console[_0x2bd593(0xed)](_0x2bd593(0x138)),![];return await this[_0x2bd593(0x121)][_0x2bd593(0x16a)](_0x409a3a,_0x57433f,{},{'filename':_0x473bbb,'contentType':_0x473bbb['endsWith']('.png')?_0x2bd593(0x140):_0x473bbb[_0x2bd593(0x154)](_0x2bd593(0xe3))||_0x473bbb[_0x2bd593(0x154)](_0x2bd593(0xee))?_0x2bd593(0x106):_0x473bbb[_0x2bd593(0x154)](_0x2bd593(0x15f))?_0x2bd593(0xe8):'application/octet-stream'}),_0x22271e&&await this[_0x2bd593(0x121)][_0x2bd593(0xcb)](_0x409a3a,_0x22271e),console['log'](_0x2bd593(0xd5)+_0x409a3a+':\x20'+_0x473bbb),!![];}catch(_0x58cf73){return console[_0x2bd593(0xed)]('‚ùå\x20Error\x20sending\x20file\x20to\x20chat:',_0x58cf73),![];}}[a78_0x380fde(0x142)](){const _0x2c9b61=a78_0x380fde;this[_0x2c9b61(0x121)]&&(this['bot'][_0x2c9b61(0x14c)](),this['bot']=null,console[_0x2c9b61(0xf6)](_0x2c9b61(0x93)));}}exports[a78_0x380fde(0x134)]=TelegramBotService,exports[a78_0x380fde(0x14d)]=new TelegramBotService();