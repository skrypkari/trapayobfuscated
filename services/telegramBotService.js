'use strict';const a54_0x380986=a54_0x1781;(function(_0x16ae6b,_0x581559){const _0x165110=a54_0x1781,_0xb3a9ee=_0x16ae6b();while(!![]){try{const _0x577c25=parseInt(_0x165110(0x101))/0x1+parseInt(_0x165110(0x1af))/0x2+parseInt(_0x165110(0x195))/0x3*(parseInt(_0x165110(0x10d))/0x4)+-parseInt(_0x165110(0x175))/0x5*(parseInt(_0x165110(0x10c))/0x6)+parseInt(_0x165110(0x134))/0x7*(parseInt(_0x165110(0x178))/0x8)+parseInt(_0x165110(0x186))/0x9+-parseInt(_0x165110(0x18f))/0xa*(parseInt(_0x165110(0x14e))/0xb);if(_0x577c25===_0x581559)break;else _0xb3a9ee['push'](_0xb3a9ee['shift']());}catch(_0x31a9e5){_0xb3a9ee['push'](_0xb3a9ee['shift']());}}}(a54_0x773e,0xa6a07));function a54_0x1781(_0x55db97,_0x258f5f){const _0x773ec7=a54_0x773e();return a54_0x1781=function(_0x1781cd,_0x31a121){_0x1781cd=_0x1781cd-0xd2;let _0x277550=_0x773ec7[_0x1781cd];return _0x277550;},a54_0x1781(_0x55db97,_0x258f5f);}function a54_0x773e(){const _0x9b4ce2=['252812srRaaC','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','blocked','Payment\x20failed','initializeBot','*.\x0a\x0a','text','default','create','🛑\x20Telegram\x20bot\x20stopped','\x20parts:\x20','chat\x20not\x20found','__importDefault','sk_','Successful\x20login','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','🔔\x20*','`.\x0a\x0a','trapay_bot','toString','defineProperty','endpoint','botUsername','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','Username:\x20`','currency','Use\x20/start\x20to\x20connect.','🏦\x20Method:\x20`','\x20via\x20single-line\x20input','pk_','test','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','chat','ACTIVE','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','onText','Error\x20in\x20handleSingleLineVerification:','handleSingleLineVerification','🚨\x20*API\x20Error*\x0a\x0a','21833xVvGQu','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','customerEmail','TELEGRAM_BOT_TOKEN','requestId','findFirst','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','timestamp','error','📝\x20Order\x20ID:\x20`','getGatewayDisplayNameForTelegram','Error\x20handling\x20/start\x20command:','user\x20is\x20deactivated','📅\x20Date:\x20','Payout\x20completed','username','User\x20','toLocaleString','amount','startsWith','failed','💻\x20Browser:\x20`','/status\x20-\x20check\x20connection\x20status\x0a','sendMessage','Failed\x20to\x20send\x20API\x20error\x20notification:','📛\x20Name:\x20`','1053184NirBEK','sendLoginNotification','Contact\x20administrator.','/disconnect\x20-\x20disconnect\x20from\x20notifications','polling_error','`\x0a\x0a','You\x20sent\x20','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','isVerified','🔔\x20Notifications\x20are\x20active\x0a\x0a','toLocaleDateString','Error\x20handling\x20/debug\x20command:','Payment\x20successfully\x20paid','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','Commands:\x0a','getBotInfo','📧\x20Email:\x20`','telegramBotService','stopPolling','•\x20Payment\x20status\x20changes\x0a','statusCode','forEach','Payment\x20is\x20being\x20processed','\x22,\x20apiKey=\x22','notificationLogin','success','🆔\x20Payment\x20ID:\x20`','update','...`\x0a\x0a','\x22\x20->\x20display\x20\x22','You\x20are\x20already\x20connected\x20to\x20shop:\x20*',':\x20username=\x22','❌\x20Error:\x20`','Example:\x0a','warn','\x0a👤\x20*Customer\x20Information:*\x0a','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','env','`\x20not\x20found.\x0a\x0a','36705LtsJHs','Payout\x20rejected','`\x20is\x20inactive.\x0a\x0a','640zBZXbn','ipAddress','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','last_name','Telegram\x20bot\x20polling\x20error:','\x20(@','👤\x20Username:\x20`','unknown\x20shop','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','txid','processing','../config/database','name','findUnique','3022929fSamqv','shopSettings','setupBotHandlers','createdAt','adminNotes','secretKey','...\x22','•\x20Payouts\x0a\x0a','includes','220YnSkQu','📅\x20Time:\x20','🎉\x20*Congratulations!*\x0a\x0a','method','publicKey','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','57ArDPdz','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','🏪\x20Available\x20shops\x20in\x20system:\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','telegramUser','en-US','TELEGRAM_BOT_USERNAME','❌\x20Shop\x20with\x20username\x20`','first_name','Failed\x20to\x20send\x20login\x20notification:','Error\x20handling\x20/disconnect\x20command:','✅\x20Telegram\x20bot\x20@','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','customerName','sendCustomNotification','entries','sendPaymentNotification','❌\x20Error\x20getting\x20debug\x20information.','.\x20*','sendPayoutNotification','substring','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','📝\x20Notes:\x20','Markdown','701322gSapMJ','chargebackAmount','status','•\x20New\x20payments\x0a','Error\x20sending\x20shop\x20notification:','...','Payment\x20chargeback','message','New\x20payout\x20created','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','from','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','log','🌐\x20IP\x20address:\x20`','\x20initialized\x20successfully','❌\x20Shop\x20`','\x20USDT*\x0a','Use\x20/start\x20to\x20begin.','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','updatedAt','trim','allSettled',':\x20`','✅\x20Connected\x20to\x20shop:\x20*','notificationApiError','Telegram\x20bot\x20error:','\x20disconnected\x20from\x20shop\x20','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','*\x0a\x0a','Available\x20usernames:\x0a','📅\x20Connection\x20date:\x20','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','Failed\x20login\x20attempt','length','orderId','shopId','sendShopNotification','\x20USD*\x0a','telegramId','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','Check\x20spelling\x20and\x20try\x20again.','userAgent','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','\x20\x20\x20Public\x20Key:\x20`','botToken','shop','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','bot','828136QWApPu','\x20verified\x20for\x20shop\x20','New\x20payment\x20created','•\x20Payouts\x0a','🔗\x20Endpoint:\x20`','findMany','•\x20Important\x20events\x0a\x0a','gateway','💸\x20Penalty\x20amount:\x20*','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','144jTJlhv'];a54_0x773e=function(){return _0x9b4ce2;};return a54_0x773e();}var __importDefault=this&&this[a54_0x380986(0x119)]||function(_0x1e5f93){return _0x1e5f93&&_0x1e5f93['__esModule']?_0x1e5f93:{'default':_0x1e5f93};};Object[a54_0x380986(0x121)](exports,'__esModule',{'value':!![]}),exports[a54_0x380986(0x15f)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a54_0x380986(0x183))),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x24406d=a54_0x380986;this['bot']=null,this['botToken']=process[_0x24406d(0x173)][_0x24406d(0x137)]||'',this[_0x24406d(0x123)]=process[_0x24406d(0x173)][_0x24406d(0x19d)]||_0x24406d(0x11f),this['botToken']?this[_0x24406d(0x111)]():console[_0x24406d(0x170)](_0x24406d(0x199));}[a54_0x380986(0x111)](){const _0x37f0b9=a54_0x380986;try{this[_0x37f0b9(0x100)]=new node_telegram_bot_api_1[(_0x37f0b9(0x114))](this[_0x37f0b9(0xfd)],{'polling':!![]}),this[_0x37f0b9(0x188)](),console[_0x37f0b9(0xda)](_0x37f0b9(0x1a2)+this[_0x37f0b9(0x123)]+_0x37f0b9(0xdc));}catch(_0x2c1e6b){console[_0x37f0b9(0x13c)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x2c1e6b);}}['setupBotHandlers'](){const _0x2e7f7a=a54_0x380986;if(!this['bot'])return;this['bot'][_0x2e7f7a(0x130)](/\/start/,async _0x452a03=>{const _0x5a2153=_0x2e7f7a,_0x537f6f=_0x452a03[_0x5a2153(0x12d)]['id'],_0x286744=_0x452a03['from']?.['id'][_0x5a2153(0x120)](),_0x21d26e=_0x452a03['from']?.[_0x5a2153(0x143)],_0x32bcff=_0x452a03[_0x5a2153(0xd8)]?.[_0x5a2153(0x19f)],_0x5ae30a=_0x452a03[_0x5a2153(0xd8)]?.[_0x5a2153(0x17b)];if(!_0x286744)return;try{let _0x4e4c06=await database_1[_0x5a2153(0x114)][_0x5a2153(0x19b)][_0x5a2153(0x185)]({'where':{'telegramId':_0x286744},'include':{'shop':!![]}});!_0x4e4c06?(_0x4e4c06=await database_1[_0x5a2153(0x114)][_0x5a2153(0x19b)][_0x5a2153(0x115)]({'data':{'telegramId':_0x286744,'username':_0x21d26e,'firstName':_0x32bcff,'lastName':_0x5ae30a,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x5a2153(0xda)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x286744+_0x5a2153(0x17d)+_0x21d26e+')')):_0x4e4c06=await database_1[_0x5a2153(0x114)][_0x5a2153(0x19b)][_0x5a2153(0x169)]({'where':{'telegramId':_0x286744},'data':{'username':_0x21d26e,'firstName':_0x32bcff,'lastName':_0x5ae30a},'include':{'shop':!![]}}),_0x4e4c06['isVerified']&&_0x4e4c06[_0x5a2153(0xf1)]&&_0x4e4c06[_0x5a2153(0xfe)]?await this[_0x5a2153(0x100)]?.[_0x5a2153(0x14b)](_0x537f6f,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x5a2153(0x16c)+_0x4e4c06[_0x5a2153(0xfe)][_0x5a2153(0x184)]+'*\x0a')+(_0x5a2153(0x125)+_0x4e4c06[_0x5a2153(0xfe)][_0x5a2153(0x143)]+_0x5a2153(0x153))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x5a2153(0x1b2)+_0x5a2153(0x161)+_0x5a2153(0x18d)+_0x5a2153(0x15c)+_0x5a2153(0x14a)+_0x5a2153(0x151),{'parse_mode':_0x5a2153(0x1ae)}):(_0x4e4c06[_0x5a2153(0xf1)]&&!_0x4e4c06[_0x5a2153(0x156)]&&(await database_1[_0x5a2153(0x114)][_0x5a2153(0x19b)]['update']({'where':{'telegramId':_0x286744},'data':{'shopId':null,'isVerified':![]}}),console[_0x5a2153(0xda)](_0x5a2153(0x1a3)+_0x286744)),await this[_0x5a2153(0x100)]?.[_0x5a2153(0x14b)](_0x537f6f,_0x5a2153(0x180)+_0x5a2153(0xf5)+_0x5a2153(0x19a)+_0x5a2153(0x16f)+_0x5a2153(0x10a)+_0x5a2153(0x11c),{'parse_mode':_0x5a2153(0x1ae)}));}catch(_0x38266f){console[_0x5a2153(0x13c)](_0x5a2153(0x13f),_0x38266f),await this[_0x5a2153(0x100)]?.['sendMessage'](_0x537f6f,_0x5a2153(0x196));}}),this[_0x2e7f7a(0x100)]['onText'](/\/disconnect/,async _0x7ebddf=>{const _0x1fe0e2=_0x2e7f7a,_0x1f0c55=_0x7ebddf[_0x1fe0e2(0x12d)]['id'],_0x24c2d8=_0x7ebddf[_0x1fe0e2(0xd8)]?.['id'][_0x1fe0e2(0x120)]();if(!_0x24c2d8)return;try{const _0x1d51c4=await database_1[_0x1fe0e2(0x114)][_0x1fe0e2(0x19b)][_0x1fe0e2(0x185)]({'where':{'telegramId':_0x24c2d8},'include':{'shop':!![]}});if(!_0x1d51c4||!_0x1d51c4[_0x1fe0e2(0x156)]||!_0x1d51c4[_0x1fe0e2(0xf1)]){await this[_0x1fe0e2(0x100)]?.[_0x1fe0e2(0x14b)](_0x1f0c55,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x491976=_0x1d51c4['shop']?.[_0x1fe0e2(0x184)]||_0x1fe0e2(0x17f);await database_1[_0x1fe0e2(0x114)][_0x1fe0e2(0x19b)][_0x1fe0e2(0x169)]({'where':{'telegramId':_0x24c2d8},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔌\x20User\x20'+_0x24c2d8+_0x1fe0e2(0xe8)+_0x1d51c4[_0x1fe0e2(0xf1)]),await this[_0x1fe0e2(0x100)]?.[_0x1fe0e2(0x14b)](_0x1f0c55,_0x1fe0e2(0x10e)+_0x491976+_0x1fe0e2(0x112)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x1fe0e2(0x1ae)});}catch(_0x5957ae){console[_0x1fe0e2(0x13c)](_0x1fe0e2(0x1a1),_0x5957ae),await this[_0x1fe0e2(0x100)]?.['sendMessage'](_0x1f0c55,_0x1fe0e2(0x196));}}),this[_0x2e7f7a(0x100)][_0x2e7f7a(0x130)](/\/status/,async _0x2f992f=>{const _0x46922b=_0x2e7f7a,_0x3683f4=_0x2f992f['chat']['id'],_0xddab4d=_0x2f992f['from']?.['id'][_0x46922b(0x120)]();if(!_0xddab4d)return;try{const _0x29f220=await database_1['default'][_0x46922b(0x19b)]['findUnique']({'where':{'telegramId':_0xddab4d},'include':{'shop':!![]}});if(!_0x29f220){await this[_0x46922b(0x100)]?.['sendMessage'](_0x3683f4,_0x46922b(0x198)+_0x46922b(0xdf));return;}if(!_0x29f220[_0x46922b(0x156)]||!_0x29f220['shopId']||!_0x29f220[_0x46922b(0xfe)]){await this[_0x46922b(0x100)]?.[_0x46922b(0x14b)](_0x3683f4,_0x46922b(0xff)+_0x46922b(0x127));return;}await this[_0x46922b(0x100)]?.[_0x46922b(0x14b)](_0x3683f4,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x46922b(0xe5)+_0x29f220[_0x46922b(0xfe)][_0x46922b(0x184)]+'*\x0a')+(_0x46922b(0x17e)+_0x29f220[_0x46922b(0xfe)][_0x46922b(0x143)]+'`\x0a')+(_0x46922b(0xec)+_0x29f220[_0x46922b(0xe1)][_0x46922b(0x158)](_0x46922b(0x19c))+'\x0a\x0a')+_0x46922b(0x157)+'Commands:\x0a'+_0x46922b(0x151),{'parse_mode':_0x46922b(0x1ae)});}catch(_0x241ac9){console['error']('Error\x20handling\x20/status\x20command:',_0x241ac9),await this[_0x46922b(0x100)]?.[_0x46922b(0x14b)](_0x3683f4,_0x46922b(0x196));}}),this[_0x2e7f7a(0x100)][_0x2e7f7a(0x130)](/\/debug/,async _0x808ec4=>{const _0x4ad00a=_0x2e7f7a,_0x4a4959=_0x808ec4[_0x4ad00a(0x12d)]['id'],_0x2833ce=_0x808ec4['from']?.['id'][_0x4ad00a(0x120)]();if(!_0x2833ce)return;try{const _0x407f95=await database_1[_0x4ad00a(0x114)][_0x4ad00a(0xfe)][_0x4ad00a(0x106)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x55db27='🔍\x20*Debug\x20Information*\x0a\x0a';_0x55db27+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x2833ce+_0x4ad00a(0x153),_0x55db27+=_0x4ad00a(0x197),_0x407f95['forEach']((_0x1d61f4,_0x1f55ca)=>{const _0x475a02=_0x4ad00a;_0x55db27+=_0x1f55ca+0x1+_0x475a02(0x1a9)+_0x1d61f4[_0x475a02(0x184)]+'*\x0a',_0x55db27+='\x20\x20\x20Username:\x20`'+_0x1d61f4['username']+'`\x0a',_0x55db27+='\x20\x20\x20Status:\x20'+_0x1d61f4[_0x475a02(0x1b1)]+'\x0a',_0x55db27+=_0x475a02(0xfc)+_0x1d61f4[_0x475a02(0x193)][_0x475a02(0x1ab)](0x0,0xf)+_0x475a02(0x16a);}),await this['bot']?.[_0x4ad00a(0x14b)](_0x4a4959,_0x55db27,{'parse_mode':_0x4ad00a(0x1ae)});}catch(_0x3965b2){console[_0x4ad00a(0x13c)](_0x4ad00a(0x159),_0x3965b2),await this['bot']?.[_0x4ad00a(0x14b)](_0x4a4959,_0x4ad00a(0x1a8));}}),this[_0x2e7f7a(0x100)]['on'](_0x2e7f7a(0xd5),async _0x5db1c9=>{const _0x3fe7dc=_0x2e7f7a;if(_0x5db1c9[_0x3fe7dc(0x113)]?.[_0x3fe7dc(0x147)]('/'))return;const _0x4c0ead=_0x5db1c9[_0x3fe7dc(0x12d)]['id'],_0xd1b3f8=_0x5db1c9[_0x3fe7dc(0xd8)]?.['id'][_0x3fe7dc(0x120)](),_0x159afa=_0x5db1c9[_0x3fe7dc(0x113)]?.[_0x3fe7dc(0xe2)]();if(!_0xd1b3f8||!_0x159afa)return;try{const _0x430522=await database_1[_0x3fe7dc(0x114)][_0x3fe7dc(0x19b)][_0x3fe7dc(0x185)]({'where':{'telegramId':_0xd1b3f8},'include':{'shop':!![]}});if(!_0x430522){await this[_0x3fe7dc(0x100)]?.[_0x3fe7dc(0x14b)](_0x4c0ead,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x430522[_0x3fe7dc(0x156)]&&_0x430522[_0x3fe7dc(0xf1)]&&_0x430522['shop']){await this[_0x3fe7dc(0x100)]?.[_0x3fe7dc(0x14b)](_0x4c0ead,_0x3fe7dc(0x12f)+_0x430522['shop'][_0x3fe7dc(0x184)]+'*.\x0a\x0a'+_0x3fe7dc(0xf8),{'parse_mode':_0x3fe7dc(0x1ae)});return;}const _0x5eeb97=_0x159afa['split'](/\s+/);if(_0x5eeb97[_0x3fe7dc(0xef)]!==0x2){await this[_0x3fe7dc(0x100)]?.[_0x3fe7dc(0x14b)](_0x4c0ead,_0x3fe7dc(0x10b)+_0x3fe7dc(0x19a)+'Example:\x0a'+_0x3fe7dc(0x10a)+(_0x3fe7dc(0x154)+_0x5eeb97[_0x3fe7dc(0xef)]+_0x3fe7dc(0x117)+_0x5eeb97['map'](_0x2b6901=>'`'+_0x2b6901+'`')['join'](',\x20')),{'parse_mode':_0x3fe7dc(0x1ae)});return;}const [_0x237d88,_0x2f0eb1]=_0x5eeb97;console[_0x3fe7dc(0xda)](_0x3fe7dc(0x17a)+_0xd1b3f8+':\x20username=\x22'+_0x237d88+_0x3fe7dc(0x165)+_0x2f0eb1[_0x3fe7dc(0x1ab)](0x0,0xa)+_0x3fe7dc(0x18c)),await this[_0x3fe7dc(0x132)](_0x4c0ead,_0xd1b3f8,_0x237d88,_0x2f0eb1);}catch(_0x22d87d){console[_0x3fe7dc(0x13c)]('Error\x20handling\x20message:',_0x22d87d),await this['bot']?.[_0x3fe7dc(0x14b)](_0x4c0ead,_0x3fe7dc(0x196));}}),this['bot']['on'](_0x2e7f7a(0x13c),_0x5633eb=>{const _0x1f070a=_0x2e7f7a;console[_0x1f070a(0x13c)](_0x1f070a(0xe7),_0x5633eb);}),this['bot']['on'](_0x2e7f7a(0x152),_0x2cf379=>{const _0x3af557=_0x2e7f7a;console[_0x3af557(0x13c)](_0x3af557(0x17c),_0x2cf379);});}async[a54_0x380986(0x132)](_0x227c0c,_0x59271d,_0x5a9a80,_0x4cd0){const _0x1a03d3=a54_0x380986;try{console[_0x1a03d3(0xda)](_0x1a03d3(0x17a)+_0x59271d+_0x1a03d3(0x16d)+_0x5a9a80+_0x1a03d3(0x165)+_0x4cd0['substring'](0x0,0xa)+_0x1a03d3(0x18c));if(!_0x5a9a80||_0x5a9a80[_0x1a03d3(0xef)]<0x3||_0x5a9a80[_0x1a03d3(0xef)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x1a03d3(0x12b)](_0x5a9a80)){await this[_0x1a03d3(0x100)]?.[_0x1a03d3(0x14b)](_0x227c0c,'❌\x20Invalid\x20username\x20format:\x20`'+_0x5a9a80+_0x1a03d3(0x153)+_0x1a03d3(0xf7),{'parse_mode':_0x1a03d3(0x1ae)});return;}if(!_0x4cd0||!_0x4cd0[_0x1a03d3(0x147)](_0x1a03d3(0x12a))&&!_0x4cd0[_0x1a03d3(0x147)](_0x1a03d3(0x11a))){await this[_0x1a03d3(0x100)]?.[_0x1a03d3(0x14b)](_0x227c0c,_0x1a03d3(0x155)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x1a03d3(0x1ae)});return;}const _0x2adc1c=await database_1[_0x1a03d3(0x114)][_0x1a03d3(0xfe)][_0x1a03d3(0x185)]({'where':{'username':_0x5a9a80},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x2adc1c){const _0x3aa267=await database_1['default'][_0x1a03d3(0xfe)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x23d3b6=_0x1a03d3(0x19e)+_0x5a9a80+_0x1a03d3(0x174);_0x3aa267['length']>0x0?(_0x23d3b6+=_0x1a03d3(0xeb),_0x3aa267[_0x1a03d3(0x163)](_0xf1c7da=>{const _0x5af299=_0x1a03d3;_0x23d3b6+='•\x20`'+_0xf1c7da[_0x5af299(0x143)]+'`\x20('+_0xf1c7da[_0x5af299(0x184)]+')\x0a';}),_0x23d3b6+=_0x1a03d3(0xf6)):_0x23d3b6+=_0x1a03d3(0xf9);await this[_0x1a03d3(0x100)]?.['sendMessage'](_0x227c0c,_0x23d3b6,{'parse_mode':_0x1a03d3(0x1ae)});return;}if(_0x2adc1c[_0x1a03d3(0x1b1)]!==_0x1a03d3(0x12e)){await this[_0x1a03d3(0x100)]?.[_0x1a03d3(0x14b)](_0x227c0c,_0x1a03d3(0xdd)+_0x5a9a80+_0x1a03d3(0x177)+_0x1a03d3(0x150),{'parse_mode':_0x1a03d3(0x1ae)});return;}if(_0x2adc1c['publicKey']!==_0x4cd0&&_0x2adc1c[_0x1a03d3(0x18b)]!==_0x4cd0){await this[_0x1a03d3(0x100)]?.[_0x1a03d3(0x14b)](_0x227c0c,_0x1a03d3(0x12c)+_0x5a9a80+_0x1a03d3(0x11e)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x1a03d3(0x172),{'parse_mode':'Markdown'});return;}const _0xb7b05e=await database_1['default']['telegramUser'][_0x1a03d3(0x139)]({'where':{'shopId':_0x2adc1c['id'],'isVerified':!![],'telegramId':{'not':_0x59271d}}});if(_0xb7b05e){await this['bot']?.[_0x1a03d3(0x14b)](_0x227c0c,_0x1a03d3(0xed)+_0x5a9a80+_0x1a03d3(0x11e)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':'Markdown'});return;}await database_1['default']['telegramUser'][_0x1a03d3(0x169)]({'where':{'telegramId':_0x59271d},'data':{'shopId':_0x2adc1c['id'],'isVerified':!![]}}),await this[_0x1a03d3(0x100)]?.[_0x1a03d3(0x14b)](_0x227c0c,_0x1a03d3(0x191)+_0x1a03d3(0x135)+('📱\x20Shop:\x20*'+_0x2adc1c['name']+'*\x0a')+(_0x1a03d3(0x17e)+_0x2adc1c[_0x1a03d3(0x143)]+_0x1a03d3(0x153))+_0x1a03d3(0xe0)+_0x1a03d3(0x1b2)+_0x1a03d3(0x161)+_0x1a03d3(0x104)+_0x1a03d3(0x107)+_0x1a03d3(0x15c)+_0x1a03d3(0x14a)+_0x1a03d3(0x151),{'parse_mode':_0x1a03d3(0x1ae)}),console['log']('✅\x20Telegram\x20user\x20'+_0x59271d+_0x1a03d3(0x102)+_0x2adc1c[_0x1a03d3(0x143)]+_0x1a03d3(0x129));}catch(_0x4fb998){console[_0x1a03d3(0x13c)](_0x1a03d3(0x131),_0x4fb998),await this[_0x1a03d3(0x100)]?.[_0x1a03d3(0x14b)](_0x227c0c,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a54_0x380986(0xf2)](_0x251839,_0x21e39b,_0x58f600){const _0x575aef=a54_0x380986;if(!this['bot']){console[_0x575aef(0x170)](_0x575aef(0x124));return;}try{const _0x3f0c3d=await database_1[_0x575aef(0x114)][_0x575aef(0x19b)][_0x575aef(0x106)]({'where':{'shopId':_0x251839,'isVerified':!![]}});if(_0x3f0c3d[_0x575aef(0xef)]===0x0){console[_0x575aef(0xda)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x251839);return;}const _0x190819=_0x3f0c3d['map'](async _0x36d153=>{const _0x1880ec=_0x575aef;try{await this[_0x1880ec(0x100)]?.[_0x1880ec(0x14b)](_0x36d153['telegramId'],_0x21e39b,_0x58f600),console[_0x1880ec(0xda)](_0x1880ec(0x13a)+_0x36d153['telegramId']);}catch(_0x5b7116){console[_0x1880ec(0x13c)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x36d153[_0x1880ec(0xf4)]+':',_0x5b7116),_0x5b7116 instanceof Error&&(_0x5b7116[_0x1880ec(0xd5)][_0x1880ec(0x18e)](_0x1880ec(0x10f))||_0x5b7116[_0x1880ec(0xd5)][_0x1880ec(0x18e)](_0x1880ec(0x118))||_0x5b7116[_0x1880ec(0xd5)][_0x1880ec(0x18e)](_0x1880ec(0x140)))&&(await database_1[_0x1880ec(0x114)]['telegramUser'][_0x1880ec(0x169)]({'where':{'id':_0x36d153['id']},'data':{'isVerified':![]}}),console[_0x1880ec(0xda)](_0x1880ec(0x144)+_0x36d153[_0x1880ec(0xf4)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x575aef(0xe3)](_0x190819);}catch(_0x1754bb){console[_0x575aef(0x13c)](_0x575aef(0xd2),_0x1754bb);}}async[a54_0x380986(0x1a7)](_0x381e94,_0x1d2d74,_0x49c3aa){const _0x4cccee=a54_0x380986,_0x53a73a={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x5c806e={'created':_0x4cccee(0x103),'paid':_0x4cccee(0x15a),'failed':_0x4cccee(0x110),'expired':'Payment\x20expired','refund':'Payment\x20refund','chargeback':_0x4cccee(0xd4),'processing':_0x4cccee(0x164)},_0x46a32e=_0x53a73a[_0x49c3aa],_0x4b9707=_0x5c806e[_0x49c3aa],_0x31378d=(0x0,gateway_1[_0x4cccee(0x13e)])(_0x1d2d74[_0x4cccee(0x108)]);console['log']('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x1d2d74[_0x4cccee(0x108)]+_0x4cccee(0x16b)+_0x31378d+'\x22');let _0x36a9d7=_0x46a32e+'\x20*'+_0x4b9707+'*\x0a\x0a'+('💰\x20Amount:\x20*'+_0x1d2d74['amount']+'\x20'+_0x1d2d74[_0x4cccee(0x126)]+'*\x0a')+(_0x4cccee(0x13d)+(_0x1d2d74[_0x4cccee(0xf0)]||_0x1d2d74['id'])+'`\x0a')+(_0x4cccee(0x168)+_0x1d2d74['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x31378d+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x1d2d74[_0x4cccee(0x189)])[_0x4cccee(0x145)](_0x4cccee(0x19c))+'\x0a');(_0x1d2d74[_0x4cccee(0x1a4)]||_0x1d2d74['customerEmail'])&&(_0x36a9d7+=_0x4cccee(0x171),_0x1d2d74[_0x4cccee(0x1a4)]&&(_0x36a9d7+=_0x4cccee(0x14d)+_0x1d2d74[_0x4cccee(0x1a4)]+'`\x0a'),_0x1d2d74[_0x4cccee(0x136)]&&(_0x36a9d7+=_0x4cccee(0x15e)+_0x1d2d74[_0x4cccee(0x136)]+'`\x0a')),_0x49c3aa==='chargeback'&&_0x1d2d74['chargebackAmount']&&(_0x36a9d7+=_0x4cccee(0x109)+_0x1d2d74[_0x4cccee(0x1b0)]+_0x4cccee(0xde)),_0x49c3aa===_0x4cccee(0x182)&&(_0x36a9d7+=_0x4cccee(0xd7)),_0x1d2d74['adminNotes']&&(_0x36a9d7+=_0x4cccee(0x1ad)+_0x1d2d74[_0x4cccee(0x18a)]+'\x0a'),await this[_0x4cccee(0xf2)](_0x381e94,_0x36a9d7,{'parse_mode':_0x4cccee(0x1ae)});}async[a54_0x380986(0x1aa)](_0x5d073a,_0x15626d,_0x3c48f8){const _0x3eb270=a54_0x380986,_0x2d57c6={'created':'📤','completed':'✅','rejected':'❌'},_0x4d7390={'created':_0x3eb270(0xd6),'completed':_0x3eb270(0x142),'rejected':_0x3eb270(0x176)},_0x13f300=_0x2d57c6[_0x3c48f8],_0xee38b5=_0x4d7390[_0x3c48f8],_0x1f0cb2=_0x13f300+'\x20*'+_0xee38b5+_0x3eb270(0xea)+('💸\x20Amount:\x20*'+_0x15626d[_0x3eb270(0x146)]+_0x3eb270(0xf3))+(_0x3eb270(0x128)+_0x15626d[_0x3eb270(0x192)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x15626d['id']+'`\x0a')+(_0x3eb270(0x141)+new Date(_0x15626d[_0x3eb270(0x189)])[_0x3eb270(0x145)](_0x3eb270(0x19c))+'\x0a')+(_0x15626d[_0x3eb270(0x181)]?'🔗\x20TXID:\x20`'+_0x15626d[_0x3eb270(0x181)]+'`':'');await this['sendShopNotification'](_0x5d073a,_0x1f0cb2,{'parse_mode':_0x3eb270(0x1ae)});}async[a54_0x380986(0x14f)](_0x42c0c3,_0x781f18){const _0x147299=a54_0x380986;try{const _0x641947=await database_1[_0x147299(0x114)][_0x147299(0x187)][_0x147299(0x185)]({'where':{'shopId':_0x42c0c3},'select':{'notificationLogin':!![]}});if(!_0x641947?.[_0x147299(0x166)]){console[_0x147299(0xda)](_0x147299(0xd9)+_0x42c0c3);return;}const _0xcc2d79=_0x781f18[_0x147299(0x167)]?'🔐':'🚨',_0x5e4350=_0x781f18[_0x147299(0x167)]?_0x147299(0x11b):_0x147299(0xee);let _0x32f7fb=_0xcc2d79+'\x20*'+_0x5e4350+_0x147299(0xea)+(_0x147299(0x17e)+_0x781f18[_0x147299(0x143)]+'`\x0a')+(_0x147299(0x190)+_0x781f18[_0x147299(0x13b)][_0x147299(0x145)](_0x147299(0x19c))+'\x0a');_0x781f18[_0x147299(0x179)]&&(_0x32f7fb+=_0x147299(0xdb)+_0x781f18[_0x147299(0x179)]+'`\x0a');if(_0x781f18[_0x147299(0xfa)]){const _0x5ced7e=_0x781f18['userAgent'][_0x147299(0xef)]>0x32?_0x781f18[_0x147299(0xfa)]['substring'](0x0,0x32)+_0x147299(0xd3):_0x781f18[_0x147299(0xfa)];_0x32f7fb+=_0x147299(0x149)+_0x5ced7e+'`\x0a';}!_0x781f18[_0x147299(0x167)]&&(_0x32f7fb+=_0x147299(0x194)),await this['sendShopNotification'](_0x42c0c3,_0x32f7fb,{'parse_mode':_0x147299(0x1ae)}),console['log'](_0x147299(0xfb)+_0x42c0c3+':\x20'+(_0x781f18[_0x147299(0x167)]?'success':_0x147299(0x148)));}catch(_0x271a4e){console[_0x147299(0x13c)](_0x147299(0x1a0),_0x271a4e);}}async['sendApiErrorNotification'](_0x43d355,_0xeb28c9){const _0x22b454=a54_0x380986;try{const _0x3aae65=await database_1['default'][_0x22b454(0x187)][_0x22b454(0x185)]({'where':{'shopId':_0x43d355},'select':{'notificationApiError':!![]}});if(!_0x3aae65?.[_0x22b454(0xe6)]){console['log'](_0x22b454(0xe9)+_0x43d355);return;}let _0x2f3467=_0x22b454(0x133)+(_0x22b454(0x105)+_0xeb28c9[_0x22b454(0x192)]+'\x20'+_0xeb28c9[_0x22b454(0x122)]+'`\x0a')+(_0x22b454(0x190)+_0xeb28c9[_0x22b454(0x13b)]['toLocaleString'](_0x22b454(0x19c))+'\x0a');_0xeb28c9[_0x22b454(0x162)]&&(_0x2f3467+='📊\x20Error\x20code:\x20`'+_0xeb28c9['statusCode']+'`\x0a'),_0x2f3467+=_0x22b454(0x16e)+_0xeb28c9['errorMessage']+'`\x0a',_0xeb28c9[_0x22b454(0x138)]&&(_0x2f3467+='🆔\x20Request\x20ID:\x20`'+_0xeb28c9[_0x22b454(0x138)]+'`\x0a'),_0x2f3467+=_0x22b454(0x1ac),await this[_0x22b454(0xf2)](_0x43d355,_0x2f3467,{'parse_mode':_0x22b454(0x1ae)}),console[_0x22b454(0xda)](_0x22b454(0x15b)+_0x43d355+':\x20'+_0xeb28c9['endpoint']);}catch(_0x1ff7f4){console[_0x22b454(0x13c)](_0x22b454(0x14c),_0x1ff7f4);}}async[a54_0x380986(0x1a5)](_0x2fffeb,_0x4b1fde,_0x3f2e00){const _0x489e98=a54_0x380986;let _0x4bb98a=_0x489e98(0x11d)+_0x4b1fde+_0x489e98(0xea);for(const [_0xdf7f41,_0x5ff1cf]of Object[_0x489e98(0x1a6)](_0x3f2e00)){_0x5ff1cf!==null&&_0x5ff1cf!==undefined&&(_0x4bb98a+=_0xdf7f41+_0x489e98(0xe4)+_0x5ff1cf+'`\x0a');}await this[_0x489e98(0xf2)](_0x2fffeb,_0x4bb98a,{'parse_mode':_0x489e98(0x1ae)});}[a54_0x380986(0x15d)](){const _0x16e602=a54_0x380986;return{'isActive':!!this[_0x16e602(0x100)],'username':this[_0x16e602(0x123)]};}['stopBot'](){const _0x39d197=a54_0x380986;this[_0x39d197(0x100)]&&(this[_0x39d197(0x100)][_0x39d197(0x160)](),this[_0x39d197(0x100)]=null,console['log'](_0x39d197(0x116)));}}exports['TelegramBotService']=TelegramBotService,exports[a54_0x380986(0x15f)]=new TelegramBotService();