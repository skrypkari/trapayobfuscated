'use strict';const a53_0xda1b7=a53_0x1593;(function(_0x559185,_0x8618c7){const _0x3886f7=a53_0x1593,_0xb657c=_0x559185();while(!![]){try{const _0x365e58=parseInt(_0x3886f7(0x245))/0x1+-parseInt(_0x3886f7(0x254))/0x2*(parseInt(_0x3886f7(0x26b))/0x3)+-parseInt(_0x3886f7(0x263))/0x4*(-parseInt(_0x3886f7(0x25b))/0x5)+-parseInt(_0x3886f7(0x272))/0x6*(parseInt(_0x3886f7(0x1cb))/0x7)+parseInt(_0x3886f7(0x221))/0x8*(-parseInt(_0x3886f7(0x20f))/0x9)+-parseInt(_0x3886f7(0x1f7))/0xa*(parseInt(_0x3886f7(0x1ff))/0xb)+parseInt(_0x3886f7(0x1bf))/0xc;if(_0x365e58===_0x8618c7)break;else _0xb657c['push'](_0xb657c['shift']());}catch(_0x23c11b){_0xb657c['push'](_0xb657c['shift']());}}}(a53_0xa8f4,0xe5dfe));function a53_0x1593(_0x53191c,_0x2f8c94){const _0xa8f43d=a53_0xa8f4();return a53_0x1593=function(_0x1593a8,_0x104372){_0x1593a8=_0x1593a8-0x1b5;let _0x35c3a6=_0xa8f43d[_0x1593a8];return _0x35c3a6;},a53_0x1593(_0x53191c,_0x2f8c94);}var __importDefault=this&&this[a53_0xda1b7(0x1e0)]||function(_0x1674c2){const _0x424482=a53_0xda1b7;return _0x1674c2&&_0x1674c2[_0x424482(0x231)]?_0x1674c2:{'default':_0x1674c2};};Object['defineProperty'](exports,a53_0xda1b7(0x231),{'value':!![]}),exports[a53_0xda1b7(0x216)]=exports['TelegramBotService']=void 0x0;function a53_0xa8f4(){const _0x2607b4=['🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','Commands:\x0a','Error\x20sending\x20shop\x20notification:','create','Payout\x20rejected','chat\x20not\x20found','__importDefault','❌\x20Shop\x20with\x20username\x20`','includes','📧\x20Email:\x20`','TELEGRAM_BOT_TOKEN','processing','❌\x20Shop\x20`','🌐\x20IP\x20address:\x20`','Telegram\x20bot\x20polling\x20error:','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','join','Error\x20handling\x20/status\x20command:','❌\x20Please\x20use\x20/start\x20command\x20first','✅\x20Welcome\x20back!\x0a\x0a','📝\x20Notes:\x20','gateway','...','username','🔍\x20*Debug\x20Information*\x0a\x0a','bot','botUsername','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','Error\x20handling\x20message:','10ktFMcB','amount','🔗\x20TXID:\x20`','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a',':\x20username=\x22','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','adminNotes','chargeback','3242294NZYUPy','updatedAt','txid','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','...\x22','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','notificationApiError','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','💻\x20Browser:\x20`','Payment\x20is\x20being\x20processed','sendLoginNotification','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','📱\x20Telegram\x20notification:\x20gateway\x20\x22','Example:\x0a','🛑\x20Telegram\x20bot\x20stopped','sendMessage','18NOuBYF','\x22\x20->\x20display\x20\x22','🎉\x20*Congratulations!*\x0a\x0a','orderId','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','shop','text','telegramBotService','Use\x20/start\x20to\x20begin.','.\x20*','🔔\x20*','currency','initializeBot','/disconnect\x20-\x20disconnect\x20from\x20notifications','name','isVerified','🔔\x20You\x20receive\x20notifications\x20about:\x0a','✅\x20Telegram\x20bot\x20@','6864976rCkSQi','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','polling_error','substring','from','endpoint','\x20\x20\x20Status:\x20','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','success','ACTIVE','pk_','userAgent','📱\x20Your\x20Telegram\x20ID:\x20`','❌\x20Error\x20getting\x20debug\x20information.','log','update','__esModule','\x20(@','•\x20`','status','customerName','Markdown','📛\x20Name:\x20`','getBotInfo','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','unknown\x20shop','shopId','\x22,\x20apiKey=\x22','\x20USDT*\x0a','✅\x20Connected\x20to\x20shop:\x20*','customerEmail','secretKey','telegramUser','📝\x20Order\x20ID:\x20`','You\x20sent\x20','User\x20','985338qEvNfl','message','`\x20is\x20inactive.\x0a\x0a','📊\x20Error\x20code:\x20`','New\x20payout\x20created','user\x20is\x20deactivated','\x20verified\x20for\x20shop\x20','findUnique','🏦\x20Method:\x20`','🚨\x20*API\x20Error*\x0a\x0a','\x20\x20\x20Public\x20Key:\x20`','•\x20Important\x20events\x0a\x0a','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','🆔\x20Request\x20ID:\x20`','warn','155422cuKKYS','💸\x20Penalty\x20amount:\x20*','📅\x20Time:\x20','Failed\x20to\x20send\x20login\x20notification:','Available\x20usernames:\x0a','startsWith','`\x0a\x0a','1288135wGUiQM','error','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','getGatewayDisplayNameForTelegram','timestamp','4OwmTtU','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','🔌\x20User\x20','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','💸\x20Amount:\x20*','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','Error\x20in\x20handleSingleLineVerification:','🏪\x20Available\x20shops\x20in\x20system:\x0a','15bLPgLO','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','sendCustomNotification','trim','To\x20reconnect,\x20use\x20the\x20/start\x20command','chargebackAmount','../types/gateway','6nRUxSz','🔗\x20Endpoint:\x20`','...`\x0a\x0a','publicKey','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','sendShopNotification','🆔\x20Payout\x20ID:\x20`','👤\x20Username:\x20`','Failed\x20to\x20send\x20API\x20error\x20notification:','onText','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','statusCode','toLocaleString','requestId','\x20\x20\x20Username:\x20`','method','Payment\x20expired','createdAt','`\x20not\x20found.\x0a\x0a','shopSettings','\x0aCheck\x20spelling\x20and\x20try\x20again.','💰\x20Amount:\x20*','length','\x20via\x20single-line\x20input','toString','en-US','handleSingleLineVerification','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','ipAddress','🏪\x20Gateway:\x20`',':\x20`','findMany','default','failed','•\x20New\x20payments\x0a','forEach','/status\x20-\x20check\x20connection\x20status\x0a','sendPaymentNotification','entries','🆔\x20Payment\x20ID:\x20`','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','*.\x0a\x0a','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','42897492VTWRqO','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','chat','sendApiErrorNotification','•\x20Payouts\x0a\x0a','Check\x20spelling\x20and\x20try\x20again.','*\x0a\x0a','errorMessage','env','telegramId','Payout\x20completed','Username:\x20`','10336459JDiNRX','\x20initialized\x20successfully','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','findFirst','allSettled','blocked','botToken','\x20disconnected\x20from\x20shop\x20','Payment\x20chargeback','•\x20Payment\x20status\x20changes\x0a','`.\x0a\x0a','Successful\x20login','Contact\x20administrator.','../config/database','Failed\x20login\x20attempt'];a53_0xa8f4=function(){return _0x2607b4;};return a53_0xa8f4();}const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a53_0xda1b7(0x1d8))),gateway_1=require(a53_0xda1b7(0x271));class TelegramBotService{constructor(){const _0x28eba9=a53_0xda1b7;this['bot']=null,this[_0x28eba9(0x1d1)]=process[_0x28eba9(0x1c7)][_0x28eba9(0x1e4)]||'',this[_0x28eba9(0x1f4)]=process['env']['TELEGRAM_BOT_USERNAME']||'trapay_bot',this['botToken']?this[_0x28eba9(0x21b)]():console[_0x28eba9(0x253)](_0x28eba9(0x25d));}[a53_0xda1b7(0x21b)](){const _0x5cd36d=a53_0xda1b7;try{this[_0x5cd36d(0x1f3)]=new node_telegram_bot_api_1[(_0x5cd36d(0x294))](this[_0x5cd36d(0x1d1)],{'polling':!![]}),this['setupBotHandlers'](),console['log'](_0x5cd36d(0x220)+this[_0x5cd36d(0x1f4)]+_0x5cd36d(0x1cc));}catch(_0x436bcc){console[_0x5cd36d(0x25c)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x436bcc);}}['setupBotHandlers'](){const _0x2fe3d8=a53_0xda1b7;if(!this[_0x2fe3d8(0x1f3)])return;this[_0x2fe3d8(0x1f3)][_0x2fe3d8(0x27c)](/\/start/,async _0x50d3b3=>{const _0x489839=_0x2fe3d8,_0x3a2f9e=_0x50d3b3['chat']['id'],_0x1cb411=_0x50d3b3[_0x489839(0x225)]?.['id'][_0x489839(0x28b)](),_0x58760e=_0x50d3b3['from']?.[_0x489839(0x1f1)],_0x1a38cd=_0x50d3b3[_0x489839(0x225)]?.['first_name'],_0x3bfdbc=_0x50d3b3[_0x489839(0x225)]?.['last_name'];if(!_0x1cb411)return;try{let _0x306739=await database_1[_0x489839(0x294)][_0x489839(0x241)][_0x489839(0x24c)]({'where':{'telegramId':_0x1cb411},'include':{'shop':!![]}});!_0x306739?(_0x306739=await database_1[_0x489839(0x294)][_0x489839(0x241)][_0x489839(0x1dd)]({'data':{'telegramId':_0x1cb411,'username':_0x58760e,'firstName':_0x1a38cd,'lastName':_0x3bfdbc,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x489839(0x22f)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x1cb411+_0x489839(0x232)+_0x58760e+')')):_0x306739=await database_1[_0x489839(0x294)][_0x489839(0x241)][_0x489839(0x230)]({'where':{'telegramId':_0x1cb411},'data':{'username':_0x58760e,'firstName':_0x1a38cd,'lastName':_0x3bfdbc},'include':{'shop':!![]}}),_0x306739[_0x489839(0x21e)]&&_0x306739['shopId']&&_0x306739['shop']?await this[_0x489839(0x1f3)]?.[_0x489839(0x20e)](_0x3a2f9e,_0x489839(0x1ed)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x306739[_0x489839(0x214)][_0x489839(0x21d)]+'*\x0a')+(_0x489839(0x1ca)+_0x306739[_0x489839(0x214)][_0x489839(0x1f1)]+_0x489839(0x25a))+_0x489839(0x21f)+_0x489839(0x1b6)+_0x489839(0x1d4)+_0x489839(0x1c3)+'Commands:\x0a'+_0x489839(0x1b8)+_0x489839(0x21c),{'parse_mode':_0x489839(0x236)}):(_0x306739[_0x489839(0x23b)]&&!_0x306739[_0x489839(0x21e)]&&(await database_1[_0x489839(0x294)][_0x489839(0x241)][_0x489839(0x230)]({'where':{'telegramId':_0x1cb411},'data':{'shopId':null,'isVerified':![]}}),console[_0x489839(0x22f)](_0x489839(0x1da)+_0x1cb411)),await this[_0x489839(0x1f3)]?.[_0x489839(0x20e)](_0x3a2f9e,_0x489839(0x276)+_0x489839(0x266)+_0x489839(0x25e)+'Example:\x0a'+_0x489839(0x27d)+_0x489839(0x1e9),{'parse_mode':'Markdown'}));}catch(_0x5e318a){console[_0x489839(0x25c)]('Error\x20handling\x20/start\x20command:',_0x5e318a),await this['bot']?.[_0x489839(0x20e)](_0x3a2f9e,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x2fe3d8(0x1f3)][_0x2fe3d8(0x27c)](/\/disconnect/,async _0x2fdf9b=>{const _0x4aaf1a=_0x2fe3d8,_0x4d5fa6=_0x2fdf9b[_0x4aaf1a(0x1c1)]['id'],_0x4e29ac=_0x2fdf9b[_0x4aaf1a(0x225)]?.['id'][_0x4aaf1a(0x28b)]();if(!_0x4e29ac)return;try{const _0x1cbe21=await database_1[_0x4aaf1a(0x294)]['telegramUser'][_0x4aaf1a(0x24c)]({'where':{'telegramId':_0x4e29ac},'include':{'shop':!![]}});if(!_0x1cbe21||!_0x1cbe21[_0x4aaf1a(0x21e)]||!_0x1cbe21[_0x4aaf1a(0x23b)]){await this[_0x4aaf1a(0x1f3)]?.[_0x4aaf1a(0x20e)](_0x4d5fa6,_0x4aaf1a(0x202));return;}const _0x9f6854=_0x1cbe21[_0x4aaf1a(0x214)]?.['name']||_0x4aaf1a(0x23a);await database_1[_0x4aaf1a(0x294)]['telegramUser'][_0x4aaf1a(0x230)]({'where':{'telegramId':_0x4e29ac},'data':{'shopId':null,'isVerified':![]}}),console[_0x4aaf1a(0x22f)](_0x4aaf1a(0x265)+_0x4e29ac+_0x4aaf1a(0x1d2)+_0x1cbe21[_0x4aaf1a(0x23b)]),await this['bot']?.['sendMessage'](_0x4d5fa6,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x9f6854+_0x4aaf1a(0x1bd)+_0x4aaf1a(0x26f),{'parse_mode':'Markdown'});}catch(_0x36d4d6){console[_0x4aaf1a(0x25c)]('Error\x20handling\x20/disconnect\x20command:',_0x36d4d6),await this[_0x4aaf1a(0x1f3)]?.['sendMessage'](_0x4d5fa6,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['onText'](/\/status/,async _0x2946d4=>{const _0x5617a4=_0x2fe3d8,_0x4a11da=_0x2946d4[_0x5617a4(0x1c1)]['id'],_0x287775=_0x2946d4[_0x5617a4(0x225)]?.['id'][_0x5617a4(0x28b)]();if(!_0x287775)return;try{const _0x4c3315=await database_1[_0x5617a4(0x294)][_0x5617a4(0x241)][_0x5617a4(0x24c)]({'where':{'telegramId':_0x287775},'include':{'shop':!![]}});if(!_0x4c3315){await this[_0x5617a4(0x1f3)]?.[_0x5617a4(0x20e)](_0x4a11da,_0x5617a4(0x277)+_0x5617a4(0x217));return;}if(!_0x4c3315[_0x5617a4(0x21e)]||!_0x4c3315[_0x5617a4(0x23b)]||!_0x4c3315[_0x5617a4(0x214)]){await this[_0x5617a4(0x1f3)]?.[_0x5617a4(0x20e)](_0x4a11da,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+'Use\x20/start\x20to\x20connect.');return;}await this[_0x5617a4(0x1f3)]?.[_0x5617a4(0x20e)](_0x4a11da,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x5617a4(0x23e)+_0x4c3315[_0x5617a4(0x214)][_0x5617a4(0x21d)]+'*\x0a')+('👤\x20Username:\x20`'+_0x4c3315[_0x5617a4(0x214)][_0x5617a4(0x1f1)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x4c3315[_0x5617a4(0x200)]['toLocaleDateString'](_0x5617a4(0x28c))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+'Commands:\x0a'+_0x5617a4(0x21c),{'parse_mode':_0x5617a4(0x236)});}catch(_0x22afb5){console['error'](_0x5617a4(0x1eb),_0x22afb5),await this[_0x5617a4(0x1f3)]?.[_0x5617a4(0x20e)](_0x4a11da,_0x5617a4(0x1c0));}}),this[_0x2fe3d8(0x1f3)][_0x2fe3d8(0x27c)](/\/debug/,async _0x49f614=>{const _0x5dcca8=_0x2fe3d8,_0xcb98f3=_0x49f614[_0x5dcca8(0x1c1)]['id'],_0x2bb250=_0x49f614[_0x5dcca8(0x225)]?.['id'][_0x5dcca8(0x28b)]();if(!_0x2bb250)return;try{const _0x3dfc94=await database_1[_0x5dcca8(0x294)][_0x5dcca8(0x214)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x7afdca=_0x5dcca8(0x1f2);_0x7afdca+=_0x5dcca8(0x22d)+_0x2bb250+_0x5dcca8(0x25a),_0x7afdca+=_0x5dcca8(0x26a),_0x3dfc94[_0x5dcca8(0x1b7)]((_0x1bde24,_0x32ecea)=>{const _0x568f6d=_0x5dcca8;_0x7afdca+=_0x32ecea+0x1+_0x568f6d(0x218)+_0x1bde24[_0x568f6d(0x21d)]+'*\x0a',_0x7afdca+=_0x568f6d(0x281)+_0x1bde24[_0x568f6d(0x1f1)]+'`\x0a',_0x7afdca+=_0x568f6d(0x227)+_0x1bde24[_0x568f6d(0x234)]+'\x0a',_0x7afdca+=_0x568f6d(0x24f)+_0x1bde24['publicKey'][_0x568f6d(0x224)](0x0,0xf)+_0x568f6d(0x274);}),await this['bot']?.['sendMessage'](_0xcb98f3,_0x7afdca,{'parse_mode':_0x5dcca8(0x236)});}catch(_0x8dcb70){console['error']('Error\x20handling\x20/debug\x20command:',_0x8dcb70),await this[_0x5dcca8(0x1f3)]?.[_0x5dcca8(0x20e)](_0xcb98f3,_0x5dcca8(0x22e));}}),this[_0x2fe3d8(0x1f3)]['on']('message',async _0x311d68=>{const _0x390eb0=_0x2fe3d8;if(_0x311d68[_0x390eb0(0x215)]?.[_0x390eb0(0x259)]('/'))return;const _0x3131ce=_0x311d68['chat']['id'],_0x48ea3b=_0x311d68['from']?.['id'][_0x390eb0(0x28b)](),_0x28ca73=_0x311d68[_0x390eb0(0x215)]?.[_0x390eb0(0x26e)]();if(!_0x48ea3b||!_0x28ca73)return;try{const _0x2fdaec=await database_1['default'][_0x390eb0(0x241)]['findUnique']({'where':{'telegramId':_0x48ea3b},'include':{'shop':!![]}});if(!_0x2fdaec){await this[_0x390eb0(0x1f3)]?.[_0x390eb0(0x20e)](_0x3131ce,_0x390eb0(0x1ec));return;}if(_0x2fdaec[_0x390eb0(0x21e)]&&_0x2fdaec[_0x390eb0(0x23b)]&&_0x2fdaec[_0x390eb0(0x214)]){await this[_0x390eb0(0x1f3)]?.[_0x390eb0(0x20e)](_0x3131ce,_0x390eb0(0x1fc)+_0x2fdaec[_0x390eb0(0x214)]['name']+_0x390eb0(0x1bd)+_0x390eb0(0x228),{'parse_mode':'Markdown'});return;}const _0x33e018=_0x28ca73['split'](/\s+/);if(_0x33e018['length']!==0x2){await this[_0x390eb0(0x1f3)]?.['sendMessage'](_0x3131ce,_0x390eb0(0x1fa)+_0x390eb0(0x25e)+_0x390eb0(0x20c)+_0x390eb0(0x27d)+(_0x390eb0(0x243)+_0x33e018['length']+'\x20parts:\x20'+_0x33e018['map'](_0xa7c305=>'`'+_0xa7c305+'`')[_0x390eb0(0x1ea)](',\x20')),{'parse_mode':_0x390eb0(0x236)});return;}const [_0x5e95d1,_0x2a7d74]=_0x33e018;console[_0x390eb0(0x22f)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x48ea3b+_0x390eb0(0x1fb)+_0x5e95d1+'\x22,\x20apiKey=\x22'+_0x2a7d74[_0x390eb0(0x224)](0x0,0xa)+_0x390eb0(0x203)),await this['handleSingleLineVerification'](_0x3131ce,_0x48ea3b,_0x5e95d1,_0x2a7d74);}catch(_0xbddea9){console[_0x390eb0(0x25c)](_0x390eb0(0x1f6),_0xbddea9),await this[_0x390eb0(0x1f3)]?.['sendMessage'](_0x3131ce,_0x390eb0(0x1c0));}}),this[_0x2fe3d8(0x1f3)]['on']('error',_0x363535=>{console['error']('Telegram\x20bot\x20error:',_0x363535);}),this[_0x2fe3d8(0x1f3)]['on'](_0x2fe3d8(0x223),_0x13bb84=>{const _0x4edba8=_0x2fe3d8;console[_0x4edba8(0x25c)](_0x4edba8(0x1e8),_0x13bb84);});}async[a53_0xda1b7(0x28d)](_0x71bac4,_0x45b206,_0x358225,_0x204437){const _0x1e0996=a53_0xda1b7;try{console['log']('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x45b206+':\x20username=\x22'+_0x358225+_0x1e0996(0x23c)+_0x204437[_0x1e0996(0x224)](0x0,0xa)+_0x1e0996(0x203));if(!_0x358225||_0x358225[_0x1e0996(0x289)]<0x3||_0x358225['length']>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x358225)){await this[_0x1e0996(0x1f3)]?.['sendMessage'](_0x71bac4,'❌\x20Invalid\x20username\x20format:\x20`'+_0x358225+_0x1e0996(0x25a)+_0x1e0996(0x26c),{'parse_mode':_0x1e0996(0x236)});return;}if(!_0x204437||!_0x204437['startsWith'](_0x1e0996(0x22b))&&!_0x204437[_0x1e0996(0x259)]('sk_')){await this[_0x1e0996(0x1f3)]?.[_0x1e0996(0x20e)](_0x71bac4,_0x1e0996(0x1bc)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x1e0996(0x236)});return;}const _0x4d26f4=await database_1[_0x1e0996(0x294)][_0x1e0996(0x214)][_0x1e0996(0x24c)]({'where':{'username':_0x358225},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x4d26f4){const _0x36c3b0=await database_1['default']['shop'][_0x1e0996(0x293)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x4e3b4d=_0x1e0996(0x1e1)+_0x358225+_0x1e0996(0x285);_0x36c3b0[_0x1e0996(0x289)]>0x0?(_0x4e3b4d+=_0x1e0996(0x258),_0x36c3b0['forEach'](_0x556581=>{const _0x5c1097=_0x1e0996;_0x4e3b4d+=_0x5c1097(0x233)+_0x556581[_0x5c1097(0x1f1)]+'`\x20('+_0x556581[_0x5c1097(0x21d)]+')\x0a';}),_0x4e3b4d+=_0x1e0996(0x287)):_0x4e3b4d+=_0x1e0996(0x1c4);await this[_0x1e0996(0x1f3)]?.[_0x1e0996(0x20e)](_0x71bac4,_0x4e3b4d,{'parse_mode':'Markdown'});return;}if(_0x4d26f4['status']!==_0x1e0996(0x22a)){await this[_0x1e0996(0x1f3)]?.[_0x1e0996(0x20e)](_0x71bac4,_0x1e0996(0x1e6)+_0x358225+_0x1e0996(0x247)+_0x1e0996(0x1d7),{'parse_mode':_0x1e0996(0x236)});return;}if(_0x4d26f4[_0x1e0996(0x275)]!==_0x204437&&_0x4d26f4[_0x1e0996(0x240)]!==_0x204437){await this[_0x1e0996(0x1f3)]?.[_0x1e0996(0x20e)](_0x71bac4,_0x1e0996(0x264)+_0x358225+'`.\x0a\x0a'+_0x1e0996(0x1f5)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':'Markdown'});return;}const _0xe7f4e8=await database_1[_0x1e0996(0x294)]['telegramUser'][_0x1e0996(0x1ce)]({'where':{'shopId':_0x4d26f4['id'],'isVerified':!![],'telegramId':{'not':_0x45b206}}});if(_0xe7f4e8){await this[_0x1e0996(0x1f3)]?.[_0x1e0996(0x20e)](_0x71bac4,_0x1e0996(0x251)+_0x358225+_0x1e0996(0x1d5)+_0x1e0996(0x268),{'parse_mode':_0x1e0996(0x236)});return;}await database_1[_0x1e0996(0x294)][_0x1e0996(0x241)][_0x1e0996(0x230)]({'where':{'telegramId':_0x45b206},'data':{'shopId':_0x4d26f4['id'],'isVerified':!![]}}),await this[_0x1e0996(0x1f3)]?.[_0x1e0996(0x20e)](_0x71bac4,_0x1e0996(0x211)+_0x1e0996(0x239)+('📱\x20Shop:\x20*'+_0x4d26f4[_0x1e0996(0x21d)]+'*\x0a')+(_0x1e0996(0x27a)+_0x4d26f4['username']+_0x1e0996(0x25a))+_0x1e0996(0x25f)+_0x1e0996(0x1b6)+_0x1e0996(0x1d4)+'•\x20Payouts\x0a'+_0x1e0996(0x250)+_0x1e0996(0x1db)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x1e0996(0x21c),{'parse_mode':_0x1e0996(0x236)}),console[_0x1e0996(0x22f)]('✅\x20Telegram\x20user\x20'+_0x45b206+_0x1e0996(0x24b)+_0x4d26f4[_0x1e0996(0x1f1)]+_0x1e0996(0x28a));}catch(_0x4c0691){console[_0x1e0996(0x25c)](_0x1e0996(0x269),_0x4c0691),await this[_0x1e0996(0x1f3)]?.[_0x1e0996(0x20e)](_0x71bac4,_0x1e0996(0x28f));}}async[a53_0xda1b7(0x278)](_0x3c692b,_0x40bb65,_0xbb5d62){const _0x508eba=a53_0xda1b7;if(!this[_0x508eba(0x1f3)]){console['warn']('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x30190d=await database_1[_0x508eba(0x294)][_0x508eba(0x241)]['findMany']({'where':{'shopId':_0x3c692b,'isVerified':!![]}});if(_0x30190d[_0x508eba(0x289)]===0x0){console['log'](_0x508eba(0x1be)+_0x3c692b);return;}const _0x142dd0=_0x30190d['map'](async _0x1ffb2b=>{const _0x27e2aa=_0x508eba;try{await this['bot']?.[_0x27e2aa(0x20e)](_0x1ffb2b[_0x27e2aa(0x1c8)],_0x40bb65,_0xbb5d62),console[_0x27e2aa(0x22f)](_0x27e2aa(0x213)+_0x1ffb2b[_0x27e2aa(0x1c8)]);}catch(_0x54fc84){console[_0x27e2aa(0x25c)](_0x27e2aa(0x1cd)+_0x1ffb2b['telegramId']+':',_0x54fc84),_0x54fc84 instanceof Error&&(_0x54fc84[_0x27e2aa(0x246)]['includes'](_0x27e2aa(0x1d0))||_0x54fc84[_0x27e2aa(0x246)][_0x27e2aa(0x1e2)](_0x27e2aa(0x1df))||_0x54fc84['message'][_0x27e2aa(0x1e2)](_0x27e2aa(0x24a)))&&(await database_1['default'][_0x27e2aa(0x241)]['update']({'where':{'id':_0x1ffb2b['id']},'data':{'isVerified':![]}}),console['log'](_0x27e2aa(0x244)+_0x1ffb2b[_0x27e2aa(0x1c8)]+_0x27e2aa(0x206)));}});await Promise[_0x508eba(0x1cf)](_0x142dd0);}catch(_0x2d29d0){console[_0x508eba(0x25c)](_0x508eba(0x1dc),_0x2d29d0);}}async[a53_0xda1b7(0x1b9)](_0x363599,_0x489be3,_0x153ae0){const _0x599200=a53_0xda1b7,_0x492c15={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x57d4dc={'created':'New\x20payment\x20created','paid':'Payment\x20successfully\x20paid','failed':'Payment\x20failed','expired':_0x599200(0x283),'refund':'Payment\x20refund','chargeback':_0x599200(0x1d3),'processing':_0x599200(0x208)},_0x47ef80=_0x492c15[_0x153ae0],_0x11e88e=_0x57d4dc[_0x153ae0],_0x58a102=(0x0,gateway_1[_0x599200(0x261)])(_0x489be3[_0x599200(0x1ef)]);console[_0x599200(0x22f)](_0x599200(0x20b)+_0x489be3[_0x599200(0x1ef)]+_0x599200(0x210)+_0x58a102+'\x22');let _0x107da6=_0x47ef80+'\x20*'+_0x11e88e+_0x599200(0x1c5)+(_0x599200(0x288)+_0x489be3[_0x599200(0x1f8)]+'\x20'+_0x489be3[_0x599200(0x21a)]+'*\x0a')+(_0x599200(0x242)+(_0x489be3[_0x599200(0x212)]||_0x489be3['id'])+'`\x0a')+(_0x599200(0x1bb)+_0x489be3['id']+'`\x0a')+(_0x599200(0x291)+_0x58a102+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x489be3[_0x599200(0x284)])[_0x599200(0x27f)](_0x599200(0x28c))+'\x0a');(_0x489be3[_0x599200(0x235)]||_0x489be3['customerEmail'])&&(_0x107da6+='\x0a👤\x20*Customer\x20Information:*\x0a',_0x489be3[_0x599200(0x235)]&&(_0x107da6+=_0x599200(0x237)+_0x489be3['customerName']+'`\x0a'),_0x489be3[_0x599200(0x23f)]&&(_0x107da6+=_0x599200(0x1e3)+_0x489be3['customerEmail']+'`\x0a')),_0x153ae0===_0x599200(0x1fe)&&_0x489be3[_0x599200(0x270)]&&(_0x107da6+=_0x599200(0x255)+_0x489be3['chargebackAmount']+_0x599200(0x23d)),_0x153ae0===_0x599200(0x1e5)&&(_0x107da6+=_0x599200(0x28e)),_0x489be3[_0x599200(0x1fd)]&&(_0x107da6+=_0x599200(0x1ee)+_0x489be3[_0x599200(0x1fd)]+'\x0a'),await this[_0x599200(0x278)](_0x363599,_0x107da6,{'parse_mode':_0x599200(0x236)});}async['sendPayoutNotification'](_0x311e00,_0x5b387b,_0x5cd03b){const _0x5b4112=a53_0xda1b7,_0x198b82={'created':'📤','completed':'✅','rejected':'❌'},_0x208931={'created':_0x5b4112(0x249),'completed':_0x5b4112(0x1c9),'rejected':_0x5b4112(0x1de)},_0x2530fe=_0x198b82[_0x5cd03b],_0x43078e=_0x208931[_0x5cd03b],_0x45de2d=_0x2530fe+'\x20*'+_0x43078e+_0x5b4112(0x1c5)+(_0x5b4112(0x267)+_0x5b387b[_0x5b4112(0x1f8)]+'\x20USD*\x0a')+(_0x5b4112(0x24d)+_0x5b387b['method']+'`\x0a')+(_0x5b4112(0x279)+_0x5b387b['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x5b387b[_0x5b4112(0x284)])[_0x5b4112(0x27f)]('en-US')+'\x0a')+(_0x5b387b[_0x5b4112(0x201)]?_0x5b4112(0x1f9)+_0x5b387b[_0x5b4112(0x201)]+'`':'');await this[_0x5b4112(0x278)](_0x311e00,_0x45de2d,{'parse_mode':'Markdown'});}async[a53_0xda1b7(0x209)](_0x13b48a,_0x1027be){const _0x2b50aa=a53_0xda1b7;try{const _0x476bf6=await database_1['default'][_0x2b50aa(0x286)][_0x2b50aa(0x24c)]({'where':{'shopId':_0x13b48a},'select':{'notificationLogin':!![]}});if(!_0x476bf6?.['notificationLogin']){console[_0x2b50aa(0x22f)](_0x2b50aa(0x20a)+_0x13b48a);return;}const _0x40714f=_0x1027be['success']?'🔐':'🚨',_0x2a3833=_0x1027be[_0x2b50aa(0x229)]?_0x2b50aa(0x1d6):_0x2b50aa(0x1d9);let _0x5ba4a9=_0x40714f+'\x20*'+_0x2a3833+_0x2b50aa(0x1c5)+(_0x2b50aa(0x27a)+_0x1027be[_0x2b50aa(0x1f1)]+'`\x0a')+(_0x2b50aa(0x256)+_0x1027be[_0x2b50aa(0x262)][_0x2b50aa(0x27f)](_0x2b50aa(0x28c))+'\x0a');_0x1027be[_0x2b50aa(0x290)]&&(_0x5ba4a9+=_0x2b50aa(0x1e7)+_0x1027be[_0x2b50aa(0x290)]+'`\x0a');if(_0x1027be[_0x2b50aa(0x22c)]){const _0x4e2b8c=_0x1027be[_0x2b50aa(0x22c)][_0x2b50aa(0x289)]>0x32?_0x1027be[_0x2b50aa(0x22c)]['substring'](0x0,0x32)+_0x2b50aa(0x1f0):_0x1027be[_0x2b50aa(0x22c)];_0x5ba4a9+=_0x2b50aa(0x207)+_0x4e2b8c+'`\x0a';}!_0x1027be['success']&&(_0x5ba4a9+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x2b50aa(0x278)](_0x13b48a,_0x5ba4a9,{'parse_mode':_0x2b50aa(0x236)}),console[_0x2b50aa(0x22f)](_0x2b50aa(0x204)+_0x13b48a+':\x20'+(_0x1027be[_0x2b50aa(0x229)]?_0x2b50aa(0x229):_0x2b50aa(0x1b5)));}catch(_0x53e27b){console[_0x2b50aa(0x25c)](_0x2b50aa(0x257),_0x53e27b);}}async[a53_0xda1b7(0x1c2)](_0x59f0da,_0x46ca98){const _0x1c297b=a53_0xda1b7;try{const _0x1a42d5=await database_1[_0x1c297b(0x294)][_0x1c297b(0x286)][_0x1c297b(0x24c)]({'where':{'shopId':_0x59f0da},'select':{'notificationApiError':!![]}});if(!_0x1a42d5?.[_0x1c297b(0x205)]){console[_0x1c297b(0x22f)](_0x1c297b(0x222)+_0x59f0da);return;}let _0x58c942=_0x1c297b(0x24e)+(_0x1c297b(0x273)+_0x46ca98[_0x1c297b(0x282)]+'\x20'+_0x46ca98['endpoint']+'`\x0a')+(_0x1c297b(0x256)+_0x46ca98[_0x1c297b(0x262)][_0x1c297b(0x27f)](_0x1c297b(0x28c))+'\x0a');_0x46ca98['statusCode']&&(_0x58c942+=_0x1c297b(0x248)+_0x46ca98[_0x1c297b(0x27e)]+'`\x0a'),_0x58c942+='❌\x20Error:\x20`'+_0x46ca98[_0x1c297b(0x1c6)]+'`\x0a',_0x46ca98['requestId']&&(_0x58c942+=_0x1c297b(0x252)+_0x46ca98[_0x1c297b(0x280)]+'`\x0a'),_0x58c942+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x1c297b(0x278)](_0x59f0da,_0x58c942,{'parse_mode':_0x1c297b(0x236)}),console[_0x1c297b(0x22f)](_0x1c297b(0x260)+_0x59f0da+':\x20'+_0x46ca98[_0x1c297b(0x226)]);}catch(_0x47435b){console[_0x1c297b(0x25c)](_0x1c297b(0x27b),_0x47435b);}}async[a53_0xda1b7(0x26d)](_0x1cffa0,_0x89611f,_0x465ab1){const _0x592f94=a53_0xda1b7;let _0x3262b3=_0x592f94(0x219)+_0x89611f+'*\x0a\x0a';for(const [_0x5382ba,_0x3a5e54]of Object[_0x592f94(0x1ba)](_0x465ab1)){_0x3a5e54!==null&&_0x3a5e54!==undefined&&(_0x3262b3+=_0x5382ba+_0x592f94(0x292)+_0x3a5e54+'`\x0a');}await this[_0x592f94(0x278)](_0x1cffa0,_0x3262b3,{'parse_mode':_0x592f94(0x236)});}[a53_0xda1b7(0x238)](){const _0x411c76=a53_0xda1b7;return{'isActive':!!this[_0x411c76(0x1f3)],'username':this[_0x411c76(0x1f4)]};}['stopBot'](){const _0x26382f=a53_0xda1b7;this[_0x26382f(0x1f3)]&&(this[_0x26382f(0x1f3)]['stopPolling'](),this[_0x26382f(0x1f3)]=null,console[_0x26382f(0x22f)](_0x26382f(0x20d)));}}exports['TelegramBotService']=TelegramBotService,exports[a53_0xda1b7(0x216)]=new TelegramBotService();