'use strict';const a55_0x2c4a51=a55_0x4377;function a55_0x4377(_0x4e976b,_0x23d13e){const _0x5e4d3f=a55_0x5e4d();return a55_0x4377=function(_0x437715,_0x404fe0){_0x437715=_0x437715-0xda;let _0x9856f0=_0x5e4d3f[_0x437715];return _0x9856f0;},a55_0x4377(_0x4e976b,_0x23d13e);}(function(_0xafc9c,_0x454d4d){const _0x3293f0=a55_0x4377,_0x10c645=_0xafc9c();while(!![]){try{const _0x5b35fe=-parseInt(_0x3293f0(0x183))/0x1+parseInt(_0x3293f0(0xf1))/0x2*(parseInt(_0x3293f0(0x1be))/0x3)+-parseInt(_0x3293f0(0x110))/0x4*(-parseInt(_0x3293f0(0xe1))/0x5)+parseInt(_0x3293f0(0x19b))/0x6+parseInt(_0x3293f0(0x16b))/0x7*(-parseInt(_0x3293f0(0x10d))/0x8)+-parseInt(_0x3293f0(0x11e))/0x9+-parseInt(_0x3293f0(0xfd))/0xa;if(_0x5b35fe===_0x454d4d)break;else _0x10c645['push'](_0x10c645['shift']());}catch(_0x1fc790){_0x10c645['push'](_0x10c645['shift']());}}}(a55_0x5e4d,0x32a50));function a55_0x5e4d(){const _0x2a5244=['\x20disconnected\x20from\x20shop\x20','Successful\x20login','shopId','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','../config/database','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','26383VZzlhQ','split','Payment\x20is\x20being\x20processed','User\x20','TELEGRAM_BOT_USERNAME','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','sendLoginNotification','📊\x20Error\x20code:\x20`','pk_','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','onText','📱\x20Your\x20Telegram\x20ID:\x20`','...`\x0a\x0a','__esModule','\x20verified\x20for\x20shop\x20','sendApiErrorNotification','...','📅\x20Time:\x20','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','customerName','warn','requestId','1666470Pjhldi','botToken','env','sendCustomNotification','Payout\x20completed','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','\x20\x20\x20Status:\x20','sk_','TELEGRAM_BOT_TOKEN','update','`\x0a\x0a','status','•\x20Payouts\x0a','chargeback','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','•\x20`','\x20USD*\x0a','unknown\x20shop','\x0a👤\x20*Customer\x20Information:*\x0a','method','entries','node-telegram-bot-api','first_name','stopBot','Payment\x20refund','`\x20not\x20found.\x0a\x0a','❌\x20Error:\x20`','Payout\x20rejected','\x20initialized\x20successfully','📊\x20*Connection\x20Status*\x0a\x0a','userAgent','default','text','success','`\x20(','170397VGTIKx','❌\x20Shop\x20with\x20username\x20`','🔔\x20Notifications\x20are\x20active\x0a\x0a','amount','🆔\x20Payout\x20ID:\x20`','📅\x20Connection\x20date:\x20','🚨\x20*API\x20Error*\x0a\x0a','🔔\x20You\x20receive\x20notifications\x20about:\x0a','username','orderId','\x20parts:\x20','customerIp','remitterIban','txid','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','905245dhAnMK','create','Contact\x20administrator.','telegramUser','❌\x20Shop\x20`','🎉\x20*Congratulations!*\x0a\x0a','\x20\x20\x20Username:\x20`','Error\x20handling\x20/disconnect\x20command:','/status\x20-\x20check\x20connection\x20status\x0a','stopPolling','💻\x20Browser:\x20`','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','chargebackAmount','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','endpoint',':\x20username=\x22','12SIToYS','Error\x20handling\x20/debug\x20command:','TelegramBotService','startsWith','Telegram\x20bot\x20error:','❌\x20Error\x20getting\x20debug\x20information.','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','setupBotHandlers','Markdown','\x20\x20\x20Public\x20Key:\x20`','🆔\x20Payment\x20ID:\x20`','•\x20Payment\x20status\x20changes\x0a','4533680kefEXi','\x0aCheck\x20spelling\x20and\x20try\x20again.','handleSingleLineVerification','🆔\x20Request\x20ID:\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','Failed\x20to\x20send\x20login\x20notification:','findMany','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','📧\x20Email:\x20`','log','❌\x20Please\x20use\x20/start\x20command\x20first','sendMessage','sendPayoutNotification','🏦\x20IBAN:\x20`','📱\x20Telegram\x20notification:\x20gateway\x20\x22','telegramId','1559912ZWoKsU','🛑\x20Telegram\x20bot\x20stopped','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','8XOmQhe','gateway','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','🔗\x20Endpoint:\x20`','Error\x20sending\x20shop\x20notification:','chat\x20not\x20found','📅\x20Date:\x20','toString','from','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','bot','secretKey','886113DGocjz','💰\x20Amount:\x20*','\x20(@','customerEmail','To\x20reconnect,\x20use\x20the\x20/start\x20command',':\x20`','allSettled','en-US','Error\x20handling\x20message:','🏪\x20Gateway:\x20`','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','Error\x20handling\x20/status\x20command:','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','publicKey','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','*.\x0a\x0a','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','sendShopNotification','Example:\x0a','trim','Payment\x20chargeback','Payment\x20failed','.\x20*','forEach','✅\x20Connected\x20to\x20shop:\x20*','errorMessage','✅\x20Telegram\x20bot\x20@','timestamp','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','ACTIVE','processing','•\x20Payouts\x0a\x0a','substring','Payment\x20successfully\x20paid','🔍\x20*Debug\x20Information*\x0a\x0a','telegramBotService','🌐\x20IP\x20address:\x20`','findFirst','error','...\x22','📝\x20Notes:\x20','New\x20payout\x20created','Use\x20/start\x20to\x20connect.','blocked','findUnique','📱\x20Created\x20new\x20Telegram\x20user:\x20','🔔\x20*','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','name','shopSettings','updatedAt','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','Failed\x20to\x20send\x20API\x20error\x20notification:','statusCode','❌\x20Invalid\x20username\x20format:\x20`','🏦\x20Method:\x20`','🔌\x20User\x20','getBotInfo','•\x20Important\x20events\x0a\x0a','Error\x20handling\x20/start\x20command:','botUsername','createdAt','trapay_bot','•\x20New\x20payments\x0a','notificationLogin','failed','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','includes','\x22,\x20apiKey=\x22','message','isVerified','../types/gateway','You\x20sent\x20','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','*\x0a\x0a','7ArwfkK','toLocaleString','shop','polling_error','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','`.\x0a\x0a','👤\x20Username:\x20`','notificationApiError','length','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','chat','ipAddress','customerUa','getGatewayDisplayNameForTelegram','Commands:\x0a','Available\x20usernames:\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'];a55_0x5e4d=function(){return _0x2a5244;};return a55_0x5e4d();}var __importDefault=this&&this['__importDefault']||function(_0x3555e1){const _0x5aec05=a55_0x4377;return _0x3555e1&&_0x3555e1[_0x5aec05(0x191)]?_0x3555e1:{'default':_0x3555e1};};Object['defineProperty'](exports,a55_0x2c4a51(0x191),{'value':!![]}),exports[a55_0x2c4a51(0x142)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a55_0x2c4a51(0x1b0))),database_1=__importDefault(require(a55_0x2c4a51(0x181))),gateway_1=require(a55_0x2c4a51(0x166));class TelegramBotService{constructor(){const _0x324b16=a55_0x2c4a51;this['bot']=null,this[_0x324b16(0x19c)]=process[_0x324b16(0x19d)][_0x324b16(0x1a3)]||'',this['botUsername']=process[_0x324b16(0x19d)][_0x324b16(0x187)]||_0x324b16(0x15d),this[_0x324b16(0x19c)]?this['initializeBot']():console[_0x324b16(0x199)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}['initializeBot'](){const _0xad775a=a55_0x2c4a51;try{this[_0xad775a(0x11c)]=new node_telegram_bot_api_1[(_0xad775a(0x1ba))](this[_0xad775a(0x19c)],{'polling':!![]}),this[_0xad775a(0xf8)](),console[_0xad775a(0x106)](_0xad775a(0x139)+this[_0xad775a(0x15b)]+_0xad775a(0x1b7));}catch(_0x45b5a4){console[_0xad775a(0x145)](_0xad775a(0xec),_0x45b5a4);}}['setupBotHandlers'](){const _0x154159=a55_0x2c4a51;if(!this['bot'])return;this[_0x154159(0x11c)][_0x154159(0x18e)](/\/start/,async _0x498d28=>{const _0xe7d0ae=_0x154159,_0x21a0f6=_0x498d28[_0xe7d0ae(0x176)]['id'],_0x1b8f73=_0x498d28[_0xe7d0ae(0x118)]?.['id'][_0xe7d0ae(0x117)](),_0x1f7499=_0x498d28[_0xe7d0ae(0x118)]?.[_0xe7d0ae(0x1c6)],_0x308e69=_0x498d28[_0xe7d0ae(0x118)]?.[_0xe7d0ae(0x1b1)],_0xa6fcaf=_0x498d28[_0xe7d0ae(0x118)]?.['last_name'];if(!_0x1b8f73)return;try{let _0x50be0c=await database_1[_0xe7d0ae(0x1ba)][_0xe7d0ae(0xe4)][_0xe7d0ae(0x14b)]({'where':{'telegramId':_0x1b8f73},'include':{'shop':!![]}});!_0x50be0c?(_0x50be0c=await database_1[_0xe7d0ae(0x1ba)][_0xe7d0ae(0xe4)][_0xe7d0ae(0xe2)]({'data':{'telegramId':_0x1b8f73,'username':_0x1f7499,'firstName':_0x308e69,'lastName':_0xa6fcaf,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0xe7d0ae(0x106)](_0xe7d0ae(0x14c)+_0x1b8f73+_0xe7d0ae(0x120)+_0x1f7499+')')):_0x50be0c=await database_1['default'][_0xe7d0ae(0xe4)][_0xe7d0ae(0x1a4)]({'where':{'telegramId':_0x1b8f73},'data':{'username':_0x1f7499,'firstName':_0x308e69,'lastName':_0xa6fcaf},'include':{'shop':!![]}}),_0x50be0c['isVerified']&&_0x50be0c['shopId']&&_0x50be0c[_0xe7d0ae(0x16d)]?await this[_0xe7d0ae(0x11c)]?.[_0xe7d0ae(0x108)](_0x21a0f6,'✅\x20Welcome\x20back!\x0a\x0a'+(_0xe7d0ae(0xe0)+_0x50be0c['shop'][_0xe7d0ae(0x14f)]+'*\x0a')+('Username:\x20`'+_0x50be0c[_0xe7d0ae(0x16d)][_0xe7d0ae(0x1c6)]+_0xe7d0ae(0x1a5))+_0xe7d0ae(0x1c5)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+_0xe7d0ae(0x13e)+_0xe7d0ae(0x17a)+_0xe7d0ae(0xe9)+_0xe7d0ae(0x101),{'parse_mode':'Markdown'}):(_0x50be0c[_0xe7d0ae(0x17f)]&&!_0x50be0c[_0xe7d0ae(0x165)]&&(await database_1['default'][_0xe7d0ae(0xe4)]['update']({'where':{'telegramId':_0x1b8f73},'data':{'shopId':null,'isVerified':![]}}),console[_0xe7d0ae(0x106)](_0xe7d0ae(0xf7)+_0x1b8f73)),await this[_0xe7d0ae(0x11c)]?.[_0xe7d0ae(0x108)](_0x21a0f6,_0xe7d0ae(0x18d)+_0xe7d0ae(0x1a9)+_0xe7d0ae(0x182)+_0xe7d0ae(0x131)+_0xe7d0ae(0x152)+_0xe7d0ae(0x12e),{'parse_mode':_0xe7d0ae(0xf9)}));}catch(_0x47fced){console[_0xe7d0ae(0x145)](_0xe7d0ae(0x15a),_0x47fced),await this[_0xe7d0ae(0x11c)]?.[_0xe7d0ae(0x108)](_0x21a0f6,_0xe7d0ae(0x12a));}}),this[_0x154159(0x11c)][_0x154159(0x18e)](/\/disconnect/,async _0xbe740=>{const _0x288f1e=_0x154159,_0x3db58a=_0xbe740[_0x288f1e(0x176)]['id'],_0x28223f=_0xbe740[_0x288f1e(0x118)]?.['id'][_0x288f1e(0x117)]();if(!_0x28223f)return;try{const _0x3cf5a1=await database_1[_0x288f1e(0x1ba)][_0x288f1e(0xe4)][_0x288f1e(0x14b)]({'where':{'telegramId':_0x28223f},'include':{'shop':!![]}});if(!_0x3cf5a1||!_0x3cf5a1[_0x288f1e(0x165)]||!_0x3cf5a1[_0x288f1e(0x17f)]){await this['bot']?.[_0x288f1e(0x108)](_0x3db58a,_0x288f1e(0x197));return;}const _0x2c4f98=_0x3cf5a1['shop']?.[_0x288f1e(0x14f)]||_0x288f1e(0x1ac);await database_1[_0x288f1e(0x1ba)]['telegramUser'][_0x288f1e(0x1a4)]({'where':{'telegramId':_0x28223f},'data':{'shopId':null,'isVerified':![]}}),console[_0x288f1e(0x106)](_0x288f1e(0x157)+_0x28223f+_0x288f1e(0x17d)+_0x3cf5a1[_0x288f1e(0x17f)]),await this['bot']?.[_0x288f1e(0x108)](_0x3db58a,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x2c4f98+_0x288f1e(0x12d)+_0x288f1e(0x122),{'parse_mode':'Markdown'});}catch(_0x433d8f){console['error'](_0x288f1e(0xe8),_0x433d8f),await this[_0x288f1e(0x11c)]?.['sendMessage'](_0x3db58a,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x154159(0x11c)][_0x154159(0x18e)](/\/status/,async _0x5ca6b1=>{const _0xaabf57=_0x154159,_0x285b88=_0x5ca6b1['chat']['id'],_0x2d04f7=_0x5ca6b1[_0xaabf57(0x118)]?.['id'][_0xaabf57(0x117)]();if(!_0x2d04f7)return;try{const _0x9b57b0=await database_1[_0xaabf57(0x1ba)]['telegramUser']['findUnique']({'where':{'telegramId':_0x2d04f7},'include':{'shop':!![]}});if(!_0x9b57b0){await this[_0xaabf57(0x11c)]?.[_0xaabf57(0x108)](_0x285b88,_0xaabf57(0x175)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x9b57b0[_0xaabf57(0x165)]||!_0x9b57b0['shopId']||!_0x9b57b0['shop']){await this[_0xaabf57(0x11c)]?.['sendMessage'](_0x285b88,_0xaabf57(0x17c)+_0xaabf57(0x149));return;}await this['bot']?.[_0xaabf57(0x108)](_0x285b88,_0xaabf57(0x1b8)+(_0xaabf57(0x137)+_0x9b57b0[_0xaabf57(0x16d)][_0xaabf57(0x14f)]+'*\x0a')+(_0xaabf57(0x171)+_0x9b57b0['shop']['username']+'`\x0a')+(_0xaabf57(0x1c3)+_0x9b57b0[_0xaabf57(0x151)]['toLocaleDateString'](_0xaabf57(0x125))+'\x0a\x0a')+_0xaabf57(0x1c0)+_0xaabf57(0x17a)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0xaabf57(0xf9)});}catch(_0x24c788){console[_0xaabf57(0x145)](_0xaabf57(0x129),_0x24c788),await this[_0xaabf57(0x11c)]?.[_0xaabf57(0x108)](_0x285b88,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x154159(0x11c)][_0x154159(0x18e)](/\/debug/,async _0x422ec3=>{const _0x3ff84f=_0x154159,_0x3f6a80=_0x422ec3[_0x3ff84f(0x176)]['id'],_0x44ab54=_0x422ec3[_0x3ff84f(0x118)]?.['id'][_0x3ff84f(0x117)]();if(!_0x44ab54)return;try{const _0x5210c9=await database_1['default'][_0x3ff84f(0x16d)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x27d3a2=_0x3ff84f(0x141);_0x27d3a2+=_0x3ff84f(0x18f)+_0x44ab54+_0x3ff84f(0x1a5),_0x27d3a2+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x5210c9[_0x3ff84f(0x136)]((_0x6d514c,_0x2df0c7)=>{const _0x559156=_0x3ff84f;_0x27d3a2+=_0x2df0c7+0x1+_0x559156(0x135)+_0x6d514c[_0x559156(0x14f)]+'*\x0a',_0x27d3a2+=_0x559156(0xe7)+_0x6d514c['username']+'`\x0a',_0x27d3a2+=_0x559156(0x1a1)+_0x6d514c[_0x559156(0x1a6)]+'\x0a',_0x27d3a2+=_0x559156(0xfa)+_0x6d514c[_0x559156(0x12b)][_0x559156(0x13f)](0x0,0xf)+_0x559156(0x190);}),await this['bot']?.['sendMessage'](_0x3f6a80,_0x27d3a2,{'parse_mode':_0x3ff84f(0xf9)});}catch(_0x5caadf){console[_0x3ff84f(0x145)](_0x3ff84f(0xf2),_0x5caadf),await this[_0x3ff84f(0x11c)]?.[_0x3ff84f(0x108)](_0x3f6a80,_0x3ff84f(0xf6));}}),this[_0x154159(0x11c)]['on'](_0x154159(0x164),async _0x23bc05=>{const _0x40bd9d=_0x154159;if(_0x23bc05[_0x40bd9d(0x1bb)]?.[_0x40bd9d(0xf4)]('/'))return;const _0x2100ae=_0x23bc05[_0x40bd9d(0x176)]['id'],_0x1e729d=_0x23bc05[_0x40bd9d(0x118)]?.['id'][_0x40bd9d(0x117)](),_0x3fc923=_0x23bc05['text']?.[_0x40bd9d(0x132)]();if(!_0x1e729d||!_0x3fc923)return;try{const _0x1f69f1=await database_1[_0x40bd9d(0x1ba)][_0x40bd9d(0xe4)][_0x40bd9d(0x14b)]({'where':{'telegramId':_0x1e729d},'include':{'shop':!![]}});if(!_0x1f69f1){await this[_0x40bd9d(0x11c)]?.[_0x40bd9d(0x108)](_0x2100ae,_0x40bd9d(0x107));return;}if(_0x1f69f1[_0x40bd9d(0x165)]&&_0x1f69f1[_0x40bd9d(0x17f)]&&_0x1f69f1[_0x40bd9d(0x16d)]){await this[_0x40bd9d(0x11c)]?.[_0x40bd9d(0x108)](_0x2100ae,_0x40bd9d(0x12c)+_0x1f69f1[_0x40bd9d(0x16d)]['name']+_0x40bd9d(0x12d)+_0x40bd9d(0x16f),{'parse_mode':_0x40bd9d(0xf9)});return;}const _0x3e95aa=_0x3fc923[_0x40bd9d(0x184)](/\s+/);if(_0x3e95aa[_0x40bd9d(0x173)]!==0x2){await this['bot']?.[_0x40bd9d(0x108)](_0x2100ae,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x40bd9d(0x182)+_0x40bd9d(0x131)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x40bd9d(0x167)+_0x3e95aa[_0x40bd9d(0x173)]+_0x40bd9d(0xdb)+_0x3e95aa['map'](_0x39549c=>'`'+_0x39549c+'`')['join'](',\x20')),{'parse_mode':_0x40bd9d(0xf9)});return;}const [_0x260fa7,_0x2f24db]=_0x3e95aa;console[_0x40bd9d(0x106)](_0x40bd9d(0x11a)+_0x1e729d+_0x40bd9d(0xf0)+_0x260fa7+_0x40bd9d(0x163)+_0x2f24db[_0x40bd9d(0x13f)](0x0,0xa)+'...\x22'),await this['handleSingleLineVerification'](_0x2100ae,_0x1e729d,_0x260fa7,_0x2f24db);}catch(_0x241a81){console[_0x40bd9d(0x145)](_0x40bd9d(0x126),_0x241a81),await this['bot']?.['sendMessage'](_0x2100ae,_0x40bd9d(0x12a));}}),this['bot']['on'](_0x154159(0x145),_0x3d3d0a=>{const _0xf3def2=_0x154159;console['error'](_0xf3def2(0xf5),_0x3d3d0a);}),this[_0x154159(0x11c)]['on'](_0x154159(0x16e),_0x2c2494=>{const _0x196367=_0x154159;console[_0x196367(0x145)]('Telegram\x20bot\x20polling\x20error:',_0x2c2494);});}async[a55_0x2c4a51(0xff)](_0x2b0bfe,_0x42b00d,_0x31d63e,_0x3a2cf4){const _0x267c97=a55_0x2c4a51;try{console['log'](_0x267c97(0x11a)+_0x42b00d+_0x267c97(0xf0)+_0x31d63e+_0x267c97(0x163)+_0x3a2cf4[_0x267c97(0x13f)](0x0,0xa)+_0x267c97(0x146));if(!_0x31d63e||_0x31d63e[_0x267c97(0x173)]<0x3||_0x31d63e['length']>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x31d63e)){await this[_0x267c97(0x11c)]?.['sendMessage'](_0x2b0bfe,_0x267c97(0x155)+_0x31d63e+_0x267c97(0x1a5)+_0x267c97(0x188),{'parse_mode':'Markdown'});return;}if(!_0x3a2cf4||!_0x3a2cf4[_0x267c97(0xf4)](_0x267c97(0x18c))&&!_0x3a2cf4[_0x267c97(0xf4)](_0x267c97(0x1a2))){await this[_0x267c97(0x11c)]?.[_0x267c97(0x108)](_0x2b0bfe,_0x267c97(0x196)+_0x267c97(0x10f),{'parse_mode':'Markdown'});return;}const _0x4250d3=await database_1[_0x267c97(0x1ba)][_0x267c97(0x16d)][_0x267c97(0x14b)]({'where':{'username':_0x31d63e},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x4250d3){const _0x1b216a=await database_1['default']['shop'][_0x267c97(0x103)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x37f6fc=_0x267c97(0x1bf)+_0x31d63e+_0x267c97(0x1b4);_0x1b216a[_0x267c97(0x173)]>0x0?(_0x37f6fc+=_0x267c97(0x17b),_0x1b216a[_0x267c97(0x136)](_0x57d403=>{const _0x3977db=_0x267c97;_0x37f6fc+=_0x3977db(0x1aa)+_0x57d403[_0x3977db(0x1c6)]+_0x3977db(0x1bd)+_0x57d403[_0x3977db(0x14f)]+')\x0a';}),_0x37f6fc+=_0x267c97(0xfe)):_0x37f6fc+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x267c97(0x11c)]?.['sendMessage'](_0x2b0bfe,_0x37f6fc,{'parse_mode':_0x267c97(0xf9)});return;}if(_0x4250d3[_0x267c97(0x1a6)]!==_0x267c97(0x13c)){await this['bot']?.[_0x267c97(0x108)](_0x2b0bfe,_0x267c97(0xe5)+_0x31d63e+'`\x20is\x20inactive.\x0a\x0a'+_0x267c97(0xe3),{'parse_mode':_0x267c97(0xf9)});return;}if(_0x4250d3[_0x267c97(0x12b)]!==_0x3a2cf4&&_0x4250d3[_0x267c97(0x11d)]!==_0x3a2cf4){await this[_0x267c97(0x11c)]?.[_0x267c97(0x108)](_0x2b0bfe,_0x267c97(0x13b)+_0x31d63e+_0x267c97(0x170)+_0x267c97(0x1a0)+_0x267c97(0x104),{'parse_mode':_0x267c97(0xf9)});return;}const _0x5b7456=await database_1[_0x267c97(0x1ba)][_0x267c97(0xe4)][_0x267c97(0x144)]({'where':{'shopId':_0x4250d3['id'],'isVerified':!![],'telegramId':{'not':_0x42b00d}}});if(_0x5b7456){await this[_0x267c97(0x11c)]?.['sendMessage'](_0x2b0bfe,_0x267c97(0x112)+_0x31d63e+'`.\x0a\x0a'+_0x267c97(0x11b),{'parse_mode':_0x267c97(0xf9)});return;}await database_1[_0x267c97(0x1ba)]['telegramUser'][_0x267c97(0x1a4)]({'where':{'telegramId':_0x42b00d},'data':{'shopId':_0x4250d3['id'],'isVerified':!![]}}),await this[_0x267c97(0x11c)]?.[_0x267c97(0x108)](_0x2b0bfe,_0x267c97(0xe6)+_0x267c97(0x174)+('📱\x20Shop:\x20*'+_0x4250d3[_0x267c97(0x14f)]+'*\x0a')+('👤\x20Username:\x20`'+_0x4250d3[_0x267c97(0x1c6)]+_0x267c97(0x1a5))+_0x267c97(0x161)+_0x267c97(0x15e)+_0x267c97(0xfc)+_0x267c97(0x1a7)+_0x267c97(0x159)+_0x267c97(0x17a)+'/status\x20-\x20check\x20connection\x20status\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x267c97(0xf9)}),console[_0x267c97(0x106)]('✅\x20Telegram\x20user\x20'+_0x42b00d+_0x267c97(0x192)+_0x4250d3['username']+'\x20via\x20single-line\x20input');}catch(_0x2b7a7d){console[_0x267c97(0x145)]('Error\x20in\x20handleSingleLineVerification:',_0x2b7a7d),await this[_0x267c97(0x11c)]?.[_0x267c97(0x108)](_0x2b0bfe,_0x267c97(0x180));}}async[a55_0x2c4a51(0x130)](_0x1bf1fe,_0x4dbb13,_0x90b2b6){const _0x2a9ef0=a55_0x2c4a51;if(!this[_0x2a9ef0(0x11c)]){console[_0x2a9ef0(0x199)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x22079e=await database_1[_0x2a9ef0(0x1ba)][_0x2a9ef0(0xe4)][_0x2a9ef0(0x103)]({'where':{'shopId':_0x1bf1fe,'isVerified':!![]}});if(_0x22079e[_0x2a9ef0(0x173)]===0x0){console[_0x2a9ef0(0x106)](_0x2a9ef0(0x168)+_0x1bf1fe);return;}const _0x22b6e3=_0x22079e['map'](async _0x498fd5=>{const _0x411901=_0x2a9ef0;try{await this['bot']?.[_0x411901(0x108)](_0x498fd5['telegramId'],_0x4dbb13,_0x90b2b6),console['log'](_0x411901(0x169)+_0x498fd5[_0x411901(0x10c)]);}catch(_0x12461a){console[_0x411901(0x145)](_0x411901(0x119)+_0x498fd5['telegramId']+':',_0x12461a),_0x12461a instanceof Error&&(_0x12461a[_0x411901(0x164)][_0x411901(0x162)](_0x411901(0x14a))||_0x12461a[_0x411901(0x164)][_0x411901(0x162)](_0x411901(0x115))||_0x12461a['message']['includes']('user\x20is\x20deactivated'))&&(await database_1['default']['telegramUser'][_0x411901(0x1a4)]({'where':{'id':_0x498fd5['id']},'data':{'isVerified':![]}}),console[_0x411901(0x106)](_0x411901(0x186)+_0x498fd5['telegramId']+_0x411901(0x128)));}});await Promise[_0x2a9ef0(0x124)](_0x22b6e3);}catch(_0x5456d3){console[_0x2a9ef0(0x145)](_0x2a9ef0(0x114),_0x5456d3);}}async['sendPaymentNotification'](_0x373e9d,_0x5bb7de,_0x534007){const _0x21f31d=a55_0x2c4a51,_0x32be7e={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x109743={'created':'New\x20payment\x20created','paid':_0x21f31d(0x140),'failed':_0x21f31d(0x134),'expired':'Payment\x20expired','refund':_0x21f31d(0x1b3),'chargeback':_0x21f31d(0x133),'processing':_0x21f31d(0x185)},_0xf9c9c1=_0x32be7e[_0x534007],_0x2cae18=_0x109743[_0x534007],_0x183a0f=(0x0,gateway_1[_0x21f31d(0x179)])(_0x5bb7de[_0x21f31d(0x111)]);console[_0x21f31d(0x106)](_0x21f31d(0x10b)+_0x5bb7de[_0x21f31d(0x111)]+'\x22\x20->\x20display\x20\x22'+_0x183a0f+'\x22');let _0xb79c77=_0xf9c9c1+'\x20*'+_0x2cae18+_0x21f31d(0x16a)+(_0x21f31d(0x11f)+_0x5bb7de[_0x21f31d(0x1c1)]+'\x20'+_0x5bb7de['currency']+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x5bb7de[_0x21f31d(0xda)]||_0x5bb7de['id'])+'`\x0a')+(_0x21f31d(0xfb)+_0x5bb7de['id']+'`\x0a')+(_0x21f31d(0x127)+_0x183a0f+'`\x0a')+(_0x21f31d(0x116)+new Date(_0x5bb7de[_0x21f31d(0x15c)])[_0x21f31d(0x16c)]('en-US')+'\x0a');if(_0x5bb7de[_0x21f31d(0x198)]||_0x5bb7de['customerEmail']||_0x5bb7de[_0x21f31d(0xdd)]||_0x5bb7de['customerIp']||_0x5bb7de[_0x21f31d(0x178)]){_0xb79c77+=_0x21f31d(0x1ad);_0x5bb7de['customerName']&&(_0xb79c77+='📛\x20Name:\x20`'+_0x5bb7de['customerName']+'`\x0a');_0x5bb7de[_0x21f31d(0x121)]&&(_0xb79c77+=_0x21f31d(0x105)+_0x5bb7de['customerEmail']+'`\x0a');_0x5bb7de[_0x21f31d(0xdd)]&&(_0xb79c77+=_0x21f31d(0x10a)+_0x5bb7de[_0x21f31d(0xdd)]+'`\x0a');_0x5bb7de[_0x21f31d(0xdc)]&&(_0xb79c77+='🌐\x20IP:\x20`'+_0x5bb7de[_0x21f31d(0xdc)]+'`\x0a');if(_0x5bb7de[_0x21f31d(0x178)]){const _0x26c560=_0x5bb7de[_0x21f31d(0x178)][_0x21f31d(0x173)]>0x32?_0x5bb7de[_0x21f31d(0x178)]['substring'](0x0,0x32)+_0x21f31d(0x194):_0x5bb7de[_0x21f31d(0x178)];_0xb79c77+=_0x21f31d(0xeb)+_0x26c560+'`\x0a';}}_0x534007===_0x21f31d(0x1a8)&&_0x5bb7de[_0x21f31d(0xed)]&&(_0xb79c77+='💸\x20Penalty\x20amount:\x20*'+_0x5bb7de['chargebackAmount']+'\x20USDT*\x0a'),_0x534007===_0x21f31d(0x13d)&&(_0xb79c77+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x5bb7de['adminNotes']&&(_0xb79c77+=_0x21f31d(0x147)+_0x5bb7de['adminNotes']+'\x0a'),await this[_0x21f31d(0x130)](_0x373e9d,_0xb79c77,{'parse_mode':_0x21f31d(0xf9)});}async[a55_0x2c4a51(0x109)](_0x14dad0,_0x9d878d,_0x18489e){const _0x1d0b4a=a55_0x2c4a51,_0x3cf6e0={'created':'📤','completed':'✅','rejected':'❌'},_0x3a9d58={'created':_0x1d0b4a(0x148),'completed':_0x1d0b4a(0x19f),'rejected':_0x1d0b4a(0x1b6)},_0x5ce25e=_0x3cf6e0[_0x18489e],_0xf09c0f=_0x3a9d58[_0x18489e],_0x13b6cf=_0x5ce25e+'\x20*'+_0xf09c0f+_0x1d0b4a(0x16a)+('💸\x20Amount:\x20*'+_0x9d878d[_0x1d0b4a(0x1c1)]+_0x1d0b4a(0x1ab))+(_0x1d0b4a(0x156)+_0x9d878d[_0x1d0b4a(0x1ae)]+'`\x0a')+(_0x1d0b4a(0x1c2)+_0x9d878d['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x9d878d['createdAt'])[_0x1d0b4a(0x16c)](_0x1d0b4a(0x125))+'\x0a')+(_0x9d878d[_0x1d0b4a(0xde)]?'🔗\x20TXID:\x20`'+_0x9d878d[_0x1d0b4a(0xde)]+'`':'');await this[_0x1d0b4a(0x130)](_0x14dad0,_0x13b6cf,{'parse_mode':_0x1d0b4a(0xf9)});}async[a55_0x2c4a51(0x18a)](_0xb494c0,_0xd0b163){const _0x232960=a55_0x2c4a51;try{const _0x156b01=await database_1['default'][_0x232960(0x150)]['findUnique']({'where':{'shopId':_0xb494c0},'select':{'notificationLogin':!![]}});if(!_0x156b01?.[_0x232960(0x15f)]){console['log'](_0x232960(0x189)+_0xb494c0);return;}const _0x451dc3=_0xd0b163[_0x232960(0x1bc)]?'🔐':'🚨',_0x3ecc71=_0xd0b163[_0x232960(0x1bc)]?_0x232960(0x17e):'Failed\x20login\x20attempt';let _0x5d9363=_0x451dc3+'\x20*'+_0x3ecc71+_0x232960(0x16a)+(_0x232960(0x171)+_0xd0b163['username']+'`\x0a')+(_0x232960(0x195)+_0xd0b163[_0x232960(0x13a)][_0x232960(0x16c)]('en-US')+'\x0a');_0xd0b163[_0x232960(0x177)]&&(_0x5d9363+=_0x232960(0x143)+_0xd0b163[_0x232960(0x177)]+'`\x0a');if(_0xd0b163[_0x232960(0x1b9)]){const _0x348c0f=_0xd0b163[_0x232960(0x1b9)][_0x232960(0x173)]>0x32?_0xd0b163[_0x232960(0x1b9)][_0x232960(0x13f)](0x0,0x32)+_0x232960(0x194):_0xd0b163['userAgent'];_0x5d9363+=_0x232960(0xeb)+_0x348c0f+'`\x0a';}!_0xd0b163[_0x232960(0x1bc)]&&(_0x5d9363+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x232960(0x130)](_0xb494c0,_0x5d9363,{'parse_mode':_0x232960(0xf9)}),console[_0x232960(0x106)](_0x232960(0x12f)+_0xb494c0+':\x20'+(_0xd0b163[_0x232960(0x1bc)]?'success':_0x232960(0x160)));}catch(_0x450640){console[_0x232960(0x145)](_0x232960(0x102),_0x450640);}}async[a55_0x2c4a51(0x193)](_0x29ee0b,_0x3b0fdf){const _0x514f21=a55_0x2c4a51;try{const _0x3cbebe=await database_1[_0x514f21(0x1ba)]['shopSettings'][_0x514f21(0x14b)]({'where':{'shopId':_0x29ee0b},'select':{'notificationApiError':!![]}});if(!_0x3cbebe?.[_0x514f21(0x172)]){console['log'](_0x514f21(0xee)+_0x29ee0b);return;}let _0x3e42a7=_0x514f21(0x1c4)+(_0x514f21(0x113)+_0x3b0fdf[_0x514f21(0x1ae)]+'\x20'+_0x3b0fdf[_0x514f21(0xef)]+'`\x0a')+(_0x514f21(0x195)+_0x3b0fdf['timestamp']['toLocaleString'](_0x514f21(0x125))+'\x0a');_0x3b0fdf[_0x514f21(0x154)]&&(_0x3e42a7+=_0x514f21(0x18b)+_0x3b0fdf[_0x514f21(0x154)]+'`\x0a'),_0x3e42a7+=_0x514f21(0x1b5)+_0x3b0fdf[_0x514f21(0x138)]+'`\x0a',_0x3b0fdf['requestId']&&(_0x3e42a7+=_0x514f21(0x100)+_0x3b0fdf[_0x514f21(0x19a)]+'`\x0a'),_0x3e42a7+=_0x514f21(0x14e),await this[_0x514f21(0x130)](_0x29ee0b,_0x3e42a7,{'parse_mode':_0x514f21(0xf9)}),console[_0x514f21(0x106)](_0x514f21(0xdf)+_0x29ee0b+':\x20'+_0x3b0fdf['endpoint']);}catch(_0x1a5d17){console[_0x514f21(0x145)](_0x514f21(0x153),_0x1a5d17);}}async[a55_0x2c4a51(0x19e)](_0x45f6cf,_0xe7b49b,_0x27caed){const _0x4c2a55=a55_0x2c4a51;let _0x121211=_0x4c2a55(0x14d)+_0xe7b49b+'*\x0a\x0a';for(const [_0x5f14b3,_0x378f1f]of Object[_0x4c2a55(0x1af)](_0x27caed)){_0x378f1f!==null&&_0x378f1f!==undefined&&(_0x121211+=_0x5f14b3+_0x4c2a55(0x123)+_0x378f1f+'`\x0a');}await this[_0x4c2a55(0x130)](_0x45f6cf,_0x121211,{'parse_mode':_0x4c2a55(0xf9)});}[a55_0x2c4a51(0x158)](){const _0x1c01ef=a55_0x2c4a51;return{'isActive':!!this['bot'],'username':this[_0x1c01ef(0x15b)]};}[a55_0x2c4a51(0x1b2)](){const _0x2df22f=a55_0x2c4a51;this[_0x2df22f(0x11c)]&&(this['bot'][_0x2df22f(0xea)](),this[_0x2df22f(0x11c)]=null,console[_0x2df22f(0x106)](_0x2df22f(0x10e)));}}exports[a55_0x2c4a51(0xf3)]=TelegramBotService,exports[a55_0x2c4a51(0x142)]=new TelegramBotService();