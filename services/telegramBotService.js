'use strict';const a54_0x2ab0bd=a54_0x45ae;(function(_0x307582,_0x2da03c){const _0x323c4f=a54_0x45ae,_0x12b486=_0x307582();while(!![]){try{const _0x232231=parseInt(_0x323c4f(0x14c))/0x1+-parseInt(_0x323c4f(0x151))/0x2*(parseInt(_0x323c4f(0x121))/0x3)+-parseInt(_0x323c4f(0x148))/0x4*(parseInt(_0x323c4f(0x154))/0x5)+parseInt(_0x323c4f(0x123))/0x6+-parseInt(_0x323c4f(0xf6))/0x7+parseInt(_0x323c4f(0x140))/0x8*(-parseInt(_0x323c4f(0x167))/0x9)+-parseInt(_0x323c4f(0xa9))/0xa*(-parseInt(_0x323c4f(0x16f))/0xb);if(_0x232231===_0x2da03c)break;else _0x12b486['push'](_0x12b486['shift']());}catch(_0x112803){_0x12b486['push'](_0x12b486['shift']());}}}(a54_0x6aa2,0x583eb));function a54_0x6aa2(){const _0x2849a8=['🎉\x20*Congratulations!*\x0a\x0a','node-telegram-bot-api','\x20(@','Example:\x0a','🔔\x20Notifications\x20are\x20active\x0a\x0a','\x20initialized\x20successfully','sk_','❌\x20Shop\x20`','forEach','statusCode','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','👤\x20Username:\x20`','../types/gateway','2183160HnpgnF','handleSingleLineVerification','...\x22','🛑\x20Telegram\x20bot\x20stopped','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','•\x20Payouts\x0a','updatedAt','*.\x0a\x0a','length','shopSettings','create','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','Failed\x20login\x20attempt','Error\x20handling\x20/start\x20command:','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','toLocaleString','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','\x20verified\x20for\x20shop\x20','/disconnect\x20-\x20disconnect\x20from\x20notifications','shop','requestId','📱\x20Created\x20new\x20Telegram\x20user:\x20','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','sendPayoutNotification','__esModule','...','🌐\x20IP\x20address:\x20`','findFirst','error','Payment\x20failed','User\x20','stopPolling','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','__importDefault','secretKey','\x20USDT*\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a',':\x20`','\x20disconnected\x20from\x20shop\x20','botUsername','unknown\x20shop','💸\x20Penalty\x20amount:\x20*','sendShopNotification','3ytXmIz','🏪\x20Gateway:\x20`','1714932VAFGNJ','🔌\x20User\x20','Error\x20handling\x20message:','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','📅\x20Connection\x20date:\x20','update','adminNotes','isVerified','log','initializeBot','Check\x20spelling\x20and\x20try\x20again.','🆔\x20Payment\x20ID:\x20`','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','endpoint','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','status','notificationApiError','Payout\x20rejected','sendCustomNotification','•\x20Payouts\x0a\x0a','Telegram\x20bot\x20error:','sendMessage','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','\x20\x20\x20Username:\x20`','\x20\x20\x20Status:\x20','success','bot','40bYOtGn','❌\x20Please\x20use\x20/start\x20command\x20first',':\x20username=\x22','\x20\x20\x20Public\x20Key:\x20`','🚨\x20*API\x20Error*\x0a\x0a','user\x20is\x20deactivated','default','🔔\x20You\x20receive\x20notifications\x20about:\x0a','28tMMUrF','userAgent','gateway','💻\x20Browser:\x20`','376850Wsvxdz','sendLoginNotification','name','📊\x20*Connection\x20Status*\x0a\x0a','Available\x20usernames:\x0a','556094hCSRxq','stopBot','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','144545MUlQYT','findUnique','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','Telegram\x20bot\x20polling\x20error:','env','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','📅\x20Time:\x20','❌\x20Error:\x20`','Error\x20sending\x20shop\x20notification:','`\x20(','failed','sendApiErrorNotification','join','✅\x20Connected\x20to\x20shop:\x20*','message','notificationLogin','Commands:\x0a','timestamp','52713LABmjW','toLocaleDateString','\x20via\x20single-line\x20input','telegramUser','Payment\x20successfully\x20paid','customerEmail','startsWith','processing','583TywlGX','substring','`\x0a\x0a','•\x20Payment\x20status\x20changes\x0a','Payment\x20refund','setupBotHandlers','telegramBotService','sendPaymentNotification','includes','Markdown','TelegramBotService','📛\x20Name:\x20`','polling_error','shopId','📧\x20Email:\x20`','98180ScCSTe','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','chat','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','❌\x20Error\x20getting\x20debug\x20information.','warn','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','🔍\x20*Debug\x20Information*\x0a\x0a','\x22\x20->\x20display\x20\x22','defineProperty','entries','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','last_name','findMany','currency','To\x20reconnect,\x20use\x20the\x20/start\x20command','Successful\x20login','split','`.\x0a\x0a','method','Error\x20handling\x20/disconnect\x20command:','toString','pk_','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','\x20parts:\x20','publicKey','allSettled','•\x20Important\x20events\x0a\x0a','amount','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','*\x0a\x0a','from','map','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','.\x20*','first_name','username','TELEGRAM_BOT_USERNAME','onText','\x22,\x20apiKey=\x22','chargebackAmount','Failed\x20to\x20send\x20login\x20notification:','•\x20`','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Payout\x20completed','text','`\x20not\x20found.\x0a\x0a','•\x20New\x20payments\x0a','en-US','🔔\x20*','Contact\x20administrator.','📝\x20Order\x20ID:\x20`','Error\x20in\x20handleSingleLineVerification:','createdAt','You\x20sent\x20','errorMessage','New\x20payment\x20created','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','telegramId','botToken','`\x20is\x20inactive.\x0a\x0a','customerName'];a54_0x6aa2=function(){return _0x2849a8;};return a54_0x6aa2();}var __importDefault=this&&this[a54_0x2ab0bd(0x117)]||function(_0x181790){return _0x181790&&_0x181790['__esModule']?_0x181790:{'default':_0x181790};};function a54_0x45ae(_0x5661fa,_0x2b5182){const _0x6aa293=a54_0x6aa2();return a54_0x45ae=function(_0x45ae8f,_0x2f0b9c){_0x45ae8f=_0x45ae8f-0xa1;let _0x573ad8=_0x6aa293[_0x45ae8f];return _0x573ad8;},a54_0x45ae(_0x5661fa,_0x2b5182);}Object[a54_0x2ab0bd(0xb2)](exports,a54_0x2ab0bd(0x10e),{'value':!![]}),exports[a54_0x2ab0bd(0x175)]=exports[a54_0x2ab0bd(0xa4)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x2ab0bd(0xea))),database_1=__importDefault(require('../config/database')),gateway_1=require(a54_0x2ab0bd(0xf5));class TelegramBotService{constructor(){const _0x616df0=a54_0x2ab0bd;this[_0x616df0(0x13f)]=null,this['botToken']=process[_0x616df0(0x158)]['TELEGRAM_BOT_TOKEN']||'',this[_0x616df0(0x11d)]=process[_0x616df0(0x158)][_0x616df0(0xcf)]||'trapay_bot',this['botToken']?this['initializeBot']():console[_0x616df0(0xae)](_0x616df0(0x10c));}[a54_0x2ab0bd(0x12c)](){const _0x2d9d46=a54_0x2ab0bd;try{this['bot']=new node_telegram_bot_api_1[(_0x2d9d46(0x146))](this[_0x2d9d46(0xe6)],{'polling':!![]}),this[_0x2d9d46(0x174)](),console['log']('✅\x20Telegram\x20bot\x20@'+this[_0x2d9d46(0x11d)]+_0x2d9d46(0xee));}catch(_0x2446a3){console[_0x2d9d46(0x112)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x2446a3);}}['setupBotHandlers'](){const _0x47b5c5=a54_0x2ab0bd;if(!this[_0x47b5c5(0x13f)])return;this[_0x47b5c5(0x13f)][_0x47b5c5(0xd0)](/\/start/,async _0x5764a5=>{const _0x3624ae=_0x47b5c5,_0x1d5398=_0x5764a5['chat']['id'],_0x199f0f=_0x5764a5[_0x3624ae(0xc9)]?.['id'][_0x3624ae(0xbe)](),_0x5f5601=_0x5764a5['from']?.[_0x3624ae(0xce)],_0x8bffea=_0x5764a5[_0x3624ae(0xc9)]?.[_0x3624ae(0xcd)],_0x45a71a=_0x5764a5['from']?.[_0x3624ae(0xb5)];if(!_0x199f0f)return;try{let _0x5229d8=await database_1['default'][_0x3624ae(0x16a)][_0x3624ae(0x155)]({'where':{'telegramId':_0x199f0f},'include':{'shop':!![]}});!_0x5229d8?(_0x5229d8=await database_1[_0x3624ae(0x146)][_0x3624ae(0x16a)][_0x3624ae(0x100)]({'data':{'telegramId':_0x199f0f,'username':_0x5f5601,'firstName':_0x8bffea,'lastName':_0x45a71a,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x3624ae(0x12b)](_0x3624ae(0x10b)+_0x199f0f+_0x3624ae(0xeb)+_0x5f5601+')')):_0x5229d8=await database_1[_0x3624ae(0x146)][_0x3624ae(0x16a)][_0x3624ae(0x128)]({'where':{'telegramId':_0x199f0f},'data':{'username':_0x5f5601,'firstName':_0x8bffea,'lastName':_0x45a71a},'include':{'shop':!![]}}),_0x5229d8[_0x3624ae(0x12a)]&&_0x5229d8[_0x3624ae(0xa7)]&&_0x5229d8[_0x3624ae(0x109)]?await this['bot']?.['sendMessage'](_0x1d5398,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x3624ae(0x159)+_0x5229d8[_0x3624ae(0x109)][_0x3624ae(0x14e)]+'*\x0a')+('Username:\x20`'+_0x5229d8['shop'][_0x3624ae(0xce)]+_0x3624ae(0x171))+_0x3624ae(0x147)+_0x3624ae(0xd9)+_0x3624ae(0x172)+_0x3624ae(0x138)+_0x3624ae(0x165)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x3624ae(0x108),{'parse_mode':_0x3624ae(0xa3)}):(_0x5229d8[_0x3624ae(0xa7)]&&!_0x5229d8[_0x3624ae(0x12a)]&&(await database_1[_0x3624ae(0x146)]['telegramUser'][_0x3624ae(0x128)]({'where':{'telegramId':_0x199f0f},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x199f0f)),await this[_0x3624ae(0x13f)]?.[_0x3624ae(0x13a)](_0x1d5398,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x3624ae(0xac)+_0x3624ae(0xec)+_0x3624ae(0xb4)+_0x3624ae(0x153),{'parse_mode':_0x3624ae(0xa3)}));}catch(_0x595b29){console[_0x3624ae(0x112)](_0x3624ae(0x103),_0x595b29),await this[_0x3624ae(0x13f)]?.[_0x3624ae(0x13a)](_0x1d5398,_0x3624ae(0x116));}}),this[_0x47b5c5(0x13f)]['onText'](/\/disconnect/,async _0xa189a0=>{const _0x47ce60=_0x47b5c5,_0x1c4036=_0xa189a0['chat']['id'],_0x3fa142=_0xa189a0[_0x47ce60(0xc9)]?.['id'][_0x47ce60(0xbe)]();if(!_0x3fa142)return;try{const _0x2bb972=await database_1[_0x47ce60(0x146)][_0x47ce60(0x16a)][_0x47ce60(0x155)]({'where':{'telegramId':_0x3fa142},'include':{'shop':!![]}});if(!_0x2bb972||!_0x2bb972[_0x47ce60(0x12a)]||!_0x2bb972[_0x47ce60(0xa7)]){await this[_0x47ce60(0x13f)]?.['sendMessage'](_0x1c4036,_0x47ce60(0xe4));return;}const _0x555628=_0x2bb972[_0x47ce60(0x109)]?.[_0x47ce60(0x14e)]||_0x47ce60(0x11e);await database_1['default'][_0x47ce60(0x16a)][_0x47ce60(0x128)]({'where':{'telegramId':_0x3fa142},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x47ce60(0x124)+_0x3fa142+_0x47ce60(0x11c)+_0x2bb972[_0x47ce60(0xa7)]),await this[_0x47ce60(0x13f)]?.[_0x47ce60(0x13a)](_0x1c4036,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x555628+'*.\x0a\x0a'+_0x47ce60(0xb8),{'parse_mode':_0x47ce60(0xa3)});}catch(_0x47a66d){console['error'](_0x47ce60(0xbd),_0x47a66d),await this[_0x47ce60(0x13f)]?.[_0x47ce60(0x13a)](_0x1c4036,_0x47ce60(0x116));}}),this['bot']['onText'](/\/status/,async _0x184337=>{const _0x4c3607=_0x47b5c5,_0x33dcbf=_0x184337['chat']['id'],_0x4f448b=_0x184337[_0x4c3607(0xc9)]?.['id'][_0x4c3607(0xbe)]();if(!_0x4f448b)return;try{const _0x43ad6b=await database_1[_0x4c3607(0x146)]['telegramUser'][_0x4c3607(0x155)]({'where':{'telegramId':_0x4f448b},'include':{'shop':!![]}});if(!_0x43ad6b){await this[_0x4c3607(0x13f)]?.[_0x4c3607(0x13a)](_0x33dcbf,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+'Use\x20/start\x20to\x20begin.');return;}if(!_0x43ad6b[_0x4c3607(0x12a)]||!_0x43ad6b['shopId']||!_0x43ad6b[_0x4c3607(0x109)]){await this[_0x4c3607(0x13f)]?.[_0x4c3607(0x13a)](_0x33dcbf,_0x4c3607(0x11a)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x4c3607(0x13f)]?.[_0x4c3607(0x13a)](_0x33dcbf,_0x4c3607(0x14f)+(_0x4c3607(0x162)+_0x43ad6b[_0x4c3607(0x109)][_0x4c3607(0x14e)]+'*\x0a')+(_0x4c3607(0xf4)+_0x43ad6b[_0x4c3607(0x109)][_0x4c3607(0xce)]+'`\x0a')+(_0x4c3607(0x127)+_0x43ad6b[_0x4c3607(0xfc)][_0x4c3607(0x168)](_0x4c3607(0xda))+'\x0a\x0a')+_0x4c3607(0xed)+'Commands:\x0a'+_0x4c3607(0x108),{'parse_mode':_0x4c3607(0xa3)});}catch(_0x405ff9){console[_0x4c3607(0x112)]('Error\x20handling\x20/status\x20command:',_0x405ff9),await this[_0x4c3607(0x13f)]?.[_0x4c3607(0x13a)](_0x33dcbf,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x47b5c5(0x13f)][_0x47b5c5(0xd0)](/\/debug/,async _0x139a91=>{const _0x559780=_0x47b5c5,_0x26435b=_0x139a91[_0x559780(0xab)]['id'],_0xe354c2=_0x139a91[_0x559780(0xc9)]?.['id'][_0x559780(0xbe)]();if(!_0xe354c2)return;try{const _0x14e245=await database_1['default'][_0x559780(0x109)][_0x559780(0xb6)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x5ae933=_0x559780(0xb0);_0x5ae933+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0xe354c2+_0x559780(0x171),_0x5ae933+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x14e245[_0x559780(0xf1)]((_0x465f97,_0x16c069)=>{const _0x49be38=_0x559780;_0x5ae933+=_0x16c069+0x1+_0x49be38(0xcc)+_0x465f97[_0x49be38(0x14e)]+'*\x0a',_0x5ae933+=_0x49be38(0x13c)+_0x465f97[_0x49be38(0xce)]+'`\x0a',_0x5ae933+=_0x49be38(0x13d)+_0x465f97[_0x49be38(0x134)]+'\x0a',_0x5ae933+=_0x49be38(0x143)+_0x465f97[_0x49be38(0xc2)][_0x49be38(0x170)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x559780(0x13f)]?.[_0x559780(0x13a)](_0x26435b,_0x5ae933,{'parse_mode':_0x559780(0xa3)});}catch(_0x5e8957){console[_0x559780(0x112)]('Error\x20handling\x20/debug\x20command:',_0x5e8957),await this[_0x559780(0x13f)]?.[_0x559780(0x13a)](_0x26435b,_0x559780(0xad));}}),this[_0x47b5c5(0x13f)]['on']('message',async _0x5dc45f=>{const _0x48d868=_0x47b5c5;if(_0x5dc45f['text']?.[_0x48d868(0x16d)]('/'))return;const _0xb2ebcf=_0x5dc45f[_0x48d868(0xab)]['id'],_0x2e276f=_0x5dc45f[_0x48d868(0xc9)]?.['id'][_0x48d868(0xbe)](),_0x3513e2=_0x5dc45f[_0x48d868(0xd7)]?.['trim']();if(!_0x2e276f||!_0x3513e2)return;try{const _0x4160f6=await database_1[_0x48d868(0x146)][_0x48d868(0x16a)][_0x48d868(0x155)]({'where':{'telegramId':_0x2e276f},'include':{'shop':!![]}});if(!_0x4160f6){await this[_0x48d868(0x13f)]?.['sendMessage'](_0xb2ebcf,_0x48d868(0x141));return;}if(_0x4160f6[_0x48d868(0x12a)]&&_0x4160f6[_0x48d868(0xa7)]&&_0x4160f6[_0x48d868(0x109)]){await this[_0x48d868(0x13f)]?.['sendMessage'](_0xb2ebcf,_0x48d868(0xd5)+_0x4160f6[_0x48d868(0x109)][_0x48d868(0x14e)]+_0x48d868(0xfd)+_0x48d868(0x101),{'parse_mode':_0x48d868(0xa3)});return;}const _0x798f0d=_0x3513e2[_0x48d868(0xba)](/\s+/);if(_0x798f0d[_0x48d868(0xfe)]!==0x2){await this[_0x48d868(0x13f)]?.[_0x48d868(0x13a)](_0xb2ebcf,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x48d868(0xac)+_0x48d868(0xec)+_0x48d868(0xb4)+(_0x48d868(0xe0)+_0x798f0d[_0x48d868(0xfe)]+_0x48d868(0xc1)+_0x798f0d[_0x48d868(0xca)](_0x4ca575=>'`'+_0x4ca575+'`')[_0x48d868(0x161)](',\x20')),{'parse_mode':_0x48d868(0xa3)});return;}const [_0x2b4b67,_0x2c9506]=_0x798f0d;console[_0x48d868(0x12b)](_0x48d868(0x131)+_0x2e276f+':\x20username=\x22'+_0x2b4b67+_0x48d868(0xd1)+_0x2c9506[_0x48d868(0x170)](0x0,0xa)+_0x48d868(0xf8)),await this[_0x48d868(0xf7)](_0xb2ebcf,_0x2e276f,_0x2b4b67,_0x2c9506);}catch(_0x1efc91){console[_0x48d868(0x112)](_0x48d868(0x125),_0x1efc91),await this[_0x48d868(0x13f)]?.[_0x48d868(0x13a)](_0xb2ebcf,_0x48d868(0x116));}}),this['bot']['on'](_0x47b5c5(0x112),_0x37e0c2=>{const _0x11c211=_0x47b5c5;console[_0x11c211(0x112)](_0x11c211(0x139),_0x37e0c2);}),this['bot']['on'](_0x47b5c5(0xa6),_0x42453b=>{const _0x2f82b5=_0x47b5c5;console[_0x2f82b5(0x112)](_0x2f82b5(0x157),_0x42453b);});}async[a54_0x2ab0bd(0xf7)](_0x557c4e,_0x264027,_0x3e4531,_0x199345){const _0xf4c921=a54_0x2ab0bd;try{console[_0xf4c921(0x12b)](_0xf4c921(0x131)+_0x264027+_0xf4c921(0x142)+_0x3e4531+_0xf4c921(0xd1)+_0x199345[_0xf4c921(0x170)](0x0,0xa)+_0xf4c921(0xf8));if(!_0x3e4531||_0x3e4531[_0xf4c921(0xfe)]<0x3||_0x3e4531['length']>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x3e4531)){await this[_0xf4c921(0x13f)]?.['sendMessage'](_0x557c4e,'❌\x20Invalid\x20username\x20format:\x20`'+_0x3e4531+_0xf4c921(0x171)+_0xf4c921(0xaa),{'parse_mode':_0xf4c921(0xa3)});return;}if(!_0x199345||!_0x199345['startsWith'](_0xf4c921(0xbf))&&!_0x199345['startsWith'](_0xf4c921(0xef))){await this[_0xf4c921(0x13f)]?.[_0xf4c921(0x13a)](_0x557c4e,_0xf4c921(0xe3)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0xf4c921(0xa3)});return;}const _0xb396fb=await database_1[_0xf4c921(0x146)]['shop'][_0xf4c921(0x155)]({'where':{'username':_0x3e4531},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0xb396fb){const _0x5d6d98=await database_1[_0xf4c921(0x146)][_0xf4c921(0x109)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x300fb4='❌\x20Shop\x20with\x20username\x20`'+_0x3e4531+_0xf4c921(0xd8);_0x5d6d98[_0xf4c921(0xfe)]>0x0?(_0x300fb4+=_0xf4c921(0x150),_0x5d6d98['forEach'](_0x2ce6c1=>{const _0x47dc79=_0xf4c921;_0x300fb4+=_0x47dc79(0xd4)+_0x2ce6c1['username']+_0x47dc79(0x15e)+_0x2ce6c1[_0x47dc79(0x14e)]+')\x0a';}),_0x300fb4+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x300fb4+=_0xf4c921(0x12d);await this['bot']?.[_0xf4c921(0x13a)](_0x557c4e,_0x300fb4,{'parse_mode':_0xf4c921(0xa3)});return;}if(_0xb396fb[_0xf4c921(0x134)]!=='ACTIVE'){await this[_0xf4c921(0x13f)]?.[_0xf4c921(0x13a)](_0x557c4e,_0xf4c921(0xf0)+_0x3e4531+_0xf4c921(0xe7)+_0xf4c921(0xdc),{'parse_mode':_0xf4c921(0xa3)});return;}if(_0xb396fb['publicKey']!==_0x199345&&_0xb396fb[_0xf4c921(0x118)]!==_0x199345){await this[_0xf4c921(0x13f)]?.[_0xf4c921(0x13a)](_0x557c4e,_0xf4c921(0xcb)+_0x3e4531+_0xf4c921(0xbb)+_0xf4c921(0x104)+_0xf4c921(0x156),{'parse_mode':_0xf4c921(0xa3)});return;}const _0x2f62a3=await database_1['default'][_0xf4c921(0x16a)][_0xf4c921(0x111)]({'where':{'shopId':_0xb396fb['id'],'isVerified':!![],'telegramId':{'not':_0x264027}}});if(_0x2f62a3){await this[_0xf4c921(0x13f)]?.['sendMessage'](_0x557c4e,_0xf4c921(0xaf)+_0x3e4531+_0xf4c921(0xbb)+_0xf4c921(0xc0),{'parse_mode':_0xf4c921(0xa3)});return;}await database_1[_0xf4c921(0x146)][_0xf4c921(0x16a)][_0xf4c921(0x128)]({'where':{'telegramId':_0x264027},'data':{'shopId':_0xb396fb['id'],'isVerified':!![]}}),await this[_0xf4c921(0x13f)]?.[_0xf4c921(0x13a)](_0x557c4e,_0xf4c921(0xe9)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('📱\x20Shop:\x20*'+_0xb396fb[_0xf4c921(0x14e)]+'*\x0a')+(_0xf4c921(0xf4)+_0xb396fb['username']+_0xf4c921(0x171))+_0xf4c921(0x12f)+_0xf4c921(0xd9)+_0xf4c921(0x172)+_0xf4c921(0xfb)+_0xf4c921(0xc4)+_0xf4c921(0x165)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0xf4c921(0x108),{'parse_mode':'Markdown'}),console[_0xf4c921(0x12b)]('✅\x20Telegram\x20user\x20'+_0x264027+_0xf4c921(0x107)+_0xb396fb[_0xf4c921(0xce)]+_0xf4c921(0x169));}catch(_0x2d0d37){console[_0xf4c921(0x112)](_0xf4c921(0xde),_0x2d0d37),await this[_0xf4c921(0x13f)]?.['sendMessage'](_0x557c4e,_0xf4c921(0x133));}}async[a54_0x2ab0bd(0x120)](_0x3f0fa9,_0x573c83,_0x53ab44){const _0x3e695c=a54_0x2ab0bd;if(!this['bot']){console[_0x3e695c(0xae)](_0x3e695c(0x15a));return;}try{const _0x51833c=await database_1[_0x3e695c(0x146)][_0x3e695c(0x16a)][_0x3e695c(0xb6)]({'where':{'shopId':_0x3f0fa9,'isVerified':!![]}});if(_0x51833c[_0x3e695c(0xfe)]===0x0){console[_0x3e695c(0x12b)](_0x3e695c(0xf3)+_0x3f0fa9);return;}const _0x4d2596=_0x51833c['map'](async _0x30c617=>{const _0x2c5e8a=_0x3e695c;try{await this[_0x2c5e8a(0x13f)]?.[_0x2c5e8a(0x13a)](_0x30c617['telegramId'],_0x573c83,_0x53ab44),console[_0x2c5e8a(0x12b)](_0x2c5e8a(0x13b)+_0x30c617[_0x2c5e8a(0xe5)]);}catch(_0x11dde6){console['error'](_0x2c5e8a(0x106)+_0x30c617['telegramId']+':',_0x11dde6),_0x11dde6 instanceof Error&&(_0x11dde6[_0x2c5e8a(0x163)][_0x2c5e8a(0xa2)]('blocked')||_0x11dde6[_0x2c5e8a(0x163)][_0x2c5e8a(0xa2)]('chat\x20not\x20found')||_0x11dde6['message']['includes'](_0x2c5e8a(0x145)))&&(await database_1[_0x2c5e8a(0x146)][_0x2c5e8a(0x16a)][_0x2c5e8a(0x128)]({'where':{'id':_0x30c617['id']},'data':{'isVerified':![]}}),console[_0x2c5e8a(0x12b)](_0x2c5e8a(0x114)+_0x30c617[_0x2c5e8a(0xe5)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x3e695c(0xc3)](_0x4d2596);}catch(_0x55e9c1){console['error'](_0x3e695c(0x15d),_0x55e9c1);}}async[a54_0x2ab0bd(0xa1)](_0x266f30,_0x16b44c,_0x33176f){const _0x4da499=a54_0x2ab0bd,_0x377221={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x5bd846={'created':_0x4da499(0xe2),'paid':_0x4da499(0x16b),'failed':_0x4da499(0x113),'expired':'Payment\x20expired','refund':_0x4da499(0x173),'chargeback':'Payment\x20chargeback','processing':'Payment\x20is\x20being\x20processed'},_0x9ab33b=_0x377221[_0x33176f],_0x5998f1=_0x5bd846[_0x33176f],_0x138ffb=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x16b44c[_0x4da499(0x14a)]);console['log'](_0x4da499(0x130)+_0x16b44c[_0x4da499(0x14a)]+_0x4da499(0xb1)+_0x138ffb+'\x22');let _0x22348d=_0x9ab33b+'\x20*'+_0x5998f1+_0x4da499(0xc8)+('💰\x20Amount:\x20*'+_0x16b44c[_0x4da499(0xc5)]+'\x20'+_0x16b44c[_0x4da499(0xb7)]+'*\x0a')+(_0x4da499(0xdd)+(_0x16b44c['orderId']||_0x16b44c['id'])+'`\x0a')+(_0x4da499(0x12e)+_0x16b44c['id']+'`\x0a')+(_0x4da499(0x122)+_0x138ffb+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x16b44c[_0x4da499(0xdf)])[_0x4da499(0x105)](_0x4da499(0xda))+'\x0a');(_0x16b44c[_0x4da499(0xe8)]||_0x16b44c['customerEmail'])&&(_0x22348d+='\x0a👤\x20*Customer\x20Information:*\x0a',_0x16b44c[_0x4da499(0xe8)]&&(_0x22348d+=_0x4da499(0xa5)+_0x16b44c[_0x4da499(0xe8)]+'`\x0a'),_0x16b44c[_0x4da499(0x16c)]&&(_0x22348d+=_0x4da499(0xa8)+_0x16b44c[_0x4da499(0x16c)]+'`\x0a')),_0x33176f==='chargeback'&&_0x16b44c[_0x4da499(0xd2)]&&(_0x22348d+=_0x4da499(0x11f)+_0x16b44c[_0x4da499(0xd2)]+_0x4da499(0x119)),_0x33176f===_0x4da499(0x16e)&&(_0x22348d+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x16b44c[_0x4da499(0x129)]&&(_0x22348d+='📝\x20Notes:\x20'+_0x16b44c[_0x4da499(0x129)]+'\x0a'),await this[_0x4da499(0x120)](_0x266f30,_0x22348d,{'parse_mode':_0x4da499(0xa3)});}async[a54_0x2ab0bd(0x10d)](_0x198a0c,_0x15a4c2,_0x1dec72){const _0x2c715c=a54_0x2ab0bd,_0x4050b0={'created':'📤','completed':'✅','rejected':'❌'},_0x18a0c3={'created':'New\x20payout\x20created','completed':_0x2c715c(0xd6),'rejected':_0x2c715c(0x136)},_0x54deab=_0x4050b0[_0x1dec72],_0x1ceada=_0x18a0c3[_0x1dec72],_0x5163e5=_0x54deab+'\x20*'+_0x1ceada+_0x2c715c(0xc8)+('💸\x20Amount:\x20*'+_0x15a4c2['amount']+'\x20USD*\x0a')+('🏦\x20Method:\x20`'+_0x15a4c2[_0x2c715c(0xbc)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x15a4c2['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x15a4c2[_0x2c715c(0xdf)])[_0x2c715c(0x105)](_0x2c715c(0xda))+'\x0a')+(_0x15a4c2['txid']?'🔗\x20TXID:\x20`'+_0x15a4c2['txid']+'`':'');await this[_0x2c715c(0x120)](_0x198a0c,_0x5163e5,{'parse_mode':_0x2c715c(0xa3)});}async[a54_0x2ab0bd(0x14d)](_0x25f35f,_0xd6e8b9){const _0x5967b9=a54_0x2ab0bd;try{const _0xbebc36=await database_1[_0x5967b9(0x146)][_0x5967b9(0xff)][_0x5967b9(0x155)]({'where':{'shopId':_0x25f35f},'select':{'notificationLogin':!![]}});if(!_0xbebc36?.[_0x5967b9(0x164)]){console[_0x5967b9(0x12b)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x25f35f);return;}const _0x25c131=_0xd6e8b9[_0x5967b9(0x13e)]?'🔐':'🚨',_0x1c986e=_0xd6e8b9[_0x5967b9(0x13e)]?_0x5967b9(0xb9):_0x5967b9(0x102);let _0x225aec=_0x25c131+'\x20*'+_0x1c986e+_0x5967b9(0xc8)+(_0x5967b9(0xf4)+_0xd6e8b9['username']+'`\x0a')+(_0x5967b9(0x15b)+_0xd6e8b9[_0x5967b9(0x166)]['toLocaleString'](_0x5967b9(0xda))+'\x0a');_0xd6e8b9['ipAddress']&&(_0x225aec+=_0x5967b9(0x110)+_0xd6e8b9['ipAddress']+'`\x0a');if(_0xd6e8b9[_0x5967b9(0x149)]){const _0x3f8e1d=_0xd6e8b9[_0x5967b9(0x149)][_0x5967b9(0xfe)]>0x32?_0xd6e8b9['userAgent'][_0x5967b9(0x170)](0x0,0x32)+_0x5967b9(0x10f):_0xd6e8b9['userAgent'];_0x225aec+=_0x5967b9(0x14b)+_0x3f8e1d+'`\x0a';}!_0xd6e8b9[_0x5967b9(0x13e)]&&(_0x225aec+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x5967b9(0x120)](_0x25f35f,_0x225aec,{'parse_mode':'Markdown'}),console[_0x5967b9(0x12b)](_0x5967b9(0x126)+_0x25f35f+':\x20'+(_0xd6e8b9[_0x5967b9(0x13e)]?_0x5967b9(0x13e):_0x5967b9(0x15f)));}catch(_0x2d7b77){console['error'](_0x5967b9(0xd3),_0x2d7b77);}}async[a54_0x2ab0bd(0x160)](_0x5cb43e,_0x506f27){const _0x1deb58=a54_0x2ab0bd;try{const _0x1a8bca=await database_1[_0x1deb58(0x146)][_0x1deb58(0xff)][_0x1deb58(0x155)]({'where':{'shopId':_0x5cb43e},'select':{'notificationApiError':!![]}});if(!_0x1a8bca?.[_0x1deb58(0x135)]){console[_0x1deb58(0x12b)](_0x1deb58(0xc7)+_0x5cb43e);return;}let _0x126f9a=_0x1deb58(0x144)+('🔗\x20Endpoint:\x20`'+_0x506f27['method']+'\x20'+_0x506f27[_0x1deb58(0x132)]+'`\x0a')+(_0x1deb58(0x15b)+_0x506f27[_0x1deb58(0x166)][_0x1deb58(0x105)]('en-US')+'\x0a');_0x506f27[_0x1deb58(0xf2)]&&(_0x126f9a+='📊\x20Error\x20code:\x20`'+_0x506f27['statusCode']+'`\x0a'),_0x126f9a+=_0x1deb58(0x15c)+_0x506f27[_0x1deb58(0xe1)]+'`\x0a',_0x506f27[_0x1deb58(0x10a)]&&(_0x126f9a+='🆔\x20Request\x20ID:\x20`'+_0x506f27[_0x1deb58(0x10a)]+'`\x0a'),_0x126f9a+=_0x1deb58(0xc6),await this[_0x1deb58(0x120)](_0x5cb43e,_0x126f9a,{'parse_mode':_0x1deb58(0xa3)}),console[_0x1deb58(0x12b)](_0x1deb58(0xfa)+_0x5cb43e+':\x20'+_0x506f27[_0x1deb58(0x132)]);}catch(_0xf71e){console[_0x1deb58(0x112)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0xf71e);}}async[a54_0x2ab0bd(0x137)](_0x513bbb,_0x48e20d,_0x2c4ac1){const _0x3439fa=a54_0x2ab0bd;let _0x15cea8=_0x3439fa(0xdb)+_0x48e20d+_0x3439fa(0xc8);for(const [_0x254d22,_0x4195fd]of Object[_0x3439fa(0xb3)](_0x2c4ac1)){_0x4195fd!==null&&_0x4195fd!==undefined&&(_0x15cea8+=_0x254d22+_0x3439fa(0x11b)+_0x4195fd+'`\x0a');}await this[_0x3439fa(0x120)](_0x513bbb,_0x15cea8,{'parse_mode':'Markdown'});}['getBotInfo'](){const _0x494a46=a54_0x2ab0bd;return{'isActive':!!this['bot'],'username':this[_0x494a46(0x11d)]};}[a54_0x2ab0bd(0x152)](){const _0x21fae9=a54_0x2ab0bd;this['bot']&&(this[_0x21fae9(0x13f)][_0x21fae9(0x115)](),this[_0x21fae9(0x13f)]=null,console[_0x21fae9(0x12b)](_0x21fae9(0xf9)));}}exports['TelegramBotService']=TelegramBotService,exports['telegramBotService']=new TelegramBotService();