'use strict';const a66_0x3f1bdf=a66_0x4dc3;(function(_0x4d6f49,_0x4a6333){const _0x263593=a66_0x4dc3,_0x4d14db=_0x4d6f49();while(!![]){try{const _0xd10d8c=parseInt(_0x263593(0x126))/0x1*(parseInt(_0x263593(0x1a7))/0x2)+parseInt(_0x263593(0x155))/0x3+-parseInt(_0x263593(0x178))/0x4*(parseInt(_0x263593(0x171))/0x5)+-parseInt(_0x263593(0x1e0))/0x6*(-parseInt(_0x263593(0x1f8))/0x7)+parseInt(_0x263593(0x1fa))/0x8+-parseInt(_0x263593(0x17c))/0x9*(parseInt(_0x263593(0x1ea))/0xa)+parseInt(_0x263593(0x1c2))/0xb*(-parseInt(_0x263593(0x162))/0xc);if(_0xd10d8c===_0x4a6333)break;else _0x4d14db['push'](_0x4d14db['shift']());}catch(_0x366ad3){_0x4d14db['push'](_0x4d14db['shift']());}}}(a66_0x40ea,0x1cfe7));var __importDefault=this&&this['__importDefault']||function(_0x5f5c4e){return _0x5f5c4e&&_0x5f5c4e['__esModule']?_0x5f5c4e:{'default':_0x5f5c4e};};Object[a66_0x3f1bdf(0x214)](exports,'__esModule',{'value':!![]}),exports[a66_0x3f1bdf(0x143)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a66_0x3f1bdf(0x12c))),database_1=__importDefault(require('../config/database')),gateway_1=require('../types/gateway');function a66_0x4dc3(_0x28c971,_0x5f1760){const _0x40eaa7=a66_0x40ea();return a66_0x4dc3=function(_0x4dc36a,_0x123a5c){_0x4dc36a=_0x4dc36a-0x123;let _0x1a8cca=_0x40eaa7[_0x4dc36a];return _0x1a8cca;},a66_0x4dc3(_0x28c971,_0x5f1760);}function a66_0x40ea(){const _0x4029be=['startsWith','⏱️\x20*Period:*\x20','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','update','👤\x20Username:\x20`','📱\x20Notification\x20sent\x20to\x20','statusCode','💰\x20Amount:\x20*','sendPayoutNotification','log','name','sendMessage','`\x20is\x20inactive.\x0a\x0a','685632kvuaYn','✅\x20Telegram\x20bot\x20@','`\x0a\x0a','substring','Payment\x20successfully\x20paid','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','🔔\x20*','🎉\x20*Congratulations!*\x0a\x0a','gateway','secretKey','New\x20payment\x20created','publicKey','map','1761660kIHOSJ','\x0a👤\x20*Customer\x20Information:*\x0a','customerIp','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','endpoint','📅\x20Date:\x20','chargeback','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','❌\x20Error\x20sending\x20direct\x20message:','length','❌\x20Invalid\x20username\x20format:\x20`','You\x20sent\x20','💰\x20*Amount:*\x20','•\x20Payment\x20status\x20changes\x0a','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','125yfHBeG','\x20\x20\x20Username:\x20`','\x20disconnected\x20from\x20shop\x20','📱\x20No\x20active\x20Telegram\x20users\x20found','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','onText','💳\x20*Wallet:*\x20`','37432iKNplD','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','botUsername','chat','9boBrWe','Error\x20handling\x20/disconnect\x20command:','2-digit','amount','Not\x20specified','first_name','updatedAt','Payment\x20is\x20being\x20processed','findUnique','test','success','\x20\x20\x20Name:\x20*','User\x20','Telegram\x20bot\x20error:','endsWith','adminNotes','shopSettings','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','Commands:\x0a','botToken','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','\x20USD\x0a','userAgent','notificationApiError','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','📱\x20Created\x20new\x20Telegram\x20user:\x20','network','Telegram\x20bot\x20polling\x20error:','customerEmail','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','from','shopId','requestId','\x20(@','status','sk_','Error\x20handling\x20message:','📝\x20Notes:\x20','user\x20is\x20deactivated','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','\x20\x20\x20Status:\x20','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','✅\x20File\x20sent\x20to\x20chat\x20','2MAIIGG','sendShopNotification','Markdown','ipAddress','📝\x20Order\x20ID:\x20`','.jpeg','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','🛑\x20Telegram\x20bot\x20stopped','📛\x20Name:\x20`','*\x0a\x0a','method','text','\x22\x20->\x20display\x20\x22','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','🆔\x20Request\x20ID:\x20`','wallet','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','unknown\x20shop','getBotInfo','default','toLocaleString','Failed\x20to\x20send\x20API\x20error\x20notification:','📅\x20Time:\x20','🔗\x20*Transaction\x20Link:*\x20Pending',':\x20`','TELEGRAM_BOT_USERNAME','11qwELXO','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','TELEGRAM_BOT_TOKEN','.jpg','handleSingleLineVerification','includes','❌\x20Telegram\x20bot\x20not\x20initialized','✅\x20Telegram\x20user\x20','currency','/disconnect\x20-\x20disconnect\x20from\x20notifications','initializeBot','bot','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','sendLoginNotification','toString','💻\x20Browser:\x20`','❌\x20Error\x20sending\x20file\x20to\x20user\x20','customerName','application/pdf','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','\x22,\x20apiKey=\x22','error','Error\x20handling\x20/debug\x20command:','geo','🌐\x20IP:\x20`','telegramId','pk_','Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a','📊\x20*Connection\x20Status*\x0a\x0a','12rMRolm','✅\x20File\x20sent\x20to\x20','📅\x20*Payout\x20Date:*\x20','💸\x20*New\x20Payout*\x0a\x0a','Payment\x20refund','❌\x20Error\x20sending\x20file\x20to\x20shop:','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','📧\x20Email:\x20`','sendCustomNotification','842780ZlJYMp','join','📱\x20Telegram\x20notification:\x20gateway\x20\x22','sendDocument','stopBot','findMany','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','\x20users\x20of\x20shop\x20','`.\x0a\x0a','trim','sendApiErrorNotification','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','polling_error','image/jpeg','85841kKokyz','.png','1036024rzjBJs','\x20initialized\x20successfully','image/png','🏪\x20Gateway:\x20`','env','...','Example:\x0a','createdAt','failed','blocked','application/octet-stream','❌\x20Error\x20getting\x20debug\x20information.','Failed\x20to\x20send\x20login\x20notification:','customerUa','🔔\x20Notifications\x20are\x20active\x0a\x0a','`\x20not\x20found.\x0a\x0a','🔍\x20*Debug\x20Information*\x0a\x0a','Error\x20handling\x20/status\x20command:','Payment\x20expired','.pdf','getGatewayDisplayNameForTelegram','Use\x20/start\x20to\x20begin.','/status\x20-\x20check\x20connection\x20status\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','\x20verified\x20for\x20shop\x20','•\x20Important\x20events\x0a\x0a','defineProperty','...\x22','remitterIban','❌\x20Shop\x20`','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`',':\x20username=\x22','❌\x20Shop\x20with\x20username\x20`','🏪\x20Your\x20connected\x20shop:\x0a','en-US','201219MtaKnX','Failed\x20login\x20attempt','processing','sendShopFile','telegramUser','📱\x20Your\x20Telegram\x20ID:\x20`','node-telegram-bot-api','username','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','timestamp','stopPolling','period','shop','sendDirectFile','message','setupBotHandlers','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','txid','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','orderId','Successful\x20login','Payment\x20failed','sendNotificationToAll','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','warn','✅\x20Welcome\x20back!\x0a\x0a','isVerified','*.\x0a\x0a','telegramBotService','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','📊\x20Error\x20code:\x20`','chargebackAmount','✅\x20Connected\x20to\x20shop:\x20*'];a66_0x40ea=function(){return _0x4029be;};return a66_0x40ea();}class TelegramBotService{constructor(){const _0x481a20=a66_0x3f1bdf;this['bot']=null,this[_0x481a20(0x18f)]=process[_0x481a20(0x1fe)][_0x481a20(0x1c4)]||'',this[_0x481a20(0x17a)]=process[_0x481a20(0x1fe)][_0x481a20(0x1c1)]||'trapay_bot',this[_0x481a20(0x18f)]?this[_0x481a20(0x1cc)]():console[_0x481a20(0x13f)](_0x481a20(0x1d6));}[a66_0x3f1bdf(0x1cc)](){const _0x282450=a66_0x3f1bdf;try{this[_0x282450(0x1cd)]=new node_telegram_bot_api_1[(_0x282450(0x1bb))](this[_0x282450(0x18f)],{'polling':!![]}),this[_0x282450(0x135)](),console[_0x282450(0x151)](_0x282450(0x156)+this['botUsername']+_0x282450(0x1fb));}catch(_0x339e43){console[_0x282450(0x1d8)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x339e43);}}['setupBotHandlers'](){const _0x2fc56f=a66_0x3f1bdf;if(!this[_0x2fc56f(0x1cd)])return;this[_0x2fc56f(0x1cd)][_0x2fc56f(0x176)](/\/start/,async _0x550bc9=>{const _0x5916e3=_0x2fc56f,_0x4bdac2=_0x550bc9[_0x5916e3(0x17b)]['id'],_0x4fd644=_0x550bc9[_0x5916e3(0x19a)]?.['id'][_0x5916e3(0x1d0)](),_0x4922ca=_0x550bc9[_0x5916e3(0x19a)]?.[_0x5916e3(0x12d)],_0x4d4ff9=_0x550bc9[_0x5916e3(0x19a)]?.[_0x5916e3(0x181)],_0x2110da=_0x550bc9['from']?.['last_name'];if(!_0x4fd644)return;try{let _0x2a1afe=await database_1[_0x5916e3(0x1bb)][_0x5916e3(0x12a)]['findUnique']({'where':{'telegramId':_0x4fd644},'include':{'shop':!![]}});!_0x2a1afe?(_0x2a1afe=await database_1['default'][_0x5916e3(0x12a)]['create']({'data':{'telegramId':_0x4fd644,'username':_0x4922ca,'firstName':_0x4d4ff9,'lastName':_0x2110da,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x5916e3(0x151)](_0x5916e3(0x195)+_0x4fd644+_0x5916e3(0x19d)+_0x4922ca+')')):_0x2a1afe=await database_1['default'][_0x5916e3(0x12a)]['update']({'where':{'telegramId':_0x4fd644},'data':{'username':_0x4922ca,'firstName':_0x4d4ff9,'lastName':_0x2110da},'include':{'shop':!![]}}),_0x2a1afe['isVerified']&&_0x2a1afe[_0x5916e3(0x19b)]&&_0x2a1afe[_0x5916e3(0x132)]?await this[_0x5916e3(0x1cd)]?.[_0x5916e3(0x153)](_0x4bdac2,_0x5916e3(0x140)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x2a1afe[_0x5916e3(0x132)]['name']+'*\x0a')+('Username:\x20`'+_0x2a1afe[_0x5916e3(0x132)][_0x5916e3(0x12d)]+_0x5916e3(0x157))+_0x5916e3(0x13d)+'•\x20New\x20payments\x0a'+_0x5916e3(0x16f)+'•\x20Payouts\x0a\x0a'+_0x5916e3(0x18e)+_0x5916e3(0x210)+_0x5916e3(0x1cb),{'parse_mode':_0x5916e3(0x1a9)}):(_0x2a1afe[_0x5916e3(0x19b)]&&!_0x2a1afe[_0x5916e3(0x141)]&&(await database_1['default'][_0x5916e3(0x12a)]['update']({'where':{'telegramId':_0x4fd644},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x4fd644)),await this[_0x5916e3(0x1cd)]?.[_0x5916e3(0x153)](_0x4bdac2,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x5916e3(0x15a)+'Example:\x0a'+_0x5916e3(0x144)+_0x5916e3(0x1d5),{'parse_mode':_0x5916e3(0x1a9)}));}catch(_0x2314a){console[_0x5916e3(0x1d8)]('Error\x20handling\x20/start\x20command:',_0x2314a),await this['bot']?.[_0x5916e3(0x153)](_0x4bdac2,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x2fc56f(0x1cd)]['onText'](/\/disconnect/,async _0x40f19e=>{const _0x1e6044=_0x2fc56f,_0x321aae=_0x40f19e[_0x1e6044(0x17b)]['id'],_0x3f5889=_0x40f19e[_0x1e6044(0x19a)]?.['id'][_0x1e6044(0x1d0)]();if(!_0x3f5889)return;try{const _0x2e6105=await database_1[_0x1e6044(0x1bb)][_0x1e6044(0x12a)][_0x1e6044(0x184)]({'where':{'telegramId':_0x3f5889},'include':{'shop':!![]}});if(!_0x2e6105||!_0x2e6105[_0x1e6044(0x141)]||!_0x2e6105[_0x1e6044(0x19b)]){await this[_0x1e6044(0x1cd)]?.[_0x1e6044(0x153)](_0x321aae,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x5db1b2=_0x2e6105['shop']?.[_0x1e6044(0x152)]||_0x1e6044(0x1b9);await database_1[_0x1e6044(0x1bb)][_0x1e6044(0x12a)][_0x1e6044(0x14b)]({'where':{'telegramId':_0x3f5889},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔌\x20User\x20'+_0x3f5889+_0x1e6044(0x173)+_0x2e6105[_0x1e6044(0x19b)]),await this['bot']?.['sendMessage'](_0x321aae,_0x1e6044(0x211)+_0x5db1b2+_0x1e6044(0x142)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x1e6044(0x1a9)});}catch(_0x372efa){console[_0x1e6044(0x1d8)](_0x1e6044(0x17d),_0x372efa),await this[_0x1e6044(0x1cd)]?.[_0x1e6044(0x153)](_0x321aae,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot'][_0x2fc56f(0x176)](/\/status/,async _0x119202=>{const _0x283c9c=_0x2fc56f,_0x276dba=_0x119202[_0x283c9c(0x17b)]['id'],_0xab9593=_0x119202['from']?.['id'][_0x283c9c(0x1d0)]();if(!_0xab9593)return;try{const _0x4e1095=await database_1[_0x283c9c(0x1bb)]['telegramUser'][_0x283c9c(0x184)]({'where':{'telegramId':_0xab9593},'include':{'shop':!![]}});if(!_0x4e1095){await this[_0x283c9c(0x1cd)]?.[_0x283c9c(0x153)](_0x276dba,_0x283c9c(0x190)+_0x283c9c(0x20f));return;}if(!_0x4e1095['isVerified']||!_0x4e1095['shopId']||!_0x4e1095[_0x283c9c(0x132)]){await this[_0x283c9c(0x1cd)]?.[_0x283c9c(0x153)](_0x276dba,_0x283c9c(0x1f5)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x283c9c(0x1cd)]?.[_0x283c9c(0x153)](_0x276dba,_0x283c9c(0x1df)+(_0x283c9c(0x147)+_0x4e1095[_0x283c9c(0x132)]['name']+'*\x0a')+(_0x283c9c(0x14c)+_0x4e1095['shop'][_0x283c9c(0x12d)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x4e1095[_0x283c9c(0x182)]['toLocaleDateString']('en-US')+'\x0a\x0a')+_0x283c9c(0x208)+_0x283c9c(0x18e)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x283c9c(0x1a9)});}catch(_0x14964f){console[_0x283c9c(0x1d8)](_0x283c9c(0x20b),_0x14964f),await this[_0x283c9c(0x1cd)]?.[_0x283c9c(0x153)](_0x276dba,_0x283c9c(0x165));}}),this[_0x2fc56f(0x1cd)]['onText'](/\/debug/,async _0xa78edb=>{const _0x545318=_0x2fc56f,_0xf349=_0xa78edb[_0x545318(0x17b)]['id'],_0x50f51c=_0xa78edb[_0x545318(0x19a)]?.['id'][_0x545318(0x1d0)]();if(!_0x50f51c)return;try{const _0x41602c=await database_1[_0x545318(0x1bb)]['telegramUser'][_0x545318(0x184)]({'where':{'telegramId':_0x50f51c},'include':{'shop':!![]}});let _0x5e51ca=_0x545318(0x20a);_0x5e51ca+=_0x545318(0x12b)+_0x50f51c+'`\x0a\x0a',_0x41602c?.['isVerified']&&_0x41602c[_0x545318(0x132)]?(_0x5e51ca+=_0x545318(0x124),_0x5e51ca+=_0x545318(0x187)+_0x41602c[_0x545318(0x132)][_0x545318(0x152)]+'*\x0a',_0x5e51ca+=_0x545318(0x172)+_0x41602c[_0x545318(0x132)][_0x545318(0x12d)]+'`\x0a',_0x5e51ca+=_0x545318(0x1a4)+_0x41602c[_0x545318(0x132)][_0x545318(0x19e)]+'\x0a\x0a'):_0x5e51ca+='❌\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a',_0x5e51ca+='Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.',await this['bot']?.[_0x545318(0x153)](_0xf349,_0x5e51ca,{'parse_mode':'Markdown'});}catch(_0x178162){console['error'](_0x545318(0x1d9),_0x178162),await this[_0x545318(0x1cd)]?.[_0x545318(0x153)](_0xf349,_0x545318(0x205));}}),this[_0x2fc56f(0x1cd)]['on']('message',async _0x395806=>{const _0x3d1eb5=_0x2fc56f;if(_0x395806[_0x3d1eb5(0x1b3)]?.[_0x3d1eb5(0x148)]('/'))return;const _0x125bd6=_0x395806[_0x3d1eb5(0x17b)]['id'],_0x2dbaf1=_0x395806['from']?.['id'][_0x3d1eb5(0x1d0)](),_0x37015b=_0x395806[_0x3d1eb5(0x1b3)]?.[_0x3d1eb5(0x1f3)]();if(!_0x2dbaf1||!_0x37015b)return;try{const _0x787b8e=await database_1[_0x3d1eb5(0x1bb)][_0x3d1eb5(0x12a)][_0x3d1eb5(0x184)]({'where':{'telegramId':_0x2dbaf1},'include':{'shop':!![]}});if(!_0x787b8e){await this[_0x3d1eb5(0x1cd)]?.['sendMessage'](_0x125bd6,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x787b8e[_0x3d1eb5(0x141)]&&_0x787b8e[_0x3d1eb5(0x19b)]&&_0x787b8e['shop']){await this['bot']?.['sendMessage'](_0x125bd6,_0x3d1eb5(0x1f0)+_0x787b8e[_0x3d1eb5(0x132)]['name']+_0x3d1eb5(0x142)+_0x3d1eb5(0x13e),{'parse_mode':_0x3d1eb5(0x1a9)});return;}const _0x4f2e51=_0x37015b['split'](/\s+/);if(_0x4f2e51['length']!==0x2){await this[_0x3d1eb5(0x1cd)]?.[_0x3d1eb5(0x153)](_0x125bd6,_0x3d1eb5(0x138)+_0x3d1eb5(0x15a)+_0x3d1eb5(0x200)+_0x3d1eb5(0x144)+(_0x3d1eb5(0x16d)+_0x4f2e51[_0x3d1eb5(0x16b)]+'\x20parts:\x20'+_0x4f2e51['map'](_0x42cf4b=>'`'+_0x42cf4b+'`')[_0x3d1eb5(0x1eb)](',\x20')),{'parse_mode':_0x3d1eb5(0x1a9)});return;}const [_0xd5c8ce,_0x166df3]=_0x4f2e51;console[_0x3d1eb5(0x151)](_0x3d1eb5(0x1ce)+_0x2dbaf1+_0x3d1eb5(0x219)+_0xd5c8ce+_0x3d1eb5(0x1d7)+_0x166df3[_0x3d1eb5(0x158)](0x0,0xa)+'...\x22'),await this[_0x3d1eb5(0x1c6)](_0x125bd6,_0x2dbaf1,_0xd5c8ce,_0x166df3);}catch(_0x2887d0){console['error'](_0x3d1eb5(0x1a0),_0x2887d0),await this[_0x3d1eb5(0x1cd)]?.[_0x3d1eb5(0x153)](_0x125bd6,_0x3d1eb5(0x165));}}),this[_0x2fc56f(0x1cd)]['on']('error',_0x5939b4=>{const _0x91475e=_0x2fc56f;console['error'](_0x91475e(0x189),_0x5939b4);}),this[_0x2fc56f(0x1cd)]['on'](_0x2fc56f(0x1f6),_0x4e9efc=>{const _0x850190=_0x2fc56f;console[_0x850190(0x1d8)](_0x850190(0x197),_0x4e9efc);});}async['handleSingleLineVerification'](_0xa02d93,_0xe5f217,_0x293a0c,_0x1a0d66){const _0x566b89=a66_0x3f1bdf;try{console[_0x566b89(0x151)](_0x566b89(0x1ce)+_0xe5f217+_0x566b89(0x219)+_0x293a0c+_0x566b89(0x1d7)+_0x1a0d66['substring'](0x0,0xa)+_0x566b89(0x215));if(!_0x293a0c||_0x293a0c[_0x566b89(0x16b)]<0x3||_0x293a0c[_0x566b89(0x16b)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x566b89(0x185)](_0x293a0c)){await this[_0x566b89(0x1cd)]?.['sendMessage'](_0xa02d93,_0x566b89(0x16c)+_0x293a0c+_0x566b89(0x157)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x566b89(0x1a9)});return;}if(!_0x1a0d66||!_0x1a0d66[_0x566b89(0x148)](_0x566b89(0x1dd))&&!_0x1a0d66[_0x566b89(0x148)](_0x566b89(0x19f))){await this[_0x566b89(0x1cd)]?.['sendMessage'](_0xa02d93,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x566b89(0x1e7),{'parse_mode':_0x566b89(0x1a9)});return;}const _0xd4d6ee=await database_1[_0x566b89(0x1bb)][_0x566b89(0x132)]['findUnique']({'where':{'username':_0x293a0c},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0xd4d6ee){const _0x541f7e=_0x566b89(0x123)+_0x293a0c+_0x566b89(0x209)+_0x566b89(0x1de)+'Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.';await this['bot']?.[_0x566b89(0x153)](_0xa02d93,_0x541f7e,{'parse_mode':_0x566b89(0x1a9)});return;}if(_0xd4d6ee['status']!=='ACTIVE'){await this['bot']?.[_0x566b89(0x153)](_0xa02d93,_0x566b89(0x217)+_0x293a0c+_0x566b89(0x154)+'Contact\x20administrator.',{'parse_mode':_0x566b89(0x1a9)});return;}if(_0xd4d6ee[_0x566b89(0x160)]!==_0x1a0d66&&_0xd4d6ee[_0x566b89(0x15e)]!==_0x1a0d66){await this[_0x566b89(0x1cd)]?.[_0x566b89(0x153)](_0xa02d93,_0x566b89(0x218)+_0x293a0c+_0x566b89(0x1f2)+_0x566b89(0x1a3)+_0x566b89(0x170),{'parse_mode':_0x566b89(0x1a9)});return;}const _0x5291e5=await database_1['default']['telegramUser']['findFirst']({'where':{'shopId':_0xd4d6ee['id'],'isVerified':!![],'telegramId':{'not':_0xe5f217}}});if(_0x5291e5){await this['bot']?.[_0x566b89(0x153)](_0xa02d93,_0x566b89(0x1a5)+_0x293a0c+_0x566b89(0x1f2)+_0x566b89(0x14a),{'parse_mode':_0x566b89(0x1a9)});return;}await database_1[_0x566b89(0x1bb)][_0x566b89(0x12a)]['update']({'where':{'telegramId':_0xe5f217},'data':{'shopId':_0xd4d6ee['id'],'isVerified':!![]}}),await this[_0x566b89(0x1cd)]?.[_0x566b89(0x153)](_0xa02d93,_0x566b89(0x15c)+_0x566b89(0x169)+('📱\x20Shop:\x20*'+_0xd4d6ee[_0x566b89(0x152)]+'*\x0a')+(_0x566b89(0x14c)+_0xd4d6ee[_0x566b89(0x12d)]+_0x566b89(0x157))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x566b89(0x16f)+'•\x20Payouts\x0a'+_0x566b89(0x213)+_0x566b89(0x18e)+_0x566b89(0x210)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}),console[_0x566b89(0x151)](_0x566b89(0x1c9)+_0xe5f217+_0x566b89(0x212)+_0xd4d6ee[_0x566b89(0x12d)]+'\x20via\x20single-line\x20input');}catch(_0xbff1f){console['error']('Error\x20in\x20handleSingleLineVerification:',_0xbff1f),await this[_0x566b89(0x1cd)]?.[_0x566b89(0x153)](_0xa02d93,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async['sendShopNotification'](_0x279453,_0x41eb62,_0x2b193c){const _0x27ecde=a66_0x3f1bdf;if(!this[_0x27ecde(0x1cd)]){console[_0x27ecde(0x13f)](_0x27ecde(0x179));return;}try{const _0x4ed8bf=await database_1['default'][_0x27ecde(0x12a)][_0x27ecde(0x1ef)]({'where':{'shopId':_0x279453,'isVerified':!![]}});if(_0x4ed8bf[_0x27ecde(0x16b)]===0x0){console['log']('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x279453);return;}const _0x10f1a8=_0x4ed8bf[_0x27ecde(0x161)](async _0xeb1f7a=>{const _0x13baa6=_0x27ecde;try{await this[_0x13baa6(0x1cd)]?.['sendMessage'](_0xeb1f7a[_0x13baa6(0x1dc)],_0x41eb62,_0x2b193c),console[_0x13baa6(0x151)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0xeb1f7a['telegramId']);}catch(_0x49b509){console[_0x13baa6(0x1d8)](_0x13baa6(0x199)+_0xeb1f7a['telegramId']+':',_0x49b509),_0x49b509 instanceof Error&&(_0x49b509[_0x13baa6(0x134)]['includes'](_0x13baa6(0x203))||_0x49b509[_0x13baa6(0x134)][_0x13baa6(0x1c7)]('chat\x20not\x20found')||_0x49b509[_0x13baa6(0x134)][_0x13baa6(0x1c7)](_0x13baa6(0x1a2)))&&(await database_1[_0x13baa6(0x1bb)][_0x13baa6(0x12a)][_0x13baa6(0x14b)]({'where':{'id':_0xeb1f7a['id']},'data':{'isVerified':![]}}),console['log'](_0x13baa6(0x188)+_0xeb1f7a[_0x13baa6(0x1dc)]+_0x13baa6(0x1b8)));}});await Promise['allSettled'](_0x10f1a8);}catch(_0x47a1d5){console['error']('Error\x20sending\x20shop\x20notification:',_0x47a1d5);}}async['sendPaymentNotification'](_0x4dd79f,_0x9c70e5,_0x4d3269){const _0x432a6f=a66_0x3f1bdf,_0x5b894e={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x415850={'created':_0x432a6f(0x15f),'paid':_0x432a6f(0x159),'failed':_0x432a6f(0x13b),'expired':_0x432a6f(0x20c),'refund':_0x432a6f(0x1e4),'chargeback':'Payment\x20chargeback','processing':_0x432a6f(0x183)},_0x4fb728=_0x5b894e[_0x4d3269],_0x793813=_0x415850[_0x4d3269],_0xeb2f78=(0x0,gateway_1[_0x432a6f(0x20e)])(_0x9c70e5[_0x432a6f(0x15d)]);console[_0x432a6f(0x151)](_0x432a6f(0x1ec)+_0x9c70e5['gateway']+_0x432a6f(0x1b4)+_0xeb2f78+'\x22');let _0x5324b3=_0x4fb728+'\x20*'+_0x793813+_0x432a6f(0x1b1)+(_0x432a6f(0x14f)+_0x9c70e5[_0x432a6f(0x17f)]+'\x20'+_0x9c70e5[_0x432a6f(0x1ca)]+'*\x0a')+(_0x432a6f(0x1ab)+(_0x9c70e5[_0x432a6f(0x139)]||_0x9c70e5['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x9c70e5['id']+'`\x0a')+(_0x432a6f(0x1fd)+_0xeb2f78+'`\x0a')+(_0x432a6f(0x167)+new Date(_0x9c70e5['createdAt'])['toLocaleString'](_0x432a6f(0x125))+'\x0a');if(_0x9c70e5['customerName']||_0x9c70e5[_0x432a6f(0x198)]||_0x9c70e5['remitterIban']||_0x9c70e5['customerIp']||_0x9c70e5[_0x432a6f(0x207)]){_0x5324b3+=_0x432a6f(0x163);_0x9c70e5['customerName']&&(_0x5324b3+=_0x432a6f(0x1b0)+_0x9c70e5[_0x432a6f(0x1d3)]+'`\x0a');_0x9c70e5[_0x432a6f(0x198)]&&(_0x5324b3+=_0x432a6f(0x1e8)+_0x9c70e5[_0x432a6f(0x198)]+'`\x0a');_0x9c70e5[_0x432a6f(0x216)]&&(_0x5324b3+='🏦\x20IBAN:\x20`'+_0x9c70e5[_0x432a6f(0x216)]+'`\x0a');_0x9c70e5['customerIp']&&(_0x5324b3+=_0x432a6f(0x1db)+_0x9c70e5[_0x432a6f(0x164)]+'`\x0a');if(_0x9c70e5[_0x432a6f(0x207)]){const _0x525f7b=_0x9c70e5[_0x432a6f(0x207)]['length']>0x32?_0x9c70e5['customerUa'][_0x432a6f(0x158)](0x0,0x32)+_0x432a6f(0x1ff):_0x9c70e5[_0x432a6f(0x207)];_0x5324b3+='💻\x20Browser:\x20`'+_0x525f7b+'`\x0a';}}_0x4d3269===_0x432a6f(0x168)&&_0x9c70e5['chargebackAmount']&&(_0x5324b3+='💸\x20Penalty\x20amount:\x20*'+_0x9c70e5[_0x432a6f(0x146)]+'\x20USDT*\x0a'),_0x4d3269===_0x432a6f(0x128)&&(_0x5324b3+=_0x432a6f(0x194)),_0x9c70e5[_0x432a6f(0x18b)]&&(_0x5324b3+=_0x432a6f(0x1a1)+_0x9c70e5[_0x432a6f(0x18b)]+'\x0a'),await this[_0x432a6f(0x1a8)](_0x4dd79f,_0x5324b3,{'parse_mode':'Markdown'});}async[a66_0x3f1bdf(0x150)](_0x20631e,_0x2b9865){const _0x5bdd36=a66_0x3f1bdf,_0x974695=new Date(_0x2b9865[_0x5bdd36(0x201)])[_0x5bdd36(0x1bc)](_0x5bdd36(0x125),{'year':'numeric','month':'2-digit','day':'2-digit','hour':'2-digit','minute':_0x5bdd36(0x17e),'second':_0x5bdd36(0x17e)}),_0x183459=_0x5bdd36(0x1e3)+(_0x5bdd36(0x1e2)+_0x974695+'\x0a')+(_0x5bdd36(0x16e)+_0x2b9865[_0x5bdd36(0x17f)]+_0x5bdd36(0x191))+(_0x5bdd36(0x149)+(_0x2b9865[_0x5bdd36(0x131)]||_0x5bdd36(0x180))+'\x0a')+('🌐\x20*Network:*\x20'+(_0x2b9865[_0x5bdd36(0x196)]||'Not\x20specified')+'\x0a')+(_0x5bdd36(0x177)+(_0x2b9865[_0x5bdd36(0x1b7)]||_0x5bdd36(0x180))+'`\x0a')+(_0x2b9865[_0x5bdd36(0x137)]?'🔗\x20*Transaction\x20Link:*\x20`'+_0x2b9865['txid']+'`':_0x5bdd36(0x1bf));await this[_0x5bdd36(0x1a8)](_0x20631e,_0x183459,{'parse_mode':_0x5bdd36(0x1a9)});}async[a66_0x3f1bdf(0x1cf)](_0x8100e1,_0x4c987f){const _0x25e602=a66_0x3f1bdf;try{const _0x53dfb8=await database_1[_0x25e602(0x1bb)][_0x25e602(0x18c)]['findUnique']({'where':{'shopId':_0x8100e1},'select':{'notificationLogin':!![]}});if(!_0x53dfb8?.['notificationLogin']){console['log'](_0x25e602(0x12e)+_0x8100e1);return;}const _0x213b4a=_0x4c987f['success']?'🔐':'🚨',_0x467d77=_0x4c987f['success']?_0x25e602(0x13a):_0x25e602(0x127);let _0x32705b=_0x213b4a+'\x20*'+_0x467d77+'*\x0a\x0a'+(_0x25e602(0x14c)+_0x4c987f[_0x25e602(0x12d)]+'`\x0a')+(_0x25e602(0x1be)+_0x4c987f['timestamp'][_0x25e602(0x1bc)](_0x25e602(0x125))+'\x0a');_0x4c987f[_0x25e602(0x1aa)]&&(_0x32705b+='🌐\x20IP\x20address:\x20`'+_0x4c987f[_0x25e602(0x1aa)]+'`\x0a');_0x4c987f['geo']&&(_0x32705b+='🌍\x20Country:\x20'+_0x4c987f[_0x25e602(0x1da)]+'\x0a');if(_0x4c987f[_0x25e602(0x192)]){const _0x28725e=_0x4c987f['userAgent']['length']>0x32?_0x4c987f[_0x25e602(0x192)][_0x25e602(0x158)](0x0,0x32)+_0x25e602(0x1ff):_0x4c987f[_0x25e602(0x192)];_0x32705b+=_0x25e602(0x1d1)+_0x28725e+'`\x0a';}!_0x4c987f[_0x25e602(0x186)]&&(_0x32705b+=_0x25e602(0x18d)),await this[_0x25e602(0x1a8)](_0x8100e1,_0x32705b,{'parse_mode':_0x25e602(0x1a9)}),console[_0x25e602(0x151)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x8100e1+':\x20'+(_0x4c987f['success']?_0x25e602(0x186):_0x25e602(0x202)));}catch(_0x1c5c3a){console[_0x25e602(0x1d8)](_0x25e602(0x206),_0x1c5c3a);}}async[a66_0x3f1bdf(0x1f4)](_0x9a8bb6,_0x50ab46){const _0x32220b=a66_0x3f1bdf;try{const _0x2846ee=await database_1[_0x32220b(0x1bb)][_0x32220b(0x18c)]['findUnique']({'where':{'shopId':_0x9a8bb6},'select':{'notificationApiError':!![]}});if(!_0x2846ee?.[_0x32220b(0x193)]){console[_0x32220b(0x151)](_0x32220b(0x1e6)+_0x9a8bb6);return;}let _0x5537b2='🚨\x20*API\x20Error*\x0a\x0a'+('🔗\x20Endpoint:\x20`'+_0x50ab46[_0x32220b(0x1b2)]+'\x20'+_0x50ab46[_0x32220b(0x166)]+'`\x0a')+(_0x32220b(0x1be)+_0x50ab46[_0x32220b(0x12f)][_0x32220b(0x1bc)]('en-US')+'\x0a');_0x50ab46[_0x32220b(0x14e)]&&(_0x5537b2+=_0x32220b(0x145)+_0x50ab46[_0x32220b(0x14e)]+'`\x0a'),_0x5537b2+='❌\x20Error:\x20`'+_0x50ab46['errorMessage']+'`\x0a',_0x50ab46[_0x32220b(0x19c)]&&(_0x5537b2+=_0x32220b(0x1b6)+_0x50ab46[_0x32220b(0x19c)]+'`\x0a'),_0x5537b2+=_0x32220b(0x136),await this[_0x32220b(0x1a8)](_0x9a8bb6,_0x5537b2,{'parse_mode':_0x32220b(0x1a9)}),console[_0x32220b(0x151)](_0x32220b(0x1b5)+_0x9a8bb6+':\x20'+_0x50ab46['endpoint']);}catch(_0x56d382){console[_0x32220b(0x1d8)](_0x32220b(0x1bd),_0x56d382);}}async[a66_0x3f1bdf(0x1e9)](_0x5274c5,_0x14f935,_0x50c9ca){const _0x34e6bd=a66_0x3f1bdf;let _0x27642a=_0x34e6bd(0x15b)+_0x14f935+_0x34e6bd(0x1b1);for(const [_0x3bb6c1,_0x5ebb0d]of Object['entries'](_0x50c9ca)){_0x5ebb0d!==null&&_0x5ebb0d!==undefined&&(_0x27642a+=_0x3bb6c1+_0x34e6bd(0x1c0)+_0x5ebb0d+'`\x0a');}await this['sendShopNotification'](_0x5274c5,_0x27642a,{'parse_mode':_0x34e6bd(0x1a9)});}async[a66_0x3f1bdf(0x13c)](_0x189bbc){const _0x191e8a=a66_0x3f1bdf;try{console['log'](_0x191e8a(0x1ae)+_0x189bbc['substring'](0x0,0x32)+'...');const _0x41526b=await database_1[_0x191e8a(0x1bb)][_0x191e8a(0x12a)][_0x191e8a(0x1ef)]({'select':{'telegramId':!![]}});if(_0x41526b[_0x191e8a(0x16b)]===0x0){console[_0x191e8a(0x151)](_0x191e8a(0x174));return;}for(const _0x2cc6c7 of _0x41526b){try{await this['bot']?.[_0x191e8a(0x153)](_0x2cc6c7['telegramId'],_0x189bbc,{'parse_mode':_0x191e8a(0x1a9)});}catch(_0x559e9a){console['error'](_0x191e8a(0x1c3)+_0x2cc6c7[_0x191e8a(0x1dc)]+':',_0x559e9a);}}console[_0x191e8a(0x151)](_0x191e8a(0x14d)+_0x41526b[_0x191e8a(0x16b)]+'\x20users');}catch(_0x34cf7b){console['error']('❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:',_0x34cf7b);}}[a66_0x3f1bdf(0x1ba)](){const _0x31cc15=a66_0x3f1bdf;return{'isActive':!!this['bot'],'username':this[_0x31cc15(0x17a)]};}async[a66_0x3f1bdf(0x129)](_0x5ba663,_0x5d84d5,_0x1eab81,_0x44bd6c){const _0x12f888=a66_0x3f1bdf;try{if(!this[_0x12f888(0x1cd)])return console['error']('❌\x20Telegram\x20bot\x20not\x20initialized'),![];const _0x4a32e4=await database_1[_0x12f888(0x1bb)][_0x12f888(0x12a)][_0x12f888(0x1ef)]({'where':{'shopId':_0x5ba663,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x4a32e4[_0x12f888(0x16b)]===0x0)return console[_0x12f888(0x1d8)](_0x12f888(0x1ad)+_0x5ba663),![];let _0x1cbaa7=0x0;for(const _0x54c1aa of _0x4a32e4){try{await this[_0x12f888(0x1cd)]['sendDocument'](_0x54c1aa[_0x12f888(0x1dc)],_0x5d84d5,{},{'filename':_0x1eab81,'contentType':_0x1eab81[_0x12f888(0x18a)](_0x12f888(0x1f9))?_0x12f888(0x1fc):_0x1eab81[_0x12f888(0x18a)]('.jpg')||_0x1eab81['endsWith'](_0x12f888(0x1ac))?_0x12f888(0x1f7):_0x1eab81[_0x12f888(0x18a)](_0x12f888(0x20d))?_0x12f888(0x1d4):_0x12f888(0x204)}),_0x44bd6c&&await this['bot'][_0x12f888(0x153)](_0x54c1aa['telegramId'],_0x44bd6c),_0x1cbaa7++;}catch(_0x58d18f){console[_0x12f888(0x1d8)](_0x12f888(0x1d2)+_0x54c1aa[_0x12f888(0x1dc)]+':',_0x58d18f);}}return console['log'](_0x12f888(0x1e1)+_0x1cbaa7+'/'+_0x4a32e4[_0x12f888(0x16b)]+_0x12f888(0x1f1)+_0x5ba663+':\x20'+_0x1eab81),_0x1cbaa7>0x0;}catch(_0x506a95){return console[_0x12f888(0x1d8)](_0x12f888(0x1e5),_0x506a95),![];}}async['sendDirectMessage'](_0x15dac2,_0x340c59){const _0x1528e6=a66_0x3f1bdf;try{if(!this[_0x1528e6(0x1cd)])return console[_0x1528e6(0x1d8)](_0x1528e6(0x1c8)),![];return await this[_0x1528e6(0x1cd)][_0x1528e6(0x153)](_0x15dac2,_0x340c59),console[_0x1528e6(0x151)](_0x1528e6(0x175)+_0x15dac2),!![];}catch(_0x3e389e){return console[_0x1528e6(0x1d8)](_0x1528e6(0x16a),_0x3e389e),![];}}async[a66_0x3f1bdf(0x133)](_0x459841,_0x20879c,_0x3168e3,_0x239adb){const _0x536df6=a66_0x3f1bdf;try{if(!this[_0x536df6(0x1cd)])return console[_0x536df6(0x1d8)](_0x536df6(0x1c8)),![];return await this[_0x536df6(0x1cd)][_0x536df6(0x1ed)](_0x459841,_0x20879c,{},{'filename':_0x3168e3,'contentType':_0x3168e3[_0x536df6(0x18a)](_0x536df6(0x1f9))?_0x536df6(0x1fc):_0x3168e3['endsWith'](_0x536df6(0x1c5))||_0x3168e3[_0x536df6(0x18a)](_0x536df6(0x1ac))?_0x536df6(0x1f7):_0x3168e3[_0x536df6(0x18a)](_0x536df6(0x20d))?_0x536df6(0x1d4):_0x536df6(0x204)}),_0x239adb&&await this[_0x536df6(0x1cd)]['sendMessage'](_0x459841,_0x239adb),console[_0x536df6(0x151)](_0x536df6(0x1a6)+_0x459841+':\x20'+_0x3168e3),!![];}catch(_0x16af0d){return console[_0x536df6(0x1d8)]('❌\x20Error\x20sending\x20file\x20to\x20chat:',_0x16af0d),![];}}[a66_0x3f1bdf(0x1ee)](){const _0x5753e0=a66_0x3f1bdf;this[_0x5753e0(0x1cd)]&&(this[_0x5753e0(0x1cd)][_0x5753e0(0x130)](),this[_0x5753e0(0x1cd)]=null,console[_0x5753e0(0x151)](_0x5753e0(0x1af)));}}exports['TelegramBotService']=TelegramBotService,exports[a66_0x3f1bdf(0x143)]=new TelegramBotService();