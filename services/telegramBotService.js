'use strict';const a49_0xf56bc2=a49_0x4fb4;(function(_0x324809,_0x475bd6){const _0x5ef824=a49_0x4fb4,_0x50255e=_0x324809();while(!![]){try{const _0x1ec537=-parseInt(_0x5ef824(0x22b))/0x1+parseInt(_0x5ef824(0x23a))/0x2+parseInt(_0x5ef824(0x242))/0x3+parseInt(_0x5ef824(0x291))/0x4+parseInt(_0x5ef824(0x28a))/0x5*(-parseInt(_0x5ef824(0x21b))/0x6)+-parseInt(_0x5ef824(0x249))/0x7*(parseInt(_0x5ef824(0x25e))/0x8)+parseInt(_0x5ef824(0x203))/0x9*(parseInt(_0x5ef824(0x273))/0xa);if(_0x1ec537===_0x475bd6)break;else _0x50255e['push'](_0x50255e['shift']());}catch(_0x72c58d){_0x50255e['push'](_0x50255e['shift']());}}}(a49_0x5492,0xcb9af));var __importDefault=this&&this[a49_0xf56bc2(0x232)]||function(_0x78395){return _0x78395&&_0x78395['__esModule']?_0x78395:{'default':_0x78395};};Object[a49_0xf56bc2(0x1c2)](exports,'__esModule',{'value':!![]}),exports[a49_0xf56bc2(0x254)]=exports[a49_0xf56bc2(0x246)]=void 0x0;function a49_0x5492(){const _0x53ff7c=['`.\x0a\x0a','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','Telegram\x20bot\x20polling\x20error:','stopPolling','Commands:\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','warn','/disconnect\x20-\x20disconnect\x20from\x20notifications','bot','log','❌\x20Error\x20getting\x20debug\x20information.','telegramUser','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','includes','updatedAt','unknown\x20shop','trapay_bot','onText','defineProperty','../types/gateway','username','sendLoginNotification','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','env','\x22\x20->\x20display\x20\x22','💰\x20Amount:\x20*','shopSettings','Example:\x0a','from','telegramId','\x20parts:\x20','\x20verified\x20for\x20shop\x20','sendApiErrorNotification','🔍\x20*Debug\x20Information*\x0a\x0a','pk_','❌\x20Error:\x20`','✅\x20Telegram\x20bot\x20@','🏪\x20Gateway:\x20`','customerEmail','\x20USDT*\x0a','initializeBot','success','Payment\x20chargeback','Failed\x20to\x20send\x20login\x20notification:','TELEGRAM_BOT_TOKEN','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','💸\x20Amount:\x20*','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','text','Use\x20/start\x20to\x20connect.','📧\x20Email:\x20`','✅\x20Telegram\x20user\x20','🆔\x20Payment\x20ID:\x20`','Payout\x20completed','createdAt','🏪\x20Available\x20shops\x20in\x20system:\x0a','processing','handleSingleLineVerification','📱\x20Your\x20Telegram\x20ID:\x20`','findUnique','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','blocked','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','Available\x20usernames:\x0a','isVerified','sendPaymentNotification','❌\x20Shop\x20with\x20username\x20`','default','💸\x20Penalty\x20amount:\x20*','\x20\x20\x20Username:\x20`','error','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','customerName','secretKey','...\x22','update','\x20(@','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','...`\x0a\x0a','📝\x20Notes:\x20','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','9SuIkBX','📱\x20Telegram\x20notification:\x20gateway\x20\x22','🌐\x20IP\x20address:\x20`','📅\x20Connection\x20date:\x20','•\x20Payment\x20status\x20changes\x0a','orderId','statusCode','findMany','•\x20New\x20payments\x0a','userAgent','📊\x20*Connection\x20Status*\x0a\x0a','🛑\x20Telegram\x20bot\x20stopped','\x0aCheck\x20spelling\x20and\x20try\x20again.','\x22,\x20apiKey=\x22','getBotInfo','map','sendMessage','startsWith','requestId','New\x20payout\x20created','•\x20Important\x20events\x0a\x0a','shopId','\x20\x20\x20Public\x20Key:\x20`','setupBotHandlers','6eREshI',':\x20username=\x22','en-US','`\x20is\x20inactive.\x0a\x0a','chargebackAmount','Payment\x20expired','ACTIVE','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','notificationApiError','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','trim','errorMessage','split','Error\x20handling\x20message:','forEach','amount','1294331FtCwNo','sendShopNotification','🆔\x20Request\x20ID:\x20`','chat\x20not\x20found','\x0a👤\x20*Customer\x20Information:*\x0a','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','New\x20payment\x20created','__importDefault','TELEGRAM_BOT_USERNAME','txid','❌\x20Invalid\x20username\x20format:\x20`','🆔\x20Payout\x20ID:\x20`','timestamp','Use\x20/start\x20to\x20begin.','botToken','2750034VpVQQG','Error\x20sending\x20shop\x20notification:','❌\x20Please\x20use\x20/start\x20command\x20first','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','length','Check\x20spelling\x20and\x20try\x20again.','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','📅\x20Date:\x20','269544uRyDZM','❌\x20Shop\x20`','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','node-telegram-bot-api','TelegramBotService','👤\x20Username:\x20`','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','14uXGPmx','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','Error\x20in\x20handleSingleLineVerification:','*\x0a\x0a',':\x20`','`\x0a\x0a','Markdown','adminNotes','message','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','sendPayoutNotification','telegramBotService','findFirst','ipAddress','.\x20*','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','entries','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','💻\x20Browser:\x20`','📱\x20Created\x20new\x20Telegram\x20user:\x20','chargeback','1941592bBZQSp','•\x20Payouts\x0a','endpoint','`\x20not\x20found.\x0a\x0a','/status\x20-\x20check\x20connection\x20status\x0a','Failed\x20to\x20send\x20API\x20error\x20notification:','📅\x20Time:\x20','botUsername','publicKey','substring','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','Error\x20handling\x20/start\x20command:','allSettled','method','Telegram\x20bot\x20error:','📊\x20Error\x20code:\x20`','failed','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','•\x20Payouts\x0a\x0a','shop','\x20via\x20single-line\x20input','7864810HiNLEe','polling_error','🔔\x20Notifications\x20are\x20active\x0a\x0a','Error\x20handling\x20/status\x20command:','🔗\x20Endpoint:\x20`','\x20initialized\x20successfully','Payment\x20successfully\x20paid','../config/database','User\x20','🔌\x20User\x20','Failed\x20login\x20attempt','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','chat','gateway','Contact\x20administrator.','📱\x20Shop:\x20*','sk_','Payment\x20is\x20being\x20processed','*.\x0a\x0a','status','name','toString','4102435FyUkRT','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','🔗\x20TXID:\x20`','getGatewayDisplayNameForTelegram','toLocaleString','🎉\x20*Congratulations!*\x0a\x0a','4731348rfOfey'];a49_0x5492=function(){return _0x53ff7c;};return a49_0x5492();}const node_telegram_bot_api_1=__importDefault(require(a49_0xf56bc2(0x245))),database_1=__importDefault(require(a49_0xf56bc2(0x27a))),gateway_1=require(a49_0xf56bc2(0x1c3));class TelegramBotService{constructor(){const _0x3079d0=a49_0xf56bc2;this[_0x3079d0(0x1b7)]=null,this[_0x3079d0(0x239)]=process['env'][_0x3079d0(0x1dc)]||'',this['botUsername']=process[_0x3079d0(0x1c7)][_0x3079d0(0x233)]||_0x3079d0(0x1c0),this[_0x3079d0(0x239)]?this['initializeBot']():console[_0x3079d0(0x1b5)](_0x3079d0(0x293));}[a49_0xf56bc2(0x1d8)](){const _0x1963ea=a49_0xf56bc2;try{this['bot']=new node_telegram_bot_api_1[(_0x1963ea(0x1f4))](this[_0x1963ea(0x239)],{'polling':!![]}),this[_0x1963ea(0x21a)](),console[_0x1963ea(0x1b8)](_0x1963ea(0x1d4)+this[_0x1963ea(0x265)]+_0x1963ea(0x278));}catch(_0x40de58){console[_0x1963ea(0x1f7)](_0x1963ea(0x1fe),_0x40de58);}}[a49_0xf56bc2(0x21a)](){const _0x1da9a=a49_0xf56bc2;if(!this['bot'])return;this[_0x1da9a(0x1b7)]['onText'](/\/start/,async _0x356b57=>{const _0x587baf=_0x1da9a,_0x45ee9d=_0x356b57['chat']['id'],_0x34fadf=_0x356b57['from']?.['id'][_0x587baf(0x289)](),_0x5d7643=_0x356b57[_0x587baf(0x1cc)]?.[_0x587baf(0x1c4)],_0x428f81=_0x356b57['from']?.['first_name'],_0x28c3e5=_0x356b57[_0x587baf(0x1cc)]?.['last_name'];if(!_0x34fadf)return;try{let _0x14126b=await database_1['default'][_0x587baf(0x1ba)][_0x587baf(0x1ec)]({'where':{'telegramId':_0x34fadf},'include':{'shop':!![]}});!_0x14126b?(_0x14126b=await database_1['default']['telegramUser']['create']({'data':{'telegramId':_0x34fadf,'username':_0x5d7643,'firstName':_0x428f81,'lastName':_0x28c3e5,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x587baf(0x1b8)](_0x587baf(0x25c)+_0x34fadf+_0x587baf(0x1fd)+_0x5d7643+')')):_0x14126b=await database_1[_0x587baf(0x1f4)]['telegramUser'][_0x587baf(0x1fc)]({'where':{'telegramId':_0x34fadf},'data':{'username':_0x5d7643,'firstName':_0x428f81,'lastName':_0x28c3e5},'include':{'shop':!![]}}),_0x14126b[_0x587baf(0x1f1)]&&_0x14126b['shopId']&&_0x14126b['shop']?await this[_0x587baf(0x1b7)]?.[_0x587baf(0x213)](_0x45ee9d,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x587baf(0x1b4)+_0x14126b[_0x587baf(0x271)][_0x587baf(0x288)]+'*\x0a')+('Username:\x20`'+_0x14126b[_0x587baf(0x271)][_0x587baf(0x1c4)]+'`\x0a\x0a')+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x587baf(0x207)+_0x587baf(0x270)+_0x587baf(0x1b2)+_0x587baf(0x262)+_0x587baf(0x1b6),{'parse_mode':'Markdown'}):(_0x14126b[_0x587baf(0x218)]&&!_0x14126b[_0x587baf(0x1f1)]&&(await database_1['default'][_0x587baf(0x1ba)][_0x587baf(0x1fc)]({'where':{'telegramId':_0x34fadf},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x34fadf)),await this['bot']?.[_0x587baf(0x213)](_0x45ee9d,_0x587baf(0x1ed)+_0x587baf(0x27e)+_0x587baf(0x26f)+_0x587baf(0x1cb)+_0x587baf(0x27f)+_0x587baf(0x244),{'parse_mode':_0x587baf(0x24f)}));}catch(_0x141240){console[_0x587baf(0x1f7)](_0x587baf(0x269),_0x141240),await this[_0x587baf(0x1b7)]?.[_0x587baf(0x213)](_0x45ee9d,_0x587baf(0x1ef));}}),this[_0x1da9a(0x1b7)][_0x1da9a(0x1c1)](/\/disconnect/,async _0x3b4338=>{const _0x3d432b=_0x1da9a,_0x174e34=_0x3b4338[_0x3d432b(0x280)]['id'],_0x512cea=_0x3b4338[_0x3d432b(0x1cc)]?.['id'][_0x3d432b(0x289)]();if(!_0x512cea)return;try{const _0x470368=await database_1['default']['telegramUser'][_0x3d432b(0x1ec)]({'where':{'telegramId':_0x512cea},'include':{'shop':!![]}});if(!_0x470368||!_0x470368[_0x3d432b(0x1f1)]||!_0x470368[_0x3d432b(0x218)]){await this[_0x3d432b(0x1b7)]?.[_0x3d432b(0x213)](_0x174e34,_0x3d432b(0x1de));return;}const _0x3e5a8b=_0x470368[_0x3d432b(0x271)]?.[_0x3d432b(0x288)]||_0x3d432b(0x1bf);await database_1[_0x3d432b(0x1f4)][_0x3d432b(0x1ba)][_0x3d432b(0x1fc)]({'where':{'telegramId':_0x512cea},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x3d432b(0x27c)+_0x512cea+'\x20disconnected\x20from\x20shop\x20'+_0x470368[_0x3d432b(0x218)]),await this[_0x3d432b(0x1b7)]?.[_0x3d432b(0x213)](_0x174e34,_0x3d432b(0x1b3)+_0x3e5a8b+_0x3d432b(0x286)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x3d432b(0x24f)});}catch(_0x54711d){console[_0x3d432b(0x1f7)]('Error\x20handling\x20/disconnect\x20command:',_0x54711d),await this[_0x3d432b(0x1b7)]?.['sendMessage'](_0x174e34,_0x3d432b(0x1ef));}}),this[_0x1da9a(0x1b7)][_0x1da9a(0x1c1)](/\/status/,async _0xca12cd=>{const _0x38681e=_0x1da9a,_0x1dfa4a=_0xca12cd[_0x38681e(0x280)]['id'],_0x3e440a=_0xca12cd['from']?.['id']['toString']();if(!_0x3e440a)return;try{const _0x5a2ba9=await database_1[_0x38681e(0x1f4)][_0x38681e(0x1ba)][_0x38681e(0x1ec)]({'where':{'telegramId':_0x3e440a},'include':{'shop':!![]}});if(!_0x5a2ba9){await this['bot']?.['sendMessage'](_0x1dfa4a,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x38681e(0x238));return;}if(!_0x5a2ba9['isVerified']||!_0x5a2ba9[_0x38681e(0x218)]||!_0x5a2ba9[_0x38681e(0x271)]){await this[_0x38681e(0x1b7)]?.[_0x38681e(0x213)](_0x1dfa4a,_0x38681e(0x1e0)+_0x38681e(0x1e2));return;}await this[_0x38681e(0x1b7)]?.[_0x38681e(0x213)](_0x1dfa4a,_0x38681e(0x20d)+('✅\x20Connected\x20to\x20shop:\x20*'+_0x5a2ba9[_0x38681e(0x271)][_0x38681e(0x288)]+'*\x0a')+(_0x38681e(0x247)+_0x5a2ba9[_0x38681e(0x271)]['username']+'`\x0a')+(_0x38681e(0x206)+_0x5a2ba9[_0x38681e(0x1be)]['toLocaleDateString'](_0x38681e(0x21d))+'\x0a\x0a')+_0x38681e(0x275)+_0x38681e(0x1b2)+_0x38681e(0x1b6),{'parse_mode':_0x38681e(0x24f)});}catch(_0x18d2d2){console[_0x38681e(0x1f7)](_0x38681e(0x276),_0x18d2d2),await this[_0x38681e(0x1b7)]?.[_0x38681e(0x213)](_0x1dfa4a,_0x38681e(0x1ef));}}),this[_0x1da9a(0x1b7)]['onText'](/\/debug/,async _0x13fd5c=>{const _0x590419=_0x1da9a,_0x1540f7=_0x13fd5c['chat']['id'],_0x8269f4=_0x13fd5c[_0x590419(0x1cc)]?.['id'][_0x590419(0x289)]();if(!_0x8269f4)return;try{const _0x4335cc=await database_1[_0x590419(0x1f4)][_0x590419(0x271)][_0x590419(0x20a)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x57bd3d=_0x590419(0x1d1);_0x57bd3d+=_0x590419(0x1eb)+_0x8269f4+_0x590419(0x24e),_0x57bd3d+=_0x590419(0x1e8),_0x4335cc[_0x590419(0x229)]((_0x1b5940,_0x4fba91)=>{const _0x1f1fba=_0x590419;_0x57bd3d+=_0x4fba91+0x1+_0x1f1fba(0x257)+_0x1b5940[_0x1f1fba(0x288)]+'*\x0a',_0x57bd3d+=_0x1f1fba(0x1f6)+_0x1b5940[_0x1f1fba(0x1c4)]+'`\x0a',_0x57bd3d+='\x20\x20\x20Status:\x20'+_0x1b5940[_0x1f1fba(0x287)]+'\x0a',_0x57bd3d+=_0x1f1fba(0x219)+_0x1b5940[_0x1f1fba(0x266)]['substring'](0x0,0xf)+_0x1f1fba(0x200);}),await this['bot']?.[_0x590419(0x213)](_0x1540f7,_0x57bd3d,{'parse_mode':_0x590419(0x24f)});}catch(_0x5091e6){console[_0x590419(0x1f7)]('Error\x20handling\x20/debug\x20command:',_0x5091e6),await this[_0x590419(0x1b7)]?.[_0x590419(0x213)](_0x1540f7,_0x590419(0x1b9));}}),this[_0x1da9a(0x1b7)]['on'](_0x1da9a(0x251),async _0x1cfa8b=>{const _0x52f76c=_0x1da9a;if(_0x1cfa8b[_0x52f76c(0x1e1)]?.[_0x52f76c(0x214)]('/'))return;const _0x344af9=_0x1cfa8b[_0x52f76c(0x280)]['id'],_0x36e858=_0x1cfa8b[_0x52f76c(0x1cc)]?.['id']['toString'](),_0x5fa77c=_0x1cfa8b[_0x52f76c(0x1e1)]?.[_0x52f76c(0x225)]();if(!_0x36e858||!_0x5fa77c)return;try{const _0x3ac43e=await database_1[_0x52f76c(0x1f4)][_0x52f76c(0x1ba)][_0x52f76c(0x1ec)]({'where':{'telegramId':_0x36e858},'include':{'shop':!![]}});if(!_0x3ac43e){await this[_0x52f76c(0x1b7)]?.[_0x52f76c(0x213)](_0x344af9,_0x52f76c(0x23c));return;}if(_0x3ac43e[_0x52f76c(0x1f1)]&&_0x3ac43e[_0x52f76c(0x218)]&&_0x3ac43e['shop']){await this['bot']?.['sendMessage'](_0x344af9,_0x52f76c(0x230)+_0x3ac43e[_0x52f76c(0x271)][_0x52f76c(0x288)]+_0x52f76c(0x286)+_0x52f76c(0x28c),{'parse_mode':_0x52f76c(0x24f)});return;}const _0x5bde52=_0x5fa77c[_0x52f76c(0x227)](/\s+/);if(_0x5bde52[_0x52f76c(0x23e)]!==0x2){await this['bot']?.['sendMessage'](_0x344af9,_0x52f76c(0x240)+_0x52f76c(0x26f)+_0x52f76c(0x1cb)+_0x52f76c(0x27f)+('You\x20sent\x20'+_0x5bde52[_0x52f76c(0x23e)]+_0x52f76c(0x1ce)+_0x5bde52[_0x52f76c(0x212)](_0x3141e6=>'`'+_0x3141e6+'`')['join'](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x3e21e9,_0x3eb957]=_0x5bde52;console[_0x52f76c(0x1b8)](_0x52f76c(0x222)+_0x36e858+_0x52f76c(0x21c)+_0x3e21e9+_0x52f76c(0x210)+_0x3eb957[_0x52f76c(0x267)](0x0,0xa)+_0x52f76c(0x1fb)),await this[_0x52f76c(0x1ea)](_0x344af9,_0x36e858,_0x3e21e9,_0x3eb957);}catch(_0x5ddd9e){console['error'](_0x52f76c(0x228),_0x5ddd9e),await this['bot']?.[_0x52f76c(0x213)](_0x344af9,_0x52f76c(0x1ef));}}),this[_0x1da9a(0x1b7)]['on'](_0x1da9a(0x1f7),_0xd462f3=>{const _0x123ecc=_0x1da9a;console[_0x123ecc(0x1f7)](_0x123ecc(0x26c),_0xd462f3);}),this[_0x1da9a(0x1b7)]['on'](_0x1da9a(0x274),_0x46d677=>{const _0x23a96a=_0x1da9a;console[_0x23a96a(0x1f7)](_0x23a96a(0x1b0),_0x46d677);});}async[a49_0xf56bc2(0x1ea)](_0x7bcd62,_0x20bb52,_0x358368,_0x53e916){const _0x34cfef=a49_0xf56bc2;try{console['log'](_0x34cfef(0x222)+_0x20bb52+_0x34cfef(0x21c)+_0x358368+_0x34cfef(0x210)+_0x53e916['substring'](0x0,0xa)+'...\x22');if(!_0x358368||_0x358368[_0x34cfef(0x23e)]<0x3||_0x358368['length']>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x358368)){await this[_0x34cfef(0x1b7)]?.[_0x34cfef(0x213)](_0x7bcd62,_0x34cfef(0x235)+_0x358368+_0x34cfef(0x24e)+_0x34cfef(0x25a),{'parse_mode':_0x34cfef(0x24f)});return;}if(!_0x53e916||!_0x53e916[_0x34cfef(0x214)](_0x34cfef(0x1d2))&&!_0x53e916[_0x34cfef(0x214)](_0x34cfef(0x284))){await this[_0x34cfef(0x1b7)]?.[_0x34cfef(0x213)](_0x7bcd62,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x34cfef(0x1ff),{'parse_mode':_0x34cfef(0x24f)});return;}const _0x3ee7c6=await database_1[_0x34cfef(0x1f4)][_0x34cfef(0x271)][_0x34cfef(0x1ec)]({'where':{'username':_0x358368},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x3ee7c6){const _0x18ba18=await database_1['default']['shop'][_0x34cfef(0x20a)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x271131=_0x34cfef(0x1f3)+_0x358368+_0x34cfef(0x261);_0x18ba18[_0x34cfef(0x23e)]>0x0?(_0x271131+=_0x34cfef(0x1f0),_0x18ba18[_0x34cfef(0x229)](_0x594347=>{const _0x23199f=_0x34cfef;_0x271131+='•\x20`'+_0x594347['username']+'`\x20('+_0x594347[_0x23199f(0x288)]+')\x0a';}),_0x271131+=_0x34cfef(0x20f)):_0x271131+=_0x34cfef(0x23f);await this[_0x34cfef(0x1b7)]?.['sendMessage'](_0x7bcd62,_0x271131,{'parse_mode':_0x34cfef(0x24f)});return;}if(_0x3ee7c6[_0x34cfef(0x287)]!==_0x34cfef(0x221)){await this['bot']?.[_0x34cfef(0x213)](_0x7bcd62,_0x34cfef(0x243)+_0x358368+_0x34cfef(0x21e)+_0x34cfef(0x282),{'parse_mode':_0x34cfef(0x24f)});return;}if(_0x3ee7c6[_0x34cfef(0x266)]!==_0x53e916&&_0x3ee7c6[_0x34cfef(0x1fa)]!==_0x53e916){await this[_0x34cfef(0x1b7)]?.[_0x34cfef(0x213)](_0x7bcd62,_0x34cfef(0x1c6)+_0x358368+_0x34cfef(0x292)+_0x34cfef(0x268)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x34cfef(0x24f)});return;}const _0x45c8d2=await database_1[_0x34cfef(0x1f4)][_0x34cfef(0x1ba)][_0x34cfef(0x255)]({'where':{'shopId':_0x3ee7c6['id'],'isVerified':!![],'telegramId':{'not':_0x20bb52}}});if(_0x45c8d2){await this[_0x34cfef(0x1b7)]?.[_0x34cfef(0x213)](_0x7bcd62,_0x34cfef(0x258)+_0x358368+_0x34cfef(0x292)+_0x34cfef(0x1bc),{'parse_mode':_0x34cfef(0x24f)});return;}await database_1[_0x34cfef(0x1f4)][_0x34cfef(0x1ba)]['update']({'where':{'telegramId':_0x20bb52},'data':{'shopId':_0x3ee7c6['id'],'isVerified':!![]}}),await this[_0x34cfef(0x1b7)]?.[_0x34cfef(0x213)](_0x7bcd62,_0x34cfef(0x290)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x34cfef(0x283)+_0x3ee7c6['name']+'*\x0a')+(_0x34cfef(0x247)+_0x3ee7c6[_0x34cfef(0x1c4)]+'`\x0a\x0a')+_0x34cfef(0x202)+_0x34cfef(0x20b)+_0x34cfef(0x207)+_0x34cfef(0x25f)+_0x34cfef(0x217)+'Commands:\x0a'+_0x34cfef(0x262)+_0x34cfef(0x1b6),{'parse_mode':_0x34cfef(0x24f)}),console[_0x34cfef(0x1b8)](_0x34cfef(0x1e4)+_0x20bb52+_0x34cfef(0x1cf)+_0x3ee7c6[_0x34cfef(0x1c4)]+_0x34cfef(0x272));}catch(_0x51753f){console[_0x34cfef(0x1f7)](_0x34cfef(0x24b),_0x51753f),await this['bot']?.[_0x34cfef(0x213)](_0x7bcd62,_0x34cfef(0x248));}}async[a49_0xf56bc2(0x22c)](_0x2de67e,_0x327fae,_0x26e7fd){const _0x2fd0ab=a49_0xf56bc2;if(!this[_0x2fd0ab(0x1b7)]){console['warn'](_0x2fd0ab(0x1bb));return;}try{const _0xff4d37=await database_1[_0x2fd0ab(0x1f4)][_0x2fd0ab(0x1ba)]['findMany']({'where':{'shopId':_0x2de67e,'isVerified':!![]}});if(_0xff4d37[_0x2fd0ab(0x23e)]===0x0){console[_0x2fd0ab(0x1b8)](_0x2fd0ab(0x24a)+_0x2de67e);return;}const _0xfcc886=_0xff4d37[_0x2fd0ab(0x212)](async _0x56c50c=>{const _0x53181e=_0x2fd0ab;try{await this['bot']?.[_0x53181e(0x213)](_0x56c50c['telegramId'],_0x327fae,_0x26e7fd),console[_0x53181e(0x1b8)](_0x53181e(0x252)+_0x56c50c[_0x53181e(0x1cd)]);}catch(_0xf05568){console['error'](_0x53181e(0x28b)+_0x56c50c['telegramId']+':',_0xf05568),_0xf05568 instanceof Error&&(_0xf05568[_0x53181e(0x251)]['includes'](_0x53181e(0x1ee))||_0xf05568[_0x53181e(0x251)][_0x53181e(0x1bd)](_0x53181e(0x22e))||_0xf05568['message'][_0x53181e(0x1bd)]('user\x20is\x20deactivated'))&&(await database_1[_0x53181e(0x1f4)][_0x53181e(0x1ba)]['update']({'where':{'id':_0x56c50c['id']},'data':{'isVerified':![]}}),console[_0x53181e(0x1b8)](_0x53181e(0x27b)+_0x56c50c['telegramId']+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x2fd0ab(0x26a)](_0xfcc886);}catch(_0x31d97e){console['error'](_0x2fd0ab(0x23b),_0x31d97e);}}async[a49_0xf56bc2(0x1f2)](_0x2a2c83,_0x3b909e,_0x4d5a9c){const _0x10c66b=a49_0xf56bc2,_0x389daf={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x514171={'created':_0x10c66b(0x231),'paid':_0x10c66b(0x279),'failed':'Payment\x20failed','expired':_0x10c66b(0x220),'refund':'Payment\x20refund','chargeback':_0x10c66b(0x1da),'processing':_0x10c66b(0x285)},_0x54d79b=_0x389daf[_0x4d5a9c],_0x4050ae=_0x514171[_0x4d5a9c],_0x34f308=(0x0,gateway_1[_0x10c66b(0x28e)])(_0x3b909e[_0x10c66b(0x281)]);console[_0x10c66b(0x1b8)](_0x10c66b(0x204)+_0x3b909e[_0x10c66b(0x281)]+_0x10c66b(0x1c8)+_0x34f308+'\x22');let _0xbfe251=_0x54d79b+'\x20*'+_0x4050ae+'*\x0a\x0a'+(_0x10c66b(0x1c9)+_0x3b909e[_0x10c66b(0x22a)]+'\x20'+_0x3b909e['currency']+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x3b909e[_0x10c66b(0x208)]||_0x3b909e['id'])+'`\x0a')+(_0x10c66b(0x1e5)+_0x3b909e['id']+'`\x0a')+(_0x10c66b(0x1d5)+_0x34f308+'`\x0a')+(_0x10c66b(0x241)+new Date(_0x3b909e[_0x10c66b(0x1e7)])[_0x10c66b(0x28f)](_0x10c66b(0x21d))+'\x0a');(_0x3b909e[_0x10c66b(0x1f9)]||_0x3b909e['customerEmail'])&&(_0xbfe251+=_0x10c66b(0x22f),_0x3b909e[_0x10c66b(0x1f9)]&&(_0xbfe251+='📛\x20Name:\x20`'+_0x3b909e['customerName']+'`\x0a'),_0x3b909e[_0x10c66b(0x1d6)]&&(_0xbfe251+=_0x10c66b(0x1e3)+_0x3b909e[_0x10c66b(0x1d6)]+'`\x0a')),_0x4d5a9c===_0x10c66b(0x25d)&&_0x3b909e['chargebackAmount']&&(_0xbfe251+=_0x10c66b(0x1f5)+_0x3b909e[_0x10c66b(0x21f)]+_0x10c66b(0x1d7)),_0x4d5a9c===_0x10c66b(0x1e9)&&(_0xbfe251+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x3b909e[_0x10c66b(0x250)]&&(_0xbfe251+=_0x10c66b(0x201)+_0x3b909e[_0x10c66b(0x250)]+'\x0a'),await this[_0x10c66b(0x22c)](_0x2a2c83,_0xbfe251,{'parse_mode':_0x10c66b(0x24f)});}async[a49_0xf56bc2(0x253)](_0x36f229,_0x171eb6,_0x5d2a4d){const _0x454891=a49_0xf56bc2,_0x55eb3b={'created':'📤','completed':'✅','rejected':'❌'},_0x4b3111={'created':_0x454891(0x216),'completed':_0x454891(0x1e6),'rejected':'Payout\x20rejected'},_0xb093f9=_0x55eb3b[_0x5d2a4d],_0x26ba3a=_0x4b3111[_0x5d2a4d],_0x21918b=_0xb093f9+'\x20*'+_0x26ba3a+'*\x0a\x0a'+(_0x454891(0x1df)+_0x171eb6['amount']+'\x20USD*\x0a')+('🏦\x20Method:\x20`'+_0x171eb6[_0x454891(0x26b)]+'`\x0a')+(_0x454891(0x236)+_0x171eb6['id']+'`\x0a')+(_0x454891(0x241)+new Date(_0x171eb6['createdAt'])[_0x454891(0x28f)]('en-US')+'\x0a')+(_0x171eb6[_0x454891(0x234)]?_0x454891(0x28d)+_0x171eb6[_0x454891(0x234)]+'`':'');await this['sendShopNotification'](_0x36f229,_0x21918b,{'parse_mode':_0x454891(0x24f)});}async[a49_0xf56bc2(0x1c5)](_0x3af2e4,_0x15da97){const _0x57ac4f=a49_0xf56bc2;try{const _0x2285af=await database_1[_0x57ac4f(0x1f4)][_0x57ac4f(0x1ca)][_0x57ac4f(0x1ec)]({'where':{'shopId':_0x3af2e4},'select':{'notificationLogin':!![]}});if(!_0x2285af?.['notificationLogin']){console[_0x57ac4f(0x1b8)](_0x57ac4f(0x1dd)+_0x3af2e4);return;}const _0x315396=_0x15da97['success']?'🔐':'🚨',_0x4a9611=_0x15da97[_0x57ac4f(0x1d9)]?'Successful\x20login':_0x57ac4f(0x27d);let _0x50d43f=_0x315396+'\x20*'+_0x4a9611+_0x57ac4f(0x24c)+('👤\x20Username:\x20`'+_0x15da97['username']+'`\x0a')+(_0x57ac4f(0x264)+_0x15da97[_0x57ac4f(0x237)][_0x57ac4f(0x28f)]('en-US')+'\x0a');_0x15da97[_0x57ac4f(0x256)]&&(_0x50d43f+=_0x57ac4f(0x205)+_0x15da97[_0x57ac4f(0x256)]+'`\x0a');if(_0x15da97[_0x57ac4f(0x20c)]){const _0x44ef12=_0x15da97[_0x57ac4f(0x20c)]['length']>0x32?_0x15da97[_0x57ac4f(0x20c)][_0x57ac4f(0x267)](0x0,0x32)+'...':_0x15da97[_0x57ac4f(0x20c)];_0x50d43f+=_0x57ac4f(0x25b)+_0x44ef12+'`\x0a';}!_0x15da97[_0x57ac4f(0x1d9)]&&(_0x50d43f+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this['sendShopNotification'](_0x3af2e4,_0x50d43f,{'parse_mode':'Markdown'}),console[_0x57ac4f(0x1b8)](_0x57ac4f(0x1f8)+_0x3af2e4+':\x20'+(_0x15da97[_0x57ac4f(0x1d9)]?_0x57ac4f(0x1d9):_0x57ac4f(0x26e)));}catch(_0x17d2e8){console['error'](_0x57ac4f(0x1db),_0x17d2e8);}}async[a49_0xf56bc2(0x1d0)](_0x3aef15,_0x44b215){const _0x3da684=a49_0xf56bc2;try{const _0x5f250b=await database_1[_0x3da684(0x1f4)][_0x3da684(0x1ca)][_0x3da684(0x1ec)]({'where':{'shopId':_0x3aef15},'select':{'notificationApiError':!![]}});if(!_0x5f250b?.[_0x3da684(0x223)]){console[_0x3da684(0x1b8)](_0x3da684(0x23d)+_0x3aef15);return;}let _0x3667aa='🚨\x20*API\x20Error*\x0a\x0a'+(_0x3da684(0x277)+_0x44b215['method']+'\x20'+_0x44b215[_0x3da684(0x260)]+'`\x0a')+(_0x3da684(0x264)+_0x44b215[_0x3da684(0x237)][_0x3da684(0x28f)](_0x3da684(0x21d))+'\x0a');_0x44b215[_0x3da684(0x209)]&&(_0x3667aa+=_0x3da684(0x26d)+_0x44b215[_0x3da684(0x209)]+'`\x0a'),_0x3667aa+=_0x3da684(0x1d3)+_0x44b215[_0x3da684(0x226)]+'`\x0a',_0x44b215[_0x3da684(0x215)]&&(_0x3667aa+=_0x3da684(0x22d)+_0x44b215[_0x3da684(0x215)]+'`\x0a'),_0x3667aa+=_0x3da684(0x224),await this[_0x3da684(0x22c)](_0x3aef15,_0x3667aa,{'parse_mode':_0x3da684(0x24f)}),console[_0x3da684(0x1b8)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x3aef15+':\x20'+_0x44b215['endpoint']);}catch(_0x85c3ce){console['error'](_0x3da684(0x263),_0x85c3ce);}}async['sendCustomNotification'](_0x3a98eb,_0x3bc729,_0x118966){const _0xc2f040=a49_0xf56bc2;let _0x1ffc27='🔔\x20*'+_0x3bc729+_0xc2f040(0x24c);for(const [_0x2bc17c,_0x188bae]of Object[_0xc2f040(0x259)](_0x118966)){_0x188bae!==null&&_0x188bae!==undefined&&(_0x1ffc27+=_0x2bc17c+_0xc2f040(0x24d)+_0x188bae+'`\x0a');}await this[_0xc2f040(0x22c)](_0x3a98eb,_0x1ffc27,{'parse_mode':'Markdown'});}[a49_0xf56bc2(0x211)](){const _0x587f4a=a49_0xf56bc2;return{'isActive':!!this[_0x587f4a(0x1b7)],'username':this[_0x587f4a(0x265)]};}['stopBot'](){const _0x53ecb6=a49_0xf56bc2;this['bot']&&(this['bot'][_0x53ecb6(0x1b1)](),this['bot']=null,console[_0x53ecb6(0x1b8)](_0x53ecb6(0x20e)));}}function a49_0x4fb4(_0x125d09,_0x936dd){const _0x549238=a49_0x5492();return a49_0x4fb4=function(_0x4fb4a5,_0x77992c){_0x4fb4a5=_0x4fb4a5-0x1b0;let _0x32e28e=_0x549238[_0x4fb4a5];return _0x32e28e;},a49_0x4fb4(_0x125d09,_0x936dd);}exports['TelegramBotService']=TelegramBotService,exports[a49_0xf56bc2(0x254)]=new TelegramBotService();