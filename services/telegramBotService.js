'use strict';const a66_0x32c948=a66_0x2dc4;(function(_0x122753,_0x3b6c74){const _0x2f339c=a66_0x2dc4,_0x32c766=_0x122753();while(!![]){try{const _0x3dc134=-parseInt(_0x2f339c(0x15c))/0x1+-parseInt(_0x2f339c(0xe1))/0x2*(parseInt(_0x2f339c(0x13a))/0x3)+-parseInt(_0x2f339c(0x18f))/0x4+parseInt(_0x2f339c(0x165))/0x5*(parseInt(_0x2f339c(0x1ae))/0x6)+parseInt(_0x2f339c(0xaf))/0x7+-parseInt(_0x2f339c(0x177))/0x8+parseInt(_0x2f339c(0x13b))/0x9*(parseInt(_0x2f339c(0xf1))/0xa);if(_0x3dc134===_0x3b6c74)break;else _0x32c766['push'](_0x32c766['shift']());}catch(_0x2c3e49){_0x32c766['push'](_0x32c766['shift']());}}}(a66_0x40bc,0x7507e));var __importDefault=this&&this['__importDefault']||function(_0x5b800e){const _0x46b472=a66_0x2dc4;return _0x5b800e&&_0x5b800e[_0x46b472(0x141)]?_0x5b800e:{'default':_0x5b800e};};Object[a66_0x32c948(0x125)](exports,a66_0x32c948(0x141),{'value':!![]}),exports[a66_0x32c948(0x139)]=exports[a66_0x32c948(0x11c)]=void 0x0;function a66_0x40bc(){const _0x4d24c7=['setupBotHandlers','userAgent','333181YNiHMp','\x20USD*\x0a','Markdown','remitterIban','\x20users','sendApiErrorNotification','•\x20Payment\x20status\x20changes\x0a','success','Commands:\x0a','803335BUfHvs','getBotInfo','isVerified','•\x20Payouts\x0a\x0a','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','📱\x20Shop:\x20*','botUsername','🆔\x20Payout\x20ID:\x20`','📅\x20Time:\x20','🔗\x20TXID:\x20`','test','shop','\x20\x20\x20Status:\x20','chargeback','requestId','Successful\x20login','Error\x20handling\x20/disconnect\x20command:','\x20(@','3270592NWTKYR','publicKey','botToken','sendMessage','Payment\x20refund','en-US','name','`\x20is\x20inactive.\x0a\x0a','Failed\x20login\x20attempt','includes','New\x20payment\x20created','join','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','notificationApiError','default','Payment\x20chargeback','map','amount','🔔\x20Notifications\x20are\x20active\x0a\x0a','🌐\x20IP:\x20`','forEach','✅\x20File\x20sent\x20to\x20chat\x20','•\x20New\x20payments\x0a','startsWith','794072GtgVoI','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','adminNotes','customerEmail','👤\x20Username:\x20`','ipAddress','🌐\x20IP\x20address:\x20`','application/pdf','•\x20Important\x20events\x0a\x0a','📝\x20Notes:\x20','getGatewayDisplayNameForTelegram','trapay_bot','image/jpeg','findUnique','findFirst','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','🏪\x20Gateway:\x20`','Payment\x20expired','trim','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','.pdf','Error\x20handling\x20message:','node-telegram-bot-api','updatedAt','handleSingleLineVerification','❌\x20Error\x20sending\x20file\x20to\x20shop:','log','❌\x20Invalid\x20username\x20format:\x20`','🏦\x20Method:\x20`','split','📛\x20Name:\x20`','6hjQaDI','📊\x20Error\x20code:\x20`','✅\x20Telegram\x20user\x20','Error\x20handling\x20/status\x20command:','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','5482449Kpmcip','📱\x20Created\x20new\x20Telegram\x20user:\x20','Payout\x20rejected','Error\x20in\x20handleSingleLineVerification:','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','sendShopNotification','update','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','timestamp','✅\x20File\x20sent\x20to\x20','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','`.\x0a\x0a','\x20users\x20of\x20shop\x20','TELEGRAM_BOT_USERNAME','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','🔌\x20User\x20','📧\x20Email:\x20`','stopBot','Failed\x20to\x20send\x20login\x20notification:','username','\x20initialized\x20successfully','❌\x20Shop\x20with\x20username\x20`','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','✅\x20Connected\x20to\x20shop:\x20*','entries','❌\x20Error\x20sending\x20file\x20to\x20user\x20','...','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','from','Telegram\x20bot\x20error:','❌\x20Telegram\x20bot\x20not\x20initialized','../config/database','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','last_name','length','method','Example:\x0a','env','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','\x20disconnected\x20from\x20shop\x20','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','customerIp','.jpg','Use\x20/start\x20to\x20connect.','🆔\x20Payment\x20ID:\x20`','bot','🛑\x20Telegram\x20bot\x20stopped','first_name','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','158560LNAZXL','sendNotificationToAll','telegramId','\x20verified\x20for\x20shop\x20','toString','❌\x20Shop\x20`',':\x20`','📝\x20Order\x20ID:\x20`','error',':\x20username=\x22','statusCode','unknown\x20shop','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','\x20USDT*\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','toLocaleString','10VtoByr','•\x20`','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','Check\x20spelling\x20and\x20try\x20again.','`\x20not\x20found.\x0a\x0a','customerName','Telegram\x20bot\x20polling\x20error:','customerUa','📱\x20No\x20active\x20Telegram\x20users\x20found','\x20\x20\x20Username:\x20`','Available\x20usernames:\x0a','💰\x20Amount:\x20*','sendDocument','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','📊\x20*Connection\x20Status*\x0a\x0a','🏦\x20IBAN:\x20`','📅\x20Connection\x20date:\x20','warn','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','pk_','secretKey','ACTIVE','text','sendPayoutNotification','New\x20payout\x20created','../types/gateway','blocked','...\x22','\x20parts:\x20','sendDirectMessage','✅\x20Welcome\x20back!\x0a\x0a','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','📱\x20Your\x20Telegram\x20ID:\x20`','/status\x20-\x20check\x20connection\x20status\x0a','🔔\x20You\x20receive\x20notifications\x20about:\x0a','substring','image/png','🏪\x20Available\x20shops\x20in\x20system:\x0a','\x20via\x20single-line\x20input','processing','chat\x20not\x20found','message','TelegramBotService','gateway','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','`\x0a\x0a','Use\x20/start\x20to\x20begin.','endsWith','\x22,\x20apiKey=\x22','\x0a👤\x20*Customer\x20Information:*\x0a','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','defineProperty','🔔\x20*','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','Error\x20handling\x20/start\x20command:','notificationLogin','create','❌\x20Error\x20sending\x20file\x20to\x20chat:','Payment\x20failed','sendPaymentNotification','📱\x20Notification\x20sent\x20to\x20','🔍\x20*Debug\x20Information*\x0a\x0a','❌\x20Error\x20getting\x20debug\x20information.','endpoint','chat','*.\x0a\x0a','findMany','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','Payout\x20completed','onText','sendCustomNotification','telegramBotService','30BILGKM','11419263cPVVIG','Contact\x20administrator.','shopId','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','❌\x20Error\x20sending\x20direct\x20message:','sendLoginNotification','__esModule','*\x0a\x0a','status','Failed\x20to\x20send\x20API\x20error\x20notification:','user\x20is\x20deactivated','application/octet-stream','txid','telegramUser','currency','polling_error','orderId','You\x20sent\x20','initializeBot','🆔\x20Request\x20ID:\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','TELEGRAM_BOT_TOKEN','❌\x20Error:\x20`','.png','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','📱\x20Telegram\x20notification:\x20gateway\x20\x22','shopSettings','📅\x20Date:\x20','💻\x20Browser:\x20`'];a66_0x40bc=function(){return _0x4d24c7;};return a66_0x40bc();}function a66_0x2dc4(_0x55e051,_0x162858){const _0x40bcb1=a66_0x40bc();return a66_0x2dc4=function(_0x2dc471,_0x483a4e){_0x2dc471=_0x2dc471-0xaf;let _0x277652=_0x40bcb1[_0x2dc471];return _0x277652;},a66_0x2dc4(_0x55e051,_0x162858);}const node_telegram_bot_api_1=__importDefault(require(a66_0x32c948(0x1a5))),database_1=__importDefault(require(a66_0x32c948(0xcf))),gateway_1=require(a66_0x32c948(0x10b));class TelegramBotService{constructor(){const _0x391c55=a66_0x32c948;this['bot']=null,this[_0x391c55(0x179)]=process[_0x391c55(0xd5)][_0x391c55(0x151)]||'',this['botUsername']=process[_0x391c55(0xd5)][_0x391c55(0xbd)]||_0x391c55(0x19a),this['botToken']?this[_0x391c55(0x14d)]():console[_0x391c55(0x103)](_0x391c55(0x150));}[a66_0x32c948(0x14d)](){const _0xf06d3b=a66_0x32c948;try{this[_0xf06d3b(0xdd)]=new node_telegram_bot_api_1[(_0xf06d3b(0x185))](this['botToken'],{'polling':!![]}),this[_0xf06d3b(0x15a)](),console[_0xf06d3b(0x1a9)]('✅\x20Telegram\x20bot\x20@'+this['botUsername']+_0xf06d3b(0xc4));}catch(_0x97bc22){console[_0xf06d3b(0xe9)](_0xf06d3b(0x19e),_0x97bc22);}}[a66_0x32c948(0x15a)](){const _0x5dc95f=a66_0x32c948;if(!this[_0x5dc95f(0xdd)])return;this[_0x5dc95f(0xdd)][_0x5dc95f(0x137)](/\/start/,async _0x412ef3=>{const _0x480321=_0x5dc95f,_0x1c2bf1=_0x412ef3[_0x480321(0x132)]['id'],_0x249213=_0x412ef3[_0x480321(0xcc)]?.['id']['toString'](),_0x3e2e33=_0x412ef3['from']?.[_0x480321(0xc3)],_0x319883=_0x412ef3[_0x480321(0xcc)]?.[_0x480321(0xdf)],_0xb41ab0=_0x412ef3['from']?.[_0x480321(0xd1)];if(!_0x249213)return;try{let _0x296d1b=await database_1[_0x480321(0x185)][_0x480321(0x148)]['findUnique']({'where':{'telegramId':_0x249213},'include':{'shop':!![]}});!_0x296d1b?(_0x296d1b=await database_1[_0x480321(0x185)][_0x480321(0x148)][_0x480321(0x12a)]({'data':{'telegramId':_0x249213,'username':_0x3e2e33,'firstName':_0x319883,'lastName':_0xb41ab0,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x480321(0xb0)+_0x249213+_0x480321(0x176)+_0x3e2e33+')')):_0x296d1b=await database_1[_0x480321(0x185)]['telegramUser']['update']({'where':{'telegramId':_0x249213},'data':{'username':_0x3e2e33,'firstName':_0x319883,'lastName':_0xb41ab0},'include':{'shop':!![]}}),_0x296d1b['isVerified']&&_0x296d1b[_0x480321(0x13d)]&&_0x296d1b['shop']?await this[_0x480321(0xdd)]?.['sendMessage'](_0x1c2bf1,_0x480321(0x110)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x296d1b[_0x480321(0x170)]['name']+'*\x0a')+('Username:\x20`'+_0x296d1b[_0x480321(0x170)][_0x480321(0xc3)]+_0x480321(0x11f))+_0x480321(0x114)+'•\x20New\x20payments\x0a'+_0x480321(0x162)+_0x480321(0x168)+_0x480321(0x164)+_0x480321(0x113)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}):(_0x296d1b[_0x480321(0x13d)]&&!_0x296d1b[_0x480321(0x167)]&&(await database_1[_0x480321(0x185)][_0x480321(0x148)][_0x480321(0xb6)]({'where':{'telegramId':_0x249213},'data':{'shopId':null,'isVerified':![]}}),console[_0x480321(0x1a9)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x249213)),await this[_0x480321(0xdd)]?.[_0x480321(0x17a)](_0x1c2bf1,_0x480321(0xe0)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x480321(0x111)+'Example:\x0a'+_0x480321(0xd6)+_0x480321(0xcb),{'parse_mode':_0x480321(0x15e)}));}catch(_0x20c886){console[_0x480321(0xe9)](_0x480321(0x128),_0x20c886),await this[_0x480321(0xdd)]?.['sendMessage'](_0x1c2bf1,_0x480321(0x11e));}}),this['bot'][_0x5dc95f(0x137)](/\/disconnect/,async _0x528c8d=>{const _0x2122b7=_0x5dc95f,_0x36d64b=_0x528c8d['chat']['id'],_0x487198=_0x528c8d[_0x2122b7(0xcc)]?.['id'][_0x2122b7(0xe5)]();if(!_0x487198)return;try{const _0x508e0b=await database_1['default'][_0x2122b7(0x148)][_0x2122b7(0x19c)]({'where':{'telegramId':_0x487198},'include':{'shop':!![]}});if(!_0x508e0b||!_0x508e0b[_0x2122b7(0x167)]||!_0x508e0b[_0x2122b7(0x13d)]){await this[_0x2122b7(0xdd)]?.[_0x2122b7(0x17a)](_0x36d64b,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x55f2b9=_0x508e0b['shop']?.[_0x2122b7(0x17d)]||_0x2122b7(0xec);await database_1[_0x2122b7(0x185)][_0x2122b7(0x148)][_0x2122b7(0xb6)]({'where':{'telegramId':_0x487198},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x2122b7(0xbf)+_0x487198+_0x2122b7(0xd7)+_0x508e0b[_0x2122b7(0x13d)]),await this[_0x2122b7(0xdd)]?.['sendMessage'](_0x36d64b,_0x2122b7(0x1b2)+_0x55f2b9+_0x2122b7(0x133)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x2122b7(0x15e)});}catch(_0x54dbaa){console[_0x2122b7(0xe9)](_0x2122b7(0x175),_0x54dbaa),await this['bot']?.['sendMessage'](_0x36d64b,_0x2122b7(0x11e));}}),this['bot'][_0x5dc95f(0x137)](/\/status/,async _0x69974f=>{const _0x10fd0b=_0x5dc95f,_0x3636b3=_0x69974f[_0x10fd0b(0x132)]['id'],_0x3add58=_0x69974f['from']?.['id'][_0x10fd0b(0xe5)]();if(!_0x3add58)return;try{const _0x22a298=await database_1['default'][_0x10fd0b(0x148)][_0x10fd0b(0x19c)]({'where':{'telegramId':_0x3add58},'include':{'shop':!![]}});if(!_0x22a298){await this[_0x10fd0b(0xdd)]?.[_0x10fd0b(0x17a)](_0x3636b3,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x10fd0b(0x120));return;}if(!_0x22a298[_0x10fd0b(0x167)]||!_0x22a298['shopId']||!_0x22a298[_0x10fd0b(0x170)]){await this[_0x10fd0b(0xdd)]?.[_0x10fd0b(0x17a)](_0x3636b3,_0x10fd0b(0xef)+_0x10fd0b(0xdb));return;}await this[_0x10fd0b(0xdd)]?.[_0x10fd0b(0x17a)](_0x3636b3,_0x10fd0b(0x100)+(_0x10fd0b(0xc7)+_0x22a298[_0x10fd0b(0x170)][_0x10fd0b(0x17d)]+'*\x0a')+(_0x10fd0b(0x193)+_0x22a298['shop'][_0x10fd0b(0xc3)]+'`\x0a')+(_0x10fd0b(0x102)+_0x22a298[_0x10fd0b(0x1a6)]['toLocaleDateString'](_0x10fd0b(0x17c))+'\x0a\x0a')+_0x10fd0b(0x189)+_0x10fd0b(0x164)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x10fd0b(0x15e)});}catch(_0x337ed2){console[_0x10fd0b(0xe9)](_0x10fd0b(0x1b1),_0x337ed2),await this[_0x10fd0b(0xdd)]?.[_0x10fd0b(0x17a)](_0x3636b3,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot'][_0x5dc95f(0x137)](/\/debug/,async _0x28dad6=>{const _0x5d982a=_0x5dc95f,_0x26e739=_0x28dad6[_0x5d982a(0x132)]['id'],_0x543d28=_0x28dad6['from']?.['id'][_0x5d982a(0xe5)]();if(!_0x543d28)return;try{const _0x1675f4=await database_1['default'][_0x5d982a(0x170)][_0x5d982a(0x134)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x5509da=_0x5d982a(0x12f);_0x5509da+=_0x5d982a(0x112)+_0x543d28+_0x5d982a(0x11f),_0x5509da+=_0x5d982a(0x117),_0x1675f4[_0x5d982a(0x18b)]((_0x9b51c6,_0x2550d2)=>{const _0x553762=_0x5d982a;_0x5509da+=_0x2550d2+0x1+'.\x20*'+_0x9b51c6[_0x553762(0x17d)]+'*\x0a',_0x5509da+=_0x553762(0xfa)+_0x9b51c6[_0x553762(0xc3)]+'`\x0a',_0x5509da+=_0x553762(0x171)+_0x9b51c6['status']+'\x0a',_0x5509da+='\x20\x20\x20Public\x20Key:\x20`'+_0x9b51c6['publicKey'][_0x553762(0x115)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x5d982a(0xdd)]?.[_0x5d982a(0x17a)](_0x26e739,_0x5509da,{'parse_mode':_0x5d982a(0x15e)});}catch(_0x3abf14){console[_0x5d982a(0xe9)]('Error\x20handling\x20/debug\x20command:',_0x3abf14),await this[_0x5d982a(0xdd)]?.[_0x5d982a(0x17a)](_0x26e739,_0x5d982a(0x130));}}),this[_0x5dc95f(0xdd)]['on'](_0x5dc95f(0x11b),async _0x2549ba=>{const _0x17ef77=_0x5dc95f;if(_0x2549ba['text']?.[_0x17ef77(0x18e)]('/'))return;const _0x19a9eb=_0x2549ba[_0x17ef77(0x132)]['id'],_0xcc69ac=_0x2549ba[_0x17ef77(0xcc)]?.['id'][_0x17ef77(0xe5)](),_0x87841c=_0x2549ba[_0x17ef77(0x108)]?.[_0x17ef77(0x1a1)]();if(!_0xcc69ac||!_0x87841c)return;try{const _0x1cabee=await database_1['default'][_0x17ef77(0x148)][_0x17ef77(0x19c)]({'where':{'telegramId':_0xcc69ac},'include':{'shop':!![]}});if(!_0x1cabee){await this['bot']?.[_0x17ef77(0x17a)](_0x19a9eb,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x1cabee[_0x17ef77(0x167)]&&_0x1cabee[_0x17ef77(0x13d)]&&_0x1cabee[_0x17ef77(0x170)]){await this['bot']?.[_0x17ef77(0x17a)](_0x19a9eb,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x1cabee[_0x17ef77(0x170)]['name']+'*.\x0a\x0a'+_0x17ef77(0x155),{'parse_mode':_0x17ef77(0x15e)});return;}const _0xa42a4d=_0x87841c[_0x17ef77(0x1ac)](/\s+/);if(_0xa42a4d[_0x17ef77(0xd2)]!==0x2){await this[_0x17ef77(0xdd)]?.[_0x17ef77(0x17a)](_0x19a9eb,_0x17ef77(0xc6)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x17ef77(0xd4)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x17ef77(0x14c)+_0xa42a4d[_0x17ef77(0xd2)]+_0x17ef77(0x10e)+_0xa42a4d[_0x17ef77(0x187)](_0x773532=>'`'+_0x773532+'`')[_0x17ef77(0x182)](',\x20')),{'parse_mode':_0x17ef77(0x15e)});return;}const [_0x5b5dba,_0x602604]=_0xa42a4d;console[_0x17ef77(0x1a9)](_0x17ef77(0xb4)+_0xcc69ac+_0x17ef77(0xea)+_0x5b5dba+_0x17ef77(0x122)+_0x602604[_0x17ef77(0x115)](0x0,0xa)+_0x17ef77(0x10d)),await this['handleSingleLineVerification'](_0x19a9eb,_0xcc69ac,_0x5b5dba,_0x602604);}catch(_0x28dd83){console[_0x17ef77(0xe9)](_0x17ef77(0x1a4),_0x28dd83),await this[_0x17ef77(0xdd)]?.[_0x17ef77(0x17a)](_0x19a9eb,_0x17ef77(0x11e));}}),this[_0x5dc95f(0xdd)]['on']('error',_0x29c69a=>{const _0x1852a1=_0x5dc95f;console[_0x1852a1(0xe9)](_0x1852a1(0xcd),_0x29c69a);}),this['bot']['on'](_0x5dc95f(0x14a),_0x6d0223=>{const _0x4abd3e=_0x5dc95f;console[_0x4abd3e(0xe9)](_0x4abd3e(0xf7),_0x6d0223);});}async[a66_0x32c948(0x1a7)](_0x311448,_0x2cad22,_0x29c5a2,_0x2ea497){const _0x4f8d42=a66_0x32c948;try{console[_0x4f8d42(0x1a9)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x2cad22+_0x4f8d42(0xea)+_0x29c5a2+_0x4f8d42(0x122)+_0x2ea497['substring'](0x0,0xa)+_0x4f8d42(0x10d));if(!_0x29c5a2||_0x29c5a2['length']<0x3||_0x29c5a2['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x4f8d42(0x16f)](_0x29c5a2)){await this[_0x4f8d42(0xdd)]?.[_0x4f8d42(0x17a)](_0x311448,_0x4f8d42(0x1aa)+_0x29c5a2+'`\x0a\x0a'+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x4f8d42(0x15e)});return;}if(!_0x2ea497||!_0x2ea497[_0x4f8d42(0x18e)](_0x4f8d42(0x105))&&!_0x2ea497[_0x4f8d42(0x18e)]('sk_')){await this[_0x4f8d42(0xdd)]?.[_0x4f8d42(0x17a)](_0x311448,_0x4f8d42(0x104)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x4f8d42(0x15e)});return;}const _0x6aef42=await database_1[_0x4f8d42(0x185)][_0x4f8d42(0x170)][_0x4f8d42(0x19c)]({'where':{'username':_0x29c5a2},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x6aef42){const _0x1af1d6=await database_1['default'][_0x4f8d42(0x170)][_0x4f8d42(0x134)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x40ebd8=_0x4f8d42(0xc5)+_0x29c5a2+_0x4f8d42(0xf5);_0x1af1d6[_0x4f8d42(0xd2)]>0x0?(_0x40ebd8+=_0x4f8d42(0xfb),_0x1af1d6[_0x4f8d42(0x18b)](_0x4170d9=>{const _0x135739=_0x4f8d42;_0x40ebd8+=_0x135739(0xf2)+_0x4170d9[_0x135739(0xc3)]+'`\x20('+_0x4170d9['name']+')\x0a';}),_0x40ebd8+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x40ebd8+=_0x4f8d42(0xf4);await this['bot']?.['sendMessage'](_0x311448,_0x40ebd8,{'parse_mode':_0x4f8d42(0x15e)});return;}if(_0x6aef42[_0x4f8d42(0x143)]!==_0x4f8d42(0x107)){await this[_0x4f8d42(0xdd)]?.[_0x4f8d42(0x17a)](_0x311448,_0x4f8d42(0xe6)+_0x29c5a2+_0x4f8d42(0x17e)+_0x4f8d42(0x13c),{'parse_mode':'Markdown'});return;}if(_0x6aef42[_0x4f8d42(0x178)]!==_0x2ea497&&_0x6aef42[_0x4f8d42(0x106)]!==_0x2ea497){await this[_0x4f8d42(0xdd)]?.[_0x4f8d42(0x17a)](_0x311448,_0x4f8d42(0x13e)+_0x29c5a2+_0x4f8d42(0xbb)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':'Markdown'});return;}const _0x2cdbc2=await database_1['default']['telegramUser'][_0x4f8d42(0x19d)]({'where':{'shopId':_0x6aef42['id'],'isVerified':!![],'telegramId':{'not':_0x2cad22}}});if(_0x2cdbc2){await this[_0x4f8d42(0xdd)]?.[_0x4f8d42(0x17a)](_0x311448,_0x4f8d42(0xb3)+_0x29c5a2+_0x4f8d42(0xbb)+_0x4f8d42(0xba),{'parse_mode':'Markdown'});return;}await database_1[_0x4f8d42(0x185)]['telegramUser'][_0x4f8d42(0xb6)]({'where':{'telegramId':_0x2cad22},'data':{'shopId':_0x6aef42['id'],'isVerified':!![]}}),await this[_0x4f8d42(0xdd)]?.['sendMessage'](_0x311448,'🎉\x20*Congratulations!*\x0a\x0a'+_0x4f8d42(0xb7)+(_0x4f8d42(0x16a)+_0x6aef42[_0x4f8d42(0x17d)]+'*\x0a')+(_0x4f8d42(0x193)+_0x6aef42[_0x4f8d42(0xc3)]+'`\x0a\x0a')+_0x4f8d42(0x190)+_0x4f8d42(0x18d)+_0x4f8d42(0x162)+'•\x20Payouts\x0a'+_0x4f8d42(0x197)+'Commands:\x0a'+_0x4f8d42(0x113)+_0x4f8d42(0x14f),{'parse_mode':_0x4f8d42(0x15e)}),console[_0x4f8d42(0x1a9)](_0x4f8d42(0x1b0)+_0x2cad22+_0x4f8d42(0xe4)+_0x6aef42[_0x4f8d42(0xc3)]+_0x4f8d42(0x118));}catch(_0x26bd8e){console[_0x4f8d42(0xe9)](_0x4f8d42(0xb2),_0x26bd8e),await this[_0x4f8d42(0xdd)]?.['sendMessage'](_0x311448,_0x4f8d42(0xbe));}}async[a66_0x32c948(0xb5)](_0x219e90,_0x4e83a6,_0x5cf3bc){const _0x26e7d5=a66_0x32c948;if(!this[_0x26e7d5(0xdd)]){console[_0x26e7d5(0x103)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x1e0f81=await database_1[_0x26e7d5(0x185)][_0x26e7d5(0x148)][_0x26e7d5(0x134)]({'where':{'shopId':_0x219e90,'isVerified':!![]}});if(_0x1e0f81['length']===0x0){console['log']('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x219e90);return;}const _0x4369dd=_0x1e0f81[_0x26e7d5(0x187)](async _0x21e6be=>{const _0x180fe7=_0x26e7d5;try{await this[_0x180fe7(0xdd)]?.['sendMessage'](_0x21e6be['telegramId'],_0x4e83a6,_0x5cf3bc),console[_0x180fe7(0x1a9)](_0x180fe7(0x183)+_0x21e6be[_0x180fe7(0xe3)]);}catch(_0x2b8b4b){console[_0x180fe7(0xe9)](_0x180fe7(0x135)+_0x21e6be[_0x180fe7(0xe3)]+':',_0x2b8b4b),_0x2b8b4b instanceof Error&&(_0x2b8b4b[_0x180fe7(0x11b)]['includes'](_0x180fe7(0x10c))||_0x2b8b4b[_0x180fe7(0x11b)]['includes'](_0x180fe7(0x11a))||_0x2b8b4b[_0x180fe7(0x11b)][_0x180fe7(0x180)](_0x180fe7(0x145)))&&(await database_1[_0x180fe7(0x185)]['telegramUser'][_0x180fe7(0xb6)]({'where':{'id':_0x21e6be['id']},'data':{'isVerified':![]}}),console[_0x180fe7(0x1a9)]('User\x20'+_0x21e6be[_0x180fe7(0xe3)]+_0x180fe7(0x169)));}});await Promise['allSettled'](_0x4369dd);}catch(_0x3f8671){console['error']('Error\x20sending\x20shop\x20notification:',_0x3f8671);}}async[a66_0x32c948(0x12d)](_0x54d0f7,_0x3123ea,_0x2b8f8c){const _0x518339=a66_0x32c948,_0x1ad52d={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x7523b6={'created':_0x518339(0x181),'paid':'Payment\x20successfully\x20paid','failed':_0x518339(0x12c),'expired':_0x518339(0x1a0),'refund':_0x518339(0x17b),'chargeback':_0x518339(0x186),'processing':'Payment\x20is\x20being\x20processed'},_0x5ef414=_0x1ad52d[_0x2b8f8c],_0x565abd=_0x7523b6[_0x2b8f8c],_0x4b95aa=(0x0,gateway_1[_0x518339(0x199)])(_0x3123ea[_0x518339(0x11d)]);console['log'](_0x518339(0x156)+_0x3123ea[_0x518339(0x11d)]+'\x22\x20->\x20display\x20\x22'+_0x4b95aa+'\x22');let _0x5a5d5a=_0x5ef414+'\x20*'+_0x565abd+'*\x0a\x0a'+(_0x518339(0xfc)+_0x3123ea[_0x518339(0x188)]+'\x20'+_0x3123ea[_0x518339(0x149)]+'*\x0a')+(_0x518339(0xe8)+(_0x3123ea[_0x518339(0x14b)]||_0x3123ea['id'])+'`\x0a')+(_0x518339(0xdc)+_0x3123ea['id']+'`\x0a')+(_0x518339(0x19f)+_0x4b95aa+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x3123ea['createdAt'])['toLocaleString']('en-US')+'\x0a');if(_0x3123ea['customerName']||_0x3123ea[_0x518339(0x192)]||_0x3123ea[_0x518339(0x15f)]||_0x3123ea[_0x518339(0xd9)]||_0x3123ea[_0x518339(0xf8)]){_0x5a5d5a+=_0x518339(0x123);_0x3123ea[_0x518339(0xf6)]&&(_0x5a5d5a+=_0x518339(0x1ad)+_0x3123ea['customerName']+'`\x0a');_0x3123ea[_0x518339(0x192)]&&(_0x5a5d5a+=_0x518339(0xc0)+_0x3123ea[_0x518339(0x192)]+'`\x0a');_0x3123ea['remitterIban']&&(_0x5a5d5a+=_0x518339(0x101)+_0x3123ea[_0x518339(0x15f)]+'`\x0a');_0x3123ea['customerIp']&&(_0x5a5d5a+=_0x518339(0x18a)+_0x3123ea[_0x518339(0xd9)]+'`\x0a');if(_0x3123ea[_0x518339(0xf8)]){const _0xa753b3=_0x3123ea['customerUa'][_0x518339(0xd2)]>0x32?_0x3123ea['customerUa'][_0x518339(0x115)](0x0,0x32)+_0x518339(0xca):_0x3123ea['customerUa'];_0x5a5d5a+='💻\x20Browser:\x20`'+_0xa753b3+'`\x0a';}}_0x2b8f8c===_0x518339(0x172)&&_0x3123ea['chargebackAmount']&&(_0x5a5d5a+='💸\x20Penalty\x20amount:\x20*'+_0x3123ea['chargebackAmount']+_0x518339(0xee)),_0x2b8f8c===_0x518339(0x119)&&(_0x5a5d5a+=_0x518339(0x127)),_0x3123ea[_0x518339(0x191)]&&(_0x5a5d5a+=_0x518339(0x198)+_0x3123ea[_0x518339(0x191)]+'\x0a'),await this[_0x518339(0xb5)](_0x54d0f7,_0x5a5d5a,{'parse_mode':'Markdown'});}async[a66_0x32c948(0x109)](_0x4642c4,_0x2d1038,_0x523f02){const _0x4e437c=a66_0x32c948,_0x438813={'created':'📤','completed':'✅','rejected':'❌'},_0x5af03f={'created':_0x4e437c(0x10a),'completed':_0x4e437c(0x136),'rejected':_0x4e437c(0xb1)},_0x25ea0d=_0x438813[_0x523f02],_0x4c65a7=_0x5af03f[_0x523f02],_0x115aab=_0x25ea0d+'\x20*'+_0x4c65a7+'*\x0a\x0a'+('💸\x20Amount:\x20*'+_0x2d1038['amount']+_0x4e437c(0x15d))+(_0x4e437c(0x1ab)+_0x2d1038[_0x4e437c(0xd3)]+'`\x0a')+(_0x4e437c(0x16c)+_0x2d1038['id']+'`\x0a')+(_0x4e437c(0x158)+new Date(_0x2d1038['createdAt'])['toLocaleString'](_0x4e437c(0x17c))+'\x0a')+(_0x2d1038[_0x4e437c(0x147)]?_0x4e437c(0x16e)+_0x2d1038[_0x4e437c(0x147)]+'`':'');await this[_0x4e437c(0xb5)](_0x4642c4,_0x115aab,{'parse_mode':'Markdown'});}async[a66_0x32c948(0x140)](_0x271e01,_0x27d74e){const _0xe17017=a66_0x32c948;try{const _0x33aba8=await database_1[_0xe17017(0x185)][_0xe17017(0x157)][_0xe17017(0x19c)]({'where':{'shopId':_0x271e01},'select':{'notificationLogin':!![]}});if(!_0x33aba8?.[_0xe17017(0x129)]){console[_0xe17017(0x1a9)](_0xe17017(0xd0)+_0x271e01);return;}const _0x505308=_0x27d74e[_0xe17017(0x163)]?'🔐':'🚨',_0x25c27b=_0x27d74e[_0xe17017(0x163)]?_0xe17017(0x174):_0xe17017(0x17f);let _0x183431=_0x505308+'\x20*'+_0x25c27b+'*\x0a\x0a'+('👤\x20Username:\x20`'+_0x27d74e[_0xe17017(0xc3)]+'`\x0a')+(_0xe17017(0x16d)+_0x27d74e[_0xe17017(0xb8)][_0xe17017(0xf0)]('en-US')+'\x0a');_0x27d74e[_0xe17017(0x194)]&&(_0x183431+=_0xe17017(0x195)+_0x27d74e[_0xe17017(0x194)]+'`\x0a');if(_0x27d74e[_0xe17017(0x15b)]){const _0x4a5895=_0x27d74e[_0xe17017(0x15b)]['length']>0x32?_0x27d74e[_0xe17017(0x15b)][_0xe17017(0x115)](0x0,0x32)+'...':_0x27d74e['userAgent'];_0x183431+=_0xe17017(0x159)+_0x4a5895+'`\x0a';}!_0x27d74e[_0xe17017(0x163)]&&(_0x183431+=_0xe17017(0xfe)),await this[_0xe17017(0xb5)](_0x271e01,_0x183431,{'parse_mode':_0xe17017(0x15e)}),console[_0xe17017(0x1a9)](_0xe17017(0xf3)+_0x271e01+':\x20'+(_0x27d74e[_0xe17017(0x163)]?_0xe17017(0x163):'failed'));}catch(_0x321746){console[_0xe17017(0xe9)](_0xe17017(0xc2),_0x321746);}}async[a66_0x32c948(0x161)](_0x510f66,_0x5f5ce2){const _0x4e68a9=a66_0x32c948;try{const _0x56259f=await database_1['default']['shopSettings'][_0x4e68a9(0x19c)]({'where':{'shopId':_0x510f66},'select':{'notificationApiError':!![]}});if(!_0x56259f?.[_0x4e68a9(0x184)]){console[_0x4e68a9(0x1a9)](_0x4e68a9(0x1a2)+_0x510f66);return;}let _0x3fc533='🚨\x20*API\x20Error*\x0a\x0a'+('🔗\x20Endpoint:\x20`'+_0x5f5ce2[_0x4e68a9(0xd3)]+'\x20'+_0x5f5ce2[_0x4e68a9(0x131)]+'`\x0a')+(_0x4e68a9(0x16d)+_0x5f5ce2['timestamp']['toLocaleString'](_0x4e68a9(0x17c))+'\x0a');_0x5f5ce2[_0x4e68a9(0xeb)]&&(_0x3fc533+=_0x4e68a9(0x1af)+_0x5f5ce2['statusCode']+'`\x0a'),_0x3fc533+=_0x4e68a9(0x152)+_0x5f5ce2['errorMessage']+'`\x0a',_0x5f5ce2[_0x4e68a9(0x173)]&&(_0x3fc533+=_0x4e68a9(0x14e)+_0x5f5ce2[_0x4e68a9(0x173)]+'`\x0a'),_0x3fc533+=_0x4e68a9(0xd8),await this[_0x4e68a9(0xb5)](_0x510f66,_0x3fc533,{'parse_mode':_0x4e68a9(0x15e)}),console[_0x4e68a9(0x1a9)](_0x4e68a9(0x124)+_0x510f66+':\x20'+_0x5f5ce2[_0x4e68a9(0x131)]);}catch(_0x16c554){console['error'](_0x4e68a9(0x144),_0x16c554);}}async[a66_0x32c948(0x138)](_0x1d9da2,_0x2bd249,_0x32de1a){const _0x5b8f7e=a66_0x32c948;let _0x21cbee=_0x5b8f7e(0x126)+_0x2bd249+_0x5b8f7e(0x142);for(const [_0x30b8e4,_0x49ea15]of Object[_0x5b8f7e(0xc8)](_0x32de1a)){_0x49ea15!==null&&_0x49ea15!==undefined&&(_0x21cbee+=_0x30b8e4+_0x5b8f7e(0xe7)+_0x49ea15+'`\x0a');}await this['sendShopNotification'](_0x1d9da2,_0x21cbee,{'parse_mode':'Markdown'});}async[a66_0x32c948(0xe2)](_0x5a222c){const _0x45862e=a66_0x32c948;try{console['log'](_0x45862e(0xff)+_0x5a222c[_0x45862e(0x115)](0x0,0x32)+_0x45862e(0xca));const _0x30c5af=await database_1[_0x45862e(0x185)][_0x45862e(0x148)]['findMany']({'select':{'telegramId':!![]}});if(_0x30c5af[_0x45862e(0xd2)]===0x0){console[_0x45862e(0x1a9)](_0x45862e(0xf9));return;}for(const _0x203c3a of _0x30c5af){try{await this[_0x45862e(0xdd)]?.[_0x45862e(0x17a)](_0x203c3a[_0x45862e(0xe3)],_0x5a222c,{'parse_mode':_0x45862e(0x15e)});}catch(_0x4f9bc9){console[_0x45862e(0xe9)](_0x45862e(0xed)+_0x203c3a[_0x45862e(0xe3)]+':',_0x4f9bc9);}}console[_0x45862e(0x1a9)](_0x45862e(0x12e)+_0x30c5af['length']+_0x45862e(0x160));}catch(_0x2d82f9){console['error']('❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:',_0x2d82f9);}}[a66_0x32c948(0x166)](){const _0x59fcea=a66_0x32c948;return{'isActive':!!this['bot'],'username':this[_0x59fcea(0x16b)]};}async['sendShopFile'](_0x5c39f8,_0x24a3e3,_0x29ca97,_0x3ecf1a){const _0x231c80=a66_0x32c948;try{if(!this[_0x231c80(0xdd)])return console[_0x231c80(0xe9)](_0x231c80(0xce)),![];const _0x59a310=await database_1[_0x231c80(0x185)][_0x231c80(0x148)][_0x231c80(0x134)]({'where':{'shopId':_0x5c39f8,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x59a310[_0x231c80(0xd2)]===0x0)return console['error']('❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20'+_0x5c39f8),![];let _0x3a9532=0x0;for(const _0x18fccf of _0x59a310){try{await this['bot'][_0x231c80(0xfd)](_0x18fccf['telegramId'],_0x24a3e3,{},{'filename':_0x29ca97,'contentType':_0x29ca97[_0x231c80(0x121)](_0x231c80(0x153))?_0x231c80(0x116):_0x29ca97[_0x231c80(0x121)](_0x231c80(0xda))||_0x29ca97['endsWith']('.jpeg')?_0x231c80(0x19b):_0x29ca97[_0x231c80(0x121)](_0x231c80(0x1a3))?_0x231c80(0x196):_0x231c80(0x146)}),_0x3ecf1a&&await this[_0x231c80(0xdd)][_0x231c80(0x17a)](_0x18fccf[_0x231c80(0xe3)],_0x3ecf1a),_0x3a9532++;}catch(_0x279efe){console[_0x231c80(0xe9)](_0x231c80(0xc9)+_0x18fccf['telegramId']+':',_0x279efe);}}return console[_0x231c80(0x1a9)](_0x231c80(0xb9)+_0x3a9532+'/'+_0x59a310[_0x231c80(0xd2)]+_0x231c80(0xbc)+_0x5c39f8+':\x20'+_0x29ca97),_0x3a9532>0x0;}catch(_0x3ddb7a){return console[_0x231c80(0xe9)](_0x231c80(0x1a8),_0x3ddb7a),![];}}async[a66_0x32c948(0x10f)](_0x320a2b,_0x36e9f7){const _0x7532a3=a66_0x32c948;try{if(!this[_0x7532a3(0xdd)])return console['error'](_0x7532a3(0xce)),![];return await this[_0x7532a3(0xdd)][_0x7532a3(0x17a)](_0x320a2b,_0x36e9f7),console['log'](_0x7532a3(0x154)+_0x320a2b),!![];}catch(_0x2640f5){return console[_0x7532a3(0xe9)](_0x7532a3(0x13f),_0x2640f5),![];}}async['sendDirectFile'](_0x59cc7e,_0x31ce6f,_0x2c4076,_0x21ef2d){const _0x1131f4=a66_0x32c948;try{if(!this[_0x1131f4(0xdd)])return console[_0x1131f4(0xe9)](_0x1131f4(0xce)),![];return await this['bot'][_0x1131f4(0xfd)](_0x59cc7e,_0x31ce6f,{},{'filename':_0x2c4076,'contentType':_0x2c4076[_0x1131f4(0x121)](_0x1131f4(0x153))?_0x1131f4(0x116):_0x2c4076[_0x1131f4(0x121)]('.jpg')||_0x2c4076[_0x1131f4(0x121)]('.jpeg')?_0x1131f4(0x19b):_0x2c4076[_0x1131f4(0x121)](_0x1131f4(0x1a3))?'application/pdf':'application/octet-stream'}),_0x21ef2d&&await this[_0x1131f4(0xdd)][_0x1131f4(0x17a)](_0x59cc7e,_0x21ef2d),console[_0x1131f4(0x1a9)](_0x1131f4(0x18c)+_0x59cc7e+':\x20'+_0x2c4076),!![];}catch(_0x49c7ea){return console[_0x1131f4(0xe9)](_0x1131f4(0x12b),_0x49c7ea),![];}}[a66_0x32c948(0xc1)](){const _0x133904=a66_0x32c948;this[_0x133904(0xdd)]&&(this[_0x133904(0xdd)]['stopPolling'](),this[_0x133904(0xdd)]=null,console[_0x133904(0x1a9)](_0x133904(0xde)));}}exports['TelegramBotService']=TelegramBotService,exports[a66_0x32c948(0x139)]=new TelegramBotService();