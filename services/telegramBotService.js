'use strict';const a63_0x3c8b92=a63_0x461b;function a63_0x28a0(){const _0x3b6f3d=['\x20users\x20of\x20shop\x20','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','handleSingleLineVerification','🆔\x20Request\x20ID:\x20`','gateway','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','❌\x20Error\x20sending\x20direct\x20message:','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','sendDocument','📊\x20*Connection\x20Status*\x0a\x0a','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','`\x0a\x0a','`\x20not\x20found.\x0a\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','1645941yAAofb','✅\x20Welcome\x20back!\x0a\x0a','TELEGRAM_BOT_USERNAME','env','getBotInfo','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','success','📅\x20Time:\x20','failed','__importDefault','setupBotHandlers','status','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','📅\x20Date:\x20','❌\x20Error\x20sending\x20file\x20to\x20shop:','ACTIVE','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','🌐\x20IP:\x20`','botToken','remitterIban','Contact\x20administrator.','split','.pdf','substring','📝\x20Order\x20ID:\x20`','845bKzeQm','Use\x20/start\x20to\x20connect.','/disconnect\x20-\x20disconnect\x20from\x20notifications','sendShopNotification','16PjotVd','Check\x20spelling\x20and\x20try\x20again.','*\x0a\x0a','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','chargeback','❌\x20Telegram\x20bot\x20not\x20initialized','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','startsWith','createdAt','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','User\x20','customerIp','👤\x20Username:\x20`',':\x20`','onText','warn','notificationApiError','`.\x0a\x0a','💸\x20Penalty\x20amount:\x20*','polling_error','toLocaleString','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','📝\x20Notes:\x20','blocked','\x20disconnected\x20from\x20shop\x20','Payment\x20expired','telegramId','🛑\x20Telegram\x20bot\x20stopped','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','toLocaleDateString','Error\x20handling\x20message:','\x20via\x20single-line\x20input','ipAddress','Failed\x20to\x20send\x20login\x20notification:','TelegramBotService','default','txid','application/pdf','node-telegram-bot-api','endpoint','\x20(@','Use\x20/start\x20to\x20begin.','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','userAgent','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','Telegram\x20bot\x20polling\x20error:','../types/gateway','botUsername','❌\x20Shop\x20`','notificationLogin','Error\x20handling\x20/debug\x20command:','message','130mYBTSH','timestamp','✅\x20Connected\x20to\x20shop:\x20*','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','\x20USD*\x0a','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','Markdown','Error\x20in\x20handleSingleLineVerification:','🔔\x20Notifications\x20are\x20active\x0a\x0a','includes','endsWith','...`\x0a\x0a','sendPayoutNotification','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','findUnique','customerName','sendDirectFile','`\x20is\x20inactive.\x0a\x0a','✅\x20File\x20sent\x20to\x20','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','allSettled','📛\x20Name:\x20`','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','🌐\x20IP\x20address:\x20`','\x20parts:\x20','\x20\x20\x20Username:\x20`','📅\x20Connection\x20date:\x20','✅\x20File\x20sent\x20to\x20chat\x20','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','❌\x20Error\x20sending\x20file\x20to\x20user\x20','📱\x20Notification\x20sent\x20to\x20','sendShopFile','Payment\x20refund','method','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','findFirst','•\x20Payment\x20status\x20changes\x0a','🔔\x20You\x20receive\x20notifications\x20about:\x0a','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','✅\x20Telegram\x20user\x20','5377806ZsWMcf','2289350oDfBFF','updatedAt','Error\x20handling\x20/disconnect\x20command:','amount','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','telegramUser','Error\x20sending\x20shop\x20notification:','isVerified','application/octet-stream','Failed\x20login\x20attempt','sendCustomNotification','requestId','orderId','💻\x20Browser:\x20`','\x20USDT*\x0a','Successful\x20login','forEach','/status\x20-\x20check\x20connection\x20status\x0a','68bvVJVU','defineProperty','New\x20payout\x20created','sendMessage','📱\x20Shop:\x20*','name','from','Payout\x20completed','image/png','chat','findMany','username','initializeBot','sk_','24LZTzLR','5140700fhLBPb','🎉\x20*Congratulations!*\x0a\x0a','toString','🏦\x20IBAN:\x20`','image/jpeg','Payout\x20rejected','To\x20reconnect,\x20use\x20the\x20/start\x20command','🆔\x20Payment\x20ID:\x20`','update','8766324RowrIL','sendDirectMessage','\x20users','New\x20payment\x20created','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','808383cWmkac','error','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','❌\x20Invalid\x20username\x20format:\x20`','.jpg','sendLoginNotification','shop','chat\x20not\x20found','.jpeg','bot','text','currency','📱\x20No\x20active\x20Telegram\x20users\x20found','.png','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','...\x22','last_name','customerUa','en-US','adminNotes','❌\x20Shop\x20with\x20username\x20`','🆔\x20Payout\x20ID:\x20`','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','\x20verified\x20for\x20shop\x20','...','telegramBotService','\x0aCheck\x20spelling\x20and\x20try\x20again.','🔍\x20*Debug\x20Information*\x0a\x0a','💸\x20Amount:\x20*','•\x20New\x20payments\x0a','TELEGRAM_BOT_TOKEN','📧\x20Email:\x20`','create','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','❌\x20Error\x20getting\x20debug\x20information.','\x0a👤\x20*Customer\x20Information:*\x0a','Commands:\x0a','Error\x20handling\x20/status\x20command:','customerEmail','length','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','map','entries','🔗\x20Endpoint:\x20`','publicKey','join','shopSettings','📱\x20Your\x20Telegram\x20ID:\x20`','statusCode','chargebackAmount','❌\x20Error\x20sending\x20file\x20to\x20chat:','•\x20`','•\x20Payouts\x0a','Payment\x20successfully\x20paid','sendNotificationToAll','stopPolling','📱\x20Telegram\x20notification:\x20gateway\x20\x22','log','❌\x20Error:\x20`','.\x20*','📱\x20Created\x20new\x20Telegram\x20user:\x20','\x22,\x20apiKey=\x22','*.\x0a\x0a','🔔\x20*','__esModule','shopId','first_name'];a63_0x28a0=function(){return _0x3b6f3d;};return a63_0x28a0();}(function(_0x5e4589,_0x3ee5a8){const _0x3889bf=a63_0x461b,_0x193182=_0x5e4589();while(!![]){try{const _0x3d0d34=-parseInt(_0x3889bf(0x1c0))/0x1*(parseInt(_0x3889bf(0x237))/0x2)+parseInt(_0x3889bf(0x254))/0x3*(-parseInt(_0x3889bf(0x1c4))/0x4)+-parseInt(_0x3889bf(0x246))/0x5+parseInt(_0x3889bf(0x224))/0x6+parseInt(_0x3889bf(0x225))/0x7*(parseInt(_0x3889bf(0x245))/0x8)+-parseInt(_0x3889bf(0x24f))/0x9+-parseInt(_0x3889bf(0x1fa))/0xa*(-parseInt(_0x3889bf(0x1a5))/0xb);if(_0x3d0d34===_0x3ee5a8)break;else _0x193182['push'](_0x193182['shift']());}catch(_0x5d273c){_0x193182['push'](_0x193182['shift']());}}}(a63_0x28a0,0xae4b0));var __importDefault=this&&this[a63_0x3c8b92(0x1ae)]||function(_0x245ce3){const _0x36fdfb=a63_0x3c8b92;return _0x245ce3&&_0x245ce3[_0x36fdfb(0x194)]?_0x245ce3:{'default':_0x245ce3};};Object[a63_0x3c8b92(0x238)](exports,a63_0x3c8b92(0x194),{'value':!![]}),exports[a63_0x3c8b92(0x26f)]=exports[a63_0x3c8b92(0x1e8)]=void 0x0;function a63_0x461b(_0x4ec81d,_0x34864f){const _0x28a0bb=a63_0x28a0();return a63_0x461b=function(_0x461bda,_0x1a4ca4){_0x461bda=_0x461bda-0x186;let _0x5b79d4=_0x28a0bb[_0x461bda];return _0x5b79d4;},a63_0x461b(_0x4ec81d,_0x34864f);}const node_telegram_bot_api_1=__importDefault(require(a63_0x3c8b92(0x1ec))),database_1=__importDefault(require('../config/database')),gateway_1=require(a63_0x3c8b92(0x1f4));class TelegramBotService{constructor(){const _0x209f57=a63_0x3c8b92;this['bot']=null,this[_0x209f57(0x1b9)]=process['env'][_0x209f57(0x274)]||'',this[_0x209f57(0x1f5)]=process[_0x209f57(0x1a8)][_0x209f57(0x1a7)]||'trapay_bot',this['botToken']?this[_0x209f57(0x243)]():console[_0x209f57(0x1d4)](_0x209f57(0x1a1));}['initializeBot'](){const _0xf01c91=a63_0x3c8b92;try{this[_0xf01c91(0x25e)]=new node_telegram_bot_api_1[(_0xf01c91(0x1e9))](this[_0xf01c91(0x1b9)],{'polling':!![]}),this[_0xf01c91(0x1af)](),console['log']('✅\x20Telegram\x20bot\x20@'+this[_0xf01c91(0x1f5)]+'\x20initialized\x20successfully');}catch(_0x19d1e2){console[_0xf01c91(0x255)](_0xf01c91(0x19e),_0x19d1e2);}}[a63_0x3c8b92(0x1af)](){const _0x1fc76f=a63_0x3c8b92;if(!this['bot'])return;this['bot'][_0x1fc76f(0x1d3)](/\/start/,async _0x4a4eb9=>{const _0x4582ce=_0x1fc76f,_0x1e6a4b=_0x4a4eb9[_0x4582ce(0x240)]['id'],_0xff7b99=_0x4a4eb9['from']?.['id'][_0x4582ce(0x248)](),_0x14ed11=_0x4a4eb9['from']?.[_0x4582ce(0x242)],_0x1d34a6=_0x4a4eb9[_0x4582ce(0x23d)]?.[_0x4582ce(0x196)],_0x5753c8=_0x4a4eb9['from']?.[_0x4582ce(0x266)];if(!_0xff7b99)return;try{let _0x265935=await database_1[_0x4582ce(0x1e9)][_0x4582ce(0x22a)]['findUnique']({'where':{'telegramId':_0xff7b99},'include':{'shop':!![]}});!_0x265935?(_0x265935=await database_1[_0x4582ce(0x1e9)][_0x4582ce(0x22a)][_0x4582ce(0x276)]({'data':{'telegramId':_0xff7b99,'username':_0x14ed11,'firstName':_0x1d34a6,'lastName':_0x5753c8,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x4582ce(0x18d)](_0x4582ce(0x190)+_0xff7b99+_0x4582ce(0x1ee)+_0x14ed11+')')):_0x265935=await database_1[_0x4582ce(0x1e9)]['telegramUser'][_0x4582ce(0x24e)]({'where':{'telegramId':_0xff7b99},'data':{'username':_0x14ed11,'firstName':_0x1d34a6,'lastName':_0x5753c8},'include':{'shop':!![]}}),_0x265935[_0x4582ce(0x22c)]&&_0x265935[_0x4582ce(0x195)]&&_0x265935[_0x4582ce(0x25b)]?await this[_0x4582ce(0x25e)]?.[_0x4582ce(0x23a)](_0x1e6a4b,_0x4582ce(0x1a6)+(_0x4582ce(0x27e)+_0x265935[_0x4582ce(0x25b)][_0x4582ce(0x23c)]+'*\x0a')+('Username:\x20`'+_0x265935[_0x4582ce(0x25b)][_0x4582ce(0x242)]+_0x4582ce(0x1a2))+_0x4582ce(0x221)+_0x4582ce(0x273)+_0x4582ce(0x220)+'•\x20Payouts\x0a\x0a'+'Commands:\x0a'+_0x4582ce(0x236)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x4582ce(0x200)}):(_0x265935[_0x4582ce(0x195)]&&!_0x265935[_0x4582ce(0x22c)]&&(await database_1[_0x4582ce(0x1e9)]['telegramUser']['update']({'where':{'telegramId':_0xff7b99},'data':{'shopId':null,'isVerified':![]}}),console[_0x4582ce(0x18d)](_0x4582ce(0x256)+_0xff7b99)),await this['bot']?.[_0x4582ce(0x23a)](_0x1e6a4b,_0x4582ce(0x1ca)+_0x4582ce(0x1f0)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+'Example:\x0a'+_0x4582ce(0x1e2)+_0x4582ce(0x1aa),{'parse_mode':_0x4582ce(0x200)}));}catch(_0x275724){console['error']('Error\x20handling\x20/start\x20command:',_0x275724),await this[_0x4582ce(0x25e)]?.[_0x4582ce(0x23a)](_0x1e6a4b,_0x4582ce(0x1ce));}}),this[_0x1fc76f(0x25e)][_0x1fc76f(0x1d3)](/\/disconnect/,async _0x362180=>{const _0x22efc2=_0x1fc76f,_0x5f5c0e=_0x362180[_0x22efc2(0x240)]['id'],_0x2e1387=_0x362180['from']?.['id'][_0x22efc2(0x248)]();if(!_0x2e1387)return;try{const _0x504fee=await database_1[_0x22efc2(0x1e9)][_0x22efc2(0x22a)][_0x22efc2(0x208)]({'where':{'telegramId':_0x2e1387},'include':{'shop':!![]}});if(!_0x504fee||!_0x504fee[_0x22efc2(0x22c)]||!_0x504fee[_0x22efc2(0x195)]){await this[_0x22efc2(0x25e)]?.[_0x22efc2(0x23a)](_0x5f5c0e,_0x22efc2(0x253));return;}const _0x4f876c=_0x504fee[_0x22efc2(0x25b)]?.['name']||'unknown\x20shop';await database_1[_0x22efc2(0x1e9)][_0x22efc2(0x22a)]['update']({'where':{'telegramId':_0x2e1387},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔌\x20User\x20'+_0x2e1387+_0x22efc2(0x1dd)+_0x504fee['shopId']),await this[_0x22efc2(0x25e)]?.[_0x22efc2(0x23a)](_0x5f5c0e,_0x22efc2(0x1cd)+_0x4f876c+_0x22efc2(0x192)+_0x22efc2(0x24c),{'parse_mode':'Markdown'});}catch(_0x504068){console['error'](_0x22efc2(0x227),_0x504068),await this['bot']?.['sendMessage'](_0x5f5c0e,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x1fc76f(0x25e)]['onText'](/\/status/,async _0x386f1f=>{const _0x53397e=_0x1fc76f,_0x5b3aba=_0x386f1f['chat']['id'],_0x880fbe=_0x386f1f[_0x53397e(0x23d)]?.['id']['toString']();if(!_0x880fbe)return;try{const _0x128dbc=await database_1[_0x53397e(0x1e9)]['telegramUser'][_0x53397e(0x208)]({'where':{'telegramId':_0x880fbe},'include':{'shop':!![]}});if(!_0x128dbc){await this[_0x53397e(0x25e)]?.[_0x53397e(0x23a)](_0x5b3aba,_0x53397e(0x1f2)+_0x53397e(0x1ef));return;}if(!_0x128dbc[_0x53397e(0x22c)]||!_0x128dbc[_0x53397e(0x195)]||!_0x128dbc[_0x53397e(0x25b)]){await this['bot']?.[_0x53397e(0x23a)](_0x5b3aba,_0x53397e(0x1e1)+_0x53397e(0x1c1));return;}await this[_0x53397e(0x25e)]?.[_0x53397e(0x23a)](_0x5b3aba,_0x53397e(0x1a0)+(_0x53397e(0x1fc)+_0x128dbc[_0x53397e(0x25b)][_0x53397e(0x23c)]+'*\x0a')+('👤\x20Username:\x20`'+_0x128dbc['shop'][_0x53397e(0x242)]+'`\x0a')+(_0x53397e(0x215)+_0x128dbc[_0x53397e(0x226)][_0x53397e(0x1e3)]('en-US')+'\x0a\x0a')+_0x53397e(0x202)+'Commands:\x0a'+_0x53397e(0x1c2),{'parse_mode':'Markdown'});}catch(_0x2009d9){console[_0x53397e(0x255)](_0x53397e(0x27b),_0x2009d9),await this[_0x53397e(0x25e)]?.['sendMessage'](_0x5b3aba,_0x53397e(0x1ce));}}),this[_0x1fc76f(0x25e)][_0x1fc76f(0x1d3)](/\/debug/,async _0x31e379=>{const _0x287591=_0x1fc76f,_0x4f1735=_0x31e379[_0x287591(0x240)]['id'],_0x5e875d=_0x31e379[_0x287591(0x23d)]?.['id'][_0x287591(0x248)]();if(!_0x5e875d)return;try{const _0x33c6f7=await database_1['default'][_0x287591(0x25b)][_0x287591(0x241)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x396ad5=_0x287591(0x271);_0x396ad5+=_0x287591(0x285)+_0x5e875d+'`\x0a\x0a',_0x396ad5+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x33c6f7['forEach']((_0x4143d1,_0x2c9cf9)=>{const _0x25b1fc=_0x287591;_0x396ad5+=_0x2c9cf9+0x1+_0x25b1fc(0x18f)+_0x4143d1[_0x25b1fc(0x23c)]+'*\x0a',_0x396ad5+=_0x25b1fc(0x214)+_0x4143d1['username']+'`\x0a',_0x396ad5+='\x20\x20\x20Status:\x20'+_0x4143d1[_0x25b1fc(0x1b0)]+'\x0a',_0x396ad5+='\x20\x20\x20Public\x20Key:\x20`'+_0x4143d1[_0x25b1fc(0x282)][_0x25b1fc(0x1be)](0x0,0xf)+_0x25b1fc(0x205);}),await this['bot']?.[_0x287591(0x23a)](_0x4f1735,_0x396ad5,{'parse_mode':_0x287591(0x200)});}catch(_0x563b91){console[_0x287591(0x255)](_0x287591(0x1f8),_0x563b91),await this['bot']?.['sendMessage'](_0x4f1735,_0x287591(0x278));}}),this[_0x1fc76f(0x25e)]['on'](_0x1fc76f(0x1f9),async _0xa6a3b7=>{const _0x4812ae=_0x1fc76f;if(_0xa6a3b7['text']?.[_0x4812ae(0x1cb)]('/'))return;const _0x49da9e=_0xa6a3b7[_0x4812ae(0x240)]['id'],_0x3d242a=_0xa6a3b7[_0x4812ae(0x23d)]?.['id']['toString'](),_0x5ab4c0=_0xa6a3b7[_0x4812ae(0x25f)]?.['trim']();if(!_0x3d242a||!_0x5ab4c0)return;try{const _0xbcf972=await database_1[_0x4812ae(0x1e9)][_0x4812ae(0x22a)][_0x4812ae(0x208)]({'where':{'telegramId':_0x3d242a},'include':{'shop':!![]}});if(!_0xbcf972){await this['bot']?.[_0x4812ae(0x23a)](_0x49da9e,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0xbcf972[_0x4812ae(0x22c)]&&_0xbcf972[_0x4812ae(0x195)]&&_0xbcf972['shop']){await this[_0x4812ae(0x25e)]?.[_0x4812ae(0x23a)](_0x49da9e,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0xbcf972[_0x4812ae(0x25b)][_0x4812ae(0x23c)]+_0x4812ae(0x192)+_0x4812ae(0x20d),{'parse_mode':_0x4812ae(0x200)});return;}const _0x5bce91=_0x5ab4c0[_0x4812ae(0x1bc)](/\s+/);if(_0x5bce91[_0x4812ae(0x27d)]!==0x2){await this[_0x4812ae(0x25e)]?.[_0x4812ae(0x23a)](_0x49da9e,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x4812ae(0x1da)+'Example:\x0a'+_0x4812ae(0x1e2)+('You\x20sent\x20'+_0x5bce91[_0x4812ae(0x27d)]+_0x4812ae(0x213)+_0x5bce91[_0x4812ae(0x27f)](_0x32a56c=>'`'+_0x32a56c+'`')[_0x4812ae(0x283)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x198459,_0x293ecc]=_0x5bce91;console[_0x4812ae(0x18d)](_0x4812ae(0x1b1)+_0x3d242a+':\x20username=\x22'+_0x198459+_0x4812ae(0x191)+_0x293ecc[_0x4812ae(0x1be)](0x0,0xa)+_0x4812ae(0x265)),await this[_0x4812ae(0x199)](_0x49da9e,_0x3d242a,_0x198459,_0x293ecc);}catch(_0xc1d447){console['error'](_0x4812ae(0x1e4),_0xc1d447),await this['bot']?.['sendMessage'](_0x49da9e,_0x4812ae(0x1ce));}}),this[_0x1fc76f(0x25e)]['on']('error',_0x35e20f=>{const _0x3ec635=_0x1fc76f;console[_0x3ec635(0x255)]('Telegram\x20bot\x20error:',_0x35e20f);}),this[_0x1fc76f(0x25e)]['on'](_0x1fc76f(0x1d8),_0x2893a2=>{const _0x4d6688=_0x1fc76f;console[_0x4d6688(0x255)](_0x4d6688(0x1f3),_0x2893a2);});}async[a63_0x3c8b92(0x199)](_0x4ac83c,_0x94f3b,_0x416a56,_0x281b59){const _0x536990=a63_0x3c8b92;try{console[_0x536990(0x18d)](_0x536990(0x1b1)+_0x94f3b+':\x20username=\x22'+_0x416a56+_0x536990(0x191)+_0x281b59[_0x536990(0x1be)](0x0,0xa)+_0x536990(0x265));if(!_0x416a56||_0x416a56[_0x536990(0x27d)]<0x3||_0x416a56['length']>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x416a56)){await this[_0x536990(0x25e)]?.[_0x536990(0x23a)](_0x4ac83c,_0x536990(0x258)+_0x416a56+'`\x0a\x0a'+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x536990(0x200)});return;}if(!_0x281b59||!_0x281b59[_0x536990(0x1cb)]('pk_')&&!_0x281b59[_0x536990(0x1cb)](_0x536990(0x244))){await this[_0x536990(0x25e)]?.[_0x536990(0x23a)](_0x4ac83c,_0x536990(0x257)+_0x536990(0x1b7),{'parse_mode':_0x536990(0x200)});return;}const _0x423095=await database_1[_0x536990(0x1e9)]['shop'][_0x536990(0x208)]({'where':{'username':_0x416a56},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x423095){const _0x5433bb=await database_1['default'][_0x536990(0x25b)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x1bb647=_0x536990(0x26a)+_0x416a56+_0x536990(0x1a3);_0x5433bb[_0x536990(0x27d)]>0x0?(_0x1bb647+='Available\x20usernames:\x0a',_0x5433bb[_0x536990(0x235)](_0x2959ef=>{const _0x465ae2=_0x536990;_0x1bb647+=_0x465ae2(0x187)+_0x2959ef['username']+'`\x20('+_0x2959ef[_0x465ae2(0x23c)]+')\x0a';}),_0x1bb647+=_0x536990(0x270)):_0x1bb647+=_0x536990(0x1c5);await this[_0x536990(0x25e)]?.[_0x536990(0x23a)](_0x4ac83c,_0x1bb647,{'parse_mode':_0x536990(0x200)});return;}if(_0x423095[_0x536990(0x1b0)]!==_0x536990(0x1b4)){await this[_0x536990(0x25e)]?.['sendMessage'](_0x4ac83c,_0x536990(0x1f6)+_0x416a56+_0x536990(0x20b)+_0x536990(0x1bb),{'parse_mode':_0x536990(0x200)});return;}if(_0x423095['publicKey']!==_0x281b59&&_0x423095['secretKey']!==_0x281b59){await this[_0x536990(0x25e)]?.['sendMessage'](_0x4ac83c,_0x536990(0x198)+_0x416a56+_0x536990(0x1d6)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x536990(0x200)});return;}const _0x159d6b=await database_1[_0x536990(0x1e9)][_0x536990(0x22a)][_0x536990(0x21f)]({'where':{'shopId':_0x423095['id'],'isVerified':!![],'telegramId':{'not':_0x94f3b}}});if(_0x159d6b){await this[_0x536990(0x25e)]?.[_0x536990(0x23a)](_0x4ac83c,_0x536990(0x1b6)+_0x416a56+_0x536990(0x1d6)+_0x536990(0x20e),{'parse_mode':_0x536990(0x200)});return;}await database_1[_0x536990(0x1e9)][_0x536990(0x22a)]['update']({'where':{'telegramId':_0x94f3b},'data':{'shopId':_0x423095['id'],'isVerified':!![]}}),await this['bot']?.[_0x536990(0x23a)](_0x4ac83c,_0x536990(0x247)+_0x536990(0x26c)+(_0x536990(0x23b)+_0x423095['name']+'*\x0a')+(_0x536990(0x1d1)+_0x423095[_0x536990(0x242)]+_0x536990(0x1a2))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x536990(0x273)+_0x536990(0x220)+_0x536990(0x188)+'•\x20Important\x20events\x0a\x0a'+_0x536990(0x27a)+_0x536990(0x236)+_0x536990(0x1c2),{'parse_mode':'Markdown'}),console['log'](_0x536990(0x223)+_0x94f3b+_0x536990(0x26d)+_0x423095[_0x536990(0x242)]+_0x536990(0x1e5));}catch(_0x595d5f){console[_0x536990(0x255)](_0x536990(0x201),_0x595d5f),await this[_0x536990(0x25e)]?.[_0x536990(0x23a)](_0x4ac83c,_0x536990(0x1a4));}}async[a63_0x3c8b92(0x1c3)](_0xaef78e,_0x79a70b,_0x389b22){const _0x10d5c7=a63_0x3c8b92;if(!this['bot']){console[_0x10d5c7(0x1d4)](_0x10d5c7(0x211));return;}try{const _0x15437e=await database_1[_0x10d5c7(0x1e9)]['telegramUser'][_0x10d5c7(0x241)]({'where':{'shopId':_0xaef78e,'isVerified':!![]}});if(_0x15437e[_0x10d5c7(0x27d)]===0x0){console[_0x10d5c7(0x18d)](_0x10d5c7(0x222)+_0xaef78e);return;}const _0x2d4cd3=_0x15437e[_0x10d5c7(0x27f)](async _0x1d026f=>{const _0x4b5344=_0x10d5c7;try{await this[_0x4b5344(0x25e)]?.['sendMessage'](_0x1d026f['telegramId'],_0x79a70b,_0x389b22),console['log'](_0x4b5344(0x218)+_0x1d026f[_0x4b5344(0x1df)]);}catch(_0x44e4e2){console[_0x4b5344(0x255)](_0x4b5344(0x207)+_0x1d026f['telegramId']+':',_0x44e4e2),_0x44e4e2 instanceof Error&&(_0x44e4e2[_0x4b5344(0x1f9)][_0x4b5344(0x203)](_0x4b5344(0x1dc))||_0x44e4e2[_0x4b5344(0x1f9)][_0x4b5344(0x203)](_0x4b5344(0x25c))||_0x44e4e2['message'][_0x4b5344(0x203)]('user\x20is\x20deactivated'))&&(await database_1[_0x4b5344(0x1e9)]['telegramUser'][_0x4b5344(0x24e)]({'where':{'id':_0x1d026f['id']},'data':{'isVerified':![]}}),console[_0x4b5344(0x18d)](_0x4b5344(0x1cf)+_0x1d026f['telegramId']+_0x4b5344(0x217)));}});await Promise[_0x10d5c7(0x20f)](_0x2d4cd3);}catch(_0x5a44c0){console['error'](_0x10d5c7(0x22b),_0x5a44c0);}}async['sendPaymentNotification'](_0x385cbb,_0x3ff9fe,_0x5327a4){const _0x252eba=a63_0x3c8b92,_0x4249dc={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x8a9ffd={'created':_0x252eba(0x252),'paid':_0x252eba(0x189),'failed':'Payment\x20failed','expired':_0x252eba(0x1de),'refund':_0x252eba(0x21c),'chargeback':'Payment\x20chargeback','processing':'Payment\x20is\x20being\x20processed'},_0x1a996c=_0x4249dc[_0x5327a4],_0xea9bf=_0x8a9ffd[_0x5327a4],_0x32c4d1=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x3ff9fe[_0x252eba(0x19b)]);console[_0x252eba(0x18d)](_0x252eba(0x18c)+_0x3ff9fe[_0x252eba(0x19b)]+'\x22\x20->\x20display\x20\x22'+_0x32c4d1+'\x22');let _0x295444=_0x1a996c+'\x20*'+_0xea9bf+_0x252eba(0x1c6)+('💰\x20Amount:\x20*'+_0x3ff9fe[_0x252eba(0x228)]+'\x20'+_0x3ff9fe[_0x252eba(0x260)]+'*\x0a')+(_0x252eba(0x1bf)+(_0x3ff9fe[_0x252eba(0x231)]||_0x3ff9fe['id'])+'`\x0a')+(_0x252eba(0x24d)+_0x3ff9fe['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x32c4d1+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x3ff9fe[_0x252eba(0x1cc)])[_0x252eba(0x1d9)](_0x252eba(0x268))+'\x0a');if(_0x3ff9fe[_0x252eba(0x209)]||_0x3ff9fe[_0x252eba(0x27c)]||_0x3ff9fe['remitterIban']||_0x3ff9fe[_0x252eba(0x1d0)]||_0x3ff9fe[_0x252eba(0x267)]){_0x295444+=_0x252eba(0x279);_0x3ff9fe[_0x252eba(0x209)]&&(_0x295444+=_0x252eba(0x210)+_0x3ff9fe['customerName']+'`\x0a');_0x3ff9fe[_0x252eba(0x27c)]&&(_0x295444+=_0x252eba(0x275)+_0x3ff9fe[_0x252eba(0x27c)]+'`\x0a');_0x3ff9fe[_0x252eba(0x1ba)]&&(_0x295444+=_0x252eba(0x249)+_0x3ff9fe[_0x252eba(0x1ba)]+'`\x0a');_0x3ff9fe[_0x252eba(0x1d0)]&&(_0x295444+=_0x252eba(0x1b8)+_0x3ff9fe[_0x252eba(0x1d0)]+'`\x0a');if(_0x3ff9fe[_0x252eba(0x267)]){const _0x1a5806=_0x3ff9fe['customerUa'][_0x252eba(0x27d)]>0x32?_0x3ff9fe['customerUa'][_0x252eba(0x1be)](0x0,0x32)+_0x252eba(0x26e):_0x3ff9fe['customerUa'];_0x295444+=_0x252eba(0x232)+_0x1a5806+'`\x0a';}}_0x5327a4===_0x252eba(0x1c8)&&_0x3ff9fe['chargebackAmount']&&(_0x295444+=_0x252eba(0x1d7)+_0x3ff9fe[_0x252eba(0x287)]+_0x252eba(0x233)),_0x5327a4==='processing'&&(_0x295444+=_0x252eba(0x1fd)),_0x3ff9fe[_0x252eba(0x269)]&&(_0x295444+=_0x252eba(0x1db)+_0x3ff9fe[_0x252eba(0x269)]+'\x0a'),await this[_0x252eba(0x1c3)](_0x385cbb,_0x295444,{'parse_mode':_0x252eba(0x200)});}async[a63_0x3c8b92(0x206)](_0x3c9b14,_0x10fa50,_0x3bf6bc){const _0xb965ee=a63_0x3c8b92,_0x20c197={'created':'📤','completed':'✅','rejected':'❌'},_0x2c5709={'created':_0xb965ee(0x239),'completed':_0xb965ee(0x23e),'rejected':_0xb965ee(0x24b)},_0x29e1c1=_0x20c197[_0x3bf6bc],_0x1e62d5=_0x2c5709[_0x3bf6bc],_0x3534c0=_0x29e1c1+'\x20*'+_0x1e62d5+_0xb965ee(0x1c6)+(_0xb965ee(0x272)+_0x10fa50[_0xb965ee(0x228)]+_0xb965ee(0x1fe))+('🏦\x20Method:\x20`'+_0x10fa50[_0xb965ee(0x21d)]+'`\x0a')+(_0xb965ee(0x26b)+_0x10fa50['id']+'`\x0a')+(_0xb965ee(0x1b2)+new Date(_0x10fa50[_0xb965ee(0x1cc)])['toLocaleString'](_0xb965ee(0x268))+'\x0a')+(_0x10fa50[_0xb965ee(0x1ea)]?'🔗\x20TXID:\x20`'+_0x10fa50[_0xb965ee(0x1ea)]+'`':'');await this['sendShopNotification'](_0x3c9b14,_0x3534c0,{'parse_mode':'Markdown'});}async[a63_0x3c8b92(0x25a)](_0x16586b,_0x2de2ab){const _0x27d5cd=a63_0x3c8b92;try{const _0x559a35=await database_1[_0x27d5cd(0x1e9)][_0x27d5cd(0x284)][_0x27d5cd(0x208)]({'where':{'shopId':_0x16586b},'select':{'notificationLogin':!![]}});if(!_0x559a35?.[_0x27d5cd(0x1f7)]){console[_0x27d5cd(0x18d)](_0x27d5cd(0x1ff)+_0x16586b);return;}const _0x38d622=_0x2de2ab['success']?'🔐':'🚨',_0x49f1ec=_0x2de2ab[_0x27d5cd(0x1ab)]?_0x27d5cd(0x234):_0x27d5cd(0x22e);let _0x967678=_0x38d622+'\x20*'+_0x49f1ec+'*\x0a\x0a'+('👤\x20Username:\x20`'+_0x2de2ab[_0x27d5cd(0x242)]+'`\x0a')+(_0x27d5cd(0x1ac)+_0x2de2ab['timestamp'][_0x27d5cd(0x1d9)](_0x27d5cd(0x268))+'\x0a');_0x2de2ab['ipAddress']&&(_0x967678+=_0x27d5cd(0x212)+_0x2de2ab[_0x27d5cd(0x1e6)]+'`\x0a');if(_0x2de2ab['userAgent']){const _0x4eb4aa=_0x2de2ab[_0x27d5cd(0x1f1)]['length']>0x32?_0x2de2ab[_0x27d5cd(0x1f1)]['substring'](0x0,0x32)+_0x27d5cd(0x26e):_0x2de2ab[_0x27d5cd(0x1f1)];_0x967678+=_0x27d5cd(0x232)+_0x4eb4aa+'`\x0a';}!_0x2de2ab['success']&&(_0x967678+=_0x27d5cd(0x21e)),await this[_0x27d5cd(0x1c3)](_0x16586b,_0x967678,{'parse_mode':'Markdown'}),console[_0x27d5cd(0x18d)](_0x27d5cd(0x229)+_0x16586b+':\x20'+(_0x2de2ab[_0x27d5cd(0x1ab)]?'success':_0x27d5cd(0x1ad)));}catch(_0x1b4e0f){console[_0x27d5cd(0x255)](_0x27d5cd(0x1e7),_0x1b4e0f);}}async['sendApiErrorNotification'](_0xe350cc,_0x4dbc7d){const _0x3cff45=a63_0x3c8b92;try{const _0x1598b6=await database_1[_0x3cff45(0x1e9)]['shopSettings']['findUnique']({'where':{'shopId':_0xe350cc},'select':{'notificationApiError':!![]}});if(!_0x1598b6?.[_0x3cff45(0x1d5)]){console[_0x3cff45(0x18d)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0xe350cc);return;}let _0xb2f660='🚨\x20*API\x20Error*\x0a\x0a'+(_0x3cff45(0x281)+_0x4dbc7d[_0x3cff45(0x21d)]+'\x20'+_0x4dbc7d[_0x3cff45(0x1ed)]+'`\x0a')+(_0x3cff45(0x1ac)+_0x4dbc7d[_0x3cff45(0x1fb)][_0x3cff45(0x1d9)]('en-US')+'\x0a');_0x4dbc7d[_0x3cff45(0x286)]&&(_0xb2f660+='📊\x20Error\x20code:\x20`'+_0x4dbc7d['statusCode']+'`\x0a'),_0xb2f660+=_0x3cff45(0x18e)+_0x4dbc7d['errorMessage']+'`\x0a',_0x4dbc7d[_0x3cff45(0x230)]&&(_0xb2f660+=_0x3cff45(0x19a)+_0x4dbc7d[_0x3cff45(0x230)]+'`\x0a'),_0xb2f660+=_0x3cff45(0x264),await this[_0x3cff45(0x1c3)](_0xe350cc,_0xb2f660,{'parse_mode':'Markdown'}),console[_0x3cff45(0x18d)](_0x3cff45(0x277)+_0xe350cc+':\x20'+_0x4dbc7d[_0x3cff45(0x1ed)]);}catch(_0x399995){console['error']('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x399995);}}async[a63_0x3c8b92(0x22f)](_0x558c5b,_0x24b9c4,_0x398dc7){const _0x1b31cf=a63_0x3c8b92;let _0x15b597=_0x1b31cf(0x193)+_0x24b9c4+'*\x0a\x0a';for(const [_0x112ca0,_0x33ddd]of Object[_0x1b31cf(0x280)](_0x398dc7)){_0x33ddd!==null&&_0x33ddd!==undefined&&(_0x15b597+=_0x112ca0+_0x1b31cf(0x1d2)+_0x33ddd+'`\x0a');}await this['sendShopNotification'](_0x558c5b,_0x15b597,{'parse_mode':_0x1b31cf(0x200)});}async[a63_0x3c8b92(0x18a)](_0x545191){const _0x17ec5f=a63_0x3c8b92;try{console['log'](_0x17ec5f(0x19c)+_0x545191['substring'](0x0,0x32)+_0x17ec5f(0x26e));const _0x399d60=await database_1['default'][_0x17ec5f(0x22a)][_0x17ec5f(0x241)]({'select':{'telegramId':!![]}});if(_0x399d60[_0x17ec5f(0x27d)]===0x0){console['log'](_0x17ec5f(0x261));return;}for(const _0x5a98f of _0x399d60){try{await this[_0x17ec5f(0x25e)]?.[_0x17ec5f(0x23a)](_0x5a98f[_0x17ec5f(0x1df)],_0x545191,{'parse_mode':_0x17ec5f(0x200)});}catch(_0x52bca4){console['error'](_0x17ec5f(0x1c7)+_0x5a98f[_0x17ec5f(0x1df)]+':',_0x52bca4);}}console[_0x17ec5f(0x18d)](_0x17ec5f(0x21a)+_0x399d60[_0x17ec5f(0x27d)]+_0x17ec5f(0x251));}catch(_0x53ebab){console[_0x17ec5f(0x255)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:',_0x53ebab);}}[a63_0x3c8b92(0x1a9)](){const _0x1ed316=a63_0x3c8b92;return{'isActive':!!this[_0x1ed316(0x25e)],'username':this['botUsername']};}async[a63_0x3c8b92(0x21b)](_0x5744d0,_0x274c77,_0xd69244,_0x42d12a){const _0x415d60=a63_0x3c8b92;try{if(!this[_0x415d60(0x25e)])return console[_0x415d60(0x255)](_0x415d60(0x1c9)),![];const _0x9051c5=await database_1[_0x415d60(0x1e9)][_0x415d60(0x22a)]['findMany']({'where':{'shopId':_0x5744d0,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x9051c5[_0x415d60(0x27d)]===0x0)return console['error'](_0x415d60(0x1b5)+_0x5744d0),![];let _0x3899f1=0x0;for(const _0x4a48c8 of _0x9051c5){try{await this[_0x415d60(0x25e)]['sendDocument'](_0x4a48c8[_0x415d60(0x1df)],_0x274c77,{},{'filename':_0xd69244,'contentType':_0xd69244[_0x415d60(0x204)](_0x415d60(0x262))?_0x415d60(0x23f):_0xd69244[_0x415d60(0x204)]('.jpg')||_0xd69244[_0x415d60(0x204)]('.jpeg')?_0x415d60(0x24a):_0xd69244['endsWith'](_0x415d60(0x1bd))?_0x415d60(0x1eb):'application/octet-stream'}),_0x42d12a&&await this['bot'][_0x415d60(0x23a)](_0x4a48c8[_0x415d60(0x1df)],_0x42d12a),_0x3899f1++;}catch(_0x1e7426){console[_0x415d60(0x255)](_0x415d60(0x219)+_0x4a48c8[_0x415d60(0x1df)]+':',_0x1e7426);}}return console[_0x415d60(0x18d)](_0x415d60(0x20c)+_0x3899f1+'/'+_0x9051c5[_0x415d60(0x27d)]+_0x415d60(0x197)+_0x5744d0+':\x20'+_0xd69244),_0x3899f1>0x0;}catch(_0x1e1ad6){return console[_0x415d60(0x255)](_0x415d60(0x1b3),_0x1e1ad6),![];}}async[a63_0x3c8b92(0x250)](_0x5db0d0,_0x3ec376){const _0x1c2220=a63_0x3c8b92;try{if(!this['bot'])return console['error'](_0x1c2220(0x1c9)),![];return await this[_0x1c2220(0x25e)][_0x1c2220(0x23a)](_0x5db0d0,_0x3ec376),console[_0x1c2220(0x18d)](_0x1c2220(0x263)+_0x5db0d0),!![];}catch(_0x37c977){return console['error'](_0x1c2220(0x19d),_0x37c977),![];}}async[a63_0x3c8b92(0x20a)](_0x3e0a19,_0x56ad78,_0x5ed1d6,_0x3d53f9){const _0x5844c4=a63_0x3c8b92;try{if(!this[_0x5844c4(0x25e)])return console[_0x5844c4(0x255)](_0x5844c4(0x1c9)),![];return await this[_0x5844c4(0x25e)][_0x5844c4(0x19f)](_0x3e0a19,_0x56ad78,{},{'filename':_0x5ed1d6,'contentType':_0x5ed1d6[_0x5844c4(0x204)](_0x5844c4(0x262))?_0x5844c4(0x23f):_0x5ed1d6[_0x5844c4(0x204)](_0x5844c4(0x259))||_0x5ed1d6[_0x5844c4(0x204)](_0x5844c4(0x25d))?_0x5844c4(0x24a):_0x5ed1d6[_0x5844c4(0x204)](_0x5844c4(0x1bd))?_0x5844c4(0x1eb):_0x5844c4(0x22d)}),_0x3d53f9&&await this[_0x5844c4(0x25e)]['sendMessage'](_0x3e0a19,_0x3d53f9),console[_0x5844c4(0x18d)](_0x5844c4(0x216)+_0x3e0a19+':\x20'+_0x5ed1d6),!![];}catch(_0x6e2000){return console[_0x5844c4(0x255)](_0x5844c4(0x186),_0x6e2000),![];}}['stopBot'](){const _0xc54515=a63_0x3c8b92;this[_0xc54515(0x25e)]&&(this[_0xc54515(0x25e)][_0xc54515(0x18b)](),this[_0xc54515(0x25e)]=null,console[_0xc54515(0x18d)](_0xc54515(0x1e0)));}}exports[a63_0x3c8b92(0x1e8)]=TelegramBotService,exports[a63_0x3c8b92(0x26f)]=new TelegramBotService();