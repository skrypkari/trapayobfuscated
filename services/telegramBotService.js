'use strict';const a53_0x4cf35c=a53_0x1ba4;(function(_0x4d9146,_0x5a5802){const _0x123dfb=a53_0x1ba4,_0x1b796c=_0x4d9146();while(!![]){try{const _0x24f3b9=parseInt(_0x123dfb(0x202))/0x1*(parseInt(_0x123dfb(0x1ea))/0x2)+parseInt(_0x123dfb(0x259))/0x3+parseInt(_0x123dfb(0x274))/0x4+-parseInt(_0x123dfb(0x230))/0x5*(parseInt(_0x123dfb(0x256))/0x6)+parseInt(_0x123dfb(0x219))/0x7*(parseInt(_0x123dfb(0x1e4))/0x8)+parseInt(_0x123dfb(0x1fa))/0x9+-parseInt(_0x123dfb(0x241))/0xa;if(_0x24f3b9===_0x5a5802)break;else _0x1b796c['push'](_0x1b796c['shift']());}catch(_0x241bf0){_0x1b796c['push'](_0x1b796c['shift']());}}}(a53_0x4238,0xe3251));function a53_0x1ba4(_0x1cc1bc,_0x23646b){const _0x4238f1=a53_0x4238();return a53_0x1ba4=function(_0x1ba4dd,_0x1a67b9){_0x1ba4dd=_0x1ba4dd-0x1b8;let _0x35de16=_0x4238f1[_0x1ba4dd];return _0x35de16;},a53_0x1ba4(_0x1cc1bc,_0x23646b);}function a53_0x4238(){const _0x4e76f0=['Failed\x20to\x20send\x20login\x20notification:','🛑\x20Telegram\x20bot\x20stopped','Payment\x20expired','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','Successful\x20login','en-US','sendLoginNotification','setupBotHandlers','sendApiErrorNotification','trapay_bot','🔔\x20Notifications\x20are\x20active\x0a\x0a','📝\x20Order\x20ID:\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','💰\x20Amount:\x20*','6ILQZFo','TELEGRAM_BOT_TOKEN','•\x20Payment\x20status\x20changes\x0a','3376179KtPdcU','user\x20is\x20deactivated','Payout\x20completed','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','stopPolling','`\x20not\x20found.\x0a\x0a','✅\x20Welcome\x20back!\x0a\x0a','Error\x20handling\x20/status\x20command:','forEach','User\x20','startsWith','join','\x20\x20\x20Status:\x20','❌\x20Error:\x20`','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','telegramUser','polling_error','blocked','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','unknown\x20shop','Example:\x0a','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','__esModule','notificationApiError','split','onText','📱\x20Your\x20Telegram\x20ID:\x20`','2708152vRHQHQ','../config/database','\x20parts:\x20','\x20disconnected\x20from\x20shop\x20','initializeBot',':\x20username=\x22','findUnique','📅\x20Connection\x20date:\x20','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','.\x20*','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','🆔\x20Payout\x20ID:\x20`','\x20\x20\x20Public\x20Key:\x20`','includes','shopSettings','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','botToken','📝\x20Notes:\x20','from','amount','\x22,\x20apiKey=\x22','•\x20New\x20payments\x0a','📛\x20Name:\x20`','🏪\x20Gateway:\x20`','gateway','env','customerEmail','getBotInfo','../types/gateway','Use\x20/start\x20to\x20begin.','adminNotes','botUsername','errorMessage','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','📅\x20Time:\x20','success','statusCode','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','pk_','sendPaymentNotification','error','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','sendMessage','\x0a👤\x20*Customer\x20Information:*\x0a','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','findFirst','map','✅\x20Telegram\x20bot\x20@','Telegram\x20bot\x20error:','❌\x20Invalid\x20username\x20format:\x20`','userAgent','*.\x0a\x0a','processing','chat\x20not\x20found','•\x20Payouts\x0a','create','update','telegramBotService','default','...`\x0a\x0a','🎉\x20*Congratulations!*\x0a\x0a','findMany','ACTIVE','substring','status','📱\x20Shop:\x20*','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','🔌\x20User\x20','log','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','text','username','Error\x20handling\x20/start\x20command:','2104AYKQlZ','toLocaleString','name','📅\x20Date:\x20','💸\x20Amount:\x20*','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','16706BiGXAN','Payment\x20chargeback','Use\x20/start\x20to\x20connect.','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','Username:\x20`','secretKey','\x20initialized\x20successfully','first_name','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','shopId','notificationLogin','•\x20Payouts\x0a\x0a','TELEGRAM_BOT_USERNAME','❌\x20Shop\x20with\x20username\x20`','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','chargeback','14193720anolxX','📧\x20Email:\x20`','orderId','\x22\x20->\x20display\x20\x22','bot','sendCustomNotification','`\x20(','✅\x20Connected\x20to\x20shop:\x20*','49LWaTKh','\x0aCheck\x20spelling\x20and\x20try\x20again.','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','sendPayoutNotification','timestamp','Error\x20handling\x20message:','shop','`.\x0a\x0a','\x20USD*\x0a','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','...','Payout\x20rejected','To\x20reconnect,\x20use\x20the\x20/start\x20command','`\x0a\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Payment\x20refund','Commands:\x0a','🆔\x20Request\x20ID:\x20`','New\x20payout\x20created','getGatewayDisplayNameForTelegram','\x20via\x20single-line\x20input','defineProperty','19103LGVXjW','🆔\x20Payment\x20ID:\x20`','sendShopNotification','•\x20`','customerName','❌\x20Error\x20getting\x20debug\x20information.','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','*\x0a\x0a','createdAt','🔔\x20You\x20receive\x20notifications\x20about:\x0a','publicKey','📊\x20Error\x20code:\x20`','\x20\x20\x20Username:\x20`','Error\x20handling\x20/debug\x20command:','endpoint','👤\x20Username:\x20`','method','chargebackAmount','Markdown','Failed\x20login\x20attempt','length','chat','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','4187035fyhfnt','warn','Error\x20handling\x20/disconnect\x20command:','📊\x20*Connection\x20Status*\x0a\x0a','telegramId','isVerified','🚨\x20*API\x20Error*\x0a\x0a','🔗\x20Endpoint:\x20`','🔔\x20*','📱\x20Created\x20new\x20Telegram\x20user:\x20','Check\x20spelling\x20and\x20try\x20again.','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','toString','currency','TelegramBotService','Payment\x20successfully\x20paid','🏪\x20Available\x20shops\x20in\x20system:\x0a','27387430Wvssyd','stopBot','Available\x20usernames:\x0a','•\x20Important\x20events\x0a\x0a','message','handleSingleLineVerification','\x20verified\x20for\x20shop\x20'];a53_0x4238=function(){return _0x4e76f0;};return a53_0x4238();}var __importDefault=this&&this['__importDefault']||function(_0x1debd6){const _0x1cfdf3=a53_0x1ba4;return _0x1debd6&&_0x1debd6[_0x1cfdf3(0x26f)]?_0x1debd6:{'default':_0x1debd6};};Object[a53_0x4cf35c(0x218)](exports,a53_0x4cf35c(0x26f),{'value':!![]}),exports[a53_0x4cf35c(0x1d2)]=exports[a53_0x4cf35c(0x23e)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a53_0x4cf35c(0x275))),gateway_1=require(a53_0x4cf35c(0x290));class TelegramBotService{constructor(){const _0x5eaa87=a53_0x4cf35c;this[_0x5eaa87(0x1fe)]=null,this['botToken']=process[_0x5eaa87(0x28d)][_0x5eaa87(0x257)]||'',this[_0x5eaa87(0x1b8)]=process['env'][_0x5eaa87(0x1f6)]||_0x5eaa87(0x251),this[_0x5eaa87(0x284)]?this['initializeBot']():console[_0x5eaa87(0x231)](_0x5eaa87(0x1f8));}[a53_0x4cf35c(0x278)](){const _0xcb4630=a53_0x4cf35c;try{this[_0xcb4630(0x1fe)]=new node_telegram_bot_api_1['default'](this[_0xcb4630(0x284)],{'polling':!![]}),this[_0xcb4630(0x24f)](),console['log'](_0xcb4630(0x1c8)+this[_0xcb4630(0x1b8)]+_0xcb4630(0x1f0));}catch(_0x22231a){console[_0xcb4630(0x1c1)](_0xcb4630(0x204),_0x22231a);}}[a53_0x4cf35c(0x24f)](){const _0x1eb5af=a53_0x4cf35c;if(!this['bot'])return;this[_0x1eb5af(0x1fe)][_0x1eb5af(0x272)](/\/start/,async _0x2b7564=>{const _0x22a744=_0x1eb5af,_0x19deb6=_0x2b7564[_0x22a744(0x22e)]['id'],_0x32d988=_0x2b7564['from']?.['id'][_0x22a744(0x23c)](),_0xda4302=_0x2b7564[_0x22a744(0x286)]?.[_0x22a744(0x1e2)],_0x1fe147=_0x2b7564[_0x22a744(0x286)]?.[_0x22a744(0x1f1)],_0x357c46=_0x2b7564[_0x22a744(0x286)]?.['last_name'];if(!_0x32d988)return;try{let _0x5096df=await database_1[_0x22a744(0x1d3)][_0x22a744(0x268)][_0x22a744(0x27a)]({'where':{'telegramId':_0x32d988},'include':{'shop':!![]}});!_0x5096df?(_0x5096df=await database_1[_0x22a744(0x1d3)]['telegramUser'][_0x22a744(0x1d0)]({'data':{'telegramId':_0x32d988,'username':_0xda4302,'firstName':_0x1fe147,'lastName':_0x357c46,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x22a744(0x1de)](_0x22a744(0x239)+_0x32d988+'\x20(@'+_0xda4302+')')):_0x5096df=await database_1[_0x22a744(0x1d3)][_0x22a744(0x268)]['update']({'where':{'telegramId':_0x32d988},'data':{'username':_0xda4302,'firstName':_0x1fe147,'lastName':_0x357c46},'include':{'shop':!![]}}),_0x5096df['isVerified']&&_0x5096df[_0x22a744(0x1f3)]&&_0x5096df['shop']?await this[_0x22a744(0x1fe)]?.[_0x22a744(0x1c3)](_0x19deb6,_0x22a744(0x25f)+(_0x22a744(0x23b)+_0x5096df[_0x22a744(0x208)][_0x22a744(0x1e6)]+'*\x0a')+(_0x22a744(0x1ee)+_0x5096df[_0x22a744(0x208)][_0x22a744(0x1e2)]+'`\x0a\x0a')+_0x22a744(0x222)+_0x22a744(0x289)+_0x22a744(0x258)+_0x22a744(0x1f5)+_0x22a744(0x213)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x22a744(0x254),{'parse_mode':'Markdown'}):(_0x5096df['shopId']&&!_0x5096df['isVerified']&&(await database_1[_0x22a744(0x1d3)]['telegramUser']['update']({'where':{'telegramId':_0x32d988},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x32d988)),await this[_0x22a744(0x1fe)]?.[_0x22a744(0x1c3)](_0x19deb6,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x22a744(0x1dc)+_0x22a744(0x211)+_0x22a744(0x26d)+_0x22a744(0x1e0)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x22a744(0x22b)}));}catch(_0x129c54){console['error'](_0x22a744(0x1e3),_0x129c54),await this['bot']?.['sendMessage'](_0x19deb6,_0x22a744(0x21f));}}),this[_0x1eb5af(0x1fe)][_0x1eb5af(0x272)](/\/disconnect/,async _0x22cb9c=>{const _0x2d87ff=_0x1eb5af,_0x2710f3=_0x22cb9c['chat']['id'],_0x30a94b=_0x22cb9c[_0x2d87ff(0x286)]?.['id']['toString']();if(!_0x30a94b)return;try{const _0x1947f7=await database_1[_0x2d87ff(0x1d3)][_0x2d87ff(0x268)][_0x2d87ff(0x27a)]({'where':{'telegramId':_0x30a94b},'include':{'shop':!![]}});if(!_0x1947f7||!_0x1947f7[_0x2d87ff(0x235)]||!_0x1947f7[_0x2d87ff(0x1f3)]){await this[_0x2d87ff(0x1fe)]?.[_0x2d87ff(0x1c3)](_0x2710f3,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x3cade1=_0x1947f7[_0x2d87ff(0x208)]?.['name']||_0x2d87ff(0x26c);await database_1[_0x2d87ff(0x1d3)][_0x2d87ff(0x268)][_0x2d87ff(0x1d1)]({'where':{'telegramId':_0x30a94b},'data':{'shopId':null,'isVerified':![]}}),console[_0x2d87ff(0x1de)](_0x2d87ff(0x1dd)+_0x30a94b+_0x2d87ff(0x277)+_0x1947f7[_0x2d87ff(0x1f3)]),await this[_0x2d87ff(0x1fe)]?.[_0x2d87ff(0x1c3)](_0x2710f3,_0x2d87ff(0x27e)+_0x3cade1+_0x2d87ff(0x1cc)+_0x2d87ff(0x20e),{'parse_mode':'Markdown'});}catch(_0x4abc8f){console['error'](_0x2d87ff(0x232),_0x4abc8f),await this['bot']?.['sendMessage'](_0x2710f3,_0x2d87ff(0x21f));}}),this['bot'][_0x1eb5af(0x272)](/\/status/,async _0x3b1a34=>{const _0x111872=_0x1eb5af,_0x3101b8=_0x3b1a34[_0x111872(0x22e)]['id'],_0x12d695=_0x3b1a34[_0x111872(0x286)]?.['id'][_0x111872(0x23c)]();if(!_0x12d695)return;try{const _0x5b88=await database_1[_0x111872(0x1d3)][_0x111872(0x268)]['findUnique']({'where':{'telegramId':_0x12d695},'include':{'shop':!![]}});if(!_0x5b88){await this[_0x111872(0x1fe)]?.['sendMessage'](_0x3101b8,_0x111872(0x210)+_0x111872(0x291));return;}if(!_0x5b88['isVerified']||!_0x5b88[_0x111872(0x1f3)]||!_0x5b88[_0x111872(0x208)]){await this[_0x111872(0x1fe)]?.[_0x111872(0x1c3)](_0x3101b8,_0x111872(0x1db)+_0x111872(0x1ec));return;}await this[_0x111872(0x1fe)]?.[_0x111872(0x1c3)](_0x3101b8,_0x111872(0x233)+(_0x111872(0x201)+_0x5b88['shop']['name']+'*\x0a')+(_0x111872(0x228)+_0x5b88[_0x111872(0x208)][_0x111872(0x1e2)]+'`\x0a')+(_0x111872(0x27b)+_0x5b88['updatedAt']['toLocaleDateString'](_0x111872(0x24d))+'\x0a\x0a')+_0x111872(0x252)+_0x111872(0x213)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x111872(0x22b)});}catch(_0x2773b9){console['error'](_0x111872(0x260),_0x2773b9),await this[_0x111872(0x1fe)]?.[_0x111872(0x1c3)](_0x3101b8,_0x111872(0x21f));}}),this[_0x1eb5af(0x1fe)][_0x1eb5af(0x272)](/\/debug/,async _0x5dd457=>{const _0x3853d3=_0x1eb5af,_0x1784cf=_0x5dd457[_0x3853d3(0x22e)]['id'],_0x501dbb=_0x5dd457['from']?.['id'][_0x3853d3(0x23c)]();if(!_0x501dbb)return;try{const _0x5f1b56=await database_1[_0x3853d3(0x1d3)][_0x3853d3(0x208)][_0x3853d3(0x1d6)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x30e6cf='🔍\x20*Debug\x20Information*\x0a\x0a';_0x30e6cf+=_0x3853d3(0x273)+_0x501dbb+_0x3853d3(0x20f),_0x30e6cf+=_0x3853d3(0x240),_0x5f1b56[_0x3853d3(0x261)]((_0xc8a4c2,_0x4bd93c)=>{const _0x2ccc85=_0x3853d3;_0x30e6cf+=_0x4bd93c+0x1+_0x2ccc85(0x27d)+_0xc8a4c2[_0x2ccc85(0x1e6)]+'*\x0a',_0x30e6cf+=_0x2ccc85(0x225)+_0xc8a4c2[_0x2ccc85(0x1e2)]+'`\x0a',_0x30e6cf+=_0x2ccc85(0x265)+_0xc8a4c2[_0x2ccc85(0x1d9)]+'\x0a',_0x30e6cf+=_0x2ccc85(0x280)+_0xc8a4c2[_0x2ccc85(0x223)][_0x2ccc85(0x1d8)](0x0,0xf)+_0x2ccc85(0x1d4);}),await this[_0x3853d3(0x1fe)]?.[_0x3853d3(0x1c3)](_0x1784cf,_0x30e6cf,{'parse_mode':_0x3853d3(0x22b)});}catch(_0x559f9e){console[_0x3853d3(0x1c1)](_0x3853d3(0x226),_0x559f9e),await this[_0x3853d3(0x1fe)]?.[_0x3853d3(0x1c3)](_0x1784cf,_0x3853d3(0x21e));}}),this[_0x1eb5af(0x1fe)]['on'](_0x1eb5af(0x245),async _0x355916=>{const _0x5e2a7c=_0x1eb5af;if(_0x355916[_0x5e2a7c(0x1e1)]?.[_0x5e2a7c(0x263)]('/'))return;const _0x8afd49=_0x355916['chat']['id'],_0x3f9a7d=_0x355916[_0x5e2a7c(0x286)]?.['id']['toString'](),_0x1ac177=_0x355916[_0x5e2a7c(0x1e1)]?.['trim']();if(!_0x3f9a7d||!_0x1ac177)return;try{const _0x5d7038=await database_1['default']['telegramUser'][_0x5e2a7c(0x27a)]({'where':{'telegramId':_0x3f9a7d},'include':{'shop':!![]}});if(!_0x5d7038){await this['bot']?.[_0x5e2a7c(0x1c3)](_0x8afd49,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x5d7038['isVerified']&&_0x5d7038['shopId']&&_0x5d7038[_0x5e2a7c(0x208)]){await this[_0x5e2a7c(0x1fe)]?.[_0x5e2a7c(0x1c3)](_0x8afd49,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x5d7038['shop'][_0x5e2a7c(0x1e6)]+_0x5e2a7c(0x1cc)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x5e2a7c(0x22b)});return;}const _0x2ad911=_0x1ac177[_0x5e2a7c(0x271)](/\s+/);if(_0x2ad911[_0x5e2a7c(0x22d)]!==0x2){await this[_0x5e2a7c(0x1fe)]?.[_0x5e2a7c(0x1c3)](_0x8afd49,_0x5e2a7c(0x26e)+_0x5e2a7c(0x211)+_0x5e2a7c(0x26d)+_0x5e2a7c(0x1e0)+('You\x20sent\x20'+_0x2ad911[_0x5e2a7c(0x22d)]+_0x5e2a7c(0x276)+_0x2ad911[_0x5e2a7c(0x1c7)](_0xeb9529=>'`'+_0xeb9529+'`')[_0x5e2a7c(0x264)](',\x20')),{'parse_mode':_0x5e2a7c(0x22b)});return;}const [_0x35ccfa,_0x1be185]=_0x2ad911;console[_0x5e2a7c(0x1de)](_0x5e2a7c(0x1c5)+_0x3f9a7d+_0x5e2a7c(0x279)+_0x35ccfa+_0x5e2a7c(0x288)+_0x1be185['substring'](0x0,0xa)+'...\x22'),await this[_0x5e2a7c(0x246)](_0x8afd49,_0x3f9a7d,_0x35ccfa,_0x1be185);}catch(_0xaf7307){console[_0x5e2a7c(0x1c1)](_0x5e2a7c(0x207),_0xaf7307),await this['bot']?.['sendMessage'](_0x8afd49,_0x5e2a7c(0x21f));}}),this[_0x1eb5af(0x1fe)]['on'](_0x1eb5af(0x1c1),_0x494e9f=>{const _0x1fe22f=_0x1eb5af;console['error'](_0x1fe22f(0x1c9),_0x494e9f);}),this['bot']['on'](_0x1eb5af(0x269),_0x59eec5=>{const _0x477940=_0x1eb5af;console[_0x477940(0x1c1)]('Telegram\x20bot\x20polling\x20error:',_0x59eec5);});}async[a53_0x4cf35c(0x246)](_0x304dc3,_0x262cc8,_0x2bef04,_0xfec74){const _0x2d6c40=a53_0x4cf35c;try{console[_0x2d6c40(0x1de)](_0x2d6c40(0x1c5)+_0x262cc8+_0x2d6c40(0x279)+_0x2bef04+'\x22,\x20apiKey=\x22'+_0xfec74[_0x2d6c40(0x1d8)](0x0,0xa)+'...\x22');if(!_0x2bef04||_0x2bef04['length']<0x3||_0x2bef04[_0x2d6c40(0x22d)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x2bef04)){await this['bot']?.['sendMessage'](_0x304dc3,_0x2d6c40(0x1ca)+_0x2bef04+'`\x0a\x0a'+_0x2d6c40(0x267),{'parse_mode':'Markdown'});return;}if(!_0xfec74||!_0xfec74[_0x2d6c40(0x263)](_0x2d6c40(0x1bf))&&!_0xfec74[_0x2d6c40(0x263)]('sk_')){await this[_0x2d6c40(0x1fe)]?.['sendMessage'](_0x304dc3,_0x2d6c40(0x1ba)+_0x2d6c40(0x1f2),{'parse_mode':_0x2d6c40(0x22b)});return;}const _0x40b1ed=await database_1[_0x2d6c40(0x1d3)][_0x2d6c40(0x208)][_0x2d6c40(0x27a)]({'where':{'username':_0x2bef04},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x40b1ed){const _0x4b52f0=await database_1['default'][_0x2d6c40(0x208)][_0x2d6c40(0x1d6)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x5369c3=_0x2d6c40(0x1f7)+_0x2bef04+_0x2d6c40(0x25e);_0x4b52f0[_0x2d6c40(0x22d)]>0x0?(_0x5369c3+=_0x2d6c40(0x243),_0x4b52f0[_0x2d6c40(0x261)](_0x58838e=>{const _0x20a3c7=_0x2d6c40;_0x5369c3+=_0x20a3c7(0x21c)+_0x58838e[_0x20a3c7(0x1e2)]+_0x20a3c7(0x200)+_0x58838e[_0x20a3c7(0x1e6)]+')\x0a';}),_0x5369c3+=_0x2d6c40(0x203)):_0x5369c3+=_0x2d6c40(0x23a);await this[_0x2d6c40(0x1fe)]?.['sendMessage'](_0x304dc3,_0x5369c3,{'parse_mode':_0x2d6c40(0x22b)});return;}if(_0x40b1ed[_0x2d6c40(0x1d9)]!==_0x2d6c40(0x1d7)){await this['bot']?.[_0x2d6c40(0x1c3)](_0x304dc3,'❌\x20Shop\x20`'+_0x2bef04+'`\x20is\x20inactive.\x0a\x0a'+'Contact\x20administrator.',{'parse_mode':_0x2d6c40(0x22b)});return;}if(_0x40b1ed[_0x2d6c40(0x223)]!==_0xfec74&&_0x40b1ed[_0x2d6c40(0x1ef)]!==_0xfec74){await this[_0x2d6c40(0x1fe)]?.[_0x2d6c40(0x1c3)](_0x304dc3,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x2bef04+_0x2d6c40(0x209)+_0x2d6c40(0x20b)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x2d6c40(0x22b)});return;}const _0x102cae=await database_1[_0x2d6c40(0x1d3)][_0x2d6c40(0x268)][_0x2d6c40(0x1c6)]({'where':{'shopId':_0x40b1ed['id'],'isVerified':!![],'telegramId':{'not':_0x262cc8}}});if(_0x102cae){await this[_0x2d6c40(0x1fe)]?.[_0x2d6c40(0x1c3)](_0x304dc3,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x2bef04+_0x2d6c40(0x209)+_0x2d6c40(0x25c),{'parse_mode':'Markdown'});return;}await database_1[_0x2d6c40(0x1d3)][_0x2d6c40(0x268)]['update']({'where':{'telegramId':_0x262cc8},'data':{'shopId':_0x40b1ed['id'],'isVerified':!![]}}),await this[_0x2d6c40(0x1fe)]?.[_0x2d6c40(0x1c3)](_0x304dc3,_0x2d6c40(0x1d5)+_0x2d6c40(0x26b)+(_0x2d6c40(0x1da)+_0x40b1ed['name']+'*\x0a')+(_0x2d6c40(0x228)+_0x40b1ed[_0x2d6c40(0x1e2)]+_0x2d6c40(0x20f))+_0x2d6c40(0x1df)+'•\x20New\x20payments\x0a'+_0x2d6c40(0x258)+_0x2d6c40(0x1cf)+_0x2d6c40(0x244)+_0x2d6c40(0x213)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x2d6c40(0x254),{'parse_mode':_0x2d6c40(0x22b)}),console[_0x2d6c40(0x1de)]('✅\x20Telegram\x20user\x20'+_0x262cc8+_0x2d6c40(0x247)+_0x40b1ed[_0x2d6c40(0x1e2)]+_0x2d6c40(0x217));}catch(_0xd2b9e){console[_0x2d6c40(0x1c1)]('Error\x20in\x20handleSingleLineVerification:',_0xd2b9e),await this[_0x2d6c40(0x1fe)]?.['sendMessage'](_0x304dc3,_0x2d6c40(0x283));}}async['sendShopNotification'](_0x1cc014,_0x470b84,_0x5571c2){const _0x2a26eb=a53_0x4cf35c;if(!this[_0x2a26eb(0x1fe)]){console['warn'](_0x2a26eb(0x1be));return;}try{const _0x15d3c2=await database_1[_0x2a26eb(0x1d3)]['telegramUser']['findMany']({'where':{'shopId':_0x1cc014,'isVerified':!![]}});if(_0x15d3c2[_0x2a26eb(0x22d)]===0x0){console[_0x2a26eb(0x1de)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x1cc014);return;}const _0x3cb036=_0x15d3c2[_0x2a26eb(0x1c7)](async _0x245cbc=>{const _0x2dc41d=_0x2a26eb;try{await this[_0x2dc41d(0x1fe)]?.['sendMessage'](_0x245cbc[_0x2dc41d(0x234)],_0x470b84,_0x5571c2),console[_0x2dc41d(0x1de)](_0x2dc41d(0x27c)+_0x245cbc[_0x2dc41d(0x234)]);}catch(_0x4737cb){console[_0x2dc41d(0x1c1)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x245cbc['telegramId']+':',_0x4737cb),_0x4737cb instanceof Error&&(_0x4737cb['message'][_0x2dc41d(0x281)](_0x2dc41d(0x26a))||_0x4737cb[_0x2dc41d(0x245)]['includes'](_0x2dc41d(0x1ce))||_0x4737cb[_0x2dc41d(0x245)][_0x2dc41d(0x281)](_0x2dc41d(0x25a)))&&(await database_1[_0x2dc41d(0x1d3)]['telegramUser']['update']({'where':{'id':_0x245cbc['id']},'data':{'isVerified':![]}}),console[_0x2dc41d(0x1de)](_0x2dc41d(0x262)+_0x245cbc[_0x2dc41d(0x234)]+_0x2dc41d(0x1e9)));}});await Promise['allSettled'](_0x3cb036);}catch(_0xe489c9){console[_0x2a26eb(0x1c1)]('Error\x20sending\x20shop\x20notification:',_0xe489c9);}}async[a53_0x4cf35c(0x1c0)](_0x27ff28,_0x5acba2,_0x5c28e5){const _0x217647=a53_0x4cf35c,_0x351aad={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x2d1c71={'created':'New\x20payment\x20created','paid':_0x217647(0x23f),'failed':'Payment\x20failed','expired':_0x217647(0x24a),'refund':_0x217647(0x212),'chargeback':_0x217647(0x1eb),'processing':'Payment\x20is\x20being\x20processed'},_0x246a64=_0x351aad[_0x5c28e5],_0x18e4e9=_0x2d1c71[_0x5c28e5],_0x7e2425=(0x0,gateway_1[_0x217647(0x216)])(_0x5acba2[_0x217647(0x28c)]);console[_0x217647(0x1de)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x5acba2[_0x217647(0x28c)]+_0x217647(0x1fd)+_0x7e2425+'\x22');let _0x67fbfd=_0x246a64+'\x20*'+_0x18e4e9+_0x217647(0x220)+(_0x217647(0x255)+_0x5acba2[_0x217647(0x287)]+'\x20'+_0x5acba2[_0x217647(0x23d)]+'*\x0a')+(_0x217647(0x253)+(_0x5acba2[_0x217647(0x1fc)]||_0x5acba2['id'])+'`\x0a')+(_0x217647(0x21a)+_0x5acba2['id']+'`\x0a')+(_0x217647(0x28b)+_0x7e2425+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x5acba2['createdAt'])[_0x217647(0x1e5)]('en-US')+'\x0a');(_0x5acba2[_0x217647(0x21d)]||_0x5acba2[_0x217647(0x28e)])&&(_0x67fbfd+=_0x217647(0x1c4),_0x5acba2[_0x217647(0x21d)]&&(_0x67fbfd+=_0x217647(0x28a)+_0x5acba2[_0x217647(0x21d)]+'`\x0a'),_0x5acba2[_0x217647(0x28e)]&&(_0x67fbfd+=_0x217647(0x1fb)+_0x5acba2[_0x217647(0x28e)]+'`\x0a')),_0x5c28e5===_0x217647(0x1f9)&&_0x5acba2['chargebackAmount']&&(_0x67fbfd+='💸\x20Penalty\x20amount:\x20*'+_0x5acba2[_0x217647(0x22a)]+'\x20USDT*\x0a'),_0x5c28e5===_0x217647(0x1cd)&&(_0x67fbfd+=_0x217647(0x24b)),_0x5acba2['adminNotes']&&(_0x67fbfd+=_0x217647(0x285)+_0x5acba2[_0x217647(0x292)]+'\x0a'),await this[_0x217647(0x21b)](_0x27ff28,_0x67fbfd,{'parse_mode':_0x217647(0x22b)});}async[a53_0x4cf35c(0x205)](_0x336a72,_0x316166,_0x4140f1){const _0x568b59=a53_0x4cf35c,_0x395bd4={'created':'📤','completed':'✅','rejected':'❌'},_0x3f9c68={'created':_0x568b59(0x215),'completed':_0x568b59(0x25b),'rejected':_0x568b59(0x20d)},_0x58cc9e=_0x395bd4[_0x4140f1],_0x7d8b59=_0x3f9c68[_0x4140f1],_0x1e0895=_0x58cc9e+'\x20*'+_0x7d8b59+_0x568b59(0x220)+(_0x568b59(0x1e8)+_0x316166['amount']+_0x568b59(0x20a))+('🏦\x20Method:\x20`'+_0x316166['method']+'`\x0a')+(_0x568b59(0x27f)+_0x316166['id']+'`\x0a')+(_0x568b59(0x1e7)+new Date(_0x316166[_0x568b59(0x221)])[_0x568b59(0x1e5)]('en-US')+'\x0a')+(_0x316166['txid']?'🔗\x20TXID:\x20`'+_0x316166['txid']+'`':'');await this[_0x568b59(0x21b)](_0x336a72,_0x1e0895,{'parse_mode':_0x568b59(0x22b)});}async[a53_0x4cf35c(0x24e)](_0x5b5b78,_0x582aea){const _0x6b67ce=a53_0x4cf35c;try{const _0x904807=await database_1[_0x6b67ce(0x1d3)][_0x6b67ce(0x282)][_0x6b67ce(0x27a)]({'where':{'shopId':_0x5b5b78},'select':{'notificationLogin':!![]}});if(!_0x904807?.[_0x6b67ce(0x1f4)]){console[_0x6b67ce(0x1de)](_0x6b67ce(0x22f)+_0x5b5b78);return;}const _0x4a5283=_0x582aea[_0x6b67ce(0x1bc)]?'🔐':'🚨',_0x3abe55=_0x582aea[_0x6b67ce(0x1bc)]?_0x6b67ce(0x24c):_0x6b67ce(0x22c);let _0x4d4ae4=_0x4a5283+'\x20*'+_0x3abe55+_0x6b67ce(0x220)+(_0x6b67ce(0x228)+_0x582aea[_0x6b67ce(0x1e2)]+'`\x0a')+(_0x6b67ce(0x1bb)+_0x582aea['timestamp'][_0x6b67ce(0x1e5)](_0x6b67ce(0x24d))+'\x0a');_0x582aea['ipAddress']&&(_0x4d4ae4+='🌐\x20IP\x20address:\x20`'+_0x582aea['ipAddress']+'`\x0a');if(_0x582aea['userAgent']){const _0x285744=_0x582aea[_0x6b67ce(0x1cb)][_0x6b67ce(0x22d)]>0x32?_0x582aea[_0x6b67ce(0x1cb)]['substring'](0x0,0x32)+_0x6b67ce(0x20c):_0x582aea['userAgent'];_0x4d4ae4+='💻\x20Browser:\x20`'+_0x285744+'`\x0a';}!_0x582aea[_0x6b67ce(0x1bc)]&&(_0x4d4ae4+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this['sendShopNotification'](_0x5b5b78,_0x4d4ae4,{'parse_mode':_0x6b67ce(0x22b)}),console['log'](_0x6b67ce(0x1c2)+_0x5b5b78+':\x20'+(_0x582aea[_0x6b67ce(0x1bc)]?'success':'failed'));}catch(_0x1fa634){console[_0x6b67ce(0x1c1)](_0x6b67ce(0x248),_0x1fa634);}}async[a53_0x4cf35c(0x250)](_0x3ddda2,_0x45e80e){const _0x55ed32=a53_0x4cf35c;try{const _0x43cfb4=await database_1[_0x55ed32(0x1d3)][_0x55ed32(0x282)][_0x55ed32(0x27a)]({'where':{'shopId':_0x3ddda2},'select':{'notificationApiError':!![]}});if(!_0x43cfb4?.[_0x55ed32(0x270)]){console[_0x55ed32(0x1de)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x3ddda2);return;}let _0x237bb0=_0x55ed32(0x236)+(_0x55ed32(0x237)+_0x45e80e[_0x55ed32(0x229)]+'\x20'+_0x45e80e[_0x55ed32(0x227)]+'`\x0a')+(_0x55ed32(0x1bb)+_0x45e80e[_0x55ed32(0x206)][_0x55ed32(0x1e5)](_0x55ed32(0x24d))+'\x0a');_0x45e80e[_0x55ed32(0x1bd)]&&(_0x237bb0+=_0x55ed32(0x224)+_0x45e80e[_0x55ed32(0x1bd)]+'`\x0a'),_0x237bb0+=_0x55ed32(0x266)+_0x45e80e[_0x55ed32(0x1b9)]+'`\x0a',_0x45e80e['requestId']&&(_0x237bb0+=_0x55ed32(0x214)+_0x45e80e['requestId']+'`\x0a'),_0x237bb0+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x55ed32(0x21b)](_0x3ddda2,_0x237bb0,{'parse_mode':_0x55ed32(0x22b)}),console[_0x55ed32(0x1de)](_0x55ed32(0x1ed)+_0x3ddda2+':\x20'+_0x45e80e[_0x55ed32(0x227)]);}catch(_0x273040){console[_0x55ed32(0x1c1)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x273040);}}async[a53_0x4cf35c(0x1ff)](_0x2040ee,_0x3add39,_0x5c62c){const _0x273703=a53_0x4cf35c;let _0x1fdcde=_0x273703(0x238)+_0x3add39+_0x273703(0x220);for(const [_0x47e287,_0x217f9a]of Object['entries'](_0x5c62c)){_0x217f9a!==null&&_0x217f9a!==undefined&&(_0x1fdcde+=_0x47e287+':\x20`'+_0x217f9a+'`\x0a');}await this[_0x273703(0x21b)](_0x2040ee,_0x1fdcde,{'parse_mode':_0x273703(0x22b)});}[a53_0x4cf35c(0x28f)](){const _0x14c356=a53_0x4cf35c;return{'isActive':!!this[_0x14c356(0x1fe)],'username':this[_0x14c356(0x1b8)]};}[a53_0x4cf35c(0x242)](){const _0xf9a40=a53_0x4cf35c;this[_0xf9a40(0x1fe)]&&(this['bot'][_0xf9a40(0x25d)](),this['bot']=null,console[_0xf9a40(0x1de)](_0xf9a40(0x249)));}}exports[a53_0x4cf35c(0x23e)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();