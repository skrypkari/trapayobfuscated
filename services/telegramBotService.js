'use strict';function a63_0x51a8(){const _0x596195=['customerEmail','📱\x20Telegram\x20notification:\x20gateway\x20\x22','findFirst','update','Use\x20/start\x20to\x20connect.','gateway','📝\x20Order\x20ID:\x20`','Username:\x20`','1009411MPLrEU','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','Commands:\x0a','❌\x20Error\x20sending\x20direct\x20message:','🔗\x20Endpoint:\x20`','🏦\x20Method:\x20`','7VIramx','124083FxbUwK','Contact\x20administrator.','userAgent','__importDefault','...`\x0a\x0a','`\x0a\x0a','/disconnect\x20-\x20disconnect\x20from\x20notifications','chargebackAmount','botUsername','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','customerIp','publicKey','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','❌\x20Shop\x20`','✅\x20Telegram\x20bot\x20@','Telegram\x20bot\x20polling\x20error:','sendShopFile','•\x20`','Error\x20in\x20handleSingleLineVerification:','.png','sendDocument','customerName','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','👤\x20Username:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','\x20\x20\x20Public\x20Key:\x20`','Telegram\x20bot\x20error:','✅\x20Connected\x20to\x20shop:\x20*','Error\x20handling\x20/status\x20command:','setupBotHandlers','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','botToken','🎉\x20*Congratulations!*\x0a\x0a','forEach','💰\x20Amount:\x20*','.jpg',':\x20`','includes','endpoint','timestamp','1253085fahhOl','__esModule','🆔\x20Request\x20ID:\x20`','customerUa','warn','Use\x20/start\x20to\x20begin.','Failed\x20to\x20send\x20API\x20error\x20notification:','application/octet-stream','*\x0a\x0a','error','❌\x20Please\x20use\x20/start\x20command\x20first','toLocaleString','pk_','.jpeg','txid','polling_error','shopId','startsWith','`\x20(','env','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','📊\x20*Connection\x20Status*\x0a\x0a','shop','Payment\x20failed','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','blocked','❌\x20Error\x20getting\x20debug\x20information.','initializeBot','❌\x20Error:\x20`','1278861ZPMjzz','Payment\x20chargeback','chat','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','\x20USDT*\x0a','getGatewayDisplayNameForTelegram','💸\x20Penalty\x20amount:\x20*','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','❌\x20Invalid\x20username\x20format:\x20`','6206532VRlAlD','sendShopNotification','🌐\x20IP\x20address:\x20`','updatedAt','length','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','❌\x20Error\x20sending\x20file\x20to\x20chat:','📊\x20Error\x20code:\x20`','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','New\x20payment\x20created','You\x20sent\x20','sendLoginNotification','username','Example:\x0a','📧\x20Email:\x20`','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','New\x20payout\x20created','split','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','Successful\x20login','trapay_bot',':\x20username=\x22','telegramId','🌐\x20IP:\x20`','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','substring','Markdown','orderId','image/jpeg','sendPayoutNotification','\x0a👤\x20*Customer\x20Information:*\x0a','isVerified','defineProperty','•\x20Payouts\x0a','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','sendCustomNotification','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','•\x20Payouts\x0a\x0a','text','endsWith','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','🔔\x20*','...','telegramUser','🔔\x20Notifications\x20are\x20active\x0a\x0a','Payout\x20completed','getBotInfo','adminNotes','join','TELEGRAM_BOT_TOKEN','method','handleSingleLineVerification','📅\x20Time:\x20','test','🏪\x20Gateway:\x20`','🔌\x20User\x20','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','stopPolling','shopSettings','Payout\x20rejected','log','application/pdf','remitterIban','📛\x20Name:\x20`','📱\x20Created\x20new\x20Telegram\x20user:\x20','🛑\x20Telegram\x20bot\x20stopped','map','/status\x20-\x20check\x20connection\x20status\x0a','📅\x20Date:\x20','🏦\x20IBAN:\x20`','ipAddress','24wbFiLV','\x20users\x20of\x20shop\x20','Available\x20usernames:\x0a','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','💻\x20Browser:\x20`','`\x20is\x20inactive.\x0a\x0a','status','Error\x20handling\x20message:','\x20initialized\x20successfully','stopBot','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','telegramBotService','❌\x20Error\x20sending\x20file\x20to\x20user\x20','\x22,\x20apiKey=\x22','amount','findMany','...\x22','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','\x20(@','1887600uitGRg','🏪\x20Available\x20shops\x20in\x20system:\x0a','trim','🔗\x20TXID:\x20`','✅\x20File\x20sent\x20to\x20chat\x20','findUnique','sendDirectFile','last_name','\x20parts:\x20','bot','\x20\x20\x20Username:\x20`','message','createdAt','❌\x20Telegram\x20bot\x20not\x20initialized','requestId','currency','node-telegram-bot-api','Payment\x20successfully\x20paid','default','from','4egQFxB','User\x20','❌\x20Error\x20sending\x20file\x20to\x20shop:','TelegramBotService','✅\x20File\x20sent\x20to\x20','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','\x20USD*\x0a','user\x20is\x20deactivated','❌\x20Shop\x20with\x20username\x20`','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','*.\x0a\x0a','onText','.\x20*','create','.pdf','chargeback','image/png','sendMessage','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','sk_','Error\x20handling\x20/start\x20command:','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','Failed\x20to\x20send\x20login\x20notification:','../types/gateway','toLocaleDateString','\x20via\x20single-line\x20input','sendPaymentNotification','success','en-US','💸\x20Amount:\x20*','To\x20reconnect,\x20use\x20the\x20/start\x20command','`.\x0a\x0a','sendNotificationToAll','name','🆔\x20Payment\x20ID:\x20`','`\x20not\x20found.\x0a\x0a','•\x20New\x20payments\x0a','2282426JnBUVX','🚨\x20*API\x20Error*\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','toString','statusCode','📱\x20No\x20active\x20Telegram\x20users\x20found','ACTIVE'];a63_0x51a8=function(){return _0x596195;};return a63_0x51a8();}const a63_0x5853dc=a63_0xf8cd;(function(_0x148efd,_0x24fc69){const _0x5d973d=a63_0xf8cd,_0x5bf3a3=_0x148efd();while(!![]){try{const _0x1a53ce=parseInt(_0x5d973d(0x201))/0x1+parseInt(_0x5d973d(0x1f2))/0x2+-parseInt(_0x5d973d(0x250))/0x3*(parseInt(_0x5d973d(0x1cb))/0x4)+parseInt(_0x5d973d(0x231))/0x5+parseInt(_0x5d973d(0x25d))/0x6*(-parseInt(_0x5d973d(0x207))/0x7)+parseInt(_0x5d973d(0x1a4))/0x8*(-parseInt(_0x5d973d(0x208))/0x9)+-parseInt(_0x5d973d(0x1b7))/0xa;if(_0x1a53ce===_0x24fc69)break;else _0x5bf3a3['push'](_0x5bf3a3['shift']());}catch(_0x4c7820){_0x5bf3a3['push'](_0x5bf3a3['shift']());}}}(a63_0x51a8,0xad70b));function a63_0xf8cd(_0x4ab679,_0x3f989e){const _0x51a860=a63_0x51a8();return a63_0xf8cd=function(_0xf8cd35,_0x5c8f05){_0xf8cd35=_0xf8cd35-0x19b;let _0x3cbb55=_0x51a860[_0xf8cd35];return _0x3cbb55;},a63_0xf8cd(_0x4ab679,_0x3f989e);}var __importDefault=this&&this[a63_0x5853dc(0x20b)]||function(_0x43e2f2){const _0x3c43c1=a63_0x5853dc;return _0x43e2f2&&_0x43e2f2[_0x3c43c1(0x232)]?_0x43e2f2:{'default':_0x43e2f2};};Object[a63_0x5853dc(0x27d)](exports,a63_0x5853dc(0x232),{'value':!![]}),exports[a63_0x5853dc(0x1af)]=exports[a63_0x5853dc(0x1ce)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a63_0x5853dc(0x1c7))),database_1=__importDefault(require('../config/database')),gateway_1=require(a63_0x5853dc(0x1e4));class TelegramBotService{constructor(){const _0x16f7a4=a63_0x5853dc;this[_0x16f7a4(0x1c0)]=null,this[_0x16f7a4(0x228)]=process[_0x16f7a4(0x244)][_0x16f7a4(0x28e)]||'',this[_0x16f7a4(0x210)]=process['env']['TELEGRAM_BOT_USERNAME']||_0x16f7a4(0x271),this[_0x16f7a4(0x228)]?this[_0x16f7a4(0x24e)]():console[_0x16f7a4(0x235)](_0x16f7a4(0x281));}[a63_0x5853dc(0x24e)](){const _0x1d82f3=a63_0x5853dc;try{this[_0x1d82f3(0x1c0)]=new node_telegram_bot_api_1[(_0x1d82f3(0x1c9))](this['botToken'],{'polling':!![]}),this[_0x1d82f3(0x226)](),console[_0x1d82f3(0x299)](_0x1d82f3(0x217)+this[_0x1d82f3(0x210)]+_0x1d82f3(0x1ac));}catch(_0x18a340){console[_0x1d82f3(0x23a)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x18a340);}}['setupBotHandlers'](){const _0x44cd01=a63_0x5853dc;if(!this[_0x44cd01(0x1c0)])return;this[_0x44cd01(0x1c0)]['onText'](/\/start/,async _0x17ead8=>{const _0x34ff45=_0x44cd01,_0x268044=_0x17ead8[_0x34ff45(0x252)]['id'],_0x17c900=_0x17ead8['from']?.['id'][_0x34ff45(0x1f5)](),_0x5d711d=_0x17ead8[_0x34ff45(0x1ca)]?.[_0x34ff45(0x269)],_0xc7a2ab=_0x17ead8[_0x34ff45(0x1ca)]?.['first_name'],_0x3185e8=_0x17ead8[_0x34ff45(0x1ca)]?.[_0x34ff45(0x1be)];if(!_0x17c900)return;try{let _0x231756=await database_1[_0x34ff45(0x1c9)][_0x34ff45(0x288)]['findUnique']({'where':{'telegramId':_0x17c900},'include':{'shop':!![]}});!_0x231756?(_0x231756=await database_1[_0x34ff45(0x1c9)][_0x34ff45(0x288)][_0x34ff45(0x1d9)]({'data':{'telegramId':_0x17c900,'username':_0x5d711d,'firstName':_0xc7a2ab,'lastName':_0x3185e8,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x34ff45(0x299)](_0x34ff45(0x19d)+_0x17c900+_0x34ff45(0x1b6)+_0x5d711d+')')):_0x231756=await database_1[_0x34ff45(0x1c9)][_0x34ff45(0x288)]['update']({'where':{'telegramId':_0x17c900},'data':{'username':_0x5d711d,'firstName':_0xc7a2ab,'lastName':_0x3185e8},'include':{'shop':!![]}}),_0x231756[_0x34ff45(0x27c)]&&_0x231756[_0x34ff45(0x241)]&&_0x231756[_0x34ff45(0x248)]?await this[_0x34ff45(0x1c0)]?.[_0x34ff45(0x1dd)](_0x268044,'✅\x20Welcome\x20back!\x0a\x0a'+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x231756[_0x34ff45(0x248)][_0x34ff45(0x1ee)]+'*\x0a')+(_0x34ff45(0x200)+_0x231756[_0x34ff45(0x248)][_0x34ff45(0x269)]+'`\x0a\x0a')+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x34ff45(0x1f1)+'•\x20Payment\x20status\x20changes\x0a'+_0x34ff45(0x282)+_0x34ff45(0x203)+'/status\x20-\x20check\x20connection\x20status\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x34ff45(0x277)}):(_0x231756[_0x34ff45(0x241)]&&!_0x231756[_0x34ff45(0x27c)]&&(await database_1['default']['telegramUser']['update']({'where':{'telegramId':_0x17c900},'data':{'shopId':null,'isVerified':![]}}),console[_0x34ff45(0x299)](_0x34ff45(0x26c)+_0x17c900)),await this['bot']?.[_0x34ff45(0x1dd)](_0x268044,_0x34ff45(0x202)+_0x34ff45(0x25a)+_0x34ff45(0x1ae)+_0x34ff45(0x26a)+_0x34ff45(0x1de)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x34ff45(0x277)}));}catch(_0x4f2a03){console[_0x34ff45(0x23a)](_0x34ff45(0x1e0),_0x4f2a03),await this[_0x34ff45(0x1c0)]?.[_0x34ff45(0x1dd)](_0x268044,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x44cd01(0x1c0)]['onText'](/\/disconnect/,async _0xf2a20b=>{const _0x5c05b5=_0x44cd01,_0x1d8b69=_0xf2a20b[_0x5c05b5(0x252)]['id'],_0x55ac66=_0xf2a20b[_0x5c05b5(0x1ca)]?.['id'][_0x5c05b5(0x1f5)]();if(!_0x55ac66)return;try{const _0x45bac4=await database_1[_0x5c05b5(0x1c9)][_0x5c05b5(0x288)][_0x5c05b5(0x1bc)]({'where':{'telegramId':_0x55ac66},'include':{'shop':!![]}});if(!_0x45bac4||!_0x45bac4[_0x5c05b5(0x27c)]||!_0x45bac4['shopId']){await this[_0x5c05b5(0x1c0)]?.[_0x5c05b5(0x1dd)](_0x1d8b69,_0x5c05b5(0x221));return;}const _0x1ddc46=_0x45bac4['shop']?.[_0x5c05b5(0x1ee)]||'unknown\x20shop';await database_1[_0x5c05b5(0x1c9)]['telegramUser']['update']({'where':{'telegramId':_0x55ac66},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x5c05b5(0x294)+_0x55ac66+'\x20disconnected\x20from\x20shop\x20'+_0x45bac4[_0x5c05b5(0x241)]),await this[_0x5c05b5(0x1c0)]?.[_0x5c05b5(0x1dd)](_0x1d8b69,_0x5c05b5(0x1f4)+_0x1ddc46+_0x5c05b5(0x1d6)+_0x5c05b5(0x1eb),{'parse_mode':_0x5c05b5(0x277)});}catch(_0x43e665){console[_0x5c05b5(0x23a)]('Error\x20handling\x20/disconnect\x20command:',_0x43e665),await this['bot']?.['sendMessage'](_0x1d8b69,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x44cd01(0x1c0)]['onText'](/\/status/,async _0x1da939=>{const _0x275f7d=_0x44cd01,_0x13348c=_0x1da939['chat']['id'],_0x4d5926=_0x1da939[_0x275f7d(0x1ca)]?.['id'][_0x275f7d(0x1f5)]();if(!_0x4d5926)return;try{const _0x2a9492=await database_1['default'][_0x275f7d(0x288)][_0x275f7d(0x1bc)]({'where':{'telegramId':_0x4d5926},'include':{'shop':!![]}});if(!_0x2a9492){await this['bot']?.[_0x275f7d(0x1dd)](_0x13348c,_0x275f7d(0x21f)+_0x275f7d(0x236));return;}if(!_0x2a9492[_0x275f7d(0x27c)]||!_0x2a9492['shopId']||!_0x2a9492[_0x275f7d(0x248)]){await this[_0x275f7d(0x1c0)]?.[_0x275f7d(0x1dd)](_0x13348c,_0x275f7d(0x256)+_0x275f7d(0x1fd));return;}await this['bot']?.[_0x275f7d(0x1dd)](_0x13348c,_0x275f7d(0x247)+(_0x275f7d(0x224)+_0x2a9492['shop'][_0x275f7d(0x1ee)]+'*\x0a')+(_0x275f7d(0x220)+_0x2a9492[_0x275f7d(0x248)]['username']+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x2a9492[_0x275f7d(0x260)][_0x275f7d(0x1e5)](_0x275f7d(0x1e9))+'\x0a\x0a')+_0x275f7d(0x289)+'Commands:\x0a'+_0x275f7d(0x20e),{'parse_mode':_0x275f7d(0x277)});}catch(_0x3ba787){console[_0x275f7d(0x23a)](_0x275f7d(0x225),_0x3ba787),await this[_0x275f7d(0x1c0)]?.[_0x275f7d(0x1dd)](_0x13348c,_0x275f7d(0x227));}}),this[_0x44cd01(0x1c0)][_0x44cd01(0x1d7)](/\/debug/,async _0x3e3fb1=>{const _0x2f8720=_0x44cd01,_0x5de628=_0x3e3fb1[_0x2f8720(0x252)]['id'],_0x23ddd6=_0x3e3fb1[_0x2f8720(0x1ca)]?.['id'][_0x2f8720(0x1f5)]();if(!_0x23ddd6)return;try{const _0x111565=await database_1[_0x2f8720(0x1c9)]['shop']['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x27c0a6='🔍\x20*Debug\x20Information*\x0a\x0a';_0x27c0a6+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x23ddd6+'`\x0a\x0a',_0x27c0a6+=_0x2f8720(0x1b8),_0x111565[_0x2f8720(0x22a)]((_0x421c4d,_0x521f48)=>{const _0x50a024=_0x2f8720;_0x27c0a6+=_0x521f48+0x1+_0x50a024(0x1d8)+_0x421c4d[_0x50a024(0x1ee)]+'*\x0a',_0x27c0a6+=_0x50a024(0x1c1)+_0x421c4d[_0x50a024(0x269)]+'`\x0a',_0x27c0a6+='\x20\x20\x20Status:\x20'+_0x421c4d[_0x50a024(0x1aa)]+'\x0a',_0x27c0a6+=_0x50a024(0x222)+_0x421c4d['publicKey'][_0x50a024(0x276)](0x0,0xf)+_0x50a024(0x20c);}),await this['bot']?.['sendMessage'](_0x5de628,_0x27c0a6,{'parse_mode':'Markdown'});}catch(_0x2e42ce){console['error']('Error\x20handling\x20/debug\x20command:',_0x2e42ce),await this['bot']?.[_0x2f8720(0x1dd)](_0x5de628,_0x2f8720(0x24d));}}),this[_0x44cd01(0x1c0)]['on'](_0x44cd01(0x1c2),async _0x5de9af=>{const _0x233bca=_0x44cd01;if(_0x5de9af[_0x233bca(0x283)]?.[_0x233bca(0x242)]('/'))return;const _0x360b07=_0x5de9af['chat']['id'],_0x3c138c=_0x5de9af[_0x233bca(0x1ca)]?.['id'][_0x233bca(0x1f5)](),_0x353344=_0x5de9af['text']?.[_0x233bca(0x1b9)]();if(!_0x3c138c||!_0x353344)return;try{const _0x3b724a=await database_1[_0x233bca(0x1c9)]['telegramUser'][_0x233bca(0x1bc)]({'where':{'telegramId':_0x3c138c},'include':{'shop':!![]}});if(!_0x3b724a){await this[_0x233bca(0x1c0)]?.[_0x233bca(0x1dd)](_0x360b07,_0x233bca(0x23b));return;}if(_0x3b724a[_0x233bca(0x27c)]&&_0x3b724a['shopId']&&_0x3b724a[_0x233bca(0x248)]){await this[_0x233bca(0x1c0)]?.[_0x233bca(0x1dd)](_0x360b07,_0x233bca(0x295)+_0x3b724a['shop'][_0x233bca(0x1ee)]+_0x233bca(0x1d6)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x233bca(0x277)});return;}const _0x21bd75=_0x353344[_0x233bca(0x26e)](/\s+/);if(_0x21bd75[_0x233bca(0x261)]!==0x2){await this['bot']?.[_0x233bca(0x1dd)](_0x360b07,_0x233bca(0x211)+_0x233bca(0x1ae)+_0x233bca(0x26a)+_0x233bca(0x1de)+(_0x233bca(0x267)+_0x21bd75['length']+_0x233bca(0x1bf)+_0x21bd75['map'](_0x1d6596=>'`'+_0x1d6596+'`')[_0x233bca(0x28d)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0xcec5a1,_0x1e9a71]=_0x21bd75;console[_0x233bca(0x299)](_0x233bca(0x1a7)+_0x3c138c+_0x233bca(0x272)+_0xcec5a1+_0x233bca(0x1b1)+_0x1e9a71[_0x233bca(0x276)](0x0,0xa)+_0x233bca(0x1b4)),await this[_0x233bca(0x290)](_0x360b07,_0x3c138c,_0xcec5a1,_0x1e9a71);}catch(_0x2fdc0c){console[_0x233bca(0x23a)](_0x233bca(0x1ab),_0x2fdc0c),await this[_0x233bca(0x1c0)]?.[_0x233bca(0x1dd)](_0x360b07,_0x233bca(0x227));}}),this[_0x44cd01(0x1c0)]['on'](_0x44cd01(0x23a),_0x52d899=>{const _0x50e798=_0x44cd01;console[_0x50e798(0x23a)](_0x50e798(0x223),_0x52d899);}),this[_0x44cd01(0x1c0)]['on'](_0x44cd01(0x240),_0x67260b=>{const _0x39cc3d=_0x44cd01;console[_0x39cc3d(0x23a)](_0x39cc3d(0x218),_0x67260b);});}async['handleSingleLineVerification'](_0x3907de,_0x3a32dd,_0xd6e33d,_0x7fc079){const _0x57a67f=a63_0x5853dc;try{console[_0x57a67f(0x299)](_0x57a67f(0x1a7)+_0x3a32dd+_0x57a67f(0x272)+_0xd6e33d+'\x22,\x20apiKey=\x22'+_0x7fc079[_0x57a67f(0x276)](0x0,0xa)+_0x57a67f(0x1b4));if(!_0xd6e33d||_0xd6e33d[_0x57a67f(0x261)]<0x3||_0xd6e33d['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x57a67f(0x292)](_0xd6e33d)){await this[_0x57a67f(0x1c0)]?.[_0x57a67f(0x1dd)](_0x3907de,_0x57a67f(0x25c)+_0xd6e33d+_0x57a67f(0x20d)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x57a67f(0x277)});return;}if(!_0x7fc079||!_0x7fc079[_0x57a67f(0x242)](_0x57a67f(0x23d))&&!_0x7fc079[_0x57a67f(0x242)](_0x57a67f(0x1df))){await this[_0x57a67f(0x1c0)]?.[_0x57a67f(0x1dd)](_0x3907de,_0x57a67f(0x254)+_0x57a67f(0x1e2),{'parse_mode':_0x57a67f(0x277)});return;}const _0x48418f=await database_1['default'][_0x57a67f(0x248)]['findUnique']({'where':{'username':_0xd6e33d},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x48418f){const _0x2eba83=await database_1[_0x57a67f(0x1c9)][_0x57a67f(0x248)][_0x57a67f(0x1b3)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x445078=_0x57a67f(0x1d3)+_0xd6e33d+_0x57a67f(0x1f0);_0x2eba83[_0x57a67f(0x261)]>0x0?(_0x445078+=_0x57a67f(0x1a6),_0x2eba83[_0x57a67f(0x22a)](_0x220037=>{const _0x10c21c=_0x57a67f;_0x445078+=_0x10c21c(0x21a)+_0x220037[_0x10c21c(0x269)]+_0x10c21c(0x243)+_0x220037[_0x10c21c(0x1ee)]+')\x0a';}),_0x445078+=_0x57a67f(0x25b)):_0x445078+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x57a67f(0x1c0)]?.[_0x57a67f(0x1dd)](_0x3907de,_0x445078,{'parse_mode':_0x57a67f(0x277)});return;}if(_0x48418f[_0x57a67f(0x1aa)]!==_0x57a67f(0x1f8)){await this[_0x57a67f(0x1c0)]?.['sendMessage'](_0x3907de,_0x57a67f(0x216)+_0xd6e33d+_0x57a67f(0x1a9)+_0x57a67f(0x209),{'parse_mode':_0x57a67f(0x277)});return;}if(_0x48418f[_0x57a67f(0x213)]!==_0x7fc079&&_0x48418f['secretKey']!==_0x7fc079){await this[_0x57a67f(0x1c0)]?.[_0x57a67f(0x1dd)](_0x3907de,_0x57a67f(0x215)+_0xd6e33d+_0x57a67f(0x1ec)+_0x57a67f(0x1d5)+_0x57a67f(0x285),{'parse_mode':_0x57a67f(0x277)});return;}const _0x5d248b=await database_1['default']['telegramUser'][_0x57a67f(0x1fb)]({'where':{'shopId':_0x48418f['id'],'isVerified':!![],'telegramId':{'not':_0x3a32dd}}});if(_0x5d248b){await this[_0x57a67f(0x1c0)]?.['sendMessage'](_0x3907de,_0x57a67f(0x26f)+_0xd6e33d+_0x57a67f(0x1ec)+_0x57a67f(0x1d4),{'parse_mode':_0x57a67f(0x277)});return;}await database_1[_0x57a67f(0x1c9)][_0x57a67f(0x288)][_0x57a67f(0x1fc)]({'where':{'telegramId':_0x3a32dd},'data':{'shopId':_0x48418f['id'],'isVerified':!![]}}),await this[_0x57a67f(0x1c0)]?.[_0x57a67f(0x1dd)](_0x3907de,_0x57a67f(0x229)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('📱\x20Shop:\x20*'+_0x48418f['name']+'*\x0a')+(_0x57a67f(0x220)+_0x48418f[_0x57a67f(0x269)]+_0x57a67f(0x20d))+_0x57a67f(0x1d0)+_0x57a67f(0x1f1)+'•\x20Payment\x20status\x20changes\x0a'+_0x57a67f(0x27e)+'•\x20Important\x20events\x0a\x0a'+'Commands:\x0a'+_0x57a67f(0x1a0)+_0x57a67f(0x20e),{'parse_mode':_0x57a67f(0x277)}),console[_0x57a67f(0x299)]('✅\x20Telegram\x20user\x20'+_0x3a32dd+'\x20verified\x20for\x20shop\x20'+_0x48418f['username']+_0x57a67f(0x1e6));}catch(_0x3f0df7){console[_0x57a67f(0x23a)](_0x57a67f(0x21b),_0x3f0df7),await this[_0x57a67f(0x1c0)]?.[_0x57a67f(0x1dd)](_0x3907de,_0x57a67f(0x262));}}async['sendShopNotification'](_0x4e0b45,_0x5441a7,_0x10f2e9){const _0x49c796=a63_0x5853dc;if(!this[_0x49c796(0x1c0)]){console['warn'](_0x49c796(0x24a));return;}try{const _0x5b32d8=await database_1['default'][_0x49c796(0x288)]['findMany']({'where':{'shopId':_0x4e0b45,'isVerified':!![]}});if(_0x5b32d8['length']===0x0){console[_0x49c796(0x299)](_0x49c796(0x246)+_0x4e0b45);return;}const _0x140064=_0x5b32d8[_0x49c796(0x19f)](async _0x526618=>{const _0x20a439=_0x49c796;try{await this[_0x20a439(0x1c0)]?.[_0x20a439(0x1dd)](_0x526618[_0x20a439(0x273)],_0x5441a7,_0x10f2e9),console[_0x20a439(0x299)](_0x20a439(0x275)+_0x526618[_0x20a439(0x273)]);}catch(_0x1b6982){console[_0x20a439(0x23a)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x526618['telegramId']+':',_0x1b6982),_0x1b6982 instanceof Error&&(_0x1b6982[_0x20a439(0x1c2)][_0x20a439(0x22e)](_0x20a439(0x24c))||_0x1b6982[_0x20a439(0x1c2)][_0x20a439(0x22e)]('chat\x20not\x20found')||_0x1b6982[_0x20a439(0x1c2)][_0x20a439(0x22e)](_0x20a439(0x1d2)))&&(await database_1[_0x20a439(0x1c9)][_0x20a439(0x288)][_0x20a439(0x1fc)]({'where':{'id':_0x526618['id']},'data':{'isVerified':![]}}),console[_0x20a439(0x299)](_0x20a439(0x1cc)+_0x526618['telegramId']+_0x20a439(0x24b)));}});await Promise['allSettled'](_0x140064);}catch(_0x3d876a){console['error']('Error\x20sending\x20shop\x20notification:',_0x3d876a);}}async[a63_0x5853dc(0x1e7)](_0x5aa630,_0x9a3950,_0x29ca34){const _0x31a10a=a63_0x5853dc,_0x10befa={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x2ade8b={'created':_0x31a10a(0x266),'paid':_0x31a10a(0x1c8),'failed':_0x31a10a(0x249),'expired':'Payment\x20expired','refund':'Payment\x20refund','chargeback':_0x31a10a(0x251),'processing':'Payment\x20is\x20being\x20processed'},_0x2ad5d5=_0x10befa[_0x29ca34],_0x3ef4ea=_0x2ade8b[_0x29ca34],_0x3e05c6=(0x0,gateway_1[_0x31a10a(0x258)])(_0x9a3950['gateway']);console[_0x31a10a(0x299)](_0x31a10a(0x1fa)+_0x9a3950[_0x31a10a(0x1fe)]+'\x22\x20->\x20display\x20\x22'+_0x3e05c6+'\x22');let _0x46bb7c=_0x2ad5d5+'\x20*'+_0x3ef4ea+_0x31a10a(0x239)+(_0x31a10a(0x22b)+_0x9a3950[_0x31a10a(0x1b2)]+'\x20'+_0x9a3950[_0x31a10a(0x1c6)]+'*\x0a')+(_0x31a10a(0x1ff)+(_0x9a3950[_0x31a10a(0x278)]||_0x9a3950['id'])+'`\x0a')+(_0x31a10a(0x1ef)+_0x9a3950['id']+'`\x0a')+(_0x31a10a(0x293)+_0x3e05c6+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x9a3950['createdAt'])[_0x31a10a(0x23c)](_0x31a10a(0x1e9))+'\x0a');if(_0x9a3950['customerName']||_0x9a3950[_0x31a10a(0x1f9)]||_0x9a3950[_0x31a10a(0x19b)]||_0x9a3950[_0x31a10a(0x212)]||_0x9a3950[_0x31a10a(0x234)]){_0x46bb7c+=_0x31a10a(0x27b);_0x9a3950[_0x31a10a(0x21e)]&&(_0x46bb7c+=_0x31a10a(0x19c)+_0x9a3950[_0x31a10a(0x21e)]+'`\x0a');_0x9a3950[_0x31a10a(0x1f9)]&&(_0x46bb7c+=_0x31a10a(0x26b)+_0x9a3950['customerEmail']+'`\x0a');_0x9a3950[_0x31a10a(0x19b)]&&(_0x46bb7c+=_0x31a10a(0x1a2)+_0x9a3950[_0x31a10a(0x19b)]+'`\x0a');_0x9a3950['customerIp']&&(_0x46bb7c+=_0x31a10a(0x274)+_0x9a3950[_0x31a10a(0x212)]+'`\x0a');if(_0x9a3950[_0x31a10a(0x234)]){const _0x2f9e43=_0x9a3950[_0x31a10a(0x234)][_0x31a10a(0x261)]>0x32?_0x9a3950['customerUa']['substring'](0x0,0x32)+_0x31a10a(0x287):_0x9a3950['customerUa'];_0x46bb7c+=_0x31a10a(0x1a8)+_0x2f9e43+'`\x0a';}}_0x29ca34===_0x31a10a(0x1db)&&_0x9a3950[_0x31a10a(0x20f)]&&(_0x46bb7c+=_0x31a10a(0x259)+_0x9a3950['chargebackAmount']+_0x31a10a(0x257)),_0x29ca34==='processing'&&(_0x46bb7c+=_0x31a10a(0x27f)),_0x9a3950['adminNotes']&&(_0x46bb7c+='📝\x20Notes:\x20'+_0x9a3950[_0x31a10a(0x28c)]+'\x0a'),await this[_0x31a10a(0x25e)](_0x5aa630,_0x46bb7c,{'parse_mode':_0x31a10a(0x277)});}async[a63_0x5853dc(0x27a)](_0x58a2cb,_0x9ae78,_0xbecdcc){const _0x18b647=a63_0x5853dc,_0x567102={'created':'📤','completed':'✅','rejected':'❌'},_0x4a9ed7={'created':_0x18b647(0x26d),'completed':_0x18b647(0x28a),'rejected':_0x18b647(0x298)},_0x3ddfad=_0x567102[_0xbecdcc],_0x464afd=_0x4a9ed7[_0xbecdcc],_0x1a7587=_0x3ddfad+'\x20*'+_0x464afd+_0x18b647(0x239)+(_0x18b647(0x1ea)+_0x9ae78[_0x18b647(0x1b2)]+_0x18b647(0x1d1))+(_0x18b647(0x206)+_0x9ae78[_0x18b647(0x28f)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x9ae78['id']+'`\x0a')+(_0x18b647(0x1a1)+new Date(_0x9ae78[_0x18b647(0x1c3)])[_0x18b647(0x23c)](_0x18b647(0x1e9))+'\x0a')+(_0x9ae78[_0x18b647(0x23f)]?_0x18b647(0x1ba)+_0x9ae78['txid']+'`':'');await this[_0x18b647(0x25e)](_0x58a2cb,_0x1a7587,{'parse_mode':_0x18b647(0x277)});}async[a63_0x5853dc(0x268)](_0xf35582,_0xb14af1){const _0x519b22=a63_0x5853dc;try{const _0x287c11=await database_1[_0x519b22(0x1c9)][_0x519b22(0x297)]['findUnique']({'where':{'shopId':_0xf35582},'select':{'notificationLogin':!![]}});if(!_0x287c11?.['notificationLogin']){console[_0x519b22(0x299)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0xf35582);return;}const _0x4fb3f0=_0xb14af1[_0x519b22(0x1e8)]?'🔐':'🚨',_0x7b0a39=_0xb14af1[_0x519b22(0x1e8)]?_0x519b22(0x270):'Failed\x20login\x20attempt';let _0x2b186a=_0x4fb3f0+'\x20*'+_0x7b0a39+_0x519b22(0x239)+(_0x519b22(0x220)+_0xb14af1[_0x519b22(0x269)]+'`\x0a')+(_0x519b22(0x291)+_0xb14af1[_0x519b22(0x230)][_0x519b22(0x23c)](_0x519b22(0x1e9))+'\x0a');_0xb14af1[_0x519b22(0x1a3)]&&(_0x2b186a+=_0x519b22(0x25f)+_0xb14af1[_0x519b22(0x1a3)]+'`\x0a');if(_0xb14af1[_0x519b22(0x20a)]){const _0x32e590=_0xb14af1['userAgent'][_0x519b22(0x261)]>0x32?_0xb14af1[_0x519b22(0x20a)][_0x519b22(0x276)](0x0,0x32)+_0x519b22(0x287):_0xb14af1[_0x519b22(0x20a)];_0x2b186a+='💻\x20Browser:\x20`'+_0x32e590+'`\x0a';}!_0xb14af1['success']&&(_0x2b186a+=_0x519b22(0x1e1)),await this[_0x519b22(0x25e)](_0xf35582,_0x2b186a,{'parse_mode':_0x519b22(0x277)}),console[_0x519b22(0x299)](_0x519b22(0x245)+_0xf35582+':\x20'+(_0xb14af1[_0x519b22(0x1e8)]?'success':'failed'));}catch(_0x56998e){console[_0x519b22(0x23a)](_0x519b22(0x1e3),_0x56998e);}}async['sendApiErrorNotification'](_0xd4b826,_0x1e08fd){const _0x4392be=a63_0x5853dc;try{const _0x222efc=await database_1[_0x4392be(0x1c9)][_0x4392be(0x297)][_0x4392be(0x1bc)]({'where':{'shopId':_0xd4b826},'select':{'notificationApiError':!![]}});if(!_0x222efc?.['notificationApiError']){console[_0x4392be(0x299)](_0x4392be(0x253)+_0xd4b826);return;}let _0x46bec4=_0x4392be(0x1f3)+(_0x4392be(0x205)+_0x1e08fd['method']+'\x20'+_0x1e08fd[_0x4392be(0x22f)]+'`\x0a')+(_0x4392be(0x291)+_0x1e08fd[_0x4392be(0x230)]['toLocaleString'](_0x4392be(0x1e9))+'\x0a');_0x1e08fd['statusCode']&&(_0x46bec4+=_0x4392be(0x264)+_0x1e08fd[_0x4392be(0x1f6)]+'`\x0a'),_0x46bec4+=_0x4392be(0x24f)+_0x1e08fd['errorMessage']+'`\x0a',_0x1e08fd[_0x4392be(0x1c5)]&&(_0x46bec4+=_0x4392be(0x233)+_0x1e08fd['requestId']+'`\x0a'),_0x46bec4+=_0x4392be(0x214),await this[_0x4392be(0x25e)](_0xd4b826,_0x46bec4,{'parse_mode':_0x4392be(0x277)}),console[_0x4392be(0x299)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0xd4b826+':\x20'+_0x1e08fd[_0x4392be(0x22f)]);}catch(_0x3531d8){console['error'](_0x4392be(0x237),_0x3531d8);}}async[a63_0x5853dc(0x280)](_0xbd6b0d,_0x296614,_0x1b7ba1){const _0x122fce=a63_0x5853dc;let _0x146c74=_0x122fce(0x286)+_0x296614+_0x122fce(0x239);for(const [_0x1551e1,_0xda6663]of Object['entries'](_0x1b7ba1)){_0xda6663!==null&&_0xda6663!==undefined&&(_0x146c74+=_0x1551e1+_0x122fce(0x22d)+_0xda6663+'`\x0a');}await this[_0x122fce(0x25e)](_0xbd6b0d,_0x146c74,{'parse_mode':_0x122fce(0x277)});}async[a63_0x5853dc(0x1ed)](_0x303ea5){const _0x34291b=a63_0x5853dc;try{console['log'](_0x34291b(0x255)+_0x303ea5[_0x34291b(0x276)](0x0,0x32)+_0x34291b(0x287));const _0x2760dc=await database_1[_0x34291b(0x1c9)][_0x34291b(0x288)][_0x34291b(0x1b3)]({'select':{'telegramId':!![]}});if(_0x2760dc[_0x34291b(0x261)]===0x0){console[_0x34291b(0x299)](_0x34291b(0x1f7));return;}for(const _0x128bd8 of _0x2760dc){try{await this[_0x34291b(0x1c0)]?.[_0x34291b(0x1dd)](_0x128bd8[_0x34291b(0x273)],_0x303ea5,{'parse_mode':_0x34291b(0x277)});}catch(_0x4b731e){console[_0x34291b(0x23a)](_0x34291b(0x1b5)+_0x128bd8[_0x34291b(0x273)]+':',_0x4b731e);}}console[_0x34291b(0x299)]('📱\x20Notification\x20sent\x20to\x20'+_0x2760dc['length']+'\x20users');}catch(_0x11de33){console[_0x34291b(0x23a)](_0x34291b(0x265),_0x11de33);}}[a63_0x5853dc(0x28b)](){const _0x7cd5af=a63_0x5853dc;return{'isActive':!!this[_0x7cd5af(0x1c0)],'username':this[_0x7cd5af(0x210)]};}async[a63_0x5853dc(0x219)](_0x541f30,_0x137284,_0x3d86f2,_0x5c8d06){const _0x353a9f=a63_0x5853dc;try{if(!this['bot'])return console[_0x353a9f(0x23a)]('❌\x20Telegram\x20bot\x20not\x20initialized'),![];const _0x35d639=await database_1['default']['telegramUser']['findMany']({'where':{'shopId':_0x541f30,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x35d639[_0x353a9f(0x261)]===0x0)return console[_0x353a9f(0x23a)]('❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20'+_0x541f30),![];let _0x3e9b63=0x0;for(const _0x4bc07a of _0x35d639){try{await this['bot']['sendDocument'](_0x4bc07a[_0x353a9f(0x273)],_0x137284,{},{'filename':_0x3d86f2,'contentType':_0x3d86f2['endsWith'](_0x353a9f(0x21c))?_0x353a9f(0x1dc):_0x3d86f2['endsWith'](_0x353a9f(0x22c))||_0x3d86f2[_0x353a9f(0x284)](_0x353a9f(0x23e))?_0x353a9f(0x279):_0x3d86f2['endsWith'](_0x353a9f(0x1da))?_0x353a9f(0x29a):_0x353a9f(0x238)}),_0x5c8d06&&await this['bot']['sendMessage'](_0x4bc07a['telegramId'],_0x5c8d06),_0x3e9b63++;}catch(_0x1b467a){console['error'](_0x353a9f(0x1b0)+_0x4bc07a[_0x353a9f(0x273)]+':',_0x1b467a);}}return console[_0x353a9f(0x299)](_0x353a9f(0x1cf)+_0x3e9b63+'/'+_0x35d639[_0x353a9f(0x261)]+_0x353a9f(0x1a5)+_0x541f30+':\x20'+_0x3d86f2),_0x3e9b63>0x0;}catch(_0x39affb){return console[_0x353a9f(0x23a)](_0x353a9f(0x1cd),_0x39affb),![];}}async['sendDirectMessage'](_0x2ff391,_0x2aefcf){const _0x167dee=a63_0x5853dc;try{if(!this[_0x167dee(0x1c0)])return console[_0x167dee(0x23a)](_0x167dee(0x1c4)),![];return await this[_0x167dee(0x1c0)][_0x167dee(0x1dd)](_0x2ff391,_0x2aefcf),console[_0x167dee(0x299)]('✅\x20Direct\x20message\x20sent\x20to\x20chat\x20'+_0x2ff391),!![];}catch(_0x3b7a72){return console[_0x167dee(0x23a)](_0x167dee(0x204),_0x3b7a72),![];}}async[a63_0x5853dc(0x1bd)](_0x4d62d4,_0x1f7114,_0x1998ac,_0x2f14b8){const _0x24de3c=a63_0x5853dc;try{if(!this[_0x24de3c(0x1c0)])return console[_0x24de3c(0x23a)](_0x24de3c(0x1c4)),![];return await this[_0x24de3c(0x1c0)][_0x24de3c(0x21d)](_0x4d62d4,_0x1f7114,{},{'filename':_0x1998ac,'contentType':_0x1998ac['endsWith']('.png')?_0x24de3c(0x1dc):_0x1998ac[_0x24de3c(0x284)]('.jpg')||_0x1998ac[_0x24de3c(0x284)](_0x24de3c(0x23e))?'image/jpeg':_0x1998ac['endsWith'](_0x24de3c(0x1da))?'application/pdf':'application/octet-stream'}),_0x2f14b8&&await this[_0x24de3c(0x1c0)][_0x24de3c(0x1dd)](_0x4d62d4,_0x2f14b8),console['log'](_0x24de3c(0x1bb)+_0x4d62d4+':\x20'+_0x1998ac),!![];}catch(_0x1d62c8){return console['error'](_0x24de3c(0x263),_0x1d62c8),![];}}[a63_0x5853dc(0x1ad)](){const _0x1445b4=a63_0x5853dc;this[_0x1445b4(0x1c0)]&&(this[_0x1445b4(0x1c0)][_0x1445b4(0x296)](),this[_0x1445b4(0x1c0)]=null,console[_0x1445b4(0x299)](_0x1445b4(0x19e)));}}exports[a63_0x5853dc(0x1ce)]=TelegramBotService,exports[a63_0x5853dc(0x1af)]=new TelegramBotService();