'use strict';function a52_0x13ef(_0x3572b5,_0x273a63){const _0x81f9de=a52_0x81f9();return a52_0x13ef=function(_0x13efe8,_0x4f5e19){_0x13efe8=_0x13efe8-0x1c1;let _0xc698=_0x81f9de[_0x13efe8];return _0xc698;},a52_0x13ef(_0x3572b5,_0x273a63);}const a52_0x40d490=a52_0x13ef;(function(_0x59b7b6,_0x4ca6ba){const _0x123a0c=a52_0x13ef,_0xb5823f=_0x59b7b6();while(!![]){try{const _0x43e148=-parseInt(_0x123a0c(0x204))/0x1+parseInt(_0x123a0c(0x262))/0x2+-parseInt(_0x123a0c(0x29b))/0x3*(-parseInt(_0x123a0c(0x1f6))/0x4)+parseInt(_0x123a0c(0x25b))/0x5+parseInt(_0x123a0c(0x1f3))/0x6*(parseInt(_0x123a0c(0x1e5))/0x7)+parseInt(_0x123a0c(0x261))/0x8*(parseInt(_0x123a0c(0x251))/0x9)+parseInt(_0x123a0c(0x1ee))/0xa*(-parseInt(_0x123a0c(0x224))/0xb);if(_0x43e148===_0x4ca6ba)break;else _0xb5823f['push'](_0xb5823f['shift']());}catch(_0x4e5b58){_0xb5823f['push'](_0xb5823f['shift']());}}}(a52_0x81f9,0x64697));var __importDefault=this&&this[a52_0x40d490(0x1ea)]||function(_0x259c38){return _0x259c38&&_0x259c38['__esModule']?_0x259c38:{'default':_0x259c38};};function a52_0x81f9(){const _0x4caef9=['adminNotes','notificationApiError','telegramUser','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','•\x20Payouts\x0a','Markdown','endpoint','findFirst','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','setupBotHandlers','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','botToken','userAgent','en-US','stopBot','\x20initialized\x20successfully','toLocaleDateString','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','...`\x0a\x0a','✅\x20Telegram\x20user\x20','\x20\x20\x20Status:\x20','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','node-telegram-bot-api','log','from','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','txid','•\x20Important\x20events\x0a\x0a','🔔\x20*','user\x20is\x20deactivated','189AJOICu','\x20\x20\x20Public\x20Key:\x20`','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','🔔\x20You\x20receive\x20notifications\x20about:\x0a','\x20parts:\x20','env','Payment\x20successfully\x20paid','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','includes','🏦\x20Method:\x20`','•\x20New\x20payments\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','`\x20(','toString','error','\x20disconnected\x20from\x20shop\x20','requestId','findUnique','defineProperty','findMany','🔗\x20Endpoint:\x20`','Payment\x20chargeback','update','✅\x20Welcome\x20back!\x0a\x0a','Telegram\x20bot\x20polling\x20error:','toLocaleString','sendLoginNotification','Error\x20handling\x20/start\x20command:','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','telegramId','map','botUsername','shop','📛\x20Name:\x20`','`\x20is\x20inactive.\x0a\x0a','📊\x20Error\x20code:\x20`','chat','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a',':\x20`','onText','✅\x20Connected\x20to\x20shop:\x20*','•\x20Payment\x20status\x20changes\x0a','forEach','619934CLXdMA','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','❌\x20Shop\x20with\x20username\x20`','sendPaymentNotification','Payment\x20expired','__importDefault','📱\x20Your\x20Telegram\x20ID:\x20`','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','❌\x20Please\x20use\x20/start\x20command\x20first','290NqYxzy','\x20via\x20single-line\x20input','Available\x20usernames:\x0a','message','TelegramBotService','12mxuPbP','method','processing','36452bVbFQf','shopSettings','•\x20`','🔌\x20User\x20','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','❌\x20Error\x20getting\x20debug\x20information.','status','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','Username:\x20`','amount','•\x20Payouts\x0a\x0a','create','unknown\x20shop','💸\x20Penalty\x20amount:\x20*','255009xBjWJU','📱\x20Shop:\x20*','Failed\x20to\x20send\x20login\x20notification:','chargeback','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','length','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','💰\x20Amount:\x20*','bot','success','Payment\x20is\x20being\x20processed','initializeBot','Use\x20/start\x20to\x20connect.','Check\x20spelling\x20and\x20try\x20again.','sk_','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','To\x20reconnect,\x20use\x20the\x20/start\x20command','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','test','Example:\x0a','❌\x20Shop\x20`','trapay_bot','📅\x20Connection\x20date:\x20','Failed\x20to\x20send\x20API\x20error\x20notification:','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','sendCustomNotification','📝\x20Notes:\x20','\x22,\x20apiKey=\x22',':\x20username=\x22','🚨\x20*API\x20Error*\x0a\x0a','isVerified','636218qnCEtw','first_name','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Error\x20sending\x20shop\x20notification:','📅\x20Date:\x20','...\x22','User\x20','❌\x20Invalid\x20username\x20format:\x20`','text','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','/disconnect\x20-\x20disconnect\x20from\x20notifications','telegramBotService','trim','customerEmail','chat\x20not\x20found','Use\x20/start\x20to\x20begin.','getGatewayDisplayNameForTelegram','New\x20payment\x20created','getBotInfo','TELEGRAM_BOT_USERNAME','🏪\x20Gateway:\x20`','last_name','Contact\x20administrator.','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','\x20USDT*\x0a','📊\x20*Connection\x20Status*\x0a\x0a','entries','publicKey','Failed\x20login\x20attempt','../types/gateway','sendShopNotification','split','...','Successful\x20login','join','*\x0a\x0a','🔗\x20TXID:\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a','\x20(@','shopId','customerName','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','.\x20*','name','3631347cJAqWA','\x20verified\x20for\x20shop\x20','username','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Payout\x20completed','\x22\x20->\x20display\x20\x22','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','\x20USD*\x0a','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','Payout\x20rejected','3315535GHrPxV','failed','👤\x20Username:\x20`','sendMessage','*.\x0a\x0a','/status\x20-\x20check\x20connection\x20status\x0a','16OEJXoe','244564tgCKnK','currency','🆔\x20Payment\x20ID:\x20`','Commands:\x0a','ACTIVE','timestamp','Error\x20handling\x20message:','Payment\x20refund','statusCode','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','blocked','handleSingleLineVerification','createdAt','substring','notificationLogin','`.\x0a\x0a','✅\x20Telegram\x20bot\x20@','💻\x20Browser:\x20`','📅\x20Time:\x20','pk_','🛑\x20Telegram\x20bot\x20stopped','default','`\x0a\x0a','startsWith','ipAddress','Error\x20handling\x20/debug\x20command:','secretKey'];a52_0x81f9=function(){return _0x4caef9;};return a52_0x81f9();}Object[a52_0x40d490(0x1cc)](exports,'__esModule',{'value':!![]}),exports['telegramBotService']=exports[a52_0x40d490(0x1f2)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a52_0x40d490(0x293))),database_1=__importDefault(require('../config/database')),gateway_1=require(a52_0x40d490(0x242));class TelegramBotService{constructor(){const _0x17d27e=a52_0x40d490;this['bot']=null,this[_0x17d27e(0x288)]=process[_0x17d27e(0x2a0)]['TELEGRAM_BOT_TOKEN']||'',this['botUsername']=process[_0x17d27e(0x2a0)][_0x17d27e(0x238)]||_0x17d27e(0x21a),this[_0x17d27e(0x288)]?this[_0x17d27e(0x20f)]():console['warn'](_0x17d27e(0x26b));}[a52_0x40d490(0x20f)](){const _0x404f34=a52_0x40d490;try{this['bot']=new node_telegram_bot_api_1[(_0x404f34(0x277))](this['botToken'],{'polling':!![]}),this[_0x404f34(0x286)](),console[_0x404f34(0x294)](_0x404f34(0x272)+this['botUsername']+_0x404f34(0x28c));}catch(_0x1ec0f1){console[_0x404f34(0x1c8)](_0x404f34(0x213),_0x1ec0f1);}}[a52_0x40d490(0x286)](){const _0x3a71f0=a52_0x40d490;if(!this[_0x3a71f0(0x20c)])return;this[_0x3a71f0(0x20c)][_0x3a71f0(0x1e1)](/\/start/,async _0x1eee13=>{const _0x424851=_0x3a71f0,_0xf1e05f=_0x1eee13[_0x424851(0x1de)]['id'],_0x2539b6=_0x1eee13['from']?.['id'][_0x424851(0x1c7)](),_0xbf14c2=_0x1eee13['from']?.[_0x424851(0x253)],_0x37c14b=_0x1eee13[_0x424851(0x295)]?.[_0x424851(0x225)],_0x49ebe9=_0x1eee13[_0x424851(0x295)]?.[_0x424851(0x23a)];if(!_0x2539b6)return;try{let _0x41c559=await database_1[_0x424851(0x277)][_0x424851(0x27f)]['findUnique']({'where':{'telegramId':_0x2539b6},'include':{'shop':!![]}});!_0x41c559?(_0x41c559=await database_1[_0x424851(0x277)]['telegramUser'][_0x424851(0x201)]({'data':{'telegramId':_0x2539b6,'username':_0xbf14c2,'firstName':_0x37c14b,'lastName':_0x49ebe9,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x424851(0x294)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x2539b6+_0x424851(0x24b)+_0xbf14c2+')')):_0x41c559=await database_1[_0x424851(0x277)][_0x424851(0x27f)][_0x424851(0x1d0)]({'where':{'telegramId':_0x2539b6},'data':{'username':_0xbf14c2,'firstName':_0x37c14b,'lastName':_0x49ebe9},'include':{'shop':!![]}}),_0x41c559[_0x424851(0x223)]&&_0x41c559[_0x424851(0x24c)]&&_0x41c559[_0x424851(0x1da)]?await this['bot']?.[_0x424851(0x25e)](_0xf1e05f,_0x424851(0x1d1)+(_0x424851(0x215)+_0x41c559[_0x424851(0x1da)]['name']+'*\x0a')+(_0x424851(0x1fe)+_0x41c559['shop']['username']+'`\x0a\x0a')+_0x424851(0x29e)+_0x424851(0x1c4)+_0x424851(0x1e3)+_0x424851(0x200)+_0x424851(0x265)+_0x424851(0x260)+_0x424851(0x22f),{'parse_mode':_0x424851(0x282)}):(_0x41c559[_0x424851(0x24c)]&&!_0x41c559[_0x424851(0x223)]&&(await database_1[_0x424851(0x277)][_0x424851(0x27f)][_0x424851(0x1d0)]({'where':{'telegramId':_0x2539b6},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x424851(0x1fd)+_0x2539b6)),await this['bot']?.[_0x424851(0x25e)](_0xf1e05f,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x424851(0x254)+_0x424851(0x218)+_0x424851(0x287)+_0x424851(0x296),{'parse_mode':_0x424851(0x282)}));}catch(_0x75185d){console[_0x424851(0x1c8)](_0x424851(0x1d5),_0x75185d),await this[_0x424851(0x20c)]?.[_0x424851(0x25e)](_0xf1e05f,_0x424851(0x285));}}),this[_0x3a71f0(0x20c)]['onText'](/\/disconnect/,async _0x3e4395=>{const _0x31f39d=_0x3a71f0,_0x4a43c8=_0x3e4395[_0x31f39d(0x1de)]['id'],_0x859942=_0x3e4395[_0x31f39d(0x295)]?.['id'][_0x31f39d(0x1c7)]();if(!_0x859942)return;try{const _0x29222d=await database_1['default']['telegramUser'][_0x31f39d(0x1cb)]({'where':{'telegramId':_0x859942},'include':{'shop':!![]}});if(!_0x29222d||!_0x29222d['isVerified']||!_0x29222d['shopId']){await this['bot']?.[_0x31f39d(0x25e)](_0x4a43c8,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0xcfdc1d=_0x29222d[_0x31f39d(0x1da)]?.[_0x31f39d(0x250)]||_0x31f39d(0x202);await database_1[_0x31f39d(0x277)][_0x31f39d(0x27f)][_0x31f39d(0x1d0)]({'where':{'telegramId':_0x859942},'data':{'shopId':null,'isVerified':![]}}),console[_0x31f39d(0x294)](_0x31f39d(0x1f9)+_0x859942+_0x31f39d(0x1c9)+_0x29222d[_0x31f39d(0x24c)]),await this[_0x31f39d(0x20c)]?.[_0x31f39d(0x25e)](_0x4a43c8,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0xcfdc1d+_0x31f39d(0x25f)+_0x31f39d(0x214),{'parse_mode':_0x31f39d(0x282)});}catch(_0x17259d){console[_0x31f39d(0x1c8)]('Error\x20handling\x20/disconnect\x20command:',_0x17259d),await this[_0x31f39d(0x20c)]?.[_0x31f39d(0x25e)](_0x4a43c8,_0x31f39d(0x285));}}),this[_0x3a71f0(0x20c)][_0x3a71f0(0x1e1)](/\/status/,async _0x1d245e=>{const _0x3017d9=_0x3a71f0,_0x1d3507=_0x1d245e[_0x3017d9(0x1de)]['id'],_0x2fa0d1=_0x1d245e[_0x3017d9(0x295)]?.['id'][_0x3017d9(0x1c7)]();if(!_0x2fa0d1)return;try{const _0x56b4ef=await database_1[_0x3017d9(0x277)][_0x3017d9(0x27f)][_0x3017d9(0x1cb)]({'where':{'telegramId':_0x2fa0d1},'include':{'shop':!![]}});if(!_0x56b4ef){await this[_0x3017d9(0x20c)]?.[_0x3017d9(0x25e)](_0x1d3507,_0x3017d9(0x257)+_0x3017d9(0x234));return;}if(!_0x56b4ef[_0x3017d9(0x223)]||!_0x56b4ef[_0x3017d9(0x24c)]||!_0x56b4ef['shop']){await this['bot']?.['sendMessage'](_0x1d3507,_0x3017d9(0x1df)+_0x3017d9(0x210));return;}await this[_0x3017d9(0x20c)]?.[_0x3017d9(0x25e)](_0x1d3507,_0x3017d9(0x23e)+(_0x3017d9(0x1e2)+_0x56b4ef[_0x3017d9(0x1da)][_0x3017d9(0x250)]+'*\x0a')+(_0x3017d9(0x25d)+_0x56b4ef['shop'][_0x3017d9(0x253)]+'`\x0a')+(_0x3017d9(0x21b)+_0x56b4ef['updatedAt'][_0x3017d9(0x28d)](_0x3017d9(0x28a))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+_0x3017d9(0x265)+_0x3017d9(0x22f),{'parse_mode':_0x3017d9(0x282)});}catch(_0x4e3020){console[_0x3017d9(0x1c8)]('Error\x20handling\x20/status\x20command:',_0x4e3020),await this[_0x3017d9(0x20c)]?.[_0x3017d9(0x25e)](_0x1d3507,_0x3017d9(0x285));}}),this[_0x3a71f0(0x20c)][_0x3a71f0(0x1e1)](/\/debug/,async _0x5c71f1=>{const _0x273450=_0x3a71f0,_0x5e8929=_0x5c71f1[_0x273450(0x1de)]['id'],_0x3c7b8b=_0x5c71f1[_0x273450(0x295)]?.['id'][_0x273450(0x1c7)]();if(!_0x3c7b8b)return;try{const _0x83e9f5=await database_1[_0x273450(0x277)]['shop'][_0x273450(0x1cd)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x5e94ca='🔍\x20*Debug\x20Information*\x0a\x0a';_0x5e94ca+=_0x273450(0x1eb)+_0x3c7b8b+'`\x0a\x0a',_0x5e94ca+=_0x273450(0x24a),_0x83e9f5[_0x273450(0x1e4)]((_0x5e1c44,_0x51b24a)=>{const _0x33bba7=_0x273450;_0x5e94ca+=_0x51b24a+0x1+_0x33bba7(0x24f)+_0x5e1c44[_0x33bba7(0x250)]+'*\x0a',_0x5e94ca+='\x20\x20\x20Username:\x20`'+_0x5e1c44[_0x33bba7(0x253)]+'`\x0a',_0x5e94ca+=_0x33bba7(0x291)+_0x5e1c44[_0x33bba7(0x1fc)]+'\x0a',_0x5e94ca+=_0x33bba7(0x29c)+_0x5e1c44['publicKey'][_0x33bba7(0x26f)](0x0,0xf)+_0x33bba7(0x28f);}),await this[_0x273450(0x20c)]?.['sendMessage'](_0x5e8929,_0x5e94ca,{'parse_mode':_0x273450(0x282)});}catch(_0x44581a){console[_0x273450(0x1c8)](_0x273450(0x27b),_0x44581a),await this[_0x273450(0x20c)]?.[_0x273450(0x25e)](_0x5e8929,_0x273450(0x1fb));}}),this[_0x3a71f0(0x20c)]['on']('message',async _0x1c6b63=>{const _0x4acd84=_0x3a71f0;if(_0x1c6b63[_0x4acd84(0x22d)]?.[_0x4acd84(0x279)]('/'))return;const _0xe89260=_0x1c6b63['chat']['id'],_0x3b182b=_0x1c6b63[_0x4acd84(0x295)]?.['id'][_0x4acd84(0x1c7)](),_0x4ffd75=_0x1c6b63[_0x4acd84(0x22d)]?.[_0x4acd84(0x231)]();if(!_0x3b182b||!_0x4ffd75)return;try{const _0x27188b=await database_1['default'][_0x4acd84(0x27f)]['findUnique']({'where':{'telegramId':_0x3b182b},'include':{'shop':!![]}});if(!_0x27188b){await this[_0x4acd84(0x20c)]?.[_0x4acd84(0x25e)](_0xe89260,_0x4acd84(0x1ed));return;}if(_0x27188b[_0x4acd84(0x223)]&&_0x27188b['shopId']&&_0x27188b[_0x4acd84(0x1da)]){await this[_0x4acd84(0x20c)]?.[_0x4acd84(0x25e)](_0xe89260,_0x4acd84(0x208)+_0x27188b['shop'][_0x4acd84(0x250)]+'*.\x0a\x0a'+_0x4acd84(0x24e),{'parse_mode':_0x4acd84(0x282)});return;}const _0x4c6256=_0x4ffd75[_0x4acd84(0x244)](/\s+/);if(_0x4c6256['length']!==0x2){await this[_0x4acd84(0x20c)]?.[_0x4acd84(0x25e)](_0xe89260,_0x4acd84(0x1e6)+_0x4acd84(0x254)+_0x4acd84(0x218)+_0x4acd84(0x287)+('You\x20sent\x20'+_0x4c6256[_0x4acd84(0x209)]+_0x4acd84(0x29f)+_0x4c6256[_0x4acd84(0x1d8)](_0x51573a=>'`'+_0x51573a+'`')[_0x4acd84(0x247)](',\x20')),{'parse_mode':_0x4acd84(0x282)});return;}const [_0x15d7e6,_0x5a84ea]=_0x4c6256;console['log'](_0x4acd84(0x227)+_0x3b182b+_0x4acd84(0x221)+_0x15d7e6+_0x4acd84(0x220)+_0x5a84ea[_0x4acd84(0x26f)](0x0,0xa)+_0x4acd84(0x22a)),await this[_0x4acd84(0x26d)](_0xe89260,_0x3b182b,_0x15d7e6,_0x5a84ea);}catch(_0x54df0b){console[_0x4acd84(0x1c8)](_0x4acd84(0x268),_0x54df0b),await this[_0x4acd84(0x20c)]?.['sendMessage'](_0xe89260,_0x4acd84(0x285));}}),this[_0x3a71f0(0x20c)]['on'](_0x3a71f0(0x1c8),_0x1a0448=>{const _0x134a15=_0x3a71f0;console[_0x134a15(0x1c8)]('Telegram\x20bot\x20error:',_0x1a0448);}),this[_0x3a71f0(0x20c)]['on']('polling_error',_0x20dd0f=>{const _0x455c8c=_0x3a71f0;console[_0x455c8c(0x1c8)](_0x455c8c(0x1d2),_0x20dd0f);});}async[a52_0x40d490(0x26d)](_0x3b5425,_0x505e21,_0x50ee32,_0x4ac715){const _0xeada21=a52_0x40d490;try{console[_0xeada21(0x294)](_0xeada21(0x227)+_0x505e21+_0xeada21(0x221)+_0x50ee32+_0xeada21(0x220)+_0x4ac715[_0xeada21(0x26f)](0x0,0xa)+'...\x22');if(!_0x50ee32||_0x50ee32[_0xeada21(0x209)]<0x3||_0x50ee32['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0xeada21(0x217)](_0x50ee32)){await this[_0xeada21(0x20c)]?.['sendMessage'](_0x3b5425,_0xeada21(0x22c)+_0x50ee32+_0xeada21(0x278)+_0xeada21(0x216),{'parse_mode':_0xeada21(0x282)});return;}if(!_0x4ac715||!_0x4ac715[_0xeada21(0x279)](_0xeada21(0x275))&&!_0x4ac715[_0xeada21(0x279)](_0xeada21(0x212))){await this[_0xeada21(0x20c)]?.['sendMessage'](_0x3b5425,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0xeada21(0x29d),{'parse_mode':_0xeada21(0x282)});return;}const _0x8f512b=await database_1[_0xeada21(0x277)][_0xeada21(0x1da)][_0xeada21(0x1cb)]({'where':{'username':_0x50ee32},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x8f512b){const _0x14761b=await database_1['default'][_0xeada21(0x1da)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x4dc472=_0xeada21(0x1e7)+_0x50ee32+'`\x20not\x20found.\x0a\x0a';_0x14761b[_0xeada21(0x209)]>0x0?(_0x4dc472+=_0xeada21(0x1f0),_0x14761b[_0xeada21(0x1e4)](_0x1117a4=>{const _0x2a3362=_0xeada21;_0x4dc472+=_0x2a3362(0x1f8)+_0x1117a4[_0x2a3362(0x253)]+_0x2a3362(0x1c6)+_0x1117a4['name']+')\x0a';}),_0x4dc472+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x4dc472+=_0xeada21(0x211);await this[_0xeada21(0x20c)]?.[_0xeada21(0x25e)](_0x3b5425,_0x4dc472,{'parse_mode':_0xeada21(0x282)});return;}if(_0x8f512b[_0xeada21(0x1fc)]!==_0xeada21(0x266)){await this[_0xeada21(0x20c)]?.[_0xeada21(0x25e)](_0x3b5425,_0xeada21(0x219)+_0x50ee32+_0xeada21(0x1dc)+_0xeada21(0x23b),{'parse_mode':_0xeada21(0x282)});return;}if(_0x8f512b[_0xeada21(0x240)]!==_0x4ac715&&_0x8f512b[_0xeada21(0x27c)]!==_0x4ac715){await this[_0xeada21(0x20c)]?.['sendMessage'](_0x3b5425,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x50ee32+_0xeada21(0x271)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':'Markdown'});return;}const _0x2d083d=await database_1['default'][_0xeada21(0x27f)][_0xeada21(0x284)]({'where':{'shopId':_0x8f512b['id'],'isVerified':!![],'telegramId':{'not':_0x505e21}}});if(_0x2d083d){await this['bot']?.[_0xeada21(0x25e)](_0x3b5425,_0xeada21(0x259)+_0x50ee32+_0xeada21(0x271)+_0xeada21(0x1fa),{'parse_mode':'Markdown'});return;}await database_1[_0xeada21(0x277)][_0xeada21(0x27f)][_0xeada21(0x1d0)]({'where':{'telegramId':_0x505e21},'data':{'shopId':_0x8f512b['id'],'isVerified':!![]}}),await this[_0xeada21(0x20c)]?.[_0xeada21(0x25e)](_0x3b5425,'🎉\x20*Congratulations!*\x0a\x0a'+_0xeada21(0x226)+(_0xeada21(0x205)+_0x8f512b[_0xeada21(0x250)]+'*\x0a')+(_0xeada21(0x25d)+_0x8f512b['username']+_0xeada21(0x278))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0xeada21(0x1c4)+'•\x20Payment\x20status\x20changes\x0a'+_0xeada21(0x281)+_0xeada21(0x298)+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0xeada21(0x22f),{'parse_mode':_0xeada21(0x282)}),console[_0xeada21(0x294)](_0xeada21(0x290)+_0x505e21+_0xeada21(0x252)+_0x8f512b['username']+_0xeada21(0x1ef));}catch(_0x4d4f94){console[_0xeada21(0x1c8)]('Error\x20in\x20handleSingleLineVerification:',_0x4d4f94),await this[_0xeada21(0x20c)]?.['sendMessage'](_0x3b5425,_0xeada21(0x23c));}}async['sendShopNotification'](_0x4af652,_0x4685df,_0x566369){const _0x57a247=a52_0x40d490;if(!this[_0x57a247(0x20c)]){console['warn'](_0x57a247(0x292));return;}try{const _0x559fad=await database_1[_0x57a247(0x277)][_0x57a247(0x27f)]['findMany']({'where':{'shopId':_0x4af652,'isVerified':!![]}});if(_0x559fad[_0x57a247(0x209)]===0x0){console[_0x57a247(0x294)](_0x57a247(0x1ec)+_0x4af652);return;}const _0x1ed977=_0x559fad['map'](async _0x5ad249=>{const _0x4d886c=_0x57a247;try{await this[_0x4d886c(0x20c)]?.[_0x4d886c(0x25e)](_0x5ad249[_0x4d886c(0x1d7)],_0x4685df,_0x566369),console[_0x4d886c(0x294)](_0x4d886c(0x21d)+_0x5ad249[_0x4d886c(0x1d7)]);}catch(_0x35c180){console['error'](_0x4d886c(0x20a)+_0x5ad249[_0x4d886c(0x1d7)]+':',_0x35c180),_0x35c180 instanceof Error&&(_0x35c180['message'][_0x4d886c(0x1c2)](_0x4d886c(0x26c))||_0x35c180[_0x4d886c(0x1f1)][_0x4d886c(0x1c2)](_0x4d886c(0x233))||_0x35c180[_0x4d886c(0x1f1)][_0x4d886c(0x1c2)](_0x4d886c(0x29a)))&&(await database_1[_0x4d886c(0x277)][_0x4d886c(0x27f)][_0x4d886c(0x1d0)]({'where':{'id':_0x5ad249['id']},'data':{'isVerified':![]}}),console[_0x4d886c(0x294)](_0x4d886c(0x22b)+_0x5ad249['telegramId']+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise['allSettled'](_0x1ed977);}catch(_0x5c5eac){console['error'](_0x57a247(0x228),_0x5c5eac);}}async[a52_0x40d490(0x1e8)](_0x17bba3,_0x4932a1,_0x17594f){const _0x6b0f4d=a52_0x40d490,_0x34e923={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x49d276={'created':_0x6b0f4d(0x236),'paid':_0x6b0f4d(0x2a1),'failed':'Payment\x20failed','expired':_0x6b0f4d(0x1e9),'refund':_0x6b0f4d(0x269),'chargeback':_0x6b0f4d(0x1cf),'processing':_0x6b0f4d(0x20e)},_0x21c1bb=_0x34e923[_0x17594f],_0x43140d=_0x49d276[_0x17594f],_0x2f2320=(0x0,gateway_1[_0x6b0f4d(0x235)])(_0x4932a1['gateway']);console[_0x6b0f4d(0x294)](_0x6b0f4d(0x1c5)+_0x4932a1['gateway']+_0x6b0f4d(0x256)+_0x2f2320+'\x22');let _0x23f3b1=_0x21c1bb+'\x20*'+_0x43140d+_0x6b0f4d(0x248)+(_0x6b0f4d(0x20b)+_0x4932a1[_0x6b0f4d(0x1ff)]+'\x20'+_0x4932a1[_0x6b0f4d(0x263)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x4932a1['orderId']||_0x4932a1['id'])+'`\x0a')+(_0x6b0f4d(0x264)+_0x4932a1['id']+'`\x0a')+(_0x6b0f4d(0x239)+_0x2f2320+'`\x0a')+(_0x6b0f4d(0x229)+new Date(_0x4932a1[_0x6b0f4d(0x26e)])[_0x6b0f4d(0x1d3)](_0x6b0f4d(0x28a))+'\x0a');(_0x4932a1[_0x6b0f4d(0x24d)]||_0x4932a1[_0x6b0f4d(0x232)])&&(_0x23f3b1+='\x0a👤\x20*Customer\x20Information:*\x0a',_0x4932a1['customerName']&&(_0x23f3b1+=_0x6b0f4d(0x1db)+_0x4932a1[_0x6b0f4d(0x24d)]+'`\x0a'),_0x4932a1[_0x6b0f4d(0x232)]&&(_0x23f3b1+='📧\x20Email:\x20`'+_0x4932a1['customerEmail']+'`\x0a')),_0x17594f===_0x6b0f4d(0x207)&&_0x4932a1['chargebackAmount']&&(_0x23f3b1+=_0x6b0f4d(0x203)+_0x4932a1['chargebackAmount']+_0x6b0f4d(0x23d)),_0x17594f===_0x6b0f4d(0x1f5)&&(_0x23f3b1+=_0x6b0f4d(0x28e)),_0x4932a1[_0x6b0f4d(0x27d)]&&(_0x23f3b1+=_0x6b0f4d(0x21f)+_0x4932a1[_0x6b0f4d(0x27d)]+'\x0a'),await this[_0x6b0f4d(0x243)](_0x17bba3,_0x23f3b1,{'parse_mode':'Markdown'});}async['sendPayoutNotification'](_0x150aa0,_0x5d9f03,_0x1017c8){const _0x178073=a52_0x40d490,_0x3af54e={'created':'📤','completed':'✅','rejected':'❌'},_0x3e90bb={'created':'New\x20payout\x20created','completed':_0x178073(0x255),'rejected':_0x178073(0x25a)},_0x5eb480=_0x3af54e[_0x1017c8],_0x37ce83=_0x3e90bb[_0x1017c8],_0xc9309=_0x5eb480+'\x20*'+_0x37ce83+'*\x0a\x0a'+('💸\x20Amount:\x20*'+_0x5d9f03[_0x178073(0x1ff)]+_0x178073(0x258))+(_0x178073(0x1c3)+_0x5d9f03[_0x178073(0x1f4)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x5d9f03['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x5d9f03[_0x178073(0x26e)])['toLocaleString']('en-US')+'\x0a')+(_0x5d9f03[_0x178073(0x297)]?_0x178073(0x249)+_0x5d9f03[_0x178073(0x297)]+'`':'');await this[_0x178073(0x243)](_0x150aa0,_0xc9309,{'parse_mode':_0x178073(0x282)});}async[a52_0x40d490(0x1d4)](_0x297c23,_0x2ac07e){const _0x12903d=a52_0x40d490;try{const _0x385874=await database_1['default']['shopSettings'][_0x12903d(0x1cb)]({'where':{'shopId':_0x297c23},'select':{'notificationLogin':!![]}});if(!_0x385874?.[_0x12903d(0x270)]){console[_0x12903d(0x294)](_0x12903d(0x1d6)+_0x297c23);return;}const _0x2c53b6=_0x2ac07e[_0x12903d(0x20d)]?'🔐':'🚨',_0x1f9540=_0x2ac07e[_0x12903d(0x20d)]?_0x12903d(0x246):_0x12903d(0x241);let _0x3fcb10=_0x2c53b6+'\x20*'+_0x1f9540+_0x12903d(0x248)+(_0x12903d(0x25d)+_0x2ac07e[_0x12903d(0x253)]+'`\x0a')+(_0x12903d(0x274)+_0x2ac07e['timestamp'][_0x12903d(0x1d3)](_0x12903d(0x28a))+'\x0a');_0x2ac07e['ipAddress']&&(_0x3fcb10+='🌐\x20IP\x20address:\x20`'+_0x2ac07e[_0x12903d(0x27a)]+'`\x0a');if(_0x2ac07e[_0x12903d(0x289)]){const _0x4a759d=_0x2ac07e[_0x12903d(0x289)][_0x12903d(0x209)]>0x32?_0x2ac07e[_0x12903d(0x289)]['substring'](0x0,0x32)+_0x12903d(0x245):_0x2ac07e[_0x12903d(0x289)];_0x3fcb10+=_0x12903d(0x273)+_0x4a759d+'`\x0a';}!_0x2ac07e[_0x12903d(0x20d)]&&(_0x3fcb10+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x12903d(0x243)](_0x297c23,_0x3fcb10,{'parse_mode':_0x12903d(0x282)}),console[_0x12903d(0x294)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x297c23+':\x20'+(_0x2ac07e[_0x12903d(0x20d)]?_0x12903d(0x20d):_0x12903d(0x25c)));}catch(_0x1be955){console[_0x12903d(0x1c8)](_0x12903d(0x206),_0x1be955);}}async['sendApiErrorNotification'](_0x5261a5,_0x10a845){const _0x2b8926=a52_0x40d490;try{const _0x360b86=await database_1[_0x2b8926(0x277)][_0x2b8926(0x1f7)][_0x2b8926(0x1cb)]({'where':{'shopId':_0x5261a5},'select':{'notificationApiError':!![]}});if(!_0x360b86?.[_0x2b8926(0x27e)]){console[_0x2b8926(0x294)](_0x2b8926(0x280)+_0x5261a5);return;}let _0x57b9a5=_0x2b8926(0x222)+(_0x2b8926(0x1ce)+_0x10a845[_0x2b8926(0x1f4)]+'\x20'+_0x10a845[_0x2b8926(0x283)]+'`\x0a')+(_0x2b8926(0x274)+_0x10a845[_0x2b8926(0x267)]['toLocaleString'](_0x2b8926(0x28a))+'\x0a');_0x10a845[_0x2b8926(0x26a)]&&(_0x57b9a5+=_0x2b8926(0x1dd)+_0x10a845[_0x2b8926(0x26a)]+'`\x0a'),_0x57b9a5+='❌\x20Error:\x20`'+_0x10a845['errorMessage']+'`\x0a',_0x10a845[_0x2b8926(0x1ca)]&&(_0x57b9a5+='🆔\x20Request\x20ID:\x20`'+_0x10a845[_0x2b8926(0x1ca)]+'`\x0a'),_0x57b9a5+=_0x2b8926(0x1c1),await this[_0x2b8926(0x243)](_0x5261a5,_0x57b9a5,{'parse_mode':_0x2b8926(0x282)}),console[_0x2b8926(0x294)](_0x2b8926(0x22e)+_0x5261a5+':\x20'+_0x10a845[_0x2b8926(0x283)]);}catch(_0x4cb108){console[_0x2b8926(0x1c8)](_0x2b8926(0x21c),_0x4cb108);}}async[a52_0x40d490(0x21e)](_0x216896,_0x2acdb1,_0x16efd9){const _0x8bb28c=a52_0x40d490;let _0x39ea60=_0x8bb28c(0x299)+_0x2acdb1+_0x8bb28c(0x248);for(const [_0x379247,_0x1ca7a2]of Object[_0x8bb28c(0x23f)](_0x16efd9)){_0x1ca7a2!==null&&_0x1ca7a2!==undefined&&(_0x39ea60+=_0x379247+_0x8bb28c(0x1e0)+_0x1ca7a2+'`\x0a');}await this[_0x8bb28c(0x243)](_0x216896,_0x39ea60,{'parse_mode':_0x8bb28c(0x282)});}[a52_0x40d490(0x237)](){const _0x94663=a52_0x40d490;return{'isActive':!!this[_0x94663(0x20c)],'username':this[_0x94663(0x1d9)]};}[a52_0x40d490(0x28b)](){const _0x2cb902=a52_0x40d490;this[_0x2cb902(0x20c)]&&(this[_0x2cb902(0x20c)]['stopPolling'](),this[_0x2cb902(0x20c)]=null,console['log'](_0x2cb902(0x276)));}}exports[a52_0x40d490(0x1f2)]=TelegramBotService,exports[a52_0x40d490(0x230)]=new TelegramBotService();