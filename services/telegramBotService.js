'use strict';const a55_0x1826aa=a55_0x1d35;(function(_0x1bcb3d,_0x25253e){const _0x420852=a55_0x1d35,_0x2e198f=_0x1bcb3d();while(!![]){try{const _0x2a4850=parseInt(_0x420852(0x174))/0x1+-parseInt(_0x420852(0xde))/0x2*(-parseInt(_0x420852(0xc0))/0x3)+-parseInt(_0x420852(0x105))/0x4*(-parseInt(_0x420852(0x11a))/0x5)+parseInt(_0x420852(0xf8))/0x6*(-parseInt(_0x420852(0x119))/0x7)+parseInt(_0x420852(0x146))/0x8*(parseInt(_0x420852(0x190))/0x9)+parseInt(_0x420852(0xfc))/0xa+-parseInt(_0x420852(0x133))/0xb;if(_0x2a4850===_0x25253e)break;else _0x2e198f['push'](_0x2e198f['shift']());}catch(_0x393d08){_0x2e198f['push'](_0x2e198f['shift']());}}}(a55_0x4f3d,0x56874));function a55_0x1d35(_0x4d5c7a,_0x21f725){const _0x4f3d21=a55_0x4f3d();return a55_0x1d35=function(_0x1d353c,_0x5c53b1){_0x1d353c=_0x1d353c-0xbf;let _0x5e3171=_0x4f3d21[_0x1d353c];return _0x5e3171;},a55_0x1d35(_0x4d5c7a,_0x21f725);}var __importDefault=this&&this['__importDefault']||function(_0x311ace){const _0x46e620=a55_0x1d35;return _0x311ace&&_0x311ace[_0x46e620(0x111)]?_0x311ace:{'default':_0x311ace};};Object[a55_0x1826aa(0x15a)](exports,a55_0x1826aa(0x111),{'value':!![]}),exports[a55_0x1826aa(0x114)]=exports[a55_0x1826aa(0xca)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a55_0x1826aa(0x137))),database_1=__importDefault(require('../config/database')),gateway_1=require(a55_0x1826aa(0xcf));function a55_0x4f3d(){const _0xa22755=['chat\x20not\x20found','env','publicKey','error','\x20via\x20single-line\x20input','•\x20Important\x20events\x0a\x0a','/status\x20-\x20check\x20connection\x20status\x0a','trapay_bot','bot','chargebackAmount','📅\x20Time:\x20','\x20\x20\x20Public\x20Key:\x20`','12TIOIqB','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','To\x20reconnect,\x20use\x20the\x20/start\x20command','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','4974670zKQOLv','Commands:\x0a','username','🏪\x20Available\x20shops\x20in\x20system:\x0a','📊\x20Error\x20code:\x20`','Use\x20/start\x20to\x20begin.','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*',':\x20`','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','121228cTswzD','isVerified','`.\x0a\x0a','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','map','🆔\x20Payout\x20ID:\x20`','✅\x20Telegram\x20bot\x20@','*.\x0a\x0a','Telegram\x20bot\x20error:','allSettled','🔗\x20Endpoint:\x20`','*\x0a\x0a','__esModule','📱\x20Telegram\x20notification:\x20gateway\x20\x22','\x22,\x20apiKey=\x22','telegramBotService','sendPaymentNotification','onText','Payment\x20failed','ACTIVE','165095BMyeos','85LWpDtw','Username:\x20`','🌐\x20IP\x20address:\x20`','`\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','`\x20(','Error\x20handling\x20/start\x20command:','text','\x0a👤\x20*Customer\x20Information:*\x0a','Use\x20/start\x20to\x20connect.','🆔\x20Request\x20ID:\x20`','\x22\x20->\x20display\x20\x22','secretKey','gateway','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','findFirst','findUnique','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','requestId','failed','botToken','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','💸\x20Penalty\x20amount:\x20*','warn','success','15755025nlzYJc','getBotInfo','unknown\x20shop','🎉\x20*Congratulations!*\x0a\x0a','node-telegram-bot-api','✅\x20Telegram\x20user\x20','Example:\x0a','🏪\x20Gateway:\x20`','initializeBot','Error\x20handling\x20/status\x20command:','📝\x20Order\x20ID:\x20`','substring','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','Payment\x20chargeback','•\x20Payouts\x0a\x0a','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','toLocaleDateString','errorMessage','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','104eOQRNl','\x20parts:\x20','/disconnect\x20-\x20disconnect\x20from\x20notifications','sendLoginNotification','...\x22','createdAt','chat','chargeback','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','toString','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','📅\x20Date:\x20','New\x20payment\x20created','log','`\x20not\x20found.\x0a\x0a','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','📛\x20Name:\x20`','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','`\x20is\x20inactive.\x0a\x0a','defineProperty','notificationLogin','includes','name','\x20disconnected\x20from\x20shop\x20','❌\x20Error\x20getting\x20debug\x20information.','length','❌\x20Invalid\x20username\x20format:\x20`','sendMessage','.\x20*','🔔\x20Notifications\x20are\x20active\x0a\x0a','amount','🔔\x20You\x20receive\x20notifications\x20about:\x0a','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','last_name','ipAddress','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','shop','endpoint','from','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','Failed\x20to\x20send\x20login\x20notification:','Error\x20sending\x20shop\x20notification:','updatedAt','startsWith','test','175795PFsjZm','customerUa','Payment\x20expired','•\x20`','sendCustomNotification','txid','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','💻\x20Browser:\x20`','...','🏦\x20Method:\x20`','📱\x20Your\x20Telegram\x20ID:\x20`','shopSettings','Markdown','\x20USDT*\x0a','botUsername','Payment\x20is\x20being\x20processed','🔗\x20TXID:\x20`','toLocaleString','❌\x20Shop\x20with\x20username\x20`','customerIp','findMany','👤\x20Username:\x20`','userAgent','\x20initialized\x20successfully','statusCode','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','telegramId','default','173835YZEhPs','Payout\x20rejected','\x20USD*\x0a','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','Payment\x20refund','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','Failed\x20to\x20send\x20API\x20error\x20notification:','💸\x20Amount:\x20*','\x0aCheck\x20spelling\x20and\x20try\x20again.','📧\x20Email:\x20`','📊\x20*Connection\x20Status*\x0a\x0a','status','•\x20Payment\x20status\x20changes\x0a','first_name','🔔\x20*','\x20\x20\x20Username:\x20`','🔍\x20*Debug\x20Information*\x0a\x0a','shopId','customerEmail','user\x20is\x20deactivated','method','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','📅\x20Connection\x20date:\x20','Successful\x20login','remitterIban','3PODTVC','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`',':\x20username=\x22','update','processing','Error\x20handling\x20/disconnect\x20command:','setupBotHandlers','Contact\x20administrator.','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','currency','TelegramBotService','✅\x20Connected\x20to\x20shop:\x20*','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','adminNotes','💰\x20Amount:\x20*','../types/gateway','\x20\x20\x20Status:\x20','sendShopNotification','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','Payout\x20completed','orderId','handleSingleLineVerification','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','en-US','🏦\x20IBAN:\x20`','sendPayoutNotification','timestamp','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','getGatewayDisplayNameForTelegram','join','788578phoUMx','User\x20','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','📱\x20Created\x20new\x20Telegram\x20user:\x20','Payment\x20successfully\x20paid','Failed\x20login\x20attempt','TELEGRAM_BOT_USERNAME','Check\x20spelling\x20and\x20try\x20again.','message','New\x20payout\x20created','customerName','trim','telegramUser','pk_'];a55_0x4f3d=function(){return _0xa22755;};return a55_0x4f3d();}class TelegramBotService{constructor(){const _0x44fea1=a55_0x1826aa;this[_0x44fea1(0xf4)]=null,this[_0x44fea1(0x12e)]=process[_0x44fea1(0xed)]['TELEGRAM_BOT_TOKEN']||'',this[_0x44fea1(0x182)]=process['env'][_0x44fea1(0xe4)]||_0x44fea1(0xf3),this['botToken']?this['initializeBot']():console['warn'](_0x44fea1(0x167));}[a55_0x1826aa(0x13b)](){const _0x28dad4=a55_0x1826aa;try{this[_0x28dad4(0xf4)]=new node_telegram_bot_api_1[(_0x28dad4(0x18f))](this[_0x28dad4(0x12e)],{'polling':!![]}),this[_0x28dad4(0xc6)](),console[_0x28dad4(0x154)](_0x28dad4(0x10b)+this[_0x28dad4(0x182)]+_0x28dad4(0x18b));}catch(_0x571697){console[_0x28dad4(0xef)](_0x28dad4(0x104),_0x571697);}}[a55_0x1826aa(0xc6)](){const _0x292ae4=a55_0x1826aa;if(!this['bot'])return;this['bot'][_0x292ae4(0x116)](/\/start/,async _0x6073e7=>{const _0x20c78e=_0x292ae4,_0x4098b4=_0x6073e7[_0x20c78e(0x14c)]['id'],_0x34f664=_0x6073e7['from']?.['id'][_0x20c78e(0x150)](),_0x3e469a=_0x6073e7[_0x20c78e(0x16d)]?.[_0x20c78e(0xfe)],_0x1d20fd=_0x6073e7[_0x20c78e(0x16d)]?.[_0x20c78e(0x19f)],_0x2668be=_0x6073e7[_0x20c78e(0x16d)]?.[_0x20c78e(0x168)];if(!_0x34f664)return;try{let _0x2f142e=await database_1[_0x20c78e(0x18f)][_0x20c78e(0xea)][_0x20c78e(0x12a)]({'where':{'telegramId':_0x34f664},'include':{'shop':!![]}});!_0x2f142e?(_0x2f142e=await database_1[_0x20c78e(0x18f)][_0x20c78e(0xea)]['create']({'data':{'telegramId':_0x34f664,'username':_0x3e469a,'firstName':_0x1d20fd,'lastName':_0x2668be,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x20c78e(0x154)](_0x20c78e(0xe1)+_0x34f664+'\x20(@'+_0x3e469a+')')):_0x2f142e=await database_1[_0x20c78e(0x18f)][_0x20c78e(0xea)][_0x20c78e(0xc3)]({'where':{'telegramId':_0x34f664},'data':{'username':_0x3e469a,'firstName':_0x1d20fd,'lastName':_0x2668be},'include':{'shop':!![]}}),_0x2f142e[_0x20c78e(0x106)]&&_0x2f142e[_0x20c78e(0x1a3)]&&_0x2f142e['shop']?await this[_0x20c78e(0xf4)]?.['sendMessage'](_0x4098b4,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x20c78e(0x18d)+_0x2f142e['shop'][_0x20c78e(0x15d)]+'*\x0a')+(_0x20c78e(0x11b)+_0x2f142e[_0x20c78e(0x16b)][_0x20c78e(0xfe)]+_0x20c78e(0x11d))+_0x20c78e(0x166)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+_0x20c78e(0x141)+_0x20c78e(0xfd)+_0x20c78e(0xf2)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}):(_0x2f142e[_0x20c78e(0x1a3)]&&!_0x2f142e[_0x20c78e(0x106)]&&(await database_1[_0x20c78e(0x18f)][_0x20c78e(0xea)]['update']({'where':{'telegramId':_0x34f664},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x20c78e(0xd6)+_0x34f664)),await this['bot']?.[_0x20c78e(0x162)](_0x4098b4,_0x20c78e(0x12b)+_0x20c78e(0x158)+_0x20c78e(0x128)+'Example:\x0a'+_0x20c78e(0xdb)+_0x20c78e(0x156),{'parse_mode':_0x20c78e(0x180)}));}catch(_0x5de5d5){console[_0x20c78e(0xef)](_0x20c78e(0x120),_0x5de5d5),await this[_0x20c78e(0xf4)]?.[_0x20c78e(0x162)](_0x4098b4,_0x20c78e(0x17a));}}),this[_0x292ae4(0xf4)]['onText'](/\/disconnect/,async _0x3fe9dc=>{const _0x3539d3=_0x292ae4,_0x2e91a4=_0x3fe9dc[_0x3539d3(0x14c)]['id'],_0x379831=_0x3fe9dc[_0x3539d3(0x16d)]?.['id']['toString']();if(!_0x379831)return;try{const _0x44c21f=await database_1[_0x3539d3(0x18f)][_0x3539d3(0xea)][_0x3539d3(0x12a)]({'where':{'telegramId':_0x379831},'include':{'shop':!![]}});if(!_0x44c21f||!_0x44c21f[_0x3539d3(0x106)]||!_0x44c21f[_0x3539d3(0x1a3)]){await this[_0x3539d3(0xf4)]?.[_0x3539d3(0x162)](_0x2e91a4,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x7bbe86=_0x44c21f[_0x3539d3(0x16b)]?.[_0x3539d3(0x15d)]||_0x3539d3(0x135);await database_1[_0x3539d3(0x18f)][_0x3539d3(0xea)][_0x3539d3(0xc3)]({'where':{'telegramId':_0x379831},'data':{'shopId':null,'isVerified':![]}}),console[_0x3539d3(0x154)]('🔌\x20User\x20'+_0x379831+_0x3539d3(0x15e)+_0x44c21f['shopId']),await this[_0x3539d3(0xf4)]?.[_0x3539d3(0x162)](_0x2e91a4,_0x3539d3(0x102)+_0x7bbe86+_0x3539d3(0x10c)+_0x3539d3(0xfa),{'parse_mode':_0x3539d3(0x180)});}catch(_0x3dc69a){console[_0x3539d3(0xef)](_0x3539d3(0xc5),_0x3dc69a),await this[_0x3539d3(0xf4)]?.[_0x3539d3(0x162)](_0x2e91a4,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x292ae4(0xf4)]['onText'](/\/status/,async _0x1f34b7=>{const _0x2270d0=_0x292ae4,_0x4cf3ec=_0x1f34b7[_0x2270d0(0x14c)]['id'],_0x48332b=_0x1f34b7[_0x2270d0(0x16d)]?.['id']['toString']();if(!_0x48332b)return;try{const _0x17ebaf=await database_1[_0x2270d0(0x18f)][_0x2270d0(0xea)][_0x2270d0(0x12a)]({'where':{'telegramId':_0x48332b},'include':{'shop':!![]}});if(!_0x17ebaf){await this['bot']?.[_0x2270d0(0x162)](_0x4cf3ec,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x2270d0(0x101));return;}if(!_0x17ebaf[_0x2270d0(0x106)]||!_0x17ebaf[_0x2270d0(0x1a3)]||!_0x17ebaf[_0x2270d0(0x16b)]){await this[_0x2270d0(0xf4)]?.[_0x2270d0(0x162)](_0x4cf3ec,_0x2270d0(0x11e)+_0x2270d0(0x123));return;}await this[_0x2270d0(0xf4)]?.[_0x2270d0(0x162)](_0x4cf3ec,_0x2270d0(0x19c)+(_0x2270d0(0xcb)+_0x17ebaf['shop'][_0x2270d0(0x15d)]+'*\x0a')+(_0x2270d0(0x189)+_0x17ebaf['shop']['username']+'`\x0a')+(_0x2270d0(0x1a8)+_0x17ebaf[_0x2270d0(0x171)][_0x2270d0(0x143)]('en-US')+'\x0a\x0a')+_0x2270d0(0x164)+'Commands:\x0a'+_0x2270d0(0x148),{'parse_mode':_0x2270d0(0x180)});}catch(_0x419f04){console[_0x2270d0(0xef)](_0x2270d0(0x13c),_0x419f04),await this[_0x2270d0(0xf4)]?.[_0x2270d0(0x162)](_0x4cf3ec,_0x2270d0(0x17a));}}),this[_0x292ae4(0xf4)][_0x292ae4(0x116)](/\/debug/,async _0x4f3c23=>{const _0x1af683=_0x292ae4,_0x2b458f=_0x4f3c23[_0x1af683(0x14c)]['id'],_0x74c42c=_0x4f3c23[_0x1af683(0x16d)]?.['id'][_0x1af683(0x150)]();if(!_0x74c42c)return;try{const _0x159504=await database_1[_0x1af683(0x18f)][_0x1af683(0x16b)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0xff68e1=_0x1af683(0x1a2);_0xff68e1+=_0x1af683(0x17e)+_0x74c42c+_0x1af683(0x11d),_0xff68e1+=_0x1af683(0xff),_0x159504['forEach']((_0x21a914,_0x1926f4)=>{const _0x2e15da=_0x1af683;_0xff68e1+=_0x1926f4+0x1+_0x2e15da(0x163)+_0x21a914['name']+'*\x0a',_0xff68e1+=_0x2e15da(0x1a1)+_0x21a914[_0x2e15da(0xfe)]+'`\x0a',_0xff68e1+=_0x2e15da(0xd0)+_0x21a914[_0x2e15da(0x19d)]+'\x0a',_0xff68e1+=_0x2e15da(0xf7)+_0x21a914[_0x2e15da(0xee)]['substring'](0x0,0xf)+'...`\x0a\x0a';}),await this['bot']?.[_0x1af683(0x162)](_0x2b458f,_0xff68e1,{'parse_mode':_0x1af683(0x180)});}catch(_0xac68f0){console[_0x1af683(0xef)]('Error\x20handling\x20/debug\x20command:',_0xac68f0),await this[_0x1af683(0xf4)]?.[_0x1af683(0x162)](_0x2b458f,_0x1af683(0x15f));}}),this[_0x292ae4(0xf4)]['on'](_0x292ae4(0xe6),async _0xb1b370=>{const _0x59951b=_0x292ae4;if(_0xb1b370[_0x59951b(0x121)]?.[_0x59951b(0x172)]('/'))return;const _0x5c7216=_0xb1b370[_0x59951b(0x14c)]['id'],_0x52fd19=_0xb1b370[_0x59951b(0x16d)]?.['id'][_0x59951b(0x150)](),_0x956cc3=_0xb1b370['text']?.[_0x59951b(0xe9)]();if(!_0x52fd19||!_0x956cc3)return;try{const _0x52e704=await database_1[_0x59951b(0x18f)][_0x59951b(0xea)]['findUnique']({'where':{'telegramId':_0x52fd19},'include':{'shop':!![]}});if(!_0x52e704){await this[_0x59951b(0xf4)]?.[_0x59951b(0x162)](_0x5c7216,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x52e704[_0x59951b(0x106)]&&_0x52e704[_0x59951b(0x1a3)]&&_0x52e704[_0x59951b(0x16b)]){await this[_0x59951b(0xf4)]?.[_0x59951b(0x162)](_0x5c7216,_0x59951b(0xf9)+_0x52e704[_0x59951b(0x16b)][_0x59951b(0x15d)]+'*.\x0a\x0a'+_0x59951b(0xd2),{'parse_mode':_0x59951b(0x180)});return;}const _0x15eca2=_0x956cc3['split'](/\s+/);if(_0x15eca2[_0x59951b(0x160)]!==0x2){await this[_0x59951b(0xf4)]?.[_0x59951b(0x162)](_0x5c7216,_0x59951b(0x142)+_0x59951b(0x128)+_0x59951b(0x139)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+('You\x20sent\x20'+_0x15eca2[_0x59951b(0x160)]+_0x59951b(0x147)+_0x15eca2[_0x59951b(0x109)](_0x1cda04=>'`'+_0x1cda04+'`')[_0x59951b(0xdd)](',\x20')),{'parse_mode':_0x59951b(0x180)});return;}const [_0x5b08be,_0x98aefa]=_0x15eca2;console[_0x59951b(0x154)](_0x59951b(0x151)+_0x52fd19+_0x59951b(0xc2)+_0x5b08be+_0x59951b(0x113)+_0x98aefa[_0x59951b(0x13e)](0x0,0xa)+_0x59951b(0x14a)),await this[_0x59951b(0xd5)](_0x5c7216,_0x52fd19,_0x5b08be,_0x98aefa);}catch(_0x147d4c){console[_0x59951b(0xef)]('Error\x20handling\x20message:',_0x147d4c),await this[_0x59951b(0xf4)]?.[_0x59951b(0x162)](_0x5c7216,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['on'](_0x292ae4(0xef),_0x146682=>{const _0x3f0200=_0x292ae4;console[_0x3f0200(0xef)](_0x3f0200(0x10d),_0x146682);}),this[_0x292ae4(0xf4)]['on']('polling_error',_0x168ac0=>{const _0x4bdec8=_0x292ae4;console[_0x4bdec8(0xef)]('Telegram\x20bot\x20polling\x20error:',_0x168ac0);});}async[a55_0x1826aa(0xd5)](_0x13a0f1,_0x283bed,_0x1a749f,_0x364523){const _0x27640b=a55_0x1826aa;try{console[_0x27640b(0x154)](_0x27640b(0x151)+_0x283bed+_0x27640b(0xc2)+_0x1a749f+_0x27640b(0x113)+_0x364523[_0x27640b(0x13e)](0x0,0xa)+_0x27640b(0x14a));if(!_0x1a749f||_0x1a749f['length']<0x3||_0x1a749f['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x27640b(0x173)](_0x1a749f)){await this[_0x27640b(0xf4)]?.[_0x27640b(0x162)](_0x13a0f1,_0x27640b(0x161)+_0x1a749f+_0x27640b(0x11d)+_0x27640b(0x145),{'parse_mode':'Markdown'});return;}if(!_0x364523||!_0x364523[_0x27640b(0x172)](_0x27640b(0xeb))&&!_0x364523[_0x27640b(0x172)]('sk_')){await this[_0x27640b(0xf4)]?.[_0x27640b(0x162)](_0x13a0f1,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x27640b(0x16a),{'parse_mode':'Markdown'});return;}const _0x2e6530=await database_1['default'][_0x27640b(0x16b)][_0x27640b(0x12a)]({'where':{'username':_0x1a749f},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x2e6530){const _0x7bb0b0=await database_1['default'][_0x27640b(0x16b)][_0x27640b(0x188)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x5080c5=_0x27640b(0x186)+_0x1a749f+_0x27640b(0x155);_0x7bb0b0['length']>0x0?(_0x5080c5+='Available\x20usernames:\x0a',_0x7bb0b0['forEach'](_0x12a348=>{const _0x2a56be=_0x27640b;_0x5080c5+=_0x2a56be(0x177)+_0x12a348[_0x2a56be(0xfe)]+_0x2a56be(0x11f)+_0x12a348[_0x2a56be(0x15d)]+')\x0a';}),_0x5080c5+=_0x27640b(0x19a)):_0x5080c5+=_0x27640b(0xe5);await this[_0x27640b(0xf4)]?.[_0x27640b(0x162)](_0x13a0f1,_0x5080c5,{'parse_mode':_0x27640b(0x180)});return;}if(_0x2e6530['status']!==_0x27640b(0x118)){await this[_0x27640b(0xf4)]?.[_0x27640b(0x162)](_0x13a0f1,'❌\x20Shop\x20`'+_0x1a749f+_0x27640b(0x159)+_0x27640b(0xc7),{'parse_mode':'Markdown'});return;}if(_0x2e6530[_0x27640b(0xee)]!==_0x364523&&_0x2e6530[_0x27640b(0x126)]!==_0x364523){await this['bot']?.[_0x27640b(0x162)](_0x13a0f1,_0x27640b(0x13f)+_0x1a749f+_0x27640b(0x107)+_0x27640b(0xfb)+_0x27640b(0x197),{'parse_mode':_0x27640b(0x180)});return;}const _0x4bf6f1=await database_1[_0x27640b(0x18f)][_0x27640b(0xea)][_0x27640b(0x129)]({'where':{'shopId':_0x2e6530['id'],'isVerified':!![],'telegramId':{'not':_0x283bed}}});if(_0x4bf6f1){await this[_0x27640b(0xf4)]?.[_0x27640b(0x162)](_0x13a0f1,_0x27640b(0xc1)+_0x1a749f+_0x27640b(0x107)+_0x27640b(0x14f),{'parse_mode':_0x27640b(0x180)});return;}await database_1[_0x27640b(0x18f)]['telegramUser']['update']({'where':{'telegramId':_0x283bed},'data':{'shopId':_0x2e6530['id'],'isVerified':!![]}}),await this[_0x27640b(0xf4)]?.['sendMessage'](_0x13a0f1,_0x27640b(0x136)+_0x27640b(0xc8)+('📱\x20Shop:\x20*'+_0x2e6530[_0x27640b(0x15d)]+'*\x0a')+(_0x27640b(0x189)+_0x2e6530[_0x27640b(0xfe)]+_0x27640b(0x11d))+_0x27640b(0xcc)+'•\x20New\x20payments\x0a'+_0x27640b(0x19e)+'•\x20Payouts\x0a'+_0x27640b(0xf1)+_0x27640b(0xfd)+_0x27640b(0xf2)+_0x27640b(0x148),{'parse_mode':_0x27640b(0x180)}),console[_0x27640b(0x154)](_0x27640b(0x138)+_0x283bed+'\x20verified\x20for\x20shop\x20'+_0x2e6530['username']+_0x27640b(0xf0));}catch(_0x3c8668){console[_0x27640b(0xef)]('Error\x20in\x20handleSingleLineVerification:',_0x3c8668),await this[_0x27640b(0xf4)]?.[_0x27640b(0x162)](_0x13a0f1,_0x27640b(0x1a7));}}async[a55_0x1826aa(0xd1)](_0x1b1a62,_0x41496e,_0x548636){const _0x25b8cf=a55_0x1826aa;if(!this[_0x25b8cf(0xf4)]){console[_0x25b8cf(0x131)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x3c6adb=await database_1[_0x25b8cf(0x18f)][_0x25b8cf(0xea)][_0x25b8cf(0x188)]({'where':{'shopId':_0x1b1a62,'isVerified':!![]}});if(_0x3c6adb[_0x25b8cf(0x160)]===0x0){console[_0x25b8cf(0x154)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x1b1a62);return;}const _0x4f3e4c=_0x3c6adb[_0x25b8cf(0x109)](async _0x1c54e6=>{const _0xa1e53e=_0x25b8cf;try{await this[_0xa1e53e(0xf4)]?.[_0xa1e53e(0x162)](_0x1c54e6[_0xa1e53e(0x18e)],_0x41496e,_0x548636),console[_0xa1e53e(0x154)](_0xa1e53e(0xe0)+_0x1c54e6['telegramId']);}catch(_0x511f44){console[_0xa1e53e(0xef)](_0xa1e53e(0x16e)+_0x1c54e6['telegramId']+':',_0x511f44),_0x511f44 instanceof Error&&(_0x511f44[_0xa1e53e(0xe6)][_0xa1e53e(0x15c)]('blocked')||_0x511f44[_0xa1e53e(0xe6)][_0xa1e53e(0x15c)](_0xa1e53e(0xec))||_0x511f44['message'][_0xa1e53e(0x15c)](_0xa1e53e(0x1a5)))&&(await database_1[_0xa1e53e(0x18f)]['telegramUser'][_0xa1e53e(0xc3)]({'where':{'id':_0x1c54e6['id']},'data':{'isVerified':![]}}),console[_0xa1e53e(0x154)](_0xa1e53e(0xdf)+_0x1c54e6[_0xa1e53e(0x18e)]+_0xa1e53e(0x194)));}});await Promise[_0x25b8cf(0x10e)](_0x4f3e4c);}catch(_0x4a4b51){console['error'](_0x25b8cf(0x170),_0x4a4b51);}}async[a55_0x1826aa(0x115)](_0x2bc174,_0x406135,_0x52a21c){const _0x31bbe6=a55_0x1826aa,_0x407488={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x3edeee={'created':_0x31bbe6(0x153),'paid':_0x31bbe6(0xe2),'failed':_0x31bbe6(0x117),'expired':_0x31bbe6(0x176),'refund':_0x31bbe6(0x196),'chargeback':_0x31bbe6(0x140),'processing':_0x31bbe6(0x183)},_0x13ed3c=_0x407488[_0x52a21c],_0x140bc6=_0x3edeee[_0x52a21c],_0x5b9302=(0x0,gateway_1[_0x31bbe6(0xdc)])(_0x406135['gateway']);console[_0x31bbe6(0x154)](_0x31bbe6(0x112)+_0x406135[_0x31bbe6(0x127)]+_0x31bbe6(0x125)+_0x5b9302+'\x22');let _0x4983fd=_0x13ed3c+'\x20*'+_0x140bc6+_0x31bbe6(0x110)+(_0x31bbe6(0xce)+_0x406135[_0x31bbe6(0x165)]+'\x20'+_0x406135[_0x31bbe6(0xc9)]+'*\x0a')+(_0x31bbe6(0x13d)+(_0x406135[_0x31bbe6(0xd4)]||_0x406135['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x406135['id']+'`\x0a')+(_0x31bbe6(0x13a)+_0x5b9302+'`\x0a')+(_0x31bbe6(0x152)+new Date(_0x406135['createdAt'])[_0x31bbe6(0x185)](_0x31bbe6(0xd7))+'\x0a');if(_0x406135[_0x31bbe6(0xe8)]||_0x406135[_0x31bbe6(0x1a4)]||_0x406135[_0x31bbe6(0xbf)]||_0x406135[_0x31bbe6(0x187)]||_0x406135['customerUa']){_0x4983fd+=_0x31bbe6(0x122);_0x406135[_0x31bbe6(0xe8)]&&(_0x4983fd+=_0x31bbe6(0x157)+_0x406135['customerName']+'`\x0a');_0x406135[_0x31bbe6(0x1a4)]&&(_0x4983fd+=_0x31bbe6(0x19b)+_0x406135[_0x31bbe6(0x1a4)]+'`\x0a');_0x406135[_0x31bbe6(0xbf)]&&(_0x4983fd+=_0x31bbe6(0xd8)+_0x406135['remitterIban']+'`\x0a');_0x406135[_0x31bbe6(0x187)]&&(_0x4983fd+='🌐\x20IP:\x20`'+_0x406135[_0x31bbe6(0x187)]+'`\x0a');if(_0x406135[_0x31bbe6(0x175)]){const _0x4982da=_0x406135[_0x31bbe6(0x175)]['length']>0x32?_0x406135[_0x31bbe6(0x175)]['substring'](0x0,0x32)+_0x31bbe6(0x17c):_0x406135['customerUa'];_0x4983fd+=_0x31bbe6(0x17b)+_0x4982da+'`\x0a';}}_0x52a21c===_0x31bbe6(0x14d)&&_0x406135['chargebackAmount']&&(_0x4983fd+=_0x31bbe6(0x130)+_0x406135[_0x31bbe6(0xf5)]+_0x31bbe6(0x181)),_0x52a21c===_0x31bbe6(0xc4)&&(_0x4983fd+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x406135[_0x31bbe6(0xcd)]&&(_0x4983fd+='📝\x20Notes:\x20'+_0x406135['adminNotes']+'\x0a'),await this[_0x31bbe6(0xd1)](_0x2bc174,_0x4983fd,{'parse_mode':'Markdown'});}async[a55_0x1826aa(0xd9)](_0x490058,_0x1db109,_0x31a1d3){const _0xccb45b=a55_0x1826aa,_0x197bd9={'created':'📤','completed':'✅','rejected':'❌'},_0x415bd3={'created':_0xccb45b(0xe7),'completed':_0xccb45b(0xd3),'rejected':_0xccb45b(0x191)},_0x47688e=_0x197bd9[_0x31a1d3],_0x2e35af=_0x415bd3[_0x31a1d3],_0x43670e=_0x47688e+'\x20*'+_0x2e35af+_0xccb45b(0x110)+(_0xccb45b(0x199)+_0x1db109[_0xccb45b(0x165)]+_0xccb45b(0x192))+(_0xccb45b(0x17d)+_0x1db109[_0xccb45b(0x1a6)]+'`\x0a')+(_0xccb45b(0x10a)+_0x1db109['id']+'`\x0a')+(_0xccb45b(0x152)+new Date(_0x1db109[_0xccb45b(0x14b)])['toLocaleString'](_0xccb45b(0xd7))+'\x0a')+(_0x1db109[_0xccb45b(0x179)]?_0xccb45b(0x184)+_0x1db109[_0xccb45b(0x179)]+'`':'');await this['sendShopNotification'](_0x490058,_0x43670e,{'parse_mode':_0xccb45b(0x180)});}async[a55_0x1826aa(0x149)](_0x4c14a9,_0x13b7de){const _0x330218=a55_0x1826aa;try{const _0x3d9b19=await database_1[_0x330218(0x18f)][_0x330218(0x17f)][_0x330218(0x12a)]({'where':{'shopId':_0x4c14a9},'select':{'notificationLogin':!![]}});if(!_0x3d9b19?.[_0x330218(0x15b)]){console[_0x330218(0x154)](_0x330218(0x14e)+_0x4c14a9);return;}const _0xbb7c10=_0x13b7de[_0x330218(0x132)]?'🔐':'🚨',_0x19fb75=_0x13b7de[_0x330218(0x132)]?_0x330218(0x1a9):_0x330218(0xe3);let _0x21af8e=_0xbb7c10+'\x20*'+_0x19fb75+_0x330218(0x110)+(_0x330218(0x189)+_0x13b7de['username']+'`\x0a')+('📅\x20Time:\x20'+_0x13b7de[_0x330218(0xda)][_0x330218(0x185)](_0x330218(0xd7))+'\x0a');_0x13b7de[_0x330218(0x169)]&&(_0x21af8e+=_0x330218(0x11c)+_0x13b7de[_0x330218(0x169)]+'`\x0a');if(_0x13b7de[_0x330218(0x18a)]){const _0x3f0a35=_0x13b7de['userAgent'][_0x330218(0x160)]>0x32?_0x13b7de['userAgent']['substring'](0x0,0x32)+_0x330218(0x17c):_0x13b7de[_0x330218(0x18a)];_0x21af8e+=_0x330218(0x17b)+_0x3f0a35+'`\x0a';}!_0x13b7de['success']&&(_0x21af8e+=_0x330218(0x195)),await this['sendShopNotification'](_0x4c14a9,_0x21af8e,{'parse_mode':'Markdown'}),console['log'](_0x330218(0x12f)+_0x4c14a9+':\x20'+(_0x13b7de[_0x330218(0x132)]?_0x330218(0x132):_0x330218(0x12d)));}catch(_0x254e1b){console[_0x330218(0xef)](_0x330218(0x16f),_0x254e1b);}}async['sendApiErrorNotification'](_0x644f3d,_0x4e392b){const _0x41ad49=a55_0x1826aa;try{const _0x4ff800=await database_1[_0x41ad49(0x18f)][_0x41ad49(0x17f)]['findUnique']({'where':{'shopId':_0x644f3d},'select':{'notificationApiError':!![]}});if(!_0x4ff800?.['notificationApiError']){console[_0x41ad49(0x154)](_0x41ad49(0x108)+_0x644f3d);return;}let _0x4bea4b='🚨\x20*API\x20Error*\x0a\x0a'+(_0x41ad49(0x10f)+_0x4e392b['method']+'\x20'+_0x4e392b['endpoint']+'`\x0a')+(_0x41ad49(0xf6)+_0x4e392b['timestamp'][_0x41ad49(0x185)](_0x41ad49(0xd7))+'\x0a');_0x4e392b[_0x41ad49(0x18c)]&&(_0x4bea4b+=_0x41ad49(0x100)+_0x4e392b[_0x41ad49(0x18c)]+'`\x0a'),_0x4bea4b+='❌\x20Error:\x20`'+_0x4e392b[_0x41ad49(0x144)]+'`\x0a',_0x4e392b[_0x41ad49(0x12c)]&&(_0x4bea4b+=_0x41ad49(0x124)+_0x4e392b[_0x41ad49(0x12c)]+'`\x0a'),_0x4bea4b+=_0x41ad49(0x193),await this[_0x41ad49(0xd1)](_0x644f3d,_0x4bea4b,{'parse_mode':'Markdown'}),console['log']('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x644f3d+':\x20'+_0x4e392b[_0x41ad49(0x16c)]);}catch(_0x40c366){console[_0x41ad49(0xef)](_0x41ad49(0x198),_0x40c366);}}async[a55_0x1826aa(0x178)](_0x4bad88,_0x1bf4e2,_0x1001b6){const _0x2a60f1=a55_0x1826aa;let _0x18b2c3=_0x2a60f1(0x1a0)+_0x1bf4e2+_0x2a60f1(0x110);for(const [_0x13927e,_0x15a7d5]of Object['entries'](_0x1001b6)){_0x15a7d5!==null&&_0x15a7d5!==undefined&&(_0x18b2c3+=_0x13927e+_0x2a60f1(0x103)+_0x15a7d5+'`\x0a');}await this['sendShopNotification'](_0x4bad88,_0x18b2c3,{'parse_mode':_0x2a60f1(0x180)});}[a55_0x1826aa(0x134)](){const _0x80b9bf=a55_0x1826aa;return{'isActive':!!this[_0x80b9bf(0xf4)],'username':this[_0x80b9bf(0x182)]};}['stopBot'](){const _0x22909b=a55_0x1826aa;this[_0x22909b(0xf4)]&&(this[_0x22909b(0xf4)]['stopPolling'](),this[_0x22909b(0xf4)]=null,console['log']('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a55_0x1826aa(0xca)]=TelegramBotService,exports[a55_0x1826aa(0x114)]=new TelegramBotService();