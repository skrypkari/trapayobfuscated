'use strict';const a57_0x429f25=a57_0x40ed;(function(_0x5056f8,_0x14dec7){const _0x4024c6=a57_0x40ed,_0x33f08d=_0x5056f8();while(!![]){try{const _0x5a1dac=parseInt(_0x4024c6(0x1c2))/0x1*(-parseInt(_0x4024c6(0x25a))/0x2)+-parseInt(_0x4024c6(0x273))/0x3+-parseInt(_0x4024c6(0x24b))/0x4+parseInt(_0x4024c6(0x226))/0x5*(parseInt(_0x4024c6(0x280))/0x6)+parseInt(_0x4024c6(0x1df))/0x7+parseInt(_0x4024c6(0x237))/0x8+-parseInt(_0x4024c6(0x1e2))/0x9*(-parseInt(_0x4024c6(0x1a9))/0xa);if(_0x5a1dac===_0x14dec7)break;else _0x33f08d['push'](_0x33f08d['shift']());}catch(_0x2a7457){_0x33f08d['push'](_0x33f08d['shift']());}}}(a57_0x52cf,0xadb21));var __importDefault=this&&this[a57_0x429f25(0x1b9)]||function(_0x12f0ac){return _0x12f0ac&&_0x12f0ac['__esModule']?_0x12f0ac:{'default':_0x12f0ac};};function a57_0x40ed(_0xcc82bb,_0x3d6fb1){const _0x52cfa6=a57_0x52cf();return a57_0x40ed=function(_0x40edd4,_0x1448d8){_0x40edd4=_0x40edd4-0x1a8;let _0x2e949a=_0x52cfa6[_0x40edd4];return _0x2e949a;},a57_0x40ed(_0xcc82bb,_0x3d6fb1);}Object[a57_0x429f25(0x263)](exports,a57_0x429f25(0x1b7),{'value':!![]}),exports[a57_0x429f25(0x284)]=exports[a57_0x429f25(0x281)]=void 0x0;function a57_0x52cf(){const _0x2896e3=['telegramBotService','endpoint','trapay_bot','chargebackAmount','sendCustomNotification','node-telegram-bot-api','7001180sgbYHI','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','timestamp','.\x20*','error','includes','currency','📱\x20Shop:\x20*','forEach','❌\x20Error:\x20`','`.\x0a\x0a','notificationLogin','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','customerName','__esModule','notificationApiError','__importDefault','initializeBot','customerUa','/status\x20-\x20check\x20connection\x20status\x0a','update','Error\x20handling\x20message:','method','*\x0a\x0a','❌\x20Invalid\x20username\x20format:\x20`','24267gXUajq','chat','shop','processing','pk_','📝\x20Order\x20ID:\x20`','To\x20reconnect,\x20use\x20the\x20/start\x20command','\x20USD*\x0a','`\x20(','/disconnect\x20-\x20disconnect\x20from\x20notifications','remitterIban','🔌\x20User\x20','sendShopNotification','✅\x20Connected\x20to\x20shop:\x20*','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','requestId','username','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','`\x20not\x20found.\x0a\x0a','txid','handleSingleLineVerification','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','🏪\x20Available\x20shops\x20in\x20system:\x0a','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','failed','📅\x20Time:\x20','✅\x20Telegram\x20bot\x20@','customerIp','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','3753547ICxGdM','🏪\x20Gateway:\x20`','customerEmail','9aPssAn','getGatewayDisplayNameForTelegram','message','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','•\x20`','•\x20Payment\x20status\x20changes\x0a','map','🔔\x20*','Payment\x20chargeback','botUsername','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','\x22,\x20apiKey=\x22','📊\x20Error\x20code:\x20`','userAgent','createdAt','🏦\x20IBAN:\x20`','📱\x20Your\x20Telegram\x20ID:\x20`','toString','Commands:\x0a','Payment\x20successfully\x20paid','status','Error\x20handling\x20/start\x20command:','botToken','🚨\x20*API\x20Error*\x0a\x0a','telegramId','sendPayoutNotification','Failed\x20to\x20send\x20API\x20error\x20notification:','Use\x20/start\x20to\x20begin.','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','📝\x20Notes:\x20','👤\x20Username:\x20`','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','blocked','Telegram\x20bot\x20polling\x20error:','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','🌐\x20IP\x20address:\x20`','errorMessage','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','\x20parts:\x20','stopBot','adminNotes','🔗\x20TXID:\x20`','Payout\x20completed','isVerified','TELEGRAM_BOT_TOKEN','`\x20is\x20inactive.\x0a\x0a','📊\x20*Connection\x20Status*\x0a\x0a','Payment\x20expired','en-US','*.\x0a\x0a','bot','sendApiErrorNotification','New\x20payout\x20created','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','findUnique','\x0a👤\x20*Customer\x20Information:*\x0a','•\x20New\x20payments\x0a','gateway','shopId','•\x20Payouts\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','🔔\x20You\x20receive\x20notifications\x20about:\x0a','name','\x22\x20->\x20display\x20\x22','📱\x20Telegram\x20notification:\x20gateway\x20\x22','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','5EKEtBW','substring',':\x20username=\x22','Failed\x20to\x20send\x20login\x20notification:','toLocaleString','💸\x20Penalty\x20amount:\x20*','🌐\x20IP:\x20`','success','Contact\x20administrator.','findFirst','Error\x20handling\x20/status\x20command:','chat\x20not\x20found','toLocaleDateString','findMany','🎉\x20*Congratulations!*\x0a\x0a','publicKey','Failed\x20login\x20attempt','5427984KGkdNJ','last_name','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','🆔\x20Request\x20ID:\x20`','🔗\x20Endpoint:\x20`','\x20\x20\x20Public\x20Key:\x20`','create','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','Error\x20handling\x20/debug\x20command:','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','ACTIVE','Use\x20/start\x20to\x20connect.','🛑\x20Telegram\x20bot\x20stopped','•\x20Important\x20events\x0a\x0a','Username:\x20`','📅\x20Date:\x20','Error\x20sending\x20shop\x20notification:','env','❌\x20Shop\x20with\x20username\x20`','shopSettings','476272QRRXdT','polling_error','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Payment\x20is\x20being\x20processed','../config/database','User\x20','🆔\x20Payment\x20ID:\x20`','from','Check\x20spelling\x20and\x20try\x20again.','\x20USDT*\x0a','...`\x0a\x0a','updatedAt','onText','allSettled','`\x0a\x0a','54eWXDxq','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','Example:\x0a','default','\x20via\x20single-line\x20input','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','text','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','statusCode','defineProperty','user\x20is\x20deactivated','ipAddress','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','length','✅\x20Telegram\x20user\x20','amount','Successful\x20login','🔔\x20Notifications\x20are\x20active\x0a\x0a','chargeback','telegramUser','Markdown','sendMessage','entries','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','\x20(@','3871056xMkJrC','orderId','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','❌\x20Please\x20use\x20/start\x20command\x20first','startsWith','📱\x20Created\x20new\x20Telegram\x20user:\x20','💻\x20Browser:\x20`','•\x20Payouts\x0a\x0a','...\x22','log','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','join','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','5167494fnRpPM','TelegramBotService','Payment\x20failed','sendLoginNotification'];a57_0x52cf=function(){return _0x2896e3;};return a57_0x52cf();}const node_telegram_bot_api_1=__importDefault(require(a57_0x429f25(0x1a8))),database_1=__importDefault(require(a57_0x429f25(0x24f))),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x37fe3c=a57_0x429f25;this[_0x37fe3c(0x216)]=null,this[_0x37fe3c(0x1f8)]=process['env'][_0x37fe3c(0x210)]||'',this[_0x37fe3c(0x1eb)]=process[_0x37fe3c(0x248)]['TELEGRAM_BOT_USERNAME']||_0x37fe3c(0x286),this['botToken']?this['initializeBot']():console['warn'](_0x37fe3c(0x201));}[a57_0x429f25(0x1ba)](){const _0x755a64=a57_0x429f25;try{this[_0x755a64(0x216)]=new node_telegram_bot_api_1[(_0x755a64(0x25d))](this['botToken'],{'polling':!![]}),this['setupBotHandlers'](),console[_0x755a64(0x27c)](_0x755a64(0x1dc)+this[_0x755a64(0x1eb)]+'\x20initialized\x20successfully');}catch(_0x4ca6b1){console[_0x755a64(0x1ad)](_0x755a64(0x27d),_0x4ca6b1);}}['setupBotHandlers'](){const _0x5c8e33=a57_0x429f25;if(!this[_0x5c8e33(0x216)])return;this[_0x5c8e33(0x216)]['onText'](/\/start/,async _0x233ffe=>{const _0x429f73=_0x5c8e33,_0x3552ab=_0x233ffe[_0x429f73(0x1c3)]['id'],_0x40b24b=_0x233ffe[_0x429f73(0x252)]?.['id']['toString'](),_0x15d1f1=_0x233ffe[_0x429f73(0x252)]?.[_0x429f73(0x1d2)],_0x3dfabf=_0x233ffe[_0x429f73(0x252)]?.['first_name'],_0x3e032d=_0x233ffe[_0x429f73(0x252)]?.[_0x429f73(0x238)];if(!_0x40b24b)return;try{let _0x495a43=await database_1[_0x429f73(0x25d)]['telegramUser'][_0x429f73(0x21a)]({'where':{'telegramId':_0x40b24b},'include':{'shop':!![]}});!_0x495a43?(_0x495a43=await database_1[_0x429f73(0x25d)][_0x429f73(0x26d)][_0x429f73(0x23d)]({'data':{'telegramId':_0x40b24b,'username':_0x15d1f1,'firstName':_0x3dfabf,'lastName':_0x3e032d,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x429f73(0x27c)](_0x429f73(0x278)+_0x40b24b+_0x429f73(0x272)+_0x15d1f1+')')):_0x495a43=await database_1[_0x429f73(0x25d)][_0x429f73(0x26d)][_0x429f73(0x1bd)]({'where':{'telegramId':_0x40b24b},'data':{'username':_0x15d1f1,'firstName':_0x3dfabf,'lastName':_0x3e032d},'include':{'shop':!![]}}),_0x495a43[_0x429f73(0x20f)]&&_0x495a43[_0x429f73(0x21e)]&&_0x495a43['shop']?await this[_0x429f73(0x216)]?.[_0x429f73(0x26f)](_0x3552ab,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x429f73(0x271)+_0x495a43[_0x429f73(0x1c4)][_0x429f73(0x222)]+'*\x0a')+(_0x429f73(0x245)+_0x495a43[_0x429f73(0x1c4)]['username']+_0x429f73(0x259))+_0x429f73(0x221)+_0x429f73(0x21c)+'•\x20Payment\x20status\x20changes\x0a'+_0x429f73(0x27a)+_0x429f73(0x1f4)+_0x429f73(0x1bc)+_0x429f73(0x1cb),{'parse_mode':_0x429f73(0x26e)}):(_0x495a43['shopId']&&!_0x495a43[_0x429f73(0x20f)]&&(await database_1['default'][_0x429f73(0x26d)][_0x429f73(0x1bd)]({'where':{'telegramId':_0x40b24b},'data':{'shopId':null,'isVerified':![]}}),console[_0x429f73(0x27c)](_0x429f73(0x1d9)+_0x40b24b)),await this['bot']?.['sendMessage'](_0x3552ab,_0x429f73(0x209)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x429f73(0x240)+'Example:\x0a'+_0x429f73(0x27f)+_0x429f73(0x1d0),{'parse_mode':'Markdown'}));}catch(_0xc3e386){console[_0x429f73(0x1ad)](_0x429f73(0x1f7),_0xc3e386),await this[_0x429f73(0x216)]?.[_0x429f73(0x26f)](_0x3552ab,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x5c8e33(0x216)][_0x5c8e33(0x257)](/\/disconnect/,async _0xff8091=>{const _0xfca41=_0x5c8e33,_0x6adbf3=_0xff8091['chat']['id'],_0x546324=_0xff8091['from']?.['id']['toString']();if(!_0x546324)return;try{const _0x5e5011=await database_1[_0xfca41(0x25d)][_0xfca41(0x26d)][_0xfca41(0x21a)]({'where':{'telegramId':_0x546324},'include':{'shop':!![]}});if(!_0x5e5011||!_0x5e5011[_0xfca41(0x20f)]||!_0x5e5011[_0xfca41(0x21e)]){await this['bot']?.[_0xfca41(0x26f)](_0x6adbf3,_0xfca41(0x261));return;}const _0x657061=_0x5e5011['shop']?.[_0xfca41(0x222)]||'unknown\x20shop';await database_1[_0xfca41(0x25d)][_0xfca41(0x26d)][_0xfca41(0x1bd)]({'where':{'telegramId':_0x546324},'data':{'shopId':null,'isVerified':![]}}),console[_0xfca41(0x27c)](_0xfca41(0x1cd)+_0x546324+'\x20disconnected\x20from\x20shop\x20'+_0x5e5011[_0xfca41(0x21e)]),await this[_0xfca41(0x216)]?.['sendMessage'](_0x6adbf3,_0xfca41(0x1aa)+_0x657061+_0xfca41(0x215)+_0xfca41(0x1c8),{'parse_mode':_0xfca41(0x26e)});}catch(_0xfe612a){console[_0xfca41(0x1ad)]('Error\x20handling\x20/disconnect\x20command:',_0xfe612a),await this['bot']?.['sendMessage'](_0x6adbf3,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x5c8e33(0x216)][_0x5c8e33(0x257)](/\/status/,async _0x16cf0d=>{const _0x18f5fc=_0x5c8e33,_0x4d8a80=_0x16cf0d[_0x18f5fc(0x1c3)]['id'],_0x5ae2ee=_0x16cf0d[_0x18f5fc(0x252)]?.['id'][_0x18f5fc(0x1f3)]();if(!_0x5ae2ee)return;try{const _0x2d0e1a=await database_1[_0x18f5fc(0x25d)][_0x18f5fc(0x26d)][_0x18f5fc(0x21a)]({'where':{'telegramId':_0x5ae2ee},'include':{'shop':!![]}});if(!_0x2d0e1a){await this[_0x18f5fc(0x216)]?.['sendMessage'](_0x4d8a80,_0x18f5fc(0x1d7)+_0x18f5fc(0x1fd));return;}if(!_0x2d0e1a[_0x18f5fc(0x20f)]||!_0x2d0e1a['shopId']||!_0x2d0e1a[_0x18f5fc(0x1c4)]){await this[_0x18f5fc(0x216)]?.[_0x18f5fc(0x26f)](_0x4d8a80,_0x18f5fc(0x1d3)+_0x18f5fc(0x242));return;}await this[_0x18f5fc(0x216)]?.[_0x18f5fc(0x26f)](_0x4d8a80,_0x18f5fc(0x212)+(_0x18f5fc(0x1cf)+_0x2d0e1a[_0x18f5fc(0x1c4)][_0x18f5fc(0x222)]+'*\x0a')+(_0x18f5fc(0x200)+_0x2d0e1a['shop'][_0x18f5fc(0x1d2)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x2d0e1a[_0x18f5fc(0x256)][_0x18f5fc(0x232)](_0x18f5fc(0x214))+'\x0a\x0a')+_0x18f5fc(0x26b)+_0x18f5fc(0x1f4)+_0x18f5fc(0x1cb),{'parse_mode':_0x18f5fc(0x26e)});}catch(_0x1a4fc1){console[_0x18f5fc(0x1ad)](_0x18f5fc(0x230),_0x1a4fc1),await this[_0x18f5fc(0x216)]?.[_0x18f5fc(0x26f)](_0x4d8a80,_0x18f5fc(0x1e5));}}),this[_0x5c8e33(0x216)]['onText'](/\/debug/,async _0x34ef6f=>{const _0x457612=_0x5c8e33,_0x4f390b=_0x34ef6f[_0x457612(0x1c3)]['id'],_0x2151e4=_0x34ef6f['from']?.['id'][_0x457612(0x1f3)]();if(!_0x2151e4)return;try{const _0x47e614=await database_1[_0x457612(0x25d)][_0x457612(0x1c4)][_0x457612(0x233)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x575f4f='🔍\x20*Debug\x20Information*\x0a\x0a';_0x575f4f+=_0x457612(0x1f2)+_0x2151e4+_0x457612(0x259),_0x575f4f+=_0x457612(0x1d8),_0x47e614[_0x457612(0x1b1)]((_0x596ba7,_0x5164a5)=>{const _0x55e6ee=_0x457612;_0x575f4f+=_0x5164a5+0x1+_0x55e6ee(0x1ac)+_0x596ba7[_0x55e6ee(0x222)]+'*\x0a',_0x575f4f+='\x20\x20\x20Username:\x20`'+_0x596ba7[_0x55e6ee(0x1d2)]+'`\x0a',_0x575f4f+='\x20\x20\x20Status:\x20'+_0x596ba7[_0x55e6ee(0x1f6)]+'\x0a',_0x575f4f+=_0x55e6ee(0x23c)+_0x596ba7[_0x55e6ee(0x235)]['substring'](0x0,0xf)+_0x55e6ee(0x255);}),await this[_0x457612(0x216)]?.['sendMessage'](_0x4f390b,_0x575f4f,{'parse_mode':_0x457612(0x26e)});}catch(_0x1d37e5){console['error'](_0x457612(0x23f),_0x1d37e5),await this['bot']?.[_0x457612(0x26f)](_0x4f390b,'❌\x20Error\x20getting\x20debug\x20information.');}}),this['bot']['on'](_0x5c8e33(0x1e4),async _0x3614eb=>{const _0x16245e=_0x5c8e33;if(_0x3614eb[_0x16245e(0x260)]?.[_0x16245e(0x277)]('/'))return;const _0x4012c9=_0x3614eb['chat']['id'],_0x39e86a=_0x3614eb['from']?.['id'][_0x16245e(0x1f3)](),_0x135450=_0x3614eb['text']?.['trim']();if(!_0x39e86a||!_0x135450)return;try{const _0xd1509d=await database_1[_0x16245e(0x25d)][_0x16245e(0x26d)]['findUnique']({'where':{'telegramId':_0x39e86a},'include':{'shop':!![]}});if(!_0xd1509d){await this['bot']?.['sendMessage'](_0x4012c9,_0x16245e(0x276));return;}if(_0xd1509d[_0x16245e(0x20f)]&&_0xd1509d[_0x16245e(0x21e)]&&_0xd1509d[_0x16245e(0x1c4)]){await this[_0x16245e(0x216)]?.[_0x16245e(0x26f)](_0x4012c9,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0xd1509d[_0x16245e(0x1c4)][_0x16245e(0x222)]+_0x16245e(0x215)+_0x16245e(0x1b5),{'parse_mode':_0x16245e(0x26e)});return;}const _0x4929ca=_0x135450['split'](/\s+/);if(_0x4929ca['length']!==0x2){await this[_0x16245e(0x216)]?.[_0x16245e(0x26f)](_0x4012c9,_0x16245e(0x24d)+_0x16245e(0x240)+_0x16245e(0x25c)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+('You\x20sent\x20'+_0x4929ca[_0x16245e(0x267)]+_0x16245e(0x20a)+_0x4929ca[_0x16245e(0x1e8)](_0x28ea39=>'`'+_0x28ea39+'`')[_0x16245e(0x27e)](',\x20')),{'parse_mode':_0x16245e(0x26e)});return;}const [_0x4ccab4,_0x287583]=_0x4929ca;console[_0x16245e(0x27c)](_0x16245e(0x239)+_0x39e86a+_0x16245e(0x228)+_0x4ccab4+'\x22,\x20apiKey=\x22'+_0x287583[_0x16245e(0x227)](0x0,0xa)+_0x16245e(0x27b)),await this[_0x16245e(0x1d6)](_0x4012c9,_0x39e86a,_0x4ccab4,_0x287583);}catch(_0x38ccb9){console[_0x16245e(0x1ad)](_0x16245e(0x1be),_0x38ccb9),await this[_0x16245e(0x216)]?.[_0x16245e(0x26f)](_0x4012c9,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x5c8e33(0x216)]['on'](_0x5c8e33(0x1ad),_0x2bd59b=>{console['error']('Telegram\x20bot\x20error:',_0x2bd59b);}),this[_0x5c8e33(0x216)]['on'](_0x5c8e33(0x24c),_0xc70c3b=>{const _0x55f637=_0x5c8e33;console['error'](_0x55f637(0x204),_0xc70c3b);});}async[a57_0x429f25(0x1d6)](_0x31d7f9,_0x21550f,_0x38bbb8,_0x1c5b86){const _0x4bc229=a57_0x429f25;try{console[_0x4bc229(0x27c)](_0x4bc229(0x239)+_0x21550f+_0x4bc229(0x228)+_0x38bbb8+_0x4bc229(0x1ed)+_0x1c5b86[_0x4bc229(0x227)](0x0,0xa)+_0x4bc229(0x27b));if(!_0x38bbb8||_0x38bbb8[_0x4bc229(0x267)]<0x3||_0x38bbb8['length']>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x38bbb8)){await this['bot']?.[_0x4bc229(0x26f)](_0x31d7f9,_0x4bc229(0x1c1)+_0x38bbb8+_0x4bc229(0x259)+_0x4bc229(0x25b),{'parse_mode':'Markdown'});return;}if(!_0x1c5b86||!_0x1c5b86['startsWith'](_0x4bc229(0x1c6))&&!_0x1c5b86['startsWith']('sk_')){await this[_0x4bc229(0x216)]?.[_0x4bc229(0x26f)](_0x31d7f9,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x4bc229(0x1de),{'parse_mode':_0x4bc229(0x26e)});return;}const _0x421bce=await database_1[_0x4bc229(0x25d)][_0x4bc229(0x1c4)][_0x4bc229(0x21a)]({'where':{'username':_0x38bbb8},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x421bce){const _0x5e0f8f=await database_1[_0x4bc229(0x25d)][_0x4bc229(0x1c4)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x174791=_0x4bc229(0x249)+_0x38bbb8+_0x4bc229(0x1d4);_0x5e0f8f['length']>0x0?(_0x174791+='Available\x20usernames:\x0a',_0x5e0f8f[_0x4bc229(0x1b1)](_0x2f0782=>{const _0x467520=_0x4bc229;_0x174791+=_0x467520(0x1e6)+_0x2f0782['username']+_0x467520(0x1ca)+_0x2f0782[_0x467520(0x222)]+')\x0a';}),_0x174791+=_0x4bc229(0x220)):_0x174791+=_0x4bc229(0x253);await this[_0x4bc229(0x216)]?.[_0x4bc229(0x26f)](_0x31d7f9,_0x174791,{'parse_mode':_0x4bc229(0x26e)});return;}if(_0x421bce[_0x4bc229(0x1f6)]!==_0x4bc229(0x241)){await this[_0x4bc229(0x216)]?.['sendMessage'](_0x31d7f9,'❌\x20Shop\x20`'+_0x38bbb8+_0x4bc229(0x211)+_0x4bc229(0x22e),{'parse_mode':_0x4bc229(0x26e)});return;}if(_0x421bce[_0x4bc229(0x235)]!==_0x1c5b86&&_0x421bce['secretKey']!==_0x1c5b86){await this['bot']?.['sendMessage'](_0x31d7f9,_0x4bc229(0x25f)+_0x38bbb8+_0x4bc229(0x1b3)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x4bc229(0x205),{'parse_mode':_0x4bc229(0x26e)});return;}const _0x1718ce=await database_1[_0x4bc229(0x25d)][_0x4bc229(0x26d)][_0x4bc229(0x22f)]({'where':{'shopId':_0x421bce['id'],'isVerified':!![],'telegramId':{'not':_0x21550f}}});if(_0x1718ce){await this[_0x4bc229(0x216)]?.[_0x4bc229(0x26f)](_0x31d7f9,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x38bbb8+_0x4bc229(0x1b3)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x4bc229(0x26e)});return;}await database_1[_0x4bc229(0x25d)][_0x4bc229(0x26d)][_0x4bc229(0x1bd)]({'where':{'telegramId':_0x21550f},'data':{'shopId':_0x421bce['id'],'isVerified':!![]}}),await this[_0x4bc229(0x216)]?.['sendMessage'](_0x31d7f9,_0x4bc229(0x234)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x4bc229(0x1b0)+_0x421bce['name']+'*\x0a')+(_0x4bc229(0x200)+_0x421bce[_0x4bc229(0x1d2)]+'`\x0a\x0a')+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x4bc229(0x21c)+_0x4bc229(0x1e7)+_0x4bc229(0x21f)+_0x4bc229(0x244)+_0x4bc229(0x1f4)+_0x4bc229(0x1bc)+_0x4bc229(0x1cb),{'parse_mode':_0x4bc229(0x26e)}),console[_0x4bc229(0x27c)](_0x4bc229(0x268)+_0x21550f+'\x20verified\x20for\x20shop\x20'+_0x421bce['username']+_0x4bc229(0x25e));}catch(_0x402dc9){console[_0x4bc229(0x1ad)]('Error\x20in\x20handleSingleLineVerification:',_0x402dc9),await this['bot']?.[_0x4bc229(0x26f)](_0x31d7f9,_0x4bc229(0x275));}}async[a57_0x429f25(0x1ce)](_0x2b4a0e,_0x3c597a,_0x23a553){const _0x18f749=a57_0x429f25;if(!this[_0x18f749(0x216)]){console['warn'](_0x18f749(0x266));return;}try{const _0xef8e1=await database_1[_0x18f749(0x25d)]['telegramUser']['findMany']({'where':{'shopId':_0x2b4a0e,'isVerified':!![]}});if(_0xef8e1[_0x18f749(0x267)]===0x0){console[_0x18f749(0x27c)](_0x18f749(0x23e)+_0x2b4a0e);return;}const _0x1e3172=_0xef8e1[_0x18f749(0x1e8)](async _0x14b959=>{const _0x5e8cd2=_0x18f749;try{await this[_0x5e8cd2(0x216)]?.[_0x5e8cd2(0x26f)](_0x14b959['telegramId'],_0x3c597a,_0x23a553),console[_0x5e8cd2(0x27c)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x14b959[_0x5e8cd2(0x1fa)]);}catch(_0x189cb3){console['error']('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x14b959[_0x5e8cd2(0x1fa)]+':',_0x189cb3),_0x189cb3 instanceof Error&&(_0x189cb3[_0x5e8cd2(0x1e4)][_0x5e8cd2(0x1ae)](_0x5e8cd2(0x203))||_0x189cb3[_0x5e8cd2(0x1e4)]['includes'](_0x5e8cd2(0x231))||_0x189cb3['message']['includes'](_0x5e8cd2(0x264)))&&(await database_1['default'][_0x5e8cd2(0x26d)][_0x5e8cd2(0x1bd)]({'where':{'id':_0x14b959['id']},'data':{'isVerified':![]}}),console[_0x5e8cd2(0x27c)](_0x5e8cd2(0x250)+_0x14b959[_0x5e8cd2(0x1fa)]+_0x5e8cd2(0x225)));}});await Promise[_0x18f749(0x258)](_0x1e3172);}catch(_0x3844b4){console[_0x18f749(0x1ad)](_0x18f749(0x247),_0x3844b4);}}async['sendPaymentNotification'](_0x49e91d,_0x16aa87,_0x4d4cf9){const _0x34cdc2=a57_0x429f25,_0x474658={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x1813e1={'created':'New\x20payment\x20created','paid':_0x34cdc2(0x1f5),'failed':_0x34cdc2(0x282),'expired':_0x34cdc2(0x213),'refund':'Payment\x20refund','chargeback':_0x34cdc2(0x1ea),'processing':_0x34cdc2(0x24e)},_0x5da9ac=_0x474658[_0x4d4cf9],_0x16a7ca=_0x1813e1[_0x4d4cf9],_0x23d423=(0x0,gateway_1[_0x34cdc2(0x1e3)])(_0x16aa87[_0x34cdc2(0x21d)]);console[_0x34cdc2(0x27c)](_0x34cdc2(0x224)+_0x16aa87['gateway']+_0x34cdc2(0x223)+_0x23d423+'\x22');let _0x2e1c05=_0x5da9ac+'\x20*'+_0x16a7ca+_0x34cdc2(0x1c0)+('💰\x20Amount:\x20*'+_0x16aa87[_0x34cdc2(0x269)]+'\x20'+_0x16aa87[_0x34cdc2(0x1af)]+'*\x0a')+(_0x34cdc2(0x1c7)+(_0x16aa87[_0x34cdc2(0x274)]||_0x16aa87['id'])+'`\x0a')+(_0x34cdc2(0x251)+_0x16aa87['id']+'`\x0a')+(_0x34cdc2(0x1e0)+_0x23d423+'`\x0a')+(_0x34cdc2(0x246)+new Date(_0x16aa87[_0x34cdc2(0x1f0)])['toLocaleString']('en-US')+'\x0a');if(_0x16aa87[_0x34cdc2(0x1b6)]||_0x16aa87[_0x34cdc2(0x1e1)]||_0x16aa87[_0x34cdc2(0x1cc)]||_0x16aa87['customerIp']||_0x16aa87[_0x34cdc2(0x1bb)]){_0x2e1c05+=_0x34cdc2(0x21b);_0x16aa87[_0x34cdc2(0x1b6)]&&(_0x2e1c05+='📛\x20Name:\x20`'+_0x16aa87['customerName']+'`\x0a');_0x16aa87[_0x34cdc2(0x1e1)]&&(_0x2e1c05+='📧\x20Email:\x20`'+_0x16aa87[_0x34cdc2(0x1e1)]+'`\x0a');_0x16aa87[_0x34cdc2(0x1cc)]&&(_0x2e1c05+=_0x34cdc2(0x1f1)+_0x16aa87[_0x34cdc2(0x1cc)]+'`\x0a');_0x16aa87[_0x34cdc2(0x1dd)]&&(_0x2e1c05+=_0x34cdc2(0x22c)+_0x16aa87[_0x34cdc2(0x1dd)]+'`\x0a');if(_0x16aa87['customerUa']){const _0x38d7d8=_0x16aa87[_0x34cdc2(0x1bb)][_0x34cdc2(0x267)]>0x32?_0x16aa87[_0x34cdc2(0x1bb)][_0x34cdc2(0x227)](0x0,0x32)+'...':_0x16aa87['customerUa'];_0x2e1c05+=_0x34cdc2(0x279)+_0x38d7d8+'`\x0a';}}_0x4d4cf9===_0x34cdc2(0x26c)&&_0x16aa87[_0x34cdc2(0x287)]&&(_0x2e1c05+=_0x34cdc2(0x22b)+_0x16aa87[_0x34cdc2(0x287)]+_0x34cdc2(0x254)),_0x4d4cf9===_0x34cdc2(0x1c5)&&(_0x2e1c05+=_0x34cdc2(0x208)),_0x16aa87[_0x34cdc2(0x20c)]&&(_0x2e1c05+=_0x34cdc2(0x1ff)+_0x16aa87[_0x34cdc2(0x20c)]+'\x0a'),await this['sendShopNotification'](_0x49e91d,_0x2e1c05,{'parse_mode':_0x34cdc2(0x26e)});}async[a57_0x429f25(0x1fb)](_0x2d0f50,_0x37359c,_0x1b1fb7){const _0x35b147=a57_0x429f25,_0x59108e={'created':'📤','completed':'✅','rejected':'❌'},_0x4a03d0={'created':_0x35b147(0x218),'completed':_0x35b147(0x20e),'rejected':'Payout\x20rejected'},_0x3a6b10=_0x59108e[_0x1b1fb7],_0x2a9cdf=_0x4a03d0[_0x1b1fb7],_0xe3fea1=_0x3a6b10+'\x20*'+_0x2a9cdf+'*\x0a\x0a'+('💸\x20Amount:\x20*'+_0x37359c[_0x35b147(0x269)]+_0x35b147(0x1c9))+('🏦\x20Method:\x20`'+_0x37359c[_0x35b147(0x1bf)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x37359c['id']+'`\x0a')+(_0x35b147(0x246)+new Date(_0x37359c['createdAt'])[_0x35b147(0x22a)](_0x35b147(0x214))+'\x0a')+(_0x37359c[_0x35b147(0x1d5)]?_0x35b147(0x20d)+_0x37359c[_0x35b147(0x1d5)]+'`':'');await this[_0x35b147(0x1ce)](_0x2d0f50,_0xe3fea1,{'parse_mode':'Markdown'});}async[a57_0x429f25(0x283)](_0x55e9c8,_0x2fed0d){const _0x53e1e5=a57_0x429f25;try{const _0x4d986b=await database_1[_0x53e1e5(0x25d)]['shopSettings'][_0x53e1e5(0x21a)]({'where':{'shopId':_0x55e9c8},'select':{'notificationLogin':!![]}});if(!_0x4d986b?.[_0x53e1e5(0x1b4)]){console['log']('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x55e9c8);return;}const _0x48ec40=_0x2fed0d[_0x53e1e5(0x22d)]?'🔐':'🚨',_0x571715=_0x2fed0d['success']?_0x53e1e5(0x26a):_0x53e1e5(0x236);let _0x27b180=_0x48ec40+'\x20*'+_0x571715+_0x53e1e5(0x1c0)+(_0x53e1e5(0x200)+_0x2fed0d['username']+'`\x0a')+('📅\x20Time:\x20'+_0x2fed0d[_0x53e1e5(0x1ab)][_0x53e1e5(0x22a)](_0x53e1e5(0x214))+'\x0a');_0x2fed0d[_0x53e1e5(0x265)]&&(_0x27b180+=_0x53e1e5(0x206)+_0x2fed0d['ipAddress']+'`\x0a');if(_0x2fed0d['userAgent']){const _0x4e86c2=_0x2fed0d[_0x53e1e5(0x1ef)][_0x53e1e5(0x267)]>0x32?_0x2fed0d[_0x53e1e5(0x1ef)][_0x53e1e5(0x227)](0x0,0x32)+'...':_0x2fed0d[_0x53e1e5(0x1ef)];_0x27b180+=_0x53e1e5(0x279)+_0x4e86c2+'`\x0a';}!_0x2fed0d['success']&&(_0x27b180+=_0x53e1e5(0x1fe)),await this[_0x53e1e5(0x1ce)](_0x55e9c8,_0x27b180,{'parse_mode':_0x53e1e5(0x26e)}),console[_0x53e1e5(0x27c)](_0x53e1e5(0x202)+_0x55e9c8+':\x20'+(_0x2fed0d[_0x53e1e5(0x22d)]?_0x53e1e5(0x22d):_0x53e1e5(0x1da)));}catch(_0x801b81){console['error'](_0x53e1e5(0x229),_0x801b81);}}async[a57_0x429f25(0x217)](_0x3fcb6f,_0x453aa6){const _0x425486=a57_0x429f25;try{const _0x532222=await database_1[_0x425486(0x25d)][_0x425486(0x24a)][_0x425486(0x21a)]({'where':{'shopId':_0x3fcb6f},'select':{'notificationApiError':!![]}});if(!_0x532222?.[_0x425486(0x1b8)]){console[_0x425486(0x27c)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x3fcb6f);return;}let _0x4a0aae=_0x425486(0x1f9)+(_0x425486(0x23b)+_0x453aa6[_0x425486(0x1bf)]+'\x20'+_0x453aa6[_0x425486(0x285)]+'`\x0a')+(_0x425486(0x1db)+_0x453aa6[_0x425486(0x1ab)][_0x425486(0x22a)](_0x425486(0x214))+'\x0a');_0x453aa6[_0x425486(0x262)]&&(_0x4a0aae+=_0x425486(0x1ee)+_0x453aa6[_0x425486(0x262)]+'`\x0a'),_0x4a0aae+=_0x425486(0x1b2)+_0x453aa6[_0x425486(0x207)]+'`\x0a',_0x453aa6[_0x425486(0x1d1)]&&(_0x4a0aae+=_0x425486(0x23a)+_0x453aa6[_0x425486(0x1d1)]+'`\x0a'),_0x4a0aae+=_0x425486(0x219),await this[_0x425486(0x1ce)](_0x3fcb6f,_0x4a0aae,{'parse_mode':_0x425486(0x26e)}),console['log'](_0x425486(0x1ec)+_0x3fcb6f+':\x20'+_0x453aa6[_0x425486(0x285)]);}catch(_0xe5dd85){console[_0x425486(0x1ad)](_0x425486(0x1fc),_0xe5dd85);}}async[a57_0x429f25(0x288)](_0x261cc4,_0x46a77e,_0x15170f){const _0x4a3a6b=a57_0x429f25;let _0x3010ed=_0x4a3a6b(0x1e9)+_0x46a77e+'*\x0a\x0a';for(const [_0x2a3012,_0x501f49]of Object[_0x4a3a6b(0x270)](_0x15170f)){_0x501f49!==null&&_0x501f49!==undefined&&(_0x3010ed+=_0x2a3012+':\x20`'+_0x501f49+'`\x0a');}await this[_0x4a3a6b(0x1ce)](_0x261cc4,_0x3010ed,{'parse_mode':'Markdown'});}['getBotInfo'](){const _0x4faf6a=a57_0x429f25;return{'isActive':!!this[_0x4faf6a(0x216)],'username':this['botUsername']};}[a57_0x429f25(0x20b)](){const _0x4e156=a57_0x429f25;this[_0x4e156(0x216)]&&(this[_0x4e156(0x216)]['stopPolling'](),this['bot']=null,console[_0x4e156(0x27c)](_0x4e156(0x243)));}}exports['TelegramBotService']=TelegramBotService,exports[a57_0x429f25(0x284)]=new TelegramBotService();