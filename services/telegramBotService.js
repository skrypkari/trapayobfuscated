'use strict';const a52_0x124fa7=a52_0x5d95;function a52_0x5d95(_0x198e2d,_0x8e9ce2){const _0x14f21d=a52_0x14f2();return a52_0x5d95=function(_0x5d955b,_0x2f10d0){_0x5d955b=_0x5d955b-0x7d;let _0x2d343e=_0x14f21d[_0x5d955b];return _0x2d343e;},a52_0x5d95(_0x198e2d,_0x8e9ce2);}(function(_0x2567b5,_0x465246){const _0x551b53=a52_0x5d95,_0x3fb522=_0x2567b5();while(!![]){try{const _0x284528=-parseInt(_0x551b53(0xca))/0x1+-parseInt(_0x551b53(0x139))/0x2*(-parseInt(_0x551b53(0x91))/0x3)+-parseInt(_0x551b53(0x80))/0x4*(parseInt(_0x551b53(0xe7))/0x5)+-parseInt(_0x551b53(0x115))/0x6+parseInt(_0x551b53(0xbe))/0x7*(parseInt(_0x551b53(0x128))/0x8)+parseInt(_0x551b53(0x148))/0x9+parseInt(_0x551b53(0xb2))/0xa;if(_0x284528===_0x465246)break;else _0x3fb522['push'](_0x3fb522['shift']());}catch(_0x5d5d8b){_0x3fb522['push'](_0x3fb522['shift']());}}}(a52_0x14f2,0xd4bbb));var __importDefault=this&&this['__importDefault']||function(_0x5d9e62){const _0x2fba04=a52_0x5d95;return _0x5d9e62&&_0x5d9e62[_0x2fba04(0x13a)]?_0x5d9e62:{'default':_0x5d9e62};};Object[a52_0x124fa7(0xa7)](exports,'__esModule',{'value':!![]}),exports[a52_0x124fa7(0xd4)]=exports[a52_0x124fa7(0xbf)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a52_0x124fa7(0xa0))),gateway_1=require(a52_0x124fa7(0xb7));class TelegramBotService{constructor(){const _0x49fb0f=a52_0x124fa7;this[_0x49fb0f(0xa6)]=null,this[_0x49fb0f(0xe2)]=process['env'][_0x49fb0f(0x121)]||'',this[_0x49fb0f(0x9b)]=process[_0x49fb0f(0x109)][_0x49fb0f(0xc1)]||'trapay_bot',this[_0x49fb0f(0xe2)]?this[_0x49fb0f(0x100)]():console['warn'](_0x49fb0f(0x126));}[a52_0x124fa7(0x100)](){const _0xb7b72a=a52_0x124fa7;try{this[_0xb7b72a(0xa6)]=new node_telegram_bot_api_1[(_0xb7b72a(0xc9))](this[_0xb7b72a(0xe2)],{'polling':!![]}),this['setupBotHandlers'](),console[_0xb7b72a(0x135)](_0xb7b72a(0x7f)+this[_0xb7b72a(0x9b)]+_0xb7b72a(0xa8));}catch(_0x57f5c3){console[_0xb7b72a(0x108)](_0xb7b72a(0x155),_0x57f5c3);}}[a52_0x124fa7(0x13b)](){const _0x4df13b=a52_0x124fa7;if(!this[_0x4df13b(0xa6)])return;this['bot'][_0x4df13b(0x111)](/\/start/,async _0x1782c0=>{const _0x2eb743=_0x4df13b,_0x2f2522=_0x1782c0['chat']['id'],_0x2cc624=_0x1782c0['from']?.['id'][_0x2eb743(0x9f)](),_0x1b5b4f=_0x1782c0[_0x2eb743(0xf0)]?.[_0x2eb743(0x14e)],_0x2e0e4d=_0x1782c0[_0x2eb743(0xf0)]?.[_0x2eb743(0xc2)],_0x33d73d=_0x1782c0[_0x2eb743(0xf0)]?.[_0x2eb743(0x14b)];if(!_0x2cc624)return;try{let _0x5129f3=await database_1[_0x2eb743(0xc9)][_0x2eb743(0x133)]['findUnique']({'where':{'telegramId':_0x2cc624},'include':{'shop':!![]}});!_0x5129f3?(_0x5129f3=await database_1['default'][_0x2eb743(0x133)][_0x2eb743(0xac)]({'data':{'telegramId':_0x2cc624,'username':_0x1b5b4f,'firstName':_0x2e0e4d,'lastName':_0x33d73d,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x2eb743(0x118)+_0x2cc624+_0x2eb743(0x98)+_0x1b5b4f+')')):_0x5129f3=await database_1[_0x2eb743(0xc9)]['telegramUser'][_0x2eb743(0xd7)]({'where':{'telegramId':_0x2cc624},'data':{'username':_0x1b5b4f,'firstName':_0x2e0e4d,'lastName':_0x33d73d},'include':{'shop':!![]}}),_0x5129f3['isVerified']&&_0x5129f3[_0x2eb743(0xee)]&&_0x5129f3[_0x2eb743(0xd0)]?await this[_0x2eb743(0xa6)]?.[_0x2eb743(0xdb)](_0x2f2522,_0x2eb743(0xf2)+(_0x2eb743(0xc6)+_0x5129f3['shop']['name']+'*\x0a')+(_0x2eb743(0x159)+_0x5129f3[_0x2eb743(0xd0)][_0x2eb743(0x14e)]+_0x2eb743(0xb8))+_0x2eb743(0xde)+'•\x20New\x20payments\x0a'+_0x2eb743(0xc0)+_0x2eb743(0x154)+_0x2eb743(0xdf)+_0x2eb743(0x12e)+_0x2eb743(0x94),{'parse_mode':_0x2eb743(0xd8)}):(_0x5129f3['shopId']&&!_0x5129f3[_0x2eb743(0x131)]&&(await database_1[_0x2eb743(0xc9)][_0x2eb743(0x133)]['update']({'where':{'telegramId':_0x2cc624},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x2eb743(0x11b)+_0x2cc624)),await this[_0x2eb743(0xa6)]?.['sendMessage'](_0x2f2522,_0x2eb743(0x105)+_0x2eb743(0x10d)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x2eb743(0xe5)+_0x2eb743(0xf8)+_0x2eb743(0x102),{'parse_mode':_0x2eb743(0xd8)}));}catch(_0x17287e){console['error'](_0x2eb743(0x149),_0x17287e),await this['bot']?.['sendMessage'](_0x2f2522,_0x2eb743(0x119));}}),this['bot']['onText'](/\/disconnect/,async _0x51b640=>{const _0x23f72a=_0x4df13b,_0x22b498=_0x51b640[_0x23f72a(0xc3)]['id'],_0x36d146=_0x51b640[_0x23f72a(0xf0)]?.['id'][_0x23f72a(0x9f)]();if(!_0x36d146)return;try{const _0x57f636=await database_1['default'][_0x23f72a(0x133)][_0x23f72a(0xe4)]({'where':{'telegramId':_0x36d146},'include':{'shop':!![]}});if(!_0x57f636||!_0x57f636[_0x23f72a(0x131)]||!_0x57f636[_0x23f72a(0xee)]){await this['bot']?.['sendMessage'](_0x22b498,_0x23f72a(0x130));return;}const _0x714c50=_0x57f636[_0x23f72a(0xd0)]?.[_0x23f72a(0x95)]||_0x23f72a(0x127);await database_1['default'][_0x23f72a(0x133)][_0x23f72a(0xd7)]({'where':{'telegramId':_0x36d146},'data':{'shopId':null,'isVerified':![]}}),console[_0x23f72a(0x135)](_0x23f72a(0x123)+_0x36d146+_0x23f72a(0xe0)+_0x57f636[_0x23f72a(0xee)]),await this[_0x23f72a(0xa6)]?.['sendMessage'](_0x22b498,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x714c50+'*.\x0a\x0a'+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x23f72a(0xd8)});}catch(_0x3d0a44){console[_0x23f72a(0x108)](_0x23f72a(0x13c),_0x3d0a44),await this[_0x23f72a(0xa6)]?.[_0x23f72a(0xdb)](_0x22b498,_0x23f72a(0x119));}}),this[_0x4df13b(0xa6)][_0x4df13b(0x111)](/\/status/,async _0x5e3cdc=>{const _0x13110c=_0x4df13b,_0xa05dc3=_0x5e3cdc['chat']['id'],_0x142157=_0x5e3cdc['from']?.['id'][_0x13110c(0x9f)]();if(!_0x142157)return;try{const _0x5261d0=await database_1[_0x13110c(0xc9)][_0x13110c(0x133)][_0x13110c(0xe4)]({'where':{'telegramId':_0x142157},'include':{'shop':!![]}});if(!_0x5261d0){await this[_0x13110c(0xa6)]?.['sendMessage'](_0xa05dc3,_0x13110c(0xd2)+_0x13110c(0xa5));return;}if(!_0x5261d0['isVerified']||!_0x5261d0['shopId']||!_0x5261d0[_0x13110c(0xd0)]){await this[_0x13110c(0xa6)]?.[_0x13110c(0xdb)](_0xa05dc3,_0x13110c(0x15f)+_0x13110c(0x9e));return;}await this[_0x13110c(0xa6)]?.[_0x13110c(0xdb)](_0xa05dc3,_0x13110c(0x129)+(_0x13110c(0x15e)+_0x5261d0[_0x13110c(0xd0)][_0x13110c(0x95)]+'*\x0a')+(_0x13110c(0x83)+_0x5261d0['shop'][_0x13110c(0x14e)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x5261d0['updatedAt']['toLocaleDateString'](_0x13110c(0x12d))+'\x0a\x0a')+_0x13110c(0x136)+'Commands:\x0a'+_0x13110c(0x94),{'parse_mode':_0x13110c(0xd8)});}catch(_0x5aca5d){console['error'](_0x13110c(0x84),_0x5aca5d),await this['bot']?.[_0x13110c(0xdb)](_0xa05dc3,_0x13110c(0x119));}}),this['bot'][_0x4df13b(0x111)](/\/debug/,async _0x488e73=>{const _0x405c7b=_0x4df13b,_0x31e5e8=_0x488e73[_0x405c7b(0xc3)]['id'],_0x53b282=_0x488e73[_0x405c7b(0xf0)]?.['id']['toString']();if(!_0x53b282)return;try{const _0x22819f=await database_1['default'][_0x405c7b(0xd0)][_0x405c7b(0x12b)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x3c97d9=_0x405c7b(0xdd);_0x3c97d9+=_0x405c7b(0x8b)+_0x53b282+_0x405c7b(0xb8),_0x3c97d9+=_0x405c7b(0x10b),_0x22819f['forEach']((_0x3f196c,_0x24574e)=>{const _0x33a37d=_0x405c7b;_0x3c97d9+=_0x24574e+0x1+_0x33a37d(0xb6)+_0x3f196c[_0x33a37d(0x95)]+'*\x0a',_0x3c97d9+=_0x33a37d(0x96)+_0x3f196c['username']+'`\x0a',_0x3c97d9+=_0x33a37d(0x82)+_0x3f196c[_0x33a37d(0x85)]+'\x0a',_0x3c97d9+=_0x33a37d(0xaa)+_0x3f196c[_0x33a37d(0xb3)][_0x33a37d(0x117)](0x0,0xf)+_0x33a37d(0xe6);}),await this['bot']?.[_0x405c7b(0xdb)](_0x31e5e8,_0x3c97d9,{'parse_mode':_0x405c7b(0xd8)});}catch(_0x11ad03){console[_0x405c7b(0x108)](_0x405c7b(0xba),_0x11ad03),await this[_0x405c7b(0xa6)]?.[_0x405c7b(0xdb)](_0x31e5e8,_0x405c7b(0x15a));}}),this[_0x4df13b(0xa6)]['on'](_0x4df13b(0x103),async _0x10a0b8=>{const _0x26cee3=_0x4df13b;if(_0x10a0b8['text']?.['startsWith']('/'))return;const _0x425330=_0x10a0b8[_0x26cee3(0xc3)]['id'],_0x406564=_0x10a0b8[_0x26cee3(0xf0)]?.['id'][_0x26cee3(0x9f)](),_0x214917=_0x10a0b8[_0x26cee3(0xf3)]?.[_0x26cee3(0xd3)]();if(!_0x406564||!_0x214917)return;try{const _0x151997=await database_1['default'][_0x26cee3(0x133)][_0x26cee3(0xe4)]({'where':{'telegramId':_0x406564},'include':{'shop':!![]}});if(!_0x151997){await this[_0x26cee3(0xa6)]?.[_0x26cee3(0xdb)](_0x425330,_0x26cee3(0x120));return;}if(_0x151997['isVerified']&&_0x151997[_0x26cee3(0xee)]&&_0x151997['shop']){await this['bot']?.[_0x26cee3(0xdb)](_0x425330,_0x26cee3(0xf7)+_0x151997['shop'][_0x26cee3(0x95)]+_0x26cee3(0x8e)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x26cee3(0xd8)});return;}const _0x3ef140=_0x214917[_0x26cee3(0x9d)](/\s+/);if(_0x3ef140[_0x26cee3(0xc8)]!==0x2){await this[_0x26cee3(0xa6)]?.[_0x26cee3(0xdb)](_0x425330,_0x26cee3(0xa2)+_0x26cee3(0x89)+'Example:\x0a'+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x26cee3(0x140)+_0x3ef140[_0x26cee3(0xc8)]+_0x26cee3(0x14d)+_0x3ef140['map'](_0x3d8605=>'`'+_0x3d8605+'`')[_0x26cee3(0xd1)](',\x20')),{'parse_mode':_0x26cee3(0xd8)});return;}const [_0x22399b,_0x32f25c]=_0x3ef140;console[_0x26cee3(0x135)](_0x26cee3(0x14a)+_0x406564+_0x26cee3(0x12c)+_0x22399b+_0x26cee3(0x88)+_0x32f25c['substring'](0x0,0xa)+'...\x22'),await this[_0x26cee3(0x93)](_0x425330,_0x406564,_0x22399b,_0x32f25c);}catch(_0x3b701f){console[_0x26cee3(0x108)](_0x26cee3(0x156),_0x3b701f),await this[_0x26cee3(0xa6)]?.[_0x26cee3(0xdb)](_0x425330,_0x26cee3(0x119));}}),this['bot']['on'](_0x4df13b(0x108),_0x2d646f=>{const _0x123769=_0x4df13b;console['error'](_0x123769(0x7e),_0x2d646f);}),this['bot']['on'](_0x4df13b(0xbb),_0x3c4d46=>{const _0x53a784=_0x4df13b;console['error'](_0x53a784(0xb5),_0x3c4d46);});}async[a52_0x124fa7(0x93)](_0x3b288c,_0x44baca,_0x508e3,_0x241b0b){const _0x117c5e=a52_0x124fa7;try{console[_0x117c5e(0x135)](_0x117c5e(0x14a)+_0x44baca+_0x117c5e(0x12c)+_0x508e3+'\x22,\x20apiKey=\x22'+_0x241b0b[_0x117c5e(0x117)](0x0,0xa)+_0x117c5e(0x13e));if(!_0x508e3||_0x508e3[_0x117c5e(0xc8)]<0x3||_0x508e3['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x117c5e(0xfd)](_0x508e3)){await this[_0x117c5e(0xa6)]?.[_0x117c5e(0xdb)](_0x3b288c,'❌\x20Invalid\x20username\x20format:\x20`'+_0x508e3+_0x117c5e(0xb8)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':'Markdown'});return;}if(!_0x241b0b||!_0x241b0b[_0x117c5e(0x11f)](_0x117c5e(0x158))&&!_0x241b0b[_0x117c5e(0x11f)](_0x117c5e(0x12a))){await this[_0x117c5e(0xa6)]?.[_0x117c5e(0xdb)](_0x3b288c,_0x117c5e(0x81)+_0x117c5e(0xcd),{'parse_mode':_0x117c5e(0xd8)});return;}const _0x34e392=await database_1[_0x117c5e(0xc9)][_0x117c5e(0xd0)]['findUnique']({'where':{'username':_0x508e3},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x34e392){const _0x37ef45=await database_1[_0x117c5e(0xc9)][_0x117c5e(0xd0)][_0x117c5e(0x12b)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x41895a='❌\x20Shop\x20with\x20username\x20`'+_0x508e3+'`\x20not\x20found.\x0a\x0a';_0x37ef45[_0x117c5e(0xc8)]>0x0?(_0x41895a+=_0x117c5e(0x107),_0x37ef45[_0x117c5e(0xcf)](_0x55faf1=>{const _0xc3d0c5=_0x117c5e;_0x41895a+='•\x20`'+_0x55faf1['username']+'`\x20('+_0x55faf1[_0xc3d0c5(0x95)]+')\x0a';}),_0x41895a+=_0x117c5e(0x137)):_0x41895a+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x117c5e(0xa6)]?.[_0x117c5e(0xdb)](_0x3b288c,_0x41895a,{'parse_mode':'Markdown'});return;}if(_0x34e392[_0x117c5e(0x85)]!=='ACTIVE'){await this[_0x117c5e(0xa6)]?.['sendMessage'](_0x3b288c,'❌\x20Shop\x20`'+_0x508e3+_0x117c5e(0x8c)+_0x117c5e(0xef),{'parse_mode':_0x117c5e(0xd8)});return;}if(_0x34e392[_0x117c5e(0xb3)]!==_0x241b0b&&_0x34e392[_0x117c5e(0x112)]!==_0x241b0b){await this['bot']?.['sendMessage'](_0x3b288c,_0x117c5e(0xa9)+_0x508e3+_0x117c5e(0x144)+_0x117c5e(0x116)+_0x117c5e(0xf6),{'parse_mode':_0x117c5e(0xd8)});return;}const _0x5c54ee=await database_1['default'][_0x117c5e(0x133)]['findFirst']({'where':{'shopId':_0x34e392['id'],'isVerified':!![],'telegramId':{'not':_0x44baca}}});if(_0x5c54ee){await this[_0x117c5e(0xa6)]?.[_0x117c5e(0xdb)](_0x3b288c,_0x117c5e(0xe3)+_0x508e3+_0x117c5e(0x144)+_0x117c5e(0x13f),{'parse_mode':_0x117c5e(0xd8)});return;}await database_1[_0x117c5e(0xc9)]['telegramUser']['update']({'where':{'telegramId':_0x44baca},'data':{'shopId':_0x34e392['id'],'isVerified':!![]}}),await this[_0x117c5e(0xa6)]?.[_0x117c5e(0xdb)](_0x3b288c,_0x117c5e(0x141)+_0x117c5e(0xb1)+(_0x117c5e(0xab)+_0x34e392[_0x117c5e(0x95)]+'*\x0a')+(_0x117c5e(0x83)+_0x34e392[_0x117c5e(0x14e)]+_0x117c5e(0xb8))+_0x117c5e(0x10e)+_0x117c5e(0x15d)+'•\x20Payment\x20status\x20changes\x0a'+_0x117c5e(0x151)+_0x117c5e(0x125)+_0x117c5e(0xdf)+_0x117c5e(0x12e)+_0x117c5e(0x94),{'parse_mode':_0x117c5e(0xd8)}),console['log'](_0x117c5e(0xcc)+_0x44baca+_0x117c5e(0x146)+_0x34e392[_0x117c5e(0x14e)]+_0x117c5e(0x122));}catch(_0xf32d36){console['error'](_0x117c5e(0xbc),_0xf32d36),await this['bot']?.['sendMessage'](_0x3b288c,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a52_0x124fa7(0xe1)](_0x1f3cb9,_0x10017b,_0x4c3261){const _0x2937cd=a52_0x124fa7;if(!this[_0x2937cd(0xa6)]){console[_0x2937cd(0xda)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0xce47d1=await database_1[_0x2937cd(0xc9)][_0x2937cd(0x133)][_0x2937cd(0x12b)]({'where':{'shopId':_0x1f3cb9,'isVerified':!![]}});if(_0xce47d1[_0x2937cd(0xc8)]===0x0){console[_0x2937cd(0x135)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x1f3cb9);return;}const _0x4b2721=_0xce47d1[_0x2937cd(0xf1)](async _0x17a44f=>{const _0x26d567=_0x2937cd;try{await this[_0x26d567(0xa6)]?.[_0x26d567(0xdb)](_0x17a44f['telegramId'],_0x10017b,_0x4c3261),console[_0x26d567(0x135)](_0x26d567(0xce)+_0x17a44f[_0x26d567(0xc4)]);}catch(_0x1cb9b9){console[_0x26d567(0x108)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x17a44f[_0x26d567(0xc4)]+':',_0x1cb9b9),_0x1cb9b9 instanceof Error&&(_0x1cb9b9['message'][_0x26d567(0x13d)](_0x26d567(0x11d))||_0x1cb9b9[_0x26d567(0x103)]['includes'](_0x26d567(0xa3))||_0x1cb9b9[_0x26d567(0x103)][_0x26d567(0x13d)](_0x26d567(0x10c)))&&(await database_1[_0x26d567(0xc9)]['telegramUser']['update']({'where':{'id':_0x17a44f['id']},'data':{'isVerified':![]}}),console[_0x26d567(0x135)](_0x26d567(0xea)+_0x17a44f['telegramId']+_0x26d567(0xa1)));}});await Promise[_0x2937cd(0x12f)](_0x4b2721);}catch(_0x32b5b4){console['error']('Error\x20sending\x20shop\x20notification:',_0x32b5b4);}}async['sendPaymentNotification'](_0x5b8b93,_0x3200ff,_0x5f4c6d){const _0x1e1006=a52_0x124fa7,_0x357577={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x392131={'created':_0x1e1006(0xcb),'paid':'Payment\x20successfully\x20paid','failed':_0x1e1006(0x145),'expired':_0x1e1006(0xb0),'refund':_0x1e1006(0xed),'chargeback':'Payment\x20chargeback','processing':'Payment\x20is\x20being\x20processed'},_0x4902a6=_0x357577[_0x5f4c6d],_0x29fe09=_0x392131[_0x5f4c6d],_0x1f8f82=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x3200ff[_0x1e1006(0x90)]);console[_0x1e1006(0x135)](_0x1e1006(0xe8)+_0x3200ff['gateway']+'\x22\x20->\x20display\x20\x22'+_0x1f8f82+'\x22');let _0x56ff99=_0x4902a6+'\x20*'+_0x29fe09+_0x1e1006(0x142)+(_0x1e1006(0xdc)+_0x3200ff[_0x1e1006(0x10f)]+'\x20'+_0x3200ff[_0x1e1006(0xf4)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x3200ff['orderId']||_0x3200ff['id'])+'`\x0a')+(_0x1e1006(0x15c)+_0x3200ff['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x1f8f82+'`\x0a')+(_0x1e1006(0x101)+new Date(_0x3200ff['createdAt'])[_0x1e1006(0xad)](_0x1e1006(0x12d))+'\x0a');(_0x3200ff[_0x1e1006(0xa4)]||_0x3200ff[_0x1e1006(0x8a)])&&(_0x56ff99+=_0x1e1006(0x9a),_0x3200ff['customerName']&&(_0x56ff99+=_0x1e1006(0x86)+_0x3200ff[_0x1e1006(0xa4)]+'`\x0a'),_0x3200ff[_0x1e1006(0x8a)]&&(_0x56ff99+=_0x1e1006(0xc5)+_0x3200ff[_0x1e1006(0x8a)]+'`\x0a')),_0x5f4c6d===_0x1e1006(0x8f)&&_0x3200ff[_0x1e1006(0x11a)]&&(_0x56ff99+=_0x1e1006(0xc7)+_0x3200ff[_0x1e1006(0x11a)]+_0x1e1006(0x113)),_0x5f4c6d==='processing'&&(_0x56ff99+=_0x1e1006(0xf9)),_0x3200ff['adminNotes']&&(_0x56ff99+=_0x1e1006(0xec)+_0x3200ff[_0x1e1006(0x11e)]+'\x0a'),await this[_0x1e1006(0xe1)](_0x5b8b93,_0x56ff99,{'parse_mode':'Markdown'});}async[a52_0x124fa7(0x124)](_0x59aa55,_0x1b09b3,_0x1913c9){const _0x329cb=a52_0x124fa7,_0x5ac240={'created':'📤','completed':'✅','rejected':'❌'},_0x551f7d={'created':_0x329cb(0x157),'completed':_0x329cb(0x9c),'rejected':_0x329cb(0xe9)},_0xb0e791=_0x5ac240[_0x1913c9],_0x3fd486=_0x551f7d[_0x1913c9],_0x194e8=_0xb0e791+'\x20*'+_0x3fd486+'*\x0a\x0a'+(_0x329cb(0x7d)+_0x1b09b3['amount']+_0x329cb(0xfe))+(_0x329cb(0xfc)+_0x1b09b3['method']+'`\x0a')+(_0x329cb(0xeb)+_0x1b09b3['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x1b09b3[_0x329cb(0xfb)])[_0x329cb(0xad)](_0x329cb(0x12d))+'\x0a')+(_0x1b09b3[_0x329cb(0x87)]?_0x329cb(0x152)+_0x1b09b3[_0x329cb(0x87)]+'`':'');await this['sendShopNotification'](_0x59aa55,_0x194e8,{'parse_mode':_0x329cb(0xd8)});}async['sendLoginNotification'](_0x28ed1b,_0x243762){const _0x297e73=a52_0x124fa7;try{const _0x5b06b7=await database_1[_0x297e73(0xc9)]['shopSettings']['findUnique']({'where':{'shopId':_0x28ed1b},'select':{'notificationLogin':!![]}});if(!_0x5b06b7?.[_0x297e73(0xfa)]){console[_0x297e73(0x135)](_0x297e73(0x138)+_0x28ed1b);return;}const _0x12821e=_0x243762['success']?'🔐':'🚨',_0x2440bf=_0x243762['success']?_0x297e73(0x134):_0x297e73(0x104);let _0x175047=_0x12821e+'\x20*'+_0x2440bf+_0x297e73(0x142)+(_0x297e73(0x83)+_0x243762['username']+'`\x0a')+(_0x297e73(0xaf)+_0x243762[_0x297e73(0x132)]['toLocaleString']('en-US')+'\x0a');_0x243762[_0x297e73(0x14f)]&&(_0x175047+=_0x297e73(0x150)+_0x243762[_0x297e73(0x14f)]+'`\x0a');if(_0x243762[_0x297e73(0xae)]){const _0x1e0763=_0x243762[_0x297e73(0xae)]['length']>0x32?_0x243762['userAgent']['substring'](0x0,0x32)+_0x297e73(0x143):_0x243762[_0x297e73(0xae)];_0x175047+='💻\x20Browser:\x20`'+_0x1e0763+'`\x0a';}!_0x243762[_0x297e73(0x14c)]&&(_0x175047+=_0x297e73(0x15b)),await this[_0x297e73(0xe1)](_0x28ed1b,_0x175047,{'parse_mode':_0x297e73(0xd8)}),console[_0x297e73(0x135)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x28ed1b+':\x20'+(_0x243762[_0x297e73(0x14c)]?_0x297e73(0x14c):_0x297e73(0xbd)));}catch(_0x30a1ca){console[_0x297e73(0x108)](_0x297e73(0xd5),_0x30a1ca);}}async[a52_0x124fa7(0x110)](_0x1f2111,_0x343889){const _0x25106c=a52_0x124fa7;try{const _0x12ec1d=await database_1[_0x25106c(0xc9)][_0x25106c(0x97)][_0x25106c(0xe4)]({'where':{'shopId':_0x1f2111},'select':{'notificationApiError':!![]}});if(!_0x12ec1d?.[_0x25106c(0x106)]){console[_0x25106c(0x135)](_0x25106c(0xd6)+_0x1f2111);return;}let _0x2663e8='🚨\x20*API\x20Error*\x0a\x0a'+(_0x25106c(0x147)+_0x343889[_0x25106c(0x153)]+'\x20'+_0x343889['endpoint']+'`\x0a')+(_0x25106c(0xaf)+_0x343889[_0x25106c(0x132)][_0x25106c(0xad)]('en-US')+'\x0a');_0x343889[_0x25106c(0x10a)]&&(_0x2663e8+=_0x25106c(0xf5)+_0x343889[_0x25106c(0x10a)]+'`\x0a'),_0x2663e8+='❌\x20Error:\x20`'+_0x343889['errorMessage']+'`\x0a',_0x343889[_0x25106c(0x8d)]&&(_0x2663e8+=_0x25106c(0x99)+_0x343889[_0x25106c(0x8d)]+'`\x0a'),_0x2663e8+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x25106c(0xe1)](_0x1f2111,_0x2663e8,{'parse_mode':_0x25106c(0xd8)}),console[_0x25106c(0x135)](_0x25106c(0xb9)+_0x1f2111+':\x20'+_0x343889['endpoint']);}catch(_0xecb737){console[_0x25106c(0x108)](_0x25106c(0xd9),_0xecb737);}}async['sendCustomNotification'](_0x2bb638,_0x150611,_0x16fa37){const _0x834c07=a52_0x124fa7;let _0x400408=_0x834c07(0x114)+_0x150611+'*\x0a\x0a';for(const [_0x58654b,_0x595333]of Object['entries'](_0x16fa37)){_0x595333!==null&&_0x595333!==undefined&&(_0x400408+=_0x58654b+_0x834c07(0x11c)+_0x595333+'`\x0a');}await this['sendShopNotification'](_0x2bb638,_0x400408,{'parse_mode':_0x834c07(0xd8)});}[a52_0x124fa7(0xb4)](){return{'isActive':!!this['bot'],'username':this['botUsername']};}['stopBot'](){const _0x3f06da=a52_0x124fa7;this[_0x3f06da(0xa6)]&&(this[_0x3f06da(0xa6)][_0x3f06da(0xff)](),this[_0x3f06da(0xa6)]=null,console['log'](_0x3f06da(0x92)));}}function a52_0x14f2(){const _0x5c2ae3=['requestId','*.\x0a\x0a','chargeback','gateway','3HkNAem','🛑\x20Telegram\x20bot\x20stopped','handleSingleLineVerification','/disconnect\x20-\x20disconnect\x20from\x20notifications','name','\x20\x20\x20Username:\x20`','shopSettings','\x20(@','🆔\x20Request\x20ID:\x20`','\x0a👤\x20*Customer\x20Information:*\x0a','botUsername','Payout\x20completed','split','Use\x20/start\x20to\x20connect.','toString','../config/database','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','chat\x20not\x20found','customerName','Use\x20/start\x20to\x20begin.','bot','defineProperty','\x20initialized\x20successfully','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','\x20\x20\x20Public\x20Key:\x20`','📱\x20Shop:\x20*','create','toLocaleString','userAgent','📅\x20Time:\x20','Payment\x20expired','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','2060930inWAJD','publicKey','getBotInfo','Telegram\x20bot\x20polling\x20error:','.\x20*','../types/gateway','`\x0a\x0a','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','Error\x20handling\x20/debug\x20command:','polling_error','Error\x20in\x20handleSingleLineVerification:','failed','140qfZqdk','TelegramBotService','•\x20Payment\x20status\x20changes\x0a','TELEGRAM_BOT_USERNAME','first_name','chat','telegramId','📧\x20Email:\x20`','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','💸\x20Penalty\x20amount:\x20*','length','default','591090ZUPQWt','New\x20payment\x20created','✅\x20Telegram\x20user\x20','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','forEach','shop','join','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','trim','telegramBotService','Failed\x20to\x20send\x20login\x20notification:','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','update','Markdown','Failed\x20to\x20send\x20API\x20error\x20notification:','warn','sendMessage','💰\x20Amount:\x20*','🔍\x20*Debug\x20Information*\x0a\x0a','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Commands:\x0a','\x20disconnected\x20from\x20shop\x20','sendShopNotification','botToken','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','findUnique','Example:\x0a','...`\x0a\x0a','4305TvrPrj','📱\x20Telegram\x20notification:\x20gateway\x20\x22','Payout\x20rejected','User\x20','🆔\x20Payout\x20ID:\x20`','📝\x20Notes:\x20','Payment\x20refund','shopId','Contact\x20administrator.','from','map','✅\x20Welcome\x20back!\x0a\x0a','text','currency','📊\x20Error\x20code:\x20`','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','notificationLogin','createdAt','🏦\x20Method:\x20`','test','\x20USD*\x0a','stopPolling','initializeBot','📅\x20Date:\x20','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','message','Failed\x20login\x20attempt','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','notificationApiError','Available\x20usernames:\x0a','error','env','statusCode','🏪\x20Available\x20shops\x20in\x20system:\x0a','user\x20is\x20deactivated','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','amount','sendApiErrorNotification','onText','secretKey','\x20USDT*\x0a','🔔\x20*','2513568qcTpyG','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','substring','📱\x20Created\x20new\x20Telegram\x20user:\x20','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','chargebackAmount','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20',':\x20`','blocked','adminNotes','startsWith','❌\x20Please\x20use\x20/start\x20command\x20first','TELEGRAM_BOT_TOKEN','\x20via\x20single-line\x20input','🔌\x20User\x20','sendPayoutNotification','•\x20Important\x20events\x0a\x0a','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','unknown\x20shop','201080sCpAEv','📊\x20*Connection\x20Status*\x0a\x0a','sk_','findMany',':\x20username=\x22','en-US','/status\x20-\x20check\x20connection\x20status\x0a','allSettled','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','isVerified','timestamp','telegramUser','Successful\x20login','log','🔔\x20Notifications\x20are\x20active\x0a\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','946916uVMKLo','__esModule','setupBotHandlers','Error\x20handling\x20/disconnect\x20command:','includes','...\x22','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','You\x20sent\x20','🎉\x20*Congratulations!*\x0a\x0a','*\x0a\x0a','...','`.\x0a\x0a','Payment\x20failed','\x20verified\x20for\x20shop\x20','🔗\x20Endpoint:\x20`','10995741aHaJsY','Error\x20handling\x20/start\x20command:','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','last_name','success','\x20parts:\x20','username','ipAddress','🌐\x20IP\x20address:\x20`','•\x20Payouts\x0a','🔗\x20TXID:\x20`','method','•\x20Payouts\x0a\x0a','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','Error\x20handling\x20message:','New\x20payout\x20created','pk_','Username:\x20`','❌\x20Error\x20getting\x20debug\x20information.','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','🆔\x20Payment\x20ID:\x20`','•\x20New\x20payments\x0a','✅\x20Connected\x20to\x20shop:\x20*','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','💸\x20Amount:\x20*','Telegram\x20bot\x20error:','✅\x20Telegram\x20bot\x20@','2428afPJoZ','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','\x20\x20\x20Status:\x20','👤\x20Username:\x20`','Error\x20handling\x20/status\x20command:','status','📛\x20Name:\x20`','txid','\x22,\x20apiKey=\x22','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','customerEmail','📱\x20Your\x20Telegram\x20ID:\x20`','`\x20is\x20inactive.\x0a\x0a'];a52_0x14f2=function(){return _0x5c2ae3;};return a52_0x14f2();}exports['TelegramBotService']=TelegramBotService,exports[a52_0x124fa7(0xd4)]=new TelegramBotService();