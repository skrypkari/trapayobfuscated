'use strict';const a55_0x1502f4=a55_0x1cee;(function(_0x172d17,_0xbabd30){const _0x1eb444=a55_0x1cee,_0xc48d7e=_0x172d17();while(!![]){try{const _0x2d2283=parseInt(_0x1eb444(0x9a))/0x1+-parseInt(_0x1eb444(0x79))/0x2*(-parseInt(_0x1eb444(0xa7))/0x3)+parseInt(_0x1eb444(0xf9))/0x4*(-parseInt(_0x1eb444(0x7c))/0x5)+parseInt(_0x1eb444(0x9c))/0x6+-parseInt(_0x1eb444(0x130))/0x7+parseInt(_0x1eb444(0x11c))/0x8*(-parseInt(_0x1eb444(0xfb))/0x9)+parseInt(_0x1eb444(0xbb))/0xa*(parseInt(_0x1eb444(0x9e))/0xb);if(_0x2d2283===_0xbabd30)break;else _0xc48d7e['push'](_0xc48d7e['shift']());}catch(_0x4c05fd){_0xc48d7e['push'](_0xc48d7e['shift']());}}}(a55_0x2654,0x5283d));var __importDefault=this&&this[a55_0x1502f4(0xf8)]||function(_0x466260){const _0x3bacfa=a55_0x1502f4;return _0x466260&&_0x466260[_0x3bacfa(0xdf)]?_0x466260:{'default':_0x466260};};function a55_0x2654(){const _0x10722b=['\x20USDT*\x0a','botToken','TELEGRAM_BOT_USERNAME','*.\x0a\x0a','Use\x20/start\x20to\x20begin.','3702279YtnuHY','create','trapay_bot','message','customerName','toLocaleDateString','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','\x20\x20\x20Username:\x20`','New\x20payout\x20created','User\x20','en-US','📝\x20Order\x20ID:\x20`','last_name','`\x20not\x20found.\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','substring','pk_','Error\x20sending\x20shop\x20notification:','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','split','👤\x20Username:\x20`','•\x20`','Payment\x20successfully\x20paid','notificationLogin','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','🔗\x20Endpoint:\x20`','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','\x20verified\x20for\x20shop\x20','secretKey','sendLoginNotification','🆔\x20Request\x20ID:\x20`','chat','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','Payment\x20expired','success','findFirst','🛑\x20Telegram\x20bot\x20stopped','notificationApiError','username','updatedAt','✅\x20Connected\x20to\x20shop:\x20*','method','includes','💻\x20Browser:\x20`','timestamp','🚨\x20*API\x20Error*\x0a\x0a','•\x20Important\x20events\x0a\x0a','Error\x20handling\x20/status\x20command:','\x20disconnected\x20from\x20shop\x20','Failed\x20login\x20attempt','❌\x20Invalid\x20username\x20format:\x20`','🔍\x20*Debug\x20Information*\x0a\x0a','26866KsxLyE','sk_','botUsername','1075765LZckKo','💰\x20Amount:\x20*','New\x20payment\x20created','Contact\x20administrator.','Telegram\x20bot\x20polling\x20error:','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','bot','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','shopSettings','📱\x20Your\x20Telegram\x20ID:\x20`',':\x20username=\x22','test','To\x20reconnect,\x20use\x20the\x20/start\x20command','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Use\x20/start\x20to\x20connect.','📛\x20Name:\x20`','Error\x20in\x20handleSingleLineVerification:','toString','toLocaleString','stopPolling','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','error','default','blocked','\x20via\x20single-line\x20input','/disconnect\x20-\x20disconnect\x20from\x20notifications','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','adminNotes','allSettled','255819PWACRJ','customerEmail','911610SpDhaS','handleSingleLineVerification','193699HKQFsC','isVerified','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','customerIp','startsWith','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','shop','shopId','📧\x20Email:\x20`','33waecHQ','sendApiErrorNotification','Available\x20usernames:\x0a','\x20\x20\x20Public\x20Key:\x20`','🔌\x20User\x20','gateway','...\x22','createdAt','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','❌\x20Error:\x20`','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','findUnique','📱\x20Shop:\x20*','Payment\x20is\x20being\x20processed','map','sendPaymentNotification','Payment\x20refund','customerUa','\x22,\x20apiKey=\x22','length','590WNERme','...','🏪\x20Available\x20shops\x20in\x20system:\x0a','update','getBotInfo','sendMessage','defineProperty','Markdown','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','telegramBotService','🎉\x20*Congratulations!*\x0a\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','join','errorMessage','../types/gateway','Failed\x20to\x20send\x20login\x20notification:','warn','`\x20is\x20inactive.\x0a\x0a','❌\x20Shop\x20with\x20username\x20`','text','📅\x20Connection\x20date:\x20','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','/status\x20-\x20check\x20connection\x20status\x0a','🏦\x20Method:\x20`','Username:\x20`','\x22\x20->\x20display\x20\x22','initializeBot','🌐\x20IP:\x20`','Error\x20handling\x20/start\x20command:','•\x20Payouts\x0a\x0a','🔗\x20TXID:\x20`','Payout\x20completed','\x0aCheck\x20spelling\x20and\x20try\x20again.','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','`\x20(','getGatewayDisplayNameForTelegram','__esModule','telegramUser','💸\x20Penalty\x20amount:\x20*','🆔\x20Payout\x20ID:\x20`','•\x20Payment\x20status\x20changes\x0a','chargeback','📱\x20Created\x20new\x20Telegram\x20user:\x20','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','stopBot','🔔\x20Notifications\x20are\x20active\x0a\x0a','TelegramBotService','•\x20Payouts\x0a','sendCustomNotification','endpoint','trim','polling_error','🌐\x20IP\x20address:\x20`','findMany','node-telegram-bot-api','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','user\x20is\x20deactivated','sendShopNotification','onText','Commands:\x0a','__importDefault','4SZHFDp','Payment\x20failed','207XuXMDF','forEach','...`\x0a\x0a','Example:\x0a','name','requestId','log','sendPayoutNotification','\x0a👤\x20*Customer\x20Information:*\x0a','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','`\x0a\x0a','\x20initialized\x20successfully','env','`.\x0a\x0a','ACTIVE','txid','first_name','*\x0a\x0a','📅\x20Time:\x20','status','✅\x20Telegram\x20bot\x20@','chargebackAmount','Failed\x20to\x20send\x20API\x20error\x20notification:','currency','failed','telegramId','❌\x20Please\x20use\x20/start\x20command\x20first','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','statusCode','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','📅\x20Date:\x20','from','📝\x20Notes:\x20','178232HbKOsd','entries','Payment\x20chargeback','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','🏪\x20Gateway:\x20`','Error\x20handling\x20/debug\x20command:','amount','Error\x20handling\x20message:','remitterIban','userAgent','Check\x20spelling\x20and\x20try\x20again.','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','❌\x20Shop\x20`','setupBotHandlers','\x20(@'];a55_0x2654=function(){return _0x10722b;};return a55_0x2654();}Object[a55_0x1502f4(0xc1)](exports,a55_0x1502f4(0xdf),{'value':!![]}),exports[a55_0x1502f4(0xc4)]=exports[a55_0x1502f4(0xe9)]=void 0x0;function a55_0x1cee(_0x561b80,_0x9d0cc9){const _0x265496=a55_0x2654();return a55_0x1cee=function(_0x1cee05,_0x116b5a){_0x1cee05=_0x1cee05-0x66;let _0x2d4a1e=_0x265496[_0x1cee05];return _0x2d4a1e;},a55_0x1cee(_0x561b80,_0x9d0cc9);}const node_telegram_bot_api_1=__importDefault(require(a55_0x1502f4(0xf1))),database_1=__importDefault(require('../config/database')),gateway_1=require(a55_0x1502f4(0xc9));class TelegramBotService{constructor(){const _0x312972=a55_0x1502f4;this[_0x312972(0x82)]=null,this[_0x312972(0x12c)]=process[_0x312972(0x107)]['TELEGRAM_BOT_TOKEN']||'',this[_0x312972(0x7b)]=process['env'][_0x312972(0x12d)]||_0x312972(0x132),this[_0x312972(0x12c)]?this['initializeBot']():console[_0x312972(0xcb)](_0x312972(0x81));}[a55_0x1502f4(0xd5)](){const _0x5d68cd=a55_0x1502f4;try{this[_0x5d68cd(0x82)]=new node_telegram_bot_api_1[(_0x5d68cd(0x93))](this[_0x5d68cd(0x12c)],{'polling':!![]}),this[_0x5d68cd(0x129)](),console[_0x5d68cd(0x101)](_0x5d68cd(0x10f)+this['botUsername']+_0x5d68cd(0x106));}catch(_0x4752ff){console[_0x5d68cd(0x92)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x4752ff);}}[a55_0x1502f4(0x129)](){const _0x1f83ac=a55_0x1502f4;if(!this[_0x1f83ac(0x82)])return;this[_0x1f83ac(0x82)][_0x1f83ac(0xf6)](/\/start/,async _0x25d550=>{const _0x26d5f5=_0x1f83ac,_0x2b295b=_0x25d550['chat']['id'],_0x5a4cd7=_0x25d550[_0x26d5f5(0x11a)]?.['id'][_0x26d5f5(0x8e)](),_0x5e7cae=_0x25d550[_0x26d5f5(0x11a)]?.['username'],_0x1b242d=_0x25d550[_0x26d5f5(0x11a)]?.[_0x26d5f5(0x10b)],_0x5b6a59=_0x25d550[_0x26d5f5(0x11a)]?.[_0x26d5f5(0x13d)];if(!_0x5a4cd7)return;try{let _0x2cbc4a=await database_1['default']['telegramUser'][_0x26d5f5(0xb2)]({'where':{'telegramId':_0x5a4cd7},'include':{'shop':!![]}});!_0x2cbc4a?(_0x2cbc4a=await database_1[_0x26d5f5(0x93)][_0x26d5f5(0xe0)][_0x26d5f5(0x131)]({'data':{'telegramId':_0x5a4cd7,'username':_0x5e7cae,'firstName':_0x1b242d,'lastName':_0x5b6a59,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x26d5f5(0xe5)+_0x5a4cd7+_0x26d5f5(0x12a)+_0x5e7cae+')')):_0x2cbc4a=await database_1[_0x26d5f5(0x93)]['telegramUser'][_0x26d5f5(0xbe)]({'where':{'telegramId':_0x5a4cd7},'data':{'username':_0x5e7cae,'firstName':_0x1b242d,'lastName':_0x5b6a59},'include':{'shop':!![]}}),_0x2cbc4a[_0x26d5f5(0x9f)]&&_0x2cbc4a['shopId']&&_0x2cbc4a[_0x26d5f5(0xa4)]?await this[_0x26d5f5(0x82)]?.[_0x26d5f5(0xc0)](_0x2b295b,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x26d5f5(0x127)+_0x2cbc4a[_0x26d5f5(0xa4)][_0x26d5f5(0xff)]+'*\x0a')+(_0x26d5f5(0xd3)+_0x2cbc4a['shop']['username']+'`\x0a\x0a')+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+_0x26d5f5(0xd8)+'Commands:\x0a'+_0x26d5f5(0xd1)+_0x26d5f5(0x96),{'parse_mode':_0x26d5f5(0xc2)}):(_0x2cbc4a['shopId']&&!_0x2cbc4a['isVerified']&&(await database_1[_0x26d5f5(0x93)][_0x26d5f5(0xe0)]['update']({'where':{'telegramId':_0x5a4cd7},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x5a4cd7)),await this[_0x26d5f5(0x82)]?.[_0x26d5f5(0xc0)](_0x2b295b,_0x26d5f5(0x83)+_0x26d5f5(0x104)+_0x26d5f5(0x8a)+_0x26d5f5(0xfe)+_0x26d5f5(0xc6)+_0x26d5f5(0x140),{'parse_mode':'Markdown'}));}catch(_0x5a1877){console[_0x26d5f5(0x92)](_0x26d5f5(0xd7),_0x5a1877),await this[_0x26d5f5(0x82)]?.['sendMessage'](_0x2b295b,_0x26d5f5(0x137));}}),this[_0x1f83ac(0x82)][_0x1f83ac(0xf6)](/\/disconnect/,async _0x627900=>{const _0x4d0d4e=_0x1f83ac,_0x3c118d=_0x627900[_0x4d0d4e(0x151)]['id'],_0x195667=_0x627900[_0x4d0d4e(0x11a)]?.['id']['toString']();if(!_0x195667)return;try{const _0x50677b=await database_1[_0x4d0d4e(0x93)][_0x4d0d4e(0xe0)][_0x4d0d4e(0xb2)]({'where':{'telegramId':_0x195667},'include':{'shop':!![]}});if(!_0x50677b||!_0x50677b[_0x4d0d4e(0x9f)]||!_0x50677b[_0x4d0d4e(0xa5)]){await this[_0x4d0d4e(0x82)]?.[_0x4d0d4e(0xc0)](_0x3c118d,_0x4d0d4e(0xdc));return;}const _0x297fc0=_0x50677b['shop']?.[_0x4d0d4e(0xff)]||'unknown\x20shop';await database_1[_0x4d0d4e(0x93)]['telegramUser'][_0x4d0d4e(0xbe)]({'where':{'telegramId':_0x195667},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x4d0d4e(0xab)+_0x195667+_0x4d0d4e(0x75)+_0x50677b['shopId']),await this['bot']?.['sendMessage'](_0x3c118d,_0x4d0d4e(0x13f)+_0x297fc0+_0x4d0d4e(0x12e)+_0x4d0d4e(0x88),{'parse_mode':'Markdown'});}catch(_0x23c846){console[_0x4d0d4e(0x92)]('Error\x20handling\x20/disconnect\x20command:',_0x23c846),await this['bot']?.[_0x4d0d4e(0xc0)](_0x3c118d,_0x4d0d4e(0x137));}}),this[_0x1f83ac(0x82)][_0x1f83ac(0xf6)](/\/status/,async _0x2fa9e8=>{const _0x4ad4b3=_0x1f83ac,_0x56aac8=_0x2fa9e8[_0x4ad4b3(0x151)]['id'],_0x3a1075=_0x2fa9e8[_0x4ad4b3(0x11a)]?.['id'][_0x4ad4b3(0x8e)]();if(!_0x3a1075)return;try{const _0x3d8f62=await database_1[_0x4ad4b3(0x93)]['telegramUser'][_0x4ad4b3(0xb2)]({'where':{'telegramId':_0x3a1075},'include':{'shop':!![]}});if(!_0x3d8f62){await this['bot']?.[_0x4ad4b3(0xc0)](_0x56aac8,_0x4ad4b3(0xaf)+_0x4ad4b3(0x12f));return;}if(!_0x3d8f62[_0x4ad4b3(0x9f)]||!_0x3d8f62[_0x4ad4b3(0xa5)]||!_0x3d8f62[_0x4ad4b3(0xa4)]){await this[_0x4ad4b3(0x82)]?.[_0x4ad4b3(0xc0)](_0x56aac8,_0x4ad4b3(0xf3)+_0x4ad4b3(0x8b));return;}await this['bot']?.['sendMessage'](_0x56aac8,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x4ad4b3(0x6d)+_0x3d8f62[_0x4ad4b3(0xa4)][_0x4ad4b3(0xff)]+'*\x0a')+(_0x4ad4b3(0x146)+_0x3d8f62[_0x4ad4b3(0xa4)][_0x4ad4b3(0x6b)]+'`\x0a')+(_0x4ad4b3(0xcf)+_0x3d8f62[_0x4ad4b3(0x6c)][_0x4ad4b3(0x135)](_0x4ad4b3(0x13b))+'\x0a\x0a')+_0x4ad4b3(0xe8)+_0x4ad4b3(0xf7)+_0x4ad4b3(0x96),{'parse_mode':_0x4ad4b3(0xc2)});}catch(_0x2a7159){console[_0x4ad4b3(0x92)](_0x4ad4b3(0x74),_0x2a7159),await this[_0x4ad4b3(0x82)]?.['sendMessage'](_0x56aac8,_0x4ad4b3(0x137));}}),this[_0x1f83ac(0x82)][_0x1f83ac(0xf6)](/\/debug/,async _0x1ff0a1=>{const _0xe540ed=_0x1f83ac,_0x50052e=_0x1ff0a1[_0xe540ed(0x151)]['id'],_0x16e86f=_0x1ff0a1[_0xe540ed(0x11a)]?.['id']['toString']();if(!_0x16e86f)return;try{const _0x3231e8=await database_1[_0xe540ed(0x93)][_0xe540ed(0xa4)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x51625d=_0xe540ed(0x78);_0x51625d+=_0xe540ed(0x85)+_0x16e86f+_0xe540ed(0x105),_0x51625d+=_0xe540ed(0xbd),_0x3231e8[_0xe540ed(0xfc)]((_0x495e27,_0x32b2e4)=>{const _0x5c8680=_0xe540ed;_0x51625d+=_0x32b2e4+0x1+'.\x20*'+_0x495e27[_0x5c8680(0xff)]+'*\x0a',_0x51625d+=_0x5c8680(0x138)+_0x495e27[_0x5c8680(0x6b)]+'`\x0a',_0x51625d+='\x20\x20\x20Status:\x20'+_0x495e27[_0x5c8680(0x10e)]+'\x0a',_0x51625d+=_0x5c8680(0xaa)+_0x495e27['publicKey']['substring'](0x0,0xf)+_0x5c8680(0xfd);}),await this[_0xe540ed(0x82)]?.['sendMessage'](_0x50052e,_0x51625d,{'parse_mode':'Markdown'});}catch(_0x1d8511){console['error'](_0xe540ed(0x121),_0x1d8511),await this['bot']?.[_0xe540ed(0xc0)](_0x50052e,'❌\x20Error\x20getting\x20debug\x20information.');}}),this[_0x1f83ac(0x82)]['on'](_0x1f83ac(0x133),async _0x23a298=>{const _0x1035f5=_0x1f83ac;if(_0x23a298[_0x1035f5(0xce)]?.[_0x1035f5(0xa2)]('/'))return;const _0x1ff69c=_0x23a298[_0x1035f5(0x151)]['id'],_0x22485f=_0x23a298[_0x1035f5(0x11a)]?.['id']['toString'](),_0xb20d74=_0x23a298[_0x1035f5(0xce)]?.[_0x1035f5(0xed)]();if(!_0x22485f||!_0xb20d74)return;try{const _0x48bae1=await database_1[_0x1035f5(0x93)]['telegramUser']['findUnique']({'where':{'telegramId':_0x22485f},'include':{'shop':!![]}});if(!_0x48bae1){await this[_0x1035f5(0x82)]?.['sendMessage'](_0x1ff69c,_0x1035f5(0x115));return;}if(_0x48bae1[_0x1035f5(0x9f)]&&_0x48bae1[_0x1035f5(0xa5)]&&_0x48bae1[_0x1035f5(0xa4)]){await this[_0x1035f5(0x82)]?.[_0x1035f5(0xc0)](_0x1ff69c,_0x1035f5(0xb1)+_0x48bae1[_0x1035f5(0xa4)][_0x1035f5(0xff)]+_0x1035f5(0x12e)+_0x1035f5(0x144),{'parse_mode':_0x1035f5(0xc2)});return;}const _0x444f9c=_0xb20d74[_0x1035f5(0x145)](/\s+/);if(_0x444f9c['length']!==0x2){await this['bot']?.[_0x1035f5(0xc0)](_0x1ff69c,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x1035f5(0x8a)+_0x1035f5(0xfe)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+('You\x20sent\x20'+_0x444f9c[_0x1035f5(0xba)]+'\x20parts:\x20'+_0x444f9c[_0x1035f5(0xb5)](_0xc659ff=>'`'+_0xc659ff+'`')[_0x1035f5(0xc7)](',\x20')),{'parse_mode':_0x1035f5(0xc2)});return;}const [_0x2eb039,_0x2184bb]=_0x444f9c;console['log']('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x22485f+_0x1035f5(0x86)+_0x2eb039+_0x1035f5(0xb9)+_0x2184bb[_0x1035f5(0x141)](0x0,0xa)+_0x1035f5(0xad)),await this[_0x1035f5(0x9d)](_0x1ff69c,_0x22485f,_0x2eb039,_0x2184bb);}catch(_0xa6df48){console[_0x1035f5(0x92)](_0x1035f5(0x123),_0xa6df48),await this[_0x1035f5(0x82)]?.[_0x1035f5(0xc0)](_0x1ff69c,_0x1035f5(0x137));}}),this[_0x1f83ac(0x82)]['on'](_0x1f83ac(0x92),_0x5d759e=>{const _0x2c4003=_0x1f83ac;console[_0x2c4003(0x92)]('Telegram\x20bot\x20error:',_0x5d759e);}),this['bot']['on'](_0x1f83ac(0xee),_0x567f8f=>{const _0x3ba880=_0x1f83ac;console[_0x3ba880(0x92)](_0x3ba880(0x80),_0x567f8f);});}async[a55_0x1502f4(0x9d)](_0xec5694,_0x26da83,_0x70e7f1,_0x561d5a){const _0x496997=a55_0x1502f4;try{console[_0x496997(0x101)](_0x496997(0x14a)+_0x26da83+_0x496997(0x86)+_0x70e7f1+_0x496997(0xb9)+_0x561d5a[_0x496997(0x141)](0x0,0xa)+_0x496997(0xad));if(!_0x70e7f1||_0x70e7f1[_0x496997(0xba)]<0x3||_0x70e7f1[_0x496997(0xba)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x496997(0x87)](_0x70e7f1)){await this['bot']?.[_0x496997(0xc0)](_0xec5694,_0x496997(0x77)+_0x70e7f1+_0x496997(0x105)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x496997(0xc2)});return;}if(!_0x561d5a||!_0x561d5a[_0x496997(0xa2)](_0x496997(0x142))&&!_0x561d5a[_0x496997(0xa2)](_0x496997(0x7a))){await this['bot']?.[_0x496997(0xc0)](_0xec5694,_0x496997(0x14c)+_0x496997(0x136),{'parse_mode':_0x496997(0xc2)});return;}const _0x180f2d=await database_1['default'][_0x496997(0xa4)]['findUnique']({'where':{'username':_0x70e7f1},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x180f2d){const _0x4b1433=await database_1[_0x496997(0x93)][_0x496997(0xa4)][_0x496997(0xf0)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x3edf3c=_0x496997(0xcd)+_0x70e7f1+_0x496997(0x13e);_0x4b1433['length']>0x0?(_0x3edf3c+=_0x496997(0xa9),_0x4b1433[_0x496997(0xfc)](_0x1f87b2=>{const _0x5dd5a7=_0x496997;_0x3edf3c+=_0x5dd5a7(0x147)+_0x1f87b2[_0x5dd5a7(0x6b)]+_0x5dd5a7(0xdd)+_0x1f87b2[_0x5dd5a7(0xff)]+')\x0a';}),_0x3edf3c+=_0x496997(0xdb)):_0x3edf3c+=_0x496997(0x126);await this[_0x496997(0x82)]?.[_0x496997(0xc0)](_0xec5694,_0x3edf3c,{'parse_mode':_0x496997(0xc2)});return;}if(_0x180f2d['status']!==_0x496997(0x109)){await this[_0x496997(0x82)]?.['sendMessage'](_0xec5694,_0x496997(0x128)+_0x70e7f1+_0x496997(0xcc)+_0x496997(0x7f),{'parse_mode':'Markdown'});return;}if(_0x180f2d['publicKey']!==_0x561d5a&&_0x180f2d[_0x496997(0x14e)]!==_0x561d5a){await this[_0x496997(0x82)]?.[_0x496997(0xc0)](_0xec5694,_0x496997(0x152)+_0x70e7f1+'`.\x0a\x0a'+_0x496997(0xa3)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x496997(0xc2)});return;}const _0x1f0f3d=await database_1[_0x496997(0x93)]['telegramUser'][_0x496997(0x68)]({'where':{'shopId':_0x180f2d['id'],'isVerified':!![],'telegramId':{'not':_0x26da83}}});if(_0x1f0f3d){await this[_0x496997(0x82)]?.[_0x496997(0xc0)](_0xec5694,_0x496997(0x116)+_0x70e7f1+_0x496997(0x108)+_0x496997(0x91),{'parse_mode':_0x496997(0xc2)});return;}await database_1['default']['telegramUser'][_0x496997(0xbe)]({'where':{'telegramId':_0x26da83},'data':{'shopId':_0x180f2d['id'],'isVerified':!![]}}),await this[_0x496997(0x82)]?.[_0x496997(0xc0)](_0xec5694,_0x496997(0xc5)+_0x496997(0x11f)+(_0x496997(0xb3)+_0x180f2d[_0x496997(0xff)]+'*\x0a')+('👤\x20Username:\x20`'+_0x180f2d[_0x496997(0x6b)]+_0x496997(0x105))+_0x496997(0xd0)+'•\x20New\x20payments\x0a'+_0x496997(0xe3)+_0x496997(0xea)+_0x496997(0x73)+_0x496997(0xf7)+_0x496997(0xd1)+_0x496997(0x96),{'parse_mode':_0x496997(0xc2)}),console[_0x496997(0x101)]('✅\x20Telegram\x20user\x20'+_0x26da83+_0x496997(0x14d)+_0x180f2d['username']+_0x496997(0x95));}catch(_0x259280){console[_0x496997(0x92)](_0x496997(0x8d),_0x259280),await this[_0x496997(0x82)]?.[_0x496997(0xc0)](_0xec5694,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async['sendShopNotification'](_0x5d58c1,_0x66002a,_0x2b0a97){const _0x42456a=a55_0x1502f4;if(!this['bot']){console[_0x42456a(0xcb)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0xe1d0ad=await database_1[_0x42456a(0x93)][_0x42456a(0xe0)]['findMany']({'where':{'shopId':_0x5d58c1,'isVerified':!![]}});if(_0xe1d0ad[_0x42456a(0xba)]===0x0){console[_0x42456a(0x101)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x5d58c1);return;}const _0x492961=_0xe1d0ad['map'](async _0x314d39=>{const _0x362ee9=_0x42456a;try{await this[_0x362ee9(0x82)]?.[_0x362ee9(0xc0)](_0x314d39['telegramId'],_0x66002a,_0x2b0a97),console[_0x362ee9(0x101)](_0x362ee9(0x89)+_0x314d39['telegramId']);}catch(_0x590406){console[_0x362ee9(0x92)](_0x362ee9(0x118)+_0x314d39[_0x362ee9(0x114)]+':',_0x590406),_0x590406 instanceof Error&&(_0x590406['message']['includes'](_0x362ee9(0x94))||_0x590406[_0x362ee9(0x133)][_0x362ee9(0x6f)]('chat\x20not\x20found')||_0x590406['message'][_0x362ee9(0x6f)](_0x362ee9(0xf4)))&&(await database_1[_0x362ee9(0x93)][_0x362ee9(0xe0)][_0x362ee9(0xbe)]({'where':{'id':_0x314d39['id']},'data':{'isVerified':![]}}),console[_0x362ee9(0x101)](_0x362ee9(0x13a)+_0x314d39[_0x362ee9(0x114)]+_0x362ee9(0xa0)));}});await Promise[_0x42456a(0x99)](_0x492961);}catch(_0x6b2b6f){console['error'](_0x42456a(0x143),_0x6b2b6f);}}async[a55_0x1502f4(0xb6)](_0x217f41,_0x39c21f,_0x5f5d10){const _0x5800d3=a55_0x1502f4,_0xbe2871={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x45dcbc={'created':_0x5800d3(0x7e),'paid':_0x5800d3(0x148),'failed':_0x5800d3(0xfa),'expired':_0x5800d3(0x66),'refund':_0x5800d3(0xb7),'chargeback':_0x5800d3(0x11e),'processing':_0x5800d3(0xb4)},_0x5d8710=_0xbe2871[_0x5f5d10],_0x129b6d=_0x45dcbc[_0x5f5d10],_0x1e77bd=(0x0,gateway_1[_0x5800d3(0xde)])(_0x39c21f['gateway']);console['log']('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x39c21f[_0x5800d3(0xac)]+_0x5800d3(0xd4)+_0x1e77bd+'\x22');let _0x16e23a=_0x5d8710+'\x20*'+_0x129b6d+_0x5800d3(0x10c)+(_0x5800d3(0x7d)+_0x39c21f['amount']+'\x20'+_0x39c21f[_0x5800d3(0x112)]+'*\x0a')+(_0x5800d3(0x13c)+(_0x39c21f['orderId']||_0x39c21f['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x39c21f['id']+'`\x0a')+(_0x5800d3(0x120)+_0x1e77bd+'`\x0a')+(_0x5800d3(0x119)+new Date(_0x39c21f[_0x5800d3(0xae)])[_0x5800d3(0x8f)](_0x5800d3(0x13b))+'\x0a');if(_0x39c21f[_0x5800d3(0x134)]||_0x39c21f[_0x5800d3(0x9b)]||_0x39c21f[_0x5800d3(0x124)]||_0x39c21f[_0x5800d3(0xa1)]||_0x39c21f[_0x5800d3(0xb8)]){_0x16e23a+=_0x5800d3(0x103);_0x39c21f[_0x5800d3(0x134)]&&(_0x16e23a+=_0x5800d3(0x8c)+_0x39c21f['customerName']+'`\x0a');_0x39c21f[_0x5800d3(0x9b)]&&(_0x16e23a+=_0x5800d3(0xa6)+_0x39c21f[_0x5800d3(0x9b)]+'`\x0a');_0x39c21f[_0x5800d3(0x124)]&&(_0x16e23a+='🏦\x20IBAN:\x20`'+_0x39c21f[_0x5800d3(0x124)]+'`\x0a');_0x39c21f[_0x5800d3(0xa1)]&&(_0x16e23a+=_0x5800d3(0xd6)+_0x39c21f[_0x5800d3(0xa1)]+'`\x0a');if(_0x39c21f[_0x5800d3(0xb8)]){const _0x453e69=_0x39c21f[_0x5800d3(0xb8)][_0x5800d3(0xba)]>0x32?_0x39c21f[_0x5800d3(0xb8)]['substring'](0x0,0x32)+_0x5800d3(0xbc):_0x39c21f[_0x5800d3(0xb8)];_0x16e23a+=_0x5800d3(0x70)+_0x453e69+'`\x0a';}}_0x5f5d10===_0x5800d3(0xe4)&&_0x39c21f[_0x5800d3(0x110)]&&(_0x16e23a+=_0x5800d3(0xe1)+_0x39c21f['chargebackAmount']+_0x5800d3(0x12b)),_0x5f5d10==='processing'&&(_0x16e23a+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x39c21f['adminNotes']&&(_0x16e23a+=_0x5800d3(0x11b)+_0x39c21f[_0x5800d3(0x98)]+'\x0a'),await this[_0x5800d3(0xf5)](_0x217f41,_0x16e23a,{'parse_mode':_0x5800d3(0xc2)});}async[a55_0x1502f4(0x102)](_0x31bac2,_0x1e034d,_0x2b1abc){const _0x36c196=a55_0x1502f4,_0x8881e0={'created':'📤','completed':'✅','rejected':'❌'},_0x14e1dc={'created':_0x36c196(0x139),'completed':_0x36c196(0xda),'rejected':'Payout\x20rejected'},_0x3795ff=_0x8881e0[_0x2b1abc],_0x4e2cf1=_0x14e1dc[_0x2b1abc],_0x58cb56=_0x3795ff+'\x20*'+_0x4e2cf1+_0x36c196(0x10c)+('💸\x20Amount:\x20*'+_0x1e034d[_0x36c196(0x122)]+'\x20USD*\x0a')+(_0x36c196(0xd2)+_0x1e034d[_0x36c196(0x6e)]+'`\x0a')+(_0x36c196(0xe2)+_0x1e034d['id']+'`\x0a')+(_0x36c196(0x119)+new Date(_0x1e034d[_0x36c196(0xae)])[_0x36c196(0x8f)]('en-US')+'\x0a')+(_0x1e034d[_0x36c196(0x10a)]?_0x36c196(0xd9)+_0x1e034d[_0x36c196(0x10a)]+'`':'');await this[_0x36c196(0xf5)](_0x31bac2,_0x58cb56,{'parse_mode':_0x36c196(0xc2)});}async[a55_0x1502f4(0x14f)](_0x19290f,_0x35cda4){const _0x3546af=a55_0x1502f4;try{const _0x4ce3b5=await database_1[_0x3546af(0x93)][_0x3546af(0x84)][_0x3546af(0xb2)]({'where':{'shopId':_0x19290f},'select':{'notificationLogin':!![]}});if(!_0x4ce3b5?.[_0x3546af(0x149)]){console['log'](_0x3546af(0x97)+_0x19290f);return;}const _0x5b518f=_0x35cda4['success']?'🔐':'🚨',_0x2087ea=_0x35cda4['success']?'Successful\x20login':_0x3546af(0x76);let _0xf4c79=_0x5b518f+'\x20*'+_0x2087ea+_0x3546af(0x10c)+(_0x3546af(0x146)+_0x35cda4[_0x3546af(0x6b)]+'`\x0a')+(_0x3546af(0x10d)+_0x35cda4[_0x3546af(0x71)][_0x3546af(0x8f)]('en-US')+'\x0a');_0x35cda4['ipAddress']&&(_0xf4c79+=_0x3546af(0xef)+_0x35cda4['ipAddress']+'`\x0a');if(_0x35cda4[_0x3546af(0x125)]){const _0x41f042=_0x35cda4[_0x3546af(0x125)][_0x3546af(0xba)]>0x32?_0x35cda4[_0x3546af(0x125)]['substring'](0x0,0x32)+'...':_0x35cda4[_0x3546af(0x125)];_0xf4c79+=_0x3546af(0x70)+_0x41f042+'`\x0a';}!_0x35cda4[_0x3546af(0x67)]&&(_0xf4c79+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x3546af(0xf5)](_0x19290f,_0xf4c79,{'parse_mode':_0x3546af(0xc2)}),console[_0x3546af(0x101)](_0x3546af(0xc3)+_0x19290f+':\x20'+(_0x35cda4[_0x3546af(0x67)]?'success':_0x3546af(0x113)));}catch(_0x3258e8){console[_0x3546af(0x92)](_0x3546af(0xca),_0x3258e8);}}async[a55_0x1502f4(0xa8)](_0x334e76,_0x30df2c){const _0x254103=a55_0x1502f4;try{const _0x42df7a=await database_1[_0x254103(0x93)][_0x254103(0x84)][_0x254103(0xb2)]({'where':{'shopId':_0x334e76},'select':{'notificationApiError':!![]}});if(!_0x42df7a?.[_0x254103(0x6a)]){console[_0x254103(0x101)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x334e76);return;}let _0x8fd4c7=_0x254103(0x72)+(_0x254103(0x14b)+_0x30df2c['method']+'\x20'+_0x30df2c[_0x254103(0xec)]+'`\x0a')+(_0x254103(0x10d)+_0x30df2c[_0x254103(0x71)]['toLocaleString'](_0x254103(0x13b))+'\x0a');_0x30df2c[_0x254103(0x117)]&&(_0x8fd4c7+='📊\x20Error\x20code:\x20`'+_0x30df2c[_0x254103(0x117)]+'`\x0a'),_0x8fd4c7+=_0x254103(0xb0)+_0x30df2c[_0x254103(0xc8)]+'`\x0a',_0x30df2c[_0x254103(0x100)]&&(_0x8fd4c7+=_0x254103(0x150)+_0x30df2c[_0x254103(0x100)]+'`\x0a'),_0x8fd4c7+=_0x254103(0xf2),await this[_0x254103(0xf5)](_0x334e76,_0x8fd4c7,{'parse_mode':_0x254103(0xc2)}),console[_0x254103(0x101)](_0x254103(0xe6)+_0x334e76+':\x20'+_0x30df2c[_0x254103(0xec)]);}catch(_0x446099){console[_0x254103(0x92)](_0x254103(0x111),_0x446099);}}async[a55_0x1502f4(0xeb)](_0x303437,_0x3efd73,_0x3f9d01){const _0x34d188=a55_0x1502f4;let _0x49e5ca='🔔\x20*'+_0x3efd73+_0x34d188(0x10c);for(const [_0x28480c,_0x1f865b]of Object[_0x34d188(0x11d)](_0x3f9d01)){_0x1f865b!==null&&_0x1f865b!==undefined&&(_0x49e5ca+=_0x28480c+':\x20`'+_0x1f865b+'`\x0a');}await this['sendShopNotification'](_0x303437,_0x49e5ca,{'parse_mode':_0x34d188(0xc2)});}[a55_0x1502f4(0xbf)](){const _0x216188=a55_0x1502f4;return{'isActive':!!this[_0x216188(0x82)],'username':this['botUsername']};}[a55_0x1502f4(0xe7)](){const _0x395733=a55_0x1502f4;this[_0x395733(0x82)]&&(this['bot'][_0x395733(0x90)](),this[_0x395733(0x82)]=null,console[_0x395733(0x101)](_0x395733(0x69)));}}exports['TelegramBotService']=TelegramBotService,exports[a55_0x1502f4(0xc4)]=new TelegramBotService();