'use strict';const a54_0x57fcd8=a54_0x213d;(function(_0x27c10b,_0x3adfdb){const _0x40f2f2=a54_0x213d,_0x4c72ec=_0x27c10b();while(!![]){try{const _0x6fa35d=parseInt(_0x40f2f2(0x193))/0x1+parseInt(_0x40f2f2(0x1fc))/0x2+parseInt(_0x40f2f2(0x173))/0x3*(-parseInt(_0x40f2f2(0x1b5))/0x4)+-parseInt(_0x40f2f2(0x190))/0x5*(parseInt(_0x40f2f2(0x1cc))/0x6)+parseInt(_0x40f2f2(0x17f))/0x7+-parseInt(_0x40f2f2(0x254))/0x8+parseInt(_0x40f2f2(0x1bc))/0x9;if(_0x6fa35d===_0x3adfdb)break;else _0x4c72ec['push'](_0x4c72ec['shift']());}catch(_0x4f2d27){_0x4c72ec['push'](_0x4c72ec['shift']());}}}(a54_0x5560,0xaf234));var __importDefault=this&&this['__importDefault']||function(_0x48918d){const _0x502b0c=a54_0x213d;return _0x48918d&&_0x48918d[_0x502b0c(0x180)]?_0x48918d:{'default':_0x48918d};};function a54_0x213d(_0x2d81a2,_0x3a2a3b){const _0x5560ba=a54_0x5560();return a54_0x213d=function(_0x213d4d,_0x3a3e8e){_0x213d4d=_0x213d4d-0x170;let _0x518e36=_0x5560ba[_0x213d4d];return _0x518e36;},a54_0x213d(_0x2d81a2,_0x3a2a3b);}function a54_0x5560(){const _0xf3572a=['sk_','Use\x20/start\x20to\x20connect.','TelegramBotService','orderId','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','Error\x20sending\x20shop\x20notification:','requestId','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','✅\x20Telegram\x20bot\x20@','•\x20Important\x20events\x0a\x0a','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','sendCustomNotification','🔍\x20*Debug\x20Information*\x0a\x0a','✅\x20Telegram\x20user\x20','timestamp',':\x20username=\x22','2790794rnoHYT','💳\x20Card:\x20`****','📅\x20Date:\x20','📅\x20Connection\x20date:\x20','\x20via\x20single-line\x20input','pk_','Failed\x20to\x20send\x20login\x20notification:','split','status','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','userAgent','🏪\x20Available\x20shops\x20in\x20system:\x0a','error','createdAt','Payment\x20failed','message','en-US','\x20\x20\x20Status:\x20','shopId','\x20(@','map','shopSettings','telegramId','❌\x20Shop\x20`','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','🌐\x20IP\x20address:\x20`','🔗\x20Endpoint:\x20`','Failed\x20to\x20send\x20API\x20error\x20notification:','🆔\x20Request\x20ID:\x20`','chat','../config/database','getBotInfo','`\x0a\x0a','🗺️\x20Country:\x20`','chat\x20not\x20found','ipAddress','bot','\x22\x20->\x20display\x20\x22','🔔\x20You\x20receive\x20notifications\x20about:\x0a','success','📧\x20Email:\x20`','`\x20(IP:\x20`','/status\x20-\x20check\x20connection\x20status\x0a','🔔\x20*','✅\x20Connected\x20to\x20shop:\x20*','📅\x20Time:\x20','unknown\x20shop','\x20USDT*\x0a','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','❌\x20Shop\x20with\x20username\x20`','gateway','Error\x20handling\x20message:','cardLast4','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Telegram\x20bot\x20error:','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','includes','toLocaleString','remitterName','🏪\x20Gateway:\x20`','sendApiErrorNotification','...','/disconnect\x20-\x20disconnect\x20from\x20notifications','customerIp','update','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Payment\x20chargeback','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','...\x22','notificationApiError','initializeBot','Payment\x20successfully\x20paid','📱\x20Telegram\x20notification:\x20gateway\x20\x22','🌐\x20IP:\x20`','trapay_bot','adminNotes','first_name','default','\x22,\x20apiKey=\x22','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','botToken','chargebackAmount','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','❌\x20Please\x20use\x20/start\x20command\x20first','\x20\x20\x20Username:\x20`','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','endpoint','7445544uDwUoZ','env','warn','•\x20New\x20payments\x0a','sendMessage','7317coNrjZ','publicKey','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','log',':\x20`','💰\x20Amount:\x20*','node-telegram-bot-api','amount','🏦\x20Method:\x20`','Contact\x20administrator\x20to\x20restore\x20full\x20access.','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','5055841LUZOFX','__esModule','onText','remitterIban','👤\x20Username:\x20`','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','Markdown','`.\x0a\x0a','❌\x20Error:\x20`','🚨\x20*API\x20Error*\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','length','Example:\x0a','statusCode','substring','sendPayoutNotification','🔔\x20Notifications\x20are\x20active\x0a\x0a','10TTGUmu','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','`)\x0a','1205465dZNCrL','💸\x20Penalty\x20amount:\x20*','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','Username:\x20`','stopPolling','shop','...`\x0a\x0a','from','startsWith','📱\x20Created\x20new\x20Telegram\x20user:\x20','❌\x20Invalid\x20username\x20format:\x20`','You\x20sent\x20','user\x20is\x20deactivated','Payment\x20expired','customerName','New\x20payout\x20created','../types/gateway','customerCountry','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','findUnique','entries','errorMessage','last_name','toLocaleDateString','TELEGRAM_BOT_USERNAME','Commands:\x0a','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','botUsername','stopBot','`\x20not\x20found.\x0a\x0a','sendShopNotification','telegramUser','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','customerEmail','1244LgZwLo','telegramBotService','isVerified','blocked','⚠️\x20Shop\x20`','Error\x20in\x20handleSingleLineVerification:','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','697491IsSNpZ','username','paymentMethod','.\x20*','toString','🏦\x20IBAN:\x20`','method','Error\x20handling\x20/disconnect\x20command:','💰\x20Method:\x20`','\x0aCheck\x20spelling\x20and\x20try\x20again.','cointopay','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','•\x20Payouts\x0a\x0a','text','Payout\x20completed','create','2982114oYRQLs','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','handleSingleLineVerification','getGatewayDisplayNameForTelegram','Use\x20/start\x20to\x20begin.','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','Payment\x20is\x20being\x20processed','To\x20reconnect,\x20use\x20the\x20/start\x20command','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','findMany','\x20parts:\x20','📱\x20Shop:\x20*','❌\x20Error\x20getting\x20debug\x20information.','\x20disconnected\x20from\x20shop\x20','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','trim','*\x0a\x0a','•\x20Payouts\x0a','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','📝\x20Notes:\x20','💸\x20Amount:\x20*','bankId','Successful\x20login','🔗\x20TXID:\x20`','name','setupBotHandlers','forEach','Payment\x20refund','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','failed','\x0a👤\x20*Customer\x20Information:*\x0a'];a54_0x5560=function(){return _0xf3572a;};return a54_0x5560();}Object['defineProperty'](exports,a54_0x57fcd8(0x180),{'value':!![]}),exports[a54_0x57fcd8(0x1b6)]=exports[a54_0x57fcd8(0x1ee)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x57fcd8(0x17a))),database_1=__importDefault(require(a54_0x57fcd8(0x21a))),gateway_1=require(a54_0x57fcd8(0x1a3));class TelegramBotService{constructor(){const _0x1b5b7e=a54_0x57fcd8;this[_0x1b5b7e(0x220)]=null,this[_0x1b5b7e(0x24c)]=process[_0x1b5b7e(0x255)]['TELEGRAM_BOT_TOKEN']||'',this['botUsername']=process['env'][_0x1b5b7e(0x1ab)]||_0x1b5b7e(0x246),this['botToken']?this[_0x1b5b7e(0x242)]():console[_0x1b5b7e(0x170)](_0x1b5b7e(0x23f));}['initializeBot'](){const _0x4fd6ae=a54_0x57fcd8;try{this[_0x4fd6ae(0x220)]=new node_telegram_bot_api_1['default'](this[_0x4fd6ae(0x24c)],{'polling':!![]}),this[_0x4fd6ae(0x1e5)](),console[_0x4fd6ae(0x177)](_0x4fd6ae(0x1f4)+this['botUsername']+'\x20initialized\x20successfully');}catch(_0x4d5e28){console['error'](_0x4fd6ae(0x17e),_0x4d5e28);}}[a54_0x57fcd8(0x1e5)](){const _0x4dc830=a54_0x57fcd8;if(!this[_0x4dc830(0x220)])return;this[_0x4dc830(0x220)][_0x4dc830(0x181)](/\/start/,async _0x581636=>{const _0x3a8da5=_0x4dc830,_0x3e2af1=_0x581636[_0x3a8da5(0x219)]['id'],_0x3162ad=_0x581636[_0x3a8da5(0x19a)]?.['id'][_0x3a8da5(0x1c0)](),_0x2b1de0=_0x581636[_0x3a8da5(0x19a)]?.[_0x3a8da5(0x1bd)],_0x34db56=_0x581636[_0x3a8da5(0x19a)]?.[_0x3a8da5(0x248)],_0x47461a=_0x581636[_0x3a8da5(0x19a)]?.[_0x3a8da5(0x1a9)];if(!_0x3162ad)return;try{let _0x170ea2=await database_1[_0x3a8da5(0x249)][_0x3a8da5(0x1b2)][_0x3a8da5(0x1a6)]({'where':{'telegramId':_0x3162ad},'include':{'shop':!![]}});!_0x170ea2?(_0x170ea2=await database_1[_0x3a8da5(0x249)][_0x3a8da5(0x1b2)][_0x3a8da5(0x1cb)]({'data':{'telegramId':_0x3162ad,'username':_0x2b1de0,'firstName':_0x34db56,'lastName':_0x47461a,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x3a8da5(0x177)](_0x3a8da5(0x19c)+_0x3162ad+_0x3a8da5(0x20f)+_0x2b1de0+')')):_0x170ea2=await database_1['default'][_0x3a8da5(0x1b2)][_0x3a8da5(0x23c)]({'where':{'telegramId':_0x3162ad},'data':{'username':_0x2b1de0,'firstName':_0x34db56,'lastName':_0x47461a},'include':{'shop':!![]}}),_0x170ea2[_0x3a8da5(0x1b7)]&&_0x170ea2[_0x3a8da5(0x20e)]&&_0x170ea2[_0x3a8da5(0x198)]?await this[_0x3a8da5(0x220)]?.['sendMessage'](_0x3e2af1,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x3a8da5(0x22c)+_0x170ea2[_0x3a8da5(0x198)][_0x3a8da5(0x1e4)]+'*\x0a')+(_0x3a8da5(0x196)+_0x170ea2['shop'][_0x3a8da5(0x1bd)]+_0x3a8da5(0x21c))+_0x3a8da5(0x222)+_0x3a8da5(0x171)+'•\x20Payment\x20status\x20changes\x0a'+_0x3a8da5(0x1c8)+'Commands:\x0a'+_0x3a8da5(0x226)+_0x3a8da5(0x23a),{'parse_mode':_0x3a8da5(0x185)}):(_0x170ea2[_0x3a8da5(0x20e)]&&!_0x170ea2[_0x3a8da5(0x1b7)]&&(await database_1[_0x3a8da5(0x249)][_0x3a8da5(0x1b2)][_0x3a8da5(0x23c)]({'where':{'telegramId':_0x3162ad},'data':{'shopId':null,'isVerified':![]}}),console[_0x3a8da5(0x177)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x3162ad)),await this['bot']?.[_0x3a8da5(0x172)](_0x3e2af1,_0x3a8da5(0x1f6)+_0x3a8da5(0x251)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x3a8da5(0x18b)+_0x3a8da5(0x176)+_0x3a8da5(0x1bb),{'parse_mode':_0x3a8da5(0x185)}));}catch(_0x117806){console[_0x3a8da5(0x208)]('Error\x20handling\x20/start\x20command:',_0x117806),await this[_0x3a8da5(0x220)]?.[_0x3a8da5(0x172)](_0x3e2af1,_0x3a8da5(0x233));}}),this[_0x4dc830(0x220)]['onText'](/\/disconnect/,async _0x5e47e4=>{const _0x54cbf7=_0x4dc830,_0x19a78b=_0x5e47e4[_0x54cbf7(0x219)]['id'],_0x5ae57e=_0x5e47e4['from']?.['id'][_0x54cbf7(0x1c0)]();if(!_0x5ae57e)return;try{const _0x628695=await database_1['default'][_0x54cbf7(0x1b2)][_0x54cbf7(0x1a6)]({'where':{'telegramId':_0x5ae57e},'include':{'shop':!![]}});if(!_0x628695||!_0x628695['isVerified']||!_0x628695[_0x54cbf7(0x20e)]){await this[_0x54cbf7(0x220)]?.['sendMessage'](_0x19a78b,_0x54cbf7(0x1e9));return;}const _0x2426d3=_0x628695[_0x54cbf7(0x198)]?.['name']||_0x54cbf7(0x22a);await database_1[_0x54cbf7(0x249)][_0x54cbf7(0x1b2)][_0x54cbf7(0x23c)]({'where':{'telegramId':_0x5ae57e},'data':{'shopId':null,'isVerified':![]}}),console[_0x54cbf7(0x177)]('🔌\x20User\x20'+_0x5ae57e+_0x54cbf7(0x1d9)+_0x628695[_0x54cbf7(0x20e)]),await this[_0x54cbf7(0x220)]?.[_0x54cbf7(0x172)](_0x19a78b,_0x54cbf7(0x189)+_0x2426d3+'*.\x0a\x0a'+_0x54cbf7(0x1d3),{'parse_mode':'Markdown'});}catch(_0x5ece12){console[_0x54cbf7(0x208)](_0x54cbf7(0x1c3),_0x5ece12),await this['bot']?.[_0x54cbf7(0x172)](_0x19a78b,_0x54cbf7(0x233));}}),this[_0x4dc830(0x220)][_0x4dc830(0x181)](/\/status/,async _0x10a1de=>{const _0xbda441=_0x4dc830,_0x2a4e7a=_0x10a1de[_0xbda441(0x219)]['id'],_0x488361=_0x10a1de['from']?.['id']['toString']();if(!_0x488361)return;try{const _0xa97a5f=await database_1[_0xbda441(0x249)]['telegramUser'][_0xbda441(0x1a6)]({'where':{'telegramId':_0x488361},'include':{'shop':!![]}});if(!_0xa97a5f){await this[_0xbda441(0x220)]?.[_0xbda441(0x172)](_0x2a4e7a,_0xbda441(0x1da)+_0xbda441(0x1d0));return;}if(!_0xa97a5f['isVerified']||!_0xa97a5f['shopId']||!_0xa97a5f[_0xbda441(0x198)]){await this[_0xbda441(0x220)]?.[_0xbda441(0x172)](_0x2a4e7a,_0xbda441(0x1a5)+_0xbda441(0x1ed));return;}await this[_0xbda441(0x220)]?.[_0xbda441(0x172)](_0x2a4e7a,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0xbda441(0x228)+_0xa97a5f[_0xbda441(0x198)][_0xbda441(0x1e4)]+'*\x0a')+(_0xbda441(0x183)+_0xa97a5f[_0xbda441(0x198)][_0xbda441(0x1bd)]+'`\x0a')+(_0xbda441(0x1ff)+_0xa97a5f['updatedAt'][_0xbda441(0x1aa)](_0xbda441(0x20c))+'\x0a\x0a')+_0xbda441(0x18f)+_0xbda441(0x1ac)+_0xbda441(0x23a),{'parse_mode':_0xbda441(0x185)});}catch(_0x12b05f){console['error']('Error\x20handling\x20/status\x20command:',_0x12b05f),await this[_0xbda441(0x220)]?.[_0xbda441(0x172)](_0x2a4e7a,_0xbda441(0x233));}}),this[_0x4dc830(0x220)][_0x4dc830(0x181)](/\/debug/,async _0x3a4758=>{const _0x28f4c2=_0x4dc830,_0x1d9288=_0x3a4758[_0x28f4c2(0x219)]['id'],_0x85fce1=_0x3a4758[_0x28f4c2(0x19a)]?.['id'][_0x28f4c2(0x1c0)]();if(!_0x85fce1)return;try{const _0x25e6ee=await database_1[_0x28f4c2(0x249)]['shop'][_0x28f4c2(0x1d5)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x3278f8=_0x28f4c2(0x1f8);_0x3278f8+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x85fce1+_0x28f4c2(0x21c),_0x3278f8+=_0x28f4c2(0x207),_0x25e6ee['forEach']((_0x34e579,_0x105c7c)=>{const _0x5e9b0=_0x28f4c2;_0x3278f8+=_0x105c7c+0x1+_0x5e9b0(0x1bf)+_0x34e579['name']+'*\x0a',_0x3278f8+=_0x5e9b0(0x250)+_0x34e579['username']+'`\x0a',_0x3278f8+=_0x5e9b0(0x20d)+_0x34e579[_0x5e9b0(0x204)]+'\x0a',_0x3278f8+='\x20\x20\x20Public\x20Key:\x20`'+_0x34e579[_0x5e9b0(0x174)][_0x5e9b0(0x18d)](0x0,0xf)+_0x5e9b0(0x199);}),await this[_0x28f4c2(0x220)]?.[_0x28f4c2(0x172)](_0x1d9288,_0x3278f8,{'parse_mode':_0x28f4c2(0x185)});}catch(_0x5c674c){console[_0x28f4c2(0x208)]('Error\x20handling\x20/debug\x20command:',_0x5c674c),await this['bot']?.[_0x28f4c2(0x172)](_0x1d9288,_0x28f4c2(0x1d8));}}),this[_0x4dc830(0x220)]['on'](_0x4dc830(0x20b),async _0x105690=>{const _0x4b3979=_0x4dc830;if(_0x105690[_0x4b3979(0x1c9)]?.[_0x4b3979(0x19b)]('/'))return;const _0x1ada0f=_0x105690[_0x4b3979(0x219)]['id'],_0xd8e81=_0x105690[_0x4b3979(0x19a)]?.['id'][_0x4b3979(0x1c0)](),_0x38a036=_0x105690[_0x4b3979(0x1c9)]?.[_0x4b3979(0x1db)]();if(!_0xd8e81||!_0x38a036)return;try{const _0x5dd26a=await database_1['default'][_0x4b3979(0x1b2)][_0x4b3979(0x1a6)]({'where':{'telegramId':_0xd8e81},'include':{'shop':!![]}});if(!_0x5dd26a){await this[_0x4b3979(0x220)]?.['sendMessage'](_0x1ada0f,_0x4b3979(0x24f));return;}if(_0x5dd26a[_0x4b3979(0x1b7)]&&_0x5dd26a['shopId']&&_0x5dd26a[_0x4b3979(0x198)]){await this[_0x4b3979(0x220)]?.['sendMessage'](_0x1ada0f,_0x4b3979(0x231)+_0x5dd26a[_0x4b3979(0x198)][_0x4b3979(0x1e4)]+'*.\x0a\x0a'+_0x4b3979(0x1c7),{'parse_mode':_0x4b3979(0x185)});return;}const _0x226277=_0x38a036[_0x4b3979(0x203)](/\s+/);if(_0x226277[_0x4b3979(0x18a)]!==0x2){await this[_0x4b3979(0x220)]?.[_0x4b3979(0x172)](_0x1ada0f,_0x4b3979(0x252)+_0x4b3979(0x23d)+_0x4b3979(0x18b)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x4b3979(0x19e)+_0x226277[_0x4b3979(0x18a)]+_0x4b3979(0x1d6)+_0x226277[_0x4b3979(0x210)](_0x2eb1f9=>'`'+_0x2eb1f9+'`')['join'](',\x20')),{'parse_mode':_0x4b3979(0x185)});return;}const [_0x4bfd44,_0x1a5b58]=_0x226277;console[_0x4b3979(0x177)](_0x4b3979(0x1de)+_0xd8e81+':\x20username=\x22'+_0x4bfd44+_0x4b3979(0x24a)+_0x1a5b58[_0x4b3979(0x18d)](0x0,0xa)+_0x4b3979(0x240)),await this['handleSingleLineVerification'](_0x1ada0f,_0xd8e81,_0x4bfd44,_0x1a5b58);}catch(_0x534738){console[_0x4b3979(0x208)](_0x4b3979(0x22f),_0x534738),await this[_0x4b3979(0x220)]?.[_0x4b3979(0x172)](_0x1ada0f,_0x4b3979(0x233));}}),this[_0x4dc830(0x220)]['on'](_0x4dc830(0x208),_0x309508=>{const _0x5cb1c9=_0x4dc830;console['error'](_0x5cb1c9(0x232),_0x309508);}),this[_0x4dc830(0x220)]['on']('polling_error',_0x52fe9d=>{const _0x10147c=_0x4dc830;console[_0x10147c(0x208)]('Telegram\x20bot\x20polling\x20error:',_0x52fe9d);});}async[a54_0x57fcd8(0x1ce)](_0x498520,_0x6d3749,_0x2f46ce,_0x2979b1){const _0x2e5aad=a54_0x57fcd8;try{console['log'](_0x2e5aad(0x1de)+_0x6d3749+_0x2e5aad(0x1fb)+_0x2f46ce+_0x2e5aad(0x24a)+_0x2979b1[_0x2e5aad(0x18d)](0x0,0xa)+_0x2e5aad(0x240));if(!_0x2f46ce||_0x2f46ce['length']<0x3||_0x2f46ce[_0x2e5aad(0x18a)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x2f46ce)){await this[_0x2e5aad(0x220)]?.[_0x2e5aad(0x172)](_0x498520,_0x2e5aad(0x19d)+_0x2f46ce+_0x2e5aad(0x21c)+_0x2e5aad(0x1f3),{'parse_mode':_0x2e5aad(0x185)});return;}if(!_0x2979b1||!_0x2979b1[_0x2e5aad(0x19b)](_0x2e5aad(0x201))&&!_0x2979b1[_0x2e5aad(0x19b)](_0x2e5aad(0x1ec))){await this[_0x2e5aad(0x220)]?.[_0x2e5aad(0x172)](_0x498520,_0x2e5aad(0x24e)+_0x2e5aad(0x1d4),{'parse_mode':'Markdown'});return;}const _0x275ed4=await database_1[_0x2e5aad(0x249)][_0x2e5aad(0x198)]['findUnique']({'where':{'username':_0x2f46ce},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x275ed4){const _0x526d7e=await database_1[_0x2e5aad(0x249)][_0x2e5aad(0x198)][_0x2e5aad(0x1d5)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x4afab8=_0x2e5aad(0x22d)+_0x2f46ce+_0x2e5aad(0x1b0);_0x526d7e[_0x2e5aad(0x18a)]>0x0?(_0x4afab8+='Available\x20usernames:\x0a',_0x526d7e[_0x2e5aad(0x1e6)](_0x245266=>{const _0x2dbf23=_0x2e5aad;_0x4afab8+='•\x20`'+_0x245266[_0x2dbf23(0x1bd)]+'`\x20('+_0x245266['name']+')\x0a';}),_0x4afab8+=_0x2e5aad(0x1c5)):_0x4afab8+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x2e5aad(0x220)]?.[_0x2e5aad(0x172)](_0x498520,_0x4afab8,{'parse_mode':'Markdown'});return;}if(_0x275ed4[_0x2e5aad(0x204)]!=='ACTIVE'){const _0xcb3cfa=_0x275ed4[_0x2e5aad(0x204)]==='SUSPENDED'?_0x2e5aad(0x1b9)+_0x2f46ce+'`\x20is\x20suspended.\x0a\x0a'+'Your\x20account\x20is\x20temporarily\x20suspended.\x20You\x20can\x20view\x20your\x20dashboard\x20but\x20cannot\x20process\x20new\x20payments.\x0a\x0a'+_0x2e5aad(0x17d):_0x2e5aad(0x213)+_0x2f46ce+'`\x20is\x20inactive.\x0a\x0a'+'Contact\x20administrator.';await this['bot']?.[_0x2e5aad(0x172)](_0x498520,_0xcb3cfa,{'parse_mode':_0x2e5aad(0x185)});return;}if(_0x275ed4['publicKey']!==_0x2979b1&&_0x275ed4['secretKey']!==_0x2979b1){await this[_0x2e5aad(0x220)]?.[_0x2e5aad(0x172)](_0x498520,_0x2e5aad(0x1e8)+_0x2f46ce+'`.\x0a\x0a'+_0x2e5aad(0x24b)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x2e5aad(0x185)});return;}const _0x5307a6=await database_1[_0x2e5aad(0x249)][_0x2e5aad(0x1b2)]['findFirst']({'where':{'shopId':_0x275ed4['id'],'isVerified':!![],'telegramId':{'not':_0x6d3749}}});if(_0x5307a6){await this['bot']?.['sendMessage'](_0x498520,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x2f46ce+_0x2e5aad(0x186)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':'Markdown'});return;}await database_1[_0x2e5aad(0x249)][_0x2e5aad(0x1b2)][_0x2e5aad(0x23c)]({'where':{'telegramId':_0x6d3749},'data':{'shopId':_0x275ed4['id'],'isVerified':!![]}}),await this['bot']?.['sendMessage'](_0x498520,'🎉\x20*Congratulations!*\x0a\x0a'+_0x2e5aad(0x184)+(_0x2e5aad(0x1d7)+_0x275ed4[_0x2e5aad(0x1e4)]+'*\x0a')+(_0x2e5aad(0x183)+_0x275ed4['username']+_0x2e5aad(0x21c))+_0x2e5aad(0x205)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+_0x2e5aad(0x1dd)+_0x2e5aad(0x1f5)+_0x2e5aad(0x1ac)+_0x2e5aad(0x226)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x2e5aad(0x185)}),console[_0x2e5aad(0x177)](_0x2e5aad(0x1f9)+_0x6d3749+'\x20verified\x20for\x20shop\x20'+_0x275ed4['username']+_0x2e5aad(0x200));}catch(_0x3ccae2){console[_0x2e5aad(0x208)](_0x2e5aad(0x1ba),_0x3ccae2),await this[_0x2e5aad(0x220)]?.[_0x2e5aad(0x172)](_0x498520,_0x2e5aad(0x214));}}async[a54_0x57fcd8(0x1b1)](_0x202de1,_0x120a39,_0x3abdd9){const _0x2339d0=a54_0x57fcd8;if(!this['bot']){console[_0x2339d0(0x170)](_0x2339d0(0x175));return;}try{const _0x483aa1=await database_1['default'][_0x2339d0(0x1b2)][_0x2339d0(0x1d5)]({'where':{'shopId':_0x202de1,'isVerified':!![]}});if(_0x483aa1[_0x2339d0(0x18a)]===0x0){console[_0x2339d0(0x177)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x202de1);return;}const _0x3e84f1=_0x483aa1[_0x2339d0(0x210)](async _0x25631c=>{const _0x5a8ca0=_0x2339d0;try{await this[_0x5a8ca0(0x220)]?.[_0x5a8ca0(0x172)](_0x25631c['telegramId'],_0x120a39,_0x3abdd9),console['log'](_0x5a8ca0(0x1d1)+_0x25631c['telegramId']);}catch(_0x2c6aab){console[_0x5a8ca0(0x208)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x25631c[_0x5a8ca0(0x212)]+':',_0x2c6aab),_0x2c6aab instanceof Error&&(_0x2c6aab[_0x5a8ca0(0x20b)][_0x5a8ca0(0x234)](_0x5a8ca0(0x1b8))||_0x2c6aab[_0x5a8ca0(0x20b)][_0x5a8ca0(0x234)](_0x5a8ca0(0x21e))||_0x2c6aab['message'][_0x5a8ca0(0x234)](_0x5a8ca0(0x19f)))&&(await database_1[_0x5a8ca0(0x249)][_0x5a8ca0(0x1b2)][_0x5a8ca0(0x23c)]({'where':{'id':_0x25631c['id']},'data':{'isVerified':![]}}),console[_0x5a8ca0(0x177)]('User\x20'+_0x25631c[_0x5a8ca0(0x212)]+_0x5a8ca0(0x1ad)));}});await Promise['allSettled'](_0x3e84f1);}catch(_0x137f1b){console[_0x2339d0(0x208)](_0x2339d0(0x1f1),_0x137f1b);}}async['sendPaymentNotification'](_0x31cfbb,_0x2ce908,_0x1cf697){const _0x332149=a54_0x57fcd8,_0x2b3bc1={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x19fb24={'created':'New\x20payment\x20created','paid':_0x332149(0x243),'failed':_0x332149(0x20a),'expired':_0x332149(0x1a0),'refund':_0x332149(0x1e7),'chargeback':_0x332149(0x23e),'processing':_0x332149(0x1d2)},_0x170542=_0x2b3bc1[_0x1cf697],_0x81eda5=_0x19fb24[_0x1cf697],_0x1fd205=(0x0,gateway_1[_0x332149(0x1cf)])(_0x2ce908[_0x332149(0x22e)]);console[_0x332149(0x177)](_0x332149(0x244)+_0x2ce908[_0x332149(0x22e)]+_0x332149(0x221)+_0x1fd205+'\x22');let _0x2c2464=_0x170542+'\x20*'+_0x81eda5+'*\x0a\x0a'+(_0x332149(0x179)+_0x2ce908[_0x332149(0x17b)]+'\x20'+_0x2ce908['currency']+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x2ce908[_0x332149(0x1ef)]||_0x2ce908['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x2ce908['id']+'`\x0a')+(_0x332149(0x237)+_0x1fd205+'`\x0a')+(_0x332149(0x1fe)+new Date(_0x2ce908[_0x332149(0x209)])[_0x332149(0x235)](_0x332149(0x20c))+'\x0a');(_0x2ce908[_0x332149(0x1a1)]||_0x2ce908[_0x332149(0x1b4)]||_0x2ce908[_0x332149(0x23b)]||_0x2ce908['customerCountry'])&&(_0x2c2464+=_0x332149(0x1eb),_0x2ce908['customerName']&&(_0x2c2464+='📛\x20Name:\x20`'+_0x2ce908[_0x332149(0x1a1)]+'`\x0a'),_0x2ce908[_0x332149(0x1b4)]&&(_0x2c2464+=_0x332149(0x224)+_0x2ce908[_0x332149(0x1b4)]+'`\x0a'),_0x2ce908[_0x332149(0x23b)]&&(_0x2c2464+=_0x332149(0x245)+_0x2ce908[_0x332149(0x23b)]+'`\x0a'),_0x2ce908[_0x332149(0x1a4)]&&(_0x2c2464+=_0x332149(0x21d)+_0x2ce908[_0x332149(0x1a4)]+'`\x0a'));if(_0x2ce908[_0x332149(0x22e)]===_0x332149(0x1c6)&&_0x2ce908['remitterIban']){_0x2c2464+='\x0a🪙\x20*CoinToPay\x20Details:*\x0a',_0x2c2464+='🏦\x20IBAN:\x20`'+_0x2ce908[_0x332149(0x182)]+'`\x0a';_0x2ce908[_0x332149(0x236)]&&(_0x2c2464+='👤\x20Sender:\x20`'+_0x2ce908[_0x332149(0x236)]+'`\x0a');if(_0x2ce908['customerIp']&&_0x2ce908[_0x332149(0x1a4)])_0x2c2464+='🌍\x20From:\x20`'+_0x2ce908[_0x332149(0x1a4)]+_0x332149(0x225)+_0x2ce908[_0x332149(0x23b)]+_0x332149(0x192);else{if(_0x2ce908['customerIp'])_0x2c2464+=_0x332149(0x245)+_0x2ce908[_0x332149(0x23b)]+'`\x0a';else _0x2ce908[_0x332149(0x1a4)]&&(_0x2c2464+=_0x332149(0x21d)+_0x2ce908[_0x332149(0x1a4)]+'`\x0a');}}else(_0x2ce908[_0x332149(0x1be)]||_0x2ce908[_0x332149(0x230)]||_0x2ce908[_0x332149(0x1e1)]||_0x2ce908['remitterIban'])&&(_0x2c2464+='\x0a💳\x20*Payment\x20Details:*\x0a',_0x2ce908[_0x332149(0x1be)]&&(_0x2c2464+=_0x332149(0x1c4)+_0x2ce908[_0x332149(0x1be)]+'`\x0a'),_0x2ce908['cardLast4']&&(_0x2c2464+=_0x332149(0x1fd)+_0x2ce908[_0x332149(0x230)]+'`\x0a'),_0x2ce908[_0x332149(0x1e1)]&&(_0x2c2464+='🏦\x20Bank\x20ID:\x20`'+_0x2ce908[_0x332149(0x1e1)]+'`\x0a'),_0x2ce908[_0x332149(0x182)]&&(_0x2c2464+=_0x332149(0x1c1)+_0x2ce908[_0x332149(0x182)]+'`\x0a'),_0x2ce908[_0x332149(0x236)]&&(_0x2c2464+='👤\x20Remitter:\x20`'+_0x2ce908[_0x332149(0x236)]+'`\x0a'));_0x1cf697==='chargeback'&&_0x2ce908['chargebackAmount']&&(_0x2c2464+=_0x332149(0x194)+_0x2ce908[_0x332149(0x24d)]+_0x332149(0x22b)),_0x1cf697==='processing'&&(_0x2c2464+=_0x332149(0x1cd)),_0x2ce908['adminNotes']&&(_0x2c2464+=_0x332149(0x1df)+_0x2ce908[_0x332149(0x247)]+'\x0a'),await this['sendShopNotification'](_0x31cfbb,_0x2c2464,{'parse_mode':_0x332149(0x185)});}async[a54_0x57fcd8(0x18e)](_0x3c0bef,_0x1a461f,_0x440822){const _0x4732f3=a54_0x57fcd8,_0x1a351f={'created':'📤','completed':'✅','rejected':'❌'},_0x5e4dd3={'created':_0x4732f3(0x1a2),'completed':_0x4732f3(0x1ca),'rejected':'Payout\x20rejected'},_0x514c1b=_0x1a351f[_0x440822],_0x3de84c=_0x5e4dd3[_0x440822],_0x5bae12=_0x514c1b+'\x20*'+_0x3de84c+_0x4732f3(0x1dc)+(_0x4732f3(0x1e0)+_0x1a461f[_0x4732f3(0x17b)]+'\x20USD*\x0a')+(_0x4732f3(0x17c)+_0x1a461f[_0x4732f3(0x1c2)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x1a461f['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x1a461f['createdAt'])[_0x4732f3(0x235)]('en-US')+'\x0a')+(_0x1a461f['txid']?_0x4732f3(0x1e3)+_0x1a461f['txid']+'`':'');await this[_0x4732f3(0x1b1)](_0x3c0bef,_0x5bae12,{'parse_mode':'Markdown'});}async['sendLoginNotification'](_0x40f006,_0x4205d3){const _0x377bf6=a54_0x57fcd8;try{const _0x1e0248=await database_1[_0x377bf6(0x249)][_0x377bf6(0x211)][_0x377bf6(0x1a6)]({'where':{'shopId':_0x40f006},'select':{'notificationLogin':!![]}});if(!_0x1e0248?.['notificationLogin']){console[_0x377bf6(0x177)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x40f006);return;}const _0xc1e90d=_0x4205d3[_0x377bf6(0x223)]?'🔐':'🚨',_0x2bff21=_0x4205d3['success']?_0x377bf6(0x1e2):'Failed\x20login\x20attempt';let _0x57cf27=_0xc1e90d+'\x20*'+_0x2bff21+_0x377bf6(0x1dc)+(_0x377bf6(0x183)+_0x4205d3[_0x377bf6(0x1bd)]+'`\x0a')+(_0x377bf6(0x229)+_0x4205d3[_0x377bf6(0x1fa)][_0x377bf6(0x235)](_0x377bf6(0x20c))+'\x0a');_0x4205d3[_0x377bf6(0x21f)]&&(_0x57cf27+=_0x377bf6(0x215)+_0x4205d3[_0x377bf6(0x21f)]+'`\x0a');if(_0x4205d3[_0x377bf6(0x206)]){const _0x79ba49=_0x4205d3[_0x377bf6(0x206)][_0x377bf6(0x18a)]>0x32?_0x4205d3[_0x377bf6(0x206)]['substring'](0x0,0x32)+_0x377bf6(0x239):_0x4205d3[_0x377bf6(0x206)];_0x57cf27+='💻\x20Browser:\x20`'+_0x79ba49+'`\x0a';}!_0x4205d3['success']&&(_0x57cf27+=_0x377bf6(0x1f0)),await this['sendShopNotification'](_0x40f006,_0x57cf27,{'parse_mode':_0x377bf6(0x185)}),console[_0x377bf6(0x177)](_0x377bf6(0x195)+_0x40f006+':\x20'+(_0x4205d3[_0x377bf6(0x223)]?_0x377bf6(0x223):_0x377bf6(0x1ea)));}catch(_0x42d412){console[_0x377bf6(0x208)](_0x377bf6(0x202),_0x42d412);}}async[a54_0x57fcd8(0x238)](_0x29f557,_0x299a78){const _0x28e7e7=a54_0x57fcd8;try{const _0x3b5862=await database_1[_0x28e7e7(0x249)][_0x28e7e7(0x211)][_0x28e7e7(0x1a6)]({'where':{'shopId':_0x29f557},'select':{'notificationApiError':!![]}});if(!_0x3b5862?.[_0x28e7e7(0x241)]){console[_0x28e7e7(0x177)](_0x28e7e7(0x1b3)+_0x29f557);return;}let _0x5b9641=_0x28e7e7(0x188)+(_0x28e7e7(0x216)+_0x299a78['method']+'\x20'+_0x299a78[_0x28e7e7(0x253)]+'`\x0a')+(_0x28e7e7(0x229)+_0x299a78['timestamp'][_0x28e7e7(0x235)](_0x28e7e7(0x20c))+'\x0a');_0x299a78[_0x28e7e7(0x18c)]&&(_0x5b9641+='📊\x20Error\x20code:\x20`'+_0x299a78[_0x28e7e7(0x18c)]+'`\x0a'),_0x5b9641+=_0x28e7e7(0x187)+_0x299a78[_0x28e7e7(0x1a8)]+'`\x0a',_0x299a78['requestId']&&(_0x5b9641+=_0x28e7e7(0x218)+_0x299a78[_0x28e7e7(0x1f2)]+'`\x0a'),_0x5b9641+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x28e7e7(0x1b1)](_0x29f557,_0x5b9641,{'parse_mode':'Markdown'}),console[_0x28e7e7(0x177)](_0x28e7e7(0x191)+_0x29f557+':\x20'+_0x299a78[_0x28e7e7(0x253)]);}catch(_0x566da9){console[_0x28e7e7(0x208)](_0x28e7e7(0x217),_0x566da9);}}async[a54_0x57fcd8(0x1f7)](_0x472c8f,_0x145989,_0x743550){const _0x3a58f0=a54_0x57fcd8;let _0x120884=_0x3a58f0(0x227)+_0x145989+'*\x0a\x0a';for(const [_0x48973d,_0x39f49e]of Object[_0x3a58f0(0x1a7)](_0x743550)){_0x39f49e!==null&&_0x39f49e!==undefined&&(_0x120884+=_0x48973d+_0x3a58f0(0x178)+_0x39f49e+'`\x0a');}await this[_0x3a58f0(0x1b1)](_0x472c8f,_0x120884,{'parse_mode':_0x3a58f0(0x185)});}[a54_0x57fcd8(0x21b)](){const _0x42de28=a54_0x57fcd8;return{'isActive':!!this[_0x42de28(0x220)],'username':this[_0x42de28(0x1ae)]};}[a54_0x57fcd8(0x1af)](){const _0xb49df7=a54_0x57fcd8;this[_0xb49df7(0x220)]&&(this[_0xb49df7(0x220)][_0xb49df7(0x197)](),this[_0xb49df7(0x220)]=null,console[_0xb49df7(0x177)]('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a54_0x57fcd8(0x1ee)]=TelegramBotService,exports[a54_0x57fcd8(0x1b6)]=new TelegramBotService();