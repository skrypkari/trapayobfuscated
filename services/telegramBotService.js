'use strict';const a78_0x5edc1c=a78_0x42c6;(function(_0x34bcd4,_0x24b607){const _0x21e5ec=a78_0x42c6,_0x38adca=_0x34bcd4();while(!![]){try{const _0x34ec72=parseInt(_0x21e5ec(0xf1))/0x1*(parseInt(_0x21e5ec(0x127))/0x2)+parseInt(_0x21e5ec(0x194))/0x3+parseInt(_0x21e5ec(0xf8))/0x4*(-parseInt(_0x21e5ec(0x108))/0x5)+parseInt(_0x21e5ec(0xe6))/0x6+-parseInt(_0x21e5ec(0x196))/0x7+parseInt(_0x21e5ec(0x121))/0x8+parseInt(_0x21e5ec(0x181))/0x9*(-parseInt(_0x21e5ec(0x15f))/0xa);if(_0x34ec72===_0x24b607)break;else _0x38adca['push'](_0x38adca['shift']());}catch(_0x1de797){_0x38adca['push'](_0x38adca['shift']());}}}(a78_0xf3a2,0xb7e53));var __importDefault=this&&this[a78_0x5edc1c(0x195)]||function(_0x5c2fca){const _0x2cb456=a78_0x5edc1c;return _0x5c2fca&&_0x5c2fca[_0x2cb456(0x113)]?_0x5c2fca:{'default':_0x5c2fca};};Object['defineProperty'](exports,a78_0x5edc1c(0x113),{'value':!![]}),exports[a78_0x5edc1c(0x12c)]=exports[a78_0x5edc1c(0x13e)]=void 0x0;function a78_0xf3a2(){const _0x1b1f96=['sk_','üì±\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','requestId','chat\x20not\x20found','findMany','üí∏\x20Penalty\x20amount:\x20*','TelegramBotService','image/jpeg','üîó\x20Endpoint:\x20`','\x20\x20\x20Name:\x20*','\x20\x20\x20Username:\x20`','üìù\x20Format:\x20`username\x20api_key`\x0a\x0a','\x20USD\x0a','Username:\x20`','sendDirectMessage','network','‚ùå\x20Error\x20sending\x20file\x20to\x20shop:','map','üì±\x20Your\x20Telegram\x20ID:\x20`','allSettled','username','node-telegram-bot-api','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','endpoint','‚ùóÔ∏è\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','üåê\x20*Network:*\x20','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','log','‚ùå\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','ü§ñ\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','\x20USDT*\x0a','chargebackAmount','notificationApiError','setupBotHandlers','Failed\x20to\x20send\x20API\x20error\x20notification:','sendShopNotification','sendCustomNotification','Markdown','timestamp','23226070caKpkg','‚ùå\x20Telegram\x20bot\x20not\x20initialized','...\x22','initializeBot','shop','create','üåê\x20IP:\x20`','chat','getGatewayDisplayNameForTelegram','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','orderId','publicKey','Error\x20handling\x20/debug\x20command:','‚ùå\x20Please\x20use\x20/start\x20command\x20first','‚ùå\x20Error\x20sending\x20direct\x20message:','numeric','‚ùå\x20Error\x20sending\x20file\x20to\x20user\x20','chargeback','üÜî\x20Request\x20ID:\x20`','trim','\x20parts:\x20','\x22\x20->\x20display\x20\x22','\x20\x20\x20Status:\x20','includes','secretKey','‚ùå\x20Shop\x20with\x20username\x20`','\x0aüí°\x20Check\x20your\x20request\x20or\x20contact\x20support.','‚úÖ\x20File\x20sent\x20to\x20chat\x20','üîó\x20*Transaction\x20Link:*\x20`','‚úÖ\x20Login\x20notification\x20sent\x20for\x20shop\x20','gateway','Error\x20in\x20handleSingleLineVerification:','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','9bvnjxb','endsWith','sendShopFile','üìä\x20Error\x20code:\x20`','üìä\x20*Connection\x20Status*\x0a\x0a','Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.','default','üí≥\x20*Wallet:*\x20`',':\x20username=\x22','botUsername','pk_','‚ùå\x20Error\x20getting\x20debug\x20information.','en-US','Not\x20specified','‚ùå\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','üè™\x20Your\x20connected\x20shop:\x0a','‚úÖ\x20Connected\x20to\x20shop:\x20*','üìÖ\x20*Payout\x20Date:*\x20','*\x0a\x0a','2526903GZpLXz','__importDefault','5942181XamnUG','üì±\x20No\x20active\x20Telegram\x20users\x20found','.jpg','2-digit','startsWith','customerIp','\x20verified\x20for\x20shop\x20','üìÖ\x20Time:\x20','warn','application/octet-stream','remitterIban','Error\x20handling\x20message:','/disconnect\x20-\x20disconnect\x20from\x20notifications','unknown\x20shop','findUnique','\x22,\x20apiKey=\x22','toLocaleDateString','‚ùå\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','‚Ä¢\x20New\x20payments\x0a','errorMessage','sendNotificationToAll','/status\x20-\x20check\x20connection\x20status\x0a','stopBot','\x0a‚ö†Ô∏è\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','.pdf','üì±\x20Shop:\x20*','üìß\x20Email:\x20`','customerUa','\x20via\x20single-line\x20input','üìù\x20Order\x20ID:\x20`','blocked','\x20(@','üè™\x20Gateway:\x20`','handleSingleLineVerification','sendApiErrorNotification','notificationLogin','Commands:\x0a','Payment\x20is\x20being\x20processed','sendPaymentNotification','‚úÖ\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','‚úÖ\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','substring','image/png','Telegram\x20bot\x20polling\x20error:','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','length','toLocaleString','ACTIVE','sendDocument','onText','‚ùå\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','\x20initialized\x20successfully','Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a',':\x20`','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','Use\x20/start\x20to\x20connect.','üì±\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','name','‚úÖ\x20Telegram\x20bot\x20@','status','üîî\x20Notifications\x20are\x20active\x0a\x0a','createdAt','shopId','‚ùå\x20Error\x20sending\x20file\x20to\x20chat:','txid','üí∞\x20*Amount:*\x20','*.\x0a\x0a','üÜî\x20Payment\x20ID:\x20`','geo','üîî\x20*','last_name','‚úÖ\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','üîî\x20You\x20receive\x20notifications\x20about:\x0a','To\x20reconnect,\x20use\x20the\x20/start\x20command','‚Ä¢\x20Payouts\x0a\x0a','üåê\x20IP\x20address:\x20`','telegramId','üì±\x20Created\x20new\x20Telegram\x20user:\x20','application/pdf','üí∏\x20*New\x20Payout*\x0a\x0a','‚ùå\x20Invalid\x20API\x20key\x20format.\x0a\x0a','adminNotes','success','sendMessage','New\x20payment\x20created','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','sendPayoutNotification','üìù\x20Notes:\x20','isVerified','bot','5745144oYHMiA','TELEGRAM_BOT_TOKEN','from','ipAddress','‚ùå\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','‚ùå\x20Invalid\x20username\x20format:\x20`','env','\x20disconnected\x20from\x20shop\x20','update','üîÑ\x20Processing\x20single-line\x20verification\x20for\x20user\x20','‚úÖ\x20File\x20sent\x20to\x20','36907VBeZUN','Payment\x20chargeback','customerName','../types/gateway','‚Ä¢\x20Payment\x20status\x20changes\x0a','getBotInfo','Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.','1251244HdTxUa','entries','telegramUser','üîî\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','currency','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','shopSettings','message','toString','\x20users\x20of\x20shop\x20','Payment\x20successfully\x20paid','Payment\x20refund','../config/database','polling_error','method','period','5NkTUPj','Example:\x0a','amount','.jpeg','statusCode','‚è≥\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','.png','botToken','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','‚ùå\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','__esModule','üìõ\x20Name:\x20`','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a','...','`\x0a\x0a','üíª\x20Browser:\x20`','üîç\x20*Debug\x20Information*\x0a\x0a','üîå\x20User\x20','üéâ\x20*Congratulations!*\x0a\x0a','‚ùå\x20Shop\x20`','TELEGRAM_BOT_USERNAME','Payment\x20expired','üîó\x20*Transaction\x20Link:*\x20Pending','‚è±Ô∏è\x20*Period:*\x20','11825032GbnDKc','findFirst','üõë\x20Telegram\x20bot\x20stopped','‚ùå\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','`\x20not\x20found.\x0a\x0a','text','52DpHCGO','‚ùå\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','sendLoginNotification','‚úÖ\x20Direct\x20message\x20sent\x20to\x20chat\x20','join','telegramBotService','üè¶\x20IBAN:\x20`','userAgent','\x0aüë§\x20*Customer\x20Information:*\x0a','sendDirectFile','`\x20is\x20inactive.\x0a\x0a','customerEmail','üö®\x20*API\x20Error*\x0a\x0a','Successful\x20login','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','‚ùå\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','error'];a78_0xf3a2=function(){return _0x1b1f96;};return a78_0xf3a2();}const node_telegram_bot_api_1=__importDefault(require(a78_0x5edc1c(0x14d))),database_1=__importDefault(require(a78_0x5edc1c(0x104))),gateway_1=require(a78_0x5edc1c(0xf4));class TelegramBotService{constructor(){const _0x463b9a=a78_0x5edc1c;this[_0x463b9a(0xe5)]=null,this['botToken']=process['env'][_0x463b9a(0xe7)]||'',this['botUsername']=process[_0x463b9a(0xec)][_0x463b9a(0x11d)]||'trapay_bot',this[_0x463b9a(0x10f)]?this[_0x463b9a(0x162)]():console['warn']('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}['initializeBot'](){const _0xb26ee9=a78_0x5edc1c;try{this[_0xb26ee9(0xe5)]=new node_telegram_bot_api_1[(_0xb26ee9(0x187))](this[_0xb26ee9(0x10f)],{'polling':!![]}),this[_0xb26ee9(0x159)](),console['log'](_0xb26ee9(0xc6)+this['botUsername']+_0xb26ee9(0xbf));}catch(_0x55c930){console[_0xb26ee9(0x137)](_0xb26ee9(0x1a7),_0x55c930);}}[a78_0x5edc1c(0x159)](){const _0x22519a=a78_0x5edc1c;if(!this[_0x22519a(0xe5)])return;this[_0x22519a(0xe5)]['onText'](/\/start/,async _0x49de7f=>{const _0x438228=_0x22519a,_0x1dd984=_0x49de7f[_0x438228(0x166)]['id'],_0x1720a6=_0x49de7f[_0x438228(0xe8)]?.['id'][_0x438228(0x100)](),_0x548dc9=_0x49de7f[_0x438228(0xe8)]?.[_0x438228(0x14c)],_0x43f0ee=_0x49de7f['from']?.['first_name'],_0x22a6f3=_0x49de7f['from']?.[_0x438228(0xd2)];if(!_0x1720a6)return;try{let _0x5d1d8b=await database_1[_0x438228(0x187)][_0x438228(0xfa)][_0x438228(0x1a4)]({'where':{'telegramId':_0x1720a6},'include':{'shop':!![]}});!_0x5d1d8b?(_0x5d1d8b=await database_1[_0x438228(0x187)][_0x438228(0xfa)][_0x438228(0x164)]({'data':{'telegramId':_0x1720a6,'username':_0x548dc9,'firstName':_0x43f0ee,'lastName':_0x22a6f3,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x438228(0x153)](_0x438228(0xd9)+_0x1720a6+_0x438228(0x1b5)+_0x548dc9+')')):_0x5d1d8b=await database_1[_0x438228(0x187)][_0x438228(0xfa)][_0x438228(0xee)]({'where':{'telegramId':_0x1720a6},'data':{'username':_0x548dc9,'firstName':_0x43f0ee,'lastName':_0x22a6f3},'include':{'shop':!![]}}),_0x5d1d8b[_0x438228(0xe4)]&&_0x5d1d8b[_0x438228(0xca)]&&_0x5d1d8b[_0x438228(0x163)]?await this[_0x438228(0xe5)]?.[_0x438228(0xdf)](_0x1dd984,'‚úÖ\x20Welcome\x20back!\x0a\x0a'+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x5d1d8b[_0x438228(0x163)][_0x438228(0xc5)]+'*\x0a')+(_0x438228(0x145)+_0x5d1d8b[_0x438228(0x163)][_0x438228(0x14c)]+'`\x0a\x0a')+_0x438228(0xd4)+'‚Ä¢\x20New\x20payments\x0a'+_0x438228(0xf5)+_0x438228(0xd6)+'Commands:\x0a'+_0x438228(0x1ab)+_0x438228(0x1a2),{'parse_mode':_0x438228(0x15d)}):(_0x5d1d8b[_0x438228(0xca)]&&!_0x5d1d8b[_0x438228(0xe4)]&&(await database_1[_0x438228(0x187)][_0x438228(0xfa)][_0x438228(0xee)]({'where':{'telegramId':_0x1720a6},'data':{'shopId':null,'isVerified':![]}}),console[_0x438228(0x153)]('üîÑ\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x1720a6)),await this[_0x438228(0xe5)]?.[_0x438228(0xdf)](_0x1dd984,_0x438228(0x155)+_0x438228(0xe1)+_0x438228(0x143)+_0x438228(0x109)+_0x438228(0x135)+_0x438228(0x150),{'parse_mode':'Markdown'}));}catch(_0x3474d4){console[_0x438228(0x137)]('Error\x20handling\x20/start\x20command:',_0x3474d4),await this[_0x438228(0xe5)]?.[_0x438228(0xdf)](_0x1dd984,_0x438228(0x136));}}),this[_0x22519a(0xe5)][_0x22519a(0xbd)](/\/disconnect/,async _0x4f36e5=>{const _0x3511a3=_0x22519a,_0x372b78=_0x4f36e5[_0x3511a3(0x166)]['id'],_0x262aa3=_0x4f36e5['from']?.['id'][_0x3511a3(0x100)]();if(!_0x262aa3)return;try{const _0x386a64=await database_1[_0x3511a3(0x187)]['telegramUser']['findUnique']({'where':{'telegramId':_0x262aa3},'include':{'shop':!![]}});if(!_0x386a64||!_0x386a64[_0x3511a3(0xe4)]||!_0x386a64['shopId']){await this[_0x3511a3(0xe5)]?.['sendMessage'](_0x372b78,_0x3511a3(0x111));return;}const _0x4fb95e=_0x386a64[_0x3511a3(0x163)]?.[_0x3511a3(0xc5)]||_0x3511a3(0x1a3);await database_1[_0x3511a3(0x187)][_0x3511a3(0xfa)][_0x3511a3(0xee)]({'where':{'telegramId':_0x262aa3},'data':{'shopId':null,'isVerified':![]}}),console[_0x3511a3(0x153)](_0x3511a3(0x11a)+_0x262aa3+_0x3511a3(0xed)+_0x386a64[_0x3511a3(0xca)]),await this[_0x3511a3(0xe5)]?.[_0x3511a3(0xdf)](_0x372b78,_0x3511a3(0xb4)+_0x4fb95e+_0x3511a3(0xce)+_0x3511a3(0xd5),{'parse_mode':_0x3511a3(0x15d)});}catch(_0x19dece){console[_0x3511a3(0x137)]('Error\x20handling\x20/disconnect\x20command:',_0x19dece),await this[_0x3511a3(0xe5)]?.['sendMessage'](_0x372b78,_0x3511a3(0x136));}}),this[_0x22519a(0xe5)][_0x22519a(0xbd)](/\/status/,async _0x499536=>{const _0x58ba14=_0x22519a,_0x321e47=_0x499536[_0x58ba14(0x166)]['id'],_0x44aa34=_0x499536['from']?.['id']['toString']();if(!_0x44aa34)return;try{const _0x49ca56=await database_1[_0x58ba14(0x187)][_0x58ba14(0xfa)][_0x58ba14(0x1a4)]({'where':{'telegramId':_0x44aa34},'include':{'shop':!![]}});if(!_0x49ca56){await this[_0x58ba14(0xe5)]?.[_0x58ba14(0xdf)](_0x321e47,_0x58ba14(0xbe)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x49ca56[_0x58ba14(0xe4)]||!_0x49ca56[_0x58ba14(0xca)]||!_0x49ca56[_0x58ba14(0x163)]){await this[_0x58ba14(0xe5)]?.[_0x58ba14(0xdf)](_0x321e47,_0x58ba14(0x110)+_0x58ba14(0xc3));return;}await this[_0x58ba14(0xe5)]?.[_0x58ba14(0xdf)](_0x321e47,_0x58ba14(0x185)+(_0x58ba14(0x191)+_0x49ca56['shop'][_0x58ba14(0xc5)]+'*\x0a')+('üë§\x20Username:\x20`'+_0x49ca56[_0x58ba14(0x163)]['username']+'`\x0a')+('üìÖ\x20Connection\x20date:\x20'+_0x49ca56['updatedAt'][_0x58ba14(0x1a6)](_0x58ba14(0x18d))+'\x0a\x0a')+_0x58ba14(0xc8)+_0x58ba14(0x1ba)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x58ba14(0x15d)});}catch(_0x4b7321){console['error']('Error\x20handling\x20/status\x20command:',_0x4b7321),await this['bot']?.[_0x58ba14(0xdf)](_0x321e47,_0x58ba14(0x136));}}),this[_0x22519a(0xe5)][_0x22519a(0xbd)](/\/debug/,async _0x56f3ba=>{const _0x27fc21=_0x22519a,_0x550763=_0x56f3ba[_0x27fc21(0x166)]['id'],_0x4bf914=_0x56f3ba[_0x27fc21(0xe8)]?.['id']['toString']();if(!_0x4bf914)return;try{const _0x3b7080=await database_1[_0x27fc21(0x187)]['telegramUser'][_0x27fc21(0x1a4)]({'where':{'telegramId':_0x4bf914},'include':{'shop':!![]}});let _0x4a3a13=_0x27fc21(0x119);_0x4a3a13+=_0x27fc21(0x14a)+_0x4bf914+_0x27fc21(0x117),_0x3b7080?.['isVerified']&&_0x3b7080[_0x27fc21(0x163)]?(_0x4a3a13+=_0x27fc21(0x190),_0x4a3a13+=_0x27fc21(0x141)+_0x3b7080[_0x27fc21(0x163)]['name']+'*\x0a',_0x4a3a13+=_0x27fc21(0x142)+_0x3b7080['shop']['username']+'`\x0a',_0x4a3a13+=_0x27fc21(0x175)+_0x3b7080[_0x27fc21(0x163)][_0x27fc21(0xc7)]+'\x0a\x0a'):_0x4a3a13+=_0x27fc21(0x115),_0x4a3a13+=_0x27fc21(0xf7),await this['bot']?.[_0x27fc21(0xdf)](_0x550763,_0x4a3a13,{'parse_mode':_0x27fc21(0x15d)});}catch(_0x34f619){console[_0x27fc21(0x137)](_0x27fc21(0x16b),_0x34f619),await this['bot']?.[_0x27fc21(0xdf)](_0x550763,_0x27fc21(0x18c));}}),this[_0x22519a(0xe5)]['on'](_0x22519a(0xff),async _0x4cd9fd=>{const _0xda075c=_0x22519a;if(_0x4cd9fd['text']?.['startsWith']('/'))return;const _0x14a8c5=_0x4cd9fd[_0xda075c(0x166)]['id'],_0x119a26=_0x4cd9fd['from']?.['id']['toString'](),_0x3d0d8b=_0x4cd9fd[_0xda075c(0x126)]?.[_0xda075c(0x172)]();if(!_0x119a26||!_0x3d0d8b)return;try{const _0x2e8569=await database_1[_0xda075c(0x187)]['telegramUser'][_0xda075c(0x1a4)]({'where':{'telegramId':_0x119a26},'include':{'shop':!![]}});if(!_0x2e8569){await this[_0xda075c(0xe5)]?.[_0xda075c(0xdf)](_0x14a8c5,_0xda075c(0x16c));return;}if(_0x2e8569[_0xda075c(0xe4)]&&_0x2e8569[_0xda075c(0xca)]&&_0x2e8569['shop']){await this['bot']?.[_0xda075c(0xdf)](_0x14a8c5,_0xda075c(0xb3)+_0x2e8569[_0xda075c(0x163)]['name']+_0xda075c(0xce)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0xda075c(0x15d)});return;}const _0x4295e8=_0x3d0d8b['split'](/\s+/);if(_0x4295e8[_0xda075c(0xb9)]!==0x2){await this[_0xda075c(0xe5)]?.['sendMessage'](_0x14a8c5,_0xda075c(0x18f)+_0xda075c(0x143)+_0xda075c(0x109)+_0xda075c(0x135)+('You\x20sent\x20'+_0x4295e8['length']+_0xda075c(0x173)+_0x4295e8[_0xda075c(0x149)](_0x43406e=>'`'+_0x43406e+'`')[_0xda075c(0x12b)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x311e71,_0x5cb19f]=_0x4295e8;console[_0xda075c(0x153)](_0xda075c(0xef)+_0x119a26+_0xda075c(0x189)+_0x311e71+_0xda075c(0x1a5)+_0x5cb19f['substring'](0x0,0xa)+_0xda075c(0x161)),await this['handleSingleLineVerification'](_0x14a8c5,_0x119a26,_0x311e71,_0x5cb19f);}catch(_0x21e9b7){console['error'](_0xda075c(0x1a1),_0x21e9b7),await this['bot']?.[_0xda075c(0xdf)](_0x14a8c5,_0xda075c(0x136));}}),this[_0x22519a(0xe5)]['on']('error',_0x74d655=>{const _0x77d5f3=_0x22519a;console[_0x77d5f3(0x137)]('Telegram\x20bot\x20error:',_0x74d655);}),this[_0x22519a(0xe5)]['on'](_0x22519a(0x105),_0x4ac6b6=>{const _0x21857a=_0x22519a;console[_0x21857a(0x137)](_0x21857a(0xb7),_0x4ac6b6);});}async[a78_0x5edc1c(0x1b7)](_0x3c238c,_0x333a56,_0x10a7fc,_0xb2c4d4){const _0x14c4f2=a78_0x5edc1c;try{console[_0x14c4f2(0x153)](_0x14c4f2(0xef)+_0x333a56+_0x14c4f2(0x189)+_0x10a7fc+_0x14c4f2(0x1a5)+_0xb2c4d4[_0x14c4f2(0xb5)](0x0,0xa)+_0x14c4f2(0x161));if(!_0x10a7fc||_0x10a7fc[_0x14c4f2(0xb9)]<0x3||_0x10a7fc['length']>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x10a7fc)){await this['bot']?.[_0x14c4f2(0xdf)](_0x3c238c,_0x14c4f2(0xeb)+_0x10a7fc+_0x14c4f2(0x117)+_0x14c4f2(0xb8),{'parse_mode':_0x14c4f2(0x15d)});return;}if(!_0xb2c4d4||!_0xb2c4d4[_0x14c4f2(0x19a)](_0x14c4f2(0x18b))&&!_0xb2c4d4[_0x14c4f2(0x19a)](_0x14c4f2(0x138))){await this[_0x14c4f2(0xe5)]?.[_0x14c4f2(0xdf)](_0x3c238c,_0x14c4f2(0xdc)+_0x14c4f2(0xc2),{'parse_mode':'Markdown'});return;}const _0x5749b2=await database_1['default'][_0x14c4f2(0x163)][_0x14c4f2(0x1a4)]({'where':{'username':_0x10a7fc},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x5749b2){const _0x319e45=_0x14c4f2(0x178)+_0x10a7fc+_0x14c4f2(0x125)+_0x14c4f2(0xc0)+_0x14c4f2(0x186);await this['bot']?.[_0x14c4f2(0xdf)](_0x3c238c,_0x319e45,{'parse_mode':'Markdown'});return;}if(_0x5749b2[_0x14c4f2(0xc7)]!==_0x14c4f2(0xbb)){await this[_0x14c4f2(0xe5)]?.['sendMessage'](_0x3c238c,_0x14c4f2(0x11c)+_0x10a7fc+_0x14c4f2(0x131)+'Contact\x20administrator.',{'parse_mode':_0x14c4f2(0x15d)});return;}if(_0x5749b2[_0x14c4f2(0x16a)]!==_0xb2c4d4&&_0x5749b2[_0x14c4f2(0x177)]!==_0xb2c4d4){await this[_0x14c4f2(0xe5)]?.[_0x14c4f2(0xdf)](_0x3c238c,_0x14c4f2(0xea)+_0x10a7fc+'`.\x0a\x0a'+_0x14c4f2(0x14e)+_0x14c4f2(0x17f),{'parse_mode':_0x14c4f2(0x15d)});return;}const _0x1691e5=await database_1['default'][_0x14c4f2(0xfa)][_0x14c4f2(0x122)]({'where':{'shopId':_0x5749b2['id'],'isVerified':!![],'telegramId':{'not':_0x333a56}}});if(_0x1691e5){await this[_0x14c4f2(0xe5)]?.[_0x14c4f2(0xdf)](_0x3c238c,_0x14c4f2(0x128)+_0x10a7fc+'`.\x0a\x0a'+_0x14c4f2(0x180),{'parse_mode':'Markdown'});return;}await database_1[_0x14c4f2(0x187)][_0x14c4f2(0xfa)][_0x14c4f2(0xee)]({'where':{'telegramId':_0x333a56},'data':{'shopId':_0x5749b2['id'],'isVerified':!![]}}),await this[_0x14c4f2(0xe5)]?.[_0x14c4f2(0xdf)](_0x3c238c,_0x14c4f2(0x11b)+_0x14c4f2(0xd3)+(_0x14c4f2(0x1af)+_0x5749b2[_0x14c4f2(0xc5)]+'*\x0a')+('üë§\x20Username:\x20`'+_0x5749b2['username']+'`\x0a\x0a')+_0x14c4f2(0xfb)+_0x14c4f2(0x1a8)+_0x14c4f2(0xf5)+'‚Ä¢\x20Payouts\x0a'+'‚Ä¢\x20Important\x20events\x0a\x0a'+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x14c4f2(0x1a2),{'parse_mode':_0x14c4f2(0x15d)}),console[_0x14c4f2(0x153)]('‚úÖ\x20Telegram\x20user\x20'+_0x333a56+_0x14c4f2(0x19c)+_0x5749b2[_0x14c4f2(0x14c)]+_0x14c4f2(0x1b2));}catch(_0x30af2e){console[_0x14c4f2(0x137)](_0x14c4f2(0x17e),_0x30af2e),await this[_0x14c4f2(0xe5)]?.['sendMessage'](_0x3c238c,_0x14c4f2(0x154));}}async[a78_0x5edc1c(0x15b)](_0x42676f,_0x394941,_0x37a4b7){const _0x274797=a78_0x5edc1c;if(!this[_0x274797(0xe5)]){console[_0x274797(0x19e)](_0x274797(0x168));return;}try{const _0x2cda89=await database_1['default']['telegramUser'][_0x274797(0x13c)]({'where':{'shopId':_0x42676f,'isVerified':!![]}});if(_0x2cda89[_0x274797(0xb9)]===0x0){console[_0x274797(0x153)](_0x274797(0xfd)+_0x42676f);return;}const _0x4e300a=_0x2cda89['map'](async _0x112403=>{const _0x38a696=_0x274797;try{await this[_0x38a696(0xe5)]?.[_0x38a696(0xdf)](_0x112403['telegramId'],_0x394941,_0x37a4b7),console[_0x38a696(0x153)]('‚úÖ\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x112403['telegramId']);}catch(_0x17a383){console[_0x38a696(0x137)](_0x38a696(0x124)+_0x112403[_0x38a696(0xd8)]+':',_0x17a383),_0x17a383 instanceof Error&&(_0x17a383['message'][_0x38a696(0x176)](_0x38a696(0x1b4))||_0x17a383['message'][_0x38a696(0x176)](_0x38a696(0x13b))||_0x17a383[_0x38a696(0xff)][_0x38a696(0x176)]('user\x20is\x20deactivated'))&&(await database_1['default'][_0x38a696(0xfa)][_0x38a696(0xee)]({'where':{'id':_0x112403['id']},'data':{'isVerified':![]}}),console[_0x38a696(0x153)]('User\x20'+_0x112403[_0x38a696(0xd8)]+_0x38a696(0x152)));}});await Promise[_0x274797(0x14b)](_0x4e300a);}catch(_0x1b66a8){console[_0x274797(0x137)]('Error\x20sending\x20shop\x20notification:',_0x1b66a8);}}async[a78_0x5edc1c(0x1bc)](_0x36ffa5,_0x29010c,_0x3499a2){const _0x11832d=a78_0x5edc1c,_0x557542={'created':'üÜï','paid':'‚úÖ','failed':'‚ùå','expired':'‚è∞','refund':'üîÑ','chargeback':'‚ö†Ô∏è','processing':'‚öôÔ∏è'},_0x62e4ed={'created':_0x11832d(0xe0),'paid':_0x11832d(0x102),'failed':'Payment\x20failed','expired':_0x11832d(0x11e),'refund':_0x11832d(0x103),'chargeback':_0x11832d(0xf2),'processing':_0x11832d(0x1bb)},_0x46e0ae=_0x557542[_0x3499a2],_0x519d3d=_0x62e4ed[_0x3499a2],_0x26fc84=(0x0,gateway_1[_0x11832d(0x167)])(_0x29010c['gateway']);console[_0x11832d(0x153)]('üì±\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x29010c[_0x11832d(0x17d)]+_0x11832d(0x174)+_0x26fc84+'\x22');let _0x3293e1=_0x46e0ae+'\x20*'+_0x519d3d+'*\x0a\x0a'+('üí∞\x20Amount:\x20*'+_0x29010c[_0x11832d(0x10a)]+'\x20'+_0x29010c[_0x11832d(0xfc)]+'*\x0a')+(_0x11832d(0x1b3)+(_0x29010c[_0x11832d(0x169)]||_0x29010c['id'])+'`\x0a')+(_0x11832d(0xcf)+_0x29010c['id']+'`\x0a')+(_0x11832d(0x1b6)+_0x26fc84+'`\x0a')+('üìÖ\x20Date:\x20'+new Date(_0x29010c['createdAt'])[_0x11832d(0xba)](_0x11832d(0x18d))+'\x0a');if(_0x29010c['customerName']||_0x29010c[_0x11832d(0x132)]||_0x29010c[_0x11832d(0x1a0)]||_0x29010c[_0x11832d(0x19b)]||_0x29010c['customerUa']){_0x3293e1+=_0x11832d(0x12f);_0x29010c[_0x11832d(0xf3)]&&(_0x3293e1+=_0x11832d(0x114)+_0x29010c['customerName']+'`\x0a');_0x29010c[_0x11832d(0x132)]&&(_0x3293e1+=_0x11832d(0x1b0)+_0x29010c[_0x11832d(0x132)]+'`\x0a');_0x29010c['remitterIban']&&(_0x3293e1+=_0x11832d(0x12d)+_0x29010c[_0x11832d(0x1a0)]+'`\x0a');_0x29010c[_0x11832d(0x19b)]&&(_0x3293e1+=_0x11832d(0x165)+_0x29010c[_0x11832d(0x19b)]+'`\x0a');if(_0x29010c[_0x11832d(0x1b1)]){const _0x14047a=_0x29010c[_0x11832d(0x1b1)]['length']>0x32?_0x29010c[_0x11832d(0x1b1)]['substring'](0x0,0x32)+_0x11832d(0x116):_0x29010c[_0x11832d(0x1b1)];_0x3293e1+=_0x11832d(0x118)+_0x14047a+'`\x0a';}}_0x3499a2===_0x11832d(0x170)&&_0x29010c['chargebackAmount']&&(_0x3293e1+=_0x11832d(0x13d)+_0x29010c[_0x11832d(0x157)]+_0x11832d(0x156)),_0x3499a2==='processing'&&(_0x3293e1+=_0x11832d(0x10d)),_0x29010c[_0x11832d(0xdd)]&&(_0x3293e1+=_0x11832d(0xe3)+_0x29010c['adminNotes']+'\x0a'),await this[_0x11832d(0x15b)](_0x36ffa5,_0x3293e1,{'parse_mode':_0x11832d(0x15d)});}async[a78_0x5edc1c(0xe2)](_0x22feeb,_0x4b2b9e){const _0x2c74f7=a78_0x5edc1c,_0x3e3a9b=new Date(_0x4b2b9e[_0x2c74f7(0xc9)])[_0x2c74f7(0xba)](_0x2c74f7(0x18d),{'year':_0x2c74f7(0x16e),'month':_0x2c74f7(0x199),'day':'2-digit','hour':_0x2c74f7(0x199),'minute':_0x2c74f7(0x199),'second':_0x2c74f7(0x199)}),_0x3f0625=_0x2c74f7(0xdb)+(_0x2c74f7(0x192)+_0x3e3a9b+'\x0a')+(_0x2c74f7(0xcd)+_0x4b2b9e[_0x2c74f7(0x10a)]+_0x2c74f7(0x144))+(_0x2c74f7(0x120)+(_0x4b2b9e[_0x2c74f7(0x107)]||_0x2c74f7(0x18e))+'\x0a')+(_0x2c74f7(0x151)+(_0x4b2b9e[_0x2c74f7(0x147)]||_0x2c74f7(0x18e))+'\x0a')+(_0x2c74f7(0x188)+(_0x4b2b9e['wallet']||_0x2c74f7(0x18e))+'`\x0a')+(_0x4b2b9e[_0x2c74f7(0xcc)]?_0x2c74f7(0x17b)+_0x4b2b9e['txid']+'`':_0x2c74f7(0x11f));await this[_0x2c74f7(0x15b)](_0x22feeb,_0x3f0625,{'parse_mode':_0x2c74f7(0x15d)});}async[a78_0x5edc1c(0x129)](_0x5fd25,_0x36dd7f){const _0x5691c3=a78_0x5edc1c;try{const _0x51e632=await database_1['default']['shopSettings']['findUnique']({'where':{'shopId':_0x5fd25},'select':{'notificationLogin':!![]}});if(!_0x51e632?.[_0x5691c3(0x1b9)]){console[_0x5691c3(0x153)]('üì±\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x5fd25);return;}const _0x289ea7=_0x36dd7f[_0x5691c3(0xde)]?'üîê':'üö®',_0x3b636c=_0x36dd7f[_0x5691c3(0xde)]?_0x5691c3(0x134):'Failed\x20login\x20attempt';let _0xe18d3e=_0x289ea7+'\x20*'+_0x3b636c+_0x5691c3(0x193)+('üë§\x20Username:\x20`'+_0x36dd7f['username']+'`\x0a')+(_0x5691c3(0x19d)+_0x36dd7f[_0x5691c3(0x15e)]['toLocaleString']('en-US')+'\x0a');_0x36dd7f[_0x5691c3(0xe9)]&&(_0xe18d3e+=_0x5691c3(0xd7)+_0x36dd7f[_0x5691c3(0xe9)]+'`\x0a');_0x36dd7f[_0x5691c3(0xd0)]&&(_0xe18d3e+='üåç\x20Country:\x20'+_0x36dd7f[_0x5691c3(0xd0)]+'\x0a');if(_0x36dd7f[_0x5691c3(0x12e)]){const _0x6c8f21=_0x36dd7f[_0x5691c3(0x12e)][_0x5691c3(0xb9)]>0x32?_0x36dd7f[_0x5691c3(0x12e)][_0x5691c3(0xb5)](0x0,0x32)+'...':_0x36dd7f['userAgent'];_0xe18d3e+=_0x5691c3(0x118)+_0x6c8f21+'`\x0a';}!_0x36dd7f[_0x5691c3(0xde)]&&(_0xe18d3e+=_0x5691c3(0x1ad)),await this[_0x5691c3(0x15b)](_0x5fd25,_0xe18d3e,{'parse_mode':_0x5691c3(0x15d)}),console[_0x5691c3(0x153)](_0x5691c3(0x17c)+_0x5fd25+':\x20'+(_0x36dd7f[_0x5691c3(0xde)]?_0x5691c3(0xde):'failed'));}catch(_0x2e9316){console[_0x5691c3(0x137)]('Failed\x20to\x20send\x20login\x20notification:',_0x2e9316);}}async[a78_0x5edc1c(0x1b8)](_0x46ea67,_0x4f0f82){const _0x5ac28e=a78_0x5edc1c;try{const _0x4d9ee2=await database_1[_0x5ac28e(0x187)][_0x5ac28e(0xfe)][_0x5ac28e(0x1a4)]({'where':{'shopId':_0x46ea67},'select':{'notificationApiError':!![]}});if(!_0x4d9ee2?.[_0x5ac28e(0x158)]){console[_0x5ac28e(0x153)](_0x5ac28e(0x139)+_0x46ea67);return;}let _0x16402e=_0x5ac28e(0x133)+(_0x5ac28e(0x140)+_0x4f0f82[_0x5ac28e(0x106)]+'\x20'+_0x4f0f82[_0x5ac28e(0x14f)]+'`\x0a')+(_0x5ac28e(0x19d)+_0x4f0f82[_0x5ac28e(0x15e)][_0x5ac28e(0xba)]('en-US')+'\x0a');_0x4f0f82[_0x5ac28e(0x10c)]&&(_0x16402e+=_0x5ac28e(0x184)+_0x4f0f82[_0x5ac28e(0x10c)]+'`\x0a'),_0x16402e+='‚ùå\x20Error:\x20`'+_0x4f0f82[_0x5ac28e(0x1a9)]+'`\x0a',_0x4f0f82[_0x5ac28e(0x13a)]&&(_0x16402e+=_0x5ac28e(0x171)+_0x4f0f82[_0x5ac28e(0x13a)]+'`\x0a'),_0x16402e+=_0x5ac28e(0x179),await this[_0x5ac28e(0x15b)](_0x46ea67,_0x16402e,{'parse_mode':'Markdown'}),console[_0x5ac28e(0x153)]('‚úÖ\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x46ea67+':\x20'+_0x4f0f82[_0x5ac28e(0x14f)]);}catch(_0x35aca2){console[_0x5ac28e(0x137)](_0x5ac28e(0x15a),_0x35aca2);}}async[a78_0x5edc1c(0x15c)](_0x26e11a,_0x1d8790,_0x4117cc){const _0x52aa3a=a78_0x5edc1c;let _0x168cca=_0x52aa3a(0xd1)+_0x1d8790+'*\x0a\x0a';for(const [_0x48a5e1,_0x547c6a]of Object[_0x52aa3a(0xf9)](_0x4117cc)){_0x547c6a!==null&&_0x547c6a!==undefined&&(_0x168cca+=_0x48a5e1+_0x52aa3a(0xc1)+_0x547c6a+'`\x0a');}await this['sendShopNotification'](_0x26e11a,_0x168cca,{'parse_mode':'Markdown'});}async[a78_0x5edc1c(0x1aa)](_0x219c92){const _0x21629c=a78_0x5edc1c;try{console['log'](_0x21629c(0xc4)+_0x219c92['substring'](0x0,0x32)+_0x21629c(0x116));const _0x25e906=await database_1[_0x21629c(0x187)]['telegramUser'][_0x21629c(0x13c)]({'select':{'telegramId':!![]}});if(_0x25e906[_0x21629c(0xb9)]===0x0){console[_0x21629c(0x153)](_0x21629c(0x197));return;}for(const _0x5a7907 of _0x25e906){try{await this['bot']?.[_0x21629c(0xdf)](_0x5a7907[_0x21629c(0xd8)],_0x219c92,{'parse_mode':_0x21629c(0x15d)});}catch(_0x220d93){console[_0x21629c(0x137)]('‚ùå\x20Failed\x20to\x20send\x20message\x20to\x20user\x20'+_0x5a7907[_0x21629c(0xd8)]+':',_0x220d93);}}console[_0x21629c(0x153)]('üì±\x20Notification\x20sent\x20to\x20'+_0x25e906['length']+'\x20users');}catch(_0x33d375){console['error']('‚ùå\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:',_0x33d375);}}[a78_0x5edc1c(0xf6)](){const _0x57404c=a78_0x5edc1c;return{'isActive':!!this[_0x57404c(0xe5)],'username':this[_0x57404c(0x18a)]};}async[a78_0x5edc1c(0x183)](_0x1a015f,_0x37683d,_0x1a0940,_0x22be83){const _0x28c8bf=a78_0x5edc1c;try{if(!this['bot'])return console['error'](_0x28c8bf(0x160)),![];const _0x1b2273=await database_1['default'][_0x28c8bf(0xfa)][_0x28c8bf(0x13c)]({'where':{'shopId':_0x1a015f,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x1b2273[_0x28c8bf(0xb9)]===0x0)return console[_0x28c8bf(0x137)](_0x28c8bf(0x112)+_0x1a015f),![];let _0x2f6d54=0x0;for(const _0x1d7e36 of _0x1b2273){try{await this[_0x28c8bf(0xe5)][_0x28c8bf(0xbc)](_0x1d7e36[_0x28c8bf(0xd8)],_0x37683d,{},{'filename':_0x1a0940,'contentType':_0x1a0940[_0x28c8bf(0x182)](_0x28c8bf(0x10e))?_0x28c8bf(0xb6):_0x1a0940[_0x28c8bf(0x182)](_0x28c8bf(0x198))||_0x1a0940['endsWith'](_0x28c8bf(0x10b))?'image/jpeg':_0x1a0940[_0x28c8bf(0x182)]('.pdf')?_0x28c8bf(0xda):_0x28c8bf(0x19f)}),_0x22be83&&await this['bot']['sendMessage'](_0x1d7e36['telegramId'],_0x22be83),_0x2f6d54++;}catch(_0x1ec93d){console['error'](_0x28c8bf(0x16f)+_0x1d7e36[_0x28c8bf(0xd8)]+':',_0x1ec93d);}}return console[_0x28c8bf(0x153)](_0x28c8bf(0xf0)+_0x2f6d54+'/'+_0x1b2273['length']+_0x28c8bf(0x101)+_0x1a015f+':\x20'+_0x1a0940),_0x2f6d54>0x0;}catch(_0xdb6f08){return console[_0x28c8bf(0x137)](_0x28c8bf(0x148),_0xdb6f08),![];}}async[a78_0x5edc1c(0x146)](_0x31b507,_0x52b965){const _0x2747d2=a78_0x5edc1c;try{if(!this[_0x2747d2(0xe5)])return console[_0x2747d2(0x137)]('‚ùå\x20Telegram\x20bot\x20not\x20initialized'),![];return await this['bot'][_0x2747d2(0xdf)](_0x31b507,_0x52b965),console[_0x2747d2(0x153)](_0x2747d2(0x12a)+_0x31b507),!![];}catch(_0x25a753){return console[_0x2747d2(0x137)](_0x2747d2(0x16d),_0x25a753),![];}}async[a78_0x5edc1c(0x130)](_0x162e94,_0x34822b,_0x57f4da,_0x2b66fd){const _0x119108=a78_0x5edc1c;try{if(!this[_0x119108(0xe5)])return console[_0x119108(0x137)]('‚ùå\x20Telegram\x20bot\x20not\x20initialized'),![];return await this[_0x119108(0xe5)]['sendDocument'](_0x162e94,_0x34822b,{},{'filename':_0x57f4da,'contentType':_0x57f4da[_0x119108(0x182)]('.png')?_0x119108(0xb6):_0x57f4da[_0x119108(0x182)](_0x119108(0x198))||_0x57f4da[_0x119108(0x182)](_0x119108(0x10b))?_0x119108(0x13f):_0x57f4da['endsWith'](_0x119108(0x1ae))?_0x119108(0xda):_0x119108(0x19f)}),_0x2b66fd&&await this['bot']['sendMessage'](_0x162e94,_0x2b66fd),console[_0x119108(0x153)](_0x119108(0x17a)+_0x162e94+':\x20'+_0x57f4da),!![];}catch(_0x67013e){return console[_0x119108(0x137)](_0x119108(0xcb),_0x67013e),![];}}[a78_0x5edc1c(0x1ac)](){const _0x5698b1=a78_0x5edc1c;this[_0x5698b1(0xe5)]&&(this['bot']['stopPolling'](),this[_0x5698b1(0xe5)]=null,console[_0x5698b1(0x153)](_0x5698b1(0x123)));}}function a78_0x42c6(_0x103fd9,_0x1d687b){_0x103fd9=_0x103fd9-0xb3;const _0xf3a217=a78_0xf3a2();let _0x42c67b=_0xf3a217[_0x103fd9];return _0x42c67b;}exports[a78_0x5edc1c(0x13e)]=TelegramBotService,exports[a78_0x5edc1c(0x12c)]=new TelegramBotService();