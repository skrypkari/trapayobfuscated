'use strict';const a61_0x257e71=a61_0x2a90;function a61_0x1da9(){const _0x2459a5=['processing','shopId','log','includes','🚨\x20*API\x20Error*\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','*\x0a\x0a','💸\x20Penalty\x20amount:\x20*','Use\x20/start\x20to\x20begin.','username','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','Payment\x20successfully\x20paid','❌\x20Error:\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','handleSingleLineVerification','polling_error','create','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','Contact\x20administrator.','9MMeDUK','notificationLogin','Payment\x20chargeback','\x20via\x20single-line\x20input','📅\x20Time:\x20','shopSettings','•\x20Important\x20events\x0a\x0a','`\x0a\x0a','TelegramBotService','sendMessage','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','customerName','New\x20payment\x20created','2ppXRDb','update','warn','toLocaleString','defineProperty','🔔\x20Notifications\x20are\x20active\x0a\x0a','Failed\x20login\x20attempt','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','stopPolling','537654ccrFmu','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','📱\x20Notification\x20sent\x20to\x20','...','🔗\x20TXID:\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a','createdAt','chargeback','📅\x20Date:\x20','\x22\x20->\x20display\x20\x22','sendLoginNotification','User\x20','publicKey','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','setupBotHandlers','default','first_name','status','statusCode','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','📛\x20Name:\x20`','📝\x20Order\x20ID:\x20`','`\x20not\x20found.\x0a\x0a','substring','updatedAt','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','📱\x20Your\x20Telegram\x20ID:\x20`','findUnique','💰\x20Amount:\x20*','customerIp','sendShopNotification','🏦\x20IBAN:\x20`','errorMessage','💸\x20Amount:\x20*','Telegram\x20bot\x20error:','\x0a👤\x20*Customer\x20Information:*\x0a','ipAddress','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','\x20\x20\x20Public\x20Key:\x20`','stopBot','📊\x20Error\x20code:\x20`','\x20users','ACTIVE','map','txid','env','\x20\x20\x20Status:\x20','✅\x20Telegram\x20user\x20','chat','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Payment\x20is\x20being\x20processed','shop','sendApiErrorNotification',':\x20`','\x0aCheck\x20spelling\x20and\x20try\x20again.','455372dBSspR','length','findMany','`\x20(','getGatewayDisplayNameForTelegram','../config/database','New\x20payout\x20created','notificationApiError','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','✅\x20Connected\x20to\x20shop:\x20*','•\x20Payment\x20status\x20changes\x0a','\x22,\x20apiKey=\x22','entries','\x20USDT*\x0a','Payment\x20expired','Failed\x20to\x20send\x20login\x20notification:','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','Username:\x20`','•\x20New\x20payments\x0a','onText','/status\x20-\x20check\x20connection\x20status\x0a','Error\x20sending\x20shop\x20notification:','6792230tyVarC','message','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','...\x22','last_name','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a',':\x20username=\x22','endpoint','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','💻\x20Browser:\x20`','Error\x20handling\x20/debug\x20command:','❌\x20Shop\x20with\x20username\x20`','110868BqxEcu','__importDefault','currency','node-telegram-bot-api','sendNotificationToAll','user\x20is\x20deactivated','chargebackAmount','sk_','`.\x0a\x0a','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','📱\x20Shop:\x20*','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','isVerified','.\x20*','join','failed','requestId','•\x20Payouts\x0a\x0a','📝\x20Notes:\x20','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','\x20\x20\x20Username:\x20`','TELEGRAM_BOT_TOKEN','✅\x20Welcome\x20back!\x0a\x0a','from','error','gateway','bot','en-US','📅\x20Connection\x20date:\x20','🆔\x20Payment\x20ID:\x20`','text','TELEGRAM_BOT_USERNAME','\x20parts:\x20','•\x20`','Example:\x0a','403543FYkgQe','Payout\x20rejected','name','•\x20Payouts\x0a','sendPaymentNotification','`\x20is\x20inactive.\x0a\x0a','*.\x0a\x0a','forEach','userAgent','telegramId','\x20disconnected\x20from\x20shop\x20','botUsername','8IbBOXa','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','success','🏦\x20Method:\x20`','👤\x20Username:\x20`','adminNotes','Error\x20in\x20handleSingleLineVerification:','remitterIban','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','Markdown','Commands:\x0a','📱\x20Created\x20new\x20Telegram\x20user:\x20','Telegram\x20bot\x20polling\x20error:','toString','customerEmail','toLocaleDateString','unknown\x20shop','trapay_bot','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','initializeBot','startsWith','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','orderId','1803777MjoORZ','customerUa','getBotInfo','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','test','🌐\x20IP\x20address:\x20`','telegramUser','🆔\x20Request\x20ID:\x20`','1177lbkKfC','115067SbnQdV','Payment\x20failed','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','amount','method','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','\x20USD*\x0a','chat\x20not\x20found','secretKey','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Available\x20usernames:\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','🔗\x20Endpoint:\x20`','timestamp','Error\x20handling\x20/start\x20command:','❌\x20Shop\x20`','Payout\x20completed','15jwcBXi','📊\x20*Connection\x20Status*\x0a\x0a'];a61_0x1da9=function(){return _0x2459a5;};return a61_0x1da9();}(function(_0x3b9567,_0x1b2096){const _0x38c6f8=a61_0x2a90,_0x25ae6f=_0x3b9567();while(!![]){try{const _0x47018f=-parseInt(_0x38c6f8(0x106))/0x1+parseInt(_0x38c6f8(0x13a))/0x2*(parseInt(_0x38c6f8(0xfd))/0x3)+parseInt(_0x38c6f8(0x17c))/0x4*(parseInt(_0x38c6f8(0x117))/0x5)+-parseInt(_0x38c6f8(0x143))/0x6+-parseInt(_0x38c6f8(0xda))/0x7*(parseInt(_0x38c6f8(0xe6))/0x8)+parseInt(_0x38c6f8(0x12d))/0x9*(parseInt(_0x38c6f8(0x192))/0xa)+parseInt(_0x38c6f8(0x105))/0xb*(-parseInt(_0x38c6f8(0x19e))/0xc);if(_0x47018f===_0x1b2096)break;else _0x25ae6f['push'](_0x25ae6f['shift']());}catch(_0x52a159){_0x25ae6f['push'](_0x25ae6f['shift']());}}}(a61_0x1da9,0x5a9a9));function a61_0x2a90(_0x339308,_0x247ed9){const _0x1da9be=a61_0x1da9();return a61_0x2a90=function(_0x2a90e9,_0xecc4d4){_0x2a90e9=_0x2a90e9-0xd8;let _0x393606=_0x1da9be[_0x2a90e9];return _0x393606;},a61_0x2a90(_0x339308,_0x247ed9);}var __importDefault=this&&this[a61_0x257e71(0x19f)]||function(_0x8cebd7){return _0x8cebd7&&_0x8cebd7['__esModule']?_0x8cebd7:{'default':_0x8cebd7};};Object[a61_0x257e71(0x13e)](exports,'__esModule',{'value':!![]}),exports['telegramBotService']=exports[a61_0x257e71(0x135)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a61_0x257e71(0x1a1))),database_1=__importDefault(require(a61_0x257e71(0x181))),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x3a02b5=a61_0x257e71;this[_0x3a02b5(0x1b8)]=null,this['botToken']=process[_0x3a02b5(0x172)][_0x3a02b5(0x1b3)]||'',this[_0x3a02b5(0xe5)]=process[_0x3a02b5(0x172)][_0x3a02b5(0x1bd)]||_0x3a02b5(0xf7),this['botToken']?this[_0x3a02b5(0xf9)]():console[_0x3a02b5(0x13c)](_0x3a02b5(0x108));}[a61_0x257e71(0xf9)](){const _0x3d1343=a61_0x257e71;try{this['bot']=new node_telegram_bot_api_1['default'](this['botToken'],{'polling':!![]}),this[_0x3d1343(0x151)](),console[_0x3d1343(0x11b)]('✅\x20Telegram\x20bot\x20@'+this[_0x3d1343(0xe5)]+'\x20initialized\x20successfully');}catch(_0x5ae84b){console[_0x3d1343(0x1b6)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x5ae84b);}}[a61_0x257e71(0x151)](){const _0x59f0c8=a61_0x257e71;if(!this[_0x59f0c8(0x1b8)])return;this['bot']['onText'](/\/start/,async _0x31ecad=>{const _0x7759de=_0x59f0c8,_0x23a8d9=_0x31ecad[_0x7759de(0x175)]['id'],_0x8a29c=_0x31ecad['from']?.['id'][_0x7759de(0xf3)](),_0x4bd223=_0x31ecad[_0x7759de(0x1b5)]?.[_0x7759de(0x122)],_0x4ad7f5=_0x31ecad['from']?.[_0x7759de(0x153)],_0xba92a5=_0x31ecad[_0x7759de(0x1b5)]?.[_0x7759de(0x196)];if(!_0x8a29c)return;try{let _0x46a4e6=await database_1[_0x7759de(0x152)][_0x7759de(0x103)][_0x7759de(0x160)]({'where':{'telegramId':_0x8a29c},'include':{'shop':!![]}});!_0x46a4e6?(_0x46a4e6=await database_1[_0x7759de(0x152)][_0x7759de(0x103)][_0x7759de(0x129)]({'data':{'telegramId':_0x8a29c,'username':_0x4bd223,'firstName':_0x4ad7f5,'lastName':_0xba92a5,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x7759de(0x11b)](_0x7759de(0xf1)+_0x8a29c+'\x20(@'+_0x4bd223+')')):_0x46a4e6=await database_1[_0x7759de(0x152)][_0x7759de(0x103)][_0x7759de(0x13b)]({'where':{'telegramId':_0x8a29c},'data':{'username':_0x4bd223,'firstName':_0x4ad7f5,'lastName':_0xba92a5},'include':{'shop':!![]}}),_0x46a4e6[_0x7759de(0x1aa)]&&_0x46a4e6[_0x7759de(0x11a)]&&_0x46a4e6[_0x7759de(0x178)]?await this[_0x7759de(0x1b8)]?.['sendMessage'](_0x23a8d9,_0x7759de(0x1b4)+(_0x7759de(0x100)+_0x46a4e6[_0x7759de(0x178)][_0x7759de(0xdc)]+'*\x0a')+(_0x7759de(0x18d)+_0x46a4e6[_0x7759de(0x178)]['username']+'`\x0a\x0a')+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x7759de(0x18e)+_0x7759de(0x186)+_0x7759de(0x1af)+'Commands:\x0a'+_0x7759de(0x190)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x7759de(0xef)}):(_0x46a4e6[_0x7759de(0x11a)]&&!_0x46a4e6[_0x7759de(0x1aa)]&&(await database_1[_0x7759de(0x152)][_0x7759de(0x103)][_0x7759de(0x13b)]({'where':{'telegramId':_0x8a29c},'data':{'shopId':null,'isVerified':![]}}),console[_0x7759de(0x11b)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x8a29c)),await this[_0x7759de(0x1b8)]?.[_0x7759de(0x136)](_0x23a8d9,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x7759de(0x10f)+_0x7759de(0x12a)+_0x7759de(0xd9)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x7759de(0xef)}));}catch(_0x41441c){console[_0x7759de(0x1b6)](_0x7759de(0x114),_0x41441c),await this[_0x7759de(0x1b8)]?.[_0x7759de(0x136)](_0x23a8d9,_0x7759de(0x123));}}),this[_0x59f0c8(0x1b8)]['onText'](/\/disconnect/,async _0x492ba3=>{const _0x55bfc2=_0x59f0c8,_0x159a16=_0x492ba3[_0x55bfc2(0x175)]['id'],_0x406be8=_0x492ba3[_0x55bfc2(0x1b5)]?.['id'][_0x55bfc2(0xf3)]();if(!_0x406be8)return;try{const _0x236e9f=await database_1[_0x55bfc2(0x152)]['telegramUser'][_0x55bfc2(0x160)]({'where':{'telegramId':_0x406be8},'include':{'shop':!![]}});if(!_0x236e9f||!_0x236e9f[_0x55bfc2(0x1aa)]||!_0x236e9f[_0x55bfc2(0x11a)]){await this[_0x55bfc2(0x1b8)]?.[_0x55bfc2(0x136)](_0x159a16,_0x55bfc2(0x11e));return;}const _0x1bdf92=_0x236e9f[_0x55bfc2(0x178)]?.[_0x55bfc2(0xdc)]||_0x55bfc2(0xf6);await database_1[_0x55bfc2(0x152)]['telegramUser']['update']({'where':{'telegramId':_0x406be8},'data':{'shopId':null,'isVerified':![]}}),console[_0x55bfc2(0x11b)]('🔌\x20User\x20'+_0x406be8+_0x55bfc2(0xe4)+_0x236e9f['shopId']),await this[_0x55bfc2(0x1b8)]?.[_0x55bfc2(0x136)](_0x159a16,_0x55bfc2(0xe7)+_0x1bdf92+_0x55bfc2(0xe0)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x55bfc2(0xef)});}catch(_0x4c73e0){console[_0x55bfc2(0x1b6)]('Error\x20handling\x20/disconnect\x20command:',_0x4c73e0),await this[_0x55bfc2(0x1b8)]?.[_0x55bfc2(0x136)](_0x159a16,_0x55bfc2(0x123));}}),this[_0x59f0c8(0x1b8)][_0x59f0c8(0x18f)](/\/status/,async _0x4664c3=>{const _0x44aa00=_0x59f0c8,_0x38af0d=_0x4664c3[_0x44aa00(0x175)]['id'],_0xb03338=_0x4664c3['from']?.['id'][_0x44aa00(0xf3)]();if(!_0xb03338)return;try{const _0x1a5e3e=await database_1[_0x44aa00(0x152)][_0x44aa00(0x103)][_0x44aa00(0x160)]({'where':{'telegramId':_0xb03338},'include':{'shop':!![]}});if(!_0x1a5e3e){await this['bot']?.['sendMessage'](_0x38af0d,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x44aa00(0x121));return;}if(!_0x1a5e3e[_0x44aa00(0x1aa)]||!_0x1a5e3e[_0x44aa00(0x11a)]||!_0x1a5e3e['shop']){await this[_0x44aa00(0x1b8)]?.[_0x44aa00(0x136)](_0x38af0d,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+'Use\x20/start\x20to\x20connect.');return;}await this[_0x44aa00(0x1b8)]?.[_0x44aa00(0x136)](_0x38af0d,_0x44aa00(0x118)+(_0x44aa00(0x185)+_0x1a5e3e[_0x44aa00(0x178)][_0x44aa00(0xdc)]+'*\x0a')+(_0x44aa00(0xea)+_0x1a5e3e['shop']['username']+'`\x0a')+(_0x44aa00(0x1ba)+_0x1a5e3e[_0x44aa00(0x15d)][_0x44aa00(0xf5)](_0x44aa00(0x1b9))+'\x0a\x0a')+_0x44aa00(0x13f)+'Commands:\x0a'+_0x44aa00(0x126),{'parse_mode':_0x44aa00(0xef)});}catch(_0x3e36b3){console[_0x44aa00(0x1b6)]('Error\x20handling\x20/status\x20command:',_0x3e36b3),await this[_0x44aa00(0x1b8)]?.[_0x44aa00(0x136)](_0x38af0d,_0x44aa00(0x123));}}),this['bot'][_0x59f0c8(0x18f)](/\/debug/,async _0x10c244=>{const _0x54faf1=_0x59f0c8,_0x458ec6=_0x10c244[_0x54faf1(0x175)]['id'],_0x4eacc2=_0x10c244[_0x54faf1(0x1b5)]?.['id'][_0x54faf1(0xf3)]();if(!_0x4eacc2)return;try{const _0x29e3d1=await database_1['default'][_0x54faf1(0x178)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x52a15f='🔍\x20*Debug\x20Information*\x0a\x0a';_0x52a15f+=_0x54faf1(0x15f)+_0x4eacc2+'`\x0a\x0a',_0x52a15f+=_0x54faf1(0x148),_0x29e3d1[_0x54faf1(0xe1)]((_0x3d6c0e,_0x2be773)=>{const _0x723641=_0x54faf1;_0x52a15f+=_0x2be773+0x1+_0x723641(0x1ab)+_0x3d6c0e[_0x723641(0xdc)]+'*\x0a',_0x52a15f+=_0x723641(0x1b2)+_0x3d6c0e[_0x723641(0x122)]+'`\x0a',_0x52a15f+=_0x723641(0x173)+_0x3d6c0e['status']+'\x0a',_0x52a15f+=_0x723641(0x16b)+_0x3d6c0e[_0x723641(0x14f)][_0x723641(0x15c)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x54faf1(0x1b8)]?.['sendMessage'](_0x458ec6,_0x52a15f,{'parse_mode':'Markdown'});}catch(_0x5dd6e2){console[_0x54faf1(0x1b6)](_0x54faf1(0x19c),_0x5dd6e2),await this[_0x54faf1(0x1b8)]?.[_0x54faf1(0x136)](_0x458ec6,'❌\x20Error\x20getting\x20debug\x20information.');}}),this[_0x59f0c8(0x1b8)]['on'](_0x59f0c8(0x193),async _0x1416a6=>{const _0x5e46b5=_0x59f0c8;if(_0x1416a6[_0x5e46b5(0x1bc)]?.[_0x5e46b5(0xfa)]('/'))return;const _0x6a9fa4=_0x1416a6[_0x5e46b5(0x175)]['id'],_0x54ebab=_0x1416a6[_0x5e46b5(0x1b5)]?.['id']['toString'](),_0x265aaf=_0x1416a6['text']?.['trim']();if(!_0x54ebab||!_0x265aaf)return;try{const _0x5b1d7a=await database_1[_0x5e46b5(0x152)]['telegramUser'][_0x5e46b5(0x160)]({'where':{'telegramId':_0x54ebab},'include':{'shop':!![]}});if(!_0x5b1d7a){await this['bot']?.[_0x5e46b5(0x136)](_0x6a9fa4,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x5b1d7a[_0x5e46b5(0x1aa)]&&_0x5b1d7a[_0x5e46b5(0x11a)]&&_0x5b1d7a[_0x5e46b5(0x178)]){await this[_0x5e46b5(0x1b8)]?.[_0x5e46b5(0x136)](_0x6a9fa4,_0x5e46b5(0xfb)+_0x5b1d7a[_0x5e46b5(0x178)][_0x5e46b5(0xdc)]+_0x5e46b5(0xe0)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':'Markdown'});return;}const _0x2d33ed=_0x265aaf['split'](/\s+/);if(_0x2d33ed['length']!==0x2){await this[_0x5e46b5(0x1b8)]?.[_0x5e46b5(0x136)](_0x6a9fa4,_0x5e46b5(0x1b1)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x5e46b5(0xd9)+_0x5e46b5(0x12b)+('You\x20sent\x20'+_0x2d33ed[_0x5e46b5(0x17d)]+_0x5e46b5(0x1be)+_0x2d33ed[_0x5e46b5(0x170)](_0x27c517=>'`'+_0x27c517+'`')[_0x5e46b5(0x1ac)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x806110,_0x1ec617]=_0x2d33ed;console[_0x5e46b5(0x11b)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x54ebab+_0x5e46b5(0x198)+_0x806110+_0x5e46b5(0x187)+_0x1ec617[_0x5e46b5(0x15c)](0x0,0xa)+_0x5e46b5(0x195)),await this['handleSingleLineVerification'](_0x6a9fa4,_0x54ebab,_0x806110,_0x1ec617);}catch(_0x51ef69){console[_0x5e46b5(0x1b6)]('Error\x20handling\x20message:',_0x51ef69),await this[_0x5e46b5(0x1b8)]?.[_0x5e46b5(0x136)](_0x6a9fa4,_0x5e46b5(0x123));}}),this[_0x59f0c8(0x1b8)]['on']('error',_0x3a701a=>{const _0x28be4b=_0x59f0c8;console[_0x28be4b(0x1b6)](_0x28be4b(0x167),_0x3a701a);}),this[_0x59f0c8(0x1b8)]['on'](_0x59f0c8(0x128),_0x18bc6a=>{const _0x25fef0=_0x59f0c8;console[_0x25fef0(0x1b6)](_0x25fef0(0xf2),_0x18bc6a);});}async[a61_0x257e71(0x127)](_0x464259,_0x540917,_0x2ea1a4,_0x58d5d8){const _0x516b29=a61_0x257e71;try{console[_0x516b29(0x11b)](_0x516b29(0x158)+_0x540917+':\x20username=\x22'+_0x2ea1a4+_0x516b29(0x187)+_0x58d5d8[_0x516b29(0x15c)](0x0,0xa)+_0x516b29(0x195));if(!_0x2ea1a4||_0x2ea1a4[_0x516b29(0x17d)]<0x3||_0x2ea1a4[_0x516b29(0x17d)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x516b29(0x101)](_0x2ea1a4)){await this[_0x516b29(0x1b8)]?.[_0x516b29(0x136)](_0x464259,'❌\x20Invalid\x20username\x20format:\x20`'+_0x2ea1a4+'`\x0a\x0a'+_0x516b29(0x111),{'parse_mode':'Markdown'});return;}if(!_0x58d5d8||!_0x58d5d8[_0x516b29(0xfa)]('pk_')&&!_0x58d5d8['startsWith'](_0x516b29(0x1a5))){await this[_0x516b29(0x1b8)]?.[_0x516b29(0x136)](_0x464259,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x516b29(0x1a7),{'parse_mode':_0x516b29(0xef)});return;}const _0x5e3a4b=await database_1['default'][_0x516b29(0x178)][_0x516b29(0x160)]({'where':{'username':_0x2ea1a4},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x5e3a4b){const _0x34cd31=await database_1[_0x516b29(0x152)][_0x516b29(0x178)][_0x516b29(0x17e)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x4f610e=_0x516b29(0x19d)+_0x2ea1a4+_0x516b29(0x15b);_0x34cd31[_0x516b29(0x17d)]>0x0?(_0x4f610e+=_0x516b29(0x110),_0x34cd31[_0x516b29(0xe1)](_0x3aa05f=>{const _0x717b16=_0x516b29;_0x4f610e+=_0x717b16(0xd8)+_0x3aa05f[_0x717b16(0x122)]+_0x717b16(0x17f)+_0x3aa05f[_0x717b16(0xdc)]+')\x0a';}),_0x4f610e+=_0x516b29(0x17b)):_0x4f610e+='Check\x20spelling\x20and\x20try\x20again.';await this['bot']?.[_0x516b29(0x136)](_0x464259,_0x4f610e,{'parse_mode':_0x516b29(0xef)});return;}if(_0x5e3a4b[_0x516b29(0x154)]!==_0x516b29(0x16f)){await this['bot']?.[_0x516b29(0x136)](_0x464259,_0x516b29(0x115)+_0x2ea1a4+_0x516b29(0xdf)+_0x516b29(0x12c),{'parse_mode':_0x516b29(0xef)});return;}if(_0x5e3a4b['publicKey']!==_0x58d5d8&&_0x5e3a4b[_0x516b29(0x10e)]!==_0x58d5d8){await this['bot']?.[_0x516b29(0x136)](_0x464259,_0x516b29(0x19a)+_0x2ea1a4+_0x516b29(0x1a6)+_0x516b29(0x197)+_0x516b29(0x18c),{'parse_mode':_0x516b29(0xef)});return;}const _0x4df548=await database_1[_0x516b29(0x152)][_0x516b29(0x103)]['findFirst']({'where':{'shopId':_0x5e3a4b['id'],'isVerified':!![],'telegramId':{'not':_0x540917}}});if(_0x4df548){await this[_0x516b29(0x1b8)]?.[_0x516b29(0x136)](_0x464259,_0x516b29(0x1a9)+_0x2ea1a4+'`.\x0a\x0a'+_0x516b29(0x194),{'parse_mode':_0x516b29(0xef)});return;}await database_1[_0x516b29(0x152)][_0x516b29(0x103)][_0x516b29(0x13b)]({'where':{'telegramId':_0x540917},'data':{'shopId':_0x5e3a4b['id'],'isVerified':!![]}}),await this[_0x516b29(0x1b8)]?.['sendMessage'](_0x464259,'🎉\x20*Congratulations!*\x0a\x0a'+_0x516b29(0x15e)+(_0x516b29(0x1a8)+_0x5e3a4b[_0x516b29(0xdc)]+'*\x0a')+(_0x516b29(0xea)+_0x5e3a4b[_0x516b29(0x122)]+_0x516b29(0x134))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x516b29(0x18e)+_0x516b29(0x186)+_0x516b29(0xdd)+_0x516b29(0x133)+_0x516b29(0xf0)+_0x516b29(0x190)+_0x516b29(0x126),{'parse_mode':_0x516b29(0xef)}),console[_0x516b29(0x11b)](_0x516b29(0x174)+_0x540917+'\x20verified\x20for\x20shop\x20'+_0x5e3a4b[_0x516b29(0x122)]+_0x516b29(0x130));}catch(_0x32806b){console['error'](_0x516b29(0xec),_0x32806b),await this['bot']?.[_0x516b29(0x136)](_0x464259,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a61_0x257e71(0x163)](_0xdf78b2,_0x4b9481,_0x8583b0){const _0x4c8de9=a61_0x257e71;if(!this[_0x4c8de9(0x1b8)]){console[_0x4c8de9(0x13c)](_0x4c8de9(0x150));return;}try{const _0x5bbf82=await database_1[_0x4c8de9(0x152)][_0x4c8de9(0x103)]['findMany']({'where':{'shopId':_0xdf78b2,'isVerified':!![]}});if(_0x5bbf82[_0x4c8de9(0x17d)]===0x0){console[_0x4c8de9(0x11b)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0xdf78b2);return;}const _0x1b6820=_0x5bbf82[_0x4c8de9(0x170)](async _0x3ceb7d=>{const _0x539635=_0x4c8de9;try{await this[_0x539635(0x1b8)]?.[_0x539635(0x136)](_0x3ceb7d['telegramId'],_0x4b9481,_0x8583b0),console['log']('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x3ceb7d['telegramId']);}catch(_0xe52069){console[_0x539635(0x1b6)](_0x539635(0x144)+_0x3ceb7d[_0x539635(0xe3)]+':',_0xe52069),_0xe52069 instanceof Error&&(_0xe52069[_0x539635(0x193)][_0x539635(0x11c)]('blocked')||_0xe52069[_0x539635(0x193)][_0x539635(0x11c)](_0x539635(0x10d))||_0xe52069[_0x539635(0x193)][_0x539635(0x11c)](_0x539635(0x1a3)))&&(await database_1[_0x539635(0x152)][_0x539635(0x103)]['update']({'where':{'id':_0x3ceb7d['id']},'data':{'isVerified':![]}}),console[_0x539635(0x11b)](_0x539635(0x14e)+_0x3ceb7d[_0x539635(0xe3)]+_0x539635(0x141)));}});await Promise['allSettled'](_0x1b6820);}catch(_0x2b6b4e){console[_0x4c8de9(0x1b6)](_0x4c8de9(0x191),_0x2b6b4e);}}async[a61_0x257e71(0xde)](_0x13dd9a,_0x448420,_0x50236c){const _0x168246=a61_0x257e71,_0x315157={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x272874={'created':_0x168246(0x139),'paid':_0x168246(0x124),'failed':_0x168246(0x107),'expired':_0x168246(0x18a),'refund':'Payment\x20refund','chargeback':_0x168246(0x12f),'processing':_0x168246(0x177)},_0xbdf9d0=_0x315157[_0x50236c],_0x36b3da=_0x272874[_0x50236c],_0xcfaff2=(0x0,gateway_1[_0x168246(0x180)])(_0x448420['gateway']);console[_0x168246(0x11b)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x448420[_0x168246(0x1b7)]+_0x168246(0x14c)+_0xcfaff2+'\x22');let _0xf6462e=_0xbdf9d0+'\x20*'+_0x36b3da+_0x168246(0x11f)+(_0x168246(0x161)+_0x448420[_0x168246(0x109)]+'\x20'+_0x448420[_0x168246(0x1a0)]+'*\x0a')+(_0x168246(0x15a)+(_0x448420[_0x168246(0xfc)]||_0x448420['id'])+'`\x0a')+(_0x168246(0x1bb)+_0x448420['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0xcfaff2+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x448420[_0x168246(0x149)])['toLocaleString'](_0x168246(0x1b9))+'\x0a');if(_0x448420[_0x168246(0x138)]||_0x448420['customerEmail']||_0x448420[_0x168246(0xed)]||_0x448420['customerIp']||_0x448420[_0x168246(0xfe)]){_0xf6462e+=_0x168246(0x168);_0x448420['customerName']&&(_0xf6462e+=_0x168246(0x159)+_0x448420['customerName']+'`\x0a');_0x448420[_0x168246(0xf4)]&&(_0xf6462e+='📧\x20Email:\x20`'+_0x448420['customerEmail']+'`\x0a');_0x448420['remitterIban']&&(_0xf6462e+=_0x168246(0x164)+_0x448420[_0x168246(0xed)]+'`\x0a');_0x448420[_0x168246(0x162)]&&(_0xf6462e+='🌐\x20IP:\x20`'+_0x448420[_0x168246(0x162)]+'`\x0a');if(_0x448420['customerUa']){const _0x1bbf10=_0x448420[_0x168246(0xfe)]['length']>0x32?_0x448420[_0x168246(0xfe)][_0x168246(0x15c)](0x0,0x32)+'...':_0x448420[_0x168246(0xfe)];_0xf6462e+=_0x168246(0x19b)+_0x1bbf10+'`\x0a';}}_0x50236c===_0x168246(0x14a)&&_0x448420[_0x168246(0x1a4)]&&(_0xf6462e+=_0x168246(0x120)+_0x448420['chargebackAmount']+_0x168246(0x189)),_0x50236c===_0x168246(0x119)&&(_0xf6462e+=_0x168246(0x10b)),_0x448420[_0x168246(0xeb)]&&(_0xf6462e+=_0x168246(0x1b0)+_0x448420[_0x168246(0xeb)]+'\x0a'),await this[_0x168246(0x163)](_0x13dd9a,_0xf6462e,{'parse_mode':_0x168246(0xef)});}async['sendPayoutNotification'](_0xf2efed,_0x5ee271,_0x3fa649){const _0x4a0763=a61_0x257e71,_0x43f568={'created':'📤','completed':'✅','rejected':'❌'},_0x2b3af4={'created':_0x4a0763(0x182),'completed':_0x4a0763(0x116),'rejected':_0x4a0763(0xdb)},_0x31ed48=_0x43f568[_0x3fa649],_0x34ce2e=_0x2b3af4[_0x3fa649],_0x59c6fa=_0x31ed48+'\x20*'+_0x34ce2e+'*\x0a\x0a'+(_0x4a0763(0x166)+_0x5ee271[_0x4a0763(0x109)]+_0x4a0763(0x10c))+(_0x4a0763(0xe9)+_0x5ee271[_0x4a0763(0x10a)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x5ee271['id']+'`\x0a')+(_0x4a0763(0x14b)+new Date(_0x5ee271['createdAt'])[_0x4a0763(0x13d)]('en-US')+'\x0a')+(_0x5ee271[_0x4a0763(0x171)]?_0x4a0763(0x147)+_0x5ee271[_0x4a0763(0x171)]+'`':'');await this[_0x4a0763(0x163)](_0xf2efed,_0x59c6fa,{'parse_mode':_0x4a0763(0xef)});}async[a61_0x257e71(0x14d)](_0x557568,_0x5afe5e){const _0x255a63=a61_0x257e71;try{const _0x2871f6=await database_1[_0x255a63(0x152)][_0x255a63(0x132)][_0x255a63(0x160)]({'where':{'shopId':_0x557568},'select':{'notificationLogin':!![]}});if(!_0x2871f6?.[_0x255a63(0x12e)]){console[_0x255a63(0x11b)](_0x255a63(0x16a)+_0x557568);return;}const _0x52e772=_0x5afe5e['success']?'🔐':'🚨',_0x1abcb4=_0x5afe5e[_0x255a63(0xe8)]?'Successful\x20login':_0x255a63(0x140);let _0x20f6dd=_0x52e772+'\x20*'+_0x1abcb4+'*\x0a\x0a'+(_0x255a63(0xea)+_0x5afe5e[_0x255a63(0x122)]+'`\x0a')+(_0x255a63(0x131)+_0x5afe5e['timestamp'][_0x255a63(0x13d)](_0x255a63(0x1b9))+'\x0a');_0x5afe5e[_0x255a63(0x169)]&&(_0x20f6dd+=_0x255a63(0x102)+_0x5afe5e['ipAddress']+'`\x0a');if(_0x5afe5e['userAgent']){const _0x36623c=_0x5afe5e[_0x255a63(0xe2)][_0x255a63(0x17d)]>0x32?_0x5afe5e[_0x255a63(0xe2)]['substring'](0x0,0x32)+_0x255a63(0x146):_0x5afe5e['userAgent'];_0x20f6dd+=_0x255a63(0x19b)+_0x36623c+'`\x0a';}!_0x5afe5e['success']&&(_0x20f6dd+=_0x255a63(0x137)),await this[_0x255a63(0x163)](_0x557568,_0x20f6dd,{'parse_mode':_0x255a63(0xef)}),console[_0x255a63(0x11b)](_0x255a63(0x156)+_0x557568+':\x20'+(_0x5afe5e[_0x255a63(0xe8)]?'success':_0x255a63(0x1ad)));}catch(_0x26229e){console[_0x255a63(0x1b6)](_0x255a63(0x18b),_0x26229e);}}async[a61_0x257e71(0x179)](_0x234181,_0x123b8a){const _0x13a001=a61_0x257e71;try{const _0x54878c=await database_1[_0x13a001(0x152)]['shopSettings'][_0x13a001(0x160)]({'where':{'shopId':_0x234181},'select':{'notificationApiError':!![]}});if(!_0x54878c?.[_0x13a001(0x183)]){console['log'](_0x13a001(0x176)+_0x234181);return;}let _0x2b9e8e=_0x13a001(0x11d)+(_0x13a001(0x112)+_0x123b8a[_0x13a001(0x10a)]+'\x20'+_0x123b8a[_0x13a001(0x199)]+'`\x0a')+(_0x13a001(0x131)+_0x123b8a[_0x13a001(0x113)][_0x13a001(0x13d)](_0x13a001(0x1b9))+'\x0a');_0x123b8a[_0x13a001(0x155)]&&(_0x2b9e8e+=_0x13a001(0x16d)+_0x123b8a['statusCode']+'`\x0a'),_0x2b9e8e+=_0x13a001(0x125)+_0x123b8a[_0x13a001(0x165)]+'`\x0a',_0x123b8a[_0x13a001(0x1ae)]&&(_0x2b9e8e+=_0x13a001(0x104)+_0x123b8a['requestId']+'`\x0a'),_0x2b9e8e+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x13a001(0x163)](_0x234181,_0x2b9e8e,{'parse_mode':_0x13a001(0xef)}),console['log'](_0x13a001(0x184)+_0x234181+':\x20'+_0x123b8a['endpoint']);}catch(_0x12a475){console['error']('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x12a475);}}async['sendCustomNotification'](_0x46b6c9,_0x35932b,_0x510ff8){const _0x59fb4e=a61_0x257e71;let _0x2522e9='🔔\x20*'+_0x35932b+'*\x0a\x0a';for(const [_0x4862c8,_0x309f63]of Object[_0x59fb4e(0x188)](_0x510ff8)){_0x309f63!==null&&_0x309f63!==undefined&&(_0x2522e9+=_0x4862c8+_0x59fb4e(0x17a)+_0x309f63+'`\x0a');}await this[_0x59fb4e(0x163)](_0x46b6c9,_0x2522e9,{'parse_mode':_0x59fb4e(0xef)});}async[a61_0x257e71(0x1a2)](_0x3e68f2){const _0x2a603c=a61_0x257e71;try{console['log'](_0x2a603c(0xf8)+_0x3e68f2[_0x2a603c(0x15c)](0x0,0x32)+_0x2a603c(0x146));const _0x301061=await database_1['default'][_0x2a603c(0x103)][_0x2a603c(0x17e)]({'select':{'telegramId':!![]}});if(_0x301061['length']===0x0){console[_0x2a603c(0x11b)]('📱\x20No\x20active\x20Telegram\x20users\x20found');return;}for(const _0xe7b513 of _0x301061){try{await this[_0x2a603c(0x1b8)]?.[_0x2a603c(0x136)](_0xe7b513[_0x2a603c(0xe3)],_0x3e68f2,{'parse_mode':_0x2a603c(0xef)});}catch(_0xaac5bd){console['error'](_0x2a603c(0x157)+_0xe7b513[_0x2a603c(0xe3)]+':',_0xaac5bd);}}console[_0x2a603c(0x11b)](_0x2a603c(0x145)+_0x301061['length']+_0x2a603c(0x16e));}catch(_0x4f59d3){console[_0x2a603c(0x1b6)](_0x2a603c(0xee),_0x4f59d3);}}[a61_0x257e71(0xff)](){const _0x5de380=a61_0x257e71;return{'isActive':!!this[_0x5de380(0x1b8)],'username':this['botUsername']};}[a61_0x257e71(0x16c)](){const _0x2ee836=a61_0x257e71;this[_0x2ee836(0x1b8)]&&(this[_0x2ee836(0x1b8)][_0x2ee836(0x142)](),this[_0x2ee836(0x1b8)]=null,console['log']('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a61_0x257e71(0x135)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();