'use strict';const a78_0x291c18=a78_0xaf8e;function a78_0xaf8e(_0x7fd0cb,_0x2c8b1b){_0x7fd0cb=_0x7fd0cb-0x10c;const _0x189a6d=a78_0x189a();let _0xaf8ef4=_0x189a6d[_0x7fd0cb];return _0xaf8ef4;}(function(_0x18e718,_0x50e246){const _0x27bbdd=a78_0xaf8e,_0x3c279b=_0x18e718();while(!![]){try{const _0x126bb8=parseInt(_0x27bbdd(0x17a))/0x1+-parseInt(_0x27bbdd(0x1c6))/0x2+-parseInt(_0x27bbdd(0x1c2))/0x3*(parseInt(_0x27bbdd(0x162))/0x4)+parseInt(_0x27bbdd(0x1ff))/0x5*(-parseInt(_0x27bbdd(0x1ea))/0x6)+parseInt(_0x27bbdd(0x1e9))/0x7*(parseInt(_0x27bbdd(0x161))/0x8)+parseInt(_0x27bbdd(0x139))/0x9+-parseInt(_0x27bbdd(0x12f))/0xa*(parseInt(_0x27bbdd(0x183))/0xb);if(_0x126bb8===_0x50e246)break;else _0x3c279b['push'](_0x3c279b['shift']());}catch(_0x6ffd7a){_0x3c279b['push'](_0x3c279b['shift']());}}}(a78_0x189a,0x1d889));var __importDefault=this&&this[a78_0x291c18(0x11b)]||function(_0x384516){const _0x577c74=a78_0x291c18;return _0x384516&&_0x384516[_0x577c74(0x155)]?_0x384516:{'default':_0x384516};};Object[a78_0x291c18(0x1c8)](exports,a78_0x291c18(0x155),{'value':!![]}),exports['telegramBotService']=exports[a78_0x291c18(0x15a)]=void 0x0;function a78_0x189a(){const _0x41943b=['sk_','‚Ä¢\x20Payouts\x0a\x0a','Failed\x20login\x20attempt','Telegram\x20bot\x20error:','secretKey','network','botUsername','\x0aüí°\x20Check\x20your\x20request\x20or\x20contact\x20support.','chargebackAmount','status','__importDefault','sendApiErrorNotification','2-digit','‚úÖ\x20File\x20sent\x20to\x20chat\x20','üì±\x20Shop:\x20*','remitterIban','‚úÖ\x20Welcome\x20back!\x0a\x0a','en-US','üì±\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','üéâ\x20*Congratulations!*\x0a\x0a','Error\x20handling\x20/status\x20command:','unknown\x20shop','sendDocument','error','üìÖ\x20*Payout\x20Date:*\x20','üîî\x20Notifications\x20are\x20active\x0a\x0a','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','wallet','‚ùå\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','map','198910FsbPGE','‚ùå\x20Shop\x20with\x20username\x20`','chargeback','‚Ä¢\x20Important\x20events\x0a\x0a','üìõ\x20Name:\x20`','*\x0a\x0a','üè™\x20Gateway:\x20`','env','üåç\x20Country:\x20','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','1199862wwWjKJ','../config/database','period','sendShopNotification','application/pdf','createdAt','userAgent','Username:\x20`','split','Payment\x20chargeback','‚ùå\x20Shop\x20`','.jpeg','getBotInfo','stopPolling','\x20via\x20single-line\x20input','shopSettings','numeric','orderId','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','sendDirectFile','‚ùå\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','customerIp','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','txid','toString','statusCode','endpoint','‚è≥\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','__esModule','Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.','log','ACTIVE','\x20users\x20of\x20shop\x20','TelegramBotService','üåê\x20IP:\x20`','sendMessage','notificationApiError','username','üîÑ\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','gateway','120qUfsFG','52tVznKH','üì±\x20Notification\x20sent\x20to\x20','sendNotificationToAll','Not\x20specified','‚ùå\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','includes','üìù\x20Format:\x20`username\x20api_key`\x0a\x0a','last_name','Contact\x20administrator.','üìÖ\x20Time:\x20','üì±\x20Your\x20Telegram\x20ID:\x20`','üí∏\x20*New\x20Payout*\x0a\x0a','üÜî\x20Payment\x20ID:\x20`','Error\x20handling\x20/debug\x20command:','startsWith','initializeBot','setupBotHandlers','message','Error\x20handling\x20/start\x20command:','../types/gateway','Commands:\x0a','üÜî\x20Request\x20ID:\x20`',':\x20username=\x22','.jpg','232662obxzhX','text','publicKey','node-telegram-bot-api','üì±\x20Telegram\x20notification:\x20gateway\x20\x22','üìù\x20Notes:\x20','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','üí∏\x20Penalty\x20amount:\x20*','botToken','33qOtMgr','üîå\x20User\x20','findMany','‚úÖ\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','You\x20are\x20already\x20connected\x20to\x20shop:\x20*',':\x20`','findUnique','üîç\x20*Debug\x20Information*\x0a\x0a','default','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','`\x20is\x20inactive.\x0a\x0a','üìÖ\x20Connection\x20date:\x20','handleSingleLineVerification','üîî\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','‚ùå\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','errorMessage','To\x20reconnect,\x20use\x20the\x20/start\x20command','üåê\x20*Network:*\x20','‚ùå\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','getGatewayDisplayNameForTelegram','‚ùå\x20Error\x20sending\x20file\x20to\x20chat:','Payment\x20failed','method','‚Ä¢\x20New\x20payments\x0a','shop','‚ùå\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','test','sendPayoutNotification','...','ipAddress','üîî\x20*','‚úÖ\x20File\x20sent\x20to\x20','‚ùå\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','üìÖ\x20Date:\x20','TELEGRAM_BOT_TOKEN','customerUa','‚ùå\x20Invalid\x20API\x20key\x20format.\x0a\x0a','bot','üì±\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','warn','shopId','Telegram\x20bot\x20polling\x20error:','New\x20payment\x20created','Error\x20in\x20handleSingleLineVerification:','‚ùå\x20Error\x20getting\x20debug\x20information.','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','üí≥\x20*Wallet:*\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','failed','*.\x0a\x0a','application/octet-stream','\x20initialized\x20successfully','üë§\x20Username:\x20`','You\x20sent\x20','‚úÖ\x20Direct\x20message\x20sent\x20to\x20chat\x20','\x20(@','findFirst','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a','geo','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','üì±\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','user\x20is\x20deactivated','\x20disconnected\x20from\x20shop\x20','49458gQPzZa','telegramId','substring','isVerified','24302nCPCWM','Payment\x20is\x20being\x20processed','defineProperty','Payment\x20refund','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','currency','image/jpeg','üìä\x20*Connection\x20Status*\x0a\x0a','amount','onText','‚ùå\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','length','sendPaymentNotification','\x22,\x20apiKey=\x22','\x20users','success','üìß\x20Email:\x20`','toLocaleString','timestamp','Error\x20sending\x20shop\x20notification:','update','TELEGRAM_BOT_USERNAME','.pdf','sendCustomNotification','üîÑ\x20Processing\x20single-line\x20verification\x20for\x20user\x20','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','‚úÖ\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','‚úÖ\x20Telegram\x20bot\x20@','üè™\x20Your\x20connected\x20shop:\x0a','üì±\x20Created\x20new\x20Telegram\x20user:\x20','adminNotes','sendDirectMessage','allSettled','requestId','...\x22','67025VPXGJy','87852MOITfI','chat','üìä\x20Error\x20code:\x20`','‚úÖ\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','üõë\x20Telegram\x20bot\x20stopped','endsWith','from','blocked','Use\x20/start\x20to\x20connect.','customerEmail','create','name','telegramUser','/status\x20-\x20check\x20connection\x20status\x0a','\x0aüë§\x20*Customer\x20Information:*\x0a','trapay_bot','join','\x20\x20\x20Status:\x20','‚ùå\x20Telegram\x20bot\x20not\x20initialized','`.\x0a\x0a','üè¶\x20IBAN:\x20`','35yJTqRj','‚ùå\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','Markdown','`\x0a\x0a','image/png','Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.','üí∞\x20*Amount:*\x20','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','üíª\x20Browser:\x20`','üîî\x20You\x20receive\x20notifications\x20about:\x0a','‚è±Ô∏è\x20*Period:*\x20'];a78_0x189a=function(){return _0x41943b;};return a78_0x189a();}const node_telegram_bot_api_1=__importDefault(require(a78_0x291c18(0x17d))),database_1=__importDefault(require(a78_0x291c18(0x13a))),gateway_1=require(a78_0x291c18(0x175));class TelegramBotService{constructor(){const _0x5a2270=a78_0x291c18;this[_0x5a2270(0x1a8)]=null,this[_0x5a2270(0x182)]=process[_0x5a2270(0x136)][_0x5a2270(0x1a5)]||'',this[_0x5a2270(0x117)]=process[_0x5a2270(0x136)][_0x5a2270(0x1db)]||_0x5a2270(0x1f9),this[_0x5a2270(0x182)]?this[_0x5a2270(0x171)]():console[_0x5a2270(0x1aa)](_0x5a2270(0x1df));}[a78_0x291c18(0x171)](){const _0x4d50ac=a78_0x291c18;try{this['bot']=new node_telegram_bot_api_1[(_0x4d50ac(0x18b))](this['botToken'],{'polling':!![]}),this[_0x4d50ac(0x172)](),console[_0x4d50ac(0x157)](_0x4d50ac(0x1e1)+this[_0x4d50ac(0x117)]+_0x4d50ac(0x1b6));}catch(_0x5e8076){console['error']('‚ùå\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x5e8076);}}[a78_0x291c18(0x172)](){const _0x89bab2=a78_0x291c18;if(!this[_0x89bab2(0x1a8)])return;this[_0x89bab2(0x1a8)][_0x89bab2(0x1cf)](/\/start/,async _0x958d0c=>{const _0x373a91=_0x89bab2,_0x584fac=_0x958d0c[_0x373a91(0x1eb)]['id'],_0x3dabdd=_0x958d0c[_0x373a91(0x1f0)]?.['id'][_0x373a91(0x151)](),_0x991ba1=_0x958d0c[_0x373a91(0x1f0)]?.['username'],_0x3364e3=_0x958d0c['from']?.['first_name'],_0x2f7a0a=_0x958d0c[_0x373a91(0x1f0)]?.[_0x373a91(0x169)];if(!_0x3dabdd)return;try{let _0x18d49d=await database_1[_0x373a91(0x18b)][_0x373a91(0x1f6)]['findUnique']({'where':{'telegramId':_0x3dabdd},'include':{'shop':!![]}});!_0x18d49d?(_0x18d49d=await database_1['default'][_0x373a91(0x1f6)][_0x373a91(0x1f4)]({'data':{'telegramId':_0x3dabdd,'username':_0x991ba1,'firstName':_0x3364e3,'lastName':_0x2f7a0a,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x373a91(0x157)](_0x373a91(0x1e3)+_0x3dabdd+_0x373a91(0x1ba)+_0x991ba1+')')):_0x18d49d=await database_1[_0x373a91(0x18b)][_0x373a91(0x1f6)][_0x373a91(0x1da)]({'where':{'telegramId':_0x3dabdd},'data':{'username':_0x991ba1,'firstName':_0x3364e3,'lastName':_0x2f7a0a},'include':{'shop':!![]}}),_0x18d49d[_0x373a91(0x1c5)]&&_0x18d49d[_0x373a91(0x1ab)]&&_0x18d49d[_0x373a91(0x19b)]?await this[_0x373a91(0x1a8)]?.[_0x373a91(0x15c)](_0x584fac,_0x373a91(0x121)+(_0x373a91(0x187)+_0x18d49d['shop'][_0x373a91(0x1f5)]+'*\x0a')+(_0x373a91(0x140)+_0x18d49d[_0x373a91(0x19b)][_0x373a91(0x15e)]+_0x373a91(0x202))+_0x373a91(0x10f)+_0x373a91(0x19a)+'‚Ä¢\x20Payment\x20status\x20changes\x0a'+_0x373a91(0x112)+'Commands:\x0a'+_0x373a91(0x1f7)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x373a91(0x201)}):(_0x18d49d[_0x373a91(0x1ab)]&&!_0x18d49d[_0x373a91(0x1c5)]&&(await database_1[_0x373a91(0x18b)][_0x373a91(0x1f6)][_0x373a91(0x1da)]({'where':{'telegramId':_0x3dabdd},'data':{'shopId':null,'isVerified':![]}}),console[_0x373a91(0x157)](_0x373a91(0x15f)+_0x3dabdd)),await this[_0x373a91(0x1a8)]?.[_0x373a91(0x15c)](_0x584fac,'ü§ñ\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x373a91(0x1b0)+_0x373a91(0x168)+'Example:\x0a'+_0x373a91(0x138)+'‚ùóÔ∏è\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x373a91(0x201)}));}catch(_0x3548a8){console[_0x373a91(0x128)](_0x373a91(0x174),_0x3548a8),await this[_0x373a91(0x1a8)]?.[_0x373a91(0x15c)](_0x584fac,_0x373a91(0x1a3));}}),this[_0x89bab2(0x1a8)][_0x89bab2(0x1cf)](/\/disconnect/,async _0x25e005=>{const _0x44bf22=_0x89bab2,_0x31e7f1=_0x25e005[_0x44bf22(0x1eb)]['id'],_0x558057=_0x25e005['from']?.['id']['toString']();if(!_0x558057)return;try{const _0x59b0d0=await database_1[_0x44bf22(0x18b)]['telegramUser']['findUnique']({'where':{'telegramId':_0x558057},'include':{'shop':!![]}});if(!_0x59b0d0||!_0x59b0d0[_0x44bf22(0x1c5)]||!_0x59b0d0['shopId']){await this[_0x44bf22(0x1a8)]?.[_0x44bf22(0x15c)](_0x31e7f1,'‚ùå\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x4ed526=_0x59b0d0['shop']?.[_0x44bf22(0x1f5)]||_0x44bf22(0x126);await database_1['default'][_0x44bf22(0x1f6)][_0x44bf22(0x1da)]({'where':{'telegramId':_0x558057},'data':{'shopId':null,'isVerified':![]}}),console[_0x44bf22(0x157)](_0x44bf22(0x184)+_0x558057+_0x44bf22(0x1c1)+_0x59b0d0[_0x44bf22(0x1ab)]),await this[_0x44bf22(0x1a8)]?.[_0x44bf22(0x15c)](_0x31e7f1,_0x44bf22(0x186)+_0x4ed526+_0x44bf22(0x1b4)+_0x44bf22(0x193),{'parse_mode':_0x44bf22(0x201)});}catch(_0x8c0470){console['error']('Error\x20handling\x20/disconnect\x20command:',_0x8c0470),await this['bot']?.[_0x44bf22(0x15c)](_0x31e7f1,'‚ùå\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x89bab2(0x1a8)][_0x89bab2(0x1cf)](/\/status/,async _0x189ff7=>{const _0x5c0829=_0x89bab2,_0xecb0c8=_0x189ff7[_0x5c0829(0x1eb)]['id'],_0x87ef22=_0x189ff7['from']?.['id'][_0x5c0829(0x151)]();if(!_0x87ef22)return;try{const _0x22e485=await database_1[_0x5c0829(0x18b)][_0x5c0829(0x1f6)][_0x5c0829(0x189)]({'where':{'telegramId':_0x87ef22},'include':{'shop':!![]}});if(!_0x22e485){await this[_0x5c0829(0x1a8)]?.[_0x5c0829(0x15c)](_0xecb0c8,_0x5c0829(0x166)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x22e485[_0x5c0829(0x1c5)]||!_0x22e485[_0x5c0829(0x1ab)]||!_0x22e485[_0x5c0829(0x19b)]){await this[_0x5c0829(0x1a8)]?.[_0x5c0829(0x15c)](_0xecb0c8,_0x5c0829(0x1be)+_0x5c0829(0x1f2));return;}await this[_0x5c0829(0x1a8)]?.[_0x5c0829(0x15c)](_0xecb0c8,_0x5c0829(0x1cd)+('‚úÖ\x20Connected\x20to\x20shop:\x20*'+_0x22e485[_0x5c0829(0x19b)]['name']+'*\x0a')+('üë§\x20Username:\x20`'+_0x22e485['shop']['username']+'`\x0a')+(_0x5c0829(0x18e)+_0x22e485['updatedAt']['toLocaleDateString'](_0x5c0829(0x122))+'\x0a\x0a')+_0x5c0829(0x12a)+_0x5c0829(0x176)+_0x5c0829(0x1b2),{'parse_mode':_0x5c0829(0x201)});}catch(_0x1f0417){console[_0x5c0829(0x128)](_0x5c0829(0x125),_0x1f0417),await this[_0x5c0829(0x1a8)]?.[_0x5c0829(0x15c)](_0xecb0c8,_0x5c0829(0x1a3));}}),this[_0x89bab2(0x1a8)][_0x89bab2(0x1cf)](/\/debug/,async _0x3ef74a=>{const _0x1eb42a=_0x89bab2,_0x5306aa=_0x3ef74a[_0x1eb42a(0x1eb)]['id'],_0x379662=_0x3ef74a[_0x1eb42a(0x1f0)]?.['id'][_0x1eb42a(0x151)]();if(!_0x379662)return;try{const _0x16f7a9=await database_1[_0x1eb42a(0x18b)]['telegramUser'][_0x1eb42a(0x189)]({'where':{'telegramId':_0x379662},'include':{'shop':!![]}});let _0x4e9d7e=_0x1eb42a(0x18a);_0x4e9d7e+=_0x1eb42a(0x16c)+_0x379662+_0x1eb42a(0x202),_0x16f7a9?.[_0x1eb42a(0x1c5)]&&_0x16f7a9['shop']?(_0x4e9d7e+=_0x1eb42a(0x1e2),_0x4e9d7e+='\x20\x20\x20Name:\x20*'+_0x16f7a9[_0x1eb42a(0x19b)][_0x1eb42a(0x1f5)]+'*\x0a',_0x4e9d7e+='\x20\x20\x20Username:\x20`'+_0x16f7a9[_0x1eb42a(0x19b)][_0x1eb42a(0x15e)]+'`\x0a',_0x4e9d7e+=_0x1eb42a(0x1fb)+_0x16f7a9[_0x1eb42a(0x19b)][_0x1eb42a(0x11a)]+'\x0a\x0a'):_0x4e9d7e+=_0x1eb42a(0x1bc),_0x4e9d7e+=_0x1eb42a(0x156),await this[_0x1eb42a(0x1a8)]?.[_0x1eb42a(0x15c)](_0x5306aa,_0x4e9d7e,{'parse_mode':_0x1eb42a(0x201)});}catch(_0x1261aa){console[_0x1eb42a(0x128)](_0x1eb42a(0x16f),_0x1261aa),await this['bot']?.[_0x1eb42a(0x15c)](_0x5306aa,_0x1eb42a(0x1af));}}),this[_0x89bab2(0x1a8)]['on'](_0x89bab2(0x173),async _0x476d33=>{const _0x45132f=_0x89bab2;if(_0x476d33[_0x45132f(0x17b)]?.[_0x45132f(0x170)]('/'))return;const _0x43fa9a=_0x476d33['chat']['id'],_0x3608cb=_0x476d33[_0x45132f(0x1f0)]?.['id'][_0x45132f(0x151)](),_0x2d2c4f=_0x476d33['text']?.['trim']();if(!_0x3608cb||!_0x2d2c4f)return;try{const _0x400c6a=await database_1[_0x45132f(0x18b)][_0x45132f(0x1f6)][_0x45132f(0x189)]({'where':{'telegramId':_0x3608cb},'include':{'shop':!![]}});if(!_0x400c6a){await this[_0x45132f(0x1a8)]?.['sendMessage'](_0x43fa9a,'‚ùå\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x400c6a['isVerified']&&_0x400c6a[_0x45132f(0x1ab)]&&_0x400c6a[_0x45132f(0x19b)]){await this[_0x45132f(0x1a8)]?.['sendMessage'](_0x43fa9a,_0x45132f(0x1ed)+_0x400c6a['shop']['name']+_0x45132f(0x1b4)+_0x45132f(0x12b),{'parse_mode':_0x45132f(0x201)});return;}const _0x373a3d=_0x2d2c4f[_0x45132f(0x141)](/\s+/);if(_0x373a3d[_0x45132f(0x1d1)]!==0x2){await this[_0x45132f(0x1a8)]?.[_0x45132f(0x15c)](_0x43fa9a,_0x45132f(0x14d)+_0x45132f(0x168)+'Example:\x0a'+_0x45132f(0x138)+(_0x45132f(0x1b8)+_0x373a3d[_0x45132f(0x1d1)]+'\x20parts:\x20'+_0x373a3d[_0x45132f(0x12e)](_0x5099f3=>'`'+_0x5099f3+'`')[_0x45132f(0x1fa)](',\x20')),{'parse_mode':_0x45132f(0x201)});return;}const [_0x2d7535,_0x9ee48b]=_0x373a3d;console[_0x45132f(0x157)](_0x45132f(0x1de)+_0x3608cb+_0x45132f(0x178)+_0x2d7535+_0x45132f(0x1d3)+_0x9ee48b[_0x45132f(0x1c4)](0x0,0xa)+_0x45132f(0x1e8)),await this['handleSingleLineVerification'](_0x43fa9a,_0x3608cb,_0x2d7535,_0x9ee48b);}catch(_0x245bdf){console[_0x45132f(0x128)]('Error\x20handling\x20message:',_0x245bdf),await this[_0x45132f(0x1a8)]?.[_0x45132f(0x15c)](_0x43fa9a,_0x45132f(0x1a3));}}),this[_0x89bab2(0x1a8)]['on'](_0x89bab2(0x128),_0x503351=>{const _0x5091d3=_0x89bab2;console[_0x5091d3(0x128)](_0x5091d3(0x114),_0x503351);}),this[_0x89bab2(0x1a8)]['on']('polling_error',_0x3e54e4=>{const _0x1c57d8=_0x89bab2;console[_0x1c57d8(0x128)](_0x1c57d8(0x1ac),_0x3e54e4);});}async[a78_0x291c18(0x18f)](_0x502fa1,_0x15b034,_0x471697,_0x446594){const _0xbec323=a78_0x291c18;try{console[_0xbec323(0x157)](_0xbec323(0x1de)+_0x15b034+_0xbec323(0x178)+_0x471697+_0xbec323(0x1d3)+_0x446594[_0xbec323(0x1c4)](0x0,0xa)+'...\x22');if(!_0x471697||_0x471697['length']<0x3||_0x471697[_0xbec323(0x1d1)]>0x32||!/^[a-zA-Z0-9_]+$/[_0xbec323(0x19d)](_0x471697)){await this['bot']?.[_0xbec323(0x15c)](_0x502fa1,'‚ùå\x20Invalid\x20username\x20format:\x20`'+_0x471697+_0xbec323(0x202)+_0xbec323(0x14f),{'parse_mode':_0xbec323(0x201)});return;}if(!_0x446594||!_0x446594['startsWith']('pk_')&&!_0x446594['startsWith'](_0xbec323(0x111))){await this['bot']?.[_0xbec323(0x15c)](_0x502fa1,_0xbec323(0x1a7)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0xbec323(0x201)});return;}const _0x3ed57e=await database_1['default']['shop'][_0xbec323(0x189)]({'where':{'username':_0x471697},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x3ed57e){const _0x3955f7=_0xbec323(0x130)+_0x471697+'`\x20not\x20found.\x0a\x0a'+'Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a'+_0xbec323(0x204);await this[_0xbec323(0x1a8)]?.[_0xbec323(0x15c)](_0x502fa1,_0x3955f7,{'parse_mode':_0xbec323(0x201)});return;}if(_0x3ed57e[_0xbec323(0x11a)]!==_0xbec323(0x158)){await this[_0xbec323(0x1a8)]?.[_0xbec323(0x15c)](_0x502fa1,_0xbec323(0x143)+_0x471697+_0xbec323(0x18d)+_0xbec323(0x16a),{'parse_mode':_0xbec323(0x201)});return;}if(_0x3ed57e[_0xbec323(0x17c)]!==_0x446594&&_0x3ed57e[_0xbec323(0x115)]!==_0x446594){await this['bot']?.[_0xbec323(0x15c)](_0x502fa1,_0xbec323(0x1d0)+_0x471697+_0xbec323(0x1fd)+_0xbec323(0x180)+_0xbec323(0x14b),{'parse_mode':_0xbec323(0x201)});return;}const _0x2f9f0a=await database_1['default'][_0xbec323(0x1f6)][_0xbec323(0x1bb)]({'where':{'shopId':_0x3ed57e['id'],'isVerified':!![],'telegramId':{'not':_0x15b034}}});if(_0x2f9f0a){await this['bot']?.['sendMessage'](_0x502fa1,_0xbec323(0x200)+_0x471697+_0xbec323(0x1fd)+_0xbec323(0x10d),{'parse_mode':'Markdown'});return;}await database_1['default'][_0xbec323(0x1f6)][_0xbec323(0x1da)]({'where':{'telegramId':_0x15b034},'data':{'shopId':_0x3ed57e['id'],'isVerified':!![]}}),await this[_0xbec323(0x1a8)]?.['sendMessage'](_0x502fa1,_0xbec323(0x124)+'‚úÖ\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0xbec323(0x11f)+_0x3ed57e[_0xbec323(0x1f5)]+'*\x0a')+(_0xbec323(0x1b7)+_0x3ed57e[_0xbec323(0x15e)]+_0xbec323(0x202))+_0xbec323(0x190)+_0xbec323(0x19a)+'‚Ä¢\x20Payment\x20status\x20changes\x0a'+'‚Ä¢\x20Payouts\x0a'+_0xbec323(0x132)+_0xbec323(0x176)+_0xbec323(0x1f7)+_0xbec323(0x1b2),{'parse_mode':_0xbec323(0x201)}),console['log']('‚úÖ\x20Telegram\x20user\x20'+_0x15b034+'\x20verified\x20for\x20shop\x20'+_0x3ed57e[_0xbec323(0x15e)]+_0xbec323(0x147));}catch(_0x583ed1){console[_0xbec323(0x128)](_0xbec323(0x1ae),_0x583ed1),await this[_0xbec323(0x1a8)]?.[_0xbec323(0x15c)](_0x502fa1,_0xbec323(0x12d));}}async[a78_0x291c18(0x13c)](_0x36f46a,_0x205195,_0x58332b){const _0xe4d3d9=a78_0x291c18;if(!this['bot']){console['warn']('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x2bc493=await database_1[_0xe4d3d9(0x18b)][_0xe4d3d9(0x1f6)][_0xe4d3d9(0x185)]({'where':{'shopId':_0x36f46a,'isVerified':!![]}});if(_0x2bc493[_0xe4d3d9(0x1d1)]===0x0){console['log'](_0xe4d3d9(0x1ca)+_0x36f46a);return;}const _0x1740c9=_0x2bc493[_0xe4d3d9(0x12e)](async _0x4960bd=>{const _0x3e8134=_0xe4d3d9;try{await this[_0x3e8134(0x1a8)]?.[_0x3e8134(0x15c)](_0x4960bd['telegramId'],_0x205195,_0x58332b),console[_0x3e8134(0x157)](_0x3e8134(0x1e0)+_0x4960bd['telegramId']);}catch(_0x566994){console['error'](_0x3e8134(0x195)+_0x4960bd['telegramId']+':',_0x566994),_0x566994 instanceof Error&&(_0x566994[_0x3e8134(0x173)]['includes'](_0x3e8134(0x1f1))||_0x566994['message'][_0x3e8134(0x167)]('chat\x20not\x20found')||_0x566994[_0x3e8134(0x173)]['includes'](_0x3e8134(0x1c0)))&&(await database_1[_0x3e8134(0x18b)][_0x3e8134(0x1f6)]['update']({'where':{'id':_0x4960bd['id']},'data':{'isVerified':![]}}),console[_0x3e8134(0x157)]('User\x20'+_0x4960bd[_0x3e8134(0x1c3)]+_0x3e8134(0x18c)));}});await Promise[_0xe4d3d9(0x1e6)](_0x1740c9);}catch(_0x13a408){console[_0xe4d3d9(0x128)](_0xe4d3d9(0x1d9),_0x13a408);}}async[a78_0x291c18(0x1d2)](_0x10b06f,_0x319831,_0x42c61d){const _0x4f3bad=a78_0x291c18,_0x59e6bc={'created':'üÜï','paid':'‚úÖ','failed':'‚ùå','expired':'‚è∞','refund':'üîÑ','chargeback':'‚ö†Ô∏è','processing':'‚öôÔ∏è'},_0x2f90ba={'created':_0x4f3bad(0x1ad),'paid':'Payment\x20successfully\x20paid','failed':_0x4f3bad(0x198),'expired':'Payment\x20expired','refund':_0x4f3bad(0x1c9),'chargeback':_0x4f3bad(0x142),'processing':_0x4f3bad(0x1c7)},_0x221577=_0x59e6bc[_0x42c61d],_0x33b9e8=_0x2f90ba[_0x42c61d],_0xbbb832=(0x0,gateway_1[_0x4f3bad(0x196)])(_0x319831[_0x4f3bad(0x160)]);console[_0x4f3bad(0x157)](_0x4f3bad(0x17e)+_0x319831[_0x4f3bad(0x160)]+'\x22\x20->\x20display\x20\x22'+_0xbbb832+'\x22');let _0xe958be=_0x221577+'\x20*'+_0x33b9e8+_0x4f3bad(0x134)+('üí∞\x20Amount:\x20*'+_0x319831[_0x4f3bad(0x1ce)]+'\x20'+_0x319831[_0x4f3bad(0x1cb)]+'*\x0a')+('üìù\x20Order\x20ID:\x20`'+(_0x319831[_0x4f3bad(0x14a)]||_0x319831['id'])+'`\x0a')+(_0x4f3bad(0x16e)+_0x319831['id']+'`\x0a')+(_0x4f3bad(0x135)+_0xbbb832+'`\x0a')+(_0x4f3bad(0x1a4)+new Date(_0x319831[_0x4f3bad(0x13e)])[_0x4f3bad(0x1d7)](_0x4f3bad(0x122))+'\x0a');if(_0x319831['customerName']||_0x319831[_0x4f3bad(0x1f3)]||_0x319831[_0x4f3bad(0x120)]||_0x319831[_0x4f3bad(0x14e)]||_0x319831[_0x4f3bad(0x1a6)]){_0xe958be+=_0x4f3bad(0x1f8);_0x319831['customerName']&&(_0xe958be+=_0x4f3bad(0x133)+_0x319831['customerName']+'`\x0a');_0x319831['customerEmail']&&(_0xe958be+=_0x4f3bad(0x1d6)+_0x319831[_0x4f3bad(0x1f3)]+'`\x0a');_0x319831['remitterIban']&&(_0xe958be+=_0x4f3bad(0x1fe)+_0x319831[_0x4f3bad(0x120)]+'`\x0a');_0x319831[_0x4f3bad(0x14e)]&&(_0xe958be+=_0x4f3bad(0x15b)+_0x319831[_0x4f3bad(0x14e)]+'`\x0a');if(_0x319831['customerUa']){const _0x54ecce=_0x319831[_0x4f3bad(0x1a6)][_0x4f3bad(0x1d1)]>0x32?_0x319831['customerUa'][_0x4f3bad(0x1c4)](0x0,0x32)+_0x4f3bad(0x19f):_0x319831['customerUa'];_0xe958be+=_0x4f3bad(0x10e)+_0x54ecce+'`\x0a';}}_0x42c61d===_0x4f3bad(0x131)&&_0x319831[_0x4f3bad(0x119)]&&(_0xe958be+=_0x4f3bad(0x181)+_0x319831[_0x4f3bad(0x119)]+'\x20USDT*\x0a'),_0x42c61d==='processing'&&(_0xe958be+=_0x4f3bad(0x154)),_0x319831['adminNotes']&&(_0xe958be+=_0x4f3bad(0x17f)+_0x319831[_0x4f3bad(0x1e4)]+'\x0a'),await this['sendShopNotification'](_0x10b06f,_0xe958be,{'parse_mode':'Markdown'});}async[a78_0x291c18(0x19e)](_0x44d427,_0x3fa0bb){const _0x23e246=a78_0x291c18,_0x28f482=new Date(_0x3fa0bb['createdAt'])['toLocaleString'](_0x23e246(0x122),{'year':_0x23e246(0x149),'month':'2-digit','day':_0x23e246(0x11d),'hour':_0x23e246(0x11d),'minute':_0x23e246(0x11d),'second':_0x23e246(0x11d)}),_0x51d759=_0x23e246(0x16d)+(_0x23e246(0x129)+_0x28f482+'\x0a')+(_0x23e246(0x10c)+_0x3fa0bb[_0x23e246(0x1ce)]+'\x20USD\x0a')+(_0x23e246(0x110)+(_0x3fa0bb[_0x23e246(0x13b)]||'Not\x20specified')+'\x0a')+(_0x23e246(0x194)+(_0x3fa0bb[_0x23e246(0x116)]||_0x23e246(0x165))+'\x0a')+(_0x23e246(0x1b1)+(_0x3fa0bb[_0x23e246(0x12c)]||_0x23e246(0x165))+'`\x0a')+(_0x3fa0bb[_0x23e246(0x150)]?'üîó\x20*Transaction\x20Link:*\x20`'+_0x3fa0bb[_0x23e246(0x150)]+'`':'üîó\x20*Transaction\x20Link:*\x20Pending');await this['sendShopNotification'](_0x44d427,_0x51d759,{'parse_mode':_0x23e246(0x201)});}async['sendLoginNotification'](_0x446f20,_0x34dfce){const _0x3ded9e=a78_0x291c18;try{const _0x58081b=await database_1[_0x3ded9e(0x18b)][_0x3ded9e(0x148)][_0x3ded9e(0x189)]({'where':{'shopId':_0x446f20},'select':{'notificationLogin':!![]}});if(!_0x58081b?.['notificationLogin']){console['log'](_0x3ded9e(0x1bf)+_0x446f20);return;}const _0x45e556=_0x34dfce[_0x3ded9e(0x1d5)]?'üîê':'üö®',_0x93f438=_0x34dfce['success']?'Successful\x20login':_0x3ded9e(0x113);let _0x205810=_0x45e556+'\x20*'+_0x93f438+'*\x0a\x0a'+('üë§\x20Username:\x20`'+_0x34dfce['username']+'`\x0a')+(_0x3ded9e(0x16b)+_0x34dfce[_0x3ded9e(0x1d8)]['toLocaleString'](_0x3ded9e(0x122))+'\x0a');_0x34dfce[_0x3ded9e(0x1a0)]&&(_0x205810+='üåê\x20IP\x20address:\x20`'+_0x34dfce['ipAddress']+'`\x0a');_0x34dfce[_0x3ded9e(0x1bd)]&&(_0x205810+=_0x3ded9e(0x137)+_0x34dfce['geo']+'\x0a');if(_0x34dfce[_0x3ded9e(0x13f)]){const _0x52ed55=_0x34dfce[_0x3ded9e(0x13f)][_0x3ded9e(0x1d1)]>0x32?_0x34dfce[_0x3ded9e(0x13f)][_0x3ded9e(0x1c4)](0x0,0x32)+_0x3ded9e(0x19f):_0x34dfce[_0x3ded9e(0x13f)];_0x205810+='üíª\x20Browser:\x20`'+_0x52ed55+'`\x0a';}!_0x34dfce[_0x3ded9e(0x1d5)]&&(_0x205810+='\x0a‚ö†Ô∏è\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x3ded9e(0x13c)](_0x446f20,_0x205810,{'parse_mode':_0x3ded9e(0x201)}),console[_0x3ded9e(0x157)]('‚úÖ\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x446f20+':\x20'+(_0x34dfce[_0x3ded9e(0x1d5)]?_0x3ded9e(0x1d5):_0x3ded9e(0x1b3)));}catch(_0x498bab){console[_0x3ded9e(0x128)]('Failed\x20to\x20send\x20login\x20notification:',_0x498bab);}}async[a78_0x291c18(0x11c)](_0x38249d,_0x159482){const _0x2b5316=a78_0x291c18;try{const _0x3e2d57=await database_1[_0x2b5316(0x18b)]['shopSettings'][_0x2b5316(0x189)]({'where':{'shopId':_0x38249d},'select':{'notificationApiError':!![]}});if(!_0x3e2d57?.[_0x2b5316(0x15d)]){console[_0x2b5316(0x157)](_0x2b5316(0x1a9)+_0x38249d);return;}let _0x5108fd='üö®\x20*API\x20Error*\x0a\x0a'+('üîó\x20Endpoint:\x20`'+_0x159482[_0x2b5316(0x199)]+'\x20'+_0x159482[_0x2b5316(0x153)]+'`\x0a')+('üìÖ\x20Time:\x20'+_0x159482['timestamp'][_0x2b5316(0x1d7)](_0x2b5316(0x122))+'\x0a');_0x159482['statusCode']&&(_0x5108fd+=_0x2b5316(0x1ec)+_0x159482[_0x2b5316(0x152)]+'`\x0a'),_0x5108fd+='‚ùå\x20Error:\x20`'+_0x159482[_0x2b5316(0x192)]+'`\x0a',_0x159482[_0x2b5316(0x1e7)]&&(_0x5108fd+=_0x2b5316(0x177)+_0x159482[_0x2b5316(0x1e7)]+'`\x0a'),_0x5108fd+=_0x2b5316(0x118),await this['sendShopNotification'](_0x38249d,_0x5108fd,{'parse_mode':_0x2b5316(0x201)}),console[_0x2b5316(0x157)]('‚úÖ\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x38249d+':\x20'+_0x159482[_0x2b5316(0x153)]);}catch(_0x3df0a3){console[_0x2b5316(0x128)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x3df0a3);}}async[a78_0x291c18(0x1dd)](_0x3cdd6e,_0x3764d7,_0x3c73a0){const _0x4c3389=a78_0x291c18;let _0x2165b3=_0x4c3389(0x1a1)+_0x3764d7+_0x4c3389(0x134);for(const [_0x3a018c,_0x2a6d59]of Object['entries'](_0x3c73a0)){_0x2a6d59!==null&&_0x2a6d59!==undefined&&(_0x2165b3+=_0x3a018c+_0x4c3389(0x188)+_0x2a6d59+'`\x0a');}await this[_0x4c3389(0x13c)](_0x3cdd6e,_0x2165b3,{'parse_mode':_0x4c3389(0x201)});}async[a78_0x291c18(0x164)](_0x15e631){const _0x202daf=a78_0x291c18;try{console[_0x202daf(0x157)](_0x202daf(0x123)+_0x15e631[_0x202daf(0x1c4)](0x0,0x32)+_0x202daf(0x19f));const _0x53255d=await database_1['default']['telegramUser']['findMany']({'select':{'telegramId':!![]}});if(_0x53255d[_0x202daf(0x1d1)]===0x0){console['log']('üì±\x20No\x20active\x20Telegram\x20users\x20found');return;}for(const _0x194efc of _0x53255d){try{await this[_0x202daf(0x1a8)]?.[_0x202daf(0x15c)](_0x194efc[_0x202daf(0x1c3)],_0x15e631,{'parse_mode':_0x202daf(0x201)});}catch(_0x564144){console[_0x202daf(0x128)](_0x202daf(0x191)+_0x194efc['telegramId']+':',_0x564144);}}console[_0x202daf(0x157)](_0x202daf(0x163)+_0x53255d[_0x202daf(0x1d1)]+_0x202daf(0x1d4));}catch(_0x125710){console[_0x202daf(0x128)]('‚ùå\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:',_0x125710);}}[a78_0x291c18(0x145)](){const _0x5ec629=a78_0x291c18;return{'isActive':!!this[_0x5ec629(0x1a8)],'username':this['botUsername']};}async['sendShopFile'](_0x47f9f0,_0x4eafdf,_0x359d83,_0x12001a){const _0x8e4295=a78_0x291c18;try{if(!this['bot'])return console[_0x8e4295(0x128)]('‚ùå\x20Telegram\x20bot\x20not\x20initialized'),![];const _0x3ac29a=await database_1[_0x8e4295(0x18b)][_0x8e4295(0x1f6)]['findMany']({'where':{'shopId':_0x47f9f0,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x3ac29a[_0x8e4295(0x1d1)]===0x0)return console[_0x8e4295(0x128)](_0x8e4295(0x19c)+_0x47f9f0),![];let _0x2ae616=0x0;for(const _0x369bd4 of _0x3ac29a){try{await this[_0x8e4295(0x1a8)][_0x8e4295(0x127)](_0x369bd4[_0x8e4295(0x1c3)],_0x4eafdf,{},{'filename':_0x359d83,'contentType':_0x359d83['endsWith']('.png')?_0x8e4295(0x203):_0x359d83['endsWith'](_0x8e4295(0x179))||_0x359d83['endsWith'](_0x8e4295(0x144))?_0x8e4295(0x1cc):_0x359d83[_0x8e4295(0x1ef)](_0x8e4295(0x1dc))?_0x8e4295(0x13d):'application/octet-stream'}),_0x12001a&&await this[_0x8e4295(0x1a8)][_0x8e4295(0x15c)](_0x369bd4[_0x8e4295(0x1c3)],_0x12001a),_0x2ae616++;}catch(_0x1916f3){console['error']('‚ùå\x20Error\x20sending\x20file\x20to\x20user\x20'+_0x369bd4[_0x8e4295(0x1c3)]+':',_0x1916f3);}}return console[_0x8e4295(0x157)](_0x8e4295(0x1a2)+_0x2ae616+'/'+_0x3ac29a[_0x8e4295(0x1d1)]+_0x8e4295(0x159)+_0x47f9f0+':\x20'+_0x359d83),_0x2ae616>0x0;}catch(_0x15b040){return console['error']('‚ùå\x20Error\x20sending\x20file\x20to\x20shop:',_0x15b040),![];}}async[a78_0x291c18(0x1e5)](_0x394f16,_0x40532a){const _0x5de3b2=a78_0x291c18;try{if(!this[_0x5de3b2(0x1a8)])return console[_0x5de3b2(0x128)](_0x5de3b2(0x1fc)),![];return await this[_0x5de3b2(0x1a8)][_0x5de3b2(0x15c)](_0x394f16,_0x40532a),console['log'](_0x5de3b2(0x1b9)+_0x394f16),!![];}catch(_0x1a83b4){return console[_0x5de3b2(0x128)]('‚ùå\x20Error\x20sending\x20direct\x20message:',_0x1a83b4),![];}}async[a78_0x291c18(0x14c)](_0x4d7f99,_0x10741b,_0x214f7c,_0x49a01b){const _0x1c5091=a78_0x291c18;try{if(!this[_0x1c5091(0x1a8)])return console['error']('‚ùå\x20Telegram\x20bot\x20not\x20initialized'),![];return await this[_0x1c5091(0x1a8)][_0x1c5091(0x127)](_0x4d7f99,_0x10741b,{},{'filename':_0x214f7c,'contentType':_0x214f7c['endsWith']('.png')?'image/png':_0x214f7c[_0x1c5091(0x1ef)](_0x1c5091(0x179))||_0x214f7c['endsWith']('.jpeg')?'image/jpeg':_0x214f7c[_0x1c5091(0x1ef)](_0x1c5091(0x1dc))?_0x1c5091(0x13d):_0x1c5091(0x1b5)}),_0x49a01b&&await this[_0x1c5091(0x1a8)]['sendMessage'](_0x4d7f99,_0x49a01b),console[_0x1c5091(0x157)](_0x1c5091(0x11e)+_0x4d7f99+':\x20'+_0x214f7c),!![];}catch(_0xd9fe65){return console[_0x1c5091(0x128)](_0x1c5091(0x197),_0xd9fe65),![];}}['stopBot'](){const _0x516878=a78_0x291c18;this[_0x516878(0x1a8)]&&(this[_0x516878(0x1a8)][_0x516878(0x146)](),this['bot']=null,console['log'](_0x516878(0x1ee)));}}exports[a78_0x291c18(0x15a)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();