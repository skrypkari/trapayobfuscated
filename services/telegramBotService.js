'use strict';const a54_0x1b702e=a54_0x2328;(function(_0x2c20b2,_0xafc517){const _0xa207b4=a54_0x2328,_0x3ad7f2=_0x2c20b2();while(!![]){try{const _0x1ee707=-parseInt(_0xa207b4(0x137))/0x1+parseInt(_0xa207b4(0x193))/0x2+parseInt(_0xa207b4(0x1a0))/0x3*(parseInt(_0xa207b4(0x162))/0x4)+parseInt(_0xa207b4(0x1cc))/0x5+parseInt(_0xa207b4(0x14b))/0x6*(-parseInt(_0xa207b4(0x1a4))/0x7)+parseInt(_0xa207b4(0x142))/0x8*(parseInt(_0xa207b4(0x1a2))/0x9)+parseInt(_0xa207b4(0x1c3))/0xa*(-parseInt(_0xa207b4(0x1ba))/0xb);if(_0x1ee707===_0xafc517)break;else _0x3ad7f2['push'](_0x3ad7f2['shift']());}catch(_0x1ba30b){_0x3ad7f2['push'](_0x3ad7f2['shift']());}}}(a54_0x3940,0x1d7f5));var __importDefault=this&&this[a54_0x1b702e(0x177)]||function(_0x3235c0){const _0x355538=a54_0x1b702e;return _0x3235c0&&_0x3235c0[_0x355538(0x191)]?_0x3235c0:{'default':_0x3235c0};};Object[a54_0x1b702e(0x159)](exports,a54_0x1b702e(0x191),{'value':!![]}),exports[a54_0x1b702e(0x183)]=exports[a54_0x1b702e(0x1bd)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a54_0x1b702e(0x12c))),gateway_1=require('../types/gateway');function a54_0x3940(){const _0x184ad1=['\x20verified\x20for\x20shop\x20','\x20initialized\x20successfully','📛\x20Name:\x20`','🔔\x20Notifications\x20are\x20active\x0a\x0a','processing','Example:\x0a','/status\x20-\x20check\x20connection\x20status\x0a','🏪\x20Available\x20shops\x20in\x20system:\x0a','/disconnect\x20-\x20disconnect\x20from\x20notifications','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','\x20USD*\x0a','💻\x20Browser:\x20`','customerUa','Payment\x20refund','ACTIVE','findMany','🆔\x20Request\x20ID:\x20`','username','Error\x20handling\x20/start\x20command:','user\x20is\x20deactivated','amount','pk_','map','substring','userAgent','Failed\x20to\x20send\x20login\x20notification:','adminNotes','🔍\x20*Debug\x20Information*\x0a\x0a','Commands:\x0a','Error\x20handling\x20/debug\x20command:','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','customerEmail','✅\x20Welcome\x20back!\x0a\x0a','customerIp','success','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','...`\x0a\x0a','❌\x20Error:\x20`','📱\x20Your\x20Telegram\x20ID:\x20`','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a',':\x20username=\x22','toString','publicKey','`\x0a\x0a','✅\x20Connected\x20to\x20shop:\x20*','sendCustomNotification','`\x20is\x20inactive.\x0a\x0a','errorMessage','Telegram\x20bot\x20error:','You\x20sent\x20','•\x20Payment\x20status\x20changes\x0a','\x20(@','method','💰\x20Amount:\x20*','findUnique','Check\x20spelling\x20and\x20try\x20again.','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','stopBot','New\x20payment\x20created','Failed\x20to\x20send\x20API\x20error\x20notification:','\x20USDT*\x0a','../config/database','statusCode','en-US','name','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','💸\x20Amount:\x20*','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.',':\x20`','entries','✅\x20Telegram\x20bot\x20@','Telegram\x20bot\x20polling\x20error:','100351FAkfog','*\x0a\x0a','Error\x20sending\x20shop\x20notification:','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','Markdown','❌\x20Shop\x20with\x20username\x20`','.\x20*','isVerified','\x20\x20\x20Public\x20Key:\x20`','📅\x20Time:\x20','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','160dFZlmt','sendShopNotification','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Error\x20handling\x20/status\x20command:','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','blocked','shopSettings','\x22,\x20apiKey=\x22','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','12pSepBB','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','allSettled','...\x22','split','startsWith','🆔\x20Payment\x20ID:\x20`','🆔\x20Payout\x20ID:\x20`','Payout\x20rejected','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','Error\x20handling\x20/disconnect\x20command:','📱\x20Telegram\x20notification:\x20gateway\x20\x22','orderId','chat\x20not\x20found','defineProperty','•\x20New\x20payments\x0a','•\x20Payouts\x0a','updatedAt','findFirst','env','toLocaleString','includes','🌐\x20IP\x20address:\x20`','20ChaVil','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','warn','Payment\x20successfully\x20paid','*.\x0a\x0a','Payment\x20failed','failed','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','shop','•\x20Important\x20events\x0a\x0a','Use\x20/start\x20to\x20begin.','gateway','📊\x20*Connection\x20Status*\x0a\x0a','TELEGRAM_BOT_USERNAME','🔗\x20TXID:\x20`','createdAt','💸\x20Penalty\x20amount:\x20*','first_name','handleSingleLineVerification','__importDefault','Available\x20usernames:\x0a','🏦\x20Method:\x20`','initializeBot','sendLoginNotification','getGatewayDisplayNameForTelegram','\x20disconnected\x20from\x20shop\x20','🛑\x20Telegram\x20bot\x20stopped','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','Contact\x20administrator.','telegramBotService','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','botToken','sendPaymentNotification','chargebackAmount','To\x20reconnect,\x20use\x20the\x20/start\x20command','from','status','last_name','default','\x0a👤\x20*Customer\x20Information:*\x0a','...','🚨\x20*API\x20Error*\x0a\x0a','onText','__esModule','•\x20Payouts\x0a\x0a','309376HRlecP','remitterIban','•\x20`','timestamp','message','ipAddress','stopPolling','📧\x20Email:\x20`','log','botUsername','sendMessage','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','📝\x20Notes:\x20','117567hjqMUL','requestId','49635RlEMOo','Successful\x20login','718648jKural','\x20parts:\x20','update','txid','polling_error','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','🌐\x20IP:\x20`','endpoint','📱\x20Created\x20new\x20Telegram\x20user:\x20','shopId','`.\x0a\x0a','❌\x20Shop\x20`','👤\x20Username:\x20`','getBotInfo','test','create','customerName','chargeback','User\x20','\x22\x20->\x20display\x20\x22','📊\x20Error\x20code:\x20`','📅\x20Connection\x20date:\x20','42977tpRdTb','bot','Payment\x20chargeback','TelegramBotService','🔗\x20Endpoint:\x20`','join','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','TELEGRAM_BOT_TOKEN','text','370ZJghFk','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','notificationLogin','Failed\x20login\x20attempt','\x20via\x20single-line\x20input','Use\x20/start\x20to\x20connect.','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','chat','length','550630KKVrFn','✅\x20Telegram\x20user\x20','telegramId','`\x20not\x20found.\x0a\x0a','telegramUser','error'];a54_0x3940=function(){return _0x184ad1;};return a54_0x3940();}function a54_0x2328(_0x156efe,_0x33638d){const _0x3940a4=a54_0x3940();return a54_0x2328=function(_0x2328a,_0x225c6f){_0x2328a=_0x2328a-0x111;let _0x377f88=_0x3940a4[_0x2328a];return _0x377f88;},a54_0x2328(_0x156efe,_0x33638d);}class TelegramBotService{constructor(){const _0xf77ead=a54_0x1b702e;this[_0xf77ead(0x1bb)]=null,this['botToken']=process['env'][_0xf77ead(0x1c1)]||'',this[_0xf77ead(0x19c)]=process[_0xf77ead(0x15e)][_0xf77ead(0x171)]||'trapay_bot',this[_0xf77ead(0x185)]?this['initializeBot']():console[_0xf77ead(0x164)](_0xf77ead(0x16b));}[a54_0x1b702e(0x17a)](){const _0x87ef9a=a54_0x1b702e;try{this[_0x87ef9a(0x1bb)]=new node_telegram_bot_api_1[(_0x87ef9a(0x18c))](this['botToken'],{'polling':!![]}),this['setupBotHandlers'](),console[_0x87ef9a(0x19b)](_0x87ef9a(0x135)+this[_0x87ef9a(0x19c)]+_0x87ef9a(0x1d3));}catch(_0x5458b4){console[_0x87ef9a(0x1d1)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x5458b4);}}['setupBotHandlers'](){const _0x4f9bcc=a54_0x1b702e;if(!this[_0x4f9bcc(0x1bb)])return;this['bot'][_0x4f9bcc(0x190)](/\/start/,async _0x1a5bf3=>{const _0x1b6078=_0x4f9bcc,_0x1814c4=_0x1a5bf3[_0x1b6078(0x1ca)]['id'],_0x373d10=_0x1a5bf3[_0x1b6078(0x189)]?.['id']['toString'](),_0x1b634f=_0x1a5bf3[_0x1b6078(0x189)]?.[_0x1b6078(0x1e3)],_0x321811=_0x1a5bf3[_0x1b6078(0x189)]?.[_0x1b6078(0x175)],_0x3e2bbf=_0x1a5bf3[_0x1b6078(0x189)]?.[_0x1b6078(0x18b)];if(!_0x373d10)return;try{let _0x20719d=await database_1[_0x1b6078(0x18c)][_0x1b6078(0x1d0)][_0x1b6078(0x125)]({'where':{'telegramId':_0x373d10},'include':{'shop':!![]}});!_0x20719d?(_0x20719d=await database_1['default'][_0x1b6078(0x1d0)][_0x1b6078(0x1b3)]({'data':{'telegramId':_0x373d10,'username':_0x1b634f,'firstName':_0x321811,'lastName':_0x3e2bbf,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x1b6078(0x19b)](_0x1b6078(0x1ac)+_0x373d10+_0x1b6078(0x122)+_0x1b634f+')')):_0x20719d=await database_1[_0x1b6078(0x18c)][_0x1b6078(0x1d0)][_0x1b6078(0x1a6)]({'where':{'telegramId':_0x373d10},'data':{'username':_0x1b634f,'firstName':_0x321811,'lastName':_0x3e2bbf},'include':{'shop':!![]}}),_0x20719d[_0x1b6078(0x13e)]&&_0x20719d[_0x1b6078(0x1ad)]&&_0x20719d['shop']?await this['bot']?.[_0x1b6078(0x19d)](_0x1814c4,_0x1b6078(0x1f2)+(_0x1b6078(0x181)+_0x20719d[_0x1b6078(0x16c)][_0x1b6078(0x12f)]+'*\x0a')+('Username:\x20`'+_0x20719d[_0x1b6078(0x16c)][_0x1b6078(0x1e3)]+_0x1b6078(0x11a))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x1b6078(0x15a)+_0x1b6078(0x121)+_0x1b6078(0x192)+'Commands:\x0a'+_0x1b6078(0x1d8)+_0x1b6078(0x1da),{'parse_mode':_0x1b6078(0x13b)}):(_0x20719d[_0x1b6078(0x1ad)]&&!_0x20719d['isVerified']&&(await database_1[_0x1b6078(0x18c)][_0x1b6078(0x1d0)][_0x1b6078(0x1a6)]({'where':{'telegramId':_0x373d10},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x1b6078(0x1f0)+_0x373d10)),await this[_0x1b6078(0x1bb)]?.[_0x1b6078(0x19d)](_0x1814c4,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x1b6078(0x1db)+_0x1b6078(0x1c0)+_0x1b6078(0x1d7)+_0x1b6078(0x1a9)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':'Markdown'}));}catch(_0x2fabe9){console[_0x1b6078(0x1d1)](_0x1b6078(0x1e4),_0x2fabe9),await this[_0x1b6078(0x1bb)]?.[_0x1b6078(0x19d)](_0x1814c4,_0x1b6078(0x130));}}),this['bot'][_0x4f9bcc(0x190)](/\/disconnect/,async _0x19b568=>{const _0x382151=_0x4f9bcc,_0x1598a1=_0x19b568['chat']['id'],_0x509b7f=_0x19b568[_0x382151(0x189)]?.['id'][_0x382151(0x118)]();if(!_0x509b7f)return;try{const _0x48b114=await database_1[_0x382151(0x18c)][_0x382151(0x1d0)]['findUnique']({'where':{'telegramId':_0x509b7f},'include':{'shop':!![]}});if(!_0x48b114||!_0x48b114[_0x382151(0x13e)]||!_0x48b114['shopId']){await this['bot']?.[_0x382151(0x19d)](_0x1598a1,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x1344e4=_0x48b114['shop']?.[_0x382151(0x12f)]||'unknown\x20shop';await database_1[_0x382151(0x18c)]['telegramUser'][_0x382151(0x1a6)]({'where':{'telegramId':_0x509b7f},'data':{'shopId':null,'isVerified':![]}}),console[_0x382151(0x19b)]('🔌\x20User\x20'+_0x509b7f+_0x382151(0x17d)+_0x48b114[_0x382151(0x1ad)]),await this[_0x382151(0x1bb)]?.[_0x382151(0x19d)](_0x1598a1,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x1344e4+_0x382151(0x166)+_0x382151(0x188),{'parse_mode':_0x382151(0x13b)});}catch(_0x27cd21){console[_0x382151(0x1d1)](_0x382151(0x155),_0x27cd21),await this[_0x382151(0x1bb)]?.[_0x382151(0x19d)](_0x1598a1,_0x382151(0x130));}}),this['bot']['onText'](/\/status/,async _0x3cf672=>{const _0x7089fd=_0x4f9bcc,_0x13933e=_0x3cf672[_0x7089fd(0x1ca)]['id'],_0x4bceff=_0x3cf672[_0x7089fd(0x189)]?.['id'][_0x7089fd(0x118)]();if(!_0x4bceff)return;try{const _0x42f5b3=await database_1[_0x7089fd(0x18c)][_0x7089fd(0x1d0)][_0x7089fd(0x125)]({'where':{'telegramId':_0x4bceff},'include':{'shop':!![]}});if(!_0x42f5b3){await this[_0x7089fd(0x1bb)]?.[_0x7089fd(0x19d)](_0x13933e,_0x7089fd(0x163)+_0x7089fd(0x16e));return;}if(!_0x42f5b3[_0x7089fd(0x13e)]||!_0x42f5b3['shopId']||!_0x42f5b3[_0x7089fd(0x16c)]){await this[_0x7089fd(0x1bb)]?.['sendMessage'](_0x13933e,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x7089fd(0x1c8));return;}await this['bot']?.[_0x7089fd(0x19d)](_0x13933e,_0x7089fd(0x170)+(_0x7089fd(0x11b)+_0x42f5b3[_0x7089fd(0x16c)]['name']+'*\x0a')+(_0x7089fd(0x1b0)+_0x42f5b3[_0x7089fd(0x16c)][_0x7089fd(0x1e3)]+'`\x0a')+(_0x7089fd(0x1b9)+_0x42f5b3[_0x7089fd(0x15c)]['toLocaleDateString'](_0x7089fd(0x12e))+'\x0a\x0a')+_0x7089fd(0x1d5)+_0x7089fd(0x1ee)+_0x7089fd(0x1da),{'parse_mode':'Markdown'});}catch(_0x36688a){console[_0x7089fd(0x1d1)](_0x7089fd(0x145),_0x36688a),await this[_0x7089fd(0x1bb)]?.['sendMessage'](_0x13933e,_0x7089fd(0x130));}}),this['bot'][_0x4f9bcc(0x190)](/\/debug/,async _0x3d3def=>{const _0x4eef31=_0x4f9bcc,_0x56078c=_0x3d3def[_0x4eef31(0x1ca)]['id'],_0x541a59=_0x3d3def[_0x4eef31(0x189)]?.['id'][_0x4eef31(0x118)]();if(!_0x541a59)return;try{const _0x4c5748=await database_1[_0x4eef31(0x18c)][_0x4eef31(0x16c)][_0x4eef31(0x1e1)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x2ffa14=_0x4eef31(0x1ed);_0x2ffa14+=_0x4eef31(0x115)+_0x541a59+_0x4eef31(0x11a),_0x2ffa14+=_0x4eef31(0x1d9),_0x4c5748['forEach']((_0x311a8a,_0x4b155a)=>{const _0x4d1452=_0x4eef31;_0x2ffa14+=_0x4b155a+0x1+_0x4d1452(0x13d)+_0x311a8a[_0x4d1452(0x12f)]+'*\x0a',_0x2ffa14+='\x20\x20\x20Username:\x20`'+_0x311a8a[_0x4d1452(0x1e3)]+'`\x0a',_0x2ffa14+='\x20\x20\x20Status:\x20'+_0x311a8a[_0x4d1452(0x18a)]+'\x0a',_0x2ffa14+=_0x4d1452(0x13f)+_0x311a8a[_0x4d1452(0x119)][_0x4d1452(0x1e9)](0x0,0xf)+_0x4d1452(0x113);}),await this[_0x4eef31(0x1bb)]?.[_0x4eef31(0x19d)](_0x56078c,_0x2ffa14,{'parse_mode':'Markdown'});}catch(_0x39b704){console[_0x4eef31(0x1d1)](_0x4eef31(0x1ef),_0x39b704),await this['bot']?.[_0x4eef31(0x19d)](_0x56078c,'❌\x20Error\x20getting\x20debug\x20information.');}}),this[_0x4f9bcc(0x1bb)]['on'](_0x4f9bcc(0x197),async _0x45c3b4=>{const _0x4bbee8=_0x4f9bcc;if(_0x45c3b4['text']?.[_0x4bbee8(0x150)]('/'))return;const _0x34e095=_0x45c3b4[_0x4bbee8(0x1ca)]['id'],_0x16f31c=_0x45c3b4['from']?.['id']['toString'](),_0x510e95=_0x45c3b4[_0x4bbee8(0x1c2)]?.['trim']();if(!_0x16f31c||!_0x510e95)return;try{const _0x2913c3=await database_1[_0x4bbee8(0x18c)][_0x4bbee8(0x1d0)][_0x4bbee8(0x125)]({'where':{'telegramId':_0x16f31c},'include':{'shop':!![]}});if(!_0x2913c3){await this[_0x4bbee8(0x1bb)]?.[_0x4bbee8(0x19d)](_0x34e095,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x2913c3[_0x4bbee8(0x13e)]&&_0x2913c3['shopId']&&_0x2913c3[_0x4bbee8(0x16c)]){await this['bot']?.[_0x4bbee8(0x19d)](_0x34e095,_0x4bbee8(0x144)+_0x2913c3[_0x4bbee8(0x16c)]['name']+_0x4bbee8(0x166)+_0x4bbee8(0x146),{'parse_mode':_0x4bbee8(0x13b)});return;}const _0x1e8fdb=_0x510e95[_0x4bbee8(0x14f)](/\s+/);if(_0x1e8fdb[_0x4bbee8(0x1cb)]!==0x2){await this[_0x4bbee8(0x1bb)]?.[_0x4bbee8(0x19d)](_0x34e095,_0x4bbee8(0x1c9)+_0x4bbee8(0x1c0)+_0x4bbee8(0x1d7)+_0x4bbee8(0x1a9)+(_0x4bbee8(0x120)+_0x1e8fdb[_0x4bbee8(0x1cb)]+_0x4bbee8(0x1a5)+_0x1e8fdb[_0x4bbee8(0x1e8)](_0x161b05=>'`'+_0x161b05+'`')[_0x4bbee8(0x1bf)](',\x20')),{'parse_mode':_0x4bbee8(0x13b)});return;}const [_0xddd017,_0xfecfdd]=_0x1e8fdb;console[_0x4bbee8(0x19b)](_0x4bbee8(0x19e)+_0x16f31c+':\x20username=\x22'+_0xddd017+_0x4bbee8(0x149)+_0xfecfdd[_0x4bbee8(0x1e9)](0x0,0xa)+_0x4bbee8(0x14e)),await this[_0x4bbee8(0x176)](_0x34e095,_0x16f31c,_0xddd017,_0xfecfdd);}catch(_0x2b559d){console['error']('Error\x20handling\x20message:',_0x2b559d),await this[_0x4bbee8(0x1bb)]?.[_0x4bbee8(0x19d)](_0x34e095,_0x4bbee8(0x130));}}),this['bot']['on'](_0x4f9bcc(0x1d1),_0x54a9f4=>{const _0x6d5f78=_0x4f9bcc;console[_0x6d5f78(0x1d1)](_0x6d5f78(0x11f),_0x54a9f4);}),this['bot']['on'](_0x4f9bcc(0x1a8),_0x1fd72c=>{const _0x4fd8a8=_0x4f9bcc;console['error'](_0x4fd8a8(0x136),_0x1fd72c);});}async[a54_0x1b702e(0x176)](_0x55074b,_0x1c81ad,_0x58982b,_0x1cc2c5){const _0x2ddcbc=a54_0x1b702e;try{console[_0x2ddcbc(0x19b)](_0x2ddcbc(0x19e)+_0x1c81ad+_0x2ddcbc(0x117)+_0x58982b+_0x2ddcbc(0x149)+_0x1cc2c5[_0x2ddcbc(0x1e9)](0x0,0xa)+_0x2ddcbc(0x14e));if(!_0x58982b||_0x58982b[_0x2ddcbc(0x1cb)]<0x3||_0x58982b[_0x2ddcbc(0x1cb)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x2ddcbc(0x1b2)](_0x58982b)){await this[_0x2ddcbc(0x1bb)]?.[_0x2ddcbc(0x19d)](_0x55074b,'❌\x20Invalid\x20username\x20format:\x20`'+_0x58982b+'`\x0a\x0a'+_0x2ddcbc(0x180),{'parse_mode':_0x2ddcbc(0x13b)});return;}if(!_0x1cc2c5||!_0x1cc2c5[_0x2ddcbc(0x150)](_0x2ddcbc(0x1e7))&&!_0x1cc2c5['startsWith']('sk_')){await this[_0x2ddcbc(0x1bb)]?.[_0x2ddcbc(0x19d)](_0x55074b,_0x2ddcbc(0x1c4)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':'Markdown'});return;}const _0x58cda3=await database_1[_0x2ddcbc(0x18c)]['shop'][_0x2ddcbc(0x125)]({'where':{'username':_0x58982b},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x58cda3){const _0x394de4=await database_1[_0x2ddcbc(0x18c)][_0x2ddcbc(0x16c)][_0x2ddcbc(0x1e1)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x354048=_0x2ddcbc(0x13c)+_0x58982b+_0x2ddcbc(0x1cf);_0x394de4[_0x2ddcbc(0x1cb)]>0x0?(_0x354048+=_0x2ddcbc(0x178),_0x394de4['forEach'](_0x21f373=>{const _0x3a5443=_0x2ddcbc;_0x354048+=_0x3a5443(0x195)+_0x21f373[_0x3a5443(0x1e3)]+'`\x20('+_0x21f373['name']+')\x0a';}),_0x354048+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x354048+=_0x2ddcbc(0x126);await this[_0x2ddcbc(0x1bb)]?.[_0x2ddcbc(0x19d)](_0x55074b,_0x354048,{'parse_mode':_0x2ddcbc(0x13b)});return;}if(_0x58cda3[_0x2ddcbc(0x18a)]!==_0x2ddcbc(0x1e0)){await this[_0x2ddcbc(0x1bb)]?.[_0x2ddcbc(0x19d)](_0x55074b,_0x2ddcbc(0x1af)+_0x58982b+_0x2ddcbc(0x11d)+_0x2ddcbc(0x182),{'parse_mode':_0x2ddcbc(0x13b)});return;}if(_0x58cda3[_0x2ddcbc(0x119)]!==_0x1cc2c5&&_0x58cda3['secretKey']!==_0x1cc2c5){await this[_0x2ddcbc(0x1bb)]?.[_0x2ddcbc(0x19d)](_0x55074b,_0x2ddcbc(0x16a)+_0x58982b+_0x2ddcbc(0x1ae)+_0x2ddcbc(0x116)+_0x2ddcbc(0x17f),{'parse_mode':_0x2ddcbc(0x13b)});return;}const _0x1a3a30=await database_1[_0x2ddcbc(0x18c)][_0x2ddcbc(0x1d0)][_0x2ddcbc(0x15d)]({'where':{'shopId':_0x58cda3['id'],'isVerified':!![],'telegramId':{'not':_0x1c81ad}}});if(_0x1a3a30){await this[_0x2ddcbc(0x1bb)]?.[_0x2ddcbc(0x19d)](_0x55074b,_0x2ddcbc(0x184)+_0x58982b+'`.\x0a\x0a'+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x2ddcbc(0x13b)});return;}await database_1[_0x2ddcbc(0x18c)][_0x2ddcbc(0x1d0)][_0x2ddcbc(0x1a6)]({'where':{'telegramId':_0x1c81ad},'data':{'shopId':_0x58cda3['id'],'isVerified':!![]}}),await this['bot']?.[_0x2ddcbc(0x19d)](_0x55074b,'🎉\x20*Congratulations!*\x0a\x0a'+_0x2ddcbc(0x14a)+('📱\x20Shop:\x20*'+_0x58cda3[_0x2ddcbc(0x12f)]+'*\x0a')+(_0x2ddcbc(0x1b0)+_0x58cda3[_0x2ddcbc(0x1e3)]+_0x2ddcbc(0x11a))+_0x2ddcbc(0x13a)+_0x2ddcbc(0x15a)+'•\x20Payment\x20status\x20changes\x0a'+_0x2ddcbc(0x15b)+_0x2ddcbc(0x16d)+_0x2ddcbc(0x1ee)+_0x2ddcbc(0x1d8)+_0x2ddcbc(0x1da),{'parse_mode':_0x2ddcbc(0x13b)}),console[_0x2ddcbc(0x19b)](_0x2ddcbc(0x1cd)+_0x1c81ad+_0x2ddcbc(0x1d2)+_0x58cda3['username']+_0x2ddcbc(0x1c7));}catch(_0x5b058d){console[_0x2ddcbc(0x1d1)]('Error\x20in\x20handleSingleLineVerification:',_0x5b058d),await this[_0x2ddcbc(0x1bb)]?.[_0x2ddcbc(0x19d)](_0x55074b,_0x2ddcbc(0x132));}}async[a54_0x1b702e(0x143)](_0xce5050,_0x5ec8d3,_0x59415e){const _0x470d9d=a54_0x1b702e;if(!this['bot']){console['warn']('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x3e61cc=await database_1['default'][_0x470d9d(0x1d0)][_0x470d9d(0x1e1)]({'where':{'shopId':_0xce5050,'isVerified':!![]}});if(_0x3e61cc[_0x470d9d(0x1cb)]===0x0){console[_0x470d9d(0x19b)](_0x470d9d(0x169)+_0xce5050);return;}const _0x302b21=_0x3e61cc[_0x470d9d(0x1e8)](async _0x2ba5cc=>{const _0x4de8ef=_0x470d9d;try{await this[_0x4de8ef(0x1bb)]?.[_0x4de8ef(0x19d)](_0x2ba5cc[_0x4de8ef(0x1ce)],_0x5ec8d3,_0x59415e),console[_0x4de8ef(0x19b)](_0x4de8ef(0x112)+_0x2ba5cc['telegramId']);}catch(_0xf1257d){console['error']('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x2ba5cc['telegramId']+':',_0xf1257d),_0xf1257d instanceof Error&&(_0xf1257d[_0x4de8ef(0x197)][_0x4de8ef(0x160)](_0x4de8ef(0x147))||_0xf1257d[_0x4de8ef(0x197)][_0x4de8ef(0x160)](_0x4de8ef(0x158))||_0xf1257d[_0x4de8ef(0x197)][_0x4de8ef(0x160)](_0x4de8ef(0x1e5)))&&(await database_1[_0x4de8ef(0x18c)][_0x4de8ef(0x1d0)][_0x4de8ef(0x1a6)]({'where':{'id':_0x2ba5cc['id']},'data':{'isVerified':![]}}),console['log'](_0x4de8ef(0x1b6)+_0x2ba5cc[_0x4de8ef(0x1ce)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x470d9d(0x14d)](_0x302b21);}catch(_0x259929){console[_0x470d9d(0x1d1)](_0x470d9d(0x139),_0x259929);}}async[a54_0x1b702e(0x186)](_0x25d092,_0x28a852,_0x9ebb66){const _0x1537ba=a54_0x1b702e,_0x1b2b3a={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x5e8a57={'created':_0x1537ba(0x129),'paid':_0x1537ba(0x165),'failed':_0x1537ba(0x167),'expired':'Payment\x20expired','refund':_0x1537ba(0x1df),'chargeback':_0x1537ba(0x1bc),'processing':'Payment\x20is\x20being\x20processed'},_0x2b9a69=_0x1b2b3a[_0x9ebb66],_0xefcf67=_0x5e8a57[_0x9ebb66],_0x5a841e=(0x0,gateway_1[_0x1537ba(0x17c)])(_0x28a852[_0x1537ba(0x16f)]);console[_0x1537ba(0x19b)](_0x1537ba(0x156)+_0x28a852[_0x1537ba(0x16f)]+_0x1537ba(0x1b7)+_0x5a841e+'\x22');let _0x3cab37=_0x2b9a69+'\x20*'+_0xefcf67+_0x1537ba(0x138)+(_0x1537ba(0x124)+_0x28a852[_0x1537ba(0x1e6)]+'\x20'+_0x28a852['currency']+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x28a852[_0x1537ba(0x157)]||_0x28a852['id'])+'`\x0a')+(_0x1537ba(0x151)+_0x28a852['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x5a841e+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x28a852['createdAt'])[_0x1537ba(0x15f)](_0x1537ba(0x12e))+'\x0a');if(_0x28a852[_0x1537ba(0x1b4)]||_0x28a852[_0x1537ba(0x1f1)]||_0x28a852[_0x1537ba(0x194)]||_0x28a852[_0x1537ba(0x1f3)]||_0x28a852[_0x1537ba(0x1de)]){_0x3cab37+=_0x1537ba(0x18d);_0x28a852[_0x1537ba(0x1b4)]&&(_0x3cab37+=_0x1537ba(0x1d4)+_0x28a852[_0x1537ba(0x1b4)]+'`\x0a');_0x28a852[_0x1537ba(0x1f1)]&&(_0x3cab37+=_0x1537ba(0x19a)+_0x28a852['customerEmail']+'`\x0a');_0x28a852[_0x1537ba(0x194)]&&(_0x3cab37+='🏦\x20IBAN:\x20`'+_0x28a852['remitterIban']+'`\x0a');_0x28a852[_0x1537ba(0x1f3)]&&(_0x3cab37+=_0x1537ba(0x1aa)+_0x28a852[_0x1537ba(0x1f3)]+'`\x0a');if(_0x28a852[_0x1537ba(0x1de)]){const _0x21ed89=_0x28a852[_0x1537ba(0x1de)][_0x1537ba(0x1cb)]>0x32?_0x28a852[_0x1537ba(0x1de)][_0x1537ba(0x1e9)](0x0,0x32)+_0x1537ba(0x18e):_0x28a852['customerUa'];_0x3cab37+=_0x1537ba(0x1dd)+_0x21ed89+'`\x0a';}}_0x9ebb66===_0x1537ba(0x1b5)&&_0x28a852[_0x1537ba(0x187)]&&(_0x3cab37+=_0x1537ba(0x174)+_0x28a852[_0x1537ba(0x187)]+_0x1537ba(0x12b)),_0x9ebb66===_0x1537ba(0x1d6)&&(_0x3cab37+=_0x1537ba(0x154)),_0x28a852[_0x1537ba(0x1ec)]&&(_0x3cab37+=_0x1537ba(0x19f)+_0x28a852[_0x1537ba(0x1ec)]+'\x0a'),await this[_0x1537ba(0x143)](_0x25d092,_0x3cab37,{'parse_mode':_0x1537ba(0x13b)});}async['sendPayoutNotification'](_0x2fbd45,_0x1be447,_0x434de5){const _0xc4d5f8=a54_0x1b702e,_0x3886f5={'created':'📤','completed':'✅','rejected':'❌'},_0x5ef0b5={'created':'New\x20payout\x20created','completed':'Payout\x20completed','rejected':_0xc4d5f8(0x153)},_0x585527=_0x3886f5[_0x434de5],_0x512398=_0x5ef0b5[_0x434de5],_0x2964eb=_0x585527+'\x20*'+_0x512398+_0xc4d5f8(0x138)+(_0xc4d5f8(0x131)+_0x1be447[_0xc4d5f8(0x1e6)]+_0xc4d5f8(0x1dc))+(_0xc4d5f8(0x179)+_0x1be447['method']+'`\x0a')+(_0xc4d5f8(0x152)+_0x1be447['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x1be447[_0xc4d5f8(0x173)])['toLocaleString'](_0xc4d5f8(0x12e))+'\x0a')+(_0x1be447['txid']?_0xc4d5f8(0x172)+_0x1be447[_0xc4d5f8(0x1a7)]+'`':'');await this[_0xc4d5f8(0x143)](_0x2fbd45,_0x2964eb,{'parse_mode':_0xc4d5f8(0x13b)});}async[a54_0x1b702e(0x17b)](_0x48dfc4,_0x26bab0){const _0x3181b3=a54_0x1b702e;try{const _0x4c3d88=await database_1['default'][_0x3181b3(0x148)][_0x3181b3(0x125)]({'where':{'shopId':_0x48dfc4},'select':{'notificationLogin':!![]}});if(!_0x4c3d88?.[_0x3181b3(0x1c5)]){console[_0x3181b3(0x19b)](_0x3181b3(0x14c)+_0x48dfc4);return;}const _0x3fdba8=_0x26bab0['success']?'🔐':'🚨',_0x55530f=_0x26bab0[_0x3181b3(0x111)]?_0x3181b3(0x1a3):_0x3181b3(0x1c6);let _0x5ab87c=_0x3fdba8+'\x20*'+_0x55530f+'*\x0a\x0a'+(_0x3181b3(0x1b0)+_0x26bab0['username']+'`\x0a')+(_0x3181b3(0x140)+_0x26bab0[_0x3181b3(0x196)][_0x3181b3(0x15f)]('en-US')+'\x0a');_0x26bab0[_0x3181b3(0x198)]&&(_0x5ab87c+=_0x3181b3(0x161)+_0x26bab0[_0x3181b3(0x198)]+'`\x0a');if(_0x26bab0['userAgent']){const _0x2a3933=_0x26bab0['userAgent'][_0x3181b3(0x1cb)]>0x32?_0x26bab0[_0x3181b3(0x1ea)]['substring'](0x0,0x32)+_0x3181b3(0x18e):_0x26bab0[_0x3181b3(0x1ea)];_0x5ab87c+=_0x3181b3(0x1dd)+_0x2a3933+'`\x0a';}!_0x26bab0[_0x3181b3(0x111)]&&(_0x5ab87c+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x3181b3(0x143)](_0x48dfc4,_0x5ab87c,{'parse_mode':_0x3181b3(0x13b)}),console[_0x3181b3(0x19b)](_0x3181b3(0x141)+_0x48dfc4+':\x20'+(_0x26bab0['success']?_0x3181b3(0x111):_0x3181b3(0x168)));}catch(_0x4eda0b){console[_0x3181b3(0x1d1)](_0x3181b3(0x1eb),_0x4eda0b);}}async['sendApiErrorNotification'](_0x57bf75,_0x7fc07d){const _0x394234=a54_0x1b702e;try{const _0x1f2a15=await database_1[_0x394234(0x18c)]['shopSettings'][_0x394234(0x125)]({'where':{'shopId':_0x57bf75},'select':{'notificationApiError':!![]}});if(!_0x1f2a15?.['notificationApiError']){console['log'](_0x394234(0x127)+_0x57bf75);return;}let _0x2231c6=_0x394234(0x18f)+(_0x394234(0x1be)+_0x7fc07d[_0x394234(0x123)]+'\x20'+_0x7fc07d['endpoint']+'`\x0a')+('📅\x20Time:\x20'+_0x7fc07d[_0x394234(0x196)][_0x394234(0x15f)](_0x394234(0x12e))+'\x0a');_0x7fc07d[_0x394234(0x12d)]&&(_0x2231c6+=_0x394234(0x1b8)+_0x7fc07d[_0x394234(0x12d)]+'`\x0a'),_0x2231c6+=_0x394234(0x114)+_0x7fc07d[_0x394234(0x11e)]+'`\x0a',_0x7fc07d[_0x394234(0x1a1)]&&(_0x2231c6+=_0x394234(0x1e2)+_0x7fc07d['requestId']+'`\x0a'),_0x2231c6+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x394234(0x143)](_0x57bf75,_0x2231c6,{'parse_mode':_0x394234(0x13b)}),console[_0x394234(0x19b)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x57bf75+':\x20'+_0x7fc07d[_0x394234(0x1ab)]);}catch(_0x4f985a){console[_0x394234(0x1d1)](_0x394234(0x12a),_0x4f985a);}}async[a54_0x1b702e(0x11c)](_0x239935,_0x3ce7cb,_0x5ec849){const _0x28c8d0=a54_0x1b702e;let _0x1e72b4='🔔\x20*'+_0x3ce7cb+_0x28c8d0(0x138);for(const [_0x5044a7,_0x76adf7]of Object[_0x28c8d0(0x134)](_0x5ec849)){_0x76adf7!==null&&_0x76adf7!==undefined&&(_0x1e72b4+=_0x5044a7+_0x28c8d0(0x133)+_0x76adf7+'`\x0a');}await this[_0x28c8d0(0x143)](_0x239935,_0x1e72b4,{'parse_mode':_0x28c8d0(0x13b)});}[a54_0x1b702e(0x1b1)](){const _0x2cadbc=a54_0x1b702e;return{'isActive':!!this[_0x2cadbc(0x1bb)],'username':this[_0x2cadbc(0x19c)]};}[a54_0x1b702e(0x128)](){const _0x14460f=a54_0x1b702e;this[_0x14460f(0x1bb)]&&(this[_0x14460f(0x1bb)][_0x14460f(0x199)](),this[_0x14460f(0x1bb)]=null,console[_0x14460f(0x19b)](_0x14460f(0x17e)));}}exports[a54_0x1b702e(0x1bd)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();