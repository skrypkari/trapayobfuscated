'use strict';const a55_0x405ecc=a55_0x4b40;function a55_0x4b40(_0x4347bf,_0x1f0504){const _0x129fb7=a55_0x129f();return a55_0x4b40=function(_0x4b40e0,_0x14b7b0){_0x4b40e0=_0x4b40e0-0x18f;let _0x12ab42=_0x129fb7[_0x4b40e0];return _0x12ab42;},a55_0x4b40(_0x4347bf,_0x1f0504);}(function(_0xbe534d,_0xf85d00){const _0x1e6da6=a55_0x4b40,_0x5ea753=_0xbe534d();while(!![]){try{const _0x586c58=-parseInt(_0x1e6da6(0x1e0))/0x1*(-parseInt(_0x1e6da6(0x23c))/0x2)+-parseInt(_0x1e6da6(0x1b8))/0x3+parseInt(_0x1e6da6(0x245))/0x4+-parseInt(_0x1e6da6(0x18f))/0x5+parseInt(_0x1e6da6(0x1a4))/0x6+parseInt(_0x1e6da6(0x260))/0x7+-parseInt(_0x1e6da6(0x1b5))/0x8*(parseInt(_0x1e6da6(0x199))/0x9);if(_0x586c58===_0xf85d00)break;else _0x5ea753['push'](_0x5ea753['shift']());}catch(_0x15f97f){_0x5ea753['push'](_0x5ea753['shift']());}}}(a55_0x129f,0x7ec6d));var __importDefault=this&&this['__importDefault']||function(_0x1d76f7){const _0x45a284=a55_0x4b40;return _0x1d76f7&&_0x1d76f7[_0x45a284(0x228)]?_0x1d76f7:{'default':_0x1d76f7};};Object[a55_0x405ecc(0x1fa)](exports,a55_0x405ecc(0x228),{'value':!![]}),exports['telegramBotService']=exports[a55_0x405ecc(0x1d5)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a55_0x405ecc(0x221))),database_1=__importDefault(require(a55_0x405ecc(0x249))),gateway_1=require(a55_0x405ecc(0x1fd));function a55_0x129f(){const _0x3ffad1=['3aMAtfz','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','length','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','\x20disconnected\x20from\x20shop\x20','✅\x20Telegram\x20bot\x20@','status','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','Successful\x20login','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','\x20via\x20single-line\x20input','log','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','sk_','Payment\x20refund','💰\x20Amount:\x20*','👤\x20Username:\x20`','New\x20payout\x20created','blocked','includes','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','Example:\x0a','findMany','defineProperty','name','🔔\x20*','../types/gateway','🆔\x20Payment\x20ID:\x20`','`\x20not\x20found.\x0a\x0a','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','toLocaleString','Telegram\x20bot\x20error:','trim','ipAddress','errorMessage','from','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','❌\x20Error\x20getting\x20debug\x20information.','✅\x20Welcome\x20back!\x0a\x0a','✅\x20Connected\x20to\x20shop:\x20*','default','shopSettings','remitterIban','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','getGatewayDisplayNameForTelegram','/status\x20-\x20check\x20connection\x20status\x0a','Available\x20usernames:\x0a','•\x20Important\x20events\x0a\x0a','📅\x20Date:\x20','join','❌\x20Please\x20use\x20/start\x20command\x20first','`.\x0a\x0a','user\x20is\x20deactivated','❌\x20Shop\x20with\x20username\x20`','botUsername','...','customerUa','botToken','en-US','chat\x20not\x20found','📱\x20Telegram\x20notification:\x20gateway\x20\x22','node-telegram-bot-api','requestId','ACTIVE','/disconnect\x20-\x20disconnect\x20from\x20notifications','sendCustomNotification','🆔\x20Request\x20ID:\x20`','🎉\x20*Congratulations!*\x0a\x0a','__esModule','secretKey','chargebackAmount','chat','TELEGRAM_BOT_TOKEN','TELEGRAM_BOT_USERNAME','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','`\x0a\x0a','❌\x20Error:\x20`','Error\x20handling\x20/disconnect\x20command:','initializeBot','create','•\x20`','🔔\x20Notifications\x20are\x20active\x0a\x0a','\x20verified\x20for\x20shop\x20','\x20\x20\x20Username:\x20`','🏪\x20Gateway:\x20`','substring','\x20\x20\x20Status:\x20','Error\x20handling\x20/debug\x20command:','147074XugCbP','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','*\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','\x22\x20->\x20display\x20\x22','toString','Payment\x20expired','Error\x20handling\x20/status\x20command:','📧\x20Email:\x20`','3482568oMSUpT','🔌\x20User\x20','sendPayoutNotification','🚨\x20*API\x20Error*\x0a\x0a','../config/database','🌐\x20IP:\x20`','📱\x20Your\x20Telegram\x20ID:\x20`','\x20USDT*\x0a','Payment\x20is\x20being\x20processed','sendMessage','\x0a👤\x20*Customer\x20Information:*\x0a','isVerified','onText','\x20parts:\x20','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','findUnique','trapay_bot','🏪\x20Available\x20shops\x20in\x20system:\x0a','map','warn','📊\x20*Connection\x20Status*\x0a\x0a','\x20(@','📅\x20Time:\x20',':\x20`',':\x20username=\x22','🏦\x20IBAN:\x20`','\x22,\x20apiKey=\x22','1905386jjTozo','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','update','*.\x0a\x0a','unknown\x20shop','notificationApiError','Username:\x20`','customerName','📝\x20Notes:\x20','Markdown','stopPolling','stopBot','sendPaymentNotification','gateway','1448745CvSVuB','processing','telegramBotService','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','Contact\x20administrator.','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','📅\x20Connection\x20date:\x20','customerEmail','sendApiErrorNotification','...\x22','36XnjwTw','Error\x20sending\x20shop\x20notification:','notificationLogin','sendShopNotification','💻\x20Browser:\x20`','success','🏦\x20Method:\x20`','Payment\x20chargeback','shopId','username','You\x20sent\x20','910662gbbUAt','chargeback','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','bot','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','💸\x20Penalty\x20amount:\x20*','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','adminNotes','\x20\x20\x20Public\x20Key:\x20`','timestamp','endpoint','`\x20is\x20inactive.\x0a\x0a','🔗\x20TXID:\x20`','shop','split','telegramId','Payout\x20completed','1400656XxZTOc','📱\x20Created\x20new\x20Telegram\x20user:\x20','startsWith','17622LfFDoi','Commands:\x0a','txid','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','customerIp','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','statusCode','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','telegramUser','createdAt','\x20USD*\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','publicKey','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','findFirst','forEach','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','toLocaleDateString','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','New\x20payment\x20created','❌\x20Invalid\x20username\x20format:\x20`','method','userAgent','message','polling_error','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','Payment\x20failed','updatedAt','TelegramBotService','handleSingleLineVerification','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','•\x20New\x20payments\x0a','setupBotHandlers','getBotInfo','currency','🌐\x20IP\x20address:\x20`','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Failed\x20to\x20send\x20API\x20error\x20notification:','error'];a55_0x129f=function(){return _0x3ffad1;};return a55_0x129f();}class TelegramBotService{constructor(){const _0x186bc6=a55_0x405ecc;this[_0x186bc6(0x1a7)]=null,this[_0x186bc6(0x21d)]=process['env'][_0x186bc6(0x22c)]||'',this['botUsername']=process['env'][_0x186bc6(0x22d)]||_0x186bc6(0x255),this[_0x186bc6(0x21d)]?this[_0x186bc6(0x232)]():console[_0x186bc6(0x258)](_0x186bc6(0x1a8));}[a55_0x405ecc(0x232)](){const _0x214b86=a55_0x405ecc;try{this[_0x214b86(0x1a7)]=new node_telegram_bot_api_1[(_0x214b86(0x20c))](this[_0x214b86(0x21d)],{'polling':!![]}),this['setupBotHandlers'](),console['log'](_0x214b86(0x1e5)+this['botUsername']+'\x20initialized\x20successfully');}catch(_0x42065d){console[_0x214b86(0x1df)](_0x214b86(0x1d7),_0x42065d);}}[a55_0x405ecc(0x1d9)](){const _0x311581=a55_0x405ecc;if(!this['bot'])return;this[_0x311581(0x1a7)][_0x311581(0x251)](/\/start/,async _0x4fa248=>{const _0x43ec19=_0x311581,_0x3a52f7=_0x4fa248[_0x43ec19(0x22b)]['id'],_0x25e832=_0x4fa248[_0x43ec19(0x206)]?.['id']['toString'](),_0x1e3558=_0x4fa248['from']?.['username'],_0x2908a7=_0x4fa248[_0x43ec19(0x206)]?.['first_name'],_0xdae8bd=_0x4fa248['from']?.['last_name'];if(!_0x25e832)return;try{let _0x5bff46=await database_1[_0x43ec19(0x20c)][_0x43ec19(0x1c1)][_0x43ec19(0x254)]({'where':{'telegramId':_0x25e832},'include':{'shop':!![]}});!_0x5bff46?(_0x5bff46=await database_1[_0x43ec19(0x20c)][_0x43ec19(0x1c1)][_0x43ec19(0x233)]({'data':{'telegramId':_0x25e832,'username':_0x1e3558,'firstName':_0x2908a7,'lastName':_0xdae8bd,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x43ec19(0x1b6)+_0x25e832+_0x43ec19(0x25a)+_0x1e3558+')')):_0x5bff46=await database_1['default']['telegramUser'][_0x43ec19(0x262)]({'where':{'telegramId':_0x25e832},'data':{'username':_0x1e3558,'firstName':_0x2908a7,'lastName':_0xdae8bd},'include':{'shop':!![]}}),_0x5bff46['isVerified']&&_0x5bff46[_0x43ec19(0x1a1)]&&_0x5bff46['shop']?await this[_0x43ec19(0x1a7)]?.[_0x43ec19(0x24e)](_0x3a52f7,_0x43ec19(0x20a)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x5bff46[_0x43ec19(0x1b1)][_0x43ec19(0x1fb)]+'*\x0a')+(_0x43ec19(0x266)+_0x5bff46['shop'][_0x43ec19(0x1a2)]+'`\x0a\x0a')+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x43ec19(0x1d8)+'•\x20Payment\x20status\x20changes\x0a'+'•\x20Payouts\x0a\x0a'+'Commands:\x0a'+_0x43ec19(0x211)+_0x43ec19(0x224),{'parse_mode':_0x43ec19(0x269)}):(_0x5bff46[_0x43ec19(0x1a1)]&&!_0x5bff46[_0x43ec19(0x250)]&&(await database_1[_0x43ec19(0x20c)][_0x43ec19(0x1c1)][_0x43ec19(0x262)]({'where':{'telegramId':_0x25e832},'data':{'shopId':null,'isVerified':![]}}),console[_0x43ec19(0x1ec)](_0x43ec19(0x253)+_0x25e832)),await this[_0x43ec19(0x1a7)]?.[_0x43ec19(0x24e)](_0x3a52f7,_0x43ec19(0x1d2)+_0x43ec19(0x1dd)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x43ec19(0x1f8)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x43ec19(0x1f7),{'parse_mode':_0x43ec19(0x269)}));}catch(_0x673dfe){console[_0x43ec19(0x1df)]('Error\x20handling\x20/start\x20command:',_0x673dfe),await this['bot']?.['sendMessage'](_0x3a52f7,_0x43ec19(0x207));}}),this[_0x311581(0x1a7)][_0x311581(0x251)](/\/disconnect/,async _0x2710b5=>{const _0x433f9a=_0x311581,_0x37ef4f=_0x2710b5[_0x433f9a(0x22b)]['id'],_0x2252c1=_0x2710b5[_0x433f9a(0x206)]?.['id']['toString']();if(!_0x2252c1)return;try{const _0x378174=await database_1[_0x433f9a(0x20c)][_0x433f9a(0x1c1)][_0x433f9a(0x254)]({'where':{'telegramId':_0x2252c1},'include':{'shop':!![]}});if(!_0x378174||!_0x378174[_0x433f9a(0x250)]||!_0x378174[_0x433f9a(0x1a1)]){await this[_0x433f9a(0x1a7)]?.[_0x433f9a(0x24e)](_0x37ef4f,_0x433f9a(0x1c4));return;}const _0x3c21d7=_0x378174[_0x433f9a(0x1b1)]?.['name']||_0x433f9a(0x264);await database_1[_0x433f9a(0x20c)]['telegramUser']['update']({'where':{'telegramId':_0x2252c1},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x433f9a(0x246)+_0x2252c1+_0x433f9a(0x1e4)+_0x378174[_0x433f9a(0x1a1)]),await this['bot']?.[_0x433f9a(0x24e)](_0x37ef4f,_0x433f9a(0x1e3)+_0x3c21d7+_0x433f9a(0x263)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x433f9a(0x269)});}catch(_0x347b94){console[_0x433f9a(0x1df)](_0x433f9a(0x231),_0x347b94),await this[_0x433f9a(0x1a7)]?.[_0x433f9a(0x24e)](_0x37ef4f,_0x433f9a(0x207));}}),this[_0x311581(0x1a7)][_0x311581(0x251)](/\/status/,async _0x36efee=>{const _0x17a7bf=_0x311581,_0x94dc6f=_0x36efee[_0x17a7bf(0x22b)]['id'],_0x502dd3=_0x36efee[_0x17a7bf(0x206)]?.['id']['toString']();if(!_0x502dd3)return;try{const _0x1ccb2f=await database_1[_0x17a7bf(0x20c)][_0x17a7bf(0x1c1)][_0x17a7bf(0x254)]({'where':{'telegramId':_0x502dd3},'include':{'shop':!![]}});if(!_0x1ccb2f){await this[_0x17a7bf(0x1a7)]?.[_0x17a7bf(0x24e)](_0x94dc6f,_0x17a7bf(0x192)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x1ccb2f[_0x17a7bf(0x250)]||!_0x1ccb2f[_0x17a7bf(0x1a1)]||!_0x1ccb2f[_0x17a7bf(0x1b1)]){await this[_0x17a7bf(0x1a7)]?.['sendMessage'](_0x94dc6f,_0x17a7bf(0x23f)+'Use\x20/start\x20to\x20connect.');return;}await this['bot']?.[_0x17a7bf(0x24e)](_0x94dc6f,_0x17a7bf(0x259)+(_0x17a7bf(0x20b)+_0x1ccb2f[_0x17a7bf(0x1b1)][_0x17a7bf(0x1fb)]+'*\x0a')+(_0x17a7bf(0x1f1)+_0x1ccb2f['shop'][_0x17a7bf(0x1a2)]+'`\x0a')+(_0x17a7bf(0x195)+_0x1ccb2f[_0x17a7bf(0x1d4)][_0x17a7bf(0x1ca)](_0x17a7bf(0x21e))+'\x0a\x0a')+_0x17a7bf(0x235)+_0x17a7bf(0x1b9)+_0x17a7bf(0x224),{'parse_mode':_0x17a7bf(0x269)});}catch(_0x4b09a7){console[_0x17a7bf(0x1df)](_0x17a7bf(0x243),_0x4b09a7),await this[_0x17a7bf(0x1a7)]?.[_0x17a7bf(0x24e)](_0x94dc6f,_0x17a7bf(0x207));}}),this[_0x311581(0x1a7)][_0x311581(0x251)](/\/debug/,async _0x417bb7=>{const _0x1c10f6=_0x311581,_0x37911e=_0x417bb7[_0x1c10f6(0x22b)]['id'],_0x1655ae=_0x417bb7['from']?.['id']['toString']();if(!_0x1655ae)return;try{const _0x74353f=await database_1[_0x1c10f6(0x20c)][_0x1c10f6(0x1b1)][_0x1c10f6(0x1f9)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x1e1847='🔍\x20*Debug\x20Information*\x0a\x0a';_0x1e1847+=_0x1c10f6(0x24b)+_0x1655ae+_0x1c10f6(0x22f),_0x1e1847+=_0x1c10f6(0x256),_0x74353f[_0x1c10f6(0x1c8)]((_0x431818,_0x5f4f23)=>{const _0x46250d=_0x1c10f6;_0x1e1847+=_0x5f4f23+0x1+'.\x20*'+_0x431818[_0x46250d(0x1fb)]+'*\x0a',_0x1e1847+=_0x46250d(0x237)+_0x431818[_0x46250d(0x1a2)]+'`\x0a',_0x1e1847+=_0x46250d(0x23a)+_0x431818[_0x46250d(0x1e6)]+'\x0a',_0x1e1847+=_0x46250d(0x1ac)+_0x431818[_0x46250d(0x1c5)][_0x46250d(0x239)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x1c10f6(0x1a7)]?.[_0x1c10f6(0x24e)](_0x37911e,_0x1e1847,{'parse_mode':_0x1c10f6(0x269)});}catch(_0x3543e1){console[_0x1c10f6(0x1df)](_0x1c10f6(0x23b),_0x3543e1),await this[_0x1c10f6(0x1a7)]?.[_0x1c10f6(0x24e)](_0x37911e,_0x1c10f6(0x209));}}),this['bot']['on'](_0x311581(0x1d0),async _0x233f80=>{const _0x1d0b40=_0x311581;if(_0x233f80['text']?.['startsWith']('/'))return;const _0x36b0f6=_0x233f80[_0x1d0b40(0x22b)]['id'],_0x3693da=_0x233f80[_0x1d0b40(0x206)]?.['id'][_0x1d0b40(0x241)](),_0x2d78e2=_0x233f80['text']?.[_0x1d0b40(0x203)]();if(!_0x3693da||!_0x2d78e2)return;try{const _0x12502f=await database_1[_0x1d0b40(0x20c)][_0x1d0b40(0x1c1)][_0x1d0b40(0x254)]({'where':{'telegramId':_0x3693da},'include':{'shop':!![]}});if(!_0x12502f){await this[_0x1d0b40(0x1a7)]?.[_0x1d0b40(0x24e)](_0x36b0f6,_0x1d0b40(0x216));return;}if(_0x12502f[_0x1d0b40(0x250)]&&_0x12502f[_0x1d0b40(0x1a1)]&&_0x12502f[_0x1d0b40(0x1b1)]){await this[_0x1d0b40(0x1a7)]?.[_0x1d0b40(0x24e)](_0x36b0f6,_0x1d0b40(0x1e1)+_0x12502f[_0x1d0b40(0x1b1)][_0x1d0b40(0x1fb)]+_0x1d0b40(0x263)+_0x1d0b40(0x1c6),{'parse_mode':'Markdown'});return;}const _0x1b6974=_0x2d78e2[_0x1d0b40(0x1b2)](/\s+/);if(_0x1b6974[_0x1d0b40(0x1e2)]!==0x2){await this[_0x1d0b40(0x1a7)]?.['sendMessage'](_0x36b0f6,_0x1d0b40(0x261)+_0x1d0b40(0x200)+_0x1d0b40(0x1f8)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x1d0b40(0x1a3)+_0x1b6974[_0x1d0b40(0x1e2)]+_0x1d0b40(0x252)+_0x1b6974['map'](_0x5775f0=>'`'+_0x5775f0+'`')[_0x1d0b40(0x215)](',\x20')),{'parse_mode':_0x1d0b40(0x269)});return;}const [_0x1de805,_0x483634]=_0x1b6974;console[_0x1d0b40(0x1ec)](_0x1d0b40(0x1e7)+_0x3693da+_0x1d0b40(0x25d)+_0x1de805+_0x1d0b40(0x25f)+_0x483634['substring'](0x0,0xa)+_0x1d0b40(0x198)),await this['handleSingleLineVerification'](_0x36b0f6,_0x3693da,_0x1de805,_0x483634);}catch(_0x26bd46){console[_0x1d0b40(0x1df)]('Error\x20handling\x20message:',_0x26bd46),await this[_0x1d0b40(0x1a7)]?.[_0x1d0b40(0x24e)](_0x36b0f6,_0x1d0b40(0x207));}}),this[_0x311581(0x1a7)]['on'](_0x311581(0x1df),_0x2d4143=>{const _0x4911ef=_0x311581;console['error'](_0x4911ef(0x202),_0x2d4143);}),this['bot']['on'](_0x311581(0x1d1),_0x1812c1=>{const _0x1e489d=_0x311581;console[_0x1e489d(0x1df)]('Telegram\x20bot\x20polling\x20error:',_0x1812c1);});}async[a55_0x405ecc(0x1d6)](_0x191412,_0x7bab91,_0x23e2de,_0xc23640){const _0x57735f=a55_0x405ecc;try{console[_0x57735f(0x1ec)](_0x57735f(0x1e7)+_0x7bab91+':\x20username=\x22'+_0x23e2de+'\x22,\x20apiKey=\x22'+_0xc23640[_0x57735f(0x239)](0x0,0xa)+'...\x22');if(!_0x23e2de||_0x23e2de['length']<0x3||_0x23e2de[_0x57735f(0x1e2)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x23e2de)){await this[_0x57735f(0x1a7)]?.['sendMessage'](_0x191412,_0x57735f(0x1cd)+_0x23e2de+_0x57735f(0x22f)+_0x57735f(0x1c9),{'parse_mode':_0x57735f(0x269)});return;}if(!_0xc23640||!_0xc23640[_0x57735f(0x1b7)]('pk_')&&!_0xc23640[_0x57735f(0x1b7)](_0x57735f(0x1ee))){await this['bot']?.[_0x57735f(0x24e)](_0x191412,_0x57735f(0x1cb)+_0x57735f(0x20f),{'parse_mode':_0x57735f(0x269)});return;}const _0x2dba63=await database_1[_0x57735f(0x20c)][_0x57735f(0x1b1)][_0x57735f(0x254)]({'where':{'username':_0x23e2de},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x2dba63){const _0x497959=await database_1['default'][_0x57735f(0x1b1)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x3351d7=_0x57735f(0x219)+_0x23e2de+_0x57735f(0x1ff);_0x497959[_0x57735f(0x1e2)]>0x0?(_0x3351d7+=_0x57735f(0x212),_0x497959[_0x57735f(0x1c8)](_0x160b9f=>{const _0x34fa4e=_0x57735f;_0x3351d7+=_0x34fa4e(0x234)+_0x160b9f[_0x34fa4e(0x1a2)]+'`\x20('+_0x160b9f[_0x34fa4e(0x1fb)]+')\x0a';}),_0x3351d7+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x3351d7+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x57735f(0x1a7)]?.['sendMessage'](_0x191412,_0x3351d7,{'parse_mode':_0x57735f(0x269)});return;}if(_0x2dba63[_0x57735f(0x1e6)]!==_0x57735f(0x223)){await this['bot']?.[_0x57735f(0x24e)](_0x191412,'❌\x20Shop\x20`'+_0x23e2de+_0x57735f(0x1af)+_0x57735f(0x193),{'parse_mode':'Markdown'});return;}if(_0x2dba63[_0x57735f(0x1c5)]!==_0xc23640&&_0x2dba63[_0x57735f(0x229)]!==_0xc23640){await this[_0x57735f(0x1a7)]?.[_0x57735f(0x24e)](_0x191412,_0x57735f(0x22e)+_0x23e2de+_0x57735f(0x217)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':'Markdown'});return;}const _0x4d7e0b=await database_1[_0x57735f(0x20c)][_0x57735f(0x1c1)][_0x57735f(0x1c7)]({'where':{'shopId':_0x2dba63['id'],'isVerified':!![],'telegramId':{'not':_0x7bab91}}});if(_0x4d7e0b){await this['bot']?.[_0x57735f(0x24e)](_0x191412,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x23e2de+'`.\x0a\x0a'+_0x57735f(0x1ea),{'parse_mode':_0x57735f(0x269)});return;}await database_1[_0x57735f(0x20c)]['telegramUser'][_0x57735f(0x262)]({'where':{'telegramId':_0x7bab91},'data':{'shopId':_0x2dba63['id'],'isVerified':!![]}}),await this[_0x57735f(0x1a7)]?.[_0x57735f(0x24e)](_0x191412,_0x57735f(0x227)+_0x57735f(0x1f6)+('📱\x20Shop:\x20*'+_0x2dba63[_0x57735f(0x1fb)]+'*\x0a')+('👤\x20Username:\x20`'+_0x2dba63[_0x57735f(0x1a2)]+'`\x0a\x0a')+_0x57735f(0x1f5)+_0x57735f(0x1d8)+'•\x20Payment\x20status\x20changes\x0a'+'•\x20Payouts\x0a'+_0x57735f(0x213)+'Commands:\x0a'+_0x57735f(0x211)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x57735f(0x269)}),console[_0x57735f(0x1ec)]('✅\x20Telegram\x20user\x20'+_0x7bab91+_0x57735f(0x236)+_0x2dba63[_0x57735f(0x1a2)]+_0x57735f(0x1eb));}catch(_0x1c7f58){console['error']('Error\x20in\x20handleSingleLineVerification:',_0x1c7f58),await this[_0x57735f(0x1a7)]?.[_0x57735f(0x24e)](_0x191412,_0x57735f(0x1bc));}}async[a55_0x405ecc(0x19c)](_0x4f9ce7,_0x9beb9a,_0x475b9b){const _0x2a0cb5=a55_0x405ecc;if(!this[_0x2a0cb5(0x1a7)]){console['warn'](_0x2a0cb5(0x1c0));return;}try{const _0x437290=await database_1['default'][_0x2a0cb5(0x1c1)]['findMany']({'where':{'shopId':_0x4f9ce7,'isVerified':!![]}});if(_0x437290[_0x2a0cb5(0x1e2)]===0x0){console[_0x2a0cb5(0x1ec)](_0x2a0cb5(0x1a6)+_0x4f9ce7);return;}const _0x17d5b2=_0x437290[_0x2a0cb5(0x257)](async _0x3b8c48=>{const _0x1b04e3=_0x2a0cb5;try{await this['bot']?.[_0x1b04e3(0x24e)](_0x3b8c48[_0x1b04e3(0x1b3)],_0x9beb9a,_0x475b9b),console[_0x1b04e3(0x1ec)](_0x1b04e3(0x1e8)+_0x3b8c48['telegramId']);}catch(_0x185a09){console[_0x1b04e3(0x1df)](_0x1b04e3(0x1bb)+_0x3b8c48[_0x1b04e3(0x1b3)]+':',_0x185a09),_0x185a09 instanceof Error&&(_0x185a09[_0x1b04e3(0x1d0)][_0x1b04e3(0x1f4)](_0x1b04e3(0x1f3))||_0x185a09[_0x1b04e3(0x1d0)][_0x1b04e3(0x1f4)](_0x1b04e3(0x21f))||_0x185a09[_0x1b04e3(0x1d0)]['includes'](_0x1b04e3(0x218)))&&(await database_1[_0x1b04e3(0x20c)][_0x1b04e3(0x1c1)]['update']({'where':{'id':_0x3b8c48['id']},'data':{'isVerified':![]}}),console['log']('User\x20'+_0x3b8c48[_0x1b04e3(0x1b3)]+_0x1b04e3(0x208)));}});await Promise['allSettled'](_0x17d5b2);}catch(_0x360e4d){console[_0x2a0cb5(0x1df)](_0x2a0cb5(0x19a),_0x360e4d);}}async[a55_0x405ecc(0x26c)](_0x227069,_0x449baa,_0x4c6602){const _0x9b26e4=a55_0x405ecc,_0x1fc925={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x2267ad={'created':_0x9b26e4(0x1cc),'paid':'Payment\x20successfully\x20paid','failed':_0x9b26e4(0x1d3),'expired':_0x9b26e4(0x242),'refund':_0x9b26e4(0x1ef),'chargeback':_0x9b26e4(0x1a0),'processing':_0x9b26e4(0x24d)},_0x3594fb=_0x1fc925[_0x4c6602],_0x5d615e=_0x2267ad[_0x4c6602],_0x3f1b85=(0x0,gateway_1[_0x9b26e4(0x210)])(_0x449baa['gateway']);console[_0x9b26e4(0x1ec)](_0x9b26e4(0x220)+_0x449baa[_0x9b26e4(0x26d)]+_0x9b26e4(0x240)+_0x3f1b85+'\x22');let _0x1d91d9=_0x3594fb+'\x20*'+_0x5d615e+_0x9b26e4(0x23e)+(_0x9b26e4(0x1f0)+_0x449baa['amount']+'\x20'+_0x449baa[_0x9b26e4(0x1db)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x449baa['orderId']||_0x449baa['id'])+'`\x0a')+(_0x9b26e4(0x1fe)+_0x449baa['id']+'`\x0a')+(_0x9b26e4(0x238)+_0x3f1b85+'`\x0a')+(_0x9b26e4(0x214)+new Date(_0x449baa[_0x9b26e4(0x1c2)])[_0x9b26e4(0x201)]('en-US')+'\x0a');if(_0x449baa[_0x9b26e4(0x267)]||_0x449baa[_0x9b26e4(0x196)]||_0x449baa[_0x9b26e4(0x20e)]||_0x449baa[_0x9b26e4(0x1bd)]||_0x449baa[_0x9b26e4(0x21c)]){_0x1d91d9+=_0x9b26e4(0x24f);_0x449baa[_0x9b26e4(0x267)]&&(_0x1d91d9+='📛\x20Name:\x20`'+_0x449baa['customerName']+'`\x0a');_0x449baa[_0x9b26e4(0x196)]&&(_0x1d91d9+=_0x9b26e4(0x244)+_0x449baa['customerEmail']+'`\x0a');_0x449baa['remitterIban']&&(_0x1d91d9+=_0x9b26e4(0x25e)+_0x449baa[_0x9b26e4(0x20e)]+'`\x0a');_0x449baa[_0x9b26e4(0x1bd)]&&(_0x1d91d9+=_0x9b26e4(0x24a)+_0x449baa[_0x9b26e4(0x1bd)]+'`\x0a');if(_0x449baa[_0x9b26e4(0x21c)]){const _0x23a9c0=_0x449baa[_0x9b26e4(0x21c)][_0x9b26e4(0x1e2)]>0x32?_0x449baa[_0x9b26e4(0x21c)][_0x9b26e4(0x239)](0x0,0x32)+_0x9b26e4(0x21b):_0x449baa[_0x9b26e4(0x21c)];_0x1d91d9+=_0x9b26e4(0x19d)+_0x23a9c0+'`\x0a';}}_0x4c6602===_0x9b26e4(0x1a5)&&_0x449baa[_0x9b26e4(0x22a)]&&(_0x1d91d9+=_0x9b26e4(0x1a9)+_0x449baa[_0x9b26e4(0x22a)]+_0x9b26e4(0x24c)),_0x4c6602===_0x9b26e4(0x190)&&(_0x1d91d9+=_0x9b26e4(0x194)),_0x449baa[_0x9b26e4(0x1ab)]&&(_0x1d91d9+=_0x9b26e4(0x268)+_0x449baa[_0x9b26e4(0x1ab)]+'\x0a'),await this[_0x9b26e4(0x19c)](_0x227069,_0x1d91d9,{'parse_mode':'Markdown'});}async[a55_0x405ecc(0x247)](_0x282c6a,_0x509b56,_0x56511c){const _0x11500f=a55_0x405ecc,_0xefe412={'created':'📤','completed':'✅','rejected':'❌'},_0x1e5b87={'created':_0x11500f(0x1f2),'completed':_0x11500f(0x1b4),'rejected':'Payout\x20rejected'},_0x401bd2=_0xefe412[_0x56511c],_0x558135=_0x1e5b87[_0x56511c],_0x57731a=_0x401bd2+'\x20*'+_0x558135+_0x11500f(0x23e)+('💸\x20Amount:\x20*'+_0x509b56['amount']+_0x11500f(0x1c3))+(_0x11500f(0x19f)+_0x509b56[_0x11500f(0x1ce)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x509b56['id']+'`\x0a')+(_0x11500f(0x214)+new Date(_0x509b56[_0x11500f(0x1c2)])[_0x11500f(0x201)](_0x11500f(0x21e))+'\x0a')+(_0x509b56[_0x11500f(0x1ba)]?_0x11500f(0x1b0)+_0x509b56[_0x11500f(0x1ba)]+'`':'');await this[_0x11500f(0x19c)](_0x282c6a,_0x57731a,{'parse_mode':'Markdown'});}async['sendLoginNotification'](_0x4123e3,_0xd1ab6a){const _0x4a77f2=a55_0x405ecc;try{const _0x23c39d=await database_1['default']['shopSettings'][_0x4a77f2(0x254)]({'where':{'shopId':_0x4123e3},'select':{'notificationLogin':!![]}});if(!_0x23c39d?.[_0x4a77f2(0x19b)]){console['log'](_0x4a77f2(0x1aa)+_0x4123e3);return;}const _0x1d11b7=_0xd1ab6a['success']?'🔐':'🚨',_0x52b34e=_0xd1ab6a[_0x4a77f2(0x19e)]?_0x4a77f2(0x1e9):'Failed\x20login\x20attempt';let _0x179df0=_0x1d11b7+'\x20*'+_0x52b34e+_0x4a77f2(0x23e)+(_0x4a77f2(0x1f1)+_0xd1ab6a[_0x4a77f2(0x1a2)]+'`\x0a')+(_0x4a77f2(0x25b)+_0xd1ab6a[_0x4a77f2(0x1ad)]['toLocaleString'](_0x4a77f2(0x21e))+'\x0a');_0xd1ab6a[_0x4a77f2(0x204)]&&(_0x179df0+=_0x4a77f2(0x1dc)+_0xd1ab6a[_0x4a77f2(0x204)]+'`\x0a');if(_0xd1ab6a['userAgent']){const _0x16ea02=_0xd1ab6a[_0x4a77f2(0x1cf)][_0x4a77f2(0x1e2)]>0x32?_0xd1ab6a[_0x4a77f2(0x1cf)][_0x4a77f2(0x239)](0x0,0x32)+_0x4a77f2(0x21b):_0xd1ab6a[_0x4a77f2(0x1cf)];_0x179df0+=_0x4a77f2(0x19d)+_0x16ea02+'`\x0a';}!_0xd1ab6a[_0x4a77f2(0x19e)]&&(_0x179df0+=_0x4a77f2(0x23d)),await this['sendShopNotification'](_0x4123e3,_0x179df0,{'parse_mode':'Markdown'}),console[_0x4a77f2(0x1ec)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x4123e3+':\x20'+(_0xd1ab6a['success']?'success':'failed'));}catch(_0x4e4c1e){console[_0x4a77f2(0x1df)]('Failed\x20to\x20send\x20login\x20notification:',_0x4e4c1e);}}async[a55_0x405ecc(0x197)](_0x2c92fa,_0x36bb57){const _0x32aa2c=a55_0x405ecc;try{const _0x3fac0e=await database_1[_0x32aa2c(0x20c)][_0x32aa2c(0x20d)][_0x32aa2c(0x254)]({'where':{'shopId':_0x2c92fa},'select':{'notificationApiError':!![]}});if(!_0x3fac0e?.[_0x32aa2c(0x265)]){console[_0x32aa2c(0x1ec)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x2c92fa);return;}let _0x515266=_0x32aa2c(0x248)+('🔗\x20Endpoint:\x20`'+_0x36bb57[_0x32aa2c(0x1ce)]+'\x20'+_0x36bb57[_0x32aa2c(0x1ae)]+'`\x0a')+(_0x32aa2c(0x25b)+_0x36bb57['timestamp'][_0x32aa2c(0x201)]('en-US')+'\x0a');_0x36bb57[_0x32aa2c(0x1bf)]&&(_0x515266+='📊\x20Error\x20code:\x20`'+_0x36bb57[_0x32aa2c(0x1bf)]+'`\x0a'),_0x515266+=_0x32aa2c(0x230)+_0x36bb57[_0x32aa2c(0x205)]+'`\x0a',_0x36bb57[_0x32aa2c(0x222)]&&(_0x515266+=_0x32aa2c(0x226)+_0x36bb57[_0x32aa2c(0x222)]+'`\x0a'),_0x515266+=_0x32aa2c(0x1ed),await this[_0x32aa2c(0x19c)](_0x2c92fa,_0x515266,{'parse_mode':_0x32aa2c(0x269)}),console[_0x32aa2c(0x1ec)](_0x32aa2c(0x1be)+_0x2c92fa+':\x20'+_0x36bb57[_0x32aa2c(0x1ae)]);}catch(_0x5bc977){console[_0x32aa2c(0x1df)](_0x32aa2c(0x1de),_0x5bc977);}}async[a55_0x405ecc(0x225)](_0x1b92cc,_0xc3f97b,_0x5b9e16){const _0x155170=a55_0x405ecc;let _0x21b27b=_0x155170(0x1fc)+_0xc3f97b+_0x155170(0x23e);for(const [_0x316f79,_0x30fbf5]of Object['entries'](_0x5b9e16)){_0x30fbf5!==null&&_0x30fbf5!==undefined&&(_0x21b27b+=_0x316f79+_0x155170(0x25c)+_0x30fbf5+'`\x0a');}await this[_0x155170(0x19c)](_0x1b92cc,_0x21b27b,{'parse_mode':_0x155170(0x269)});}[a55_0x405ecc(0x1da)](){const _0x2fb185=a55_0x405ecc;return{'isActive':!!this[_0x2fb185(0x1a7)],'username':this[_0x2fb185(0x21a)]};}[a55_0x405ecc(0x26b)](){const _0x2c328d=a55_0x405ecc;this[_0x2c328d(0x1a7)]&&(this[_0x2c328d(0x1a7)][_0x2c328d(0x26a)](),this[_0x2c328d(0x1a7)]=null,console[_0x2c328d(0x1ec)]('🛑\x20Telegram\x20bot\x20stopped'));}}exports['TelegramBotService']=TelegramBotService,exports[a55_0x405ecc(0x191)]=new TelegramBotService();