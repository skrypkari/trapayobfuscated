'use strict';const a54_0x4042a7=a54_0x5b28;(function(_0x3f79d8,_0x172f63){const _0x44715f=a54_0x5b28,_0x32bdaf=_0x3f79d8();while(!![]){try{const _0x178694=parseInt(_0x44715f(0x28a))/0x1+-parseInt(_0x44715f(0x25c))/0x2*(-parseInt(_0x44715f(0x278))/0x3)+parseInt(_0x44715f(0x299))/0x4*(-parseInt(_0x44715f(0x254))/0x5)+-parseInt(_0x44715f(0x24c))/0x6*(parseInt(_0x44715f(0x277))/0x7)+parseInt(_0x44715f(0x1da))/0x8+parseInt(_0x44715f(0x1eb))/0x9*(parseInt(_0x44715f(0x212))/0xa)+-parseInt(_0x44715f(0x224))/0xb*(parseInt(_0x44715f(0x21e))/0xc);if(_0x178694===_0x172f63)break;else _0x32bdaf['push'](_0x32bdaf['shift']());}catch(_0x458134){_0x32bdaf['push'](_0x32bdaf['shift']());}}}(a54_0x1aca,0x1c284));var __importDefault=this&&this[a54_0x4042a7(0x25a)]||function(_0x28cf53){return _0x28cf53&&_0x28cf53['__esModule']?_0x28cf53:{'default':_0x28cf53};};function a54_0x1aca(){const _0x5665c2=['failed','findMany','userAgent','🔗\x20TXID:\x20`','findUnique','User\x20','📧\x20Email:\x20`','9xNXvFd','updatedAt','sendShopNotification','isVerified','Payment\x20is\x20being\x20processed','📊\x20*Connection\x20Status*\x0a\x0a','from','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','update','customerName','Check\x20spelling\x20and\x20try\x20again.','telegramId','/disconnect\x20-\x20disconnect\x20from\x20notifications','Payment\x20refund','\x20(@','shop','secretKey','toString','📱\x20Telegram\x20notification:\x20gateway\x20\x22','*\x0a\x0a','`\x20not\x20found.\x0a\x0a','username','...','toLocaleString','\x22,\x20apiKey=\x22','setupBotHandlers','findFirst','success','toLocaleDateString','Error\x20handling\x20message:','en-US','sendMessage','❌\x20Error\x20getting\x20debug\x20information.','create','errorMessage','../config/database','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','🔔\x20Notifications\x20are\x20active\x0a\x0a','257160rdayos','endpoint','Payment\x20expired','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','📱\x20Shop:\x20*','🏦\x20Method:\x20`','📊\x20Error\x20code:\x20`','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','stopPolling','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','join','map','708aIvcAq','getBotInfo','❌\x20Please\x20use\x20/start\x20command\x20first','shopId','length','\x20via\x20single-line\x20input','12837aXALPq','../types/gateway','Username:\x20`','•\x20Payouts\x0a\x0a','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','`\x0a\x0a','🏪\x20Available\x20shops\x20in\x20system:\x0a','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Payment\x20failed','adminNotes','trapay_bot','🎉\x20*Congratulations!*\x0a\x0a','chargeback','chat\x20not\x20found','Error\x20in\x20handleSingleLineVerification:','orderId','Commands:\x0a','handleSingleLineVerification','env','Contact\x20administrator.','📅\x20Time:\x20','telegramBotService','\x22\x20->\x20display\x20\x22','\x20\x20\x20Public\x20Key:\x20`','trim','Payout\x20rejected','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','\x20parts:\x20',':\x20`','📱\x20Created\x20new\x20Telegram\x20user:\x20','\x20initialized\x20successfully','default','test','\x20disconnected\x20from\x20shop\x20','includes','❌\x20Error:\x20`','text','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','requestId','✅\x20Telegram\x20user\x20','54aBBLUq','TelegramBotService','substring','Error\x20sending\x20shop\x20notification:','🏪\x20Gateway:\x20`','`.\x0a\x0a','notificationLogin','pk_','15LRJYxI','Successful\x20login','allSettled','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','•\x20`','ipAddress','__importDefault','telegramUser','4294CCcPxS','Error\x20handling\x20/debug\x20command:','error','amount','...\x22','notificationApiError','*.\x0a\x0a','\x20verified\x20for\x20shop\x20','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','🛑\x20Telegram\x20bot\x20stopped','gateway','Error\x20handling\x20/start\x20command:','stopBot','\x20USD*\x0a','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','👤\x20Username:\x20`','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','forEach','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`',':\x20username=\x22','Use\x20/start\x20to\x20begin.','Telegram\x20bot\x20polling\x20error:','bot','chargebackAmount','Markdown','✅\x20Connected\x20to\x20shop:\x20*','43316EklchE','87efLMXY','status','sendCustomNotification','🌐\x20IP\x20address:\x20`','•\x20Payment\x20status\x20changes\x0a','You\x20sent\x20','createdAt','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','message','💸\x20Penalty\x20amount:\x20*','\x0a👤\x20*Customer\x20Information:*\x0a','Payment\x20chargeback','sendPayoutNotification','...`\x0a\x0a','shopSettings','TELEGRAM_BOT_USERNAME','publicKey','onText','167084hUzlAg','method','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','\x20USDT*\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','📅\x20Date:\x20','warn','timestamp','__esModule','🔌\x20User\x20','customerUa','user\x20is\x20deactivated','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','chat','entries','102352RmMaEX','To\x20reconnect,\x20use\x20the\x20/start\x20command','🚨\x20*API\x20Error*\x0a\x0a','💻\x20Browser:\x20`','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','sendApiErrorNotification','📝\x20Notes:\x20','•\x20Important\x20events\x0a\x0a','log','❌\x20Invalid\x20username\x20format:\x20`','customerIp','currency','sendPaymentNotification','name','startsWith','polling_error','botToken','\x20\x20\x20Status:\x20','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','•\x20New\x20payments\x0a','\x20\x20\x20Username:\x20`','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','remitterIban','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','Use\x20/start\x20to\x20connect.','txid','Example:\x0a','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','`\x20(','.\x20*','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','492624hfYwXm','Available\x20usernames:\x0a','sendLoginNotification','last_name','customerEmail','🔗\x20Endpoint:\x20`','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','botUsername','TELEGRAM_BOT_TOKEN','getGatewayDisplayNameForTelegram'];a54_0x1aca=function(){return _0x5665c2;};return a54_0x1aca();}Object['defineProperty'](exports,a54_0x4042a7(0x292),{'value':!![]}),exports[a54_0x4042a7(0x239)]=exports[a54_0x4042a7(0x24d)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a54_0x4042a7(0x20e))),gateway_1=require(a54_0x4042a7(0x225));class TelegramBotService{constructor(){const _0x4f7595=a54_0x4042a7;this[_0x4f7595(0x273)]=null,this['botToken']=process['env'][_0x4f7595(0x1e2)]||'',this[_0x4f7595(0x1e1)]=process[_0x4f7595(0x236)][_0x4f7595(0x287)]||_0x4f7595(0x22e),this[_0x4f7595(0x1ca)]?this['initializeBot']():console[_0x4f7595(0x290)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}['initializeBot'](){const _0x561513=a54_0x4042a7;try{this[_0x561513(0x273)]=new node_telegram_bot_api_1[(_0x561513(0x243))](this['botToken'],{'polling':!![]}),this[_0x561513(0x204)](),console[_0x561513(0x1c2)]('✅\x20Telegram\x20bot\x20@'+this['botUsername']+_0x561513(0x242));}catch(_0x1cb41e){console['error'](_0x561513(0x228),_0x1cb41e);}}[a54_0x4042a7(0x204)](){const _0x589b55=a54_0x4042a7;if(!this[_0x589b55(0x273)])return;this['bot'][_0x589b55(0x289)](/\/start/,async _0x5c65e4=>{const _0x6ba480=_0x589b55,_0x242d99=_0x5c65e4[_0x6ba480(0x297)]['id'],_0x5a79c1=_0x5c65e4['from']?.['id'][_0x6ba480(0x1fc)](),_0x34b5a6=_0x5c65e4[_0x6ba480(0x1f1)]?.[_0x6ba480(0x200)],_0x3f532f=_0x5c65e4[_0x6ba480(0x1f1)]?.['first_name'],_0x6cd58=_0x5c65e4[_0x6ba480(0x1f1)]?.[_0x6ba480(0x1dd)];if(!_0x5a79c1)return;try{let _0xdb9150=await database_1[_0x6ba480(0x243)][_0x6ba480(0x25b)][_0x6ba480(0x1e8)]({'where':{'telegramId':_0x5a79c1},'include':{'shop':!![]}});!_0xdb9150?(_0xdb9150=await database_1[_0x6ba480(0x243)][_0x6ba480(0x25b)][_0x6ba480(0x20c)]({'data':{'telegramId':_0x5a79c1,'username':_0x34b5a6,'firstName':_0x3f532f,'lastName':_0x6cd58,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x6ba480(0x1c2)](_0x6ba480(0x241)+_0x5a79c1+_0x6ba480(0x1f9)+_0x34b5a6+')')):_0xdb9150=await database_1[_0x6ba480(0x243)][_0x6ba480(0x25b)][_0x6ba480(0x1f3)]({'where':{'telegramId':_0x5a79c1},'data':{'username':_0x34b5a6,'firstName':_0x3f532f,'lastName':_0x6cd58},'include':{'shop':!![]}}),_0xdb9150['isVerified']&&_0xdb9150['shopId']&&_0xdb9150[_0x6ba480(0x1fa)]?await this[_0x6ba480(0x273)]?.[_0x6ba480(0x20a)](_0x242d99,'✅\x20Welcome\x20back!\x0a\x0a'+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0xdb9150['shop'][_0x6ba480(0x1c7)]+'*\x0a')+(_0x6ba480(0x226)+_0xdb9150[_0x6ba480(0x1fa)][_0x6ba480(0x200)]+'`\x0a\x0a')+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x6ba480(0x1cd)+_0x6ba480(0x27c)+_0x6ba480(0x227)+_0x6ba480(0x234)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x6ba480(0x1f7),{'parse_mode':_0x6ba480(0x275)}):(_0xdb9150[_0x6ba480(0x221)]&&!_0xdb9150[_0x6ba480(0x1ee)]&&(await database_1[_0x6ba480(0x243)][_0x6ba480(0x25b)][_0x6ba480(0x1f3)]({'where':{'telegramId':_0x5a79c1},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x6ba480(0x219)+_0x5a79c1)),await this[_0x6ba480(0x273)]?.[_0x6ba480(0x20a)](_0x242d99,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x6ba480(0x1cf)+_0x6ba480(0x1d1)+_0x6ba480(0x1d5)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x6ba480(0x23e),{'parse_mode':'Markdown'}));}catch(_0x125467){console[_0x6ba480(0x25e)](_0x6ba480(0x268),_0x125467),await this[_0x6ba480(0x273)]?.[_0x6ba480(0x20a)](_0x242d99,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['onText'](/\/disconnect/,async _0x1e8dd7=>{const _0x2b18fb=_0x589b55,_0x4cde9b=_0x1e8dd7[_0x2b18fb(0x297)]['id'],_0x32c91e=_0x1e8dd7[_0x2b18fb(0x1f1)]?.['id'][_0x2b18fb(0x1fc)]();if(!_0x32c91e)return;try{const _0x505c7c=await database_1[_0x2b18fb(0x243)]['telegramUser'][_0x2b18fb(0x1e8)]({'where':{'telegramId':_0x32c91e},'include':{'shop':!![]}});if(!_0x505c7c||!_0x505c7c[_0x2b18fb(0x1ee)]||!_0x505c7c[_0x2b18fb(0x221)]){await this[_0x2b18fb(0x273)]?.[_0x2b18fb(0x20a)](_0x4cde9b,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x22bf34=_0x505c7c['shop']?.['name']||'unknown\x20shop';await database_1['default'][_0x2b18fb(0x25b)][_0x2b18fb(0x1f3)]({'where':{'telegramId':_0x32c91e},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x2b18fb(0x293)+_0x32c91e+_0x2b18fb(0x245)+_0x505c7c[_0x2b18fb(0x221)]),await this['bot']?.[_0x2b18fb(0x20a)](_0x4cde9b,_0x2b18fb(0x1d9)+_0x22bf34+'*.\x0a\x0a'+_0x2b18fb(0x29a),{'parse_mode':_0x2b18fb(0x275)});}catch(_0x3816e2){console[_0x2b18fb(0x25e)]('Error\x20handling\x20/disconnect\x20command:',_0x3816e2),await this[_0x2b18fb(0x273)]?.[_0x2b18fb(0x20a)](_0x4cde9b,_0x2b18fb(0x215));}}),this['bot'][_0x589b55(0x289)](/\/status/,async _0x43749d=>{const _0x555a65=_0x589b55,_0x386827=_0x43749d[_0x555a65(0x297)]['id'],_0x479262=_0x43749d[_0x555a65(0x1f1)]?.['id'][_0x555a65(0x1fc)]();if(!_0x479262)return;try{const _0x12d54a=await database_1[_0x555a65(0x243)]['telegramUser']['findUnique']({'where':{'telegramId':_0x479262},'include':{'shop':!![]}});if(!_0x12d54a){await this[_0x555a65(0x273)]?.['sendMessage'](_0x386827,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x555a65(0x271));return;}if(!_0x12d54a['isVerified']||!_0x12d54a[_0x555a65(0x221)]||!_0x12d54a[_0x555a65(0x1fa)]){await this[_0x555a65(0x273)]?.[_0x555a65(0x20a)](_0x386827,_0x555a65(0x1d2)+_0x555a65(0x1d3));return;}await this[_0x555a65(0x273)]?.[_0x555a65(0x20a)](_0x386827,_0x555a65(0x1f0)+(_0x555a65(0x276)+_0x12d54a[_0x555a65(0x1fa)][_0x555a65(0x1c7)]+'*\x0a')+(_0x555a65(0x26c)+_0x12d54a['shop'][_0x555a65(0x200)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x12d54a[_0x555a65(0x1ec)][_0x555a65(0x207)]('en-US')+'\x0a\x0a')+_0x555a65(0x211)+_0x555a65(0x234)+_0x555a65(0x1f7),{'parse_mode':_0x555a65(0x275)});}catch(_0x13cb1e){console[_0x555a65(0x25e)]('Error\x20handling\x20/status\x20command:',_0x13cb1e),await this[_0x555a65(0x273)]?.[_0x555a65(0x20a)](_0x386827,_0x555a65(0x215));}}),this['bot']['onText'](/\/debug/,async _0x52b0b8=>{const _0xf85cd5=_0x589b55,_0x29d08a=_0x52b0b8[_0xf85cd5(0x297)]['id'],_0x3f90d4=_0x52b0b8[_0xf85cd5(0x1f1)]?.['id'][_0xf85cd5(0x1fc)]();if(!_0x3f90d4)return;try{const _0x2288b6=await database_1[_0xf85cd5(0x243)][_0xf85cd5(0x1fa)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x463b08='🔍\x20*Debug\x20Information*\x0a\x0a';_0x463b08+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x3f90d4+_0xf85cd5(0x229),_0x463b08+=_0xf85cd5(0x22a),_0x2288b6[_0xf85cd5(0x26e)]((_0x2e9e00,_0x43ad46)=>{const _0x4c7ace=_0xf85cd5;_0x463b08+=_0x43ad46+0x1+_0x4c7ace(0x1d8)+_0x2e9e00[_0x4c7ace(0x1c7)]+'*\x0a',_0x463b08+=_0x4c7ace(0x1ce)+_0x2e9e00[_0x4c7ace(0x200)]+'`\x0a',_0x463b08+=_0x4c7ace(0x1cb)+_0x2e9e00[_0x4c7ace(0x279)]+'\x0a',_0x463b08+=_0x4c7ace(0x23b)+_0x2e9e00[_0x4c7ace(0x288)][_0x4c7ace(0x24e)](0x0,0xf)+_0x4c7ace(0x285);}),await this[_0xf85cd5(0x273)]?.['sendMessage'](_0x29d08a,_0x463b08,{'parse_mode':_0xf85cd5(0x275)});}catch(_0xc3bb19){console[_0xf85cd5(0x25e)](_0xf85cd5(0x25d),_0xc3bb19),await this[_0xf85cd5(0x273)]?.[_0xf85cd5(0x20a)](_0x29d08a,_0xf85cd5(0x20b));}}),this[_0x589b55(0x273)]['on'](_0x589b55(0x280),async _0xfcde25=>{const _0x478a50=_0x589b55;if(_0xfcde25[_0x478a50(0x248)]?.[_0x478a50(0x1c8)]('/'))return;const _0x1c5041=_0xfcde25[_0x478a50(0x297)]['id'],_0x5c6a80=_0xfcde25['from']?.['id'][_0x478a50(0x1fc)](),_0x4c7c22=_0xfcde25['text']?.[_0x478a50(0x23c)]();if(!_0x5c6a80||!_0x4c7c22)return;try{const _0x267799=await database_1[_0x478a50(0x243)][_0x478a50(0x25b)][_0x478a50(0x1e8)]({'where':{'telegramId':_0x5c6a80},'include':{'shop':!![]}});if(!_0x267799){await this[_0x478a50(0x273)]?.[_0x478a50(0x20a)](_0x1c5041,_0x478a50(0x220));return;}if(_0x267799['isVerified']&&_0x267799[_0x478a50(0x221)]&&_0x267799[_0x478a50(0x1fa)]){await this['bot']?.['sendMessage'](_0x1c5041,_0x478a50(0x22b)+_0x267799[_0x478a50(0x1fa)][_0x478a50(0x1c7)]+_0x478a50(0x262)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x478a50(0x275)});return;}const _0x2d1076=_0x4c7c22['split'](/\s+/);if(_0x2d1076[_0x478a50(0x222)]!==0x2){await this[_0x478a50(0x273)]?.[_0x478a50(0x20a)](_0x1c5041,_0x478a50(0x296)+_0x478a50(0x1d1)+'Example:\x0a'+_0x478a50(0x1e0)+(_0x478a50(0x27d)+_0x2d1076[_0x478a50(0x222)]+_0x478a50(0x23f)+_0x2d1076[_0x478a50(0x21d)](_0x21091b=>'`'+_0x21091b+'`')[_0x478a50(0x21c)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x295254,_0x187e8c]=_0x2d1076;console[_0x478a50(0x1c2)](_0x478a50(0x1cc)+_0x5c6a80+_0x478a50(0x270)+_0x295254+'\x22,\x20apiKey=\x22'+_0x187e8c['substring'](0x0,0xa)+_0x478a50(0x260)),await this[_0x478a50(0x235)](_0x1c5041,_0x5c6a80,_0x295254,_0x187e8c);}catch(_0x378584){console[_0x478a50(0x25e)](_0x478a50(0x208),_0x378584),await this[_0x478a50(0x273)]?.[_0x478a50(0x20a)](_0x1c5041,_0x478a50(0x215));}}),this[_0x589b55(0x273)]['on'](_0x589b55(0x25e),_0x48b53e=>{const _0x4ee303=_0x589b55;console[_0x4ee303(0x25e)]('Telegram\x20bot\x20error:',_0x48b53e);}),this['bot']['on'](_0x589b55(0x1c9),_0x278788=>{const _0x54d775=_0x589b55;console[_0x54d775(0x25e)](_0x54d775(0x272),_0x278788);});}async[a54_0x4042a7(0x235)](_0x12e2aa,_0x1b2682,_0x2a4b93,_0x3a0ebd){const _0x514549=a54_0x4042a7;try{console['log'](_0x514549(0x1cc)+_0x1b2682+_0x514549(0x270)+_0x2a4b93+_0x514549(0x203)+_0x3a0ebd[_0x514549(0x24e)](0x0,0xa)+_0x514549(0x260));if(!_0x2a4b93||_0x2a4b93['length']<0x3||_0x2a4b93[_0x514549(0x222)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x514549(0x244)](_0x2a4b93)){await this[_0x514549(0x273)]?.['sendMessage'](_0x12e2aa,_0x514549(0x1c3)+_0x2a4b93+_0x514549(0x229)+_0x514549(0x28e),{'parse_mode':_0x514549(0x275)});return;}if(!_0x3a0ebd||!_0x3a0ebd[_0x514549(0x1c8)](_0x514549(0x253))&&!_0x3a0ebd['startsWith']('sk_')){await this[_0x514549(0x273)]?.['sendMessage'](_0x12e2aa,_0x514549(0x249)+_0x514549(0x265),{'parse_mode':_0x514549(0x275)});return;}const _0x20aafa=await database_1['default'][_0x514549(0x1fa)][_0x514549(0x1e8)]({'where':{'username':_0x2a4b93},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x20aafa){const _0x46f1cc=await database_1[_0x514549(0x243)]['shop'][_0x514549(0x1e5)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x189f57='❌\x20Shop\x20with\x20username\x20`'+_0x2a4b93+_0x514549(0x1ff);_0x46f1cc[_0x514549(0x222)]>0x0?(_0x189f57+=_0x514549(0x1db),_0x46f1cc[_0x514549(0x26e)](_0x185679=>{const _0x13b248=_0x514549;_0x189f57+=_0x13b248(0x258)+_0x185679[_0x13b248(0x200)]+_0x13b248(0x1d7)+_0x185679[_0x13b248(0x1c7)]+')\x0a';}),_0x189f57+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x189f57+=_0x514549(0x1f5);await this[_0x514549(0x273)]?.[_0x514549(0x20a)](_0x12e2aa,_0x189f57,{'parse_mode':_0x514549(0x275)});return;}if(_0x20aafa[_0x514549(0x279)]!=='ACTIVE'){await this[_0x514549(0x273)]?.[_0x514549(0x20a)](_0x12e2aa,'❌\x20Shop\x20`'+_0x2a4b93+'`\x20is\x20inactive.\x0a\x0a'+_0x514549(0x237),{'parse_mode':_0x514549(0x275)});return;}if(_0x20aafa[_0x514549(0x288)]!==_0x3a0ebd&&_0x20aafa[_0x514549(0x1fb)]!==_0x3a0ebd){await this[_0x514549(0x273)]?.[_0x514549(0x20a)](_0x12e2aa,_0x514549(0x26f)+_0x2a4b93+_0x514549(0x251)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x514549(0x1be),{'parse_mode':_0x514549(0x275)});return;}const _0x6d6346=await database_1[_0x514549(0x243)]['telegramUser'][_0x514549(0x205)]({'where':{'shopId':_0x20aafa['id'],'isVerified':!![],'telegramId':{'not':_0x1b2682}}});if(_0x6d6346){await this['bot']?.['sendMessage'](_0x12e2aa,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x2a4b93+'`.\x0a\x0a'+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x514549(0x275)});return;}await database_1['default'][_0x514549(0x25b)][_0x514549(0x1f3)]({'where':{'telegramId':_0x1b2682},'data':{'shopId':_0x20aafa['id'],'isVerified':!![]}}),await this[_0x514549(0x273)]?.['sendMessage'](_0x12e2aa,_0x514549(0x22f)+_0x514549(0x21b)+(_0x514549(0x216)+_0x20aafa[_0x514549(0x1c7)]+'*\x0a')+(_0x514549(0x26c)+_0x20aafa[_0x514549(0x200)]+'`\x0a\x0a')+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x514549(0x27c)+'•\x20Payouts\x0a'+_0x514549(0x1c1)+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x514549(0x1f7),{'parse_mode':_0x514549(0x275)}),console[_0x514549(0x1c2)](_0x514549(0x24b)+_0x1b2682+_0x514549(0x263)+_0x20aafa['username']+_0x514549(0x223));}catch(_0x573e58){console[_0x514549(0x25e)](_0x514549(0x232),_0x573e58),await this[_0x514549(0x273)]?.['sendMessage'](_0x12e2aa,_0x514549(0x26d));}}async['sendShopNotification'](_0x2e6d6b,_0x2406d6,_0x198d85){const _0x17f111=a54_0x4042a7;if(!this['bot']){console['warn'](_0x17f111(0x26b));return;}try{const _0x3351e3=await database_1[_0x17f111(0x243)][_0x17f111(0x25b)][_0x17f111(0x1e5)]({'where':{'shopId':_0x2e6d6b,'isVerified':!![]}});if(_0x3351e3[_0x17f111(0x222)]===0x0){console['log'](_0x17f111(0x27f)+_0x2e6d6b);return;}const _0x22971e=_0x3351e3[_0x17f111(0x21d)](async _0x2a2b73=>{const _0x12ca1d=_0x17f111;try{await this[_0x12ca1d(0x273)]?.[_0x12ca1d(0x20a)](_0x2a2b73[_0x12ca1d(0x1f6)],_0x2406d6,_0x198d85),console[_0x12ca1d(0x1c2)](_0x12ca1d(0x28c)+_0x2a2b73[_0x12ca1d(0x1f6)]);}catch(_0xa49333){console['error'](_0x12ca1d(0x210)+_0x2a2b73['telegramId']+':',_0xa49333),_0xa49333 instanceof Error&&(_0xa49333['message'][_0x12ca1d(0x246)]('blocked')||_0xa49333[_0x12ca1d(0x280)][_0x12ca1d(0x246)](_0x12ca1d(0x231))||_0xa49333[_0x12ca1d(0x280)][_0x12ca1d(0x246)](_0x12ca1d(0x295)))&&(await database_1[_0x12ca1d(0x243)]['telegramUser'][_0x12ca1d(0x1f3)]({'where':{'id':_0x2a2b73['id']},'data':{'isVerified':![]}}),console[_0x12ca1d(0x1c2)](_0x12ca1d(0x1e9)+_0x2a2b73[_0x12ca1d(0x1f6)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x17f111(0x256)](_0x22971e);}catch(_0x25cf94){console[_0x17f111(0x25e)](_0x17f111(0x24f),_0x25cf94);}}async[a54_0x4042a7(0x1c6)](_0x272e5f,_0x50fab1,_0xf4f63d){const _0x4064f0=a54_0x4042a7,_0x25a63e={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x32401b={'created':'New\x20payment\x20created','paid':'Payment\x20successfully\x20paid','failed':_0x4064f0(0x22c),'expired':_0x4064f0(0x214),'refund':_0x4064f0(0x1f8),'chargeback':_0x4064f0(0x283),'processing':_0x4064f0(0x1ef)},_0x2af945=_0x25a63e[_0xf4f63d],_0x5a142f=_0x32401b[_0xf4f63d],_0x285371=(0x0,gateway_1[_0x4064f0(0x1e3)])(_0x50fab1['gateway']);console['log'](_0x4064f0(0x1fd)+_0x50fab1[_0x4064f0(0x267)]+_0x4064f0(0x23a)+_0x285371+'\x22');let _0x178a05=_0x2af945+'\x20*'+_0x5a142f+_0x4064f0(0x1fe)+('💰\x20Amount:\x20*'+_0x50fab1['amount']+'\x20'+_0x50fab1[_0x4064f0(0x1c5)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x50fab1[_0x4064f0(0x233)]||_0x50fab1['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x50fab1['id']+'`\x0a')+(_0x4064f0(0x250)+_0x285371+'`\x0a')+(_0x4064f0(0x28f)+new Date(_0x50fab1[_0x4064f0(0x27e)])[_0x4064f0(0x202)](_0x4064f0(0x209))+'\x0a');if(_0x50fab1[_0x4064f0(0x1f4)]||_0x50fab1[_0x4064f0(0x1de)]||_0x50fab1[_0x4064f0(0x1d0)]||_0x50fab1[_0x4064f0(0x1c4)]||_0x50fab1[_0x4064f0(0x294)]){_0x178a05+=_0x4064f0(0x282);_0x50fab1[_0x4064f0(0x1f4)]&&(_0x178a05+='📛\x20Name:\x20`'+_0x50fab1[_0x4064f0(0x1f4)]+'`\x0a');_0x50fab1['customerEmail']&&(_0x178a05+=_0x4064f0(0x1ea)+_0x50fab1[_0x4064f0(0x1de)]+'`\x0a');_0x50fab1[_0x4064f0(0x1d0)]&&(_0x178a05+='🏦\x20IBAN:\x20`'+_0x50fab1['remitterIban']+'`\x0a');_0x50fab1[_0x4064f0(0x1c4)]&&(_0x178a05+='🌐\x20IP:\x20`'+_0x50fab1[_0x4064f0(0x1c4)]+'`\x0a');if(_0x50fab1[_0x4064f0(0x294)]){const _0x45c2c4=_0x50fab1[_0x4064f0(0x294)][_0x4064f0(0x222)]>0x32?_0x50fab1['customerUa']['substring'](0x0,0x32)+_0x4064f0(0x201):_0x50fab1['customerUa'];_0x178a05+='💻\x20Browser:\x20`'+_0x45c2c4+'`\x0a';}}_0xf4f63d===_0x4064f0(0x230)&&_0x50fab1[_0x4064f0(0x274)]&&(_0x178a05+=_0x4064f0(0x281)+_0x50fab1[_0x4064f0(0x274)]+_0x4064f0(0x28d)),_0xf4f63d==='processing'&&(_0x178a05+=_0x4064f0(0x1d6)),_0x50fab1[_0x4064f0(0x22d)]&&(_0x178a05+=_0x4064f0(0x1c0)+_0x50fab1[_0x4064f0(0x22d)]+'\x0a'),await this[_0x4064f0(0x1ed)](_0x272e5f,_0x178a05,{'parse_mode':'Markdown'});}async[a54_0x4042a7(0x284)](_0x33479c,_0x5503ba,_0x2306a1){const _0x4174c3=a54_0x4042a7,_0x3f572d={'created':'📤','completed':'✅','rejected':'❌'},_0x2c14a8={'created':'New\x20payout\x20created','completed':'Payout\x20completed','rejected':_0x4174c3(0x23d)},_0x2acb20=_0x3f572d[_0x2306a1],_0xb81763=_0x2c14a8[_0x2306a1],_0x1a9f4c=_0x2acb20+'\x20*'+_0xb81763+'*\x0a\x0a'+('💸\x20Amount:\x20*'+_0x5503ba[_0x4174c3(0x25f)]+_0x4174c3(0x26a))+(_0x4174c3(0x217)+_0x5503ba[_0x4174c3(0x28b)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x5503ba['id']+'`\x0a')+(_0x4174c3(0x28f)+new Date(_0x5503ba[_0x4174c3(0x27e)])[_0x4174c3(0x202)](_0x4174c3(0x209))+'\x0a')+(_0x5503ba[_0x4174c3(0x1d4)]?_0x4174c3(0x1e7)+_0x5503ba['txid']+'`':'');await this[_0x4174c3(0x1ed)](_0x33479c,_0x1a9f4c,{'parse_mode':_0x4174c3(0x275)});}async[a54_0x4042a7(0x1dc)](_0x2e6829,_0x5d8647){const _0x10f2f8=a54_0x4042a7;try{const _0x3d5338=await database_1['default'][_0x10f2f8(0x286)][_0x10f2f8(0x1e8)]({'where':{'shopId':_0x2e6829},'select':{'notificationLogin':!![]}});if(!_0x3d5338?.[_0x10f2f8(0x252)]){console[_0x10f2f8(0x1c2)](_0x10f2f8(0x20f)+_0x2e6829);return;}const _0x2be72e=_0x5d8647[_0x10f2f8(0x206)]?'🔐':'🚨',_0x5ed896=_0x5d8647[_0x10f2f8(0x206)]?_0x10f2f8(0x255):'Failed\x20login\x20attempt';let _0x332583=_0x2be72e+'\x20*'+_0x5ed896+_0x10f2f8(0x1fe)+('👤\x20Username:\x20`'+_0x5d8647['username']+'`\x0a')+(_0x10f2f8(0x238)+_0x5d8647[_0x10f2f8(0x291)][_0x10f2f8(0x202)](_0x10f2f8(0x209))+'\x0a');_0x5d8647[_0x10f2f8(0x259)]&&(_0x332583+=_0x10f2f8(0x27b)+_0x5d8647[_0x10f2f8(0x259)]+'`\x0a');if(_0x5d8647['userAgent']){const _0x582a68=_0x5d8647[_0x10f2f8(0x1e6)]['length']>0x32?_0x5d8647[_0x10f2f8(0x1e6)][_0x10f2f8(0x24e)](0x0,0x32)+_0x10f2f8(0x201):_0x5d8647['userAgent'];_0x332583+=_0x10f2f8(0x1bd)+_0x582a68+'`\x0a';}!_0x5d8647[_0x10f2f8(0x206)]&&(_0x332583+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x10f2f8(0x1ed)](_0x2e6829,_0x332583,{'parse_mode':_0x10f2f8(0x275)}),console[_0x10f2f8(0x1c2)](_0x10f2f8(0x1f2)+_0x2e6829+':\x20'+(_0x5d8647[_0x10f2f8(0x206)]?_0x10f2f8(0x206):_0x10f2f8(0x1e4)));}catch(_0x5e6471){console[_0x10f2f8(0x25e)]('Failed\x20to\x20send\x20login\x20notification:',_0x5e6471);}}async[a54_0x4042a7(0x1bf)](_0x16f547,_0x50f6e7){const _0x4eb54d=a54_0x4042a7;try{const _0xd20672=await database_1['default'][_0x4eb54d(0x286)][_0x4eb54d(0x1e8)]({'where':{'shopId':_0x16f547},'select':{'notificationApiError':!![]}});if(!_0xd20672?.[_0x4eb54d(0x261)]){console[_0x4eb54d(0x1c2)](_0x4eb54d(0x257)+_0x16f547);return;}let _0x267713=_0x4eb54d(0x29b)+(_0x4eb54d(0x1df)+_0x50f6e7['method']+'\x20'+_0x50f6e7[_0x4eb54d(0x213)]+'`\x0a')+(_0x4eb54d(0x238)+_0x50f6e7['timestamp']['toLocaleString'](_0x4eb54d(0x209))+'\x0a');_0x50f6e7['statusCode']&&(_0x267713+=_0x4eb54d(0x218)+_0x50f6e7['statusCode']+'`\x0a'),_0x267713+=_0x4eb54d(0x247)+_0x50f6e7[_0x4eb54d(0x20d)]+'`\x0a',_0x50f6e7['requestId']&&(_0x267713+='🆔\x20Request\x20ID:\x20`'+_0x50f6e7[_0x4eb54d(0x24a)]+'`\x0a'),_0x267713+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x4eb54d(0x1ed)](_0x16f547,_0x267713,{'parse_mode':_0x4eb54d(0x275)}),console['log'](_0x4eb54d(0x264)+_0x16f547+':\x20'+_0x50f6e7['endpoint']);}catch(_0x171924){console[_0x4eb54d(0x25e)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x171924);}}async[a54_0x4042a7(0x27a)](_0x23fef6,_0xd1dc8,_0x28e8b4){const _0x13bcd5=a54_0x4042a7;let _0x3f217e='🔔\x20*'+_0xd1dc8+'*\x0a\x0a';for(const [_0x508f49,_0x2a1a2e]of Object[_0x13bcd5(0x298)](_0x28e8b4)){_0x2a1a2e!==null&&_0x2a1a2e!==undefined&&(_0x3f217e+=_0x508f49+_0x13bcd5(0x240)+_0x2a1a2e+'`\x0a');}await this[_0x13bcd5(0x1ed)](_0x23fef6,_0x3f217e,{'parse_mode':_0x13bcd5(0x275)});}[a54_0x4042a7(0x21f)](){const _0x15bc64=a54_0x4042a7;return{'isActive':!!this[_0x15bc64(0x273)],'username':this['botUsername']};}[a54_0x4042a7(0x269)](){const _0x535af6=a54_0x4042a7;this[_0x535af6(0x273)]&&(this[_0x535af6(0x273)][_0x535af6(0x21a)](),this[_0x535af6(0x273)]=null,console[_0x535af6(0x1c2)](_0x535af6(0x266)));}}function a54_0x5b28(_0x10b189,_0x10afe1){const _0x1aca05=a54_0x1aca();return a54_0x5b28=function(_0x5b2842,_0x4b603f){_0x5b2842=_0x5b2842-0x1bd;let _0x1611e3=_0x1aca05[_0x5b2842];return _0x1611e3;},a54_0x5b28(_0x10b189,_0x10afe1);}exports[a54_0x4042a7(0x24d)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();