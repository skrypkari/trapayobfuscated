'use strict';const a54_0x4c577d=a54_0x551e;(function(_0xff39bb,_0x30af8d){const _0xb0fc0f=a54_0x551e,_0x358146=_0xff39bb();while(!![]){try{const _0x25b9b3=parseInt(_0xb0fc0f(0x188))/0x1+-parseInt(_0xb0fc0f(0xe9))/0x2*(-parseInt(_0xb0fc0f(0x12a))/0x3)+parseInt(_0xb0fc0f(0x117))/0x4*(parseInt(_0xb0fc0f(0xc4))/0x5)+parseInt(_0xb0fc0f(0xe0))/0x6+-parseInt(_0xb0fc0f(0xf1))/0x7+parseInt(_0xb0fc0f(0xf2))/0x8*(-parseInt(_0xb0fc0f(0x12d))/0x9)+parseInt(_0xb0fc0f(0xe8))/0xa*(-parseInt(_0xb0fc0f(0xdb))/0xb);if(_0x25b9b3===_0x30af8d)break;else _0x358146['push'](_0x358146['shift']());}catch(_0x1da680){_0x358146['push'](_0x358146['shift']());}}}(a54_0x3cab,0x6472f));function a54_0x551e(_0x33422a,_0x4e0421){const _0x3cabda=a54_0x3cab();return a54_0x551e=function(_0x551e79,_0x5b6fee){_0x551e79=_0x551e79-0xba;let _0x51781d=_0x3cabda[_0x551e79];return _0x51781d;},a54_0x551e(_0x33422a,_0x4e0421);}var __importDefault=this&&this[a54_0x4c577d(0x168)]||function(_0x4503a4){const _0x262308=a54_0x4c577d;return _0x4503a4&&_0x4503a4[_0x262308(0x104)]?_0x4503a4:{'default':_0x4503a4};};Object[a54_0x4c577d(0x164)](exports,a54_0x4c577d(0x104),{'value':!![]}),exports[a54_0x4c577d(0xbe)]=exports[a54_0x4c577d(0x185)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x4c577d(0x182))),database_1=__importDefault(require(a54_0x4c577d(0xd4))),gateway_1=require(a54_0x4c577d(0x106));function a54_0x3cab(){const _0x48f8d4=['method','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Use\x20/start\x20to\x20begin.','isVerified','`\x20(','setupBotHandlers','New\x20payout\x20created','telegramUser','shop','•\x20Important\x20events\x0a\x0a','__esModule','\x20\x20\x20Public\x20Key:\x20`','../types/gateway','.\x20*','env','shopId','adminNotes','updatedAt','TELEGRAM_BOT_USERNAME','endpoint','🏪\x20Available\x20shops\x20in\x20system:\x0a','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','*.\x0a\x0a','📊\x20*Connection\x20Status*\x0a\x0a','findUnique','📅\x20Connection\x20date:\x20','userAgent','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','1126612ldVDFf','botUsername','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','sendMessage','✅\x20Connected\x20to\x20shop:\x20*','\x20\x20\x20Username:\x20`','trim','•\x20`','sendCustomNotification','Payment\x20chargeback','stopBot','join','✅\x20Welcome\x20back!\x0a\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','ipAddress','pk_','❌\x20Invalid\x20username\x20format:\x20`','\x20parts:\x20','sendShopNotification','3IAyJCo','split','Use\x20/start\x20to\x20connect.','3164382uPpcmk','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','handleSingleLineVerification','Failed\x20to\x20send\x20API\x20error\x20notification:','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','Payment\x20is\x20being\x20processed','Payment\x20successfully\x20paid','💸\x20Penalty\x20amount:\x20*','🔍\x20*Debug\x20Information*\x0a\x0a','\x20via\x20single-line\x20input','amount','\x0aCheck\x20spelling\x20and\x20try\x20again.','💸\x20Amount:\x20*','🔔\x20*','Error\x20sending\x20shop\x20notification:','🔔\x20You\x20receive\x20notifications\x20about:\x0a','first_name','unknown\x20shop','🆔\x20Payout\x20ID:\x20`','getBotInfo','chargebackAmount','username','success','customerEmail','📧\x20Email:\x20`','❌\x20Shop\x20`','timestamp','/disconnect\x20-\x20disconnect\x20from\x20notifications','\x20USD*\x0a','initializeBot','forEach','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','requestId','\x20initialized\x20successfully','from','trapay_bot','customerName','update','🆔\x20Payment\x20ID:\x20`','currency','name','•\x20Payment\x20status\x20changes\x0a','Payout\x20rejected','\x0a👤\x20*Customer\x20Information:*\x0a','🛑\x20Telegram\x20bot\x20stopped',':\x20username=\x22','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','message','chat','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','Commands:\x0a','*\x0a\x0a','last_name','•\x20New\x20payments\x0a','Error\x20handling\x20/start\x20command:','defineProperty','Check\x20spelling\x20and\x20try\x20again.','log','❌\x20Error:\x20`','__importDefault','...\x22','📛\x20Name:\x20`','`\x0a\x0a','includes','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','🔌\x20User\x20','findMany','❌\x20Please\x20use\x20/start\x20command\x20first','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','botToken','\x20USDT*\x0a','blocked','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','telegramId','🔗\x20Endpoint:\x20`','toLocaleString','💰\x20Amount:\x20*','📱\x20Created\x20new\x20Telegram\x20user:\x20','bot','🏪\x20Gateway:\x20`','statusCode','createdAt','sendPaymentNotification','\x22,\x20apiKey=\x22','Available\x20usernames:\x0a','node-telegram-bot-api','notificationLogin','/status\x20-\x20check\x20connection\x20status\x0a','TelegramBotService','shopSettings','notificationApiError','466358gSPOGc','❌\x20Shop\x20with\x20username\x20`','stopPolling','warn','ACTIVE','\x20verified\x20for\x20shop\x20','telegramBotService','You\x20sent\x20','getGatewayDisplayNameForTelegram','orderId','...`\x0a\x0a','txid','10FtlPcZ','Markdown','📝\x20Order\x20ID:\x20`','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','Payment\x20failed','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','Successful\x20login','Error\x20handling\x20/status\x20command:','default','chat\x20not\x20found','allSettled','📊\x20Error\x20code:\x20`','substring','onText','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','en-US','../config/database','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','Telegram\x20bot\x20error:','🌐\x20IP\x20address:\x20`','toString','findFirst','1892txGwrg','error','🔔\x20Notifications\x20are\x20active\x0a\x0a','gateway','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','1628772WoGfKf','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','📱\x20Telegram\x20notification:\x20gateway\x20\x22','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','🎉\x20*Congratulations!*\x0a\x0a','create','startsWith','55120DreHLu','986592dWbYGw','📅\x20Date:\x20','`.\x0a\x0a','Payment\x20refund','👤\x20Username:\x20`','polling_error','\x22\x20->\x20display\x20\x22','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','583247RMzXnF','8ZGUOLQ','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','length','💻\x20Browser:\x20`','📱\x20Shop:\x20*','publicKey','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!'];a54_0x3cab=function(){return _0x48f8d4;};return a54_0x3cab();}class TelegramBotService{constructor(){const _0x2f5828=a54_0x4c577d;this['bot']=null,this['botToken']=process[_0x2f5828(0x108)]['TELEGRAM_BOT_TOKEN']||'',this[_0x2f5828(0x118)]=process[_0x2f5828(0x108)][_0x2f5828(0x10c)]||_0x2f5828(0x150),this['botToken']?this[_0x2f5828(0x14a)]():console[_0x2f5828(0xbb)](_0x2f5828(0x116));}[a54_0x4c577d(0x14a)](){const _0x4c282b=a54_0x4c577d;try{this[_0x4c282b(0x17b)]=new node_telegram_bot_api_1[(_0x4c282b(0xcc))](this[_0x4c282b(0x172)],{'polling':!![]}),this[_0x4c282b(0xff)](),console[_0x4c282b(0x166)]('✅\x20Telegram\x20bot\x20@'+this[_0x4c282b(0x118)]+_0x4c282b(0x14e));}catch(_0x6c6d9f){console[_0x4c282b(0xdc)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x6c6d9f);}}[a54_0x4c577d(0xff)](){const _0x455fae=a54_0x4c577d;if(!this[_0x455fae(0x17b)])return;this['bot'][_0x455fae(0xd1)](/\/start/,async _0x34b650=>{const _0x2b211f=_0x455fae,_0x13e84e=_0x34b650[_0x2b211f(0x15d)]['id'],_0x550cba=_0x34b650['from']?.['id'][_0x2b211f(0xd9)](),_0x35afb8=_0x34b650[_0x2b211f(0x14f)]?.[_0x2b211f(0x142)],_0x2c2adf=_0x34b650[_0x2b211f(0x14f)]?.[_0x2b211f(0x13d)],_0x35335d=_0x34b650[_0x2b211f(0x14f)]?.[_0x2b211f(0x161)];if(!_0x550cba)return;try{let _0x107eba=await database_1[_0x2b211f(0xcc)][_0x2b211f(0x101)][_0x2b211f(0x113)]({'where':{'telegramId':_0x550cba},'include':{'shop':!![]}});!_0x107eba?(_0x107eba=await database_1[_0x2b211f(0xcc)][_0x2b211f(0x101)][_0x2b211f(0xe6)]({'data':{'telegramId':_0x550cba,'username':_0x35afb8,'firstName':_0x2c2adf,'lastName':_0x35335d,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x2b211f(0x17a)+_0x550cba+'\x20(@'+_0x35afb8+')')):_0x107eba=await database_1[_0x2b211f(0xcc)][_0x2b211f(0x101)][_0x2b211f(0x152)]({'where':{'telegramId':_0x550cba},'data':{'username':_0x35afb8,'firstName':_0x2c2adf,'lastName':_0x35335d},'include':{'shop':!![]}}),_0x107eba[_0x2b211f(0xfd)]&&_0x107eba[_0x2b211f(0x109)]&&_0x107eba[_0x2b211f(0x102)]?await this[_0x2b211f(0x17b)]?.[_0x2b211f(0x11a)](_0x13e84e,_0x2b211f(0x123)+(_0x2b211f(0xd2)+_0x107eba[_0x2b211f(0x102)]['name']+'*\x0a')+('Username:\x20`'+_0x107eba[_0x2b211f(0x102)][_0x2b211f(0x142)]+'`\x0a\x0a')+_0x2b211f(0x13c)+_0x2b211f(0x162)+_0x2b211f(0x156)+'•\x20Payouts\x0a\x0a'+_0x2b211f(0x15f)+_0x2b211f(0x184)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x2b211f(0xc5)}):(_0x107eba[_0x2b211f(0x109)]&&!_0x107eba[_0x2b211f(0xfd)]&&(await database_1[_0x2b211f(0xcc)][_0x2b211f(0x101)][_0x2b211f(0x152)]({'where':{'telegramId':_0x550cba},'data':{'shopId':null,'isVerified':![]}}),console[_0x2b211f(0x166)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x550cba)),await this[_0x2b211f(0x17b)]?.[_0x2b211f(0x11a)](_0x13e84e,_0x2b211f(0xc9)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x2b211f(0xfb)+'Example:\x0a'+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x2b211f(0xf8),{'parse_mode':_0x2b211f(0xc5)}));}catch(_0x530293){console[_0x2b211f(0xdc)](_0x2b211f(0x163),_0x530293),await this[_0x2b211f(0x17b)]?.[_0x2b211f(0x11a)](_0x13e84e,_0x2b211f(0xc7));}}),this[_0x455fae(0x17b)][_0x455fae(0xd1)](/\/disconnect/,async _0x1de35e=>{const _0x4f02e9=_0x455fae,_0x147501=_0x1de35e[_0x4f02e9(0x15d)]['id'],_0x36b8cd=_0x1de35e['from']?.['id'][_0x4f02e9(0xd9)]();if(!_0x36b8cd)return;try{const _0x398b63=await database_1[_0x4f02e9(0xcc)][_0x4f02e9(0x101)][_0x4f02e9(0x113)]({'where':{'telegramId':_0x36b8cd},'include':{'shop':!![]}});if(!_0x398b63||!_0x398b63[_0x4f02e9(0xfd)]||!_0x398b63[_0x4f02e9(0x109)]){await this['bot']?.[_0x4f02e9(0x11a)](_0x147501,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0xb8d4f=_0x398b63[_0x4f02e9(0x102)]?.[_0x4f02e9(0x155)]||_0x4f02e9(0x13e);await database_1['default'][_0x4f02e9(0x101)][_0x4f02e9(0x152)]({'where':{'telegramId':_0x36b8cd},'data':{'shopId':null,'isVerified':![]}}),console[_0x4f02e9(0x166)](_0x4f02e9(0x16e)+_0x36b8cd+'\x20disconnected\x20from\x20shop\x20'+_0x398b63['shopId']),await this[_0x4f02e9(0x17b)]?.[_0x4f02e9(0x11a)](_0x147501,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0xb8d4f+_0x4f02e9(0x111)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x4f02e9(0xc5)});}catch(_0x30286c){console['error']('Error\x20handling\x20/disconnect\x20command:',_0x30286c),await this[_0x4f02e9(0x17b)]?.['sendMessage'](_0x147501,_0x4f02e9(0xc7));}}),this[_0x455fae(0x17b)]['onText'](/\/status/,async _0x39e802=>{const _0x309d90=_0x455fae,_0x3c3d3f=_0x39e802[_0x309d90(0x15d)]['id'],_0x1335c8=_0x39e802[_0x309d90(0x14f)]?.['id'][_0x309d90(0xd9)]();if(!_0x1335c8)return;try{const _0x3124c3=await database_1['default'][_0x309d90(0x101)][_0x309d90(0x113)]({'where':{'telegramId':_0x1335c8},'include':{'shop':!![]}});if(!_0x3124c3){await this[_0x309d90(0x17b)]?.[_0x309d90(0x11a)](_0x3c3d3f,_0x309d90(0x124)+_0x309d90(0xfc));return;}if(!_0x3124c3[_0x309d90(0xfd)]||!_0x3124c3[_0x309d90(0x109)]||!_0x3124c3['shop']){await this[_0x309d90(0x17b)]?.[_0x309d90(0x11a)](_0x3c3d3f,_0x309d90(0x119)+_0x309d90(0x12c));return;}await this[_0x309d90(0x17b)]?.[_0x309d90(0x11a)](_0x3c3d3f,_0x309d90(0x112)+(_0x309d90(0x11b)+_0x3124c3[_0x309d90(0x102)][_0x309d90(0x155)]+'*\x0a')+(_0x309d90(0xed)+_0x3124c3['shop'][_0x309d90(0x142)]+'`\x0a')+(_0x309d90(0x114)+_0x3124c3[_0x309d90(0x10b)]['toLocaleDateString'](_0x309d90(0xd3))+'\x0a\x0a')+_0x309d90(0xdd)+_0x309d90(0x15f)+_0x309d90(0x148),{'parse_mode':_0x309d90(0xc5)});}catch(_0x4fccb8){console[_0x309d90(0xdc)](_0x309d90(0xcb),_0x4fccb8),await this[_0x309d90(0x17b)]?.[_0x309d90(0x11a)](_0x3c3d3f,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['onText'](/\/debug/,async _0x4fa404=>{const _0x59535d=_0x455fae,_0x183c9a=_0x4fa404[_0x59535d(0x15d)]['id'],_0x44008c=_0x4fa404[_0x59535d(0x14f)]?.['id']['toString']();if(!_0x44008c)return;try{const _0x272e99=await database_1[_0x59535d(0xcc)][_0x59535d(0x102)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x356c55=_0x59535d(0x135);_0x356c55+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x44008c+_0x59535d(0x16b),_0x356c55+=_0x59535d(0x10e),_0x272e99[_0x59535d(0x14b)]((_0x2992ff,_0xb75bc3)=>{const _0x16c1e3=_0x59535d;_0x356c55+=_0xb75bc3+0x1+_0x16c1e3(0x107)+_0x2992ff[_0x16c1e3(0x155)]+'*\x0a',_0x356c55+=_0x16c1e3(0x11c)+_0x2992ff[_0x16c1e3(0x142)]+'`\x0a',_0x356c55+='\x20\x20\x20Status:\x20'+_0x2992ff['status']+'\x0a',_0x356c55+=_0x16c1e3(0x105)+_0x2992ff[_0x16c1e3(0xf7)][_0x16c1e3(0xd0)](0x0,0xf)+_0x16c1e3(0xc2);}),await this[_0x59535d(0x17b)]?.['sendMessage'](_0x183c9a,_0x356c55,{'parse_mode':_0x59535d(0xc5)});}catch(_0x4c5492){console[_0x59535d(0xdc)]('Error\x20handling\x20/debug\x20command:',_0x4c5492),await this[_0x59535d(0x17b)]?.[_0x59535d(0x11a)](_0x183c9a,'❌\x20Error\x20getting\x20debug\x20information.');}}),this['bot']['on'](_0x455fae(0x15c),async _0x798436=>{const _0x5c653d=_0x455fae;if(_0x798436['text']?.[_0x5c653d(0xe7)]('/'))return;const _0x54e540=_0x798436[_0x5c653d(0x15d)]['id'],_0x20ec17=_0x798436[_0x5c653d(0x14f)]?.['id'][_0x5c653d(0xd9)](),_0x1e5bbd=_0x798436['text']?.[_0x5c653d(0x11d)]();if(!_0x20ec17||!_0x1e5bbd)return;try{const _0x9f5cf=await database_1[_0x5c653d(0xcc)][_0x5c653d(0x101)][_0x5c653d(0x113)]({'where':{'telegramId':_0x20ec17},'include':{'shop':!![]}});if(!_0x9f5cf){await this[_0x5c653d(0x17b)]?.['sendMessage'](_0x54e540,_0x5c653d(0x170));return;}if(_0x9f5cf[_0x5c653d(0xfd)]&&_0x9f5cf[_0x5c653d(0x109)]&&_0x9f5cf[_0x5c653d(0x102)]){await this[_0x5c653d(0x17b)]?.[_0x5c653d(0x11a)](_0x54e540,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x9f5cf[_0x5c653d(0x102)][_0x5c653d(0x155)]+_0x5c653d(0x111)+_0x5c653d(0x10f),{'parse_mode':_0x5c653d(0xc5)});return;}const _0x3d317b=_0x1e5bbd[_0x5c653d(0x12b)](/\s+/);if(_0x3d317b['length']!==0x2){await this['bot']?.['sendMessage'](_0x54e540,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x5c653d(0xfb)+'Example:\x0a'+_0x5c653d(0x15b)+(_0x5c653d(0xbf)+_0x3d317b[_0x5c653d(0xf4)]+_0x5c653d(0x128)+_0x3d317b['map'](_0x1891ee=>'`'+_0x1891ee+'`')[_0x5c653d(0x122)](',\x20')),{'parse_mode':_0x5c653d(0xc5)});return;}const [_0x184c36,_0x2eb1f1]=_0x3d317b;console[_0x5c653d(0x166)](_0x5c653d(0x16d)+_0x20ec17+_0x5c653d(0x15a)+_0x184c36+'\x22,\x20apiKey=\x22'+_0x2eb1f1[_0x5c653d(0xd0)](0x0,0xa)+_0x5c653d(0x169)),await this[_0x5c653d(0x12f)](_0x54e540,_0x20ec17,_0x184c36,_0x2eb1f1);}catch(_0x238534){console[_0x5c653d(0xdc)]('Error\x20handling\x20message:',_0x238534),await this[_0x5c653d(0x17b)]?.[_0x5c653d(0x11a)](_0x54e540,_0x5c653d(0xc7));}}),this[_0x455fae(0x17b)]['on']('error',_0x3fbc12=>{const _0x2e4006=_0x455fae;console['error'](_0x2e4006(0xd7),_0x3fbc12);}),this['bot']['on'](_0x455fae(0xee),_0x4a988e=>{const _0x52b25f=_0x455fae;console[_0x52b25f(0xdc)]('Telegram\x20bot\x20polling\x20error:',_0x4a988e);});}async[a54_0x4c577d(0x12f)](_0x64167,_0x4458d5,_0x1e7614,_0x3ab413){const _0x4ede62=a54_0x4c577d;try{console[_0x4ede62(0x166)](_0x4ede62(0x16d)+_0x4458d5+_0x4ede62(0x15a)+_0x1e7614+_0x4ede62(0x180)+_0x3ab413['substring'](0x0,0xa)+_0x4ede62(0x169));if(!_0x1e7614||_0x1e7614[_0x4ede62(0xf4)]<0x3||_0x1e7614['length']>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x1e7614)){await this[_0x4ede62(0x17b)]?.[_0x4ede62(0x11a)](_0x64167,_0x4ede62(0x127)+_0x1e7614+_0x4ede62(0x16b)+_0x4ede62(0x14c),{'parse_mode':'Markdown'});return;}if(!_0x3ab413||!_0x3ab413[_0x4ede62(0xe7)](_0x4ede62(0x126))&&!_0x3ab413[_0x4ede62(0xe7)]('sk_')){await this[_0x4ede62(0x17b)]?.[_0x4ede62(0x11a)](_0x64167,_0x4ede62(0x131)+_0x4ede62(0x15e),{'parse_mode':_0x4ede62(0xc5)});return;}const _0x20479b=await database_1[_0x4ede62(0xcc)][_0x4ede62(0x102)][_0x4ede62(0x113)]({'where':{'username':_0x1e7614},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x20479b){const _0x2e0ab8=await database_1['default'][_0x4ede62(0x102)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x4ebcb8=_0x4ede62(0x189)+_0x1e7614+'`\x20not\x20found.\x0a\x0a';_0x2e0ab8[_0x4ede62(0xf4)]>0x0?(_0x4ebcb8+=_0x4ede62(0x181),_0x2e0ab8[_0x4ede62(0x14b)](_0x8e657c=>{const _0x419c83=_0x4ede62;_0x4ebcb8+=_0x419c83(0x11e)+_0x8e657c[_0x419c83(0x142)]+_0x419c83(0xfe)+_0x8e657c['name']+')\x0a';}),_0x4ebcb8+=_0x4ede62(0x138)):_0x4ebcb8+=_0x4ede62(0x165);await this[_0x4ede62(0x17b)]?.['sendMessage'](_0x64167,_0x4ebcb8,{'parse_mode':_0x4ede62(0xc5)});return;}if(_0x20479b['status']!==_0x4ede62(0xbc)){await this[_0x4ede62(0x17b)]?.[_0x4ede62(0x11a)](_0x64167,_0x4ede62(0x146)+_0x1e7614+'`\x20is\x20inactive.\x0a\x0a'+'Contact\x20administrator.',{'parse_mode':_0x4ede62(0xc5)});return;}if(_0x20479b[_0x4ede62(0xf7)]!==_0x3ab413&&_0x20479b['secretKey']!==_0x3ab413){await this[_0x4ede62(0x17b)]?.[_0x4ede62(0x11a)](_0x64167,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x1e7614+_0x4ede62(0xeb)+_0x4ede62(0xd6)+_0x4ede62(0x171),{'parse_mode':_0x4ede62(0xc5)});return;}const _0x2b12c7=await database_1[_0x4ede62(0xcc)][_0x4ede62(0x101)][_0x4ede62(0xda)]({'where':{'shopId':_0x20479b['id'],'isVerified':!![],'telegramId':{'not':_0x4458d5}}});if(_0x2b12c7){await this[_0x4ede62(0x17b)]?.[_0x4ede62(0x11a)](_0x64167,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x1e7614+'`.\x0a\x0a'+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x4ede62(0xc5)});return;}await database_1['default'][_0x4ede62(0x101)][_0x4ede62(0x152)]({'where':{'telegramId':_0x4458d5},'data':{'shopId':_0x20479b['id'],'isVerified':!![]}}),await this[_0x4ede62(0x17b)]?.[_0x4ede62(0x11a)](_0x64167,_0x4ede62(0xe5)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x4ede62(0xf6)+_0x20479b['name']+'*\x0a')+(_0x4ede62(0xed)+_0x20479b[_0x4ede62(0x142)]+_0x4ede62(0x16b))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x4ede62(0x156)+'•\x20Payouts\x0a'+_0x4ede62(0x103)+_0x4ede62(0x15f)+_0x4ede62(0x184)+_0x4ede62(0x148),{'parse_mode':_0x4ede62(0xc5)}),console['log']('✅\x20Telegram\x20user\x20'+_0x4458d5+_0x4ede62(0xbd)+_0x20479b[_0x4ede62(0x142)]+_0x4ede62(0x136));}catch(_0x130183){console[_0x4ede62(0xdc)]('Error\x20in\x20handleSingleLineVerification:',_0x130183),await this[_0x4ede62(0x17b)]?.[_0x4ede62(0x11a)](_0x64167,_0x4ede62(0xfa));}}async[a54_0x4c577d(0x129)](_0xefb3c7,_0x264fd2,_0x202536){const _0x5acdce=a54_0x4c577d;if(!this[_0x5acdce(0x17b)]){console[_0x5acdce(0xbb)](_0x5acdce(0xe2));return;}try{const _0x5aa5c9=await database_1[_0x5acdce(0xcc)][_0x5acdce(0x101)][_0x5acdce(0x16f)]({'where':{'shopId':_0xefb3c7,'isVerified':!![]}});if(_0x5aa5c9[_0x5acdce(0xf4)]===0x0){console[_0x5acdce(0x166)](_0x5acdce(0xd5)+_0xefb3c7);return;}const _0x2e70bd=_0x5aa5c9['map'](async _0x1f4aba=>{const _0x4bab7e=_0x5acdce;try{await this['bot']?.[_0x4bab7e(0x11a)](_0x1f4aba[_0x4bab7e(0x176)],_0x264fd2,_0x202536),console[_0x4bab7e(0x166)](_0x4bab7e(0x12e)+_0x1f4aba[_0x4bab7e(0x176)]);}catch(_0x24f2ae){console[_0x4bab7e(0xdc)](_0x4bab7e(0x110)+_0x1f4aba[_0x4bab7e(0x176)]+':',_0x24f2ae),_0x24f2ae instanceof Error&&(_0x24f2ae['message'][_0x4bab7e(0x16c)](_0x4bab7e(0x174))||_0x24f2ae[_0x4bab7e(0x15c)][_0x4bab7e(0x16c)](_0x4bab7e(0xcd))||_0x24f2ae[_0x4bab7e(0x15c)][_0x4bab7e(0x16c)]('user\x20is\x20deactivated'))&&(await database_1[_0x4bab7e(0xcc)][_0x4bab7e(0x101)]['update']({'where':{'id':_0x1f4aba['id']},'data':{'isVerified':![]}}),console['log']('User\x20'+_0x1f4aba[_0x4bab7e(0x176)]+_0x4bab7e(0x175)));}});await Promise[_0x5acdce(0xce)](_0x2e70bd);}catch(_0x57abdb){console[_0x5acdce(0xdc)](_0x5acdce(0x13b),_0x57abdb);}}async[a54_0x4c577d(0x17f)](_0x36f927,_0x5d1e12,_0x356d43){const _0x526ac1=a54_0x4c577d,_0x4e32db={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x53c67a={'created':'New\x20payment\x20created','paid':_0x526ac1(0x133),'failed':_0x526ac1(0xc8),'expired':'Payment\x20expired','refund':_0x526ac1(0xec),'chargeback':_0x526ac1(0x120),'processing':_0x526ac1(0x132)},_0x21d543=_0x4e32db[_0x356d43],_0x9094d8=_0x53c67a[_0x356d43],_0x31ed07=(0x0,gateway_1[_0x526ac1(0xc0)])(_0x5d1e12[_0x526ac1(0xde)]);console[_0x526ac1(0x166)](_0x526ac1(0xe3)+_0x5d1e12[_0x526ac1(0xde)]+_0x526ac1(0xef)+_0x31ed07+'\x22');let _0x3dbe56=_0x21d543+'\x20*'+_0x9094d8+_0x526ac1(0x160)+(_0x526ac1(0x179)+_0x5d1e12['amount']+'\x20'+_0x5d1e12[_0x526ac1(0x154)]+'*\x0a')+(_0x526ac1(0xc6)+(_0x5d1e12[_0x526ac1(0xc1)]||_0x5d1e12['id'])+'`\x0a')+(_0x526ac1(0x153)+_0x5d1e12['id']+'`\x0a')+(_0x526ac1(0x17c)+_0x31ed07+'`\x0a')+(_0x526ac1(0xea)+new Date(_0x5d1e12[_0x526ac1(0x17e)])[_0x526ac1(0x178)](_0x526ac1(0xd3))+'\x0a');(_0x5d1e12['customerName']||_0x5d1e12[_0x526ac1(0x144)])&&(_0x3dbe56+=_0x526ac1(0x158),_0x5d1e12[_0x526ac1(0x151)]&&(_0x3dbe56+=_0x526ac1(0x16a)+_0x5d1e12[_0x526ac1(0x151)]+'`\x0a'),_0x5d1e12[_0x526ac1(0x144)]&&(_0x3dbe56+=_0x526ac1(0x145)+_0x5d1e12[_0x526ac1(0x144)]+'`\x0a')),_0x356d43==='chargeback'&&_0x5d1e12['chargebackAmount']&&(_0x3dbe56+=_0x526ac1(0x134)+_0x5d1e12[_0x526ac1(0x141)]+_0x526ac1(0x173)),_0x356d43==='processing'&&(_0x3dbe56+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x5d1e12[_0x526ac1(0x10a)]&&(_0x3dbe56+='📝\x20Notes:\x20'+_0x5d1e12[_0x526ac1(0x10a)]+'\x0a'),await this[_0x526ac1(0x129)](_0x36f927,_0x3dbe56,{'parse_mode':_0x526ac1(0xc5)});}async['sendPayoutNotification'](_0x1025a7,_0x10244a,_0x22b337){const _0x305b47=a54_0x4c577d,_0x55f1c9={'created':'📤','completed':'✅','rejected':'❌'},_0x42154c={'created':_0x305b47(0x100),'completed':'Payout\x20completed','rejected':_0x305b47(0x157)},_0xf1778d=_0x55f1c9[_0x22b337],_0x121d70=_0x42154c[_0x22b337],_0x47b97b=_0xf1778d+'\x20*'+_0x121d70+_0x305b47(0x160)+(_0x305b47(0x139)+_0x10244a[_0x305b47(0x137)]+_0x305b47(0x149))+('🏦\x20Method:\x20`'+_0x10244a['method']+'`\x0a')+(_0x305b47(0x13f)+_0x10244a['id']+'`\x0a')+(_0x305b47(0xea)+new Date(_0x10244a[_0x305b47(0x17e)])[_0x305b47(0x178)](_0x305b47(0xd3))+'\x0a')+(_0x10244a['txid']?'🔗\x20TXID:\x20`'+_0x10244a[_0x305b47(0xc3)]+'`':'');await this[_0x305b47(0x129)](_0x1025a7,_0x47b97b,{'parse_mode':_0x305b47(0xc5)});}async['sendLoginNotification'](_0x384b12,_0x95613f){const _0x238c1b=a54_0x4c577d;try{const _0x596e0f=await database_1[_0x238c1b(0xcc)][_0x238c1b(0x186)][_0x238c1b(0x113)]({'where':{'shopId':_0x384b12},'select':{'notificationLogin':!![]}});if(!_0x596e0f?.[_0x238c1b(0x183)]){console[_0x238c1b(0x166)](_0x238c1b(0xdf)+_0x384b12);return;}const _0x54cf1a=_0x95613f[_0x238c1b(0x143)]?'🔐':'🚨',_0x3a0776=_0x95613f[_0x238c1b(0x143)]?_0x238c1b(0xca):'Failed\x20login\x20attempt';let _0x5b9030=_0x54cf1a+'\x20*'+_0x3a0776+_0x238c1b(0x160)+('👤\x20Username:\x20`'+_0x95613f['username']+'`\x0a')+('📅\x20Time:\x20'+_0x95613f[_0x238c1b(0x147)]['toLocaleString']('en-US')+'\x0a');_0x95613f[_0x238c1b(0x125)]&&(_0x5b9030+=_0x238c1b(0xd8)+_0x95613f[_0x238c1b(0x125)]+'`\x0a');if(_0x95613f[_0x238c1b(0x115)]){const _0x269ae7=_0x95613f[_0x238c1b(0x115)][_0x238c1b(0xf4)]>0x32?_0x95613f[_0x238c1b(0x115)][_0x238c1b(0xd0)](0x0,0x32)+'...':_0x95613f[_0x238c1b(0x115)];_0x5b9030+=_0x238c1b(0xf5)+_0x269ae7+'`\x0a';}!_0x95613f[_0x238c1b(0x143)]&&(_0x5b9030+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x238c1b(0x129)](_0x384b12,_0x5b9030,{'parse_mode':'Markdown'}),console[_0x238c1b(0x166)](_0x238c1b(0xe1)+_0x384b12+':\x20'+(_0x95613f[_0x238c1b(0x143)]?'success':'failed'));}catch(_0xbdd83){console['error']('Failed\x20to\x20send\x20login\x20notification:',_0xbdd83);}}async['sendApiErrorNotification'](_0x3ecc54,_0x2d233d){const _0x381a2e=a54_0x4c577d;try{const _0x133bd3=await database_1['default'][_0x381a2e(0x186)][_0x381a2e(0x113)]({'where':{'shopId':_0x3ecc54},'select':{'notificationApiError':!![]}});if(!_0x133bd3?.[_0x381a2e(0x187)]){console[_0x381a2e(0x166)](_0x381a2e(0xf3)+_0x3ecc54);return;}let _0xb2c28b='🚨\x20*API\x20Error*\x0a\x0a'+(_0x381a2e(0x177)+_0x2d233d[_0x381a2e(0xf9)]+'\x20'+_0x2d233d['endpoint']+'`\x0a')+('📅\x20Time:\x20'+_0x2d233d[_0x381a2e(0x147)]['toLocaleString'](_0x381a2e(0xd3))+'\x0a');_0x2d233d[_0x381a2e(0x17d)]&&(_0xb2c28b+=_0x381a2e(0xcf)+_0x2d233d[_0x381a2e(0x17d)]+'`\x0a'),_0xb2c28b+=_0x381a2e(0x167)+_0x2d233d['errorMessage']+'`\x0a',_0x2d233d['requestId']&&(_0xb2c28b+='🆔\x20Request\x20ID:\x20`'+_0x2d233d[_0x381a2e(0x14d)]+'`\x0a'),_0xb2c28b+=_0x381a2e(0xf0),await this[_0x381a2e(0x129)](_0x3ecc54,_0xb2c28b,{'parse_mode':_0x381a2e(0xc5)}),console[_0x381a2e(0x166)](_0x381a2e(0xe4)+_0x3ecc54+':\x20'+_0x2d233d[_0x381a2e(0x10d)]);}catch(_0x1516fb){console[_0x381a2e(0xdc)](_0x381a2e(0x130),_0x1516fb);}}async[a54_0x4c577d(0x11f)](_0x4f08b2,_0x4308b2,_0xdd36a){const _0x31403b=a54_0x4c577d;let _0x248ed8=_0x31403b(0x13a)+_0x4308b2+_0x31403b(0x160);for(const [_0x455c4e,_0xf0fbfb]of Object['entries'](_0xdd36a)){_0xf0fbfb!==null&&_0xf0fbfb!==undefined&&(_0x248ed8+=_0x455c4e+':\x20`'+_0xf0fbfb+'`\x0a');}await this['sendShopNotification'](_0x4f08b2,_0x248ed8,{'parse_mode':_0x31403b(0xc5)});}[a54_0x4c577d(0x140)](){const _0x507260=a54_0x4c577d;return{'isActive':!!this[_0x507260(0x17b)],'username':this[_0x507260(0x118)]};}[a54_0x4c577d(0x121)](){const _0xe5cfbd=a54_0x4c577d;this['bot']&&(this[_0xe5cfbd(0x17b)][_0xe5cfbd(0xba)](),this[_0xe5cfbd(0x17b)]=null,console[_0xe5cfbd(0x166)](_0xe5cfbd(0x159)));}}exports[a54_0x4c577d(0x185)]=TelegramBotService,exports[a54_0x4c577d(0xbe)]=new TelegramBotService();