'use strict';const a55_0x57104f=a55_0x2095;function a55_0x2095(_0x5a50aa,_0x168a55){const _0x5e043b=a55_0x5e04();return a55_0x2095=function(_0x209542,_0xc6cf68){_0x209542=_0x209542-0x1e5;let _0x18ea64=_0x5e043b[_0x209542];return _0x18ea64;},a55_0x2095(_0x5a50aa,_0x168a55);}(function(_0x39eaf2,_0x118b3a){const _0x235ee7=a55_0x2095,_0x17082c=_0x39eaf2();while(!![]){try{const _0x45694f=parseInt(_0x235ee7(0x1ef))/0x1+parseInt(_0x235ee7(0x2bd))/0x2+parseInt(_0x235ee7(0x25b))/0x3+-parseInt(_0x235ee7(0x234))/0x4*(parseInt(_0x235ee7(0x20a))/0x5)+parseInt(_0x235ee7(0x24c))/0x6*(-parseInt(_0x235ee7(0x27c))/0x7)+-parseInt(_0x235ee7(0x26e))/0x8+parseInt(_0x235ee7(0x1ed))/0x9;if(_0x45694f===_0x118b3a)break;else _0x17082c['push'](_0x17082c['shift']());}catch(_0x4d12d9){_0x17082c['push'](_0x17082c['shift']());}}}(a55_0x5e04,0x5c099));var __importDefault=this&&this[a55_0x57104f(0x22f)]||function(_0x243852){return _0x243852&&_0x243852['__esModule']?_0x243852:{'default':_0x243852};};Object['defineProperty'](exports,a55_0x57104f(0x225),{'value':!![]}),exports[a55_0x57104f(0x202)]=exports['TelegramBotService']=void 0x0;function a55_0x5e04(){const _0x575bf1=['✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','handleSingleLineVerification','\x20via\x20single-line\x20input','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','Successful\x20login','sendApiErrorNotification','Telegram\x20bot\x20error:','pk_','telegramBotService','✅\x20Telegram\x20bot\x20@','...','gateway','📱\x20Shop:\x20*','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Payment\x20chargeback','485dBtaZs','warn','🔗\x20TXID:\x20`','isVerified','✅\x20Telegram\x20user\x20','createdAt','bot','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','startsWith','initializeBot','\x22,\x20apiKey=\x22','unknown\x20shop','botUsername','sendMessage','amount','\x0aCheck\x20spelling\x20and\x20try\x20again.','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','🔔\x20Notifications\x20are\x20active\x0a\x0a','name','*\x0a\x0a','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','includes','telegramUser','\x20USDT*\x0a','📅\x20Time:\x20','toLocaleDateString','❌\x20Error:\x20`','__esModule','\x20\x20\x20Status:\x20','🔍\x20*Debug\x20Information*\x0a\x0a','onText','botToken','New\x20payment\x20created','status','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','`\x0a\x0a','Markdown','__importDefault','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','split','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','21976eCmPnq','Example:\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','•\x20`','forEach','✅\x20Connected\x20to\x20shop:\x20*','sendPaymentNotification','requestId','Error\x20handling\x20message:','polling_error','user\x20is\x20deactivated','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','telegramId','../types/gateway','To\x20reconnect,\x20use\x20the\x20/start\x20command','\x20\x20\x20Username:\x20`',':\x20`','map','You\x20sent\x20','📱\x20Your\x20Telegram\x20ID:\x20`','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','join','currency','30318TRMwdo','toString','🏦\x20Method:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','en-US','chat\x20not\x20found','sendPayoutNotification','❌\x20Please\x20use\x20/start\x20command\x20first','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','Error\x20handling\x20/status\x20command:','💰\x20Amount:\x20*','•\x20Payment\x20status\x20changes\x0a','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','*.\x0a\x0a','74205BWiiQi','txid','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','🌐\x20IP\x20address:\x20`','•\x20New\x20payments\x0a','TELEGRAM_BOT_TOKEN','Error\x20handling\x20/debug\x20command:','notificationApiError','errorMessage','stopBot','shop','publicKey','entries','🏦\x20IBAN:\x20`','🔌\x20User\x20','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','📝\x20Order\x20ID:\x20`','`.\x0a\x0a','Payment\x20successfully\x20paid','4924768banZAe','ipAddress','log','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','📊\x20Error\x20code:\x20`','allSettled','shopSettings','🆔\x20Payout\x20ID:\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a','🛑\x20Telegram\x20bot\x20stopped','sendCustomNotification','customerIp','notificationLogin','customerUa','651rgOFjV','❌\x20Shop\x20with\x20username\x20`','../config/database','💻\x20Browser:\x20`','error','sk_','text','•\x20Important\x20events\x0a\x0a','chat','endpoint','Commands:\x0a','statusCode','default','💸\x20Amount:\x20*','remitterIban','📊\x20*Connection\x20Status*\x0a\x0a','Use\x20/start\x20to\x20connect.','customerEmail','🆔\x20Request\x20ID:\x20`','sendShopNotification','\x20disconnected\x20from\x20shop\x20','success','📛\x20Name:\x20`','/status\x20-\x20check\x20connection\x20status\x0a','method','findMany','failed','message','Error\x20handling\x20/start\x20command:','\x20\x20\x20Public\x20Key:\x20`',':\x20username=\x22','setupBotHandlers','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','/disconnect\x20-\x20disconnect\x20from\x20notifications','🔗\x20Endpoint:\x20`','...`\x0a\x0a','TELEGRAM_BOT_USERNAME','📧\x20Email:\x20`','secretKey','`\x20is\x20inactive.\x0a\x0a','from','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','Available\x20usernames:\x0a','test','chargebackAmount','•\x20Payouts\x0a','toLocaleString','•\x20Payouts\x0a\x0a','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','❌\x20Shop\x20`','updatedAt','\x20initialized\x20successfully','📅\x20Connection\x20date:\x20','\x20verified\x20for\x20shop\x20','✅\x20Welcome\x20back!\x0a\x0a','📅\x20Date:\x20','create','User\x20','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','trapay_bot','Failed\x20to\x20send\x20login\x20notification:','findUnique','Telegram\x20bot\x20polling\x20error:','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','timestamp','1259324NAazHE','🏪\x20Gateway:\x20`','substring','\x20(@','TelegramBotService','\x0a👤\x20*Customer\x20Information:*\x0a','🆔\x20Payment\x20ID:\x20`','Failed\x20login\x20attempt','last_name','username','customerName','sendLoginNotification','Payment\x20expired','length','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','userAgent','ACTIVE','shopId','Contact\x20administrator.','Failed\x20to\x20send\x20API\x20error\x20notification:','📝\x20Notes:\x20','📱\x20Telegram\x20notification:\x20gateway\x20\x22','getBotInfo','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','Payout\x20completed','👤\x20Username:\x20`','🔔\x20*','...\x22','env','9192420uOCcXG','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','319651fMneOb','findFirst','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Payment\x20refund','trim','Error\x20sending\x20shop\x20notification:','adminNotes','Username:\x20`','🔔\x20You\x20receive\x20notifications\x20about:\x0a','update'];a55_0x5e04=function(){return _0x575bf1;};return a55_0x5e04();}const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a55_0x57104f(0x27e))),gateway_1=require(a55_0x57104f(0x241));class TelegramBotService{constructor(){const _0x5c78c3=a55_0x57104f;this[_0x5c78c3(0x210)]=null,this[_0x5c78c3(0x229)]=process[_0x5c78c3(0x1ec)][_0x5c78c3(0x260)]||'',this[_0x5c78c3(0x216)]=process['env'][_0x5c78c3(0x2a0)]||_0x5c78c3(0x2b7),this['botToken']?this[_0x5c78c3(0x213)]():console['warn'](_0x5c78c3(0x255));}[a55_0x57104f(0x213)](){const _0x13167f=a55_0x57104f;try{this['bot']=new node_telegram_bot_api_1[(_0x13167f(0x288))](this['botToken'],{'polling':!![]}),this[_0x13167f(0x29b)](),console[_0x13167f(0x270)](_0x13167f(0x203)+this[_0x13167f(0x216)]+_0x13167f(0x2af));}catch(_0x1e0ed3){console[_0x13167f(0x280)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x1e0ed3);}}[a55_0x57104f(0x29b)](){const _0x1dce46=a55_0x57104f;if(!this['bot'])return;this[_0x1dce46(0x210)][_0x1dce46(0x228)](/\/start/,async _0x24340d=>{const _0x4b9ad0=_0x1dce46,_0x4740ea=_0x24340d[_0x4b9ad0(0x284)]['id'],_0x2f00e4=_0x24340d[_0x4b9ad0(0x2a4)]?.['id']['toString'](),_0x4923a0=_0x24340d[_0x4b9ad0(0x2a4)]?.[_0x4b9ad0(0x2c6)],_0x40d2e1=_0x24340d[_0x4b9ad0(0x2a4)]?.['first_name'],_0x385091=_0x24340d[_0x4b9ad0(0x2a4)]?.[_0x4b9ad0(0x2c5)];if(!_0x2f00e4)return;try{let _0x5cf039=await database_1['default'][_0x4b9ad0(0x220)][_0x4b9ad0(0x2b9)]({'where':{'telegramId':_0x2f00e4},'include':{'shop':!![]}});!_0x5cf039?(_0x5cf039=await database_1[_0x4b9ad0(0x288)][_0x4b9ad0(0x220)][_0x4b9ad0(0x2b4)]({'data':{'telegramId':_0x2f00e4,'username':_0x4923a0,'firstName':_0x40d2e1,'lastName':_0x385091,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x4b9ad0(0x270)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x2f00e4+_0x4b9ad0(0x2c0)+_0x4923a0+')')):_0x5cf039=await database_1['default'][_0x4b9ad0(0x220)][_0x4b9ad0(0x1f8)]({'where':{'telegramId':_0x2f00e4},'data':{'username':_0x4923a0,'firstName':_0x40d2e1,'lastName':_0x385091},'include':{'shop':!![]}}),_0x5cf039[_0x4b9ad0(0x20d)]&&_0x5cf039[_0x4b9ad0(0x2ce)]&&_0x5cf039['shop']?await this['bot']?.['sendMessage'](_0x4740ea,_0x4b9ad0(0x2b2)+(_0x4b9ad0(0x233)+_0x5cf039['shop'][_0x4b9ad0(0x21c)]+'*\x0a')+(_0x4b9ad0(0x1f6)+_0x5cf039['shop'][_0x4b9ad0(0x2c6)]+_0x4b9ad0(0x22d))+_0x4b9ad0(0x1f7)+_0x4b9ad0(0x25f)+'•\x20Payment\x20status\x20changes\x0a'+_0x4b9ad0(0x2ab)+'Commands:\x0a'+_0x4b9ad0(0x293)+_0x4b9ad0(0x29d),{'parse_mode':_0x4b9ad0(0x22e)}):(_0x5cf039[_0x4b9ad0(0x2ce)]&&!_0x5cf039[_0x4b9ad0(0x20d)]&&(await database_1[_0x4b9ad0(0x288)][_0x4b9ad0(0x220)][_0x4b9ad0(0x1f8)]({'where':{'telegramId':_0x2f00e4},'data':{'shopId':null,'isVerified':![]}}),console[_0x4b9ad0(0x270)](_0x4b9ad0(0x1ee)+_0x2f00e4)),await this['bot']?.[_0x4b9ad0(0x217)](_0x4740ea,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x4b9ad0(0x230)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x4b9ad0(0x235)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x4b9ad0(0x1fa),{'parse_mode':'Markdown'}));}catch(_0x43d54c){console[_0x4b9ad0(0x280)](_0x4b9ad0(0x298),_0x43d54c),await this[_0x4b9ad0(0x210)]?.[_0x4b9ad0(0x217)](_0x4740ea,_0x4b9ad0(0x22c));}}),this['bot'][_0x1dce46(0x228)](/\/disconnect/,async _0x5de628=>{const _0x83cfd6=_0x1dce46,_0x2ab911=_0x5de628[_0x83cfd6(0x284)]['id'],_0x17115d=_0x5de628[_0x83cfd6(0x2a4)]?.['id'][_0x83cfd6(0x24d)]();if(!_0x17115d)return;try{const _0x317ad3=await database_1['default'][_0x83cfd6(0x220)][_0x83cfd6(0x2b9)]({'where':{'telegramId':_0x17115d},'include':{'shop':!![]}});if(!_0x317ad3||!_0x317ad3['isVerified']||!_0x317ad3[_0x83cfd6(0x2ce)]){await this[_0x83cfd6(0x210)]?.[_0x83cfd6(0x217)](_0x2ab911,_0x83cfd6(0x21a));return;}const _0x85752d=_0x317ad3[_0x83cfd6(0x265)]?.[_0x83cfd6(0x21c)]||_0x83cfd6(0x215);await database_1[_0x83cfd6(0x288)][_0x83cfd6(0x220)][_0x83cfd6(0x1f8)]({'where':{'telegramId':_0x17115d},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x83cfd6(0x269)+_0x17115d+_0x83cfd6(0x290)+_0x317ad3['shopId']),await this[_0x83cfd6(0x210)]?.['sendMessage'](_0x2ab911,_0x83cfd6(0x236)+_0x85752d+'*.\x0a\x0a'+_0x83cfd6(0x242),{'parse_mode':_0x83cfd6(0x22e)});}catch(_0x24c54d){console[_0x83cfd6(0x280)]('Error\x20handling\x20/disconnect\x20command:',_0x24c54d),await this[_0x83cfd6(0x210)]?.[_0x83cfd6(0x217)](_0x2ab911,_0x83cfd6(0x22c));}}),this['bot'][_0x1dce46(0x228)](/\/status/,async _0xf63a6e=>{const _0x59e8d2=_0x1dce46,_0x37d130=_0xf63a6e[_0x59e8d2(0x284)]['id'],_0xb4b95e=_0xf63a6e[_0x59e8d2(0x2a4)]?.['id'][_0x59e8d2(0x24d)]();if(!_0xb4b95e)return;try{const _0x241dab=await database_1[_0x59e8d2(0x288)][_0x59e8d2(0x220)][_0x59e8d2(0x2b9)]({'where':{'telegramId':_0xb4b95e},'include':{'shop':!![]}});if(!_0x241dab){await this[_0x59e8d2(0x210)]?.[_0x59e8d2(0x217)](_0x37d130,_0x59e8d2(0x271)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x241dab[_0x59e8d2(0x20d)]||!_0x241dab[_0x59e8d2(0x2ce)]||!_0x241dab[_0x59e8d2(0x265)]){await this['bot']?.[_0x59e8d2(0x217)](_0x37d130,_0x59e8d2(0x24f)+_0x59e8d2(0x28c));return;}await this['bot']?.[_0x59e8d2(0x217)](_0x37d130,_0x59e8d2(0x28b)+(_0x59e8d2(0x239)+_0x241dab[_0x59e8d2(0x265)][_0x59e8d2(0x21c)]+'*\x0a')+('👤\x20Username:\x20`'+_0x241dab[_0x59e8d2(0x265)][_0x59e8d2(0x2c6)]+'`\x0a')+(_0x59e8d2(0x2b0)+_0x241dab[_0x59e8d2(0x2ae)][_0x59e8d2(0x223)]('en-US')+'\x0a\x0a')+_0x59e8d2(0x21b)+_0x59e8d2(0x286)+_0x59e8d2(0x29d),{'parse_mode':'Markdown'});}catch(_0x30f788){console[_0x59e8d2(0x280)](_0x59e8d2(0x256),_0x30f788),await this[_0x59e8d2(0x210)]?.[_0x59e8d2(0x217)](_0x37d130,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['onText'](/\/debug/,async _0x56cfa3=>{const _0x17b941=_0x1dce46,_0x5aa017=_0x56cfa3[_0x17b941(0x284)]['id'],_0x3fbdc5=_0x56cfa3['from']?.['id'][_0x17b941(0x24d)]();if(!_0x3fbdc5)return;try{const _0x538efc=await database_1[_0x17b941(0x288)][_0x17b941(0x265)][_0x17b941(0x295)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x43b92c=_0x17b941(0x227);_0x43b92c+=_0x17b941(0x247)+_0x3fbdc5+'`\x0a\x0a',_0x43b92c+=_0x17b941(0x276),_0x538efc[_0x17b941(0x238)]((_0x5c0751,_0x583c86)=>{const _0x5c710f=_0x17b941;_0x43b92c+=_0x583c86+0x1+'.\x20*'+_0x5c0751[_0x5c710f(0x21c)]+'*\x0a',_0x43b92c+=_0x5c710f(0x243)+_0x5c0751[_0x5c710f(0x2c6)]+'`\x0a',_0x43b92c+=_0x5c710f(0x226)+_0x5c0751[_0x5c710f(0x22b)]+'\x0a',_0x43b92c+=_0x5c710f(0x299)+_0x5c0751[_0x5c710f(0x266)][_0x5c710f(0x2bf)](0x0,0xf)+_0x5c710f(0x29f);}),await this[_0x17b941(0x210)]?.[_0x17b941(0x217)](_0x5aa017,_0x43b92c,{'parse_mode':'Markdown'});}catch(_0x85a66b){console[_0x17b941(0x280)](_0x17b941(0x261),_0x85a66b),await this[_0x17b941(0x210)]?.['sendMessage'](_0x5aa017,'❌\x20Error\x20getting\x20debug\x20information.');}}),this[_0x1dce46(0x210)]['on']('message',async _0x2cd9ab=>{const _0x40907b=_0x1dce46;if(_0x2cd9ab['text']?.[_0x40907b(0x212)]('/'))return;const _0x24c6a3=_0x2cd9ab[_0x40907b(0x284)]['id'],_0x324fd4=_0x2cd9ab[_0x40907b(0x2a4)]?.['id'][_0x40907b(0x24d)](),_0x3d282e=_0x2cd9ab[_0x40907b(0x282)]?.[_0x40907b(0x1f3)]();if(!_0x324fd4||!_0x3d282e)return;try{const _0x5220d8=await database_1['default'][_0x40907b(0x220)][_0x40907b(0x2b9)]({'where':{'telegramId':_0x324fd4},'include':{'shop':!![]}});if(!_0x5220d8){await this[_0x40907b(0x210)]?.[_0x40907b(0x217)](_0x24c6a3,_0x40907b(0x254));return;}if(_0x5220d8[_0x40907b(0x20d)]&&_0x5220d8['shopId']&&_0x5220d8[_0x40907b(0x265)]){await this[_0x40907b(0x210)]?.[_0x40907b(0x217)](_0x24c6a3,_0x40907b(0x1f9)+_0x5220d8[_0x40907b(0x265)][_0x40907b(0x21c)]+_0x40907b(0x25a)+_0x40907b(0x248),{'parse_mode':_0x40907b(0x22e)});return;}const _0x244034=_0x3d282e[_0x40907b(0x232)](/\s+/);if(_0x244034['length']!==0x2){await this[_0x40907b(0x210)]?.[_0x40907b(0x217)](_0x24c6a3,_0x40907b(0x21e)+_0x40907b(0x1f1)+_0x40907b(0x235)+_0x40907b(0x25d)+(_0x40907b(0x246)+_0x244034[_0x40907b(0x2ca)]+'\x20parts:\x20'+_0x244034[_0x40907b(0x245)](_0x16196e=>'`'+_0x16196e+'`')[_0x40907b(0x24a)](',\x20')),{'parse_mode':_0x40907b(0x22e)});return;}const [_0x303f23,_0x2dd3ec]=_0x244034;console['log'](_0x40907b(0x259)+_0x324fd4+_0x40907b(0x29a)+_0x303f23+'\x22,\x20apiKey=\x22'+_0x2dd3ec['substring'](0x0,0xa)+_0x40907b(0x1eb)),await this[_0x40907b(0x1fb)](_0x24c6a3,_0x324fd4,_0x303f23,_0x2dd3ec);}catch(_0xcfcd3c){console['error'](_0x40907b(0x23c),_0xcfcd3c),await this[_0x40907b(0x210)]?.['sendMessage'](_0x24c6a3,_0x40907b(0x22c));}}),this[_0x1dce46(0x210)]['on'](_0x1dce46(0x280),_0x11db6a=>{const _0x1eb44f=_0x1dce46;console[_0x1eb44f(0x280)](_0x1eb44f(0x200),_0x11db6a);}),this[_0x1dce46(0x210)]['on'](_0x1dce46(0x23d),_0x4beefe=>{const _0x571c6f=_0x1dce46;console[_0x571c6f(0x280)](_0x571c6f(0x2ba),_0x4beefe);});}async['handleSingleLineVerification'](_0x254472,_0x2fe1b9,_0x233413,_0x52534d){const _0x46eedc=a55_0x57104f;try{console[_0x46eedc(0x270)](_0x46eedc(0x259)+_0x2fe1b9+_0x46eedc(0x29a)+_0x233413+_0x46eedc(0x214)+_0x52534d[_0x46eedc(0x2bf)](0x0,0xa)+'...\x22');if(!_0x233413||_0x233413['length']<0x3||_0x233413[_0x46eedc(0x2ca)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x46eedc(0x2a7)](_0x233413)){await this[_0x46eedc(0x210)]?.[_0x46eedc(0x217)](_0x254472,'❌\x20Invalid\x20username\x20format:\x20`'+_0x233413+_0x46eedc(0x22d)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x46eedc(0x22e)});return;}if(!_0x52534d||!_0x52534d['startsWith'](_0x46eedc(0x201))&&!_0x52534d[_0x46eedc(0x212)](_0x46eedc(0x281))){await this[_0x46eedc(0x210)]?.[_0x46eedc(0x217)](_0x254472,_0x46eedc(0x231)+_0x46eedc(0x250),{'parse_mode':_0x46eedc(0x22e)});return;}const _0x53bde2=await database_1['default']['shop'][_0x46eedc(0x2b9)]({'where':{'username':_0x233413},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x53bde2){const _0x58b4fc=await database_1['default'][_0x46eedc(0x265)][_0x46eedc(0x295)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x2f3670=_0x46eedc(0x27d)+_0x233413+'`\x20not\x20found.\x0a\x0a';_0x58b4fc[_0x46eedc(0x2ca)]>0x0?(_0x2f3670+=_0x46eedc(0x2a6),_0x58b4fc[_0x46eedc(0x238)](_0xd5ca50=>{const _0x9af80b=_0x46eedc;_0x2f3670+=_0x9af80b(0x237)+_0xd5ca50['username']+'`\x20('+_0xd5ca50[_0x9af80b(0x21c)]+')\x0a';}),_0x2f3670+=_0x46eedc(0x219)):_0x2f3670+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x46eedc(0x210)]?.[_0x46eedc(0x217)](_0x254472,_0x2f3670,{'parse_mode':_0x46eedc(0x22e)});return;}if(_0x53bde2[_0x46eedc(0x22b)]!==_0x46eedc(0x2cd)){await this[_0x46eedc(0x210)]?.['sendMessage'](_0x254472,_0x46eedc(0x2ad)+_0x233413+_0x46eedc(0x2a3)+_0x46eedc(0x2cf),{'parse_mode':_0x46eedc(0x22e)});return;}if(_0x53bde2[_0x46eedc(0x266)]!==_0x52534d&&_0x53bde2[_0x46eedc(0x2a2)]!==_0x52534d){await this[_0x46eedc(0x210)]?.[_0x46eedc(0x217)](_0x254472,_0x46eedc(0x2ac)+_0x233413+_0x46eedc(0x26c)+_0x46eedc(0x207)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':'Markdown'});return;}const _0x4bd285=await database_1[_0x46eedc(0x288)]['telegramUser'][_0x46eedc(0x1f0)]({'where':{'shopId':_0x53bde2['id'],'isVerified':!![],'telegramId':{'not':_0x2fe1b9}}});if(_0x4bd285){await this[_0x46eedc(0x210)]?.['sendMessage'](_0x254472,_0x46eedc(0x26a)+_0x233413+_0x46eedc(0x26c)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x46eedc(0x22e)});return;}await database_1[_0x46eedc(0x288)][_0x46eedc(0x220)]['update']({'where':{'telegramId':_0x2fe1b9},'data':{'shopId':_0x53bde2['id'],'isVerified':!![]}}),await this[_0x46eedc(0x210)]?.[_0x46eedc(0x217)](_0x254472,'🎉\x20*Congratulations!*\x0a\x0a'+_0x46eedc(0x249)+(_0x46eedc(0x206)+_0x53bde2[_0x46eedc(0x21c)]+'*\x0a')+(_0x46eedc(0x1e9)+_0x53bde2[_0x46eedc(0x2c6)]+_0x46eedc(0x22d))+_0x46eedc(0x1fd)+_0x46eedc(0x25f)+_0x46eedc(0x258)+_0x46eedc(0x2a9)+_0x46eedc(0x283)+_0x46eedc(0x286)+_0x46eedc(0x293)+_0x46eedc(0x29d),{'parse_mode':_0x46eedc(0x22e)}),console[_0x46eedc(0x270)](_0x46eedc(0x20e)+_0x2fe1b9+_0x46eedc(0x2b1)+_0x53bde2[_0x46eedc(0x2c6)]+_0x46eedc(0x1fc));}catch(_0x1abadb){console['error']('Error\x20in\x20handleSingleLineVerification:',_0x1abadb),await this['bot']?.[_0x46eedc(0x217)](_0x254472,_0x46eedc(0x208));}}async['sendShopNotification'](_0x3aa0c4,_0x1d4a85,_0x2fda94){const _0x1f7a2a=a55_0x57104f;if(!this[_0x1f7a2a(0x210)]){console[_0x1f7a2a(0x20b)](_0x1f7a2a(0x211));return;}try{const _0x5ca1b0=await database_1[_0x1f7a2a(0x288)][_0x1f7a2a(0x220)][_0x1f7a2a(0x295)]({'where':{'shopId':_0x3aa0c4,'isVerified':!![]}});if(_0x5ca1b0['length']===0x0){console[_0x1f7a2a(0x270)](_0x1f7a2a(0x2a5)+_0x3aa0c4);return;}const _0x43d2e3=_0x5ca1b0[_0x1f7a2a(0x245)](async _0x1bfcc1=>{const _0x4454d5=_0x1f7a2a;try{await this['bot']?.[_0x4454d5(0x217)](_0x1bfcc1[_0x4454d5(0x240)],_0x1d4a85,_0x2fda94),console[_0x4454d5(0x270)](_0x4454d5(0x2bb)+_0x1bfcc1[_0x4454d5(0x240)]);}catch(_0x153c25){console[_0x4454d5(0x280)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x1bfcc1[_0x4454d5(0x240)]+':',_0x153c25),_0x153c25 instanceof Error&&(_0x153c25[_0x4454d5(0x297)][_0x4454d5(0x21f)]('blocked')||_0x153c25[_0x4454d5(0x297)][_0x4454d5(0x21f)](_0x4454d5(0x252))||_0x153c25[_0x4454d5(0x297)][_0x4454d5(0x21f)](_0x4454d5(0x23e)))&&(await database_1[_0x4454d5(0x288)][_0x4454d5(0x220)]['update']({'where':{'id':_0x1bfcc1['id']},'data':{'isVerified':![]}}),console[_0x4454d5(0x270)](_0x4454d5(0x2b5)+_0x1bfcc1['telegramId']+_0x4454d5(0x2cb)));}});await Promise[_0x1f7a2a(0x273)](_0x43d2e3);}catch(_0x1aa3d2){console[_0x1f7a2a(0x280)](_0x1f7a2a(0x1f4),_0x1aa3d2);}}async[a55_0x57104f(0x23a)](_0x349a8b,_0x208ae4,_0x3dc9c7){const _0x2a36d0=a55_0x57104f,_0x4a2554={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x885d60={'created':_0x2a36d0(0x22a),'paid':_0x2a36d0(0x26d),'failed':'Payment\x20failed','expired':_0x2a36d0(0x2c9),'refund':_0x2a36d0(0x1f2),'chargeback':_0x2a36d0(0x209),'processing':'Payment\x20is\x20being\x20processed'},_0x35b44f=_0x4a2554[_0x3dc9c7],_0x51aa4a=_0x885d60[_0x3dc9c7],_0x5bbb50=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x208ae4[_0x2a36d0(0x205)]);console[_0x2a36d0(0x270)](_0x2a36d0(0x1e5)+_0x208ae4[_0x2a36d0(0x205)]+'\x22\x20->\x20display\x20\x22'+_0x5bbb50+'\x22');let _0x12854f=_0x35b44f+'\x20*'+_0x51aa4a+_0x2a36d0(0x21d)+(_0x2a36d0(0x257)+_0x208ae4[_0x2a36d0(0x218)]+'\x20'+_0x208ae4[_0x2a36d0(0x24b)]+'*\x0a')+(_0x2a36d0(0x26b)+(_0x208ae4['orderId']||_0x208ae4['id'])+'`\x0a')+(_0x2a36d0(0x2c3)+_0x208ae4['id']+'`\x0a')+(_0x2a36d0(0x2be)+_0x5bbb50+'`\x0a')+(_0x2a36d0(0x2b3)+new Date(_0x208ae4[_0x2a36d0(0x20f)])[_0x2a36d0(0x2aa)](_0x2a36d0(0x251))+'\x0a');if(_0x208ae4[_0x2a36d0(0x2c7)]||_0x208ae4[_0x2a36d0(0x28d)]||_0x208ae4[_0x2a36d0(0x28a)]||_0x208ae4[_0x2a36d0(0x279)]||_0x208ae4[_0x2a36d0(0x27b)]){_0x12854f+=_0x2a36d0(0x2c2);_0x208ae4[_0x2a36d0(0x2c7)]&&(_0x12854f+=_0x2a36d0(0x292)+_0x208ae4[_0x2a36d0(0x2c7)]+'`\x0a');_0x208ae4['customerEmail']&&(_0x12854f+=_0x2a36d0(0x2a1)+_0x208ae4[_0x2a36d0(0x28d)]+'`\x0a');_0x208ae4['remitterIban']&&(_0x12854f+=_0x2a36d0(0x268)+_0x208ae4[_0x2a36d0(0x28a)]+'`\x0a');_0x208ae4[_0x2a36d0(0x279)]&&(_0x12854f+='🌐\x20IP:\x20`'+_0x208ae4[_0x2a36d0(0x279)]+'`\x0a');if(_0x208ae4[_0x2a36d0(0x27b)]){const _0x1e948e=_0x208ae4[_0x2a36d0(0x27b)][_0x2a36d0(0x2ca)]>0x32?_0x208ae4[_0x2a36d0(0x27b)][_0x2a36d0(0x2bf)](0x0,0x32)+'...':_0x208ae4[_0x2a36d0(0x27b)];_0x12854f+=_0x2a36d0(0x27f)+_0x1e948e+'`\x0a';}}_0x3dc9c7==='chargeback'&&_0x208ae4['chargebackAmount']&&(_0x12854f+='💸\x20Penalty\x20amount:\x20*'+_0x208ae4[_0x2a36d0(0x2a8)]+_0x2a36d0(0x221)),_0x3dc9c7==='processing'&&(_0x12854f+=_0x2a36d0(0x2b6)),_0x208ae4['adminNotes']&&(_0x12854f+=_0x2a36d0(0x2d1)+_0x208ae4[_0x2a36d0(0x1f5)]+'\x0a'),await this[_0x2a36d0(0x28f)](_0x349a8b,_0x12854f,{'parse_mode':_0x2a36d0(0x22e)});}async[a55_0x57104f(0x253)](_0xcf0636,_0x1460a4,_0x1cc66d){const _0x3b36f2=a55_0x57104f,_0x377f40={'created':'📤','completed':'✅','rejected':'❌'},_0x52ac27={'created':'New\x20payout\x20created','completed':_0x3b36f2(0x1e8),'rejected':'Payout\x20rejected'},_0x221233=_0x377f40[_0x1cc66d],_0x119076=_0x52ac27[_0x1cc66d],_0x50308c=_0x221233+'\x20*'+_0x119076+'*\x0a\x0a'+(_0x3b36f2(0x289)+_0x1460a4['amount']+'\x20USD*\x0a')+(_0x3b36f2(0x24e)+_0x1460a4[_0x3b36f2(0x294)]+'`\x0a')+(_0x3b36f2(0x275)+_0x1460a4['id']+'`\x0a')+(_0x3b36f2(0x2b3)+new Date(_0x1460a4[_0x3b36f2(0x20f)])['toLocaleString'](_0x3b36f2(0x251))+'\x0a')+(_0x1460a4[_0x3b36f2(0x25c)]?_0x3b36f2(0x20c)+_0x1460a4['txid']+'`':'');await this[_0x3b36f2(0x28f)](_0xcf0636,_0x50308c,{'parse_mode':_0x3b36f2(0x22e)});}async[a55_0x57104f(0x2c8)](_0x4f688c,_0x2f7d8a){const _0x55d3f2=a55_0x57104f;try{const _0x1a744f=await database_1[_0x55d3f2(0x288)][_0x55d3f2(0x274)]['findUnique']({'where':{'shopId':_0x4f688c},'select':{'notificationLogin':!![]}});if(!_0x1a744f?.[_0x55d3f2(0x27a)]){console[_0x55d3f2(0x270)](_0x55d3f2(0x1e7)+_0x4f688c);return;}const _0x667df7=_0x2f7d8a[_0x55d3f2(0x291)]?'🔐':'🚨',_0x27ed2f=_0x2f7d8a[_0x55d3f2(0x291)]?_0x55d3f2(0x1fe):_0x55d3f2(0x2c4);let _0x3ae5c6=_0x667df7+'\x20*'+_0x27ed2f+_0x55d3f2(0x21d)+(_0x55d3f2(0x1e9)+_0x2f7d8a[_0x55d3f2(0x2c6)]+'`\x0a')+('📅\x20Time:\x20'+_0x2f7d8a[_0x55d3f2(0x2bc)][_0x55d3f2(0x2aa)](_0x55d3f2(0x251))+'\x0a');_0x2f7d8a[_0x55d3f2(0x26f)]&&(_0x3ae5c6+=_0x55d3f2(0x25e)+_0x2f7d8a[_0x55d3f2(0x26f)]+'`\x0a');if(_0x2f7d8a['userAgent']){const _0x43aaf7=_0x2f7d8a[_0x55d3f2(0x2cc)][_0x55d3f2(0x2ca)]>0x32?_0x2f7d8a[_0x55d3f2(0x2cc)][_0x55d3f2(0x2bf)](0x0,0x32)+_0x55d3f2(0x204):_0x2f7d8a[_0x55d3f2(0x2cc)];_0x3ae5c6+=_0x55d3f2(0x27f)+_0x43aaf7+'`\x0a';}!_0x2f7d8a[_0x55d3f2(0x291)]&&(_0x3ae5c6+=_0x55d3f2(0x23f)),await this['sendShopNotification'](_0x4f688c,_0x3ae5c6,{'parse_mode':_0x55d3f2(0x22e)}),console[_0x55d3f2(0x270)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x4f688c+':\x20'+(_0x2f7d8a[_0x55d3f2(0x291)]?'success':_0x55d3f2(0x296)));}catch(_0x9d12d6){console['error'](_0x55d3f2(0x2b8),_0x9d12d6);}}async[a55_0x57104f(0x1ff)](_0x7f7f39,_0x1419ae){const _0x506238=a55_0x57104f;try{const _0x3fbc26=await database_1[_0x506238(0x288)][_0x506238(0x274)]['findUnique']({'where':{'shopId':_0x7f7f39},'select':{'notificationApiError':!![]}});if(!_0x3fbc26?.[_0x506238(0x262)]){console[_0x506238(0x270)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x7f7f39);return;}let _0x277c63='🚨\x20*API\x20Error*\x0a\x0a'+(_0x506238(0x29e)+_0x1419ae[_0x506238(0x294)]+'\x20'+_0x1419ae['endpoint']+'`\x0a')+(_0x506238(0x222)+_0x1419ae['timestamp'][_0x506238(0x2aa)]('en-US')+'\x0a');_0x1419ae['statusCode']&&(_0x277c63+=_0x506238(0x272)+_0x1419ae[_0x506238(0x287)]+'`\x0a'),_0x277c63+=_0x506238(0x224)+_0x1419ae[_0x506238(0x263)]+'`\x0a',_0x1419ae['requestId']&&(_0x277c63+=_0x506238(0x28e)+_0x1419ae[_0x506238(0x23b)]+'`\x0a'),_0x277c63+=_0x506238(0x29c),await this['sendShopNotification'](_0x7f7f39,_0x277c63,{'parse_mode':'Markdown'}),console[_0x506238(0x270)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x7f7f39+':\x20'+_0x1419ae[_0x506238(0x285)]);}catch(_0x1dfd61){console[_0x506238(0x280)](_0x506238(0x2d0),_0x1dfd61);}}async[a55_0x57104f(0x278)](_0x4b10ab,_0x308b2f,_0x1b4a83){const _0x4fb6c1=a55_0x57104f;let _0x4aa3f5=_0x4fb6c1(0x1ea)+_0x308b2f+_0x4fb6c1(0x21d);for(const [_0x4d03bc,_0x4719a3]of Object[_0x4fb6c1(0x267)](_0x1b4a83)){_0x4719a3!==null&&_0x4719a3!==undefined&&(_0x4aa3f5+=_0x4d03bc+_0x4fb6c1(0x244)+_0x4719a3+'`\x0a');}await this[_0x4fb6c1(0x28f)](_0x4b10ab,_0x4aa3f5,{'parse_mode':_0x4fb6c1(0x22e)});}[a55_0x57104f(0x1e6)](){const _0x133da1=a55_0x57104f;return{'isActive':!!this[_0x133da1(0x210)],'username':this['botUsername']};}[a55_0x57104f(0x264)](){const _0x45b0ae=a55_0x57104f;this[_0x45b0ae(0x210)]&&(this[_0x45b0ae(0x210)]['stopPolling'](),this[_0x45b0ae(0x210)]=null,console['log'](_0x45b0ae(0x277)));}}exports[a55_0x57104f(0x2c1)]=TelegramBotService,exports[a55_0x57104f(0x202)]=new TelegramBotService();