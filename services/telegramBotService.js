'use strict';const a61_0x2c6975=a61_0x4000;(function(_0x2aa47b,_0x1a159e){const _0x2c64bd=a61_0x4000,_0x25011c=_0x2aa47b();while(!![]){try{const _0x3d84af=parseInt(_0x2c64bd(0x1a4))/0x1+-parseInt(_0x2c64bd(0x172))/0x2+parseInt(_0x2c64bd(0x1a8))/0x3+parseInt(_0x2c64bd(0x180))/0x4+parseInt(_0x2c64bd(0x154))/0x5+-parseInt(_0x2c64bd(0x16f))/0x6+parseInt(_0x2c64bd(0x147))/0x7;if(_0x3d84af===_0x1a159e)break;else _0x25011c['push'](_0x25011c['shift']());}catch(_0x581905){_0x25011c['push'](_0x25011c['shift']());}}}(a61_0x2f76,0x9c279));var __importDefault=this&&this[a61_0x2c6975(0x166)]||function(_0x2a48e9){const _0x166b2d=a61_0x2c6975;return _0x2a48e9&&_0x2a48e9[_0x166b2d(0x146)]?_0x2a48e9:{'default':_0x2a48e9};};Object['defineProperty'](exports,a61_0x2c6975(0x146),{'value':!![]}),exports[a61_0x2c6975(0x134)]=exports[a61_0x2c6975(0x16d)]=void 0x0;function a61_0x4000(_0x32c53a,_0x37be1){const _0x2f76d2=a61_0x2f76();return a61_0x4000=function(_0x4000a4,_0x159f4c){_0x4000a4=_0x4000a4-0xb8;let _0xa2edaa=_0x2f76d2[_0x4000a4];return _0xa2edaa;},a61_0x4000(_0x32c53a,_0x37be1);}const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a61_0x2c6975(0x169))),gateway_1=require(a61_0x2c6975(0xd4));class TelegramBotService{constructor(){const _0x3a424f=a61_0x2c6975;this['bot']=null,this[_0x3a424f(0xb9)]=process[_0x3a424f(0x199)][_0x3a424f(0xdb)]||'',this[_0x3a424f(0x1a1)]=process[_0x3a424f(0x199)][_0x3a424f(0x142)]||'trapay_bot',this[_0x3a424f(0xb9)]?this[_0x3a424f(0xe0)]():console[_0x3a424f(0x129)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a61_0x2c6975(0xe0)](){const _0x2e0b11=a61_0x2c6975;try{this['bot']=new node_telegram_bot_api_1[(_0x2e0b11(0x156))](this[_0x2e0b11(0xb9)],{'polling':!![]}),this[_0x2e0b11(0xe7)](),console[_0x2e0b11(0x17d)]('✅\x20Telegram\x20bot\x20@'+this[_0x2e0b11(0x1a1)]+_0x2e0b11(0x191));}catch(_0x1cb530){console[_0x2e0b11(0x195)](_0x2e0b11(0x162),_0x1cb530);}}[a61_0x2c6975(0xe7)](){const _0x249543=a61_0x2c6975;if(!this[_0x249543(0x151)])return;this[_0x249543(0x151)][_0x249543(0x167)](/\/start/,async _0x23c388=>{const _0x38b0ca=_0x249543,_0x2065f8=_0x23c388[_0x38b0ca(0x12d)]['id'],_0x296b3d=_0x23c388[_0x38b0ca(0x101)]?.['id']['toString'](),_0x359fc4=_0x23c388['from']?.[_0x38b0ca(0x18d)],_0x345334=_0x23c388[_0x38b0ca(0x101)]?.[_0x38b0ca(0x176)],_0xccef5d=_0x23c388[_0x38b0ca(0x101)]?.[_0x38b0ca(0x11c)];if(!_0x296b3d)return;try{let _0x4d9d1b=await database_1[_0x38b0ca(0x156)]['telegramUser']['findUnique']({'where':{'telegramId':_0x296b3d},'include':{'shop':!![]}});!_0x4d9d1b?(_0x4d9d1b=await database_1['default'][_0x38b0ca(0x15e)][_0x38b0ca(0xfb)]({'data':{'telegramId':_0x296b3d,'username':_0x359fc4,'firstName':_0x345334,'lastName':_0xccef5d,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x38b0ca(0x17d)](_0x38b0ca(0xde)+_0x296b3d+_0x38b0ca(0x16e)+_0x359fc4+')')):_0x4d9d1b=await database_1[_0x38b0ca(0x156)][_0x38b0ca(0x15e)]['update']({'where':{'telegramId':_0x296b3d},'data':{'username':_0x359fc4,'firstName':_0x345334,'lastName':_0xccef5d},'include':{'shop':!![]}}),_0x4d9d1b[_0x38b0ca(0x14e)]&&_0x4d9d1b[_0x38b0ca(0x1b6)]&&_0x4d9d1b['shop']?await this['bot']?.[_0x38b0ca(0x1b1)](_0x2065f8,_0x38b0ca(0x164)+(_0x38b0ca(0xd6)+_0x4d9d1b[_0x38b0ca(0x188)]['name']+'*\x0a')+(_0x38b0ca(0x120)+_0x4d9d1b[_0x38b0ca(0x188)][_0x38b0ca(0x18d)]+'`\x0a\x0a')+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x38b0ca(0xf3)+_0x38b0ca(0x12e)+_0x38b0ca(0x155)+_0x38b0ca(0xc4)+_0x38b0ca(0x15d)+_0x38b0ca(0xea),{'parse_mode':'Markdown'}):(_0x4d9d1b['shopId']&&!_0x4d9d1b[_0x38b0ca(0x14e)]&&(await database_1[_0x38b0ca(0x156)]['telegramUser'][_0x38b0ca(0x14c)]({'where':{'telegramId':_0x296b3d},'data':{'shopId':null,'isVerified':![]}}),console[_0x38b0ca(0x17d)](_0x38b0ca(0xdf)+_0x296b3d)),await this[_0x38b0ca(0x151)]?.['sendMessage'](_0x2065f8,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x38b0ca(0x141)+_0x38b0ca(0x15b)+_0x38b0ca(0xfc)+_0x38b0ca(0x17c),{'parse_mode':'Markdown'}));}catch(_0x2b70c2){console[_0x38b0ca(0x195)]('Error\x20handling\x20/start\x20command:',_0x2b70c2),await this['bot']?.[_0x38b0ca(0x1b1)](_0x2065f8,_0x38b0ca(0xcb));}}),this[_0x249543(0x151)]['onText'](/\/disconnect/,async _0x2f8f5c=>{const _0x40fe45=_0x249543,_0x108fc=_0x2f8f5c[_0x40fe45(0x12d)]['id'],_0x324bf3=_0x2f8f5c[_0x40fe45(0x101)]?.['id'][_0x40fe45(0x19c)]();if(!_0x324bf3)return;try{const _0xa25fce=await database_1['default'][_0x40fe45(0x15e)][_0x40fe45(0x123)]({'where':{'telegramId':_0x324bf3},'include':{'shop':!![]}});if(!_0xa25fce||!_0xa25fce[_0x40fe45(0x14e)]||!_0xa25fce[_0x40fe45(0x1b6)]){await this['bot']?.['sendMessage'](_0x108fc,_0x40fe45(0x11e));return;}const _0x5e6dfe=_0xa25fce[_0x40fe45(0x188)]?.[_0x40fe45(0xf8)]||'unknown\x20shop';await database_1[_0x40fe45(0x156)][_0x40fe45(0x15e)][_0x40fe45(0x14c)]({'where':{'telegramId':_0x324bf3},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x40fe45(0x1a7)+_0x324bf3+'\x20disconnected\x20from\x20shop\x20'+_0xa25fce[_0x40fe45(0x1b6)]),await this[_0x40fe45(0x151)]?.[_0x40fe45(0x1b1)](_0x108fc,_0x40fe45(0x19e)+_0x5e6dfe+_0x40fe45(0x1aa)+_0x40fe45(0x190),{'parse_mode':'Markdown'});}catch(_0x492036){console[_0x40fe45(0x195)]('Error\x20handling\x20/disconnect\x20command:',_0x492036),await this['bot']?.[_0x40fe45(0x1b1)](_0x108fc,_0x40fe45(0xcb));}}),this['bot'][_0x249543(0x167)](/\/status/,async _0x2b7a8b=>{const _0x6e7c02=_0x249543,_0x2c2260=_0x2b7a8b[_0x6e7c02(0x12d)]['id'],_0x9167a7=_0x2b7a8b[_0x6e7c02(0x101)]?.['id'][_0x6e7c02(0x19c)]();if(!_0x9167a7)return;try{const _0x20e6a1=await database_1['default'][_0x6e7c02(0x15e)][_0x6e7c02(0x123)]({'where':{'telegramId':_0x9167a7},'include':{'shop':!![]}});if(!_0x20e6a1){await this[_0x6e7c02(0x151)]?.[_0x6e7c02(0x1b1)](_0x2c2260,_0x6e7c02(0x13a)+_0x6e7c02(0x100));return;}if(!_0x20e6a1[_0x6e7c02(0x14e)]||!_0x20e6a1['shopId']||!_0x20e6a1[_0x6e7c02(0x188)]){await this['bot']?.[_0x6e7c02(0x1b1)](_0x2c2260,_0x6e7c02(0x17f)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x6e7c02(0x151)]?.[_0x6e7c02(0x1b1)](_0x2c2260,_0x6e7c02(0x174)+(_0x6e7c02(0x10a)+_0x20e6a1[_0x6e7c02(0x188)]['name']+'*\x0a')+(_0x6e7c02(0x183)+_0x20e6a1[_0x6e7c02(0x188)][_0x6e7c02(0x18d)]+'`\x0a')+(_0x6e7c02(0x138)+_0x20e6a1['updatedAt'][_0x6e7c02(0x1b0)](_0x6e7c02(0x165))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+'Commands:\x0a'+_0x6e7c02(0xea),{'parse_mode':'Markdown'});}catch(_0x46e3b7){console[_0x6e7c02(0x195)]('Error\x20handling\x20/status\x20command:',_0x46e3b7),await this['bot']?.[_0x6e7c02(0x1b1)](_0x2c2260,_0x6e7c02(0xcb));}}),this['bot'][_0x249543(0x167)](/\/debug/,async _0x30a21d=>{const _0x16595f=_0x249543,_0xe3ba26=_0x30a21d[_0x16595f(0x12d)]['id'],_0x27a230=_0x30a21d[_0x16595f(0x101)]?.['id'][_0x16595f(0x19c)]();if(!_0x27a230)return;try{const _0x30c4e4=await database_1[_0x16595f(0x156)][_0x16595f(0x188)][_0x16595f(0x12c)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x330baf=_0x16595f(0x18e);_0x330baf+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x27a230+_0x16595f(0xe3),_0x330baf+=_0x16595f(0x13b),_0x30c4e4[_0x16595f(0xce)]((_0x3b1f6c,_0xc5c820)=>{const _0x23a15a=_0x16595f;_0x330baf+=_0xc5c820+0x1+_0x23a15a(0x179)+_0x3b1f6c[_0x23a15a(0xf8)]+'*\x0a',_0x330baf+='\x20\x20\x20Username:\x20`'+_0x3b1f6c[_0x23a15a(0x18d)]+'`\x0a',_0x330baf+=_0x23a15a(0x19f)+_0x3b1f6c[_0x23a15a(0x182)]+'\x0a',_0x330baf+=_0x23a15a(0x10f)+_0x3b1f6c[_0x23a15a(0x159)]['substring'](0x0,0xf)+_0x23a15a(0x13f);}),await this[_0x16595f(0x151)]?.[_0x16595f(0x1b1)](_0xe3ba26,_0x330baf,{'parse_mode':_0x16595f(0x17e)});}catch(_0x1c95fe){console[_0x16595f(0x195)](_0x16595f(0x107),_0x1c95fe),await this['bot']?.['sendMessage'](_0xe3ba26,_0x16595f(0xd3));}}),this[_0x249543(0x151)]['on'](_0x249543(0xda),async _0x123b1e=>{const _0x561b88=_0x249543;if(_0x123b1e['text']?.[_0x561b88(0xfe)]('/'))return;const _0x2d98fd=_0x123b1e[_0x561b88(0x12d)]['id'],_0x4092d0=_0x123b1e['from']?.['id']['toString'](),_0x5eb685=_0x123b1e[_0x561b88(0x17b)]?.[_0x561b88(0x125)]();if(!_0x4092d0||!_0x5eb685)return;try{const _0x1115d1=await database_1['default'][_0x561b88(0x15e)][_0x561b88(0x123)]({'where':{'telegramId':_0x4092d0},'include':{'shop':!![]}});if(!_0x1115d1){await this[_0x561b88(0x151)]?.[_0x561b88(0x1b1)](_0x2d98fd,_0x561b88(0xec));return;}if(_0x1115d1['isVerified']&&_0x1115d1['shopId']&&_0x1115d1['shop']){await this[_0x561b88(0x151)]?.[_0x561b88(0x1b1)](_0x2d98fd,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x1115d1['shop']['name']+'*.\x0a\x0a'+_0x561b88(0x113),{'parse_mode':'Markdown'});return;}const _0x15d9b0=_0x5eb685[_0x561b88(0x14b)](/\s+/);if(_0x15d9b0[_0x561b88(0x15a)]!==0x2){await this['bot']?.[_0x561b88(0x1b1)](_0x2d98fd,_0x561b88(0x143)+_0x561b88(0x141)+_0x561b88(0x15b)+_0x561b88(0xfc)+('You\x20sent\x20'+_0x15d9b0[_0x561b88(0x15a)]+_0x561b88(0xed)+_0x15d9b0[_0x561b88(0xbf)](_0x228281=>'`'+_0x228281+'`')[_0x561b88(0xfd)](',\x20')),{'parse_mode':_0x561b88(0x17e)});return;}const [_0x29dfa4,_0x422e66]=_0x15d9b0;console[_0x561b88(0x17d)](_0x561b88(0x1a3)+_0x4092d0+_0x561b88(0x1ae)+_0x29dfa4+_0x561b88(0xf2)+_0x422e66[_0x561b88(0xfa)](0x0,0xa)+'...\x22'),await this[_0x561b88(0xf0)](_0x2d98fd,_0x4092d0,_0x29dfa4,_0x422e66);}catch(_0x1969a5){console[_0x561b88(0x195)](_0x561b88(0xc3),_0x1969a5),await this[_0x561b88(0x151)]?.['sendMessage'](_0x2d98fd,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x249543(0x151)]['on']('error',_0x496906=>{const _0x3080ce=_0x249543;console[_0x3080ce(0x195)]('Telegram\x20bot\x20error:',_0x496906);}),this[_0x249543(0x151)]['on'](_0x249543(0x194),_0xe32e42=>{const _0x602860=_0x249543;console[_0x602860(0x195)](_0x602860(0x13c),_0xe32e42);});}async[a61_0x2c6975(0xf0)](_0x5956af,_0x74fe59,_0x1bc037,_0xa36f1){const _0x2ab7d5=a61_0x2c6975;try{console[_0x2ab7d5(0x17d)](_0x2ab7d5(0x1a3)+_0x74fe59+':\x20username=\x22'+_0x1bc037+'\x22,\x20apiKey=\x22'+_0xa36f1[_0x2ab7d5(0xfa)](0x0,0xa)+_0x2ab7d5(0xe9));if(!_0x1bc037||_0x1bc037[_0x2ab7d5(0x15a)]<0x3||_0x1bc037[_0x2ab7d5(0x15a)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x2ab7d5(0x184)](_0x1bc037)){await this[_0x2ab7d5(0x151)]?.['sendMessage'](_0x5956af,_0x2ab7d5(0x121)+_0x1bc037+'`\x0a\x0a'+_0x2ab7d5(0xbc),{'parse_mode':_0x2ab7d5(0x17e)});return;}if(!_0xa36f1||!_0xa36f1['startsWith'](_0x2ab7d5(0x19d))&&!_0xa36f1['startsWith']('sk_')){await this[_0x2ab7d5(0x151)]?.['sendMessage'](_0x5956af,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x2ab7d5(0x181),{'parse_mode':_0x2ab7d5(0x17e)});return;}const _0x412800=await database_1['default'][_0x2ab7d5(0x188)][_0x2ab7d5(0x123)]({'where':{'username':_0x1bc037},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x412800){const _0x2bf242=await database_1['default'][_0x2ab7d5(0x188)][_0x2ab7d5(0x12c)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x102ba4='❌\x20Shop\x20with\x20username\x20`'+_0x1bc037+_0x2ab7d5(0x1b3);_0x2bf242['length']>0x0?(_0x102ba4+='Available\x20usernames:\x0a',_0x2bf242[_0x2ab7d5(0xce)](_0x10dca2=>{const _0x17d8ea=_0x2ab7d5;_0x102ba4+=_0x17d8ea(0x150)+_0x10dca2[_0x17d8ea(0x18d)]+_0x17d8ea(0x13d)+_0x10dca2[_0x17d8ea(0xf8)]+')\x0a';}),_0x102ba4+=_0x2ab7d5(0x14d)):_0x102ba4+=_0x2ab7d5(0x16a);await this[_0x2ab7d5(0x151)]?.[_0x2ab7d5(0x1b1)](_0x5956af,_0x102ba4,{'parse_mode':'Markdown'});return;}if(_0x412800[_0x2ab7d5(0x182)]!==_0x2ab7d5(0xeb)){await this[_0x2ab7d5(0x151)]?.['sendMessage'](_0x5956af,_0x2ab7d5(0x196)+_0x1bc037+_0x2ab7d5(0x1a5)+_0x2ab7d5(0xe4),{'parse_mode':_0x2ab7d5(0x17e)});return;}if(_0x412800[_0x2ab7d5(0x159)]!==_0xa36f1&&_0x412800[_0x2ab7d5(0xc9)]!==_0xa36f1){await this['bot']?.[_0x2ab7d5(0x1b1)](_0x5956af,_0x2ab7d5(0xd7)+_0x1bc037+_0x2ab7d5(0x11b)+_0x2ab7d5(0xbd)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x2ab7d5(0x17e)});return;}const _0x1e6ff4=await database_1[_0x2ab7d5(0x156)][_0x2ab7d5(0x15e)][_0x2ab7d5(0x187)]({'where':{'shopId':_0x412800['id'],'isVerified':!![],'telegramId':{'not':_0x74fe59}}});if(_0x1e6ff4){await this[_0x2ab7d5(0x151)]?.[_0x2ab7d5(0x1b1)](_0x5956af,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x1bc037+_0x2ab7d5(0x11b)+_0x2ab7d5(0x126),{'parse_mode':'Markdown'});return;}await database_1[_0x2ab7d5(0x156)][_0x2ab7d5(0x15e)][_0x2ab7d5(0x14c)]({'where':{'telegramId':_0x74fe59},'data':{'shopId':_0x412800['id'],'isVerified':!![]}}),await this[_0x2ab7d5(0x151)]?.[_0x2ab7d5(0x1b1)](_0x5956af,_0x2ab7d5(0x127)+_0x2ab7d5(0xba)+(_0x2ab7d5(0xbb)+_0x412800[_0x2ab7d5(0xf8)]+'*\x0a')+(_0x2ab7d5(0x183)+_0x412800[_0x2ab7d5(0x18d)]+_0x2ab7d5(0xe3))+_0x2ab7d5(0x10c)+_0x2ab7d5(0xf3)+'•\x20Payment\x20status\x20changes\x0a'+_0x2ab7d5(0x10e)+_0x2ab7d5(0xb8)+'Commands:\x0a'+_0x2ab7d5(0x15d)+_0x2ab7d5(0xea),{'parse_mode':_0x2ab7d5(0x17e)}),console[_0x2ab7d5(0x17d)](_0x2ab7d5(0x110)+_0x74fe59+_0x2ab7d5(0x163)+_0x412800['username']+_0x2ab7d5(0xc2));}catch(_0xde9533){console[_0x2ab7d5(0x195)](_0x2ab7d5(0xdd),_0xde9533),await this[_0x2ab7d5(0x151)]?.[_0x2ab7d5(0x1b1)](_0x5956af,_0x2ab7d5(0xcf));}}async[a61_0x2c6975(0x14a)](_0x506ff9,_0xf5a75c,_0x4eda10){const _0x40fa18=a61_0x2c6975;if(!this['bot']){console['warn'](_0x40fa18(0x153));return;}try{const _0x2a0ba5=await database_1[_0x40fa18(0x156)][_0x40fa18(0x15e)][_0x40fa18(0x12c)]({'where':{'shopId':_0x506ff9,'isVerified':!![]}});if(_0x2a0ba5[_0x40fa18(0x15a)]===0x0){console[_0x40fa18(0x17d)](_0x40fa18(0x115)+_0x506ff9);return;}const _0x3d2c6e=_0x2a0ba5[_0x40fa18(0xbf)](async _0x2d6abd=>{const _0x4997b7=_0x40fa18;try{await this['bot']?.[_0x4997b7(0x1b1)](_0x2d6abd[_0x4997b7(0xc7)],_0xf5a75c,_0x4eda10),console[_0x4997b7(0x17d)](_0x4997b7(0xe8)+_0x2d6abd[_0x4997b7(0xc7)]);}catch(_0xaac9df){console['error']('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x2d6abd['telegramId']+':',_0xaac9df),_0xaac9df instanceof Error&&(_0xaac9df['message'][_0x4997b7(0x158)](_0x4997b7(0x103))||_0xaac9df[_0x4997b7(0xda)][_0x4997b7(0x158)]('chat\x20not\x20found')||_0xaac9df[_0x4997b7(0xda)][_0x4997b7(0x158)](_0x4997b7(0x140)))&&(await database_1[_0x4997b7(0x156)][_0x4997b7(0x15e)][_0x4997b7(0x14c)]({'where':{'id':_0x2d6abd['id']},'data':{'isVerified':![]}}),console['log'](_0x4997b7(0x19b)+_0x2d6abd[_0x4997b7(0xc7)]+_0x4997b7(0x15f)));}});await Promise[_0x40fa18(0x1a6)](_0x3d2c6e);}catch(_0x5b2def){console[_0x40fa18(0x195)](_0x40fa18(0x111),_0x5b2def);}}async[a61_0x2c6975(0x11a)](_0x423683,_0x5577ce,_0x463934){const _0xd14c2b=a61_0x2c6975,_0x105d7e={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x4d9128={'created':_0xd14c2b(0x128),'paid':_0xd14c2b(0x130),'failed':_0xd14c2b(0x116),'expired':_0xd14c2b(0x152),'refund':_0xd14c2b(0xd8),'chargeback':'Payment\x20chargeback','processing':_0xd14c2b(0x12b)},_0x288789=_0x105d7e[_0x463934],_0x499516=_0x4d9128[_0x463934],_0x4c5fca=(0x0,gateway_1[_0xd14c2b(0x144)])(_0x5577ce[_0xd14c2b(0x137)]);console[_0xd14c2b(0x17d)](_0xd14c2b(0x122)+_0x5577ce[_0xd14c2b(0x137)]+_0xd14c2b(0x18f)+_0x4c5fca+'\x22');let _0x3bccb9=_0x288789+'\x20*'+_0x499516+'*\x0a\x0a'+('💰\x20Amount:\x20*'+_0x5577ce[_0xd14c2b(0xe1)]+'\x20'+_0x5577ce[_0xd14c2b(0x186)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x5577ce[_0xd14c2b(0x114)]||_0x5577ce['id'])+'`\x0a')+(_0xd14c2b(0x161)+_0x5577ce['id']+'`\x0a')+(_0xd14c2b(0xc6)+_0x4c5fca+'`\x0a')+(_0xd14c2b(0xd5)+new Date(_0x5577ce[_0xd14c2b(0xcc)])[_0xd14c2b(0x104)](_0xd14c2b(0x165))+'\x0a');if(_0x5577ce[_0xd14c2b(0x139)]||_0x5577ce[_0xd14c2b(0xef)]||_0x5577ce[_0xd14c2b(0x178)]||_0x5577ce[_0xd14c2b(0x175)]||_0x5577ce[_0xd14c2b(0xd1)]){_0x3bccb9+=_0xd14c2b(0x108);_0x5577ce[_0xd14c2b(0x139)]&&(_0x3bccb9+=_0xd14c2b(0x1a0)+_0x5577ce[_0xd14c2b(0x139)]+'`\x0a');_0x5577ce[_0xd14c2b(0xef)]&&(_0x3bccb9+=_0xd14c2b(0x14f)+_0x5577ce[_0xd14c2b(0xef)]+'`\x0a');_0x5577ce[_0xd14c2b(0x178)]&&(_0x3bccb9+='🏦\x20IBAN:\x20`'+_0x5577ce[_0xd14c2b(0x178)]+'`\x0a');_0x5577ce[_0xd14c2b(0x175)]&&(_0x3bccb9+=_0xd14c2b(0x119)+_0x5577ce['customerIp']+'`\x0a');if(_0x5577ce[_0xd14c2b(0xd1)]){const _0x816e9a=_0x5577ce[_0xd14c2b(0xd1)][_0xd14c2b(0x15a)]>0x32?_0x5577ce[_0xd14c2b(0xd1)]['substring'](0x0,0x32)+_0xd14c2b(0x19a):_0x5577ce[_0xd14c2b(0xd1)];_0x3bccb9+=_0xd14c2b(0x13e)+_0x816e9a+'`\x0a';}}_0x463934===_0xd14c2b(0x132)&&_0x5577ce[_0xd14c2b(0x1b2)]&&(_0x3bccb9+=_0xd14c2b(0x173)+_0x5577ce[_0xd14c2b(0x1b2)]+_0xd14c2b(0xdc)),_0x463934===_0xd14c2b(0x16c)&&(_0x3bccb9+=_0xd14c2b(0x157)),_0x5577ce[_0xd14c2b(0x18c)]&&(_0x3bccb9+=_0xd14c2b(0x12f)+_0x5577ce[_0xd14c2b(0x18c)]+'\x0a'),await this[_0xd14c2b(0x14a)](_0x423683,_0x3bccb9,{'parse_mode':_0xd14c2b(0x17e)});}async[a61_0x2c6975(0xc5)](_0x5e36fe,_0x3db054,_0x361c01){const _0x35903c=a61_0x2c6975,_0x408bcd={'created':'📤','completed':'✅','rejected':'❌'},_0x5532f6={'created':_0x35903c(0x193),'completed':_0x35903c(0x133),'rejected':_0x35903c(0xe2)},_0x15a97e=_0x408bcd[_0x361c01],_0x18c7ee=_0x5532f6[_0x361c01],_0x151b29=_0x15a97e+'\x20*'+_0x18c7ee+_0x35903c(0x160)+('💸\x20Amount:\x20*'+_0x3db054[_0x35903c(0xe1)]+_0x35903c(0x1b7))+('🏦\x20Method:\x20`'+_0x3db054[_0x35903c(0x16b)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x3db054['id']+'`\x0a')+(_0x35903c(0xd5)+new Date(_0x3db054['createdAt'])[_0x35903c(0x104)]('en-US')+'\x0a')+(_0x3db054['txid']?_0x35903c(0x11d)+_0x3db054[_0x35903c(0x1b5)]+'`':'');await this[_0x35903c(0x14a)](_0x5e36fe,_0x151b29,{'parse_mode':_0x35903c(0x17e)});}async[a61_0x2c6975(0x12a)](_0x5c1ca3,_0x137450){const _0x186c75=a61_0x2c6975;try{const _0x4495d9=await database_1[_0x186c75(0x156)][_0x186c75(0x131)][_0x186c75(0x123)]({'where':{'shopId':_0x5c1ca3},'select':{'notificationLogin':!![]}});if(!_0x4495d9?.[_0x186c75(0x135)]){console['log'](_0x186c75(0xf5)+_0x5c1ca3);return;}const _0x404e5e=_0x137450[_0x186c75(0x149)]?'🔐':'🚨',_0x5f2b29=_0x137450[_0x186c75(0x149)]?_0x186c75(0x148):_0x186c75(0x189);let _0x44af94=_0x404e5e+'\x20*'+_0x5f2b29+_0x186c75(0x160)+(_0x186c75(0x183)+_0x137450[_0x186c75(0x18d)]+'`\x0a')+(_0x186c75(0xf6)+_0x137450['timestamp'][_0x186c75(0x104)]('en-US')+'\x0a');_0x137450[_0x186c75(0x105)]&&(_0x44af94+=_0x186c75(0x145)+_0x137450[_0x186c75(0x105)]+'`\x0a');if(_0x137450[_0x186c75(0x197)]){const _0x1e2f21=_0x137450[_0x186c75(0x197)]['length']>0x32?_0x137450['userAgent'][_0x186c75(0xfa)](0x0,0x32)+'...':_0x137450[_0x186c75(0x197)];_0x44af94+='💻\x20Browser:\x20`'+_0x1e2f21+'`\x0a';}!_0x137450[_0x186c75(0x149)]&&(_0x44af94+=_0x186c75(0xbe)),await this[_0x186c75(0x14a)](_0x5c1ca3,_0x44af94,{'parse_mode':_0x186c75(0x17e)}),console[_0x186c75(0x17d)](_0x186c75(0x1ab)+_0x5c1ca3+':\x20'+(_0x137450['success']?_0x186c75(0x149):_0x186c75(0xf4)));}catch(_0x4db932){console['error']('Failed\x20to\x20send\x20login\x20notification:',_0x4db932);}}async[a61_0x2c6975(0xca)](_0x203af0,_0x246c83){const _0x1fe8c5=a61_0x2c6975;try{const _0x2af79b=await database_1[_0x1fe8c5(0x156)][_0x1fe8c5(0x131)]['findUnique']({'where':{'shopId':_0x203af0},'select':{'notificationApiError':!![]}});if(!_0x2af79b?.[_0x1fe8c5(0x198)]){console[_0x1fe8c5(0x17d)](_0x1fe8c5(0x1af)+_0x203af0);return;}let _0xdfcd6a=_0x1fe8c5(0xd9)+(_0x1fe8c5(0x192)+_0x246c83[_0x1fe8c5(0x16b)]+'\x20'+_0x246c83[_0x1fe8c5(0x15c)]+'`\x0a')+('📅\x20Time:\x20'+_0x246c83['timestamp'][_0x1fe8c5(0x104)]('en-US')+'\x0a');_0x246c83[_0x1fe8c5(0x106)]&&(_0xdfcd6a+=_0x1fe8c5(0xf1)+_0x246c83['statusCode']+'`\x0a'),_0xdfcd6a+=_0x1fe8c5(0x10b)+_0x246c83['errorMessage']+'`\x0a',_0x246c83[_0x1fe8c5(0x1a9)]&&(_0xdfcd6a+='🆔\x20Request\x20ID:\x20`'+_0x246c83[_0x1fe8c5(0x1a9)]+'`\x0a'),_0xdfcd6a+=_0x1fe8c5(0x1a2),await this[_0x1fe8c5(0x14a)](_0x203af0,_0xdfcd6a,{'parse_mode':'Markdown'}),console[_0x1fe8c5(0x17d)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x203af0+':\x20'+_0x246c83['endpoint']);}catch(_0x3c7337){console['error'](_0x1fe8c5(0xd0),_0x3c7337);}}async[a61_0x2c6975(0x170)](_0x2752f8,_0x5ce97d,_0x522878){const _0x4fd070=a61_0x2c6975;let _0x1a558b='🔔\x20*'+_0x5ce97d+_0x4fd070(0x160);for(const [_0x338420,_0x90078b]of Object['entries'](_0x522878)){_0x90078b!==null&&_0x90078b!==undefined&&(_0x1a558b+=_0x338420+_0x4fd070(0xee)+_0x90078b+'`\x0a');}await this['sendShopNotification'](_0x2752f8,_0x1a558b,{'parse_mode':_0x4fd070(0x17e)});}async[a61_0x2c6975(0x1b4)](_0x33dbec){const _0x1cb1e1=a61_0x2c6975;try{console[_0x1cb1e1(0x17d)](_0x1cb1e1(0xc0)+_0x33dbec['substring'](0x0,0x32)+'...');const _0x5e82a9=await database_1[_0x1cb1e1(0x156)][_0x1cb1e1(0x15e)]['findMany']({'select':{'telegramId':!![]}});if(_0x5e82a9[_0x1cb1e1(0x15a)]===0x0){console[_0x1cb1e1(0x17d)](_0x1cb1e1(0x168));return;}for(const _0x1b0b7b of _0x5e82a9){try{await this[_0x1cb1e1(0x151)]?.[_0x1cb1e1(0x1b1)](_0x1b0b7b[_0x1cb1e1(0xc7)],_0x33dbec,{'parse_mode':_0x1cb1e1(0x17e)});}catch(_0xfe2529){console[_0x1cb1e1(0x195)](_0x1cb1e1(0x109)+_0x1b0b7b[_0x1cb1e1(0xc7)]+':',_0xfe2529);}}console[_0x1cb1e1(0x17d)](_0x1cb1e1(0x112)+_0x5e82a9[_0x1cb1e1(0x15a)]+_0x1cb1e1(0xe5));}catch(_0x16353d){console[_0x1cb1e1(0x195)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:',_0x16353d);}}[a61_0x2c6975(0x177)](){const _0x52f522=a61_0x2c6975;return{'isActive':!!this[_0x52f522(0x151)],'username':this[_0x52f522(0x1a1)]};}async['sendShopFile'](_0x157aac,_0x314cfc,_0xb1ac5a,_0x17f03c){const _0x37f964=a61_0x2c6975;try{if(!this['bot'])return console['error'](_0x37f964(0xf7)),![];const _0xbdf1ee=await database_1['default'][_0x37f964(0x15e)][_0x37f964(0x12c)]({'where':{'shopId':_0x157aac,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0xbdf1ee[_0x37f964(0x15a)]===0x0)return console[_0x37f964(0x195)](_0x37f964(0x171)+_0x157aac),![];let _0x109763=0x0;for(const _0x5214b7 of _0xbdf1ee){try{await this['bot'][_0x37f964(0xcd)](_0x5214b7[_0x37f964(0xc7)],_0x314cfc,{},{'filename':_0xb1ac5a,'contentType':_0xb1ac5a[_0x37f964(0x11f)](_0x37f964(0x1ad))?_0x37f964(0x18b):_0xb1ac5a[_0x37f964(0x11f)](_0x37f964(0x18a))||_0xb1ac5a[_0x37f964(0x11f)](_0x37f964(0x185))?_0x37f964(0xc1):_0xb1ac5a['endsWith'](_0x37f964(0x17a))?_0x37f964(0x124):'application/octet-stream'}),_0x17f03c&&await this[_0x37f964(0x151)][_0x37f964(0x1b1)](_0x5214b7[_0x37f964(0xc7)],_0x17f03c),_0x109763++;}catch(_0x369465){console['error'](_0x37f964(0xc8)+_0x5214b7[_0x37f964(0xc7)]+':',_0x369465);}}return console[_0x37f964(0x17d)](_0x37f964(0xe6)+_0x109763+'/'+_0xbdf1ee['length']+_0x37f964(0xd2)+_0x157aac+':\x20'+_0xb1ac5a),_0x109763>0x0;}catch(_0x595387){return console['error'](_0x37f964(0x118),_0x595387),![];}}async[a61_0x2c6975(0x10d)](_0x431830,_0x47e33d){const _0x1643fc=a61_0x2c6975;try{if(!this[_0x1643fc(0x151)])return console[_0x1643fc(0x195)](_0x1643fc(0xf7)),![];return await this[_0x1643fc(0x151)][_0x1643fc(0x1b1)](_0x431830,_0x47e33d),console[_0x1643fc(0x17d)](_0x1643fc(0xff)+_0x431830),!![];}catch(_0x426a3f){return console[_0x1643fc(0x195)](_0x1643fc(0xf9),_0x426a3f),![];}}async['sendDirectFile'](_0x22c9cd,_0x5ab9e0,_0x4aadd1,_0x1cb408){const _0x383b76=a61_0x2c6975;try{if(!this[_0x383b76(0x151)])return console[_0x383b76(0x195)](_0x383b76(0xf7)),![];return await this[_0x383b76(0x151)][_0x383b76(0xcd)](_0x22c9cd,_0x5ab9e0,{},{'filename':_0x4aadd1,'contentType':_0x4aadd1[_0x383b76(0x11f)]('.png')?_0x383b76(0x18b):_0x4aadd1[_0x383b76(0x11f)](_0x383b76(0x18a))||_0x4aadd1[_0x383b76(0x11f)](_0x383b76(0x185))?_0x383b76(0xc1):_0x4aadd1[_0x383b76(0x11f)](_0x383b76(0x17a))?_0x383b76(0x124):_0x383b76(0x102)}),_0x1cb408&&await this[_0x383b76(0x151)][_0x383b76(0x1b1)](_0x22c9cd,_0x1cb408),console['log'](_0x383b76(0x136)+_0x22c9cd+':\x20'+_0x4aadd1),!![];}catch(_0x61eeac){return console[_0x383b76(0x195)](_0x383b76(0x1ac),_0x61eeac),![];}}[a61_0x2c6975(0x117)](){const _0x5a61be=a61_0x2c6975;this[_0x5a61be(0x151)]&&(this[_0x5a61be(0x151)]['stopPolling'](),this[_0x5a61be(0x151)]=null,console[_0x5a61be(0x17d)]('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a61_0x2c6975(0x16d)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();function a61_0x2f76(){const _0x2f931d=['❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','✅\x20Connected\x20to\x20shop:\x20*','❌\x20Error:\x20`','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','sendDirectMessage','•\x20Payouts\x0a','\x20\x20\x20Public\x20Key:\x20`','✅\x20Telegram\x20user\x20','Error\x20sending\x20shop\x20notification:','📱\x20Notification\x20sent\x20to\x20','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','orderId','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','Payment\x20failed','stopBot','❌\x20Error\x20sending\x20file\x20to\x20shop:','🌐\x20IP:\x20`','sendPaymentNotification','`.\x0a\x0a','last_name','🔗\x20TXID:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','endsWith','Username:\x20`','❌\x20Invalid\x20username\x20format:\x20`','📱\x20Telegram\x20notification:\x20gateway\x20\x22','findUnique','application/pdf','trim','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','🎉\x20*Congratulations!*\x0a\x0a','New\x20payment\x20created','warn','sendLoginNotification','Payment\x20is\x20being\x20processed','findMany','chat','•\x20Payment\x20status\x20changes\x0a','📝\x20Notes:\x20','Payment\x20successfully\x20paid','shopSettings','chargeback','Payout\x20completed','telegramBotService','notificationLogin','✅\x20File\x20sent\x20to\x20chat\x20','gateway','📅\x20Connection\x20date:\x20','customerName','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','🏪\x20Available\x20shops\x20in\x20system:\x0a','Telegram\x20bot\x20polling\x20error:','`\x20(','💻\x20Browser:\x20`','...`\x0a\x0a','user\x20is\x20deactivated','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','TELEGRAM_BOT_USERNAME','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','getGatewayDisplayNameForTelegram','🌐\x20IP\x20address:\x20`','__esModule','8668282AbIPEg','Successful\x20login','success','sendShopNotification','split','update','\x0aCheck\x20spelling\x20and\x20try\x20again.','isVerified','📧\x20Email:\x20`','•\x20`','bot','Payment\x20expired','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','620355bilERL','•\x20Payouts\x0a\x0a','default','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','includes','publicKey','length','Example:\x0a','endpoint','/status\x20-\x20check\x20connection\x20status\x0a','telegramUser','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','*\x0a\x0a','🆔\x20Payment\x20ID:\x20`','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','\x20verified\x20for\x20shop\x20','✅\x20Welcome\x20back!\x0a\x0a','en-US','__importDefault','onText','📱\x20No\x20active\x20Telegram\x20users\x20found','../config/database','Check\x20spelling\x20and\x20try\x20again.','method','processing','TelegramBotService','\x20(@','5323698bcwyjo','sendCustomNotification','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','1628504vcVsRS','💸\x20Penalty\x20amount:\x20*','📊\x20*Connection\x20Status*\x0a\x0a','customerIp','first_name','getBotInfo','remitterIban','.\x20*','.pdf','text','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','log','Markdown','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','2299912leAJAR','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','status','👤\x20Username:\x20`','test','.jpeg','currency','findFirst','shop','Failed\x20login\x20attempt','.jpg','image/png','adminNotes','username','🔍\x20*Debug\x20Information*\x0a\x0a','\x22\x20->\x20display\x20\x22','To\x20reconnect,\x20use\x20the\x20/start\x20command','\x20initialized\x20successfully','🔗\x20Endpoint:\x20`','New\x20payout\x20created','polling_error','error','❌\x20Shop\x20`','userAgent','notificationApiError','env','...','User\x20','toString','pk_','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','\x20\x20\x20Status:\x20','📛\x20Name:\x20`','botUsername','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','219756uLqAWh','`\x20is\x20inactive.\x0a\x0a','allSettled','🔌\x20User\x20','552039kJqWSl','requestId','*.\x0a\x0a','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','❌\x20Error\x20sending\x20file\x20to\x20chat:','.png',':\x20username=\x22','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','toLocaleDateString','sendMessage','chargebackAmount','`\x20not\x20found.\x0a\x0a','sendNotificationToAll','txid','shopId','\x20USD*\x0a','•\x20Important\x20events\x0a\x0a','botToken','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','📱\x20Shop:\x20*','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','map','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','image/jpeg','\x20via\x20single-line\x20input','Error\x20handling\x20message:','Commands:\x0a','sendPayoutNotification','🏪\x20Gateway:\x20`','telegramId','❌\x20Error\x20sending\x20file\x20to\x20user\x20','secretKey','sendApiErrorNotification','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','createdAt','sendDocument','forEach','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Failed\x20to\x20send\x20API\x20error\x20notification:','customerUa','\x20users\x20of\x20shop\x20','❌\x20Error\x20getting\x20debug\x20information.','../types/gateway','📅\x20Date:\x20','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','Payment\x20refund','🚨\x20*API\x20Error*\x0a\x0a','message','TELEGRAM_BOT_TOKEN','\x20USDT*\x0a','Error\x20in\x20handleSingleLineVerification:','📱\x20Created\x20new\x20Telegram\x20user:\x20','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','initializeBot','amount','Payout\x20rejected','`\x0a\x0a','Contact\x20administrator.','\x20users','✅\x20File\x20sent\x20to\x20','setupBotHandlers','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','...\x22','/disconnect\x20-\x20disconnect\x20from\x20notifications','ACTIVE','❌\x20Please\x20use\x20/start\x20command\x20first','\x20parts:\x20',':\x20`','customerEmail','handleSingleLineVerification','📊\x20Error\x20code:\x20`','\x22,\x20apiKey=\x22','•\x20New\x20payments\x0a','failed','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','📅\x20Time:\x20','❌\x20Telegram\x20bot\x20not\x20initialized','name','❌\x20Error\x20sending\x20direct\x20message:','substring','create','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','join','startsWith','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','Use\x20/start\x20to\x20begin.','from','application/octet-stream','blocked','toLocaleString','ipAddress','statusCode','Error\x20handling\x20/debug\x20command:','\x0a👤\x20*Customer\x20Information:*\x0a'];a61_0x2f76=function(){return _0x2f931d;};return a61_0x2f76();}