'use strict';const a55_0x40e8fb=a55_0x2f51;(function(_0x242475,_0x5f5b8c){const _0x2a4148=a55_0x2f51,_0x7f72c6=_0x242475();while(!![]){try{const _0x5c6251=parseInt(_0x2a4148(0x147))/0x1*(-parseInt(_0x2a4148(0xb3))/0x2)+parseInt(_0x2a4148(0x12d))/0x3+-parseInt(_0x2a4148(0xdd))/0x4+parseInt(_0x2a4148(0x148))/0x5+parseInt(_0x2a4148(0xf8))/0x6*(-parseInt(_0x2a4148(0x12a))/0x7)+-parseInt(_0x2a4148(0xa0))/0x8+parseInt(_0x2a4148(0xb5))/0x9;if(_0x5c6251===_0x5f5b8c)break;else _0x7f72c6['push'](_0x7f72c6['shift']());}catch(_0x36f5a5){_0x7f72c6['push'](_0x7f72c6['shift']());}}}(a55_0x11cf,0xd3bdf));var __importDefault=this&&this[a55_0x40e8fb(0xc0)]||function(_0x74ec31){const _0x2bb79c=a55_0x40e8fb;return _0x74ec31&&_0x74ec31[_0x2bb79c(0x115)]?_0x74ec31:{'default':_0x74ec31};};Object['defineProperty'](exports,a55_0x40e8fb(0x115),{'value':!![]}),exports[a55_0x40e8fb(0xaf)]=exports['TelegramBotService']=void 0x0;function a55_0x2f51(_0x5f1769,_0x5f2bae){const _0x11cffe=a55_0x11cf();return a55_0x2f51=function(_0x2f5175,_0x30f918){_0x2f5175=_0x2f5175-0x84;let _0xd98ed4=_0x11cffe[_0x2f5175];return _0xd98ed4;},a55_0x2f51(_0x5f1769,_0x5f2bae);}function a55_0x11cf(){const _0x3b2536=['sendShopNotification','updatedAt','🔌\x20User\x20','📱\x20Created\x20new\x20Telegram\x20user:\x20','../config/database','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','📅\x20Connection\x20date:\x20','💻\x20Browser:\x20`','notificationLogin','❌\x20Error\x20getting\x20debug\x20information.','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','📅\x20Time:\x20','🌐\x20IP\x20address:\x20`','1rbOaNO','5543180zvfphx','🔔\x20Notifications\x20are\x20active\x0a\x0a','shop','customerEmail','allSettled','\x22,\x20apiKey=\x22','split','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','success','Payout\x20rejected','📊\x20Error\x20code:\x20`','length','🔍\x20*Debug\x20Information*\x0a\x0a','getBotInfo','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','customerIp','\x0aCheck\x20spelling\x20and\x20try\x20again.','chat','📝\x20Order\x20ID:\x20`','gateway','Example:\x0a','ipAddress','🚨\x20*API\x20Error*\x0a\x0a','includes','txid','🔗\x20TXID:\x20`','Payment\x20expired','test','❌\x20Invalid\x20username\x20format:\x20`','📊\x20*Connection\x20Status*\x0a\x0a','Error\x20sending\x20shop\x20notification:','ACTIVE','\x0a👤\x20*Customer\x20Information:*\x0a','🔗\x20Endpoint:\x20`','✅\x20Welcome\x20back!\x0a\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','text','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','chat\x20not\x20found','notificationApiError','stopPolling','🌐\x20IP:\x20`','requestId','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','User\x20','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','substring','Failed\x20login\x20attempt','💸\x20Amount:\x20*','\x20\x20\x20Status:\x20','toString','6362696XuIgYN','sendPayoutNotification','customerName','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','Telegram\x20bot\x20error:','sendMessage','createdAt','customerUa','shopSettings','...`\x0a\x0a',':\x20username=\x22','👤\x20Username:\x20`','failed','log','toLocaleDateString','telegramBotService','💸\x20Penalty\x20amount:\x20*','Contact\x20administrator.','Payment\x20failed','1685234ocnkJc','New\x20payment\x20created','19385478thVzEL','sk_','Payout\x20completed','Commands:\x0a','isVerified','🔔\x20You\x20receive\x20notifications\x20about:\x0a','forEach','\x20USD*\x0a','remitterIban',':\x20`','findFirst','__importDefault','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','en-US','amount','❌\x20Please\x20use\x20/start\x20command\x20first','•\x20Payment\x20status\x20changes\x0a','chargebackAmount','botUsername','first_name','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','🛑\x20Telegram\x20bot\x20stopped','onText','findMany','You\x20sent\x20','\x22\x20->\x20display\x20\x22','Payment\x20is\x20being\x20processed','default','trapay_bot','from','currency','statusCode','unknown\x20shop','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','errorMessage','warn','🏪\x20Gateway:\x20`','orderId','•\x20Payouts\x0a','5189132dPDBwZ','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','💰\x20Amount:\x20*','`\x0a\x0a','/disconnect\x20-\x20disconnect\x20from\x20notifications','setupBotHandlers','Payment\x20refund','update','`\x20(','blocked','telegramId','...','status','`.\x0a\x0a','\x20\x20\x20Username:\x20`','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','userAgent','sendPaymentNotification','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','bot','📧\x20Email:\x20`','last_name','\x20verified\x20for\x20shop\x20','TELEGRAM_BOT_TOKEN','stopBot','\x20\x20\x20Public\x20Key:\x20`','Error\x20handling\x20/disconnect\x20command:','66KpqvVw','*.\x0a\x0a','Check\x20spelling\x20and\x20try\x20again.','📱\x20Your\x20Telegram\x20ID:\x20`','\x20parts:\x20','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','message','secretKey','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','🔔\x20*','toLocaleString','Markdown','chargeback','botToken','../types/gateway','sendLoginNotification','🎉\x20*Congratulations!*\x0a\x0a','\x20initialized\x20successfully','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','To\x20reconnect,\x20use\x20the\x20/start\x20command','adminNotes','Error\x20handling\x20/debug\x20command:','username','/status\x20-\x20check\x20connection\x20status\x0a','pk_','join','•\x20`','•\x20New\x20payments\x0a','__esModule','🆔\x20Payout\x20ID:\x20`','.\x20*','sendCustomNotification','📅\x20Date:\x20','method','✅\x20Telegram\x20bot\x20@','initializeBot','\x20disconnected\x20from\x20shop\x20','shopId','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','✅\x20Telegram\x20user\x20','polling_error','Username:\x20`','Use\x20/start\x20to\x20begin.','name','📱\x20Telegram\x20notification:\x20gateway\x20\x22','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','findUnique','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','map','107086mSekhe','\x20USDT*\x0a','error','2124696JcVcyO','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','Successful\x20login','Error\x20handling\x20/start\x20command:','env','Failed\x20to\x20send\x20login\x20notification:','Failed\x20to\x20send\x20API\x20error\x20notification:','`\x20not\x20found.\x0a\x0a','sendApiErrorNotification','telegramUser','handleSingleLineVerification','startsWith','🆔\x20Payment\x20ID:\x20`'];a55_0x11cf=function(){return _0x3b2536;};return a55_0x11cf();}const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a55_0x40e8fb(0x13e))),gateway_1=require(a55_0x40e8fb(0x107));class TelegramBotService{constructor(){const _0x4ce318=a55_0x40e8fb;this[_0x4ce318(0xf0)]=null,this['botToken']=process[_0x4ce318(0x131)][_0x4ce318(0xf4)]||'',this[_0x4ce318(0xc8)]=process[_0x4ce318(0x131)]['TELEGRAM_BOT_USERNAME']||_0x4ce318(0xd2),this[_0x4ce318(0x106)]?this[_0x4ce318(0x11c)]():console[_0x4ce318(0xd9)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a55_0x40e8fb(0x11c)](){const _0x4db19d=a55_0x40e8fb;try{this[_0x4db19d(0xf0)]=new node_telegram_bot_api_1[(_0x4db19d(0xd1))](this[_0x4db19d(0x106)],{'polling':!![]}),this[_0x4db19d(0xe2)](),console[_0x4db19d(0xad)](_0x4db19d(0x11b)+this['botUsername']+_0x4db19d(0x10a));}catch(_0x38f4f6){console[_0x4db19d(0x12c)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x38f4f6);}}[a55_0x40e8fb(0xe2)](){const _0x31e96d=a55_0x40e8fb;if(!this[_0x31e96d(0xf0)])return;this[_0x31e96d(0xf0)][_0x31e96d(0xcc)](/\/start/,async _0x1cf55f=>{const _0x5d4fba=_0x31e96d,_0x5991fe=_0x1cf55f[_0x5d4fba(0x15b)]['id'],_0x400d94=_0x1cf55f['from']?.['id']['toString'](),_0x5e03e7=_0x1cf55f[_0x5d4fba(0xd3)]?.[_0x5d4fba(0x10f)],_0xf97e06=_0x1cf55f[_0x5d4fba(0xd3)]?.[_0x5d4fba(0xc9)],_0x12fe49=_0x1cf55f[_0x5d4fba(0xd3)]?.[_0x5d4fba(0xf2)];if(!_0x400d94)return;try{let _0x4bef7b=await database_1['default']['telegramUser'][_0x5d4fba(0x127)]({'where':{'telegramId':_0x400d94},'include':{'shop':!![]}});!_0x4bef7b?(_0x4bef7b=await database_1[_0x5d4fba(0xd1)]['telegramUser']['create']({'data':{'telegramId':_0x400d94,'username':_0x5e03e7,'firstName':_0xf97e06,'lastName':_0x12fe49,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x5d4fba(0x13d)+_0x400d94+'\x20(@'+_0x5e03e7+')')):_0x4bef7b=await database_1['default'][_0x5d4fba(0x136)][_0x5d4fba(0xe4)]({'where':{'telegramId':_0x400d94},'data':{'username':_0x5e03e7,'firstName':_0xf97e06,'lastName':_0x12fe49},'include':{'shop':!![]}}),_0x4bef7b[_0x5d4fba(0xb9)]&&_0x4bef7b[_0x5d4fba(0x11e)]&&_0x4bef7b[_0x5d4fba(0x14a)]?await this[_0x5d4fba(0xf0)]?.[_0x5d4fba(0xa5)](_0x5991fe,_0x5d4fba(0x8f)+(_0x5d4fba(0xc2)+_0x4bef7b['shop']['name']+'*\x0a')+(_0x5d4fba(0x122)+_0x4bef7b['shop'][_0x5d4fba(0x10f)]+_0x5d4fba(0xe0))+_0x5d4fba(0xba)+_0x5d4fba(0x114)+_0x5d4fba(0xc6)+'•\x20Payouts\x0a\x0a'+'Commands:\x0a'+_0x5d4fba(0x110)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x5d4fba(0x104)}):(_0x4bef7b[_0x5d4fba(0x11e)]&&!_0x4bef7b['isVerified']&&(await database_1[_0x5d4fba(0xd1)]['telegramUser'][_0x5d4fba(0xe4)]({'where':{'telegramId':_0x400d94},'data':{'shopId':null,'isVerified':![]}}),console[_0x5d4fba(0xad)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x400d94)),await this[_0x5d4fba(0xf0)]?.[_0x5d4fba(0xa5)](_0x5991fe,_0x5d4fba(0x144)+_0x5d4fba(0xd7)+_0x5d4fba(0x13f)+_0x5d4fba(0x15e)+_0x5d4fba(0x10b)+_0x5d4fba(0xc1),{'parse_mode':'Markdown'}));}catch(_0x52f01e){console[_0x5d4fba(0x12c)](_0x5d4fba(0x130),_0x52f01e),await this['bot']?.[_0x5d4fba(0xa5)](_0x5991fe,_0x5d4fba(0x101));}}),this[_0x31e96d(0xf0)][_0x31e96d(0xcc)](/\/disconnect/,async _0x77b00f=>{const _0x2ec415=_0x31e96d,_0x5687ae=_0x77b00f[_0x2ec415(0x15b)]['id'],_0x764834=_0x77b00f['from']?.['id'][_0x2ec415(0x9f)]();if(!_0x764834)return;try{const _0x1d2d2f=await database_1[_0x2ec415(0xd1)]['telegramUser'][_0x2ec415(0x127)]({'where':{'telegramId':_0x764834},'include':{'shop':!![]}});if(!_0x1d2d2f||!_0x1d2d2f['isVerified']||!_0x1d2d2f[_0x2ec415(0x11e)]){await this['bot']?.[_0x2ec415(0xa5)](_0x5687ae,_0x2ec415(0x98));return;}const _0x2f8b30=_0x1d2d2f['shop']?.[_0x2ec415(0x124)]||_0x2ec415(0xd6);await database_1['default'][_0x2ec415(0x136)][_0x2ec415(0xe4)]({'where':{'telegramId':_0x764834},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x2ec415(0x13c)+_0x764834+_0x2ec415(0x11d)+_0x1d2d2f[_0x2ec415(0x11e)]),await this[_0x2ec415(0xf0)]?.[_0x2ec415(0xa5)](_0x5687ae,_0x2ec415(0x158)+_0x2f8b30+_0x2ec415(0xf9)+_0x2ec415(0x10c),{'parse_mode':_0x2ec415(0x104)});}catch(_0xf33496){console[_0x2ec415(0x12c)](_0x2ec415(0xf7),_0xf33496),await this['bot']?.['sendMessage'](_0x5687ae,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x31e96d(0xf0)][_0x31e96d(0xcc)](/\/status/,async _0x346789=>{const _0x3b3d2b=_0x31e96d,_0x57d306=_0x346789['chat']['id'],_0x38b707=_0x346789['from']?.['id'][_0x3b3d2b(0x9f)]();if(!_0x38b707)return;try{const _0x53a6f3=await database_1[_0x3b3d2b(0xd1)][_0x3b3d2b(0x136)][_0x3b3d2b(0x127)]({'where':{'telegramId':_0x38b707},'include':{'shop':!![]}});if(!_0x53a6f3){await this[_0x3b3d2b(0xf0)]?.[_0x3b3d2b(0xa5)](_0x57d306,_0x3b3d2b(0x100)+_0x3b3d2b(0x123));return;}if(!_0x53a6f3[_0x3b3d2b(0xb9)]||!_0x53a6f3[_0x3b3d2b(0x11e)]||!_0x53a6f3[_0x3b3d2b(0x14a)]){await this[_0x3b3d2b(0xf0)]?.[_0x3b3d2b(0xa5)](_0x57d306,_0x3b3d2b(0x151)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x3b3d2b(0xf0)]?.[_0x3b3d2b(0xa5)](_0x57d306,_0x3b3d2b(0x8a)+('✅\x20Connected\x20to\x20shop:\x20*'+_0x53a6f3[_0x3b3d2b(0x14a)][_0x3b3d2b(0x124)]+'*\x0a')+(_0x3b3d2b(0xab)+_0x53a6f3[_0x3b3d2b(0x14a)][_0x3b3d2b(0x10f)]+'`\x0a')+(_0x3b3d2b(0x140)+_0x53a6f3[_0x3b3d2b(0x13b)][_0x3b3d2b(0xae)](_0x3b3d2b(0xc3))+'\x0a\x0a')+_0x3b3d2b(0x149)+_0x3b3d2b(0xb8)+_0x3b3d2b(0xe1),{'parse_mode':_0x3b3d2b(0x104)});}catch(_0x41b125){console[_0x3b3d2b(0x12c)]('Error\x20handling\x20/status\x20command:',_0x41b125),await this['bot']?.['sendMessage'](_0x57d306,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x31e96d(0xf0)][_0x31e96d(0xcc)](/\/debug/,async _0xe25b06=>{const _0x2edda6=_0x31e96d,_0x2e8f43=_0xe25b06[_0x2edda6(0x15b)]['id'],_0x4e8074=_0xe25b06[_0x2edda6(0xd3)]?.['id']['toString']();if(!_0x4e8074)return;try{const _0x25bc7b=await database_1[_0x2edda6(0xd1)][_0x2edda6(0x14a)][_0x2edda6(0xcd)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x32d4d7=_0x2edda6(0x156);_0x32d4d7+=_0x2edda6(0xfb)+_0x4e8074+_0x2edda6(0xe0),_0x32d4d7+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x25bc7b[_0x2edda6(0xbb)]((_0x3e073a,_0x14f78b)=>{const _0x3ffc78=_0x2edda6;_0x32d4d7+=_0x14f78b+0x1+_0x3ffc78(0x117)+_0x3e073a[_0x3ffc78(0x124)]+'*\x0a',_0x32d4d7+=_0x3ffc78(0xeb)+_0x3e073a[_0x3ffc78(0x10f)]+'`\x0a',_0x32d4d7+=_0x3ffc78(0x9e)+_0x3e073a['status']+'\x0a',_0x32d4d7+=_0x3ffc78(0xf6)+_0x3e073a['publicKey'][_0x3ffc78(0x9b)](0x0,0xf)+_0x3ffc78(0xa9);}),await this[_0x2edda6(0xf0)]?.[_0x2edda6(0xa5)](_0x2e8f43,_0x32d4d7,{'parse_mode':'Markdown'});}catch(_0x4e4b3b){console[_0x2edda6(0x12c)](_0x2edda6(0x10e),_0x4e4b3b),await this[_0x2edda6(0xf0)]?.[_0x2edda6(0xa5)](_0x2e8f43,_0x2edda6(0x143));}}),this[_0x31e96d(0xf0)]['on'](_0x31e96d(0xfe),async _0x383ca0=>{const _0x3b1899=_0x31e96d;if(_0x383ca0[_0x3b1899(0x91)]?.[_0x3b1899(0x138)]('/'))return;const _0xfe58a7=_0x383ca0[_0x3b1899(0x15b)]['id'],_0x34abb3=_0x383ca0[_0x3b1899(0xd3)]?.['id'][_0x3b1899(0x9f)](),_0x5005d4=_0x383ca0[_0x3b1899(0x91)]?.['trim']();if(!_0x34abb3||!_0x5005d4)return;try{const _0x59324f=await database_1[_0x3b1899(0xd1)]['telegramUser'][_0x3b1899(0x127)]({'where':{'telegramId':_0x34abb3},'include':{'shop':!![]}});if(!_0x59324f){await this[_0x3b1899(0xf0)]?.[_0x3b1899(0xa5)](_0xfe58a7,_0x3b1899(0xc5));return;}if(_0x59324f[_0x3b1899(0xb9)]&&_0x59324f[_0x3b1899(0x11e)]&&_0x59324f[_0x3b1899(0x14a)]){await this[_0x3b1899(0xf0)]?.[_0x3b1899(0xa5)](_0xfe58a7,_0x3b1899(0xec)+_0x59324f[_0x3b1899(0x14a)][_0x3b1899(0x124)]+_0x3b1899(0xf9)+_0x3b1899(0x12e),{'parse_mode':_0x3b1899(0x104)});return;}const _0x3b31ee=_0x5005d4[_0x3b1899(0x14e)](/\s+/);if(_0x3b31ee[_0x3b1899(0x155)]!==0x2){await this[_0x3b1899(0xf0)]?.[_0x3b1899(0xa5)](_0xfe58a7,_0x3b1899(0xde)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x3b1899(0x15e)+_0x3b1899(0x10b)+(_0x3b1899(0xce)+_0x3b31ee[_0x3b1899(0x155)]+_0x3b1899(0xfc)+_0x3b31ee[_0x3b1899(0x129)](_0x4fe64f=>'`'+_0x4fe64f+'`')[_0x3b1899(0x112)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x5ded69,_0x2c7ca0]=_0x3b31ee;console[_0x3b1899(0xad)](_0x3b1899(0xca)+_0x34abb3+_0x3b1899(0xaa)+_0x5ded69+'\x22,\x20apiKey=\x22'+_0x2c7ca0[_0x3b1899(0x9b)](0x0,0xa)+'...\x22'),await this[_0x3b1899(0x137)](_0xfe58a7,_0x34abb3,_0x5ded69,_0x2c7ca0);}catch(_0x1931b3){console['error']('Error\x20handling\x20message:',_0x1931b3),await this[_0x3b1899(0xf0)]?.['sendMessage'](_0xfe58a7,_0x3b1899(0x101));}}),this[_0x31e96d(0xf0)]['on'](_0x31e96d(0x12c),_0x2ebd64=>{const _0x5a891b=_0x31e96d;console[_0x5a891b(0x12c)](_0x5a891b(0xa4),_0x2ebd64);}),this[_0x31e96d(0xf0)]['on'](_0x31e96d(0x121),_0x19d04a=>{const _0x3d4484=_0x31e96d;console[_0x3d4484(0x12c)]('Telegram\x20bot\x20polling\x20error:',_0x19d04a);});}async[a55_0x40e8fb(0x137)](_0x3dfea4,_0x2bd564,_0x3bcd44,_0x7a6977){const _0x260def=a55_0x40e8fb;try{console['log'](_0x260def(0xca)+_0x2bd564+_0x260def(0xaa)+_0x3bcd44+_0x260def(0x14d)+_0x7a6977[_0x260def(0x9b)](0x0,0xa)+'...\x22');if(!_0x3bcd44||_0x3bcd44[_0x260def(0x155)]<0x3||_0x3bcd44[_0x260def(0x155)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x260def(0x88)](_0x3bcd44)){await this['bot']?.[_0x260def(0xa5)](_0x3dfea4,_0x260def(0x89)+_0x3bcd44+'`\x0a\x0a'+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':'Markdown'});return;}if(!_0x7a6977||!_0x7a6977[_0x260def(0x138)](_0x260def(0x111))&&!_0x7a6977['startsWith'](_0x260def(0xb6))){await this[_0x260def(0xf0)]?.[_0x260def(0xa5)](_0x3dfea4,_0x260def(0x11f)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x260def(0x104)});return;}const _0x3161ac=await database_1[_0x260def(0xd1)][_0x260def(0x14a)][_0x260def(0x127)]({'where':{'username':_0x3bcd44},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x3161ac){const _0x1fd0cd=await database_1[_0x260def(0xd1)][_0x260def(0x14a)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x1f7cd1='❌\x20Shop\x20with\x20username\x20`'+_0x3bcd44+_0x260def(0x134);_0x1fd0cd[_0x260def(0x155)]>0x0?(_0x1f7cd1+='Available\x20usernames:\x0a',_0x1fd0cd['forEach'](_0x50b637=>{const _0x55c33b=_0x260def;_0x1f7cd1+=_0x55c33b(0x113)+_0x50b637[_0x55c33b(0x10f)]+_0x55c33b(0xe5)+_0x50b637['name']+')\x0a';}),_0x1f7cd1+=_0x260def(0x15a)):_0x1f7cd1+=_0x260def(0xfa);await this[_0x260def(0xf0)]?.[_0x260def(0xa5)](_0x3dfea4,_0x1f7cd1,{'parse_mode':_0x260def(0x104)});return;}if(_0x3161ac[_0x260def(0xe9)]!==_0x260def(0x8c)){await this[_0x260def(0xf0)]?.['sendMessage'](_0x3dfea4,'❌\x20Shop\x20`'+_0x3bcd44+'`\x20is\x20inactive.\x0a\x0a'+_0x260def(0xb1),{'parse_mode':_0x260def(0x104)});return;}if(_0x3161ac['publicKey']!==_0x7a6977&&_0x3161ac[_0x260def(0xff)]!==_0x7a6977){await this[_0x260def(0xf0)]?.['sendMessage'](_0x3dfea4,_0x260def(0x128)+_0x3bcd44+_0x260def(0xea)+_0x260def(0x92)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':'Markdown'});return;}const _0x2f559c=await database_1[_0x260def(0xd1)][_0x260def(0x136)][_0x260def(0xbf)]({'where':{'shopId':_0x3161ac['id'],'isVerified':!![],'telegramId':{'not':_0x2bd564}}});if(_0x2f559c){await this['bot']?.[_0x260def(0xa5)](_0x3dfea4,_0x260def(0xa3)+_0x3bcd44+_0x260def(0xea)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x260def(0x104)});return;}await database_1[_0x260def(0xd1)][_0x260def(0x136)][_0x260def(0xe4)]({'where':{'telegramId':_0x2bd564},'data':{'shopId':_0x3161ac['id'],'isVerified':!![]}}),await this[_0x260def(0xf0)]?.[_0x260def(0xa5)](_0x3dfea4,_0x260def(0x109)+_0x260def(0x150)+('📱\x20Shop:\x20*'+_0x3161ac['name']+'*\x0a')+(_0x260def(0xab)+_0x3161ac[_0x260def(0x10f)]+_0x260def(0xe0))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x260def(0xc6)+_0x260def(0xdc)+'•\x20Important\x20events\x0a\x0a'+'Commands:\x0a'+_0x260def(0x110)+_0x260def(0xe1),{'parse_mode':_0x260def(0x104)}),console[_0x260def(0xad)](_0x260def(0x120)+_0x2bd564+_0x260def(0xf3)+_0x3161ac[_0x260def(0x10f)]+'\x20via\x20single-line\x20input');}catch(_0xc0d0b1){console[_0x260def(0x12c)]('Error\x20in\x20handleSingleLineVerification:',_0xc0d0b1),await this[_0x260def(0xf0)]?.[_0x260def(0xa5)](_0x3dfea4,_0x260def(0x90));}}async[a55_0x40e8fb(0x13a)](_0x2f6d91,_0x22778a,_0x3d87a1){const _0x4b0ae9=a55_0x40e8fb;if(!this[_0x4b0ae9(0xf0)]){console[_0x4b0ae9(0xd9)](_0x4b0ae9(0x9a));return;}try{const _0x223017=await database_1['default'][_0x4b0ae9(0x136)][_0x4b0ae9(0xcd)]({'where':{'shopId':_0x2f6d91,'isVerified':!![]}});if(_0x223017[_0x4b0ae9(0x155)]===0x0){console[_0x4b0ae9(0xad)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x2f6d91);return;}const _0x341263=_0x223017[_0x4b0ae9(0x129)](async _0x2d461e=>{const _0x2104f6=_0x4b0ae9;try{await this['bot']?.[_0x2104f6(0xa5)](_0x2d461e[_0x2104f6(0xe7)],_0x22778a,_0x3d87a1),console[_0x2104f6(0xad)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x2d461e['telegramId']);}catch(_0x28433e){console[_0x2104f6(0x12c)](_0x2104f6(0xef)+_0x2d461e[_0x2104f6(0xe7)]+':',_0x28433e),_0x28433e instanceof Error&&(_0x28433e['message'][_0x2104f6(0x84)](_0x2104f6(0xe6))||_0x28433e[_0x2104f6(0xfe)][_0x2104f6(0x84)](_0x2104f6(0x93))||_0x28433e[_0x2104f6(0xfe)][_0x2104f6(0x84)]('user\x20is\x20deactivated'))&&(await database_1[_0x2104f6(0xd1)][_0x2104f6(0x136)][_0x2104f6(0xe4)]({'where':{'id':_0x2d461e['id']},'data':{'isVerified':![]}}),console[_0x2104f6(0xad)](_0x2104f6(0x99)+_0x2d461e[_0x2104f6(0xe7)]+_0x2104f6(0x126)));}});await Promise[_0x4b0ae9(0x14c)](_0x341263);}catch(_0x4293a3){console['error'](_0x4b0ae9(0x8b),_0x4293a3);}}async[a55_0x40e8fb(0xee)](_0x4d780e,_0x25e999,_0x38971c){const _0x70657=a55_0x40e8fb,_0x491b5b={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x181bb5={'created':_0x70657(0xb4),'paid':'Payment\x20successfully\x20paid','failed':_0x70657(0xb2),'expired':_0x70657(0x87),'refund':_0x70657(0xe3),'chargeback':'Payment\x20chargeback','processing':_0x70657(0xd0)},_0x1a0e01=_0x491b5b[_0x38971c],_0xc5601b=_0x181bb5[_0x38971c],_0x2f978c=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x25e999[_0x70657(0x15d)]);console['log'](_0x70657(0x125)+_0x25e999[_0x70657(0x15d)]+_0x70657(0xcf)+_0x2f978c+'\x22');let _0x3afe5c=_0x1a0e01+'\x20*'+_0xc5601b+'*\x0a\x0a'+(_0x70657(0xdf)+_0x25e999[_0x70657(0xc4)]+'\x20'+_0x25e999[_0x70657(0xd4)]+'*\x0a')+(_0x70657(0x15c)+(_0x25e999[_0x70657(0xdb)]||_0x25e999['id'])+'`\x0a')+(_0x70657(0x139)+_0x25e999['id']+'`\x0a')+(_0x70657(0xda)+_0x2f978c+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x25e999['createdAt'])['toLocaleString'](_0x70657(0xc3))+'\x0a');if(_0x25e999[_0x70657(0xa2)]||_0x25e999[_0x70657(0x14b)]||_0x25e999[_0x70657(0xbd)]||_0x25e999[_0x70657(0x159)]||_0x25e999[_0x70657(0xa7)]){_0x3afe5c+=_0x70657(0x8d);_0x25e999['customerName']&&(_0x3afe5c+='📛\x20Name:\x20`'+_0x25e999[_0x70657(0xa2)]+'`\x0a');_0x25e999[_0x70657(0x14b)]&&(_0x3afe5c+=_0x70657(0xf1)+_0x25e999[_0x70657(0x14b)]+'`\x0a');_0x25e999[_0x70657(0xbd)]&&(_0x3afe5c+='🏦\x20IBAN:\x20`'+_0x25e999[_0x70657(0xbd)]+'`\x0a');_0x25e999[_0x70657(0x159)]&&(_0x3afe5c+=_0x70657(0x96)+_0x25e999[_0x70657(0x159)]+'`\x0a');if(_0x25e999[_0x70657(0xa7)]){const _0x5276e4=_0x25e999[_0x70657(0xa7)][_0x70657(0x155)]>0x32?_0x25e999['customerUa'][_0x70657(0x9b)](0x0,0x32)+_0x70657(0xe8):_0x25e999[_0x70657(0xa7)];_0x3afe5c+=_0x70657(0x141)+_0x5276e4+'`\x0a';}}_0x38971c===_0x70657(0x105)&&_0x25e999['chargebackAmount']&&(_0x3afe5c+=_0x70657(0xb0)+_0x25e999[_0x70657(0xc7)]+_0x70657(0x12b)),_0x38971c==='processing'&&(_0x3afe5c+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x25e999[_0x70657(0x10d)]&&(_0x3afe5c+='📝\x20Notes:\x20'+_0x25e999['adminNotes']+'\x0a'),await this['sendShopNotification'](_0x4d780e,_0x3afe5c,{'parse_mode':_0x70657(0x104)});}async[a55_0x40e8fb(0xa1)](_0x4185bb,_0x48b5dc,_0x57a9ba){const _0x1a7211=a55_0x40e8fb,_0x53b2c5={'created':'📤','completed':'✅','rejected':'❌'},_0x27ebb3={'created':'New\x20payout\x20created','completed':_0x1a7211(0xb7),'rejected':_0x1a7211(0x153)},_0x484c05=_0x53b2c5[_0x57a9ba],_0x189acc=_0x27ebb3[_0x57a9ba],_0x3be1df=_0x484c05+'\x20*'+_0x189acc+'*\x0a\x0a'+(_0x1a7211(0x9d)+_0x48b5dc[_0x1a7211(0xc4)]+_0x1a7211(0xbc))+('🏦\x20Method:\x20`'+_0x48b5dc[_0x1a7211(0x11a)]+'`\x0a')+(_0x1a7211(0x116)+_0x48b5dc['id']+'`\x0a')+(_0x1a7211(0x119)+new Date(_0x48b5dc[_0x1a7211(0xa6)])['toLocaleString'](_0x1a7211(0xc3))+'\x0a')+(_0x48b5dc[_0x1a7211(0x85)]?_0x1a7211(0x86)+_0x48b5dc[_0x1a7211(0x85)]+'`':'');await this[_0x1a7211(0x13a)](_0x4185bb,_0x3be1df,{'parse_mode':'Markdown'});}async[a55_0x40e8fb(0x108)](_0x48d4ef,_0x4715ac){const _0x3dafc8=a55_0x40e8fb;try{const _0x422260=await database_1[_0x3dafc8(0xd1)]['shopSettings'][_0x3dafc8(0x127)]({'where':{'shopId':_0x48d4ef},'select':{'notificationLogin':!![]}});if(!_0x422260?.[_0x3dafc8(0x142)]){console[_0x3dafc8(0xad)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x48d4ef);return;}const _0xa336c9=_0x4715ac[_0x3dafc8(0x152)]?'🔐':'🚨',_0x564cb=_0x4715ac[_0x3dafc8(0x152)]?_0x3dafc8(0x12f):_0x3dafc8(0x9c);let _0x9cab9f=_0xa336c9+'\x20*'+_0x564cb+'*\x0a\x0a'+(_0x3dafc8(0xab)+_0x4715ac[_0x3dafc8(0x10f)]+'`\x0a')+(_0x3dafc8(0x145)+_0x4715ac['timestamp'][_0x3dafc8(0x103)]('en-US')+'\x0a');_0x4715ac['ipAddress']&&(_0x9cab9f+=_0x3dafc8(0x146)+_0x4715ac[_0x3dafc8(0x15f)]+'`\x0a');if(_0x4715ac['userAgent']){const _0x5b330f=_0x4715ac[_0x3dafc8(0xed)][_0x3dafc8(0x155)]>0x32?_0x4715ac['userAgent'][_0x3dafc8(0x9b)](0x0,0x32)+_0x3dafc8(0xe8):_0x4715ac[_0x3dafc8(0xed)];_0x9cab9f+=_0x3dafc8(0x141)+_0x5b330f+'`\x0a';}!_0x4715ac['success']&&(_0x9cab9f+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x3dafc8(0x13a)](_0x48d4ef,_0x9cab9f,{'parse_mode':_0x3dafc8(0x104)}),console[_0x3dafc8(0xad)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x48d4ef+':\x20'+(_0x4715ac[_0x3dafc8(0x152)]?_0x3dafc8(0x152):_0x3dafc8(0xac)));}catch(_0x500a14){console[_0x3dafc8(0x12c)](_0x3dafc8(0x132),_0x500a14);}}async[a55_0x40e8fb(0x135)](_0x41961d,_0x54be7b){const _0x2e83a0=a55_0x40e8fb;try{const _0xa4127d=await database_1[_0x2e83a0(0xd1)][_0x2e83a0(0xa8)]['findUnique']({'where':{'shopId':_0x41961d},'select':{'notificationApiError':!![]}});if(!_0xa4127d?.[_0x2e83a0(0x94)]){console[_0x2e83a0(0xad)](_0x2e83a0(0x14f)+_0x41961d);return;}let _0x3506fe=_0x2e83a0(0x160)+(_0x2e83a0(0x8e)+_0x54be7b[_0x2e83a0(0x11a)]+'\x20'+_0x54be7b['endpoint']+'`\x0a')+('📅\x20Time:\x20'+_0x54be7b['timestamp']['toLocaleString']('en-US')+'\x0a');_0x54be7b[_0x2e83a0(0xd5)]&&(_0x3506fe+=_0x2e83a0(0x154)+_0x54be7b[_0x2e83a0(0xd5)]+'`\x0a'),_0x3506fe+='❌\x20Error:\x20`'+_0x54be7b[_0x2e83a0(0xd8)]+'`\x0a',_0x54be7b[_0x2e83a0(0x97)]&&(_0x3506fe+='🆔\x20Request\x20ID:\x20`'+_0x54be7b['requestId']+'`\x0a'),_0x3506fe+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x2e83a0(0x13a)](_0x41961d,_0x3506fe,{'parse_mode':_0x2e83a0(0x104)}),console[_0x2e83a0(0xad)](_0x2e83a0(0xfd)+_0x41961d+':\x20'+_0x54be7b['endpoint']);}catch(_0xedc5a3){console[_0x2e83a0(0x12c)](_0x2e83a0(0x133),_0xedc5a3);}}async[a55_0x40e8fb(0x118)](_0x327b90,_0x150182,_0xa61294){const _0x4ee227=a55_0x40e8fb;let _0x439396=_0x4ee227(0x102)+_0x150182+'*\x0a\x0a';for(const [_0x668469,_0x33fee1]of Object['entries'](_0xa61294)){_0x33fee1!==null&&_0x33fee1!==undefined&&(_0x439396+=_0x668469+_0x4ee227(0xbe)+_0x33fee1+'`\x0a');}await this['sendShopNotification'](_0x327b90,_0x439396,{'parse_mode':_0x4ee227(0x104)});}[a55_0x40e8fb(0x157)](){const _0x3b48d7=a55_0x40e8fb;return{'isActive':!!this[_0x3b48d7(0xf0)],'username':this['botUsername']};}[a55_0x40e8fb(0xf5)](){const _0x5cd4b0=a55_0x40e8fb;this['bot']&&(this[_0x5cd4b0(0xf0)][_0x5cd4b0(0x95)](),this[_0x5cd4b0(0xf0)]=null,console[_0x5cd4b0(0xad)](_0x5cd4b0(0xcb)));}}exports['TelegramBotService']=TelegramBotService,exports['telegramBotService']=new TelegramBotService();