'use strict';function a54_0x1f09(_0x998822,_0x4c8202){const _0x490660=a54_0x4906();return a54_0x1f09=function(_0x1f09c7,_0x4f7e7c){_0x1f09c7=_0x1f09c7-0x11c;let _0x30eae3=_0x490660[_0x1f09c7];return _0x30eae3;},a54_0x1f09(_0x998822,_0x4c8202);}const a54_0x15dc2d=a54_0x1f09;(function(_0x697972,_0x5a01ae){const _0xcc14cb=a54_0x1f09,_0x1477e0=_0x697972();while(!![]){try{const _0x257331=-parseInt(_0xcc14cb(0x120))/0x1*(parseInt(_0xcc14cb(0x166))/0x2)+parseInt(_0xcc14cb(0x15e))/0x3*(-parseInt(_0xcc14cb(0x1e3))/0x4)+parseInt(_0xcc14cb(0x183))/0x5+parseInt(_0xcc14cb(0x1af))/0x6+-parseInt(_0xcc14cb(0x1c2))/0x7*(parseInt(_0xcc14cb(0x1e5))/0x8)+-parseInt(_0xcc14cb(0x1c5))/0x9*(-parseInt(_0xcc14cb(0x19c))/0xa)+parseInt(_0xcc14cb(0x1c9))/0xb;if(_0x257331===_0x5a01ae)break;else _0x1477e0['push'](_0x1477e0['shift']());}catch(_0x2646f5){_0x1477e0['push'](_0x1477e0['shift']());}}}(a54_0x4906,0x1be3e));var __importDefault=this&&this['__importDefault']||function(_0x143546){const _0x2960f1=a54_0x1f09;return _0x143546&&_0x143546[_0x2960f1(0x172)]?_0x143546:{'default':_0x143546};};Object[a54_0x15dc2d(0x1a8)](exports,a54_0x15dc2d(0x172),{'value':!![]}),exports['telegramBotService']=exports[a54_0x15dc2d(0x162)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a54_0x15dc2d(0x17e))),gateway_1=require(a54_0x15dc2d(0x155));class TelegramBotService{constructor(){const _0x4e8b73=a54_0x15dc2d;this[_0x4e8b73(0x133)]=null,this['botToken']=process[_0x4e8b73(0x142)][_0x4e8b73(0x1a9)]||'',this[_0x4e8b73(0x1b3)]=process[_0x4e8b73(0x142)]['TELEGRAM_BOT_USERNAME']||'trapay_bot',this[_0x4e8b73(0x125)]?this[_0x4e8b73(0x1d6)]():console[_0x4e8b73(0x14f)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}['initializeBot'](){const _0x54ef8b=a54_0x15dc2d;try{this[_0x54ef8b(0x133)]=new node_telegram_bot_api_1[(_0x54ef8b(0x1eb))](this[_0x54ef8b(0x125)],{'polling':!![]}),this[_0x54ef8b(0x196)](),console[_0x54ef8b(0x128)](_0x54ef8b(0x158)+this['botUsername']+_0x54ef8b(0x1d8));}catch(_0x1e848a){console[_0x54ef8b(0x122)](_0x54ef8b(0x131),_0x1e848a);}}[a54_0x15dc2d(0x196)](){const _0x2e5f14=a54_0x15dc2d;if(!this['bot'])return;this[_0x2e5f14(0x133)][_0x2e5f14(0x1d4)](/\/start/,async _0x358eae=>{const _0x103ce6=_0x2e5f14,_0x1d129f=_0x358eae[_0x103ce6(0x1e9)]['id'],_0xc5430c=_0x358eae[_0x103ce6(0x1d0)]?.['id'][_0x103ce6(0x168)](),_0x287b02=_0x358eae['from']?.[_0x103ce6(0x192)],_0x33219a=_0x358eae[_0x103ce6(0x1d0)]?.[_0x103ce6(0x1d5)],_0xc98025=_0x358eae['from']?.[_0x103ce6(0x186)];if(!_0xc5430c)return;try{let _0x4d1703=await database_1['default'][_0x103ce6(0x123)][_0x103ce6(0x11d)]({'where':{'telegramId':_0xc5430c},'include':{'shop':!![]}});!_0x4d1703?(_0x4d1703=await database_1[_0x103ce6(0x1eb)][_0x103ce6(0x123)][_0x103ce6(0x16b)]({'data':{'telegramId':_0xc5430c,'username':_0x287b02,'firstName':_0x33219a,'lastName':_0xc98025,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x103ce6(0x128)](_0x103ce6(0x159)+_0xc5430c+'\x20(@'+_0x287b02+')')):_0x4d1703=await database_1[_0x103ce6(0x1eb)][_0x103ce6(0x123)][_0x103ce6(0x15b)]({'where':{'telegramId':_0xc5430c},'data':{'username':_0x287b02,'firstName':_0x33219a,'lastName':_0xc98025},'include':{'shop':!![]}}),_0x4d1703[_0x103ce6(0x126)]&&_0x4d1703[_0x103ce6(0x137)]&&_0x4d1703[_0x103ce6(0x1a0)]?await this['bot']?.[_0x103ce6(0x1be)](_0x1d129f,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x103ce6(0x1bc)+_0x4d1703[_0x103ce6(0x1a0)][_0x103ce6(0x17c)]+'*\x0a')+(_0x103ce6(0x17a)+_0x4d1703['shop']['username']+'`\x0a\x0a')+_0x103ce6(0x13c)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+_0x103ce6(0x1bf)+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x103ce6(0x1aa),{'parse_mode':_0x103ce6(0x16a)}):(_0x4d1703[_0x103ce6(0x137)]&&!_0x4d1703['isVerified']&&(await database_1['default'][_0x103ce6(0x123)][_0x103ce6(0x15b)]({'where':{'telegramId':_0xc5430c},'data':{'shopId':null,'isVerified':![]}}),console[_0x103ce6(0x128)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0xc5430c)),await this[_0x103ce6(0x133)]?.[_0x103ce6(0x1be)](_0x1d129f,_0x103ce6(0x13e)+_0x103ce6(0x1f0)+_0x103ce6(0x12c)+_0x103ce6(0x1ac)+_0x103ce6(0x152)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x103ce6(0x16a)}));}catch(_0x1fb645){console['error']('Error\x20handling\x20/start\x20command:',_0x1fb645),await this[_0x103ce6(0x133)]?.['sendMessage'](_0x1d129f,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x2e5f14(0x133)][_0x2e5f14(0x1d4)](/\/disconnect/,async _0x5d60e6=>{const _0x4c46eb=_0x2e5f14,_0x2013a5=_0x5d60e6['chat']['id'],_0xf0f983=_0x5d60e6['from']?.['id'][_0x4c46eb(0x168)]();if(!_0xf0f983)return;try{const _0xdd29f3=await database_1['default'][_0x4c46eb(0x123)][_0x4c46eb(0x11d)]({'where':{'telegramId':_0xf0f983},'include':{'shop':!![]}});if(!_0xdd29f3||!_0xdd29f3[_0x4c46eb(0x126)]||!_0xdd29f3[_0x4c46eb(0x137)]){await this['bot']?.[_0x4c46eb(0x1be)](_0x2013a5,_0x4c46eb(0x1b4));return;}const _0x48cf38=_0xdd29f3[_0x4c46eb(0x1a0)]?.[_0x4c46eb(0x17c)]||_0x4c46eb(0x1bb);await database_1[_0x4c46eb(0x1eb)][_0x4c46eb(0x123)][_0x4c46eb(0x15b)]({'where':{'telegramId':_0xf0f983},'data':{'shopId':null,'isVerified':![]}}),console[_0x4c46eb(0x128)]('🔌\x20User\x20'+_0xf0f983+'\x20disconnected\x20from\x20shop\x20'+_0xdd29f3[_0x4c46eb(0x137)]),await this[_0x4c46eb(0x133)]?.[_0x4c46eb(0x1be)](_0x2013a5,_0x4c46eb(0x15d)+_0x48cf38+'*.\x0a\x0a'+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x4c46eb(0x16a)});}catch(_0x360203){console[_0x4c46eb(0x122)]('Error\x20handling\x20/disconnect\x20command:',_0x360203),await this['bot']?.[_0x4c46eb(0x1be)](_0x2013a5,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x2e5f14(0x133)][_0x2e5f14(0x1d4)](/\/status/,async _0x3dc9f5=>{const _0x3488ec=_0x2e5f14,_0x369352=_0x3dc9f5[_0x3488ec(0x1e9)]['id'],_0x4f1d8a=_0x3dc9f5['from']?.['id'][_0x3488ec(0x168)]();if(!_0x4f1d8a)return;try{const _0x1accc5=await database_1['default']['telegramUser'][_0x3488ec(0x11d)]({'where':{'telegramId':_0x4f1d8a},'include':{'shop':!![]}});if(!_0x1accc5){await this[_0x3488ec(0x133)]?.['sendMessage'](_0x369352,_0x3488ec(0x1de)+_0x3488ec(0x140));return;}if(!_0x1accc5[_0x3488ec(0x126)]||!_0x1accc5[_0x3488ec(0x137)]||!_0x1accc5[_0x3488ec(0x1a0)]){await this['bot']?.[_0x3488ec(0x1be)](_0x369352,_0x3488ec(0x1b8)+_0x3488ec(0x136));return;}await this['bot']?.[_0x3488ec(0x1be)](_0x369352,_0x3488ec(0x12f)+(_0x3488ec(0x188)+_0x1accc5[_0x3488ec(0x1a0)]['name']+'*\x0a')+('👤\x20Username:\x20`'+_0x1accc5['shop'][_0x3488ec(0x192)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x1accc5[_0x3488ec(0x1ee)][_0x3488ec(0x18c)]('en-US')+'\x0a\x0a')+_0x3488ec(0x13a)+_0x3488ec(0x14d)+_0x3488ec(0x1aa),{'parse_mode':'Markdown'});}catch(_0x562a7b){console[_0x3488ec(0x122)](_0x3488ec(0x1bd),_0x562a7b),await this[_0x3488ec(0x133)]?.[_0x3488ec(0x1be)](_0x369352,_0x3488ec(0x1a5));}}),this['bot'][_0x2e5f14(0x1d4)](/\/debug/,async _0x2567b6=>{const _0x1b355a=_0x2e5f14,_0x180880=_0x2567b6[_0x1b355a(0x1e9)]['id'],_0x6a9fed=_0x2567b6['from']?.['id'][_0x1b355a(0x168)]();if(!_0x6a9fed)return;try{const _0x4e5f42=await database_1['default'][_0x1b355a(0x1a0)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0xd231f4=_0x1b355a(0x12d);_0xd231f4+=_0x1b355a(0x156)+_0x6a9fed+_0x1b355a(0x1db),_0xd231f4+=_0x1b355a(0x129),_0x4e5f42['forEach']((_0x340ede,_0x26e182)=>{const _0x4e59db=_0x1b355a;_0xd231f4+=_0x26e182+0x1+_0x4e59db(0x1ea)+_0x340ede['name']+'*\x0a',_0xd231f4+=_0x4e59db(0x18a)+_0x340ede['username']+'`\x0a',_0xd231f4+=_0x4e59db(0x160)+_0x340ede[_0x4e59db(0x1ed)]+'\x0a',_0xd231f4+=_0x4e59db(0x195)+_0x340ede[_0x4e59db(0x191)]['substring'](0x0,0xf)+_0x4e59db(0x19a);}),await this[_0x1b355a(0x133)]?.[_0x1b355a(0x1be)](_0x180880,_0xd231f4,{'parse_mode':_0x1b355a(0x16a)});}catch(_0x2c32cc){console[_0x1b355a(0x122)]('Error\x20handling\x20/debug\x20command:',_0x2c32cc),await this['bot']?.[_0x1b355a(0x1be)](_0x180880,_0x1b355a(0x127));}}),this['bot']['on'](_0x2e5f14(0x199),async _0x4245b5=>{const _0x5c4477=_0x2e5f14;if(_0x4245b5[_0x5c4477(0x1d2)]?.['startsWith']('/'))return;const _0xaf88db=_0x4245b5[_0x5c4477(0x1e9)]['id'],_0x47a491=_0x4245b5[_0x5c4477(0x1d0)]?.['id'][_0x5c4477(0x168)](),_0x433458=_0x4245b5[_0x5c4477(0x1d2)]?.[_0x5c4477(0x1e6)]();if(!_0x47a491||!_0x433458)return;try{const _0x2b719f=await database_1[_0x5c4477(0x1eb)][_0x5c4477(0x123)][_0x5c4477(0x11d)]({'where':{'telegramId':_0x47a491},'include':{'shop':!![]}});if(!_0x2b719f){await this['bot']?.['sendMessage'](_0xaf88db,_0x5c4477(0x19f));return;}if(_0x2b719f[_0x5c4477(0x126)]&&_0x2b719f[_0x5c4477(0x137)]&&_0x2b719f[_0x5c4477(0x1a0)]){await this[_0x5c4477(0x133)]?.[_0x5c4477(0x1be)](_0xaf88db,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x2b719f[_0x5c4477(0x1a0)][_0x5c4477(0x17c)]+_0x5c4477(0x1e2)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x5c4477(0x16a)});return;}const _0x4cb77a=_0x433458[_0x5c4477(0x185)](/\s+/);if(_0x4cb77a[_0x5c4477(0x14b)]!==0x2){await this[_0x5c4477(0x133)]?.[_0x5c4477(0x1be)](_0xaf88db,_0x5c4477(0x1d9)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x5c4477(0x1ac)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x5c4477(0x1e8)+_0x4cb77a[_0x5c4477(0x14b)]+_0x5c4477(0x187)+_0x4cb77a[_0x5c4477(0x182)](_0x9f1194=>'`'+_0x9f1194+'`')[_0x5c4477(0x1d7)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x5da1de,_0x691f72]=_0x4cb77a;console[_0x5c4477(0x128)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x47a491+_0x5c4477(0x1e7)+_0x5da1de+'\x22,\x20apiKey=\x22'+_0x691f72[_0x5c4477(0x1ef)](0x0,0xa)+_0x5c4477(0x154)),await this[_0x5c4477(0x1b7)](_0xaf88db,_0x47a491,_0x5da1de,_0x691f72);}catch(_0x4903f3){console['error'](_0x5c4477(0x194),_0x4903f3),await this[_0x5c4477(0x133)]?.[_0x5c4477(0x1be)](_0xaf88db,_0x5c4477(0x1a5));}}),this[_0x2e5f14(0x133)]['on'](_0x2e5f14(0x122),_0x1d27aa=>{const _0x527344=_0x2e5f14;console[_0x527344(0x122)](_0x527344(0x11e),_0x1d27aa);}),this[_0x2e5f14(0x133)]['on'](_0x2e5f14(0x141),_0x2321a2=>{const _0x46d86a=_0x2e5f14;console[_0x46d86a(0x122)]('Telegram\x20bot\x20polling\x20error:',_0x2321a2);});}async[a54_0x15dc2d(0x1b7)](_0x5d3e01,_0x29b1ac,_0x3b68b9,_0x2958db){const _0x2fb42e=a54_0x15dc2d;try{console[_0x2fb42e(0x128)](_0x2fb42e(0x16c)+_0x29b1ac+':\x20username=\x22'+_0x3b68b9+'\x22,\x20apiKey=\x22'+_0x2958db[_0x2fb42e(0x1ef)](0x0,0xa)+'...\x22');if(!_0x3b68b9||_0x3b68b9['length']<0x3||_0x3b68b9[_0x2fb42e(0x14b)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x3b68b9)){await this[_0x2fb42e(0x133)]?.[_0x2fb42e(0x1be)](_0x5d3e01,_0x2fb42e(0x1c4)+_0x3b68b9+_0x2fb42e(0x1db)+_0x2fb42e(0x197),{'parse_mode':_0x2fb42e(0x16a)});return;}if(!_0x2958db||!_0x2958db['startsWith'](_0x2fb42e(0x1e4))&&!_0x2958db['startsWith'](_0x2fb42e(0x18d))){await this[_0x2fb42e(0x133)]?.['sendMessage'](_0x5d3e01,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x2fb42e(0x121),{'parse_mode':_0x2fb42e(0x16a)});return;}const _0x22cd71=await database_1[_0x2fb42e(0x1eb)][_0x2fb42e(0x1a0)]['findUnique']({'where':{'username':_0x3b68b9},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x22cd71){const _0xba48b0=await database_1['default'][_0x2fb42e(0x1a0)][_0x2fb42e(0x1b1)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x52b8ea=_0x2fb42e(0x132)+_0x3b68b9+_0x2fb42e(0x1a1);_0xba48b0[_0x2fb42e(0x14b)]>0x0?(_0x52b8ea+=_0x2fb42e(0x1c6),_0xba48b0[_0x2fb42e(0x19b)](_0x76d98f=>{const _0x3e0322=_0x2fb42e;_0x52b8ea+=_0x3e0322(0x173)+_0x76d98f[_0x3e0322(0x192)]+_0x3e0322(0x1df)+_0x76d98f[_0x3e0322(0x17c)]+')\x0a';}),_0x52b8ea+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x52b8ea+=_0x2fb42e(0x1ae);await this['bot']?.['sendMessage'](_0x5d3e01,_0x52b8ea,{'parse_mode':'Markdown'});return;}if(_0x22cd71[_0x2fb42e(0x1ed)]!==_0x2fb42e(0x130)){await this[_0x2fb42e(0x133)]?.[_0x2fb42e(0x1be)](_0x5d3e01,_0x2fb42e(0x18f)+_0x3b68b9+'`\x20is\x20inactive.\x0a\x0a'+_0x2fb42e(0x149),{'parse_mode':'Markdown'});return;}if(_0x22cd71[_0x2fb42e(0x191)]!==_0x2958db&&_0x22cd71[_0x2fb42e(0x178)]!==_0x2958db){await this[_0x2fb42e(0x133)]?.['sendMessage'](_0x5d3e01,_0x2fb42e(0x1c8)+_0x3b68b9+_0x2fb42e(0x18e)+_0x2fb42e(0x1d1)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':'Markdown'});return;}const _0x287418=await database_1['default'][_0x2fb42e(0x123)][_0x2fb42e(0x11f)]({'where':{'shopId':_0x22cd71['id'],'isVerified':!![],'telegramId':{'not':_0x29b1ac}}});if(_0x287418){await this[_0x2fb42e(0x133)]?.[_0x2fb42e(0x1be)](_0x5d3e01,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x3b68b9+_0x2fb42e(0x18e)+_0x2fb42e(0x1cd),{'parse_mode':_0x2fb42e(0x16a)});return;}await database_1[_0x2fb42e(0x1eb)]['telegramUser'][_0x2fb42e(0x15b)]({'where':{'telegramId':_0x29b1ac},'data':{'shopId':_0x22cd71['id'],'isVerified':!![]}}),await this['bot']?.['sendMessage'](_0x5d3e01,'🎉\x20*Congratulations!*\x0a\x0a'+_0x2fb42e(0x1c1)+(_0x2fb42e(0x19d)+_0x22cd71[_0x2fb42e(0x17c)]+'*\x0a')+(_0x2fb42e(0x16f)+_0x22cd71[_0x2fb42e(0x192)]+_0x2fb42e(0x1db))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x2fb42e(0x124)+'•\x20Payouts\x0a'+'•\x20Important\x20events\x0a\x0a'+_0x2fb42e(0x14d)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x2fb42e(0x1aa),{'parse_mode':_0x2fb42e(0x16a)}),console[_0x2fb42e(0x128)](_0x2fb42e(0x161)+_0x29b1ac+'\x20verified\x20for\x20shop\x20'+_0x22cd71[_0x2fb42e(0x192)]+_0x2fb42e(0x1da));}catch(_0x46556d){console[_0x2fb42e(0x122)]('Error\x20in\x20handleSingleLineVerification:',_0x46556d),await this['bot']?.[_0x2fb42e(0x1be)](_0x5d3e01,_0x2fb42e(0x148));}}async[a54_0x15dc2d(0x1b9)](_0x2fe14b,_0x1b511c,_0x12cf99){const _0x221740=a54_0x15dc2d;if(!this[_0x221740(0x133)]){console[_0x221740(0x14f)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x37cf91=await database_1[_0x221740(0x1eb)][_0x221740(0x123)][_0x221740(0x1b1)]({'where':{'shopId':_0x2fe14b,'isVerified':!![]}});if(_0x37cf91[_0x221740(0x14b)]===0x0){console[_0x221740(0x128)](_0x221740(0x14e)+_0x2fe14b);return;}const _0x171d44=_0x37cf91[_0x221740(0x182)](async _0x53745f=>{const _0x3774df=_0x221740;try{await this[_0x3774df(0x133)]?.[_0x3774df(0x1be)](_0x53745f[_0x3774df(0x198)],_0x1b511c,_0x12cf99),console['log']('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x53745f[_0x3774df(0x198)]);}catch(_0x324ba6){console[_0x3774df(0x122)](_0x3774df(0x1e1)+_0x53745f[_0x3774df(0x198)]+':',_0x324ba6),_0x324ba6 instanceof Error&&(_0x324ba6[_0x3774df(0x199)][_0x3774df(0x1ce)](_0x3774df(0x1a3))||_0x324ba6[_0x3774df(0x199)][_0x3774df(0x1ce)](_0x3774df(0x1cf))||_0x324ba6[_0x3774df(0x199)][_0x3774df(0x1ce)]('user\x20is\x20deactivated'))&&(await database_1['default'][_0x3774df(0x123)][_0x3774df(0x15b)]({'where':{'id':_0x53745f['id']},'data':{'isVerified':![]}}),console[_0x3774df(0x128)](_0x3774df(0x14a)+_0x53745f[_0x3774df(0x198)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise['allSettled'](_0x171d44);}catch(_0x97e11e){console['error'](_0x221740(0x1b6),_0x97e11e);}}async[a54_0x15dc2d(0x1b5)](_0x3a1976,_0xa2adf7,_0x4c9a2c){const _0x4b159f=a54_0x15dc2d,_0x17eb64={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x281bec={'created':_0x4b159f(0x184),'paid':_0x4b159f(0x18b),'failed':_0x4b159f(0x135),'expired':'Payment\x20expired','refund':'Payment\x20refund','chargeback':'Payment\x20chargeback','processing':'Payment\x20is\x20being\x20processed'},_0x8a6305=_0x17eb64[_0x4c9a2c],_0xb5b293=_0x281bec[_0x4c9a2c],_0x110a27=(0x0,gateway_1[_0x4b159f(0x1a7)])(_0xa2adf7[_0x4b159f(0x176)]);console['log']('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0xa2adf7[_0x4b159f(0x176)]+_0x4b159f(0x13d)+_0x110a27+'\x22');let _0x3ae764=_0x8a6305+'\x20*'+_0xb5b293+_0x4b159f(0x193)+('💰\x20Amount:\x20*'+_0xa2adf7[_0x4b159f(0x15f)]+'\x20'+_0xa2adf7[_0x4b159f(0x169)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0xa2adf7['orderId']||_0xa2adf7['id'])+'`\x0a')+(_0x4b159f(0x1cb)+_0xa2adf7['id']+'`\x0a')+(_0x4b159f(0x13b)+_0x110a27+'`\x0a')+(_0x4b159f(0x19e)+new Date(_0xa2adf7[_0x4b159f(0x171)])[_0x4b159f(0x167)](_0x4b159f(0x17b))+'\x0a');if(_0xa2adf7[_0x4b159f(0x151)]||_0xa2adf7['customerEmail']||_0xa2adf7[_0x4b159f(0x177)]||_0xa2adf7['customerIp']||_0xa2adf7[_0x4b159f(0x175)]){_0x3ae764+='\x0a👤\x20*Customer\x20Information:*\x0a';_0xa2adf7[_0x4b159f(0x151)]&&(_0x3ae764+=_0x4b159f(0x1cc)+_0xa2adf7[_0x4b159f(0x151)]+'`\x0a');_0xa2adf7[_0x4b159f(0x12e)]&&(_0x3ae764+=_0x4b159f(0x17f)+_0xa2adf7[_0x4b159f(0x12e)]+'`\x0a');_0xa2adf7[_0x4b159f(0x177)]&&(_0x3ae764+=_0x4b159f(0x1a4)+_0xa2adf7['remitterIban']+'`\x0a');_0xa2adf7[_0x4b159f(0x147)]&&(_0x3ae764+=_0x4b159f(0x1b2)+_0xa2adf7[_0x4b159f(0x147)]+'`\x0a');if(_0xa2adf7['customerUa']){const _0x3c200e=_0xa2adf7[_0x4b159f(0x175)]['length']>0x32?_0xa2adf7[_0x4b159f(0x175)]['substring'](0x0,0x32)+_0x4b159f(0x157):_0xa2adf7[_0x4b159f(0x175)];_0x3ae764+=_0x4b159f(0x1d3)+_0x3c200e+'`\x0a';}}_0x4c9a2c==='chargeback'&&_0xa2adf7[_0x4b159f(0x17d)]&&(_0x3ae764+=_0x4b159f(0x1ad)+_0xa2adf7[_0x4b159f(0x17d)]+'\x20USDT*\x0a'),_0x4c9a2c===_0x4b159f(0x15c)&&(_0x3ae764+=_0x4b159f(0x144)),_0xa2adf7[_0x4b159f(0x180)]&&(_0x3ae764+=_0x4b159f(0x138)+_0xa2adf7[_0x4b159f(0x180)]+'\x0a'),await this[_0x4b159f(0x1b9)](_0x3a1976,_0x3ae764,{'parse_mode':_0x4b159f(0x16a)});}async['sendPayoutNotification'](_0x30a463,_0x5e55f2,_0x10fcaf){const _0x1a91db=a54_0x15dc2d,_0x231a2b={'created':'📤','completed':'✅','rejected':'❌'},_0x523396={'created':'New\x20payout\x20created','completed':_0x1a91db(0x1ec),'rejected':_0x1a91db(0x143)},_0x42b3ae=_0x231a2b[_0x10fcaf],_0x32ad5f=_0x523396[_0x10fcaf],_0x2e2b29=_0x42b3ae+'\x20*'+_0x32ad5f+_0x1a91db(0x193)+(_0x1a91db(0x170)+_0x5e55f2[_0x1a91db(0x15f)]+_0x1a91db(0x189))+(_0x1a91db(0x1a2)+_0x5e55f2[_0x1a91db(0x1ca)]+'`\x0a')+(_0x1a91db(0x12b)+_0x5e55f2['id']+'`\x0a')+(_0x1a91db(0x19e)+new Date(_0x5e55f2[_0x1a91db(0x171)])[_0x1a91db(0x167)](_0x1a91db(0x17b))+'\x0a')+(_0x5e55f2[_0x1a91db(0x153)]?'🔗\x20TXID:\x20`'+_0x5e55f2[_0x1a91db(0x153)]+'`':'');await this[_0x1a91db(0x1b9)](_0x30a463,_0x2e2b29,{'parse_mode':'Markdown'});}async[a54_0x15dc2d(0x174)](_0x4a9885,_0x5a6817){const _0xd82557=a54_0x15dc2d;try{const _0x5e36d7=await database_1[_0xd82557(0x1eb)][_0xd82557(0x165)]['findUnique']({'where':{'shopId':_0x4a9885},'select':{'notificationLogin':!![]}});if(!_0x5e36d7?.['notificationLogin']){console[_0xd82557(0x128)](_0xd82557(0x1b0)+_0x4a9885);return;}const _0x32f09b=_0x5a6817[_0xd82557(0x1dc)]?'🔐':'🚨',_0x1203ff=_0x5a6817[_0xd82557(0x1dc)]?_0xd82557(0x16e):_0xd82557(0x1c0);let _0x41a279=_0x32f09b+'\x20*'+_0x1203ff+_0xd82557(0x193)+(_0xd82557(0x16f)+_0x5a6817[_0xd82557(0x192)]+'`\x0a')+(_0xd82557(0x163)+_0x5a6817[_0xd82557(0x1e0)]['toLocaleString']('en-US')+'\x0a');_0x5a6817[_0xd82557(0x134)]&&(_0x41a279+=_0xd82557(0x15a)+_0x5a6817[_0xd82557(0x134)]+'`\x0a');if(_0x5a6817['userAgent']){const _0x11f019=_0x5a6817[_0xd82557(0x12a)][_0xd82557(0x14b)]>0x32?_0x5a6817['userAgent'][_0xd82557(0x1ef)](0x0,0x32)+_0xd82557(0x157):_0x5a6817[_0xd82557(0x12a)];_0x41a279+=_0xd82557(0x1d3)+_0x11f019+'`\x0a';}!_0x5a6817[_0xd82557(0x1dc)]&&(_0x41a279+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0xd82557(0x1b9)](_0x4a9885,_0x41a279,{'parse_mode':_0xd82557(0x16a)}),console[_0xd82557(0x128)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x4a9885+':\x20'+(_0x5a6817[_0xd82557(0x1dc)]?_0xd82557(0x1dc):'failed'));}catch(_0xfe6c5e){console[_0xd82557(0x122)](_0xd82557(0x11c),_0xfe6c5e);}}async['sendApiErrorNotification'](_0x1f6898,_0x55cccd){const _0x3eaec6=a54_0x15dc2d;try{const _0xbc74c0=await database_1[_0x3eaec6(0x1eb)][_0x3eaec6(0x165)][_0x3eaec6(0x11d)]({'where':{'shopId':_0x1f6898},'select':{'notificationApiError':!![]}});if(!_0xbc74c0?.[_0x3eaec6(0x150)]){console[_0x3eaec6(0x128)](_0x3eaec6(0x1ab)+_0x1f6898);return;}let _0x5db3ce=_0x3eaec6(0x13f)+(_0x3eaec6(0x1c3)+_0x55cccd[_0x3eaec6(0x1ca)]+'\x20'+_0x55cccd[_0x3eaec6(0x14c)]+'`\x0a')+('📅\x20Time:\x20'+_0x55cccd['timestamp'][_0x3eaec6(0x167)]('en-US')+'\x0a');_0x55cccd[_0x3eaec6(0x1c7)]&&(_0x5db3ce+=_0x3eaec6(0x164)+_0x55cccd[_0x3eaec6(0x1c7)]+'`\x0a'),_0x5db3ce+='❌\x20Error:\x20`'+_0x55cccd[_0x3eaec6(0x190)]+'`\x0a',_0x55cccd[_0x3eaec6(0x179)]&&(_0x5db3ce+=_0x3eaec6(0x1dd)+_0x55cccd[_0x3eaec6(0x179)]+'`\x0a'),_0x5db3ce+=_0x3eaec6(0x1ba),await this[_0x3eaec6(0x1b9)](_0x1f6898,_0x5db3ce,{'parse_mode':_0x3eaec6(0x16a)}),console[_0x3eaec6(0x128)](_0x3eaec6(0x145)+_0x1f6898+':\x20'+_0x55cccd[_0x3eaec6(0x14c)]);}catch(_0x4fdb23){console[_0x3eaec6(0x122)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x4fdb23);}}async[a54_0x15dc2d(0x139)](_0x4c5c59,_0x61cf44,_0x2b5199){const _0x3e3e78=a54_0x15dc2d;let _0x2b67aa='🔔\x20*'+_0x61cf44+_0x3e3e78(0x193);for(const [_0x19411a,_0x14481c]of Object[_0x3e3e78(0x16d)](_0x2b5199)){_0x14481c!==null&&_0x14481c!==undefined&&(_0x2b67aa+=_0x19411a+_0x3e3e78(0x1a6)+_0x14481c+'`\x0a');}await this['sendShopNotification'](_0x4c5c59,_0x2b67aa,{'parse_mode':'Markdown'});}[a54_0x15dc2d(0x146)](){const _0x435ab9=a54_0x15dc2d;return{'isActive':!!this[_0x435ab9(0x133)],'username':this['botUsername']};}['stopBot'](){const _0x4b1fe9=a54_0x15dc2d;this[_0x4b1fe9(0x133)]&&(this[_0x4b1fe9(0x133)]['stopPolling'](),this[_0x4b1fe9(0x133)]=null,console[_0x4b1fe9(0x128)](_0x4b1fe9(0x181)));}}exports[a54_0x15dc2d(0x162)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();function a54_0x4906(){const _0x493d74=['toString','currency','Markdown','create','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','entries','Successful\x20login','👤\x20Username:\x20`','💸\x20Amount:\x20*','createdAt','__esModule','•\x20`','sendLoginNotification','customerUa','gateway','remitterIban','secretKey','requestId','Username:\x20`','en-US','name','chargebackAmount','../config/database','📧\x20Email:\x20`','adminNotes','🛑\x20Telegram\x20bot\x20stopped','map','95935KNmTxF','New\x20payment\x20created','split','last_name','\x20parts:\x20','✅\x20Connected\x20to\x20shop:\x20*','\x20USD*\x0a','\x20\x20\x20Username:\x20`','Payment\x20successfully\x20paid','toLocaleDateString','sk_','`.\x0a\x0a','❌\x20Shop\x20`','errorMessage','publicKey','username','*\x0a\x0a','Error\x20handling\x20message:','\x20\x20\x20Public\x20Key:\x20`','setupBotHandlers','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','telegramId','message','...`\x0a\x0a','forEach','2129070OoVrsj','📱\x20Shop:\x20*','📅\x20Date:\x20','❌\x20Please\x20use\x20/start\x20command\x20first','shop','`\x20not\x20found.\x0a\x0a','🏦\x20Method:\x20`','blocked','🏦\x20IBAN:\x20`','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.',':\x20`','getGatewayDisplayNameForTelegram','defineProperty','TELEGRAM_BOT_TOKEN','/disconnect\x20-\x20disconnect\x20from\x20notifications','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Example:\x0a','💸\x20Penalty\x20amount:\x20*','Check\x20spelling\x20and\x20try\x20again.','1303482HsDdCv','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','findMany','🌐\x20IP:\x20`','botUsername','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','sendPaymentNotification','Error\x20sending\x20shop\x20notification:','handleSingleLineVerification','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','sendShopNotification','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','unknown\x20shop','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','Error\x20handling\x20/status\x20command:','sendMessage','•\x20Payouts\x0a\x0a','Failed\x20login\x20attempt','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','482398Hmaqyh','🔗\x20Endpoint:\x20`','❌\x20Invalid\x20username\x20format:\x20`','9QNVRPd','Available\x20usernames:\x0a','statusCode','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','1258752bHYYET','method','🆔\x20Payment\x20ID:\x20`','📛\x20Name:\x20`','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','includes','chat\x20not\x20found','from','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','text','💻\x20Browser:\x20`','onText','first_name','initializeBot','join','\x20initialized\x20successfully','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','\x20via\x20single-line\x20input','`\x0a\x0a','success','🆔\x20Request\x20ID:\x20`','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','`\x20(','timestamp','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','*.\x0a\x0a','20qFxgAb','pk_','8KdtZXB','trim',':\x20username=\x22','You\x20sent\x20','chat','.\x20*','default','Payout\x20completed','status','updatedAt','substring','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Failed\x20to\x20send\x20login\x20notification:','findUnique','Telegram\x20bot\x20error:','findFirst','6vgIYnR','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','error','telegramUser','•\x20Payment\x20status\x20changes\x0a','botToken','isVerified','❌\x20Error\x20getting\x20debug\x20information.','log','🏪\x20Available\x20shops\x20in\x20system:\x0a','userAgent','🆔\x20Payout\x20ID:\x20`','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','🔍\x20*Debug\x20Information*\x0a\x0a','customerEmail','📊\x20*Connection\x20Status*\x0a\x0a','ACTIVE','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','❌\x20Shop\x20with\x20username\x20`','bot','ipAddress','Payment\x20failed','Use\x20/start\x20to\x20connect.','shopId','📝\x20Notes:\x20','sendCustomNotification','🔔\x20Notifications\x20are\x20active\x0a\x0a','🏪\x20Gateway:\x20`','🔔\x20You\x20receive\x20notifications\x20about:\x0a','\x22\x20->\x20display\x20\x22','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','🚨\x20*API\x20Error*\x0a\x0a','Use\x20/start\x20to\x20begin.','polling_error','env','Payout\x20rejected','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','getBotInfo','customerIp','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Contact\x20administrator.','User\x20','length','endpoint','Commands:\x0a','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','warn','notificationApiError','customerName','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','txid','...\x22','../types/gateway','📱\x20Your\x20Telegram\x20ID:\x20`','...','✅\x20Telegram\x20bot\x20@','📱\x20Created\x20new\x20Telegram\x20user:\x20','🌐\x20IP\x20address:\x20`','update','processing','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','127065WNyGOT','amount','\x20\x20\x20Status:\x20','✅\x20Telegram\x20user\x20','TelegramBotService','📅\x20Time:\x20','📊\x20Error\x20code:\x20`','shopSettings','56282yTxOsh','toLocaleString'];a54_0x4906=function(){return _0x493d74;};return a54_0x4906();}