'use strict';const a66_0x35d7f7=a66_0x5ea3;(function(_0x434bdc,_0x1ec78c){const _0x2527de=a66_0x5ea3,_0x39012b=_0x434bdc();while(!![]){try{const _0x2e0e9b=-parseInt(_0x2527de(0x1c8))/0x1*(-parseInt(_0x2527de(0x18d))/0x2)+parseInt(_0x2527de(0x1c9))/0x3*(parseInt(_0x2527de(0x131))/0x4)+parseInt(_0x2527de(0x1d6))/0x5+-parseInt(_0x2527de(0x1a4))/0x6+-parseInt(_0x2527de(0xfe))/0x7+-parseInt(_0x2527de(0x199))/0x8*(-parseInt(_0x2527de(0x19a))/0x9)+-parseInt(_0x2527de(0x13e))/0xa*(parseInt(_0x2527de(0x112))/0xb);if(_0x2e0e9b===_0x1ec78c)break;else _0x39012b['push'](_0x39012b['shift']());}catch(_0x2a5f4d){_0x39012b['push'](_0x39012b['shift']());}}}(a66_0x4a49,0x8316f));var __importDefault=this&&this['__importDefault']||function(_0x4627f2){const _0x321f6d=a66_0x5ea3;return _0x4627f2&&_0x4627f2[_0x321f6d(0x183)]?_0x4627f2:{'default':_0x4627f2};};function a66_0x5ea3(_0x279706,_0x5eccb4){const _0x4a4982=a66_0x4a49();return a66_0x5ea3=function(_0x5ea3aa,_0x14bc6e){_0x5ea3aa=_0x5ea3aa-0xe8;let _0x38f592=_0x4a4982[_0x5ea3aa];return _0x38f592;},a66_0x5ea3(_0x279706,_0x5eccb4);}Object[a66_0x35d7f7(0x14a)](exports,a66_0x35d7f7(0x183),{'value':!![]}),exports['telegramBotService']=exports[a66_0x35d7f7(0x114)]=void 0x0;function a66_0x4a49(){const _0x376f12=['🚨\x20*API\x20Error*\x0a\x0a','remitterIban','🆔\x20Request\x20ID:\x20`','endsWith','Use\x20/start\x20to\x20connect.','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','node-telegram-bot-api','notificationLogin','`\x20not\x20found.\x0a\x0a','🔔\x20You\x20receive\x20notifications\x20about:\x0a','errorMessage','../types/gateway','Error\x20handling\x20/status\x20command:','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','You\x20sent\x20','sendPaymentNotification','shopSettings','requestId','entries','notificationApiError','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','New\x20payment\x20created','\x20\x20\x20Status:\x20','handleSingleLineVerification','Successful\x20login','__esModule','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','onText','Error\x20handling\x20/disconnect\x20command:','bot','✅\x20Welcome\x20back!\x0a\x0a','statusCode','✅\x20Telegram\x20user\x20','❌\x20Invalid\x20username\x20format:\x20`','findUnique','232534ZFvZEi','Telegram\x20bot\x20error:','stopBot','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','sendNotificationToAll','💰\x20Amount:\x20*','getGatewayDisplayNameForTelegram','adminNotes','\x20\x20\x20Username:\x20`','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','substring','17392nLkmBU','4257XQijIZ','Payment\x20successfully\x20paid','update','length','findMany','sendShopFile','startsWith','🆔\x20Payment\x20ID:\x20`','📅\x20Date:\x20','sendLoginNotification','5805540SKgUDU',':\x20username=\x22','trapay_bot','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','chargeback','\x0a👤\x20*Customer\x20Information:*\x0a','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','🔔\x20Notifications\x20are\x20active\x0a\x0a','•\x20Payment\x20status\x20changes\x0a','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.','method','join','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','🏦\x20Method:\x20`','from','env','❌\x20Error:\x20`','failed','telegramId','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','✅\x20File\x20sent\x20to\x20','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','sendShopNotification','❌\x20Error\x20sending\x20file\x20to\x20chat:','Username:\x20`','📧\x20Email:\x20`','\x20verified\x20for\x20shop\x20','🎉\x20*Congratulations!*\x0a\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','error','Payout\x20rejected','log','initializeBot','1qQpSju','22044sMSkjQ','success','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','ACTIVE','Payment\x20refund','getBotInfo','/status\x20-\x20check\x20connection\x20status\x0a','last_name','📱\x20Notification\x20sent\x20to\x20','trim','`\x0a\x0a','🌐\x20IP\x20address:\x20`','Commands:\x0a','4151195jbMjAa','`.\x0a\x0a','User\x20','📊\x20*Connection\x20Status*\x0a\x0a','Failed\x20login\x20attempt','`\x20is\x20inactive.\x0a\x0a','image/png','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','application/pdf','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','toLocaleString','text','Payment\x20failed','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','customerUa','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','🏦\x20IBAN:\x20`','stopPolling','en-US','📛\x20Name:\x20`','❌\x20Shop\x20`','default','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','toLocaleDateString','createdAt','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','❌\x20Error\x20getting\x20debug\x20information.','Contact\x20administrator.','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','\x20initialized\x20successfully','\x20USD*\x0a','sendApiErrorNotification','txid','customerEmail','TELEGRAM_BOT_USERNAME','shop','3117744CgVNZc','unknown\x20shop','updatedAt','pk_','🔍\x20*Debug\x20Information*\x0a\x0a','Use\x20/start\x20to\x20begin.','sendPayoutNotification','map','Failed\x20to\x20send\x20API\x20error\x20notification:','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','orderId','📅\x20Connection\x20date:\x20','botToken','Error\x20sending\x20shop\x20notification:','processing','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','✅\x20Connected\x20to\x20shop:\x20*','gateway','📅\x20Time:\x20','Payment\x20is\x20being\x20processed','1655137RoqruJ','🏪\x20Gateway:\x20`','TelegramBotService','chat','status','allSettled','📱\x20Telegram\x20notification:\x20gateway\x20\x22','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','sendMessage','user\x20is\x20deactivated','❌\x20Please\x20use\x20/start\x20command\x20first','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','Example:\x0a','telegramBotService','chargebackAmount','warn','sendDocument','🛑\x20Telegram\x20bot\x20stopped','Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a','Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.','❌\x20Error\x20sending\x20file\x20to\x20user\x20','sendDirectFile','💻\x20Browser:\x20`','👤\x20Username:\x20`','create','🏪\x20Your\x20connected\x20shop:\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','.jpeg','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','❌\x20Telegram\x20bot\x20not\x20initialized','\x20USDT*\x0a','396nWWNuc','../config/database','Markdown','sendCustomNotification','ipAddress','telegramUser','❌\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','*\x0a\x0a','isVerified','\x20(@','...','Error\x20handling\x20/debug\x20command:','50KBkIQd','.pdf','•\x20New\x20payments\x0a','📝\x20Notes:\x20','.jpg','customerIp','image/jpeg','polling_error','message','endpoint','timestamp','📝\x20Order\x20ID:\x20`','defineProperty','🔗\x20TXID:\x20`','\x22,\x20apiKey=\x22','amount','/disconnect\x20-\x20disconnect\x20from\x20notifications','botUsername','publicKey','✅\x20Telegram\x20bot\x20@','shopId','\x20disconnected\x20from\x20shop\x20','...\x22','TELEGRAM_BOT_TOKEN','userAgent','includes','secretKey','\x20via\x20single-line\x20input','application/octet-stream','•\x20Payouts\x0a\x0a','🌐\x20IP:\x20`','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','customerName','name','setupBotHandlers','first_name','❌\x20Error\x20sending\x20file\x20to\x20shop:','*.\x0a\x0a','Error\x20handling\x20/start\x20command:','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','toString','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','username','\x20\x20\x20Name:\x20*'];a66_0x4a49=function(){return _0x376f12;};return a66_0x4a49();}const node_telegram_bot_api_1=__importDefault(require(a66_0x35d7f7(0x170))),database_1=__importDefault(require(a66_0x35d7f7(0x132))),gateway_1=require(a66_0x35d7f7(0x175));class TelegramBotService{constructor(){const _0x44d38f=a66_0x35d7f7;this[_0x44d38f(0x187)]=null,this['botToken']=process[_0x44d38f(0x1b5)][_0x44d38f(0x155)]||'',this[_0x44d38f(0x14f)]=process['env'][_0x44d38f(0xfc)]||_0x44d38f(0x1a6),this['botToken']?this['initializeBot']():console[_0x44d38f(0x121)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a66_0x35d7f7(0x1c7)](){const _0x3524c5=a66_0x35d7f7;try{this[_0x3524c5(0x187)]=new node_telegram_bot_api_1['default'](this[_0x3524c5(0x10a)],{'polling':!![]}),this[_0x3524c5(0x160)](),console[_0x3524c5(0x1c6)](_0x3524c5(0x151)+this[_0x3524c5(0x14f)]+_0x3524c5(0xf7));}catch(_0x573241){console[_0x3524c5(0x1c4)](_0x3524c5(0x1e6),_0x573241);}}[a66_0x35d7f7(0x160)](){const _0x148ad5=a66_0x35d7f7;if(!this[_0x148ad5(0x187)])return;this[_0x148ad5(0x187)][_0x148ad5(0x185)](/\/start/,async _0x59b20d=>{const _0x23cc61=_0x148ad5,_0x2746f7=_0x59b20d['chat']['id'],_0xa5c008=_0x59b20d['from']?.['id']['toString'](),_0x2774fa=_0x59b20d[_0x23cc61(0x1b4)]?.[_0x23cc61(0x168)],_0x4bca49=_0x59b20d[_0x23cc61(0x1b4)]?.[_0x23cc61(0x161)],_0x42eda7=_0x59b20d['from']?.[_0x23cc61(0x1d0)];if(!_0xa5c008)return;try{let _0x8864a0=await database_1[_0x23cc61(0xed)][_0x23cc61(0x136)]['findUnique']({'where':{'telegramId':_0xa5c008},'include':{'shop':!![]}});!_0x8864a0?(_0x8864a0=await database_1[_0x23cc61(0xed)][_0x23cc61(0x136)][_0x23cc61(0x12a)]({'data':{'telegramId':_0xa5c008,'username':_0x2774fa,'firstName':_0x4bca49,'lastName':_0x42eda7,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x23cc61(0x1c6)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0xa5c008+_0x23cc61(0x13b)+_0x2774fa+')')):_0x8864a0=await database_1[_0x23cc61(0xed)][_0x23cc61(0x136)][_0x23cc61(0x19c)]({'where':{'telegramId':_0xa5c008},'data':{'username':_0x2774fa,'firstName':_0x4bca49,'lastName':_0x42eda7},'include':{'shop':!![]}}),_0x8864a0[_0x23cc61(0x13a)]&&_0x8864a0[_0x23cc61(0x152)]&&_0x8864a0[_0x23cc61(0xfd)]?await this[_0x23cc61(0x187)]?.[_0x23cc61(0x11a)](_0x2746f7,_0x23cc61(0x188)+(_0x23cc61(0x1cb)+_0x8864a0[_0x23cc61(0xfd)][_0x23cc61(0x15f)]+'*\x0a')+(_0x23cc61(0x1be)+_0x8864a0[_0x23cc61(0xfd)]['username']+_0x23cc61(0x1d3))+_0x23cc61(0x173)+_0x23cc61(0x140)+_0x23cc61(0x1ac)+_0x23cc61(0x15b)+_0x23cc61(0x1d5)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x23cc61(0x14e),{'parse_mode':_0x23cc61(0x133)}):(_0x8864a0[_0x23cc61(0x152)]&&!_0x8864a0[_0x23cc61(0x13a)]&&(await database_1[_0x23cc61(0xed)]['telegramUser'][_0x23cc61(0x19c)]({'where':{'telegramId':_0xa5c008},'data':{'shopId':null,'isVerified':![]}}),console[_0x23cc61(0x1c6)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0xa5c008)),await this[_0x23cc61(0x187)]?.[_0x23cc61(0x11a)](_0x2746f7,_0x23cc61(0x1aa)+_0x23cc61(0x1c3)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x23cc61(0x11e)+_0x23cc61(0xf6)+_0x23cc61(0x1b2),{'parse_mode':_0x23cc61(0x133)}));}catch(_0x3087fb){console['error'](_0x23cc61(0x164),_0x3087fb),await this[_0x23cc61(0x187)]?.[_0x23cc61(0x11a)](_0x2746f7,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot'][_0x148ad5(0x185)](/\/disconnect/,async _0x354ad6=>{const _0x41b3b1=_0x148ad5,_0x4608db=_0x354ad6[_0x41b3b1(0x115)]['id'],_0x9bff21=_0x354ad6[_0x41b3b1(0x1b4)]?.['id'][_0x41b3b1(0x166)]();if(!_0x9bff21)return;try{const _0xdf56dc=await database_1['default'][_0x41b3b1(0x136)][_0x41b3b1(0x18c)]({'where':{'telegramId':_0x9bff21},'include':{'shop':!![]}});if(!_0xdf56dc||!_0xdf56dc[_0x41b3b1(0x13a)]||!_0xdf56dc[_0x41b3b1(0x152)]){await this['bot']?.[_0x41b3b1(0x11a)](_0x4608db,_0x41b3b1(0x1b1));return;}const _0x1b4ab3=_0xdf56dc['shop']?.[_0x41b3b1(0x15f)]||_0x41b3b1(0xff);await database_1['default'][_0x41b3b1(0x136)]['update']({'where':{'telegramId':_0x9bff21},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔌\x20User\x20'+_0x9bff21+_0x41b3b1(0x153)+_0xdf56dc[_0x41b3b1(0x152)]),await this['bot']?.[_0x41b3b1(0x11a)](_0x4608db,_0x41b3b1(0x15d)+_0x1b4ab3+_0x41b3b1(0x163)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x41b3b1(0x133)});}catch(_0x1b8a20){console[_0x41b3b1(0x1c4)](_0x41b3b1(0x186),_0x1b8a20),await this[_0x41b3b1(0x187)]?.[_0x41b3b1(0x11a)](_0x4608db,_0x41b3b1(0x11d));}}),this[_0x148ad5(0x187)][_0x148ad5(0x185)](/\/status/,async _0x1f0b33=>{const _0xbe4895=_0x148ad5,_0x3a98d7=_0x1f0b33['chat']['id'],_0xe86bad=_0x1f0b33[_0xbe4895(0x1b4)]?.['id'][_0xbe4895(0x166)]();if(!_0xe86bad)return;try{const _0x117c67=await database_1[_0xbe4895(0xed)]['telegramUser']['findUnique']({'where':{'telegramId':_0xe86bad},'include':{'shop':!![]}});if(!_0x117c67){await this[_0xbe4895(0x187)]?.['sendMessage'](_0x3a98d7,_0xbe4895(0x1c2)+_0xbe4895(0x103));return;}if(!_0x117c67['isVerified']||!_0x117c67[_0xbe4895(0x152)]||!_0x117c67[_0xbe4895(0xfd)]){await this[_0xbe4895(0x187)]?.[_0xbe4895(0x11a)](_0x3a98d7,_0xbe4895(0xf5)+_0xbe4895(0x16e));return;}await this[_0xbe4895(0x187)]?.[_0xbe4895(0x11a)](_0x3a98d7,_0xbe4895(0x1d9)+(_0xbe4895(0x10e)+_0x117c67[_0xbe4895(0xfd)]['name']+'*\x0a')+(_0xbe4895(0x129)+_0x117c67[_0xbe4895(0xfd)][_0xbe4895(0x168)]+'`\x0a')+(_0xbe4895(0x109)+_0x117c67[_0xbe4895(0x100)][_0xbe4895(0xef)](_0xbe4895(0xea))+'\x0a\x0a')+_0xbe4895(0x1ab)+_0xbe4895(0x1d5)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'});}catch(_0x354ab5){console[_0xbe4895(0x1c4)](_0xbe4895(0x176),_0x354ab5),await this[_0xbe4895(0x187)]?.[_0xbe4895(0x11a)](_0x3a98d7,_0xbe4895(0x11d));}}),this[_0x148ad5(0x187)][_0x148ad5(0x185)](/\/debug/,async _0x21aeb6=>{const _0x30e529=_0x148ad5,_0x438a24=_0x21aeb6[_0x30e529(0x115)]['id'],_0x1f2791=_0x21aeb6[_0x30e529(0x1b4)]?.['id'][_0x30e529(0x166)]();if(!_0x1f2791)return;try{const _0x3badae=await database_1[_0x30e529(0xed)]['telegramUser'][_0x30e529(0x18c)]({'where':{'telegramId':_0x1f2791},'include':{'shop':!![]}});let _0xb2ac37=_0x30e529(0x102);_0xb2ac37+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x1f2791+_0x30e529(0x1d3),_0x3badae?.[_0x30e529(0x13a)]&&_0x3badae[_0x30e529(0xfd)]?(_0xb2ac37+=_0x30e529(0x12b),_0xb2ac37+=_0x30e529(0x169)+_0x3badae['shop']['name']+'*\x0a',_0xb2ac37+=_0x30e529(0x195)+_0x3badae[_0x30e529(0xfd)][_0x30e529(0x168)]+'`\x0a',_0xb2ac37+=_0x30e529(0x180)+_0x3badae['shop'][_0x30e529(0x116)]+'\x0a\x0a'):_0xb2ac37+=_0x30e529(0x137),_0xb2ac37+=_0x30e529(0x125),await this[_0x30e529(0x187)]?.[_0x30e529(0x11a)](_0x438a24,_0xb2ac37,{'parse_mode':_0x30e529(0x133)});}catch(_0x1da261){console[_0x30e529(0x1c4)](_0x30e529(0x13d),_0x1da261),await this[_0x30e529(0x187)]?.[_0x30e529(0x11a)](_0x438a24,_0x30e529(0xf3));}}),this[_0x148ad5(0x187)]['on'](_0x148ad5(0x146),async _0x4cce1c=>{const _0x3fc307=_0x148ad5;if(_0x4cce1c['text']?.[_0x3fc307(0x1a0)]('/'))return;const _0x1ec43c=_0x4cce1c[_0x3fc307(0x115)]['id'],_0x5e8750=_0x4cce1c['from']?.['id'][_0x3fc307(0x166)](),_0x4c18bb=_0x4cce1c[_0x3fc307(0x1e2)]?.[_0x3fc307(0x1d2)]();if(!_0x5e8750||!_0x4c18bb)return;try{const _0x235424=await database_1['default'][_0x3fc307(0x136)][_0x3fc307(0x18c)]({'where':{'telegramId':_0x5e8750},'include':{'shop':!![]}});if(!_0x235424){await this[_0x3fc307(0x187)]?.['sendMessage'](_0x1ec43c,_0x3fc307(0x11c));return;}if(_0x235424[_0x3fc307(0x13a)]&&_0x235424['shopId']&&_0x235424[_0x3fc307(0xfd)]){await this['bot']?.[_0x3fc307(0x11a)](_0x1ec43c,_0x3fc307(0x17e)+_0x235424[_0x3fc307(0xfd)][_0x3fc307(0x15f)]+_0x3fc307(0x163)+_0x3fc307(0xee),{'parse_mode':_0x3fc307(0x133)});return;}const _0x436da9=_0x4c18bb['split'](/\s+/);if(_0x436da9[_0x3fc307(0x19d)]!==0x2){await this[_0x3fc307(0x187)]?.[_0x3fc307(0x11a)](_0x1ec43c,_0x3fc307(0x12e)+_0x3fc307(0x177)+_0x3fc307(0x11e)+_0x3fc307(0xf6)+(_0x3fc307(0x178)+_0x436da9['length']+'\x20parts:\x20'+_0x436da9[_0x3fc307(0x105)](_0x25332e=>'`'+_0x25332e+'`')[_0x3fc307(0x1b0)](',\x20')),{'parse_mode':_0x3fc307(0x133)});return;}const [_0x9dbfd1,_0x4fc3dd]=_0x436da9;console[_0x3fc307(0x1c6)](_0x3fc307(0x10d)+_0x5e8750+_0x3fc307(0x1a5)+_0x9dbfd1+_0x3fc307(0x14c)+_0x4fc3dd[_0x3fc307(0x198)](0x0,0xa)+_0x3fc307(0x154)),await this[_0x3fc307(0x181)](_0x1ec43c,_0x5e8750,_0x9dbfd1,_0x4fc3dd);}catch(_0x51b053){console[_0x3fc307(0x1c4)]('Error\x20handling\x20message:',_0x51b053),await this[_0x3fc307(0x187)]?.[_0x3fc307(0x11a)](_0x1ec43c,_0x3fc307(0x11d));}}),this[_0x148ad5(0x187)]['on'](_0x148ad5(0x1c4),_0x313b03=>{const _0x37c4c5=_0x148ad5;console[_0x37c4c5(0x1c4)](_0x37c4c5(0x18e),_0x313b03);}),this[_0x148ad5(0x187)]['on'](_0x148ad5(0x145),_0x3fed5d=>{const _0x4c43c3=_0x148ad5;console[_0x4c43c3(0x1c4)]('Telegram\x20bot\x20polling\x20error:',_0x3fed5d);});}async[a66_0x35d7f7(0x181)](_0x2a7be1,_0x45b56e,_0x11cbd2,_0x5f03f6){const _0x56c502=a66_0x35d7f7;try{console[_0x56c502(0x1c6)](_0x56c502(0x10d)+_0x45b56e+_0x56c502(0x1a5)+_0x11cbd2+'\x22,\x20apiKey=\x22'+_0x5f03f6['substring'](0x0,0xa)+_0x56c502(0x154));if(!_0x11cbd2||_0x11cbd2[_0x56c502(0x19d)]<0x3||_0x11cbd2[_0x56c502(0x19d)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x11cbd2)){await this['bot']?.['sendMessage'](_0x2a7be1,_0x56c502(0x18b)+_0x11cbd2+_0x56c502(0x1d3)+_0x56c502(0x12c),{'parse_mode':_0x56c502(0x133)});return;}if(!_0x5f03f6||!_0x5f03f6[_0x56c502(0x1a0)](_0x56c502(0x101))&&!_0x5f03f6['startsWith']('sk_')){await this[_0x56c502(0x187)]?.['sendMessage'](_0x2a7be1,_0x56c502(0xf2)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x56c502(0x133)});return;}const _0x40a1d0=await database_1[_0x56c502(0xed)][_0x56c502(0xfd)][_0x56c502(0x18c)]({'where':{'username':_0x11cbd2},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x40a1d0){const _0x149ebd='❌\x20Shop\x20with\x20username\x20`'+_0x11cbd2+_0x56c502(0x172)+_0x56c502(0x124)+_0x56c502(0x1ae);await this['bot']?.['sendMessage'](_0x2a7be1,_0x149ebd,{'parse_mode':_0x56c502(0x133)});return;}if(_0x40a1d0[_0x56c502(0x116)]!==_0x56c502(0x1cc)){await this[_0x56c502(0x187)]?.[_0x56c502(0x11a)](_0x2a7be1,_0x56c502(0xec)+_0x11cbd2+_0x56c502(0x1db)+_0x56c502(0xf4),{'parse_mode':_0x56c502(0x133)});return;}if(_0x40a1d0[_0x56c502(0x150)]!==_0x5f03f6&&_0x40a1d0[_0x56c502(0x158)]!==_0x5f03f6){await this['bot']?.[_0x56c502(0x11a)](_0x2a7be1,_0x56c502(0x16f)+_0x11cbd2+'`.\x0a\x0a'+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x56c502(0x107),{'parse_mode':_0x56c502(0x133)});return;}const _0x4f687b=await database_1[_0x56c502(0xed)][_0x56c502(0x136)]['findFirst']({'where':{'shopId':_0x40a1d0['id'],'isVerified':!![],'telegramId':{'not':_0x45b56e}}});if(_0x4f687b){await this[_0x56c502(0x187)]?.[_0x56c502(0x11a)](_0x2a7be1,_0x56c502(0x197)+_0x11cbd2+_0x56c502(0x1d7)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x56c502(0x133)});return;}await database_1[_0x56c502(0xed)][_0x56c502(0x136)][_0x56c502(0x19c)]({'where':{'telegramId':_0x45b56e},'data':{'shopId':_0x40a1d0['id'],'isVerified':!![]}}),await this[_0x56c502(0x187)]?.[_0x56c502(0x11a)](_0x2a7be1,_0x56c502(0x1c1)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('📱\x20Shop:\x20*'+_0x40a1d0[_0x56c502(0x15f)]+'*\x0a')+('👤\x20Username:\x20`'+_0x40a1d0[_0x56c502(0x168)]+_0x56c502(0x1d3))+_0x56c502(0x1e0)+_0x56c502(0x140)+_0x56c502(0x1ac)+'•\x20Payouts\x0a'+'•\x20Important\x20events\x0a\x0a'+'Commands:\x0a'+_0x56c502(0x1cf)+_0x56c502(0x14e),{'parse_mode':_0x56c502(0x133)}),console[_0x56c502(0x1c6)](_0x56c502(0x18a)+_0x45b56e+_0x56c502(0x1c0)+_0x40a1d0[_0x56c502(0x168)]+_0x56c502(0x159));}catch(_0xb5a202){console['error']('Error\x20in\x20handleSingleLineVerification:',_0xb5a202),await this[_0x56c502(0x187)]?.[_0x56c502(0x11a)](_0x2a7be1,_0x56c502(0x184));}}async[a66_0x35d7f7(0x1bc)](_0x2ce32a,_0x47b9d7,_0x1f62b2){const _0x317afc=a66_0x35d7f7;if(!this['bot']){console[_0x317afc(0x121)](_0x317afc(0x167));return;}try{const _0x34fe2e=await database_1[_0x317afc(0xed)][_0x317afc(0x136)]['findMany']({'where':{'shopId':_0x2ce32a,'isVerified':!![]}});if(_0x34fe2e[_0x317afc(0x19d)]===0x0){console['log'](_0x317afc(0x1b9)+_0x2ce32a);return;}const _0x2eb0ab=_0x34fe2e[_0x317afc(0x105)](async _0x15c10e=>{const _0x18db98=_0x317afc;try{await this[_0x18db98(0x187)]?.[_0x18db98(0x11a)](_0x15c10e[_0x18db98(0x1b8)],_0x47b9d7,_0x1f62b2),console[_0x18db98(0x1c6)](_0x18db98(0x119)+_0x15c10e[_0x18db98(0x1b8)]);}catch(_0x61dfaa){console[_0x18db98(0x1c4)](_0x18db98(0x1ad)+_0x15c10e[_0x18db98(0x1b8)]+':',_0x61dfaa),_0x61dfaa instanceof Error&&(_0x61dfaa[_0x18db98(0x146)][_0x18db98(0x157)]('blocked')||_0x61dfaa[_0x18db98(0x146)][_0x18db98(0x157)]('chat\x20not\x20found')||_0x61dfaa[_0x18db98(0x146)][_0x18db98(0x157)](_0x18db98(0x11b)))&&(await database_1[_0x18db98(0xed)][_0x18db98(0x136)][_0x18db98(0x19c)]({'where':{'id':_0x15c10e['id']},'data':{'isVerified':![]}}),console['log'](_0x18db98(0x1d8)+_0x15c10e['telegramId']+_0x18db98(0x1dd)));}});await Promise[_0x317afc(0x117)](_0x2eb0ab);}catch(_0x3cce37){console[_0x317afc(0x1c4)](_0x317afc(0x10b),_0x3cce37);}}async[a66_0x35d7f7(0x179)](_0x448252,_0x48d914,_0x4dfed8){const _0xd5b3ef=a66_0x35d7f7,_0x42643b={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x3eb025={'created':_0xd5b3ef(0x17f),'paid':_0xd5b3ef(0x19b),'failed':_0xd5b3ef(0x1e3),'expired':'Payment\x20expired','refund':_0xd5b3ef(0x1cd),'chargeback':'Payment\x20chargeback','processing':_0xd5b3ef(0x111)},_0x384eeb=_0x42643b[_0x4dfed8],_0x4d1051=_0x3eb025[_0x4dfed8],_0xd73a52=(0x0,gateway_1[_0xd5b3ef(0x193)])(_0x48d914[_0xd5b3ef(0x10f)]);console[_0xd5b3ef(0x1c6)](_0xd5b3ef(0x118)+_0x48d914[_0xd5b3ef(0x10f)]+'\x22\x20->\x20display\x20\x22'+_0xd73a52+'\x22');let _0x102d05=_0x384eeb+'\x20*'+_0x4d1051+_0xd5b3ef(0x139)+(_0xd5b3ef(0x192)+_0x48d914['amount']+'\x20'+_0x48d914['currency']+'*\x0a')+(_0xd5b3ef(0x149)+(_0x48d914[_0xd5b3ef(0x108)]||_0x48d914['id'])+'`\x0a')+(_0xd5b3ef(0x1a1)+_0x48d914['id']+'`\x0a')+(_0xd5b3ef(0x113)+_0xd73a52+'`\x0a')+(_0xd5b3ef(0x1a2)+new Date(_0x48d914[_0xd5b3ef(0xf0)])[_0xd5b3ef(0x1e1)](_0xd5b3ef(0xea))+'\x0a');if(_0x48d914[_0xd5b3ef(0x15e)]||_0x48d914[_0xd5b3ef(0xfb)]||_0x48d914[_0xd5b3ef(0x16b)]||_0x48d914[_0xd5b3ef(0x143)]||_0x48d914[_0xd5b3ef(0x1e5)]){_0x102d05+=_0xd5b3ef(0x1a9);_0x48d914[_0xd5b3ef(0x15e)]&&(_0x102d05+=_0xd5b3ef(0xeb)+_0x48d914[_0xd5b3ef(0x15e)]+'`\x0a');_0x48d914[_0xd5b3ef(0xfb)]&&(_0x102d05+=_0xd5b3ef(0x1bf)+_0x48d914['customerEmail']+'`\x0a');_0x48d914['remitterIban']&&(_0x102d05+=_0xd5b3ef(0xe8)+_0x48d914[_0xd5b3ef(0x16b)]+'`\x0a');_0x48d914[_0xd5b3ef(0x143)]&&(_0x102d05+=_0xd5b3ef(0x15c)+_0x48d914[_0xd5b3ef(0x143)]+'`\x0a');if(_0x48d914[_0xd5b3ef(0x1e5)]){const _0x31e0fe=_0x48d914[_0xd5b3ef(0x1e5)][_0xd5b3ef(0x19d)]>0x32?_0x48d914[_0xd5b3ef(0x1e5)]['substring'](0x0,0x32)+_0xd5b3ef(0x13c):_0x48d914[_0xd5b3ef(0x1e5)];_0x102d05+=_0xd5b3ef(0x128)+_0x31e0fe+'`\x0a';}}_0x4dfed8===_0xd5b3ef(0x1a8)&&_0x48d914['chargebackAmount']&&(_0x102d05+='💸\x20Penalty\x20amount:\x20*'+_0x48d914[_0xd5b3ef(0x120)]+_0xd5b3ef(0x130)),_0x4dfed8===_0xd5b3ef(0x10c)&&(_0x102d05+=_0xd5b3ef(0x165)),_0x48d914[_0xd5b3ef(0x194)]&&(_0x102d05+=_0xd5b3ef(0x141)+_0x48d914[_0xd5b3ef(0x194)]+'\x0a'),await this[_0xd5b3ef(0x1bc)](_0x448252,_0x102d05,{'parse_mode':_0xd5b3ef(0x133)});}async[a66_0x35d7f7(0x104)](_0xcc20e6,_0x4aa188,_0x1d4e34){const _0x26f3b5=a66_0x35d7f7,_0x2c3ba2={'created':'📤','completed':'✅','rejected':'❌'},_0x3305bf={'created':'New\x20payout\x20created','completed':'Payout\x20completed','rejected':_0x26f3b5(0x1c5)},_0x355047=_0x2c3ba2[_0x1d4e34],_0x5c07dc=_0x3305bf[_0x1d4e34],_0x3f98a7=_0x355047+'\x20*'+_0x5c07dc+'*\x0a\x0a'+('💸\x20Amount:\x20*'+_0x4aa188[_0x26f3b5(0x14d)]+_0x26f3b5(0xf8))+(_0x26f3b5(0x1b3)+_0x4aa188[_0x26f3b5(0x1af)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x4aa188['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x4aa188['createdAt'])[_0x26f3b5(0x1e1)](_0x26f3b5(0xea))+'\x0a')+(_0x4aa188[_0x26f3b5(0xfa)]?_0x26f3b5(0x14b)+_0x4aa188['txid']+'`':'');await this[_0x26f3b5(0x1bc)](_0xcc20e6,_0x3f98a7,{'parse_mode':_0x26f3b5(0x133)});}async[a66_0x35d7f7(0x1a3)](_0x1d316a,_0x5229b6){const _0x29abc6=a66_0x35d7f7;try{const _0x1b72ba=await database_1[_0x29abc6(0xed)][_0x29abc6(0x17a)][_0x29abc6(0x18c)]({'where':{'shopId':_0x1d316a},'select':{'notificationLogin':!![]}});if(!_0x1b72ba?.[_0x29abc6(0x171)]){console['log'](_0x29abc6(0x1a7)+_0x1d316a);return;}const _0xabd562=_0x5229b6[_0x29abc6(0x1ca)]?'🔐':'🚨',_0x42a9a2=_0x5229b6[_0x29abc6(0x1ca)]?_0x29abc6(0x182):_0x29abc6(0x1da);let _0x28dc57=_0xabd562+'\x20*'+_0x42a9a2+_0x29abc6(0x139)+(_0x29abc6(0x129)+_0x5229b6[_0x29abc6(0x168)]+'`\x0a')+(_0x29abc6(0x110)+_0x5229b6[_0x29abc6(0x148)]['toLocaleString'](_0x29abc6(0xea))+'\x0a');_0x5229b6[_0x29abc6(0x135)]&&(_0x28dc57+=_0x29abc6(0x1d4)+_0x5229b6['ipAddress']+'`\x0a');if(_0x5229b6[_0x29abc6(0x156)]){const _0x4f6c3a=_0x5229b6['userAgent'][_0x29abc6(0x19d)]>0x32?_0x5229b6[_0x29abc6(0x156)][_0x29abc6(0x198)](0x0,0x32)+'...':_0x5229b6[_0x29abc6(0x156)];_0x28dc57+='💻\x20Browser:\x20`'+_0x4f6c3a+'`\x0a';}!_0x5229b6[_0x29abc6(0x1ca)]&&(_0x28dc57+=_0x29abc6(0x196)),await this[_0x29abc6(0x1bc)](_0x1d316a,_0x28dc57,{'parse_mode':_0x29abc6(0x133)}),console[_0x29abc6(0x1c6)](_0x29abc6(0xf1)+_0x1d316a+':\x20'+(_0x5229b6[_0x29abc6(0x1ca)]?'success':_0x29abc6(0x1b7)));}catch(_0x47625a){console[_0x29abc6(0x1c4)]('Failed\x20to\x20send\x20login\x20notification:',_0x47625a);}}async[a66_0x35d7f7(0xf9)](_0x4a745f,_0x416eae){const _0x1eaaf1=a66_0x35d7f7;try{const _0x1271a0=await database_1[_0x1eaaf1(0xed)][_0x1eaaf1(0x17a)][_0x1eaaf1(0x18c)]({'where':{'shopId':_0x4a745f},'select':{'notificationApiError':!![]}});if(!_0x1271a0?.[_0x1eaaf1(0x17d)]){console[_0x1eaaf1(0x1c6)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x4a745f);return;}let _0x3f5a35=_0x1eaaf1(0x16a)+('🔗\x20Endpoint:\x20`'+_0x416eae[_0x1eaaf1(0x1af)]+'\x20'+_0x416eae[_0x1eaaf1(0x147)]+'`\x0a')+('📅\x20Time:\x20'+_0x416eae['timestamp']['toLocaleString'](_0x1eaaf1(0xea))+'\x0a');_0x416eae['statusCode']&&(_0x3f5a35+='📊\x20Error\x20code:\x20`'+_0x416eae[_0x1eaaf1(0x189)]+'`\x0a'),_0x3f5a35+=_0x1eaaf1(0x1b6)+_0x416eae[_0x1eaaf1(0x174)]+'`\x0a',_0x416eae[_0x1eaaf1(0x17b)]&&(_0x3f5a35+=_0x1eaaf1(0x16c)+_0x416eae[_0x1eaaf1(0x17b)]+'`\x0a'),_0x3f5a35+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x1eaaf1(0x1bc)](_0x4a745f,_0x3f5a35,{'parse_mode':_0x1eaaf1(0x133)}),console['log'](_0x1eaaf1(0x1e4)+_0x4a745f+':\x20'+_0x416eae['endpoint']);}catch(_0x20f4d1){console[_0x1eaaf1(0x1c4)](_0x1eaaf1(0x106),_0x20f4d1);}}async[a66_0x35d7f7(0x134)](_0x591044,_0x3cf721,_0x35659e){const _0x58b206=a66_0x35d7f7;let _0x579f01='🔔\x20*'+_0x3cf721+'*\x0a\x0a';for(const [_0x339dd5,_0x3cf1e6]of Object[_0x58b206(0x17c)](_0x35659e)){_0x3cf1e6!==null&&_0x3cf1e6!==undefined&&(_0x579f01+=_0x339dd5+':\x20`'+_0x3cf1e6+'`\x0a');}await this[_0x58b206(0x1bc)](_0x591044,_0x579f01,{'parse_mode':_0x58b206(0x133)});}async[a66_0x35d7f7(0x191)](_0x5e18b3){const _0x28d933=a66_0x35d7f7;try{console['log'](_0x28d933(0x190)+_0x5e18b3[_0x28d933(0x198)](0x0,0x32)+_0x28d933(0x13c));const _0x5f0902=await database_1[_0x28d933(0xed)][_0x28d933(0x136)][_0x28d933(0x19e)]({'select':{'telegramId':!![]}});if(_0x5f0902[_0x28d933(0x19d)]===0x0){console[_0x28d933(0x1c6)]('📱\x20No\x20active\x20Telegram\x20users\x20found');return;}for(const _0x2e1f12 of _0x5f0902){try{await this['bot']?.[_0x28d933(0x11a)](_0x2e1f12['telegramId'],_0x5e18b3,{'parse_mode':'Markdown'});}catch(_0x15eb66){console[_0x28d933(0x1c4)](_0x28d933(0x1bb)+_0x2e1f12[_0x28d933(0x1b8)]+':',_0x15eb66);}}console[_0x28d933(0x1c6)](_0x28d933(0x1d1)+_0x5f0902['length']+'\x20users');}catch(_0x26f2b8){console[_0x28d933(0x1c4)](_0x28d933(0x138),_0x26f2b8);}}[a66_0x35d7f7(0x1ce)](){const _0x2f048d=a66_0x35d7f7;return{'isActive':!!this['bot'],'username':this[_0x2f048d(0x14f)]};}async[a66_0x35d7f7(0x19f)](_0x8a5898,_0x460bb2,_0x30a1dd,_0x1a8366){const _0x4c0838=a66_0x35d7f7;try{if(!this['bot'])return console['error'](_0x4c0838(0x12f)),![];const _0x55abbe=await database_1[_0x4c0838(0xed)][_0x4c0838(0x136)][_0x4c0838(0x19e)]({'where':{'shopId':_0x8a5898,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x55abbe[_0x4c0838(0x19d)]===0x0)return console['error'](_0x4c0838(0x1de)+_0x8a5898),![];let _0x3eca51=0x0;for(const _0x437428 of _0x55abbe){try{await this['bot'][_0x4c0838(0x122)](_0x437428['telegramId'],_0x460bb2,{},{'filename':_0x30a1dd,'contentType':_0x30a1dd[_0x4c0838(0x16d)]('.png')?_0x4c0838(0x1dc):_0x30a1dd[_0x4c0838(0x16d)](_0x4c0838(0x142))||_0x30a1dd[_0x4c0838(0x16d)](_0x4c0838(0x12d))?_0x4c0838(0x144):_0x30a1dd[_0x4c0838(0x16d)](_0x4c0838(0x13f))?'application/pdf':_0x4c0838(0x15a)}),_0x1a8366&&await this[_0x4c0838(0x187)][_0x4c0838(0x11a)](_0x437428[_0x4c0838(0x1b8)],_0x1a8366),_0x3eca51++;}catch(_0x36bed8){console[_0x4c0838(0x1c4)](_0x4c0838(0x126)+_0x437428['telegramId']+':',_0x36bed8);}}return console[_0x4c0838(0x1c6)](_0x4c0838(0x1ba)+_0x3eca51+'/'+_0x55abbe['length']+'\x20users\x20of\x20shop\x20'+_0x8a5898+':\x20'+_0x30a1dd),_0x3eca51>0x0;}catch(_0x279814){return console[_0x4c0838(0x1c4)](_0x4c0838(0x162),_0x279814),![];}}async['sendDirectMessage'](_0xcab358,_0x16d8ef){const _0x3a15f0=a66_0x35d7f7;try{if(!this[_0x3a15f0(0x187)])return console[_0x3a15f0(0x1c4)](_0x3a15f0(0x12f)),![];return await this['bot'][_0x3a15f0(0x11a)](_0xcab358,_0x16d8ef),console[_0x3a15f0(0x1c6)]('✅\x20Direct\x20message\x20sent\x20to\x20chat\x20'+_0xcab358),!![];}catch(_0x1a5916){return console[_0x3a15f0(0x1c4)]('❌\x20Error\x20sending\x20direct\x20message:',_0x1a5916),![];}}async[a66_0x35d7f7(0x127)](_0x2f8c11,_0x2495ee,_0x5e03f3,_0x36c347){const _0x21f7d5=a66_0x35d7f7;try{if(!this['bot'])return console[_0x21f7d5(0x1c4)](_0x21f7d5(0x12f)),![];return await this[_0x21f7d5(0x187)][_0x21f7d5(0x122)](_0x2f8c11,_0x2495ee,{},{'filename':_0x5e03f3,'contentType':_0x5e03f3[_0x21f7d5(0x16d)]('.png')?_0x21f7d5(0x1dc):_0x5e03f3[_0x21f7d5(0x16d)](_0x21f7d5(0x142))||_0x5e03f3[_0x21f7d5(0x16d)](_0x21f7d5(0x12d))?_0x21f7d5(0x144):_0x5e03f3[_0x21f7d5(0x16d)](_0x21f7d5(0x13f))?_0x21f7d5(0x1df):_0x21f7d5(0x15a)}),_0x36c347&&await this['bot'][_0x21f7d5(0x11a)](_0x2f8c11,_0x36c347),console[_0x21f7d5(0x1c6)]('✅\x20File\x20sent\x20to\x20chat\x20'+_0x2f8c11+':\x20'+_0x5e03f3),!![];}catch(_0x1668d2){return console[_0x21f7d5(0x1c4)](_0x21f7d5(0x1bd),_0x1668d2),![];}}[a66_0x35d7f7(0x18f)](){const _0x2d3204=a66_0x35d7f7;this[_0x2d3204(0x187)]&&(this[_0x2d3204(0x187)][_0x2d3204(0xe9)](),this[_0x2d3204(0x187)]=null,console[_0x2d3204(0x1c6)](_0x2d3204(0x123)));}}exports['TelegramBotService']=TelegramBotService,exports[a66_0x35d7f7(0x11f)]=new TelegramBotService();