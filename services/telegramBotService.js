'use strict';const a53_0x2e6da7=a53_0x15db;(function(_0x27ca13,_0x5d80ea){const _0x20bc49=a53_0x15db,_0x29a9bb=_0x27ca13();while(!![]){try{const _0x535d77=parseInt(_0x20bc49(0x225))/0x1+parseInt(_0x20bc49(0x197))/0x2*(parseInt(_0x20bc49(0x17e))/0x3)+-parseInt(_0x20bc49(0x253))/0x4*(-parseInt(_0x20bc49(0x1c9))/0x5)+-parseInt(_0x20bc49(0x1e2))/0x6*(-parseInt(_0x20bc49(0x229))/0x7)+parseInt(_0x20bc49(0x216))/0x8*(parseInt(_0x20bc49(0x250))/0x9)+-parseInt(_0x20bc49(0x223))/0xa*(-parseInt(_0x20bc49(0x1af))/0xb)+-parseInt(_0x20bc49(0x20a))/0xc;if(_0x535d77===_0x5d80ea)break;else _0x29a9bb['push'](_0x29a9bb['shift']());}catch(_0x41ae89){_0x29a9bb['push'](_0x29a9bb['shift']());}}}(a53_0x300f,0x86897));var __importDefault=this&&this[a53_0x2e6da7(0x1b2)]||function(_0x4e9846){const _0x2764ae=a53_0x2e6da7;return _0x4e9846&&_0x4e9846[_0x2764ae(0x184)]?_0x4e9846:{'default':_0x4e9846};};Object[a53_0x2e6da7(0x242)](exports,a53_0x2e6da7(0x184),{'value':!![]}),exports[a53_0x2e6da7(0x17d)]=exports[a53_0x2e6da7(0x1c4)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a53_0x2e6da7(0x254))),database_1=__importDefault(require(a53_0x2e6da7(0x201))),gateway_1=require('../types/gateway');function a53_0x300f(){const _0x3572ac=['Telegram\x20bot\x20error:','allSettled','shopId','9xhJsmd','🆔\x20Payment\x20ID:\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a','4nKAuHS','node-telegram-bot-api','createdAt','📝\x20Notes:\x20','update','includes','Payment\x20chargeback','error','requestId','📅\x20Date:\x20','Error\x20sending\x20shop\x20notification:','🔗\x20TXID:\x20`','Contact\x20administrator.','default','telegramBotService','45Aebkau','🏪\x20Gateway:\x20`','last_name','log','isVerified','`.\x0a\x0a','__esModule','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','New\x20payout\x20created','onText','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','botUsername','polling_error','📛\x20Name:\x20`','customerEmail','Username:\x20`','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Payment\x20refund','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','entries','substring','🔔\x20*','create','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','19956mAWHgH','`\x0a\x0a','\x20\x20\x20Public\x20Key:\x20`','Check\x20spelling\x20and\x20try\x20again.','handleSingleLineVerification','...\x22','\x20via\x20single-line\x20input',':\x20`','forEach','TELEGRAM_BOT_USERNAME','text','•\x20New\x20payments\x0a','👤\x20Username:\x20`','•\x20Payouts\x0a','sendMessage','💸\x20Penalty\x20amount:\x20*','amount','sendPayoutNotification','shopSettings','*.\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','\x22\x20->\x20display\x20\x22','`\x20is\x20inactive.\x0a\x0a','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','5126xYnyql','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','❌\x20Shop\x20`','__importDefault','env','\x20parts:\x20','Use\x20/start\x20to\x20begin.','New\x20payment\x20created','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','You\x20sent\x20','updatedAt','🆔\x20Request\x20ID:\x20`','✅\x20Connected\x20to\x20shop:\x20*','❌\x20Invalid\x20username\x20format:\x20`','•\x20`','failed','name','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','findMany','success','❌\x20Error\x20getting\x20debug\x20information.','TelegramBotService','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','startsWith','status','gateway','728430JFigeF','shop','ipAddress','test','Failed\x20to\x20send\x20API\x20error\x20notification:','sendApiErrorNotification','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','notificationApiError','🔔\x20Notifications\x20are\x20active\x0a\x0a','📱\x20Shop:\x20*','📅\x20Connection\x20date:\x20','sendCustomNotification','🌐\x20IP\x20address:\x20`','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Error\x20handling\x20message:','sendShopNotification','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','📱\x20Telegram\x20notification:\x20gateway\x20\x22','orderId','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','Payout\x20rejected','User\x20','📅\x20Time:\x20','sendLoginNotification','426WsWEDU','setupBotHandlers','message','from','•\x20Payouts\x0a\x0a','✅\x20Welcome\x20back!\x0a\x0a','processing','en-US','...`\x0a\x0a','join','blocked','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','•\x20Payment\x20status\x20changes\x0a','Use\x20/start\x20to\x20connect.','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','\x0a👤\x20*Customer\x20Information:*\x0a','Error\x20handling\x20/status\x20command:','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','🔍\x20*Debug\x20Information*\x0a\x0a','To\x20reconnect,\x20use\x20the\x20/start\x20command','❌\x20Please\x20use\x20/start\x20command\x20first','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','✅\x20Telegram\x20bot\x20@','sendPaymentNotification','publicKey','Markdown','Error\x20handling\x20/debug\x20command:',':\x20username=\x22','Payment\x20expired','chargebackAmount','Payment\x20successfully\x20paid','../config/database','toLocaleString','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','map','\x0aCheck\x20spelling\x20and\x20try\x20again.','💻\x20Browser:\x20`','user\x20is\x20deactivated','telegramId','31063860wVvSCq','Commands:\x0a','stopPolling','Payout\x20completed','timestamp','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','sk_','Available\x20usernames:\x0a','currency','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','toLocaleDateString','*\x0a\x0a','4569096ztvDoB','\x20(@','trim','first_name','📧\x20Email:\x20`','chat\x20not\x20found','❌\x20Error:\x20`','length','Failed\x20to\x20send\x20login\x20notification:','bot','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','\x20\x20\x20Status:\x20','23510HzVQYn','userAgent','132042cEnKvq','initializeBot','\x20\x20\x20Username:\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','103089RNxMOE','\x20USD*\x0a','Telegram\x20bot\x20polling\x20error:','endpoint','\x20disconnected\x20from\x20shop\x20','📝\x20Order\x20ID:\x20`','customerName','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','username','findUnique','telegramUser','toString','adminNotes','Error\x20handling\x20/start\x20command:','/status\x20-\x20check\x20connection\x20status\x0a','botToken','getGatewayDisplayNameForTelegram','📊\x20*Connection\x20Status*\x0a\x0a','findFirst','\x22,\x20apiKey=\x22','unknown\x20shop','💸\x20Amount:\x20*','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','\x20USDT*\x0a','pk_','defineProperty','trapay_bot','Example:\x0a','chat','💰\x20Amount:\x20*','warn','TELEGRAM_BOT_TOKEN','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','notificationLogin','method','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'];a53_0x300f=function(){return _0x3572ac;};return a53_0x300f();}function a53_0x15db(_0x26aadc,_0x5f40e5){const _0x300fdb=a53_0x300f();return a53_0x15db=function(_0x15dbcc,_0x36b631){_0x15dbcc=_0x15dbcc-0x17a;let _0x5e1258=_0x300fdb[_0x15dbcc];return _0x5e1258;},a53_0x15db(_0x26aadc,_0x5f40e5);}class TelegramBotService{constructor(){const _0xa6cc11=a53_0x2e6da7;this[_0xa6cc11(0x21f)]=null,this['botToken']=process[_0xa6cc11(0x1b3)][_0xa6cc11(0x248)]||'',this['botUsername']=process[_0xa6cc11(0x1b3)][_0xa6cc11(0x1a0)]||_0xa6cc11(0x243),this[_0xa6cc11(0x238)]?this[_0xa6cc11(0x226)]():console['warn'](_0xa6cc11(0x1ae));}[a53_0x2e6da7(0x226)](){const _0x56a0df=a53_0x2e6da7;try{this['bot']=new node_telegram_bot_api_1[(_0x56a0df(0x17c))](this[_0x56a0df(0x238)],{'polling':!![]}),this[_0x56a0df(0x1e3)](),console[_0x56a0df(0x181)](_0x56a0df(0x1f8)+this['botUsername']+'\x20initialized\x20successfully');}catch(_0x3f8f79){console[_0x56a0df(0x25a)](_0x56a0df(0x1da),_0x3f8f79);}}[a53_0x2e6da7(0x1e3)](){const _0x36db11=a53_0x2e6da7;if(!this['bot'])return;this[_0x36db11(0x21f)][_0x36db11(0x187)](/\/start/,async _0x19da8a=>{const _0x1a8384=_0x36db11,_0x47b8db=_0x19da8a['chat']['id'],_0x3826fa=_0x19da8a['from']?.['id'][_0x1a8384(0x234)](),_0x11b395=_0x19da8a[_0x1a8384(0x1e5)]?.[_0x1a8384(0x231)],_0x2c26a3=_0x19da8a[_0x1a8384(0x1e5)]?.[_0x1a8384(0x219)],_0x19a687=_0x19da8a['from']?.[_0x1a8384(0x180)];if(!_0x3826fa)return;try{let _0x47bfc7=await database_1[_0x1a8384(0x17c)][_0x1a8384(0x233)][_0x1a8384(0x232)]({'where':{'telegramId':_0x3826fa},'include':{'shop':!![]}});!_0x47bfc7?(_0x47bfc7=await database_1['default'][_0x1a8384(0x233)][_0x1a8384(0x194)]({'data':{'telegramId':_0x3826fa,'username':_0x11b395,'firstName':_0x2c26a3,'lastName':_0x19a687,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x1a8384(0x181)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x3826fa+_0x1a8384(0x217)+_0x11b395+')')):_0x47bfc7=await database_1[_0x1a8384(0x17c)][_0x1a8384(0x233)][_0x1a8384(0x257)]({'where':{'telegramId':_0x3826fa},'data':{'username':_0x11b395,'firstName':_0x2c26a3,'lastName':_0x19a687},'include':{'shop':!![]}}),_0x47bfc7[_0x1a8384(0x182)]&&_0x47bfc7[_0x1a8384(0x24f)]&&_0x47bfc7[_0x1a8384(0x1ca)]?await this[_0x1a8384(0x21f)]?.[_0x1a8384(0x1a5)](_0x47b8db,_0x1a8384(0x1e7)+(_0x1a8384(0x249)+_0x47bfc7[_0x1a8384(0x1ca)][_0x1a8384(0x1bf)]+'*\x0a')+(_0x1a8384(0x18d)+_0x47bfc7[_0x1a8384(0x1ca)][_0x1a8384(0x231)]+'`\x0a\x0a')+_0x1a8384(0x18e)+_0x1a8384(0x1a2)+'•\x20Payment\x20status\x20changes\x0a'+_0x1a8384(0x1e6)+_0x1a8384(0x20b)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x1a8384(0x228),{'parse_mode':_0x1a8384(0x1fb)}):(_0x47bfc7[_0x1a8384(0x24f)]&&!_0x47bfc7['isVerified']&&(await database_1[_0x1a8384(0x17c)][_0x1a8384(0x233)]['update']({'where':{'telegramId':_0x3826fa},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x1a8384(0x213)+_0x3826fa)),await this[_0x1a8384(0x21f)]?.[_0x1a8384(0x1a5)](_0x47b8db,_0x1a8384(0x195)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x1a8384(0x1cf)+_0x1a8384(0x244)+_0x1a8384(0x204)+_0x1a8384(0x190),{'parse_mode':_0x1a8384(0x1fb)}));}catch(_0x5adf39){console['error'](_0x1a8384(0x236),_0x5adf39),await this[_0x1a8384(0x21f)]?.[_0x1a8384(0x1a5)](_0x47b8db,_0x1a8384(0x1dd));}}),this['bot'][_0x36db11(0x187)](/\/disconnect/,async _0x6e6233=>{const _0x507a6a=_0x36db11,_0x35d62e=_0x6e6233[_0x507a6a(0x245)]['id'],_0x4fa13e=_0x6e6233['from']?.['id'][_0x507a6a(0x234)]();if(!_0x4fa13e)return;try{const _0x1532cf=await database_1['default'][_0x507a6a(0x233)][_0x507a6a(0x232)]({'where':{'telegramId':_0x4fa13e},'include':{'shop':!![]}});if(!_0x1532cf||!_0x1532cf[_0x507a6a(0x182)]||!_0x1532cf['shopId']){await this['bot']?.[_0x507a6a(0x1a5)](_0x35d62e,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x24e57f=_0x1532cf[_0x507a6a(0x1ca)]?.[_0x507a6a(0x1bf)]||_0x507a6a(0x23d);await database_1[_0x507a6a(0x17c)][_0x507a6a(0x233)][_0x507a6a(0x257)]({'where':{'telegramId':_0x4fa13e},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔌\x20User\x20'+_0x4fa13e+_0x507a6a(0x22d)+_0x1532cf['shopId']),await this[_0x507a6a(0x21f)]?.['sendMessage'](_0x35d62e,_0x507a6a(0x1ab)+_0x24e57f+_0x507a6a(0x1aa)+_0x507a6a(0x1f5),{'parse_mode':_0x507a6a(0x1fb)});}catch(_0x25259a){console[_0x507a6a(0x25a)]('Error\x20handling\x20/disconnect\x20command:',_0x25259a),await this[_0x507a6a(0x21f)]?.[_0x507a6a(0x1a5)](_0x35d62e,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x36db11(0x21f)][_0x36db11(0x187)](/\/status/,async _0x4ac747=>{const _0xa52cf3=_0x36db11,_0x2e4d25=_0x4ac747['chat']['id'],_0x4e8a9c=_0x4ac747[_0xa52cf3(0x1e5)]?.['id'][_0xa52cf3(0x234)]();if(!_0x4e8a9c)return;try{const _0xd3639a=await database_1['default'][_0xa52cf3(0x233)]['findUnique']({'where':{'telegramId':_0x4e8a9c},'include':{'shop':!![]}});if(!_0xd3639a){await this['bot']?.[_0xa52cf3(0x1a5)](_0x2e4d25,_0xa52cf3(0x1b7)+_0xa52cf3(0x1b5));return;}if(!_0xd3639a['isVerified']||!_0xd3639a[_0xa52cf3(0x24f)]||!_0xd3639a['shop']){await this['bot']?.['sendMessage'](_0x2e4d25,_0xa52cf3(0x20f)+_0xa52cf3(0x1ef));return;}await this[_0xa52cf3(0x21f)]?.[_0xa52cf3(0x1a5)](_0x2e4d25,_0xa52cf3(0x23a)+(_0xa52cf3(0x1bb)+_0xd3639a[_0xa52cf3(0x1ca)][_0xa52cf3(0x1bf)]+'*\x0a')+('👤\x20Username:\x20`'+_0xd3639a[_0xa52cf3(0x1ca)][_0xa52cf3(0x231)]+'`\x0a')+(_0xa52cf3(0x1d3)+_0xd3639a[_0xa52cf3(0x1b9)][_0xa52cf3(0x214)](_0xa52cf3(0x1e9))+'\x0a\x0a')+_0xa52cf3(0x1d1)+_0xa52cf3(0x20b)+_0xa52cf3(0x228),{'parse_mode':'Markdown'});}catch(_0x3f8a94){console['error'](_0xa52cf3(0x1f2),_0x3f8a94),await this[_0xa52cf3(0x21f)]?.['sendMessage'](_0x2e4d25,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x36db11(0x21f)][_0x36db11(0x187)](/\/debug/,async _0xe241cd=>{const _0x59fa31=_0x36db11,_0x4c450b=_0xe241cd['chat']['id'],_0x1de3df=_0xe241cd['from']?.['id'][_0x59fa31(0x234)]();if(!_0x1de3df)return;try{const _0x483b12=await database_1[_0x59fa31(0x17c)][_0x59fa31(0x1ca)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x2b6927=_0x59fa31(0x1f4);_0x2b6927+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x1de3df+_0x59fa31(0x198),_0x2b6927+=_0x59fa31(0x252),_0x483b12[_0x59fa31(0x19f)]((_0x4a4fe6,_0x21243e)=>{const _0x2b918d=_0x59fa31;_0x2b6927+=_0x21243e+0x1+'.\x20*'+_0x4a4fe6[_0x2b918d(0x1bf)]+'*\x0a',_0x2b6927+=_0x2b918d(0x227)+_0x4a4fe6[_0x2b918d(0x231)]+'`\x0a',_0x2b6927+=_0x2b918d(0x222)+_0x4a4fe6['status']+'\x0a',_0x2b6927+=_0x2b918d(0x199)+_0x4a4fe6[_0x2b918d(0x1fa)]['substring'](0x0,0xf)+_0x2b918d(0x1ea);}),await this[_0x59fa31(0x21f)]?.[_0x59fa31(0x1a5)](_0x4c450b,_0x2b6927,{'parse_mode':_0x59fa31(0x1fb)});}catch(_0x52a9d7){console['error'](_0x59fa31(0x1fc),_0x52a9d7),await this['bot']?.['sendMessage'](_0x4c450b,_0x59fa31(0x1c3));}}),this['bot']['on'](_0x36db11(0x1e4),async _0x4106ad=>{const _0x36d1b3=_0x36db11;if(_0x4106ad['text']?.[_0x36d1b3(0x1c6)]('/'))return;const _0x35a701=_0x4106ad[_0x36d1b3(0x245)]['id'],_0x238ee9=_0x4106ad[_0x36d1b3(0x1e5)]?.['id'][_0x36d1b3(0x234)](),_0x3d5934=_0x4106ad[_0x36d1b3(0x1a1)]?.[_0x36d1b3(0x218)]();if(!_0x238ee9||!_0x3d5934)return;try{const _0x3c573d=await database_1[_0x36d1b3(0x17c)]['telegramUser'][_0x36d1b3(0x232)]({'where':{'telegramId':_0x238ee9},'include':{'shop':!![]}});if(!_0x3c573d){await this[_0x36d1b3(0x21f)]?.['sendMessage'](_0x35a701,_0x36d1b3(0x1f6));return;}if(_0x3c573d[_0x36d1b3(0x182)]&&_0x3c573d[_0x36d1b3(0x24f)]&&_0x3c573d[_0x36d1b3(0x1ca)]){await this[_0x36d1b3(0x21f)]?.[_0x36d1b3(0x1a5)](_0x35a701,_0x36d1b3(0x1d6)+_0x3c573d[_0x36d1b3(0x1ca)][_0x36d1b3(0x1bf)]+_0x36d1b3(0x1aa)+_0x36d1b3(0x1f3),{'parse_mode':_0x36d1b3(0x1fb)});return;}const _0x1fcfe4=_0x3d5934['split'](/\s+/);if(_0x1fcfe4[_0x36d1b3(0x21d)]!==0x2){await this[_0x36d1b3(0x21f)]?.[_0x36d1b3(0x1a5)](_0x35a701,_0x36d1b3(0x1f7)+_0x36d1b3(0x1cf)+'Example:\x0a'+_0x36d1b3(0x204)+(_0x36d1b3(0x1b8)+_0x1fcfe4['length']+_0x36d1b3(0x1b4)+_0x1fcfe4[_0x36d1b3(0x205)](_0x20008b=>'`'+_0x20008b+'`')[_0x36d1b3(0x1eb)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x264346,_0x26c75f]=_0x1fcfe4;console['log'](_0x36d1b3(0x23f)+_0x238ee9+':\x20username=\x22'+_0x264346+_0x36d1b3(0x23c)+_0x26c75f['substring'](0x0,0xa)+_0x36d1b3(0x19c)),await this[_0x36d1b3(0x19b)](_0x35a701,_0x238ee9,_0x264346,_0x26c75f);}catch(_0x49fea3){console[_0x36d1b3(0x25a)](_0x36d1b3(0x1d7),_0x49fea3),await this['bot']?.[_0x36d1b3(0x1a5)](_0x35a701,_0x36d1b3(0x1dd));}}),this[_0x36db11(0x21f)]['on'](_0x36db11(0x25a),_0x230acc=>{const _0x5b3f19=_0x36db11;console[_0x5b3f19(0x25a)](_0x5b3f19(0x24d),_0x230acc);}),this[_0x36db11(0x21f)]['on'](_0x36db11(0x18a),_0x5bd5f0=>{const _0x487ef4=_0x36db11;console[_0x487ef4(0x25a)](_0x487ef4(0x22b),_0x5bd5f0);});}async['handleSingleLineVerification'](_0x5a2530,_0x150284,_0x41543b,_0x39f9dd){const _0x5b71a4=a53_0x2e6da7;try{console[_0x5b71a4(0x181)](_0x5b71a4(0x23f)+_0x150284+_0x5b71a4(0x1fd)+_0x41543b+'\x22,\x20apiKey=\x22'+_0x39f9dd[_0x5b71a4(0x192)](0x0,0xa)+_0x5b71a4(0x19c));if(!_0x41543b||_0x41543b[_0x5b71a4(0x21d)]<0x3||_0x41543b['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x5b71a4(0x1cc)](_0x41543b)){await this['bot']?.[_0x5b71a4(0x1a5)](_0x5a2530,_0x5b71a4(0x1bc)+_0x41543b+_0x5b71a4(0x198)+_0x5b71a4(0x196),{'parse_mode':_0x5b71a4(0x1fb)});return;}if(!_0x39f9dd||!_0x39f9dd['startsWith'](_0x5b71a4(0x241))&&!_0x39f9dd['startsWith'](_0x5b71a4(0x210))){await this[_0x5b71a4(0x21f)]?.[_0x5b71a4(0x1a5)](_0x5a2530,_0x5b71a4(0x221)+_0x5b71a4(0x1c0),{'parse_mode':_0x5b71a4(0x1fb)});return;}const _0x174c6d=await database_1[_0x5b71a4(0x17c)][_0x5b71a4(0x1ca)][_0x5b71a4(0x232)]({'where':{'username':_0x41543b},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x174c6d){const _0x2a5a92=await database_1[_0x5b71a4(0x17c)][_0x5b71a4(0x1ca)][_0x5b71a4(0x1c1)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x20d8a6='❌\x20Shop\x20with\x20username\x20`'+_0x41543b+'`\x20not\x20found.\x0a\x0a';_0x2a5a92[_0x5b71a4(0x21d)]>0x0?(_0x20d8a6+=_0x5b71a4(0x211),_0x2a5a92['forEach'](_0x3b4f2f=>{const _0x5124f5=_0x5b71a4;_0x20d8a6+=_0x5124f5(0x1bd)+_0x3b4f2f[_0x5124f5(0x231)]+'`\x20('+_0x3b4f2f['name']+')\x0a';}),_0x20d8a6+=_0x5b71a4(0x206)):_0x20d8a6+=_0x5b71a4(0x19a);await this[_0x5b71a4(0x21f)]?.[_0x5b71a4(0x1a5)](_0x5a2530,_0x20d8a6,{'parse_mode':_0x5b71a4(0x1fb)});return;}if(_0x174c6d[_0x5b71a4(0x1c7)]!=='ACTIVE'){await this[_0x5b71a4(0x21f)]?.[_0x5b71a4(0x1a5)](_0x5a2530,_0x5b71a4(0x1b1)+_0x41543b+_0x5b71a4(0x1ad)+_0x5b71a4(0x17b),{'parse_mode':_0x5b71a4(0x1fb)});return;}if(_0x174c6d[_0x5b71a4(0x1fa)]!==_0x39f9dd&&_0x174c6d['secretKey']!==_0x39f9dd){await this[_0x5b71a4(0x21f)]?.[_0x5b71a4(0x1a5)](_0x5a2530,_0x5b71a4(0x24c)+_0x41543b+_0x5b71a4(0x183)+_0x5b71a4(0x1d9)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x5b71a4(0x1fb)});return;}const _0x2cb6f2=await database_1[_0x5b71a4(0x17c)][_0x5b71a4(0x233)][_0x5b71a4(0x23b)]({'where':{'shopId':_0x174c6d['id'],'isVerified':!![],'telegramId':{'not':_0x150284}}});if(_0x2cb6f2){await this[_0x5b71a4(0x21f)]?.[_0x5b71a4(0x1a5)](_0x5a2530,_0x5b71a4(0x188)+_0x41543b+'`.\x0a\x0a'+_0x5b71a4(0x1c5),{'parse_mode':'Markdown'});return;}await database_1[_0x5b71a4(0x17c)]['telegramUser']['update']({'where':{'telegramId':_0x150284},'data':{'shopId':_0x174c6d['id'],'isVerified':!![]}}),await this[_0x5b71a4(0x21f)]?.[_0x5b71a4(0x1a5)](_0x5a2530,'🎉\x20*Congratulations!*\x0a\x0a'+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x5b71a4(0x1d2)+_0x174c6d['name']+'*\x0a')+(_0x5b71a4(0x1a3)+_0x174c6d['username']+_0x5b71a4(0x198))+_0x5b71a4(0x1ed)+_0x5b71a4(0x1a2)+_0x5b71a4(0x1ee)+_0x5b71a4(0x1a4)+'•\x20Important\x20events\x0a\x0a'+_0x5b71a4(0x20b)+_0x5b71a4(0x237)+_0x5b71a4(0x228),{'parse_mode':'Markdown'}),console['log']('✅\x20Telegram\x20user\x20'+_0x150284+'\x20verified\x20for\x20shop\x20'+_0x174c6d['username']+_0x5b71a4(0x19d));}catch(_0x52a915){console[_0x5b71a4(0x25a)]('Error\x20in\x20handleSingleLineVerification:',_0x52a915),await this[_0x5b71a4(0x21f)]?.[_0x5b71a4(0x1a5)](_0x5a2530,_0x5b71a4(0x220));}}async[a53_0x2e6da7(0x1d8)](_0xf6da08,_0x52eefb,_0x275580){const _0x3d7049=a53_0x2e6da7;if(!this[_0x3d7049(0x21f)]){console[_0x3d7049(0x247)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x467554=await database_1['default']['telegramUser'][_0x3d7049(0x1c1)]({'where':{'shopId':_0xf6da08,'isVerified':!![]}});if(_0x467554[_0x3d7049(0x21d)]===0x0){console['log']('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0xf6da08);return;}const _0x23494f=_0x467554[_0x3d7049(0x205)](async _0x5662e3=>{const _0x3b07d0=_0x3d7049;try{await this['bot']?.[_0x3b07d0(0x1a5)](_0x5662e3[_0x3b07d0(0x209)],_0x52eefb,_0x275580),console[_0x3b07d0(0x181)](_0x3b07d0(0x185)+_0x5662e3[_0x3b07d0(0x209)]);}catch(_0xe4ec06){console[_0x3b07d0(0x25a)](_0x3b07d0(0x230)+_0x5662e3['telegramId']+':',_0xe4ec06),_0xe4ec06 instanceof Error&&(_0xe4ec06[_0x3b07d0(0x1e4)][_0x3b07d0(0x258)](_0x3b07d0(0x1ec))||_0xe4ec06[_0x3b07d0(0x1e4)][_0x3b07d0(0x258)](_0x3b07d0(0x21b))||_0xe4ec06[_0x3b07d0(0x1e4)][_0x3b07d0(0x258)](_0x3b07d0(0x208)))&&(await database_1[_0x3b07d0(0x17c)]['telegramUser']['update']({'where':{'id':_0x5662e3['id']},'data':{'isVerified':![]}}),console[_0x3b07d0(0x181)](_0x3b07d0(0x1df)+_0x5662e3[_0x3b07d0(0x209)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x3d7049(0x24e)](_0x23494f);}catch(_0x3aaf79){console[_0x3d7049(0x25a)](_0x3d7049(0x25d),_0x3aaf79);}}async[a53_0x2e6da7(0x1f9)](_0x3db955,_0x261b72,_0x10f8af){const _0x1c6d3e=a53_0x2e6da7,_0x178399={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x2f4b1c={'created':_0x1c6d3e(0x1b6),'paid':_0x1c6d3e(0x200),'failed':'Payment\x20failed','expired':_0x1c6d3e(0x1fe),'refund':_0x1c6d3e(0x18f),'chargeback':_0x1c6d3e(0x259),'processing':'Payment\x20is\x20being\x20processed'},_0x5159b4=_0x178399[_0x10f8af],_0x30d12f=_0x2f4b1c[_0x10f8af],_0x558a26=(0x0,gateway_1[_0x1c6d3e(0x239)])(_0x261b72[_0x1c6d3e(0x1c8)]);console[_0x1c6d3e(0x181)](_0x1c6d3e(0x1db)+_0x261b72['gateway']+_0x1c6d3e(0x1ac)+_0x558a26+'\x22');let _0x2b0b34=_0x5159b4+'\x20*'+_0x30d12f+'*\x0a\x0a'+(_0x1c6d3e(0x246)+_0x261b72[_0x1c6d3e(0x1a7)]+'\x20'+_0x261b72[_0x1c6d3e(0x212)]+'*\x0a')+(_0x1c6d3e(0x22e)+(_0x261b72[_0x1c6d3e(0x1dc)]||_0x261b72['id'])+'`\x0a')+(_0x1c6d3e(0x251)+_0x261b72['id']+'`\x0a')+(_0x1c6d3e(0x17f)+_0x558a26+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x261b72[_0x1c6d3e(0x255)])[_0x1c6d3e(0x202)](_0x1c6d3e(0x1e9))+'\x0a');(_0x261b72[_0x1c6d3e(0x22f)]||_0x261b72[_0x1c6d3e(0x18c)])&&(_0x2b0b34+=_0x1c6d3e(0x1f1),_0x261b72[_0x1c6d3e(0x22f)]&&(_0x2b0b34+=_0x1c6d3e(0x18b)+_0x261b72[_0x1c6d3e(0x22f)]+'`\x0a'),_0x261b72[_0x1c6d3e(0x18c)]&&(_0x2b0b34+=_0x1c6d3e(0x21a)+_0x261b72[_0x1c6d3e(0x18c)]+'`\x0a')),_0x10f8af==='chargeback'&&_0x261b72[_0x1c6d3e(0x1ff)]&&(_0x2b0b34+=_0x1c6d3e(0x1a6)+_0x261b72['chargebackAmount']+_0x1c6d3e(0x240)),_0x10f8af===_0x1c6d3e(0x1e8)&&(_0x2b0b34+=_0x1c6d3e(0x203)),_0x261b72[_0x1c6d3e(0x235)]&&(_0x2b0b34+=_0x1c6d3e(0x256)+_0x261b72['adminNotes']+'\x0a'),await this[_0x1c6d3e(0x1d8)](_0x3db955,_0x2b0b34,{'parse_mode':_0x1c6d3e(0x1fb)});}async[a53_0x2e6da7(0x1a8)](_0x15d049,_0x27a005,_0x288ef8){const _0x2a0080=a53_0x2e6da7,_0xde0807={'created':'📤','completed':'✅','rejected':'❌'},_0x9b686d={'created':_0x2a0080(0x186),'completed':_0x2a0080(0x20d),'rejected':_0x2a0080(0x1de)},_0x2c199a=_0xde0807[_0x288ef8],_0x647a70=_0x9b686d[_0x288ef8],_0x1c5ada=_0x2c199a+'\x20*'+_0x647a70+_0x2a0080(0x215)+(_0x2a0080(0x23e)+_0x27a005['amount']+_0x2a0080(0x22a))+('🏦\x20Method:\x20`'+_0x27a005[_0x2a0080(0x24b)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x27a005['id']+'`\x0a')+(_0x2a0080(0x25c)+new Date(_0x27a005[_0x2a0080(0x255)])[_0x2a0080(0x202)]('en-US')+'\x0a')+(_0x27a005['txid']?_0x2a0080(0x17a)+_0x27a005['txid']+'`':'');await this[_0x2a0080(0x1d8)](_0x15d049,_0x1c5ada,{'parse_mode':'Markdown'});}async[a53_0x2e6da7(0x1e1)](_0x54d0ce,_0x37e400){const _0x26ebaf=a53_0x2e6da7;try{const _0x3a264e=await database_1[_0x26ebaf(0x17c)]['shopSettings'][_0x26ebaf(0x232)]({'where':{'shopId':_0x54d0ce},'select':{'notificationLogin':!![]}});if(!_0x3a264e?.[_0x26ebaf(0x24a)]){console[_0x26ebaf(0x181)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x54d0ce);return;}const _0x3f657b=_0x37e400['success']?'🔐':'🚨',_0x490ce6=_0x37e400['success']?'Successful\x20login':'Failed\x20login\x20attempt';let _0x19f837=_0x3f657b+'\x20*'+_0x490ce6+_0x26ebaf(0x215)+('👤\x20Username:\x20`'+_0x37e400[_0x26ebaf(0x231)]+'`\x0a')+('📅\x20Time:\x20'+_0x37e400[_0x26ebaf(0x20e)][_0x26ebaf(0x202)]('en-US')+'\x0a');_0x37e400['ipAddress']&&(_0x19f837+=_0x26ebaf(0x1d5)+_0x37e400[_0x26ebaf(0x1cb)]+'`\x0a');if(_0x37e400[_0x26ebaf(0x224)]){const _0x4a0858=_0x37e400[_0x26ebaf(0x224)][_0x26ebaf(0x21d)]>0x32?_0x37e400[_0x26ebaf(0x224)][_0x26ebaf(0x192)](0x0,0x32)+'...':_0x37e400['userAgent'];_0x19f837+=_0x26ebaf(0x207)+_0x4a0858+'`\x0a';}!_0x37e400[_0x26ebaf(0x1c2)]&&(_0x19f837+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this['sendShopNotification'](_0x54d0ce,_0x19f837,{'parse_mode':_0x26ebaf(0x1fb)}),console[_0x26ebaf(0x181)](_0x26ebaf(0x1b0)+_0x54d0ce+':\x20'+(_0x37e400[_0x26ebaf(0x1c2)]?_0x26ebaf(0x1c2):_0x26ebaf(0x1be)));}catch(_0x336369){console[_0x26ebaf(0x25a)](_0x26ebaf(0x21e),_0x336369);}}async[a53_0x2e6da7(0x1ce)](_0xe860df,_0x5a48cf){const _0x262e97=a53_0x2e6da7;try{const _0x5b8e98=await database_1[_0x262e97(0x17c)][_0x262e97(0x1a9)]['findUnique']({'where':{'shopId':_0xe860df},'select':{'notificationApiError':!![]}});if(!_0x5b8e98?.[_0x262e97(0x1d0)]){console[_0x262e97(0x181)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0xe860df);return;}let _0x3ab235='🚨\x20*API\x20Error*\x0a\x0a'+('🔗\x20Endpoint:\x20`'+_0x5a48cf[_0x262e97(0x24b)]+'\x20'+_0x5a48cf[_0x262e97(0x22c)]+'`\x0a')+(_0x262e97(0x1e0)+_0x5a48cf['timestamp']['toLocaleString']('en-US')+'\x0a');_0x5a48cf['statusCode']&&(_0x3ab235+='📊\x20Error\x20code:\x20`'+_0x5a48cf['statusCode']+'`\x0a'),_0x3ab235+=_0x262e97(0x21c)+_0x5a48cf['errorMessage']+'`\x0a',_0x5a48cf[_0x262e97(0x25b)]&&(_0x3ab235+=_0x262e97(0x1ba)+_0x5a48cf['requestId']+'`\x0a'),_0x3ab235+=_0x262e97(0x1f0),await this[_0x262e97(0x1d8)](_0xe860df,_0x3ab235,{'parse_mode':_0x262e97(0x1fb)}),console[_0x262e97(0x181)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0xe860df+':\x20'+_0x5a48cf[_0x262e97(0x22c)]);}catch(_0x378f69){console[_0x262e97(0x25a)](_0x262e97(0x1cd),_0x378f69);}}async[a53_0x2e6da7(0x1d4)](_0x1a6719,_0x3f8621,_0x3188e7){const _0x4cb68b=a53_0x2e6da7;let _0x3d1bfd=_0x4cb68b(0x193)+_0x3f8621+_0x4cb68b(0x215);for(const [_0x1787cf,_0xffb71a]of Object[_0x4cb68b(0x191)](_0x3188e7)){_0xffb71a!==null&&_0xffb71a!==undefined&&(_0x3d1bfd+=_0x1787cf+_0x4cb68b(0x19e)+_0xffb71a+'`\x0a');}await this[_0x4cb68b(0x1d8)](_0x1a6719,_0x3d1bfd,{'parse_mode':'Markdown'});}['getBotInfo'](){const _0x3d14c5=a53_0x2e6da7;return{'isActive':!!this[_0x3d14c5(0x21f)],'username':this[_0x3d14c5(0x189)]};}['stopBot'](){const _0x451df6=a53_0x2e6da7;this[_0x451df6(0x21f)]&&(this[_0x451df6(0x21f)][_0x451df6(0x20c)](),this[_0x451df6(0x21f)]=null,console[_0x451df6(0x181)]('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a53_0x2e6da7(0x1c4)]=TelegramBotService,exports[a53_0x2e6da7(0x17d)]=new TelegramBotService();