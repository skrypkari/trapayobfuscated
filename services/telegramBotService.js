'use strict';function a66_0x124a(_0x2ccccd,_0xcaf0db){const _0x563270=a66_0x5632();return a66_0x124a=function(_0x124a9d,_0x1d564a){_0x124a9d=_0x124a9d-0x78;let _0xf5d539=_0x563270[_0x124a9d];return _0xf5d539;},a66_0x124a(_0x2ccccd,_0xcaf0db);}const a66_0x4b7139=a66_0x124a;function a66_0x5632(){const _0x1ae6bf=['💸\x20Amount:\x20*','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','\x20\x20\x20Status:\x20','notificationLogin','`\x0a\x0a','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','Failed\x20to\x20send\x20API\x20error\x20notification:','forEach','initializeBot','🔗\x20Endpoint:\x20`','Example:\x0a','Error\x20handling\x20message:','__esModule','sendDirectFile','✅\x20Welcome\x20back!\x0a\x0a','customerName','.png','botToken','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','findUnique','/status\x20-\x20check\x20connection\x20status\x0a','To\x20reconnect,\x20use\x20the\x20/start\x20command','📱\x20Telegram\x20notification:\x20gateway\x20\x22','📊\x20Error\x20code:\x20`','730gectBb','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','customerUa','🔔\x20Notifications\x20are\x20active\x0a\x0a','create','telegramBotService','image/jpeg','../types/gateway','sendDocument','3SvLZAB','\x20disconnected\x20from\x20shop\x20','333490MbbRqY','bot','Payment\x20expired','*\x0a\x0a','timestamp','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','•\x20Payouts\x0a\x0a','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','__importDefault','\x20initialized\x20successfully','3211056HQxZtw','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','trim','Contact\x20administrator.','✅\x20File\x20sent\x20to\x20','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','remitterIban','You\x20sent\x20','log','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','❌\x20Error:\x20`','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','2307672EQrDGJ','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Payment\x20is\x20being\x20processed','Use\x20/start\x20to\x20begin.','8605457UmrRNm','handleSingleLineVerification','\x0a👤\x20*Customer\x20Information:*\x0a','❌\x20Shop\x20`','failed',':\x20`','orderId','TelegramBotService','secretKey','...','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','ipAddress','chat','split','🌐\x20IP\x20address:\x20`','map','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','`.\x0a\x0a','\x20\x20\x20Username:\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','toString','telegramUser','\x20via\x20single-line\x20input','📅\x20Date:\x20','updatedAt','publicKey','📊\x20*Connection\x20Status*\x0a\x0a','💻\x20Browser:\x20`','endsWith','\x20parts:\x20','default','shopId','📧\x20Email:\x20`','stopBot','notificationApiError','❌\x20Telegram\x20bot\x20not\x20initialized','Error\x20in\x20handleSingleLineVerification:','Failed\x20to\x20send\x20login\x20notification:','👤\x20Username:\x20`','.\x20*','telegramId','includes','`\x20(','\x22,\x20apiKey=\x22','shopSettings','\x20USD*\x0a','📱\x20Notification\x20sent\x20to\x20','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Username:\x20`','customerIp','message','statusCode','gateway','TELEGRAM_BOT_USERNAME','🌐\x20IP:\x20`','\x20users','🔗\x20TXID:\x20`','findFirst','sendDirectMessage',':\x20username=\x22','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','📅\x20Connection\x20date:\x20','Error\x20sending\x20shop\x20notification:','application/octet-stream','•\x20`','createdAt','env','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','8EzqINv','en-US','trapay_bot','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','🏪\x20Available\x20shops\x20in\x20system:\x0a','sendPaymentNotification','581933AoWUtk','🏦\x20IBAN:\x20`','❌\x20Error\x20sending\x20file\x20to\x20chat:','allSettled','substring','botUsername','...`\x0a\x0a','onText','error','unknown\x20shop','findMany','adminNotes','getGatewayDisplayNameForTelegram','🆔\x20Payment\x20ID:\x20`','customerEmail','isVerified','image/png','Available\x20usernames:\x0a','11963331fKiKHN','setupBotHandlers','application/pdf','\x20verified\x20for\x20shop\x20','Failed\x20login\x20attempt','Payout\x20rejected','💸\x20Penalty\x20amount:\x20*','🔔\x20You\x20receive\x20notifications\x20about:\x0a','*.\x0a\x0a','📛\x20Name:\x20`','polling_error','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','username','Telegram\x20bot\x20polling\x20error:','sendShopNotification','toLocaleString','currency','method','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','📱\x20Your\x20Telegram\x20ID:\x20`','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','🆔\x20Request\x20ID:\x20`','📅\x20Time:\x20','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','6eDRZid','name','Successful\x20login','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','text','txid','chat\x20not\x20found','.pdf','Payment\x20chargeback','❌\x20Error\x20sending\x20direct\x20message:','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','✅\x20Telegram\x20bot\x20@','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','...\x22','🆔\x20Payout\x20ID:\x20`','✅\x20File\x20sent\x20to\x20chat\x20','shop','sendMessage','Markdown','\x20users\x20of\x20shop\x20','join','📝\x20Notes:\x20','.jpeg','•\x20Payment\x20status\x20changes\x0a','userAgent','Check\x20spelling\x20and\x20try\x20again.','❌\x20Please\x20use\x20/start\x20command\x20first','❌\x20Shop\x20with\x20username\x20`','.jpg','📱\x20Shop:\x20*','Error\x20handling\x20/start\x20command:','update','user\x20is\x20deactivated','Payment\x20failed','Commands:\x0a','\x20(@','entries','📱\x20No\x20active\x20Telegram\x20users\x20found','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','endpoint','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','1627000NfjOcf','❌\x20Error\x20getting\x20debug\x20information.','requestId','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','❌\x20Error\x20sending\x20file\x20to\x20shop:','success','processing','Payment\x20refund','`\x20not\x20found.\x0a\x0a','🏪\x20Gateway:\x20`','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','\x20\x20\x20Public\x20Key:\x20`','Telegram\x20bot\x20error:','`\x20is\x20inactive.\x0a\x0a','chargeback','from','🔍\x20*Debug\x20Information*\x0a\x0a','startsWith','💰\x20Amount:\x20*','\x22\x20->\x20display\x20\x22','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','length','TELEGRAM_BOT_TOKEN'];a66_0x5632=function(){return _0x1ae6bf;};return a66_0x5632();}(function(_0x3534c3,_0x479459){const _0x57b11a=a66_0x124a,_0x32614e=_0x3534c3();while(!![]){try{const _0x4e24e5=-parseInt(_0x57b11a(0xaf))/0x1+parseInt(_0x57b11a(0xba))/0x2+parseInt(_0x57b11a(0xad))/0x3*(parseInt(_0x57b11a(0xc8))/0x4)+parseInt(_0x57b11a(0x16c))/0x5+parseInt(_0x57b11a(0x143))/0x6*(parseInt(_0x57b11a(0xcc))/0x7)+-parseInt(_0x57b11a(0x111))/0x8*(-parseInt(_0x57b11a(0x12b))/0x9)+-parseInt(_0x57b11a(0xa4))/0xa*(parseInt(_0x57b11a(0x119))/0xb);if(_0x4e24e5===_0x479459)break;else _0x32614e['push'](_0x32614e['shift']());}catch(_0x30879a){_0x32614e['push'](_0x32614e['shift']());}}}(a66_0x5632,0xd4a87));var __importDefault=this&&this[a66_0x4b7139(0xb8)]||function(_0x2375c9){const _0x5def1f=a66_0x4b7139;return _0x2375c9&&_0x2375c9[_0x5def1f(0x98)]?_0x2375c9:{'default':_0x2375c9};};Object['defineProperty'](exports,a66_0x4b7139(0x98),{'value':!![]}),exports[a66_0x4b7139(0xa9)]=exports[a66_0x4b7139(0xd3)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require('../config/database')),gateway_1=require(a66_0x4b7139(0xab));class TelegramBotService{constructor(){const _0x2d4684=a66_0x4b7139;this[_0x2d4684(0xb0)]=null,this['botToken']=process['env'][_0x2d4684(0x8b)]||'',this[_0x2d4684(0x11e)]=process[_0x2d4684(0x10e)][_0x2d4684(0x101)]||_0x2d4684(0x113),this[_0x2d4684(0x9d)]?this['initializeBot']():console['warn'](_0x2d4684(0x78));}[a66_0x4b7139(0x94)](){const _0x3e0973=a66_0x4b7139;try{this['bot']=new node_telegram_bot_api_1[(_0x3e0973(0xea))](this['botToken'],{'polling':!![]}),this[_0x3e0973(0x12c)](),console[_0x3e0973(0xc3)](_0x3e0973(0x14e)+this['botUsername']+_0x3e0973(0xb9));}catch(_0x2694ae){console[_0x3e0973(0x121)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x2694ae);}}[a66_0x4b7139(0x12c)](){const _0x9f2efb=a66_0x4b7139;if(!this[_0x9f2efb(0xb0)])return;this[_0x9f2efb(0xb0)][_0x9f2efb(0x120)](/\/start/,async _0x2023ad=>{const _0x43ebbe=_0x9f2efb,_0x4a388a=_0x2023ad[_0x43ebbe(0xd8)]['id'],_0x2bb878=_0x2023ad['from']?.['id']['toString'](),_0x1216c3=_0x2023ad[_0x43ebbe(0x84)]?.['username'],_0x4f4d7a=_0x2023ad[_0x43ebbe(0x84)]?.['first_name'],_0x1d6caf=_0x2023ad['from']?.['last_name'];if(!_0x2bb878)return;try{let _0xb4c476=await database_1['default']['telegramUser'][_0x43ebbe(0x9f)]({'where':{'telegramId':_0x2bb878},'include':{'shop':!![]}});!_0xb4c476?(_0xb4c476=await database_1[_0x43ebbe(0xea)][_0x43ebbe(0xe1)][_0x43ebbe(0xa8)]({'data':{'telegramId':_0x2bb878,'username':_0x1216c3,'firstName':_0x4f4d7a,'lastName':_0x1d6caf,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log']('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x2bb878+_0x43ebbe(0x166)+_0x1216c3+')')):_0xb4c476=await database_1[_0x43ebbe(0xea)][_0x43ebbe(0xe1)][_0x43ebbe(0x162)]({'where':{'telegramId':_0x2bb878},'data':{'username':_0x1216c3,'firstName':_0x4f4d7a,'lastName':_0x1d6caf},'include':{'shop':!![]}}),_0xb4c476[_0x43ebbe(0x128)]&&_0xb4c476['shopId']&&_0xb4c476[_0x43ebbe(0x153)]?await this[_0x43ebbe(0xb0)]?.['sendMessage'](_0x4a388a,_0x43ebbe(0x9a)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0xb4c476[_0x43ebbe(0x153)][_0x43ebbe(0x144)]+'*\x0a')+(_0x43ebbe(0xfc)+_0xb4c476['shop'][_0x43ebbe(0x137)]+_0x43ebbe(0x90))+_0x43ebbe(0x132)+'•\x20New\x20payments\x0a'+_0x43ebbe(0x15a)+_0x43ebbe(0xb6)+_0x43ebbe(0x165)+'/status\x20-\x20check\x20connection\x20status\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x43ebbe(0x155)}):(_0xb4c476[_0x43ebbe(0xeb)]&&!_0xb4c476[_0x43ebbe(0x128)]&&(await database_1['default'][_0x43ebbe(0xe1)]['update']({'where':{'telegramId':_0x2bb878},'data':{'shopId':null,'isVerified':![]}}),console[_0x43ebbe(0xc3)](_0x43ebbe(0xd6)+_0x2bb878)),await this[_0x43ebbe(0xb0)]?.[_0x43ebbe(0x154)](_0x4a388a,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x43ebbe(0x89)+_0x43ebbe(0x114)+_0x43ebbe(0x96)+_0x43ebbe(0xc7)+_0x43ebbe(0x136),{'parse_mode':_0x43ebbe(0x155)}));}catch(_0x33e0ba){console[_0x43ebbe(0x121)](_0x43ebbe(0x161),_0x33e0ba),await this[_0x43ebbe(0xb0)]?.[_0x43ebbe(0x154)](_0x4a388a,_0x43ebbe(0x10f));}}),this['bot'][_0x9f2efb(0x120)](/\/disconnect/,async _0x4c9afb=>{const _0x8c83c8=_0x9f2efb,_0x282260=_0x4c9afb[_0x8c83c8(0xd8)]['id'],_0x1d4b23=_0x4c9afb[_0x8c83c8(0x84)]?.['id'][_0x8c83c8(0xe0)]();if(!_0x1d4b23)return;try{const _0x409d47=await database_1[_0x8c83c8(0xea)][_0x8c83c8(0xe1)][_0x8c83c8(0x9f)]({'where':{'telegramId':_0x1d4b23},'include':{'shop':!![]}});if(!_0x409d47||!_0x409d47[_0x8c83c8(0x128)]||!_0x409d47[_0x8c83c8(0xeb)]){await this['bot']?.[_0x8c83c8(0x154)](_0x282260,_0x8c83c8(0x108));return;}const _0x1d026a=_0x409d47[_0x8c83c8(0x153)]?.[_0x8c83c8(0x144)]||_0x8c83c8(0x122);await database_1[_0x8c83c8(0xea)][_0x8c83c8(0xe1)][_0x8c83c8(0x162)]({'where':{'telegramId':_0x1d4b23},'data':{'shopId':null,'isVerified':![]}}),console[_0x8c83c8(0xc3)]('🔌\x20User\x20'+_0x1d4b23+_0x8c83c8(0xae)+_0x409d47[_0x8c83c8(0xeb)]),await this[_0x8c83c8(0xb0)]?.[_0x8c83c8(0x154)](_0x282260,_0x8c83c8(0xc5)+_0x1d026a+_0x8c83c8(0x133)+_0x8c83c8(0xa1),{'parse_mode':_0x8c83c8(0x155)});}catch(_0x5cb779){console[_0x8c83c8(0x121)]('Error\x20handling\x20/disconnect\x20command:',_0x5cb779),await this[_0x8c83c8(0xb0)]?.[_0x8c83c8(0x154)](_0x282260,_0x8c83c8(0x10f));}}),this['bot'][_0x9f2efb(0x120)](/\/status/,async _0xbe58de=>{const _0x3435e6=_0x9f2efb,_0x51df92=_0xbe58de[_0x3435e6(0xd8)]['id'],_0x268476=_0xbe58de[_0x3435e6(0x84)]?.['id'][_0x3435e6(0xe0)]();if(!_0x268476)return;try{const _0x49fb20=await database_1['default'][_0x3435e6(0xe1)][_0x3435e6(0x9f)]({'where':{'telegramId':_0x268476},'include':{'shop':!![]}});if(!_0x49fb20){await this[_0x3435e6(0xb0)]?.['sendMessage'](_0x51df92,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x3435e6(0xcb));return;}if(!_0x49fb20[_0x3435e6(0x128)]||!_0x49fb20[_0x3435e6(0xeb)]||!_0x49fb20[_0x3435e6(0x153)]){await this[_0x3435e6(0xb0)]?.[_0x3435e6(0x154)](_0x51df92,_0x3435e6(0xb4)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x3435e6(0xb0)]?.[_0x3435e6(0x154)](_0x51df92,_0x3435e6(0xe6)+('✅\x20Connected\x20to\x20shop:\x20*'+_0x49fb20['shop'][_0x3435e6(0x144)]+'*\x0a')+('👤\x20Username:\x20`'+_0x49fb20[_0x3435e6(0x153)][_0x3435e6(0x137)]+'`\x0a')+(_0x3435e6(0x109)+_0x49fb20[_0x3435e6(0xe4)]['toLocaleDateString']('en-US')+'\x0a\x0a')+_0x3435e6(0xa7)+_0x3435e6(0x165)+_0x3435e6(0xdf),{'parse_mode':_0x3435e6(0x155)});}catch(_0x45498d){console[_0x3435e6(0x121)]('Error\x20handling\x20/status\x20command:',_0x45498d),await this[_0x3435e6(0xb0)]?.[_0x3435e6(0x154)](_0x51df92,_0x3435e6(0x10f));}}),this[_0x9f2efb(0xb0)][_0x9f2efb(0x120)](/\/debug/,async _0x49a9fb=>{const _0x12cdae=_0x9f2efb,_0x141552=_0x49a9fb[_0x12cdae(0xd8)]['id'],_0x1b50d2=_0x49a9fb[_0x12cdae(0x84)]?.['id'][_0x12cdae(0xe0)]();if(!_0x1b50d2)return;try{const _0x1c38ae=await database_1[_0x12cdae(0xea)][_0x12cdae(0x153)][_0x12cdae(0x123)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x1cb637=_0x12cdae(0x85);_0x1cb637+=_0x12cdae(0x13e)+_0x1b50d2+_0x12cdae(0x90),_0x1cb637+=_0x12cdae(0x117),_0x1c38ae[_0x12cdae(0x93)]((_0x18e3d4,_0x52c573)=>{const _0x3943b4=_0x12cdae;_0x1cb637+=_0x52c573+0x1+_0x3943b4(0xf3)+_0x18e3d4[_0x3943b4(0x144)]+'*\x0a',_0x1cb637+=_0x3943b4(0xde)+_0x18e3d4[_0x3943b4(0x137)]+'`\x0a',_0x1cb637+=_0x3943b4(0x8e)+_0x18e3d4['status']+'\x0a',_0x1cb637+=_0x3943b4(0x80)+_0x18e3d4['publicKey'][_0x3943b4(0x11d)](0x0,0xf)+_0x3943b4(0x11f);}),await this[_0x12cdae(0xb0)]?.[_0x12cdae(0x154)](_0x141552,_0x1cb637,{'parse_mode':_0x12cdae(0x155)});}catch(_0x3abb98){console[_0x12cdae(0x121)]('Error\x20handling\x20/debug\x20command:',_0x3abb98),await this[_0x12cdae(0xb0)]?.[_0x12cdae(0x154)](_0x141552,_0x12cdae(0x16d));}}),this[_0x9f2efb(0xb0)]['on'](_0x9f2efb(0xfe),async _0x3f060e=>{const _0x650b35=_0x9f2efb;if(_0x3f060e['text']?.[_0x650b35(0x86)]('/'))return;const _0x1b400e=_0x3f060e[_0x650b35(0xd8)]['id'],_0x469bae=_0x3f060e[_0x650b35(0x84)]?.['id'][_0x650b35(0xe0)](),_0x2c5f76=_0x3f060e[_0x650b35(0x147)]?.[_0x650b35(0xbd)]();if(!_0x469bae||!_0x2c5f76)return;try{const _0x361ddb=await database_1['default'][_0x650b35(0xe1)][_0x650b35(0x9f)]({'where':{'telegramId':_0x469bae},'include':{'shop':!![]}});if(!_0x361ddb){await this[_0x650b35(0xb0)]?.[_0x650b35(0x154)](_0x1b400e,_0x650b35(0x15d));return;}if(_0x361ddb[_0x650b35(0x128)]&&_0x361ddb['shopId']&&_0x361ddb[_0x650b35(0x153)]){await this[_0x650b35(0xb0)]?.[_0x650b35(0x154)](_0x1b400e,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x361ddb['shop'][_0x650b35(0x144)]+_0x650b35(0x133)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x650b35(0x155)});return;}const _0x289695=_0x2c5f76[_0x650b35(0xd9)](/\s+/);if(_0x289695['length']!==0x2){await this[_0x650b35(0xb0)]?.[_0x650b35(0x154)](_0x1b400e,_0x650b35(0x16b)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x650b35(0x96)+_0x650b35(0xc7)+(_0x650b35(0xc2)+_0x289695[_0x650b35(0x8a)]+_0x650b35(0xe9)+_0x289695[_0x650b35(0xdb)](_0x378c98=>'`'+_0x378c98+'`')[_0x650b35(0x157)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x199c52,_0x468564]=_0x289695;console[_0x650b35(0xc3)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x469bae+_0x650b35(0x107)+_0x199c52+_0x650b35(0xf7)+_0x468564[_0x650b35(0x11d)](0x0,0xa)+'...\x22'),await this[_0x650b35(0xcd)](_0x1b400e,_0x469bae,_0x199c52,_0x468564);}catch(_0x1e1dd3){console['error'](_0x650b35(0x97),_0x1e1dd3),await this[_0x650b35(0xb0)]?.[_0x650b35(0x154)](_0x1b400e,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x9f2efb(0xb0)]['on'](_0x9f2efb(0x121),_0x54628b=>{const _0x59e35a=_0x9f2efb;console[_0x59e35a(0x121)](_0x59e35a(0x81),_0x54628b);}),this[_0x9f2efb(0xb0)]['on'](_0x9f2efb(0x135),_0x1b003b=>{const _0x1ca3ce=_0x9f2efb;console[_0x1ca3ce(0x121)](_0x1ca3ce(0x138),_0x1b003b);});}async[a66_0x4b7139(0xcd)](_0x10d1a5,_0x13f18d,_0x171879,_0x5210dd){const _0x34b774=a66_0x4b7139;try{console[_0x34b774(0xc3)](_0x34b774(0x116)+_0x13f18d+_0x34b774(0x107)+_0x171879+_0x34b774(0xf7)+_0x5210dd[_0x34b774(0x11d)](0x0,0xa)+_0x34b774(0x150));if(!_0x171879||_0x171879[_0x34b774(0x8a)]<0x3||_0x171879['length']>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x171879)){await this[_0x34b774(0xb0)]?.[_0x34b774(0x154)](_0x10d1a5,'❌\x20Invalid\x20username\x20format:\x20`'+_0x171879+_0x34b774(0x90)+_0x34b774(0x14d),{'parse_mode':_0x34b774(0x155)});return;}if(!_0x5210dd||!_0x5210dd['startsWith']('pk_')&&!_0x5210dd[_0x34b774(0x86)]('sk_')){await this[_0x34b774(0xb0)]?.[_0x34b774(0x154)](_0x10d1a5,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x34b774(0xbc),{'parse_mode':_0x34b774(0x155)});return;}const _0xee7d9b=await database_1[_0x34b774(0xea)][_0x34b774(0x153)][_0x34b774(0x9f)]({'where':{'username':_0x171879},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0xee7d9b){const _0x55bafe=await database_1['default'][_0x34b774(0x153)][_0x34b774(0x123)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0xbc767f=_0x34b774(0x15e)+_0x171879+_0x34b774(0x7d);_0x55bafe['length']>0x0?(_0xbc767f+=_0x34b774(0x12a),_0x55bafe[_0x34b774(0x93)](_0x30af0d=>{const _0x1b43eb=_0x34b774;_0xbc767f+=_0x1b43eb(0x10c)+_0x30af0d[_0x1b43eb(0x137)]+_0x1b43eb(0xf6)+_0x30af0d['name']+')\x0a';}),_0xbc767f+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0xbc767f+=_0x34b774(0x15c);await this[_0x34b774(0xb0)]?.[_0x34b774(0x154)](_0x10d1a5,_0xbc767f,{'parse_mode':_0x34b774(0x155)});return;}if(_0xee7d9b['status']!=='ACTIVE'){await this[_0x34b774(0xb0)]?.[_0x34b774(0x154)](_0x10d1a5,_0x34b774(0xcf)+_0x171879+_0x34b774(0x82)+_0x34b774(0xbe),{'parse_mode':_0x34b774(0x155)});return;}if(_0xee7d9b[_0x34b774(0xe5)]!==_0x5210dd&&_0xee7d9b[_0x34b774(0xd4)]!==_0x5210dd){await this[_0x34b774(0xb0)]?.[_0x34b774(0x154)](_0x10d1a5,_0x34b774(0xbb)+_0x171879+'`.\x0a\x0a'+_0x34b774(0xc0)+_0x34b774(0x115),{'parse_mode':_0x34b774(0x155)});return;}const _0x419323=await database_1['default'][_0x34b774(0xe1)][_0x34b774(0x105)]({'where':{'shopId':_0xee7d9b['id'],'isVerified':!![],'telegramId':{'not':_0x13f18d}}});if(_0x419323){await this[_0x34b774(0xb0)]?.[_0x34b774(0x154)](_0x10d1a5,_0x34b774(0x16f)+_0x171879+_0x34b774(0xdd)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x34b774(0x155)});return;}await database_1['default']['telegramUser'][_0x34b774(0x162)]({'where':{'telegramId':_0x13f18d},'data':{'shopId':_0xee7d9b['id'],'isVerified':!![]}}),await this[_0x34b774(0xb0)]?.[_0x34b774(0x154)](_0x10d1a5,'🎉\x20*Congratulations!*\x0a\x0a'+_0x34b774(0x14f)+(_0x34b774(0x160)+_0xee7d9b[_0x34b774(0x144)]+'*\x0a')+('👤\x20Username:\x20`'+_0xee7d9b[_0x34b774(0x137)]+_0x34b774(0x90))+_0x34b774(0x142)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+'•\x20Payouts\x0a'+'•\x20Important\x20events\x0a\x0a'+_0x34b774(0x165)+_0x34b774(0xa0)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x34b774(0x155)}),console[_0x34b774(0xc3)]('✅\x20Telegram\x20user\x20'+_0x13f18d+_0x34b774(0x12e)+_0xee7d9b[_0x34b774(0x137)]+_0x34b774(0xe2));}catch(_0x32eed5){console[_0x34b774(0x121)](_0x34b774(0xf0),_0x32eed5),await this[_0x34b774(0xb0)]?.['sendMessage'](_0x10d1a5,_0x34b774(0xc9));}}async[a66_0x4b7139(0x139)](_0x5ae1cf,_0x2a7f19,_0x237fce){const _0x5e48af=a66_0x4b7139;if(!this['bot']){console['warn'](_0x5e48af(0xa5));return;}try{const _0x4910f2=await database_1[_0x5e48af(0xea)][_0x5e48af(0xe1)][_0x5e48af(0x123)]({'where':{'shopId':_0x5ae1cf,'isVerified':!![]}});if(_0x4910f2[_0x5e48af(0x8a)]===0x0){console['log'](_0x5e48af(0xb7)+_0x5ae1cf);return;}const _0x1e6a16=_0x4910f2[_0x5e48af(0xdb)](async _0x2678cf=>{const _0x28ae54=_0x5e48af;try{await this[_0x28ae54(0xb0)]?.[_0x28ae54(0x154)](_0x2678cf['telegramId'],_0x2a7f19,_0x237fce),console[_0x28ae54(0xc3)](_0x28ae54(0x91)+_0x2678cf[_0x28ae54(0xf4)]);}catch(_0x234160){console[_0x28ae54(0x121)](_0x28ae54(0x9e)+_0x2678cf[_0x28ae54(0xf4)]+':',_0x234160),_0x234160 instanceof Error&&(_0x234160[_0x28ae54(0xfe)][_0x28ae54(0xf5)]('blocked')||_0x234160[_0x28ae54(0xfe)]['includes'](_0x28ae54(0x149))||_0x234160[_0x28ae54(0xfe)]['includes'](_0x28ae54(0x163)))&&(await database_1[_0x28ae54(0xea)][_0x28ae54(0xe1)][_0x28ae54(0x162)]({'where':{'id':_0x2678cf['id']},'data':{'isVerified':![]}}),console[_0x28ae54(0xc3)]('User\x20'+_0x2678cf[_0x28ae54(0xf4)]+_0x28ae54(0x146)));}});await Promise[_0x5e48af(0x11c)](_0x1e6a16);}catch(_0x14422b){console[_0x5e48af(0x121)](_0x5e48af(0x10a),_0x14422b);}}async[a66_0x4b7139(0x118)](_0x4674ca,_0x17dbce,_0x420c58){const _0x2abf3a=a66_0x4b7139,_0x17112b={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x538c11={'created':'New\x20payment\x20created','paid':'Payment\x20successfully\x20paid','failed':_0x2abf3a(0x164),'expired':_0x2abf3a(0xb1),'refund':_0x2abf3a(0x7c),'chargeback':_0x2abf3a(0x14b),'processing':_0x2abf3a(0xca)},_0x455f07=_0x17112b[_0x420c58],_0x342223=_0x538c11[_0x420c58],_0x408555=(0x0,gateway_1[_0x2abf3a(0x125)])(_0x17dbce[_0x2abf3a(0x100)]);console[_0x2abf3a(0xc3)](_0x2abf3a(0xa2)+_0x17dbce[_0x2abf3a(0x100)]+_0x2abf3a(0x88)+_0x408555+'\x22');let _0x30f343=_0x455f07+'\x20*'+_0x342223+_0x2abf3a(0xb2)+(_0x2abf3a(0x87)+_0x17dbce['amount']+'\x20'+_0x17dbce[_0x2abf3a(0x13b)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x17dbce[_0x2abf3a(0xd2)]||_0x17dbce['id'])+'`\x0a')+(_0x2abf3a(0x126)+_0x17dbce['id']+'`\x0a')+(_0x2abf3a(0x7e)+_0x408555+'`\x0a')+(_0x2abf3a(0xe3)+new Date(_0x17dbce[_0x2abf3a(0x10d)])[_0x2abf3a(0x13a)](_0x2abf3a(0x112))+'\x0a');if(_0x17dbce['customerName']||_0x17dbce[_0x2abf3a(0x127)]||_0x17dbce[_0x2abf3a(0xc1)]||_0x17dbce[_0x2abf3a(0xfd)]||_0x17dbce[_0x2abf3a(0xa6)]){_0x30f343+=_0x2abf3a(0xce);_0x17dbce[_0x2abf3a(0x9b)]&&(_0x30f343+=_0x2abf3a(0x134)+_0x17dbce[_0x2abf3a(0x9b)]+'`\x0a');_0x17dbce['customerEmail']&&(_0x30f343+=_0x2abf3a(0xec)+_0x17dbce[_0x2abf3a(0x127)]+'`\x0a');_0x17dbce[_0x2abf3a(0xc1)]&&(_0x30f343+=_0x2abf3a(0x11a)+_0x17dbce[_0x2abf3a(0xc1)]+'`\x0a');_0x17dbce['customerIp']&&(_0x30f343+=_0x2abf3a(0x102)+_0x17dbce[_0x2abf3a(0xfd)]+'`\x0a');if(_0x17dbce[_0x2abf3a(0xa6)]){const _0x593dfe=_0x17dbce[_0x2abf3a(0xa6)][_0x2abf3a(0x8a)]>0x32?_0x17dbce[_0x2abf3a(0xa6)]['substring'](0x0,0x32)+_0x2abf3a(0xd5):_0x17dbce[_0x2abf3a(0xa6)];_0x30f343+=_0x2abf3a(0xe7)+_0x593dfe+'`\x0a';}}_0x420c58===_0x2abf3a(0x83)&&_0x17dbce['chargebackAmount']&&(_0x30f343+=_0x2abf3a(0x131)+_0x17dbce['chargebackAmount']+'\x20USDT*\x0a'),_0x420c58===_0x2abf3a(0x7b)&&(_0x30f343+=_0x2abf3a(0x13d)),_0x17dbce['adminNotes']&&(_0x30f343+=_0x2abf3a(0x158)+_0x17dbce[_0x2abf3a(0x124)]+'\x0a'),await this['sendShopNotification'](_0x4674ca,_0x30f343,{'parse_mode':_0x2abf3a(0x155)});}async['sendPayoutNotification'](_0x8e8eeb,_0x45b999,_0x5db706){const _0x4b592b=a66_0x4b7139,_0x53bf0a={'created':'📤','completed':'✅','rejected':'❌'},_0x956d05={'created':'New\x20payout\x20created','completed':'Payout\x20completed','rejected':_0x4b592b(0x130)},_0xdc64e0=_0x53bf0a[_0x5db706],_0x356393=_0x956d05[_0x5db706],_0x17e2e2=_0xdc64e0+'\x20*'+_0x356393+'*\x0a\x0a'+(_0x4b592b(0x8c)+_0x45b999['amount']+_0x4b592b(0xf9))+('🏦\x20Method:\x20`'+_0x45b999[_0x4b592b(0x13c)]+'`\x0a')+(_0x4b592b(0x151)+_0x45b999['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x45b999[_0x4b592b(0x10d)])['toLocaleString']('en-US')+'\x0a')+(_0x45b999['txid']?_0x4b592b(0x104)+_0x45b999[_0x4b592b(0x148)]+'`':'');await this['sendShopNotification'](_0x8e8eeb,_0x17e2e2,{'parse_mode':'Markdown'});}async['sendLoginNotification'](_0x20880b,_0x25d9c0){const _0x280edc=a66_0x4b7139;try{const _0x4fd5c0=await database_1['default'][_0x280edc(0xf8)]['findUnique']({'where':{'shopId':_0x20880b},'select':{'notificationLogin':!![]}});if(!_0x4fd5c0?.[_0x280edc(0x8f)]){console['log']('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x20880b);return;}const _0x118037=_0x25d9c0['success']?'🔐':'🚨',_0x2efd7a=_0x25d9c0[_0x280edc(0x7a)]?_0x280edc(0x145):_0x280edc(0x12f);let _0x34a7bf=_0x118037+'\x20*'+_0x2efd7a+_0x280edc(0xb2)+(_0x280edc(0xf2)+_0x25d9c0[_0x280edc(0x137)]+'`\x0a')+(_0x280edc(0x141)+_0x25d9c0[_0x280edc(0xb3)][_0x280edc(0x13a)](_0x280edc(0x112))+'\x0a');_0x25d9c0['ipAddress']&&(_0x34a7bf+=_0x280edc(0xda)+_0x25d9c0[_0x280edc(0xd7)]+'`\x0a');if(_0x25d9c0[_0x280edc(0x15b)]){const _0x387c25=_0x25d9c0[_0x280edc(0x15b)][_0x280edc(0x8a)]>0x32?_0x25d9c0[_0x280edc(0x15b)]['substring'](0x0,0x32)+_0x280edc(0xd5):_0x25d9c0[_0x280edc(0x15b)];_0x34a7bf+='💻\x20Browser:\x20`'+_0x387c25+'`\x0a';}!_0x25d9c0[_0x280edc(0x7a)]&&(_0x34a7bf+=_0x280edc(0x169)),await this[_0x280edc(0x139)](_0x20880b,_0x34a7bf,{'parse_mode':_0x280edc(0x155)}),console[_0x280edc(0xc3)](_0x280edc(0x13f)+_0x20880b+':\x20'+(_0x25d9c0['success']?_0x280edc(0x7a):_0x280edc(0xd0)));}catch(_0x5483f1){console[_0x280edc(0x121)](_0x280edc(0xf1),_0x5483f1);}}async['sendApiErrorNotification'](_0x2e2f93,_0x33c110){const _0x292ae2=a66_0x4b7139;try{const _0x53de86=await database_1[_0x292ae2(0xea)][_0x292ae2(0xf8)]['findUnique']({'where':{'shopId':_0x2e2f93},'select':{'notificationApiError':!![]}});if(!_0x53de86?.[_0x292ae2(0xee)]){console[_0x292ae2(0xc3)](_0x292ae2(0xfb)+_0x2e2f93);return;}let _0x2e4ac3='🚨\x20*API\x20Error*\x0a\x0a'+(_0x292ae2(0x95)+_0x33c110[_0x292ae2(0x13c)]+'\x20'+_0x33c110[_0x292ae2(0x16a)]+'`\x0a')+(_0x292ae2(0x141)+_0x33c110['timestamp'][_0x292ae2(0x13a)]('en-US')+'\x0a');_0x33c110['statusCode']&&(_0x2e4ac3+=_0x292ae2(0xa3)+_0x33c110[_0x292ae2(0xff)]+'`\x0a'),_0x2e4ac3+=_0x292ae2(0xc6)+_0x33c110['errorMessage']+'`\x0a',_0x33c110[_0x292ae2(0x16e)]&&(_0x2e4ac3+=_0x292ae2(0x140)+_0x33c110[_0x292ae2(0x16e)]+'`\x0a'),_0x2e4ac3+=_0x292ae2(0xdc),await this['sendShopNotification'](_0x2e2f93,_0x2e4ac3,{'parse_mode':_0x292ae2(0x155)}),console['log'](_0x292ae2(0x7f)+_0x2e2f93+':\x20'+_0x33c110[_0x292ae2(0x16a)]);}catch(_0xd6db11){console[_0x292ae2(0x121)](_0x292ae2(0x92),_0xd6db11);}}async['sendCustomNotification'](_0xe06512,_0x2692a0,_0x1d6ef2){const _0x4395a8=a66_0x4b7139;let _0x3c28c4='🔔\x20*'+_0x2692a0+'*\x0a\x0a';for(const [_0x388715,_0x429ba6]of Object[_0x4395a8(0x167)](_0x1d6ef2)){_0x429ba6!==null&&_0x429ba6!==undefined&&(_0x3c28c4+=_0x388715+_0x4395a8(0xd1)+_0x429ba6+'`\x0a');}await this[_0x4395a8(0x139)](_0xe06512,_0x3c28c4,{'parse_mode':_0x4395a8(0x155)});}async['sendNotificationToAll'](_0x8d62f5){const _0x120368=a66_0x4b7139;try{console['log']('📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20'+_0x8d62f5[_0x120368(0x11d)](0x0,0x32)+_0x120368(0xd5));const _0x249cea=await database_1[_0x120368(0xea)][_0x120368(0xe1)]['findMany']({'select':{'telegramId':!![]}});if(_0x249cea[_0x120368(0x8a)]===0x0){console['log'](_0x120368(0x168));return;}for(const _0x1f07bf of _0x249cea){try{await this[_0x120368(0xb0)]?.['sendMessage'](_0x1f07bf['telegramId'],_0x8d62f5,{'parse_mode':_0x120368(0x155)});}catch(_0x576d92){console[_0x120368(0x121)](_0x120368(0x8d)+_0x1f07bf[_0x120368(0xf4)]+':',_0x576d92);}}console['log'](_0x120368(0xfa)+_0x249cea[_0x120368(0x8a)]+_0x120368(0x103));}catch(_0x4c7121){console[_0x120368(0x121)](_0x120368(0x110),_0x4c7121);}}['getBotInfo'](){const _0x5d796b=a66_0x4b7139;return{'isActive':!!this[_0x5d796b(0xb0)],'username':this[_0x5d796b(0x11e)]};}async['sendShopFile'](_0x3a7031,_0x832a6a,_0x374f62,_0x542c89){const _0x269cc4=a66_0x4b7139;try{if(!this[_0x269cc4(0xb0)])return console[_0x269cc4(0x121)]('❌\x20Telegram\x20bot\x20not\x20initialized'),![];const _0x51f07f=await database_1[_0x269cc4(0xea)][_0x269cc4(0xe1)][_0x269cc4(0x123)]({'where':{'shopId':_0x3a7031,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x51f07f[_0x269cc4(0x8a)]===0x0)return console[_0x269cc4(0x121)](_0x269cc4(0xb5)+_0x3a7031),![];let _0x9f0ba7=0x0;for(const _0x59185b of _0x51f07f){try{await this[_0x269cc4(0xb0)][_0x269cc4(0xac)](_0x59185b[_0x269cc4(0xf4)],_0x832a6a,{},{'filename':_0x374f62,'contentType':_0x374f62[_0x269cc4(0xe8)](_0x269cc4(0x9c))?_0x269cc4(0x129):_0x374f62['endsWith'](_0x269cc4(0x15f))||_0x374f62[_0x269cc4(0xe8)](_0x269cc4(0x159))?'image/jpeg':_0x374f62[_0x269cc4(0xe8)](_0x269cc4(0x14a))?_0x269cc4(0x12d):_0x269cc4(0x10b)}),_0x542c89&&await this['bot']['sendMessage'](_0x59185b[_0x269cc4(0xf4)],_0x542c89),_0x9f0ba7++;}catch(_0x26e06f){console[_0x269cc4(0x121)]('❌\x20Error\x20sending\x20file\x20to\x20user\x20'+_0x59185b['telegramId']+':',_0x26e06f);}}return console[_0x269cc4(0xc3)](_0x269cc4(0xbf)+_0x9f0ba7+'/'+_0x51f07f[_0x269cc4(0x8a)]+_0x269cc4(0x156)+_0x3a7031+':\x20'+_0x374f62),_0x9f0ba7>0x0;}catch(_0x3672ab){return console[_0x269cc4(0x121)](_0x269cc4(0x79),_0x3672ab),![];}}async[a66_0x4b7139(0x106)](_0x488dea,_0x1880e7){const _0x4fba1e=a66_0x4b7139;try{if(!this['bot'])return console[_0x4fba1e(0x121)](_0x4fba1e(0xef)),![];return await this['bot'][_0x4fba1e(0x154)](_0x488dea,_0x1880e7),console['log'](_0x4fba1e(0xc4)+_0x488dea),!![];}catch(_0x59c205){return console[_0x4fba1e(0x121)](_0x4fba1e(0x14c),_0x59c205),![];}}async[a66_0x4b7139(0x99)](_0xe4716c,_0x503dd8,_0x2962df,_0x1d2898){const _0x35df82=a66_0x4b7139;try{if(!this[_0x35df82(0xb0)])return console[_0x35df82(0x121)](_0x35df82(0xef)),![];return await this[_0x35df82(0xb0)][_0x35df82(0xac)](_0xe4716c,_0x503dd8,{},{'filename':_0x2962df,'contentType':_0x2962df['endsWith']('.png')?_0x35df82(0x129):_0x2962df[_0x35df82(0xe8)](_0x35df82(0x15f))||_0x2962df[_0x35df82(0xe8)](_0x35df82(0x159))?_0x35df82(0xaa):_0x2962df[_0x35df82(0xe8)]('.pdf')?'application/pdf':_0x35df82(0x10b)}),_0x1d2898&&await this[_0x35df82(0xb0)][_0x35df82(0x154)](_0xe4716c,_0x1d2898),console['log'](_0x35df82(0x152)+_0xe4716c+':\x20'+_0x2962df),!![];}catch(_0x3b834a){return console['error'](_0x35df82(0x11b),_0x3b834a),![];}}[a66_0x4b7139(0xed)](){const _0x1c7ff0=a66_0x4b7139;this[_0x1c7ff0(0xb0)]&&(this[_0x1c7ff0(0xb0)]['stopPolling'](),this[_0x1c7ff0(0xb0)]=null,console[_0x1c7ff0(0xc3)]('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a66_0x4b7139(0xd3)]=TelegramBotService,exports[a66_0x4b7139(0xa9)]=new TelegramBotService();