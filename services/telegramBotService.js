'use strict';function a52_0x28c2(){const _0x19ff11=['23209270KMzeOd','default','💻\x20Browser:\x20`','name','substring','🆔\x20Request\x20ID:\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','Payment\x20is\x20being\x20processed','🆔\x20Payment\x20ID:\x20`','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','•\x20Important\x20events\x0a\x0a','success','\x20initialized\x20successfully','sendCustomNotification','entries','TELEGRAM_BOT_USERNAME','2017142nymtUI','method','shopId','includes','polling_error','New\x20payout\x20created','9TXtcCA','en-US','2728095jlyaGF','`\x20not\x20found.\x0a\x0a','✅\x20Telegram\x20bot\x20@','👤\x20Username:\x20`','Markdown','Check\x20spelling\x20and\x20try\x20again.','Use\x20/start\x20to\x20begin.','length','currency','getBotInfo','🔗\x20Endpoint:\x20`','createdAt','startsWith','📝\x20Notes:\x20','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','toLocaleString','gateway','*\x0a\x0a','Payment\x20chargeback','TELEGRAM_BOT_TOKEN','...`\x0a\x0a','../config/database','customerName','message','\x22,\x20apiKey=\x22','trim','endpoint','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','188321UBwWRx','📊\x20*Connection\x20Status*\x0a\x0a','TelegramBotService','🆔\x20Payout\x20ID:\x20`','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','stopBot','shop','💸\x20Amount:\x20*','username','`.\x0a\x0a','bot','Use\x20/start\x20to\x20connect.','chat\x20not\x20found','botToken','txid','from','Error\x20in\x20handleSingleLineVerification:','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','Payment\x20expired','warn','💸\x20Penalty\x20amount:\x20*',':\x20`','❌\x20Shop\x20with\x20username\x20`','•\x20Payouts\x0a\x0a','.\x20*','🔌\x20User\x20','customerEmail','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','sendPayoutNotification','test','node-telegram-bot-api','\x20disconnected\x20from\x20shop\x20','Successful\x20login','chargeback','\x0aCheck\x20spelling\x20and\x20try\x20again.','To\x20reconnect,\x20use\x20the\x20/start\x20command','last_name','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','📅\x20Connection\x20date:\x20','publicKey','📝\x20Order\x20ID:\x20`','defineProperty','🎉\x20*Congratulations!*\x0a\x0a','Failed\x20to\x20send\x20API\x20error\x20notification:','2562186MEIbHD','🚨\x20*API\x20Error*\x0a\x0a','•\x20Payouts\x0a','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','split','\x20USD*\x0a','📱\x20Shop:\x20*','ACTIVE','\x20via\x20single-line\x20input','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','handleSingleLineVerification','notificationApiError','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','map','forEach','failed','setupBotHandlers','userAgent','statusCode','amount','📧\x20Email:\x20`','status','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','first_name','requestId','88fKzAmw','errorMessage','/status\x20-\x20check\x20connection\x20status\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','timestamp','findUnique','🏪\x20Gateway:\x20`','\x20\x20\x20Public\x20Key:\x20`','updatedAt','chat','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','📛\x20Name:\x20`','env','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','❌\x20Please\x20use\x20/start\x20command\x20first','User\x20','ipAddress','Example:\x0a','__esModule','processing','77102QAGTtq','Error\x20sending\x20shop\x20notification:','🔗\x20TXID:\x20`','chargebackAmount','Commands:\x0a','sendLoginNotification','text','Error\x20handling\x20message:','sendMessage','Telegram\x20bot\x20polling\x20error:','/disconnect\x20-\x20disconnect\x20from\x20notifications','isVerified','shopSettings','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','\x0a👤\x20*Customer\x20Information:*\x0a','📱\x20Created\x20new\x20Telegram\x20user:\x20','💰\x20Amount:\x20*','Contact\x20administrator.','Error\x20handling\x20/start\x20command:','onText','trapay_bot','../types/gateway','adminNotes','`\x0a\x0a','❌\x20Error:\x20`','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','Payment\x20successfully\x20paid','🏦\x20Method:\x20`',':\x20username=\x22','5QFImUK','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','🌐\x20IP\x20address:\x20`','\x20verified\x20for\x20shop\x20','✅\x20Connected\x20to\x20shop:\x20*','\x20\x20\x20Username:\x20`','botUsername','❌\x20Shop\x20`','notificationLogin','error','•\x20`','unknown\x20shop','🛑\x20Telegram\x20bot\x20stopped','`\x20(','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','getGatewayDisplayNameForTelegram','New\x20payment\x20created','•\x20Payment\x20status\x20changes\x0a','sendShopNotification','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','toString','secretKey','sendApiErrorNotification','initializeBot','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','...\x22','📱\x20Your\x20Telegram\x20ID:\x20`','❌\x20Invalid\x20username\x20format:\x20`','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','1256668qpmOGZ','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','log','Error\x20handling\x20/status\x20command:','telegramUser','telegramId','•\x20New\x20payments\x0a','\x20USDT*\x0a','update','📅\x20Date:\x20','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','*.\x0a\x0a','Payment\x20refund','✅\x20Telegram\x20user\x20','create'];a52_0x28c2=function(){return _0x19ff11;};return a52_0x28c2();}const a52_0x3482cc=a52_0x5675;(function(_0x587638,_0x1708e5){const _0x1360f8=a52_0x5675,_0xc53ec4=_0x587638();while(!![]){try{const _0x56a053=-parseInt(_0x1360f8(0xde))/0x1+-parseInt(_0x1360f8(0x13a))/0x2+-parseInt(_0x1360f8(0x142))/0x3+-parseInt(_0x1360f8(0x11a))/0x4+-parseInt(_0x1360f8(0xfc))/0x5*(-parseInt(_0x1360f8(0x18a))/0x6)+-parseInt(_0x1360f8(0x15e))/0x7*(-parseInt(_0x1360f8(0x1a3))/0x8)+-parseInt(_0x1360f8(0x140))/0x9*(-parseInt(_0x1360f8(0x129))/0xa);if(_0x56a053===_0x1708e5)break;else _0xc53ec4['push'](_0xc53ec4['shift']());}catch(_0x15dd65){_0xc53ec4['push'](_0xc53ec4['shift']());}}}(a52_0x28c2,0xb35de));var __importDefault=this&&this['__importDefault']||function(_0x555b40){const _0x183e30=a52_0x5675;return _0x555b40&&_0x555b40[_0x183e30(0xdc)]?_0x555b40:{'default':_0x555b40};};Object[a52_0x3482cc(0x187)](exports,'__esModule',{'value':!![]}),exports['telegramBotService']=exports[a52_0x3482cc(0x160)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a52_0x3482cc(0x17c))),database_1=__importDefault(require(a52_0x3482cc(0x157))),gateway_1=require(a52_0x3482cc(0xf3));function a52_0x5675(_0x4b10c2,_0x150fcd){const _0x28c23e=a52_0x28c2();return a52_0x5675=function(_0x56755e,_0x564e06){_0x56755e=_0x56755e-0xd2;let _0x4200ac=_0x28c23e[_0x56755e];return _0x4200ac;},a52_0x5675(_0x4b10c2,_0x150fcd);}class TelegramBotService{constructor(){const _0x29ecd3=a52_0x3482cc;this[_0x29ecd3(0x168)]=null,this[_0x29ecd3(0x16b)]=process[_0x29ecd3(0xd5)][_0x29ecd3(0x155)]||'',this[_0x29ecd3(0x103)]=process['env'][_0x29ecd3(0x139)]||_0x29ecd3(0xf2),this[_0x29ecd3(0x16b)]?this[_0x29ecd3(0x114)]():console[_0x29ecd3(0x171)](_0x29ecd3(0x183));}[a52_0x3482cc(0x114)](){const _0x127c0a=a52_0x3482cc;try{this[_0x127c0a(0x168)]=new node_telegram_bot_api_1['default'](this[_0x127c0a(0x16b)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x127c0a(0x11c)](_0x127c0a(0x144)+this['botUsername']+_0x127c0a(0x136));}catch(_0x3428df){console[_0x127c0a(0x106)](_0x127c0a(0x1a0),_0x3428df);}}[a52_0x3482cc(0x19a)](){const _0x38bdc8=a52_0x3482cc;if(!this['bot'])return;this[_0x38bdc8(0x168)][_0x38bdc8(0xf1)](/\/start/,async _0x39fb6e=>{const _0x4ea481=_0x38bdc8,_0x26c7f=_0x39fb6e[_0x4ea481(0xd2)]['id'],_0x2ebd42=_0x39fb6e['from']?.['id']['toString'](),_0x106fe7=_0x39fb6e[_0x4ea481(0x16d)]?.[_0x4ea481(0x166)],_0x202ba5=_0x39fb6e[_0x4ea481(0x16d)]?.[_0x4ea481(0x1a1)],_0x56ab1a=_0x39fb6e[_0x4ea481(0x16d)]?.[_0x4ea481(0x182)];if(!_0x2ebd42)return;try{let _0x3f335a=await database_1['default']['telegramUser'][_0x4ea481(0x1a8)]({'where':{'telegramId':_0x2ebd42},'include':{'shop':!![]}});!_0x3f335a?(_0x3f335a=await database_1[_0x4ea481(0x12a)]['telegramUser'][_0x4ea481(0x128)]({'data':{'telegramId':_0x2ebd42,'username':_0x106fe7,'firstName':_0x202ba5,'lastName':_0x56ab1a,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x4ea481(0xed)+_0x2ebd42+'\x20(@'+_0x106fe7+')')):_0x3f335a=await database_1[_0x4ea481(0x12a)][_0x4ea481(0x11e)][_0x4ea481(0x122)]({'where':{'telegramId':_0x2ebd42},'data':{'username':_0x106fe7,'firstName':_0x202ba5,'lastName':_0x56ab1a},'include':{'shop':!![]}}),_0x3f335a[_0x4ea481(0xe9)]&&_0x3f335a[_0x4ea481(0x13c)]&&_0x3f335a['shop']?await this[_0x4ea481(0x168)]?.['sendMessage'](_0x26c7f,'✅\x20Welcome\x20back!\x0a\x0a'+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x3f335a['shop'][_0x4ea481(0x12c)]+'*\x0a')+('Username:\x20`'+_0x3f335a[_0x4ea481(0x164)]['username']+_0x4ea481(0xf5))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x4ea481(0x10e)+_0x4ea481(0x175)+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x4ea481(0xe8),{'parse_mode':_0x4ea481(0x146)}):(_0x3f335a['shopId']&&!_0x3f335a[_0x4ea481(0xe9)]&&(await database_1['default']['telegramUser']['update']({'where':{'telegramId':_0x2ebd42},'data':{'shopId':null,'isVerified':![]}}),console[_0x4ea481(0x11c)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x2ebd42)),await this[_0x4ea481(0x168)]?.[_0x4ea481(0xe6)](_0x26c7f,_0x4ea481(0x18d)+_0x4ea481(0x124)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x4ea481(0xdb)+_0x4ea481(0xd7)+_0x4ea481(0x133),{'parse_mode':_0x4ea481(0x146)}));}catch(_0x9b0e2a){console[_0x4ea481(0x106)](_0x4ea481(0xf0),_0x9b0e2a),await this[_0x4ea481(0x168)]?.[_0x4ea481(0xe6)](_0x26c7f,_0x4ea481(0xf7));}}),this[_0x38bdc8(0x168)][_0x38bdc8(0xf1)](/\/disconnect/,async _0x3a8d01=>{const _0x41db98=_0x38bdc8,_0x5b7cfd=_0x3a8d01[_0x41db98(0xd2)]['id'],_0x509187=_0x3a8d01[_0x41db98(0x16d)]?.['id'][_0x41db98(0x111)]();if(!_0x509187)return;try{const _0x68e8b2=await database_1[_0x41db98(0x12a)][_0x41db98(0x11e)][_0x41db98(0x1a8)]({'where':{'telegramId':_0x509187},'include':{'shop':!![]}});if(!_0x68e8b2||!_0x68e8b2[_0x41db98(0xe9)]||!_0x68e8b2[_0x41db98(0x13c)]){await this[_0x41db98(0x168)]?.[_0x41db98(0xe6)](_0x5b7cfd,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x436f42=_0x68e8b2['shop']?.[_0x41db98(0x12c)]||_0x41db98(0x108);await database_1[_0x41db98(0x12a)][_0x41db98(0x11e)][_0x41db98(0x122)]({'where':{'telegramId':_0x509187},'data':{'shopId':null,'isVerified':![]}}),console[_0x41db98(0x11c)](_0x41db98(0x177)+_0x509187+_0x41db98(0x17d)+_0x68e8b2[_0x41db98(0x13c)]),await this[_0x41db98(0x168)]?.[_0x41db98(0xe6)](_0x5b7cfd,_0x41db98(0x110)+_0x436f42+_0x41db98(0x125)+_0x41db98(0x181),{'parse_mode':_0x41db98(0x146)});}catch(_0x11781d){console['error']('Error\x20handling\x20/disconnect\x20command:',_0x11781d),await this[_0x41db98(0x168)]?.[_0x41db98(0xe6)](_0x5b7cfd,_0x41db98(0xf7));}}),this[_0x38bdc8(0x168)][_0x38bdc8(0xf1)](/\/status/,async _0x15f36b=>{const _0x52c047=_0x38bdc8,_0x3f6ee8=_0x15f36b['chat']['id'],_0x4a0f45=_0x15f36b[_0x52c047(0x16d)]?.['id'][_0x52c047(0x111)]();if(!_0x4a0f45)return;try{const _0xf99666=await database_1[_0x52c047(0x12a)][_0x52c047(0x11e)]['findUnique']({'where':{'telegramId':_0x4a0f45},'include':{'shop':!![]}});if(!_0xf99666){await this[_0x52c047(0x168)]?.[_0x52c047(0xe6)](_0x3f6ee8,_0x52c047(0x1a6)+_0x52c047(0x148));return;}if(!_0xf99666['isVerified']||!_0xf99666[_0x52c047(0x13c)]||!_0xf99666[_0x52c047(0x164)]){await this[_0x52c047(0x168)]?.[_0x52c047(0xe6)](_0x3f6ee8,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x52c047(0x169));return;}await this[_0x52c047(0x168)]?.[_0x52c047(0xe6)](_0x3f6ee8,_0x52c047(0x15f)+(_0x52c047(0x101)+_0xf99666[_0x52c047(0x164)][_0x52c047(0x12c)]+'*\x0a')+(_0x52c047(0x145)+_0xf99666[_0x52c047(0x164)]['username']+'`\x0a')+(_0x52c047(0x184)+_0xf99666[_0x52c047(0x1ab)]['toLocaleDateString'](_0x52c047(0x141))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+_0x52c047(0xe2)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x52c047(0x146)});}catch(_0x47f262){console[_0x52c047(0x106)](_0x52c047(0x11d),_0x47f262),await this[_0x52c047(0x168)]?.[_0x52c047(0xe6)](_0x3f6ee8,_0x52c047(0xf7));}}),this[_0x38bdc8(0x168)][_0x38bdc8(0xf1)](/\/debug/,async _0x483579=>{const _0x48f50f=_0x38bdc8,_0x17d41f=_0x483579[_0x48f50f(0xd2)]['id'],_0x42fd21=_0x483579[_0x48f50f(0x16d)]?.['id']['toString']();if(!_0x42fd21)return;try{const _0x899a6d=await database_1[_0x48f50f(0x12a)][_0x48f50f(0x164)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x56d316='🔍\x20*Debug\x20Information*\x0a\x0a';_0x56d316+=_0x48f50f(0x117)+_0x42fd21+_0x48f50f(0xf5),_0x56d316+=_0x48f50f(0x12f),_0x899a6d[_0x48f50f(0x198)]((_0x1c0d1d,_0x2cf01e)=>{const _0x35c539=_0x48f50f;_0x56d316+=_0x2cf01e+0x1+_0x35c539(0x176)+_0x1c0d1d['name']+'*\x0a',_0x56d316+=_0x35c539(0x102)+_0x1c0d1d[_0x35c539(0x166)]+'`\x0a',_0x56d316+='\x20\x20\x20Status:\x20'+_0x1c0d1d[_0x35c539(0x19f)]+'\x0a',_0x56d316+=_0x35c539(0x1aa)+_0x1c0d1d[_0x35c539(0x185)][_0x35c539(0x12d)](0x0,0xf)+_0x35c539(0x156);}),await this[_0x48f50f(0x168)]?.[_0x48f50f(0xe6)](_0x17d41f,_0x56d316,{'parse_mode':_0x48f50f(0x146)});}catch(_0x5edcf3){console['error']('Error\x20handling\x20/debug\x20command:',_0x5edcf3),await this[_0x48f50f(0x168)]?.['sendMessage'](_0x17d41f,'❌\x20Error\x20getting\x20debug\x20information.');}}),this[_0x38bdc8(0x168)]['on'](_0x38bdc8(0x159),async _0x111801=>{const _0x45f244=_0x38bdc8;if(_0x111801['text']?.[_0x45f244(0x14e)]('/'))return;const _0x9449eb=_0x111801[_0x45f244(0xd2)]['id'],_0x54c908=_0x111801[_0x45f244(0x16d)]?.['id'][_0x45f244(0x111)](),_0x4e85bd=_0x111801[_0x45f244(0xe4)]?.[_0x45f244(0x15b)]();if(!_0x54c908||!_0x4e85bd)return;try{const _0x290ed2=await database_1[_0x45f244(0x12a)][_0x45f244(0x11e)][_0x45f244(0x1a8)]({'where':{'telegramId':_0x54c908},'include':{'shop':!![]}});if(!_0x290ed2){await this[_0x45f244(0x168)]?.[_0x45f244(0xe6)](_0x9449eb,_0x45f244(0xd8));return;}if(_0x290ed2[_0x45f244(0xe9)]&&_0x290ed2[_0x45f244(0x13c)]&&_0x290ed2[_0x45f244(0x164)]){await this['bot']?.[_0x45f244(0xe6)](_0x9449eb,_0x45f244(0x10b)+_0x290ed2[_0x45f244(0x164)][_0x45f244(0x12c)]+_0x45f244(0x125)+_0x45f244(0xfe),{'parse_mode':_0x45f244(0x146)});return;}const _0x28cad5=_0x4e85bd[_0x45f244(0x18e)](/\s+/);if(_0x28cad5[_0x45f244(0x149)]!==0x2){await this['bot']?.[_0x45f244(0xe6)](_0x9449eb,_0x45f244(0x115)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x45f244(0xdb)+_0x45f244(0xd7)+('You\x20sent\x20'+_0x28cad5[_0x45f244(0x149)]+'\x20parts:\x20'+_0x28cad5['map'](_0x310a1f=>'`'+_0x310a1f+'`')['join'](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x838e87,_0x26e947]=_0x28cad5;console['log'](_0x45f244(0x11b)+_0x54c908+':\x20username=\x22'+_0x838e87+_0x45f244(0x15a)+_0x26e947[_0x45f244(0x12d)](0x0,0xa)+_0x45f244(0x116)),await this[_0x45f244(0x194)](_0x9449eb,_0x54c908,_0x838e87,_0x26e947);}catch(_0x556c26){console[_0x45f244(0x106)](_0x45f244(0xe5),_0x556c26),await this[_0x45f244(0x168)]?.[_0x45f244(0xe6)](_0x9449eb,_0x45f244(0xf7));}}),this[_0x38bdc8(0x168)]['on'](_0x38bdc8(0x106),_0x3ff9bc=>{console['error']('Telegram\x20bot\x20error:',_0x3ff9bc);}),this[_0x38bdc8(0x168)]['on'](_0x38bdc8(0x13e),_0x827591=>{const _0x6feeb2=_0x38bdc8;console[_0x6feeb2(0x106)](_0x6feeb2(0xe7),_0x827591);});}async[a52_0x3482cc(0x194)](_0x331a97,_0x58b7a6,_0x5a465a,_0x342854){const _0x58ac96=a52_0x3482cc;try{console[_0x58ac96(0x11c)](_0x58ac96(0x11b)+_0x58b7a6+_0x58ac96(0xfb)+_0x5a465a+_0x58ac96(0x15a)+_0x342854[_0x58ac96(0x12d)](0x0,0xa)+_0x58ac96(0x116));if(!_0x5a465a||_0x5a465a['length']<0x3||_0x5a465a[_0x58ac96(0x149)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x58ac96(0x17b)](_0x5a465a)){await this[_0x58ac96(0x168)]?.[_0x58ac96(0xe6)](_0x331a97,_0x58ac96(0x118)+_0x5a465a+'`\x0a\x0a'+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x58ac96(0x146)});return;}if(!_0x342854||!_0x342854[_0x58ac96(0x14e)]('pk_')&&!_0x342854['startsWith']('sk_')){await this['bot']?.[_0x58ac96(0xe6)](_0x331a97,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x58ac96(0xd6),{'parse_mode':'Markdown'});return;}const _0x4496a5=await database_1['default'][_0x58ac96(0x164)][_0x58ac96(0x1a8)]({'where':{'username':_0x5a465a},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x4496a5){const _0x125028=await database_1['default'][_0x58ac96(0x164)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x1b0de3=_0x58ac96(0x174)+_0x5a465a+_0x58ac96(0x143);_0x125028[_0x58ac96(0x149)]>0x0?(_0x1b0de3+='Available\x20usernames:\x0a',_0x125028[_0x58ac96(0x198)](_0x3a79db=>{const _0x308023=_0x58ac96;_0x1b0de3+=_0x308023(0x107)+_0x3a79db[_0x308023(0x166)]+_0x308023(0x10a)+_0x3a79db[_0x308023(0x12c)]+')\x0a';}),_0x1b0de3+=_0x58ac96(0x180)):_0x1b0de3+=_0x58ac96(0x147);await this[_0x58ac96(0x168)]?.[_0x58ac96(0xe6)](_0x331a97,_0x1b0de3,{'parse_mode':'Markdown'});return;}if(_0x4496a5['status']!==_0x58ac96(0x191)){await this['bot']?.[_0x58ac96(0xe6)](_0x331a97,_0x58ac96(0x104)+_0x5a465a+'`\x20is\x20inactive.\x0a\x0a'+_0x58ac96(0xef),{'parse_mode':_0x58ac96(0x146)});return;}if(_0x4496a5[_0x58ac96(0x185)]!==_0x342854&&_0x4496a5[_0x58ac96(0x112)]!==_0x342854){await this[_0x58ac96(0x168)]?.[_0x58ac96(0xe6)](_0x331a97,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x5a465a+_0x58ac96(0x167)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x58ac96(0x119),{'parse_mode':_0x58ac96(0x146)});return;}const _0x2db1c1=await database_1[_0x58ac96(0x12a)]['telegramUser']['findFirst']({'where':{'shopId':_0x4496a5['id'],'isVerified':!![],'telegramId':{'not':_0x58b7a6}}});if(_0x2db1c1){await this['bot']?.['sendMessage'](_0x331a97,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x5a465a+_0x58ac96(0x167)+_0x58ac96(0x193),{'parse_mode':'Markdown'});return;}await database_1[_0x58ac96(0x12a)][_0x58ac96(0x11e)][_0x58ac96(0x122)]({'where':{'telegramId':_0x58b7a6},'data':{'shopId':_0x4496a5['id'],'isVerified':!![]}}),await this[_0x58ac96(0x168)]?.['sendMessage'](_0x331a97,_0x58ac96(0x188)+_0x58ac96(0x179)+(_0x58ac96(0x190)+_0x4496a5[_0x58ac96(0x12c)]+'*\x0a')+(_0x58ac96(0x145)+_0x4496a5[_0x58ac96(0x166)]+'`\x0a\x0a')+_0x58ac96(0x130)+_0x58ac96(0x120)+_0x58ac96(0x10e)+_0x58ac96(0x18c)+_0x58ac96(0x134)+'Commands:\x0a'+_0x58ac96(0x1a5)+_0x58ac96(0xe8),{'parse_mode':_0x58ac96(0x146)}),console[_0x58ac96(0x11c)](_0x58ac96(0x127)+_0x58b7a6+_0x58ac96(0x100)+_0x4496a5['username']+_0x58ac96(0x192));}catch(_0x536adf){console[_0x58ac96(0x106)](_0x58ac96(0x16e),_0x536adf),await this[_0x58ac96(0x168)]?.[_0x58ac96(0xe6)](_0x331a97,_0x58ac96(0x162));}}async['sendShopNotification'](_0xdc452c,_0x275337,_0x523f7c){const _0x41745d=a52_0x3482cc;if(!this[_0x41745d(0x168)]){console[_0x41745d(0x171)](_0x41745d(0x196));return;}try{const _0x3611d4=await database_1[_0x41745d(0x12a)][_0x41745d(0x11e)]['findMany']({'where':{'shopId':_0xdc452c,'isVerified':!![]}});if(_0x3611d4[_0x41745d(0x149)]===0x0){console[_0x41745d(0x11c)](_0x41745d(0xeb)+_0xdc452c);return;}const _0x2b4316=_0x3611d4[_0x41745d(0x197)](async _0x6afc9a=>{const _0x172fca=_0x41745d;try{await this[_0x172fca(0x168)]?.['sendMessage'](_0x6afc9a[_0x172fca(0x11f)],_0x275337,_0x523f7c),console[_0x172fca(0x11c)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x6afc9a[_0x172fca(0x11f)]);}catch(_0x1c46f8){console['error'](_0x172fca(0xf8)+_0x6afc9a[_0x172fca(0x11f)]+':',_0x1c46f8),_0x1c46f8 instanceof Error&&(_0x1c46f8[_0x172fca(0x159)][_0x172fca(0x13d)]('blocked')||_0x1c46f8[_0x172fca(0x159)][_0x172fca(0x13d)](_0x172fca(0x16a))||_0x1c46f8[_0x172fca(0x159)][_0x172fca(0x13d)]('user\x20is\x20deactivated'))&&(await database_1[_0x172fca(0x12a)][_0x172fca(0x11e)][_0x172fca(0x122)]({'where':{'id':_0x6afc9a['id']},'data':{'isVerified':![]}}),console[_0x172fca(0x11c)](_0x172fca(0xd9)+_0x6afc9a[_0x172fca(0x11f)]+_0x172fca(0xd3)));}});await Promise['allSettled'](_0x2b4316);}catch(_0x45ac5a){console['error'](_0x41745d(0xdf),_0x45ac5a);}}async['sendPaymentNotification'](_0x12ddb7,_0x14f2f4,_0x1c9389){const _0x2d57b1=a52_0x3482cc,_0x193d82={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x404161={'created':_0x2d57b1(0x10d),'paid':_0x2d57b1(0xf9),'failed':'Payment\x20failed','expired':_0x2d57b1(0x170),'refund':_0x2d57b1(0x126),'chargeback':_0x2d57b1(0x154),'processing':_0x2d57b1(0x131)},_0x44e015=_0x193d82[_0x1c9389],_0x36ba86=_0x404161[_0x1c9389],_0x67d047=(0x0,gateway_1[_0x2d57b1(0x10c)])(_0x14f2f4[_0x2d57b1(0x152)]);console[_0x2d57b1(0x11c)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x14f2f4[_0x2d57b1(0x152)]+'\x22\x20->\x20display\x20\x22'+_0x67d047+'\x22');let _0x54796f=_0x44e015+'\x20*'+_0x36ba86+_0x2d57b1(0x153)+(_0x2d57b1(0xee)+_0x14f2f4[_0x2d57b1(0x19d)]+'\x20'+_0x14f2f4[_0x2d57b1(0x14a)]+'*\x0a')+(_0x2d57b1(0x186)+(_0x14f2f4['orderId']||_0x14f2f4['id'])+'`\x0a')+(_0x2d57b1(0x132)+_0x14f2f4['id']+'`\x0a')+(_0x2d57b1(0x1a9)+_0x67d047+'`\x0a')+(_0x2d57b1(0x123)+new Date(_0x14f2f4[_0x2d57b1(0x14d)])[_0x2d57b1(0x151)](_0x2d57b1(0x141))+'\x0a');(_0x14f2f4[_0x2d57b1(0x158)]||_0x14f2f4[_0x2d57b1(0x178)])&&(_0x54796f+=_0x2d57b1(0xec),_0x14f2f4[_0x2d57b1(0x158)]&&(_0x54796f+=_0x2d57b1(0xd4)+_0x14f2f4['customerName']+'`\x0a'),_0x14f2f4[_0x2d57b1(0x178)]&&(_0x54796f+=_0x2d57b1(0x19e)+_0x14f2f4['customerEmail']+'`\x0a')),_0x1c9389===_0x2d57b1(0x17f)&&_0x14f2f4[_0x2d57b1(0xe1)]&&(_0x54796f+=_0x2d57b1(0x172)+_0x14f2f4['chargebackAmount']+_0x2d57b1(0x121)),_0x1c9389===_0x2d57b1(0xdd)&&(_0x54796f+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x14f2f4[_0x2d57b1(0xf4)]&&(_0x54796f+=_0x2d57b1(0x14f)+_0x14f2f4[_0x2d57b1(0xf4)]+'\x0a'),await this['sendShopNotification'](_0x12ddb7,_0x54796f,{'parse_mode':'Markdown'});}async[a52_0x3482cc(0x17a)](_0x14eb88,_0x3d8eab,_0x5dd083){const _0x58fd56=a52_0x3482cc,_0x59df5c={'created':'📤','completed':'✅','rejected':'❌'},_0x3a0076={'created':_0x58fd56(0x13f),'completed':'Payout\x20completed','rejected':'Payout\x20rejected'},_0x18656e=_0x59df5c[_0x5dd083],_0x51f120=_0x3a0076[_0x5dd083],_0x43da31=_0x18656e+'\x20*'+_0x51f120+_0x58fd56(0x153)+(_0x58fd56(0x165)+_0x3d8eab[_0x58fd56(0x19d)]+_0x58fd56(0x18f))+(_0x58fd56(0xfa)+_0x3d8eab['method']+'`\x0a')+(_0x58fd56(0x161)+_0x3d8eab['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x3d8eab[_0x58fd56(0x14d)])[_0x58fd56(0x151)](_0x58fd56(0x141))+'\x0a')+(_0x3d8eab['txid']?_0x58fd56(0xe0)+_0x3d8eab[_0x58fd56(0x16c)]+'`':'');await this[_0x58fd56(0x10f)](_0x14eb88,_0x43da31,{'parse_mode':_0x58fd56(0x146)});}async[a52_0x3482cc(0xe3)](_0x2e21a5,_0x5a848f){const _0x28ee96=a52_0x3482cc;try{const _0x24a638=await database_1[_0x28ee96(0x12a)][_0x28ee96(0xea)]['findUnique']({'where':{'shopId':_0x2e21a5},'select':{'notificationLogin':!![]}});if(!_0x24a638?.[_0x28ee96(0x105)]){console['log'](_0x28ee96(0x15d)+_0x2e21a5);return;}const _0x4dd74f=_0x5a848f[_0x28ee96(0x135)]?'🔐':'🚨',_0x2388ae=_0x5a848f['success']?_0x28ee96(0x17e):'Failed\x20login\x20attempt';let _0x58aafe=_0x4dd74f+'\x20*'+_0x2388ae+_0x28ee96(0x153)+(_0x28ee96(0x145)+_0x5a848f[_0x28ee96(0x166)]+'`\x0a')+('📅\x20Time:\x20'+_0x5a848f['timestamp'][_0x28ee96(0x151)](_0x28ee96(0x141))+'\x0a');_0x5a848f[_0x28ee96(0xda)]&&(_0x58aafe+=_0x28ee96(0xff)+_0x5a848f[_0x28ee96(0xda)]+'`\x0a');if(_0x5a848f[_0x28ee96(0x19b)]){const _0x4e630a=_0x5a848f[_0x28ee96(0x19b)]['length']>0x32?_0x5a848f[_0x28ee96(0x19b)][_0x28ee96(0x12d)](0x0,0x32)+'...':_0x5a848f[_0x28ee96(0x19b)];_0x58aafe+=_0x28ee96(0x12b)+_0x4e630a+'`\x0a';}!_0x5a848f[_0x28ee96(0x135)]&&(_0x58aafe+=_0x28ee96(0x150)),await this[_0x28ee96(0x10f)](_0x2e21a5,_0x58aafe,{'parse_mode':_0x28ee96(0x146)}),console['log'](_0x28ee96(0xfd)+_0x2e21a5+':\x20'+(_0x5a848f[_0x28ee96(0x135)]?_0x28ee96(0x135):_0x28ee96(0x199)));}catch(_0x2d8d0a){console['error']('Failed\x20to\x20send\x20login\x20notification:',_0x2d8d0a);}}async[a52_0x3482cc(0x113)](_0x57fbde,_0xb63f52){const _0x1c93cb=a52_0x3482cc;try{const _0x3cc451=await database_1[_0x1c93cb(0x12a)][_0x1c93cb(0xea)][_0x1c93cb(0x1a8)]({'where':{'shopId':_0x57fbde},'select':{'notificationApiError':!![]}});if(!_0x3cc451?.[_0x1c93cb(0x195)]){console[_0x1c93cb(0x11c)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x57fbde);return;}let _0x190127=_0x1c93cb(0x18b)+(_0x1c93cb(0x14c)+_0xb63f52[_0x1c93cb(0x13b)]+'\x20'+_0xb63f52[_0x1c93cb(0x15c)]+'`\x0a')+('📅\x20Time:\x20'+_0xb63f52[_0x1c93cb(0x1a7)][_0x1c93cb(0x151)]('en-US')+'\x0a');_0xb63f52['statusCode']&&(_0x190127+='📊\x20Error\x20code:\x20`'+_0xb63f52[_0x1c93cb(0x19c)]+'`\x0a'),_0x190127+=_0x1c93cb(0xf6)+_0xb63f52[_0x1c93cb(0x1a4)]+'`\x0a',_0xb63f52[_0x1c93cb(0x1a2)]&&(_0x190127+=_0x1c93cb(0x12e)+_0xb63f52[_0x1c93cb(0x1a2)]+'`\x0a'),_0x190127+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x1c93cb(0x10f)](_0x57fbde,_0x190127,{'parse_mode':'Markdown'}),console[_0x1c93cb(0x11c)](_0x1c93cb(0x16f)+_0x57fbde+':\x20'+_0xb63f52[_0x1c93cb(0x15c)]);}catch(_0x22a442){console['error'](_0x1c93cb(0x189),_0x22a442);}}async[a52_0x3482cc(0x137)](_0x169790,_0x29e902,_0x309e6f){const _0x327adf=a52_0x3482cc;let _0x5b19f8='🔔\x20*'+_0x29e902+_0x327adf(0x153);for(const [_0x1e4891,_0x27c1cd]of Object[_0x327adf(0x138)](_0x309e6f)){_0x27c1cd!==null&&_0x27c1cd!==undefined&&(_0x5b19f8+=_0x1e4891+_0x327adf(0x173)+_0x27c1cd+'`\x0a');}await this[_0x327adf(0x10f)](_0x169790,_0x5b19f8,{'parse_mode':_0x327adf(0x146)});}[a52_0x3482cc(0x14b)](){const _0x1d5a23=a52_0x3482cc;return{'isActive':!!this[_0x1d5a23(0x168)],'username':this[_0x1d5a23(0x103)]};}[a52_0x3482cc(0x163)](){const _0x291468=a52_0x3482cc;this[_0x291468(0x168)]&&(this[_0x291468(0x168)]['stopPolling'](),this[_0x291468(0x168)]=null,console[_0x291468(0x11c)](_0x291468(0x109)));}}exports['TelegramBotService']=TelegramBotService,exports['telegramBotService']=new TelegramBotService();