'use strict';const a54_0x483342=a54_0x44dc;(function(_0x16e196,_0x25fa87){const _0x5d29e6=a54_0x44dc,_0x534bef=_0x16e196();while(!![]){try{const _0xc8504c=parseInt(_0x5d29e6(0x204))/0x1*(parseInt(_0x5d29e6(0x28e))/0x2)+parseInt(_0x5d29e6(0x26e))/0x3*(-parseInt(_0x5d29e6(0x24f))/0x4)+parseInt(_0x5d29e6(0x270))/0x5+-parseInt(_0x5d29e6(0x26b))/0x6+parseInt(_0x5d29e6(0x286))/0x7*(-parseInt(_0x5d29e6(0x243))/0x8)+parseInt(_0x5d29e6(0x2a3))/0x9+parseInt(_0x5d29e6(0x205))/0xa*(parseInt(_0x5d29e6(0x2ac))/0xb);if(_0xc8504c===_0x25fa87)break;else _0x534bef['push'](_0x534bef['shift']());}catch(_0x27cc63){_0x534bef['push'](_0x534bef['shift']());}}}(a54_0x38cf,0xab346));function a54_0x44dc(_0x1ea64e,_0x2dce2e){const _0x38cf6b=a54_0x38cf();return a54_0x44dc=function(_0x44dce2,_0x319ddf){_0x44dce2=_0x44dce2-0x1d8;let _0x303ee6=_0x38cf6b[_0x44dce2];return _0x303ee6;},a54_0x44dc(_0x1ea64e,_0x2dce2e);}var __importDefault=this&&this[a54_0x483342(0x215)]||function(_0x39f9ec){return _0x39f9ec&&_0x39f9ec['__esModule']?_0x39f9ec:{'default':_0x39f9ec};};Object[a54_0x483342(0x221)](exports,'__esModule',{'value':!![]}),exports[a54_0x483342(0x2b3)]=exports[a54_0x483342(0x2aa)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x483342(0x211))),database_1=__importDefault(require(a54_0x483342(0x1e3))),gateway_1=require(a54_0x483342(0x1e1));class TelegramBotService{constructor(){const _0x554615=a54_0x483342;this[_0x554615(0x1dc)]=null,this[_0x554615(0x1da)]=process['env'][_0x554615(0x1ee)]||'',this['botUsername']=process[_0x554615(0x260)]['TELEGRAM_BOT_USERNAME']||_0x554615(0x29b),this['botToken']?this[_0x554615(0x271)]():console[_0x554615(0x1e4)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a54_0x483342(0x271)](){const _0x3bd368=a54_0x483342;try{this['bot']=new node_telegram_bot_api_1[(_0x3bd368(0x263))](this[_0x3bd368(0x1da)],{'polling':!![]}),this[_0x3bd368(0x23e)](),console[_0x3bd368(0x242)](_0x3bd368(0x220)+this[_0x3bd368(0x2a9)]+_0x3bd368(0x288));}catch(_0x2eb311){console[_0x3bd368(0x276)](_0x3bd368(0x2b5),_0x2eb311);}}[a54_0x483342(0x23e)](){const _0x353bac=a54_0x483342;if(!this['bot'])return;this['bot'][_0x353bac(0x1f3)](/\/start/,async _0x41215e=>{const _0x2591a8=_0x353bac,_0x1bcd6b=_0x41215e[_0x2591a8(0x27d)]['id'],_0x5a96bf=_0x41215e['from']?.['id'][_0x2591a8(0x227)](),_0x299e65=_0x41215e['from']?.[_0x2591a8(0x27a)],_0x53dddb=_0x41215e[_0x2591a8(0x27c)]?.[_0x2591a8(0x20c)],_0x2976f8=_0x41215e['from']?.['last_name'];if(!_0x5a96bf)return;try{let _0x894b30=await database_1[_0x2591a8(0x263)][_0x2591a8(0x252)][_0x2591a8(0x1e6)]({'where':{'telegramId':_0x5a96bf},'include':{'shop':!![]}});!_0x894b30?(_0x894b30=await database_1[_0x2591a8(0x263)][_0x2591a8(0x252)][_0x2591a8(0x26c)]({'data':{'telegramId':_0x5a96bf,'username':_0x299e65,'firstName':_0x53dddb,'lastName':_0x2976f8,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x2591a8(0x242)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x5a96bf+_0x2591a8(0x245)+_0x299e65+')')):_0x894b30=await database_1[_0x2591a8(0x263)][_0x2591a8(0x252)]['update']({'where':{'telegramId':_0x5a96bf},'data':{'username':_0x299e65,'firstName':_0x53dddb,'lastName':_0x2976f8},'include':{'shop':!![]}}),_0x894b30['isVerified']&&_0x894b30['shopId']&&_0x894b30[_0x2591a8(0x277)]?await this[_0x2591a8(0x1dc)]?.[_0x2591a8(0x1f0)](_0x1bcd6b,_0x2591a8(0x282)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x894b30[_0x2591a8(0x277)][_0x2591a8(0x25b)]+'*\x0a')+(_0x2591a8(0x294)+_0x894b30[_0x2591a8(0x277)][_0x2591a8(0x27a)]+_0x2591a8(0x237))+_0x2591a8(0x27e)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+_0x2591a8(0x2a2)+_0x2591a8(0x20e)+_0x2591a8(0x1f1)+_0x2591a8(0x226),{'parse_mode':_0x2591a8(0x2b7)}):(_0x894b30[_0x2591a8(0x22a)]&&!_0x894b30[_0x2591a8(0x1f8)]&&(await database_1[_0x2591a8(0x263)]['telegramUser']['update']({'where':{'telegramId':_0x5a96bf},'data':{'shopId':null,'isVerified':![]}}),console[_0x2591a8(0x242)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x5a96bf)),await this['bot']?.['sendMessage'](_0x1bcd6b,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x2591a8(0x23f)+_0x2591a8(0x2ab)+_0x2591a8(0x1d9)+_0x2591a8(0x22c)+_0x2591a8(0x216),{'parse_mode':_0x2591a8(0x2b7)}));}catch(_0x5a1fdc){console[_0x2591a8(0x276)](_0x2591a8(0x23c),_0x5a1fdc),await this[_0x2591a8(0x1dc)]?.[_0x2591a8(0x1f0)](_0x1bcd6b,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x353bac(0x1dc)]['onText'](/\/disconnect/,async _0x578a58=>{const _0x1fe5c2=_0x353bac,_0x3d3960=_0x578a58[_0x1fe5c2(0x27d)]['id'],_0x559b4a=_0x578a58['from']?.['id'][_0x1fe5c2(0x227)]();if(!_0x559b4a)return;try{const _0x26575d=await database_1[_0x1fe5c2(0x263)][_0x1fe5c2(0x252)][_0x1fe5c2(0x1e6)]({'where':{'telegramId':_0x559b4a},'include':{'shop':!![]}});if(!_0x26575d||!_0x26575d[_0x1fe5c2(0x1f8)]||!_0x26575d[_0x1fe5c2(0x22a)]){await this[_0x1fe5c2(0x1dc)]?.['sendMessage'](_0x3d3960,_0x1fe5c2(0x293));return;}const _0x291785=_0x26575d[_0x1fe5c2(0x277)]?.['name']||_0x1fe5c2(0x24d);await database_1[_0x1fe5c2(0x263)]['telegramUser']['update']({'where':{'telegramId':_0x559b4a},'data':{'shopId':null,'isVerified':![]}}),console[_0x1fe5c2(0x242)](_0x1fe5c2(0x281)+_0x559b4a+_0x1fe5c2(0x247)+_0x26575d[_0x1fe5c2(0x22a)]),await this[_0x1fe5c2(0x1dc)]?.[_0x1fe5c2(0x1f0)](_0x3d3960,_0x1fe5c2(0x236)+_0x291785+_0x1fe5c2(0x2b0)+_0x1fe5c2(0x2a5),{'parse_mode':'Markdown'});}catch(_0x564125){console[_0x1fe5c2(0x276)](_0x1fe5c2(0x1fd),_0x564125),await this[_0x1fe5c2(0x1dc)]?.[_0x1fe5c2(0x1f0)](_0x3d3960,_0x1fe5c2(0x225));}}),this[_0x353bac(0x1dc)][_0x353bac(0x1f3)](/\/status/,async _0x3eb6b8=>{const _0x52fbd0=_0x353bac,_0x4a8c24=_0x3eb6b8[_0x52fbd0(0x27d)]['id'],_0x442366=_0x3eb6b8[_0x52fbd0(0x27c)]?.['id'][_0x52fbd0(0x227)]();if(!_0x442366)return;try{const _0x563a19=await database_1[_0x52fbd0(0x263)]['telegramUser'][_0x52fbd0(0x1e6)]({'where':{'telegramId':_0x442366},'include':{'shop':!![]}});if(!_0x563a19){await this[_0x52fbd0(0x1dc)]?.['sendMessage'](_0x4a8c24,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x52fbd0(0x295));return;}if(!_0x563a19[_0x52fbd0(0x1f8)]||!_0x563a19[_0x52fbd0(0x22a)]||!_0x563a19[_0x52fbd0(0x277)]){await this['bot']?.[_0x52fbd0(0x1f0)](_0x4a8c24,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x52fbd0(0x213));return;}await this['bot']?.[_0x52fbd0(0x1f0)](_0x4a8c24,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x52fbd0(0x2a0)+_0x563a19['shop'][_0x52fbd0(0x25b)]+'*\x0a')+(_0x52fbd0(0x24a)+_0x563a19[_0x52fbd0(0x277)][_0x52fbd0(0x27a)]+'`\x0a')+(_0x52fbd0(0x2b6)+_0x563a19[_0x52fbd0(0x26d)][_0x52fbd0(0x22b)](_0x52fbd0(0x296))+'\x0a\x0a')+_0x52fbd0(0x2c1)+_0x52fbd0(0x20e)+_0x52fbd0(0x226),{'parse_mode':'Markdown'});}catch(_0x2fb87a){console[_0x52fbd0(0x276)](_0x52fbd0(0x2b2),_0x2fb87a),await this['bot']?.[_0x52fbd0(0x1f0)](_0x4a8c24,_0x52fbd0(0x225));}}),this[_0x353bac(0x1dc)][_0x353bac(0x1f3)](/\/debug/,async _0x49d209=>{const _0xd8a082=_0x353bac,_0x1b1c95=_0x49d209[_0xd8a082(0x27d)]['id'],_0x1e042d=_0x49d209[_0xd8a082(0x27c)]?.['id']['toString']();if(!_0x1e042d)return;try{const _0x1a83e5=await database_1[_0xd8a082(0x263)]['shop']['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4e9866=_0xd8a082(0x2a7);_0x4e9866+=_0xd8a082(0x24b)+_0x1e042d+_0xd8a082(0x237),_0x4e9866+=_0xd8a082(0x21b),_0x1a83e5[_0xd8a082(0x278)]((_0x4467af,_0x2b28f1)=>{const _0x3178c6=_0xd8a082;_0x4e9866+=_0x2b28f1+0x1+_0x3178c6(0x29e)+_0x4467af['name']+'*\x0a',_0x4e9866+=_0x3178c6(0x28d)+_0x4467af['username']+'`\x0a',_0x4e9866+=_0x3178c6(0x2bd)+_0x4467af[_0x3178c6(0x21d)]+'\x0a',_0x4e9866+=_0x3178c6(0x29d)+_0x4467af[_0x3178c6(0x228)][_0x3178c6(0x1f6)](0x0,0xf)+_0x3178c6(0x255);}),await this[_0xd8a082(0x1dc)]?.[_0xd8a082(0x1f0)](_0x1b1c95,_0x4e9866,{'parse_mode':_0xd8a082(0x2b7)});}catch(_0x5cd372){console['error']('Error\x20handling\x20/debug\x20command:',_0x5cd372),await this[_0xd8a082(0x1dc)]?.[_0xd8a082(0x1f0)](_0x1b1c95,_0xd8a082(0x1e7));}}),this['bot']['on']('message',async _0x17b42c=>{const _0x461c5d=_0x353bac;if(_0x17b42c[_0x461c5d(0x290)]?.[_0x461c5d(0x275)]('/'))return;const _0x928dcd=_0x17b42c[_0x461c5d(0x27d)]['id'],_0x313d85=_0x17b42c[_0x461c5d(0x27c)]?.['id'][_0x461c5d(0x227)](),_0x5a02a0=_0x17b42c['text']?.[_0x461c5d(0x2bf)]();if(!_0x313d85||!_0x5a02a0)return;try{const _0x27adc5=await database_1[_0x461c5d(0x263)][_0x461c5d(0x252)][_0x461c5d(0x1e6)]({'where':{'telegramId':_0x313d85},'include':{'shop':!![]}});if(!_0x27adc5){await this[_0x461c5d(0x1dc)]?.[_0x461c5d(0x1f0)](_0x928dcd,_0x461c5d(0x206));return;}if(_0x27adc5['isVerified']&&_0x27adc5[_0x461c5d(0x22a)]&&_0x27adc5[_0x461c5d(0x277)]){await this['bot']?.[_0x461c5d(0x1f0)](_0x928dcd,_0x461c5d(0x29a)+_0x27adc5['shop'][_0x461c5d(0x25b)]+_0x461c5d(0x2b0)+_0x461c5d(0x2bb),{'parse_mode':'Markdown'});return;}const _0x97a652=_0x5a02a0[_0x461c5d(0x233)](/\s+/);if(_0x97a652[_0x461c5d(0x1f2)]!==0x2){await this[_0x461c5d(0x1dc)]?.[_0x461c5d(0x1f0)](_0x928dcd,_0x461c5d(0x28c)+_0x461c5d(0x2ab)+_0x461c5d(0x1d9)+_0x461c5d(0x22c)+(_0x461c5d(0x267)+_0x97a652['length']+_0x461c5d(0x299)+_0x97a652[_0x461c5d(0x1e8)](_0x28066b=>'`'+_0x28066b+'`')['join'](',\x20')),{'parse_mode':_0x461c5d(0x2b7)});return;}const [_0x3bf497,_0x2fafe3]=_0x97a652;console[_0x461c5d(0x242)](_0x461c5d(0x249)+_0x313d85+_0x461c5d(0x25a)+_0x3bf497+_0x461c5d(0x1ff)+_0x2fafe3[_0x461c5d(0x1f6)](0x0,0xa)+_0x461c5d(0x1e2)),await this[_0x461c5d(0x1fa)](_0x928dcd,_0x313d85,_0x3bf497,_0x2fafe3);}catch(_0x400687){console['error'](_0x461c5d(0x254),_0x400687),await this[_0x461c5d(0x1dc)]?.[_0x461c5d(0x1f0)](_0x928dcd,_0x461c5d(0x225));}}),this[_0x353bac(0x1dc)]['on'](_0x353bac(0x276),_0x2d5fc6=>{const _0x10b287=_0x353bac;console[_0x10b287(0x276)](_0x10b287(0x1dd),_0x2d5fc6);}),this[_0x353bac(0x1dc)]['on'](_0x353bac(0x26a),_0x3b199e=>{const _0x4262ea=_0x353bac;console[_0x4262ea(0x276)](_0x4262ea(0x21c),_0x3b199e);});}async[a54_0x483342(0x1fa)](_0x75d39c,_0xba8003,_0x1732e1,_0x56a80b){const _0x414f9b=a54_0x483342;try{console['log'](_0x414f9b(0x249)+_0xba8003+_0x414f9b(0x25a)+_0x1732e1+_0x414f9b(0x1ff)+_0x56a80b['substring'](0x0,0xa)+_0x414f9b(0x1e2));if(!_0x1732e1||_0x1732e1[_0x414f9b(0x1f2)]<0x3||_0x1732e1['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x414f9b(0x27b)](_0x1732e1)){await this[_0x414f9b(0x1dc)]?.[_0x414f9b(0x1f0)](_0x75d39c,_0x414f9b(0x25e)+_0x1732e1+_0x414f9b(0x237)+_0x414f9b(0x284),{'parse_mode':'Markdown'});return;}if(!_0x56a80b||!_0x56a80b[_0x414f9b(0x275)](_0x414f9b(0x2ae))&&!_0x56a80b[_0x414f9b(0x275)](_0x414f9b(0x232))){await this['bot']?.[_0x414f9b(0x1f0)](_0x75d39c,_0x414f9b(0x266)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':'Markdown'});return;}const _0x7cc73e=await database_1[_0x414f9b(0x263)][_0x414f9b(0x277)][_0x414f9b(0x1e6)]({'where':{'username':_0x1732e1},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x7cc73e){const _0x2e5ef3=await database_1['default'][_0x414f9b(0x277)][_0x414f9b(0x1f7)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x42463b=_0x414f9b(0x201)+_0x1732e1+_0x414f9b(0x256);_0x2e5ef3['length']>0x0?(_0x42463b+='Available\x20usernames:\x0a',_0x2e5ef3['forEach'](_0x232990=>{const _0x4d56fa=_0x414f9b;_0x42463b+='•\x20`'+_0x232990[_0x4d56fa(0x27a)]+_0x4d56fa(0x238)+_0x232990[_0x4d56fa(0x25b)]+')\x0a';}),_0x42463b+=_0x414f9b(0x2b1)):_0x42463b+=_0x414f9b(0x2a4);await this[_0x414f9b(0x1dc)]?.[_0x414f9b(0x1f0)](_0x75d39c,_0x42463b,{'parse_mode':_0x414f9b(0x2b7)});return;}if(_0x7cc73e[_0x414f9b(0x21d)]!=='ACTIVE'){await this[_0x414f9b(0x1dc)]?.['sendMessage'](_0x75d39c,_0x414f9b(0x1ef)+_0x1732e1+_0x414f9b(0x1ec)+_0x414f9b(0x257),{'parse_mode':'Markdown'});return;}if(_0x7cc73e['publicKey']!==_0x56a80b&&_0x7cc73e[_0x414f9b(0x283)]!==_0x56a80b){await this[_0x414f9b(0x1dc)]?.[_0x414f9b(0x1f0)](_0x75d39c,_0x414f9b(0x29c)+_0x1732e1+_0x414f9b(0x21a)+_0x414f9b(0x218)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x414f9b(0x2b7)});return;}const _0x595974=await database_1['default'][_0x414f9b(0x252)][_0x414f9b(0x246)]({'where':{'shopId':_0x7cc73e['id'],'isVerified':!![],'telegramId':{'not':_0xba8003}}});if(_0x595974){await this[_0x414f9b(0x1dc)]?.['sendMessage'](_0x75d39c,_0x414f9b(0x1fb)+_0x1732e1+'`.\x0a\x0a'+_0x414f9b(0x264),{'parse_mode':_0x414f9b(0x2b7)});return;}await database_1[_0x414f9b(0x263)][_0x414f9b(0x252)][_0x414f9b(0x2b4)]({'where':{'telegramId':_0xba8003},'data':{'shopId':_0x7cc73e['id'],'isVerified':!![]}}),await this[_0x414f9b(0x1dc)]?.['sendMessage'](_0x75d39c,_0x414f9b(0x298)+_0x414f9b(0x1d8)+('📱\x20Shop:\x20*'+_0x7cc73e[_0x414f9b(0x25b)]+'*\x0a')+(_0x414f9b(0x24a)+_0x7cc73e[_0x414f9b(0x27a)]+'`\x0a\x0a')+_0x414f9b(0x23d)+_0x414f9b(0x248)+_0x414f9b(0x231)+_0x414f9b(0x20f)+_0x414f9b(0x258)+_0x414f9b(0x20e)+_0x414f9b(0x1f1)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}),console[_0x414f9b(0x242)]('✅\x20Telegram\x20user\x20'+_0xba8003+'\x20verified\x20for\x20shop\x20'+_0x7cc73e['username']+'\x20via\x20single-line\x20input');}catch(_0x1f3d27){console[_0x414f9b(0x276)](_0x414f9b(0x23a),_0x1f3d27),await this[_0x414f9b(0x1dc)]?.[_0x414f9b(0x1f0)](_0x75d39c,_0x414f9b(0x1ea));}}async[a54_0x483342(0x1eb)](_0x2afc36,_0x3f5e26,_0x56d4c4){const _0x9abdca=a54_0x483342;if(!this[_0x9abdca(0x1dc)]){console[_0x9abdca(0x1e4)](_0x9abdca(0x1de));return;}try{const _0x62d5bd=await database_1['default'][_0x9abdca(0x252)]['findMany']({'where':{'shopId':_0x2afc36,'isVerified':!![]}});if(_0x62d5bd['length']===0x0){console[_0x9abdca(0x242)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x2afc36);return;}const _0x571c2f=_0x62d5bd[_0x9abdca(0x1e8)](async _0x542d6a=>{const _0x458bcb=_0x9abdca;try{await this[_0x458bcb(0x1dc)]?.[_0x458bcb(0x1f0)](_0x542d6a[_0x458bcb(0x1fc)],_0x3f5e26,_0x56d4c4),console[_0x458bcb(0x242)](_0x458bcb(0x1f4)+_0x542d6a['telegramId']);}catch(_0x521c54){console[_0x458bcb(0x276)](_0x458bcb(0x28f)+_0x542d6a[_0x458bcb(0x1fc)]+':',_0x521c54),_0x521c54 instanceof Error&&(_0x521c54[_0x458bcb(0x240)][_0x458bcb(0x285)](_0x458bcb(0x261))||_0x521c54[_0x458bcb(0x240)][_0x458bcb(0x285)](_0x458bcb(0x273))||_0x521c54[_0x458bcb(0x240)][_0x458bcb(0x285)](_0x458bcb(0x262)))&&(await database_1[_0x458bcb(0x263)]['telegramUser'][_0x458bcb(0x2b4)]({'where':{'id':_0x542d6a['id']},'data':{'isVerified':![]}}),console[_0x458bcb(0x242)](_0x458bcb(0x20d)+_0x542d6a[_0x458bcb(0x1fc)]+_0x458bcb(0x1fe)));}});await Promise[_0x9abdca(0x272)](_0x571c2f);}catch(_0x24880f){console[_0x9abdca(0x276)]('Error\x20sending\x20shop\x20notification:',_0x24880f);}}async[a54_0x483342(0x214)](_0x30313c,_0x53d6d0,_0x2c54f7){const _0x514dde=a54_0x483342,_0x299c9f={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x5c8a73={'created':_0x514dde(0x1df),'paid':_0x514dde(0x268),'failed':_0x514dde(0x1ed),'expired':_0x514dde(0x25c),'refund':_0x514dde(0x2b9),'chargeback':_0x514dde(0x219),'processing':_0x514dde(0x251)},_0x3a29af=_0x299c9f[_0x2c54f7],_0x1c0411=_0x5c8a73[_0x2c54f7],_0x1aefb0=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x53d6d0['gateway']);console['log']('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x53d6d0['gateway']+_0x514dde(0x22e)+_0x1aefb0+'\x22');let _0x3f81b0=_0x3a29af+'\x20*'+_0x1c0411+_0x514dde(0x259)+(_0x514dde(0x27f)+_0x53d6d0[_0x514dde(0x25d)]+'\x20'+_0x53d6d0[_0x514dde(0x292)]+'*\x0a')+(_0x514dde(0x2a1)+(_0x53d6d0['orderId']||_0x53d6d0['id'])+'`\x0a')+(_0x514dde(0x239)+_0x53d6d0['id']+'`\x0a')+(_0x514dde(0x287)+_0x1aefb0+'`\x0a')+(_0x514dde(0x22f)+new Date(_0x53d6d0[_0x514dde(0x253)])[_0x514dde(0x209)]('en-US')+'\x0a');if(_0x53d6d0['customerName']||_0x53d6d0['customerEmail']||_0x53d6d0[_0x514dde(0x2b8)]||_0x53d6d0[_0x514dde(0x291)]||_0x53d6d0['customerUa']){_0x3f81b0+='\x0a👤\x20*Customer\x20Information:*\x0a';_0x53d6d0[_0x514dde(0x2af)]&&(_0x3f81b0+='📛\x20Name:\x20`'+_0x53d6d0[_0x514dde(0x2af)]+'`\x0a');_0x53d6d0['customerEmail']&&(_0x3f81b0+='📧\x20Email:\x20`'+_0x53d6d0['customerEmail']+'`\x0a');_0x53d6d0[_0x514dde(0x2b8)]&&(_0x3f81b0+=_0x514dde(0x265)+_0x53d6d0[_0x514dde(0x2b8)]+'`\x0a');_0x53d6d0[_0x514dde(0x291)]&&(_0x3f81b0+=_0x514dde(0x1e9)+_0x53d6d0['customerIp']+'`\x0a');if(_0x53d6d0[_0x514dde(0x250)]){const _0x7288d2=_0x53d6d0[_0x514dde(0x250)]['length']>0x32?_0x53d6d0['customerUa'][_0x514dde(0x1f6)](0x0,0x32)+_0x514dde(0x224):_0x53d6d0[_0x514dde(0x250)];_0x3f81b0+='💻\x20Browser:\x20`'+_0x7288d2+'`\x0a';}}_0x2c54f7===_0x514dde(0x28b)&&_0x53d6d0[_0x514dde(0x2be)]&&(_0x3f81b0+=_0x514dde(0x26f)+_0x53d6d0[_0x514dde(0x2be)]+'\x20USDT*\x0a'),_0x2c54f7===_0x514dde(0x235)&&(_0x3f81b0+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x53d6d0[_0x514dde(0x244)]&&(_0x3f81b0+='📝\x20Notes:\x20'+_0x53d6d0[_0x514dde(0x244)]+'\x0a'),await this[_0x514dde(0x1eb)](_0x30313c,_0x3f81b0,{'parse_mode':_0x514dde(0x2b7)});}async[a54_0x483342(0x28a)](_0x3d89d7,_0x1c67ac,_0x2ae3a6){const _0x2004d5=a54_0x483342,_0x44a149={'created':'📤','completed':'✅','rejected':'❌'},_0x5463da={'created':_0x2004d5(0x2ad),'completed':_0x2004d5(0x21f),'rejected':_0x2004d5(0x234)},_0x4af26c=_0x44a149[_0x2ae3a6],_0x196cab=_0x5463da[_0x2ae3a6],_0x2a6bdc=_0x4af26c+'\x20*'+_0x196cab+_0x2004d5(0x259)+('💸\x20Amount:\x20*'+_0x1c67ac[_0x2004d5(0x25d)]+'\x20USD*\x0a')+(_0x2004d5(0x1f5)+_0x1c67ac[_0x2004d5(0x208)]+'`\x0a')+(_0x2004d5(0x2a8)+_0x1c67ac['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x1c67ac[_0x2004d5(0x253)])[_0x2004d5(0x209)](_0x2004d5(0x296))+'\x0a')+(_0x1c67ac[_0x2004d5(0x25f)]?'🔗\x20TXID:\x20`'+_0x1c67ac[_0x2004d5(0x25f)]+'`':'');await this['sendShopNotification'](_0x3d89d7,_0x2a6bdc,{'parse_mode':_0x2004d5(0x2b7)});}async[a54_0x483342(0x1f9)](_0x246d37,_0x3311ae){const _0x1df34e=a54_0x483342;try{const _0x26b6b4=await database_1[_0x1df34e(0x263)]['shopSettings'][_0x1df34e(0x1e6)]({'where':{'shopId':_0x246d37},'select':{'notificationLogin':!![]}});if(!_0x26b6b4?.[_0x1df34e(0x222)]){console['log'](_0x1df34e(0x2c0)+_0x246d37);return;}const _0x144544=_0x3311ae['success']?'🔐':'🚨',_0xa803b=_0x3311ae[_0x1df34e(0x2a6)]?_0x1df34e(0x1e0):_0x1df34e(0x210);let _0x2e572f=_0x144544+'\x20*'+_0xa803b+_0x1df34e(0x259)+('👤\x20Username:\x20`'+_0x3311ae[_0x1df34e(0x27a)]+'`\x0a')+(_0x1df34e(0x229)+_0x3311ae['timestamp'][_0x1df34e(0x209)](_0x1df34e(0x296))+'\x0a');_0x3311ae[_0x1df34e(0x22d)]&&(_0x2e572f+=_0x1df34e(0x274)+_0x3311ae[_0x1df34e(0x22d)]+'`\x0a');if(_0x3311ae[_0x1df34e(0x223)]){const _0x314580=_0x3311ae[_0x1df34e(0x223)][_0x1df34e(0x1f2)]>0x32?_0x3311ae['userAgent'][_0x1df34e(0x1f6)](0x0,0x32)+_0x1df34e(0x224):_0x3311ae[_0x1df34e(0x223)];_0x2e572f+=_0x1df34e(0x24e)+_0x314580+'`\x0a';}!_0x3311ae[_0x1df34e(0x2a6)]&&(_0x2e572f+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x1df34e(0x1eb)](_0x246d37,_0x2e572f,{'parse_mode':_0x1df34e(0x2b7)}),console['log'](_0x1df34e(0x200)+_0x246d37+':\x20'+(_0x3311ae[_0x1df34e(0x2a6)]?_0x1df34e(0x2a6):_0x1df34e(0x20a)));}catch(_0x2242a8){console[_0x1df34e(0x276)](_0x1df34e(0x1db),_0x2242a8);}}async[a54_0x483342(0x269)](_0x5882d3,_0x2f35b5){const _0x4a99d6=a54_0x483342;try{const _0x23a4df=await database_1[_0x4a99d6(0x263)][_0x4a99d6(0x202)][_0x4a99d6(0x1e6)]({'where':{'shopId':_0x5882d3},'select':{'notificationApiError':!![]}});if(!_0x23a4df?.[_0x4a99d6(0x297)]){console[_0x4a99d6(0x242)](_0x4a99d6(0x23b)+_0x5882d3);return;}let _0x25348f='🚨\x20*API\x20Error*\x0a\x0a'+(_0x4a99d6(0x2bc)+_0x2f35b5['method']+'\x20'+_0x2f35b5['endpoint']+'`\x0a')+(_0x4a99d6(0x229)+_0x2f35b5['timestamp'][_0x4a99d6(0x209)](_0x4a99d6(0x296))+'\x0a');_0x2f35b5[_0x4a99d6(0x241)]&&(_0x25348f+='📊\x20Error\x20code:\x20`'+_0x2f35b5[_0x4a99d6(0x241)]+'`\x0a'),_0x25348f+=_0x4a99d6(0x207)+_0x2f35b5[_0x4a99d6(0x230)]+'`\x0a',_0x2f35b5[_0x4a99d6(0x24c)]&&(_0x25348f+=_0x4a99d6(0x20b)+_0x2f35b5['requestId']+'`\x0a'),_0x25348f+=_0x4a99d6(0x2ba),await this[_0x4a99d6(0x1eb)](_0x5882d3,_0x25348f,{'parse_mode':_0x4a99d6(0x2b7)}),console[_0x4a99d6(0x242)](_0x4a99d6(0x203)+_0x5882d3+':\x20'+_0x2f35b5[_0x4a99d6(0x1e5)]);}catch(_0x37f4fb){console[_0x4a99d6(0x276)](_0x4a99d6(0x280),_0x37f4fb);}}async[a54_0x483342(0x21e)](_0x38ec47,_0x9515d6,_0xde2cdf){const _0x19f863=a54_0x483342;let _0x2996e8=_0x19f863(0x217)+_0x9515d6+_0x19f863(0x259);for(const [_0x2a6619,_0x26bc68]of Object[_0x19f863(0x29f)](_0xde2cdf)){_0x26bc68!==null&&_0x26bc68!==undefined&&(_0x2996e8+=_0x2a6619+':\x20`'+_0x26bc68+'`\x0a');}await this[_0x19f863(0x1eb)](_0x38ec47,_0x2996e8,{'parse_mode':_0x19f863(0x2b7)});}[a54_0x483342(0x289)](){const _0x257b43=a54_0x483342;return{'isActive':!!this[_0x257b43(0x1dc)],'username':this['botUsername']};}[a54_0x483342(0x279)](){const _0x20e57a=a54_0x483342;this[_0x20e57a(0x1dc)]&&(this[_0x20e57a(0x1dc)]['stopPolling'](),this[_0x20e57a(0x1dc)]=null,console[_0x20e57a(0x242)](_0x20e57a(0x212)));}}function a54_0x38cf(){const _0x28ff54=['Example:\x0a','botToken','Failed\x20to\x20send\x20login\x20notification:','bot','Telegram\x20bot\x20error:','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','New\x20payment\x20created','Successful\x20login','../types/gateway','...\x22','../config/database','warn','endpoint','findUnique','❌\x20Error\x20getting\x20debug\x20information.','map','🌐\x20IP:\x20`','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','sendShopNotification','`\x20is\x20inactive.\x0a\x0a','Payment\x20failed','TELEGRAM_BOT_TOKEN','❌\x20Shop\x20`','sendMessage','/status\x20-\x20check\x20connection\x20status\x0a','length','onText','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','🏦\x20Method:\x20`','substring','findMany','isVerified','sendLoginNotification','handleSingleLineVerification','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','telegramId','Error\x20handling\x20/disconnect\x20command:','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','\x22,\x20apiKey=\x22','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','❌\x20Shop\x20with\x20username\x20`','shopSettings','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','4502ofMGRg','18860mlaMgt','❌\x20Please\x20use\x20/start\x20command\x20first','❌\x20Error:\x20`','method','toLocaleString','failed','🆔\x20Request\x20ID:\x20`','first_name','User\x20','Commands:\x0a','•\x20Payouts\x0a','Failed\x20login\x20attempt','node-telegram-bot-api','🛑\x20Telegram\x20bot\x20stopped','Use\x20/start\x20to\x20connect.','sendPaymentNotification','__importDefault','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','🔔\x20*','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','Payment\x20chargeback','`.\x0a\x0a','🏪\x20Available\x20shops\x20in\x20system:\x0a','Telegram\x20bot\x20polling\x20error:','status','sendCustomNotification','Payout\x20completed','✅\x20Telegram\x20bot\x20@','defineProperty','notificationLogin','userAgent','...','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','/disconnect\x20-\x20disconnect\x20from\x20notifications','toString','publicKey','📅\x20Time:\x20','shopId','toLocaleDateString','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','ipAddress','\x22\x20->\x20display\x20\x22','📅\x20Date:\x20','errorMessage','•\x20Payment\x20status\x20changes\x0a','sk_','split','Payout\x20rejected','processing','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','`\x0a\x0a','`\x20(','🆔\x20Payment\x20ID:\x20`','Error\x20in\x20handleSingleLineVerification:','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Error\x20handling\x20/start\x20command:','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','setupBotHandlers','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','message','statusCode','log','1898904hrMMvd','adminNotes','\x20(@','findFirst','\x20disconnected\x20from\x20shop\x20','•\x20New\x20payments\x0a','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','👤\x20Username:\x20`','📱\x20Your\x20Telegram\x20ID:\x20`','requestId','unknown\x20shop','💻\x20Browser:\x20`','151496BDCSSx','customerUa','Payment\x20is\x20being\x20processed','telegramUser','createdAt','Error\x20handling\x20message:','...`\x0a\x0a','`\x20not\x20found.\x0a\x0a','Contact\x20administrator.','•\x20Important\x20events\x0a\x0a','*\x0a\x0a',':\x20username=\x22','name','Payment\x20expired','amount','❌\x20Invalid\x20username\x20format:\x20`','txid','env','blocked','user\x20is\x20deactivated','default','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','🏦\x20IBAN:\x20`','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','You\x20sent\x20','Payment\x20successfully\x20paid','sendApiErrorNotification','polling_error','7371486ZZHpNK','create','updatedAt','39VhiyIX','💸\x20Penalty\x20amount:\x20*','1222035MEkKiK','initializeBot','allSettled','chat\x20not\x20found','🌐\x20IP\x20address:\x20`','startsWith','error','shop','forEach','stopBot','username','test','from','chat','🔔\x20You\x20receive\x20notifications\x20about:\x0a','💰\x20Amount:\x20*','Failed\x20to\x20send\x20API\x20error\x20notification:','🔌\x20User\x20','✅\x20Welcome\x20back!\x0a\x0a','secretKey','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','includes','28vEmHTf','🏪\x20Gateway:\x20`','\x20initialized\x20successfully','getBotInfo','sendPayoutNotification','chargeback','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','\x20\x20\x20Username:\x20`','40ahUjWI','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','text','customerIp','currency','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','Username:\x20`','Use\x20/start\x20to\x20begin.','en-US','notificationApiError','🎉\x20*Congratulations!*\x0a\x0a','\x20parts:\x20','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','trapay_bot','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','\x20\x20\x20Public\x20Key:\x20`','.\x20*','entries','✅\x20Connected\x20to\x20shop:\x20*','📝\x20Order\x20ID:\x20`','•\x20Payouts\x0a\x0a','2722518qAPsDe','Check\x20spelling\x20and\x20try\x20again.','To\x20reconnect,\x20use\x20the\x20/start\x20command','success','🔍\x20*Debug\x20Information*\x0a\x0a','🆔\x20Payout\x20ID:\x20`','botUsername','TelegramBotService','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','15950RbMdld','New\x20payout\x20created','pk_','customerName','*.\x0a\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','Error\x20handling\x20/status\x20command:','telegramBotService','update','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','📅\x20Connection\x20date:\x20','Markdown','remitterIban','Payment\x20refund','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','🔗\x20Endpoint:\x20`','\x20\x20\x20Status:\x20','chargebackAmount','trim','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','🔔\x20Notifications\x20are\x20active\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'];a54_0x38cf=function(){return _0x28ff54;};return a54_0x38cf();}exports[a54_0x483342(0x2aa)]=TelegramBotService,exports[a54_0x483342(0x2b3)]=new TelegramBotService();