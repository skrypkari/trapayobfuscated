'use strict';const a54_0x16fd7f=a54_0xfcfd;(function(_0x2bbe1e,_0x68c563){const _0x562e7f=a54_0xfcfd,_0x49dbd2=_0x2bbe1e();while(!![]){try{const _0x331528=-parseInt(_0x562e7f(0x137))/0x1*(parseInt(_0x562e7f(0x120))/0x2)+-parseInt(_0x562e7f(0x147))/0x3*(parseInt(_0x562e7f(0x9d))/0x4)+parseInt(_0x562e7f(0xde))/0x5*(-parseInt(_0x562e7f(0xe0))/0x6)+-parseInt(_0x562e7f(0x9a))/0x7+parseInt(_0x562e7f(0x150))/0x8*(-parseInt(_0x562e7f(0x105))/0x9)+parseInt(_0x562e7f(0xe1))/0xa+parseInt(_0x562e7f(0x129))/0xb;if(_0x331528===_0x68c563)break;else _0x49dbd2['push'](_0x49dbd2['shift']());}catch(_0x1d3b0b){_0x49dbd2['push'](_0x49dbd2['shift']());}}}(a54_0x1b01,0xc2838));function a54_0x1b01(){const _0x319d42=['Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','sk_','update','📱\x20Shop:\x20*','statusCode',':\x20`','Use\x20/start\x20to\x20connect.','New\x20payment\x20created','Error\x20handling\x20/disconnect\x20command:','length','Failed\x20to\x20send\x20login\x20notification:','name','telegramId','❌\x20Error:\x20`','txid','notificationLogin','publicKey','text','customerEmail','🏦\x20IBAN:\x20`','•\x20`','\x0a👤\x20*Customer\x20Information:*\x0a','Telegram\x20bot\x20error:','❌\x20Shop\x20with\x20username\x20`','2SJSyMl','errorMessage','User\x20','🌐\x20IP:\x20`','•\x20Payouts\x0a','botUsername','`\x20(','secretKey','toLocaleString','41758057NoMPvv','🔔\x20Notifications\x20are\x20active\x0a\x0a','🚨\x20*API\x20Error*\x0a\x0a','notificationApiError','timestamp','📅\x20Connection\x20date:\x20','last_name','success','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Commands:\x0a','\x20USD*\x0a','\x20verified\x20for\x20shop\x20','shop','💸\x20Penalty\x20amount:\x20*','511930NLESuo','shopId','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','sendPayoutNotification','amount','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','📅\x20Date:\x20','en-US','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','*.\x0a\x0a','startsWith','__importDefault','📱\x20Telegram\x20notification:\x20gateway\x20\x22','initializeBot','📧\x20Email:\x20`','log','86028ddRXBe','userAgent','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','status','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','warn','method','test','7573288hjmiBE','👤\x20Username:\x20`','`\x0a\x0a','onText','message','chargebackAmount','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','...','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','...\x22','../config/database','Error\x20handling\x20/debug\x20command:','isVerified','blocked','📝\x20Order\x20ID:\x20`','sendCustomNotification','`.\x0a\x0a','\x20\x20\x20Public\x20Key:\x20`','findFirst','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','Payment\x20is\x20being\x20processed','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','`\x20is\x20inactive.\x0a\x0a','💰\x20Amount:\x20*','🛑\x20Telegram\x20bot\x20stopped','env','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','📱\x20Created\x20new\x20Telegram\x20user:\x20','Error\x20sending\x20shop\x20notification:',':\x20username=\x22','💻\x20Browser:\x20`','*\x0a\x0a','You\x20sent\x20','🏦\x20Method:\x20`','split','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','/disconnect\x20-\x20disconnect\x20from\x20notifications','❌\x20Please\x20use\x20/start\x20command\x20first','✅\x20Telegram\x20bot\x20@','map','11091605OOtOYY','bot','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','12fUSPSd','•\x20New\x20payments\x0a','\x20\x20\x20Status:\x20','\x22,\x20apiKey=\x22','allSettled','setupBotHandlers','telegramBotService','error','join','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','substring','stopPolling','createdAt','trapay_bot','🎉\x20*Congratulations!*\x0a\x0a','shopSettings','To\x20reconnect,\x20use\x20the\x20/start\x20command','Available\x20usernames:\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Error\x20handling\x20/start\x20command:','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','sendShopNotification','New\x20payout\x20created','sendPaymentNotification','includes','adminNotes','chargeback','unknown\x20shop','✅\x20Welcome\x20back!\x0a\x0a','requestId','customerIp','customerUa','gateway','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','chat\x20not\x20found','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','📅\x20Time:\x20','endpoint','❌\x20Error\x20getting\x20debug\x20information.','sendMessage','✅\x20Connected\x20to\x20shop:\x20*','default','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','findUnique','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Payment\x20successfully\x20paid','🔌\x20User\x20','🏪\x20Gateway:\x20`','__esModule','Check\x20spelling\x20and\x20try\x20again.','Example:\x0a','updatedAt','user\x20is\x20deactivated','...`\x0a\x0a','\x20disconnected\x20from\x20shop\x20','toLocaleDateString','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','customerName','•\x20Payouts\x0a\x0a','trim','pk_','toString','entries','from','📱\x20Your\x20Telegram\x20ID:\x20`','6130550rVNsFf','sendLoginNotification','6nNWuTs','13557850bIwmAf','Contact\x20administrator.','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Markdown','🆔\x20Payout\x20ID:\x20`','💸\x20Amount:\x20*','🆔\x20Payment\x20ID:\x20`','chat','Error\x20in\x20handleSingleLineVerification:','.\x20*','/status\x20-\x20check\x20connection\x20status\x0a','create','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','ipAddress','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','📛\x20Name:\x20`','remitterIban','\x20(@','Payout\x20rejected','•\x20Payment\x20status\x20changes\x0a','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','getBotInfo','botToken','handleSingleLineVerification','\x20\x20\x20Username:\x20`','🔗\x20TXID:\x20`','findMany','telegramUser','✅\x20Telegram\x20user\x20','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','sendApiErrorNotification','username','Payment\x20refund','•\x20Important\x20events\x0a\x0a','forEach','Use\x20/start\x20to\x20begin.','9VSwPvb','Payment\x20expired','🏪\x20Available\x20shops\x20in\x20system:\x0a'];a54_0x1b01=function(){return _0x319d42;};return a54_0x1b01();}var __importDefault=this&&this[a54_0x16fd7f(0x142)]||function(_0x3dc8dc){const _0x236a33=a54_0x16fd7f;return _0x3dc8dc&&_0x3dc8dc[_0x236a33(0xcd)]?_0x3dc8dc:{'default':_0x3dc8dc};};Object['defineProperty'](exports,a54_0x16fd7f(0xcd),{'value':!![]}),exports[a54_0x16fd7f(0xa3)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a54_0x16fd7f(0x15b))),gateway_1=require('../types/gateway');function a54_0xfcfd(_0x1b0af7,_0x40891a){const _0x1b0171=a54_0x1b01();return a54_0xfcfd=function(_0xfcfdb3,_0x469207){_0xfcfdb3=_0xfcfdb3-0x94;let _0x20748c=_0x1b0171[_0xfcfdb3];return _0x20748c;},a54_0xfcfd(_0x1b0af7,_0x40891a);}class TelegramBotService{constructor(){const _0x5e3aea=a54_0x16fd7f;this[_0x5e3aea(0x9b)]=null,this[_0x5e3aea(0xf7)]=process[_0x5e3aea(0x16a)]['TELEGRAM_BOT_TOKEN']||'',this[_0x5e3aea(0x125)]=process['env']['TELEGRAM_BOT_USERNAME']||_0x5e3aea(0xaa),this['botToken']?this[_0x5e3aea(0x144)]():console[_0x5e3aea(0x14d)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a54_0x16fd7f(0x144)](){const _0xb52525=a54_0x16fd7f;try{this[_0xb52525(0x9b)]=new node_telegram_bot_api_1[(_0xb52525(0xc6))](this[_0xb52525(0xf7)],{'polling':!![]}),this[_0xb52525(0xa2)](),console[_0xb52525(0x146)](_0xb52525(0x98)+this[_0xb52525(0x125)]+'\x20initialized\x20successfully');}catch(_0x5472a4){console[_0xb52525(0xa4)](_0xb52525(0x159),_0x5472a4);}}[a54_0x16fd7f(0xa2)](){const _0x5e3e27=a54_0x16fd7f;if(!this[_0x5e3e27(0x9b)])return;this['bot']['onText'](/\/start/,async _0x1d3cb3=>{const _0x530775=_0x5e3e27,_0x58cec5=_0x1d3cb3[_0x530775(0xe8)]['id'],_0x225d57=_0x1d3cb3[_0x530775(0xdc)]?.['id'][_0x530775(0xda)](),_0x448c32=_0x1d3cb3[_0x530775(0xdc)]?.['username'],_0x19ab8f=_0x1d3cb3[_0x530775(0xdc)]?.['first_name'],_0x14a6ed=_0x1d3cb3[_0x530775(0xdc)]?.[_0x530775(0x12f)];if(!_0x225d57)return;try{let _0x46332c=await database_1['default'][_0x530775(0xfc)][_0x530775(0xc8)]({'where':{'telegramId':_0x225d57},'include':{'shop':!![]}});!_0x46332c?(_0x46332c=await database_1[_0x530775(0xc6)]['telegramUser'][_0x530775(0xec)]({'data':{'telegramId':_0x225d57,'username':_0x448c32,'firstName':_0x19ab8f,'lastName':_0x14a6ed,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x530775(0x146)](_0x530775(0x16c)+_0x225d57+_0x530775(0xf2)+_0x448c32+')')):_0x46332c=await database_1['default'][_0x530775(0xfc)]['update']({'where':{'telegramId':_0x225d57},'data':{'username':_0x448c32,'firstName':_0x19ab8f,'lastName':_0x14a6ed},'include':{'shop':!![]}}),_0x46332c[_0x530775(0x15d)]&&_0x46332c[_0x530775(0x138)]&&_0x46332c[_0x530775(0x135)]?await this['bot']?.[_0x530775(0xc4)](_0x58cec5,_0x530775(0xb9)+(_0x530775(0xa6)+_0x46332c[_0x530775(0x135)][_0x530775(0x113)]+'*\x0a')+('Username:\x20`'+_0x46332c[_0x530775(0x135)][_0x530775(0x100)]+_0x530775(0x152))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x530775(0xf4)+_0x530775(0xd7)+_0x530775(0x132)+'/status\x20-\x20check\x20connection\x20status\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x530775(0xe4)}):(_0x46332c[_0x530775(0x138)]&&!_0x46332c['isVerified']&&(await database_1[_0x530775(0xc6)][_0x530775(0xfc)][_0x530775(0x10a)]({'where':{'telegramId':_0x225d57},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x225d57)),await this[_0x530775(0x9b)]?.[_0x530775(0xc4)](_0x58cec5,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x530775(0x131)+_0x530775(0xef)+_0x530775(0xcf)+_0x530775(0x158)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x530775(0xe4)}));}catch(_0x41f740){console[_0x530775(0xa4)](_0x530775(0xb0),_0x41f740),await this[_0x530775(0x9b)]?.[_0x530775(0xc4)](_0x58cec5,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x5e3e27(0x9b)][_0x5e3e27(0x153)](/\/disconnect/,async _0x2f2cf2=>{const _0x378104=_0x5e3e27,_0x3badb2=_0x2f2cf2[_0x378104(0xe8)]['id'],_0x53f805=_0x2f2cf2[_0x378104(0xdc)]?.['id']['toString']();if(!_0x53f805)return;try{const _0x53c73e=await database_1['default']['telegramUser']['findUnique']({'where':{'telegramId':_0x53f805},'include':{'shop':!![]}});if(!_0x53c73e||!_0x53c73e[_0x378104(0x15d)]||!_0x53c73e['shopId']){await this[_0x378104(0x9b)]?.[_0x378104(0xc4)](_0x3badb2,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x3a8d35=_0x53c73e[_0x378104(0x135)]?.[_0x378104(0x113)]||_0x378104(0xb8);await database_1[_0x378104(0xc6)][_0x378104(0xfc)][_0x378104(0x10a)]({'where':{'telegramId':_0x53f805},'data':{'shopId':null,'isVerified':![]}}),console[_0x378104(0x146)](_0x378104(0xcb)+_0x53f805+_0x378104(0xd3)+_0x53c73e['shopId']),await this[_0x378104(0x9b)]?.[_0x378104(0xc4)](_0x3badb2,_0x378104(0x149)+_0x3a8d35+_0x378104(0x140)+_0x378104(0xad),{'parse_mode':_0x378104(0xe4)});}catch(_0x17db93){console[_0x378104(0xa4)](_0x378104(0x110),_0x17db93),await this[_0x378104(0x9b)]?.[_0x378104(0xc4)](_0x3badb2,_0x378104(0xc0));}}),this[_0x5e3e27(0x9b)][_0x5e3e27(0x153)](/\/status/,async _0xeaad4e=>{const _0x48ab6f=_0x5e3e27,_0x5d7845=_0xeaad4e[_0x48ab6f(0xe8)]['id'],_0x2ddd6d=_0xeaad4e['from']?.['id'][_0x48ab6f(0xda)]();if(!_0x2ddd6d)return;try{const _0x51837c=await database_1[_0x48ab6f(0xc6)][_0x48ab6f(0xfc)][_0x48ab6f(0xc8)]({'where':{'telegramId':_0x2ddd6d},'include':{'shop':!![]}});if(!_0x51837c){await this['bot']?.['sendMessage'](_0x5d7845,_0x48ab6f(0x13c)+_0x48ab6f(0x104));return;}if(!_0x51837c['isVerified']||!_0x51837c[_0x48ab6f(0x138)]||!_0x51837c[_0x48ab6f(0x135)]){await this['bot']?.[_0x48ab6f(0xc4)](_0x5d7845,_0x48ab6f(0xd5)+_0x48ab6f(0x10e));return;}await this[_0x48ab6f(0x9b)]?.[_0x48ab6f(0xc4)](_0x5d7845,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x48ab6f(0xc5)+_0x51837c['shop'][_0x48ab6f(0x113)]+'*\x0a')+(_0x48ab6f(0x151)+_0x51837c[_0x48ab6f(0x135)][_0x48ab6f(0x100)]+'`\x0a')+(_0x48ab6f(0x12e)+_0x51837c[_0x48ab6f(0xd0)][_0x48ab6f(0xd4)](_0x48ab6f(0x13e))+'\x0a\x0a')+_0x48ab6f(0x12a)+_0x48ab6f(0x132)+_0x48ab6f(0x96),{'parse_mode':_0x48ab6f(0xe4)});}catch(_0x432552){console['error']('Error\x20handling\x20/status\x20command:',_0x432552),await this['bot']?.[_0x48ab6f(0xc4)](_0x5d7845,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['onText'](/\/debug/,async _0x3799ea=>{const _0xd86c94=_0x5e3e27,_0x5689ad=_0x3799ea[_0xd86c94(0xe8)]['id'],_0x37f3e8=_0x3799ea['from']?.['id'][_0xd86c94(0xda)]();if(!_0x37f3e8)return;try{const _0x14a92a=await database_1[_0xd86c94(0xc6)][_0xd86c94(0x135)][_0xd86c94(0xfb)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x7e567a='🔍\x20*Debug\x20Information*\x0a\x0a';_0x7e567a+=_0xd86c94(0xdd)+_0x37f3e8+'`\x0a\x0a',_0x7e567a+=_0xd86c94(0x107),_0x14a92a[_0xd86c94(0x103)]((_0x5a8816,_0x4a867b)=>{const _0x420bf2=_0xd86c94;_0x7e567a+=_0x4a867b+0x1+_0x420bf2(0xea)+_0x5a8816[_0x420bf2(0x113)]+'*\x0a',_0x7e567a+=_0x420bf2(0xf9)+_0x5a8816[_0x420bf2(0x100)]+'`\x0a',_0x7e567a+=_0x420bf2(0x9f)+_0x5a8816[_0x420bf2(0x14a)]+'\x0a',_0x7e567a+=_0x420bf2(0x162)+_0x5a8816[_0x420bf2(0x118)][_0x420bf2(0xa7)](0x0,0xf)+_0x420bf2(0xd2);}),await this[_0xd86c94(0x9b)]?.[_0xd86c94(0xc4)](_0x5689ad,_0x7e567a,{'parse_mode':_0xd86c94(0xe4)});}catch(_0x47dd96){console['error'](_0xd86c94(0x15c),_0x47dd96),await this[_0xd86c94(0x9b)]?.['sendMessage'](_0x5689ad,_0xd86c94(0xc3));}}),this[_0x5e3e27(0x9b)]['on'](_0x5e3e27(0x154),async _0x3efb2e=>{const _0x5b74b0=_0x5e3e27;if(_0x3efb2e[_0x5b74b0(0x119)]?.[_0x5b74b0(0x141)]('/'))return;const _0x5c15ab=_0x3efb2e[_0x5b74b0(0xe8)]['id'],_0x56d7af=_0x3efb2e[_0x5b74b0(0xdc)]?.['id']['toString'](),_0x595a0f=_0x3efb2e[_0x5b74b0(0x119)]?.[_0x5b74b0(0xd8)]();if(!_0x56d7af||!_0x595a0f)return;try{const _0x37f555=await database_1[_0x5b74b0(0xc6)][_0x5b74b0(0xfc)][_0x5b74b0(0xc8)]({'where':{'telegramId':_0x56d7af},'include':{'shop':!![]}});if(!_0x37f555){await this[_0x5b74b0(0x9b)]?.[_0x5b74b0(0xc4)](_0x5c15ab,_0x5b74b0(0x97));return;}if(_0x37f555[_0x5b74b0(0x15d)]&&_0x37f555[_0x5b74b0(0x138)]&&_0x37f555[_0x5b74b0(0x135)]){await this['bot']?.['sendMessage'](_0x5c15ab,_0x5b74b0(0xe3)+_0x37f555[_0x5b74b0(0x135)][_0x5b74b0(0x113)]+'*.\x0a\x0a'+_0x5b74b0(0x108),{'parse_mode':'Markdown'});return;}const _0xb91a1b=_0x595a0f[_0x5b74b0(0x173)](/\s+/);if(_0xb91a1b['length']!==0x2){await this[_0x5b74b0(0x9b)]?.[_0x5b74b0(0xc4)](_0x5c15ab,_0x5b74b0(0xc9)+_0x5b74b0(0xef)+_0x5b74b0(0xcf)+_0x5b74b0(0x158)+(_0x5b74b0(0x171)+_0xb91a1b[_0x5b74b0(0x111)]+'\x20parts:\x20'+_0xb91a1b[_0x5b74b0(0x99)](_0x5403ac=>'`'+_0x5403ac+'`')[_0x5b74b0(0xa5)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x304c3d,_0x1f3cb8]=_0xb91a1b;console[_0x5b74b0(0x146)](_0x5b74b0(0x9c)+_0x56d7af+_0x5b74b0(0x16e)+_0x304c3d+_0x5b74b0(0xa0)+_0x1f3cb8['substring'](0x0,0xa)+'...\x22'),await this[_0x5b74b0(0xf8)](_0x5c15ab,_0x56d7af,_0x304c3d,_0x1f3cb8);}catch(_0x5e496f){console[_0x5b74b0(0xa4)]('Error\x20handling\x20message:',_0x5e496f),await this[_0x5b74b0(0x9b)]?.[_0x5b74b0(0xc4)](_0x5c15ab,_0x5b74b0(0xc0));}}),this[_0x5e3e27(0x9b)]['on'](_0x5e3e27(0xa4),_0x160dc0=>{const _0x28b551=_0x5e3e27;console[_0x28b551(0xa4)](_0x28b551(0x11e),_0x160dc0);}),this[_0x5e3e27(0x9b)]['on']('polling_error',_0x58ff30=>{const _0x599ff5=_0x5e3e27;console[_0x599ff5(0xa4)]('Telegram\x20bot\x20polling\x20error:',_0x58ff30);});}async['handleSingleLineVerification'](_0x38d7b2,_0x5d8111,_0x3034d0,_0x46e147){const _0x36a2ae=a54_0x16fd7f;try{console['log'](_0x36a2ae(0x9c)+_0x5d8111+_0x36a2ae(0x16e)+_0x3034d0+_0x36a2ae(0xa0)+_0x46e147['substring'](0x0,0xa)+_0x36a2ae(0x15a));if(!_0x3034d0||_0x3034d0[_0x36a2ae(0x111)]<0x3||_0x3034d0[_0x36a2ae(0x111)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x36a2ae(0x14f)](_0x3034d0)){await this[_0x36a2ae(0x9b)]?.[_0x36a2ae(0xc4)](_0x38d7b2,'❌\x20Invalid\x20username\x20format:\x20`'+_0x3034d0+_0x36a2ae(0x152)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x36a2ae(0xe4)});return;}if(!_0x46e147||!_0x46e147['startsWith'](_0x36a2ae(0xd9))&&!_0x46e147[_0x36a2ae(0x141)](_0x36a2ae(0x109))){await this['bot']?.['sendMessage'](_0x38d7b2,_0x36a2ae(0x94)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x36a2ae(0xe4)});return;}const _0x3ec403=await database_1[_0x36a2ae(0xc6)]['shop'][_0x36a2ae(0xc8)]({'where':{'username':_0x3034d0},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x3ec403){const _0x233b5c=await database_1['default'][_0x36a2ae(0x135)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x426787=_0x36a2ae(0x11f)+_0x3034d0+'`\x20not\x20found.\x0a\x0a';_0x233b5c[_0x36a2ae(0x111)]>0x0?(_0x426787+=_0x36a2ae(0xae),_0x233b5c[_0x36a2ae(0x103)](_0x160732=>{const _0x124538=_0x36a2ae;_0x426787+=_0x124538(0x11c)+_0x160732[_0x124538(0x100)]+_0x124538(0x126)+_0x160732['name']+')\x0a';}),_0x426787+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x426787+=_0x36a2ae(0xce);await this[_0x36a2ae(0x9b)]?.[_0x36a2ae(0xc4)](_0x38d7b2,_0x426787,{'parse_mode':_0x36a2ae(0xe4)});return;}if(_0x3ec403[_0x36a2ae(0x14a)]!=='ACTIVE'){await this[_0x36a2ae(0x9b)]?.['sendMessage'](_0x38d7b2,'❌\x20Shop\x20`'+_0x3034d0+_0x36a2ae(0x167)+_0x36a2ae(0xe2),{'parse_mode':_0x36a2ae(0xe4)});return;}if(_0x3ec403[_0x36a2ae(0x118)]!==_0x46e147&&_0x3ec403[_0x36a2ae(0x127)]!==_0x46e147){await this[_0x36a2ae(0x9b)]?.[_0x36a2ae(0xc4)](_0x38d7b2,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x3034d0+_0x36a2ae(0x161)+_0x36a2ae(0xb1)+_0x36a2ae(0x95),{'parse_mode':_0x36a2ae(0xe4)});return;}const _0x1ab352=await database_1[_0x36a2ae(0xc6)][_0x36a2ae(0xfc)][_0x36a2ae(0x163)]({'where':{'shopId':_0x3ec403['id'],'isVerified':!![],'telegramId':{'not':_0x5d8111}}});if(_0x1ab352){await this[_0x36a2ae(0x9b)]?.[_0x36a2ae(0xc4)](_0x38d7b2,_0x36a2ae(0xf5)+_0x3034d0+_0x36a2ae(0x161)+_0x36a2ae(0xfe),{'parse_mode':_0x36a2ae(0xe4)});return;}await database_1[_0x36a2ae(0xc6)][_0x36a2ae(0xfc)][_0x36a2ae(0x10a)]({'where':{'telegramId':_0x5d8111},'data':{'shopId':_0x3ec403['id'],'isVerified':!![]}}),await this[_0x36a2ae(0x9b)]?.[_0x36a2ae(0xc4)](_0x38d7b2,_0x36a2ae(0xab)+_0x36a2ae(0xed)+(_0x36a2ae(0x10b)+_0x3ec403[_0x36a2ae(0x113)]+'*\x0a')+(_0x36a2ae(0x151)+_0x3ec403['username']+'`\x0a\x0a')+_0x36a2ae(0x14b)+_0x36a2ae(0x9e)+_0x36a2ae(0xf4)+_0x36a2ae(0x124)+_0x36a2ae(0x102)+'Commands:\x0a'+_0x36a2ae(0xeb)+_0x36a2ae(0x96),{'parse_mode':_0x36a2ae(0xe4)}),console[_0x36a2ae(0x146)](_0x36a2ae(0xfd)+_0x5d8111+_0x36a2ae(0x134)+_0x3ec403[_0x36a2ae(0x100)]+'\x20via\x20single-line\x20input');}catch(_0x14b657){console[_0x36a2ae(0xa4)](_0x36a2ae(0xe9),_0x14b657),await this[_0x36a2ae(0x9b)]?.['sendMessage'](_0x38d7b2,_0x36a2ae(0xaf));}}async['sendShopNotification'](_0xd094ae,_0x46a569,_0x250557){const _0x28e087=a54_0x16fd7f;if(!this[_0x28e087(0x9b)]){console[_0x28e087(0x14d)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x3a1f13=await database_1[_0x28e087(0xc6)][_0x28e087(0xfc)][_0x28e087(0xfb)]({'where':{'shopId':_0xd094ae,'isVerified':!![]}});if(_0x3a1f13[_0x28e087(0x111)]===0x0){console[_0x28e087(0x146)](_0x28e087(0x13f)+_0xd094ae);return;}const _0x5bd7d7=_0x3a1f13[_0x28e087(0x99)](async _0x19c120=>{const _0x247339=_0x28e087;try{await this['bot']?.[_0x247339(0xc4)](_0x19c120[_0x247339(0x114)],_0x46a569,_0x250557),console[_0x247339(0x146)](_0x247339(0x174)+_0x19c120[_0x247339(0x114)]);}catch(_0x27421c){console[_0x247339(0xa4)](_0x247339(0xc7)+_0x19c120[_0x247339(0x114)]+':',_0x27421c),_0x27421c instanceof Error&&(_0x27421c[_0x247339(0x154)]['includes'](_0x247339(0x15e))||_0x27421c[_0x247339(0x154)][_0x247339(0xb5)](_0x247339(0xbf))||_0x27421c[_0x247339(0x154)][_0x247339(0xb5)](_0x247339(0xd1)))&&(await database_1[_0x247339(0xc6)][_0x247339(0xfc)][_0x247339(0x10a)]({'where':{'id':_0x19c120['id']},'data':{'isVerified':![]}}),console[_0x247339(0x146)](_0x247339(0x122)+_0x19c120[_0x247339(0x114)]+_0x247339(0x166)));}});await Promise[_0x28e087(0xa1)](_0x5bd7d7);}catch(_0x5de97b){console[_0x28e087(0xa4)](_0x28e087(0x16d),_0x5de97b);}}async[a54_0x16fd7f(0xb4)](_0x43a85c,_0x1b790c,_0x2c1a88){const _0xae8c7f=a54_0x16fd7f,_0x57af62={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x231f56={'created':_0xae8c7f(0x10f),'paid':_0xae8c7f(0xca),'failed':'Payment\x20failed','expired':_0xae8c7f(0x106),'refund':_0xae8c7f(0x101),'chargeback':'Payment\x20chargeback','processing':_0xae8c7f(0x165)},_0x2effe1=_0x57af62[_0x2c1a88],_0x1b6b11=_0x231f56[_0x2c1a88],_0x2d8b78=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x1b790c[_0xae8c7f(0xbd)]);console[_0xae8c7f(0x146)](_0xae8c7f(0x143)+_0x1b790c[_0xae8c7f(0xbd)]+'\x22\x20->\x20display\x20\x22'+_0x2d8b78+'\x22');let _0x3d3afd=_0x2effe1+'\x20*'+_0x1b6b11+'*\x0a\x0a'+(_0xae8c7f(0x168)+_0x1b790c[_0xae8c7f(0x13b)]+'\x20'+_0x1b790c['currency']+'*\x0a')+(_0xae8c7f(0x15f)+(_0x1b790c['orderId']||_0x1b790c['id'])+'`\x0a')+(_0xae8c7f(0xe7)+_0x1b790c['id']+'`\x0a')+(_0xae8c7f(0xcc)+_0x2d8b78+'`\x0a')+(_0xae8c7f(0x13d)+new Date(_0x1b790c[_0xae8c7f(0xa9)])[_0xae8c7f(0x128)]('en-US')+'\x0a');if(_0x1b790c[_0xae8c7f(0xd6)]||_0x1b790c[_0xae8c7f(0x11a)]||_0x1b790c[_0xae8c7f(0xf1)]||_0x1b790c[_0xae8c7f(0xbb)]||_0x1b790c['customerUa']){_0x3d3afd+=_0xae8c7f(0x11d);_0x1b790c[_0xae8c7f(0xd6)]&&(_0x3d3afd+=_0xae8c7f(0xf0)+_0x1b790c[_0xae8c7f(0xd6)]+'`\x0a');_0x1b790c[_0xae8c7f(0x11a)]&&(_0x3d3afd+=_0xae8c7f(0x145)+_0x1b790c[_0xae8c7f(0x11a)]+'`\x0a');_0x1b790c[_0xae8c7f(0xf1)]&&(_0x3d3afd+=_0xae8c7f(0x11b)+_0x1b790c[_0xae8c7f(0xf1)]+'`\x0a');_0x1b790c[_0xae8c7f(0xbb)]&&(_0x3d3afd+=_0xae8c7f(0x123)+_0x1b790c[_0xae8c7f(0xbb)]+'`\x0a');if(_0x1b790c['customerUa']){const _0x415797=_0x1b790c[_0xae8c7f(0xbc)][_0xae8c7f(0x111)]>0x32?_0x1b790c[_0xae8c7f(0xbc)][_0xae8c7f(0xa7)](0x0,0x32)+_0xae8c7f(0x157):_0x1b790c[_0xae8c7f(0xbc)];_0x3d3afd+=_0xae8c7f(0x16f)+_0x415797+'`\x0a';}}_0x2c1a88===_0xae8c7f(0xb7)&&_0x1b790c[_0xae8c7f(0x155)]&&(_0x3d3afd+=_0xae8c7f(0x136)+_0x1b790c[_0xae8c7f(0x155)]+'\x20USDT*\x0a'),_0x2c1a88==='processing'&&(_0x3d3afd+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x1b790c[_0xae8c7f(0xb6)]&&(_0x3d3afd+='📝\x20Notes:\x20'+_0x1b790c['adminNotes']+'\x0a'),await this[_0xae8c7f(0xb2)](_0x43a85c,_0x3d3afd,{'parse_mode':_0xae8c7f(0xe4)});}async[a54_0x16fd7f(0x13a)](_0x3d5318,_0x54bfad,_0x2b82aa){const _0x355530=a54_0x16fd7f,_0x492bf7={'created':'📤','completed':'✅','rejected':'❌'},_0x39ff8c={'created':_0x355530(0xb3),'completed':'Payout\x20completed','rejected':_0x355530(0xf3)},_0x4c5932=_0x492bf7[_0x2b82aa],_0xfff7d6=_0x39ff8c[_0x2b82aa],_0x42a97b=_0x4c5932+'\x20*'+_0xfff7d6+_0x355530(0x170)+(_0x355530(0xe6)+_0x54bfad[_0x355530(0x13b)]+_0x355530(0x133))+(_0x355530(0x172)+_0x54bfad[_0x355530(0x14e)]+'`\x0a')+(_0x355530(0xe5)+_0x54bfad['id']+'`\x0a')+(_0x355530(0x13d)+new Date(_0x54bfad['createdAt'])[_0x355530(0x128)](_0x355530(0x13e))+'\x0a')+(_0x54bfad[_0x355530(0x116)]?_0x355530(0xfa)+_0x54bfad[_0x355530(0x116)]+'`':'');await this[_0x355530(0xb2)](_0x3d5318,_0x42a97b,{'parse_mode':_0x355530(0xe4)});}async[a54_0x16fd7f(0xdf)](_0x1d236e,_0xbf086a){const _0x7d3513=a54_0x16fd7f;try{const _0x8f1789=await database_1[_0x7d3513(0xc6)][_0x7d3513(0xac)][_0x7d3513(0xc8)]({'where':{'shopId':_0x1d236e},'select':{'notificationLogin':!![]}});if(!_0x8f1789?.[_0x7d3513(0x117)]){console[_0x7d3513(0x146)](_0x7d3513(0x156)+_0x1d236e);return;}const _0x146b3d=_0xbf086a[_0x7d3513(0x130)]?'🔐':'🚨',_0x144b2f=_0xbf086a[_0x7d3513(0x130)]?'Successful\x20login':'Failed\x20login\x20attempt';let _0x3b784b=_0x146b3d+'\x20*'+_0x144b2f+_0x7d3513(0x170)+('👤\x20Username:\x20`'+_0xbf086a['username']+'`\x0a')+(_0x7d3513(0xc1)+_0xbf086a[_0x7d3513(0x12d)][_0x7d3513(0x128)]('en-US')+'\x0a');_0xbf086a[_0x7d3513(0xee)]&&(_0x3b784b+='🌐\x20IP\x20address:\x20`'+_0xbf086a[_0x7d3513(0xee)]+'`\x0a');if(_0xbf086a[_0x7d3513(0x148)]){const _0x1f1b1c=_0xbf086a[_0x7d3513(0x148)][_0x7d3513(0x111)]>0x32?_0xbf086a['userAgent'][_0x7d3513(0xa7)](0x0,0x32)+_0x7d3513(0x157):_0xbf086a[_0x7d3513(0x148)];_0x3b784b+=_0x7d3513(0x16f)+_0x1f1b1c+'`\x0a';}!_0xbf086a[_0x7d3513(0x130)]&&(_0x3b784b+=_0x7d3513(0x139)),await this[_0x7d3513(0xb2)](_0x1d236e,_0x3b784b,{'parse_mode':'Markdown'}),console[_0x7d3513(0x146)](_0x7d3513(0xbe)+_0x1d236e+':\x20'+(_0xbf086a[_0x7d3513(0x130)]?_0x7d3513(0x130):'failed'));}catch(_0x545f06){console[_0x7d3513(0xa4)](_0x7d3513(0x112),_0x545f06);}}async[a54_0x16fd7f(0xff)](_0x497c17,_0x316ce9){const _0x5d2399=a54_0x16fd7f;try{const _0x396c84=await database_1[_0x5d2399(0xc6)]['shopSettings'][_0x5d2399(0xc8)]({'where':{'shopId':_0x497c17},'select':{'notificationApiError':!![]}});if(!_0x396c84?.[_0x5d2399(0x12c)]){console['log'](_0x5d2399(0x14c)+_0x497c17);return;}let _0x32b02c=_0x5d2399(0x12b)+('🔗\x20Endpoint:\x20`'+_0x316ce9[_0x5d2399(0x14e)]+'\x20'+_0x316ce9[_0x5d2399(0xc2)]+'`\x0a')+('📅\x20Time:\x20'+_0x316ce9[_0x5d2399(0x12d)][_0x5d2399(0x128)]('en-US')+'\x0a');_0x316ce9[_0x5d2399(0x10c)]&&(_0x32b02c+='📊\x20Error\x20code:\x20`'+_0x316ce9[_0x5d2399(0x10c)]+'`\x0a'),_0x32b02c+=_0x5d2399(0x115)+_0x316ce9[_0x5d2399(0x121)]+'`\x0a',_0x316ce9[_0x5d2399(0xba)]&&(_0x32b02c+='🆔\x20Request\x20ID:\x20`'+_0x316ce9[_0x5d2399(0xba)]+'`\x0a'),_0x32b02c+=_0x5d2399(0x164),await this[_0x5d2399(0xb2)](_0x497c17,_0x32b02c,{'parse_mode':'Markdown'}),console[_0x5d2399(0x146)](_0x5d2399(0x16b)+_0x497c17+':\x20'+_0x316ce9[_0x5d2399(0xc2)]);}catch(_0x5499e3){console[_0x5d2399(0xa4)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x5499e3);}}async[a54_0x16fd7f(0x160)](_0x1fd3ff,_0x492f04,_0x4a6fdf){const _0x47ef24=a54_0x16fd7f;let _0x43f0ed='🔔\x20*'+_0x492f04+_0x47ef24(0x170);for(const [_0x1a2862,_0x208ec8]of Object[_0x47ef24(0xdb)](_0x4a6fdf)){_0x208ec8!==null&&_0x208ec8!==undefined&&(_0x43f0ed+=_0x1a2862+_0x47ef24(0x10d)+_0x208ec8+'`\x0a');}await this[_0x47ef24(0xb2)](_0x1fd3ff,_0x43f0ed,{'parse_mode':_0x47ef24(0xe4)});}[a54_0x16fd7f(0xf6)](){const _0x6b26af=a54_0x16fd7f;return{'isActive':!!this[_0x6b26af(0x9b)],'username':this[_0x6b26af(0x125)]};}['stopBot'](){const _0x472831=a54_0x16fd7f;this[_0x472831(0x9b)]&&(this[_0x472831(0x9b)][_0x472831(0xa8)](),this['bot']=null,console['log'](_0x472831(0x169)));}}exports['TelegramBotService']=TelegramBotService,exports[a54_0x16fd7f(0xa3)]=new TelegramBotService();