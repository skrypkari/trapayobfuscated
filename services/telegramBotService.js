'use strict';function a78_0x58f9(_0x1bbf2d,_0x51136a){_0x1bbf2d=_0x1bbf2d-0xdd;const _0x3a9c27=a78_0x3a9c();let _0x58f909=_0x3a9c27[_0x1bbf2d];return _0x58f909;}const a78_0x50b926=a78_0x58f9;(function(_0xc25b8a,_0x2a578d){const _0x5439b6=a78_0x58f9,_0x3e3bbc=_0xc25b8a();while(!![]){try{const _0x2a859a=-parseInt(_0x5439b6(0x1c4))/0x1+-parseInt(_0x5439b6(0x1b6))/0x2+-parseInt(_0x5439b6(0xe2))/0x3+-parseInt(_0x5439b6(0x1cf))/0x4*(-parseInt(_0x5439b6(0x13a))/0x5)+-parseInt(_0x5439b6(0x17e))/0x6*(parseInt(_0x5439b6(0x197))/0x7)+parseInt(_0x5439b6(0xf9))/0x8+-parseInt(_0x5439b6(0x14f))/0x9*(-parseInt(_0x5439b6(0x1b2))/0xa);if(_0x2a859a===_0x2a578d)break;else _0x3e3bbc['push'](_0x3e3bbc['shift']());}catch(_0x10dab1){_0x3e3bbc['push'](_0x3e3bbc['shift']());}}}(a78_0x3a9c,0xed54e));var __importDefault=this&&this[a78_0x50b926(0x11e)]||function(_0xe89a8a){const _0x5e3dd0=a78_0x50b926;return _0xe89a8a&&_0xe89a8a[_0x5e3dd0(0x131)]?_0xe89a8a:{'default':_0xe89a8a};};Object[a78_0x50b926(0x193)](exports,'__esModule',{'value':!![]}),exports[a78_0x50b926(0xff)]=exports[a78_0x50b926(0x140)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a78_0x50b926(0xf2))),database_1=__importDefault(require(a78_0x50b926(0xfa))),gateway_1=require(a78_0x50b926(0x10d));class TelegramBotService{constructor(){const _0x599e0a=a78_0x50b926;this['bot']=null,this[_0x599e0a(0x128)]=process[_0x599e0a(0x108)][_0x599e0a(0x1a5)]||'',this[_0x599e0a(0x121)]=process['env']['TELEGRAM_BOT_USERNAME']||_0x599e0a(0x16c),this[_0x599e0a(0x128)]?this[_0x599e0a(0x119)]():console[_0x599e0a(0x184)](_0x599e0a(0x194));}[a78_0x50b926(0x119)](){const _0x5ed777=a78_0x50b926;try{this['bot']=new node_telegram_bot_api_1[(_0x5ed777(0x12a))](this['botToken'],{'polling':!![]}),this['setupBotHandlers'](),console[_0x5ed777(0x18a)](_0x5ed777(0x116)+this[_0x5ed777(0x121)]+'\x20initialized\x20successfully');}catch(_0x9e8d7b){console['error'](_0x5ed777(0xf7),_0x9e8d7b);}}[a78_0x50b926(0x16b)](){const _0x4937df=a78_0x50b926;if(!this[_0x4937df(0x1b9)])return;this['bot']['onText'](/\/start/,async _0x1c6c75=>{const _0xcdbcc6=_0x4937df,_0x1cad6d=_0x1c6c75[_0xcdbcc6(0x19b)]['id'],_0x363ce9=_0x1c6c75[_0xcdbcc6(0x1a4)]?.['id'][_0xcdbcc6(0x14c)](),_0x3344aa=_0x1c6c75[_0xcdbcc6(0x1a4)]?.[_0xcdbcc6(0x1aa)],_0x5961f3=_0x1c6c75[_0xcdbcc6(0x1a4)]?.[_0xcdbcc6(0x14e)],_0xaf59bc=_0x1c6c75['from']?.[_0xcdbcc6(0x186)];if(!_0x363ce9)return;try{let _0x23557c=await database_1[_0xcdbcc6(0x12a)][_0xcdbcc6(0x159)][_0xcdbcc6(0x14b)]({'where':{'telegramId':_0x363ce9},'include':{'shop':!![]}});!_0x23557c?(_0x23557c=await database_1[_0xcdbcc6(0x12a)][_0xcdbcc6(0x159)]['create']({'data':{'telegramId':_0x363ce9,'username':_0x3344aa,'firstName':_0x5961f3,'lastName':_0xaf59bc,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log']('ğŸ“±\x20Created\x20new\x20Telegram\x20user:\x20'+_0x363ce9+'\x20(@'+_0x3344aa+')')):_0x23557c=await database_1[_0xcdbcc6(0x12a)]['telegramUser']['update']({'where':{'telegramId':_0x363ce9},'data':{'username':_0x3344aa,'firstName':_0x5961f3,'lastName':_0xaf59bc},'include':{'shop':!![]}}),_0x23557c[_0xcdbcc6(0xe5)]&&_0x23557c[_0xcdbcc6(0x127)]&&_0x23557c['shop']?await this[_0xcdbcc6(0x1b9)]?.[_0xcdbcc6(0x180)](_0x1cad6d,'âœ…\x20Welcome\x20back!\x0a\x0a'+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x23557c['shop'][_0xcdbcc6(0x152)]+'*\x0a')+('Username:\x20`'+_0x23557c[_0xcdbcc6(0x14d)]['username']+_0xcdbcc6(0x1d7))+_0xcdbcc6(0x1a3)+_0xcdbcc6(0x1d0)+_0xcdbcc6(0x150)+_0xcdbcc6(0x169)+_0xcdbcc6(0x11c)+_0xcdbcc6(0x120)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}):(_0x23557c['shopId']&&!_0x23557c[_0xcdbcc6(0xe5)]&&(await database_1[_0xcdbcc6(0x12a)]['telegramUser'][_0xcdbcc6(0xf4)]({'where':{'telegramId':_0x363ce9},'data':{'shopId':null,'isVerified':![]}}),console[_0xcdbcc6(0x18a)](_0xcdbcc6(0x1c8)+_0x363ce9)),await this[_0xcdbcc6(0x1b9)]?.['sendMessage'](_0x1cad6d,'ğŸ¤–\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0xcdbcc6(0xe7)+'Example:\x0a'+_0xcdbcc6(0x12c)+_0xcdbcc6(0x16e),{'parse_mode':'Markdown'}));}catch(_0x280479){console[_0xcdbcc6(0x189)](_0xcdbcc6(0x13b),_0x280479),await this[_0xcdbcc6(0x1b9)]?.[_0xcdbcc6(0x180)](_0x1cad6d,_0xcdbcc6(0x162));}}),this[_0x4937df(0x1b9)][_0x4937df(0x13c)](/\/disconnect/,async _0x545cb8=>{const _0x1fec38=_0x4937df,_0x57a643=_0x545cb8[_0x1fec38(0x19b)]['id'],_0x1b4561=_0x545cb8[_0x1fec38(0x1a4)]?.['id'][_0x1fec38(0x14c)]();if(!_0x1b4561)return;try{const _0x2dd9fd=await database_1['default']['telegramUser']['findUnique']({'where':{'telegramId':_0x1b4561},'include':{'shop':!![]}});if(!_0x2dd9fd||!_0x2dd9fd[_0x1fec38(0xe5)]||!_0x2dd9fd[_0x1fec38(0x127)]){await this['bot']?.[_0x1fec38(0x180)](_0x57a643,_0x1fec38(0x164));return;}const _0x278b7e=_0x2dd9fd[_0x1fec38(0x14d)]?.[_0x1fec38(0x152)]||_0x1fec38(0xe6);await database_1[_0x1fec38(0x12a)][_0x1fec38(0x159)][_0x1fec38(0xf4)]({'where':{'telegramId':_0x1b4561},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x1fec38(0x15a)+_0x1b4561+_0x1fec38(0xe3)+_0x2dd9fd[_0x1fec38(0x127)]),await this[_0x1fec38(0x1b9)]?.[_0x1fec38(0x180)](_0x57a643,_0x1fec38(0x155)+_0x278b7e+'*.\x0a\x0a'+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':'Markdown'});}catch(_0x130ed0){console['error'](_0x1fec38(0x132),_0x130ed0),await this[_0x1fec38(0x1b9)]?.[_0x1fec38(0x180)](_0x57a643,_0x1fec38(0x162));}}),this['bot'][_0x4937df(0x13c)](/\/status/,async _0x4bbde4=>{const _0x42a5b0=_0x4937df,_0x580a07=_0x4bbde4[_0x42a5b0(0x19b)]['id'],_0x2555b7=_0x4bbde4[_0x42a5b0(0x1a4)]?.['id'][_0x42a5b0(0x14c)]();if(!_0x2555b7)return;try{const _0x3356af=await database_1[_0x42a5b0(0x12a)]['telegramUser'][_0x42a5b0(0x14b)]({'where':{'telegramId':_0x2555b7},'include':{'shop':!![]}});if(!_0x3356af){await this[_0x42a5b0(0x1b9)]?.['sendMessage'](_0x580a07,'âŒ\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+'Use\x20/start\x20to\x20begin.');return;}if(!_0x3356af['isVerified']||!_0x3356af['shopId']||!_0x3356af['shop']){await this[_0x42a5b0(0x1b9)]?.[_0x42a5b0(0x180)](_0x580a07,_0x42a5b0(0x12e)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x42a5b0(0x1b9)]?.[_0x42a5b0(0x180)](_0x580a07,_0x42a5b0(0x100)+(_0x42a5b0(0x1d5)+_0x3356af[_0x42a5b0(0x14d)][_0x42a5b0(0x152)]+'*\x0a')+(_0x42a5b0(0x171)+_0x3356af['shop']['username']+'`\x0a')+('ğŸ“…\x20Connection\x20date:\x20'+_0x3356af[_0x42a5b0(0x18e)][_0x42a5b0(0x110)](_0x42a5b0(0x188))+'\x0a\x0a')+'ğŸ””\x20Notifications\x20are\x20active\x0a\x0a'+_0x42a5b0(0x11c)+_0x42a5b0(0xfb),{'parse_mode':_0x42a5b0(0x1ce)});}catch(_0x259d95){console[_0x42a5b0(0x189)]('Error\x20handling\x20/status\x20command:',_0x259d95),await this[_0x42a5b0(0x1b9)]?.[_0x42a5b0(0x180)](_0x580a07,_0x42a5b0(0x162));}}),this['bot'][_0x4937df(0x13c)](/\/debug/,async _0x5af77b=>{const _0x2cc311=_0x4937df,_0x222eed=_0x5af77b[_0x2cc311(0x19b)]['id'],_0x1b03de=_0x5af77b['from']?.['id'][_0x2cc311(0x14c)]();if(!_0x1b03de)return;try{const _0x5dc24b=await database_1[_0x2cc311(0x12a)][_0x2cc311(0x159)][_0x2cc311(0x14b)]({'where':{'telegramId':_0x1b03de},'include':{'shop':!![]}});let _0x5dca04=_0x2cc311(0x1b8);_0x5dca04+=_0x2cc311(0x1af)+_0x1b03de+_0x2cc311(0x1d7),_0x5dc24b?.['isVerified']&&_0x5dc24b[_0x2cc311(0x14d)]?(_0x5dca04+=_0x2cc311(0x11f),_0x5dca04+=_0x2cc311(0xf1)+_0x5dc24b['shop']['name']+'*\x0a',_0x5dca04+=_0x2cc311(0x113)+_0x5dc24b[_0x2cc311(0x14d)][_0x2cc311(0x1aa)]+'`\x0a',_0x5dca04+=_0x2cc311(0x183)+_0x5dc24b[_0x2cc311(0x14d)][_0x2cc311(0x17a)]+'\x0a\x0a'):_0x5dca04+=_0x2cc311(0x1cb),_0x5dca04+=_0x2cc311(0x1a7),await this[_0x2cc311(0x1b9)]?.[_0x2cc311(0x180)](_0x222eed,_0x5dca04,{'parse_mode':_0x2cc311(0x1ce)});}catch(_0x413e63){console[_0x2cc311(0x189)]('Error\x20handling\x20/debug\x20command:',_0x413e63),await this[_0x2cc311(0x1b9)]?.[_0x2cc311(0x180)](_0x222eed,_0x2cc311(0x105));}}),this[_0x4937df(0x1b9)]['on'](_0x4937df(0x1c9),async _0x49df93=>{const _0x18d8d1=_0x4937df;if(_0x49df93['text']?.[_0x18d8d1(0xec)]('/'))return;const _0x3d99ce=_0x49df93[_0x18d8d1(0x19b)]['id'],_0x8d452d=_0x49df93[_0x18d8d1(0x1a4)]?.['id'][_0x18d8d1(0x14c)](),_0x31ca3e=_0x49df93[_0x18d8d1(0xf6)]?.[_0x18d8d1(0x10a)]();if(!_0x8d452d||!_0x31ca3e)return;try{const _0x6d8616=await database_1[_0x18d8d1(0x12a)][_0x18d8d1(0x159)][_0x18d8d1(0x14b)]({'where':{'telegramId':_0x8d452d},'include':{'shop':!![]}});if(!_0x6d8616){await this[_0x18d8d1(0x1b9)]?.[_0x18d8d1(0x180)](_0x3d99ce,_0x18d8d1(0x1d3));return;}if(_0x6d8616['isVerified']&&_0x6d8616['shopId']&&_0x6d8616[_0x18d8d1(0x14d)]){await this['bot']?.[_0x18d8d1(0x180)](_0x3d99ce,'âœ…\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x6d8616[_0x18d8d1(0x14d)][_0x18d8d1(0x152)]+'*.\x0a\x0a'+_0x18d8d1(0x135),{'parse_mode':_0x18d8d1(0x1ce)});return;}const _0x2723b2=_0x31ca3e[_0x18d8d1(0x178)](/\s+/);if(_0x2723b2[_0x18d8d1(0xdd)]!==0x2){await this[_0x18d8d1(0x1b9)]?.['sendMessage'](_0x3d99ce,_0x18d8d1(0x151)+'ğŸ“\x20Format:\x20`username\x20api_key`\x0a\x0a'+'Example:\x0a'+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x18d8d1(0x1a0)+_0x2723b2[_0x18d8d1(0xdd)]+'\x20parts:\x20'+_0x2723b2[_0x18d8d1(0x158)](_0x1f1a5c=>'`'+_0x1f1a5c+'`')[_0x18d8d1(0xef)](',\x20')),{'parse_mode':_0x18d8d1(0x1ce)});return;}const [_0x53418b,_0x5546b4]=_0x2723b2;console[_0x18d8d1(0x18a)](_0x18d8d1(0x148)+_0x8d452d+_0x18d8d1(0x141)+_0x53418b+'\x22,\x20apiKey=\x22'+_0x5546b4[_0x18d8d1(0x115)](0x0,0xa)+_0x18d8d1(0x1ba)),await this[_0x18d8d1(0xfe)](_0x3d99ce,_0x8d452d,_0x53418b,_0x5546b4);}catch(_0x8f2afe){console['error'](_0x18d8d1(0x1bf),_0x8f2afe),await this['bot']?.[_0x18d8d1(0x180)](_0x3d99ce,_0x18d8d1(0x162));}}),this[_0x4937df(0x1b9)]['on']('error',_0x53e078=>{const _0x2921fa=_0x4937df;console[_0x2921fa(0x189)](_0x2921fa(0x172),_0x53e078);}),this['bot']['on'](_0x4937df(0x170),_0x5cc50b=>{const _0x2852de=_0x4937df;console[_0x2852de(0x189)](_0x2852de(0x107),_0x5cc50b);});}async['handleSingleLineVerification'](_0x356000,_0x47195d,_0xa916c2,_0x59e15b){const _0x518b08=a78_0x50b926;try{console[_0x518b08(0x18a)](_0x518b08(0x148)+_0x47195d+_0x518b08(0x141)+_0xa916c2+_0x518b08(0x10f)+_0x59e15b[_0x518b08(0x115)](0x0,0xa)+'...\x22');if(!_0xa916c2||_0xa916c2[_0x518b08(0xdd)]<0x3||_0xa916c2[_0x518b08(0xdd)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x518b08(0x1ab)](_0xa916c2)){await this[_0x518b08(0x1b9)]?.[_0x518b08(0x180)](_0x356000,'âŒ\x20Invalid\x20username\x20format:\x20`'+_0xa916c2+_0x518b08(0x1d7)+_0x518b08(0xeb),{'parse_mode':_0x518b08(0x1ce)});return;}if(!_0x59e15b||!_0x59e15b['startsWith']('pk_')&&!_0x59e15b[_0x518b08(0xec)](_0x518b08(0x139))){await this[_0x518b08(0x1b9)]?.[_0x518b08(0x180)](_0x356000,_0x518b08(0x18f)+_0x518b08(0x17d),{'parse_mode':_0x518b08(0x1ce)});return;}const _0x4d6137=await database_1['default'][_0x518b08(0x14d)][_0x518b08(0x14b)]({'where':{'username':_0xa916c2},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x4d6137){const _0x4c1e6f=_0x518b08(0x163)+_0xa916c2+'`\x20not\x20found.\x0a\x0a'+_0x518b08(0xf3)+_0x518b08(0x1c6);await this['bot']?.[_0x518b08(0x180)](_0x356000,_0x4c1e6f,{'parse_mode':'Markdown'});return;}if(_0x4d6137[_0x518b08(0x17a)]!==_0x518b08(0x19e)){await this[_0x518b08(0x1b9)]?.[_0x518b08(0x180)](_0x356000,_0x518b08(0x15b)+_0xa916c2+_0x518b08(0x112)+_0x518b08(0x111),{'parse_mode':_0x518b08(0x1ce)});return;}if(_0x4d6137[_0x518b08(0x126)]!==_0x59e15b&&_0x4d6137[_0x518b08(0x17c)]!==_0x59e15b){await this['bot']?.[_0x518b08(0x180)](_0x356000,_0x518b08(0x18c)+_0xa916c2+_0x518b08(0x1a1)+_0x518b08(0x1a2)+_0x518b08(0x196),{'parse_mode':'Markdown'});return;}const _0x40e6a5=await database_1[_0x518b08(0x12a)]['telegramUser'][_0x518b08(0x106)]({'where':{'shopId':_0x4d6137['id'],'isVerified':!![],'telegramId':{'not':_0x47195d}}});if(_0x40e6a5){await this[_0x518b08(0x1b9)]?.['sendMessage'](_0x356000,_0x518b08(0x133)+_0xa916c2+_0x518b08(0x1a1)+_0x518b08(0x198),{'parse_mode':'Markdown'});return;}await database_1[_0x518b08(0x12a)][_0x518b08(0x159)]['update']({'where':{'telegramId':_0x47195d},'data':{'shopId':_0x4d6137['id'],'isVerified':!![]}}),await this[_0x518b08(0x1b9)]?.[_0x518b08(0x180)](_0x356000,_0x518b08(0xfd)+_0x518b08(0x10c)+(_0x518b08(0x136)+_0x4d6137['name']+'*\x0a')+(_0x518b08(0x171)+_0x4d6137['username']+_0x518b08(0x1d7))+_0x518b08(0x144)+'â€¢\x20New\x20payments\x0a'+_0x518b08(0x150)+_0x518b08(0x13f)+_0x518b08(0x17b)+_0x518b08(0x11c)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x518b08(0xfb),{'parse_mode':_0x518b08(0x1ce)}),console[_0x518b08(0x18a)]('âœ…\x20Telegram\x20user\x20'+_0x47195d+'\x20verified\x20for\x20shop\x20'+_0x4d6137[_0x518b08(0x1aa)]+'\x20via\x20single-line\x20input');}catch(_0x592b1b){console[_0x518b08(0x189)](_0x518b08(0x147),_0x592b1b),await this[_0x518b08(0x1b9)]?.['sendMessage'](_0x356000,_0x518b08(0x149));}}async[a78_0x50b926(0x18b)](_0x49c884,_0x2e03d3,_0x4f681e){const _0x5bc3d2=a78_0x50b926;if(!this[_0x5bc3d2(0x1b9)]){console[_0x5bc3d2(0x184)](_0x5bc3d2(0x154));return;}try{const _0x2e3432=await database_1[_0x5bc3d2(0x12a)][_0x5bc3d2(0x159)][_0x5bc3d2(0x143)]({'where':{'shopId':_0x49c884,'isVerified':!![]}});if(_0x2e3432[_0x5bc3d2(0xdd)]===0x0){console[_0x5bc3d2(0x18a)](_0x5bc3d2(0x157)+_0x49c884);return;}const _0x3531ae=_0x2e3432[_0x5bc3d2(0x158)](async _0x4cb6a8=>{const _0x49536c=_0x5bc3d2;try{await this['bot']?.[_0x49536c(0x180)](_0x4cb6a8[_0x49536c(0x1b3)],_0x2e03d3,_0x4f681e),console['log'](_0x49536c(0xea)+_0x4cb6a8[_0x49536c(0x1b3)]);}catch(_0x2aa45c){console[_0x49536c(0x189)](_0x49536c(0x1be)+_0x4cb6a8['telegramId']+':',_0x2aa45c),_0x2aa45c instanceof Error&&(_0x2aa45c[_0x49536c(0x1c9)][_0x49536c(0x11b)](_0x49536c(0x160))||_0x2aa45c[_0x49536c(0x1c9)][_0x49536c(0x11b)]('chat\x20not\x20found')||_0x2aa45c[_0x49536c(0x1c9)][_0x49536c(0x11b)](_0x49536c(0x1bd)))&&(await database_1['default'][_0x49536c(0x159)][_0x49536c(0xf4)]({'where':{'id':_0x4cb6a8['id']},'data':{'isVerified':![]}}),console['log'](_0x49536c(0x12b)+_0x4cb6a8[_0x49536c(0x1b3)]+_0x49536c(0x114)));}});await Promise[_0x5bc3d2(0xdf)](_0x3531ae);}catch(_0x56c8c9){console[_0x5bc3d2(0x189)]('Error\x20sending\x20shop\x20notification:',_0x56c8c9);}}async['sendPaymentNotification'](_0xc78272,_0x25b980,_0x13b9bf){const _0x27ce70=a78_0x50b926,_0x1fca9c={'created':'ğŸ†•','paid':'âœ…','failed':'âŒ','expired':'â°','refund':'ğŸ”„','chargeback':'âš ï¸','processing':'âš™ï¸'},_0xcdae02={'created':_0x27ce70(0x10b),'paid':_0x27ce70(0x138),'failed':'Payment\x20failed','expired':'Payment\x20expired','refund':_0x27ce70(0x19a),'chargeback':_0x27ce70(0x117),'processing':'Payment\x20is\x20being\x20processed'},_0x43408c=_0x1fca9c[_0x13b9bf],_0x474800=_0xcdae02[_0x13b9bf],_0xe0f004=(0x0,gateway_1[_0x27ce70(0xe8)])(_0x25b980[_0x27ce70(0x185)]);console[_0x27ce70(0x18a)](_0x27ce70(0x175)+_0x25b980[_0x27ce70(0x185)]+_0x27ce70(0x1b0)+_0xe0f004+'\x22');let _0x3687ba=_0x43408c+'\x20*'+_0x474800+_0x27ce70(0x1b5)+('ğŸ’°\x20Amount:\x20*'+_0x25b980[_0x27ce70(0x16a)]+'\x20'+_0x25b980[_0x27ce70(0x1d6)]+'*\x0a')+(_0x27ce70(0x176)+(_0x25b980[_0x27ce70(0xde)]||_0x25b980['id'])+'`\x0a')+('ğŸ†”\x20Payment\x20ID:\x20`'+_0x25b980['id']+'`\x0a')+(_0x27ce70(0x12d)+_0xe0f004+'`\x0a')+(_0x27ce70(0x137)+new Date(_0x25b980[_0x27ce70(0x1d1)])['toLocaleString'](_0x27ce70(0x188))+'\x0a');if(_0x25b980[_0x27ce70(0x15e)]||_0x25b980[_0x27ce70(0xed)]||_0x25b980[_0x27ce70(0x1d2)]||_0x25b980[_0x27ce70(0x1a6)]||_0x25b980[_0x27ce70(0xe0)]){_0x3687ba+='\x0ağŸ‘¤\x20*Customer\x20Information:*\x0a';_0x25b980[_0x27ce70(0x15e)]&&(_0x3687ba+=_0x27ce70(0x1ad)+_0x25b980[_0x27ce70(0x15e)]+'`\x0a');_0x25b980[_0x27ce70(0xed)]&&(_0x3687ba+=_0x27ce70(0x1cc)+_0x25b980[_0x27ce70(0xed)]+'`\x0a');_0x25b980[_0x27ce70(0x1d2)]&&(_0x3687ba+=_0x27ce70(0x142)+_0x25b980[_0x27ce70(0x1d2)]+'`\x0a');_0x25b980[_0x27ce70(0x1a6)]&&(_0x3687ba+='ğŸŒ\x20IP:\x20`'+_0x25b980[_0x27ce70(0x1a6)]+'`\x0a');if(_0x25b980[_0x27ce70(0xe0)]){const _0x5c8d98=_0x25b980[_0x27ce70(0xe0)]['length']>0x32?_0x25b980[_0x27ce70(0xe0)][_0x27ce70(0x115)](0x0,0x32)+'...':_0x25b980['customerUa'];_0x3687ba+=_0x27ce70(0x181)+_0x5c8d98+'`\x0a';}}_0x13b9bf==='chargeback'&&_0x25b980['chargebackAmount']&&(_0x3687ba+=_0x27ce70(0xe9)+_0x25b980[_0x27ce70(0x192)]+'\x20USDT*\x0a'),_0x13b9bf==='processing'&&(_0x3687ba+=_0x27ce70(0x123)),_0x25b980[_0x27ce70(0x179)]&&(_0x3687ba+='ğŸ“\x20Notes:\x20'+_0x25b980[_0x27ce70(0x179)]+'\x0a'),await this[_0x27ce70(0x18b)](_0xc78272,_0x3687ba,{'parse_mode':'Markdown'});}async[a78_0x50b926(0x102)](_0x23adcc,_0x524750){const _0x2fb1c0=a78_0x50b926,_0x47c328=new Date(_0x524750[_0x2fb1c0(0x1d1)])[_0x2fb1c0(0x1c5)](_0x2fb1c0(0x188),{'year':'numeric','month':_0x2fb1c0(0x187),'day':_0x2fb1c0(0x187),'hour':_0x2fb1c0(0x187),'minute':'2-digit','second':_0x2fb1c0(0x187)}),_0x49b0d6='ğŸ’¸\x20*New\x20Payout*\x0a\x0a'+(_0x2fb1c0(0x118)+_0x47c328+'\x0a')+('ğŸ’°\x20*Amount:*\x20'+_0x524750[_0x2fb1c0(0x16a)]+_0x2fb1c0(0x165))+('â±ï¸\x20*Period:*\x20'+(_0x524750['period']||_0x2fb1c0(0x19c))+'\x0a')+(_0x2fb1c0(0x177)+(_0x524750['network']||_0x2fb1c0(0x19c))+'\x0a')+(_0x2fb1c0(0x15d)+(_0x524750[_0x2fb1c0(0x11d)]||_0x2fb1c0(0x19c))+'`\x0a')+(_0x524750[_0x2fb1c0(0x122)]?_0x2fb1c0(0x156)+_0x524750[_0x2fb1c0(0x122)]+'`':'ğŸ”—\x20*Transaction\x20Link:*\x20Pending');await this[_0x2fb1c0(0x18b)](_0x23adcc,_0x49b0d6,{'parse_mode':_0x2fb1c0(0x1ce)});}async[a78_0x50b926(0x190)](_0x1755ff,_0x5e232a){const _0x47c04d=a78_0x50b926;try{const _0x4bc598=await database_1[_0x47c04d(0x12a)][_0x47c04d(0x15c)][_0x47c04d(0x14b)]({'where':{'shopId':_0x1755ff},'select':{'notificationLogin':!![]}});if(!_0x4bc598?.[_0x47c04d(0x191)]){console['log'](_0x47c04d(0x19f)+_0x1755ff);return;}const _0x1455d7=_0x5e232a[_0x47c04d(0x17f)]?'ğŸ”':'ğŸš¨',_0x3be1de=_0x5e232a[_0x47c04d(0x17f)]?'Successful\x20login':_0x47c04d(0x134);let _0x4c90c1=_0x1455d7+'\x20*'+_0x3be1de+_0x47c04d(0x1b5)+('ğŸ‘¤\x20Username:\x20`'+_0x5e232a[_0x47c04d(0x1aa)]+'`\x0a')+(_0x47c04d(0x109)+_0x5e232a['timestamp'][_0x47c04d(0x1c5)](_0x47c04d(0x188))+'\x0a');_0x5e232a['ipAddress']&&(_0x4c90c1+='ğŸŒ\x20IP\x20address:\x20`'+_0x5e232a[_0x47c04d(0xee)]+'`\x0a');_0x5e232a['geo']&&(_0x4c90c1+=_0x47c04d(0x1c3)+_0x5e232a[_0x47c04d(0x124)]+'\x0a');if(_0x5e232a[_0x47c04d(0x166)]){const _0x17c2d6=_0x5e232a['userAgent']['length']>0x32?_0x5e232a[_0x47c04d(0x166)][_0x47c04d(0x115)](0x0,0x32)+_0x47c04d(0x168):_0x5e232a[_0x47c04d(0x166)];_0x4c90c1+=_0x47c04d(0x181)+_0x17c2d6+'`\x0a';}!_0x5e232a[_0x47c04d(0x17f)]&&(_0x4c90c1+=_0x47c04d(0x16f)),await this['sendShopNotification'](_0x1755ff,_0x4c90c1,{'parse_mode':'Markdown'}),console[_0x47c04d(0x18a)]('âœ…\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x1755ff+':\x20'+(_0x5e232a[_0x47c04d(0x17f)]?'success':_0x47c04d(0x13d)));}catch(_0xd898fa){console[_0x47c04d(0x189)](_0x47c04d(0x1b4),_0xd898fa);}}async[a78_0x50b926(0x15f)](_0x128278,_0x3855d2){const _0x5c93b7=a78_0x50b926;try{const _0x518f14=await database_1[_0x5c93b7(0x12a)][_0x5c93b7(0x15c)]['findUnique']({'where':{'shopId':_0x128278},'select':{'notificationApiError':!![]}});if(!_0x518f14?.[_0x5c93b7(0x1c1)]){console['log'](_0x5c93b7(0x153)+_0x128278);return;}let _0x5c819f=_0x5c93b7(0x174)+('ğŸ”—\x20Endpoint:\x20`'+_0x3855d2[_0x5c93b7(0xf5)]+'\x20'+_0x3855d2['endpoint']+'`\x0a')+(_0x5c93b7(0x109)+_0x3855d2['timestamp']['toLocaleString'](_0x5c93b7(0x188))+'\x0a');_0x3855d2['statusCode']&&(_0x5c819f+=_0x5c93b7(0xe1)+_0x3855d2[_0x5c93b7(0x199)]+'`\x0a'),_0x5c819f+=_0x5c93b7(0x161)+_0x3855d2[_0x5c93b7(0x1c0)]+'`\x0a',_0x3855d2['requestId']&&(_0x5c819f+=_0x5c93b7(0x14a)+_0x3855d2[_0x5c93b7(0x19d)]+'`\x0a'),_0x5c819f+='\x0ağŸ’¡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this['sendShopNotification'](_0x128278,_0x5c819f,{'parse_mode':_0x5c93b7(0x1ce)}),console['log'](_0x5c93b7(0x1ca)+_0x128278+':\x20'+_0x3855d2['endpoint']);}catch(_0x2c25e7){console[_0x5c93b7(0x189)](_0x5c93b7(0x104),_0x2c25e7);}}async[a78_0x50b926(0x1bb)](_0x37d89f,_0x5de1a6,_0x361a48){const _0x2773ea=a78_0x50b926;let _0x51693f='ğŸ””\x20*'+_0x5de1a6+_0x2773ea(0x1b5);for(const [_0x2660e6,_0x2d9f2d]of Object[_0x2773ea(0x182)](_0x361a48)){_0x2d9f2d!==null&&_0x2d9f2d!==undefined&&(_0x51693f+=_0x2660e6+_0x2773ea(0x125)+_0x2d9f2d+'`\x0a');}await this[_0x2773ea(0x18b)](_0x37d89f,_0x51693f,{'parse_mode':'Markdown'});}async[a78_0x50b926(0x18d)](_0x54e8dc){const _0x42de97=a78_0x50b926;try{console[_0x42de97(0x18a)]('ğŸ“±\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20'+_0x54e8dc[_0x42de97(0x115)](0x0,0x32)+_0x42de97(0x168));const _0x5ddac7=await database_1['default'][_0x42de97(0x159)][_0x42de97(0x143)]({'select':{'telegramId':!![]}});if(_0x5ddac7[_0x42de97(0xdd)]===0x0){console[_0x42de97(0x18a)](_0x42de97(0x1ac));return;}for(const _0x13ed80 of _0x5ddac7){try{await this['bot']?.['sendMessage'](_0x13ed80[_0x42de97(0x1b3)],_0x54e8dc,{'parse_mode':'Markdown'});}catch(_0x20a05e){console[_0x42de97(0x189)](_0x42de97(0x173)+_0x13ed80[_0x42de97(0x1b3)]+':',_0x20a05e);}}console[_0x42de97(0x18a)](_0x42de97(0x167)+_0x5ddac7[_0x42de97(0xdd)]+_0x42de97(0x1a9));}catch(_0x4acf44){console['error'](_0x42de97(0x1c7),_0x4acf44);}}[a78_0x50b926(0x146)](){return{'isActive':!!this['bot'],'username':this['botUsername']};}async[a78_0x50b926(0x103)](_0x217a78,_0x4d9b05,_0x57355a,_0x450c66){const _0x77a65=a78_0x50b926;try{if(!this[_0x77a65(0x1b9)])return console[_0x77a65(0x189)](_0x77a65(0x1b1)),![];const _0x2b7f2b=await database_1[_0x77a65(0x12a)][_0x77a65(0x159)][_0x77a65(0x143)]({'where':{'shopId':_0x217a78,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x2b7f2b[_0x77a65(0xdd)]===0x0)return console[_0x77a65(0x189)](_0x77a65(0x101)+_0x217a78),![];let _0x125890=0x0;for(const _0x2f6823 of _0x2b7f2b){try{await this['bot'][_0x77a65(0x11a)](_0x2f6823['telegramId'],_0x4d9b05,{},{'filename':_0x57355a,'contentType':_0x57355a[_0x77a65(0x129)](_0x77a65(0xf0))?_0x77a65(0x1d4):_0x57355a['endsWith'](_0x77a65(0x195))||_0x57355a[_0x77a65(0x129)](_0x77a65(0x16d))?_0x77a65(0x145):_0x57355a[_0x77a65(0x129)](_0x77a65(0x1ae))?_0x77a65(0x10e):_0x77a65(0x1bc)}),_0x450c66&&await this[_0x77a65(0x1b9)][_0x77a65(0x180)](_0x2f6823[_0x77a65(0x1b3)],_0x450c66),_0x125890++;}catch(_0x2970b6){console['error']('âŒ\x20Error\x20sending\x20file\x20to\x20user\x20'+_0x2f6823[_0x77a65(0x1b3)]+':',_0x2970b6);}}return console[_0x77a65(0x18a)](_0x77a65(0x12f)+_0x125890+'/'+_0x2b7f2b['length']+_0x77a65(0x130)+_0x217a78+':\x20'+_0x57355a),_0x125890>0x0;}catch(_0xbd532e){return console[_0x77a65(0x189)](_0x77a65(0xf8),_0xbd532e),![];}}async[a78_0x50b926(0x1a8)](_0xa4f4f6,_0x606877){const _0x3efbb8=a78_0x50b926;try{if(!this[_0x3efbb8(0x1b9)])return console['error']('âŒ\x20Telegram\x20bot\x20not\x20initialized'),![];return await this['bot'][_0x3efbb8(0x180)](_0xa4f4f6,_0x606877),console[_0x3efbb8(0x18a)]('âœ…\x20Direct\x20message\x20sent\x20to\x20chat\x20'+_0xa4f4f6),!![];}catch(_0x3fe0da){return console[_0x3efbb8(0x189)](_0x3efbb8(0x13e),_0x3fe0da),![];}}async[a78_0x50b926(0xe4)](_0x14f3eb,_0x1fb35a,_0x57d382,_0x151fb6){const _0x99f74b=a78_0x50b926;try{if(!this[_0x99f74b(0x1b9)])return console[_0x99f74b(0x189)](_0x99f74b(0x1b1)),![];return await this[_0x99f74b(0x1b9)][_0x99f74b(0x11a)](_0x14f3eb,_0x1fb35a,{},{'filename':_0x57d382,'contentType':_0x57d382['endsWith']('.png')?_0x99f74b(0x1d4):_0x57d382[_0x99f74b(0x129)]('.jpg')||_0x57d382[_0x99f74b(0x129)](_0x99f74b(0x16d))?_0x99f74b(0x145):_0x57d382[_0x99f74b(0x129)]('.pdf')?_0x99f74b(0x10e):_0x99f74b(0x1bc)}),_0x151fb6&&await this[_0x99f74b(0x1b9)][_0x99f74b(0x180)](_0x14f3eb,_0x151fb6),console[_0x99f74b(0x18a)](_0x99f74b(0xfc)+_0x14f3eb+':\x20'+_0x57d382),!![];}catch(_0x35ebe3){return console[_0x99f74b(0x189)](_0x99f74b(0x1c2),_0x35ebe3),![];}}['stopBot'](){const _0x2a8334=a78_0x50b926;this[_0x2a8334(0x1b9)]&&(this[_0x2a8334(0x1b9)][_0x2a8334(0x1b7)](),this[_0x2a8334(0x1b9)]=null,console[_0x2a8334(0x18a)](_0x2a8334(0x1cd)));}}exports[a78_0x50b926(0x140)]=TelegramBotService,exports[a78_0x50b926(0xff)]=new TelegramBotService();function a78_0x3a9c(){const _0x2e230b=['__importDefault','ğŸª\x20Your\x20connected\x20shop:\x0a','/status\x20-\x20check\x20connection\x20status\x0a','botUsername','txid','â³\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','geo',':\x20`','publicKey','shopId','botToken','endsWith','default','User\x20','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','ğŸª\x20Gateway:\x20`','âŒ\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','âœ…\x20File\x20sent\x20to\x20','\x20users\x20of\x20shop\x20','__esModule','Error\x20handling\x20/disconnect\x20command:','âŒ\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','Failed\x20login\x20attempt','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','ğŸ“±\x20Shop:\x20*','ğŸ“…\x20Date:\x20','Payment\x20successfully\x20paid','sk_','110730gopMpa','Error\x20handling\x20/start\x20command:','onText','failed','âŒ\x20Error\x20sending\x20direct\x20message:','â€¢\x20Payouts\x0a','TelegramBotService',':\x20username=\x22','ğŸ¦\x20IBAN:\x20`','findMany','ğŸ””\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','image/jpeg','getBotInfo','Error\x20in\x20handleSingleLineVerification:','ğŸ”„\x20Processing\x20single-line\x20verification\x20for\x20user\x20','âŒ\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','ğŸ†”\x20Request\x20ID:\x20`','findUnique','toString','shop','first_name','4278789GkidHJ','â€¢\x20Payment\x20status\x20changes\x0a','âŒ\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','name','ğŸ“±\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','âœ…\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','ğŸ”—\x20*Transaction\x20Link:*\x20`','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','map','telegramUser','ğŸ”Œ\x20User\x20','âŒ\x20Shop\x20`','shopSettings','ğŸ’³\x20*Wallet:*\x20`','customerName','sendApiErrorNotification','blocked','âŒ\x20Error:\x20`','âŒ\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','âŒ\x20Shop\x20with\x20username\x20`','âŒ\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','\x20USD\x0a','userAgent','ğŸ“±\x20Notification\x20sent\x20to\x20','...','â€¢\x20Payouts\x0a\x0a','amount','setupBotHandlers','trapay_bot','.jpeg','â—ï¸\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','\x0aâš ï¸\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','polling_error','ğŸ‘¤\x20Username:\x20`','Telegram\x20bot\x20error:','âŒ\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','ğŸš¨\x20*API\x20Error*\x0a\x0a','ğŸ“±\x20Telegram\x20notification:\x20gateway\x20\x22','ğŸ“\x20Order\x20ID:\x20`','ğŸŒ\x20*Network:*\x20','split','adminNotes','status','â€¢\x20Important\x20events\x0a\x0a','secretKey','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','42OPddFo','success','sendMessage','ğŸ’»\x20Browser:\x20`','entries','\x20\x20\x20Status:\x20','warn','gateway','last_name','2-digit','en-US','error','log','sendShopNotification','âŒ\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','sendNotificationToAll','updatedAt','âŒ\x20Invalid\x20API\x20key\x20format.\x0a\x0a','sendLoginNotification','notificationLogin','chargebackAmount','defineProperty','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','.jpg','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','1853145layAhS','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','statusCode','Payment\x20refund','chat','Not\x20specified','requestId','ACTIVE','ğŸ“±\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','You\x20sent\x20','`.\x0a\x0a','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','ğŸ””\x20You\x20receive\x20notifications\x20about:\x0a','from','TELEGRAM_BOT_TOKEN','customerIp','Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.','sendDirectMessage','\x20users','username','test','ğŸ“±\x20No\x20active\x20Telegram\x20users\x20found','ğŸ“›\x20Name:\x20`','.pdf','ğŸ“±\x20Your\x20Telegram\x20ID:\x20`','\x22\x20->\x20display\x20\x22','âŒ\x20Telegram\x20bot\x20not\x20initialized','70CaxuBf','telegramId','Failed\x20to\x20send\x20login\x20notification:','*\x0a\x0a','1194752TPyeJu','stopPolling','ğŸ”\x20*Debug\x20Information*\x0a\x0a','bot','...\x22','sendCustomNotification','application/octet-stream','user\x20is\x20deactivated','âŒ\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','Error\x20handling\x20message:','errorMessage','notificationApiError','âŒ\x20Error\x20sending\x20file\x20to\x20chat:','ğŸŒ\x20Country:\x20','1595024SHvCVo','toLocaleString','Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.','âŒ\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','ğŸ”„\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','message','âœ…\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','âŒ\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a','ğŸ“§\x20Email:\x20`','ğŸ›‘\x20Telegram\x20bot\x20stopped','Markdown','248pOXtnY','â€¢\x20New\x20payments\x0a','createdAt','remitterIban','âŒ\x20Please\x20use\x20/start\x20command\x20first','image/png','âœ…\x20Connected\x20to\x20shop:\x20*','currency','`\x0a\x0a','length','orderId','allSettled','customerUa','ğŸ“Š\x20Error\x20code:\x20`','3184605jijukK','\x20disconnected\x20from\x20shop\x20','sendDirectFile','isVerified','unknown\x20shop','ğŸ“\x20Format:\x20`username\x20api_key`\x0a\x0a','getGatewayDisplayNameForTelegram','ğŸ’¸\x20Penalty\x20amount:\x20*','âœ…\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','startsWith','customerEmail','ipAddress','join','.png','\x20\x20\x20Name:\x20*','node-telegram-bot-api','Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a','update','method','text','âŒ\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','âŒ\x20Error\x20sending\x20file\x20to\x20shop:','11025528XMZHKO','../config/database','/disconnect\x20-\x20disconnect\x20from\x20notifications','âœ…\x20File\x20sent\x20to\x20chat\x20','ğŸ‰\x20*Congratulations!*\x0a\x0a','handleSingleLineVerification','telegramBotService','ğŸ“Š\x20*Connection\x20Status*\x0a\x0a','âŒ\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','sendPayoutNotification','sendShopFile','Failed\x20to\x20send\x20API\x20error\x20notification:','âŒ\x20Error\x20getting\x20debug\x20information.','findFirst','Telegram\x20bot\x20polling\x20error:','env','ğŸ“…\x20Time:\x20','trim','New\x20payment\x20created','âœ…\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','../types/gateway','application/pdf','\x22,\x20apiKey=\x22','toLocaleDateString','Contact\x20administrator.','`\x20is\x20inactive.\x0a\x0a','\x20\x20\x20Username:\x20`','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','substring','âœ…\x20Telegram\x20bot\x20@','Payment\x20chargeback','ğŸ“…\x20*Payout\x20Date:*\x20','initializeBot','sendDocument','includes','Commands:\x0a','wallet'];a78_0x3a9c=function(){return _0x2e230b;};return a78_0x3a9c();}