'use strict';const a54_0x339b56=a54_0x4d5f;(function(_0x2ae564,_0x3657d3){const _0x1e31f5=a54_0x4d5f,_0x2c13cd=_0x2ae564();while(!![]){try{const _0x309407=-parseInt(_0x1e31f5(0x155))/0x1+parseInt(_0x1e31f5(0x1ae))/0x2*(-parseInt(_0x1e31f5(0x1d9))/0x3)+-parseInt(_0x1e31f5(0x119))/0x4+-parseInt(_0x1e31f5(0x19e))/0x5*(-parseInt(_0x1e31f5(0x1d0))/0x6)+-parseInt(_0x1e31f5(0x134))/0x7+parseInt(_0x1e31f5(0x15c))/0x8+-parseInt(_0x1e31f5(0x11d))/0x9*(-parseInt(_0x1e31f5(0x1b2))/0xa);if(_0x309407===_0x3657d3)break;else _0x2c13cd['push'](_0x2c13cd['shift']());}catch(_0x5d92c1){_0x2c13cd['push'](_0x2c13cd['shift']());}}}(a54_0x70e2,0xc89cb));function a54_0x4d5f(_0x54481a,_0x1f4e3a){const _0x70e275=a54_0x70e2();return a54_0x4d5f=function(_0x4d5f14,_0x52719a){_0x4d5f14=_0x4d5f14-0xf8;let _0xa3e71b=_0x70e275[_0x4d5f14];return _0xa3e71b;},a54_0x4d5f(_0x54481a,_0x1f4e3a);}function a54_0x70e2(){const _0x7a8df2=['•\x20Payment\x20status\x20changes\x0a','telegramUser','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','warn','💸\x20Penalty\x20amount:\x20*','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','userAgent','publicKey','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','2sSKjKV','Payment\x20chargeback','👤\x20Username:\x20`','chargebackAmount','48171140OUtTah','notificationLogin','📧\x20Email:\x20`','📅\x20Connection\x20date:\x20','createdAt','🔗\x20Endpoint:\x20`','🔔\x20*','📝\x20Notes:\x20','📅\x20Time:\x20','botUsername','user\x20is\x20deactivated','📝\x20Order\x20ID:\x20`','\x20initialized\x20successfully','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','💻\x20Browser:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','orderId','Failed\x20to\x20send\x20API\x20error\x20notification:','Available\x20usernames:\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','🌐\x20IP:\x20`','🔔\x20Notifications\x20are\x20active\x0a\x0a','botToken','•\x20`','Failed\x20to\x20send\x20login\x20notification:','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','.\x20*','onText','trapay_bot','New\x20payment\x20created','18246QTxnyI','amount','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','`\x20is\x20inactive.\x0a\x0a','\x20verified\x20for\x20shop\x20','handleSingleLineVerification','forEach','ipAddress','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','3437949vanHiQ','customerEmail','`\x0a\x0a','map','\x0aCheck\x20spelling\x20and\x20try\x20again.','toLocaleDateString','•\x20Important\x20events\x0a\x0a','`\x20(','sendPaymentNotification','Username:\x20`','`\x20not\x20found.\x0a\x0a','length','...\x22','stopPolling','sendMessage','Telegram\x20bot\x20error:','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','📊\x20Error\x20code:\x20`','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','processing','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','•\x20New\x20payments\x0a','*.\x0a\x0a','TELEGRAM_BOT_TOKEN','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','split','\x20\x20\x20Public\x20Key:\x20`','Payment\x20is\x20being\x20processed','TelegramBotService','chat','__esModule','last_name','substring','\x0a👤\x20*Customer\x20Information:*\x0a','5114280gLTKHS','Payment\x20successfully\x20paid','🔌\x20User\x20','•\x20Payouts\x0a\x0a','9JQgBYd','🌐\x20IP\x20address:\x20`','customerIp',':\x20username=\x22','🆔\x20Payout\x20ID:\x20`',':\x20`','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','isVerified','/disconnect\x20-\x20disconnect\x20from\x20notifications','Contact\x20administrator.','customerName','default','initializeBot','New\x20payout\x20created','polling_error','toLocaleString','✅\x20Connected\x20to\x20shop:\x20*','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','timestamp','pk_','txid','❌\x20Invalid\x20username\x20format:\x20`','📱\x20Your\x20Telegram\x20ID:\x20`','7549409fIHRds','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','💰\x20Amount:\x20*','sendApiErrorNotification','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','🆔\x20Request\x20ID:\x20`','ACTIVE','update','Payout\x20completed','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','bot','create','setupBotHandlers','sendShopNotification','notificationApiError','❌\x20Error:\x20`','en-US','username','defineProperty','entries','chat\x20not\x20found','❌\x20Shop\x20with\x20username\x20`','allSettled','env','🎉\x20*Congratulations!*\x0a\x0a','Check\x20spelling\x20and\x20try\x20again.','toString','findUnique','\x20USD*\x0a','You\x20sent\x20','status','Use\x20/start\x20to\x20begin.','Commands:\x0a','1593782vtcDoC','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','💸\x20Amount:\x20*','User\x20','requestId','gateway','...','7862528ZFdLJR','Failed\x20login\x20attempt','📅\x20Date:\x20','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','telegramBotService','📱\x20Created\x20new\x20Telegram\x20user:\x20','shopId','from','statusCode','...`\x0a\x0a','customerUa','shopSettings','❌\x20Shop\x20`','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','🔗\x20TXID:\x20`','telegramId','Error\x20handling\x20message:','message','trim','Error\x20handling\x20/debug\x20command:','getGatewayDisplayNameForTelegram','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','sendPayoutNotification','•\x20Payouts\x0a','sendCustomNotification','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','`.\x0a\x0a','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','\x20\x20\x20Username:\x20`','log','Error\x20handling\x20/disconnect\x20command:','\x20(@','\x20USDT*\x0a','name','📛\x20Name:\x20`','Error\x20handling\x20/status\x20command:','Telegram\x20bot\x20polling\x20error:','Example:\x0a','updatedAt','secretKey','includes','remitterIban','success','startsWith','\x20parts:\x20','Payment\x20refund','📊\x20*Connection\x20Status*\x0a\x0a','\x22,\x20apiKey=\x22','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','unknown\x20shop','TELEGRAM_BOT_USERNAME','getBotInfo','adminNotes','failed','/status\x20-\x20check\x20connection\x20status\x0a','shop','🛑\x20Telegram\x20bot\x20stopped','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','🏦\x20IBAN:\x20`','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','../config/database','currency','📱\x20Telegram\x20notification:\x20gateway\x20\x22','error','195eMlLyu','findMany','Markdown','🔔\x20You\x20receive\x20notifications\x20about:\x0a','🏪\x20Available\x20shops\x20in\x20system:\x0a','Successful\x20login','📱\x20Shop:\x20*'];a54_0x70e2=function(){return _0x7a8df2;};return a54_0x70e2();}var __importDefault=this&&this['__importDefault']||function(_0x55e326){return _0x55e326&&_0x55e326['__esModule']?_0x55e326:{'default':_0x55e326};};Object[a54_0x339b56(0x146)](exports,a54_0x339b56(0x115),{'value':!![]}),exports[a54_0x339b56(0x161)]=exports[a54_0x339b56(0x113)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a54_0x339b56(0x19a))),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x86dd49=a54_0x339b56;this[_0x86dd49(0x13e)]=null,this[_0x86dd49(0x1c8)]=process[_0x86dd49(0x14b)][_0x86dd49(0x10d)]||'',this['botUsername']=process['env'][_0x86dd49(0x18f)]||_0x86dd49(0x1ce),this[_0x86dd49(0x1c8)]?this[_0x86dd49(0x129)]():console[_0x86dd49(0x1a8)](_0x86dd49(0x176));}[a54_0x339b56(0x129)](){const _0x3b63ca=a54_0x339b56;try{this['bot']=new node_telegram_bot_api_1[(_0x3b63ca(0x128))](this[_0x3b63ca(0x1c8)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x3b63ca(0x17a)]('✅\x20Telegram\x20bot\x20@'+this[_0x3b63ca(0x1bb)]+_0x3b63ca(0x1be));}catch(_0x17ffb3){console[_0x3b63ca(0x19d)](_0x3b63ca(0x15f),_0x17ffb3);}}[a54_0x339b56(0x140)](){const _0x104a74=a54_0x339b56;if(!this['bot'])return;this['bot']['onText'](/\/start/,async _0x5ed171=>{const _0x1d24f2=a54_0x4d5f,_0x5b9126=_0x5ed171[_0x1d24f2(0x114)]['id'],_0x436022=_0x5ed171['from']?.['id']['toString'](),_0x416b14=_0x5ed171[_0x1d24f2(0x164)]?.[_0x1d24f2(0x145)],_0x29865c=_0x5ed171[_0x1d24f2(0x164)]?.['first_name'],_0x3b5b3d=_0x5ed171['from']?.[_0x1d24f2(0x116)];if(!_0x436022)return;try{let _0x59fb1e=await database_1[_0x1d24f2(0x128)]['telegramUser'][_0x1d24f2(0x14f)]({'where':{'telegramId':_0x436022},'include':{'shop':!![]}});!_0x59fb1e?(_0x59fb1e=await database_1['default'][_0x1d24f2(0x1a6)][_0x1d24f2(0x13f)]({'data':{'telegramId':_0x436022,'username':_0x416b14,'firstName':_0x29865c,'lastName':_0x3b5b3d,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x1d24f2(0x162)+_0x436022+_0x1d24f2(0x17c)+_0x416b14+')')):_0x59fb1e=await database_1[_0x1d24f2(0x128)][_0x1d24f2(0x1a6)]['update']({'where':{'telegramId':_0x436022},'data':{'username':_0x416b14,'firstName':_0x29865c,'lastName':_0x3b5b3d},'include':{'shop':!![]}}),_0x59fb1e[_0x1d24f2(0x124)]&&_0x59fb1e[_0x1d24f2(0x163)]&&_0x59fb1e['shop']?await this[_0x1d24f2(0x13e)]?.[_0x1d24f2(0x104)](_0x5b9126,'✅\x20Welcome\x20back!\x0a\x0a'+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x59fb1e[_0x1d24f2(0x194)]['name']+'*\x0a')+(_0x1d24f2(0xff)+_0x59fb1e[_0x1d24f2(0x194)][_0x1d24f2(0x145)]+_0x1d24f2(0xf8))+_0x1d24f2(0x1a1)+'•\x20New\x20payments\x0a'+_0x1d24f2(0x1a5)+_0x1d24f2(0x11c)+_0x1d24f2(0x154)+_0x1d24f2(0x193)+_0x1d24f2(0x125),{'parse_mode':_0x1d24f2(0x1a0)}):(_0x59fb1e[_0x1d24f2(0x163)]&&!_0x59fb1e['isVerified']&&(await database_1[_0x1d24f2(0x128)][_0x1d24f2(0x1a6)][_0x1d24f2(0x13b)]({'where':{'telegramId':_0x436022},'data':{'shopId':null,'isVerified':![]}}),console[_0x1d24f2(0x17a)](_0x1d24f2(0x106)+_0x436022)),await this[_0x1d24f2(0x13e)]?.[_0x1d24f2(0x104)](_0x5b9126,_0x1d24f2(0x1cb)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x1d24f2(0x182)+_0x1d24f2(0x10f)+_0x1d24f2(0x1aa),{'parse_mode':_0x1d24f2(0x1a0)}));}catch(_0x10502e){console[_0x1d24f2(0x19d)]('Error\x20handling\x20/start\x20command:',_0x10502e),await this[_0x1d24f2(0x13e)]?.[_0x1d24f2(0x104)](_0x5b9126,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x104a74(0x13e)]['onText'](/\/disconnect/,async _0x146ff4=>{const _0x77e7d7=_0x104a74,_0x24fbd6=_0x146ff4[_0x77e7d7(0x114)]['id'],_0x39d446=_0x146ff4[_0x77e7d7(0x164)]?.['id'][_0x77e7d7(0x14e)]();if(!_0x39d446)return;try{const _0x4728d3=await database_1[_0x77e7d7(0x128)][_0x77e7d7(0x1a6)][_0x77e7d7(0x14f)]({'where':{'telegramId':_0x39d446},'include':{'shop':!![]}});if(!_0x4728d3||!_0x4728d3[_0x77e7d7(0x124)]||!_0x4728d3['shopId']){await this['bot']?.[_0x77e7d7(0x104)](_0x24fbd6,_0x77e7d7(0x1c1));return;}const _0x4951b5=_0x4728d3[_0x77e7d7(0x194)]?.[_0x77e7d7(0x17e)]||_0x77e7d7(0x18e);await database_1[_0x77e7d7(0x128)][_0x77e7d7(0x1a6)]['update']({'where':{'telegramId':_0x39d446},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x77e7d7(0x11b)+_0x39d446+'\x20disconnected\x20from\x20shop\x20'+_0x4728d3['shopId']),await this[_0x77e7d7(0x13e)]?.['sendMessage'](_0x24fbd6,_0x77e7d7(0x196)+_0x4951b5+_0x77e7d7(0x10c)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x77e7d7(0x1a0)});}catch(_0x82125a){console[_0x77e7d7(0x19d)](_0x77e7d7(0x17b),_0x82125a),await this[_0x77e7d7(0x13e)]?.[_0x77e7d7(0x104)](_0x24fbd6,_0x77e7d7(0x123));}}),this[_0x104a74(0x13e)][_0x104a74(0x1cd)](/\/status/,async _0x3f809f=>{const _0x525ca2=_0x104a74,_0x538600=_0x3f809f[_0x525ca2(0x114)]['id'],_0x5d239c=_0x3f809f[_0x525ca2(0x164)]?.['id']['toString']();if(!_0x5d239c)return;try{const _0x43dc06=await database_1[_0x525ca2(0x128)]['telegramUser'][_0x525ca2(0x14f)]({'where':{'telegramId':_0x5d239c},'include':{'shop':!![]}});if(!_0x43dc06){await this[_0x525ca2(0x13e)]?.['sendMessage'](_0x538600,_0x525ca2(0x1c5)+_0x525ca2(0x153));return;}if(!_0x43dc06[_0x525ca2(0x124)]||!_0x43dc06[_0x525ca2(0x163)]||!_0x43dc06[_0x525ca2(0x194)]){await this[_0x525ca2(0x13e)]?.['sendMessage'](_0x538600,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+'Use\x20/start\x20to\x20connect.');return;}await this[_0x525ca2(0x13e)]?.[_0x525ca2(0x104)](_0x538600,_0x525ca2(0x18b)+(_0x525ca2(0x12d)+_0x43dc06[_0x525ca2(0x194)]['name']+'*\x0a')+(_0x525ca2(0x1b0)+_0x43dc06[_0x525ca2(0x194)][_0x525ca2(0x145)]+'`\x0a')+(_0x525ca2(0x1b5)+_0x43dc06[_0x525ca2(0x183)][_0x525ca2(0xfb)](_0x525ca2(0x144))+'\x0a\x0a')+_0x525ca2(0x1c7)+_0x525ca2(0x154)+_0x525ca2(0x125),{'parse_mode':_0x525ca2(0x1a0)});}catch(_0x445950){console[_0x525ca2(0x19d)](_0x525ca2(0x180),_0x445950),await this[_0x525ca2(0x13e)]?.[_0x525ca2(0x104)](_0x538600,_0x525ca2(0x123));}}),this[_0x104a74(0x13e)][_0x104a74(0x1cd)](/\/debug/,async _0x2dcaae=>{const _0x5cc1fb=_0x104a74,_0x2e7f53=_0x2dcaae[_0x5cc1fb(0x114)]['id'],_0x2ad42d=_0x2dcaae[_0x5cc1fb(0x164)]?.['id'][_0x5cc1fb(0x14e)]();if(!_0x2ad42d)return;try{const _0x40d340=await database_1[_0x5cc1fb(0x128)][_0x5cc1fb(0x194)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x49c1bc='🔍\x20*Debug\x20Information*\x0a\x0a';_0x49c1bc+=_0x5cc1fb(0x133)+_0x2ad42d+_0x5cc1fb(0xf8),_0x49c1bc+=_0x5cc1fb(0x1a2),_0x40d340[_0x5cc1fb(0x1d6)]((_0x2a9b70,_0x2c886c)=>{const _0x9b6ac6=_0x5cc1fb;_0x49c1bc+=_0x2c886c+0x1+_0x9b6ac6(0x1cc)+_0x2a9b70[_0x9b6ac6(0x17e)]+'*\x0a',_0x49c1bc+=_0x9b6ac6(0x179)+_0x2a9b70['username']+'`\x0a',_0x49c1bc+='\x20\x20\x20Status:\x20'+_0x2a9b70[_0x9b6ac6(0x152)]+'\x0a',_0x49c1bc+=_0x9b6ac6(0x111)+_0x2a9b70[_0x9b6ac6(0x1ac)][_0x9b6ac6(0x117)](0x0,0xf)+_0x9b6ac6(0x166);}),await this[_0x5cc1fb(0x13e)]?.[_0x5cc1fb(0x104)](_0x2e7f53,_0x49c1bc,{'parse_mode':_0x5cc1fb(0x1a0)});}catch(_0x5de58b){console[_0x5cc1fb(0x19d)](_0x5cc1fb(0x170),_0x5de58b),await this[_0x5cc1fb(0x13e)]?.[_0x5cc1fb(0x104)](_0x2e7f53,'❌\x20Error\x20getting\x20debug\x20information.');}}),this[_0x104a74(0x13e)]['on'](_0x104a74(0x16e),async _0x25b211=>{const _0x4d8aec=_0x104a74;if(_0x25b211['text']?.[_0x4d8aec(0x188)]('/'))return;const _0x3f8bb7=_0x25b211[_0x4d8aec(0x114)]['id'],_0x5bb2d2=_0x25b211[_0x4d8aec(0x164)]?.['id'][_0x4d8aec(0x14e)](),_0x512920=_0x25b211['text']?.[_0x4d8aec(0x16f)]();if(!_0x5bb2d2||!_0x512920)return;try{const _0x1f1a6e=await database_1[_0x4d8aec(0x128)][_0x4d8aec(0x1a6)]['findUnique']({'where':{'telegramId':_0x5bb2d2},'include':{'shop':!![]}});if(!_0x1f1a6e){await this['bot']?.['sendMessage'](_0x3f8bb7,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x1f1a6e[_0x4d8aec(0x124)]&&_0x1f1a6e[_0x4d8aec(0x163)]&&_0x1f1a6e[_0x4d8aec(0x194)]){await this[_0x4d8aec(0x13e)]?.[_0x4d8aec(0x104)](_0x3f8bb7,_0x4d8aec(0x10a)+_0x1f1a6e[_0x4d8aec(0x194)]['name']+_0x4d8aec(0x10c)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':'Markdown'});return;}const _0x1ac40a=_0x512920[_0x4d8aec(0x110)](/\s+/);if(_0x1ac40a[_0x4d8aec(0x101)]!==0x2){await this[_0x4d8aec(0x13e)]?.[_0x4d8aec(0x104)](_0x3f8bb7,_0x4d8aec(0x160)+_0x4d8aec(0x172)+_0x4d8aec(0x182)+_0x4d8aec(0x10f)+(_0x4d8aec(0x151)+_0x1ac40a['length']+_0x4d8aec(0x189)+_0x1ac40a[_0x4d8aec(0xf9)](_0x2274aa=>'`'+_0x2274aa+'`')['join'](',\x20')),{'parse_mode':_0x4d8aec(0x1a0)});return;}const [_0x48f7c5,_0x2f3e7a]=_0x1ac40a;console[_0x4d8aec(0x17a)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x5bb2d2+_0x4d8aec(0x120)+_0x48f7c5+_0x4d8aec(0x18c)+_0x2f3e7a[_0x4d8aec(0x117)](0x0,0xa)+'...\x22'),await this[_0x4d8aec(0x1d5)](_0x3f8bb7,_0x5bb2d2,_0x48f7c5,_0x2f3e7a);}catch(_0x563988){console[_0x4d8aec(0x19d)](_0x4d8aec(0x16d),_0x563988),await this['bot']?.[_0x4d8aec(0x104)](_0x3f8bb7,_0x4d8aec(0x123));}}),this[_0x104a74(0x13e)]['on'](_0x104a74(0x19d),_0x50ac78=>{const _0x239cf7=_0x104a74;console[_0x239cf7(0x19d)](_0x239cf7(0x105),_0x50ac78);}),this[_0x104a74(0x13e)]['on'](_0x104a74(0x12b),_0x3d7890=>{const _0x216db8=_0x104a74;console['error'](_0x216db8(0x181),_0x3d7890);});}async[a54_0x339b56(0x1d5)](_0x472359,_0x3d90d6,_0x41ed81,_0x317d7b){const _0xccb0c4=a54_0x339b56;try{console[_0xccb0c4(0x17a)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x3d90d6+_0xccb0c4(0x120)+_0x41ed81+_0xccb0c4(0x18c)+_0x317d7b['substring'](0x0,0xa)+_0xccb0c4(0x102));if(!_0x41ed81||_0x41ed81[_0xccb0c4(0x101)]<0x3||_0x41ed81[_0xccb0c4(0x101)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x41ed81)){await this[_0xccb0c4(0x13e)]?.[_0xccb0c4(0x104)](_0x472359,_0xccb0c4(0x132)+_0x41ed81+_0xccb0c4(0xf8)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0xccb0c4(0x1a0)});return;}if(!_0x317d7b||!_0x317d7b[_0xccb0c4(0x188)](_0xccb0c4(0x130))&&!_0x317d7b[_0xccb0c4(0x188)]('sk_')){await this[_0xccb0c4(0x13e)]?.[_0xccb0c4(0x104)](_0x472359,_0xccb0c4(0x178)+_0xccb0c4(0x1d8),{'parse_mode':_0xccb0c4(0x1a0)});return;}const _0x5c5780=await database_1[_0xccb0c4(0x128)][_0xccb0c4(0x194)][_0xccb0c4(0x14f)]({'where':{'username':_0x41ed81},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x5c5780){const _0x5845ac=await database_1[_0xccb0c4(0x128)][_0xccb0c4(0x194)][_0xccb0c4(0x19f)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x1de44c=_0xccb0c4(0x149)+_0x41ed81+_0xccb0c4(0x100);_0x5845ac['length']>0x0?(_0x1de44c+=_0xccb0c4(0x1c4),_0x5845ac[_0xccb0c4(0x1d6)](_0x1da512=>{const _0x9a1298=_0xccb0c4;_0x1de44c+=_0x9a1298(0x1c9)+_0x1da512['username']+_0x9a1298(0xfd)+_0x1da512['name']+')\x0a';}),_0x1de44c+=_0xccb0c4(0xfa)):_0x1de44c+=_0xccb0c4(0x14d);await this[_0xccb0c4(0x13e)]?.[_0xccb0c4(0x104)](_0x472359,_0x1de44c,{'parse_mode':_0xccb0c4(0x1a0)});return;}if(_0x5c5780[_0xccb0c4(0x152)]!==_0xccb0c4(0x13a)){await this[_0xccb0c4(0x13e)]?.['sendMessage'](_0x472359,_0xccb0c4(0x169)+_0x41ed81+_0xccb0c4(0x1d3)+_0xccb0c4(0x126),{'parse_mode':_0xccb0c4(0x1a0)});return;}if(_0x5c5780[_0xccb0c4(0x1ac)]!==_0x317d7b&&_0x5c5780[_0xccb0c4(0x184)]!==_0x317d7b){await this[_0xccb0c4(0x13e)]?.[_0xccb0c4(0x104)](_0x472359,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x41ed81+'`.\x0a\x0a'+_0xccb0c4(0x138)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':'Markdown'});return;}const _0xfccb38=await database_1['default'][_0xccb0c4(0x1a6)]['findFirst']({'where':{'shopId':_0x5c5780['id'],'isVerified':!![],'telegramId':{'not':_0x3d90d6}}});if(_0xfccb38){await this[_0xccb0c4(0x13e)]?.[_0xccb0c4(0x104)](_0x472359,_0xccb0c4(0x18d)+_0x41ed81+_0xccb0c4(0x177)+_0xccb0c4(0x10e),{'parse_mode':_0xccb0c4(0x1a0)});return;}await database_1[_0xccb0c4(0x128)]['telegramUser'][_0xccb0c4(0x13b)]({'where':{'telegramId':_0x3d90d6},'data':{'shopId':_0x5c5780['id'],'isVerified':!![]}}),await this['bot']?.[_0xccb0c4(0x104)](_0x472359,_0xccb0c4(0x14c)+_0xccb0c4(0x12e)+(_0xccb0c4(0x1a4)+_0x5c5780[_0xccb0c4(0x17e)]+'*\x0a')+('👤\x20Username:\x20`'+_0x5c5780[_0xccb0c4(0x145)]+_0xccb0c4(0xf8))+_0xccb0c4(0x1bf)+_0xccb0c4(0x10b)+_0xccb0c4(0x1a5)+_0xccb0c4(0x174)+_0xccb0c4(0xfc)+'Commands:\x0a'+_0xccb0c4(0x193)+_0xccb0c4(0x125),{'parse_mode':'Markdown'}),console[_0xccb0c4(0x17a)]('✅\x20Telegram\x20user\x20'+_0x3d90d6+_0xccb0c4(0x1d4)+_0x5c5780[_0xccb0c4(0x145)]+'\x20via\x20single-line\x20input');}catch(_0x509a61){console[_0xccb0c4(0x19d)]('Error\x20in\x20handleSingleLineVerification:',_0x509a61),await this[_0xccb0c4(0x13e)]?.[_0xccb0c4(0x104)](_0x472359,_0xccb0c4(0x1d2));}}async[a54_0x339b56(0x141)](_0xdf550b,_0x19ae6c,_0x491556){const _0x42fec6=a54_0x339b56;if(!this[_0x42fec6(0x13e)]){console['warn'](_0x42fec6(0x1ad));return;}try{const _0x479eb3=await database_1[_0x42fec6(0x128)][_0x42fec6(0x1a6)]['findMany']({'where':{'shopId':_0xdf550b,'isVerified':!![]}});if(_0x479eb3[_0x42fec6(0x101)]===0x0){console[_0x42fec6(0x17a)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0xdf550b);return;}const _0x2103c5=_0x479eb3[_0x42fec6(0xf9)](async _0x2f5127=>{const _0xdce0fa=_0x42fec6;try{await this[_0xdce0fa(0x13e)]?.[_0xdce0fa(0x104)](_0x2f5127[_0xdce0fa(0x16c)],_0x19ae6c,_0x491556),console['log'](_0xdce0fa(0x1a7)+_0x2f5127[_0xdce0fa(0x16c)]);}catch(_0x1bce53){console['error'](_0xdce0fa(0x135)+_0x2f5127[_0xdce0fa(0x16c)]+':',_0x1bce53),_0x1bce53 instanceof Error&&(_0x1bce53[_0xdce0fa(0x16e)]['includes']('blocked')||_0x1bce53[_0xdce0fa(0x16e)][_0xdce0fa(0x185)](_0xdce0fa(0x148))||_0x1bce53[_0xdce0fa(0x16e)]['includes'](_0xdce0fa(0x1bc)))&&(await database_1['default'][_0xdce0fa(0x1a6)][_0xdce0fa(0x13b)]({'where':{'id':_0x2f5127['id']},'data':{'isVerified':![]}}),console[_0xdce0fa(0x17a)](_0xdce0fa(0x158)+_0x2f5127[_0xdce0fa(0x16c)]+_0xdce0fa(0x199)));}});await Promise[_0x42fec6(0x14a)](_0x2103c5);}catch(_0x51e8b2){console[_0x42fec6(0x19d)]('Error\x20sending\x20shop\x20notification:',_0x51e8b2);}}async[a54_0x339b56(0xfe)](_0x323338,_0x4b5a19,_0xa93ac1){const _0x735e15=a54_0x339b56,_0x42fe18={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x482296={'created':_0x735e15(0x1cf),'paid':_0x735e15(0x11a),'failed':'Payment\x20failed','expired':'Payment\x20expired','refund':_0x735e15(0x18a),'chargeback':_0x735e15(0x1af),'processing':_0x735e15(0x112)},_0x3cb17b=_0x42fe18[_0xa93ac1],_0xe5eaad=_0x482296[_0xa93ac1],_0x1e9392=(0x0,gateway_1[_0x735e15(0x171)])(_0x4b5a19[_0x735e15(0x15a)]);console[_0x735e15(0x17a)](_0x735e15(0x19c)+_0x4b5a19[_0x735e15(0x15a)]+'\x22\x20->\x20display\x20\x22'+_0x1e9392+'\x22');let _0x3c7da2=_0x3cb17b+'\x20*'+_0xe5eaad+'*\x0a\x0a'+(_0x735e15(0x136)+_0x4b5a19[_0x735e15(0x1d1)]+'\x20'+_0x4b5a19[_0x735e15(0x19b)]+'*\x0a')+(_0x735e15(0x1bd)+(_0x4b5a19[_0x735e15(0x1c2)]||_0x4b5a19['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x4b5a19['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x1e9392+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x4b5a19[_0x735e15(0x1b6)])[_0x735e15(0x12c)](_0x735e15(0x144))+'\x0a');if(_0x4b5a19[_0x735e15(0x127)]||_0x4b5a19['customerEmail']||_0x4b5a19[_0x735e15(0x186)]||_0x4b5a19['customerIp']||_0x4b5a19['customerUa']){_0x3c7da2+=_0x735e15(0x118);_0x4b5a19[_0x735e15(0x127)]&&(_0x3c7da2+=_0x735e15(0x17f)+_0x4b5a19[_0x735e15(0x127)]+'`\x0a');_0x4b5a19[_0x735e15(0x1da)]&&(_0x3c7da2+=_0x735e15(0x1b4)+_0x4b5a19[_0x735e15(0x1da)]+'`\x0a');_0x4b5a19[_0x735e15(0x186)]&&(_0x3c7da2+=_0x735e15(0x198)+_0x4b5a19[_0x735e15(0x186)]+'`\x0a');_0x4b5a19[_0x735e15(0x11f)]&&(_0x3c7da2+=_0x735e15(0x1c6)+_0x4b5a19[_0x735e15(0x11f)]+'`\x0a');if(_0x4b5a19[_0x735e15(0x167)]){const _0x5589bc=_0x4b5a19[_0x735e15(0x167)][_0x735e15(0x101)]>0x32?_0x4b5a19[_0x735e15(0x167)][_0x735e15(0x117)](0x0,0x32)+'...':_0x4b5a19[_0x735e15(0x167)];_0x3c7da2+=_0x735e15(0x1c0)+_0x5589bc+'`\x0a';}}_0xa93ac1==='chargeback'&&_0x4b5a19[_0x735e15(0x1b1)]&&(_0x3c7da2+=_0x735e15(0x1a9)+_0x4b5a19[_0x735e15(0x1b1)]+_0x735e15(0x17d)),_0xa93ac1===_0x735e15(0x109)&&(_0x3c7da2+=_0x735e15(0x16a)),_0x4b5a19[_0x735e15(0x191)]&&(_0x3c7da2+=_0x735e15(0x1b9)+_0x4b5a19[_0x735e15(0x191)]+'\x0a'),await this['sendShopNotification'](_0x323338,_0x3c7da2,{'parse_mode':_0x735e15(0x1a0)});}async[a54_0x339b56(0x173)](_0xa64c04,_0x4e853a,_0x1ecd7c){const _0x2472f1=a54_0x339b56,_0x513ca8={'created':'📤','completed':'✅','rejected':'❌'},_0x1a0969={'created':_0x2472f1(0x12a),'completed':_0x2472f1(0x13c),'rejected':'Payout\x20rejected'},_0x4cca18=_0x513ca8[_0x1ecd7c],_0x23bc4d=_0x1a0969[_0x1ecd7c],_0xe47057=_0x4cca18+'\x20*'+_0x23bc4d+'*\x0a\x0a'+(_0x2472f1(0x157)+_0x4e853a[_0x2472f1(0x1d1)]+_0x2472f1(0x150))+('🏦\x20Method:\x20`'+_0x4e853a['method']+'`\x0a')+(_0x2472f1(0x121)+_0x4e853a['id']+'`\x0a')+(_0x2472f1(0x15e)+new Date(_0x4e853a[_0x2472f1(0x1b6)])[_0x2472f1(0x12c)](_0x2472f1(0x144))+'\x0a')+(_0x4e853a[_0x2472f1(0x131)]?_0x2472f1(0x16b)+_0x4e853a[_0x2472f1(0x131)]+'`':'');await this[_0x2472f1(0x141)](_0xa64c04,_0xe47057,{'parse_mode':_0x2472f1(0x1a0)});}async['sendLoginNotification'](_0x1e84bc,_0x4ee8d9){const _0x10c709=a54_0x339b56;try{const _0x5d57de=await database_1['default'][_0x10c709(0x168)]['findUnique']({'where':{'shopId':_0x1e84bc},'select':{'notificationLogin':!![]}});if(!_0x5d57de?.[_0x10c709(0x1b3)]){console['log'](_0x10c709(0x13d)+_0x1e84bc);return;}const _0x4afe87=_0x4ee8d9['success']?'🔐':'🚨',_0xaf5201=_0x4ee8d9[_0x10c709(0x187)]?_0x10c709(0x1a3):_0x10c709(0x15d);let _0x3bd2a8=_0x4afe87+'\x20*'+_0xaf5201+'*\x0a\x0a'+(_0x10c709(0x1b0)+_0x4ee8d9['username']+'`\x0a')+(_0x10c709(0x1ba)+_0x4ee8d9['timestamp']['toLocaleString'](_0x10c709(0x144))+'\x0a');_0x4ee8d9[_0x10c709(0x1d7)]&&(_0x3bd2a8+=_0x10c709(0x11e)+_0x4ee8d9[_0x10c709(0x1d7)]+'`\x0a');if(_0x4ee8d9[_0x10c709(0x1ab)]){const _0x4a2564=_0x4ee8d9[_0x10c709(0x1ab)][_0x10c709(0x101)]>0x32?_0x4ee8d9[_0x10c709(0x1ab)][_0x10c709(0x117)](0x0,0x32)+_0x10c709(0x15b):_0x4ee8d9[_0x10c709(0x1ab)];_0x3bd2a8+=_0x10c709(0x1c0)+_0x4a2564+'`\x0a';}!_0x4ee8d9[_0x10c709(0x187)]&&(_0x3bd2a8+=_0x10c709(0x108)),await this[_0x10c709(0x141)](_0x1e84bc,_0x3bd2a8,{'parse_mode':_0x10c709(0x1a0)}),console['log'](_0x10c709(0x197)+_0x1e84bc+':\x20'+(_0x4ee8d9[_0x10c709(0x187)]?_0x10c709(0x187):_0x10c709(0x192)));}catch(_0x4d85aa){console[_0x10c709(0x19d)](_0x10c709(0x1ca),_0x4d85aa);}}async[a54_0x339b56(0x137)](_0x354c06,_0x16abff){const _0x924d1e=a54_0x339b56;try{const _0x2dac5d=await database_1['default']['shopSettings']['findUnique']({'where':{'shopId':_0x354c06},'select':{'notificationApiError':!![]}});if(!_0x2dac5d?.[_0x924d1e(0x142)]){console['log']('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x354c06);return;}let _0x166319='🚨\x20*API\x20Error*\x0a\x0a'+(_0x924d1e(0x1b7)+_0x16abff['method']+'\x20'+_0x16abff['endpoint']+'`\x0a')+('📅\x20Time:\x20'+_0x16abff[_0x924d1e(0x12f)]['toLocaleString'](_0x924d1e(0x144))+'\x0a');_0x16abff[_0x924d1e(0x165)]&&(_0x166319+=_0x924d1e(0x107)+_0x16abff[_0x924d1e(0x165)]+'`\x0a'),_0x166319+=_0x924d1e(0x143)+_0x16abff['errorMessage']+'`\x0a',_0x16abff[_0x924d1e(0x159)]&&(_0x166319+=_0x924d1e(0x139)+_0x16abff['requestId']+'`\x0a'),_0x166319+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x924d1e(0x141)](_0x354c06,_0x166319,{'parse_mode':_0x924d1e(0x1a0)}),console['log'](_0x924d1e(0x156)+_0x354c06+':\x20'+_0x16abff['endpoint']);}catch(_0x2e740b){console[_0x924d1e(0x19d)](_0x924d1e(0x1c3),_0x2e740b);}}async[a54_0x339b56(0x175)](_0x323e72,_0x113a02,_0x5b642c){const _0x4ec128=a54_0x339b56;let _0x2ce793=_0x4ec128(0x1b8)+_0x113a02+'*\x0a\x0a';for(const [_0x1f9726,_0x1620a3]of Object[_0x4ec128(0x147)](_0x5b642c)){_0x1620a3!==null&&_0x1620a3!==undefined&&(_0x2ce793+=_0x1f9726+_0x4ec128(0x122)+_0x1620a3+'`\x0a');}await this[_0x4ec128(0x141)](_0x323e72,_0x2ce793,{'parse_mode':_0x4ec128(0x1a0)});}[a54_0x339b56(0x190)](){const _0xb2679e=a54_0x339b56;return{'isActive':!!this[_0xb2679e(0x13e)],'username':this[_0xb2679e(0x1bb)]};}['stopBot'](){const _0x178321=a54_0x339b56;this[_0x178321(0x13e)]&&(this[_0x178321(0x13e)][_0x178321(0x103)](),this[_0x178321(0x13e)]=null,console['log'](_0x178321(0x195)));}}exports[a54_0x339b56(0x113)]=TelegramBotService,exports[a54_0x339b56(0x161)]=new TelegramBotService();