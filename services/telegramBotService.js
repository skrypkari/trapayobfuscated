'use strict';const a54_0x3f3248=a54_0x1dbd;(function(_0x3f8d0c,_0x4cc331){const _0x13022e=a54_0x1dbd,_0x50d7c5=_0x3f8d0c();while(!![]){try{const _0x504e75=parseInt(_0x13022e(0x1fd))/0x1*(parseInt(_0x13022e(0x222))/0x2)+-parseInt(_0x13022e(0x1e8))/0x3+-parseInt(_0x13022e(0x1bc))/0x4*(parseInt(_0x13022e(0x148))/0x5)+-parseInt(_0x13022e(0x1f9))/0x6+-parseInt(_0x13022e(0x1fe))/0x7*(-parseInt(_0x13022e(0x21a))/0x8)+-parseInt(_0x13022e(0x182))/0x9*(parseInt(_0x13022e(0x220))/0xa)+parseInt(_0x13022e(0x216))/0xb;if(_0x504e75===_0x4cc331)break;else _0x50d7c5['push'](_0x50d7c5['shift']());}catch(_0x42d64d){_0x50d7c5['push'](_0x50d7c5['shift']());}}}(a54_0xeeb7,0xbefe6));function a54_0xeeb7(){const _0xbe59b0=['•\x20Payouts\x0a','\x20\x20\x20Public\x20Key:\x20`','toString','New\x20payout\x20created','Commands:\x0a','7264TDdcNQ','default','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','text','🔔\x20*','`\x20is\x20inactive.\x0a\x0a','shopSettings','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','•\x20Important\x20events\x0a\x0a','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','🏦\x20Method:\x20`','ipAddress','last_name','🏪\x20Gateway:\x20`','setupBotHandlers','stopBot','🚨\x20*API\x20Error*\x0a\x0a','defineProperty','timestamp','errorMessage','📅\x20Time:\x20','txid','\x20verified\x20for\x20shop\x20','forEach','💻\x20Browser:\x20`','`\x0a\x0a','❌\x20Invalid\x20username\x20format:\x20`','•\x20`','getGatewayDisplayNameForTelegram','toLocaleString','🔍\x20*Debug\x20Information*\x0a\x0a','sendMessage','message','📱\x20Shop:\x20*','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','Payout\x20completed','📊\x20Error\x20code:\x20`','startsWith','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','📱\x20Created\x20new\x20Telegram\x20user:\x20','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','❌\x20Shop\x20`','\x20USDT*\x0a','•\x20Payouts\x0a\x0a','4243155JsMSJS','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','💸\x20Penalty\x20amount:\x20*','bot','Successful\x20login','adminNotes','chargebackAmount','user\x20is\x20deactivated','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','toLocaleDateString','Check\x20spelling\x20and\x20try\x20again.','publicKey','shop','🔗\x20TXID:\x20`','💰\x20Amount:\x20*','2060238SujePk','telegramUser','✅\x20Connected\x20to\x20shop:\x20*','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','11605xZpgGl','7yvXwsp','*.\x0a\x0a','👤\x20Username:\x20`','status','Failed\x20login\x20attempt','📝\x20Notes:\x20','shopId','🆔\x20Request\x20ID:\x20`','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','customerEmail','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','📅\x20Connection\x20date:\x20','Payment\x20expired','../types/gateway','method','`.\x0a\x0a','...','\x22\x20->\x20display\x20\x22','unknown\x20shop','...\x22','✅\x20Telegram\x20user\x20','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','32768142LzvvLD','requestId','findFirst','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','10280208ihNILM','username','Payout\x20rejected','statusCode','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','secretKey','30tqZVOf','findUnique','10UNCHRu','📧\x20Email:\x20`','You\x20sent\x20','❌\x20Error\x20getting\x20debug\x20information.','updatedAt','🎉\x20*Congratulations!*\x0a\x0a','initializeBot','🌐\x20IP\x20address:\x20`','__esModule','Payment\x20refund','success','Error\x20handling\x20/disconnect\x20command:','💸\x20Amount:\x20*','__importDefault','telegramId','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Payment\x20chargeback','notificationLogin','trapay_bot','To\x20reconnect,\x20use\x20the\x20/start\x20command','3080ogTwMI',':\x20`','onText','🔌\x20User\x20','length','includes','\x20disconnected\x20from\x20shop\x20','User\x20','Error\x20in\x20handleSingleLineVerification:','join','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','\x0a👤\x20*Customer\x20Information:*\x0a','Markdown','❌\x20Please\x20use\x20/start\x20command\x20first','📝\x20Order\x20ID:\x20`','chargeback','*\x0a\x0a','getBotInfo','failed','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','substring','warn','entries','🆔\x20Payout\x20ID:\x20`','findMany','.\x20*','🛑\x20Telegram\x20bot\x20stopped','🆔\x20Payment\x20ID:\x20`','Error\x20handling\x20/start\x20command:','test','New\x20payment\x20created','`\x20(','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','\x20via\x20single-line\x20input','\x20\x20\x20Username:\x20`','`\x20not\x20found.\x0a\x0a','error','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','processing','sendPaymentNotification','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Payment\x20is\x20being\x20processed','pk_','chat','📱\x20Your\x20Telegram\x20ID:\x20`','userAgent','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','sendPayoutNotification','env','botUsername','log','Available\x20usernames:\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','❌\x20Shop\x20with\x20username\x20`','\x0aCheck\x20spelling\x20and\x20try\x20again.','handleSingleLineVerification','1989747PPTwsf','\x22,\x20apiKey=\x22','📅\x20Date:\x20','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','name','split','Error\x20handling\x20message:','📊\x20*Connection\x20Status*\x0a\x0a','currency','TelegramBotService','sendApiErrorNotification','\x20parts:\x20','Payment\x20failed','sendCustomNotification','Example:\x0a','node-telegram-bot-api','create','sendShopNotification','customerName','Contact\x20administrator.','❌\x20Error:\x20`','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','Failed\x20to\x20send\x20login\x20notification:','gateway','/disconnect\x20-\x20disconnect\x20from\x20notifications','update','from','Username:\x20`','isVerified','🔗\x20Endpoint:\x20`','telegramBotService','map','•\x20New\x20payments\x0a','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','\x20\x20\x20Status:\x20','botToken','en-US','\x20initialized\x20successfully','Failed\x20to\x20send\x20API\x20error\x20notification:','TELEGRAM_BOT_TOKEN','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','sk_','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a',':\x20username=\x22','ACTIVE','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','\x20USD*\x0a','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','stopPolling','✅\x20Telegram\x20bot\x20@','../config/database','allSettled'];a54_0xeeb7=function(){return _0xbe59b0;};return a54_0xeeb7();}var __importDefault=this&&this[a54_0x3f3248(0x141)]||function(_0x3b0825){const _0x2e857d=a54_0x3f3248;return _0x3b0825&&_0x3b0825[_0x2e857d(0x13c)]?_0x3b0825:{'default':_0x3b0825};};Object[a54_0x3f3248(0x1cd)](exports,'__esModule',{'value':!![]}),exports[a54_0x3f3248(0x1a1)]=exports[a54_0x3f3248(0x18c)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x3f3248(0x192))),database_1=__importDefault(require(a54_0x3f3248(0x1b5))),gateway_1=require(a54_0x3f3248(0x20d));function a54_0x1dbd(_0x239d8d,_0x370ab2){const _0xeeb76c=a54_0xeeb7();return a54_0x1dbd=function(_0x1dbdc8,_0x51b160){_0x1dbdc8=_0x1dbdc8-0x137;let _0x350359=_0xeeb76c[_0x1dbdc8];return _0x350359;},a54_0x1dbd(_0x239d8d,_0x370ab2);}class TelegramBotService{constructor(){const _0x5005fe=a54_0x3f3248;this['bot']=null,this['botToken']=process[_0x5005fe(0x17a)][_0x5005fe(0x1aa)]||'',this[_0x5005fe(0x17b)]=process['env']['TELEGRAM_BOT_USERNAME']||_0x5005fe(0x146),this[_0x5005fe(0x1a6)]?this[_0x5005fe(0x13a)]():console[_0x5005fe(0x15e)](_0x5005fe(0x206));}['initializeBot'](){const _0x1520f7=a54_0x3f3248;try{this[_0x1520f7(0x1ed)]=new node_telegram_bot_api_1[(_0x1520f7(0x1bd))](this[_0x1520f7(0x1a6)],{'polling':!![]}),this[_0x1520f7(0x1ca)](),console[_0x1520f7(0x17c)](_0x1520f7(0x1b4)+this[_0x1520f7(0x17b)]+_0x1520f7(0x1a8));}catch(_0x189118){console[_0x1520f7(0x16d)](_0x1520f7(0x186),_0x189118);}}[a54_0x3f3248(0x1ca)](){const _0x3e8912=a54_0x3f3248;if(!this['bot'])return;this[_0x3e8912(0x1ed)][_0x3e8912(0x14a)](/\/start/,async _0x5000e3=>{const _0x96833=_0x3e8912,_0x127765=_0x5000e3[_0x96833(0x174)]['id'],_0x363cb9=_0x5000e3[_0x96833(0x19d)]?.['id'][_0x96833(0x1b9)](),_0x377d5d=_0x5000e3[_0x96833(0x19d)]?.[_0x96833(0x21b)],_0x5b8ea0=_0x5000e3[_0x96833(0x19d)]?.['first_name'],_0xb00356=_0x5000e3[_0x96833(0x19d)]?.[_0x96833(0x1c8)];if(!_0x363cb9)return;try{let _0x300c31=await database_1[_0x96833(0x1bd)][_0x96833(0x1fa)]['findUnique']({'where':{'telegramId':_0x363cb9},'include':{'shop':!![]}});!_0x300c31?(_0x300c31=await database_1[_0x96833(0x1bd)][_0x96833(0x1fa)][_0x96833(0x193)]({'data':{'telegramId':_0x363cb9,'username':_0x377d5d,'firstName':_0x5b8ea0,'lastName':_0xb00356,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x96833(0x17c)](_0x96833(0x1e3)+_0x363cb9+'\x20(@'+_0x377d5d+')')):_0x300c31=await database_1[_0x96833(0x1bd)]['telegramUser']['update']({'where':{'telegramId':_0x363cb9},'data':{'username':_0x377d5d,'firstName':_0x5b8ea0,'lastName':_0xb00356},'include':{'shop':!![]}}),_0x300c31[_0x96833(0x19f)]&&_0x300c31[_0x96833(0x204)]&&_0x300c31[_0x96833(0x1f6)]?await this['bot']?.['sendMessage'](_0x127765,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x96833(0x178)+_0x300c31['shop']['name']+'*\x0a')+(_0x96833(0x19e)+_0x300c31[_0x96833(0x1f6)][_0x96833(0x21b)]+_0x96833(0x1d5))+_0x96833(0x171)+_0x96833(0x1a3)+'•\x20Payment\x20status\x20changes\x0a'+_0x96833(0x1e7)+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x96833(0x19b),{'parse_mode':_0x96833(0x154)}):(_0x300c31[_0x96833(0x204)]&&!_0x300c31[_0x96833(0x19f)]&&(await database_1['default'][_0x96833(0x1fa)][_0x96833(0x19c)]({'where':{'telegramId':_0x363cb9},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x96833(0x1e2)+_0x363cb9)),await this['bot']?.[_0x96833(0x1db)](_0x127765,_0x96833(0x185)+_0x96833(0x1a4)+_0x96833(0x1be)+_0x96833(0x191)+_0x96833(0x1c3)+_0x96833(0x21e),{'parse_mode':_0x96833(0x154)}));}catch(_0x38e7a7){console[_0x96833(0x16d)](_0x96833(0x165),_0x38e7a7),await this[_0x96833(0x1ed)]?.[_0x96833(0x1db)](_0x127765,_0x96833(0x1ab));}}),this['bot'][_0x3e8912(0x14a)](/\/disconnect/,async _0xf9cf61=>{const _0x3cb254=_0x3e8912,_0x217abc=_0xf9cf61[_0x3cb254(0x174)]['id'],_0x3f332d=_0xf9cf61[_0x3cb254(0x19d)]?.['id'][_0x3cb254(0x1b9)]();if(!_0x3f332d)return;try{const _0x452118=await database_1['default'][_0x3cb254(0x1fa)][_0x3cb254(0x221)]({'where':{'telegramId':_0x3f332d},'include':{'shop':!![]}});if(!_0x452118||!_0x452118['isVerified']||!_0x452118[_0x3cb254(0x204)]){await this[_0x3cb254(0x1ed)]?.[_0x3cb254(0x1db)](_0x217abc,_0x3cb254(0x1f2));return;}const _0x1ba200=_0x452118[_0x3cb254(0x1f6)]?.[_0x3cb254(0x187)]||_0x3cb254(0x212);await database_1[_0x3cb254(0x1bd)]['telegramUser'][_0x3cb254(0x19c)]({'where':{'telegramId':_0x3f332d},'data':{'shopId':null,'isVerified':![]}}),console[_0x3cb254(0x17c)](_0x3cb254(0x14b)+_0x3f332d+_0x3cb254(0x14e)+_0x452118[_0x3cb254(0x204)]),await this[_0x3cb254(0x1ed)]?.[_0x3cb254(0x1db)](_0x217abc,_0x3cb254(0x215)+_0x1ba200+'*.\x0a\x0a'+_0x3cb254(0x147),{'parse_mode':_0x3cb254(0x154)});}catch(_0x540aa3){console[_0x3cb254(0x16d)](_0x3cb254(0x13f),_0x540aa3),await this[_0x3cb254(0x1ed)]?.[_0x3cb254(0x1db)](_0x217abc,_0x3cb254(0x1ab));}}),this[_0x3e8912(0x1ed)]['onText'](/\/status/,async _0x32b0a9=>{const _0x572d4f=_0x3e8912,_0x1244c3=_0x32b0a9[_0x572d4f(0x174)]['id'],_0x5ab400=_0x32b0a9[_0x572d4f(0x19d)]?.['id']['toString']();if(!_0x5ab400)return;try{const _0x427496=await database_1[_0x572d4f(0x1bd)][_0x572d4f(0x1fa)][_0x572d4f(0x221)]({'where':{'telegramId':_0x5ab400},'include':{'shop':!![]}});if(!_0x427496){await this[_0x572d4f(0x1ed)]?.[_0x572d4f(0x1db)](_0x1244c3,_0x572d4f(0x1e4)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x427496[_0x572d4f(0x19f)]||!_0x427496[_0x572d4f(0x204)]||!_0x427496[_0x572d4f(0x1f6)]){await this['bot']?.[_0x572d4f(0x1db)](_0x1244c3,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+'Use\x20/start\x20to\x20connect.');return;}await this['bot']?.[_0x572d4f(0x1db)](_0x1244c3,_0x572d4f(0x18a)+(_0x572d4f(0x1fb)+_0x427496[_0x572d4f(0x1f6)][_0x572d4f(0x187)]+'*\x0a')+(_0x572d4f(0x200)+_0x427496[_0x572d4f(0x1f6)]['username']+'`\x0a')+(_0x572d4f(0x20b)+_0x427496[_0x572d4f(0x138)][_0x572d4f(0x1f3)](_0x572d4f(0x1a7))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+_0x572d4f(0x1bb)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x572d4f(0x154)});}catch(_0x161cf4){console[_0x572d4f(0x16d)]('Error\x20handling\x20/status\x20command:',_0x161cf4),await this[_0x572d4f(0x1ed)]?.[_0x572d4f(0x1db)](_0x1244c3,_0x572d4f(0x1ab));}}),this[_0x3e8912(0x1ed)][_0x3e8912(0x14a)](/\/debug/,async _0x1bccd0=>{const _0x1931ca=_0x3e8912,_0x11d3dd=_0x1bccd0[_0x1931ca(0x174)]['id'],_0x14c1b0=_0x1bccd0[_0x1931ca(0x19d)]?.['id']['toString']();if(!_0x14c1b0)return;try{const _0x1a899c=await database_1[_0x1931ca(0x1bd)][_0x1931ca(0x1f6)][_0x1931ca(0x161)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x1d3562=_0x1931ca(0x1da);_0x1d3562+=_0x1931ca(0x175)+_0x14c1b0+_0x1931ca(0x1d5),_0x1d3562+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x1a899c[_0x1931ca(0x1d3)]((_0x25c99c,_0x42263b)=>{const _0x3a21c4=_0x1931ca;_0x1d3562+=_0x42263b+0x1+_0x3a21c4(0x162)+_0x25c99c['name']+'*\x0a',_0x1d3562+=_0x3a21c4(0x16b)+_0x25c99c['username']+'`\x0a',_0x1d3562+=_0x3a21c4(0x1a5)+_0x25c99c[_0x3a21c4(0x201)]+'\x0a',_0x1d3562+=_0x3a21c4(0x1b8)+_0x25c99c[_0x3a21c4(0x1f5)][_0x3a21c4(0x15d)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x1931ca(0x1ed)]?.['sendMessage'](_0x11d3dd,_0x1d3562,{'parse_mode':_0x1931ca(0x154)});}catch(_0x436c9b){console[_0x1931ca(0x16d)]('Error\x20handling\x20/debug\x20command:',_0x436c9b),await this[_0x1931ca(0x1ed)]?.[_0x1931ca(0x1db)](_0x11d3dd,_0x1931ca(0x137));}}),this['bot']['on'](_0x3e8912(0x1dc),async _0x2fb367=>{const _0x16da6c=_0x3e8912;if(_0x2fb367[_0x16da6c(0x1bf)]?.[_0x16da6c(0x1e1)]('/'))return;const _0x1dd6c7=_0x2fb367[_0x16da6c(0x174)]['id'],_0x428045=_0x2fb367[_0x16da6c(0x19d)]?.['id'][_0x16da6c(0x1b9)](),_0x81b90c=_0x2fb367['text']?.['trim']();if(!_0x428045||!_0x81b90c)return;try{const _0x124f9d=await database_1['default']['telegramUser'][_0x16da6c(0x221)]({'where':{'telegramId':_0x428045},'include':{'shop':!![]}});if(!_0x124f9d){await this[_0x16da6c(0x1ed)]?.[_0x16da6c(0x1db)](_0x1dd6c7,_0x16da6c(0x155));return;}if(_0x124f9d['isVerified']&&_0x124f9d[_0x16da6c(0x204)]&&_0x124f9d[_0x16da6c(0x1f6)]){await this[_0x16da6c(0x1ed)]?.['sendMessage'](_0x1dd6c7,_0x16da6c(0x143)+_0x124f9d['shop']['name']+_0x16da6c(0x1ff)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x16da6c(0x154)});return;}const _0x3f94e5=_0x81b90c[_0x16da6c(0x188)](/\s+/);if(_0x3f94e5[_0x16da6c(0x14c)]!==0x2){await this[_0x16da6c(0x1ed)]?.['sendMessage'](_0x1dd6c7,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x16da6c(0x1be)+'Example:\x0a'+_0x16da6c(0x1c3)+(_0x16da6c(0x224)+_0x3f94e5[_0x16da6c(0x14c)]+_0x16da6c(0x18e)+_0x3f94e5[_0x16da6c(0x1a2)](_0x2f302a=>'`'+_0x2f302a+'`')[_0x16da6c(0x151)](',\x20')),{'parse_mode':_0x16da6c(0x154)});return;}const [_0x10960b,_0x32b3a0]=_0x3f94e5;console[_0x16da6c(0x17c)](_0x16da6c(0x208)+_0x428045+':\x20username=\x22'+_0x10960b+_0x16da6c(0x183)+_0x32b3a0['substring'](0x0,0xa)+_0x16da6c(0x213)),await this['handleSingleLineVerification'](_0x1dd6c7,_0x428045,_0x10960b,_0x32b3a0);}catch(_0x2c4f51){console[_0x16da6c(0x16d)](_0x16da6c(0x189),_0x2c4f51),await this[_0x16da6c(0x1ed)]?.['sendMessage'](_0x1dd6c7,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['on']('error',_0xd652c4=>{const _0x66d9fd=_0x3e8912;console[_0x66d9fd(0x16d)]('Telegram\x20bot\x20error:',_0xd652c4);}),this[_0x3e8912(0x1ed)]['on']('polling_error',_0x56f725=>{const _0x567e12=_0x3e8912;console[_0x567e12(0x16d)]('Telegram\x20bot\x20polling\x20error:',_0x56f725);});}async[a54_0x3f3248(0x181)](_0x7e2ce7,_0x350f00,_0x57b20d,_0x208cf9){const _0x4c29a9=a54_0x3f3248;try{console[_0x4c29a9(0x17c)](_0x4c29a9(0x208)+_0x350f00+_0x4c29a9(0x1ae)+_0x57b20d+_0x4c29a9(0x183)+_0x208cf9[_0x4c29a9(0x15d)](0x0,0xa)+'...\x22');if(!_0x57b20d||_0x57b20d[_0x4c29a9(0x14c)]<0x3||_0x57b20d[_0x4c29a9(0x14c)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x4c29a9(0x166)](_0x57b20d)){await this[_0x4c29a9(0x1ed)]?.['sendMessage'](_0x7e2ce7,_0x4c29a9(0x1d6)+_0x57b20d+_0x4c29a9(0x1d5)+_0x4c29a9(0x1e9),{'parse_mode':_0x4c29a9(0x154)});return;}if(!_0x208cf9||!_0x208cf9['startsWith'](_0x4c29a9(0x173))&&!_0x208cf9[_0x4c29a9(0x1e1)](_0x4c29a9(0x1ac))){await this['bot']?.[_0x4c29a9(0x1db)](_0x7e2ce7,_0x4c29a9(0x20a)+_0x4c29a9(0x1fc),{'parse_mode':_0x4c29a9(0x154)});return;}const _0x443ec3=await database_1[_0x4c29a9(0x1bd)][_0x4c29a9(0x1f6)][_0x4c29a9(0x221)]({'where':{'username':_0x57b20d},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x443ec3){const _0x272828=await database_1[_0x4c29a9(0x1bd)]['shop'][_0x4c29a9(0x161)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x3484e0=_0x4c29a9(0x17f)+_0x57b20d+_0x4c29a9(0x16c);_0x272828[_0x4c29a9(0x14c)]>0x0?(_0x3484e0+=_0x4c29a9(0x17d),_0x272828[_0x4c29a9(0x1d3)](_0x25fa6e=>{const _0x54e47d=_0x4c29a9;_0x3484e0+=_0x54e47d(0x1d7)+_0x25fa6e['username']+_0x54e47d(0x168)+_0x25fa6e['name']+')\x0a';}),_0x3484e0+=_0x4c29a9(0x180)):_0x3484e0+=_0x4c29a9(0x1f4);await this[_0x4c29a9(0x1ed)]?.['sendMessage'](_0x7e2ce7,_0x3484e0,{'parse_mode':'Markdown'});return;}if(_0x443ec3['status']!==_0x4c29a9(0x1af)){await this['bot']?.[_0x4c29a9(0x1db)](_0x7e2ce7,_0x4c29a9(0x1e5)+_0x57b20d+_0x4c29a9(0x1c1)+_0x4c29a9(0x196),{'parse_mode':_0x4c29a9(0x154)});return;}if(_0x443ec3[_0x4c29a9(0x1f5)]!==_0x208cf9&&_0x443ec3[_0x4c29a9(0x21f)]!==_0x208cf9){await this[_0x4c29a9(0x1ed)]?.[_0x4c29a9(0x1db)](_0x7e2ce7,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x57b20d+'`.\x0a\x0a'+_0x4c29a9(0x1eb)+_0x4c29a9(0x1b2),{'parse_mode':_0x4c29a9(0x154)});return;}const _0x537beb=await database_1[_0x4c29a9(0x1bd)][_0x4c29a9(0x1fa)][_0x4c29a9(0x218)]({'where':{'shopId':_0x443ec3['id'],'isVerified':!![],'telegramId':{'not':_0x350f00}}});if(_0x537beb){await this[_0x4c29a9(0x1ed)]?.[_0x4c29a9(0x1db)](_0x7e2ce7,_0x4c29a9(0x1ea)+_0x57b20d+_0x4c29a9(0x20f)+_0x4c29a9(0x177),{'parse_mode':'Markdown'});return;}await database_1[_0x4c29a9(0x1bd)][_0x4c29a9(0x1fa)][_0x4c29a9(0x19c)]({'where':{'telegramId':_0x350f00},'data':{'shopId':_0x443ec3['id'],'isVerified':!![]}}),await this['bot']?.['sendMessage'](_0x7e2ce7,_0x4c29a9(0x139)+_0x4c29a9(0x198)+(_0x4c29a9(0x1dd)+_0x443ec3[_0x4c29a9(0x187)]+'*\x0a')+(_0x4c29a9(0x200)+_0x443ec3['username']+_0x4c29a9(0x1d5))+_0x4c29a9(0x1ad)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+_0x4c29a9(0x1b7)+_0x4c29a9(0x1c4)+_0x4c29a9(0x1bb)+'/status\x20-\x20check\x20connection\x20status\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x4c29a9(0x154)}),console[_0x4c29a9(0x17c)](_0x4c29a9(0x214)+_0x350f00+_0x4c29a9(0x1d2)+_0x443ec3[_0x4c29a9(0x21b)]+_0x4c29a9(0x16a));}catch(_0x15b0e2){console[_0x4c29a9(0x16d)](_0x4c29a9(0x150),_0x15b0e2),await this[_0x4c29a9(0x1ed)]?.[_0x4c29a9(0x1db)](_0x7e2ce7,_0x4c29a9(0x17e));}}async[a54_0x3f3248(0x194)](_0x437899,_0x5b4229,_0x2bffce){const _0x224a1e=a54_0x3f3248;if(!this[_0x224a1e(0x1ed)]){console[_0x224a1e(0x15e)](_0x224a1e(0x219));return;}try{const _0xa7702e=await database_1[_0x224a1e(0x1bd)][_0x224a1e(0x1fa)][_0x224a1e(0x161)]({'where':{'shopId':_0x437899,'isVerified':!![]}});if(_0xa7702e[_0x224a1e(0x14c)]===0x0){console[_0x224a1e(0x17c)](_0x224a1e(0x1de)+_0x437899);return;}const _0x1ef715=_0xa7702e[_0x224a1e(0x1a2)](async _0x5f2f7b=>{const _0x44ba74=_0x224a1e;try{await this[_0x44ba74(0x1ed)]?.[_0x44ba74(0x1db)](_0x5f2f7b['telegramId'],_0x5b4229,_0x2bffce),console[_0x44ba74(0x17c)](_0x44ba74(0x16e)+_0x5f2f7b[_0x44ba74(0x142)]);}catch(_0x4e1735){console[_0x44ba74(0x16d)](_0x44ba74(0x1b0)+_0x5f2f7b[_0x44ba74(0x142)]+':',_0x4e1735),_0x4e1735 instanceof Error&&(_0x4e1735[_0x44ba74(0x1dc)][_0x44ba74(0x14d)]('blocked')||_0x4e1735[_0x44ba74(0x1dc)]['includes']('chat\x20not\x20found')||_0x4e1735[_0x44ba74(0x1dc)]['includes'](_0x44ba74(0x1f1)))&&(await database_1['default']['telegramUser']['update']({'where':{'id':_0x5f2f7b['id']},'data':{'isVerified':![]}}),console[_0x44ba74(0x17c)](_0x44ba74(0x14f)+_0x5f2f7b[_0x44ba74(0x142)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x224a1e(0x1b6)](_0x1ef715);}catch(_0x2e7455){console[_0x224a1e(0x16d)]('Error\x20sending\x20shop\x20notification:',_0x2e7455);}}async[a54_0x3f3248(0x170)](_0x19c790,_0x536bf1,_0x3d09ed){const _0x20fe2e=a54_0x3f3248,_0x2e5198={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x4b3d27={'created':_0x20fe2e(0x167),'paid':'Payment\x20successfully\x20paid','failed':_0x20fe2e(0x18f),'expired':_0x20fe2e(0x20c),'refund':_0x20fe2e(0x13d),'chargeback':_0x20fe2e(0x144),'processing':_0x20fe2e(0x172)},_0x59eb55=_0x2e5198[_0x3d09ed],_0x3b0425=_0x4b3d27[_0x3d09ed],_0x29db2c=(0x0,gateway_1[_0x20fe2e(0x1d8)])(_0x536bf1['gateway']);console[_0x20fe2e(0x17c)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x536bf1[_0x20fe2e(0x19a)]+_0x20fe2e(0x211)+_0x29db2c+'\x22');let _0x140c52=_0x59eb55+'\x20*'+_0x3b0425+_0x20fe2e(0x158)+(_0x20fe2e(0x1f8)+_0x536bf1['amount']+'\x20'+_0x536bf1[_0x20fe2e(0x18b)]+'*\x0a')+(_0x20fe2e(0x156)+(_0x536bf1['orderId']||_0x536bf1['id'])+'`\x0a')+(_0x20fe2e(0x164)+_0x536bf1['id']+'`\x0a')+(_0x20fe2e(0x1c9)+_0x29db2c+'`\x0a')+(_0x20fe2e(0x184)+new Date(_0x536bf1['createdAt'])['toLocaleString'](_0x20fe2e(0x1a7))+'\x0a');(_0x536bf1[_0x20fe2e(0x195)]||_0x536bf1[_0x20fe2e(0x207)])&&(_0x140c52+=_0x20fe2e(0x153),_0x536bf1['customerName']&&(_0x140c52+='📛\x20Name:\x20`'+_0x536bf1[_0x20fe2e(0x195)]+'`\x0a'),_0x536bf1[_0x20fe2e(0x207)]&&(_0x140c52+=_0x20fe2e(0x223)+_0x536bf1[_0x20fe2e(0x207)]+'`\x0a')),_0x3d09ed===_0x20fe2e(0x157)&&_0x536bf1[_0x20fe2e(0x1f0)]&&(_0x140c52+=_0x20fe2e(0x1ec)+_0x536bf1[_0x20fe2e(0x1f0)]+_0x20fe2e(0x1e6)),_0x3d09ed===_0x20fe2e(0x16f)&&(_0x140c52+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x536bf1[_0x20fe2e(0x1ef)]&&(_0x140c52+=_0x20fe2e(0x203)+_0x536bf1[_0x20fe2e(0x1ef)]+'\x0a'),await this[_0x20fe2e(0x194)](_0x19c790,_0x140c52,{'parse_mode':_0x20fe2e(0x154)});}async[a54_0x3f3248(0x179)](_0x1e72a9,_0xbf5258,_0x37c66a){const _0x2d82a2=a54_0x3f3248,_0x17484d={'created':'📤','completed':'✅','rejected':'❌'},_0x19b213={'created':_0x2d82a2(0x1ba),'completed':_0x2d82a2(0x1df),'rejected':_0x2d82a2(0x21c)},_0x4fa988=_0x17484d[_0x37c66a],_0x4b26f8=_0x19b213[_0x37c66a],_0x6d2cf8=_0x4fa988+'\x20*'+_0x4b26f8+_0x2d82a2(0x158)+(_0x2d82a2(0x140)+_0xbf5258['amount']+_0x2d82a2(0x1b1))+(_0x2d82a2(0x1c6)+_0xbf5258[_0x2d82a2(0x20e)]+'`\x0a')+(_0x2d82a2(0x160)+_0xbf5258['id']+'`\x0a')+(_0x2d82a2(0x184)+new Date(_0xbf5258['createdAt'])[_0x2d82a2(0x1d9)](_0x2d82a2(0x1a7))+'\x0a')+(_0xbf5258['txid']?_0x2d82a2(0x1f7)+_0xbf5258[_0x2d82a2(0x1d1)]+'`':'');await this[_0x2d82a2(0x194)](_0x1e72a9,_0x6d2cf8,{'parse_mode':_0x2d82a2(0x154)});}async['sendLoginNotification'](_0x486693,_0x407824){const _0x3013b5=a54_0x3f3248;try{const _0xbb3b38=await database_1[_0x3013b5(0x1bd)][_0x3013b5(0x1c2)][_0x3013b5(0x221)]({'where':{'shopId':_0x486693},'select':{'notificationLogin':!![]}});if(!_0xbb3b38?.[_0x3013b5(0x145)]){console[_0x3013b5(0x17c)](_0x3013b5(0x209)+_0x486693);return;}const _0x841d2=_0x407824[_0x3013b5(0x13e)]?'🔐':'🚨',_0x3b3a61=_0x407824[_0x3013b5(0x13e)]?_0x3013b5(0x1ee):_0x3013b5(0x202);let _0x2ed74b=_0x841d2+'\x20*'+_0x3b3a61+_0x3013b5(0x158)+('👤\x20Username:\x20`'+_0x407824[_0x3013b5(0x21b)]+'`\x0a')+(_0x3013b5(0x1d0)+_0x407824[_0x3013b5(0x1ce)][_0x3013b5(0x1d9)](_0x3013b5(0x1a7))+'\x0a');_0x407824[_0x3013b5(0x1c7)]&&(_0x2ed74b+=_0x3013b5(0x13b)+_0x407824[_0x3013b5(0x1c7)]+'`\x0a');if(_0x407824[_0x3013b5(0x176)]){const _0x3b7ff0=_0x407824[_0x3013b5(0x176)]['length']>0x32?_0x407824[_0x3013b5(0x176)][_0x3013b5(0x15d)](0x0,0x32)+_0x3013b5(0x210):_0x407824[_0x3013b5(0x176)];_0x2ed74b+=_0x3013b5(0x1d4)+_0x3b7ff0+'`\x0a';}!_0x407824[_0x3013b5(0x13e)]&&(_0x2ed74b+=_0x3013b5(0x152)),await this[_0x3013b5(0x194)](_0x486693,_0x2ed74b,{'parse_mode':_0x3013b5(0x154)}),console['log'](_0x3013b5(0x1c5)+_0x486693+':\x20'+(_0x407824[_0x3013b5(0x13e)]?'success':_0x3013b5(0x15a)));}catch(_0x3df2d5){console[_0x3013b5(0x16d)](_0x3013b5(0x199),_0x3df2d5);}}async[a54_0x3f3248(0x18d)](_0x4b1fc9,_0x5db694){const _0x18fb91=a54_0x3f3248;try{const _0xf2a7b3=await database_1[_0x18fb91(0x1bd)][_0x18fb91(0x1c2)][_0x18fb91(0x221)]({'where':{'shopId':_0x4b1fc9},'select':{'notificationApiError':!![]}});if(!_0xf2a7b3?.['notificationApiError']){console[_0x18fb91(0x17c)](_0x18fb91(0x15c)+_0x4b1fc9);return;}let _0x4ab1a2=_0x18fb91(0x1cc)+(_0x18fb91(0x1a0)+_0x5db694['method']+'\x20'+_0x5db694['endpoint']+'`\x0a')+(_0x18fb91(0x1d0)+_0x5db694[_0x18fb91(0x1ce)]['toLocaleString'](_0x18fb91(0x1a7))+'\x0a');_0x5db694['statusCode']&&(_0x4ab1a2+=_0x18fb91(0x1e0)+_0x5db694[_0x18fb91(0x21d)]+'`\x0a'),_0x4ab1a2+=_0x18fb91(0x197)+_0x5db694[_0x18fb91(0x1cf)]+'`\x0a',_0x5db694['requestId']&&(_0x4ab1a2+=_0x18fb91(0x205)+_0x5db694[_0x18fb91(0x217)]+'`\x0a'),_0x4ab1a2+=_0x18fb91(0x169),await this[_0x18fb91(0x194)](_0x4b1fc9,_0x4ab1a2,{'parse_mode':'Markdown'}),console[_0x18fb91(0x17c)](_0x18fb91(0x15b)+_0x4b1fc9+':\x20'+_0x5db694['endpoint']);}catch(_0x21c667){console[_0x18fb91(0x16d)](_0x18fb91(0x1a9),_0x21c667);}}async[a54_0x3f3248(0x190)](_0x4bee5d,_0x157bc0,_0x4d4a9b){const _0x5c6486=a54_0x3f3248;let _0x3de792=_0x5c6486(0x1c0)+_0x157bc0+_0x5c6486(0x158);for(const [_0x2df8b0,_0x458143]of Object[_0x5c6486(0x15f)](_0x4d4a9b)){_0x458143!==null&&_0x458143!==undefined&&(_0x3de792+=_0x2df8b0+_0x5c6486(0x149)+_0x458143+'`\x0a');}await this['sendShopNotification'](_0x4bee5d,_0x3de792,{'parse_mode':'Markdown'});}[a54_0x3f3248(0x159)](){const _0x4f3e4a=a54_0x3f3248;return{'isActive':!!this[_0x4f3e4a(0x1ed)],'username':this[_0x4f3e4a(0x17b)]};}[a54_0x3f3248(0x1cb)](){const _0x54d06a=a54_0x3f3248;this['bot']&&(this[_0x54d06a(0x1ed)][_0x54d06a(0x1b3)](),this[_0x54d06a(0x1ed)]=null,console[_0x54d06a(0x17c)](_0x54d06a(0x163)));}}exports[a54_0x3f3248(0x18c)]=TelegramBotService,exports[a54_0x3f3248(0x1a1)]=new TelegramBotService();