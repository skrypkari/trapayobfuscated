'use strict';function a59_0x37f1(){const _0x3583e5=['📅\x20Date:\x20','85477LexCfT','📱\x20Telegram\x20notification:\x20gateway\x20\x22','__importDefault','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','test','findMany','env','chargeback','setupBotHandlers','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','\x20verified\x20for\x20shop\x20','updatedAt','defineProperty','sendShopNotification','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','customerUa','510207npYgsg','🔔\x20Notifications\x20are\x20active\x0a\x0a','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','🆔\x20Request\x20ID:\x20`','*.\x0a\x0a','remitterIban','method','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','🆔\x20Payment\x20ID:\x20`','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','📊\x20Error\x20code:\x20`','Available\x20usernames:\x0a','🔌\x20User\x20','chat','Error\x20handling\x20/disconnect\x20command:','map','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','\x20USD*\x0a','❌\x20Invalid\x20username\x20format:\x20`','...\x22','5408784daffCn','adminNotes','`.\x0a\x0a','Payment\x20successfully\x20paid','`\x0a\x0a','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','To\x20reconnect,\x20use\x20the\x20/start\x20command','gateway','sendLoginNotification','statusCode','notificationApiError','New\x20payout\x20created','shop','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','shopId','Commands:\x0a','create','📅\x20Connection\x20date:\x20','timestamp','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','\x20initialized\x20successfully','4535358ZoBugW','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','success','🚨\x20*API\x20Error*\x0a\x0a','ipAddress','telegramId','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','sk_','trapay_bot','•\x20Payment\x20status\x20changes\x0a','💰\x20Amount:\x20*','...`\x0a\x0a','txid','split','❌\x20Error\x20getting\x20debug\x20information.','Successful\x20login','length','📅\x20Time:\x20','Failed\x20login\x20attempt','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','sendMessage','\x0a👤\x20*Customer\x20Information:*\x0a','Error\x20in\x20handleSingleLineVerification:','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','Payment\x20failed','customerName','message','📱\x20Shop:\x20*','trim','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','telegramBotService','8ToiGjg','\x20via\x20single-line\x20input','`\x20is\x20inactive.\x0a\x0a','findUnique','📱\x20Your\x20Telegram\x20ID:\x20`','onText','requestId','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','notificationLogin','📝\x20Order\x20ID:\x20`','🔗\x20Endpoint:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','en-US','📧\x20Email:\x20`','name','toLocaleString','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','🌐\x20IP\x20address:\x20`','New\x20payment\x20created','pk_','Username:\x20`','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','Example:\x0a','•\x20`','Payout\x20completed','telegramUser','first_name','polling_error','user\x20is\x20deactivated','orderId','bot','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','4ExCoiK','isVerified','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','Telegram\x20bot\x20polling\x20error:','from','❌\x20Shop\x20`','toLocaleDateString','🏦\x20Method:\x20`','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Use\x20/start\x20to\x20connect.','sendApiErrorNotification','customerEmail','✅\x20Connected\x20to\x20shop:\x20*','sendPayoutNotification','sendPaymentNotification','TelegramBotService','status','\x20USDT*\x0a','✅\x20Welcome\x20back!\x0a\x0a','publicKey','getBotInfo','secretKey','TELEGRAM_BOT_TOKEN','toString','username','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','Failed\x20to\x20send\x20API\x20error\x20notification:','❌\x20Error:\x20`','Payment\x20expired','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','📛\x20Name:\x20`','shopSettings','sendCustomNotification','ACTIVE','customerIp','\x20(@',':\x20`','endpoint','log','🏪\x20Available\x20shops\x20in\x20system:\x0a','/status\x20-\x20check\x20connection\x20status\x0a','•\x20New\x20payments\x0a','💸\x20Amount:\x20*','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','Payment\x20is\x20being\x20processed','Payout\x20rejected','💻\x20Browser:\x20`','•\x20Payouts\x0a','default','`\x20not\x20found.\x0a\x0a','Error\x20handling\x20/status\x20command:','🏦\x20IBAN:\x20`','botUsername','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Payment\x20chargeback','update','🛑\x20Telegram\x20bot\x20stopped','text','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','error','failed','❌\x20Please\x20use\x20/start\x20command\x20first','💸\x20Penalty\x20amount:\x20*','substring','forEach','startsWith','__esModule','🔗\x20TXID:\x20`','👤\x20Username:\x20`','1577380tZCCZo','*\x0a\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','stopPolling','User\x20','759512zRYKAV','...','Failed\x20to\x20send\x20login\x20notification:','Check\x20spelling\x20and\x20try\x20again.','chat\x20not\x20found','userAgent','10TcDOtW','Contact\x20administrator.','unknown\x20shop','•\x20Payouts\x0a\x0a','TELEGRAM_BOT_USERNAME','Markdown','currency','📊\x20*Connection\x20Status*\x0a\x0a','You\x20sent\x20','handleSingleLineVerification','botToken','last_name','`\x20(','940092DCWzpo','includes','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',':\x20username=\x22','\x22,\x20apiKey=\x22','amount','\x20\x20\x20Username:\x20`','Error\x20sending\x20shop\x20notification:','/disconnect\x20-\x20disconnect\x20from\x20notifications','Error\x20handling\x20message:'];a59_0x37f1=function(){return _0x3583e5;};return a59_0x37f1();}const a59_0x4f65cb=a59_0x456c;(function(_0x1ef204,_0x1f4fc7){const _0xc004ec=a59_0x456c,_0x1c45da=_0x1ef204();while(!![]){try{const _0x2185b3=parseInt(_0xc004ec(0x133))/0x1+parseInt(_0xc004ec(0x104))/0x2+-parseInt(_0xc004ec(0x117))/0x3*(parseInt(_0xc004ec(0xba))/0x4)+-parseInt(_0xc004ec(0xff))/0x5+parseInt(_0xc004ec(0x15d))/0x6+parseInt(_0xc004ec(0x122))/0x7*(-parseInt(_0xc004ec(0x17c))/0x8)+parseInt(_0xc004ec(0x147))/0x9*(-parseInt(_0xc004ec(0x10a))/0xa);if(_0x2185b3===_0x1f4fc7)break;else _0x1c45da['push'](_0x1c45da['shift']());}catch(_0x39fe84){_0x1c45da['push'](_0x1c45da['shift']());}}}(a59_0x37f1,0x62975));var __importDefault=this&&this[a59_0x4f65cb(0x124)]||function(_0x7babd5){const _0x59297f=a59_0x4f65cb;return _0x7babd5&&_0x7babd5[_0x59297f(0xfc)]?_0x7babd5:{'default':_0x7babd5};};Object[a59_0x4f65cb(0x12e)](exports,a59_0x4f65cb(0xfc),{'value':!![]}),exports[a59_0x4f65cb(0x17b)]=exports[a59_0x4f65cb(0xc9)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require('../config/database')),gateway_1=require('../types/gateway');function a59_0x456c(_0x57de27,_0x13ef08){const _0x37f112=a59_0x37f1();return a59_0x456c=function(_0x456c98,_0x18b010){_0x456c98=_0x456c98-0xb0;let _0x53b2c1=_0x37f112[_0x456c98];return _0x53b2c1;},a59_0x456c(_0x57de27,_0x13ef08);}class TelegramBotService{constructor(){const _0x2f8290=a59_0x4f65cb;this[_0x2f8290(0xb8)]=null,this[_0x2f8290(0x114)]=process[_0x2f8290(0x128)][_0x2f8290(0xd0)]||'',this['botUsername']=process[_0x2f8290(0x128)][_0x2f8290(0x10e)]||_0x2f8290(0x165),this['botToken']?this['initializeBot']():console['warn'](_0x2f8290(0x130));}['initializeBot'](){const _0x3f5dbd=a59_0x4f65cb;try{this[_0x3f5dbd(0xb8)]=new node_telegram_bot_api_1[(_0x3f5dbd(0xea))](this[_0x3f5dbd(0x114)],{'polling':!![]}),this[_0x3f5dbd(0x12a)](),console[_0x3f5dbd(0xe0)]('✅\x20Telegram\x20bot\x20@'+this[_0x3f5dbd(0xee)]+_0x3f5dbd(0x15c));}catch(_0x42a5ed){console[_0x3f5dbd(0xf5)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x42a5ed);}}[a59_0x4f65cb(0x12a)](){const _0x52adbd=a59_0x4f65cb;if(!this[_0x52adbd(0xb8)])return;this[_0x52adbd(0xb8)][_0x52adbd(0x181)](/\/start/,async _0xb71aa5=>{const _0x405bae=_0x52adbd,_0x4ea9c6=_0xb71aa5[_0x405bae(0x140)]['id'],_0x181dc1=_0xb71aa5[_0x405bae(0xbe)]?.['id'][_0x405bae(0xd1)](),_0x117f97=_0xb71aa5['from']?.[_0x405bae(0xd2)],_0x1c1b91=_0xb71aa5[_0x405bae(0xbe)]?.[_0x405bae(0xb4)],_0x1e6504=_0xb71aa5[_0x405bae(0xbe)]?.[_0x405bae(0x115)];if(!_0x181dc1)return;try{let _0x58eab8=await database_1[_0x405bae(0xea)]['telegramUser'][_0x405bae(0x17f)]({'where':{'telegramId':_0x181dc1},'include':{'shop':!![]}});!_0x58eab8?(_0x58eab8=await database_1[_0x405bae(0xea)][_0x405bae(0xb3)][_0x405bae(0x158)]({'data':{'telegramId':_0x181dc1,'username':_0x117f97,'firstName':_0x1c1b91,'lastName':_0x1e6504,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x405bae(0xe0)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x181dc1+_0x405bae(0xdd)+_0x117f97+')')):_0x58eab8=await database_1[_0x405bae(0xea)][_0x405bae(0xb3)][_0x405bae(0xf1)]({'where':{'telegramId':_0x181dc1},'data':{'username':_0x117f97,'firstName':_0x1c1b91,'lastName':_0x1e6504},'include':{'shop':!![]}}),_0x58eab8['isVerified']&&_0x58eab8[_0x405bae(0x156)]&&_0x58eab8['shop']?await this[_0x405bae(0xb8)]?.['sendMessage'](_0x4ea9c6,_0x405bae(0xcc)+(_0x405bae(0x18c)+_0x58eab8['shop'][_0x405bae(0x18a)]+'*\x0a')+(_0x405bae(0x190)+_0x58eab8[_0x405bae(0x153)][_0x405bae(0xd2)]+'`\x0a\x0a')+_0x405bae(0xef)+_0x405bae(0xe3)+_0x405bae(0x166)+_0x405bae(0x10d)+_0x405bae(0x157)+_0x405bae(0xe2)+_0x405bae(0x11f),{'parse_mode':_0x405bae(0x10f)}):(_0x58eab8[_0x405bae(0x156)]&&!_0x58eab8['isVerified']&&(await database_1[_0x405bae(0xea)][_0x405bae(0xb3)]['update']({'where':{'telegramId':_0x181dc1},'data':{'shopId':null,'isVerified':![]}}),console[_0x405bae(0xe0)](_0x405bae(0x135)+_0x181dc1)),await this['bot']?.[_0x405bae(0x171)](_0x4ea9c6,_0x405bae(0xe5)+_0x405bae(0x170)+_0x405bae(0xc2)+'Example:\x0a'+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x405bae(0x119),{'parse_mode':_0x405bae(0x10f)}));}catch(_0x2df89e){console[_0x405bae(0xf5)]('Error\x20handling\x20/start\x20command:',_0x2df89e),await this[_0x405bae(0xb8)]?.[_0x405bae(0x171)](_0x4ea9c6,_0x405bae(0x191));}}),this['bot']['onText'](/\/disconnect/,async _0xffc5c8=>{const _0x52e87f=_0x52adbd,_0x44e1bb=_0xffc5c8[_0x52e87f(0x140)]['id'],_0x32310b=_0xffc5c8['from']?.['id'][_0x52e87f(0xd1)]();if(!_0x32310b)return;try{const _0x515114=await database_1[_0x52e87f(0xea)][_0x52e87f(0xb3)][_0x52e87f(0x17f)]({'where':{'telegramId':_0x32310b},'include':{'shop':!![]}});if(!_0x515114||!_0x515114['isVerified']||!_0x515114[_0x52e87f(0x156)]){await this[_0x52e87f(0xb8)]?.['sendMessage'](_0x44e1bb,_0x52e87f(0x187));return;}const _0x24496c=_0x515114[_0x52e87f(0x153)]?.[_0x52e87f(0x18a)]||_0x52e87f(0x10c);await database_1[_0x52e87f(0xea)][_0x52e87f(0xb3)]['update']({'where':{'telegramId':_0x32310b},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x52e87f(0x13f)+_0x32310b+'\x20disconnected\x20from\x20shop\x20'+_0x515114[_0x52e87f(0x156)]),await this[_0x52e87f(0xb8)]?.[_0x52e87f(0x171)](_0x44e1bb,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x24496c+_0x52e87f(0x137)+_0x52e87f(0x14d),{'parse_mode':_0x52e87f(0x10f)});}catch(_0x44697e){console['error'](_0x52e87f(0x141),_0x44697e),await this[_0x52e87f(0xb8)]?.['sendMessage'](_0x44e1bb,_0x52e87f(0x191));}}),this['bot'][_0x52adbd(0x181)](/\/status/,async _0x275033=>{const _0x5a5dc4=_0x52adbd,_0x26e924=_0x275033[_0x5a5dc4(0x140)]['id'],_0x4cbbd5=_0x275033[_0x5a5dc4(0xbe)]?.['id'][_0x5a5dc4(0xd1)]();if(!_0x4cbbd5)return;try{const _0x5aebea=await database_1[_0x5a5dc4(0xea)][_0x5a5dc4(0xb3)][_0x5a5dc4(0x17f)]({'where':{'telegramId':_0x4cbbd5},'include':{'shop':!![]}});if(!_0x5aebea){await this[_0x5a5dc4(0xb8)]?.['sendMessage'](_0x26e924,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+'Use\x20/start\x20to\x20begin.');return;}if(!_0x5aebea[_0x5a5dc4(0xbb)]||!_0x5aebea[_0x5a5dc4(0x156)]||!_0x5aebea[_0x5a5dc4(0x153)]){await this[_0x5a5dc4(0xb8)]?.[_0x5a5dc4(0x171)](_0x26e924,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x5a5dc4(0xc3));return;}await this[_0x5a5dc4(0xb8)]?.['sendMessage'](_0x26e924,_0x5a5dc4(0x111)+(_0x5a5dc4(0xc6)+_0x5aebea[_0x5a5dc4(0x153)][_0x5a5dc4(0x18a)]+'*\x0a')+(_0x5a5dc4(0xfe)+_0x5aebea[_0x5a5dc4(0x153)][_0x5a5dc4(0xd2)]+'`\x0a')+(_0x5a5dc4(0x159)+_0x5aebea[_0x5a5dc4(0x12d)][_0x5a5dc4(0xc0)]('en-US')+'\x0a\x0a')+_0x5a5dc4(0x134)+_0x5a5dc4(0x157)+_0x5a5dc4(0x11f),{'parse_mode':_0x5a5dc4(0x10f)});}catch(_0x4dd13c){console[_0x5a5dc4(0xf5)](_0x5a5dc4(0xec),_0x4dd13c),await this[_0x5a5dc4(0xb8)]?.[_0x5a5dc4(0x171)](_0x26e924,_0x5a5dc4(0x191));}}),this[_0x52adbd(0xb8)][_0x52adbd(0x181)](/\/debug/,async _0x337580=>{const _0x5c5fd4=_0x52adbd,_0x26776c=_0x337580['chat']['id'],_0x31fa11=_0x337580[_0x5c5fd4(0xbe)]?.['id'][_0x5c5fd4(0xd1)]();if(!_0x31fa11)return;try{const _0x1a2910=await database_1[_0x5c5fd4(0xea)][_0x5c5fd4(0x153)][_0x5c5fd4(0x127)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4189ac='🔍\x20*Debug\x20Information*\x0a\x0a';_0x4189ac+=_0x5c5fd4(0x180)+_0x31fa11+_0x5c5fd4(0x14b),_0x4189ac+=_0x5c5fd4(0xe1),_0x1a2910[_0x5c5fd4(0xfa)]((_0x379543,_0x36b178)=>{const _0x9cc61b=_0x5c5fd4;_0x4189ac+=_0x36b178+0x1+'.\x20*'+_0x379543[_0x9cc61b(0x18a)]+'*\x0a',_0x4189ac+=_0x9cc61b(0x11d)+_0x379543[_0x9cc61b(0xd2)]+'`\x0a',_0x4189ac+='\x20\x20\x20Status:\x20'+_0x379543[_0x9cc61b(0xca)]+'\x0a',_0x4189ac+='\x20\x20\x20Public\x20Key:\x20`'+_0x379543['publicKey'][_0x9cc61b(0xf9)](0x0,0xf)+_0x9cc61b(0x168);}),await this[_0x5c5fd4(0xb8)]?.['sendMessage'](_0x26776c,_0x4189ac,{'parse_mode':_0x5c5fd4(0x10f)});}catch(_0x1bd3e3){console[_0x5c5fd4(0xf5)]('Error\x20handling\x20/debug\x20command:',_0x1bd3e3),await this[_0x5c5fd4(0xb8)]?.[_0x5c5fd4(0x171)](_0x26776c,_0x5c5fd4(0x16b));}}),this[_0x52adbd(0xb8)]['on'](_0x52adbd(0x177),async _0x5b0108=>{const _0x50fbc7=_0x52adbd;if(_0x5b0108[_0x50fbc7(0xf3)]?.[_0x50fbc7(0xfb)]('/'))return;const _0x34cb9a=_0x5b0108[_0x50fbc7(0x140)]['id'],_0x3a8768=_0x5b0108[_0x50fbc7(0xbe)]?.['id'][_0x50fbc7(0xd1)](),_0x11e934=_0x5b0108[_0x50fbc7(0xf3)]?.[_0x50fbc7(0x179)]();if(!_0x3a8768||!_0x11e934)return;try{const _0x1d215f=await database_1['default'][_0x50fbc7(0xb3)][_0x50fbc7(0x17f)]({'where':{'telegramId':_0x3a8768},'include':{'shop':!![]}});if(!_0x1d215f){await this[_0x50fbc7(0xb8)]?.['sendMessage'](_0x34cb9a,_0x50fbc7(0xf7));return;}if(_0x1d215f[_0x50fbc7(0xbb)]&&_0x1d215f[_0x50fbc7(0x156)]&&_0x1d215f['shop']){await this[_0x50fbc7(0xb8)]?.[_0x50fbc7(0x171)](_0x34cb9a,_0x50fbc7(0x17a)+_0x1d215f[_0x50fbc7(0x153)][_0x50fbc7(0x18a)]+_0x50fbc7(0x137)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x50fbc7(0x10f)});return;}const _0x338efd=_0x11e934[_0x50fbc7(0x16a)](/\s+/);if(_0x338efd[_0x50fbc7(0x16d)]!==0x2){await this[_0x50fbc7(0xb8)]?.['sendMessage'](_0x34cb9a,_0x50fbc7(0x163)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x50fbc7(0xb0)+_0x50fbc7(0x13a)+(_0x50fbc7(0x112)+_0x338efd[_0x50fbc7(0x16d)]+'\x20parts:\x20'+_0x338efd[_0x50fbc7(0x142)](_0x31adbb=>'`'+_0x31adbb+'`')['join'](',\x20')),{'parse_mode':_0x50fbc7(0x10f)});return;}const [_0x57551a,_0x3d11cf]=_0x338efd;console[_0x50fbc7(0xe0)](_0x50fbc7(0x12b)+_0x3a8768+_0x50fbc7(0x11a)+_0x57551a+'\x22,\x20apiKey=\x22'+_0x3d11cf[_0x50fbc7(0xf9)](0x0,0xa)+_0x50fbc7(0x146)),await this['handleSingleLineVerification'](_0x34cb9a,_0x3a8768,_0x57551a,_0x3d11cf);}catch(_0x166e9f){console[_0x50fbc7(0xf5)](_0x50fbc7(0x120),_0x166e9f),await this[_0x50fbc7(0xb8)]?.[_0x50fbc7(0x171)](_0x34cb9a,_0x50fbc7(0x191));}}),this[_0x52adbd(0xb8)]['on'](_0x52adbd(0xf5),_0x26a4b2=>{const _0x2ff517=_0x52adbd;console[_0x2ff517(0xf5)]('Telegram\x20bot\x20error:',_0x26a4b2);}),this[_0x52adbd(0xb8)]['on'](_0x52adbd(0xb5),_0x5ae7ad=>{const _0x20ff95=_0x52adbd;console[_0x20ff95(0xf5)](_0x20ff95(0xbd),_0x5ae7ad);});}async[a59_0x4f65cb(0x113)](_0x25254c,_0x276bcf,_0xa9d089,_0x6b5c4c){const _0x235040=a59_0x4f65cb;try{console['log'](_0x235040(0x12b)+_0x276bcf+_0x235040(0x11a)+_0xa9d089+_0x235040(0x11b)+_0x6b5c4c[_0x235040(0xf9)](0x0,0xa)+'...\x22');if(!_0xa9d089||_0xa9d089['length']<0x3||_0xa9d089[_0x235040(0x16d)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x235040(0x126)](_0xa9d089)){await this[_0x235040(0xb8)]?.[_0x235040(0x171)](_0x25254c,_0x235040(0x145)+_0xa9d089+_0x235040(0x14b)+_0x235040(0x101),{'parse_mode':'Markdown'});return;}if(!_0x6b5c4c||!_0x6b5c4c[_0x235040(0xfb)](_0x235040(0x18f))&&!_0x6b5c4c[_0x235040(0xfb)](_0x235040(0x164))){await this['bot']?.[_0x235040(0x171)](_0x25254c,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x235040(0xd3),{'parse_mode':_0x235040(0x10f)});return;}const _0x180f49=await database_1['default'][_0x235040(0x153)][_0x235040(0x17f)]({'where':{'username':_0xa9d089},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x180f49){const _0x2950b3=await database_1[_0x235040(0xea)][_0x235040(0x153)][_0x235040(0x127)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x4d1d91='❌\x20Shop\x20with\x20username\x20`'+_0xa9d089+_0x235040(0xeb);_0x2950b3[_0x235040(0x16d)]>0x0?(_0x4d1d91+=_0x235040(0x13e),_0x2950b3[_0x235040(0xfa)](_0x4f0451=>{const _0x1b5ef6=_0x235040;_0x4d1d91+=_0x1b5ef6(0xb1)+_0x4f0451[_0x1b5ef6(0xd2)]+_0x1b5ef6(0x116)+_0x4f0451[_0x1b5ef6(0x18a)]+')\x0a';}),_0x4d1d91+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x4d1d91+=_0x235040(0x107);await this[_0x235040(0xb8)]?.[_0x235040(0x171)](_0x25254c,_0x4d1d91,{'parse_mode':_0x235040(0x10f)});return;}if(_0x180f49[_0x235040(0xca)]!==_0x235040(0xdb)){await this[_0x235040(0xb8)]?.['sendMessage'](_0x25254c,_0x235040(0xbf)+_0xa9d089+_0x235040(0x17e)+_0x235040(0x10b),{'parse_mode':_0x235040(0x10f)});return;}if(_0x180f49[_0x235040(0xcd)]!==_0x6b5c4c&&_0x180f49[_0x235040(0xcf)]!==_0x6b5c4c){await this['bot']?.[_0x235040(0x171)](_0x25254c,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0xa9d089+'`.\x0a\x0a'+_0x235040(0xf4)+_0x235040(0x143),{'parse_mode':_0x235040(0x10f)});return;}const _0x379d29=await database_1[_0x235040(0xea)][_0x235040(0xb3)]['findFirst']({'where':{'shopId':_0x180f49['id'],'isVerified':!![],'telegramId':{'not':_0x276bcf}}});if(_0x379d29){await this['bot']?.['sendMessage'](_0x25254c,_0x235040(0x125)+_0xa9d089+_0x235040(0x149)+_0x235040(0x183),{'parse_mode':_0x235040(0x10f)});return;}await database_1[_0x235040(0xea)][_0x235040(0xb3)][_0x235040(0xf1)]({'where':{'telegramId':_0x276bcf},'data':{'shopId':_0x180f49['id'],'isVerified':!![]}}),await this[_0x235040(0xb8)]?.[_0x235040(0x171)](_0x25254c,'🎉\x20*Congratulations!*\x0a\x0a'+_0x235040(0x15b)+(_0x235040(0x178)+_0x180f49[_0x235040(0x18a)]+'*\x0a')+('👤\x20Username:\x20`'+_0x180f49['username']+_0x235040(0x14b))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x235040(0xe3)+_0x235040(0x166)+_0x235040(0xe9)+'•\x20Important\x20events\x0a\x0a'+_0x235040(0x157)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x235040(0x11f),{'parse_mode':_0x235040(0x10f)}),console['log']('✅\x20Telegram\x20user\x20'+_0x276bcf+_0x235040(0x12c)+_0x180f49[_0x235040(0xd2)]+_0x235040(0x17d));}catch(_0x367778){console[_0x235040(0xf5)](_0x235040(0x173),_0x367778),await this[_0x235040(0xb8)]?.[_0x235040(0x171)](_0x25254c,_0x235040(0x154));}}async[a59_0x4f65cb(0x12f)](_0x337634,_0x410774,_0x4473d8){const _0x52e5e7=a59_0x4f65cb;if(!this['bot']){console['warn'](_0x52e5e7(0xbc));return;}try{const _0x4f1803=await database_1[_0x52e5e7(0xea)]['telegramUser'][_0x52e5e7(0x127)]({'where':{'shopId':_0x337634,'isVerified':!![]}});if(_0x4f1803[_0x52e5e7(0x16d)]===0x0){console[_0x52e5e7(0xe0)](_0x52e5e7(0x14c)+_0x337634);return;}const _0x42a1e6=_0x4f1803[_0x52e5e7(0x142)](async _0x233613=>{const _0x171001=_0x52e5e7;try{await this[_0x171001(0xb8)]?.['sendMessage'](_0x233613[_0x171001(0x162)],_0x410774,_0x4473d8),console[_0x171001(0xe0)](_0x171001(0xd7)+_0x233613[_0x171001(0x162)]);}catch(_0x4161e1){console[_0x171001(0xf5)](_0x171001(0xb9)+_0x233613[_0x171001(0x162)]+':',_0x4161e1),_0x4161e1 instanceof Error&&(_0x4161e1[_0x171001(0x177)][_0x171001(0x118)]('blocked')||_0x4161e1[_0x171001(0x177)][_0x171001(0x118)](_0x171001(0x108))||_0x4161e1[_0x171001(0x177)]['includes'](_0x171001(0xb6)))&&(await database_1[_0x171001(0xea)][_0x171001(0xb3)][_0x171001(0xf1)]({'where':{'id':_0x233613['id']},'data':{'isVerified':![]}}),console[_0x171001(0xe0)](_0x171001(0x103)+_0x233613[_0x171001(0x162)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise['allSettled'](_0x42a1e6);}catch(_0x4e7b32){console['error'](_0x52e5e7(0x11e),_0x4e7b32);}}async[a59_0x4f65cb(0xc8)](_0x473915,_0x47f920,_0x13ed3e){const _0x1ff9d3=a59_0x4f65cb,_0x3c798a={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x1b3bd2={'created':_0x1ff9d3(0x18e),'paid':_0x1ff9d3(0x14a),'failed':_0x1ff9d3(0x175),'expired':_0x1ff9d3(0xd6),'refund':'Payment\x20refund','chargeback':_0x1ff9d3(0xf0),'processing':_0x1ff9d3(0xe6)},_0x2dd51e=_0x3c798a[_0x13ed3e],_0x482774=_0x1b3bd2[_0x13ed3e],_0x52637d=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x47f920[_0x1ff9d3(0x14e)]);console[_0x1ff9d3(0xe0)](_0x1ff9d3(0x123)+_0x47f920[_0x1ff9d3(0x14e)]+'\x22\x20->\x20display\x20\x22'+_0x52637d+'\x22');let _0xe98a40=_0x2dd51e+'\x20*'+_0x482774+_0x1ff9d3(0x100)+(_0x1ff9d3(0x167)+_0x47f920[_0x1ff9d3(0x11c)]+'\x20'+_0x47f920[_0x1ff9d3(0x110)]+'*\x0a')+(_0x1ff9d3(0x185)+(_0x47f920[_0x1ff9d3(0xb7)]||_0x47f920['id'])+'`\x0a')+(_0x1ff9d3(0x13b)+_0x47f920['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x52637d+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x47f920['createdAt'])[_0x1ff9d3(0x18b)]('en-US')+'\x0a');if(_0x47f920['customerName']||_0x47f920[_0x1ff9d3(0xc5)]||_0x47f920[_0x1ff9d3(0x138)]||_0x47f920[_0x1ff9d3(0xdc)]||_0x47f920[_0x1ff9d3(0x132)]){_0xe98a40+=_0x1ff9d3(0x172);_0x47f920[_0x1ff9d3(0x176)]&&(_0xe98a40+=_0x1ff9d3(0xd8)+_0x47f920[_0x1ff9d3(0x176)]+'`\x0a');_0x47f920['customerEmail']&&(_0xe98a40+=_0x1ff9d3(0x189)+_0x47f920[_0x1ff9d3(0xc5)]+'`\x0a');_0x47f920[_0x1ff9d3(0x138)]&&(_0xe98a40+=_0x1ff9d3(0xed)+_0x47f920[_0x1ff9d3(0x138)]+'`\x0a');_0x47f920[_0x1ff9d3(0xdc)]&&(_0xe98a40+='🌐\x20IP:\x20`'+_0x47f920[_0x1ff9d3(0xdc)]+'`\x0a');if(_0x47f920[_0x1ff9d3(0x132)]){const _0x1e457a=_0x47f920[_0x1ff9d3(0x132)]['length']>0x32?_0x47f920[_0x1ff9d3(0x132)][_0x1ff9d3(0xf9)](0x0,0x32)+_0x1ff9d3(0x105):_0x47f920['customerUa'];_0xe98a40+=_0x1ff9d3(0xe8)+_0x1e457a+'`\x0a';}}_0x13ed3e===_0x1ff9d3(0x129)&&_0x47f920['chargebackAmount']&&(_0xe98a40+=_0x1ff9d3(0xf8)+_0x47f920['chargebackAmount']+_0x1ff9d3(0xcb)),_0x13ed3e==='processing'&&(_0xe98a40+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x47f920[_0x1ff9d3(0x148)]&&(_0xe98a40+='📝\x20Notes:\x20'+_0x47f920['adminNotes']+'\x0a'),await this[_0x1ff9d3(0x12f)](_0x473915,_0xe98a40,{'parse_mode':_0x1ff9d3(0x10f)});}async[a59_0x4f65cb(0xc7)](_0xfa10d4,_0x410485,_0x341961){const _0x23a477=a59_0x4f65cb,_0x504548={'created':'📤','completed':'✅','rejected':'❌'},_0x36a201={'created':_0x23a477(0x152),'completed':_0x23a477(0xb2),'rejected':_0x23a477(0xe7)},_0x4af334=_0x504548[_0x341961],_0x4462fd=_0x36a201[_0x341961],_0x56b6b6=_0x4af334+'\x20*'+_0x4462fd+_0x23a477(0x100)+(_0x23a477(0xe4)+_0x410485[_0x23a477(0x11c)]+_0x23a477(0x144))+(_0x23a477(0xc1)+_0x410485[_0x23a477(0x139)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x410485['id']+'`\x0a')+(_0x23a477(0x121)+new Date(_0x410485['createdAt'])[_0x23a477(0x18b)]('en-US')+'\x0a')+(_0x410485[_0x23a477(0x169)]?_0x23a477(0xfd)+_0x410485[_0x23a477(0x169)]+'`':'');await this['sendShopNotification'](_0xfa10d4,_0x56b6b6,{'parse_mode':'Markdown'});}async[a59_0x4f65cb(0x14f)](_0x4e4343,_0x29be6a){const _0x455b64=a59_0x4f65cb;try{const _0x3a0eca=await database_1[_0x455b64(0xea)][_0x455b64(0xd9)][_0x455b64(0x17f)]({'where':{'shopId':_0x4e4343},'select':{'notificationLogin':!![]}});if(!_0x3a0eca?.[_0x455b64(0x184)]){console[_0x455b64(0xe0)](_0x455b64(0x13c)+_0x4e4343);return;}const _0x523ce0=_0x29be6a[_0x455b64(0x15f)]?'🔐':'🚨',_0x2e29ea=_0x29be6a['success']?_0x455b64(0x16c):_0x455b64(0x16f);let _0x559aa4=_0x523ce0+'\x20*'+_0x2e29ea+_0x455b64(0x100)+('👤\x20Username:\x20`'+_0x29be6a[_0x455b64(0xd2)]+'`\x0a')+(_0x455b64(0x16e)+_0x29be6a['timestamp']['toLocaleString'](_0x455b64(0x188))+'\x0a');_0x29be6a[_0x455b64(0x161)]&&(_0x559aa4+=_0x455b64(0x18d)+_0x29be6a[_0x455b64(0x161)]+'`\x0a');if(_0x29be6a['userAgent']){const _0x93b30b=_0x29be6a[_0x455b64(0x109)]['length']>0x32?_0x29be6a['userAgent']['substring'](0x0,0x32)+'...':_0x29be6a[_0x455b64(0x109)];_0x559aa4+='💻\x20Browser:\x20`'+_0x93b30b+'`\x0a';}!_0x29be6a[_0x455b64(0x15f)]&&(_0x559aa4+=_0x455b64(0x15e)),await this['sendShopNotification'](_0x4e4343,_0x559aa4,{'parse_mode':_0x455b64(0x10f)}),console[_0x455b64(0xe0)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x4e4343+':\x20'+(_0x29be6a['success']?_0x455b64(0x15f):_0x455b64(0xf6)));}catch(_0x213f66){console[_0x455b64(0xf5)](_0x455b64(0x106),_0x213f66);}}async[a59_0x4f65cb(0xc4)](_0x21bea8,_0x4d0d63){const _0x3666e3=a59_0x4f65cb;try{const _0x45d50d=await database_1[_0x3666e3(0xea)][_0x3666e3(0xd9)]['findUnique']({'where':{'shopId':_0x21bea8},'select':{'notificationApiError':!![]}});if(!_0x45d50d?.[_0x3666e3(0x151)]){console[_0x3666e3(0xe0)](_0x3666e3(0x155)+_0x21bea8);return;}let _0x3645dd=_0x3666e3(0x160)+(_0x3666e3(0x186)+_0x4d0d63[_0x3666e3(0x139)]+'\x20'+_0x4d0d63[_0x3666e3(0xdf)]+'`\x0a')+(_0x3666e3(0x16e)+_0x4d0d63[_0x3666e3(0x15a)][_0x3666e3(0x18b)](_0x3666e3(0x188))+'\x0a');_0x4d0d63['statusCode']&&(_0x3645dd+=_0x3666e3(0x13d)+_0x4d0d63[_0x3666e3(0x150)]+'`\x0a'),_0x3645dd+=_0x3666e3(0xd5)+_0x4d0d63['errorMessage']+'`\x0a',_0x4d0d63[_0x3666e3(0x182)]&&(_0x3645dd+=_0x3666e3(0x136)+_0x4d0d63[_0x3666e3(0x182)]+'`\x0a'),_0x3645dd+=_0x3666e3(0x131),await this[_0x3666e3(0x12f)](_0x21bea8,_0x3645dd,{'parse_mode':'Markdown'}),console[_0x3666e3(0xe0)](_0x3666e3(0x174)+_0x21bea8+':\x20'+_0x4d0d63[_0x3666e3(0xdf)]);}catch(_0x1887d5){console[_0x3666e3(0xf5)](_0x3666e3(0xd4),_0x1887d5);}}async[a59_0x4f65cb(0xda)](_0x1a4856,_0x140d3b,_0x50c735){const _0x37e495=a59_0x4f65cb;let _0x4350de='🔔\x20*'+_0x140d3b+_0x37e495(0x100);for(const [_0x28ce0e,_0x584cdd]of Object['entries'](_0x50c735)){_0x584cdd!==null&&_0x584cdd!==undefined&&(_0x4350de+=_0x28ce0e+_0x37e495(0xde)+_0x584cdd+'`\x0a');}await this[_0x37e495(0x12f)](_0x1a4856,_0x4350de,{'parse_mode':'Markdown'});}[a59_0x4f65cb(0xce)](){const _0x5b1cb5=a59_0x4f65cb;return{'isActive':!!this[_0x5b1cb5(0xb8)],'username':this[_0x5b1cb5(0xee)]};}['stopBot'](){const _0x3e6c8f=a59_0x4f65cb;this[_0x3e6c8f(0xb8)]&&(this['bot'][_0x3e6c8f(0x102)](),this[_0x3e6c8f(0xb8)]=null,console[_0x3e6c8f(0xe0)](_0x3e6c8f(0xf2)));}}exports[a59_0x4f65cb(0xc9)]=TelegramBotService,exports[a59_0x4f65cb(0x17b)]=new TelegramBotService();