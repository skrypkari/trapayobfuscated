'use strict';function a55_0x31bf(){const _0x44e341=['endpoint','sendLoginNotification','sendCustomNotification','\x20(@','remitterIban','polling_error','warn','notificationApiError','519801rzJhWV','log','Payment\x20chargeback','New\x20payment\x20created','isVerified','create','🛑\x20Telegram\x20bot\x20stopped','startsWith','\x20\x20\x20Status:\x20','currency','Failed\x20login\x20attempt','publicKey','handleSingleLineVerification','customerUa','shop','User\x20','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','915107TphYOZ','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','chat\x20not\x20found','orderId','error','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','txid','sendMessage','status','Payment\x20expired','🏦\x20Method:\x20`','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','❌\x20Please\x20use\x20/start\x20command\x20first','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','🏦\x20IBAN:\x20`','TELEGRAM_BOT_USERNAME','errorMessage','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','adminNotes','\x20via\x20single-line\x20input','•\x20Payouts\x0a','TelegramBotService','\x0aCheck\x20spelling\x20and\x20try\x20again.','Payment\x20is\x20being\x20processed','New\x20payout\x20created','success','❌\x20Shop\x20`','en-US','customerName','Contact\x20administrator.','env','...','name','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','test','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','👤\x20Username:\x20`','12085632LWgDzj','✅\x20Telegram\x20bot\x20@','📅\x20Time:\x20','processing','../config/database','/disconnect\x20-\x20disconnect\x20from\x20notifications','8pMxFdG','14VMqocd','length','Use\x20/start\x20to\x20connect.','✅\x20Telegram\x20user\x20','last_name','gateway','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','chargebackAmount','trim','Error\x20handling\x20/start\x20command:','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','🌐\x20IP:\x20`','Telegram\x20bot\x20polling\x20error:','substring','secretKey','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','•\x20Payment\x20status\x20changes\x0a','sendPaymentNotification','bot','💻\x20Browser:\x20`','from','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','🔗\x20Endpoint:\x20`','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','7BLfYtH','\x20disconnected\x20from\x20shop\x20','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','...`\x0a\x0a','`.\x0a\x0a','Telegram\x20bot\x20error:','💸\x20Amount:\x20*','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','userAgent','sendPayoutNotification','Payment\x20refund','telegramUser','`\x0a\x0a','sendApiErrorNotification',':\x20username=\x22','\x22\x20->\x20display\x20\x22','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','•\x20Important\x20events\x0a\x0a','You\x20sent\x20','📝\x20Order\x20ID:\x20`','toLocaleDateString',':\x20`','Commands:\x0a','Error\x20handling\x20message:','findMany','amount','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','text','stopPolling','11083788dzvyGk','findUnique','\x20USDT*\x0a','initializeBot','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','createdAt','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','8626872EieBUn','findFirst','Successful\x20login','🌐\x20IP\x20address:\x20`','❌\x20Error:\x20`','statusCode','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Error\x20sending\x20shop\x20notification:','telegramId','user\x20is\x20deactivated','`\x20is\x20inactive.\x0a\x0a','.\x20*','onText','chargeback','sendShopNotification','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','📧\x20Email:\x20`','../types/gateway','🚨\x20*API\x20Error*\x0a\x0a','📱\x20Your\x20Telegram\x20ID:\x20`','📊\x20*Connection\x20Status*\x0a\x0a','chat','58043030XnGuOo','allSettled','🆔\x20Payment\x20ID:\x20`','\x20\x20\x20Public\x20Key:\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a','...\x22','•\x20New\x20payments\x0a','`\x20(','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','`\x20not\x20found.\x0a\x0a','🆔\x20Payout\x20ID:\x20`','To\x20reconnect,\x20use\x20the\x20/start\x20command','✅\x20Connected\x20to\x20shop:\x20*','notificationLogin','💸\x20Penalty\x20amount:\x20*','shopId','📊\x20Error\x20code:\x20`','*\x0a\x0a','updatedAt','Error\x20in\x20handleSingleLineVerification:','•\x20`','join','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Username:\x20`','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','\x20USD*\x0a','Payment\x20successfully\x20paid','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','telegramBotService','update','2113170PJqUaj','ACTIVE','Payout\x20completed','toString','📅\x20Connection\x20date:\x20','ipAddress','customerEmail','username','botToken','__esModule','includes','defineProperty','message','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','🆔\x20Request\x20ID:\x20`','📅\x20Date:\x20','❌\x20Shop\x20with\x20username\x20`','🔗\x20TXID:\x20`','shopSettings','entries','botUsername','failed','toLocaleString','customerIp','🔍\x20*Debug\x20Information*\x0a\x0a','stopBot','/status\x20-\x20check\x20connection\x20status\x0a','timestamp','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','*.\x0a\x0a','default','unknown\x20shop','getGatewayDisplayNameForTelegram','blocked','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','🎉\x20*Congratulations!*\x0a\x0a','•\x20Payouts\x0a\x0a','pk_','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','method','Failed\x20to\x20send\x20API\x20error\x20notification:','\x20\x20\x20Username:\x20`','Markdown','\x20parts:\x20','Example:\x0a','Check\x20spelling\x20and\x20try\x20again.','\x20initialized\x20successfully','Error\x20handling\x20/debug\x20command:','Use\x20/start\x20to\x20begin.'];a55_0x31bf=function(){return _0x44e341;};return a55_0x31bf();}const a55_0x231944=a55_0x20f5;(function(_0x2f9cb1,_0x4da809){const _0xf21090=a55_0x20f5,_0x152116=_0x2f9cb1();while(!![]){try{const _0x304eba=-parseInt(_0xf21090(0x257))/0x1+-parseInt(_0xf21090(0x283))/0x2*(-parseInt(_0xf21090(0x246))/0x3)+-parseInt(_0xf21090(0x282))/0x4*(parseInt(_0xf21090(0x20d))/0x5)+-parseInt(_0xf21090(0x1d2))/0x6+parseInt(_0xf21090(0x1b3))/0x7*(-parseInt(_0xf21090(0x1d9))/0x8)+-parseInt(_0xf21090(0x27c))/0x9+parseInt(_0xf21090(0x1ef))/0xa;if(_0x304eba===_0x4da809)break;else _0x152116['push'](_0x152116['shift']());}catch(_0x1bca2a){_0x152116['push'](_0x152116['shift']());}}}(a55_0x31bf,0xf1484));function a55_0x20f5(_0x2dace3,_0x46d24f){const _0x31bf3a=a55_0x31bf();return a55_0x20f5=function(_0x20f56b,_0x4e1a14){_0x20f56b=_0x20f56b-0x1a9;let _0xff5786=_0x31bf3a[_0x20f56b];return _0xff5786;},a55_0x20f5(_0x2dace3,_0x46d24f);}var __importDefault=this&&this['__importDefault']||function(_0x7b4ff8){const _0x82b9b3=a55_0x20f5;return _0x7b4ff8&&_0x7b4ff8[_0x82b9b3(0x216)]?_0x7b4ff8:{'default':_0x7b4ff8};};Object[a55_0x231944(0x218)](exports,a55_0x231944(0x216),{'value':!![]}),exports[a55_0x231944(0x20b)]=exports[a55_0x231944(0x26c)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a55_0x231944(0x280))),gateway_1=require(a55_0x231944(0x1ea));class TelegramBotService{constructor(){const _0x2d0c92=a55_0x231944;this[_0x2d0c92(0x1ad)]=null,this[_0x2d0c92(0x215)]=process[_0x2d0c92(0x275)]['TELEGRAM_BOT_TOKEN']||'',this[_0x2d0c92(0x221)]=process[_0x2d0c92(0x275)][_0x2d0c92(0x266)]||'trapay_bot',this[_0x2d0c92(0x215)]?this[_0x2d0c92(0x1d5)]():console['warn'](_0x2d0c92(0x289));}[a55_0x231944(0x1d5)](){const _0x44d03d=a55_0x231944;try{this['bot']=new node_telegram_bot_api_1[(_0x44d03d(0x22b))](this['botToken'],{'polling':!![]}),this['setupBotHandlers'](),console[_0x44d03d(0x247)](_0x44d03d(0x27d)+this['botUsername']+_0x44d03d(0x23b));}catch(_0x318dbb){console[_0x44d03d(0x25b)](_0x44d03d(0x264),_0x318dbb);}}['setupBotHandlers'](){const _0x39382c=a55_0x231944;if(!this['bot'])return;this[_0x39382c(0x1ad)][_0x39382c(0x1e5)](/\/start/,async _0x4d4ed5=>{const _0x53cdfd=_0x39382c,_0x958420=_0x4d4ed5[_0x53cdfd(0x1ee)]['id'],_0x40b319=_0x4d4ed5['from']?.['id'][_0x53cdfd(0x210)](),_0x3f5bf5=_0x4d4ed5[_0x53cdfd(0x1af)]?.['username'],_0x1f67ee=_0x4d4ed5[_0x53cdfd(0x1af)]?.['first_name'],_0x2413ae=_0x4d4ed5[_0x53cdfd(0x1af)]?.[_0x53cdfd(0x287)];if(!_0x40b319)return;try{let _0x4338f8=await database_1['default']['telegramUser'][_0x53cdfd(0x1d3)]({'where':{'telegramId':_0x40b319},'include':{'shop':!![]}});!_0x4338f8?(_0x4338f8=await database_1[_0x53cdfd(0x22b)][_0x53cdfd(0x1be)][_0x53cdfd(0x24b)]({'data':{'telegramId':_0x40b319,'username':_0x3f5bf5,'firstName':_0x1f67ee,'lastName':_0x2413ae,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x53cdfd(0x247)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x40b319+_0x53cdfd(0x241)+_0x3f5bf5+')')):_0x4338f8=await database_1[_0x53cdfd(0x22b)]['telegramUser'][_0x53cdfd(0x20c)]({'where':{'telegramId':_0x40b319},'data':{'username':_0x3f5bf5,'firstName':_0x1f67ee,'lastName':_0x2413ae},'include':{'shop':!![]}}),_0x4338f8[_0x53cdfd(0x24a)]&&_0x4338f8[_0x53cdfd(0x1fe)]&&_0x4338f8[_0x53cdfd(0x254)]?await this['bot']?.[_0x53cdfd(0x25e)](_0x958420,'✅\x20Welcome\x20back!\x0a\x0a'+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x4338f8[_0x53cdfd(0x254)][_0x53cdfd(0x277)]+'*\x0a')+(_0x53cdfd(0x206)+_0x4338f8[_0x53cdfd(0x254)]['username']+_0x53cdfd(0x1bf))+_0x53cdfd(0x1df)+'•\x20New\x20payments\x0a'+_0x53cdfd(0x1ab)+_0x53cdfd(0x231)+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x53cdfd(0x281),{'parse_mode':'Markdown'}):(_0x4338f8[_0x53cdfd(0x1fe)]&&!_0x4338f8[_0x53cdfd(0x24a)]&&(await database_1[_0x53cdfd(0x22b)]['telegramUser']['update']({'where':{'telegramId':_0x40b319},'data':{'shopId':null,'isVerified':![]}}),console[_0x53cdfd(0x247)](_0x53cdfd(0x278)+_0x40b319)),await this['bot']?.['sendMessage'](_0x958420,_0x53cdfd(0x1b2)+_0x53cdfd(0x1ba)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x53cdfd(0x239)+_0x53cdfd(0x1d6)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x53cdfd(0x237)}));}catch(_0x391f10){console['error'](_0x53cdfd(0x28c),_0x391f10),await this[_0x53cdfd(0x1ad)]?.['sendMessage'](_0x958420,_0x53cdfd(0x1f7));}}),this[_0x39382c(0x1ad)][_0x39382c(0x1e5)](/\/disconnect/,async _0x3112b3=>{const _0x11d462=_0x39382c,_0x590431=_0x3112b3['chat']['id'],_0x2df344=_0x3112b3[_0x11d462(0x1af)]?.['id'][_0x11d462(0x210)]();if(!_0x2df344)return;try{const _0x8b8ceb=await database_1[_0x11d462(0x22b)][_0x11d462(0x1be)][_0x11d462(0x1d3)]({'where':{'telegramId':_0x2df344},'include':{'shop':!![]}});if(!_0x8b8ceb||!_0x8b8ceb[_0x11d462(0x24a)]||!_0x8b8ceb['shopId']){await this[_0x11d462(0x1ad)]?.[_0x11d462(0x25e)](_0x590431,_0x11d462(0x229));return;}const _0x299533=_0x8b8ceb['shop']?.[_0x11d462(0x277)]||_0x11d462(0x22c);await database_1[_0x11d462(0x22b)][_0x11d462(0x1be)][_0x11d462(0x20c)]({'where':{'telegramId':_0x2df344},'data':{'shopId':null,'isVerified':![]}}),console[_0x11d462(0x247)]('🔌\x20User\x20'+_0x2df344+_0x11d462(0x1b4)+_0x8b8ceb[_0x11d462(0x1fe)]),await this['bot']?.['sendMessage'](_0x590431,_0x11d462(0x25c)+_0x299533+_0x11d462(0x22a)+_0x11d462(0x1fa),{'parse_mode':_0x11d462(0x237)});}catch(_0x5676e7){console[_0x11d462(0x25b)]('Error\x20handling\x20/disconnect\x20command:',_0x5676e7),await this[_0x11d462(0x1ad)]?.[_0x11d462(0x25e)](_0x590431,_0x11d462(0x1f7));}}),this[_0x39382c(0x1ad)][_0x39382c(0x1e5)](/\/status/,async _0x59c8d9=>{const _0x2bccf3=_0x39382c,_0x22b79b=_0x59c8d9[_0x2bccf3(0x1ee)]['id'],_0x77e7c9=_0x59c8d9[_0x2bccf3(0x1af)]?.['id'][_0x2bccf3(0x210)]();if(!_0x77e7c9)return;try{const _0x346389=await database_1[_0x2bccf3(0x22b)][_0x2bccf3(0x1be)][_0x2bccf3(0x1d3)]({'where':{'telegramId':_0x77e7c9},'include':{'shop':!![]}});if(!_0x346389){await this[_0x2bccf3(0x1ad)]?.[_0x2bccf3(0x25e)](_0x22b79b,_0x2bccf3(0x22f)+_0x2bccf3(0x23d));return;}if(!_0x346389['isVerified']||!_0x346389[_0x2bccf3(0x1fe)]||!_0x346389['shop']){await this[_0x2bccf3(0x1ad)]?.[_0x2bccf3(0x25e)](_0x22b79b,_0x2bccf3(0x27a)+_0x2bccf3(0x285));return;}await this[_0x2bccf3(0x1ad)]?.[_0x2bccf3(0x25e)](_0x22b79b,_0x2bccf3(0x1ed)+(_0x2bccf3(0x1fb)+_0x346389[_0x2bccf3(0x254)]['name']+'*\x0a')+(_0x2bccf3(0x27b)+_0x346389[_0x2bccf3(0x254)][_0x2bccf3(0x214)]+'`\x0a')+(_0x2bccf3(0x211)+_0x346389[_0x2bccf3(0x201)][_0x2bccf3(0x1c9)](_0x2bccf3(0x272))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+'Commands:\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x2bccf3(0x237)});}catch(_0x1991da){console[_0x2bccf3(0x25b)]('Error\x20handling\x20/status\x20command:',_0x1991da),await this['bot']?.[_0x2bccf3(0x25e)](_0x22b79b,_0x2bccf3(0x1f7));}}),this['bot'][_0x39382c(0x1e5)](/\/debug/,async _0x3fe1ca=>{const _0x3993c8=_0x39382c,_0xb530cf=_0x3fe1ca['chat']['id'],_0x3267a9=_0x3fe1ca[_0x3993c8(0x1af)]?.['id'][_0x3993c8(0x210)]();if(!_0x3267a9)return;try{const _0x93d5d0=await database_1[_0x3993c8(0x22b)][_0x3993c8(0x254)][_0x3993c8(0x1cd)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x5cfb62=_0x3993c8(0x225);_0x5cfb62+=_0x3993c8(0x1ec)+_0x3267a9+_0x3993c8(0x1bf),_0x5cfb62+=_0x3993c8(0x1f3),_0x93d5d0['forEach']((_0x26ee70,_0x291b20)=>{const _0x4a751b=_0x3993c8;_0x5cfb62+=_0x291b20+0x1+_0x4a751b(0x1e4)+_0x26ee70[_0x4a751b(0x277)]+'*\x0a',_0x5cfb62+=_0x4a751b(0x236)+_0x26ee70[_0x4a751b(0x214)]+'`\x0a',_0x5cfb62+=_0x4a751b(0x24e)+_0x26ee70['status']+'\x0a',_0x5cfb62+=_0x4a751b(0x1f2)+_0x26ee70[_0x4a751b(0x251)][_0x4a751b(0x290)](0x0,0xf)+_0x4a751b(0x1b6);}),await this[_0x3993c8(0x1ad)]?.[_0x3993c8(0x25e)](_0xb530cf,_0x5cfb62,{'parse_mode':'Markdown'});}catch(_0x3aa469){console[_0x3993c8(0x25b)](_0x3993c8(0x23c),_0x3aa469),await this['bot']?.[_0x3993c8(0x25e)](_0xb530cf,'❌\x20Error\x20getting\x20debug\x20information.');}}),this[_0x39382c(0x1ad)]['on'](_0x39382c(0x219),async _0x3a07f2=>{const _0xd7fd50=_0x39382c;if(_0x3a07f2[_0xd7fd50(0x1d0)]?.['startsWith']('/'))return;const _0x3a1b05=_0x3a07f2[_0xd7fd50(0x1ee)]['id'],_0x69af85=_0x3a07f2[_0xd7fd50(0x1af)]?.['id'][_0xd7fd50(0x210)](),_0xb48d90=_0x3a07f2[_0xd7fd50(0x1d0)]?.[_0xd7fd50(0x28b)]();if(!_0x69af85||!_0xb48d90)return;try{const _0x262c63=await database_1[_0xd7fd50(0x22b)][_0xd7fd50(0x1be)]['findUnique']({'where':{'telegramId':_0x69af85},'include':{'shop':!![]}});if(!_0x262c63){await this[_0xd7fd50(0x1ad)]?.['sendMessage'](_0x3a1b05,_0xd7fd50(0x263));return;}if(_0x262c63['isVerified']&&_0x262c63[_0xd7fd50(0x1fe)]&&_0x262c63['shop']){await this[_0xd7fd50(0x1ad)]?.[_0xd7fd50(0x25e)](_0x3a1b05,_0xd7fd50(0x256)+_0x262c63[_0xd7fd50(0x254)]['name']+_0xd7fd50(0x22a)+_0xd7fd50(0x1c5),{'parse_mode':_0xd7fd50(0x237)});return;}const _0x5c9f44=_0xb48d90['split'](/\s+/);if(_0x5c9f44['length']!==0x2){await this[_0xd7fd50(0x1ad)]?.[_0xd7fd50(0x25e)](_0x3a1b05,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0xd7fd50(0x262)+_0xd7fd50(0x239)+_0xd7fd50(0x1d6)+(_0xd7fd50(0x1c7)+_0x5c9f44[_0xd7fd50(0x284)]+_0xd7fd50(0x238)+_0x5c9f44['map'](_0x36aada=>'`'+_0x36aada+'`')[_0xd7fd50(0x204)](',\x20')),{'parse_mode':_0xd7fd50(0x237)});return;}const [_0x10f25c,_0x169b47]=_0x5c9f44;console[_0xd7fd50(0x247)](_0xd7fd50(0x205)+_0x69af85+_0xd7fd50(0x1c1)+_0x10f25c+'\x22,\x20apiKey=\x22'+_0x169b47['substring'](0x0,0xa)+_0xd7fd50(0x1f4)),await this[_0xd7fd50(0x252)](_0x3a1b05,_0x69af85,_0x10f25c,_0x169b47);}catch(_0x510620){console[_0xd7fd50(0x25b)](_0xd7fd50(0x1cc),_0x510620),await this[_0xd7fd50(0x1ad)]?.[_0xd7fd50(0x25e)](_0x3a1b05,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x39382c(0x1ad)]['on'](_0x39382c(0x25b),_0x2cb7ea=>{const _0x1e4231=_0x39382c;console[_0x1e4231(0x25b)](_0x1e4231(0x1b8),_0x2cb7ea);}),this['bot']['on'](_0x39382c(0x243),_0xf5ad93=>{const _0x420546=_0x39382c;console[_0x420546(0x25b)](_0x420546(0x28f),_0xf5ad93);});}async[a55_0x231944(0x252)](_0x509f0e,_0x128cec,_0x449fbb,_0x1b79ca){const _0x5108b1=a55_0x231944;try{console[_0x5108b1(0x247)](_0x5108b1(0x205)+_0x128cec+_0x5108b1(0x1c1)+_0x449fbb+'\x22,\x20apiKey=\x22'+_0x1b79ca['substring'](0x0,0xa)+_0x5108b1(0x1f4));if(!_0x449fbb||_0x449fbb[_0x5108b1(0x284)]<0x3||_0x449fbb[_0x5108b1(0x284)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x5108b1(0x279)](_0x449fbb)){await this[_0x5108b1(0x1ad)]?.[_0x5108b1(0x25e)](_0x509f0e,'❌\x20Invalid\x20username\x20format:\x20`'+_0x449fbb+'`\x0a\x0a'+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':'Markdown'});return;}if(!_0x1b79ca||!_0x1b79ca[_0x5108b1(0x24d)](_0x5108b1(0x232))&&!_0x1b79ca[_0x5108b1(0x24d)]('sk_')){await this[_0x5108b1(0x1ad)]?.[_0x5108b1(0x25e)](_0x509f0e,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x5108b1(0x237)});return;}const _0x3e1be=await database_1['default'][_0x5108b1(0x254)][_0x5108b1(0x1d3)]({'where':{'username':_0x449fbb},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x3e1be){const _0x1fd93b=await database_1['default'][_0x5108b1(0x254)][_0x5108b1(0x1cd)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x49d4ec=_0x5108b1(0x21d)+_0x449fbb+_0x5108b1(0x1f8);_0x1fd93b[_0x5108b1(0x284)]>0x0?(_0x49d4ec+='Available\x20usernames:\x0a',_0x1fd93b['forEach'](_0x49bfa3=>{const _0x597d6f=_0x5108b1;_0x49d4ec+=_0x597d6f(0x203)+_0x49bfa3['username']+_0x597d6f(0x1f6)+_0x49bfa3[_0x597d6f(0x277)]+')\x0a';}),_0x49d4ec+=_0x5108b1(0x26d)):_0x49d4ec+=_0x5108b1(0x23a);await this[_0x5108b1(0x1ad)]?.[_0x5108b1(0x25e)](_0x509f0e,_0x49d4ec,{'parse_mode':_0x5108b1(0x237)});return;}if(_0x3e1be[_0x5108b1(0x25f)]!==_0x5108b1(0x20e)){await this['bot']?.[_0x5108b1(0x25e)](_0x509f0e,_0x5108b1(0x271)+_0x449fbb+_0x5108b1(0x1e3)+_0x5108b1(0x274),{'parse_mode':_0x5108b1(0x237)});return;}if(_0x3e1be['publicKey']!==_0x1b79ca&&_0x3e1be[_0x5108b1(0x1a9)]!==_0x1b79ca){await this['bot']?.[_0x5108b1(0x25e)](_0x509f0e,_0x5108b1(0x207)+_0x449fbb+'`.\x0a\x0a'+_0x5108b1(0x1c3)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':'Markdown'});return;}const _0x5e622e=await database_1[_0x5108b1(0x22b)]['telegramUser'][_0x5108b1(0x1da)]({'where':{'shopId':_0x3e1be['id'],'isVerified':!![],'telegramId':{'not':_0x128cec}}});if(_0x5e622e){await this[_0x5108b1(0x1ad)]?.[_0x5108b1(0x25e)](_0x509f0e,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x449fbb+_0x5108b1(0x1b7)+_0x5108b1(0x258),{'parse_mode':_0x5108b1(0x237)});return;}await database_1[_0x5108b1(0x22b)][_0x5108b1(0x1be)][_0x5108b1(0x20c)]({'where':{'telegramId':_0x128cec},'data':{'shopId':_0x3e1be['id'],'isVerified':!![]}}),await this['bot']?.['sendMessage'](_0x509f0e,_0x5108b1(0x230)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('📱\x20Shop:\x20*'+_0x3e1be['name']+'*\x0a')+('👤\x20Username:\x20`'+_0x3e1be[_0x5108b1(0x214)]+'`\x0a\x0a')+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x5108b1(0x1f5)+_0x5108b1(0x1ab)+_0x5108b1(0x26b)+_0x5108b1(0x1c6)+_0x5108b1(0x1cb)+_0x5108b1(0x227)+_0x5108b1(0x281),{'parse_mode':_0x5108b1(0x237)}),console[_0x5108b1(0x247)](_0x5108b1(0x286)+_0x128cec+'\x20verified\x20for\x20shop\x20'+_0x3e1be['username']+_0x5108b1(0x26a));}catch(_0x4eb33b){console[_0x5108b1(0x25b)](_0x5108b1(0x202),_0x4eb33b),await this[_0x5108b1(0x1ad)]?.[_0x5108b1(0x25e)](_0x509f0e,_0x5108b1(0x1c4));}}async[a55_0x231944(0x1e7)](_0x5c2e60,_0x5dd501,_0x296608){const _0x40af6d=a55_0x231944;if(!this[_0x40af6d(0x1ad)]){console[_0x40af6d(0x244)](_0x40af6d(0x21a));return;}try{const _0x5e28aa=await database_1[_0x40af6d(0x22b)][_0x40af6d(0x1be)]['findMany']({'where':{'shopId':_0x5c2e60,'isVerified':!![]}});if(_0x5e28aa['length']===0x0){console[_0x40af6d(0x247)](_0x40af6d(0x1b5)+_0x5c2e60);return;}const _0x45f309=_0x5e28aa['map'](async _0x154bdb=>{const _0x557d1b=_0x40af6d;try{await this[_0x557d1b(0x1ad)]?.['sendMessage'](_0x154bdb[_0x557d1b(0x1e1)],_0x5dd501,_0x296608),console[_0x557d1b(0x247)](_0x557d1b(0x1aa)+_0x154bdb[_0x557d1b(0x1e1)]);}catch(_0x31fb52){console[_0x557d1b(0x25b)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x154bdb[_0x557d1b(0x1e1)]+':',_0x31fb52),_0x31fb52 instanceof Error&&(_0x31fb52['message'][_0x557d1b(0x217)](_0x557d1b(0x22e))||_0x31fb52['message'][_0x557d1b(0x217)](_0x557d1b(0x259))||_0x31fb52[_0x557d1b(0x219)][_0x557d1b(0x217)](_0x557d1b(0x1e2)))&&(await database_1[_0x557d1b(0x22b)][_0x557d1b(0x1be)]['update']({'where':{'id':_0x154bdb['id']},'data':{'isVerified':![]}}),console[_0x557d1b(0x247)](_0x557d1b(0x255)+_0x154bdb[_0x557d1b(0x1e1)]+_0x557d1b(0x233)));}});await Promise[_0x40af6d(0x1f0)](_0x45f309);}catch(_0x453ce1){console[_0x40af6d(0x25b)](_0x40af6d(0x1e0),_0x453ce1);}}async[a55_0x231944(0x1ac)](_0x1d8767,_0x52cdf7,_0x1490ea){const _0x1e1756=a55_0x231944,_0x564ae4={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x350f0e={'created':_0x1e1756(0x249),'paid':_0x1e1756(0x209),'failed':'Payment\x20failed','expired':_0x1e1756(0x260),'refund':_0x1e1756(0x1bd),'chargeback':_0x1e1756(0x248),'processing':_0x1e1756(0x26e)},_0x5f12b4=_0x564ae4[_0x1490ea],_0x5d349b=_0x350f0e[_0x1490ea],_0x4cfc31=(0x0,gateway_1[_0x1e1756(0x22d)])(_0x52cdf7[_0x1e1756(0x288)]);console[_0x1e1756(0x247)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x52cdf7[_0x1e1756(0x288)]+_0x1e1756(0x1c2)+_0x4cfc31+'\x22');let _0x1a6cd7=_0x5f12b4+'\x20*'+_0x5d349b+_0x1e1756(0x200)+('💰\x20Amount:\x20*'+_0x52cdf7[_0x1e1756(0x1ce)]+'\x20'+_0x52cdf7[_0x1e1756(0x24f)]+'*\x0a')+(_0x1e1756(0x1c8)+(_0x52cdf7[_0x1e1756(0x25a)]||_0x52cdf7['id'])+'`\x0a')+(_0x1e1756(0x1f1)+_0x52cdf7['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x4cfc31+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x52cdf7[_0x1e1756(0x1d7)])[_0x1e1756(0x223)](_0x1e1756(0x272))+'\x0a');if(_0x52cdf7[_0x1e1756(0x273)]||_0x52cdf7[_0x1e1756(0x213)]||_0x52cdf7[_0x1e1756(0x242)]||_0x52cdf7[_0x1e1756(0x224)]||_0x52cdf7[_0x1e1756(0x253)]){_0x1a6cd7+='\x0a👤\x20*Customer\x20Information:*\x0a';_0x52cdf7[_0x1e1756(0x273)]&&(_0x1a6cd7+='📛\x20Name:\x20`'+_0x52cdf7[_0x1e1756(0x273)]+'`\x0a');_0x52cdf7[_0x1e1756(0x213)]&&(_0x1a6cd7+=_0x1e1756(0x1e9)+_0x52cdf7[_0x1e1756(0x213)]+'`\x0a');_0x52cdf7[_0x1e1756(0x242)]&&(_0x1a6cd7+=_0x1e1756(0x265)+_0x52cdf7[_0x1e1756(0x242)]+'`\x0a');_0x52cdf7['customerIp']&&(_0x1a6cd7+=_0x1e1756(0x28e)+_0x52cdf7[_0x1e1756(0x224)]+'`\x0a');if(_0x52cdf7[_0x1e1756(0x253)]){const _0x23689c=_0x52cdf7[_0x1e1756(0x253)][_0x1e1756(0x284)]>0x32?_0x52cdf7[_0x1e1756(0x253)][_0x1e1756(0x290)](0x0,0x32)+'...':_0x52cdf7[_0x1e1756(0x253)];_0x1a6cd7+='💻\x20Browser:\x20`'+_0x23689c+'`\x0a';}}_0x1490ea===_0x1e1756(0x1e6)&&_0x52cdf7[_0x1e1756(0x28a)]&&(_0x1a6cd7+=_0x1e1756(0x1fd)+_0x52cdf7['chargebackAmount']+_0x1e1756(0x1d4)),_0x1490ea===_0x1e1756(0x27f)&&(_0x1a6cd7+=_0x1e1756(0x20a)),_0x52cdf7[_0x1e1756(0x269)]&&(_0x1a6cd7+='📝\x20Notes:\x20'+_0x52cdf7[_0x1e1756(0x269)]+'\x0a'),await this[_0x1e1756(0x1e7)](_0x1d8767,_0x1a6cd7,{'parse_mode':_0x1e1756(0x237)});}async[a55_0x231944(0x1bc)](_0x25ba02,_0x5ad002,_0x2aa625){const _0x30477e=a55_0x231944,_0x223a3f={'created':'📤','completed':'✅','rejected':'❌'},_0x582f8e={'created':_0x30477e(0x26f),'completed':_0x30477e(0x20f),'rejected':'Payout\x20rejected'},_0x171b86=_0x223a3f[_0x2aa625],_0x3d3e9e=_0x582f8e[_0x2aa625],_0x37ec7a=_0x171b86+'\x20*'+_0x3d3e9e+'*\x0a\x0a'+(_0x30477e(0x1b9)+_0x5ad002[_0x30477e(0x1ce)]+_0x30477e(0x208))+(_0x30477e(0x261)+_0x5ad002[_0x30477e(0x234)]+'`\x0a')+(_0x30477e(0x1f9)+_0x5ad002['id']+'`\x0a')+(_0x30477e(0x21c)+new Date(_0x5ad002[_0x30477e(0x1d7)])[_0x30477e(0x223)]('en-US')+'\x0a')+(_0x5ad002[_0x30477e(0x25d)]?_0x30477e(0x21e)+_0x5ad002[_0x30477e(0x25d)]+'`':'');await this[_0x30477e(0x1e7)](_0x25ba02,_0x37ec7a,{'parse_mode':_0x30477e(0x237)});}async[a55_0x231944(0x23f)](_0x140e89,_0xc98ae3){const _0x1d9a23=a55_0x231944;try{const _0x8a8092=await database_1[_0x1d9a23(0x22b)][_0x1d9a23(0x21f)][_0x1d9a23(0x1d3)]({'where':{'shopId':_0x140e89},'select':{'notificationLogin':!![]}});if(!_0x8a8092?.[_0x1d9a23(0x1fc)]){console[_0x1d9a23(0x247)](_0x1d9a23(0x1b0)+_0x140e89);return;}const _0x2ad6c5=_0xc98ae3[_0x1d9a23(0x270)]?'🔐':'🚨',_0x5b85c7=_0xc98ae3['success']?_0x1d9a23(0x1db):_0x1d9a23(0x250);let _0x51da3c=_0x2ad6c5+'\x20*'+_0x5b85c7+'*\x0a\x0a'+(_0x1d9a23(0x27b)+_0xc98ae3[_0x1d9a23(0x214)]+'`\x0a')+('📅\x20Time:\x20'+_0xc98ae3[_0x1d9a23(0x228)][_0x1d9a23(0x223)](_0x1d9a23(0x272))+'\x0a');_0xc98ae3[_0x1d9a23(0x212)]&&(_0x51da3c+=_0x1d9a23(0x1dc)+_0xc98ae3[_0x1d9a23(0x212)]+'`\x0a');if(_0xc98ae3['userAgent']){const _0x11a041=_0xc98ae3[_0x1d9a23(0x1bb)][_0x1d9a23(0x284)]>0x32?_0xc98ae3[_0x1d9a23(0x1bb)][_0x1d9a23(0x290)](0x0,0x32)+_0x1d9a23(0x276):_0xc98ae3[_0x1d9a23(0x1bb)];_0x51da3c+=_0x1d9a23(0x1ae)+_0x11a041+'`\x0a';}!_0xc98ae3[_0x1d9a23(0x270)]&&(_0x51da3c+=_0x1d9a23(0x1d8)),await this[_0x1d9a23(0x1e7)](_0x140e89,_0x51da3c,{'parse_mode':_0x1d9a23(0x237)}),console[_0x1d9a23(0x247)](_0x1d9a23(0x28d)+_0x140e89+':\x20'+(_0xc98ae3[_0x1d9a23(0x270)]?'success':_0x1d9a23(0x222)));}catch(_0x3e338b){console[_0x1d9a23(0x25b)]('Failed\x20to\x20send\x20login\x20notification:',_0x3e338b);}}async[a55_0x231944(0x1c0)](_0xea617b,_0xce9f85){const _0x1dc9fa=a55_0x231944;try{const _0x2a945b=await database_1[_0x1dc9fa(0x22b)][_0x1dc9fa(0x21f)][_0x1dc9fa(0x1d3)]({'where':{'shopId':_0xea617b},'select':{'notificationApiError':!![]}});if(!_0x2a945b?.[_0x1dc9fa(0x245)]){console[_0x1dc9fa(0x247)](_0x1dc9fa(0x1e8)+_0xea617b);return;}let _0x5b8568=_0x1dc9fa(0x1eb)+(_0x1dc9fa(0x1b1)+_0xce9f85[_0x1dc9fa(0x234)]+'\x20'+_0xce9f85['endpoint']+'`\x0a')+(_0x1dc9fa(0x27e)+_0xce9f85[_0x1dc9fa(0x228)]['toLocaleString'](_0x1dc9fa(0x272))+'\x0a');_0xce9f85[_0x1dc9fa(0x1de)]&&(_0x5b8568+=_0x1dc9fa(0x1ff)+_0xce9f85['statusCode']+'`\x0a'),_0x5b8568+=_0x1dc9fa(0x1dd)+_0xce9f85[_0x1dc9fa(0x267)]+'`\x0a',_0xce9f85['requestId']&&(_0x5b8568+=_0x1dc9fa(0x21b)+_0xce9f85['requestId']+'`\x0a'),_0x5b8568+=_0x1dc9fa(0x268),await this[_0x1dc9fa(0x1e7)](_0xea617b,_0x5b8568,{'parse_mode':_0x1dc9fa(0x237)}),console[_0x1dc9fa(0x247)](_0x1dc9fa(0x1cf)+_0xea617b+':\x20'+_0xce9f85[_0x1dc9fa(0x23e)]);}catch(_0x54d73d){console[_0x1dc9fa(0x25b)](_0x1dc9fa(0x235),_0x54d73d);}}async[a55_0x231944(0x240)](_0x2276e9,_0x490d6d,_0x5d490e){const _0x583b5e=a55_0x231944;let _0x39b0c2='🔔\x20*'+_0x490d6d+_0x583b5e(0x200);for(const [_0x37fe7c,_0x32f4bb]of Object[_0x583b5e(0x220)](_0x5d490e)){_0x32f4bb!==null&&_0x32f4bb!==undefined&&(_0x39b0c2+=_0x37fe7c+_0x583b5e(0x1ca)+_0x32f4bb+'`\x0a');}await this['sendShopNotification'](_0x2276e9,_0x39b0c2,{'parse_mode':'Markdown'});}['getBotInfo'](){const _0x1b450a=a55_0x231944;return{'isActive':!!this[_0x1b450a(0x1ad)],'username':this[_0x1b450a(0x221)]};}[a55_0x231944(0x226)](){const _0x36adb7=a55_0x231944;this[_0x36adb7(0x1ad)]&&(this[_0x36adb7(0x1ad)][_0x36adb7(0x1d1)](),this[_0x36adb7(0x1ad)]=null,console['log'](_0x36adb7(0x24c)));}}exports[a55_0x231944(0x26c)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();