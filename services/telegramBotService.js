'use strict';const a61_0x55a4ff=a61_0x43b0;(function(_0x949dc1,_0x5a3a65){const _0xa906e8=a61_0x43b0,_0x13f004=_0x949dc1();while(!![]){try{const _0x4505f5=-parseInt(_0xa906e8(0x16b))/0x1+parseInt(_0xa906e8(0xbe))/0x2*(parseInt(_0xa906e8(0x14c))/0x3)+-parseInt(_0xa906e8(0xba))/0x4*(-parseInt(_0xa906e8(0x119))/0x5)+-parseInt(_0xa906e8(0x161))/0x6*(-parseInt(_0xa906e8(0x11f))/0x7)+parseInt(_0xa906e8(0x11e))/0x8+parseInt(_0xa906e8(0x186))/0x9+-parseInt(_0xa906e8(0x115))/0xa;if(_0x4505f5===_0x5a3a65)break;else _0x13f004['push'](_0x13f004['shift']());}catch(_0x366629){_0x13f004['push'](_0x13f004['shift']());}}}(a61_0x13fe,0x61928));function a61_0x43b0(_0x11f67c,_0x485a88){const _0x13fe0d=a61_0x13fe();return a61_0x43b0=function(_0x43b0ee,_0x166af8){_0x43b0ee=_0x43b0ee-0xb9;let _0x17fc6e=_0x13fe0d[_0x43b0ee];return _0x17fc6e;},a61_0x43b0(_0x11f67c,_0x485a88);}function a61_0x13fe(){const _0x4cde52=['📅\x20Time:\x20','✅\x20Welcome\x20back!\x0a\x0a','currency','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','Failed\x20to\x20send\x20API\x20error\x20notification:','sendCustomNotification','findMany','.\x20*','📱\x20Telegram\x20notification:\x20gateway\x20\x22','\x20USD*\x0a','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','👤\x20Username:\x20`','startsWith','secretKey','...\x22','sendShopNotification','success','\x0a👤\x20*Customer\x20Information:*\x0a','\x22,\x20apiKey=\x22','user\x20is\x20deactivated','🆔\x20Request\x20ID:\x20`','errorMessage','trim','🔗\x20TXID:\x20`','\x20disconnected\x20from\x20shop\x20','blocked','telegramUser','/disconnect\x20-\x20disconnect\x20from\x20notifications','📅\x20Connection\x20date:\x20','Markdown','toLocaleDateString','__importDefault','from','initializeBot','findUnique','🏦\x20Method:\x20`','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','New\x20payout\x20created','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','Error\x20handling\x20/start\x20command:','chat','length','error','map','`\x20is\x20inactive.\x0a\x0a','🚨\x20*API\x20Error*\x0a\x0a','•\x20New\x20payments\x0a','forEach','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','notificationLogin','•\x20Payouts\x0a\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','warn','💸\x20Amount:\x20*','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','💸\x20Penalty\x20amount:\x20*','9565250VcoDvr','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','`\x0a\x0a','💰\x20Amount:\x20*','255sHFntX','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','setupBotHandlers','getGatewayDisplayNameForTelegram','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','1451296rHkIna','36631MXTMZS','Error\x20sending\x20shop\x20notification:','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','timestamp',':\x20username=\x22','endpoint','join','*\x0a\x0a','substring','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','bot','📱\x20Notification\x20sent\x20to\x20','Failed\x20to\x20send\x20login\x20notification:','Use\x20/start\x20to\x20begin.','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','📅\x20Date:\x20','\x20(@','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','\x20initialized\x20successfully','\x20via\x20single-line\x20input','toLocaleString','node-telegram-bot-api','ACTIVE','🏪\x20Available\x20shops\x20in\x20system:\x0a','username','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','🔌\x20User\x20','🌐\x20IP:\x20`','•\x20Payouts\x0a','Telegram\x20bot\x20error:','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','\x20parts:\x20','txid','env','✅\x20Telegram\x20bot\x20@','userAgent','🏪\x20Gateway:\x20`','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','chargebackAmount','name','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','last_name','failed','findFirst','default','3xTHtBu','method','pk_','botUsername','remitterIban','Payout\x20completed','en-US','\x0aCheck\x20spelling\x20and\x20try\x20again.','toString','🔍\x20*Debug\x20Information*\x0a\x0a','•\x20`','defineProperty','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Failed\x20login\x20attempt','📝\x20Order\x20ID:\x20`','📧\x20Email:\x20`','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','Commands:\x0a','Error\x20handling\x20/debug\x20command:','entries','318MjzjJh','allSettled','ipAddress','shopSettings','Error\x20handling\x20/status\x20command:','sk_','updatedAt','sendPaymentNotification','__esModule','test','711959XieSDH','TELEGRAM_BOT_USERNAME','isVerified','amount','*.\x0a\x0a','orderId','New\x20payment\x20created','create','../types/gateway','update','TelegramBotService','Username:\x20`','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','shop','❌\x20Invalid\x20username\x20format:\x20`',':\x20`','statusCode','📱\x20No\x20active\x20Telegram\x20users\x20found','Payment\x20successfully\x20paid','Payment\x20chargeback','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','sendMessage','❌\x20Error:\x20`','To\x20reconnect,\x20use\x20the\x20/start\x20command','3516993jTpjtM','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','customerName','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','\x20\x20\x20Status:\x20','•\x20Payment\x20status\x20changes\x0a','\x20USDT*\x0a','customerIp','Payment\x20failed','telegramId','shopId','\x20\x20\x20Public\x20Key:\x20`','../config/database','/status\x20-\x20check\x20connection\x20status\x0a','processing','includes','log','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','...','chat\x20not\x20found','first_name','\x20verified\x20for\x20shop\x20','Payment\x20refund','sendPayoutNotification','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','sendNotificationToAll','customerEmail','handleSingleLineVerification','Error\x20handling\x20message:','45740brumIy','Use\x20/start\x20to\x20connect.','\x22\x20->\x20display\x20\x22','Example:\x0a','1270834loSono','💻\x20Browser:\x20`','❌\x20Shop\x20`','botToken','`\x20not\x20found.\x0a\x0a','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','✅\x20Connected\x20to\x20shop:\x20*','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','customerUa','🔔\x20Notifications\x20are\x20active\x0a\x0a','•\x20Important\x20events\x0a\x0a','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','chargeback','gateway','message','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','text','stopBot','🔔\x20*','requestId','🆔\x20Payment\x20ID:\x20`','publicKey','User\x20','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','notificationApiError','🔔\x20You\x20receive\x20notifications\x20about:\x0a','onText','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','status'];a61_0x13fe=function(){return _0x4cde52;};return a61_0x13fe();}var __importDefault=this&&this[a61_0x55a4ff(0xfb)]||function(_0xdb752b){const _0x38cec7=a61_0x55a4ff;return _0xdb752b&&_0xdb752b[_0x38cec7(0x169)]?_0xdb752b:{'default':_0xdb752b};};Object[a61_0x55a4ff(0x157)](exports,'__esModule',{'value':!![]}),exports['telegramBotService']=exports[a61_0x55a4ff(0x175)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a61_0x55a4ff(0x134))),database_1=__importDefault(require(a61_0x55a4ff(0x192))),gateway_1=require(a61_0x55a4ff(0x173));class TelegramBotService{constructor(){const _0x50a437=a61_0x55a4ff;this[_0x50a437(0x129)]=null,this[_0x50a437(0xc1)]=process[_0x50a437(0x140)]['TELEGRAM_BOT_TOKEN']||'',this[_0x50a437(0x14f)]=process[_0x50a437(0x140)][_0x50a437(0x16c)]||'trapay_bot',this[_0x50a437(0xc1)]?this['initializeBot']():console[_0x50a437(0x111)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a61_0x55a4ff(0xfd)](){const _0x3f87b1=a61_0x55a4ff;try{this[_0x3f87b1(0x129)]=new node_telegram_bot_api_1['default'](this[_0x3f87b1(0xc1)],{'polling':!![]}),this[_0x3f87b1(0x11b)](),console[_0x3f87b1(0x196)](_0x3f87b1(0x141)+this[_0x3f87b1(0x14f)]+_0x3f87b1(0x131));}catch(_0x56838e){console[_0x3f87b1(0x106)](_0x3f87b1(0x138),_0x56838e);}}['setupBotHandlers'](){const _0x3e76e5=a61_0x55a4ff;if(!this['bot'])return;this[_0x3e76e5(0x129)]['onText'](/\/start/,async _0x501553=>{const _0x573031=_0x3e76e5,_0x1e37c7=_0x501553['chat']['id'],_0x12d863=_0x501553[_0x573031(0xfc)]?.['id'][_0x573031(0x154)](),_0x427f8b=_0x501553[_0x573031(0xfc)]?.['username'],_0x488d24=_0x501553['from']?.[_0x573031(0x19a)],_0x45a017=_0x501553['from']?.[_0x573031(0x148)];if(!_0x12d863)return;try{let _0x330209=await database_1[_0x573031(0x14b)]['telegramUser'][_0x573031(0xfe)]({'where':{'telegramId':_0x12d863},'include':{'shop':!![]}});!_0x330209?(_0x330209=await database_1[_0x573031(0x14b)][_0x573031(0xf6)][_0x573031(0x172)]({'data':{'telegramId':_0x12d863,'username':_0x427f8b,'firstName':_0x488d24,'lastName':_0x45a017,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x573031(0x196)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x12d863+_0x573031(0x12f)+_0x427f8b+')')):_0x330209=await database_1[_0x573031(0x14b)][_0x573031(0xf6)][_0x573031(0x174)]({'where':{'telegramId':_0x12d863},'data':{'username':_0x427f8b,'firstName':_0x488d24,'lastName':_0x45a017},'include':{'shop':!![]}}),_0x330209[_0x573031(0x16d)]&&_0x330209[_0x573031(0x190)]&&_0x330209['shop']?await this[_0x573031(0x129)]?.[_0x573031(0x183)](_0x1e37c7,_0x573031(0xdd)+(_0x573031(0xc9)+_0x330209[_0x573031(0x17b)]['name']+'*\x0a')+(_0x573031(0x176)+_0x330209[_0x573031(0x17b)][_0x573031(0x137)]+'`\x0a\x0a')+_0x573031(0xd7)+_0x573031(0x10a)+_0x573031(0x18b)+_0x573031(0x10f)+_0x573031(0x15e)+_0x573031(0x193)+_0x573031(0xf7),{'parse_mode':_0x573031(0xf9)}):(_0x330209[_0x573031(0x190)]&&!_0x330209['isVerified']&&(await database_1[_0x573031(0x14b)][_0x573031(0xf6)][_0x573031(0x174)]({'where':{'telegramId':_0x12d863},'data':{'shopId':null,'isVerified':![]}}),console[_0x573031(0x196)](_0x573031(0x102)+_0x12d863)),await this[_0x573031(0x129)]?.[_0x573031(0x183)](_0x1e37c7,_0x573031(0xe6)+_0x573031(0x113)+_0x573031(0x182)+'Example:\x0a'+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x573031(0x130),{'parse_mode':_0x573031(0xf9)}));}catch(_0x5cfbe8){console['error'](_0x573031(0x103),_0x5cfbe8),await this[_0x573031(0x129)]?.['sendMessage'](_0x1e37c7,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x3e76e5(0x129)]['onText'](/\/disconnect/,async _0x40e095=>{const _0x4aaab1=_0x3e76e5,_0x580a81=_0x40e095[_0x4aaab1(0x104)]['id'],_0x3034e3=_0x40e095[_0x4aaab1(0xfc)]?.['id'][_0x4aaab1(0x154)]();if(!_0x3034e3)return;try{const _0x10f199=await database_1[_0x4aaab1(0x14b)]['telegramUser']['findUnique']({'where':{'telegramId':_0x3034e3},'include':{'shop':!![]}});if(!_0x10f199||!_0x10f199[_0x4aaab1(0x16d)]||!_0x10f199[_0x4aaab1(0x190)]){await this[_0x4aaab1(0x129)]?.['sendMessage'](_0x580a81,_0x4aaab1(0x13d));return;}const _0x529397=_0x10f199[_0x4aaab1(0x17b)]?.[_0x4aaab1(0x146)]||'unknown\x20shop';await database_1['default']['telegramUser']['update']({'where':{'telegramId':_0x3034e3},'data':{'shopId':null,'isVerified':![]}}),console[_0x4aaab1(0x196)](_0x4aaab1(0x139)+_0x3034e3+_0x4aaab1(0xf4)+_0x10f199[_0x4aaab1(0x190)]),await this['bot']?.[_0x4aaab1(0x183)](_0x580a81,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x529397+_0x4aaab1(0x16f)+_0x4aaab1(0x185),{'parse_mode':_0x4aaab1(0xf9)});}catch(_0x5ee8ad){console['error']('Error\x20handling\x20/disconnect\x20command:',_0x5ee8ad),await this[_0x4aaab1(0x129)]?.[_0x4aaab1(0x183)](_0x580a81,_0x4aaab1(0x128));}}),this[_0x3e76e5(0x129)]['onText'](/\/status/,async _0x524b9e=>{const _0x329a25=_0x3e76e5,_0x3b17f3=_0x524b9e['chat']['id'],_0x184d2c=_0x524b9e['from']?.['id']['toString']();if(!_0x184d2c)return;try{const _0x1ce047=await database_1['default'][_0x329a25(0xf6)]['findUnique']({'where':{'telegramId':_0x184d2c},'include':{'shop':!![]}});if(!_0x1ce047){await this[_0x329a25(0x129)]?.[_0x329a25(0x183)](_0x3b17f3,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x329a25(0x12c));return;}if(!_0x1ce047[_0x329a25(0x16d)]||!_0x1ce047['shopId']||!_0x1ce047[_0x329a25(0x17b)]){await this[_0x329a25(0x129)]?.[_0x329a25(0x183)](_0x3b17f3,_0x329a25(0x11a)+_0x329a25(0xbb));return;}await this[_0x329a25(0x129)]?.[_0x329a25(0x183)](_0x3b17f3,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x329a25(0xc4)+_0x1ce047[_0x329a25(0x17b)][_0x329a25(0x146)]+'*\x0a')+(_0x329a25(0xe7)+_0x1ce047[_0x329a25(0x17b)][_0x329a25(0x137)]+'`\x0a')+(_0x329a25(0xf8)+_0x1ce047[_0x329a25(0x167)][_0x329a25(0xfa)](_0x329a25(0x152))+'\x0a\x0a')+_0x329a25(0xc7)+_0x329a25(0x15e)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x329a25(0xf9)});}catch(_0x58febb){console['error'](_0x329a25(0x165),_0x58febb),await this[_0x329a25(0x129)]?.[_0x329a25(0x183)](_0x3b17f3,_0x329a25(0x128));}}),this[_0x3e76e5(0x129)][_0x3e76e5(0xd8)](/\/debug/,async _0x171202=>{const _0x242577=_0x3e76e5,_0x589e52=_0x171202[_0x242577(0x104)]['id'],_0x4b63e9=_0x171202[_0x242577(0xfc)]?.['id'][_0x242577(0x154)]();if(!_0x4b63e9)return;try{const _0x2fc12b=await database_1[_0x242577(0x14b)]['shop'][_0x242577(0xe2)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x15723e=_0x242577(0x155);_0x15723e+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x4b63e9+'`\x0a\x0a',_0x15723e+=_0x242577(0x136),_0x2fc12b[_0x242577(0x10b)]((_0x73ee8a,_0x3aa900)=>{const _0x3a4d85=_0x242577;_0x15723e+=_0x3aa900+0x1+_0x3a4d85(0xe3)+_0x73ee8a[_0x3a4d85(0x146)]+'*\x0a',_0x15723e+='\x20\x20\x20Username:\x20`'+_0x73ee8a[_0x3a4d85(0x137)]+'`\x0a',_0x15723e+=_0x3a4d85(0x18a)+_0x73ee8a['status']+'\x0a',_0x15723e+=_0x3a4d85(0x191)+_0x73ee8a[_0x3a4d85(0xd3)][_0x3a4d85(0x127)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x242577(0x129)]?.[_0x242577(0x183)](_0x589e52,_0x15723e,{'parse_mode':_0x242577(0xf9)});}catch(_0xf60b13){console[_0x242577(0x106)](_0x242577(0x15f),_0xf60b13),await this[_0x242577(0x129)]?.[_0x242577(0x183)](_0x589e52,'❌\x20Error\x20getting\x20debug\x20information.');}}),this[_0x3e76e5(0x129)]['on']('message',async _0x122bd1=>{const _0x3bf0bf=_0x3e76e5;if(_0x122bd1[_0x3bf0bf(0xce)]?.['startsWith']('/'))return;const _0x5a31c0=_0x122bd1['chat']['id'],_0x30e906=_0x122bd1[_0x3bf0bf(0xfc)]?.['id'][_0x3bf0bf(0x154)](),_0x2eb3fa=_0x122bd1[_0x3bf0bf(0xce)]?.[_0x3bf0bf(0xf2)]();if(!_0x30e906||!_0x2eb3fa)return;try{const _0x2f1922=await database_1[_0x3bf0bf(0x14b)][_0x3bf0bf(0xf6)][_0x3bf0bf(0xfe)]({'where':{'telegramId':_0x30e906},'include':{'shop':!![]}});if(!_0x2f1922){await this[_0x3bf0bf(0x129)]?.['sendMessage'](_0x5a31c0,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x2f1922[_0x3bf0bf(0x16d)]&&_0x2f1922[_0x3bf0bf(0x190)]&&_0x2f1922['shop']){await this[_0x3bf0bf(0x129)]?.[_0x3bf0bf(0x183)](_0x5a31c0,_0x3bf0bf(0x12d)+_0x2f1922[_0x3bf0bf(0x17b)][_0x3bf0bf(0x146)]+_0x3bf0bf(0x16f)+_0x3bf0bf(0x19e),{'parse_mode':'Markdown'});return;}const _0x3e5bf8=_0x2eb3fa['split'](/\s+/);if(_0x3e5bf8[_0x3bf0bf(0x105)]!==0x2){await this['bot']?.['sendMessage'](_0x5a31c0,_0x3bf0bf(0x158)+_0x3bf0bf(0x182)+_0x3bf0bf(0xbd)+_0x3bf0bf(0x110)+('You\x20sent\x20'+_0x3e5bf8[_0x3bf0bf(0x105)]+_0x3bf0bf(0x13e)+_0x3e5bf8[_0x3bf0bf(0x107)](_0x149966=>'`'+_0x149966+'`')[_0x3bf0bf(0x125)](',\x20')),{'parse_mode':_0x3bf0bf(0xf9)});return;}const [_0x1267db,_0x2593c9]=_0x3e5bf8;console[_0x3bf0bf(0x196)](_0x3bf0bf(0x197)+_0x30e906+_0x3bf0bf(0x123)+_0x1267db+_0x3bf0bf(0xee)+_0x2593c9['substring'](0x0,0xa)+_0x3bf0bf(0xea)),await this[_0x3bf0bf(0x1a1)](_0x5a31c0,_0x30e906,_0x1267db,_0x2593c9);}catch(_0x4d8275){console[_0x3bf0bf(0x106)](_0x3bf0bf(0xb9),_0x4d8275),await this[_0x3bf0bf(0x129)]?.[_0x3bf0bf(0x183)](_0x5a31c0,_0x3bf0bf(0x128));}}),this[_0x3e76e5(0x129)]['on'](_0x3e76e5(0x106),_0x39b83b=>{const _0x418365=_0x3e76e5;console[_0x418365(0x106)](_0x418365(0x13c),_0x39b83b);}),this[_0x3e76e5(0x129)]['on']('polling_error',_0x53f0ab=>{const _0x27b405=_0x3e76e5;console[_0x27b405(0x106)]('Telegram\x20bot\x20polling\x20error:',_0x53f0ab);});}async['handleSingleLineVerification'](_0x158633,_0x4b527d,_0x27650b,_0x5143ae){const _0x2ab653=a61_0x55a4ff;try{console[_0x2ab653(0x196)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x4b527d+':\x20username=\x22'+_0x27650b+_0x2ab653(0xee)+_0x5143ae['substring'](0x0,0xa)+_0x2ab653(0xea));if(!_0x27650b||_0x27650b['length']<0x3||_0x27650b[_0x2ab653(0x105)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x2ab653(0x16a)](_0x27650b)){await this[_0x2ab653(0x129)]?.[_0x2ab653(0x183)](_0x158633,_0x2ab653(0x17c)+_0x27650b+_0x2ab653(0x117)+_0x2ab653(0x144),{'parse_mode':_0x2ab653(0xf9)});return;}if(!_0x5143ae||!_0x5143ae[_0x2ab653(0xe8)](_0x2ab653(0x14e))&&!_0x5143ae[_0x2ab653(0xe8)](_0x2ab653(0x166))){await this[_0x2ab653(0x129)]?.['sendMessage'](_0x158633,_0x2ab653(0xda)+_0x2ab653(0xc5),{'parse_mode':'Markdown'});return;}const _0xa7c05a=await database_1[_0x2ab653(0x14b)][_0x2ab653(0x17b)][_0x2ab653(0xfe)]({'where':{'username':_0x27650b},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0xa7c05a){const _0x1da43a=await database_1[_0x2ab653(0x14b)][_0x2ab653(0x17b)][_0x2ab653(0xe2)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x3971ac='❌\x20Shop\x20with\x20username\x20`'+_0x27650b+_0x2ab653(0xc2);_0x1da43a[_0x2ab653(0x105)]>0x0?(_0x3971ac+='Available\x20usernames:\x0a',_0x1da43a['forEach'](_0x119376=>{const _0x3985e1=_0x2ab653;_0x3971ac+=_0x3985e1(0x156)+_0x119376[_0x3985e1(0x137)]+'`\x20('+_0x119376[_0x3985e1(0x146)]+')\x0a';}),_0x3971ac+=_0x2ab653(0x153)):_0x3971ac+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x2ab653(0x129)]?.[_0x2ab653(0x183)](_0x158633,_0x3971ac,{'parse_mode':_0x2ab653(0xf9)});return;}if(_0xa7c05a[_0x2ab653(0xdb)]!==_0x2ab653(0x135)){await this[_0x2ab653(0x129)]?.[_0x2ab653(0x183)](_0x158633,_0x2ab653(0xc0)+_0x27650b+_0x2ab653(0x108)+'Contact\x20administrator.',{'parse_mode':_0x2ab653(0xf9)});return;}if(_0xa7c05a[_0x2ab653(0xd3)]!==_0x5143ae&&_0xa7c05a[_0x2ab653(0xe9)]!==_0x5143ae){await this['bot']?.[_0x2ab653(0x183)](_0x158633,_0x2ab653(0x10c)+_0x27650b+'`.\x0a\x0a'+_0x2ab653(0xd9)+_0x2ab653(0x11d),{'parse_mode':_0x2ab653(0xf9)});return;}const _0x5a56ab=await database_1[_0x2ab653(0x14b)][_0x2ab653(0xf6)][_0x2ab653(0x14a)]({'where':{'shopId':_0xa7c05a['id'],'isVerified':!![],'telegramId':{'not':_0x4b527d}}});if(_0x5a56ab){await this[_0x2ab653(0x129)]?.[_0x2ab653(0x183)](_0x158633,_0x2ab653(0x17a)+_0x27650b+'`.\x0a\x0a'+_0x2ab653(0x177),{'parse_mode':_0x2ab653(0xf9)});return;}await database_1[_0x2ab653(0x14b)][_0x2ab653(0xf6)]['update']({'where':{'telegramId':_0x4b527d},'data':{'shopId':_0xa7c05a['id'],'isVerified':!![]}}),await this[_0x2ab653(0x129)]?.[_0x2ab653(0x183)](_0x158633,'🎉\x20*Congratulations!*\x0a\x0a'+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('📱\x20Shop:\x20*'+_0xa7c05a[_0x2ab653(0x146)]+'*\x0a')+(_0x2ab653(0xe7)+_0xa7c05a[_0x2ab653(0x137)]+_0x2ab653(0x117))+_0x2ab653(0x178)+'•\x20New\x20payments\x0a'+_0x2ab653(0x18b)+_0x2ab653(0x13b)+_0x2ab653(0xc8)+'Commands:\x0a'+_0x2ab653(0x193)+_0x2ab653(0xf7),{'parse_mode':_0x2ab653(0xf9)}),console[_0x2ab653(0x196)]('✅\x20Telegram\x20user\x20'+_0x4b527d+_0x2ab653(0x19b)+_0xa7c05a[_0x2ab653(0x137)]+_0x2ab653(0x132));}catch(_0x3ee5e1){console['error']('Error\x20in\x20handleSingleLineVerification:',_0x3ee5e1),await this[_0x2ab653(0x129)]?.[_0x2ab653(0x183)](_0x158633,_0x2ab653(0x189));}}async[a61_0x55a4ff(0xeb)](_0x42d868,_0xbed3b1,_0x43f4d0){const _0x3df587=a61_0x55a4ff;if(!this[_0x3df587(0x129)]){console[_0x3df587(0x111)](_0x3df587(0xd5));return;}try{const _0x541643=await database_1[_0x3df587(0x14b)][_0x3df587(0xf6)][_0x3df587(0xe2)]({'where':{'shopId':_0x42d868,'isVerified':!![]}});if(_0x541643['length']===0x0){console['log'](_0x3df587(0xc3)+_0x42d868);return;}const _0x1d9457=_0x541643[_0x3df587(0x107)](async _0x134d59=>{const _0x1360a0=_0x3df587;try{await this[_0x1360a0(0x129)]?.[_0x1360a0(0x183)](_0x134d59[_0x1360a0(0x18f)],_0xbed3b1,_0x43f4d0),console[_0x1360a0(0x196)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x134d59[_0x1360a0(0x18f)]);}catch(_0x3e0f9a){console['error'](_0x1360a0(0x187)+_0x134d59['telegramId']+':',_0x3e0f9a),_0x3e0f9a instanceof Error&&(_0x3e0f9a['message']['includes'](_0x1360a0(0xf5))||_0x3e0f9a[_0x1360a0(0xcc)]['includes'](_0x1360a0(0x199))||_0x3e0f9a[_0x1360a0(0xcc)][_0x1360a0(0x195)](_0x1360a0(0xef)))&&(await database_1[_0x1360a0(0x14b)][_0x1360a0(0xf6)][_0x1360a0(0x174)]({'where':{'id':_0x134d59['id']},'data':{'isVerified':![]}}),console['log'](_0x1360a0(0xd4)+_0x134d59['telegramId']+_0x1360a0(0x10d)));}});await Promise[_0x3df587(0x162)](_0x1d9457);}catch(_0x4ca3c8){console[_0x3df587(0x106)](_0x3df587(0x120),_0x4ca3c8);}}async[a61_0x55a4ff(0x168)](_0x3b1af9,_0x47c008,_0x52caad){const _0x7dc8d5=a61_0x55a4ff,_0x47000f={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x48c750={'created':_0x7dc8d5(0x171),'paid':_0x7dc8d5(0x180),'failed':_0x7dc8d5(0x18e),'expired':'Payment\x20expired','refund':_0x7dc8d5(0x19c),'chargeback':_0x7dc8d5(0x181),'processing':'Payment\x20is\x20being\x20processed'},_0x5004f8=_0x47000f[_0x52caad],_0x5f2473=_0x48c750[_0x52caad],_0xb7ec8c=(0x0,gateway_1[_0x7dc8d5(0x11c)])(_0x47c008['gateway']);console[_0x7dc8d5(0x196)](_0x7dc8d5(0xe4)+_0x47c008[_0x7dc8d5(0xcb)]+_0x7dc8d5(0xbc)+_0xb7ec8c+'\x22');let _0x1875a3=_0x5004f8+'\x20*'+_0x5f2473+_0x7dc8d5(0x126)+(_0x7dc8d5(0x118)+_0x47c008[_0x7dc8d5(0x16e)]+'\x20'+_0x47c008[_0x7dc8d5(0xde)]+'*\x0a')+(_0x7dc8d5(0x15a)+(_0x47c008[_0x7dc8d5(0x170)]||_0x47c008['id'])+'`\x0a')+(_0x7dc8d5(0xd2)+_0x47c008['id']+'`\x0a')+(_0x7dc8d5(0x143)+_0xb7ec8c+'`\x0a')+(_0x7dc8d5(0x12e)+new Date(_0x47c008['createdAt'])[_0x7dc8d5(0x133)](_0x7dc8d5(0x152))+'\x0a');if(_0x47c008[_0x7dc8d5(0x188)]||_0x47c008[_0x7dc8d5(0x1a0)]||_0x47c008[_0x7dc8d5(0x150)]||_0x47c008['customerIp']||_0x47c008[_0x7dc8d5(0xc6)]){_0x1875a3+=_0x7dc8d5(0xed);_0x47c008[_0x7dc8d5(0x188)]&&(_0x1875a3+='📛\x20Name:\x20`'+_0x47c008[_0x7dc8d5(0x188)]+'`\x0a');_0x47c008[_0x7dc8d5(0x1a0)]&&(_0x1875a3+=_0x7dc8d5(0x15b)+_0x47c008[_0x7dc8d5(0x1a0)]+'`\x0a');_0x47c008[_0x7dc8d5(0x150)]&&(_0x1875a3+='🏦\x20IBAN:\x20`'+_0x47c008['remitterIban']+'`\x0a');_0x47c008[_0x7dc8d5(0x18d)]&&(_0x1875a3+=_0x7dc8d5(0x13a)+_0x47c008[_0x7dc8d5(0x18d)]+'`\x0a');if(_0x47c008[_0x7dc8d5(0xc6)]){const _0x2ddd46=_0x47c008[_0x7dc8d5(0xc6)][_0x7dc8d5(0x105)]>0x32?_0x47c008['customerUa'][_0x7dc8d5(0x127)](0x0,0x32)+'...':_0x47c008[_0x7dc8d5(0xc6)];_0x1875a3+='💻\x20Browser:\x20`'+_0x2ddd46+'`\x0a';}}_0x52caad===_0x7dc8d5(0xca)&&_0x47c008[_0x7dc8d5(0x145)]&&(_0x1875a3+=_0x7dc8d5(0x114)+_0x47c008['chargebackAmount']+_0x7dc8d5(0x18c)),_0x52caad===_0x7dc8d5(0x194)&&(_0x1875a3+=_0x7dc8d5(0x179)),_0x47c008['adminNotes']&&(_0x1875a3+='📝\x20Notes:\x20'+_0x47c008['adminNotes']+'\x0a'),await this[_0x7dc8d5(0xeb)](_0x3b1af9,_0x1875a3,{'parse_mode':_0x7dc8d5(0xf9)});}async[a61_0x55a4ff(0x19d)](_0x51aa10,_0x4659df,_0x260bdd){const _0x1eeed6=a61_0x55a4ff,_0x4401b6={'created':'📤','completed':'✅','rejected':'❌'},_0x471700={'created':_0x1eeed6(0x101),'completed':_0x1eeed6(0x151),'rejected':'Payout\x20rejected'},_0x1a78aa=_0x4401b6[_0x260bdd],_0x21a7da=_0x471700[_0x260bdd],_0xba2a4c=_0x1a78aa+'\x20*'+_0x21a7da+_0x1eeed6(0x126)+(_0x1eeed6(0x112)+_0x4659df[_0x1eeed6(0x16e)]+_0x1eeed6(0xe5))+(_0x1eeed6(0xff)+_0x4659df[_0x1eeed6(0x14d)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x4659df['id']+'`\x0a')+(_0x1eeed6(0x12e)+new Date(_0x4659df['createdAt'])[_0x1eeed6(0x133)](_0x1eeed6(0x152))+'\x0a')+(_0x4659df[_0x1eeed6(0x13f)]?_0x1eeed6(0xf3)+_0x4659df[_0x1eeed6(0x13f)]+'`':'');await this[_0x1eeed6(0xeb)](_0x51aa10,_0xba2a4c,{'parse_mode':'Markdown'});}async['sendLoginNotification'](_0x2377f1,_0x135dff){const _0x174f91=a61_0x55a4ff;try{const _0x38b4ea=await database_1['default']['shopSettings']['findUnique']({'where':{'shopId':_0x2377f1},'select':{'notificationLogin':!![]}});if(!_0x38b4ea?.[_0x174f91(0x10e)]){console[_0x174f91(0x196)](_0x174f91(0xcd)+_0x2377f1);return;}const _0x51b748=_0x135dff[_0x174f91(0xec)]?'🔐':'🚨',_0x9a82d7=_0x135dff['success']?'Successful\x20login':_0x174f91(0x159);let _0x5281da=_0x51b748+'\x20*'+_0x9a82d7+_0x174f91(0x126)+(_0x174f91(0xe7)+_0x135dff['username']+'`\x0a')+(_0x174f91(0xdc)+_0x135dff[_0x174f91(0x122)][_0x174f91(0x133)](_0x174f91(0x152))+'\x0a');_0x135dff[_0x174f91(0x163)]&&(_0x5281da+='🌐\x20IP\x20address:\x20`'+_0x135dff['ipAddress']+'`\x0a');if(_0x135dff[_0x174f91(0x142)]){const _0x549a34=_0x135dff[_0x174f91(0x142)][_0x174f91(0x105)]>0x32?_0x135dff[_0x174f91(0x142)][_0x174f91(0x127)](0x0,0x32)+_0x174f91(0x198):_0x135dff[_0x174f91(0x142)];_0x5281da+=_0x174f91(0xbf)+_0x549a34+'`\x0a';}!_0x135dff['success']&&(_0x5281da+=_0x174f91(0x147)),await this[_0x174f91(0xeb)](_0x2377f1,_0x5281da,{'parse_mode':_0x174f91(0xf9)}),console[_0x174f91(0x196)](_0x174f91(0x121)+_0x2377f1+':\x20'+(_0x135dff[_0x174f91(0xec)]?_0x174f91(0xec):_0x174f91(0x149)));}catch(_0x2ad73e){console[_0x174f91(0x106)](_0x174f91(0x12b),_0x2ad73e);}}async['sendApiErrorNotification'](_0x1a4ca9,_0x120b30){const _0x1938f5=a61_0x55a4ff;try{const _0x29ca86=await database_1[_0x1938f5(0x14b)][_0x1938f5(0x164)][_0x1938f5(0xfe)]({'where':{'shopId':_0x1a4ca9},'select':{'notificationApiError':!![]}});if(!_0x29ca86?.[_0x1938f5(0xd6)]){console[_0x1938f5(0x196)](_0x1938f5(0x15c)+_0x1a4ca9);return;}let _0x5880ac=_0x1938f5(0x109)+('🔗\x20Endpoint:\x20`'+_0x120b30['method']+'\x20'+_0x120b30[_0x1938f5(0x124)]+'`\x0a')+(_0x1938f5(0xdc)+_0x120b30[_0x1938f5(0x122)]['toLocaleString'](_0x1938f5(0x152))+'\x0a');_0x120b30[_0x1938f5(0x17e)]&&(_0x5880ac+='📊\x20Error\x20code:\x20`'+_0x120b30[_0x1938f5(0x17e)]+'`\x0a'),_0x5880ac+=_0x1938f5(0x184)+_0x120b30[_0x1938f5(0xf1)]+'`\x0a',_0x120b30[_0x1938f5(0xd1)]&&(_0x5880ac+=_0x1938f5(0xf0)+_0x120b30[_0x1938f5(0xd1)]+'`\x0a'),_0x5880ac+=_0x1938f5(0x15d),await this['sendShopNotification'](_0x1a4ca9,_0x5880ac,{'parse_mode':_0x1938f5(0xf9)}),console[_0x1938f5(0x196)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x1a4ca9+':\x20'+_0x120b30[_0x1938f5(0x124)]);}catch(_0x3e2d55){console['error'](_0x1938f5(0xe0),_0x3e2d55);}}async[a61_0x55a4ff(0xe1)](_0x2b619b,_0x2c3736,_0x1b0497){const _0x53724c=a61_0x55a4ff;let _0x4004f0=_0x53724c(0xd0)+_0x2c3736+_0x53724c(0x126);for(const [_0x54fcd1,_0x1f192a]of Object[_0x53724c(0x160)](_0x1b0497)){_0x1f192a!==null&&_0x1f192a!==undefined&&(_0x4004f0+=_0x54fcd1+_0x53724c(0x17d)+_0x1f192a+'`\x0a');}await this['sendShopNotification'](_0x2b619b,_0x4004f0,{'parse_mode':'Markdown'});}async[a61_0x55a4ff(0x19f)](_0x255332){const _0x3a50a7=a61_0x55a4ff;try{console[_0x3a50a7(0x196)](_0x3a50a7(0xdf)+_0x255332['substring'](0x0,0x32)+'...');const _0xedb6bd=await database_1['default'][_0x3a50a7(0xf6)][_0x3a50a7(0xe2)]({'select':{'telegramId':!![]}});if(_0xedb6bd['length']===0x0){console[_0x3a50a7(0x196)](_0x3a50a7(0x17f));return;}for(const _0x22e5b2 of _0xedb6bd){try{await this['bot']?.[_0x3a50a7(0x183)](_0x22e5b2[_0x3a50a7(0x18f)],_0x255332,{'parse_mode':_0x3a50a7(0xf9)});}catch(_0x239cc0){console[_0x3a50a7(0x106)](_0x3a50a7(0x116)+_0x22e5b2[_0x3a50a7(0x18f)]+':',_0x239cc0);}}console['log'](_0x3a50a7(0x12a)+_0xedb6bd[_0x3a50a7(0x105)]+'\x20users');}catch(_0xf54d84){console[_0x3a50a7(0x106)](_0x3a50a7(0x100),_0xf54d84);}}['getBotInfo'](){const _0x436580=a61_0x55a4ff;return{'isActive':!!this[_0x436580(0x129)],'username':this[_0x436580(0x14f)]};}[a61_0x55a4ff(0xcf)](){const _0x57ae84=a61_0x55a4ff;this[_0x57ae84(0x129)]&&(this[_0x57ae84(0x129)]['stopPolling'](),this['bot']=null,console['log']('🛑\x20Telegram\x20bot\x20stopped'));}}exports['TelegramBotService']=TelegramBotService,exports['telegramBotService']=new TelegramBotService();