'use strict';const a49_0x7c67ed=a49_0xe9a7;(function(_0x256257,_0x258a9a){const _0x3bb6a9=a49_0xe9a7,_0x2ffbe6=_0x256257();while(!![]){try{const _0x4c106f=-parseInt(_0x3bb6a9(0xe7))/0x1+parseInt(_0x3bb6a9(0x116))/0x2*(parseInt(_0x3bb6a9(0x119))/0x3)+parseInt(_0x3bb6a9(0x14c))/0x4+parseInt(_0x3bb6a9(0x129))/0x5+-parseInt(_0x3bb6a9(0x11e))/0x6*(parseInt(_0x3bb6a9(0x142))/0x7)+-parseInt(_0x3bb6a9(0x1a3))/0x8*(parseInt(_0x3bb6a9(0x14f))/0x9)+-parseInt(_0x3bb6a9(0x112))/0xa;if(_0x4c106f===_0x258a9a)break;else _0x2ffbe6['push'](_0x2ffbe6['shift']());}catch(_0x230a5b){_0x2ffbe6['push'](_0x2ffbe6['shift']());}}}(a49_0x251c,0xee13a));function a49_0x251c(){const _0x497da6=['error','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','telegramId','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','üì±\x20Created\x20new\x20Telegram\x20user:\x20','customerName','botUsername','/disconnect\x20-\x20disconnect\x20from\x20notifications','\x0aüí°\x20Check\x20your\x20request\x20or\x20contact\x20support.','ipAddress','allSettled','__importDefault','\x20initialized\x20successfully','sk_','Failed\x20to\x20send\x20API\x20error\x20notification:','findUnique','setupBotHandlers','...\x22','Failed\x20login\x20attempt','‚úÖ\x20Login\x20notification\x20sent\x20for\x20shop\x20','method','Successful\x20login','User\x20','Use\x20/start\x20to\x20begin.','notificationApiError','sendLoginNotification','\x22,\x20apiKey=\x22','üìù\x20Notes:\x20','\x20verified\x20for\x20shop\x20','Payment\x20refund','Error\x20in\x20handleSingleLineVerification:','orderId','üí∞\x20Amount:\x20*','\x20\x20\x20Status:\x20','unknown\x20shop','\x20\x20\x20Public\x20Key:\x20`','sendPayoutNotification','stopBot','amount','node-telegram-bot-api','Use\x20/start\x20to\x20connect.','length','To\x20reconnect,\x20use\x20the\x20/start\x20command','\x0aüë§\x20*Customer\x20Information:*\x0a','‚ùå\x20Invalid\x20API\x20key\x20format.\x0a\x0a','sendApiErrorNotification','üì±\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','8XCSAzQ','\x20disconnected\x20from\x20shop\x20','`\x20(','__esModule','split','You\x20sent\x20','üìÖ\x20Time:\x20','üö®\x20*API\x20Error*\x0a\x0a','üîó\x20TXID:\x20`','timestamp','substring','‚ùå\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','‚Ä¢\x20Payment\x20status\x20changes\x0a','../config/database','Markdown','../types/gateway','shopId','...`\x0a\x0a','join','update','üìù\x20Format:\x20`username\x20api_key`\x0a\x0a','handleSingleLineVerification','Payment\x20expired','toString','Payment\x20chargeback','\x0aCheck\x20spelling\x20and\x20try\x20again.','‚Ä¢\x20Payouts\x0a','statusCode','1328378oZOxWL','Payment\x20successfully\x20paid','‚ùå\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','‚úÖ\x20Connected\x20to\x20shop:\x20*','map','Failed\x20to\x20send\x20login\x20notification:','üõë\x20Telegram\x20bot\x20stopped',':\x20`','üë§\x20Username:\x20`','isVerified','\x20USD*\x0a','toLocaleString','üîå\x20User\x20','‚ùå\x20Error:\x20`','üè™\x20Available\x20shops\x20in\x20system:\x0a','üí∏\x20Amount:\x20*','blocked','üîÑ\x20Processing\x20single-line\x20verification\x20for\x20user\x20','first_name','chargebackAmount','‚ùå\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','`\x0a\x0a','New\x20payment\x20created','‚Ä¢\x20Important\x20events\x0a\x0a','‚úÖ\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','errorMessage','status','getBotInfo','‚ùå\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','initializeBot','üì±\x20Shop:\x20*','\x22\x20->\x20display\x20\x22','polling_error','üè™\x20Gateway:\x20`','customerEmail','username','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','`.\x0a\x0a','shopSettings','‚ùóÔ∏è\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','userAgent','üì±\x20Telegram\x20notification:\x20gateway\x20\x22','name','10708420wbKPbx','sendCustomNotification','*\x0a\x0a','Username:\x20`','878NDkfIl','‚úÖ\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','üÜî\x20Payment\x20ID:\x20`','9483tvFfvO','\x20USDT*\x0a','txid','message','env','240QBpCeg','.\x20*','\x20parts:\x20','Example:\x0a','‚è≥\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','forEach','findMany','TELEGRAM_BOT_USERNAME','log','‚ùå\x20Please\x20use\x20/start\x20command\x20first','\x20\x20\x20Username:\x20`','6425170JAzBvi','Available\x20usernames:\x0a','bot','from','botToken','üìä\x20Error\x20code:\x20`','shop','sendMessage','‚ùå\x20Shop\x20`','en-US','TelegramBotService','warn','create','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','startsWith','includes','Payout\x20rejected','‚ùå\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','‚Ä¢\x20Payouts\x0a\x0a','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','gateway','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','üè¶\x20Method:\x20`','üíª\x20Browser:\x20`','/status\x20-\x20check\x20connection\x20status\x0a','57449STGLWM','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','üìõ\x20Name:\x20`','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','‚ùå\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','‚úÖ\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','chat','text','üîç\x20*Debug\x20Information*\x0a\x0a','telegramUser','7006796iDoRJG','üìä\x20*Connection\x20Status*\x0a\x0a','`\x20not\x20found.\x0a\x0a','6495750qallXN','üìÖ\x20Date:\x20','‚úÖ\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','ü§ñ\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','üìÖ\x20Connection\x20date:\x20','onText','trim','Commands:\x0a','endpoint','adminNotes','default','üéâ\x20*Congratulations!*\x0a\x0a','success',':\x20username=\x22','Check\x20spelling\x20and\x20try\x20again.','publicKey','notificationLogin','processing','‚Ä¢\x20`','‚úÖ\x20Telegram\x20bot\x20@','Error\x20sending\x20shop\x20notification:','‚ùå\x20Invalid\x20username\x20format:\x20`','currency','TELEGRAM_BOT_TOKEN','Error\x20handling\x20/debug\x20command:','user\x20is\x20deactivated','requestId','sendShopNotification','pk_','üì±\x20Your\x20Telegram\x20ID:\x20`','...','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','‚Ä¢\x20New\x20payments\x0a','Contact\x20administrator.','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','üÜî\x20Payout\x20ID:\x20`','üí∏\x20Penalty\x20amount:\x20*'];a49_0x251c=function(){return _0x497da6;};return a49_0x251c();}var __importDefault=this&&this[a49_0x7c67ed(0x17f)]||function(_0x3a5fc7){const _0x28fc05=a49_0x7c67ed;return _0x3a5fc7&&_0x3a5fc7[_0x28fc05(0x1a6)]?_0x3a5fc7:{'default':_0x3a5fc7};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['telegramBotService']=exports[a49_0x7c67ed(0x133)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a49_0x7c67ed(0x19b))),database_1=__importDefault(require(a49_0x7c67ed(0xd8))),gateway_1=require(a49_0x7c67ed(0xda));class TelegramBotService{constructor(){const _0x4317e5=a49_0x7c67ed;this[_0x4317e5(0x12b)]=null,this[_0x4317e5(0x12d)]=process[_0x4317e5(0x11d)][_0x4317e5(0x166)]||'',this[_0x4317e5(0x17a)]=process[_0x4317e5(0x11d)][_0x4317e5(0x125)]||'trapay_bot',this[_0x4317e5(0x12d)]?this[_0x4317e5(0x104)]():console[_0x4317e5(0x134)](_0x4317e5(0x13e));}['initializeBot'](){const _0x20fb06=a49_0x7c67ed;try{this[_0x20fb06(0x12b)]=new node_telegram_bot_api_1[(_0x20fb06(0x159))](this[_0x20fb06(0x12d)],{'polling':!![]}),this[_0x20fb06(0x184)](),console[_0x20fb06(0x126)](_0x20fb06(0x162)+this[_0x20fb06(0x17a)]+_0x20fb06(0x180));}catch(_0x43794b){console['error']('‚ùå\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x43794b);}}['setupBotHandlers'](){const _0x4de768=a49_0x7c67ed;if(!this[_0x4de768(0x12b)])return;this[_0x4de768(0x12b)][_0x4de768(0x154)](/\/start/,async _0x7022ba=>{const _0x13c1b4=_0x4de768,_0x19842e=_0x7022ba[_0x13c1b4(0x148)]['id'],_0x39bf6=_0x7022ba[_0x13c1b4(0x12c)]?.['id'][_0x13c1b4(0xe2)](),_0x572816=_0x7022ba[_0x13c1b4(0x12c)]?.[_0x13c1b4(0x10a)],_0x2d6dc7=_0x7022ba[_0x13c1b4(0x12c)]?.[_0x13c1b4(0xf9)],_0x30fa6a=_0x7022ba['from']?.['last_name'];if(!_0x39bf6)return;try{let _0x3dd4c8=await database_1[_0x13c1b4(0x159)]['telegramUser'][_0x13c1b4(0x183)]({'where':{'telegramId':_0x39bf6},'include':{'shop':!![]}});!_0x3dd4c8?(_0x3dd4c8=await database_1[_0x13c1b4(0x159)][_0x13c1b4(0x14b)][_0x13c1b4(0x135)]({'data':{'telegramId':_0x39bf6,'username':_0x572816,'firstName':_0x2d6dc7,'lastName':_0x30fa6a,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x13c1b4(0x178)+_0x39bf6+'\x20(@'+_0x572816+')')):_0x3dd4c8=await database_1[_0x13c1b4(0x159)][_0x13c1b4(0x14b)]['update']({'where':{'telegramId':_0x39bf6},'data':{'username':_0x572816,'firstName':_0x2d6dc7,'lastName':_0x30fa6a},'include':{'shop':!![]}}),_0x3dd4c8[_0x13c1b4(0xf0)]&&_0x3dd4c8[_0x13c1b4(0xdb)]&&_0x3dd4c8['shop']?await this[_0x13c1b4(0x12b)]?.[_0x13c1b4(0x130)](_0x19842e,'‚úÖ\x20Welcome\x20back!\x0a\x0a'+(_0x13c1b4(0x16e)+_0x3dd4c8[_0x13c1b4(0x12f)][_0x13c1b4(0x111)]+'*\x0a')+(_0x13c1b4(0x115)+_0x3dd4c8[_0x13c1b4(0x12f)][_0x13c1b4(0x10a)]+_0x13c1b4(0xfc))+'üîî\x20You\x20receive\x20notifications\x20about:\x0a'+_0x13c1b4(0x16f)+'‚Ä¢\x20Payment\x20status\x20changes\x0a'+_0x13c1b4(0x13b)+_0x13c1b4(0x156)+_0x13c1b4(0x141)+_0x13c1b4(0x17b),{'parse_mode':'Markdown'}):(_0x3dd4c8[_0x13c1b4(0xdb)]&&!_0x3dd4c8[_0x13c1b4(0xf0)]&&(await database_1[_0x13c1b4(0x159)]['telegramUser'][_0x13c1b4(0xde)]({'where':{'telegramId':_0x39bf6},'data':{'shopId':null,'isVerified':![]}}),console[_0x13c1b4(0x126)]('üîÑ\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x39bf6)),await this[_0x13c1b4(0x12b)]?.[_0x13c1b4(0x130)](_0x19842e,_0x13c1b4(0x152)+_0x13c1b4(0x175)+_0x13c1b4(0xdf)+_0x13c1b4(0x121)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x13c1b4(0x10e),{'parse_mode':'Markdown'}));}catch(_0x5d903b){console[_0x13c1b4(0x174)]('Error\x20handling\x20/start\x20command:',_0x5d903b),await this['bot']?.[_0x13c1b4(0x130)](_0x19842e,_0x13c1b4(0xfb));}}),this[_0x4de768(0x12b)][_0x4de768(0x154)](/\/disconnect/,async _0x116b49=>{const _0x5b3ec4=_0x4de768,_0x5288a2=_0x116b49[_0x5b3ec4(0x148)]['id'],_0x1f81df=_0x116b49[_0x5b3ec4(0x12c)]?.['id'][_0x5b3ec4(0xe2)]();if(!_0x1f81df)return;try{const _0x1b463c=await database_1['default'][_0x5b3ec4(0x14b)][_0x5b3ec4(0x183)]({'where':{'telegramId':_0x1f81df},'include':{'shop':!![]}});if(!_0x1b463c||!_0x1b463c[_0x5b3ec4(0xf0)]||!_0x1b463c[_0x5b3ec4(0xdb)]){await this[_0x5b3ec4(0x12b)]?.[_0x5b3ec4(0x130)](_0x5288a2,_0x5b3ec4(0x13c));return;}const _0x3548ad=_0x1b463c[_0x5b3ec4(0x12f)]?.[_0x5b3ec4(0x111)]||_0x5b3ec4(0x196);await database_1[_0x5b3ec4(0x159)][_0x5b3ec4(0x14b)]['update']({'where':{'telegramId':_0x1f81df},'data':{'shopId':null,'isVerified':![]}}),console[_0x5b3ec4(0x126)](_0x5b3ec4(0xf3)+_0x1f81df+_0x5b3ec4(0x1a4)+_0x1b463c[_0x5b3ec4(0xdb)]),await this['bot']?.['sendMessage'](_0x5288a2,_0x5b3ec4(0x117)+_0x3548ad+'*.\x0a\x0a'+_0x5b3ec4(0x19e),{'parse_mode':_0x5b3ec4(0xd9)});}catch(_0x5d7451){console[_0x5b3ec4(0x174)]('Error\x20handling\x20/disconnect\x20command:',_0x5d7451),await this[_0x5b3ec4(0x12b)]?.[_0x5b3ec4(0x130)](_0x5288a2,_0x5b3ec4(0xfb));}}),this[_0x4de768(0x12b)][_0x4de768(0x154)](/\/status/,async _0x44c8a7=>{const _0x12d01f=_0x4de768,_0x52424f=_0x44c8a7[_0x12d01f(0x148)]['id'],_0x56adc9=_0x44c8a7['from']?.['id']['toString']();if(!_0x56adc9)return;try{const _0x511658=await database_1['default'][_0x12d01f(0x14b)]['findUnique']({'where':{'telegramId':_0x56adc9},'include':{'shop':!![]}});if(!_0x511658){await this[_0x12d01f(0x12b)]?.[_0x12d01f(0x130)](_0x52424f,_0x12d01f(0x13a)+_0x12d01f(0x18b));return;}if(!_0x511658[_0x12d01f(0xf0)]||!_0x511658[_0x12d01f(0xdb)]||!_0x511658[_0x12d01f(0x12f)]){await this[_0x12d01f(0x12b)]?.[_0x12d01f(0x130)](_0x52424f,'‚ùå\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x12d01f(0x19c));return;}await this[_0x12d01f(0x12b)]?.[_0x12d01f(0x130)](_0x52424f,_0x12d01f(0x14d)+(_0x12d01f(0xea)+_0x511658[_0x12d01f(0x12f)][_0x12d01f(0x111)]+'*\x0a')+('üë§\x20Username:\x20`'+_0x511658[_0x12d01f(0x12f)][_0x12d01f(0x10a)]+'`\x0a')+(_0x12d01f(0x153)+_0x511658['updatedAt']['toLocaleDateString']('en-US')+'\x0a\x0a')+'üîî\x20Notifications\x20are\x20active\x0a\x0a'+_0x12d01f(0x156)+_0x12d01f(0x17b),{'parse_mode':'Markdown'});}catch(_0x43260c){console['error']('Error\x20handling\x20/status\x20command:',_0x43260c),await this[_0x12d01f(0x12b)]?.[_0x12d01f(0x130)](_0x52424f,'‚ùå\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x4de768(0x12b)][_0x4de768(0x154)](/\/debug/,async _0x2632be=>{const _0x1a6f62=_0x4de768,_0x2ceca1=_0x2632be[_0x1a6f62(0x148)]['id'],_0x3d8245=_0x2632be[_0x1a6f62(0x12c)]?.['id'][_0x1a6f62(0xe2)]();if(!_0x3d8245)return;try{const _0x280519=await database_1[_0x1a6f62(0x159)][_0x1a6f62(0x12f)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4337d4=_0x1a6f62(0x14a);_0x4337d4+=_0x1a6f62(0x16c)+_0x3d8245+_0x1a6f62(0xfc),_0x4337d4+=_0x1a6f62(0xf5),_0x280519[_0x1a6f62(0x123)]((_0x1d8ee0,_0x3e88a2)=>{const _0x21734b=_0x1a6f62;_0x4337d4+=_0x3e88a2+0x1+_0x21734b(0x11f)+_0x1d8ee0[_0x21734b(0x111)]+'*\x0a',_0x4337d4+=_0x21734b(0x128)+_0x1d8ee0['username']+'`\x0a',_0x4337d4+=_0x21734b(0x195)+_0x1d8ee0[_0x21734b(0x101)]+'\x0a',_0x4337d4+=_0x21734b(0x197)+_0x1d8ee0[_0x21734b(0x15e)][_0x21734b(0xd5)](0x0,0xf)+_0x21734b(0xdc);}),await this[_0x1a6f62(0x12b)]?.['sendMessage'](_0x2ceca1,_0x4337d4,{'parse_mode':_0x1a6f62(0xd9)});}catch(_0x45de57){console[_0x1a6f62(0x174)](_0x1a6f62(0x167),_0x45de57),await this[_0x1a6f62(0x12b)]?.[_0x1a6f62(0x130)](_0x2ceca1,'‚ùå\x20Error\x20getting\x20debug\x20information.');}}),this[_0x4de768(0x12b)]['on']('message',async _0x35960c=>{const _0x4203cc=_0x4de768;if(_0x35960c[_0x4203cc(0x149)]?.[_0x4203cc(0x137)]('/'))return;const _0x2d8bc5=_0x35960c['chat']['id'],_0x5d1c53=_0x35960c[_0x4203cc(0x12c)]?.['id'][_0x4203cc(0xe2)](),_0x123b24=_0x35960c[_0x4203cc(0x149)]?.[_0x4203cc(0x155)]();if(!_0x5d1c53||!_0x123b24)return;try{const _0x233ea9=await database_1[_0x4203cc(0x159)][_0x4203cc(0x14b)]['findUnique']({'where':{'telegramId':_0x5d1c53},'include':{'shop':!![]}});if(!_0x233ea9){await this[_0x4203cc(0x12b)]?.['sendMessage'](_0x2d8bc5,_0x4203cc(0x127));return;}if(_0x233ea9[_0x4203cc(0xf0)]&&_0x233ea9[_0x4203cc(0xdb)]&&_0x233ea9[_0x4203cc(0x12f)]){await this['bot']?.[_0x4203cc(0x130)](_0x2d8bc5,_0x4203cc(0x151)+_0x233ea9['shop'][_0x4203cc(0x111)]+'*.\x0a\x0a'+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':'Markdown'});return;}const _0x3d7c49=_0x123b24[_0x4203cc(0x1a7)](/\s+/);if(_0x3d7c49[_0x4203cc(0x19d)]!==0x2){await this[_0x4203cc(0x12b)]?.['sendMessage'](_0x2d8bc5,_0x4203cc(0xe9)+_0x4203cc(0xdf)+_0x4203cc(0x121)+_0x4203cc(0x10b)+(_0x4203cc(0xd0)+_0x3d7c49[_0x4203cc(0x19d)]+_0x4203cc(0x120)+_0x3d7c49[_0x4203cc(0xeb)](_0x146a76=>'`'+_0x146a76+'`')[_0x4203cc(0xdd)](',\x20')),{'parse_mode':_0x4203cc(0xd9)});return;}const [_0x40e1bc,_0x88a448]=_0x3d7c49;console['log'](_0x4203cc(0xf8)+_0x5d1c53+_0x4203cc(0x15c)+_0x40e1bc+_0x4203cc(0x18e)+_0x88a448[_0x4203cc(0xd5)](0x0,0xa)+_0x4203cc(0x185)),await this[_0x4203cc(0xe0)](_0x2d8bc5,_0x5d1c53,_0x40e1bc,_0x88a448);}catch(_0x1a40dd){console[_0x4203cc(0x174)]('Error\x20handling\x20message:',_0x1a40dd),await this[_0x4203cc(0x12b)]?.[_0x4203cc(0x130)](_0x2d8bc5,_0x4203cc(0xfb));}}),this[_0x4de768(0x12b)]['on']('error',_0xcc7f06=>{console['error']('Telegram\x20bot\x20error:',_0xcc7f06);}),this[_0x4de768(0x12b)]['on'](_0x4de768(0x107),_0x1bb97c=>{const _0x2e0bce=_0x4de768;console[_0x2e0bce(0x174)]('Telegram\x20bot\x20polling\x20error:',_0x1bb97c);});}async[a49_0x7c67ed(0xe0)](_0xbdb483,_0x138365,_0x17a603,_0x3a3ee0){const _0x2e0e00=a49_0x7c67ed;try{console[_0x2e0e00(0x126)](_0x2e0e00(0xf8)+_0x138365+_0x2e0e00(0x15c)+_0x17a603+'\x22,\x20apiKey=\x22'+_0x3a3ee0['substring'](0x0,0xa)+_0x2e0e00(0x185));if(!_0x17a603||_0x17a603['length']<0x3||_0x17a603[_0x2e0e00(0x19d)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x17a603)){await this[_0x2e0e00(0x12b)]?.[_0x2e0e00(0x130)](_0xbdb483,_0x2e0e00(0x164)+_0x17a603+_0x2e0e00(0xfc)+_0x2e0e00(0x177),{'parse_mode':_0x2e0e00(0xd9)});return;}if(!_0x3a3ee0||!_0x3a3ee0['startsWith'](_0x2e0e00(0x16b))&&!_0x3a3ee0[_0x2e0e00(0x137)](_0x2e0e00(0x181))){await this[_0x2e0e00(0x12b)]?.['sendMessage'](_0xbdb483,_0x2e0e00(0x1a0)+_0x2e0e00(0x171),{'parse_mode':_0x2e0e00(0xd9)});return;}const _0x132117=await database_1[_0x2e0e00(0x159)][_0x2e0e00(0x12f)][_0x2e0e00(0x183)]({'where':{'username':_0x17a603},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x132117){const _0x445066=await database_1[_0x2e0e00(0x159)][_0x2e0e00(0x12f)][_0x2e0e00(0x124)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x3ff491='‚ùå\x20Shop\x20with\x20username\x20`'+_0x17a603+_0x2e0e00(0x14e);_0x445066[_0x2e0e00(0x19d)]>0x0?(_0x3ff491+=_0x2e0e00(0x12a),_0x445066['forEach'](_0x26fd02=>{const _0x4ae7bd=_0x2e0e00;_0x3ff491+=_0x4ae7bd(0x161)+_0x26fd02[_0x4ae7bd(0x10a)]+_0x4ae7bd(0x1a5)+_0x26fd02[_0x4ae7bd(0x111)]+')\x0a';}),_0x3ff491+=_0x2e0e00(0xe4)):_0x3ff491+=_0x2e0e00(0x15d);await this[_0x2e0e00(0x12b)]?.['sendMessage'](_0xbdb483,_0x3ff491,{'parse_mode':_0x2e0e00(0xd9)});return;}if(_0x132117['status']!=='ACTIVE'){await this['bot']?.[_0x2e0e00(0x130)](_0xbdb483,_0x2e0e00(0x131)+_0x17a603+'`\x20is\x20inactive.\x0a\x0a'+_0x2e0e00(0x170),{'parse_mode':_0x2e0e00(0xd9)});return;}if(_0x132117[_0x2e0e00(0x15e)]!==_0x3a3ee0&&_0x132117['secretKey']!==_0x3a3ee0){await this['bot']?.['sendMessage'](_0xbdb483,'‚ùå\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x17a603+_0x2e0e00(0x10c)+_0x2e0e00(0x143)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x2e0e00(0xd9)});return;}const _0x566447=await database_1[_0x2e0e00(0x159)][_0x2e0e00(0x14b)]['findFirst']({'where':{'shopId':_0x132117['id'],'isVerified':!![],'telegramId':{'not':_0x138365}}});if(_0x566447){await this[_0x2e0e00(0x12b)]?.[_0x2e0e00(0x130)](_0xbdb483,_0x2e0e00(0x146)+_0x17a603+_0x2e0e00(0x10c)+_0x2e0e00(0x136),{'parse_mode':_0x2e0e00(0xd9)});return;}await database_1[_0x2e0e00(0x159)]['telegramUser'][_0x2e0e00(0xde)]({'where':{'telegramId':_0x138365},'data':{'shopId':_0x132117['id'],'isVerified':!![]}}),await this[_0x2e0e00(0x12b)]?.['sendMessage'](_0xbdb483,_0x2e0e00(0x15a)+_0x2e0e00(0xff)+(_0x2e0e00(0x105)+_0x132117[_0x2e0e00(0x111)]+'*\x0a')+(_0x2e0e00(0xef)+_0x132117[_0x2e0e00(0x10a)]+_0x2e0e00(0xfc))+'üîî\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x2e0e00(0x16f)+_0x2e0e00(0xd7)+_0x2e0e00(0xe5)+_0x2e0e00(0xfe)+_0x2e0e00(0x156)+_0x2e0e00(0x141)+_0x2e0e00(0x17b),{'parse_mode':_0x2e0e00(0xd9)}),console['log']('‚úÖ\x20Telegram\x20user\x20'+_0x138365+_0x2e0e00(0x190)+_0x132117[_0x2e0e00(0x10a)]+'\x20via\x20single-line\x20input');}catch(_0x24b069){console[_0x2e0e00(0x174)](_0x2e0e00(0x192),_0x24b069),await this[_0x2e0e00(0x12b)]?.[_0x2e0e00(0x130)](_0xbdb483,_0x2e0e00(0x103));}}async[a49_0x7c67ed(0x16a)](_0x2f2c7c,_0x3927fa,_0x15cf72){const _0x413593=a49_0x7c67ed;if(!this[_0x413593(0x12b)]){console[_0x413593(0x134)](_0x413593(0x145));return;}try{const _0x5689f4=await database_1[_0x413593(0x159)]['telegramUser']['findMany']({'where':{'shopId':_0x2f2c7c,'isVerified':!![]}});if(_0x5689f4['length']===0x0){console['log']('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x2f2c7c);return;}const _0x57939c=_0x5689f4[_0x413593(0xeb)](async _0x3a0cfb=>{const _0xc81e0d=_0x413593;try{await this['bot']?.[_0xc81e0d(0x130)](_0x3a0cfb['telegramId'],_0x3927fa,_0x15cf72),console[_0xc81e0d(0x126)](_0xc81e0d(0x147)+_0x3a0cfb[_0xc81e0d(0x176)]);}catch(_0x4ec1de){console['error'](_0xc81e0d(0xd6)+_0x3a0cfb[_0xc81e0d(0x176)]+':',_0x4ec1de),_0x4ec1de instanceof Error&&(_0x4ec1de[_0xc81e0d(0x11c)][_0xc81e0d(0x138)](_0xc81e0d(0xf7))||_0x4ec1de[_0xc81e0d(0x11c)]['includes']('chat\x20not\x20found')||_0x4ec1de['message'][_0xc81e0d(0x138)](_0xc81e0d(0x168)))&&(await database_1[_0xc81e0d(0x159)][_0xc81e0d(0x14b)][_0xc81e0d(0xde)]({'where':{'id':_0x3a0cfb['id']},'data':{'isVerified':![]}}),console[_0xc81e0d(0x126)](_0xc81e0d(0x18a)+_0x3a0cfb['telegramId']+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x413593(0x17e)](_0x57939c);}catch(_0x11316b){console[_0x413593(0x174)](_0x413593(0x163),_0x11316b);}}async['sendPaymentNotification'](_0x267a5b,_0x25b5e2,_0x5d99c4){const _0x3a34a7=a49_0x7c67ed,_0x1b429e={'created':'üÜï','paid':'‚úÖ','failed':'‚ùå','expired':'‚è∞','refund':'üîÑ','chargeback':'‚ö†Ô∏è','processing':'‚öôÔ∏è'},_0x2a4bd9={'created':_0x3a34a7(0xfd),'paid':_0x3a34a7(0xe8),'failed':'Payment\x20failed','expired':_0x3a34a7(0xe1),'refund':_0x3a34a7(0x191),'chargeback':_0x3a34a7(0xe3),'processing':'Payment\x20is\x20being\x20processed'},_0x448219=_0x1b429e[_0x5d99c4],_0x32eaa3=_0x2a4bd9[_0x5d99c4],_0x9bffd4=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x25b5e2['gateway']);console[_0x3a34a7(0x126)](_0x3a34a7(0x110)+_0x25b5e2[_0x3a34a7(0x13d)]+_0x3a34a7(0x106)+_0x9bffd4+'\x22');let _0x12b0c7=_0x448219+'\x20*'+_0x32eaa3+'*\x0a\x0a'+(_0x3a34a7(0x194)+_0x25b5e2['amount']+'\x20'+_0x25b5e2[_0x3a34a7(0x165)]+'*\x0a')+('üìù\x20Order\x20ID:\x20`'+(_0x25b5e2[_0x3a34a7(0x193)]||_0x25b5e2['id'])+'`\x0a')+(_0x3a34a7(0x118)+_0x25b5e2['id']+'`\x0a')+(_0x3a34a7(0x108)+_0x9bffd4+'`\x0a')+(_0x3a34a7(0x150)+new Date(_0x25b5e2['createdAt'])[_0x3a34a7(0xf2)]('en-US')+'\x0a');(_0x25b5e2[_0x3a34a7(0x179)]||_0x25b5e2[_0x3a34a7(0x109)])&&(_0x12b0c7+=_0x3a34a7(0x19f),_0x25b5e2[_0x3a34a7(0x179)]&&(_0x12b0c7+=_0x3a34a7(0x144)+_0x25b5e2['customerName']+'`\x0a'),_0x25b5e2[_0x3a34a7(0x109)]&&(_0x12b0c7+='üìß\x20Email:\x20`'+_0x25b5e2[_0x3a34a7(0x109)]+'`\x0a')),_0x5d99c4==='chargeback'&&_0x25b5e2[_0x3a34a7(0xfa)]&&(_0x12b0c7+=_0x3a34a7(0x173)+_0x25b5e2[_0x3a34a7(0xfa)]+_0x3a34a7(0x11a)),_0x5d99c4===_0x3a34a7(0x160)&&(_0x12b0c7+=_0x3a34a7(0x122)),_0x25b5e2[_0x3a34a7(0x158)]&&(_0x12b0c7+=_0x3a34a7(0x18f)+_0x25b5e2[_0x3a34a7(0x158)]+'\x0a'),await this[_0x3a34a7(0x16a)](_0x267a5b,_0x12b0c7,{'parse_mode':_0x3a34a7(0xd9)});}async[a49_0x7c67ed(0x198)](_0x579dc3,_0xb94501,_0x381a86){const _0x5d6fed=a49_0x7c67ed,_0x66e8d0={'created':'üì§','completed':'‚úÖ','rejected':'‚ùå'},_0x4f7c1b={'created':'New\x20payout\x20created','completed':'Payout\x20completed','rejected':_0x5d6fed(0x139)},_0x501f73=_0x66e8d0[_0x381a86],_0x4cefea=_0x4f7c1b[_0x381a86],_0x1fcd36=_0x501f73+'\x20*'+_0x4cefea+_0x5d6fed(0x114)+(_0x5d6fed(0xf6)+_0xb94501[_0x5d6fed(0x19a)]+_0x5d6fed(0xf1))+(_0x5d6fed(0x13f)+_0xb94501[_0x5d6fed(0x188)]+'`\x0a')+(_0x5d6fed(0x172)+_0xb94501['id']+'`\x0a')+(_0x5d6fed(0x150)+new Date(_0xb94501['createdAt'])[_0x5d6fed(0xf2)]('en-US')+'\x0a')+(_0xb94501[_0x5d6fed(0x11b)]?_0x5d6fed(0xd3)+_0xb94501[_0x5d6fed(0x11b)]+'`':'');await this[_0x5d6fed(0x16a)](_0x579dc3,_0x1fcd36,{'parse_mode':_0x5d6fed(0xd9)});}async[a49_0x7c67ed(0x18d)](_0x53df7d,_0x2ae1b0){const _0x403506=a49_0x7c67ed;try{const _0x5673d8=await database_1['default'][_0x403506(0x10d)]['findUnique']({'where':{'shopId':_0x53df7d},'select':{'notificationLogin':!![]}});if(!_0x5673d8?.[_0x403506(0x15f)]){console[_0x403506(0x126)](_0x403506(0x1a2)+_0x53df7d);return;}const _0x47e19b=_0x2ae1b0['success']?'üîê':'üö®',_0x2797b9=_0x2ae1b0[_0x403506(0x15b)]?_0x403506(0x189):_0x403506(0x186);let _0x406bae=_0x47e19b+'\x20*'+_0x2797b9+_0x403506(0x114)+(_0x403506(0xef)+_0x2ae1b0[_0x403506(0x10a)]+'`\x0a')+(_0x403506(0xd1)+_0x2ae1b0[_0x403506(0xd4)][_0x403506(0xf2)]('en-US')+'\x0a');_0x2ae1b0['ipAddress']&&(_0x406bae+='üåê\x20IP\x20address:\x20`'+_0x2ae1b0[_0x403506(0x17d)]+'`\x0a');if(_0x2ae1b0[_0x403506(0x10f)]){const _0x88df93=_0x2ae1b0[_0x403506(0x10f)]['length']>0x32?_0x2ae1b0[_0x403506(0x10f)][_0x403506(0xd5)](0x0,0x32)+_0x403506(0x16d):_0x2ae1b0['userAgent'];_0x406bae+=_0x403506(0x140)+_0x88df93+'`\x0a';}!_0x2ae1b0[_0x403506(0x15b)]&&(_0x406bae+='\x0a‚ö†Ô∏è\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x403506(0x16a)](_0x53df7d,_0x406bae,{'parse_mode':'Markdown'}),console[_0x403506(0x126)](_0x403506(0x187)+_0x53df7d+':\x20'+(_0x2ae1b0['success']?_0x403506(0x15b):'failed'));}catch(_0x1f934b){console[_0x403506(0x174)](_0x403506(0xec),_0x1f934b);}}async[a49_0x7c67ed(0x1a1)](_0x480204,_0x4aea05){const _0x299ca8=a49_0x7c67ed;try{const _0x39ba23=await database_1[_0x299ca8(0x159)][_0x299ca8(0x10d)][_0x299ca8(0x183)]({'where':{'shopId':_0x480204},'select':{'notificationApiError':!![]}});if(!_0x39ba23?.[_0x299ca8(0x18c)]){console[_0x299ca8(0x126)]('üì±\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x480204);return;}let _0x65f59f=_0x299ca8(0xd2)+('üîó\x20Endpoint:\x20`'+_0x4aea05[_0x299ca8(0x188)]+'\x20'+_0x4aea05[_0x299ca8(0x157)]+'`\x0a')+(_0x299ca8(0xd1)+_0x4aea05['timestamp']['toLocaleString'](_0x299ca8(0x132))+'\x0a');_0x4aea05[_0x299ca8(0xe6)]&&(_0x65f59f+=_0x299ca8(0x12e)+_0x4aea05[_0x299ca8(0xe6)]+'`\x0a'),_0x65f59f+=_0x299ca8(0xf4)+_0x4aea05[_0x299ca8(0x100)]+'`\x0a',_0x4aea05[_0x299ca8(0x169)]&&(_0x65f59f+='üÜî\x20Request\x20ID:\x20`'+_0x4aea05['requestId']+'`\x0a'),_0x65f59f+=_0x299ca8(0x17c),await this[_0x299ca8(0x16a)](_0x480204,_0x65f59f,{'parse_mode':'Markdown'}),console[_0x299ca8(0x126)]('‚úÖ\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x480204+':\x20'+_0x4aea05[_0x299ca8(0x157)]);}catch(_0x3d1aa4){console[_0x299ca8(0x174)](_0x299ca8(0x182),_0x3d1aa4);}}async[a49_0x7c67ed(0x113)](_0x355a90,_0xb68ed8,_0x4e14c4){const _0x1b4b0b=a49_0x7c67ed;let _0x3ac67b='üîî\x20*'+_0xb68ed8+'*\x0a\x0a';for(const [_0x12bf89,_0x2dfcaf]of Object['entries'](_0x4e14c4)){_0x2dfcaf!==null&&_0x2dfcaf!==undefined&&(_0x3ac67b+=_0x12bf89+_0x1b4b0b(0xee)+_0x2dfcaf+'`\x0a');}await this[_0x1b4b0b(0x16a)](_0x355a90,_0x3ac67b,{'parse_mode':_0x1b4b0b(0xd9)});}[a49_0x7c67ed(0x102)](){const _0x818555=a49_0x7c67ed;return{'isActive':!!this[_0x818555(0x12b)],'username':this[_0x818555(0x17a)]};}[a49_0x7c67ed(0x199)](){const _0x212642=a49_0x7c67ed;this[_0x212642(0x12b)]&&(this['bot']['stopPolling'](),this[_0x212642(0x12b)]=null,console[_0x212642(0x126)](_0x212642(0xed)));}}function a49_0xe9a7(_0x29be02,_0xcf860b){const _0x251c9e=a49_0x251c();return a49_0xe9a7=function(_0xe9a757,_0x59e477){_0xe9a757=_0xe9a757-0xd0;let _0x4f8991=_0x251c9e[_0xe9a757];return _0x4f8991;},a49_0xe9a7(_0x29be02,_0xcf860b);}exports['TelegramBotService']=TelegramBotService,exports['telegramBotService']=new TelegramBotService();