'use strict';function a55_0x3be2(_0x2dc8d4,_0x55a3fd){const _0x32bb94=a55_0x32bb();return a55_0x3be2=function(_0x3be22c,_0x2b275a){_0x3be22c=_0x3be22c-0x137;let _0x10a996=_0x32bb94[_0x3be22c];return _0x10a996;},a55_0x3be2(_0x2dc8d4,_0x55a3fd);}const a55_0x540ec5=a55_0x3be2;(function(_0x36d8cd,_0x58e4da){const _0x1ed999=a55_0x3be2,_0x4698c4=_0x36d8cd();while(!![]){try{const _0x504c7b=-parseInt(_0x1ed999(0x1b3))/0x1*(-parseInt(_0x1ed999(0x208))/0x2)+-parseInt(_0x1ed999(0x18d))/0x3+parseInt(_0x1ed999(0x16b))/0x4+parseInt(_0x1ed999(0x1c6))/0x5*(parseInt(_0x1ed999(0x1da))/0x6)+parseInt(_0x1ed999(0x178))/0x7+parseInt(_0x1ed999(0x16e))/0x8*(-parseInt(_0x1ed999(0x198))/0x9)+parseInt(_0x1ed999(0x1e9))/0xa*(parseInt(_0x1ed999(0x191))/0xb);if(_0x504c7b===_0x58e4da)break;else _0x4698c4['push'](_0x4698c4['shift']());}catch(_0x5809cb){_0x4698c4['push'](_0x4698c4['shift']());}}}(a55_0x32bb,0x1b54b));var __importDefault=this&&this[a55_0x540ec5(0x1d5)]||function(_0x46b98b){const _0x1f687f=a55_0x540ec5;return _0x46b98b&&_0x46b98b[_0x1f687f(0x173)]?_0x46b98b:{'default':_0x46b98b};};function a55_0x32bb(){const _0x248e32=['📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','218104OpYiGH','warn','📅\x20Time:\x20','message','/disconnect\x20-\x20disconnect\x20from\x20notifications','__esModule','Successful\x20login','unknown\x20shop','toString','log','578942HdqptH','TelegramBotService','getGatewayDisplayNameForTelegram','🔔\x20Notifications\x20are\x20active\x0a\x0a','sk_','`\x0a\x0a','\x20\x20\x20Username:\x20`','map','•\x20Payment\x20status\x20changes\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','updatedAt','en-US','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','`\x20(','Use\x20/start\x20to\x20connect.','update','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','sendShopNotification','chargebackAmount','597420EkUegS','botToken','Error\x20handling\x20/start\x20command:','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','11LnSgmC','startsWith','notificationApiError','ACTIVE','\x0aCheck\x20spelling\x20and\x20try\x20again.','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','/status\x20-\x20check\x20connection\x20status\x0a','63pgtLEM','notificationLogin','text','•\x20Payouts\x0a','\x20\x20\x20Public\x20Key:\x20`','status','sendCustomNotification','...`\x0a\x0a','initializeBot','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','💰\x20Amount:\x20*','findUnique','✅\x20Welcome\x20back!\x0a\x0a','bot','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','endpoint','processing','user\x20is\x20deactivated','includes','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Commands:\x0a','orderId','gateway','allSettled','📊\x20*Connection\x20Status*\x0a\x0a','success','77015DsVGYp','\x20disconnected\x20from\x20shop\x20','\x0a👤\x20*Customer\x20Information:*\x0a','Example:\x0a','sendApiErrorNotification','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','📅\x20Date:\x20','userAgent','New\x20payout\x20created','chargeback','statusCode','📧\x20Email:\x20`','TELEGRAM_BOT_TOKEN','🛑\x20Telegram\x20bot\x20stopped','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','Payment\x20failed','create','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','trim','4965aLPhjd','customerEmail','🌐\x20IP\x20address:\x20`','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','...','adminNotes','isVerified','Error\x20handling\x20/disconnect\x20command:','telegramUser','💸\x20Amount:\x20*','sendMessage','User\x20','toLocaleString','Payment\x20is\x20being\x20processed','customerUa','__importDefault','💻\x20Browser:\x20`','Failed\x20to\x20send\x20API\x20error\x20notification:','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','shopId','12ZgYvvh','❌\x20Shop\x20`','📱\x20Created\x20new\x20Telegram\x20user:\x20','default','Error\x20handling\x20/status\x20command:','txid','❌\x20Error\x20getting\x20debug\x20information.','entries','getBotInfo','\x20parts:\x20','Available\x20usernames:\x0a','chat\x20not\x20found','✅\x20Telegram\x20bot\x20@','✅\x20Connected\x20to\x20shop:\x20*','createdAt','2514740IwuIBp','`\x20not\x20found.\x0a\x0a','currency','polling_error','❌\x20Invalid\x20username\x20format:\x20`','trapay_bot','handleSingleLineVerification','❌\x20Shop\x20with\x20username\x20`','remitterIban','defineProperty','\x20USD*\x0a','\x20USDT*\x0a','\x22,\x20apiKey=\x22','findMany','customerName','You\x20sent\x20','telegramId','Error\x20handling\x20/debug\x20command:','env','Payment\x20expired',':\x20`','\x20(@','📅\x20Connection\x20date:\x20','.\x20*','🌐\x20IP:\x20`','name','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','🔗\x20Endpoint:\x20`','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','from','error','2btnRYo','shopSettings','chat',':\x20username=\x22','sendPaymentNotification','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','publicKey','\x20verified\x20for\x20shop\x20','last_name','New\x20payment\x20created','🏪\x20Available\x20shops\x20in\x20system:\x0a','`.\x0a\x0a','Markdown','🔌\x20User\x20','Payment\x20refund','botUsername','amount','ipAddress','substring','username','onText','sendLoginNotification','join','toLocaleDateString','stopPolling','shop','blocked','setupBotHandlers','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','👤\x20Username:\x20`','To\x20reconnect,\x20use\x20the\x20/start\x20command','*.\x0a\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Payout\x20completed','sendPayoutNotification','🔗\x20TXID:\x20`','\x20\x20\x20Status:\x20','Username:\x20`','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','telegramBotService','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','failed','../types/gateway','customerIp','pk_','length','•\x20New\x20payments\x0a','\x20initialized\x20successfully','📱\x20Your\x20Telegram\x20ID:\x20`','🆔\x20Request\x20ID:\x20`','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','requestId','\x20via\x20single-line\x20input','forEach','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','*\x0a\x0a','`\x20is\x20inactive.\x0a\x0a','Check\x20spelling\x20and\x20try\x20again.','TELEGRAM_BOT_USERNAME','🆔\x20Payout\x20ID:\x20`','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','node-telegram-bot-api','354988niaAFv','timestamp'];a55_0x32bb=function(){return _0x248e32;};return a55_0x32bb();}Object[a55_0x540ec5(0x1f2)](exports,'__esModule',{'value':!![]}),exports[a55_0x540ec5(0x154)]=exports[a55_0x540ec5(0x179)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a55_0x540ec5(0x16a))),database_1=__importDefault(require('../config/database')),gateway_1=require(a55_0x540ec5(0x157));class TelegramBotService{constructor(){const _0x5ebce8=a55_0x540ec5;this['bot']=null,this['botToken']=process[_0x5ebce8(0x1fb)][_0x5ebce8(0x1bf)]||'',this[_0x5ebce8(0x13c)]=process[_0x5ebce8(0x1fb)][_0x5ebce8(0x167)]||_0x5ebce8(0x1ee),this[_0x5ebce8(0x18e)]?this[_0x5ebce8(0x1a0)]():console[_0x5ebce8(0x16f)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a55_0x540ec5(0x1a0)](){const _0x148bee=a55_0x540ec5;try{this[_0x148bee(0x1a5)]=new node_telegram_bot_api_1[(_0x148bee(0x1dd))](this[_0x148bee(0x18e)],{'polling':!![]}),this[_0x148bee(0x148)](),console[_0x148bee(0x177)](_0x148bee(0x1e6)+this[_0x148bee(0x13c)]+_0x148bee(0x15c));}catch(_0x112cff){console[_0x148bee(0x207)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x112cff);}}[a55_0x540ec5(0x148)](){const _0x204f45=a55_0x540ec5;if(!this[_0x204f45(0x1a5)])return;this['bot']['onText'](/\/start/,async _0x3db40d=>{const _0x10be5a=_0x204f45,_0x46a99d=_0x3db40d['chat']['id'],_0x5ebc1f=_0x3db40d['from']?.['id'][_0x10be5a(0x176)](),_0x28513b=_0x3db40d[_0x10be5a(0x206)]?.[_0x10be5a(0x140)],_0x3a9c1c=_0x3db40d[_0x10be5a(0x206)]?.['first_name'],_0x226261=_0x3db40d['from']?.[_0x10be5a(0x210)];if(!_0x5ebc1f)return;try{let _0x3db24f=await database_1['default'][_0x10be5a(0x1ce)][_0x10be5a(0x1a3)]({'where':{'telegramId':_0x5ebc1f},'include':{'shop':!![]}});!_0x3db24f?(_0x3db24f=await database_1[_0x10be5a(0x1dd)][_0x10be5a(0x1ce)][_0x10be5a(0x1c3)]({'data':{'telegramId':_0x5ebc1f,'username':_0x28513b,'firstName':_0x3a9c1c,'lastName':_0x226261,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x10be5a(0x1dc)+_0x5ebc1f+_0x10be5a(0x1fe)+_0x28513b+')')):_0x3db24f=await database_1[_0x10be5a(0x1dd)]['telegramUser'][_0x10be5a(0x189)]({'where':{'telegramId':_0x5ebc1f},'data':{'username':_0x28513b,'firstName':_0x3a9c1c,'lastName':_0x226261},'include':{'shop':!![]}}),_0x3db24f[_0x10be5a(0x1cc)]&&_0x3db24f[_0x10be5a(0x1d9)]&&_0x3db24f[_0x10be5a(0x146)]?await this[_0x10be5a(0x1a5)]?.[_0x10be5a(0x1d0)](_0x46a99d,_0x10be5a(0x1a4)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x3db24f['shop'][_0x10be5a(0x202)]+'*\x0a')+(_0x10be5a(0x152)+_0x3db24f[_0x10be5a(0x146)][_0x10be5a(0x140)]+_0x10be5a(0x17d))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x10be5a(0x15b)+_0x10be5a(0x180)+'•\x20Payouts\x0a\x0a'+'Commands:\x0a'+_0x10be5a(0x197)+_0x10be5a(0x172),{'parse_mode':'Markdown'}):(_0x3db24f[_0x10be5a(0x1d9)]&&!_0x3db24f[_0x10be5a(0x1cc)]&&(await database_1[_0x10be5a(0x1dd)]['telegramUser'][_0x10be5a(0x189)]({'where':{'telegramId':_0x5ebc1f},'data':{'shopId':null,'isVerified':![]}}),console[_0x10be5a(0x177)](_0x10be5a(0x163)+_0x5ebc1f)),await this['bot']?.[_0x10be5a(0x1d0)](_0x46a99d,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x10be5a(0x1b6)+_0x10be5a(0x181)+_0x10be5a(0x182),{'parse_mode':_0x10be5a(0x139)}));}catch(_0x1fc42c){console['error'](_0x10be5a(0x18f),_0x1fc42c),await this[_0x10be5a(0x1a5)]?.[_0x10be5a(0x1d0)](_0x46a99d,_0x10be5a(0x1a6));}}),this[_0x204f45(0x1a5)]['onText'](/\/disconnect/,async _0xe2c17f=>{const _0x4a1ec2=_0x204f45,_0x19e63d=_0xe2c17f[_0x4a1ec2(0x20a)]['id'],_0x188dea=_0xe2c17f[_0x4a1ec2(0x206)]?.['id'][_0x4a1ec2(0x176)]();if(!_0x188dea)return;try{const _0x21aaf9=await database_1[_0x4a1ec2(0x1dd)][_0x4a1ec2(0x1ce)]['findUnique']({'where':{'telegramId':_0x188dea},'include':{'shop':!![]}});if(!_0x21aaf9||!_0x21aaf9['isVerified']||!_0x21aaf9[_0x4a1ec2(0x1d9)]){await this[_0x4a1ec2(0x1a5)]?.['sendMessage'](_0x19e63d,_0x4a1ec2(0x196));return;}const _0x1fa9dc=_0x21aaf9[_0x4a1ec2(0x146)]?.['name']||_0x4a1ec2(0x175);await database_1[_0x4a1ec2(0x1dd)][_0x4a1ec2(0x1ce)]['update']({'where':{'telegramId':_0x188dea},'data':{'shopId':null,'isVerified':![]}}),console[_0x4a1ec2(0x177)](_0x4a1ec2(0x13a)+_0x188dea+_0x4a1ec2(0x1b4)+_0x21aaf9[_0x4a1ec2(0x1d9)]),await this[_0x4a1ec2(0x1a5)]?.['sendMessage'](_0x19e63d,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x1fa9dc+_0x4a1ec2(0x14c)+_0x4a1ec2(0x14b),{'parse_mode':_0x4a1ec2(0x139)});}catch(_0x40f4c1){console['error'](_0x4a1ec2(0x1cd),_0x40f4c1),await this[_0x4a1ec2(0x1a5)]?.[_0x4a1ec2(0x1d0)](_0x19e63d,_0x4a1ec2(0x1a6));}}),this['bot'][_0x204f45(0x141)](/\/status/,async _0x3f7a0d=>{const _0x5d411b=_0x204f45,_0x593c44=_0x3f7a0d[_0x5d411b(0x20a)]['id'],_0x53a0fe=_0x3f7a0d[_0x5d411b(0x206)]?.['id']['toString']();if(!_0x53a0fe)return;try{const _0x410a24=await database_1['default'][_0x5d411b(0x1ce)]['findUnique']({'where':{'telegramId':_0x53a0fe},'include':{'shop':!![]}});if(!_0x410a24){await this['bot']?.[_0x5d411b(0x1d0)](_0x593c44,_0x5d411b(0x183)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x410a24[_0x5d411b(0x1cc)]||!_0x410a24[_0x5d411b(0x1d9)]||!_0x410a24[_0x5d411b(0x146)]){await this[_0x5d411b(0x1a5)]?.['sendMessage'](_0x593c44,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x5d411b(0x188));return;}await this[_0x5d411b(0x1a5)]?.[_0x5d411b(0x1d0)](_0x593c44,_0x5d411b(0x1b1)+(_0x5d411b(0x1e7)+_0x410a24['shop']['name']+'*\x0a')+(_0x5d411b(0x14a)+_0x410a24[_0x5d411b(0x146)][_0x5d411b(0x140)]+'`\x0a')+(_0x5d411b(0x1ff)+_0x410a24[_0x5d411b(0x184)][_0x5d411b(0x144)](_0x5d411b(0x185))+'\x0a\x0a')+_0x5d411b(0x17b)+_0x5d411b(0x1ad)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'});}catch(_0x1d3d20){console[_0x5d411b(0x207)](_0x5d411b(0x1de),_0x1d3d20),await this[_0x5d411b(0x1a5)]?.[_0x5d411b(0x1d0)](_0x593c44,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x204f45(0x1a5)]['onText'](/\/debug/,async _0x3259b5=>{const _0x229b05=_0x204f45,_0x864704=_0x3259b5['chat']['id'],_0x51b86c=_0x3259b5['from']?.['id'][_0x229b05(0x176)]();if(!_0x51b86c)return;try{const _0x59ff46=await database_1[_0x229b05(0x1dd)][_0x229b05(0x146)][_0x229b05(0x1f6)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4c470e='🔍\x20*Debug\x20Information*\x0a\x0a';_0x4c470e+=_0x229b05(0x15d)+_0x51b86c+_0x229b05(0x17d),_0x4c470e+=_0x229b05(0x137),_0x59ff46[_0x229b05(0x162)]((_0x2803ef,_0x36303c)=>{const _0xcb14b6=_0x229b05;_0x4c470e+=_0x36303c+0x1+_0xcb14b6(0x200)+_0x2803ef[_0xcb14b6(0x202)]+'*\x0a',_0x4c470e+=_0xcb14b6(0x17e)+_0x2803ef[_0xcb14b6(0x140)]+'`\x0a',_0x4c470e+=_0xcb14b6(0x151)+_0x2803ef[_0xcb14b6(0x19d)]+'\x0a',_0x4c470e+=_0xcb14b6(0x19c)+_0x2803ef[_0xcb14b6(0x20e)][_0xcb14b6(0x13f)](0x0,0xf)+_0xcb14b6(0x19f);}),await this[_0x229b05(0x1a5)]?.[_0x229b05(0x1d0)](_0x864704,_0x4c470e,{'parse_mode':_0x229b05(0x139)});}catch(_0x3bd6bf){console['error'](_0x229b05(0x1fa),_0x3bd6bf),await this[_0x229b05(0x1a5)]?.[_0x229b05(0x1d0)](_0x864704,_0x229b05(0x1e0));}}),this[_0x204f45(0x1a5)]['on'](_0x204f45(0x171),async _0x1324d3=>{const _0x201dde=_0x204f45;if(_0x1324d3[_0x201dde(0x19a)]?.['startsWith']('/'))return;const _0x2d9980=_0x1324d3[_0x201dde(0x20a)]['id'],_0x5218c9=_0x1324d3[_0x201dde(0x206)]?.['id'][_0x201dde(0x176)](),_0x5a6c7a=_0x1324d3['text']?.[_0x201dde(0x1c5)]();if(!_0x5218c9||!_0x5a6c7a)return;try{const _0x29195e=await database_1[_0x201dde(0x1dd)][_0x201dde(0x1ce)][_0x201dde(0x1a3)]({'where':{'telegramId':_0x5218c9},'include':{'shop':!![]}});if(!_0x29195e){await this[_0x201dde(0x1a5)]?.['sendMessage'](_0x2d9980,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x29195e[_0x201dde(0x1cc)]&&_0x29195e[_0x201dde(0x1d9)]&&_0x29195e[_0x201dde(0x146)]){await this[_0x201dde(0x1a5)]?.[_0x201dde(0x1d0)](_0x2d9980,_0x201dde(0x1b8)+_0x29195e[_0x201dde(0x146)][_0x201dde(0x202)]+_0x201dde(0x14c)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x201dde(0x139)});return;}const _0xec8ff6=_0x5a6c7a['split'](/\s+/);if(_0xec8ff6['length']!==0x2){await this[_0x201dde(0x1a5)]?.['sendMessage'](_0x2d9980,_0x201dde(0x1ac)+_0x201dde(0x20d)+_0x201dde(0x1b6)+_0x201dde(0x181)+(_0x201dde(0x1f8)+_0xec8ff6[_0x201dde(0x15a)]+_0x201dde(0x1e3)+_0xec8ff6[_0x201dde(0x17f)](_0x5d7055=>'`'+_0x5d7055+'`')[_0x201dde(0x143)](',\x20')),{'parse_mode':_0x201dde(0x139)});return;}const [_0x5c2b1e,_0x593a62]=_0xec8ff6;console[_0x201dde(0x177)](_0x201dde(0x1c9)+_0x5218c9+_0x201dde(0x20b)+_0x5c2b1e+_0x201dde(0x1f5)+_0x593a62['substring'](0x0,0xa)+'...\x22'),await this[_0x201dde(0x1ef)](_0x2d9980,_0x5218c9,_0x5c2b1e,_0x593a62);}catch(_0x46c9b8){console[_0x201dde(0x207)]('Error\x20handling\x20message:',_0x46c9b8),await this['bot']?.[_0x201dde(0x1d0)](_0x2d9980,_0x201dde(0x1a6));}}),this['bot']['on']('error',_0x5167a4=>{const _0x3f0ef7=_0x204f45;console[_0x3f0ef7(0x207)]('Telegram\x20bot\x20error:',_0x5167a4);}),this[_0x204f45(0x1a5)]['on'](_0x204f45(0x1ec),_0x116c07=>{console['error']('Telegram\x20bot\x20polling\x20error:',_0x116c07);});}async[a55_0x540ec5(0x1ef)](_0x4d9b65,_0x6e063f,_0x3b1f02,_0xb3553a){const _0x10c61f=a55_0x540ec5;try{console[_0x10c61f(0x177)](_0x10c61f(0x1c9)+_0x6e063f+_0x10c61f(0x20b)+_0x3b1f02+'\x22,\x20apiKey=\x22'+_0xb3553a['substring'](0x0,0xa)+'...\x22');if(!_0x3b1f02||_0x3b1f02[_0x10c61f(0x15a)]<0x3||_0x3b1f02[_0x10c61f(0x15a)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x3b1f02)){await this[_0x10c61f(0x1a5)]?.['sendMessage'](_0x4d9b65,_0x10c61f(0x1ed)+_0x3b1f02+_0x10c61f(0x17d)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x10c61f(0x139)});return;}if(!_0xb3553a||!_0xb3553a[_0x10c61f(0x192)](_0x10c61f(0x159))&&!_0xb3553a[_0x10c61f(0x192)](_0x10c61f(0x17c))){await this[_0x10c61f(0x1a5)]?.['sendMessage'](_0x4d9b65,_0x10c61f(0x1c1)+_0x10c61f(0x190),{'parse_mode':'Markdown'});return;}const _0x1982ec=await database_1[_0x10c61f(0x1dd)][_0x10c61f(0x146)]['findUnique']({'where':{'username':_0x3b1f02},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x1982ec){const _0x253afe=await database_1['default']['shop'][_0x10c61f(0x1f6)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x275d86=_0x10c61f(0x1f0)+_0x3b1f02+_0x10c61f(0x1ea);_0x253afe['length']>0x0?(_0x275d86+=_0x10c61f(0x1e4),_0x253afe[_0x10c61f(0x162)](_0xef0879=>{const _0x20a8ff=_0x10c61f;_0x275d86+='•\x20`'+_0xef0879[_0x20a8ff(0x140)]+_0x20a8ff(0x187)+_0xef0879[_0x20a8ff(0x202)]+')\x0a';}),_0x275d86+=_0x10c61f(0x195)):_0x275d86+=_0x10c61f(0x166);await this[_0x10c61f(0x1a5)]?.[_0x10c61f(0x1d0)](_0x4d9b65,_0x275d86,{'parse_mode':_0x10c61f(0x139)});return;}if(_0x1982ec[_0x10c61f(0x19d)]!==_0x10c61f(0x194)){await this[_0x10c61f(0x1a5)]?.['sendMessage'](_0x4d9b65,_0x10c61f(0x1db)+_0x3b1f02+_0x10c61f(0x165)+'Contact\x20administrator.',{'parse_mode':_0x10c61f(0x139)});return;}if(_0x1982ec['publicKey']!==_0xb3553a&&_0x1982ec['secretKey']!==_0xb3553a){await this[_0x10c61f(0x1a5)]?.[_0x10c61f(0x1d0)](_0x4d9b65,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x3b1f02+_0x10c61f(0x138)+_0x10c61f(0x1d8)+_0x10c61f(0x18a),{'parse_mode':_0x10c61f(0x139)});return;}const _0x257d5a=await database_1['default'][_0x10c61f(0x1ce)]['findFirst']({'where':{'shopId':_0x1982ec['id'],'isVerified':!![],'telegramId':{'not':_0x6e063f}}});if(_0x257d5a){await this['bot']?.[_0x10c61f(0x1d0)](_0x4d9b65,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x3b1f02+_0x10c61f(0x138)+_0x10c61f(0x1a7),{'parse_mode':_0x10c61f(0x139)});return;}await database_1['default']['telegramUser']['update']({'where':{'telegramId':_0x6e063f},'data':{'shopId':_0x1982ec['id'],'isVerified':!![]}}),await this[_0x10c61f(0x1a5)]?.[_0x10c61f(0x1d0)](_0x4d9b65,'🎉\x20*Congratulations!*\x0a\x0a'+_0x10c61f(0x205)+('📱\x20Shop:\x20*'+_0x1982ec[_0x10c61f(0x202)]+'*\x0a')+(_0x10c61f(0x14a)+_0x1982ec['username']+_0x10c61f(0x17d))+_0x10c61f(0x153)+_0x10c61f(0x15b)+'•\x20Payment\x20status\x20changes\x0a'+_0x10c61f(0x19b)+'•\x20Important\x20events\x0a\x0a'+_0x10c61f(0x1ad)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x10c61f(0x172),{'parse_mode':_0x10c61f(0x139)}),console[_0x10c61f(0x177)]('✅\x20Telegram\x20user\x20'+_0x6e063f+_0x10c61f(0x20f)+_0x1982ec[_0x10c61f(0x140)]+_0x10c61f(0x161));}catch(_0x43acd3){console[_0x10c61f(0x207)]('Error\x20in\x20handleSingleLineVerification:',_0x43acd3),await this['bot']?.[_0x10c61f(0x1d0)](_0x4d9b65,_0x10c61f(0x14d));}}async[a55_0x540ec5(0x18b)](_0xc45ae2,_0x1d6916,_0x1383a4){const _0x47efac=a55_0x540ec5;if(!this[_0x47efac(0x1a5)]){console[_0x47efac(0x16f)](_0x47efac(0x203));return;}try{const _0x58207a=await database_1['default'][_0x47efac(0x1ce)][_0x47efac(0x1f6)]({'where':{'shopId':_0xc45ae2,'isVerified':!![]}});if(_0x58207a[_0x47efac(0x15a)]===0x0){console[_0x47efac(0x177)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0xc45ae2);return;}const _0x17d0cc=_0x58207a[_0x47efac(0x17f)](async _0x2a5159=>{const _0x169804=_0x47efac;try{await this[_0x169804(0x1a5)]?.[_0x169804(0x1d0)](_0x2a5159['telegramId'],_0x1d6916,_0x1383a4),console[_0x169804(0x177)](_0x169804(0x15f)+_0x2a5159['telegramId']);}catch(_0x2f2dff){console[_0x169804(0x207)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x2a5159['telegramId']+':',_0x2f2dff),_0x2f2dff instanceof Error&&(_0x2f2dff[_0x169804(0x171)]['includes'](_0x169804(0x147))||_0x2f2dff[_0x169804(0x171)][_0x169804(0x1ab)](_0x169804(0x1e5))||_0x2f2dff[_0x169804(0x171)][_0x169804(0x1ab)](_0x169804(0x1aa)))&&(await database_1['default'][_0x169804(0x1ce)]['update']({'where':{'id':_0x2a5159['id']},'data':{'isVerified':![]}}),console[_0x169804(0x177)](_0x169804(0x1d1)+_0x2a5159[_0x169804(0x1f9)]+_0x169804(0x1a1)));}});await Promise[_0x47efac(0x1b0)](_0x17d0cc);}catch(_0x173754){console[_0x47efac(0x207)]('Error\x20sending\x20shop\x20notification:',_0x173754);}}async[a55_0x540ec5(0x20c)](_0x380d38,_0x2d133b,_0x4e7a3b){const _0x519aa9=a55_0x540ec5,_0x197990={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x2a1d0a={'created':_0x519aa9(0x211),'paid':'Payment\x20successfully\x20paid','failed':_0x519aa9(0x1c2),'expired':_0x519aa9(0x1fc),'refund':_0x519aa9(0x13b),'chargeback':'Payment\x20chargeback','processing':_0x519aa9(0x1d3)},_0xbe14cb=_0x197990[_0x4e7a3b],_0x21d368=_0x2a1d0a[_0x4e7a3b],_0x3cfd81=(0x0,gateway_1[_0x519aa9(0x17a)])(_0x2d133b[_0x519aa9(0x1af)]);console['log']('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x2d133b[_0x519aa9(0x1af)]+'\x22\x20->\x20display\x20\x22'+_0x3cfd81+'\x22');let _0x5466d1=_0xbe14cb+'\x20*'+_0x21d368+_0x519aa9(0x164)+(_0x519aa9(0x1a2)+_0x2d133b['amount']+'\x20'+_0x2d133b[_0x519aa9(0x1eb)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x2d133b[_0x519aa9(0x1ae)]||_0x2d133b['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x2d133b['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x3cfd81+'`\x0a')+(_0x519aa9(0x1b9)+new Date(_0x2d133b[_0x519aa9(0x1e8)])[_0x519aa9(0x1d2)](_0x519aa9(0x185))+'\x0a');if(_0x2d133b[_0x519aa9(0x1f7)]||_0x2d133b[_0x519aa9(0x1c7)]||_0x2d133b[_0x519aa9(0x1f1)]||_0x2d133b[_0x519aa9(0x158)]||_0x2d133b[_0x519aa9(0x1d4)]){_0x5466d1+=_0x519aa9(0x1b5);_0x2d133b['customerName']&&(_0x5466d1+='📛\x20Name:\x20`'+_0x2d133b[_0x519aa9(0x1f7)]+'`\x0a');_0x2d133b['customerEmail']&&(_0x5466d1+=_0x519aa9(0x1be)+_0x2d133b[_0x519aa9(0x1c7)]+'`\x0a');_0x2d133b[_0x519aa9(0x1f1)]&&(_0x5466d1+='🏦\x20IBAN:\x20`'+_0x2d133b[_0x519aa9(0x1f1)]+'`\x0a');_0x2d133b[_0x519aa9(0x158)]&&(_0x5466d1+=_0x519aa9(0x201)+_0x2d133b[_0x519aa9(0x158)]+'`\x0a');if(_0x2d133b[_0x519aa9(0x1d4)]){const _0xf857ea=_0x2d133b[_0x519aa9(0x1d4)]['length']>0x32?_0x2d133b[_0x519aa9(0x1d4)]['substring'](0x0,0x32)+_0x519aa9(0x1ca):_0x2d133b['customerUa'];_0x5466d1+=_0x519aa9(0x1d6)+_0xf857ea+'`\x0a';}}_0x4e7a3b===_0x519aa9(0x1bc)&&_0x2d133b[_0x519aa9(0x18c)]&&(_0x5466d1+='💸\x20Penalty\x20amount:\x20*'+_0x2d133b[_0x519aa9(0x18c)]+_0x519aa9(0x1f4)),_0x4e7a3b===_0x519aa9(0x1a9)&&(_0x5466d1+=_0x519aa9(0x149)),_0x2d133b[_0x519aa9(0x1cb)]&&(_0x5466d1+='📝\x20Notes:\x20'+_0x2d133b[_0x519aa9(0x1cb)]+'\x0a'),await this[_0x519aa9(0x18b)](_0x380d38,_0x5466d1,{'parse_mode':'Markdown'});}async[a55_0x540ec5(0x14f)](_0x14306a,_0x8cf079,_0x4c9149){const _0x4fc2dd=a55_0x540ec5,_0x2e6de8={'created':'📤','completed':'✅','rejected':'❌'},_0x365955={'created':_0x4fc2dd(0x1bb),'completed':_0x4fc2dd(0x14e),'rejected':'Payout\x20rejected'},_0x1f7f27=_0x2e6de8[_0x4c9149],_0x84fcf9=_0x365955[_0x4c9149],_0x2453de=_0x1f7f27+'\x20*'+_0x84fcf9+_0x4fc2dd(0x164)+(_0x4fc2dd(0x1cf)+_0x8cf079[_0x4fc2dd(0x13d)]+_0x4fc2dd(0x1f3))+('🏦\x20Method:\x20`'+_0x8cf079['method']+'`\x0a')+(_0x4fc2dd(0x168)+_0x8cf079['id']+'`\x0a')+(_0x4fc2dd(0x1b9)+new Date(_0x8cf079['createdAt'])['toLocaleString'](_0x4fc2dd(0x185))+'\x0a')+(_0x8cf079[_0x4fc2dd(0x1df)]?_0x4fc2dd(0x150)+_0x8cf079[_0x4fc2dd(0x1df)]+'`':'');await this[_0x4fc2dd(0x18b)](_0x14306a,_0x2453de,{'parse_mode':_0x4fc2dd(0x139)});}async[a55_0x540ec5(0x142)](_0x151b38,_0xbff7ef){const _0x1282f1=a55_0x540ec5;try{const _0x2f7ac1=await database_1[_0x1282f1(0x1dd)][_0x1282f1(0x209)][_0x1282f1(0x1a3)]({'where':{'shopId':_0x151b38},'select':{'notificationLogin':!![]}});if(!_0x2f7ac1?.[_0x1282f1(0x199)]){console['log']('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x151b38);return;}const _0x2f9394=_0xbff7ef[_0x1282f1(0x1b2)]?'🔐':'🚨',_0x58cc53=_0xbff7ef[_0x1282f1(0x1b2)]?_0x1282f1(0x174):'Failed\x20login\x20attempt';let _0x207234=_0x2f9394+'\x20*'+_0x58cc53+_0x1282f1(0x164)+(_0x1282f1(0x14a)+_0xbff7ef['username']+'`\x0a')+(_0x1282f1(0x170)+_0xbff7ef[_0x1282f1(0x16c)]['toLocaleString']('en-US')+'\x0a');_0xbff7ef[_0x1282f1(0x13e)]&&(_0x207234+=_0x1282f1(0x1c8)+_0xbff7ef[_0x1282f1(0x13e)]+'`\x0a');if(_0xbff7ef[_0x1282f1(0x1ba)]){const _0x199190=_0xbff7ef[_0x1282f1(0x1ba)][_0x1282f1(0x15a)]>0x32?_0xbff7ef[_0x1282f1(0x1ba)][_0x1282f1(0x13f)](0x0,0x32)+_0x1282f1(0x1ca):_0xbff7ef[_0x1282f1(0x1ba)];_0x207234+=_0x1282f1(0x1d6)+_0x199190+'`\x0a';}!_0xbff7ef[_0x1282f1(0x1b2)]&&(_0x207234+=_0x1282f1(0x155)),await this['sendShopNotification'](_0x151b38,_0x207234,{'parse_mode':'Markdown'}),console[_0x1282f1(0x177)](_0x1282f1(0x1c4)+_0x151b38+':\x20'+(_0xbff7ef[_0x1282f1(0x1b2)]?_0x1282f1(0x1b2):_0x1282f1(0x156)));}catch(_0x3401e4){console[_0x1282f1(0x207)]('Failed\x20to\x20send\x20login\x20notification:',_0x3401e4);}}async[a55_0x540ec5(0x1b7)](_0x59beef,_0x30693b){const _0x3b697b=a55_0x540ec5;try{const _0x3e44f8=await database_1[_0x3b697b(0x1dd)][_0x3b697b(0x209)][_0x3b697b(0x1a3)]({'where':{'shopId':_0x59beef},'select':{'notificationApiError':!![]}});if(!_0x3e44f8?.[_0x3b697b(0x193)]){console[_0x3b697b(0x177)](_0x3b697b(0x16d)+_0x59beef);return;}let _0xfe6a10='🚨\x20*API\x20Error*\x0a\x0a'+(_0x3b697b(0x204)+_0x30693b['method']+'\x20'+_0x30693b[_0x3b697b(0x1a8)]+'`\x0a')+(_0x3b697b(0x170)+_0x30693b[_0x3b697b(0x16c)]['toLocaleString'](_0x3b697b(0x185))+'\x0a');_0x30693b[_0x3b697b(0x1bd)]&&(_0xfe6a10+='📊\x20Error\x20code:\x20`'+_0x30693b[_0x3b697b(0x1bd)]+'`\x0a'),_0xfe6a10+='❌\x20Error:\x20`'+_0x30693b['errorMessage']+'`\x0a',_0x30693b[_0x3b697b(0x160)]&&(_0xfe6a10+=_0x3b697b(0x15e)+_0x30693b['requestId']+'`\x0a'),_0xfe6a10+=_0x3b697b(0x186),await this[_0x3b697b(0x18b)](_0x59beef,_0xfe6a10,{'parse_mode':_0x3b697b(0x139)}),console[_0x3b697b(0x177)](_0x3b697b(0x169)+_0x59beef+':\x20'+_0x30693b[_0x3b697b(0x1a8)]);}catch(_0x4684c8){console['error'](_0x3b697b(0x1d7),_0x4684c8);}}async[a55_0x540ec5(0x19e)](_0x4f626e,_0x27df3b,_0x174894){const _0x32ce05=a55_0x540ec5;let _0x2e66f6='🔔\x20*'+_0x27df3b+_0x32ce05(0x164);for(const [_0x5630c8,_0x47f6f1]of Object[_0x32ce05(0x1e1)](_0x174894)){_0x47f6f1!==null&&_0x47f6f1!==undefined&&(_0x2e66f6+=_0x5630c8+_0x32ce05(0x1fd)+_0x47f6f1+'`\x0a');}await this[_0x32ce05(0x18b)](_0x4f626e,_0x2e66f6,{'parse_mode':_0x32ce05(0x139)});}[a55_0x540ec5(0x1e2)](){const _0x47eda2=a55_0x540ec5;return{'isActive':!!this['bot'],'username':this[_0x47eda2(0x13c)]};}['stopBot'](){const _0x52d01d=a55_0x540ec5;this[_0x52d01d(0x1a5)]&&(this['bot'][_0x52d01d(0x145)](),this['bot']=null,console['log'](_0x52d01d(0x1c0)));}}exports[a55_0x540ec5(0x179)]=TelegramBotService,exports[a55_0x540ec5(0x154)]=new TelegramBotService();