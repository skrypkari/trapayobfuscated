'use strict';const a59_0x175982=a59_0x47c4;(function(_0x5d8db4,_0x1ac742){const _0x5e6986=a59_0x47c4,_0x11ae52=_0x5d8db4();while(!![]){try{const _0x4f1f16=-parseInt(_0x5e6986(0xd5))/0x1+parseInt(_0x5e6986(0x144))/0x2*(parseInt(_0x5e6986(0xb0))/0x3)+-parseInt(_0x5e6986(0xab))/0x4*(parseInt(_0x5e6986(0xf5))/0x5)+parseInt(_0x5e6986(0xfc))/0x6*(-parseInt(_0x5e6986(0x117))/0x7)+-parseInt(_0x5e6986(0x15c))/0x8+parseInt(_0x5e6986(0xea))/0x9+parseInt(_0x5e6986(0xc9))/0xa*(parseInt(_0x5e6986(0xfa))/0xb);if(_0x4f1f16===_0x1ac742)break;else _0x11ae52['push'](_0x11ae52['shift']());}catch(_0x4bf575){_0x11ae52['push'](_0x11ae52['shift']());}}}(a59_0x3a51,0x7e408));function a59_0x47c4(_0x19ecf3,_0x4b73b0){const _0x3a519d=a59_0x3a51();return a59_0x47c4=function(_0x47c4ce,_0x4a632e){_0x47c4ce=_0x47c4ce-0xa0;let _0x5c2684=_0x3a519d[_0x47c4ce];return _0x5c2684;},a59_0x47c4(_0x19ecf3,_0x4b73b0);}function a59_0x3a51(){const _0x1c8fa9=['•\x20Important\x20events\x0a\x0a','telegramUser','currency','\x20initialized\x20successfully','ipAddress','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','gateway','To\x20reconnect,\x20use\x20the\x20/start\x20command','success','setupBotHandlers','🔌\x20User\x20','username','Error\x20handling\x20/disconnect\x20command:','onText','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','notificationLogin','Error\x20handling\x20message:','\x20disconnected\x20from\x20shop\x20','📛\x20Name:\x20`','TELEGRAM_BOT_TOKEN','*\x0a\x0a','includes','isVerified','TelegramBotService','Check\x20spelling\x20and\x20try\x20again.','split','👤\x20Username:\x20`','amount','TELEGRAM_BOT_USERNAME','map','en-US','../config/database','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','•\x20New\x20payments\x0a','polling_error','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','timestamp','user\x20is\x20deactivated','📱\x20Your\x20Telegram\x20ID:\x20`','1829866YYULNy','📧\x20Email:\x20`','📅\x20Time:\x20','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','findMany','Failed\x20login\x20attempt','shopId','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','toLocaleString','env','\x20\x20\x20Status:\x20','chat','customerName','/status\x20-\x20check\x20connection\x20status\x0a','default','🔗\x20TXID:\x20`','\x22\x20->\x20display\x20\x22','🔔\x20Notifications\x20are\x20active\x0a\x0a','✅\x20Telegram\x20user\x20','toString','...','🔍\x20*Debug\x20Information*\x0a\x0a','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','customerUa','3489848cRFrZh','🆔\x20Payment\x20ID:\x20`','requestId','handleSingleLineVerification','message','__esModule','entries','length','text','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','✅\x20Connected\x20to\x20shop:\x20*','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','log','💻\x20Browser:\x20`','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','\x20via\x20single-line\x20input','🔗\x20Endpoint:\x20`','🆔\x20Payout\x20ID:\x20`','Markdown','botToken','🆔\x20Request\x20ID:\x20`','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','startsWith','📅\x20Connection\x20date:\x20','Example:\x0a','substring','last_name','🛑\x20Telegram\x20bot\x20stopped','Error\x20sending\x20shop\x20notification:','customerEmail','from','shopSettings','update','\x22,\x20apiKey=\x22','❌\x20Error\x20getting\x20debug\x20information.','txid','Use\x20/start\x20to\x20connect.','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','...\x22','botUsername','defineProperty','name','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','endpoint','316WZmqMO','•\x20Payment\x20status\x20changes\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','\x20parts:\x20','shop','3VJHQom','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','status','orderId','initializeBot','Payout\x20rejected','\x20USDT*\x0a','Commands:\x0a','updatedAt','❌\x20Shop\x20with\x20username\x20`','\x20\x20\x20Public\x20Key:\x20`','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','userAgent','Successful\x20login','...`\x0a\x0a','`.\x0a\x0a','Telegram\x20bot\x20polling\x20error:','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','notificationApiError','ACTIVE','📱\x20Shop:\x20*','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','unknown\x20shop','sendPaymentNotification','12053490vIthea','stopPolling','telegramId','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','📱\x20Created\x20new\x20Telegram\x20user:\x20','remitterIban','first_name','✅\x20Telegram\x20bot\x20@','❌\x20Invalid\x20username\x20format:\x20`','sendMessage','\x0a👤\x20*Customer\x20Information:*\x0a',':\x20`','14984QQQtUz','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','Username:\x20`','node-telegram-bot-api','getGatewayDisplayNameForTelegram','test','`\x20not\x20found.\x0a\x0a','\x20\x20\x20Username:\x20`','✅\x20Welcome\x20back!\x0a\x0a','Payment\x20is\x20being\x20processed','🏪\x20Gateway:\x20`','Use\x20/start\x20to\x20begin.','`\x0a\x0a','🌐\x20IP\x20address:\x20`','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','telegramBotService','errorMessage','Payment\x20expired','📅\x20Date:\x20','2143908zvNLEz','trapay_bot','error','blocked','📝\x20Order\x20ID:\x20`','forEach','Contact\x20administrator.','sendLoginNotification','❌\x20Error:\x20`','*.\x0a\x0a','Payout\x20completed','42895NShOCk','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','💸\x20Amount:\x20*','failed','secretKey','11Kxmgfj','publicKey','712410kVItEb','chargeback','method','customerIp','allSettled','New\x20payout\x20created','Failed\x20to\x20send\x20API\x20error\x20notification:','Payment\x20refund','createdAt','•\x20Payouts\x0a\x0a','💸\x20Penalty\x20amount:\x20*','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','adminNotes','\x20(@','.\x20*','sendShopNotification','chargebackAmount','📊\x20Error\x20code:\x20`','getBotInfo','findUnique','Error\x20handling\x20/debug\x20command:','Payment\x20failed','statusCode','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','Error\x20in\x20handleSingleLineVerification:','warn','/disconnect\x20-\x20disconnect\x20from\x20notifications','42JYCHpg','❌\x20Shop\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a',':\x20username=\x22','bot','🚨\x20*API\x20Error*\x0a\x0a'];a59_0x3a51=function(){return _0x1c8fa9;};return a59_0x3a51();}var __importDefault=this&&this['__importDefault']||function(_0x4e4a01){const _0x15fd05=a59_0x47c4;return _0x4e4a01&&_0x4e4a01[_0x15fd05(0x161)]?_0x4e4a01:{'default':_0x4e4a01};};Object[a59_0x175982(0xa6)](exports,a59_0x175982(0x161),{'value':!![]}),exports[a59_0x175982(0xe6)]=exports[a59_0x175982(0x134)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a59_0x175982(0xd9))),database_1=__importDefault(require(a59_0x175982(0x13c))),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x271169=a59_0x175982;this[_0x271169(0x11b)]=null,this['botToken']=process[_0x271169(0x14d)][_0x271169(0x130)]||'',this[_0x271169(0xa5)]=process[_0x271169(0x14d)][_0x271169(0x139)]||_0x271169(0xeb),this['botToken']?this[_0x271169(0xb4)]():console[_0x271169(0x115)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a59_0x175982(0xb4)](){const _0x834d1d=a59_0x175982;try{this[_0x834d1d(0x11b)]=new node_telegram_bot_api_1[(_0x834d1d(0x152))](this[_0x834d1d(0x170)],{'polling':!![]}),this[_0x834d1d(0x126)](),console[_0x834d1d(0x169)](_0x834d1d(0xd0)+this[_0x834d1d(0xa5)]+_0x834d1d(0x120));}catch(_0x172fae){console[_0x834d1d(0xec)](_0x834d1d(0x122),_0x172fae);}}[a59_0x175982(0x126)](){const _0x14fc80=a59_0x175982;if(!this['bot'])return;this[_0x14fc80(0x11b)][_0x14fc80(0x12a)](/\/start/,async _0x245042=>{const _0x44cbdd=_0x14fc80,_0x6e9744=_0x245042[_0x44cbdd(0x14f)]['id'],_0xbc4efb=_0x245042[_0x44cbdd(0x17b)]?.['id'][_0x44cbdd(0x157)](),_0x27b9a9=_0x245042['from']?.[_0x44cbdd(0x128)],_0x2925fa=_0x245042[_0x44cbdd(0x17b)]?.[_0x44cbdd(0xcf)],_0x231165=_0x245042[_0x44cbdd(0x17b)]?.[_0x44cbdd(0x177)];if(!_0xbc4efb)return;try{let _0x3635a6=await database_1[_0x44cbdd(0x152)][_0x44cbdd(0x11e)][_0x44cbdd(0x10f)]({'where':{'telegramId':_0xbc4efb},'include':{'shop':!![]}});!_0x3635a6?(_0x3635a6=await database_1[_0x44cbdd(0x152)][_0x44cbdd(0x11e)]['create']({'data':{'telegramId':_0xbc4efb,'username':_0x27b9a9,'firstName':_0x2925fa,'lastName':_0x231165,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x44cbdd(0x169)](_0x44cbdd(0xcd)+_0xbc4efb+_0x44cbdd(0x109)+_0x27b9a9+')')):_0x3635a6=await database_1[_0x44cbdd(0x152)][_0x44cbdd(0x11e)][_0x44cbdd(0x17d)]({'where':{'telegramId':_0xbc4efb},'data':{'username':_0x27b9a9,'firstName':_0x2925fa,'lastName':_0x231165},'include':{'shop':!![]}}),_0x3635a6[_0x44cbdd(0x133)]&&_0x3635a6['shopId']&&_0x3635a6[_0x44cbdd(0xaf)]?await this[_0x44cbdd(0x11b)]?.[_0x44cbdd(0xd2)](_0x6e9744,_0x44cbdd(0xde)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x3635a6[_0x44cbdd(0xaf)]['name']+'*\x0a')+(_0x44cbdd(0xd8)+_0x3635a6[_0x44cbdd(0xaf)][_0x44cbdd(0x128)]+'`\x0a\x0a')+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x44cbdd(0x13e)+_0x44cbdd(0xac)+_0x44cbdd(0x105)+_0x44cbdd(0xb7)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x44cbdd(0x116),{'parse_mode':_0x44cbdd(0x16f)}):(_0x3635a6[_0x44cbdd(0x14a)]&&!_0x3635a6['isVerified']&&(await database_1[_0x44cbdd(0x152)][_0x44cbdd(0x11e)]['update']({'where':{'telegramId':_0xbc4efb},'data':{'shopId':null,'isVerified':![]}}),console[_0x44cbdd(0x169)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0xbc4efb)),await this[_0x44cbdd(0x11b)]?.[_0x44cbdd(0xd2)](_0x6e9744,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x44cbdd(0x167)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x44cbdd(0x175)+_0x44cbdd(0xad)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x44cbdd(0x16f)}));}catch(_0x2f7606){console[_0x44cbdd(0xec)]('Error\x20handling\x20/start\x20command:',_0x2f7606),await this['bot']?.[_0x44cbdd(0xd2)](_0x6e9744,_0x44cbdd(0x15a));}}),this['bot'][_0x14fc80(0x12a)](/\/disconnect/,async _0x2cdf35=>{const _0x15c48d=_0x14fc80,_0x3a004b=_0x2cdf35['chat']['id'],_0x4a7ce5=_0x2cdf35[_0x15c48d(0x17b)]?.['id'][_0x15c48d(0x157)]();if(!_0x4a7ce5)return;try{const _0x2faf01=await database_1[_0x15c48d(0x152)][_0x15c48d(0x11e)][_0x15c48d(0x10f)]({'where':{'telegramId':_0x4a7ce5},'include':{'shop':!![]}});if(!_0x2faf01||!_0x2faf01[_0x15c48d(0x133)]||!_0x2faf01['shopId']){await this[_0x15c48d(0x11b)]?.['sendMessage'](_0x3a004b,_0x15c48d(0xb1));return;}const _0x4dc084=_0x2faf01[_0x15c48d(0xaf)]?.[_0x15c48d(0xa7)]||_0x15c48d(0xc7);await database_1[_0x15c48d(0x152)]['telegramUser'][_0x15c48d(0x17d)]({'where':{'telegramId':_0x4a7ce5},'data':{'shopId':null,'isVerified':![]}}),console[_0x15c48d(0x169)](_0x15c48d(0x127)+_0x4a7ce5+_0x15c48d(0x12e)+_0x2faf01[_0x15c48d(0x14a)]),await this[_0x15c48d(0x11b)]?.[_0x15c48d(0xd2)](_0x3a004b,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x4dc084+_0x15c48d(0xf3)+_0x15c48d(0x124),{'parse_mode':_0x15c48d(0x16f)});}catch(_0x2138cc){console['error'](_0x15c48d(0x129),_0x2138cc),await this[_0x15c48d(0x11b)]?.[_0x15c48d(0xd2)](_0x3a004b,_0x15c48d(0x15a));}}),this['bot'][_0x14fc80(0x12a)](/\/status/,async _0x1b5d41=>{const _0x299411=_0x14fc80,_0x56f4dd=_0x1b5d41['chat']['id'],_0x1956fb=_0x1b5d41['from']?.['id']['toString']();if(!_0x1956fb)return;try{const _0x1accce=await database_1[_0x299411(0x152)][_0x299411(0x11e)][_0x299411(0x10f)]({'where':{'telegramId':_0x1956fb},'include':{'shop':!![]}});if(!_0x1accce){await this['bot']?.[_0x299411(0xd2)](_0x56f4dd,_0x299411(0xa9)+_0x299411(0xe1));return;}if(!_0x1accce[_0x299411(0x133)]||!_0x1accce[_0x299411(0x14a)]||!_0x1accce['shop']){await this['bot']?.[_0x299411(0xd2)](_0x56f4dd,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x299411(0xa2));return;}await this[_0x299411(0x11b)]?.[_0x299411(0xd2)](_0x56f4dd,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x299411(0x166)+_0x1accce[_0x299411(0xaf)][_0x299411(0xa7)]+'*\x0a')+(_0x299411(0x137)+_0x1accce[_0x299411(0xaf)][_0x299411(0x128)]+'`\x0a')+(_0x299411(0x174)+_0x1accce[_0x299411(0xb8)]['toLocaleDateString']('en-US')+'\x0a\x0a')+_0x299411(0x155)+_0x299411(0xb7)+_0x299411(0x116),{'parse_mode':_0x299411(0x16f)});}catch(_0x107155){console[_0x299411(0xec)]('Error\x20handling\x20/status\x20command:',_0x107155),await this['bot']?.[_0x299411(0xd2)](_0x56f4dd,_0x299411(0x15a));}}),this[_0x14fc80(0x11b)][_0x14fc80(0x12a)](/\/debug/,async _0x14a640=>{const _0x2a5fba=_0x14fc80,_0x16c4ed=_0x14a640['chat']['id'],_0xfba7b6=_0x14a640[_0x2a5fba(0x17b)]?.['id'][_0x2a5fba(0x157)]();if(!_0xfba7b6)return;try{const _0x4b9c32=await database_1['default']['shop'][_0x2a5fba(0x148)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x2c234c=_0x2a5fba(0x159);_0x2c234c+=_0x2a5fba(0x143)+_0xfba7b6+_0x2a5fba(0xe2),_0x2c234c+=_0x2a5fba(0x119),_0x4b9c32[_0x2a5fba(0xef)]((_0x119c4b,_0x4484a1)=>{const _0xfae3d8=_0x2a5fba;_0x2c234c+=_0x4484a1+0x1+_0xfae3d8(0x10a)+_0x119c4b[_0xfae3d8(0xa7)]+'*\x0a',_0x2c234c+=_0xfae3d8(0xdd)+_0x119c4b['username']+'`\x0a',_0x2c234c+=_0xfae3d8(0x14e)+_0x119c4b['status']+'\x0a',_0x2c234c+=_0xfae3d8(0xba)+_0x119c4b[_0xfae3d8(0xfb)][_0xfae3d8(0x176)](0x0,0xf)+_0xfae3d8(0xbe);}),await this[_0x2a5fba(0x11b)]?.[_0x2a5fba(0xd2)](_0x16c4ed,_0x2c234c,{'parse_mode':_0x2a5fba(0x16f)});}catch(_0x54b8e1){console[_0x2a5fba(0xec)](_0x2a5fba(0x110),_0x54b8e1),await this[_0x2a5fba(0x11b)]?.['sendMessage'](_0x16c4ed,_0x2a5fba(0xa0));}}),this[_0x14fc80(0x11b)]['on'](_0x14fc80(0x160),async _0x4c5089=>{const _0x24b239=_0x14fc80;if(_0x4c5089['text']?.[_0x24b239(0x173)]('/'))return;const _0x21d224=_0x4c5089[_0x24b239(0x14f)]['id'],_0x4eab5d=_0x4c5089[_0x24b239(0x17b)]?.['id'][_0x24b239(0x157)](),_0x35409a=_0x4c5089[_0x24b239(0x164)]?.['trim']();if(!_0x4eab5d||!_0x35409a)return;try{const _0x15cfe0=await database_1[_0x24b239(0x152)]['telegramUser'][_0x24b239(0x10f)]({'where':{'telegramId':_0x4eab5d},'include':{'shop':!![]}});if(!_0x15cfe0){await this[_0x24b239(0x11b)]?.[_0x24b239(0xd2)](_0x21d224,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x15cfe0[_0x24b239(0x133)]&&_0x15cfe0[_0x24b239(0x14a)]&&_0x15cfe0[_0x24b239(0xaf)]){await this[_0x24b239(0x11b)]?.[_0x24b239(0xd2)](_0x21d224,_0x24b239(0xf6)+_0x15cfe0[_0x24b239(0xaf)]['name']+_0x24b239(0xf3)+_0x24b239(0x14b),{'parse_mode':'Markdown'});return;}const _0x507beb=_0x35409a[_0x24b239(0x136)](/\s+/);if(_0x507beb[_0x24b239(0x163)]!==0x2){await this[_0x24b239(0x11b)]?.[_0x24b239(0xd2)](_0x21d224,_0x24b239(0xa8)+_0x24b239(0xd6)+'Example:\x0a'+_0x24b239(0xad)+('You\x20sent\x20'+_0x507beb[_0x24b239(0x163)]+_0x24b239(0xae)+_0x507beb[_0x24b239(0x13a)](_0x277758=>'`'+_0x277758+'`')['join'](',\x20')),{'parse_mode':_0x24b239(0x16f)});return;}const [_0x492e7a,_0x2707be]=_0x507beb;console[_0x24b239(0x169)](_0x24b239(0xe4)+_0x4eab5d+_0x24b239(0x11a)+_0x492e7a+_0x24b239(0x17e)+_0x2707be[_0x24b239(0x176)](0x0,0xa)+_0x24b239(0xa4)),await this['handleSingleLineVerification'](_0x21d224,_0x4eab5d,_0x492e7a,_0x2707be);}catch(_0x13d042){console[_0x24b239(0xec)](_0x24b239(0x12d),_0x13d042),await this[_0x24b239(0x11b)]?.[_0x24b239(0xd2)](_0x21d224,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['on'](_0x14fc80(0xec),_0x472fb0=>{const _0x3aa534=_0x14fc80;console[_0x3aa534(0xec)]('Telegram\x20bot\x20error:',_0x472fb0);}),this['bot']['on'](_0x14fc80(0x13f),_0x317f62=>{const _0x1d26a6=_0x14fc80;console['error'](_0x1d26a6(0xc0),_0x317f62);});}async[a59_0x175982(0x15f)](_0x5d98a6,_0x3117d7,_0x28d98c,_0x1e27a3){const _0xa348a9=a59_0x175982;try{console['log']('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x3117d7+_0xa348a9(0x11a)+_0x28d98c+_0xa348a9(0x17e)+_0x1e27a3[_0xa348a9(0x176)](0x0,0xa)+'...\x22');if(!_0x28d98c||_0x28d98c[_0xa348a9(0x163)]<0x3||_0x28d98c['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0xa348a9(0xdb)](_0x28d98c)){await this['bot']?.[_0xa348a9(0xd2)](_0x5d98a6,_0xa348a9(0xd1)+_0x28d98c+_0xa348a9(0xe2)+_0xa348a9(0x172),{'parse_mode':_0xa348a9(0x16f)});return;}if(!_0x1e27a3||!_0x1e27a3[_0xa348a9(0x173)]('pk_')&&!_0x1e27a3[_0xa348a9(0x173)]('sk_')){await this[_0xa348a9(0x11b)]?.[_0xa348a9(0xd2)](_0x5d98a6,_0xa348a9(0x12b)+_0xa348a9(0x13d),{'parse_mode':_0xa348a9(0x16f)});return;}const _0x31382a=await database_1[_0xa348a9(0x152)]['shop'][_0xa348a9(0x10f)]({'where':{'username':_0x28d98c},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x31382a){const _0x3015f5=await database_1['default']['shop'][_0xa348a9(0x148)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x3be3af=_0xa348a9(0xb9)+_0x28d98c+_0xa348a9(0xdc);_0x3015f5['length']>0x0?(_0x3be3af+='Available\x20usernames:\x0a',_0x3015f5[_0xa348a9(0xef)](_0x5dcef7=>{const _0x35c50a=_0xa348a9;_0x3be3af+='•\x20`'+_0x5dcef7[_0x35c50a(0x128)]+'`\x20('+_0x5dcef7[_0x35c50a(0xa7)]+')\x0a';}),_0x3be3af+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x3be3af+=_0xa348a9(0x135);await this[_0xa348a9(0x11b)]?.[_0xa348a9(0xd2)](_0x5d98a6,_0x3be3af,{'parse_mode':_0xa348a9(0x16f)});return;}if(_0x31382a[_0xa348a9(0xb2)]!==_0xa348a9(0xc3)){await this[_0xa348a9(0x11b)]?.[_0xa348a9(0xd2)](_0x5d98a6,_0xa348a9(0x118)+_0x28d98c+'`\x20is\x20inactive.\x0a\x0a'+_0xa348a9(0xf0),{'parse_mode':_0xa348a9(0x16f)});return;}if(_0x31382a['publicKey']!==_0x1e27a3&&_0x31382a[_0xa348a9(0xf9)]!==_0x1e27a3){await this[_0xa348a9(0x11b)]?.['sendMessage'](_0x5d98a6,_0xa348a9(0xc1)+_0x28d98c+_0xa348a9(0xbf)+_0xa348a9(0xa3)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0xa348a9(0x16f)});return;}const _0x2a32e6=await database_1[_0xa348a9(0x152)]['telegramUser']['findFirst']({'where':{'shopId':_0x31382a['id'],'isVerified':!![],'telegramId':{'not':_0x3117d7}}});if(_0x2a32e6){await this[_0xa348a9(0x11b)]?.[_0xa348a9(0xd2)](_0x5d98a6,_0xa348a9(0xc5)+_0x28d98c+'`.\x0a\x0a'+_0xa348a9(0x107),{'parse_mode':_0xa348a9(0x16f)});return;}await database_1[_0xa348a9(0x152)][_0xa348a9(0x11e)][_0xa348a9(0x17d)]({'where':{'telegramId':_0x3117d7},'data':{'shopId':_0x31382a['id'],'isVerified':!![]}}),await this[_0xa348a9(0x11b)]?.[_0xa348a9(0xd2)](_0x5d98a6,'🎉\x20*Congratulations!*\x0a\x0a'+_0xa348a9(0x16b)+(_0xa348a9(0xc4)+_0x31382a['name']+'*\x0a')+(_0xa348a9(0x137)+_0x31382a[_0xa348a9(0x128)]+'`\x0a\x0a')+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0xa348a9(0xac)+'•\x20Payouts\x0a'+_0xa348a9(0x11d)+_0xa348a9(0xb7)+_0xa348a9(0x151)+_0xa348a9(0x116),{'parse_mode':_0xa348a9(0x16f)}),console[_0xa348a9(0x169)](_0xa348a9(0x156)+_0x3117d7+'\x20verified\x20for\x20shop\x20'+_0x31382a[_0xa348a9(0x128)]+_0xa348a9(0x16c));}catch(_0x15ca97){console[_0xa348a9(0xec)](_0xa348a9(0x114),_0x15ca97),await this[_0xa348a9(0x11b)]?.['sendMessage'](_0x5d98a6,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a59_0x175982(0x10b)](_0x30198d,_0x3f1d73,_0x409f0e){const _0xd12330=a59_0x175982;if(!this[_0xd12330(0x11b)]){console[_0xd12330(0x115)](_0xd12330(0x165));return;}try{const _0x300d9f=await database_1['default']['telegramUser'][_0xd12330(0x148)]({'where':{'shopId':_0x30198d,'isVerified':!![]}});if(_0x300d9f[_0xd12330(0x163)]===0x0){console['log'](_0xd12330(0xe5)+_0x30198d);return;}const _0x5ac15c=_0x300d9f[_0xd12330(0x13a)](async _0x360d12=>{const _0x23f73c=_0xd12330;try{await this[_0x23f73c(0x11b)]?.['sendMessage'](_0x360d12['telegramId'],_0x3f1d73,_0x409f0e),console[_0x23f73c(0x169)](_0x23f73c(0x168)+_0x360d12[_0x23f73c(0xcb)]);}catch(_0x5c2ee0){console[_0x23f73c(0xec)](_0x23f73c(0x140)+_0x360d12[_0x23f73c(0xcb)]+':',_0x5c2ee0),_0x5c2ee0 instanceof Error&&(_0x5c2ee0['message'][_0x23f73c(0x132)](_0x23f73c(0xed))||_0x5c2ee0[_0x23f73c(0x160)][_0x23f73c(0x132)]('chat\x20not\x20found')||_0x5c2ee0['message']['includes'](_0x23f73c(0x142)))&&(await database_1[_0x23f73c(0x152)][_0x23f73c(0x11e)][_0x23f73c(0x17d)]({'where':{'id':_0x360d12['id']},'data':{'isVerified':![]}}),console[_0x23f73c(0x169)]('User\x20'+_0x360d12[_0x23f73c(0xcb)]+_0x23f73c(0xc6)));}});await Promise[_0xd12330(0x100)](_0x5ac15c);}catch(_0x553393){console['error'](_0xd12330(0x179),_0x553393);}}async[a59_0x175982(0xc8)](_0x5edbc4,_0x16699e,_0x26c190){const _0x466c95=a59_0x175982,_0x16722c={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x46d81f={'created':'New\x20payment\x20created','paid':'Payment\x20successfully\x20paid','failed':_0x466c95(0x111),'expired':_0x466c95(0xe8),'refund':_0x466c95(0x103),'chargeback':'Payment\x20chargeback','processing':_0x466c95(0xdf)},_0x1862a=_0x16722c[_0x26c190],_0x5b8fe0=_0x46d81f[_0x26c190],_0x4c19e8=(0x0,gateway_1[_0x466c95(0xda)])(_0x16699e['gateway']);console[_0x466c95(0x169)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x16699e[_0x466c95(0x123)]+_0x466c95(0x154)+_0x4c19e8+'\x22');let _0x40ac8e=_0x1862a+'\x20*'+_0x5b8fe0+_0x466c95(0x131)+('💰\x20Amount:\x20*'+_0x16699e[_0x466c95(0x138)]+'\x20'+_0x16699e[_0x466c95(0x11f)]+'*\x0a')+(_0x466c95(0xee)+(_0x16699e[_0x466c95(0xb3)]||_0x16699e['id'])+'`\x0a')+(_0x466c95(0x15d)+_0x16699e['id']+'`\x0a')+(_0x466c95(0xe0)+_0x4c19e8+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x16699e['createdAt'])[_0x466c95(0x14c)](_0x466c95(0x13b))+'\x0a');if(_0x16699e[_0x466c95(0x150)]||_0x16699e[_0x466c95(0x17a)]||_0x16699e[_0x466c95(0xce)]||_0x16699e[_0x466c95(0xff)]||_0x16699e[_0x466c95(0x15b)]){_0x40ac8e+=_0x466c95(0xd3);_0x16699e[_0x466c95(0x150)]&&(_0x40ac8e+=_0x466c95(0x12f)+_0x16699e[_0x466c95(0x150)]+'`\x0a');_0x16699e[_0x466c95(0x17a)]&&(_0x40ac8e+=_0x466c95(0x145)+_0x16699e[_0x466c95(0x17a)]+'`\x0a');_0x16699e[_0x466c95(0xce)]&&(_0x40ac8e+='🏦\x20IBAN:\x20`'+_0x16699e[_0x466c95(0xce)]+'`\x0a');_0x16699e[_0x466c95(0xff)]&&(_0x40ac8e+='🌐\x20IP:\x20`'+_0x16699e[_0x466c95(0xff)]+'`\x0a');if(_0x16699e['customerUa']){const _0x3b5edd=_0x16699e[_0x466c95(0x15b)][_0x466c95(0x163)]>0x32?_0x16699e[_0x466c95(0x15b)][_0x466c95(0x176)](0x0,0x32)+_0x466c95(0x158):_0x16699e[_0x466c95(0x15b)];_0x40ac8e+=_0x466c95(0x16a)+_0x3b5edd+'`\x0a';}}_0x26c190===_0x466c95(0xfd)&&_0x16699e[_0x466c95(0x10c)]&&(_0x40ac8e+=_0x466c95(0x106)+_0x16699e['chargebackAmount']+_0x466c95(0xb6)),_0x26c190==='processing'&&(_0x40ac8e+=_0x466c95(0x147)),_0x16699e[_0x466c95(0x108)]&&(_0x40ac8e+='📝\x20Notes:\x20'+_0x16699e[_0x466c95(0x108)]+'\x0a'),await this['sendShopNotification'](_0x5edbc4,_0x40ac8e,{'parse_mode':_0x466c95(0x16f)});}async['sendPayoutNotification'](_0x1270c1,_0x58a692,_0x19d8d9){const _0x3ced9e=a59_0x175982,_0x23f6c2={'created':'📤','completed':'✅','rejected':'❌'},_0x22209d={'created':_0x3ced9e(0x101),'completed':_0x3ced9e(0xf4),'rejected':_0x3ced9e(0xb5)},_0x2a9d9d=_0x23f6c2[_0x19d8d9],_0x203d42=_0x22209d[_0x19d8d9],_0x86b6c2=_0x2a9d9d+'\x20*'+_0x203d42+_0x3ced9e(0x131)+(_0x3ced9e(0xf7)+_0x58a692[_0x3ced9e(0x138)]+'\x20USD*\x0a')+('🏦\x20Method:\x20`'+_0x58a692['method']+'`\x0a')+(_0x3ced9e(0x16e)+_0x58a692['id']+'`\x0a')+(_0x3ced9e(0xe9)+new Date(_0x58a692[_0x3ced9e(0x104)])['toLocaleString'](_0x3ced9e(0x13b))+'\x0a')+(_0x58a692[_0x3ced9e(0xa1)]?_0x3ced9e(0x153)+_0x58a692[_0x3ced9e(0xa1)]+'`':'');await this[_0x3ced9e(0x10b)](_0x1270c1,_0x86b6c2,{'parse_mode':_0x3ced9e(0x16f)});}async[a59_0x175982(0xf1)](_0x33dab7,_0x22028c){const _0xdad228=a59_0x175982;try{const _0x562bb3=await database_1[_0xdad228(0x152)][_0xdad228(0x17c)]['findUnique']({'where':{'shopId':_0x33dab7},'select':{'notificationLogin':!![]}});if(!_0x562bb3?.[_0xdad228(0x12c)]){console[_0xdad228(0x169)](_0xdad228(0x113)+_0x33dab7);return;}const _0x588502=_0x22028c[_0xdad228(0x125)]?'🔐':'🚨',_0x22a113=_0x22028c[_0xdad228(0x125)]?_0xdad228(0xbd):_0xdad228(0x149);let _0x278ce4=_0x588502+'\x20*'+_0x22a113+'*\x0a\x0a'+(_0xdad228(0x137)+_0x22028c['username']+'`\x0a')+(_0xdad228(0x146)+_0x22028c[_0xdad228(0x141)][_0xdad228(0x14c)](_0xdad228(0x13b))+'\x0a');_0x22028c[_0xdad228(0x121)]&&(_0x278ce4+=_0xdad228(0xe3)+_0x22028c['ipAddress']+'`\x0a');if(_0x22028c[_0xdad228(0xbc)]){const _0x2eeb4c=_0x22028c[_0xdad228(0xbc)][_0xdad228(0x163)]>0x32?_0x22028c['userAgent']['substring'](0x0,0x32)+_0xdad228(0x158):_0x22028c['userAgent'];_0x278ce4+='💻\x20Browser:\x20`'+_0x2eeb4c+'`\x0a';}!_0x22028c[_0xdad228(0x125)]&&(_0x278ce4+=_0xdad228(0xd7)),await this[_0xdad228(0x10b)](_0x33dab7,_0x278ce4,{'parse_mode':_0xdad228(0x16f)}),console['log'](_0xdad228(0xcc)+_0x33dab7+':\x20'+(_0x22028c[_0xdad228(0x125)]?_0xdad228(0x125):_0xdad228(0xf8)));}catch(_0x554ae8){console[_0xdad228(0xec)]('Failed\x20to\x20send\x20login\x20notification:',_0x554ae8);}}async['sendApiErrorNotification'](_0x4e0c3f,_0x2f32f4){const _0x43f713=a59_0x175982;try{const _0x8c3af1=await database_1[_0x43f713(0x152)]['shopSettings'][_0x43f713(0x10f)]({'where':{'shopId':_0x4e0c3f},'select':{'notificationApiError':!![]}});if(!_0x8c3af1?.[_0x43f713(0xc2)]){console[_0x43f713(0x169)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x4e0c3f);return;}let _0x4af19d=_0x43f713(0x11c)+(_0x43f713(0x16d)+_0x2f32f4[_0x43f713(0xfe)]+'\x20'+_0x2f32f4[_0x43f713(0xaa)]+'`\x0a')+(_0x43f713(0x146)+_0x2f32f4[_0x43f713(0x141)][_0x43f713(0x14c)](_0x43f713(0x13b))+'\x0a');_0x2f32f4[_0x43f713(0x112)]&&(_0x4af19d+=_0x43f713(0x10d)+_0x2f32f4[_0x43f713(0x112)]+'`\x0a'),_0x4af19d+=_0x43f713(0xf2)+_0x2f32f4[_0x43f713(0xe7)]+'`\x0a',_0x2f32f4[_0x43f713(0x15e)]&&(_0x4af19d+=_0x43f713(0x171)+_0x2f32f4[_0x43f713(0x15e)]+'`\x0a'),_0x4af19d+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x43f713(0x10b)](_0x4e0c3f,_0x4af19d,{'parse_mode':_0x43f713(0x16f)}),console[_0x43f713(0x169)](_0x43f713(0xbb)+_0x4e0c3f+':\x20'+_0x2f32f4['endpoint']);}catch(_0x10f910){console['error'](_0x43f713(0x102),_0x10f910);}}async['sendCustomNotification'](_0x336f32,_0x3ce4ff,_0x34b530){const _0x20a094=a59_0x175982;let _0x2061ce='🔔\x20*'+_0x3ce4ff+_0x20a094(0x131);for(const [_0x1f2eae,_0x135a9d]of Object[_0x20a094(0x162)](_0x34b530)){_0x135a9d!==null&&_0x135a9d!==undefined&&(_0x2061ce+=_0x1f2eae+_0x20a094(0xd4)+_0x135a9d+'`\x0a');}await this[_0x20a094(0x10b)](_0x336f32,_0x2061ce,{'parse_mode':_0x20a094(0x16f)});}[a59_0x175982(0x10e)](){const _0x5b4d6a=a59_0x175982;return{'isActive':!!this[_0x5b4d6a(0x11b)],'username':this[_0x5b4d6a(0xa5)]};}['stopBot'](){const _0x3c41c1=a59_0x175982;this['bot']&&(this[_0x3c41c1(0x11b)][_0x3c41c1(0xca)](),this[_0x3c41c1(0x11b)]=null,console['log'](_0x3c41c1(0x178)));}}exports['TelegramBotService']=TelegramBotService,exports[a59_0x175982(0xe6)]=new TelegramBotService();