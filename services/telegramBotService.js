'use strict';const a55_0x1909e3=a55_0x32bc;(function(_0x58ee2b,_0x12bcab){const _0x511548=a55_0x32bc,_0x3c0eab=_0x58ee2b();while(!![]){try{const _0x4c6d18=parseInt(_0x511548(0x244))/0x1*(-parseInt(_0x511548(0x21f))/0x2)+parseInt(_0x511548(0x197))/0x3+-parseInt(_0x511548(0x246))/0x4*(-parseInt(_0x511548(0x1c7))/0x5)+-parseInt(_0x511548(0x24c))/0x6*(-parseInt(_0x511548(0x222))/0x7)+-parseInt(_0x511548(0x1c0))/0x8+parseInt(_0x511548(0x1ee))/0x9+parseInt(_0x511548(0x1a8))/0xa*(-parseInt(_0x511548(0x257))/0xb);if(_0x4c6d18===_0x12bcab)break;else _0x3c0eab['push'](_0x3c0eab['shift']());}catch(_0x57c34e){_0x3c0eab['push'](_0x3c0eab['shift']());}}}(a55_0x58fa,0x3401a));var __importDefault=this&&this[a55_0x1909e3(0x267)]||function(_0x262dc6){const _0x1275ce=a55_0x1909e3;return _0x262dc6&&_0x262dc6[_0x1275ce(0x1a5)]?_0x262dc6:{'default':_0x262dc6};};Object[a55_0x1909e3(0x236)](exports,a55_0x1909e3(0x1a5),{'value':!![]}),exports['telegramBotService']=exports[a55_0x1909e3(0x1c6)]=void 0x0;function a55_0x32bc(_0x1c9948,_0x4f44c0){const _0x58fae2=a55_0x58fa();return a55_0x32bc=function(_0x32bc1c,_0x48eeb8){_0x32bc1c=_0x32bc1c-0x18d;let _0x4417ec=_0x58fae2[_0x32bc1c];return _0x4417ec;},a55_0x32bc(_0x1c9948,_0x4f44c0);}function a55_0x58fa(){const _0x2db8d8=['🏪\x20Gateway:\x20`','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','method','📝\x20Order\x20ID:\x20`','Successful\x20login','`\x20not\x20found.\x0a\x0a','*.\x0a\x0a','TELEGRAM_BOT_USERNAME','update','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','onText','processing','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','🌐\x20IP:\x20`','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','\x20(@','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','✅\x20Connected\x20to\x20shop:\x20*','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','toLocaleString','from','setupBotHandlers','findMany','Available\x20usernames:\x0a','chargeback','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','sendMessage','🆔\x20Payout\x20ID:\x20`','../types/gateway','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','Error\x20sending\x20shop\x20notification:','remitterIban','🌐\x20IP\x20address:\x20`','Telegram\x20bot\x20polling\x20error:','2jrwaUn','/status\x20-\x20check\x20connection\x20status\x0a','orderId','7vKRIXS','•\x20Payouts\x0a','`\x0a\x0a','✅\x20Telegram\x20bot\x20@','node-telegram-bot-api','🚨\x20*API\x20Error*\x0a\x0a','New\x20payment\x20created','💰\x20Amount:\x20*','📱\x20Shop:\x20*','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','trapay_bot','📱\x20Your\x20Telegram\x20ID:\x20`','endpoint','Payment\x20chargeback','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','📧\x20Email:\x20`','user\x20is\x20deactivated','•\x20New\x20payments\x0a','\x20parts:\x20','Error\x20handling\x20/debug\x20command:','defineProperty','🆔\x20Request\x20ID:\x20`','sk_','getBotInfo','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','name','handleSingleLineVerification','split','•\x20`','timestamp','\x0aCheck\x20spelling\x20and\x20try\x20again.','`\x20is\x20inactive.\x0a\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','Payment\x20successfully\x20paid','6025kMPtls','📅\x20Time:\x20','44odSmLZ','requestId','shopId','map','isVerified','length','1568112YbGHlG','amount','botToken','/disconnect\x20-\x20disconnect\x20from\x20notifications','createdAt','status','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Payout\x20completed','🔔\x20Notifications\x20are\x20active\x0a\x0a','userAgent','publicKey','52646hEJIet','sendApiErrorNotification','getGatewayDisplayNameForTelegram','📱\x20Telegram\x20notification:\x20gateway\x20\x22','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','stopPolling','Error\x20handling\x20/start\x20command:','customerName','\x20USDT*\x0a','bot','📱\x20Created\x20new\x20Telegram\x20user:\x20','•\x20Payment\x20status\x20changes\x0a','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','•\x20Payouts\x0a\x0a','gateway','botUsername','__importDefault','error','includes','❌\x20Shop\x20with\x20username\x20`','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','•\x20Important\x20events\x0a\x0a','Markdown','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','🏦\x20Method:\x20`','Example:\x0a','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a',':\x20`','Telegram\x20bot\x20error:','initializeBot','telegramBotService','message','log','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','TELEGRAM_BOT_TOKEN','customerIp','1201293qoGsOm','findUnique','sendPaymentNotification','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','Error\x20handling\x20/status\x20command:','chat','Failed\x20to\x20send\x20API\x20error\x20notification:','stopBot','🎉\x20*Congratulations!*\x0a\x0a','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','pk_','telegramId','\x22,\x20apiKey=\x22','__esModule','🛑\x20Telegram\x20bot\x20stopped','adminNotes','1030sIfOUv','errorMessage','New\x20payout\x20created','txid','Payment\x20refund','🔔\x20You\x20receive\x20notifications\x20about:\x0a','💻\x20Browser:\x20`','trim','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','substring','customerEmail','customerUa','unknown\x20shop','`.\x0a\x0a','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','notificationApiError','Contact\x20administrator.','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','forEach','💸\x20Amount:\x20*','Payment\x20failed','📅\x20Connection\x20date:\x20','\x20\x20\x20Public\x20Key:\x20`','telegramUser','3400608OJNNHf','allSettled','👤\x20Username:\x20`','create','shop','sendCustomNotification','TelegramBotService','193485ABuLLw','.\x20*','sendLoginNotification','secretKey','Payment\x20is\x20being\x20processed','toString','...','📝\x20Notes:\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','*\x0a\x0a','🏪\x20Available\x20shops\x20in\x20system:\x0a','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','sendPayoutNotification','sendShopNotification','chat\x20not\x20found','blocked','...\x22','📊\x20Error\x20code:\x20`','en-US','`\x20(','currency',':\x20username=\x22','🔌\x20User\x20','username','env','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','success','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','\x20verified\x20for\x20shop\x20','Check\x20spelling\x20and\x20try\x20again.','Use\x20/start\x20to\x20begin.','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Failed\x20login\x20attempt','Commands:\x0a','startsWith','shopSettings','test','📅\x20Date:\x20','446643iBxnvj','../config/database','❌\x20Error:\x20`','❌\x20Shop\x20`','text','chargebackAmount','🔍\x20*Debug\x20Information*\x0a\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','\x20USD*\x0a','📊\x20*Connection\x20Status*\x0a\x0a','default','Error\x20in\x20handleSingleLineVerification:','ipAddress','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','\x20\x20\x20Username:\x20`'];a55_0x58fa=function(){return _0x2db8d8;};return a55_0x58fa();}const node_telegram_bot_api_1=__importDefault(require(a55_0x1909e3(0x226))),database_1=__importDefault(require(a55_0x1909e3(0x1ef))),gateway_1=require(a55_0x1909e3(0x219));class TelegramBotService{constructor(){const _0x5e558d=a55_0x1909e3;this[_0x5e558d(0x260)]=null,this['botToken']=process[_0x5e558d(0x1df)][_0x5e558d(0x195)]||'',this[_0x5e558d(0x266)]=process[_0x5e558d(0x1df)][_0x5e558d(0x204)]||_0x5e558d(0x22c),this[_0x5e558d(0x24e)]?this[_0x5e558d(0x190)]():console['warn'](_0x5e558d(0x21a));}[a55_0x1909e3(0x190)](){const _0x37df13=a55_0x1909e3;try{this[_0x37df13(0x260)]=new node_telegram_bot_api_1[(_0x37df13(0x1f8))](this[_0x37df13(0x24e)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x37df13(0x193)](_0x37df13(0x225)+this[_0x37df13(0x266)]+'\x20initialized\x20successfully');}catch(_0x3d5222){console[_0x37df13(0x268)](_0x37df13(0x22b),_0x3d5222);}}[a55_0x1909e3(0x212)](){const _0x351c8c=a55_0x1909e3;if(!this[_0x351c8c(0x260)])return;this[_0x351c8c(0x260)][_0x351c8c(0x207)](/\/start/,async _0x4df516=>{const _0x50c48a=_0x351c8c,_0x4a7554=_0x4df516[_0x50c48a(0x19c)]['id'],_0x5661d8=_0x4df516[_0x50c48a(0x211)]?.['id'][_0x50c48a(0x1cc)](),_0x2119c1=_0x4df516['from']?.['username'],_0x5eebc7=_0x4df516[_0x50c48a(0x211)]?.['first_name'],_0x35847f=_0x4df516[_0x50c48a(0x211)]?.['last_name'];if(!_0x5661d8)return;try{let _0x322456=await database_1[_0x50c48a(0x1f8)][_0x50c48a(0x1bf)][_0x50c48a(0x198)]({'where':{'telegramId':_0x5661d8},'include':{'shop':!![]}});!_0x322456?(_0x322456=await database_1[_0x50c48a(0x1f8)][_0x50c48a(0x1bf)][_0x50c48a(0x1c3)]({'data':{'telegramId':_0x5661d8,'username':_0x2119c1,'firstName':_0x5eebc7,'lastName':_0x35847f,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x50c48a(0x193)](_0x50c48a(0x261)+_0x5661d8+_0x50c48a(0x20c)+_0x2119c1+')')):_0x322456=await database_1[_0x50c48a(0x1f8)][_0x50c48a(0x1bf)][_0x50c48a(0x205)]({'where':{'telegramId':_0x5661d8},'data':{'username':_0x2119c1,'firstName':_0x5eebc7,'lastName':_0x35847f},'include':{'shop':!![]}}),_0x322456[_0x50c48a(0x24a)]&&_0x322456[_0x50c48a(0x248)]&&_0x322456[_0x50c48a(0x1c4)]?await this[_0x50c48a(0x260)]?.['sendMessage'](_0x4a7554,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x50c48a(0x1d2)+_0x322456['shop']['name']+'*\x0a')+('Username:\x20`'+_0x322456[_0x50c48a(0x1c4)][_0x50c48a(0x1de)]+'`\x0a\x0a')+_0x50c48a(0x1ad)+_0x50c48a(0x233)+_0x50c48a(0x262)+_0x50c48a(0x264)+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x50c48a(0x26d)}):(_0x322456[_0x50c48a(0x248)]&&!_0x322456[_0x50c48a(0x24a)]&&(await database_1['default']['telegramUser']['update']({'where':{'telegramId':_0x5661d8},'data':{'shopId':null,'isVerified':![]}}),console[_0x50c48a(0x193)](_0x50c48a(0x209)+_0x5661d8)),await this[_0x50c48a(0x260)]?.[_0x50c48a(0x217)](_0x4a7554,_0x50c48a(0x20f)+_0x50c48a(0x20b)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x50c48a(0x270)+_0x50c48a(0x19a)+_0x50c48a(0x1e2),{'parse_mode':'Markdown'}));}catch(_0x5ee076){console[_0x50c48a(0x268)](_0x50c48a(0x25d),_0x5ee076),await this[_0x50c48a(0x260)]?.[_0x50c48a(0x217)](_0x4a7554,_0x50c48a(0x230));}}),this[_0x351c8c(0x260)][_0x351c8c(0x207)](/\/disconnect/,async _0xc11a81=>{const _0x34841d=_0x351c8c,_0x305f6b=_0xc11a81[_0x34841d(0x19c)]['id'],_0x103707=_0xc11a81[_0x34841d(0x211)]?.['id'][_0x34841d(0x1cc)]();if(!_0x103707)return;try{const _0x154c85=await database_1[_0x34841d(0x1f8)][_0x34841d(0x1bf)][_0x34841d(0x198)]({'where':{'telegramId':_0x103707},'include':{'shop':!![]}});if(!_0x154c85||!_0x154c85[_0x34841d(0x24a)]||!_0x154c85['shopId']){await this[_0x34841d(0x260)]?.[_0x34841d(0x217)](_0x305f6b,_0x34841d(0x1cf));return;}const _0x45bca7=_0x154c85['shop']?.['name']||_0x34841d(0x1b4);await database_1[_0x34841d(0x1f8)][_0x34841d(0x1bf)][_0x34841d(0x205)]({'where':{'telegramId':_0x103707},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x34841d(0x1dd)+_0x103707+'\x20disconnected\x20from\x20shop\x20'+_0x154c85[_0x34841d(0x248)]),await this[_0x34841d(0x260)]?.[_0x34841d(0x217)](_0x305f6b,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x45bca7+_0x34841d(0x203)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x34841d(0x26d)});}catch(_0x47368a){console[_0x34841d(0x268)]('Error\x20handling\x20/disconnect\x20command:',_0x47368a),await this[_0x34841d(0x260)]?.[_0x34841d(0x217)](_0x305f6b,_0x34841d(0x230));}}),this[_0x351c8c(0x260)]['onText'](/\/status/,async _0x54c847=>{const _0x3e4335=_0x351c8c,_0x5e5efe=_0x54c847[_0x3e4335(0x19c)]['id'],_0x158b1f=_0x54c847[_0x3e4335(0x211)]?.['id'][_0x3e4335(0x1cc)]();if(!_0x158b1f)return;try{const _0x27599f=await database_1[_0x3e4335(0x1f8)][_0x3e4335(0x1bf)][_0x3e4335(0x198)]({'where':{'telegramId':_0x158b1f},'include':{'shop':!![]}});if(!_0x27599f){await this[_0x3e4335(0x260)]?.['sendMessage'](_0x5e5efe,_0x3e4335(0x242)+_0x3e4335(0x1e5));return;}if(!_0x27599f[_0x3e4335(0x24a)]||!_0x27599f['shopId']||!_0x27599f[_0x3e4335(0x1c4)]){await this[_0x3e4335(0x260)]?.[_0x3e4335(0x217)](_0x5e5efe,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+'Use\x20/start\x20to\x20connect.');return;}await this['bot']?.[_0x3e4335(0x217)](_0x5e5efe,_0x3e4335(0x1f7)+(_0x3e4335(0x20e)+_0x27599f[_0x3e4335(0x1c4)]['name']+'*\x0a')+('👤\x20Username:\x20`'+_0x27599f['shop'][_0x3e4335(0x1de)]+'`\x0a')+(_0x3e4335(0x1bd)+_0x27599f['updatedAt']['toLocaleDateString'](_0x3e4335(0x1d9))+'\x0a\x0a')+_0x3e4335(0x254)+_0x3e4335(0x1e9)+_0x3e4335(0x24f),{'parse_mode':_0x3e4335(0x26d)});}catch(_0xa1847d){console[_0x3e4335(0x268)](_0x3e4335(0x19b),_0xa1847d),await this[_0x3e4335(0x260)]?.[_0x3e4335(0x217)](_0x5e5efe,_0x3e4335(0x230));}}),this['bot']['onText'](/\/debug/,async _0x107ec6=>{const _0x1e1bcf=_0x351c8c,_0x124c3b=_0x107ec6['chat']['id'],_0x5a191b=_0x107ec6['from']?.['id'][_0x1e1bcf(0x1cc)]();if(!_0x5a191b)return;try{const _0x5c86db=await database_1['default'][_0x1e1bcf(0x1c4)][_0x1e1bcf(0x213)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x5b3b83=_0x1e1bcf(0x1f4);_0x5b3b83+=_0x1e1bcf(0x22d)+_0x5a191b+_0x1e1bcf(0x224),_0x5b3b83+=_0x1e1bcf(0x1d1),_0x5c86db[_0x1e1bcf(0x1ba)]((_0x2eb83d,_0x766f52)=>{const _0x681c49=_0x1e1bcf;_0x5b3b83+=_0x766f52+0x1+_0x681c49(0x1c8)+_0x2eb83d[_0x681c49(0x23b)]+'*\x0a',_0x5b3b83+=_0x681c49(0x1fc)+_0x2eb83d[_0x681c49(0x1de)]+'`\x0a',_0x5b3b83+='\x20\x20\x20Status:\x20'+_0x2eb83d[_0x681c49(0x251)]+'\x0a',_0x5b3b83+=_0x681c49(0x1be)+_0x2eb83d[_0x681c49(0x256)]['substring'](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x1e1bcf(0x260)]?.[_0x1e1bcf(0x217)](_0x124c3b,_0x5b3b83,{'parse_mode':_0x1e1bcf(0x26d)});}catch(_0x21f418){console[_0x1e1bcf(0x268)](_0x1e1bcf(0x235),_0x21f418),await this['bot']?.[_0x1e1bcf(0x217)](_0x124c3b,'❌\x20Error\x20getting\x20debug\x20information.');}}),this[_0x351c8c(0x260)]['on'](_0x351c8c(0x192),async _0x232925=>{const _0xeea121=_0x351c8c;if(_0x232925[_0xeea121(0x1f2)]?.[_0xeea121(0x1ea)]('/'))return;const _0x10de7d=_0x232925[_0xeea121(0x19c)]['id'],_0x1e371e=_0x232925[_0xeea121(0x211)]?.['id']['toString'](),_0x3a1a07=_0x232925[_0xeea121(0x1f2)]?.[_0xeea121(0x1af)]();if(!_0x1e371e||!_0x3a1a07)return;try{const _0x3feef7=await database_1[_0xeea121(0x1f8)][_0xeea121(0x1bf)]['findUnique']({'where':{'telegramId':_0x1e371e},'include':{'shop':!![]}});if(!_0x3feef7){await this[_0xeea121(0x260)]?.['sendMessage'](_0x10de7d,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x3feef7[_0xeea121(0x24a)]&&_0x3feef7[_0xeea121(0x248)]&&_0x3feef7['shop']){await this[_0xeea121(0x260)]?.[_0xeea121(0x217)](_0x10de7d,_0xeea121(0x1b6)+_0x3feef7['shop'][_0xeea121(0x23b)]+_0xeea121(0x203)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':'Markdown'});return;}const _0x29b2e6=_0x3a1a07[_0xeea121(0x23d)](/\s+/);if(_0x29b2e6[_0xeea121(0x24b)]!==0x2){await this[_0xeea121(0x260)]?.[_0xeea121(0x217)](_0x10de7d,_0xeea121(0x1e7)+_0xeea121(0x263)+_0xeea121(0x270)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+('You\x20sent\x20'+_0x29b2e6[_0xeea121(0x24b)]+_0xeea121(0x234)+_0x29b2e6[_0xeea121(0x249)](_0x69baf3=>'`'+_0x69baf3+'`')['join'](',\x20')),{'parse_mode':_0xeea121(0x26d)});return;}const [_0x29cbcb,_0xeaea82]=_0x29b2e6;console[_0xeea121(0x193)](_0xeea121(0x216)+_0x1e371e+_0xeea121(0x1dc)+_0x29cbcb+_0xeea121(0x1a4)+_0xeaea82[_0xeea121(0x1b1)](0x0,0xa)+_0xeea121(0x1d7)),await this[_0xeea121(0x23c)](_0x10de7d,_0x1e371e,_0x29cbcb,_0xeaea82);}catch(_0x171105){console[_0xeea121(0x268)]('Error\x20handling\x20message:',_0x171105),await this[_0xeea121(0x260)]?.['sendMessage'](_0x10de7d,_0xeea121(0x230));}}),this[_0x351c8c(0x260)]['on'](_0x351c8c(0x268),_0x2716d9=>{const _0x10c9a9=_0x351c8c;console[_0x10c9a9(0x268)](_0x10c9a9(0x18f),_0x2716d9);}),this[_0x351c8c(0x260)]['on']('polling_error',_0x53823c=>{const _0x5107fe=_0x351c8c;console[_0x5107fe(0x268)](_0x5107fe(0x21e),_0x53823c);});}async[a55_0x1909e3(0x23c)](_0x248615,_0x31c301,_0x10ce47,_0x25a166){const _0x10d3d7=a55_0x1909e3;try{console[_0x10d3d7(0x193)](_0x10d3d7(0x216)+_0x31c301+_0x10d3d7(0x1dc)+_0x10ce47+'\x22,\x20apiKey=\x22'+_0x25a166[_0x10d3d7(0x1b1)](0x0,0xa)+_0x10d3d7(0x1d7));if(!_0x10ce47||_0x10ce47[_0x10d3d7(0x24b)]<0x3||_0x10ce47[_0x10d3d7(0x24b)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x10d3d7(0x1ec)](_0x10ce47)){await this[_0x10d3d7(0x260)]?.[_0x10d3d7(0x217)](_0x248615,'❌\x20Invalid\x20username\x20format:\x20`'+_0x10ce47+_0x10d3d7(0x224)+_0x10d3d7(0x1f5),{'parse_mode':_0x10d3d7(0x26d)});return;}if(!_0x25a166||!_0x25a166[_0x10d3d7(0x1ea)](_0x10d3d7(0x1a2))&&!_0x25a166[_0x10d3d7(0x1ea)](_0x10d3d7(0x238))){await this[_0x10d3d7(0x260)]?.[_0x10d3d7(0x217)](_0x248615,_0x10d3d7(0x1a0)+_0x10d3d7(0x1fb),{'parse_mode':'Markdown'});return;}const _0x167a53=await database_1[_0x10d3d7(0x1f8)][_0x10d3d7(0x1c4)][_0x10d3d7(0x198)]({'where':{'username':_0x10ce47},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x167a53){const _0x4ec8f1=await database_1['default']['shop']['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x52938d=_0x10d3d7(0x26a)+_0x10ce47+_0x10d3d7(0x202);_0x4ec8f1[_0x10d3d7(0x24b)]>0x0?(_0x52938d+=_0x10d3d7(0x214),_0x4ec8f1['forEach'](_0x359b3e=>{const _0x274532=_0x10d3d7;_0x52938d+=_0x274532(0x23e)+_0x359b3e['username']+_0x274532(0x1da)+_0x359b3e[_0x274532(0x23b)]+')\x0a';}),_0x52938d+=_0x10d3d7(0x240)):_0x52938d+=_0x10d3d7(0x1e4);await this[_0x10d3d7(0x260)]?.[_0x10d3d7(0x217)](_0x248615,_0x52938d,{'parse_mode':_0x10d3d7(0x26d)});return;}if(_0x167a53[_0x10d3d7(0x251)]!=='ACTIVE'){await this[_0x10d3d7(0x260)]?.[_0x10d3d7(0x217)](_0x248615,_0x10d3d7(0x1f1)+_0x10ce47+_0x10d3d7(0x241)+_0x10d3d7(0x1b8),{'parse_mode':_0x10d3d7(0x26d)});return;}if(_0x167a53['publicKey']!==_0x25a166&&_0x167a53[_0x10d3d7(0x1ca)]!==_0x25a166){await this[_0x10d3d7(0x260)]?.[_0x10d3d7(0x217)](_0x248615,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x10ce47+_0x10d3d7(0x1b5)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x10d3d7(0x1fe),{'parse_mode':'Markdown'});return;}const _0x1489b5=await database_1['default'][_0x10d3d7(0x1bf)]['findFirst']({'where':{'shopId':_0x167a53['id'],'isVerified':!![],'telegramId':{'not':_0x31c301}}});if(_0x1489b5){await this['bot']?.[_0x10d3d7(0x217)](_0x248615,_0x10d3d7(0x1b0)+_0x10ce47+'`.\x0a\x0a'+_0x10d3d7(0x194),{'parse_mode':_0x10d3d7(0x26d)});return;}await database_1[_0x10d3d7(0x1f8)][_0x10d3d7(0x1bf)][_0x10d3d7(0x205)]({'where':{'telegramId':_0x31c301},'data':{'shopId':_0x167a53['id'],'isVerified':!![]}}),await this[_0x10d3d7(0x260)]?.['sendMessage'](_0x248615,_0x10d3d7(0x19f)+_0x10d3d7(0x18d)+(_0x10d3d7(0x22a)+_0x167a53[_0x10d3d7(0x23b)]+'*\x0a')+('👤\x20Username:\x20`'+_0x167a53[_0x10d3d7(0x1de)]+_0x10d3d7(0x224))+_0x10d3d7(0x26e)+_0x10d3d7(0x233)+'•\x20Payment\x20status\x20changes\x0a'+_0x10d3d7(0x223)+_0x10d3d7(0x26c)+'Commands:\x0a'+_0x10d3d7(0x220)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}),console['log']('✅\x20Telegram\x20user\x20'+_0x31c301+_0x10d3d7(0x1e3)+_0x167a53[_0x10d3d7(0x1de)]+'\x20via\x20single-line\x20input');}catch(_0x4adc45){console[_0x10d3d7(0x268)](_0x10d3d7(0x1f9),_0x4adc45),await this[_0x10d3d7(0x260)]?.[_0x10d3d7(0x217)](_0x248615,_0x10d3d7(0x20d));}}async['sendShopNotification'](_0x1e4bc2,_0x205c63,_0x32deae){const _0x353f3a=a55_0x1909e3;if(!this[_0x353f3a(0x260)]){console['warn'](_0x353f3a(0x1b9));return;}try{const _0x5abe95=await database_1[_0x353f3a(0x1f8)][_0x353f3a(0x1bf)][_0x353f3a(0x213)]({'where':{'shopId':_0x1e4bc2,'isVerified':!![]}});if(_0x5abe95['length']===0x0){console[_0x353f3a(0x193)](_0x353f3a(0x206)+_0x1e4bc2);return;}const _0x1f1054=_0x5abe95[_0x353f3a(0x249)](async _0x1b0a8d=>{const _0x2e5427=_0x353f3a;try{await this[_0x2e5427(0x260)]?.[_0x2e5427(0x217)](_0x1b0a8d[_0x2e5427(0x1a3)],_0x205c63,_0x32deae),console[_0x2e5427(0x193)](_0x2e5427(0x25b)+_0x1b0a8d[_0x2e5427(0x1a3)]);}catch(_0xbc2fc1){console[_0x2e5427(0x268)](_0x2e5427(0x1e6)+_0x1b0a8d[_0x2e5427(0x1a3)]+':',_0xbc2fc1),_0xbc2fc1 instanceof Error&&(_0xbc2fc1[_0x2e5427(0x192)][_0x2e5427(0x269)](_0x2e5427(0x1d6))||_0xbc2fc1[_0x2e5427(0x192)]['includes'](_0x2e5427(0x1d5))||_0xbc2fc1['message'][_0x2e5427(0x269)](_0x2e5427(0x232)))&&(await database_1[_0x2e5427(0x1f8)][_0x2e5427(0x1bf)][_0x2e5427(0x205)]({'where':{'id':_0x1b0a8d['id']},'data':{'isVerified':![]}}),console[_0x2e5427(0x193)]('User\x20'+_0x1b0a8d[_0x2e5427(0x1a3)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x353f3a(0x1c1)](_0x1f1054);}catch(_0x1b95e7){console[_0x353f3a(0x268)](_0x353f3a(0x21b),_0x1b95e7);}}async[a55_0x1909e3(0x199)](_0x4fead4,_0x34a814,_0x165222){const _0x1235f8=a55_0x1909e3,_0x70038c={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x3a6318={'created':_0x1235f8(0x228),'paid':_0x1235f8(0x243),'failed':_0x1235f8(0x1bc),'expired':'Payment\x20expired','refund':_0x1235f8(0x1ac),'chargeback':_0x1235f8(0x22f),'processing':_0x1235f8(0x1cb)},_0x33f1fc=_0x70038c[_0x165222],_0x423c92=_0x3a6318[_0x165222],_0x3bacf1=(0x0,gateway_1[_0x1235f8(0x259)])(_0x34a814['gateway']);console['log'](_0x1235f8(0x25a)+_0x34a814[_0x1235f8(0x265)]+'\x22\x20->\x20display\x20\x22'+_0x3bacf1+'\x22');let _0x49f500=_0x33f1fc+'\x20*'+_0x423c92+'*\x0a\x0a'+(_0x1235f8(0x229)+_0x34a814[_0x1235f8(0x24d)]+'\x20'+_0x34a814[_0x1235f8(0x1db)]+'*\x0a')+(_0x1235f8(0x200)+(_0x34a814[_0x1235f8(0x221)]||_0x34a814['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x34a814['id']+'`\x0a')+(_0x1235f8(0x1fd)+_0x3bacf1+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x34a814['createdAt'])[_0x1235f8(0x210)](_0x1235f8(0x1d9))+'\x0a');if(_0x34a814[_0x1235f8(0x25e)]||_0x34a814[_0x1235f8(0x1b2)]||_0x34a814[_0x1235f8(0x21c)]||_0x34a814[_0x1235f8(0x196)]||_0x34a814[_0x1235f8(0x1b3)]){_0x49f500+='\x0a👤\x20*Customer\x20Information:*\x0a';_0x34a814[_0x1235f8(0x25e)]&&(_0x49f500+='📛\x20Name:\x20`'+_0x34a814[_0x1235f8(0x25e)]+'`\x0a');_0x34a814[_0x1235f8(0x1b2)]&&(_0x49f500+=_0x1235f8(0x231)+_0x34a814[_0x1235f8(0x1b2)]+'`\x0a');_0x34a814[_0x1235f8(0x21c)]&&(_0x49f500+='🏦\x20IBAN:\x20`'+_0x34a814[_0x1235f8(0x21c)]+'`\x0a');_0x34a814[_0x1235f8(0x196)]&&(_0x49f500+=_0x1235f8(0x20a)+_0x34a814[_0x1235f8(0x196)]+'`\x0a');if(_0x34a814[_0x1235f8(0x1b3)]){const _0x3c18a3=_0x34a814[_0x1235f8(0x1b3)][_0x1235f8(0x24b)]>0x32?_0x34a814[_0x1235f8(0x1b3)][_0x1235f8(0x1b1)](0x0,0x32)+_0x1235f8(0x1cd):_0x34a814[_0x1235f8(0x1b3)];_0x49f500+=_0x1235f8(0x1ae)+_0x3c18a3+'`\x0a';}}_0x165222===_0x1235f8(0x215)&&_0x34a814[_0x1235f8(0x1f3)]&&(_0x49f500+='💸\x20Penalty\x20amount:\x20*'+_0x34a814[_0x1235f8(0x1f3)]+_0x1235f8(0x25f)),_0x165222===_0x1235f8(0x208)&&(_0x49f500+=_0x1235f8(0x1e0)),_0x34a814[_0x1235f8(0x1a7)]&&(_0x49f500+=_0x1235f8(0x1ce)+_0x34a814[_0x1235f8(0x1a7)]+'\x0a'),await this[_0x1235f8(0x1d4)](_0x4fead4,_0x49f500,{'parse_mode':_0x1235f8(0x26d)});}async[a55_0x1909e3(0x1d3)](_0x5d7a46,_0x69b83e,_0x3ae67e){const _0x3c2b8b=a55_0x1909e3,_0x20e215={'created':'📤','completed':'✅','rejected':'❌'},_0x42b66b={'created':_0x3c2b8b(0x1aa),'completed':_0x3c2b8b(0x253),'rejected':'Payout\x20rejected'},_0x4769be=_0x20e215[_0x3ae67e],_0x5f1100=_0x42b66b[_0x3ae67e],_0x1edecd=_0x4769be+'\x20*'+_0x5f1100+'*\x0a\x0a'+(_0x3c2b8b(0x1bb)+_0x69b83e[_0x3c2b8b(0x24d)]+_0x3c2b8b(0x1f6))+(_0x3c2b8b(0x26f)+_0x69b83e[_0x3c2b8b(0x1ff)]+'`\x0a')+(_0x3c2b8b(0x218)+_0x69b83e['id']+'`\x0a')+(_0x3c2b8b(0x1ed)+new Date(_0x69b83e[_0x3c2b8b(0x250)])['toLocaleString'](_0x3c2b8b(0x1d9))+'\x0a')+(_0x69b83e[_0x3c2b8b(0x1ab)]?'🔗\x20TXID:\x20`'+_0x69b83e[_0x3c2b8b(0x1ab)]+'`':'');await this[_0x3c2b8b(0x1d4)](_0x5d7a46,_0x1edecd,{'parse_mode':_0x3c2b8b(0x26d)});}async[a55_0x1909e3(0x1c9)](_0x99f8cc,_0x1903c2){const _0x522c64=a55_0x1909e3;try{const _0x5e0e87=await database_1['default'][_0x522c64(0x1eb)][_0x522c64(0x198)]({'where':{'shopId':_0x99f8cc},'select':{'notificationLogin':!![]}});if(!_0x5e0e87?.['notificationLogin']){console[_0x522c64(0x193)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x99f8cc);return;}const _0x1221a5=_0x1903c2[_0x522c64(0x1e1)]?'🔐':'🚨',_0x3f5e84=_0x1903c2['success']?_0x522c64(0x201):_0x522c64(0x1e8);let _0x235ef5=_0x1221a5+'\x20*'+_0x3f5e84+_0x522c64(0x1d0)+(_0x522c64(0x1c2)+_0x1903c2[_0x522c64(0x1de)]+'`\x0a')+('📅\x20Time:\x20'+_0x1903c2[_0x522c64(0x23f)][_0x522c64(0x210)](_0x522c64(0x1d9))+'\x0a');_0x1903c2[_0x522c64(0x1fa)]&&(_0x235ef5+=_0x522c64(0x21d)+_0x1903c2[_0x522c64(0x1fa)]+'`\x0a');if(_0x1903c2[_0x522c64(0x255)]){const _0x25b93d=_0x1903c2[_0x522c64(0x255)]['length']>0x32?_0x1903c2[_0x522c64(0x255)]['substring'](0x0,0x32)+_0x522c64(0x1cd):_0x1903c2[_0x522c64(0x255)];_0x235ef5+=_0x522c64(0x1ae)+_0x25b93d+'`\x0a';}!_0x1903c2[_0x522c64(0x1e1)]&&(_0x235ef5+=_0x522c64(0x1a1)),await this[_0x522c64(0x1d4)](_0x99f8cc,_0x235ef5,{'parse_mode':'Markdown'}),console[_0x522c64(0x193)](_0x522c64(0x23a)+_0x99f8cc+':\x20'+(_0x1903c2[_0x522c64(0x1e1)]?_0x522c64(0x1e1):'failed'));}catch(_0x2bf5f2){console['error']('Failed\x20to\x20send\x20login\x20notification:',_0x2bf5f2);}}async[a55_0x1909e3(0x258)](_0x4919b3,_0x495708){const _0x3a78a4=a55_0x1909e3;try{const _0x518c2f=await database_1['default'][_0x3a78a4(0x1eb)]['findUnique']({'where':{'shopId':_0x4919b3},'select':{'notificationApiError':!![]}});if(!_0x518c2f?.[_0x3a78a4(0x1b7)]){console[_0x3a78a4(0x193)](_0x3a78a4(0x252)+_0x4919b3);return;}let _0x8d8019=_0x3a78a4(0x227)+('🔗\x20Endpoint:\x20`'+_0x495708[_0x3a78a4(0x1ff)]+'\x20'+_0x495708['endpoint']+'`\x0a')+(_0x3a78a4(0x245)+_0x495708['timestamp'][_0x3a78a4(0x210)](_0x3a78a4(0x1d9))+'\x0a');_0x495708['statusCode']&&(_0x8d8019+=_0x3a78a4(0x1d8)+_0x495708['statusCode']+'`\x0a'),_0x8d8019+=_0x3a78a4(0x1f0)+_0x495708[_0x3a78a4(0x1a9)]+'`\x0a',_0x495708[_0x3a78a4(0x247)]&&(_0x8d8019+=_0x3a78a4(0x237)+_0x495708['requestId']+'`\x0a'),_0x8d8019+=_0x3a78a4(0x26b),await this[_0x3a78a4(0x1d4)](_0x4919b3,_0x8d8019,{'parse_mode':_0x3a78a4(0x26d)}),console[_0x3a78a4(0x193)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x4919b3+':\x20'+_0x495708[_0x3a78a4(0x22e)]);}catch(_0x518b7f){console[_0x3a78a4(0x268)](_0x3a78a4(0x19d),_0x518b7f);}}async[a55_0x1909e3(0x1c5)](_0x34698d,_0x594460,_0x465df6){const _0x241622=a55_0x1909e3;let _0x334335='🔔\x20*'+_0x594460+_0x241622(0x1d0);for(const [_0x51cd97,_0x34ebd4]of Object['entries'](_0x465df6)){_0x34ebd4!==null&&_0x34ebd4!==undefined&&(_0x334335+=_0x51cd97+_0x241622(0x18e)+_0x34ebd4+'`\x0a');}await this[_0x241622(0x1d4)](_0x34698d,_0x334335,{'parse_mode':_0x241622(0x26d)});}[a55_0x1909e3(0x239)](){const _0x2811c0=a55_0x1909e3;return{'isActive':!!this['bot'],'username':this[_0x2811c0(0x266)]};}[a55_0x1909e3(0x19e)](){const _0x7eee00=a55_0x1909e3;this[_0x7eee00(0x260)]&&(this[_0x7eee00(0x260)][_0x7eee00(0x25c)](),this['bot']=null,console[_0x7eee00(0x193)](_0x7eee00(0x1a6)));}}exports[a55_0x1909e3(0x1c6)]=TelegramBotService,exports[a55_0x1909e3(0x191)]=new TelegramBotService();