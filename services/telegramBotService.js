'use strict';const a53_0x418e29=a53_0x7ead;(function(_0x1594e2,_0x174fc0){const _0xd43573=a53_0x7ead,_0x436f7c=_0x1594e2();while(!![]){try{const _0x20c05c=parseInt(_0xd43573(0x15f))/0x1+parseInt(_0xd43573(0x12e))/0x2*(parseInt(_0xd43573(0x16a))/0x3)+-parseInt(_0xd43573(0x13b))/0x4+parseInt(_0xd43573(0x187))/0x5+-parseInt(_0xd43573(0x150))/0x6*(parseInt(_0xd43573(0x129))/0x7)+parseInt(_0xd43573(0x159))/0x8*(parseInt(_0xd43573(0x1a5))/0x9)+-parseInt(_0xd43573(0x139))/0xa;if(_0x20c05c===_0x174fc0)break;else _0x436f7c['push'](_0x436f7c['shift']());}catch(_0x4ef7db){_0x436f7c['push'](_0x436f7c['shift']());}}}(a53_0x3b57,0xc5c07));function a53_0x7ead(_0x60b7bb,_0x528658){const _0x3b572d=a53_0x3b57();return a53_0x7ead=function(_0x7ead7f,_0x3a2a2c){_0x7ead7f=_0x7ead7f-0x104;let _0x15cc45=_0x3b572d[_0x7ead7f];return _0x15cc45;},a53_0x7ead(_0x60b7bb,_0x528658);}var __importDefault=this&&this[a53_0x418e29(0x191)]||function(_0x1d033c){const _0x12b1b0=a53_0x418e29;return _0x1d033c&&_0x1d033c[_0x12b1b0(0x1df)]?_0x1d033c:{'default':_0x1d033c};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a53_0x418e29(0x10a)]=exports[a53_0x418e29(0x1d7)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a53_0x418e29(0x19f))),database_1=__importDefault(require('../config/database')),gateway_1=require(a53_0x418e29(0x194));function a53_0x3b57(){const _0x463ab0=['/disconnect\x20-\x20disconnect\x20from\x20notifications','\x20verified\x20for\x20shop\x20','Successful\x20login','Error\x20handling\x20/debug\x20command:','New\x20payment\x20created','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','sendShopNotification','create','📧\x20Email:\x20`','shopId','requestId','\x20\x20\x20Public\x20Key:\x20`','Error\x20handling\x20/status\x20command:','Payment\x20is\x20being\x20processed','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','🔔\x20You\x20receive\x20notifications\x20about:\x0a','pk_','TelegramBotService','•\x20New\x20payments\x0a','Markdown','errorMessage','...\x22','sendMessage','sk_','customerEmail','__esModule','test','🏪\x20Gateway:\x20`','Example:\x0a','statusCode','publicKey','botUsername','telegramBotService','`\x0a\x0a','toLocaleString','🆔\x20Payout\x20ID:\x20`','•\x20Payouts\x0a\x0a','🔌\x20User\x20','`.\x0a\x0a','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','🚨\x20*API\x20Error*\x0a\x0a','chat','❌\x20Please\x20use\x20/start\x20command\x20first','/status\x20-\x20check\x20connection\x20status\x0a','update','log','sendApiErrorNotification','warn','telegramId','Error\x20sending\x20shop\x20notification:','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','Contact\x20administrator.','updatedAt','sendPayoutNotification','✅\x20Welcome\x20back!\x0a\x0a','method','endpoint','map','Payment\x20chargeback','timestamp','trapay_bot','User\x20','\x20USD*\x0a','35UtIdQN','sendCustomNotification','🎉\x20*Congratulations!*\x0a\x0a','handleSingleLineVerification','Payout\x20rejected','8286HlVVad','last_name','success','en-US','Error\x20handling\x20/start\x20command:','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','Payment\x20failed','Telegram\x20bot\x20error:','botToken','🔔\x20*','✅\x20Connected\x20to\x20shop:\x20*','26936990zzvRvY',':\x20username=\x22','470084aOBtUl','❌\x20Error\x20getting\x20debug\x20information.','\x22\x20->\x20display\x20\x22','📝\x20Notes:\x20','🔗\x20Endpoint:\x20`','username','\x20initialized\x20successfully','🏦\x20Method:\x20`','allSettled','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','📊\x20*Connection\x20Status*\x0a\x0a','status','gateway','sendPaymentNotification','entries','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','\x20\x20\x20Username:\x20`','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','\x0a👤\x20*Customer\x20Information:*\x0a','from','1868970LDGqgW','failed','•\x20Payment\x20status\x20changes\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','orderId','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','Failed\x20login\x20attempt','chat\x20not\x20found','includes','56qWxUDQ','first_name','👤\x20Username:\x20`','toLocaleDateString','❌\x20Error:\x20`','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','1451777vAZLTa','currency','amount','chargebackAmount','Failed\x20to\x20send\x20login\x20notification:','\x20(@','•\x20Important\x20events\x0a\x0a','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','error','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','text','774ooXtdq','stopBot','shopSettings','💸\x20Penalty\x20amount:\x20*','📅\x20Date:\x20','forEach','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','findMany','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','Error\x20in\x20handleSingleLineVerification:','📱\x20Telegram\x20notification:\x20gateway\x20\x22','🌐\x20IP\x20address:\x20`','Telegram\x20bot\x20polling\x20error:','❌\x20Invalid\x20username\x20format:\x20`','You\x20sent\x20','Available\x20usernames:\x0a','substring','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','✅\x20Telegram\x20user\x20','*\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','trim','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','Commands:\x0a','message','default','💸\x20Amount:\x20*','6958330CBSPbx','notificationApiError','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','telegramUser','•\x20`','secretKey','Payment\x20successfully\x20paid','🔍\x20*Debug\x20Information*\x0a\x0a','bot','...`\x0a\x0a','__importDefault','🔔\x20Notifications\x20are\x20active\x0a\x0a','txid','../types/gateway',':\x20`','findUnique','📱\x20Your\x20Telegram\x20ID:\x20`','📱\x20Created\x20new\x20Telegram\x20user:\x20','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','notificationLogin','toString','name','🛑\x20Telegram\x20bot\x20stopped','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','node-telegram-bot-api','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','📱\x20Shop:\x20*','\x22,\x20apiKey=\x22','\x20USDT*\x0a','Error\x20handling\x20message:','1628163ModUUp','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','length','findFirst','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','blocked','•\x20Payouts\x0a','New\x20payout\x20created','setupBotHandlers','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','.\x20*','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','`\x20is\x20inactive.\x0a\x0a','customerName','shop','createdAt','startsWith','env','userAgent','Failed\x20to\x20send\x20API\x20error\x20notification:','🆔\x20Payment\x20ID:\x20`','`\x20(','join','\x20via\x20single-line\x20input','getGatewayDisplayNameForTelegram','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','❌\x20Shop\x20with\x20username\x20`','🔗\x20TXID:\x20`','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','ACTIVE','onText','isVerified'];a53_0x3b57=function(){return _0x463ab0;};return a53_0x3b57();}class TelegramBotService{constructor(){const _0x217a32=a53_0x418e29;this['bot']=null,this[_0x217a32(0x136)]=process['env']['TELEGRAM_BOT_TOKEN']||'',this[_0x217a32(0x109)]=process[_0x217a32(0x1b6)]['TELEGRAM_BOT_USERNAME']||_0x217a32(0x126),this[_0x217a32(0x136)]?this['initializeBot']():console['warn']('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}['initializeBot'](){const _0x3e3520=a53_0x418e29;try{this[_0x3e3520(0x18f)]=new node_telegram_bot_api_1['default'](this[_0x3e3520(0x136)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x3e3520(0x117)]('✅\x20Telegram\x20bot\x20@'+this[_0x3e3520(0x109)]+_0x3e3520(0x141));}catch(_0x1502db){console[_0x3e3520(0x167)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x1502db);}}[a53_0x418e29(0x1ad)](){const _0xa0e5c9=a53_0x418e29;if(!this[_0xa0e5c9(0x18f)])return;this[_0xa0e5c9(0x18f)][_0xa0e5c9(0x1c4)](/\/start/,async _0x32e6b6=>{const _0x37f563=_0xa0e5c9,_0x57ed7f=_0x32e6b6[_0x37f563(0x113)]['id'],_0x8686b3=_0x32e6b6['from']?.['id'][_0x37f563(0x19b)](),_0x19bc58=_0x32e6b6[_0x37f563(0x14f)]?.[_0x37f563(0x140)],_0x340553=_0x32e6b6[_0x37f563(0x14f)]?.[_0x37f563(0x15a)],_0x1693e5=_0x32e6b6[_0x37f563(0x14f)]?.[_0x37f563(0x12f)];if(!_0x8686b3)return;try{let _0x596bc7=await database_1[_0x37f563(0x185)][_0x37f563(0x18a)]['findUnique']({'where':{'telegramId':_0x8686b3},'include':{'shop':!![]}});!_0x596bc7?(_0x596bc7=await database_1['default'][_0x37f563(0x18a)][_0x37f563(0x1cd)]({'data':{'telegramId':_0x8686b3,'username':_0x19bc58,'firstName':_0x340553,'lastName':_0x1693e5,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x37f563(0x117)](_0x37f563(0x198)+_0x8686b3+_0x37f563(0x164)+_0x19bc58+')')):_0x596bc7=await database_1['default'][_0x37f563(0x18a)][_0x37f563(0x116)]({'where':{'telegramId':_0x8686b3},'data':{'username':_0x19bc58,'firstName':_0x340553,'lastName':_0x1693e5},'include':{'shop':!![]}}),_0x596bc7['isVerified']&&_0x596bc7['shopId']&&_0x596bc7[_0x37f563(0x1b3)]?await this[_0x37f563(0x18f)]?.[_0x37f563(0x1dc)](_0x57ed7f,_0x37f563(0x120)+(_0x37f563(0x155)+_0x596bc7[_0x37f563(0x1b3)][_0x37f563(0x19c)]+'*\x0a')+('Username:\x20`'+_0x596bc7[_0x37f563(0x1b3)]['username']+_0x37f563(0x10b))+_0x37f563(0x1d5)+_0x37f563(0x1d8)+_0x37f563(0x152)+_0x37f563(0x10e)+_0x37f563(0x183)+_0x37f563(0x115)+_0x37f563(0x1c6),{'parse_mode':_0x37f563(0x1d9)}):(_0x596bc7[_0x37f563(0x1cf)]&&!_0x596bc7[_0x37f563(0x1c5)]&&(await database_1['default'][_0x37f563(0x18a)][_0x37f563(0x116)]({'where':{'telegramId':_0x8686b3},'data':{'shopId':null,'isVerified':![]}}),console[_0x37f563(0x117)](_0x37f563(0x182)+_0x8686b3)),await this[_0x37f563(0x18f)]?.[_0x37f563(0x1dc)](_0x57ed7f,_0x37f563(0x1a9)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x37f563(0x181)+_0x37f563(0x106)+_0x37f563(0x1d4)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x37f563(0x1d9)}));}catch(_0x44e346){console[_0x37f563(0x167)](_0x37f563(0x132),_0x44e346),await this[_0x37f563(0x18f)]?.[_0x37f563(0x1dc)](_0x57ed7f,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0xa0e5c9(0x18f)][_0xa0e5c9(0x1c4)](/\/disconnect/,async _0x307d20=>{const _0xfb3003=_0xa0e5c9,_0x451f7d=_0x307d20[_0xfb3003(0x113)]['id'],_0x522614=_0x307d20['from']?.['id'][_0xfb3003(0x19b)]();if(!_0x522614)return;try{const _0x2e50a8=await database_1['default'][_0xfb3003(0x18a)][_0xfb3003(0x196)]({'where':{'telegramId':_0x522614},'include':{'shop':!![]}});if(!_0x2e50a8||!_0x2e50a8['isVerified']||!_0x2e50a8[_0xfb3003(0x1cf)]){await this['bot']?.['sendMessage'](_0x451f7d,_0xfb3003(0x1b0));return;}const _0x26c257=_0x2e50a8['shop']?.[_0xfb3003(0x19c)]||'unknown\x20shop';await database_1['default'][_0xfb3003(0x18a)][_0xfb3003(0x116)]({'where':{'telegramId':_0x522614},'data':{'shopId':null,'isVerified':![]}}),console[_0xfb3003(0x117)](_0xfb3003(0x10f)+_0x522614+'\x20disconnected\x20from\x20shop\x20'+_0x2e50a8[_0xfb3003(0x1cf)]),await this['bot']?.[_0xfb3003(0x1dc)](_0x451f7d,_0xfb3003(0x153)+_0x26c257+'*.\x0a\x0a'+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0xfb3003(0x1d9)});}catch(_0x3a0f26){console[_0xfb3003(0x167)]('Error\x20handling\x20/disconnect\x20command:',_0x3a0f26),await this[_0xfb3003(0x18f)]?.[_0xfb3003(0x1dc)](_0x451f7d,_0xfb3003(0x170));}}),this[_0xa0e5c9(0x18f)][_0xa0e5c9(0x1c4)](/\/status/,async _0x3ad3b9=>{const _0x1ecd05=_0xa0e5c9,_0x2874d4=_0x3ad3b9[_0x1ecd05(0x113)]['id'],_0xa99011=_0x3ad3b9['from']?.['id']['toString']();if(!_0xa99011)return;try{const _0x267037=await database_1['default'][_0x1ecd05(0x18a)]['findUnique']({'where':{'telegramId':_0xa99011},'include':{'shop':!![]}});if(!_0x267037){await this[_0x1ecd05(0x18f)]?.['sendMessage'](_0x2874d4,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+'Use\x20/start\x20to\x20begin.');return;}if(!_0x267037[_0x1ecd05(0x1c5)]||!_0x267037[_0x1ecd05(0x1cf)]||!_0x267037[_0x1ecd05(0x1b3)]){await this[_0x1ecd05(0x18f)]?.[_0x1ecd05(0x1dc)](_0x2874d4,_0x1ecd05(0x17f)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x1ecd05(0x18f)]?.[_0x1ecd05(0x1dc)](_0x2874d4,_0x1ecd05(0x146)+(_0x1ecd05(0x138)+_0x267037[_0x1ecd05(0x1b3)][_0x1ecd05(0x19c)]+'*\x0a')+(_0x1ecd05(0x15b)+_0x267037[_0x1ecd05(0x1b3)][_0x1ecd05(0x140)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x267037[_0x1ecd05(0x11e)][_0x1ecd05(0x15c)](_0x1ecd05(0x131))+'\x0a\x0a')+_0x1ecd05(0x192)+_0x1ecd05(0x183)+_0x1ecd05(0x1c6),{'parse_mode':'Markdown'});}catch(_0x1eb669){console[_0x1ecd05(0x167)](_0x1ecd05(0x1d2),_0x1eb669),await this[_0x1ecd05(0x18f)]?.['sendMessage'](_0x2874d4,_0x1ecd05(0x170));}}),this['bot']['onText'](/\/debug/,async _0x7b7559=>{const _0x114fc9=_0xa0e5c9,_0x1399cd=_0x7b7559['chat']['id'],_0x482834=_0x7b7559['from']?.['id'][_0x114fc9(0x19b)]();if(!_0x482834)return;try{const _0x21d011=await database_1[_0x114fc9(0x185)][_0x114fc9(0x1b3)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x430121=_0x114fc9(0x18e);_0x430121+=_0x114fc9(0x197)+_0x482834+_0x114fc9(0x10b),_0x430121+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x21d011[_0x114fc9(0x16f)]((_0xdf9cab,_0xba77df)=>{const _0x461183=_0x114fc9;_0x430121+=_0xba77df+0x1+_0x461183(0x1af)+_0xdf9cab[_0x461183(0x19c)]+'*\x0a',_0x430121+=_0x461183(0x14c)+_0xdf9cab['username']+'`\x0a',_0x430121+='\x20\x20\x20Status:\x20'+_0xdf9cab[_0x461183(0x147)]+'\x0a',_0x430121+=_0x461183(0x1d1)+_0xdf9cab[_0x461183(0x108)]['substring'](0x0,0xf)+_0x461183(0x190);}),await this[_0x114fc9(0x18f)]?.['sendMessage'](_0x1399cd,_0x430121,{'parse_mode':'Markdown'});}catch(_0x4b206d){console[_0x114fc9(0x167)](_0x114fc9(0x1c9),_0x4b206d),await this['bot']?.['sendMessage'](_0x1399cd,_0x114fc9(0x13c));}}),this[_0xa0e5c9(0x18f)]['on'](_0xa0e5c9(0x184),async _0x3e2cbc=>{const _0x4c32ae=_0xa0e5c9;if(_0x3e2cbc['text']?.[_0x4c32ae(0x1b5)]('/'))return;const _0x551360=_0x3e2cbc[_0x4c32ae(0x113)]['id'],_0x4b5c3b=_0x3e2cbc[_0x4c32ae(0x14f)]?.['id'][_0x4c32ae(0x19b)](),_0x49570c=_0x3e2cbc[_0x4c32ae(0x169)]?.[_0x4c32ae(0x180)]();if(!_0x4b5c3b||!_0x49570c)return;try{const _0x46a16a=await database_1['default']['telegramUser'][_0x4c32ae(0x196)]({'where':{'telegramId':_0x4b5c3b},'include':{'shop':!![]}});if(!_0x46a16a){await this[_0x4c32ae(0x18f)]?.[_0x4c32ae(0x1dc)](_0x551360,_0x4c32ae(0x114));return;}if(_0x46a16a['isVerified']&&_0x46a16a['shopId']&&_0x46a16a[_0x4c32ae(0x1b3)]){await this[_0x4c32ae(0x18f)]?.['sendMessage'](_0x551360,_0x4c32ae(0x166)+_0x46a16a['shop']['name']+'*.\x0a\x0a'+_0x4c32ae(0x14b),{'parse_mode':_0x4c32ae(0x1d9)});return;}const _0x229dfe=_0x49570c['split'](/\s+/);if(_0x229dfe[_0x4c32ae(0x1a7)]!==0x2){await this['bot']?.[_0x4c32ae(0x1dc)](_0x551360,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x4c32ae(0x181)+'Example:\x0a'+_0x4c32ae(0x1d4)+(_0x4c32ae(0x179)+_0x229dfe[_0x4c32ae(0x1a7)]+'\x20parts:\x20'+_0x229dfe[_0x4c32ae(0x123)](_0x27972f=>'`'+_0x27972f+'`')[_0x4c32ae(0x1bb)](',\x20')),{'parse_mode':_0x4c32ae(0x1d9)});return;}const [_0x15c68d,_0x2cad35]=_0x229dfe;console['log']('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x4b5c3b+_0x4c32ae(0x13a)+_0x15c68d+'\x22,\x20apiKey=\x22'+_0x2cad35['substring'](0x0,0xa)+_0x4c32ae(0x1db)),await this[_0x4c32ae(0x12c)](_0x551360,_0x4b5c3b,_0x15c68d,_0x2cad35);}catch(_0x17bf60){console[_0x4c32ae(0x167)](_0x4c32ae(0x1a4),_0x17bf60),await this[_0x4c32ae(0x18f)]?.[_0x4c32ae(0x1dc)](_0x551360,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0xa0e5c9(0x18f)]['on'](_0xa0e5c9(0x167),_0x468a32=>{const _0x301a1f=_0xa0e5c9;console['error'](_0x301a1f(0x135),_0x468a32);}),this['bot']['on']('polling_error',_0x2c5805=>{const _0x41a1e2=_0xa0e5c9;console[_0x41a1e2(0x167)](_0x41a1e2(0x177),_0x2c5805);});}async[a53_0x418e29(0x12c)](_0x2f507d,_0x563b91,_0x1e8436,_0x244cca){const _0x383d2b=a53_0x418e29;try{console[_0x383d2b(0x117)](_0x383d2b(0x144)+_0x563b91+_0x383d2b(0x13a)+_0x1e8436+_0x383d2b(0x1a2)+_0x244cca['substring'](0x0,0xa)+'...\x22');if(!_0x1e8436||_0x1e8436[_0x383d2b(0x1a7)]<0x3||_0x1e8436[_0x383d2b(0x1a7)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x383d2b(0x104)](_0x1e8436)){await this[_0x383d2b(0x18f)]?.['sendMessage'](_0x2f507d,_0x383d2b(0x178)+_0x1e8436+'`\x0a\x0a'+_0x383d2b(0x11c),{'parse_mode':_0x383d2b(0x1d9)});return;}if(!_0x244cca||!_0x244cca['startsWith'](_0x383d2b(0x1d6))&&!_0x244cca[_0x383d2b(0x1b5)](_0x383d2b(0x1dd))){await this[_0x383d2b(0x18f)]?.[_0x383d2b(0x1dc)](_0x2f507d,_0x383d2b(0x1ae)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':'Markdown'});return;}const _0x1a5dbd=await database_1[_0x383d2b(0x185)]['shop'][_0x383d2b(0x196)]({'where':{'username':_0x1e8436},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x1a5dbd){const _0x1cf3e1=await database_1[_0x383d2b(0x185)][_0x383d2b(0x1b3)][_0x383d2b(0x171)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x514529=_0x383d2b(0x1c0)+_0x1e8436+'`\x20not\x20found.\x0a\x0a';_0x1cf3e1[_0x383d2b(0x1a7)]>0x0?(_0x514529+=_0x383d2b(0x17a),_0x1cf3e1[_0x383d2b(0x16f)](_0x415a28=>{const _0x5bd94f=_0x383d2b;_0x514529+=_0x5bd94f(0x18b)+_0x415a28[_0x5bd94f(0x140)]+_0x5bd94f(0x1ba)+_0x415a28[_0x5bd94f(0x19c)]+')\x0a';}),_0x514529+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x514529+='Check\x20spelling\x20and\x20try\x20again.';await this['bot']?.['sendMessage'](_0x2f507d,_0x514529,{'parse_mode':_0x383d2b(0x1d9)});return;}if(_0x1a5dbd[_0x383d2b(0x147)]!==_0x383d2b(0x1c3)){await this[_0x383d2b(0x18f)]?.['sendMessage'](_0x2f507d,'❌\x20Shop\x20`'+_0x1e8436+_0x383d2b(0x1b1)+_0x383d2b(0x11d),{'parse_mode':_0x383d2b(0x1d9)});return;}if(_0x1a5dbd[_0x383d2b(0x108)]!==_0x244cca&&_0x1a5dbd[_0x383d2b(0x18c)]!==_0x244cca){await this[_0x383d2b(0x18f)]?.['sendMessage'](_0x2f507d,_0x383d2b(0x111)+_0x1e8436+_0x383d2b(0x110)+_0x383d2b(0x1c2)+_0x383d2b(0x168),{'parse_mode':'Markdown'});return;}const _0x30fa81=await database_1[_0x383d2b(0x185)][_0x383d2b(0x18a)][_0x383d2b(0x1a8)]({'where':{'shopId':_0x1a5dbd['id'],'isVerified':!![],'telegramId':{'not':_0x563b91}}});if(_0x30fa81){await this[_0x383d2b(0x18f)]?.[_0x383d2b(0x1dc)](_0x2f507d,_0x383d2b(0x189)+_0x1e8436+_0x383d2b(0x110)+_0x383d2b(0x1bf),{'parse_mode':_0x383d2b(0x1d9)});return;}await database_1[_0x383d2b(0x185)]['telegramUser']['update']({'where':{'telegramId':_0x563b91},'data':{'shopId':_0x1a5dbd['id'],'isVerified':!![]}}),await this[_0x383d2b(0x18f)]?.[_0x383d2b(0x1dc)](_0x2f507d,_0x383d2b(0x12b)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x383d2b(0x1a1)+_0x1a5dbd['name']+'*\x0a')+(_0x383d2b(0x15b)+_0x1a5dbd[_0x383d2b(0x140)]+'`\x0a\x0a')+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x383d2b(0x1d8)+_0x383d2b(0x152)+_0x383d2b(0x1ab)+_0x383d2b(0x165)+_0x383d2b(0x183)+_0x383d2b(0x115)+_0x383d2b(0x1c6),{'parse_mode':_0x383d2b(0x1d9)}),console[_0x383d2b(0x117)](_0x383d2b(0x17d)+_0x563b91+_0x383d2b(0x1c7)+_0x1a5dbd['username']+_0x383d2b(0x1bc));}catch(_0x47b833){console[_0x383d2b(0x167)](_0x383d2b(0x174),_0x47b833),await this[_0x383d2b(0x18f)]?.[_0x383d2b(0x1dc)](_0x2f507d,_0x383d2b(0x172));}}async[a53_0x418e29(0x1cc)](_0x48bcbe,_0x1262be,_0x11f9a7){const _0x21caa0=a53_0x418e29;if(!this[_0x21caa0(0x18f)]){console[_0x21caa0(0x119)](_0x21caa0(0x173));return;}try{const _0x51963e=await database_1[_0x21caa0(0x185)]['telegramUser'][_0x21caa0(0x171)]({'where':{'shopId':_0x48bcbe,'isVerified':!![]}});if(_0x51963e[_0x21caa0(0x1a7)]===0x0){console[_0x21caa0(0x117)](_0x21caa0(0x19e)+_0x48bcbe);return;}const _0xc006b7=_0x51963e[_0x21caa0(0x123)](async _0xb3d9e3=>{const _0x510da8=_0x21caa0;try{await this[_0x510da8(0x18f)]?.[_0x510da8(0x1dc)](_0xb3d9e3['telegramId'],_0x1262be,_0x11f9a7),console[_0x510da8(0x117)](_0x510da8(0x1a6)+_0xb3d9e3[_0x510da8(0x11a)]);}catch(_0x5d1cd0){console[_0x510da8(0x167)](_0x510da8(0x1cb)+_0xb3d9e3['telegramId']+':',_0x5d1cd0),_0x5d1cd0 instanceof Error&&(_0x5d1cd0[_0x510da8(0x184)]['includes'](_0x510da8(0x1aa))||_0x5d1cd0['message'][_0x510da8(0x158)](_0x510da8(0x157))||_0x5d1cd0['message'][_0x510da8(0x158)]('user\x20is\x20deactivated'))&&(await database_1[_0x510da8(0x185)][_0x510da8(0x18a)][_0x510da8(0x116)]({'where':{'id':_0xb3d9e3['id']},'data':{'isVerified':![]}}),console[_0x510da8(0x117)](_0x510da8(0x127)+_0xb3d9e3[_0x510da8(0x11a)]+_0x510da8(0x133)));}});await Promise[_0x21caa0(0x143)](_0xc006b7);}catch(_0x471ac7){console[_0x21caa0(0x167)](_0x21caa0(0x11b),_0x471ac7);}}async[a53_0x418e29(0x149)](_0x2db179,_0x31f63a,_0x133c23){const _0x2bd43f=a53_0x418e29,_0x659846={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x545013={'created':_0x2bd43f(0x1ca),'paid':_0x2bd43f(0x18d),'failed':_0x2bd43f(0x134),'expired':'Payment\x20expired','refund':'Payment\x20refund','chargeback':_0x2bd43f(0x124),'processing':_0x2bd43f(0x1d3)},_0xe6a8bc=_0x659846[_0x133c23],_0xfe5e1=_0x545013[_0x133c23],_0x1ade8b=(0x0,gateway_1[_0x2bd43f(0x1bd)])(_0x31f63a[_0x2bd43f(0x148)]);console[_0x2bd43f(0x117)](_0x2bd43f(0x175)+_0x31f63a[_0x2bd43f(0x148)]+_0x2bd43f(0x13d)+_0x1ade8b+'\x22');let _0x127851=_0xe6a8bc+'\x20*'+_0xfe5e1+'*\x0a\x0a'+('💰\x20Amount:\x20*'+_0x31f63a[_0x2bd43f(0x161)]+'\x20'+_0x31f63a[_0x2bd43f(0x160)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x31f63a[_0x2bd43f(0x154)]||_0x31f63a['id'])+'`\x0a')+(_0x2bd43f(0x1b9)+_0x31f63a['id']+'`\x0a')+(_0x2bd43f(0x105)+_0x1ade8b+'`\x0a')+(_0x2bd43f(0x16e)+new Date(_0x31f63a[_0x2bd43f(0x1b4)])[_0x2bd43f(0x10c)](_0x2bd43f(0x131))+'\x0a');(_0x31f63a[_0x2bd43f(0x1b2)]||_0x31f63a[_0x2bd43f(0x1de)])&&(_0x127851+=_0x2bd43f(0x14e),_0x31f63a[_0x2bd43f(0x1b2)]&&(_0x127851+='📛\x20Name:\x20`'+_0x31f63a[_0x2bd43f(0x1b2)]+'`\x0a'),_0x31f63a['customerEmail']&&(_0x127851+=_0x2bd43f(0x1ce)+_0x31f63a[_0x2bd43f(0x1de)]+'`\x0a')),_0x133c23==='chargeback'&&_0x31f63a[_0x2bd43f(0x162)]&&(_0x127851+=_0x2bd43f(0x16d)+_0x31f63a[_0x2bd43f(0x162)]+_0x2bd43f(0x1a3)),_0x133c23==='processing'&&(_0x127851+=_0x2bd43f(0x1be)),_0x31f63a['adminNotes']&&(_0x127851+=_0x2bd43f(0x13e)+_0x31f63a['adminNotes']+'\x0a'),await this[_0x2bd43f(0x1cc)](_0x2db179,_0x127851,{'parse_mode':_0x2bd43f(0x1d9)});}async[a53_0x418e29(0x11f)](_0x53dcd3,_0x3be15d,_0x1c66da){const _0x55fdd1=a53_0x418e29,_0x21e216={'created':'📤','completed':'✅','rejected':'❌'},_0x20258c={'created':_0x55fdd1(0x1ac),'completed':'Payout\x20completed','rejected':_0x55fdd1(0x12d)},_0xb342f9=_0x21e216[_0x1c66da],_0x4cb341=_0x20258c[_0x1c66da],_0x1a045b=_0xb342f9+'\x20*'+_0x4cb341+_0x55fdd1(0x17e)+(_0x55fdd1(0x186)+_0x3be15d[_0x55fdd1(0x161)]+_0x55fdd1(0x128))+(_0x55fdd1(0x142)+_0x3be15d['method']+'`\x0a')+(_0x55fdd1(0x10d)+_0x3be15d['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x3be15d['createdAt'])[_0x55fdd1(0x10c)](_0x55fdd1(0x131))+'\x0a')+(_0x3be15d['txid']?_0x55fdd1(0x1c1)+_0x3be15d[_0x55fdd1(0x193)]+'`':'');await this[_0x55fdd1(0x1cc)](_0x53dcd3,_0x1a045b,{'parse_mode':_0x55fdd1(0x1d9)});}async['sendLoginNotification'](_0x2999ac,_0x5f4e37){const _0x27ad65=a53_0x418e29;try{const _0x4c2537=await database_1['default']['shopSettings'][_0x27ad65(0x196)]({'where':{'shopId':_0x2999ac},'select':{'notificationLogin':!![]}});if(!_0x4c2537?.[_0x27ad65(0x19a)]){console[_0x27ad65(0x117)](_0x27ad65(0x14d)+_0x2999ac);return;}const _0x5deb03=_0x5f4e37[_0x27ad65(0x130)]?'🔐':'🚨',_0x415bfe=_0x5f4e37[_0x27ad65(0x130)]?_0x27ad65(0x1c8):_0x27ad65(0x156);let _0x33967f=_0x5deb03+'\x20*'+_0x415bfe+_0x27ad65(0x17e)+(_0x27ad65(0x15b)+_0x5f4e37[_0x27ad65(0x140)]+'`\x0a')+('📅\x20Time:\x20'+_0x5f4e37[_0x27ad65(0x125)][_0x27ad65(0x10c)](_0x27ad65(0x131))+'\x0a');_0x5f4e37['ipAddress']&&(_0x33967f+=_0x27ad65(0x176)+_0x5f4e37['ipAddress']+'`\x0a');if(_0x5f4e37['userAgent']){const _0x309f56=_0x5f4e37[_0x27ad65(0x1b7)][_0x27ad65(0x1a7)]>0x32?_0x5f4e37[_0x27ad65(0x1b7)][_0x27ad65(0x17b)](0x0,0x32)+'...':_0x5f4e37[_0x27ad65(0x1b7)];_0x33967f+='💻\x20Browser:\x20`'+_0x309f56+'`\x0a';}!_0x5f4e37[_0x27ad65(0x130)]&&(_0x33967f+=_0x27ad65(0x15e)),await this['sendShopNotification'](_0x2999ac,_0x33967f,{'parse_mode':_0x27ad65(0x1d9)}),console['log'](_0x27ad65(0x199)+_0x2999ac+':\x20'+(_0x5f4e37[_0x27ad65(0x130)]?'success':_0x27ad65(0x151)));}catch(_0x5ed6df){console[_0x27ad65(0x167)](_0x27ad65(0x163),_0x5ed6df);}}async[a53_0x418e29(0x118)](_0x102eb5,_0x993bdf){const _0x5c2fc0=a53_0x418e29;try{const _0x53bf8f=await database_1['default'][_0x5c2fc0(0x16c)]['findUnique']({'where':{'shopId':_0x102eb5},'select':{'notificationApiError':!![]}});if(!_0x53bf8f?.[_0x5c2fc0(0x188)]){console[_0x5c2fc0(0x117)](_0x5c2fc0(0x17c)+_0x102eb5);return;}let _0x3e3e1b=_0x5c2fc0(0x112)+(_0x5c2fc0(0x13f)+_0x993bdf[_0x5c2fc0(0x121)]+'\x20'+_0x993bdf[_0x5c2fc0(0x122)]+'`\x0a')+('📅\x20Time:\x20'+_0x993bdf[_0x5c2fc0(0x125)][_0x5c2fc0(0x10c)](_0x5c2fc0(0x131))+'\x0a');_0x993bdf[_0x5c2fc0(0x107)]&&(_0x3e3e1b+='📊\x20Error\x20code:\x20`'+_0x993bdf[_0x5c2fc0(0x107)]+'`\x0a'),_0x3e3e1b+=_0x5c2fc0(0x15d)+_0x993bdf[_0x5c2fc0(0x1da)]+'`\x0a',_0x993bdf[_0x5c2fc0(0x1d0)]&&(_0x3e3e1b+='🆔\x20Request\x20ID:\x20`'+_0x993bdf[_0x5c2fc0(0x1d0)]+'`\x0a'),_0x3e3e1b+=_0x5c2fc0(0x1a0),await this[_0x5c2fc0(0x1cc)](_0x102eb5,_0x3e3e1b,{'parse_mode':_0x5c2fc0(0x1d9)}),console['log'](_0x5c2fc0(0x145)+_0x102eb5+':\x20'+_0x993bdf[_0x5c2fc0(0x122)]);}catch(_0x58d64e){console[_0x5c2fc0(0x167)](_0x5c2fc0(0x1b8),_0x58d64e);}}async[a53_0x418e29(0x12a)](_0x5d6d39,_0x1cdff0,_0x137317){const _0x29a007=a53_0x418e29;let _0x1ecb11=_0x29a007(0x137)+_0x1cdff0+'*\x0a\x0a';for(const [_0x1e3556,_0x2c491c]of Object[_0x29a007(0x14a)](_0x137317)){_0x2c491c!==null&&_0x2c491c!==undefined&&(_0x1ecb11+=_0x1e3556+_0x29a007(0x195)+_0x2c491c+'`\x0a');}await this[_0x29a007(0x1cc)](_0x5d6d39,_0x1ecb11,{'parse_mode':_0x29a007(0x1d9)});}['getBotInfo'](){const _0x1c2200=a53_0x418e29;return{'isActive':!!this[_0x1c2200(0x18f)],'username':this[_0x1c2200(0x109)]};}[a53_0x418e29(0x16b)](){const _0x24b02d=a53_0x418e29;this['bot']&&(this[_0x24b02d(0x18f)]['stopPolling'](),this[_0x24b02d(0x18f)]=null,console['log'](_0x24b02d(0x19d)));}}exports[a53_0x418e29(0x1d7)]=TelegramBotService,exports[a53_0x418e29(0x10a)]=new TelegramBotService();