'use strict';const a74_0x1f07e0=a74_0x10f5;(function(_0x31477b,_0x54791e){const _0x1b0dc6=a74_0x10f5,_0x516240=_0x31477b();while(!![]){try{const _0x4be6ae=parseInt(_0x1b0dc6(0x144))/0x1+-parseInt(_0x1b0dc6(0xea))/0x2*(-parseInt(_0x1b0dc6(0x189))/0x3)+parseInt(_0x1b0dc6(0x103))/0x4+-parseInt(_0x1b0dc6(0xf5))/0x5*(-parseInt(_0x1b0dc6(0x166))/0x6)+parseInt(_0x1b0dc6(0x1bd))/0x7*(parseInt(_0x1b0dc6(0x1c7))/0x8)+parseInt(_0x1b0dc6(0x1c6))/0x9*(-parseInt(_0x1b0dc6(0x16f))/0xa)+-parseInt(_0x1b0dc6(0x12e))/0xb;if(_0x4be6ae===_0x54791e)break;else _0x516240['push'](_0x516240['shift']());}catch(_0x3feeab){_0x516240['push'](_0x516240['shift']());}}}(a74_0xb99d,0xb7b44));function a74_0x10f5(_0x5cef58,_0x539068){_0x5cef58=_0x5cef58-0xdb;const _0xb99df3=a74_0xb99d();let _0x10f57e=_0xb99df3[_0x5cef58];return _0x10f57e;}var __importDefault=this&&this[a74_0x1f07e0(0x15a)]||function(_0x5ad00c){const _0x236eeb=a74_0x1f07e0;return _0x5ad00c&&_0x5ad00c[_0x236eeb(0x199)]?_0x5ad00c:{'default':_0x5ad00c};};Object[a74_0x1f07e0(0x131)](exports,'__esModule',{'value':!![]}),exports[a74_0x1f07e0(0x175)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a74_0x1f07e0(0x19b))),gateway_1=require(a74_0x1f07e0(0x1bf));function a74_0xb99d(){const _0x571cdc=['üîó\x20*Transaction\x20Link:*\x20`','\x20USD\x0a','üåê\x20IP\x20address:\x20`','onText','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','üîÑ\x20Processing\x20single-line\x20verification\x20for\x20user\x20','notificationApiError','botToken','‚ùå\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','‚úÖ\x20Connected\x20to\x20shop:\x20*','Username:\x20`','error','Payment\x20is\x20being\x20processed','Error\x20handling\x20/disconnect\x20command:','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','üìù\x20Format:\x20`username\x20api_key`\x0a\x0a','status','*.\x0a\x0a','Successful\x20login','Markdown','üìÖ\x20Connection\x20date:\x20','substring','log','sendShopFile','Commands:\x0a','10484033uxCMFr','ACTIVE','../types/gateway','.jpeg','‚ùå\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Failed\x20to\x20send\x20API\x20error\x20notification:','message','errorMessage','Payment\x20chargeback','7614msPpIw','8rJpZdE','‚ùå\x20Error\x20sending\x20file\x20to\x20shop:','Error\x20handling\x20/status\x20command:','chat\x20not\x20found','‚ùå\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','txid','üë§\x20Username:\x20`','blocked','findUnique','\x0aüí°\x20Check\x20your\x20request\x20or\x20contact\x20support.','shop','‚úÖ\x20Login\x20notification\x20sent\x20for\x20shop\x20','Telegram\x20bot\x20error:','sendNotificationToAll',':\x20username=\x22','üí≥\x20*Wallet:*\x20`','üè¶\x20IBAN:\x20`','text','To\x20reconnect,\x20use\x20the\x20/start\x20command','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','Error\x20handling\x20/debug\x20command:','pk_','create','‚úÖ\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','...','...\x22','application/pdf','‚úÖ\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','üí∞\x20*Amount:*\x20','name','‚úÖ\x20Telegram\x20user\x20','‚ùå\x20Please\x20use\x20/start\x20command\x20first','chargeback','2-digit','.jpg','update','customerUa','\x20verified\x20for\x20shop\x20','trim','Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.','notificationLogin','226698WNLafH','sendDirectFile','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','endpoint','Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a','endsWith','Use\x20/start\x20to\x20connect.','üõë\x20Telegram\x20bot\x20stopped','telegramId','üìù\x20Notes:\x20','wallet','4855vCiHgy','orderId','.pdf','‚ùå\x20Telegram\x20bot\x20not\x20initialized','üåç\x20Country:\x20','‚ùå\x20Error\x20sending\x20direct\x20message:','TelegramBotService','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','\x20\x20\x20Status:\x20','‚ùå\x20Error\x20getting\x20debug\x20information.','customerEmail','setupBotHandlers','‚Ä¢\x20Important\x20events\x0a\x0a','üì±\x20Shop:\x20*','277116dpZhpV','üìÖ\x20Time:\x20','You\x20sent\x20','‚ùå\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','initializeBot','Payment\x20failed','`\x20is\x20inactive.\x0a\x0a','findMany','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','findFirst','trapay_bot','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','‚úÖ\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','adminNotes','üìä\x20*Connection\x20Status*\x0a\x0a','split','default','username','sendDocument','amount','ü§ñ\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','publicKey','/status\x20-\x20check\x20connection\x20status\x0a','remitterIban','User\x20','success','üì±\x20Created\x20new\x20Telegram\x20user:\x20','/disconnect\x20-\x20disconnect\x20from\x20notifications','telegramUser','updatedAt','last_name','üîÑ\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','üì±\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','‚ùå\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','‚Ä¢\x20Payouts\x0a','customerIp','üè™\x20Your\x20connected\x20shop:\x0a','‚úÖ\x20File\x20sent\x20to\x20chat\x20','‚è±Ô∏è\x20*Period:*\x20','üìÖ\x20Date:\x20','üîó\x20Endpoint:\x20`','*\x0a\x0a','üìù\x20Order\x20ID:\x20`','32248381FJYJqZ','includes','Error\x20handling\x20/start\x20command:','defineProperty','‚úÖ\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','‚ùå\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','TELEGRAM_BOT_TOKEN','‚úÖ\x20Direct\x20message\x20sent\x20to\x20chat\x20','sendCustomNotification','\x20USDT*\x0a','üìõ\x20Name:\x20`','üí∏\x20Penalty\x20amount:\x20*','numeric','Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.','\x20users\x20of\x20shop\x20','üì±\x20No\x20active\x20Telegram\x20users\x20found','Payment\x20refund','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','map','sendShopNotification','failed','1422572Yfbseo','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','üîî\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','Error\x20in\x20handleSingleLineVerification:','Error\x20sending\x20shop\x20notification:','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','sendApiErrorNotification','‚úÖ\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','processing','gateway','\x22\x20->\x20display\x20\x22','üö®\x20*API\x20Error*\x0a\x0a','üì±\x20Telegram\x20notification:\x20gateway\x20\x22','üìÖ\x20*Payout\x20Date:*\x20','‚Ä¢\x20Payment\x20status\x20changes\x0a','chargebackAmount','\x20disconnected\x20from\x20shop\x20','bot','allSettled','`\x20not\x20found.\x0a\x0a','‚Ä¢\x20New\x20payments\x0a','chat','__importDefault','en-US','Failed\x20login\x20attempt','`.\x0a\x0a','toLocaleDateString','‚úÖ\x20Welcome\x20back!\x0a\x0a','requestId','image/jpeg','getGatewayDisplayNameForTelegram','toLocaleString','‚ùå\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','‚ùå\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','5604KinuFO','Use\x20/start\x20to\x20begin.','from','customerName','‚ùå\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','shopSettings','ipAddress','‚ùå\x20Error\x20sending\x20file\x20to\x20user\x20','‚ùå\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','3850AtVCMU','‚úÖ\x20File\x20sent\x20to\x20','`\x0a\x0a','application/octet-stream','Contact\x20administrator.','isVerified','telegramBotService','startsWith','New\x20payment\x20created','userAgent','sendDirectMessage','warn','createdAt','image/png','‚ùóÔ∏è\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','‚ùå\x20Shop\x20`','botUsername','üì±\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','\x0aüë§\x20*Customer\x20Information:*\x0a','geo','üîó\x20*Transaction\x20Link:*\x20Pending','sendMessage','üéâ\x20*Congratulations!*\x0a\x0a','handleSingleLineVerification','üîî\x20You\x20receive\x20notifications\x20about:\x0a','Error\x20handling\x20message:','3WJCUye','üîî\x20Notifications\x20are\x20active\x0a\x0a','statusCode','join','shopId','unknown\x20shop','length','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','üåê\x20*Network:*\x20','‚úÖ\x20Telegram\x20bot\x20@',':\x20`','timestamp','\x20initialized\x20successfully','polling_error','üè™\x20Gateway:\x20`','first_name','__esModule','\x22,\x20apiKey=\x22','../config/database','sk_','üîî\x20*','üåê\x20IP:\x20`','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','üÜî\x20Request\x20ID:\x20`','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','Not\x20specified','toString'];a74_0xb99d=function(){return _0x571cdc;};return a74_0xb99d();}class TelegramBotService{constructor(){const _0x7d8e60=a74_0x1f07e0;this[_0x7d8e60(0x155)]=null,this[_0x7d8e60(0x1ab)]=process['env'][_0x7d8e60(0x135)]||'',this[_0x7d8e60(0x17f)]=process['env']['TELEGRAM_BOT_USERNAME']||_0x7d8e60(0x10d),this[_0x7d8e60(0x1ab)]?this[_0x7d8e60(0x107)]():console[_0x7d8e60(0x17a)](_0x7d8e60(0x145));}[a74_0x1f07e0(0x107)](){const _0xc2778=a74_0x1f07e0;try{this[_0xc2778(0x155)]=new node_telegram_bot_api_1[(_0xc2778(0x113))](this[_0xc2778(0x1ab)],{'polling':!![]}),this[_0xc2778(0x100)](),console['log'](_0xc2778(0x192)+this[_0xc2778(0x17f)]+_0xc2778(0x195));}catch(_0x44c0d6){console['error']('‚ùå\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x44c0d6);}}['setupBotHandlers'](){const _0x20cabd=a74_0x1f07e0;if(!this[_0x20cabd(0x155)])return;this['bot'][_0x20cabd(0x1a7)](/\/start/,async _0x1072c3=>{const _0x1f5498=_0x20cabd,_0x66661b=_0x1072c3['chat']['id'],_0x1d821e=_0x1072c3[_0x1f5498(0x168)]?.['id'][_0x1f5498(0x1a3)](),_0x206415=_0x1072c3['from']?.[_0x1f5498(0x114)],_0x449c86=_0x1072c3[_0x1f5498(0x168)]?.[_0x1f5498(0x198)],_0x51694e=_0x1072c3[_0x1f5498(0x168)]?.[_0x1f5498(0x121)];if(!_0x1d821e)return;try{let _0x172288=await database_1[_0x1f5498(0x113)][_0x1f5498(0x11f)][_0x1f5498(0x1cf)]({'where':{'telegramId':_0x1d821e},'include':{'shop':!![]}});!_0x172288?(_0x172288=await database_1[_0x1f5498(0x113)][_0x1f5498(0x11f)][_0x1f5498(0x1dd)]({'data':{'telegramId':_0x1d821e,'username':_0x206415,'firstName':_0x449c86,'lastName':_0x51694e,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x1f5498(0x1ba)](_0x1f5498(0x11d)+_0x1d821e+'\x20(@'+_0x206415+')')):_0x172288=await database_1[_0x1f5498(0x113)][_0x1f5498(0x11f)][_0x1f5498(0xe4)]({'where':{'telegramId':_0x1d821e},'data':{'username':_0x206415,'firstName':_0x449c86,'lastName':_0x51694e},'include':{'shop':!![]}}),_0x172288[_0x1f5498(0x174)]&&_0x172288[_0x1f5498(0x18d)]&&_0x172288[_0x1f5498(0x1d1)]?await this['bot']?.[_0x1f5498(0x184)](_0x66661b,_0x1f5498(0x15f)+(_0x1f5498(0x190)+_0x172288[_0x1f5498(0x1d1)][_0x1f5498(0xde)]+'*\x0a')+(_0x1f5498(0x1ae)+_0x172288[_0x1f5498(0x1d1)][_0x1f5498(0x114)]+_0x1f5498(0x171))+_0x1f5498(0x187)+_0x1f5498(0x158)+_0x1f5498(0x152)+'‚Ä¢\x20Payouts\x0a\x0a'+_0x1f5498(0x1bc)+_0x1f5498(0x119)+_0x1f5498(0x11e),{'parse_mode':_0x1f5498(0x1b7)}):(_0x172288['shopId']&&!_0x172288['isVerified']&&(await database_1[_0x1f5498(0x113)][_0x1f5498(0x11f)]['update']({'where':{'telegramId':_0x1d821e},'data':{'shopId':null,'isVerified':![]}}),console[_0x1f5498(0x1ba)](_0x1f5498(0x122)+_0x1d821e)),await this[_0x1f5498(0x155)]?.['sendMessage'](_0x66661b,_0x1f5498(0x117)+_0x1f5498(0x19f)+_0x1f5498(0x1b3)+'Example:\x0a'+_0x1f5498(0x1a1)+_0x1f5498(0x17d),{'parse_mode':'Markdown'}));}catch(_0x5ce83d){console[_0x1f5498(0x1af)](_0x1f5498(0x130),_0x5ce83d),await this[_0x1f5498(0x155)]?.['sendMessage'](_0x66661b,_0x1f5498(0x106));}}),this[_0x20cabd(0x155)][_0x20cabd(0x1a7)](/\/disconnect/,async _0x460bf0=>{const _0x39e6c7=_0x20cabd,_0x7008a5=_0x460bf0[_0x39e6c7(0x159)]['id'],_0x5531ce=_0x460bf0['from']?.['id'][_0x39e6c7(0x1a3)]();if(!_0x5531ce)return;try{const _0x2595e7=await database_1[_0x39e6c7(0x113)][_0x39e6c7(0x11f)]['findUnique']({'where':{'telegramId':_0x5531ce},'include':{'shop':!![]}});if(!_0x2595e7||!_0x2595e7[_0x39e6c7(0x174)]||!_0x2595e7[_0x39e6c7(0x18d)]){await this[_0x39e6c7(0x155)]?.[_0x39e6c7(0x184)](_0x7008a5,_0x39e6c7(0x1a8));return;}const _0x4e46fa=_0x2595e7[_0x39e6c7(0x1d1)]?.['name']||_0x39e6c7(0x18e);await database_1['default'][_0x39e6c7(0x11f)]['update']({'where':{'telegramId':_0x5531ce},'data':{'shopId':null,'isVerified':![]}}),console[_0x39e6c7(0x1ba)]('üîå\x20User\x20'+_0x5531ce+_0x39e6c7(0x154)+_0x2595e7['shopId']),await this[_0x39e6c7(0x155)]?.[_0x39e6c7(0x184)](_0x7008a5,_0x39e6c7(0x10f)+_0x4e46fa+'*.\x0a\x0a'+_0x39e6c7(0x1d9),{'parse_mode':_0x39e6c7(0x1b7)});}catch(_0x2d6c59){console[_0x39e6c7(0x1af)](_0x39e6c7(0x1b1),_0x2d6c59),await this[_0x39e6c7(0x155)]?.['sendMessage'](_0x7008a5,_0x39e6c7(0x106));}}),this['bot'][_0x20cabd(0x1a7)](/\/status/,async _0x2b561c=>{const _0x5366b6=_0x20cabd,_0x4a5921=_0x2b561c[_0x5366b6(0x159)]['id'],_0x44d745=_0x2b561c[_0x5366b6(0x168)]?.['id']['toString']();if(!_0x44d745)return;try{const _0x5149f7=await database_1[_0x5366b6(0x113)]['telegramUser'][_0x5366b6(0x1cf)]({'where':{'telegramId':_0x44d745},'include':{'shop':!![]}});if(!_0x5149f7){await this[_0x5366b6(0x155)]?.['sendMessage'](_0x4a5921,_0x5366b6(0x164)+_0x5366b6(0x167));return;}if(!_0x5149f7[_0x5366b6(0x174)]||!_0x5149f7[_0x5366b6(0x18d)]||!_0x5149f7[_0x5366b6(0x1d1)]){await this[_0x5366b6(0x155)]?.[_0x5366b6(0x184)](_0x4a5921,_0x5366b6(0xec)+_0x5366b6(0xf0));return;}await this['bot']?.[_0x5366b6(0x184)](_0x4a5921,_0x5366b6(0x111)+(_0x5366b6(0x1ad)+_0x5149f7[_0x5366b6(0x1d1)][_0x5366b6(0xde)]+'*\x0a')+(_0x5366b6(0x1cd)+_0x5149f7[_0x5366b6(0x1d1)][_0x5366b6(0x114)]+'`\x0a')+(_0x5366b6(0x1b8)+_0x5149f7[_0x5366b6(0x120)][_0x5366b6(0x15e)](_0x5366b6(0x15b))+'\x0a\x0a')+_0x5366b6(0x18a)+_0x5366b6(0x1bc)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x5366b6(0x1b7)});}catch(_0x146449){console[_0x5366b6(0x1af)](_0x5366b6(0x1c9),_0x146449),await this['bot']?.['sendMessage'](_0x4a5921,_0x5366b6(0x106));}}),this[_0x20cabd(0x155)][_0x20cabd(0x1a7)](/\/debug/,async _0x214bd4=>{const _0xae15ea=_0x20cabd,_0x391461=_0x214bd4[_0xae15ea(0x159)]['id'],_0x163f99=_0x214bd4['from']?.['id'][_0xae15ea(0x1a3)]();if(!_0x163f99)return;try{const _0x11ead0=await database_1[_0xae15ea(0x113)][_0xae15ea(0x11f)][_0xae15ea(0x1cf)]({'where':{'telegramId':_0x163f99},'include':{'shop':!![]}});let _0x1200b4='üîç\x20*Debug\x20Information*\x0a\x0a';_0x1200b4+='üì±\x20Your\x20Telegram\x20ID:\x20`'+_0x163f99+'`\x0a\x0a',_0x11ead0?.[_0xae15ea(0x174)]&&_0x11ead0[_0xae15ea(0x1d1)]?(_0x1200b4+=_0xae15ea(0x127),_0x1200b4+='\x20\x20\x20Name:\x20*'+_0x11ead0[_0xae15ea(0x1d1)]['name']+'*\x0a',_0x1200b4+='\x20\x20\x20Username:\x20`'+_0x11ead0[_0xae15ea(0x1d1)]['username']+'`\x0a',_0x1200b4+=_0xae15ea(0xfd)+_0x11ead0['shop'][_0xae15ea(0x1b4)]+'\x0a\x0a'):_0x1200b4+='‚ùå\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a',_0x1200b4+=_0xae15ea(0x13c),await this[_0xae15ea(0x155)]?.[_0xae15ea(0x184)](_0x391461,_0x1200b4,{'parse_mode':'Markdown'});}catch(_0x4ffc2d){console['error'](_0xae15ea(0x1db),_0x4ffc2d),await this[_0xae15ea(0x155)]?.[_0xae15ea(0x184)](_0x391461,_0xae15ea(0xfe));}}),this[_0x20cabd(0x155)]['on'](_0x20cabd(0x1c3),async _0x1ac10e=>{const _0x5741d6=_0x20cabd;if(_0x1ac10e[_0x5741d6(0x1d8)]?.[_0x5741d6(0x176)]('/'))return;const _0x2f0f4a=_0x1ac10e[_0x5741d6(0x159)]['id'],_0x59931e=_0x1ac10e[_0x5741d6(0x168)]?.['id']['toString'](),_0x178a7e=_0x1ac10e[_0x5741d6(0x1d8)]?.[_0x5741d6(0xe7)]();if(!_0x59931e||!_0x178a7e)return;try{const _0x4f1b0e=await database_1[_0x5741d6(0x113)][_0x5741d6(0x11f)]['findUnique']({'where':{'telegramId':_0x59931e},'include':{'shop':!![]}});if(!_0x4f1b0e){await this['bot']?.[_0x5741d6(0x184)](_0x2f0f4a,_0x5741d6(0xe0));return;}if(_0x4f1b0e[_0x5741d6(0x174)]&&_0x4f1b0e[_0x5741d6(0x18d)]&&_0x4f1b0e[_0x5741d6(0x1d1)]){await this[_0x5741d6(0x155)]?.[_0x5741d6(0x184)](_0x2f0f4a,_0x5741d6(0x14b)+_0x4f1b0e[_0x5741d6(0x1d1)][_0x5741d6(0xde)]+_0x5741d6(0x1b5)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x5741d6(0x1b7)});return;}const _0x316db5=_0x178a7e[_0x5741d6(0x112)](/\s+/);if(_0x316db5[_0x5741d6(0x18f)]!==0x2){await this[_0x5741d6(0x155)]?.[_0x5741d6(0x184)](_0x2f0f4a,_0x5741d6(0x1c1)+_0x5741d6(0x1b3)+'Example:\x0a'+_0x5741d6(0x1a1)+(_0x5741d6(0x105)+_0x316db5[_0x5741d6(0x18f)]+'\x20parts:\x20'+_0x316db5[_0x5741d6(0x141)](_0x1019d3=>'`'+_0x1019d3+'`')[_0x5741d6(0x18c)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x5a0472,_0x1568e5]=_0x316db5;console[_0x5741d6(0x1ba)](_0x5741d6(0x1a9)+_0x59931e+_0x5741d6(0x1d5)+_0x5a0472+_0x5741d6(0x19a)+_0x1568e5[_0x5741d6(0x1b9)](0x0,0xa)+_0x5741d6(0x1e0)),await this['handleSingleLineVerification'](_0x2f0f4a,_0x59931e,_0x5a0472,_0x1568e5);}catch(_0x21d3e7){console[_0x5741d6(0x1af)](_0x5741d6(0x188),_0x21d3e7),await this[_0x5741d6(0x155)]?.[_0x5741d6(0x184)](_0x2f0f4a,_0x5741d6(0x106));}}),this[_0x20cabd(0x155)]['on'](_0x20cabd(0x1af),_0x3fd987=>{const _0x11bb4f=_0x20cabd;console[_0x11bb4f(0x1af)](_0x11bb4f(0x1d3),_0x3fd987);}),this[_0x20cabd(0x155)]['on'](_0x20cabd(0x196),_0x329d7e=>{const _0x15ef7e=_0x20cabd;console[_0x15ef7e(0x1af)]('Telegram\x20bot\x20polling\x20error:',_0x329d7e);});}async[a74_0x1f07e0(0x186)](_0x3a1cd3,_0x23bbeb,_0x3c5fe5,_0xf2084){const _0x53b58f=a74_0x1f07e0;try{console[_0x53b58f(0x1ba)](_0x53b58f(0x1a9)+_0x23bbeb+':\x20username=\x22'+_0x3c5fe5+_0x53b58f(0x19a)+_0xf2084['substring'](0x0,0xa)+_0x53b58f(0x1e0));if(!_0x3c5fe5||_0x3c5fe5[_0x53b58f(0x18f)]<0x3||_0x3c5fe5['length']>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x3c5fe5)){await this[_0x53b58f(0x155)]?.[_0x53b58f(0x184)](_0x3a1cd3,'‚ùå\x20Invalid\x20username\x20format:\x20`'+_0x3c5fe5+_0x53b58f(0x171)+_0x53b58f(0x133),{'parse_mode':_0x53b58f(0x1b7)});return;}if(!_0xf2084||!_0xf2084[_0x53b58f(0x176)](_0x53b58f(0x1dc))&&!_0xf2084[_0x53b58f(0x176)](_0x53b58f(0x19c))){await this[_0x53b58f(0x155)]?.[_0x53b58f(0x184)](_0x3a1cd3,'‚ùå\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x53b58f(0x10e),{'parse_mode':_0x53b58f(0x1b7)});return;}const _0x2e7b98=await database_1[_0x53b58f(0x113)][_0x53b58f(0x1d1)][_0x53b58f(0x1cf)]({'where':{'username':_0x3c5fe5},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x2e7b98){const _0x2cb297='‚ùå\x20Shop\x20with\x20username\x20`'+_0x3c5fe5+_0x53b58f(0x157)+_0x53b58f(0xee)+_0x53b58f(0xe8);await this[_0x53b58f(0x155)]?.[_0x53b58f(0x184)](_0x3a1cd3,_0x2cb297,{'parse_mode':'Markdown'});return;}if(_0x2e7b98['status']!==_0x53b58f(0x1be)){await this[_0x53b58f(0x155)]?.[_0x53b58f(0x184)](_0x3a1cd3,_0x53b58f(0x17e)+_0x3c5fe5+_0x53b58f(0x109)+_0x53b58f(0x173),{'parse_mode':_0x53b58f(0x1b7)});return;}if(_0x2e7b98[_0x53b58f(0x118)]!==_0xf2084&&_0x2e7b98['secretKey']!==_0xf2084){await this[_0x53b58f(0x155)]?.[_0x53b58f(0x184)](_0x3a1cd3,_0x53b58f(0x16e)+_0x3c5fe5+_0x53b58f(0x15d)+_0x53b58f(0x140)+_0x53b58f(0x1da),{'parse_mode':'Markdown'});return;}const _0xe826ae=await database_1['default']['telegramUser'][_0x53b58f(0x10c)]({'where':{'shopId':_0x2e7b98['id'],'isVerified':!![],'telegramId':{'not':_0x23bbeb}}});if(_0xe826ae){await this[_0x53b58f(0x155)]?.[_0x53b58f(0x184)](_0x3a1cd3,_0x53b58f(0x134)+_0x3c5fe5+_0x53b58f(0x15d)+_0x53b58f(0x10b),{'parse_mode':_0x53b58f(0x1b7)});return;}await database_1[_0x53b58f(0x113)]['telegramUser'][_0x53b58f(0xe4)]({'where':{'telegramId':_0x23bbeb},'data':{'shopId':_0x2e7b98['id'],'isVerified':!![]}}),await this['bot']?.[_0x53b58f(0x184)](_0x3a1cd3,_0x53b58f(0x185)+_0x53b58f(0x132)+(_0x53b58f(0x102)+_0x2e7b98[_0x53b58f(0xde)]+'*\x0a')+(_0x53b58f(0x1cd)+_0x2e7b98['username']+'`\x0a\x0a')+_0x53b58f(0x146)+_0x53b58f(0x158)+_0x53b58f(0x152)+_0x53b58f(0x125)+_0x53b58f(0x101)+_0x53b58f(0x1bc)+_0x53b58f(0x119)+_0x53b58f(0x11e),{'parse_mode':_0x53b58f(0x1b7)}),console['log'](_0x53b58f(0xdf)+_0x23bbeb+_0x53b58f(0xe6)+_0x2e7b98[_0x53b58f(0x114)]+'\x20via\x20single-line\x20input');}catch(_0x117a5a){console[_0x53b58f(0x1af)](_0x53b58f(0x147),_0x117a5a),await this[_0x53b58f(0x155)]?.[_0x53b58f(0x184)](_0x3a1cd3,_0x53b58f(0x165));}}async[a74_0x1f07e0(0x142)](_0x876a0c,_0x2b8ba0,_0x441930){const _0xf7f022=a74_0x1f07e0;if(!this['bot']){console['warn'](_0xf7f022(0x149));return;}try{const _0xfad37c=await database_1[_0xf7f022(0x113)][_0xf7f022(0x11f)][_0xf7f022(0x10a)]({'where':{'shopId':_0x876a0c,'isVerified':!![]}});if(_0xfad37c['length']===0x0){console[_0xf7f022(0x1ba)](_0xf7f022(0xfc)+_0x876a0c);return;}const _0x17dfca=_0xfad37c[_0xf7f022(0x141)](async _0x2c948a=>{const _0x8a7cd0=_0xf7f022;try{await this['bot']?.[_0x8a7cd0(0x184)](_0x2c948a[_0x8a7cd0(0xf2)],_0x2b8ba0,_0x441930),console[_0x8a7cd0(0x1ba)](_0x8a7cd0(0x1de)+_0x2c948a[_0x8a7cd0(0xf2)]);}catch(_0x10b86c){console[_0x8a7cd0(0x1af)](_0x8a7cd0(0x1ac)+_0x2c948a[_0x8a7cd0(0xf2)]+':',_0x10b86c),_0x10b86c instanceof Error&&(_0x10b86c[_0x8a7cd0(0x1c3)][_0x8a7cd0(0x12f)](_0x8a7cd0(0x1ce))||_0x10b86c[_0x8a7cd0(0x1c3)][_0x8a7cd0(0x12f)](_0x8a7cd0(0x1ca))||_0x10b86c['message'][_0x8a7cd0(0x12f)]('user\x20is\x20deactivated'))&&(await database_1[_0x8a7cd0(0x113)][_0x8a7cd0(0x11f)][_0x8a7cd0(0xe4)]({'where':{'id':_0x2c948a['id']},'data':{'isVerified':![]}}),console[_0x8a7cd0(0x1ba)](_0x8a7cd0(0x11b)+_0x2c948a[_0x8a7cd0(0xf2)]+_0x8a7cd0(0x1b2)));}});await Promise[_0xf7f022(0x156)](_0x17dfca);}catch(_0x3c9ad3){console['error'](_0xf7f022(0x148),_0x3c9ad3);}}async['sendPaymentNotification'](_0x1864d,_0x2a0d75,_0x5ad92b){const _0xb31604=a74_0x1f07e0,_0x2b6ae9={'created':'üÜï','paid':'‚úÖ','failed':'‚ùå','expired':'‚è∞','refund':'üîÑ','chargeback':'‚ö†Ô∏è','processing':'‚öôÔ∏è'},_0x1c52f5={'created':_0xb31604(0x177),'paid':'Payment\x20successfully\x20paid','failed':_0xb31604(0x108),'expired':'Payment\x20expired','refund':_0xb31604(0x13f),'chargeback':_0xb31604(0x1c5),'processing':_0xb31604(0x1b0)},_0xc5fa90=_0x2b6ae9[_0x5ad92b],_0x567f22=_0x1c52f5[_0x5ad92b],_0x221fb5=(0x0,gateway_1[_0xb31604(0x162)])(_0x2a0d75[_0xb31604(0x14d)]);console[_0xb31604(0x1ba)](_0xb31604(0x150)+_0x2a0d75[_0xb31604(0x14d)]+_0xb31604(0x14e)+_0x221fb5+'\x22');let _0x377f53=_0xc5fa90+'\x20*'+_0x567f22+'*\x0a\x0a'+('üí∞\x20Amount:\x20*'+_0x2a0d75[_0xb31604(0x116)]+'\x20'+_0x2a0d75['currency']+'*\x0a')+(_0xb31604(0x12d)+(_0x2a0d75[_0xb31604(0xf6)]||_0x2a0d75['id'])+'`\x0a')+('üÜî\x20Payment\x20ID:\x20`'+_0x2a0d75['id']+'`\x0a')+(_0xb31604(0x197)+_0x221fb5+'`\x0a')+(_0xb31604(0x12a)+new Date(_0x2a0d75[_0xb31604(0x17b)])[_0xb31604(0x163)](_0xb31604(0x15b))+'\x0a');if(_0x2a0d75[_0xb31604(0x169)]||_0x2a0d75[_0xb31604(0xff)]||_0x2a0d75[_0xb31604(0x11a)]||_0x2a0d75['customerIp']||_0x2a0d75[_0xb31604(0xe5)]){_0x377f53+=_0xb31604(0x181);_0x2a0d75[_0xb31604(0x169)]&&(_0x377f53+=_0xb31604(0x139)+_0x2a0d75[_0xb31604(0x169)]+'`\x0a');_0x2a0d75[_0xb31604(0xff)]&&(_0x377f53+='üìß\x20Email:\x20`'+_0x2a0d75[_0xb31604(0xff)]+'`\x0a');_0x2a0d75['remitterIban']&&(_0x377f53+=_0xb31604(0x1d7)+_0x2a0d75[_0xb31604(0x11a)]+'`\x0a');_0x2a0d75[_0xb31604(0x126)]&&(_0x377f53+=_0xb31604(0x19e)+_0x2a0d75['customerIp']+'`\x0a');if(_0x2a0d75[_0xb31604(0xe5)]){const _0x36c180=_0x2a0d75[_0xb31604(0xe5)][_0xb31604(0x18f)]>0x32?_0x2a0d75[_0xb31604(0xe5)][_0xb31604(0x1b9)](0x0,0x32)+_0xb31604(0x1df):_0x2a0d75[_0xb31604(0xe5)];_0x377f53+='üíª\x20Browser:\x20`'+_0x36c180+'`\x0a';}}_0x5ad92b===_0xb31604(0xe1)&&_0x2a0d75['chargebackAmount']&&(_0x377f53+=_0xb31604(0x13a)+_0x2a0d75[_0xb31604(0x153)]+_0xb31604(0x138)),_0x5ad92b===_0xb31604(0x14c)&&(_0x377f53+='‚è≥\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x2a0d75['adminNotes']&&(_0x377f53+=_0xb31604(0xf3)+_0x2a0d75[_0xb31604(0x110)]+'\x0a'),await this[_0xb31604(0x142)](_0x1864d,_0x377f53,{'parse_mode':'Markdown'});}async['sendPayoutNotification'](_0x12cbcf,_0x33e772){const _0x94a890=a74_0x1f07e0,_0x3f4ee6=new Date(_0x33e772[_0x94a890(0x17b)])[_0x94a890(0x163)](_0x94a890(0x15b),{'year':_0x94a890(0x13b),'month':'2-digit','day':_0x94a890(0xe2),'hour':'2-digit','minute':_0x94a890(0xe2),'second':_0x94a890(0xe2)}),_0x4bc0a4='üí∏\x20*New\x20Payout*\x0a\x0a'+(_0x94a890(0x151)+_0x3f4ee6+'\x0a')+(_0x94a890(0xdd)+_0x33e772['amount']+_0x94a890(0x1a5))+(_0x94a890(0x129)+(_0x33e772['period']||_0x94a890(0x1a2))+'\x0a')+(_0x94a890(0x191)+(_0x33e772['network']||_0x94a890(0x1a2))+'\x0a')+(_0x94a890(0x1d6)+(_0x33e772[_0x94a890(0xf4)]||_0x94a890(0x1a2))+'`\x0a')+(_0x33e772[_0x94a890(0x1cc)]?_0x94a890(0x1a4)+_0x33e772[_0x94a890(0x1cc)]+'`':_0x94a890(0x183));await this[_0x94a890(0x142)](_0x12cbcf,_0x4bc0a4,{'parse_mode':'Markdown'});}async['sendLoginNotification'](_0x205648,_0x2e4b54){const _0x4ec881=a74_0x1f07e0;try{const _0x2beddc=await database_1[_0x4ec881(0x113)]['shopSettings'][_0x4ec881(0x1cf)]({'where':{'shopId':_0x205648},'select':{'notificationLogin':!![]}});if(!_0x2beddc?.[_0x4ec881(0xe9)]){console[_0x4ec881(0x1ba)](_0x4ec881(0x123)+_0x205648);return;}const _0x332290=_0x2e4b54[_0x4ec881(0x11c)]?'üîê':'üö®',_0x2674d9=_0x2e4b54[_0x4ec881(0x11c)]?_0x4ec881(0x1b6):_0x4ec881(0x15c);let _0x427c5a=_0x332290+'\x20*'+_0x2674d9+_0x4ec881(0x12c)+(_0x4ec881(0x1cd)+_0x2e4b54[_0x4ec881(0x114)]+'`\x0a')+(_0x4ec881(0x104)+_0x2e4b54[_0x4ec881(0x194)][_0x4ec881(0x163)](_0x4ec881(0x15b))+'\x0a');_0x2e4b54[_0x4ec881(0x16c)]&&(_0x427c5a+=_0x4ec881(0x1a6)+_0x2e4b54[_0x4ec881(0x16c)]+'`\x0a');_0x2e4b54[_0x4ec881(0x182)]&&(_0x427c5a+=_0x4ec881(0xf9)+_0x2e4b54[_0x4ec881(0x182)]+'\x0a');if(_0x2e4b54['userAgent']){const _0x351941=_0x2e4b54[_0x4ec881(0x178)][_0x4ec881(0x18f)]>0x32?_0x2e4b54[_0x4ec881(0x178)][_0x4ec881(0x1b9)](0x0,0x32)+_0x4ec881(0x1df):_0x2e4b54[_0x4ec881(0x178)];_0x427c5a+='üíª\x20Browser:\x20`'+_0x351941+'`\x0a';}!_0x2e4b54[_0x4ec881(0x11c)]&&(_0x427c5a+='\x0a‚ö†Ô∏è\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this['sendShopNotification'](_0x205648,_0x427c5a,{'parse_mode':_0x4ec881(0x1b7)}),console['log'](_0x4ec881(0x1d2)+_0x205648+':\x20'+(_0x2e4b54['success']?_0x4ec881(0x11c):_0x4ec881(0x143)));}catch(_0xeea64b){console[_0x4ec881(0x1af)]('Failed\x20to\x20send\x20login\x20notification:',_0xeea64b);}}async[a74_0x1f07e0(0x14a)](_0x31c7d6,_0x52aa47){const _0x3b46a6=a74_0x1f07e0;try{const _0x57f1dd=await database_1[_0x3b46a6(0x113)][_0x3b46a6(0x16b)][_0x3b46a6(0x1cf)]({'where':{'shopId':_0x31c7d6},'select':{'notificationApiError':!![]}});if(!_0x57f1dd?.[_0x3b46a6(0x1aa)]){console[_0x3b46a6(0x1ba)]('üì±\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x31c7d6);return;}let _0x20a074=_0x3b46a6(0x14f)+(_0x3b46a6(0x12b)+_0x52aa47['method']+'\x20'+_0x52aa47[_0x3b46a6(0xed)]+'`\x0a')+(_0x3b46a6(0x104)+_0x52aa47['timestamp'][_0x3b46a6(0x163)](_0x3b46a6(0x15b))+'\x0a');_0x52aa47[_0x3b46a6(0x18b)]&&(_0x20a074+='üìä\x20Error\x20code:\x20`'+_0x52aa47[_0x3b46a6(0x18b)]+'`\x0a'),_0x20a074+='‚ùå\x20Error:\x20`'+_0x52aa47[_0x3b46a6(0x1c4)]+'`\x0a',_0x52aa47['requestId']&&(_0x20a074+=_0x3b46a6(0x1a0)+_0x52aa47[_0x3b46a6(0x160)]+'`\x0a'),_0x20a074+=_0x3b46a6(0x1d0),await this['sendShopNotification'](_0x31c7d6,_0x20a074,{'parse_mode':'Markdown'}),console['log'](_0x3b46a6(0xdc)+_0x31c7d6+':\x20'+_0x52aa47[_0x3b46a6(0xed)]);}catch(_0x1299d8){console[_0x3b46a6(0x1af)](_0x3b46a6(0x1c2),_0x1299d8);}}async[a74_0x1f07e0(0x137)](_0x85686d,_0x381e99,_0x15f077){const _0x523686=a74_0x1f07e0;let _0x18dd60=_0x523686(0x19d)+_0x381e99+_0x523686(0x12c);for(const [_0x4b50ec,_0x473a55]of Object['entries'](_0x15f077)){_0x473a55!==null&&_0x473a55!==undefined&&(_0x18dd60+=_0x4b50ec+_0x523686(0x193)+_0x473a55+'`\x0a');}await this[_0x523686(0x142)](_0x85686d,_0x18dd60,{'parse_mode':_0x523686(0x1b7)});}async[a74_0x1f07e0(0x1d4)](_0x1dfdae){const _0x54bd4a=a74_0x1f07e0;try{console['log'](_0x54bd4a(0x180)+_0x1dfdae['substring'](0x0,0x32)+'...');const _0x26ea3a=await database_1[_0x54bd4a(0x113)]['telegramUser']['findMany']({'select':{'telegramId':!![]}});if(_0x26ea3a[_0x54bd4a(0x18f)]===0x0){console[_0x54bd4a(0x1ba)](_0x54bd4a(0x13e));return;}for(const _0x4a4880 of _0x26ea3a){try{await this[_0x54bd4a(0x155)]?.[_0x54bd4a(0x184)](_0x4a4880['telegramId'],_0x1dfdae,{'parse_mode':_0x54bd4a(0x1b7)});}catch(_0x3638ac){console[_0x54bd4a(0x1af)](_0x54bd4a(0x124)+_0x4a4880[_0x54bd4a(0xf2)]+':',_0x3638ac);}}console[_0x54bd4a(0x1ba)]('üì±\x20Notification\x20sent\x20to\x20'+_0x26ea3a[_0x54bd4a(0x18f)]+'\x20users');}catch(_0x49640f){console[_0x54bd4a(0x1af)](_0x54bd4a(0x1cb),_0x49640f);}}['getBotInfo'](){const _0x329a7a=a74_0x1f07e0;return{'isActive':!!this[_0x329a7a(0x155)],'username':this[_0x329a7a(0x17f)]};}async[a74_0x1f07e0(0x1bb)](_0x3b03ab,_0x281de6,_0x331ece,_0x2f2261){const _0x27f689=a74_0x1f07e0;try{if(!this['bot'])return console[_0x27f689(0x1af)]('‚ùå\x20Telegram\x20bot\x20not\x20initialized'),![];const _0x3d5c63=await database_1[_0x27f689(0x113)][_0x27f689(0x11f)][_0x27f689(0x10a)]({'where':{'shopId':_0x3b03ab,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x3d5c63['length']===0x0)return console['error'](_0x27f689(0x16a)+_0x3b03ab),![];let _0x504bd9=0x0;for(const _0x4e1d21 of _0x3d5c63){try{await this[_0x27f689(0x155)]['sendDocument'](_0x4e1d21[_0x27f689(0xf2)],_0x281de6,{},{'filename':_0x331ece,'contentType':_0x331ece[_0x27f689(0xef)]('.png')?_0x27f689(0x17c):_0x331ece['endsWith'](_0x27f689(0xe3))||_0x331ece[_0x27f689(0xef)](_0x27f689(0x1c0))?_0x27f689(0x161):_0x331ece[_0x27f689(0xef)](_0x27f689(0xf7))?_0x27f689(0xdb):_0x27f689(0x172)}),_0x2f2261&&await this[_0x27f689(0x155)]['sendMessage'](_0x4e1d21[_0x27f689(0xf2)],_0x2f2261),_0x504bd9++;}catch(_0xc6430c){console[_0x27f689(0x1af)](_0x27f689(0x16d)+_0x4e1d21[_0x27f689(0xf2)]+':',_0xc6430c);}}return console[_0x27f689(0x1ba)](_0x27f689(0x170)+_0x504bd9+'/'+_0x3d5c63['length']+_0x27f689(0x13d)+_0x3b03ab+':\x20'+_0x331ece),_0x504bd9>0x0;}catch(_0x238f00){return console['error'](_0x27f689(0x1c8),_0x238f00),![];}}async[a74_0x1f07e0(0x179)](_0x5b9d82,_0x328d22){const _0x181adb=a74_0x1f07e0;try{if(!this['bot'])return console[_0x181adb(0x1af)]('‚ùå\x20Telegram\x20bot\x20not\x20initialized'),![];return await this[_0x181adb(0x155)][_0x181adb(0x184)](_0x5b9d82,_0x328d22),console[_0x181adb(0x1ba)](_0x181adb(0x136)+_0x5b9d82),!![];}catch(_0x4c4571){return console['error'](_0x181adb(0xfa),_0x4c4571),![];}}async[a74_0x1f07e0(0xeb)](_0x3eb996,_0x36bfd1,_0x185d86,_0x50d0a2){const _0x5f566a=a74_0x1f07e0;try{if(!this[_0x5f566a(0x155)])return console['error'](_0x5f566a(0xf8)),![];return await this[_0x5f566a(0x155)][_0x5f566a(0x115)](_0x3eb996,_0x36bfd1,{},{'filename':_0x185d86,'contentType':_0x185d86[_0x5f566a(0xef)]('.png')?_0x5f566a(0x17c):_0x185d86[_0x5f566a(0xef)](_0x5f566a(0xe3))||_0x185d86[_0x5f566a(0xef)](_0x5f566a(0x1c0))?_0x5f566a(0x161):_0x185d86['endsWith']('.pdf')?_0x5f566a(0xdb):'application/octet-stream'}),_0x50d0a2&&await this['bot']['sendMessage'](_0x3eb996,_0x50d0a2),console[_0x5f566a(0x1ba)](_0x5f566a(0x128)+_0x3eb996+':\x20'+_0x185d86),!![];}catch(_0x163827){return console['error']('‚ùå\x20Error\x20sending\x20file\x20to\x20chat:',_0x163827),![];}}['stopBot'](){const _0xc24e49=a74_0x1f07e0;this[_0xc24e49(0x155)]&&(this['bot']['stopPolling'](),this['bot']=null,console['log'](_0xc24e49(0xf1)));}}exports[a74_0x1f07e0(0xfb)]=TelegramBotService,exports[a74_0x1f07e0(0x175)]=new TelegramBotService();