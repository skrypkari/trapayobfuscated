'use strict';const a57_0x2dd368=a57_0x2f03;(function(_0x11b127,_0xc83fe9){const _0x129541=a57_0x2f03,_0x1cbd3a=_0x11b127();while(!![]){try{const _0x3bc249=-parseInt(_0x129541(0xc3))/0x1*(-parseInt(_0x129541(0x14a))/0x2)+-parseInt(_0x129541(0xc8))/0x3+parseInt(_0x129541(0x87))/0x4+parseInt(_0x129541(0xbd))/0x5*(-parseInt(_0x129541(0xbb))/0x6)+parseInt(_0x129541(0xae))/0x7*(parseInt(_0x129541(0x138))/0x8)+parseInt(_0x129541(0xa5))/0x9*(-parseInt(_0x129541(0x7a))/0xa)+parseInt(_0x129541(0xb9))/0xb;if(_0x3bc249===_0xc83fe9)break;else _0x1cbd3a['push'](_0x1cbd3a['shift']());}catch(_0x5396f5){_0x1cbd3a['push'](_0x1cbd3a['shift']());}}}(a57_0x3076,0xc8b43));function a57_0x2f03(_0x3f24aa,_0x4333d5){const _0x307617=a57_0x3076();return a57_0x2f03=function(_0x2f0399,_0x540dc1){_0x2f0399=_0x2f0399-0x73;let _0x41df40=_0x307617[_0x2f0399];return _0x41df40;},a57_0x2f03(_0x3f24aa,_0x4333d5);}var __importDefault=this&&this[a57_0x2dd368(0xb2)]||function(_0x3b3364){const _0x692a9b=a57_0x2dd368;return _0x3b3364&&_0x3b3364[_0x692a9b(0xff)]?_0x3b3364:{'default':_0x3b3364};};function a57_0x3076(){const _0x5da3c1=['isVerified','New\x20payout\x20created','📅\x20Time:\x20','adminNotes','Example:\x0a','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','log','botUsername','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','create','\x20via\x20single-line\x20input','includes','✅\x20Welcome\x20back!\x0a\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','🔗\x20TXID:\x20`','toLocaleString','user\x20is\x20deactivated','621AFRxkt','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','New\x20payment\x20created','name','TELEGRAM_BOT_USERNAME','chat','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','sk_','7SmAlha','❌\x20Error\x20getting\x20debug\x20information.','setupBotHandlers','text','__importDefault','default','error','🔔\x20Notifications\x20are\x20active\x0a\x0a','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','node-telegram-bot-api','\x20parts:\x20','25757820MbvhYc','...`\x0a\x0a','19086zOuJJc','🏦\x20IBAN:\x20`','1355ILsQXa','Check\x20spelling\x20and\x20try\x20again.','updatedAt','🆔\x20Payout\x20ID:\x20`','🆔\x20Request\x20ID:\x20`','📛\x20Name:\x20`','4741GPlLoe','🌐\x20IP\x20address:\x20`','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','forEach','shopSettings','4253868icnnEt','📊\x20*Connection\x20Status*\x0a\x0a','•\x20Payment\x20status\x20changes\x0a','🔌\x20User\x20','initializeBot','Use\x20/start\x20to\x20connect.','findUnique','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','getGatewayDisplayNameForTelegram','🏪\x20Available\x20shops\x20in\x20system:\x0a','❌\x20Shop\x20`','Failed\x20to\x20send\x20login\x20notification:','\x0a👤\x20*Customer\x20Information:*\x0a','❌\x20Shop\x20with\x20username\x20`','status','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','telegramBotService','notificationLogin','💸\x20Penalty\x20amount:\x20*','`\x0a\x0a','method','bot','message','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','User\x20','findMany','remitterIban','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Payment\x20refund','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','To\x20reconnect,\x20use\x20the\x20/start\x20command','📱\x20Shop:\x20*','Commands:\x0a','Payment\x20is\x20being\x20processed','trapay_bot','*\x0a\x0a','You\x20sent\x20','toString','chargebackAmount','💰\x20Amount:\x20*','userAgent','gateway','🎉\x20*Congratulations!*\x0a\x0a','chargeback','\x20verified\x20for\x20shop\x20','Markdown','📧\x20Email:\x20`','update','customerEmail','first_name','../config/database','✅\x20Connected\x20to\x20shop:\x20*','\x22,\x20apiKey=\x22','timestamp','unknown\x20shop','__esModule','handleSingleLineVerification','endpoint','🆔\x20Payment\x20ID:\x20`','onText','Payout\x20completed','sendShopNotification','🔔\x20*','from','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','txid','shop','test','\x20(@','polling_error','\x22\x20->\x20display\x20\x22','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','publicKey','🌐\x20IP:\x20`','`\x20is\x20inactive.\x0a\x0a','Telegram\x20bot\x20polling\x20error:','Payment\x20successfully\x20paid','📱\x20Your\x20Telegram\x20ID:\x20`','startsWith','chat\x20not\x20found','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','botToken','secretKey','notificationApiError','map','Error\x20sending\x20shop\x20notification:','🏦\x20Method:\x20`','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','`.\x0a\x0a','•\x20Important\x20events\x0a\x0a','❌\x20Invalid\x20username\x20format:\x20`','`\x20not\x20found.\x0a\x0a','en-US','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','currency','createdAt','ipAddress','🔍\x20*Debug\x20Information*\x0a\x0a','•\x20Payouts\x0a\x0a','telegramId','stopPolling','customerUa','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','success','Contact\x20administrator.','pk_','👤\x20Username:\x20`','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','\x20\x20\x20Username:\x20`','username','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','6273256sHlLYE','...\x22','failed','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','\x20\x20\x20Public\x20Key:\x20`','...','Telegram\x20bot\x20error:','Payment\x20failed','TELEGRAM_BOT_TOKEN','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','.\x20*','customerName','❌\x20Please\x20use\x20/start\x20command\x20first','Error\x20in\x20handleSingleLineVerification:','../types/gateway','env','getBotInfo','Payment\x20chargeback','394WwISSV','telegramUser','errorMessage','requestId','amount','sendMessage','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','\x20disconnected\x20from\x20shop\x20','`\x20(','shopId','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','toLocaleDateString','💻\x20Browser:\x20`','substring','statusCode','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','/disconnect\x20-\x20disconnect\x20from\x20notifications','221170HzdWMU','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','Failed\x20login\x20attempt','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','✅\x20Telegram\x20bot\x20@','Error\x20handling\x20/start\x20command:',':\x20username=\x22','🚨\x20*API\x20Error*\x0a\x0a','✅\x20Telegram\x20user\x20','defineProperty','Payout\x20rejected','2273636ZvozcC','last_name','Error\x20handling\x20/debug\x20command:','*.\x0a\x0a','customerIp','split','warn','/status\x20-\x20check\x20connection\x20status\x0a','🔗\x20Endpoint:\x20`','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','length','ACTIVE','sendPayoutNotification'];a57_0x3076=function(){return _0x5da3c1;};return a57_0x3076();}Object[a57_0x2dd368(0x85)](exports,a57_0x2dd368(0xff),{'value':!![]}),exports[a57_0x2dd368(0xd8)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a57_0x2dd368(0xb7))),database_1=__importDefault(require(a57_0x2dd368(0xfa))),gateway_1=require(a57_0x2dd368(0x146));class TelegramBotService{constructor(){const _0x2f45a0=a57_0x2dd368;this['bot']=null,this[_0x2f45a0(0x119)]=process[_0x2f45a0(0x147)][_0x2f45a0(0x140)]||'',this[_0x2f45a0(0x9b)]=process['env'][_0x2f45a0(0xa9)]||_0x2f45a0(0xea),this[_0x2f45a0(0x119)]?this[_0x2f45a0(0xcc)]():console[_0x2f45a0(0x8d)](_0x2f45a0(0x108));}[a57_0x2dd368(0xcc)](){const _0x452584=a57_0x2dd368;try{this[_0x452584(0xdd)]=new node_telegram_bot_api_1[(_0x452584(0xb3))](this['botToken'],{'polling':!![]}),this[_0x452584(0xb0)](),console[_0x452584(0x9a)](_0x452584(0x80)+this['botUsername']+'\x20initialized\x20successfully');}catch(_0x1a21a3){console['error'](_0x452584(0x11f),_0x1a21a3);}}[a57_0x2dd368(0xb0)](){const _0x1b5b0a=a57_0x2dd368;if(!this[_0x1b5b0a(0xdd)])return;this[_0x1b5b0a(0xdd)][_0x1b5b0a(0x103)](/\/start/,async _0x337a25=>{const _0x2faafb=_0x1b5b0a,_0x262a24=_0x337a25[_0x2faafb(0xaa)]['id'],_0x4c0102=_0x337a25['from']?.['id'][_0x2faafb(0xed)](),_0x424a5c=_0x337a25['from']?.[_0x2faafb(0x136)],_0x4d7e60=_0x337a25[_0x2faafb(0x107)]?.[_0x2faafb(0xf9)],_0x821748=_0x337a25[_0x2faafb(0x107)]?.[_0x2faafb(0x88)];if(!_0x4c0102)return;try{let _0x25284d=await database_1[_0x2faafb(0xb3)][_0x2faafb(0x14b)][_0x2faafb(0xce)]({'where':{'telegramId':_0x4c0102},'include':{'shop':!![]}});!_0x25284d?(_0x25284d=await database_1['default'][_0x2faafb(0x14b)][_0x2faafb(0x9d)]({'data':{'telegramId':_0x4c0102,'username':_0x424a5c,'firstName':_0x4d7e60,'lastName':_0x821748,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x2faafb(0x9a)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x4c0102+_0x2faafb(0x10c)+_0x424a5c+')')):_0x25284d=await database_1[_0x2faafb(0xb3)][_0x2faafb(0x14b)][_0x2faafb(0xf7)]({'where':{'telegramId':_0x4c0102},'data':{'username':_0x424a5c,'firstName':_0x4d7e60,'lastName':_0x821748},'include':{'shop':!![]}}),_0x25284d[_0x2faafb(0x94)]&&_0x25284d[_0x2faafb(0x153)]&&_0x25284d[_0x2faafb(0x10a)]?await this['bot']?.[_0x2faafb(0x14f)](_0x262a24,_0x2faafb(0xa0)+(_0x2faafb(0x7c)+_0x25284d[_0x2faafb(0x10a)]['name']+'*\x0a')+('Username:\x20`'+_0x25284d['shop'][_0x2faafb(0x136)]+_0x2faafb(0xdb))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x2faafb(0xca)+_0x2faafb(0x12b)+_0x2faafb(0xe8)+_0x2faafb(0x8e)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x2faafb(0xf5)}):(_0x25284d[_0x2faafb(0x153)]&&!_0x25284d['isVerified']&&(await database_1[_0x2faafb(0xb3)][_0x2faafb(0x14b)][_0x2faafb(0xf7)]({'where':{'telegramId':_0x4c0102},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x2faafb(0xab)+_0x4c0102)),await this[_0x2faafb(0xdd)]?.['sendMessage'](_0x262a24,_0x2faafb(0x118)+_0x2faafb(0xcf)+_0x2faafb(0xe3)+_0x2faafb(0x98)+_0x2faafb(0xdf)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x2faafb(0xf5)}));}catch(_0x1b6c46){console[_0x2faafb(0xb4)](_0x2faafb(0x81),_0x1b6c46),await this['bot']?.[_0x2faafb(0x14f)](_0x262a24,_0x2faafb(0x90));}}),this['bot']['onText'](/\/disconnect/,async _0x49f191=>{const _0x28e5d5=_0x1b5b0a,_0x286739=_0x49f191['chat']['id'],_0x237d94=_0x49f191[_0x28e5d5(0x107)]?.['id'][_0x28e5d5(0xed)]();if(!_0x237d94)return;try{const _0x5847f4=await database_1[_0x28e5d5(0xb3)]['telegramUser'][_0x28e5d5(0xce)]({'where':{'telegramId':_0x237d94},'include':{'shop':!![]}});if(!_0x5847f4||!_0x5847f4[_0x28e5d5(0x94)]||!_0x5847f4[_0x28e5d5(0x153)]){await this[_0x28e5d5(0xdd)]?.['sendMessage'](_0x286739,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x375cd8=_0x5847f4['shop']?.[_0x28e5d5(0xa8)]||_0x28e5d5(0xfe);await database_1[_0x28e5d5(0xb3)][_0x28e5d5(0x14b)][_0x28e5d5(0xf7)]({'where':{'telegramId':_0x237d94},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x28e5d5(0xcb)+_0x237d94+_0x28e5d5(0x151)+_0x5847f4[_0x28e5d5(0x153)]),await this['bot']?.[_0x28e5d5(0x14f)](_0x286739,_0x28e5d5(0x7d)+_0x375cd8+_0x28e5d5(0x8a)+_0x28e5d5(0xe6),{'parse_mode':_0x28e5d5(0xf5)});}catch(_0x519c57){console[_0x28e5d5(0xb4)]('Error\x20handling\x20/disconnect\x20command:',_0x519c57),await this[_0x28e5d5(0xdd)]?.[_0x28e5d5(0x14f)](_0x286739,_0x28e5d5(0x90));}}),this[_0x1b5b0a(0xdd)][_0x1b5b0a(0x103)](/\/status/,async _0x4e95f8=>{const _0xed4357=_0x1b5b0a,_0x5a3563=_0x4e95f8[_0xed4357(0xaa)]['id'],_0x1edad7=_0x4e95f8[_0xed4357(0x107)]?.['id'][_0xed4357(0xed)]();if(!_0x1edad7)return;try{const _0x304b9c=await database_1[_0xed4357(0xb3)][_0xed4357(0x14b)][_0xed4357(0xce)]({'where':{'telegramId':_0x1edad7},'include':{'shop':!![]}});if(!_0x304b9c){await this[_0xed4357(0xdd)]?.[_0xed4357(0x14f)](_0x5a3563,_0xed4357(0x10f)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x304b9c['isVerified']||!_0x304b9c[_0xed4357(0x153)]||!_0x304b9c['shop']){await this[_0xed4357(0xdd)]?.[_0xed4357(0x14f)](_0x5a3563,_0xed4357(0xd7)+_0xed4357(0xcd));return;}await this['bot']?.[_0xed4357(0x14f)](_0x5a3563,_0xed4357(0xc9)+(_0xed4357(0xfb)+_0x304b9c[_0xed4357(0x10a)][_0xed4357(0xa8)]+'*\x0a')+(_0xed4357(0x133)+_0x304b9c['shop'][_0xed4357(0x136)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x304b9c[_0xed4357(0xbf)][_0xed4357(0x74)](_0xed4357(0x125))+'\x0a\x0a')+_0xed4357(0xb5)+_0xed4357(0xe8)+_0xed4357(0x79),{'parse_mode':_0xed4357(0xf5)});}catch(_0x5621dc){console['error']('Error\x20handling\x20/status\x20command:',_0x5621dc),await this[_0xed4357(0xdd)]?.[_0xed4357(0x14f)](_0x5a3563,_0xed4357(0x90));}}),this[_0x1b5b0a(0xdd)][_0x1b5b0a(0x103)](/\/debug/,async _0x4cff26=>{const _0xc0ebbf=_0x1b5b0a,_0x137bc4=_0x4cff26[_0xc0ebbf(0xaa)]['id'],_0x3fcb43=_0x4cff26[_0xc0ebbf(0x107)]?.['id'][_0xc0ebbf(0xed)]();if(!_0x3fcb43)return;try{const _0x4281b4=await database_1['default'][_0xc0ebbf(0x10a)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4df5ea=_0xc0ebbf(0x12a);_0x4df5ea+=_0xc0ebbf(0x115)+_0x3fcb43+'`\x0a\x0a',_0x4df5ea+=_0xc0ebbf(0xd1),_0x4281b4[_0xc0ebbf(0xc6)]((_0x2488cf,_0x169188)=>{const _0x41b546=_0xc0ebbf;_0x4df5ea+=_0x169188+0x1+_0x41b546(0x142)+_0x2488cf[_0x41b546(0xa8)]+'*\x0a',_0x4df5ea+=_0x41b546(0x135)+_0x2488cf['username']+'`\x0a',_0x4df5ea+='\x20\x20\x20Status:\x20'+_0x2488cf['status']+'\x0a',_0x4df5ea+=_0x41b546(0x13c)+_0x2488cf[_0x41b546(0x110)][_0x41b546(0x76)](0x0,0xf)+_0x41b546(0xba);}),await this[_0xc0ebbf(0xdd)]?.['sendMessage'](_0x137bc4,_0x4df5ea,{'parse_mode':_0xc0ebbf(0xf5)});}catch(_0x31fd56){console['error'](_0xc0ebbf(0x89),_0x31fd56),await this[_0xc0ebbf(0xdd)]?.[_0xc0ebbf(0x14f)](_0x137bc4,_0xc0ebbf(0xaf));}}),this[_0x1b5b0a(0xdd)]['on'](_0x1b5b0a(0xde),async _0x4da92c=>{const _0xa6d57a=_0x1b5b0a;if(_0x4da92c[_0xa6d57a(0xb1)]?.[_0xa6d57a(0x116)]('/'))return;const _0x2deb4a=_0x4da92c['chat']['id'],_0x459ac6=_0x4da92c[_0xa6d57a(0x107)]?.['id']['toString'](),_0x2a16f9=_0x4da92c[_0xa6d57a(0xb1)]?.['trim']();if(!_0x459ac6||!_0x2a16f9)return;try{const _0x2b67b6=await database_1['default'][_0xa6d57a(0x14b)]['findUnique']({'where':{'telegramId':_0x459ac6},'include':{'shop':!![]}});if(!_0x2b67b6){await this['bot']?.[_0xa6d57a(0x14f)](_0x2deb4a,_0xa6d57a(0x144));return;}if(_0x2b67b6[_0xa6d57a(0x94)]&&_0x2b67b6[_0xa6d57a(0x153)]&&_0x2b67b6[_0xa6d57a(0x10a)]){await this[_0xa6d57a(0xdd)]?.[_0xa6d57a(0x14f)](_0x2deb4a,_0xa6d57a(0x13b)+_0x2b67b6[_0xa6d57a(0x10a)][_0xa6d57a(0xa8)]+_0xa6d57a(0x8a)+_0xa6d57a(0x7f),{'parse_mode':_0xa6d57a(0xf5)});return;}const _0x28da1a=_0x2a16f9[_0xa6d57a(0x8c)](/\s+/);if(_0x28da1a[_0xa6d57a(0x91)]!==0x2){await this['bot']?.[_0xa6d57a(0x14f)](_0x2deb4a,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0xa6d57a(0xe3)+_0xa6d57a(0x98)+_0xa6d57a(0xdf)+(_0xa6d57a(0xec)+_0x28da1a['length']+_0xa6d57a(0xb8)+_0x28da1a[_0xa6d57a(0x11c)](_0x5355e6=>'`'+_0x5355e6+'`')['join'](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x43a852,_0x11d187]=_0x28da1a;console[_0xa6d57a(0x9a)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x459ac6+_0xa6d57a(0x82)+_0x43a852+'\x22,\x20apiKey=\x22'+_0x11d187[_0xa6d57a(0x76)](0x0,0xa)+'...\x22'),await this['handleSingleLineVerification'](_0x2deb4a,_0x459ac6,_0x43a852,_0x11d187);}catch(_0x5df47c){console[_0xa6d57a(0xb4)]('Error\x20handling\x20message:',_0x5df47c),await this[_0xa6d57a(0xdd)]?.[_0xa6d57a(0x14f)](_0x2deb4a,_0xa6d57a(0x90));}}),this['bot']['on'](_0x1b5b0a(0xb4),_0x502ed9=>{const _0x52ac17=_0x1b5b0a;console[_0x52ac17(0xb4)](_0x52ac17(0x13e),_0x502ed9);}),this[_0x1b5b0a(0xdd)]['on'](_0x1b5b0a(0x10d),_0x5279d2=>{const _0x179393=_0x1b5b0a;console['error'](_0x179393(0x113),_0x5279d2);});}async[a57_0x2dd368(0x100)](_0x2b2882,_0x2fc3a6,_0xa59601,_0x5014ee){const _0xdd9422=a57_0x2dd368;try{console['log'](_0xdd9422(0x137)+_0x2fc3a6+_0xdd9422(0x82)+_0xa59601+_0xdd9422(0xfc)+_0x5014ee[_0xdd9422(0x76)](0x0,0xa)+_0xdd9422(0x139));if(!_0xa59601||_0xa59601[_0xdd9422(0x91)]<0x3||_0xa59601['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0xdd9422(0x10b)](_0xa59601)){await this[_0xdd9422(0xdd)]?.[_0xdd9422(0x14f)](_0x2b2882,_0xdd9422(0x123)+_0xa59601+'`\x0a\x0a'+_0xdd9422(0x12f),{'parse_mode':_0xdd9422(0xf5)});return;}if(!_0x5014ee||!_0x5014ee[_0xdd9422(0x116)](_0xdd9422(0x132))&&!_0x5014ee[_0xdd9422(0x116)](_0xdd9422(0xad))){await this[_0xdd9422(0xdd)]?.[_0xdd9422(0x14f)](_0x2b2882,_0xdd9422(0x99)+_0xdd9422(0x141),{'parse_mode':'Markdown'});return;}const _0x2b9688=await database_1[_0xdd9422(0xb3)]['shop'][_0xdd9422(0xce)]({'where':{'username':_0xa59601},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x2b9688){const _0x56d54d=await database_1[_0xdd9422(0xb3)][_0xdd9422(0x10a)][_0xdd9422(0xe1)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x2a511a=_0xdd9422(0xd5)+_0xa59601+_0xdd9422(0x124);_0x56d54d['length']>0x0?(_0x2a511a+='Available\x20usernames:\x0a',_0x56d54d[_0xdd9422(0xc6)](_0x3facff=>{const _0x183149=_0xdd9422;_0x2a511a+='•\x20`'+_0x3facff[_0x183149(0x136)]+_0x183149(0x152)+_0x3facff[_0x183149(0xa8)]+')\x0a';}),_0x2a511a+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x2a511a+=_0xdd9422(0xbe);await this[_0xdd9422(0xdd)]?.[_0xdd9422(0x14f)](_0x2b2882,_0x2a511a,{'parse_mode':_0xdd9422(0xf5)});return;}if(_0x2b9688[_0xdd9422(0xd6)]!==_0xdd9422(0x92)){await this[_0xdd9422(0xdd)]?.[_0xdd9422(0x14f)](_0x2b2882,_0xdd9422(0xd2)+_0xa59601+_0xdd9422(0x112)+_0xdd9422(0x131),{'parse_mode':_0xdd9422(0xf5)});return;}if(_0x2b9688[_0xdd9422(0x110)]!==_0x5014ee&&_0x2b9688[_0xdd9422(0x11a)]!==_0x5014ee){await this[_0xdd9422(0xdd)]?.[_0xdd9422(0x14f)](_0x2b2882,_0xdd9422(0x120)+_0xa59601+_0xdd9422(0x121)+_0xdd9422(0x78)+_0xdd9422(0x9c),{'parse_mode':'Markdown'});return;}const _0x43ba37=await database_1['default'][_0xdd9422(0x14b)]['findFirst']({'where':{'shopId':_0x2b9688['id'],'isVerified':!![],'telegramId':{'not':_0x2fc3a6}}});if(_0x43ba37){await this[_0xdd9422(0xdd)]?.[_0xdd9422(0x14f)](_0x2b2882,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0xa59601+'`.\x0a\x0a'+_0xdd9422(0x126),{'parse_mode':'Markdown'});return;}await database_1[_0xdd9422(0xb3)]['telegramUser'][_0xdd9422(0xf7)]({'where':{'telegramId':_0x2fc3a6},'data':{'shopId':_0x2b9688['id'],'isVerified':!![]}}),await this[_0xdd9422(0xdd)]?.['sendMessage'](_0x2b2882,_0xdd9422(0xf2)+_0xdd9422(0x150)+(_0xdd9422(0xe7)+_0x2b9688[_0xdd9422(0xa8)]+'*\x0a')+(_0xdd9422(0x133)+_0x2b9688[_0xdd9422(0x136)]+_0xdd9422(0xdb))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0xdd9422(0xca)+'•\x20Payouts\x0a'+_0xdd9422(0x122)+_0xdd9422(0xe8)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0xdd9422(0x79),{'parse_mode':_0xdd9422(0xf5)}),console[_0xdd9422(0x9a)](_0xdd9422(0x84)+_0x2fc3a6+_0xdd9422(0xf4)+_0x2b9688[_0xdd9422(0x136)]+_0xdd9422(0x9e));}catch(_0x2438a0){console['error'](_0xdd9422(0x145),_0x2438a0),await this[_0xdd9422(0xdd)]?.[_0xdd9422(0x14f)](_0x2b2882,_0xdd9422(0xac));}}async['sendShopNotification'](_0x5c1df5,_0x2ed8b5,_0x4d40ab){const _0x50dc8c=a57_0x2dd368;if(!this[_0x50dc8c(0xdd)]){console[_0x50dc8c(0x8d)](_0x50dc8c(0xa6));return;}try{const _0x5bb58f=await database_1[_0x50dc8c(0xb3)]['telegramUser'][_0x50dc8c(0xe1)]({'where':{'shopId':_0x5c1df5,'isVerified':!![]}});if(_0x5bb58f[_0x50dc8c(0x91)]===0x0){console['log'](_0x50dc8c(0xb6)+_0x5c1df5);return;}const _0x3b6f06=_0x5bb58f['map'](async _0x49b1ca=>{const _0x4316b2=_0x50dc8c;try{await this[_0x4316b2(0xdd)]?.[_0x4316b2(0x14f)](_0x49b1ca[_0x4316b2(0x12c)],_0x2ed8b5,_0x4d40ab),console[_0x4316b2(0x9a)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x49b1ca[_0x4316b2(0x12c)]);}catch(_0x547db7){console['error']('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x49b1ca[_0x4316b2(0x12c)]+':',_0x547db7),_0x547db7 instanceof Error&&(_0x547db7[_0x4316b2(0xde)][_0x4316b2(0x9f)]('blocked')||_0x547db7[_0x4316b2(0xde)][_0x4316b2(0x9f)](_0x4316b2(0x117))||_0x547db7[_0x4316b2(0xde)][_0x4316b2(0x9f)](_0x4316b2(0xa4)))&&(await database_1[_0x4316b2(0xb3)]['telegramUser'][_0x4316b2(0xf7)]({'where':{'id':_0x49b1ca['id']},'data':{'isVerified':![]}}),console['log'](_0x4316b2(0xe0)+_0x49b1ca[_0x4316b2(0x12c)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise['allSettled'](_0x3b6f06);}catch(_0x6729f2){console[_0x50dc8c(0xb4)](_0x50dc8c(0x11d),_0x6729f2);}}async['sendPaymentNotification'](_0x454887,_0x453b22,_0x20cfa9){const _0x3bb5de=a57_0x2dd368,_0x497a9c={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x56a838={'created':_0x3bb5de(0xa7),'paid':_0x3bb5de(0x114),'failed':_0x3bb5de(0x13f),'expired':'Payment\x20expired','refund':_0x3bb5de(0xe4),'chargeback':_0x3bb5de(0x149),'processing':_0x3bb5de(0xe9)},_0x484ad7=_0x497a9c[_0x20cfa9],_0x4e995d=_0x56a838[_0x20cfa9],_0x1ec13a=(0x0,gateway_1[_0x3bb5de(0xd0)])(_0x453b22[_0x3bb5de(0xf1)]);console[_0x3bb5de(0x9a)](_0x3bb5de(0xa1)+_0x453b22[_0x3bb5de(0xf1)]+_0x3bb5de(0x10e)+_0x1ec13a+'\x22');let _0x5f0098=_0x484ad7+'\x20*'+_0x4e995d+_0x3bb5de(0xeb)+(_0x3bb5de(0xef)+_0x453b22[_0x3bb5de(0x14e)]+'\x20'+_0x453b22[_0x3bb5de(0x127)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x453b22['orderId']||_0x453b22['id'])+'`\x0a')+(_0x3bb5de(0x102)+_0x453b22['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x1ec13a+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x453b22[_0x3bb5de(0x128)])[_0x3bb5de(0xa3)](_0x3bb5de(0x125))+'\x0a');if(_0x453b22['customerName']||_0x453b22[_0x3bb5de(0xf8)]||_0x453b22['remitterIban']||_0x453b22[_0x3bb5de(0x8b)]||_0x453b22[_0x3bb5de(0x12e)]){_0x5f0098+=_0x3bb5de(0xd4);_0x453b22[_0x3bb5de(0x143)]&&(_0x5f0098+=_0x3bb5de(0xc2)+_0x453b22[_0x3bb5de(0x143)]+'`\x0a');_0x453b22[_0x3bb5de(0xf8)]&&(_0x5f0098+=_0x3bb5de(0xf6)+_0x453b22[_0x3bb5de(0xf8)]+'`\x0a');_0x453b22['remitterIban']&&(_0x5f0098+=_0x3bb5de(0xbc)+_0x453b22[_0x3bb5de(0xe2)]+'`\x0a');_0x453b22['customerIp']&&(_0x5f0098+=_0x3bb5de(0x111)+_0x453b22[_0x3bb5de(0x8b)]+'`\x0a');if(_0x453b22[_0x3bb5de(0x12e)]){const _0x22b73a=_0x453b22['customerUa'][_0x3bb5de(0x91)]>0x32?_0x453b22[_0x3bb5de(0x12e)][_0x3bb5de(0x76)](0x0,0x32)+_0x3bb5de(0x13d):_0x453b22[_0x3bb5de(0x12e)];_0x5f0098+='💻\x20Browser:\x20`'+_0x22b73a+'`\x0a';}}_0x20cfa9===_0x3bb5de(0xf3)&&_0x453b22[_0x3bb5de(0xee)]&&(_0x5f0098+=_0x3bb5de(0xda)+_0x453b22['chargebackAmount']+'\x20USDT*\x0a'),_0x20cfa9==='processing'&&(_0x5f0098+=_0x3bb5de(0x73)),_0x453b22[_0x3bb5de(0x97)]&&(_0x5f0098+='📝\x20Notes:\x20'+_0x453b22[_0x3bb5de(0x97)]+'\x0a'),await this[_0x3bb5de(0x105)](_0x454887,_0x5f0098,{'parse_mode':_0x3bb5de(0xf5)});}async[a57_0x2dd368(0x93)](_0x54f7f1,_0xcb2d7a,_0x3c5b9f){const _0x230d07=a57_0x2dd368,_0x181b44={'created':'📤','completed':'✅','rejected':'❌'},_0x356376={'created':_0x230d07(0x95),'completed':_0x230d07(0x104),'rejected':_0x230d07(0x86)},_0xd615ee=_0x181b44[_0x3c5b9f],_0x2ca88d=_0x356376[_0x3c5b9f],_0x33fab6=_0xd615ee+'\x20*'+_0x2ca88d+'*\x0a\x0a'+('💸\x20Amount:\x20*'+_0xcb2d7a[_0x230d07(0x14e)]+'\x20USD*\x0a')+(_0x230d07(0x11e)+_0xcb2d7a[_0x230d07(0xdc)]+'`\x0a')+(_0x230d07(0xc0)+_0xcb2d7a['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0xcb2d7a[_0x230d07(0x128)])[_0x230d07(0xa3)](_0x230d07(0x125))+'\x0a')+(_0xcb2d7a[_0x230d07(0x109)]?_0x230d07(0xa2)+_0xcb2d7a[_0x230d07(0x109)]+'`':'');await this[_0x230d07(0x105)](_0x54f7f1,_0x33fab6,{'parse_mode':_0x230d07(0xf5)});}async['sendLoginNotification'](_0xbff19,_0x5a72e5){const _0x4656f9=a57_0x2dd368;try{const _0x53ce73=await database_1[_0x4656f9(0xb3)][_0x4656f9(0xc7)]['findUnique']({'where':{'shopId':_0xbff19},'select':{'notificationLogin':!![]}});if(!_0x53ce73?.[_0x4656f9(0xd9)]){console[_0x4656f9(0x9a)](_0x4656f9(0xe5)+_0xbff19);return;}const _0x5f1268=_0x5a72e5[_0x4656f9(0x130)]?'🔐':'🚨',_0x30afa5=_0x5a72e5[_0x4656f9(0x130)]?'Successful\x20login':_0x4656f9(0x7e);let _0x55c12e=_0x5f1268+'\x20*'+_0x30afa5+_0x4656f9(0xeb)+(_0x4656f9(0x133)+_0x5a72e5['username']+'`\x0a')+(_0x4656f9(0x96)+_0x5a72e5['timestamp']['toLocaleString'](_0x4656f9(0x125))+'\x0a');_0x5a72e5[_0x4656f9(0x129)]&&(_0x55c12e+=_0x4656f9(0xc4)+_0x5a72e5[_0x4656f9(0x129)]+'`\x0a');if(_0x5a72e5[_0x4656f9(0xf0)]){const _0x530080=_0x5a72e5[_0x4656f9(0xf0)]['length']>0x32?_0x5a72e5[_0x4656f9(0xf0)][_0x4656f9(0x76)](0x0,0x32)+_0x4656f9(0x13d):_0x5a72e5[_0x4656f9(0xf0)];_0x55c12e+=_0x4656f9(0x75)+_0x530080+'`\x0a';}!_0x5a72e5[_0x4656f9(0x130)]&&(_0x55c12e+=_0x4656f9(0xc5)),await this[_0x4656f9(0x105)](_0xbff19,_0x55c12e,{'parse_mode':_0x4656f9(0xf5)}),console[_0x4656f9(0x9a)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0xbff19+':\x20'+(_0x5a72e5['success']?'success':_0x4656f9(0x13a)));}catch(_0x51e984){console[_0x4656f9(0xb4)](_0x4656f9(0xd3),_0x51e984);}}async['sendApiErrorNotification'](_0x2e2583,_0x1dc75d){const _0x45a35b=a57_0x2dd368;try{const _0x5cb9b1=await database_1[_0x45a35b(0xb3)][_0x45a35b(0xc7)][_0x45a35b(0xce)]({'where':{'shopId':_0x2e2583},'select':{'notificationApiError':!![]}});if(!_0x5cb9b1?.[_0x45a35b(0x11b)]){console[_0x45a35b(0x9a)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x2e2583);return;}let _0x265bc9=_0x45a35b(0x83)+(_0x45a35b(0x8f)+_0x1dc75d[_0x45a35b(0xdc)]+'\x20'+_0x1dc75d[_0x45a35b(0x101)]+'`\x0a')+(_0x45a35b(0x96)+_0x1dc75d[_0x45a35b(0xfd)][_0x45a35b(0xa3)](_0x45a35b(0x125))+'\x0a');_0x1dc75d[_0x45a35b(0x77)]&&(_0x265bc9+='📊\x20Error\x20code:\x20`'+_0x1dc75d[_0x45a35b(0x77)]+'`\x0a'),_0x265bc9+='❌\x20Error:\x20`'+_0x1dc75d[_0x45a35b(0x14c)]+'`\x0a',_0x1dc75d[_0x45a35b(0x14d)]&&(_0x265bc9+=_0x45a35b(0xc1)+_0x1dc75d[_0x45a35b(0x14d)]+'`\x0a'),_0x265bc9+=_0x45a35b(0x134),await this[_0x45a35b(0x105)](_0x2e2583,_0x265bc9,{'parse_mode':_0x45a35b(0xf5)}),console['log'](_0x45a35b(0x7b)+_0x2e2583+':\x20'+_0x1dc75d[_0x45a35b(0x101)]);}catch(_0x16c5cc){console[_0x45a35b(0xb4)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x16c5cc);}}async['sendCustomNotification'](_0x18ea80,_0x380d49,_0x3a6b05){const _0x22bd83=a57_0x2dd368;let _0xf0050a=_0x22bd83(0x106)+_0x380d49+_0x22bd83(0xeb);for(const [_0x1258e1,_0x407ff4]of Object['entries'](_0x3a6b05)){_0x407ff4!==null&&_0x407ff4!==undefined&&(_0xf0050a+=_0x1258e1+':\x20`'+_0x407ff4+'`\x0a');}await this[_0x22bd83(0x105)](_0x18ea80,_0xf0050a,{'parse_mode':_0x22bd83(0xf5)});}[a57_0x2dd368(0x148)](){const _0x372d96=a57_0x2dd368;return{'isActive':!!this[_0x372d96(0xdd)],'username':this[_0x372d96(0x9b)]};}['stopBot'](){const _0x183c64=a57_0x2dd368;this[_0x183c64(0xdd)]&&(this[_0x183c64(0xdd)][_0x183c64(0x12d)](),this[_0x183c64(0xdd)]=null,console[_0x183c64(0x9a)]('🛑\x20Telegram\x20bot\x20stopped'));}}exports['TelegramBotService']=TelegramBotService,exports[a57_0x2dd368(0xd8)]=new TelegramBotService();