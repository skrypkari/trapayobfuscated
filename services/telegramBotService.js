'use strict';function a57_0x799d(_0x22c60c,_0x59bf43){const _0x23fdb3=a57_0x23fd();return a57_0x799d=function(_0x799db5,_0x3157e6){_0x799db5=_0x799db5-0x160;let _0x32e365=_0x23fdb3[_0x799db5];return _0x32e365;},a57_0x799d(_0x22c60c,_0x59bf43);}function a57_0x23fd(){const _0xe01418=['onText','\x20\x20\x20Status:\x20','sendPaymentNotification','shopId','❌\x20Shop\x20with\x20username\x20`','__esModule','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','status','bot','stopPolling','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','toLocaleString','findUnique','log','orderId','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','To\x20reconnect,\x20use\x20the\x20/start\x20command','Payment\x20successfully\x20paid','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20',':\x20username=\x22','💻\x20Browser:\x20`','user\x20is\x20deactivated','getBotInfo','customerEmail','/disconnect\x20-\x20disconnect\x20from\x20notifications','\x20(@','polling_error','customerIp','1687475kdvWys','first_name','4586538sFKutu','update','\x0a👤\x20*Customer\x20Information:*\x0a','🔍\x20*Debug\x20Information*\x0a\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','❌\x20Please\x20use\x20/start\x20command\x20first','📝\x20Notes:\x20','name','message','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','sendCustomNotification','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','Payment\x20expired','💰\x20Amount:\x20*','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','Payout\x20completed','test','adminNotes','timestamp','customerUa','setupBotHandlers','🔔\x20Notifications\x20are\x20active\x0a\x0a','trapay_bot','*.\x0a\x0a','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','notificationLogin','updatedAt','en-US','📅\x20Date:\x20','split','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','entries','/status\x20-\x20check\x20connection\x20status\x0a','🌐\x20IP:\x20`','📊\x20*Connection\x20Status*\x0a\x0a','Failed\x20to\x20send\x20login\x20notification:','Commands:\x0a','Error\x20handling\x20/debug\x20command:','handleSingleLineVerification','498XhjlvO','📱\x20Telegram\x20notification:\x20gateway\x20\x22','Payment\x20refund','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Failed\x20to\x20send\x20API\x20error\x20notification:','remitterIban','Payout\x20rejected','...`\x0a\x0a','📅\x20Time:\x20','initializeBot','customerName','Error\x20handling\x20message:','*\x0a\x0a','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','6094326xzjiLF','❌\x20Error\x20getting\x20debug\x20information.','text','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','botToken','📛\x20Name:\x20`','telegramBotService','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','toLocaleDateString','ipAddress','../types/gateway','warn','from','forEach','Username:\x20`','•\x20Payment\x20status\x20changes\x0a','You\x20sent\x20','📊\x20Error\x20code:\x20`','gateway','blocked','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','length','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','telegramId','846rSgNLh','📝\x20Order\x20ID:\x20`','secretKey','txid','\x20USDT*\x0a','12OkdZZb','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','🔌\x20User\x20','Error\x20in\x20handleSingleLineVerification:','\x20USD*\x0a','../config/database','method','currency','createdAt','userAgent','🏦\x20IBAN:\x20`','Contact\x20administrator.','81aOIowf','sendApiErrorNotification','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','toString','•\x20Payouts\x0a\x0a','Telegram\x20bot\x20error:','🛑\x20Telegram\x20bot\x20stopped','🆔\x20Request\x20ID:\x20`','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','chat','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Use\x20/start\x20to\x20connect.','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','`\x0a\x0a','🆔\x20Payout\x20ID:\x20`','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','12472xXRCFC','username','sendPayoutNotification','913aZpXWN','includes','env','Payment\x20chargeback','New\x20payout\x20created','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','Successful\x20login','✅\x20Telegram\x20user\x20','\x22\x20->\x20display\x20\x22','`\x20(','chat\x20not\x20found','📧\x20Email:\x20`','Example:\x0a','🔗\x20TXID:\x20`','notificationApiError','endpoint','\x20via\x20single-line\x20input','User\x20','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','👤\x20Username:\x20`','📱\x20Your\x20Telegram\x20ID:\x20`','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','...\x22','\x20disconnected\x20from\x20shop\x20','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','__importDefault','\x20\x20\x20Username:\x20`','sendLoginNotification','.\x20*','💸\x20Penalty\x20amount:\x20*','TelegramBotService','🏦\x20Method:\x20`','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','shopSettings','error','getGatewayDisplayNameForTelegram','•\x20Payouts\x0a','📱\x20Shop:\x20*','...','default','requestId','Available\x20usernames:\x0a','`\x20is\x20inactive.\x0a\x0a','telegramUser','success','substring','Failed\x20login\x20attempt','Telegram\x20bot\x20polling\x20error:','processing','`.\x0a\x0a','startsWith','chargeback','🚨\x20*API\x20Error*\x0a\x0a','unknown\x20shop','errorMessage','create','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','statusCode','\x20initialized\x20successfully','last_name','trim','✅\x20Welcome\x20back!\x0a\x0a','findMany','Check\x20spelling\x20and\x20try\x20again.','•\x20New\x20payments\x0a','isVerified','💸\x20Amount:\x20*','🏪\x20Gateway:\x20`','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','allSettled','✅\x20Connected\x20to\x20shop:\x20*','Use\x20/start\x20to\x20begin.','Markdown','sendMessage','🎉\x20*Congratulations!*\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','Error\x20handling\x20/status\x20command:','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','`\x20not\x20found.\x0a\x0a','393690wjavQV','botUsername','sendShopNotification','failed','62591ECCTtW','🌐\x20IP\x20address:\x20`','shop'];a57_0x23fd=function(){return _0xe01418;};return a57_0x23fd();}const a57_0x5155ba=a57_0x799d;(function(_0x423f62,_0x46758f){const _0xaa609e=a57_0x799d,_0x1aece1=_0x423f62();while(!![]){try{const _0x3f891d=-parseInt(_0xaa609e(0x16e))/0x1+parseInt(_0xaa609e(0x1b8))/0x2*(parseInt(_0xaa609e(0x1f0))/0x3)+parseInt(_0xaa609e(0x1e4))/0x4*(-parseInt(_0xaa609e(0x18d))/0x5)+-parseInt(_0xaa609e(0x18f))/0x6+-parseInt(_0xaa609e(0x1c6))/0x7+-parseInt(_0xaa609e(0x201))/0x8*(-parseInt(_0xaa609e(0x1df))/0x9)+-parseInt(_0xaa609e(0x16a))/0xa*(-parseInt(_0xaa609e(0x204))/0xb);if(_0x3f891d===_0x46758f)break;else _0x1aece1['push'](_0x1aece1['shift']());}catch(_0x51d879){_0x1aece1['push'](_0x1aece1['shift']());}}}(a57_0x23fd,0xad87b));var __importDefault=this&&this[a57_0x5155ba(0x21d)]||function(_0x529c74){const _0x1c85c8=a57_0x5155ba;return _0x529c74&&_0x529c74[_0x1c85c8(0x176)]?_0x529c74:{'default':_0x529c74};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a57_0x5155ba(0x1cc)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a57_0x5155ba(0x1e9))),gateway_1=require(a57_0x5155ba(0x1d1));class TelegramBotService{constructor(){const _0x16d5d9=a57_0x5155ba;this['bot']=null,this['botToken']=process[_0x16d5d9(0x206)]['TELEGRAM_BOT_TOKEN']||'',this[_0x16d5d9(0x16b)]=process[_0x16d5d9(0x206)]['TELEGRAM_BOT_USERNAME']||_0x16d5d9(0x1a6),this['botToken']?this['initializeBot']():console[_0x16d5d9(0x1d2)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a57_0x5155ba(0x1c1)](){const _0x47ba7e=a57_0x5155ba;try{this[_0x47ba7e(0x179)]=new node_telegram_bot_api_1[(_0x47ba7e(0x22b))](this[_0x47ba7e(0x1ca)],{'polling':!![]}),this[_0x47ba7e(0x1a4)](),console[_0x47ba7e(0x17e)]('✅\x20Telegram\x20bot\x20@'+this[_0x47ba7e(0x16b)]+_0x47ba7e(0x23e));}catch(_0x45b09d){console[_0x47ba7e(0x226)](_0x47ba7e(0x168),_0x45b09d);}}[a57_0x5155ba(0x1a4)](){const _0x11f8a9=a57_0x5155ba;if(!this['bot'])return;this['bot'][_0x11f8a9(0x171)](/\/start/,async _0xc348db=>{const _0x246ab1=_0x11f8a9,_0x3a350e=_0xc348db[_0x246ab1(0x1fa)]['id'],_0x2f3cc0=_0xc348db[_0x246ab1(0x1d3)]?.['id']['toString'](),_0x50367b=_0xc348db[_0x246ab1(0x1d3)]?.[_0x246ab1(0x202)],_0x39d255=_0xc348db[_0x246ab1(0x1d3)]?.[_0x246ab1(0x18e)],_0x46b42e=_0xc348db[_0x246ab1(0x1d3)]?.[_0x246ab1(0x23f)];if(!_0x2f3cc0)return;try{let _0x3f8d4a=await database_1[_0x246ab1(0x22b)]['telegramUser'][_0x246ab1(0x17d)]({'where':{'telegramId':_0x2f3cc0},'include':{'shop':!![]}});!_0x3f8d4a?(_0x3f8d4a=await database_1[_0x246ab1(0x22b)][_0x246ab1(0x22f)][_0x246ab1(0x23b)]({'data':{'telegramId':_0x2f3cc0,'username':_0x50367b,'firstName':_0x39d255,'lastName':_0x46b42e,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x246ab1(0x17e)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x2f3cc0+_0x246ab1(0x18a)+_0x50367b+')')):_0x3f8d4a=await database_1['default']['telegramUser'][_0x246ab1(0x190)]({'where':{'telegramId':_0x2f3cc0},'data':{'username':_0x50367b,'firstName':_0x39d255,'lastName':_0x46b42e},'include':{'shop':!![]}}),_0x3f8d4a[_0x246ab1(0x245)]&&_0x3f8d4a[_0x246ab1(0x174)]&&_0x3f8d4a[_0x246ab1(0x170)]?await this[_0x246ab1(0x179)]?.[_0x246ab1(0x164)](_0x3a350e,_0x246ab1(0x241)+(_0x246ab1(0x17b)+_0x3f8d4a['shop'][_0x246ab1(0x197)]+'*\x0a')+(_0x246ab1(0x1d5)+_0x3f8d4a[_0x246ab1(0x170)][_0x246ab1(0x202)]+_0x246ab1(0x1fe))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x246ab1(0x244)+_0x246ab1(0x1d6)+_0x246ab1(0x1f4)+_0x246ab1(0x1b5)+_0x246ab1(0x1b1)+_0x246ab1(0x189),{'parse_mode':_0x246ab1(0x163)}):(_0x3f8d4a[_0x246ab1(0x174)]&&!_0x3f8d4a[_0x246ab1(0x245)]&&(await database_1['default'][_0x246ab1(0x22f)]['update']({'where':{'telegramId':_0x2f3cc0},'data':{'shopId':null,'isVerified':![]}}),console[_0x246ab1(0x17e)](_0x246ab1(0x1fd)+_0x2f3cc0)),await this[_0x246ab1(0x179)]?.[_0x246ab1(0x164)](_0x3a350e,_0x246ab1(0x19e)+_0x246ab1(0x1cd)+_0x246ab1(0x1f8)+_0x246ab1(0x210)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':'Markdown'}));}catch(_0xbc35db){console['error']('Error\x20handling\x20/start\x20command:',_0xbc35db),await this['bot']?.[_0x246ab1(0x164)](_0x3a350e,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x11f8a9(0x179)][_0x11f8a9(0x171)](/\/disconnect/,async _0x4ac639=>{const _0xa9e39=_0x11f8a9,_0x4ea2d5=_0x4ac639[_0xa9e39(0x1fa)]['id'],_0x405a9b=_0x4ac639['from']?.['id']['toString']();if(!_0x405a9b)return;try{const _0x2a5e4f=await database_1[_0xa9e39(0x22b)][_0xa9e39(0x22f)][_0xa9e39(0x17d)]({'where':{'telegramId':_0x405a9b},'include':{'shop':!![]}});if(!_0x2a5e4f||!_0x2a5e4f['isVerified']||!_0x2a5e4f[_0xa9e39(0x174)]){await this[_0xa9e39(0x179)]?.[_0xa9e39(0x164)](_0x4ea2d5,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x47c222=_0x2a5e4f[_0xa9e39(0x170)]?.[_0xa9e39(0x197)]||_0xa9e39(0x239);await database_1[_0xa9e39(0x22b)]['telegramUser'][_0xa9e39(0x190)]({'where':{'telegramId':_0x405a9b},'data':{'shopId':null,'isVerified':![]}}),console[_0xa9e39(0x17e)](_0xa9e39(0x1e6)+_0x405a9b+_0xa9e39(0x21b)+_0x2a5e4f[_0xa9e39(0x174)]),await this[_0xa9e39(0x179)]?.['sendMessage'](_0x4ea2d5,_0xa9e39(0x1dd)+_0x47c222+_0xa9e39(0x1a7)+_0xa9e39(0x181),{'parse_mode':_0xa9e39(0x163)});}catch(_0x2c222e){console[_0xa9e39(0x226)]('Error\x20handling\x20/disconnect\x20command:',_0x2c222e),await this[_0xa9e39(0x179)]?.[_0xa9e39(0x164)](_0x4ea2d5,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot'][_0x11f8a9(0x171)](/\/status/,async _0x32b951=>{const _0x460a7e=_0x11f8a9,_0x3f16ee=_0x32b951[_0x460a7e(0x1fa)]['id'],_0x2a06f1=_0x32b951[_0x460a7e(0x1d3)]?.['id']['toString']();if(!_0x2a06f1)return;try{const _0x2d68b8=await database_1['default'][_0x460a7e(0x22f)][_0x460a7e(0x17d)]({'where':{'telegramId':_0x2a06f1},'include':{'shop':!![]}});if(!_0x2d68b8){await this[_0x460a7e(0x179)]?.[_0x460a7e(0x164)](_0x3f16ee,_0x460a7e(0x1a8)+_0x460a7e(0x162));return;}if(!_0x2d68b8[_0x460a7e(0x245)]||!_0x2d68b8[_0x460a7e(0x174)]||!_0x2d68b8[_0x460a7e(0x170)]){await this[_0x460a7e(0x179)]?.[_0x460a7e(0x164)](_0x3f16ee,_0x460a7e(0x1c9)+_0x460a7e(0x1fc));return;}await this[_0x460a7e(0x179)]?.[_0x460a7e(0x164)](_0x3f16ee,_0x460a7e(0x1b3)+(_0x460a7e(0x161)+_0x2d68b8[_0x460a7e(0x170)][_0x460a7e(0x197)]+'*\x0a')+(_0x460a7e(0x217)+_0x2d68b8[_0x460a7e(0x170)][_0x460a7e(0x202)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x2d68b8[_0x460a7e(0x1aa)][_0x460a7e(0x1cf)](_0x460a7e(0x1ab))+'\x0a\x0a')+_0x460a7e(0x1a5)+_0x460a7e(0x1b5)+_0x460a7e(0x189),{'parse_mode':_0x460a7e(0x163)});}catch(_0xfc970f){console[_0x460a7e(0x226)](_0x460a7e(0x167),_0xfc970f),await this[_0x460a7e(0x179)]?.[_0x460a7e(0x164)](_0x3f16ee,_0x460a7e(0x1f9));}}),this[_0x11f8a9(0x179)][_0x11f8a9(0x171)](/\/debug/,async _0x47874e=>{const _0x381fad=_0x11f8a9,_0x2cf59f=_0x47874e['chat']['id'],_0x14d4eb=_0x47874e[_0x381fad(0x1d3)]?.['id'][_0x381fad(0x1f3)]();if(!_0x14d4eb)return;try{const _0x563027=await database_1[_0x381fad(0x22b)][_0x381fad(0x170)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x3bddaf=_0x381fad(0x192);_0x3bddaf+=_0x381fad(0x218)+_0x14d4eb+_0x381fad(0x1fe),_0x3bddaf+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x563027[_0x381fad(0x1d4)]((_0x1b4b0e,_0x418c09)=>{const _0x272048=_0x381fad;_0x3bddaf+=_0x418c09+0x1+_0x272048(0x220)+_0x1b4b0e[_0x272048(0x197)]+'*\x0a',_0x3bddaf+=_0x272048(0x21e)+_0x1b4b0e['username']+'`\x0a',_0x3bddaf+=_0x272048(0x172)+_0x1b4b0e[_0x272048(0x178)]+'\x0a',_0x3bddaf+='\x20\x20\x20Public\x20Key:\x20`'+_0x1b4b0e['publicKey'][_0x272048(0x231)](0x0,0xf)+_0x272048(0x1bf);}),await this[_0x381fad(0x179)]?.['sendMessage'](_0x2cf59f,_0x3bddaf,{'parse_mode':_0x381fad(0x163)});}catch(_0x5139f5){console[_0x381fad(0x226)](_0x381fad(0x1b6),_0x5139f5),await this[_0x381fad(0x179)]?.['sendMessage'](_0x2cf59f,_0x381fad(0x1c7));}}),this[_0x11f8a9(0x179)]['on'](_0x11f8a9(0x198),async _0xdcc4e4=>{const _0xc62ba7=_0x11f8a9;if(_0xdcc4e4[_0xc62ba7(0x1c8)]?.[_0xc62ba7(0x236)]('/'))return;const _0x4258a9=_0xdcc4e4[_0xc62ba7(0x1fa)]['id'],_0x4418f6=_0xdcc4e4[_0xc62ba7(0x1d3)]?.['id']['toString'](),_0x28bb76=_0xdcc4e4[_0xc62ba7(0x1c8)]?.[_0xc62ba7(0x240)]();if(!_0x4418f6||!_0x28bb76)return;try{const _0x16718b=await database_1[_0xc62ba7(0x22b)][_0xc62ba7(0x22f)][_0xc62ba7(0x17d)]({'where':{'telegramId':_0x4418f6},'include':{'shop':!![]}});if(!_0x16718b){await this[_0xc62ba7(0x179)]?.['sendMessage'](_0x4258a9,_0xc62ba7(0x195));return;}if(_0x16718b['isVerified']&&_0x16718b[_0xc62ba7(0x174)]&&_0x16718b[_0xc62ba7(0x170)]){await this[_0xc62ba7(0x179)]?.[_0xc62ba7(0x164)](_0x4258a9,_0xc62ba7(0x177)+_0x16718b[_0xc62ba7(0x170)][_0xc62ba7(0x197)]+_0xc62ba7(0x1a7)+_0xc62ba7(0x248),{'parse_mode':_0xc62ba7(0x163)});return;}const _0x10b39d=_0x28bb76[_0xc62ba7(0x1ad)](/\s+/);if(_0x10b39d[_0xc62ba7(0x1dc)]!==0x2){await this['bot']?.[_0xc62ba7(0x164)](_0x4258a9,_0xc62ba7(0x1ae)+_0xc62ba7(0x1f8)+'Example:\x0a'+_0xc62ba7(0x199)+(_0xc62ba7(0x1d7)+_0x10b39d[_0xc62ba7(0x1dc)]+'\x20parts:\x20'+_0x10b39d['map'](_0x512606=>'`'+_0x512606+'`')['join'](',\x20')),{'parse_mode':_0xc62ba7(0x163)});return;}const [_0x4d8343,_0x53b0e6]=_0x10b39d;console['log'](_0xc62ba7(0x1bb)+_0x4418f6+':\x20username=\x22'+_0x4d8343+'\x22,\x20apiKey=\x22'+_0x53b0e6[_0xc62ba7(0x231)](0x0,0xa)+_0xc62ba7(0x21a)),await this['handleSingleLineVerification'](_0x4258a9,_0x4418f6,_0x4d8343,_0x53b0e6);}catch(_0x276f9a){console[_0xc62ba7(0x226)](_0xc62ba7(0x1c3),_0x276f9a),await this[_0xc62ba7(0x179)]?.[_0xc62ba7(0x164)](_0x4258a9,_0xc62ba7(0x1f9));}}),this[_0x11f8a9(0x179)]['on'](_0x11f8a9(0x226),_0xd876d1=>{const _0x1b1535=_0x11f8a9;console[_0x1b1535(0x226)](_0x1b1535(0x1f5),_0xd876d1);}),this[_0x11f8a9(0x179)]['on'](_0x11f8a9(0x18b),_0x4d6059=>{const _0x46c6c4=_0x11f8a9;console[_0x46c6c4(0x226)](_0x46c6c4(0x233),_0x4d6059);});}async[a57_0x5155ba(0x1b7)](_0x2f5bff,_0x1f4e70,_0x208914,_0x3917f8){const _0x3c5dcf=a57_0x5155ba;try{console[_0x3c5dcf(0x17e)](_0x3c5dcf(0x1bb)+_0x1f4e70+_0x3c5dcf(0x184)+_0x208914+'\x22,\x20apiKey=\x22'+_0x3917f8['substring'](0x0,0xa)+_0x3c5dcf(0x21a));if(!_0x208914||_0x208914['length']<0x3||_0x208914[_0x3c5dcf(0x1dc)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x3c5dcf(0x1a0)](_0x208914)){await this[_0x3c5dcf(0x179)]?.[_0x3c5dcf(0x164)](_0x2f5bff,'❌\x20Invalid\x20username\x20format:\x20`'+_0x208914+_0x3c5dcf(0x1fe)+_0x3c5dcf(0x224),{'parse_mode':_0x3c5dcf(0x163)});return;}if(!_0x3917f8||!_0x3917f8[_0x3c5dcf(0x236)]('pk_')&&!_0x3917f8[_0x3c5dcf(0x236)]('sk_')){await this['bot']?.[_0x3c5dcf(0x164)](_0x2f5bff,_0x3c5dcf(0x1c5)+_0x3c5dcf(0x1db),{'parse_mode':_0x3c5dcf(0x163)});return;}const _0xc46b40=await database_1[_0x3c5dcf(0x22b)][_0x3c5dcf(0x170)][_0x3c5dcf(0x17d)]({'where':{'username':_0x208914},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0xc46b40){const _0x16c9b6=await database_1[_0x3c5dcf(0x22b)]['shop'][_0x3c5dcf(0x242)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x1eca2c=_0x3c5dcf(0x175)+_0x208914+_0x3c5dcf(0x169);_0x16c9b6[_0x3c5dcf(0x1dc)]>0x0?(_0x1eca2c+=_0x3c5dcf(0x22d),_0x16c9b6[_0x3c5dcf(0x1d4)](_0x483563=>{const _0x334fa3=_0x3c5dcf;_0x1eca2c+='•\x20`'+_0x483563[_0x334fa3(0x202)]+_0x334fa3(0x20d)+_0x483563[_0x334fa3(0x197)]+')\x0a';}),_0x1eca2c+=_0x3c5dcf(0x193)):_0x1eca2c+=_0x3c5dcf(0x243);await this['bot']?.[_0x3c5dcf(0x164)](_0x2f5bff,_0x1eca2c,{'parse_mode':_0x3c5dcf(0x163)});return;}if(_0xc46b40[_0x3c5dcf(0x178)]!=='ACTIVE'){await this[_0x3c5dcf(0x179)]?.[_0x3c5dcf(0x164)](_0x2f5bff,'❌\x20Shop\x20`'+_0x208914+_0x3c5dcf(0x22e)+_0x3c5dcf(0x1ef),{'parse_mode':_0x3c5dcf(0x163)});return;}if(_0xc46b40['publicKey']!==_0x3917f8&&_0xc46b40[_0x3c5dcf(0x1e1)]!==_0x3917f8){await this[_0x3c5dcf(0x179)]?.['sendMessage'](_0x2f5bff,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x208914+'`.\x0a\x0a'+_0x3c5dcf(0x1ce)+_0x3c5dcf(0x200),{'parse_mode':_0x3c5dcf(0x163)});return;}const _0x2149da=await database_1[_0x3c5dcf(0x22b)][_0x3c5dcf(0x22f)]['findFirst']({'where':{'shopId':_0xc46b40['id'],'isVerified':!![],'telegramId':{'not':_0x1f4e70}}});if(_0x2149da){await this[_0x3c5dcf(0x179)]?.[_0x3c5dcf(0x164)](_0x2f5bff,_0x3c5dcf(0x194)+_0x208914+_0x3c5dcf(0x235)+_0x3c5dcf(0x219),{'parse_mode':_0x3c5dcf(0x163)});return;}await database_1[_0x3c5dcf(0x22b)][_0x3c5dcf(0x22f)][_0x3c5dcf(0x190)]({'where':{'telegramId':_0x1f4e70},'data':{'shopId':_0xc46b40['id'],'isVerified':!![]}}),await this['bot']?.['sendMessage'](_0x2f5bff,_0x3c5dcf(0x165)+_0x3c5dcf(0x166)+(_0x3c5dcf(0x229)+_0xc46b40[_0x3c5dcf(0x197)]+'*\x0a')+(_0x3c5dcf(0x217)+_0xc46b40[_0x3c5dcf(0x202)]+_0x3c5dcf(0x1fe))+_0x3c5dcf(0x19b)+_0x3c5dcf(0x244)+_0x3c5dcf(0x1d6)+_0x3c5dcf(0x228)+'•\x20Important\x20events\x0a\x0a'+_0x3c5dcf(0x1b5)+_0x3c5dcf(0x1b1)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x3c5dcf(0x163)}),console[_0x3c5dcf(0x17e)](_0x3c5dcf(0x20b)+_0x1f4e70+'\x20verified\x20for\x20shop\x20'+_0xc46b40[_0x3c5dcf(0x202)]+_0x3c5dcf(0x214));}catch(_0x8883cb){console[_0x3c5dcf(0x226)](_0x3c5dcf(0x1e7),_0x8883cb),await this[_0x3c5dcf(0x179)]?.['sendMessage'](_0x2f5bff,_0x3c5dcf(0x1af));}}async[a57_0x5155ba(0x16c)](_0x19b69d,_0x352cba,_0x41b761){const _0x1c0ef8=a57_0x5155ba;if(!this[_0x1c0ef8(0x179)]){console['warn'](_0x1c0ef8(0x180));return;}try{const _0x4fec51=await database_1['default'][_0x1c0ef8(0x22f)][_0x1c0ef8(0x242)]({'where':{'shopId':_0x19b69d,'isVerified':!![]}});if(_0x4fec51['length']===0x0){console[_0x1c0ef8(0x17e)](_0x1c0ef8(0x23c)+_0x19b69d);return;}const _0x30dbe7=_0x4fec51['map'](async _0x263db5=>{const _0x29aab9=_0x1c0ef8;try{await this['bot']?.['sendMessage'](_0x263db5[_0x29aab9(0x1de)],_0x352cba,_0x41b761),console['log'](_0x29aab9(0x21c)+_0x263db5[_0x29aab9(0x1de)]);}catch(_0x5ba1bc){console[_0x29aab9(0x226)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x263db5[_0x29aab9(0x1de)]+':',_0x5ba1bc),_0x5ba1bc instanceof Error&&(_0x5ba1bc[_0x29aab9(0x198)][_0x29aab9(0x205)](_0x29aab9(0x1da))||_0x5ba1bc[_0x29aab9(0x198)][_0x29aab9(0x205)](_0x29aab9(0x20e))||_0x5ba1bc[_0x29aab9(0x198)][_0x29aab9(0x205)](_0x29aab9(0x186)))&&(await database_1['default']['telegramUser'][_0x29aab9(0x190)]({'where':{'id':_0x263db5['id']},'data':{'isVerified':![]}}),console[_0x29aab9(0x17e)](_0x29aab9(0x215)+_0x263db5['telegramId']+_0x29aab9(0x1e5)));}});await Promise[_0x1c0ef8(0x160)](_0x30dbe7);}catch(_0xcf7afc){console[_0x1c0ef8(0x226)]('Error\x20sending\x20shop\x20notification:',_0xcf7afc);}}async[a57_0x5155ba(0x173)](_0x91f60b,_0x4f5b5e,_0x2ef900){const _0x57af0c=a57_0x5155ba,_0x10a441={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x1a5d1c={'created':'New\x20payment\x20created','paid':_0x57af0c(0x182),'failed':'Payment\x20failed','expired':_0x57af0c(0x19c),'refund':_0x57af0c(0x1ba),'chargeback':_0x57af0c(0x207),'processing':'Payment\x20is\x20being\x20processed'},_0x90b3d2=_0x10a441[_0x2ef900],_0x111f69=_0x1a5d1c[_0x2ef900],_0x3faf62=(0x0,gateway_1[_0x57af0c(0x227)])(_0x4f5b5e[_0x57af0c(0x1d9)]);console[_0x57af0c(0x17e)](_0x57af0c(0x1b9)+_0x4f5b5e[_0x57af0c(0x1d9)]+_0x57af0c(0x20c)+_0x3faf62+'\x22');let _0x47ea61=_0x90b3d2+'\x20*'+_0x111f69+_0x57af0c(0x1c4)+(_0x57af0c(0x19d)+_0x4f5b5e['amount']+'\x20'+_0x4f5b5e[_0x57af0c(0x1eb)]+'*\x0a')+(_0x57af0c(0x1e0)+(_0x4f5b5e[_0x57af0c(0x17f)]||_0x4f5b5e['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x4f5b5e['id']+'`\x0a')+(_0x57af0c(0x247)+_0x3faf62+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x4f5b5e['createdAt'])[_0x57af0c(0x17c)](_0x57af0c(0x1ab))+'\x0a');if(_0x4f5b5e['customerName']||_0x4f5b5e[_0x57af0c(0x188)]||_0x4f5b5e['remitterIban']||_0x4f5b5e[_0x57af0c(0x18c)]||_0x4f5b5e['customerUa']){_0x47ea61+=_0x57af0c(0x191);_0x4f5b5e['customerName']&&(_0x47ea61+=_0x57af0c(0x1cb)+_0x4f5b5e[_0x57af0c(0x1c2)]+'`\x0a');_0x4f5b5e[_0x57af0c(0x188)]&&(_0x47ea61+=_0x57af0c(0x20f)+_0x4f5b5e[_0x57af0c(0x188)]+'`\x0a');_0x4f5b5e[_0x57af0c(0x1bd)]&&(_0x47ea61+=_0x57af0c(0x1ee)+_0x4f5b5e['remitterIban']+'`\x0a');_0x4f5b5e[_0x57af0c(0x18c)]&&(_0x47ea61+=_0x57af0c(0x1b2)+_0x4f5b5e[_0x57af0c(0x18c)]+'`\x0a');if(_0x4f5b5e[_0x57af0c(0x1a3)]){const _0x183c63=_0x4f5b5e[_0x57af0c(0x1a3)][_0x57af0c(0x1dc)]>0x32?_0x4f5b5e[_0x57af0c(0x1a3)][_0x57af0c(0x231)](0x0,0x32)+_0x57af0c(0x22a):_0x4f5b5e['customerUa'];_0x47ea61+=_0x57af0c(0x185)+_0x183c63+'`\x0a';}}_0x2ef900===_0x57af0c(0x237)&&_0x4f5b5e['chargebackAmount']&&(_0x47ea61+=_0x57af0c(0x221)+_0x4f5b5e['chargebackAmount']+_0x57af0c(0x1e3)),_0x2ef900===_0x57af0c(0x234)&&(_0x47ea61+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x4f5b5e[_0x57af0c(0x1a1)]&&(_0x47ea61+=_0x57af0c(0x196)+_0x4f5b5e[_0x57af0c(0x1a1)]+'\x0a'),await this[_0x57af0c(0x16c)](_0x91f60b,_0x47ea61,{'parse_mode':'Markdown'});}async[a57_0x5155ba(0x203)](_0x5e7268,_0x163b32,_0x5b45ae){const _0x133d4d=a57_0x5155ba,_0x537307={'created':'📤','completed':'✅','rejected':'❌'},_0xdcd3d6={'created':_0x133d4d(0x208),'completed':_0x133d4d(0x19f),'rejected':_0x133d4d(0x1be)},_0x4df92b=_0x537307[_0x5b45ae],_0xb3ea79=_0xdcd3d6[_0x5b45ae],_0x49a8f1=_0x4df92b+'\x20*'+_0xb3ea79+_0x133d4d(0x1c4)+(_0x133d4d(0x246)+_0x163b32['amount']+_0x133d4d(0x1e8))+(_0x133d4d(0x223)+_0x163b32[_0x133d4d(0x1ea)]+'`\x0a')+(_0x133d4d(0x1ff)+_0x163b32['id']+'`\x0a')+(_0x133d4d(0x1ac)+new Date(_0x163b32[_0x133d4d(0x1ec)])['toLocaleString'](_0x133d4d(0x1ab))+'\x0a')+(_0x163b32[_0x133d4d(0x1e2)]?_0x133d4d(0x211)+_0x163b32[_0x133d4d(0x1e2)]+'`':'');await this[_0x133d4d(0x16c)](_0x5e7268,_0x49a8f1,{'parse_mode':_0x133d4d(0x163)});}async[a57_0x5155ba(0x21f)](_0x46b3ab,_0x53884d){const _0x6d3f8e=a57_0x5155ba;try{const _0x1c5fd6=await database_1['default'][_0x6d3f8e(0x225)][_0x6d3f8e(0x17d)]({'where':{'shopId':_0x46b3ab},'select':{'notificationLogin':!![]}});if(!_0x1c5fd6?.[_0x6d3f8e(0x1a9)]){console['log']('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x46b3ab);return;}const _0x2658f4=_0x53884d['success']?'🔐':'🚨',_0x36db95=_0x53884d[_0x6d3f8e(0x230)]?_0x6d3f8e(0x20a):_0x6d3f8e(0x232);let _0x2b0da2=_0x2658f4+'\x20*'+_0x36db95+'*\x0a\x0a'+(_0x6d3f8e(0x217)+_0x53884d[_0x6d3f8e(0x202)]+'`\x0a')+('📅\x20Time:\x20'+_0x53884d['timestamp'][_0x6d3f8e(0x17c)]('en-US')+'\x0a');_0x53884d[_0x6d3f8e(0x1d0)]&&(_0x2b0da2+=_0x6d3f8e(0x16f)+_0x53884d[_0x6d3f8e(0x1d0)]+'`\x0a');if(_0x53884d[_0x6d3f8e(0x1ed)]){const _0x459c78=_0x53884d[_0x6d3f8e(0x1ed)][_0x6d3f8e(0x1dc)]>0x32?_0x53884d[_0x6d3f8e(0x1ed)]['substring'](0x0,0x32)+_0x6d3f8e(0x22a):_0x53884d['userAgent'];_0x2b0da2+=_0x6d3f8e(0x185)+_0x459c78+'`\x0a';}!_0x53884d['success']&&(_0x2b0da2+=_0x6d3f8e(0x209)),await this[_0x6d3f8e(0x16c)](_0x46b3ab,_0x2b0da2,{'parse_mode':_0x6d3f8e(0x163)}),console[_0x6d3f8e(0x17e)](_0x6d3f8e(0x1f2)+_0x46b3ab+':\x20'+(_0x53884d['success']?_0x6d3f8e(0x230):_0x6d3f8e(0x16d)));}catch(_0x4d1bba){console[_0x6d3f8e(0x226)](_0x6d3f8e(0x1b4),_0x4d1bba);}}async[a57_0x5155ba(0x1f1)](_0x4b4266,_0x53ba0a){const _0x5980ca=a57_0x5155ba;try{const _0x1dad2f=await database_1['default'][_0x5980ca(0x225)]['findUnique']({'where':{'shopId':_0x4b4266},'select':{'notificationApiError':!![]}});if(!_0x1dad2f?.[_0x5980ca(0x212)]){console[_0x5980ca(0x17e)](_0x5980ca(0x1fb)+_0x4b4266);return;}let _0x4177fb=_0x5980ca(0x238)+('🔗\x20Endpoint:\x20`'+_0x53ba0a['method']+'\x20'+_0x53ba0a[_0x5980ca(0x213)]+'`\x0a')+(_0x5980ca(0x1c0)+_0x53ba0a[_0x5980ca(0x1a2)][_0x5980ca(0x17c)](_0x5980ca(0x1ab))+'\x0a');_0x53ba0a[_0x5980ca(0x23d)]&&(_0x4177fb+=_0x5980ca(0x1d8)+_0x53ba0a['statusCode']+'`\x0a'),_0x4177fb+='❌\x20Error:\x20`'+_0x53ba0a[_0x5980ca(0x23a)]+'`\x0a',_0x53ba0a[_0x5980ca(0x22c)]&&(_0x4177fb+=_0x5980ca(0x1f7)+_0x53ba0a[_0x5980ca(0x22c)]+'`\x0a'),_0x4177fb+=_0x5980ca(0x216),await this[_0x5980ca(0x16c)](_0x4b4266,_0x4177fb,{'parse_mode':_0x5980ca(0x163)}),console['log'](_0x5980ca(0x183)+_0x4b4266+':\x20'+_0x53ba0a[_0x5980ca(0x213)]);}catch(_0x425a30){console[_0x5980ca(0x226)](_0x5980ca(0x1bc),_0x425a30);}}async[a57_0x5155ba(0x19a)](_0x566765,_0x2853c7,_0x4d0d6){const _0x4cdd4d=a57_0x5155ba;let _0x2072f3='🔔\x20*'+_0x2853c7+_0x4cdd4d(0x1c4);for(const [_0x4bddea,_0x589488]of Object[_0x4cdd4d(0x1b0)](_0x4d0d6)){_0x589488!==null&&_0x589488!==undefined&&(_0x2072f3+=_0x4bddea+':\x20`'+_0x589488+'`\x0a');}await this[_0x4cdd4d(0x16c)](_0x566765,_0x2072f3,{'parse_mode':_0x4cdd4d(0x163)});}[a57_0x5155ba(0x187)](){const _0x590e0a=a57_0x5155ba;return{'isActive':!!this[_0x590e0a(0x179)],'username':this[_0x590e0a(0x16b)]};}['stopBot'](){const _0x2ec7ca=a57_0x5155ba;this[_0x2ec7ca(0x179)]&&(this[_0x2ec7ca(0x179)][_0x2ec7ca(0x17a)](),this[_0x2ec7ca(0x179)]=null,console[_0x2ec7ca(0x17e)](_0x2ec7ca(0x1f6)));}}exports[a57_0x5155ba(0x222)]=TelegramBotService,exports[a57_0x5155ba(0x1cc)]=new TelegramBotService();