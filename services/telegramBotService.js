'use strict';const a54_0x11e540=a54_0x2288;(function(_0x5c529f,_0x535b0c){const _0x7acd5b=a54_0x2288,_0x5c1f3c=_0x5c529f();while(!![]){try{const _0x126898=-parseInt(_0x7acd5b(0x194))/0x1+-parseInt(_0x7acd5b(0x23b))/0x2+parseInt(_0x7acd5b(0x1e9))/0x3*(parseInt(_0x7acd5b(0x247))/0x4)+-parseInt(_0x7acd5b(0x183))/0x5*(parseInt(_0x7acd5b(0x188))/0x6)+-parseInt(_0x7acd5b(0x1bc))/0x7+parseInt(_0x7acd5b(0x237))/0x8*(parseInt(_0x7acd5b(0x233))/0x9)+parseInt(_0x7acd5b(0x21d))/0xa;if(_0x126898===_0x535b0c)break;else _0x5c1f3c['push'](_0x5c1f3c['shift']());}catch(_0x46df55){_0x5c1f3c['push'](_0x5c1f3c['shift']());}}}(a54_0x6b77,0xb697f));var __importDefault=this&&this[a54_0x11e540(0x1f1)]||function(_0x52237c){const _0x579295=a54_0x11e540;return _0x52237c&&_0x52237c[_0x579295(0x1cd)]?_0x52237c:{'default':_0x52237c};};Object[a54_0x11e540(0x1e3)](exports,a54_0x11e540(0x1cd),{'value':!![]}),exports[a54_0x11e540(0x1d0)]=exports[a54_0x11e540(0x25a)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x11e540(0x192))),database_1=__importDefault(require(a54_0x11e540(0x1ca))),gateway_1=require(a54_0x11e540(0x1a9));class TelegramBotService{constructor(){const _0x432382=a54_0x11e540;this[_0x432382(0x1c6)]=null,this[_0x432382(0x1e1)]=process[_0x432382(0x189)][_0x432382(0x18e)]||'',this[_0x432382(0x206)]=process[_0x432382(0x189)]['TELEGRAM_BOT_USERNAME']||'trapay_bot',this[_0x432382(0x1e1)]?this[_0x432382(0x20d)]():console[_0x432382(0x19f)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a54_0x11e540(0x20d)](){const _0x2f322d=a54_0x11e540;try{this[_0x2f322d(0x1c6)]=new node_telegram_bot_api_1[(_0x2f322d(0x219))](this[_0x2f322d(0x1e1)],{'polling':!![]}),this[_0x2f322d(0x1ee)](),console[_0x2f322d(0x253)]('✅\x20Telegram\x20bot\x20@'+this[_0x2f322d(0x206)]+_0x2f322d(0x1d7));}catch(_0x371296){console[_0x2f322d(0x1ab)](_0x2f322d(0x229),_0x371296);}}[a54_0x11e540(0x1ee)](){const _0x36b270=a54_0x11e540;if(!this[_0x36b270(0x1c6)])return;this[_0x36b270(0x1c6)][_0x36b270(0x244)](/\/start/,async _0xc92ccf=>{const _0x77dfaa=_0x36b270,_0xac0fad=_0xc92ccf[_0x77dfaa(0x240)]['id'],_0x5eb9ee=_0xc92ccf['from']?.['id'][_0x77dfaa(0x22c)](),_0x124608=_0xc92ccf[_0x77dfaa(0x213)]?.[_0x77dfaa(0x1fa)],_0x2549a0=_0xc92ccf[_0x77dfaa(0x213)]?.[_0x77dfaa(0x1ce)],_0x38834d=_0xc92ccf[_0x77dfaa(0x213)]?.[_0x77dfaa(0x246)];if(!_0x5eb9ee)return;try{let _0x57a69c=await database_1['default'][_0x77dfaa(0x232)][_0x77dfaa(0x1c5)]({'where':{'telegramId':_0x5eb9ee},'include':{'shop':!![]}});!_0x57a69c?(_0x57a69c=await database_1['default'][_0x77dfaa(0x232)][_0x77dfaa(0x1de)]({'data':{'telegramId':_0x5eb9ee,'username':_0x124608,'firstName':_0x2549a0,'lastName':_0x38834d,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x77dfaa(0x253)](_0x77dfaa(0x1b2)+_0x5eb9ee+'\x20(@'+_0x124608+')')):_0x57a69c=await database_1[_0x77dfaa(0x219)][_0x77dfaa(0x232)][_0x77dfaa(0x222)]({'where':{'telegramId':_0x5eb9ee},'data':{'username':_0x124608,'firstName':_0x2549a0,'lastName':_0x38834d},'include':{'shop':!![]}}),_0x57a69c[_0x77dfaa(0x18f)]&&_0x57a69c[_0x77dfaa(0x1b5)]&&_0x57a69c[_0x77dfaa(0x1a1)]?await this[_0x77dfaa(0x1c6)]?.[_0x77dfaa(0x230)](_0xac0fad,_0x77dfaa(0x1d2)+(_0x77dfaa(0x1d4)+_0x57a69c['shop']['name']+'*\x0a')+('Username:\x20`'+_0x57a69c['shop']['username']+_0x77dfaa(0x1f4))+_0x77dfaa(0x1ef)+_0x77dfaa(0x220)+_0x77dfaa(0x24a)+_0x77dfaa(0x215)+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x77dfaa(0x1b1),{'parse_mode':_0x77dfaa(0x1c0)}):(_0x57a69c['shopId']&&!_0x57a69c[_0x77dfaa(0x18f)]&&(await database_1[_0x77dfaa(0x219)][_0x77dfaa(0x232)][_0x77dfaa(0x222)]({'where':{'telegramId':_0x5eb9ee},'data':{'shopId':null,'isVerified':![]}}),console[_0x77dfaa(0x253)](_0x77dfaa(0x1ec)+_0x5eb9ee)),await this['bot']?.[_0x77dfaa(0x230)](_0xac0fad,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0x77dfaa(0x208)+_0x77dfaa(0x1aa)+_0x77dfaa(0x211)+_0x77dfaa(0x22e)+_0x77dfaa(0x23d),{'parse_mode':'Markdown'}));}catch(_0xe428f6){console[_0x77dfaa(0x1ab)](_0x77dfaa(0x1b8),_0xe428f6),await this[_0x77dfaa(0x1c6)]?.['sendMessage'](_0xac0fad,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x36b270(0x1c6)][_0x36b270(0x244)](/\/disconnect/,async _0x5b55d1=>{const _0x382da3=_0x36b270,_0x1c5a64=_0x5b55d1[_0x382da3(0x240)]['id'],_0x40dbb2=_0x5b55d1[_0x382da3(0x213)]?.['id'][_0x382da3(0x22c)]();if(!_0x40dbb2)return;try{const _0x22faee=await database_1[_0x382da3(0x219)]['telegramUser'][_0x382da3(0x1c5)]({'where':{'telegramId':_0x40dbb2},'include':{'shop':!![]}});if(!_0x22faee||!_0x22faee[_0x382da3(0x18f)]||!_0x22faee['shopId']){await this[_0x382da3(0x1c6)]?.[_0x382da3(0x230)](_0x1c5a64,_0x382da3(0x1d9));return;}const _0x2ab758=_0x22faee[_0x382da3(0x1a1)]?.[_0x382da3(0x1c4)]||_0x382da3(0x1dc);await database_1[_0x382da3(0x219)]['telegramUser'][_0x382da3(0x222)]({'where':{'telegramId':_0x40dbb2},'data':{'shopId':null,'isVerified':![]}}),console[_0x382da3(0x253)](_0x382da3(0x1e6)+_0x40dbb2+_0x382da3(0x186)+_0x22faee['shopId']),await this[_0x382da3(0x1c6)]?.[_0x382da3(0x230)](_0x1c5a64,_0x382da3(0x210)+_0x2ab758+'*.\x0a\x0a'+_0x382da3(0x201),{'parse_mode':_0x382da3(0x1c0)});}catch(_0x595c66){console[_0x382da3(0x1ab)]('Error\x20handling\x20/disconnect\x20command:',_0x595c66),await this[_0x382da3(0x1c6)]?.['sendMessage'](_0x1c5a64,_0x382da3(0x1b9));}}),this['bot']['onText'](/\/status/,async _0xb7a3f4=>{const _0x12595e=_0x36b270,_0x344cd5=_0xb7a3f4[_0x12595e(0x240)]['id'],_0x380656=_0xb7a3f4[_0x12595e(0x213)]?.['id'][_0x12595e(0x22c)]();if(!_0x380656)return;try{const _0x25c3b7=await database_1[_0x12595e(0x219)]['telegramUser']['findUnique']({'where':{'telegramId':_0x380656},'include':{'shop':!![]}});if(!_0x25c3b7){await this[_0x12595e(0x1c6)]?.[_0x12595e(0x230)](_0x344cd5,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x12595e(0x193));return;}if(!_0x25c3b7[_0x12595e(0x18f)]||!_0x25c3b7[_0x12595e(0x1b5)]||!_0x25c3b7[_0x12595e(0x1a1)]){await this['bot']?.[_0x12595e(0x230)](_0x344cd5,_0x12595e(0x221)+_0x12595e(0x199));return;}await this[_0x12595e(0x1c6)]?.[_0x12595e(0x230)](_0x344cd5,_0x12595e(0x1b0)+(_0x12595e(0x1f6)+_0x25c3b7[_0x12595e(0x1a1)][_0x12595e(0x1c4)]+'*\x0a')+(_0x12595e(0x1c8)+_0x25c3b7[_0x12595e(0x1a1)][_0x12595e(0x1fa)]+'`\x0a')+(_0x12595e(0x223)+_0x25c3b7[_0x12595e(0x191)][_0x12595e(0x25c)](_0x12595e(0x195))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+'Commands:\x0a'+_0x12595e(0x1b1),{'parse_mode':_0x12595e(0x1c0)});}catch(_0x4decdf){console[_0x12595e(0x1ab)](_0x12595e(0x1fc),_0x4decdf),await this[_0x12595e(0x1c6)]?.[_0x12595e(0x230)](_0x344cd5,_0x12595e(0x1b9));}}),this[_0x36b270(0x1c6)]['onText'](/\/debug/,async _0x165c31=>{const _0x3c8dc9=_0x36b270,_0x334861=_0x165c31[_0x3c8dc9(0x240)]['id'],_0x349851=_0x165c31['from']?.['id'][_0x3c8dc9(0x22c)]();if(!_0x349851)return;try{const _0x91cda9=await database_1[_0x3c8dc9(0x219)][_0x3c8dc9(0x1a1)][_0x3c8dc9(0x1b7)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4f495b='🔍\x20*Debug\x20Information*\x0a\x0a';_0x4f495b+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x349851+'`\x0a\x0a',_0x4f495b+=_0x3c8dc9(0x181),_0x91cda9[_0x3c8dc9(0x1db)]((_0x241ca5,_0x2ea8bd)=>{const _0x3e5509=_0x3c8dc9;_0x4f495b+=_0x2ea8bd+0x1+_0x3e5509(0x236)+_0x241ca5[_0x3e5509(0x1c4)]+'*\x0a',_0x4f495b+=_0x3e5509(0x23c)+_0x241ca5[_0x3e5509(0x1fa)]+'`\x0a',_0x4f495b+=_0x3e5509(0x1c1)+_0x241ca5['status']+'\x0a',_0x4f495b+=_0x3e5509(0x1c3)+_0x241ca5[_0x3e5509(0x241)][_0x3e5509(0x1f8)](0x0,0xf)+_0x3e5509(0x184);}),await this[_0x3c8dc9(0x1c6)]?.['sendMessage'](_0x334861,_0x4f495b,{'parse_mode':_0x3c8dc9(0x1c0)});}catch(_0x1b9e29){console['error'](_0x3c8dc9(0x217),_0x1b9e29),await this[_0x3c8dc9(0x1c6)]?.[_0x3c8dc9(0x230)](_0x334861,_0x3c8dc9(0x23e));}}),this[_0x36b270(0x1c6)]['on'](_0x36b270(0x226),async _0x3d304a=>{const _0x1baddf=_0x36b270;if(_0x3d304a[_0x1baddf(0x225)]?.['startsWith']('/'))return;const _0x179f9e=_0x3d304a[_0x1baddf(0x240)]['id'],_0x17f32b=_0x3d304a[_0x1baddf(0x213)]?.['id'][_0x1baddf(0x22c)](),_0x1c007b=_0x3d304a[_0x1baddf(0x225)]?.[_0x1baddf(0x1f3)]();if(!_0x17f32b||!_0x1c007b)return;try{const _0x52295a=await database_1[_0x1baddf(0x219)]['telegramUser']['findUnique']({'where':{'telegramId':_0x17f32b},'include':{'shop':!![]}});if(!_0x52295a){await this['bot']?.[_0x1baddf(0x230)](_0x179f9e,_0x1baddf(0x19a));return;}if(_0x52295a[_0x1baddf(0x18f)]&&_0x52295a[_0x1baddf(0x1b5)]&&_0x52295a[_0x1baddf(0x1a1)]){await this[_0x1baddf(0x1c6)]?.[_0x1baddf(0x230)](_0x179f9e,_0x1baddf(0x227)+_0x52295a[_0x1baddf(0x1a1)][_0x1baddf(0x1c4)]+_0x1baddf(0x20b)+_0x1baddf(0x1f2),{'parse_mode':_0x1baddf(0x1c0)});return;}const _0xedef28=_0x1c007b['split'](/\s+/);if(_0xedef28[_0x1baddf(0x1bd)]!==0x2){await this[_0x1baddf(0x1c6)]?.[_0x1baddf(0x230)](_0x179f9e,_0x1baddf(0x1d8)+_0x1baddf(0x1aa)+_0x1baddf(0x211)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x1baddf(0x198)+_0xedef28['length']+_0x1baddf(0x190)+_0xedef28[_0x1baddf(0x1af)](_0x5a3e58=>'`'+_0x5a3e58+'`')['join'](',\x20')),{'parse_mode':_0x1baddf(0x1c0)});return;}const [_0x176416,_0x16ad4c]=_0xedef28;console[_0x1baddf(0x253)](_0x1baddf(0x200)+_0x17f32b+_0x1baddf(0x1ba)+_0x176416+_0x1baddf(0x24f)+_0x16ad4c['substring'](0x0,0xa)+_0x1baddf(0x182)),await this[_0x1baddf(0x242)](_0x179f9e,_0x17f32b,_0x176416,_0x16ad4c);}catch(_0x4a0b91){console[_0x1baddf(0x1ab)](_0x1baddf(0x238),_0x4a0b91),await this[_0x1baddf(0x1c6)]?.['sendMessage'](_0x179f9e,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x36b270(0x1c6)]['on'](_0x36b270(0x1ab),_0x530990=>{const _0xba94e4=_0x36b270;console[_0xba94e4(0x1ab)](_0xba94e4(0x1f7),_0x530990);}),this[_0x36b270(0x1c6)]['on']('polling_error',_0x28c317=>{const _0x4128ef=_0x36b270;console[_0x4128ef(0x1ab)](_0x4128ef(0x22a),_0x28c317);});}async[a54_0x11e540(0x242)](_0x52c496,_0x31f2e6,_0x537b3e,_0x14db65){const _0x2adffb=a54_0x11e540;try{console[_0x2adffb(0x253)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x31f2e6+':\x20username=\x22'+_0x537b3e+_0x2adffb(0x24f)+_0x14db65[_0x2adffb(0x1f8)](0x0,0xa)+'...\x22');if(!_0x537b3e||_0x537b3e[_0x2adffb(0x1bd)]<0x3||_0x537b3e[_0x2adffb(0x1bd)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x2adffb(0x1cf)](_0x537b3e)){await this[_0x2adffb(0x1c6)]?.[_0x2adffb(0x230)](_0x52c496,'❌\x20Invalid\x20username\x20format:\x20`'+_0x537b3e+_0x2adffb(0x1f4)+_0x2adffb(0x23a),{'parse_mode':_0x2adffb(0x1c0)});return;}if(!_0x14db65||!_0x14db65[_0x2adffb(0x18a)]('pk_')&&!_0x14db65[_0x2adffb(0x18a)](_0x2adffb(0x1d6))){await this[_0x2adffb(0x1c6)]?.[_0x2adffb(0x230)](_0x52c496,_0x2adffb(0x239)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x2adffb(0x1c0)});return;}const _0x1f6c96=await database_1['default'][_0x2adffb(0x1a1)]['findUnique']({'where':{'username':_0x537b3e},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x1f6c96){const _0xa744f0=await database_1[_0x2adffb(0x219)][_0x2adffb(0x1a1)][_0x2adffb(0x1b7)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x36f60d='❌\x20Shop\x20with\x20username\x20`'+_0x537b3e+_0x2adffb(0x1d5);_0xa744f0['length']>0x0?(_0x36f60d+=_0x2adffb(0x245),_0xa744f0[_0x2adffb(0x1db)](_0x4f7f5b=>{const _0x2863d1=_0x2adffb;_0x36f60d+='•\x20`'+_0x4f7f5b[_0x2863d1(0x1fa)]+_0x2863d1(0x1a0)+_0x4f7f5b[_0x2863d1(0x1c4)]+')\x0a';}),_0x36f60d+=_0x2adffb(0x216)):_0x36f60d+=_0x2adffb(0x21a);await this[_0x2adffb(0x1c6)]?.[_0x2adffb(0x230)](_0x52c496,_0x36f60d,{'parse_mode':_0x2adffb(0x1c0)});return;}if(_0x1f6c96[_0x2adffb(0x21e)]!==_0x2adffb(0x18d)){await this['bot']?.[_0x2adffb(0x230)](_0x52c496,_0x2adffb(0x22d)+_0x537b3e+'`\x20is\x20inactive.\x0a\x0a'+_0x2adffb(0x23f),{'parse_mode':_0x2adffb(0x1c0)});return;}if(_0x1f6c96['publicKey']!==_0x14db65&&_0x1f6c96[_0x2adffb(0x24c)]!==_0x14db65){await this[_0x2adffb(0x1c6)]?.[_0x2adffb(0x230)](_0x52c496,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x537b3e+'`.\x0a\x0a'+_0x2adffb(0x1a7)+_0x2adffb(0x22f),{'parse_mode':_0x2adffb(0x1c0)});return;}const _0xc76b8c=await database_1[_0x2adffb(0x219)]['telegramUser'][_0x2adffb(0x24b)]({'where':{'shopId':_0x1f6c96['id'],'isVerified':!![],'telegramId':{'not':_0x31f2e6}}});if(_0xc76b8c){await this[_0x2adffb(0x1c6)]?.[_0x2adffb(0x230)](_0x52c496,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x537b3e+_0x2adffb(0x1c9)+_0x2adffb(0x1dd),{'parse_mode':_0x2adffb(0x1c0)});return;}await database_1['default'][_0x2adffb(0x232)][_0x2adffb(0x222)]({'where':{'telegramId':_0x31f2e6},'data':{'shopId':_0x1f6c96['id'],'isVerified':!![]}}),await this[_0x2adffb(0x1c6)]?.[_0x2adffb(0x230)](_0x52c496,_0x2adffb(0x1da)+_0x2adffb(0x24d)+('📱\x20Shop:\x20*'+_0x1f6c96['name']+'*\x0a')+('👤\x20Username:\x20`'+_0x1f6c96[_0x2adffb(0x1fa)]+_0x2adffb(0x1f4))+_0x2adffb(0x20f)+_0x2adffb(0x220)+'•\x20Payment\x20status\x20changes\x0a'+_0x2adffb(0x1a2)+'•\x20Important\x20events\x0a\x0a'+_0x2adffb(0x19b)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x2adffb(0x1b1),{'parse_mode':'Markdown'}),console[_0x2adffb(0x253)](_0x2adffb(0x1b4)+_0x31f2e6+_0x2adffb(0x24e)+_0x1f6c96[_0x2adffb(0x1fa)]+_0x2adffb(0x207));}catch(_0x2ab063){console[_0x2adffb(0x1ab)](_0x2adffb(0x21f),_0x2ab063),await this['bot']?.['sendMessage'](_0x52c496,_0x2adffb(0x1f5));}}async['sendShopNotification'](_0x13d791,_0x408311,_0xf3ed77){const _0x3dafd1=a54_0x11e540;if(!this['bot']){console[_0x3dafd1(0x19f)](_0x3dafd1(0x255));return;}try{const _0x4c6d13=await database_1[_0x3dafd1(0x219)][_0x3dafd1(0x232)]['findMany']({'where':{'shopId':_0x13d791,'isVerified':!![]}});if(_0x4c6d13[_0x3dafd1(0x1bd)]===0x0){console[_0x3dafd1(0x253)](_0x3dafd1(0x1e0)+_0x13d791);return;}const _0x539681=_0x4c6d13['map'](async _0x30448c=>{const _0x3267c7=_0x3dafd1;try{await this['bot']?.['sendMessage'](_0x30448c[_0x3267c7(0x1be)],_0x408311,_0xf3ed77),console[_0x3267c7(0x253)](_0x3267c7(0x21b)+_0x30448c[_0x3267c7(0x1be)]);}catch(_0x5386ff){console[_0x3267c7(0x1ab)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x30448c[_0x3267c7(0x1be)]+':',_0x5386ff),_0x5386ff instanceof Error&&(_0x5386ff[_0x3267c7(0x226)][_0x3267c7(0x1b3)]('blocked')||_0x5386ff[_0x3267c7(0x226)]['includes'](_0x3267c7(0x19c))||_0x5386ff['message'][_0x3267c7(0x1b3)](_0x3267c7(0x1a3)))&&(await database_1['default'][_0x3267c7(0x232)]['update']({'where':{'id':_0x30448c['id']},'data':{'isVerified':![]}}),console[_0x3267c7(0x253)]('User\x20'+_0x30448c[_0x3267c7(0x1be)]+_0x3267c7(0x19e)));}});await Promise['allSettled'](_0x539681);}catch(_0x2b0010){console[_0x3dafd1(0x1ab)](_0x3dafd1(0x1a8),_0x2b0010);}}async['sendPaymentNotification'](_0x469648,_0x3e4444,_0x4422c0){const _0xf54150=a54_0x11e540,_0x201540={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x3028ff={'created':'New\x20payment\x20created','paid':'Payment\x20successfully\x20paid','failed':'Payment\x20failed','expired':_0xf54150(0x196),'refund':_0xf54150(0x228),'chargeback':_0xf54150(0x20e),'processing':_0xf54150(0x231)},_0xaf72f0=_0x201540[_0x4422c0],_0x523141=_0x3028ff[_0x4422c0],_0x29f00c=(0x0,gateway_1[_0xf54150(0x1bb)])(_0x3e4444['gateway']);console[_0xf54150(0x253)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x3e4444[_0xf54150(0x1ff)]+_0xf54150(0x1d1)+_0x29f00c+'\x22');let _0xcdf41f=_0xaf72f0+'\x20*'+_0x523141+_0xf54150(0x224)+(_0xf54150(0x204)+_0x3e4444['amount']+'\x20'+_0x3e4444[_0xf54150(0x1bf)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x3e4444['orderId']||_0x3e4444['id'])+'`\x0a')+(_0xf54150(0x1cb)+_0x3e4444['id']+'`\x0a')+(_0xf54150(0x218)+_0x29f00c+'`\x0a')+(_0xf54150(0x205)+new Date(_0x3e4444[_0xf54150(0x1a5)])[_0xf54150(0x1b6)](_0xf54150(0x195))+'\x0a');(_0x3e4444[_0xf54150(0x22b)]||_0x3e4444[_0xf54150(0x1a6)])&&(_0xcdf41f+=_0xf54150(0x1f9),_0x3e4444['customerName']&&(_0xcdf41f+='📛\x20Name:\x20`'+_0x3e4444[_0xf54150(0x22b)]+'`\x0a'),_0x3e4444['customerEmail']&&(_0xcdf41f+=_0xf54150(0x1ad)+_0x3e4444[_0xf54150(0x1a6)]+'`\x0a')),_0x4422c0===_0xf54150(0x256)&&_0x3e4444['chargebackAmount']&&(_0xcdf41f+=_0xf54150(0x251)+_0x3e4444[_0xf54150(0x20c)]+'\x20USDT*\x0a'),_0x4422c0===_0xf54150(0x249)&&(_0xcdf41f+=_0xf54150(0x1c2)),_0x3e4444[_0xf54150(0x243)]&&(_0xcdf41f+=_0xf54150(0x254)+_0x3e4444['adminNotes']+'\x0a'),await this[_0xf54150(0x1a4)](_0x469648,_0xcdf41f,{'parse_mode':_0xf54150(0x1c0)});}async['sendPayoutNotification'](_0x4a1d3a,_0x35b56c,_0x234134){const _0x152dba=a54_0x11e540,_0x2dd819={'created':'📤','completed':'✅','rejected':'❌'},_0x306f76={'created':'New\x20payout\x20created','completed':_0x152dba(0x1cc),'rejected':_0x152dba(0x214)},_0x4480d0=_0x2dd819[_0x234134],_0x2c01c8=_0x306f76[_0x234134],_0xb5c952=_0x4480d0+'\x20*'+_0x2c01c8+'*\x0a\x0a'+(_0x152dba(0x18b)+_0x35b56c[_0x152dba(0x235)]+_0x152dba(0x212))+(_0x152dba(0x1ae)+_0x35b56c['method']+'`\x0a')+(_0x152dba(0x1d3)+_0x35b56c['id']+'`\x0a')+(_0x152dba(0x205)+new Date(_0x35b56c['createdAt'])[_0x152dba(0x1b6)](_0x152dba(0x195))+'\x0a')+(_0x35b56c[_0x152dba(0x203)]?'🔗\x20TXID:\x20`'+_0x35b56c[_0x152dba(0x203)]+'`':'');await this[_0x152dba(0x1a4)](_0x4a1d3a,_0xb5c952,{'parse_mode':_0x152dba(0x1c0)});}async[a54_0x11e540(0x1e2)](_0x1ae809,_0x558c19){const _0x10c968=a54_0x11e540;try{const _0x1ddbb1=await database_1[_0x10c968(0x219)][_0x10c968(0x202)][_0x10c968(0x1c5)]({'where':{'shopId':_0x1ae809},'select':{'notificationLogin':!![]}});if(!_0x1ddbb1?.[_0x10c968(0x21c)]){console[_0x10c968(0x253)](_0x10c968(0x1e5)+_0x1ae809);return;}const _0x148885=_0x558c19[_0x10c968(0x250)]?'🔐':'🚨',_0xd12976=_0x558c19[_0x10c968(0x250)]?_0x10c968(0x1f0):'Failed\x20login\x20attempt';let _0x532df2=_0x148885+'\x20*'+_0xd12976+'*\x0a\x0a'+(_0x10c968(0x1c8)+_0x558c19[_0x10c968(0x1fa)]+'`\x0a')+(_0x10c968(0x1eb)+_0x558c19[_0x10c968(0x187)][_0x10c968(0x1b6)]('en-US')+'\x0a');_0x558c19[_0x10c968(0x1ed)]&&(_0x532df2+=_0x10c968(0x1ea)+_0x558c19['ipAddress']+'`\x0a');if(_0x558c19['userAgent']){const _0x2a1b88=_0x558c19['userAgent'][_0x10c968(0x1bd)]>0x32?_0x558c19[_0x10c968(0x1e8)][_0x10c968(0x1f8)](0x0,0x32)+_0x10c968(0x20a):_0x558c19[_0x10c968(0x1e8)];_0x532df2+=_0x10c968(0x1e4)+_0x2a1b88+'`\x0a';}!_0x558c19[_0x10c968(0x250)]&&(_0x532df2+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this['sendShopNotification'](_0x1ae809,_0x532df2,{'parse_mode':'Markdown'}),console[_0x10c968(0x253)](_0x10c968(0x185)+_0x1ae809+':\x20'+(_0x558c19['success']?_0x10c968(0x250):'failed'));}catch(_0x4ec491){console[_0x10c968(0x1ab)](_0x10c968(0x234),_0x4ec491);}}async[a54_0x11e540(0x1ac)](_0x49f6f9,_0xb163a8){const _0x147a46=a54_0x11e540;try{const _0x12bc31=await database_1[_0x147a46(0x219)][_0x147a46(0x202)]['findUnique']({'where':{'shopId':_0x49f6f9},'select':{'notificationApiError':!![]}});if(!_0x12bc31?.['notificationApiError']){console[_0x147a46(0x253)](_0x147a46(0x257)+_0x49f6f9);return;}let _0x382561=_0x147a46(0x252)+('🔗\x20Endpoint:\x20`'+_0xb163a8['method']+'\x20'+_0xb163a8[_0x147a46(0x1c7)]+'`\x0a')+(_0x147a46(0x1eb)+_0xb163a8['timestamp'][_0x147a46(0x1b6)](_0x147a46(0x195))+'\x0a');_0xb163a8[_0x147a46(0x25b)]&&(_0x382561+=_0x147a46(0x258)+_0xb163a8[_0x147a46(0x25b)]+'`\x0a'),_0x382561+=_0x147a46(0x209)+_0xb163a8[_0x147a46(0x1fd)]+'`\x0a',_0xb163a8['requestId']&&(_0x382561+='🆔\x20Request\x20ID:\x20`'+_0xb163a8['requestId']+'`\x0a'),_0x382561+=_0x147a46(0x19d),await this[_0x147a46(0x1a4)](_0x49f6f9,_0x382561,{'parse_mode':_0x147a46(0x1c0)}),console[_0x147a46(0x253)](_0x147a46(0x259)+_0x49f6f9+':\x20'+_0xb163a8[_0x147a46(0x1c7)]);}catch(_0x2266de){console[_0x147a46(0x1ab)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x2266de);}}async[a54_0x11e540(0x1fe)](_0x19da5d,_0x59547d,_0x190cd9){const _0xdc0d09=a54_0x11e540;let _0x51cde0=_0xdc0d09(0x18c)+_0x59547d+'*\x0a\x0a';for(const [_0x198299,_0x292da3]of Object[_0xdc0d09(0x1df)](_0x190cd9)){_0x292da3!==null&&_0x292da3!==undefined&&(_0x51cde0+=_0x198299+':\x20`'+_0x292da3+'`\x0a');}await this[_0xdc0d09(0x1a4)](_0x19da5d,_0x51cde0,{'parse_mode':'Markdown'});}[a54_0x11e540(0x1e7)](){return{'isActive':!!this['bot'],'username':this['botUsername']};}[a54_0x11e540(0x1fb)](){const _0x2db0a5=a54_0x11e540;this[_0x2db0a5(0x1c6)]&&(this[_0x2db0a5(0x1c6)][_0x2db0a5(0x197)](),this['bot']=null,console['log'](_0x2db0a5(0x248)));}}function a54_0x2288(_0x325ba3,_0x1679e2){const _0x6b7783=a54_0x6b77();return a54_0x2288=function(_0x228892,_0x5d6e49){_0x228892=_0x228892-0x181;let _0x270276=_0x6b7783[_0x228892];return _0x270276;},a54_0x2288(_0x325ba3,_0x1679e2);}function a54_0x6b77(){const _0x1a471b=['⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','\x20\x20\x20Public\x20Key:\x20`','name','findUnique','bot','endpoint','👤\x20Username:\x20`','`.\x0a\x0a','../config/database','🆔\x20Payment\x20ID:\x20`','Payout\x20completed','__esModule','first_name','test','telegramBotService','\x22\x20->\x20display\x20\x22','✅\x20Welcome\x20back!\x0a\x0a','🆔\x20Payout\x20ID:\x20`','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','`\x20not\x20found.\x0a\x0a','sk_','\x20initialized\x20successfully','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','🎉\x20*Congratulations!*\x0a\x0a','forEach','unknown\x20shop','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','create','entries','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','botToken','sendLoginNotification','defineProperty','💻\x20Browser:\x20`','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','🔌\x20User\x20','getBotInfo','userAgent','24267nVYXnf','🌐\x20IP\x20address:\x20`','📅\x20Time:\x20','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','ipAddress','setupBotHandlers','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Successful\x20login','__importDefault','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','trim','`\x0a\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','✅\x20Connected\x20to\x20shop:\x20*','Telegram\x20bot\x20error:','substring','\x0a👤\x20*Customer\x20Information:*\x0a','username','stopBot','Error\x20handling\x20/status\x20command:','errorMessage','sendCustomNotification','gateway','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','To\x20reconnect,\x20use\x20the\x20/start\x20command','shopSettings','txid','💰\x20Amount:\x20*','📅\x20Date:\x20','botUsername','\x20via\x20single-line\x20input','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','❌\x20Error:\x20`','...','*.\x0a\x0a','chargebackAmount','initializeBot','Payment\x20chargeback','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','Example:\x0a','\x20USD*\x0a','from','Payout\x20rejected','•\x20Payouts\x0a\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','Error\x20handling\x20/debug\x20command:','🏪\x20Gateway:\x20`','default','Check\x20spelling\x20and\x20try\x20again.','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','notificationLogin','23496990vhahws','status','Error\x20in\x20handleSingleLineVerification:','•\x20New\x20payments\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','update','📅\x20Connection\x20date:\x20','*\x0a\x0a','text','message','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Payment\x20refund','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','Telegram\x20bot\x20polling\x20error:','customerName','toString','❌\x20Shop\x20`','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','sendMessage','Payment\x20is\x20being\x20processed','telegramUser','234lyzTLa','Failed\x20to\x20send\x20login\x20notification:','amount','.\x20*','18920PtzOPS','Error\x20handling\x20message:','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','955290UYfsnS','\x20\x20\x20Username:\x20`','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','❌\x20Error\x20getting\x20debug\x20information.','Contact\x20administrator.','chat','publicKey','handleSingleLineVerification','adminNotes','onText','Available\x20usernames:\x0a','last_name','84iMmcrJ','🛑\x20Telegram\x20bot\x20stopped','processing','•\x20Payment\x20status\x20changes\x0a','findFirst','secretKey','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','\x20verified\x20for\x20shop\x20','\x22,\x20apiKey=\x22','success','💸\x20Penalty\x20amount:\x20*','🚨\x20*API\x20Error*\x0a\x0a','log','📝\x20Notes:\x20','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','chargeback','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','📊\x20Error\x20code:\x20`','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','TelegramBotService','statusCode','toLocaleDateString','🏪\x20Available\x20shops\x20in\x20system:\x0a','...\x22','257470WEyNKi','...`\x0a\x0a','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','\x20disconnected\x20from\x20shop\x20','timestamp','36WnWsSL','env','startsWith','💸\x20Amount:\x20*','🔔\x20*','ACTIVE','TELEGRAM_BOT_TOKEN','isVerified','\x20parts:\x20','updatedAt','node-telegram-bot-api','Use\x20/start\x20to\x20begin.','764669nLaAma','en-US','Payment\x20expired','stopPolling','You\x20sent\x20','Use\x20/start\x20to\x20connect.','❌\x20Please\x20use\x20/start\x20command\x20first','Commands:\x0a','chat\x20not\x20found','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','warn','`\x20(','shop','•\x20Payouts\x0a','user\x20is\x20deactivated','sendShopNotification','createdAt','customerEmail','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','Error\x20sending\x20shop\x20notification:','../types/gateway','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','error','sendApiErrorNotification','📧\x20Email:\x20`','🏦\x20Method:\x20`','map','📊\x20*Connection\x20Status*\x0a\x0a','/disconnect\x20-\x20disconnect\x20from\x20notifications','📱\x20Created\x20new\x20Telegram\x20user:\x20','includes','✅\x20Telegram\x20user\x20','shopId','toLocaleString','findMany','Error\x20handling\x20/start\x20command:','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.',':\x20username=\x22','getGatewayDisplayNameForTelegram','1973139ahDZHm','length','telegramId','currency','Markdown','\x20\x20\x20Status:\x20'];a54_0x6b77=function(){return _0x1a471b;};return a54_0x6b77();}exports[a54_0x11e540(0x25a)]=TelegramBotService,exports[a54_0x11e540(0x1d0)]=new TelegramBotService();