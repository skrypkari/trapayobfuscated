'use strict';const a61_0x1d7b32=a61_0x2fe2;function a61_0x2fe2(_0x1b749f,_0x56916c){const _0x3a0b06=a61_0x3a0b();return a61_0x2fe2=function(_0x2fe230,_0x728d3f){_0x2fe230=_0x2fe230-0x84;let _0x357a7d=_0x3a0b06[_0x2fe230];return _0x357a7d;},a61_0x2fe2(_0x1b749f,_0x56916c);}(function(_0x345d84,_0xe90b27){const _0x1182dc=a61_0x2fe2,_0xfcd76a=_0x345d84();while(!![]){try{const _0x55aab9=parseInt(_0x1182dc(0xfd))/0x1+parseInt(_0x1182dc(0xe6))/0x2*(-parseInt(_0x1182dc(0xd8))/0x3)+-parseInt(_0x1182dc(0xbe))/0x4*(parseInt(_0x1182dc(0x13b))/0x5)+parseInt(_0x1182dc(0x15b))/0x6*(-parseInt(_0x1182dc(0x172))/0x7)+-parseInt(_0x1182dc(0xad))/0x8+parseInt(_0x1182dc(0xde))/0x9*(parseInt(_0x1182dc(0xd2))/0xa)+parseInt(_0x1182dc(0xa0))/0xb;if(_0x55aab9===_0xe90b27)break;else _0xfcd76a['push'](_0xfcd76a['shift']());}catch(_0x528f1e){_0xfcd76a['push'](_0xfcd76a['shift']());}}}(a61_0x3a0b,0x3cf0c));var __importDefault=this&&this[a61_0x1d7b32(0x8c)]||function(_0x4df007){return _0x4df007&&_0x4df007['__esModule']?_0x4df007:{'default':_0x4df007};};function a61_0x3a0b(){const _0x45821c=['test','telegramId','💸\x20Penalty\x20amount:\x20*','sendNotificationToAll','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','bot','requestId','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','✅\x20Telegram\x20user\x20','3036456yEiftV','success','\x20initialized\x20successfully','entries','✅\x20Connected\x20to\x20shop:\x20*','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','username','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','❌\x20Error\x20getting\x20debug\x20information.','Error\x20handling\x20/disconnect\x20command:','__esModule','findUnique','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','📧\x20Email:\x20`','stopPolling','customerEmail','...\x22','156tWCUQd','publicKey','substring','amount','findMany','first_name','Use\x20/start\x20to\x20connect.','📱\x20Telegram\x20notification:\x20gateway\x20\x22','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','\x0a👤\x20*Customer\x20Information:*\x0a','•\x20`','🔌\x20User\x20','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','getGatewayDisplayNameForTelegram','🔔\x20*','\x20\x20\x20Username:\x20`','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Error\x20handling\x20/status\x20command:','❌\x20Shop\x20with\x20username\x20`','430jlHLUO','✅\x20Telegram\x20bot\x20@','forEach','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','remitterIban','gateway','67839KixZmw','❌\x20Invalid\x20username\x20format:\x20`','getBotInfo','log','createdAt','\x20users','36819DZSlAM','📛\x20Name:\x20`','length','📱\x20Your\x20Telegram\x20ID:\x20`','orderId','Error\x20handling\x20message:','.\x20*','📱\x20Created\x20new\x20Telegram\x20user:\x20','28ViCTyH','create','sendShopNotification','onText','\x20\x20\x20Public\x20Key:\x20`','Error\x20sending\x20shop\x20notification:','ipAddress','•\x20New\x20payments\x0a','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','customerName','chat\x20not\x20found','TELEGRAM_BOT_TOKEN','botToken','🛑\x20Telegram\x20bot\x20stopped','🌐\x20IP:\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','Example:\x0a','Contact\x20administrator.','🔔\x20Notifications\x20are\x20active\x0a\x0a','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','updatedAt','processing','`.\x0a\x0a','277512UkzygH','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','📅\x20Date:\x20','default','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','❌\x20Shop\x20`','\x0aCheck\x20spelling\x20and\x20try\x20again.','📝\x20Order\x20ID:\x20`','`\x20not\x20found.\x0a\x0a','botUsername','Successful\x20login','Payment\x20successfully\x20paid','en-US','statusCode','stopBot','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','name','findFirst','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','/status\x20-\x20check\x20connection\x20status\x0a','currency','💰\x20Amount:\x20*','initializeBot','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','timestamp','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','customerIp','Payout\x20rejected','\x20disconnected\x20from\x20shop\x20','status','message','toString','New\x20payment\x20created','Payment\x20failed','includes','sendMessage','TELEGRAM_BOT_USERNAME','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','🏪\x20Gateway:\x20`','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','Markdown','\x22\x20->\x20display\x20\x22',':\x20username=\x22','../config/database','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','🏦\x20Method:\x20`','chat','../types/gateway','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','env','shopSettings','sk_','chargebackAmount','🆔\x20Payout\x20ID:\x20`','💻\x20Browser:\x20`','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','unknown\x20shop','📊\x20*Connection\x20Status*\x0a\x0a','secretKey','25730xvcyxR','toLocaleString','•\x20Payouts\x0a\x0a','errorMessage','\x20via\x20single-line\x20input','🔍\x20*Debug\x20Information*\x0a\x0a','🔗\x20Endpoint:\x20`','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','shop','Error\x20handling\x20/debug\x20command:','*\x0a\x0a','trim','\x20parts:\x20','sendCustomNotification','txid','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','telegramUser','from','setupBotHandlers','notificationLogin','📱\x20Notification\x20sent\x20to\x20','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','defineProperty','sendPayoutNotification','user\x20is\x20deactivated','...','\x20USD*\x0a','Commands:\x0a','📊\x20Error\x20code:\x20`','Failed\x20login\x20attempt','\x20\x20\x20Status:\x20','\x20USDT*\x0a','747258bwUVBY','To\x20reconnect,\x20use\x20the\x20/start\x20command','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','*.\x0a\x0a','error','📱\x20No\x20active\x20Telegram\x20users\x20found','🌐\x20IP\x20address:\x20`','warn','pk_','last_name','🚨\x20*API\x20Error*\x0a\x0a','Telegram\x20bot\x20error:','Check\x20spelling\x20and\x20try\x20again.','•\x20Payouts\x0a','New\x20payout\x20created','text','🆔\x20Payment\x20ID:\x20`','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','method','🔗\x20TXID:\x20`','TelegramBotService','Payout\x20completed','blocked','14bmEtqr','`\x0a\x0a','Error\x20handling\x20/start\x20command:','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','Payment\x20chargeback','Available\x20usernames:\x0a','shopId','userAgent','sendApiErrorNotification','update','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','🏦\x20IBAN:\x20`','polling_error','__importDefault','📅\x20Time:\x20','isVerified','👤\x20Username:\x20`','map','Failed\x20to\x20send\x20API\x20error\x20notification:','toLocaleDateString','customerUa','•\x20Payment\x20status\x20changes\x0a','handleSingleLineVerification','🔔\x20You\x20receive\x20notifications\x20about:\x0a','join',':\x20`','startsWith','❌\x20Please\x20use\x20/start\x20command\x20first','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','adminNotes','telegramBotService','trapay_bot','10363166UulswM','allSettled','\x22,\x20apiKey=\x22','\x20(@'];a61_0x3a0b=function(){return _0x45821c;};return a61_0x3a0b();}Object[a61_0x1d7b32(0x151)](exports,a61_0x1d7b32(0xb7),{'value':!![]}),exports[a61_0x1d7b32(0x9e)]=exports[a61_0x1d7b32(0x16f)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a61_0x1d7b32(0x12a))),gateway_1=require(a61_0x1d7b32(0x12e));class TelegramBotService{constructor(){const _0x24d7d3=a61_0x1d7b32;this[_0x24d7d3(0xa9)]=null,this[_0x24d7d3(0xf2)]=process[_0x24d7d3(0x131)][_0x24d7d3(0xf1)]||'',this[_0x24d7d3(0x106)]=process[_0x24d7d3(0x131)][_0x24d7d3(0x122)]||_0x24d7d3(0x9f),this['botToken']?this[_0x24d7d3(0x113)]():console[_0x24d7d3(0x162)](_0x24d7d3(0x142));}[a61_0x1d7b32(0x113)](){const _0x111c87=a61_0x1d7b32;try{this['bot']=new node_telegram_bot_api_1[(_0x111c87(0x100))](this[_0x111c87(0xf2)],{'polling':!![]}),this[_0x111c87(0x14d)](),console[_0x111c87(0xdb)](_0x111c87(0xd3)+this['botUsername']+_0x111c87(0xaf));}catch(_0x2d8655){console[_0x111c87(0x15f)](_0x111c87(0x175),_0x2d8655);}}[a61_0x1d7b32(0x14d)](){const _0x5e9187=a61_0x1d7b32;if(!this[_0x5e9187(0xa9)])return;this[_0x5e9187(0xa9)][_0x5e9187(0xe9)](/\/start/,async _0x36820e=>{const _0x3ea646=_0x5e9187,_0x799510=_0x36820e[_0x3ea646(0x12d)]['id'],_0x526153=_0x36820e[_0x3ea646(0x14c)]?.['id'][_0x3ea646(0x11d)](),_0x2dfd5d=_0x36820e[_0x3ea646(0x14c)]?.['username'],_0x36e0d7=_0x36820e[_0x3ea646(0x14c)]?.[_0x3ea646(0xc3)],_0x404550=_0x36820e[_0x3ea646(0x14c)]?.[_0x3ea646(0x164)];if(!_0x526153)return;try{let _0x3ad7cd=await database_1['default'][_0x3ea646(0x14b)][_0x3ea646(0xb8)]({'where':{'telegramId':_0x526153},'include':{'shop':!![]}});!_0x3ad7cd?(_0x3ad7cd=await database_1[_0x3ea646(0x100)][_0x3ea646(0x14b)][_0x3ea646(0xe7)]({'data':{'telegramId':_0x526153,'username':_0x2dfd5d,'firstName':_0x36e0d7,'lastName':_0x404550,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x3ea646(0xdb)](_0x3ea646(0xe5)+_0x526153+_0x3ea646(0xa3)+_0x2dfd5d+')')):_0x3ad7cd=await database_1['default'][_0x3ea646(0x14b)][_0x3ea646(0x88)]({'where':{'telegramId':_0x526153},'data':{'username':_0x2dfd5d,'firstName':_0x36e0d7,'lastName':_0x404550},'include':{'shop':!![]}}),_0x3ad7cd['isVerified']&&_0x3ad7cd[_0x3ea646(0x85)]&&_0x3ad7cd[_0x3ea646(0x143)]?await this[_0x3ea646(0xa9)]?.[_0x3ea646(0x121)](_0x799510,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x3ea646(0xc6)+_0x3ad7cd['shop'][_0x3ea646(0x10d)]+'*\x0a')+('Username:\x20`'+_0x3ad7cd[_0x3ea646(0x143)][_0x3ea646(0xb3)]+_0x3ea646(0x173))+_0x3ea646(0x96)+'•\x20New\x20payments\x0a'+_0x3ea646(0x94)+_0x3ea646(0x13d)+_0x3ea646(0x156)+_0x3ea646(0x110)+_0x3ea646(0xf5),{'parse_mode':_0x3ea646(0x127)}):(_0x3ad7cd[_0x3ea646(0x85)]&&!_0x3ad7cd['isVerified']&&(await database_1[_0x3ea646(0x100)]['telegramUser'][_0x3ea646(0x88)]({'where':{'telegramId':_0x526153},'data':{'shopId':null,'isVerified':![]}}),console[_0x3ea646(0xdb)](_0x3ea646(0x10f)+_0x526153)),await this[_0x3ea646(0xa9)]?.[_0x3ea646(0x121)](_0x799510,_0x3ea646(0x12b)+_0x3ea646(0xa8)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x3ea646(0xf6)+_0x3ea646(0xb2)+_0x3ea646(0xd5),{'parse_mode':_0x3ea646(0x127)}));}catch(_0x37cc0f){console[_0x3ea646(0x15f)](_0x3ea646(0x174),_0x37cc0f),await this[_0x3ea646(0xa9)]?.[_0x3ea646(0x121)](_0x799510,_0x3ea646(0x16c));}}),this[_0x5e9187(0xa9)][_0x5e9187(0xe9)](/\/disconnect/,async _0x24cf8f=>{const _0x4bb8e7=_0x5e9187,_0xad61bd=_0x24cf8f['chat']['id'],_0x1b7d78=_0x24cf8f[_0x4bb8e7(0x14c)]?.['id'][_0x4bb8e7(0x11d)]();if(!_0x1b7d78)return;try{const _0xa26cb5=await database_1[_0x4bb8e7(0x100)]['telegramUser']['findUnique']({'where':{'telegramId':_0x1b7d78},'include':{'shop':!![]}});if(!_0xa26cb5||!_0xa26cb5['isVerified']||!_0xa26cb5[_0x4bb8e7(0x85)]){await this[_0x4bb8e7(0xa9)]?.[_0x4bb8e7(0x121)](_0xad61bd,_0x4bb8e7(0x130));return;}const _0x5b0fb1=_0xa26cb5[_0x4bb8e7(0x143)]?.[_0x4bb8e7(0x10d)]||_0x4bb8e7(0x138);await database_1[_0x4bb8e7(0x100)][_0x4bb8e7(0x14b)]['update']({'where':{'telegramId':_0x1b7d78},'data':{'shopId':null,'isVerified':![]}}),console[_0x4bb8e7(0xdb)](_0x4bb8e7(0xc9)+_0x1b7d78+_0x4bb8e7(0x11a)+_0xa26cb5[_0x4bb8e7(0x85)]),await this['bot']?.[_0x4bb8e7(0x121)](_0xad61bd,_0x4bb8e7(0x126)+_0x5b0fb1+'*.\x0a\x0a'+_0x4bb8e7(0x15c),{'parse_mode':'Markdown'});}catch(_0x503cc3){console[_0x4bb8e7(0x15f)](_0x4bb8e7(0xb6),_0x503cc3),await this[_0x4bb8e7(0xa9)]?.[_0x4bb8e7(0x121)](_0xad61bd,_0x4bb8e7(0x16c));}}),this[_0x5e9187(0xa9)][_0x5e9187(0xe9)](/\/status/,async _0x13a2ff=>{const _0x3f443d=_0x5e9187,_0x94c12d=_0x13a2ff[_0x3f443d(0x12d)]['id'],_0x49a947=_0x13a2ff[_0x3f443d(0x14c)]?.['id'][_0x3f443d(0x11d)]();if(!_0x49a947)return;try{const _0x325da2=await database_1[_0x3f443d(0x100)][_0x3f443d(0x14b)][_0x3f443d(0xb8)]({'where':{'telegramId':_0x49a947},'include':{'shop':!![]}});if(!_0x325da2){await this[_0x3f443d(0xa9)]?.[_0x3f443d(0x121)](_0x94c12d,_0x3f443d(0xb4)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x325da2[_0x3f443d(0x8e)]||!_0x325da2[_0x3f443d(0x85)]||!_0x325da2[_0x3f443d(0x143)]){await this['bot']?.[_0x3f443d(0x121)](_0x94c12d,_0x3f443d(0x117)+_0x3f443d(0xc4));return;}await this[_0x3f443d(0xa9)]?.[_0x3f443d(0x121)](_0x94c12d,_0x3f443d(0x139)+(_0x3f443d(0xb1)+_0x325da2[_0x3f443d(0x143)][_0x3f443d(0x10d)]+'*\x0a')+(_0x3f443d(0x8f)+_0x325da2[_0x3f443d(0x143)][_0x3f443d(0xb3)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x325da2[_0x3f443d(0xfa)][_0x3f443d(0x92)](_0x3f443d(0x109))+'\x0a\x0a')+_0x3f443d(0xf8)+_0x3f443d(0x156)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'});}catch(_0x3c8cc0){console['error'](_0x3f443d(0xd0),_0x3c8cc0),await this[_0x3f443d(0xa9)]?.['sendMessage'](_0x94c12d,_0x3f443d(0x16c));}}),this[_0x5e9187(0xa9)][_0x5e9187(0xe9)](/\/debug/,async _0x35c0de=>{const _0x1c08df=_0x5e9187,_0x1d7e04=_0x35c0de['chat']['id'],_0x4046d8=_0x35c0de[_0x1c08df(0x14c)]?.['id']['toString']();if(!_0x4046d8)return;try{const _0x47076b=await database_1[_0x1c08df(0x100)][_0x1c08df(0x143)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x2f651b=_0x1c08df(0x140);_0x2f651b+=_0x1c08df(0xe1)+_0x4046d8+_0x1c08df(0x173),_0x2f651b+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x47076b[_0x1c08df(0xd4)]((_0x2d46bf,_0x400879)=>{const _0x50e773=_0x1c08df;_0x2f651b+=_0x400879+0x1+_0x50e773(0xe4)+_0x2d46bf[_0x50e773(0x10d)]+'*\x0a',_0x2f651b+=_0x50e773(0xce)+_0x2d46bf[_0x50e773(0xb3)]+'`\x0a',_0x2f651b+=_0x50e773(0x159)+_0x2d46bf[_0x50e773(0x11b)]+'\x0a',_0x2f651b+=_0x50e773(0xea)+_0x2d46bf['publicKey'][_0x50e773(0xc0)](0x0,0xf)+'...`\x0a\x0a';}),await this['bot']?.['sendMessage'](_0x1d7e04,_0x2f651b,{'parse_mode':_0x1c08df(0x127)});}catch(_0x15f9ad){console[_0x1c08df(0x15f)](_0x1c08df(0x144),_0x15f9ad),await this[_0x1c08df(0xa9)]?.[_0x1c08df(0x121)](_0x1d7e04,_0x1c08df(0xb5));}}),this['bot']['on'](_0x5e9187(0x11c),async _0x3a430a=>{const _0xb013a8=_0x5e9187;if(_0x3a430a[_0xb013a8(0x16a)]?.[_0xb013a8(0x99)]('/'))return;const _0x289aa7=_0x3a430a[_0xb013a8(0x12d)]['id'],_0x219f34=_0x3a430a[_0xb013a8(0x14c)]?.['id'][_0xb013a8(0x11d)](),_0x2ae646=_0x3a430a[_0xb013a8(0x16a)]?.[_0xb013a8(0x146)]();if(!_0x219f34||!_0x2ae646)return;try{const _0x4d8a78=await database_1[_0xb013a8(0x100)][_0xb013a8(0x14b)][_0xb013a8(0xb8)]({'where':{'telegramId':_0x219f34},'include':{'shop':!![]}});if(!_0x4d8a78){await this[_0xb013a8(0xa9)]?.[_0xb013a8(0x121)](_0x289aa7,_0xb013a8(0x9a));return;}if(_0x4d8a78[_0xb013a8(0x8e)]&&_0x4d8a78[_0xb013a8(0x85)]&&_0x4d8a78['shop']){await this[_0xb013a8(0xa9)]?.['sendMessage'](_0x289aa7,_0xb013a8(0x125)+_0x4d8a78['shop']['name']+_0xb013a8(0x15e)+_0xb013a8(0x150),{'parse_mode':_0xb013a8(0x127)});return;}const _0x2881b8=_0x2ae646['split'](/\s+/);if(_0x2881b8[_0xb013a8(0xe0)]!==0x2){await this[_0xb013a8(0xa9)]?.[_0xb013a8(0x121)](_0x289aa7,_0xb013a8(0x15d)+_0xb013a8(0xcb)+_0xb013a8(0xf6)+_0xb013a8(0xb2)+('You\x20sent\x20'+_0x2881b8[_0xb013a8(0xe0)]+_0xb013a8(0x147)+_0x2881b8[_0xb013a8(0x90)](_0x245631=>'`'+_0x245631+'`')[_0xb013a8(0x97)](',\x20')),{'parse_mode':_0xb013a8(0x127)});return;}const [_0x557a47,_0x54d0c0]=_0x2881b8;console['log'](_0xb013a8(0x115)+_0x219f34+_0xb013a8(0x129)+_0x557a47+_0xb013a8(0xa2)+_0x54d0c0[_0xb013a8(0xc0)](0x0,0xa)+_0xb013a8(0xbd)),await this[_0xb013a8(0x95)](_0x289aa7,_0x219f34,_0x557a47,_0x54d0c0);}catch(_0x3ad137){console[_0xb013a8(0x15f)](_0xb013a8(0xe3),_0x3ad137),await this['bot']?.[_0xb013a8(0x121)](_0x289aa7,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x5e9187(0xa9)]['on'](_0x5e9187(0x15f),_0x4e7599=>{const _0x5ae340=_0x5e9187;console[_0x5ae340(0x15f)](_0x5ae340(0x166),_0x4e7599);}),this[_0x5e9187(0xa9)]['on'](_0x5e9187(0x8b),_0x359219=>{const _0x4445bb=_0x5e9187;console[_0x4445bb(0x15f)]('Telegram\x20bot\x20polling\x20error:',_0x359219);});}async[a61_0x1d7b32(0x95)](_0x1ea3c9,_0x472dde,_0x550b24,_0x234e5c){const _0x52bfaa=a61_0x1d7b32;try{console[_0x52bfaa(0xdb)](_0x52bfaa(0x115)+_0x472dde+':\x20username=\x22'+_0x550b24+_0x52bfaa(0xa2)+_0x234e5c['substring'](0x0,0xa)+'...\x22');if(!_0x550b24||_0x550b24[_0x52bfaa(0xe0)]<0x3||_0x550b24[_0x52bfaa(0xe0)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x52bfaa(0xa4)](_0x550b24)){await this[_0x52bfaa(0xa9)]?.[_0x52bfaa(0x121)](_0x1ea3c9,_0x52bfaa(0xd9)+_0x550b24+_0x52bfaa(0x173)+_0x52bfaa(0xfe),{'parse_mode':'Markdown'});return;}if(!_0x234e5c||!_0x234e5c[_0x52bfaa(0x99)](_0x52bfaa(0x163))&&!_0x234e5c[_0x52bfaa(0x99)](_0x52bfaa(0x133))){await this[_0x52bfaa(0xa9)]?.[_0x52bfaa(0x121)](_0x1ea3c9,_0x52bfaa(0x123)+_0x52bfaa(0x9b),{'parse_mode':_0x52bfaa(0x127)});return;}const _0x74190=await database_1['default']['shop']['findUnique']({'where':{'username':_0x550b24},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x74190){const _0x104f14=await database_1[_0x52bfaa(0x100)]['shop'][_0x52bfaa(0xc2)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0xf6f9fc=_0x52bfaa(0xd1)+_0x550b24+_0x52bfaa(0x105);_0x104f14['length']>0x0?(_0xf6f9fc+=_0x52bfaa(0x84),_0x104f14[_0x52bfaa(0xd4)](_0x4ba95e=>{const _0x587b60=_0x52bfaa;_0xf6f9fc+=_0x587b60(0xc8)+_0x4ba95e[_0x587b60(0xb3)]+'`\x20('+_0x4ba95e[_0x587b60(0x10d)]+')\x0a';}),_0xf6f9fc+=_0x52bfaa(0x103)):_0xf6f9fc+=_0x52bfaa(0x167);await this['bot']?.[_0x52bfaa(0x121)](_0x1ea3c9,_0xf6f9fc,{'parse_mode':'Markdown'});return;}if(_0x74190[_0x52bfaa(0x11b)]!=='ACTIVE'){await this[_0x52bfaa(0xa9)]?.['sendMessage'](_0x1ea3c9,_0x52bfaa(0x102)+_0x550b24+'`\x20is\x20inactive.\x0a\x0a'+_0x52bfaa(0xf7),{'parse_mode':_0x52bfaa(0x127)});return;}if(_0x74190[_0x52bfaa(0xbf)]!==_0x234e5c&&_0x74190[_0x52bfaa(0x13a)]!==_0x234e5c){await this[_0x52bfaa(0xa9)]?.[_0x52bfaa(0x121)](_0x1ea3c9,_0x52bfaa(0xca)+_0x550b24+_0x52bfaa(0xfc)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x52bfaa(0x114),{'parse_mode':_0x52bfaa(0x127)});return;}const _0x562d52=await database_1[_0x52bfaa(0x100)]['telegramUser'][_0x52bfaa(0x10e)]({'where':{'shopId':_0x74190['id'],'isVerified':!![],'telegramId':{'not':_0x472dde}}});if(_0x562d52){await this[_0x52bfaa(0xa9)]?.['sendMessage'](_0x1ea3c9,_0x52bfaa(0x10c)+_0x550b24+_0x52bfaa(0xfc)+_0x52bfaa(0x14a),{'parse_mode':_0x52bfaa(0x127)});return;}await database_1[_0x52bfaa(0x100)][_0x52bfaa(0x14b)][_0x52bfaa(0x88)]({'where':{'telegramId':_0x472dde},'data':{'shopId':_0x74190['id'],'isVerified':!![]}}),await this[_0x52bfaa(0xa9)]?.['sendMessage'](_0x1ea3c9,'🎉\x20*Congratulations!*\x0a\x0a'+_0x52bfaa(0xee)+('📱\x20Shop:\x20*'+_0x74190['name']+'*\x0a')+(_0x52bfaa(0x8f)+_0x74190['username']+_0x52bfaa(0x173))+_0x52bfaa(0x176)+_0x52bfaa(0xed)+'•\x20Payment\x20status\x20changes\x0a'+_0x52bfaa(0x168)+'•\x20Important\x20events\x0a\x0a'+_0x52bfaa(0x156)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x52bfaa(0xf5),{'parse_mode':_0x52bfaa(0x127)}),console['log'](_0x52bfaa(0xac)+_0x472dde+'\x20verified\x20for\x20shop\x20'+_0x74190['username']+_0x52bfaa(0x13f));}catch(_0x48237f){console[_0x52bfaa(0x15f)]('Error\x20in\x20handleSingleLineVerification:',_0x48237f),await this[_0x52bfaa(0xa9)]?.['sendMessage'](_0x1ea3c9,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a61_0x1d7b32(0xe8)](_0x17ed34,_0x1953d3,_0x59b134){const _0x132415=a61_0x1d7b32;if(!this['bot']){console[_0x132415(0x162)](_0x132415(0xf9));return;}try{const _0x399bdd=await database_1[_0x132415(0x100)][_0x132415(0x14b)][_0x132415(0xc2)]({'where':{'shopId':_0x17ed34,'isVerified':!![]}});if(_0x399bdd[_0x132415(0xe0)]===0x0){console[_0x132415(0xdb)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x17ed34);return;}const _0x435631=_0x399bdd[_0x132415(0x90)](async _0x513e70=>{const _0x312a8e=_0x132415;try{await this['bot']?.[_0x312a8e(0x121)](_0x513e70[_0x312a8e(0xa5)],_0x1953d3,_0x59b134),console['log']('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x513e70[_0x312a8e(0xa5)]);}catch(_0x1e3ae4){console[_0x312a8e(0x15f)](_0x312a8e(0x9c)+_0x513e70[_0x312a8e(0xa5)]+':',_0x1e3ae4),_0x1e3ae4 instanceof Error&&(_0x1e3ae4[_0x312a8e(0x11c)][_0x312a8e(0x120)](_0x312a8e(0x171))||_0x1e3ae4['message']['includes'](_0x312a8e(0xf0))||_0x1e3ae4[_0x312a8e(0x11c)][_0x312a8e(0x120)](_0x312a8e(0x153)))&&(await database_1[_0x312a8e(0x100)][_0x312a8e(0x14b)]['update']({'where':{'id':_0x513e70['id']},'data':{'isVerified':![]}}),console[_0x312a8e(0xdb)]('User\x20'+_0x513e70[_0x312a8e(0xa5)]+_0x312a8e(0x137)));}});await Promise[_0x132415(0xa1)](_0x435631);}catch(_0x3573ef){console[_0x132415(0x15f)](_0x132415(0xeb),_0x3573ef);}}async['sendPaymentNotification'](_0x30a156,_0x47cf53,_0x249ba5){const _0x4c8dea=a61_0x1d7b32,_0x45f667={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x131050={'created':_0x4c8dea(0x11e),'paid':_0x4c8dea(0x108),'failed':_0x4c8dea(0x11f),'expired':'Payment\x20expired','refund':'Payment\x20refund','chargeback':_0x4c8dea(0x177),'processing':'Payment\x20is\x20being\x20processed'},_0x28d37b=_0x45f667[_0x249ba5],_0x1ed1f4=_0x131050[_0x249ba5],_0x1d1729=(0x0,gateway_1[_0x4c8dea(0xcc)])(_0x47cf53['gateway']);console[_0x4c8dea(0xdb)](_0x4c8dea(0xc5)+_0x47cf53[_0x4c8dea(0xd7)]+_0x4c8dea(0x128)+_0x1d1729+'\x22');let _0x571e9b=_0x28d37b+'\x20*'+_0x1ed1f4+_0x4c8dea(0x145)+(_0x4c8dea(0x112)+_0x47cf53[_0x4c8dea(0xc1)]+'\x20'+_0x47cf53[_0x4c8dea(0x111)]+'*\x0a')+(_0x4c8dea(0x104)+(_0x47cf53[_0x4c8dea(0xe2)]||_0x47cf53['id'])+'`\x0a')+(_0x4c8dea(0x16b)+_0x47cf53['id']+'`\x0a')+(_0x4c8dea(0x124)+_0x1d1729+'`\x0a')+(_0x4c8dea(0xff)+new Date(_0x47cf53[_0x4c8dea(0xdc)])[_0x4c8dea(0x13c)](_0x4c8dea(0x109))+'\x0a');if(_0x47cf53['customerName']||_0x47cf53[_0x4c8dea(0xbc)]||_0x47cf53[_0x4c8dea(0xd6)]||_0x47cf53[_0x4c8dea(0x118)]||_0x47cf53[_0x4c8dea(0x93)]){_0x571e9b+=_0x4c8dea(0xc7);_0x47cf53[_0x4c8dea(0xef)]&&(_0x571e9b+=_0x4c8dea(0xdf)+_0x47cf53[_0x4c8dea(0xef)]+'`\x0a');_0x47cf53['customerEmail']&&(_0x571e9b+=_0x4c8dea(0xba)+_0x47cf53[_0x4c8dea(0xbc)]+'`\x0a');_0x47cf53[_0x4c8dea(0xd6)]&&(_0x571e9b+=_0x4c8dea(0x8a)+_0x47cf53[_0x4c8dea(0xd6)]+'`\x0a');_0x47cf53['customerIp']&&(_0x571e9b+=_0x4c8dea(0xf4)+_0x47cf53[_0x4c8dea(0x118)]+'`\x0a');if(_0x47cf53[_0x4c8dea(0x93)]){const _0x4a88cd=_0x47cf53['customerUa'][_0x4c8dea(0xe0)]>0x32?_0x47cf53[_0x4c8dea(0x93)][_0x4c8dea(0xc0)](0x0,0x32)+_0x4c8dea(0x154):_0x47cf53[_0x4c8dea(0x93)];_0x571e9b+=_0x4c8dea(0x136)+_0x4a88cd+'`\x0a';}}_0x249ba5==='chargeback'&&_0x47cf53[_0x4c8dea(0x134)]&&(_0x571e9b+=_0x4c8dea(0xa6)+_0x47cf53[_0x4c8dea(0x134)]+_0x4c8dea(0x15a)),_0x249ba5===_0x4c8dea(0xfb)&&(_0x571e9b+=_0x4c8dea(0x89)),_0x47cf53[_0x4c8dea(0x9d)]&&(_0x571e9b+='📝\x20Notes:\x20'+_0x47cf53['adminNotes']+'\x0a'),await this['sendShopNotification'](_0x30a156,_0x571e9b,{'parse_mode':'Markdown'});}async[a61_0x1d7b32(0x152)](_0xe728d7,_0x1ccdc1,_0x3bf1c2){const _0x22c361=a61_0x1d7b32,_0x54f5ec={'created':'📤','completed':'✅','rejected':'❌'},_0x37bb93={'created':_0x22c361(0x169),'completed':_0x22c361(0x170),'rejected':_0x22c361(0x119)},_0x5b7375=_0x54f5ec[_0x3bf1c2],_0x223f18=_0x37bb93[_0x3bf1c2],_0xe051ab=_0x5b7375+'\x20*'+_0x223f18+_0x22c361(0x145)+('💸\x20Amount:\x20*'+_0x1ccdc1[_0x22c361(0xc1)]+_0x22c361(0x155))+(_0x22c361(0x12c)+_0x1ccdc1[_0x22c361(0x16d)]+'`\x0a')+(_0x22c361(0x135)+_0x1ccdc1['id']+'`\x0a')+(_0x22c361(0xff)+new Date(_0x1ccdc1[_0x22c361(0xdc)])[_0x22c361(0x13c)](_0x22c361(0x109))+'\x0a')+(_0x1ccdc1[_0x22c361(0x149)]?_0x22c361(0x16e)+_0x1ccdc1[_0x22c361(0x149)]+'`':'');await this['sendShopNotification'](_0xe728d7,_0xe051ab,{'parse_mode':_0x22c361(0x127)});}async['sendLoginNotification'](_0x14b17e,_0xaec085){const _0x5283ba=a61_0x1d7b32;try{const _0xae0761=await database_1[_0x5283ba(0x100)][_0x5283ba(0x132)][_0x5283ba(0xb8)]({'where':{'shopId':_0x14b17e},'select':{'notificationLogin':!![]}});if(!_0xae0761?.[_0x5283ba(0x14e)]){console[_0x5283ba(0xdb)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x14b17e);return;}const _0x422590=_0xaec085['success']?'🔐':'🚨',_0x3812fe=_0xaec085['success']?_0x5283ba(0x107):_0x5283ba(0x158);let _0x4da5ea=_0x422590+'\x20*'+_0x3812fe+_0x5283ba(0x145)+('👤\x20Username:\x20`'+_0xaec085[_0x5283ba(0xb3)]+'`\x0a')+(_0x5283ba(0x8d)+_0xaec085[_0x5283ba(0x116)][_0x5283ba(0x13c)]('en-US')+'\x0a');_0xaec085[_0x5283ba(0xec)]&&(_0x4da5ea+=_0x5283ba(0x161)+_0xaec085[_0x5283ba(0xec)]+'`\x0a');if(_0xaec085[_0x5283ba(0x86)]){const _0x21fef2=_0xaec085[_0x5283ba(0x86)][_0x5283ba(0xe0)]>0x32?_0xaec085['userAgent'][_0x5283ba(0xc0)](0x0,0x32)+'...':_0xaec085[_0x5283ba(0x86)];_0x4da5ea+=_0x5283ba(0x136)+_0x21fef2+'`\x0a';}!_0xaec085['success']&&(_0x4da5ea+=_0x5283ba(0xb9)),await this['sendShopNotification'](_0x14b17e,_0x4da5ea,{'parse_mode':_0x5283ba(0x127)}),console['log'](_0x5283ba(0x12f)+_0x14b17e+':\x20'+(_0xaec085['success']?_0x5283ba(0xae):'failed'));}catch(_0x49acfe){console[_0x5283ba(0x15f)]('Failed\x20to\x20send\x20login\x20notification:',_0x49acfe);}}async[a61_0x1d7b32(0x87)](_0x366552,_0x34ade5){const _0x17fcc2=a61_0x1d7b32;try{const _0x305306=await database_1[_0x17fcc2(0x100)][_0x17fcc2(0x132)][_0x17fcc2(0xb8)]({'where':{'shopId':_0x366552},'select':{'notificationApiError':!![]}});if(!_0x305306?.['notificationApiError']){console[_0x17fcc2(0xdb)](_0x17fcc2(0xcf)+_0x366552);return;}let _0x15642f=_0x17fcc2(0x165)+(_0x17fcc2(0x141)+_0x34ade5['method']+'\x20'+_0x34ade5['endpoint']+'`\x0a')+(_0x17fcc2(0x8d)+_0x34ade5['timestamp'][_0x17fcc2(0x13c)]('en-US')+'\x0a');_0x34ade5['statusCode']&&(_0x15642f+=_0x17fcc2(0x157)+_0x34ade5[_0x17fcc2(0x10a)]+'`\x0a'),_0x15642f+='❌\x20Error:\x20`'+_0x34ade5[_0x17fcc2(0x13e)]+'`\x0a',_0x34ade5[_0x17fcc2(0xaa)]&&(_0x15642f+='🆔\x20Request\x20ID:\x20`'+_0x34ade5[_0x17fcc2(0xaa)]+'`\x0a'),_0x15642f+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this['sendShopNotification'](_0x366552,_0x15642f,{'parse_mode':_0x17fcc2(0x127)}),console[_0x17fcc2(0xdb)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x366552+':\x20'+_0x34ade5['endpoint']);}catch(_0x376678){console[_0x17fcc2(0x15f)](_0x17fcc2(0x91),_0x376678);}}async[a61_0x1d7b32(0x148)](_0x444319,_0x2ee174,_0x51e153){const _0x455a1e=a61_0x1d7b32;let _0x5ad00c=_0x455a1e(0xcd)+_0x2ee174+_0x455a1e(0x145);for(const [_0x1d15fe,_0x5753de]of Object[_0x455a1e(0xb0)](_0x51e153)){_0x5753de!==null&&_0x5753de!==undefined&&(_0x5ad00c+=_0x1d15fe+_0x455a1e(0x98)+_0x5753de+'`\x0a');}await this[_0x455a1e(0xe8)](_0x444319,_0x5ad00c,{'parse_mode':_0x455a1e(0x127)});}async[a61_0x1d7b32(0xa7)](_0x5ccaaa){const _0x4f8ac8=a61_0x1d7b32;try{console[_0x4f8ac8(0xdb)]('📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20'+_0x5ccaaa[_0x4f8ac8(0xc0)](0x0,0x32)+_0x4f8ac8(0x154));const _0x41acf9=await database_1[_0x4f8ac8(0x100)][_0x4f8ac8(0x14b)]['findMany']({'select':{'telegramId':!![]}});if(_0x41acf9[_0x4f8ac8(0xe0)]===0x0){console[_0x4f8ac8(0xdb)](_0x4f8ac8(0x160));return;}for(const _0x171546 of _0x41acf9){try{await this['bot']?.[_0x4f8ac8(0x121)](_0x171546['telegramId'],_0x5ccaaa,{'parse_mode':_0x4f8ac8(0x127)});}catch(_0x3d2d8c){console['error'](_0x4f8ac8(0xab)+_0x171546[_0x4f8ac8(0xa5)]+':',_0x3d2d8c);}}console[_0x4f8ac8(0xdb)](_0x4f8ac8(0x14f)+_0x41acf9[_0x4f8ac8(0xe0)]+_0x4f8ac8(0xdd));}catch(_0x41fc74){console[_0x4f8ac8(0x15f)](_0x4f8ac8(0x101),_0x41fc74);}}[a61_0x1d7b32(0xda)](){const _0x1ba63d=a61_0x1d7b32;return{'isActive':!!this[_0x1ba63d(0xa9)],'username':this['botUsername']};}[a61_0x1d7b32(0x10b)](){const _0x273044=a61_0x1d7b32;this[_0x273044(0xa9)]&&(this[_0x273044(0xa9)][_0x273044(0xbb)](),this[_0x273044(0xa9)]=null,console[_0x273044(0xdb)](_0x273044(0xf3)));}}exports['TelegramBotService']=TelegramBotService,exports[a61_0x1d7b32(0x9e)]=new TelegramBotService();