'use strict';const a66_0x416245=a66_0x991a;(function(_0x35c2f4,_0x2c70f5){const _0x3611ec=a66_0x991a,_0x308acd=_0x35c2f4();while(!![]){try{const _0x428d08=-parseInt(_0x3611ec(0xd0))/0x1+parseInt(_0x3611ec(0x107))/0x2*(parseInt(_0x3611ec(0x102))/0x3)+-parseInt(_0x3611ec(0x140))/0x4+parseInt(_0x3611ec(0xc3))/0x5+parseInt(_0x3611ec(0x81))/0x6+-parseInt(_0x3611ec(0x112))/0x7+parseInt(_0x3611ec(0x74))/0x8*(-parseInt(_0x3611ec(0x96))/0x9);if(_0x428d08===_0x2c70f5)break;else _0x308acd['push'](_0x308acd['shift']());}catch(_0x9913fa){_0x308acd['push'](_0x308acd['shift']());}}}(a66_0x1ef2,0x3d480));var __importDefault=this&&this[a66_0x416245(0xa5)]||function(_0x9e89c1){const _0x11bec7=a66_0x416245;return _0x9e89c1&&_0x9e89c1[_0x11bec7(0xe0)]?_0x9e89c1:{'default':_0x9e89c1};};function a66_0x1ef2(){const _0x16f7b2=['en-US','endsWith','toLocaleDateString','last_name','🏦\x20IBAN:\x20`','sendDirectMessage','__importDefault','Payment\x20is\x20being\x20processed','onText','\x20USD*\x0a','amount','🔗\x20TXID:\x20`','Error\x20handling\x20/debug\x20command:','sendDocument','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','ipAddress','sendShopFile','remitterIban','\x20\x20\x20Status:\x20','status','Error\x20handling\x20/disconnect\x20command:','trim','errorMessage','\x20(@','polling_error','`\x20is\x20inactive.\x0a\x0a','telegramUser','telegramId','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','initializeBot','\x0aCheck\x20spelling\x20and\x20try\x20again.','🔌\x20User\x20','customerName','text','allSettled','1176475YhycAM','👤\x20Username:\x20`','statusCode','...','TELEGRAM_BOT_USERNAME','chat','ACTIVE','`.\x0a\x0a','❌\x20Error\x20sending\x20file\x20to\x20chat:','failed','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','\x20\x20\x20Username:\x20`','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','90751BhvvyB','test','Successful\x20login','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','shopId','method','/status\x20-\x20check\x20connection\x20status\x0a','🏪\x20Available\x20shops\x20in\x20system:\x0a','.jpeg','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','/disconnect\x20-\x20disconnect\x20from\x20notifications','❌\x20Error\x20getting\x20debug\x20information.','•\x20Important\x20events\x0a\x0a','🛑\x20Telegram\x20bot\x20stopped','trapay_bot','entries','__esModule','username','endpoint',':\x20username=\x22','Payout\x20rejected','substring','Payout\x20completed','❌\x20Error\x20sending\x20file\x20to\x20user\x20','blocked','sendShopNotification','📅\x20Connection\x20date:\x20','\x20users\x20of\x20shop\x20','adminNotes','customerEmail','\x22\x20->\x20display\x20\x22','Check\x20spelling\x20and\x20try\x20again.','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','*\x0a\x0a','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','•\x20New\x20payments\x0a','success','timestamp','shop','Error\x20handling\x20/start\x20command:','chargeback','sendLoginNotification','botToken','default','🆔\x20Payout\x20ID:\x20`','Payment\x20failed','warn','user\x20is\x20deactivated','🚨\x20*API\x20Error*\x0a\x0a','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','1219584RmMAHS','...`\x0a\x0a','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Commands:\x0a','name','2hSuDVq','📝\x20Notes:\x20','New\x20payment\x20created','notificationLogin','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','image/jpeg','sendCustomNotification','•\x20Payouts\x0a','findUnique','Username:\x20`','User\x20','274274JfQFvq','Payment\x20chargeback','💻\x20Browser:\x20`','userAgent','✅\x20Telegram\x20user\x20','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','error','Telegram\x20bot\x20polling\x20error:','length','map','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','`\x20(','Contact\x20administrator.','Payment\x20refund','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','.\x20*','❌\x20Telegram\x20bot\x20not\x20initialized','📊\x20Error\x20code:\x20`','📧\x20Email:\x20`','updatedAt','log','❌\x20Error:\x20`','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','•\x20Payment\x20status\x20changes\x0a','🏪\x20Gateway:\x20`','secretKey','🔔\x20*','*.\x0a\x0a','customerIp','stopBot','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','first_name','from','getGatewayDisplayNameForTelegram','toString','env','\x20via\x20single-line\x20input','🆔\x20Request\x20ID:\x20`','\x22,\x20apiKey=\x22','Markdown','•\x20`','.jpg','❌\x20Shop\x20`','handleSingleLineVerification','...\x22','💰\x20Amount:\x20*','826944WTpohC','`\x0a\x0a','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','customerUa','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','txid','pk_','Error\x20in\x20handleSingleLineVerification:','💸\x20Penalty\x20amount:\x20*','update','Available\x20usernames:\x0a','.pdf','Failed\x20to\x20send\x20login\x20notification:','split','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','findFirst','TelegramBotService','Error\x20handling\x20message:','Error\x20sending\x20shop\x20notification:','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','unknown\x20shop','✅\x20Welcome\x20back!\x0a\x0a','📅\x20Date:\x20','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','❌\x20Shop\x20with\x20username\x20`','🆔\x20Payment\x20ID:\x20`','forEach','getBotInfo','.png','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','toLocaleString','Failed\x20login\x20attempt','❌\x20Error\x20sending\x20file\x20to\x20shop:','botUsername','💸\x20Amount:\x20*','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','\x0a👤\x20*Customer\x20Information:*\x0a','application/pdf','image/png','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','bot','72920hnhEqt','✅\x20File\x20sent\x20to\x20chat\x20','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','\x20parts:\x20','✅\x20File\x20sent\x20to\x20','stopPolling','application/octet-stream','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','🔔\x20You\x20receive\x20notifications\x20about:\x0a','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','currency','../types/gateway','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','1206444GooqXj','defineProperty','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','📛\x20Name:\x20`','❌\x20Error\x20sending\x20direct\x20message:','sendDirectFile','🏦\x20Method:\x20`','\x20USDT*\x0a','telegramBotService','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','message','findMany','Example:\x0a','`\x20not\x20found.\x0a\x0a','startsWith','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','sendMessage','includes','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','requestId','252XdSwgH','chargebackAmount','createdAt','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','isVerified','sendPaymentNotification','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'];a66_0x1ef2=function(){return _0x16f7b2;};return a66_0x1ef2();}function a66_0x991a(_0x3442e2,_0x1bff94){const _0x1ef2c6=a66_0x1ef2();return a66_0x991a=function(_0x991aca,_0x1609b8){_0x991aca=_0x991aca-0x70;let _0x9a6dfa=_0x1ef2c6[_0x991aca];return _0x9a6dfa;},a66_0x991a(_0x3442e2,_0x1bff94);}Object[a66_0x416245(0x82)](exports,a66_0x416245(0xe0),{'value':!![]}),exports[a66_0x416245(0x8a)]=exports[a66_0x416245(0x150)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require('../config/database')),gateway_1=require(a66_0x416245(0x7f));class TelegramBotService{constructor(){const _0x227f73=a66_0x416245;this['bot']=null,this[_0x227f73(0xfa)]=process[_0x227f73(0x135)]['TELEGRAM_BOT_TOKEN']||'',this[_0x227f73(0x161)]=process[_0x227f73(0x135)][_0x227f73(0xc7)]||_0x227f73(0xde),this[_0x227f73(0xfa)]?this[_0x227f73(0xbd)]():console[_0x227f73(0xfe)](_0x227f73(0x101));}[a66_0x416245(0xbd)](){const _0x5ab825=a66_0x416245;try{this[_0x5ab825(0x73)]=new node_telegram_bot_api_1[(_0x5ab825(0xfb))](this['botToken'],{'polling':!![]}),this['setupBotHandlers'](),console[_0x5ab825(0x126)]('✅\x20Telegram\x20bot\x20@'+this[_0x5ab825(0x161)]+'\x20initialized\x20successfully');}catch(_0x35667d){console[_0x5ab825(0x118)](_0x5ab825(0x130),_0x35667d);}}['setupBotHandlers'](){const _0x547d37=a66_0x416245;if(!this[_0x547d37(0x73)])return;this['bot'][_0x547d37(0xa7)](/\/start/,async _0x37a7e6=>{const _0x19e159=_0x547d37,_0x58544e=_0x37a7e6['chat']['id'],_0x2bd069=_0x37a7e6[_0x19e159(0x132)]?.['id'][_0x19e159(0x134)](),_0x394d8c=_0x37a7e6[_0x19e159(0x132)]?.['username'],_0x4bfa7d=_0x37a7e6[_0x19e159(0x132)]?.[_0x19e159(0x131)],_0x584140=_0x37a7e6['from']?.[_0x19e159(0xa2)];if(!_0x2bd069)return;try{let _0x65ac02=await database_1['default'][_0x19e159(0xb9)]['findUnique']({'where':{'telegramId':_0x2bd069},'include':{'shop':!![]}});!_0x65ac02?(_0x65ac02=await database_1[_0x19e159(0xfb)]['telegramUser']['create']({'data':{'telegramId':_0x2bd069,'username':_0x394d8c,'firstName':_0x4bfa7d,'lastName':_0x584140,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x19e159(0x126)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x2bd069+_0x19e159(0xb6)+_0x394d8c+')')):_0x65ac02=await database_1['default'][_0x19e159(0xb9)][_0x19e159(0x149)]({'where':{'telegramId':_0x2bd069},'data':{'username':_0x394d8c,'firstName':_0x4bfa7d,'lastName':_0x584140},'include':{'shop':!![]}}),_0x65ac02[_0x19e159(0x9b)]&&_0x65ac02[_0x19e159(0xd4)]&&_0x65ac02[_0x19e159(0xf6)]?await this['bot']?.[_0x19e159(0x92)](_0x58544e,_0x19e159(0x155)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x65ac02[_0x19e159(0xf6)]['name']+'*\x0a')+(_0x19e159(0x110)+_0x65ac02['shop'][_0x19e159(0xe1)]+_0x19e159(0x141))+_0x19e159(0x7c)+_0x19e159(0xf3)+_0x19e159(0x129)+'•\x20Payouts\x0a\x0a'+_0x19e159(0x105)+_0x19e159(0xd6)+_0x19e159(0xda),{'parse_mode':_0x19e159(0x139)}):(_0x65ac02[_0x19e159(0xd4)]&&!_0x65ac02[_0x19e159(0x9b)]&&(await database_1[_0x19e159(0xfb)][_0x19e159(0xb9)][_0x19e159(0x149)]({'where':{'telegramId':_0x2bd069},'data':{'shopId':null,'isVerified':![]}}),console[_0x19e159(0x126)](_0x19e159(0x7b)+_0x2bd069)),await this[_0x19e159(0x73)]?.[_0x19e159(0x92)](_0x58544e,_0x19e159(0x14e)+_0x19e159(0x104)+_0x19e159(0x128)+_0x19e159(0x8e)+_0x19e159(0x99)+_0x19e159(0x9a),{'parse_mode':_0x19e159(0x139)}));}catch(_0x5e9f88){console[_0x19e159(0x118)](_0x19e159(0xf7),_0x5e9f88),await this['bot']?.[_0x19e159(0x92)](_0x58544e,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x547d37(0x73)][_0x547d37(0xa7)](/\/disconnect/,async _0x7fd44e=>{const _0x148290=_0x547d37,_0x2a2cee=_0x7fd44e[_0x148290(0xc8)]['id'],_0xfa3231=_0x7fd44e[_0x148290(0x132)]?.['id']['toString']();if(!_0xfa3231)return;try{const _0x52263b=await database_1[_0x148290(0xfb)][_0x148290(0xb9)][_0x148290(0x10f)]({'where':{'telegramId':_0xfa3231},'include':{'shop':!![]}});if(!_0x52263b||!_0x52263b['isVerified']||!_0x52263b[_0x148290(0xd4)]){await this['bot']?.[_0x148290(0x92)](_0x2a2cee,_0x148290(0x144));return;}const _0x24f47d=_0x52263b[_0x148290(0xf6)]?.[_0x148290(0x106)]||_0x148290(0x154);await database_1[_0x148290(0xfb)]['telegramUser'][_0x148290(0x149)]({'where':{'telegramId':_0xfa3231},'data':{'shopId':null,'isVerified':![]}}),console[_0x148290(0x126)](_0x148290(0xbf)+_0xfa3231+'\x20disconnected\x20from\x20shop\x20'+_0x52263b[_0x148290(0xd4)]),await this[_0x148290(0x73)]?.['sendMessage'](_0x2a2cee,_0x148290(0xcd)+_0x24f47d+_0x148290(0x12d)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x148290(0x139)});}catch(_0x29ff43){console['error'](_0x148290(0xb3),_0x29ff43),await this[_0x148290(0x73)]?.[_0x148290(0x92)](_0x2a2cee,_0x148290(0xd9));}}),this['bot'][_0x547d37(0xa7)](/\/status/,async _0x51665c=>{const _0x4ef35e=_0x547d37,_0xb9451d=_0x51665c['chat']['id'],_0x1189a1=_0x51665c[_0x4ef35e(0x132)]?.['id'][_0x4ef35e(0x134)]();if(!_0x1189a1)return;try{const _0x1d5b4a=await database_1['default'][_0x4ef35e(0xb9)][_0x4ef35e(0x10f)]({'where':{'telegramId':_0x1189a1},'include':{'shop':!![]}});if(!_0x1d5b4a){await this[_0x4ef35e(0x73)]?.['sendMessage'](_0xb9451d,_0x4ef35e(0x11c)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x1d5b4a[_0x4ef35e(0x9b)]||!_0x1d5b4a['shopId']||!_0x1d5b4a['shop']){await this['bot']?.[_0x4ef35e(0x92)](_0xb9451d,_0x4ef35e(0x120)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x4ef35e(0x73)]?.[_0x4ef35e(0x92)](_0xb9451d,'📊\x20*Connection\x20Status*\x0a\x0a'+('✅\x20Connected\x20to\x20shop:\x20*'+_0x1d5b4a[_0x4ef35e(0xf6)][_0x4ef35e(0x106)]+'*\x0a')+(_0x4ef35e(0xc4)+_0x1d5b4a[_0x4ef35e(0xf6)][_0x4ef35e(0xe1)]+'`\x0a')+(_0x4ef35e(0xea)+_0x1d5b4a[_0x4ef35e(0x125)][_0x4ef35e(0xa1)](_0x4ef35e(0x9f))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+_0x4ef35e(0x105)+_0x4ef35e(0xda),{'parse_mode':_0x4ef35e(0x139)});}catch(_0x2df72d){console['error']('Error\x20handling\x20/status\x20command:',_0x2df72d),await this[_0x4ef35e(0x73)]?.[_0x4ef35e(0x92)](_0xb9451d,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x547d37(0x73)][_0x547d37(0xa7)](/\/debug/,async _0x5d0942=>{const _0x262df9=_0x547d37,_0x44ee03=_0x5d0942['chat']['id'],_0x35724e=_0x5d0942[_0x262df9(0x132)]?.['id'][_0x262df9(0x134)]();if(!_0x35724e)return;try{const _0x3cd600=await database_1[_0x262df9(0xfb)][_0x262df9(0xf6)][_0x262df9(0x8d)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x3aa2f7='🔍\x20*Debug\x20Information*\x0a\x0a';_0x3aa2f7+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x35724e+_0x262df9(0x141),_0x3aa2f7+=_0x262df9(0xd7),_0x3cd600[_0x262df9(0x15a)]((_0x5f3eed,_0x5ef70b)=>{const _0x5b5cb5=_0x262df9;_0x3aa2f7+=_0x5ef70b+0x1+_0x5b5cb5(0x121)+_0x5f3eed[_0x5b5cb5(0x106)]+'*\x0a',_0x3aa2f7+=_0x5b5cb5(0xce)+_0x5f3eed['username']+'`\x0a',_0x3aa2f7+=_0x5b5cb5(0xb1)+_0x5f3eed[_0x5b5cb5(0xb2)]+'\x0a',_0x3aa2f7+='\x20\x20\x20Public\x20Key:\x20`'+_0x5f3eed['publicKey']['substring'](0x0,0xf)+_0x5b5cb5(0x103);}),await this[_0x262df9(0x73)]?.[_0x262df9(0x92)](_0x44ee03,_0x3aa2f7,{'parse_mode':_0x262df9(0x139)});}catch(_0x2320aa){console[_0x262df9(0x118)](_0x262df9(0xab),_0x2320aa),await this[_0x262df9(0x73)]?.[_0x262df9(0x92)](_0x44ee03,_0x262df9(0xdb));}}),this[_0x547d37(0x73)]['on'](_0x547d37(0x8c),async _0x37ecba=>{const _0x3323ba=_0x547d37;if(_0x37ecba[_0x3323ba(0xc1)]?.[_0x3323ba(0x90)]('/'))return;const _0x15ca0b=_0x37ecba[_0x3323ba(0xc8)]['id'],_0x26d968=_0x37ecba[_0x3323ba(0x132)]?.['id']['toString'](),_0x1d68fa=_0x37ecba[_0x3323ba(0xc1)]?.[_0x3323ba(0xb4)]();if(!_0x26d968||!_0x1d68fa)return;try{const _0x2a444d=await database_1[_0x3323ba(0xfb)][_0x3323ba(0xb9)][_0x3323ba(0x10f)]({'where':{'telegramId':_0x26d968},'include':{'shop':!![]}});if(!_0x2a444d){await this[_0x3323ba(0x73)]?.['sendMessage'](_0x15ca0b,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x2a444d[_0x3323ba(0x9b)]&&_0x2a444d[_0x3323ba(0xd4)]&&_0x2a444d[_0x3323ba(0xf6)]){await this[_0x3323ba(0x73)]?.['sendMessage'](_0x15ca0b,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x2a444d[_0x3323ba(0xf6)][_0x3323ba(0x106)]+_0x3323ba(0x12d)+_0x3323ba(0x76),{'parse_mode':_0x3323ba(0x139)});return;}const _0x5d0a16=_0x1d68fa[_0x3323ba(0x14d)](/\s+/);if(_0x5d0a16[_0x3323ba(0x11a)]!==0x2){await this[_0x3323ba(0x73)]?.[_0x3323ba(0x92)](_0x15ca0b,_0x3323ba(0x9e)+_0x3323ba(0x128)+'Example:\x0a'+_0x3323ba(0x99)+('You\x20sent\x20'+_0x5d0a16[_0x3323ba(0x11a)]+_0x3323ba(0x77)+_0x5d0a16['map'](_0x39f86a=>'`'+_0x39f86a+'`')['join'](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x5e9a33,_0x4abc2b]=_0x5d0a16;console[_0x3323ba(0x126)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x26d968+_0x3323ba(0xe3)+_0x5e9a33+_0x3323ba(0x138)+_0x4abc2b[_0x3323ba(0xe5)](0x0,0xa)+_0x3323ba(0x13e)),await this[_0x3323ba(0x13d)](_0x15ca0b,_0x26d968,_0x5e9a33,_0x4abc2b);}catch(_0x45c559){console[_0x3323ba(0x118)](_0x3323ba(0x151),_0x45c559),await this[_0x3323ba(0x73)]?.['sendMessage'](_0x15ca0b,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['on'](_0x547d37(0x118),_0x20bec7=>{const _0x3dc172=_0x547d37;console[_0x3dc172(0x118)]('Telegram\x20bot\x20error:',_0x20bec7);}),this[_0x547d37(0x73)]['on'](_0x547d37(0xb7),_0x865abb=>{const _0x98ca89=_0x547d37;console[_0x98ca89(0x118)](_0x98ca89(0x119),_0x865abb);});}async['handleSingleLineVerification'](_0x23b8bc,_0xbee66c,_0x3ffde4,_0x33b997){const _0x40227a=a66_0x416245;try{console[_0x40227a(0x126)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0xbee66c+':\x20username=\x22'+_0x3ffde4+_0x40227a(0x138)+_0x33b997['substring'](0x0,0xa)+_0x40227a(0x13e));if(!_0x3ffde4||_0x3ffde4[_0x40227a(0x11a)]<0x3||_0x3ffde4[_0x40227a(0x11a)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x40227a(0xd1)](_0x3ffde4)){await this['bot']?.[_0x40227a(0x92)](_0x23b8bc,'❌\x20Invalid\x20username\x20format:\x20`'+_0x3ffde4+'`\x0a\x0a'+_0x40227a(0x9d),{'parse_mode':_0x40227a(0x139)});return;}if(!_0x33b997||!_0x33b997['startsWith'](_0x40227a(0x146))&&!_0x33b997[_0x40227a(0x90)]('sk_')){await this[_0x40227a(0x73)]?.[_0x40227a(0x92)](_0x23b8bc,_0x40227a(0x7d)+_0x40227a(0xcf),{'parse_mode':'Markdown'});return;}const _0x48d3ec=await database_1[_0x40227a(0xfb)][_0x40227a(0xf6)]['findUnique']({'where':{'username':_0x3ffde4},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x48d3ec){const _0x3a33c0=await database_1['default'][_0x40227a(0xf6)][_0x40227a(0x8d)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0xa19965=_0x40227a(0x158)+_0x3ffde4+_0x40227a(0x8f);_0x3a33c0[_0x40227a(0x11a)]>0x0?(_0xa19965+=_0x40227a(0x14a),_0x3a33c0[_0x40227a(0x15a)](_0x2931bd=>{const _0x508e15=_0x40227a;_0xa19965+=_0x508e15(0x13a)+_0x2931bd[_0x508e15(0xe1)]+_0x508e15(0x11d)+_0x2931bd[_0x508e15(0x106)]+')\x0a';}),_0xa19965+=_0x40227a(0xbe)):_0xa19965+=_0x40227a(0xef);await this[_0x40227a(0x73)]?.['sendMessage'](_0x23b8bc,_0xa19965,{'parse_mode':_0x40227a(0x139)});return;}if(_0x48d3ec['status']!==_0x40227a(0xc9)){await this[_0x40227a(0x73)]?.[_0x40227a(0x92)](_0x23b8bc,_0x40227a(0x13c)+_0x3ffde4+_0x40227a(0xb8)+_0x40227a(0x11e),{'parse_mode':_0x40227a(0x139)});return;}if(_0x48d3ec['publicKey']!==_0x33b997&&_0x48d3ec[_0x40227a(0x12b)]!==_0x33b997){await this[_0x40227a(0x73)]?.[_0x40227a(0x92)](_0x23b8bc,_0x40227a(0xf0)+_0x3ffde4+_0x40227a(0xca)+_0x40227a(0x80)+_0x40227a(0xd3),{'parse_mode':_0x40227a(0x139)});return;}const _0x57c826=await database_1[_0x40227a(0xfb)][_0x40227a(0xb9)][_0x40227a(0x14f)]({'where':{'shopId':_0x48d3ec['id'],'isVerified':!![],'telegramId':{'not':_0xbee66c}}});if(_0x57c826){await this[_0x40227a(0x73)]?.[_0x40227a(0x92)](_0x23b8bc,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x3ffde4+_0x40227a(0xca)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x40227a(0x139)});return;}await database_1[_0x40227a(0xfb)][_0x40227a(0xb9)][_0x40227a(0x149)]({'where':{'telegramId':_0xbee66c},'data':{'shopId':_0x48d3ec['id'],'isVerified':!![]}}),await this[_0x40227a(0x73)]?.[_0x40227a(0x92)](_0x23b8bc,'🎉\x20*Congratulations!*\x0a\x0a'+_0x40227a(0x83)+('📱\x20Shop:\x20*'+_0x48d3ec[_0x40227a(0x106)]+'*\x0a')+(_0x40227a(0xc4)+_0x48d3ec[_0x40227a(0xe1)]+'`\x0a\x0a')+_0x40227a(0x84)+'•\x20New\x20payments\x0a'+_0x40227a(0x129)+_0x40227a(0x10e)+_0x40227a(0xdc)+_0x40227a(0x105)+_0x40227a(0xd6)+_0x40227a(0xda),{'parse_mode':_0x40227a(0x139)}),console[_0x40227a(0x126)](_0x40227a(0x116)+_0xbee66c+'\x20verified\x20for\x20shop\x20'+_0x48d3ec[_0x40227a(0xe1)]+_0x40227a(0x136));}catch(_0x55dcf3){console[_0x40227a(0x118)](_0x40227a(0x147),_0x55dcf3),await this['bot']?.[_0x40227a(0x92)](_0x23b8bc,_0x40227a(0x163));}}async[a66_0x416245(0xe9)](_0x49c1d9,_0x3c420f,_0x199e3d){const _0x22b0f2=a66_0x416245;if(!this[_0x22b0f2(0x73)]){console[_0x22b0f2(0xfe)](_0x22b0f2(0xbc));return;}try{const _0x34246a=await database_1[_0x22b0f2(0xfb)][_0x22b0f2(0xb9)][_0x22b0f2(0x8d)]({'where':{'shopId':_0x49c1d9,'isVerified':!![]}});if(_0x34246a[_0x22b0f2(0x11a)]===0x0){console[_0x22b0f2(0x126)](_0x22b0f2(0x15d)+_0x49c1d9);return;}const _0x28c7a7=_0x34246a[_0x22b0f2(0x11b)](async _0x2ea3b7=>{const _0x980db9=_0x22b0f2;try{await this[_0x980db9(0x73)]?.[_0x980db9(0x92)](_0x2ea3b7[_0x980db9(0xba)],_0x3c420f,_0x199e3d),console['log'](_0x980db9(0x142)+_0x2ea3b7['telegramId']);}catch(_0x1e4178){console[_0x980db9(0x118)](_0x980db9(0x117)+_0x2ea3b7['telegramId']+':',_0x1e4178),_0x1e4178 instanceof Error&&(_0x1e4178[_0x980db9(0x8c)]['includes'](_0x980db9(0xe8))||_0x1e4178['message'][_0x980db9(0x93)]('chat\x20not\x20found')||_0x1e4178['message']['includes'](_0x980db9(0xff)))&&(await database_1[_0x980db9(0xfb)]['telegramUser'][_0x980db9(0x149)]({'where':{'id':_0x2ea3b7['id']},'data':{'isVerified':![]}}),console[_0x980db9(0x126)](_0x980db9(0x111)+_0x2ea3b7[_0x980db9(0xba)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x22b0f2(0xc2)](_0x28c7a7);}catch(_0x9333a0){console[_0x22b0f2(0x118)](_0x22b0f2(0x152),_0x9333a0);}}async[a66_0x416245(0x9c)](_0x74945e,_0x201c96,_0x3f0bf8){const _0x150e81=a66_0x416245,_0x1522e3={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x35b2ab={'created':_0x150e81(0x109),'paid':'Payment\x20successfully\x20paid','failed':_0x150e81(0xfd),'expired':'Payment\x20expired','refund':_0x150e81(0x11f),'chargeback':_0x150e81(0x113),'processing':_0x150e81(0xa6)},_0x4a79e9=_0x1522e3[_0x3f0bf8],_0x52afa6=_0x35b2ab[_0x3f0bf8],_0xdde297=(0x0,gateway_1[_0x150e81(0x133)])(_0x201c96['gateway']);console[_0x150e81(0x126)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x201c96['gateway']+_0x150e81(0xee)+_0xdde297+'\x22');let _0x5111da=_0x4a79e9+'\x20*'+_0x52afa6+_0x150e81(0xf1)+(_0x150e81(0x13f)+_0x201c96[_0x150e81(0xa9)]+'\x20'+_0x201c96[_0x150e81(0x7e)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x201c96['orderId']||_0x201c96['id'])+'`\x0a')+(_0x150e81(0x159)+_0x201c96['id']+'`\x0a')+(_0x150e81(0x12a)+_0xdde297+'`\x0a')+(_0x150e81(0x156)+new Date(_0x201c96[_0x150e81(0x98)])[_0x150e81(0x15e)](_0x150e81(0x9f))+'\x0a');if(_0x201c96['customerName']||_0x201c96[_0x150e81(0xed)]||_0x201c96[_0x150e81(0xb0)]||_0x201c96[_0x150e81(0x12e)]||_0x201c96['customerUa']){_0x5111da+=_0x150e81(0x164);_0x201c96[_0x150e81(0xc0)]&&(_0x5111da+=_0x150e81(0x85)+_0x201c96[_0x150e81(0xc0)]+'`\x0a');_0x201c96[_0x150e81(0xed)]&&(_0x5111da+=_0x150e81(0x124)+_0x201c96[_0x150e81(0xed)]+'`\x0a');_0x201c96[_0x150e81(0xb0)]&&(_0x5111da+=_0x150e81(0xa3)+_0x201c96['remitterIban']+'`\x0a');_0x201c96[_0x150e81(0x12e)]&&(_0x5111da+='🌐\x20IP:\x20`'+_0x201c96['customerIp']+'`\x0a');if(_0x201c96[_0x150e81(0x143)]){const _0x55fffc=_0x201c96[_0x150e81(0x143)]['length']>0x32?_0x201c96[_0x150e81(0x143)][_0x150e81(0xe5)](0x0,0x32)+_0x150e81(0xc6):_0x201c96[_0x150e81(0x143)];_0x5111da+=_0x150e81(0x114)+_0x55fffc+'`\x0a';}}_0x3f0bf8===_0x150e81(0xf8)&&_0x201c96[_0x150e81(0x97)]&&(_0x5111da+=_0x150e81(0x148)+_0x201c96[_0x150e81(0x97)]+_0x150e81(0x89)),_0x3f0bf8==='processing'&&(_0x5111da+=_0x150e81(0xad)),_0x201c96[_0x150e81(0xec)]&&(_0x5111da+=_0x150e81(0x108)+_0x201c96[_0x150e81(0xec)]+'\x0a'),await this['sendShopNotification'](_0x74945e,_0x5111da,{'parse_mode':_0x150e81(0x139)});}async['sendPayoutNotification'](_0x3decaf,_0x477397,_0x17b772){const _0x48d8c3=a66_0x416245,_0x116544={'created':'📤','completed':'✅','rejected':'❌'},_0x2e5131={'created':'New\x20payout\x20created','completed':_0x48d8c3(0xe6),'rejected':_0x48d8c3(0xe4)},_0x333767=_0x116544[_0x17b772],_0x336686=_0x2e5131[_0x17b772],_0x475f1d=_0x333767+'\x20*'+_0x336686+_0x48d8c3(0xf1)+(_0x48d8c3(0x162)+_0x477397['amount']+_0x48d8c3(0xa8))+(_0x48d8c3(0x88)+_0x477397['method']+'`\x0a')+(_0x48d8c3(0xfc)+_0x477397['id']+'`\x0a')+(_0x48d8c3(0x156)+new Date(_0x477397[_0x48d8c3(0x98)])[_0x48d8c3(0x15e)]('en-US')+'\x0a')+(_0x477397['txid']?_0x48d8c3(0xaa)+_0x477397[_0x48d8c3(0x145)]+'`':'');await this[_0x48d8c3(0xe9)](_0x3decaf,_0x475f1d,{'parse_mode':'Markdown'});}async[a66_0x416245(0xf9)](_0x1102e0,_0x55371c){const _0x32a6ac=a66_0x416245;try{const _0x38620e=await database_1[_0x32a6ac(0xfb)]['shopSettings'][_0x32a6ac(0x10f)]({'where':{'shopId':_0x1102e0},'select':{'notificationLogin':!![]}});if(!_0x38620e?.[_0x32a6ac(0x10a)]){console[_0x32a6ac(0x126)](_0x32a6ac(0x8b)+_0x1102e0);return;}const _0x57eb0f=_0x55371c[_0x32a6ac(0xf4)]?'🔐':'🚨',_0x467763=_0x55371c[_0x32a6ac(0xf4)]?_0x32a6ac(0xd2):_0x32a6ac(0x15f);let _0x5aea84=_0x57eb0f+'\x20*'+_0x467763+_0x32a6ac(0xf1)+(_0x32a6ac(0xc4)+_0x55371c[_0x32a6ac(0xe1)]+'`\x0a')+('📅\x20Time:\x20'+_0x55371c['timestamp']['toLocaleString'](_0x32a6ac(0x9f))+'\x0a');_0x55371c['ipAddress']&&(_0x5aea84+='🌐\x20IP\x20address:\x20`'+_0x55371c[_0x32a6ac(0xae)]+'`\x0a');if(_0x55371c[_0x32a6ac(0x115)]){const _0x1a573d=_0x55371c[_0x32a6ac(0x115)][_0x32a6ac(0x11a)]>0x32?_0x55371c[_0x32a6ac(0x115)][_0x32a6ac(0xe5)](0x0,0x32)+'...':_0x55371c[_0x32a6ac(0x115)];_0x5aea84+='💻\x20Browser:\x20`'+_0x1a573d+'`\x0a';}!_0x55371c[_0x32a6ac(0xf4)]&&(_0x5aea84+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x32a6ac(0xe9)](_0x1102e0,_0x5aea84,{'parse_mode':_0x32a6ac(0x139)}),console[_0x32a6ac(0x126)](_0x32a6ac(0x153)+_0x1102e0+':\x20'+(_0x55371c['success']?_0x32a6ac(0xf4):_0x32a6ac(0xcc)));}catch(_0x2398b2){console[_0x32a6ac(0x118)](_0x32a6ac(0x14c),_0x2398b2);}}async['sendApiErrorNotification'](_0x5e2f54,_0x56f028){const _0x41d84c=a66_0x416245;try{const _0x2351a6=await database_1[_0x41d84c(0xfb)]['shopSettings'][_0x41d84c(0x10f)]({'where':{'shopId':_0x5e2f54},'select':{'notificationApiError':!![]}});if(!_0x2351a6?.['notificationApiError']){console[_0x41d84c(0x126)](_0x41d84c(0x157)+_0x5e2f54);return;}let _0x3e84d3=_0x41d84c(0x100)+('🔗\x20Endpoint:\x20`'+_0x56f028[_0x41d84c(0xd5)]+'\x20'+_0x56f028['endpoint']+'`\x0a')+('📅\x20Time:\x20'+_0x56f028[_0x41d84c(0xf5)][_0x41d84c(0x15e)](_0x41d84c(0x9f))+'\x0a');_0x56f028[_0x41d84c(0xc5)]&&(_0x3e84d3+=_0x41d84c(0x123)+_0x56f028['statusCode']+'`\x0a'),_0x3e84d3+=_0x41d84c(0x127)+_0x56f028[_0x41d84c(0xb5)]+'`\x0a',_0x56f028[_0x41d84c(0x95)]&&(_0x3e84d3+=_0x41d84c(0x137)+_0x56f028[_0x41d84c(0x95)]+'`\x0a'),_0x3e84d3+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x41d84c(0xe9)](_0x5e2f54,_0x3e84d3,{'parse_mode':_0x41d84c(0x139)}),console['log'](_0x41d84c(0xf2)+_0x5e2f54+':\x20'+_0x56f028[_0x41d84c(0xe2)]);}catch(_0x39de63){console[_0x41d84c(0x118)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x39de63);}}async[a66_0x416245(0x10d)](_0x46cfeb,_0xea41f1,_0x5067f3){const _0x221ddf=a66_0x416245;let _0x4378b1=_0x221ddf(0x12c)+_0xea41f1+_0x221ddf(0xf1);for(const [_0x3f5855,_0x247faa]of Object[_0x221ddf(0xdf)](_0x5067f3)){_0x247faa!==null&&_0x247faa!==undefined&&(_0x4378b1+=_0x3f5855+':\x20`'+_0x247faa+'`\x0a');}await this['sendShopNotification'](_0x46cfeb,_0x4378b1,{'parse_mode':'Markdown'});}async['sendNotificationToAll'](_0x557321){const _0x39ade3=a66_0x416245;try{console['log'](_0x39ade3(0x94)+_0x557321[_0x39ade3(0xe5)](0x0,0x32)+_0x39ade3(0xc6));const _0x5b3887=await database_1[_0x39ade3(0xfb)][_0x39ade3(0xb9)][_0x39ade3(0x8d)]({'select':{'telegramId':!![]}});if(_0x5b3887[_0x39ade3(0x11a)]===0x0){console[_0x39ade3(0x126)]('📱\x20No\x20active\x20Telegram\x20users\x20found');return;}for(const _0x42f372 of _0x5b3887){try{await this[_0x39ade3(0x73)]?.[_0x39ade3(0x92)](_0x42f372['telegramId'],_0x557321,{'parse_mode':_0x39ade3(0x139)});}catch(_0xb4a163){console['error'](_0x39ade3(0x10b)+_0x42f372[_0x39ade3(0xba)]+':',_0xb4a163);}}console['log']('📱\x20Notification\x20sent\x20to\x20'+_0x5b3887[_0x39ade3(0x11a)]+'\x20users');}catch(_0x10fc8e){console[_0x39ade3(0x118)](_0x39ade3(0x72),_0x10fc8e);}}[a66_0x416245(0x15b)](){const _0x14059a=a66_0x416245;return{'isActive':!!this[_0x14059a(0x73)],'username':this[_0x14059a(0x161)]};}async[a66_0x416245(0xaf)](_0x542438,_0x19f3ec,_0x4fc34f,_0x6bcf86){const _0x40c940=a66_0x416245;try{if(!this[_0x40c940(0x73)])return console['error'](_0x40c940(0x122)),![];const _0x1b6a40=await database_1[_0x40c940(0xfb)]['telegramUser'][_0x40c940(0x8d)]({'where':{'shopId':_0x542438,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x1b6a40[_0x40c940(0x11a)]===0x0)return console['error'](_0x40c940(0xbb)+_0x542438),![];let _0x53c4e5=0x0;for(const _0x401cf9 of _0x1b6a40){try{await this[_0x40c940(0x73)][_0x40c940(0xac)](_0x401cf9['telegramId'],_0x19f3ec,{},{'filename':_0x4fc34f,'contentType':_0x4fc34f[_0x40c940(0xa0)](_0x40c940(0x15c))?_0x40c940(0x71):_0x4fc34f['endsWith'](_0x40c940(0x13b))||_0x4fc34f['endsWith'](_0x40c940(0xd8))?_0x40c940(0x10c):_0x4fc34f[_0x40c940(0xa0)](_0x40c940(0x14b))?_0x40c940(0x70):'application/octet-stream'}),_0x6bcf86&&await this[_0x40c940(0x73)]['sendMessage'](_0x401cf9['telegramId'],_0x6bcf86),_0x53c4e5++;}catch(_0x1c57c8){console[_0x40c940(0x118)](_0x40c940(0xe7)+_0x401cf9[_0x40c940(0xba)]+':',_0x1c57c8);}}return console[_0x40c940(0x126)](_0x40c940(0x78)+_0x53c4e5+'/'+_0x1b6a40[_0x40c940(0x11a)]+_0x40c940(0xeb)+_0x542438+':\x20'+_0x4fc34f),_0x53c4e5>0x0;}catch(_0xb4d8fb){return console['error'](_0x40c940(0x160),_0xb4d8fb),![];}}async[a66_0x416245(0xa4)](_0x14a8ac,_0x44f59c){const _0x22f252=a66_0x416245;try{if(!this['bot'])return console[_0x22f252(0x118)](_0x22f252(0x122)),![];return await this[_0x22f252(0x73)][_0x22f252(0x92)](_0x14a8ac,_0x44f59c),console[_0x22f252(0x126)](_0x22f252(0x91)+_0x14a8ac),!![];}catch(_0x5e7e97){return console[_0x22f252(0x118)](_0x22f252(0x86),_0x5e7e97),![];}}async[a66_0x416245(0x87)](_0x3baae3,_0x15f4da,_0x305850,_0x3268fe){const _0x30ca8e=a66_0x416245;try{if(!this[_0x30ca8e(0x73)])return console['error'](_0x30ca8e(0x122)),![];return await this[_0x30ca8e(0x73)][_0x30ca8e(0xac)](_0x3baae3,_0x15f4da,{},{'filename':_0x305850,'contentType':_0x305850[_0x30ca8e(0xa0)]('.png')?'image/png':_0x305850[_0x30ca8e(0xa0)](_0x30ca8e(0x13b))||_0x305850[_0x30ca8e(0xa0)](_0x30ca8e(0xd8))?_0x30ca8e(0x10c):_0x305850[_0x30ca8e(0xa0)]('.pdf')?_0x30ca8e(0x70):_0x30ca8e(0x7a)}),_0x3268fe&&await this[_0x30ca8e(0x73)][_0x30ca8e(0x92)](_0x3baae3,_0x3268fe),console['log'](_0x30ca8e(0x75)+_0x3baae3+':\x20'+_0x305850),!![];}catch(_0x32df72){return console['error'](_0x30ca8e(0xcb),_0x32df72),![];}}[a66_0x416245(0x12f)](){const _0x59ea3b=a66_0x416245;this[_0x59ea3b(0x73)]&&(this[_0x59ea3b(0x73)][_0x59ea3b(0x79)](),this[_0x59ea3b(0x73)]=null,console[_0x59ea3b(0x126)](_0x59ea3b(0xdd)));}}exports[a66_0x416245(0x150)]=TelegramBotService,exports[a66_0x416245(0x8a)]=new TelegramBotService();