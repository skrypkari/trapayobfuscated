'use strict';const a59_0x3f5920=a59_0x2bad;(function(_0x304ada,_0x4b70ef){const _0x49aab5=a59_0x2bad,_0x1f32f6=_0x304ada();while(!![]){try{const _0x127397=parseInt(_0x49aab5(0x2ba))/0x1+parseInt(_0x49aab5(0x28d))/0x2*(-parseInt(_0x49aab5(0x27f))/0x3)+-parseInt(_0x49aab5(0x2b3))/0x4+-parseInt(_0x49aab5(0x243))/0x5*(parseInt(_0x49aab5(0x27c))/0x6)+parseInt(_0x49aab5(0x258))/0x7*(parseInt(_0x49aab5(0x251))/0x8)+parseInt(_0x49aab5(0x1ea))/0x9*(parseInt(_0x49aab5(0x205))/0xa)+parseInt(_0x49aab5(0x290))/0xb;if(_0x127397===_0x4b70ef)break;else _0x1f32f6['push'](_0x1f32f6['shift']());}catch(_0x361fd7){_0x1f32f6['push'](_0x1f32f6['shift']());}}}(a59_0x20fd,0x40839));var __importDefault=this&&this[a59_0x3f5920(0x1dd)]||function(_0x431b6e){const _0x4ff333=a59_0x3f5920;return _0x431b6e&&_0x431b6e[_0x4ff333(0x28f)]?_0x431b6e:{'default':_0x431b6e};};function a59_0x2bad(_0x5ebe27,_0x386d54){const _0x20fde5=a59_0x20fd();return a59_0x2bad=function(_0x2bada4,_0x1b99a8){_0x2bada4=_0x2bada4-0x1da;let _0x5630e1=_0x20fde5[_0x2bada4];return _0x5630e1;},a59_0x2bad(_0x5ebe27,_0x386d54);}Object['defineProperty'](exports,a59_0x3f5920(0x28f),{'value':!![]}),exports[a59_0x3f5920(0x275)]=exports['TelegramBotService']=void 0x0;function a59_0x20fd(){const _0x38512d=['create','txid','📱\x20Telegram\x20notification:\x20gateway\x20\x22','To\x20reconnect,\x20use\x20the\x20/start\x20command','length','Payment\x20refund','ipAddress','amount',':\x20username=\x22','shopId','node-telegram-bot-api','sendLoginNotification','polling_error','../config/database','toLocaleDateString','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','...`\x0a\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','📛\x20Name:\x20`','warn','\x20via\x20single-line\x20input','🛑\x20Telegram\x20bot\x20stopped','sendCustomNotification','blocked','New\x20payout\x20created','trapay_bot','shop','shopSettings','timestamp','last_name','🆔\x20Request\x20ID:\x20`','`\x20(','🔍\x20*Debug\x20Information*\x0a\x0a','Payment\x20chargeback','\x20parts:\x20','*.\x0a\x0a','14115wjjCmq','sendShopNotification','✅\x20Telegram\x20user\x20','errorMessage','\x20USD*\x0a','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','Available\x20usernames:\x0a','log','unknown\x20shop','Telegram\x20bot\x20polling\x20error:','toString','Error\x20handling\x20/disconnect\x20command:','\x22\x20->\x20display\x20\x22','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','18752XptJtY','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','🏪\x20Available\x20shops\x20in\x20system:\x0a','chargeback','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','📝\x20Notes:\x20','889QsICVz','🔌\x20User\x20','TELEGRAM_BOT_TOKEN','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','endpoint','getBotInfo','sendPayoutNotification','🏦\x20Method:\x20`','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','entries','❌\x20Shop\x20with\x20username\x20`','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','Contact\x20administrator.','remitterIban','chat','\x20disconnected\x20from\x20shop\x20','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','statusCode','`.\x0a\x0a','*\x0a\x0a','Error\x20handling\x20message:','update','📊\x20*Connection\x20Status*\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','username','❌\x20Error\x20getting\x20debug\x20information.','•\x20Payment\x20status\x20changes\x0a','telegramBotService','onText','from','Use\x20/start\x20to\x20connect.','substring','processing','sendMessage','552HdpLnL','requestId','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','22434vdmdpA','\x22,\x20apiKey=\x22','🔗\x20Endpoint:\x20`','customerIp','currency','...\x22','userAgent','💻\x20Browser:\x20`','🔔\x20*','Markdown','sendApiErrorNotification','test','Payment\x20is\x20being\x20processed','`\x20is\x20inactive.\x0a\x0a','18UXEgxl','setupBotHandlers','__esModule','6501264FAcYRb','Error\x20in\x20handleSingleLineVerification:','📝\x20Order\x20ID:\x20`','map','forEach','split','success','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','handleSingleLineVerification','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','findMany','\x20\x20\x20Status:\x20','updatedAt','secretKey','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','message','\x0a👤\x20*Customer\x20Information:*\x0a','📧\x20Email:\x20`','❌\x20Error:\x20`','stopBot','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','.\x20*','👤\x20Username:\x20`','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','📱\x20Created\x20new\x20Telegram\x20user:\x20','❌\x20Please\x20use\x20/start\x20command\x20first','/disconnect\x20-\x20disconnect\x20from\x20notifications','findUnique','📱\x20Shop:\x20*','•\x20Payouts\x0a\x0a','Payout\x20rejected','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','botToken','1440608TWtsue','trim','join','\x20\x20\x20Public\x20Key:\x20`','telegramId','initializeBot','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','18848jqrTZp','notificationApiError','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','status','sendPaymentNotification','startsWith','You\x20sent\x20','📅\x20Connection\x20date:\x20','📅\x20Date:\x20','Use\x20/start\x20to\x20begin.','getGatewayDisplayNameForTelegram','pk_','botUsername','•\x20Important\x20events\x0a\x0a','__importDefault','error','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','method','Error\x20handling\x20/start\x20command:','❌\x20Shop\x20`','Telegram\x20bot\x20error:','customerUa','findFirst','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','🏪\x20Gateway:\x20`','`\x20not\x20found.\x0a\x0a','🆔\x20Payout\x20ID:\x20`','394731GddrEB','Failed\x20login\x20attempt','📅\x20Time:\x20','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','failed','publicKey','includes','telegramUser','✅\x20Connected\x20to\x20shop:\x20*','TelegramBotService','orderId','Payout\x20completed','💸\x20Penalty\x20amount:\x20*','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','User\x20','\x20initialized\x20successfully','Commands:\x0a','📱\x20Your\x20Telegram\x20ID:\x20`','🌐\x20IP\x20address:\x20`','Example:\x0a','Payment\x20failed','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','chat\x20not\x20found','•\x20Payouts\x0a','default','Check\x20spelling\x20and\x20try\x20again.','customerName','10MtXLAc','en-US','New\x20payment\x20created','`\x0a\x0a','/status\x20-\x20check\x20connection\x20status\x0a','toLocaleString','customerEmail','name','\x20\x20\x20Username:\x20`','gateway','chargebackAmount','•\x20New\x20payments\x0a','ACTIVE','🔔\x20Notifications\x20are\x20active\x0a\x0a','text','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','notificationLogin','env','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','•\x20`','bot','user\x20is\x20deactivated','createdAt','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','isVerified'];a59_0x20fd=function(){return _0x38512d;};return a59_0x20fd();}const node_telegram_bot_api_1=__importDefault(require(a59_0x3f5920(0x228))),database_1=__importDefault(require(a59_0x3f5920(0x22b))),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x4221f5=a59_0x3f5920;this[_0x4221f5(0x219)]=null,this[_0x4221f5(0x2b2)]=process['env'][_0x4221f5(0x25a)]||'',this[_0x4221f5(0x1db)]=process[_0x4221f5(0x216)]['TELEGRAM_BOT_USERNAME']||_0x4221f5(0x238),this[_0x4221f5(0x2b2)]?this[_0x4221f5(0x2b8)]():console[_0x4221f5(0x232)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a59_0x3f5920(0x2b8)](){const _0x4f9d51=a59_0x3f5920;try{this[_0x4f9d51(0x219)]=new node_telegram_bot_api_1['default'](this[_0x4f9d51(0x2b2)],{'polling':!![]}),this['setupBotHandlers'](),console['log']('✅\x20Telegram\x20bot\x20@'+this[_0x4f9d51(0x1db)]+_0x4f9d51(0x1f9));}catch(_0x4a2bfe){console[_0x4f9d51(0x1de)](_0x4f9d51(0x262),_0x4a2bfe);}}[a59_0x3f5920(0x28e)](){const _0x1bcba4=a59_0x3f5920;if(!this[_0x1bcba4(0x219)])return;this[_0x1bcba4(0x219)][_0x1bcba4(0x276)](/\/start/,async _0x3576bc=>{const _0x404967=_0x1bcba4,_0x28da35=_0x3576bc[_0x404967(0x268)]['id'],_0x90d986=_0x3576bc[_0x404967(0x277)]?.['id'][_0x404967(0x24d)](),_0x544543=_0x3576bc['from']?.[_0x404967(0x272)],_0x5b9a56=_0x3576bc[_0x404967(0x277)]?.['first_name'],_0x1b8e5b=_0x3576bc[_0x404967(0x277)]?.[_0x404967(0x23c)];if(!_0x90d986)return;try{let _0x346ae9=await database_1[_0x404967(0x202)]['telegramUser'][_0x404967(0x2ad)]({'where':{'telegramId':_0x90d986},'include':{'shop':!![]}});!_0x346ae9?(_0x346ae9=await database_1['default'][_0x404967(0x1f1)][_0x404967(0x21e)]({'data':{'telegramId':_0x90d986,'username':_0x544543,'firstName':_0x5b9a56,'lastName':_0x1b8e5b,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x404967(0x2aa)+_0x90d986+'\x20(@'+_0x544543+')')):_0x346ae9=await database_1[_0x404967(0x202)][_0x404967(0x1f1)]['update']({'where':{'telegramId':_0x90d986},'data':{'username':_0x544543,'firstName':_0x5b9a56,'lastName':_0x1b8e5b},'include':{'shop':!![]}}),_0x346ae9[_0x404967(0x21d)]&&_0x346ae9[_0x404967(0x227)]&&_0x346ae9[_0x404967(0x239)]?await this[_0x404967(0x219)]?.[_0x404967(0x27b)](_0x28da35,'✅\x20Welcome\x20back!\x0a\x0a'+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x346ae9[_0x404967(0x239)][_0x404967(0x20c)]+'*\x0a')+('Username:\x20`'+_0x346ae9[_0x404967(0x239)][_0x404967(0x272)]+_0x404967(0x208))+_0x404967(0x29f)+_0x404967(0x210)+_0x404967(0x274)+_0x404967(0x2af)+_0x404967(0x1fa)+_0x404967(0x209)+_0x404967(0x2ac),{'parse_mode':_0x404967(0x288)}):(_0x346ae9[_0x404967(0x227)]&&!_0x346ae9[_0x404967(0x21d)]&&(await database_1['default']['telegramUser'][_0x404967(0x26f)]({'where':{'telegramId':_0x90d986},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x404967(0x248)+_0x90d986)),await this[_0x404967(0x219)]?.[_0x404967(0x27b)](_0x28da35,_0x404967(0x253)+_0x404967(0x298)+_0x404967(0x217)+'Example:\x0a'+_0x404967(0x230)+_0x404967(0x2a9),{'parse_mode':_0x404967(0x288)}));}catch(_0x55a84f){console['error'](_0x404967(0x1e1),_0x55a84f),await this[_0x404967(0x219)]?.[_0x404967(0x27b)](_0x28da35,_0x404967(0x256));}}),this[_0x1bcba4(0x219)][_0x1bcba4(0x276)](/\/disconnect/,async _0x6f7993=>{const _0x117fd8=_0x1bcba4,_0x5ad6f2=_0x6f7993[_0x117fd8(0x268)]['id'],_0x481896=_0x6f7993[_0x117fd8(0x277)]?.['id']['toString']();if(!_0x481896)return;try{const _0x4e6bd1=await database_1[_0x117fd8(0x202)][_0x117fd8(0x1f1)][_0x117fd8(0x2ad)]({'where':{'telegramId':_0x481896},'include':{'shop':!![]}});if(!_0x4e6bd1||!_0x4e6bd1[_0x117fd8(0x21d)]||!_0x4e6bd1['shopId']){await this[_0x117fd8(0x219)]?.[_0x117fd8(0x27b)](_0x5ad6f2,_0x117fd8(0x2b9));return;}const _0x117b54=_0x4e6bd1[_0x117fd8(0x239)]?.[_0x117fd8(0x20c)]||_0x117fd8(0x24b);await database_1[_0x117fd8(0x202)][_0x117fd8(0x1f1)][_0x117fd8(0x26f)]({'where':{'telegramId':_0x481896},'data':{'shopId':null,'isVerified':![]}}),console[_0x117fd8(0x24a)](_0x117fd8(0x259)+_0x481896+_0x117fd8(0x269)+_0x4e6bd1['shopId']),await this[_0x117fd8(0x219)]?.[_0x117fd8(0x27b)](_0x5ad6f2,_0x117fd8(0x1ed)+_0x117b54+_0x117fd8(0x242)+_0x117fd8(0x221),{'parse_mode':_0x117fd8(0x288)});}catch(_0x230748){console['error'](_0x117fd8(0x24e),_0x230748),await this[_0x117fd8(0x219)]?.[_0x117fd8(0x27b)](_0x5ad6f2,_0x117fd8(0x256));}}),this[_0x1bcba4(0x219)]['onText'](/\/status/,async _0x51ab3c=>{const _0x472084=_0x1bcba4,_0x442808=_0x51ab3c['chat']['id'],_0x2e6c94=_0x51ab3c[_0x472084(0x277)]?.['id'][_0x472084(0x24d)]();if(!_0x2e6c94)return;try{const _0x312784=await database_1[_0x472084(0x202)][_0x472084(0x1f1)][_0x472084(0x2ad)]({'where':{'telegramId':_0x2e6c94},'include':{'shop':!![]}});if(!_0x312784){await this[_0x472084(0x219)]?.[_0x472084(0x27b)](_0x442808,_0x472084(0x21c)+_0x472084(0x2c3));return;}if(!_0x312784['isVerified']||!_0x312784['shopId']||!_0x312784[_0x472084(0x239)]){await this[_0x472084(0x219)]?.[_0x472084(0x27b)](_0x442808,_0x472084(0x271)+_0x472084(0x278));return;}await this[_0x472084(0x219)]?.[_0x472084(0x27b)](_0x442808,_0x472084(0x270)+(_0x472084(0x1f2)+_0x312784[_0x472084(0x239)][_0x472084(0x20c)]+'*\x0a')+(_0x472084(0x2a8)+_0x312784[_0x472084(0x239)][_0x472084(0x272)]+'`\x0a')+(_0x472084(0x2c1)+_0x312784[_0x472084(0x29d)][_0x472084(0x22c)]('en-US')+'\x0a\x0a')+_0x472084(0x212)+_0x472084(0x1fa)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x472084(0x288)});}catch(_0x5e520e){console[_0x472084(0x1de)]('Error\x20handling\x20/status\x20command:',_0x5e520e),await this[_0x472084(0x219)]?.[_0x472084(0x27b)](_0x442808,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x1bcba4(0x219)][_0x1bcba4(0x276)](/\/debug/,async _0x1304e2=>{const _0x1a8cea=_0x1bcba4,_0x1b2d83=_0x1304e2['chat']['id'],_0x2816ad=_0x1304e2[_0x1a8cea(0x277)]?.['id'][_0x1a8cea(0x24d)]();if(!_0x2816ad)return;try{const _0x2a41a7=await database_1['default']['shop'][_0x1a8cea(0x29b)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x34258c=_0x1a8cea(0x23f);_0x34258c+=_0x1a8cea(0x1fb)+_0x2816ad+_0x1a8cea(0x208),_0x34258c+=_0x1a8cea(0x254),_0x2a41a7[_0x1a8cea(0x294)]((_0x44f264,_0x3e6e22)=>{const _0x3dd412=_0x1a8cea;_0x34258c+=_0x3e6e22+0x1+_0x3dd412(0x2a7)+_0x44f264[_0x3dd412(0x20c)]+'*\x0a',_0x34258c+=_0x3dd412(0x20d)+_0x44f264[_0x3dd412(0x272)]+'`\x0a',_0x34258c+=_0x3dd412(0x29c)+_0x44f264[_0x3dd412(0x2bd)]+'\x0a',_0x34258c+=_0x3dd412(0x2b6)+_0x44f264[_0x3dd412(0x1ef)][_0x3dd412(0x279)](0x0,0xf)+_0x3dd412(0x22e);}),await this[_0x1a8cea(0x219)]?.[_0x1a8cea(0x27b)](_0x1b2d83,_0x34258c,{'parse_mode':_0x1a8cea(0x288)});}catch(_0x174087){console[_0x1a8cea(0x1de)]('Error\x20handling\x20/debug\x20command:',_0x174087),await this[_0x1a8cea(0x219)]?.['sendMessage'](_0x1b2d83,_0x1a8cea(0x273));}}),this[_0x1bcba4(0x219)]['on'](_0x1bcba4(0x2a1),async _0x4bad07=>{const _0x35c9bc=_0x1bcba4;if(_0x4bad07['text']?.['startsWith']('/'))return;const _0x1a9b45=_0x4bad07['chat']['id'],_0x138427=_0x4bad07[_0x35c9bc(0x277)]?.['id'][_0x35c9bc(0x24d)](),_0x2d7daf=_0x4bad07[_0x35c9bc(0x213)]?.[_0x35c9bc(0x2b4)]();if(!_0x138427||!_0x2d7daf)return;try{const _0x39f6c6=await database_1['default'][_0x35c9bc(0x1f1)][_0x35c9bc(0x2ad)]({'where':{'telegramId':_0x138427},'include':{'shop':!![]}});if(!_0x39f6c6){await this['bot']?.[_0x35c9bc(0x27b)](_0x1a9b45,_0x35c9bc(0x2ab));return;}if(_0x39f6c6[_0x35c9bc(0x21d)]&&_0x39f6c6[_0x35c9bc(0x227)]&&_0x39f6c6[_0x35c9bc(0x239)]){await this[_0x35c9bc(0x219)]?.[_0x35c9bc(0x27b)](_0x1a9b45,_0x35c9bc(0x1f7)+_0x39f6c6[_0x35c9bc(0x239)][_0x35c9bc(0x20c)]+'*.\x0a\x0a'+_0x35c9bc(0x2bc),{'parse_mode':_0x35c9bc(0x288)});return;}const _0x170cf9=_0x2d7daf[_0x35c9bc(0x295)](/\s+/);if(_0x170cf9[_0x35c9bc(0x222)]!==0x2){await this[_0x35c9bc(0x219)]?.[_0x35c9bc(0x27b)](_0x1a9b45,_0x35c9bc(0x29a)+_0x35c9bc(0x217)+_0x35c9bc(0x1fd)+_0x35c9bc(0x230)+(_0x35c9bc(0x2c0)+_0x170cf9[_0x35c9bc(0x222)]+_0x35c9bc(0x241)+_0x170cf9[_0x35c9bc(0x293)](_0x2054bf=>'`'+_0x2054bf+'`')[_0x35c9bc(0x2b5)](',\x20')),{'parse_mode':_0x35c9bc(0x288)});return;}const [_0x47db4b,_0x5d2d46]=_0x170cf9;console[_0x35c9bc(0x24a)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x138427+_0x35c9bc(0x226)+_0x47db4b+'\x22,\x20apiKey=\x22'+_0x5d2d46[_0x35c9bc(0x279)](0x0,0xa)+_0x35c9bc(0x284)),await this[_0x35c9bc(0x299)](_0x1a9b45,_0x138427,_0x47db4b,_0x5d2d46);}catch(_0x533dc3){console[_0x35c9bc(0x1de)](_0x35c9bc(0x26e),_0x533dc3),await this[_0x35c9bc(0x219)]?.[_0x35c9bc(0x27b)](_0x1a9b45,_0x35c9bc(0x256));}}),this[_0x1bcba4(0x219)]['on'](_0x1bcba4(0x1de),_0x301e23=>{const _0x493be4=_0x1bcba4;console[_0x493be4(0x1de)](_0x493be4(0x1e3),_0x301e23);}),this[_0x1bcba4(0x219)]['on'](_0x1bcba4(0x22a),_0x390875=>{const _0x399118=_0x1bcba4;console[_0x399118(0x1de)](_0x399118(0x24c),_0x390875);});}async['handleSingleLineVerification'](_0x2fdd97,_0x3eaea7,_0x4be09c,_0x54787b){const _0x42c176=a59_0x3f5920;try{console[_0x42c176(0x24a)](_0x42c176(0x1e6)+_0x3eaea7+_0x42c176(0x226)+_0x4be09c+_0x42c176(0x280)+_0x54787b[_0x42c176(0x279)](0x0,0xa)+_0x42c176(0x284));if(!_0x4be09c||_0x4be09c[_0x42c176(0x222)]<0x3||_0x4be09c[_0x42c176(0x222)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x42c176(0x28a)](_0x4be09c)){await this[_0x42c176(0x219)]?.[_0x42c176(0x27b)](_0x2fdd97,'❌\x20Invalid\x20username\x20format:\x20`'+_0x4be09c+'`\x0a\x0a'+_0x42c176(0x1df),{'parse_mode':_0x42c176(0x288)});return;}if(!_0x54787b||!_0x54787b[_0x42c176(0x2bf)](_0x42c176(0x1da))&&!_0x54787b[_0x42c176(0x2bf)]('sk_')){await this[_0x42c176(0x219)]?.['sendMessage'](_0x2fdd97,_0x42c176(0x297)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':'Markdown'});return;}const _0x4faf13=await database_1[_0x42c176(0x202)][_0x42c176(0x239)][_0x42c176(0x2ad)]({'where':{'username':_0x4be09c},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x4faf13){const _0x17c4b6=await database_1[_0x42c176(0x202)][_0x42c176(0x239)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x10b427=_0x42c176(0x264)+_0x4be09c+_0x42c176(0x1e8);_0x17c4b6['length']>0x0?(_0x10b427+=_0x42c176(0x249),_0x17c4b6[_0x42c176(0x294)](_0x3ed80b=>{const _0x5e4711=_0x42c176;_0x10b427+=_0x5e4711(0x218)+_0x3ed80b[_0x5e4711(0x272)]+_0x5e4711(0x23e)+_0x3ed80b['name']+')\x0a';}),_0x10b427+=_0x42c176(0x22f)):_0x10b427+=_0x42c176(0x203);await this[_0x42c176(0x219)]?.[_0x42c176(0x27b)](_0x2fdd97,_0x10b427,{'parse_mode':_0x42c176(0x288)});return;}if(_0x4faf13[_0x42c176(0x2bd)]!==_0x42c176(0x211)){await this[_0x42c176(0x219)]?.[_0x42c176(0x27b)](_0x2fdd97,_0x42c176(0x1e2)+_0x4be09c+_0x42c176(0x28c)+_0x42c176(0x266),{'parse_mode':'Markdown'});return;}if(_0x4faf13[_0x42c176(0x1ef)]!==_0x54787b&&_0x4faf13[_0x42c176(0x29e)]!==_0x54787b){await this[_0x42c176(0x219)]?.[_0x42c176(0x27b)](_0x2fdd97,_0x42c176(0x1ff)+_0x4be09c+_0x42c176(0x26c)+_0x42c176(0x2a0)+_0x42c176(0x25b),{'parse_mode':_0x42c176(0x288)});return;}const _0x24cafd=await database_1[_0x42c176(0x202)][_0x42c176(0x1f1)][_0x42c176(0x1e5)]({'where':{'shopId':_0x4faf13['id'],'isVerified':!![],'telegramId':{'not':_0x3eaea7}}});if(_0x24cafd){await this[_0x42c176(0x219)]?.[_0x42c176(0x27b)](_0x2fdd97,_0x42c176(0x27e)+_0x4be09c+_0x42c176(0x26c)+_0x42c176(0x22d),{'parse_mode':_0x42c176(0x288)});return;}await database_1[_0x42c176(0x202)][_0x42c176(0x1f1)]['update']({'where':{'telegramId':_0x3eaea7},'data':{'shopId':_0x4faf13['id'],'isVerified':!![]}}),await this[_0x42c176(0x219)]?.[_0x42c176(0x27b)](_0x2fdd97,'🎉\x20*Congratulations!*\x0a\x0a'+_0x42c176(0x2b1)+(_0x42c176(0x2ae)+_0x4faf13['name']+'*\x0a')+(_0x42c176(0x2a8)+_0x4faf13['username']+_0x42c176(0x208))+_0x42c176(0x2a6)+_0x42c176(0x210)+_0x42c176(0x274)+_0x42c176(0x201)+_0x42c176(0x1dc)+_0x42c176(0x1fa)+_0x42c176(0x209)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}),console[_0x42c176(0x24a)](_0x42c176(0x245)+_0x3eaea7+'\x20verified\x20for\x20shop\x20'+_0x4faf13[_0x42c176(0x272)]+_0x42c176(0x233));}catch(_0x4b221b){console[_0x42c176(0x1de)](_0x42c176(0x291),_0x4b221b),await this[_0x42c176(0x219)]?.[_0x42c176(0x27b)](_0x2fdd97,_0x42c176(0x250));}}async[a59_0x3f5920(0x244)](_0x2ea664,_0x490860,_0x1dad97){const _0x531f58=a59_0x3f5920;if(!this[_0x531f58(0x219)]){console[_0x531f58(0x232)](_0x531f58(0x214));return;}try{const _0x434c81=await database_1[_0x531f58(0x202)]['telegramUser'][_0x531f58(0x29b)]({'where':{'shopId':_0x2ea664,'isVerified':!![]}});if(_0x434c81[_0x531f58(0x222)]===0x0){console[_0x531f58(0x24a)](_0x531f58(0x252)+_0x2ea664);return;}const _0x581d1a=_0x434c81[_0x531f58(0x293)](async _0x4ed592=>{const _0x43aebf=_0x531f58;try{await this[_0x43aebf(0x219)]?.[_0x43aebf(0x27b)](_0x4ed592[_0x43aebf(0x2b7)],_0x490860,_0x1dad97),console[_0x43aebf(0x24a)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x4ed592[_0x43aebf(0x2b7)]);}catch(_0x41141d){console[_0x43aebf(0x1de)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x4ed592[_0x43aebf(0x2b7)]+':',_0x41141d),_0x41141d instanceof Error&&(_0x41141d[_0x43aebf(0x2a1)][_0x43aebf(0x1f0)](_0x43aebf(0x236))||_0x41141d[_0x43aebf(0x2a1)][_0x43aebf(0x1f0)](_0x43aebf(0x200))||_0x41141d[_0x43aebf(0x2a1)]['includes'](_0x43aebf(0x21a)))&&(await database_1[_0x43aebf(0x202)]['telegramUser'][_0x43aebf(0x26f)]({'where':{'id':_0x4ed592['id']},'data':{'isVerified':![]}}),console[_0x43aebf(0x24a)](_0x43aebf(0x1f8)+_0x4ed592[_0x43aebf(0x2b7)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise['allSettled'](_0x581d1a);}catch(_0x5307ce){console[_0x531f58(0x1de)]('Error\x20sending\x20shop\x20notification:',_0x5307ce);}}async[a59_0x3f5920(0x2be)](_0x514262,_0x21c511,_0x38e37d){const _0x1bc6e4=a59_0x3f5920,_0x2adb70={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x2fd4eb={'created':_0x1bc6e4(0x207),'paid':'Payment\x20successfully\x20paid','failed':_0x1bc6e4(0x1fe),'expired':'Payment\x20expired','refund':_0x1bc6e4(0x223),'chargeback':_0x1bc6e4(0x240),'processing':_0x1bc6e4(0x28b)},_0x2be35a=_0x2adb70[_0x38e37d],_0x40fe9c=_0x2fd4eb[_0x38e37d],_0x59842b=(0x0,gateway_1[_0x1bc6e4(0x2c4)])(_0x21c511[_0x1bc6e4(0x20e)]);console[_0x1bc6e4(0x24a)](_0x1bc6e4(0x220)+_0x21c511['gateway']+_0x1bc6e4(0x24f)+_0x59842b+'\x22');let _0x17e043=_0x2be35a+'\x20*'+_0x40fe9c+_0x1bc6e4(0x26d)+('💰\x20Amount:\x20*'+_0x21c511[_0x1bc6e4(0x225)]+'\x20'+_0x21c511[_0x1bc6e4(0x283)]+'*\x0a')+(_0x1bc6e4(0x292)+(_0x21c511[_0x1bc6e4(0x1f4)]||_0x21c511['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x21c511['id']+'`\x0a')+(_0x1bc6e4(0x1e7)+_0x59842b+'`\x0a')+(_0x1bc6e4(0x2c2)+new Date(_0x21c511[_0x1bc6e4(0x21b)])[_0x1bc6e4(0x20a)](_0x1bc6e4(0x206))+'\x0a');if(_0x21c511[_0x1bc6e4(0x204)]||_0x21c511[_0x1bc6e4(0x20b)]||_0x21c511[_0x1bc6e4(0x267)]||_0x21c511[_0x1bc6e4(0x282)]||_0x21c511[_0x1bc6e4(0x1e4)]){_0x17e043+=_0x1bc6e4(0x2a2);_0x21c511['customerName']&&(_0x17e043+=_0x1bc6e4(0x231)+_0x21c511[_0x1bc6e4(0x204)]+'`\x0a');_0x21c511[_0x1bc6e4(0x20b)]&&(_0x17e043+=_0x1bc6e4(0x2a3)+_0x21c511['customerEmail']+'`\x0a');_0x21c511[_0x1bc6e4(0x267)]&&(_0x17e043+='🏦\x20IBAN:\x20`'+_0x21c511['remitterIban']+'`\x0a');_0x21c511['customerIp']&&(_0x17e043+='🌐\x20IP:\x20`'+_0x21c511[_0x1bc6e4(0x282)]+'`\x0a');if(_0x21c511[_0x1bc6e4(0x1e4)]){const _0x6b8460=_0x21c511[_0x1bc6e4(0x1e4)][_0x1bc6e4(0x222)]>0x32?_0x21c511[_0x1bc6e4(0x1e4)][_0x1bc6e4(0x279)](0x0,0x32)+'...':_0x21c511[_0x1bc6e4(0x1e4)];_0x17e043+=_0x1bc6e4(0x286)+_0x6b8460+'`\x0a';}}_0x38e37d===_0x1bc6e4(0x255)&&_0x21c511[_0x1bc6e4(0x20f)]&&(_0x17e043+=_0x1bc6e4(0x1f6)+_0x21c511['chargebackAmount']+'\x20USDT*\x0a'),_0x38e37d===_0x1bc6e4(0x27a)&&(_0x17e043+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x21c511['adminNotes']&&(_0x17e043+=_0x1bc6e4(0x257)+_0x21c511['adminNotes']+'\x0a'),await this['sendShopNotification'](_0x514262,_0x17e043,{'parse_mode':_0x1bc6e4(0x288)});}async[a59_0x3f5920(0x25e)](_0x511f83,_0x2729d3,_0x5be6b0){const _0x4eaae5=a59_0x3f5920,_0x2f091a={'created':'📤','completed':'✅','rejected':'❌'},_0x176c8={'created':_0x4eaae5(0x237),'completed':_0x4eaae5(0x1f5),'rejected':_0x4eaae5(0x2b0)},_0x115b91=_0x2f091a[_0x5be6b0],_0x5dce15=_0x176c8[_0x5be6b0],_0x17c0c8=_0x115b91+'\x20*'+_0x5dce15+_0x4eaae5(0x26d)+('💸\x20Amount:\x20*'+_0x2729d3[_0x4eaae5(0x225)]+_0x4eaae5(0x247))+(_0x4eaae5(0x25f)+_0x2729d3[_0x4eaae5(0x1e0)]+'`\x0a')+(_0x4eaae5(0x1e9)+_0x2729d3['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x2729d3[_0x4eaae5(0x21b)])[_0x4eaae5(0x20a)](_0x4eaae5(0x206))+'\x0a')+(_0x2729d3[_0x4eaae5(0x21f)]?'🔗\x20TXID:\x20`'+_0x2729d3[_0x4eaae5(0x21f)]+'`':'');await this['sendShopNotification'](_0x511f83,_0x17c0c8,{'parse_mode':_0x4eaae5(0x288)});}async[a59_0x3f5920(0x229)](_0x36b827,_0x57086d){const _0x20aeb4=a59_0x3f5920;try{const _0xd010c9=await database_1['default'][_0x20aeb4(0x23a)]['findUnique']({'where':{'shopId':_0x36b827},'select':{'notificationLogin':!![]}});if(!_0xd010c9?.[_0x20aeb4(0x215)]){console[_0x20aeb4(0x24a)](_0x20aeb4(0x261)+_0x36b827);return;}const _0x53298d=_0x57086d[_0x20aeb4(0x296)]?'🔐':'🚨',_0x991ce3=_0x57086d[_0x20aeb4(0x296)]?'Successful\x20login':_0x20aeb4(0x1eb);let _0x51f9f2=_0x53298d+'\x20*'+_0x991ce3+_0x20aeb4(0x26d)+(_0x20aeb4(0x2a8)+_0x57086d[_0x20aeb4(0x272)]+'`\x0a')+(_0x20aeb4(0x1ec)+_0x57086d['timestamp'][_0x20aeb4(0x20a)]('en-US')+'\x0a');_0x57086d[_0x20aeb4(0x224)]&&(_0x51f9f2+=_0x20aeb4(0x1fc)+_0x57086d[_0x20aeb4(0x224)]+'`\x0a');if(_0x57086d[_0x20aeb4(0x285)]){const _0x2881e9=_0x57086d['userAgent'][_0x20aeb4(0x222)]>0x32?_0x57086d['userAgent'][_0x20aeb4(0x279)](0x0,0x32)+'...':_0x57086d[_0x20aeb4(0x285)];_0x51f9f2+=_0x20aeb4(0x286)+_0x2881e9+'`\x0a';}!_0x57086d['success']&&(_0x51f9f2+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this['sendShopNotification'](_0x36b827,_0x51f9f2,{'parse_mode':_0x20aeb4(0x288)}),console[_0x20aeb4(0x24a)](_0x20aeb4(0x265)+_0x36b827+':\x20'+(_0x57086d[_0x20aeb4(0x296)]?_0x20aeb4(0x296):_0x20aeb4(0x1ee)));}catch(_0x32f698){console[_0x20aeb4(0x1de)]('Failed\x20to\x20send\x20login\x20notification:',_0x32f698);}}async[a59_0x3f5920(0x289)](_0xf03fda,_0x50309d){const _0x18ec16=a59_0x3f5920;try{const _0x36947e=await database_1['default'][_0x18ec16(0x23a)]['findUnique']({'where':{'shopId':_0xf03fda},'select':{'notificationApiError':!![]}});if(!_0x36947e?.[_0x18ec16(0x2bb)]){console[_0x18ec16(0x24a)](_0x18ec16(0x26a)+_0xf03fda);return;}let _0x20e572='🚨\x20*API\x20Error*\x0a\x0a'+(_0x18ec16(0x281)+_0x50309d['method']+'\x20'+_0x50309d[_0x18ec16(0x25c)]+'`\x0a')+(_0x18ec16(0x1ec)+_0x50309d[_0x18ec16(0x23b)][_0x18ec16(0x20a)](_0x18ec16(0x206))+'\x0a');_0x50309d[_0x18ec16(0x26b)]&&(_0x20e572+='📊\x20Error\x20code:\x20`'+_0x50309d['statusCode']+'`\x0a'),_0x20e572+=_0x18ec16(0x2a4)+_0x50309d[_0x18ec16(0x246)]+'`\x0a',_0x50309d[_0x18ec16(0x27d)]&&(_0x20e572+=_0x18ec16(0x23d)+_0x50309d[_0x18ec16(0x27d)]+'`\x0a'),_0x20e572+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x18ec16(0x244)](_0xf03fda,_0x20e572,{'parse_mode':_0x18ec16(0x288)}),console[_0x18ec16(0x24a)](_0x18ec16(0x260)+_0xf03fda+':\x20'+_0x50309d['endpoint']);}catch(_0x3043b0){console[_0x18ec16(0x1de)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x3043b0);}}async[a59_0x3f5920(0x235)](_0x40f523,_0xada765,_0x425930){const _0xa8f77=a59_0x3f5920;let _0x4eb684=_0xa8f77(0x287)+_0xada765+_0xa8f77(0x26d);for(const [_0x51177e,_0x49b0bf]of Object[_0xa8f77(0x263)](_0x425930)){_0x49b0bf!==null&&_0x49b0bf!==undefined&&(_0x4eb684+=_0x51177e+':\x20`'+_0x49b0bf+'`\x0a');}await this[_0xa8f77(0x244)](_0x40f523,_0x4eb684,{'parse_mode':_0xa8f77(0x288)});}[a59_0x3f5920(0x25d)](){const _0x25ed5e=a59_0x3f5920;return{'isActive':!!this['bot'],'username':this[_0x25ed5e(0x1db)]};}[a59_0x3f5920(0x2a5)](){const _0x3d1876=a59_0x3f5920;this[_0x3d1876(0x219)]&&(this[_0x3d1876(0x219)]['stopPolling'](),this[_0x3d1876(0x219)]=null,console[_0x3d1876(0x24a)](_0x3d1876(0x234)));}}exports[a59_0x3f5920(0x1f3)]=TelegramBotService,exports[a59_0x3f5920(0x275)]=new TelegramBotService();