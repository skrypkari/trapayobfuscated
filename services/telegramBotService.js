'use strict';const a62_0xc1a431=a62_0x37c0;function a62_0x37c0(_0x58330e,_0x5cc4e1){const _0x241e75=a62_0x241e();return a62_0x37c0=function(_0x37c0c5,_0x27d893){_0x37c0c5=_0x37c0c5-0xfd;let _0x211283=_0x241e75[_0x37c0c5];return _0x211283;},a62_0x37c0(_0x58330e,_0x5cc4e1);}(function(_0x2debce,_0x257f8c){const _0x4f275f=a62_0x37c0,_0xcd1ecf=_0x2debce();while(!![]){try{const _0x4a717f=parseInt(_0x4f275f(0x174))/0x1+parseInt(_0x4f275f(0x128))/0x2+parseInt(_0x4f275f(0x13f))/0x3*(parseInt(_0x4f275f(0x1d0))/0x4)+parseInt(_0x4f275f(0x1d2))/0x5*(parseInt(_0x4f275f(0x153))/0x6)+-parseInt(_0x4f275f(0x179))/0x7*(-parseInt(_0x4f275f(0x123))/0x8)+parseInt(_0x4f275f(0x1b8))/0x9+-parseInt(_0x4f275f(0x12e))/0xa;if(_0x4a717f===_0x257f8c)break;else _0xcd1ecf['push'](_0xcd1ecf['shift']());}catch(_0x1acc6b){_0xcd1ecf['push'](_0xcd1ecf['shift']());}}}(a62_0x241e,0x7dd50));var __importDefault=this&&this['__importDefault']||function(_0x2e8ad0){return _0x2e8ad0&&_0x2e8ad0['__esModule']?_0x2e8ad0:{'default':_0x2e8ad0};};Object[a62_0xc1a431(0x149)](exports,a62_0xc1a431(0x156),{'value':!![]}),exports[a62_0xc1a431(0x14b)]=exports[a62_0xc1a431(0x132)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require('../config/database')),gateway_1=require(a62_0xc1a431(0x13a));class TelegramBotService{constructor(){const _0x52a219=a62_0xc1a431;this[_0x52a219(0x1d5)]=null,this['botToken']=process[_0x52a219(0x1eb)][_0x52a219(0x1ca)]||'',this[_0x52a219(0x1e8)]=process[_0x52a219(0x1eb)]['TELEGRAM_BOT_USERNAME']||_0x52a219(0x16b),this[_0x52a219(0x18f)]?this[_0x52a219(0x1e6)]():console['warn'](_0x52a219(0x1d1));}['initializeBot'](){const _0x49d615=a62_0xc1a431;try{this[_0x49d615(0x1d5)]=new node_telegram_bot_api_1[(_0x49d615(0x117))](this[_0x49d615(0x18f)],{'polling':!![]}),this[_0x49d615(0x1cb)](),console['log'](_0x49d615(0x1ef)+this[_0x49d615(0x1e8)]+'\x20initialized\x20successfully');}catch(_0x36d398){console[_0x49d615(0x15f)](_0x49d615(0x154),_0x36d398);}}['setupBotHandlers'](){const _0x261903=a62_0xc1a431;if(!this['bot'])return;this[_0x261903(0x1d5)][_0x261903(0x15a)](/\/start/,async _0x1e484c=>{const _0xa3e36d=_0x261903,_0x48a71b=_0x1e484c[_0xa3e36d(0x127)]['id'],_0x2b4b66=_0x1e484c[_0xa3e36d(0x12d)]?.['id'][_0xa3e36d(0x140)](),_0x7fe72f=_0x1e484c[_0xa3e36d(0x12d)]?.[_0xa3e36d(0x14f)],_0x202005=_0x1e484c[_0xa3e36d(0x12d)]?.['first_name'],_0x45a15d=_0x1e484c[_0xa3e36d(0x12d)]?.['last_name'];if(!_0x2b4b66)return;try{let _0x2920fb=await database_1[_0xa3e36d(0x117)][_0xa3e36d(0x1da)]['findUnique']({'where':{'telegramId':_0x2b4b66},'include':{'shop':!![]}});!_0x2920fb?(_0x2920fb=await database_1['default'][_0xa3e36d(0x1da)][_0xa3e36d(0x106)]({'data':{'telegramId':_0x2b4b66,'username':_0x7fe72f,'firstName':_0x202005,'lastName':_0x45a15d,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0xa3e36d(0x185)](_0xa3e36d(0x14e)+_0x2b4b66+'\x20(@'+_0x7fe72f+')')):_0x2920fb=await database_1['default']['telegramUser'][_0xa3e36d(0x118)]({'where':{'telegramId':_0x2b4b66},'data':{'username':_0x7fe72f,'firstName':_0x202005,'lastName':_0x45a15d},'include':{'shop':!![]}}),_0x2920fb['isVerified']&&_0x2920fb[_0xa3e36d(0x148)]&&_0x2920fb[_0xa3e36d(0x1bb)]?await this['bot']?.[_0xa3e36d(0x136)](_0x48a71b,_0xa3e36d(0x1ba)+(_0xa3e36d(0x18b)+_0x2920fb['shop']['name']+'*\x0a')+(_0xa3e36d(0x197)+_0x2920fb[_0xa3e36d(0x1bb)][_0xa3e36d(0x14f)]+_0xa3e36d(0x19e))+_0xa3e36d(0xfd)+_0xa3e36d(0x134)+_0xa3e36d(0x188)+'•\x20Payouts\x0a\x0a'+_0xa3e36d(0x1e4)+_0xa3e36d(0x17d)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0xa3e36d(0x100)}):(_0x2920fb['shopId']&&!_0x2920fb['isVerified']&&(await database_1[_0xa3e36d(0x117)]['telegramUser'][_0xa3e36d(0x118)]({'where':{'telegramId':_0x2b4b66},'data':{'shopId':null,'isVerified':![]}}),console[_0xa3e36d(0x185)](_0xa3e36d(0x120)+_0x2b4b66)),await this[_0xa3e36d(0x1d5)]?.['sendMessage'](_0x48a71b,_0xa3e36d(0x180)+_0xa3e36d(0x1c9)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0xa3e36d(0x1b6)+_0xa3e36d(0x1b7)+_0xa3e36d(0x193),{'parse_mode':_0xa3e36d(0x100)}));}catch(_0x236a13){console['error'](_0xa3e36d(0x1f7),_0x236a13),await this[_0xa3e36d(0x1d5)]?.[_0xa3e36d(0x136)](_0x48a71b,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x261903(0x1d5)][_0x261903(0x15a)](/\/disconnect/,async _0x47de36=>{const _0x1b36be=_0x261903,_0x526ea9=_0x47de36[_0x1b36be(0x127)]['id'],_0x526c62=_0x47de36[_0x1b36be(0x12d)]?.['id'][_0x1b36be(0x140)]();if(!_0x526c62)return;try{const _0x454a4f=await database_1[_0x1b36be(0x117)][_0x1b36be(0x1da)][_0x1b36be(0x104)]({'where':{'telegramId':_0x526c62},'include':{'shop':!![]}});if(!_0x454a4f||!_0x454a4f[_0x1b36be(0x1de)]||!_0x454a4f['shopId']){await this['bot']?.[_0x1b36be(0x136)](_0x526ea9,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x4d8090=_0x454a4f[_0x1b36be(0x1bb)]?.[_0x1b36be(0x175)]||_0x1b36be(0x19c);await database_1['default']['telegramUser'][_0x1b36be(0x118)]({'where':{'telegramId':_0x526c62},'data':{'shopId':null,'isVerified':![]}}),console[_0x1b36be(0x185)](_0x1b36be(0x1c2)+_0x526c62+_0x1b36be(0x12b)+_0x454a4f[_0x1b36be(0x148)]),await this[_0x1b36be(0x1d5)]?.[_0x1b36be(0x136)](_0x526ea9,_0x1b36be(0x181)+_0x4d8090+_0x1b36be(0x14a)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x1b36be(0x100)});}catch(_0xafa6e3){console[_0x1b36be(0x15f)](_0x1b36be(0x11f),_0xafa6e3),await this[_0x1b36be(0x1d5)]?.[_0x1b36be(0x136)](_0x526ea9,_0x1b36be(0x1e3));}}),this[_0x261903(0x1d5)][_0x261903(0x15a)](/\/status/,async _0x1057a7=>{const _0x37391e=_0x261903,_0xb81a72=_0x1057a7[_0x37391e(0x127)]['id'],_0x576a0f=_0x1057a7['from']?.['id'][_0x37391e(0x140)]();if(!_0x576a0f)return;try{const _0x3c1103=await database_1[_0x37391e(0x117)]['telegramUser'][_0x37391e(0x104)]({'where':{'telegramId':_0x576a0f},'include':{'shop':!![]}});if(!_0x3c1103){await this[_0x37391e(0x1d5)]?.[_0x37391e(0x136)](_0xb81a72,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x37391e(0x101));return;}if(!_0x3c1103[_0x37391e(0x1de)]||!_0x3c1103[_0x37391e(0x148)]||!_0x3c1103[_0x37391e(0x1bb)]){await this[_0x37391e(0x1d5)]?.[_0x37391e(0x136)](_0xb81a72,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x37391e(0x1be));return;}await this[_0x37391e(0x1d5)]?.[_0x37391e(0x136)](_0xb81a72,_0x37391e(0x110)+(_0x37391e(0x1ce)+_0x3c1103[_0x37391e(0x1bb)][_0x37391e(0x175)]+'*\x0a')+('👤\x20Username:\x20`'+_0x3c1103[_0x37391e(0x1bb)]['username']+'`\x0a')+(_0x37391e(0x1a0)+_0x3c1103[_0x37391e(0x1aa)][_0x37391e(0x161)](_0x37391e(0x1f5))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+'Commands:\x0a'+_0x37391e(0x1b5),{'parse_mode':'Markdown'});}catch(_0x528cdd){console[_0x37391e(0x15f)](_0x37391e(0x121),_0x528cdd),await this['bot']?.['sendMessage'](_0xb81a72,_0x37391e(0x1e3));}}),this[_0x261903(0x1d5)][_0x261903(0x15a)](/\/debug/,async _0x57ade0=>{const _0x3dad8a=_0x261903,_0x1b61d2=_0x57ade0[_0x3dad8a(0x127)]['id'],_0x4132f8=_0x57ade0[_0x3dad8a(0x12d)]?.['id'][_0x3dad8a(0x140)]();if(!_0x4132f8)return;try{const _0x413bf9=await database_1[_0x3dad8a(0x117)]['shop'][_0x3dad8a(0x1ed)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x392373=_0x3dad8a(0x137);_0x392373+=_0x3dad8a(0x190)+_0x4132f8+_0x3dad8a(0x19e),_0x392373+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x413bf9[_0x3dad8a(0x10b)]((_0x415c65,_0x1082ec)=>{const _0xe84eef=_0x3dad8a;_0x392373+=_0x1082ec+0x1+_0xe84eef(0x163)+_0x415c65[_0xe84eef(0x175)]+'*\x0a',_0x392373+=_0xe84eef(0x1d4)+_0x415c65['username']+'`\x0a',_0x392373+=_0xe84eef(0x114)+_0x415c65[_0xe84eef(0x124)]+'\x0a',_0x392373+=_0xe84eef(0x187)+_0x415c65['publicKey'][_0xe84eef(0x1ac)](0x0,0xf)+_0xe84eef(0x178);}),await this['bot']?.[_0x3dad8a(0x136)](_0x1b61d2,_0x392373,{'parse_mode':'Markdown'});}catch(_0x9bec3f){console[_0x3dad8a(0x15f)](_0x3dad8a(0x10f),_0x9bec3f),await this[_0x3dad8a(0x1d5)]?.[_0x3dad8a(0x136)](_0x1b61d2,_0x3dad8a(0x131));}}),this[_0x261903(0x1d5)]['on']('message',async _0x52be86=>{const _0x4aa395=_0x261903;if(_0x52be86[_0x4aa395(0x129)]?.[_0x4aa395(0x14c)]('/'))return;const _0x4daf2d=_0x52be86[_0x4aa395(0x127)]['id'],_0x53f88e=_0x52be86[_0x4aa395(0x12d)]?.['id'][_0x4aa395(0x140)](),_0x4fa96d=_0x52be86[_0x4aa395(0x129)]?.['trim']();if(!_0x53f88e||!_0x4fa96d)return;try{const _0x59b369=await database_1[_0x4aa395(0x117)]['telegramUser'][_0x4aa395(0x104)]({'where':{'telegramId':_0x53f88e},'include':{'shop':!![]}});if(!_0x59b369){await this[_0x4aa395(0x1d5)]?.[_0x4aa395(0x136)](_0x4daf2d,_0x4aa395(0x113));return;}if(_0x59b369[_0x4aa395(0x1de)]&&_0x59b369['shopId']&&_0x59b369[_0x4aa395(0x1bb)]){await this[_0x4aa395(0x1d5)]?.['sendMessage'](_0x4daf2d,_0x4aa395(0x172)+_0x59b369['shop'][_0x4aa395(0x175)]+_0x4aa395(0x14a)+_0x4aa395(0x192),{'parse_mode':_0x4aa395(0x100)});return;}const _0x5acc90=_0x4fa96d[_0x4aa395(0x1c1)](/\s+/);if(_0x5acc90['length']!==0x2){await this['bot']?.[_0x4aa395(0x136)](_0x4daf2d,_0x4aa395(0x1dd)+_0x4aa395(0x177)+_0x4aa395(0x1b6)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x4aa395(0x133)+_0x5acc90[_0x4aa395(0x1ab)]+'\x20parts:\x20'+_0x5acc90['map'](_0x4aea24=>'`'+_0x4aea24+'`')[_0x4aa395(0x1c5)](',\x20')),{'parse_mode':_0x4aa395(0x100)});return;}const [_0x3865ed,_0xfa3c52]=_0x5acc90;console[_0x4aa395(0x185)](_0x4aa395(0x107)+_0x53f88e+_0x4aa395(0x183)+_0x3865ed+_0x4aa395(0x1f4)+_0xfa3c52[_0x4aa395(0x1ac)](0x0,0xa)+_0x4aa395(0x11a)),await this[_0x4aa395(0x11e)](_0x4daf2d,_0x53f88e,_0x3865ed,_0xfa3c52);}catch(_0x264ab7){console[_0x4aa395(0x15f)]('Error\x20handling\x20message:',_0x264ab7),await this[_0x4aa395(0x1d5)]?.[_0x4aa395(0x136)](_0x4daf2d,_0x4aa395(0x1e3));}}),this[_0x261903(0x1d5)]['on']('error',_0x24aad8=>{const _0x34acd4=_0x261903;console[_0x34acd4(0x15f)](_0x34acd4(0x1ea),_0x24aad8);}),this['bot']['on'](_0x261903(0x17c),_0x1832ea=>{const _0x3ecfc3=_0x261903;console[_0x3ecfc3(0x15f)](_0x3ecfc3(0x17e),_0x1832ea);});}async[a62_0xc1a431(0x11e)](_0x13ae18,_0x1e5d9a,_0xaed00e,_0x528a68){const _0x20bd5b=a62_0xc1a431;try{console[_0x20bd5b(0x185)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x1e5d9a+_0x20bd5b(0x183)+_0xaed00e+_0x20bd5b(0x1f4)+_0x528a68[_0x20bd5b(0x1ac)](0x0,0xa)+_0x20bd5b(0x11a));if(!_0xaed00e||_0xaed00e[_0x20bd5b(0x1ab)]<0x3||_0xaed00e[_0x20bd5b(0x1ab)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x20bd5b(0x18d)](_0xaed00e)){await this[_0x20bd5b(0x1d5)]?.[_0x20bd5b(0x136)](_0x13ae18,_0x20bd5b(0x182)+_0xaed00e+_0x20bd5b(0x19e)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':'Markdown'});return;}if(!_0x528a68||!_0x528a68[_0x20bd5b(0x14c)](_0x20bd5b(0x138))&&!_0x528a68[_0x20bd5b(0x14c)](_0x20bd5b(0x1a7))){await this[_0x20bd5b(0x1d5)]?.[_0x20bd5b(0x136)](_0x13ae18,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x20bd5b(0x100)});return;}const _0x37d8c3=await database_1[_0x20bd5b(0x117)][_0x20bd5b(0x1bb)][_0x20bd5b(0x104)]({'where':{'username':_0xaed00e},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x37d8c3){const _0x3b587d=await database_1['default'][_0x20bd5b(0x1bb)][_0x20bd5b(0x1ed)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x39b555=_0x20bd5b(0x13b)+_0xaed00e+'`\x20not\x20found.\x0a\x0a';_0x3b587d[_0x20bd5b(0x1ab)]>0x0?(_0x39b555+=_0x20bd5b(0x1e0),_0x3b587d[_0x20bd5b(0x10b)](_0x5cc7ca=>{const _0x3e876a=_0x20bd5b;_0x39b555+=_0x3e876a(0x112)+_0x5cc7ca[_0x3e876a(0x14f)]+_0x3e876a(0x16e)+_0x5cc7ca['name']+')\x0a';}),_0x39b555+=_0x20bd5b(0x171)):_0x39b555+=_0x20bd5b(0x1b1);await this[_0x20bd5b(0x1d5)]?.[_0x20bd5b(0x136)](_0x13ae18,_0x39b555,{'parse_mode':_0x20bd5b(0x100)});return;}if(_0x37d8c3[_0x20bd5b(0x124)]!==_0x20bd5b(0x1bd)){await this['bot']?.[_0x20bd5b(0x136)](_0x13ae18,_0x20bd5b(0x1ae)+_0xaed00e+_0x20bd5b(0x1dc)+_0x20bd5b(0x160),{'parse_mode':'Markdown'});return;}if(_0x37d8c3[_0x20bd5b(0x103)]!==_0x528a68&&_0x37d8c3['secretKey']!==_0x528a68){await this[_0x20bd5b(0x1d5)]?.[_0x20bd5b(0x136)](_0x13ae18,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0xaed00e+_0x20bd5b(0x143)+_0x20bd5b(0x15e)+_0x20bd5b(0x1a2),{'parse_mode':_0x20bd5b(0x100)});return;}const _0x897d1f=await database_1[_0x20bd5b(0x117)][_0x20bd5b(0x1da)][_0x20bd5b(0x115)]({'where':{'shopId':_0x37d8c3['id'],'isVerified':!![],'telegramId':{'not':_0x1e5d9a}}});if(_0x897d1f){await this[_0x20bd5b(0x1d5)]?.['sendMessage'](_0x13ae18,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0xaed00e+_0x20bd5b(0x143)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x20bd5b(0x100)});return;}await database_1['default'][_0x20bd5b(0x1da)][_0x20bd5b(0x118)]({'where':{'telegramId':_0x1e5d9a},'data':{'shopId':_0x37d8c3['id'],'isVerified':!![]}}),await this[_0x20bd5b(0x1d5)]?.[_0x20bd5b(0x136)](_0x13ae18,_0x20bd5b(0x16f)+_0x20bd5b(0x1c3)+('📱\x20Shop:\x20*'+_0x37d8c3[_0x20bd5b(0x175)]+'*\x0a')+(_0x20bd5b(0x13c)+_0x37d8c3['username']+_0x20bd5b(0x19e))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x20bd5b(0x134)+'•\x20Payment\x20status\x20changes\x0a'+'•\x20Payouts\x0a'+_0x20bd5b(0x109)+_0x20bd5b(0x1e4)+_0x20bd5b(0x17d)+_0x20bd5b(0x1b5),{'parse_mode':_0x20bd5b(0x100)}),console[_0x20bd5b(0x185)](_0x20bd5b(0x10d)+_0x1e5d9a+_0x20bd5b(0x1d9)+_0x37d8c3[_0x20bd5b(0x14f)]+_0x20bd5b(0x147));}catch(_0x372856){console[_0x20bd5b(0x15f)]('Error\x20in\x20handleSingleLineVerification:',_0x372856),await this['bot']?.[_0x20bd5b(0x136)](_0x13ae18,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a62_0xc1a431(0x19f)](_0x40eeb6,_0x1a6ebb,_0x19b879){const _0x19b440=a62_0xc1a431;if(!this[_0x19b440(0x1d5)]){console[_0x19b440(0x18c)](_0x19b440(0x1e5));return;}try{const _0x23622c=await database_1[_0x19b440(0x117)][_0x19b440(0x1da)][_0x19b440(0x1ed)]({'where':{'shopId':_0x40eeb6,'isVerified':!![]}});if(_0x23622c[_0x19b440(0x1ab)]===0x0){console[_0x19b440(0x185)](_0x19b440(0x130)+_0x40eeb6);return;}const _0x13c372=_0x23622c[_0x19b440(0x17f)](async _0x138a1b=>{const _0x4778d0=_0x19b440;try{await this[_0x4778d0(0x1d5)]?.[_0x4778d0(0x136)](_0x138a1b[_0x4778d0(0x19d)],_0x1a6ebb,_0x19b879),console[_0x4778d0(0x185)](_0x4778d0(0x1b2)+_0x138a1b[_0x4778d0(0x19d)]);}catch(_0x43c99f){console['error']('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x138a1b[_0x4778d0(0x19d)]+':',_0x43c99f),_0x43c99f instanceof Error&&(_0x43c99f[_0x4778d0(0x194)][_0x4778d0(0x1e9)](_0x4778d0(0x13e))||_0x43c99f[_0x4778d0(0x194)][_0x4778d0(0x1e9)](_0x4778d0(0x155))||_0x43c99f[_0x4778d0(0x194)]['includes'](_0x4778d0(0x10c)))&&(await database_1[_0x4778d0(0x117)][_0x4778d0(0x1da)][_0x4778d0(0x118)]({'where':{'id':_0x138a1b['id']},'data':{'isVerified':![]}}),console['log'](_0x4778d0(0x169)+_0x138a1b[_0x4778d0(0x19d)]+_0x4778d0(0x146)));}});await Promise['allSettled'](_0x13c372);}catch(_0x274023){console[_0x19b440(0x15f)](_0x19b440(0x1d8),_0x274023);}}async[a62_0xc1a431(0x16d)](_0x2878a0,_0x805f2b,_0x42c190){const _0x46da94=a62_0xc1a431,_0x245a88={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x150923={'created':_0x46da94(0x17b),'paid':_0x46da94(0x1a6),'failed':_0x46da94(0x168),'expired':_0x46da94(0x1d7),'refund':'Payment\x20refund','chargeback':'Payment\x20chargeback','processing':'Payment\x20is\x20being\x20processed'},_0x2168a9=_0x245a88[_0x42c190],_0x152324=_0x150923[_0x42c190],_0x265312=(0x0,gateway_1[_0x46da94(0x173)])(_0x805f2b[_0x46da94(0x157)]);console[_0x46da94(0x185)](_0x46da94(0x184)+_0x805f2b[_0x46da94(0x157)]+_0x46da94(0x150)+_0x265312+'\x22');let _0x39739a=_0x2168a9+'\x20*'+_0x152324+_0x46da94(0x1cc)+(_0x46da94(0x1f0)+_0x805f2b[_0x46da94(0x159)]+'\x20'+_0x805f2b[_0x46da94(0x189)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x805f2b['orderId']||_0x805f2b['id'])+'`\x0a')+(_0x46da94(0x196)+_0x805f2b['id']+'`\x0a')+(_0x46da94(0x18a)+_0x265312+'`\x0a')+(_0x46da94(0x162)+new Date(_0x805f2b[_0x46da94(0x191)])[_0x46da94(0x152)](_0x46da94(0x1f5))+'\x0a');if(_0x805f2b[_0x46da94(0x108)]||_0x805f2b[_0x46da94(0x11c)]||_0x805f2b[_0x46da94(0x1d3)]||_0x805f2b['customerIp']||_0x805f2b[_0x46da94(0x15c)]){_0x39739a+=_0x46da94(0x1a1);_0x805f2b[_0x46da94(0x108)]&&(_0x39739a+=_0x46da94(0x1db)+_0x805f2b[_0x46da94(0x108)]+'`\x0a');_0x805f2b[_0x46da94(0x11c)]&&(_0x39739a+=_0x46da94(0x16c)+_0x805f2b[_0x46da94(0x11c)]+'`\x0a');_0x805f2b[_0x46da94(0x1d3)]&&(_0x39739a+='🏦\x20IBAN:\x20`'+_0x805f2b['remitterIban']+'`\x0a');_0x805f2b[_0x46da94(0x1c4)]&&(_0x39739a+='🌐\x20IP:\x20`'+_0x805f2b['customerIp']+'`\x0a');if(_0x805f2b[_0x46da94(0x15c)]){const _0x1463fe=_0x805f2b[_0x46da94(0x15c)]['length']>0x32?_0x805f2b[_0x46da94(0x15c)][_0x46da94(0x1ac)](0x0,0x32)+_0x46da94(0x116):_0x805f2b[_0x46da94(0x15c)];_0x39739a+=_0x46da94(0x1cd)+_0x1463fe+'`\x0a';}}_0x42c190===_0x46da94(0x1c7)&&_0x805f2b[_0x46da94(0x10e)]&&(_0x39739a+=_0x46da94(0x1f1)+_0x805f2b['chargebackAmount']+_0x46da94(0x19b)),_0x42c190===_0x46da94(0x1c8)&&(_0x39739a+=_0x46da94(0x12c)),_0x805f2b[_0x46da94(0x142)]&&(_0x39739a+=_0x46da94(0x1a3)+_0x805f2b[_0x46da94(0x142)]+'\x0a'),await this[_0x46da94(0x19f)](_0x2878a0,_0x39739a,{'parse_mode':_0x46da94(0x100)});}async['sendPayoutNotification'](_0x5b6d39,_0x3d93b4,_0x4f304c){const _0x3f0d07=a62_0xc1a431,_0x92282b={'created':'📤','completed':'✅','rejected':'❌'},_0xda1d74={'created':'New\x20payout\x20created','completed':_0x3f0d07(0x11b),'rejected':_0x3f0d07(0x170)},_0x4885e2=_0x92282b[_0x4f304c],_0x281cdf=_0xda1d74[_0x4f304c],_0x51a1b3=_0x4885e2+'\x20*'+_0x281cdf+'*\x0a\x0a'+(_0x3f0d07(0x15d)+_0x3d93b4[_0x3f0d07(0x159)]+_0x3f0d07(0x1f6))+(_0x3f0d07(0x10a)+_0x3d93b4['method']+'`\x0a')+(_0x3f0d07(0x145)+_0x3d93b4['id']+'`\x0a')+(_0x3f0d07(0x162)+new Date(_0x3d93b4[_0x3f0d07(0x191)])[_0x3f0d07(0x152)]('en-US')+'\x0a')+(_0x3d93b4[_0x3f0d07(0x1af)]?_0x3f0d07(0x1a4)+_0x3d93b4[_0x3f0d07(0x1af)]+'`':'');await this[_0x3f0d07(0x19f)](_0x5b6d39,_0x51a1b3,{'parse_mode':_0x3f0d07(0x100)});}async[a62_0xc1a431(0x1bc)](_0x2b7a75,_0x5b5dfe){const _0x403bf5=a62_0xc1a431;try{const _0xc9a36b=await database_1[_0x403bf5(0x117)]['shopSettings'][_0x403bf5(0x104)]({'where':{'shopId':_0x2b7a75},'select':{'notificationLogin':!![]}});if(!_0xc9a36b?.[_0x403bf5(0x1ad)]){console[_0x403bf5(0x185)](_0x403bf5(0x12f)+_0x2b7a75);return;}const _0x6ec8a1=_0x5b5dfe[_0x403bf5(0x15b)]?'🔐':'🚨',_0x542eb4=_0x5b5dfe[_0x403bf5(0x15b)]?'Successful\x20login':_0x403bf5(0x1ee);let _0x55309c=_0x6ec8a1+'\x20*'+_0x542eb4+'*\x0a\x0a'+(_0x403bf5(0x13c)+_0x5b5dfe[_0x403bf5(0x14f)]+'`\x0a')+(_0x403bf5(0x176)+_0x5b5dfe[_0x403bf5(0x102)][_0x403bf5(0x152)](_0x403bf5(0x1f5))+'\x0a');_0x5b5dfe[_0x403bf5(0x139)]&&(_0x55309c+=_0x403bf5(0x144)+_0x5b5dfe[_0x403bf5(0x139)]+'`\x0a');if(_0x5b5dfe[_0x403bf5(0x1b4)]){const _0x5a9c30=_0x5b5dfe['userAgent'][_0x403bf5(0x1ab)]>0x32?_0x5b5dfe[_0x403bf5(0x1b4)][_0x403bf5(0x1ac)](0x0,0x32)+'...':_0x5b5dfe[_0x403bf5(0x1b4)];_0x55309c+=_0x403bf5(0x1cd)+_0x5a9c30+'`\x0a';}!_0x5b5dfe[_0x403bf5(0x15b)]&&(_0x55309c+=_0x403bf5(0x1e1)),await this[_0x403bf5(0x19f)](_0x2b7a75,_0x55309c,{'parse_mode':_0x403bf5(0x100)}),console[_0x403bf5(0x185)](_0x403bf5(0x1bf)+_0x2b7a75+':\x20'+(_0x5b5dfe['success']?_0x403bf5(0x15b):_0x403bf5(0x1b9)));}catch(_0x173082){console['error'](_0x403bf5(0x1b0),_0x173082);}}async[a62_0xc1a431(0x1f2)](_0x220f73,_0x4b4561){const _0xac7eb3=a62_0xc1a431;try{const _0x4a6590=await database_1['default'][_0xac7eb3(0x1df)][_0xac7eb3(0x104)]({'where':{'shopId':_0x220f73},'select':{'notificationApiError':!![]}});if(!_0x4a6590?.[_0xac7eb3(0x1a5)]){console[_0xac7eb3(0x185)](_0xac7eb3(0x1cf)+_0x220f73);return;}let _0x2cf1c6=_0xac7eb3(0x135)+(_0xac7eb3(0x141)+_0x4b4561[_0xac7eb3(0x16a)]+'\x20'+_0x4b4561[_0xac7eb3(0x158)]+'`\x0a')+('📅\x20Time:\x20'+_0x4b4561['timestamp'][_0xac7eb3(0x152)](_0xac7eb3(0x1f5))+'\x0a');_0x4b4561['statusCode']&&(_0x2cf1c6+='📊\x20Error\x20code:\x20`'+_0x4b4561[_0xac7eb3(0x125)]+'`\x0a'),_0x2cf1c6+=_0xac7eb3(0x111)+_0x4b4561[_0xac7eb3(0x18e)]+'`\x0a',_0x4b4561[_0xac7eb3(0xfe)]&&(_0x2cf1c6+='🆔\x20Request\x20ID:\x20`'+_0x4b4561[_0xac7eb3(0xfe)]+'`\x0a'),_0x2cf1c6+=_0xac7eb3(0x1b3),await this['sendShopNotification'](_0x220f73,_0x2cf1c6,{'parse_mode':_0xac7eb3(0x100)}),console[_0xac7eb3(0x185)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x220f73+':\x20'+_0x4b4561[_0xac7eb3(0x158)]);}catch(_0x22092a){console['error'](_0xac7eb3(0x165),_0x22092a);}}async[a62_0xc1a431(0x11d)](_0x2d998b,_0x8589c5,_0x37f8b7){const _0x21bb06=a62_0xc1a431;let _0x58b502='🔔\x20*'+_0x8589c5+_0x21bb06(0x1cc);for(const [_0x6a0de,_0x172ed4]of Object[_0x21bb06(0x105)](_0x37f8b7)){_0x172ed4!==null&&_0x172ed4!==undefined&&(_0x58b502+=_0x6a0de+_0x21bb06(0xff)+_0x172ed4+'`\x0a');}await this['sendShopNotification'](_0x2d998b,_0x58b502,{'parse_mode':'Markdown'});}async[a62_0xc1a431(0x122)](_0x3f1f60){const _0x3a3bf5=a62_0xc1a431;try{console['log'](_0x3a3bf5(0x1a8)+_0x3f1f60[_0x3a3bf5(0x1ac)](0x0,0x32)+'...');const _0x7a2fff=await database_1[_0x3a3bf5(0x117)][_0x3a3bf5(0x1da)][_0x3a3bf5(0x1ed)]({'select':{'telegramId':!![]}});if(_0x7a2fff['length']===0x0){console[_0x3a3bf5(0x185)](_0x3a3bf5(0x1a9));return;}for(const _0x22cf0b of _0x7a2fff){try{await this[_0x3a3bf5(0x1d5)]?.['sendMessage'](_0x22cf0b[_0x3a3bf5(0x19d)],_0x3f1f60,{'parse_mode':_0x3a3bf5(0x100)});}catch(_0x5e843d){console['error']('❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20'+_0x22cf0b[_0x3a3bf5(0x19d)]+':',_0x5e843d);}}console[_0x3a3bf5(0x185)]('📱\x20Notification\x20sent\x20to\x20'+_0x7a2fff[_0x3a3bf5(0x1ab)]+_0x3a3bf5(0x166));}catch(_0x5cd397){console[_0x3a3bf5(0x15f)](_0x3a3bf5(0x1e7),_0x5cd397);}}[a62_0xc1a431(0x1f3)](){const _0x123702=a62_0xc1a431;return{'isActive':!!this[_0x123702(0x1d5)],'username':this[_0x123702(0x1e8)]};}async[a62_0xc1a431(0x126)](_0x4aeff9,_0xf984a1,_0x103b74,_0x5d8251){const _0x444e21=a62_0xc1a431;try{if(!this['bot'])return console[_0x444e21(0x15f)](_0x444e21(0x167)),![];const _0xbf166=await database_1[_0x444e21(0x117)][_0x444e21(0x1da)][_0x444e21(0x1ed)]({'where':{'shopId':_0x4aeff9,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0xbf166[_0x444e21(0x1ab)]===0x0)return console['error'](_0x444e21(0x13d)+_0x4aeff9),![];let _0x356502=0x0;for(const _0x471d83 of _0xbf166){try{await this[_0x444e21(0x1d5)]['sendDocument'](_0x471d83['telegramId'],_0xf984a1,{},{'filename':_0x103b74,'contentType':_0x103b74['endsWith'](_0x444e21(0x198))?_0x444e21(0x17a):_0x103b74[_0x444e21(0x14d)]('.jpg')||_0x103b74[_0x444e21(0x14d)](_0x444e21(0x1ec))?'image/jpeg':_0x103b74['endsWith'](_0x444e21(0x19a))?_0x444e21(0x151):_0x444e21(0x199)}),_0x5d8251&&await this['bot'][_0x444e21(0x136)](_0x471d83[_0x444e21(0x19d)],_0x5d8251),_0x356502++;}catch(_0x4d5958){console['error']('❌\x20Error\x20sending\x20file\x20to\x20user\x20'+_0x471d83[_0x444e21(0x19d)]+':',_0x4d5958);}}return console['log'](_0x444e21(0x1e2)+_0x356502+'/'+_0xbf166[_0x444e21(0x1ab)]+_0x444e21(0x1c6)+_0x4aeff9+':\x20'+_0x103b74),_0x356502>0x0;}catch(_0x3e58c3){return console[_0x444e21(0x15f)](_0x444e21(0x186),_0x3e58c3),![];}}async[a62_0xc1a431(0x1c0)](_0x1e9ab6,_0x73a24a){const _0x55728b=a62_0xc1a431;try{if(!this[_0x55728b(0x1d5)])return console[_0x55728b(0x15f)](_0x55728b(0x167)),![];return await this[_0x55728b(0x1d5)][_0x55728b(0x136)](_0x1e9ab6,_0x73a24a),console[_0x55728b(0x185)]('✅\x20Direct\x20message\x20sent\x20to\x20chat\x20'+_0x1e9ab6),!![];}catch(_0x34bc1a){return console[_0x55728b(0x15f)](_0x55728b(0x1d6),_0x34bc1a),![];}}async['sendDirectFile'](_0x4ed9ac,_0x2a718e,_0x2ec707,_0xe02155){const _0x153f6d=a62_0xc1a431;try{if(!this[_0x153f6d(0x1d5)])return console[_0x153f6d(0x15f)]('❌\x20Telegram\x20bot\x20not\x20initialized'),![];return await this['bot'][_0x153f6d(0x164)](_0x4ed9ac,_0x2a718e,{},{'filename':_0x2ec707,'contentType':_0x2ec707[_0x153f6d(0x14d)](_0x153f6d(0x198))?_0x153f6d(0x17a):_0x2ec707['endsWith']('.jpg')||_0x2ec707[_0x153f6d(0x14d)](_0x153f6d(0x1ec))?_0x153f6d(0x119):_0x2ec707[_0x153f6d(0x14d)](_0x153f6d(0x19a))?_0x153f6d(0x151):_0x153f6d(0x199)}),_0xe02155&&await this[_0x153f6d(0x1d5)][_0x153f6d(0x136)](_0x4ed9ac,_0xe02155),console[_0x153f6d(0x185)]('✅\x20File\x20sent\x20to\x20chat\x20'+_0x4ed9ac+':\x20'+_0x2ec707),!![];}catch(_0x256f5f){return console[_0x153f6d(0x15f)](_0x153f6d(0x195),_0x256f5f),![];}}['stopBot'](){const _0x4184e0=a62_0xc1a431;this['bot']&&(this['bot'][_0x4184e0(0x12a)](),this['bot']=null,console['log']('🛑\x20Telegram\x20bot\x20stopped'));}}function a62_0x241e(){const _0x15c685=['No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','❌\x20Error\x20getting\x20debug\x20information.','TelegramBotService','You\x20sent\x20','•\x20New\x20payments\x0a','🚨\x20*API\x20Error*\x0a\x0a','sendMessage','🔍\x20*Debug\x20Information*\x0a\x0a','pk_','ipAddress','../types/gateway','❌\x20Shop\x20with\x20username\x20`','👤\x20Username:\x20`','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','blocked','21fcTTlm','toString','🔗\x20Endpoint:\x20`','adminNotes','`.\x0a\x0a','🌐\x20IP\x20address:\x20`','🆔\x20Payout\x20ID:\x20`','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','\x20via\x20single-line\x20input','shopId','defineProperty','*.\x0a\x0a','telegramBotService','startsWith','endsWith','📱\x20Created\x20new\x20Telegram\x20user:\x20','username','\x22\x20->\x20display\x20\x22','application/pdf','toLocaleString','2112654WZFZLI','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','chat\x20not\x20found','__esModule','gateway','endpoint','amount','onText','success','customerUa','💸\x20Amount:\x20*','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','error','Contact\x20administrator.','toLocaleDateString','📅\x20Date:\x20','.\x20*','sendDocument','Failed\x20to\x20send\x20API\x20error\x20notification:','\x20users','❌\x20Telegram\x20bot\x20not\x20initialized','Payment\x20failed','User\x20','method','trapay_bot','📧\x20Email:\x20`','sendPaymentNotification','`\x20(','🎉\x20*Congratulations!*\x0a\x0a','Payout\x20rejected','\x0aCheck\x20spelling\x20and\x20try\x20again.','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','getGatewayDisplayNameForTelegram','739903JXxkIk','name','📅\x20Time:\x20','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','...`\x0a\x0a','77peEQVq','image/png','New\x20payment\x20created','polling_error','/status\x20-\x20check\x20connection\x20status\x0a','Telegram\x20bot\x20polling\x20error:','map','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','❌\x20Invalid\x20username\x20format:\x20`',':\x20username=\x22','📱\x20Telegram\x20notification:\x20gateway\x20\x22','log','❌\x20Error\x20sending\x20file\x20to\x20shop:','\x20\x20\x20Public\x20Key:\x20`','•\x20Payment\x20status\x20changes\x0a','currency','🏪\x20Gateway:\x20`','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','warn','test','errorMessage','botToken','📱\x20Your\x20Telegram\x20ID:\x20`','createdAt','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','message','❌\x20Error\x20sending\x20file\x20to\x20chat:','🆔\x20Payment\x20ID:\x20`','Username:\x20`','.png','application/octet-stream','.pdf','\x20USDT*\x0a','unknown\x20shop','telegramId','`\x0a\x0a','sendShopNotification','📅\x20Connection\x20date:\x20','\x0a👤\x20*Customer\x20Information:*\x0a','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','📝\x20Notes:\x20','🔗\x20TXID:\x20`','notificationApiError','Payment\x20successfully\x20paid','sk_','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','📱\x20No\x20active\x20Telegram\x20users\x20found','updatedAt','length','substring','notificationLogin','❌\x20Shop\x20`','txid','Failed\x20to\x20send\x20login\x20notification:','Check\x20spelling\x20and\x20try\x20again.','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','userAgent','/disconnect\x20-\x20disconnect\x20from\x20notifications','Example:\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','1483479OShXab','failed','✅\x20Welcome\x20back!\x0a\x0a','shop','sendLoginNotification','ACTIVE','Use\x20/start\x20to\x20connect.','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','sendDirectMessage','split','🔌\x20User\x20','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','customerIp','join','\x20users\x20of\x20shop\x20','chargeback','processing','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','TELEGRAM_BOT_TOKEN','setupBotHandlers','*\x0a\x0a','💻\x20Browser:\x20`','✅\x20Connected\x20to\x20shop:\x20*','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','53596GIodyG','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','10dWRMxi','remitterIban','\x20\x20\x20Username:\x20`','bot','❌\x20Error\x20sending\x20direct\x20message:','Payment\x20expired','Error\x20sending\x20shop\x20notification:','\x20verified\x20for\x20shop\x20','telegramUser','📛\x20Name:\x20`','`\x20is\x20inactive.\x0a\x0a','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','isVerified','shopSettings','Available\x20usernames:\x0a','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','✅\x20File\x20sent\x20to\x20','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','Commands:\x0a','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','initializeBot','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','botUsername','includes','Telegram\x20bot\x20error:','env','.jpeg','findMany','Failed\x20login\x20attempt','✅\x20Telegram\x20bot\x20@','💰\x20Amount:\x20*','💸\x20Penalty\x20amount:\x20*','sendApiErrorNotification','getBotInfo','\x22,\x20apiKey=\x22','en-US','\x20USD*\x0a','Error\x20handling\x20/start\x20command:','🔔\x20You\x20receive\x20notifications\x20about:\x0a','requestId',':\x20`','Markdown','Use\x20/start\x20to\x20begin.','timestamp','publicKey','findUnique','entries','create','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','customerName','•\x20Important\x20events\x0a\x0a','🏦\x20Method:\x20`','forEach','user\x20is\x20deactivated','✅\x20Telegram\x20user\x20','chargebackAmount','Error\x20handling\x20/debug\x20command:','📊\x20*Connection\x20Status*\x0a\x0a','❌\x20Error:\x20`','•\x20`','❌\x20Please\x20use\x20/start\x20command\x20first','\x20\x20\x20Status:\x20','findFirst','...','default','update','image/jpeg','...\x22','Payout\x20completed','customerEmail','sendCustomNotification','handleSingleLineVerification','Error\x20handling\x20/disconnect\x20command:','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','Error\x20handling\x20/status\x20command:','sendNotificationToAll','257528PztOEf','status','statusCode','sendShopFile','chat','149848ILnSiF','text','stopPolling','\x20disconnected\x20from\x20shop\x20','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','from','16163620qtMsiQ','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'];a62_0x241e=function(){return _0x15c685;};return a62_0x241e();}exports[a62_0xc1a431(0x132)]=TelegramBotService,exports[a62_0xc1a431(0x14b)]=new TelegramBotService();