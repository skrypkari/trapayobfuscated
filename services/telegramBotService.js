'use strict';const a53_0x27348e=a53_0x1c60;function a53_0x561f(){const _0x2403bc=['📱\x20Your\x20Telegram\x20ID:\x20`','Error\x20handling\x20/status\x20command:','join','first_name','userAgent','message','createdAt','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','stopPolling','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','shopSettings','Commands:\x0a','env','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','sendMessage','requestId','Payment\x20refund','📱\x20Created\x20new\x20Telegram\x20user:\x20','notificationApiError','botUsername','Payment\x20expired','❌\x20Shop\x20with\x20username\x20`','🌐\x20IP\x20address:\x20`','Payment\x20failed','•\x20Payment\x20status\x20changes\x0a','🔗\x20TXID:\x20`','\x22\x20->\x20display\x20\x22','secretKey','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','Error\x20sending\x20shop\x20notification:','substring','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','📝\x20Notes:\x20','sk_','New\x20payout\x20created','processing','Use\x20/start\x20to\x20connect.','Telegram\x20bot\x20polling\x20error:','❌\x20Invalid\x20username\x20format:\x20`','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','trapay_bot','gateway','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','toLocaleDateString','isVerified','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','status','chat\x20not\x20found','❌\x20Error\x20getting\x20debug\x20information.','sendLoginNotification','🔍\x20*Debug\x20Information*\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','telegramUser','allSettled','ipAddress','setupBotHandlers','onText','❌\x20Shop\x20`','defineProperty','...\x22','polling_error','💰\x20Amount:\x20*','💸\x20Penalty\x20amount:\x20*','\x20\x20\x20Public\x20Key:\x20`','shop','Telegram\x20bot\x20error:','🔔\x20*','🏦\x20Method:\x20`','pk_','__esModule','toString','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Failed\x20to\x20send\x20API\x20error\x20notification:','Failed\x20login\x20attempt','telegramId','🛑\x20Telegram\x20bot\x20stopped','endpoint','Error\x20handling\x20message:','Failed\x20to\x20send\x20login\x20notification:','\x20via\x20single-line\x20input','🔔\x20You\x20receive\x20notifications\x20about:\x0a','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','findFirst','💸\x20Amount:\x20*','adminNotes','startsWith','txid','Successful\x20login',':\x20username=\x22','warn','\x20disconnected\x20from\x20shop\x20','•\x20Important\x20events\x0a\x0a','forEach','❌\x20Error:\x20`','•\x20Payouts\x0a','`\x0a\x0a','user\x20is\x20deactivated','`\x20not\x20found.\x0a\x0a','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','✅\x20Connected\x20to\x20shop:\x20*','text','includes','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','📝\x20Order\x20ID:\x20`','TelegramBotService','getGatewayDisplayNameForTelegram','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','`\x20(','TELEGRAM_BOT_TOKEN','en-US','📅\x20Date:\x20','Example:\x0a','•\x20Payouts\x0a\x0a','🎉\x20*Congratulations!*\x0a\x0a','toLocaleString','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','updatedAt','\x20USD*\x0a','Payout\x20completed','Available\x20usernames:\x0a','💻\x20Browser:\x20`','\x20USDT*\x0a','Contact\x20administrator.','You\x20sent\x20','map','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','🔔\x20Notifications\x20are\x20active\x0a\x0a','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','sendCustomNotification','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','2254152ZdHbDD','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','Username:\x20`','findMany','success','Error\x20handling\x20/disconnect\x20command:','📊\x20Error\x20code:\x20`','\x0aCheck\x20spelling\x20and\x20try\x20again.','\x20verified\x20for\x20shop\x20','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','382833MnVpKo','•\x20New\x20payments\x0a','log','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','/disconnect\x20-\x20disconnect\x20from\x20notifications','🔗\x20Endpoint:\x20`','getBotInfo','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','__importDefault','shopId','/status\x20-\x20check\x20connection\x20status\x0a','🚨\x20*API\x20Error*\x0a\x0a','name','📱\x20Shop:\x20*','\x20initialized\x20successfully','📅\x20Time:\x20','3029676QAHXcf','timestamp','node-telegram-bot-api','../config/database','197291LHmnij','botToken','2958221kmcLpd','chargebackAmount','sendApiErrorNotification','🏪\x20Gateway:\x20`','\x20\x20\x20Status:\x20','2801528pjCTmm','default','👤\x20Username:\x20`','`.\x0a\x0a',':\x20`','customerName','bot','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','\x20parts:\x20','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','currency','Payment\x20chargeback','Markdown','split','...','findUnique','2sjxPcq','TELEGRAM_BOT_USERNAME','Error\x20in\x20handleSingleLineVerification:','Use\x20/start\x20to\x20begin.','\x22,\x20apiKey=\x22','sendShopNotification','✅\x20Welcome\x20back!\x0a\x0a','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','create','Check\x20spelling\x20and\x20try\x20again.','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','📧\x20Email:\x20`','method','📱\x20Telegram\x20notification:\x20gateway\x20\x22','🆔\x20Payment\x20ID:\x20`','handleSingleLineVerification','Payout\x20rejected','🏪\x20Available\x20shops\x20in\x20system:\x0a','ACTIVE','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','\x20\x20\x20Username:\x20`','chat','trim','error','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','username','telegramBotService','length','../types/gateway','sendPayoutNotification','customerEmail','statusCode','*\x0a\x0a','1025285yldmAA','✅\x20Telegram\x20bot\x20@','publicKey','from','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','🆔\x20Request\x20ID:\x20`','initializeBot','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','update','Payment\x20is\x20being\x20processed'];a53_0x561f=function(){return _0x2403bc;};return a53_0x561f();}(function(_0x54d41e,_0x5e2b99){const _0x197084=a53_0x1c60,_0x18bfb7=_0x54d41e();while(!![]){try{const _0x15cb26=parseInt(_0x197084(0x1f7))/0x1*(-parseInt(_0x197084(0x128))/0x2)+-parseInt(_0x197084(0x1e1))/0x3+parseInt(_0x197084(0x1fe))/0x4+parseInt(_0x197084(0x149))/0x5+parseInt(_0x197084(0x1f3))/0x6+-parseInt(_0x197084(0x1f9))/0x7+-parseInt(_0x197084(0x1d7))/0x8;if(_0x15cb26===_0x5e2b99)break;else _0x18bfb7['push'](_0x18bfb7['shift']());}catch(_0x2cd68e){_0x18bfb7['push'](_0x18bfb7['shift']());}}}(a53_0x561f,0x5d0b7));var __importDefault=this&&this[a53_0x27348e(0x1eb)]||function(_0x2ae581){const _0x286e4b=a53_0x27348e;return _0x2ae581&&_0x2ae581[_0x286e4b(0x19a)]?_0x2ae581:{'default':_0x2ae581};};Object[a53_0x27348e(0x18f)](exports,'__esModule',{'value':!![]}),exports[a53_0x27348e(0x142)]=exports[a53_0x27348e(0x1bd)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a53_0x27348e(0x1f5))),database_1=__importDefault(require(a53_0x27348e(0x1f6))),gateway_1=require(a53_0x27348e(0x144));class TelegramBotService{constructor(){const _0x241196=a53_0x27348e;this[_0x241196(0x11e)]=null,this[_0x241196(0x1f8)]=process[_0x241196(0x15f)][_0x241196(0x1c1)]||'',this[_0x241196(0x166)]=process[_0x241196(0x15f)][_0x241196(0x129)]||_0x241196(0x17b),this[_0x241196(0x1f8)]?this[_0x241196(0x14f)]():console['warn'](_0x241196(0x1e5));}[a53_0x27348e(0x14f)](){const _0x1bad7f=a53_0x27348e;try{this[_0x1bad7f(0x11e)]=new node_telegram_bot_api_1[(_0x1bad7f(0x1ff))](this[_0x1bad7f(0x1f8)],{'polling':!![]}),this[_0x1bad7f(0x18c)](),console[_0x1bad7f(0x1e3)](_0x1bad7f(0x14a)+this[_0x1bad7f(0x166)]+_0x1bad7f(0x1f1));}catch(_0x170460){console['error'](_0x1bad7f(0x15c),_0x170460);}}[a53_0x27348e(0x18c)](){const _0x5be161=a53_0x27348e;if(!this[_0x5be161(0x11e)])return;this[_0x5be161(0x11e)][_0x5be161(0x18d)](/\/start/,async _0x5e4b33=>{const _0x30b3e5=_0x5be161,_0x571def=_0x5e4b33[_0x30b3e5(0x13d)]['id'],_0x8ca838=_0x5e4b33['from']?.['id']['toString'](),_0x49b4f2=_0x5e4b33['from']?.[_0x30b3e5(0x141)],_0x1d7337=_0x5e4b33[_0x30b3e5(0x14c)]?.[_0x30b3e5(0x156)],_0x4a3c9c=_0x5e4b33[_0x30b3e5(0x14c)]?.['last_name'];if(!_0x8ca838)return;try{let _0x2a83b4=await database_1[_0x30b3e5(0x1ff)][_0x30b3e5(0x189)][_0x30b3e5(0x127)]({'where':{'telegramId':_0x8ca838},'include':{'shop':!![]}});!_0x2a83b4?(_0x2a83b4=await database_1[_0x30b3e5(0x1ff)][_0x30b3e5(0x189)][_0x30b3e5(0x130)]({'data':{'telegramId':_0x8ca838,'username':_0x49b4f2,'firstName':_0x1d7337,'lastName':_0x4a3c9c,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0x30b3e5(0x164)+_0x8ca838+'\x20(@'+_0x49b4f2+')')):_0x2a83b4=await database_1[_0x30b3e5(0x1ff)][_0x30b3e5(0x189)]['update']({'where':{'telegramId':_0x8ca838},'data':{'username':_0x49b4f2,'firstName':_0x1d7337,'lastName':_0x4a3c9c},'include':{'shop':!![]}}),_0x2a83b4[_0x30b3e5(0x17f)]&&_0x2a83b4[_0x30b3e5(0x1ec)]&&_0x2a83b4[_0x30b3e5(0x195)]?await this[_0x30b3e5(0x11e)]?.[_0x30b3e5(0x161)](_0x571def,_0x30b3e5(0x12e)+(_0x30b3e5(0x1b7)+_0x2a83b4[_0x30b3e5(0x195)][_0x30b3e5(0x1ef)]+'*\x0a')+(_0x30b3e5(0x1d9)+_0x2a83b4[_0x30b3e5(0x195)][_0x30b3e5(0x141)]+_0x30b3e5(0x1b4))+_0x30b3e5(0x1a5)+_0x30b3e5(0x1e2)+_0x30b3e5(0x16b)+_0x30b3e5(0x1c5)+_0x30b3e5(0x15e)+_0x30b3e5(0x1ed)+_0x30b3e5(0x1e7),{'parse_mode':_0x30b3e5(0x124)}):(_0x2a83b4['shopId']&&!_0x2a83b4[_0x30b3e5(0x17f)]&&(await database_1[_0x30b3e5(0x1ff)][_0x30b3e5(0x189)]['update']({'where':{'telegramId':_0x8ca838},'data':{'shopId':null,'isVerified':![]}}),console[_0x30b3e5(0x1e3)](_0x30b3e5(0x188)+_0x8ca838)),await this[_0x30b3e5(0x11e)]?.[_0x30b3e5(0x161)](_0x571def,_0x30b3e5(0x1d4)+_0x30b3e5(0x1e4)+_0x30b3e5(0x187)+_0x30b3e5(0x1c4)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x30b3e5(0x160),{'parse_mode':'Markdown'}));}catch(_0x2e9966){console[_0x30b3e5(0x13f)]('Error\x20handling\x20/start\x20command:',_0x2e9966),await this[_0x30b3e5(0x11e)]?.[_0x30b3e5(0x161)](_0x571def,_0x30b3e5(0x17a));}}),this[_0x5be161(0x11e)][_0x5be161(0x18d)](/\/disconnect/,async _0x2b2177=>{const _0x503636=_0x5be161,_0x51b595=_0x2b2177[_0x503636(0x13d)]['id'],_0x2f1a39=_0x2b2177[_0x503636(0x14c)]?.['id'][_0x503636(0x19b)]();if(!_0x2f1a39)return;try{const _0x541656=await database_1[_0x503636(0x1ff)][_0x503636(0x189)][_0x503636(0x127)]({'where':{'telegramId':_0x2f1a39},'include':{'shop':!![]}});if(!_0x541656||!_0x541656[_0x503636(0x17f)]||!_0x541656[_0x503636(0x1ec)]){await this['bot']?.['sendMessage'](_0x51b595,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x3ce7c2=_0x541656[_0x503636(0x195)]?.[_0x503636(0x1ef)]||'unknown\x20shop';await database_1['default'][_0x503636(0x189)][_0x503636(0x151)]({'where':{'telegramId':_0x2f1a39},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔌\x20User\x20'+_0x2f1a39+_0x503636(0x1af)+_0x541656['shopId']),await this[_0x503636(0x11e)]?.[_0x503636(0x161)](_0x51b595,_0x503636(0x186)+_0x3ce7c2+'*.\x0a\x0a'+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x503636(0x124)});}catch(_0x21d772){console[_0x503636(0x13f)](_0x503636(0x1dc),_0x21d772),await this['bot']?.[_0x503636(0x161)](_0x51b595,_0x503636(0x17a));}}),this[_0x5be161(0x11e)][_0x5be161(0x18d)](/\/status/,async _0x434316=>{const _0x4597ae=_0x5be161,_0x5e6108=_0x434316[_0x4597ae(0x13d)]['id'],_0x11a460=_0x434316[_0x4597ae(0x14c)]?.['id'][_0x4597ae(0x19b)]();if(!_0x11a460)return;try{const _0x2b2d2e=await database_1[_0x4597ae(0x1ff)]['telegramUser'][_0x4597ae(0x127)]({'where':{'telegramId':_0x11a460},'include':{'shop':!![]}});if(!_0x2b2d2e){await this[_0x4597ae(0x11e)]?.[_0x4597ae(0x161)](_0x5e6108,_0x4597ae(0x1bb)+_0x4597ae(0x12b));return;}if(!_0x2b2d2e[_0x4597ae(0x17f)]||!_0x2b2d2e[_0x4597ae(0x1ec)]||!_0x2b2d2e['shop']){await this[_0x4597ae(0x11e)]?.['sendMessage'](_0x5e6108,_0x4597ae(0x14d)+_0x4597ae(0x177));return;}await this['bot']?.['sendMessage'](_0x5e6108,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x4597ae(0x1b8)+_0x2b2d2e[_0x4597ae(0x195)][_0x4597ae(0x1ef)]+'*\x0a')+(_0x4597ae(0x200)+_0x2b2d2e['shop'][_0x4597ae(0x141)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x2b2d2e[_0x4597ae(0x1c9)][_0x4597ae(0x17e)](_0x4597ae(0x1c2))+'\x0a\x0a')+_0x4597ae(0x1d3)+_0x4597ae(0x15e)+_0x4597ae(0x1e7),{'parse_mode':'Markdown'});}catch(_0x134c80){console[_0x4597ae(0x13f)](_0x4597ae(0x154),_0x134c80),await this[_0x4597ae(0x11e)]?.[_0x4597ae(0x161)](_0x5e6108,_0x4597ae(0x17a));}}),this[_0x5be161(0x11e)][_0x5be161(0x18d)](/\/debug/,async _0x552075=>{const _0x4721dc=_0x5be161,_0x1280f6=_0x552075[_0x4721dc(0x13d)]['id'],_0x95cc7=_0x552075[_0x4721dc(0x14c)]?.['id']['toString']();if(!_0x95cc7)return;try{const _0x3f4f65=await database_1[_0x4721dc(0x1ff)][_0x4721dc(0x195)][_0x4721dc(0x1da)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x2f99cd=_0x4721dc(0x185);_0x2f99cd+=_0x4721dc(0x153)+_0x95cc7+'`\x0a\x0a',_0x2f99cd+=_0x4721dc(0x139),_0x3f4f65['forEach']((_0x56d050,_0x16a791)=>{const _0x55191=_0x4721dc;_0x2f99cd+=_0x16a791+0x1+'.\x20*'+_0x56d050[_0x55191(0x1ef)]+'*\x0a',_0x2f99cd+=_0x55191(0x13c)+_0x56d050['username']+'`\x0a',_0x2f99cd+=_0x55191(0x1fd)+_0x56d050[_0x55191(0x181)]+'\x0a',_0x2f99cd+=_0x55191(0x194)+_0x56d050[_0x55191(0x14b)][_0x55191(0x171)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x4721dc(0x11e)]?.[_0x4721dc(0x161)](_0x1280f6,_0x2f99cd,{'parse_mode':_0x4721dc(0x124)});}catch(_0x392cfa){console['error']('Error\x20handling\x20/debug\x20command:',_0x392cfa),await this['bot']?.[_0x4721dc(0x161)](_0x1280f6,_0x4721dc(0x183));}}),this[_0x5be161(0x11e)]['on'](_0x5be161(0x158),async _0xbf9e7d=>{const _0xd14d04=_0x5be161;if(_0xbf9e7d['text']?.[_0xd14d04(0x1aa)]('/'))return;const _0x5a85a4=_0xbf9e7d['chat']['id'],_0xee41ae=_0xbf9e7d['from']?.['id']['toString'](),_0x4e33b7=_0xbf9e7d[_0xd14d04(0x1b9)]?.[_0xd14d04(0x13e)]();if(!_0xee41ae||!_0x4e33b7)return;try{const _0x566b8e=await database_1[_0xd14d04(0x1ff)][_0xd14d04(0x189)][_0xd14d04(0x127)]({'where':{'telegramId':_0xee41ae},'include':{'shop':!![]}});if(!_0x566b8e){await this[_0xd14d04(0x11e)]?.['sendMessage'](_0x5a85a4,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x566b8e[_0xd14d04(0x17f)]&&_0x566b8e['shopId']&&_0x566b8e[_0xd14d04(0x195)]){await this[_0xd14d04(0x11e)]?.[_0xd14d04(0x161)](_0x5a85a4,_0xd14d04(0x1e6)+_0x566b8e[_0xd14d04(0x195)][_0xd14d04(0x1ef)]+'*.\x0a\x0a'+_0xd14d04(0x180),{'parse_mode':_0xd14d04(0x124)});return;}const _0x4515c1=_0x4e33b7[_0xd14d04(0x125)](/\s+/);if(_0x4515c1['length']!==0x2){await this[_0xd14d04(0x11e)]?.[_0xd14d04(0x161)](_0x5a85a4,_0xd14d04(0x1ea)+_0xd14d04(0x187)+'Example:\x0a'+_0xd14d04(0x1e0)+(_0xd14d04(0x1d0)+_0x4515c1[_0xd14d04(0x143)]+_0xd14d04(0x120)+_0x4515c1[_0xd14d04(0x1d1)](_0x2648bd=>'`'+_0x2648bd+'`')[_0xd14d04(0x155)](',\x20')),{'parse_mode':_0xd14d04(0x124)});return;}const [_0x4615c5,_0x722051]=_0x4515c1;console[_0xd14d04(0x1e3)](_0xd14d04(0x19c)+_0xee41ae+':\x20username=\x22'+_0x4615c5+_0xd14d04(0x12c)+_0x722051['substring'](0x0,0xa)+_0xd14d04(0x190)),await this[_0xd14d04(0x137)](_0x5a85a4,_0xee41ae,_0x4615c5,_0x722051);}catch(_0x279909){console[_0xd14d04(0x13f)](_0xd14d04(0x1a2),_0x279909),await this['bot']?.[_0xd14d04(0x161)](_0x5a85a4,_0xd14d04(0x17a));}}),this[_0x5be161(0x11e)]['on'](_0x5be161(0x13f),_0x1715ce=>{const _0x5432a6=_0x5be161;console['error'](_0x5432a6(0x196),_0x1715ce);}),this['bot']['on'](_0x5be161(0x191),_0x5c3edf=>{const _0x3347da=_0x5be161;console[_0x3347da(0x13f)](_0x3347da(0x178),_0x5c3edf);});}async[a53_0x27348e(0x137)](_0x89c658,_0x1dd44b,_0x317c51,_0x18f7fc){const _0xe46f16=a53_0x27348e;try{console['log']('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x1dd44b+_0xe46f16(0x1ad)+_0x317c51+_0xe46f16(0x12c)+_0x18f7fc['substring'](0x0,0xa)+_0xe46f16(0x190));if(!_0x317c51||_0x317c51[_0xe46f16(0x143)]<0x3||_0x317c51[_0xe46f16(0x143)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x317c51)){await this[_0xe46f16(0x11e)]?.[_0xe46f16(0x161)](_0x89c658,_0xe46f16(0x179)+_0x317c51+_0xe46f16(0x1b4)+_0xe46f16(0x1d8),{'parse_mode':'Markdown'});return;}if(!_0x18f7fc||!_0x18f7fc['startsWith'](_0xe46f16(0x199))&&!_0x18f7fc[_0xe46f16(0x1aa)](_0xe46f16(0x174))){await this[_0xe46f16(0x11e)]?.[_0xe46f16(0x161)](_0x89c658,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0xe46f16(0x1c8),{'parse_mode':'Markdown'});return;}const _0x22f2a8=await database_1[_0xe46f16(0x1ff)]['shop'][_0xe46f16(0x127)]({'where':{'username':_0x317c51},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x22f2a8){const _0x1a8725=await database_1[_0xe46f16(0x1ff)][_0xe46f16(0x195)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x332431=_0xe46f16(0x168)+_0x317c51+_0xe46f16(0x1b6);_0x1a8725[_0xe46f16(0x143)]>0x0?(_0x332431+=_0xe46f16(0x1cc),_0x1a8725[_0xe46f16(0x1b1)](_0x534374=>{const _0x6a494e=_0xe46f16;_0x332431+='•\x20`'+_0x534374[_0x6a494e(0x141)]+_0x6a494e(0x1c0)+_0x534374[_0x6a494e(0x1ef)]+')\x0a';}),_0x332431+=_0xe46f16(0x1de)):_0x332431+=_0xe46f16(0x131);await this[_0xe46f16(0x11e)]?.[_0xe46f16(0x161)](_0x89c658,_0x332431,{'parse_mode':'Markdown'});return;}if(_0x22f2a8['status']!==_0xe46f16(0x13a)){await this['bot']?.[_0xe46f16(0x161)](_0x89c658,_0xe46f16(0x18e)+_0x317c51+'`\x20is\x20inactive.\x0a\x0a'+_0xe46f16(0x1cf),{'parse_mode':_0xe46f16(0x124)});return;}if(_0x22f2a8[_0xe46f16(0x14b)]!==_0x18f7fc&&_0x22f2a8[_0xe46f16(0x16e)]!==_0x18f7fc){await this['bot']?.[_0xe46f16(0x161)](_0x89c658,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x317c51+_0xe46f16(0x201)+_0xe46f16(0x140)+_0xe46f16(0x1d6),{'parse_mode':'Markdown'});return;}const _0x59ade0=await database_1[_0xe46f16(0x1ff)][_0xe46f16(0x189)][_0xe46f16(0x1a7)]({'where':{'shopId':_0x22f2a8['id'],'isVerified':!![],'telegramId':{'not':_0x1dd44b}}});if(_0x59ade0){await this['bot']?.[_0xe46f16(0x161)](_0x89c658,_0xe46f16(0x121)+_0x317c51+'`.\x0a\x0a'+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0xe46f16(0x124)});return;}await database_1['default'][_0xe46f16(0x189)][_0xe46f16(0x151)]({'where':{'telegramId':_0x1dd44b},'data':{'shopId':_0x22f2a8['id'],'isVerified':!![]}}),await this[_0xe46f16(0x11e)]?.[_0xe46f16(0x161)](_0x89c658,_0xe46f16(0x1c6)+_0xe46f16(0x150)+(_0xe46f16(0x1f0)+_0x22f2a8[_0xe46f16(0x1ef)]+'*\x0a')+('👤\x20Username:\x20`'+_0x22f2a8[_0xe46f16(0x141)]+_0xe46f16(0x1b4))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0xe46f16(0x1e2)+_0xe46f16(0x16b)+_0xe46f16(0x1b3)+_0xe46f16(0x1b0)+_0xe46f16(0x15e)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0xe46f16(0x1e7),{'parse_mode':_0xe46f16(0x124)}),console['log']('✅\x20Telegram\x20user\x20'+_0x1dd44b+_0xe46f16(0x1df)+_0x22f2a8[_0xe46f16(0x141)]+_0xe46f16(0x1a4));}catch(_0x4c9208){console[_0xe46f16(0x13f)](_0xe46f16(0x12a),_0x4c9208),await this[_0xe46f16(0x11e)]?.[_0xe46f16(0x161)](_0x89c658,_0xe46f16(0x13b));}}async['sendShopNotification'](_0x3ee104,_0x6b42a2,_0x216886){const _0x12f8b6=a53_0x27348e;if(!this[_0x12f8b6(0x11e)]){console[_0x12f8b6(0x1ae)](_0x12f8b6(0x12f));return;}try{const _0x411f89=await database_1[_0x12f8b6(0x1ff)]['telegramUser'][_0x12f8b6(0x1da)]({'where':{'shopId':_0x3ee104,'isVerified':!![]}});if(_0x411f89['length']===0x0){console[_0x12f8b6(0x1e3)](_0x12f8b6(0x17d)+_0x3ee104);return;}const _0x177023=_0x411f89['map'](async _0x52d2cb=>{const _0x1b20b2=_0x12f8b6;try{await this[_0x1b20b2(0x11e)]?.[_0x1b20b2(0x161)](_0x52d2cb['telegramId'],_0x6b42a2,_0x216886),console['log'](_0x1b20b2(0x11f)+_0x52d2cb['telegramId']);}catch(_0x2e85f7){console[_0x1b20b2(0x13f)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x52d2cb['telegramId']+':',_0x2e85f7),_0x2e85f7 instanceof Error&&(_0x2e85f7[_0x1b20b2(0x158)][_0x1b20b2(0x1ba)]('blocked')||_0x2e85f7['message'][_0x1b20b2(0x1ba)](_0x1b20b2(0x182))||_0x2e85f7[_0x1b20b2(0x158)][_0x1b20b2(0x1ba)](_0x1b20b2(0x1b5)))&&(await database_1['default'][_0x1b20b2(0x189)][_0x1b20b2(0x151)]({'where':{'id':_0x52d2cb['id']},'data':{'isVerified':![]}}),console[_0x1b20b2(0x1e3)]('User\x20'+_0x52d2cb[_0x1b20b2(0x19f)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x12f8b6(0x18a)](_0x177023);}catch(_0x4b0142){console['error'](_0x12f8b6(0x170),_0x4b0142);}}async['sendPaymentNotification'](_0x3e8d26,_0xa75393,_0x14508b){const _0x27111a=a53_0x27348e,_0x3d2863={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x4df1f1={'created':'New\x20payment\x20created','paid':'Payment\x20successfully\x20paid','failed':_0x27111a(0x16a),'expired':_0x27111a(0x167),'refund':_0x27111a(0x163),'chargeback':_0x27111a(0x123),'processing':_0x27111a(0x152)},_0x7d0fcb=_0x3d2863[_0x14508b],_0x3b1fa5=_0x4df1f1[_0x14508b],_0x5be87c=(0x0,gateway_1[_0x27111a(0x1be)])(_0xa75393[_0x27111a(0x17c)]);console[_0x27111a(0x1e3)](_0x27111a(0x135)+_0xa75393[_0x27111a(0x17c)]+_0x27111a(0x16d)+_0x5be87c+'\x22');let _0x4e6b79=_0x7d0fcb+'\x20*'+_0x3b1fa5+_0x27111a(0x148)+(_0x27111a(0x192)+_0xa75393['amount']+'\x20'+_0xa75393[_0x27111a(0x122)]+'*\x0a')+(_0x27111a(0x1bc)+(_0xa75393['orderId']||_0xa75393['id'])+'`\x0a')+(_0x27111a(0x136)+_0xa75393['id']+'`\x0a')+(_0x27111a(0x1fc)+_0x5be87c+'`\x0a')+(_0x27111a(0x1c3)+new Date(_0xa75393[_0x27111a(0x159)])[_0x27111a(0x1c7)](_0x27111a(0x1c2))+'\x0a');(_0xa75393[_0x27111a(0x11d)]||_0xa75393['customerEmail'])&&(_0x4e6b79+='\x0a👤\x20*Customer\x20Information:*\x0a',_0xa75393[_0x27111a(0x11d)]&&(_0x4e6b79+='📛\x20Name:\x20`'+_0xa75393[_0x27111a(0x11d)]+'`\x0a'),_0xa75393[_0x27111a(0x146)]&&(_0x4e6b79+=_0x27111a(0x133)+_0xa75393[_0x27111a(0x146)]+'`\x0a')),_0x14508b==='chargeback'&&_0xa75393[_0x27111a(0x1fa)]&&(_0x4e6b79+=_0x27111a(0x193)+_0xa75393[_0x27111a(0x1fa)]+_0x27111a(0x1ce)),_0x14508b===_0x27111a(0x176)&&(_0x4e6b79+=_0x27111a(0x16f)),_0xa75393[_0x27111a(0x1a9)]&&(_0x4e6b79+=_0x27111a(0x173)+_0xa75393[_0x27111a(0x1a9)]+'\x0a'),await this[_0x27111a(0x12d)](_0x3e8d26,_0x4e6b79,{'parse_mode':'Markdown'});}async[a53_0x27348e(0x145)](_0xbcb5b4,_0x1338f7,_0x4fedec){const _0x4179f8=a53_0x27348e,_0x324570={'created':'📤','completed':'✅','rejected':'❌'},_0x450b27={'created':_0x4179f8(0x175),'completed':_0x4179f8(0x1cb),'rejected':_0x4179f8(0x138)},_0x45088a=_0x324570[_0x4fedec],_0x1f0dad=_0x450b27[_0x4fedec],_0x50711e=_0x45088a+'\x20*'+_0x1f0dad+_0x4179f8(0x148)+(_0x4179f8(0x1a8)+_0x1338f7['amount']+_0x4179f8(0x1ca))+(_0x4179f8(0x198)+_0x1338f7[_0x4179f8(0x134)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x1338f7['id']+'`\x0a')+(_0x4179f8(0x1c3)+new Date(_0x1338f7[_0x4179f8(0x159)])[_0x4179f8(0x1c7)]('en-US')+'\x0a')+(_0x1338f7[_0x4179f8(0x1ab)]?_0x4179f8(0x16c)+_0x1338f7[_0x4179f8(0x1ab)]+'`':'');await this[_0x4179f8(0x12d)](_0xbcb5b4,_0x50711e,{'parse_mode':'Markdown'});}async[a53_0x27348e(0x184)](_0x7fb904,_0x2abe55){const _0x534009=a53_0x27348e;try{const _0x4eae38=await database_1['default']['shopSettings']['findUnique']({'where':{'shopId':_0x7fb904},'select':{'notificationLogin':!![]}});if(!_0x4eae38?.['notificationLogin']){console[_0x534009(0x1e3)](_0x534009(0x1d2)+_0x7fb904);return;}const _0x503b1e=_0x2abe55[_0x534009(0x1db)]?'🔐':'🚨',_0x27d7bc=_0x2abe55[_0x534009(0x1db)]?_0x534009(0x1ac):_0x534009(0x19e);let _0x4ebdbe=_0x503b1e+'\x20*'+_0x27d7bc+_0x534009(0x148)+(_0x534009(0x200)+_0x2abe55['username']+'`\x0a')+('📅\x20Time:\x20'+_0x2abe55[_0x534009(0x1f4)]['toLocaleString'](_0x534009(0x1c2))+'\x0a');_0x2abe55[_0x534009(0x18b)]&&(_0x4ebdbe+=_0x534009(0x169)+_0x2abe55['ipAddress']+'`\x0a');if(_0x2abe55[_0x534009(0x157)]){const _0x235c4c=_0x2abe55['userAgent'][_0x534009(0x143)]>0x32?_0x2abe55[_0x534009(0x157)][_0x534009(0x171)](0x0,0x32)+_0x534009(0x126):_0x2abe55[_0x534009(0x157)];_0x4ebdbe+=_0x534009(0x1cd)+_0x235c4c+'`\x0a';}!_0x2abe55[_0x534009(0x1db)]&&(_0x4ebdbe+=_0x534009(0x172)),await this[_0x534009(0x12d)](_0x7fb904,_0x4ebdbe,{'parse_mode':_0x534009(0x124)}),console['log'](_0x534009(0x1bf)+_0x7fb904+':\x20'+(_0x2abe55['success']?_0x534009(0x1db):'failed'));}catch(_0xee88a4){console[_0x534009(0x13f)](_0x534009(0x1a3),_0xee88a4);}}async[a53_0x27348e(0x1fb)](_0x167d04,_0x29d38f){const _0x17f2d7=a53_0x27348e;try{const _0x45d5a7=await database_1[_0x17f2d7(0x1ff)][_0x17f2d7(0x15d)][_0x17f2d7(0x127)]({'where':{'shopId':_0x167d04},'select':{'notificationApiError':!![]}});if(!_0x45d5a7?.[_0x17f2d7(0x165)]){console[_0x17f2d7(0x1e3)](_0x17f2d7(0x15a)+_0x167d04);return;}let _0x3c42d7=_0x17f2d7(0x1ee)+(_0x17f2d7(0x1e8)+_0x29d38f['method']+'\x20'+_0x29d38f['endpoint']+'`\x0a')+(_0x17f2d7(0x1f2)+_0x29d38f[_0x17f2d7(0x1f4)][_0x17f2d7(0x1c7)](_0x17f2d7(0x1c2))+'\x0a');_0x29d38f[_0x17f2d7(0x147)]&&(_0x3c42d7+=_0x17f2d7(0x1dd)+_0x29d38f[_0x17f2d7(0x147)]+'`\x0a'),_0x3c42d7+=_0x17f2d7(0x1b2)+_0x29d38f['errorMessage']+'`\x0a',_0x29d38f[_0x17f2d7(0x162)]&&(_0x3c42d7+=_0x17f2d7(0x14e)+_0x29d38f[_0x17f2d7(0x162)]+'`\x0a'),_0x3c42d7+=_0x17f2d7(0x1a6),await this['sendShopNotification'](_0x167d04,_0x3c42d7,{'parse_mode':_0x17f2d7(0x124)}),console[_0x17f2d7(0x1e3)](_0x17f2d7(0x132)+_0x167d04+':\x20'+_0x29d38f[_0x17f2d7(0x1a1)]);}catch(_0x5cdb71){console[_0x17f2d7(0x13f)](_0x17f2d7(0x19d),_0x5cdb71);}}async[a53_0x27348e(0x1d5)](_0x56ceaa,_0x12df68,_0x20a9ea){const _0x552531=a53_0x27348e;let _0x35c918=_0x552531(0x197)+_0x12df68+'*\x0a\x0a';for(const [_0x112232,_0x4e9040]of Object['entries'](_0x20a9ea)){_0x4e9040!==null&&_0x4e9040!==undefined&&(_0x35c918+=_0x112232+_0x552531(0x202)+_0x4e9040+'`\x0a');}await this[_0x552531(0x12d)](_0x56ceaa,_0x35c918,{'parse_mode':_0x552531(0x124)});}[a53_0x27348e(0x1e9)](){const _0x3aac1a=a53_0x27348e;return{'isActive':!!this[_0x3aac1a(0x11e)],'username':this[_0x3aac1a(0x166)]};}['stopBot'](){const _0x372af4=a53_0x27348e;this[_0x372af4(0x11e)]&&(this[_0x372af4(0x11e)][_0x372af4(0x15b)](),this[_0x372af4(0x11e)]=null,console[_0x372af4(0x1e3)](_0x372af4(0x1a0)));}}function a53_0x1c60(_0xdf4fb6,_0x54794c){const _0x561f57=a53_0x561f();return a53_0x1c60=function(_0x1c601e,_0x2c32f7){_0x1c601e=_0x1c601e-0x11d;let _0x3aef84=_0x561f57[_0x1c601e];return _0x3aef84;},a53_0x1c60(_0xdf4fb6,_0x54794c);}exports[a53_0x27348e(0x1bd)]=TelegramBotService,exports[a53_0x27348e(0x142)]=new TelegramBotService();