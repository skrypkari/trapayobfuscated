'use strict';const a55_0x95b677=a55_0x5650;(function(_0xfeff8a,_0xc5d67c){const _0x20747f=a55_0x5650,_0x1aea8c=_0xfeff8a();while(!![]){try{const _0x314920=parseInt(_0x20747f(0x199))/0x1*(-parseInt(_0x20747f(0x20a))/0x2)+parseInt(_0x20747f(0x200))/0x3+-parseInt(_0x20747f(0x1b6))/0x4*(-parseInt(_0x20747f(0x1d4))/0x5)+-parseInt(_0x20747f(0x1d9))/0x6*(parseInt(_0x20747f(0x14c))/0x7)+-parseInt(_0x20747f(0x1b0))/0x8*(-parseInt(_0x20747f(0x1ce))/0x9)+-parseInt(_0x20747f(0x1fa))/0xa*(parseInt(_0x20747f(0x1ac))/0xb)+parseInt(_0x20747f(0x14f))/0xc;if(_0x314920===_0xc5d67c)break;else _0x1aea8c['push'](_0x1aea8c['shift']());}catch(_0x2f1533){_0x1aea8c['push'](_0x1aea8c['shift']());}}}(a55_0x25ab,0xbf81e));var __importDefault=this&&this[a55_0x95b677(0x20c)]||function(_0x21b300){const _0x2ccc29=a55_0x95b677;return _0x21b300&&_0x21b300[_0x2ccc29(0x207)]?_0x21b300:{'default':_0x21b300};};function a55_0x5650(_0x1d1995,_0x449d80){const _0x25abfb=a55_0x25ab();return a55_0x5650=function(_0x5650e4,_0x4948f4){_0x5650e4=_0x5650e4-0x136;let _0x41d582=_0x25abfb[_0x5650e4];return _0x41d582;},a55_0x5650(_0x1d1995,_0x449d80);}function a55_0x25ab(){const _0x3e4730=['Error\x20handling\x20/disconnect\x20command:','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','shop','✅\x20Telegram\x20bot\x20@','\x20USDT*\x0a','👤\x20Username:\x20`','\x20disconnected\x20from\x20shop\x20','🔌\x20User\x20','customerUa','user\x20is\x20deactivated','•\x20Payouts\x0a\x0a','📊\x20*Connection\x20Status*\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','amount','💰\x20Amount:\x20*','📊\x20Error\x20code:\x20`','TELEGRAM_BOT_TOKEN','toString','📝\x20Order\x20ID:\x20`','Successful\x20login','Failed\x20to\x20send\x20login\x20notification:','Payment\x20failed','notificationLogin','`.\x0a\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','handleSingleLineVerification','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','📅\x20Date:\x20','processing','📅\x20Connection\x20date:\x20','getBotInfo','toLocaleString','🔔\x20*','📱\x20Created\x20new\x20Telegram\x20user:\x20','stopPolling','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','New\x20payout\x20created','•\x20`','name','getGatewayDisplayNameForTelegram','node-telegram-bot-api','botToken','*.\x0a\x0a','chat\x20not\x20found','`\x20not\x20found.\x0a\x0a','Failed\x20login\x20attempt','\x20\x20\x20Public\x20Key:\x20`','success','🔔\x20Notifications\x20are\x20active\x0a\x0a','sk_','727435YmuSjz','pk_','sendApiErrorNotification','You\x20sent\x20','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','🌐\x20IP:\x20`','sendCustomNotification','forEach','`\x0a\x0a','customerEmail','Payment\x20is\x20being\x20processed','shopSettings','\x0a👤\x20*Customer\x20Information:*\x0a','🆔\x20Request\x20ID:\x20`','onText','💸\x20Penalty\x20amount:\x20*','username','Use\x20/start\x20to\x20begin.','🆔\x20Payment\x20ID:\x20`','725329aZWcqP','🚨\x20*API\x20Error*\x0a\x0a','stopBot','Example:\x0a','2154872IEmTcw','Payment\x20chargeback','✅\x20Connected\x20to\x20shop:\x20*','Payment\x20successfully\x20paid','length','Username:\x20`','12TDDNMG','notificationApiError','en-US','entries','text','first_name','findMany','✅\x20Telegram\x20user\x20','Markdown','method','sendMessage','gateway','findUnique','📝\x20Notes:\x20','update','\x20verified\x20for\x20shop\x20','...`\x0a\x0a','chargeback','from','Error\x20handling\x20message:','defineProperty','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','Telegram\x20bot\x20error:','18ZcutFA','Commands:\x0a','status','chargebackAmount','createdAt','To\x20reconnect,\x20use\x20the\x20/start\x20command','783005rrXgjf','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','Available\x20usernames:\x0a','📱\x20Shop:\x20*','setupBotHandlers','3048gaJUOQ','endpoint','🆔\x20Payout\x20ID:\x20`','🔗\x20Endpoint:\x20`','🌐\x20IP\x20address:\x20`','🏦\x20IBAN:\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','*\x0a\x0a','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','create','💸\x20Amount:\x20*','warn','map','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','log','adminNotes','currency','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','customerIp','❌\x20Please\x20use\x20/start\x20command\x20first','isVerified','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','default','User\x20','userAgent','\x20(@','❌\x20Shop\x20`','ACTIVE',':\x20username=\x22','\x20\x20\x20Status:\x20','Payment\x20expired','180PkqLan',':\x20`','•\x20Payment\x20status\x20changes\x0a','telegramId','last_name','...\x22','3855852jAKGCM','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','📧\x20Email:\x20`','substring','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Use\x20/start\x20to\x20connect.','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','__esModule','includes','unknown\x20shop','2ZNUWuh','botUsername','__importDefault','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','env','initializeBot','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','...','🛑\x20Telegram\x20bot\x20stopped','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','remitterIban','Error\x20handling\x20/debug\x20command:','💻\x20Browser:\x20`','customerName','Check\x20spelling\x20and\x20try\x20again.','requestId','\x22\x20->\x20display\x20\x22','📱\x20Your\x20Telegram\x20ID:\x20`','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','Error\x20sending\x20shop\x20notification:','trapay_bot','secretKey','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','/status\x20-\x20check\x20connection\x20status\x0a','findFirst','sendLoginNotification','Failed\x20to\x20send\x20API\x20error\x20notification:','\x22,\x20apiKey=\x22','error','❌\x20Error\x20getting\x20debug\x20information.','✅\x20Welcome\x20back!\x0a\x0a','\x20via\x20single-line\x20input','TelegramBotService','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','\x20USD*\x0a','txid','Contact\x20administrator.','❌\x20Shop\x20with\x20username\x20`','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','message','📛\x20Name:\x20`','updatedAt','203Pnugpz','•\x20Payouts\x0a','../types/gateway','5036136jdQzKe','shopId','🏪\x20Available\x20shops\x20in\x20system:\x0a','•\x20Important\x20events\x0a\x0a','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','chat','timestamp','.\x20*','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','bot','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','sendShopNotification','ipAddress','Error\x20handling\x20/status\x20command:','Payment\x20refund','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','`\x20is\x20inactive.\x0a\x0a','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','telegramUser','publicKey','allSettled','split','statusCode'];a55_0x25ab=function(){return _0x3e4730;};return a55_0x25ab();}Object[a55_0x95b677(0x1ca)](exports,a55_0x95b677(0x207),{'value':!![]}),exports['telegramBotService']=exports[a55_0x95b677(0x142)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a55_0x95b677(0x18f))),database_1=__importDefault(require('../config/database')),gateway_1=require(a55_0x95b677(0x14e));class TelegramBotService{constructor(){const _0x53f4f9=a55_0x95b677;this['bot']=null,this[_0x53f4f9(0x190)]=process[_0x53f4f9(0x20e)][_0x53f4f9(0x177)]||'',this['botUsername']=process[_0x53f4f9(0x20e)]['TELEGRAM_BOT_USERNAME']||_0x53f4f9(0x136),this[_0x53f4f9(0x190)]?this[_0x53f4f9(0x20f)]():console[_0x53f4f9(0x1e5)](_0x53f4f9(0x1d5));}[a55_0x95b677(0x20f)](){const _0x29afa9=a55_0x95b677;try{this[_0x29afa9(0x158)]=new node_telegram_bot_api_1[(_0x29afa9(0x1f1))](this['botToken'],{'polling':!![]}),this[_0x29afa9(0x1d8)](),console[_0x29afa9(0x1e8)](_0x29afa9(0x16a)+this[_0x29afa9(0x20b)]+'\x20initialized\x20successfully');}catch(_0x4ea5f8){console['error'](_0x29afa9(0x153),_0x4ea5f8);}}['setupBotHandlers'](){const _0xe1eaa2=a55_0x95b677;if(!this[_0xe1eaa2(0x158)])return;this[_0xe1eaa2(0x158)]['onText'](/\/start/,async _0x10d47c=>{const _0x5ece69=_0xe1eaa2,_0x3e3721=_0x10d47c[_0x5ece69(0x154)]['id'],_0x5846f6=_0x10d47c['from']?.['id']['toString'](),_0x32b711=_0x10d47c[_0x5ece69(0x1c8)]?.[_0x5ece69(0x1a9)],_0x29a3fd=_0x10d47c[_0x5ece69(0x1c8)]?.[_0x5ece69(0x1bb)],_0x3f6b95=_0x10d47c[_0x5ece69(0x1c8)]?.[_0x5ece69(0x1fe)];if(!_0x5846f6)return;try{let _0xfa2f81=await database_1['default'][_0x5ece69(0x161)][_0x5ece69(0x1c2)]({'where':{'telegramId':_0x5846f6},'include':{'shop':!![]}});!_0xfa2f81?(_0xfa2f81=await database_1['default'][_0x5ece69(0x161)][_0x5ece69(0x1e3)]({'data':{'telegramId':_0x5846f6,'username':_0x32b711,'firstName':_0x29a3fd,'lastName':_0x3f6b95,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x5ece69(0x1e8)](_0x5ece69(0x188)+_0x5846f6+_0x5ece69(0x1f4)+_0x32b711+')')):_0xfa2f81=await database_1[_0x5ece69(0x1f1)][_0x5ece69(0x161)][_0x5ece69(0x1c4)]({'where':{'telegramId':_0x5846f6},'data':{'username':_0x32b711,'firstName':_0x29a3fd,'lastName':_0x3f6b95},'include':{'shop':!![]}}),_0xfa2f81['isVerified']&&_0xfa2f81[_0x5ece69(0x150)]&&_0xfa2f81[_0x5ece69(0x169)]?await this[_0x5ece69(0x158)]?.[_0x5ece69(0x1c0)](_0x3e3721,_0x5ece69(0x140)+(_0x5ece69(0x160)+_0xfa2f81[_0x5ece69(0x169)][_0x5ece69(0x18d)]+'*\x0a')+(_0x5ece69(0x1b5)+_0xfa2f81['shop'][_0x5ece69(0x1a9)]+'`\x0a\x0a')+_0x5ece69(0x204)+'•\x20New\x20payments\x0a'+_0x5ece69(0x1fc)+_0x5ece69(0x171)+_0x5ece69(0x1cf)+_0x5ece69(0x139)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x5ece69(0x1be)}):(_0xfa2f81['shopId']&&!_0xfa2f81[_0x5ece69(0x1ef)]&&(await database_1['default']['telegramUser'][_0x5ece69(0x1c4)]({'where':{'telegramId':_0x5846f6},'data':{'shopId':null,'isVerified':![]}}),console[_0x5ece69(0x1e8)](_0x5ece69(0x21c)+_0x5846f6)),await this[_0x5ece69(0x158)]?.[_0x5ece69(0x1c0)](_0x3e3721,_0x5ece69(0x168)+_0x5ece69(0x19d)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+'Example:\x0a'+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x5ece69(0x20d),{'parse_mode':_0x5ece69(0x1be)}));}catch(_0x15a513){console[_0x5ece69(0x13e)]('Error\x20handling\x20/start\x20command:',_0x15a513),await this[_0x5ece69(0x158)]?.['sendMessage'](_0x3e3721,_0x5ece69(0x143));}}),this[_0xe1eaa2(0x158)][_0xe1eaa2(0x1a7)](/\/disconnect/,async _0x1998bf=>{const _0x25cfd7=_0xe1eaa2,_0x3bedd8=_0x1998bf[_0x25cfd7(0x154)]['id'],_0x48e8bb=_0x1998bf[_0x25cfd7(0x1c8)]?.['id'][_0x25cfd7(0x178)]();if(!_0x48e8bb)return;try{const _0x2a05fd=await database_1['default'][_0x25cfd7(0x161)][_0x25cfd7(0x1c2)]({'where':{'telegramId':_0x48e8bb},'include':{'shop':!![]}});if(!_0x2a05fd||!_0x2a05fd[_0x25cfd7(0x1ef)]||!_0x2a05fd['shopId']){await this[_0x25cfd7(0x158)]?.['sendMessage'](_0x3bedd8,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x1dce40=_0x2a05fd[_0x25cfd7(0x169)]?.[_0x25cfd7(0x18d)]||_0x25cfd7(0x209);await database_1[_0x25cfd7(0x1f1)][_0x25cfd7(0x161)]['update']({'where':{'telegramId':_0x48e8bb},'data':{'shopId':null,'isVerified':![]}}),console[_0x25cfd7(0x1e8)](_0x25cfd7(0x16e)+_0x48e8bb+_0x25cfd7(0x16d)+_0x2a05fd['shopId']),await this['bot']?.[_0x25cfd7(0x1c0)](_0x3bedd8,_0x25cfd7(0x201)+_0x1dce40+_0x25cfd7(0x191)+_0x25cfd7(0x1d3),{'parse_mode':_0x25cfd7(0x1be)});}catch(_0x1bfcfc){console[_0x25cfd7(0x13e)](_0x25cfd7(0x166),_0x1bfcfc),await this['bot']?.[_0x25cfd7(0x1c0)](_0x3bedd8,_0x25cfd7(0x143));}}),this[_0xe1eaa2(0x158)][_0xe1eaa2(0x1a7)](/\/status/,async _0x5165bf=>{const _0x21ef64=_0xe1eaa2,_0x4ecd07=_0x5165bf[_0x21ef64(0x154)]['id'],_0x5949de=_0x5165bf['from']?.['id'][_0x21ef64(0x178)]();if(!_0x5949de)return;try{const _0x1d18cf=await database_1[_0x21ef64(0x1f1)][_0x21ef64(0x161)][_0x21ef64(0x1c2)]({'where':{'telegramId':_0x5949de},'include':{'shop':!![]}});if(!_0x1d18cf){await this['bot']?.[_0x21ef64(0x1c0)](_0x4ecd07,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x21ef64(0x1aa));return;}if(!_0x1d18cf[_0x21ef64(0x1ef)]||!_0x1d18cf[_0x21ef64(0x150)]||!_0x1d18cf[_0x21ef64(0x169)]){await this[_0x21ef64(0x158)]?.[_0x21ef64(0x1c0)](_0x4ecd07,_0x21ef64(0x1cb)+_0x21ef64(0x205));return;}await this['bot']?.[_0x21ef64(0x1c0)](_0x4ecd07,_0x21ef64(0x172)+(_0x21ef64(0x1b2)+_0x1d18cf[_0x21ef64(0x169)][_0x21ef64(0x18d)]+'*\x0a')+(_0x21ef64(0x16c)+_0x1d18cf['shop']['username']+'`\x0a')+(_0x21ef64(0x184)+_0x1d18cf[_0x21ef64(0x14b)]['toLocaleDateString'](_0x21ef64(0x1b8))+'\x0a\x0a')+_0x21ef64(0x197)+_0x21ef64(0x1cf)+_0x21ef64(0x1df),{'parse_mode':_0x21ef64(0x1be)});}catch(_0x597474){console[_0x21ef64(0x13e)](_0x21ef64(0x15c),_0x597474),await this[_0x21ef64(0x158)]?.[_0x21ef64(0x1c0)](_0x4ecd07,_0x21ef64(0x143));}}),this[_0xe1eaa2(0x158)][_0xe1eaa2(0x1a7)](/\/debug/,async _0xb3b36d=>{const _0x33a770=_0xe1eaa2,_0x35bd94=_0xb3b36d[_0x33a770(0x154)]['id'],_0x14014f=_0xb3b36d[_0x33a770(0x1c8)]?.['id']['toString']();if(!_0x14014f)return;try{const _0x29f348=await database_1['default'][_0x33a770(0x169)][_0x33a770(0x1bc)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4b357f='🔍\x20*Debug\x20Information*\x0a\x0a';_0x4b357f+=_0x33a770(0x21b)+_0x14014f+'`\x0a\x0a',_0x4b357f+=_0x33a770(0x151),_0x29f348['forEach']((_0xfda3b5,_0x319334)=>{const _0x256986=_0x33a770;_0x4b357f+=_0x319334+0x1+_0x256986(0x156)+_0xfda3b5[_0x256986(0x18d)]+'*\x0a',_0x4b357f+='\x20\x20\x20Username:\x20`'+_0xfda3b5[_0x256986(0x1a9)]+'`\x0a',_0x4b357f+=_0x256986(0x1f8)+_0xfda3b5[_0x256986(0x1d0)]+'\x0a',_0x4b357f+=_0x256986(0x195)+_0xfda3b5['publicKey'][_0x256986(0x203)](0x0,0xf)+_0x256986(0x1c6);}),await this[_0x33a770(0x158)]?.[_0x33a770(0x1c0)](_0x35bd94,_0x4b357f,{'parse_mode':'Markdown'});}catch(_0x79cec0){console['error'](_0x33a770(0x215),_0x79cec0),await this[_0x33a770(0x158)]?.[_0x33a770(0x1c0)](_0x35bd94,_0x33a770(0x13f));}}),this[_0xe1eaa2(0x158)]['on'](_0xe1eaa2(0x149),async _0x2d47a4=>{const _0x53908c=_0xe1eaa2;if(_0x2d47a4[_0x53908c(0x1ba)]?.['startsWith']('/'))return;const _0x20a975=_0x2d47a4[_0x53908c(0x154)]['id'],_0x280699=_0x2d47a4[_0x53908c(0x1c8)]?.['id'][_0x53908c(0x178)](),_0x2a3197=_0x2d47a4[_0x53908c(0x1ba)]?.['trim']();if(!_0x280699||!_0x2a3197)return;try{const _0xd94e2e=await database_1['default'][_0x53908c(0x161)]['findUnique']({'where':{'telegramId':_0x280699},'include':{'shop':!![]}});if(!_0xd94e2e){await this[_0x53908c(0x158)]?.[_0x53908c(0x1c0)](_0x20a975,_0x53908c(0x1ee));return;}if(_0xd94e2e[_0x53908c(0x1ef)]&&_0xd94e2e[_0x53908c(0x150)]&&_0xd94e2e[_0x53908c(0x169)]){await this[_0x53908c(0x158)]?.['sendMessage'](_0x20a975,_0x53908c(0x148)+_0xd94e2e['shop']['name']+_0x53908c(0x191)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':'Markdown'});return;}const _0x2432db=_0x2a3197[_0x53908c(0x164)](/\s+/);if(_0x2432db[_0x53908c(0x1b4)]!==0x2){await this[_0x53908c(0x158)]?.[_0x53908c(0x1c0)](_0x20a975,_0x53908c(0x157)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x53908c(0x1af)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x53908c(0x19c)+_0x2432db['length']+'\x20parts:\x20'+_0x2432db[_0x53908c(0x1e6)](_0x513576=>'`'+_0x513576+'`')['join'](',\x20')),{'parse_mode':_0x53908c(0x1be)});return;}const [_0x442381,_0x5725cd]=_0x2432db;console[_0x53908c(0x1e8)](_0x53908c(0x181)+_0x280699+_0x53908c(0x1f7)+_0x442381+_0x53908c(0x13d)+_0x5725cd['substring'](0x0,0xa)+_0x53908c(0x1ff)),await this[_0x53908c(0x180)](_0x20a975,_0x280699,_0x442381,_0x5725cd);}catch(_0x149f12){console[_0x53908c(0x13e)](_0x53908c(0x1c9),_0x149f12),await this[_0x53908c(0x158)]?.[_0x53908c(0x1c0)](_0x20a975,_0x53908c(0x143));}}),this['bot']['on'](_0xe1eaa2(0x13e),_0x4c5e9a=>{const _0x1deac0=_0xe1eaa2;console[_0x1deac0(0x13e)](_0x1deac0(0x1cd),_0x4c5e9a);}),this[_0xe1eaa2(0x158)]['on']('polling_error',_0x5dcdcb=>{const _0x4c2738=_0xe1eaa2;console[_0x4c2738(0x13e)]('Telegram\x20bot\x20polling\x20error:',_0x5dcdcb);});}async['handleSingleLineVerification'](_0x293873,_0x28a2fa,_0x3dca73,_0x428bcf){const _0x53ca1=a55_0x95b677;try{console[_0x53ca1(0x1e8)](_0x53ca1(0x181)+_0x28a2fa+_0x53ca1(0x1f7)+_0x3dca73+_0x53ca1(0x13d)+_0x428bcf[_0x53ca1(0x203)](0x0,0xa)+_0x53ca1(0x1ff));if(!_0x3dca73||_0x3dca73[_0x53ca1(0x1b4)]<0x3||_0x3dca73[_0x53ca1(0x1b4)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x3dca73)){await this[_0x53ca1(0x158)]?.[_0x53ca1(0x1c0)](_0x293873,'❌\x20Invalid\x20username\x20format:\x20`'+_0x3dca73+_0x53ca1(0x1a1)+_0x53ca1(0x1cc),{'parse_mode':_0x53ca1(0x1be)});return;}if(!_0x428bcf||!_0x428bcf['startsWith'](_0x53ca1(0x19a))&&!_0x428bcf['startsWith'](_0x53ca1(0x198))){await this[_0x53ca1(0x158)]?.[_0x53ca1(0x1c0)](_0x293873,_0x53ca1(0x1e1)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x53ca1(0x1be)});return;}const _0x7be9d7=await database_1[_0x53ca1(0x1f1)]['shop'][_0x53ca1(0x1c2)]({'where':{'username':_0x3dca73},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x7be9d7){const _0x25fd61=await database_1[_0x53ca1(0x1f1)][_0x53ca1(0x169)][_0x53ca1(0x1bc)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x5f12e0=_0x53ca1(0x147)+_0x3dca73+_0x53ca1(0x193);_0x25fd61[_0x53ca1(0x1b4)]>0x0?(_0x5f12e0+=_0x53ca1(0x1d6),_0x25fd61[_0x53ca1(0x1a0)](_0x3f5203=>{const _0x1da8e3=_0x53ca1;_0x5f12e0+=_0x1da8e3(0x18c)+_0x3f5203[_0x1da8e3(0x1a9)]+'`\x20('+_0x3f5203[_0x1da8e3(0x18d)]+')\x0a';}),_0x5f12e0+=_0x53ca1(0x1ec)):_0x5f12e0+=_0x53ca1(0x218);await this[_0x53ca1(0x158)]?.[_0x53ca1(0x1c0)](_0x293873,_0x5f12e0,{'parse_mode':_0x53ca1(0x1be)});return;}if(_0x7be9d7[_0x53ca1(0x1d0)]!==_0x53ca1(0x1f6)){await this['bot']?.[_0x53ca1(0x1c0)](_0x293873,_0x53ca1(0x1f5)+_0x3dca73+_0x53ca1(0x15f)+_0x53ca1(0x146),{'parse_mode':_0x53ca1(0x1be)});return;}if(_0x7be9d7[_0x53ca1(0x162)]!==_0x428bcf&&_0x7be9d7[_0x53ca1(0x137)]!==_0x428bcf){await this[_0x53ca1(0x158)]?.['sendMessage'](_0x293873,_0x53ca1(0x15e)+_0x3dca73+_0x53ca1(0x17e)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x53ca1(0x1be)});return;}const _0x7acfb7=await database_1[_0x53ca1(0x1f1)][_0x53ca1(0x161)][_0x53ca1(0x13a)]({'where':{'shopId':_0x7be9d7['id'],'isVerified':!![],'telegramId':{'not':_0x28a2fa}}});if(_0x7acfb7){await this[_0x53ca1(0x158)]?.[_0x53ca1(0x1c0)](_0x293873,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x3dca73+_0x53ca1(0x17e)+_0x53ca1(0x138),{'parse_mode':_0x53ca1(0x1be)});return;}await database_1[_0x53ca1(0x1f1)][_0x53ca1(0x161)]['update']({'where':{'telegramId':_0x28a2fa},'data':{'shopId':_0x7be9d7['id'],'isVerified':!![]}}),await this[_0x53ca1(0x158)]?.['sendMessage'](_0x293873,'🎉\x20*Congratulations!*\x0a\x0a'+_0x53ca1(0x173)+(_0x53ca1(0x1d7)+_0x7be9d7['name']+'*\x0a')+(_0x53ca1(0x16c)+_0x7be9d7['username']+_0x53ca1(0x1a1))+_0x53ca1(0x213)+'•\x20New\x20payments\x0a'+_0x53ca1(0x1fc)+_0x53ca1(0x14d)+_0x53ca1(0x152)+_0x53ca1(0x1cf)+_0x53ca1(0x139)+_0x53ca1(0x1df),{'parse_mode':'Markdown'}),console[_0x53ca1(0x1e8)](_0x53ca1(0x1bd)+_0x28a2fa+_0x53ca1(0x1c5)+_0x7be9d7[_0x53ca1(0x1a9)]+_0x53ca1(0x141));}catch(_0xb6311){console[_0x53ca1(0x13e)]('Error\x20in\x20handleSingleLineVerification:',_0xb6311),await this[_0x53ca1(0x158)]?.['sendMessage'](_0x293873,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async['sendShopNotification'](_0x3ec442,_0x146a94,_0x97494){const _0x682ea9=a55_0x95b677;if(!this[_0x682ea9(0x158)]){console[_0x682ea9(0x1e5)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x3d3d88=await database_1[_0x682ea9(0x1f1)]['telegramUser'][_0x682ea9(0x1bc)]({'where':{'shopId':_0x3ec442,'isVerified':!![]}});if(_0x3d3d88[_0x682ea9(0x1b4)]===0x0){console[_0x682ea9(0x1e8)](_0x682ea9(0x206)+_0x3ec442);return;}const _0x2fe871=_0x3d3d88[_0x682ea9(0x1e6)](async _0x5d9747=>{const _0x13eaa3=_0x682ea9;try{await this['bot']?.['sendMessage'](_0x5d9747[_0x13eaa3(0x1fd)],_0x146a94,_0x97494),console[_0x13eaa3(0x1e8)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x5d9747[_0x13eaa3(0x1fd)]);}catch(_0x513954){console['error'](_0x13eaa3(0x1f0)+_0x5d9747['telegramId']+':',_0x513954),_0x513954 instanceof Error&&(_0x513954[_0x13eaa3(0x149)][_0x13eaa3(0x208)]('blocked')||_0x513954['message']['includes'](_0x13eaa3(0x192))||_0x513954['message']['includes'](_0x13eaa3(0x170)))&&(await database_1['default'][_0x13eaa3(0x161)]['update']({'where':{'id':_0x5d9747['id']},'data':{'isVerified':![]}}),console[_0x13eaa3(0x1e8)](_0x13eaa3(0x1f2)+_0x5d9747['telegramId']+_0x13eaa3(0x1e7)));}});await Promise[_0x682ea9(0x163)](_0x2fe871);}catch(_0x41a66b){console[_0x682ea9(0x13e)](_0x682ea9(0x21d),_0x41a66b);}}async['sendPaymentNotification'](_0x19c1f2,_0x29894f,_0xa6243e){const _0x11f0b2=a55_0x95b677,_0x537913={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x46e170={'created':'New\x20payment\x20created','paid':_0x11f0b2(0x1b3),'failed':_0x11f0b2(0x17c),'expired':_0x11f0b2(0x1f9),'refund':_0x11f0b2(0x15d),'chargeback':_0x11f0b2(0x1b1),'processing':_0x11f0b2(0x1a3)},_0x13ce97=_0x537913[_0xa6243e],_0x457f00=_0x46e170[_0xa6243e],_0xb0cf3c=(0x0,gateway_1[_0x11f0b2(0x18e)])(_0x29894f[_0x11f0b2(0x1c1)]);console['log'](_0x11f0b2(0x17f)+_0x29894f[_0x11f0b2(0x1c1)]+_0x11f0b2(0x21a)+_0xb0cf3c+'\x22');let _0x18a87f=_0x13ce97+'\x20*'+_0x457f00+_0x11f0b2(0x1e0)+(_0x11f0b2(0x175)+_0x29894f[_0x11f0b2(0x174)]+'\x20'+_0x29894f[_0x11f0b2(0x1ea)]+'*\x0a')+(_0x11f0b2(0x179)+(_0x29894f['orderId']||_0x29894f['id'])+'`\x0a')+(_0x11f0b2(0x1ab)+_0x29894f['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0xb0cf3c+'`\x0a')+(_0x11f0b2(0x182)+new Date(_0x29894f[_0x11f0b2(0x1d2)])['toLocaleString'](_0x11f0b2(0x1b8))+'\x0a');if(_0x29894f['customerName']||_0x29894f[_0x11f0b2(0x1a2)]||_0x29894f[_0x11f0b2(0x214)]||_0x29894f[_0x11f0b2(0x1ed)]||_0x29894f[_0x11f0b2(0x16f)]){_0x18a87f+=_0x11f0b2(0x1a5);_0x29894f[_0x11f0b2(0x217)]&&(_0x18a87f+=_0x11f0b2(0x14a)+_0x29894f[_0x11f0b2(0x217)]+'`\x0a');_0x29894f[_0x11f0b2(0x1a2)]&&(_0x18a87f+=_0x11f0b2(0x202)+_0x29894f['customerEmail']+'`\x0a');_0x29894f[_0x11f0b2(0x214)]&&(_0x18a87f+=_0x11f0b2(0x1de)+_0x29894f[_0x11f0b2(0x214)]+'`\x0a');_0x29894f['customerIp']&&(_0x18a87f+=_0x11f0b2(0x19e)+_0x29894f[_0x11f0b2(0x1ed)]+'`\x0a');if(_0x29894f[_0x11f0b2(0x16f)]){const _0x4cd81b=_0x29894f['customerUa'][_0x11f0b2(0x1b4)]>0x32?_0x29894f[_0x11f0b2(0x16f)][_0x11f0b2(0x203)](0x0,0x32)+_0x11f0b2(0x211):_0x29894f[_0x11f0b2(0x16f)];_0x18a87f+=_0x11f0b2(0x216)+_0x4cd81b+'`\x0a';}}_0xa6243e===_0x11f0b2(0x1c7)&&_0x29894f['chargebackAmount']&&(_0x18a87f+=_0x11f0b2(0x1a8)+_0x29894f[_0x11f0b2(0x1d1)]+_0x11f0b2(0x16b)),_0xa6243e===_0x11f0b2(0x183)&&(_0x18a87f+=_0x11f0b2(0x1eb)),_0x29894f[_0x11f0b2(0x1e9)]&&(_0x18a87f+=_0x11f0b2(0x1c3)+_0x29894f[_0x11f0b2(0x1e9)]+'\x0a'),await this[_0x11f0b2(0x15a)](_0x19c1f2,_0x18a87f,{'parse_mode':'Markdown'});}async['sendPayoutNotification'](_0x15bb23,_0x4f841a,_0xaa1034){const _0x366f36=a55_0x95b677,_0x438728={'created':'📤','completed':'✅','rejected':'❌'},_0x32c73a={'created':_0x366f36(0x18b),'completed':'Payout\x20completed','rejected':'Payout\x20rejected'},_0x4f174e=_0x438728[_0xaa1034],_0x18885b=_0x32c73a[_0xaa1034],_0x265667=_0x4f174e+'\x20*'+_0x18885b+_0x366f36(0x1e0)+(_0x366f36(0x1e4)+_0x4f841a[_0x366f36(0x174)]+_0x366f36(0x144))+('🏦\x20Method:\x20`'+_0x4f841a[_0x366f36(0x1bf)]+'`\x0a')+(_0x366f36(0x1db)+_0x4f841a['id']+'`\x0a')+(_0x366f36(0x182)+new Date(_0x4f841a[_0x366f36(0x1d2)])[_0x366f36(0x186)](_0x366f36(0x1b8))+'\x0a')+(_0x4f841a[_0x366f36(0x145)]?'🔗\x20TXID:\x20`'+_0x4f841a['txid']+'`':'');await this[_0x366f36(0x15a)](_0x15bb23,_0x265667,{'parse_mode':_0x366f36(0x1be)});}async[a55_0x95b677(0x13b)](_0x5714ca,_0x4fd316){const _0x10f416=a55_0x95b677;try{const _0x1dbfbd=await database_1['default'][_0x10f416(0x1a4)][_0x10f416(0x1c2)]({'where':{'shopId':_0x5714ca},'select':{'notificationLogin':!![]}});if(!_0x1dbfbd?.[_0x10f416(0x17d)]){console[_0x10f416(0x1e8)](_0x10f416(0x1e2)+_0x5714ca);return;}const _0x18ef38=_0x4fd316[_0x10f416(0x196)]?'🔐':'🚨',_0x165444=_0x4fd316[_0x10f416(0x196)]?_0x10f416(0x17a):_0x10f416(0x194);let _0xe1114a=_0x18ef38+'\x20*'+_0x165444+'*\x0a\x0a'+(_0x10f416(0x16c)+_0x4fd316[_0x10f416(0x1a9)]+'`\x0a')+('📅\x20Time:\x20'+_0x4fd316[_0x10f416(0x155)][_0x10f416(0x186)](_0x10f416(0x1b8))+'\x0a');_0x4fd316[_0x10f416(0x15b)]&&(_0xe1114a+=_0x10f416(0x1dd)+_0x4fd316[_0x10f416(0x15b)]+'`\x0a');if(_0x4fd316[_0x10f416(0x1f3)]){const _0x23c19a=_0x4fd316[_0x10f416(0x1f3)]['length']>0x32?_0x4fd316[_0x10f416(0x1f3)][_0x10f416(0x203)](0x0,0x32)+'...':_0x4fd316[_0x10f416(0x1f3)];_0xe1114a+=_0x10f416(0x216)+_0x23c19a+'`\x0a';}!_0x4fd316[_0x10f416(0x196)]&&(_0xe1114a+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x10f416(0x15a)](_0x5714ca,_0xe1114a,{'parse_mode':_0x10f416(0x1be)}),console['log'](_0x10f416(0x18a)+_0x5714ca+':\x20'+(_0x4fd316[_0x10f416(0x196)]?_0x10f416(0x196):'failed'));}catch(_0x1a918d){console['error'](_0x10f416(0x17b),_0x1a918d);}}async[a55_0x95b677(0x19b)](_0x3fb108,_0x2b0406){const _0x535be2=a55_0x95b677;try{const _0x1e1ba0=await database_1['default']['shopSettings'][_0x535be2(0x1c2)]({'where':{'shopId':_0x3fb108},'select':{'notificationApiError':!![]}});if(!_0x1e1ba0?.[_0x535be2(0x1b7)]){console['log'](_0x535be2(0x210)+_0x3fb108);return;}let _0x1f3e3a=_0x535be2(0x1ad)+(_0x535be2(0x1dc)+_0x2b0406[_0x535be2(0x1bf)]+'\x20'+_0x2b0406[_0x535be2(0x1da)]+'`\x0a')+('📅\x20Time:\x20'+_0x2b0406[_0x535be2(0x155)]['toLocaleString']('en-US')+'\x0a');_0x2b0406[_0x535be2(0x165)]&&(_0x1f3e3a+=_0x535be2(0x176)+_0x2b0406[_0x535be2(0x165)]+'`\x0a'),_0x1f3e3a+='❌\x20Error:\x20`'+_0x2b0406['errorMessage']+'`\x0a',_0x2b0406[_0x535be2(0x219)]&&(_0x1f3e3a+=_0x535be2(0x1a6)+_0x2b0406[_0x535be2(0x219)]+'`\x0a'),_0x1f3e3a+=_0x535be2(0x167),await this[_0x535be2(0x15a)](_0x3fb108,_0x1f3e3a,{'parse_mode':_0x535be2(0x1be)}),console['log'](_0x535be2(0x159)+_0x3fb108+':\x20'+_0x2b0406[_0x535be2(0x1da)]);}catch(_0x491349){console['error'](_0x535be2(0x13c),_0x491349);}}async[a55_0x95b677(0x19f)](_0x32590c,_0x3256b8,_0x4587bd){const _0x4d5013=a55_0x95b677;let _0x35c8b0=_0x4d5013(0x187)+_0x3256b8+_0x4d5013(0x1e0);for(const [_0x309f35,_0x2892b3]of Object[_0x4d5013(0x1b9)](_0x4587bd)){_0x2892b3!==null&&_0x2892b3!==undefined&&(_0x35c8b0+=_0x309f35+_0x4d5013(0x1fb)+_0x2892b3+'`\x0a');}await this['sendShopNotification'](_0x32590c,_0x35c8b0,{'parse_mode':'Markdown'});}[a55_0x95b677(0x185)](){const _0x5d460d=a55_0x95b677;return{'isActive':!!this[_0x5d460d(0x158)],'username':this[_0x5d460d(0x20b)]};}[a55_0x95b677(0x1ae)](){const _0x363a9f=a55_0x95b677;this[_0x363a9f(0x158)]&&(this['bot'][_0x363a9f(0x189)](),this['bot']=null,console[_0x363a9f(0x1e8)](_0x363a9f(0x212)));}}exports['TelegramBotService']=TelegramBotService,exports['telegramBotService']=new TelegramBotService();