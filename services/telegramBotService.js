'use strict';const a55_0x45e497=a55_0x2f12;(function(_0x358ac1,_0x469672){const _0xce4444=a55_0x2f12,_0x856f4e=_0x358ac1();while(!![]){try{const _0x4e7827=-parseInt(_0xce4444(0x19f))/0x1+parseInt(_0xce4444(0x20d))/0x2*(parseInt(_0xce4444(0x18f))/0x3)+-parseInt(_0xce4444(0x1db))/0x4+-parseInt(_0xce4444(0x200))/0x5*(parseInt(_0xce4444(0x1bf))/0x6)+parseInt(_0xce4444(0x14a))/0x7+parseInt(_0xce4444(0x167))/0x8+-parseInt(_0xce4444(0x1c1))/0x9*(parseInt(_0xce4444(0x15c))/0xa);if(_0x4e7827===_0x469672)break;else _0x856f4e['push'](_0x856f4e['shift']());}catch(_0x441bf9){_0x856f4e['push'](_0x856f4e['shift']());}}}(a55_0x4206,0x42e55));function a55_0x2f12(_0x36610f,_0x1cede0){const _0x42064e=a55_0x4206();return a55_0x2f12=function(_0x2f1256,_0x4cd29a){_0x2f1256=_0x2f1256-0x147;let _0x4eba20=_0x42064e[_0x2f1256];return _0x4eba20;},a55_0x2f12(_0x36610f,_0x1cede0);}function a55_0x4206(){const _0x153def=['188KxDUSu','customerUa','stopBot','failed','📛\x20Name:\x20`','unknown\x20shop','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','botToken','error','🛑\x20Telegram\x20bot\x20stopped','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','userAgent','\x0a👤\x20*Customer\x20Information:*\x0a','Payment\x20expired','allSettled','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','📅\x20Date:\x20','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Use\x20/start\x20to\x20connect.','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','•\x20Payment\x20status\x20changes\x0a','`\x0a\x0a','trim','chat','createdAt','*\x0a\x0a','❌\x20Shop\x20with\x20username\x20`','💰\x20Amount:\x20*','amount','•\x20Important\x20events\x0a\x0a','__importDefault','1427930LBWSvv','sendCustomNotification','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','text','\x20\x20\x20Public\x20Key:\x20`','✅\x20Connected\x20to\x20shop:\x20*','•\x20`','requestId','📊\x20Error\x20code:\x20`','forEach',':\x20username=\x22','📱\x20Created\x20new\x20Telegram\x20user:\x20','`\x20not\x20found.\x0a\x0a','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','Payment\x20successfully\x20paid','__esModule','findFirst','botUsername','6012950hOniZY','sendLoginNotification','ACTIVE','🔔\x20*','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','chargebackAmount','bot','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','en-US','node-telegram-bot-api','3404816idxaLP','polling_error','🔗\x20TXID:\x20`','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','`.\x0a\x0a','telegramBotService','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','Telegram\x20bot\x20error:','📅\x20Time:\x20','\x20disconnected\x20from\x20shop\x20','TelegramBotService','toLocaleDateString','Error\x20handling\x20/status\x20command:','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','test','🆔\x20Payment\x20ID:\x20`','\x20(@','shopSettings','📱\x20Shop:\x20*','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','You\x20sent\x20','\x20parts:\x20','startsWith','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','🔌\x20User\x20','sendPayoutNotification','notificationApiError','📱\x20Your\x20Telegram\x20ID:\x20`','secretKey','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','Error\x20in\x20handleSingleLineVerification:','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','/disconnect\x20-\x20disconnect\x20from\x20notifications','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','success','user\x20is\x20deactivated','getGatewayDisplayNameForTelegram','findUnique','Error\x20handling\x20/start\x20command:','statusCode','15693hcbHiW','\x0aCheck\x20spelling\x20and\x20try\x20again.','last_name','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','customerEmail','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','findMany','substring','Payment\x20chargeback','toLocaleString','📝\x20Order\x20ID:\x20`','📊\x20*Connection\x20Status*\x0a\x0a','...\x22','join','Error\x20handling\x20/disconnect\x20command:','telegramId','36627djzrWb','🎉\x20*Congratulations!*\x0a\x0a','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','\x20initialized\x20successfully','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','Failed\x20to\x20send\x20login\x20notification:','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','message','update','stopPolling','sendPaymentNotification','toString','❌\x20Invalid\x20username\x20format:\x20`','ipAddress','Payment\x20failed','default','To\x20reconnect,\x20use\x20the\x20/start\x20command','TELEGRAM_BOT_USERNAME','\x20via\x20single-line\x20input','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','split','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','📧\x20Email:\x20`','...`\x0a\x0a','New\x20payment\x20created','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','from','💸\x20Amount:\x20*','`\x20is\x20inactive.\x0a\x0a','Payout\x20rejected','name','status','174LDZXnT','TELEGRAM_BOT_TOKEN','9YYSjWJ','\x20verified\x20for\x20shop\x20','gateway','Payment\x20is\x20being\x20processed','📱\x20Telegram\x20notification:\x20gateway\x20\x22','sendShopNotification','🔗\x20Endpoint:\x20`','setupBotHandlers','\x20USD*\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','telegramUser','remitterIban','Payment\x20refund','warn','customerName','\x20USDT*\x0a','first_name','🔍\x20*Debug\x20Information*\x0a\x0a','📅\x20Connection\x20date:\x20','Error\x20handling\x20message:','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','onText','processing','🔔\x20You\x20receive\x20notifications\x20about:\x0a','shop','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','675348rbvOKb','Successful\x20login','txid','publicKey','sendApiErrorNotification','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','📝\x20Notes:\x20','log','timestamp','pk_','Contact\x20administrator.','🌐\x20IP:\x20`',':\x20`','.\x20*','🆔\x20Payout\x20ID:\x20`','map','initializeBot','•\x20Payouts\x0a','Check\x20spelling\x20and\x20try\x20again.','❌\x20Shop\x20`','Available\x20usernames:\x0a','customerIp','Use\x20/start\x20to\x20begin.','•\x20New\x20payments\x0a','Error\x20handling\x20/debug\x20command:','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','includes','shopId','../types/gateway','length','💸\x20Penalty\x20amount:\x20*','updatedAt','sendMessage','endpoint','Payout\x20completed','...','Example:\x0a','6990Zlpgjd','✅\x20Telegram\x20user\x20','\x22,\x20apiKey=\x22','username','orderId','New\x20payout\x20created','method','chat\x20not\x20found','Markdown','adminNotes','isVerified','Commands:\x0a','👤\x20Username:\x20`'];a55_0x4206=function(){return _0x153def;};return a55_0x4206();}var __importDefault=this&&this[a55_0x45e497(0x149)]||function(_0x5203e0){const _0x132aae=a55_0x45e497;return _0x5203e0&&_0x5203e0[_0x132aae(0x159)]?_0x5203e0:{'default':_0x5203e0};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a55_0x45e497(0x16c)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a55_0x45e497(0x166))),database_1=__importDefault(require('../config/database')),gateway_1=require(a55_0x45e497(0x1f7));class TelegramBotService{constructor(){const _0x382bbf=a55_0x45e497;this[_0x382bbf(0x163)]=null,this[_0x382bbf(0x214)]=process['env'][_0x382bbf(0x1c0)]||'',this[_0x382bbf(0x15b)]=process['env'][_0x382bbf(0x1b0)]||'trapay_bot',this['botToken']?this[_0x382bbf(0x1eb)]():console[_0x382bbf(0x1ce)](_0x382bbf(0x17e));}['initializeBot'](){const _0xf688b2=a55_0x45e497;try{this[_0xf688b2(0x163)]=new node_telegram_bot_api_1[(_0xf688b2(0x1ae))](this[_0xf688b2(0x214)],{'polling':!![]}),this[_0xf688b2(0x1c8)](),console[_0xf688b2(0x1e2)]('✅\x20Telegram\x20bot\x20@'+this[_0xf688b2(0x15b)]+_0xf688b2(0x1a2));}catch(_0x2bb1ab){console[_0xf688b2(0x215)](_0xf688b2(0x17a),_0x2bb1ab);}}[a55_0x45e497(0x1c8)](){const _0x750f73=a55_0x45e497;if(!this[_0x750f73(0x163)])return;this[_0x750f73(0x163)][_0x750f73(0x1d6)](/\/start/,async _0x2563b8=>{const _0x16a14f=_0x750f73,_0xb3c1b1=_0x2563b8[_0x16a14f(0x225)]['id'],_0x2c9e35=_0x2563b8[_0x16a14f(0x1b9)]?.['id'][_0x16a14f(0x1aa)](),_0x348aa4=_0x2563b8['from']?.['username'],_0x351c9d=_0x2563b8[_0x16a14f(0x1b9)]?.[_0x16a14f(0x1d1)],_0x5d181f=_0x2563b8['from']?.[_0x16a14f(0x191)];if(!_0x2c9e35)return;try{let _0x332891=await database_1['default'][_0x16a14f(0x1cb)][_0x16a14f(0x18c)]({'where':{'telegramId':_0x2c9e35},'include':{'shop':!![]}});!_0x332891?(_0x332891=await database_1['default'][_0x16a14f(0x1cb)]['create']({'data':{'telegramId':_0x2c9e35,'username':_0x348aa4,'firstName':_0x351c9d,'lastName':_0x5d181f,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x16a14f(0x1e2)](_0x16a14f(0x155)+_0x2c9e35+_0x16a14f(0x177)+_0x348aa4+')')):_0x332891=await database_1[_0x16a14f(0x1ae)][_0x16a14f(0x1cb)][_0x16a14f(0x1a7)]({'where':{'telegramId':_0x2c9e35},'data':{'username':_0x348aa4,'firstName':_0x351c9d,'lastName':_0x5d181f},'include':{'shop':!![]}}),_0x332891[_0x16a14f(0x20a)]&&_0x332891[_0x16a14f(0x1f6)]&&_0x332891[_0x16a14f(0x1d9)]?await this[_0x16a14f(0x163)]?.[_0x16a14f(0x1fb)](_0xb3c1b1,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x16a14f(0x1e0)+_0x332891[_0x16a14f(0x1d9)][_0x16a14f(0x1bd)]+'*\x0a')+('Username:\x20`'+_0x332891[_0x16a14f(0x1d9)]['username']+'`\x0a\x0a')+_0x16a14f(0x1d8)+'•\x20New\x20payments\x0a'+_0x16a14f(0x222)+'•\x20Payouts\x0a\x0a'+_0x16a14f(0x20b)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x16a14f(0x187),{'parse_mode':_0x16a14f(0x208)}):(_0x332891[_0x16a14f(0x1f6)]&&!_0x332891[_0x16a14f(0x20a)]&&(await database_1[_0x16a14f(0x1ae)]['telegramUser'][_0x16a14f(0x1a7)]({'where':{'telegramId':_0x2c9e35},'data':{'shopId':null,'isVerified':![]}}),console[_0x16a14f(0x1e2)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x2c9e35)),await this[_0x16a14f(0x163)]?.[_0x16a14f(0x1fb)](_0xb3c1b1,_0x16a14f(0x1b2)+_0x16a14f(0x1a3)+_0x16a14f(0x21d)+_0x16a14f(0x1ff)+_0x16a14f(0x213)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x16a14f(0x208)}));}catch(_0x1cca18){console[_0x16a14f(0x215)](_0x16a14f(0x18d),_0x1cca18),await this[_0x16a14f(0x163)]?.[_0x16a14f(0x1fb)](_0xb3c1b1,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['onText'](/\/disconnect/,async _0x4151b2=>{const _0x53ada3=_0x750f73,_0x24a53b=_0x4151b2[_0x53ada3(0x225)]['id'],_0x34316d=_0x4151b2[_0x53ada3(0x1b9)]?.['id'][_0x53ada3(0x1aa)]();if(!_0x34316d)return;try{const _0x3cdef7=await database_1[_0x53ada3(0x1ae)]['telegramUser'][_0x53ada3(0x18c)]({'where':{'telegramId':_0x34316d},'include':{'shop':!![]}});if(!_0x3cdef7||!_0x3cdef7[_0x53ada3(0x20a)]||!_0x3cdef7['shopId']){await this['bot']?.['sendMessage'](_0x24a53b,_0x53ada3(0x21c));return;}const _0x9ba196=_0x3cdef7[_0x53ada3(0x1d9)]?.[_0x53ada3(0x1bd)]||_0x53ada3(0x212);await database_1['default'][_0x53ada3(0x1cb)][_0x53ada3(0x1a7)]({'where':{'telegramId':_0x34316d},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x53ada3(0x17f)+_0x34316d+_0x53ada3(0x170)+_0x3cdef7[_0x53ada3(0x1f6)]),await this[_0x53ada3(0x163)]?.[_0x53ada3(0x1fb)](_0x24a53b,_0x53ada3(0x1ca)+_0x9ba196+'*.\x0a\x0a'+_0x53ada3(0x1af),{'parse_mode':_0x53ada3(0x208)});}catch(_0x3e3c52){console[_0x53ada3(0x215)](_0x53ada3(0x19d),_0x3e3c52),await this['bot']?.[_0x53ada3(0x1fb)](_0x24a53b,_0x53ada3(0x1da));}}),this[_0x750f73(0x163)]['onText'](/\/status/,async _0x2ba77e=>{const _0x519ead=_0x750f73,_0x182e7a=_0x2ba77e['chat']['id'],_0x2714e7=_0x2ba77e[_0x519ead(0x1b9)]?.['id']['toString']();if(!_0x2714e7)return;try{const _0x2fb8da=await database_1[_0x519ead(0x1ae)][_0x519ead(0x1cb)][_0x519ead(0x18c)]({'where':{'telegramId':_0x2714e7},'include':{'shop':!![]}});if(!_0x2fb8da){await this[_0x519ead(0x163)]?.[_0x519ead(0x1fb)](_0x182e7a,_0x519ead(0x186)+_0x519ead(0x1f1));return;}if(!_0x2fb8da[_0x519ead(0x20a)]||!_0x2fb8da[_0x519ead(0x1f6)]||!_0x2fb8da[_0x519ead(0x1d9)]){await this[_0x519ead(0x163)]?.[_0x519ead(0x1fb)](_0x182e7a,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x519ead(0x220));return;}await this[_0x519ead(0x163)]?.['sendMessage'](_0x182e7a,_0x519ead(0x19a)+(_0x519ead(0x14f)+_0x2fb8da[_0x519ead(0x1d9)][_0x519ead(0x1bd)]+'*\x0a')+(_0x519ead(0x20c)+_0x2fb8da[_0x519ead(0x1d9)][_0x519ead(0x203)]+'`\x0a')+(_0x519ead(0x1d3)+_0x2fb8da[_0x519ead(0x1fa)][_0x519ead(0x172)]('en-US')+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+_0x519ead(0x20b)+_0x519ead(0x187),{'parse_mode':'Markdown'});}catch(_0x5a80fa){console['error'](_0x519ead(0x173),_0x5a80fa),await this[_0x519ead(0x163)]?.[_0x519ead(0x1fb)](_0x182e7a,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x750f73(0x163)][_0x750f73(0x1d6)](/\/debug/,async _0x1bd2be=>{const _0x11b910=_0x750f73,_0x27b3c4=_0x1bd2be[_0x11b910(0x225)]['id'],_0x248241=_0x1bd2be[_0x11b910(0x1b9)]?.['id'][_0x11b910(0x1aa)]();if(!_0x248241)return;try{const _0x10a250=await database_1[_0x11b910(0x1ae)][_0x11b910(0x1d9)][_0x11b910(0x195)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x55baf9=_0x11b910(0x1d2);_0x55baf9+=_0x11b910(0x182)+_0x248241+_0x11b910(0x223),_0x55baf9+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x10a250[_0x11b910(0x153)]((_0x40bb0b,_0x1d1fb5)=>{const _0x277f93=_0x11b910;_0x55baf9+=_0x1d1fb5+0x1+_0x277f93(0x1e8)+_0x40bb0b[_0x277f93(0x1bd)]+'*\x0a',_0x55baf9+='\x20\x20\x20Username:\x20`'+_0x40bb0b['username']+'`\x0a',_0x55baf9+='\x20\x20\x20Status:\x20'+_0x40bb0b[_0x277f93(0x1be)]+'\x0a',_0x55baf9+=_0x277f93(0x14e)+_0x40bb0b[_0x277f93(0x1de)][_0x277f93(0x196)](0x0,0xf)+_0x277f93(0x1b6);}),await this[_0x11b910(0x163)]?.[_0x11b910(0x1fb)](_0x27b3c4,_0x55baf9,{'parse_mode':'Markdown'});}catch(_0x27e443){console[_0x11b910(0x215)](_0x11b910(0x1f3),_0x27e443),await this[_0x11b910(0x163)]?.['sendMessage'](_0x27b3c4,'❌\x20Error\x20getting\x20debug\x20information.');}}),this[_0x750f73(0x163)]['on'](_0x750f73(0x1a6),async _0x169788=>{const _0x3de739=_0x750f73;if(_0x169788[_0x3de739(0x14d)]?.['startsWith']('/'))return;const _0x36218f=_0x169788['chat']['id'],_0xa9880d=_0x169788[_0x3de739(0x1b9)]?.['id']['toString'](),_0x2f9b71=_0x169788['text']?.[_0x3de739(0x224)]();if(!_0xa9880d||!_0x2f9b71)return;try{const _0x1b6a26=await database_1[_0x3de739(0x1ae)][_0x3de739(0x1cb)][_0x3de739(0x18c)]({'where':{'telegramId':_0xa9880d},'include':{'shop':!![]}});if(!_0x1b6a26){await this[_0x3de739(0x163)]?.[_0x3de739(0x1fb)](_0x36218f,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x1b6a26[_0x3de739(0x20a)]&&_0x1b6a26[_0x3de739(0x1f6)]&&_0x1b6a26[_0x3de739(0x1d9)]){await this['bot']?.[_0x3de739(0x1fb)](_0x36218f,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x1b6a26[_0x3de739(0x1d9)][_0x3de739(0x1bd)]+'*.\x0a\x0a'+_0x3de739(0x16d),{'parse_mode':_0x3de739(0x208)});return;}const _0x5203a3=_0x2f9b71[_0x3de739(0x1b3)](/\s+/);if(_0x5203a3[_0x3de739(0x1f8)]!==0x2){await this[_0x3de739(0x163)]?.[_0x3de739(0x1fb)](_0x36218f,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x3de739(0x21d)+_0x3de739(0x1ff)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x3de739(0x17b)+_0x5203a3['length']+_0x3de739(0x17c)+_0x5203a3[_0x3de739(0x1ea)](_0xa2a8e8=>'`'+_0xa2a8e8+'`')[_0x3de739(0x19c)](',\x20')),{'parse_mode':_0x3de739(0x208)});return;}const [_0x4b9e59,_0x44dd13]=_0x5203a3;console[_0x3de739(0x1e2)](_0x3de739(0x192)+_0xa9880d+_0x3de739(0x154)+_0x4b9e59+_0x3de739(0x202)+_0x44dd13[_0x3de739(0x196)](0x0,0xa)+_0x3de739(0x19b)),await this['handleSingleLineVerification'](_0x36218f,_0xa9880d,_0x4b9e59,_0x44dd13);}catch(_0xcba1ab){console[_0x3de739(0x215)](_0x3de739(0x1d4),_0xcba1ab),await this[_0x3de739(0x163)]?.[_0x3de739(0x1fb)](_0x36218f,_0x3de739(0x1da));}}),this[_0x750f73(0x163)]['on']('error',_0x995f08=>{const _0x4f284e=_0x750f73;console[_0x4f284e(0x215)](_0x4f284e(0x16e),_0x995f08);}),this['bot']['on'](_0x750f73(0x168),_0x33bb1c=>{console['error']('Telegram\x20bot\x20polling\x20error:',_0x33bb1c);});}async['handleSingleLineVerification'](_0x4aa2f9,_0x4ace5a,_0xead199,_0x75ccbe){const _0x59129e=a55_0x45e497;try{console['log'](_0x59129e(0x192)+_0x4ace5a+':\x20username=\x22'+_0xead199+'\x22,\x20apiKey=\x22'+_0x75ccbe['substring'](0x0,0xa)+_0x59129e(0x19b));if(!_0xead199||_0xead199[_0x59129e(0x1f8)]<0x3||_0xead199[_0x59129e(0x1f8)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x59129e(0x175)](_0xead199)){await this[_0x59129e(0x163)]?.[_0x59129e(0x1fb)](_0x4aa2f9,_0x59129e(0x1ab)+_0xead199+_0x59129e(0x223)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':'Markdown'});return;}if(!_0x75ccbe||!_0x75ccbe[_0x59129e(0x17d)](_0x59129e(0x1e4))&&!_0x75ccbe[_0x59129e(0x17d)]('sk_')){await this['bot']?.['sendMessage'](_0x4aa2f9,_0x59129e(0x1a1)+_0x59129e(0x184),{'parse_mode':_0x59129e(0x208)});return;}const _0x4552e0=await database_1[_0x59129e(0x1ae)][_0x59129e(0x1d9)][_0x59129e(0x18c)]({'where':{'username':_0xead199},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x4552e0){const _0x4e1538=await database_1['default'][_0x59129e(0x1d9)][_0x59129e(0x195)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x917352=_0x59129e(0x228)+_0xead199+_0x59129e(0x156);_0x4e1538[_0x59129e(0x1f8)]>0x0?(_0x917352+=_0x59129e(0x1ef),_0x4e1538[_0x59129e(0x153)](_0x1c5fb4=>{const _0x1418f3=_0x59129e;_0x917352+=_0x1418f3(0x150)+_0x1c5fb4[_0x1418f3(0x203)]+'`\x20('+_0x1c5fb4[_0x1418f3(0x1bd)]+')\x0a';}),_0x917352+=_0x59129e(0x190)):_0x917352+=_0x59129e(0x1ed);await this['bot']?.[_0x59129e(0x1fb)](_0x4aa2f9,_0x917352,{'parse_mode':_0x59129e(0x208)});return;}if(_0x4552e0[_0x59129e(0x1be)]!==_0x59129e(0x15e)){await this[_0x59129e(0x163)]?.[_0x59129e(0x1fb)](_0x4aa2f9,_0x59129e(0x1ee)+_0xead199+_0x59129e(0x1bb)+_0x59129e(0x1e5),{'parse_mode':_0x59129e(0x208)});return;}if(_0x4552e0[_0x59129e(0x1de)]!==_0x75ccbe&&_0x4552e0[_0x59129e(0x183)]!==_0x75ccbe){await this[_0x59129e(0x163)]?.[_0x59129e(0x1fb)](_0x4aa2f9,_0x59129e(0x174)+_0xead199+_0x59129e(0x16b)+_0x59129e(0x14c)+_0x59129e(0x194),{'parse_mode':_0x59129e(0x208)});return;}const _0x36cf30=await database_1['default'][_0x59129e(0x1cb)][_0x59129e(0x15a)]({'where':{'shopId':_0x4552e0['id'],'isVerified':!![],'telegramId':{'not':_0x4ace5a}}});if(_0x36cf30){await this['bot']?.['sendMessage'](_0x4aa2f9,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0xead199+_0x59129e(0x16b)+_0x59129e(0x1f4),{'parse_mode':_0x59129e(0x208)});return;}await database_1['default'][_0x59129e(0x1cb)]['update']({'where':{'telegramId':_0x4ace5a},'data':{'shopId':_0x4552e0['id'],'isVerified':!![]}}),await this[_0x59129e(0x163)]?.[_0x59129e(0x1fb)](_0x4aa2f9,_0x59129e(0x1a0)+_0x59129e(0x164)+(_0x59129e(0x179)+_0x4552e0[_0x59129e(0x1bd)]+'*\x0a')+(_0x59129e(0x20c)+_0x4552e0[_0x59129e(0x203)]+_0x59129e(0x223))+_0x59129e(0x217)+_0x59129e(0x1f2)+_0x59129e(0x222)+_0x59129e(0x1ec)+_0x59129e(0x148)+_0x59129e(0x20b)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x59129e(0x187),{'parse_mode':'Markdown'}),console[_0x59129e(0x1e2)](_0x59129e(0x201)+_0x4ace5a+_0x59129e(0x1c2)+_0x4552e0[_0x59129e(0x203)]+_0x59129e(0x1b1));}catch(_0x21cf7a){console['error'](_0x59129e(0x185),_0x21cf7a),await this[_0x59129e(0x163)]?.[_0x59129e(0x1fb)](_0x4aa2f9,_0x59129e(0x1a5));}}async[a55_0x45e497(0x1c6)](_0x56b386,_0x1b40f7,_0x40a6f6){const _0x13c9e0=a55_0x45e497;if(!this[_0x13c9e0(0x163)]){console[_0x13c9e0(0x1ce)](_0x13c9e0(0x221));return;}try{const _0x23544a=await database_1[_0x13c9e0(0x1ae)]['telegramUser'][_0x13c9e0(0x195)]({'where':{'shopId':_0x56b386,'isVerified':!![]}});if(_0x23544a[_0x13c9e0(0x1f8)]===0x0){console['log'](_0x13c9e0(0x1b8)+_0x56b386);return;}const _0x2682d1=_0x23544a['map'](async _0x2ec5bb=>{const _0x4203d8=_0x13c9e0;try{await this[_0x4203d8(0x163)]?.[_0x4203d8(0x1fb)](_0x2ec5bb['telegramId'],_0x1b40f7,_0x40a6f6),console[_0x4203d8(0x1e2)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x2ec5bb[_0x4203d8(0x19e)]);}catch(_0x2d8319){console[_0x4203d8(0x215)](_0x4203d8(0x160)+_0x2ec5bb['telegramId']+':',_0x2d8319),_0x2d8319 instanceof Error&&(_0x2d8319[_0x4203d8(0x1a6)][_0x4203d8(0x1f5)]('blocked')||_0x2d8319['message']['includes'](_0x4203d8(0x207))||_0x2d8319[_0x4203d8(0x1a6)][_0x4203d8(0x1f5)](_0x4203d8(0x18a)))&&(await database_1[_0x4203d8(0x1ae)][_0x4203d8(0x1cb)][_0x4203d8(0x1a7)]({'where':{'id':_0x2ec5bb['id']},'data':{'isVerified':![]}}),console[_0x4203d8(0x1e2)]('User\x20'+_0x2ec5bb[_0x4203d8(0x19e)]+_0x4203d8(0x1b4)));}});await Promise[_0x13c9e0(0x21b)](_0x2682d1);}catch(_0x4375f1){console[_0x13c9e0(0x215)]('Error\x20sending\x20shop\x20notification:',_0x4375f1);}}async[a55_0x45e497(0x1a9)](_0x2adb74,_0x127ea9,_0x308d32){const _0x931fe7=a55_0x45e497,_0x2e104d={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x3f08b5={'created':_0x931fe7(0x1b7),'paid':_0x931fe7(0x158),'failed':_0x931fe7(0x1ad),'expired':_0x931fe7(0x21a),'refund':_0x931fe7(0x1cd),'chargeback':_0x931fe7(0x197),'processing':_0x931fe7(0x1c4)},_0x5a7740=_0x2e104d[_0x308d32],_0x48a8dc=_0x3f08b5[_0x308d32],_0x35c2ec=(0x0,gateway_1[_0x931fe7(0x18b)])(_0x127ea9[_0x931fe7(0x1c3)]);console['log'](_0x931fe7(0x1c5)+_0x127ea9[_0x931fe7(0x1c3)]+'\x22\x20->\x20display\x20\x22'+_0x35c2ec+'\x22');let _0x5a0e93=_0x5a7740+'\x20*'+_0x48a8dc+_0x931fe7(0x227)+(_0x931fe7(0x229)+_0x127ea9[_0x931fe7(0x147)]+'\x20'+_0x127ea9['currency']+'*\x0a')+(_0x931fe7(0x199)+(_0x127ea9[_0x931fe7(0x204)]||_0x127ea9['id'])+'`\x0a')+(_0x931fe7(0x176)+_0x127ea9['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x35c2ec+'`\x0a')+(_0x931fe7(0x21e)+new Date(_0x127ea9['createdAt'])[_0x931fe7(0x198)](_0x931fe7(0x165))+'\x0a');if(_0x127ea9['customerName']||_0x127ea9['customerEmail']||_0x127ea9[_0x931fe7(0x1cc)]||_0x127ea9[_0x931fe7(0x1f0)]||_0x127ea9[_0x931fe7(0x20e)]){_0x5a0e93+=_0x931fe7(0x219);_0x127ea9[_0x931fe7(0x1cf)]&&(_0x5a0e93+=_0x931fe7(0x211)+_0x127ea9['customerName']+'`\x0a');_0x127ea9[_0x931fe7(0x193)]&&(_0x5a0e93+=_0x931fe7(0x1b5)+_0x127ea9[_0x931fe7(0x193)]+'`\x0a');_0x127ea9[_0x931fe7(0x1cc)]&&(_0x5a0e93+='🏦\x20IBAN:\x20`'+_0x127ea9[_0x931fe7(0x1cc)]+'`\x0a');_0x127ea9[_0x931fe7(0x1f0)]&&(_0x5a0e93+=_0x931fe7(0x1e6)+_0x127ea9[_0x931fe7(0x1f0)]+'`\x0a');if(_0x127ea9[_0x931fe7(0x20e)]){const _0x2420b0=_0x127ea9[_0x931fe7(0x20e)][_0x931fe7(0x1f8)]>0x32?_0x127ea9['customerUa']['substring'](0x0,0x32)+_0x931fe7(0x1fe):_0x127ea9['customerUa'];_0x5a0e93+='💻\x20Browser:\x20`'+_0x2420b0+'`\x0a';}}_0x308d32==='chargeback'&&_0x127ea9[_0x931fe7(0x162)]&&(_0x5a0e93+=_0x931fe7(0x1f9)+_0x127ea9[_0x931fe7(0x162)]+_0x931fe7(0x1d0)),_0x308d32===_0x931fe7(0x1d7)&&(_0x5a0e93+=_0x931fe7(0x16a)),_0x127ea9[_0x931fe7(0x209)]&&(_0x5a0e93+=_0x931fe7(0x1e1)+_0x127ea9['adminNotes']+'\x0a'),await this[_0x931fe7(0x1c6)](_0x2adb74,_0x5a0e93,{'parse_mode':_0x931fe7(0x208)});}async[a55_0x45e497(0x180)](_0x11b3e7,_0x31fb7c,_0x2956a6){const _0x38a77a=a55_0x45e497,_0x436b50={'created':'📤','completed':'✅','rejected':'❌'},_0x1bb8b3={'created':_0x38a77a(0x205),'completed':_0x38a77a(0x1fd),'rejected':_0x38a77a(0x1bc)},_0x3ff8da=_0x436b50[_0x2956a6],_0x11729d=_0x1bb8b3[_0x2956a6],_0x33ae41=_0x3ff8da+'\x20*'+_0x11729d+_0x38a77a(0x227)+(_0x38a77a(0x1ba)+_0x31fb7c[_0x38a77a(0x147)]+_0x38a77a(0x1c9))+('🏦\x20Method:\x20`'+_0x31fb7c[_0x38a77a(0x206)]+'`\x0a')+(_0x38a77a(0x1e9)+_0x31fb7c['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x31fb7c[_0x38a77a(0x226)])[_0x38a77a(0x198)](_0x38a77a(0x165))+'\x0a')+(_0x31fb7c['txid']?_0x38a77a(0x169)+_0x31fb7c[_0x38a77a(0x1dd)]+'`':'');await this['sendShopNotification'](_0x11b3e7,_0x33ae41,{'parse_mode':_0x38a77a(0x208)});}async[a55_0x45e497(0x15d)](_0x474648,_0x46e435){const _0x1cf11e=a55_0x45e497;try{const _0x1e2e6f=await database_1[_0x1cf11e(0x1ae)][_0x1cf11e(0x178)][_0x1cf11e(0x18c)]({'where':{'shopId':_0x474648},'select':{'notificationLogin':!![]}});if(!_0x1e2e6f?.['notificationLogin']){console[_0x1cf11e(0x1e2)](_0x1cf11e(0x157)+_0x474648);return;}const _0x294c21=_0x46e435[_0x1cf11e(0x189)]?'🔐':'🚨',_0x2e5008=_0x46e435[_0x1cf11e(0x189)]?_0x1cf11e(0x1dc):'Failed\x20login\x20attempt';let _0x34f61e=_0x294c21+'\x20*'+_0x2e5008+_0x1cf11e(0x227)+(_0x1cf11e(0x20c)+_0x46e435['username']+'`\x0a')+('📅\x20Time:\x20'+_0x46e435[_0x1cf11e(0x1e3)][_0x1cf11e(0x198)](_0x1cf11e(0x165))+'\x0a');_0x46e435['ipAddress']&&(_0x34f61e+='🌐\x20IP\x20address:\x20`'+_0x46e435[_0x1cf11e(0x1ac)]+'`\x0a');if(_0x46e435[_0x1cf11e(0x218)]){const _0x32068b=_0x46e435[_0x1cf11e(0x218)][_0x1cf11e(0x1f8)]>0x32?_0x46e435[_0x1cf11e(0x218)]['substring'](0x0,0x32)+_0x1cf11e(0x1fe):_0x46e435[_0x1cf11e(0x218)];_0x34f61e+='💻\x20Browser:\x20`'+_0x32068b+'`\x0a';}!_0x46e435[_0x1cf11e(0x189)]&&(_0x34f61e+=_0x1cf11e(0x161)),await this[_0x1cf11e(0x1c6)](_0x474648,_0x34f61e,{'parse_mode':_0x1cf11e(0x208)}),console['log'](_0x1cf11e(0x1d5)+_0x474648+':\x20'+(_0x46e435[_0x1cf11e(0x189)]?_0x1cf11e(0x189):_0x1cf11e(0x210)));}catch(_0x57df42){console['error'](_0x1cf11e(0x1a4),_0x57df42);}}async[a55_0x45e497(0x1df)](_0x5e1622,_0x1f1afd){const _0x35447c=a55_0x45e497;try{const _0x1fafeb=await database_1[_0x35447c(0x1ae)]['shopSettings'][_0x35447c(0x18c)]({'where':{'shopId':_0x5e1622},'select':{'notificationApiError':!![]}});if(!_0x1fafeb?.[_0x35447c(0x181)]){console[_0x35447c(0x1e2)](_0x35447c(0x21f)+_0x5e1622);return;}let _0x92941c='🚨\x20*API\x20Error*\x0a\x0a'+(_0x35447c(0x1c7)+_0x1f1afd[_0x35447c(0x206)]+'\x20'+_0x1f1afd['endpoint']+'`\x0a')+(_0x35447c(0x16f)+_0x1f1afd[_0x35447c(0x1e3)]['toLocaleString'](_0x35447c(0x165))+'\x0a');_0x1f1afd[_0x35447c(0x18e)]&&(_0x92941c+=_0x35447c(0x152)+_0x1f1afd[_0x35447c(0x18e)]+'`\x0a'),_0x92941c+='❌\x20Error:\x20`'+_0x1f1afd['errorMessage']+'`\x0a',_0x1f1afd[_0x35447c(0x151)]&&(_0x92941c+='🆔\x20Request\x20ID:\x20`'+_0x1f1afd[_0x35447c(0x151)]+'`\x0a'),_0x92941c+=_0x35447c(0x188),await this['sendShopNotification'](_0x5e1622,_0x92941c,{'parse_mode':_0x35447c(0x208)}),console[_0x35447c(0x1e2)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x5e1622+':\x20'+_0x1f1afd[_0x35447c(0x1fc)]);}catch(_0x195fb3){console[_0x35447c(0x215)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x195fb3);}}async[a55_0x45e497(0x14b)](_0x1e6fbe,_0x4c8960,_0x2a47b4){const _0x37fd50=a55_0x45e497;let _0x30bbd8=_0x37fd50(0x15f)+_0x4c8960+_0x37fd50(0x227);for(const [_0x181989,_0x14b6c7]of Object['entries'](_0x2a47b4)){_0x14b6c7!==null&&_0x14b6c7!==undefined&&(_0x30bbd8+=_0x181989+_0x37fd50(0x1e7)+_0x14b6c7+'`\x0a');}await this['sendShopNotification'](_0x1e6fbe,_0x30bbd8,{'parse_mode':_0x37fd50(0x208)});}['getBotInfo'](){const _0x23c38c=a55_0x45e497;return{'isActive':!!this[_0x23c38c(0x163)],'username':this[_0x23c38c(0x15b)]};}[a55_0x45e497(0x20f)](){const _0x2121db=a55_0x45e497;this['bot']&&(this['bot'][_0x2121db(0x1a8)](),this[_0x2121db(0x163)]=null,console[_0x2121db(0x1e2)](_0x2121db(0x216)));}}exports[a55_0x45e497(0x171)]=TelegramBotService,exports[a55_0x45e497(0x16c)]=new TelegramBotService();