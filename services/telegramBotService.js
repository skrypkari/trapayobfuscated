'use strict';const a57_0x896da4=a57_0x2227;function a57_0x2227(_0x5f2229,_0x30e156){const _0x2fc6a4=a57_0x2fc6();return a57_0x2227=function(_0x22273b,_0xc1329d){_0x22273b=_0x22273b-0x95;let _0x4216b5=_0x2fc6a4[_0x22273b];return _0x4216b5;},a57_0x2227(_0x5f2229,_0x30e156);}(function(_0x5a4b6a,_0x419e1e){const _0x58a5a3=a57_0x2227,_0x1ba7fa=_0x5a4b6a();while(!![]){try{const _0x41ea33=-parseInt(_0x58a5a3(0xa2))/0x1+-parseInt(_0x58a5a3(0x170))/0x2*(-parseInt(_0x58a5a3(0x159))/0x3)+-parseInt(_0x58a5a3(0xab))/0x4*(-parseInt(_0x58a5a3(0xe0))/0x5)+parseInt(_0x58a5a3(0xea))/0x6*(parseInt(_0x58a5a3(0x173))/0x7)+-parseInt(_0x58a5a3(0xcd))/0x8*(-parseInt(_0x58a5a3(0xfa))/0x9)+-parseInt(_0x58a5a3(0xb2))/0xa+-parseInt(_0x58a5a3(0x160))/0xb;if(_0x41ea33===_0x419e1e)break;else _0x1ba7fa['push'](_0x1ba7fa['shift']());}catch(_0x4b9527){_0x1ba7fa['push'](_0x1ba7fa['shift']());}}}(a57_0x2fc6,0x9e198));var __importDefault=this&&this[a57_0x896da4(0x113)]||function(_0x1d50fd){const _0x1b8895=a57_0x896da4;return _0x1d50fd&&_0x1d50fd[_0x1b8895(0xc9)]?_0x1d50fd:{'default':_0x1d50fd};};function a57_0x2fc6(){const _0x4397e6=['✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','en-US','chargebackAmount','error','sendPaymentNotification','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','💸\x20Penalty\x20amount:\x20*','../types/gateway','📅\x20Connection\x20date:\x20','trim','polling_error','*\x0a\x0a','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','📅\x20Date:\x20','✅\x20Telegram\x20bot\x20@','📊\x20Error\x20code:\x20`','from','🔗\x20TXID:\x20`','Username:\x20`','To\x20reconnect,\x20use\x20the\x20/start\x20command','name','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','includes','Payment\x20chargeback','currency','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','Error\x20handling\x20/status\x20command:','Payment\x20expired','timestamp','🆔\x20Payout\x20ID:\x20`','Error\x20handling\x20/debug\x20command:','🏪\x20Gateway:\x20`','👤\x20Username:\x20`','node-telegram-bot-api','\x22,\x20apiKey=\x22','\x0aCheck\x20spelling\x20and\x20try\x20again.','❌\x20Please\x20use\x20/start\x20command\x20first','customerUa','toString','🏦\x20Method:\x20`','txid','sendCustomNotification','📝\x20Notes:\x20','User\x20',':\x20username=\x22','Payment\x20failed','customerIp','amount','❌\x20Error:\x20`','username','sendMessage','📱\x20Shop:\x20*','•\x20Payouts\x0a','📛\x20Name:\x20`','`\x0a\x0a','\x20USD*\x0a','botToken','📊\x20*Connection\x20Status*\x0a\x0a','sendApiErrorNotification','findMany','`\x20not\x20found.\x0a\x0a','3ZygGaI','🔔\x20You\x20receive\x20notifications\x20about:\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','•\x20Important\x20events\x0a\x0a','toLocaleString','endpoint','.\x20*','14852112JTPMeS','Telegram\x20bot\x20polling\x20error:','text','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','length','\x20verified\x20for\x20shop\x20','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Available\x20usernames:\x0a','🔔\x20*','`.\x0a\x0a','userAgent','substring','chat\x20not\x20found','failed','🚨\x20*API\x20Error*\x0a\x0a','Failed\x20to\x20send\x20login\x20notification:','1527004nJZTGx','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','chat','2027627CnABQk','\x0a👤\x20*Customer\x20Information:*\x0a','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','gateway','📅\x20Time:\x20','🔍\x20*Debug\x20Information*\x0a\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','📧\x20Email:\x20`','blocked','`\x20(','shopId','notificationLogin','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','shopSettings','Error\x20in\x20handleSingleLineVerification:','setupBotHandlers','orderId','🔌\x20User\x20','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','354523jYjRZU','Payment\x20successfully\x20paid','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','🏦\x20IBAN:\x20`','requestId','\x20\x20\x20Status:\x20','publicKey','Commands:\x0a','sendPayoutNotification','500dMFdtL','Use\x20/start\x20to\x20begin.','Payout\x20rejected','forEach','📱\x20Created\x20new\x20Telegram\x20user:\x20','...\x22','status','7250740ZdjxMF','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','botUsername','Markdown','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','success','processing','customerEmail','message','💸\x20Amount:\x20*','telegramBotService','update','test','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','sendShopNotification','🌐\x20IP:\x20`','❌\x20Invalid\x20username\x20format:\x20`','shop','*.\x0a\x0a','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','Use\x20/start\x20to\x20connect.','createdAt','Example:\x0a','__esModule','TelegramBotService','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','Error\x20sending\x20shop\x20notification:','792008PCpIrj','Successful\x20login','defineProperty','•\x20Payouts\x0a\x0a','unknown\x20shop','TELEGRAM_BOT_TOKEN','findUnique','Payout\x20completed','Error\x20handling\x20/start\x20command:','trapay_bot','\x20USDT*\x0a','remitterIban','statusCode','🎉\x20*Congratulations!*\x0a\x0a',':\x20`','•\x20`','customerName','•\x20New\x20payments\x0a','map','37995ESExcy','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','pk_','...','Failed\x20login\x20attempt','❌\x20Error\x20getting\x20debug\x20information.','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','❌\x20Shop\x20with\x20username\x20`','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','18aaFofq','method','adminNotes','\x20(@','telegramUser','handleSingleLineVerification','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','entries','env','...`\x0a\x0a','❌\x20Shop\x20`','secretKey','default','first_name','•\x20Payment\x20status\x20changes\x0a','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','45ecQxBE','chargeback','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','📝\x20Order\x20ID:\x20`','🆔\x20Payment\x20ID:\x20`','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','✅\x20Welcome\x20back!\x0a\x0a','onText','startsWith','🌐\x20IP\x20address:\x20`','toLocaleDateString','allSettled','sendLoginNotification','split','getBotInfo','log','findFirst','notificationApiError','/disconnect\x20-\x20disconnect\x20from\x20notifications','isVerified','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','💻\x20Browser:\x20`','telegramId','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','__importDefault','/status\x20-\x20check\x20connection\x20status\x0a','create','Error\x20handling\x20/disconnect\x20command:','Contact\x20administrator.','ipAddress','bot'];a57_0x2fc6=function(){return _0x4397e6;};return a57_0x2fc6();}Object[a57_0x896da4(0xcf)](exports,'__esModule',{'value':!![]}),exports[a57_0x896da4(0xbc)]=exports[a57_0x896da4(0xca)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a57_0x896da4(0x13d))),database_1=__importDefault(require('../config/database')),gateway_1=require(a57_0x896da4(0x122));class TelegramBotService{constructor(){const _0x558e5f=a57_0x896da4;this[_0x558e5f(0x119)]=null,this[_0x558e5f(0x154)]=process[_0x558e5f(0xf2)][_0x558e5f(0xd2)]||'',this[_0x558e5f(0xb4)]=process[_0x558e5f(0xf2)]['TELEGRAM_BOT_USERNAME']||_0x558e5f(0xd6),this[_0x558e5f(0x154)]?this['initializeBot']():console['warn']('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}['initializeBot'](){const _0x19d5e9=a57_0x896da4;try{this['bot']=new node_telegram_bot_api_1['default'](this['botToken'],{'polling':!![]}),this['setupBotHandlers'](),console['log'](_0x19d5e9(0x12a)+this['botUsername']+'\x20initialized\x20successfully');}catch(_0x3f6ff8){console[_0x19d5e9(0x11d)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x3f6ff8);}}[a57_0x896da4(0x9c)](){const _0x3005ef=a57_0x896da4;if(!this['bot'])return;this['bot'][_0x3005ef(0x102)](/\/start/,async _0x1b8d28=>{const _0x1cee3c=_0x3005ef,_0xacd143=_0x1b8d28['chat']['id'],_0x2c9f89=_0x1b8d28[_0x1cee3c(0x12c)]?.['id'][_0x1cee3c(0x142)](),_0xe868c1=_0x1b8d28[_0x1cee3c(0x12c)]?.['username'],_0x13b198=_0x1b8d28['from']?.[_0x1cee3c(0xf7)],_0x4c34ac=_0x1b8d28[_0x1cee3c(0x12c)]?.['last_name'];if(!_0x2c9f89)return;try{let _0x20cdeb=await database_1['default'][_0x1cee3c(0xee)][_0x1cee3c(0xd3)]({'where':{'telegramId':_0x2c9f89},'include':{'shop':!![]}});!_0x20cdeb?(_0x20cdeb=await database_1[_0x1cee3c(0xf6)][_0x1cee3c(0xee)][_0x1cee3c(0x115)]({'data':{'telegramId':_0x2c9f89,'username':_0xe868c1,'firstName':_0x13b198,'lastName':_0x4c34ac,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x1cee3c(0x10a)](_0x1cee3c(0xaf)+_0x2c9f89+_0x1cee3c(0xed)+_0xe868c1+')')):_0x20cdeb=await database_1[_0x1cee3c(0xf6)][_0x1cee3c(0xee)][_0x1cee3c(0xbd)]({'where':{'telegramId':_0x2c9f89},'data':{'username':_0xe868c1,'firstName':_0x13b198,'lastName':_0x4c34ac},'include':{'shop':!![]}}),_0x20cdeb['isVerified']&&_0x20cdeb[_0x1cee3c(0x97)]&&_0x20cdeb[_0x1cee3c(0xc3)]?await this[_0x1cee3c(0x119)]?.['sendMessage'](_0xacd143,_0x1cee3c(0x101)+(_0x1cee3c(0xa1)+_0x20cdeb['shop'][_0x1cee3c(0x130)]+'*\x0a')+(_0x1cee3c(0x12e)+_0x20cdeb['shop'][_0x1cee3c(0x14d)]+_0x1cee3c(0x152))+_0x1cee3c(0x15a)+_0x1cee3c(0xde)+_0x1cee3c(0xf8)+_0x1cee3c(0xd0)+_0x1cee3c(0xa9)+_0x1cee3c(0x114)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}):(_0x20cdeb[_0x1cee3c(0x97)]&&!_0x20cdeb[_0x1cee3c(0x10e)]&&(await database_1[_0x1cee3c(0xf6)][_0x1cee3c(0xee)][_0x1cee3c(0xbd)]({'where':{'telegramId':_0x2c9f89},'data':{'shopId':null,'isVerified':![]}}),console[_0x1cee3c(0x10a)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x2c9f89)),await this[_0x1cee3c(0x119)]?.[_0x1cee3c(0x14e)](_0xacd143,_0x1cee3c(0xf9)+_0x1cee3c(0x112)+_0x1cee3c(0xbf)+_0x1cee3c(0xc8)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x1cee3c(0xa4),{'parse_mode':_0x1cee3c(0xb5)}));}catch(_0x3873b6){console['error'](_0x1cee3c(0xd5),_0x3873b6),await this['bot']?.['sendMessage'](_0xacd143,_0x1cee3c(0x171));}}),this['bot'][_0x3005ef(0x102)](/\/disconnect/,async _0x3b9b13=>{const _0xaaefb0=_0x3005ef,_0xe56387=_0x3b9b13[_0xaaefb0(0x172)]['id'],_0x4ff7d6=_0x3b9b13[_0xaaefb0(0x12c)]?.['id'][_0xaaefb0(0x142)]();if(!_0x4ff7d6)return;try{const _0x40844e=await database_1[_0xaaefb0(0xf6)][_0xaaefb0(0xee)]['findUnique']({'where':{'telegramId':_0x4ff7d6},'include':{'shop':!![]}});if(!_0x40844e||!_0x40844e[_0xaaefb0(0x10e)]||!_0x40844e[_0xaaefb0(0x97)]){await this['bot']?.['sendMessage'](_0xe56387,_0xaaefb0(0xe9));return;}const _0x3320c9=_0x40844e[_0xaaefb0(0xc3)]?.[_0xaaefb0(0x130)]||_0xaaefb0(0xd1);await database_1[_0xaaefb0(0xf6)][_0xaaefb0(0xee)][_0xaaefb0(0xbd)]({'where':{'telegramId':_0x4ff7d6},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0xaaefb0(0x9e)+_0x4ff7d6+'\x20disconnected\x20from\x20shop\x20'+_0x40844e[_0xaaefb0(0x97)]),await this[_0xaaefb0(0x119)]?.['sendMessage'](_0xe56387,_0xaaefb0(0x15b)+_0x3320c9+_0xaaefb0(0xc4)+_0xaaefb0(0x12f),{'parse_mode':_0xaaefb0(0xb5)});}catch(_0x5eccd6){console[_0xaaefb0(0x11d)](_0xaaefb0(0x116),_0x5eccd6),await this['bot']?.[_0xaaefb0(0x14e)](_0xe56387,_0xaaefb0(0x171));}}),this['bot'][_0x3005ef(0x102)](/\/status/,async _0x45f2f3=>{const _0x5e86a0=_0x3005ef,_0x340c46=_0x45f2f3[_0x5e86a0(0x172)]['id'],_0x555d6e=_0x45f2f3[_0x5e86a0(0x12c)]?.['id'][_0x5e86a0(0x142)]();if(!_0x555d6e)return;try{const _0x488f45=await database_1['default'][_0x5e86a0(0xee)][_0x5e86a0(0xd3)]({'where':{'telegramId':_0x555d6e},'include':{'shop':!![]}});if(!_0x488f45){await this['bot']?.[_0x5e86a0(0x14e)](_0x340c46,_0x5e86a0(0xb3)+_0x5e86a0(0xac));return;}if(!_0x488f45[_0x5e86a0(0x10e)]||!_0x488f45[_0x5e86a0(0x97)]||!_0x488f45['shop']){await this[_0x5e86a0(0x119)]?.[_0x5e86a0(0x14e)](_0x340c46,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x5e86a0(0xc6));return;}await this[_0x5e86a0(0x119)]?.['sendMessage'](_0x340c46,_0x5e86a0(0x155)+('✅\x20Connected\x20to\x20shop:\x20*'+_0x488f45['shop'][_0x5e86a0(0x130)]+'*\x0a')+(_0x5e86a0(0x13c)+_0x488f45['shop'][_0x5e86a0(0x14d)]+'`\x0a')+(_0x5e86a0(0x123)+_0x488f45['updatedAt'][_0x5e86a0(0x105)](_0x5e86a0(0x11b))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+_0x5e86a0(0xa9)+_0x5e86a0(0x10d),{'parse_mode':_0x5e86a0(0xb5)});}catch(_0x5ec952){console[_0x5e86a0(0x11d)](_0x5e86a0(0x136),_0x5ec952),await this[_0x5e86a0(0x119)]?.[_0x5e86a0(0x14e)](_0x340c46,_0x5e86a0(0x171));}}),this['bot']['onText'](/\/debug/,async _0x562737=>{const _0xff3e21=_0x3005ef,_0x2733e8=_0x562737[_0xff3e21(0x172)]['id'],_0x47b346=_0x562737[_0xff3e21(0x12c)]?.['id']['toString']();if(!_0x47b346)return;try{const _0x54d684=await database_1[_0xff3e21(0xf6)]['shop'][_0xff3e21(0x157)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x302f36=_0xff3e21(0x179);_0x302f36+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x47b346+_0xff3e21(0x152),_0x302f36+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x54d684[_0xff3e21(0xae)]((_0x53874d,_0x2e741d)=>{const _0x4dc48e=_0xff3e21;_0x302f36+=_0x2e741d+0x1+_0x4dc48e(0x15f)+_0x53874d['name']+'*\x0a',_0x302f36+='\x20\x20\x20Username:\x20`'+_0x53874d[_0x4dc48e(0x14d)]+'`\x0a',_0x302f36+=_0x4dc48e(0xa7)+_0x53874d[_0x4dc48e(0xb1)]+'\x0a',_0x302f36+='\x20\x20\x20Public\x20Key:\x20`'+_0x53874d[_0x4dc48e(0xa8)][_0x4dc48e(0x16b)](0x0,0xf)+_0x4dc48e(0xf3);}),await this[_0xff3e21(0x119)]?.[_0xff3e21(0x14e)](_0x2733e8,_0x302f36,{'parse_mode':_0xff3e21(0xb5)});}catch(_0x598f94){console[_0xff3e21(0x11d)](_0xff3e21(0x13a),_0x598f94),await this[_0xff3e21(0x119)]?.[_0xff3e21(0x14e)](_0x2733e8,_0xff3e21(0xe5));}}),this[_0x3005ef(0x119)]['on'](_0x3005ef(0xba),async _0x49c622=>{const _0x128f6c=_0x3005ef;if(_0x49c622[_0x128f6c(0x162)]?.[_0x128f6c(0x103)]('/'))return;const _0x342ab8=_0x49c622[_0x128f6c(0x172)]['id'],_0xb9ddba=_0x49c622[_0x128f6c(0x12c)]?.['id'][_0x128f6c(0x142)](),_0x18628a=_0x49c622[_0x128f6c(0x162)]?.[_0x128f6c(0x124)]();if(!_0xb9ddba||!_0x18628a)return;try{const _0x3ac9ec=await database_1[_0x128f6c(0xf6)][_0x128f6c(0xee)][_0x128f6c(0xd3)]({'where':{'telegramId':_0xb9ddba},'include':{'shop':!![]}});if(!_0x3ac9ec){await this[_0x128f6c(0x119)]?.[_0x128f6c(0x14e)](_0x342ab8,_0x128f6c(0x140));return;}if(_0x3ac9ec[_0x128f6c(0x10e)]&&_0x3ac9ec[_0x128f6c(0x97)]&&_0x3ac9ec[_0x128f6c(0xc3)]){await this[_0x128f6c(0x119)]?.['sendMessage'](_0x342ab8,_0x128f6c(0xff)+_0x3ac9ec['shop']['name']+_0x128f6c(0xc4)+_0x128f6c(0xf0),{'parse_mode':'Markdown'});return;}const _0x41db8b=_0x18628a[_0x128f6c(0x108)](/\s+/);if(_0x41db8b[_0x128f6c(0x164)]!==0x2){await this[_0x128f6c(0x119)]?.[_0x128f6c(0x14e)](_0x342ab8,_0x128f6c(0x10f)+_0x128f6c(0xbf)+_0x128f6c(0xc8)+_0x128f6c(0xa0)+('You\x20sent\x20'+_0x41db8b[_0x128f6c(0x164)]+'\x20parts:\x20'+_0x41db8b['map'](_0x212a1c=>'`'+_0x212a1c+'`')['join'](',\x20')),{'parse_mode':_0x128f6c(0xb5)});return;}const [_0x56d300,_0x9e083e]=_0x41db8b;console[_0x128f6c(0x10a)](_0x128f6c(0x166)+_0xb9ddba+_0x128f6c(0x148)+_0x56d300+_0x128f6c(0x13e)+_0x9e083e[_0x128f6c(0x16b)](0x0,0xa)+_0x128f6c(0xb0)),await this['handleSingleLineVerification'](_0x342ab8,_0xb9ddba,_0x56d300,_0x9e083e);}catch(_0x59f6fa){console['error']('Error\x20handling\x20message:',_0x59f6fa),await this[_0x128f6c(0x119)]?.['sendMessage'](_0x342ab8,_0x128f6c(0x171));}}),this[_0x3005ef(0x119)]['on'](_0x3005ef(0x11d),_0x31bd36=>{const _0x171a68=_0x3005ef;console[_0x171a68(0x11d)]('Telegram\x20bot\x20error:',_0x31bd36);}),this[_0x3005ef(0x119)]['on'](_0x3005ef(0x125),_0x23b42d=>{const _0x75ebf4=_0x3005ef;console[_0x75ebf4(0x11d)](_0x75ebf4(0x161),_0x23b42d);});}async[a57_0x896da4(0xef)](_0x30552d,_0x4571c7,_0x2a4236,_0x94026a){const _0x34a091=a57_0x896da4;try{console[_0x34a091(0x10a)](_0x34a091(0x166)+_0x4571c7+_0x34a091(0x148)+_0x2a4236+_0x34a091(0x13e)+_0x94026a[_0x34a091(0x16b)](0x0,0xa)+_0x34a091(0xb0));if(!_0x2a4236||_0x2a4236['length']<0x3||_0x2a4236[_0x34a091(0x164)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x34a091(0xbe)](_0x2a4236)){await this[_0x34a091(0x119)]?.['sendMessage'](_0x30552d,_0x34a091(0xc2)+_0x2a4236+_0x34a091(0x152)+_0x34a091(0x99),{'parse_mode':_0x34a091(0xb5)});return;}if(!_0x94026a||!_0x94026a[_0x34a091(0x103)](_0x34a091(0xe2))&&!_0x94026a[_0x34a091(0x103)]('sk_')){await this[_0x34a091(0x119)]?.[_0x34a091(0x14e)](_0x30552d,_0x34a091(0xb6)+_0x34a091(0x11f),{'parse_mode':_0x34a091(0xb5)});return;}const _0xd3f392=await database_1[_0x34a091(0xf6)]['shop'][_0x34a091(0xd3)]({'where':{'username':_0x2a4236},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0xd3f392){const _0x19e0e7=await database_1[_0x34a091(0xf6)][_0x34a091(0xc3)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x3703c1=_0x34a091(0xe7)+_0x2a4236+_0x34a091(0x158);_0x19e0e7['length']>0x0?(_0x3703c1+=_0x34a091(0x167),_0x19e0e7['forEach'](_0xab3a=>{const _0x20eb11=_0x34a091;_0x3703c1+=_0x20eb11(0xdc)+_0xab3a[_0x20eb11(0x14d)]+_0x20eb11(0x96)+_0xab3a['name']+')\x0a';}),_0x3703c1+=_0x34a091(0x13f)):_0x3703c1+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x34a091(0x119)]?.[_0x34a091(0x14e)](_0x30552d,_0x3703c1,{'parse_mode':_0x34a091(0xb5)});return;}if(_0xd3f392[_0x34a091(0xb1)]!=='ACTIVE'){await this[_0x34a091(0x119)]?.['sendMessage'](_0x30552d,_0x34a091(0xf4)+_0x2a4236+'`\x20is\x20inactive.\x0a\x0a'+_0x34a091(0x117),{'parse_mode':_0x34a091(0xb5)});return;}if(_0xd3f392['publicKey']!==_0x94026a&&_0xd3f392[_0x34a091(0xf5)]!==_0x94026a){await this[_0x34a091(0x119)]?.['sendMessage'](_0x30552d,_0x34a091(0xfc)+_0x2a4236+'`.\x0a\x0a'+_0x34a091(0x135)+_0x34a091(0xe1),{'parse_mode':'Markdown'});return;}const _0x519376=await database_1['default'][_0x34a091(0xee)][_0x34a091(0x10b)]({'where':{'shopId':_0xd3f392['id'],'isVerified':!![],'telegramId':{'not':_0x4571c7}}});if(_0x519376){await this[_0x34a091(0x119)]?.['sendMessage'](_0x30552d,_0x34a091(0x127)+_0x2a4236+_0x34a091(0x169)+_0x34a091(0x175),{'parse_mode':'Markdown'});return;}await database_1[_0x34a091(0xf6)][_0x34a091(0xee)][_0x34a091(0xbd)]({'where':{'telegramId':_0x4571c7},'data':{'shopId':_0xd3f392['id'],'isVerified':!![]}}),await this[_0x34a091(0x119)]?.[_0x34a091(0x14e)](_0x30552d,_0x34a091(0xda)+_0x34a091(0x128)+(_0x34a091(0x14f)+_0xd3f392[_0x34a091(0x130)]+'*\x0a')+('👤\x20Username:\x20`'+_0xd3f392[_0x34a091(0x14d)]+_0x34a091(0x152))+_0x34a091(0x163)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+_0x34a091(0x150)+_0x34a091(0x15c)+_0x34a091(0xa9)+_0x34a091(0x114)+_0x34a091(0x10d),{'parse_mode':_0x34a091(0xb5)}),console[_0x34a091(0x10a)]('✅\x20Telegram\x20user\x20'+_0x4571c7+_0x34a091(0x165)+_0xd3f392[_0x34a091(0x14d)]+'\x20via\x20single-line\x20input');}catch(_0x594806){console[_0x34a091(0x11d)](_0x34a091(0x9b),_0x594806),await this[_0x34a091(0x119)]?.[_0x34a091(0x14e)](_0x30552d,_0x34a091(0x176));}}async['sendShopNotification'](_0x5d101d,_0x4d4b14,_0x9c4148){const _0xe5f07c=a57_0x896da4;if(!this[_0xe5f07c(0x119)]){console['warn'](_0xe5f07c(0xe6));return;}try{const _0x4a14b8=await database_1[_0xe5f07c(0xf6)][_0xe5f07c(0xee)][_0xe5f07c(0x157)]({'where':{'shopId':_0x5d101d,'isVerified':!![]}});if(_0x4a14b8[_0xe5f07c(0x164)]===0x0){console[_0xe5f07c(0x10a)](_0xe5f07c(0x9f)+_0x5d101d);return;}const _0x50be8e=_0x4a14b8[_0xe5f07c(0xdf)](async _0x4bedb5=>{const _0x314fbc=_0xe5f07c;try{await this[_0x314fbc(0x119)]?.[_0x314fbc(0x14e)](_0x4bedb5['telegramId'],_0x4d4b14,_0x9c4148),console[_0x314fbc(0x10a)](_0x314fbc(0xc5)+_0x4bedb5[_0x314fbc(0x111)]);}catch(_0x34b632){console[_0x314fbc(0x11d)](_0x314fbc(0x120)+_0x4bedb5['telegramId']+':',_0x34b632),_0x34b632 instanceof Error&&(_0x34b632[_0x314fbc(0xba)][_0x314fbc(0x132)](_0x314fbc(0x95))||_0x34b632[_0x314fbc(0xba)]['includes'](_0x314fbc(0x16c))||_0x34b632['message'][_0x314fbc(0x132)]('user\x20is\x20deactivated'))&&(await database_1['default'][_0x314fbc(0xee)][_0x314fbc(0xbd)]({'where':{'id':_0x4bedb5['id']},'data':{'isVerified':![]}}),console[_0x314fbc(0x10a)](_0x314fbc(0x147)+_0x4bedb5['telegramId']+_0x314fbc(0xe8)));}});await Promise[_0xe5f07c(0x106)](_0x50be8e);}catch(_0x593642){console[_0xe5f07c(0x11d)](_0xe5f07c(0xcc),_0x593642);}}async[a57_0x896da4(0x11e)](_0x124470,_0x3485c1,_0xbe16e1){const _0x13a101=a57_0x896da4,_0x34a760={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x372596={'created':'New\x20payment\x20created','paid':_0x13a101(0xa3),'failed':_0x13a101(0x149),'expired':_0x13a101(0x137),'refund':'Payment\x20refund','chargeback':_0x13a101(0x133),'processing':'Payment\x20is\x20being\x20processed'},_0x28e9ab=_0x34a760[_0xbe16e1],_0xf9c49c=_0x372596[_0xbe16e1],_0x5da9cf=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x3485c1[_0x13a101(0x177)]);console[_0x13a101(0x10a)](_0x13a101(0x17a)+_0x3485c1[_0x13a101(0x177)]+'\x22\x20->\x20display\x20\x22'+_0x5da9cf+'\x22');let _0x2ff446=_0x28e9ab+'\x20*'+_0xf9c49c+_0x13a101(0x126)+('💰\x20Amount:\x20*'+_0x3485c1[_0x13a101(0x14b)]+'\x20'+_0x3485c1[_0x13a101(0x134)]+'*\x0a')+(_0x13a101(0xfd)+(_0x3485c1[_0x13a101(0x9d)]||_0x3485c1['id'])+'`\x0a')+(_0x13a101(0xfe)+_0x3485c1['id']+'`\x0a')+(_0x13a101(0x13b)+_0x5da9cf+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x3485c1[_0x13a101(0xc7)])[_0x13a101(0x15d)](_0x13a101(0x11b))+'\x0a');if(_0x3485c1[_0x13a101(0xdd)]||_0x3485c1['customerEmail']||_0x3485c1[_0x13a101(0xd8)]||_0x3485c1['customerIp']||_0x3485c1[_0x13a101(0x141)]){_0x2ff446+=_0x13a101(0x174);_0x3485c1[_0x13a101(0xdd)]&&(_0x2ff446+=_0x13a101(0x151)+_0x3485c1[_0x13a101(0xdd)]+'`\x0a');_0x3485c1[_0x13a101(0xb9)]&&(_0x2ff446+=_0x13a101(0x17b)+_0x3485c1[_0x13a101(0xb9)]+'`\x0a');_0x3485c1[_0x13a101(0xd8)]&&(_0x2ff446+=_0x13a101(0xa5)+_0x3485c1['remitterIban']+'`\x0a');_0x3485c1[_0x13a101(0x14a)]&&(_0x2ff446+=_0x13a101(0xc1)+_0x3485c1[_0x13a101(0x14a)]+'`\x0a');if(_0x3485c1[_0x13a101(0x141)]){const _0x4ffe13=_0x3485c1[_0x13a101(0x141)][_0x13a101(0x164)]>0x32?_0x3485c1[_0x13a101(0x141)][_0x13a101(0x16b)](0x0,0x32)+_0x13a101(0xe3):_0x3485c1['customerUa'];_0x2ff446+='💻\x20Browser:\x20`'+_0x4ffe13+'`\x0a';}}_0xbe16e1===_0x13a101(0xfb)&&_0x3485c1['chargebackAmount']&&(_0x2ff446+=_0x13a101(0x121)+_0x3485c1[_0x13a101(0x11c)]+_0x13a101(0xd7)),_0xbe16e1===_0x13a101(0xb8)&&(_0x2ff446+=_0x13a101(0x100)),_0x3485c1[_0x13a101(0xec)]&&(_0x2ff446+=_0x13a101(0x146)+_0x3485c1[_0x13a101(0xec)]+'\x0a'),await this[_0x13a101(0xc0)](_0x124470,_0x2ff446,{'parse_mode':_0x13a101(0xb5)});}async[a57_0x896da4(0xaa)](_0xb60e85,_0x2d6d24,_0x20b6a8){const _0x401170=a57_0x896da4,_0x3cc20e={'created':'📤','completed':'✅','rejected':'❌'},_0x494d22={'created':'New\x20payout\x20created','completed':_0x401170(0xd4),'rejected':_0x401170(0xad)},_0x1e12ea=_0x3cc20e[_0x20b6a8],_0x2d22e4=_0x494d22[_0x20b6a8],_0xb56d54=_0x1e12ea+'\x20*'+_0x2d22e4+_0x401170(0x126)+(_0x401170(0xbb)+_0x2d6d24[_0x401170(0x14b)]+_0x401170(0x153))+(_0x401170(0x143)+_0x2d6d24[_0x401170(0xeb)]+'`\x0a')+(_0x401170(0x139)+_0x2d6d24['id']+'`\x0a')+(_0x401170(0x129)+new Date(_0x2d6d24['createdAt'])[_0x401170(0x15d)](_0x401170(0x11b))+'\x0a')+(_0x2d6d24[_0x401170(0x144)]?_0x401170(0x12d)+_0x2d6d24[_0x401170(0x144)]+'`':'');await this[_0x401170(0xc0)](_0xb60e85,_0xb56d54,{'parse_mode':_0x401170(0xb5)});}async[a57_0x896da4(0x107)](_0x1978e3,_0xd2c8df){const _0x1a9bbe=a57_0x896da4;try{const _0x2b6b8a=await database_1[_0x1a9bbe(0xf6)][_0x1a9bbe(0x9a)]['findUnique']({'where':{'shopId':_0x1978e3},'select':{'notificationLogin':!![]}});if(!_0x2b6b8a?.[_0x1a9bbe(0x98)]){console[_0x1a9bbe(0x10a)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x1978e3);return;}const _0x577d48=_0xd2c8df[_0x1a9bbe(0xb7)]?'🔐':'🚨',_0x193b3e=_0xd2c8df[_0x1a9bbe(0xb7)]?_0x1a9bbe(0xce):_0x1a9bbe(0xe4);let _0x5da681=_0x577d48+'\x20*'+_0x193b3e+'*\x0a\x0a'+(_0x1a9bbe(0x13c)+_0xd2c8df[_0x1a9bbe(0x14d)]+'`\x0a')+(_0x1a9bbe(0x178)+_0xd2c8df[_0x1a9bbe(0x138)][_0x1a9bbe(0x15d)](_0x1a9bbe(0x11b))+'\x0a');_0xd2c8df[_0x1a9bbe(0x118)]&&(_0x5da681+=_0x1a9bbe(0x104)+_0xd2c8df[_0x1a9bbe(0x118)]+'`\x0a');if(_0xd2c8df['userAgent']){const _0x12e0f9=_0xd2c8df['userAgent'][_0x1a9bbe(0x164)]>0x32?_0xd2c8df[_0x1a9bbe(0x16a)][_0x1a9bbe(0x16b)](0x0,0x32)+_0x1a9bbe(0xe3):_0xd2c8df[_0x1a9bbe(0x16a)];_0x5da681+=_0x1a9bbe(0x110)+_0x12e0f9+'`\x0a';}!_0xd2c8df['success']&&(_0x5da681+=_0x1a9bbe(0xcb)),await this['sendShopNotification'](_0x1978e3,_0x5da681,{'parse_mode':_0x1a9bbe(0xb5)}),console[_0x1a9bbe(0x10a)](_0x1a9bbe(0x11a)+_0x1978e3+':\x20'+(_0xd2c8df[_0x1a9bbe(0xb7)]?_0x1a9bbe(0xb7):_0x1a9bbe(0x16d)));}catch(_0x115405){console[_0x1a9bbe(0x11d)](_0x1a9bbe(0x16f),_0x115405);}}async[a57_0x896da4(0x156)](_0x4de643,_0x2179c6){const _0x2825b5=a57_0x896da4;try{const _0x4e8d1c=await database_1[_0x2825b5(0xf6)][_0x2825b5(0x9a)][_0x2825b5(0xd3)]({'where':{'shopId':_0x4de643},'select':{'notificationApiError':!![]}});if(!_0x4e8d1c?.[_0x2825b5(0x10c)]){console[_0x2825b5(0x10a)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x4de643);return;}let _0x4c8222=_0x2825b5(0x16e)+('🔗\x20Endpoint:\x20`'+_0x2179c6[_0x2825b5(0xeb)]+'\x20'+_0x2179c6[_0x2825b5(0x15e)]+'`\x0a')+('📅\x20Time:\x20'+_0x2179c6[_0x2825b5(0x138)][_0x2825b5(0x15d)](_0x2825b5(0x11b))+'\x0a');_0x2179c6[_0x2825b5(0xd9)]&&(_0x4c8222+=_0x2825b5(0x12b)+_0x2179c6['statusCode']+'`\x0a'),_0x4c8222+=_0x2825b5(0x14c)+_0x2179c6['errorMessage']+'`\x0a',_0x2179c6['requestId']&&(_0x4c8222+='🆔\x20Request\x20ID:\x20`'+_0x2179c6[_0x2825b5(0xa6)]+'`\x0a'),_0x4c8222+=_0x2825b5(0x131),await this[_0x2825b5(0xc0)](_0x4de643,_0x4c8222,{'parse_mode':_0x2825b5(0xb5)}),console[_0x2825b5(0x10a)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x4de643+':\x20'+_0x2179c6['endpoint']);}catch(_0x123d58){console['error']('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x123d58);}}async[a57_0x896da4(0x145)](_0x15eca7,_0x1fc305,_0x3b2181){const _0x2a9473=a57_0x896da4;let _0x2164c7=_0x2a9473(0x168)+_0x1fc305+_0x2a9473(0x126);for(const [_0x2839f0,_0x4e763a]of Object[_0x2a9473(0xf1)](_0x3b2181)){_0x4e763a!==null&&_0x4e763a!==undefined&&(_0x2164c7+=_0x2839f0+_0x2a9473(0xdb)+_0x4e763a+'`\x0a');}await this['sendShopNotification'](_0x15eca7,_0x2164c7,{'parse_mode':'Markdown'});}[a57_0x896da4(0x109)](){const _0x3202ca=a57_0x896da4;return{'isActive':!!this['bot'],'username':this[_0x3202ca(0xb4)]};}['stopBot'](){const _0x438658=a57_0x896da4;this['bot']&&(this[_0x438658(0x119)]['stopPolling'](),this['bot']=null,console['log']('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a57_0x896da4(0xca)]=TelegramBotService,exports[a57_0x896da4(0xbc)]=new TelegramBotService();