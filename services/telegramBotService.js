'use strict';const a57_0x27c9e3=a57_0x1879;function a57_0x1879(_0x1ffbbd,_0x1a76db){const _0x1feddb=a57_0x1fed();return a57_0x1879=function(_0x1879c5,_0x20d39a){_0x1879c5=_0x1879c5-0xdf;let _0x52e12b=_0x1feddb[_0x1879c5];return _0x52e12b;},a57_0x1879(_0x1ffbbd,_0x1a76db);}(function(_0x4daa2a,_0x369a8a){const _0x2fc630=a57_0x1879,_0x1ef40d=_0x4daa2a();while(!![]){try{const _0x15564b=-parseInt(_0x2fc630(0x14e))/0x1+-parseInt(_0x2fc630(0x1c4))/0x2+-parseInt(_0x2fc630(0x1ba))/0x3+parseInt(_0x2fc630(0x122))/0x4+-parseInt(_0x2fc630(0x143))/0x5+parseInt(_0x2fc630(0x12e))/0x6+-parseInt(_0x2fc630(0x16e))/0x7*(-parseInt(_0x2fc630(0x1c0))/0x8);if(_0x15564b===_0x369a8a)break;else _0x1ef40d['push'](_0x1ef40d['shift']());}catch(_0x59a2e4){_0x1ef40d['push'](_0x1ef40d['shift']());}}}(a57_0x1fed,0x5ce3c));function a57_0x1fed(){const _0x1988e8=['No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','`.\x0a\x0a','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','updatedAt','log','\x0aCheck\x20spelling\x20and\x20try\x20again.','../config/database','Error\x20handling\x20message:','🔔\x20*','✅\x20Telegram\x20user\x20','pk_','customerIp','Telegram\x20bot\x20polling\x20error:','sendApiErrorNotification','processing','TELEGRAM_BOT_USERNAME','\x20USD*\x0a','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','Example:\x0a','toString','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','\x20disconnected\x20from\x20shop\x20','first_name','🏪\x20Available\x20shops\x20in\x20system:\x0a','Error\x20handling\x20/debug\x20command:','shop','Markdown','🔗\x20Endpoint:\x20`','Error\x20handling\x20/start\x20command:','entries','`\x20(','bot','botUsername','Error\x20handling\x20/disconnect\x20command:','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','/status\x20-\x20check\x20connection\x20status\x0a','2889180zyAHlG','🎉\x20*Congratulations!*\x0a\x0a','❌\x20Please\x20use\x20/start\x20command\x20first','\x20\x20\x20Public\x20Key:\x20`','📛\x20Name:\x20`','`\x20is\x20inactive.\x0a\x0a','findUnique','Failed\x20to\x20send\x20login\x20notification:','stopBot','findMany','toLocaleDateString','warn','1831608JLrbHN','❌\x20Error:\x20`','🆔\x20Payout\x20ID:\x20`','getGatewayDisplayNameForTelegram','from','telegramUser','Payment\x20successfully\x20paid','sk_','sendPayoutNotification','🌐\x20IP:\x20`','polling_error','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','sendMessage','Failed\x20to\x20send\x20API\x20error\x20notification:','setupBotHandlers',':\x20`','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','•\x20Payouts\x0a\x0a','•\x20New\x20payments\x0a','method','...','3051035SPClFu','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','allSettled','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','unknown\x20shop','initializeBot','Username:\x20`','💰\x20Amount:\x20*','update','Payment\x20expired','findFirst','335962zNVixl','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','substring','🔔\x20You\x20receive\x20notifications\x20about:\x0a','chat','Payment\x20refund','📝\x20Notes:\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','ipAddress','📱\x20Your\x20Telegram\x20ID:\x20`','stopPolling','defineProperty','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','__esModule','Use\x20/start\x20to\x20connect.','onText','Telegram\x20bot\x20error:','timestamp','requestId','startsWith','success','forEach','*.\x0a\x0a','New\x20payout\x20created','statusCode','test','endpoint','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','sendPaymentNotification','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','createdAt','40523ZCaLOZ','TelegramBotService','...`\x0a\x0a','isVerified','✅\x20Connected\x20to\x20shop:\x20*','botToken','chargebackAmount','shopId','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','\x20(@','Error\x20handling\x20/status\x20command:','\x20USDT*\x0a','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','customerEmail','handleSingleLineVerification','❌\x20Shop\x20with\x20username\x20`','remitterIban','orderId','telegramId','sendShopNotification','default','🔌\x20User\x20','error','gateway','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','notificationApiError','•\x20Payouts\x0a','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','🚨\x20*API\x20Error*\x0a\x0a','blocked','failed','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','💸\x20Penalty\x20amount:\x20*','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','🏦\x20Method:\x20`','✅\x20Welcome\x20back!\x0a\x0a','\x20initialized\x20successfully','•\x20`','\x22,\x20apiKey=\x22','•\x20Important\x20events\x0a\x0a','adminNotes','split','❌\x20Shop\x20`','username','.\x20*','Payout\x20rejected','map','\x20\x20\x20Username:\x20`','💻\x20Browser:\x20`','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','🌐\x20IP\x20address:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','telegramBotService','status','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','trapay_bot','secretKey','❌\x20Invalid\x20username\x20format:\x20`','sendCustomNotification','amount','❌\x20Error\x20getting\x20debug\x20information.','👤\x20Username:\x20`','Failed\x20login\x20attempt','length','user\x20is\x20deactivated','shopSettings','📊\x20Error\x20code:\x20`','`\x0a\x0a','📅\x20Time:\x20','getBotInfo','Successful\x20login','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','🆔\x20Request\x20ID:\x20`','📱\x20Telegram\x20notification:\x20gateway\x20\x22','env','1358394NcPTyO','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','🏪\x20Gateway:\x20`','\x20via\x20single-line\x20input','🆔\x20Payment\x20ID:\x20`','📱\x20Shop:\x20*','1928wjrksb','Payment\x20is\x20being\x20processed','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','🔗\x20TXID:\x20`','1286538ESkpJE','\x20\x20\x20Status:\x20','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','Available\x20usernames:\x0a','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','toLocaleString','...\x22','name','Error\x20sending\x20shop\x20notification:','📝\x20Order\x20ID:\x20`','customerUa','Error\x20in\x20handleSingleLineVerification:','Check\x20spelling\x20and\x20try\x20again.','publicKey','join','•\x20Payment\x20status\x20changes\x0a','message','currency','*\x0a\x0a','You\x20sent\x20','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','userAgent','en-US','/disconnect\x20-\x20disconnect\x20from\x20notifications','💸\x20Amount:\x20*','customerName','📊\x20*Connection\x20Status*\x0a\x0a','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','create','📧\x20Email:\x20`','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','🏦\x20IBAN:\x20`','✅\x20Telegram\x20bot\x20@','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','txid','includes','Payout\x20completed','Commands:\x0a','text'];a57_0x1fed=function(){return _0x1988e8;};return a57_0x1fed();}var __importDefault=this&&this['__importDefault']||function(_0x5772be){const _0x39bb65=a57_0x1879;return _0x5772be&&_0x5772be[_0x39bb65(0x15c)]?_0x5772be:{'default':_0x5772be};};Object[a57_0x27c9e3(0x15a)](exports,a57_0x27c9e3(0x15c),{'value':!![]}),exports[a57_0x27c9e3(0x1a3)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a57_0x27c9e3(0x104))),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x472e17=a57_0x27c9e3;this[_0x472e17(0x11d)]=null,this[_0x472e17(0x173)]=process[_0x472e17(0x1b9)]['TELEGRAM_BOT_TOKEN']||'',this[_0x472e17(0x11e)]=process[_0x472e17(0x1b9)][_0x472e17(0x10d)]||_0x472e17(0x1a6),this[_0x472e17(0x173)]?this[_0x472e17(0x148)]():console[_0x472e17(0x12d)](_0x472e17(0x186));}[a57_0x27c9e3(0x148)](){const _0x1f2451=a57_0x27c9e3;try{this[_0x1f2451(0x11d)]=new node_telegram_bot_api_1[(_0x1f2451(0x182))](this['botToken'],{'polling':!![]}),this[_0x1f2451(0x13c)](),console[_0x1f2451(0x102)](_0x1f2451(0xf7)+this[_0x1f2451(0x11e)]+_0x1f2451(0x192));}catch(_0x196324){console['error'](_0x1f2451(0x144),_0x196324);}}['setupBotHandlers'](){const _0x7e5ec7=a57_0x27c9e3;if(!this[_0x7e5ec7(0x11d)])return;this['bot'][_0x7e5ec7(0x15e)](/\/start/,async _0x26b80a=>{const _0x2a7c95=_0x7e5ec7,_0x56359e=_0x26b80a[_0x2a7c95(0x153)]['id'],_0x56c072=_0x26b80a[_0x2a7c95(0x132)]?.['id'][_0x2a7c95(0x111)](),_0x4b724a=_0x26b80a[_0x2a7c95(0x132)]?.[_0x2a7c95(0x199)],_0x5900ee=_0x26b80a['from']?.[_0x2a7c95(0x114)],_0x59d539=_0x26b80a[_0x2a7c95(0x132)]?.['last_name'];if(!_0x56c072)return;try{let _0x5c4ab5=await database_1[_0x2a7c95(0x182)]['telegramUser'][_0x2a7c95(0x128)]({'where':{'telegramId':_0x56c072},'include':{'shop':!![]}});!_0x5c4ab5?(_0x5c4ab5=await database_1[_0x2a7c95(0x182)][_0x2a7c95(0x133)][_0x2a7c95(0xf3)]({'data':{'telegramId':_0x56c072,'username':_0x4b724a,'firstName':_0x5900ee,'lastName':_0x59d539,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x2a7c95(0x102)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x56c072+_0x2a7c95(0x177)+_0x4b724a+')')):_0x5c4ab5=await database_1['default']['telegramUser'][_0x2a7c95(0x14b)]({'where':{'telegramId':_0x56c072},'data':{'username':_0x4b724a,'firstName':_0x5900ee,'lastName':_0x59d539},'include':{'shop':!![]}}),_0x5c4ab5[_0x2a7c95(0x171)]&&_0x5c4ab5['shopId']&&_0x5c4ab5[_0x2a7c95(0x117)]?await this[_0x2a7c95(0x11d)]?.[_0x2a7c95(0x13a)](_0x56359e,_0x2a7c95(0x191)+(_0x2a7c95(0x17a)+_0x5c4ab5[_0x2a7c95(0x117)]['name']+'*\x0a')+(_0x2a7c95(0x149)+_0x5c4ab5[_0x2a7c95(0x117)][_0x2a7c95(0x199)]+_0x2a7c95(0x1b2))+_0x2a7c95(0x152)+_0x2a7c95(0x140)+_0x2a7c95(0xe6)+_0x2a7c95(0x13f)+_0x2a7c95(0xfc)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x2a7c95(0xee),{'parse_mode':_0x2a7c95(0x118)}):(_0x5c4ab5[_0x2a7c95(0x175)]&&!_0x5c4ab5['isVerified']&&(await database_1['default'][_0x2a7c95(0x133)][_0x2a7c95(0x14b)]({'where':{'telegramId':_0x56c072},'data':{'shopId':null,'isVerified':![]}}),console[_0x2a7c95(0x102)](_0x2a7c95(0x1bb)+_0x56c072)),await this['bot']?.[_0x2a7c95(0x13a)](_0x56359e,_0x2a7c95(0x1a5)+_0x2a7c95(0xeb)+_0x2a7c95(0x18f)+_0x2a7c95(0x110)+_0x2a7c95(0x1c2)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':'Markdown'}));}catch(_0x4f9820){console[_0x2a7c95(0x184)](_0x2a7c95(0x11a),_0x4f9820),await this['bot']?.['sendMessage'](_0x56359e,_0x2a7c95(0xf8));}}),this[_0x7e5ec7(0x11d)][_0x7e5ec7(0x15e)](/\/disconnect/,async _0x371aa4=>{const _0x1eab9f=_0x7e5ec7,_0x4b6819=_0x371aa4[_0x1eab9f(0x153)]['id'],_0x1a357d=_0x371aa4[_0x1eab9f(0x132)]?.['id'][_0x1eab9f(0x111)]();if(!_0x1a357d)return;try{const _0x46a81f=await database_1[_0x1eab9f(0x182)]['telegramUser'][_0x1eab9f(0x128)]({'where':{'telegramId':_0x1a357d},'include':{'shop':!![]}});if(!_0x46a81f||!_0x46a81f[_0x1eab9f(0x171)]||!_0x46a81f[_0x1eab9f(0x175)]){await this[_0x1eab9f(0x11d)]?.[_0x1eab9f(0x13a)](_0x4b6819,_0x1eab9f(0x1a1));return;}const _0x38b116=_0x46a81f['shop']?.[_0x1eab9f(0x1cb)]||_0x1eab9f(0x147);await database_1[_0x1eab9f(0x182)][_0x1eab9f(0x133)][_0x1eab9f(0x14b)]({'where':{'telegramId':_0x1a357d},'data':{'shopId':null,'isVerified':![]}}),console[_0x1eab9f(0x102)](_0x1eab9f(0x183)+_0x1a357d+_0x1eab9f(0x113)+_0x46a81f['shopId']),await this[_0x1eab9f(0x11d)]?.[_0x1eab9f(0x13a)](_0x4b6819,_0x1eab9f(0x150)+_0x38b116+_0x1eab9f(0x165)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x1eab9f(0x118)});}catch(_0x31554f){console[_0x1eab9f(0x184)](_0x1eab9f(0x11f),_0x31554f),await this[_0x1eab9f(0x11d)]?.[_0x1eab9f(0x13a)](_0x4b6819,_0x1eab9f(0xf8));}}),this[_0x7e5ec7(0x11d)][_0x7e5ec7(0x15e)](/\/status/,async _0x47e660=>{const _0x35dee6=_0x7e5ec7,_0xe43b79=_0x47e660[_0x35dee6(0x153)]['id'],_0x436e42=_0x47e660['from']?.['id']['toString']();if(!_0x436e42)return;try{const _0x372f1a=await database_1[_0x35dee6(0x182)][_0x35dee6(0x133)][_0x35dee6(0x128)]({'where':{'telegramId':_0x436e42},'include':{'shop':!![]}});if(!_0x372f1a){await this['bot']?.[_0x35dee6(0x13a)](_0xe43b79,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+'Use\x20/start\x20to\x20begin.');return;}if(!_0x372f1a[_0x35dee6(0x171)]||!_0x372f1a['shopId']||!_0x372f1a[_0x35dee6(0x117)]){await this[_0x35dee6(0x11d)]?.[_0x35dee6(0x13a)](_0xe43b79,_0x35dee6(0x156)+_0x35dee6(0x15d));return;}await this[_0x35dee6(0x11d)]?.[_0x35dee6(0x13a)](_0xe43b79,_0x35dee6(0xf1)+(_0x35dee6(0x172)+_0x372f1a[_0x35dee6(0x117)][_0x35dee6(0x1cb)]+'*\x0a')+(_0x35dee6(0x1ac)+_0x372f1a[_0x35dee6(0x117)][_0x35dee6(0x199)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x372f1a[_0x35dee6(0x101)][_0x35dee6(0x12c)](_0x35dee6(0xed))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+_0x35dee6(0xfc)+_0x35dee6(0xee),{'parse_mode':_0x35dee6(0x118)});}catch(_0x3fb6a0){console[_0x35dee6(0x184)](_0x35dee6(0x178),_0x3fb6a0),await this['bot']?.[_0x35dee6(0x13a)](_0xe43b79,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x7e5ec7(0x11d)][_0x7e5ec7(0x15e)](/\/debug/,async _0x1d2e77=>{const _0x4d2111=_0x7e5ec7,_0x2cf3fc=_0x1d2e77[_0x4d2111(0x153)]['id'],_0xe39901=_0x1d2e77['from']?.['id'][_0x4d2111(0x111)]();if(!_0xe39901)return;try{const _0x3da453=await database_1[_0x4d2111(0x182)][_0x4d2111(0x117)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x556c8c='🔍\x20*Debug\x20Information*\x0a\x0a';_0x556c8c+=_0x4d2111(0x158)+_0xe39901+'`\x0a\x0a',_0x556c8c+=_0x4d2111(0x115),_0x3da453[_0x4d2111(0x164)]((_0x597ec4,_0xb3bf94)=>{const _0x55f43e=_0x4d2111;_0x556c8c+=_0xb3bf94+0x1+_0x55f43e(0x19a)+_0x597ec4[_0x55f43e(0x1cb)]+'*\x0a',_0x556c8c+=_0x55f43e(0x19d)+_0x597ec4[_0x55f43e(0x199)]+'`\x0a',_0x556c8c+=_0x55f43e(0x1c5)+_0x597ec4[_0x55f43e(0x1a4)]+'\x0a',_0x556c8c+=_0x55f43e(0x125)+_0x597ec4[_0x55f43e(0xe4)][_0x55f43e(0x151)](0x0,0xf)+_0x55f43e(0x170);}),await this[_0x4d2111(0x11d)]?.['sendMessage'](_0x2cf3fc,_0x556c8c,{'parse_mode':_0x4d2111(0x118)});}catch(_0xb43a57){console[_0x4d2111(0x184)](_0x4d2111(0x116),_0xb43a57),await this['bot']?.[_0x4d2111(0x13a)](_0x2cf3fc,_0x4d2111(0x1ab));}}),this[_0x7e5ec7(0x11d)]['on'](_0x7e5ec7(0xe7),async _0x108994=>{const _0x2466dc=_0x7e5ec7;if(_0x108994[_0x2466dc(0xfd)]?.[_0x2466dc(0x162)]('/'))return;const _0x3887ef=_0x108994[_0x2466dc(0x153)]['id'],_0x2ae7bd=_0x108994[_0x2466dc(0x132)]?.['id'][_0x2466dc(0x111)](),_0x3ad38b=_0x108994[_0x2466dc(0xfd)]?.['trim']();if(!_0x2ae7bd||!_0x3ad38b)return;try{const _0x56d1ee=await database_1['default'][_0x2466dc(0x133)]['findUnique']({'where':{'telegramId':_0x2ae7bd},'include':{'shop':!![]}});if(!_0x56d1ee){await this[_0x2466dc(0x11d)]?.[_0x2466dc(0x13a)](_0x3887ef,_0x2466dc(0x124));return;}if(_0x56d1ee[_0x2466dc(0x171)]&&_0x56d1ee[_0x2466dc(0x175)]&&_0x56d1ee[_0x2466dc(0x117)]){await this[_0x2466dc(0x11d)]?.[_0x2466dc(0x13a)](_0x3887ef,_0x2466dc(0x176)+_0x56d1ee[_0x2466dc(0x117)][_0x2466dc(0x1cb)]+_0x2466dc(0x165)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x2466dc(0x118)});return;}const _0x575cff=_0x3ad38b[_0x2466dc(0x197)](/\s+/);if(_0x575cff[_0x2466dc(0x1ae)]!==0x2){await this[_0x2466dc(0x11d)]?.[_0x2466dc(0x13a)](_0x3887ef,_0x2466dc(0x18d)+_0x2466dc(0x18f)+'Example:\x0a'+_0x2466dc(0x1c2)+(_0x2466dc(0xea)+_0x575cff[_0x2466dc(0x1ae)]+'\x20parts:\x20'+_0x575cff['map'](_0x21617b=>'`'+_0x21617b+'`')[_0x2466dc(0xe5)](',\x20')),{'parse_mode':_0x2466dc(0x118)});return;}const [_0x5b1377,_0xe5415b]=_0x575cff;console[_0x2466dc(0x102)](_0x2466dc(0x19f)+_0x2ae7bd+':\x20username=\x22'+_0x5b1377+_0x2466dc(0x194)+_0xe5415b['substring'](0x0,0xa)+_0x2466dc(0x1ca)),await this[_0x2466dc(0x17c)](_0x3887ef,_0x2ae7bd,_0x5b1377,_0xe5415b);}catch(_0x4f7194){console[_0x2466dc(0x184)](_0x2466dc(0x105),_0x4f7194),await this[_0x2466dc(0x11d)]?.[_0x2466dc(0x13a)](_0x3887ef,_0x2466dc(0xf8));}}),this[_0x7e5ec7(0x11d)]['on']('error',_0x41d8e0=>{const _0xdde854=_0x7e5ec7;console[_0xdde854(0x184)](_0xdde854(0x15f),_0x41d8e0);}),this[_0x7e5ec7(0x11d)]['on'](_0x7e5ec7(0x138),_0x5ae544=>{const _0xa71e0=_0x7e5ec7;console[_0xa71e0(0x184)](_0xa71e0(0x10a),_0x5ae544);});}async[a57_0x27c9e3(0x17c)](_0x5de46b,_0x208305,_0x5033f5,_0x2924c4){const _0x349372=a57_0x27c9e3;try{console['log']('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x208305+':\x20username=\x22'+_0x5033f5+_0x349372(0x194)+_0x2924c4[_0x349372(0x151)](0x0,0xa)+'...\x22');if(!_0x5033f5||_0x5033f5[_0x349372(0x1ae)]<0x3||_0x5033f5[_0x349372(0x1ae)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x349372(0x168)](_0x5033f5)){await this['bot']?.[_0x349372(0x13a)](_0x5de46b,_0x349372(0x1a8)+_0x5033f5+'`\x0a\x0a'+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x349372(0x118)});return;}if(!_0x2924c4||!_0x2924c4[_0x349372(0x162)](_0x349372(0x108))&&!_0x2924c4[_0x349372(0x162)](_0x349372(0x135))){await this[_0x349372(0x11d)]?.[_0x349372(0x13a)](_0x5de46b,_0x349372(0x15b)+_0x349372(0x139),{'parse_mode':_0x349372(0x118)});return;}const _0x244ff1=await database_1[_0x349372(0x182)][_0x349372(0x117)][_0x349372(0x128)]({'where':{'username':_0x5033f5},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x244ff1){const _0x25f663=await database_1[_0x349372(0x182)]['shop'][_0x349372(0x12b)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x18a7e0=_0x349372(0x17d)+_0x5033f5+'`\x20not\x20found.\x0a\x0a';_0x25f663['length']>0x0?(_0x18a7e0+=_0x349372(0x1c7),_0x25f663[_0x349372(0x164)](_0x543b90=>{const _0x1073c3=_0x349372;_0x18a7e0+=_0x1073c3(0x193)+_0x543b90['username']+_0x1073c3(0x11c)+_0x543b90[_0x1073c3(0x1cb)]+')\x0a';}),_0x18a7e0+=_0x349372(0x103)):_0x18a7e0+=_0x349372(0xe3);await this[_0x349372(0x11d)]?.['sendMessage'](_0x5de46b,_0x18a7e0,{'parse_mode':_0x349372(0x118)});return;}if(_0x244ff1[_0x349372(0x1a4)]!=='ACTIVE'){await this['bot']?.[_0x349372(0x13a)](_0x5de46b,_0x349372(0x198)+_0x5033f5+_0x349372(0x127)+'Contact\x20administrator.',{'parse_mode':'Markdown'});return;}if(_0x244ff1[_0x349372(0xe4)]!==_0x2924c4&&_0x244ff1[_0x349372(0x1a7)]!==_0x2924c4){await this[_0x349372(0x11d)]?.['sendMessage'](_0x5de46b,_0x349372(0x16a)+_0x5033f5+_0x349372(0xff)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':'Markdown'});return;}const _0x54fc89=await database_1[_0x349372(0x182)][_0x349372(0x133)][_0x349372(0x14d)]({'where':{'shopId':_0x244ff1['id'],'isVerified':!![],'telegramId':{'not':_0x208305}}});if(_0x54fc89){await this[_0x349372(0x11d)]?.['sendMessage'](_0x5de46b,_0x349372(0xf2)+_0x5033f5+_0x349372(0xff)+_0x349372(0x100),{'parse_mode':_0x349372(0x118)});return;}await database_1[_0x349372(0x182)]['telegramUser'][_0x349372(0x14b)]({'where':{'telegramId':_0x208305},'data':{'shopId':_0x244ff1['id'],'isVerified':!![]}}),await this[_0x349372(0x11d)]?.[_0x349372(0x13a)](_0x5de46b,_0x349372(0x123)+_0x349372(0x120)+(_0x349372(0x1bf)+_0x244ff1[_0x349372(0x1cb)]+'*\x0a')+('👤\x20Username:\x20`'+_0x244ff1['username']+'`\x0a\x0a')+_0x349372(0x10f)+_0x349372(0x140)+_0x349372(0xe6)+_0x349372(0x188)+_0x349372(0x195)+_0x349372(0xfc)+_0x349372(0x121)+_0x349372(0xee),{'parse_mode':_0x349372(0x118)}),console[_0x349372(0x102)](_0x349372(0x107)+_0x208305+'\x20verified\x20for\x20shop\x20'+_0x244ff1[_0x349372(0x199)]+_0x349372(0x1bd));}catch(_0x856be){console[_0x349372(0x184)](_0x349372(0xe2),_0x856be),await this[_0x349372(0x11d)]?.['sendMessage'](_0x5de46b,_0x349372(0x1a2));}}async[a57_0x27c9e3(0x181)](_0x52428a,_0x440e99,_0x3845f8){const _0x85d25=a57_0x27c9e3;if(!this[_0x85d25(0x11d)]){console['warn'](_0x85d25(0x112));return;}try{const _0x21b20b=await database_1[_0x85d25(0x182)][_0x85d25(0x133)][_0x85d25(0x12b)]({'where':{'shopId':_0x52428a,'isVerified':!![]}});if(_0x21b20b['length']===0x0){console[_0x85d25(0x102)](_0x85d25(0xfe)+_0x52428a);return;}const _0x59671d=_0x21b20b[_0x85d25(0x19c)](async _0x608038=>{const _0x2b6232=_0x85d25;try{await this[_0x2b6232(0x11d)]?.[_0x2b6232(0x13a)](_0x608038['telegramId'],_0x440e99,_0x3845f8),console['log'](_0x2b6232(0x14f)+_0x608038[_0x2b6232(0x180)]);}catch(_0x22f167){console['error'](_0x2b6232(0x13e)+_0x608038['telegramId']+':',_0x22f167),_0x22f167 instanceof Error&&(_0x22f167[_0x2b6232(0xe7)][_0x2b6232(0xfa)](_0x2b6232(0x18b))||_0x22f167[_0x2b6232(0xe7)]['includes']('chat\x20not\x20found')||_0x22f167[_0x2b6232(0xe7)]['includes'](_0x2b6232(0x1af)))&&(await database_1[_0x2b6232(0x182)][_0x2b6232(0x133)]['update']({'where':{'id':_0x608038['id']},'data':{'isVerified':![]}}),console[_0x2b6232(0x102)]('User\x20'+_0x608038[_0x2b6232(0x180)]+_0x2b6232(0x189)));}});await Promise[_0x85d25(0x145)](_0x59671d);}catch(_0x3075a8){console[_0x85d25(0x184)](_0x85d25(0xdf),_0x3075a8);}}async[a57_0x27c9e3(0x16b)](_0x43f13a,_0x5711c0,_0x56f946){const _0x68b0e=a57_0x27c9e3,_0x1071a3={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x2ee6d2={'created':'New\x20payment\x20created','paid':_0x68b0e(0x134),'failed':'Payment\x20failed','expired':_0x68b0e(0x14c),'refund':_0x68b0e(0x154),'chargeback':'Payment\x20chargeback','processing':_0x68b0e(0x1c1)},_0x15432e=_0x1071a3[_0x56f946],_0x515fee=_0x2ee6d2[_0x56f946],_0x377185=(0x0,gateway_1[_0x68b0e(0x131)])(_0x5711c0[_0x68b0e(0x185)]);console[_0x68b0e(0x102)](_0x68b0e(0x1b8)+_0x5711c0[_0x68b0e(0x185)]+'\x22\x20->\x20display\x20\x22'+_0x377185+'\x22');let _0x152f8c=_0x15432e+'\x20*'+_0x515fee+'*\x0a\x0a'+(_0x68b0e(0x14a)+_0x5711c0['amount']+'\x20'+_0x5711c0[_0x68b0e(0xe8)]+'*\x0a')+(_0x68b0e(0xe0)+(_0x5711c0[_0x68b0e(0x17f)]||_0x5711c0['id'])+'`\x0a')+(_0x68b0e(0x1be)+_0x5711c0['id']+'`\x0a')+(_0x68b0e(0x1bc)+_0x377185+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x5711c0['createdAt'])[_0x68b0e(0x1c9)]('en-US')+'\x0a');if(_0x5711c0['customerName']||_0x5711c0['customerEmail']||_0x5711c0[_0x68b0e(0x17e)]||_0x5711c0['customerIp']||_0x5711c0[_0x68b0e(0xe1)]){_0x152f8c+='\x0a👤\x20*Customer\x20Information:*\x0a';_0x5711c0[_0x68b0e(0xf0)]&&(_0x152f8c+=_0x68b0e(0x126)+_0x5711c0[_0x68b0e(0xf0)]+'`\x0a');_0x5711c0['customerEmail']&&(_0x152f8c+=_0x68b0e(0xf4)+_0x5711c0[_0x68b0e(0x17b)]+'`\x0a');_0x5711c0[_0x68b0e(0x17e)]&&(_0x152f8c+=_0x68b0e(0xf6)+_0x5711c0[_0x68b0e(0x17e)]+'`\x0a');_0x5711c0[_0x68b0e(0x109)]&&(_0x152f8c+=_0x68b0e(0x137)+_0x5711c0['customerIp']+'`\x0a');if(_0x5711c0['customerUa']){const _0x514f0b=_0x5711c0[_0x68b0e(0xe1)][_0x68b0e(0x1ae)]>0x32?_0x5711c0[_0x68b0e(0xe1)][_0x68b0e(0x151)](0x0,0x32)+_0x68b0e(0x142):_0x5711c0[_0x68b0e(0xe1)];_0x152f8c+=_0x68b0e(0x19e)+_0x514f0b+'`\x0a';}}_0x56f946==='chargeback'&&_0x5711c0[_0x68b0e(0x174)]&&(_0x152f8c+=_0x68b0e(0x18e)+_0x5711c0[_0x68b0e(0x174)]+_0x68b0e(0x179)),_0x56f946===_0x68b0e(0x10c)&&(_0x152f8c+=_0x68b0e(0x1c8)),_0x5711c0[_0x68b0e(0x196)]&&(_0x152f8c+=_0x68b0e(0x155)+_0x5711c0[_0x68b0e(0x196)]+'\x0a'),await this['sendShopNotification'](_0x43f13a,_0x152f8c,{'parse_mode':_0x68b0e(0x118)});}async[a57_0x27c9e3(0x136)](_0x310e0b,_0x1285ce,_0x316645){const _0x52d1a8=a57_0x27c9e3,_0x5a249c={'created':'📤','completed':'✅','rejected':'❌'},_0x492766={'created':_0x52d1a8(0x166),'completed':_0x52d1a8(0xfb),'rejected':_0x52d1a8(0x19b)},_0x40a0d8=_0x5a249c[_0x316645],_0x312cf5=_0x492766[_0x316645],_0x1f1874=_0x40a0d8+'\x20*'+_0x312cf5+_0x52d1a8(0xe9)+(_0x52d1a8(0xef)+_0x1285ce[_0x52d1a8(0x1aa)]+_0x52d1a8(0x10e))+(_0x52d1a8(0x190)+_0x1285ce[_0x52d1a8(0x141)]+'`\x0a')+(_0x52d1a8(0x130)+_0x1285ce['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x1285ce[_0x52d1a8(0x16d)])[_0x52d1a8(0x1c9)]('en-US')+'\x0a')+(_0x1285ce[_0x52d1a8(0xf9)]?_0x52d1a8(0x1c3)+_0x1285ce['txid']+'`':'');await this['sendShopNotification'](_0x310e0b,_0x1f1874,{'parse_mode':'Markdown'});}async['sendLoginNotification'](_0x83380,_0x4b4653){const _0x596e76=a57_0x27c9e3;try{const _0x2e65c8=await database_1[_0x596e76(0x182)][_0x596e76(0x1b0)][_0x596e76(0x128)]({'where':{'shopId':_0x83380},'select':{'notificationLogin':!![]}});if(!_0x2e65c8?.['notificationLogin']){console[_0x596e76(0x102)](_0x596e76(0x146)+_0x83380);return;}const _0x218fc9=_0x4b4653[_0x596e76(0x163)]?'🔐':'🚨',_0x3ec922=_0x4b4653['success']?_0x596e76(0x1b5):_0x596e76(0x1ad);let _0x476472=_0x218fc9+'\x20*'+_0x3ec922+_0x596e76(0xe9)+('👤\x20Username:\x20`'+_0x4b4653[_0x596e76(0x199)]+'`\x0a')+(_0x596e76(0x1b3)+_0x4b4653[_0x596e76(0x160)][_0x596e76(0x1c9)](_0x596e76(0xed))+'\x0a');_0x4b4653[_0x596e76(0x157)]&&(_0x476472+=_0x596e76(0x1a0)+_0x4b4653[_0x596e76(0x157)]+'`\x0a');if(_0x4b4653[_0x596e76(0xec)]){const _0x3166db=_0x4b4653[_0x596e76(0xec)]['length']>0x32?_0x4b4653[_0x596e76(0xec)][_0x596e76(0x151)](0x0,0x32)+_0x596e76(0x142):_0x4b4653[_0x596e76(0xec)];_0x476472+=_0x596e76(0x19e)+_0x3166db+'`\x0a';}!_0x4b4653[_0x596e76(0x163)]&&(_0x476472+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this['sendShopNotification'](_0x83380,_0x476472,{'parse_mode':'Markdown'}),console['log'](_0x596e76(0x1c6)+_0x83380+':\x20'+(_0x4b4653[_0x596e76(0x163)]?_0x596e76(0x163):_0x596e76(0x18c)));}catch(_0x3c4d9e){console[_0x596e76(0x184)](_0x596e76(0x129),_0x3c4d9e);}}async[a57_0x27c9e3(0x10b)](_0x1951f7,_0x1a6f2c){const _0x566a62=a57_0x27c9e3;try{const _0xf94638=await database_1[_0x566a62(0x182)][_0x566a62(0x1b0)][_0x566a62(0x128)]({'where':{'shopId':_0x1951f7},'select':{'notificationApiError':!![]}});if(!_0xf94638?.[_0x566a62(0x187)]){console[_0x566a62(0x102)](_0x566a62(0xf5)+_0x1951f7);return;}let _0x2622ae=_0x566a62(0x18a)+(_0x566a62(0x119)+_0x1a6f2c[_0x566a62(0x141)]+'\x20'+_0x1a6f2c[_0x566a62(0x169)]+'`\x0a')+(_0x566a62(0x1b3)+_0x1a6f2c[_0x566a62(0x160)][_0x566a62(0x1c9)](_0x566a62(0xed))+'\x0a');_0x1a6f2c[_0x566a62(0x167)]&&(_0x2622ae+=_0x566a62(0x1b1)+_0x1a6f2c[_0x566a62(0x167)]+'`\x0a'),_0x2622ae+=_0x566a62(0x12f)+_0x1a6f2c['errorMessage']+'`\x0a',_0x1a6f2c[_0x566a62(0x161)]&&(_0x2622ae+=_0x566a62(0x1b7)+_0x1a6f2c[_0x566a62(0x161)]+'`\x0a'),_0x2622ae+=_0x566a62(0x1b6),await this['sendShopNotification'](_0x1951f7,_0x2622ae,{'parse_mode':_0x566a62(0x118)}),console['log'](_0x566a62(0x16c)+_0x1951f7+':\x20'+_0x1a6f2c[_0x566a62(0x169)]);}catch(_0x1fb3e5){console[_0x566a62(0x184)](_0x566a62(0x13b),_0x1fb3e5);}}async[a57_0x27c9e3(0x1a9)](_0xaa54e8,_0xb857a7,_0x3e5b75){const _0xe5cdcf=a57_0x27c9e3;let _0xe38f17=_0xe5cdcf(0x106)+_0xb857a7+_0xe5cdcf(0xe9);for(const [_0x5a5f58,_0x2fc1d8]of Object[_0xe5cdcf(0x11b)](_0x3e5b75)){_0x2fc1d8!==null&&_0x2fc1d8!==undefined&&(_0xe38f17+=_0x5a5f58+_0xe5cdcf(0x13d)+_0x2fc1d8+'`\x0a');}await this[_0xe5cdcf(0x181)](_0xaa54e8,_0xe38f17,{'parse_mode':_0xe5cdcf(0x118)});}[a57_0x27c9e3(0x1b4)](){const _0x380a9f=a57_0x27c9e3;return{'isActive':!!this[_0x380a9f(0x11d)],'username':this['botUsername']};}[a57_0x27c9e3(0x12a)](){const _0x566710=a57_0x27c9e3;this['bot']&&(this[_0x566710(0x11d)][_0x566710(0x159)](),this[_0x566710(0x11d)]=null,console[_0x566710(0x102)]('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a57_0x27c9e3(0x16f)]=TelegramBotService,exports[a57_0x27c9e3(0x1a3)]=new TelegramBotService();