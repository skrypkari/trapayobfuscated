'use strict';const a61_0x19b1e7=a61_0x46ae;(function(_0x58b513,_0x45b9a6){const _0x30c9ef=a61_0x46ae,_0x1023a1=_0x58b513();while(!![]){try{const _0x593911=-parseInt(_0x30c9ef(0x1e3))/0x1*(-parseInt(_0x30c9ef(0x193))/0x2)+parseInt(_0x30c9ef(0x199))/0x3+-parseInt(_0x30c9ef(0x256))/0x4*(parseInt(_0x30c9ef(0x18d))/0x5)+parseInt(_0x30c9ef(0x23c))/0x6*(parseInt(_0x30c9ef(0x211))/0x7)+parseInt(_0x30c9ef(0x167))/0x8*(parseInt(_0x30c9ef(0x261))/0x9)+-parseInt(_0x30c9ef(0x1e1))/0xa+parseInt(_0x30c9ef(0x19b))/0xb;if(_0x593911===_0x45b9a6)break;else _0x1023a1['push'](_0x1023a1['shift']());}catch(_0x27ccb8){_0x1023a1['push'](_0x1023a1['shift']());}}}(a61_0x33f2,0xbc1d7));var __importDefault=this&&this['__importDefault']||function(_0x5c50e0){return _0x5c50e0&&_0x5c50e0['__esModule']?_0x5c50e0:{'default':_0x5c50e0};};Object[a61_0x19b1e7(0x263)](exports,a61_0x19b1e7(0x16a),{'value':!![]}),exports[a61_0x19b1e7(0x190)]=exports[a61_0x19b1e7(0x1ac)]=void 0x0;function a61_0x33f2(){const _0x189995=['\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','•\x20Payment\x20status\x20changes\x0a','shopId','🔌\x20User\x20','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','image/png','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','ipAddress','userAgent','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','`\x0a\x0a','botUsername','📝\x20Notes:\x20','.jpeg','gateway','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','❌\x20Error\x20sending\x20file\x20to\x20chat:','Payout\x20completed','endpoint','❌\x20Error\x20sending\x20file\x20to\x20shop:','🔔\x20Notifications\x20are\x20active\x0a\x0a','stopPolling','test','adminNotes','initializeBot','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','currency','`.\x0a\x0a','❌\x20Shop\x20`','sk_','14215iQDHTq','node-telegram-bot-api','📱\x20No\x20active\x20Telegram\x20users\x20found','telegramBotService','📱\x20Your\x20Telegram\x20ID:\x20`','Successful\x20login','104ltqoMT','includes','forEach','❌\x20Telegram\x20bot\x20not\x20initialized','customerUa','\x20USDT*\x0a','340533urQGEi','🎉\x20*Congratulations!*\x0a\x0a','10835671CXQHJz','toLocaleString','username','❌\x20Error\x20getting\x20debug\x20information.',':\x20username=\x22','botToken','customerIp','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','text','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','Error\x20handling\x20/start\x20command:',':\x20`','notificationLogin','...\x22','New\x20payment\x20created','💻\x20Browser:\x20`','TelegramBotService','✅\x20Telegram\x20user\x20','🏦\x20IBAN:\x20`','shopSettings','last_name','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','image/jpeg','•\x20Payouts\x0a','❌\x20Error:\x20`','substring','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Error\x20sending\x20shop\x20notification:','sendNotificationToAll','📱\x20Created\x20new\x20Telegram\x20user:\x20','application/pdf','updatedAt','Error\x20handling\x20/debug\x20command:','📊\x20*Connection\x20Status*\x0a\x0a','sendMessage','🌐\x20IP\x20address:\x20`','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','createdAt','en-US','findUnique','secretKey','✅\x20File\x20sent\x20to\x20chat\x20','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','Failed\x20to\x20send\x20login\x20notification:','Payment\x20chargeback','allSettled','from','•\x20`','🔗\x20TXID:\x20`','`\x20is\x20inactive.\x0a\x0a','🆔\x20Payment\x20ID:\x20`','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','findFirst','split','warn','message','shop','method','Payment\x20expired','🆔\x20Request\x20ID:\x20`','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','\x20USD*\x0a','📊\x20Error\x20code:\x20`','name','Failed\x20login\x20attempt','/status\x20-\x20check\x20connection\x20status\x0a','10998370QEATFO','\x20\x20\x20Status:\x20','7136qyNucU','statusCode','application/octet-stream','\x20users','stopBot','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','❌\x20Shop\x20with\x20username\x20`','Error\x20handling\x20message:','\x20\x20\x20Username:\x20`','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','*\x0a\x0a','trim','timestamp','📛\x20Name:\x20`','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','Check\x20spelling\x20and\x20try\x20again.','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','🚨\x20*API\x20Error*\x0a\x0a','handleSingleLineVerification','👤\x20Username:\x20`','🔗\x20Endpoint:\x20`','\x20verified\x20for\x20shop\x20','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','bot','default','getBotInfo','customerEmail','Use\x20/start\x20to\x20connect.','Example:\x0a','sendLoginNotification','Payout\x20rejected','🛑\x20Telegram\x20bot\x20stopped','\x0a👤\x20*Customer\x20Information:*\x0a','toLocaleDateString','unknown\x20shop','❌\x20Please\x20use\x20/start\x20command\x20first','💰\x20Amount:\x20*','sendDirectFile','🔔\x20*','•\x20New\x20payments\x0a','\x20parts:\x20','log','endsWith','...','📅\x20Time:\x20','\x20\x20\x20Public\x20Key:\x20`','14IcPtjL','Payment\x20failed','sendDirectMessage','You\x20sent\x20','processing','Markdown','map','failed','TELEGRAM_BOT_TOKEN','✅\x20Telegram\x20bot\x20@','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','toString','🏪\x20Available\x20shops\x20in\x20system:\x0a','sendDocument','📱\x20Shop:\x20*','success','telegramUser','Error\x20handling\x20/status\x20command:','🔍\x20*Debug\x20Information*\x0a\x0a','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','sendShopNotification','join','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','.\x20*','requestId','.jpg','chargebackAmount','Payment\x20successfully\x20paid','🏪\x20Gateway:\x20`','📅\x20Connection\x20date:\x20','update','❌\x20Error\x20sending\x20direct\x20message:','onText','pk_','✅\x20Connected\x20to\x20shop:\x20*','Username:\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','status','entries','errorMessage','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','TELEGRAM_BOT_USERNAME','3604932rokopm','txid','To\x20reconnect,\x20use\x20the\x20/start\x20command','../types/gateway','\x20initialized\x20successfully','`\x20not\x20found.\x0a\x0a','Available\x20usernames:\x0a','✅\x20Welcome\x20back!\x0a\x0a','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','startsWith','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','User\x20','remitterIban','sendPaymentNotification','customerName','📝\x20Order\x20ID:\x20`','*.\x0a\x0a','💸\x20Penalty\x20amount:\x20*','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','\x22,\x20apiKey=\x22','sendCustomNotification','Commands:\x0a','...`\x0a\x0a','isVerified','chat\x20not\x20found','chat','1624hoqimn','telegramId','❌\x20Error\x20sending\x20file\x20to\x20user\x20','first_name','getGatewayDisplayNameForTelegram','env','Telegram\x20bot\x20error:','ACTIVE','findMany','length','setupBotHandlers','414tlixPg','user\x20is\x20deactivated','defineProperty','🌐\x20IP:\x20`','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','New\x20payout\x20created','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','amount','•\x20Important\x20events\x0a\x0a','error','61448EZHSno','Error\x20handling\x20/disconnect\x20command:','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','__esModule','trapay_bot','publicKey','Error\x20in\x20handleSingleLineVerification:'];a61_0x33f2=function(){return _0x189995;};return a61_0x33f2();}function a61_0x46ae(_0x3b1c11,_0x524459){const _0x33f23c=a61_0x33f2();return a61_0x46ae=function(_0x46ae85,_0x509d41){_0x46ae85=_0x46ae85-0x163;let _0x294559=_0x33f23c[_0x46ae85];return _0x294559;},a61_0x46ae(_0x3b1c11,_0x524459);}const node_telegram_bot_api_1=__importDefault(require(a61_0x19b1e7(0x18e))),database_1=__importDefault(require('../config/database')),gateway_1=require(a61_0x19b1e7(0x23f));class TelegramBotService{constructor(){const _0x16fff5=a61_0x19b1e7;this[_0x16fff5(0x1fa)]=null,this[_0x16fff5(0x1a0)]=process[_0x16fff5(0x25b)][_0x16fff5(0x219)]||'',this['botUsername']=process[_0x16fff5(0x25b)][_0x16fff5(0x23b)]||_0x16fff5(0x16b),this[_0x16fff5(0x1a0)]?this[_0x16fff5(0x187)]():console[_0x16fff5(0x1d5)](_0x16fff5(0x21c));}['initializeBot'](){const _0x544688=a61_0x19b1e7;try{this['bot']=new node_telegram_bot_api_1[(_0x544688(0x1fb))](this['botToken'],{'polling':!![]}),this[_0x544688(0x260)](),console[_0x544688(0x20c)](_0x544688(0x21a)+this['botUsername']+_0x544688(0x240));}catch(_0x44df10){console[_0x544688(0x166)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x44df10);}}['setupBotHandlers'](){const _0x57ef75=a61_0x19b1e7;if(!this[_0x57ef75(0x1fa)])return;this['bot'][_0x57ef75(0x232)](/\/start/,async _0x108052=>{const _0x3a925e=_0x57ef75,_0x1781a7=_0x108052[_0x3a925e(0x255)]['id'],_0x5213ec=_0x108052[_0x3a925e(0x1cd)]?.['id']['toString'](),_0x2aeab8=_0x108052[_0x3a925e(0x1cd)]?.['username'],_0x3ce189=_0x108052['from']?.[_0x3a925e(0x259)],_0x12c899=_0x108052[_0x3a925e(0x1cd)]?.[_0x3a925e(0x1b0)];if(!_0x5213ec)return;try{let _0x3fc8e7=await database_1[_0x3a925e(0x1fb)]['telegramUser'][_0x3a925e(0x1c3)]({'where':{'telegramId':_0x5213ec},'include':{'shop':!![]}});!_0x3fc8e7?(_0x3fc8e7=await database_1[_0x3a925e(0x1fb)][_0x3a925e(0x222)]['create']({'data':{'telegramId':_0x5213ec,'username':_0x2aeab8,'firstName':_0x3ce189,'lastName':_0x12c899,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x3a925e(0x20c)](_0x3a925e(0x1b9)+_0x5213ec+'\x20(@'+_0x2aeab8+')')):_0x3fc8e7=await database_1[_0x3a925e(0x1fb)][_0x3a925e(0x222)][_0x3a925e(0x230)]({'where':{'telegramId':_0x5213ec},'data':{'username':_0x2aeab8,'firstName':_0x3ce189,'lastName':_0x12c899},'include':{'shop':!![]}}),_0x3fc8e7['isVerified']&&_0x3fc8e7[_0x3a925e(0x171)]&&_0x3fc8e7[_0x3a925e(0x1d7)]?await this[_0x3a925e(0x1fa)]?.[_0x3a925e(0x1be)](_0x1781a7,_0x3a925e(0x243)+(_0x3a925e(0x1c8)+_0x3fc8e7['shop'][_0x3a925e(0x1de)]+'*\x0a')+(_0x3a925e(0x235)+_0x3fc8e7['shop'][_0x3a925e(0x19d)]+_0x3a925e(0x179))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x3a925e(0x20a)+'•\x20Payment\x20status\x20changes\x0a'+'•\x20Payouts\x0a\x0a'+_0x3a925e(0x251)+_0x3a925e(0x1e0)+_0x3a925e(0x236),{'parse_mode':_0x3a925e(0x216)}):(_0x3fc8e7['shopId']&&!_0x3fc8e7[_0x3a925e(0x253)]&&(await database_1[_0x3a925e(0x1fb)][_0x3a925e(0x222)][_0x3a925e(0x230)]({'where':{'telegramId':_0x5213ec},'data':{'shopId':null,'isVerified':![]}}),console[_0x3a925e(0x20c)](_0x3a925e(0x1f1)+_0x5213ec)),await this['bot']?.[_0x3a925e(0x1be)](_0x1781a7,_0x3a925e(0x1e8)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x3a925e(0x265)+_0x3a925e(0x1ff)+_0x3a925e(0x244)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x3a925e(0x216)}));}catch(_0x67e6da){console[_0x3a925e(0x166)](_0x3a925e(0x1a6),_0x67e6da),await this[_0x3a925e(0x1fa)]?.[_0x3a925e(0x1be)](_0x1781a7,_0x3a925e(0x24e));}}),this['bot'][_0x57ef75(0x232)](/\/disconnect/,async _0x4fdbcb=>{const _0x5be09f=_0x57ef75,_0x18952c=_0x4fdbcb[_0x5be09f(0x255)]['id'],_0x3dc850=_0x4fdbcb[_0x5be09f(0x1cd)]?.['id'][_0x5be09f(0x21d)]();if(!_0x3dc850)return;try{const _0x41fb5f=await database_1['default'][_0x5be09f(0x222)]['findUnique']({'where':{'telegramId':_0x3dc850},'include':{'shop':!![]}});if(!_0x41fb5f||!_0x41fb5f[_0x5be09f(0x253)]||!_0x41fb5f[_0x5be09f(0x171)]){await this[_0x5be09f(0x1fa)]?.[_0x5be09f(0x1be)](_0x18952c,_0x5be09f(0x169));return;}const _0x5e5010=_0x41fb5f['shop']?.['name']||_0x5be09f(0x205);await database_1[_0x5be09f(0x1fb)][_0x5be09f(0x222)]['update']({'where':{'telegramId':_0x3dc850},'data':{'shopId':null,'isVerified':![]}}),console[_0x5be09f(0x20c)](_0x5be09f(0x172)+_0x3dc850+'\x20disconnected\x20from\x20shop\x20'+_0x41fb5f[_0x5be09f(0x171)]),await this['bot']?.[_0x5be09f(0x1be)](_0x18952c,_0x5be09f(0x1d2)+_0x5e5010+_0x5be09f(0x24c)+_0x5be09f(0x23e),{'parse_mode':'Markdown'});}catch(_0x2652d6){console['error'](_0x5be09f(0x168),_0x2652d6),await this[_0x5be09f(0x1fa)]?.[_0x5be09f(0x1be)](_0x18952c,_0x5be09f(0x24e));}}),this[_0x57ef75(0x1fa)][_0x57ef75(0x232)](/\/status/,async _0x31f482=>{const _0x15bc51=_0x57ef75,_0x531813=_0x31f482[_0x15bc51(0x255)]['id'],_0x3dc0c8=_0x31f482[_0x15bc51(0x1cd)]?.['id'][_0x15bc51(0x21d)]();if(!_0x3dc0c8)return;try{const _0x2ca199=await database_1['default']['telegramUser'][_0x15bc51(0x1c3)]({'where':{'telegramId':_0x3dc0c8},'include':{'shop':!![]}});if(!_0x2ca199){await this[_0x15bc51(0x1fa)]?.[_0x15bc51(0x1be)](_0x531813,_0x15bc51(0x1c9)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x2ca199[_0x15bc51(0x253)]||!_0x2ca199[_0x15bc51(0x171)]||!_0x2ca199['shop']){await this[_0x15bc51(0x1fa)]?.[_0x15bc51(0x1be)](_0x531813,_0x15bc51(0x1f9)+_0x15bc51(0x1fe));return;}await this[_0x15bc51(0x1fa)]?.[_0x15bc51(0x1be)](_0x531813,_0x15bc51(0x1bd)+(_0x15bc51(0x234)+_0x2ca199[_0x15bc51(0x1d7)]['name']+'*\x0a')+(_0x15bc51(0x1f6)+_0x2ca199[_0x15bc51(0x1d7)]['username']+'`\x0a')+(_0x15bc51(0x22f)+_0x2ca199[_0x15bc51(0x1bb)][_0x15bc51(0x204)](_0x15bc51(0x1c2))+'\x0a\x0a')+_0x15bc51(0x183)+'Commands:\x0a'+_0x15bc51(0x236),{'parse_mode':_0x15bc51(0x216)});}catch(_0x100e38){console[_0x15bc51(0x166)](_0x15bc51(0x223),_0x100e38),await this[_0x15bc51(0x1fa)]?.[_0x15bc51(0x1be)](_0x531813,_0x15bc51(0x24e));}}),this[_0x57ef75(0x1fa)]['onText'](/\/debug/,async _0x1c5fa4=>{const _0x8646fa=_0x57ef75,_0x5f198b=_0x1c5fa4[_0x8646fa(0x255)]['id'],_0x568557=_0x1c5fa4[_0x8646fa(0x1cd)]?.['id']['toString']();if(!_0x568557)return;try{const _0x5f3a57=await database_1[_0x8646fa(0x1fb)][_0x8646fa(0x1d7)][_0x8646fa(0x25e)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x362adf=_0x8646fa(0x224);_0x362adf+=_0x8646fa(0x191)+_0x568557+_0x8646fa(0x179),_0x362adf+=_0x8646fa(0x21e),_0x5f3a57[_0x8646fa(0x195)]((_0x426d25,_0x467731)=>{const _0x1e7500=_0x8646fa;_0x362adf+=_0x467731+0x1+_0x1e7500(0x229)+_0x426d25[_0x1e7500(0x1de)]+'*\x0a',_0x362adf+=_0x1e7500(0x1eb)+_0x426d25[_0x1e7500(0x19d)]+'`\x0a',_0x362adf+=_0x1e7500(0x1e2)+_0x426d25[_0x1e7500(0x237)]+'\x0a',_0x362adf+=_0x1e7500(0x210)+_0x426d25[_0x1e7500(0x16c)]['substring'](0x0,0xf)+_0x1e7500(0x252);}),await this['bot']?.[_0x8646fa(0x1be)](_0x5f198b,_0x362adf,{'parse_mode':'Markdown'});}catch(_0x42e7b0){console[_0x8646fa(0x166)](_0x8646fa(0x1bc),_0x42e7b0),await this[_0x8646fa(0x1fa)]?.[_0x8646fa(0x1be)](_0x5f198b,_0x8646fa(0x19e));}}),this[_0x57ef75(0x1fa)]['on'](_0x57ef75(0x1d6),async _0x102538=>{const _0x15445f=_0x57ef75;if(_0x102538[_0x15445f(0x1a3)]?.[_0x15445f(0x245)]('/'))return;const _0x327561=_0x102538[_0x15445f(0x255)]['id'],_0x2d65ff=_0x102538[_0x15445f(0x1cd)]?.['id'][_0x15445f(0x21d)](),_0x52f170=_0x102538['text']?.[_0x15445f(0x1ee)]();if(!_0x2d65ff||!_0x52f170)return;try{const _0x4c14ee=await database_1[_0x15445f(0x1fb)][_0x15445f(0x222)]['findUnique']({'where':{'telegramId':_0x2d65ff},'include':{'shop':!![]}});if(!_0x4c14ee){await this[_0x15445f(0x1fa)]?.['sendMessage'](_0x327561,_0x15445f(0x206));return;}if(_0x4c14ee[_0x15445f(0x253)]&&_0x4c14ee[_0x15445f(0x171)]&&_0x4c14ee[_0x15445f(0x1d7)]){await this[_0x15445f(0x1fa)]?.[_0x15445f(0x1be)](_0x327561,_0x15445f(0x1b6)+_0x4c14ee[_0x15445f(0x1d7)]['name']+'*.\x0a\x0a'+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x15445f(0x216)});return;}const _0x5c2f67=_0x52f170[_0x15445f(0x1d4)](/\s+/);if(_0x5c2f67[_0x15445f(0x25f)]!==0x2){await this['bot']?.[_0x15445f(0x1be)](_0x327561,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x15445f(0x1ff)+_0x15445f(0x244)+(_0x15445f(0x214)+_0x5c2f67['length']+_0x15445f(0x20b)+_0x5c2f67[_0x15445f(0x217)](_0x262254=>'`'+_0x262254+'`')[_0x15445f(0x227)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x3f37b5,_0x4efd73]=_0x5c2f67;console[_0x15445f(0x20c)](_0x15445f(0x1f3)+_0x2d65ff+_0x15445f(0x19f)+_0x3f37b5+_0x15445f(0x24f)+_0x4efd73[_0x15445f(0x1b5)](0x0,0xa)+_0x15445f(0x1a9)),await this[_0x15445f(0x1f5)](_0x327561,_0x2d65ff,_0x3f37b5,_0x4efd73);}catch(_0x3f919f){console[_0x15445f(0x166)](_0x15445f(0x1ea),_0x3f919f),await this[_0x15445f(0x1fa)]?.[_0x15445f(0x1be)](_0x327561,_0x15445f(0x24e));}}),this[_0x57ef75(0x1fa)]['on'](_0x57ef75(0x166),_0x5ba5ec=>{const _0x2ec1a3=_0x57ef75;console[_0x2ec1a3(0x166)](_0x2ec1a3(0x25c),_0x5ba5ec);}),this[_0x57ef75(0x1fa)]['on']('polling_error',_0x138fec=>{const _0x2c6e8c=_0x57ef75;console[_0x2c6e8c(0x166)]('Telegram\x20bot\x20polling\x20error:',_0x138fec);});}async[a61_0x19b1e7(0x1f5)](_0x11baee,_0x1ca4ce,_0x15813c,_0x4f15de){const _0x2ca11b=a61_0x19b1e7;try{console[_0x2ca11b(0x20c)](_0x2ca11b(0x1f3)+_0x1ca4ce+_0x2ca11b(0x19f)+_0x15813c+_0x2ca11b(0x24f)+_0x4f15de[_0x2ca11b(0x1b5)](0x0,0xa)+'...\x22');if(!_0x15813c||_0x15813c[_0x2ca11b(0x25f)]<0x3||_0x15813c[_0x2ca11b(0x25f)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x2ca11b(0x185)](_0x15813c)){await this[_0x2ca11b(0x1fa)]?.[_0x2ca11b(0x1be)](_0x11baee,'❌\x20Invalid\x20username\x20format:\x20`'+_0x15813c+'`\x0a\x0a'+_0x2ca11b(0x23a),{'parse_mode':'Markdown'});return;}if(!_0x4f15de||!_0x4f15de['startsWith'](_0x2ca11b(0x233))&&!_0x4f15de[_0x2ca11b(0x245)](_0x2ca11b(0x18c))){await this[_0x2ca11b(0x1fa)]?.[_0x2ca11b(0x1be)](_0x11baee,_0x2ca11b(0x228)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x2ca11b(0x216)});return;}const _0x2ba55d=await database_1['default'][_0x2ca11b(0x1d7)][_0x2ca11b(0x1c3)]({'where':{'username':_0x15813c},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x2ba55d){const _0x101e6a=await database_1['default']['shop'][_0x2ca11b(0x25e)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x5e72e1=_0x2ca11b(0x1e9)+_0x15813c+_0x2ca11b(0x241);_0x101e6a['length']>0x0?(_0x5e72e1+=_0x2ca11b(0x242),_0x101e6a['forEach'](_0x429a59=>{const _0x4d218d=_0x2ca11b;_0x5e72e1+=_0x4d218d(0x1ce)+_0x429a59[_0x4d218d(0x19d)]+'`\x20('+_0x429a59[_0x4d218d(0x1de)]+')\x0a';}),_0x5e72e1+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x5e72e1+=_0x2ca11b(0x1f2);await this[_0x2ca11b(0x1fa)]?.[_0x2ca11b(0x1be)](_0x11baee,_0x5e72e1,{'parse_mode':_0x2ca11b(0x216)});return;}if(_0x2ba55d[_0x2ca11b(0x237)]!==_0x2ca11b(0x25d)){await this[_0x2ca11b(0x1fa)]?.[_0x2ca11b(0x1be)](_0x11baee,_0x2ca11b(0x18b)+_0x15813c+_0x2ca11b(0x1d0)+'Contact\x20administrator.',{'parse_mode':_0x2ca11b(0x216)});return;}if(_0x2ba55d[_0x2ca11b(0x16c)]!==_0x4f15de&&_0x2ba55d[_0x2ca11b(0x1c4)]!==_0x4f15de){await this[_0x2ca11b(0x1fa)]?.[_0x2ca11b(0x1be)](_0x11baee,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x15813c+_0x2ca11b(0x18a)+_0x2ca11b(0x1db)+_0x2ca11b(0x246),{'parse_mode':_0x2ca11b(0x216)});return;}const _0x585493=await database_1[_0x2ca11b(0x1fb)][_0x2ca11b(0x222)][_0x2ca11b(0x1d3)]({'where':{'shopId':_0x2ba55d['id'],'isVerified':!![],'telegramId':{'not':_0x1ca4ce}}});if(_0x585493){await this['bot']?.[_0x2ca11b(0x1be)](_0x11baee,_0x2ca11b(0x173)+_0x15813c+_0x2ca11b(0x18a)+_0x2ca11b(0x225),{'parse_mode':_0x2ca11b(0x216)});return;}await database_1[_0x2ca11b(0x1fb)][_0x2ca11b(0x222)]['update']({'where':{'telegramId':_0x1ca4ce},'data':{'shopId':_0x2ba55d['id'],'isVerified':!![]}}),await this[_0x2ca11b(0x1fa)]?.[_0x2ca11b(0x1be)](_0x11baee,_0x2ca11b(0x19a)+_0x2ca11b(0x178)+(_0x2ca11b(0x220)+_0x2ba55d[_0x2ca11b(0x1de)]+'*\x0a')+('👤\x20Username:\x20`'+_0x2ba55d[_0x2ca11b(0x19d)]+'`\x0a\x0a')+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x2ca11b(0x20a)+_0x2ca11b(0x170)+_0x2ca11b(0x1b3)+_0x2ca11b(0x165)+_0x2ca11b(0x251)+_0x2ca11b(0x1e0)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}),console[_0x2ca11b(0x20c)](_0x2ca11b(0x1ad)+_0x1ca4ce+_0x2ca11b(0x1f8)+_0x2ba55d['username']+'\x20via\x20single-line\x20input');}catch(_0x55e952){console['error'](_0x2ca11b(0x16d),_0x55e952),await this[_0x2ca11b(0x1fa)]?.[_0x2ca11b(0x1be)](_0x11baee,_0x2ca11b(0x163));}}async[a61_0x19b1e7(0x226)](_0x358297,_0x5e992c,_0x25a8a8){const _0x88ac20=a61_0x19b1e7;if(!this[_0x88ac20(0x1fa)]){console[_0x88ac20(0x1d5)](_0x88ac20(0x1a2));return;}try{const _0x60b763=await database_1[_0x88ac20(0x1fb)][_0x88ac20(0x222)][_0x88ac20(0x25e)]({'where':{'shopId':_0x358297,'isVerified':!![]}});if(_0x60b763[_0x88ac20(0x25f)]===0x0){console['log']('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x358297);return;}const _0x52433a=_0x60b763['map'](async _0x1bd938=>{const _0x1ee0e7=_0x88ac20;try{await this[_0x1ee0e7(0x1fa)]?.[_0x1ee0e7(0x1be)](_0x1bd938['telegramId'],_0x5e992c,_0x25a8a8),console['log'](_0x1ee0e7(0x1c0)+_0x1bd938[_0x1ee0e7(0x257)]);}catch(_0x4a26f8){console[_0x1ee0e7(0x166)](_0x1ee0e7(0x1a5)+_0x1bd938[_0x1ee0e7(0x257)]+':',_0x4a26f8),_0x4a26f8 instanceof Error&&(_0x4a26f8['message'][_0x1ee0e7(0x194)]('blocked')||_0x4a26f8['message'][_0x1ee0e7(0x194)](_0x1ee0e7(0x254))||_0x4a26f8[_0x1ee0e7(0x1d6)]['includes'](_0x1ee0e7(0x262)))&&(await database_1['default'][_0x1ee0e7(0x222)][_0x1ee0e7(0x230)]({'where':{'id':_0x1bd938['id']},'data':{'isVerified':![]}}),console['log'](_0x1ee0e7(0x247)+_0x1bd938[_0x1ee0e7(0x257)]+_0x1ee0e7(0x175)));}});await Promise[_0x88ac20(0x1cc)](_0x52433a);}catch(_0x3cc58b){console[_0x88ac20(0x166)](_0x88ac20(0x1b7),_0x3cc58b);}}async[a61_0x19b1e7(0x249)](_0x4e3a06,_0x3f773a,_0x1aaf86){const _0x220fac=a61_0x19b1e7,_0x202e95={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x4e0d38={'created':_0x220fac(0x1aa),'paid':_0x220fac(0x22d),'failed':_0x220fac(0x212),'expired':_0x220fac(0x1d9),'refund':'Payment\x20refund','chargeback':_0x220fac(0x1cb),'processing':'Payment\x20is\x20being\x20processed'},_0x4ed573=_0x202e95[_0x1aaf86],_0x3c692a=_0x4e0d38[_0x1aaf86],_0x48be2b=(0x0,gateway_1[_0x220fac(0x25a)])(_0x3f773a[_0x220fac(0x17d)]);console['log']('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x3f773a[_0x220fac(0x17d)]+'\x22\x20->\x20display\x20\x22'+_0x48be2b+'\x22');let _0x37a847=_0x4ed573+'\x20*'+_0x3c692a+_0x220fac(0x1ed)+(_0x220fac(0x207)+_0x3f773a['amount']+'\x20'+_0x3f773a[_0x220fac(0x189)]+'*\x0a')+(_0x220fac(0x24b)+(_0x3f773a['orderId']||_0x3f773a['id'])+'`\x0a')+(_0x220fac(0x1d1)+_0x3f773a['id']+'`\x0a')+(_0x220fac(0x22e)+_0x48be2b+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x3f773a[_0x220fac(0x1c1)])['toLocaleString'](_0x220fac(0x1c2))+'\x0a');if(_0x3f773a[_0x220fac(0x24a)]||_0x3f773a[_0x220fac(0x1fd)]||_0x3f773a['remitterIban']||_0x3f773a[_0x220fac(0x1a1)]||_0x3f773a[_0x220fac(0x197)]){_0x37a847+=_0x220fac(0x203);_0x3f773a[_0x220fac(0x24a)]&&(_0x37a847+=_0x220fac(0x1f0)+_0x3f773a[_0x220fac(0x24a)]+'`\x0a');_0x3f773a[_0x220fac(0x1fd)]&&(_0x37a847+='📧\x20Email:\x20`'+_0x3f773a[_0x220fac(0x1fd)]+'`\x0a');_0x3f773a[_0x220fac(0x248)]&&(_0x37a847+=_0x220fac(0x1ae)+_0x3f773a[_0x220fac(0x248)]+'`\x0a');_0x3f773a[_0x220fac(0x1a1)]&&(_0x37a847+=_0x220fac(0x264)+_0x3f773a[_0x220fac(0x1a1)]+'`\x0a');if(_0x3f773a[_0x220fac(0x197)]){const _0x3c7087=_0x3f773a['customerUa'][_0x220fac(0x25f)]>0x32?_0x3f773a[_0x220fac(0x197)]['substring'](0x0,0x32)+_0x220fac(0x20e):_0x3f773a['customerUa'];_0x37a847+=_0x220fac(0x1ab)+_0x3c7087+'`\x0a';}}_0x1aaf86==='chargeback'&&_0x3f773a[_0x220fac(0x22c)]&&(_0x37a847+=_0x220fac(0x24d)+_0x3f773a[_0x220fac(0x22c)]+_0x220fac(0x198)),_0x1aaf86===_0x220fac(0x215)&&(_0x37a847+=_0x220fac(0x1a4)),_0x3f773a[_0x220fac(0x186)]&&(_0x37a847+=_0x220fac(0x17b)+_0x3f773a['adminNotes']+'\x0a'),await this['sendShopNotification'](_0x4e3a06,_0x37a847,{'parse_mode':_0x220fac(0x216)});}async['sendPayoutNotification'](_0x3bf622,_0x1b1b04,_0x243adc){const _0x114220=a61_0x19b1e7,_0x491fae={'created':'📤','completed':'✅','rejected':'❌'},_0x7d96f4={'created':_0x114220(0x266),'completed':_0x114220(0x180),'rejected':_0x114220(0x201)},_0x283508=_0x491fae[_0x243adc],_0x18f7d2=_0x7d96f4[_0x243adc],_0x217428=_0x283508+'\x20*'+_0x18f7d2+'*\x0a\x0a'+('💸\x20Amount:\x20*'+_0x1b1b04[_0x114220(0x164)]+_0x114220(0x1dc))+('🏦\x20Method:\x20`'+_0x1b1b04[_0x114220(0x1d8)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x1b1b04['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x1b1b04[_0x114220(0x1c1)])[_0x114220(0x19c)](_0x114220(0x1c2))+'\x0a')+(_0x1b1b04[_0x114220(0x23d)]?_0x114220(0x1cf)+_0x1b1b04[_0x114220(0x23d)]+'`':'');await this[_0x114220(0x226)](_0x3bf622,_0x217428,{'parse_mode':_0x114220(0x216)});}async[a61_0x19b1e7(0x200)](_0xe32dbf,_0x215331){const _0x4bdf3c=a61_0x19b1e7;try{const _0x52e94c=await database_1[_0x4bdf3c(0x1fb)]['shopSettings']['findUnique']({'where':{'shopId':_0xe32dbf},'select':{'notificationLogin':!![]}});if(!_0x52e94c?.[_0x4bdf3c(0x1a8)]){console[_0x4bdf3c(0x20c)](_0x4bdf3c(0x1c6)+_0xe32dbf);return;}const _0x1a5b62=_0x215331[_0x4bdf3c(0x221)]?'🔐':'🚨',_0x1d235b=_0x215331['success']?_0x4bdf3c(0x192):_0x4bdf3c(0x1df);let _0x2ab9ab=_0x1a5b62+'\x20*'+_0x1d235b+_0x4bdf3c(0x1ed)+(_0x4bdf3c(0x1f6)+_0x215331['username']+'`\x0a')+(_0x4bdf3c(0x20f)+_0x215331[_0x4bdf3c(0x1ef)][_0x4bdf3c(0x19c)]('en-US')+'\x0a');_0x215331[_0x4bdf3c(0x176)]&&(_0x2ab9ab+=_0x4bdf3c(0x1bf)+_0x215331[_0x4bdf3c(0x176)]+'`\x0a');if(_0x215331[_0x4bdf3c(0x177)]){const _0x3bae12=_0x215331[_0x4bdf3c(0x177)][_0x4bdf3c(0x25f)]>0x32?_0x215331[_0x4bdf3c(0x177)]['substring'](0x0,0x32)+_0x4bdf3c(0x20e):_0x215331['userAgent'];_0x2ab9ab+='💻\x20Browser:\x20`'+_0x3bae12+'`\x0a';}!_0x215331[_0x4bdf3c(0x221)]&&(_0x2ab9ab+=_0x4bdf3c(0x16e)),await this[_0x4bdf3c(0x226)](_0xe32dbf,_0x2ab9ab,{'parse_mode':_0x4bdf3c(0x216)}),console[_0x4bdf3c(0x20c)](_0x4bdf3c(0x1c7)+_0xe32dbf+':\x20'+(_0x215331[_0x4bdf3c(0x221)]?_0x4bdf3c(0x221):_0x4bdf3c(0x218)));}catch(_0x430105){console[_0x4bdf3c(0x166)](_0x4bdf3c(0x1ca),_0x430105);}}async['sendApiErrorNotification'](_0x16e354,_0x480cbd){const _0x481aaa=a61_0x19b1e7;try{const _0x14c97e=await database_1[_0x481aaa(0x1fb)][_0x481aaa(0x1af)][_0x481aaa(0x1c3)]({'where':{'shopId':_0x16e354},'select':{'notificationApiError':!![]}});if(!_0x14c97e?.['notificationApiError']){console[_0x481aaa(0x20c)](_0x481aaa(0x1ec)+_0x16e354);return;}let _0x212b47=_0x481aaa(0x1f4)+(_0x481aaa(0x1f7)+_0x480cbd[_0x481aaa(0x1d8)]+'\x20'+_0x480cbd[_0x481aaa(0x181)]+'`\x0a')+(_0x481aaa(0x20f)+_0x480cbd[_0x481aaa(0x1ef)][_0x481aaa(0x19c)](_0x481aaa(0x1c2))+'\x0a');_0x480cbd['statusCode']&&(_0x212b47+=_0x481aaa(0x1dd)+_0x480cbd[_0x481aaa(0x1e4)]+'`\x0a'),_0x212b47+=_0x481aaa(0x1b4)+_0x480cbd[_0x481aaa(0x239)]+'`\x0a',_0x480cbd[_0x481aaa(0x22a)]&&(_0x212b47+=_0x481aaa(0x1da)+_0x480cbd['requestId']+'`\x0a'),_0x212b47+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x481aaa(0x226)](_0x16e354,_0x212b47,{'parse_mode':_0x481aaa(0x216)}),console['log'](_0x481aaa(0x17e)+_0x16e354+':\x20'+_0x480cbd[_0x481aaa(0x181)]);}catch(_0x5f25cd){console[_0x481aaa(0x166)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x5f25cd);}}async[a61_0x19b1e7(0x250)](_0x22b9d6,_0x48266e,_0x59dd4f){const _0x34bfd8=a61_0x19b1e7;let _0x12f089=_0x34bfd8(0x209)+_0x48266e+_0x34bfd8(0x1ed);for(const [_0x34e632,_0x405968]of Object[_0x34bfd8(0x238)](_0x59dd4f)){_0x405968!==null&&_0x405968!==undefined&&(_0x12f089+=_0x34e632+_0x34bfd8(0x1a7)+_0x405968+'`\x0a');}await this['sendShopNotification'](_0x22b9d6,_0x12f089,{'parse_mode':_0x34bfd8(0x216)});}async[a61_0x19b1e7(0x1b8)](_0x8a0b2f){const _0x3d3d39=a61_0x19b1e7;try{console['log'](_0x3d3d39(0x21b)+_0x8a0b2f['substring'](0x0,0x32)+_0x3d3d39(0x20e));const _0x3175c6=await database_1['default'][_0x3d3d39(0x222)][_0x3d3d39(0x25e)]({'select':{'telegramId':!![]}});if(_0x3175c6[_0x3d3d39(0x25f)]===0x0){console[_0x3d3d39(0x20c)](_0x3d3d39(0x18f));return;}for(const _0x6ae5b3 of _0x3175c6){try{await this['bot']?.[_0x3d3d39(0x1be)](_0x6ae5b3[_0x3d3d39(0x257)],_0x8a0b2f,{'parse_mode':_0x3d3d39(0x216)});}catch(_0x3e13c0){console[_0x3d3d39(0x166)]('❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20'+_0x6ae5b3[_0x3d3d39(0x257)]+':',_0x3e13c0);}}console[_0x3d3d39(0x20c)]('📱\x20Notification\x20sent\x20to\x20'+_0x3175c6[_0x3d3d39(0x25f)]+_0x3d3d39(0x1e6));}catch(_0x2074e6){console['error'](_0x3d3d39(0x16f),_0x2074e6);}}[a61_0x19b1e7(0x1fc)](){const _0x22b6fd=a61_0x19b1e7;return{'isActive':!!this[_0x22b6fd(0x1fa)],'username':this[_0x22b6fd(0x17a)]};}async['sendShopFile'](_0x2bdac4,_0x50c1cc,_0x845784,_0x4d190f){const _0x3db613=a61_0x19b1e7;try{if(!this[_0x3db613(0x1fa)])return console[_0x3db613(0x166)]('❌\x20Telegram\x20bot\x20not\x20initialized'),![];const _0x15964b=await database_1['default'][_0x3db613(0x222)][_0x3db613(0x25e)]({'where':{'shopId':_0x2bdac4,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x15964b[_0x3db613(0x25f)]===0x0)return console[_0x3db613(0x166)](_0x3db613(0x1b1)+_0x2bdac4),![];let _0x126946=0x0;for(const _0x1bb9e0 of _0x15964b){try{await this[_0x3db613(0x1fa)][_0x3db613(0x21f)](_0x1bb9e0[_0x3db613(0x257)],_0x50c1cc,{},{'filename':_0x845784,'contentType':_0x845784[_0x3db613(0x20d)]('.png')?_0x3db613(0x174):_0x845784['endsWith']('.jpg')||_0x845784[_0x3db613(0x20d)](_0x3db613(0x17c))?_0x3db613(0x1b2):_0x845784['endsWith']('.pdf')?_0x3db613(0x1ba):_0x3db613(0x1e5)}),_0x4d190f&&await this['bot'][_0x3db613(0x1be)](_0x1bb9e0[_0x3db613(0x257)],_0x4d190f),_0x126946++;}catch(_0x2a2e38){console[_0x3db613(0x166)](_0x3db613(0x258)+_0x1bb9e0[_0x3db613(0x257)]+':',_0x2a2e38);}}return console[_0x3db613(0x20c)]('✅\x20File\x20sent\x20to\x20'+_0x126946+'/'+_0x15964b[_0x3db613(0x25f)]+'\x20users\x20of\x20shop\x20'+_0x2bdac4+':\x20'+_0x845784),_0x126946>0x0;}catch(_0x1d91b2){return console['error'](_0x3db613(0x182),_0x1d91b2),![];}}async[a61_0x19b1e7(0x213)](_0x4a9b29,_0x5e641b){const _0x7f2110=a61_0x19b1e7;try{if(!this['bot'])return console[_0x7f2110(0x166)](_0x7f2110(0x196)),![];return await this[_0x7f2110(0x1fa)]['sendMessage'](_0x4a9b29,_0x5e641b),console[_0x7f2110(0x20c)](_0x7f2110(0x188)+_0x4a9b29),!![];}catch(_0x2613d){return console[_0x7f2110(0x166)](_0x7f2110(0x231),_0x2613d),![];}}async[a61_0x19b1e7(0x208)](_0xcc5ea5,_0x31abc4,_0x393b5f,_0x2daac2){const _0x873f14=a61_0x19b1e7;try{if(!this[_0x873f14(0x1fa)])return console['error'](_0x873f14(0x196)),![];return await this[_0x873f14(0x1fa)]['sendDocument'](_0xcc5ea5,_0x31abc4,{},{'filename':_0x393b5f,'contentType':_0x393b5f[_0x873f14(0x20d)]('.png')?_0x873f14(0x174):_0x393b5f['endsWith'](_0x873f14(0x22b))||_0x393b5f[_0x873f14(0x20d)](_0x873f14(0x17c))?_0x873f14(0x1b2):_0x393b5f[_0x873f14(0x20d)]('.pdf')?'application/pdf':'application/octet-stream'}),_0x2daac2&&await this['bot']['sendMessage'](_0xcc5ea5,_0x2daac2),console[_0x873f14(0x20c)](_0x873f14(0x1c5)+_0xcc5ea5+':\x20'+_0x393b5f),!![];}catch(_0x3759ee){return console[_0x873f14(0x166)](_0x873f14(0x17f),_0x3759ee),![];}}[a61_0x19b1e7(0x1e7)](){const _0x1211c9=a61_0x19b1e7;this[_0x1211c9(0x1fa)]&&(this[_0x1211c9(0x1fa)][_0x1211c9(0x184)](),this[_0x1211c9(0x1fa)]=null,console['log'](_0x1211c9(0x202)));}}exports['TelegramBotService']=TelegramBotService,exports[a61_0x19b1e7(0x190)]=new TelegramBotService();