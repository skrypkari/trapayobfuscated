'use strict';const a58_0x1a2139=a58_0x337f;function a58_0x182d(){const _0xe1b21c=['onText','Payment\x20chargeback','customerUa','create','🏦\x20IBAN:\x20`','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','Payment\x20successfully\x20paid','\x20parts:\x20','\x0a👤\x20*Customer\x20Information:*\x0a','toString','Successful\x20login','notificationLogin','🔌\x20User\x20','•\x20Important\x20events\x0a\x0a','📝\x20Notes:\x20','__esModule','findMany','🔔\x20Notifications\x20are\x20active\x0a\x0a','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','telegramUser',':\x20username=\x22','Telegram\x20bot\x20polling\x20error:','includes','toLocaleString','5340456nShKPW','failed','setupBotHandlers','customerIp','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','💸\x20Amount:\x20*','\x20via\x20single-line\x20input','message','9313932fvEbZC','•\x20Payouts\x0a\x0a','bot','11OmuXTT','\x0aCheck\x20spelling\x20and\x20try\x20again.','findUnique','timestamp','❌\x20Shop\x20`','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','💰\x20Amount:\x20*','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','📱\x20Shop:\x20*','status','`.\x0a\x0a','en-US','Telegram\x20bot\x20error:','🌐\x20IP\x20address:\x20`','\x20USDT*\x0a','💸\x20Penalty\x20amount:\x20*','createdAt','TelegramBotService','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','📅\x20Time:\x20',':\x20`','🚨\x20*API\x20Error*\x0a\x0a','📛\x20Name:\x20`','botUsername','sendApiErrorNotification','*.\x0a\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','📊\x20*Connection\x20Status*\x0a\x0a','length','customerEmail','`\x0a\x0a','trapay_bot','❌\x20Please\x20use\x20/start\x20command\x20first','startsWith','...','Commands:\x0a','🏪\x20Available\x20shops\x20in\x20system:\x0a','\x20USD*\x0a','env','map','Payment\x20expired','test','userAgent','Error\x20handling\x20/disconnect\x20command:','\x22\x20->\x20display\x20\x22','✅\x20Telegram\x20user\x20','statusCode','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','.\x20*','•\x20Payment\x20status\x20changes\x0a','shop','username','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','orderId','user\x20is\x20deactivated','Error\x20sending\x20shop\x20notification:','Payout\x20rejected','getGatewayDisplayNameForTelegram','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','✅\x20Telegram\x20bot\x20@','`\x20(','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','/disconnect\x20-\x20disconnect\x20from\x20notifications','Failed\x20to\x20send\x20API\x20error\x20notification:','🔍\x20*Debug\x20Information*\x0a\x0a','handleSingleLineVerification','Error\x20handling\x20/status\x20command:','28gfygQu','❌\x20Error:\x20`','New\x20payment\x20created','Failed\x20login\x20attempt','Error\x20handling\x20/debug\x20command:','sendShopNotification','customerName','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','`\x20not\x20found.\x0a\x0a','`\x20is\x20inactive.\x0a\x0a','Contact\x20administrator.','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','TELEGRAM_BOT_USERNAME','6ECXhiK','📧\x20Email:\x20`','User\x20','👤\x20Username:\x20`','sk_','name','Example:\x0a','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','2706628SSKMhh','ACTIVE','pk_','*\x0a\x0a','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','\x20\x20\x20Public\x20Key:\x20`','Payout\x20completed','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','/status\x20-\x20check\x20connection\x20status\x0a','🔔\x20You\x20receive\x20notifications\x20about:\x0a','📱\x20Your\x20Telegram\x20ID:\x20`','remitterIban','\x20verified\x20for\x20shop\x20','1788540DcqNMc','57390QKcXoi','../types/gateway','Use\x20/start\x20to\x20begin.','\x22,\x20apiKey=\x22','update','unknown\x20shop','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','ipAddress','currency','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','warn','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','amount','error','Use\x20/start\x20to\x20connect.','from','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','sendMessage','🌐\x20IP:\x20`','allSettled','New\x20payout\x20created','getBotInfo','endpoint','success','🆔\x20Payment\x20ID:\x20`','❌\x20Shop\x20with\x20username\x20`','Error\x20handling\x20/start\x20command:','Failed\x20to\x20send\x20login\x20notification:','log','Payment\x20is\x20being\x20processed','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','botToken','defineProperty','20wnsGIc','forEach','entries','8221644xkCESf','6XxGfYX','requestId','🏦\x20Method:\x20`','gateway','...\x22','telegramBotService','...`\x0a\x0a','isVerified','trim','blocked','✅\x20Connected\x20to\x20shop:\x20*','You\x20sent\x20','publicKey','•\x20Payouts\x0a','\x20(@','Available\x20usernames:\x0a','Check\x20spelling\x20and\x20try\x20again.','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','🔔\x20*','📅\x20Connection\x20date:\x20','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','telegramId','Markdown','method','default','•\x20New\x20payments\x0a','errorMessage','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','initializeBot','🆔\x20Payout\x20ID:\x20`','\x20\x20\x20Username:\x20`','❌\x20Invalid\x20username\x20format:\x20`','sendCustomNotification','chat','💻\x20Browser:\x20`','Payment\x20failed','1664466sWcuZn','shopId','chargebackAmount','Error\x20handling\x20message:','findFirst','substring','🏪\x20Gateway:\x20`','sendLoginNotification','stopBot','📅\x20Date:\x20','🎉\x20*Congratulations!*\x0a\x0a','updatedAt','adminNotes','node-telegram-bot-api'];a58_0x182d=function(){return _0xe1b21c;};return a58_0x182d();}(function(_0x5215d4,_0x5071fc){const _0xb268bf=a58_0x337f,_0x103727=_0x5215d4();while(!![]){try{const _0x2330ed=-parseInt(_0xb268bf(0x127))/0x1*(parseInt(_0xb268bf(0x13e))/0x2)+-parseInt(_0xb268bf(0x165))/0x3*(parseInt(_0xb268bf(0x130))/0x4)+-parseInt(_0xb268bf(0x13d))/0x5+parseInt(_0xb268bf(0xa2))/0x6*(parseInt(_0xb268bf(0x11a))/0x7)+parseInt(_0xb268bf(0xc9))/0x8+parseInt(_0xb268bf(0x164))/0x9*(parseInt(_0xb268bf(0x161))/0xa)+-parseInt(_0xb268bf(0xd4))/0xb*(parseInt(_0xb268bf(0xd1))/0xc);if(_0x2330ed===_0x5071fc)break;else _0x103727['push'](_0x103727['shift']());}catch(_0xf07453){_0x103727['push'](_0x103727['shift']());}}}(a58_0x182d,0xe6af0));function a58_0x337f(_0x30f42f,_0x217f68){const _0x182d08=a58_0x182d();return a58_0x337f=function(_0x337f5a,_0x42fd50){_0x337f5a=_0x337f5a-0xa2;let _0x207ed9=_0x182d08[_0x337f5a];return _0x207ed9;},a58_0x337f(_0x30f42f,_0x217f68);}var __importDefault=this&&this['__importDefault']||function(_0x17dc4a){const _0x1ec466=a58_0x337f;return _0x17dc4a&&_0x17dc4a[_0x1ec466(0xbf)]?_0x17dc4a:{'default':_0x17dc4a};};Object[a58_0x1a2139(0x160)](exports,a58_0x1a2139(0xbf),{'value':!![]}),exports['telegramBotService']=exports[a58_0x1a2139(0xe5)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a58_0x1a2139(0xaf))),database_1=__importDefault(require('../config/database')),gateway_1=require(a58_0x1a2139(0x13f));class TelegramBotService{constructor(){const _0x1e967b=a58_0x1a2139;this[_0x1e967b(0xd3)]=null,this[_0x1e967b(0x15f)]=process[_0x1e967b(0xfa)]['TELEGRAM_BOT_TOKEN']||'',this[_0x1e967b(0xeb)]=process['env'][_0x1e967b(0x126)]||_0x1e967b(0xf3),this[_0x1e967b(0x15f)]?this[_0x1e967b(0x182)]():console[_0x1e967b(0x148)](_0x1e967b(0x144));}[a58_0x1a2139(0x182)](){const _0x355f77=a58_0x1a2139;try{this['bot']=new node_telegram_bot_api_1[(_0x355f77(0x17e))](this[_0x355f77(0x15f)],{'polling':!![]}),this[_0x355f77(0xcb)](),console['log'](_0x355f77(0x110)+this[_0x355f77(0xeb)]+'\x20initialized\x20successfully');}catch(_0x2bdef5){console[_0x355f77(0x14b)](_0x355f77(0x181),_0x2bdef5);}}['setupBotHandlers'](){const _0x1925ed=a58_0x1a2139;if(!this[_0x1925ed(0xd3)])return;this[_0x1925ed(0xd3)][_0x1925ed(0xb0)](/\/start/,async _0x46b59f=>{const _0x5afa70=_0x1925ed,_0x503a21=_0x46b59f[_0x5afa70(0x187)]['id'],_0x5a93d9=_0x46b59f['from']?.['id'][_0x5afa70(0xb9)](),_0x5b458f=_0x46b59f[_0x5afa70(0x14d)]?.['username'],_0x30fe18=_0x46b59f[_0x5afa70(0x14d)]?.['first_name'],_0x558639=_0x46b59f['from']?.['last_name'];if(!_0x5a93d9)return;try{let _0x3ae7c8=await database_1[_0x5afa70(0x17e)][_0x5afa70(0xc4)]['findUnique']({'where':{'telegramId':_0x5a93d9},'include':{'shop':!![]}});!_0x3ae7c8?(_0x3ae7c8=await database_1[_0x5afa70(0x17e)]['telegramUser'][_0x5afa70(0xb3)]({'data':{'telegramId':_0x5a93d9,'username':_0x5b458f,'firstName':_0x30fe18,'lastName':_0x558639,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x5afa70(0x15a)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x5a93d9+_0x5afa70(0x173)+_0x5b458f+')')):_0x3ae7c8=await database_1[_0x5afa70(0x17e)][_0x5afa70(0xc4)]['update']({'where':{'telegramId':_0x5a93d9},'data':{'username':_0x5b458f,'firstName':_0x30fe18,'lastName':_0x558639},'include':{'shop':!![]}}),_0x3ae7c8[_0x5afa70(0x16c)]&&_0x3ae7c8[_0x5afa70(0xa3)]&&_0x3ae7c8[_0x5afa70(0x106)]?await this['bot']?.['sendMessage'](_0x503a21,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x5afa70(0x134)+_0x3ae7c8[_0x5afa70(0x106)][_0x5afa70(0x12c)]+'*\x0a')+('Username:\x20`'+_0x3ae7c8[_0x5afa70(0x106)][_0x5afa70(0x107)]+'`\x0a\x0a')+_0x5afa70(0x139)+_0x5afa70(0x17f)+_0x5afa70(0x105)+_0x5afa70(0xd2)+_0x5afa70(0xf7)+_0x5afa70(0x138)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x5afa70(0x17c)}):(_0x3ae7c8[_0x5afa70(0xa3)]&&!_0x3ae7c8[_0x5afa70(0x16c)]&&(await database_1['default'][_0x5afa70(0xc4)][_0x5afa70(0x142)]({'where':{'telegramId':_0x5a93d9},'data':{'shopId':null,'isVerified':![]}}),console[_0x5afa70(0x15a)](_0x5afa70(0x114)+_0x5a93d9)),await this['bot']?.[_0x5afa70(0x14f)](_0x503a21,_0x5afa70(0x109)+_0x5afa70(0x177)+_0x5afa70(0x121)+_0x5afa70(0x12d)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x5afa70(0xc2),{'parse_mode':'Markdown'}));}catch(_0x40d76d){console['error'](_0x5afa70(0x158),_0x40d76d),await this['bot']?.[_0x5afa70(0x14f)](_0x503a21,_0x5afa70(0x17a));}}),this[_0x1925ed(0xd3)]['onText'](/\/disconnect/,async _0x4bc671=>{const _0x11a912=_0x1925ed,_0x58bc9e=_0x4bc671[_0x11a912(0x187)]['id'],_0x1c2669=_0x4bc671[_0x11a912(0x14d)]?.['id'][_0x11a912(0xb9)]();if(!_0x1c2669)return;try{const _0x18b775=await database_1['default'][_0x11a912(0xc4)][_0x11a912(0xd6)]({'where':{'telegramId':_0x1c2669},'include':{'shop':!![]}});if(!_0x18b775||!_0x18b775['isVerified']||!_0x18b775['shopId']){await this['bot']?.[_0x11a912(0x14f)](_0x58bc9e,_0x11a912(0x12f));return;}const _0x56c6be=_0x18b775[_0x11a912(0x106)]?.[_0x11a912(0x12c)]||_0x11a912(0x143);await database_1[_0x11a912(0x17e)][_0x11a912(0xc4)]['update']({'where':{'telegramId':_0x1c2669},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x11a912(0xbc)+_0x1c2669+'\x20disconnected\x20from\x20shop\x20'+_0x18b775[_0x11a912(0xa3)]),await this[_0x11a912(0xd3)]?.['sendMessage'](_0x58bc9e,_0x11a912(0x15e)+_0x56c6be+_0x11a912(0xed)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x11a912(0x17c)});}catch(_0x4075d5){console[_0x11a912(0x14b)](_0x11a912(0xff),_0x4075d5),await this[_0x11a912(0xd3)]?.[_0x11a912(0x14f)](_0x58bc9e,_0x11a912(0x17a));}}),this['bot'][_0x1925ed(0xb0)](/\/status/,async _0xf3147c=>{const _0x3a08d3=_0x1925ed,_0x254a1f=_0xf3147c['chat']['id'],_0xa87f4d=_0xf3147c['from']?.['id'][_0x3a08d3(0xb9)]();if(!_0xa87f4d)return;try{const _0x17aa22=await database_1['default']['telegramUser'][_0x3a08d3(0xd6)]({'where':{'telegramId':_0xa87f4d},'include':{'shop':!![]}});if(!_0x17aa22){await this['bot']?.[_0x3a08d3(0x14f)](_0x254a1f,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x3a08d3(0x140));return;}if(!_0x17aa22[_0x3a08d3(0x16c)]||!_0x17aa22['shopId']||!_0x17aa22[_0x3a08d3(0x106)]){await this['bot']?.[_0x3a08d3(0x14f)](_0x254a1f,_0x3a08d3(0xe6)+_0x3a08d3(0x14c));return;}await this[_0x3a08d3(0xd3)]?.['sendMessage'](_0x254a1f,_0x3a08d3(0xef)+(_0x3a08d3(0x16f)+_0x17aa22[_0x3a08d3(0x106)]['name']+'*\x0a')+(_0x3a08d3(0x12a)+_0x17aa22[_0x3a08d3(0x106)][_0x3a08d3(0x107)]+'`\x0a')+(_0x3a08d3(0x179)+_0x17aa22[_0x3a08d3(0xad)]['toLocaleDateString'](_0x3a08d3(0xdf))+'\x0a\x0a')+_0x3a08d3(0xc1)+_0x3a08d3(0xf7)+_0x3a08d3(0x115),{'parse_mode':_0x3a08d3(0x17c)});}catch(_0x1bd57d){console[_0x3a08d3(0x14b)](_0x3a08d3(0x119),_0x1bd57d),await this[_0x3a08d3(0xd3)]?.['sendMessage'](_0x254a1f,_0x3a08d3(0x17a));}}),this[_0x1925ed(0xd3)][_0x1925ed(0xb0)](/\/debug/,async _0x24908b=>{const _0x1f199f=_0x1925ed,_0x2c5fed=_0x24908b[_0x1f199f(0x187)]['id'],_0x2dfa3a=_0x24908b['from']?.['id'][_0x1f199f(0xb9)]();if(!_0x2dfa3a)return;try{const _0x1f01d9=await database_1[_0x1f199f(0x17e)][_0x1f199f(0x106)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x3113eb=_0x1f199f(0x117);_0x3113eb+=_0x1f199f(0x13a)+_0x2dfa3a+_0x1f199f(0xf2),_0x3113eb+=_0x1f199f(0xf8),_0x1f01d9[_0x1f199f(0x162)]((_0x106a2f,_0x485860)=>{const _0x58b648=_0x1f199f;_0x3113eb+=_0x485860+0x1+_0x58b648(0x104)+_0x106a2f['name']+'*\x0a',_0x3113eb+=_0x58b648(0x184)+_0x106a2f[_0x58b648(0x107)]+'`\x0a',_0x3113eb+='\x20\x20\x20Status:\x20'+_0x106a2f[_0x58b648(0xdd)]+'\x0a',_0x3113eb+=_0x58b648(0x135)+_0x106a2f[_0x58b648(0x171)][_0x58b648(0xa7)](0x0,0xf)+_0x58b648(0x16b);}),await this[_0x1f199f(0xd3)]?.[_0x1f199f(0x14f)](_0x2c5fed,_0x3113eb,{'parse_mode':_0x1f199f(0x17c)});}catch(_0x28418c){console[_0x1f199f(0x14b)](_0x1f199f(0x11e),_0x28418c),await this[_0x1f199f(0xd3)]?.[_0x1f199f(0x14f)](_0x2c5fed,'❌\x20Error\x20getting\x20debug\x20information.');}}),this[_0x1925ed(0xd3)]['on'](_0x1925ed(0xd0),async _0x5e0177=>{const _0x385976=_0x1925ed;if(_0x5e0177['text']?.['startsWith']('/'))return;const _0x84dfb9=_0x5e0177[_0x385976(0x187)]['id'],_0x48821a=_0x5e0177[_0x385976(0x14d)]?.['id'][_0x385976(0xb9)](),_0x27cf80=_0x5e0177['text']?.[_0x385976(0x16d)]();if(!_0x48821a||!_0x27cf80)return;try{const _0x8ef489=await database_1[_0x385976(0x17e)][_0x385976(0xc4)][_0x385976(0xd6)]({'where':{'telegramId':_0x48821a},'include':{'shop':!![]}});if(!_0x8ef489){await this[_0x385976(0xd3)]?.[_0x385976(0x14f)](_0x84dfb9,_0x385976(0xf4));return;}if(_0x8ef489[_0x385976(0x16c)]&&_0x8ef489['shopId']&&_0x8ef489['shop']){await this[_0x385976(0xd3)]?.[_0x385976(0x14f)](_0x84dfb9,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x8ef489[_0x385976(0x106)][_0x385976(0x12c)]+_0x385976(0xed)+_0x385976(0xc3),{'parse_mode':'Markdown'});return;}const _0x31a893=_0x27cf80['split'](/\s+/);if(_0x31a893['length']!==0x2){await this['bot']?.[_0x385976(0x14f)](_0x84dfb9,_0x385976(0x15c)+_0x385976(0x121)+'Example:\x0a'+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x385976(0x170)+_0x31a893[_0x385976(0xf0)]+_0x385976(0xb7)+_0x31a893['map'](_0x50ff01=>'`'+_0x50ff01+'`')['join'](',\x20')),{'parse_mode':_0x385976(0x17c)});return;}const [_0x596d5f,_0x1e9b60]=_0x31a893;console[_0x385976(0x15a)](_0x385976(0x137)+_0x48821a+_0x385976(0xc5)+_0x596d5f+'\x22,\x20apiKey=\x22'+_0x1e9b60[_0x385976(0xa7)](0x0,0xa)+_0x385976(0x169)),await this[_0x385976(0x118)](_0x84dfb9,_0x48821a,_0x596d5f,_0x1e9b60);}catch(_0x3f0871){console[_0x385976(0x14b)](_0x385976(0xa5),_0x3f0871),await this[_0x385976(0xd3)]?.['sendMessage'](_0x84dfb9,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['on'](_0x1925ed(0x14b),_0x257c0d=>{const _0x4759f0=_0x1925ed;console[_0x4759f0(0x14b)](_0x4759f0(0xe0),_0x257c0d);}),this[_0x1925ed(0xd3)]['on']('polling_error',_0x216e42=>{const _0x157257=_0x1925ed;console[_0x157257(0x14b)](_0x157257(0xc6),_0x216e42);});}async['handleSingleLineVerification'](_0x20d997,_0x1099bd,_0x42a7c4,_0x10cc35){const _0x470dc1=a58_0x1a2139;try{console[_0x470dc1(0x15a)](_0x470dc1(0x137)+_0x1099bd+_0x470dc1(0xc5)+_0x42a7c4+_0x470dc1(0x141)+_0x10cc35[_0x470dc1(0xa7)](0x0,0xa)+_0x470dc1(0x169));if(!_0x42a7c4||_0x42a7c4[_0x470dc1(0xf0)]<0x3||_0x42a7c4[_0x470dc1(0xf0)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x470dc1(0xfd)](_0x42a7c4)){await this[_0x470dc1(0xd3)]?.[_0x470dc1(0x14f)](_0x20d997,_0x470dc1(0x185)+_0x42a7c4+_0x470dc1(0xf2)+_0x470dc1(0xee),{'parse_mode':_0x470dc1(0x17c)});return;}if(!_0x10cc35||!_0x10cc35[_0x470dc1(0xf5)](_0x470dc1(0x132))&&!_0x10cc35['startsWith'](_0x470dc1(0x12b))){await this[_0x470dc1(0xd3)]?.['sendMessage'](_0x20d997,_0x470dc1(0x176)+_0x470dc1(0xd9),{'parse_mode':'Markdown'});return;}const _0xdf7ee0=await database_1[_0x470dc1(0x17e)][_0x470dc1(0x106)][_0x470dc1(0xd6)]({'where':{'username':_0x42a7c4},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0xdf7ee0){const _0x5e55e2=await database_1[_0x470dc1(0x17e)][_0x470dc1(0x106)][_0x470dc1(0xc0)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x195622=_0x470dc1(0x157)+_0x42a7c4+_0x470dc1(0x122);_0x5e55e2[_0x470dc1(0xf0)]>0x0?(_0x195622+=_0x470dc1(0x174),_0x5e55e2[_0x470dc1(0x162)](_0x166dc9=>{const _0x1a817b=_0x470dc1;_0x195622+='•\x20`'+_0x166dc9[_0x1a817b(0x107)]+_0x1a817b(0x111)+_0x166dc9[_0x1a817b(0x12c)]+')\x0a';}),_0x195622+=_0x470dc1(0xd5)):_0x195622+=_0x470dc1(0x175);await this[_0x470dc1(0xd3)]?.[_0x470dc1(0x14f)](_0x20d997,_0x195622,{'parse_mode':_0x470dc1(0x17c)});return;}if(_0xdf7ee0['status']!==_0x470dc1(0x131)){await this[_0x470dc1(0xd3)]?.[_0x470dc1(0x14f)](_0x20d997,_0x470dc1(0xd8)+_0x42a7c4+_0x470dc1(0x123)+_0x470dc1(0x124),{'parse_mode':_0x470dc1(0x17c)});return;}if(_0xdf7ee0[_0x470dc1(0x171)]!==_0x10cc35&&_0xdf7ee0['secretKey']!==_0x10cc35){await this[_0x470dc1(0xd3)]?.[_0x470dc1(0x14f)](_0x20d997,_0x470dc1(0x12e)+_0x42a7c4+_0x470dc1(0xde)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':'Markdown'});return;}const _0xc00eff=await database_1[_0x470dc1(0x17e)][_0x470dc1(0xc4)][_0x470dc1(0xa6)]({'where':{'shopId':_0xdf7ee0['id'],'isVerified':!![],'telegramId':{'not':_0x1099bd}}});if(_0xc00eff){await this[_0x470dc1(0xd3)]?.['sendMessage'](_0x20d997,_0x470dc1(0x10f)+_0x42a7c4+_0x470dc1(0xde)+_0x470dc1(0x147),{'parse_mode':_0x470dc1(0x17c)});return;}await database_1[_0x470dc1(0x17e)][_0x470dc1(0xc4)][_0x470dc1(0x142)]({'where':{'telegramId':_0x1099bd},'data':{'shopId':_0xdf7ee0['id'],'isVerified':!![]}}),await this[_0x470dc1(0xd3)]?.[_0x470dc1(0x14f)](_0x20d997,_0x470dc1(0xac)+_0x470dc1(0x125)+(_0x470dc1(0xdc)+_0xdf7ee0[_0x470dc1(0x12c)]+'*\x0a')+(_0x470dc1(0x12a)+_0xdf7ee0[_0x470dc1(0x107)]+_0x470dc1(0xf2))+_0x470dc1(0x108)+_0x470dc1(0x17f)+'•\x20Payment\x20status\x20changes\x0a'+_0x470dc1(0x172)+_0x470dc1(0xbd)+_0x470dc1(0xf7)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x470dc1(0x115),{'parse_mode':_0x470dc1(0x17c)}),console[_0x470dc1(0x15a)](_0x470dc1(0x101)+_0x1099bd+_0x470dc1(0x13c)+_0xdf7ee0[_0x470dc1(0x107)]+_0x470dc1(0xcf));}catch(_0x307719){console[_0x470dc1(0x14b)]('Error\x20in\x20handleSingleLineVerification:',_0x307719),await this[_0x470dc1(0xd3)]?.[_0x470dc1(0x14f)](_0x20d997,_0x470dc1(0xcd));}}async[a58_0x1a2139(0x11f)](_0x556f2b,_0x38ce2a,_0x595070){const _0x3d3e29=a58_0x1a2139;if(!this[_0x3d3e29(0xd3)]){console[_0x3d3e29(0x148)](_0x3d3e29(0xdb));return;}try{const _0x282d3a=await database_1[_0x3d3e29(0x17e)][_0x3d3e29(0xc4)][_0x3d3e29(0xc0)]({'where':{'shopId':_0x556f2b,'isVerified':!![]}});if(_0x282d3a[_0x3d3e29(0xf0)]===0x0){console[_0x3d3e29(0x15a)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x556f2b);return;}const _0x3f938b=_0x282d3a[_0x3d3e29(0xfb)](async _0x18e482=>{const _0x8d6795=_0x3d3e29;try{await this[_0x8d6795(0xd3)]?.[_0x8d6795(0x14f)](_0x18e482[_0x8d6795(0x17b)],_0x38ce2a,_0x595070),console['log']('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x18e482[_0x8d6795(0x17b)]);}catch(_0x1017d7){console['error'](_0x8d6795(0x14e)+_0x18e482['telegramId']+':',_0x1017d7),_0x1017d7 instanceof Error&&(_0x1017d7[_0x8d6795(0xd0)][_0x8d6795(0xc7)](_0x8d6795(0x16e))||_0x1017d7['message'][_0x8d6795(0xc7)]('chat\x20not\x20found')||_0x1017d7['message'][_0x8d6795(0xc7)](_0x8d6795(0x10b)))&&(await database_1[_0x8d6795(0x17e)][_0x8d6795(0xc4)][_0x8d6795(0x142)]({'where':{'id':_0x18e482['id']},'data':{'isVerified':![]}}),console['log'](_0x8d6795(0x129)+_0x18e482[_0x8d6795(0x17b)]+_0x8d6795(0x103)));}});await Promise[_0x3d3e29(0x151)](_0x3f938b);}catch(_0x3ee81b){console['error'](_0x3d3e29(0x10c),_0x3ee81b);}}async['sendPaymentNotification'](_0x507c3b,_0x446ccd,_0x581a4d){const _0x1c9295=a58_0x1a2139,_0xbb6e42={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x435f01={'created':_0x1c9295(0x11c),'paid':_0x1c9295(0xb6),'failed':_0x1c9295(0x189),'expired':_0x1c9295(0xfc),'refund':'Payment\x20refund','chargeback':_0x1c9295(0xb1),'processing':_0x1c9295(0x15b)},_0xa6ceee=_0xbb6e42[_0x581a4d],_0xf350b2=_0x435f01[_0x581a4d],_0x1d601e=(0x0,gateway_1[_0x1c9295(0x10e)])(_0x446ccd[_0x1c9295(0x168)]);console[_0x1c9295(0x15a)](_0x1c9295(0x113)+_0x446ccd[_0x1c9295(0x168)]+_0x1c9295(0x100)+_0x1d601e+'\x22');let _0x22c557=_0xa6ceee+'\x20*'+_0xf350b2+_0x1c9295(0x133)+(_0x1c9295(0xda)+_0x446ccd['amount']+'\x20'+_0x446ccd[_0x1c9295(0x146)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x446ccd[_0x1c9295(0x10a)]||_0x446ccd['id'])+'`\x0a')+(_0x1c9295(0x156)+_0x446ccd['id']+'`\x0a')+(_0x1c9295(0xa8)+_0x1d601e+'`\x0a')+(_0x1c9295(0xab)+new Date(_0x446ccd[_0x1c9295(0xe4)])[_0x1c9295(0xc8)](_0x1c9295(0xdf))+'\x0a');if(_0x446ccd[_0x1c9295(0x120)]||_0x446ccd['customerEmail']||_0x446ccd[_0x1c9295(0x13b)]||_0x446ccd[_0x1c9295(0xcc)]||_0x446ccd[_0x1c9295(0xb2)]){_0x22c557+=_0x1c9295(0xb8);_0x446ccd[_0x1c9295(0x120)]&&(_0x22c557+=_0x1c9295(0xea)+_0x446ccd[_0x1c9295(0x120)]+'`\x0a');_0x446ccd[_0x1c9295(0xf1)]&&(_0x22c557+=_0x1c9295(0x128)+_0x446ccd['customerEmail']+'`\x0a');_0x446ccd[_0x1c9295(0x13b)]&&(_0x22c557+=_0x1c9295(0xb4)+_0x446ccd[_0x1c9295(0x13b)]+'`\x0a');_0x446ccd['customerIp']&&(_0x22c557+=_0x1c9295(0x150)+_0x446ccd[_0x1c9295(0xcc)]+'`\x0a');if(_0x446ccd[_0x1c9295(0xb2)]){const _0xc6f2ba=_0x446ccd[_0x1c9295(0xb2)][_0x1c9295(0xf0)]>0x32?_0x446ccd[_0x1c9295(0xb2)][_0x1c9295(0xa7)](0x0,0x32)+_0x1c9295(0xf6):_0x446ccd[_0x1c9295(0xb2)];_0x22c557+=_0x1c9295(0x188)+_0xc6f2ba+'`\x0a';}}_0x581a4d==='chargeback'&&_0x446ccd[_0x1c9295(0xa4)]&&(_0x22c557+=_0x1c9295(0xe3)+_0x446ccd[_0x1c9295(0xa4)]+_0x1c9295(0xe2)),_0x581a4d==='processing'&&(_0x22c557+=_0x1c9295(0x112)),_0x446ccd['adminNotes']&&(_0x22c557+=_0x1c9295(0xbe)+_0x446ccd[_0x1c9295(0xae)]+'\x0a'),await this['sendShopNotification'](_0x507c3b,_0x22c557,{'parse_mode':'Markdown'});}async['sendPayoutNotification'](_0x4327e1,_0x157add,_0x13ebbb){const _0x160555=a58_0x1a2139,_0x5d92dc={'created':'📤','completed':'✅','rejected':'❌'},_0x148949={'created':_0x160555(0x152),'completed':_0x160555(0x136),'rejected':_0x160555(0x10d)},_0x51f75d=_0x5d92dc[_0x13ebbb],_0x1c6c6c=_0x148949[_0x13ebbb],_0x1d23d0=_0x51f75d+'\x20*'+_0x1c6c6c+_0x160555(0x133)+(_0x160555(0xce)+_0x157add[_0x160555(0x14a)]+_0x160555(0xf9))+(_0x160555(0x167)+_0x157add[_0x160555(0x17d)]+'`\x0a')+(_0x160555(0x183)+_0x157add['id']+'`\x0a')+(_0x160555(0xab)+new Date(_0x157add[_0x160555(0xe4)])[_0x160555(0xc8)]('en-US')+'\x0a')+(_0x157add['txid']?'🔗\x20TXID:\x20`'+_0x157add['txid']+'`':'');await this[_0x160555(0x11f)](_0x4327e1,_0x1d23d0,{'parse_mode':_0x160555(0x17c)});}async[a58_0x1a2139(0xa9)](_0x423ca1,_0x26e18f){const _0x4f3cd3=a58_0x1a2139;try{const _0x58e9d2=await database_1[_0x4f3cd3(0x17e)]['shopSettings'][_0x4f3cd3(0xd6)]({'where':{'shopId':_0x423ca1},'select':{'notificationLogin':!![]}});if(!_0x58e9d2?.[_0x4f3cd3(0xbb)]){console['log'](_0x4f3cd3(0xb5)+_0x423ca1);return;}const _0x205a60=_0x26e18f[_0x4f3cd3(0x155)]?'🔐':'🚨',_0x4eb6f4=_0x26e18f[_0x4f3cd3(0x155)]?_0x4f3cd3(0xba):_0x4f3cd3(0x11d);let _0x5c0fd2=_0x205a60+'\x20*'+_0x4eb6f4+'*\x0a\x0a'+(_0x4f3cd3(0x12a)+_0x26e18f[_0x4f3cd3(0x107)]+'`\x0a')+(_0x4f3cd3(0xe7)+_0x26e18f['timestamp'][_0x4f3cd3(0xc8)]('en-US')+'\x0a');_0x26e18f[_0x4f3cd3(0x145)]&&(_0x5c0fd2+=_0x4f3cd3(0xe1)+_0x26e18f[_0x4f3cd3(0x145)]+'`\x0a');if(_0x26e18f[_0x4f3cd3(0xfe)]){const _0x253fa3=_0x26e18f['userAgent'][_0x4f3cd3(0xf0)]>0x32?_0x26e18f[_0x4f3cd3(0xfe)][_0x4f3cd3(0xa7)](0x0,0x32)+_0x4f3cd3(0xf6):_0x26e18f[_0x4f3cd3(0xfe)];_0x5c0fd2+=_0x4f3cd3(0x188)+_0x253fa3+'`\x0a';}!_0x26e18f[_0x4f3cd3(0x155)]&&(_0x5c0fd2+=_0x4f3cd3(0x15d)),await this[_0x4f3cd3(0x11f)](_0x423ca1,_0x5c0fd2,{'parse_mode':_0x4f3cd3(0x17c)}),console[_0x4f3cd3(0x15a)](_0x4f3cd3(0x149)+_0x423ca1+':\x20'+(_0x26e18f[_0x4f3cd3(0x155)]?_0x4f3cd3(0x155):_0x4f3cd3(0xca)));}catch(_0x3fb25f){console[_0x4f3cd3(0x14b)](_0x4f3cd3(0x159),_0x3fb25f);}}async[a58_0x1a2139(0xec)](_0x41930d,_0x1b2b57){const _0xd29e5=a58_0x1a2139;try{const _0x3d10fc=await database_1[_0xd29e5(0x17e)]['shopSettings'][_0xd29e5(0xd6)]({'where':{'shopId':_0x41930d},'select':{'notificationApiError':!![]}});if(!_0x3d10fc?.['notificationApiError']){console[_0xd29e5(0x15a)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x41930d);return;}let _0x309c4b=_0xd29e5(0xe9)+('🔗\x20Endpoint:\x20`'+_0x1b2b57[_0xd29e5(0x17d)]+'\x20'+_0x1b2b57[_0xd29e5(0x154)]+'`\x0a')+(_0xd29e5(0xe7)+_0x1b2b57[_0xd29e5(0xd7)]['toLocaleString'](_0xd29e5(0xdf))+'\x0a');_0x1b2b57['statusCode']&&(_0x309c4b+='📊\x20Error\x20code:\x20`'+_0x1b2b57[_0xd29e5(0x102)]+'`\x0a'),_0x309c4b+=_0xd29e5(0x11b)+_0x1b2b57[_0xd29e5(0x180)]+'`\x0a',_0x1b2b57[_0xd29e5(0x166)]&&(_0x309c4b+='🆔\x20Request\x20ID:\x20`'+_0x1b2b57[_0xd29e5(0x166)]+'`\x0a'),_0x309c4b+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0xd29e5(0x11f)](_0x41930d,_0x309c4b,{'parse_mode':'Markdown'}),console[_0xd29e5(0x15a)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x41930d+':\x20'+_0x1b2b57['endpoint']);}catch(_0x1f7f12){console[_0xd29e5(0x14b)](_0xd29e5(0x116),_0x1f7f12);}}async[a58_0x1a2139(0x186)](_0x85e67b,_0x27794c,_0x1b3c7b){const _0xa06d5c=a58_0x1a2139;let _0x4e7b27=_0xa06d5c(0x178)+_0x27794c+_0xa06d5c(0x133);for(const [_0x26c4cf,_0x13593a]of Object[_0xa06d5c(0x163)](_0x1b3c7b)){_0x13593a!==null&&_0x13593a!==undefined&&(_0x4e7b27+=_0x26c4cf+_0xa06d5c(0xe8)+_0x13593a+'`\x0a');}await this[_0xa06d5c(0x11f)](_0x85e67b,_0x4e7b27,{'parse_mode':_0xa06d5c(0x17c)});}[a58_0x1a2139(0x153)](){const _0x298992=a58_0x1a2139;return{'isActive':!!this[_0x298992(0xd3)],'username':this[_0x298992(0xeb)]};}[a58_0x1a2139(0xaa)](){const _0x505e81=a58_0x1a2139;this[_0x505e81(0xd3)]&&(this['bot']['stopPolling'](),this['bot']=null,console[_0x505e81(0x15a)]('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a58_0x1a2139(0xe5)]=TelegramBotService,exports[a58_0x1a2139(0x16a)]=new TelegramBotService();