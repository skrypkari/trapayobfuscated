'use strict';function a66_0x359e(_0x38e448,_0x55fe8d){const _0x2139ba=a66_0x2139();return a66_0x359e=function(_0x359e3e,_0x1291da){_0x359e3e=_0x359e3e-0xd4;let _0xfc8ee8=_0x2139ba[_0x359e3e];return _0xfc8ee8;},a66_0x359e(_0x38e448,_0x55fe8d);}function a66_0x2139(){const _0x57538e=['bot','1227HFtHMI','split','shopId','Commands:\x0a','🔗\x20*Transaction\x20Link:*\x20Pending','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','🔍\x20*Debug\x20Information*\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','stopBot','getGatewayDisplayNameForTelegram','telegramId','map','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','Not\x20specified','\x22,\x20apiKey=\x22','image/png','startsWith','substring','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','notificationLogin','default','period','`\x20is\x20inactive.\x0a\x0a','You\x20sent\x20','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','requestId','findMany','🔔\x20Notifications\x20are\x20active\x0a\x0a','💰\x20*Amount:*\x20','blocked','`.\x0a\x0a','image/jpeg','Error\x20handling\x20/debug\x20command:','📅\x20Time:\x20','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','text','⏱️\x20*Period:*\x20','User\x20','sendPayoutNotification','\x22\x20->\x20display\x20\x22','🆔\x20Request\x20ID:\x20`','trapay_bot','\x20parts:\x20','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','message','Contact\x20administrator.','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','customerName','processing','\x20disconnected\x20from\x20shop\x20','username','🔔\x20*','application/octet-stream','✅\x20Connected\x20to\x20shop:\x20*','✅\x20Telegram\x20bot\x20@','🏦\x20IBAN:\x20`','includes','botUsername',':\x20username=\x22','448370YlVPAH','❌\x20Shop\x20with\x20username\x20`','sendShopNotification','🎉\x20*Congratulations!*\x0a\x0a','notificationApiError','shop','📝\x20Notes:\x20','10665480RQQFjK','unknown\x20shop','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','Payment\x20expired','/disconnect\x20-\x20disconnect\x20from\x20notifications','telegramBotService','\x20\x20\x20Name:\x20*','customerIp','🌐\x20IP:\x20`','💸\x20Penalty\x20amount:\x20*','setupBotHandlers','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.','📱\x20Shop:\x20*','first_name','Error\x20handling\x20/status\x20command:','geo','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','📧\x20Email:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a','userAgent','3391344bvHMZG','adminNotes','stopPolling','\x20(@','sk_','📱\x20Telegram\x20notification:\x20gateway\x20\x22','📅\x20*Payout\x20Date:*\x20','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','amount','...\x22','initializeBot','sendDirectFile','trim','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','\x20users','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','`\x20not\x20found.\x0a\x0a','createdAt','user\x20is\x20deactivated','Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.','📊\x20*Connection\x20Status*\x0a\x0a','\x20verified\x20for\x20shop\x20','length','🔗\x20Endpoint:\x20`','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','publicKey','🏪\x20Gateway:\x20`','To\x20reconnect,\x20use\x20the\x20/start\x20command','📱\x20No\x20active\x20Telegram\x20users\x20found','endpoint','error','warn','.png','polling_error','TelegramBotService','Markdown','Payment\x20refund','success','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','✅\x20File\x20sent\x20to\x20chat\x20','🔗\x20*Transaction\x20Link:*\x20`','gateway','❌\x20Error\x20sending\x20direct\x20message:','11CCdLSV','•\x20Payouts\x0a\x0a','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','🚨\x20*API\x20Error*\x0a\x0a','•\x20New\x20payments\x0a','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','❌\x20Error\x20sending\x20file\x20to\x20shop:','2-digit','Payment\x20chargeback','TELEGRAM_BOT_TOKEN','*\x0a\x0a','node-telegram-bot-api','endsWith','Payment\x20failed','update','allSettled','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','💰\x20Amount:\x20*','sendApiErrorNotification','🌍\x20Country:\x20','❌\x20Error\x20sending\x20file\x20to\x20chat:','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','timestamp','failed','shopSettings','Payment\x20is\x20being\x20processed','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','\x20users\x20of\x20shop\x20','toString','sendMessage','Telegram\x20bot\x20polling\x20error:','__importDefault','customerUa','2912337BERjZI','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','28OcKEZx','Error\x20handling\x20/start\x20command:','❌\x20Error\x20getting\x20debug\x20information.','•\x20Payouts\x0a','Use\x20/start\x20to\x20connect.','🔌\x20User\x20','*.\x0a\x0a','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','✅\x20Telegram\x20user\x20',':\x20`','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','•\x20Payment\x20status\x20changes\x0a','📅\x20Date:\x20','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','💻\x20Browser:\x20`','../types/gateway','256664XrQvLu','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','handleSingleLineVerification','Use\x20/start\x20to\x20begin.','New\x20payment\x20created','.jpeg','chat','Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a','📅\x20Connection\x20date:\x20','customerEmail','❌\x20Please\x20use\x20/start\x20command\x20first','14BziQra','ipAddress','726CejxFV','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','status','❌\x20Telegram\x20bot\x20not\x20initialized','getBotInfo','/status\x20-\x20check\x20connection\x20status\x0a','Telegram\x20bot\x20error:','pk_','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','•\x20Important\x20events\x0a\x0a','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','env','✅\x20File\x20sent\x20to\x20','Example:\x0a','isVerified','✅\x20Welcome\x20back!\x0a\x0a','`\x0a\x0a','...','❌\x20Shop\x20`','TELEGRAM_BOT_USERNAME','sendDocument','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','chat\x20not\x20found','log','en-US','223362FHHsFz','\x20USDT*\x0a','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','💳\x20*Wallet:*\x20`','updatedAt','onText','chargebackAmount','botToken','statusCode','application/pdf','telegramUser','📱\x20Created\x20new\x20Telegram\x20user:\x20','last_name','👤\x20Username:\x20`','wallet','Error\x20in\x20handleSingleLineVerification:','📝\x20Order\x20ID:\x20`','findUnique','.jpg','name','Error\x20sending\x20shop\x20notification:','from','join','Failed\x20to\x20send\x20API\x20error\x20notification:'];a66_0x2139=function(){return _0x57538e;};return a66_0x2139();}const a66_0x5021f5=a66_0x359e;(function(_0x4552fd,_0x14768d){const _0x2d5aa3=a66_0x359e,_0x2ed52d=_0x4552fd();while(!![]){try{const _0x84cd22=-parseInt(_0x2d5aa3(0x10e))/0x1*(parseInt(_0x2d5aa3(0xdc))/0x2)+parseInt(_0x2d5aa3(0xf5))/0x3+parseInt(_0x2d5aa3(0x1b6))/0x4*(-parseInt(_0x2d5aa3(0x14b))/0x5)+parseInt(_0x2d5aa3(0x168))/0x6+parseInt(_0x2d5aa3(0xda))/0x7*(parseInt(_0x2d5aa3(0x1c6))/0x8)+-parseInt(_0x2d5aa3(0x1b4))/0x9+-parseInt(_0x2d5aa3(0x152))/0xa*(-parseInt(_0x2d5aa3(0x193))/0xb);if(_0x84cd22===_0x14768d)break;else _0x2ed52d['push'](_0x2ed52d['shift']());}catch(_0x5f4235){_0x2ed52d['push'](_0x2ed52d['shift']());}}}(a66_0x2139,0x5b3b0));var __importDefault=this&&this[a66_0x5021f5(0x1b2)]||function(_0x3bfd64){return _0x3bfd64&&_0x3bfd64['__esModule']?_0x3bfd64:{'default':_0x3bfd64};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['telegramBotService']=exports[a66_0x5021f5(0x18a)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a66_0x5021f5(0x19e))),database_1=__importDefault(require('../config/database')),gateway_1=require(a66_0x5021f5(0x1c5));class TelegramBotService{constructor(){const _0xd9cca=a66_0x5021f5;this[_0xd9cca(0x10d)]=null,this[_0xd9cca(0xfc)]=process[_0xd9cca(0xe7)][_0xd9cca(0x19c)]||'',this[_0xd9cca(0x149)]=process[_0xd9cca(0xe7)][_0xd9cca(0xef)]||_0xd9cca(0x137),this[_0xd9cca(0xfc)]?this[_0xd9cca(0x172)]():console[_0xd9cca(0x187)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a66_0x5021f5(0x172)](){const _0x38467b=a66_0x5021f5;try{this[_0x38467b(0x10d)]=new node_telegram_bot_api_1['default'](this[_0x38467b(0xfc)],{'polling':!![]}),this[_0x38467b(0x15c)](),console[_0x38467b(0xf3)](_0x38467b(0x146)+this['botUsername']+'\x20initialized\x20successfully');}catch(_0x315702){console[_0x38467b(0x186)](_0x38467b(0x195),_0x315702);}}[a66_0x5021f5(0x15c)](){const _0x59167d=a66_0x5021f5;if(!this[_0x59167d(0x10d)])return;this[_0x59167d(0x10d)][_0x59167d(0xfa)](/\/start/,async _0x542719=>{const _0x17484b=_0x59167d,_0x3e2cc8=_0x542719[_0x17484b(0xd5)]['id'],_0x3f0cdc=_0x542719[_0x17484b(0x10a)]?.['id'][_0x17484b(0x1af)](),_0xc4735=_0x542719[_0x17484b(0x10a)]?.[_0x17484b(0x142)],_0x39659a=_0x542719['from']?.[_0x17484b(0x160)],_0x37eaae=_0x542719['from']?.[_0x17484b(0x101)];if(!_0x3f0cdc)return;try{let _0x4ff828=await database_1[_0x17484b(0x122)][_0x17484b(0xff)][_0x17484b(0x106)]({'where':{'telegramId':_0x3f0cdc},'include':{'shop':!![]}});!_0x4ff828?(_0x4ff828=await database_1[_0x17484b(0x122)][_0x17484b(0xff)]['create']({'data':{'telegramId':_0x3f0cdc,'username':_0xc4735,'firstName':_0x39659a,'lastName':_0x37eaae,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x17484b(0xf3)](_0x17484b(0x100)+_0x3f0cdc+_0x17484b(0x16b)+_0xc4735+')')):_0x4ff828=await database_1[_0x17484b(0x122)][_0x17484b(0xff)][_0x17484b(0x1a1)]({'where':{'telegramId':_0x3f0cdc},'data':{'username':_0xc4735,'firstName':_0x39659a,'lastName':_0x37eaae},'include':{'shop':!![]}}),_0x4ff828[_0x17484b(0xea)]&&_0x4ff828[_0x17484b(0x110)]&&_0x4ff828[_0x17484b(0x150)]?await this['bot']?.['sendMessage'](_0x3e2cc8,_0x17484b(0xeb)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x4ff828['shop'][_0x17484b(0x108)]+'*\x0a')+('Username:\x20`'+_0x4ff828[_0x17484b(0x150)][_0x17484b(0x142)]+'`\x0a\x0a')+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x17484b(0x197)+'•\x20Payment\x20status\x20changes\x0a'+_0x17484b(0x194)+_0x17484b(0x111)+_0x17484b(0xe1)+_0x17484b(0x156),{'parse_mode':_0x17484b(0x18b)}):(_0x4ff828['shopId']&&!_0x4ff828['isVerified']&&(await database_1[_0x17484b(0x122)]['telegramUser'][_0x17484b(0x1a1)]({'where':{'telegramId':_0x3f0cdc},'data':{'shopId':null,'isVerified':![]}}),console[_0x17484b(0xf3)](_0x17484b(0x113)+_0x3f0cdc)),await this[_0x17484b(0x10d)]?.[_0x17484b(0x1b0)](_0x3e2cc8,_0x17484b(0x1bd)+_0x17484b(0x1ad)+_0x17484b(0x16f)+'Example:\x0a'+_0x17484b(0xe4)+_0x17484b(0x13d),{'parse_mode':_0x17484b(0x18b)}));}catch(_0x9c0333){console['error'](_0x17484b(0x1b7),_0x9c0333),await this['bot']?.['sendMessage'](_0x3e2cc8,_0x17484b(0x180));}}),this['bot'][_0x59167d(0xfa)](/\/disconnect/,async _0x330287=>{const _0xaa9f4=_0x59167d,_0x5eb5b3=_0x330287['chat']['id'],_0x3042f0=_0x330287['from']?.['id']['toString']();if(!_0x3042f0)return;try{const _0x1fe1d2=await database_1['default'][_0xaa9f4(0xff)][_0xaa9f4(0x106)]({'where':{'telegramId':_0x3042f0},'include':{'shop':!![]}});if(!_0x1fe1d2||!_0x1fe1d2['isVerified']||!_0x1fe1d2[_0xaa9f4(0x110)]){await this[_0xaa9f4(0x10d)]?.[_0xaa9f4(0x1b0)](_0x5eb5b3,_0xaa9f4(0x175));return;}const _0x211a76=_0x1fe1d2[_0xaa9f4(0x150)]?.[_0xaa9f4(0x108)]||_0xaa9f4(0x153);await database_1[_0xaa9f4(0x122)][_0xaa9f4(0xff)][_0xaa9f4(0x1a1)]({'where':{'telegramId':_0x3042f0},'data':{'shopId':null,'isVerified':![]}}),console[_0xaa9f4(0xf3)](_0xaa9f4(0x1bb)+_0x3042f0+_0xaa9f4(0x141)+_0x1fe1d2['shopId']),await this[_0xaa9f4(0x10d)]?.[_0xaa9f4(0x1b0)](_0x5eb5b3,_0xaa9f4(0x130)+_0x211a76+_0xaa9f4(0x1bc)+_0xaa9f4(0x183),{'parse_mode':'Markdown'});}catch(_0x2fff73){console[_0xaa9f4(0x186)]('Error\x20handling\x20/disconnect\x20command:',_0x2fff73),await this[_0xaa9f4(0x10d)]?.[_0xaa9f4(0x1b0)](_0x5eb5b3,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x59167d(0x10d)][_0x59167d(0xfa)](/\/status/,async _0x3b4788=>{const _0x204db1=_0x59167d,_0x3c8f71=_0x3b4788[_0x204db1(0xd5)]['id'],_0x1a5c89=_0x3b4788[_0x204db1(0x10a)]?.['id'][_0x204db1(0x1af)]();if(!_0x1a5c89)return;try{const _0x5a0cc1=await database_1[_0x204db1(0x122)][_0x204db1(0xff)][_0x204db1(0x106)]({'where':{'telegramId':_0x1a5c89},'include':{'shop':!![]}});if(!_0x5a0cc1){await this[_0x204db1(0x10d)]?.[_0x204db1(0x1b0)](_0x3c8f71,_0x204db1(0xf1)+_0x204db1(0x1c9));return;}if(!_0x5a0cc1[_0x204db1(0xea)]||!_0x5a0cc1[_0x204db1(0x110)]||!_0x5a0cc1['shop']){await this[_0x204db1(0x10d)]?.[_0x204db1(0x1b0)](_0x3c8f71,_0x204db1(0x115)+_0x204db1(0x1ba));return;}await this[_0x204db1(0x10d)]?.[_0x204db1(0x1b0)](_0x3c8f71,_0x204db1(0x17c)+(_0x204db1(0x145)+_0x5a0cc1['shop']['name']+'*\x0a')+(_0x204db1(0x102)+_0x5a0cc1[_0x204db1(0x150)][_0x204db1(0x142)]+'`\x0a')+(_0x204db1(0xd7)+_0x5a0cc1[_0x204db1(0xf9)]['toLocaleDateString'](_0x204db1(0xf4))+'\x0a\x0a')+_0x204db1(0x129)+_0x204db1(0x111)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x204db1(0x18b)});}catch(_0x3abd68){console[_0x204db1(0x186)](_0x204db1(0x161),_0x3abd68),await this['bot']?.[_0x204db1(0x1b0)](_0x3c8f71,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x59167d(0x10d)]['onText'](/\/debug/,async _0x1fc7fc=>{const _0x4db1c6=_0x59167d,_0xd36ab4=_0x1fc7fc[_0x4db1c6(0xd5)]['id'],_0x67d832=_0x1fc7fc[_0x4db1c6(0x10a)]?.['id'][_0x4db1c6(0x1af)]();if(!_0x67d832)return;try{const _0x47c360=await database_1[_0x4db1c6(0x122)][_0x4db1c6(0xff)]['findUnique']({'where':{'telegramId':_0x67d832},'include':{'shop':!![]}});let _0x5d5615=_0x4db1c6(0x114);_0x5d5615+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x67d832+_0x4db1c6(0xec),_0x47c360?.[_0x4db1c6(0xea)]&&_0x47c360[_0x4db1c6(0x150)]?(_0x5d5615+='🏪\x20Your\x20connected\x20shop:\x0a',_0x5d5615+=_0x4db1c6(0x158)+_0x47c360[_0x4db1c6(0x150)][_0x4db1c6(0x108)]+'*\x0a',_0x5d5615+='\x20\x20\x20Username:\x20`'+_0x47c360['shop'][_0x4db1c6(0x142)]+'`\x0a',_0x5d5615+='\x20\x20\x20Status:\x20'+_0x47c360[_0x4db1c6(0x150)][_0x4db1c6(0xde)]+'\x0a\x0a'):_0x5d5615+=_0x4db1c6(0x166),_0x5d5615+=_0x4db1c6(0x15e),await this[_0x4db1c6(0x10d)]?.[_0x4db1c6(0x1b0)](_0xd36ab4,_0x5d5615,{'parse_mode':_0x4db1c6(0x18b)});}catch(_0x94713d){console[_0x4db1c6(0x186)](_0x4db1c6(0x12e),_0x94713d),await this[_0x4db1c6(0x10d)]?.['sendMessage'](_0xd36ab4,_0x4db1c6(0x1b8));}}),this[_0x59167d(0x10d)]['on']('message',async _0x5297bf=>{const _0x4130c8=_0x59167d;if(_0x5297bf[_0x4130c8(0x131)]?.[_0x4130c8(0x11e)]('/'))return;const _0x21389a=_0x5297bf[_0x4130c8(0xd5)]['id'],_0x2ea3ab=_0x5297bf[_0x4130c8(0x10a)]?.['id'][_0x4130c8(0x1af)](),_0x4d884a=_0x5297bf[_0x4130c8(0x131)]?.[_0x4130c8(0x174)]();if(!_0x2ea3ab||!_0x4d884a)return;try{const _0x15212c=await database_1['default']['telegramUser'][_0x4130c8(0x106)]({'where':{'telegramId':_0x2ea3ab},'include':{'shop':!![]}});if(!_0x15212c){await this[_0x4130c8(0x10d)]?.['sendMessage'](_0x21389a,_0x4130c8(0xd9));return;}if(_0x15212c[_0x4130c8(0xea)]&&_0x15212c['shopId']&&_0x15212c[_0x4130c8(0x150)]){await this['bot']?.[_0x4130c8(0x1b0)](_0x21389a,_0x4130c8(0x126)+_0x15212c[_0x4130c8(0x150)][_0x4130c8(0x108)]+_0x4130c8(0x1bc)+_0x4130c8(0x15d),{'parse_mode':_0x4130c8(0x18b)});return;}const _0x57c347=_0x4d884a[_0x4130c8(0x10f)](/\s+/);if(_0x57c347[_0x4130c8(0x17e)]!==0x2){await this['bot']?.[_0x4130c8(0x1b0)](_0x21389a,_0x4130c8(0x1a8)+_0x4130c8(0x16f)+_0x4130c8(0xe9)+_0x4130c8(0xe4)+(_0x4130c8(0x125)+_0x57c347[_0x4130c8(0x17e)]+_0x4130c8(0x138)+_0x57c347['map'](_0x18cc09=>'`'+_0x18cc09+'`')[_0x4130c8(0x10b)](',\x20')),{'parse_mode':_0x4130c8(0x18b)});return;}const [_0x158b2b,_0x5a0120]=_0x57c347;console['log'](_0x4130c8(0x1a3)+_0x2ea3ab+_0x4130c8(0x14a)+_0x158b2b+_0x4130c8(0x11c)+_0x5a0120[_0x4130c8(0x11f)](0x0,0xa)+'...\x22'),await this[_0x4130c8(0x1c8)](_0x21389a,_0x2ea3ab,_0x158b2b,_0x5a0120);}catch(_0x834e8){console['error']('Error\x20handling\x20message:',_0x834e8),await this['bot']?.[_0x4130c8(0x1b0)](_0x21389a,_0x4130c8(0x180));}}),this[_0x59167d(0x10d)]['on'](_0x59167d(0x186),_0x2e3437=>{const _0x16875f=_0x59167d;console['error'](_0x16875f(0xe2),_0x2e3437);}),this[_0x59167d(0x10d)]['on'](_0x59167d(0x189),_0xb37872=>{const _0x274866=_0x59167d;console['error'](_0x274866(0x1b1),_0xb37872);});}async[a66_0x5021f5(0x1c8)](_0x3ed4a9,_0x31bc24,_0xea9a00,_0x50e9ee){const _0x43064c=a66_0x5021f5;try{console[_0x43064c(0xf3)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x31bc24+':\x20username=\x22'+_0xea9a00+_0x43064c(0x11c)+_0x50e9ee['substring'](0x0,0xa)+_0x43064c(0x171));if(!_0xea9a00||_0xea9a00[_0x43064c(0x17e)]<0x3||_0xea9a00[_0x43064c(0x17e)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0xea9a00)){await this[_0x43064c(0x10d)]?.['sendMessage'](_0x3ed4a9,'❌\x20Invalid\x20username\x20format:\x20`'+_0xea9a00+_0x43064c(0xec)+_0x43064c(0x163),{'parse_mode':'Markdown'});return;}if(!_0x50e9ee||!_0x50e9ee[_0x43064c(0x11e)](_0x43064c(0xe3))&&!_0x50e9ee[_0x43064c(0x11e)](_0x43064c(0x16c))){await this[_0x43064c(0x10d)]?.['sendMessage'](_0x3ed4a9,_0x43064c(0x177)+_0x43064c(0x139),{'parse_mode':_0x43064c(0x18b)});return;}const _0x7fc910=await database_1[_0x43064c(0x122)]['shop']['findUnique']({'where':{'username':_0xea9a00},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x7fc910){const _0xa2d8e6=_0x43064c(0x14c)+_0xea9a00+_0x43064c(0x178)+_0x43064c(0xd6)+_0x43064c(0x17b);await this[_0x43064c(0x10d)]?.['sendMessage'](_0x3ed4a9,_0xa2d8e6,{'parse_mode':'Markdown'});return;}if(_0x7fc910[_0x43064c(0xde)]!=='ACTIVE'){await this[_0x43064c(0x10d)]?.['sendMessage'](_0x3ed4a9,_0x43064c(0xee)+_0xea9a00+_0x43064c(0x124)+_0x43064c(0x13b),{'parse_mode':'Markdown'});return;}if(_0x7fc910[_0x43064c(0x181)]!==_0x50e9ee&&_0x7fc910['secretKey']!==_0x50e9ee){await this[_0x43064c(0x10d)]?.['sendMessage'](_0x3ed4a9,_0x43064c(0xf7)+_0xea9a00+_0x43064c(0x12c)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x43064c(0x13e),{'parse_mode':_0x43064c(0x18b)});return;}const _0x45f9ac=await database_1['default']['telegramUser']['findFirst']({'where':{'shopId':_0x7fc910['id'],'isVerified':!![],'telegramId':{'not':_0x31bc24}}});if(_0x45f9ac){await this[_0x43064c(0x10d)]?.['sendMessage'](_0x3ed4a9,_0x43064c(0x164)+_0xea9a00+_0x43064c(0x12c)+_0x43064c(0x1c0),{'parse_mode':_0x43064c(0x18b)});return;}await database_1[_0x43064c(0x122)][_0x43064c(0xff)]['update']({'where':{'telegramId':_0x31bc24},'data':{'shopId':_0x7fc910['id'],'isVerified':!![]}}),await this['bot']?.['sendMessage'](_0x3ed4a9,_0x43064c(0x14e)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x43064c(0x15f)+_0x7fc910[_0x43064c(0x108)]+'*\x0a')+(_0x43064c(0x102)+_0x7fc910[_0x43064c(0x142)]+'`\x0a\x0a')+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x43064c(0x197)+_0x43064c(0x1c1)+_0x43064c(0x1b9)+_0x43064c(0xe5)+_0x43064c(0x111)+_0x43064c(0xe1)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x43064c(0x18b)}),console[_0x43064c(0xf3)](_0x43064c(0x1be)+_0x31bc24+_0x43064c(0x17d)+_0x7fc910[_0x43064c(0x142)]+'\x20via\x20single-line\x20input');}catch(_0x1fc733){console['error'](_0x43064c(0x104),_0x1fc733),await this[_0x43064c(0x10d)]?.[_0x43064c(0x1b0)](_0x3ed4a9,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a66_0x5021f5(0x14d)](_0x14c21c,_0x357a13,_0xf7106d){const _0x1b027f=a66_0x5021f5;if(!this['bot']){console[_0x1b027f(0x187)](_0x1b027f(0x120));return;}try{const _0x3b56ef=await database_1[_0x1b027f(0x122)]['telegramUser'][_0x1b027f(0x128)]({'where':{'shopId':_0x14c21c,'isVerified':!![]}});if(_0x3b56ef[_0x1b027f(0x17e)]===0x0){console['log']('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x14c21c);return;}const _0x307e0f=_0x3b56ef[_0x1b027f(0x119)](async _0x25d066=>{const _0x22b9c0=_0x1b027f;try{await this['bot']?.[_0x22b9c0(0x1b0)](_0x25d066[_0x22b9c0(0x118)],_0x357a13,_0xf7106d),console['log'](_0x22b9c0(0x18e)+_0x25d066[_0x22b9c0(0x118)]);}catch(_0x2930a8){console[_0x22b9c0(0x186)](_0x22b9c0(0xdd)+_0x25d066[_0x22b9c0(0x118)]+':',_0x2930a8),_0x2930a8 instanceof Error&&(_0x2930a8[_0x22b9c0(0x13a)][_0x22b9c0(0x148)](_0x22b9c0(0x12b))||_0x2930a8[_0x22b9c0(0x13a)][_0x22b9c0(0x148)](_0x22b9c0(0xf2))||_0x2930a8['message']['includes'](_0x22b9c0(0x17a)))&&(await database_1[_0x22b9c0(0x122)][_0x22b9c0(0xff)]['update']({'where':{'id':_0x25d066['id']},'data':{'isVerified':![]}}),console[_0x22b9c0(0xf3)](_0x22b9c0(0x133)+_0x25d066[_0x22b9c0(0x118)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x1b027f(0x1a2)](_0x307e0f);}catch(_0x1bcff8){console['error'](_0x1b027f(0x109),_0x1bcff8);}}async['sendPaymentNotification'](_0x5ea68c,_0x139c52,_0x811ffc){const _0x9680d9=a66_0x5021f5,_0x517a92={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x5df10f={'created':_0x9680d9(0x1ca),'paid':'Payment\x20successfully\x20paid','failed':_0x9680d9(0x1a0),'expired':_0x9680d9(0x155),'refund':_0x9680d9(0x18c),'chargeback':_0x9680d9(0x19b),'processing':_0x9680d9(0x1ac)},_0x4dcd0f=_0x517a92[_0x811ffc],_0x471bd9=_0x5df10f[_0x811ffc],_0x41e22f=(0x0,gateway_1[_0x9680d9(0x117)])(_0x139c52[_0x9680d9(0x191)]);console[_0x9680d9(0xf3)](_0x9680d9(0x16d)+_0x139c52['gateway']+_0x9680d9(0x135)+_0x41e22f+'\x22');let _0x4a851e=_0x4dcd0f+'\x20*'+_0x471bd9+_0x9680d9(0x19d)+(_0x9680d9(0x1a4)+_0x139c52[_0x9680d9(0x170)]+'\x20'+_0x139c52['currency']+'*\x0a')+(_0x9680d9(0x105)+(_0x139c52['orderId']||_0x139c52['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x139c52['id']+'`\x0a')+(_0x9680d9(0x182)+_0x41e22f+'`\x0a')+(_0x9680d9(0x1c2)+new Date(_0x139c52[_0x9680d9(0x179)])['toLocaleString'](_0x9680d9(0xf4))+'\x0a');if(_0x139c52['customerName']||_0x139c52[_0x9680d9(0xd8)]||_0x139c52['remitterIban']||_0x139c52[_0x9680d9(0x159)]||_0x139c52[_0x9680d9(0x1b3)]){_0x4a851e+='\x0a👤\x20*Customer\x20Information:*\x0a';_0x139c52[_0x9680d9(0x13f)]&&(_0x4a851e+='📛\x20Name:\x20`'+_0x139c52[_0x9680d9(0x13f)]+'`\x0a');_0x139c52['customerEmail']&&(_0x4a851e+=_0x9680d9(0x165)+_0x139c52[_0x9680d9(0xd8)]+'`\x0a');_0x139c52['remitterIban']&&(_0x4a851e+=_0x9680d9(0x147)+_0x139c52['remitterIban']+'`\x0a');_0x139c52[_0x9680d9(0x159)]&&(_0x4a851e+=_0x9680d9(0x15a)+_0x139c52['customerIp']+'`\x0a');if(_0x139c52[_0x9680d9(0x1b3)]){const _0x2fc2bd=_0x139c52[_0x9680d9(0x1b3)]['length']>0x32?_0x139c52[_0x9680d9(0x1b3)]['substring'](0x0,0x32)+_0x9680d9(0xed):_0x139c52[_0x9680d9(0x1b3)];_0x4a851e+=_0x9680d9(0x1c4)+_0x2fc2bd+'`\x0a';}}_0x811ffc==='chargeback'&&_0x139c52[_0x9680d9(0xfb)]&&(_0x4a851e+=_0x9680d9(0x15b)+_0x139c52[_0x9680d9(0xfb)]+_0x9680d9(0xf6)),_0x811ffc===_0x9680d9(0x140)&&(_0x4a851e+=_0x9680d9(0x198)),_0x139c52['adminNotes']&&(_0x4a851e+=_0x9680d9(0x151)+_0x139c52[_0x9680d9(0x169)]+'\x0a'),await this['sendShopNotification'](_0x5ea68c,_0x4a851e,{'parse_mode':_0x9680d9(0x18b)});}async[a66_0x5021f5(0x134)](_0x36fb69,_0x6976a9){const _0xf71da0=a66_0x5021f5,_0x50c734=new Date(_0x6976a9[_0xf71da0(0x179)])['toLocaleString'](_0xf71da0(0xf4),{'year':'numeric','month':_0xf71da0(0x19a),'day':_0xf71da0(0x19a),'hour':_0xf71da0(0x19a),'minute':_0xf71da0(0x19a),'second':_0xf71da0(0x19a)}),_0x2eb441='💸\x20*New\x20Payout*\x0a\x0a'+(_0xf71da0(0x16e)+_0x50c734+'\x0a')+(_0xf71da0(0x12a)+_0x6976a9[_0xf71da0(0x170)]+'\x20USD\x0a')+(_0xf71da0(0x132)+(_0x6976a9[_0xf71da0(0x123)]||_0xf71da0(0x11b))+'\x0a')+('🌐\x20*Network:*\x20'+(_0x6976a9['network']||_0xf71da0(0x11b))+'\x0a')+(_0xf71da0(0xf8)+(_0x6976a9[_0xf71da0(0x103)]||'Not\x20specified')+'`\x0a')+(_0x6976a9['txid']?_0xf71da0(0x190)+_0x6976a9['txid']+'`':_0xf71da0(0x112));await this['sendShopNotification'](_0x36fb69,_0x2eb441,{'parse_mode':_0xf71da0(0x18b)});}async['sendLoginNotification'](_0x4d2f1e,_0x276498){const _0x2cd5ba=a66_0x5021f5;try{const _0x5e2e58=await database_1['default'][_0x2cd5ba(0x1ab)]['findUnique']({'where':{'shopId':_0x4d2f1e},'select':{'notificationLogin':!![]}});if(!_0x5e2e58?.[_0x2cd5ba(0x121)]){console[_0x2cd5ba(0xf3)](_0x2cd5ba(0x154)+_0x4d2f1e);return;}const _0xee0f37=_0x276498[_0x2cd5ba(0x18d)]?'🔐':'🚨',_0x3bf56d=_0x276498[_0x2cd5ba(0x18d)]?'Successful\x20login':'Failed\x20login\x20attempt';let _0x20247e=_0xee0f37+'\x20*'+_0x3bf56d+'*\x0a\x0a'+(_0x2cd5ba(0x102)+_0x276498['username']+'`\x0a')+(_0x2cd5ba(0x12f)+_0x276498[_0x2cd5ba(0x1a9)]['toLocaleString'](_0x2cd5ba(0xf4))+'\x0a');_0x276498[_0x2cd5ba(0xdb)]&&(_0x20247e+='🌐\x20IP\x20address:\x20`'+_0x276498[_0x2cd5ba(0xdb)]+'`\x0a');_0x276498[_0x2cd5ba(0x162)]&&(_0x20247e+=_0x2cd5ba(0x1a6)+_0x276498[_0x2cd5ba(0x162)]+'\x0a');if(_0x276498[_0x2cd5ba(0x167)]){const _0x2f7f10=_0x276498[_0x2cd5ba(0x167)][_0x2cd5ba(0x17e)]>0x32?_0x276498[_0x2cd5ba(0x167)][_0x2cd5ba(0x11f)](0x0,0x32)+'...':_0x276498[_0x2cd5ba(0x167)];_0x20247e+=_0x2cd5ba(0x1c4)+_0x2f7f10+'`\x0a';}!_0x276498['success']&&(_0x20247e+=_0x2cd5ba(0x11a)),await this[_0x2cd5ba(0x14d)](_0x4d2f1e,_0x20247e,{'parse_mode':_0x2cd5ba(0x18b)}),console['log']('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x4d2f1e+':\x20'+(_0x276498[_0x2cd5ba(0x18d)]?'success':_0x2cd5ba(0x1aa)));}catch(_0x1a80ae){console[_0x2cd5ba(0x186)]('Failed\x20to\x20send\x20login\x20notification:',_0x1a80ae);}}async[a66_0x5021f5(0x1a5)](_0xc1950d,_0x2cba60){const _0x5449a1=a66_0x5021f5;try{const _0xdca010=await database_1[_0x5449a1(0x122)][_0x5449a1(0x1ab)][_0x5449a1(0x106)]({'where':{'shopId':_0xc1950d},'select':{'notificationApiError':!![]}});if(!_0xdca010?.[_0x5449a1(0x14f)]){console[_0x5449a1(0xf3)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0xc1950d);return;}let _0x404cb1=_0x5449a1(0x196)+(_0x5449a1(0x17f)+_0x2cba60['method']+'\x20'+_0x2cba60[_0x5449a1(0x185)]+'`\x0a')+(_0x5449a1(0x12f)+_0x2cba60[_0x5449a1(0x1a9)]['toLocaleString'](_0x5449a1(0xf4))+'\x0a');_0x2cba60[_0x5449a1(0xfd)]&&(_0x404cb1+='📊\x20Error\x20code:\x20`'+_0x2cba60[_0x5449a1(0xfd)]+'`\x0a'),_0x404cb1+='❌\x20Error:\x20`'+_0x2cba60['errorMessage']+'`\x0a',_0x2cba60['requestId']&&(_0x404cb1+=_0x5449a1(0x136)+_0x2cba60[_0x5449a1(0x127)]+'`\x0a'),_0x404cb1+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x5449a1(0x14d)](_0xc1950d,_0x404cb1,{'parse_mode':_0x5449a1(0x18b)}),console[_0x5449a1(0xf3)](_0x5449a1(0xe6)+_0xc1950d+':\x20'+_0x2cba60[_0x5449a1(0x185)]);}catch(_0x3d104c){console[_0x5449a1(0x186)](_0x5449a1(0x10c),_0x3d104c);}}async['sendCustomNotification'](_0x4dedfe,_0x525a76,_0x177740){const _0x2b2b53=a66_0x5021f5;let _0x2f2d75=_0x2b2b53(0x143)+_0x525a76+_0x2b2b53(0x19d);for(const [_0x37b8f0,_0x35eab3]of Object['entries'](_0x177740)){_0x35eab3!==null&&_0x35eab3!==undefined&&(_0x2f2d75+=_0x37b8f0+_0x2b2b53(0x1bf)+_0x35eab3+'`\x0a');}await this[_0x2b2b53(0x14d)](_0x4dedfe,_0x2f2d75,{'parse_mode':'Markdown'});}async['sendNotificationToAll'](_0x55d542){const _0x10ee78=a66_0x5021f5;try{console[_0x10ee78(0xf3)](_0x10ee78(0x1c7)+_0x55d542[_0x10ee78(0x11f)](0x0,0x32)+_0x10ee78(0xed));const _0x560fb1=await database_1['default'][_0x10ee78(0xff)]['findMany']({'select':{'telegramId':!![]}});if(_0x560fb1[_0x10ee78(0x17e)]===0x0){console[_0x10ee78(0xf3)](_0x10ee78(0x184));return;}for(const _0x464d13 of _0x560fb1){try{await this[_0x10ee78(0x10d)]?.[_0x10ee78(0x1b0)](_0x464d13[_0x10ee78(0x118)],_0x55d542,{'parse_mode':_0x10ee78(0x18b)});}catch(_0x550f41){console[_0x10ee78(0x186)](_0x10ee78(0x1b5)+_0x464d13['telegramId']+':',_0x550f41);}}console['log']('📱\x20Notification\x20sent\x20to\x20'+_0x560fb1[_0x10ee78(0x17e)]+_0x10ee78(0x176));}catch(_0x13bc1f){console['error']('❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:',_0x13bc1f);}}[a66_0x5021f5(0xe0)](){const _0x5e369f=a66_0x5021f5;return{'isActive':!!this[_0x5e369f(0x10d)],'username':this['botUsername']};}async['sendShopFile'](_0x5102b1,_0x54c4fa,_0x5122c6,_0x56997d){const _0x30c589=a66_0x5021f5;try{if(!this[_0x30c589(0x10d)])return console[_0x30c589(0x186)]('❌\x20Telegram\x20bot\x20not\x20initialized'),![];const _0x13cf58=await database_1[_0x30c589(0x122)][_0x30c589(0xff)]['findMany']({'where':{'shopId':_0x5102b1,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x13cf58['length']===0x0)return console[_0x30c589(0x186)](_0x30c589(0x13c)+_0x5102b1),![];let _0x40adb9=0x0;for(const _0x2190ad of _0x13cf58){try{await this[_0x30c589(0x10d)][_0x30c589(0xf0)](_0x2190ad['telegramId'],_0x54c4fa,{},{'filename':_0x5122c6,'contentType':_0x5122c6[_0x30c589(0x19f)](_0x30c589(0x188))?'image/png':_0x5122c6[_0x30c589(0x19f)]('.jpg')||_0x5122c6[_0x30c589(0x19f)](_0x30c589(0xd4))?_0x30c589(0x12d):_0x5122c6[_0x30c589(0x19f)]('.pdf')?_0x30c589(0xfe):'application/octet-stream'}),_0x56997d&&await this[_0x30c589(0x10d)][_0x30c589(0x1b0)](_0x2190ad[_0x30c589(0x118)],_0x56997d),_0x40adb9++;}catch(_0x22a22f){console[_0x30c589(0x186)]('❌\x20Error\x20sending\x20file\x20to\x20user\x20'+_0x2190ad[_0x30c589(0x118)]+':',_0x22a22f);}}return console[_0x30c589(0xf3)](_0x30c589(0xe8)+_0x40adb9+'/'+_0x13cf58[_0x30c589(0x17e)]+_0x30c589(0x1ae)+_0x5102b1+':\x20'+_0x5122c6),_0x40adb9>0x0;}catch(_0x5f09dc){return console[_0x30c589(0x186)](_0x30c589(0x199),_0x5f09dc),![];}}async['sendDirectMessage'](_0x59fdc3,_0x171200){const _0x202828=a66_0x5021f5;try{if(!this['bot'])return console[_0x202828(0x186)](_0x202828(0xdf)),![];return await this[_0x202828(0x10d)][_0x202828(0x1b0)](_0x59fdc3,_0x171200),console[_0x202828(0xf3)](_0x202828(0x1c3)+_0x59fdc3),!![];}catch(_0x5ced98){return console['error'](_0x202828(0x192),_0x5ced98),![];}}async[a66_0x5021f5(0x173)](_0x4c5c4e,_0xfa7c21,_0x10377b,_0x5a0b75){const _0x2e6438=a66_0x5021f5;try{if(!this[_0x2e6438(0x10d)])return console[_0x2e6438(0x186)](_0x2e6438(0xdf)),![];return await this[_0x2e6438(0x10d)][_0x2e6438(0xf0)](_0x4c5c4e,_0xfa7c21,{},{'filename':_0x10377b,'contentType':_0x10377b[_0x2e6438(0x19f)](_0x2e6438(0x188))?_0x2e6438(0x11d):_0x10377b['endsWith'](_0x2e6438(0x107))||_0x10377b[_0x2e6438(0x19f)]('.jpeg')?_0x2e6438(0x12d):_0x10377b[_0x2e6438(0x19f)]('.pdf')?_0x2e6438(0xfe):_0x2e6438(0x144)}),_0x5a0b75&&await this[_0x2e6438(0x10d)][_0x2e6438(0x1b0)](_0x4c5c4e,_0x5a0b75),console[_0x2e6438(0xf3)](_0x2e6438(0x18f)+_0x4c5c4e+':\x20'+_0x10377b),!![];}catch(_0x1b799d){return console[_0x2e6438(0x186)](_0x2e6438(0x1a7),_0x1b799d),![];}}[a66_0x5021f5(0x116)](){const _0x1930ac=a66_0x5021f5;this[_0x1930ac(0x10d)]&&(this[_0x1930ac(0x10d)][_0x1930ac(0x16a)](),this[_0x1930ac(0x10d)]=null,console[_0x1930ac(0xf3)]('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a66_0x5021f5(0x18a)]=TelegramBotService,exports[a66_0x5021f5(0x157)]=new TelegramBotService();