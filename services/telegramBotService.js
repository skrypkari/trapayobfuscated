'use strict';const a57_0x12b213=a57_0x32f1;(function(_0x379ccc,_0x1809bb){const _0x11f7bb=a57_0x32f1,_0x96a6da=_0x379ccc();while(!![]){try{const _0x268232=-parseInt(_0x11f7bb(0x151))/0x1*(parseInt(_0x11f7bb(0x105))/0x2)+parseInt(_0x11f7bb(0x116))/0x3+parseInt(_0x11f7bb(0xb9))/0x4+parseInt(_0x11f7bb(0xc6))/0x5+-parseInt(_0x11f7bb(0x125))/0x6*(parseInt(_0x11f7bb(0x132))/0x7)+-parseInt(_0x11f7bb(0xdf))/0x8+parseInt(_0x11f7bb(0x10b))/0x9;if(_0x268232===_0x1809bb)break;else _0x96a6da['push'](_0x96a6da['shift']());}catch(_0x3de562){_0x96a6da['push'](_0x96a6da['shift']());}}}(a57_0x117f,0x85546));var __importDefault=this&&this[a57_0x12b213(0x15c)]||function(_0xd87aa3){return _0xd87aa3&&_0xd87aa3['__esModule']?_0xd87aa3:{'default':_0xd87aa3};};function a57_0x32f1(_0x290c1d,_0x5a0716){const _0x117f12=a57_0x117f();return a57_0x32f1=function(_0x32f125,_0x6c7722){_0x32f125=_0x32f125-0x9c;let _0x1b4d3d=_0x117f12[_0x32f125];return _0x1b4d3d;},a57_0x32f1(_0x290c1d,_0x5a0716);}Object[a57_0x12b213(0xbc)](exports,a57_0x12b213(0xd5),{'value':!![]}),exports[a57_0x12b213(0xb2)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require('../config/database')),gateway_1=require(a57_0x12b213(0x173));function a57_0x117f(){const _0x22866d=['\x0aCheck\x20spelling\x20and\x20try\x20again.','amount','📱\x20Your\x20Telegram\x20ID:\x20`','2636inwhym','🛑\x20Telegram\x20bot\x20stopped','📝\x20Notes:\x20','pk_','📱\x20Created\x20new\x20Telegram\x20user:\x20','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','8014905RLImir','remitterIban','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','TelegramBotService','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','✅\x20Connected\x20to\x20shop:\x20*','customerEmail','TELEGRAM_BOT_USERNAME','Error\x20handling\x20/debug\x20command:','shopId','451338BWjudv','warn','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','trim','🆔\x20Payout\x20ID:\x20`','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','status','error','Markdown','toLocaleString','success','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','✅\x20Welcome\x20back!\x0a\x0a','sendLoginNotification','Payment\x20is\x20being\x20processed','2641782AhoiAu','message','Successful\x20login','split','•\x20Important\x20events\x0a\x0a','\x20via\x20single-line\x20input','🔔\x20Notifications\x20are\x20active\x0a\x0a','sendPaymentNotification','findUnique','🏪\x20Available\x20shops\x20in\x20system:\x0a','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','timestamp','text','14aLYQNd','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','length','\x20parts:\x20','log','🆔\x20Payment\x20ID:\x20`','✅\x20Telegram\x20bot\x20@','💸\x20Amount:\x20*','getBotInfo','Payment\x20expired','👤\x20Username:\x20`','\x20USDT*\x0a','isVerified','You\x20sent\x20','Username:\x20`','❌\x20Shop\x20`','sendApiErrorNotification','❌\x20Error:\x20`','publicKey','findMany','shop','customerUa','updatedAt','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','✅\x20Telegram\x20user\x20','`.\x0a\x0a','TELEGRAM_BOT_TOKEN','onText','🏪\x20Gateway:\x20`','💸\x20Penalty\x20amount:\x20*','406DyzXvm','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','Telegram\x20bot\x20polling\x20error:','Payment\x20successfully\x20paid','shopSettings','ipAddress','toLocaleDateString','📅\x20Time:\x20','Use\x20/start\x20to\x20connect.','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','startsWith','__importDefault','`\x20not\x20found.\x0a\x0a','botToken','\x22\x20->\x20display\x20\x22','findFirst','chat','first_name','trapay_bot','Error\x20handling\x20/start\x20command:','🔌\x20User\x20','Check\x20spelling\x20and\x20try\x20again.','📧\x20Email:\x20`','`\x20(','botUsername','substring','processing','user\x20is\x20deactivated','statusCode','📅\x20Date:\x20','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','\x20\x20\x20Status:\x20','toString','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','../types/gateway',':\x20username=\x22','blocked','Error\x20handling\x20/status\x20command:','bot','Payment\x20chargeback','env','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','create','•\x20New\x20payments\x0a','telegramUser','New\x20payout\x20created','\x22,\x20apiKey=\x22','Error\x20handling\x20message:','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','📝\x20Order\x20ID:\x20`','❌\x20Invalid\x20username\x20format:\x20`','...\x22','•\x20Payment\x20status\x20changes\x0a','.\x20*','\x20\x20\x20Username:\x20`','en-US','update','requestId','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','•\x20Payouts\x0a','failed','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','❌\x20Shop\x20with\x20username\x20`','last_name','❌\x20Please\x20use\x20/start\x20command\x20first','allSettled','📱\x20Telegram\x20notification:\x20gateway\x20\x22','telegramBotService','default','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','/disconnect\x20-\x20disconnect\x20from\x20notifications','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','🆔\x20Request\x20ID:\x20`','unknown\x20shop','2309560qDJSmD','•\x20Payouts\x0a\x0a','Payout\x20completed','defineProperty','name','/status\x20-\x20check\x20connection\x20status\x0a','Failed\x20to\x20send\x20API\x20error\x20notification:','Error\x20in\x20handleSingleLineVerification:','initializeBot','gateway','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Error\x20sending\x20shop\x20notification:','username','5027990JXMiYR','...',':\x20`','map','forEach','💰\x20Amount:\x20*','getGatewayDisplayNameForTelegram','sendShopNotification','🔍\x20*Debug\x20Information*\x0a\x0a','\x20USD*\x0a','❌\x20Error\x20getting\x20debug\x20information.','txid','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','stopBot','*\x0a\x0a','__esModule','secretKey','sendMessage','🏦\x20Method:\x20`','Available\x20usernames:\x0a','Failed\x20login\x20attempt','*.\x0a\x0a','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Telegram\x20bot\x20error:','`\x0a\x0a','5297272PTTxSH','New\x20payment\x20created','🔗\x20TXID:\x20`','📱\x20Shop:\x20*','orderId','entries','method','setupBotHandlers','endpoint','sk_','💻\x20Browser:\x20`','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Contact\x20administrator.','Payment\x20failed','📛\x20Name:\x20`','🌐\x20IP\x20address:\x20`','🎉\x20*Congratulations!*\x0a\x0a','polling_error','userAgent','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','\x20disconnected\x20from\x20shop\x20','Payout\x20rejected','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','sendCustomNotification','customerName','chargeback','createdAt','Failed\x20to\x20send\x20login\x20notification:','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','from','telegramId','📅\x20Connection\x20date:\x20','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','Example:\x0a','customerIp'];a57_0x117f=function(){return _0x22866d;};return a57_0x117f();}class TelegramBotService{constructor(){const _0x115c1a=a57_0x12b213;this['bot']=null,this[_0x115c1a(0x15e)]=process[_0x115c1a(0x179)][_0x115c1a(0x14d)]||'',this['botUsername']=process[_0x115c1a(0x179)][_0x115c1a(0x113)]||_0x115c1a(0x163),this['botToken']?this[_0x115c1a(0xc1)]():console[_0x115c1a(0x117)](_0x115c1a(0x152));}[a57_0x12b213(0xc1)](){const _0x45894f=a57_0x12b213;try{this[_0x45894f(0x177)]=new node_telegram_bot_api_1[(_0x45894f(0xb3))](this[_0x45894f(0x15e)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x45894f(0x136)](_0x45894f(0x138)+this[_0x45894f(0x169)]+'\x20initialized\x20successfully');}catch(_0x4885e3){console[_0x45894f(0x11d)](_0x45894f(0x11b),_0x4885e3);}}[a57_0x12b213(0xe6)](){const _0x4241a2=a57_0x12b213;if(!this[_0x4241a2(0x177)])return;this[_0x4241a2(0x177)][_0x4241a2(0x14e)](/\/start/,async _0xfcd8ff=>{const _0x2e5c6e=_0x4241a2,_0x1d7600=_0xfcd8ff[_0x2e5c6e(0x161)]['id'],_0x37084b=_0xfcd8ff[_0x2e5c6e(0xfc)]?.['id'][_0x2e5c6e(0x171)](),_0x483b8b=_0xfcd8ff[_0x2e5c6e(0xfc)]?.['username'],_0x3f4b6a=_0xfcd8ff[_0x2e5c6e(0xfc)]?.[_0x2e5c6e(0x162)],_0x56d484=_0xfcd8ff[_0x2e5c6e(0xfc)]?.[_0x2e5c6e(0xae)];if(!_0x37084b)return;try{let _0x59a120=await database_1[_0x2e5c6e(0xb3)][_0x2e5c6e(0x17d)]['findUnique']({'where':{'telegramId':_0x37084b},'include':{'shop':!![]}});!_0x59a120?(_0x59a120=await database_1[_0x2e5c6e(0xb3)][_0x2e5c6e(0x17d)][_0x2e5c6e(0x17b)]({'data':{'telegramId':_0x37084b,'username':_0x483b8b,'firstName':_0x3f4b6a,'lastName':_0x56d484,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x2e5c6e(0x136)](_0x2e5c6e(0x109)+_0x37084b+'\x20(@'+_0x483b8b+')')):_0x59a120=await database_1[_0x2e5c6e(0xb3)][_0x2e5c6e(0x17d)]['update']({'where':{'telegramId':_0x37084b},'data':{'username':_0x483b8b,'firstName':_0x3f4b6a,'lastName':_0x56d484},'include':{'shop':!![]}}),_0x59a120[_0x2e5c6e(0x13e)]&&_0x59a120[_0x2e5c6e(0x115)]&&_0x59a120[_0x2e5c6e(0x146)]?await this['bot']?.[_0x2e5c6e(0xd7)](_0x1d7600,_0x2e5c6e(0x122)+(_0x2e5c6e(0x9f)+_0x59a120[_0x2e5c6e(0x146)][_0x2e5c6e(0xbd)]+'*\x0a')+(_0x2e5c6e(0x140)+_0x59a120[_0x2e5c6e(0x146)][_0x2e5c6e(0xc5)]+'`\x0a\x0a')+_0x2e5c6e(0xc3)+_0x2e5c6e(0x17c)+_0x2e5c6e(0xa3)+_0x2e5c6e(0xba)+'Commands:\x0a'+_0x2e5c6e(0xbe)+_0x2e5c6e(0xb5),{'parse_mode':_0x2e5c6e(0x11e)}):(_0x59a120[_0x2e5c6e(0x115)]&&!_0x59a120['isVerified']&&(await database_1[_0x2e5c6e(0xb3)][_0x2e5c6e(0x17d)][_0x2e5c6e(0xa7)]({'where':{'telegramId':_0x37084b},'data':{'shopId':null,'isVerified':![]}}),console[_0x2e5c6e(0x136)](_0x2e5c6e(0xd2)+_0x37084b)),await this['bot']?.['sendMessage'](_0x1d7600,_0x2e5c6e(0xb4)+_0x2e5c6e(0x17a)+_0x2e5c6e(0xea)+_0x2e5c6e(0x100)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x2e5c6e(0x16f),{'parse_mode':_0x2e5c6e(0x11e)}));}catch(_0x3b104e){console['error'](_0x2e5c6e(0x164),_0x3b104e),await this['bot']?.[_0x2e5c6e(0xd7)](_0x1d7600,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x4241a2(0x177)][_0x4241a2(0x14e)](/\/disconnect/,async _0x4b3783=>{const _0x3ff1bb=_0x4241a2,_0x4e3e8e=_0x4b3783[_0x3ff1bb(0x161)]['id'],_0x1addc0=_0x4b3783[_0x3ff1bb(0xfc)]?.['id'][_0x3ff1bb(0x171)]();if(!_0x1addc0)return;try{const _0x2c97b2=await database_1[_0x3ff1bb(0xb3)][_0x3ff1bb(0x17d)]['findUnique']({'where':{'telegramId':_0x1addc0},'include':{'shop':!![]}});if(!_0x2c97b2||!_0x2c97b2['isVerified']||!_0x2c97b2[_0x3ff1bb(0x115)]){await this[_0x3ff1bb(0x177)]?.['sendMessage'](_0x4e3e8e,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x11ef1f=_0x2c97b2[_0x3ff1bb(0x146)]?.[_0x3ff1bb(0xbd)]||_0x3ff1bb(0xb8);await database_1[_0x3ff1bb(0xb3)]['telegramUser'][_0x3ff1bb(0xa7)]({'where':{'telegramId':_0x1addc0},'data':{'shopId':null,'isVerified':![]}}),console[_0x3ff1bb(0x136)](_0x3ff1bb(0x165)+_0x1addc0+_0x3ff1bb(0xf3)+_0x2c97b2[_0x3ff1bb(0x115)]),await this[_0x3ff1bb(0x177)]?.['sendMessage'](_0x4e3e8e,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x11ef1f+_0x3ff1bb(0xdb)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x3ff1bb(0x11e)});}catch(_0x48c607){console[_0x3ff1bb(0x11d)]('Error\x20handling\x20/disconnect\x20command:',_0x48c607),await this[_0x3ff1bb(0x177)]?.[_0x3ff1bb(0xd7)](_0x4e3e8e,_0x3ff1bb(0x133));}}),this[_0x4241a2(0x177)]['onText'](/\/status/,async _0x52c8e6=>{const _0x3ec570=_0x4241a2,_0x27abb5=_0x52c8e6[_0x3ec570(0x161)]['id'],_0x3214d4=_0x52c8e6[_0x3ec570(0xfc)]?.['id'][_0x3ec570(0x171)]();if(!_0x3214d4)return;try{const _0xff4de2=await database_1[_0x3ec570(0xb3)]['telegramUser']['findUnique']({'where':{'telegramId':_0x3214d4},'include':{'shop':!![]}});if(!_0xff4de2){await this[_0x3ec570(0x177)]?.[_0x3ec570(0xd7)](_0x27abb5,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+'Use\x20/start\x20to\x20begin.');return;}if(!_0xff4de2['isVerified']||!_0xff4de2[_0x3ec570(0x115)]||!_0xff4de2[_0x3ec570(0x146)]){await this[_0x3ec570(0x177)]?.[_0x3ec570(0xd7)](_0x27abb5,_0x3ec570(0xb6)+_0x3ec570(0x159));return;}await this[_0x3ec570(0x177)]?.[_0x3ec570(0xd7)](_0x27abb5,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x3ec570(0x111)+_0xff4de2[_0x3ec570(0x146)][_0x3ec570(0xbd)]+'*\x0a')+(_0x3ec570(0x13c)+_0xff4de2[_0x3ec570(0x146)][_0x3ec570(0xc5)]+'`\x0a')+(_0x3ec570(0xfe)+_0xff4de2[_0x3ec570(0x148)][_0x3ec570(0x157)](_0x3ec570(0xa6))+'\x0a\x0a')+_0x3ec570(0x12b)+'Commands:\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'});}catch(_0x5a1814){console[_0x3ec570(0x11d)](_0x3ec570(0x176),_0x5a1814),await this[_0x3ec570(0x177)]?.[_0x3ec570(0xd7)](_0x27abb5,_0x3ec570(0x133));}}),this[_0x4241a2(0x177)][_0x4241a2(0x14e)](/\/debug/,async _0x2f02ff=>{const _0x29372f=_0x4241a2,_0x1fe0f7=_0x2f02ff['chat']['id'],_0xa4c2a2=_0x2f02ff[_0x29372f(0xfc)]?.['id'][_0x29372f(0x171)]();if(!_0xa4c2a2)return;try{const _0x5b273b=await database_1[_0x29372f(0xb3)][_0x29372f(0x146)][_0x29372f(0x145)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x45a7e6=_0x29372f(0xce);_0x45a7e6+=_0x29372f(0x104)+_0xa4c2a2+_0x29372f(0xde),_0x45a7e6+=_0x29372f(0x12e),_0x5b273b[_0x29372f(0xca)]((_0x15023f,_0x696331)=>{const _0x2f564c=_0x29372f;_0x45a7e6+=_0x696331+0x1+_0x2f564c(0xa4)+_0x15023f['name']+'*\x0a',_0x45a7e6+=_0x2f564c(0xa5)+_0x15023f[_0x2f564c(0xc5)]+'`\x0a',_0x45a7e6+=_0x2f564c(0x170)+_0x15023f[_0x2f564c(0x11c)]+'\x0a',_0x45a7e6+='\x20\x20\x20Public\x20Key:\x20`'+_0x15023f[_0x2f564c(0x144)][_0x2f564c(0x16a)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x29372f(0x177)]?.[_0x29372f(0xd7)](_0x1fe0f7,_0x45a7e6,{'parse_mode':_0x29372f(0x11e)});}catch(_0x11ac4d){console['error'](_0x29372f(0x114),_0x11ac4d),await this['bot']?.[_0x29372f(0xd7)](_0x1fe0f7,_0x29372f(0xd0));}}),this[_0x4241a2(0x177)]['on'](_0x4241a2(0x126),async _0x1b134b=>{const _0x533767=_0x4241a2;if(_0x1b134b[_0x533767(0x131)]?.[_0x533767(0x15b)]('/'))return;const _0x587a0b=_0x1b134b[_0x533767(0x161)]['id'],_0x11fbdf=_0x1b134b[_0x533767(0xfc)]?.['id'][_0x533767(0x171)](),_0x2f8f0b=_0x1b134b[_0x533767(0x131)]?.[_0x533767(0x119)]();if(!_0x11fbdf||!_0x2f8f0b)return;try{const _0x10942e=await database_1['default'][_0x533767(0x17d)][_0x533767(0x12d)]({'where':{'telegramId':_0x11fbdf},'include':{'shop':!![]}});if(!_0x10942e){await this[_0x533767(0x177)]?.[_0x533767(0xd7)](_0x587a0b,_0x533767(0xaf));return;}if(_0x10942e['isVerified']&&_0x10942e[_0x533767(0x115)]&&_0x10942e[_0x533767(0x146)]){await this[_0x533767(0x177)]?.['sendMessage'](_0x587a0b,_0x533767(0xff)+_0x10942e[_0x533767(0x146)][_0x533767(0xbd)]+'*.\x0a\x0a'+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x533767(0x11e)});return;}const _0x25ce57=_0x2f8f0b[_0x533767(0x128)](/\s+/);if(_0x25ce57[_0x533767(0x134)]!==0x2){await this[_0x533767(0x177)]?.[_0x533767(0xd7)](_0x587a0b,_0x533767(0x9e)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+'Example:\x0a'+_0x533767(0x121)+(_0x533767(0x13f)+_0x25ce57[_0x533767(0x134)]+_0x533767(0x135)+_0x25ce57['map'](_0xc0f827=>'`'+_0xc0f827+'`')['join'](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x379768,_0xe2b15]=_0x25ce57;console['log'](_0x533767(0xdc)+_0x11fbdf+_0x533767(0x174)+_0x379768+'\x22,\x20apiKey=\x22'+_0xe2b15[_0x533767(0x16a)](0x0,0xa)+_0x533767(0xa2)),await this['handleSingleLineVerification'](_0x587a0b,_0x11fbdf,_0x379768,_0xe2b15);}catch(_0x262c58){console[_0x533767(0x11d)](_0x533767(0x9d),_0x262c58),await this[_0x533767(0x177)]?.['sendMessage'](_0x587a0b,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x4241a2(0x177)]['on'](_0x4241a2(0x11d),_0x5e224e=>{const _0x477c04=_0x4241a2;console[_0x477c04(0x11d)](_0x477c04(0xdd),_0x5e224e);}),this[_0x4241a2(0x177)]['on'](_0x4241a2(0xf0),_0x43af95=>{const _0xa80cb6=_0x4241a2;console[_0xa80cb6(0x11d)](_0xa80cb6(0x153),_0x43af95);});}async['handleSingleLineVerification'](_0x41c170,_0x92177,_0x404074,_0xd79f4b){const _0x4521ed=a57_0x12b213;try{console[_0x4521ed(0x136)](_0x4521ed(0xdc)+_0x92177+_0x4521ed(0x174)+_0x404074+_0x4521ed(0x9c)+_0xd79f4b['substring'](0x0,0xa)+_0x4521ed(0xa2));if(!_0x404074||_0x404074[_0x4521ed(0x134)]<0x3||_0x404074['length']>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x404074)){await this[_0x4521ed(0x177)]?.[_0x4521ed(0xd7)](_0x41c170,_0x4521ed(0xa1)+_0x404074+_0x4521ed(0xde)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x4521ed(0x11e)});return;}if(!_0xd79f4b||!_0xd79f4b[_0x4521ed(0x15b)](_0x4521ed(0x108))&&!_0xd79f4b[_0x4521ed(0x15b)](_0x4521ed(0xe8))){await this[_0x4521ed(0x177)]?.['sendMessage'](_0x41c170,_0x4521ed(0xf5)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x4521ed(0x11e)});return;}const _0x222c21=await database_1[_0x4521ed(0xb3)]['shop']['findUnique']({'where':{'username':_0x404074},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x222c21){const _0x31f1e6=await database_1[_0x4521ed(0xb3)][_0x4521ed(0x146)][_0x4521ed(0x145)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x35bd27=_0x4521ed(0xad)+_0x404074+_0x4521ed(0x15d);_0x31f1e6[_0x4521ed(0x134)]>0x0?(_0x35bd27+=_0x4521ed(0xd9),_0x31f1e6[_0x4521ed(0xca)](_0x125379=>{const _0x50c979=_0x4521ed;_0x35bd27+='•\x20`'+_0x125379['username']+_0x50c979(0x168)+_0x125379['name']+')\x0a';}),_0x35bd27+=_0x4521ed(0x102)):_0x35bd27+=_0x4521ed(0x166);await this[_0x4521ed(0x177)]?.['sendMessage'](_0x41c170,_0x35bd27,{'parse_mode':_0x4521ed(0x11e)});return;}if(_0x222c21[_0x4521ed(0x11c)]!=='ACTIVE'){await this[_0x4521ed(0x177)]?.['sendMessage'](_0x41c170,_0x4521ed(0x141)+_0x404074+'`\x20is\x20inactive.\x0a\x0a'+_0x4521ed(0xeb),{'parse_mode':_0x4521ed(0x11e)});return;}if(_0x222c21[_0x4521ed(0x144)]!==_0xd79f4b&&_0x222c21[_0x4521ed(0xd6)]!==_0xd79f4b){await this[_0x4521ed(0x177)]?.[_0x4521ed(0xd7)](_0x41c170,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x404074+_0x4521ed(0x14c)+_0x4521ed(0x10a)+_0x4521ed(0xfb),{'parse_mode':_0x4521ed(0x11e)});return;}const _0x4dc929=await database_1['default'][_0x4521ed(0x17d)][_0x4521ed(0x160)]({'where':{'shopId':_0x222c21['id'],'isVerified':!![],'telegramId':{'not':_0x92177}}});if(_0x4dc929){await this[_0x4521ed(0x177)]?.[_0x4521ed(0xd7)](_0x41c170,_0x4521ed(0xa9)+_0x404074+'`.\x0a\x0a'+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':'Markdown'});return;}await database_1[_0x4521ed(0xb3)][_0x4521ed(0x17d)][_0x4521ed(0xa7)]({'where':{'telegramId':_0x92177},'data':{'shopId':_0x222c21['id'],'isVerified':!![]}}),await this[_0x4521ed(0x177)]?.[_0x4521ed(0xd7)](_0x41c170,_0x4521ed(0xef)+_0x4521ed(0x12f)+(_0x4521ed(0xe2)+_0x222c21['name']+'*\x0a')+(_0x4521ed(0x13c)+_0x222c21[_0x4521ed(0xc5)]+_0x4521ed(0xde))+_0x4521ed(0x110)+'•\x20New\x20payments\x0a'+'•\x20Payment\x20status\x20changes\x0a'+_0x4521ed(0xaa)+_0x4521ed(0x129)+'Commands:\x0a'+_0x4521ed(0xbe)+_0x4521ed(0xb5),{'parse_mode':_0x4521ed(0x11e)}),console[_0x4521ed(0x136)](_0x4521ed(0x14b)+_0x92177+'\x20verified\x20for\x20shop\x20'+_0x222c21[_0x4521ed(0xc5)]+_0x4521ed(0x12a));}catch(_0x1c79f6){console[_0x4521ed(0x11d)](_0x4521ed(0xc0),_0x1c79f6),await this[_0x4521ed(0x177)]?.[_0x4521ed(0xd7)](_0x41c170,_0x4521ed(0x14a));}}async['sendShopNotification'](_0x28f292,_0x5e417e,_0x312eb3){const _0x4fea33=a57_0x12b213;if(!this[_0x4fea33(0x177)]){console[_0x4fea33(0x117)](_0x4fea33(0x10d));return;}try{const _0x4c0aa2=await database_1[_0x4fea33(0xb3)][_0x4fea33(0x17d)][_0x4fea33(0x145)]({'where':{'shopId':_0x28f292,'isVerified':!![]}});if(_0x4c0aa2[_0x4fea33(0x134)]===0x0){console[_0x4fea33(0x136)](_0x4fea33(0xac)+_0x28f292);return;}const _0x232b6c=_0x4c0aa2[_0x4fea33(0xc9)](async _0x327335=>{const _0x36a35c=_0x4fea33;try{await this[_0x36a35c(0x177)]?.[_0x36a35c(0xd7)](_0x327335[_0x36a35c(0xfd)],_0x5e417e,_0x312eb3),console[_0x36a35c(0x136)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x327335[_0x36a35c(0xfd)]);}catch(_0xc4ce5){console[_0x36a35c(0x11d)](_0x36a35c(0x10f)+_0x327335['telegramId']+':',_0xc4ce5),_0xc4ce5 instanceof Error&&(_0xc4ce5[_0x36a35c(0x126)]['includes'](_0x36a35c(0x175))||_0xc4ce5[_0x36a35c(0x126)]['includes']('chat\x20not\x20found')||_0xc4ce5[_0x36a35c(0x126)]['includes'](_0x36a35c(0x16c)))&&(await database_1[_0x36a35c(0xb3)][_0x36a35c(0x17d)][_0x36a35c(0xa7)]({'where':{'id':_0x327335['id']},'data':{'isVerified':![]}}),console[_0x36a35c(0x136)]('User\x20'+_0x327335[_0x36a35c(0xfd)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x4fea33(0xb0)](_0x232b6c);}catch(_0x59c732){console['error'](_0x4fea33(0xc4),_0x59c732);}}async[a57_0x12b213(0x12c)](_0x2e7971,_0xb8dc33,_0x373ad8){const _0x583230=a57_0x12b213,_0x48c23f={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x5dbd6f={'created':_0x583230(0xe0),'paid':_0x583230(0x154),'failed':_0x583230(0xec),'expired':_0x583230(0x13b),'refund':'Payment\x20refund','chargeback':_0x583230(0x178),'processing':_0x583230(0x124)},_0x286ed4=_0x48c23f[_0x373ad8],_0x515b13=_0x5dbd6f[_0x373ad8],_0x42e59f=(0x0,gateway_1[_0x583230(0xcc)])(_0xb8dc33[_0x583230(0xc2)]);console['log'](_0x583230(0xb1)+_0xb8dc33['gateway']+_0x583230(0x15f)+_0x42e59f+'\x22');let _0x44c7f0=_0x286ed4+'\x20*'+_0x515b13+_0x583230(0xd4)+(_0x583230(0xcb)+_0xb8dc33[_0x583230(0x103)]+'\x20'+_0xb8dc33['currency']+'*\x0a')+(_0x583230(0xa0)+(_0xb8dc33[_0x583230(0xe3)]||_0xb8dc33['id'])+'`\x0a')+(_0x583230(0x137)+_0xb8dc33['id']+'`\x0a')+(_0x583230(0x14f)+_0x42e59f+'`\x0a')+(_0x583230(0x16e)+new Date(_0xb8dc33[_0x583230(0xf9)])[_0x583230(0x11f)](_0x583230(0xa6))+'\x0a');if(_0xb8dc33[_0x583230(0xf7)]||_0xb8dc33[_0x583230(0x112)]||_0xb8dc33[_0x583230(0x10c)]||_0xb8dc33[_0x583230(0x101)]||_0xb8dc33[_0x583230(0x147)]){_0x44c7f0+='\x0a👤\x20*Customer\x20Information:*\x0a';_0xb8dc33[_0x583230(0xf7)]&&(_0x44c7f0+=_0x583230(0xed)+_0xb8dc33[_0x583230(0xf7)]+'`\x0a');_0xb8dc33[_0x583230(0x112)]&&(_0x44c7f0+=_0x583230(0x167)+_0xb8dc33['customerEmail']+'`\x0a');_0xb8dc33[_0x583230(0x10c)]&&(_0x44c7f0+='🏦\x20IBAN:\x20`'+_0xb8dc33[_0x583230(0x10c)]+'`\x0a');_0xb8dc33['customerIp']&&(_0x44c7f0+='🌐\x20IP:\x20`'+_0xb8dc33[_0x583230(0x101)]+'`\x0a');if(_0xb8dc33[_0x583230(0x147)]){const _0x10753c=_0xb8dc33['customerUa'][_0x583230(0x134)]>0x32?_0xb8dc33[_0x583230(0x147)]['substring'](0x0,0x32)+_0x583230(0xc7):_0xb8dc33[_0x583230(0x147)];_0x44c7f0+=_0x583230(0xe9)+_0x10753c+'`\x0a';}}_0x373ad8===_0x583230(0xf8)&&_0xb8dc33['chargebackAmount']&&(_0x44c7f0+=_0x583230(0x150)+_0xb8dc33['chargebackAmount']+_0x583230(0x13d)),_0x373ad8===_0x583230(0x16b)&&(_0x44c7f0+=_0x583230(0x118)),_0xb8dc33['adminNotes']&&(_0x44c7f0+=_0x583230(0x107)+_0xb8dc33['adminNotes']+'\x0a'),await this['sendShopNotification'](_0x2e7971,_0x44c7f0,{'parse_mode':_0x583230(0x11e)});}async['sendPayoutNotification'](_0x4c5403,_0x530f2a,_0x506b93){const _0x505205=a57_0x12b213,_0x18ffec={'created':'📤','completed':'✅','rejected':'❌'},_0x1740da={'created':_0x505205(0x17e),'completed':_0x505205(0xbb),'rejected':_0x505205(0xf4)},_0x3b2a0b=_0x18ffec[_0x506b93],_0x37d55b=_0x1740da[_0x506b93],_0x10fc98=_0x3b2a0b+'\x20*'+_0x37d55b+_0x505205(0xd4)+(_0x505205(0x139)+_0x530f2a[_0x505205(0x103)]+_0x505205(0xcf))+(_0x505205(0xd8)+_0x530f2a[_0x505205(0xe5)]+'`\x0a')+(_0x505205(0x11a)+_0x530f2a['id']+'`\x0a')+(_0x505205(0x16e)+new Date(_0x530f2a[_0x505205(0xf9)])['toLocaleString']('en-US')+'\x0a')+(_0x530f2a['txid']?_0x505205(0xe1)+_0x530f2a[_0x505205(0xd1)]+'`':'');await this[_0x505205(0xcd)](_0x4c5403,_0x10fc98,{'parse_mode':'Markdown'});}async[a57_0x12b213(0x123)](_0x14bc2c,_0x36f876){const _0x387158=a57_0x12b213;try{const _0x5d9fd5=await database_1[_0x387158(0xb3)][_0x387158(0x155)][_0x387158(0x12d)]({'where':{'shopId':_0x14bc2c},'select':{'notificationLogin':!![]}});if(!_0x5d9fd5?.['notificationLogin']){console[_0x387158(0x136)](_0x387158(0x149)+_0x14bc2c);return;}const _0x1e7a7e=_0x36f876[_0x387158(0x120)]?'🔐':'🚨',_0x54f817=_0x36f876[_0x387158(0x120)]?_0x387158(0x127):_0x387158(0xda);let _0x4d2538=_0x1e7a7e+'\x20*'+_0x54f817+_0x387158(0xd4)+(_0x387158(0x13c)+_0x36f876[_0x387158(0xc5)]+'`\x0a')+(_0x387158(0x158)+_0x36f876[_0x387158(0x130)]['toLocaleString']('en-US')+'\x0a');_0x36f876[_0x387158(0x156)]&&(_0x4d2538+=_0x387158(0xee)+_0x36f876[_0x387158(0x156)]+'`\x0a');if(_0x36f876[_0x387158(0xf1)]){const _0x51c524=_0x36f876[_0x387158(0xf1)][_0x387158(0x134)]>0x32?_0x36f876[_0x387158(0xf1)]['substring'](0x0,0x32)+_0x387158(0xc7):_0x36f876[_0x387158(0xf1)];_0x4d2538+=_0x387158(0xe9)+_0x51c524+'`\x0a';}!_0x36f876[_0x387158(0x120)]&&(_0x4d2538+=_0x387158(0x15a)),await this[_0x387158(0xcd)](_0x14bc2c,_0x4d2538,{'parse_mode':_0x387158(0x11e)}),console[_0x387158(0x136)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x14bc2c+':\x20'+(_0x36f876[_0x387158(0x120)]?_0x387158(0x120):_0x387158(0xab)));}catch(_0x1b7256){console['error'](_0x387158(0xfa),_0x1b7256);}}async[a57_0x12b213(0x142)](_0x41b787,_0x12e9bb){const _0x508354=a57_0x12b213;try{const _0x4c9c8c=await database_1[_0x508354(0xb3)][_0x508354(0x155)]['findUnique']({'where':{'shopId':_0x41b787},'select':{'notificationApiError':!![]}});if(!_0x4c9c8c?.['notificationApiError']){console[_0x508354(0x136)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x41b787);return;}let _0x2b2d60='🚨\x20*API\x20Error*\x0a\x0a'+('🔗\x20Endpoint:\x20`'+_0x12e9bb[_0x508354(0xe5)]+'\x20'+_0x12e9bb[_0x508354(0xe7)]+'`\x0a')+(_0x508354(0x158)+_0x12e9bb[_0x508354(0x130)][_0x508354(0x11f)](_0x508354(0xa6))+'\x0a');_0x12e9bb[_0x508354(0x16d)]&&(_0x2b2d60+='📊\x20Error\x20code:\x20`'+_0x12e9bb[_0x508354(0x16d)]+'`\x0a'),_0x2b2d60+=_0x508354(0x143)+_0x12e9bb['errorMessage']+'`\x0a',_0x12e9bb[_0x508354(0xa8)]&&(_0x2b2d60+=_0x508354(0xb7)+_0x12e9bb[_0x508354(0xa8)]+'`\x0a'),_0x2b2d60+=_0x508354(0x172),await this[_0x508354(0xcd)](_0x41b787,_0x2b2d60,{'parse_mode':_0x508354(0x11e)}),console['log'](_0x508354(0xf2)+_0x41b787+':\x20'+_0x12e9bb[_0x508354(0xe7)]);}catch(_0x4b80ab){console[_0x508354(0x11d)](_0x508354(0xbf),_0x4b80ab);}}async[a57_0x12b213(0xf6)](_0x204928,_0x5da539,_0xb1dc7f){const _0x515e89=a57_0x12b213;let _0x166f6e='🔔\x20*'+_0x5da539+_0x515e89(0xd4);for(const [_0x574262,_0x1598db]of Object[_0x515e89(0xe4)](_0xb1dc7f)){_0x1598db!==null&&_0x1598db!==undefined&&(_0x166f6e+=_0x574262+_0x515e89(0xc8)+_0x1598db+'`\x0a');}await this[_0x515e89(0xcd)](_0x204928,_0x166f6e,{'parse_mode':'Markdown'});}[a57_0x12b213(0x13a)](){const _0x387f7f=a57_0x12b213;return{'isActive':!!this[_0x387f7f(0x177)],'username':this[_0x387f7f(0x169)]};}[a57_0x12b213(0xd3)](){const _0x18deeb=a57_0x12b213;this[_0x18deeb(0x177)]&&(this['bot']['stopPolling'](),this[_0x18deeb(0x177)]=null,console[_0x18deeb(0x136)](_0x18deeb(0x106)));}}exports[a57_0x12b213(0x10e)]=TelegramBotService,exports[a57_0x12b213(0xb2)]=new TelegramBotService();