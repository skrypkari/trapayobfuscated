'use strict';const a63_0x12a193=a63_0x59ab;function a63_0x3ea7(){const _0x11ed6b=['18729njhgQG','276754UaVVbh','...`\x0a\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','currency','New\x20payment\x20created','pk_','telegramId','🛑\x20Telegram\x20bot\x20stopped','Successful\x20login','`.\x0a\x0a','sendDirectFile','allSettled','68DoQQEW','sendMessage','entries','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','success','method','169794epRaFU','customerEmail','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','sendLoginNotification','botUsername','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','\x0aCheck\x20spelling\x20and\x20try\x20again.','/disconnect\x20-\x20disconnect\x20from\x20notifications','endsWith','env','failed','📊\x20Error\x20code:\x20`','length','isVerified','name','findMany','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','secretKey','🔗\x20TXID:\x20`','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','bot','📊\x20*Connection\x20Status*\x0a\x0a','log','map','/status\x20-\x20check\x20connection\x20status\x0a','📱\x20Notification\x20sent\x20to\x20','username','📅\x20Date:\x20','node-telegram-bot-api','•\x20Payment\x20status\x20changes\x0a','amount','test','•\x20`','txid','Username:\x20`','🔔\x20*','🆔\x20Request\x20ID:\x20`','remitterIban','`\x20(','image/jpeg','customerIp','\x20parts:\x20','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','warn','\x22\x20->\x20display\x20\x22','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','toString','findUnique','stopBot','Payment\x20chargeback','sendApiErrorNotification','🚨\x20*API\x20Error*\x0a\x0a','getGatewayDisplayNameForTelegram','•\x20New\x20payments\x0a','\x20\x20\x20Status:\x20','findFirst','join','ACTIVE','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','📱\x20No\x20active\x20Telegram\x20users\x20found','.jpg','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','publicKey','To\x20reconnect,\x20use\x20the\x20/start\x20command','5007665gwjcEu','❌\x20Invalid\x20username\x20format:\x20`','Payment\x20refund','../types/gateway','Failed\x20to\x20send\x20API\x20error\x20notification:','telegramBotService','.pdf','status','...','💻\x20Browser:\x20`','toLocaleString','shop','onText','default','ipAddress','🔌\x20User\x20','requestId','👤\x20Username:\x20`','endpoint','📱\x20Your\x20Telegram\x20ID:\x20`','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','chargebackAmount','\x20\x20\x20Username:\x20`','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','Error\x20in\x20handleSingleLineVerification:','unknown\x20shop','\x20via\x20single-line\x20input','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','blocked','updatedAt','❌\x20Telegram\x20bot\x20not\x20initialized','customerName','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','1866928yviKcH','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','Markdown',':\x20username=\x22','\x0a👤\x20*Customer\x20Information:*\x0a','Contact\x20administrator.','Commands:\x0a','customerUa','Payment\x20expired','\x20USD*\x0a','setupBotHandlers','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','startsWith','Failed\x20to\x20send\x20login\x20notification:','sendPayoutNotification','notificationLogin','📛\x20Name:\x20`','✅\x20File\x20sent\x20to\x20','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','9474dRbbCB','Telegram\x20bot\x20polling\x20error:','1477mpadSA','userAgent','sendShopNotification','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','✅\x20Connected\x20to\x20shop:\x20*','💸\x20Penalty\x20amount:\x20*','❌\x20Error\x20sending\x20file\x20to\x20shop:','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','📝\x20Notes:\x20','🏪\x20Available\x20shops\x20in\x20system:\x0a','Payment\x20successfully\x20paid','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','__importDefault','stopPolling','Use\x20/start\x20to\x20connect.','🆔\x20Payout\x20ID:\x20`','forEach','trim','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','adminNotes','*\x0a\x0a','notificationApiError','initializeBot','shopId','•\x20Important\x20events\x0a\x0a','gateway','shopSettings','handleSingleLineVerification','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','•\x20Payouts\x0a','📱\x20Shop:\x20*','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','`\x20is\x20inactive.\x0a\x0a','❌\x20Error\x20getting\x20debug\x20information.','📱\x20Created\x20new\x20Telegram\x20user:\x20','❌\x20Error\x20sending\x20file\x20to\x20chat:','\x20USDT*\x0a','🔔\x20Notifications\x20are\x20active\x0a\x0a','\x20(@','defineProperty','\x22,\x20apiKey=\x22','toLocaleDateString','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Payment\x20is\x20being\x20processed','includes','sendCustomNotification',':\x20`','message','error','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','first_name','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','../config/database','.\x20*','Payout\x20rejected','...\x22','Telegram\x20bot\x20error:','❌\x20Shop\x20`','en-US','Error\x20handling\x20/disconnect\x20command:','application/octet-stream','Error\x20handling\x20/start\x20command:','chat','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','create','✅\x20Telegram\x20user\x20','text','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','🎉\x20*Congratulations!*\x0a\x0a','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','\x20verified\x20for\x20shop\x20','📱\x20Telegram\x20notification:\x20gateway\x20\x22','7340NOZiHx','📅\x20Connection\x20date:\x20','❌\x20Please\x20use\x20/start\x20command\x20first','📧\x20Email:\x20`','🏦\x20IBAN:\x20`','last_name','Error\x20handling\x20message:','timestamp','🌐\x20IP:\x20`','Payment\x20failed','sendDocument','getBotInfo','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','Example:\x0a','application/pdf','\x20users\x20of\x20shop\x20','437238kGzhkv','botToken','`\x20not\x20found.\x0a\x0a','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','sk_','🏪\x20Gateway:\x20`','sendShopFile','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','✅\x20File\x20sent\x20to\x20chat\x20','from','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','\x20disconnected\x20from\x20shop\x20','TelegramBotService','🌐\x20IP\x20address:\x20`','❌\x20Error:\x20`','substring','telegramUser','update','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Use\x20/start\x20to\x20begin.','📅\x20Time:\x20','Check\x20spelling\x20and\x20try\x20again.','sendNotificationToAll','.png','TELEGRAM_BOT_TOKEN','`\x0a\x0a','📝\x20Order\x20ID:\x20`','*.\x0a\x0a','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:'];a63_0x3ea7=function(){return _0x11ed6b;};return a63_0x3ea7();}function a63_0x59ab(_0x36d022,_0x242de0){const _0x3ea705=a63_0x3ea7();return a63_0x59ab=function(_0x59ab88,_0x2b949e){_0x59ab88=_0x59ab88-0x8d;let _0x5d6057=_0x3ea705[_0x59ab88];return _0x5d6057;},a63_0x59ab(_0x36d022,_0x242de0);}(function(_0x543197,_0x2874bc){const _0x562bdd=a63_0x59ab,_0x3bef6e=_0x543197();while(!![]){try{const _0x4e7e35=parseInt(_0x562bdd(0x121))/0x1+parseInt(_0x562bdd(0x103))/0x2+-parseInt(_0x562bdd(0x134))/0x3*(parseInt(_0x562bdd(0x12d))/0x4)+-parseInt(_0x562bdd(0x174))/0x5+parseInt(_0x562bdd(0xa7))/0x6*(parseInt(_0x562bdd(0xa9))/0x7)+parseInt(_0x562bdd(0x93))/0x8+-parseInt(_0x562bdd(0x120))/0x9*(-parseInt(_0x562bdd(0xf3))/0xa);if(_0x4e7e35===_0x2874bc)break;else _0x3bef6e['push'](_0x3bef6e['shift']());}catch(_0x1bde31){_0x3bef6e['push'](_0x3bef6e['shift']());}}}(a63_0x3ea7,0x98bff));var __importDefault=this&&this[a63_0x12a193(0xb5)]||function(_0x371e7c){return _0x371e7c&&_0x371e7c['__esModule']?_0x371e7c:{'default':_0x371e7c};};Object[a63_0x12a193(0xd1)](exports,'__esModule',{'value':!![]}),exports[a63_0x12a193(0x179)]=exports[a63_0x12a193(0x10f)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a63_0x12a193(0x150))),database_1=__importDefault(require(a63_0x12a193(0xde))),gateway_1=require(a63_0x12a193(0x177));class TelegramBotService{constructor(){const _0x33cc76=a63_0x12a193;this[_0x33cc76(0x148)]=null,this[_0x33cc76(0x104)]=process['env'][_0x33cc76(0x11b)]||'',this[_0x33cc76(0x138)]=process[_0x33cc76(0x13d)]['TELEGRAM_BOT_USERNAME']||'trapay_bot',this[_0x33cc76(0x104)]?this[_0x33cc76(0xbf)]():console[_0x33cc76(0x15f)](_0x33cc76(0xb0));}['initializeBot'](){const _0x26d19e=a63_0x12a193;try{this[_0x26d19e(0x148)]=new node_telegram_bot_api_1[(_0x26d19e(0x181))](this[_0x26d19e(0x104)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x26d19e(0x14a)]('✅\x20Telegram\x20bot\x20@'+this[_0x26d19e(0x138)]+'\x20initialized\x20successfully');}catch(_0x1c1f48){console[_0x26d19e(0xda)](_0x26d19e(0x11f),_0x1c1f48);}}[a63_0x12a193(0x9d)](){const _0x509874=a63_0x12a193;if(!this[_0x509874(0x148)])return;this[_0x509874(0x148)][_0x509874(0x180)](/\/start/,async _0x186f93=>{const _0x618b0a=_0x509874,_0x5d3ec1=_0x186f93[_0x618b0a(0xe8)]['id'],_0x3a0389=_0x186f93[_0x618b0a(0x10c)]?.['id'][_0x618b0a(0x162)](),_0x1e8aa0=_0x186f93[_0x618b0a(0x10c)]?.['username'],_0x31d988=_0x186f93[_0x618b0a(0x10c)]?.[_0x618b0a(0xdc)],_0x2c2d06=_0x186f93[_0x618b0a(0x10c)]?.[_0x618b0a(0xf8)];if(!_0x3a0389)return;try{let _0x2243a1=await database_1[_0x618b0a(0x181)]['telegramUser']['findUnique']({'where':{'telegramId':_0x3a0389},'include':{'shop':!![]}});!_0x2243a1?(_0x2243a1=await database_1[_0x618b0a(0x181)][_0x618b0a(0x113)][_0x618b0a(0xea)]({'data':{'telegramId':_0x3a0389,'username':_0x1e8aa0,'firstName':_0x31d988,'lastName':_0x2c2d06,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x618b0a(0x14a)](_0x618b0a(0xcc)+_0x3a0389+_0x618b0a(0xd0)+_0x1e8aa0+')')):_0x2243a1=await database_1[_0x618b0a(0x181)][_0x618b0a(0x113)][_0x618b0a(0x114)]({'where':{'telegramId':_0x3a0389},'data':{'username':_0x1e8aa0,'firstName':_0x31d988,'lastName':_0x2c2d06},'include':{'shop':!![]}}),_0x2243a1['isVerified']&&_0x2243a1[_0x618b0a(0xc0)]&&_0x2243a1['shop']?await this['bot']?.['sendMessage'](_0x5d3ec1,'✅\x20Welcome\x20back!\x0a\x0a'+(_0x618b0a(0x18b)+_0x2243a1[_0x618b0a(0x17f)][_0x618b0a(0x142)]+'*\x0a')+(_0x618b0a(0x156)+_0x2243a1[_0x618b0a(0x17f)][_0x618b0a(0x14e)]+_0x618b0a(0x11c))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x618b0a(0x169)+_0x618b0a(0x151)+'•\x20Payouts\x0a\x0a'+_0x618b0a(0x99)+_0x618b0a(0x14c)+_0x618b0a(0x13b),{'parse_mode':'Markdown'}):(_0x2243a1['shopId']&&!_0x2243a1[_0x618b0a(0x141)]&&(await database_1[_0x618b0a(0x181)][_0x618b0a(0x113)][_0x618b0a(0x114)]({'where':{'telegramId':_0x3a0389},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x618b0a(0xa6)+_0x3a0389)),await this[_0x618b0a(0x148)]?.[_0x618b0a(0x12e)](_0x5d3ec1,_0x618b0a(0xe9)+_0x618b0a(0xc5)+_0x618b0a(0x136)+_0x618b0a(0x100)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+_0x618b0a(0x10a),{'parse_mode':_0x618b0a(0x95)}));}catch(_0x807c96){console[_0x618b0a(0xda)](_0x618b0a(0xe7),_0x807c96),await this[_0x618b0a(0x148)]?.[_0x618b0a(0x12e)](_0x5d3ec1,_0x618b0a(0x8d));}}),this[_0x509874(0x148)]['onText'](/\/disconnect/,async _0x45e34f=>{const _0x5d3096=_0x509874,_0x16e737=_0x45e34f['chat']['id'],_0x4423b2=_0x45e34f[_0x5d3096(0x10c)]?.['id'][_0x5d3096(0x162)]();if(!_0x4423b2)return;try{const _0x39a8ee=await database_1['default'][_0x5d3096(0x113)]['findUnique']({'where':{'telegramId':_0x4423b2},'include':{'shop':!![]}});if(!_0x39a8ee||!_0x39a8ee[_0x5d3096(0x141)]||!_0x39a8ee[_0x5d3096(0xc0)]){await this[_0x5d3096(0x148)]?.['sendMessage'](_0x16e737,_0x5d3096(0x9e));return;}const _0x5bd245=_0x39a8ee['shop']?.[_0x5d3096(0x142)]||_0x5d3096(0x18e);await database_1[_0x5d3096(0x181)][_0x5d3096(0x113)][_0x5d3096(0x114)]({'where':{'telegramId':_0x4423b2},'data':{'shopId':null,'isVerified':![]}}),console[_0x5d3096(0x14a)](_0x5d3096(0x183)+_0x4423b2+_0x5d3096(0x10e)+_0x39a8ee['shopId']),await this[_0x5d3096(0x148)]?.[_0x5d3096(0x12e)](_0x16e737,_0x5d3096(0x147)+_0x5bd245+_0x5d3096(0x11e)+_0x5d3096(0x173),{'parse_mode':'Markdown'});}catch(_0x5d5e66){console[_0x5d3096(0xda)](_0x5d3096(0xe5),_0x5d5e66),await this[_0x5d3096(0x148)]?.['sendMessage'](_0x16e737,_0x5d3096(0x8d));}}),this[_0x509874(0x148)]['onText'](/\/status/,async _0x1d1ab0=>{const _0x416e35=_0x509874,_0x4b7598=_0x1d1ab0['chat']['id'],_0x274764=_0x1d1ab0[_0x416e35(0x10c)]?.['id'][_0x416e35(0x162)]();if(!_0x274764)return;try{const _0x12dea9=await database_1['default']['telegramUser'][_0x416e35(0x163)]({'where':{'telegramId':_0x274764},'include':{'shop':!![]}});if(!_0x12dea9){await this[_0x416e35(0x148)]?.['sendMessage'](_0x4b7598,_0x416e35(0x171)+_0x416e35(0x116));return;}if(!_0x12dea9['isVerified']||!_0x12dea9[_0x416e35(0xc0)]||!_0x12dea9[_0x416e35(0x17f)]){await this[_0x416e35(0x148)]?.['sendMessage'](_0x4b7598,_0x416e35(0x94)+_0x416e35(0xb7));return;}await this['bot']?.['sendMessage'](_0x4b7598,_0x416e35(0x149)+(_0x416e35(0xad)+_0x12dea9[_0x416e35(0x17f)]['name']+'*\x0a')+('👤\x20Username:\x20`'+_0x12dea9[_0x416e35(0x17f)][_0x416e35(0x14e)]+'`\x0a')+(_0x416e35(0xf4)+_0x12dea9[_0x416e35(0x8f)][_0x416e35(0xd3)](_0x416e35(0xe4))+'\x0a\x0a')+_0x416e35(0xcf)+_0x416e35(0x99)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x416e35(0x95)});}catch(_0x165829){console[_0x416e35(0xda)]('Error\x20handling\x20/status\x20command:',_0x165829),await this['bot']?.[_0x416e35(0x12e)](_0x4b7598,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['onText'](/\/debug/,async _0x503b57=>{const _0x56cce5=_0x509874,_0xd25f00=_0x503b57[_0x56cce5(0xe8)]['id'],_0x93d88f=_0x503b57['from']?.['id'][_0x56cce5(0x162)]();if(!_0x93d88f)return;try{const _0x1d40ea=await database_1[_0x56cce5(0x181)][_0x56cce5(0x17f)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x30e434='🔍\x20*Debug\x20Information*\x0a\x0a';_0x30e434+=_0x56cce5(0x187)+_0x93d88f+_0x56cce5(0x11c),_0x30e434+=_0x56cce5(0xb2),_0x1d40ea[_0x56cce5(0xb9)]((_0xdf7253,_0x45243b)=>{const _0x453bd1=_0x56cce5;_0x30e434+=_0x45243b+0x1+_0x453bd1(0xdf)+_0xdf7253[_0x453bd1(0x142)]+'*\x0a',_0x30e434+=_0x453bd1(0x18a)+_0xdf7253[_0x453bd1(0x14e)]+'`\x0a',_0x30e434+=_0x453bd1(0x16a)+_0xdf7253[_0x453bd1(0x17b)]+'\x0a',_0x30e434+='\x20\x20\x20Public\x20Key:\x20`'+_0xdf7253['publicKey'][_0x453bd1(0x112)](0x0,0xf)+_0x453bd1(0x122);}),await this[_0x56cce5(0x148)]?.['sendMessage'](_0xd25f00,_0x30e434,{'parse_mode':_0x56cce5(0x95)});}catch(_0x2f2c61){console[_0x56cce5(0xda)]('Error\x20handling\x20/debug\x20command:',_0x2f2c61),await this[_0x56cce5(0x148)]?.[_0x56cce5(0x12e)](_0xd25f00,_0x56cce5(0xcb));}}),this[_0x509874(0x148)]['on'](_0x509874(0xd9),async _0x17e1c0=>{const _0x1ec01c=_0x509874;if(_0x17e1c0[_0x1ec01c(0xec)]?.['startsWith']('/'))return;const _0x33b3f4=_0x17e1c0[_0x1ec01c(0xe8)]['id'],_0x2619bc=_0x17e1c0[_0x1ec01c(0x10c)]?.['id'][_0x1ec01c(0x162)](),_0x4afe77=_0x17e1c0['text']?.[_0x1ec01c(0xba)]();if(!_0x2619bc||!_0x4afe77)return;try{const _0x530807=await database_1['default'][_0x1ec01c(0x113)]['findUnique']({'where':{'telegramId':_0x2619bc},'include':{'shop':!![]}});if(!_0x530807){await this[_0x1ec01c(0x148)]?.['sendMessage'](_0x33b3f4,_0x1ec01c(0xf5));return;}if(_0x530807[_0x1ec01c(0x141)]&&_0x530807[_0x1ec01c(0xc0)]&&_0x530807['shop']){await this[_0x1ec01c(0x148)]?.[_0x1ec01c(0x12e)](_0x33b3f4,_0x1ec01c(0xb4)+_0x530807[_0x1ec01c(0x17f)][_0x1ec01c(0x142)]+_0x1ec01c(0x11e)+_0x1ec01c(0xac),{'parse_mode':_0x1ec01c(0x95)});return;}const _0x3e6bd7=_0x4afe77['split'](/\s+/);if(_0x3e6bd7['length']!==0x2){await this[_0x1ec01c(0x148)]?.[_0x1ec01c(0x12e)](_0x33b3f4,_0x1ec01c(0x115)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+'Example:\x0a'+_0x1ec01c(0xbb)+('You\x20sent\x20'+_0x3e6bd7[_0x1ec01c(0x140)]+_0x1ec01c(0x15d)+_0x3e6bd7[_0x1ec01c(0x14b)](_0x3f9e8b=>'`'+_0x3f9e8b+'`')[_0x1ec01c(0x16c)](',\x20')),{'parse_mode':_0x1ec01c(0x95)});return;}const [_0x3400a2,_0x4b99d1]=_0x3e6bd7;console[_0x1ec01c(0x14a)](_0x1ec01c(0xd4)+_0x2619bc+_0x1ec01c(0x96)+_0x3400a2+'\x22,\x20apiKey=\x22'+_0x4b99d1[_0x1ec01c(0x112)](0x0,0xa)+'...\x22'),await this['handleSingleLineVerification'](_0x33b3f4,_0x2619bc,_0x3400a2,_0x4b99d1);}catch(_0x4aeb23){console[_0x1ec01c(0xda)](_0x1ec01c(0xf9),_0x4aeb23),await this[_0x1ec01c(0x148)]?.[_0x1ec01c(0x12e)](_0x33b3f4,_0x1ec01c(0x8d));}}),this['bot']['on'](_0x509874(0xda),_0x435c56=>{const _0x41ae6d=_0x509874;console[_0x41ae6d(0xda)](_0x41ae6d(0xe2),_0x435c56);}),this[_0x509874(0x148)]['on']('polling_error',_0x1f9c14=>{const _0xd20d77=_0x509874;console[_0xd20d77(0xda)](_0xd20d77(0xa8),_0x1f9c14);});}async[a63_0x12a193(0xc4)](_0xf39c13,_0x5fd991,_0x47d0bc,_0x4672a0){const _0x593c39=a63_0x12a193;try{console[_0x593c39(0x14a)](_0x593c39(0xd4)+_0x5fd991+':\x20username=\x22'+_0x47d0bc+_0x593c39(0xd2)+_0x4672a0[_0x593c39(0x112)](0x0,0xa)+_0x593c39(0xe1));if(!_0x47d0bc||_0x47d0bc['length']<0x3||_0x47d0bc[_0x593c39(0x140)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x593c39(0x153)](_0x47d0bc)){await this[_0x593c39(0x148)]?.[_0x593c39(0x12e)](_0xf39c13,_0x593c39(0x175)+_0x47d0bc+'`\x0a\x0a'+_0x593c39(0x92),{'parse_mode':_0x593c39(0x95)});return;}if(!_0x4672a0||!_0x4672a0[_0x593c39(0x9f)](_0x593c39(0x126))&&!_0x4672a0[_0x593c39(0x9f)](_0x593c39(0x107))){await this[_0x593c39(0x148)]?.[_0x593c39(0x12e)](_0xf39c13,_0x593c39(0x18c)+_0x593c39(0x161),{'parse_mode':'Markdown'});return;}const _0x44d702=await database_1[_0x593c39(0x181)][_0x593c39(0x17f)]['findUnique']({'where':{'username':_0x47d0bc},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x44d702){const _0x3f6b33=await database_1[_0x593c39(0x181)][_0x593c39(0x17f)][_0x593c39(0x143)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x4d1123='❌\x20Shop\x20with\x20username\x20`'+_0x47d0bc+_0x593c39(0x105);_0x3f6b33['length']>0x0?(_0x4d1123+='Available\x20usernames:\x0a',_0x3f6b33[_0x593c39(0xb9)](_0x70c4b0=>{const _0x398d0a=_0x593c39;_0x4d1123+=_0x398d0a(0x154)+_0x70c4b0[_0x398d0a(0x14e)]+_0x398d0a(0x15a)+_0x70c4b0['name']+')\x0a';}),_0x4d1123+=_0x593c39(0x13a)):_0x4d1123+=_0x593c39(0x118);await this[_0x593c39(0x148)]?.['sendMessage'](_0xf39c13,_0x4d1123,{'parse_mode':'Markdown'});return;}if(_0x44d702['status']!==_0x593c39(0x16d)){await this[_0x593c39(0x148)]?.[_0x593c39(0x12e)](_0xf39c13,_0x593c39(0xe3)+_0x47d0bc+_0x593c39(0xca)+_0x593c39(0x98),{'parse_mode':_0x593c39(0x95)});return;}if(_0x44d702[_0x593c39(0x172)]!==_0x4672a0&&_0x44d702[_0x593c39(0x145)]!==_0x4672a0){await this[_0x593c39(0x148)]?.[_0x593c39(0x12e)](_0xf39c13,_0x593c39(0xf0)+_0x47d0bc+'`.\x0a\x0a'+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x593c39(0x16e),{'parse_mode':_0x593c39(0x95)});return;}const _0x42231c=await database_1[_0x593c39(0x181)][_0x593c39(0x113)][_0x593c39(0x16b)]({'where':{'shopId':_0x44d702['id'],'isVerified':!![],'telegramId':{'not':_0x5fd991}}});if(_0x42231c){await this[_0x593c39(0x148)]?.['sendMessage'](_0xf39c13,_0x593c39(0x144)+_0x47d0bc+_0x593c39(0x12a)+_0x593c39(0xff),{'parse_mode':_0x593c39(0x95)});return;}await database_1[_0x593c39(0x181)][_0x593c39(0x113)][_0x593c39(0x114)]({'where':{'telegramId':_0x5fd991},'data':{'shopId':_0x44d702['id'],'isVerified':!![]}}),await this['bot']?.[_0x593c39(0x12e)](_0xf39c13,_0x593c39(0xef)+_0x593c39(0x10d)+(_0x593c39(0xc7)+_0x44d702['name']+'*\x0a')+(_0x593c39(0x185)+_0x44d702['username']+_0x593c39(0x11c))+_0x593c39(0x15e)+_0x593c39(0x169)+_0x593c39(0x151)+_0x593c39(0xc6)+_0x593c39(0xc1)+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x593c39(0x13b),{'parse_mode':_0x593c39(0x95)}),console[_0x593c39(0x14a)](_0x593c39(0xeb)+_0x5fd991+_0x593c39(0xf1)+_0x44d702[_0x593c39(0x14e)]+_0x593c39(0x18f));}catch(_0x5d389e){console['error'](_0x593c39(0x18d),_0x5d389e),await this[_0x593c39(0x148)]?.[_0x593c39(0x12e)](_0xf39c13,_0x593c39(0x123));}}async[a63_0x12a193(0xab)](_0xd12f4,_0x1675a8,_0x11f187){const _0x79b839=a63_0x12a193;if(!this['bot']){console[_0x79b839(0x15f)](_0x79b839(0x106));return;}try{const _0x38d15b=await database_1[_0x79b839(0x181)][_0x79b839(0x113)][_0x79b839(0x143)]({'where':{'shopId':_0xd12f4,'isVerified':!![]}});if(_0x38d15b[_0x79b839(0x140)]===0x0){console[_0x79b839(0x14a)](_0x79b839(0x131)+_0xd12f4);return;}const _0x189c2=_0x38d15b[_0x79b839(0x14b)](async _0x12c5e3=>{const _0xe24b52=_0x79b839;try{await this[_0xe24b52(0x148)]?.[_0xe24b52(0x12e)](_0x12c5e3[_0xe24b52(0x127)],_0x1675a8,_0x11f187),console[_0xe24b52(0x14a)](_0xe24b52(0x188)+_0x12c5e3[_0xe24b52(0x127)]);}catch(_0x2177d7){console['error']('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x12c5e3['telegramId']+':',_0x2177d7),_0x2177d7 instanceof Error&&(_0x2177d7[_0xe24b52(0xd9)][_0xe24b52(0xd6)](_0xe24b52(0x8e))||_0x2177d7[_0xe24b52(0xd9)]['includes']('chat\x20not\x20found')||_0x2177d7['message'][_0xe24b52(0xd6)]('user\x20is\x20deactivated'))&&(await database_1[_0xe24b52(0x181)]['telegramUser'][_0xe24b52(0x114)]({'where':{'id':_0x12c5e3['id']},'data':{'isVerified':![]}}),console[_0xe24b52(0x14a)]('User\x20'+_0x12c5e3[_0xe24b52(0x127)]+_0xe24b52(0xdd)));}});await Promise[_0x79b839(0x12c)](_0x189c2);}catch(_0x5a830b){console['error']('Error\x20sending\x20shop\x20notification:',_0x5a830b);}}async['sendPaymentNotification'](_0x4ca9fa,_0x117c0f,_0x44a009){const _0x1f759d=a63_0x12a193,_0x2fd587={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x3eda7a={'created':_0x1f759d(0x125),'paid':_0x1f759d(0xb3),'failed':_0x1f759d(0xfc),'expired':_0x1f759d(0x9b),'refund':_0x1f759d(0x176),'chargeback':_0x1f759d(0x165),'processing':_0x1f759d(0xd5)},_0x5b133d=_0x2fd587[_0x44a009],_0x3a3720=_0x3eda7a[_0x44a009],_0x422dc9=(0x0,gateway_1[_0x1f759d(0x168)])(_0x117c0f[_0x1f759d(0xc2)]);console['log'](_0x1f759d(0xf2)+_0x117c0f['gateway']+_0x1f759d(0x160)+_0x422dc9+'\x22');let _0x46c442=_0x5b133d+'\x20*'+_0x3a3720+'*\x0a\x0a'+('💰\x20Amount:\x20*'+_0x117c0f[_0x1f759d(0x152)]+'\x20'+_0x117c0f[_0x1f759d(0x124)]+'*\x0a')+(_0x1f759d(0x11d)+(_0x117c0f['orderId']||_0x117c0f['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x117c0f['id']+'`\x0a')+(_0x1f759d(0x108)+_0x422dc9+'`\x0a')+(_0x1f759d(0x14f)+new Date(_0x117c0f['createdAt'])[_0x1f759d(0x17e)](_0x1f759d(0xe4))+'\x0a');if(_0x117c0f[_0x1f759d(0x91)]||_0x117c0f[_0x1f759d(0x135)]||_0x117c0f[_0x1f759d(0x159)]||_0x117c0f[_0x1f759d(0x15c)]||_0x117c0f[_0x1f759d(0x9a)]){_0x46c442+=_0x1f759d(0x97);_0x117c0f[_0x1f759d(0x91)]&&(_0x46c442+=_0x1f759d(0xa3)+_0x117c0f[_0x1f759d(0x91)]+'`\x0a');_0x117c0f[_0x1f759d(0x135)]&&(_0x46c442+=_0x1f759d(0xf6)+_0x117c0f[_0x1f759d(0x135)]+'`\x0a');_0x117c0f['remitterIban']&&(_0x46c442+=_0x1f759d(0xf7)+_0x117c0f['remitterIban']+'`\x0a');_0x117c0f[_0x1f759d(0x15c)]&&(_0x46c442+=_0x1f759d(0xfb)+_0x117c0f[_0x1f759d(0x15c)]+'`\x0a');if(_0x117c0f['customerUa']){const _0x231b2b=_0x117c0f[_0x1f759d(0x9a)][_0x1f759d(0x140)]>0x32?_0x117c0f[_0x1f759d(0x9a)][_0x1f759d(0x112)](0x0,0x32)+_0x1f759d(0x17c):_0x117c0f[_0x1f759d(0x9a)];_0x46c442+=_0x1f759d(0x17d)+_0x231b2b+'`\x0a';}}_0x44a009==='chargeback'&&_0x117c0f[_0x1f759d(0x189)]&&(_0x46c442+=_0x1f759d(0xae)+_0x117c0f[_0x1f759d(0x189)]+_0x1f759d(0xce)),_0x44a009==='processing'&&(_0x46c442+=_0x1f759d(0xc8)),_0x117c0f[_0x1f759d(0xbc)]&&(_0x46c442+=_0x1f759d(0xb1)+_0x117c0f[_0x1f759d(0xbc)]+'\x0a'),await this[_0x1f759d(0xab)](_0x4ca9fa,_0x46c442,{'parse_mode':_0x1f759d(0x95)});}async[a63_0x12a193(0xa1)](_0x49bbec,_0x374404,_0x345fc3){const _0x463fd8=a63_0x12a193,_0x4ff75d={'created':'📤','completed':'✅','rejected':'❌'},_0x4e28f2={'created':'New\x20payout\x20created','completed':'Payout\x20completed','rejected':_0x463fd8(0xe0)},_0x512b29=_0x4ff75d[_0x345fc3],_0x1b23c5=_0x4e28f2[_0x345fc3],_0x4a857a=_0x512b29+'\x20*'+_0x1b23c5+_0x463fd8(0xbd)+('💸\x20Amount:\x20*'+_0x374404['amount']+_0x463fd8(0x9c))+('🏦\x20Method:\x20`'+_0x374404[_0x463fd8(0x133)]+'`\x0a')+(_0x463fd8(0xb8)+_0x374404['id']+'`\x0a')+(_0x463fd8(0x14f)+new Date(_0x374404['createdAt'])[_0x463fd8(0x17e)](_0x463fd8(0xe4))+'\x0a')+(_0x374404[_0x463fd8(0x155)]?_0x463fd8(0x146)+_0x374404[_0x463fd8(0x155)]+'`':'');await this[_0x463fd8(0xab)](_0x49bbec,_0x4a857a,{'parse_mode':'Markdown'});}async[a63_0x12a193(0x137)](_0x41345a,_0xf5f9d8){const _0x10b760=a63_0x12a193;try{const _0x2c7e5e=await database_1[_0x10b760(0x181)]['shopSettings'][_0x10b760(0x163)]({'where':{'shopId':_0x41345a},'select':{'notificationLogin':!![]}});if(!_0x2c7e5e?.[_0x10b760(0xa2)]){console['log']('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x41345a);return;}const _0xe78ce7=_0xf5f9d8[_0x10b760(0x132)]?'🔐':'🚨',_0x4e4902=_0xf5f9d8[_0x10b760(0x132)]?_0x10b760(0x129):'Failed\x20login\x20attempt';let _0x1df1de=_0xe78ce7+'\x20*'+_0x4e4902+'*\x0a\x0a'+(_0x10b760(0x185)+_0xf5f9d8[_0x10b760(0x14e)]+'`\x0a')+(_0x10b760(0x117)+_0xf5f9d8['timestamp'][_0x10b760(0x17e)](_0x10b760(0xe4))+'\x0a');_0xf5f9d8[_0x10b760(0x182)]&&(_0x1df1de+=_0x10b760(0x110)+_0xf5f9d8[_0x10b760(0x182)]+'`\x0a');if(_0xf5f9d8[_0x10b760(0xaa)]){const _0x56f6fe=_0xf5f9d8[_0x10b760(0xaa)][_0x10b760(0x140)]>0x32?_0xf5f9d8[_0x10b760(0xaa)][_0x10b760(0x112)](0x0,0x32)+'...':_0xf5f9d8[_0x10b760(0xaa)];_0x1df1de+=_0x10b760(0x17d)+_0x56f6fe+'`\x0a';}!_0xf5f9d8[_0x10b760(0x132)]&&(_0x1df1de+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x10b760(0xab)](_0x41345a,_0x1df1de,{'parse_mode':_0x10b760(0x95)}),console['log']('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x41345a+':\x20'+(_0xf5f9d8['success']?_0x10b760(0x132):_0x10b760(0x13e)));}catch(_0x918f81){console[_0x10b760(0xda)](_0x10b760(0xa0),_0x918f81);}}async[a63_0x12a193(0x166)](_0x388da8,_0x599d85){const _0x466fa0=a63_0x12a193;try{const _0x5cfcee=await database_1[_0x466fa0(0x181)][_0x466fa0(0xc3)][_0x466fa0(0x163)]({'where':{'shopId':_0x388da8},'select':{'notificationApiError':!![]}});if(!_0x5cfcee?.[_0x466fa0(0xbe)]){console['log'](_0x466fa0(0x139)+_0x388da8);return;}let _0x306204=_0x466fa0(0x167)+('🔗\x20Endpoint:\x20`'+_0x599d85[_0x466fa0(0x133)]+'\x20'+_0x599d85[_0x466fa0(0x186)]+'`\x0a')+('📅\x20Time:\x20'+_0x599d85[_0x466fa0(0xfa)][_0x466fa0(0x17e)](_0x466fa0(0xe4))+'\x0a');_0x599d85['statusCode']&&(_0x306204+=_0x466fa0(0x13f)+_0x599d85['statusCode']+'`\x0a'),_0x306204+=_0x466fa0(0x111)+_0x599d85['errorMessage']+'`\x0a',_0x599d85[_0x466fa0(0x184)]&&(_0x306204+=_0x466fa0(0x158)+_0x599d85[_0x466fa0(0x184)]+'`\x0a'),_0x306204+=_0x466fa0(0x130),await this[_0x466fa0(0xab)](_0x388da8,_0x306204,{'parse_mode':'Markdown'}),console[_0x466fa0(0x14a)](_0x466fa0(0xed)+_0x388da8+':\x20'+_0x599d85['endpoint']);}catch(_0x3df57e){console['error'](_0x466fa0(0x178),_0x3df57e);}}async[a63_0x12a193(0xd7)](_0x38015f,_0x2542b5,_0x746dd2){const _0x13acbe=a63_0x12a193;let _0x5ec1ce=_0x13acbe(0x157)+_0x2542b5+_0x13acbe(0xbd);for(const [_0x25e027,_0x59246c]of Object[_0x13acbe(0x12f)](_0x746dd2)){_0x59246c!==null&&_0x59246c!==undefined&&(_0x5ec1ce+=_0x25e027+_0x13acbe(0xd8)+_0x59246c+'`\x0a');}await this[_0x13acbe(0xab)](_0x38015f,_0x5ec1ce,{'parse_mode':_0x13acbe(0x95)});}async[a63_0x12a193(0x119)](_0x51f915){const _0x3a8f70=a63_0x12a193;try{console['log'](_0x3a8f70(0xee)+_0x51f915[_0x3a8f70(0x112)](0x0,0x32)+_0x3a8f70(0x17c));const _0x89f629=await database_1[_0x3a8f70(0x181)][_0x3a8f70(0x113)][_0x3a8f70(0x143)]({'select':{'telegramId':!![]}});if(_0x89f629[_0x3a8f70(0x140)]===0x0){console['log'](_0x3a8f70(0x16f));return;}for(const _0x304165 of _0x89f629){try{await this['bot']?.[_0x3a8f70(0x12e)](_0x304165[_0x3a8f70(0x127)],_0x51f915,{'parse_mode':_0x3a8f70(0x95)});}catch(_0x4fab1c){console[_0x3a8f70(0xda)](_0x3a8f70(0xdb)+_0x304165[_0x3a8f70(0x127)]+':',_0x4fab1c);}}console['log'](_0x3a8f70(0x14d)+_0x89f629[_0x3a8f70(0x140)]+'\x20users');}catch(_0x4ee19d){console[_0x3a8f70(0xda)](_0x3a8f70(0xc9),_0x4ee19d);}}[a63_0x12a193(0xfe)](){const _0x44fc22=a63_0x12a193;return{'isActive':!!this[_0x44fc22(0x148)],'username':this[_0x44fc22(0x138)]};}async[a63_0x12a193(0x109)](_0x20daf5,_0x479442,_0x3ab484,_0x11eae0){const _0x3be656=a63_0x12a193;try{if(!this[_0x3be656(0x148)])return console['error']('❌\x20Telegram\x20bot\x20not\x20initialized'),![];const _0x6974a7=await database_1[_0x3be656(0x181)][_0x3be656(0x113)][_0x3be656(0x143)]({'where':{'shopId':_0x20daf5,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x6974a7[_0x3be656(0x140)]===0x0)return console[_0x3be656(0xda)](_0x3be656(0xa5)+_0x20daf5),![];let _0x5e82ad=0x0;for(const _0x49340c of _0x6974a7){try{await this[_0x3be656(0x148)][_0x3be656(0xfd)](_0x49340c[_0x3be656(0x127)],_0x479442,{},{'filename':_0x3ab484,'contentType':_0x3ab484[_0x3be656(0x13c)](_0x3be656(0x11a))?'image/png':_0x3ab484[_0x3be656(0x13c)](_0x3be656(0x170))||_0x3ab484[_0x3be656(0x13c)]('.jpeg')?_0x3be656(0x15b):_0x3ab484[_0x3be656(0x13c)](_0x3be656(0x17a))?_0x3be656(0x101):_0x3be656(0xe6)}),_0x11eae0&&await this[_0x3be656(0x148)][_0x3be656(0x12e)](_0x49340c[_0x3be656(0x127)],_0x11eae0),_0x5e82ad++;}catch(_0x1159a4){console['error']('❌\x20Error\x20sending\x20file\x20to\x20user\x20'+_0x49340c[_0x3be656(0x127)]+':',_0x1159a4);}}return console['log'](_0x3be656(0xa4)+_0x5e82ad+'/'+_0x6974a7['length']+_0x3be656(0x102)+_0x20daf5+':\x20'+_0x3ab484),_0x5e82ad>0x0;}catch(_0x45dce3){return console[_0x3be656(0xda)](_0x3be656(0xaf),_0x45dce3),![];}}async['sendDirectMessage'](_0x12b645,_0x115b23){const _0x53a3a4=a63_0x12a193;try{if(!this[_0x53a3a4(0x148)])return console['error'](_0x53a3a4(0x90)),![];return await this[_0x53a3a4(0x148)][_0x53a3a4(0x12e)](_0x12b645,_0x115b23),console[_0x53a3a4(0x14a)]('✅\x20Direct\x20message\x20sent\x20to\x20chat\x20'+_0x12b645),!![];}catch(_0x177100){return console['error']('❌\x20Error\x20sending\x20direct\x20message:',_0x177100),![];}}async[a63_0x12a193(0x12b)](_0x509913,_0x3262db,_0x3bf5c7,_0x5adceb){const _0x262b70=a63_0x12a193;try{if(!this[_0x262b70(0x148)])return console['error'](_0x262b70(0x90)),![];return await this[_0x262b70(0x148)][_0x262b70(0xfd)](_0x509913,_0x3262db,{},{'filename':_0x3bf5c7,'contentType':_0x3bf5c7[_0x262b70(0x13c)](_0x262b70(0x11a))?'image/png':_0x3bf5c7[_0x262b70(0x13c)](_0x262b70(0x170))||_0x3bf5c7['endsWith']('.jpeg')?'image/jpeg':_0x3bf5c7[_0x262b70(0x13c)](_0x262b70(0x17a))?_0x262b70(0x101):_0x262b70(0xe6)}),_0x5adceb&&await this[_0x262b70(0x148)][_0x262b70(0x12e)](_0x509913,_0x5adceb),console[_0x262b70(0x14a)](_0x262b70(0x10b)+_0x509913+':\x20'+_0x3bf5c7),!![];}catch(_0x8d30a9){return console['error'](_0x262b70(0xcd),_0x8d30a9),![];}}[a63_0x12a193(0x164)](){const _0x39660e=a63_0x12a193;this[_0x39660e(0x148)]&&(this[_0x39660e(0x148)][_0x39660e(0xb6)](),this[_0x39660e(0x148)]=null,console[_0x39660e(0x14a)](_0x39660e(0x128)));}}exports[a63_0x12a193(0x10f)]=TelegramBotService,exports[a63_0x12a193(0x179)]=new TelegramBotService();