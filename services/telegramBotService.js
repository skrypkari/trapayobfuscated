'use strict';function a54_0x2d10(_0x3892c1,_0x6cec37){const _0x54d032=a54_0x54d0();return a54_0x2d10=function(_0x2d10dc,_0xa5635b){_0x2d10dc=_0x2d10dc-0x129;let _0x19dc3d=_0x54d032[_0x2d10dc];return _0x19dc3d;},a54_0x2d10(_0x3892c1,_0x6cec37);}const a54_0x194d2c=a54_0x2d10;(function(_0x3ff109,_0x2eecc6){const _0x557f1f=a54_0x2d10,_0x1dd3ee=_0x3ff109();while(!![]){try{const _0x2753da=-parseInt(_0x557f1f(0x1f4))/0x1*(parseInt(_0x557f1f(0x145))/0x2)+parseInt(_0x557f1f(0x1be))/0x3+-parseInt(_0x557f1f(0x129))/0x4+-parseInt(_0x557f1f(0x1a0))/0x5+-parseInt(_0x557f1f(0x1a6))/0x6*(-parseInt(_0x557f1f(0x167))/0x7)+parseInt(_0x557f1f(0x1a2))/0x8*(parseInt(_0x557f1f(0x189))/0x9)+parseInt(_0x557f1f(0x14c))/0xa*(parseInt(_0x557f1f(0x184))/0xb);if(_0x2753da===_0x2eecc6)break;else _0x1dd3ee['push'](_0x1dd3ee['shift']());}catch(_0x269b04){_0x1dd3ee['push'](_0x1dd3ee['shift']());}}}(a54_0x54d0,0x526c5));var __importDefault=this&&this['__importDefault']||function(_0x120f1c){const _0x59810c=a54_0x2d10;return _0x120f1c&&_0x120f1c[_0x59810c(0x1c2)]?_0x120f1c:{'default':_0x120f1c};};Object[a54_0x194d2c(0x13f)](exports,a54_0x194d2c(0x1c2),{'value':!![]}),exports['telegramBotService']=exports[a54_0x194d2c(0x164)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x194d2c(0x1ef))),database_1=__importDefault(require('../config/database')),gateway_1=require(a54_0x194d2c(0x179));class TelegramBotService{constructor(){const _0x22fd89=a54_0x194d2c;this['bot']=null,this[_0x22fd89(0x1f6)]=process[_0x22fd89(0x1fc)][_0x22fd89(0x1e8)]||'',this[_0x22fd89(0x194)]=process[_0x22fd89(0x1fc)]['TELEGRAM_BOT_USERNAME']||_0x22fd89(0x15d),this[_0x22fd89(0x1f6)]?this[_0x22fd89(0x16b)]():console[_0x22fd89(0x134)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a54_0x194d2c(0x16b)](){const _0x30e2af=a54_0x194d2c;try{this[_0x30e2af(0x1d1)]=new node_telegram_bot_api_1['default'](this[_0x30e2af(0x1f6)],{'polling':!![]}),this[_0x30e2af(0x16e)](),console[_0x30e2af(0x191)](_0x30e2af(0x1a3)+this[_0x30e2af(0x194)]+_0x30e2af(0x195));}catch(_0xd8b9ff){console['error'](_0x30e2af(0x131),_0xd8b9ff);}}['setupBotHandlers'](){const _0x70f9e2=a54_0x194d2c;if(!this[_0x70f9e2(0x1d1)])return;this['bot'][_0x70f9e2(0x1dc)](/\/start/,async _0x863d91=>{const _0x56ed59=_0x70f9e2,_0x4b6b5a=_0x863d91['chat']['id'],_0x15f37d=_0x863d91[_0x56ed59(0x1e1)]?.['id'][_0x56ed59(0x1f2)](),_0x3a5747=_0x863d91[_0x56ed59(0x1e1)]?.[_0x56ed59(0x153)],_0x5c9d0c=_0x863d91[_0x56ed59(0x1e1)]?.['first_name'],_0x4c036f=_0x863d91[_0x56ed59(0x1e1)]?.['last_name'];if(!_0x15f37d)return;try{let _0x1594dc=await database_1['default'][_0x56ed59(0x1c0)]['findUnique']({'where':{'telegramId':_0x15f37d},'include':{'shop':!![]}});!_0x1594dc?(_0x1594dc=await database_1[_0x56ed59(0x15b)]['telegramUser'][_0x56ed59(0x13e)]({'data':{'telegramId':_0x15f37d,'username':_0x3a5747,'firstName':_0x5c9d0c,'lastName':_0x4c036f,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x56ed59(0x191)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x15f37d+'\x20(@'+_0x3a5747+')')):_0x1594dc=await database_1[_0x56ed59(0x15b)]['telegramUser'][_0x56ed59(0x196)]({'where':{'telegramId':_0x15f37d},'data':{'username':_0x3a5747,'firstName':_0x5c9d0c,'lastName':_0x4c036f},'include':{'shop':!![]}}),_0x1594dc['isVerified']&&_0x1594dc[_0x56ed59(0x1de)]&&_0x1594dc[_0x56ed59(0x1c7)]?await this[_0x56ed59(0x1d1)]?.[_0x56ed59(0x14b)](_0x4b6b5a,_0x56ed59(0x1e6)+(_0x56ed59(0x154)+_0x1594dc['shop']['name']+'*\x0a')+(_0x56ed59(0x1d4)+_0x1594dc[_0x56ed59(0x1c7)][_0x56ed59(0x153)]+_0x56ed59(0x152))+_0x56ed59(0x19f)+_0x56ed59(0x17a)+'•\x20Payment\x20status\x20changes\x0a'+_0x56ed59(0x1d7)+_0x56ed59(0x18a)+_0x56ed59(0x171)+_0x56ed59(0x15e),{'parse_mode':_0x56ed59(0x198)}):(_0x1594dc[_0x56ed59(0x1de)]&&!_0x1594dc[_0x56ed59(0x16c)]&&(await database_1[_0x56ed59(0x15b)][_0x56ed59(0x1c0)][_0x56ed59(0x196)]({'where':{'telegramId':_0x15f37d},'data':{'shopId':null,'isVerified':![]}}),console[_0x56ed59(0x191)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x15f37d)),await this[_0x56ed59(0x1d1)]?.[_0x56ed59(0x14b)](_0x4b6b5a,_0x56ed59(0x1bb)+_0x56ed59(0x155)+_0x56ed59(0x1a4)+'Example:\x0a'+_0x56ed59(0x1c3)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':'Markdown'}));}catch(_0x54f6c2){console[_0x56ed59(0x13d)](_0x56ed59(0x173),_0x54f6c2),await this[_0x56ed59(0x1d1)]?.[_0x56ed59(0x14b)](_0x4b6b5a,_0x56ed59(0x15a));}}),this[_0x70f9e2(0x1d1)]['onText'](/\/disconnect/,async _0x595420=>{const _0x29a2ad=_0x70f9e2,_0x226d22=_0x595420['chat']['id'],_0x2aa7f3=_0x595420[_0x29a2ad(0x1e1)]?.['id']['toString']();if(!_0x2aa7f3)return;try{const _0x2599bc=await database_1[_0x29a2ad(0x15b)][_0x29a2ad(0x1c0)][_0x29a2ad(0x16f)]({'where':{'telegramId':_0x2aa7f3},'include':{'shop':!![]}});if(!_0x2599bc||!_0x2599bc[_0x29a2ad(0x16c)]||!_0x2599bc[_0x29a2ad(0x1de)]){await this[_0x29a2ad(0x1d1)]?.['sendMessage'](_0x226d22,_0x29a2ad(0x12e));return;}const _0x2effd5=_0x2599bc[_0x29a2ad(0x1c7)]?.[_0x29a2ad(0x14d)]||'unknown\x20shop';await database_1[_0x29a2ad(0x15b)][_0x29a2ad(0x1c0)][_0x29a2ad(0x196)]({'where':{'telegramId':_0x2aa7f3},'data':{'shopId':null,'isVerified':![]}}),console[_0x29a2ad(0x191)](_0x29a2ad(0x186)+_0x2aa7f3+_0x29a2ad(0x18c)+_0x2599bc[_0x29a2ad(0x1de)]),await this['bot']?.[_0x29a2ad(0x14b)](_0x226d22,_0x29a2ad(0x1e9)+_0x2effd5+'*.\x0a\x0a'+_0x29a2ad(0x1b2),{'parse_mode':_0x29a2ad(0x198)});}catch(_0x7002ce){console[_0x29a2ad(0x13d)](_0x29a2ad(0x16d),_0x7002ce),await this['bot']?.[_0x29a2ad(0x14b)](_0x226d22,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x70f9e2(0x1d1)][_0x70f9e2(0x1dc)](/\/status/,async _0x23a812=>{const _0x4502e2=_0x70f9e2,_0x14b6ea=_0x23a812[_0x4502e2(0x181)]['id'],_0x5b2a41=_0x23a812['from']?.['id'][_0x4502e2(0x1f2)]();if(!_0x5b2a41)return;try{const _0x292a03=await database_1[_0x4502e2(0x15b)]['telegramUser']['findUnique']({'where':{'telegramId':_0x5b2a41},'include':{'shop':!![]}});if(!_0x292a03){await this[_0x4502e2(0x1d1)]?.[_0x4502e2(0x14b)](_0x14b6ea,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+'Use\x20/start\x20to\x20begin.');return;}if(!_0x292a03[_0x4502e2(0x16c)]||!_0x292a03['shopId']||!_0x292a03[_0x4502e2(0x1c7)]){await this['bot']?.[_0x4502e2(0x14b)](_0x14b6ea,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+'Use\x20/start\x20to\x20connect.');return;}await this[_0x4502e2(0x1d1)]?.['sendMessage'](_0x14b6ea,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x4502e2(0x19e)+_0x292a03[_0x4502e2(0x1c7)]['name']+'*\x0a')+(_0x4502e2(0x1d6)+_0x292a03[_0x4502e2(0x1c7)]['username']+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x292a03[_0x4502e2(0x151)][_0x4502e2(0x1d5)](_0x4502e2(0x163))+'\x0a\x0a')+_0x4502e2(0x182)+_0x4502e2(0x18a)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'});}catch(_0x127bb3){console[_0x4502e2(0x13d)](_0x4502e2(0x150),_0x127bb3),await this[_0x4502e2(0x1d1)]?.[_0x4502e2(0x14b)](_0x14b6ea,_0x4502e2(0x15a));}}),this[_0x70f9e2(0x1d1)][_0x70f9e2(0x1dc)](/\/debug/,async _0x3d53e5=>{const _0x593791=_0x70f9e2,_0x55bd72=_0x3d53e5[_0x593791(0x181)]['id'],_0x37d047=_0x3d53e5['from']?.['id'][_0x593791(0x1f2)]();if(!_0x37d047)return;try{const _0x3aa398=await database_1['default'][_0x593791(0x1c7)][_0x593791(0x1ce)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4279b4=_0x593791(0x197);_0x4279b4+=_0x593791(0x18d)+_0x37d047+_0x593791(0x152),_0x4279b4+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x3aa398['forEach']((_0xf2c240,_0x4a4700)=>{const _0x5f03d8=_0x593791;_0x4279b4+=_0x4a4700+0x1+'.\x20*'+_0xf2c240[_0x5f03d8(0x14d)]+'*\x0a',_0x4279b4+=_0x5f03d8(0x168)+_0xf2c240['username']+'`\x0a',_0x4279b4+=_0x5f03d8(0x192)+_0xf2c240[_0x5f03d8(0x202)]+'\x0a',_0x4279b4+=_0x5f03d8(0x1f7)+_0xf2c240[_0x5f03d8(0x1b7)][_0x5f03d8(0x1e7)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x593791(0x1d1)]?.[_0x593791(0x14b)](_0x55bd72,_0x4279b4,{'parse_mode':_0x593791(0x198)});}catch(_0x41c75d){console[_0x593791(0x13d)](_0x593791(0x17e),_0x41c75d),await this[_0x593791(0x1d1)]?.[_0x593791(0x14b)](_0x55bd72,_0x593791(0x1ec));}}),this['bot']['on']('message',async _0x5a1269=>{const _0x5d8aaa=_0x70f9e2;if(_0x5a1269[_0x5d8aaa(0x1db)]?.['startsWith']('/'))return;const _0x24bcb7=_0x5a1269[_0x5d8aaa(0x181)]['id'],_0x4ad400=_0x5a1269['from']?.['id']['toString'](),_0xf4cd64=_0x5a1269[_0x5d8aaa(0x1db)]?.[_0x5d8aaa(0x12a)]();if(!_0x4ad400||!_0xf4cd64)return;try{const _0x1c288c=await database_1[_0x5d8aaa(0x15b)]['telegramUser'][_0x5d8aaa(0x16f)]({'where':{'telegramId':_0x4ad400},'include':{'shop':!![]}});if(!_0x1c288c){await this[_0x5d8aaa(0x1d1)]?.[_0x5d8aaa(0x14b)](_0x24bcb7,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x1c288c['isVerified']&&_0x1c288c[_0x5d8aaa(0x1de)]&&_0x1c288c[_0x5d8aaa(0x1c7)]){await this[_0x5d8aaa(0x1d1)]?.[_0x5d8aaa(0x14b)](_0x24bcb7,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x1c288c[_0x5d8aaa(0x1c7)]['name']+_0x5d8aaa(0x1ed)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x5d8aaa(0x198)});return;}const _0x12ac56=_0xf4cd64['split'](/\s+/);if(_0x12ac56[_0x5d8aaa(0x19d)]!==0x2){await this[_0x5d8aaa(0x1d1)]?.['sendMessage'](_0x24bcb7,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x5d8aaa(0x12b)+_0x5d8aaa(0x1c3)+('You\x20sent\x20'+_0x12ac56['length']+'\x20parts:\x20'+_0x12ac56['map'](_0x590885=>'`'+_0x590885+'`')[_0x5d8aaa(0x136)](',\x20')),{'parse_mode':_0x5d8aaa(0x198)});return;}const [_0x4bf9ae,_0x49bca7]=_0x12ac56;console[_0x5d8aaa(0x191)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x4ad400+_0x5d8aaa(0x185)+_0x4bf9ae+_0x5d8aaa(0x18e)+_0x49bca7[_0x5d8aaa(0x1e7)](0x0,0xa)+'...\x22'),await this[_0x5d8aaa(0x1ca)](_0x24bcb7,_0x4ad400,_0x4bf9ae,_0x49bca7);}catch(_0x112f20){console[_0x5d8aaa(0x13d)](_0x5d8aaa(0x1e2),_0x112f20),await this[_0x5d8aaa(0x1d1)]?.[_0x5d8aaa(0x14b)](_0x24bcb7,_0x5d8aaa(0x15a));}}),this[_0x70f9e2(0x1d1)]['on'](_0x70f9e2(0x13d),_0x51cb23=>{const _0xe8e725=_0x70f9e2;console[_0xe8e725(0x13d)]('Telegram\x20bot\x20error:',_0x51cb23);}),this['bot']['on']('polling_error',_0x1cba0e=>{const _0x1c991d=_0x70f9e2;console[_0x1c991d(0x13d)](_0x1c991d(0x133),_0x1cba0e);});}async['handleSingleLineVerification'](_0x326eab,_0x2a4d8c,_0x35483d,_0x274f47){const _0x26258b=a54_0x194d2c;try{console[_0x26258b(0x191)](_0x26258b(0x132)+_0x2a4d8c+_0x26258b(0x185)+_0x35483d+'\x22,\x20apiKey=\x22'+_0x274f47['substring'](0x0,0xa)+_0x26258b(0x1cd));if(!_0x35483d||_0x35483d[_0x26258b(0x19d)]<0x3||_0x35483d[_0x26258b(0x19d)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x26258b(0x1b8)](_0x35483d)){await this[_0x26258b(0x1d1)]?.[_0x26258b(0x14b)](_0x326eab,_0x26258b(0x1f5)+_0x35483d+_0x26258b(0x152)+_0x26258b(0x187),{'parse_mode':_0x26258b(0x198)});return;}if(!_0x274f47||!_0x274f47[_0x26258b(0x1fd)](_0x26258b(0x1d2))&&!_0x274f47['startsWith'](_0x26258b(0x1b1))){await this[_0x26258b(0x1d1)]?.[_0x26258b(0x14b)](_0x326eab,_0x26258b(0x176)+_0x26258b(0x17f),{'parse_mode':_0x26258b(0x198)});return;}const _0x57a4e1=await database_1[_0x26258b(0x15b)][_0x26258b(0x1c7)][_0x26258b(0x16f)]({'where':{'username':_0x35483d},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x57a4e1){const _0x28ccdb=await database_1[_0x26258b(0x15b)]['shop']['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x3d5bea=_0x26258b(0x1e0)+_0x35483d+_0x26258b(0x1cb);_0x28ccdb['length']>0x0?(_0x3d5bea+=_0x26258b(0x137),_0x28ccdb[_0x26258b(0x177)](_0x42ad8a=>{const _0x42e009=_0x26258b;_0x3d5bea+=_0x42e009(0x13c)+_0x42ad8a[_0x42e009(0x153)]+_0x42e009(0x1c4)+_0x42ad8a[_0x42e009(0x14d)]+')\x0a';}),_0x3d5bea+=_0x26258b(0x1c9)):_0x3d5bea+=_0x26258b(0x1a8);await this[_0x26258b(0x1d1)]?.[_0x26258b(0x14b)](_0x326eab,_0x3d5bea,{'parse_mode':_0x26258b(0x198)});return;}if(_0x57a4e1['status']!==_0x26258b(0x1f0)){await this['bot']?.['sendMessage'](_0x326eab,'❌\x20Shop\x20`'+_0x35483d+_0x26258b(0x159)+'Contact\x20administrator.',{'parse_mode':'Markdown'});return;}if(_0x57a4e1['publicKey']!==_0x274f47&&_0x57a4e1[_0x26258b(0x1cc)]!==_0x274f47){await this[_0x26258b(0x1d1)]?.[_0x26258b(0x14b)](_0x326eab,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x35483d+_0x26258b(0x1c6)+_0x26258b(0x14f)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x26258b(0x198)});return;}const _0x5b2f48=await database_1['default'][_0x26258b(0x1c0)][_0x26258b(0x12c)]({'where':{'shopId':_0x57a4e1['id'],'isVerified':!![],'telegramId':{'not':_0x2a4d8c}}});if(_0x5b2f48){await this['bot']?.['sendMessage'](_0x326eab,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x35483d+_0x26258b(0x1c6)+_0x26258b(0x130),{'parse_mode':_0x26258b(0x198)});return;}await database_1['default'][_0x26258b(0x1c0)][_0x26258b(0x196)]({'where':{'telegramId':_0x2a4d8c},'data':{'shopId':_0x57a4e1['id'],'isVerified':!![]}}),await this[_0x26258b(0x1d1)]?.[_0x26258b(0x14b)](_0x326eab,'🎉\x20*Congratulations!*\x0a\x0a'+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x26258b(0x13b)+_0x57a4e1[_0x26258b(0x14d)]+'*\x0a')+(_0x26258b(0x1d6)+_0x57a4e1[_0x26258b(0x153)]+_0x26258b(0x152))+_0x26258b(0x14e)+_0x26258b(0x17a)+_0x26258b(0x1df)+_0x26258b(0x170)+_0x26258b(0x18f)+_0x26258b(0x18a)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x26258b(0x15e),{'parse_mode':_0x26258b(0x198)}),console['log'](_0x26258b(0x1b0)+_0x2a4d8c+_0x26258b(0x188)+_0x57a4e1[_0x26258b(0x153)]+_0x26258b(0x165));}catch(_0x124912){console['error'](_0x26258b(0x147),_0x124912),await this[_0x26258b(0x1d1)]?.[_0x26258b(0x14b)](_0x326eab,_0x26258b(0x158));}}async[a54_0x194d2c(0x157)](_0x4cc4a6,_0x30c732,_0xb7beab){const _0x436208=a54_0x194d2c;if(!this[_0x436208(0x1d1)]){console['warn']('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x3f2c47=await database_1[_0x436208(0x15b)][_0x436208(0x1c0)][_0x436208(0x1ce)]({'where':{'shopId':_0x4cc4a6,'isVerified':!![]}});if(_0x3f2c47['length']===0x0){console['log'](_0x436208(0x1a1)+_0x4cc4a6);return;}const _0x48992d=_0x3f2c47[_0x436208(0x15f)](async _0x3bdb11=>{const _0x22a0b4=_0x436208;try{await this[_0x22a0b4(0x1d1)]?.[_0x22a0b4(0x14b)](_0x3bdb11[_0x22a0b4(0x138)],_0x30c732,_0xb7beab),console['log']('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x3bdb11[_0x22a0b4(0x138)]);}catch(_0x3cbd33){console['error'](_0x22a0b4(0x1c5)+_0x3bdb11[_0x22a0b4(0x138)]+':',_0x3cbd33),_0x3cbd33 instanceof Error&&(_0x3cbd33[_0x22a0b4(0x1b9)][_0x22a0b4(0x1e5)](_0x22a0b4(0x12f))||_0x3cbd33[_0x22a0b4(0x1b9)][_0x22a0b4(0x1e5)](_0x22a0b4(0x1bf))||_0x3cbd33[_0x22a0b4(0x1b9)][_0x22a0b4(0x1e5)](_0x22a0b4(0x16a)))&&(await database_1[_0x22a0b4(0x15b)][_0x22a0b4(0x1c0)][_0x22a0b4(0x196)]({'where':{'id':_0x3bdb11['id']},'data':{'isVerified':![]}}),console[_0x22a0b4(0x191)]('User\x20'+_0x3bdb11[_0x22a0b4(0x138)]+_0x22a0b4(0x193)));}});await Promise[_0x436208(0x161)](_0x48992d);}catch(_0x4a1cb7){console[_0x436208(0x13d)](_0x436208(0x1e3),_0x4a1cb7);}}async[a54_0x194d2c(0x1e4)](_0x116ea3,_0x4cae1d,_0x45418a){const _0x435f88=a54_0x194d2c,_0xb2d07e={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x4d2d37={'created':_0x435f88(0x15c),'paid':_0x435f88(0x135),'failed':_0x435f88(0x143),'expired':_0x435f88(0x17d),'refund':'Payment\x20refund','chargeback':_0x435f88(0x13a),'processing':_0x435f88(0x1aa)},_0x5d897b=_0xb2d07e[_0x45418a],_0x148588=_0x4d2d37[_0x45418a],_0x24ea33=(0x0,gateway_1[_0x435f88(0x178)])(_0x4cae1d[_0x435f88(0x1eb)]);console[_0x435f88(0x191)](_0x435f88(0x1ae)+_0x4cae1d['gateway']+_0x435f88(0x1bd)+_0x24ea33+'\x22');let _0x5a87d2=_0x5d897b+'\x20*'+_0x148588+_0x435f88(0x190)+('💰\x20Amount:\x20*'+_0x4cae1d['amount']+'\x20'+_0x4cae1d[_0x435f88(0x139)]+'*\x0a')+(_0x435f88(0x172)+(_0x4cae1d['orderId']||_0x4cae1d['id'])+'`\x0a')+(_0x435f88(0x1ac)+_0x4cae1d['id']+'`\x0a')+(_0x435f88(0x14a)+_0x24ea33+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x4cae1d['createdAt'])[_0x435f88(0x1b3)](_0x435f88(0x163))+'\x0a');if(_0x4cae1d['customerName']||_0x4cae1d['customerEmail']||_0x4cae1d['remitterIban']||_0x4cae1d[_0x435f88(0x1a9)]||_0x4cae1d['customerUa']){_0x5a87d2+='\x0a👤\x20*Customer\x20Information:*\x0a';_0x4cae1d[_0x435f88(0x12d)]&&(_0x5a87d2+=_0x435f88(0x1d3)+_0x4cae1d['customerName']+'`\x0a');_0x4cae1d[_0x435f88(0x18b)]&&(_0x5a87d2+=_0x435f88(0x156)+_0x4cae1d[_0x435f88(0x18b)]+'`\x0a');_0x4cae1d[_0x435f88(0x183)]&&(_0x5a87d2+=_0x435f88(0x175)+_0x4cae1d[_0x435f88(0x183)]+'`\x0a');_0x4cae1d[_0x435f88(0x1a9)]&&(_0x5a87d2+=_0x435f88(0x1fb)+_0x4cae1d['customerIp']+'`\x0a');if(_0x4cae1d[_0x435f88(0x1f3)]){const _0x28d135=_0x4cae1d[_0x435f88(0x1f3)][_0x435f88(0x19d)]>0x32?_0x4cae1d[_0x435f88(0x1f3)]['substring'](0x0,0x32)+'...':_0x4cae1d['customerUa'];_0x5a87d2+=_0x435f88(0x1d9)+_0x28d135+'`\x0a';}}_0x45418a===_0x435f88(0x1da)&&_0x4cae1d[_0x435f88(0x201)]&&(_0x5a87d2+=_0x435f88(0x1ee)+_0x4cae1d[_0x435f88(0x201)]+'\x20USDT*\x0a'),_0x45418a===_0x435f88(0x1ab)&&(_0x5a87d2+=_0x435f88(0x1dd)),_0x4cae1d[_0x435f88(0x19a)]&&(_0x5a87d2+=_0x435f88(0x1fa)+_0x4cae1d['adminNotes']+'\x0a'),await this[_0x435f88(0x157)](_0x116ea3,_0x5a87d2,{'parse_mode':'Markdown'});}async['sendPayoutNotification'](_0x1a6ec8,_0x5cc89e,_0x3c7917){const _0x59181c=a54_0x194d2c,_0x11f564={'created':'📤','completed':'✅','rejected':'❌'},_0x2a566c={'created':_0x59181c(0x200),'completed':'Payout\x20completed','rejected':_0x59181c(0x1b4)},_0x122867=_0x11f564[_0x3c7917],_0x68887b=_0x2a566c[_0x3c7917],_0x454d69=_0x122867+'\x20*'+_0x68887b+_0x59181c(0x190)+(_0x59181c(0x1ad)+_0x5cc89e[_0x59181c(0x1ea)]+'\x20USD*\x0a')+('🏦\x20Method:\x20`'+_0x5cc89e[_0x59181c(0x166)]+'`\x0a')+(_0x59181c(0x1a5)+_0x5cc89e['id']+'`\x0a')+(_0x59181c(0x141)+new Date(_0x5cc89e[_0x59181c(0x1a7)])[_0x59181c(0x1b3)](_0x59181c(0x163))+'\x0a')+(_0x5cc89e[_0x59181c(0x199)]?_0x59181c(0x180)+_0x5cc89e['txid']+'`':'');await this['sendShopNotification'](_0x1a6ec8,_0x454d69,{'parse_mode':_0x59181c(0x198)});}async[a54_0x194d2c(0x174)](_0x30f621,_0x22dea5){const _0x486fdc=a54_0x194d2c;try{const _0x2edad=await database_1[_0x486fdc(0x15b)][_0x486fdc(0x146)][_0x486fdc(0x16f)]({'where':{'shopId':_0x30f621},'select':{'notificationLogin':!![]}});if(!_0x2edad?.[_0x486fdc(0x162)]){console[_0x486fdc(0x191)](_0x486fdc(0x160)+_0x30f621);return;}const _0x5a7076=_0x22dea5['success']?'🔐':'🚨',_0x3770eb=_0x22dea5['success']?_0x486fdc(0x140):'Failed\x20login\x20attempt';let _0x4d7df8=_0x5a7076+'\x20*'+_0x3770eb+_0x486fdc(0x190)+(_0x486fdc(0x1d6)+_0x22dea5['username']+'`\x0a')+('📅\x20Time:\x20'+_0x22dea5[_0x486fdc(0x1ff)][_0x486fdc(0x1b3)]('en-US')+'\x0a');_0x22dea5[_0x486fdc(0x1fe)]&&(_0x4d7df8+=_0x486fdc(0x17c)+_0x22dea5[_0x486fdc(0x1fe)]+'`\x0a');if(_0x22dea5[_0x486fdc(0x17b)]){const _0x213cf2=_0x22dea5['userAgent'][_0x486fdc(0x19d)]>0x32?_0x22dea5[_0x486fdc(0x17b)][_0x486fdc(0x1e7)](0x0,0x32)+_0x486fdc(0x169):_0x22dea5[_0x486fdc(0x17b)];_0x4d7df8+=_0x486fdc(0x1d9)+_0x213cf2+'`\x0a';}!_0x22dea5[_0x486fdc(0x1ba)]&&(_0x4d7df8+=_0x486fdc(0x1d8)),await this['sendShopNotification'](_0x30f621,_0x4d7df8,{'parse_mode':_0x486fdc(0x198)}),console[_0x486fdc(0x191)](_0x486fdc(0x1b5)+_0x30f621+':\x20'+(_0x22dea5[_0x486fdc(0x1ba)]?_0x486fdc(0x1ba):'failed'));}catch(_0x77cf3){console[_0x486fdc(0x13d)]('Failed\x20to\x20send\x20login\x20notification:',_0x77cf3);}}async[a54_0x194d2c(0x1c8)](_0x427e25,_0x183d93){const _0x41a5fb=a54_0x194d2c;try{const _0x1d2b37=await database_1['default'][_0x41a5fb(0x146)][_0x41a5fb(0x16f)]({'where':{'shopId':_0x427e25},'select':{'notificationApiError':!![]}});if(!_0x1d2b37?.[_0x41a5fb(0x142)]){console[_0x41a5fb(0x191)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x427e25);return;}let _0x2c563f=_0x41a5fb(0x1f8)+('🔗\x20Endpoint:\x20`'+_0x183d93[_0x41a5fb(0x166)]+'\x20'+_0x183d93['endpoint']+'`\x0a')+('📅\x20Time:\x20'+_0x183d93['timestamp'][_0x41a5fb(0x1b3)](_0x41a5fb(0x163))+'\x0a');_0x183d93['statusCode']&&(_0x2c563f+=_0x41a5fb(0x1b6)+_0x183d93['statusCode']+'`\x0a'),_0x2c563f+=_0x41a5fb(0x149)+_0x183d93[_0x41a5fb(0x1f9)]+'`\x0a',_0x183d93[_0x41a5fb(0x1cf)]&&(_0x2c563f+=_0x41a5fb(0x144)+_0x183d93[_0x41a5fb(0x1cf)]+'`\x0a'),_0x2c563f+=_0x41a5fb(0x1c1),await this['sendShopNotification'](_0x427e25,_0x2c563f,{'parse_mode':_0x41a5fb(0x198)}),console[_0x41a5fb(0x191)](_0x41a5fb(0x19b)+_0x427e25+':\x20'+_0x183d93[_0x41a5fb(0x1af)]);}catch(_0x1206de){console[_0x41a5fb(0x13d)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x1206de);}}async[a54_0x194d2c(0x1f1)](_0x5292df,_0x2f3cca,_0x27c598){const _0x47075a=a54_0x194d2c;let _0x593c79=_0x47075a(0x1bc)+_0x2f3cca+_0x47075a(0x190);for(const [_0x82cdfa,_0x4a145d]of Object[_0x47075a(0x1d0)](_0x27c598)){_0x4a145d!==null&&_0x4a145d!==undefined&&(_0x593c79+=_0x82cdfa+':\x20`'+_0x4a145d+'`\x0a');}await this[_0x47075a(0x157)](_0x5292df,_0x593c79,{'parse_mode':_0x47075a(0x198)});}[a54_0x194d2c(0x19c)](){const _0x4e978a=a54_0x194d2c;return{'isActive':!!this[_0x4e978a(0x1d1)],'username':this[_0x4e978a(0x194)]};}['stopBot'](){const _0x417913=a54_0x194d2c;this['bot']&&(this[_0x417913(0x1d1)][_0x417913(0x148)](),this[_0x417913(0x1d1)]=null,console[_0x417913(0x191)]('🛑\x20Telegram\x20bot\x20stopped'));}}function a54_0x54d0(){const _0x2a187e=['🏦\x20IBAN:\x20`','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','forEach','getGatewayDisplayNameForTelegram','../types/gateway','•\x20New\x20payments\x0a','userAgent','🌐\x20IP\x20address:\x20`','Payment\x20expired','Error\x20handling\x20/debug\x20command:','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','🔗\x20TXID:\x20`','chat','🔔\x20Notifications\x20are\x20active\x0a\x0a','remitterIban','2454034KmYoKw',':\x20username=\x22','🔌\x20User\x20','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','\x20verified\x20for\x20shop\x20','53343kfQmkP','Commands:\x0a','customerEmail','\x20disconnected\x20from\x20shop\x20','📱\x20Your\x20Telegram\x20ID:\x20`','\x22,\x20apiKey=\x22','•\x20Important\x20events\x0a\x0a','*\x0a\x0a','log','\x20\x20\x20Status:\x20','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','botUsername','\x20initialized\x20successfully','update','🔍\x20*Debug\x20Information*\x0a\x0a','Markdown','txid','adminNotes','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','getBotInfo','length','✅\x20Connected\x20to\x20shop:\x20*','🔔\x20You\x20receive\x20notifications\x20about:\x0a','1983960gUHxZn','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','8DmKcNa','✅\x20Telegram\x20bot\x20@','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','🆔\x20Payout\x20ID:\x20`','1398618KPWGBU','createdAt','Check\x20spelling\x20and\x20try\x20again.','customerIp','Payment\x20is\x20being\x20processed','processing','🆔\x20Payment\x20ID:\x20`','💸\x20Amount:\x20*','📱\x20Telegram\x20notification:\x20gateway\x20\x22','endpoint','✅\x20Telegram\x20user\x20','sk_','To\x20reconnect,\x20use\x20the\x20/start\x20command','toLocaleString','Payout\x20rejected','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','📊\x20Error\x20code:\x20`','publicKey','test','message','success','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','🔔\x20*','\x22\x20->\x20display\x20\x22','631938HbznFn','chat\x20not\x20found','telegramUser','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','__esModule','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','`\x20(','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','`.\x0a\x0a','shop','sendApiErrorNotification','\x0aCheck\x20spelling\x20and\x20try\x20again.','handleSingleLineVerification','`\x20not\x20found.\x0a\x0a','secretKey','...\x22','findMany','requestId','entries','bot','pk_','📛\x20Name:\x20`','Username:\x20`','toLocaleDateString','👤\x20Username:\x20`','•\x20Payouts\x0a\x0a','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','💻\x20Browser:\x20`','chargeback','text','onText','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','shopId','•\x20Payment\x20status\x20changes\x0a','❌\x20Shop\x20with\x20username\x20`','from','Error\x20handling\x20message:','Error\x20sending\x20shop\x20notification:','sendPaymentNotification','includes','✅\x20Welcome\x20back!\x0a\x0a','substring','TELEGRAM_BOT_TOKEN','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','amount','gateway','❌\x20Error\x20getting\x20debug\x20information.','*.\x0a\x0a','💸\x20Penalty\x20amount:\x20*','node-telegram-bot-api','ACTIVE','sendCustomNotification','toString','customerUa','5647hQOCHU','❌\x20Invalid\x20username\x20format:\x20`','botToken','\x20\x20\x20Public\x20Key:\x20`','🚨\x20*API\x20Error*\x0a\x0a','errorMessage','📝\x20Notes:\x20','🌐\x20IP:\x20`','env','startsWith','ipAddress','timestamp','New\x20payout\x20created','chargebackAmount','status','646168UXXxln','trim','Example:\x0a','findFirst','customerName','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','blocked','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Telegram\x20bot\x20polling\x20error:','warn','Payment\x20successfully\x20paid','join','Available\x20usernames:\x0a','telegramId','currency','Payment\x20chargeback','📱\x20Shop:\x20*','•\x20`','error','create','defineProperty','Successful\x20login','📅\x20Date:\x20','notificationApiError','Payment\x20failed','🆔\x20Request\x20ID:\x20`','158VjqlEP','shopSettings','Error\x20in\x20handleSingleLineVerification:','stopPolling','❌\x20Error:\x20`','🏪\x20Gateway:\x20`','sendMessage','40bXtxmx','name','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','Error\x20handling\x20/status\x20command:','updatedAt','`\x0a\x0a','username','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','📧\x20Email:\x20`','sendShopNotification','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','`\x20is\x20inactive.\x0a\x0a','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','default','New\x20payment\x20created','trapay_bot','/disconnect\x20-\x20disconnect\x20from\x20notifications','map','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','allSettled','notificationLogin','en-US','TelegramBotService','\x20via\x20single-line\x20input','method','7Yljeth','\x20\x20\x20Username:\x20`','...','user\x20is\x20deactivated','initializeBot','isVerified','Error\x20handling\x20/disconnect\x20command:','setupBotHandlers','findUnique','•\x20Payouts\x0a','/status\x20-\x20check\x20connection\x20status\x0a','📝\x20Order\x20ID:\x20`','Error\x20handling\x20/start\x20command:','sendLoginNotification'];a54_0x54d0=function(){return _0x2a187e;};return a54_0x54d0();}exports['TelegramBotService']=TelegramBotService,exports['telegramBotService']=new TelegramBotService();