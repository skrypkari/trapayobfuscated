'use strict';const a74_0x1b1ffb=a74_0x133d;(function(_0x59e3a1,_0x25c848){const _0x4c5d83=a74_0x133d,_0x42c843=_0x59e3a1();while(!![]){try{const _0x1d9761=-parseInt(_0x4c5d83(0x18d))/0x1+parseInt(_0x4c5d83(0xb9))/0x2*(-parseInt(_0x4c5d83(0x12b))/0x3)+parseInt(_0x4c5d83(0x152))/0x4+-parseInt(_0x4c5d83(0x188))/0x5*(-parseInt(_0x4c5d83(0x139))/0x6)+parseInt(_0x4c5d83(0xe2))/0x7*(-parseInt(_0x4c5d83(0xa1))/0x8)+-parseInt(_0x4c5d83(0xe7))/0x9*(parseInt(_0x4c5d83(0x109))/0xa)+-parseInt(_0x4c5d83(0x14b))/0xb*(-parseInt(_0x4c5d83(0x121))/0xc);if(_0x1d9761===_0x25c848)break;else _0x42c843['push'](_0x42c843['shift']());}catch(_0x118145){_0x42c843['push'](_0x42c843['shift']());}}}(a74_0x3c12,0x94199));var __importDefault=this&&this['__importDefault']||function(_0x1dd742){return _0x1dd742&&_0x1dd742['__esModule']?_0x1dd742:{'default':_0x1dd742};};Object['defineProperty'](exports,a74_0x1b1ffb(0x106),{'value':!![]}),exports[a74_0x1b1ffb(0x18f)]=exports[a74_0x1b1ffb(0x11d)]=void 0x0;function a74_0x133d(_0x1e8435,_0x3d25a7){_0x1e8435=_0x1e8435-0x9b;const _0x3c1265=a74_0x3c12();let _0x133dce=_0x3c1265[_0x1e8435];return _0x133dce;}const node_telegram_bot_api_1=__importDefault(require(a74_0x1b1ffb(0xad))),database_1=__importDefault(require(a74_0x1b1ffb(0xf0))),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x1758c3=a74_0x1b1ffb;this['bot']=null,this[_0x1758c3(0x144)]=process[_0x1758c3(0xc1)]['TELEGRAM_BOT_TOKEN']||'',this[_0x1758c3(0x14c)]=process[_0x1758c3(0xc1)]['TELEGRAM_BOT_USERNAME']||'trapay_bot',this[_0x1758c3(0x144)]?this[_0x1758c3(0x130)]():console['warn'](_0x1758c3(0xf6));}[a74_0x1b1ffb(0x130)](){const _0xf699fe=a74_0x1b1ffb;try{this[_0xf699fe(0x13d)]=new node_telegram_bot_api_1[(_0xf699fe(0x149))](this[_0xf699fe(0x144)],{'polling':!![]}),this[_0xf699fe(0x108)](),console[_0xf699fe(0xd3)](_0xf699fe(0x11a)+this['botUsername']+_0xf699fe(0x112));}catch(_0x302d85){console[_0xf699fe(0x17a)](_0xf699fe(0x165),_0x302d85);}}['setupBotHandlers'](){const _0xe7f70b=a74_0x1b1ffb;if(!this['bot'])return;this[_0xe7f70b(0x13d)][_0xe7f70b(0xf9)](/\/start/,async _0x595ce5=>{const _0x5da5f4=_0xe7f70b,_0x4861a1=_0x595ce5[_0x5da5f4(0x115)]['id'],_0x5ec845=_0x595ce5['from']?.['id'][_0x5da5f4(0x123)](),_0x41fb52=_0x595ce5[_0x5da5f4(0x117)]?.[_0x5da5f4(0xeb)],_0x3e40d3=_0x595ce5[_0x5da5f4(0x117)]?.[_0x5da5f4(0x150)],_0x350c5d=_0x595ce5[_0x5da5f4(0x117)]?.[_0x5da5f4(0x12f)];if(!_0x5ec845)return;try{let _0x230d95=await database_1[_0x5da5f4(0x149)][_0x5da5f4(0x148)][_0x5da5f4(0xf3)]({'where':{'telegramId':_0x5ec845},'include':{'shop':!![]}});!_0x230d95?(_0x230d95=await database_1['default'][_0x5da5f4(0x148)][_0x5da5f4(0xdd)]({'data':{'telegramId':_0x5ec845,'username':_0x41fb52,'firstName':_0x3e40d3,'lastName':_0x350c5d,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x5da5f4(0xd3)](_0x5da5f4(0x172)+_0x5ec845+'\x20(@'+_0x41fb52+')')):_0x230d95=await database_1[_0x5da5f4(0x149)]['telegramUser'][_0x5da5f4(0xe8)]({'where':{'telegramId':_0x5ec845},'data':{'username':_0x41fb52,'firstName':_0x3e40d3,'lastName':_0x350c5d},'include':{'shop':!![]}}),_0x230d95[_0x5da5f4(0x140)]&&_0x230d95[_0x5da5f4(0x13b)]&&_0x230d95[_0x5da5f4(0x14f)]?await this[_0x5da5f4(0x13d)]?.[_0x5da5f4(0xa7)](_0x4861a1,_0x5da5f4(0x10e)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x230d95[_0x5da5f4(0x14f)][_0x5da5f4(0x127)]+'*\x0a')+(_0x5da5f4(0xcb)+_0x230d95['shop'][_0x5da5f4(0xeb)]+_0x5da5f4(0x159))+_0x5da5f4(0xa4)+_0x5da5f4(0x18b)+_0x5da5f4(0x177)+'â€¢\x20Payouts\x0a\x0a'+_0x5da5f4(0xbd)+_0x5da5f4(0x15f)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x5da5f4(0x163)}):(_0x230d95[_0x5da5f4(0x13b)]&&!_0x230d95[_0x5da5f4(0x140)]&&(await database_1[_0x5da5f4(0x149)][_0x5da5f4(0x148)][_0x5da5f4(0xe8)]({'where':{'telegramId':_0x5ec845},'data':{'shopId':null,'isVerified':![]}}),console[_0x5da5f4(0xd3)](_0x5da5f4(0xc3)+_0x5ec845)),await this[_0x5da5f4(0x13d)]?.[_0x5da5f4(0xa7)](_0x4861a1,_0x5da5f4(0x166)+_0x5da5f4(0x10d)+'ğŸ“\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x5da5f4(0x12e)+_0x5da5f4(0x186)+_0x5da5f4(0xfe),{'parse_mode':_0x5da5f4(0x163)}));}catch(_0x1a9056){console[_0x5da5f4(0x17a)](_0x5da5f4(0xd2),_0x1a9056),await this['bot']?.[_0x5da5f4(0xa7)](_0x4861a1,_0x5da5f4(0x13c));}}),this[_0xe7f70b(0x13d)][_0xe7f70b(0xf9)](/\/disconnect/,async _0x3ff4b6=>{const _0x1e3267=_0xe7f70b,_0x13d346=_0x3ff4b6['chat']['id'],_0x3aaeef=_0x3ff4b6[_0x1e3267(0x117)]?.['id'][_0x1e3267(0x123)]();if(!_0x3aaeef)return;try{const _0x1c8ba2=await database_1[_0x1e3267(0x149)][_0x1e3267(0x148)][_0x1e3267(0xf3)]({'where':{'telegramId':_0x3aaeef},'include':{'shop':!![]}});if(!_0x1c8ba2||!_0x1c8ba2['isVerified']||!_0x1c8ba2['shopId']){await this[_0x1e3267(0x13d)]?.[_0x1e3267(0xa7)](_0x13d346,_0x1e3267(0xbf));return;}const _0x1d9a04=_0x1c8ba2[_0x1e3267(0x14f)]?.['name']||_0x1e3267(0xfd);await database_1[_0x1e3267(0x149)][_0x1e3267(0x148)][_0x1e3267(0xe8)]({'where':{'telegramId':_0x3aaeef},'data':{'shopId':null,'isVerified':![]}}),console[_0x1e3267(0xd3)](_0x1e3267(0xa0)+_0x3aaeef+_0x1e3267(0x16b)+_0x1c8ba2['shopId']),await this['bot']?.['sendMessage'](_0x13d346,_0x1e3267(0xb0)+_0x1d9a04+_0x1e3267(0xe4)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x1e3267(0x163)});}catch(_0x470853){console[_0x1e3267(0x17a)](_0x1e3267(0x119),_0x470853),await this['bot']?.[_0x1e3267(0xa7)](_0x13d346,_0x1e3267(0x13c));}}),this[_0xe7f70b(0x13d)][_0xe7f70b(0xf9)](/\/status/,async _0x383619=>{const _0x12b910=_0xe7f70b,_0x5d8219=_0x383619['chat']['id'],_0x1f00b1=_0x383619[_0x12b910(0x117)]?.['id']['toString']();if(!_0x1f00b1)return;try{const _0x5dc4f0=await database_1[_0x12b910(0x149)][_0x12b910(0x148)][_0x12b910(0xf3)]({'where':{'telegramId':_0x1f00b1},'include':{'shop':!![]}});if(!_0x5dc4f0){await this['bot']?.[_0x12b910(0xa7)](_0x5d8219,_0x12b910(0xf2)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x5dc4f0[_0x12b910(0x140)]||!_0x5dc4f0[_0x12b910(0x13b)]||!_0x5dc4f0[_0x12b910(0x14f)]){await this[_0x12b910(0x13d)]?.[_0x12b910(0xa7)](_0x5d8219,'âŒ\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x12b910(0xe9));return;}await this['bot']?.[_0x12b910(0xa7)](_0x5d8219,'ğŸ“Š\x20*Connection\x20Status*\x0a\x0a'+('âœ…\x20Connected\x20to\x20shop:\x20*'+_0x5dc4f0[_0x12b910(0x14f)][_0x12b910(0x127)]+'*\x0a')+(_0x12b910(0x17c)+_0x5dc4f0['shop'][_0x12b910(0xeb)]+'`\x0a')+(_0x12b910(0xd7)+_0x5dc4f0['updatedAt'][_0x12b910(0xd1)]('en-US')+'\x0a\x0a')+'ğŸ””\x20Notifications\x20are\x20active\x0a\x0a'+_0x12b910(0xbd)+_0x12b910(0xd5),{'parse_mode':_0x12b910(0x163)});}catch(_0x50ead9){console['error']('Error\x20handling\x20/status\x20command:',_0x50ead9),await this['bot']?.[_0x12b910(0xa7)](_0x5d8219,'âŒ\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0xe7f70b(0x13d)][_0xe7f70b(0xf9)](/\/debug/,async _0x419cd3=>{const _0x5a339a=_0xe7f70b,_0x49730b=_0x419cd3[_0x5a339a(0x115)]['id'],_0x44ca20=_0x419cd3[_0x5a339a(0x117)]?.['id'][_0x5a339a(0x123)]();if(!_0x44ca20)return;try{const _0xf91426=await database_1[_0x5a339a(0x149)][_0x5a339a(0x148)][_0x5a339a(0xf3)]({'where':{'telegramId':_0x44ca20},'include':{'shop':!![]}});let _0x241c76=_0x5a339a(0x126);_0x241c76+='ğŸ“±\x20Your\x20Telegram\x20ID:\x20`'+_0x44ca20+_0x5a339a(0x159),_0xf91426?.[_0x5a339a(0x140)]&&_0xf91426[_0x5a339a(0x14f)]?(_0x241c76+='ğŸª\x20Your\x20connected\x20shop:\x0a',_0x241c76+='\x20\x20\x20Name:\x20*'+_0xf91426[_0x5a339a(0x14f)]['name']+'*\x0a',_0x241c76+=_0x5a339a(0xee)+_0xf91426['shop']['username']+'`\x0a',_0x241c76+=_0x5a339a(0xbe)+_0xf91426[_0x5a339a(0x14f)][_0x5a339a(0x17f)]+'\x0a\x0a'):_0x241c76+=_0x5a339a(0xc5),_0x241c76+=_0x5a339a(0xfb),await this[_0x5a339a(0x13d)]?.[_0x5a339a(0xa7)](_0x49730b,_0x241c76,{'parse_mode':_0x5a339a(0x163)});}catch(_0xbfe1ed){console['error'](_0x5a339a(0x12a),_0xbfe1ed),await this[_0x5a339a(0x13d)]?.[_0x5a339a(0xa7)](_0x49730b,_0x5a339a(0x17e));}}),this['bot']['on'](_0xe7f70b(0x9d),async _0x3d7ffb=>{const _0x18e6c1=_0xe7f70b;if(_0x3d7ffb[_0x18e6c1(0x18e)]?.['startsWith']('/'))return;const _0x2d35da=_0x3d7ffb['chat']['id'],_0x2f0a58=_0x3d7ffb[_0x18e6c1(0x117)]?.['id'][_0x18e6c1(0x123)](),_0x5e3f95=_0x3d7ffb['text']?.[_0x18e6c1(0x103)]();if(!_0x2f0a58||!_0x5e3f95)return;try{const _0x4abcca=await database_1[_0x18e6c1(0x149)][_0x18e6c1(0x148)][_0x18e6c1(0xf3)]({'where':{'telegramId':_0x2f0a58},'include':{'shop':!![]}});if(!_0x4abcca){await this[_0x18e6c1(0x13d)]?.[_0x18e6c1(0xa7)](_0x2d35da,_0x18e6c1(0xb3));return;}if(_0x4abcca[_0x18e6c1(0x140)]&&_0x4abcca[_0x18e6c1(0x13b)]&&_0x4abcca[_0x18e6c1(0x14f)]){await this[_0x18e6c1(0x13d)]?.[_0x18e6c1(0xa7)](_0x2d35da,_0x18e6c1(0x190)+_0x4abcca[_0x18e6c1(0x14f)][_0x18e6c1(0x127)]+'*.\x0a\x0a'+_0x18e6c1(0x182),{'parse_mode':_0x18e6c1(0x163)});return;}const _0x3842e2=_0x5e3f95[_0x18e6c1(0xc9)](/\s+/);if(_0x3842e2['length']!==0x2){await this[_0x18e6c1(0x13d)]?.['sendMessage'](_0x2d35da,_0x18e6c1(0xac)+_0x18e6c1(0xa6)+'Example:\x0a'+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x18e6c1(0xcf)+_0x3842e2[_0x18e6c1(0x158)]+_0x18e6c1(0xea)+_0x3842e2[_0x18e6c1(0x132)](_0x328d4b=>'`'+_0x328d4b+'`')[_0x18e6c1(0x12d)](',\x20')),{'parse_mode':_0x18e6c1(0x163)});return;}const [_0xad9404,_0x4017d0]=_0x3842e2;console[_0x18e6c1(0xd3)](_0x18e6c1(0x142)+_0x2f0a58+':\x20username=\x22'+_0xad9404+'\x22,\x20apiKey=\x22'+_0x4017d0[_0x18e6c1(0x180)](0x0,0xa)+'...\x22'),await this[_0x18e6c1(0x146)](_0x2d35da,_0x2f0a58,_0xad9404,_0x4017d0);}catch(_0x2ca500){console['error'](_0x18e6c1(0x156),_0x2ca500),await this[_0x18e6c1(0x13d)]?.[_0x18e6c1(0xa7)](_0x2d35da,_0x18e6c1(0x13c));}}),this[_0xe7f70b(0x13d)]['on'](_0xe7f70b(0x17a),_0xdb17cd=>{const _0x564247=_0xe7f70b;console['error'](_0x564247(0x160),_0xdb17cd);}),this['bot']['on'](_0xe7f70b(0x178),_0x5b1773=>{const _0x487d0a=_0xe7f70b;console[_0x487d0a(0x17a)]('Telegram\x20bot\x20polling\x20error:',_0x5b1773);});}async[a74_0x1b1ffb(0x146)](_0x493e2e,_0x3dca14,_0x30140d,_0xccada8){const _0x2e8699=a74_0x1b1ffb;try{console[_0x2e8699(0xd3)](_0x2e8699(0x142)+_0x3dca14+_0x2e8699(0x176)+_0x30140d+_0x2e8699(0xbb)+_0xccada8['substring'](0x0,0xa)+_0x2e8699(0xf4));if(!_0x30140d||_0x30140d[_0x2e8699(0x158)]<0x3||_0x30140d[_0x2e8699(0x158)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x30140d)){await this[_0x2e8699(0x13d)]?.[_0x2e8699(0xa7)](_0x493e2e,_0x2e8699(0x9f)+_0x30140d+_0x2e8699(0x159)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':'Markdown'});return;}if(!_0xccada8||!_0xccada8[_0x2e8699(0xe1)](_0x2e8699(0x10f))&&!_0xccada8[_0x2e8699(0xe1)](_0x2e8699(0x16c))){await this['bot']?.[_0x2e8699(0xa7)](_0x493e2e,_0x2e8699(0x157)+_0x2e8699(0xec),{'parse_mode':_0x2e8699(0x163)});return;}const _0x33881f=await database_1[_0x2e8699(0x149)]['shop'][_0x2e8699(0xf3)]({'where':{'username':_0x30140d},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x33881f){const _0x2b8dab=_0x2e8699(0x104)+_0x30140d+'`\x20not\x20found.\x0a\x0a'+_0x2e8699(0xa2)+_0x2e8699(0xd9);await this[_0x2e8699(0x13d)]?.['sendMessage'](_0x493e2e,_0x2b8dab,{'parse_mode':'Markdown'});return;}if(_0x33881f[_0x2e8699(0x17f)]!==_0x2e8699(0xf5)){await this['bot']?.['sendMessage'](_0x493e2e,_0x2e8699(0x138)+_0x30140d+'`\x20is\x20inactive.\x0a\x0a'+_0x2e8699(0x116),{'parse_mode':'Markdown'});return;}if(_0x33881f[_0x2e8699(0xb7)]!==_0xccada8&&_0x33881f[_0x2e8699(0xa3)]!==_0xccada8){await this[_0x2e8699(0x13d)]?.[_0x2e8699(0xa7)](_0x493e2e,_0x2e8699(0x15c)+_0x30140d+'`.\x0a\x0a'+_0x2e8699(0xfc)+_0x2e8699(0xc7),{'parse_mode':_0x2e8699(0x163)});return;}const _0x590436=await database_1[_0x2e8699(0x149)][_0x2e8699(0x148)][_0x2e8699(0xcd)]({'where':{'shopId':_0x33881f['id'],'isVerified':!![],'telegramId':{'not':_0x3dca14}}});if(_0x590436){await this[_0x2e8699(0x13d)]?.[_0x2e8699(0xa7)](_0x493e2e,'âŒ\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x30140d+_0x2e8699(0x15b)+_0x2e8699(0x18a),{'parse_mode':_0x2e8699(0x163)});return;}await database_1['default']['telegramUser'][_0x2e8699(0xe8)]({'where':{'telegramId':_0x3dca14},'data':{'shopId':_0x33881f['id'],'isVerified':!![]}}),await this[_0x2e8699(0x13d)]?.['sendMessage'](_0x493e2e,_0x2e8699(0x147)+'âœ…\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+('ğŸ“±\x20Shop:\x20*'+_0x33881f[_0x2e8699(0x127)]+'*\x0a')+(_0x2e8699(0x17c)+_0x33881f[_0x2e8699(0xeb)]+'`\x0a\x0a')+_0x2e8699(0x179)+_0x2e8699(0x18b)+_0x2e8699(0x177)+_0x2e8699(0x131)+_0x2e8699(0x136)+_0x2e8699(0xbd)+_0x2e8699(0x15f)+_0x2e8699(0xd5),{'parse_mode':_0x2e8699(0x163)}),console[_0x2e8699(0xd3)](_0x2e8699(0x9b)+_0x3dca14+_0x2e8699(0xcc)+_0x33881f['username']+_0x2e8699(0xc4));}catch(_0x5a53d0){console['error'](_0x2e8699(0xb5),_0x5a53d0),await this[_0x2e8699(0x13d)]?.[_0x2e8699(0xa7)](_0x493e2e,'âŒ\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a74_0x1b1ffb(0x185)](_0x1234eb,_0x4c37ca,_0x2521b4){const _0x4ab499=a74_0x1b1ffb;if(!this['bot']){console[_0x4ab499(0xab)](_0x4ab499(0xd6));return;}try{const _0xf72fab=await database_1[_0x4ab499(0x149)][_0x4ab499(0x148)][_0x4ab499(0x9e)]({'where':{'shopId':_0x1234eb,'isVerified':!![]}});if(_0xf72fab[_0x4ab499(0x158)]===0x0){console[_0x4ab499(0xd3)](_0x4ab499(0x134)+_0x1234eb);return;}const _0x19a9b5=_0xf72fab[_0x4ab499(0x132)](async _0x1e43c7=>{const _0x16e5af=_0x4ab499;try{await this[_0x16e5af(0x13d)]?.['sendMessage'](_0x1e43c7[_0x16e5af(0x16e)],_0x4c37ca,_0x2521b4),console[_0x16e5af(0xd3)]('âœ…\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x1e43c7[_0x16e5af(0x16e)]);}catch(_0x1dec94){console[_0x16e5af(0x17a)]('âŒ\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x1e43c7[_0x16e5af(0x16e)]+':',_0x1dec94),_0x1dec94 instanceof Error&&(_0x1dec94[_0x16e5af(0x9d)]['includes'](_0x16e5af(0x13e))||_0x1dec94[_0x16e5af(0x9d)][_0x16e5af(0x15a)](_0x16e5af(0x15d))||_0x1dec94[_0x16e5af(0x9d)][_0x16e5af(0x15a)]('user\x20is\x20deactivated'))&&(await database_1['default'][_0x16e5af(0x148)][_0x16e5af(0xe8)]({'where':{'id':_0x1e43c7['id']},'data':{'isVerified':![]}}),console['log'](_0x16e5af(0x168)+_0x1e43c7['telegramId']+_0x16e5af(0x114)));}});await Promise[_0x4ab499(0x137)](_0x19a9b5);}catch(_0x5dbc42){console[_0x4ab499(0x17a)]('Error\x20sending\x20shop\x20notification:',_0x5dbc42);}}async[a74_0x1b1ffb(0x141)](_0x1cec21,_0x41162c,_0x31b8da){const _0x51a3bd=a74_0x1b1ffb,_0x475848={'created':'ğŸ†•','paid':'âœ…','failed':'âŒ','expired':'â°','refund':'ğŸ”„','chargeback':'âš ï¸','processing':'âš™ï¸'},_0x47de81={'created':_0x51a3bd(0xc0),'paid':'Payment\x20successfully\x20paid','failed':'Payment\x20failed','expired':_0x51a3bd(0x133),'refund':'Payment\x20refund','chargeback':'Payment\x20chargeback','processing':_0x51a3bd(0xc6)},_0x4497d5=_0x475848[_0x31b8da],_0x41d5e9=_0x47de81[_0x31b8da],_0x43a33c=(0x0,gateway_1[_0x51a3bd(0xae)])(_0x41162c[_0x51a3bd(0x170)]);console[_0x51a3bd(0xd3)](_0x51a3bd(0x151)+_0x41162c[_0x51a3bd(0x170)]+'\x22\x20->\x20display\x20\x22'+_0x43a33c+'\x22');let _0x596a8=_0x4497d5+'\x20*'+_0x41d5e9+_0x51a3bd(0xdb)+(_0x51a3bd(0x14d)+_0x41162c['amount']+'\x20'+_0x41162c[_0x51a3bd(0xa8)]+'*\x0a')+('ğŸ“\x20Order\x20ID:\x20`'+(_0x41162c['orderId']||_0x41162c['id'])+'`\x0a')+(_0x51a3bd(0x14a)+_0x41162c['id']+'`\x0a')+(_0x51a3bd(0x18c)+_0x43a33c+'`\x0a')+(_0x51a3bd(0xca)+new Date(_0x41162c['createdAt'])['toLocaleString'](_0x51a3bd(0x120))+'\x0a');if(_0x41162c['customerName']||_0x41162c[_0x51a3bd(0xaa)]||_0x41162c[_0x51a3bd(0x122)]||_0x41162c['customerIp']||_0x41162c[_0x51a3bd(0x161)]){_0x596a8+=_0x51a3bd(0xaf);_0x41162c[_0x51a3bd(0x164)]&&(_0x596a8+=_0x51a3bd(0x111)+_0x41162c['customerName']+'`\x0a');_0x41162c[_0x51a3bd(0xaa)]&&(_0x596a8+='ğŸ“§\x20Email:\x20`'+_0x41162c[_0x51a3bd(0xaa)]+'`\x0a');_0x41162c[_0x51a3bd(0x122)]&&(_0x596a8+=_0x51a3bd(0x184)+_0x41162c[_0x51a3bd(0x122)]+'`\x0a');_0x41162c[_0x51a3bd(0xb6)]&&(_0x596a8+=_0x51a3bd(0xb1)+_0x41162c[_0x51a3bd(0xb6)]+'`\x0a');if(_0x41162c[_0x51a3bd(0x161)]){const _0x3da31f=_0x41162c[_0x51a3bd(0x161)]['length']>0x32?_0x41162c[_0x51a3bd(0x161)][_0x51a3bd(0x180)](0x0,0x32)+'...':_0x41162c[_0x51a3bd(0x161)];_0x596a8+=_0x51a3bd(0xdf)+_0x3da31f+'`\x0a';}}_0x31b8da===_0x51a3bd(0xde)&&_0x41162c[_0x51a3bd(0xef)]&&(_0x596a8+='ğŸ’¸\x20Penalty\x20amount:\x20*'+_0x41162c['chargebackAmount']+_0x51a3bd(0x14e)),_0x31b8da==='processing'&&(_0x596a8+=_0x51a3bd(0x135)),_0x41162c[_0x51a3bd(0xfa)]&&(_0x596a8+=_0x51a3bd(0x169)+_0x41162c['adminNotes']+'\x0a'),await this['sendShopNotification'](_0x1cec21,_0x596a8,{'parse_mode':_0x51a3bd(0x163)});}async['sendPayoutNotification'](_0x5783cf,_0x53af46){const _0x206476=a74_0x1b1ffb,_0x400d66=new Date(_0x53af46[_0x206476(0xb2)])[_0x206476(0x17b)](_0x206476(0x120),{'year':_0x206476(0x13f),'month':_0x206476(0x100),'day':'2-digit','hour':'2-digit','minute':'2-digit','second':'2-digit'}),_0x4dcdff='ğŸ’¸\x20*New\x20Payout*\x0a\x0a'+(_0x206476(0x155)+_0x400d66+'\x0a')+(_0x206476(0x15e)+_0x53af46['amount']+_0x206476(0x143))+(_0x206476(0x17d)+(_0x53af46[_0x206476(0x171)]||_0x206476(0xda))+'\x0a')+('ğŸŒ\x20*Network:*\x20'+(_0x53af46[_0x206476(0x167)]||_0x206476(0xda))+'\x0a')+('ğŸ’³\x20*Wallet:*\x20`'+(_0x53af46[_0x206476(0xb4)]||_0x206476(0xda))+'`\x0a')+(_0x53af46['txid']?_0x206476(0xe5)+_0x53af46[_0x206476(0x11e)]+'`':_0x206476(0xf7));await this[_0x206476(0x185)](_0x5783cf,_0x4dcdff,{'parse_mode':'Markdown'});}async[a74_0x1b1ffb(0x189)](_0xcca0ae,_0x21db0e){const _0x52699d=a74_0x1b1ffb;try{const _0x5235c5=await database_1[_0x52699d(0x149)][_0x52699d(0xd0)][_0x52699d(0xf3)]({'where':{'shopId':_0xcca0ae},'select':{'notificationLogin':!![]}});if(!_0x5235c5?.[_0x52699d(0x101)]){console[_0x52699d(0xd3)](_0x52699d(0x16a)+_0xcca0ae);return;}const _0x2d0ad5=_0x21db0e[_0x52699d(0xa9)]?'ğŸ”':'ğŸš¨',_0x515b83=_0x21db0e['success']?'Successful\x20login':'Failed\x20login\x20attempt';let _0x364032=_0x2d0ad5+'\x20*'+_0x515b83+'*\x0a\x0a'+('ğŸ‘¤\x20Username:\x20`'+_0x21db0e[_0x52699d(0xeb)]+'`\x0a')+(_0x52699d(0x187)+_0x21db0e[_0x52699d(0x118)][_0x52699d(0x17b)](_0x52699d(0x120))+'\x0a');_0x21db0e['ipAddress']&&(_0x364032+='ğŸŒ\x20IP\x20address:\x20`'+_0x21db0e['ipAddress']+'`\x0a');_0x21db0e[_0x52699d(0x10b)]&&(_0x364032+=_0x52699d(0xf8)+_0x21db0e[_0x52699d(0x10b)]+'\x0a');if(_0x21db0e[_0x52699d(0xba)]){const _0xfecfb0=_0x21db0e[_0x52699d(0xba)]['length']>0x32?_0x21db0e[_0x52699d(0xba)]['substring'](0x0,0x32)+_0x52699d(0x102):_0x21db0e[_0x52699d(0xba)];_0x364032+='ğŸ’»\x20Browser:\x20`'+_0xfecfb0+'`\x0a';}!_0x21db0e[_0x52699d(0xa9)]&&(_0x364032+=_0x52699d(0x181)),await this[_0x52699d(0x185)](_0xcca0ae,_0x364032,{'parse_mode':_0x52699d(0x163)}),console[_0x52699d(0xd3)]('âœ…\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0xcca0ae+':\x20'+(_0x21db0e['success']?_0x52699d(0xa9):'failed'));}catch(_0x16f3af){console[_0x52699d(0x17a)](_0x52699d(0x11c),_0x16f3af);}}async[a74_0x1b1ffb(0xce)](_0x19e210,_0x5a6694){const _0x56ac0d=a74_0x1b1ffb;try{const _0x55a260=await database_1[_0x56ac0d(0x149)][_0x56ac0d(0xd0)][_0x56ac0d(0xf3)]({'where':{'shopId':_0x19e210},'select':{'notificationApiError':!![]}});if(!_0x55a260?.[_0x56ac0d(0x105)]){console['log']('ğŸ“±\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x19e210);return;}let _0x4bc2a4=_0x56ac0d(0x11f)+(_0x56ac0d(0xed)+_0x5a6694[_0x56ac0d(0x183)]+'\x20'+_0x5a6694[_0x56ac0d(0xdc)]+'`\x0a')+(_0x56ac0d(0x187)+_0x5a6694[_0x56ac0d(0x118)][_0x56ac0d(0x17b)](_0x56ac0d(0x120))+'\x0a');_0x5a6694[_0x56ac0d(0x162)]&&(_0x4bc2a4+=_0x56ac0d(0x124)+_0x5a6694['statusCode']+'`\x0a'),_0x4bc2a4+=_0x56ac0d(0xe3)+_0x5a6694[_0x56ac0d(0xc2)]+'`\x0a',_0x5a6694[_0x56ac0d(0xd8)]&&(_0x4bc2a4+=_0x56ac0d(0x191)+_0x5a6694['requestId']+'`\x0a'),_0x4bc2a4+=_0x56ac0d(0x12c),await this[_0x56ac0d(0x185)](_0x19e210,_0x4bc2a4,{'parse_mode':_0x56ac0d(0x163)}),console[_0x56ac0d(0xd3)]('âœ…\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x19e210+':\x20'+_0x5a6694[_0x56ac0d(0xdc)]);}catch(_0xf1900b){console[_0x56ac0d(0x17a)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0xf1900b);}}async[a74_0x1b1ffb(0xd4)](_0x3e37bd,_0x3149bd,_0x486cfa){const _0x364fb0=a74_0x1b1ffb;let _0x253d94='ğŸ””\x20*'+_0x3149bd+_0x364fb0(0xdb);for(const [_0x557f59,_0x6293a0]of Object[_0x364fb0(0x107)](_0x486cfa)){_0x6293a0!==null&&_0x6293a0!==undefined&&(_0x253d94+=_0x557f59+_0x364fb0(0x128)+_0x6293a0+'`\x0a');}await this[_0x364fb0(0x185)](_0x3e37bd,_0x253d94,{'parse_mode':_0x364fb0(0x163)});}async[a74_0x1b1ffb(0x175)](_0x4c62ed){const _0x2b9c68=a74_0x1b1ffb;try{console['log']('ğŸ“±\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20'+_0x4c62ed['substring'](0x0,0x32)+_0x2b9c68(0x102));const _0x27356a=await database_1[_0x2b9c68(0x149)][_0x2b9c68(0x148)]['findMany']({'select':{'telegramId':!![]}});if(_0x27356a[_0x2b9c68(0x158)]===0x0){console[_0x2b9c68(0xd3)]('ğŸ“±\x20No\x20active\x20Telegram\x20users\x20found');return;}for(const _0x575cb0 of _0x27356a){try{await this[_0x2b9c68(0x13d)]?.[_0x2b9c68(0xa7)](_0x575cb0[_0x2b9c68(0x16e)],_0x4c62ed,{'parse_mode':_0x2b9c68(0x163)});}catch(_0x41401a){console[_0x2b9c68(0x17a)](_0x2b9c68(0x173)+_0x575cb0[_0x2b9c68(0x16e)]+':',_0x41401a);}}console['log'](_0x2b9c68(0x10a)+_0x27356a[_0x2b9c68(0x158)]+_0x2b9c68(0x129));}catch(_0x30a0f8){console[_0x2b9c68(0x17a)](_0x2b9c68(0x153),_0x30a0f8);}}[a74_0x1b1ffb(0xbc)](){const _0x3bf997=a74_0x1b1ffb;return{'isActive':!!this['bot'],'username':this[_0x3bf997(0x14c)]};}async[a74_0x1b1ffb(0xe6)](_0x4407e4,_0x303a70,_0x11d340,_0x50ab1f){const _0x54f796=a74_0x1b1ffb;try{if(!this[_0x54f796(0x13d)])return console['error'](_0x54f796(0xff)),![];const _0x5ad5a0=await database_1[_0x54f796(0x149)][_0x54f796(0x148)]['findMany']({'where':{'shopId':_0x4407e4,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x5ad5a0[_0x54f796(0x158)]===0x0)return console[_0x54f796(0x17a)]('âŒ\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20'+_0x4407e4),![];let _0x49b1d9=0x0;for(const _0x2bff6a of _0x5ad5a0){try{await this[_0x54f796(0x13d)]['sendDocument'](_0x2bff6a['telegramId'],_0x303a70,{},{'filename':_0x11d340,'contentType':_0x11d340[_0x54f796(0x113)](_0x54f796(0x9c))?_0x54f796(0xc8):_0x11d340[_0x54f796(0x113)](_0x54f796(0x13a))||_0x11d340[_0x54f796(0x113)]('.jpeg')?_0x54f796(0xf1):_0x11d340[_0x54f796(0x113)]('.pdf')?'application/pdf':'application/octet-stream'}),_0x50ab1f&&await this[_0x54f796(0x13d)]['sendMessage'](_0x2bff6a[_0x54f796(0x16e)],_0x50ab1f),_0x49b1d9++;}catch(_0x2e607b){console['error'](_0x54f796(0x145)+_0x2bff6a['telegramId']+':',_0x2e607b);}}return console['log'](_0x54f796(0xe0)+_0x49b1d9+'/'+_0x5ad5a0[_0x54f796(0x158)]+_0x54f796(0xb8)+_0x4407e4+':\x20'+_0x11d340),_0x49b1d9>0x0;}catch(_0x4cb9ec){return console[_0x54f796(0x17a)]('âŒ\x20Error\x20sending\x20file\x20to\x20shop:',_0x4cb9ec),![];}}async[a74_0x1b1ffb(0x174)](_0x2ea842,_0x3dc22e){const _0x15c62d=a74_0x1b1ffb;try{if(!this['bot'])return console[_0x15c62d(0x17a)](_0x15c62d(0xff)),![];return await this[_0x15c62d(0x13d)][_0x15c62d(0xa7)](_0x2ea842,_0x3dc22e),console[_0x15c62d(0xd3)]('âœ…\x20Direct\x20message\x20sent\x20to\x20chat\x20'+_0x2ea842),!![];}catch(_0x485c97){return console[_0x15c62d(0x17a)]('âŒ\x20Error\x20sending\x20direct\x20message:',_0x485c97),![];}}async['sendDirectFile'](_0x241d2f,_0x376c6b,_0x5840ac,_0x5dcfbf){const _0x18a3b1=a74_0x1b1ffb;try{if(!this['bot'])return console['error'](_0x18a3b1(0xff)),![];return await this['bot'][_0x18a3b1(0x10c)](_0x241d2f,_0x376c6b,{},{'filename':_0x5840ac,'contentType':_0x5840ac[_0x18a3b1(0x113)]('.png')?'image/png':_0x5840ac[_0x18a3b1(0x113)](_0x18a3b1(0x13a))||_0x5840ac[_0x18a3b1(0x113)]('.jpeg')?_0x18a3b1(0xf1):_0x5840ac[_0x18a3b1(0x113)](_0x18a3b1(0x16f))?_0x18a3b1(0x11b):_0x18a3b1(0x110)}),_0x5dcfbf&&await this[_0x18a3b1(0x13d)][_0x18a3b1(0xa7)](_0x241d2f,_0x5dcfbf),console[_0x18a3b1(0xd3)](_0x18a3b1(0x16d)+_0x241d2f+':\x20'+_0x5840ac),!![];}catch(_0x4d37dc){return console[_0x18a3b1(0x17a)](_0x18a3b1(0x154),_0x4d37dc),![];}}['stopBot'](){const _0x102a13=a74_0x1b1ffb;this[_0x102a13(0x13d)]&&(this[_0x102a13(0x13d)][_0x102a13(0x125)](),this[_0x102a13(0x13d)]=null,console['log'](_0x102a13(0xa5)));}}exports[a74_0x1b1ffb(0x11d)]=TelegramBotService,exports[a74_0x1b1ffb(0x18f)]=new TelegramBotService();function a74_0x3c12(){const _0x40a0f4=['Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','unknown\x20shop','â—ï¸\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','âŒ\x20Telegram\x20bot\x20not\x20initialized','2-digit','notificationLogin','...','trim','âŒ\x20Shop\x20with\x20username\x20`','notificationApiError','__esModule','entries','setupBotHandlers','2304270yWeKMN','ğŸ“±\x20Notification\x20sent\x20to\x20','geo','sendDocument','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','âœ…\x20Welcome\x20back!\x0a\x0a','pk_','application/octet-stream','ğŸ“›\x20Name:\x20`','\x20initialized\x20successfully','endsWith','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','chat','Contact\x20administrator.','from','timestamp','Error\x20handling\x20/disconnect\x20command:','âœ…\x20Telegram\x20bot\x20@','application/pdf','Failed\x20to\x20send\x20login\x20notification:','TelegramBotService','txid','ğŸš¨\x20*API\x20Error*\x0a\x0a','en-US','2364TBltmL','remitterIban','toString','ğŸ“Š\x20Error\x20code:\x20`','stopPolling','ğŸ”\x20*Debug\x20Information*\x0a\x0a','name',':\x20`','\x20users','Error\x20handling\x20/debug\x20command:','9gLAgYM','\x0ağŸ’¡\x20Check\x20your\x20request\x20or\x20contact\x20support.','join','Example:\x0a','last_name','initializeBot','â€¢\x20Payouts\x0a','map','Payment\x20expired','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','â³\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','â€¢\x20Important\x20events\x0a\x0a','allSettled','âŒ\x20Shop\x20`','558muDIPa','.jpg','shopId','âŒ\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','bot','blocked','numeric','isVerified','sendPaymentNotification','ğŸ”„\x20Processing\x20single-line\x20verification\x20for\x20user\x20','\x20USD\x0a','botToken','âŒ\x20Error\x20sending\x20file\x20to\x20user\x20','handleSingleLineVerification','ğŸ‰\x20*Congratulations!*\x0a\x0a','telegramUser','default','ğŸ†”\x20Payment\x20ID:\x20`','105468KBLKDV','botUsername','ğŸ’°\x20Amount:\x20*','\x20USDT*\x0a','shop','first_name','ğŸ“±\x20Telegram\x20notification:\x20gateway\x20\x22','3468636TiJytY','âŒ\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','âŒ\x20Error\x20sending\x20file\x20to\x20chat:','ğŸ“…\x20*Payout\x20Date:*\x20','Error\x20handling\x20message:','âŒ\x20Invalid\x20API\x20key\x20format.\x0a\x0a','length','`\x0a\x0a','includes','`.\x0a\x0a','âŒ\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','chat\x20not\x20found','ğŸ’°\x20*Amount:*\x20','/status\x20-\x20check\x20connection\x20status\x0a','Telegram\x20bot\x20error:','customerUa','statusCode','Markdown','customerName','âŒ\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','ğŸ¤–\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','network','User\x20','ğŸ“\x20Notes:\x20','ğŸ“±\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','\x20disconnected\x20from\x20shop\x20','sk_','âœ…\x20File\x20sent\x20to\x20chat\x20','telegramId','.pdf','gateway','period','ğŸ“±\x20Created\x20new\x20Telegram\x20user:\x20','âŒ\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','sendDirectMessage','sendNotificationToAll',':\x20username=\x22','â€¢\x20Payment\x20status\x20changes\x0a','polling_error','ğŸ””\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','error','toLocaleString','ğŸ‘¤\x20Username:\x20`','â±ï¸\x20*Period:*\x20','âŒ\x20Error\x20getting\x20debug\x20information.','status','substring','\x0aâš ï¸\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','method','ğŸ¦\x20IBAN:\x20`','sendShopNotification','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','ğŸ“…\x20Time:\x20','26660VhhTFR','sendLoginNotification','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','â€¢\x20New\x20payments\x0a','ğŸª\x20Gateway:\x20`','277297QJajQI','text','telegramBotService','âœ…\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','ğŸ†”\x20Request\x20ID:\x20`','âœ…\x20Telegram\x20user\x20','.png','message','findMany','âŒ\x20Invalid\x20username\x20format:\x20`','ğŸ”Œ\x20User\x20','8HOCIZA','Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a','secretKey','ğŸ””\x20You\x20receive\x20notifications\x20about:\x0a','ğŸ›‘\x20Telegram\x20bot\x20stopped','ğŸ“\x20Format:\x20`username\x20api_key`\x0a\x0a','sendMessage','currency','success','customerEmail','warn','âŒ\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','node-telegram-bot-api','getGatewayDisplayNameForTelegram','\x0ağŸ‘¤\x20*Customer\x20Information:*\x0a','âœ…\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','ğŸŒ\x20IP:\x20`','createdAt','âŒ\x20Please\x20use\x20/start\x20command\x20first','wallet','Error\x20in\x20handleSingleLineVerification:','customerIp','publicKey','\x20users\x20of\x20shop\x20','754898khmGHq','userAgent','\x22,\x20apiKey=\x22','getBotInfo','Commands:\x0a','\x20\x20\x20Status:\x20','âŒ\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','New\x20payment\x20created','env','errorMessage','ğŸ”„\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','\x20via\x20single-line\x20input','âŒ\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a','Payment\x20is\x20being\x20processed','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','image/png','split','ğŸ“…\x20Date:\x20','Username:\x20`','\x20verified\x20for\x20shop\x20','findFirst','sendApiErrorNotification','You\x20sent\x20','shopSettings','toLocaleDateString','Error\x20handling\x20/start\x20command:','log','sendCustomNotification','/disconnect\x20-\x20disconnect\x20from\x20notifications','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','ğŸ“…\x20Connection\x20date:\x20','requestId','Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.','Not\x20specified','*\x0a\x0a','endpoint','create','chargeback','ğŸ’»\x20Browser:\x20`','âœ…\x20File\x20sent\x20to\x20','startsWith','584325TTclAx','âŒ\x20Error:\x20`','*.\x0a\x0a','ğŸ”—\x20*Transaction\x20Link:*\x20`','sendShopFile','45qPitun','update','Use\x20/start\x20to\x20connect.','\x20parts:\x20','username','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','ğŸ”—\x20Endpoint:\x20`','\x20\x20\x20Username:\x20`','chargebackAmount','../config/database','image/jpeg','âŒ\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','findUnique','...\x22','ACTIVE','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','ğŸ”—\x20*Transaction\x20Link:*\x20Pending','ğŸŒ\x20Country:\x20','onText','adminNotes'];a74_0x3c12=function(){return _0x40a0f4;};return a74_0x3c12();}