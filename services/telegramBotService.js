'use strict';function a54_0x73a4(_0x43d637,_0x3b46bb){const _0x52e7dc=a54_0x52e7();return a54_0x73a4=function(_0x73a49e,_0x91d655){_0x73a49e=_0x73a49e-0x8d;let _0x597db5=_0x52e7dc[_0x73a49e];return _0x597db5;},a54_0x73a4(_0x43d637,_0x3b46bb);}const a54_0x4f9db2=a54_0x73a4;(function(_0x2ffb3d,_0x3654e1){const _0x1ce414=a54_0x73a4,_0x2eb53a=_0x2ffb3d();while(!![]){try{const _0x382941=-parseInt(_0x1ce414(0x9e))/0x1*(parseInt(_0x1ce414(0xa2))/0x2)+-parseInt(_0x1ce414(0xb0))/0x3*(-parseInt(_0x1ce414(0xef))/0x4)+parseInt(_0x1ce414(0x161))/0x5+-parseInt(_0x1ce414(0x127))/0x6+parseInt(_0x1ce414(0xf9))/0x7*(-parseInt(_0x1ce414(0x16a))/0x8)+parseInt(_0x1ce414(0xf1))/0x9*(parseInt(_0x1ce414(0x131))/0xa)+-parseInt(_0x1ce414(0xbc))/0xb*(-parseInt(_0x1ce414(0x14d))/0xc);if(_0x382941===_0x3654e1)break;else _0x2eb53a['push'](_0x2eb53a['shift']());}catch(_0x463007){_0x2eb53a['push'](_0x2eb53a['shift']());}}}(a54_0x52e7,0x2dce2));function a54_0x52e7(){const _0xd9e20d=['isVerified','telegramId','🔍\x20*Debug\x20Information*\x0a\x0a','findMany','sendPaymentNotification','includes','📅\x20Connection\x20date:\x20','Error\x20in\x20handleSingleLineVerification:','shopSettings','map','5812015AEmLdX','status','notificationApiError','updatedAt','publicKey','🌐\x20IP:\x20`','user\x20is\x20deactivated','chat\x20not\x20found','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','📱\x20Created\x20new\x20Telegram\x20user:\x20','💸\x20Penalty\x20amount:\x20*','createdAt','unknown\x20shop','`\x0a\x0a','Commands:\x0a','chat','\x20\x20\x20Public\x20Key:\x20`','ipAddress','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','toString','...`\x0a\x0a','timestamp','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','split','Example:\x0a','adminNotes','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','telegramUser','en-US','sendLoginNotification','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','customerEmail','To\x20reconnect,\x20use\x20the\x20/start\x20command','Error\x20handling\x20/status\x20command:','stopBot','amount','❌\x20Error\x20getting\x20debug\x20information.','__importDefault','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','`\x20not\x20found.\x0a\x0a','sk_','💻\x20Browser:\x20`','...','📊\x20*Connection\x20Status*\x0a\x0a','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','bot','Telegram\x20bot\x20polling\x20error:','findFirst','log','polling_error','17188iipGfU','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','27hFBOak','\x20disconnected\x20from\x20shop\x20','🔗\x20TXID:\x20`','method','customerIp','🎉\x20*Congratulations!*\x0a\x0a','*.\x0a\x0a','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','7dSFFDS','trim','`.\x0a\x0a','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','length','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','name','allSettled','📅\x20Date:\x20','currency','Use\x20/start\x20to\x20begin.','🔔\x20Notifications\x20are\x20active\x0a\x0a','node-telegram-bot-api','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','handleSingleLineVerification','initializeBot','❌\x20Shop\x20`','•\x20Payment\x20status\x20changes\x0a','•\x20New\x20payments\x0a','defineProperty','sendShopNotification','getBotInfo','🏦\x20IBAN:\x20`','sendMessage','message','blocked','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','getGatewayDisplayNameForTelegram','💸\x20Amount:\x20*','warn','📝\x20Order\x20ID:\x20`','💰\x20Amount:\x20*','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','You\x20sent\x20','error','success','Payment\x20successfully\x20paid','toLocaleString','Contact\x20administrator.','Failed\x20login\x20attempt','🔔\x20*','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','Successful\x20login','env','pk_','Payout\x20rejected','638244QZavBd','Error\x20handling\x20/debug\x20command:','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','gateway','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','onText','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','•\x20Payouts\x0a\x0a','statusCode','findUnique','304720ZZilpP','update','customerUa','\x20via\x20single-line\x20input','TELEGRAM_BOT_USERNAME','Payout\x20completed','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','🆔\x20Payout\x20ID:\x20`','`\x20(','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','Available\x20usernames:\x0a','Failed\x20to\x20send\x20login\x20notification:','customerName','\x22\x20->\x20display\x20\x22','botUsername','setupBotHandlers','*\x0a\x0a','default','New\x20payment\x20created','Failed\x20to\x20send\x20API\x20error\x20notification:','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','🌐\x20IP\x20address:\x20`','Error\x20handling\x20message:','../config/database','📱\x20Your\x20Telegram\x20ID:\x20`','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','Markdown','txid','12quwoiM','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','join','TelegramBotService',':\x20`','test','sendCustomNotification','secretKey','substring','userAgent','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','📱\x20Telegram\x20notification:\x20gateway\x20\x22','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','•\x20`','New\x20payout\x20created','.\x20*','📱\x20Shop:\x20*','✅\x20Telegram\x20bot\x20@','Username:\x20`','shopId','71845qRHoiy','🔔\x20You\x20receive\x20notifications\x20about:\x0a','❌\x20Please\x20use\x20/start\x20command\x20first','\x20USD*\x0a','last_name','\x0a👤\x20*Customer\x20Information:*\x0a','startsWith','Error\x20sending\x20shop\x20notification:','🏦\x20Method:\x20`','1081064OIYFdQ','username','🏪\x20Gateway:\x20`','Payment\x20expired','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','notificationLogin','🚨\x20*API\x20Error*\x0a\x0a','remitterIban','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','📊\x20Error\x20code:\x20`','🔌\x20User\x20','User\x20','Payment\x20refund','📅\x20Time:\x20','create','\x20\x20\x20Status:\x20','\x20initialized\x20successfully','chargebackAmount','shop','🛑\x20Telegram\x20bot\x20stopped','Payment\x20is\x20being\x20processed','TELEGRAM_BOT_TOKEN','text','chargeback','12iBlpKz','\x22,\x20apiKey=\x22','failed','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','56372qwlcvs','forEach','/disconnect\x20-\x20disconnect\x20from\x20notifications','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','__esModule','...\x22','botToken','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','from','Use\x20/start\x20to\x20connect.','🔗\x20Endpoint:\x20`','Payment\x20failed','endpoint','👤\x20Username:\x20`','93fVsHmE',':\x20username=\x22'];a54_0x52e7=function(){return _0xd9e20d;};return a54_0x52e7();}var __importDefault=this&&this[a54_0x4f9db2(0xe2)]||function(_0x2a2c3a){const _0x293ce6=a54_0x4f9db2;return _0x2a2c3a&&_0x2a2c3a[_0x293ce6(0xa6)]?_0x2a2c3a:{'default':_0x2a2c3a};};Object[a54_0x4f9db2(0x10c)](exports,a54_0x4f9db2(0xa6),{'value':!![]}),exports['telegramBotService']=exports[a54_0x4f9db2(0x150)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x4f9db2(0x105))),database_1=__importDefault(require(a54_0x4f9db2(0x148))),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x4a9051=a54_0x4f9db2;this[_0x4a9051(0xea)]=null,this[_0x4a9051(0xa8)]=process['env'][_0x4a9051(0x9b)]||'',this[_0x4a9051(0x13f)]=process[_0x4a9051(0x124)][_0x4a9051(0x135)]||'trapay_bot',this[_0x4a9051(0xa8)]?this['initializeBot']():console[_0x4a9051(0x116)](_0x4a9051(0x16e));}[a54_0x4f9db2(0x108)](){const _0x1b870f=a54_0x4f9db2;try{this[_0x1b870f(0xea)]=new node_telegram_bot_api_1['default'](this[_0x1b870f(0xa8)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x1b870f(0xed)](_0x1b870f(0x15e)+this[_0x1b870f(0x13f)]+_0x1b870f(0x96));}catch(_0x4166f6){console['error'](_0x1b870f(0xe9),_0x4166f6);}}[a54_0x4f9db2(0x140)](){const _0x546689=a54_0x4f9db2;if(!this[_0x546689(0xea)])return;this[_0x546689(0xea)][_0x546689(0x12c)](/\/start/,async _0x119b9d=>{const _0xb55649=_0x546689,_0x12ce1a=_0x119b9d['chat']['id'],_0x548977=_0x119b9d[_0xb55649(0xaa)]?.['id']['toString'](),_0x3ca049=_0x119b9d['from']?.[_0xb55649(0x16b)],_0x3e9dfe=_0x119b9d[_0xb55649(0xaa)]?.['first_name'],_0xe49438=_0x119b9d[_0xb55649(0xaa)]?.[_0xb55649(0x165)];if(!_0x548977)return;try{let _0x11ec49=await database_1[_0xb55649(0x142)][_0xb55649(0xd8)]['findUnique']({'where':{'telegramId':_0x548977},'include':{'shop':!![]}});!_0x11ec49?(_0x11ec49=await database_1['default'][_0xb55649(0xd8)][_0xb55649(0x94)]({'data':{'telegramId':_0x548977,'username':_0x3ca049,'firstName':_0x3e9dfe,'lastName':_0xe49438,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log'](_0xb55649(0xc5)+_0x548977+'\x20(@'+_0x3ca049+')')):_0x11ec49=await database_1[_0xb55649(0x142)][_0xb55649(0xd8)][_0xb55649(0x132)]({'where':{'telegramId':_0x548977},'data':{'username':_0x3ca049,'firstName':_0x3e9dfe,'lastName':_0xe49438},'include':{'shop':!![]}}),_0x11ec49['isVerified']&&_0x11ec49['shopId']&&_0x11ec49[_0xb55649(0x98)]?await this['bot']?.[_0xb55649(0x110)](_0x12ce1a,'✅\x20Welcome\x20back!\x0a\x0a'+(_0xb55649(0x145)+_0x11ec49[_0xb55649(0x98)][_0xb55649(0xff)]+'*\x0a')+(_0xb55649(0x15f)+_0x11ec49[_0xb55649(0x98)][_0xb55649(0x16b)]+'`\x0a\x0a')+_0xb55649(0x162)+_0xb55649(0x10b)+_0xb55649(0x10a)+_0xb55649(0x12e)+_0xb55649(0xca)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0xb55649(0xa4),{'parse_mode':_0xb55649(0x14b)}):(_0x11ec49['shopId']&&!_0x11ec49[_0xb55649(0xb2)]&&(await database_1[_0xb55649(0x142)]['telegramUser'][_0xb55649(0x132)]({'where':{'telegramId':_0x548977},'data':{'shopId':null,'isVerified':![]}}),console[_0xb55649(0xed)](_0xb55649(0x14a)+_0x548977)),await this[_0xb55649(0xea)]?.[_0xb55649(0x110)](_0x12ce1a,_0xb55649(0xd3)+_0xb55649(0x113)+_0xb55649(0x119)+'Example:\x0a'+_0xb55649(0x12b)+_0xb55649(0xe3),{'parse_mode':'Markdown'}));}catch(_0x349ad3){console[_0xb55649(0x11b)]('Error\x20handling\x20/start\x20command:',_0x349ad3),await this['bot']?.[_0xb55649(0x110)](_0x12ce1a,_0xb55649(0x122));}}),this[_0x546689(0xea)]['onText'](/\/disconnect/,async _0x4e1e24=>{const _0x3d722a=_0x546689,_0x57d407=_0x4e1e24[_0x3d722a(0xcb)]['id'],_0x39e2b1=_0x4e1e24['from']?.['id']['toString']();if(!_0x39e2b1)return;try{const _0x334834=await database_1[_0x3d722a(0x142)][_0x3d722a(0xd8)]['findUnique']({'where':{'telegramId':_0x39e2b1},'include':{'shop':!![]}});if(!_0x334834||!_0x334834[_0x3d722a(0xb2)]||!_0x334834[_0x3d722a(0x160)]){await this['bot']?.[_0x3d722a(0x110)](_0x57d407,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x4d748f=_0x334834[_0x3d722a(0x98)]?.['name']||_0x3d722a(0xc8);await database_1[_0x3d722a(0x142)][_0x3d722a(0xd8)][_0x3d722a(0x132)]({'where':{'telegramId':_0x39e2b1},'data':{'shopId':null,'isVerified':![]}}),console[_0x3d722a(0xed)](_0x3d722a(0x90)+_0x39e2b1+_0x3d722a(0xf2)+_0x334834['shopId']),await this[_0x3d722a(0xea)]?.['sendMessage'](_0x57d407,_0x3d722a(0x13a)+_0x4d748f+_0x3d722a(0xf7)+_0x3d722a(0xdd),{'parse_mode':_0x3d722a(0x14b)});}catch(_0x435a41){console[_0x3d722a(0x11b)]('Error\x20handling\x20/disconnect\x20command:',_0x435a41),await this[_0x3d722a(0xea)]?.[_0x3d722a(0x110)](_0x57d407,_0x3d722a(0x122));}}),this['bot'][_0x546689(0x12c)](/\/status/,async _0x23b102=>{const _0x3b7e57=_0x546689,_0x27c456=_0x23b102['chat']['id'],_0x32fa56=_0x23b102[_0x3b7e57(0xaa)]?.['id'][_0x3b7e57(0xd0)]();if(!_0x32fa56)return;try{const _0x1a8a2b=await database_1['default']['telegramUser'][_0x3b7e57(0x130)]({'where':{'telegramId':_0x32fa56},'include':{'shop':!![]}});if(!_0x1a8a2b){await this[_0x3b7e57(0xea)]?.[_0x3b7e57(0x110)](_0x27c456,_0x3b7e57(0x8e)+_0x3b7e57(0x103));return;}if(!_0x1a8a2b[_0x3b7e57(0xb2)]||!_0x1a8a2b['shopId']||!_0x1a8a2b[_0x3b7e57(0x98)]){await this[_0x3b7e57(0xea)]?.['sendMessage'](_0x27c456,_0x3b7e57(0xcf)+_0x3b7e57(0xab));return;}await this['bot']?.[_0x3b7e57(0x110)](_0x27c456,_0x3b7e57(0xe8)+('✅\x20Connected\x20to\x20shop:\x20*'+_0x1a8a2b[_0x3b7e57(0x98)][_0x3b7e57(0xff)]+'*\x0a')+(_0x3b7e57(0xaf)+_0x1a8a2b[_0x3b7e57(0x98)][_0x3b7e57(0x16b)]+'`\x0a')+(_0x3b7e57(0xb8)+_0x1a8a2b[_0x3b7e57(0xbf)]['toLocaleDateString'](_0x3b7e57(0xd9))+'\x0a\x0a')+_0x3b7e57(0x104)+_0x3b7e57(0xca)+_0x3b7e57(0xa4),{'parse_mode':_0x3b7e57(0x14b)});}catch(_0xcc129a){console[_0x3b7e57(0x11b)](_0x3b7e57(0xde),_0xcc129a),await this[_0x3b7e57(0xea)]?.[_0x3b7e57(0x110)](_0x27c456,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x546689(0xea)][_0x546689(0x12c)](/\/debug/,async _0x42fc4e=>{const _0x3befe4=_0x546689,_0x388563=_0x42fc4e[_0x3befe4(0xcb)]['id'],_0x328749=_0x42fc4e[_0x3befe4(0xaa)]?.['id'][_0x3befe4(0xd0)]();if(!_0x328749)return;try{const _0x185cb9=await database_1['default'][_0x3befe4(0x98)][_0x3befe4(0xb5)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x5759d1=_0x3befe4(0xb4);_0x5759d1+=_0x3befe4(0x149)+_0x328749+_0x3befe4(0xc9),_0x5759d1+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x185cb9[_0x3befe4(0xa3)]((_0xd65571,_0x3c116c)=>{const _0x5307e8=_0x3befe4;_0x5759d1+=_0x3c116c+0x1+_0x5307e8(0x15c)+_0xd65571['name']+'*\x0a',_0x5759d1+='\x20\x20\x20Username:\x20`'+_0xd65571[_0x5307e8(0x16b)]+'`\x0a',_0x5759d1+=_0x5307e8(0x95)+_0xd65571[_0x5307e8(0xbd)]+'\x0a',_0x5759d1+=_0x5307e8(0xcc)+_0xd65571[_0x5307e8(0xc0)][_0x5307e8(0x155)](0x0,0xf)+_0x5307e8(0xd1);}),await this[_0x3befe4(0xea)]?.['sendMessage'](_0x388563,_0x5759d1,{'parse_mode':_0x3befe4(0x14b)});}catch(_0x7d8fed){console['error'](_0x3befe4(0x128),_0x7d8fed),await this[_0x3befe4(0xea)]?.['sendMessage'](_0x388563,_0x3befe4(0xe1));}}),this[_0x546689(0xea)]['on'](_0x546689(0x111),async _0x3b7a13=>{const _0x15a912=_0x546689;if(_0x3b7a13[_0x15a912(0x9c)]?.['startsWith']('/'))return;const _0x47cb02=_0x3b7a13[_0x15a912(0xcb)]['id'],_0x2468e1=_0x3b7a13['from']?.['id'][_0x15a912(0xd0)](),_0x3585ac=_0x3b7a13[_0x15a912(0x9c)]?.[_0x15a912(0xfa)]();if(!_0x2468e1||!_0x3585ac)return;try{const _0x1d968e=await database_1[_0x15a912(0x142)][_0x15a912(0xd8)]['findUnique']({'where':{'telegramId':_0x2468e1},'include':{'shop':!![]}});if(!_0x1d968e){await this[_0x15a912(0xea)]?.['sendMessage'](_0x47cb02,_0x15a912(0x163));return;}if(_0x1d968e['isVerified']&&_0x1d968e[_0x15a912(0x160)]&&_0x1d968e[_0x15a912(0x98)]){await this[_0x15a912(0xea)]?.['sendMessage'](_0x47cb02,_0x15a912(0xf8)+_0x1d968e[_0x15a912(0x98)][_0x15a912(0xff)]+'*.\x0a\x0a'+_0x15a912(0xf0),{'parse_mode':'Markdown'});return;}const _0x1f0763=_0x3585ac[_0x15a912(0xd4)](/\s+/);if(_0x1f0763[_0x15a912(0xfd)]!==0x2){await this[_0x15a912(0xea)]?.['sendMessage'](_0x47cb02,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x15a912(0x119)+_0x15a912(0xd5)+_0x15a912(0x12b)+(_0x15a912(0x11a)+_0x1f0763[_0x15a912(0xfd)]+'\x20parts:\x20'+_0x1f0763['map'](_0x154d29=>'`'+_0x154d29+'`')[_0x15a912(0x14f)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0xba6884,_0x361880]=_0x1f0763;console[_0x15a912(0xed)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x2468e1+_0x15a912(0xb1)+_0xba6884+_0x15a912(0x9f)+_0x361880[_0x15a912(0x155)](0x0,0xa)+_0x15a912(0xa7)),await this[_0x15a912(0x107)](_0x47cb02,_0x2468e1,_0xba6884,_0x361880);}catch(_0x2d83b6){console[_0x15a912(0x11b)](_0x15a912(0x147),_0x2d83b6),await this[_0x15a912(0xea)]?.[_0x15a912(0x110)](_0x47cb02,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['on'](_0x546689(0x11b),_0x377e90=>{const _0x128480=_0x546689;console[_0x128480(0x11b)]('Telegram\x20bot\x20error:',_0x377e90);}),this[_0x546689(0xea)]['on'](_0x546689(0xee),_0x3f7b4a=>{const _0xfd52a7=_0x546689;console['error'](_0xfd52a7(0xeb),_0x3f7b4a);});}async[a54_0x4f9db2(0x107)](_0x4c7fdb,_0x33edac,_0x3d8959,_0x48779c){const _0x1526c5=a54_0x4f9db2;try{console[_0x1526c5(0xed)](_0x1526c5(0x12d)+_0x33edac+_0x1526c5(0xb1)+_0x3d8959+'\x22,\x20apiKey=\x22'+_0x48779c[_0x1526c5(0x155)](0x0,0xa)+_0x1526c5(0xa7));if(!_0x3d8959||_0x3d8959[_0x1526c5(0xfd)]<0x3||_0x3d8959[_0x1526c5(0xfd)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x1526c5(0x152)](_0x3d8959)){await this[_0x1526c5(0xea)]?.[_0x1526c5(0x110)](_0x4c7fdb,'❌\x20Invalid\x20username\x20format:\x20`'+_0x3d8959+_0x1526c5(0xc9)+_0x1526c5(0x157),{'parse_mode':'Markdown'});return;}if(!_0x48779c||!_0x48779c['startsWith'](_0x1526c5(0x125))&&!_0x48779c[_0x1526c5(0x167)](_0x1526c5(0xe5))){await this['bot']?.['sendMessage'](_0x4c7fdb,_0x1526c5(0xfc)+_0x1526c5(0x159),{'parse_mode':_0x1526c5(0x14b)});return;}const _0x222db1=await database_1[_0x1526c5(0x142)][_0x1526c5(0x98)][_0x1526c5(0x130)]({'where':{'username':_0x3d8959},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x222db1){const _0x9184a8=await database_1[_0x1526c5(0x142)][_0x1526c5(0x98)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x8b4014='❌\x20Shop\x20with\x20username\x20`'+_0x3d8959+_0x1526c5(0xe4);_0x9184a8[_0x1526c5(0xfd)]>0x0?(_0x8b4014+=_0x1526c5(0x13b),_0x9184a8[_0x1526c5(0xa3)](_0x3cfa23=>{const _0x39eed0=_0x1526c5;_0x8b4014+=_0x39eed0(0x15a)+_0x3cfa23[_0x39eed0(0x16b)]+_0x39eed0(0x139)+_0x3cfa23['name']+')\x0a';}),_0x8b4014+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x8b4014+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x1526c5(0xea)]?.[_0x1526c5(0x110)](_0x4c7fdb,_0x8b4014,{'parse_mode':'Markdown'});return;}if(_0x222db1[_0x1526c5(0xbd)]!=='ACTIVE'){await this[_0x1526c5(0xea)]?.['sendMessage'](_0x4c7fdb,_0x1526c5(0x109)+_0x3d8959+'`\x20is\x20inactive.\x0a\x0a'+_0x1526c5(0x11f),{'parse_mode':_0x1526c5(0x14b)});return;}if(_0x222db1[_0x1526c5(0xc0)]!==_0x48779c&&_0x222db1[_0x1526c5(0x154)]!==_0x48779c){await this['bot']?.['sendMessage'](_0x4c7fdb,_0x1526c5(0xce)+_0x3d8959+_0x1526c5(0xfb)+_0x1526c5(0xa9)+_0x1526c5(0x14e),{'parse_mode':_0x1526c5(0x14b)});return;}const _0x51638b=await database_1[_0x1526c5(0x142)][_0x1526c5(0xd8)][_0x1526c5(0xec)]({'where':{'shopId':_0x222db1['id'],'isVerified':!![],'telegramId':{'not':_0x33edac}}});if(_0x51638b){await this[_0x1526c5(0xea)]?.[_0x1526c5(0x110)](_0x4c7fdb,_0x1526c5(0xa1)+_0x3d8959+_0x1526c5(0xfb)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x1526c5(0x14b)});return;}await database_1[_0x1526c5(0x142)][_0x1526c5(0xd8)][_0x1526c5(0x132)]({'where':{'telegramId':_0x33edac},'data':{'shopId':_0x222db1['id'],'isVerified':!![]}}),await this['bot']?.['sendMessage'](_0x4c7fdb,_0x1526c5(0xf6)+_0x1526c5(0xd7)+(_0x1526c5(0x15d)+_0x222db1[_0x1526c5(0xff)]+'*\x0a')+(_0x1526c5(0xaf)+_0x222db1[_0x1526c5(0x16b)]+_0x1526c5(0xc9))+_0x1526c5(0x170)+_0x1526c5(0x10b)+_0x1526c5(0x10a)+'•\x20Payouts\x0a'+'•\x20Important\x20events\x0a\x0a'+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x1526c5(0xa4),{'parse_mode':_0x1526c5(0x14b)}),console[_0x1526c5(0xed)]('✅\x20Telegram\x20user\x20'+_0x33edac+'\x20verified\x20for\x20shop\x20'+_0x222db1[_0x1526c5(0x16b)]+_0x1526c5(0x134));}catch(_0x10a0f0){console['error'](_0x1526c5(0xb9),_0x10a0f0),await this[_0x1526c5(0xea)]?.[_0x1526c5(0x110)](_0x4c7fdb,_0x1526c5(0xc4));}}async['sendShopNotification'](_0x4011c4,_0x4e2e74,_0x58f6dd){const _0xcdab29=a54_0x4f9db2;if(!this[_0xcdab29(0xea)]){console[_0xcdab29(0x116)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x38df13=await database_1[_0xcdab29(0x142)][_0xcdab29(0xd8)]['findMany']({'where':{'shopId':_0x4011c4,'isVerified':!![]}});if(_0x38df13[_0xcdab29(0xfd)]===0x0){console['log'](_0xcdab29(0xa5)+_0x4011c4);return;}const _0x3915f6=_0x38df13[_0xcdab29(0xbb)](async _0x1b8ef8=>{const _0x5d1e94=_0xcdab29;try{await this[_0x5d1e94(0xea)]?.[_0x5d1e94(0x110)](_0x1b8ef8[_0x5d1e94(0xb3)],_0x4e2e74,_0x58f6dd),console[_0x5d1e94(0xed)](_0x5d1e94(0xdb)+_0x1b8ef8[_0x5d1e94(0xb3)]);}catch(_0x144481){console[_0x5d1e94(0x11b)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x1b8ef8['telegramId']+':',_0x144481),_0x144481 instanceof Error&&(_0x144481[_0x5d1e94(0x111)][_0x5d1e94(0xb7)](_0x5d1e94(0x112))||_0x144481['message'][_0x5d1e94(0xb7)](_0x5d1e94(0xc3))||_0x144481[_0x5d1e94(0x111)][_0x5d1e94(0xb7)](_0x5d1e94(0xc2)))&&(await database_1[_0x5d1e94(0x142)][_0x5d1e94(0xd8)]['update']({'where':{'id':_0x1b8ef8['id']},'data':{'isVerified':![]}}),console[_0x5d1e94(0xed)](_0x5d1e94(0x91)+_0x1b8ef8[_0x5d1e94(0xb3)]+_0x5d1e94(0xfe)));}});await Promise[_0xcdab29(0x100)](_0x3915f6);}catch(_0x5b762f){console['error'](_0xcdab29(0x168),_0x5b762f);}}async[a54_0x4f9db2(0xb6)](_0x536538,_0x10924f,_0x28ed1e){const _0x1e9bb4=a54_0x4f9db2,_0x187f95={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x514b18={'created':_0x1e9bb4(0x143),'paid':_0x1e9bb4(0x11d),'failed':_0x1e9bb4(0xad),'expired':_0x1e9bb4(0x16d),'refund':_0x1e9bb4(0x92),'chargeback':'Payment\x20chargeback','processing':_0x1e9bb4(0x9a)},_0x155a05=_0x187f95[_0x28ed1e],_0x376899=_0x514b18[_0x28ed1e],_0x5913e3=(0x0,gateway_1[_0x1e9bb4(0x114)])(_0x10924f[_0x1e9bb4(0x12a)]);console['log'](_0x1e9bb4(0x158)+_0x10924f[_0x1e9bb4(0x12a)]+_0x1e9bb4(0x13e)+_0x5913e3+'\x22');let _0xe28ccd=_0x155a05+'\x20*'+_0x376899+'*\x0a\x0a'+(_0x1e9bb4(0x118)+_0x10924f['amount']+'\x20'+_0x10924f[_0x1e9bb4(0x102)]+'*\x0a')+(_0x1e9bb4(0x117)+(_0x10924f['orderId']||_0x10924f['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x10924f['id']+'`\x0a')+(_0x1e9bb4(0x16c)+_0x5913e3+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x10924f[_0x1e9bb4(0xc7)])[_0x1e9bb4(0x11e)]('en-US')+'\x0a');if(_0x10924f[_0x1e9bb4(0x13d)]||_0x10924f[_0x1e9bb4(0xdc)]||_0x10924f['remitterIban']||_0x10924f[_0x1e9bb4(0xf5)]||_0x10924f[_0x1e9bb4(0x133)]){_0xe28ccd+=_0x1e9bb4(0x166);_0x10924f[_0x1e9bb4(0x13d)]&&(_0xe28ccd+='📛\x20Name:\x20`'+_0x10924f['customerName']+'`\x0a');_0x10924f[_0x1e9bb4(0xdc)]&&(_0xe28ccd+='📧\x20Email:\x20`'+_0x10924f[_0x1e9bb4(0xdc)]+'`\x0a');_0x10924f[_0x1e9bb4(0x8d)]&&(_0xe28ccd+=_0x1e9bb4(0x10f)+_0x10924f[_0x1e9bb4(0x8d)]+'`\x0a');_0x10924f[_0x1e9bb4(0xf5)]&&(_0xe28ccd+=_0x1e9bb4(0xc1)+_0x10924f['customerIp']+'`\x0a');if(_0x10924f[_0x1e9bb4(0x133)]){const _0x250f97=_0x10924f[_0x1e9bb4(0x133)][_0x1e9bb4(0xfd)]>0x32?_0x10924f[_0x1e9bb4(0x133)][_0x1e9bb4(0x155)](0x0,0x32)+_0x1e9bb4(0xe7):_0x10924f['customerUa'];_0xe28ccd+=_0x1e9bb4(0xe6)+_0x250f97+'`\x0a';}}_0x28ed1e===_0x1e9bb4(0x9d)&&_0x10924f[_0x1e9bb4(0x97)]&&(_0xe28ccd+=_0x1e9bb4(0xc6)+_0x10924f[_0x1e9bb4(0x97)]+'\x20USDT*\x0a'),_0x28ed1e==='processing'&&(_0xe28ccd+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x10924f[_0x1e9bb4(0xd6)]&&(_0xe28ccd+='📝\x20Notes:\x20'+_0x10924f['adminNotes']+'\x0a'),await this[_0x1e9bb4(0x10d)](_0x536538,_0xe28ccd,{'parse_mode':_0x1e9bb4(0x14b)});}async['sendPayoutNotification'](_0x544017,_0x3de6e0,_0xf582f){const _0x4efcd1=a54_0x4f9db2,_0x45b758={'created':'📤','completed':'✅','rejected':'❌'},_0xd15176={'created':_0x4efcd1(0x15b),'completed':_0x4efcd1(0x136),'rejected':_0x4efcd1(0x126)},_0x1c55a6=_0x45b758[_0xf582f],_0xf406e9=_0xd15176[_0xf582f],_0x2fc399=_0x1c55a6+'\x20*'+_0xf406e9+'*\x0a\x0a'+(_0x4efcd1(0x115)+_0x3de6e0[_0x4efcd1(0xe0)]+_0x4efcd1(0x164))+(_0x4efcd1(0x169)+_0x3de6e0[_0x4efcd1(0xf4)]+'`\x0a')+(_0x4efcd1(0x138)+_0x3de6e0['id']+'`\x0a')+(_0x4efcd1(0x101)+new Date(_0x3de6e0['createdAt'])[_0x4efcd1(0x11e)](_0x4efcd1(0xd9))+'\x0a')+(_0x3de6e0[_0x4efcd1(0x14c)]?_0x4efcd1(0xf3)+_0x3de6e0[_0x4efcd1(0x14c)]+'`':'');await this[_0x4efcd1(0x10d)](_0x544017,_0x2fc399,{'parse_mode':_0x4efcd1(0x14b)});}async[a54_0x4f9db2(0xda)](_0x59b9ed,_0x2faf30){const _0xec9528=a54_0x4f9db2;try{const _0x953018=await database_1['default'][_0xec9528(0xba)][_0xec9528(0x130)]({'where':{'shopId':_0x59b9ed},'select':{'notificationLogin':!![]}});if(!_0x953018?.[_0xec9528(0x171)]){console[_0xec9528(0xed)]('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x59b9ed);return;}const _0x57d8ab=_0x2faf30['success']?'🔐':'🚨',_0x5bfd17=_0x2faf30[_0xec9528(0x11c)]?_0xec9528(0x123):_0xec9528(0x120);let _0x55a2c6=_0x57d8ab+'\x20*'+_0x5bfd17+'*\x0a\x0a'+(_0xec9528(0xaf)+_0x2faf30['username']+'`\x0a')+(_0xec9528(0x93)+_0x2faf30[_0xec9528(0xd2)][_0xec9528(0x11e)](_0xec9528(0xd9))+'\x0a');_0x2faf30[_0xec9528(0xcd)]&&(_0x55a2c6+=_0xec9528(0x146)+_0x2faf30[_0xec9528(0xcd)]+'`\x0a');if(_0x2faf30[_0xec9528(0x156)]){const _0x29097d=_0x2faf30[_0xec9528(0x156)][_0xec9528(0xfd)]>0x32?_0x2faf30[_0xec9528(0x156)][_0xec9528(0x155)](0x0,0x32)+_0xec9528(0xe7):_0x2faf30[_0xec9528(0x156)];_0x55a2c6+=_0xec9528(0xe6)+_0x29097d+'`\x0a';}!_0x2faf30[_0xec9528(0x11c)]&&(_0x55a2c6+=_0xec9528(0x106)),await this[_0xec9528(0x10d)](_0x59b9ed,_0x55a2c6,{'parse_mode':_0xec9528(0x14b)}),console[_0xec9528(0xed)](_0xec9528(0x137)+_0x59b9ed+':\x20'+(_0x2faf30[_0xec9528(0x11c)]?_0xec9528(0x11c):_0xec9528(0xa0)));}catch(_0x522718){console[_0xec9528(0x11b)](_0xec9528(0x13c),_0x522718);}}async['sendApiErrorNotification'](_0x53d10b,_0x296a0d){const _0x2cdf13=a54_0x4f9db2;try{const _0x5e90ed=await database_1[_0x2cdf13(0x142)][_0x2cdf13(0xba)][_0x2cdf13(0x130)]({'where':{'shopId':_0x53d10b},'select':{'notificationApiError':!![]}});if(!_0x5e90ed?.[_0x2cdf13(0xbe)]){console[_0x2cdf13(0xed)](_0x2cdf13(0x16f)+_0x53d10b);return;}let _0x46b974=_0x2cdf13(0x172)+(_0x2cdf13(0xac)+_0x296a0d[_0x2cdf13(0xf4)]+'\x20'+_0x296a0d[_0x2cdf13(0xae)]+'`\x0a')+(_0x2cdf13(0x93)+_0x296a0d[_0x2cdf13(0xd2)][_0x2cdf13(0x11e)](_0x2cdf13(0xd9))+'\x0a');_0x296a0d[_0x2cdf13(0x12f)]&&(_0x46b974+=_0x2cdf13(0x8f)+_0x296a0d[_0x2cdf13(0x12f)]+'`\x0a'),_0x46b974+='❌\x20Error:\x20`'+_0x296a0d['errorMessage']+'`\x0a',_0x296a0d['requestId']&&(_0x46b974+='🆔\x20Request\x20ID:\x20`'+_0x296a0d['requestId']+'`\x0a'),_0x46b974+=_0x2cdf13(0x129),await this[_0x2cdf13(0x10d)](_0x53d10b,_0x46b974,{'parse_mode':_0x2cdf13(0x14b)}),console[_0x2cdf13(0xed)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x53d10b+':\x20'+_0x296a0d[_0x2cdf13(0xae)]);}catch(_0x53b4f8){console[_0x2cdf13(0x11b)](_0x2cdf13(0x144),_0x53b4f8);}}async[a54_0x4f9db2(0x153)](_0x25a4a8,_0x3c514c,_0x1650ec){const _0x236744=a54_0x4f9db2;let _0x128b13=_0x236744(0x121)+_0x3c514c+_0x236744(0x141);for(const [_0x3a5bbd,_0x2e2091]of Object['entries'](_0x1650ec)){_0x2e2091!==null&&_0x2e2091!==undefined&&(_0x128b13+=_0x3a5bbd+_0x236744(0x151)+_0x2e2091+'`\x0a');}await this[_0x236744(0x10d)](_0x25a4a8,_0x128b13,{'parse_mode':_0x236744(0x14b)});}[a54_0x4f9db2(0x10e)](){const _0x4f7f43=a54_0x4f9db2;return{'isActive':!!this['bot'],'username':this[_0x4f7f43(0x13f)]};}[a54_0x4f9db2(0xdf)](){const _0x2f6859=a54_0x4f9db2;this[_0x2f6859(0xea)]&&(this[_0x2f6859(0xea)]['stopPolling'](),this[_0x2f6859(0xea)]=null,console[_0x2f6859(0xed)](_0x2f6859(0x99)));}}exports[a54_0x4f9db2(0x150)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();