'use strict';const a66_0x58bc0c=a66_0x4deb;(function(_0x1a34dc,_0x169221){const _0x418a60=a66_0x4deb,_0xdcb79c=_0x1a34dc();while(!![]){try{const _0xec71c=parseInt(_0x418a60(0x1a1))/0x1+parseInt(_0x418a60(0x1e8))/0x2+-parseInt(_0x418a60(0x236))/0x3*(parseInt(_0x418a60(0x19d))/0x4)+parseInt(_0x418a60(0x194))/0x5+parseInt(_0x418a60(0x1c4))/0x6*(parseInt(_0x418a60(0x19e))/0x7)+parseInt(_0x418a60(0x1be))/0x8*(parseInt(_0x418a60(0x27a))/0x9)+-parseInt(_0x418a60(0x198))/0xa*(parseInt(_0x418a60(0x1a7))/0xb);if(_0xec71c===_0x169221)break;else _0xdcb79c['push'](_0xdcb79c['shift']());}catch(_0x256489){_0xdcb79c['push'](_0xdcb79c['shift']());}}}(a66_0x11e9,0xbd0c9));var __importDefault=this&&this[a66_0x58bc0c(0x242)]||function(_0x47215a){const _0x180ac9=a66_0x58bc0c;return _0x47215a&&_0x47215a[_0x180ac9(0x25e)]?_0x47215a:{'default':_0x47215a};};Object['defineProperty'](exports,a66_0x58bc0c(0x25e),{'value':!![]}),exports['telegramBotService']=exports[a66_0x58bc0c(0x248)]=void 0x0;function a66_0x4deb(_0x102044,_0x5ab817){const _0x11e9cd=a66_0x11e9();return a66_0x4deb=function(_0x4deb55,_0x30e3d1){_0x4deb55=_0x4deb55-0x181;let _0x3d01dd=_0x11e9cd[_0x4deb55];return _0x3d01dd;},a66_0x4deb(_0x102044,_0x5ab817);}function a66_0x11e9(){const _0x28a57d=['status','customerName','sendLoginNotification','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','statusCode','...\x22','Payment\x20chargeback','•\x20Important\x20events\x0a\x0a','*.\x0a\x0a','📝\x20Order\x20ID:\x20`','Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.','👤\x20Username:\x20`','💻\x20Browser:\x20`','📛\x20Name:\x20`','❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','❌\x20Error\x20getting\x20debug\x20information.','bot','\x22\x20->\x20display\x20\x22','📅\x20Date:\x20','TELEGRAM_BOT_USERNAME','504957AXaqnz','Error\x20handling\x20/start\x20command:','isVerified','🏪\x20Your\x20connected\x20shop:\x0a','\x20\x20\x20Status:\x20','.png','Failed\x20login\x20attempt','requestId','🏦\x20IBAN:\x20`','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','Successful\x20login','shop','__importDefault','userAgent','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','\x20users\x20of\x20shop\x20','❌\x20Telegram\x20bot\x20not\x20initialized','✅\x20Telegram\x20bot\x20@','TelegramBotService','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','image/jpeg','🚨\x20*API\x20Error*\x0a\x0a','failed','botUsername','.jpeg',':\x20username=\x22','.pdf','🆔\x20Request\x20ID:\x20`','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','📧\x20Email:\x20`','chat','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','user\x20is\x20deactivated','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','substring','❌\x20Error:\x20`','Commands:\x0a','updatedAt','📊\x20*Connection\x20Status*\x0a\x0a','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','__esModule','update','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','sendShopFile','trapay_bot','pk_','method','trim','image/png','sendMessage','test','../types/gateway','🔗\x20TXID:\x20`','.jpg','toString','default','\x22,\x20apiKey=\x22','TELEGRAM_BOT_TOKEN','customerIp','User\x20','onText','`.\x0a\x0a','warn','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','currency','Use\x20/start\x20to\x20connect.','ACTIVE','log','12753UfEBYP','botToken','gateway','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.','message','`\x0a\x0a','\x20USD*\x0a','orderId','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','🌐\x20IP\x20address:\x20`','en-US','Telegram\x20bot\x20polling\x20error:','polling_error','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','\x20disconnected\x20from\x20shop\x20','🔔\x20*','💰\x20Amount:\x20*','❌\x20Shop\x20with\x20username\x20`','telegramUser','Failed\x20to\x20send\x20API\x20error\x20notification:','chargebackAmount','2735175USfict','✅\x20Welcome\x20back!\x0a\x0a','customerUa','chargeback','22919730MPjPbH','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','Contact\x20administrator.','stopBot','join','8yaVpqb','119DObmvd','text','🔔\x20You\x20receive\x20notifications\x20about:\x0a','1244390TTIJJs','Error\x20handling\x20/disconnect\x20command:','publicKey','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','/status\x20-\x20check\x20connection\x20status\x0a','11WQnQsh','📅\x20Connection\x20date:\x20','🏪\x20Gateway:\x20`','📱\x20Telegram\x20notification:\x20gateway\x20\x22','sendPaymentNotification','application/octet-stream','getGatewayDisplayNameForTelegram','🎉\x20*Congratulations!*\x0a\x0a','✅\x20File\x20sent\x20to\x20chat\x20','timestamp','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','../config/database','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','initializeBot','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','node-telegram-bot-api','sendCustomNotification','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Error\x20in\x20handleSingleLineVerification:','findFirst','amount','❌\x20Shop\x20`','5768zDXvow','📝\x20Notes:\x20','length','Payout\x20completed','split','\x20USDT*\x0a','66498vJkfph','success','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Error\x20sending\x20shop\x20notification:','\x20via\x20single-line\x20input','ipAddress','...','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','🌐\x20IP:\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','shopId','Payment\x20is\x20being\x20processed','sendPayoutNotification','entries','unknown\x20shop','shopSettings','endpoint','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','error','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','•\x20Payouts\x0a\x0a','✅\x20Connected\x20to\x20shop:\x20*','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','•\x20New\x20payments\x0a','❌\x20Invalid\x20username\x20format:\x20`','Telegram\x20bot\x20error:','map','Payout\x20rejected','errorMessage','Example:\x0a','toLocaleString','processing','from','setupBotHandlers','findMany','🛑\x20Telegram\x20bot\x20stopped','802926eswlkh','*\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a','findUnique','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','✅\x20File\x20sent\x20to\x20','New\x20payout\x20created','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','✅\x20Telegram\x20user\x20','sendShopNotification','sendDocument','🔔\x20Notifications\x20are\x20active\x0a\x0a','•\x20Payouts\x0a','remitterIban','txid','Payment\x20successfully\x20paid','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','💸\x20Penalty\x20amount:\x20*','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','sk_','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','secretKey','🏦\x20Method:\x20`','Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a','Use\x20/start\x20to\x20begin.','📱\x20Notification\x20sent\x20to\x20','startsWith','\x0a👤\x20*Customer\x20Information:*\x0a',':\x20`','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','includes','endsWith','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','notificationApiError','Payment\x20expired','telegramId','📊\x20Error\x20code:\x20`','Markdown','\x20users','handleSingleLineVerification','💸\x20Amount:\x20*','username','Error\x20handling\x20/status\x20command:','customerEmail','🔗\x20Endpoint:\x20`','sendApiErrorNotification','\x20initialized\x20successfully','name','•\x20Payment\x20status\x20changes\x0a','New\x20payment\x20created','application/pdf','env','✅\x20Direct\x20message\x20sent\x20to\x20chat\x20','adminNotes','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','🔌\x20User\x20','❌\x20Error\x20sending\x20direct\x20message:'];a66_0x11e9=function(){return _0x28a57d;};return a66_0x11e9();}const node_telegram_bot_api_1=__importDefault(require(a66_0x58bc0c(0x1b7))),database_1=__importDefault(require(a66_0x58bc0c(0x1b3))),gateway_1=require(a66_0x58bc0c(0x269));class TelegramBotService{constructor(){const _0x34a157=a66_0x58bc0c;this[_0x34a157(0x232)]=null,this[_0x34a157(0x27b)]=process['env'][_0x34a157(0x26f)]||'',this[_0x34a157(0x24d)]=process[_0x34a157(0x21c)][_0x34a157(0x235)]||_0x34a157(0x262),this[_0x34a157(0x27b)]?this[_0x34a157(0x1b5)]():console[_0x34a157(0x274)](_0x34a157(0x187));}[a66_0x58bc0c(0x1b5)](){const _0x5ba9e9=a66_0x58bc0c;try{this[_0x5ba9e9(0x232)]=new node_telegram_bot_api_1[(_0x5ba9e9(0x26d))](this['botToken'],{'polling':!![]}),this[_0x5ba9e9(0x1e5)](),console[_0x5ba9e9(0x279)](_0x5ba9e9(0x247)+this[_0x5ba9e9(0x24d)]+_0x5ba9e9(0x217));}catch(_0x5045fd){console[_0x5ba9e9(0x1d6)](_0x5ba9e9(0x1b1),_0x5045fd);}}['setupBotHandlers'](){const _0x38dcee=a66_0x58bc0c;if(!this[_0x38dcee(0x232)])return;this[_0x38dcee(0x232)][_0x38dcee(0x272)](/\/start/,async _0x1c5e81=>{const _0x26f4d8=_0x38dcee,_0x7782b4=_0x1c5e81['chat']['id'],_0x29cfc4=_0x1c5e81['from']?.['id'][_0x26f4d8(0x26c)](),_0x5ab6b9=_0x1c5e81[_0x26f4d8(0x1e4)]?.[_0x26f4d8(0x212)],_0x13ace8=_0x1c5e81[_0x26f4d8(0x1e4)]?.['first_name'],_0xb9878=_0x1c5e81[_0x26f4d8(0x1e4)]?.['last_name'];if(!_0x29cfc4)return;try{let _0x3f0dd8=await database_1[_0x26f4d8(0x26d)][_0x26f4d8(0x191)][_0x26f4d8(0x1eb)]({'where':{'telegramId':_0x29cfc4},'include':{'shop':!![]}});!_0x3f0dd8?(_0x3f0dd8=await database_1[_0x26f4d8(0x26d)][_0x26f4d8(0x191)]['create']({'data':{'telegramId':_0x29cfc4,'username':_0x5ab6b9,'firstName':_0x13ace8,'lastName':_0xb9878,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x26f4d8(0x279)]('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x29cfc4+'\x20(@'+_0x5ab6b9+')')):_0x3f0dd8=await database_1[_0x26f4d8(0x26d)]['telegramUser'][_0x26f4d8(0x25f)]({'where':{'telegramId':_0x29cfc4},'data':{'username':_0x5ab6b9,'firstName':_0x13ace8,'lastName':_0xb9878},'include':{'shop':!![]}}),_0x3f0dd8[_0x26f4d8(0x238)]&&_0x3f0dd8['shopId']&&_0x3f0dd8[_0x26f4d8(0x241)]?await this[_0x26f4d8(0x232)]?.['sendMessage'](_0x7782b4,_0x26f4d8(0x195)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x3f0dd8[_0x26f4d8(0x241)][_0x26f4d8(0x218)]+'*\x0a')+('Username:\x20`'+_0x3f0dd8[_0x26f4d8(0x241)][_0x26f4d8(0x212)]+_0x26f4d8(0x184))+_0x26f4d8(0x1a0)+'•\x20New\x20payments\x0a'+_0x26f4d8(0x219)+_0x26f4d8(0x1d8)+_0x26f4d8(0x25a)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x26f4d8(0x1cd),{'parse_mode':_0x26f4d8(0x20e)}):(_0x3f0dd8['shopId']&&!_0x3f0dd8['isVerified']&&(await database_1['default'][_0x26f4d8(0x191)][_0x26f4d8(0x25f)]({'where':{'telegramId':_0x29cfc4},'data':{'shopId':null,'isVerified':![]}}),console[_0x26f4d8(0x279)](_0x26f4d8(0x21f)+_0x29cfc4)),await this[_0x26f4d8(0x232)]?.[_0x26f4d8(0x267)](_0x7782b4,_0x26f4d8(0x1d7)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x26f4d8(0x1e1)+_0x26f4d8(0x244)+_0x26f4d8(0x25d),{'parse_mode':_0x26f4d8(0x20e)}));}catch(_0x87c4b4){console['error'](_0x26f4d8(0x237),_0x87c4b4),await this[_0x26f4d8(0x232)]?.['sendMessage'](_0x7782b4,_0x26f4d8(0x18c));}}),this[_0x38dcee(0x232)][_0x38dcee(0x272)](/\/disconnect/,async _0x27cd26=>{const _0x2fe761=_0x38dcee,_0x2ef54c=_0x27cd26['chat']['id'],_0x669bd8=_0x27cd26[_0x2fe761(0x1e4)]?.['id'][_0x2fe761(0x26c)]();if(!_0x669bd8)return;try{const _0xdaaf1b=await database_1['default'][_0x2fe761(0x191)][_0x2fe761(0x1eb)]({'where':{'telegramId':_0x669bd8},'include':{'shop':!![]}});if(!_0xdaaf1b||!_0xdaaf1b[_0x2fe761(0x238)]||!_0xdaaf1b[_0x2fe761(0x1ce)]){await this['bot']?.[_0x2fe761(0x267)](_0x2ef54c,_0x2fe761(0x255));return;}const _0x334d4a=_0xdaaf1b[_0x2fe761(0x241)]?.[_0x2fe761(0x218)]||_0x2fe761(0x1d2);await database_1[_0x2fe761(0x26d)][_0x2fe761(0x191)]['update']({'where':{'telegramId':_0x669bd8},'data':{'shopId':null,'isVerified':![]}}),console[_0x2fe761(0x279)](_0x2fe761(0x220)+_0x669bd8+_0x2fe761(0x18d)+_0xdaaf1b[_0x2fe761(0x1ce)]),await this['bot']?.[_0x2fe761(0x267)](_0x2ef54c,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x334d4a+_0x2fe761(0x22a)+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x2fe761(0x20e)});}catch(_0x4c8af9){console[_0x2fe761(0x1d6)](_0x2fe761(0x1a2),_0x4c8af9),await this['bot']?.['sendMessage'](_0x2ef54c,_0x2fe761(0x18c));}}),this[_0x38dcee(0x232)]['onText'](/\/status/,async _0x1776e7=>{const _0x5696c6=_0x38dcee,_0x3e52e1=_0x1776e7[_0x5696c6(0x254)]['id'],_0x5d5b60=_0x1776e7['from']?.['id']['toString']();if(!_0x5d5b60)return;try{const _0x5e6857=await database_1[_0x5696c6(0x26d)]['telegramUser']['findUnique']({'where':{'telegramId':_0x5d5b60},'include':{'shop':!![]}});if(!_0x5e6857){await this['bot']?.[_0x5696c6(0x267)](_0x3e52e1,_0x5696c6(0x1da)+_0x5696c6(0x200));return;}if(!_0x5e6857[_0x5696c6(0x238)]||!_0x5e6857[_0x5696c6(0x1ce)]||!_0x5e6857['shop']){await this[_0x5696c6(0x232)]?.[_0x5696c6(0x267)](_0x3e52e1,_0x5696c6(0x1f8)+_0x5696c6(0x277));return;}await this[_0x5696c6(0x232)]?.[_0x5696c6(0x267)](_0x3e52e1,_0x5696c6(0x25c)+(_0x5696c6(0x1d9)+_0x5e6857['shop'][_0x5696c6(0x218)]+'*\x0a')+(_0x5696c6(0x22d)+_0x5e6857['shop'][_0x5696c6(0x212)]+'`\x0a')+(_0x5696c6(0x1a8)+_0x5e6857[_0x5696c6(0x25b)]['toLocaleDateString']('en-US')+'\x0a\x0a')+_0x5696c6(0x1f3)+_0x5696c6(0x25a)+_0x5696c6(0x1cd),{'parse_mode':_0x5696c6(0x20e)});}catch(_0x4f61eb){console[_0x5696c6(0x1d6)](_0x5696c6(0x213),_0x4f61eb),await this[_0x5696c6(0x232)]?.[_0x5696c6(0x267)](_0x3e52e1,_0x5696c6(0x18c));}}),this[_0x38dcee(0x232)][_0x38dcee(0x272)](/\/debug/,async _0x1213c8=>{const _0xf3422d=_0x38dcee,_0x38ae79=_0x1213c8[_0xf3422d(0x254)]['id'],_0x50afd2=_0x1213c8[_0xf3422d(0x1e4)]?.['id'][_0xf3422d(0x26c)]();if(!_0x50afd2)return;try{const _0x56ebd9=await database_1['default'][_0xf3422d(0x191)][_0xf3422d(0x1eb)]({'where':{'telegramId':_0x50afd2},'include':{'shop':!![]}});let _0xe6e3d7='🔍\x20*Debug\x20Information*\x0a\x0a';_0xe6e3d7+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x50afd2+_0xf3422d(0x184),_0x56ebd9?.['isVerified']&&_0x56ebd9[_0xf3422d(0x241)]?(_0xe6e3d7+=_0xf3422d(0x239),_0xe6e3d7+='\x20\x20\x20Name:\x20*'+_0x56ebd9[_0xf3422d(0x241)]['name']+'*\x0a',_0xe6e3d7+='\x20\x20\x20Username:\x20`'+_0x56ebd9[_0xf3422d(0x241)]['username']+'`\x0a',_0xe6e3d7+=_0xf3422d(0x23a)+_0x56ebd9['shop'][_0xf3422d(0x222)]+'\x0a\x0a'):_0xe6e3d7+=_0xf3422d(0x1ea),_0xe6e3d7+=_0xf3422d(0x22c),await this[_0xf3422d(0x232)]?.[_0xf3422d(0x267)](_0x38ae79,_0xe6e3d7,{'parse_mode':_0xf3422d(0x20e)});}catch(_0x44946e){console[_0xf3422d(0x1d6)]('Error\x20handling\x20/debug\x20command:',_0x44946e),await this['bot']?.[_0xf3422d(0x267)](_0x38ae79,_0xf3422d(0x231));}}),this[_0x38dcee(0x232)]['on'](_0x38dcee(0x183),async _0x13579e=>{const _0x230c9e=_0x38dcee;if(_0x13579e['text']?.['startsWith']('/'))return;const _0x4425c2=_0x13579e[_0x230c9e(0x254)]['id'],_0x312c34=_0x13579e[_0x230c9e(0x1e4)]?.['id']['toString'](),_0x4da12f=_0x13579e[_0x230c9e(0x19f)]?.[_0x230c9e(0x265)]();if(!_0x312c34||!_0x4da12f)return;try{const _0x17e0a3=await database_1['default']['telegramUser'][_0x230c9e(0x1eb)]({'where':{'telegramId':_0x312c34},'include':{'shop':!![]}});if(!_0x17e0a3){await this[_0x230c9e(0x232)]?.['sendMessage'](_0x4425c2,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x17e0a3[_0x230c9e(0x238)]&&_0x17e0a3[_0x230c9e(0x1ce)]&&_0x17e0a3[_0x230c9e(0x241)]){await this['bot']?.[_0x230c9e(0x267)](_0x4425c2,_0x230c9e(0x249)+_0x17e0a3['shop'][_0x230c9e(0x218)]+_0x230c9e(0x22a)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x230c9e(0x20e)});return;}const _0x303790=_0x4da12f[_0x230c9e(0x1c2)](/\s+/);if(_0x303790['length']!==0x2){await this['bot']?.[_0x230c9e(0x267)](_0x4425c2,_0x230c9e(0x1b6)+_0x230c9e(0x1a4)+_0x230c9e(0x1e1)+_0x230c9e(0x244)+('You\x20sent\x20'+_0x303790[_0x230c9e(0x1c0)]+'\x20parts:\x20'+_0x303790['map'](_0x117fdd=>'`'+_0x117fdd+'`')[_0x230c9e(0x19c)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x1aa6cd,_0x16320b]=_0x303790;console[_0x230c9e(0x279)](_0x230c9e(0x1fa)+_0x312c34+_0x230c9e(0x24f)+_0x1aa6cd+_0x230c9e(0x26e)+_0x16320b['substring'](0x0,0xa)+_0x230c9e(0x227)),await this['handleSingleLineVerification'](_0x4425c2,_0x312c34,_0x1aa6cd,_0x16320b);}catch(_0x21a204){console[_0x230c9e(0x1d6)]('Error\x20handling\x20message:',_0x21a204),await this[_0x230c9e(0x232)]?.[_0x230c9e(0x267)](_0x4425c2,_0x230c9e(0x18c));}}),this['bot']['on'](_0x38dcee(0x1d6),_0x58dcbd=>{const _0x5ecb2c=_0x38dcee;console['error'](_0x5ecb2c(0x1dd),_0x58dcbd);}),this['bot']['on'](_0x38dcee(0x18b),_0x1b351f=>{const _0x47289c=_0x38dcee;console[_0x47289c(0x1d6)](_0x47289c(0x18a),_0x1b351f);});}async[a66_0x58bc0c(0x210)](_0x5bb48a,_0x214b1c,_0x40b966,_0x353631){const _0x1e6187=a66_0x58bc0c;try{console[_0x1e6187(0x279)](_0x1e6187(0x1fa)+_0x214b1c+_0x1e6187(0x24f)+_0x40b966+'\x22,\x20apiKey=\x22'+_0x353631[_0x1e6187(0x258)](0x0,0xa)+_0x1e6187(0x227));if(!_0x40b966||_0x40b966[_0x1e6187(0x1c0)]<0x3||_0x40b966[_0x1e6187(0x1c0)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x1e6187(0x268)](_0x40b966)){await this['bot']?.[_0x1e6187(0x267)](_0x5bb48a,_0x1e6187(0x1dc)+_0x40b966+_0x1e6187(0x184)+_0x1e6187(0x260),{'parse_mode':_0x1e6187(0x20e)});return;}if(!_0x353631||!_0x353631[_0x1e6187(0x202)](_0x1e6187(0x263))&&!_0x353631[_0x1e6187(0x202)](_0x1e6187(0x1fb))){await this['bot']?.['sendMessage'](_0x5bb48a,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x1e6187(0x206),{'parse_mode':_0x1e6187(0x20e)});return;}const _0x4219eb=await database_1[_0x1e6187(0x26d)][_0x1e6187(0x241)][_0x1e6187(0x1eb)]({'where':{'username':_0x40b966},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x4219eb){const _0x20ac41=_0x1e6187(0x190)+_0x40b966+'`\x20not\x20found.\x0a\x0a'+_0x1e6187(0x1ff)+_0x1e6187(0x182);await this[_0x1e6187(0x232)]?.[_0x1e6187(0x267)](_0x5bb48a,_0x20ac41,{'parse_mode':_0x1e6187(0x20e)});return;}if(_0x4219eb['status']!==_0x1e6187(0x278)){await this['bot']?.[_0x1e6187(0x267)](_0x5bb48a,_0x1e6187(0x1bd)+_0x40b966+'`\x20is\x20inactive.\x0a\x0a'+_0x1e6187(0x19a),{'parse_mode':_0x1e6187(0x20e)});return;}if(_0x4219eb[_0x1e6187(0x1a3)]!==_0x353631&&_0x4219eb[_0x1e6187(0x1fd)]!==_0x353631){await this['bot']?.[_0x1e6187(0x267)](_0x5bb48a,_0x1e6187(0x275)+_0x40b966+_0x1e6187(0x273)+_0x1e6187(0x1a5)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x1e6187(0x20e)});return;}const _0x230744=await database_1[_0x1e6187(0x26d)]['telegramUser'][_0x1e6187(0x1bb)]({'where':{'shopId':_0x4219eb['id'],'isVerified':!![],'telegramId':{'not':_0x214b1c}}});if(_0x230744){await this['bot']?.[_0x1e6187(0x267)](_0x5bb48a,_0x1e6187(0x181)+_0x40b966+'`.\x0a\x0a'+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x1e6187(0x20e)});return;}await database_1[_0x1e6187(0x26d)]['telegramUser'][_0x1e6187(0x25f)]({'where':{'telegramId':_0x214b1c},'data':{'shopId':_0x4219eb['id'],'isVerified':!![]}}),await this[_0x1e6187(0x232)]?.[_0x1e6187(0x267)](_0x5bb48a,_0x1e6187(0x1ae)+_0x1e6187(0x1d5)+('📱\x20Shop:\x20*'+_0x4219eb['name']+'*\x0a')+(_0x1e6187(0x22d)+_0x4219eb['username']+_0x1e6187(0x184))+_0x1e6187(0x1ec)+_0x1e6187(0x1db)+'•\x20Payment\x20status\x20changes\x0a'+_0x1e6187(0x1f4)+_0x1e6187(0x229)+_0x1e6187(0x25a)+_0x1e6187(0x1a6)+_0x1e6187(0x1cd),{'parse_mode':_0x1e6187(0x20e)}),console[_0x1e6187(0x279)](_0x1e6187(0x1f0)+_0x214b1c+'\x20verified\x20for\x20shop\x20'+_0x4219eb[_0x1e6187(0x212)]+_0x1e6187(0x1c8));}catch(_0x5252f0){console['error'](_0x1e6187(0x1ba),_0x5252f0),await this[_0x1e6187(0x232)]?.['sendMessage'](_0x5bb48a,_0x1e6187(0x1b9));}}async[a66_0x58bc0c(0x1f1)](_0x3f93f4,_0x415ce7,_0x2c75cd){const _0x4ec906=a66_0x58bc0c;if(!this[_0x4ec906(0x232)]){console[_0x4ec906(0x274)](_0x4ec906(0x1b4));return;}try{const _0x39eaa1=await database_1['default'][_0x4ec906(0x191)][_0x4ec906(0x1e6)]({'where':{'shopId':_0x3f93f4,'isVerified':!![]}});if(_0x39eaa1[_0x4ec906(0x1c0)]===0x0){console[_0x4ec906(0x279)](_0x4ec906(0x257)+_0x3f93f4);return;}const _0x2a4915=_0x39eaa1[_0x4ec906(0x1de)](async _0x1bdc58=>{const _0x3bcb6c=_0x4ec906;try{await this[_0x3bcb6c(0x232)]?.[_0x3bcb6c(0x267)](_0x1bdc58[_0x3bcb6c(0x20c)],_0x415ce7,_0x2c75cd),console[_0x3bcb6c(0x279)](_0x3bcb6c(0x252)+_0x1bdc58['telegramId']);}catch(_0x52c1f7){console[_0x3bcb6c(0x1d6)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x1bdc58[_0x3bcb6c(0x20c)]+':',_0x52c1f7),_0x52c1f7 instanceof Error&&(_0x52c1f7['message']['includes']('blocked')||_0x52c1f7[_0x3bcb6c(0x183)][_0x3bcb6c(0x207)]('chat\x20not\x20found')||_0x52c1f7[_0x3bcb6c(0x183)]['includes'](_0x3bcb6c(0x256)))&&(await database_1[_0x3bcb6c(0x26d)][_0x3bcb6c(0x191)][_0x3bcb6c(0x25f)]({'where':{'id':_0x1bdc58['id']},'data':{'isVerified':![]}}),console[_0x3bcb6c(0x279)](_0x3bcb6c(0x271)+_0x1bdc58[_0x3bcb6c(0x20c)]+_0x3bcb6c(0x1fc)));}});await Promise['allSettled'](_0x2a4915);}catch(_0x5636e4){console['error'](_0x4ec906(0x1c7),_0x5636e4);}}async[a66_0x58bc0c(0x1ab)](_0x35dffc,_0x5173b2,_0xfe8e00){const _0x533699=a66_0x58bc0c,_0x4943f6={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x461605={'created':_0x533699(0x21a),'paid':_0x533699(0x1f7),'failed':'Payment\x20failed','expired':_0x533699(0x20b),'refund':'Payment\x20refund','chargeback':_0x533699(0x228),'processing':_0x533699(0x1cf)},_0x50f5b1=_0x4943f6[_0xfe8e00],_0x1eec76=_0x461605[_0xfe8e00],_0x34dc93=(0x0,gateway_1[_0x533699(0x1ad)])(_0x5173b2[_0x533699(0x27c)]);console[_0x533699(0x279)](_0x533699(0x1aa)+_0x5173b2[_0x533699(0x27c)]+_0x533699(0x233)+_0x34dc93+'\x22');let _0x271417=_0x50f5b1+'\x20*'+_0x1eec76+_0x533699(0x1e9)+(_0x533699(0x18f)+_0x5173b2[_0x533699(0x1bc)]+'\x20'+_0x5173b2[_0x533699(0x276)]+'*\x0a')+(_0x533699(0x22b)+(_0x5173b2[_0x533699(0x186)]||_0x5173b2['id'])+'`\x0a')+('🆔\x20Payment\x20ID:\x20`'+_0x5173b2['id']+'`\x0a')+(_0x533699(0x1a9)+_0x34dc93+'`\x0a')+(_0x533699(0x234)+new Date(_0x5173b2['createdAt'])[_0x533699(0x1e2)](_0x533699(0x189))+'\x0a');if(_0x5173b2['customerName']||_0x5173b2[_0x533699(0x214)]||_0x5173b2[_0x533699(0x1f5)]||_0x5173b2['customerIp']||_0x5173b2[_0x533699(0x196)]){_0x271417+=_0x533699(0x203);_0x5173b2['customerName']&&(_0x271417+=_0x533699(0x22f)+_0x5173b2[_0x533699(0x223)]+'`\x0a');_0x5173b2[_0x533699(0x214)]&&(_0x271417+=_0x533699(0x253)+_0x5173b2[_0x533699(0x214)]+'`\x0a');_0x5173b2[_0x533699(0x1f5)]&&(_0x271417+=_0x533699(0x23e)+_0x5173b2[_0x533699(0x1f5)]+'`\x0a');_0x5173b2[_0x533699(0x270)]&&(_0x271417+=_0x533699(0x1cc)+_0x5173b2[_0x533699(0x270)]+'`\x0a');if(_0x5173b2['customerUa']){const _0x54e404=_0x5173b2[_0x533699(0x196)][_0x533699(0x1c0)]>0x32?_0x5173b2[_0x533699(0x196)]['substring'](0x0,0x32)+_0x533699(0x1ca):_0x5173b2[_0x533699(0x196)];_0x271417+=_0x533699(0x22e)+_0x54e404+'`\x0a';}}_0xfe8e00===_0x533699(0x197)&&_0x5173b2['chargebackAmount']&&(_0x271417+=_0x533699(0x1f9)+_0x5173b2[_0x533699(0x193)]+_0x533699(0x1c3)),_0xfe8e00===_0x533699(0x1e3)&&(_0x271417+=_0x533699(0x23f)),_0x5173b2[_0x533699(0x21e)]&&(_0x271417+=_0x533699(0x1bf)+_0x5173b2[_0x533699(0x21e)]+'\x0a'),await this['sendShopNotification'](_0x35dffc,_0x271417,{'parse_mode':_0x533699(0x20e)});}async[a66_0x58bc0c(0x1d0)](_0x48c7f5,_0x508493,_0x25c179){const _0x37cc72=a66_0x58bc0c,_0x2d398c={'created':'📤','completed':'✅','rejected':'❌'},_0x1df779={'created':_0x37cc72(0x1ee),'completed':_0x37cc72(0x1c1),'rejected':_0x37cc72(0x1df)},_0x14f01c=_0x2d398c[_0x25c179],_0x1ed4b2=_0x1df779[_0x25c179],_0x1a5b2a=_0x14f01c+'\x20*'+_0x1ed4b2+_0x37cc72(0x1e9)+(_0x37cc72(0x211)+_0x508493[_0x37cc72(0x1bc)]+_0x37cc72(0x185))+(_0x37cc72(0x1fe)+_0x508493[_0x37cc72(0x264)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x508493['id']+'`\x0a')+(_0x37cc72(0x234)+new Date(_0x508493['createdAt'])['toLocaleString'](_0x37cc72(0x189))+'\x0a')+(_0x508493[_0x37cc72(0x1f6)]?_0x37cc72(0x26a)+_0x508493[_0x37cc72(0x1f6)]+'`':'');await this[_0x37cc72(0x1f1)](_0x48c7f5,_0x1a5b2a,{'parse_mode':_0x37cc72(0x20e)});}async[a66_0x58bc0c(0x224)](_0x58e674,_0x302843){const _0x4efb97=a66_0x58bc0c;try{const _0x33b84e=await database_1['default'][_0x4efb97(0x1d3)]['findUnique']({'where':{'shopId':_0x58e674},'select':{'notificationLogin':!![]}});if(!_0x33b84e?.['notificationLogin']){console[_0x4efb97(0x279)](_0x4efb97(0x1cb)+_0x58e674);return;}const _0x17b148=_0x302843[_0x4efb97(0x1c5)]?'🔐':'🚨',_0x4ae641=_0x302843['success']?_0x4efb97(0x240):_0x4efb97(0x23c);let _0x486e1e=_0x17b148+'\x20*'+_0x4ae641+_0x4efb97(0x1e9)+(_0x4efb97(0x22d)+_0x302843['username']+'`\x0a')+('📅\x20Time:\x20'+_0x302843[_0x4efb97(0x1b0)][_0x4efb97(0x1e2)](_0x4efb97(0x189))+'\x0a');_0x302843[_0x4efb97(0x1c9)]&&(_0x486e1e+=_0x4efb97(0x188)+_0x302843[_0x4efb97(0x1c9)]+'`\x0a');if(_0x302843[_0x4efb97(0x243)]){const _0xbaf2c7=_0x302843[_0x4efb97(0x243)][_0x4efb97(0x1c0)]>0x32?_0x302843[_0x4efb97(0x243)][_0x4efb97(0x258)](0x0,0x32)+_0x4efb97(0x1ca):_0x302843[_0x4efb97(0x243)];_0x486e1e+='💻\x20Browser:\x20`'+_0xbaf2c7+'`\x0a';}!_0x302843[_0x4efb97(0x1c5)]&&(_0x486e1e+=_0x4efb97(0x199)),await this[_0x4efb97(0x1f1)](_0x58e674,_0x486e1e,{'parse_mode':_0x4efb97(0x20e)}),console[_0x4efb97(0x279)](_0x4efb97(0x225)+_0x58e674+':\x20'+(_0x302843[_0x4efb97(0x1c5)]?_0x4efb97(0x1c5):_0x4efb97(0x24c)));}catch(_0x17a689){console[_0x4efb97(0x1d6)]('Failed\x20to\x20send\x20login\x20notification:',_0x17a689);}}async[a66_0x58bc0c(0x216)](_0x1a1a91,_0x5b93d9){const _0x5722b9=a66_0x58bc0c;try{const _0x41e257=await database_1[_0x5722b9(0x26d)][_0x5722b9(0x1d3)][_0x5722b9(0x1eb)]({'where':{'shopId':_0x1a1a91},'select':{'notificationApiError':!![]}});if(!_0x41e257?.[_0x5722b9(0x20a)]){console['log'](_0x5722b9(0x1c6)+_0x1a1a91);return;}let _0xb2315c=_0x5722b9(0x24b)+(_0x5722b9(0x215)+_0x5b93d9[_0x5722b9(0x264)]+'\x20'+_0x5b93d9[_0x5722b9(0x1d4)]+'`\x0a')+('📅\x20Time:\x20'+_0x5b93d9[_0x5722b9(0x1b0)][_0x5722b9(0x1e2)]('en-US')+'\x0a');_0x5b93d9[_0x5722b9(0x226)]&&(_0xb2315c+=_0x5722b9(0x20d)+_0x5b93d9['statusCode']+'`\x0a'),_0xb2315c+=_0x5722b9(0x259)+_0x5b93d9[_0x5722b9(0x1e0)]+'`\x0a',_0x5b93d9[_0x5722b9(0x23d)]&&(_0xb2315c+=_0x5722b9(0x251)+_0x5b93d9['requestId']+'`\x0a'),_0xb2315c+=_0x5722b9(0x205),await this[_0x5722b9(0x1f1)](_0x1a1a91,_0xb2315c,{'parse_mode':_0x5722b9(0x20e)}),console[_0x5722b9(0x279)](_0x5722b9(0x1ef)+_0x1a1a91+':\x20'+_0x5b93d9[_0x5722b9(0x1d4)]);}catch(_0x236460){console[_0x5722b9(0x1d6)](_0x5722b9(0x192),_0x236460);}}async[a66_0x58bc0c(0x1b8)](_0x26d67b,_0x49d6fb,_0x3d1370){const _0x206f13=a66_0x58bc0c;let _0x342acc=_0x206f13(0x18e)+_0x49d6fb+_0x206f13(0x1e9);for(const [_0x3a5cfa,_0x2fa265]of Object[_0x206f13(0x1d1)](_0x3d1370)){_0x2fa265!==null&&_0x2fa265!==undefined&&(_0x342acc+=_0x3a5cfa+_0x206f13(0x204)+_0x2fa265+'`\x0a');}await this[_0x206f13(0x1f1)](_0x26d67b,_0x342acc,{'parse_mode':_0x206f13(0x20e)});}async['sendNotificationToAll'](_0x30f94d){const _0x46cc44=a66_0x58bc0c;try{console[_0x46cc44(0x279)]('📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20'+_0x30f94d['substring'](0x0,0x32)+_0x46cc44(0x1ca));const _0x2bd11b=await database_1[_0x46cc44(0x26d)]['telegramUser'][_0x46cc44(0x1e6)]({'select':{'telegramId':!![]}});if(_0x2bd11b['length']===0x0){console['log']('📱\x20No\x20active\x20Telegram\x20users\x20found');return;}for(const _0x439aa1 of _0x2bd11b){try{await this['bot']?.[_0x46cc44(0x267)](_0x439aa1[_0x46cc44(0x20c)],_0x30f94d,{'parse_mode':_0x46cc44(0x20e)});}catch(_0x1a2112){console[_0x46cc44(0x1d6)](_0x46cc44(0x1b2)+_0x439aa1[_0x46cc44(0x20c)]+':',_0x1a2112);}}console['log'](_0x46cc44(0x201)+_0x2bd11b[_0x46cc44(0x1c0)]+_0x46cc44(0x20f));}catch(_0x467d5b){console[_0x46cc44(0x1d6)](_0x46cc44(0x230),_0x467d5b);}}['getBotInfo'](){const _0x4123b8=a66_0x58bc0c;return{'isActive':!!this[_0x4123b8(0x232)],'username':this[_0x4123b8(0x24d)]};}async[a66_0x58bc0c(0x261)](_0x20ba3f,_0x20b203,_0x5f574a,_0x316f35){const _0x33d3c2=a66_0x58bc0c;try{if(!this['bot'])return console[_0x33d3c2(0x1d6)](_0x33d3c2(0x246)),![];const _0x5d82a4=await database_1[_0x33d3c2(0x26d)]['telegramUser'][_0x33d3c2(0x1e6)]({'where':{'shopId':_0x20ba3f,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x5d82a4[_0x33d3c2(0x1c0)]===0x0)return console[_0x33d3c2(0x1d6)](_0x33d3c2(0x209)+_0x20ba3f),![];let _0x1f799b=0x0;for(const _0x523949 of _0x5d82a4){try{await this[_0x33d3c2(0x232)]['sendDocument'](_0x523949[_0x33d3c2(0x20c)],_0x20b203,{},{'filename':_0x5f574a,'contentType':_0x5f574a[_0x33d3c2(0x208)](_0x33d3c2(0x23b))?_0x33d3c2(0x266):_0x5f574a[_0x33d3c2(0x208)](_0x33d3c2(0x26b))||_0x5f574a['endsWith'](_0x33d3c2(0x24e))?'image/jpeg':_0x5f574a[_0x33d3c2(0x208)]('.pdf')?_0x33d3c2(0x21b):_0x33d3c2(0x1ac)}),_0x316f35&&await this['bot'][_0x33d3c2(0x267)](_0x523949[_0x33d3c2(0x20c)],_0x316f35),_0x1f799b++;}catch(_0x5bc30c){console[_0x33d3c2(0x1d6)]('❌\x20Error\x20sending\x20file\x20to\x20user\x20'+_0x523949['telegramId']+':',_0x5bc30c);}}return console['log'](_0x33d3c2(0x1ed)+_0x1f799b+'/'+_0x5d82a4[_0x33d3c2(0x1c0)]+_0x33d3c2(0x245)+_0x20ba3f+':\x20'+_0x5f574a),_0x1f799b>0x0;}catch(_0x51d5a6){return console['error']('❌\x20Error\x20sending\x20file\x20to\x20shop:',_0x51d5a6),![];}}async['sendDirectMessage'](_0x4ab006,_0x3d2af6){const _0x33a9f6=a66_0x58bc0c;try{if(!this['bot'])return console[_0x33a9f6(0x1d6)]('❌\x20Telegram\x20bot\x20not\x20initialized'),![];return await this['bot'][_0x33a9f6(0x267)](_0x4ab006,_0x3d2af6),console[_0x33a9f6(0x279)](_0x33a9f6(0x21d)+_0x4ab006),!![];}catch(_0x188ebf){return console[_0x33a9f6(0x1d6)](_0x33a9f6(0x221),_0x188ebf),![];}}async['sendDirectFile'](_0xed512e,_0xda7f3a,_0x4292fc,_0x8f18e4){const _0x1ca973=a66_0x58bc0c;try{if(!this[_0x1ca973(0x232)])return console['error'](_0x1ca973(0x246)),![];return await this[_0x1ca973(0x232)][_0x1ca973(0x1f2)](_0xed512e,_0xda7f3a,{},{'filename':_0x4292fc,'contentType':_0x4292fc['endsWith'](_0x1ca973(0x23b))?_0x1ca973(0x266):_0x4292fc[_0x1ca973(0x208)](_0x1ca973(0x26b))||_0x4292fc['endsWith'](_0x1ca973(0x24e))?_0x1ca973(0x24a):_0x4292fc[_0x1ca973(0x208)](_0x1ca973(0x250))?_0x1ca973(0x21b):_0x1ca973(0x1ac)}),_0x8f18e4&&await this[_0x1ca973(0x232)][_0x1ca973(0x267)](_0xed512e,_0x8f18e4),console[_0x1ca973(0x279)](_0x1ca973(0x1af)+_0xed512e+':\x20'+_0x4292fc),!![];}catch(_0x5470e4){return console['error']('❌\x20Error\x20sending\x20file\x20to\x20chat:',_0x5470e4),![];}}[a66_0x58bc0c(0x19b)](){const _0x4d3c10=a66_0x58bc0c;this[_0x4d3c10(0x232)]&&(this[_0x4d3c10(0x232)]['stopPolling'](),this[_0x4d3c10(0x232)]=null,console[_0x4d3c10(0x279)](_0x4d3c10(0x1e7)));}}exports[a66_0x58bc0c(0x248)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();