'use strict';const a54_0x52d0de=a54_0x5d23;(function(_0x351005,_0x53f1c5){const _0x2393ad=a54_0x5d23,_0x70f3e6=_0x351005();while(!![]){try{const _0x4db079=-parseInt(_0x2393ad(0x102))/0x1*(-parseInt(_0x2393ad(0xc4))/0x2)+-parseInt(_0x2393ad(0xb6))/0x3*(parseInt(_0x2393ad(0x13d))/0x4)+-parseInt(_0x2393ad(0x139))/0x5*(parseInt(_0x2393ad(0xb5))/0x6)+-parseInt(_0x2393ad(0x183))/0x7*(-parseInt(_0x2393ad(0x12f))/0x8)+-parseInt(_0x2393ad(0x195))/0x9+-parseInt(_0x2393ad(0xdd))/0xa+-parseInt(_0x2393ad(0x15d))/0xb*(-parseInt(_0x2393ad(0xf4))/0xc);if(_0x4db079===_0x53f1c5)break;else _0x70f3e6['push'](_0x70f3e6['shift']());}catch(_0x2cbe8d){_0x70f3e6['push'](_0x70f3e6['shift']());}}}(a54_0x8379,0x27b51));function a54_0x5d23(_0x4e1ed3,_0x685309){const _0x83799e=a54_0x8379();return a54_0x5d23=function(_0x5d23dd,_0x5a4d81){_0x5d23dd=_0x5d23dd-0xa3;let _0x512a01=_0x83799e[_0x5d23dd];return _0x512a01;},a54_0x5d23(_0x4e1ed3,_0x685309);}var __importDefault=this&&this[a54_0x52d0de(0xc9)]||function(_0x500345){const _0x3499fe=a54_0x52d0de;return _0x500345&&_0x500345[_0x3499fe(0x108)]?_0x500345:{'default':_0x500345};};Object[a54_0x52d0de(0xaf)](exports,a54_0x52d0de(0x108),{'value':!![]}),exports[a54_0x52d0de(0xb0)]=exports[a54_0x52d0de(0xb7)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x52d0de(0x17b))),database_1=__importDefault(require('../config/database')),gateway_1=require(a54_0x52d0de(0x143));function a54_0x8379(){const _0x2e29be=['•\x20Payouts\x0a\x0a','❌\x20Please\x20use\x20/start\x20command\x20first','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','sendApiErrorNotification','getGatewayDisplayNameForTelegram','botToken','🏪\x20Gateway:\x20`','customerIp','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','17787bFnshN','unknown\x20shop','processing','txid','split','toLocaleString','📧\x20Email:\x20`','\x22\x20->\x20display\x20\x22','customerUa','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','publicKey','success','✅\x20Connected\x20to\x20shop:\x20*','📱\x20Created\x20new\x20Telegram\x20user:\x20','📅\x20Time:\x20','\x0aCheck\x20spelling\x20and\x20try\x20again.','Error\x20handling\x20/debug\x20command:','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a',':\x20`','botUsername','Payment\x20failed','`\x0a\x0a','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','notificationLogin','userAgent','updatedAt','chat','✅\x20Telegram\x20bot\x20@','•\x20Important\x20events\x0a\x0a','endpoint','node-telegram-bot-api','...','🛑\x20Telegram\x20bot\x20stopped','`\x20(','Failed\x20to\x20send\x20API\x20error\x20notification:','requestId','chat\x20not\x20found','`\x20not\x20found.\x0a\x0a','7YSKSsH','error','🔔\x20You\x20receive\x20notifications\x20about:\x0a','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','pk_','👤\x20Username:\x20`','🌐\x20IP\x20address:\x20`','join','📱\x20Telegram\x20notification:\x20gateway\x20\x22','includes','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','Commands:\x0a','\x20USD*\x0a','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','\x20parts:\x20','🔗\x20Endpoint:\x20`','setupBotHandlers','last_name','304875yuAHpM','\x22,\x20apiKey=\x22','customerEmail','📝\x20Notes:\x20','orderId','Payment\x20is\x20being\x20processed','\x20(@','TELEGRAM_BOT_USERNAME','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','Error\x20handling\x20/start\x20command:','isVerified','Error\x20sending\x20shop\x20notification:','\x20\x20\x20Username:\x20`','defineProperty','telegramBotService','env','You\x20sent\x20','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','initializeBot','66ytUgYt','3615LhJKBa','TelegramBotService','currency','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','🆔\x20Payment\x20ID:\x20`','timestamp','/disconnect\x20-\x20disconnect\x20from\x20notifications','from','💸\x20Amount:\x20*','sendLoginNotification','🔗\x20TXID:\x20`','Payment\x20refund','Use\x20/start\x20to\x20connect.','📱\x20Your\x20Telegram\x20ID:\x20`','2uSaHnw','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','text','💰\x20Amount:\x20*','`\x20is\x20inactive.\x0a\x0a','__importDefault','Check\x20spelling\x20and\x20try\x20again.','Payout\x20rejected','blocked','startsWith','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','chargebackAmount','📱\x20Shop:\x20*','Error\x20handling\x20/status\x20command:','toLocaleDateString','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','*\x0a\x0a','❌\x20Shop\x20`','Payout\x20completed','🔔\x20*','message','warn','findMany','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','New\x20payout\x20created','2619960vHjwnz','create','default','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','\x20via\x20single-line\x20input','New\x20payment\x20created','📝\x20Order\x20ID:\x20`','length','entries','Failed\x20login\x20attempt','trapay_bot','Error\x20handling\x20/disconnect\x20command:','polling_error','name','.\x20*',':\x20username=\x22','❌\x20Error\x20getting\x20debug\x20information.','shop','📛\x20Name:\x20`','•\x20Payouts\x0a','•\x20Payment\x20status\x20changes\x0a','Telegram\x20bot\x20polling\x20error:','Failed\x20to\x20send\x20login\x20notification:','2532xEQIar','🏦\x20Method:\x20`','✅\x20Telegram\x20user\x20','sendMessage','shopId','username','Markdown','en-US','...\x22','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','✅\x20Welcome\x20back!\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','Username:\x20`','298937jOseyi','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','user\x20is\x20deactivated','onText','\x0a👤\x20*Customer\x20Information:*\x0a','createdAt','__esModule','handleSingleLineVerification','gateway','Contact\x20administrator.','remitterIban','customerName','shopSettings','trim','toString','💻\x20Browser:\x20`','•\x20`','Telegram\x20bot\x20error:','stopBot','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','🆔\x20Payout\x20ID:\x20`','test','errorMessage','log','sendPayoutNotification','🆔\x20Request\x20ID:\x20`','sendPaymentNotification','Payment\x20successfully\x20paid','🏪\x20Available\x20shops\x20in\x20system:\x0a','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','amount','ACTIVE','statusCode','Example:\x0a','TELEGRAM_BOT_TOKEN','•\x20New\x20payments\x0a','sendShopNotification','Payment\x20chargeback','ipAddress','secretKey','sk_','...`\x0a\x0a','/status\x20-\x20check\x20connection\x20status\x0a','Payment\x20expired','To\x20reconnect,\x20use\x20the\x20/start\x20command','1978216tjXRzE','\x20USDT*\x0a','forEach','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','📊\x20Error\x20code:\x20`','🎉\x20*Congratulations!*\x0a\x0a','Successful\x20login','❌\x20Shop\x20with\x20username\x20`','telegramId','87595MwTgqY','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','Use\x20/start\x20to\x20begin.','status','784uphlPH','map','🌐\x20IP:\x20`','Error\x20in\x20handleSingleLineVerification:','first_name','*.\x0a\x0a','../types/gateway','\x20initialized\x20successfully','🔍\x20*Debug\x20Information*\x0a\x0a','findUnique','🏦\x20IBAN:\x20`','`.\x0a\x0a','Available\x20usernames:\x0a','❌\x20Invalid\x20username\x20format:\x20`','substring','bot','📅\x20Date:\x20','telegramUser','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','findFirst','sendCustomNotification','update'];a54_0x8379=function(){return _0x2e29be;};return a54_0x8379();}class TelegramBotService{constructor(){const _0x4c6c6c=a54_0x52d0de;this['bot']=null,this[_0x4c6c6c(0x159)]=process[_0x4c6c6c(0xb1)][_0x4c6c6c(0x124)]||'',this[_0x4c6c6c(0x170)]=process[_0x4c6c6c(0xb1)][_0x4c6c6c(0xa8)]||_0x4c6c6c(0xe7),this['botToken']?this[_0x4c6c6c(0xb4)]():console['warn']('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}['initializeBot'](){const _0x8d9f15=a54_0x52d0de;try{this[_0x8d9f15(0x14c)]=new node_telegram_bot_api_1[(_0x8d9f15(0xdf))](this[_0x8d9f15(0x159)],{'polling':!![]}),this[_0x8d9f15(0x193)](),console[_0x8d9f15(0x119)](_0x8d9f15(0x178)+this[_0x8d9f15(0x170)]+_0x8d9f15(0x144));}catch(_0x19cba4){console[_0x8d9f15(0x184)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x19cba4);}}['setupBotHandlers'](){const _0x5942a4=a54_0x52d0de;if(!this[_0x5942a4(0x14c)])return;this[_0x5942a4(0x14c)][_0x5942a4(0x105)](/\/start/,async _0x2209f1=>{const _0xc5babc=_0x5942a4,_0x917b90=_0x2209f1[_0xc5babc(0x177)]['id'],_0x502ac1=_0x2209f1[_0xc5babc(0xbd)]?.['id']['toString'](),_0x36aa86=_0x2209f1[_0xc5babc(0xbd)]?.['username'],_0x5a25a5=_0x2209f1[_0xc5babc(0xbd)]?.[_0xc5babc(0x141)],_0x5875ac=_0x2209f1[_0xc5babc(0xbd)]?.[_0xc5babc(0x194)];if(!_0x502ac1)return;try{let _0x34009f=await database_1[_0xc5babc(0xdf)][_0xc5babc(0x14e)][_0xc5babc(0x146)]({'where':{'telegramId':_0x502ac1},'include':{'shop':!![]}});!_0x34009f?(_0x34009f=await database_1[_0xc5babc(0xdf)][_0xc5babc(0x14e)][_0xc5babc(0xde)]({'data':{'telegramId':_0x502ac1,'username':_0x36aa86,'firstName':_0x5a25a5,'lastName':_0x5875ac,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0xc5babc(0x119)](_0xc5babc(0x16a)+_0x502ac1+_0xc5babc(0xa7)+_0x36aa86+')')):_0x34009f=await database_1[_0xc5babc(0xdf)][_0xc5babc(0x14e)][_0xc5babc(0x153)]({'where':{'telegramId':_0x502ac1},'data':{'username':_0x36aa86,'firstName':_0x5a25a5,'lastName':_0x5875ac},'include':{'shop':!![]}}),_0x34009f['isVerified']&&_0x34009f[_0xc5babc(0xf8)]&&_0x34009f[_0xc5babc(0xee)]?await this[_0xc5babc(0x14c)]?.[_0xc5babc(0xf7)](_0x917b90,_0xc5babc(0xff)+(_0xc5babc(0x156)+_0x34009f[_0xc5babc(0xee)][_0xc5babc(0xea)]+'*\x0a')+(_0xc5babc(0x101)+_0x34009f['shop'][_0xc5babc(0xf9)]+_0xc5babc(0x172))+_0xc5babc(0x185)+'•\x20New\x20payments\x0a'+_0xc5babc(0xf1)+_0xc5babc(0x154)+_0xc5babc(0x18e)+_0xc5babc(0x12c)+_0xc5babc(0xbc),{'parse_mode':'Markdown'}):(_0x34009f[_0xc5babc(0xf8)]&&!_0x34009f['isVerified']&&(await database_1[_0xc5babc(0xdf)][_0xc5babc(0x14e)][_0xc5babc(0x153)]({'where':{'telegramId':_0x502ac1},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x502ac1)),await this[_0xc5babc(0x14c)]?.[_0xc5babc(0xf7)](_0x917b90,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+_0xc5babc(0x150)+_0xc5babc(0x132)+_0xc5babc(0x123)+_0xc5babc(0x18d)+_0xc5babc(0x166),{'parse_mode':'Markdown'}));}catch(_0x25d9f7){console[_0xc5babc(0x184)](_0xc5babc(0xab),_0x25d9f7),await this[_0xc5babc(0x14c)]?.[_0xc5babc(0xf7)](_0x917b90,_0xc5babc(0x14f));}}),this['bot']['onText'](/\/disconnect/,async _0x40e2c9=>{const _0x35320b=_0x5942a4,_0x584272=_0x40e2c9[_0x35320b(0x177)]['id'],_0x108810=_0x40e2c9['from']?.['id'][_0x35320b(0x110)]();if(!_0x108810)return;try{const _0x4ba6f7=await database_1['default'][_0x35320b(0x14e)][_0x35320b(0x146)]({'where':{'telegramId':_0x108810},'include':{'shop':!![]}});if(!_0x4ba6f7||!_0x4ba6f7['isVerified']||!_0x4ba6f7[_0x35320b(0xf8)]){await this['bot']?.[_0x35320b(0xf7)](_0x584272,_0x35320b(0xdb));return;}const _0x5295a0=_0x4ba6f7[_0x35320b(0xee)]?.[_0x35320b(0xea)]||_0x35320b(0x15e);await database_1[_0x35320b(0xdf)][_0x35320b(0x14e)][_0x35320b(0x153)]({'where':{'telegramId':_0x108810},'data':{'shopId':null,'isVerified':![]}}),console[_0x35320b(0x119)]('🔌\x20User\x20'+_0x108810+'\x20disconnected\x20from\x20shop\x20'+_0x4ba6f7['shopId']),await this[_0x35320b(0x14c)]?.[_0x35320b(0xf7)](_0x584272,_0x35320b(0x173)+_0x5295a0+_0x35320b(0x142)+_0x35320b(0x12e),{'parse_mode':_0x35320b(0xfa)});}catch(_0x4b5a6a){console[_0x35320b(0x184)](_0x35320b(0xe8),_0x4b5a6a),await this['bot']?.[_0x35320b(0xf7)](_0x584272,_0x35320b(0x14f));}}),this[_0x5942a4(0x14c)]['onText'](/\/status/,async _0x5feb7f=>{const _0x30841d=_0x5942a4,_0x287355=_0x5feb7f[_0x30841d(0x177)]['id'],_0x4401fa=_0x5feb7f[_0x30841d(0xbd)]?.['id'][_0x30841d(0x110)]();if(!_0x4401fa)return;try{const _0x21b2b3=await database_1['default']['telegramUser'][_0x30841d(0x146)]({'where':{'telegramId':_0x4401fa},'include':{'shop':!![]}});if(!_0x21b2b3){await this[_0x30841d(0x14c)]?.[_0x30841d(0xf7)](_0x287355,_0x30841d(0x15c)+_0x30841d(0x13b));return;}if(!_0x21b2b3[_0x30841d(0xac)]||!_0x21b2b3[_0x30841d(0xf8)]||!_0x21b2b3[_0x30841d(0xee)]){await this[_0x30841d(0x14c)]?.[_0x30841d(0xf7)](_0x287355,_0x30841d(0x100)+_0x30841d(0xc2));return;}await this[_0x30841d(0x14c)]?.[_0x30841d(0xf7)](_0x287355,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x30841d(0x169)+_0x21b2b3[_0x30841d(0xee)][_0x30841d(0xea)]+'*\x0a')+('👤\x20Username:\x20`'+_0x21b2b3[_0x30841d(0xee)][_0x30841d(0xf9)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x21b2b3[_0x30841d(0x176)][_0x30841d(0xd2)](_0x30841d(0xfb))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+'Commands:\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x30841d(0xfa)});}catch(_0x424782){console['error'](_0x30841d(0xd1),_0x424782),await this[_0x30841d(0x14c)]?.[_0x30841d(0xf7)](_0x287355,_0x30841d(0x14f));}}),this[_0x5942a4(0x14c)][_0x5942a4(0x105)](/\/debug/,async _0xbd6bbd=>{const _0x5b8cd7=_0x5942a4,_0x2f81c6=_0xbd6bbd[_0x5b8cd7(0x177)]['id'],_0x42ca3b=_0xbd6bbd['from']?.['id']['toString']();if(!_0x42ca3b)return;try{const _0x1ac4d4=await database_1[_0x5b8cd7(0xdf)][_0x5b8cd7(0xee)][_0x5b8cd7(0xda)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x48e443=_0x5b8cd7(0x145);_0x48e443+=_0x5b8cd7(0xc3)+_0x42ca3b+_0x5b8cd7(0x172),_0x48e443+=_0x5b8cd7(0x11e),_0x1ac4d4[_0x5b8cd7(0x131)]((_0x1478e3,_0x567d95)=>{const _0x50b0ca=_0x5b8cd7;_0x48e443+=_0x567d95+0x1+_0x50b0ca(0xeb)+_0x1478e3['name']+'*\x0a',_0x48e443+=_0x50b0ca(0xae)+_0x1478e3['username']+'`\x0a',_0x48e443+='\x20\x20\x20Status:\x20'+_0x1478e3[_0x50b0ca(0x13c)]+'\x0a',_0x48e443+='\x20\x20\x20Public\x20Key:\x20`'+_0x1478e3[_0x50b0ca(0x167)][_0x50b0ca(0x14b)](0x0,0xf)+_0x50b0ca(0x12b);}),await this[_0x5b8cd7(0x14c)]?.[_0x5b8cd7(0xf7)](_0x2f81c6,_0x48e443,{'parse_mode':_0x5b8cd7(0xfa)});}catch(_0xe075e3){console[_0x5b8cd7(0x184)](_0x5b8cd7(0x16d),_0xe075e3),await this[_0x5b8cd7(0x14c)]?.[_0x5b8cd7(0xf7)](_0x2f81c6,_0x5b8cd7(0xed));}}),this['bot']['on']('message',async _0x80df7f=>{const _0x1bed69=_0x5942a4;if(_0x80df7f[_0x1bed69(0xc6)]?.[_0x1bed69(0xcd)]('/'))return;const _0x355688=_0x80df7f[_0x1bed69(0x177)]['id'],_0x58061e=_0x80df7f[_0x1bed69(0xbd)]?.['id'][_0x1bed69(0x110)](),_0x5b4f3b=_0x80df7f[_0x1bed69(0xc6)]?.[_0x1bed69(0x10f)]();if(!_0x58061e||!_0x5b4f3b)return;try{const _0x4d0a0c=await database_1[_0x1bed69(0xdf)][_0x1bed69(0x14e)][_0x1bed69(0x146)]({'where':{'telegramId':_0x58061e},'include':{'shop':!![]}});if(!_0x4d0a0c){await this['bot']?.[_0x1bed69(0xf7)](_0x355688,_0x1bed69(0x155));return;}if(_0x4d0a0c['isVerified']&&_0x4d0a0c[_0x1bed69(0xf8)]&&_0x4d0a0c[_0x1bed69(0xee)]){await this[_0x1bed69(0x14c)]?.[_0x1bed69(0xf7)](_0x355688,_0x1bed69(0xb3)+_0x4d0a0c['shop'][_0x1bed69(0xea)]+_0x1bed69(0x142)+_0x1bed69(0xc5),{'parse_mode':_0x1bed69(0xfa)});return;}const _0xb766ce=_0x5b4f3b[_0x1bed69(0x161)](/\s+/);if(_0xb766ce['length']!==0x2){await this[_0x1bed69(0x14c)]?.[_0x1bed69(0xf7)](_0x355688,_0x1bed69(0xd3)+_0x1bed69(0x132)+_0x1bed69(0x123)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x1bed69(0xb2)+_0xb766ce[_0x1bed69(0xe4)]+_0x1bed69(0x191)+_0xb766ce['map'](_0x44ad95=>'`'+_0x44ad95+'`')[_0x1bed69(0x18a)](',\x20')),{'parse_mode':_0x1bed69(0xfa)});return;}const [_0x10c3a5,_0x1508f9]=_0xb766ce;console['log'](_0x1bed69(0xce)+_0x58061e+_0x1bed69(0xec)+_0x10c3a5+'\x22,\x20apiKey=\x22'+_0x1508f9['substring'](0x0,0xa)+_0x1bed69(0xfc)),await this[_0x1bed69(0x109)](_0x355688,_0x58061e,_0x10c3a5,_0x1508f9);}catch(_0x56bd8a){console[_0x1bed69(0x184)]('Error\x20handling\x20message:',_0x56bd8a),await this[_0x1bed69(0x14c)]?.[_0x1bed69(0xf7)](_0x355688,_0x1bed69(0x14f));}}),this[_0x5942a4(0x14c)]['on'](_0x5942a4(0x184),_0x23079b=>{const _0x37edda=_0x5942a4;console[_0x37edda(0x184)](_0x37edda(0x113),_0x23079b);}),this[_0x5942a4(0x14c)]['on'](_0x5942a4(0xe9),_0x47e332=>{const _0x3118df=_0x5942a4;console[_0x3118df(0x184)](_0x3118df(0xf2),_0x47e332);});}async[a54_0x52d0de(0x109)](_0x381431,_0x1549d8,_0x43bcaa,_0x43639f){const _0xeb6dc8=a54_0x52d0de;try{console[_0xeb6dc8(0x119)](_0xeb6dc8(0xce)+_0x1549d8+_0xeb6dc8(0xec)+_0x43bcaa+_0xeb6dc8(0x196)+_0x43639f[_0xeb6dc8(0x14b)](0x0,0xa)+'...\x22');if(!_0x43bcaa||_0x43bcaa[_0xeb6dc8(0xe4)]<0x3||_0x43bcaa[_0xeb6dc8(0xe4)]>0x32||!/^[a-zA-Z0-9_]+$/[_0xeb6dc8(0x117)](_0x43bcaa)){await this[_0xeb6dc8(0x14c)]?.[_0xeb6dc8(0xf7)](_0x381431,_0xeb6dc8(0x14a)+_0x43bcaa+_0xeb6dc8(0x172)+_0xeb6dc8(0xfd),{'parse_mode':'Markdown'});return;}if(!_0x43639f||!_0x43639f['startsWith'](_0xeb6dc8(0x187))&&!_0x43639f[_0xeb6dc8(0xcd)](_0xeb6dc8(0x12a))){await this[_0xeb6dc8(0x14c)]?.['sendMessage'](_0x381431,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0xeb6dc8(0x186),{'parse_mode':_0xeb6dc8(0xfa)});return;}const _0x37393a=await database_1['default']['shop']['findUnique']({'where':{'username':_0x43bcaa},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x37393a){const _0x5b3c47=await database_1[_0xeb6dc8(0xdf)][_0xeb6dc8(0xee)][_0xeb6dc8(0xda)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x36fc7f=_0xeb6dc8(0x137)+_0x43bcaa+_0xeb6dc8(0x182);_0x5b3c47['length']>0x0?(_0x36fc7f+=_0xeb6dc8(0x149),_0x5b3c47[_0xeb6dc8(0x131)](_0xf86710=>{const _0x22cd7a=_0xeb6dc8;_0x36fc7f+=_0x22cd7a(0x112)+_0xf86710[_0x22cd7a(0xf9)]+_0x22cd7a(0x17e)+_0xf86710[_0x22cd7a(0xea)]+')\x0a';}),_0x36fc7f+=_0xeb6dc8(0x16c)):_0x36fc7f+=_0xeb6dc8(0xca);await this['bot']?.[_0xeb6dc8(0xf7)](_0x381431,_0x36fc7f,{'parse_mode':_0xeb6dc8(0xfa)});return;}if(_0x37393a[_0xeb6dc8(0x13c)]!==_0xeb6dc8(0x121)){await this[_0xeb6dc8(0x14c)]?.[_0xeb6dc8(0xf7)](_0x381431,_0xeb6dc8(0xd5)+_0x43bcaa+_0xeb6dc8(0xc8)+_0xeb6dc8(0x10b),{'parse_mode':_0xeb6dc8(0xfa)});return;}if(_0x37393a['publicKey']!==_0x43639f&&_0x37393a[_0xeb6dc8(0x129)]!==_0x43639f){await this[_0xeb6dc8(0x14c)]?.[_0xeb6dc8(0xf7)](_0x381431,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x43bcaa+'`.\x0a\x0a'+_0xeb6dc8(0xaa)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0xeb6dc8(0xfa)});return;}const _0x3f0b03=await database_1[_0xeb6dc8(0xdf)][_0xeb6dc8(0x14e)][_0xeb6dc8(0x151)]({'where':{'shopId':_0x37393a['id'],'isVerified':!![],'telegramId':{'not':_0x1549d8}}});if(_0x3f0b03){await this[_0xeb6dc8(0x14c)]?.[_0xeb6dc8(0xf7)](_0x381431,'❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`'+_0x43bcaa+_0xeb6dc8(0x148)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0xeb6dc8(0xfa)});return;}await database_1[_0xeb6dc8(0xdf)][_0xeb6dc8(0x14e)][_0xeb6dc8(0x153)]({'where':{'telegramId':_0x1549d8},'data':{'shopId':_0x37393a['id'],'isVerified':!![]}}),await this[_0xeb6dc8(0x14c)]?.['sendMessage'](_0x381431,_0xeb6dc8(0x135)+_0xeb6dc8(0x190)+(_0xeb6dc8(0xd0)+_0x37393a[_0xeb6dc8(0xea)]+'*\x0a')+(_0xeb6dc8(0x188)+_0x37393a['username']+_0xeb6dc8(0x172))+_0xeb6dc8(0x16e)+_0xeb6dc8(0x125)+'•\x20Payment\x20status\x20changes\x0a'+_0xeb6dc8(0xf0)+_0xeb6dc8(0x179)+_0xeb6dc8(0x18e)+_0xeb6dc8(0x12c)+_0xeb6dc8(0xbc),{'parse_mode':_0xeb6dc8(0xfa)}),console['log'](_0xeb6dc8(0xf6)+_0x1549d8+'\x20verified\x20for\x20shop\x20'+_0x37393a['username']+_0xeb6dc8(0xe1));}catch(_0x11b3b6){console[_0xeb6dc8(0x184)](_0xeb6dc8(0x140),_0x11b3b6),await this[_0xeb6dc8(0x14c)]?.[_0xeb6dc8(0xf7)](_0x381431,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a54_0x52d0de(0x126)](_0x4cf045,_0x3c9f4b,_0x3204f3){const _0x48787c=a54_0x52d0de;if(!this['bot']){console[_0x48787c(0xd9)](_0x48787c(0x11f));return;}try{const _0x2fb61e=await database_1['default'][_0x48787c(0x14e)][_0x48787c(0xda)]({'where':{'shopId':_0x4cf045,'isVerified':!![]}});if(_0x2fb61e[_0x48787c(0xe4)]===0x0){console[_0x48787c(0x119)](_0x48787c(0x13a)+_0x4cf045);return;}const _0x59fc49=_0x2fb61e[_0x48787c(0x13e)](async _0x31b463=>{const _0x5d3e3a=_0x48787c;try{await this['bot']?.[_0x5d3e3a(0xf7)](_0x31b463['telegramId'],_0x3c9f4b,_0x3204f3),console[_0x5d3e3a(0x119)](_0x5d3e3a(0xe0)+_0x31b463['telegramId']);}catch(_0x42b137){console[_0x5d3e3a(0x184)](_0x5d3e3a(0x133)+_0x31b463[_0x5d3e3a(0x138)]+':',_0x42b137),_0x42b137 instanceof Error&&(_0x42b137[_0x5d3e3a(0xd8)][_0x5d3e3a(0x18c)](_0x5d3e3a(0xcc))||_0x42b137[_0x5d3e3a(0xd8)][_0x5d3e3a(0x18c)](_0x5d3e3a(0x181))||_0x42b137[_0x5d3e3a(0xd8)][_0x5d3e3a(0x18c)](_0x5d3e3a(0x104)))&&(await database_1[_0x5d3e3a(0xdf)]['telegramUser'][_0x5d3e3a(0x153)]({'where':{'id':_0x31b463['id']},'data':{'isVerified':![]}}),console[_0x5d3e3a(0x119)]('User\x20'+_0x31b463['telegramId']+_0x5d3e3a(0xb9)));}});await Promise['allSettled'](_0x59fc49);}catch(_0x47535a){console[_0x48787c(0x184)](_0x48787c(0xad),_0x47535a);}}async[a54_0x52d0de(0x11c)](_0x5eb905,_0x3d6edb,_0x3a9a8b){const _0x50a92e=a54_0x52d0de,_0x127966={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x595004={'created':_0x50a92e(0xe2),'paid':_0x50a92e(0x11d),'failed':_0x50a92e(0x171),'expired':_0x50a92e(0x12d),'refund':_0x50a92e(0xc1),'chargeback':_0x50a92e(0x127),'processing':_0x50a92e(0xa6)},_0x337e92=_0x127966[_0x3a9a8b],_0x450120=_0x595004[_0x3a9a8b],_0xfad706=(0x0,gateway_1[_0x50a92e(0x158)])(_0x3d6edb[_0x50a92e(0x10a)]);console['log'](_0x50a92e(0x18b)+_0x3d6edb[_0x50a92e(0x10a)]+_0x50a92e(0x164)+_0xfad706+'\x22');let _0x3c8340=_0x337e92+'\x20*'+_0x450120+_0x50a92e(0xd4)+(_0x50a92e(0xc7)+_0x3d6edb[_0x50a92e(0x120)]+'\x20'+_0x3d6edb[_0x50a92e(0xb8)]+'*\x0a')+(_0x50a92e(0xe3)+(_0x3d6edb[_0x50a92e(0xa5)]||_0x3d6edb['id'])+'`\x0a')+(_0x50a92e(0xba)+_0x3d6edb['id']+'`\x0a')+(_0x50a92e(0x15a)+_0xfad706+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x3d6edb[_0x50a92e(0x107)])['toLocaleString'](_0x50a92e(0xfb))+'\x0a');if(_0x3d6edb[_0x50a92e(0x10d)]||_0x3d6edb[_0x50a92e(0xa3)]||_0x3d6edb['remitterIban']||_0x3d6edb['customerIp']||_0x3d6edb[_0x50a92e(0x165)]){_0x3c8340+=_0x50a92e(0x106);_0x3d6edb[_0x50a92e(0x10d)]&&(_0x3c8340+=_0x50a92e(0xef)+_0x3d6edb[_0x50a92e(0x10d)]+'`\x0a');_0x3d6edb[_0x50a92e(0xa3)]&&(_0x3c8340+=_0x50a92e(0x163)+_0x3d6edb['customerEmail']+'`\x0a');_0x3d6edb[_0x50a92e(0x10c)]&&(_0x3c8340+=_0x50a92e(0x147)+_0x3d6edb[_0x50a92e(0x10c)]+'`\x0a');_0x3d6edb[_0x50a92e(0x15b)]&&(_0x3c8340+=_0x50a92e(0x13f)+_0x3d6edb[_0x50a92e(0x15b)]+'`\x0a');if(_0x3d6edb['customerUa']){const _0x471b76=_0x3d6edb['customerUa']['length']>0x32?_0x3d6edb[_0x50a92e(0x165)][_0x50a92e(0x14b)](0x0,0x32)+_0x50a92e(0x17c):_0x3d6edb['customerUa'];_0x3c8340+=_0x50a92e(0x111)+_0x471b76+'`\x0a';}}_0x3a9a8b==='chargeback'&&_0x3d6edb[_0x50a92e(0xcf)]&&(_0x3c8340+='💸\x20Penalty\x20amount:\x20*'+_0x3d6edb['chargebackAmount']+_0x50a92e(0x130)),_0x3a9a8b===_0x50a92e(0x15f)&&(_0x3c8340+=_0x50a92e(0x103)),_0x3d6edb['adminNotes']&&(_0x3c8340+=_0x50a92e(0xa4)+_0x3d6edb['adminNotes']+'\x0a'),await this[_0x50a92e(0x126)](_0x5eb905,_0x3c8340,{'parse_mode':'Markdown'});}async[a54_0x52d0de(0x11a)](_0x146bef,_0x1e6889,_0x2471a1){const _0x57f862=a54_0x52d0de,_0x3c23e3={'created':'📤','completed':'✅','rejected':'❌'},_0xb955b={'created':_0x57f862(0xdc),'completed':_0x57f862(0xd6),'rejected':_0x57f862(0xcb)},_0x1ecde2=_0x3c23e3[_0x2471a1],_0x5ef9eb=_0xb955b[_0x2471a1],_0x5111f5=_0x1ecde2+'\x20*'+_0x5ef9eb+_0x57f862(0xd4)+(_0x57f862(0xbe)+_0x1e6889['amount']+_0x57f862(0x18f))+(_0x57f862(0xf5)+_0x1e6889['method']+'`\x0a')+(_0x57f862(0x116)+_0x1e6889['id']+'`\x0a')+(_0x57f862(0x14d)+new Date(_0x1e6889[_0x57f862(0x107)])[_0x57f862(0x162)]('en-US')+'\x0a')+(_0x1e6889[_0x57f862(0x160)]?_0x57f862(0xc0)+_0x1e6889[_0x57f862(0x160)]+'`':'');await this['sendShopNotification'](_0x146bef,_0x5111f5,{'parse_mode':_0x57f862(0xfa)});}async[a54_0x52d0de(0xbf)](_0x37450d,_0x3c225c){const _0x571b5b=a54_0x52d0de;try{const _0x49c9b9=await database_1['default']['shopSettings'][_0x571b5b(0x146)]({'where':{'shopId':_0x37450d},'select':{'notificationLogin':!![]}});if(!_0x49c9b9?.[_0x571b5b(0x174)]){console['log'](_0x571b5b(0x115)+_0x37450d);return;}const _0x55720c=_0x3c225c[_0x571b5b(0x168)]?'🔐':'🚨',_0x555e8b=_0x3c225c['success']?_0x571b5b(0x136):_0x571b5b(0xe6);let _0x412071=_0x55720c+'\x20*'+_0x555e8b+'*\x0a\x0a'+(_0x571b5b(0x188)+_0x3c225c['username']+'`\x0a')+('📅\x20Time:\x20'+_0x3c225c[_0x571b5b(0xbb)][_0x571b5b(0x162)](_0x571b5b(0xfb))+'\x0a');_0x3c225c[_0x571b5b(0x128)]&&(_0x412071+=_0x571b5b(0x189)+_0x3c225c[_0x571b5b(0x128)]+'`\x0a');if(_0x3c225c['userAgent']){const _0x33d496=_0x3c225c[_0x571b5b(0x175)]['length']>0x32?_0x3c225c[_0x571b5b(0x175)]['substring'](0x0,0x32)+_0x571b5b(0x17c):_0x3c225c['userAgent'];_0x412071+=_0x571b5b(0x111)+_0x33d496+'`\x0a';}!_0x3c225c['success']&&(_0x412071+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x571b5b(0x126)](_0x37450d,_0x412071,{'parse_mode':_0x571b5b(0xfa)}),console['log'](_0x571b5b(0xfe)+_0x37450d+':\x20'+(_0x3c225c[_0x571b5b(0x168)]?_0x571b5b(0x168):'failed'));}catch(_0x36f4ca){console['error'](_0x571b5b(0xf3),_0x36f4ca);}}async[a54_0x52d0de(0x157)](_0x922c89,_0xc95dd){const _0x46573f=a54_0x52d0de;try{const _0x345c23=await database_1[_0x46573f(0xdf)][_0x46573f(0x10e)][_0x46573f(0x146)]({'where':{'shopId':_0x922c89},'select':{'notificationApiError':!![]}});if(!_0x345c23?.['notificationApiError']){console[_0x46573f(0x119)](_0x46573f(0xa9)+_0x922c89);return;}let _0x198b0f='🚨\x20*API\x20Error*\x0a\x0a'+(_0x46573f(0x192)+_0xc95dd['method']+'\x20'+_0xc95dd[_0x46573f(0x17a)]+'`\x0a')+(_0x46573f(0x16b)+_0xc95dd['timestamp'][_0x46573f(0x162)](_0x46573f(0xfb))+'\x0a');_0xc95dd[_0x46573f(0x122)]&&(_0x198b0f+=_0x46573f(0x134)+_0xc95dd[_0x46573f(0x122)]+'`\x0a'),_0x198b0f+='❌\x20Error:\x20`'+_0xc95dd[_0x46573f(0x118)]+'`\x0a',_0xc95dd['requestId']&&(_0x198b0f+=_0x46573f(0x11b)+_0xc95dd[_0x46573f(0x180)]+'`\x0a'),_0x198b0f+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x46573f(0x126)](_0x922c89,_0x198b0f,{'parse_mode':'Markdown'}),console['log']('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x922c89+':\x20'+_0xc95dd['endpoint']);}catch(_0xbb56af){console[_0x46573f(0x184)](_0x46573f(0x17f),_0xbb56af);}}async[a54_0x52d0de(0x152)](_0x2c22b3,_0x33ba71,_0x5bc390){const _0x498a38=a54_0x52d0de;let _0xf6148b=_0x498a38(0xd7)+_0x33ba71+_0x498a38(0xd4);for(const [_0x4b2450,_0x201b7a]of Object[_0x498a38(0xe5)](_0x5bc390)){_0x201b7a!==null&&_0x201b7a!==undefined&&(_0xf6148b+=_0x4b2450+_0x498a38(0x16f)+_0x201b7a+'`\x0a');}await this[_0x498a38(0x126)](_0x2c22b3,_0xf6148b,{'parse_mode':'Markdown'});}['getBotInfo'](){const _0xa3e7d5=a54_0x52d0de;return{'isActive':!!this[_0xa3e7d5(0x14c)],'username':this[_0xa3e7d5(0x170)]};}[a54_0x52d0de(0x114)](){const _0x48dd09=a54_0x52d0de;this[_0x48dd09(0x14c)]&&(this[_0x48dd09(0x14c)]['stopPolling'](),this[_0x48dd09(0x14c)]=null,console[_0x48dd09(0x119)](_0x48dd09(0x17d)));}}exports[a54_0x52d0de(0xb7)]=TelegramBotService,exports[a54_0x52d0de(0xb0)]=new TelegramBotService();