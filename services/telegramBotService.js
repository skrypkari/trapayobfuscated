'use strict';const a54_0x39dd1c=a54_0x1519;(function(_0x183806,_0x1d5d57){const _0x57b7ec=a54_0x1519,_0x524440=_0x183806();while(!![]){try{const _0x5daa33=parseInt(_0x57b7ec(0x18f))/0x1+parseInt(_0x57b7ec(0x252))/0x2*(-parseInt(_0x57b7ec(0x1aa))/0x3)+parseInt(_0x57b7ec(0x250))/0x4+parseInt(_0x57b7ec(0x1c0))/0x5+-parseInt(_0x57b7ec(0x197))/0x6*(parseInt(_0x57b7ec(0x211))/0x7)+-parseInt(_0x57b7ec(0x1d1))/0x8+parseInt(_0x57b7ec(0x1bc))/0x9;if(_0x5daa33===_0x1d5d57)break;else _0x524440['push'](_0x524440['shift']());}catch(_0x5d4c1d){_0x524440['push'](_0x524440['shift']());}}}(a54_0x5486,0xb3d95));var __importDefault=this&&this[a54_0x39dd1c(0x1b2)]||function(_0x285fc3){const _0x532367=a54_0x39dd1c;return _0x285fc3&&_0x285fc3[_0x532367(0x23b)]?_0x285fc3:{'default':_0x285fc3};};function a54_0x1519(_0x1a97cc,_0x47c688){const _0x548666=a54_0x5486();return a54_0x1519=function(_0x151907,_0x296720){_0x151907=_0x151907-0x188;let _0x37dece=_0x548666[_0x151907];return _0x37dece;},a54_0x1519(_0x1a97cc,_0x47c688);}function a54_0x5486(){const _0x3b5b37=['adminNotes','TELEGRAM_BOT_USERNAME','en-US','Failed\x20to\x20send\x20API\x20error\x20notification:','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','initializeBot','../config/database','14ARVKXh','✅\x20Welcome\x20back!\x0a\x0a','🔗\x20Endpoint:\x20`','polling_error','To\x20reconnect,\x20use\x20the\x20/start\x20command','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','unknown\x20shop',':\x20`','requestId','telegramBotService','log','name','📛\x20Name:\x20`','shopSettings','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','Available\x20usernames:\x0a','📱\x20Created\x20new\x20Telegram\x20user:\x20','New\x20payout\x20created','Payment\x20successfully\x20paid',':\x20username=\x22','last_name','test','bot','\x20disconnected\x20from\x20shop\x20','*.\x0a\x0a','📊\x20Error\x20code:\x20`','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','ACTIVE','includes','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','Telegram\x20bot\x20error:','Commands:\x0a','message','`\x0a\x0a','shop','🚨\x20*API\x20Error*\x0a\x0a','notificationApiError','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','trapay_bot','TELEGRAM_BOT_TOKEN','__esModule','📊\x20*Connection\x20Status*\x0a\x0a','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','pk_','handleSingleLineVerification','🔗\x20TXID:\x20`','createdAt','ipAddress','🔔\x20You\x20receive\x20notifications\x20about:\x0a','✅\x20Telegram\x20user\x20','allSettled','timestamp','../types/gateway','📅\x20Date:\x20','statusCode','✅\x20Telegram\x20bot\x20@','entries','toLocaleString','*\x0a\x0a','customerEmail','first_name','1343504wdRfOl','substring','35110XaXAXv','remitterIban','sendMessage','`\x20(','customerUa','chat','telegramUser','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','Failed\x20to\x20send\x20login\x20notification:','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','Error\x20handling\x20/status\x20command:','chat\x20not\x20found','endpoint','Payment\x20refund','📝\x20Notes:\x20','gateway','status','💸\x20Amount:\x20*','Payment\x20is\x20being\x20processed','\x20verified\x20for\x20shop\x20','❌\x20Please\x20use\x20/start\x20command\x20first','user\x20is\x20deactivated','forEach','•\x20Payouts\x0a','sendLoginNotification','findMany','failed','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','👤\x20Username:\x20`','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','\x20initialized\x20successfully','from','726517uWJiiV','Payment\x20chargeback','/status\x20-\x20check\x20connection\x20status\x0a','username','toLocaleDateString','sk_','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','onText','3026820DTQdrn','customerIp','findUnique','secretKey','\x22\x20->\x20display\x20\x22','errorMessage','success','Error\x20handling\x20/debug\x20command:','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','❌\x20Shop\x20`','env','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','notificationLogin','botUsername','Telegram\x20bot\x20polling\x20error:','sendShopNotification','\x20\x20\x20Public\x20Key:\x20`','currency','telegramId','129HnjyNY','create','Example:\x0a','💻\x20Browser:\x20`','Use\x20/start\x20to\x20begin.','error','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','default','__importDefault','map','processing','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','🆔\x20Request\x20ID:\x20`','🏪\x20Gateway:\x20`','shopId','method','TelegramBotService','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','5486472NWliRS','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','orderId','•\x20`','5225625DpVTEa','🏦\x20IBAN:\x20`','💰\x20Amount:\x20*','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','...\x22','New\x20payment\x20created','stopBot','Payout\x20completed','split','Use\x20/start\x20to\x20connect.','.\x20*','Check\x20spelling\x20and\x20try\x20again.','🏦\x20Method:\x20`','sendPayoutNotification','userAgent','•\x20New\x20payments\x0a','Payment\x20expired','1733280ZpaMRi','text','findFirst','❌\x20Error\x20getting\x20debug\x20information.','Error\x20handling\x20message:','isVerified','Username:\x20`','Successful\x20login','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','Markdown','sendCustomNotification','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','update','•\x20Payment\x20status\x20changes\x0a','publicKey','getBotInfo','stopPolling','🎉\x20*Congratulations!*\x0a\x0a','📅\x20Time:\x20','Payment\x20failed','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','length','📧\x20Email:\x20`','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','warn','chargeback','sendApiErrorNotification','txid','`.\x0a\x0a','botToken','\x20(@','📱\x20Shop:\x20*','chargebackAmount','sendPaymentNotification','Error\x20handling\x20/start\x20command:','startsWith','customerName','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','toString','Error\x20in\x20handleSingleLineVerification:','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','You\x20sent\x20','...','/disconnect\x20-\x20disconnect\x20from\x20notifications','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','`\x20not\x20found.\x0a\x0a','🛑\x20Telegram\x20bot\x20stopped','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','✅\x20Connected\x20to\x20shop:\x20*','🔍\x20*Debug\x20Information*\x0a\x0a','🔌\x20User\x20','\x20\x20\x20Username:\x20`','\x0a👤\x20*Customer\x20Information:*\x0a','getGatewayDisplayNameForTelegram','🆔\x20Payment\x20ID:\x20`'];a54_0x5486=function(){return _0x3b5b37;};return a54_0x5486();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a54_0x39dd1c(0x21a)]=exports[a54_0x39dd1c(0x1ba)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a54_0x39dd1c(0x210))),gateway_1=require(a54_0x39dd1c(0x247));class TelegramBotService{constructor(){const _0x59976a=a54_0x39dd1c;this[_0x59976a(0x228)]=null,this[_0x59976a(0x1ee)]=process[_0x59976a(0x1a1)][_0x59976a(0x23a)]||'',this[_0x59976a(0x1a4)]=process[_0x59976a(0x1a1)][_0x59976a(0x20a)]||_0x59976a(0x239),this[_0x59976a(0x1ee)]?this[_0x59976a(0x20f)]():console[_0x59976a(0x1e9)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a54_0x39dd1c(0x20f)](){const _0x3a0c41=a54_0x39dd1c;try{this[_0x3a0c41(0x228)]=new node_telegram_bot_api_1[(_0x3a0c41(0x1b1))](this[_0x3a0c41(0x1ee)],{'polling':!![]}),this['setupBotHandlers'](),console[_0x3a0c41(0x21b)](_0x3a0c41(0x24a)+this[_0x3a0c41(0x1a4)]+_0x3a0c41(0x18d));}catch(_0x190d91){console[_0x3a0c41(0x1af)](_0x3a0c41(0x1bb),_0x190d91);}}['setupBotHandlers'](){const _0x32f908=a54_0x39dd1c;if(!this[_0x32f908(0x228)])return;this[_0x32f908(0x228)][_0x32f908(0x196)](/\/start/,async _0x58bceb=>{const _0x5748f0=_0x32f908,_0x7446ce=_0x58bceb[_0x5748f0(0x257)]['id'],_0xe2281a=_0x58bceb['from']?.['id'][_0x5748f0(0x1f7)](),_0x2b30b9=_0x58bceb['from']?.['username'],_0x34aefa=_0x58bceb[_0x5748f0(0x18e)]?.[_0x5748f0(0x24f)],_0x2003d5=_0x58bceb[_0x5748f0(0x18e)]?.[_0x5748f0(0x226)];if(!_0xe2281a)return;try{let _0x1a6940=await database_1[_0x5748f0(0x1b1)]['telegramUser'][_0x5748f0(0x199)]({'where':{'telegramId':_0xe2281a},'include':{'shop':!![]}});!_0x1a6940?(_0x1a6940=await database_1[_0x5748f0(0x1b1)][_0x5748f0(0x258)][_0x5748f0(0x1ab)]({'data':{'telegramId':_0xe2281a,'username':_0x2b30b9,'firstName':_0x34aefa,'lastName':_0x2003d5,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x5748f0(0x21b)](_0x5748f0(0x222)+_0xe2281a+_0x5748f0(0x1ef)+_0x2b30b9+')')):_0x1a6940=await database_1[_0x5748f0(0x1b1)][_0x5748f0(0x258)]['update']({'where':{'telegramId':_0xe2281a},'data':{'username':_0x2b30b9,'firstName':_0x34aefa,'lastName':_0x2003d5},'include':{'shop':!![]}}),_0x1a6940['isVerified']&&_0x1a6940[_0x5748f0(0x1b8)]&&_0x1a6940[_0x5748f0(0x235)]?await this[_0x5748f0(0x228)]?.[_0x5748f0(0x254)](_0x7446ce,_0x5748f0(0x212)+(_0x5748f0(0x1c3)+_0x1a6940[_0x5748f0(0x235)][_0x5748f0(0x21c)]+'*\x0a')+(_0x5748f0(0x1d7)+_0x1a6940['shop']['username']+_0x5748f0(0x234))+_0x5748f0(0x243)+_0x5748f0(0x1cf)+_0x5748f0(0x1de)+'•\x20Payouts\x0a\x0a'+_0x5748f0(0x232)+_0x5748f0(0x191)+_0x5748f0(0x1fc),{'parse_mode':_0x5748f0(0x1da)}):(_0x1a6940[_0x5748f0(0x1b8)]&&!_0x1a6940['isVerified']&&(await database_1[_0x5748f0(0x1b1)]['telegramUser'][_0x5748f0(0x1dd)]({'where':{'telegramId':_0xe2281a},'data':{'shopId':null,'isVerified':![]}}),console[_0x5748f0(0x21b)](_0x5748f0(0x25b)+_0xe2281a)),await this[_0x5748f0(0x228)]?.[_0x5748f0(0x254)](_0x7446ce,_0x5748f0(0x1f6)+_0x5748f0(0x216)+_0x5748f0(0x21f)+_0x5748f0(0x1ac)+_0x5748f0(0x1fe)+_0x5748f0(0x230),{'parse_mode':'Markdown'}));}catch(_0x391950){console[_0x5748f0(0x1af)](_0x5748f0(0x1f3),_0x391950),await this[_0x5748f0(0x228)]?.[_0x5748f0(0x254)](_0x7446ce,_0x5748f0(0x1e8));}}),this[_0x32f908(0x228)][_0x32f908(0x196)](/\/disconnect/,async _0x4907a0=>{const _0x2dc867=_0x32f908,_0x2c2f44=_0x4907a0[_0x2dc867(0x257)]['id'],_0x383517=_0x4907a0[_0x2dc867(0x18e)]?.['id'][_0x2dc867(0x1f7)]();if(!_0x383517)return;try{const _0x1ef1ea=await database_1[_0x2dc867(0x1b1)]['telegramUser'][_0x2dc867(0x199)]({'where':{'telegramId':_0x383517},'include':{'shop':!![]}});if(!_0x1ef1ea||!_0x1ef1ea[_0x2dc867(0x1d6)]||!_0x1ef1ea[_0x2dc867(0x1b8)]){await this[_0x2dc867(0x228)]?.[_0x2dc867(0x254)](_0x2c2f44,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x3bc255=_0x1ef1ea[_0x2dc867(0x235)]?.['name']||_0x2dc867(0x217);await database_1[_0x2dc867(0x1b1)][_0x2dc867(0x258)][_0x2dc867(0x1dd)]({'where':{'telegramId':_0x383517},'data':{'shopId':null,'isVerified':![]}}),console[_0x2dc867(0x21b)](_0x2dc867(0x204)+_0x383517+_0x2dc867(0x229)+_0x1ef1ea[_0x2dc867(0x1b8)]),await this[_0x2dc867(0x228)]?.['sendMessage'](_0x2c2f44,_0x2dc867(0x20d)+_0x3bc255+_0x2dc867(0x22a)+_0x2dc867(0x215),{'parse_mode':'Markdown'});}catch(_0x2f6bb4){console[_0x2dc867(0x1af)]('Error\x20handling\x20/disconnect\x20command:',_0x2f6bb4),await this[_0x2dc867(0x228)]?.[_0x2dc867(0x254)](_0x2c2f44,_0x2dc867(0x1e8));}}),this['bot']['onText'](/\/status/,async _0x3bbe2b=>{const _0x35cb5a=_0x32f908,_0x3c6ff2=_0x3bbe2b['chat']['id'],_0x1eaed9=_0x3bbe2b['from']?.['id'][_0x35cb5a(0x1f7)]();if(!_0x1eaed9)return;try{const _0x46849b=await database_1[_0x35cb5a(0x1b1)][_0x35cb5a(0x258)][_0x35cb5a(0x199)]({'where':{'telegramId':_0x1eaed9},'include':{'shop':!![]}});if(!_0x46849b){await this[_0x35cb5a(0x228)]?.[_0x35cb5a(0x254)](_0x3c6ff2,_0x35cb5a(0x238)+_0x35cb5a(0x1ae));return;}if(!_0x46849b[_0x35cb5a(0x1d6)]||!_0x46849b[_0x35cb5a(0x1b8)]||!_0x46849b[_0x35cb5a(0x235)]){await this[_0x35cb5a(0x228)]?.['sendMessage'](_0x3c6ff2,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0x35cb5a(0x1c9));return;}await this['bot']?.[_0x35cb5a(0x254)](_0x3c6ff2,_0x35cb5a(0x23c)+(_0x35cb5a(0x202)+_0x46849b[_0x35cb5a(0x235)][_0x35cb5a(0x21c)]+'*\x0a')+('👤\x20Username:\x20`'+_0x46849b[_0x35cb5a(0x235)][_0x35cb5a(0x192)]+'`\x0a')+('📅\x20Connection\x20date:\x20'+_0x46849b['updatedAt'][_0x35cb5a(0x193)]('en-US')+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+_0x35cb5a(0x232)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'});}catch(_0x493ae9){console['error'](_0x35cb5a(0x25c),_0x493ae9),await this[_0x35cb5a(0x228)]?.[_0x35cb5a(0x254)](_0x3c6ff2,_0x35cb5a(0x1e8));}}),this['bot'][_0x32f908(0x196)](/\/debug/,async _0x2450fb=>{const _0x3e1751=_0x32f908,_0x1fdf0=_0x2450fb['chat']['id'],_0x7b3ef0=_0x2450fb[_0x3e1751(0x18e)]?.['id'][_0x3e1751(0x1f7)]();if(!_0x7b3ef0)return;try{const _0x4e5d07=await database_1[_0x3e1751(0x1b1)][_0x3e1751(0x235)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x7e3ee0=_0x3e1751(0x203);_0x7e3ee0+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x7b3ef0+'`\x0a\x0a',_0x7e3ee0+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x4e5d07[_0x3e1751(0x268)]((_0x46b99b,_0x495f8d)=>{const _0xafd7ff=_0x3e1751;_0x7e3ee0+=_0x495f8d+0x1+_0xafd7ff(0x1ca)+_0x46b99b[_0xafd7ff(0x21c)]+'*\x0a',_0x7e3ee0+=_0xafd7ff(0x205)+_0x46b99b[_0xafd7ff(0x192)]+'`\x0a',_0x7e3ee0+='\x20\x20\x20Status:\x20'+_0x46b99b[_0xafd7ff(0x262)]+'\x0a',_0x7e3ee0+=_0xafd7ff(0x1a7)+_0x46b99b[_0xafd7ff(0x1df)][_0xafd7ff(0x251)](0x0,0xf)+'...`\x0a\x0a';}),await this['bot']?.[_0x3e1751(0x254)](_0x1fdf0,_0x7e3ee0,{'parse_mode':_0x3e1751(0x1da)});}catch(_0x39472c){console[_0x3e1751(0x1af)](_0x3e1751(0x19e),_0x39472c),await this[_0x3e1751(0x228)]?.[_0x3e1751(0x254)](_0x1fdf0,_0x3e1751(0x1d4));}}),this[_0x32f908(0x228)]['on'](_0x32f908(0x233),async _0x40fee6=>{const _0x22edc1=_0x32f908;if(_0x40fee6[_0x22edc1(0x1d2)]?.[_0x22edc1(0x1f4)]('/'))return;const _0x23afbf=_0x40fee6[_0x22edc1(0x257)]['id'],_0x463087=_0x40fee6[_0x22edc1(0x18e)]?.['id'][_0x22edc1(0x1f7)](),_0x1563a5=_0x40fee6[_0x22edc1(0x1d2)]?.['trim']();if(!_0x463087||!_0x1563a5)return;try{const _0x218fb7=await database_1[_0x22edc1(0x1b1)]['telegramUser'][_0x22edc1(0x199)]({'where':{'telegramId':_0x463087},'include':{'shop':!![]}});if(!_0x218fb7){await this['bot']?.[_0x22edc1(0x254)](_0x23afbf,_0x22edc1(0x266));return;}if(_0x218fb7[_0x22edc1(0x1d6)]&&_0x218fb7[_0x22edc1(0x1b8)]&&_0x218fb7[_0x22edc1(0x235)]){await this[_0x22edc1(0x228)]?.[_0x22edc1(0x254)](_0x23afbf,_0x22edc1(0x1bd)+_0x218fb7[_0x22edc1(0x235)][_0x22edc1(0x21c)]+_0x22edc1(0x22a)+_0x22edc1(0x22c),{'parse_mode':_0x22edc1(0x1da)});return;}const _0x38b94c=_0x1563a5[_0x22edc1(0x1c8)](/\s+/);if(_0x38b94c[_0x22edc1(0x1e6)]!==0x2){await this[_0x22edc1(0x228)]?.[_0x22edc1(0x254)](_0x23afbf,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x22edc1(0x21f)+'Example:\x0a'+_0x22edc1(0x1fe)+(_0x22edc1(0x1fa)+_0x38b94c[_0x22edc1(0x1e6)]+'\x20parts:\x20'+_0x38b94c[_0x22edc1(0x1b3)](_0x2e987f=>'`'+_0x2e987f+'`')['join'](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x44a99c,_0x4df8f3]=_0x38b94c;console[_0x22edc1(0x21b)]('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x463087+_0x22edc1(0x225)+_0x44a99c+'\x22,\x20apiKey=\x22'+_0x4df8f3[_0x22edc1(0x251)](0x0,0xa)+_0x22edc1(0x1c4)),await this[_0x22edc1(0x23f)](_0x23afbf,_0x463087,_0x44a99c,_0x4df8f3);}catch(_0x2d7ed0){console['error'](_0x22edc1(0x1d5),_0x2d7ed0),await this[_0x22edc1(0x228)]?.[_0x22edc1(0x254)](_0x23afbf,_0x22edc1(0x1e8));}}),this[_0x32f908(0x228)]['on']('error',_0x293e6a=>{const _0x48d173=_0x32f908;console[_0x48d173(0x1af)](_0x48d173(0x231),_0x293e6a);}),this[_0x32f908(0x228)]['on'](_0x32f908(0x214),_0x520e55=>{const _0x5c30f1=_0x32f908;console[_0x5c30f1(0x1af)](_0x5c30f1(0x1a5),_0x520e55);});}async[a54_0x39dd1c(0x23f)](_0x4f4456,_0x1c7801,_0x235a48,_0x1fc38a){const _0x3e39f3=a54_0x39dd1c;try{console['log']('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x1c7801+_0x3e39f3(0x225)+_0x235a48+'\x22,\x20apiKey=\x22'+_0x1fc38a[_0x3e39f3(0x251)](0x0,0xa)+'...\x22');if(!_0x235a48||_0x235a48[_0x3e39f3(0x1e6)]<0x3||_0x235a48['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x3e39f3(0x227)](_0x235a48)){await this[_0x3e39f3(0x228)]?.[_0x3e39f3(0x254)](_0x4f4456,'❌\x20Invalid\x20username\x20format:\x20`'+_0x235a48+_0x3e39f3(0x234)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x3e39f3(0x1da)});return;}if(!_0x1fc38a||!_0x1fc38a['startsWith'](_0x3e39f3(0x23e))&&!_0x1fc38a[_0x3e39f3(0x1f4)](_0x3e39f3(0x194))){await this[_0x3e39f3(0x228)]?.['sendMessage'](_0x4f4456,_0x3e39f3(0x1e5)+_0x3e39f3(0x201),{'parse_mode':_0x3e39f3(0x1da)});return;}const _0x45172f=await database_1['default'][_0x3e39f3(0x235)][_0x3e39f3(0x199)]({'where':{'username':_0x235a48},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x45172f){const _0x3065a5=await database_1[_0x3e39f3(0x1b1)]['shop'][_0x3e39f3(0x188)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x3cf952='❌\x20Shop\x20with\x20username\x20`'+_0x235a48+_0x3e39f3(0x1ff);_0x3065a5[_0x3e39f3(0x1e6)]>0x0?(_0x3cf952+=_0x3e39f3(0x221),_0x3065a5[_0x3e39f3(0x268)](_0x2b116f=>{const _0x18c473=_0x3e39f3;_0x3cf952+=_0x18c473(0x1bf)+_0x2b116f[_0x18c473(0x192)]+_0x18c473(0x255)+_0x2b116f['name']+')\x0a';}),_0x3cf952+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x3cf952+=_0x3e39f3(0x1cb);await this['bot']?.[_0x3e39f3(0x254)](_0x4f4456,_0x3cf952,{'parse_mode':'Markdown'});return;}if(_0x45172f['status']!==_0x3e39f3(0x22d)){await this[_0x3e39f3(0x228)]?.['sendMessage'](_0x4f4456,_0x3e39f3(0x1a0)+_0x235a48+'`\x20is\x20inactive.\x0a\x0a'+'Contact\x20administrator.',{'parse_mode':_0x3e39f3(0x1da)});return;}if(_0x45172f['publicKey']!==_0x1fc38a&&_0x45172f[_0x3e39f3(0x19a)]!==_0x1fc38a){await this['bot']?.[_0x3e39f3(0x254)](_0x4f4456,_0x3e39f3(0x1d9)+_0x235a48+_0x3e39f3(0x1ed)+_0x3e39f3(0x1f9)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':_0x3e39f3(0x1da)});return;}const _0x263a2f=await database_1['default'][_0x3e39f3(0x258)][_0x3e39f3(0x1d3)]({'where':{'shopId':_0x45172f['id'],'isVerified':!![],'telegramId':{'not':_0x1c7801}}});if(_0x263a2f){await this[_0x3e39f3(0x228)]?.[_0x3e39f3(0x254)](_0x4f4456,_0x3e39f3(0x1a2)+_0x235a48+_0x3e39f3(0x1ed)+_0x3e39f3(0x1b5),{'parse_mode':_0x3e39f3(0x1da)});return;}await database_1[_0x3e39f3(0x1b1)][_0x3e39f3(0x258)]['update']({'where':{'telegramId':_0x1c7801},'data':{'shopId':_0x45172f['id'],'isVerified':!![]}}),await this[_0x3e39f3(0x228)]?.['sendMessage'](_0x4f4456,_0x3e39f3(0x1e2)+_0x3e39f3(0x18c)+(_0x3e39f3(0x1f0)+_0x45172f[_0x3e39f3(0x21c)]+'*\x0a')+(_0x3e39f3(0x18b)+_0x45172f[_0x3e39f3(0x192)]+_0x3e39f3(0x234))+_0x3e39f3(0x19f)+_0x3e39f3(0x1cf)+_0x3e39f3(0x1de)+_0x3e39f3(0x269)+'•\x20Important\x20events\x0a\x0a'+_0x3e39f3(0x232)+_0x3e39f3(0x191)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x3e39f3(0x1da)}),console[_0x3e39f3(0x21b)](_0x3e39f3(0x244)+_0x1c7801+_0x3e39f3(0x265)+_0x45172f[_0x3e39f3(0x192)]+'\x20via\x20single-line\x20input');}catch(_0x12903f){console['error'](_0x3e39f3(0x1f8),_0x12903f),await this[_0x3e39f3(0x228)]?.[_0x3e39f3(0x254)](_0x4f4456,_0x3e39f3(0x1dc));}}async[a54_0x39dd1c(0x1a6)](_0x34e94d,_0x198960,_0x492012){const _0x36fcc8=a54_0x39dd1c;if(!this[_0x36fcc8(0x228)]){console[_0x36fcc8(0x1e9)](_0x36fcc8(0x23d));return;}try{const _0x476f28=await database_1[_0x36fcc8(0x1b1)][_0x36fcc8(0x258)]['findMany']({'where':{'shopId':_0x34e94d,'isVerified':!![]}});if(_0x476f28['length']===0x0){console[_0x36fcc8(0x21b)](_0x36fcc8(0x1b0)+_0x34e94d);return;}const _0x49b4f4=_0x476f28[_0x36fcc8(0x1b3)](async _0x4a9698=>{const _0x287659=_0x36fcc8;try{await this[_0x287659(0x228)]?.['sendMessage'](_0x4a9698['telegramId'],_0x198960,_0x492012),console[_0x287659(0x21b)](_0x287659(0x1fd)+_0x4a9698[_0x287659(0x1a9)]);}catch(_0x57bafc){console[_0x287659(0x1af)](_0x287659(0x259)+_0x4a9698['telegramId']+':',_0x57bafc),_0x57bafc instanceof Error&&(_0x57bafc['message']['includes']('blocked')||_0x57bafc[_0x287659(0x233)][_0x287659(0x22e)](_0x287659(0x25d))||_0x57bafc[_0x287659(0x233)][_0x287659(0x22e)](_0x287659(0x267)))&&(await database_1[_0x287659(0x1b1)][_0x287659(0x258)][_0x287659(0x1dd)]({'where':{'id':_0x4a9698['id']},'data':{'isVerified':![]}}),console[_0x287659(0x21b)]('User\x20'+_0x4a9698[_0x287659(0x1a9)]+_0x287659(0x18a)));}});await Promise[_0x36fcc8(0x245)](_0x49b4f4);}catch(_0x22dcd0){console[_0x36fcc8(0x1af)]('Error\x20sending\x20shop\x20notification:',_0x22dcd0);}}async[a54_0x39dd1c(0x1f2)](_0x30eead,_0x499889,_0xccc07e){const _0x302e45=a54_0x39dd1c,_0x495fd0={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x427f3d={'created':_0x302e45(0x1c5),'paid':_0x302e45(0x224),'failed':_0x302e45(0x1e4),'expired':_0x302e45(0x1d0),'refund':_0x302e45(0x25f),'chargeback':_0x302e45(0x190),'processing':_0x302e45(0x264)},_0x230345=_0x495fd0[_0xccc07e],_0x12adad=_0x427f3d[_0xccc07e],_0x54763d=(0x0,gateway_1[_0x302e45(0x207)])(_0x499889['gateway']);console[_0x302e45(0x21b)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x499889[_0x302e45(0x261)]+_0x302e45(0x19b)+_0x54763d+'\x22');let _0x467d44=_0x230345+'\x20*'+_0x12adad+_0x302e45(0x24d)+(_0x302e45(0x1c2)+_0x499889['amount']+'\x20'+_0x499889[_0x302e45(0x1a8)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x499889[_0x302e45(0x1be)]||_0x499889['id'])+'`\x0a')+(_0x302e45(0x208)+_0x499889['id']+'`\x0a')+(_0x302e45(0x1b7)+_0x54763d+'`\x0a')+(_0x302e45(0x248)+new Date(_0x499889[_0x302e45(0x241)])['toLocaleString'](_0x302e45(0x20b))+'\x0a');if(_0x499889[_0x302e45(0x1f5)]||_0x499889[_0x302e45(0x24e)]||_0x499889[_0x302e45(0x253)]||_0x499889[_0x302e45(0x198)]||_0x499889[_0x302e45(0x256)]){_0x467d44+=_0x302e45(0x206);_0x499889[_0x302e45(0x1f5)]&&(_0x467d44+=_0x302e45(0x21d)+_0x499889[_0x302e45(0x1f5)]+'`\x0a');_0x499889['customerEmail']&&(_0x467d44+=_0x302e45(0x1e7)+_0x499889[_0x302e45(0x24e)]+'`\x0a');_0x499889[_0x302e45(0x253)]&&(_0x467d44+=_0x302e45(0x1c1)+_0x499889[_0x302e45(0x253)]+'`\x0a');_0x499889['customerIp']&&(_0x467d44+='🌐\x20IP:\x20`'+_0x499889['customerIp']+'`\x0a');if(_0x499889[_0x302e45(0x256)]){const _0x580527=_0x499889[_0x302e45(0x256)][_0x302e45(0x1e6)]>0x32?_0x499889['customerUa'][_0x302e45(0x251)](0x0,0x32)+_0x302e45(0x1fb):_0x499889['customerUa'];_0x467d44+=_0x302e45(0x1ad)+_0x580527+'`\x0a';}}_0xccc07e===_0x302e45(0x1ea)&&_0x499889['chargebackAmount']&&(_0x467d44+='💸\x20Penalty\x20amount:\x20*'+_0x499889[_0x302e45(0x1f1)]+'\x20USDT*\x0a'),_0xccc07e===_0x302e45(0x1b4)&&(_0x467d44+=_0x302e45(0x220)),_0x499889[_0x302e45(0x209)]&&(_0x467d44+=_0x302e45(0x260)+_0x499889[_0x302e45(0x209)]+'\x0a'),await this[_0x302e45(0x1a6)](_0x30eead,_0x467d44,{'parse_mode':'Markdown'});}async[a54_0x39dd1c(0x1cd)](_0x37e929,_0x2353e8,_0x103b5b){const _0x3755ef=a54_0x39dd1c,_0x23c9ad={'created':'📤','completed':'✅','rejected':'❌'},_0x4adba8={'created':_0x3755ef(0x223),'completed':_0x3755ef(0x1c7),'rejected':'Payout\x20rejected'},_0x3f5e74=_0x23c9ad[_0x103b5b],_0x4de53b=_0x4adba8[_0x103b5b],_0x52b234=_0x3f5e74+'\x20*'+_0x4de53b+'*\x0a\x0a'+(_0x3755ef(0x263)+_0x2353e8['amount']+'\x20USD*\x0a')+(_0x3755ef(0x1cc)+_0x2353e8[_0x3755ef(0x1b9)]+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x2353e8['id']+'`\x0a')+(_0x3755ef(0x248)+new Date(_0x2353e8['createdAt'])['toLocaleString'](_0x3755ef(0x20b))+'\x0a')+(_0x2353e8[_0x3755ef(0x1ec)]?_0x3755ef(0x240)+_0x2353e8[_0x3755ef(0x1ec)]+'`':'');await this[_0x3755ef(0x1a6)](_0x37e929,_0x52b234,{'parse_mode':_0x3755ef(0x1da)});}async[a54_0x39dd1c(0x26a)](_0x10d5cb,_0x122538){const _0x3ab454=a54_0x39dd1c;try{const _0x2f9e37=await database_1[_0x3ab454(0x1b1)]['shopSettings'][_0x3ab454(0x199)]({'where':{'shopId':_0x10d5cb},'select':{'notificationLogin':!![]}});if(!_0x2f9e37?.[_0x3ab454(0x1a3)]){console[_0x3ab454(0x21b)](_0x3ab454(0x22f)+_0x10d5cb);return;}const _0x106e1f=_0x122538['success']?'🔐':'🚨',_0x4ae98b=_0x122538[_0x3ab454(0x19d)]?_0x3ab454(0x1d8):'Failed\x20login\x20attempt';let _0x15364d=_0x106e1f+'\x20*'+_0x4ae98b+_0x3ab454(0x24d)+('👤\x20Username:\x20`'+_0x122538[_0x3ab454(0x192)]+'`\x0a')+(_0x3ab454(0x1e3)+_0x122538[_0x3ab454(0x246)][_0x3ab454(0x24c)](_0x3ab454(0x20b))+'\x0a');_0x122538[_0x3ab454(0x242)]&&(_0x15364d+='🌐\x20IP\x20address:\x20`'+_0x122538['ipAddress']+'`\x0a');if(_0x122538['userAgent']){const _0x11bcc5=_0x122538[_0x3ab454(0x1ce)][_0x3ab454(0x1e6)]>0x32?_0x122538['userAgent'][_0x3ab454(0x251)](0x0,0x32)+_0x3ab454(0x1fb):_0x122538[_0x3ab454(0x1ce)];_0x15364d+=_0x3ab454(0x1ad)+_0x11bcc5+'`\x0a';}!_0x122538[_0x3ab454(0x19d)]&&(_0x15364d+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this[_0x3ab454(0x1a6)](_0x10d5cb,_0x15364d,{'parse_mode':_0x3ab454(0x1da)}),console[_0x3ab454(0x21b)](_0x3ab454(0x195)+_0x10d5cb+':\x20'+(_0x122538[_0x3ab454(0x19d)]?_0x3ab454(0x19d):_0x3ab454(0x189)));}catch(_0x21503d){console[_0x3ab454(0x1af)](_0x3ab454(0x25a),_0x21503d);}}async[a54_0x39dd1c(0x1eb)](_0x300f65,_0x234011){const _0x2ec785=a54_0x39dd1c;try{const _0x4a1680=await database_1[_0x2ec785(0x1b1)][_0x2ec785(0x21e)][_0x2ec785(0x199)]({'where':{'shopId':_0x300f65},'select':{'notificationApiError':!![]}});if(!_0x4a1680?.[_0x2ec785(0x237)]){console[_0x2ec785(0x21b)]('📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x300f65);return;}let _0x33cd1c=_0x2ec785(0x236)+(_0x2ec785(0x213)+_0x234011[_0x2ec785(0x1b9)]+'\x20'+_0x234011[_0x2ec785(0x25e)]+'`\x0a')+(_0x2ec785(0x1e3)+_0x234011[_0x2ec785(0x246)][_0x2ec785(0x24c)](_0x2ec785(0x20b))+'\x0a');_0x234011[_0x2ec785(0x249)]&&(_0x33cd1c+=_0x2ec785(0x22b)+_0x234011[_0x2ec785(0x249)]+'`\x0a'),_0x33cd1c+='❌\x20Error:\x20`'+_0x234011[_0x2ec785(0x19c)]+'`\x0a',_0x234011[_0x2ec785(0x219)]&&(_0x33cd1c+=_0x2ec785(0x1b6)+_0x234011['requestId']+'`\x0a'),_0x33cd1c+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x2ec785(0x1a6)](_0x300f65,_0x33cd1c,{'parse_mode':'Markdown'}),console[_0x2ec785(0x21b)](_0x2ec785(0x20e)+_0x300f65+':\x20'+_0x234011[_0x2ec785(0x25e)]);}catch(_0x267122){console[_0x2ec785(0x1af)](_0x2ec785(0x20c),_0x267122);}}async[a54_0x39dd1c(0x1db)](_0x488a7d,_0x3c2d94,_0x4b7006){const _0x3a5569=a54_0x39dd1c;let _0x187b34='🔔\x20*'+_0x3c2d94+_0x3a5569(0x24d);for(const [_0x3812d1,_0x947f02]of Object[_0x3a5569(0x24b)](_0x4b7006)){_0x947f02!==null&&_0x947f02!==undefined&&(_0x187b34+=_0x3812d1+_0x3a5569(0x218)+_0x947f02+'`\x0a');}await this[_0x3a5569(0x1a6)](_0x488a7d,_0x187b34,{'parse_mode':_0x3a5569(0x1da)});}[a54_0x39dd1c(0x1e0)](){const _0x57004b=a54_0x39dd1c;return{'isActive':!!this[_0x57004b(0x228)],'username':this[_0x57004b(0x1a4)]};}[a54_0x39dd1c(0x1c6)](){const _0x295199=a54_0x39dd1c;this[_0x295199(0x228)]&&(this[_0x295199(0x228)][_0x295199(0x1e1)](),this['bot']=null,console[_0x295199(0x21b)](_0x295199(0x200)));}}exports[a54_0x39dd1c(0x1ba)]=TelegramBotService,exports[a54_0x39dd1c(0x21a)]=new TelegramBotService();