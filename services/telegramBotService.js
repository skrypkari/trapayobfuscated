'use strict';const a66_0xf4c92a=a66_0x10cb;function a66_0x2776(){const _0x3113f6=['chargeback',':\x20`','Payment\x20chargeback','\x20parts:\x20','includes','\x0a👤\x20*Customer\x20Information:*\x0a','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','publicKey','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','method','forEach','•\x20Payouts\x0a\x0a','log','Error\x20in\x20handleSingleLineVerification:','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','image/png','❌\x20Telegram\x20bot\x20not\x20initialized','.pdf','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','`.\x0a\x0a','sendShopNotification','user\x20is\x20deactivated','•\x20`','❌\x20Please\x20use\x20/start\x20command\x20first','update','📅\x20Connection\x20date:\x20','16wGhSUl','\x22,\x20apiKey=\x22','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','length','error','Failed\x20to\x20send\x20API\x20error\x20notification:','Username:\x20`','notificationLogin','Example:\x0a','adminNotes','🔔\x20*','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','warn','199482byrkLQ','../types/gateway','customerEmail','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','❌\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','🔍\x20*Debug\x20Information*\x0a\x0a','👤\x20Username:\x20`','\x20verified\x20for\x20shop\x20','sendApiErrorNotification','notificationApiError','.jpg','Error\x20handling\x20message:','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Failed\x20login\x20attempt','sendDirectFile','Check\x20spelling\x20and\x20try\x20again.','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','1902659KzVHqR','polling_error','💰\x20Amount:\x20*','getGatewayDisplayNameForTelegram','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','📱\x20Shop:\x20*','endsWith','../config/database','orderId','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','setupBotHandlers','TelegramBotService','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','\x20(@','botUsername','en-US','timestamp','📱\x20No\x20active\x20Telegram\x20users\x20found','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Contact\x20administrator.','`\x20(','findFirst','✅\x20Welcome\x20back!\x0a\x0a','New\x20payment\x20created','bot','txid','✅\x20File\x20sent\x20to\x20','1843400YWoZUj','\x22\x20->\x20display\x20\x22','TELEGRAM_BOT_TOKEN','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','allSettled','*\x0a\x0a','🛑\x20Telegram\x20bot\x20stopped','•\x20New\x20payments\x0a','stopPolling','📝\x20Order\x20ID:\x20`','1461715ZnQvAC','...`\x0a\x0a',':\x20username=\x22','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','handleSingleLineVerification','chat','map','❌\x20Invalid\x20username\x20format:\x20`','findMany','🏦\x20IBAN:\x20`','shop','.\x20*','customerIp','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','telegramUser','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','default','entries','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','\x0aCheck\x20spelling\x20and\x20try\x20again.','defineProperty','📱\x20Your\x20Telegram\x20ID:\x20`','*.\x0a\x0a','You\x20sent\x20','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','•\x20Payment\x20status\x20changes\x0a','gateway','secretKey','customerUa','node-telegram-bot-api','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','toLocaleDateString','630kOvuTm','startsWith','env','Error\x20sending\x20shop\x20notification:','🏪\x20Gateway:\x20`','`\x20not\x20found.\x0a\x0a','•\x20Payouts\x0a','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','split','application/octet-stream','Successful\x20login','text','message','✅\x20Telegram\x20bot\x20@','sendDirectMessage','currency','10832ySomAg','✅\x20Connected\x20to\x20shop:\x20*','create','chargebackAmount','remitterIban','\x20users','🌐\x20IP\x20address:\x20`','📅\x20Date:\x20','.jpeg','/disconnect\x20-\x20disconnect\x20from\x20notifications','❌\x20Error:\x20`','errorMessage','username','success','trim','name','failed','...','📱\x20Notification\x20sent\x20to\x20','status','2382993LfyUCA','🆔\x20Payment\x20ID:\x20`','❌\x20Error\x20sending\x20file\x20to\x20chat:','Error\x20handling\x20/status\x20command:','Payment\x20failed','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','requestId','pk_','initializeBot','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','❌\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','📊\x20Error\x20code:\x20`','sendMessage','❌\x20Error\x20getting\x20debug\x20information.','Payment\x20refund','toLocaleString','/status\x20-\x20check\x20connection\x20status\x0a','✅\x20Telegram\x20user\x20','📱\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','test','📅\x20Time:\x20','amount','25397kQhNdf','toString','\x20\x20\x20Public\x20Key:\x20`','sendDocument','6aojZIH','Markdown','🆔\x20Payout\x20ID:\x20`','🔌\x20User\x20','findUnique','🆔\x20Request\x20ID:\x20`','Payment\x20is\x20being\x20processed','image/jpeg','\x20\x20\x20Status:\x20','...\x22','from','sendPaymentNotification','customerName','__esModule','endpoint','Payout\x20rejected','Available\x20usernames:\x0a','Payout\x20completed','Payment\x20successfully\x20paid','processing','🔗\x20TXID:\x20`','Failed\x20to\x20send\x20login\x20notification:','__importDefault','🎉\x20*Congratulations!*\x0a\x0a','botToken','telegramId','statusCode','❌\x20Error\x20sending\x20direct\x20message:','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','🔔\x20Notifications\x20are\x20active\x0a\x0a','`\x0a\x0a','New\x20payout\x20created','\x20\x20\x20Username:\x20`','shopSettings','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','📛\x20Name:\x20`','📱\x20Created\x20new\x20Telegram\x20user:\x20','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','❌\x20Shop\x20with\x20username\x20`','12byXQvR','shopId','onText','\x20via\x20single-line\x20input','createdAt','last_name','isVerified','💻\x20Browser:\x20`','telegramBotService','substring','userAgent'];a66_0x2776=function(){return _0x3113f6;};return a66_0x2776();}(function(_0x2f6528,_0x363ef2){const _0x38fb1f=a66_0x10cb,_0x18e32c=_0x2f6528();while(!![]){try{const _0x22ec4d=parseInt(_0x38fb1f(0xb1))/0x1*(parseInt(_0x38fb1f(0xdc))/0x2)+parseInt(_0x38fb1f(0x10e))/0x3*(-parseInt(_0x38fb1f(0x101))/0x4)+-parseInt(_0x38fb1f(0x144))/0x5*(parseInt(_0x38fb1f(0xb5))/0x6)+-parseInt(_0x38fb1f(0x166))/0x7*(-parseInt(_0x38fb1f(0x87))/0x8)+parseInt(_0x38fb1f(0x9b))/0x9+parseInt(_0x38fb1f(0x13a))/0xa+parseInt(_0x38fb1f(0x11f))/0xb;if(_0x22ec4d===_0x363ef2)break;else _0x18e32c['push'](_0x18e32c['shift']());}catch(_0x480e83){_0x18e32c['push'](_0x18e32c['shift']());}}}(a66_0x2776,0x52859));var __importDefault=this&&this[a66_0xf4c92a(0xcb)]||function(_0x1f5417){const _0x137426=a66_0xf4c92a;return _0x1f5417&&_0x1f5417[_0x137426(0xc2)]?_0x1f5417:{'default':_0x1f5417};};Object[a66_0xf4c92a(0x159)](exports,a66_0xf4c92a(0xc2),{'value':!![]}),exports[a66_0xf4c92a(0xe4)]=exports[a66_0xf4c92a(0x12a)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a66_0xf4c92a(0x163))),database_1=__importDefault(require(a66_0xf4c92a(0x126))),gateway_1=require(a66_0xf4c92a(0x10f));function a66_0x10cb(_0x302f46,_0x2158aa){const _0x277610=a66_0x2776();return a66_0x10cb=function(_0x10cbe3,_0x17c9e7){_0x10cbe3=_0x10cbe3-0x80;let _0x21022f=_0x277610[_0x10cbe3];return _0x21022f;},a66_0x10cb(_0x302f46,_0x2158aa);}class TelegramBotService{constructor(){const _0x4fd186=a66_0xf4c92a;this[_0x4fd186(0x137)]=null,this[_0x4fd186(0xcd)]=process['env'][_0x4fd186(0x13c)]||'',this['botUsername']=process[_0x4fd186(0x168)]['TELEGRAM_BOT_USERNAME']||'trapay_bot',this[_0x4fd186(0xcd)]?this[_0x4fd186(0xa3)]():console[_0x4fd186(0x10d)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a66_0xf4c92a(0xa3)](){const _0x5939fc=a66_0xf4c92a;try{this[_0x5939fc(0x137)]=new node_telegram_bot_api_1[(_0x5939fc(0x154))](this[_0x5939fc(0xcd)],{'polling':!![]}),this[_0x5939fc(0x129)](),console['log'](_0x5939fc(0x84)+this[_0x5939fc(0x12d)]+'\x20initialized\x20successfully');}catch(_0x204b15){console[_0x5939fc(0x105)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x204b15);}}[a66_0xf4c92a(0x129)](){const _0x504f18=a66_0xf4c92a;if(!this['bot'])return;this['bot'][_0x504f18(0xde)](/\/start/,async _0x5a1d7e=>{const _0x1104af=_0x504f18,_0x495a57=_0x5a1d7e[_0x1104af(0x149)]['id'],_0x2638eb=_0x5a1d7e[_0x1104af(0xbf)]?.['id'][_0x1104af(0xb2)](),_0xb4a069=_0x5a1d7e[_0x1104af(0xbf)]?.[_0x1104af(0x93)],_0x4719bc=_0x5a1d7e[_0x1104af(0xbf)]?.['first_name'],_0x4f14be=_0x5a1d7e[_0x1104af(0xbf)]?.[_0x1104af(0xe1)];if(!_0x2638eb)return;try{let _0x1ca32c=await database_1[_0x1104af(0x154)][_0x1104af(0x152)][_0x1104af(0xb9)]({'where':{'telegramId':_0x2638eb},'include':{'shop':!![]}});!_0x1ca32c?(_0x1ca32c=await database_1[_0x1104af(0x154)]['telegramUser'][_0x1104af(0x89)]({'data':{'telegramId':_0x2638eb,'username':_0xb4a069,'firstName':_0x4719bc,'lastName':_0x4f14be,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x1104af(0xf3)](_0x1104af(0xd9)+_0x2638eb+_0x1104af(0x12c)+_0xb4a069+')')):_0x1ca32c=await database_1[_0x1104af(0x154)][_0x1104af(0x152)][_0x1104af(0xff)]({'where':{'telegramId':_0x2638eb},'data':{'username':_0xb4a069,'firstName':_0x4719bc,'lastName':_0x4f14be},'include':{'shop':!![]}}),_0x1ca32c['isVerified']&&_0x1ca32c[_0x1104af(0xdd)]&&_0x1ca32c[_0x1104af(0x14e)]?await this[_0x1104af(0x137)]?.[_0x1104af(0xa7)](_0x495a57,_0x1104af(0x135)+(_0x1104af(0xa4)+_0x1ca32c[_0x1104af(0x14e)]['name']+'*\x0a')+(_0x1104af(0x107)+_0x1ca32c[_0x1104af(0x14e)][_0x1104af(0x93)]+_0x1104af(0xd3))+_0x1104af(0x131)+'•\x20New\x20payments\x0a'+_0x1104af(0x15f)+_0x1104af(0xf2)+'Commands:\x0a'+'/status\x20-\x20check\x20connection\x20status\x0a'+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x1104af(0xb6)}):(_0x1ca32c[_0x1104af(0xdd)]&&!_0x1ca32c['isVerified']&&(await database_1[_0x1104af(0x154)][_0x1104af(0x152)][_0x1104af(0xff)]({'where':{'telegramId':_0x2638eb},'data':{'shopId':null,'isVerified':![]}}),console['log']('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x2638eb)),await this['bot']?.[_0x1104af(0xa7)](_0x495a57,_0x1104af(0x123)+_0x1104af(0x103)+_0x1104af(0xd1)+_0x1104af(0x109)+_0x1104af(0xda)+_0x1104af(0x153),{'parse_mode':_0x1104af(0xb6)}));}catch(_0x406da5){console[_0x1104af(0x105)]('Error\x20handling\x20/start\x20command:',_0x406da5),await this[_0x1104af(0x137)]?.['sendMessage'](_0x495a57,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x504f18(0x137)][_0x504f18(0xde)](/\/disconnect/,async _0x3f2b9d=>{const _0x3b21da=_0x504f18,_0x169a53=_0x3f2b9d[_0x3b21da(0x149)]['id'],_0x414644=_0x3f2b9d[_0x3b21da(0xbf)]?.['id']['toString']();if(!_0x414644)return;try{const _0x29d3a5=await database_1['default'][_0x3b21da(0x152)][_0x3b21da(0xb9)]({'where':{'telegramId':_0x414644},'include':{'shop':!![]}});if(!_0x29d3a5||!_0x29d3a5[_0x3b21da(0xe2)]||!_0x29d3a5[_0x3b21da(0xdd)]){await this[_0x3b21da(0x137)]?.[_0x3b21da(0xa7)](_0x169a53,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x1c73a4=_0x29d3a5[_0x3b21da(0x14e)]?.['name']||'unknown\x20shop';await database_1['default']['telegramUser']['update']({'where':{'telegramId':_0x414644},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x3b21da(0xb8)+_0x414644+'\x20disconnected\x20from\x20shop\x20'+_0x29d3a5[_0x3b21da(0xdd)]),await this[_0x3b21da(0x137)]?.['sendMessage'](_0x169a53,_0x3b21da(0x164)+_0x1c73a4+'*.\x0a\x0a'+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x3b21da(0xb6)});}catch(_0x3a211d){console[_0x3b21da(0x105)]('Error\x20handling\x20/disconnect\x20command:',_0x3a211d),await this[_0x3b21da(0x137)]?.[_0x3b21da(0xa7)](_0x169a53,_0x3b21da(0x13d));}}),this['bot']['onText'](/\/status/,async _0x18534e=>{const _0x1b3b8f=_0x504f18,_0x11464b=_0x18534e[_0x1b3b8f(0x149)]['id'],_0x461909=_0x18534e['from']?.['id']['toString']();if(!_0x461909)return;try{const _0x159f67=await database_1['default'][_0x1b3b8f(0x152)][_0x1b3b8f(0xb9)]({'where':{'telegramId':_0x461909},'include':{'shop':!![]}});if(!_0x159f67){await this[_0x1b3b8f(0x137)]?.[_0x1b3b8f(0xa7)](_0x11464b,_0x1b3b8f(0xef)+'Use\x20/start\x20to\x20begin.');return;}if(!_0x159f67[_0x1b3b8f(0xe2)]||!_0x159f67[_0x1b3b8f(0xdd)]||!_0x159f67[_0x1b3b8f(0x14e)]){await this['bot']?.['sendMessage'](_0x11464b,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+'Use\x20/start\x20to\x20connect.');return;}await this['bot']?.[_0x1b3b8f(0xa7)](_0x11464b,'📊\x20*Connection\x20Status*\x0a\x0a'+(_0x1b3b8f(0x88)+_0x159f67[_0x1b3b8f(0x14e)][_0x1b3b8f(0x96)]+'*\x0a')+(_0x1b3b8f(0x114)+_0x159f67[_0x1b3b8f(0x14e)][_0x1b3b8f(0x93)]+'`\x0a')+(_0x1b3b8f(0x100)+_0x159f67['updatedAt'][_0x1b3b8f(0x165)]('en-US')+'\x0a\x0a')+_0x1b3b8f(0xd2)+'Commands:\x0a'+_0x1b3b8f(0x90),{'parse_mode':_0x1b3b8f(0xb6)});}catch(_0x243ea9){console[_0x1b3b8f(0x105)](_0x1b3b8f(0x9e),_0x243ea9),await this[_0x1b3b8f(0x137)]?.['sendMessage'](_0x11464b,_0x1b3b8f(0x13d));}}),this[_0x504f18(0x137)][_0x504f18(0xde)](/\/debug/,async _0x567504=>{const _0x5d809f=_0x504f18,_0x375357=_0x567504['chat']['id'],_0x1e7716=_0x567504['from']?.['id'][_0x5d809f(0xb2)]();if(!_0x1e7716)return;try{const _0x23c7c9=await database_1[_0x5d809f(0x154)][_0x5d809f(0x14e)][_0x5d809f(0x14c)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x5e8e28=_0x5d809f(0x113);_0x5e8e28+=_0x5d809f(0x15a)+_0x1e7716+_0x5d809f(0xd3),_0x5e8e28+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x23c7c9[_0x5d809f(0xf1)]((_0x5f1563,_0x1ff57c)=>{const _0x1bf568=_0x5d809f;_0x5e8e28+=_0x1ff57c+0x1+_0x1bf568(0x14f)+_0x5f1563[_0x1bf568(0x96)]+'*\x0a',_0x5e8e28+=_0x1bf568(0xd5)+_0x5f1563[_0x1bf568(0x93)]+'`\x0a',_0x5e8e28+=_0x1bf568(0xbd)+_0x5f1563[_0x1bf568(0x9a)]+'\x0a',_0x5e8e28+=_0x1bf568(0xb3)+_0x5f1563[_0x1bf568(0xee)]['substring'](0x0,0xf)+_0x1bf568(0x145);}),await this[_0x5d809f(0x137)]?.[_0x5d809f(0xa7)](_0x375357,_0x5e8e28,{'parse_mode':_0x5d809f(0xb6)});}catch(_0x2f3d1c){console[_0x5d809f(0x105)]('Error\x20handling\x20/debug\x20command:',_0x2f3d1c),await this[_0x5d809f(0x137)]?.['sendMessage'](_0x375357,_0x5d809f(0xa8));}}),this[_0x504f18(0x137)]['on']('message',async _0x479479=>{const _0x202063=_0x504f18;if(_0x479479[_0x202063(0x82)]?.[_0x202063(0x167)]('/'))return;const _0x5d6226=_0x479479[_0x202063(0x149)]['id'],_0x2c4f31=_0x479479[_0x202063(0xbf)]?.['id'][_0x202063(0xb2)](),_0x30e1ae=_0x479479[_0x202063(0x82)]?.[_0x202063(0x95)]();if(!_0x2c4f31||!_0x30e1ae)return;try{const _0x4e94c6=await database_1['default'][_0x202063(0x152)][_0x202063(0xb9)]({'where':{'telegramId':_0x2c4f31},'include':{'shop':!![]}});if(!_0x4e94c6){await this[_0x202063(0x137)]?.[_0x202063(0xa7)](_0x5d6226,_0x202063(0xfe));return;}if(_0x4e94c6[_0x202063(0xe2)]&&_0x4e94c6['shopId']&&_0x4e94c6['shop']){await this[_0x202063(0x137)]?.[_0x202063(0xa7)](_0x5d6226,_0x202063(0x16d)+_0x4e94c6[_0x202063(0x14e)][_0x202063(0x96)]+_0x202063(0x15b)+'Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.',{'parse_mode':_0x202063(0xb6)});return;}const _0x3a0240=_0x30e1ae[_0x202063(0x16e)](/\s+/);if(_0x3a0240[_0x202063(0x104)]!==0x2){await this['bot']?.[_0x202063(0xa7)](_0x5d6226,_0x202063(0x128)+_0x202063(0xd1)+'Example:\x0a'+_0x202063(0xda)+(_0x202063(0x15c)+_0x3a0240[_0x202063(0x104)]+_0x202063(0xea)+_0x3a0240[_0x202063(0x14a)](_0x4b6bd3=>'`'+_0x4b6bd3+'`')['join'](',\x20')),{'parse_mode':_0x202063(0xb6)});return;}const [_0x52b583,_0x4a6921]=_0x3a0240;console[_0x202063(0xf3)](_0x202063(0x157)+_0x2c4f31+_0x202063(0x146)+_0x52b583+_0x202063(0x102)+_0x4a6921[_0x202063(0xe5)](0x0,0xa)+_0x202063(0xbe)),await this[_0x202063(0x148)](_0x5d6226,_0x2c4f31,_0x52b583,_0x4a6921);}catch(_0x50aae0){console[_0x202063(0x105)](_0x202063(0x119),_0x50aae0),await this[_0x202063(0x137)]?.[_0x202063(0xa7)](_0x5d6226,_0x202063(0x13d));}}),this[_0x504f18(0x137)]['on'](_0x504f18(0x105),_0x1d00cb=>{const _0x5dedaf=_0x504f18;console[_0x5dedaf(0x105)]('Telegram\x20bot\x20error:',_0x1d00cb);}),this[_0x504f18(0x137)]['on'](_0x504f18(0x120),_0xe78014=>{const _0x5201d7=_0x504f18;console[_0x5201d7(0x105)]('Telegram\x20bot\x20polling\x20error:',_0xe78014);});}async[a66_0xf4c92a(0x148)](_0x1e4736,_0x1a9e1f,_0xa0ca77,_0x13a7c6){const _0x2af1d7=a66_0xf4c92a;try{console['log'](_0x2af1d7(0x157)+_0x1a9e1f+':\x20username=\x22'+_0xa0ca77+'\x22,\x20apiKey=\x22'+_0x13a7c6[_0x2af1d7(0xe5)](0x0,0xa)+_0x2af1d7(0xbe));if(!_0xa0ca77||_0xa0ca77['length']<0x3||_0xa0ca77[_0x2af1d7(0x104)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x2af1d7(0xae)](_0xa0ca77)){await this['bot']?.[_0x2af1d7(0xa7)](_0x1e4736,_0x2af1d7(0x14b)+_0xa0ca77+_0x2af1d7(0xd3)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x2af1d7(0xb6)});return;}if(!_0x13a7c6||!_0x13a7c6[_0x2af1d7(0x167)](_0x2af1d7(0xa2))&&!_0x13a7c6[_0x2af1d7(0x167)]('sk_')){await this['bot']?.[_0x2af1d7(0xa7)](_0x1e4736,_0x2af1d7(0x11e)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':'Markdown'});return;}const _0x525c72=await database_1[_0x2af1d7(0x154)][_0x2af1d7(0x14e)][_0x2af1d7(0xb9)]({'where':{'username':_0xa0ca77},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x525c72){const _0x34537a=await database_1[_0x2af1d7(0x154)][_0x2af1d7(0x14e)][_0x2af1d7(0x14c)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x39c0c5=_0x2af1d7(0xdb)+_0xa0ca77+_0x2af1d7(0x16b);_0x34537a[_0x2af1d7(0x104)]>0x0?(_0x39c0c5+=_0x2af1d7(0xc5),_0x34537a[_0x2af1d7(0xf1)](_0x4f4658=>{const _0x5d60a4=_0x2af1d7;_0x39c0c5+=_0x5d60a4(0xfd)+_0x4f4658[_0x5d60a4(0x93)]+_0x5d60a4(0x133)+_0x4f4658[_0x5d60a4(0x96)]+')\x0a';}),_0x39c0c5+=_0x2af1d7(0x158)):_0x39c0c5+=_0x2af1d7(0x11d);await this['bot']?.['sendMessage'](_0x1e4736,_0x39c0c5,{'parse_mode':'Markdown'});return;}if(_0x525c72[_0x2af1d7(0x9a)]!=='ACTIVE'){await this[_0x2af1d7(0x137)]?.[_0x2af1d7(0xa7)](_0x1e4736,'❌\x20Shop\x20`'+_0xa0ca77+'`\x20is\x20inactive.\x0a\x0a'+_0x2af1d7(0x132),{'parse_mode':'Markdown'});return;}if(_0x525c72[_0x2af1d7(0xee)]!==_0x13a7c6&&_0x525c72[_0x2af1d7(0x161)]!==_0x13a7c6){await this[_0x2af1d7(0x137)]?.[_0x2af1d7(0xa7)](_0x1e4736,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0xa0ca77+_0x2af1d7(0xfa)+_0x2af1d7(0x15e)+_0x2af1d7(0x111),{'parse_mode':'Markdown'});return;}const _0xdd0502=await database_1['default'][_0x2af1d7(0x152)][_0x2af1d7(0x134)]({'where':{'shopId':_0x525c72['id'],'isVerified':!![],'telegramId':{'not':_0x1a9e1f}}});if(_0xdd0502){await this[_0x2af1d7(0x137)]?.['sendMessage'](_0x1e4736,_0x2af1d7(0x12b)+_0xa0ca77+_0x2af1d7(0xfa)+'Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.',{'parse_mode':_0x2af1d7(0xb6)});return;}await database_1[_0x2af1d7(0x154)][_0x2af1d7(0x152)]['update']({'where':{'telegramId':_0x1a9e1f},'data':{'shopId':_0x525c72['id'],'isVerified':!![]}}),await this[_0x2af1d7(0x137)]?.[_0x2af1d7(0xa7)](_0x1e4736,_0x2af1d7(0xcc)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x2af1d7(0x124)+_0x525c72[_0x2af1d7(0x96)]+'*\x0a')+(_0x2af1d7(0x114)+_0x525c72[_0x2af1d7(0x93)]+_0x2af1d7(0xd3))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x2af1d7(0x141)+_0x2af1d7(0x15f)+_0x2af1d7(0x16c)+'•\x20Important\x20events\x0a\x0a'+'Commands:\x0a'+_0x2af1d7(0xab)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x2af1d7(0xb6)}),console[_0x2af1d7(0xf3)](_0x2af1d7(0xac)+_0x1a9e1f+_0x2af1d7(0x115)+_0x525c72[_0x2af1d7(0x93)]+_0x2af1d7(0xdf));}catch(_0x3f8f13){console['error'](_0x2af1d7(0xf4),_0x3f8f13),await this['bot']?.[_0x2af1d7(0xa7)](_0x1e4736,_0x2af1d7(0x11a));}}async['sendShopNotification'](_0x466f88,_0x240c86,_0x3a2121){const _0x57aec5=a66_0xf4c92a;if(!this['bot']){console[_0x57aec5(0x10d)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x5d1bf6=await database_1['default'][_0x57aec5(0x152)][_0x57aec5(0x14c)]({'where':{'shopId':_0x466f88,'isVerified':!![]}});if(_0x5d1bf6[_0x57aec5(0x104)]===0x0){console[_0x57aec5(0xf3)](_0x57aec5(0x147)+_0x466f88);return;}const _0x1619b1=_0x5d1bf6[_0x57aec5(0x14a)](async _0x4cb4bc=>{const _0x198a49=_0x57aec5;try{await this[_0x198a49(0x137)]?.[_0x198a49(0xa7)](_0x4cb4bc[_0x198a49(0xce)],_0x240c86,_0x3a2121),console[_0x198a49(0xf3)](_0x198a49(0x15d)+_0x4cb4bc['telegramId']);}catch(_0x221c43){console[_0x198a49(0x105)](_0x198a49(0xed)+_0x4cb4bc[_0x198a49(0xce)]+':',_0x221c43),_0x221c43 instanceof Error&&(_0x221c43[_0x198a49(0x83)][_0x198a49(0xeb)]('blocked')||_0x221c43[_0x198a49(0x83)][_0x198a49(0xeb)]('chat\x20not\x20found')||_0x221c43[_0x198a49(0x83)][_0x198a49(0xeb)](_0x198a49(0xfc)))&&(await database_1['default']['telegramUser'][_0x198a49(0xff)]({'where':{'id':_0x4cb4bc['id']},'data':{'isVerified':![]}}),console['log']('User\x20'+_0x4cb4bc['telegramId']+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x57aec5(0x13e)](_0x1619b1);}catch(_0x2ed706){console[_0x57aec5(0x105)](_0x57aec5(0x169),_0x2ed706);}}async[a66_0xf4c92a(0xc0)](_0xdb7808,_0x8d0da9,_0x1f843b){const _0x2196fb=a66_0xf4c92a,_0x1a06e7={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x577718={'created':_0x2196fb(0x136),'paid':_0x2196fb(0xc7),'failed':_0x2196fb(0x9f),'expired':'Payment\x20expired','refund':_0x2196fb(0xa9),'chargeback':_0x2196fb(0xe9),'processing':_0x2196fb(0xbb)},_0x14fb4e=_0x1a06e7[_0x1f843b],_0x49f558=_0x577718[_0x1f843b],_0x21d49e=(0x0,gateway_1[_0x2196fb(0x122)])(_0x8d0da9['gateway']);console[_0x2196fb(0xf3)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x8d0da9[_0x2196fb(0x160)]+_0x2196fb(0x13b)+_0x21d49e+'\x22');let _0x21ac45=_0x14fb4e+'\x20*'+_0x49f558+_0x2196fb(0x13f)+(_0x2196fb(0x121)+_0x8d0da9[_0x2196fb(0xb0)]+'\x20'+_0x8d0da9[_0x2196fb(0x86)]+'*\x0a')+(_0x2196fb(0x143)+(_0x8d0da9[_0x2196fb(0x127)]||_0x8d0da9['id'])+'`\x0a')+(_0x2196fb(0x9c)+_0x8d0da9['id']+'`\x0a')+(_0x2196fb(0x16a)+_0x21d49e+'`\x0a')+(_0x2196fb(0x8e)+new Date(_0x8d0da9[_0x2196fb(0xe0)])[_0x2196fb(0xaa)](_0x2196fb(0x12e))+'\x0a');if(_0x8d0da9[_0x2196fb(0xc1)]||_0x8d0da9[_0x2196fb(0x110)]||_0x8d0da9[_0x2196fb(0x8b)]||_0x8d0da9['customerIp']||_0x8d0da9[_0x2196fb(0x162)]){_0x21ac45+=_0x2196fb(0xec);_0x8d0da9[_0x2196fb(0xc1)]&&(_0x21ac45+=_0x2196fb(0xd8)+_0x8d0da9['customerName']+'`\x0a');_0x8d0da9[_0x2196fb(0x110)]&&(_0x21ac45+='📧\x20Email:\x20`'+_0x8d0da9['customerEmail']+'`\x0a');_0x8d0da9['remitterIban']&&(_0x21ac45+=_0x2196fb(0x14d)+_0x8d0da9['remitterIban']+'`\x0a');_0x8d0da9['customerIp']&&(_0x21ac45+='🌐\x20IP:\x20`'+_0x8d0da9[_0x2196fb(0x150)]+'`\x0a');if(_0x8d0da9[_0x2196fb(0x162)]){const _0x164825=_0x8d0da9['customerUa'][_0x2196fb(0x104)]>0x32?_0x8d0da9[_0x2196fb(0x162)][_0x2196fb(0xe5)](0x0,0x32)+_0x2196fb(0x98):_0x8d0da9['customerUa'];_0x21ac45+='💻\x20Browser:\x20`'+_0x164825+'`\x0a';}}_0x1f843b===_0x2196fb(0xe7)&&_0x8d0da9[_0x2196fb(0x8a)]&&(_0x21ac45+='💸\x20Penalty\x20amount:\x20*'+_0x8d0da9[_0x2196fb(0x8a)]+'\x20USDT*\x0a'),_0x1f843b===_0x2196fb(0xc8)&&(_0x21ac45+=_0x2196fb(0x156)),_0x8d0da9[_0x2196fb(0x10a)]&&(_0x21ac45+='📝\x20Notes:\x20'+_0x8d0da9[_0x2196fb(0x10a)]+'\x0a'),await this[_0x2196fb(0xfb)](_0xdb7808,_0x21ac45,{'parse_mode':_0x2196fb(0xb6)});}async['sendPayoutNotification'](_0x23e5e9,_0x148e28,_0x5a64e5){const _0x33ad95=a66_0xf4c92a,_0x35212d={'created':'📤','completed':'✅','rejected':'❌'},_0x404a94={'created':_0x33ad95(0xd4),'completed':_0x33ad95(0xc6),'rejected':_0x33ad95(0xc4)},_0x429d91=_0x35212d[_0x5a64e5],_0xe7c86=_0x404a94[_0x5a64e5],_0x402baa=_0x429d91+'\x20*'+_0xe7c86+'*\x0a\x0a'+('💸\x20Amount:\x20*'+_0x148e28[_0x33ad95(0xb0)]+'\x20USD*\x0a')+('🏦\x20Method:\x20`'+_0x148e28[_0x33ad95(0xf0)]+'`\x0a')+(_0x33ad95(0xb7)+_0x148e28['id']+'`\x0a')+(_0x33ad95(0x8e)+new Date(_0x148e28[_0x33ad95(0xe0)])[_0x33ad95(0xaa)](_0x33ad95(0x12e))+'\x0a')+(_0x148e28[_0x33ad95(0x138)]?_0x33ad95(0xc9)+_0x148e28['txid']+'`':'');await this[_0x33ad95(0xfb)](_0x23e5e9,_0x402baa,{'parse_mode':'Markdown'});}async['sendLoginNotification'](_0x57611b,_0x2923db){const _0x462453=a66_0xf4c92a;try{const _0x72ec4c=await database_1[_0x462453(0x154)][_0x462453(0xd6)][_0x462453(0xb9)]({'where':{'shopId':_0x57611b},'select':{'notificationLogin':!![]}});if(!_0x72ec4c?.[_0x462453(0x108)]){console[_0x462453(0xf3)](_0x462453(0xf9)+_0x57611b);return;}const _0x1b08e9=_0x2923db[_0x462453(0x94)]?'🔐':'🚨',_0x5732ef=_0x2923db[_0x462453(0x94)]?_0x462453(0x81):_0x462453(0x11b);let _0x115f00=_0x1b08e9+'\x20*'+_0x5732ef+'*\x0a\x0a'+(_0x462453(0x114)+_0x2923db[_0x462453(0x93)]+'`\x0a')+(_0x462453(0xaf)+_0x2923db['timestamp'][_0x462453(0xaa)](_0x462453(0x12e))+'\x0a');_0x2923db['ipAddress']&&(_0x115f00+=_0x462453(0x8d)+_0x2923db['ipAddress']+'`\x0a');if(_0x2923db[_0x462453(0xe6)]){const _0x47868f=_0x2923db[_0x462453(0xe6)][_0x462453(0x104)]>0x32?_0x2923db[_0x462453(0xe6)][_0x462453(0xe5)](0x0,0x32)+'...':_0x2923db[_0x462453(0xe6)];_0x115f00+=_0x462453(0xe3)+_0x47868f+'`\x0a';}!_0x2923db[_0x462453(0x94)]&&(_0x115f00+=_0x462453(0x151)),await this[_0x462453(0xfb)](_0x57611b,_0x115f00,{'parse_mode':_0x462453(0xb6)}),console[_0x462453(0xf3)](_0x462453(0xd7)+_0x57611b+':\x20'+(_0x2923db[_0x462453(0x94)]?_0x462453(0x94):_0x462453(0x97)));}catch(_0x436433){console[_0x462453(0x105)](_0x462453(0xca),_0x436433);}}async[a66_0xf4c92a(0x116)](_0xfccbcf,_0x26e720){const _0x58673c=a66_0xf4c92a;try{const _0x50e989=await database_1[_0x58673c(0x154)][_0x58673c(0xd6)][_0x58673c(0xb9)]({'where':{'shopId':_0xfccbcf},'select':{'notificationApiError':!![]}});if(!_0x50e989?.[_0x58673c(0x117)]){console['log'](_0x58673c(0x10c)+_0xfccbcf);return;}let _0x3e1645='🚨\x20*API\x20Error*\x0a\x0a'+('🔗\x20Endpoint:\x20`'+_0x26e720[_0x58673c(0xf0)]+'\x20'+_0x26e720[_0x58673c(0xc3)]+'`\x0a')+(_0x58673c(0xaf)+_0x26e720[_0x58673c(0x12f)][_0x58673c(0xaa)](_0x58673c(0x12e))+'\x0a');_0x26e720[_0x58673c(0xcf)]&&(_0x3e1645+=_0x58673c(0xa6)+_0x26e720[_0x58673c(0xcf)]+'`\x0a'),_0x3e1645+=_0x58673c(0x91)+_0x26e720[_0x58673c(0x92)]+'`\x0a',_0x26e720['requestId']&&(_0x3e1645+=_0x58673c(0xba)+_0x26e720[_0x58673c(0xa1)]+'`\x0a'),_0x3e1645+=_0x58673c(0xa0),await this['sendShopNotification'](_0xfccbcf,_0x3e1645,{'parse_mode':_0x58673c(0xb6)}),console[_0x58673c(0xf3)](_0x58673c(0xf5)+_0xfccbcf+':\x20'+_0x26e720[_0x58673c(0xc3)]);}catch(_0x29367d){console[_0x58673c(0x105)](_0x58673c(0x106),_0x29367d);}}async['sendCustomNotification'](_0x266f02,_0x74548c,_0x96f1f0){const _0x4858a8=a66_0xf4c92a;let _0x5c0cd5=_0x4858a8(0x10b)+_0x74548c+'*\x0a\x0a';for(const [_0x23b136,_0x9adbac]of Object[_0x4858a8(0x155)](_0x96f1f0)){_0x9adbac!==null&&_0x9adbac!==undefined&&(_0x5c0cd5+=_0x23b136+_0x4858a8(0xe8)+_0x9adbac+'`\x0a');}await this[_0x4858a8(0xfb)](_0x266f02,_0x5c0cd5,{'parse_mode':'Markdown'});}async['sendNotificationToAll'](_0x3a6673){const _0x515aac=a66_0xf4c92a;try{console[_0x515aac(0xf3)](_0x515aac(0xad)+_0x3a6673[_0x515aac(0xe5)](0x0,0x32)+_0x515aac(0x98));const _0xdc3bc8=await database_1[_0x515aac(0x154)][_0x515aac(0x152)][_0x515aac(0x14c)]({'select':{'telegramId':!![]}});if(_0xdc3bc8[_0x515aac(0x104)]===0x0){console['log'](_0x515aac(0x130));return;}for(const _0x282cea of _0xdc3bc8){try{await this[_0x515aac(0x137)]?.['sendMessage'](_0x282cea[_0x515aac(0xce)],_0x3a6673,{'parse_mode':_0x515aac(0xb6)});}catch(_0x56cea7){console[_0x515aac(0x105)](_0x515aac(0xa5)+_0x282cea[_0x515aac(0xce)]+':',_0x56cea7);}}console[_0x515aac(0xf3)](_0x515aac(0x99)+_0xdc3bc8[_0x515aac(0x104)]+_0x515aac(0x8c));}catch(_0xf3bb5b){console[_0x515aac(0x105)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:',_0xf3bb5b);}}['getBotInfo'](){const _0x485b5a=a66_0xf4c92a;return{'isActive':!!this[_0x485b5a(0x137)],'username':this[_0x485b5a(0x12d)]};}async['sendShopFile'](_0x3a0604,_0x3025cb,_0x6efa40,_0xcc9af4){const _0x4c5c1d=a66_0xf4c92a;try{if(!this[_0x4c5c1d(0x137)])return console['error'](_0x4c5c1d(0xf7)),![];const _0x472dbf=await database_1[_0x4c5c1d(0x154)][_0x4c5c1d(0x152)]['findMany']({'where':{'shopId':_0x3a0604,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x472dbf['length']===0x0)return console['error'](_0x4c5c1d(0x112)+_0x3a0604),![];let _0x528840=0x0;for(const _0x33e58d of _0x472dbf){try{await this[_0x4c5c1d(0x137)]['sendDocument'](_0x33e58d[_0x4c5c1d(0xce)],_0x3025cb,{},{'filename':_0x6efa40,'contentType':_0x6efa40[_0x4c5c1d(0x125)]('.png')?_0x4c5c1d(0xf6):_0x6efa40[_0x4c5c1d(0x125)](_0x4c5c1d(0x118))||_0x6efa40[_0x4c5c1d(0x125)](_0x4c5c1d(0x8f))?_0x4c5c1d(0xbc):_0x6efa40[_0x4c5c1d(0x125)](_0x4c5c1d(0xf8))?'application/pdf':_0x4c5c1d(0x80)}),_0xcc9af4&&await this['bot'][_0x4c5c1d(0xa7)](_0x33e58d['telegramId'],_0xcc9af4),_0x528840++;}catch(_0x2b2418){console['error']('❌\x20Error\x20sending\x20file\x20to\x20user\x20'+_0x33e58d['telegramId']+':',_0x2b2418);}}return console[_0x4c5c1d(0xf3)](_0x4c5c1d(0x139)+_0x528840+'/'+_0x472dbf[_0x4c5c1d(0x104)]+'\x20users\x20of\x20shop\x20'+_0x3a0604+':\x20'+_0x6efa40),_0x528840>0x0;}catch(_0xfff164){return console[_0x4c5c1d(0x105)]('❌\x20Error\x20sending\x20file\x20to\x20shop:',_0xfff164),![];}}async[a66_0xf4c92a(0x85)](_0x2fd23f,_0x15ffc2){const _0x1cbb5c=a66_0xf4c92a;try{if(!this['bot'])return console['error'](_0x1cbb5c(0xf7)),![];return await this['bot'][_0x1cbb5c(0xa7)](_0x2fd23f,_0x15ffc2),console[_0x1cbb5c(0xf3)]('✅\x20Direct\x20message\x20sent\x20to\x20chat\x20'+_0x2fd23f),!![];}catch(_0x585831){return console[_0x1cbb5c(0x105)](_0x1cbb5c(0xd0),_0x585831),![];}}async[a66_0xf4c92a(0x11c)](_0x2272f5,_0x44494e,_0x3f0a4c,_0x17091a){const _0x49d777=a66_0xf4c92a;try{if(!this[_0x49d777(0x137)])return console['error']('❌\x20Telegram\x20bot\x20not\x20initialized'),![];return await this['bot'][_0x49d777(0xb4)](_0x2272f5,_0x44494e,{},{'filename':_0x3f0a4c,'contentType':_0x3f0a4c[_0x49d777(0x125)]('.png')?_0x49d777(0xf6):_0x3f0a4c[_0x49d777(0x125)](_0x49d777(0x118))||_0x3f0a4c['endsWith']('.jpeg')?_0x49d777(0xbc):_0x3f0a4c[_0x49d777(0x125)](_0x49d777(0xf8))?'application/pdf':_0x49d777(0x80)}),_0x17091a&&await this[_0x49d777(0x137)][_0x49d777(0xa7)](_0x2272f5,_0x17091a),console['log']('✅\x20File\x20sent\x20to\x20chat\x20'+_0x2272f5+':\x20'+_0x3f0a4c),!![];}catch(_0x2d2e93){return console[_0x49d777(0x105)](_0x49d777(0x9d),_0x2d2e93),![];}}['stopBot'](){const _0x2097a4=a66_0xf4c92a;this[_0x2097a4(0x137)]&&(this[_0x2097a4(0x137)][_0x2097a4(0x142)](),this['bot']=null,console[_0x2097a4(0xf3)](_0x2097a4(0x140)));}}exports[a66_0xf4c92a(0x12a)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();