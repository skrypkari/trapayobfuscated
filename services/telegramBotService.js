'use strict';const a59_0x269d4c=a59_0x48fc;(function(_0x491db2,_0x5a960b){const _0x5bb8b3=a59_0x48fc,_0x5836dc=_0x491db2();while(!![]){try{const _0x508cf3=-parseInt(_0x5bb8b3(0x136))/0x1+parseInt(_0x5bb8b3(0x14b))/0x2+-parseInt(_0x5bb8b3(0x183))/0x3*(-parseInt(_0x5bb8b3(0x121))/0x4)+parseInt(_0x5bb8b3(0x13b))/0x5*(parseInt(_0x5bb8b3(0xf8))/0x6)+parseInt(_0x5bb8b3(0x111))/0x7*(-parseInt(_0x5bb8b3(0x15a))/0x8)+-parseInt(_0x5bb8b3(0x193))/0x9+parseInt(_0x5bb8b3(0xe8))/0xa*(parseInt(_0x5bb8b3(0x182))/0xb);if(_0x508cf3===_0x5a960b)break;else _0x5836dc['push'](_0x5836dc['shift']());}catch(_0x447d4c){_0x5836dc['push'](_0x5836dc['shift']());}}}(a59_0x260e,0x1ac0c));var __importDefault=this&&this['__importDefault']||function(_0x32a62d){const _0x4512da=a59_0x48fc;return _0x32a62d&&_0x32a62d[_0x4512da(0x1ad)]?_0x32a62d:{'default':_0x32a62d};};Object[a59_0x269d4c(0x10c)](exports,a59_0x269d4c(0x1ad),{'value':!![]}),exports[a59_0x269d4c(0x12a)]=exports[a59_0x269d4c(0xf7)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a59_0x269d4c(0x149))),database_1=__importDefault(require(a59_0x269d4c(0x130))),gateway_1=require('../types/gateway');function a59_0x260e(){const _0x487e6f=[':\x20username=\x22','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','\x20initialized\x20successfully','secretKey','findMany','chat','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','*\x0a\x0a','trapay_bot','orderId','statusCode','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','🏪\x20Gateway:\x20`','•\x20`','Available\x20usernames:\x0a','...','defineProperty','env','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','•\x20Payment\x20status\x20changes\x0a','Markdown','7wQoJwM','\x20\x20\x20Username:\x20`','updatedAt','isVerified','Check\x20spelling\x20and\x20try\x20again.','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','Example:\x0a','Failed\x20to\x20send\x20login\x20notification:','User\x20','👤\x20Username:\x20`','🆔\x20Payout\x20ID:\x20`','handleSingleLineVerification','`.\x0a\x0a','onText','💰\x20Amount:\x20*','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','759688hjKDHj','last_name','botToken','userAgent','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','create','findUnique','📛\x20Name:\x20`','telegramBotService','timestamp','includes','🔍\x20*Debug\x20Information*\x0a\x0a','amount','🌐\x20IP:\x20`','../config/database','adminNotes','customerName','sendLoginNotification','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','sendPayoutNotification','40409AMUCOB','trim','success','endpoint','\x22\x20->\x20display\x20\x22','5TzUzci','sendCustomNotification','bot','/disconnect\x20-\x20disconnect\x20from\x20notifications','first_name','substring','\x20USD*\x0a','sendMessage','🎉\x20*Congratulations!*\x0a\x0a','Payment\x20successfully\x20paid','📱\x20Created\x20new\x20Telegram\x20user:\x20','Error\x20handling\x20/disconnect\x20command:','user\x20is\x20deactivated','initializeBot','node-telegram-bot-api','📊\x20*Connection\x20Status*\x0a\x0a','53802nTpwww','failed','sendApiErrorNotification','botUsername','🌐\x20IP\x20address:\x20`','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','Contact\x20administrator.','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','username','allSettled','\x0a👤\x20*Customer\x20Information:*\x0a','`\x0a\x0a','Commands:\x0a','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','startsWith','736616GaxwMr','notificationApiError','\x20\x20\x20Status:\x20','•\x20Important\x20events\x0a\x0a','💻\x20Browser:\x20`','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','To\x20reconnect,\x20use\x20the\x20/start\x20command','`\x20not\x20found.\x0a\x0a','💸\x20Amount:\x20*','blocked','customerEmail','message','errorMessage','error','/status\x20-\x20check\x20connection\x20status\x0a','*.\x0a\x0a','📝\x20Order\x20ID:\x20`','Error\x20handling\x20message:','TELEGRAM_BOT_USERNAME','getGatewayDisplayNameForTelegram','processing','📅\x20Time:\x20','getBotInfo','Use\x20/start\x20to\x20begin.','publicKey','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','length','requestId','Use\x20/start\x20to\x20connect.',':\x20`','New\x20payout\x20created','📅\x20Date:\x20','🆔\x20Request\x20ID:\x20`','split','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','telegramUser','toLocaleDateString','name','ACTIVE','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','33LwioEm','3LWwtdb','shopId','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','pk_','📱\x20Telegram\x20notification:\x20gateway\x20\x22','remitterIban','test','default','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','Username:\x20`','toString','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','🏦\x20IBAN:\x20`','chat\x20not\x20found','Error\x20sending\x20shop\x20notification:','map','992331AAHXKM','\x20\x20\x20Public\x20Key:\x20`','📅\x20Connection\x20date:\x20','log','text','\x20verified\x20for\x20shop\x20','Payment\x20is\x20being\x20processed','Failed\x20login\x20attempt','en-US','shopSettings','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','createdAt','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','❌\x20Shop\x20with\x20username\x20`','from','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','•\x20Payouts\x0a\x0a','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','unknown\x20shop','✅\x20Connected\x20to\x20shop:\x20*','🛑\x20Telegram\x20bot\x20stopped','🔔\x20*','🔌\x20User\x20','📧\x20Email:\x20`','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','__esModule','✅\x20Telegram\x20user\x20','toLocaleString','Payout\x20completed','\x20via\x20single-line\x20input','chargebackAmount','Payment\x20chargeback','notificationLogin','Successful\x20login','findFirst','update','...`\x0a\x0a','method','status','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','✅\x20Welcome\x20back!\x0a\x0a','warn','...\x22','customerIp','.\x20*','TELEGRAM_BOT_TOKEN','\x20disconnected\x20from\x20shop\x20','txid','gateway','Telegram\x20bot\x20polling\x20error:','setupBotHandlers','❌\x20Error\x20getting\x20debug\x20information.','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','currency','`\x20is\x20inactive.\x0a\x0a','437720NeRHDl','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','chargeback','📱\x20Shop:\x20*','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','🏦\x20Method:\x20`','telegramId','sendShopNotification','shop','Telegram\x20bot\x20error:','🆔\x20Payment\x20ID:\x20`','Failed\x20to\x20send\x20API\x20error\x20notification:','You\x20sent\x20','forEach','TelegramBotService','25116zsWmmq','sendPaymentNotification','•\x20New\x20payments\x0a','customerUa'];a59_0x260e=function(){return _0x487e6f;};return a59_0x260e();}class TelegramBotService{constructor(){const _0x4e49e0=a59_0x269d4c;this[_0x4e49e0(0x13d)]=null,this[_0x4e49e0(0x123)]=process[_0x4e49e0(0x10d)][_0x4e49e0(0x1c2)]||'',this[_0x4e49e0(0x14e)]=process[_0x4e49e0(0x10d)][_0x4e49e0(0x16c)]||_0x4e49e0(0x104),this[_0x4e49e0(0x123)]?this[_0x4e49e0(0x148)]():console['warn'](_0x4e49e0(0x102));}[a59_0x269d4c(0x148)](){const _0x3eed3b=a59_0x269d4c;try{this[_0x3eed3b(0x13d)]=new node_telegram_bot_api_1[(_0x3eed3b(0x18a))](this[_0x3eed3b(0x123)],{'polling':!![]}),this[_0x3eed3b(0x1c7)](),console[_0x3eed3b(0x196)]('✅\x20Telegram\x20bot\x20@'+this[_0x3eed3b(0x14e)]+_0x3eed3b(0xfe));}catch(_0x5f51a5){console[_0x3eed3b(0x167)](_0x3eed3b(0x125),_0x5f51a5);}}[a59_0x269d4c(0x1c7)](){const _0x1b5fff=a59_0x269d4c;if(!this[_0x1b5fff(0x13d)])return;this[_0x1b5fff(0x13d)]['onText'](/\/start/,async _0x82e536=>{const _0x5b9b63=_0x1b5fff,_0x42217d=_0x82e536[_0x5b9b63(0x101)]['id'],_0x2f5cf3=_0x82e536[_0x5b9b63(0x1a2)]?.['id'][_0x5b9b63(0x18d)](),_0x233556=_0x82e536[_0x5b9b63(0x1a2)]?.['username'],_0x2e044b=_0x82e536['from']?.[_0x5b9b63(0x13f)],_0x258e3e=_0x82e536[_0x5b9b63(0x1a2)]?.[_0x5b9b63(0x122)];if(!_0x2f5cf3)return;try{let _0x499eae=await database_1[_0x5b9b63(0x18a)][_0x5b9b63(0x17d)]['findUnique']({'where':{'telegramId':_0x2f5cf3},'include':{'shop':!![]}});!_0x499eae?(_0x499eae=await database_1['default'][_0x5b9b63(0x17d)][_0x5b9b63(0x127)]({'data':{'telegramId':_0x2f5cf3,'username':_0x233556,'firstName':_0x2e044b,'lastName':_0x258e3e,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x5b9b63(0x196)](_0x5b9b63(0x145)+_0x2f5cf3+'\x20(@'+_0x233556+')')):_0x499eae=await database_1[_0x5b9b63(0x18a)][_0x5b9b63(0x17d)]['update']({'where':{'telegramId':_0x2f5cf3},'data':{'username':_0x233556,'firstName':_0x2e044b,'lastName':_0x258e3e},'include':{'shop':!![]}}),_0x499eae['isVerified']&&_0x499eae['shopId']&&_0x499eae['shop']?await this[_0x5b9b63(0x13d)]?.[_0x5b9b63(0x142)](_0x42217d,_0x5b9b63(0x1bd)+(_0x5b9b63(0x15f)+_0x499eae['shop'][_0x5b9b63(0x17f)]+'*\x0a')+(_0x5b9b63(0x18c)+_0x499eae[_0x5b9b63(0xf1)][_0x5b9b63(0x153)]+_0x5b9b63(0x156))+'🔔\x20You\x20receive\x20notifications\x20about:\x0a'+_0x5b9b63(0xfa)+_0x5b9b63(0x10f)+_0x5b9b63(0x1a4)+_0x5b9b63(0x157)+_0x5b9b63(0x168)+_0x5b9b63(0x13e),{'parse_mode':_0x5b9b63(0x110)}):(_0x499eae[_0x5b9b63(0x184)]&&!_0x499eae['isVerified']&&(await database_1[_0x5b9b63(0x18a)][_0x5b9b63(0x17d)][_0x5b9b63(0x1b7)]({'where':{'telegramId':_0x2f5cf3},'data':{'shopId':null,'isVerified':![]}}),console[_0x5b9b63(0x196)](_0x5b9b63(0x152)+_0x2f5cf3)),await this['bot']?.[_0x5b9b63(0x142)](_0x42217d,_0x5b9b63(0x1ac)+_0x5b9b63(0x185)+_0x5b9b63(0x19d)+_0x5b9b63(0x117)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x5b9b63(0x110)}));}catch(_0x516e9a){console[_0x5b9b63(0x167)]('Error\x20handling\x20/start\x20command:',_0x516e9a),await this['bot']?.[_0x5b9b63(0x142)](_0x42217d,_0x5b9b63(0x17c));}}),this['bot'][_0x1b5fff(0x11e)](/\/disconnect/,async _0x337d18=>{const _0x25f4c8=_0x1b5fff,_0x3a8068=_0x337d18[_0x25f4c8(0x101)]['id'],_0x340a20=_0x337d18[_0x25f4c8(0x1a2)]?.['id'][_0x25f4c8(0x18d)]();if(!_0x340a20)return;try{const _0x2bbcc8=await database_1[_0x25f4c8(0x18a)][_0x25f4c8(0x17d)][_0x25f4c8(0x128)]({'where':{'telegramId':_0x340a20},'include':{'shop':!![]}});if(!_0x2bbcc8||!_0x2bbcc8[_0x25f4c8(0x114)]||!_0x2bbcc8[_0x25f4c8(0x184)]){await this[_0x25f4c8(0x13d)]?.[_0x25f4c8(0x142)](_0x3a8068,_0x25f4c8(0xe9));return;}const _0x2eff7b=_0x2bbcc8['shop']?.[_0x25f4c8(0x17f)]||_0x25f4c8(0x1a6);await database_1[_0x25f4c8(0x18a)][_0x25f4c8(0x17d)][_0x25f4c8(0x1b7)]({'where':{'telegramId':_0x340a20},'data':{'shopId':null,'isVerified':![]}}),console[_0x25f4c8(0x196)](_0x25f4c8(0x1aa)+_0x340a20+_0x25f4c8(0x1c3)+_0x2bbcc8[_0x25f4c8(0x184)]),await this[_0x25f4c8(0x13d)]?.[_0x25f4c8(0x142)](_0x3a8068,_0x25f4c8(0x116)+_0x2eff7b+_0x25f4c8(0x169)+_0x25f4c8(0x160),{'parse_mode':_0x25f4c8(0x110)});}catch(_0x3355cd){console['error'](_0x25f4c8(0x146),_0x3355cd),await this[_0x25f4c8(0x13d)]?.[_0x25f4c8(0x142)](_0x3a8068,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x1b5fff(0x13d)][_0x1b5fff(0x11e)](/\/status/,async _0x45a257=>{const _0xcdc000=_0x1b5fff,_0xa4a028=_0x45a257[_0xcdc000(0x101)]['id'],_0x123af3=_0x45a257['from']?.['id'][_0xcdc000(0x18d)]();if(!_0x123af3)return;try{const _0x2c8641=await database_1[_0xcdc000(0x18a)][_0xcdc000(0x17d)][_0xcdc000(0x128)]({'where':{'telegramId':_0x123af3},'include':{'shop':!![]}});if(!_0x2c8641){await this[_0xcdc000(0x13d)]?.[_0xcdc000(0x142)](_0xa4a028,_0xcdc000(0x134)+_0xcdc000(0x171));return;}if(!_0x2c8641[_0xcdc000(0x114)]||!_0x2c8641[_0xcdc000(0x184)]||!_0x2c8641[_0xcdc000(0xf1)]){await this[_0xcdc000(0x13d)]?.[_0xcdc000(0x142)](_0xa4a028,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+_0xcdc000(0x176));return;}await this[_0xcdc000(0x13d)]?.[_0xcdc000(0x142)](_0xa4a028,_0xcdc000(0x14a)+(_0xcdc000(0x1a7)+_0x2c8641[_0xcdc000(0xf1)][_0xcdc000(0x17f)]+'*\x0a')+('👤\x20Username:\x20`'+_0x2c8641['shop']['username']+'`\x0a')+(_0xcdc000(0x195)+_0x2c8641[_0xcdc000(0x113)][_0xcdc000(0x17e)](_0xcdc000(0x19b))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+_0xcdc000(0x157)+_0xcdc000(0x13e),{'parse_mode':_0xcdc000(0x110)});}catch(_0x5b3ebd){console[_0xcdc000(0x167)]('Error\x20handling\x20/status\x20command:',_0x5b3ebd),await this[_0xcdc000(0x13d)]?.[_0xcdc000(0x142)](_0xa4a028,_0xcdc000(0x17c));}}),this['bot'][_0x1b5fff(0x11e)](/\/debug/,async _0x4549ab=>{const _0x297343=_0x1b5fff,_0x2bbebe=_0x4549ab[_0x297343(0x101)]['id'],_0x3c80c9=_0x4549ab[_0x297343(0x1a2)]?.['id'][_0x297343(0x18d)]();if(!_0x3c80c9)return;try{const _0x201475=await database_1[_0x297343(0x18a)][_0x297343(0xf1)][_0x297343(0x100)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4db01c=_0x297343(0x12d);_0x4db01c+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x3c80c9+_0x297343(0x156),_0x4db01c+='🏪\x20Available\x20shops\x20in\x20system:\x0a',_0x201475['forEach']((_0x2bc598,_0x33cee3)=>{const _0x27e42a=_0x297343;_0x4db01c+=_0x33cee3+0x1+_0x27e42a(0x1c1)+_0x2bc598[_0x27e42a(0x17f)]+'*\x0a',_0x4db01c+=_0x27e42a(0x112)+_0x2bc598[_0x27e42a(0x153)]+'`\x0a',_0x4db01c+=_0x27e42a(0x15c)+_0x2bc598[_0x27e42a(0x1ba)]+'\x0a',_0x4db01c+=_0x27e42a(0x194)+_0x2bc598[_0x27e42a(0x172)][_0x27e42a(0x140)](0x0,0xf)+_0x27e42a(0x1b8);}),await this[_0x297343(0x13d)]?.[_0x297343(0x142)](_0x2bbebe,_0x4db01c,{'parse_mode':'Markdown'});}catch(_0x9f3933){console[_0x297343(0x167)]('Error\x20handling\x20/debug\x20command:',_0x9f3933),await this[_0x297343(0x13d)]?.[_0x297343(0x142)](_0x2bbebe,_0x297343(0x1c8));}}),this[_0x1b5fff(0x13d)]['on'](_0x1b5fff(0x165),async _0x3da76b=>{const _0x144189=_0x1b5fff;if(_0x3da76b['text']?.[_0x144189(0x159)]('/'))return;const _0x209d99=_0x3da76b[_0x144189(0x101)]['id'],_0x44588c=_0x3da76b[_0x144189(0x1a2)]?.['id'][_0x144189(0x18d)](),_0x4a1dcd=_0x3da76b[_0x144189(0x197)]?.[_0x144189(0x137)]();if(!_0x44588c||!_0x4a1dcd)return;try{const _0x278b97=await database_1[_0x144189(0x18a)]['telegramUser']['findUnique']({'where':{'telegramId':_0x44588c},'include':{'shop':!![]}});if(!_0x278b97){await this[_0x144189(0x13d)]?.[_0x144189(0x142)](_0x209d99,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x278b97['isVerified']&&_0x278b97[_0x144189(0x184)]&&_0x278b97[_0x144189(0xf1)]){await this[_0x144189(0x13d)]?.[_0x144189(0x142)](_0x209d99,_0x144189(0xfd)+_0x278b97[_0x144189(0xf1)][_0x144189(0x17f)]+'*.\x0a\x0a'+_0x144189(0x107),{'parse_mode':_0x144189(0x110)});return;}const _0x311707=_0x4a1dcd[_0x144189(0x17b)](/\s+/);if(_0x311707[_0x144189(0x174)]!==0x2){await this[_0x144189(0x13d)]?.[_0x144189(0x142)](_0x209d99,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0x144189(0x19d)+_0x144189(0x117)+_0x144189(0x1bb)+(_0x144189(0xf5)+_0x311707[_0x144189(0x174)]+'\x20parts:\x20'+_0x311707[_0x144189(0x192)](_0x3a415b=>'`'+_0x3a415b+'`')['join'](',\x20')),{'parse_mode':_0x144189(0x110)});return;}const [_0x2f2d5a,_0x55d45b]=_0x311707;console[_0x144189(0x196)](_0x144189(0x18e)+_0x44588c+_0x144189(0xfc)+_0x2f2d5a+'\x22,\x20apiKey=\x22'+_0x55d45b['substring'](0x0,0xa)+_0x144189(0x1bf)),await this[_0x144189(0x11c)](_0x209d99,_0x44588c,_0x2f2d5a,_0x55d45b);}catch(_0x1a9214){console[_0x144189(0x167)](_0x144189(0x16b),_0x1a9214),await this[_0x144189(0x13d)]?.[_0x144189(0x142)](_0x209d99,_0x144189(0x17c));}}),this[_0x1b5fff(0x13d)]['on']('error',_0x512f7f=>{const _0x12225b=_0x1b5fff;console[_0x12225b(0x167)](_0x12225b(0xf2),_0x512f7f);}),this[_0x1b5fff(0x13d)]['on']('polling_error',_0x53d627=>{const _0x4d58bb=_0x1b5fff;console['error'](_0x4d58bb(0x1c6),_0x53d627);});}async[a59_0x269d4c(0x11c)](_0x375a71,_0x132f4d,_0x40ef20,_0x413513){const _0x308f4e=a59_0x269d4c;try{console[_0x308f4e(0x196)](_0x308f4e(0x18e)+_0x132f4d+_0x308f4e(0xfc)+_0x40ef20+'\x22,\x20apiKey=\x22'+_0x413513[_0x308f4e(0x140)](0x0,0xa)+'...\x22');if(!_0x40ef20||_0x40ef20[_0x308f4e(0x174)]<0x3||_0x40ef20['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x308f4e(0x189)](_0x40ef20)){await this['bot']?.[_0x308f4e(0x142)](_0x375a71,'❌\x20Invalid\x20username\x20format:\x20`'+_0x40ef20+_0x308f4e(0x156)+_0x308f4e(0x173),{'parse_mode':'Markdown'});return;}if(!_0x413513||!_0x413513[_0x308f4e(0x159)](_0x308f4e(0x186))&&!_0x413513[_0x308f4e(0x159)]('sk_')){await this['bot']?.['sendMessage'](_0x375a71,_0x308f4e(0x181)+_0x308f4e(0x1a5),{'parse_mode':'Markdown'});return;}const _0x5b928a=await database_1['default'][_0x308f4e(0xf1)][_0x308f4e(0x128)]({'where':{'username':_0x40ef20},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x5b928a){const _0x4ce97d=await database_1[_0x308f4e(0x18a)][_0x308f4e(0xf1)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x17d585=_0x308f4e(0x1a1)+_0x40ef20+_0x308f4e(0x161);_0x4ce97d['length']>0x0?(_0x17d585+=_0x308f4e(0x10a),_0x4ce97d[_0x308f4e(0xf6)](_0x34fb51=>{const _0x42a4ca=_0x308f4e;_0x17d585+=_0x42a4ca(0x109)+_0x34fb51[_0x42a4ca(0x153)]+'`\x20('+_0x34fb51[_0x42a4ca(0x17f)]+')\x0a';}),_0x17d585+=_0x308f4e(0xe5)):_0x17d585+=_0x308f4e(0x115);await this[_0x308f4e(0x13d)]?.[_0x308f4e(0x142)](_0x375a71,_0x17d585,{'parse_mode':_0x308f4e(0x110)});return;}if(_0x5b928a[_0x308f4e(0x1ba)]!==_0x308f4e(0x180)){await this[_0x308f4e(0x13d)]?.[_0x308f4e(0x142)](_0x375a71,'❌\x20Shop\x20`'+_0x40ef20+_0x308f4e(0xe7)+_0x308f4e(0x151),{'parse_mode':_0x308f4e(0x110)});return;}if(_0x5b928a[_0x308f4e(0x172)]!==_0x413513&&_0x5b928a[_0x308f4e(0xff)]!==_0x413513){await this[_0x308f4e(0x13d)]?.[_0x308f4e(0x142)](_0x375a71,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x40ef20+_0x308f4e(0x11d)+_0x308f4e(0x120)+_0x308f4e(0xea),{'parse_mode':_0x308f4e(0x110)});return;}const _0x333e05=await database_1[_0x308f4e(0x18a)][_0x308f4e(0x17d)][_0x308f4e(0x1b6)]({'where':{'shopId':_0x5b928a['id'],'isVerified':!![],'telegramId':{'not':_0x132f4d}}});if(_0x333e05){await this[_0x308f4e(0x13d)]?.['sendMessage'](_0x375a71,_0x308f4e(0x10e)+_0x40ef20+'`.\x0a\x0a'+_0x308f4e(0xed),{'parse_mode':'Markdown'});return;}await database_1[_0x308f4e(0x18a)][_0x308f4e(0x17d)][_0x308f4e(0x1b7)]({'where':{'telegramId':_0x132f4d},'data':{'shopId':_0x5b928a['id'],'isVerified':!![]}}),await this[_0x308f4e(0x13d)]?.[_0x308f4e(0x142)](_0x375a71,_0x308f4e(0x143)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x308f4e(0xec)+_0x5b928a['name']+'*\x0a')+(_0x308f4e(0x11a)+_0x5b928a[_0x308f4e(0x153)]+_0x308f4e(0x156))+_0x308f4e(0xe4)+_0x308f4e(0xfa)+_0x308f4e(0x10f)+'•\x20Payouts\x0a'+_0x308f4e(0x15d)+_0x308f4e(0x157)+_0x308f4e(0x168)+_0x308f4e(0x13e),{'parse_mode':_0x308f4e(0x110)}),console[_0x308f4e(0x196)](_0x308f4e(0x1ae)+_0x132f4d+_0x308f4e(0x198)+_0x5b928a['username']+_0x308f4e(0x1b1));}catch(_0x193518){console[_0x308f4e(0x167)]('Error\x20in\x20handleSingleLineVerification:',_0x193518),await this[_0x308f4e(0x13d)]?.['sendMessage'](_0x375a71,'❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.');}}async[a59_0x269d4c(0xf0)](_0x46c22b,_0x4888de,_0x30726b){const _0x269596=a59_0x269d4c;if(!this[_0x269596(0x13d)]){console[_0x269596(0x1be)](_0x269596(0x1a0));return;}try{const _0x55689d=await database_1[_0x269596(0x18a)][_0x269596(0x17d)][_0x269596(0x100)]({'where':{'shopId':_0x46c22b,'isVerified':!![]}});if(_0x55689d['length']===0x0){console[_0x269596(0x196)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x46c22b);return;}const _0x5e671a=_0x55689d['map'](async _0x2c9e60=>{const _0x2d66e7=_0x269596;try{await this[_0x2d66e7(0x13d)]?.[_0x2d66e7(0x142)](_0x2c9e60[_0x2d66e7(0xef)],_0x4888de,_0x30726b),console[_0x2d66e7(0x196)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x2c9e60[_0x2d66e7(0xef)]);}catch(_0x130a9a){console[_0x2d66e7(0x167)](_0x2d66e7(0x126)+_0x2c9e60[_0x2d66e7(0xef)]+':',_0x130a9a),_0x130a9a instanceof Error&&(_0x130a9a['message'][_0x2d66e7(0x12c)](_0x2d66e7(0x163))||_0x130a9a['message'][_0x2d66e7(0x12c)](_0x2d66e7(0x190))||_0x130a9a[_0x2d66e7(0x165)][_0x2d66e7(0x12c)](_0x2d66e7(0x147)))&&(await database_1[_0x2d66e7(0x18a)][_0x2d66e7(0x17d)][_0x2d66e7(0x1b7)]({'where':{'id':_0x2c9e60['id']},'data':{'isVerified':![]}}),console[_0x2d66e7(0x196)](_0x2d66e7(0x119)+_0x2c9e60[_0x2d66e7(0xef)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x269596(0x154)](_0x5e671a);}catch(_0x2160ef){console['error'](_0x269596(0x191),_0x2160ef);}}async[a59_0x269d4c(0xf9)](_0x42a8ea,_0x273a47,_0xa213df){const _0xeaf9a=a59_0x269d4c,_0x34448b={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0xe63714={'created':'New\x20payment\x20created','paid':_0xeaf9a(0x144),'failed':'Payment\x20failed','expired':'Payment\x20expired','refund':'Payment\x20refund','chargeback':_0xeaf9a(0x1b3),'processing':_0xeaf9a(0x199)},_0x500e13=_0x34448b[_0xa213df],_0x34c1a3=_0xe63714[_0xa213df],_0x41da91=(0x0,gateway_1[_0xeaf9a(0x16d)])(_0x273a47[_0xeaf9a(0x1c5)]);console[_0xeaf9a(0x196)](_0xeaf9a(0x187)+_0x273a47[_0xeaf9a(0x1c5)]+_0xeaf9a(0x13a)+_0x41da91+'\x22');let _0x25f065=_0x500e13+'\x20*'+_0x34c1a3+_0xeaf9a(0x103)+(_0xeaf9a(0x11f)+_0x273a47[_0xeaf9a(0x12e)]+'\x20'+_0x273a47[_0xeaf9a(0xe6)]+'*\x0a')+(_0xeaf9a(0x16a)+(_0x273a47[_0xeaf9a(0x105)]||_0x273a47['id'])+'`\x0a')+(_0xeaf9a(0xf3)+_0x273a47['id']+'`\x0a')+(_0xeaf9a(0x108)+_0x41da91+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x273a47[_0xeaf9a(0x19e)])['toLocaleString'](_0xeaf9a(0x19b))+'\x0a');if(_0x273a47[_0xeaf9a(0x132)]||_0x273a47[_0xeaf9a(0x164)]||_0x273a47[_0xeaf9a(0x188)]||_0x273a47['customerIp']||_0x273a47[_0xeaf9a(0xfb)]){_0x25f065+=_0xeaf9a(0x155);_0x273a47[_0xeaf9a(0x132)]&&(_0x25f065+=_0xeaf9a(0x129)+_0x273a47[_0xeaf9a(0x132)]+'`\x0a');_0x273a47[_0xeaf9a(0x164)]&&(_0x25f065+=_0xeaf9a(0x1ab)+_0x273a47[_0xeaf9a(0x164)]+'`\x0a');_0x273a47['remitterIban']&&(_0x25f065+=_0xeaf9a(0x18f)+_0x273a47[_0xeaf9a(0x188)]+'`\x0a');_0x273a47[_0xeaf9a(0x1c0)]&&(_0x25f065+=_0xeaf9a(0x12f)+_0x273a47[_0xeaf9a(0x1c0)]+'`\x0a');if(_0x273a47[_0xeaf9a(0xfb)]){const _0x29b70b=_0x273a47[_0xeaf9a(0xfb)][_0xeaf9a(0x174)]>0x32?_0x273a47[_0xeaf9a(0xfb)][_0xeaf9a(0x140)](0x0,0x32)+'...':_0x273a47[_0xeaf9a(0xfb)];_0x25f065+='💻\x20Browser:\x20`'+_0x29b70b+'`\x0a';}}_0xa213df===_0xeaf9a(0xeb)&&_0x273a47['chargebackAmount']&&(_0x25f065+='💸\x20Penalty\x20amount:\x20*'+_0x273a47[_0xeaf9a(0x1b2)]+'\x20USDT*\x0a'),_0xa213df===_0xeaf9a(0x16e)&&(_0x25f065+=_0xeaf9a(0x158)),_0x273a47[_0xeaf9a(0x131)]&&(_0x25f065+='📝\x20Notes:\x20'+_0x273a47[_0xeaf9a(0x131)]+'\x0a'),await this[_0xeaf9a(0xf0)](_0x42a8ea,_0x25f065,{'parse_mode':_0xeaf9a(0x110)});}async[a59_0x269d4c(0x135)](_0x379a22,_0x4149a2,_0x35def7){const _0x164adc=a59_0x269d4c,_0x3e430d={'created':'📤','completed':'✅','rejected':'❌'},_0x5a1809={'created':_0x164adc(0x178),'completed':_0x164adc(0x1b0),'rejected':'Payout\x20rejected'},_0x189041=_0x3e430d[_0x35def7],_0x3718a8=_0x5a1809[_0x35def7],_0x173fd3=_0x189041+'\x20*'+_0x3718a8+'*\x0a\x0a'+(_0x164adc(0x162)+_0x4149a2[_0x164adc(0x12e)]+_0x164adc(0x141))+(_0x164adc(0xee)+_0x4149a2[_0x164adc(0x1b9)]+'`\x0a')+(_0x164adc(0x11b)+_0x4149a2['id']+'`\x0a')+(_0x164adc(0x179)+new Date(_0x4149a2[_0x164adc(0x19e)])[_0x164adc(0x1af)](_0x164adc(0x19b))+'\x0a')+(_0x4149a2[_0x164adc(0x1c4)]?'🔗\x20TXID:\x20`'+_0x4149a2[_0x164adc(0x1c4)]+'`':'');await this[_0x164adc(0xf0)](_0x379a22,_0x173fd3,{'parse_mode':_0x164adc(0x110)});}async[a59_0x269d4c(0x133)](_0x5aaf43,_0x4e6f61){const _0x279bba=a59_0x269d4c;try{const _0x39a8d9=await database_1[_0x279bba(0x18a)][_0x279bba(0x19c)]['findUnique']({'where':{'shopId':_0x5aaf43},'select':{'notificationLogin':!![]}});if(!_0x39a8d9?.[_0x279bba(0x1b4)]){console['log'](_0x279bba(0x19f)+_0x5aaf43);return;}const _0x3b51fe=_0x4e6f61[_0x279bba(0x138)]?'🔐':'🚨',_0x2508ab=_0x4e6f61[_0x279bba(0x138)]?_0x279bba(0x1b5):_0x279bba(0x19a);let _0x9230a7=_0x3b51fe+'\x20*'+_0x2508ab+_0x279bba(0x103)+(_0x279bba(0x11a)+_0x4e6f61['username']+'`\x0a')+(_0x279bba(0x16f)+_0x4e6f61[_0x279bba(0x12b)][_0x279bba(0x1af)](_0x279bba(0x19b))+'\x0a');_0x4e6f61['ipAddress']&&(_0x9230a7+=_0x279bba(0x14f)+_0x4e6f61['ipAddress']+'`\x0a');if(_0x4e6f61[_0x279bba(0x124)]){const _0x18ca23=_0x4e6f61['userAgent'][_0x279bba(0x174)]>0x32?_0x4e6f61[_0x279bba(0x124)][_0x279bba(0x140)](0x0,0x32)+_0x279bba(0x10b):_0x4e6f61[_0x279bba(0x124)];_0x9230a7+=_0x279bba(0x15e)+_0x18ca23+'`\x0a';}!_0x4e6f61[_0x279bba(0x138)]&&(_0x9230a7+=_0x279bba(0x150)),await this[_0x279bba(0xf0)](_0x5aaf43,_0x9230a7,{'parse_mode':_0x279bba(0x110)}),console[_0x279bba(0x196)]('✅\x20Login\x20notification\x20sent\x20for\x20shop\x20'+_0x5aaf43+':\x20'+(_0x4e6f61[_0x279bba(0x138)]?_0x279bba(0x138):_0x279bba(0x14c)));}catch(_0x184910){console[_0x279bba(0x167)](_0x279bba(0x118),_0x184910);}}async[a59_0x269d4c(0x14d)](_0x4bdc99,_0x5ade39){const _0x4bdef7=a59_0x269d4c;try{const _0x35fb8d=await database_1[_0x4bdef7(0x18a)][_0x4bdef7(0x19c)][_0x4bdef7(0x128)]({'where':{'shopId':_0x4bdc99},'select':{'notificationApiError':!![]}});if(!_0x35fb8d?.[_0x4bdef7(0x15b)]){console['log'](_0x4bdef7(0x1a3)+_0x4bdc99);return;}let _0xb84640='🚨\x20*API\x20Error*\x0a\x0a'+('🔗\x20Endpoint:\x20`'+_0x5ade39[_0x4bdef7(0x1b9)]+'\x20'+_0x5ade39[_0x4bdef7(0x139)]+'`\x0a')+(_0x4bdef7(0x16f)+_0x5ade39['timestamp'][_0x4bdef7(0x1af)](_0x4bdef7(0x19b))+'\x0a');_0x5ade39[_0x4bdef7(0x106)]&&(_0xb84640+='📊\x20Error\x20code:\x20`'+_0x5ade39['statusCode']+'`\x0a'),_0xb84640+='❌\x20Error:\x20`'+_0x5ade39[_0x4bdef7(0x166)]+'`\x0a',_0x5ade39[_0x4bdef7(0x175)]&&(_0xb84640+=_0x4bdef7(0x17a)+_0x5ade39[_0x4bdef7(0x175)]+'`\x0a'),_0xb84640+=_0x4bdef7(0x1bc),await this[_0x4bdef7(0xf0)](_0x4bdc99,_0xb84640,{'parse_mode':_0x4bdef7(0x110)}),console[_0x4bdef7(0x196)](_0x4bdef7(0x18b)+_0x4bdc99+':\x20'+_0x5ade39['endpoint']);}catch(_0x1e1737){console['error'](_0x4bdef7(0xf4),_0x1e1737);}}async[a59_0x269d4c(0x13c)](_0x364bb0,_0x4d7de4,_0x49e6e0){const _0x2bde57=a59_0x269d4c;let _0x580139=_0x2bde57(0x1a9)+_0x4d7de4+_0x2bde57(0x103);for(const [_0x543a55,_0x541807]of Object['entries'](_0x49e6e0)){_0x541807!==null&&_0x541807!==undefined&&(_0x580139+=_0x543a55+_0x2bde57(0x177)+_0x541807+'`\x0a');}await this[_0x2bde57(0xf0)](_0x364bb0,_0x580139,{'parse_mode':_0x2bde57(0x110)});}[a59_0x269d4c(0x170)](){return{'isActive':!!this['bot'],'username':this['botUsername']};}['stopBot'](){const _0x18231d=a59_0x269d4c;this[_0x18231d(0x13d)]&&(this['bot']['stopPolling'](),this['bot']=null,console[_0x18231d(0x196)](_0x18231d(0x1a8)));}}function a59_0x48fc(_0x51222f,_0x432393){const _0x260e2f=a59_0x260e();return a59_0x48fc=function(_0x48fc62,_0x4451f6){_0x48fc62=_0x48fc62-0xe4;let _0x3d71ce=_0x260e2f[_0x48fc62];return _0x3d71ce;},a59_0x48fc(_0x51222f,_0x432393);}exports[a59_0x269d4c(0xf7)]=TelegramBotService,exports[a59_0x269d4c(0x12a)]=new TelegramBotService();