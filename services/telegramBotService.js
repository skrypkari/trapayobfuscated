'use strict';const a57_0x1cf379=a57_0x3b90;function a57_0xa0c1(){const _0x4e614a=['Failed\x20login\x20attempt','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','❌\x20Shop\x20`','unknown\x20shop','from','username','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','currency','length','handleSingleLineVerification','sendLoginNotification','TELEGRAM_BOT_USERNAME','startsWith','create',':\x20username=\x22','.\x20*','chargeback','last_name','customerName','processing','createdAt','🆔\x20Payout\x20ID:\x20`','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','notificationLogin','chargebackAmount','Payment\x20expired','•\x20Payouts\x0a\x0a','Payout\x20rejected','22vuZebu','success','`\x20is\x20inactive.\x0a\x0a','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','/status\x20-\x20check\x20connection\x20status\x0a','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','Markdown','TelegramBotService','`\x0a\x0a','💸\x20Amount:\x20*','`.\x0a\x0a','notificationApiError','botToken','🌐\x20IP:\x20`','❌\x20Invalid\x20username\x20format:\x20`','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','\x20disconnected\x20from\x20shop\x20','\x20initialized\x20successfully','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','🏦\x20Method:\x20`','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','requestId','✅\x20Telegram\x20user\x20','📊\x20*Connection\x20Status*\x0a\x0a','Failed\x20to\x20send\x20login\x20notification:','💻\x20Browser:\x20`','🚨\x20*API\x20Error*\x0a\x0a','amount','forEach','1282536eajLks','remitterIban','__esModule','sendMessage','substring','•\x20Payment\x20status\x20changes\x0a','Telegram\x20bot\x20error:','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','🆔\x20Request\x20ID:\x20`','telegramId','Payment\x20successfully\x20paid','setupBotHandlers','sendPaymentNotification','\x20via\x20single-line\x20input','🎉\x20*Congratulations!*\x0a\x0a','__importDefault','Error\x20in\x20handleSingleLineVerification:','ACTIVE','📝\x20Order\x20ID:\x20`','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','publicKey','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','*.\x0a\x0a','*\x0a\x0a','TELEGRAM_BOT_TOKEN','📱\x20Created\x20new\x20Telegram\x20user:\x20','❌\x20Error:\x20`','bot','New\x20payment\x20created','\x0a👤\x20*Customer\x20Information:*\x0a','18bQAFLz','📝\x20Notes:\x20','\x20\x20\x20Username:\x20`','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','findFirst','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','\x20parts:\x20','Payment\x20refund','🏪\x20Available\x20shops\x20in\x20system:\x0a','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','User\x20','📊\x20Error\x20code:\x20`','blocked','message','To\x20reconnect,\x20use\x20the\x20/start\x20command','errorMessage','Commands:\x0a','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','getGatewayDisplayNameForTelegram','map','Payment\x20chargeback','entries','📛\x20Name:\x20`','🌐\x20IP\x20address:\x20`','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','...','🆔\x20Payment\x20ID:\x20`','default','endpoint','gateway','onText','allSettled','9MZQMWl','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','sendShopNotification','🔌\x20User\x20','/disconnect\x20-\x20disconnect\x20from\x20notifications','Error\x20handling\x20message:','method','status','Username:\x20`','Error\x20handling\x20/disconnect\x20command:','customerUa','📅\x20Time:\x20','Use\x20/start\x20to\x20begin.','🔔\x20You\x20receive\x20notifications\x20about:\x0a','sendPayoutNotification','shopId','polling_error','telegramUser','customerEmail','Successful\x20login','2424147iUvHgq','statusCode','✅\x20Telegram\x20bot\x20@','shop','toLocaleDateString','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','log','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','env','🔔\x20*','•\x20`','🔗\x20TXID:\x20`','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','❌\x20Error\x20getting\x20debug\x20information.','📧\x20Email:\x20`','en-US','Error\x20handling\x20/status\x20command:','name','32954iKmaVl','sendApiErrorNotification','includes','📅\x20Connection\x20date:\x20','error','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','💰\x20Amount:\x20*','•\x20Payouts\x0a','\x20\x20\x20Status:\x20','8048816xxiuJj','7808330MmFLiW','✅\x20Welcome\x20back!\x0a\x0a','chat','findUnique','\x20\x20\x20Public\x20Key:\x20`','isVerified','Error\x20sending\x20shop\x20notification:','🔍\x20*Debug\x20Information*\x0a\x0a','📱\x20Shop:\x20*','❌\x20Shop\x20with\x20username\x20`','botUsername','\x20(@','sendCustomNotification','\x20USD*\x0a','initializeBot','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','...\x22','Failed\x20to\x20send\x20API\x20error\x20notification:','update','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','👤\x20Username:\x20`','•\x20New\x20payments\x0a','secretKey','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','updatedAt','sk_','user\x20is\x20deactivated','txid','New\x20payout\x20created','first_name','🔔\x20Notifications\x20are\x20active\x0a\x0a','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','findMany','4DsJcqc','../config/database','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','shopSettings','Example:\x0a','Telegram\x20bot\x20polling\x20error:','8098960AYfvam','getBotInfo','userAgent','ipAddress','toLocaleString','toString','trim','join','customerIp','1820882SiIETX','test','Available\x20usernames:\x0a','✅\x20Connected\x20to\x20shop:\x20*','\x22,\x20apiKey=\x22','telegramBotService','timestamp'];a57_0xa0c1=function(){return _0x4e614a;};return a57_0xa0c1();}(function(_0x1135d7,_0x4758f2){const _0x43213a=a57_0x3b90,_0x667222=_0x1135d7();while(!![]){try{const _0x1b4b9c=-parseInt(_0x43213a(0x1db))/0x1+parseInt(_0x43213a(0x161))/0x2+-parseInt(_0x43213a(0x14f))/0x3*(-parseInt(_0x43213a(0x18c))/0x4)+parseInt(_0x43213a(0x16b))/0x5+-parseInt(_0x43213a(0x1fa))/0x6*(parseInt(_0x43213a(0x19b))/0x7)+parseInt(_0x43213a(0x16a))/0x8*(-parseInt(_0x43213a(0x21b))/0x9)+parseInt(_0x43213a(0x192))/0xa*(parseInt(_0x43213a(0x1be))/0xb);if(_0x1b4b9c===_0x4758f2)break;else _0x667222['push'](_0x667222['shift']());}catch(_0x898208){_0x667222['push'](_0x667222['shift']());}}}(a57_0xa0c1,0xe4c08));var __importDefault=this&&this[a57_0x1cf379(0x1ea)]||function(_0x3355e7){const _0x310f30=a57_0x1cf379;return _0x3355e7&&_0x3355e7[_0x310f30(0x1dd)]?_0x3355e7:{'default':_0x3355e7};};Object['defineProperty'](exports,a57_0x1cf379(0x1dd),{'value':!![]}),exports[a57_0x1cf379(0x1a0)]=exports['TelegramBotService']=void 0x0;function a57_0x3b90(_0x71c20c,_0x42c6b5){const _0xa0c1fd=a57_0xa0c1();return a57_0x3b90=function(_0x3b9097,_0x1158d4){_0x3b9097=_0x3b9097-0x143;let _0x278c99=_0xa0c1fd[_0x3b9097];return _0x278c99;},a57_0x3b90(_0x71c20c,_0x42c6b5);}const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a57_0x1cf379(0x18d))),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x445c2b=a57_0x1cf379;this[_0x445c2b(0x1f7)]=null,this[_0x445c2b(0x1ca)]=process['env'][_0x445c2b(0x1f4)]||'',this[_0x445c2b(0x175)]=process[_0x445c2b(0x157)][_0x445c2b(0x1ad)]||'trapay_bot',this[_0x445c2b(0x1ca)]?this[_0x445c2b(0x179)]():console['warn'](_0x445c2b(0x1d2));}['initializeBot'](){const _0x367e3a=a57_0x1cf379;try{this['bot']=new node_telegram_bot_api_1[(_0x367e3a(0x216))](this[_0x367e3a(0x1ca)],{'polling':!![]}),this[_0x367e3a(0x1e6)](),console[_0x367e3a(0x155)](_0x367e3a(0x151)+this['botUsername']+_0x367e3a(0x1cf));}catch(_0x562e01){console[_0x367e3a(0x165)](_0x367e3a(0x1f0),_0x562e01);}}[a57_0x1cf379(0x1e6)](){const _0x242513=a57_0x1cf379;if(!this[_0x242513(0x1f7)])return;this[_0x242513(0x1f7)]['onText'](/\/start/,async _0x10848a=>{const _0x583879=_0x242513,_0x2d6ac8=_0x10848a[_0x583879(0x16d)]['id'],_0x3e83ac=_0x10848a[_0x583879(0x1a6)]?.['id'][_0x583879(0x197)](),_0x52ae7a=_0x10848a[_0x583879(0x1a6)]?.[_0x583879(0x1a7)],_0x556bfc=_0x10848a[_0x583879(0x1a6)]?.[_0x583879(0x188)],_0x4a1302=_0x10848a[_0x583879(0x1a6)]?.[_0x583879(0x1b3)];if(!_0x3e83ac)return;try{let _0x9ef7f5=await database_1['default'][_0x583879(0x14c)][_0x583879(0x16e)]({'where':{'telegramId':_0x3e83ac},'include':{'shop':!![]}});!_0x9ef7f5?(_0x9ef7f5=await database_1[_0x583879(0x216)]['telegramUser'][_0x583879(0x1af)]({'data':{'telegramId':_0x3e83ac,'username':_0x52ae7a,'firstName':_0x556bfc,'lastName':_0x4a1302,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x583879(0x155)](_0x583879(0x1f5)+_0x3e83ac+_0x583879(0x176)+_0x52ae7a+')')):_0x9ef7f5=await database_1[_0x583879(0x216)]['telegramUser']['update']({'where':{'telegramId':_0x3e83ac},'data':{'username':_0x52ae7a,'firstName':_0x556bfc,'lastName':_0x4a1302},'include':{'shop':!![]}}),_0x9ef7f5['isVerified']&&_0x9ef7f5[_0x583879(0x14a)]&&_0x9ef7f5['shop']?await this['bot']?.[_0x583879(0x1de)](_0x2d6ac8,_0x583879(0x16c)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x9ef7f5['shop']['name']+'*\x0a')+(_0x583879(0x143)+_0x9ef7f5['shop'][_0x583879(0x1a7)]+'`\x0a\x0a')+_0x583879(0x148)+_0x583879(0x180)+_0x583879(0x1e0)+_0x583879(0x1bc)+_0x583879(0x20b)+_0x583879(0x1c2)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':'Markdown'}):(_0x9ef7f5['shopId']&&!_0x9ef7f5[_0x583879(0x170)]&&(await database_1[_0x583879(0x216)][_0x583879(0x14c)][_0x583879(0x17d)]({'where':{'telegramId':_0x3e83ac},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x583879(0x20c)+_0x3e83ac)),await this[_0x583879(0x1f7)]?.[_0x583879(0x1de)](_0x2d6ac8,_0x583879(0x1c1)+_0x583879(0x156)+_0x583879(0x1b8)+_0x583879(0x190)+_0x583879(0x1fd)+_0x583879(0x1a8),{'parse_mode':'Markdown'}));}catch(_0x28af30){console['error']('Error\x20handling\x20/start\x20command:',_0x28af30),await this['bot']?.['sendMessage'](_0x2d6ac8,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x242513(0x1f7)]['onText'](/\/disconnect/,async _0x166ff6=>{const _0x452259=_0x242513,_0x46206d=_0x166ff6[_0x452259(0x16d)]['id'],_0x552779=_0x166ff6['from']?.['id'][_0x452259(0x197)]();if(!_0x552779)return;try{const _0x5b4040=await database_1[_0x452259(0x216)][_0x452259(0x14c)]['findUnique']({'where':{'telegramId':_0x552779},'include':{'shop':!![]}});if(!_0x5b4040||!_0x5b4040[_0x452259(0x170)]||!_0x5b4040[_0x452259(0x14a)]){await this[_0x452259(0x1f7)]?.[_0x452259(0x1de)](_0x46206d,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x2384cc=_0x5b4040[_0x452259(0x152)]?.['name']||_0x452259(0x1a5);await database_1['default'][_0x452259(0x14c)][_0x452259(0x17d)]({'where':{'telegramId':_0x552779},'data':{'shopId':null,'isVerified':![]}}),console[_0x452259(0x155)](_0x452259(0x21e)+_0x552779+_0x452259(0x1ce)+_0x5b4040[_0x452259(0x14a)]),await this[_0x452259(0x1f7)]?.[_0x452259(0x1de)](_0x46206d,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x2384cc+_0x452259(0x1f2)+_0x452259(0x209),{'parse_mode':_0x452259(0x1c4)});}catch(_0x5224bb){console['error'](_0x452259(0x144),_0x5224bb),await this[_0x452259(0x1f7)]?.['sendMessage'](_0x46206d,_0x452259(0x166));}}),this[_0x242513(0x1f7)][_0x242513(0x219)](/\/status/,async _0x210f96=>{const _0x2b7fdb=_0x242513,_0x415919=_0x210f96[_0x2b7fdb(0x16d)]['id'],_0xc814de=_0x210f96[_0x2b7fdb(0x1a6)]?.['id'][_0x2b7fdb(0x197)]();if(!_0xc814de)return;try{const _0x3594b3=await database_1[_0x2b7fdb(0x216)][_0x2b7fdb(0x14c)][_0x2b7fdb(0x16e)]({'where':{'telegramId':_0xc814de},'include':{'shop':!![]}});if(!_0x3594b3){await this[_0x2b7fdb(0x1f7)]?.[_0x2b7fdb(0x1de)](_0x415919,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x2b7fdb(0x147));return;}if(!_0x3594b3[_0x2b7fdb(0x170)]||!_0x3594b3[_0x2b7fdb(0x14a)]||!_0x3594b3[_0x2b7fdb(0x152)]){await this[_0x2b7fdb(0x1f7)]?.[_0x2b7fdb(0x1de)](_0x415919,'❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+'Use\x20/start\x20to\x20connect.');return;}await this[_0x2b7fdb(0x1f7)]?.[_0x2b7fdb(0x1de)](_0x415919,_0x2b7fdb(0x1d5)+(_0x2b7fdb(0x19e)+_0x3594b3[_0x2b7fdb(0x152)][_0x2b7fdb(0x160)]+'*\x0a')+(_0x2b7fdb(0x17f)+_0x3594b3['shop'][_0x2b7fdb(0x1a7)]+'`\x0a')+(_0x2b7fdb(0x164)+_0x3594b3[_0x2b7fdb(0x183)][_0x2b7fdb(0x153)](_0x2b7fdb(0x15e))+'\x0a\x0a')+_0x2b7fdb(0x189)+_0x2b7fdb(0x20b)+_0x2b7fdb(0x21f),{'parse_mode':_0x2b7fdb(0x1c4)});}catch(_0x5929ac){console[_0x2b7fdb(0x165)](_0x2b7fdb(0x15f),_0x5929ac),await this['bot']?.[_0x2b7fdb(0x1de)](_0x415919,_0x2b7fdb(0x166));}}),this[_0x242513(0x1f7)][_0x242513(0x219)](/\/debug/,async _0x27e3fc=>{const _0x2277c4=_0x242513,_0x489549=_0x27e3fc['chat']['id'],_0x10ba50=_0x27e3fc[_0x2277c4(0x1a6)]?.['id'][_0x2277c4(0x197)]();if(!_0x10ba50)return;try{const _0x1f1e61=await database_1[_0x2277c4(0x216)][_0x2277c4(0x152)][_0x2277c4(0x18b)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x32647f=_0x2277c4(0x172);_0x32647f+='📱\x20Your\x20Telegram\x20ID:\x20`'+_0x10ba50+_0x2277c4(0x1c6),_0x32647f+=_0x2277c4(0x203),_0x1f1e61[_0x2277c4(0x1da)]((_0x54e4f0,_0x3d47c4)=>{const _0x368813=_0x2277c4;_0x32647f+=_0x3d47c4+0x1+_0x368813(0x1b1)+_0x54e4f0[_0x368813(0x160)]+'*\x0a',_0x32647f+=_0x368813(0x1fc)+_0x54e4f0['username']+'`\x0a',_0x32647f+=_0x368813(0x169)+_0x54e4f0[_0x368813(0x222)]+'\x0a',_0x32647f+=_0x368813(0x16f)+_0x54e4f0[_0x368813(0x1ef)][_0x368813(0x1df)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x2277c4(0x1f7)]?.[_0x2277c4(0x1de)](_0x489549,_0x32647f,{'parse_mode':_0x2277c4(0x1c4)});}catch(_0x49f789){console['error']('Error\x20handling\x20/debug\x20command:',_0x49f789),await this[_0x2277c4(0x1f7)]?.[_0x2277c4(0x1de)](_0x489549,_0x2277c4(0x15c));}}),this[_0x242513(0x1f7)]['on'](_0x242513(0x208),async _0x3a52e1=>{const _0x304918=_0x242513;if(_0x3a52e1['text']?.[_0x304918(0x1ae)]('/'))return;const _0x4b5600=_0x3a52e1[_0x304918(0x16d)]['id'],_0x8c607=_0x3a52e1[_0x304918(0x1a6)]?.['id']['toString'](),_0x5a7348=_0x3a52e1['text']?.[_0x304918(0x198)]();if(!_0x8c607||!_0x5a7348)return;try{const _0x7ba6cd=await database_1['default'][_0x304918(0x14c)][_0x304918(0x16e)]({'where':{'telegramId':_0x8c607},'include':{'shop':!![]}});if(!_0x7ba6cd){await this[_0x304918(0x1f7)]?.[_0x304918(0x1de)](_0x4b5600,'❌\x20Please\x20use\x20/start\x20command\x20first');return;}if(_0x7ba6cd[_0x304918(0x170)]&&_0x7ba6cd[_0x304918(0x14a)]&&_0x7ba6cd[_0x304918(0x152)]){await this[_0x304918(0x1f7)]?.[_0x304918(0x1de)](_0x4b5600,_0x304918(0x1ee)+_0x7ba6cd['shop'][_0x304918(0x160)]+_0x304918(0x1f2)+_0x304918(0x204),{'parse_mode':_0x304918(0x1c4)});return;}const _0x25ea78=_0x5a7348['split'](/\s+/);if(_0x25ea78['length']!==0x2){await this['bot']?.['sendMessage'](_0x4b5600,_0x304918(0x17e)+_0x304918(0x1b8)+_0x304918(0x190)+_0x304918(0x1fd)+('You\x20sent\x20'+_0x25ea78['length']+_0x304918(0x201)+_0x25ea78['map'](_0x2e2b10=>'`'+_0x2e2b10+'`')[_0x304918(0x199)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x2b41c9,_0x40d613]=_0x25ea78;console[_0x304918(0x155)](_0x304918(0x21c)+_0x8c607+_0x304918(0x1b0)+_0x2b41c9+_0x304918(0x19f)+_0x40d613[_0x304918(0x1df)](0x0,0xa)+'...\x22'),await this['handleSingleLineVerification'](_0x4b5600,_0x8c607,_0x2b41c9,_0x40d613);}catch(_0x1a41a3){console[_0x304918(0x165)](_0x304918(0x220),_0x1a41a3),await this[_0x304918(0x1f7)]?.[_0x304918(0x1de)](_0x4b5600,_0x304918(0x166));}}),this[_0x242513(0x1f7)]['on'](_0x242513(0x165),_0x104d09=>{const _0x23a4c7=_0x242513;console[_0x23a4c7(0x165)](_0x23a4c7(0x1e1),_0x104d09);}),this[_0x242513(0x1f7)]['on'](_0x242513(0x14b),_0x1a18d0=>{const _0x32cd9c=_0x242513;console[_0x32cd9c(0x165)](_0x32cd9c(0x191),_0x1a18d0);});}async[a57_0x1cf379(0x1ab)](_0x430b38,_0x551ceb,_0x156e76,_0x5bf3e3){const _0x43421f=a57_0x1cf379;try{console[_0x43421f(0x155)](_0x43421f(0x21c)+_0x551ceb+_0x43421f(0x1b0)+_0x156e76+'\x22,\x20apiKey=\x22'+_0x5bf3e3[_0x43421f(0x1df)](0x0,0xa)+_0x43421f(0x17b));if(!_0x156e76||_0x156e76[_0x43421f(0x1aa)]<0x3||_0x156e76['length']>0x32||!/^[a-zA-Z0-9_]+$/[_0x43421f(0x19c)](_0x156e76)){await this['bot']?.['sendMessage'](_0x430b38,_0x43421f(0x1cc)+_0x156e76+_0x43421f(0x1c6)+_0x43421f(0x154),{'parse_mode':_0x43421f(0x1c4)});return;}if(!_0x5bf3e3||!_0x5bf3e3['startsWith']('pk_')&&!_0x5bf3e3[_0x43421f(0x1ae)](_0x43421f(0x184))){await this[_0x43421f(0x1f7)]?.[_0x43421f(0x1de)](_0x430b38,_0x43421f(0x200)+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x43421f(0x1c4)});return;}const _0x5608ab=await database_1[_0x43421f(0x216)][_0x43421f(0x152)][_0x43421f(0x16e)]({'where':{'username':_0x156e76},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x5608ab){const _0x3115ab=await database_1[_0x43421f(0x216)][_0x43421f(0x152)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x5900e5=_0x43421f(0x174)+_0x156e76+'`\x20not\x20found.\x0a\x0a';_0x3115ab['length']>0x0?(_0x5900e5+=_0x43421f(0x19d),_0x3115ab['forEach'](_0x37ce55=>{const _0x29e3f8=_0x43421f;_0x5900e5+=_0x29e3f8(0x159)+_0x37ce55[_0x29e3f8(0x1a7)]+'`\x20('+_0x37ce55[_0x29e3f8(0x160)]+')\x0a';}),_0x5900e5+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x5900e5+='Check\x20spelling\x20and\x20try\x20again.';await this[_0x43421f(0x1f7)]?.[_0x43421f(0x1de)](_0x430b38,_0x5900e5,{'parse_mode':'Markdown'});return;}if(_0x5608ab[_0x43421f(0x222)]!==_0x43421f(0x1ec)){await this[_0x43421f(0x1f7)]?.[_0x43421f(0x1de)](_0x430b38,_0x43421f(0x1a4)+_0x156e76+_0x43421f(0x1c0)+'Contact\x20administrator.',{'parse_mode':_0x43421f(0x1c4)});return;}if(_0x5608ab[_0x43421f(0x1ef)]!==_0x5bf3e3&&_0x5608ab[_0x43421f(0x181)]!==_0x5bf3e3){await this[_0x43421f(0x1f7)]?.[_0x43421f(0x1de)](_0x430b38,_0x43421f(0x1d0)+_0x156e76+_0x43421f(0x1c8)+'Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a'+_0x43421f(0x1ff),{'parse_mode':_0x43421f(0x1c4)});return;}const _0xb76a02=await database_1[_0x43421f(0x216)][_0x43421f(0x14c)][_0x43421f(0x1fe)]({'where':{'shopId':_0x5608ab['id'],'isVerified':!![],'telegramId':{'not':_0x551ceb}}});if(_0xb76a02){await this[_0x43421f(0x1f7)]?.[_0x43421f(0x1de)](_0x430b38,_0x43421f(0x18a)+_0x156e76+_0x43421f(0x1c8)+_0x43421f(0x213),{'parse_mode':_0x43421f(0x1c4)});return;}await database_1['default'][_0x43421f(0x14c)]['update']({'where':{'telegramId':_0x551ceb},'data':{'shopId':_0x5608ab['id'],'isVerified':!![]}}),await this['bot']?.[_0x43421f(0x1de)](_0x430b38,_0x43421f(0x1e9)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x43421f(0x173)+_0x5608ab[_0x43421f(0x160)]+'*\x0a')+(_0x43421f(0x17f)+_0x5608ab['username']+_0x43421f(0x1c6))+_0x43421f(0x1f1)+_0x43421f(0x180)+_0x43421f(0x1e0)+_0x43421f(0x168)+'•\x20Important\x20events\x0a\x0a'+'Commands:\x0a'+_0x43421f(0x1c2)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x43421f(0x1c4)}),console[_0x43421f(0x155)](_0x43421f(0x1d4)+_0x551ceb+'\x20verified\x20for\x20shop\x20'+_0x5608ab['username']+_0x43421f(0x1e8));}catch(_0x57d824){console[_0x43421f(0x165)](_0x43421f(0x1eb),_0x57d824),await this[_0x43421f(0x1f7)]?.['sendMessage'](_0x430b38,_0x43421f(0x1c3));}}async[a57_0x1cf379(0x21d)](_0x4159f0,_0x17d688,_0x1d2581){const _0x213a04=a57_0x1cf379;if(!this[_0x213a04(0x1f7)]){console['warn'](_0x213a04(0x1cd));return;}try{const _0x4ab1a9=await database_1[_0x213a04(0x216)][_0x213a04(0x14c)][_0x213a04(0x18b)]({'where':{'shopId':_0x4159f0,'isVerified':!![]}});if(_0x4ab1a9['length']===0x0){console[_0x213a04(0x155)]('No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20'+_0x4159f0);return;}const _0x282545=_0x4ab1a9[_0x213a04(0x20e)](async _0x2830dc=>{const _0x3893a7=_0x213a04;try{await this[_0x3893a7(0x1f7)]?.['sendMessage'](_0x2830dc[_0x3893a7(0x1e4)],_0x17d688,_0x1d2581),console[_0x3893a7(0x155)](_0x3893a7(0x182)+_0x2830dc[_0x3893a7(0x1e4)]);}catch(_0x4acdfc){console[_0x3893a7(0x165)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x2830dc[_0x3893a7(0x1e4)]+':',_0x4acdfc),_0x4acdfc instanceof Error&&(_0x4acdfc[_0x3893a7(0x208)][_0x3893a7(0x163)](_0x3893a7(0x207))||_0x4acdfc[_0x3893a7(0x208)][_0x3893a7(0x163)]('chat\x20not\x20found')||_0x4acdfc[_0x3893a7(0x208)][_0x3893a7(0x163)](_0x3893a7(0x185)))&&(await database_1['default'][_0x3893a7(0x14c)][_0x3893a7(0x17d)]({'where':{'id':_0x2830dc['id']},'data':{'isVerified':![]}}),console['log'](_0x3893a7(0x205)+_0x2830dc[_0x3893a7(0x1e4)]+_0x3893a7(0x15b)));}});await Promise[_0x213a04(0x21a)](_0x282545);}catch(_0x4356cd){console[_0x213a04(0x165)](_0x213a04(0x171),_0x4356cd);}}async[a57_0x1cf379(0x1e7)](_0x54b853,_0x5f3156,_0x54e8f7){const _0x1fe37e=a57_0x1cf379,_0x21e8ad={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x5182d5={'created':_0x1fe37e(0x1f8),'paid':_0x1fe37e(0x1e5),'failed':'Payment\x20failed','expired':_0x1fe37e(0x1bb),'refund':_0x1fe37e(0x202),'chargeback':_0x1fe37e(0x20f),'processing':'Payment\x20is\x20being\x20processed'},_0x36e54f=_0x21e8ad[_0x54e8f7],_0x1d32c2=_0x5182d5[_0x54e8f7],_0xbf7f7e=(0x0,gateway_1[_0x1fe37e(0x20d)])(_0x5f3156['gateway']);console[_0x1fe37e(0x155)]('📱\x20Telegram\x20notification:\x20gateway\x20\x22'+_0x5f3156[_0x1fe37e(0x218)]+'\x22\x20->\x20display\x20\x22'+_0xbf7f7e+'\x22');let _0x2c48d2=_0x36e54f+'\x20*'+_0x1d32c2+_0x1fe37e(0x1f3)+(_0x1fe37e(0x167)+_0x5f3156[_0x1fe37e(0x1d9)]+'\x20'+_0x5f3156[_0x1fe37e(0x1a9)]+'*\x0a')+(_0x1fe37e(0x1ed)+(_0x5f3156['orderId']||_0x5f3156['id'])+'`\x0a')+(_0x1fe37e(0x215)+_0x5f3156['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0xbf7f7e+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x5f3156[_0x1fe37e(0x1b6)])[_0x1fe37e(0x196)](_0x1fe37e(0x15e))+'\x0a');if(_0x5f3156[_0x1fe37e(0x1b4)]||_0x5f3156['customerEmail']||_0x5f3156[_0x1fe37e(0x1dc)]||_0x5f3156[_0x1fe37e(0x19a)]||_0x5f3156[_0x1fe37e(0x145)]){_0x2c48d2+=_0x1fe37e(0x1f9);_0x5f3156[_0x1fe37e(0x1b4)]&&(_0x2c48d2+=_0x1fe37e(0x211)+_0x5f3156[_0x1fe37e(0x1b4)]+'`\x0a');_0x5f3156[_0x1fe37e(0x14d)]&&(_0x2c48d2+=_0x1fe37e(0x15d)+_0x5f3156[_0x1fe37e(0x14d)]+'`\x0a');_0x5f3156[_0x1fe37e(0x1dc)]&&(_0x2c48d2+='🏦\x20IBAN:\x20`'+_0x5f3156['remitterIban']+'`\x0a');_0x5f3156['customerIp']&&(_0x2c48d2+=_0x1fe37e(0x1cb)+_0x5f3156[_0x1fe37e(0x19a)]+'`\x0a');if(_0x5f3156[_0x1fe37e(0x145)]){const _0x5ec587=_0x5f3156[_0x1fe37e(0x145)]['length']>0x32?_0x5f3156['customerUa'][_0x1fe37e(0x1df)](0x0,0x32)+_0x1fe37e(0x214):_0x5f3156['customerUa'];_0x2c48d2+=_0x1fe37e(0x1d7)+_0x5ec587+'`\x0a';}}_0x54e8f7===_0x1fe37e(0x1b2)&&_0x5f3156[_0x1fe37e(0x1ba)]&&(_0x2c48d2+='💸\x20Penalty\x20amount:\x20*'+_0x5f3156['chargebackAmount']+'\x20USDT*\x0a'),_0x54e8f7===_0x1fe37e(0x1b5)&&(_0x2c48d2+=_0x1fe37e(0x1a3)),_0x5f3156['adminNotes']&&(_0x2c48d2+=_0x1fe37e(0x1fb)+_0x5f3156['adminNotes']+'\x0a'),await this[_0x1fe37e(0x21d)](_0x54b853,_0x2c48d2,{'parse_mode':_0x1fe37e(0x1c4)});}async[a57_0x1cf379(0x149)](_0x2a258e,_0x19cef2,_0x3a8218){const _0x1a2b52=a57_0x1cf379,_0xfc1505={'created':'📤','completed':'✅','rejected':'❌'},_0x3eb889={'created':_0x1a2b52(0x187),'completed':'Payout\x20completed','rejected':_0x1a2b52(0x1bd)},_0x451f03=_0xfc1505[_0x3a8218],_0x302751=_0x3eb889[_0x3a8218],_0x3d22a7=_0x451f03+'\x20*'+_0x302751+'*\x0a\x0a'+(_0x1a2b52(0x1c7)+_0x19cef2[_0x1a2b52(0x1d9)]+_0x1a2b52(0x178))+(_0x1a2b52(0x1d1)+_0x19cef2[_0x1a2b52(0x221)]+'`\x0a')+(_0x1a2b52(0x1b7)+_0x19cef2['id']+'`\x0a')+('📅\x20Date:\x20'+new Date(_0x19cef2[_0x1a2b52(0x1b6)])['toLocaleString'](_0x1a2b52(0x15e))+'\x0a')+(_0x19cef2[_0x1a2b52(0x186)]?_0x1a2b52(0x15a)+_0x19cef2[_0x1a2b52(0x186)]+'`':'');await this[_0x1a2b52(0x21d)](_0x2a258e,_0x3d22a7,{'parse_mode':_0x1a2b52(0x1c4)});}async[a57_0x1cf379(0x1ac)](_0x180fe9,_0x7293fa){const _0x259b6a=a57_0x1cf379;try{const _0x2ca974=await database_1[_0x259b6a(0x216)][_0x259b6a(0x18f)][_0x259b6a(0x16e)]({'where':{'shopId':_0x180fe9},'select':{'notificationLogin':!![]}});if(!_0x2ca974?.[_0x259b6a(0x1b9)]){console['log']('📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20'+_0x180fe9);return;}const _0x3307dd=_0x7293fa[_0x259b6a(0x1bf)]?'🔐':'🚨',_0x52058f=_0x7293fa['success']?_0x259b6a(0x14e):_0x259b6a(0x1a2);let _0x1034f6=_0x3307dd+'\x20*'+_0x52058f+_0x259b6a(0x1f3)+(_0x259b6a(0x17f)+_0x7293fa[_0x259b6a(0x1a7)]+'`\x0a')+(_0x259b6a(0x146)+_0x7293fa[_0x259b6a(0x1a1)][_0x259b6a(0x196)](_0x259b6a(0x15e))+'\x0a');_0x7293fa[_0x259b6a(0x195)]&&(_0x1034f6+=_0x259b6a(0x212)+_0x7293fa[_0x259b6a(0x195)]+'`\x0a');if(_0x7293fa[_0x259b6a(0x194)]){const _0x4a0bf5=_0x7293fa[_0x259b6a(0x194)]['length']>0x32?_0x7293fa['userAgent'][_0x259b6a(0x1df)](0x0,0x32)+_0x259b6a(0x214):_0x7293fa[_0x259b6a(0x194)];_0x1034f6+='💻\x20Browser:\x20`'+_0x4a0bf5+'`\x0a';}!_0x7293fa[_0x259b6a(0x1bf)]&&(_0x1034f6+='\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!'),await this['sendShopNotification'](_0x180fe9,_0x1034f6,{'parse_mode':_0x259b6a(0x1c4)}),console[_0x259b6a(0x155)](_0x259b6a(0x18e)+_0x180fe9+':\x20'+(_0x7293fa[_0x259b6a(0x1bf)]?'success':'failed'));}catch(_0x3135a1){console[_0x259b6a(0x165)](_0x259b6a(0x1d6),_0x3135a1);}}async[a57_0x1cf379(0x162)](_0x29bd3a,_0x49df71){const _0x1a681e=a57_0x1cf379;try{const _0x5a23b1=await database_1[_0x1a681e(0x216)][_0x1a681e(0x18f)][_0x1a681e(0x16e)]({'where':{'shopId':_0x29bd3a},'select':{'notificationApiError':!![]}});if(!_0x5a23b1?.[_0x1a681e(0x1c9)]){console[_0x1a681e(0x155)](_0x1a681e(0x17a)+_0x29bd3a);return;}let _0x172d9f=_0x1a681e(0x1d8)+('🔗\x20Endpoint:\x20`'+_0x49df71['method']+'\x20'+_0x49df71[_0x1a681e(0x217)]+'`\x0a')+(_0x1a681e(0x146)+_0x49df71[_0x1a681e(0x1a1)][_0x1a681e(0x196)](_0x1a681e(0x15e))+'\x0a');_0x49df71[_0x1a681e(0x150)]&&(_0x172d9f+=_0x1a681e(0x206)+_0x49df71['statusCode']+'`\x0a'),_0x172d9f+=_0x1a681e(0x1f6)+_0x49df71[_0x1a681e(0x20a)]+'`\x0a',_0x49df71[_0x1a681e(0x1d3)]&&(_0x172d9f+=_0x1a681e(0x1e3)+_0x49df71['requestId']+'`\x0a'),_0x172d9f+=_0x1a681e(0x1e2),await this[_0x1a681e(0x21d)](_0x29bd3a,_0x172d9f,{'parse_mode':'Markdown'}),console[_0x1a681e(0x155)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x29bd3a+':\x20'+_0x49df71[_0x1a681e(0x217)]);}catch(_0x7764f4){console['error'](_0x1a681e(0x17c),_0x7764f4);}}async[a57_0x1cf379(0x177)](_0x1c75c1,_0xeacc7d,_0x3bcc7d){const _0x4ee50f=a57_0x1cf379;let _0x5be450=_0x4ee50f(0x158)+_0xeacc7d+_0x4ee50f(0x1f3);for(const [_0x5b6d0e,_0x225218]of Object[_0x4ee50f(0x210)](_0x3bcc7d)){_0x225218!==null&&_0x225218!==undefined&&(_0x5be450+=_0x5b6d0e+':\x20`'+_0x225218+'`\x0a');}await this[_0x4ee50f(0x21d)](_0x1c75c1,_0x5be450,{'parse_mode':'Markdown'});}[a57_0x1cf379(0x193)](){const _0xa34556=a57_0x1cf379;return{'isActive':!!this[_0xa34556(0x1f7)],'username':this['botUsername']};}['stopBot'](){const _0x20aefb=a57_0x1cf379;this['bot']&&(this[_0x20aefb(0x1f7)]['stopPolling'](),this['bot']=null,console[_0x20aefb(0x155)]('🛑\x20Telegram\x20bot\x20stopped'));}}exports[a57_0x1cf379(0x1c5)]=TelegramBotService,exports[a57_0x1cf379(0x1a0)]=new TelegramBotService();