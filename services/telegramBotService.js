'use strict';const a54_0x1261a1=a54_0x34ed;(function(_0x11d7b1,_0xb92e53){const _0x5c1b5f=a54_0x34ed,_0x14f5eb=_0x11d7b1();while(!![]){try{const _0x431e7f=-parseInt(_0x5c1b5f(0x79))/0x1*(parseInt(_0x5c1b5f(0x107))/0x2)+parseInt(_0x5c1b5f(0x95))/0x3+-parseInt(_0x5c1b5f(0xa5))/0x4+-parseInt(_0x5c1b5f(0x9e))/0x5+parseInt(_0x5c1b5f(0x11e))/0x6+parseInt(_0x5c1b5f(0x11a))/0x7*(-parseInt(_0x5c1b5f(0x13f))/0x8)+parseInt(_0x5c1b5f(0xba))/0x9;if(_0x431e7f===_0xb92e53)break;else _0x14f5eb['push'](_0x14f5eb['shift']());}catch(_0x23ad80){_0x14f5eb['push'](_0x14f5eb['shift']());}}}(a54_0x48e6,0xf2cd4));var __importDefault=this&&this[a54_0x1261a1(0x97)]||function(_0x2608da){return _0x2608da&&_0x2608da['__esModule']?_0x2608da:{'default':_0x2608da};};Object[a54_0x1261a1(0x14a)](exports,'__esModule',{'value':!![]}),exports[a54_0x1261a1(0xe1)]=exports['TelegramBotService']=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a54_0x1261a1(0x98))),database_1=__importDefault(require(a54_0x1261a1(0x111))),gateway_1=require(a54_0x1261a1(0x142));function a54_0x34ed(_0x1e1698,_0x50f897){const _0x48e662=a54_0x48e6();return a54_0x34ed=function(_0x34edf0,_0x2b1db2){_0x34edf0=_0x34edf0-0x66;let _0x4ab6dd=_0x48e662[_0x34edf0];return _0x4ab6dd;},a54_0x34ed(_0x1e1698,_0x50f897);}function a54_0x48e6(){const _0xd00f5e=['name','🔔\x20*','🔌\x20User\x20','customerName','\x20\x20\x20Username:\x20`','✅\x20Connected\x20to\x20shop:\x20*','sendPaymentNotification','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','•\x20Payment\x20status\x20changes\x0a','toLocaleString','username','Error\x20in\x20handleSingleLineVerification:','📅\x20Connection\x20date:\x20','blocked','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','Payment\x20successfully\x20paid','📝\x20Notes:\x20','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','findFirst','remitterIban','chat\x20not\x20found','Error\x20handling\x20/start\x20command:','✅\x20Telegram\x20user\x20','message','isVerified','❌\x20Error:\x20`','🆔\x20Payment\x20ID:\x20`','Error\x20sending\x20shop\x20notification:','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','•\x20Important\x20events\x0a\x0a','orderId','📝\x20Order\x20ID:\x20`','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','2434TOEzwC','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','*\x0a\x0a','•\x20New\x20payments\x0a','\x20\x20\x20Status:\x20','🚨\x20*API\x20Error*\x0a\x0a','💰\x20Amount:\x20*','💸\x20Penalty\x20amount:\x20*','stopBot','Use\x20/start\x20to\x20connect.','../config/database','findMany','❌\x20Please\x20use\x20/start\x20command\x20first','🛑\x20Telegram\x20bot\x20stopped','❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','🏪\x20Available\x20shops\x20in\x20system:\x0a',':\x20username=\x22','Contact\x20administrator.','TELEGRAM_BOT_USERNAME','63UkYTga','To\x20reconnect,\x20use\x20the\x20/start\x20command','❌\x20Error\x20getting\x20debug\x20information.','...`\x0a\x0a','2257338OfaPdr','`.\x0a\x0a','currency','❌\x20Shop\x20`','❌\x20Invalid\x20username\x20format:\x20`','customerUa','chargeback','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','timestamp','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','TELEGRAM_BOT_TOKEN','substring','chat','Error\x20handling\x20/status\x20command:','ACTIVE','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','Telegram\x20bot\x20polling\x20error:','Commands:\x0a','\x20parts:\x20','errorMessage','failed','polling_error','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','Username:\x20`','map','gateway','telegramId','Payment\x20expired','sendMessage','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','update','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','💸\x20Amount:\x20*','474840yqAZDI','getGatewayDisplayNameForTelegram','You\x20are\x20already\x20connected\x20to\x20shop:\x20*','../types/gateway','publicKey','\x20USD*\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','•\x20Payouts\x0a\x0a','toString','Payout\x20rejected','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','defineProperty','Available\x20usernames:\x0a','sendPayoutNotification','/status\x20-\x20check\x20connection\x20status\x0a','text','ipAddress','includes','getBotInfo','🌐\x20IP:\x20`','*.\x0a\x0a','adminNotes','statusCode','success','processing','Successful\x20login','customerIp','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','/disconnect\x20-\x20disconnect\x20from\x20notifications','\x20\x20\x20Public\x20Key:\x20`','Failed\x20login\x20attempt','\x22\x20->\x20display\x20\x22','toLocaleDateString','error','secretKey','startsWith','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','log','createdAt','955oJmDrf','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','method','requestId','notificationApiError','Example:\x0a','sendCustomNotification','\x20via\x20single-line\x20input','\x20USDT*\x0a','notificationLogin','🌐\x20IP\x20address:\x20`','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','`\x20is\x20inactive.\x0a\x0a','last_name','📅\x20Time:\x20','Telegram\x20bot\x20error:','`\x0a\x0a','amount','shopSettings','\x20verified\x20for\x20shop\x20','📱\x20Your\x20Telegram\x20ID:\x20`','status','trapay_bot','\x0a👤\x20*Customer\x20Information:*\x0a','🔔\x20You\x20receive\x20notifications\x20about:\x0a','warn',':\x20`','2994639vMidvQ','📅\x20Date:\x20','__importDefault','node-telegram-bot-api','...\x22','findUnique','setupBotHandlers','stopPolling','botUsername','5940695OCJKVg','sendLoginNotification','📊\x20Error\x20code:\x20`','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','env','sk_','New\x20payout\x20created','2915228CMmeSB','telegramUser','Error\x20handling\x20/debug\x20command:','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','👤\x20Username:\x20`','✅\x20Telegram\x20bot\x20@','split','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','🎉\x20*Congratulations!*\x0a\x0a','initializeBot','New\x20payment\x20created','en-US','Payment\x20chargeback','🏦\x20Method:\x20`','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','\x20disconnected\x20from\x20shop\x20','User\x20','Error\x20handling\x20message:','length','shop','29101104eaZdbt','Payment\x20refund','Failed\x20to\x20send\x20API\x20error\x20notification:','⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','allSettled','\x20(@','🔍\x20*Debug\x20Information*\x0a\x0a','endpoint','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','default','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','shopId','updatedAt','You\x20sent\x20','bot','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','Payout\x20completed','userAgent','.\x20*','forEach','Payment\x20is\x20being\x20processed','handleSingleLineVerification','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','from','\x0aCheck\x20spelling\x20and\x20try\x20again.','txid','🏦\x20IBAN:\x20`','❌\x20Shop\x20with\x20username\x20`','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','chargebackAmount','trim','onText','`\x20not\x20found.\x0a\x0a','Markdown','📊\x20*Connection\x20Status*\x0a\x0a','sendShopNotification','customerEmail','\x22,\x20apiKey=\x22','telegramBotService','unknown\x20shop','🔗\x20Endpoint:\x20`','✅\x20Welcome\x20back!\x0a\x0a'];a54_0x48e6=function(){return _0xd00f5e;};return a54_0x48e6();}class TelegramBotService{constructor(){const _0x4d960a=a54_0x1261a1;this[_0x4d960a(0xc8)]=null,this['botToken']=process[_0x4d960a(0xa2)][_0x4d960a(0x128)]||'',this[_0x4d960a(0x9d)]=process['env'][_0x4d960a(0x119)]||_0x4d960a(0x90),this['botToken']?this[_0x4d960a(0xaf)]():console[_0x4d960a(0x93)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a54_0x1261a1(0xaf)](){const _0x3e179a=a54_0x1261a1;try{this[_0x3e179a(0xc8)]=new node_telegram_bot_api_1[(_0x3e179a(0xc3))](this['botToken'],{'polling':!![]}),this[_0x3e179a(0x9b)](),console[_0x3e179a(0x77)](_0x3e179a(0xaa)+this[_0x3e179a(0x9d)]+'\x20initialized\x20successfully');}catch(_0x4171f5){console[_0x3e179a(0x73)](_0x3e179a(0xf6),_0x4171f5);}}[a54_0x1261a1(0x9b)](){const _0x2adecb=a54_0x1261a1;if(!this[_0x2adecb(0xc8)])return;this[_0x2adecb(0xc8)][_0x2adecb(0xda)](/\/start/,async _0x48729d=>{const _0x5ba2e7=_0x2adecb,_0x4d56cf=_0x48729d[_0x5ba2e7(0x12a)]['id'],_0x13ee64=_0x48729d['from']?.['id'][_0x5ba2e7(0x147)](),_0x7f63ad=_0x48729d[_0x5ba2e7(0xd2)]?.[_0x5ba2e7(0xef)],_0x46bcb9=_0x48729d[_0x5ba2e7(0xd2)]?.['first_name'],_0x4d65d9=_0x48729d[_0x5ba2e7(0xd2)]?.[_0x5ba2e7(0x87)];if(!_0x13ee64)return;try{let _0x5dbe34=await database_1[_0x5ba2e7(0xc3)][_0x5ba2e7(0xa6)][_0x5ba2e7(0x9a)]({'where':{'telegramId':_0x13ee64},'include':{'shop':!![]}});!_0x5dbe34?(_0x5dbe34=await database_1['default'][_0x5ba2e7(0xa6)]['create']({'data':{'telegramId':_0x13ee64,'username':_0x7f63ad,'firstName':_0x46bcb9,'lastName':_0x4d65d9,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console['log']('📱\x20Created\x20new\x20Telegram\x20user:\x20'+_0x13ee64+_0x5ba2e7(0xbf)+_0x7f63ad+')')):_0x5dbe34=await database_1['default'][_0x5ba2e7(0xa6)][_0x5ba2e7(0x13c)]({'where':{'telegramId':_0x13ee64},'data':{'username':_0x7f63ad,'firstName':_0x46bcb9,'lastName':_0x4d65d9},'include':{'shop':!![]}}),_0x5dbe34['isVerified']&&_0x5dbe34[_0x5ba2e7(0xc5)]&&_0x5dbe34['shop']?await this[_0x5ba2e7(0xc8)]?.['sendMessage'](_0x4d56cf,_0x5ba2e7(0xe4)+(_0x5ba2e7(0x141)+_0x5dbe34[_0x5ba2e7(0xb9)]['name']+'*\x0a')+(_0x5ba2e7(0x135)+_0x5dbe34['shop'][_0x5ba2e7(0xef)]+_0x5ba2e7(0x8a))+_0x5ba2e7(0x92)+'•\x20New\x20payments\x0a'+_0x5ba2e7(0xed)+_0x5ba2e7(0x146)+_0x5ba2e7(0x12f)+_0x5ba2e7(0x14d)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x5ba2e7(0xdc)}):(_0x5dbe34['shopId']&&!_0x5dbe34[_0x5ba2e7(0xfd)]&&(await database_1[_0x5ba2e7(0xc3)][_0x5ba2e7(0xa6)][_0x5ba2e7(0x13c)]({'where':{'telegramId':_0x13ee64},'data':{'shopId':null,'isVerified':![]}}),console[_0x5ba2e7(0x77)](_0x5ba2e7(0xf3)+_0x13ee64)),await this[_0x5ba2e7(0xc8)]?.[_0x5ba2e7(0x13a)](_0x4d56cf,'🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a'+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0x5ba2e7(0x13d)+_0x5ba2e7(0x7e)+_0x5ba2e7(0xc9)+_0x5ba2e7(0x115),{'parse_mode':_0x5ba2e7(0xdc)}));}catch(_0x5daed0){console[_0x5ba2e7(0x73)](_0x5ba2e7(0xfa),_0x5daed0),await this['bot']?.[_0x5ba2e7(0x13a)](_0x4d56cf,_0x5ba2e7(0xd7));}}),this[_0x2adecb(0xc8)][_0x2adecb(0xda)](/\/disconnect/,async _0x254784=>{const _0x3f6cab=_0x2adecb,_0x3f389f=_0x254784[_0x3f6cab(0x12a)]['id'],_0x19041e=_0x254784[_0x3f6cab(0xd2)]?.['id'][_0x3f6cab(0x147)]();if(!_0x19041e)return;try{const _0x532e04=await database_1[_0x3f6cab(0xc3)][_0x3f6cab(0xa6)][_0x3f6cab(0x9a)]({'where':{'telegramId':_0x19041e},'include':{'shop':!![]}});if(!_0x532e04||!_0x532e04[_0x3f6cab(0xfd)]||!_0x532e04[_0x3f6cab(0xc5)]){await this[_0x3f6cab(0xc8)]?.[_0x3f6cab(0x13a)](_0x3f389f,_0x3f6cab(0xad));return;}const _0x11bd1d=_0x532e04['shop']?.[_0x3f6cab(0xe5)]||_0x3f6cab(0xe2);await database_1[_0x3f6cab(0xc3)][_0x3f6cab(0xa6)][_0x3f6cab(0x13c)]({'where':{'telegramId':_0x19041e},'data':{'shopId':null,'isVerified':![]}}),console[_0x3f6cab(0x77)](_0x3f6cab(0xe7)+_0x19041e+_0x3f6cab(0xb5)+_0x532e04[_0x3f6cab(0xc5)]),await this['bot']?.[_0x3f6cab(0x13a)](_0x3f389f,_0x3f6cab(0x127)+_0x11bd1d+_0x3f6cab(0x66)+_0x3f6cab(0x11b),{'parse_mode':_0x3f6cab(0xdc)});}catch(_0x28061a){console[_0x3f6cab(0x73)]('Error\x20handling\x20/disconnect\x20command:',_0x28061a),await this['bot']?.[_0x3f6cab(0x13a)](_0x3f389f,_0x3f6cab(0xd7));}}),this[_0x2adecb(0xc8)]['onText'](/\/status/,async _0xbc14a6=>{const _0x474c1a=_0x2adecb,_0x373693=_0xbc14a6[_0x474c1a(0x12a)]['id'],_0x18c415=_0xbc14a6[_0x474c1a(0xd2)]?.['id'][_0x474c1a(0x147)]();if(!_0x18c415)return;try{const _0x483c8a=await database_1['default'][_0x474c1a(0xa6)][_0x474c1a(0x9a)]({'where':{'telegramId':_0x18c415},'include':{'shop':!![]}});if(!_0x483c8a){await this[_0x474c1a(0xc8)]?.[_0x474c1a(0x13a)](_0x373693,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+'Use\x20/start\x20to\x20begin.');return;}if(!_0x483c8a[_0x474c1a(0xfd)]||!_0x483c8a['shopId']||!_0x483c8a['shop']){await this['bot']?.[_0x474c1a(0x13a)](_0x373693,_0x474c1a(0xa1)+_0x474c1a(0x110));return;}await this['bot']?.[_0x474c1a(0x13a)](_0x373693,_0x474c1a(0xdd)+(_0x474c1a(0xea)+_0x483c8a[_0x474c1a(0xb9)][_0x474c1a(0xe5)]+'*\x0a')+(_0x474c1a(0xa9)+_0x483c8a['shop'][_0x474c1a(0xef)]+'`\x0a')+(_0x474c1a(0xf1)+_0x483c8a[_0x474c1a(0xc6)][_0x474c1a(0x72)](_0x474c1a(0xb1))+'\x0a\x0a')+'🔔\x20Notifications\x20are\x20active\x0a\x0a'+'Commands:\x0a'+_0x474c1a(0x6e),{'parse_mode':'Markdown'});}catch(_0x356849){console[_0x474c1a(0x73)](_0x474c1a(0x12b),_0x356849),await this[_0x474c1a(0xc8)]?.['sendMessage'](_0x373693,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x2adecb(0xc8)]['onText'](/\/debug/,async _0x50fdd0=>{const _0x4fd9f9=_0x2adecb,_0xcb13f0=_0x50fdd0[_0x4fd9f9(0x12a)]['id'],_0x273e96=_0x50fdd0[_0x4fd9f9(0xd2)]?.['id'][_0x4fd9f9(0x147)]();if(!_0x273e96)return;try{const _0x5784fe=await database_1['default'][_0x4fd9f9(0xb9)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x28663b=_0x4fd9f9(0xc0);_0x28663b+=_0x4fd9f9(0x8e)+_0x273e96+_0x4fd9f9(0x8a),_0x28663b+=_0x4fd9f9(0x116),_0x5784fe['forEach']((_0x2d7f41,_0xcda244)=>{const _0x111412=_0x4fd9f9;_0x28663b+=_0xcda244+0x1+_0x111412(0xcd)+_0x2d7f41['name']+'*\x0a',_0x28663b+=_0x111412(0xe9)+_0x2d7f41['username']+'`\x0a',_0x28663b+=_0x111412(0x10b)+_0x2d7f41[_0x111412(0x8f)]+'\x0a',_0x28663b+=_0x111412(0x6f)+_0x2d7f41[_0x111412(0x143)]['substring'](0x0,0xf)+_0x111412(0x11d);}),await this['bot']?.['sendMessage'](_0xcb13f0,_0x28663b,{'parse_mode':_0x4fd9f9(0xdc)});}catch(_0x7bc957){console[_0x4fd9f9(0x73)](_0x4fd9f9(0xa7),_0x7bc957),await this[_0x4fd9f9(0xc8)]?.['sendMessage'](_0xcb13f0,_0x4fd9f9(0x11c));}}),this[_0x2adecb(0xc8)]['on'](_0x2adecb(0xfc),async _0x5e281c=>{const _0x2f4adf=_0x2adecb;if(_0x5e281c[_0x2f4adf(0x14e)]?.[_0x2f4adf(0x75)]('/'))return;const _0x20fdb0=_0x5e281c[_0x2f4adf(0x12a)]['id'],_0x424f2f=_0x5e281c['from']?.['id'][_0x2f4adf(0x147)](),_0x5625ab=_0x5e281c[_0x2f4adf(0x14e)]?.[_0x2f4adf(0xd9)]();if(!_0x424f2f||!_0x5625ab)return;try{const _0x4f01bf=await database_1['default'][_0x2f4adf(0xa6)]['findUnique']({'where':{'telegramId':_0x424f2f},'include':{'shop':!![]}});if(!_0x4f01bf){await this[_0x2f4adf(0xc8)]?.['sendMessage'](_0x20fdb0,_0x2f4adf(0x113));return;}if(_0x4f01bf[_0x2f4adf(0xfd)]&&_0x4f01bf['shopId']&&_0x4f01bf['shop']){await this[_0x2f4adf(0xc8)]?.[_0x2f4adf(0x13a)](_0x20fdb0,_0x2f4adf(0x102)+_0x4f01bf['shop'][_0x2f4adf(0xe5)]+_0x2f4adf(0x66)+_0x2f4adf(0xb4),{'parse_mode':'Markdown'});return;}const _0x15fec0=_0x5625ab[_0x2f4adf(0xab)](/\s+/);if(_0x15fec0['length']!==0x2){await this['bot']?.[_0x2f4adf(0x13a)](_0x20fdb0,_0x2f4adf(0x12d)+_0x2f4adf(0x13d)+_0x2f4adf(0x7e)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0x2f4adf(0xc7)+_0x15fec0[_0x2f4adf(0xb8)]+_0x2f4adf(0x130)+_0x15fec0[_0x2f4adf(0x136)](_0x203624=>'`'+_0x203624+'`')['join'](',\x20')),{'parse_mode':_0x2f4adf(0xdc)});return;}const [_0x2c56e3,_0x365ed1]=_0x15fec0;console['log'](_0x2f4adf(0x76)+_0x424f2f+':\x20username=\x22'+_0x2c56e3+_0x2f4adf(0xe0)+_0x365ed1[_0x2f4adf(0x129)](0x0,0xa)+_0x2f4adf(0x99)),await this[_0x2f4adf(0xd0)](_0x20fdb0,_0x424f2f,_0x2c56e3,_0x365ed1);}catch(_0x3500a9){console['error'](_0x2f4adf(0xb7),_0x3500a9),await this[_0x2f4adf(0xc8)]?.[_0x2f4adf(0x13a)](_0x20fdb0,_0x2f4adf(0xd7));}}),this[_0x2adecb(0xc8)]['on']('error',_0x216c35=>{const _0x5dbdd7=_0x2adecb;console[_0x5dbdd7(0x73)](_0x5dbdd7(0x89),_0x216c35);}),this[_0x2adecb(0xc8)]['on'](_0x2adecb(0x133),_0x4ccb6f=>{const _0x514315=_0x2adecb;console[_0x514315(0x73)](_0x514315(0x12e),_0x4ccb6f);});}async['handleSingleLineVerification'](_0x79862f,_0x12236d,_0x44aedc,_0x13c86b){const _0x68de3e=a54_0x1261a1;try{console[_0x68de3e(0x77)](_0x68de3e(0x76)+_0x12236d+_0x68de3e(0x117)+_0x44aedc+_0x68de3e(0xe0)+_0x13c86b[_0x68de3e(0x129)](0x0,0xa)+_0x68de3e(0x99));if(!_0x44aedc||_0x44aedc['length']<0x3||_0x44aedc[_0x68de3e(0xb8)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x44aedc)){await this[_0x68de3e(0xc8)]?.['sendMessage'](_0x79862f,_0x68de3e(0x122)+_0x44aedc+_0x68de3e(0x8a)+_0x68de3e(0xc4),{'parse_mode':_0x68de3e(0xdc)});return;}if(!_0x13c86b||!_0x13c86b[_0x68de3e(0x75)]('pk_')&&!_0x13c86b[_0x68de3e(0x75)](_0x68de3e(0xa3))){await this[_0x68de3e(0xc8)]?.[_0x68de3e(0x13a)](_0x79862f,_0x68de3e(0x149)+_0x68de3e(0xca),{'parse_mode':_0x68de3e(0xdc)});return;}const _0x31d8ed=await database_1[_0x68de3e(0xc3)][_0x68de3e(0xb9)][_0x68de3e(0x9a)]({'where':{'username':_0x44aedc},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x31d8ed){const _0x3a3033=await database_1[_0x68de3e(0xc3)][_0x68de3e(0xb9)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x1535b2=_0x68de3e(0xd6)+_0x44aedc+_0x68de3e(0xdb);_0x3a3033[_0x68de3e(0xb8)]>0x0?(_0x1535b2+=_0x68de3e(0x14b),_0x3a3033[_0x68de3e(0xce)](_0x5ac495=>{const _0x429d74=_0x68de3e;_0x1535b2+='•\x20`'+_0x5ac495[_0x429d74(0xef)]+'`\x20('+_0x5ac495[_0x429d74(0xe5)]+')\x0a';}),_0x1535b2+=_0x68de3e(0xd3)):_0x1535b2+='Check\x20spelling\x20and\x20try\x20again.';await this['bot']?.['sendMessage'](_0x79862f,_0x1535b2,{'parse_mode':'Markdown'});return;}if(_0x31d8ed['status']!==_0x68de3e(0x12c)){await this[_0x68de3e(0xc8)]?.['sendMessage'](_0x79862f,_0x68de3e(0x121)+_0x44aedc+_0x68de3e(0x86)+_0x68de3e(0x118),{'parse_mode':'Markdown'});return;}if(_0x31d8ed[_0x68de3e(0x143)]!==_0x13c86b&&_0x31d8ed[_0x68de3e(0x74)]!==_0x13c86b){await this[_0x68de3e(0xc8)]?.[_0x68de3e(0x13a)](_0x79862f,_0x68de3e(0x125)+_0x44aedc+'`.\x0a\x0a'+_0x68de3e(0x101)+_0x68de3e(0x6d),{'parse_mode':_0x68de3e(0xdc)});return;}const _0x1b995c=await database_1[_0x68de3e(0xc3)]['telegramUser'][_0x68de3e(0xf7)]({'where':{'shopId':_0x31d8ed['id'],'isVerified':!![],'telegramId':{'not':_0x12236d}}});if(_0x1b995c){await this[_0x68de3e(0xc8)]?.['sendMessage'](_0x79862f,_0x68de3e(0xa8)+_0x44aedc+_0x68de3e(0x11f)+_0x68de3e(0x13b),{'parse_mode':_0x68de3e(0xdc)});return;}await database_1['default'][_0x68de3e(0xa6)][_0x68de3e(0x13c)]({'where':{'telegramId':_0x12236d},'data':{'shopId':_0x31d8ed['id'],'isVerified':!![]}}),await this[_0x68de3e(0xc8)]?.[_0x68de3e(0x13a)](_0x79862f,_0x68de3e(0xae)+_0x68de3e(0x108)+('📱\x20Shop:\x20*'+_0x31d8ed[_0x68de3e(0xe5)]+'*\x0a')+('👤\x20Username:\x20`'+_0x31d8ed['username']+_0x68de3e(0x8a))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+_0x68de3e(0x10a)+'•\x20Payment\x20status\x20changes\x0a'+'•\x20Payouts\x0a'+_0x68de3e(0x103)+_0x68de3e(0x12f)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x68de3e(0x6e),{'parse_mode':'Markdown'}),console[_0x68de3e(0x77)](_0x68de3e(0xfb)+_0x12236d+_0x68de3e(0x8d)+_0x31d8ed[_0x68de3e(0xef)]+_0x68de3e(0x80));}catch(_0x3211f0){console['error'](_0x68de3e(0xf0),_0x3211f0),await this['bot']?.[_0x68de3e(0x13a)](_0x79862f,_0x68de3e(0xc2));}}async['sendShopNotification'](_0x5a030b,_0x50c7ef,_0x152222){const _0x263990=a54_0x1261a1;if(!this['bot']){console[_0x263990(0x93)](_0x263990(0xac));return;}try{const _0x41b36d=await database_1['default']['telegramUser'][_0x263990(0x112)]({'where':{'shopId':_0x5a030b,'isVerified':!![]}});if(_0x41b36d[_0x263990(0xb8)]===0x0){console[_0x263990(0x77)](_0x263990(0xd1)+_0x5a030b);return;}const _0x445c07=_0x41b36d[_0x263990(0x136)](async _0x1789f9=>{const _0x1f46f2=_0x263990;try{await this['bot']?.['sendMessage'](_0x1789f9[_0x1f46f2(0x138)],_0x50c7ef,_0x152222),console['log']('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x1789f9[_0x1f46f2(0x138)]);}catch(_0x4dded9){console[_0x1f46f2(0x73)](_0x1f46f2(0x106)+_0x1789f9[_0x1f46f2(0x138)]+':',_0x4dded9),_0x4dded9 instanceof Error&&(_0x4dded9[_0x1f46f2(0xfc)][_0x1f46f2(0x150)](_0x1f46f2(0xf2))||_0x4dded9[_0x1f46f2(0xfc)][_0x1f46f2(0x150)](_0x1f46f2(0xf9))||_0x4dded9['message'][_0x1f46f2(0x150)]('user\x20is\x20deactivated'))&&(await database_1[_0x1f46f2(0xc3)][_0x1f46f2(0xa6)][_0x1f46f2(0x13c)]({'where':{'id':_0x1789f9['id']},'data':{'isVerified':![]}}),console[_0x1f46f2(0x77)](_0x1f46f2(0xb6)+_0x1789f9['telegramId']+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x263990(0xbe)](_0x445c07);}catch(_0x49450b){console['error'](_0x263990(0x100),_0x49450b);}}async[a54_0x1261a1(0xeb)](_0x6a9ed6,_0x510710,_0x2f7b84){const _0x452db8=a54_0x1261a1,_0x4f7ddb={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x3e0419={'created':_0x452db8(0xb0),'paid':_0x452db8(0xf4),'failed':'Payment\x20failed','expired':_0x452db8(0x139),'refund':_0x452db8(0xbb),'chargeback':_0x452db8(0xb2),'processing':_0x452db8(0xcf)},_0x5192b2=_0x4f7ddb[_0x2f7b84],_0xe5396d=_0x3e0419[_0x2f7b84],_0x110788=(0x0,gateway_1[_0x452db8(0x140)])(_0x510710['gateway']);console[_0x452db8(0x77)](_0x452db8(0x145)+_0x510710[_0x452db8(0x137)]+_0x452db8(0x71)+_0x110788+'\x22');let _0x2c9f17=_0x5192b2+'\x20*'+_0xe5396d+_0x452db8(0x109)+(_0x452db8(0x10d)+_0x510710['amount']+'\x20'+_0x510710[_0x452db8(0x120)]+'*\x0a')+(_0x452db8(0x105)+(_0x510710[_0x452db8(0x104)]||_0x510710['id'])+'`\x0a')+(_0x452db8(0xff)+_0x510710['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x110788+'`\x0a')+(_0x452db8(0x96)+new Date(_0x510710['createdAt'])[_0x452db8(0xee)](_0x452db8(0xb1))+'\x0a');if(_0x510710[_0x452db8(0xe8)]||_0x510710['customerEmail']||_0x510710[_0x452db8(0xf8)]||_0x510710[_0x452db8(0x6c)]||_0x510710[_0x452db8(0x123)]){_0x2c9f17+=_0x452db8(0x91);_0x510710[_0x452db8(0xe8)]&&(_0x2c9f17+='📛\x20Name:\x20`'+_0x510710[_0x452db8(0xe8)]+'`\x0a');_0x510710[_0x452db8(0xdf)]&&(_0x2c9f17+='📧\x20Email:\x20`'+_0x510710[_0x452db8(0xdf)]+'`\x0a');_0x510710[_0x452db8(0xf8)]&&(_0x2c9f17+=_0x452db8(0xd5)+_0x510710[_0x452db8(0xf8)]+'`\x0a');_0x510710[_0x452db8(0x6c)]&&(_0x2c9f17+=_0x452db8(0x152)+_0x510710['customerIp']+'`\x0a');if(_0x510710[_0x452db8(0x123)]){const _0x44d4e3=_0x510710[_0x452db8(0x123)][_0x452db8(0xb8)]>0x32?_0x510710['customerUa']['substring'](0x0,0x32)+'...':_0x510710[_0x452db8(0x123)];_0x2c9f17+='💻\x20Browser:\x20`'+_0x44d4e3+'`\x0a';}}_0x2f7b84===_0x452db8(0x124)&&_0x510710[_0x452db8(0xd8)]&&(_0x2c9f17+=_0x452db8(0x10e)+_0x510710[_0x452db8(0xd8)]+_0x452db8(0x81)),_0x2f7b84===_0x452db8(0x6a)&&(_0x2c9f17+=_0x452db8(0xbd)),_0x510710[_0x452db8(0x67)]&&(_0x2c9f17+=_0x452db8(0xf5)+_0x510710[_0x452db8(0x67)]+'\x0a'),await this[_0x452db8(0xde)](_0x6a9ed6,_0x2c9f17,{'parse_mode':'Markdown'});}async[a54_0x1261a1(0x14c)](_0x59965e,_0x5878fd,_0x22c8ab){const _0x4d7cb9=a54_0x1261a1,_0x1ffce1={'created':'📤','completed':'✅','rejected':'❌'},_0x543e23={'created':_0x4d7cb9(0xa4),'completed':_0x4d7cb9(0xcb),'rejected':_0x4d7cb9(0x148)},_0x59e97c=_0x1ffce1[_0x22c8ab],_0x1af913=_0x543e23[_0x22c8ab],_0x3eca5e=_0x59e97c+'\x20*'+_0x1af913+'*\x0a\x0a'+(_0x4d7cb9(0x13e)+_0x5878fd[_0x4d7cb9(0x8b)]+_0x4d7cb9(0x144))+(_0x4d7cb9(0xb3)+_0x5878fd['method']+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x5878fd['id']+'`\x0a')+(_0x4d7cb9(0x96)+new Date(_0x5878fd[_0x4d7cb9(0x78)])['toLocaleString'](_0x4d7cb9(0xb1))+'\x0a')+(_0x5878fd[_0x4d7cb9(0xd4)]?'🔗\x20TXID:\x20`'+_0x5878fd[_0x4d7cb9(0xd4)]+'`':'');await this['sendShopNotification'](_0x59965e,_0x3eca5e,{'parse_mode':_0x4d7cb9(0xdc)});}async[a54_0x1261a1(0x9f)](_0x23d0cf,_0x359f3c){const _0x30a09a=a54_0x1261a1;try{const _0x303b11=await database_1[_0x30a09a(0xc3)]['shopSettings'][_0x30a09a(0x9a)]({'where':{'shopId':_0x23d0cf},'select':{'notificationLogin':!![]}});if(!_0x303b11?.[_0x30a09a(0x82)]){console[_0x30a09a(0x77)](_0x30a09a(0xec)+_0x23d0cf);return;}const _0x40808e=_0x359f3c['success']?'🔐':'🚨',_0x5c3ecf=_0x359f3c['success']?_0x30a09a(0x6b):_0x30a09a(0x70);let _0x35bcbc=_0x40808e+'\x20*'+_0x5c3ecf+_0x30a09a(0x109)+(_0x30a09a(0xa9)+_0x359f3c['username']+'`\x0a')+(_0x30a09a(0x88)+_0x359f3c['timestamp'][_0x30a09a(0xee)]('en-US')+'\x0a');_0x359f3c['ipAddress']&&(_0x35bcbc+=_0x30a09a(0x83)+_0x359f3c[_0x30a09a(0x14f)]+'`\x0a');if(_0x359f3c[_0x30a09a(0xcc)]){const _0x2ab7d7=_0x359f3c[_0x30a09a(0xcc)]['length']>0x32?_0x359f3c[_0x30a09a(0xcc)]['substring'](0x0,0x32)+'...':_0x359f3c[_0x30a09a(0xcc)];_0x35bcbc+='💻\x20Browser:\x20`'+_0x2ab7d7+'`\x0a';}!_0x359f3c[_0x30a09a(0x69)]&&(_0x35bcbc+=_0x30a09a(0x84)),await this[_0x30a09a(0xde)](_0x23d0cf,_0x35bcbc,{'parse_mode':_0x30a09a(0xdc)}),console['log'](_0x30a09a(0x7a)+_0x23d0cf+':\x20'+(_0x359f3c[_0x30a09a(0x69)]?_0x30a09a(0x69):_0x30a09a(0x132)));}catch(_0x4d478f){console[_0x30a09a(0x73)]('Failed\x20to\x20send\x20login\x20notification:',_0x4d478f);}}async['sendApiErrorNotification'](_0x60a491,_0x3a40f7){const _0x201462=a54_0x1261a1;try{const _0x5915e4=await database_1[_0x201462(0xc3)][_0x201462(0x8c)]['findUnique']({'where':{'shopId':_0x60a491},'select':{'notificationApiError':!![]}});if(!_0x5915e4?.[_0x201462(0x7d)]){console[_0x201462(0x77)](_0x201462(0x134)+_0x60a491);return;}let _0x17c6a0=_0x201462(0x10c)+(_0x201462(0xe3)+_0x3a40f7[_0x201462(0x7b)]+'\x20'+_0x3a40f7[_0x201462(0xc1)]+'`\x0a')+(_0x201462(0x88)+_0x3a40f7[_0x201462(0x126)][_0x201462(0xee)](_0x201462(0xb1))+'\x0a');_0x3a40f7[_0x201462(0x68)]&&(_0x17c6a0+=_0x201462(0xa0)+_0x3a40f7['statusCode']+'`\x0a'),_0x17c6a0+=_0x201462(0xfe)+_0x3a40f7[_0x201462(0x131)]+'`\x0a',_0x3a40f7[_0x201462(0x7c)]&&(_0x17c6a0+='🆔\x20Request\x20ID:\x20`'+_0x3a40f7[_0x201462(0x7c)]+'`\x0a'),_0x17c6a0+=_0x201462(0x85),await this[_0x201462(0xde)](_0x60a491,_0x17c6a0,{'parse_mode':_0x201462(0xdc)}),console[_0x201462(0x77)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x60a491+':\x20'+_0x3a40f7[_0x201462(0xc1)]);}catch(_0x3846f1){console[_0x201462(0x73)](_0x201462(0xbc),_0x3846f1);}}async[a54_0x1261a1(0x7f)](_0x4809e2,_0x5a119b,_0xbd9664){const _0xba423d=a54_0x1261a1;let _0x12e735=_0xba423d(0xe6)+_0x5a119b+_0xba423d(0x109);for(const [_0x3e2297,_0x35082f]of Object['entries'](_0xbd9664)){_0x35082f!==null&&_0x35082f!==undefined&&(_0x12e735+=_0x3e2297+_0xba423d(0x94)+_0x35082f+'`\x0a');}await this[_0xba423d(0xde)](_0x4809e2,_0x12e735,{'parse_mode':_0xba423d(0xdc)});}[a54_0x1261a1(0x151)](){const _0x37ffbc=a54_0x1261a1;return{'isActive':!!this[_0x37ffbc(0xc8)],'username':this[_0x37ffbc(0x9d)]};}[a54_0x1261a1(0x10f)](){const _0xfd7b68=a54_0x1261a1;this[_0xfd7b68(0xc8)]&&(this['bot'][_0xfd7b68(0x9c)](),this['bot']=null,console[_0xfd7b68(0x77)](_0xfd7b68(0x114)));}}exports['TelegramBotService']=TelegramBotService,exports[a54_0x1261a1(0xe1)]=new TelegramBotService();