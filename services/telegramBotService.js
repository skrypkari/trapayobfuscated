'use strict';const a78_0x21dcd4=a78_0x1b73;(function(_0x4def0a,_0x25c357){const _0x4028dc=a78_0x1b73,_0x476b38=_0x4def0a();while(!![]){try{const _0x160b92=-parseInt(_0x4028dc(0xb6))/0x1*(parseInt(_0x4028dc(0x76))/0x2)+parseInt(_0x4028dc(0x110))/0x3*(-parseInt(_0x4028dc(0xfd))/0x4)+parseInt(_0x4028dc(0x13b))/0x5*(parseInt(_0x4028dc(0xc1))/0x6)+parseInt(_0x4028dc(0x15a))/0x7*(-parseInt(_0x4028dc(0x125))/0x8)+-parseInt(_0x4028dc(0xf8))/0x9*(parseInt(_0x4028dc(0xfe))/0xa)+parseInt(_0x4028dc(0x118))/0xb+parseInt(_0x4028dc(0xf4))/0xc;if(_0x160b92===_0x25c357)break;else _0x476b38['push'](_0x476b38['shift']());}catch(_0x4e7b7d){_0x476b38['push'](_0x476b38['shift']());}}}(a78_0x5b1f,0xf0ee7));var __importDefault=this&&this[a78_0x21dcd4(0x8d)]||function(_0x5ea9d4){const _0x46011a=a78_0x21dcd4;return _0x5ea9d4&&_0x5ea9d4[_0x46011a(0xd5)]?_0x5ea9d4:{'default':_0x5ea9d4};};Object[a78_0x21dcd4(0x9a)](exports,a78_0x21dcd4(0xd5),{'value':!![]}),exports['telegramBotService']=exports['TelegramBotService']=void 0x0;function a78_0x1b73(_0x50b144,_0x4e7fbc){_0x50b144=_0x50b144-0x6c;const _0x5b1feb=a78_0x5b1f();let _0x1b7317=_0x5b1feb[_0x50b144];return _0x1b7317;}function a78_0x5b1f(){const _0x244f81=['failed','‚úÖ\x20Login\x20notification\x20sent\x20for\x20shop\x20','secretKey','__importDefault','Successful\x20login','startsWith','sendNotificationToAll','User\x20','errorMessage','‚ùå\x20Error\x20sending\x20file\x20to\x20chat:','\x0a‚ö†Ô∏è\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','findFirst','stopBot','adminNotes',':\x20username=\x22','üîî\x20Notifications\x20are\x20active\x0a\x0a','defineProperty','trapay_bot','initializeBot','üåê\x20IP:\x20`','‚ùå\x20Error\x20getting\x20debug\x20information.','txid','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','üîó\x20Endpoint:\x20`','findUnique','...','Username:\x20`','üí≥\x20*Wallet:*\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','telegramId','TelegramBotService','üîî\x20*','onText','shopSettings','üì±\x20Sending\x20notification\x20to\x20all\x20connected\x20users:\x20','customerEmail','üîÑ\x20Processing\x20single-line\x20verification\x20for\x20user\x20','Payment\x20chargeback','‚ùå\x20No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20ID:\x20','../types/gateway','‚ùå\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','‚ùå\x20Error\x20sending\x20direct\x20message:','üõë\x20Telegram\x20bot\x20stopped','‚úÖ\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','528269ZCkXkg','pk_','.jpeg','‚ùå\x20Telegram\x20bot\x20not\x20initialized','entries','default','‚úÖ\x20Connected\x20to\x20shop:\x20*','allSettled','statusCode','sendDocument','‚úÖ\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*','8538gYrvWo','üì±\x20Shop:\x20*','split','from','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','customerUa','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','üîå\x20User\x20','.jpg','Use\x20/start\x20to\x20begin.','üìß\x20Email:\x20`','user\x20is\x20deactivated','timestamp','chargebackAmount','Failed\x20to\x20send\x20login\x20notification:','name','`\x20is\x20inactive.\x0a\x0a','üìÖ\x20Date:\x20','../config/database','üíª\x20Browser:\x20`','__esModule','method','Failed\x20login\x20attempt','‚ùå\x20Failed\x20to\x20send\x20message\x20to\x20user\x20','username','‚úÖ\x20Direct\x20message\x20sent\x20to\x20chat\x20','Commands:\x0a','chat','toLocaleString','‚úÖ\x20File\x20sent\x20to\x20chat\x20','notificationApiError','Error\x20handling\x20/debug\x20command:','network','isVerified','‚ùå\x20Error\x20sending\x20file\x20to\x20user\x20','sendPaymentNotification','üì±\x20Telegram\x20notification:\x20gateway\x20\x22','requestId','\x22,\x20apiKey=\x22','üìõ\x20Name:\x20`','‚ùå\x20Failed\x20to\x20send\x20notification\x20to\x20all\x20users:','sendMessage','\x20initialized\x20successfully','substring','join','bot','üÜî\x20Payment\x20ID:\x20`','Markdown','publicKey','üë§\x20Username:\x20`','‚ùå\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','23516088fXGfVW','üì±\x20No\x20active\x20Telegram\x20users\x20found','Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification','üîî\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','629397eWQNBw','Make\x20sure\x20you\x20have\x20the\x20correct\x20username\x20from\x20your\x20account.','customerIp','length','text','12Wwqyjj','10IlFUbt','‚Ä¢\x20Payment\x20status\x20changes\x0a','sendShopNotification','üí∞\x20*Amount:*\x20','`.\x0a\x0a','test','endsWith','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','‚ùóÔ∏è\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!','wallet','sendDirectFile','status','botToken','Error\x20in\x20handleSingleLineVerification:','.pdf','sendPayoutNotification','image/png','Payment\x20expired','436389XYYgEW','Error\x20handling\x20message:','Contact\x20administrator.','üîî\x20You\x20receive\x20notifications\x20about:\x0a','TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables','gateway','warn','remitterIban','8639862Jvrtfd','\x20\x20\x20Name:\x20*','`\x0a\x0a','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','‚Ä¢\x20Payouts\x0a','‚ùå\x20Failed\x20to\x20initialize\x20Telegram\x20bot:','You\x20sent\x20','amount','env','create','‚è≥\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a','success','ipAddress','752CcWCIW','sendCustomNotification','Not\x20specified','üí∏\x20*New\x20Payout*\x0a\x0a','getGatewayDisplayNameForTelegram','userAgent','botUsername','‚Ä¢\x20New\x20payments\x0a','message','‚ùå\x20Invalid\x20username\x20format:\x20`','Error\x20handling\x20/status\x20command:','includes','sendLoginNotification','log','node-telegram-bot-api','üè™\x20Your\x20connected\x20shop:\x0a','currency','üìù\x20Format:\x20`username\x20api_key`\x0a\x0a','‚úÖ\x20File\x20sent\x20to\x20','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20any\x20shop.\x0a\x0a','customerName','üîÑ\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','1460ddbVaR','‚ùå\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','.png','image/jpeg','endpoint','Error\x20sending\x20shop\x20notification:','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','first_name','application/pdf','error','üìù\x20Notes:\x20','‚ùå\x20Error\x20sending\x20file\x20to\x20shop:','TELEGRAM_BOT_TOKEN','updatedAt','telegramUser','üîó\x20*Transaction\x20Link:*\x20Pending','ACTIVE','üì±\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','‚úÖ\x20Notification\x20sent\x20to\x20Telegram\x20user\x20',':\x20`','getBotInfo','shop','To\x20reconnect,\x20use\x20the\x20/start\x20command','üìä\x20*Connection\x20Status*\x0a\x0a','üìÖ\x20*Payout\x20Date:*\x20','Payment\x20is\x20being\x20processed','‚ùå\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','toLocaleDateString','`\x20not\x20found.\x0a\x0a','üí∏\x20Penalty\x20amount:\x20*','‚ùå\x20Please\x20use\x20/start\x20command\x20first','84833bmbObr','\x20(@','\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure','Telegram\x20bot\x20polling\x20error:','sendShopFile','*\x0a\x0a','...\x22','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','ü§ñ\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','‚è±Ô∏è\x20*Period:*\x20','‚ùå\x20Error:\x20`','\x20users','Example:\x0a','sendDirectMessage','üåê\x20IP\x20address:\x20`','shopId','handleSingleLineVerification','üåç\x20Country:\x20','geo','üè¶\x20IBAN:\x20`','toString','Payment\x20refund','2-digit','map','üö®\x20*API\x20Error*\x0a\x0a','üéâ\x20*Congratulations!*\x0a\x0a','\x20verified\x20for\x20shop\x20','*.\x0a\x0a','\x20\x20\x20Status:\x20','\x22\x20->\x20display\x20\x22','sk_','‚ùå\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','update','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','\x20via\x20single-line\x20input','2OTDHac','\x20users\x20of\x20shop\x20','createdAt','üìÖ\x20Time:\x20','üåê\x20*Network:*\x20','‚ùå\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.','Use\x20/start\x20to\x20connect\x20to\x20a\x20shop.','application/octet-stream','‚úÖ\x20Welcome\x20back!\x0a\x0a','setupBotHandlers','trim','üîó\x20*Transaction\x20Link:*\x20`','en-US','findMany','/status\x20-\x20check\x20connection\x20status\x0a','\x0aüë§\x20*Customer\x20Information:*\x0a','üè™\x20Gateway:\x20`','üÜî\x20Request\x20ID:\x20`','Error\x20handling\x20/start\x20command:','Telegram\x20bot\x20error:'];a78_0x5b1f=function(){return _0x244f81;};return a78_0x5b1f();}const node_telegram_bot_api_1=__importDefault(require(a78_0x21dcd4(0x133))),database_1=__importDefault(require(a78_0x21dcd4(0xd3))),gateway_1=require(a78_0x21dcd4(0xb1));class TelegramBotService{constructor(){const _0x5dc31a=a78_0x21dcd4;this[_0x5dc31a(0xee)]=null,this[_0x5dc31a(0x10a)]=process['env'][_0x5dc31a(0x147)]||'',this[_0x5dc31a(0x12b)]=process[_0x5dc31a(0x120)]['TELEGRAM_BOT_USERNAME']||_0x5dc31a(0x9b),this[_0x5dc31a(0x10a)]?this[_0x5dc31a(0x9c)]():console['warn'](_0x5dc31a(0x114));}[a78_0x21dcd4(0x9c)](){const _0xecbeeb=a78_0x21dcd4;try{this[_0xecbeeb(0xee)]=new node_telegram_bot_api_1[(_0xecbeeb(0xbb))](this[_0xecbeeb(0x10a)],{'polling':!![]}),this[_0xecbeeb(0x7f)](),console[_0xecbeeb(0x132)]('‚úÖ\x20Telegram\x20bot\x20@'+this[_0xecbeeb(0x12b)]+_0xecbeeb(0xeb));}catch(_0x539063){console['error'](_0xecbeeb(0x11d),_0x539063);}}[a78_0x21dcd4(0x7f)](){const _0x32b45f=a78_0x21dcd4;if(!this['bot'])return;this[_0x32b45f(0xee)][_0x32b45f(0xaa)](/\/start/,async _0x3c5342=>{const _0xbb2c42=_0x32b45f,_0x6329f7=_0x3c5342['chat']['id'],_0x416196=_0x3c5342[_0xbb2c42(0xc4)]?.['id'][_0xbb2c42(0x16e)](),_0x218901=_0x3c5342[_0xbb2c42(0xc4)]?.['username'],_0x21ae22=_0x3c5342['from']?.[_0xbb2c42(0x142)],_0x31cd01=_0x3c5342[_0xbb2c42(0xc4)]?.['last_name'];if(!_0x416196)return;try{let _0x5cb8e9=await database_1[_0xbb2c42(0xbb)][_0xbb2c42(0x149)][_0xbb2c42(0xa2)]({'where':{'telegramId':_0x416196},'include':{'shop':!![]}});!_0x5cb8e9?(_0x5cb8e9=await database_1['default']['telegramUser'][_0xbb2c42(0x121)]({'data':{'telegramId':_0x416196,'username':_0x218901,'firstName':_0x21ae22,'lastName':_0x31cd01,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0xbb2c42(0x132)]('üì±\x20Created\x20new\x20Telegram\x20user:\x20'+_0x416196+_0xbb2c42(0x15b)+_0x218901+')')):_0x5cb8e9=await database_1[_0xbb2c42(0xbb)][_0xbb2c42(0x149)][_0xbb2c42(0x73)]({'where':{'telegramId':_0x416196},'data':{'username':_0x218901,'firstName':_0x21ae22,'lastName':_0x31cd01},'include':{'shop':!![]}}),_0x5cb8e9[_0xbb2c42(0xe2)]&&_0x5cb8e9[_0xbb2c42(0x169)]&&_0x5cb8e9[_0xbb2c42(0x150)]?await this[_0xbb2c42(0xee)]?.[_0xbb2c42(0xea)](_0x6329f7,_0xbb2c42(0x7e)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x5cb8e9['shop']['name']+'*\x0a')+(_0xbb2c42(0xa4)+_0x5cb8e9[_0xbb2c42(0x150)]['username']+_0xbb2c42(0x11a))+_0xbb2c42(0x113)+_0xbb2c42(0x12c)+_0xbb2c42(0xff)+'‚Ä¢\x20Payouts\x0a\x0a'+'Commands:\x0a'+_0xbb2c42(0x84)+_0xbb2c42(0xa6),{'parse_mode':_0xbb2c42(0xf0)}):(_0x5cb8e9[_0xbb2c42(0x169)]&&!_0x5cb8e9[_0xbb2c42(0xe2)]&&(await database_1[_0xbb2c42(0xbb)][_0xbb2c42(0x149)][_0xbb2c42(0x73)]({'where':{'telegramId':_0x416196},'data':{'shopId':null,'isVerified':![]}}),console[_0xbb2c42(0x132)](_0xbb2c42(0x13a)+_0x416196)),await this[_0xbb2c42(0xee)]?.[_0xbb2c42(0xea)](_0x6329f7,_0xbb2c42(0x162)+_0xbb2c42(0x141)+'üìù\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0xbb2c42(0x166)+_0xbb2c42(0x161)+_0xbb2c42(0x106),{'parse_mode':_0xbb2c42(0xf0)}));}catch(_0x50a525){console[_0xbb2c42(0x144)](_0xbb2c42(0x88),_0x50a525),await this[_0xbb2c42(0xee)]?.[_0xbb2c42(0xea)](_0x6329f7,_0xbb2c42(0xb2));}}),this[_0x32b45f(0xee)][_0x32b45f(0xaa)](/\/disconnect/,async _0x42e547=>{const _0x32a936=_0x32b45f,_0x193eab=_0x42e547['chat']['id'],_0x24158c=_0x42e547['from']?.['id'][_0x32a936(0x16e)]();if(!_0x24158c)return;try{const _0x1eaad5=await database_1[_0x32a936(0xbb)][_0x32a936(0x149)][_0x32a936(0xa2)]({'where':{'telegramId':_0x24158c},'include':{'shop':!![]}});if(!_0x1eaad5||!_0x1eaad5[_0x32a936(0xe2)]||!_0x1eaad5['shopId']){await this[_0x32a936(0xee)]?.[_0x32a936(0xea)](_0x193eab,_0x32a936(0x7b));return;}const _0x4b745c=_0x1eaad5['shop']?.[_0x32a936(0xd0)]||'unknown\x20shop';await database_1[_0x32a936(0xbb)]['telegramUser'][_0x32a936(0x73)]({'where':{'telegramId':_0x24158c},'data':{'shopId':null,'isVerified':![]}}),console[_0x32a936(0x132)](_0x32a936(0xc8)+_0x24158c+'\x20disconnected\x20from\x20shop\x20'+_0x1eaad5[_0x32a936(0x169)]),await this[_0x32a936(0xee)]?.[_0x32a936(0xea)](_0x193eab,'‚úÖ\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x4b745c+_0x32a936(0x6e)+_0x32a936(0x151),{'parse_mode':_0x32a936(0xf0)});}catch(_0x516380){console[_0x32a936(0x144)]('Error\x20handling\x20/disconnect\x20command:',_0x516380),await this[_0x32a936(0xee)]?.[_0x32a936(0xea)](_0x193eab,_0x32a936(0xb2));}}),this[_0x32b45f(0xee)][_0x32b45f(0xaa)](/\/status/,async _0x4bcad9=>{const _0x3d23eb=_0x32b45f,_0x3bc04f=_0x4bcad9[_0x3d23eb(0xdc)]['id'],_0x2b2618=_0x4bcad9['from']?.['id']['toString']();if(!_0x2b2618)return;try{const _0x46d999=await database_1[_0x3d23eb(0xbb)]['telegramUser'][_0x3d23eb(0xa2)]({'where':{'telegramId':_0x2b2618},'include':{'shop':!![]}});if(!_0x46d999){await this[_0x3d23eb(0xee)]?.[_0x3d23eb(0xea)](_0x3bc04f,'‚ùå\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x3d23eb(0xca));return;}if(!_0x46d999['isVerified']||!_0x46d999['shopId']||!_0x46d999[_0x3d23eb(0x150)]){await this[_0x3d23eb(0xee)]?.[_0x3d23eb(0xea)](_0x3bc04f,'‚ùå\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a'+'Use\x20/start\x20to\x20connect.');return;}await this['bot']?.['sendMessage'](_0x3bc04f,_0x3d23eb(0x152)+(_0x3d23eb(0xbc)+_0x46d999['shop'][_0x3d23eb(0xd0)]+'*\x0a')+('üë§\x20Username:\x20`'+_0x46d999[_0x3d23eb(0x150)][_0x3d23eb(0xd9)]+'`\x0a')+('üìÖ\x20Connection\x20date:\x20'+_0x46d999[_0x3d23eb(0x148)][_0x3d23eb(0x156)](_0x3d23eb(0x82))+'\x0a\x0a')+_0x3d23eb(0x99)+_0x3d23eb(0xdb)+_0x3d23eb(0xa6),{'parse_mode':'Markdown'});}catch(_0x35f6c4){console[_0x3d23eb(0x144)](_0x3d23eb(0x12f),_0x35f6c4),await this[_0x3d23eb(0xee)]?.['sendMessage'](_0x3bc04f,_0x3d23eb(0xb2));}}),this[_0x32b45f(0xee)]['onText'](/\/debug/,async _0x5bacb2=>{const _0x353706=_0x32b45f,_0x1660b0=_0x5bacb2['chat']['id'],_0x337f5e=_0x5bacb2[_0x353706(0xc4)]?.['id'][_0x353706(0x16e)]();if(!_0x337f5e)return;try{const _0x13badd=await database_1['default']['telegramUser'][_0x353706(0xa2)]({'where':{'telegramId':_0x337f5e},'include':{'shop':!![]}});let _0x6ca7cf='üîç\x20*Debug\x20Information*\x0a\x0a';_0x6ca7cf+='üì±\x20Your\x20Telegram\x20ID:\x20`'+_0x337f5e+_0x353706(0x11a),_0x13badd?.[_0x353706(0xe2)]&&_0x13badd[_0x353706(0x150)]?(_0x6ca7cf+=_0x353706(0x134),_0x6ca7cf+=_0x353706(0x119)+_0x13badd[_0x353706(0x150)][_0x353706(0xd0)]+'*\x0a',_0x6ca7cf+='\x20\x20\x20Username:\x20`'+_0x13badd['shop'][_0x353706(0xd9)]+'`\x0a',_0x6ca7cf+=_0x353706(0x6f)+_0x13badd[_0x353706(0x150)][_0x353706(0x109)]+'\x0a\x0a'):_0x6ca7cf+=_0x353706(0x138),_0x6ca7cf+=_0x353706(0x7c),await this[_0x353706(0xee)]?.[_0x353706(0xea)](_0x1660b0,_0x6ca7cf,{'parse_mode':_0x353706(0xf0)});}catch(_0xaf75dd){console[_0x353706(0x144)](_0x353706(0xe0),_0xaf75dd),await this['bot']?.[_0x353706(0xea)](_0x1660b0,_0x353706(0x9e));}}),this[_0x32b45f(0xee)]['on']('message',async _0x1503aa=>{const _0x3b7c5f=_0x32b45f;if(_0x1503aa[_0x3b7c5f(0xfc)]?.['startsWith']('/'))return;const _0x54177a=_0x1503aa['chat']['id'],_0x31263e=_0x1503aa[_0x3b7c5f(0xc4)]?.['id']['toString'](),_0x784b4f=_0x1503aa['text']?.[_0x3b7c5f(0x80)]();if(!_0x31263e||!_0x784b4f)return;try{const _0x4252a4=await database_1['default'][_0x3b7c5f(0x149)]['findUnique']({'where':{'telegramId':_0x31263e},'include':{'shop':!![]}});if(!_0x4252a4){await this[_0x3b7c5f(0xee)]?.[_0x3b7c5f(0xea)](_0x54177a,_0x3b7c5f(0x159));return;}if(_0x4252a4[_0x3b7c5f(0xe2)]&&_0x4252a4['shopId']&&_0x4252a4[_0x3b7c5f(0x150)]){await this[_0x3b7c5f(0xee)]?.[_0x3b7c5f(0xea)](_0x54177a,_0x3b7c5f(0xc0)+_0x4252a4[_0x3b7c5f(0x150)][_0x3b7c5f(0xd0)]+_0x3b7c5f(0x6e)+_0x3b7c5f(0x11b),{'parse_mode':'Markdown'});return;}const _0xa4e220=_0x784b4f[_0x3b7c5f(0xc3)](/\s+/);if(_0xa4e220[_0x3b7c5f(0xfb)]!==0x2){await this[_0x3b7c5f(0xee)]?.[_0x3b7c5f(0xea)](_0x54177a,_0x3b7c5f(0x13c)+_0x3b7c5f(0x136)+_0x3b7c5f(0x166)+_0x3b7c5f(0x161)+(_0x3b7c5f(0x11e)+_0xa4e220[_0x3b7c5f(0xfb)]+'\x20parts:\x20'+_0xa4e220[_0x3b7c5f(0x171)](_0x2b5313=>'`'+_0x2b5313+'`')[_0x3b7c5f(0xed)](',\x20')),{'parse_mode':_0x3b7c5f(0xf0)});return;}const [_0x4bd9b5,_0x341a70]=_0xa4e220;console['log']('üîÑ\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x31263e+_0x3b7c5f(0x98)+_0x4bd9b5+_0x3b7c5f(0xe7)+_0x341a70['substring'](0x0,0xa)+_0x3b7c5f(0x160)),await this[_0x3b7c5f(0x16a)](_0x54177a,_0x31263e,_0x4bd9b5,_0x341a70);}catch(_0x47e8d5){console['error'](_0x3b7c5f(0x111),_0x47e8d5),await this[_0x3b7c5f(0xee)]?.['sendMessage'](_0x54177a,_0x3b7c5f(0xb2));}}),this[_0x32b45f(0xee)]['on'](_0x32b45f(0x144),_0x230202=>{const _0xe006b9=_0x32b45f;console[_0xe006b9(0x144)](_0xe006b9(0x89),_0x230202);}),this[_0x32b45f(0xee)]['on']('polling_error',_0x4d6c5c=>{const _0x4a9e5f=_0x32b45f;console[_0x4a9e5f(0x144)](_0x4a9e5f(0x15d),_0x4d6c5c);});}async[a78_0x21dcd4(0x16a)](_0x219517,_0x4ac55f,_0x1f3957,_0x10056f){const _0x251927=a78_0x21dcd4;try{console[_0x251927(0x132)](_0x251927(0xae)+_0x4ac55f+':\x20username=\x22'+_0x1f3957+'\x22,\x20apiKey=\x22'+_0x10056f['substring'](0x0,0xa)+_0x251927(0x160));if(!_0x1f3957||_0x1f3957[_0x251927(0xfb)]<0x3||_0x1f3957[_0x251927(0xfb)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x251927(0x103)](_0x1f3957)){await this[_0x251927(0xee)]?.[_0x251927(0xea)](_0x219517,_0x251927(0x12e)+_0x1f3957+_0x251927(0x11a)+'Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).',{'parse_mode':_0x251927(0xf0)});return;}if(!_0x10056f||!_0x10056f[_0x251927(0x8f)](_0x251927(0xb7))&&!_0x10056f[_0x251927(0x8f)](_0x251927(0x71))){await this['bot']?.[_0x251927(0xea)](_0x219517,'‚ùå\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+_0x251927(0xc5),{'parse_mode':'Markdown'});return;}const _0x2080c4=await database_1[_0x251927(0xbb)][_0x251927(0x150)][_0x251927(0xa2)]({'where':{'username':_0x1f3957},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x2080c4){const _0x7aa4d7='‚ùå\x20Shop\x20with\x20username\x20`'+_0x1f3957+_0x251927(0x157)+'Please\x20check\x20the\x20spelling\x20and\x20try\x20again.\x0a\x0a'+_0x251927(0xf9);await this[_0x251927(0xee)]?.[_0x251927(0xea)](_0x219517,_0x7aa4d7,{'parse_mode':_0x251927(0xf0)});return;}if(_0x2080c4[_0x251927(0x109)]!==_0x251927(0x14b)){await this[_0x251927(0xee)]?.['sendMessage'](_0x219517,'‚ùå\x20Shop\x20`'+_0x1f3957+_0x251927(0xd1)+_0x251927(0x112),{'parse_mode':'Markdown'});return;}if(_0x2080c4[_0x251927(0xf1)]!==_0x10056f&&_0x2080c4[_0x251927(0x8c)]!==_0x10056f){await this[_0x251927(0xee)]?.[_0x251927(0xea)](_0x219517,'‚ùå\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x1f3957+_0x251927(0x102)+_0x251927(0xa0)+_0x251927(0xc7),{'parse_mode':_0x251927(0xf0)});return;}const _0x52f275=await database_1[_0x251927(0xbb)][_0x251927(0x149)][_0x251927(0x95)]({'where':{'shopId':_0x2080c4['id'],'isVerified':!![],'telegramId':{'not':_0x4ac55f}}});if(_0x52f275){await this[_0x251927(0xee)]?.[_0x251927(0xea)](_0x219517,_0x251927(0x155)+_0x1f3957+_0x251927(0x102)+_0x251927(0x74),{'parse_mode':_0x251927(0xf0)});return;}await database_1['default']['telegramUser']['update']({'where':{'telegramId':_0x4ac55f},'data':{'shopId':_0x2080c4['id'],'isVerified':!![]}}),await this[_0x251927(0xee)]?.[_0x251927(0xea)](_0x219517,_0x251927(0x6c)+'‚úÖ\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x251927(0xc2)+_0x2080c4['name']+'*\x0a')+(_0x251927(0xf2)+_0x2080c4['username']+'`\x0a\x0a')+_0x251927(0xf7)+_0x251927(0x12c)+_0x251927(0xff)+_0x251927(0x11c)+'‚Ä¢\x20Important\x20events\x0a\x0a'+_0x251927(0xdb)+_0x251927(0x84)+_0x251927(0xa6),{'parse_mode':_0x251927(0xf0)}),console[_0x251927(0x132)]('‚úÖ\x20Telegram\x20user\x20'+_0x4ac55f+_0x251927(0x6d)+_0x2080c4['username']+_0x251927(0x75));}catch(_0x55b19){console[_0x251927(0x144)](_0x251927(0x10b),_0x55b19),await this[_0x251927(0xee)]?.['sendMessage'](_0x219517,_0x251927(0x72));}}async[a78_0x21dcd4(0x100)](_0x3a48ec,_0x19978c,_0x143f8a){const _0x555dfe=a78_0x21dcd4;if(!this[_0x555dfe(0xee)]){console[_0x555dfe(0x116)](_0x555dfe(0xf6));return;}try{const _0x2a3c4b=await database_1['default']['telegramUser']['findMany']({'where':{'shopId':_0x3a48ec,'isVerified':!![]}});if(_0x2a3c4b[_0x555dfe(0xfb)]===0x0){console[_0x555dfe(0x132)](_0x555dfe(0x105)+_0x3a48ec);return;}const _0x2bd27b=_0x2a3c4b['map'](async _0x7e56d4=>{const _0x32b29a=_0x555dfe;try{await this[_0x32b29a(0xee)]?.['sendMessage'](_0x7e56d4[_0x32b29a(0xa7)],_0x19978c,_0x143f8a),console[_0x32b29a(0x132)](_0x32b29a(0x14d)+_0x7e56d4[_0x32b29a(0xa7)]);}catch(_0x4dafd9){console[_0x32b29a(0x144)](_0x32b29a(0xf3)+_0x7e56d4['telegramId']+':',_0x4dafd9),_0x4dafd9 instanceof Error&&(_0x4dafd9['message']['includes']('blocked')||_0x4dafd9['message'][_0x32b29a(0x130)]('chat\x20not\x20found')||_0x4dafd9[_0x32b29a(0x12d)][_0x32b29a(0x130)](_0x32b29a(0xcc)))&&(await database_1['default']['telegramUser'][_0x32b29a(0x73)]({'where':{'id':_0x7e56d4['id']},'data':{'isVerified':![]}}),console[_0x32b29a(0x132)](_0x32b29a(0x91)+_0x7e56d4[_0x32b29a(0xa7)]+_0x32b29a(0x15c)));}});await Promise[_0x555dfe(0xbd)](_0x2bd27b);}catch(_0x3a82da){console[_0x555dfe(0x144)](_0x555dfe(0x140),_0x3a82da);}}async[a78_0x21dcd4(0xe4)](_0x23d524,_0x1b13ed,_0x4b8919){const _0x635e18=a78_0x21dcd4,_0xf4046a={'created':'üÜï','paid':'‚úÖ','failed':'‚ùå','expired':'‚è∞','refund':'üîÑ','chargeback':'‚ö†Ô∏è','processing':'‚öôÔ∏è'},_0x11532c={'created':'New\x20payment\x20created','paid':'Payment\x20successfully\x20paid','failed':'Payment\x20failed','expired':_0x635e18(0x10f),'refund':_0x635e18(0x16f),'chargeback':_0x635e18(0xaf),'processing':_0x635e18(0x154)},_0x42a45c=_0xf4046a[_0x4b8919],_0x399957=_0x11532c[_0x4b8919],_0x37baa4=(0x0,gateway_1[_0x635e18(0x129)])(_0x1b13ed[_0x635e18(0x115)]);console[_0x635e18(0x132)](_0x635e18(0xe5)+_0x1b13ed['gateway']+_0x635e18(0x70)+_0x37baa4+'\x22');let _0x57d140=_0x42a45c+'\x20*'+_0x399957+_0x635e18(0x15f)+('üí∞\x20Amount:\x20*'+_0x1b13ed[_0x635e18(0x11f)]+'\x20'+_0x1b13ed[_0x635e18(0x135)]+'*\x0a')+('üìù\x20Order\x20ID:\x20`'+(_0x1b13ed['orderId']||_0x1b13ed['id'])+'`\x0a')+(_0x635e18(0xef)+_0x1b13ed['id']+'`\x0a')+(_0x635e18(0x86)+_0x37baa4+'`\x0a')+(_0x635e18(0xd2)+new Date(_0x1b13ed[_0x635e18(0x78)])[_0x635e18(0xdd)](_0x635e18(0x82))+'\x0a');if(_0x1b13ed['customerName']||_0x1b13ed['customerEmail']||_0x1b13ed['remitterIban']||_0x1b13ed[_0x635e18(0xfa)]||_0x1b13ed[_0x635e18(0xc6)]){_0x57d140+=_0x635e18(0x85);_0x1b13ed[_0x635e18(0x139)]&&(_0x57d140+=_0x635e18(0xe8)+_0x1b13ed[_0x635e18(0x139)]+'`\x0a');_0x1b13ed[_0x635e18(0xad)]&&(_0x57d140+=_0x635e18(0xcb)+_0x1b13ed['customerEmail']+'`\x0a');_0x1b13ed[_0x635e18(0x117)]&&(_0x57d140+=_0x635e18(0x16d)+_0x1b13ed[_0x635e18(0x117)]+'`\x0a');_0x1b13ed[_0x635e18(0xfa)]&&(_0x57d140+=_0x635e18(0x9d)+_0x1b13ed[_0x635e18(0xfa)]+'`\x0a');if(_0x1b13ed[_0x635e18(0xc6)]){const _0x1c522a=_0x1b13ed['customerUa'][_0x635e18(0xfb)]>0x32?_0x1b13ed[_0x635e18(0xc6)][_0x635e18(0xec)](0x0,0x32)+_0x635e18(0xa3):_0x1b13ed[_0x635e18(0xc6)];_0x57d140+='üíª\x20Browser:\x20`'+_0x1c522a+'`\x0a';}}_0x4b8919==='chargeback'&&_0x1b13ed[_0x635e18(0xce)]&&(_0x57d140+=_0x635e18(0x158)+_0x1b13ed['chargebackAmount']+'\x20USDT*\x0a'),_0x4b8919==='processing'&&(_0x57d140+=_0x635e18(0x122)),_0x1b13ed[_0x635e18(0x97)]&&(_0x57d140+=_0x635e18(0x145)+_0x1b13ed['adminNotes']+'\x0a'),await this['sendShopNotification'](_0x23d524,_0x57d140,{'parse_mode':_0x635e18(0xf0)});}async[a78_0x21dcd4(0x10d)](_0xfda307,_0x5dff75){const _0x512eab=a78_0x21dcd4,_0x304322=new Date(_0x5dff75[_0x512eab(0x78)])[_0x512eab(0xdd)](_0x512eab(0x82),{'year':'numeric','month':_0x512eab(0x170),'day':_0x512eab(0x170),'hour':_0x512eab(0x170),'minute':_0x512eab(0x170),'second':'2-digit'}),_0x59b174=_0x512eab(0x128)+(_0x512eab(0x153)+_0x304322+'\x0a')+(_0x512eab(0x101)+_0x5dff75[_0x512eab(0x11f)]+'\x20USD\x0a')+(_0x512eab(0x163)+(_0x5dff75['period']||_0x512eab(0x127))+'\x0a')+(_0x512eab(0x7a)+(_0x5dff75[_0x512eab(0xe1)]||_0x512eab(0x127))+'\x0a')+(_0x512eab(0xa5)+(_0x5dff75[_0x512eab(0x107)]||_0x512eab(0x127))+'`\x0a')+(_0x5dff75['txid']?_0x512eab(0x81)+_0x5dff75[_0x512eab(0x9f)]+'`':_0x512eab(0x14a));await this[_0x512eab(0x100)](_0xfda307,_0x59b174,{'parse_mode':'Markdown'});}async[a78_0x21dcd4(0x131)](_0x3e929f,_0x40ab06){const _0x167ad6=a78_0x21dcd4;try{const _0x4f6c35=await database_1[_0x167ad6(0xbb)]['shopSettings'][_0x167ad6(0xa2)]({'where':{'shopId':_0x3e929f},'select':{'notificationLogin':!![]}});if(!_0x4f6c35?.['notificationLogin']){console[_0x167ad6(0x132)](_0x167ad6(0x14c)+_0x3e929f);return;}const _0x16d711=_0x40ab06[_0x167ad6(0x123)]?'üîê':'üö®',_0x40caae=_0x40ab06['success']?_0x167ad6(0x8e):_0x167ad6(0xd7);let _0x1078f6=_0x16d711+'\x20*'+_0x40caae+'*\x0a\x0a'+('üë§\x20Username:\x20`'+_0x40ab06['username']+'`\x0a')+(_0x167ad6(0x79)+_0x40ab06[_0x167ad6(0xcd)][_0x167ad6(0xdd)](_0x167ad6(0x82))+'\x0a');_0x40ab06[_0x167ad6(0x124)]&&(_0x1078f6+=_0x167ad6(0x168)+_0x40ab06[_0x167ad6(0x124)]+'`\x0a');_0x40ab06[_0x167ad6(0x16c)]&&(_0x1078f6+=_0x167ad6(0x16b)+_0x40ab06[_0x167ad6(0x16c)]+'\x0a');if(_0x40ab06[_0x167ad6(0x12a)]){const _0x396bf3=_0x40ab06[_0x167ad6(0x12a)][_0x167ad6(0xfb)]>0x32?_0x40ab06['userAgent'][_0x167ad6(0xec)](0x0,0x32)+_0x167ad6(0xa3):_0x40ab06[_0x167ad6(0x12a)];_0x1078f6+=_0x167ad6(0xd4)+_0x396bf3+'`\x0a';}!_0x40ab06['success']&&(_0x1078f6+=_0x167ad6(0x94)),await this[_0x167ad6(0x100)](_0x3e929f,_0x1078f6,{'parse_mode':_0x167ad6(0xf0)}),console[_0x167ad6(0x132)](_0x167ad6(0x8b)+_0x3e929f+':\x20'+(_0x40ab06[_0x167ad6(0x123)]?_0x167ad6(0x123):_0x167ad6(0x8a)));}catch(_0x44d491){console[_0x167ad6(0x144)](_0x167ad6(0xcf),_0x44d491);}}async['sendApiErrorNotification'](_0x3542d2,_0x56033f){const _0x2561c8=a78_0x21dcd4;try{const _0x283918=await database_1[_0x2561c8(0xbb)][_0x2561c8(0xab)][_0x2561c8(0xa2)]({'where':{'shopId':_0x3542d2},'select':{'notificationApiError':!![]}});if(!_0x283918?.[_0x2561c8(0xdf)]){console[_0x2561c8(0x132)]('üì±\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20'+_0x3542d2);return;}let _0x344c43=_0x2561c8(0x172)+(_0x2561c8(0xa1)+_0x56033f[_0x2561c8(0xd6)]+'\x20'+_0x56033f[_0x2561c8(0x13f)]+'`\x0a')+(_0x2561c8(0x79)+_0x56033f['timestamp'][_0x2561c8(0xdd)](_0x2561c8(0x82))+'\x0a');_0x56033f['statusCode']&&(_0x344c43+='üìä\x20Error\x20code:\x20`'+_0x56033f[_0x2561c8(0xbe)]+'`\x0a'),_0x344c43+=_0x2561c8(0x164)+_0x56033f[_0x2561c8(0x92)]+'`\x0a',_0x56033f['requestId']&&(_0x344c43+=_0x2561c8(0x87)+_0x56033f[_0x2561c8(0xe6)]+'`\x0a'),_0x344c43+='\x0aüí°\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x2561c8(0x100)](_0x3542d2,_0x344c43,{'parse_mode':'Markdown'}),console[_0x2561c8(0x132)](_0x2561c8(0xb5)+_0x3542d2+':\x20'+_0x56033f['endpoint']);}catch(_0x20b98b){console[_0x2561c8(0x144)]('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x20b98b);}}async[a78_0x21dcd4(0x126)](_0x2f5c49,_0x1fa440,_0x3b64e4){const _0x4893c7=a78_0x21dcd4;let _0x18ee7d=_0x4893c7(0xa9)+_0x1fa440+_0x4893c7(0x15f);for(const [_0x2d2d9a,_0x5a626d]of Object[_0x4893c7(0xba)](_0x3b64e4)){_0x5a626d!==null&&_0x5a626d!==undefined&&(_0x18ee7d+=_0x2d2d9a+_0x4893c7(0x14e)+_0x5a626d+'`\x0a');}await this[_0x4893c7(0x100)](_0x2f5c49,_0x18ee7d,{'parse_mode':'Markdown'});}async[a78_0x21dcd4(0x90)](_0x1aa735){const _0x39eb95=a78_0x21dcd4;try{console[_0x39eb95(0x132)](_0x39eb95(0xac)+_0x1aa735['substring'](0x0,0x32)+_0x39eb95(0xa3));const _0x4c5eb2=await database_1[_0x39eb95(0xbb)][_0x39eb95(0x149)]['findMany']({'select':{'telegramId':!![]}});if(_0x4c5eb2[_0x39eb95(0xfb)]===0x0){console[_0x39eb95(0x132)](_0x39eb95(0xf5));return;}for(const _0x16c155 of _0x4c5eb2){try{await this[_0x39eb95(0xee)]?.['sendMessage'](_0x16c155[_0x39eb95(0xa7)],_0x1aa735,{'parse_mode':'Markdown'});}catch(_0x1a7aa8){console[_0x39eb95(0x144)](_0x39eb95(0xd8)+_0x16c155[_0x39eb95(0xa7)]+':',_0x1a7aa8);}}console['log']('üì±\x20Notification\x20sent\x20to\x20'+_0x4c5eb2[_0x39eb95(0xfb)]+_0x39eb95(0x165));}catch(_0x466cfd){console[_0x39eb95(0x144)](_0x39eb95(0xe9),_0x466cfd);}}[a78_0x21dcd4(0x14f)](){return{'isActive':!!this['bot'],'username':this['botUsername']};}async[a78_0x21dcd4(0x15e)](_0x27e114,_0x5b5172,_0x230c38,_0x8b2552){const _0x388310=a78_0x21dcd4;try{if(!this[_0x388310(0xee)])return console[_0x388310(0x144)](_0x388310(0xb9)),![];const _0x2f449e=await database_1['default']['telegramUser'][_0x388310(0x83)]({'where':{'shopId':_0x27e114,'isVerified':!![]},'select':{'telegramId':!![]}});if(_0x2f449e[_0x388310(0xfb)]===0x0)return console[_0x388310(0x144)](_0x388310(0xb0)+_0x27e114),![];let _0x16c5d2=0x0;for(const _0x25b741 of _0x2f449e){try{await this[_0x388310(0xee)][_0x388310(0xbf)](_0x25b741[_0x388310(0xa7)],_0x5b5172,{},{'filename':_0x230c38,'contentType':_0x230c38[_0x388310(0x104)](_0x388310(0x13d))?_0x388310(0x10e):_0x230c38[_0x388310(0x104)](_0x388310(0xc9))||_0x230c38[_0x388310(0x104)](_0x388310(0xb8))?_0x388310(0x13e):_0x230c38[_0x388310(0x104)](_0x388310(0x10c))?_0x388310(0x143):'application/octet-stream'}),_0x8b2552&&await this[_0x388310(0xee)][_0x388310(0xea)](_0x25b741[_0x388310(0xa7)],_0x8b2552),_0x16c5d2++;}catch(_0x2229da){console['error'](_0x388310(0xe3)+_0x25b741[_0x388310(0xa7)]+':',_0x2229da);}}return console[_0x388310(0x132)](_0x388310(0x137)+_0x16c5d2+'/'+_0x2f449e[_0x388310(0xfb)]+_0x388310(0x77)+_0x27e114+':\x20'+_0x230c38),_0x16c5d2>0x0;}catch(_0x1dea60){return console[_0x388310(0x144)](_0x388310(0x146),_0x1dea60),![];}}async[a78_0x21dcd4(0x167)](_0x4e0e38,_0x58fbbd){const _0x1b5d1f=a78_0x21dcd4;try{if(!this[_0x1b5d1f(0xee)])return console['error']('‚ùå\x20Telegram\x20bot\x20not\x20initialized'),![];return await this[_0x1b5d1f(0xee)][_0x1b5d1f(0xea)](_0x4e0e38,_0x58fbbd),console['log'](_0x1b5d1f(0xda)+_0x4e0e38),!![];}catch(_0x343777){return console[_0x1b5d1f(0x144)](_0x1b5d1f(0xb3),_0x343777),![];}}async[a78_0x21dcd4(0x108)](_0x4fad8a,_0x4ca605,_0x315151,_0x2cd1a2){const _0x5806e7=a78_0x21dcd4;try{if(!this['bot'])return console[_0x5806e7(0x144)](_0x5806e7(0xb9)),![];return await this[_0x5806e7(0xee)][_0x5806e7(0xbf)](_0x4fad8a,_0x4ca605,{},{'filename':_0x315151,'contentType':_0x315151[_0x5806e7(0x104)](_0x5806e7(0x13d))?'image/png':_0x315151[_0x5806e7(0x104)]('.jpg')||_0x315151[_0x5806e7(0x104)](_0x5806e7(0xb8))?_0x5806e7(0x13e):_0x315151[_0x5806e7(0x104)](_0x5806e7(0x10c))?_0x5806e7(0x143):_0x5806e7(0x7d)}),_0x2cd1a2&&await this['bot']['sendMessage'](_0x4fad8a,_0x2cd1a2),console[_0x5806e7(0x132)](_0x5806e7(0xde)+_0x4fad8a+':\x20'+_0x315151),!![];}catch(_0x5b8440){return console[_0x5806e7(0x144)](_0x5806e7(0x93),_0x5b8440),![];}}[a78_0x21dcd4(0x96)](){const _0x47754f=a78_0x21dcd4;this['bot']&&(this[_0x47754f(0xee)]['stopPolling'](),this[_0x47754f(0xee)]=null,console[_0x47754f(0x132)](_0x47754f(0xb4)));}}exports[a78_0x21dcd4(0xa8)]=TelegramBotService,exports['telegramBotService']=new TelegramBotService();