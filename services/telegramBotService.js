'use strict';const a49_0xf06a26=a49_0x5c59;function a49_0x15e8(){const _0x38915a=['telegramId','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','chat','last_name','\x20\x20\x20Status:\x20','❌\x20Error\x20getting\x20debug\x20information.','../types/gateway','👤\x20Username:\x20`','🏪\x20Available\x20shops\x20in\x20system:\x0a','Failed\x20login\x20attempt','📱\x20Your\x20Telegram\x20ID:\x20`','💻\x20Browser:\x20`','map','Markdown','entries','📱\x20Shop:\x20*','✅\x20Telegram\x20user\x20','\x20initialized\x20successfully','🔌\x20User\x20','`\x20(','❌\x20Shop\x20`','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','text','shopSettings','📅\x20Connection\x20date:\x20','publicKey','timestamp','/status\x20-\x20check\x20connection\x20status\x0a','❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20','2341857itzleB','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','stopPolling','•\x20Payouts\x0a\x0a','Payout\x20completed','__importDefault','🔗\x20TXID:\x20`','onText','Example:\x0a','❌\x20Invalid\x20username\x20format:\x20`','9QSmOfs','message','Check\x20spelling\x20and\x20try\x20again.','New\x20payment\x20created','userAgent','To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a','3062946LtyMQk','warn','success','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','create','forEach','*\x0a\x0a','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','5XGvwKm','shop','name','Contact\x20administrator.','chat\x20not\x20found','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','trapay_bot','sendPayoutNotification','en-US','toLocaleString','env','Payment\x20chargeback','sendMessage','🔔\x20You\x20receive\x20notifications\x20about:\x0a','trim','method','stopBot','toLocaleDateString','•\x20Important\x20events\x0a\x0a','Error\x20handling\x20/disconnect\x20command:','`\x20is\x20inactive.\x0a\x0a','failed','💰\x20Amount:\x20*','\x20verified\x20for\x20shop\x20','•\x20Payment\x20status\x20changes\x0a','length','🔔\x20Notifications\x20are\x20active\x0a\x0a','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','endpoint','•\x20Payouts\x0a','txid','Payment\x20successfully\x20paid','includes','sendShopNotification','\x20via\x20single-line\x20input','polling_error','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','errorMessage','❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a','default','Payment\x20refund','Available\x20usernames:\x0a','Telegram\x20bot\x20polling\x20error:','botToken','defineProperty','📱\x20Telegram\x20notification:\x20gateway\x20\x22','update','adminNotes','toString','❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.',':\x20username=\x22','notificationLogin','Payment\x20failed','User\x20','🎉\x20*Congratulations!*\x0a\x0a','🔍\x20*Debug\x20Information*\x0a\x0a','❌\x20Shop\x20with\x20username\x20`','•\x20`','join','1158342JGtkTz','../config/database','currency','Payout\x20rejected','isVerified','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','🏪\x20Gateway:\x20`','You\x20sent\x20','📱\x20Created\x20new\x20Telegram\x20user:\x20','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','`\x20not\x20found.\x0a\x0a','chargebackAmount','\x20USDT*\x0a','error','Payment\x20is\x20being\x20processed','sendPaymentNotification','telegramUser','...\x22','Use\x20/start\x20to\x20begin.','✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*','Error\x20handling\x20/status\x20command:','Error\x20handling\x20/debug\x20command:','Successful\x20login','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','from','split','Failed\x20to\x20send\x20login\x20notification:','2161760MjhjEh','initializeBot','TELEGRAM_BOT_TOKEN','requestId','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','processing','\x22,\x20apiKey=\x22','substring','📊\x20*Connection\x20Status*\x0a\x0a','notificationApiError','🛑\x20Telegram\x20bot\x20stopped','`\x0a\x0a','📝\x20Notes:\x20','2070272SCBIlm','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','username','getBotInfo','\x20USD*\x0a','shopId','27766280awuUZs','🏦\x20Method:\x20`','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','666612ZiIxYe','TelegramBotService','`.\x0a\x0a','updatedAt','Error\x20handling\x20message:','unknown\x20shop','user\x20is\x20deactivated','findMany','allSettled','💸\x20Penalty\x20amount:\x20*','❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a','1hJVVyp','Error\x20sending\x20shop\x20notification:','findUnique','💸\x20Amount:\x20*','telegramBotService','Error\x20handling\x20/start\x20command:','🚨\x20*API\x20Error*\x0a\x0a','__esModule','pk_','🔔\x20*','startsWith','\x20\x20\x20Public\x20Key:\x20`','🌐\x20IP\x20address:\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','Commands:\x0a','❌\x20Please\x20use\x20/start\x20command\x20first','status','handleSingleLineVerification','🆔\x20Request\x20ID:\x20`','blocked','setupBotHandlers','📅\x20Date:\x20','🆔\x20Payment\x20ID:\x20`','gateway','\x20parts:\x20','bot','log','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','New\x20payout\x20created','TELEGRAM_BOT_USERNAME','📅\x20Time:\x20','ipAddress','createdAt','first_name','Error\x20in\x20handleSingleLineVerification:'];a49_0x15e8=function(){return _0x38915a;};return a49_0x15e8();}(function(_0x37cc3d,_0x39993a){const _0x2b6851=a49_0x5c59,_0x365f7a=_0x37cc3d();while(!![]){try{const _0xc8fbe5=parseInt(_0x2b6851(0x1fa))/0x1*(-parseInt(_0x2b6851(0x1bc))/0x2)+-parseInt(_0x2b6851(0x1ef))/0x3+-parseInt(_0x2b6851(0x1d7))/0x4+-parseInt(_0x2b6851(0x181))/0x5*(parseInt(_0x2b6851(0x179))/0x6)+-parseInt(_0x2b6851(0x169))/0x7+-parseInt(_0x2b6851(0x1e5))/0x8+-parseInt(_0x2b6851(0x173))/0x9*(-parseInt(_0x2b6851(0x1ec))/0xa);if(_0xc8fbe5===_0x39993a)break;else _0x365f7a['push'](_0x365f7a['shift']());}catch(_0x2ee619){_0x365f7a['push'](_0x365f7a['shift']());}}}(a49_0x15e8,0x50ceb));var __importDefault=this&&this[a49_0xf06a26(0x16e)]||function(_0x2b75f2){const _0x55c4d1=a49_0xf06a26;return _0x2b75f2&&_0x2b75f2[_0x55c4d1(0x201)]?_0x2b75f2:{'default':_0x2b75f2};};function a49_0x5c59(_0x4d7126,_0x3aa7b3){const _0x15e8ae=a49_0x15e8();return a49_0x5c59=function(_0x5c590a,_0x1106b9){_0x5c590a=_0x5c590a-0x144;let _0x24f9c4=_0x15e8ae[_0x5c590a];return _0x24f9c4;},a49_0x5c59(_0x4d7126,_0x3aa7b3);}Object[a49_0xf06a26(0x1ad)](exports,a49_0xf06a26(0x201),{'value':!![]}),exports[a49_0xf06a26(0x1fe)]=exports[a49_0xf06a26(0x1f0)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require('node-telegram-bot-api')),database_1=__importDefault(require(a49_0xf06a26(0x1bd))),gateway_1=require(a49_0xf06a26(0x152));class TelegramBotService{constructor(){const _0x300972=a49_0xf06a26;this['bot']=null,this[_0x300972(0x1ac)]=process[_0x300972(0x18b)][_0x300972(0x1d9)]||'',this['botUsername']=process[_0x300972(0x18b)][_0x300972(0x146)]||_0x300972(0x187),this['botToken']?this[_0x300972(0x1d8)]():console[_0x300972(0x17a)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}[a49_0xf06a26(0x1d8)](){const _0x33a3ae=a49_0xf06a26;try{this[_0x33a3ae(0x213)]=new node_telegram_bot_api_1[(_0x33a3ae(0x1a8))](this['botToken'],{'polling':!![]}),this[_0x33a3ae(0x20e)](),console['log']('✅\x20Telegram\x20bot\x20@'+this['botUsername']+_0x33a3ae(0x15d));}catch(_0x1716f1){console[_0x33a3ae(0x1c9)]('❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',_0x1716f1);}}['setupBotHandlers'](){const _0x26f716=a49_0xf06a26;if(!this[_0x26f716(0x213)])return;this[_0x26f716(0x213)]['onText'](/\/start/,async _0x46855b=>{const _0x38d992=_0x26f716,_0x3ca971=_0x46855b['chat']['id'],_0x143067=_0x46855b['from']?.['id']['toString'](),_0x545de=_0x46855b[_0x38d992(0x1d4)]?.['username'],_0x1fb6af=_0x46855b['from']?.[_0x38d992(0x14a)],_0x73b5ab=_0x46855b[_0x38d992(0x1d4)]?.[_0x38d992(0x14f)];if(!_0x143067)return;try{let _0x519721=await database_1[_0x38d992(0x1a8)][_0x38d992(0x1cc)][_0x38d992(0x1fc)]({'where':{'telegramId':_0x143067},'include':{'shop':!![]}});!_0x519721?(_0x519721=await database_1[_0x38d992(0x1a8)][_0x38d992(0x1cc)][_0x38d992(0x17d)]({'data':{'telegramId':_0x143067,'username':_0x545de,'firstName':_0x1fb6af,'lastName':_0x73b5ab,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0x38d992(0x214)](_0x38d992(0x1c4)+_0x143067+'\x20(@'+_0x545de+')')):_0x519721=await database_1['default'][_0x38d992(0x1cc)][_0x38d992(0x1af)]({'where':{'telegramId':_0x143067},'data':{'username':_0x545de,'firstName':_0x1fb6af,'lastName':_0x73b5ab},'include':{'shop':!![]}}),_0x519721[_0x38d992(0x1c0)]&&_0x519721[_0x38d992(0x1eb)]&&_0x519721[_0x38d992(0x182)]?await this['bot']?.[_0x38d992(0x18d)](_0x3ca971,'✅\x20Welcome\x20back!\x0a\x0a'+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x519721[_0x38d992(0x182)][_0x38d992(0x183)]+'*\x0a')+('Username:\x20`'+_0x519721['shop'][_0x38d992(0x1e8)]+'`\x0a\x0a')+_0x38d992(0x18e)+'•\x20New\x20payments\x0a'+_0x38d992(0x199)+_0x38d992(0x16c)+_0x38d992(0x208)+'/status\x20-\x20check\x20connection\x20status\x0a'+_0x38d992(0x207),{'parse_mode':'Markdown'}):(_0x519721[_0x38d992(0x1eb)]&&!_0x519721[_0x38d992(0x1c0)]&&(await database_1['default'][_0x38d992(0x1cc)][_0x38d992(0x1af)]({'where':{'telegramId':_0x143067},'data':{'shopId':null,'isVerified':![]}}),console[_0x38d992(0x214)]('🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20'+_0x143067)),await this[_0x38d992(0x213)]?.[_0x38d992(0x18d)](_0x3ca971,_0x38d992(0x180)+_0x38d992(0x178)+_0x38d992(0x1d3)+'Example:\x0a'+_0x38d992(0x16a)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0x38d992(0x159)}));}catch(_0x4076e2){console['error'](_0x38d992(0x1ff),_0x4076e2),await this[_0x38d992(0x213)]?.[_0x38d992(0x18d)](_0x3ca971,_0x38d992(0x1a5));}}),this[_0x26f716(0x213)][_0x26f716(0x170)](/\/disconnect/,async _0x5109b4=>{const _0x27cd3f=_0x26f716,_0x47bf73=_0x5109b4[_0x27cd3f(0x14e)]['id'],_0x55f4d1=_0x5109b4[_0x27cd3f(0x1d4)]?.['id']['toString']();if(!_0x55f4d1)return;try{const _0x1c8df0=await database_1[_0x27cd3f(0x1a8)][_0x27cd3f(0x1cc)][_0x27cd3f(0x1fc)]({'where':{'telegramId':_0x55f4d1},'include':{'shop':!![]}});if(!_0x1c8df0||!_0x1c8df0['isVerified']||!_0x1c8df0[_0x27cd3f(0x1eb)]){await this[_0x27cd3f(0x213)]?.[_0x27cd3f(0x18d)](_0x47bf73,_0x27cd3f(0x1b2));return;}const _0x5a3429=_0x1c8df0[_0x27cd3f(0x182)]?.[_0x27cd3f(0x183)]||_0x27cd3f(0x1f4);await database_1['default'][_0x27cd3f(0x1cc)]['update']({'where':{'telegramId':_0x55f4d1},'data':{'shopId':null,'isVerified':![]}}),console[_0x27cd3f(0x214)](_0x27cd3f(0x15e)+_0x55f4d1+'\x20disconnected\x20from\x20shop\x20'+_0x1c8df0['shopId']),await this['bot']?.[_0x27cd3f(0x18d)](_0x47bf73,_0x27cd3f(0x1cf)+_0x5a3429+'*.\x0a\x0a'+'To\x20reconnect,\x20use\x20the\x20/start\x20command',{'parse_mode':_0x27cd3f(0x159)});}catch(_0x47c065){console['error'](_0x27cd3f(0x194),_0x47c065),await this[_0x27cd3f(0x213)]?.['sendMessage'](_0x47bf73,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot'][_0x26f716(0x170)](/\/status/,async _0xe9cadc=>{const _0x366fc4=_0x26f716,_0x53018e=_0xe9cadc[_0x366fc4(0x14e)]['id'],_0x15d260=_0xe9cadc[_0x366fc4(0x1d4)]?.['id'][_0x366fc4(0x1b1)]();if(!_0x15d260)return;try{const _0x491d34=await database_1['default']['telegramUser'][_0x366fc4(0x1fc)]({'where':{'telegramId':_0x15d260},'include':{'shop':!![]}});if(!_0x491d34){await this['bot']?.[_0x366fc4(0x18d)](_0x53018e,_0x366fc4(0x1f9)+_0x366fc4(0x1ce));return;}if(!_0x491d34[_0x366fc4(0x1c0)]||!_0x491d34[_0x366fc4(0x1eb)]||!_0x491d34['shop']){await this['bot']?.[_0x366fc4(0x18d)](_0x53018e,_0x366fc4(0x1dc)+'Use\x20/start\x20to\x20connect.');return;}await this[_0x366fc4(0x213)]?.[_0x366fc4(0x18d)](_0x53018e,_0x366fc4(0x1e0)+('✅\x20Connected\x20to\x20shop:\x20*'+_0x491d34[_0x366fc4(0x182)]['name']+'*\x0a')+('👤\x20Username:\x20`'+_0x491d34[_0x366fc4(0x182)]['username']+'`\x0a')+(_0x366fc4(0x164)+_0x491d34[_0x366fc4(0x1f2)][_0x366fc4(0x192)](_0x366fc4(0x189))+'\x0a\x0a')+_0x366fc4(0x19b)+_0x366fc4(0x208)+'/disconnect\x20-\x20disconnect\x20from\x20notifications',{'parse_mode':_0x366fc4(0x159)});}catch(_0xe34454){console[_0x366fc4(0x1c9)](_0x366fc4(0x1d0),_0xe34454),await this['bot']?.[_0x366fc4(0x18d)](_0x53018e,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot'][_0x26f716(0x170)](/\/debug/,async _0x2cfac8=>{const _0x4083da=_0x26f716,_0xacbe81=_0x2cfac8['chat']['id'],_0x399ec8=_0x2cfac8[_0x4083da(0x1d4)]?.['id'][_0x4083da(0x1b1)]();if(!_0x399ec8)return;try{const _0x5fdc4e=await database_1[_0x4083da(0x1a8)][_0x4083da(0x182)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x2e87d2=_0x4083da(0x1b8);_0x2e87d2+=_0x4083da(0x156)+_0x399ec8+'`\x0a\x0a',_0x2e87d2+=_0x4083da(0x154),_0x5fdc4e[_0x4083da(0x17e)]((_0x203439,_0x9cc5b0)=>{const _0x4b8954=_0x4083da;_0x2e87d2+=_0x9cc5b0+0x1+'.\x20*'+_0x203439[_0x4b8954(0x183)]+'*\x0a',_0x2e87d2+='\x20\x20\x20Username:\x20`'+_0x203439[_0x4b8954(0x1e8)]+'`\x0a',_0x2e87d2+=_0x4b8954(0x150)+_0x203439['status']+'\x0a',_0x2e87d2+=_0x4b8954(0x205)+_0x203439[_0x4b8954(0x165)]['substring'](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x4083da(0x213)]?.['sendMessage'](_0xacbe81,_0x2e87d2,{'parse_mode':'Markdown'});}catch(_0x3abcef){console['error'](_0x4083da(0x1d1),_0x3abcef),await this[_0x4083da(0x213)]?.[_0x4083da(0x18d)](_0xacbe81,_0x4083da(0x151));}}),this['bot']['on']('message',async _0x3505e5=>{const _0x5c9880=_0x26f716;if(_0x3505e5[_0x5c9880(0x162)]?.[_0x5c9880(0x204)]('/'))return;const _0x25c067=_0x3505e5[_0x5c9880(0x14e)]['id'],_0x53fc1f=_0x3505e5['from']?.['id'][_0x5c9880(0x1b1)](),_0x4d17e5=_0x3505e5[_0x5c9880(0x162)]?.[_0x5c9880(0x18f)]();if(!_0x53fc1f||!_0x4d17e5)return;try{const _0x25067d=await database_1[_0x5c9880(0x1a8)][_0x5c9880(0x1cc)][_0x5c9880(0x1fc)]({'where':{'telegramId':_0x53fc1f},'include':{'shop':!![]}});if(!_0x25067d){await this[_0x5c9880(0x213)]?.[_0x5c9880(0x18d)](_0x25c067,_0x5c9880(0x209));return;}if(_0x25067d[_0x5c9880(0x1c0)]&&_0x25067d[_0x5c9880(0x1eb)]&&_0x25067d[_0x5c9880(0x182)]){await this[_0x5c9880(0x213)]?.['sendMessage'](_0x25c067,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x25067d[_0x5c9880(0x182)]['name']+'*.\x0a\x0a'+_0x5c9880(0x19c),{'parse_mode':_0x5c9880(0x159)});return;}const _0xc70ffc=_0x4d17e5[_0x5c9880(0x1d5)](/\s+/);if(_0xc70ffc[_0x5c9880(0x19a)]!==0x2){await this['bot']?.['sendMessage'](_0x25c067,_0x5c9880(0x1a7)+'📝\x20Format:\x20`username\x20api_key`\x0a\x0a'+_0x5c9880(0x171)+_0x5c9880(0x16a)+(_0x5c9880(0x1c3)+_0xc70ffc[_0x5c9880(0x19a)]+_0x5c9880(0x212)+_0xc70ffc[_0x5c9880(0x158)](_0xdd07c3=>'`'+_0xdd07c3+'`')[_0x5c9880(0x1bb)](',\x20')),{'parse_mode':_0x5c9880(0x159)});return;}const [_0x24349a,_0x33196f]=_0xc70ffc;console[_0x5c9880(0x214)](_0x5c9880(0x1e6)+_0x53fc1f+_0x5c9880(0x1b3)+_0x24349a+'\x22,\x20apiKey=\x22'+_0x33196f[_0x5c9880(0x1df)](0x0,0xa)+_0x5c9880(0x1cd)),await this[_0x5c9880(0x20b)](_0x25c067,_0x53fc1f,_0x24349a,_0x33196f);}catch(_0x18a383){console[_0x5c9880(0x1c9)](_0x5c9880(0x1f3),_0x18a383),await this[_0x5c9880(0x213)]?.[_0x5c9880(0x18d)](_0x25c067,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot']['on'](_0x26f716(0x1c9),_0x5cfc3f=>{console['error']('Telegram\x20bot\x20error:',_0x5cfc3f);}),this[_0x26f716(0x213)]['on'](_0x26f716(0x1a4),_0x617745=>{const _0x5aafa7=_0x26f716;console['error'](_0x5aafa7(0x1ab),_0x617745);});}async[a49_0xf06a26(0x20b)](_0x29af21,_0x110180,_0x15fcf5,_0x1644f1){const _0x323153=a49_0xf06a26;try{console['log']('🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20'+_0x110180+':\x20username=\x22'+_0x15fcf5+_0x323153(0x1de)+_0x1644f1[_0x323153(0x1df)](0x0,0xa)+_0x323153(0x1cd));if(!_0x15fcf5||_0x15fcf5[_0x323153(0x19a)]<0x3||_0x15fcf5[_0x323153(0x19a)]>0x32||!/^[a-zA-Z0-9_]+$/['test'](_0x15fcf5)){await this[_0x323153(0x213)]?.['sendMessage'](_0x29af21,_0x323153(0x172)+_0x15fcf5+_0x323153(0x1e3)+_0x323153(0x1db),{'parse_mode':_0x323153(0x159)});return;}if(!_0x1644f1||!_0x1644f1['startsWith'](_0x323153(0x202))&&!_0x1644f1[_0x323153(0x204)]('sk_')){await this[_0x323153(0x213)]?.[_0x323153(0x18d)](_0x29af21,'❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a'+'API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.',{'parse_mode':_0x323153(0x159)});return;}const _0x4fdd13=await database_1[_0x323153(0x1a8)][_0x323153(0x182)]['findUnique']({'where':{'username':_0x15fcf5},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x4fdd13){const _0x22e91f=await database_1[_0x323153(0x1a8)][_0x323153(0x182)][_0x323153(0x1f6)]({'select':{'username':!![],'name':!![]},'take':0x5});let _0x3cb697=_0x323153(0x1b9)+_0x15fcf5+_0x323153(0x1c6);_0x22e91f['length']>0x0?(_0x3cb697+=_0x323153(0x1aa),_0x22e91f[_0x323153(0x17e)](_0x4a9dc=>{const _0x1f375c=_0x323153;_0x3cb697+=_0x1f375c(0x1ba)+_0x4a9dc[_0x1f375c(0x1e8)]+_0x1f375c(0x15f)+_0x4a9dc[_0x1f375c(0x183)]+')\x0a';}),_0x3cb697+='\x0aCheck\x20spelling\x20and\x20try\x20again.'):_0x3cb697+=_0x323153(0x175);await this[_0x323153(0x213)]?.[_0x323153(0x18d)](_0x29af21,_0x3cb697,{'parse_mode':_0x323153(0x159)});return;}if(_0x4fdd13[_0x323153(0x20a)]!=='ACTIVE'){await this[_0x323153(0x213)]?.[_0x323153(0x18d)](_0x29af21,_0x323153(0x160)+_0x15fcf5+_0x323153(0x195)+_0x323153(0x184),{'parse_mode':_0x323153(0x159)});return;}if(_0x4fdd13[_0x323153(0x165)]!==_0x1644f1&&_0x4fdd13['secretKey']!==_0x1644f1){await this[_0x323153(0x213)]?.[_0x323153(0x18d)](_0x29af21,'❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`'+_0x15fcf5+'`.\x0a\x0a'+_0x323153(0x161)+'Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`',{'parse_mode':'Markdown'});return;}const _0x18333c=await database_1[_0x323153(0x1a8)][_0x323153(0x1cc)]['findFirst']({'where':{'shopId':_0x4fdd13['id'],'isVerified':!![],'telegramId':{'not':_0x110180}}});if(_0x18333c){await this[_0x323153(0x213)]?.[_0x323153(0x18d)](_0x29af21,_0x323153(0x1e7)+_0x15fcf5+_0x323153(0x1f1)+_0x323153(0x1c5),{'parse_mode':'Markdown'});return;}await database_1[_0x323153(0x1a8)][_0x323153(0x1cc)][_0x323153(0x1af)]({'where':{'telegramId':_0x110180},'data':{'shopId':_0x4fdd13['id'],'isVerified':!![]}}),await this[_0x323153(0x213)]?.['sendMessage'](_0x29af21,_0x323153(0x1b7)+'✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a'+(_0x323153(0x15b)+_0x4fdd13[_0x323153(0x183)]+'*\x0a')+(_0x323153(0x153)+_0x4fdd13['username']+_0x323153(0x1e3))+'🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a'+'•\x20New\x20payments\x0a'+_0x323153(0x199)+_0x323153(0x19e)+_0x323153(0x193)+_0x323153(0x208)+_0x323153(0x167)+_0x323153(0x207),{'parse_mode':_0x323153(0x159)}),console[_0x323153(0x214)](_0x323153(0x15c)+_0x110180+_0x323153(0x198)+_0x4fdd13[_0x323153(0x1e8)]+_0x323153(0x1a3));}catch(_0x3bc3d7){console['error'](_0x323153(0x14b),_0x3bc3d7),await this[_0x323153(0x213)]?.[_0x323153(0x18d)](_0x29af21,_0x323153(0x17c));}}async[a49_0xf06a26(0x1a2)](_0xc6171b,_0x2ab6ea,_0x3f5d36){const _0x4d30c9=a49_0xf06a26;if(!this['bot']){console[_0x4d30c9(0x17a)]('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x542bce=await database_1['default'][_0x4d30c9(0x1cc)][_0x4d30c9(0x1f6)]({'where':{'shopId':_0xc6171b,'isVerified':!![]}});if(_0x542bce[_0x4d30c9(0x19a)]===0x0){console['log'](_0x4d30c9(0x1c1)+_0xc6171b);return;}const _0x5e117a=_0x542bce['map'](async _0x17470e=>{const _0x435b7f=_0x4d30c9;try{await this[_0x435b7f(0x213)]?.[_0x435b7f(0x18d)](_0x17470e[_0x435b7f(0x14c)],_0x2ab6ea,_0x3f5d36),console[_0x435b7f(0x214)]('✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20'+_0x17470e[_0x435b7f(0x14c)]);}catch(_0xdcbf9a){console[_0x435b7f(0x1c9)](_0x435b7f(0x168)+_0x17470e[_0x435b7f(0x14c)]+':',_0xdcbf9a),_0xdcbf9a instanceof Error&&(_0xdcbf9a[_0x435b7f(0x174)][_0x435b7f(0x1a1)](_0x435b7f(0x20d))||_0xdcbf9a['message']['includes'](_0x435b7f(0x185))||_0xdcbf9a[_0x435b7f(0x174)][_0x435b7f(0x1a1)](_0x435b7f(0x1f5)))&&(await database_1[_0x435b7f(0x1a8)][_0x435b7f(0x1cc)][_0x435b7f(0x1af)]({'where':{'id':_0x17470e['id']},'data':{'isVerified':![]}}),console[_0x435b7f(0x214)](_0x435b7f(0x1b6)+_0x17470e[_0x435b7f(0x14c)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise[_0x4d30c9(0x1f7)](_0x5e117a);}catch(_0xafa950){console['error'](_0x4d30c9(0x1fb),_0xafa950);}}async[a49_0xf06a26(0x1cb)](_0x20aba0,_0x475002,_0x3d09a6){const _0xc9966e=a49_0xf06a26,_0xa4a890={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x3e1cad={'created':_0xc9966e(0x176),'paid':_0xc9966e(0x1a0),'failed':_0xc9966e(0x1b5),'expired':'Payment\x20expired','refund':_0xc9966e(0x1a9),'chargeback':_0xc9966e(0x18c),'processing':_0xc9966e(0x1ca)},_0x1d6571=_0xa4a890[_0x3d09a6],_0x46e72f=_0x3e1cad[_0x3d09a6],_0x456e2e=(0x0,gateway_1['getGatewayDisplayNameForTelegram'])(_0x475002[_0xc9966e(0x211)]);console[_0xc9966e(0x214)](_0xc9966e(0x1ae)+_0x475002[_0xc9966e(0x211)]+'\x22\x20->\x20display\x20\x22'+_0x456e2e+'\x22');let _0x5f24b4=_0x1d6571+'\x20*'+_0x46e72f+'*\x0a\x0a'+(_0xc9966e(0x197)+_0x475002['amount']+'\x20'+_0x475002[_0xc9966e(0x1be)]+'*\x0a')+('📝\x20Order\x20ID:\x20`'+(_0x475002['orderId']||_0x475002['id'])+'`\x0a')+(_0xc9966e(0x210)+_0x475002['id']+'`\x0a')+(_0xc9966e(0x1c2)+_0x456e2e+'`\x0a')+(_0xc9966e(0x20f)+new Date(_0x475002[_0xc9966e(0x149)])[_0xc9966e(0x18a)](_0xc9966e(0x189))+'\x0a');_0x3d09a6==='chargeback'&&_0x475002[_0xc9966e(0x1c7)]&&(_0x5f24b4+=_0xc9966e(0x1f8)+_0x475002['chargebackAmount']+_0xc9966e(0x1c8)),_0x3d09a6===_0xc9966e(0x1dd)&&(_0x5f24b4+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x475002[_0xc9966e(0x1b0)]&&(_0x5f24b4+=_0xc9966e(0x1e4)+_0x475002[_0xc9966e(0x1b0)]+'\x0a'),await this[_0xc9966e(0x1a2)](_0x20aba0,_0x5f24b4,{'parse_mode':_0xc9966e(0x159)});}async[a49_0xf06a26(0x188)](_0x273848,_0x4f6bd8,_0x4a019f){const _0x4cd374=a49_0xf06a26,_0x49f033={'created':'📤','completed':'✅','rejected':'❌'},_0x32053e={'created':_0x4cd374(0x145),'completed':_0x4cd374(0x16d),'rejected':_0x4cd374(0x1bf)},_0x3c4790=_0x49f033[_0x4a019f],_0xb3080c=_0x32053e[_0x4a019f],_0x3a872f=_0x3c4790+'\x20*'+_0xb3080c+_0x4cd374(0x17f)+(_0x4cd374(0x1fd)+_0x4f6bd8['amount']+_0x4cd374(0x1ea))+(_0x4cd374(0x1ed)+_0x4f6bd8['method']+'`\x0a')+('🆔\x20Payout\x20ID:\x20`'+_0x4f6bd8['id']+'`\x0a')+(_0x4cd374(0x20f)+new Date(_0x4f6bd8['createdAt'])[_0x4cd374(0x18a)](_0x4cd374(0x189))+'\x0a')+(_0x4f6bd8[_0x4cd374(0x19f)]?_0x4cd374(0x16f)+_0x4f6bd8[_0x4cd374(0x19f)]+'`':'');await this['sendShopNotification'](_0x273848,_0x3a872f,{'parse_mode':_0x4cd374(0x159)});}async['sendLoginNotification'](_0x46269a,_0x1b482b){const _0x324771=a49_0xf06a26;try{const _0x2b1d1d=await database_1['default'][_0x324771(0x163)][_0x324771(0x1fc)]({'where':{'shopId':_0x46269a},'select':{'notificationLogin':!![]}});if(!_0x2b1d1d?.[_0x324771(0x1b4)]){console[_0x324771(0x214)](_0x324771(0x14d)+_0x46269a);return;}const _0x2a0a2f=_0x1b482b[_0x324771(0x17b)]?'🔐':'🚨',_0x655b84=_0x1b482b[_0x324771(0x17b)]?_0x324771(0x1d2):_0x324771(0x155);let _0x95cc4a=_0x2a0a2f+'\x20*'+_0x655b84+'*\x0a\x0a'+(_0x324771(0x153)+_0x1b482b['username']+'`\x0a')+(_0x324771(0x147)+_0x1b482b['timestamp']['toLocaleString'](_0x324771(0x189))+'\x0a');_0x1b482b[_0x324771(0x148)]&&(_0x95cc4a+=_0x324771(0x206)+_0x1b482b[_0x324771(0x148)]+'`\x0a');if(_0x1b482b[_0x324771(0x177)]){const _0x32af04=_0x1b482b[_0x324771(0x177)][_0x324771(0x19a)]>0x32?_0x1b482b[_0x324771(0x177)][_0x324771(0x1df)](0x0,0x32)+'...':_0x1b482b[_0x324771(0x177)];_0x95cc4a+=_0x324771(0x157)+_0x32af04+'`\x0a';}!_0x1b482b[_0x324771(0x17b)]&&(_0x95cc4a+=_0x324771(0x144)),await this[_0x324771(0x1a2)](_0x46269a,_0x95cc4a,{'parse_mode':_0x324771(0x159)}),console[_0x324771(0x214)](_0x324771(0x1ee)+_0x46269a+':\x20'+(_0x1b482b[_0x324771(0x17b)]?_0x324771(0x17b):_0x324771(0x196)));}catch(_0x5c8c71){console[_0x324771(0x1c9)](_0x324771(0x1d6),_0x5c8c71);}}async['sendApiErrorNotification'](_0x2b40ac,_0x20a6ca){const _0x34009a=a49_0xf06a26;try{const _0x566752=await database_1[_0x34009a(0x1a8)][_0x34009a(0x163)]['findUnique']({'where':{'shopId':_0x2b40ac},'select':{'notificationApiError':!![]}});if(!_0x566752?.[_0x34009a(0x1e1)]){console['log'](_0x34009a(0x186)+_0x2b40ac);return;}let _0x53f711=_0x34009a(0x200)+('🔗\x20Endpoint:\x20`'+_0x20a6ca[_0x34009a(0x190)]+'\x20'+_0x20a6ca[_0x34009a(0x19d)]+'`\x0a')+(_0x34009a(0x147)+_0x20a6ca[_0x34009a(0x166)][_0x34009a(0x18a)](_0x34009a(0x189))+'\x0a');_0x20a6ca['statusCode']&&(_0x53f711+='📊\x20Error\x20code:\x20`'+_0x20a6ca['statusCode']+'`\x0a'),_0x53f711+='❌\x20Error:\x20`'+_0x20a6ca[_0x34009a(0x1a6)]+'`\x0a',_0x20a6ca['requestId']&&(_0x53f711+=_0x34009a(0x20c)+_0x20a6ca[_0x34009a(0x1da)]+'`\x0a'),_0x53f711+='\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.',await this[_0x34009a(0x1a2)](_0x2b40ac,_0x53f711,{'parse_mode':_0x34009a(0x159)}),console[_0x34009a(0x214)]('✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20'+_0x2b40ac+':\x20'+_0x20a6ca[_0x34009a(0x19d)]);}catch(_0x16ffb0){console['error']('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x16ffb0);}}async['sendCustomNotification'](_0x13414b,_0x562d07,_0x3ed715){const _0x22e1f6=a49_0xf06a26;let _0x18b9bf=_0x22e1f6(0x203)+_0x562d07+_0x22e1f6(0x17f);for(const [_0x2d6569,_0x199a2a]of Object[_0x22e1f6(0x15a)](_0x3ed715)){_0x199a2a!==null&&_0x199a2a!==undefined&&(_0x18b9bf+=_0x2d6569+':\x20`'+_0x199a2a+'`\x0a');}await this[_0x22e1f6(0x1a2)](_0x13414b,_0x18b9bf,{'parse_mode':_0x22e1f6(0x159)});}[a49_0xf06a26(0x1e9)](){const _0x130597=a49_0xf06a26;return{'isActive':!!this[_0x130597(0x213)],'username':this['botUsername']};}[a49_0xf06a26(0x191)](){const _0xdc2079=a49_0xf06a26;this[_0xdc2079(0x213)]&&(this[_0xdc2079(0x213)][_0xdc2079(0x16b)](),this[_0xdc2079(0x213)]=null,console['log'](_0xdc2079(0x1e2)));}}exports[a49_0xf06a26(0x1f0)]=TelegramBotService,exports[a49_0xf06a26(0x1fe)]=new TelegramBotService();