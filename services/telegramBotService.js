'use strict';const a57_0x51545e=a57_0x5586;(function(_0x596569,_0x11cc0d){const _0x283b84=a57_0x5586,_0x4e70b8=_0x596569();while(!![]){try{const _0x1032cc=parseInt(_0x283b84(0x172))/0x1+parseInt(_0x283b84(0x22c))/0x2*(parseInt(_0x283b84(0x1f3))/0x3)+parseInt(_0x283b84(0x170))/0x4+-parseInt(_0x283b84(0x22f))/0x5*(parseInt(_0x283b84(0x177))/0x6)+-parseInt(_0x283b84(0x1b0))/0x7+parseInt(_0x283b84(0x227))/0x8*(-parseInt(_0x283b84(0x168))/0x9)+-parseInt(_0x283b84(0x162))/0xa*(-parseInt(_0x283b84(0x1de))/0xb);if(_0x1032cc===_0x11cc0d)break;else _0x4e70b8['push'](_0x4e70b8['shift']());}catch(_0x51c705){_0x4e70b8['push'](_0x4e70b8['shift']());}}}(a57_0x5258,0xcea6d));var __importDefault=this&&this[a57_0x51545e(0x1ec)]||function(_0x1ee341){const _0x4690b9=a57_0x51545e;return _0x1ee341&&_0x1ee341[_0x4690b9(0x1a3)]?_0x1ee341:{'default':_0x1ee341};};function a57_0x5258(){const _0x5c22f1=['failed','updatedAt','✅\x20Welcome\x20back!\x0a\x0a','username','Available\x20usernames:\x0a','warn','substring','✅\x20API\x20error\x20notification\x20sent\x20for\x20shop\x20','310120AJtcMh','includes','✅\x20Telegram\x20user\x20','`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a','📱\x20Telegram\x20notification:\x20gateway\x20\x22','botUsername','45tMlJBO','startsWith','userAgent','🔗\x20TXID:\x20`','name','blocked','❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.','text','2725644hhcNgo','✅\x20Telegram\x20bot\x20@','736288LlGRTQ','🚨\x20*API\x20Error*\x0a\x0a','✅\x20Connected\x20to\x20shop:\x20*','Markdown','Error\x20in\x20handleSingleLineVerification:','6zemFyN','../config/database','Payment\x20is\x20being\x20processed','\x22\x20->\x20display\x20\x22','📝\x20Order\x20ID:\x20`','\x20(@',':\x20username=\x22','Telegram\x20bot\x20error:','Disconnect\x20the\x20previous\x20account\x20first\x20or\x20contact\x20administrator.','getBotInfo','createdAt','shop','setupBotHandlers','🏪\x20Available\x20shops\x20in\x20system:\x0a','errorMessage','🔔\x20Notifications\x20are\x20active\x0a\x0a','🔗\x20Endpoint:\x20`','Use\x20/start\x20to\x20connect.','\x20via\x20single-line\x20input','•\x20New\x20payments\x0a','\x0aCheck\x20spelling\x20and\x20try\x20again.','🔔\x20You\x20receive\x20notifications\x20about:\x0a','Payout\x20rejected','❌\x20API\x20key\x20does\x20not\x20match\x20shop\x20`','*\x0a\x0a','endpoint','Failed\x20to\x20send\x20login\x20notification:','✅\x20Login\x20notification\x20sent\x20for\x20shop\x20','❌\x20Please\x20use\x20/start\x20command\x20first','currency','/status\x20-\x20check\x20connection\x20status\x0a','botToken','status','\x0a💡\x20Check\x20your\x20request\x20or\x20contact\x20support.','en-US','\x20parts:\x20','amount','telegramBotService','📅\x20Time:\x20','pk_','🆔\x20Payout\x20ID:\x20`','ACTIVE','Check\x20the\x20key\x20and\x20try\x20again.\x0a\x0a','trim','__esModule','📊\x20*Connection\x20Status*\x0a\x0a','env','Payment\x20expired','test','length','❌\x20Shop\x20with\x20username\x20`','initializeBot','`\x0a\x0a','❌\x20You\x20are\x20not\x20connected\x20to\x20a\x20shop.\x0a\x0a','sendMessage','❌\x20Invalid\x20username\x20format:\x20`','publicKey','9587851lLvqfD','Check\x20spelling\x20and\x20try\x20again.','sendPaymentNotification','from','\x22,\x20apiKey=\x22','📅\x20Connection\x20date:\x20','❌\x20Error:\x20`','👤\x20Username:\x20`','\x0a👤\x20*Customer\x20Information:*\x0a','customerEmail','❌\x20Another\x20Telegram\x20account\x20is\x20already\x20connected\x20to\x20shop\x20`','Payment\x20chargeback','findUnique','🔍\x20*Debug\x20Information*\x0a\x0a','📱\x20Your\x20Telegram\x20ID:\x20`','telegramId','statusCode','Expected\x20key\x20format:\x20`pk_...`\x20or\x20`sk_...`','\x20\x20\x20Username:\x20`','Payment\x20successfully\x20paid','🏦\x20Method:\x20`','chargebackAmount','You\x20sent\x20','txid','Contact\x20administrator.','📱\x20API\x20error\x20notifications\x20disabled\x20for\x20shop\x20','🔌\x20User\x20','\x20USD*\x0a','last_name','*.\x0a\x0a','🔔\x20*','•\x20Payment\x20status\x20changes\x0a','defineProperty','Error\x20handling\x20/start\x20command:','🔄\x20Reset\x20incomplete\x20verification\x20for\x20user\x20','message','entries','processing','🌐\x20IP\x20address:\x20`','create','customerUa','orderId','join','📱\x20Login\x20notifications\x20disabled\x20for\x20shop\x20','secretKey','adminNotes','715qvRYpC','New\x20payment\x20created','🤖\x20Welcome\x20to\x20TRAPAY\x20notification\x20system!\x0a\x0a','error','🆔\x20Request\x20ID:\x20`','\x20disconnected\x20from\x20shop\x20','...\x22','\x20\x20\x20Status:\x20','Use\x20/start\x20to\x20begin.','🌐\x20IP:\x20`','node-telegram-bot-api','onText','sendLoginNotification','TelegramBotService','__importDefault','timestamp','💻\x20Browser:\x20`','notificationLogin','sendApiErrorNotification','🔔\x20You\x20will\x20now\x20receive\x20notifications\x20about:\x0a','Username\x20must\x20contain\x20only\x20letters,\x20numbers\x20and\x20underscore\x20(3-50\x20characters).','3nmYKhM','`\x20(','default','Username:\x20`','telegramUser','✅\x20You\x20have\x20been\x20successfully\x20connected\x20to\x20the\x20notification\x20system!\x0a\x0a','log','✅\x20Notification\x20sent\x20to\x20Telegram\x20user\x20','`\x20is\x20inactive.\x0a\x0a','📝\x20Format:\x20`username\x20api_key`\x0a\x0a','.\x20*','Payment\x20refund','🛑\x20Telegram\x20bot\x20stopped','polling_error','sendShopNotification','toString','requestId','User\x20','ipAddress','To\x20reconnect,\x20use\x20the\x20/start\x20command','remitterIban','Payout\x20completed','first_name','📱\x20Created\x20new\x20Telegram\x20user:\x20','❌\x20Shop\x20`','shopSettings','•\x20`','trapay_bot','bot','findMany','success','customerIp','...','💸\x20Penalty\x20amount:\x20*','stopBot','💸\x20Amount:\x20*','shopId','❌\x20Invalid\x20API\x20key\x20format.\x0a\x0a','•\x20Payouts\x0a','No\x20verified\x20Telegram\x20users\x20found\x20for\x20shop\x20','🔄\x20Processing\x20single-line\x20verification\x20for\x20user\x20','update','isVerified','📛\x20Name:\x20`','❌\x20An\x20error\x20occurred\x20while\x20verifying\x20data.','handleSingleLineVerification','Commands:\x0a','Use\x20/status\x20to\x20check\x20status\x20or\x20/disconnect\x20to\x20disconnect.','🏦\x20IBAN:\x20`','map','\x0a⚠️\x20If\x20this\x20wasn\x27t\x20you,\x20change\x20your\x20password\x20immediately!','New\x20payout\x20created','993584ZoHDyA','•\x20Important\x20events\x0a\x0a','Error\x20handling\x20message:','🆔\x20Payment\x20ID:\x20`','/disconnect\x20-\x20disconnect\x20from\x20notifications','658824uCpQay','📅\x20Date:\x20','chat\x20not\x20found','4628815WHLpEI','💰\x20Amount:\x20*','method','`.\x0a\x0a','forEach','❌\x20Error\x20getting\x20debug\x20information.','getGatewayDisplayNameForTelegram','notificationApiError','toLocaleString','TELEGRAM_BOT_TOKEN','chat','API\x20key\x20must\x20start\x20with\x20`pk\x5c_`\x20or\x20`sk\x5c_`.','Example:\x0a','📱\x20Shop:\x20*','❌\x20Failed\x20to\x20initialize\x20Telegram\x20bot:',':\x20`'];a57_0x5258=function(){return _0x5c22f1;};return a57_0x5258();}function a57_0x5586(_0x36f6b6,_0x2bf30e){const _0x52586d=a57_0x5258();return a57_0x5586=function(_0x558652,_0x57797b){_0x558652=_0x558652-0x14d;let _0x6c5a61=_0x52586d[_0x558652];return _0x6c5a61;},a57_0x5586(_0x36f6b6,_0x2bf30e);}Object[a57_0x51545e(0x1d0)](exports,a57_0x51545e(0x1a3),{'value':!![]}),exports[a57_0x51545e(0x19c)]=exports[a57_0x51545e(0x1eb)]=void 0x0;const node_telegram_bot_api_1=__importDefault(require(a57_0x51545e(0x1e8))),database_1=__importDefault(require(a57_0x51545e(0x178))),gateway_1=require('../types/gateway');class TelegramBotService{constructor(){const _0x30faa0=a57_0x51545e;this[_0x30faa0(0x20f)]=null,this[_0x30faa0(0x196)]=process['env'][_0x30faa0(0x153)]||'',this[_0x30faa0(0x167)]=process[_0x30faa0(0x1a5)]['TELEGRAM_BOT_USERNAME']||_0x30faa0(0x20e),this[_0x30faa0(0x196)]?this[_0x30faa0(0x1aa)]():console[_0x30faa0(0x15f)]('TELEGRAM_BOT_TOKEN\x20not\x20found\x20in\x20environment\x20variables');}['initializeBot'](){const _0x271a87=a57_0x51545e;try{this[_0x271a87(0x20f)]=new node_telegram_bot_api_1[(_0x271a87(0x1f5))](this[_0x271a87(0x196)],{'polling':!![]}),this[_0x271a87(0x183)](),console[_0x271a87(0x1f9)](_0x271a87(0x171)+this[_0x271a87(0x167)]+'\x20initialized\x20successfully');}catch(_0x1a641c){console[_0x271a87(0x1e1)](_0x271a87(0x158),_0x1a641c);}}['setupBotHandlers'](){const _0x4cb959=a57_0x51545e;if(!this['bot'])return;this[_0x4cb959(0x20f)][_0x4cb959(0x1e9)](/\/start/,async _0x5042bf=>{const _0xce59c3=_0x4cb959,_0x1e7248=_0x5042bf['chat']['id'],_0xadcc7c=_0x5042bf[_0xce59c3(0x1b3)]?.['id'][_0xce59c3(0x202)](),_0x3c68f9=_0x5042bf[_0xce59c3(0x1b3)]?.[_0xce59c3(0x15d)],_0x481006=_0x5042bf[_0xce59c3(0x1b3)]?.[_0xce59c3(0x209)],_0x303110=_0x5042bf[_0xce59c3(0x1b3)]?.[_0xce59c3(0x1cc)];if(!_0xadcc7c)return;try{let _0x44646c=await database_1[_0xce59c3(0x1f5)][_0xce59c3(0x1f7)][_0xce59c3(0x1bc)]({'where':{'telegramId':_0xadcc7c},'include':{'shop':!![]}});!_0x44646c?(_0x44646c=await database_1[_0xce59c3(0x1f5)]['telegramUser'][_0xce59c3(0x1d7)]({'data':{'telegramId':_0xadcc7c,'username':_0x3c68f9,'firstName':_0x481006,'lastName':_0x303110,'isVerified':![],'shopId':null},'include':{'shop':!![]}}),console[_0xce59c3(0x1f9)](_0xce59c3(0x20a)+_0xadcc7c+_0xce59c3(0x17c)+_0x3c68f9+')')):_0x44646c=await database_1[_0xce59c3(0x1f5)][_0xce59c3(0x1f7)][_0xce59c3(0x21c)]({'where':{'telegramId':_0xadcc7c},'data':{'username':_0x3c68f9,'firstName':_0x481006,'lastName':_0x303110},'include':{'shop':!![]}}),_0x44646c[_0xce59c3(0x21d)]&&_0x44646c[_0xce59c3(0x217)]&&_0x44646c[_0xce59c3(0x182)]?await this['bot']?.[_0xce59c3(0x1ad)](_0x1e7248,_0xce59c3(0x15c)+('You\x20are\x20already\x20connected\x20to\x20shop:\x20*'+_0x44646c['shop'][_0xce59c3(0x16c)]+'*\x0a')+(_0xce59c3(0x1f6)+_0x44646c['shop'][_0xce59c3(0x15d)]+'`\x0a\x0a')+_0xce59c3(0x18c)+_0xce59c3(0x18a)+_0xce59c3(0x1cf)+'•\x20Payouts\x0a\x0a'+_0xce59c3(0x221)+_0xce59c3(0x195)+_0xce59c3(0x22b),{'parse_mode':'Markdown'}):(_0x44646c[_0xce59c3(0x217)]&&!_0x44646c[_0xce59c3(0x21d)]&&(await database_1[_0xce59c3(0x1f5)][_0xce59c3(0x1f7)][_0xce59c3(0x21c)]({'where':{'telegramId':_0xadcc7c},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0xce59c3(0x1d2)+_0xadcc7c)),await this['bot']?.[_0xce59c3(0x1ad)](_0x1e7248,_0xce59c3(0x1e0)+'To\x20receive\x20payment\x20notifications,\x20send\x20your\x20credentials\x20in\x20one\x20line:\x0a\x0a'+_0xce59c3(0x1fc)+_0xce59c3(0x156)+_0xce59c3(0x165)+'❗️\x20Make\x20sure\x20to\x20separate\x20username\x20and\x20API\x20key\x20with\x20a\x20space!',{'parse_mode':_0xce59c3(0x175)}));}catch(_0x106cea){console[_0xce59c3(0x1e1)](_0xce59c3(0x1d1),_0x106cea),await this[_0xce59c3(0x20f)]?.[_0xce59c3(0x1ad)](_0x1e7248,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this['bot'][_0x4cb959(0x1e9)](/\/disconnect/,async _0x85b11b=>{const _0x30dbc8=_0x4cb959,_0x45ef9f=_0x85b11b[_0x30dbc8(0x154)]['id'],_0x4d59ef=_0x85b11b['from']?.['id']['toString']();if(!_0x4d59ef)return;try{const _0x1bfefb=await database_1[_0x30dbc8(0x1f5)][_0x30dbc8(0x1f7)][_0x30dbc8(0x1bc)]({'where':{'telegramId':_0x4d59ef},'include':{'shop':!![]}});if(!_0x1bfefb||!_0x1bfefb[_0x30dbc8(0x21d)]||!_0x1bfefb['shopId']){await this[_0x30dbc8(0x20f)]?.[_0x30dbc8(0x1ad)](_0x45ef9f,'❌\x20You\x20are\x20not\x20connected\x20to\x20the\x20notification\x20system.');return;}const _0x197a58=_0x1bfefb[_0x30dbc8(0x182)]?.[_0x30dbc8(0x16c)]||'unknown\x20shop';await database_1['default']['telegramUser'][_0x30dbc8(0x21c)]({'where':{'telegramId':_0x4d59ef},'data':{'shopId':null,'isVerified':![]}}),console['log'](_0x30dbc8(0x1ca)+_0x4d59ef+_0x30dbc8(0x1e3)+_0x1bfefb[_0x30dbc8(0x217)]),await this[_0x30dbc8(0x20f)]?.[_0x30dbc8(0x1ad)](_0x45ef9f,'✅\x20You\x20have\x20been\x20successfully\x20disconnected\x20from\x20shop\x20*'+_0x197a58+_0x30dbc8(0x1cd)+_0x30dbc8(0x206),{'parse_mode':'Markdown'});}catch(_0x1a8293){console[_0x30dbc8(0x1e1)]('Error\x20handling\x20/disconnect\x20command:',_0x1a8293),await this['bot']?.['sendMessage'](_0x45ef9f,_0x30dbc8(0x16e));}}),this['bot'][_0x4cb959(0x1e9)](/\/status/,async _0x11cae6=>{const _0x2d58c9=_0x4cb959,_0xe094d3=_0x11cae6['chat']['id'],_0xc349b6=_0x11cae6[_0x2d58c9(0x1b3)]?.['id']['toString']();if(!_0xc349b6)return;try{const _0x28985b=await database_1[_0x2d58c9(0x1f5)][_0x2d58c9(0x1f7)]['findUnique']({'where':{'telegramId':_0xc349b6},'include':{'shop':!![]}});if(!_0x28985b){await this[_0x2d58c9(0x20f)]?.[_0x2d58c9(0x1ad)](_0xe094d3,'❌\x20You\x20are\x20not\x20registered\x20in\x20the\x20system.\x0a\x0a'+_0x2d58c9(0x1e6));return;}if(!_0x28985b[_0x2d58c9(0x21d)]||!_0x28985b[_0x2d58c9(0x217)]||!_0x28985b[_0x2d58c9(0x182)]){await this[_0x2d58c9(0x20f)]?.[_0x2d58c9(0x1ad)](_0xe094d3,_0x2d58c9(0x1ac)+_0x2d58c9(0x188));return;}await this['bot']?.['sendMessage'](_0xe094d3,_0x2d58c9(0x1a4)+(_0x2d58c9(0x174)+_0x28985b[_0x2d58c9(0x182)][_0x2d58c9(0x16c)]+'*\x0a')+(_0x2d58c9(0x1b7)+_0x28985b[_0x2d58c9(0x182)][_0x2d58c9(0x15d)]+'`\x0a')+(_0x2d58c9(0x1b5)+_0x28985b[_0x2d58c9(0x15b)]['toLocaleDateString']('en-US')+'\x0a\x0a')+_0x2d58c9(0x186)+'Commands:\x0a'+_0x2d58c9(0x22b),{'parse_mode':'Markdown'});}catch(_0xb7b8fb){console['error']('Error\x20handling\x20/status\x20command:',_0xb7b8fb),await this[_0x2d58c9(0x20f)]?.[_0x2d58c9(0x1ad)](_0xe094d3,'❌\x20An\x20error\x20occurred.\x20Please\x20try\x20again\x20later.');}}),this[_0x4cb959(0x20f)][_0x4cb959(0x1e9)](/\/debug/,async _0x14c664=>{const _0x21bd1c=_0x4cb959,_0x1d01dd=_0x14c664['chat']['id'],_0x10c335=_0x14c664[_0x21bd1c(0x1b3)]?.['id'][_0x21bd1c(0x202)]();if(!_0x10c335)return;try{const _0x4b3b30=await database_1[_0x21bd1c(0x1f5)][_0x21bd1c(0x182)][_0x21bd1c(0x210)]({'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![]},'take':0xa});let _0x4f0428=_0x21bd1c(0x1bd);_0x4f0428+=_0x21bd1c(0x1be)+_0x10c335+_0x21bd1c(0x1ab),_0x4f0428+=_0x21bd1c(0x184),_0x4b3b30[_0x21bd1c(0x14e)]((_0x542d53,_0x432621)=>{const _0x36582f=_0x21bd1c;_0x4f0428+=_0x432621+0x1+_0x36582f(0x1fd)+_0x542d53[_0x36582f(0x16c)]+'*\x0a',_0x4f0428+=_0x36582f(0x1c2)+_0x542d53['username']+'`\x0a',_0x4f0428+=_0x36582f(0x1e5)+_0x542d53[_0x36582f(0x197)]+'\x0a',_0x4f0428+='\x20\x20\x20Public\x20Key:\x20`'+_0x542d53[_0x36582f(0x1af)][_0x36582f(0x160)](0x0,0xf)+'...`\x0a\x0a';}),await this[_0x21bd1c(0x20f)]?.[_0x21bd1c(0x1ad)](_0x1d01dd,_0x4f0428,{'parse_mode':_0x21bd1c(0x175)});}catch(_0x2f436d){console[_0x21bd1c(0x1e1)]('Error\x20handling\x20/debug\x20command:',_0x2f436d),await this[_0x21bd1c(0x20f)]?.[_0x21bd1c(0x1ad)](_0x1d01dd,_0x21bd1c(0x14f));}}),this[_0x4cb959(0x20f)]['on'](_0x4cb959(0x1d3),async _0x1083cf=>{const _0xcc8f03=_0x4cb959;if(_0x1083cf[_0xcc8f03(0x16f)]?.[_0xcc8f03(0x169)]('/'))return;const _0x3d9369=_0x1083cf[_0xcc8f03(0x154)]['id'],_0x2186e7=_0x1083cf[_0xcc8f03(0x1b3)]?.['id'][_0xcc8f03(0x202)](),_0x198e45=_0x1083cf[_0xcc8f03(0x16f)]?.[_0xcc8f03(0x1a2)]();if(!_0x2186e7||!_0x198e45)return;try{const _0x3c219e=await database_1['default'][_0xcc8f03(0x1f7)][_0xcc8f03(0x1bc)]({'where':{'telegramId':_0x2186e7},'include':{'shop':!![]}});if(!_0x3c219e){await this[_0xcc8f03(0x20f)]?.[_0xcc8f03(0x1ad)](_0x3d9369,_0xcc8f03(0x193));return;}if(_0x3c219e[_0xcc8f03(0x21d)]&&_0x3c219e[_0xcc8f03(0x217)]&&_0x3c219e[_0xcc8f03(0x182)]){await this['bot']?.[_0xcc8f03(0x1ad)](_0x3d9369,'✅\x20You\x20are\x20already\x20connected\x20to\x20shop\x20*'+_0x3c219e[_0xcc8f03(0x182)]['name']+'*.\x0a\x0a'+_0xcc8f03(0x222),{'parse_mode':_0xcc8f03(0x175)});return;}const _0x464460=_0x198e45['split'](/\s+/);if(_0x464460['length']!==0x2){await this[_0xcc8f03(0x20f)]?.[_0xcc8f03(0x1ad)](_0x3d9369,'❌\x20Invalid\x20format.\x20Please\x20send\x20exactly\x202\x20parts\x20separated\x20by\x20space:\x0a\x0a'+_0xcc8f03(0x1fc)+_0xcc8f03(0x156)+'`appple\x20pk_aa6450d3f57afbefbb0f3f5be5ce6cca13037536afc5ccf14c81a6cbc7a07de5`\x0a\x0a'+(_0xcc8f03(0x1c6)+_0x464460[_0xcc8f03(0x1a8)]+_0xcc8f03(0x19a)+_0x464460[_0xcc8f03(0x224)](_0x48dad7=>'`'+_0x48dad7+'`')[_0xcc8f03(0x1da)](',\x20')),{'parse_mode':'Markdown'});return;}const [_0x1ad6b5,_0x1c8c86]=_0x464460;console[_0xcc8f03(0x1f9)](_0xcc8f03(0x21b)+_0x2186e7+_0xcc8f03(0x17d)+_0x1ad6b5+'\x22,\x20apiKey=\x22'+_0x1c8c86['substring'](0x0,0xa)+_0xcc8f03(0x1e4)),await this[_0xcc8f03(0x220)](_0x3d9369,_0x2186e7,_0x1ad6b5,_0x1c8c86);}catch(_0x569027){console['error'](_0xcc8f03(0x229),_0x569027),await this[_0xcc8f03(0x20f)]?.[_0xcc8f03(0x1ad)](_0x3d9369,_0xcc8f03(0x16e));}}),this[_0x4cb959(0x20f)]['on'](_0x4cb959(0x1e1),_0x1df7fc=>{const _0x9cab34=_0x4cb959;console[_0x9cab34(0x1e1)](_0x9cab34(0x17e),_0x1df7fc);}),this[_0x4cb959(0x20f)]['on'](_0x4cb959(0x200),_0x451479=>{const _0x56679e=_0x4cb959;console[_0x56679e(0x1e1)]('Telegram\x20bot\x20polling\x20error:',_0x451479);});}async[a57_0x51545e(0x220)](_0x13de8c,_0x2c0005,_0x373e8f,_0x492031){const _0x21544d=a57_0x51545e;try{console[_0x21544d(0x1f9)](_0x21544d(0x21b)+_0x2c0005+_0x21544d(0x17d)+_0x373e8f+_0x21544d(0x1b4)+_0x492031[_0x21544d(0x160)](0x0,0xa)+_0x21544d(0x1e4));if(!_0x373e8f||_0x373e8f[_0x21544d(0x1a8)]<0x3||_0x373e8f[_0x21544d(0x1a8)]>0x32||!/^[a-zA-Z0-9_]+$/[_0x21544d(0x1a7)](_0x373e8f)){await this[_0x21544d(0x20f)]?.[_0x21544d(0x1ad)](_0x13de8c,_0x21544d(0x1ae)+_0x373e8f+_0x21544d(0x1ab)+_0x21544d(0x1f2),{'parse_mode':_0x21544d(0x175)});return;}if(!_0x492031||!_0x492031['startsWith'](_0x21544d(0x19e))&&!_0x492031[_0x21544d(0x169)]('sk_')){await this['bot']?.[_0x21544d(0x1ad)](_0x13de8c,_0x21544d(0x218)+_0x21544d(0x155),{'parse_mode':_0x21544d(0x175)});return;}const _0x5dc30=await database_1[_0x21544d(0x1f5)][_0x21544d(0x182)][_0x21544d(0x1bc)]({'where':{'username':_0x373e8f},'select':{'id':!![],'name':!![],'username':!![],'status':!![],'publicKey':!![],'secretKey':!![]}});if(!_0x5dc30){const _0x1ac809=await database_1[_0x21544d(0x1f5)][_0x21544d(0x182)]['findMany']({'select':{'username':!![],'name':!![]},'take':0x5});let _0x2908cc=_0x21544d(0x1a9)+_0x373e8f+'`\x20not\x20found.\x0a\x0a';_0x1ac809[_0x21544d(0x1a8)]>0x0?(_0x2908cc+=_0x21544d(0x15e),_0x1ac809[_0x21544d(0x14e)](_0x2b9e95=>{const _0x444433=_0x21544d;_0x2908cc+=_0x444433(0x20d)+_0x2b9e95[_0x444433(0x15d)]+_0x444433(0x1f4)+_0x2b9e95['name']+')\x0a';}),_0x2908cc+=_0x21544d(0x18b)):_0x2908cc+=_0x21544d(0x1b1);await this['bot']?.[_0x21544d(0x1ad)](_0x13de8c,_0x2908cc,{'parse_mode':_0x21544d(0x175)});return;}if(_0x5dc30[_0x21544d(0x197)]!==_0x21544d(0x1a0)){await this[_0x21544d(0x20f)]?.[_0x21544d(0x1ad)](_0x13de8c,_0x21544d(0x20b)+_0x373e8f+_0x21544d(0x1fb)+_0x21544d(0x1c8),{'parse_mode':'Markdown'});return;}if(_0x5dc30[_0x21544d(0x1af)]!==_0x492031&&_0x5dc30[_0x21544d(0x1dc)]!==_0x492031){await this['bot']?.['sendMessage'](_0x13de8c,_0x21544d(0x18e)+_0x373e8f+_0x21544d(0x14d)+_0x21544d(0x1a1)+_0x21544d(0x1c1),{'parse_mode':_0x21544d(0x175)});return;}const _0x3d97d2=await database_1['default'][_0x21544d(0x1f7)]['findFirst']({'where':{'shopId':_0x5dc30['id'],'isVerified':!![],'telegramId':{'not':_0x2c0005}}});if(_0x3d97d2){await this[_0x21544d(0x20f)]?.['sendMessage'](_0x13de8c,_0x21544d(0x1ba)+_0x373e8f+'`.\x0a\x0a'+_0x21544d(0x17f),{'parse_mode':'Markdown'});return;}await database_1['default']['telegramUser'][_0x21544d(0x21c)]({'where':{'telegramId':_0x2c0005},'data':{'shopId':_0x5dc30['id'],'isVerified':!![]}}),await this['bot']?.[_0x21544d(0x1ad)](_0x13de8c,'🎉\x20*Congratulations!*\x0a\x0a'+_0x21544d(0x1f8)+(_0x21544d(0x157)+_0x5dc30['name']+'*\x0a')+(_0x21544d(0x1b7)+_0x5dc30[_0x21544d(0x15d)]+_0x21544d(0x1ab))+_0x21544d(0x1f1)+'•\x20New\x20payments\x0a'+_0x21544d(0x1cf)+_0x21544d(0x219)+_0x21544d(0x228)+'Commands:\x0a'+_0x21544d(0x195)+_0x21544d(0x22b),{'parse_mode':_0x21544d(0x175)}),console[_0x21544d(0x1f9)](_0x21544d(0x164)+_0x2c0005+'\x20verified\x20for\x20shop\x20'+_0x5dc30[_0x21544d(0x15d)]+_0x21544d(0x189));}catch(_0x378910){console[_0x21544d(0x1e1)](_0x21544d(0x176),_0x378910),await this[_0x21544d(0x20f)]?.[_0x21544d(0x1ad)](_0x13de8c,_0x21544d(0x21f));}}async[a57_0x51545e(0x201)](_0x52778b,_0x3bdb9d,_0x34357d){const _0x1bfa40=a57_0x51545e;if(!this[_0x1bfa40(0x20f)]){console['warn']('Telegram\x20bot\x20not\x20initialized,\x20cannot\x20send\x20notification');return;}try{const _0x5089ef=await database_1['default'][_0x1bfa40(0x1f7)][_0x1bfa40(0x210)]({'where':{'shopId':_0x52778b,'isVerified':!![]}});if(_0x5089ef[_0x1bfa40(0x1a8)]===0x0){console['log'](_0x1bfa40(0x21a)+_0x52778b);return;}const _0x341ddb=_0x5089ef[_0x1bfa40(0x224)](async _0x299358=>{const _0x50dffd=_0x1bfa40;try{await this['bot']?.[_0x50dffd(0x1ad)](_0x299358[_0x50dffd(0x1bf)],_0x3bdb9d,_0x34357d),console['log'](_0x50dffd(0x1fa)+_0x299358[_0x50dffd(0x1bf)]);}catch(_0x202c97){console[_0x50dffd(0x1e1)]('❌\x20Failed\x20to\x20send\x20notification\x20to\x20Telegram\x20user\x20'+_0x299358['telegramId']+':',_0x202c97),_0x202c97 instanceof Error&&(_0x202c97[_0x50dffd(0x1d3)][_0x50dffd(0x163)](_0x50dffd(0x16d))||_0x202c97[_0x50dffd(0x1d3)]['includes'](_0x50dffd(0x22e))||_0x202c97[_0x50dffd(0x1d3)][_0x50dffd(0x163)]('user\x20is\x20deactivated'))&&(await database_1[_0x50dffd(0x1f5)]['telegramUser'][_0x50dffd(0x21c)]({'where':{'id':_0x299358['id']},'data':{'isVerified':![]}}),console[_0x50dffd(0x1f9)](_0x50dffd(0x204)+_0x299358[_0x50dffd(0x1bf)]+'\x20marked\x20as\x20unverified\x20due\x20to\x20delivery\x20failure'));}});await Promise['allSettled'](_0x341ddb);}catch(_0x44f186){console[_0x1bfa40(0x1e1)]('Error\x20sending\x20shop\x20notification:',_0x44f186);}}async[a57_0x51545e(0x1b2)](_0x37d37e,_0x4a95c4,_0x359e5c){const _0x4b0790=a57_0x51545e,_0x240920={'created':'🆕','paid':'✅','failed':'❌','expired':'⏰','refund':'🔄','chargeback':'⚠️','processing':'⚙️'},_0x42d94={'created':_0x4b0790(0x1df),'paid':_0x4b0790(0x1c3),'failed':'Payment\x20failed','expired':_0x4b0790(0x1a6),'refund':_0x4b0790(0x1fe),'chargeback':_0x4b0790(0x1bb),'processing':_0x4b0790(0x179)},_0x30d75c=_0x240920[_0x359e5c],_0x59e17f=_0x42d94[_0x359e5c],_0x30bef5=(0x0,gateway_1[_0x4b0790(0x150)])(_0x4a95c4['gateway']);console[_0x4b0790(0x1f9)](_0x4b0790(0x166)+_0x4a95c4['gateway']+_0x4b0790(0x17a)+_0x30bef5+'\x22');let _0x58c3a4=_0x30d75c+'\x20*'+_0x59e17f+'*\x0a\x0a'+(_0x4b0790(0x230)+_0x4a95c4[_0x4b0790(0x19b)]+'\x20'+_0x4a95c4[_0x4b0790(0x194)]+'*\x0a')+(_0x4b0790(0x17b)+(_0x4a95c4[_0x4b0790(0x1d9)]||_0x4a95c4['id'])+'`\x0a')+(_0x4b0790(0x22a)+_0x4a95c4['id']+'`\x0a')+('🏪\x20Gateway:\x20`'+_0x30bef5+'`\x0a')+(_0x4b0790(0x22d)+new Date(_0x4a95c4[_0x4b0790(0x181)])[_0x4b0790(0x152)](_0x4b0790(0x199))+'\x0a');if(_0x4a95c4['customerName']||_0x4a95c4[_0x4b0790(0x1b9)]||_0x4a95c4[_0x4b0790(0x207)]||_0x4a95c4[_0x4b0790(0x212)]||_0x4a95c4[_0x4b0790(0x1d8)]){_0x58c3a4+=_0x4b0790(0x1b8);_0x4a95c4['customerName']&&(_0x58c3a4+=_0x4b0790(0x21e)+_0x4a95c4['customerName']+'`\x0a');_0x4a95c4[_0x4b0790(0x1b9)]&&(_0x58c3a4+='📧\x20Email:\x20`'+_0x4a95c4[_0x4b0790(0x1b9)]+'`\x0a');_0x4a95c4['remitterIban']&&(_0x58c3a4+=_0x4b0790(0x223)+_0x4a95c4[_0x4b0790(0x207)]+'`\x0a');_0x4a95c4[_0x4b0790(0x212)]&&(_0x58c3a4+=_0x4b0790(0x1e7)+_0x4a95c4[_0x4b0790(0x212)]+'`\x0a');if(_0x4a95c4[_0x4b0790(0x1d8)]){const _0x220691=_0x4a95c4['customerUa'][_0x4b0790(0x1a8)]>0x32?_0x4a95c4[_0x4b0790(0x1d8)]['substring'](0x0,0x32)+_0x4b0790(0x213):_0x4a95c4[_0x4b0790(0x1d8)];_0x58c3a4+=_0x4b0790(0x1ee)+_0x220691+'`\x0a';}}_0x359e5c==='chargeback'&&_0x4a95c4[_0x4b0790(0x1c5)]&&(_0x58c3a4+=_0x4b0790(0x214)+_0x4a95c4['chargebackAmount']+'\x20USDT*\x0a'),_0x359e5c===_0x4b0790(0x1d5)&&(_0x58c3a4+='⏳\x20The\x20payment\x20is\x20currently\x20being\x20processed\x20by\x20the\x20gateway.\x0a'),_0x4a95c4[_0x4b0790(0x1dd)]&&(_0x58c3a4+='📝\x20Notes:\x20'+_0x4a95c4[_0x4b0790(0x1dd)]+'\x0a'),await this[_0x4b0790(0x201)](_0x37d37e,_0x58c3a4,{'parse_mode':'Markdown'});}async['sendPayoutNotification'](_0x4f2e32,_0x122550,_0x1332fc){const _0x565e1e=a57_0x51545e,_0x40c130={'created':'📤','completed':'✅','rejected':'❌'},_0x3cfc2a={'created':_0x565e1e(0x226),'completed':_0x565e1e(0x208),'rejected':_0x565e1e(0x18d)},_0x112c19=_0x40c130[_0x1332fc],_0x11fcec=_0x3cfc2a[_0x1332fc],_0x1d556e=_0x112c19+'\x20*'+_0x11fcec+_0x565e1e(0x18f)+(_0x565e1e(0x216)+_0x122550[_0x565e1e(0x19b)]+_0x565e1e(0x1cb))+(_0x565e1e(0x1c4)+_0x122550[_0x565e1e(0x231)]+'`\x0a')+(_0x565e1e(0x19f)+_0x122550['id']+'`\x0a')+(_0x565e1e(0x22d)+new Date(_0x122550[_0x565e1e(0x181)])[_0x565e1e(0x152)](_0x565e1e(0x199))+'\x0a')+(_0x122550[_0x565e1e(0x1c7)]?_0x565e1e(0x16b)+_0x122550[_0x565e1e(0x1c7)]+'`':'');await this[_0x565e1e(0x201)](_0x4f2e32,_0x1d556e,{'parse_mode':_0x565e1e(0x175)});}async[a57_0x51545e(0x1ea)](_0x5d91de,_0x4ab0db){const _0x4619d1=a57_0x51545e;try{const _0x5bcc47=await database_1[_0x4619d1(0x1f5)][_0x4619d1(0x20c)][_0x4619d1(0x1bc)]({'where':{'shopId':_0x5d91de},'select':{'notificationLogin':!![]}});if(!_0x5bcc47?.[_0x4619d1(0x1ef)]){console[_0x4619d1(0x1f9)](_0x4619d1(0x1db)+_0x5d91de);return;}const _0x5e5fbd=_0x4ab0db['success']?'🔐':'🚨',_0x36904c=_0x4ab0db[_0x4619d1(0x211)]?'Successful\x20login':'Failed\x20login\x20attempt';let _0x13a95b=_0x5e5fbd+'\x20*'+_0x36904c+_0x4619d1(0x18f)+('👤\x20Username:\x20`'+_0x4ab0db[_0x4619d1(0x15d)]+'`\x0a')+(_0x4619d1(0x19d)+_0x4ab0db[_0x4619d1(0x1ed)][_0x4619d1(0x152)](_0x4619d1(0x199))+'\x0a');_0x4ab0db[_0x4619d1(0x205)]&&(_0x13a95b+=_0x4619d1(0x1d6)+_0x4ab0db[_0x4619d1(0x205)]+'`\x0a');if(_0x4ab0db[_0x4619d1(0x16a)]){const _0x2b3cd2=_0x4ab0db[_0x4619d1(0x16a)][_0x4619d1(0x1a8)]>0x32?_0x4ab0db[_0x4619d1(0x16a)][_0x4619d1(0x160)](0x0,0x32)+_0x4619d1(0x213):_0x4ab0db[_0x4619d1(0x16a)];_0x13a95b+=_0x4619d1(0x1ee)+_0x2b3cd2+'`\x0a';}!_0x4ab0db['success']&&(_0x13a95b+=_0x4619d1(0x225)),await this[_0x4619d1(0x201)](_0x5d91de,_0x13a95b,{'parse_mode':'Markdown'}),console['log'](_0x4619d1(0x192)+_0x5d91de+':\x20'+(_0x4ab0db[_0x4619d1(0x211)]?'success':_0x4619d1(0x15a)));}catch(_0x30a588){console['error'](_0x4619d1(0x191),_0x30a588);}}async[a57_0x51545e(0x1f0)](_0x587acd,_0x8c21a0){const _0x42ea17=a57_0x51545e;try{const _0x3e912e=await database_1[_0x42ea17(0x1f5)][_0x42ea17(0x20c)][_0x42ea17(0x1bc)]({'where':{'shopId':_0x587acd},'select':{'notificationApiError':!![]}});if(!_0x3e912e?.[_0x42ea17(0x151)]){console[_0x42ea17(0x1f9)](_0x42ea17(0x1c9)+_0x587acd);return;}let _0xa2a23c=_0x42ea17(0x173)+(_0x42ea17(0x187)+_0x8c21a0['method']+'\x20'+_0x8c21a0[_0x42ea17(0x190)]+'`\x0a')+(_0x42ea17(0x19d)+_0x8c21a0['timestamp']['toLocaleString'](_0x42ea17(0x199))+'\x0a');_0x8c21a0[_0x42ea17(0x1c0)]&&(_0xa2a23c+='📊\x20Error\x20code:\x20`'+_0x8c21a0[_0x42ea17(0x1c0)]+'`\x0a'),_0xa2a23c+=_0x42ea17(0x1b6)+_0x8c21a0[_0x42ea17(0x185)]+'`\x0a',_0x8c21a0['requestId']&&(_0xa2a23c+=_0x42ea17(0x1e2)+_0x8c21a0[_0x42ea17(0x203)]+'`\x0a'),_0xa2a23c+=_0x42ea17(0x198),await this['sendShopNotification'](_0x587acd,_0xa2a23c,{'parse_mode':_0x42ea17(0x175)}),console['log'](_0x42ea17(0x161)+_0x587acd+':\x20'+_0x8c21a0['endpoint']);}catch(_0x5d374e){console['error']('Failed\x20to\x20send\x20API\x20error\x20notification:',_0x5d374e);}}async['sendCustomNotification'](_0x1f3c1a,_0x164491,_0x421cdb){const _0x475564=a57_0x51545e;let _0x3448ce=_0x475564(0x1ce)+_0x164491+_0x475564(0x18f);for(const [_0x300730,_0x3c66ed]of Object[_0x475564(0x1d4)](_0x421cdb)){_0x3c66ed!==null&&_0x3c66ed!==undefined&&(_0x3448ce+=_0x300730+_0x475564(0x159)+_0x3c66ed+'`\x0a');}await this[_0x475564(0x201)](_0x1f3c1a,_0x3448ce,{'parse_mode':'Markdown'});}[a57_0x51545e(0x180)](){const _0x2aa565=a57_0x51545e;return{'isActive':!!this[_0x2aa565(0x20f)],'username':this[_0x2aa565(0x167)]};}[a57_0x51545e(0x215)](){const _0x1533c4=a57_0x51545e;this[_0x1533c4(0x20f)]&&(this[_0x1533c4(0x20f)]['stopPolling'](),this[_0x1533c4(0x20f)]=null,console[_0x1533c4(0x1f9)](_0x1533c4(0x1ff)));}}exports[a57_0x51545e(0x1eb)]=TelegramBotService,exports[a57_0x51545e(0x19c)]=new TelegramBotService();