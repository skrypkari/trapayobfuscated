'use strict';const a56_0x3d7780=a56_0x48e4;(function(_0x3c5c09,_0x4ac499){const _0x58954f=a56_0x48e4,_0x16cb38=_0x3c5c09();while(!![]){try{const _0x33e72d=parseInt(_0x58954f(0x183))/0x1+parseInt(_0x58954f(0x17d))/0x2+-parseInt(_0x58954f(0x181))/0x3+parseInt(_0x58954f(0x178))/0x4+parseInt(_0x58954f(0x199))/0x5*(-parseInt(_0x58954f(0x184))/0x6)+parseInt(_0x58954f(0x180))/0x7+-parseInt(_0x58954f(0x189))/0x8*(-parseInt(_0x58954f(0x18c))/0x9);if(_0x33e72d===_0x4ac499)break;else _0x16cb38['push'](_0x16cb38['shift']());}catch(_0x43c0a2){_0x16cb38['push'](_0x16cb38['shift']());}}}(a56_0x479c,0xf123a));function a56_0x48e4(_0x5a2dcd,_0x58ab21){const _0x479c46=a56_0x479c();return a56_0x48e4=function(_0x48e460,_0x10cb7a){_0x48e460=_0x48e460-0x178;let _0x5639cf=_0x479c46[_0x48e460];return _0x5639cf;},a56_0x48e4(_0x5a2dcd,_0x58ab21);}var __importDefault=this&&this[a56_0x3d7780(0x1aa)]||function(_0x246b8e){return _0x246b8e&&_0x246b8e['__esModule']?_0x246b8e:{'default':_0x246b8e};};function a56_0x479c(){const _0x41e1ce=['update','usdcPolygonWallet','__importDefault','sk_','2422020GqqlOA','stringify','wallets','default','__esModule','2179752DhHxAV','usdtErcWallet','name','157535CtUmti','5704953HswyGQ','fullName','126539TbbxFA','12AjwJgj','parse','delete','usdtTrcWallet','createdAt','129640qlpjEM','status','hash','1548JlZJYQ','getUserById','gateways','desc','generateApiKeys','paymentGateways','../config/database','toString','UserService','gatewaySettings','hex','bcryptjs','password','4355820KfdNuG','username','Telegram\x20username\x20already\x20exists','usdtPolygonWallet','updateUser','merchantUrl','shop','telegramId','getAllUsers','shopUrl','publicKey','Username\x20already\x20exists','findUnique','telegram','randomBytes'];a56_0x479c=function(){return _0x41e1ce;};return a56_0x479c();}Object['defineProperty'](exports,a56_0x3d7780(0x17c),{'value':!![]}),exports['UserService']=void 0x0;const bcryptjs_1=__importDefault(require(a56_0x3d7780(0x197))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a56_0x3d7780(0x192)));class UserService{[a56_0x3d7780(0x190)](){const _0x2d93fe=a56_0x3d7780,_0x31cc94='pk_'+crypto_1['default'][_0x2d93fe(0x1a7)](0x20)[_0x2d93fe(0x193)](_0x2d93fe(0x196)),_0x25700d=_0x2d93fe(0x1ab)+crypto_1[_0x2d93fe(0x17b)]['randomBytes'](0x20)[_0x2d93fe(0x193)]('hex');return{'publicKey':_0x31cc94,'secretKey':_0x25700d};}async['createUser'](_0x1d307d){const _0x4f71b9=a56_0x3d7780,{fullName:_0x1643d6,username:_0x374c5b,password:_0x1608aa,telegramId:_0x374043,merchantUrl:_0x1dbe03,gateways:_0x3823d9,gatewaySettings:_0x462966,wallets:_0x2f321d}=_0x1d307d,_0x32fc83=await database_1[_0x4f71b9(0x17b)][_0x4f71b9(0x19f)][_0x4f71b9(0x1a5)]({'where':{'username':_0x374c5b}});if(_0x32fc83)throw new Error(_0x4f71b9(0x1a4));if(_0x374043){const _0xb1db81=await database_1['default']['shop'][_0x4f71b9(0x1a5)]({'where':{'telegram':_0x374043}});if(_0xb1db81)throw new Error(_0x4f71b9(0x19b));}const _0x32e675=await bcryptjs_1['default'][_0x4f71b9(0x18b)](_0x1608aa,0xc),{publicKey:_0x154850,secretKey:_0x31105b}=this[_0x4f71b9(0x190)](),_0x36bc76=await database_1['default']['shop']['create']({'data':{'name':_0x1643d6,'username':_0x374c5b,'password':_0x32e675,'telegram':_0x374043,'shopUrl':_0x1dbe03,'paymentGateways':_0x3823d9?JSON[_0x4f71b9(0x179)](_0x3823d9):null,'gatewaySettings':_0x462966?JSON['stringify'](_0x462966):null,'usdtPolygonWallet':_0x2f321d?.[_0x4f71b9(0x19c)]||null,'usdtTrcWallet':_0x2f321d?.[_0x4f71b9(0x187)]||null,'usdtErcWallet':_0x2f321d?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x2f321d?.[_0x4f71b9(0x1a9)]||null,'publicKey':_0x154850,'secretKey':_0x31105b,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x36bc76['id'],'fullName':_0x36bc76[_0x4f71b9(0x17f)],'username':_0x36bc76[_0x4f71b9(0x19a)],'telegramId':_0x36bc76[_0x4f71b9(0x1a6)],'merchantUrl':_0x36bc76[_0x4f71b9(0x1a2)],'gateways':_0x36bc76[_0x4f71b9(0x191)]?JSON[_0x4f71b9(0x185)](_0x36bc76[_0x4f71b9(0x191)]):null,'gatewaySettings':_0x36bc76[_0x4f71b9(0x195)]?JSON[_0x4f71b9(0x185)](_0x36bc76[_0x4f71b9(0x195)]):null,'publicKey':_0x36bc76[_0x4f71b9(0x1a3)],'wallets':{'usdtPolygonWallet':_0x36bc76[_0x4f71b9(0x19c)],'usdtTrcWallet':_0x36bc76['usdtTrcWallet'],'usdtErcWallet':_0x36bc76[_0x4f71b9(0x17e)],'usdcPolygonWallet':_0x36bc76['usdcPolygonWallet']},'status':_0x36bc76[_0x4f71b9(0x18a)],'createdAt':_0x36bc76[_0x4f71b9(0x188)]};}async[a56_0x3d7780(0x1a1)](){const _0x410e58=a56_0x3d7780,_0xd98064=await database_1[_0x410e58(0x17b)][_0x410e58(0x19f)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x410e58(0x18f)}});return _0xd98064['map'](_0x54eed0=>({'id':_0x54eed0['id'],'fullName':_0x54eed0[_0x410e58(0x17f)],'username':_0x54eed0['username'],'telegramId':_0x54eed0[_0x410e58(0x1a6)],'merchantUrl':_0x54eed0['shopUrl'],'gateways':_0x54eed0[_0x410e58(0x191)]?JSON[_0x410e58(0x185)](_0x54eed0['paymentGateways']):null,'gatewaySettings':_0x54eed0['gatewaySettings']?JSON[_0x410e58(0x185)](_0x54eed0[_0x410e58(0x195)]):null,'publicKey':_0x54eed0[_0x410e58(0x1a3)],'wallets':{'usdtPolygonWallet':_0x54eed0['usdtPolygonWallet'],'usdtTrcWallet':_0x54eed0[_0x410e58(0x187)],'usdtErcWallet':_0x54eed0[_0x410e58(0x17e)],'usdcPolygonWallet':_0x54eed0[_0x410e58(0x1a9)]},'status':_0x54eed0[_0x410e58(0x18a)],'createdAt':_0x54eed0[_0x410e58(0x188)]}));}async[a56_0x3d7780(0x18d)](_0x23227f){const _0x21c099=a56_0x3d7780,_0x29a383=await database_1[_0x21c099(0x17b)][_0x21c099(0x19f)][_0x21c099(0x1a5)]({'where':{'id':_0x23227f},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x29a383)return null;return{'id':_0x29a383['id'],'fullName':_0x29a383['name'],'username':_0x29a383[_0x21c099(0x19a)],'telegramId':_0x29a383[_0x21c099(0x1a6)],'merchantUrl':_0x29a383[_0x21c099(0x1a2)],'gateways':_0x29a383[_0x21c099(0x191)]?JSON[_0x21c099(0x185)](_0x29a383[_0x21c099(0x191)]):null,'gatewaySettings':_0x29a383['gatewaySettings']?JSON[_0x21c099(0x185)](_0x29a383[_0x21c099(0x195)]):null,'publicKey':_0x29a383[_0x21c099(0x1a3)],'wallets':{'usdtPolygonWallet':_0x29a383[_0x21c099(0x19c)],'usdtTrcWallet':_0x29a383[_0x21c099(0x187)],'usdtErcWallet':_0x29a383[_0x21c099(0x17e)],'usdcPolygonWallet':_0x29a383['usdcPolygonWallet']},'status':_0x29a383[_0x21c099(0x18a)],'createdAt':_0x29a383['createdAt']};}async[a56_0x3d7780(0x19d)](_0x4b5720,_0x390da0){const _0xfb0da1=a56_0x3d7780,_0x5120ed={..._0x390da0};_0x390da0[_0xfb0da1(0x198)]&&(_0x5120ed[_0xfb0da1(0x198)]=await bcryptjs_1[_0xfb0da1(0x17b)][_0xfb0da1(0x18b)](_0x390da0[_0xfb0da1(0x198)],0xc));_0x390da0[_0xfb0da1(0x182)]&&(_0x5120ed[_0xfb0da1(0x17f)]=_0x390da0[_0xfb0da1(0x182)],delete _0x5120ed[_0xfb0da1(0x182)]);_0x390da0['telegramId']&&(_0x5120ed[_0xfb0da1(0x1a6)]=_0x390da0['telegramId'],delete _0x5120ed[_0xfb0da1(0x1a0)]);_0x390da0[_0xfb0da1(0x19e)]&&(_0x5120ed[_0xfb0da1(0x1a2)]=_0x390da0[_0xfb0da1(0x19e)],delete _0x5120ed[_0xfb0da1(0x19e)]);_0x390da0['gateways']&&(_0x5120ed[_0xfb0da1(0x191)]=JSON[_0xfb0da1(0x179)](_0x390da0[_0xfb0da1(0x18e)]),delete _0x5120ed[_0xfb0da1(0x18e)]);_0x390da0[_0xfb0da1(0x195)]&&(_0x5120ed['gatewaySettings']=JSON[_0xfb0da1(0x179)](_0x390da0[_0xfb0da1(0x195)]),delete _0x5120ed['gatewaySettings']);_0x390da0['wallets']&&(_0x390da0[_0xfb0da1(0x17a)][_0xfb0da1(0x19c)]!==undefined&&(_0x5120ed['usdtPolygonWallet']=_0x390da0[_0xfb0da1(0x17a)]['usdtPolygonWallet']||null),_0x390da0[_0xfb0da1(0x17a)][_0xfb0da1(0x187)]!==undefined&&(_0x5120ed[_0xfb0da1(0x187)]=_0x390da0[_0xfb0da1(0x17a)][_0xfb0da1(0x187)]||null),_0x390da0[_0xfb0da1(0x17a)][_0xfb0da1(0x17e)]!==undefined&&(_0x5120ed['usdtErcWallet']=_0x390da0['wallets']['usdtErcWallet']||null),_0x390da0[_0xfb0da1(0x17a)]['usdcPolygonWallet']!==undefined&&(_0x5120ed[_0xfb0da1(0x1a9)]=_0x390da0[_0xfb0da1(0x17a)]['usdcPolygonWallet']||null),delete _0x5120ed[_0xfb0da1(0x17a)]);const _0x3d24ce=await database_1['default'][_0xfb0da1(0x19f)][_0xfb0da1(0x1a8)]({'where':{'id':_0x4b5720},'data':_0x5120ed,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3d24ce['id'],'fullName':_0x3d24ce[_0xfb0da1(0x17f)],'username':_0x3d24ce[_0xfb0da1(0x19a)],'telegramId':_0x3d24ce[_0xfb0da1(0x1a6)],'merchantUrl':_0x3d24ce[_0xfb0da1(0x1a2)],'gateways':_0x3d24ce['paymentGateways']?JSON[_0xfb0da1(0x185)](_0x3d24ce['paymentGateways']):null,'gatewaySettings':_0x3d24ce['gatewaySettings']?JSON['parse'](_0x3d24ce[_0xfb0da1(0x195)]):null,'publicKey':_0x3d24ce[_0xfb0da1(0x1a3)],'wallets':{'usdtPolygonWallet':_0x3d24ce[_0xfb0da1(0x19c)],'usdtTrcWallet':_0x3d24ce[_0xfb0da1(0x187)],'usdtErcWallet':_0x3d24ce[_0xfb0da1(0x17e)],'usdcPolygonWallet':_0x3d24ce[_0xfb0da1(0x1a9)]},'status':_0x3d24ce[_0xfb0da1(0x18a)],'createdAt':_0x3d24ce[_0xfb0da1(0x188)]};}async['deleteUser'](_0x234953){const _0x6e4d0b=a56_0x3d7780;await database_1[_0x6e4d0b(0x17b)]['shop'][_0x6e4d0b(0x186)]({'where':{'id':_0x234953}});}}exports[a56_0x3d7780(0x194)]=UserService;