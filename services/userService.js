'use strict';const a51_0x31ec47=a51_0x5518;function a51_0x27ec(){const _0x1744c1=['../config/database','updateUser','sk_','status','map','120XJzYGn','getAllUsers','createdAt','82317Yswplq','generateApiKeys','telegram','gateways','usdcPolygonWallet','parse','toString','crypto','create','bcryptjs','4816730wBOhRB','telegramId','3RIwBzf','1905535oUUOQD','2190052HZNpAy','randomBytes','1087614qEcZYW','desc','__importDefault','stringify','wallets','gatewaySettings','shop','9NGqeUe','findUnique','fullName','2WepOUo','hash','update','usdtErcWallet','username','UserService','Username\x20already\x20exists','password','usdtPolygonWallet','ACTIVE','hex','paymentGateways','usdtTrcWallet','80969rqsLrH','default','24OzsQyS','__esModule','1300486PJOEIe','name','findMany','merchantUrl','delete','publicKey','shopUrl'];a51_0x27ec=function(){return _0x1744c1;};return a51_0x27ec();}(function(_0x5135a4,_0x4513cf){const _0x588f1b=a51_0x5518,_0x2e017c=_0x5135a4();while(!![]){try{const _0x11468f=parseInt(_0x588f1b(0x1b9))/0x1*(parseInt(_0x588f1b(0x1d3))/0x2)+parseInt(_0x588f1b(0x1c5))/0x3*(parseInt(_0x588f1b(0x1c7))/0x4)+parseInt(_0x588f1b(0x1c6))/0x5+-parseInt(_0x588f1b(0x1c9))/0x6+parseInt(_0x588f1b(0x1e0))/0x7*(parseInt(_0x588f1b(0x1b6))/0x8)+-parseInt(_0x588f1b(0x1d0))/0x9*(parseInt(_0x588f1b(0x1c3))/0xa)+parseInt(_0x588f1b(0x1aa))/0xb*(-parseInt(_0x588f1b(0x1e2))/0xc);if(_0x11468f===_0x4513cf)break;else _0x2e017c['push'](_0x2e017c['shift']());}catch(_0x52b3aa){_0x2e017c['push'](_0x2e017c['shift']());}}}(a51_0x27ec,0x45978));function a51_0x5518(_0x2b71e3,_0x147ea5){const _0x27ecb3=a51_0x27ec();return a51_0x5518=function(_0x5518ce,_0x479789){_0x5518ce=_0x5518ce-0x1a9;let _0x128b7e=_0x27ecb3[_0x5518ce];return _0x128b7e;},a51_0x5518(_0x2b71e3,_0x147ea5);}var __importDefault=this&&this[a51_0x31ec47(0x1cb)]||function(_0x8f8ed5){const _0x1b06b0=a51_0x31ec47;return _0x8f8ed5&&_0x8f8ed5[_0x1b06b0(0x1a9)]?_0x8f8ed5:{'default':_0x8f8ed5};};Object['defineProperty'](exports,a51_0x31ec47(0x1a9),{'value':!![]}),exports['UserService']=void 0x0;const bcryptjs_1=__importDefault(require(a51_0x31ec47(0x1c2))),crypto_1=__importDefault(require(a51_0x31ec47(0x1c0))),database_1=__importDefault(require(a51_0x31ec47(0x1b1)));class UserService{[a51_0x31ec47(0x1ba)](){const _0x135dfc=a51_0x31ec47,_0x17e69f='pk_'+crypto_1[_0x135dfc(0x1e1)][_0x135dfc(0x1c8)](0x20)[_0x135dfc(0x1bf)](_0x135dfc(0x1dd)),_0x465942=_0x135dfc(0x1b3)+crypto_1[_0x135dfc(0x1e1)][_0x135dfc(0x1c8)](0x20)[_0x135dfc(0x1bf)]('hex');return{'publicKey':_0x17e69f,'secretKey':_0x465942};}async['createUser'](_0x224485){const _0x501a8d=a51_0x31ec47,{fullName:_0x4c5fd8,username:_0x241491,password:_0x2b8f2e,telegramId:_0x34de23,merchantUrl:_0x1d2176,gateways:_0x4e39a9,gatewaySettings:_0x39ab0e,wallets:_0xc4d82}=_0x224485,_0x47d673=await database_1['default'][_0x501a8d(0x1cf)][_0x501a8d(0x1d1)]({'where':{'username':_0x241491}});if(_0x47d673)throw new Error(_0x501a8d(0x1d9));if(_0x34de23){const _0x246a47=await database_1[_0x501a8d(0x1e1)]['shop'][_0x501a8d(0x1d1)]({'where':{'telegram':_0x34de23}});if(_0x246a47)throw new Error('Telegram\x20username\x20already\x20exists');}const _0xd9e17b=await bcryptjs_1[_0x501a8d(0x1e1)][_0x501a8d(0x1d4)](_0x2b8f2e,0xc),{publicKey:_0x40ebe6,secretKey:_0x3e74d4}=this[_0x501a8d(0x1ba)](),_0x2b1ed1=await database_1[_0x501a8d(0x1e1)]['shop'][_0x501a8d(0x1c1)]({'data':{'name':_0x4c5fd8,'username':_0x241491,'password':_0xd9e17b,'telegram':_0x34de23,'shopUrl':_0x1d2176,'paymentGateways':_0x4e39a9?JSON[_0x501a8d(0x1cc)](_0x4e39a9):null,'gatewaySettings':_0x39ab0e?JSON[_0x501a8d(0x1cc)](_0x39ab0e):null,'usdtPolygonWallet':_0xc4d82?.[_0x501a8d(0x1db)]||null,'usdtTrcWallet':_0xc4d82?.[_0x501a8d(0x1df)]||null,'usdtErcWallet':_0xc4d82?.[_0x501a8d(0x1d6)]||null,'usdcPolygonWallet':_0xc4d82?.['usdcPolygonWallet']||null,'publicKey':_0x40ebe6,'secretKey':_0x3e74d4,'status':_0x501a8d(0x1dc)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2b1ed1['id'],'fullName':_0x2b1ed1[_0x501a8d(0x1ab)],'username':_0x2b1ed1[_0x501a8d(0x1d7)],'telegramId':_0x2b1ed1[_0x501a8d(0x1bb)],'merchantUrl':_0x2b1ed1['shopUrl'],'gateways':_0x2b1ed1['paymentGateways']?JSON['parse'](_0x2b1ed1['paymentGateways']):null,'gatewaySettings':_0x2b1ed1[_0x501a8d(0x1ce)]?JSON[_0x501a8d(0x1be)](_0x2b1ed1[_0x501a8d(0x1ce)]):null,'publicKey':_0x2b1ed1[_0x501a8d(0x1af)],'wallets':{'usdtPolygonWallet':_0x2b1ed1['usdtPolygonWallet'],'usdtTrcWallet':_0x2b1ed1[_0x501a8d(0x1df)],'usdtErcWallet':_0x2b1ed1[_0x501a8d(0x1d6)],'usdcPolygonWallet':_0x2b1ed1[_0x501a8d(0x1bd)]},'status':_0x2b1ed1[_0x501a8d(0x1b4)],'createdAt':_0x2b1ed1[_0x501a8d(0x1b8)]};}async[a51_0x31ec47(0x1b7)](){const _0x297b51=a51_0x31ec47,_0x34a7f0=await database_1[_0x297b51(0x1e1)][_0x297b51(0x1cf)][_0x297b51(0x1ac)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x297b51(0x1ca)}});return _0x34a7f0[_0x297b51(0x1b5)](_0x374ba8=>({'id':_0x374ba8['id'],'fullName':_0x374ba8[_0x297b51(0x1ab)],'username':_0x374ba8[_0x297b51(0x1d7)],'telegramId':_0x374ba8[_0x297b51(0x1bb)],'merchantUrl':_0x374ba8[_0x297b51(0x1b0)],'gateways':_0x374ba8[_0x297b51(0x1de)]?JSON[_0x297b51(0x1be)](_0x374ba8[_0x297b51(0x1de)]):null,'gatewaySettings':_0x374ba8['gatewaySettings']?JSON[_0x297b51(0x1be)](_0x374ba8[_0x297b51(0x1ce)]):null,'publicKey':_0x374ba8['publicKey'],'wallets':{'usdtPolygonWallet':_0x374ba8[_0x297b51(0x1db)],'usdtTrcWallet':_0x374ba8[_0x297b51(0x1df)],'usdtErcWallet':_0x374ba8[_0x297b51(0x1d6)],'usdcPolygonWallet':_0x374ba8[_0x297b51(0x1bd)]},'status':_0x374ba8[_0x297b51(0x1b4)],'createdAt':_0x374ba8[_0x297b51(0x1b8)]}));}async['getUserById'](_0x395da0){const _0x244df0=a51_0x31ec47,_0x59de34=await database_1['default'][_0x244df0(0x1cf)][_0x244df0(0x1d1)]({'where':{'id':_0x395da0},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x59de34)return null;return{'id':_0x59de34['id'],'fullName':_0x59de34['name'],'username':_0x59de34['username'],'telegramId':_0x59de34['telegram'],'merchantUrl':_0x59de34['shopUrl'],'gateways':_0x59de34[_0x244df0(0x1de)]?JSON[_0x244df0(0x1be)](_0x59de34[_0x244df0(0x1de)]):null,'gatewaySettings':_0x59de34[_0x244df0(0x1ce)]?JSON[_0x244df0(0x1be)](_0x59de34[_0x244df0(0x1ce)]):null,'publicKey':_0x59de34[_0x244df0(0x1af)],'wallets':{'usdtPolygonWallet':_0x59de34[_0x244df0(0x1db)],'usdtTrcWallet':_0x59de34[_0x244df0(0x1df)],'usdtErcWallet':_0x59de34[_0x244df0(0x1d6)],'usdcPolygonWallet':_0x59de34['usdcPolygonWallet']},'status':_0x59de34[_0x244df0(0x1b4)],'createdAt':_0x59de34[_0x244df0(0x1b8)]};}async[a51_0x31ec47(0x1b2)](_0x27375a,_0x8f216a){const _0x1e32dc=a51_0x31ec47,_0x40bb51={..._0x8f216a};_0x8f216a[_0x1e32dc(0x1da)]&&(_0x40bb51['password']=await bcryptjs_1['default'][_0x1e32dc(0x1d4)](_0x8f216a[_0x1e32dc(0x1da)],0xc));_0x8f216a[_0x1e32dc(0x1d2)]&&(_0x40bb51[_0x1e32dc(0x1ab)]=_0x8f216a[_0x1e32dc(0x1d2)],delete _0x40bb51['fullName']);_0x8f216a[_0x1e32dc(0x1c4)]&&(_0x40bb51[_0x1e32dc(0x1bb)]=_0x8f216a[_0x1e32dc(0x1c4)],delete _0x40bb51[_0x1e32dc(0x1c4)]);_0x8f216a[_0x1e32dc(0x1ad)]&&(_0x40bb51['shopUrl']=_0x8f216a[_0x1e32dc(0x1ad)],delete _0x40bb51['merchantUrl']);_0x8f216a[_0x1e32dc(0x1bc)]&&(_0x40bb51[_0x1e32dc(0x1de)]=JSON[_0x1e32dc(0x1cc)](_0x8f216a[_0x1e32dc(0x1bc)]),delete _0x40bb51[_0x1e32dc(0x1bc)]);_0x8f216a[_0x1e32dc(0x1ce)]&&(_0x40bb51[_0x1e32dc(0x1ce)]=JSON['stringify'](_0x8f216a[_0x1e32dc(0x1ce)]),delete _0x40bb51[_0x1e32dc(0x1ce)]);_0x8f216a[_0x1e32dc(0x1cd)]&&(_0x8f216a[_0x1e32dc(0x1cd)][_0x1e32dc(0x1db)]!==undefined&&(_0x40bb51['usdtPolygonWallet']=_0x8f216a[_0x1e32dc(0x1cd)][_0x1e32dc(0x1db)]||null),_0x8f216a['wallets'][_0x1e32dc(0x1df)]!==undefined&&(_0x40bb51[_0x1e32dc(0x1df)]=_0x8f216a[_0x1e32dc(0x1cd)][_0x1e32dc(0x1df)]||null),_0x8f216a['wallets'][_0x1e32dc(0x1d6)]!==undefined&&(_0x40bb51['usdtErcWallet']=_0x8f216a[_0x1e32dc(0x1cd)][_0x1e32dc(0x1d6)]||null),_0x8f216a['wallets'][_0x1e32dc(0x1bd)]!==undefined&&(_0x40bb51[_0x1e32dc(0x1bd)]=_0x8f216a[_0x1e32dc(0x1cd)][_0x1e32dc(0x1bd)]||null),delete _0x40bb51[_0x1e32dc(0x1cd)]);const _0x455eb6=await database_1[_0x1e32dc(0x1e1)][_0x1e32dc(0x1cf)][_0x1e32dc(0x1d5)]({'where':{'id':_0x27375a},'data':_0x40bb51,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x455eb6['id'],'fullName':_0x455eb6[_0x1e32dc(0x1ab)],'username':_0x455eb6['username'],'telegramId':_0x455eb6[_0x1e32dc(0x1bb)],'merchantUrl':_0x455eb6['shopUrl'],'gateways':_0x455eb6[_0x1e32dc(0x1de)]?JSON['parse'](_0x455eb6[_0x1e32dc(0x1de)]):null,'gatewaySettings':_0x455eb6[_0x1e32dc(0x1ce)]?JSON[_0x1e32dc(0x1be)](_0x455eb6[_0x1e32dc(0x1ce)]):null,'publicKey':_0x455eb6[_0x1e32dc(0x1af)],'wallets':{'usdtPolygonWallet':_0x455eb6[_0x1e32dc(0x1db)],'usdtTrcWallet':_0x455eb6[_0x1e32dc(0x1df)],'usdtErcWallet':_0x455eb6['usdtErcWallet'],'usdcPolygonWallet':_0x455eb6[_0x1e32dc(0x1bd)]},'status':_0x455eb6[_0x1e32dc(0x1b4)],'createdAt':_0x455eb6[_0x1e32dc(0x1b8)]};}async['deleteUser'](_0x3470aa){const _0x5d0160=a51_0x31ec47;await database_1[_0x5d0160(0x1e1)][_0x5d0160(0x1cf)][_0x5d0160(0x1ae)]({'where':{'id':_0x3470aa}});}}exports[a51_0x31ec47(0x1d8)]=UserService;