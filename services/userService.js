'use strict';const a51_0x20e2f2=a51_0x1da7;function a51_0x1da7(_0x16d7be,_0x2e8c5d){const _0x4a6469=a51_0x4a64();return a51_0x1da7=function(_0x1da774,_0x331093){_0x1da774=_0x1da774-0x83;let _0x39801d=_0x4a6469[_0x1da774];return _0x39801d;},a51_0x1da7(_0x16d7be,_0x2e8c5d);}function a51_0x4a64(){const _0x6c17a7=['shop','1090008jmIDOl','stringify','136176gSbicB','Username\x20already\x20exists','usdtPolygonWallet','createdAt','paymentGateways','gatewaySettings','desc','createUser','findUnique','pk_','hash','telegram','map','usdcPolygonWallet','create','364294qwdwDr','merchantUrl','1750662iuKjzj','updateUser','369875pZkndO','randomBytes','gateways','telegramId','generateApiKeys','__esModule','publicKey','password','default','username','name','parse','wallets','findMany','432450RTgZYi','shopUrl','24kKEMZs','ACTIVE','usdtTrcWallet','usdtErcWallet','status','1621837chNPbh','toString','deleteUser'];a51_0x4a64=function(){return _0x6c17a7;};return a51_0x4a64();}(function(_0x4a9a3a,_0x297ce3){const _0x2e1c3d=a51_0x1da7,_0x278762=_0x4a9a3a();while(!![]){try{const _0x167b71=parseInt(_0x2e1c3d(0x8b))/0x1+-parseInt(_0x2e1c3d(0x9d))/0x2+parseInt(_0x2e1c3d(0xaa))/0x3+-parseInt(_0x2e1c3d(0xa8))/0x4+-parseInt(_0x2e1c3d(0x8f))/0x5+-parseInt(_0x2e1c3d(0x8d))/0x6+parseInt(_0x2e1c3d(0xa4))/0x7*(parseInt(_0x2e1c3d(0x9f))/0x8);if(_0x167b71===_0x297ce3)break;else _0x278762['push'](_0x278762['shift']());}catch(_0x4d63e1){_0x278762['push'](_0x278762['shift']());}}}(a51_0x4a64,0x3d1a8));var __importDefault=this&&this['__importDefault']||function(_0x45923d){return _0x45923d&&_0x45923d['__esModule']?_0x45923d:{'default':_0x45923d};};Object['defineProperty'](exports,a51_0x20e2f2(0x94),{'value':!![]}),exports['UserService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));class UserService{[a51_0x20e2f2(0x93)](){const _0x9017b5=a51_0x20e2f2,_0x56798d=_0x9017b5(0x85)+crypto_1[_0x9017b5(0x97)]['randomBytes'](0x20)[_0x9017b5(0xa5)]('hex'),_0x13be21='sk_'+crypto_1[_0x9017b5(0x97)][_0x9017b5(0x90)](0x20)[_0x9017b5(0xa5)]('hex');return{'publicKey':_0x56798d,'secretKey':_0x13be21};}async[a51_0x20e2f2(0x83)](_0x204fbb){const _0x114517=a51_0x20e2f2,{fullName:_0x19a700,username:_0x297182,password:_0x151474,telegramId:_0x597182,merchantUrl:_0x34e494,gateways:_0x26c3dd,gatewaySettings:_0x4baa54,wallets:_0x1cb7c7}=_0x204fbb,_0x3b5398=await database_1['default']['shop'][_0x114517(0x84)]({'where':{'username':_0x297182}});if(_0x3b5398)throw new Error(_0x114517(0xab));if(_0x597182){const _0xedf00a=await database_1[_0x114517(0x97)]['shop']['findUnique']({'where':{'telegram':_0x597182}});if(_0xedf00a)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x57ed6b=await bcryptjs_1['default'][_0x114517(0x86)](_0x151474,0xc),{publicKey:_0x317b57,secretKey:_0x53461d}=this[_0x114517(0x93)](),_0x3c1c11=await database_1['default']['shop'][_0x114517(0x8a)]({'data':{'name':_0x19a700,'username':_0x297182,'password':_0x57ed6b,'telegram':_0x597182,'shopUrl':_0x34e494,'paymentGateways':_0x26c3dd?JSON[_0x114517(0xa9)](_0x26c3dd):null,'gatewaySettings':_0x4baa54?JSON['stringify'](_0x4baa54):null,'usdtPolygonWallet':_0x1cb7c7?.[_0x114517(0xac)]||null,'usdtTrcWallet':_0x1cb7c7?.[_0x114517(0xa1)]||null,'usdtErcWallet':_0x1cb7c7?.[_0x114517(0xa2)]||null,'usdcPolygonWallet':_0x1cb7c7?.['usdcPolygonWallet']||null,'publicKey':_0x317b57,'secretKey':_0x53461d,'status':_0x114517(0xa0)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3c1c11['id'],'fullName':_0x3c1c11[_0x114517(0x99)],'username':_0x3c1c11[_0x114517(0x98)],'telegramId':_0x3c1c11['telegram'],'merchantUrl':_0x3c1c11['shopUrl'],'gateways':_0x3c1c11[_0x114517(0xae)]?JSON[_0x114517(0x9a)](_0x3c1c11['paymentGateways']):null,'gatewaySettings':_0x3c1c11[_0x114517(0xaf)]?JSON[_0x114517(0x9a)](_0x3c1c11['gatewaySettings']):null,'publicKey':_0x3c1c11[_0x114517(0x95)],'wallets':{'usdtPolygonWallet':_0x3c1c11[_0x114517(0xac)],'usdtTrcWallet':_0x3c1c11[_0x114517(0xa1)],'usdtErcWallet':_0x3c1c11[_0x114517(0xa2)],'usdcPolygonWallet':_0x3c1c11[_0x114517(0x89)]},'status':_0x3c1c11[_0x114517(0xa3)],'createdAt':_0x3c1c11[_0x114517(0xad)]};}async['getAllUsers'](){const _0x181889=a51_0x20e2f2,_0x8eabd5=await database_1[_0x181889(0x97)]['shop'][_0x181889(0x9c)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x181889(0xb0)}});return _0x8eabd5[_0x181889(0x88)](_0x4e0178=>({'id':_0x4e0178['id'],'fullName':_0x4e0178[_0x181889(0x99)],'username':_0x4e0178['username'],'telegramId':_0x4e0178[_0x181889(0x87)],'merchantUrl':_0x4e0178[_0x181889(0x9e)],'gateways':_0x4e0178[_0x181889(0xae)]?JSON['parse'](_0x4e0178[_0x181889(0xae)]):null,'gatewaySettings':_0x4e0178[_0x181889(0xaf)]?JSON[_0x181889(0x9a)](_0x4e0178[_0x181889(0xaf)]):null,'publicKey':_0x4e0178['publicKey'],'wallets':{'usdtPolygonWallet':_0x4e0178[_0x181889(0xac)],'usdtTrcWallet':_0x4e0178[_0x181889(0xa1)],'usdtErcWallet':_0x4e0178[_0x181889(0xa2)],'usdcPolygonWallet':_0x4e0178[_0x181889(0x89)]},'status':_0x4e0178[_0x181889(0xa3)],'createdAt':_0x4e0178[_0x181889(0xad)]}));}async['getUserById'](_0x20bb79){const _0x5a1ca5=a51_0x20e2f2,_0x5192d7=await database_1[_0x5a1ca5(0x97)][_0x5a1ca5(0xa7)][_0x5a1ca5(0x84)]({'where':{'id':_0x20bb79},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x5192d7)return null;return{'id':_0x5192d7['id'],'fullName':_0x5192d7['name'],'username':_0x5192d7[_0x5a1ca5(0x98)],'telegramId':_0x5192d7[_0x5a1ca5(0x87)],'merchantUrl':_0x5192d7[_0x5a1ca5(0x9e)],'gateways':_0x5192d7[_0x5a1ca5(0xae)]?JSON[_0x5a1ca5(0x9a)](_0x5192d7['paymentGateways']):null,'gatewaySettings':_0x5192d7['gatewaySettings']?JSON['parse'](_0x5192d7[_0x5a1ca5(0xaf)]):null,'publicKey':_0x5192d7[_0x5a1ca5(0x95)],'wallets':{'usdtPolygonWallet':_0x5192d7[_0x5a1ca5(0xac)],'usdtTrcWallet':_0x5192d7[_0x5a1ca5(0xa1)],'usdtErcWallet':_0x5192d7[_0x5a1ca5(0xa2)],'usdcPolygonWallet':_0x5192d7[_0x5a1ca5(0x89)]},'status':_0x5192d7[_0x5a1ca5(0xa3)],'createdAt':_0x5192d7[_0x5a1ca5(0xad)]};}async[a51_0x20e2f2(0x8e)](_0x246c3a,_0xc7e6a1){const _0x530fa7=a51_0x20e2f2,_0x519532={..._0xc7e6a1};_0xc7e6a1[_0x530fa7(0x96)]&&(_0x519532[_0x530fa7(0x96)]=await bcryptjs_1[_0x530fa7(0x97)][_0x530fa7(0x86)](_0xc7e6a1[_0x530fa7(0x96)],0xc));_0xc7e6a1['fullName']&&(_0x519532['name']=_0xc7e6a1['fullName'],delete _0x519532['fullName']);_0xc7e6a1[_0x530fa7(0x92)]&&(_0x519532[_0x530fa7(0x87)]=_0xc7e6a1[_0x530fa7(0x92)],delete _0x519532[_0x530fa7(0x92)]);_0xc7e6a1[_0x530fa7(0x8c)]&&(_0x519532[_0x530fa7(0x9e)]=_0xc7e6a1[_0x530fa7(0x8c)],delete _0x519532[_0x530fa7(0x8c)]);_0xc7e6a1[_0x530fa7(0x91)]&&(_0x519532[_0x530fa7(0xae)]=JSON[_0x530fa7(0xa9)](_0xc7e6a1['gateways']),delete _0x519532[_0x530fa7(0x91)]);_0xc7e6a1[_0x530fa7(0xaf)]&&(_0x519532[_0x530fa7(0xaf)]=JSON['stringify'](_0xc7e6a1[_0x530fa7(0xaf)]),delete _0x519532['gatewaySettings']);_0xc7e6a1[_0x530fa7(0x9b)]&&(_0xc7e6a1['wallets'][_0x530fa7(0xac)]!==undefined&&(_0x519532[_0x530fa7(0xac)]=_0xc7e6a1['wallets'][_0x530fa7(0xac)]||null),_0xc7e6a1['wallets'][_0x530fa7(0xa1)]!==undefined&&(_0x519532['usdtTrcWallet']=_0xc7e6a1[_0x530fa7(0x9b)][_0x530fa7(0xa1)]||null),_0xc7e6a1[_0x530fa7(0x9b)][_0x530fa7(0xa2)]!==undefined&&(_0x519532[_0x530fa7(0xa2)]=_0xc7e6a1[_0x530fa7(0x9b)][_0x530fa7(0xa2)]||null),_0xc7e6a1['wallets'][_0x530fa7(0x89)]!==undefined&&(_0x519532['usdcPolygonWallet']=_0xc7e6a1[_0x530fa7(0x9b)][_0x530fa7(0x89)]||null),delete _0x519532['wallets']);const _0x27a18a=await database_1['default'][_0x530fa7(0xa7)]['update']({'where':{'id':_0x246c3a},'data':_0x519532,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x27a18a['id'],'fullName':_0x27a18a[_0x530fa7(0x99)],'username':_0x27a18a[_0x530fa7(0x98)],'telegramId':_0x27a18a[_0x530fa7(0x87)],'merchantUrl':_0x27a18a[_0x530fa7(0x9e)],'gateways':_0x27a18a[_0x530fa7(0xae)]?JSON[_0x530fa7(0x9a)](_0x27a18a[_0x530fa7(0xae)]):null,'gatewaySettings':_0x27a18a[_0x530fa7(0xaf)]?JSON[_0x530fa7(0x9a)](_0x27a18a[_0x530fa7(0xaf)]):null,'publicKey':_0x27a18a['publicKey'],'wallets':{'usdtPolygonWallet':_0x27a18a[_0x530fa7(0xac)],'usdtTrcWallet':_0x27a18a[_0x530fa7(0xa1)],'usdtErcWallet':_0x27a18a[_0x530fa7(0xa2)],'usdcPolygonWallet':_0x27a18a[_0x530fa7(0x89)]},'status':_0x27a18a[_0x530fa7(0xa3)],'createdAt':_0x27a18a[_0x530fa7(0xad)]};}async[a51_0x20e2f2(0xa6)](_0x3e05de){const _0x3c0010=a51_0x20e2f2;await database_1[_0x3c0010(0x97)][_0x3c0010(0xa7)]['delete']({'where':{'id':_0x3e05de}});}}exports['UserService']=UserService;