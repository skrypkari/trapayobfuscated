'use strict';function a51_0x4d1b(_0x44a3c9,_0x4ad221){const _0x34862c=a51_0x3486();return a51_0x4d1b=function(_0x4d1bc7,_0x439607){_0x4d1bc7=_0x4d1bc7-0x112;let _0x3ecbae=_0x34862c[_0x4d1bc7];return _0x3ecbae;},a51_0x4d1b(_0x44a3c9,_0x4ad221);}const a51_0x43be6e=a51_0x4d1b;(function(_0x5bc562,_0x545623){const _0x33549d=a51_0x4d1b,_0x2e443a=_0x5bc562();while(!![]){try{const _0x2d94c2=-parseInt(_0x33549d(0x131))/0x1+-parseInt(_0x33549d(0x11d))/0x2*(-parseInt(_0x33549d(0x12d))/0x3)+-parseInt(_0x33549d(0x117))/0x4+parseInt(_0x33549d(0x113))/0x5+parseInt(_0x33549d(0x121))/0x6+parseInt(_0x33549d(0x140))/0x7+-parseInt(_0x33549d(0x11a))/0x8;if(_0x2d94c2===_0x545623)break;else _0x2e443a['push'](_0x2e443a['shift']());}catch(_0x3ad88e){_0x2e443a['push'](_0x2e443a['shift']());}}}(a51_0x3486,0x8025f));var __importDefault=this&&this[a51_0x43be6e(0x141)]||function(_0x1c98fc){return _0x1c98fc&&_0x1c98fc['__esModule']?_0x1c98fc:{'default':_0x1c98fc};};Object[a51_0x43be6e(0x12a)](exports,a51_0x43be6e(0x13e),{'value':!![]}),exports['UserService']=void 0x0;function a51_0x3486(){const _0x1742ef=['hex','defineProperty','hash','shopUrl','4491ZuXYFD','bcryptjs','update','usdcPolygonWallet','547270QKZGYe','UserService','getUserById','telegramId','default','username','../config/database','paymentGateways','Username\x20already\x20exists','generateApiKeys','create','usdtTrcWallet','updateUser','__esModule','createUser','2864876OFMJtc','__importDefault','desc','gatewaySettings','password','wallets','findUnique','usdtPolygonWallet','fullName','1712145xYYttI','sk_','parse','gateways','2304932wRELYK','status','name','254624BJKRMr','toString','pk_','674TObzsv','findMany','telegram','createdAt','2544240jVVFWn','map','stringify','publicKey','shop','crypto','usdtErcWallet','merchantUrl'];a51_0x3486=function(){return _0x1742ef;};return a51_0x3486();}const bcryptjs_1=__importDefault(require(a51_0x43be6e(0x12e))),crypto_1=__importDefault(require(a51_0x43be6e(0x126))),database_1=__importDefault(require(a51_0x43be6e(0x137)));class UserService{[a51_0x43be6e(0x13a)](){const _0x5625d8=a51_0x43be6e,_0x1727ca=_0x5625d8(0x11c)+crypto_1['default']['randomBytes'](0x20)[_0x5625d8(0x11b)](_0x5625d8(0x129)),_0x5e86da=_0x5625d8(0x114)+crypto_1[_0x5625d8(0x135)]['randomBytes'](0x20)[_0x5625d8(0x11b)](_0x5625d8(0x129));return{'publicKey':_0x1727ca,'secretKey':_0x5e86da};}async[a51_0x43be6e(0x13f)](_0x221b7e){const _0xcbb1dd=a51_0x43be6e,{fullName:_0x438c14,username:_0x10b3a8,password:_0x448850,telegramId:_0x3c3493,merchantUrl:_0x519380,gateways:_0x5709c4,gatewaySettings:_0x2e4c34,wallets:_0x27ba85}=_0x221b7e,_0x4d368d=await database_1['default'][_0xcbb1dd(0x125)][_0xcbb1dd(0x146)]({'where':{'username':_0x10b3a8}});if(_0x4d368d)throw new Error(_0xcbb1dd(0x139));if(_0x3c3493){const _0x3f4826=await database_1[_0xcbb1dd(0x135)][_0xcbb1dd(0x125)][_0xcbb1dd(0x146)]({'where':{'telegram':_0x3c3493}});if(_0x3f4826)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x1be4e7=await bcryptjs_1[_0xcbb1dd(0x135)][_0xcbb1dd(0x12b)](_0x448850,0xc),{publicKey:_0x2dfdf4,secretKey:_0x20dfd1}=this['generateApiKeys'](),_0x24525c=await database_1['default'][_0xcbb1dd(0x125)][_0xcbb1dd(0x13b)]({'data':{'name':_0x438c14,'username':_0x10b3a8,'password':_0x1be4e7,'telegram':_0x3c3493,'shopUrl':_0x519380,'paymentGateways':_0x5709c4?JSON[_0xcbb1dd(0x123)](_0x5709c4):null,'gatewaySettings':_0x2e4c34?JSON[_0xcbb1dd(0x123)](_0x2e4c34):null,'usdtPolygonWallet':_0x27ba85?.[_0xcbb1dd(0x147)]||null,'usdtTrcWallet':_0x27ba85?.[_0xcbb1dd(0x13c)]||null,'usdtErcWallet':_0x27ba85?.[_0xcbb1dd(0x127)]||null,'usdcPolygonWallet':_0x27ba85?.[_0xcbb1dd(0x130)]||null,'publicKey':_0x2dfdf4,'secretKey':_0x20dfd1,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x24525c['id'],'fullName':_0x24525c[_0xcbb1dd(0x119)],'username':_0x24525c[_0xcbb1dd(0x136)],'telegramId':_0x24525c[_0xcbb1dd(0x11f)],'merchantUrl':_0x24525c['shopUrl'],'gateways':_0x24525c['paymentGateways']?JSON[_0xcbb1dd(0x115)](_0x24525c[_0xcbb1dd(0x138)]):null,'gatewaySettings':_0x24525c[_0xcbb1dd(0x143)]?JSON[_0xcbb1dd(0x115)](_0x24525c[_0xcbb1dd(0x143)]):null,'publicKey':_0x24525c[_0xcbb1dd(0x124)],'wallets':{'usdtPolygonWallet':_0x24525c[_0xcbb1dd(0x147)],'usdtTrcWallet':_0x24525c['usdtTrcWallet'],'usdtErcWallet':_0x24525c[_0xcbb1dd(0x127)],'usdcPolygonWallet':_0x24525c['usdcPolygonWallet']},'status':_0x24525c[_0xcbb1dd(0x118)],'createdAt':_0x24525c[_0xcbb1dd(0x120)]};}async['getAllUsers'](){const _0x244b8e=a51_0x43be6e,_0x893ccc=await database_1[_0x244b8e(0x135)][_0x244b8e(0x125)][_0x244b8e(0x11e)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x244b8e(0x142)}});return _0x893ccc[_0x244b8e(0x122)](_0xa5ee6d=>({'id':_0xa5ee6d['id'],'fullName':_0xa5ee6d[_0x244b8e(0x119)],'username':_0xa5ee6d[_0x244b8e(0x136)],'telegramId':_0xa5ee6d[_0x244b8e(0x11f)],'merchantUrl':_0xa5ee6d[_0x244b8e(0x12c)],'gateways':_0xa5ee6d[_0x244b8e(0x138)]?JSON[_0x244b8e(0x115)](_0xa5ee6d[_0x244b8e(0x138)]):null,'gatewaySettings':_0xa5ee6d[_0x244b8e(0x143)]?JSON[_0x244b8e(0x115)](_0xa5ee6d['gatewaySettings']):null,'publicKey':_0xa5ee6d[_0x244b8e(0x124)],'wallets':{'usdtPolygonWallet':_0xa5ee6d[_0x244b8e(0x147)],'usdtTrcWallet':_0xa5ee6d['usdtTrcWallet'],'usdtErcWallet':_0xa5ee6d[_0x244b8e(0x127)],'usdcPolygonWallet':_0xa5ee6d[_0x244b8e(0x130)]},'status':_0xa5ee6d['status'],'createdAt':_0xa5ee6d[_0x244b8e(0x120)]}));}async[a51_0x43be6e(0x133)](_0x4b189b){const _0x476365=a51_0x43be6e,_0x47432f=await database_1[_0x476365(0x135)]['shop']['findUnique']({'where':{'id':_0x4b189b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x47432f)return null;return{'id':_0x47432f['id'],'fullName':_0x47432f['name'],'username':_0x47432f['username'],'telegramId':_0x47432f[_0x476365(0x11f)],'merchantUrl':_0x47432f[_0x476365(0x12c)],'gateways':_0x47432f[_0x476365(0x138)]?JSON['parse'](_0x47432f[_0x476365(0x138)]):null,'gatewaySettings':_0x47432f[_0x476365(0x143)]?JSON[_0x476365(0x115)](_0x47432f[_0x476365(0x143)]):null,'publicKey':_0x47432f[_0x476365(0x124)],'wallets':{'usdtPolygonWallet':_0x47432f[_0x476365(0x147)],'usdtTrcWallet':_0x47432f[_0x476365(0x13c)],'usdtErcWallet':_0x47432f['usdtErcWallet'],'usdcPolygonWallet':_0x47432f['usdcPolygonWallet']},'status':_0x47432f['status'],'createdAt':_0x47432f[_0x476365(0x120)]};}async[a51_0x43be6e(0x13d)](_0x2b9cb9,_0x56067a){const _0x5a35b9=a51_0x43be6e,_0x55f086={..._0x56067a};_0x56067a['password']&&(_0x55f086['password']=await bcryptjs_1[_0x5a35b9(0x135)]['hash'](_0x56067a[_0x5a35b9(0x144)],0xc));_0x56067a[_0x5a35b9(0x112)]&&(_0x55f086[_0x5a35b9(0x119)]=_0x56067a[_0x5a35b9(0x112)],delete _0x55f086[_0x5a35b9(0x112)]);_0x56067a['telegramId']&&(_0x55f086[_0x5a35b9(0x11f)]=_0x56067a[_0x5a35b9(0x134)],delete _0x55f086[_0x5a35b9(0x134)]);_0x56067a[_0x5a35b9(0x128)]&&(_0x55f086['shopUrl']=_0x56067a['merchantUrl'],delete _0x55f086['merchantUrl']);_0x56067a[_0x5a35b9(0x116)]&&(_0x55f086[_0x5a35b9(0x138)]=JSON[_0x5a35b9(0x123)](_0x56067a['gateways']),delete _0x55f086['gateways']);_0x56067a[_0x5a35b9(0x143)]&&(_0x55f086['gatewaySettings']=JSON[_0x5a35b9(0x123)](_0x56067a[_0x5a35b9(0x143)]),delete _0x55f086[_0x5a35b9(0x143)]);_0x56067a[_0x5a35b9(0x145)]&&(_0x56067a['wallets']['usdtPolygonWallet']!==undefined&&(_0x55f086[_0x5a35b9(0x147)]=_0x56067a['wallets']['usdtPolygonWallet']||null),_0x56067a[_0x5a35b9(0x145)][_0x5a35b9(0x13c)]!==undefined&&(_0x55f086['usdtTrcWallet']=_0x56067a[_0x5a35b9(0x145)]['usdtTrcWallet']||null),_0x56067a[_0x5a35b9(0x145)]['usdtErcWallet']!==undefined&&(_0x55f086[_0x5a35b9(0x127)]=_0x56067a[_0x5a35b9(0x145)][_0x5a35b9(0x127)]||null),_0x56067a[_0x5a35b9(0x145)][_0x5a35b9(0x130)]!==undefined&&(_0x55f086['usdcPolygonWallet']=_0x56067a[_0x5a35b9(0x145)][_0x5a35b9(0x130)]||null),delete _0x55f086[_0x5a35b9(0x145)]);const _0xb34924=await database_1['default']['shop'][_0x5a35b9(0x12f)]({'where':{'id':_0x2b9cb9},'data':_0x55f086,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xb34924['id'],'fullName':_0xb34924[_0x5a35b9(0x119)],'username':_0xb34924['username'],'telegramId':_0xb34924[_0x5a35b9(0x11f)],'merchantUrl':_0xb34924[_0x5a35b9(0x12c)],'gateways':_0xb34924[_0x5a35b9(0x138)]?JSON[_0x5a35b9(0x115)](_0xb34924[_0x5a35b9(0x138)]):null,'gatewaySettings':_0xb34924[_0x5a35b9(0x143)]?JSON[_0x5a35b9(0x115)](_0xb34924[_0x5a35b9(0x143)]):null,'publicKey':_0xb34924[_0x5a35b9(0x124)],'wallets':{'usdtPolygonWallet':_0xb34924[_0x5a35b9(0x147)],'usdtTrcWallet':_0xb34924[_0x5a35b9(0x13c)],'usdtErcWallet':_0xb34924['usdtErcWallet'],'usdcPolygonWallet':_0xb34924[_0x5a35b9(0x130)]},'status':_0xb34924[_0x5a35b9(0x118)],'createdAt':_0xb34924[_0x5a35b9(0x120)]};}async['deleteUser'](_0x3c1a16){const _0x9d6733=a51_0x43be6e;await database_1['default'][_0x9d6733(0x125)]['delete']({'where':{'id':_0x3c1a16}});}}exports[a51_0x43be6e(0x132)]=UserService;