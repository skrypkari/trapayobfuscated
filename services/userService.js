'use strict';function a65_0x3104(){const _0x1e17e0=['hash','paymentGateways','findUnique','randomBytes','delete','gatewaySettings','merchantUrl','61852QgskNY','pk_','180ImGUen','createdAt','hex','824177hSETKP','getUserById','usdtPolygonWallet','../config/database','password','Username\x20already\x20exists','telegram','1819940uKQfkd','shopUrl','__importDefault','desc','411952QLuzxU','createUser','UserService','wallets','status','crypto','parse','getAllUsers','usdtErcWallet','fullName','update','625nOYgCF','gateways','usdtTrcWallet','44ZmiCcW','11156390WdGvzF','default','username','findMany','129OWZOii','telegramId','stringify','name','9661548WDviyt','__esModule','usdcPolygonWallet','generateApiKeys','shop','2UVbMuz','updateUser','publicKey','5178WLExYE','toString','sk_'];a65_0x3104=function(){return _0x1e17e0;};return a65_0x3104();}function a65_0x47f1(_0x2799ba,_0x2f2685){const _0x31047a=a65_0x3104();return a65_0x47f1=function(_0x47f13e,_0x33306){_0x47f13e=_0x47f13e-0xb2;let _0x4c70c6=_0x31047a[_0x47f13e];return _0x4c70c6;},a65_0x47f1(_0x2799ba,_0x2f2685);}const a65_0xb85240=a65_0x47f1;(function(_0x2885b8,_0x7ad762){const _0x1127c7=a65_0x47f1,_0x342895=_0x2885b8();while(!![]){try{const _0x2f38ee=-parseInt(_0x1127c7(0xbb))/0x1*(parseInt(_0x1127c7(0xe2))/0x2)+-parseInt(_0x1127c7(0xd9))/0x3*(-parseInt(_0x1127c7(0xb6))/0x4)+-parseInt(_0x1127c7(0xd1))/0x5*(-parseInt(_0x1127c7(0xe5))/0x6)+-parseInt(_0x1127c7(0xd5))/0x7+-parseInt(_0x1127c7(0xc6))/0x8*(-parseInt(_0x1127c7(0xb8))/0x9)+parseInt(_0x1127c7(0xc2))/0xa*(parseInt(_0x1127c7(0xd4))/0xb)+parseInt(_0x1127c7(0xdd))/0xc;if(_0x2f38ee===_0x7ad762)break;else _0x342895['push'](_0x342895['shift']());}catch(_0x497c19){_0x342895['push'](_0x342895['shift']());}}}(a65_0x3104,0xe013e));var __importDefault=this&&this[a65_0xb85240(0xc4)]||function(_0x19675){const _0x38b0d8=a65_0xb85240;return _0x19675&&_0x19675[_0x38b0d8(0xde)]?_0x19675:{'default':_0x19675};};Object['defineProperty'](exports,a65_0xb85240(0xde),{'value':!![]}),exports[a65_0xb85240(0xc8)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a65_0xb85240(0xcb))),database_1=__importDefault(require(a65_0xb85240(0xbe)));class UserService{[a65_0xb85240(0xe0)](){const _0x41cbb=a65_0xb85240,_0x1e9e56=_0x41cbb(0xb7)+crypto_1[_0x41cbb(0xd6)]['randomBytes'](0x20)[_0x41cbb(0xe6)](_0x41cbb(0xba)),_0x1f6831=_0x41cbb(0xe7)+crypto_1[_0x41cbb(0xd6)][_0x41cbb(0xb2)](0x20)[_0x41cbb(0xe6)]('hex');return{'publicKey':_0x1e9e56,'secretKey':_0x1f6831};}async[a65_0xb85240(0xc7)](_0x223a2c){const _0xa08e56=a65_0xb85240,{fullName:_0x1c3b29,username:_0x246490,password:_0x417002,telegramId:_0x5dd8f3,merchantUrl:_0x3297af,gateways:_0x432964,gatewaySettings:_0x1f0a55,wallets:_0x4d3092}=_0x223a2c,_0x336d7c=await database_1[_0xa08e56(0xd6)][_0xa08e56(0xe1)][_0xa08e56(0xea)]({'where':{'username':_0x246490}});if(_0x336d7c)throw new Error(_0xa08e56(0xc0));if(_0x5dd8f3){const _0x1cc94e=await database_1[_0xa08e56(0xd6)][_0xa08e56(0xe1)]['findUnique']({'where':{'telegram':_0x5dd8f3}});if(_0x1cc94e)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x274c5f=await bcryptjs_1[_0xa08e56(0xd6)][_0xa08e56(0xe8)](_0x417002,0xc),{publicKey:_0x4e6481,secretKey:_0x344eff}=this['generateApiKeys'](),_0x44f100=await database_1[_0xa08e56(0xd6)][_0xa08e56(0xe1)]['create']({'data':{'name':_0x1c3b29,'username':_0x246490,'password':_0x274c5f,'telegram':_0x5dd8f3,'shopUrl':_0x3297af,'paymentGateways':_0x432964?JSON[_0xa08e56(0xdb)](_0x432964):null,'gatewaySettings':_0x1f0a55?JSON['stringify'](_0x1f0a55):null,'usdtPolygonWallet':_0x4d3092?.[_0xa08e56(0xbd)]||null,'usdtTrcWallet':_0x4d3092?.[_0xa08e56(0xd3)]||null,'usdtErcWallet':_0x4d3092?.[_0xa08e56(0xce)]||null,'usdcPolygonWallet':_0x4d3092?.['usdcPolygonWallet']||null,'publicKey':_0x4e6481,'secretKey':_0x344eff,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x44f100['id'],'fullName':_0x44f100[_0xa08e56(0xdc)],'username':_0x44f100['username'],'telegramId':_0x44f100[_0xa08e56(0xc1)],'merchantUrl':_0x44f100[_0xa08e56(0xc3)],'gateways':_0x44f100[_0xa08e56(0xe9)]?JSON[_0xa08e56(0xcc)](_0x44f100[_0xa08e56(0xe9)]):null,'gatewaySettings':_0x44f100[_0xa08e56(0xb4)]?JSON['parse'](_0x44f100[_0xa08e56(0xb4)]):null,'publicKey':_0x44f100[_0xa08e56(0xe4)],'wallets':{'usdtPolygonWallet':_0x44f100[_0xa08e56(0xbd)],'usdtTrcWallet':_0x44f100['usdtTrcWallet'],'usdtErcWallet':_0x44f100['usdtErcWallet'],'usdcPolygonWallet':_0x44f100['usdcPolygonWallet']},'status':_0x44f100[_0xa08e56(0xca)],'createdAt':_0x44f100[_0xa08e56(0xb9)]};}async[a65_0xb85240(0xcd)](){const _0x22b713=a65_0xb85240,_0x48333f=await database_1['default'][_0x22b713(0xe1)][_0x22b713(0xd8)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x22b713(0xc5)}});return _0x48333f['map'](_0x51a9dd=>({'id':_0x51a9dd['id'],'fullName':_0x51a9dd['name'],'username':_0x51a9dd[_0x22b713(0xd7)],'telegramId':_0x51a9dd[_0x22b713(0xc1)],'merchantUrl':_0x51a9dd[_0x22b713(0xc3)],'gateways':_0x51a9dd[_0x22b713(0xe9)]?JSON['parse'](_0x51a9dd['paymentGateways']):null,'gatewaySettings':_0x51a9dd[_0x22b713(0xb4)]?JSON['parse'](_0x51a9dd[_0x22b713(0xb4)]):null,'publicKey':_0x51a9dd[_0x22b713(0xe4)],'wallets':{'usdtPolygonWallet':_0x51a9dd[_0x22b713(0xbd)],'usdtTrcWallet':_0x51a9dd[_0x22b713(0xd3)],'usdtErcWallet':_0x51a9dd[_0x22b713(0xce)],'usdcPolygonWallet':_0x51a9dd[_0x22b713(0xdf)]},'status':_0x51a9dd[_0x22b713(0xca)],'createdAt':_0x51a9dd[_0x22b713(0xb9)]}));}async[a65_0xb85240(0xbc)](_0x3166a2){const _0x550f97=a65_0xb85240,_0x477c9c=await database_1[_0x550f97(0xd6)][_0x550f97(0xe1)][_0x550f97(0xea)]({'where':{'id':_0x3166a2},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x477c9c)return null;return{'id':_0x477c9c['id'],'fullName':_0x477c9c[_0x550f97(0xdc)],'username':_0x477c9c[_0x550f97(0xd7)],'telegramId':_0x477c9c['telegram'],'merchantUrl':_0x477c9c[_0x550f97(0xc3)],'gateways':_0x477c9c[_0x550f97(0xe9)]?JSON['parse'](_0x477c9c[_0x550f97(0xe9)]):null,'gatewaySettings':_0x477c9c[_0x550f97(0xb4)]?JSON['parse'](_0x477c9c['gatewaySettings']):null,'publicKey':_0x477c9c[_0x550f97(0xe4)],'wallets':{'usdtPolygonWallet':_0x477c9c[_0x550f97(0xbd)],'usdtTrcWallet':_0x477c9c[_0x550f97(0xd3)],'usdtErcWallet':_0x477c9c[_0x550f97(0xce)],'usdcPolygonWallet':_0x477c9c[_0x550f97(0xdf)]},'status':_0x477c9c[_0x550f97(0xca)],'createdAt':_0x477c9c[_0x550f97(0xb9)]};}async[a65_0xb85240(0xe3)](_0x25329a,_0x20b67f){const _0x423995=a65_0xb85240,_0x6c3c98={..._0x20b67f};_0x20b67f[_0x423995(0xbf)]&&(_0x6c3c98['password']=await bcryptjs_1[_0x423995(0xd6)][_0x423995(0xe8)](_0x20b67f[_0x423995(0xbf)],0xc));_0x20b67f[_0x423995(0xcf)]&&(_0x6c3c98[_0x423995(0xdc)]=_0x20b67f['fullName'],delete _0x6c3c98['fullName']);_0x20b67f[_0x423995(0xda)]&&(_0x6c3c98[_0x423995(0xc1)]=_0x20b67f['telegramId'],delete _0x6c3c98[_0x423995(0xda)]);_0x20b67f[_0x423995(0xb5)]&&(_0x6c3c98[_0x423995(0xc3)]=_0x20b67f[_0x423995(0xb5)],delete _0x6c3c98[_0x423995(0xb5)]);_0x20b67f[_0x423995(0xd2)]&&(_0x6c3c98[_0x423995(0xe9)]=JSON['stringify'](_0x20b67f['gateways']),delete _0x6c3c98[_0x423995(0xd2)]);_0x20b67f[_0x423995(0xb4)]&&(_0x6c3c98[_0x423995(0xb4)]=JSON['stringify'](_0x20b67f['gatewaySettings']),delete _0x6c3c98[_0x423995(0xb4)]);_0x20b67f[_0x423995(0xc9)]&&(_0x20b67f['wallets']['usdtPolygonWallet']!==undefined&&(_0x6c3c98[_0x423995(0xbd)]=_0x20b67f[_0x423995(0xc9)]['usdtPolygonWallet']||null),_0x20b67f[_0x423995(0xc9)][_0x423995(0xd3)]!==undefined&&(_0x6c3c98[_0x423995(0xd3)]=_0x20b67f[_0x423995(0xc9)][_0x423995(0xd3)]||null),_0x20b67f['wallets'][_0x423995(0xce)]!==undefined&&(_0x6c3c98[_0x423995(0xce)]=_0x20b67f['wallets'][_0x423995(0xce)]||null),_0x20b67f[_0x423995(0xc9)][_0x423995(0xdf)]!==undefined&&(_0x6c3c98[_0x423995(0xdf)]=_0x20b67f[_0x423995(0xc9)][_0x423995(0xdf)]||null),delete _0x6c3c98[_0x423995(0xc9)]);const _0x30106d=await database_1[_0x423995(0xd6)][_0x423995(0xe1)][_0x423995(0xd0)]({'where':{'id':_0x25329a},'data':_0x6c3c98,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x30106d['id'],'fullName':_0x30106d[_0x423995(0xdc)],'username':_0x30106d[_0x423995(0xd7)],'telegramId':_0x30106d[_0x423995(0xc1)],'merchantUrl':_0x30106d[_0x423995(0xc3)],'gateways':_0x30106d[_0x423995(0xe9)]?JSON[_0x423995(0xcc)](_0x30106d[_0x423995(0xe9)]):null,'gatewaySettings':_0x30106d[_0x423995(0xb4)]?JSON['parse'](_0x30106d[_0x423995(0xb4)]):null,'publicKey':_0x30106d[_0x423995(0xe4)],'wallets':{'usdtPolygonWallet':_0x30106d[_0x423995(0xbd)],'usdtTrcWallet':_0x30106d[_0x423995(0xd3)],'usdtErcWallet':_0x30106d['usdtErcWallet'],'usdcPolygonWallet':_0x30106d[_0x423995(0xdf)]},'status':_0x30106d['status'],'createdAt':_0x30106d[_0x423995(0xb9)]};}async['deleteUser'](_0x21664c){const _0x33bf1a=a65_0xb85240;await database_1[_0x33bf1a(0xd6)][_0x33bf1a(0xe1)][_0x33bf1a(0xb3)]({'where':{'id':_0x21664c}});}}exports[a65_0xb85240(0xc8)]=UserService;