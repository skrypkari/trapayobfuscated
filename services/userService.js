'use strict';const a61_0x42508c=a61_0x2e9b;function a61_0x2e9b(_0x4b4afa,_0x71f126){const _0x4da15d=a61_0x4da1();return a61_0x2e9b=function(_0x2e9bd9,_0x241652){_0x2e9bd9=_0x2e9bd9-0x120;let _0x244ca6=_0x4da15d[_0x2e9bd9];return _0x244ca6;},a61_0x2e9b(_0x4b4afa,_0x71f126);}function a61_0x4da1(){const _0xe766bf=['ACTIVE','generateApiKeys','481010KwYEeZ','desc','createUser','gateways','map','getUserById','findMany','usdcPolygonWallet','crypto','telegramId','status','telegram','usdtErcWallet','merchantUrl','UserService','shopUrl','Telegram\x20username\x20already\x20exists','fullName','randomBytes','username','create','usdtTrcWallet','457018LxMQTM','name','10924tWenFt','shop','defineProperty','createdAt','hash','deleteUser','usdtPolygonWallet','paymentGateways','sk_','104530dBwRGZ','297HrvLdt','password','__importDefault','stringify','6lZtBXw','21kUmjRF','gatewaySettings','2422465YrFlvw','5266485hBdbJj','toString','getAllUsers','hex','parse','1249984tLmKMj','update','wallets','default','publicKey','843rvtPxT','bcryptjs','Username\x20already\x20exists','findUnique','__esModule','../config/database'];a61_0x4da1=function(){return _0xe766bf;};return a61_0x4da1();}(function(_0x4fc411,_0x136590){const _0x491215=a61_0x2e9b,_0xf76b7=_0x4fc411();while(!![]){try{const _0xaf809e=parseInt(_0x491215(0x121))/0x1+-parseInt(_0x491215(0x12c))/0x2+-parseInt(_0x491215(0x13f))/0x3*(-parseInt(_0x491215(0x123))/0x4)+parseInt(_0x491215(0x134))/0x5*(-parseInt(_0x491215(0x131))/0x6)+-parseInt(_0x491215(0x132))/0x7*(-parseInt(_0x491215(0x13a))/0x8)+parseInt(_0x491215(0x135))/0x9+-parseInt(_0x491215(0x147))/0xa*(parseInt(_0x491215(0x12d))/0xb);if(_0xaf809e===_0x136590)break;else _0xf76b7['push'](_0xf76b7['shift']());}catch(_0x2a6bb6){_0xf76b7['push'](_0xf76b7['shift']());}}}(a61_0x4da1,0x6c1e5));var __importDefault=this&&this[a61_0x42508c(0x12f)]||function(_0x40562d){const _0x94b342=a61_0x42508c;return _0x40562d&&_0x40562d[_0x94b342(0x143)]?_0x40562d:{'default':_0x40562d};};Object[a61_0x42508c(0x125)](exports,a61_0x42508c(0x143),{'value':!![]}),exports[a61_0x42508c(0x155)]=void 0x0;const bcryptjs_1=__importDefault(require(a61_0x42508c(0x140))),crypto_1=__importDefault(require(a61_0x42508c(0x14f))),database_1=__importDefault(require(a61_0x42508c(0x144)));class UserService{['generateApiKeys'](){const _0x1eee90=a61_0x42508c,_0x3e010b='pk_'+crypto_1[_0x1eee90(0x13d)][_0x1eee90(0x159)](0x20)[_0x1eee90(0x136)](_0x1eee90(0x138)),_0x58db0b=_0x1eee90(0x12b)+crypto_1[_0x1eee90(0x13d)]['randomBytes'](0x20)[_0x1eee90(0x136)](_0x1eee90(0x138));return{'publicKey':_0x3e010b,'secretKey':_0x58db0b};}async[a61_0x42508c(0x149)](_0x4cfc4b){const _0x170a60=a61_0x42508c,{fullName:_0x2e59de,username:_0x364c7b,password:_0x52b511,telegramId:_0x265720,merchantUrl:_0x2a8fae,gateways:_0x193107,gatewaySettings:_0x4350b1,wallets:_0x144122}=_0x4cfc4b,_0xc09614=await database_1[_0x170a60(0x13d)]['shop']['findUnique']({'where':{'username':_0x364c7b}});if(_0xc09614)throw new Error(_0x170a60(0x141));if(_0x265720){const _0x295ea9=await database_1[_0x170a60(0x13d)][_0x170a60(0x124)]['findUnique']({'where':{'telegram':_0x265720}});if(_0x295ea9)throw new Error(_0x170a60(0x157));}const _0x218242=await bcryptjs_1['default'][_0x170a60(0x127)](_0x52b511,0xc),{publicKey:_0x4cc0a8,secretKey:_0x37d429}=this[_0x170a60(0x146)](),_0x217937=await database_1[_0x170a60(0x13d)][_0x170a60(0x124)][_0x170a60(0x15b)]({'data':{'name':_0x2e59de,'username':_0x364c7b,'password':_0x218242,'telegram':_0x265720,'shopUrl':_0x2a8fae,'paymentGateways':_0x193107?JSON['stringify'](_0x193107):null,'gatewaySettings':_0x4350b1?JSON['stringify'](_0x4350b1):null,'usdtPolygonWallet':_0x144122?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x144122?.[_0x170a60(0x120)]||null,'usdtErcWallet':_0x144122?.[_0x170a60(0x153)]||null,'usdcPolygonWallet':_0x144122?.[_0x170a60(0x14e)]||null,'publicKey':_0x4cc0a8,'secretKey':_0x37d429,'status':_0x170a60(0x145)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x217937['id'],'fullName':_0x217937[_0x170a60(0x122)],'username':_0x217937[_0x170a60(0x15a)],'telegramId':_0x217937['telegram'],'merchantUrl':_0x217937[_0x170a60(0x156)],'gateways':_0x217937[_0x170a60(0x12a)]?JSON[_0x170a60(0x139)](_0x217937[_0x170a60(0x12a)]):null,'gatewaySettings':_0x217937[_0x170a60(0x133)]?JSON[_0x170a60(0x139)](_0x217937[_0x170a60(0x133)]):null,'publicKey':_0x217937[_0x170a60(0x13e)],'wallets':{'usdtPolygonWallet':_0x217937['usdtPolygonWallet'],'usdtTrcWallet':_0x217937[_0x170a60(0x120)],'usdtErcWallet':_0x217937[_0x170a60(0x153)],'usdcPolygonWallet':_0x217937[_0x170a60(0x14e)]},'status':_0x217937[_0x170a60(0x151)],'createdAt':_0x217937[_0x170a60(0x126)]};}async[a61_0x42508c(0x137)](){const _0x51dfa2=a61_0x42508c,_0x39fed2=await database_1[_0x51dfa2(0x13d)][_0x51dfa2(0x124)][_0x51dfa2(0x14d)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x51dfa2(0x148)}});return _0x39fed2[_0x51dfa2(0x14b)](_0x49a072=>({'id':_0x49a072['id'],'fullName':_0x49a072[_0x51dfa2(0x122)],'username':_0x49a072[_0x51dfa2(0x15a)],'telegramId':_0x49a072[_0x51dfa2(0x152)],'merchantUrl':_0x49a072['shopUrl'],'gateways':_0x49a072[_0x51dfa2(0x12a)]?JSON[_0x51dfa2(0x139)](_0x49a072[_0x51dfa2(0x12a)]):null,'gatewaySettings':_0x49a072[_0x51dfa2(0x133)]?JSON[_0x51dfa2(0x139)](_0x49a072[_0x51dfa2(0x133)]):null,'publicKey':_0x49a072[_0x51dfa2(0x13e)],'wallets':{'usdtPolygonWallet':_0x49a072[_0x51dfa2(0x129)],'usdtTrcWallet':_0x49a072[_0x51dfa2(0x120)],'usdtErcWallet':_0x49a072[_0x51dfa2(0x153)],'usdcPolygonWallet':_0x49a072[_0x51dfa2(0x14e)]},'status':_0x49a072[_0x51dfa2(0x151)],'createdAt':_0x49a072[_0x51dfa2(0x126)]}));}async[a61_0x42508c(0x14c)](_0x3fe43d){const _0x1a6d78=a61_0x42508c,_0x3f41c1=await database_1['default'][_0x1a6d78(0x124)][_0x1a6d78(0x142)]({'where':{'id':_0x3fe43d},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3f41c1)return null;return{'id':_0x3f41c1['id'],'fullName':_0x3f41c1[_0x1a6d78(0x122)],'username':_0x3f41c1[_0x1a6d78(0x15a)],'telegramId':_0x3f41c1[_0x1a6d78(0x152)],'merchantUrl':_0x3f41c1[_0x1a6d78(0x156)],'gateways':_0x3f41c1['paymentGateways']?JSON[_0x1a6d78(0x139)](_0x3f41c1['paymentGateways']):null,'gatewaySettings':_0x3f41c1[_0x1a6d78(0x133)]?JSON[_0x1a6d78(0x139)](_0x3f41c1[_0x1a6d78(0x133)]):null,'publicKey':_0x3f41c1['publicKey'],'wallets':{'usdtPolygonWallet':_0x3f41c1[_0x1a6d78(0x129)],'usdtTrcWallet':_0x3f41c1[_0x1a6d78(0x120)],'usdtErcWallet':_0x3f41c1[_0x1a6d78(0x153)],'usdcPolygonWallet':_0x3f41c1[_0x1a6d78(0x14e)]},'status':_0x3f41c1[_0x1a6d78(0x151)],'createdAt':_0x3f41c1[_0x1a6d78(0x126)]};}async['updateUser'](_0x2c811c,_0x4360d4){const _0x90a51=a61_0x42508c,_0x2c217d={..._0x4360d4};_0x4360d4[_0x90a51(0x12e)]&&(_0x2c217d[_0x90a51(0x12e)]=await bcryptjs_1['default'][_0x90a51(0x127)](_0x4360d4['password'],0xc));_0x4360d4[_0x90a51(0x158)]&&(_0x2c217d[_0x90a51(0x122)]=_0x4360d4['fullName'],delete _0x2c217d[_0x90a51(0x158)]);_0x4360d4['telegramId']&&(_0x2c217d[_0x90a51(0x152)]=_0x4360d4['telegramId'],delete _0x2c217d[_0x90a51(0x150)]);_0x4360d4[_0x90a51(0x154)]&&(_0x2c217d[_0x90a51(0x156)]=_0x4360d4[_0x90a51(0x154)],delete _0x2c217d[_0x90a51(0x154)]);_0x4360d4[_0x90a51(0x14a)]&&(_0x2c217d['paymentGateways']=JSON[_0x90a51(0x130)](_0x4360d4['gateways']),delete _0x2c217d[_0x90a51(0x14a)]);_0x4360d4['gatewaySettings']&&(_0x2c217d[_0x90a51(0x133)]=JSON[_0x90a51(0x130)](_0x4360d4[_0x90a51(0x133)]),delete _0x2c217d['gatewaySettings']);_0x4360d4[_0x90a51(0x13c)]&&(_0x4360d4[_0x90a51(0x13c)][_0x90a51(0x129)]!==undefined&&(_0x2c217d[_0x90a51(0x129)]=_0x4360d4['wallets'][_0x90a51(0x129)]||null),_0x4360d4[_0x90a51(0x13c)][_0x90a51(0x120)]!==undefined&&(_0x2c217d[_0x90a51(0x120)]=_0x4360d4[_0x90a51(0x13c)]['usdtTrcWallet']||null),_0x4360d4['wallets'][_0x90a51(0x153)]!==undefined&&(_0x2c217d[_0x90a51(0x153)]=_0x4360d4['wallets'][_0x90a51(0x153)]||null),_0x4360d4[_0x90a51(0x13c)][_0x90a51(0x14e)]!==undefined&&(_0x2c217d[_0x90a51(0x14e)]=_0x4360d4[_0x90a51(0x13c)][_0x90a51(0x14e)]||null),delete _0x2c217d[_0x90a51(0x13c)]);const _0x414619=await database_1[_0x90a51(0x13d)][_0x90a51(0x124)][_0x90a51(0x13b)]({'where':{'id':_0x2c811c},'data':_0x2c217d,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x414619['id'],'fullName':_0x414619[_0x90a51(0x122)],'username':_0x414619[_0x90a51(0x15a)],'telegramId':_0x414619['telegram'],'merchantUrl':_0x414619['shopUrl'],'gateways':_0x414619[_0x90a51(0x12a)]?JSON[_0x90a51(0x139)](_0x414619[_0x90a51(0x12a)]):null,'gatewaySettings':_0x414619[_0x90a51(0x133)]?JSON[_0x90a51(0x139)](_0x414619[_0x90a51(0x133)]):null,'publicKey':_0x414619[_0x90a51(0x13e)],'wallets':{'usdtPolygonWallet':_0x414619[_0x90a51(0x129)],'usdtTrcWallet':_0x414619['usdtTrcWallet'],'usdtErcWallet':_0x414619[_0x90a51(0x153)],'usdcPolygonWallet':_0x414619[_0x90a51(0x14e)]},'status':_0x414619['status'],'createdAt':_0x414619[_0x90a51(0x126)]};}async[a61_0x42508c(0x128)](_0x2d9950){const _0x47445a=a61_0x42508c;await database_1[_0x47445a(0x13d)]['shop']['delete']({'where':{'id':_0x2d9950}});}}exports[a61_0x42508c(0x155)]=UserService;