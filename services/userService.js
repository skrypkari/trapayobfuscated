'use strict';const a56_0x31fe83=a56_0x2b7e;function a56_0x2b7e(_0x44bf3f,_0x9b6e56){const _0x5d56d5=a56_0x5d56();return a56_0x2b7e=function(_0x2b7e0e,_0x4949e1){_0x2b7e0e=_0x2b7e0e-0x9a;let _0x16438a=_0x5d56d5[_0x2b7e0e];return _0x16438a;},a56_0x2b7e(_0x44bf3f,_0x9b6e56);}(function(_0x5cc48f,_0x188474){const _0x30b2b5=a56_0x2b7e,_0x20c5e7=_0x5cc48f();while(!![]){try{const _0x31d2e2=-parseInt(_0x30b2b5(0xb9))/0x1+parseInt(_0x30b2b5(0xac))/0x2+parseInt(_0x30b2b5(0xb8))/0x3+parseInt(_0x30b2b5(0x9a))/0x4+parseInt(_0x30b2b5(0xc7))/0x5+-parseInt(_0x30b2b5(0xcb))/0x6*(parseInt(_0x30b2b5(0xab))/0x7)+-parseInt(_0x30b2b5(0xb5))/0x8;if(_0x31d2e2===_0x188474)break;else _0x20c5e7['push'](_0x20c5e7['shift']());}catch(_0x3d454a){_0x20c5e7['push'](_0x20c5e7['shift']());}}}(a56_0x5d56,0x76ea3));function a56_0x5d56(){const _0x2c093e=['parse','sk_','findUnique','Telegram\x20username\x20already\x20exists','gateways','createdAt','bcryptjs','name','findMany','createUser','91ryQEvu','722994extACI','default','stringify','username','pk_','../config/database','usdcPolygonWallet','gatewaySettings','usdtPolygonWallet','5323752utSDQT','wallets','password','2058198sWatHV','474282Jzbpvl','publicKey','getAllUsers','telegram','fullName','delete','paymentGateways','telegramId','shop','status','UserService','shopUrl','toString','deleteUser','821640Rwopex','hex','defineProperty','usdtErcWallet','197202DfxaED','hash','3368824xugOzI','getUserById','generateApiKeys','__importDefault','usdtTrcWallet','merchantUrl','crypto'];a56_0x5d56=function(){return _0x2c093e;};return a56_0x5d56();}var __importDefault=this&&this[a56_0x31fe83(0x9d)]||function(_0x57d18c){return _0x57d18c&&_0x57d18c['__esModule']?_0x57d18c:{'default':_0x57d18c};};Object[a56_0x31fe83(0xc9)](exports,'__esModule',{'value':!![]}),exports['UserService']=void 0x0;const bcryptjs_1=__importDefault(require(a56_0x31fe83(0xa7))),crypto_1=__importDefault(require(a56_0x31fe83(0xa0))),database_1=__importDefault(require(a56_0x31fe83(0xb1)));class UserService{[a56_0x31fe83(0x9c)](){const _0xb0cc08=a56_0x31fe83,_0x4b7771=_0xb0cc08(0xb0)+crypto_1[_0xb0cc08(0xad)]['randomBytes'](0x20)[_0xb0cc08(0xc5)]('hex'),_0x447d78=_0xb0cc08(0xa2)+crypto_1[_0xb0cc08(0xad)]['randomBytes'](0x20)['toString'](_0xb0cc08(0xc8));return{'publicKey':_0x4b7771,'secretKey':_0x447d78};}async[a56_0x31fe83(0xaa)](_0xe6ed41){const _0x38d91a=a56_0x31fe83,{fullName:_0x35ee1d,username:_0x4a90ff,password:_0x123cb4,telegramId:_0x3955e8,merchantUrl:_0x30ccbf,gateways:_0x4e40e3,gatewaySettings:_0x3b6d18,wallets:_0x5978fe}=_0xe6ed41,_0x3ee0fb=await database_1['default']['shop'][_0x38d91a(0xa3)]({'where':{'username':_0x4a90ff}});if(_0x3ee0fb)throw new Error('Username\x20already\x20exists');if(_0x3955e8){const _0xf8e9e6=await database_1[_0x38d91a(0xad)]['shop']['findUnique']({'where':{'telegram':_0x3955e8}});if(_0xf8e9e6)throw new Error(_0x38d91a(0xa4));}const _0xed964e=await bcryptjs_1['default'][_0x38d91a(0xcc)](_0x123cb4,0xc),{publicKey:_0x1f2bb1,secretKey:_0x507122}=this['generateApiKeys'](),_0x56c340=await database_1['default'][_0x38d91a(0xc1)]['create']({'data':{'name':_0x35ee1d,'username':_0x4a90ff,'password':_0xed964e,'telegram':_0x3955e8,'shopUrl':_0x30ccbf,'paymentGateways':_0x4e40e3?JSON[_0x38d91a(0xae)](_0x4e40e3):null,'gatewaySettings':_0x3b6d18?JSON[_0x38d91a(0xae)](_0x3b6d18):null,'usdtPolygonWallet':_0x5978fe?.[_0x38d91a(0xb4)]||null,'usdtTrcWallet':_0x5978fe?.[_0x38d91a(0x9e)]||null,'usdtErcWallet':_0x5978fe?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x5978fe?.[_0x38d91a(0xb2)]||null,'publicKey':_0x1f2bb1,'secretKey':_0x507122,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x56c340['id'],'fullName':_0x56c340[_0x38d91a(0xa8)],'username':_0x56c340[_0x38d91a(0xaf)],'telegramId':_0x56c340[_0x38d91a(0xbc)],'merchantUrl':_0x56c340['shopUrl'],'gateways':_0x56c340[_0x38d91a(0xbf)]?JSON[_0x38d91a(0xa1)](_0x56c340[_0x38d91a(0xbf)]):null,'gatewaySettings':_0x56c340[_0x38d91a(0xb3)]?JSON['parse'](_0x56c340['gatewaySettings']):null,'publicKey':_0x56c340[_0x38d91a(0xba)],'wallets':{'usdtPolygonWallet':_0x56c340['usdtPolygonWallet'],'usdtTrcWallet':_0x56c340[_0x38d91a(0x9e)],'usdtErcWallet':_0x56c340[_0x38d91a(0xca)],'usdcPolygonWallet':_0x56c340[_0x38d91a(0xb2)]},'status':_0x56c340['status'],'createdAt':_0x56c340[_0x38d91a(0xa6)]};}async[a56_0x31fe83(0xbb)](){const _0x120cc6=a56_0x31fe83,_0x37f166=await database_1[_0x120cc6(0xad)]['shop'][_0x120cc6(0xa9)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':'desc'}});return _0x37f166['map'](_0x5a5c54=>({'id':_0x5a5c54['id'],'fullName':_0x5a5c54[_0x120cc6(0xa8)],'username':_0x5a5c54[_0x120cc6(0xaf)],'telegramId':_0x5a5c54[_0x120cc6(0xbc)],'merchantUrl':_0x5a5c54[_0x120cc6(0xc4)],'gateways':_0x5a5c54[_0x120cc6(0xbf)]?JSON[_0x120cc6(0xa1)](_0x5a5c54['paymentGateways']):null,'gatewaySettings':_0x5a5c54[_0x120cc6(0xb3)]?JSON[_0x120cc6(0xa1)](_0x5a5c54['gatewaySettings']):null,'publicKey':_0x5a5c54[_0x120cc6(0xba)],'wallets':{'usdtPolygonWallet':_0x5a5c54['usdtPolygonWallet'],'usdtTrcWallet':_0x5a5c54['usdtTrcWallet'],'usdtErcWallet':_0x5a5c54[_0x120cc6(0xca)],'usdcPolygonWallet':_0x5a5c54[_0x120cc6(0xb2)]},'status':_0x5a5c54['status'],'createdAt':_0x5a5c54[_0x120cc6(0xa6)]}));}async[a56_0x31fe83(0x9b)](_0x1ddb97){const _0x2ad4d8=a56_0x31fe83,_0x302750=await database_1['default'][_0x2ad4d8(0xc1)]['findUnique']({'where':{'id':_0x1ddb97},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x302750)return null;return{'id':_0x302750['id'],'fullName':_0x302750[_0x2ad4d8(0xa8)],'username':_0x302750['username'],'telegramId':_0x302750[_0x2ad4d8(0xbc)],'merchantUrl':_0x302750[_0x2ad4d8(0xc4)],'gateways':_0x302750['paymentGateways']?JSON[_0x2ad4d8(0xa1)](_0x302750[_0x2ad4d8(0xbf)]):null,'gatewaySettings':_0x302750[_0x2ad4d8(0xb3)]?JSON[_0x2ad4d8(0xa1)](_0x302750[_0x2ad4d8(0xb3)]):null,'publicKey':_0x302750[_0x2ad4d8(0xba)],'wallets':{'usdtPolygonWallet':_0x302750[_0x2ad4d8(0xb4)],'usdtTrcWallet':_0x302750['usdtTrcWallet'],'usdtErcWallet':_0x302750[_0x2ad4d8(0xca)],'usdcPolygonWallet':_0x302750['usdcPolygonWallet']},'status':_0x302750[_0x2ad4d8(0xc2)],'createdAt':_0x302750['createdAt']};}async['updateUser'](_0x6e5c30,_0x171206){const _0x1cae61=a56_0x31fe83,_0xb2d87e={..._0x171206};_0x171206[_0x1cae61(0xb7)]&&(_0xb2d87e[_0x1cae61(0xb7)]=await bcryptjs_1[_0x1cae61(0xad)][_0x1cae61(0xcc)](_0x171206[_0x1cae61(0xb7)],0xc));_0x171206[_0x1cae61(0xbd)]&&(_0xb2d87e['name']=_0x171206[_0x1cae61(0xbd)],delete _0xb2d87e[_0x1cae61(0xbd)]);_0x171206[_0x1cae61(0xc0)]&&(_0xb2d87e[_0x1cae61(0xbc)]=_0x171206[_0x1cae61(0xc0)],delete _0xb2d87e[_0x1cae61(0xc0)]);_0x171206[_0x1cae61(0x9f)]&&(_0xb2d87e[_0x1cae61(0xc4)]=_0x171206[_0x1cae61(0x9f)],delete _0xb2d87e[_0x1cae61(0x9f)]);_0x171206['gateways']&&(_0xb2d87e[_0x1cae61(0xbf)]=JSON['stringify'](_0x171206[_0x1cae61(0xa5)]),delete _0xb2d87e['gateways']);_0x171206[_0x1cae61(0xb3)]&&(_0xb2d87e['gatewaySettings']=JSON[_0x1cae61(0xae)](_0x171206[_0x1cae61(0xb3)]),delete _0xb2d87e[_0x1cae61(0xb3)]);_0x171206[_0x1cae61(0xb6)]&&(_0x171206[_0x1cae61(0xb6)][_0x1cae61(0xb4)]!==undefined&&(_0xb2d87e[_0x1cae61(0xb4)]=_0x171206[_0x1cae61(0xb6)][_0x1cae61(0xb4)]||null),_0x171206['wallets'][_0x1cae61(0x9e)]!==undefined&&(_0xb2d87e['usdtTrcWallet']=_0x171206[_0x1cae61(0xb6)]['usdtTrcWallet']||null),_0x171206['wallets'][_0x1cae61(0xca)]!==undefined&&(_0xb2d87e[_0x1cae61(0xca)]=_0x171206[_0x1cae61(0xb6)][_0x1cae61(0xca)]||null),_0x171206[_0x1cae61(0xb6)][_0x1cae61(0xb2)]!==undefined&&(_0xb2d87e['usdcPolygonWallet']=_0x171206[_0x1cae61(0xb6)][_0x1cae61(0xb2)]||null),delete _0xb2d87e['wallets']);const _0x1f80c3=await database_1['default']['shop']['update']({'where':{'id':_0x6e5c30},'data':_0xb2d87e,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1f80c3['id'],'fullName':_0x1f80c3['name'],'username':_0x1f80c3['username'],'telegramId':_0x1f80c3['telegram'],'merchantUrl':_0x1f80c3['shopUrl'],'gateways':_0x1f80c3[_0x1cae61(0xbf)]?JSON[_0x1cae61(0xa1)](_0x1f80c3[_0x1cae61(0xbf)]):null,'gatewaySettings':_0x1f80c3[_0x1cae61(0xb3)]?JSON['parse'](_0x1f80c3['gatewaySettings']):null,'publicKey':_0x1f80c3[_0x1cae61(0xba)],'wallets':{'usdtPolygonWallet':_0x1f80c3[_0x1cae61(0xb4)],'usdtTrcWallet':_0x1f80c3[_0x1cae61(0x9e)],'usdtErcWallet':_0x1f80c3[_0x1cae61(0xca)],'usdcPolygonWallet':_0x1f80c3[_0x1cae61(0xb2)]},'status':_0x1f80c3[_0x1cae61(0xc2)],'createdAt':_0x1f80c3[_0x1cae61(0xa6)]};}async[a56_0x31fe83(0xc6)](_0x4e4ee7){const _0x3692d6=a56_0x31fe83;await database_1['default'][_0x3692d6(0xc1)][_0x3692d6(0xbe)]({'where':{'id':_0x4e4ee7}});}}exports[a56_0x31fe83(0xc3)]=UserService;