'use strict';const a68_0x49fac8=a68_0x1979;function a68_0x1979(_0x37abe1,_0x3ff4a0){const _0x496adc=a68_0x496a();return a68_0x1979=function(_0x19792b,_0x3107da){_0x19792b=_0x19792b-0xd5;let _0x2f8c56=_0x496adc[_0x19792b];return _0x2f8c56;},a68_0x1979(_0x37abe1,_0x3ff4a0);}function a68_0x496a(){const _0x2899f6=['crypto','publicKey','__importDefault','toString','4051494YYACBU','status','parse','name','3535826djCOWG','paymentGateways','getAllUsers','Username\x20already\x20exists','delete','map','password','default','Telegram\x20username\x20already\x20exists','usdcPolygonWallet','hex','11556708shRbgM','__esModule','desc','username','create','usdtTrcWallet','createUser','63hmfowE','194fyLeqr','randomBytes','gateways','getUserById','stringify','wallets','91544cuLOdi','fullName','bcryptjs','UserService','merchantUrl','22sFypJR','2632810HJlPZw','hash','sk_','usdtErcWallet','telegram','shopUrl','findUnique','usdtPolygonWallet','1173470ZxJgQy','8ItkZLE','shop','telegramId','6UlxAat','../config/database','5646IfTxkE','gatewaySettings','findMany','createdAt'];a68_0x496a=function(){return _0x2899f6;};return a68_0x496a();}(function(_0x212b02,_0x5afa7c){const _0x5cac97=a68_0x1979,_0x4774cb=_0x212b02();while(!![]){try{const _0x1769b5=-parseInt(_0x5cac97(0x106))/0x1*(parseInt(_0x5cac97(0xec))/0x2)+-parseInt(_0x5cac97(0xeb))/0x3*(parseInt(_0x5cac97(0xf2))/0x4)+-parseInt(_0x5cac97(0x100))/0x5*(parseInt(_0x5cac97(0x104))/0x6)+parseInt(_0x5cac97(0xd9))/0x7+parseInt(_0x5cac97(0x101))/0x8*(-parseInt(_0x5cac97(0xd5))/0x9)+parseInt(_0x5cac97(0xf8))/0xa*(parseInt(_0x5cac97(0xf7))/0xb)+parseInt(_0x5cac97(0xe4))/0xc;if(_0x1769b5===_0x5afa7c)break;else _0x4774cb['push'](_0x4774cb['shift']());}catch(_0x3b8fdc){_0x4774cb['push'](_0x4774cb['shift']());}}}(a68_0x496a,0x44c0b));var __importDefault=this&&this[a68_0x49fac8(0x10c)]||function(_0x4e8b90){const _0x403806=a68_0x49fac8;return _0x4e8b90&&_0x4e8b90[_0x403806(0xe5)]?_0x4e8b90:{'default':_0x4e8b90};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a68_0x49fac8(0xf5)]=void 0x0;const bcryptjs_1=__importDefault(require(a68_0x49fac8(0xf4))),crypto_1=__importDefault(require(a68_0x49fac8(0x10a))),database_1=__importDefault(require(a68_0x49fac8(0x105)));class UserService{['generateApiKeys'](){const _0x2e7128=a68_0x49fac8,_0x42b752='pk_'+crypto_1['default'][_0x2e7128(0xed)](0x20)[_0x2e7128(0x10d)](_0x2e7128(0xe3)),_0x549da8=_0x2e7128(0xfa)+crypto_1[_0x2e7128(0xe0)]['randomBytes'](0x20)[_0x2e7128(0x10d)](_0x2e7128(0xe3));return{'publicKey':_0x42b752,'secretKey':_0x549da8};}async[a68_0x49fac8(0xea)](_0x281890){const _0x4b8368=a68_0x49fac8,{fullName:_0x2389d4,username:_0x5e5f63,password:_0x955570,telegramId:_0x590406,merchantUrl:_0x949ddc,gateways:_0x56c37a,gatewaySettings:_0x4a29ed,wallets:_0x1e8f7a}=_0x281890,_0x16db4c=await database_1[_0x4b8368(0xe0)][_0x4b8368(0x102)]['findUnique']({'where':{'username':_0x5e5f63}});if(_0x16db4c)throw new Error(_0x4b8368(0xdc));if(_0x590406){const _0x48a31f=await database_1[_0x4b8368(0xe0)][_0x4b8368(0x102)][_0x4b8368(0xfe)]({'where':{'telegram':_0x590406}});if(_0x48a31f)throw new Error(_0x4b8368(0xe1));}const _0x292003=await bcryptjs_1[_0x4b8368(0xe0)][_0x4b8368(0xf9)](_0x955570,0xc),{publicKey:_0x3e145a,secretKey:_0x39628a}=this['generateApiKeys'](),_0x4d43e0=await database_1['default'][_0x4b8368(0x102)][_0x4b8368(0xe8)]({'data':{'name':_0x2389d4,'username':_0x5e5f63,'password':_0x292003,'telegram':_0x590406,'shopUrl':_0x949ddc,'paymentGateways':_0x56c37a?JSON[_0x4b8368(0xf0)](_0x56c37a):null,'gatewaySettings':_0x4a29ed?JSON[_0x4b8368(0xf0)](_0x4a29ed):null,'usdtPolygonWallet':_0x1e8f7a?.[_0x4b8368(0xff)]||null,'usdtTrcWallet':_0x1e8f7a?.[_0x4b8368(0xe9)]||null,'usdtErcWallet':_0x1e8f7a?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x1e8f7a?.[_0x4b8368(0xe2)]||null,'publicKey':_0x3e145a,'secretKey':_0x39628a,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4d43e0['id'],'fullName':_0x4d43e0[_0x4b8368(0xd8)],'username':_0x4d43e0['username'],'telegramId':_0x4d43e0[_0x4b8368(0xfc)],'merchantUrl':_0x4d43e0[_0x4b8368(0xfd)],'gateways':_0x4d43e0[_0x4b8368(0xda)]?JSON[_0x4b8368(0xd7)](_0x4d43e0['paymentGateways']):null,'gatewaySettings':_0x4d43e0['gatewaySettings']?JSON['parse'](_0x4d43e0['gatewaySettings']):null,'publicKey':_0x4d43e0[_0x4b8368(0x10b)],'wallets':{'usdtPolygonWallet':_0x4d43e0[_0x4b8368(0xff)],'usdtTrcWallet':_0x4d43e0[_0x4b8368(0xe9)],'usdtErcWallet':_0x4d43e0[_0x4b8368(0xfb)],'usdcPolygonWallet':_0x4d43e0[_0x4b8368(0xe2)]},'status':_0x4d43e0['status'],'createdAt':_0x4d43e0[_0x4b8368(0x109)]};}async[a68_0x49fac8(0xdb)](){const _0xbb6a40=a68_0x49fac8,_0x3ab8e7=await database_1['default']['shop'][_0xbb6a40(0x108)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0xbb6a40(0xe6)}});return _0x3ab8e7[_0xbb6a40(0xde)](_0x155a52=>({'id':_0x155a52['id'],'fullName':_0x155a52[_0xbb6a40(0xd8)],'username':_0x155a52[_0xbb6a40(0xe7)],'telegramId':_0x155a52[_0xbb6a40(0xfc)],'merchantUrl':_0x155a52[_0xbb6a40(0xfd)],'gateways':_0x155a52['paymentGateways']?JSON[_0xbb6a40(0xd7)](_0x155a52[_0xbb6a40(0xda)]):null,'gatewaySettings':_0x155a52['gatewaySettings']?JSON[_0xbb6a40(0xd7)](_0x155a52['gatewaySettings']):null,'publicKey':_0x155a52[_0xbb6a40(0x10b)],'wallets':{'usdtPolygonWallet':_0x155a52[_0xbb6a40(0xff)],'usdtTrcWallet':_0x155a52[_0xbb6a40(0xe9)],'usdtErcWallet':_0x155a52[_0xbb6a40(0xfb)],'usdcPolygonWallet':_0x155a52[_0xbb6a40(0xe2)]},'status':_0x155a52[_0xbb6a40(0xd6)],'createdAt':_0x155a52['createdAt']}));}async[a68_0x49fac8(0xef)](_0x4be0ea){const _0x1de37f=a68_0x49fac8,_0x2a64a9=await database_1['default']['shop'][_0x1de37f(0xfe)]({'where':{'id':_0x4be0ea},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2a64a9)return null;return{'id':_0x2a64a9['id'],'fullName':_0x2a64a9[_0x1de37f(0xd8)],'username':_0x2a64a9[_0x1de37f(0xe7)],'telegramId':_0x2a64a9[_0x1de37f(0xfc)],'merchantUrl':_0x2a64a9['shopUrl'],'gateways':_0x2a64a9[_0x1de37f(0xda)]?JSON[_0x1de37f(0xd7)](_0x2a64a9[_0x1de37f(0xda)]):null,'gatewaySettings':_0x2a64a9[_0x1de37f(0x107)]?JSON['parse'](_0x2a64a9[_0x1de37f(0x107)]):null,'publicKey':_0x2a64a9['publicKey'],'wallets':{'usdtPolygonWallet':_0x2a64a9[_0x1de37f(0xff)],'usdtTrcWallet':_0x2a64a9['usdtTrcWallet'],'usdtErcWallet':_0x2a64a9[_0x1de37f(0xfb)],'usdcPolygonWallet':_0x2a64a9['usdcPolygonWallet']},'status':_0x2a64a9[_0x1de37f(0xd6)],'createdAt':_0x2a64a9[_0x1de37f(0x109)]};}async['updateUser'](_0x3d1292,_0x3f6782){const _0x2641ba=a68_0x49fac8,_0x347694={..._0x3f6782};_0x3f6782['password']&&(_0x347694[_0x2641ba(0xdf)]=await bcryptjs_1[_0x2641ba(0xe0)][_0x2641ba(0xf9)](_0x3f6782[_0x2641ba(0xdf)],0xc));_0x3f6782[_0x2641ba(0xf3)]&&(_0x347694[_0x2641ba(0xd8)]=_0x3f6782['fullName'],delete _0x347694[_0x2641ba(0xf3)]);_0x3f6782[_0x2641ba(0x103)]&&(_0x347694['telegram']=_0x3f6782[_0x2641ba(0x103)],delete _0x347694[_0x2641ba(0x103)]);_0x3f6782[_0x2641ba(0xf6)]&&(_0x347694[_0x2641ba(0xfd)]=_0x3f6782[_0x2641ba(0xf6)],delete _0x347694[_0x2641ba(0xf6)]);_0x3f6782[_0x2641ba(0xee)]&&(_0x347694[_0x2641ba(0xda)]=JSON[_0x2641ba(0xf0)](_0x3f6782['gateways']),delete _0x347694['gateways']);_0x3f6782['gatewaySettings']&&(_0x347694[_0x2641ba(0x107)]=JSON['stringify'](_0x3f6782[_0x2641ba(0x107)]),delete _0x347694[_0x2641ba(0x107)]);_0x3f6782[_0x2641ba(0xf1)]&&(_0x3f6782['wallets'][_0x2641ba(0xff)]!==undefined&&(_0x347694['usdtPolygonWallet']=_0x3f6782[_0x2641ba(0xf1)][_0x2641ba(0xff)]||null),_0x3f6782['wallets'][_0x2641ba(0xe9)]!==undefined&&(_0x347694['usdtTrcWallet']=_0x3f6782[_0x2641ba(0xf1)][_0x2641ba(0xe9)]||null),_0x3f6782[_0x2641ba(0xf1)][_0x2641ba(0xfb)]!==undefined&&(_0x347694[_0x2641ba(0xfb)]=_0x3f6782[_0x2641ba(0xf1)][_0x2641ba(0xfb)]||null),_0x3f6782[_0x2641ba(0xf1)][_0x2641ba(0xe2)]!==undefined&&(_0x347694[_0x2641ba(0xe2)]=_0x3f6782['wallets'][_0x2641ba(0xe2)]||null),delete _0x347694[_0x2641ba(0xf1)]);const _0xb7e730=await database_1[_0x2641ba(0xe0)]['shop']['update']({'where':{'id':_0x3d1292},'data':_0x347694,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xb7e730['id'],'fullName':_0xb7e730[_0x2641ba(0xd8)],'username':_0xb7e730[_0x2641ba(0xe7)],'telegramId':_0xb7e730[_0x2641ba(0xfc)],'merchantUrl':_0xb7e730[_0x2641ba(0xfd)],'gateways':_0xb7e730[_0x2641ba(0xda)]?JSON['parse'](_0xb7e730[_0x2641ba(0xda)]):null,'gatewaySettings':_0xb7e730[_0x2641ba(0x107)]?JSON['parse'](_0xb7e730[_0x2641ba(0x107)]):null,'publicKey':_0xb7e730[_0x2641ba(0x10b)],'wallets':{'usdtPolygonWallet':_0xb7e730[_0x2641ba(0xff)],'usdtTrcWallet':_0xb7e730[_0x2641ba(0xe9)],'usdtErcWallet':_0xb7e730[_0x2641ba(0xfb)],'usdcPolygonWallet':_0xb7e730[_0x2641ba(0xe2)]},'status':_0xb7e730[_0x2641ba(0xd6)],'createdAt':_0xb7e730[_0x2641ba(0x109)]};}async['deleteUser'](_0x326c86){const _0x4b66e0=a68_0x49fac8;await database_1[_0x4b66e0(0xe0)][_0x4b66e0(0x102)][_0x4b66e0(0xdd)]({'where':{'id':_0x326c86}});}}exports[a68_0x49fac8(0xf5)]=UserService;