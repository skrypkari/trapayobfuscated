'use strict';const a61_0x2f37ea=a61_0x4472;(function(_0x25a290,_0x20560d){const _0x59ff01=a61_0x4472,_0x15e40c=_0x25a290();while(!![]){try{const _0x1d4a1b=parseInt(_0x59ff01(0x15d))/0x1+-parseInt(_0x59ff01(0x156))/0x2*(-parseInt(_0x59ff01(0x155))/0x3)+-parseInt(_0x59ff01(0x13f))/0x4+-parseInt(_0x59ff01(0x130))/0x5+parseInt(_0x59ff01(0x14c))/0x6*(-parseInt(_0x59ff01(0x12a))/0x7)+-parseInt(_0x59ff01(0x145))/0x8*(-parseInt(_0x59ff01(0x13e))/0x9)+parseInt(_0x59ff01(0x13d))/0xa*(-parseInt(_0x59ff01(0x160))/0xb);if(_0x1d4a1b===_0x20560d)break;else _0x15e40c['push'](_0x15e40c['shift']());}catch(_0xf447dd){_0x15e40c['push'](_0x15e40c['shift']());}}}(a61_0x1e80,0x29c17));var __importDefault=this&&this[a61_0x2f37ea(0x153)]||function(_0x5c0422){const _0x2abcb9=a61_0x2f37ea;return _0x5c0422&&_0x5c0422[_0x2abcb9(0x15f)]?_0x5c0422:{'default':_0x5c0422};};function a61_0x4472(_0x38993e,_0x2f4398){const _0x1e8084=a61_0x1e80();return a61_0x4472=function(_0x4472b4,_0x4968fd){_0x4472b4=_0x4472b4-0x128;let _0x572dcc=_0x1e8084[_0x4472b4];return _0x572dcc;},a61_0x4472(_0x38993e,_0x2f4398);}Object[a61_0x2f37ea(0x157)](exports,'__esModule',{'value':!![]}),exports[a61_0x2f37ea(0x136)]=void 0x0;function a61_0x1e80(){const _0x1a5478=['delete','gateways','createdAt','randomBytes','UserService','username','usdtPolygonWallet','usdtTrcWallet','telegram','shopUrl','usdcPolygonWallet','35950eTulrH','816885DBjpOL','295276dTOYZF','stringify','getAllUsers','deleteUser','findMany','create','24oNtEZa','findUnique','fullName','paymentGateways','gatewaySettings','desc','password','846eAgzDR','toString','merchantUrl','Telegram\x20username\x20already\x20exists','map','usdtErcWallet','shop','__importDefault','name','27VvLcRr','60478aiQbrQ','defineProperty','hash','status','ACTIVE','parse','bcryptjs','197763JnFbOP','pk_','__esModule','176hsdxkt','default','wallets','5117iQeqnE','telegramId','crypto','updateUser','update','hex','1683840wgxpAi','generateApiKeys'];a61_0x1e80=function(){return _0x1a5478;};return a61_0x1e80();}const bcryptjs_1=__importDefault(require(a61_0x2f37ea(0x15c))),crypto_1=__importDefault(require(a61_0x2f37ea(0x12c))),database_1=__importDefault(require('../config/database'));class UserService{['generateApiKeys'](){const _0xc0368e=a61_0x2f37ea,_0x39ffab=_0xc0368e(0x15e)+crypto_1[_0xc0368e(0x128)][_0xc0368e(0x135)](0x20)[_0xc0368e(0x14d)](_0xc0368e(0x12f)),_0x4c9794='sk_'+crypto_1[_0xc0368e(0x128)]['randomBytes'](0x20)[_0xc0368e(0x14d)](_0xc0368e(0x12f));return{'publicKey':_0x39ffab,'secretKey':_0x4c9794};}async['createUser'](_0x431077){const _0x57c4e5=a61_0x2f37ea,{fullName:_0x3bb1d0,username:_0x2710f7,password:_0x531ee0,telegramId:_0x346716,merchantUrl:_0x22dbc7,gateways:_0x47085c,gatewaySettings:_0x1dcced,wallets:_0x544fa4}=_0x431077,_0x2cf32f=await database_1[_0x57c4e5(0x128)][_0x57c4e5(0x152)]['findUnique']({'where':{'username':_0x2710f7}});if(_0x2cf32f)throw new Error('Username\x20already\x20exists');if(_0x346716){const _0x3bf39=await database_1[_0x57c4e5(0x128)][_0x57c4e5(0x152)][_0x57c4e5(0x146)]({'where':{'telegram':_0x346716}});if(_0x3bf39)throw new Error(_0x57c4e5(0x14f));}const _0x3f0c6e=await bcryptjs_1[_0x57c4e5(0x128)][_0x57c4e5(0x158)](_0x531ee0,0xc),{publicKey:_0xd72ff8,secretKey:_0x1a3447}=this[_0x57c4e5(0x131)](),_0x2cd719=await database_1[_0x57c4e5(0x128)]['shop'][_0x57c4e5(0x144)]({'data':{'name':_0x3bb1d0,'username':_0x2710f7,'password':_0x3f0c6e,'telegram':_0x346716,'shopUrl':_0x22dbc7,'paymentGateways':_0x47085c?JSON['stringify'](_0x47085c):null,'gatewaySettings':_0x1dcced?JSON[_0x57c4e5(0x140)](_0x1dcced):null,'usdtPolygonWallet':_0x544fa4?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x544fa4?.[_0x57c4e5(0x139)]||null,'usdtErcWallet':_0x544fa4?.[_0x57c4e5(0x151)]||null,'usdcPolygonWallet':_0x544fa4?.['usdcPolygonWallet']||null,'publicKey':_0xd72ff8,'secretKey':_0x1a3447,'status':_0x57c4e5(0x15a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2cd719['id'],'fullName':_0x2cd719[_0x57c4e5(0x154)],'username':_0x2cd719['username'],'telegramId':_0x2cd719[_0x57c4e5(0x13a)],'merchantUrl':_0x2cd719['shopUrl'],'gateways':_0x2cd719['paymentGateways']?JSON[_0x57c4e5(0x15b)](_0x2cd719[_0x57c4e5(0x148)]):null,'gatewaySettings':_0x2cd719[_0x57c4e5(0x149)]?JSON[_0x57c4e5(0x15b)](_0x2cd719['gatewaySettings']):null,'publicKey':_0x2cd719['publicKey'],'wallets':{'usdtPolygonWallet':_0x2cd719[_0x57c4e5(0x138)],'usdtTrcWallet':_0x2cd719[_0x57c4e5(0x139)],'usdtErcWallet':_0x2cd719['usdtErcWallet'],'usdcPolygonWallet':_0x2cd719[_0x57c4e5(0x13c)]},'status':_0x2cd719['status'],'createdAt':_0x2cd719[_0x57c4e5(0x134)]};}async[a61_0x2f37ea(0x141)](){const _0x56a451=a61_0x2f37ea,_0x12d298=await database_1[_0x56a451(0x128)][_0x56a451(0x152)][_0x56a451(0x143)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x56a451(0x14a)}});return _0x12d298[_0x56a451(0x150)](_0x260ee1=>({'id':_0x260ee1['id'],'fullName':_0x260ee1[_0x56a451(0x154)],'username':_0x260ee1[_0x56a451(0x137)],'telegramId':_0x260ee1[_0x56a451(0x13a)],'merchantUrl':_0x260ee1['shopUrl'],'gateways':_0x260ee1[_0x56a451(0x148)]?JSON['parse'](_0x260ee1[_0x56a451(0x148)]):null,'gatewaySettings':_0x260ee1['gatewaySettings']?JSON[_0x56a451(0x15b)](_0x260ee1[_0x56a451(0x149)]):null,'publicKey':_0x260ee1['publicKey'],'wallets':{'usdtPolygonWallet':_0x260ee1[_0x56a451(0x138)],'usdtTrcWallet':_0x260ee1['usdtTrcWallet'],'usdtErcWallet':_0x260ee1[_0x56a451(0x151)],'usdcPolygonWallet':_0x260ee1['usdcPolygonWallet']},'status':_0x260ee1[_0x56a451(0x159)],'createdAt':_0x260ee1[_0x56a451(0x134)]}));}async['getUserById'](_0x387435){const _0x301416=a61_0x2f37ea,_0x43ebad=await database_1['default'][_0x301416(0x152)][_0x301416(0x146)]({'where':{'id':_0x387435},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x43ebad)return null;return{'id':_0x43ebad['id'],'fullName':_0x43ebad[_0x301416(0x154)],'username':_0x43ebad[_0x301416(0x137)],'telegramId':_0x43ebad['telegram'],'merchantUrl':_0x43ebad['shopUrl'],'gateways':_0x43ebad['paymentGateways']?JSON[_0x301416(0x15b)](_0x43ebad[_0x301416(0x148)]):null,'gatewaySettings':_0x43ebad[_0x301416(0x149)]?JSON[_0x301416(0x15b)](_0x43ebad[_0x301416(0x149)]):null,'publicKey':_0x43ebad['publicKey'],'wallets':{'usdtPolygonWallet':_0x43ebad['usdtPolygonWallet'],'usdtTrcWallet':_0x43ebad['usdtTrcWallet'],'usdtErcWallet':_0x43ebad['usdtErcWallet'],'usdcPolygonWallet':_0x43ebad['usdcPolygonWallet']},'status':_0x43ebad[_0x301416(0x159)],'createdAt':_0x43ebad['createdAt']};}async[a61_0x2f37ea(0x12d)](_0x5661b9,_0x1b65c1){const _0x1d1f0a=a61_0x2f37ea,_0x258420={..._0x1b65c1};_0x1b65c1[_0x1d1f0a(0x14b)]&&(_0x258420[_0x1d1f0a(0x14b)]=await bcryptjs_1[_0x1d1f0a(0x128)][_0x1d1f0a(0x158)](_0x1b65c1[_0x1d1f0a(0x14b)],0xc));_0x1b65c1[_0x1d1f0a(0x147)]&&(_0x258420[_0x1d1f0a(0x154)]=_0x1b65c1[_0x1d1f0a(0x147)],delete _0x258420[_0x1d1f0a(0x147)]);_0x1b65c1[_0x1d1f0a(0x12b)]&&(_0x258420['telegram']=_0x1b65c1[_0x1d1f0a(0x12b)],delete _0x258420[_0x1d1f0a(0x12b)]);_0x1b65c1[_0x1d1f0a(0x14e)]&&(_0x258420['shopUrl']=_0x1b65c1[_0x1d1f0a(0x14e)],delete _0x258420[_0x1d1f0a(0x14e)]);_0x1b65c1[_0x1d1f0a(0x133)]&&(_0x258420[_0x1d1f0a(0x148)]=JSON[_0x1d1f0a(0x140)](_0x1b65c1[_0x1d1f0a(0x133)]),delete _0x258420[_0x1d1f0a(0x133)]);_0x1b65c1[_0x1d1f0a(0x149)]&&(_0x258420[_0x1d1f0a(0x149)]=JSON[_0x1d1f0a(0x140)](_0x1b65c1['gatewaySettings']),delete _0x258420[_0x1d1f0a(0x149)]);_0x1b65c1[_0x1d1f0a(0x129)]&&(_0x1b65c1[_0x1d1f0a(0x129)]['usdtPolygonWallet']!==undefined&&(_0x258420['usdtPolygonWallet']=_0x1b65c1[_0x1d1f0a(0x129)]['usdtPolygonWallet']||null),_0x1b65c1[_0x1d1f0a(0x129)]['usdtTrcWallet']!==undefined&&(_0x258420[_0x1d1f0a(0x139)]=_0x1b65c1['wallets']['usdtTrcWallet']||null),_0x1b65c1[_0x1d1f0a(0x129)]['usdtErcWallet']!==undefined&&(_0x258420[_0x1d1f0a(0x151)]=_0x1b65c1['wallets'][_0x1d1f0a(0x151)]||null),_0x1b65c1['wallets'][_0x1d1f0a(0x13c)]!==undefined&&(_0x258420[_0x1d1f0a(0x13c)]=_0x1b65c1[_0x1d1f0a(0x129)][_0x1d1f0a(0x13c)]||null),delete _0x258420[_0x1d1f0a(0x129)]);const _0x1210d4=await database_1[_0x1d1f0a(0x128)][_0x1d1f0a(0x152)][_0x1d1f0a(0x12e)]({'where':{'id':_0x5661b9},'data':_0x258420,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1210d4['id'],'fullName':_0x1210d4[_0x1d1f0a(0x154)],'username':_0x1210d4[_0x1d1f0a(0x137)],'telegramId':_0x1210d4[_0x1d1f0a(0x13a)],'merchantUrl':_0x1210d4[_0x1d1f0a(0x13b)],'gateways':_0x1210d4[_0x1d1f0a(0x148)]?JSON[_0x1d1f0a(0x15b)](_0x1210d4[_0x1d1f0a(0x148)]):null,'gatewaySettings':_0x1210d4['gatewaySettings']?JSON[_0x1d1f0a(0x15b)](_0x1210d4['gatewaySettings']):null,'publicKey':_0x1210d4['publicKey'],'wallets':{'usdtPolygonWallet':_0x1210d4[_0x1d1f0a(0x138)],'usdtTrcWallet':_0x1210d4[_0x1d1f0a(0x139)],'usdtErcWallet':_0x1210d4[_0x1d1f0a(0x151)],'usdcPolygonWallet':_0x1210d4[_0x1d1f0a(0x13c)]},'status':_0x1210d4[_0x1d1f0a(0x159)],'createdAt':_0x1210d4['createdAt']};}async[a61_0x2f37ea(0x142)](_0x23c551){const _0x1474ce=a61_0x2f37ea;await database_1[_0x1474ce(0x128)][_0x1474ce(0x152)][_0x1474ce(0x132)]({'where':{'id':_0x23c551}});}}exports[a61_0x2f37ea(0x136)]=UserService;