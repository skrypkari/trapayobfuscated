'use strict';const a57_0x1636b3=a57_0x4478;function a57_0xa49d(){const _0x2ea8fd=['findUnique','gateways','delete','2133126IDhaKA','status','bcryptjs','usdcPolygonWallet','findMany','merchantUrl','telegram','../config/database','shopUrl','stringify','UserService','1307793cinraR','toString','usdtPolygonWallet','desc','getAllUsers','createUser','__esModule','Username\x20already\x20exists','generateApiKeys','shop','name','paymentGateways','publicKey','413728zuXTSx','password','fullName','1701000EnfERU','defineProperty','1252315GQbUyi','23802XjDXGq','getUserById','username','usdtTrcWallet','hash','updateUser','ACTIVE','pk_','deleteUser','createdAt','wallets','usdtErcWallet','default','__importDefault','parse','create','1PYTJiS','320066WeNGsq','telegramId','497DFXYbR','map','randomBytes','hex','gatewaySettings'];a57_0xa49d=function(){return _0x2ea8fd;};return a57_0xa49d();}(function(_0x4b78b9,_0x1b0eb7){const _0x5b7482=a57_0x4478,_0xebcb7f=_0x4b78b9();while(!![]){try{const _0x4f5692=-parseInt(_0x5b7482(0xdb))/0x1*(-parseInt(_0x5b7482(0xdc))/0x2)+parseInt(_0x5b7482(0xb8))/0x3+parseInt(_0x5b7482(0xc5))/0x4+parseInt(_0x5b7482(0xca))/0x5+parseInt(_0x5b7482(0xcb))/0x6*(-parseInt(_0x5b7482(0xde))/0x7)+-parseInt(_0x5b7482(0xc8))/0x8+-parseInt(_0x5b7482(0xe6))/0x9;if(_0x4f5692===_0x1b0eb7)break;else _0xebcb7f['push'](_0xebcb7f['shift']());}catch(_0x209d9d){_0xebcb7f['push'](_0xebcb7f['shift']());}}}(a57_0xa49d,0x355c3));function a57_0x4478(_0x35571c,_0x4ba4f7){const _0xa49d4b=a57_0xa49d();return a57_0x4478=function(_0x447898,_0x4e0910){_0x447898=_0x447898-0xaf;let _0x7863b3=_0xa49d4b[_0x447898];return _0x7863b3;},a57_0x4478(_0x35571c,_0x4ba4f7);}var __importDefault=this&&this[a57_0x1636b3(0xd8)]||function(_0x6d4fd5){const _0x3a0fa3=a57_0x1636b3;return _0x6d4fd5&&_0x6d4fd5[_0x3a0fa3(0xbe)]?_0x6d4fd5:{'default':_0x6d4fd5};};Object[a57_0x1636b3(0xc9)](exports,a57_0x1636b3(0xbe),{'value':!![]}),exports[a57_0x1636b3(0xb7)]=void 0x0;const bcryptjs_1=__importDefault(require(a57_0x1636b3(0xaf))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a57_0x1636b3(0xb4)));class UserService{[a57_0x1636b3(0xc0)](){const _0x690d67=a57_0x1636b3,_0x127253=_0x690d67(0xd2)+crypto_1['default'][_0x690d67(0xe0)](0x20)[_0x690d67(0xb9)](_0x690d67(0xe1)),_0x1448d6='sk_'+crypto_1[_0x690d67(0xd7)]['randomBytes'](0x20)[_0x690d67(0xb9)](_0x690d67(0xe1));return{'publicKey':_0x127253,'secretKey':_0x1448d6};}async[a57_0x1636b3(0xbd)](_0x3f703e){const _0x37fb94=a57_0x1636b3,{fullName:_0x43da15,username:_0x28031b,password:_0x4bdb2d,telegramId:_0x56bd02,merchantUrl:_0x4b9065,gateways:_0x542f08,gatewaySettings:_0x5366f5,wallets:_0x5303e7}=_0x3f703e,_0x410e73=await database_1[_0x37fb94(0xd7)][_0x37fb94(0xc1)][_0x37fb94(0xe3)]({'where':{'username':_0x28031b}});if(_0x410e73)throw new Error(_0x37fb94(0xbf));if(_0x56bd02){const _0x71d9bf=await database_1['default']['shop'][_0x37fb94(0xe3)]({'where':{'telegram':_0x56bd02}});if(_0x71d9bf)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x50cad2=await bcryptjs_1['default'][_0x37fb94(0xcf)](_0x4bdb2d,0xc),{publicKey:_0x37717a,secretKey:_0x40277f}=this[_0x37fb94(0xc0)](),_0x27e913=await database_1[_0x37fb94(0xd7)][_0x37fb94(0xc1)][_0x37fb94(0xda)]({'data':{'name':_0x43da15,'username':_0x28031b,'password':_0x50cad2,'telegram':_0x56bd02,'shopUrl':_0x4b9065,'paymentGateways':_0x542f08?JSON[_0x37fb94(0xb6)](_0x542f08):null,'gatewaySettings':_0x5366f5?JSON[_0x37fb94(0xb6)](_0x5366f5):null,'usdtPolygonWallet':_0x5303e7?.[_0x37fb94(0xba)]||null,'usdtTrcWallet':_0x5303e7?.[_0x37fb94(0xce)]||null,'usdtErcWallet':_0x5303e7?.[_0x37fb94(0xd6)]||null,'usdcPolygonWallet':_0x5303e7?.[_0x37fb94(0xb0)]||null,'publicKey':_0x37717a,'secretKey':_0x40277f,'status':_0x37fb94(0xd1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x27e913['id'],'fullName':_0x27e913[_0x37fb94(0xc2)],'username':_0x27e913['username'],'telegramId':_0x27e913[_0x37fb94(0xb3)],'merchantUrl':_0x27e913[_0x37fb94(0xb5)],'gateways':_0x27e913[_0x37fb94(0xc3)]?JSON[_0x37fb94(0xd9)](_0x27e913[_0x37fb94(0xc3)]):null,'gatewaySettings':_0x27e913[_0x37fb94(0xe2)]?JSON[_0x37fb94(0xd9)](_0x27e913[_0x37fb94(0xe2)]):null,'publicKey':_0x27e913['publicKey'],'wallets':{'usdtPolygonWallet':_0x27e913['usdtPolygonWallet'],'usdtTrcWallet':_0x27e913[_0x37fb94(0xce)],'usdtErcWallet':_0x27e913[_0x37fb94(0xd6)],'usdcPolygonWallet':_0x27e913[_0x37fb94(0xb0)]},'status':_0x27e913[_0x37fb94(0xe7)],'createdAt':_0x27e913[_0x37fb94(0xd4)]};}async[a57_0x1636b3(0xbc)](){const _0x21064f=a57_0x1636b3,_0xfbbc04=await database_1[_0x21064f(0xd7)]['shop'][_0x21064f(0xb1)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x21064f(0xbb)}});return _0xfbbc04[_0x21064f(0xdf)](_0xa1aad1=>({'id':_0xa1aad1['id'],'fullName':_0xa1aad1[_0x21064f(0xc2)],'username':_0xa1aad1['username'],'telegramId':_0xa1aad1['telegram'],'merchantUrl':_0xa1aad1[_0x21064f(0xb5)],'gateways':_0xa1aad1[_0x21064f(0xc3)]?JSON[_0x21064f(0xd9)](_0xa1aad1[_0x21064f(0xc3)]):null,'gatewaySettings':_0xa1aad1[_0x21064f(0xe2)]?JSON['parse'](_0xa1aad1['gatewaySettings']):null,'publicKey':_0xa1aad1[_0x21064f(0xc4)],'wallets':{'usdtPolygonWallet':_0xa1aad1['usdtPolygonWallet'],'usdtTrcWallet':_0xa1aad1[_0x21064f(0xce)],'usdtErcWallet':_0xa1aad1[_0x21064f(0xd6)],'usdcPolygonWallet':_0xa1aad1[_0x21064f(0xb0)]},'status':_0xa1aad1[_0x21064f(0xe7)],'createdAt':_0xa1aad1[_0x21064f(0xd4)]}));}async[a57_0x1636b3(0xcc)](_0x4f76d3){const _0x4192d4=a57_0x1636b3,_0x2212ca=await database_1[_0x4192d4(0xd7)][_0x4192d4(0xc1)][_0x4192d4(0xe3)]({'where':{'id':_0x4f76d3},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2212ca)return null;return{'id':_0x2212ca['id'],'fullName':_0x2212ca[_0x4192d4(0xc2)],'username':_0x2212ca[_0x4192d4(0xcd)],'telegramId':_0x2212ca['telegram'],'merchantUrl':_0x2212ca['shopUrl'],'gateways':_0x2212ca['paymentGateways']?JSON[_0x4192d4(0xd9)](_0x2212ca[_0x4192d4(0xc3)]):null,'gatewaySettings':_0x2212ca[_0x4192d4(0xe2)]?JSON[_0x4192d4(0xd9)](_0x2212ca[_0x4192d4(0xe2)]):null,'publicKey':_0x2212ca[_0x4192d4(0xc4)],'wallets':{'usdtPolygonWallet':_0x2212ca['usdtPolygonWallet'],'usdtTrcWallet':_0x2212ca['usdtTrcWallet'],'usdtErcWallet':_0x2212ca[_0x4192d4(0xd6)],'usdcPolygonWallet':_0x2212ca[_0x4192d4(0xb0)]},'status':_0x2212ca[_0x4192d4(0xe7)],'createdAt':_0x2212ca['createdAt']};}async[a57_0x1636b3(0xd0)](_0xf8760a,_0x29a609){const _0x962dca=a57_0x1636b3,_0x2b2efc={..._0x29a609};_0x29a609['password']&&(_0x2b2efc[_0x962dca(0xc6)]=await bcryptjs_1['default'][_0x962dca(0xcf)](_0x29a609[_0x962dca(0xc6)],0xc));_0x29a609[_0x962dca(0xc7)]&&(_0x2b2efc[_0x962dca(0xc2)]=_0x29a609[_0x962dca(0xc7)],delete _0x2b2efc[_0x962dca(0xc7)]);_0x29a609[_0x962dca(0xdd)]&&(_0x2b2efc[_0x962dca(0xb3)]=_0x29a609[_0x962dca(0xdd)],delete _0x2b2efc[_0x962dca(0xdd)]);_0x29a609[_0x962dca(0xb2)]&&(_0x2b2efc[_0x962dca(0xb5)]=_0x29a609['merchantUrl'],delete _0x2b2efc[_0x962dca(0xb2)]);_0x29a609[_0x962dca(0xe4)]&&(_0x2b2efc[_0x962dca(0xc3)]=JSON[_0x962dca(0xb6)](_0x29a609[_0x962dca(0xe4)]),delete _0x2b2efc[_0x962dca(0xe4)]);_0x29a609[_0x962dca(0xe2)]&&(_0x2b2efc[_0x962dca(0xe2)]=JSON[_0x962dca(0xb6)](_0x29a609[_0x962dca(0xe2)]),delete _0x2b2efc[_0x962dca(0xe2)]);_0x29a609['wallets']&&(_0x29a609[_0x962dca(0xd5)][_0x962dca(0xba)]!==undefined&&(_0x2b2efc[_0x962dca(0xba)]=_0x29a609[_0x962dca(0xd5)]['usdtPolygonWallet']||null),_0x29a609[_0x962dca(0xd5)][_0x962dca(0xce)]!==undefined&&(_0x2b2efc['usdtTrcWallet']=_0x29a609['wallets'][_0x962dca(0xce)]||null),_0x29a609[_0x962dca(0xd5)][_0x962dca(0xd6)]!==undefined&&(_0x2b2efc[_0x962dca(0xd6)]=_0x29a609[_0x962dca(0xd5)][_0x962dca(0xd6)]||null),_0x29a609[_0x962dca(0xd5)][_0x962dca(0xb0)]!==undefined&&(_0x2b2efc[_0x962dca(0xb0)]=_0x29a609['wallets']['usdcPolygonWallet']||null),delete _0x2b2efc[_0x962dca(0xd5)]);const _0x4bf978=await database_1[_0x962dca(0xd7)][_0x962dca(0xc1)]['update']({'where':{'id':_0xf8760a},'data':_0x2b2efc,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4bf978['id'],'fullName':_0x4bf978[_0x962dca(0xc2)],'username':_0x4bf978[_0x962dca(0xcd)],'telegramId':_0x4bf978[_0x962dca(0xb3)],'merchantUrl':_0x4bf978[_0x962dca(0xb5)],'gateways':_0x4bf978[_0x962dca(0xc3)]?JSON['parse'](_0x4bf978[_0x962dca(0xc3)]):null,'gatewaySettings':_0x4bf978[_0x962dca(0xe2)]?JSON[_0x962dca(0xd9)](_0x4bf978[_0x962dca(0xe2)]):null,'publicKey':_0x4bf978[_0x962dca(0xc4)],'wallets':{'usdtPolygonWallet':_0x4bf978[_0x962dca(0xba)],'usdtTrcWallet':_0x4bf978[_0x962dca(0xce)],'usdtErcWallet':_0x4bf978['usdtErcWallet'],'usdcPolygonWallet':_0x4bf978['usdcPolygonWallet']},'status':_0x4bf978[_0x962dca(0xe7)],'createdAt':_0x4bf978[_0x962dca(0xd4)]};}async[a57_0x1636b3(0xd3)](_0x44403e){const _0x2175ee=a57_0x1636b3;await database_1[_0x2175ee(0xd7)][_0x2175ee(0xc1)][_0x2175ee(0xe5)]({'where':{'id':_0x44403e}});}}exports[a57_0x1636b3(0xb7)]=UserService;