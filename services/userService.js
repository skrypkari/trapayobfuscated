'use strict';const a80_0xdf89ae=a80_0x2977;(function(_0xa49213,_0x4e2b39){const _0x6d8492=a80_0x2977,_0x442b2a=_0xa49213();while(!![]){try{const _0x1cbba5=parseInt(_0x6d8492(0x14d))/0x1+parseInt(_0x6d8492(0x147))/0x2+parseInt(_0x6d8492(0x144))/0x3+parseInt(_0x6d8492(0x160))/0x4+-parseInt(_0x6d8492(0x167))/0x5*(-parseInt(_0x6d8492(0x15b))/0x6)+-parseInt(_0x6d8492(0x13e))/0x7+parseInt(_0x6d8492(0x145))/0x8*(-parseInt(_0x6d8492(0x14b))/0x9);if(_0x1cbba5===_0x4e2b39)break;else _0x442b2a['push'](_0x442b2a['shift']());}catch(_0x53a572){_0x442b2a['push'](_0x442b2a['shift']());}}}(a80_0x3d84,0x309c0));function a80_0x2977(_0x512a36,_0x36d095){_0x512a36=_0x512a36-0x13e;const _0x3d84c7=a80_0x3d84();let _0x29779c=_0x3d84c7[_0x512a36];return _0x29779c;}var __importDefault=this&&this['__importDefault']||function(_0x154b74){const _0x3f518d=a80_0x2977;return _0x154b74&&_0x154b74[_0x3f518d(0x157)]?_0x154b74:{'default':_0x154b74};};function a80_0x3d84(){const _0x3dcc6e=['defineProperty','usdtTrcWallet','telegram','merchantUrl','deleteUser','1184892BWCbHE','4618704keIvWs','username','229974RLSaKl','UserService','default','sk_','9KLiYMA','stringify','59046VNvkNQ','delete','usdcPolygonWallet','wallets','paymentGateways','shopUrl','findUnique','getUserById','toString','gateways','__esModule','usdtPolygonWallet','create','findMany','78PiVlRL','usdtErcWallet','fullName','../config/database','gatewaySettings','836916aieDxH','update','randomBytes','getAllUsers','shop','hash','name','87085xpxkRQ','telegramId','pk_','hex','parse','crypto','password','publicKey','createdAt','status','1597435qaNAwO'];a80_0x3d84=function(){return _0x3dcc6e;};return a80_0x3d84();}Object[a80_0xdf89ae(0x13f)](exports,'__esModule',{'value':!![]}),exports[a80_0xdf89ae(0x148)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a80_0xdf89ae(0x16c))),database_1=__importDefault(require(a80_0xdf89ae(0x15e)));class UserService{['generateApiKeys'](){const _0x4a4939=a80_0xdf89ae,_0x2ccfc9=_0x4a4939(0x169)+crypto_1[_0x4a4939(0x149)][_0x4a4939(0x162)](0x20)[_0x4a4939(0x155)](_0x4a4939(0x16a)),_0x3dd2b2=_0x4a4939(0x14a)+crypto_1['default']['randomBytes'](0x20)[_0x4a4939(0x155)](_0x4a4939(0x16a));return{'publicKey':_0x2ccfc9,'secretKey':_0x3dd2b2};}async['createUser'](_0x29ffdb){const _0x423e6d=a80_0xdf89ae,{fullName:_0x239b4c,username:_0x3c1e02,password:_0x5d4239,telegramId:_0x19e698,merchantUrl:_0x3444ee,gateways:_0x4fad8a,gatewaySettings:_0x3c816d,wallets:_0x338268}=_0x29ffdb,_0x5f33c2=await database_1[_0x423e6d(0x149)][_0x423e6d(0x164)][_0x423e6d(0x153)]({'where':{'username':_0x3c1e02}});if(_0x5f33c2)throw new Error('Username\x20already\x20exists');if(_0x19e698){const _0x561913=await database_1[_0x423e6d(0x149)][_0x423e6d(0x164)][_0x423e6d(0x153)]({'where':{'telegram':_0x19e698}});if(_0x561913)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x1a104a=await bcryptjs_1[_0x423e6d(0x149)][_0x423e6d(0x165)](_0x5d4239,0xc),{publicKey:_0x40ba60,secretKey:_0x315910}=this['generateApiKeys'](),_0x29a710=await database_1['default']['shop'][_0x423e6d(0x159)]({'data':{'name':_0x239b4c,'username':_0x3c1e02,'password':_0x1a104a,'telegram':_0x19e698,'shopUrl':_0x3444ee,'paymentGateways':_0x4fad8a?JSON[_0x423e6d(0x14c)](_0x4fad8a):null,'gatewaySettings':_0x3c816d?JSON[_0x423e6d(0x14c)](_0x3c816d):null,'usdtPolygonWallet':_0x338268?.[_0x423e6d(0x158)]||null,'usdtTrcWallet':_0x338268?.[_0x423e6d(0x140)]||null,'usdtErcWallet':_0x338268?.[_0x423e6d(0x15c)]||null,'usdcPolygonWallet':_0x338268?.[_0x423e6d(0x14f)]||null,'publicKey':_0x40ba60,'secretKey':_0x315910,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x29a710['id'],'fullName':_0x29a710[_0x423e6d(0x166)],'username':_0x29a710[_0x423e6d(0x146)],'telegramId':_0x29a710['telegram'],'merchantUrl':_0x29a710[_0x423e6d(0x152)],'gateways':_0x29a710[_0x423e6d(0x151)]?JSON['parse'](_0x29a710[_0x423e6d(0x151)]):null,'gatewaySettings':_0x29a710['gatewaySettings']?JSON[_0x423e6d(0x16b)](_0x29a710['gatewaySettings']):null,'publicKey':_0x29a710['publicKey'],'wallets':{'usdtPolygonWallet':_0x29a710[_0x423e6d(0x158)],'usdtTrcWallet':_0x29a710[_0x423e6d(0x140)],'usdtErcWallet':_0x29a710['usdtErcWallet'],'usdcPolygonWallet':_0x29a710[_0x423e6d(0x14f)]},'status':_0x29a710[_0x423e6d(0x170)],'createdAt':_0x29a710[_0x423e6d(0x16f)]};}async[a80_0xdf89ae(0x163)](){const _0x124156=a80_0xdf89ae,_0x1c98ff=await database_1[_0x124156(0x149)][_0x124156(0x164)][_0x124156(0x15a)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':'desc'}});return _0x1c98ff['map'](_0x4be9d5=>({'id':_0x4be9d5['id'],'fullName':_0x4be9d5['name'],'username':_0x4be9d5['username'],'telegramId':_0x4be9d5[_0x124156(0x141)],'merchantUrl':_0x4be9d5[_0x124156(0x152)],'gateways':_0x4be9d5['paymentGateways']?JSON[_0x124156(0x16b)](_0x4be9d5[_0x124156(0x151)]):null,'gatewaySettings':_0x4be9d5['gatewaySettings']?JSON[_0x124156(0x16b)](_0x4be9d5[_0x124156(0x15f)]):null,'publicKey':_0x4be9d5[_0x124156(0x16e)],'wallets':{'usdtPolygonWallet':_0x4be9d5['usdtPolygonWallet'],'usdtTrcWallet':_0x4be9d5[_0x124156(0x140)],'usdtErcWallet':_0x4be9d5[_0x124156(0x15c)],'usdcPolygonWallet':_0x4be9d5[_0x124156(0x14f)]},'status':_0x4be9d5[_0x124156(0x170)],'createdAt':_0x4be9d5['createdAt']}));}async[a80_0xdf89ae(0x154)](_0xaf4b3f){const _0x98e533=a80_0xdf89ae,_0xca32ba=await database_1[_0x98e533(0x149)][_0x98e533(0x164)][_0x98e533(0x153)]({'where':{'id':_0xaf4b3f},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xca32ba)return null;return{'id':_0xca32ba['id'],'fullName':_0xca32ba[_0x98e533(0x166)],'username':_0xca32ba[_0x98e533(0x146)],'telegramId':_0xca32ba[_0x98e533(0x141)],'merchantUrl':_0xca32ba[_0x98e533(0x152)],'gateways':_0xca32ba[_0x98e533(0x151)]?JSON['parse'](_0xca32ba[_0x98e533(0x151)]):null,'gatewaySettings':_0xca32ba[_0x98e533(0x15f)]?JSON['parse'](_0xca32ba[_0x98e533(0x15f)]):null,'publicKey':_0xca32ba[_0x98e533(0x16e)],'wallets':{'usdtPolygonWallet':_0xca32ba['usdtPolygonWallet'],'usdtTrcWallet':_0xca32ba[_0x98e533(0x140)],'usdtErcWallet':_0xca32ba[_0x98e533(0x15c)],'usdcPolygonWallet':_0xca32ba[_0x98e533(0x14f)]},'status':_0xca32ba[_0x98e533(0x170)],'createdAt':_0xca32ba[_0x98e533(0x16f)]};}async['updateUser'](_0xc255ea,_0x3246b5){const _0x2c325b=a80_0xdf89ae,_0x5be6ef={..._0x3246b5};_0x3246b5[_0x2c325b(0x16d)]&&(_0x5be6ef['password']=await bcryptjs_1[_0x2c325b(0x149)][_0x2c325b(0x165)](_0x3246b5['password'],0xc));_0x3246b5[_0x2c325b(0x15d)]&&(_0x5be6ef[_0x2c325b(0x166)]=_0x3246b5[_0x2c325b(0x15d)],delete _0x5be6ef['fullName']);_0x3246b5[_0x2c325b(0x168)]&&(_0x5be6ef['telegram']=_0x3246b5[_0x2c325b(0x168)],delete _0x5be6ef[_0x2c325b(0x168)]);_0x3246b5['merchantUrl']&&(_0x5be6ef[_0x2c325b(0x152)]=_0x3246b5[_0x2c325b(0x142)],delete _0x5be6ef[_0x2c325b(0x142)]);_0x3246b5['gateways']&&(_0x5be6ef[_0x2c325b(0x151)]=JSON[_0x2c325b(0x14c)](_0x3246b5[_0x2c325b(0x156)]),delete _0x5be6ef[_0x2c325b(0x156)]);_0x3246b5[_0x2c325b(0x15f)]&&(_0x5be6ef['gatewaySettings']=JSON[_0x2c325b(0x14c)](_0x3246b5['gatewaySettings']),delete _0x5be6ef[_0x2c325b(0x15f)]);_0x3246b5['wallets']&&(_0x3246b5[_0x2c325b(0x150)][_0x2c325b(0x158)]!==undefined&&(_0x5be6ef['usdtPolygonWallet']=_0x3246b5['wallets'][_0x2c325b(0x158)]||null),_0x3246b5[_0x2c325b(0x150)][_0x2c325b(0x140)]!==undefined&&(_0x5be6ef[_0x2c325b(0x140)]=_0x3246b5[_0x2c325b(0x150)]['usdtTrcWallet']||null),_0x3246b5[_0x2c325b(0x150)]['usdtErcWallet']!==undefined&&(_0x5be6ef['usdtErcWallet']=_0x3246b5[_0x2c325b(0x150)]['usdtErcWallet']||null),_0x3246b5[_0x2c325b(0x150)][_0x2c325b(0x14f)]!==undefined&&(_0x5be6ef['usdcPolygonWallet']=_0x3246b5[_0x2c325b(0x150)][_0x2c325b(0x14f)]||null),delete _0x5be6ef[_0x2c325b(0x150)]);const _0x4c44a0=await database_1[_0x2c325b(0x149)][_0x2c325b(0x164)][_0x2c325b(0x161)]({'where':{'id':_0xc255ea},'data':_0x5be6ef,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4c44a0['id'],'fullName':_0x4c44a0[_0x2c325b(0x166)],'username':_0x4c44a0[_0x2c325b(0x146)],'telegramId':_0x4c44a0['telegram'],'merchantUrl':_0x4c44a0[_0x2c325b(0x152)],'gateways':_0x4c44a0[_0x2c325b(0x151)]?JSON[_0x2c325b(0x16b)](_0x4c44a0[_0x2c325b(0x151)]):null,'gatewaySettings':_0x4c44a0[_0x2c325b(0x15f)]?JSON[_0x2c325b(0x16b)](_0x4c44a0[_0x2c325b(0x15f)]):null,'publicKey':_0x4c44a0[_0x2c325b(0x16e)],'wallets':{'usdtPolygonWallet':_0x4c44a0[_0x2c325b(0x158)],'usdtTrcWallet':_0x4c44a0[_0x2c325b(0x140)],'usdtErcWallet':_0x4c44a0[_0x2c325b(0x15c)],'usdcPolygonWallet':_0x4c44a0[_0x2c325b(0x14f)]},'status':_0x4c44a0['status'],'createdAt':_0x4c44a0[_0x2c325b(0x16f)]};}async[a80_0xdf89ae(0x143)](_0x171377){const _0x354e16=a80_0xdf89ae;await database_1[_0x354e16(0x149)][_0x354e16(0x164)][_0x354e16(0x14e)]({'where':{'id':_0x171377}});}}exports[a80_0xdf89ae(0x148)]=UserService;