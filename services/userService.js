'use strict';function a76_0x4142(){const _0xd18c74=['shop','usdtTrcWallet','parse','1035522FUaARj','update','paymentGateways','delete','createdAt','4105310zyWgdP','stringify','usdtErcWallet','wallets','2159072jefgdC','hex','Username\x20already\x20exists','usdtPolygonWallet','shopUrl','5mubQjw','UserService','usdcPolygonWallet','password','5419000YPdWmV','name','toString','telegramId','randomBytes','findUnique','sk_','4230cBRceO','deleteUser','fullName','11725nZOsXu','hash','183915DVHIwn','username','createUser','generateApiKeys','default','gateways','status','40NCcpKZ','4FtgNTh','Telegram\x20username\x20already\x20exists','109034vwIYlv','__esModule','getAllUsers','__importDefault','bcryptjs','telegram','gatewaySettings','publicKey','merchantUrl'];a76_0x4142=function(){return _0xd18c74;};return a76_0x4142();}const a76_0x1f39a8=a76_0x7574;(function(_0x38d033,_0x344e96){const _0x19a2be=a76_0x7574,_0x4fffaf=_0x38d033();while(!![]){try{const _0x72c80e=-parseInt(_0x19a2be(0x1a8))/0x1+parseInt(_0x19a2be(0x1a6))/0x2*(-parseInt(_0x19a2be(0x19e))/0x3)+-parseInt(_0x19a2be(0x1bd))/0x4*(parseInt(_0x19a2be(0x1c2))/0x5)+parseInt(_0x19a2be(0x199))/0x6*(parseInt(_0x19a2be(0x19c))/0x7)+-parseInt(_0x19a2be(0x1a5))/0x8*(parseInt(_0x19a2be(0x1b4))/0x9)+parseInt(_0x19a2be(0x1c6))/0xa+parseInt(_0x19a2be(0x1b9))/0xb;if(_0x72c80e===_0x344e96)break;else _0x4fffaf['push'](_0x4fffaf['shift']());}catch(_0x1e1da3){_0x4fffaf['push'](_0x4fffaf['shift']());}}}(a76_0x4142,0xb6ee3));var __importDefault=this&&this[a76_0x1f39a8(0x1ab)]||function(_0x12b52c){return _0x12b52c&&_0x12b52c['__esModule']?_0x12b52c:{'default':_0x12b52c};};function a76_0x7574(_0x3089de,_0x537be7){_0x3089de=_0x3089de-0x197;const _0x41426a=a76_0x4142();let _0x757474=_0x41426a[_0x3089de];return _0x757474;}Object['defineProperty'](exports,a76_0x1f39a8(0x1a9),{'value':!![]}),exports[a76_0x1f39a8(0x1c3)]=void 0x0;const bcryptjs_1=__importDefault(require(a76_0x1f39a8(0x1ac))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));class UserService{[a76_0x1f39a8(0x1a1)](){const _0x43048c=a76_0x1f39a8,_0xcb9dc9='pk_'+crypto_1[_0x43048c(0x1a2)]['randomBytes'](0x20)['toString'](_0x43048c(0x1be)),_0x16aa9b=_0x43048c(0x198)+crypto_1[_0x43048c(0x1a2)][_0x43048c(0x1ca)](0x20)[_0x43048c(0x1c8)]('hex');return{'publicKey':_0xcb9dc9,'secretKey':_0x16aa9b};}async[a76_0x1f39a8(0x1a0)](_0x4d40bd){const _0x191f5c=a76_0x1f39a8,{fullName:_0x3e9a8e,username:_0x31232e,password:_0x5cd214,telegramId:_0x3c53b4,merchantUrl:_0x374438,gateways:_0x1cf145,gatewaySettings:_0x28bb03,wallets:_0x1c59c1}=_0x4d40bd,_0x31c093=await database_1[_0x191f5c(0x1a2)]['shop'][_0x191f5c(0x197)]({'where':{'username':_0x31232e}});if(_0x31c093)throw new Error(_0x191f5c(0x1bf));if(_0x3c53b4){const _0x5b0954=await database_1['default'][_0x191f5c(0x1b1)][_0x191f5c(0x197)]({'where':{'telegram':_0x3c53b4}});if(_0x5b0954)throw new Error(_0x191f5c(0x1a7));}const _0x39a876=await bcryptjs_1[_0x191f5c(0x1a2)][_0x191f5c(0x19d)](_0x5cd214,0xc),{publicKey:_0x558aad,secretKey:_0xec649e}=this[_0x191f5c(0x1a1)](),_0x2c6b0b=await database_1['default'][_0x191f5c(0x1b1)]['create']({'data':{'name':_0x3e9a8e,'username':_0x31232e,'password':_0x39a876,'telegram':_0x3c53b4,'shopUrl':_0x374438,'paymentGateways':_0x1cf145?JSON['stringify'](_0x1cf145):null,'gatewaySettings':_0x28bb03?JSON[_0x191f5c(0x1ba)](_0x28bb03):null,'usdtPolygonWallet':_0x1c59c1?.[_0x191f5c(0x1c0)]||null,'usdtTrcWallet':_0x1c59c1?.[_0x191f5c(0x1b2)]||null,'usdtErcWallet':_0x1c59c1?.[_0x191f5c(0x1bb)]||null,'usdcPolygonWallet':_0x1c59c1?.[_0x191f5c(0x1c4)]||null,'publicKey':_0x558aad,'secretKey':_0xec649e,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2c6b0b['id'],'fullName':_0x2c6b0b[_0x191f5c(0x1c7)],'username':_0x2c6b0b[_0x191f5c(0x19f)],'telegramId':_0x2c6b0b[_0x191f5c(0x1ad)],'merchantUrl':_0x2c6b0b[_0x191f5c(0x1c1)],'gateways':_0x2c6b0b[_0x191f5c(0x1b6)]?JSON[_0x191f5c(0x1b3)](_0x2c6b0b[_0x191f5c(0x1b6)]):null,'gatewaySettings':_0x2c6b0b[_0x191f5c(0x1ae)]?JSON['parse'](_0x2c6b0b['gatewaySettings']):null,'publicKey':_0x2c6b0b[_0x191f5c(0x1af)],'wallets':{'usdtPolygonWallet':_0x2c6b0b[_0x191f5c(0x1c0)],'usdtTrcWallet':_0x2c6b0b['usdtTrcWallet'],'usdtErcWallet':_0x2c6b0b[_0x191f5c(0x1bb)],'usdcPolygonWallet':_0x2c6b0b[_0x191f5c(0x1c4)]},'status':_0x2c6b0b[_0x191f5c(0x1a4)],'createdAt':_0x2c6b0b[_0x191f5c(0x1b8)]};}async[a76_0x1f39a8(0x1aa)](){const _0xdd1dfb=a76_0x1f39a8,_0x3b252b=await database_1['default'][_0xdd1dfb(0x1b1)]['findMany']({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':'desc'}});return _0x3b252b['map'](_0x15d9b9=>({'id':_0x15d9b9['id'],'fullName':_0x15d9b9[_0xdd1dfb(0x1c7)],'username':_0x15d9b9[_0xdd1dfb(0x19f)],'telegramId':_0x15d9b9[_0xdd1dfb(0x1ad)],'merchantUrl':_0x15d9b9['shopUrl'],'gateways':_0x15d9b9[_0xdd1dfb(0x1b6)]?JSON[_0xdd1dfb(0x1b3)](_0x15d9b9[_0xdd1dfb(0x1b6)]):null,'gatewaySettings':_0x15d9b9[_0xdd1dfb(0x1ae)]?JSON['parse'](_0x15d9b9[_0xdd1dfb(0x1ae)]):null,'publicKey':_0x15d9b9[_0xdd1dfb(0x1af)],'wallets':{'usdtPolygonWallet':_0x15d9b9[_0xdd1dfb(0x1c0)],'usdtTrcWallet':_0x15d9b9['usdtTrcWallet'],'usdtErcWallet':_0x15d9b9['usdtErcWallet'],'usdcPolygonWallet':_0x15d9b9[_0xdd1dfb(0x1c4)]},'status':_0x15d9b9['status'],'createdAt':_0x15d9b9[_0xdd1dfb(0x1b8)]}));}async['getUserById'](_0x22b3a8){const _0x513f22=a76_0x1f39a8,_0x16acac=await database_1[_0x513f22(0x1a2)][_0x513f22(0x1b1)][_0x513f22(0x197)]({'where':{'id':_0x22b3a8},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x16acac)return null;return{'id':_0x16acac['id'],'fullName':_0x16acac[_0x513f22(0x1c7)],'username':_0x16acac[_0x513f22(0x19f)],'telegramId':_0x16acac[_0x513f22(0x1ad)],'merchantUrl':_0x16acac['shopUrl'],'gateways':_0x16acac[_0x513f22(0x1b6)]?JSON[_0x513f22(0x1b3)](_0x16acac[_0x513f22(0x1b6)]):null,'gatewaySettings':_0x16acac[_0x513f22(0x1ae)]?JSON[_0x513f22(0x1b3)](_0x16acac['gatewaySettings']):null,'publicKey':_0x16acac[_0x513f22(0x1af)],'wallets':{'usdtPolygonWallet':_0x16acac['usdtPolygonWallet'],'usdtTrcWallet':_0x16acac[_0x513f22(0x1b2)],'usdtErcWallet':_0x16acac[_0x513f22(0x1bb)],'usdcPolygonWallet':_0x16acac[_0x513f22(0x1c4)]},'status':_0x16acac[_0x513f22(0x1a4)],'createdAt':_0x16acac[_0x513f22(0x1b8)]};}async['updateUser'](_0x57c888,_0x111c9a){const _0x372294=a76_0x1f39a8,_0x4935c2={..._0x111c9a};_0x111c9a[_0x372294(0x1c5)]&&(_0x4935c2['password']=await bcryptjs_1[_0x372294(0x1a2)][_0x372294(0x19d)](_0x111c9a[_0x372294(0x1c5)],0xc));_0x111c9a[_0x372294(0x19b)]&&(_0x4935c2[_0x372294(0x1c7)]=_0x111c9a['fullName'],delete _0x4935c2[_0x372294(0x19b)]);_0x111c9a[_0x372294(0x1c9)]&&(_0x4935c2[_0x372294(0x1ad)]=_0x111c9a[_0x372294(0x1c9)],delete _0x4935c2[_0x372294(0x1c9)]);_0x111c9a[_0x372294(0x1b0)]&&(_0x4935c2[_0x372294(0x1c1)]=_0x111c9a[_0x372294(0x1b0)],delete _0x4935c2[_0x372294(0x1b0)]);_0x111c9a['gateways']&&(_0x4935c2[_0x372294(0x1b6)]=JSON[_0x372294(0x1ba)](_0x111c9a[_0x372294(0x1a3)]),delete _0x4935c2[_0x372294(0x1a3)]);_0x111c9a['gatewaySettings']&&(_0x4935c2[_0x372294(0x1ae)]=JSON['stringify'](_0x111c9a['gatewaySettings']),delete _0x4935c2[_0x372294(0x1ae)]);_0x111c9a[_0x372294(0x1bc)]&&(_0x111c9a['wallets'][_0x372294(0x1c0)]!==undefined&&(_0x4935c2[_0x372294(0x1c0)]=_0x111c9a[_0x372294(0x1bc)][_0x372294(0x1c0)]||null),_0x111c9a[_0x372294(0x1bc)][_0x372294(0x1b2)]!==undefined&&(_0x4935c2[_0x372294(0x1b2)]=_0x111c9a['wallets'][_0x372294(0x1b2)]||null),_0x111c9a[_0x372294(0x1bc)][_0x372294(0x1bb)]!==undefined&&(_0x4935c2[_0x372294(0x1bb)]=_0x111c9a[_0x372294(0x1bc)][_0x372294(0x1bb)]||null),_0x111c9a[_0x372294(0x1bc)][_0x372294(0x1c4)]!==undefined&&(_0x4935c2[_0x372294(0x1c4)]=_0x111c9a[_0x372294(0x1bc)]['usdcPolygonWallet']||null),delete _0x4935c2['wallets']);const _0x3c7087=await database_1[_0x372294(0x1a2)][_0x372294(0x1b1)][_0x372294(0x1b5)]({'where':{'id':_0x57c888},'data':_0x4935c2,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3c7087['id'],'fullName':_0x3c7087['name'],'username':_0x3c7087[_0x372294(0x19f)],'telegramId':_0x3c7087[_0x372294(0x1ad)],'merchantUrl':_0x3c7087[_0x372294(0x1c1)],'gateways':_0x3c7087[_0x372294(0x1b6)]?JSON['parse'](_0x3c7087['paymentGateways']):null,'gatewaySettings':_0x3c7087['gatewaySettings']?JSON[_0x372294(0x1b3)](_0x3c7087['gatewaySettings']):null,'publicKey':_0x3c7087[_0x372294(0x1af)],'wallets':{'usdtPolygonWallet':_0x3c7087['usdtPolygonWallet'],'usdtTrcWallet':_0x3c7087[_0x372294(0x1b2)],'usdtErcWallet':_0x3c7087[_0x372294(0x1bb)],'usdcPolygonWallet':_0x3c7087[_0x372294(0x1c4)]},'status':_0x3c7087['status'],'createdAt':_0x3c7087[_0x372294(0x1b8)]};}async[a76_0x1f39a8(0x19a)](_0x42e37c){const _0x4f0756=a76_0x1f39a8;await database_1[_0x4f0756(0x1a2)][_0x4f0756(0x1b1)][_0x4f0756(0x1b7)]({'where':{'id':_0x42e37c}});}}exports[a76_0x1f39a8(0x1c3)]=UserService;