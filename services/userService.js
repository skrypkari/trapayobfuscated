'use strict';const a59_0x21aa02=a59_0x4b49;function a59_0x321a(){const _0x4fe54c=['usdtPolygonWallet','telegramId','shopUrl','randomBytes','shop','createUser','__importDefault','UserService','usdtErcWallet','hash','paymentGateways','wallets','getUserById','5027780dLStVD','1323788icyBIB','parse','name','fullName','deleteUser','1688196PjtQAL','usdcPolygonWallet','stringify','hex','usdtTrcWallet','gatewaySettings','merchantUrl','telegram','../config/database','username','489747qtbbvQ','Telegram\x20username\x20already\x20exists','updateUser','map','desc','3305364tmnYld','publicKey','2jfxvrL','crypto','__esModule','findUnique','update','toString','default','sk_','generateApiKeys','createdAt','password','bcryptjs','10044568EAdYsW','status','3805550vsCjDG'];a59_0x321a=function(){return _0x4fe54c;};return a59_0x321a();}(function(_0x48e4c9,_0x53c213){const _0x1b86f7=a59_0x4b49,_0x5119cb=_0x48e4c9();while(!![]){try{const _0x276422=-parseInt(_0x1b86f7(0xb5))/0x1*(-parseInt(_0x1b86f7(0x98))/0x2)+parseInt(_0x1b86f7(0x91))/0x3+-parseInt(_0x1b86f7(0xba))/0x4+parseInt(_0x1b86f7(0xb4))/0x5+parseInt(_0x1b86f7(0x96))/0x6+-parseInt(_0x1b86f7(0xa6))/0x7+-parseInt(_0x1b86f7(0xa4))/0x8;if(_0x276422===_0x53c213)break;else _0x5119cb['push'](_0x5119cb['shift']());}catch(_0xd38931){_0x5119cb['push'](_0x5119cb['shift']());}}}(a59_0x321a,0xc8bc9));function a59_0x4b49(_0x2a29fc,_0x57ab7b){const _0x321a5d=a59_0x321a();return a59_0x4b49=function(_0x4b49d5,_0x1e37a3){_0x4b49d5=_0x4b49d5-0x8b;let _0x2f4cbc=_0x321a5d[_0x4b49d5];return _0x2f4cbc;},a59_0x4b49(_0x2a29fc,_0x57ab7b);}var __importDefault=this&&this[a59_0x21aa02(0xad)]||function(_0x100b9d){const _0x30f0a8=a59_0x21aa02;return _0x100b9d&&_0x100b9d[_0x30f0a8(0x9a)]?_0x100b9d:{'default':_0x100b9d};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['UserService']=void 0x0;const bcryptjs_1=__importDefault(require(a59_0x21aa02(0xa3))),crypto_1=__importDefault(require(a59_0x21aa02(0x99))),database_1=__importDefault(require(a59_0x21aa02(0x8f)));class UserService{[a59_0x21aa02(0xa0)](){const _0x50b325=a59_0x21aa02,_0x4e65b7='pk_'+crypto_1[_0x50b325(0x9e)]['randomBytes'](0x20)[_0x50b325(0x9d)]('hex'),_0x2c497f=_0x50b325(0x9f)+crypto_1[_0x50b325(0x9e)][_0x50b325(0xaa)](0x20)[_0x50b325(0x9d)](_0x50b325(0xbd));return{'publicKey':_0x4e65b7,'secretKey':_0x2c497f};}async[a59_0x21aa02(0xac)](_0x1c2b56){const _0x46737f=a59_0x21aa02,{fullName:_0x332b6c,username:_0x5af436,password:_0x12f986,telegramId:_0x427b2b,merchantUrl:_0x3e8f07,gateways:_0x1a35c4,gatewaySettings:_0x32cd04,wallets:_0x364a71}=_0x1c2b56,_0xbe18fd=await database_1['default']['shop']['findUnique']({'where':{'username':_0x5af436}});if(_0xbe18fd)throw new Error('Username\x20already\x20exists');if(_0x427b2b){const _0x47d220=await database_1[_0x46737f(0x9e)][_0x46737f(0xab)][_0x46737f(0x9b)]({'where':{'telegram':_0x427b2b}});if(_0x47d220)throw new Error(_0x46737f(0x92));}const _0x497baf=await bcryptjs_1[_0x46737f(0x9e)][_0x46737f(0xb0)](_0x12f986,0xc),{publicKey:_0x32ba29,secretKey:_0x28f96a}=this[_0x46737f(0xa0)](),_0x4c3820=await database_1[_0x46737f(0x9e)][_0x46737f(0xab)]['create']({'data':{'name':_0x332b6c,'username':_0x5af436,'password':_0x497baf,'telegram':_0x427b2b,'shopUrl':_0x3e8f07,'paymentGateways':_0x1a35c4?JSON[_0x46737f(0xbc)](_0x1a35c4):null,'gatewaySettings':_0x32cd04?JSON['stringify'](_0x32cd04):null,'usdtPolygonWallet':_0x364a71?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x364a71?.[_0x46737f(0x8b)]||null,'usdtErcWallet':_0x364a71?.[_0x46737f(0xaf)]||null,'usdcPolygonWallet':_0x364a71?.['usdcPolygonWallet']||null,'publicKey':_0x32ba29,'secretKey':_0x28f96a,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4c3820['id'],'fullName':_0x4c3820[_0x46737f(0xb7)],'username':_0x4c3820['username'],'telegramId':_0x4c3820[_0x46737f(0x8e)],'merchantUrl':_0x4c3820[_0x46737f(0xa9)],'gateways':_0x4c3820['paymentGateways']?JSON[_0x46737f(0xb6)](_0x4c3820[_0x46737f(0xb1)]):null,'gatewaySettings':_0x4c3820[_0x46737f(0x8c)]?JSON[_0x46737f(0xb6)](_0x4c3820[_0x46737f(0x8c)]):null,'publicKey':_0x4c3820['publicKey'],'wallets':{'usdtPolygonWallet':_0x4c3820[_0x46737f(0xa7)],'usdtTrcWallet':_0x4c3820['usdtTrcWallet'],'usdtErcWallet':_0x4c3820[_0x46737f(0xaf)],'usdcPolygonWallet':_0x4c3820['usdcPolygonWallet']},'status':_0x4c3820[_0x46737f(0xa5)],'createdAt':_0x4c3820[_0x46737f(0xa1)]};}async['getAllUsers'](){const _0x55465=a59_0x21aa02,_0x29dd25=await database_1[_0x55465(0x9e)]['shop']['findMany']({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x55465(0x95)}});return _0x29dd25[_0x55465(0x94)](_0x5da69a=>({'id':_0x5da69a['id'],'fullName':_0x5da69a[_0x55465(0xb7)],'username':_0x5da69a['username'],'telegramId':_0x5da69a[_0x55465(0x8e)],'merchantUrl':_0x5da69a['shopUrl'],'gateways':_0x5da69a[_0x55465(0xb1)]?JSON['parse'](_0x5da69a[_0x55465(0xb1)]):null,'gatewaySettings':_0x5da69a['gatewaySettings']?JSON[_0x55465(0xb6)](_0x5da69a[_0x55465(0x8c)]):null,'publicKey':_0x5da69a[_0x55465(0x97)],'wallets':{'usdtPolygonWallet':_0x5da69a[_0x55465(0xa7)],'usdtTrcWallet':_0x5da69a[_0x55465(0x8b)],'usdtErcWallet':_0x5da69a['usdtErcWallet'],'usdcPolygonWallet':_0x5da69a[_0x55465(0xbb)]},'status':_0x5da69a[_0x55465(0xa5)],'createdAt':_0x5da69a[_0x55465(0xa1)]}));}async[a59_0x21aa02(0xb3)](_0x5d4ad5){const _0x1187f3=a59_0x21aa02,_0x4d29e5=await database_1[_0x1187f3(0x9e)]['shop'][_0x1187f3(0x9b)]({'where':{'id':_0x5d4ad5},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4d29e5)return null;return{'id':_0x4d29e5['id'],'fullName':_0x4d29e5[_0x1187f3(0xb7)],'username':_0x4d29e5['username'],'telegramId':_0x4d29e5[_0x1187f3(0x8e)],'merchantUrl':_0x4d29e5['shopUrl'],'gateways':_0x4d29e5[_0x1187f3(0xb1)]?JSON[_0x1187f3(0xb6)](_0x4d29e5['paymentGateways']):null,'gatewaySettings':_0x4d29e5[_0x1187f3(0x8c)]?JSON['parse'](_0x4d29e5[_0x1187f3(0x8c)]):null,'publicKey':_0x4d29e5['publicKey'],'wallets':{'usdtPolygonWallet':_0x4d29e5['usdtPolygonWallet'],'usdtTrcWallet':_0x4d29e5[_0x1187f3(0x8b)],'usdtErcWallet':_0x4d29e5[_0x1187f3(0xaf)],'usdcPolygonWallet':_0x4d29e5[_0x1187f3(0xbb)]},'status':_0x4d29e5[_0x1187f3(0xa5)],'createdAt':_0x4d29e5[_0x1187f3(0xa1)]};}async[a59_0x21aa02(0x93)](_0x2a76be,_0x23cfa5){const _0xc52eae=a59_0x21aa02,_0x5ee4f6={..._0x23cfa5};_0x23cfa5['password']&&(_0x5ee4f6[_0xc52eae(0xa2)]=await bcryptjs_1[_0xc52eae(0x9e)]['hash'](_0x23cfa5[_0xc52eae(0xa2)],0xc));_0x23cfa5['fullName']&&(_0x5ee4f6[_0xc52eae(0xb7)]=_0x23cfa5[_0xc52eae(0xb8)],delete _0x5ee4f6['fullName']);_0x23cfa5[_0xc52eae(0xa8)]&&(_0x5ee4f6[_0xc52eae(0x8e)]=_0x23cfa5[_0xc52eae(0xa8)],delete _0x5ee4f6[_0xc52eae(0xa8)]);_0x23cfa5[_0xc52eae(0x8d)]&&(_0x5ee4f6[_0xc52eae(0xa9)]=_0x23cfa5[_0xc52eae(0x8d)],delete _0x5ee4f6[_0xc52eae(0x8d)]);_0x23cfa5['gateways']&&(_0x5ee4f6[_0xc52eae(0xb1)]=JSON[_0xc52eae(0xbc)](_0x23cfa5['gateways']),delete _0x5ee4f6['gateways']);_0x23cfa5['gatewaySettings']&&(_0x5ee4f6[_0xc52eae(0x8c)]=JSON['stringify'](_0x23cfa5[_0xc52eae(0x8c)]),delete _0x5ee4f6[_0xc52eae(0x8c)]);_0x23cfa5[_0xc52eae(0xb2)]&&(_0x23cfa5['wallets']['usdtPolygonWallet']!==undefined&&(_0x5ee4f6[_0xc52eae(0xa7)]=_0x23cfa5[_0xc52eae(0xb2)][_0xc52eae(0xa7)]||null),_0x23cfa5[_0xc52eae(0xb2)][_0xc52eae(0x8b)]!==undefined&&(_0x5ee4f6['usdtTrcWallet']=_0x23cfa5[_0xc52eae(0xb2)][_0xc52eae(0x8b)]||null),_0x23cfa5[_0xc52eae(0xb2)]['usdtErcWallet']!==undefined&&(_0x5ee4f6[_0xc52eae(0xaf)]=_0x23cfa5['wallets']['usdtErcWallet']||null),_0x23cfa5['wallets']['usdcPolygonWallet']!==undefined&&(_0x5ee4f6['usdcPolygonWallet']=_0x23cfa5['wallets'][_0xc52eae(0xbb)]||null),delete _0x5ee4f6[_0xc52eae(0xb2)]);const _0x44576f=await database_1[_0xc52eae(0x9e)][_0xc52eae(0xab)][_0xc52eae(0x9c)]({'where':{'id':_0x2a76be},'data':_0x5ee4f6,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x44576f['id'],'fullName':_0x44576f[_0xc52eae(0xb7)],'username':_0x44576f[_0xc52eae(0x90)],'telegramId':_0x44576f[_0xc52eae(0x8e)],'merchantUrl':_0x44576f[_0xc52eae(0xa9)],'gateways':_0x44576f[_0xc52eae(0xb1)]?JSON['parse'](_0x44576f[_0xc52eae(0xb1)]):null,'gatewaySettings':_0x44576f[_0xc52eae(0x8c)]?JSON[_0xc52eae(0xb6)](_0x44576f[_0xc52eae(0x8c)]):null,'publicKey':_0x44576f[_0xc52eae(0x97)],'wallets':{'usdtPolygonWallet':_0x44576f[_0xc52eae(0xa7)],'usdtTrcWallet':_0x44576f[_0xc52eae(0x8b)],'usdtErcWallet':_0x44576f[_0xc52eae(0xaf)],'usdcPolygonWallet':_0x44576f[_0xc52eae(0xbb)]},'status':_0x44576f[_0xc52eae(0xa5)],'createdAt':_0x44576f[_0xc52eae(0xa1)]};}async[a59_0x21aa02(0xb9)](_0x2ab650){const _0x2a287e=a59_0x21aa02;await database_1[_0x2a287e(0x9e)][_0x2a287e(0xab)]['delete']({'where':{'id':_0x2ab650}});}}exports[a59_0x21aa02(0xae)]=UserService;