'use strict';const a57_0x4be5ae=a57_0x5c46;(function(_0x505e37,_0x2205c9){const _0x452284=a57_0x5c46,_0x2a571e=_0x505e37();while(!![]){try{const _0x35d0cf=parseInt(_0x452284(0x15e))/0x1+parseInt(_0x452284(0x170))/0x2*(parseInt(_0x452284(0x159))/0x3)+parseInt(_0x452284(0x154))/0x4+parseInt(_0x452284(0x151))/0x5*(-parseInt(_0x452284(0x173))/0x6)+-parseInt(_0x452284(0x14f))/0x7+parseInt(_0x452284(0x17a))/0x8+parseInt(_0x452284(0x162))/0x9*(-parseInt(_0x452284(0x15f))/0xa);if(_0x35d0cf===_0x2205c9)break;else _0x2a571e['push'](_0x2a571e['shift']());}catch(_0x10cfc2){_0x2a571e['push'](_0x2a571e['shift']());}}}(a57_0x83ee,0x2f03d));function a57_0x5c46(_0x5dc0a9,_0x2dc7b1){const _0x83ee11=a57_0x83ee();return a57_0x5c46=function(_0x5c4642,_0x2ad482){_0x5c4642=_0x5c4642-0x14b;let _0x2818d5=_0x83ee11[_0x5c4642];return _0x2818d5;},a57_0x5c46(_0x5dc0a9,_0x2dc7b1);}var __importDefault=this&&this[a57_0x4be5ae(0x15a)]||function(_0x51f3bc){const _0x5a5e9b=a57_0x4be5ae;return _0x51f3bc&&_0x51f3bc[_0x5a5e9b(0x16f)]?_0x51f3bc:{'default':_0x51f3bc};};Object['defineProperty'](exports,a57_0x4be5ae(0x16f),{'value':!![]}),exports['UserService']=void 0x0;function a57_0x83ee(){const _0x551cbf=['create','createUser','hex','100074OZhxFY','40420YKkVwS','update','toString','27KvlFzW','deleteUser','delete','shop','name','hash','createdAt','stringify','default','updateUser','pk_','findUnique','password','__esModule','158oDdtgy','randomBytes','publicKey','54ZLrPKQ','generateApiKeys','getAllUsers','shopUrl','usdtTrcWallet','status','merchantUrl','1086120qVnmni','usdcPolygonWallet','usdtErcWallet','parse','telegram','fullName','telegramId','username','map','gatewaySettings','875105XejmMN','Telegram\x20username\x20already\x20exists','107225forwXi','wallets','usdtPolygonWallet','154964WPdbiz','paymentGateways','Username\x20already\x20exists','gateways','UserService','9423lkerUW','__importDefault'];a57_0x83ee=function(){return _0x551cbf;};return a57_0x83ee();}const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));class UserService{[a57_0x4be5ae(0x174)](){const _0x85531d=a57_0x4be5ae,_0x3a4860=_0x85531d(0x16c)+crypto_1['default']['randomBytes'](0x20)[_0x85531d(0x161)](_0x85531d(0x15d)),_0xaa3f54='sk_'+crypto_1[_0x85531d(0x16a)][_0x85531d(0x171)](0x20)[_0x85531d(0x161)](_0x85531d(0x15d));return{'publicKey':_0x3a4860,'secretKey':_0xaa3f54};}async[a57_0x4be5ae(0x15c)](_0x1383c2){const _0xae5aa8=a57_0x4be5ae,{fullName:_0x4d73b1,username:_0x14679a,password:_0x30821d,telegramId:_0x3a0388,merchantUrl:_0x4bd521,gateways:_0x12cbf2,gatewaySettings:_0x2c6ce6,wallets:_0x3fc55e}=_0x1383c2,_0x3dd989=await database_1[_0xae5aa8(0x16a)][_0xae5aa8(0x165)][_0xae5aa8(0x16d)]({'where':{'username':_0x14679a}});if(_0x3dd989)throw new Error(_0xae5aa8(0x156));if(_0x3a0388){const _0x220c5e=await database_1[_0xae5aa8(0x16a)][_0xae5aa8(0x165)]['findUnique']({'where':{'telegram':_0x3a0388}});if(_0x220c5e)throw new Error(_0xae5aa8(0x150));}const _0x167dba=await bcryptjs_1[_0xae5aa8(0x16a)][_0xae5aa8(0x167)](_0x30821d,0xc),{publicKey:_0x536634,secretKey:_0x3ec330}=this[_0xae5aa8(0x174)](),_0x2a7dc2=await database_1[_0xae5aa8(0x16a)][_0xae5aa8(0x165)][_0xae5aa8(0x15b)]({'data':{'name':_0x4d73b1,'username':_0x14679a,'password':_0x167dba,'telegram':_0x3a0388,'shopUrl':_0x4bd521,'paymentGateways':_0x12cbf2?JSON[_0xae5aa8(0x169)](_0x12cbf2):null,'gatewaySettings':_0x2c6ce6?JSON[_0xae5aa8(0x169)](_0x2c6ce6):null,'usdtPolygonWallet':_0x3fc55e?.[_0xae5aa8(0x153)]||null,'usdtTrcWallet':_0x3fc55e?.[_0xae5aa8(0x177)]||null,'usdtErcWallet':_0x3fc55e?.[_0xae5aa8(0x17c)]||null,'usdcPolygonWallet':_0x3fc55e?.[_0xae5aa8(0x17b)]||null,'publicKey':_0x536634,'secretKey':_0x3ec330,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2a7dc2['id'],'fullName':_0x2a7dc2[_0xae5aa8(0x166)],'username':_0x2a7dc2['username'],'telegramId':_0x2a7dc2[_0xae5aa8(0x17e)],'merchantUrl':_0x2a7dc2[_0xae5aa8(0x176)],'gateways':_0x2a7dc2['paymentGateways']?JSON[_0xae5aa8(0x17d)](_0x2a7dc2[_0xae5aa8(0x155)]):null,'gatewaySettings':_0x2a7dc2[_0xae5aa8(0x14e)]?JSON[_0xae5aa8(0x17d)](_0x2a7dc2['gatewaySettings']):null,'publicKey':_0x2a7dc2['publicKey'],'wallets':{'usdtPolygonWallet':_0x2a7dc2[_0xae5aa8(0x153)],'usdtTrcWallet':_0x2a7dc2[_0xae5aa8(0x177)],'usdtErcWallet':_0x2a7dc2[_0xae5aa8(0x17c)],'usdcPolygonWallet':_0x2a7dc2['usdcPolygonWallet']},'status':_0x2a7dc2[_0xae5aa8(0x178)],'createdAt':_0x2a7dc2[_0xae5aa8(0x168)]};}async[a57_0x4be5ae(0x175)](){const _0x30129c=a57_0x4be5ae,_0xdc5e2c=await database_1[_0x30129c(0x16a)]['shop']['findMany']({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':'desc'}});return _0xdc5e2c[_0x30129c(0x14d)](_0x3ae589=>({'id':_0x3ae589['id'],'fullName':_0x3ae589['name'],'username':_0x3ae589[_0x30129c(0x14c)],'telegramId':_0x3ae589[_0x30129c(0x17e)],'merchantUrl':_0x3ae589[_0x30129c(0x176)],'gateways':_0x3ae589['paymentGateways']?JSON[_0x30129c(0x17d)](_0x3ae589[_0x30129c(0x155)]):null,'gatewaySettings':_0x3ae589['gatewaySettings']?JSON[_0x30129c(0x17d)](_0x3ae589[_0x30129c(0x14e)]):null,'publicKey':_0x3ae589[_0x30129c(0x172)],'wallets':{'usdtPolygonWallet':_0x3ae589['usdtPolygonWallet'],'usdtTrcWallet':_0x3ae589[_0x30129c(0x177)],'usdtErcWallet':_0x3ae589[_0x30129c(0x17c)],'usdcPolygonWallet':_0x3ae589['usdcPolygonWallet']},'status':_0x3ae589[_0x30129c(0x178)],'createdAt':_0x3ae589['createdAt']}));}async['getUserById'](_0x14c658){const _0x156e41=a57_0x4be5ae,_0x2dd03e=await database_1[_0x156e41(0x16a)][_0x156e41(0x165)]['findUnique']({'where':{'id':_0x14c658},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2dd03e)return null;return{'id':_0x2dd03e['id'],'fullName':_0x2dd03e['name'],'username':_0x2dd03e[_0x156e41(0x14c)],'telegramId':_0x2dd03e[_0x156e41(0x17e)],'merchantUrl':_0x2dd03e[_0x156e41(0x176)],'gateways':_0x2dd03e[_0x156e41(0x155)]?JSON['parse'](_0x2dd03e[_0x156e41(0x155)]):null,'gatewaySettings':_0x2dd03e[_0x156e41(0x14e)]?JSON[_0x156e41(0x17d)](_0x2dd03e[_0x156e41(0x14e)]):null,'publicKey':_0x2dd03e['publicKey'],'wallets':{'usdtPolygonWallet':_0x2dd03e[_0x156e41(0x153)],'usdtTrcWallet':_0x2dd03e[_0x156e41(0x177)],'usdtErcWallet':_0x2dd03e[_0x156e41(0x17c)],'usdcPolygonWallet':_0x2dd03e[_0x156e41(0x17b)]},'status':_0x2dd03e['status'],'createdAt':_0x2dd03e[_0x156e41(0x168)]};}async[a57_0x4be5ae(0x16b)](_0x49b96c,_0x100a7d){const _0xc8fabc=a57_0x4be5ae,_0x54a5a8={..._0x100a7d};_0x100a7d['password']&&(_0x54a5a8['password']=await bcryptjs_1['default'][_0xc8fabc(0x167)](_0x100a7d[_0xc8fabc(0x16e)],0xc));_0x100a7d['fullName']&&(_0x54a5a8[_0xc8fabc(0x166)]=_0x100a7d[_0xc8fabc(0x17f)],delete _0x54a5a8[_0xc8fabc(0x17f)]);_0x100a7d[_0xc8fabc(0x14b)]&&(_0x54a5a8[_0xc8fabc(0x17e)]=_0x100a7d[_0xc8fabc(0x14b)],delete _0x54a5a8[_0xc8fabc(0x14b)]);_0x100a7d['merchantUrl']&&(_0x54a5a8['shopUrl']=_0x100a7d['merchantUrl'],delete _0x54a5a8[_0xc8fabc(0x179)]);_0x100a7d[_0xc8fabc(0x157)]&&(_0x54a5a8['paymentGateways']=JSON['stringify'](_0x100a7d[_0xc8fabc(0x157)]),delete _0x54a5a8[_0xc8fabc(0x157)]);_0x100a7d['gatewaySettings']&&(_0x54a5a8[_0xc8fabc(0x14e)]=JSON[_0xc8fabc(0x169)](_0x100a7d[_0xc8fabc(0x14e)]),delete _0x54a5a8[_0xc8fabc(0x14e)]);_0x100a7d[_0xc8fabc(0x152)]&&(_0x100a7d[_0xc8fabc(0x152)]['usdtPolygonWallet']!==undefined&&(_0x54a5a8['usdtPolygonWallet']=_0x100a7d[_0xc8fabc(0x152)][_0xc8fabc(0x153)]||null),_0x100a7d[_0xc8fabc(0x152)][_0xc8fabc(0x177)]!==undefined&&(_0x54a5a8['usdtTrcWallet']=_0x100a7d[_0xc8fabc(0x152)][_0xc8fabc(0x177)]||null),_0x100a7d['wallets'][_0xc8fabc(0x17c)]!==undefined&&(_0x54a5a8[_0xc8fabc(0x17c)]=_0x100a7d['wallets'][_0xc8fabc(0x17c)]||null),_0x100a7d[_0xc8fabc(0x152)][_0xc8fabc(0x17b)]!==undefined&&(_0x54a5a8[_0xc8fabc(0x17b)]=_0x100a7d[_0xc8fabc(0x152)][_0xc8fabc(0x17b)]||null),delete _0x54a5a8[_0xc8fabc(0x152)]);const _0x4a5492=await database_1[_0xc8fabc(0x16a)][_0xc8fabc(0x165)][_0xc8fabc(0x160)]({'where':{'id':_0x49b96c},'data':_0x54a5a8,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4a5492['id'],'fullName':_0x4a5492[_0xc8fabc(0x166)],'username':_0x4a5492[_0xc8fabc(0x14c)],'telegramId':_0x4a5492[_0xc8fabc(0x17e)],'merchantUrl':_0x4a5492[_0xc8fabc(0x176)],'gateways':_0x4a5492['paymentGateways']?JSON['parse'](_0x4a5492[_0xc8fabc(0x155)]):null,'gatewaySettings':_0x4a5492[_0xc8fabc(0x14e)]?JSON[_0xc8fabc(0x17d)](_0x4a5492[_0xc8fabc(0x14e)]):null,'publicKey':_0x4a5492[_0xc8fabc(0x172)],'wallets':{'usdtPolygonWallet':_0x4a5492[_0xc8fabc(0x153)],'usdtTrcWallet':_0x4a5492[_0xc8fabc(0x177)],'usdtErcWallet':_0x4a5492[_0xc8fabc(0x17c)],'usdcPolygonWallet':_0x4a5492[_0xc8fabc(0x17b)]},'status':_0x4a5492[_0xc8fabc(0x178)],'createdAt':_0x4a5492[_0xc8fabc(0x168)]};}async[a57_0x4be5ae(0x163)](_0x47a0ad){const _0x95a0d0=a57_0x4be5ae;await database_1[_0x95a0d0(0x16a)]['shop'][_0x95a0d0(0x164)]({'where':{'id':_0x47a0ad}});}}exports[a57_0x4be5ae(0x158)]=UserService;