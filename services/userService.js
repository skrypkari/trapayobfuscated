'use strict';const a51_0x4cb709=a51_0x12ce;(function(_0x18bade,_0x8aa56a){const _0x47430c=a51_0x12ce,_0x253c93=_0x18bade();while(!![]){try{const _0x9448a1=-parseInt(_0x47430c(0xe9))/0x1*(-parseInt(_0x47430c(0xe2))/0x2)+-parseInt(_0x47430c(0xe8))/0x3+parseInt(_0x47430c(0xee))/0x4+parseInt(_0x47430c(0xdc))/0x5+parseInt(_0x47430c(0x10a))/0x6*(-parseInt(_0x47430c(0xf6))/0x7)+parseInt(_0x47430c(0x108))/0x8+-parseInt(_0x47430c(0xe6))/0x9*(-parseInt(_0x47430c(0xfe))/0xa);if(_0x9448a1===_0x8aa56a)break;else _0x253c93['push'](_0x253c93['shift']());}catch(_0x3e7e94){_0x253c93['push'](_0x253c93['shift']());}}}(a51_0x4f1e,0x927cb));var __importDefault=this&&this[a51_0x4cb709(0xf2)]||function(_0xd7d59c){const _0x4e1e47=a51_0x4cb709;return _0xd7d59c&&_0xd7d59c[_0x4e1e47(0xe5)]?_0xd7d59c:{'default':_0xd7d59c};};Object['defineProperty'](exports,a51_0x4cb709(0xe5),{'value':!![]}),exports[a51_0x4cb709(0x110)]=void 0x0;const bcryptjs_1=__importDefault(require(a51_0x4cb709(0x101))),crypto_1=__importDefault(require(a51_0x4cb709(0xfb))),database_1=__importDefault(require(a51_0x4cb709(0xed)));function a51_0x4f1e(){const _0x2eab8a=['paymentGateways','UserService','stringify','pk_','randomBytes','343540byJcYj','default','findUnique','gatewaySettings','wallets','username','2CveTJS','usdcPolygonWallet','publicKey','__esModule','6898410apnvsb','fullName','2179194hcaaqY','453515Zhjnct','getUserById','createdAt','create','../config/database','270392sbcmXP','merchantUrl','desc','shopUrl','__importDefault','hash','generateApiKeys','update','343ddedUr','usdtErcWallet','findMany','createUser','shop','crypto','hex','map','10aGEocM','updateUser','gateways','bcryptjs','parse','telegram','telegramId','Telegram\x20username\x20already\x20exists','toString','Username\x20already\x20exists','4815232FFmFps','usdtPolygonWallet','77364YvreGZ','status','name','password','usdtTrcWallet'];a51_0x4f1e=function(){return _0x2eab8a;};return a51_0x4f1e();}function a51_0x12ce(_0x4a01dd,_0x27a0e8){const _0x4f1eaf=a51_0x4f1e();return a51_0x12ce=function(_0x12cea1,_0x50c467){_0x12cea1=_0x12cea1-0xd9;let _0x56bb1c=_0x4f1eaf[_0x12cea1];return _0x56bb1c;},a51_0x12ce(_0x4a01dd,_0x27a0e8);}class UserService{[a51_0x4cb709(0xf4)](){const _0x57cc7c=a51_0x4cb709,_0x2deda0=_0x57cc7c(0xda)+crypto_1['default']['randomBytes'](0x20)[_0x57cc7c(0x106)](_0x57cc7c(0xfc)),_0x2f77ed='sk_'+crypto_1['default'][_0x57cc7c(0xdb)](0x20)[_0x57cc7c(0x106)](_0x57cc7c(0xfc));return{'publicKey':_0x2deda0,'secretKey':_0x2f77ed};}async[a51_0x4cb709(0xf9)](_0x236aef){const _0x24ef12=a51_0x4cb709,{fullName:_0x25e089,username:_0x4f387c,password:_0x572308,telegramId:_0x125056,merchantUrl:_0x11ff8e,gateways:_0x33ff45,gatewaySettings:_0x9f11f3,wallets:_0x171a7a}=_0x236aef,_0x24072f=await database_1[_0x24ef12(0xdd)][_0x24ef12(0xfa)]['findUnique']({'where':{'username':_0x4f387c}});if(_0x24072f)throw new Error(_0x24ef12(0x107));if(_0x125056){const _0xcdebd3=await database_1['default']['shop'][_0x24ef12(0xde)]({'where':{'telegram':_0x125056}});if(_0xcdebd3)throw new Error(_0x24ef12(0x105));}const _0x1b6b2e=await bcryptjs_1[_0x24ef12(0xdd)][_0x24ef12(0xf3)](_0x572308,0xc),{publicKey:_0x4f2d84,secretKey:_0x4d2fa5}=this[_0x24ef12(0xf4)](),_0x30bcb2=await database_1[_0x24ef12(0xdd)][_0x24ef12(0xfa)][_0x24ef12(0xec)]({'data':{'name':_0x25e089,'username':_0x4f387c,'password':_0x1b6b2e,'telegram':_0x125056,'shopUrl':_0x11ff8e,'paymentGateways':_0x33ff45?JSON[_0x24ef12(0xd9)](_0x33ff45):null,'gatewaySettings':_0x9f11f3?JSON[_0x24ef12(0xd9)](_0x9f11f3):null,'usdtPolygonWallet':_0x171a7a?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x171a7a?.[_0x24ef12(0x10e)]||null,'usdtErcWallet':_0x171a7a?.[_0x24ef12(0xf7)]||null,'usdcPolygonWallet':_0x171a7a?.[_0x24ef12(0xe3)]||null,'publicKey':_0x4f2d84,'secretKey':_0x4d2fa5,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x30bcb2['id'],'fullName':_0x30bcb2[_0x24ef12(0x10c)],'username':_0x30bcb2['username'],'telegramId':_0x30bcb2[_0x24ef12(0x103)],'merchantUrl':_0x30bcb2[_0x24ef12(0xf1)],'gateways':_0x30bcb2['paymentGateways']?JSON['parse'](_0x30bcb2[_0x24ef12(0x10f)]):null,'gatewaySettings':_0x30bcb2[_0x24ef12(0xdf)]?JSON['parse'](_0x30bcb2[_0x24ef12(0xdf)]):null,'publicKey':_0x30bcb2[_0x24ef12(0xe4)],'wallets':{'usdtPolygonWallet':_0x30bcb2[_0x24ef12(0x109)],'usdtTrcWallet':_0x30bcb2[_0x24ef12(0x10e)],'usdtErcWallet':_0x30bcb2[_0x24ef12(0xf7)],'usdcPolygonWallet':_0x30bcb2[_0x24ef12(0xe3)]},'status':_0x30bcb2['status'],'createdAt':_0x30bcb2[_0x24ef12(0xeb)]};}async['getAllUsers'](){const _0x3f3fef=a51_0x4cb709,_0x46ace3=await database_1['default'][_0x3f3fef(0xfa)][_0x3f3fef(0xf8)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x3f3fef(0xf0)}});return _0x46ace3[_0x3f3fef(0xfd)](_0x70662d=>({'id':_0x70662d['id'],'fullName':_0x70662d['name'],'username':_0x70662d[_0x3f3fef(0xe1)],'telegramId':_0x70662d['telegram'],'merchantUrl':_0x70662d[_0x3f3fef(0xf1)],'gateways':_0x70662d[_0x3f3fef(0x10f)]?JSON['parse'](_0x70662d[_0x3f3fef(0x10f)]):null,'gatewaySettings':_0x70662d[_0x3f3fef(0xdf)]?JSON['parse'](_0x70662d[_0x3f3fef(0xdf)]):null,'publicKey':_0x70662d[_0x3f3fef(0xe4)],'wallets':{'usdtPolygonWallet':_0x70662d[_0x3f3fef(0x109)],'usdtTrcWallet':_0x70662d[_0x3f3fef(0x10e)],'usdtErcWallet':_0x70662d[_0x3f3fef(0xf7)],'usdcPolygonWallet':_0x70662d[_0x3f3fef(0xe3)]},'status':_0x70662d[_0x3f3fef(0x10b)],'createdAt':_0x70662d[_0x3f3fef(0xeb)]}));}async[a51_0x4cb709(0xea)](_0x236a02){const _0x180194=a51_0x4cb709,_0x42cdcc=await database_1[_0x180194(0xdd)][_0x180194(0xfa)][_0x180194(0xde)]({'where':{'id':_0x236a02},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x42cdcc)return null;return{'id':_0x42cdcc['id'],'fullName':_0x42cdcc[_0x180194(0x10c)],'username':_0x42cdcc[_0x180194(0xe1)],'telegramId':_0x42cdcc[_0x180194(0x103)],'merchantUrl':_0x42cdcc['shopUrl'],'gateways':_0x42cdcc['paymentGateways']?JSON[_0x180194(0x102)](_0x42cdcc[_0x180194(0x10f)]):null,'gatewaySettings':_0x42cdcc[_0x180194(0xdf)]?JSON['parse'](_0x42cdcc['gatewaySettings']):null,'publicKey':_0x42cdcc['publicKey'],'wallets':{'usdtPolygonWallet':_0x42cdcc[_0x180194(0x109)],'usdtTrcWallet':_0x42cdcc['usdtTrcWallet'],'usdtErcWallet':_0x42cdcc[_0x180194(0xf7)],'usdcPolygonWallet':_0x42cdcc[_0x180194(0xe3)]},'status':_0x42cdcc[_0x180194(0x10b)],'createdAt':_0x42cdcc[_0x180194(0xeb)]};}async[a51_0x4cb709(0xff)](_0xdeecaa,_0x368f65){const _0x5d079c=a51_0x4cb709,_0x47ddb3={..._0x368f65};_0x368f65['password']&&(_0x47ddb3[_0x5d079c(0x10d)]=await bcryptjs_1[_0x5d079c(0xdd)][_0x5d079c(0xf3)](_0x368f65[_0x5d079c(0x10d)],0xc));_0x368f65[_0x5d079c(0xe7)]&&(_0x47ddb3[_0x5d079c(0x10c)]=_0x368f65[_0x5d079c(0xe7)],delete _0x47ddb3['fullName']);_0x368f65[_0x5d079c(0x104)]&&(_0x47ddb3['telegram']=_0x368f65[_0x5d079c(0x104)],delete _0x47ddb3['telegramId']);_0x368f65[_0x5d079c(0xef)]&&(_0x47ddb3['shopUrl']=_0x368f65[_0x5d079c(0xef)],delete _0x47ddb3['merchantUrl']);_0x368f65[_0x5d079c(0x100)]&&(_0x47ddb3[_0x5d079c(0x10f)]=JSON[_0x5d079c(0xd9)](_0x368f65[_0x5d079c(0x100)]),delete _0x47ddb3[_0x5d079c(0x100)]);_0x368f65[_0x5d079c(0xdf)]&&(_0x47ddb3[_0x5d079c(0xdf)]=JSON[_0x5d079c(0xd9)](_0x368f65[_0x5d079c(0xdf)]),delete _0x47ddb3[_0x5d079c(0xdf)]);_0x368f65[_0x5d079c(0xe0)]&&(_0x368f65[_0x5d079c(0xe0)][_0x5d079c(0x109)]!==undefined&&(_0x47ddb3[_0x5d079c(0x109)]=_0x368f65[_0x5d079c(0xe0)][_0x5d079c(0x109)]||null),_0x368f65[_0x5d079c(0xe0)][_0x5d079c(0x10e)]!==undefined&&(_0x47ddb3[_0x5d079c(0x10e)]=_0x368f65[_0x5d079c(0xe0)][_0x5d079c(0x10e)]||null),_0x368f65[_0x5d079c(0xe0)][_0x5d079c(0xf7)]!==undefined&&(_0x47ddb3[_0x5d079c(0xf7)]=_0x368f65[_0x5d079c(0xe0)][_0x5d079c(0xf7)]||null),_0x368f65[_0x5d079c(0xe0)][_0x5d079c(0xe3)]!==undefined&&(_0x47ddb3['usdcPolygonWallet']=_0x368f65[_0x5d079c(0xe0)][_0x5d079c(0xe3)]||null),delete _0x47ddb3[_0x5d079c(0xe0)]);const _0xb86bff=await database_1[_0x5d079c(0xdd)][_0x5d079c(0xfa)][_0x5d079c(0xf5)]({'where':{'id':_0xdeecaa},'data':_0x47ddb3,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xb86bff['id'],'fullName':_0xb86bff[_0x5d079c(0x10c)],'username':_0xb86bff['username'],'telegramId':_0xb86bff[_0x5d079c(0x103)],'merchantUrl':_0xb86bff[_0x5d079c(0xf1)],'gateways':_0xb86bff['paymentGateways']?JSON[_0x5d079c(0x102)](_0xb86bff[_0x5d079c(0x10f)]):null,'gatewaySettings':_0xb86bff['gatewaySettings']?JSON[_0x5d079c(0x102)](_0xb86bff[_0x5d079c(0xdf)]):null,'publicKey':_0xb86bff[_0x5d079c(0xe4)],'wallets':{'usdtPolygonWallet':_0xb86bff[_0x5d079c(0x109)],'usdtTrcWallet':_0xb86bff[_0x5d079c(0x10e)],'usdtErcWallet':_0xb86bff[_0x5d079c(0xf7)],'usdcPolygonWallet':_0xb86bff[_0x5d079c(0xe3)]},'status':_0xb86bff['status'],'createdAt':_0xb86bff['createdAt']};}async['deleteUser'](_0x5206ee){const _0x3418e8=a51_0x4cb709;await database_1[_0x3418e8(0xdd)]['shop']['delete']({'where':{'id':_0x5206ee}});}}exports[a51_0x4cb709(0x110)]=UserService;