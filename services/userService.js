'use strict';function a51_0x1d16(){const _0x4106f4=['desc','telegramId','toString','defineProperty','publicKey','../config/database','name','password','562806FqxCle','shop','shopUrl','crypto','6UcbyUC','hash','usdtTrcWallet','generateApiKeys','587574ISnUOc','pk_','default','119709SnlObO','usdcPolygonWallet','fullName','findMany','stringify','usdtErcWallet','__esModule','3968944PVWQYx','gatewaySettings','gateways','findUnique','updateUser','1125336tkIWcx','wallets','getAllUsers','UserService','paymentGateways','416575CeDqvo','3368332PErarT','ACTIVE','randomBytes','status','username','usdtPolygonWallet','Telegram\x20username\x20already\x20exists','createUser','merchantUrl','deleteUser','Username\x20already\x20exists','parse','__importDefault','getUserById','hex','telegram','createdAt','1448HkONom','delete'];a51_0x1d16=function(){return _0x4106f4;};return a51_0x1d16();}const a51_0x466b86=a51_0x3aca;(function(_0x805661,_0x349d6c){const _0x386827=a51_0x3aca,_0x2ce8b8=_0x805661();while(!![]){try{const _0x1cd165=parseInt(_0x386827(0x131))/0x1+-parseInt(_0x386827(0x135))/0x2*(-parseInt(_0x386827(0x101))/0x3)+parseInt(_0x386827(0x116))/0x4+parseInt(_0x386827(0x115))/0x5+parseInt(_0x386827(0x110))/0x6+parseInt(_0x386827(0x10b))/0x7+-parseInt(_0x386827(0x127))/0x8*(parseInt(_0x386827(0x104))/0x9);if(_0x1cd165===_0x349d6c)break;else _0x2ce8b8['push'](_0x2ce8b8['shift']());}catch(_0x3565db){_0x2ce8b8['push'](_0x2ce8b8['shift']());}}}(a51_0x1d16,0x673bd));function a51_0x3aca(_0x13405e,_0xc23091){const _0x1d16c5=a51_0x1d16();return a51_0x3aca=function(_0x3aca05,_0x1c5ec0){_0x3aca05=_0x3aca05-0xfe;let _0x240325=_0x1d16c5[_0x3aca05];return _0x240325;},a51_0x3aca(_0x13405e,_0xc23091);}var __importDefault=this&&this[a51_0x466b86(0x122)]||function(_0x46ef06){const _0x3cfaca=a51_0x466b86;return _0x46ef06&&_0x46ef06[_0x3cfaca(0x10a)]?_0x46ef06:{'default':_0x46ef06};};Object[a51_0x466b86(0x12c)](exports,a51_0x466b86(0x10a),{'value':!![]}),exports[a51_0x466b86(0x113)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a51_0x466b86(0x134))),database_1=__importDefault(require(a51_0x466b86(0x12e)));class UserService{[a51_0x466b86(0x100)](){const _0x21dfe3=a51_0x466b86,_0x2a5cb3=_0x21dfe3(0x102)+crypto_1[_0x21dfe3(0x103)][_0x21dfe3(0x118)](0x20)[_0x21dfe3(0x12b)](_0x21dfe3(0x124)),_0x27d978='sk_'+crypto_1[_0x21dfe3(0x103)][_0x21dfe3(0x118)](0x20)['toString'](_0x21dfe3(0x124));return{'publicKey':_0x2a5cb3,'secretKey':_0x27d978};}async[a51_0x466b86(0x11d)](_0x49a983){const _0x4cf82b=a51_0x466b86,{fullName:_0x48762c,username:_0x5fa1d6,password:_0x6998be,telegramId:_0x3e6ab2,merchantUrl:_0x448c62,gateways:_0x568e44,gatewaySettings:_0x11314e,wallets:_0x14d74a}=_0x49a983,_0x3f3998=await database_1[_0x4cf82b(0x103)]['shop']['findUnique']({'where':{'username':_0x5fa1d6}});if(_0x3f3998)throw new Error(_0x4cf82b(0x120));if(_0x3e6ab2){const _0x471e6e=await database_1[_0x4cf82b(0x103)][_0x4cf82b(0x132)][_0x4cf82b(0x10e)]({'where':{'telegram':_0x3e6ab2}});if(_0x471e6e)throw new Error(_0x4cf82b(0x11c));}const _0xbc6584=await bcryptjs_1[_0x4cf82b(0x103)][_0x4cf82b(0xfe)](_0x6998be,0xc),{publicKey:_0x21e54c,secretKey:_0x291c2f}=this['generateApiKeys'](),_0x35f07a=await database_1[_0x4cf82b(0x103)][_0x4cf82b(0x132)]['create']({'data':{'name':_0x48762c,'username':_0x5fa1d6,'password':_0xbc6584,'telegram':_0x3e6ab2,'shopUrl':_0x448c62,'paymentGateways':_0x568e44?JSON[_0x4cf82b(0x108)](_0x568e44):null,'gatewaySettings':_0x11314e?JSON[_0x4cf82b(0x108)](_0x11314e):null,'usdtPolygonWallet':_0x14d74a?.[_0x4cf82b(0x11b)]||null,'usdtTrcWallet':_0x14d74a?.[_0x4cf82b(0xff)]||null,'usdtErcWallet':_0x14d74a?.[_0x4cf82b(0x109)]||null,'usdcPolygonWallet':_0x14d74a?.[_0x4cf82b(0x105)]||null,'publicKey':_0x21e54c,'secretKey':_0x291c2f,'status':_0x4cf82b(0x117)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x35f07a['id'],'fullName':_0x35f07a[_0x4cf82b(0x12f)],'username':_0x35f07a['username'],'telegramId':_0x35f07a[_0x4cf82b(0x125)],'merchantUrl':_0x35f07a[_0x4cf82b(0x133)],'gateways':_0x35f07a[_0x4cf82b(0x114)]?JSON['parse'](_0x35f07a['paymentGateways']):null,'gatewaySettings':_0x35f07a[_0x4cf82b(0x10c)]?JSON[_0x4cf82b(0x121)](_0x35f07a['gatewaySettings']):null,'publicKey':_0x35f07a[_0x4cf82b(0x12d)],'wallets':{'usdtPolygonWallet':_0x35f07a[_0x4cf82b(0x11b)],'usdtTrcWallet':_0x35f07a[_0x4cf82b(0xff)],'usdtErcWallet':_0x35f07a[_0x4cf82b(0x109)],'usdcPolygonWallet':_0x35f07a[_0x4cf82b(0x105)]},'status':_0x35f07a[_0x4cf82b(0x119)],'createdAt':_0x35f07a[_0x4cf82b(0x126)]};}async[a51_0x466b86(0x112)](){const _0x333774=a51_0x466b86,_0x280e4a=await database_1['default']['shop'][_0x333774(0x107)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x333774(0x129)}});return _0x280e4a['map'](_0x348530=>({'id':_0x348530['id'],'fullName':_0x348530['name'],'username':_0x348530['username'],'telegramId':_0x348530[_0x333774(0x125)],'merchantUrl':_0x348530[_0x333774(0x133)],'gateways':_0x348530[_0x333774(0x114)]?JSON['parse'](_0x348530[_0x333774(0x114)]):null,'gatewaySettings':_0x348530[_0x333774(0x10c)]?JSON[_0x333774(0x121)](_0x348530['gatewaySettings']):null,'publicKey':_0x348530[_0x333774(0x12d)],'wallets':{'usdtPolygonWallet':_0x348530[_0x333774(0x11b)],'usdtTrcWallet':_0x348530['usdtTrcWallet'],'usdtErcWallet':_0x348530[_0x333774(0x109)],'usdcPolygonWallet':_0x348530[_0x333774(0x105)]},'status':_0x348530[_0x333774(0x119)],'createdAt':_0x348530[_0x333774(0x126)]}));}async[a51_0x466b86(0x123)](_0x43bb24){const _0x2681f0=a51_0x466b86,_0x293eb3=await database_1[_0x2681f0(0x103)][_0x2681f0(0x132)][_0x2681f0(0x10e)]({'where':{'id':_0x43bb24},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x293eb3)return null;return{'id':_0x293eb3['id'],'fullName':_0x293eb3[_0x2681f0(0x12f)],'username':_0x293eb3[_0x2681f0(0x11a)],'telegramId':_0x293eb3['telegram'],'merchantUrl':_0x293eb3['shopUrl'],'gateways':_0x293eb3[_0x2681f0(0x114)]?JSON[_0x2681f0(0x121)](_0x293eb3[_0x2681f0(0x114)]):null,'gatewaySettings':_0x293eb3[_0x2681f0(0x10c)]?JSON[_0x2681f0(0x121)](_0x293eb3[_0x2681f0(0x10c)]):null,'publicKey':_0x293eb3[_0x2681f0(0x12d)],'wallets':{'usdtPolygonWallet':_0x293eb3[_0x2681f0(0x11b)],'usdtTrcWallet':_0x293eb3['usdtTrcWallet'],'usdtErcWallet':_0x293eb3[_0x2681f0(0x109)],'usdcPolygonWallet':_0x293eb3['usdcPolygonWallet']},'status':_0x293eb3[_0x2681f0(0x119)],'createdAt':_0x293eb3[_0x2681f0(0x126)]};}async[a51_0x466b86(0x10f)](_0x41a791,_0x226500){const _0x300cfd=a51_0x466b86,_0x337a15={..._0x226500};_0x226500['password']&&(_0x337a15[_0x300cfd(0x130)]=await bcryptjs_1[_0x300cfd(0x103)]['hash'](_0x226500[_0x300cfd(0x130)],0xc));_0x226500['fullName']&&(_0x337a15[_0x300cfd(0x12f)]=_0x226500[_0x300cfd(0x106)],delete _0x337a15[_0x300cfd(0x106)]);_0x226500['telegramId']&&(_0x337a15[_0x300cfd(0x125)]=_0x226500[_0x300cfd(0x12a)],delete _0x337a15[_0x300cfd(0x12a)]);_0x226500[_0x300cfd(0x11e)]&&(_0x337a15[_0x300cfd(0x133)]=_0x226500[_0x300cfd(0x11e)],delete _0x337a15[_0x300cfd(0x11e)]);_0x226500['gateways']&&(_0x337a15[_0x300cfd(0x114)]=JSON[_0x300cfd(0x108)](_0x226500[_0x300cfd(0x10d)]),delete _0x337a15[_0x300cfd(0x10d)]);_0x226500[_0x300cfd(0x10c)]&&(_0x337a15[_0x300cfd(0x10c)]=JSON[_0x300cfd(0x108)](_0x226500[_0x300cfd(0x10c)]),delete _0x337a15[_0x300cfd(0x10c)]);_0x226500['wallets']&&(_0x226500[_0x300cfd(0x111)][_0x300cfd(0x11b)]!==undefined&&(_0x337a15[_0x300cfd(0x11b)]=_0x226500[_0x300cfd(0x111)]['usdtPolygonWallet']||null),_0x226500['wallets']['usdtTrcWallet']!==undefined&&(_0x337a15[_0x300cfd(0xff)]=_0x226500[_0x300cfd(0x111)][_0x300cfd(0xff)]||null),_0x226500[_0x300cfd(0x111)][_0x300cfd(0x109)]!==undefined&&(_0x337a15[_0x300cfd(0x109)]=_0x226500['wallets']['usdtErcWallet']||null),_0x226500[_0x300cfd(0x111)]['usdcPolygonWallet']!==undefined&&(_0x337a15[_0x300cfd(0x105)]=_0x226500[_0x300cfd(0x111)]['usdcPolygonWallet']||null),delete _0x337a15[_0x300cfd(0x111)]);const _0x4c7783=await database_1[_0x300cfd(0x103)][_0x300cfd(0x132)]['update']({'where':{'id':_0x41a791},'data':_0x337a15,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4c7783['id'],'fullName':_0x4c7783[_0x300cfd(0x12f)],'username':_0x4c7783[_0x300cfd(0x11a)],'telegramId':_0x4c7783[_0x300cfd(0x125)],'merchantUrl':_0x4c7783[_0x300cfd(0x133)],'gateways':_0x4c7783[_0x300cfd(0x114)]?JSON['parse'](_0x4c7783[_0x300cfd(0x114)]):null,'gatewaySettings':_0x4c7783[_0x300cfd(0x10c)]?JSON[_0x300cfd(0x121)](_0x4c7783[_0x300cfd(0x10c)]):null,'publicKey':_0x4c7783[_0x300cfd(0x12d)],'wallets':{'usdtPolygonWallet':_0x4c7783[_0x300cfd(0x11b)],'usdtTrcWallet':_0x4c7783[_0x300cfd(0xff)],'usdtErcWallet':_0x4c7783['usdtErcWallet'],'usdcPolygonWallet':_0x4c7783[_0x300cfd(0x105)]},'status':_0x4c7783[_0x300cfd(0x119)],'createdAt':_0x4c7783[_0x300cfd(0x126)]};}async[a51_0x466b86(0x11f)](_0x56b057){const _0x22499a=a51_0x466b86;await database_1[_0x22499a(0x103)][_0x22499a(0x132)][_0x22499a(0x128)]({'where':{'id':_0x56b057}});}}exports[a51_0x466b86(0x113)]=UserService;