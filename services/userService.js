'use strict';const a51_0x699ecc=a51_0x4e5f;(function(_0x4ff0fc,_0x2cd040){const _0x700d3=a51_0x4e5f,_0xb2324=_0x4ff0fc();while(!![]){try{const _0x46b252=-parseInt(_0x700d3(0x16d))/0x1*(-parseInt(_0x700d3(0x155))/0x2)+-parseInt(_0x700d3(0x172))/0x3*(parseInt(_0x700d3(0x160))/0x4)+-parseInt(_0x700d3(0x157))/0x5+-parseInt(_0x700d3(0x145))/0x6+parseInt(_0x700d3(0x165))/0x7+-parseInt(_0x700d3(0x161))/0x8+parseInt(_0x700d3(0x158))/0x9;if(_0x46b252===_0x2cd040)break;else _0xb2324['push'](_0xb2324['shift']());}catch(_0x1f0f7b){_0xb2324['push'](_0xb2324['shift']());}}}(a51_0x12a4,0x6af89));function a51_0x12a4(){const _0x209d43=['generateApiKeys','1OIUKdY','default','usdcPolygonWallet','stringify','telegram','130827PbHvlv','username','ACTIVE','telegramId','fullName','UserService','1677276RRrdSO','wallets','password','status','toString','publicKey','deleteUser','updateUser','Username\x20already\x20exists','__importDefault','pk_','getUserById','name','usdtErcWallet','bcryptjs','hash','972606THrxvZ','parse','2291535HViTbk','6343065UxVZcf','usdtPolygonWallet','../config/database','shop','hex','gateways','delete','merchantUrl','4DpUyEa','228160ShKVUt','paymentGateways','usdtTrcWallet','findUnique','399329UBVwsT','shopUrl','gatewaySettings','createdAt','sk_','create','randomBytes'];a51_0x12a4=function(){return _0x209d43;};return a51_0x12a4();}var __importDefault=this&&this[a51_0x699ecc(0x14e)]||function(_0x4095c3){return _0x4095c3&&_0x4095c3['__esModule']?_0x4095c3:{'default':_0x4095c3};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['UserService']=void 0x0;const bcryptjs_1=__importDefault(require(a51_0x699ecc(0x153))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a51_0x699ecc(0x15a)));function a51_0x4e5f(_0x5c1ea6,_0x57fb5c){const _0x12a4f5=a51_0x12a4();return a51_0x4e5f=function(_0x4e5fb2,_0x2fe797){_0x4e5fb2=_0x4e5fb2-0x142;let _0x341bd0=_0x12a4f5[_0x4e5fb2];return _0x341bd0;},a51_0x4e5f(_0x5c1ea6,_0x57fb5c);}class UserService{['generateApiKeys'](){const _0x34a5ef=a51_0x699ecc,_0x31f255=_0x34a5ef(0x14f)+crypto_1[_0x34a5ef(0x16e)][_0x34a5ef(0x16b)](0x20)[_0x34a5ef(0x149)](_0x34a5ef(0x15c)),_0x267606=_0x34a5ef(0x169)+crypto_1[_0x34a5ef(0x16e)][_0x34a5ef(0x16b)](0x20)[_0x34a5ef(0x149)]('hex');return{'publicKey':_0x31f255,'secretKey':_0x267606};}async['createUser'](_0x58d123){const _0x5a975b=a51_0x699ecc,{fullName:_0x360687,username:_0x2a0ad1,password:_0x1cc6c7,telegramId:_0x1bb3f3,merchantUrl:_0x5e75a6,gateways:_0x2db1a1,gatewaySettings:_0x10a0bc,wallets:_0x44215d}=_0x58d123,_0x37e15c=await database_1[_0x5a975b(0x16e)][_0x5a975b(0x15b)][_0x5a975b(0x164)]({'where':{'username':_0x2a0ad1}});if(_0x37e15c)throw new Error(_0x5a975b(0x14d));if(_0x1bb3f3){const _0x2581a4=await database_1[_0x5a975b(0x16e)][_0x5a975b(0x15b)][_0x5a975b(0x164)]({'where':{'telegram':_0x1bb3f3}});if(_0x2581a4)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x26d55e=await bcryptjs_1[_0x5a975b(0x16e)][_0x5a975b(0x154)](_0x1cc6c7,0xc),{publicKey:_0x519bc9,secretKey:_0x25e686}=this[_0x5a975b(0x16c)](),_0x338956=await database_1[_0x5a975b(0x16e)]['shop'][_0x5a975b(0x16a)]({'data':{'name':_0x360687,'username':_0x2a0ad1,'password':_0x26d55e,'telegram':_0x1bb3f3,'shopUrl':_0x5e75a6,'paymentGateways':_0x2db1a1?JSON['stringify'](_0x2db1a1):null,'gatewaySettings':_0x10a0bc?JSON[_0x5a975b(0x170)](_0x10a0bc):null,'usdtPolygonWallet':_0x44215d?.[_0x5a975b(0x159)]||null,'usdtTrcWallet':_0x44215d?.[_0x5a975b(0x163)]||null,'usdtErcWallet':_0x44215d?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x44215d?.[_0x5a975b(0x16f)]||null,'publicKey':_0x519bc9,'secretKey':_0x25e686,'status':_0x5a975b(0x174)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x338956['id'],'fullName':_0x338956[_0x5a975b(0x151)],'username':_0x338956[_0x5a975b(0x173)],'telegramId':_0x338956[_0x5a975b(0x171)],'merchantUrl':_0x338956[_0x5a975b(0x166)],'gateways':_0x338956[_0x5a975b(0x162)]?JSON[_0x5a975b(0x156)](_0x338956[_0x5a975b(0x162)]):null,'gatewaySettings':_0x338956[_0x5a975b(0x167)]?JSON[_0x5a975b(0x156)](_0x338956[_0x5a975b(0x167)]):null,'publicKey':_0x338956[_0x5a975b(0x14a)],'wallets':{'usdtPolygonWallet':_0x338956[_0x5a975b(0x159)],'usdtTrcWallet':_0x338956[_0x5a975b(0x163)],'usdtErcWallet':_0x338956[_0x5a975b(0x152)],'usdcPolygonWallet':_0x338956[_0x5a975b(0x16f)]},'status':_0x338956['status'],'createdAt':_0x338956[_0x5a975b(0x168)]};}async['getAllUsers'](){const _0x46888e=a51_0x699ecc,_0x38a08e=await database_1['default']['shop']['findMany']({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':'desc'}});return _0x38a08e['map'](_0x244bbc=>({'id':_0x244bbc['id'],'fullName':_0x244bbc[_0x46888e(0x151)],'username':_0x244bbc['username'],'telegramId':_0x244bbc['telegram'],'merchantUrl':_0x244bbc['shopUrl'],'gateways':_0x244bbc[_0x46888e(0x162)]?JSON['parse'](_0x244bbc[_0x46888e(0x162)]):null,'gatewaySettings':_0x244bbc[_0x46888e(0x167)]?JSON['parse'](_0x244bbc['gatewaySettings']):null,'publicKey':_0x244bbc['publicKey'],'wallets':{'usdtPolygonWallet':_0x244bbc[_0x46888e(0x159)],'usdtTrcWallet':_0x244bbc[_0x46888e(0x163)],'usdtErcWallet':_0x244bbc[_0x46888e(0x152)],'usdcPolygonWallet':_0x244bbc['usdcPolygonWallet']},'status':_0x244bbc[_0x46888e(0x148)],'createdAt':_0x244bbc[_0x46888e(0x168)]}));}async[a51_0x699ecc(0x150)](_0x4f8e20){const _0x488c97=a51_0x699ecc,_0x139d19=await database_1[_0x488c97(0x16e)][_0x488c97(0x15b)][_0x488c97(0x164)]({'where':{'id':_0x4f8e20},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x139d19)return null;return{'id':_0x139d19['id'],'fullName':_0x139d19[_0x488c97(0x151)],'username':_0x139d19[_0x488c97(0x173)],'telegramId':_0x139d19[_0x488c97(0x171)],'merchantUrl':_0x139d19['shopUrl'],'gateways':_0x139d19[_0x488c97(0x162)]?JSON[_0x488c97(0x156)](_0x139d19['paymentGateways']):null,'gatewaySettings':_0x139d19['gatewaySettings']?JSON[_0x488c97(0x156)](_0x139d19[_0x488c97(0x167)]):null,'publicKey':_0x139d19[_0x488c97(0x14a)],'wallets':{'usdtPolygonWallet':_0x139d19['usdtPolygonWallet'],'usdtTrcWallet':_0x139d19['usdtTrcWallet'],'usdtErcWallet':_0x139d19[_0x488c97(0x152)],'usdcPolygonWallet':_0x139d19[_0x488c97(0x16f)]},'status':_0x139d19[_0x488c97(0x148)],'createdAt':_0x139d19[_0x488c97(0x168)]};}async[a51_0x699ecc(0x14c)](_0x2ab55d,_0x2f378d){const _0x2af5c0=a51_0x699ecc,_0x177d67={..._0x2f378d};_0x2f378d[_0x2af5c0(0x147)]&&(_0x177d67[_0x2af5c0(0x147)]=await bcryptjs_1[_0x2af5c0(0x16e)]['hash'](_0x2f378d[_0x2af5c0(0x147)],0xc));_0x2f378d[_0x2af5c0(0x143)]&&(_0x177d67['name']=_0x2f378d[_0x2af5c0(0x143)],delete _0x177d67['fullName']);_0x2f378d[_0x2af5c0(0x142)]&&(_0x177d67[_0x2af5c0(0x171)]=_0x2f378d[_0x2af5c0(0x142)],delete _0x177d67[_0x2af5c0(0x142)]);_0x2f378d['merchantUrl']&&(_0x177d67[_0x2af5c0(0x166)]=_0x2f378d[_0x2af5c0(0x15f)],delete _0x177d67[_0x2af5c0(0x15f)]);_0x2f378d[_0x2af5c0(0x15d)]&&(_0x177d67[_0x2af5c0(0x162)]=JSON[_0x2af5c0(0x170)](_0x2f378d[_0x2af5c0(0x15d)]),delete _0x177d67['gateways']);_0x2f378d[_0x2af5c0(0x167)]&&(_0x177d67[_0x2af5c0(0x167)]=JSON[_0x2af5c0(0x170)](_0x2f378d[_0x2af5c0(0x167)]),delete _0x177d67[_0x2af5c0(0x167)]);_0x2f378d['wallets']&&(_0x2f378d[_0x2af5c0(0x146)][_0x2af5c0(0x159)]!==undefined&&(_0x177d67[_0x2af5c0(0x159)]=_0x2f378d[_0x2af5c0(0x146)][_0x2af5c0(0x159)]||null),_0x2f378d[_0x2af5c0(0x146)][_0x2af5c0(0x163)]!==undefined&&(_0x177d67[_0x2af5c0(0x163)]=_0x2f378d[_0x2af5c0(0x146)][_0x2af5c0(0x163)]||null),_0x2f378d['wallets'][_0x2af5c0(0x152)]!==undefined&&(_0x177d67[_0x2af5c0(0x152)]=_0x2f378d[_0x2af5c0(0x146)][_0x2af5c0(0x152)]||null),_0x2f378d['wallets'][_0x2af5c0(0x16f)]!==undefined&&(_0x177d67[_0x2af5c0(0x16f)]=_0x2f378d['wallets'][_0x2af5c0(0x16f)]||null),delete _0x177d67[_0x2af5c0(0x146)]);const _0x120aa6=await database_1[_0x2af5c0(0x16e)][_0x2af5c0(0x15b)]['update']({'where':{'id':_0x2ab55d},'data':_0x177d67,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x120aa6['id'],'fullName':_0x120aa6[_0x2af5c0(0x151)],'username':_0x120aa6[_0x2af5c0(0x173)],'telegramId':_0x120aa6[_0x2af5c0(0x171)],'merchantUrl':_0x120aa6[_0x2af5c0(0x166)],'gateways':_0x120aa6['paymentGateways']?JSON[_0x2af5c0(0x156)](_0x120aa6[_0x2af5c0(0x162)]):null,'gatewaySettings':_0x120aa6['gatewaySettings']?JSON['parse'](_0x120aa6[_0x2af5c0(0x167)]):null,'publicKey':_0x120aa6[_0x2af5c0(0x14a)],'wallets':{'usdtPolygonWallet':_0x120aa6[_0x2af5c0(0x159)],'usdtTrcWallet':_0x120aa6[_0x2af5c0(0x163)],'usdtErcWallet':_0x120aa6[_0x2af5c0(0x152)],'usdcPolygonWallet':_0x120aa6[_0x2af5c0(0x16f)]},'status':_0x120aa6[_0x2af5c0(0x148)],'createdAt':_0x120aa6[_0x2af5c0(0x168)]};}async[a51_0x699ecc(0x14b)](_0x29a004){const _0x470777=a51_0x699ecc;await database_1[_0x470777(0x16e)][_0x470777(0x15b)][_0x470777(0x15e)]({'where':{'id':_0x29a004}});}}exports[a51_0x699ecc(0x144)]=UserService;