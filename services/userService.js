'use strict';function a51_0x490d(_0x4256de,_0x4089e1){const _0x424207=a51_0x4242();return a51_0x490d=function(_0x490d3c,_0x13ca1f){_0x490d3c=_0x490d3c-0x1f1;let _0x5bc0ed=_0x424207[_0x490d3c];return _0x5bc0ed;},a51_0x490d(_0x4256de,_0x4089e1);}const a51_0x556f1e=a51_0x490d;function a51_0x4242(){const _0x15cfe1=['UserService','telegramId','__esModule','usdcPolygonWallet','password','shopUrl','stringify','fullName','gatewaySettings','hash','usdtTrcWallet','9942912ybXehA','default','toString','publicKey','122683RCFrkk','telegram','wallets','ACTIVE','Username\x20already\x20exists','gateways','8459466TqyhHw','desc','sk_','name','shop','4630seSiNu','84ApXUEQ','42775nWbXkt','hex','generateApiKeys','195792mXmmGt','createdAt','parse','322kvmnZt','paymentGateways','deleteUser','6123905bMYARH','updateUser','username','defineProperty','createUser','usdtErcWallet','../config/database','findUnique','randomBytes','bcryptjs','4DgOVbu','usdtPolygonWallet','3356931Nvskpz','status','merchantUrl'];a51_0x4242=function(){return _0x15cfe1;};return a51_0x4242();}(function(_0x35b987,_0x3eeac3){const _0x4cdd9e=a51_0x490d,_0x11d715=_0x35b987();while(!![]){try{const _0x144cfc=parseInt(_0x4cdd9e(0x216))/0x1*(parseInt(_0x4cdd9e(0x215))/0x2)+-parseInt(_0x4cdd9e(0x1f7))/0x3+-parseInt(_0x4cdd9e(0x1f5))/0x4*(parseInt(_0x4cdd9e(0x21f))/0x5)+-parseInt(_0x4cdd9e(0x20f))/0x6+-parseInt(_0x4cdd9e(0x21c))/0x7*(parseInt(_0x4cdd9e(0x219))/0x8)+-parseInt(_0x4cdd9e(0x205))/0x9+parseInt(_0x4cdd9e(0x214))/0xa*(parseInt(_0x4cdd9e(0x209))/0xb);if(_0x144cfc===_0x3eeac3)break;else _0x11d715['push'](_0x11d715['shift']());}catch(_0x505464){_0x11d715['push'](_0x11d715['shift']());}}}(a51_0x4242,0xee514));var __importDefault=this&&this['__importDefault']||function(_0x4a8236){return _0x4a8236&&_0x4a8236['__esModule']?_0x4a8236:{'default':_0x4a8236};};Object[a51_0x556f1e(0x222)](exports,a51_0x556f1e(0x1fc),{'value':!![]}),exports['UserService']=void 0x0;const bcryptjs_1=__importDefault(require(a51_0x556f1e(0x1f4))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a51_0x556f1e(0x1f1)));class UserService{[a51_0x556f1e(0x218)](){const _0x57d036=a51_0x556f1e,_0x332759='pk_'+crypto_1['default'][_0x57d036(0x1f3)](0x20)[_0x57d036(0x207)]('hex'),_0x16ff8d=_0x57d036(0x211)+crypto_1[_0x57d036(0x206)]['randomBytes'](0x20)[_0x57d036(0x207)](_0x57d036(0x217));return{'publicKey':_0x332759,'secretKey':_0x16ff8d};}async[a51_0x556f1e(0x223)](_0x173a7a){const _0x286a51=a51_0x556f1e,{fullName:_0x434232,username:_0x5ef895,password:_0x11c8d8,telegramId:_0x35c547,merchantUrl:_0xa1334b,gateways:_0x2974ae,gatewaySettings:_0x39b1cd,wallets:_0x3afe4e}=_0x173a7a,_0x8fa8c4=await database_1[_0x286a51(0x206)][_0x286a51(0x213)][_0x286a51(0x1f2)]({'where':{'username':_0x5ef895}});if(_0x8fa8c4)throw new Error(_0x286a51(0x20d));if(_0x35c547){const _0x13f1a2=await database_1[_0x286a51(0x206)]['shop'][_0x286a51(0x1f2)]({'where':{'telegram':_0x35c547}});if(_0x13f1a2)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x38f5ab=await bcryptjs_1[_0x286a51(0x206)][_0x286a51(0x203)](_0x11c8d8,0xc),{publicKey:_0x21f1fa,secretKey:_0x18a8ae}=this[_0x286a51(0x218)](),_0x196d2c=await database_1[_0x286a51(0x206)][_0x286a51(0x213)]['create']({'data':{'name':_0x434232,'username':_0x5ef895,'password':_0x38f5ab,'telegram':_0x35c547,'shopUrl':_0xa1334b,'paymentGateways':_0x2974ae?JSON['stringify'](_0x2974ae):null,'gatewaySettings':_0x39b1cd?JSON[_0x286a51(0x200)](_0x39b1cd):null,'usdtPolygonWallet':_0x3afe4e?.[_0x286a51(0x1f6)]||null,'usdtTrcWallet':_0x3afe4e?.[_0x286a51(0x204)]||null,'usdtErcWallet':_0x3afe4e?.[_0x286a51(0x224)]||null,'usdcPolygonWallet':_0x3afe4e?.['usdcPolygonWallet']||null,'publicKey':_0x21f1fa,'secretKey':_0x18a8ae,'status':_0x286a51(0x20c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x196d2c['id'],'fullName':_0x196d2c[_0x286a51(0x212)],'username':_0x196d2c[_0x286a51(0x221)],'telegramId':_0x196d2c['telegram'],'merchantUrl':_0x196d2c['shopUrl'],'gateways':_0x196d2c[_0x286a51(0x21d)]?JSON[_0x286a51(0x21b)](_0x196d2c[_0x286a51(0x21d)]):null,'gatewaySettings':_0x196d2c[_0x286a51(0x202)]?JSON[_0x286a51(0x21b)](_0x196d2c[_0x286a51(0x202)]):null,'publicKey':_0x196d2c['publicKey'],'wallets':{'usdtPolygonWallet':_0x196d2c[_0x286a51(0x1f6)],'usdtTrcWallet':_0x196d2c['usdtTrcWallet'],'usdtErcWallet':_0x196d2c['usdtErcWallet'],'usdcPolygonWallet':_0x196d2c[_0x286a51(0x1fd)]},'status':_0x196d2c['status'],'createdAt':_0x196d2c[_0x286a51(0x21a)]};}async['getAllUsers'](){const _0x262356=a51_0x556f1e,_0x27270c=await database_1[_0x262356(0x206)]['shop']['findMany']({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x262356(0x210)}});return _0x27270c['map'](_0x4d42d2=>({'id':_0x4d42d2['id'],'fullName':_0x4d42d2['name'],'username':_0x4d42d2[_0x262356(0x221)],'telegramId':_0x4d42d2[_0x262356(0x20a)],'merchantUrl':_0x4d42d2[_0x262356(0x1ff)],'gateways':_0x4d42d2[_0x262356(0x21d)]?JSON[_0x262356(0x21b)](_0x4d42d2[_0x262356(0x21d)]):null,'gatewaySettings':_0x4d42d2['gatewaySettings']?JSON[_0x262356(0x21b)](_0x4d42d2[_0x262356(0x202)]):null,'publicKey':_0x4d42d2[_0x262356(0x208)],'wallets':{'usdtPolygonWallet':_0x4d42d2[_0x262356(0x1f6)],'usdtTrcWallet':_0x4d42d2[_0x262356(0x204)],'usdtErcWallet':_0x4d42d2[_0x262356(0x224)],'usdcPolygonWallet':_0x4d42d2[_0x262356(0x1fd)]},'status':_0x4d42d2[_0x262356(0x1f8)],'createdAt':_0x4d42d2[_0x262356(0x21a)]}));}async['getUserById'](_0x12ea2b){const _0x54e714=a51_0x556f1e,_0x5e60d0=await database_1[_0x54e714(0x206)][_0x54e714(0x213)]['findUnique']({'where':{'id':_0x12ea2b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x5e60d0)return null;return{'id':_0x5e60d0['id'],'fullName':_0x5e60d0[_0x54e714(0x212)],'username':_0x5e60d0['username'],'telegramId':_0x5e60d0[_0x54e714(0x20a)],'merchantUrl':_0x5e60d0['shopUrl'],'gateways':_0x5e60d0[_0x54e714(0x21d)]?JSON[_0x54e714(0x21b)](_0x5e60d0[_0x54e714(0x21d)]):null,'gatewaySettings':_0x5e60d0[_0x54e714(0x202)]?JSON[_0x54e714(0x21b)](_0x5e60d0[_0x54e714(0x202)]):null,'publicKey':_0x5e60d0[_0x54e714(0x208)],'wallets':{'usdtPolygonWallet':_0x5e60d0[_0x54e714(0x1f6)],'usdtTrcWallet':_0x5e60d0[_0x54e714(0x204)],'usdtErcWallet':_0x5e60d0[_0x54e714(0x224)],'usdcPolygonWallet':_0x5e60d0['usdcPolygonWallet']},'status':_0x5e60d0[_0x54e714(0x1f8)],'createdAt':_0x5e60d0['createdAt']};}async[a51_0x556f1e(0x220)](_0x3db205,_0x2a983d){const _0x3e3418=a51_0x556f1e,_0x1e9fb9={..._0x2a983d};_0x2a983d['password']&&(_0x1e9fb9[_0x3e3418(0x1fe)]=await bcryptjs_1[_0x3e3418(0x206)][_0x3e3418(0x203)](_0x2a983d[_0x3e3418(0x1fe)],0xc));_0x2a983d[_0x3e3418(0x201)]&&(_0x1e9fb9[_0x3e3418(0x212)]=_0x2a983d['fullName'],delete _0x1e9fb9['fullName']);_0x2a983d['telegramId']&&(_0x1e9fb9[_0x3e3418(0x20a)]=_0x2a983d['telegramId'],delete _0x1e9fb9[_0x3e3418(0x1fb)]);_0x2a983d[_0x3e3418(0x1f9)]&&(_0x1e9fb9[_0x3e3418(0x1ff)]=_0x2a983d[_0x3e3418(0x1f9)],delete _0x1e9fb9[_0x3e3418(0x1f9)]);_0x2a983d[_0x3e3418(0x20e)]&&(_0x1e9fb9[_0x3e3418(0x21d)]=JSON[_0x3e3418(0x200)](_0x2a983d['gateways']),delete _0x1e9fb9[_0x3e3418(0x20e)]);_0x2a983d['gatewaySettings']&&(_0x1e9fb9['gatewaySettings']=JSON[_0x3e3418(0x200)](_0x2a983d[_0x3e3418(0x202)]),delete _0x1e9fb9[_0x3e3418(0x202)]);_0x2a983d[_0x3e3418(0x20b)]&&(_0x2a983d[_0x3e3418(0x20b)]['usdtPolygonWallet']!==undefined&&(_0x1e9fb9['usdtPolygonWallet']=_0x2a983d['wallets'][_0x3e3418(0x1f6)]||null),_0x2a983d[_0x3e3418(0x20b)][_0x3e3418(0x204)]!==undefined&&(_0x1e9fb9[_0x3e3418(0x204)]=_0x2a983d[_0x3e3418(0x20b)][_0x3e3418(0x204)]||null),_0x2a983d['wallets'][_0x3e3418(0x224)]!==undefined&&(_0x1e9fb9[_0x3e3418(0x224)]=_0x2a983d[_0x3e3418(0x20b)][_0x3e3418(0x224)]||null),_0x2a983d[_0x3e3418(0x20b)][_0x3e3418(0x1fd)]!==undefined&&(_0x1e9fb9[_0x3e3418(0x1fd)]=_0x2a983d['wallets'][_0x3e3418(0x1fd)]||null),delete _0x1e9fb9[_0x3e3418(0x20b)]);const _0x4ca04e=await database_1[_0x3e3418(0x206)][_0x3e3418(0x213)]['update']({'where':{'id':_0x3db205},'data':_0x1e9fb9,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4ca04e['id'],'fullName':_0x4ca04e[_0x3e3418(0x212)],'username':_0x4ca04e[_0x3e3418(0x221)],'telegramId':_0x4ca04e[_0x3e3418(0x20a)],'merchantUrl':_0x4ca04e['shopUrl'],'gateways':_0x4ca04e['paymentGateways']?JSON[_0x3e3418(0x21b)](_0x4ca04e[_0x3e3418(0x21d)]):null,'gatewaySettings':_0x4ca04e[_0x3e3418(0x202)]?JSON[_0x3e3418(0x21b)](_0x4ca04e['gatewaySettings']):null,'publicKey':_0x4ca04e['publicKey'],'wallets':{'usdtPolygonWallet':_0x4ca04e['usdtPolygonWallet'],'usdtTrcWallet':_0x4ca04e[_0x3e3418(0x204)],'usdtErcWallet':_0x4ca04e['usdtErcWallet'],'usdcPolygonWallet':_0x4ca04e[_0x3e3418(0x1fd)]},'status':_0x4ca04e[_0x3e3418(0x1f8)],'createdAt':_0x4ca04e['createdAt']};}async[a51_0x556f1e(0x21e)](_0x2e30fb){const _0x51d88c=a51_0x556f1e;await database_1[_0x51d88c(0x206)][_0x51d88c(0x213)]['delete']({'where':{'id':_0x2e30fb}});}}exports[a51_0x556f1e(0x1fa)]=UserService;