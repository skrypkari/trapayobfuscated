'use strict';const a59_0x2774b8=a59_0x1e5c;(function(_0x25b8f0,_0x56220d){const _0x53b305=a59_0x1e5c,_0x5b9769=_0x25b8f0();while(!![]){try{const _0x152be2=parseInt(_0x53b305(0x170))/0x1+parseInt(_0x53b305(0x15b))/0x2+parseInt(_0x53b305(0x162))/0x3*(-parseInt(_0x53b305(0x17f))/0x4)+-parseInt(_0x53b305(0x165))/0x5+-parseInt(_0x53b305(0x14c))/0x6+-parseInt(_0x53b305(0x160))/0x7+-parseInt(_0x53b305(0x17d))/0x8*(-parseInt(_0x53b305(0x17c))/0x9);if(_0x152be2===_0x56220d)break;else _0x5b9769['push'](_0x5b9769['shift']());}catch(_0x306252){_0x5b9769['push'](_0x5b9769['shift']());}}}(a59_0x1478,0x3cab5));function a59_0x1478(){const _0xe8b86d=['9897939abGTAM','8lEBmfA','shopUrl','799888rpWfur','randomBytes','2349528EkSLgQ','toString','findMany','Username\x20already\x20exists','ACTIVE','__importDefault','hash','telegramId','update','map','hex','bcryptjs','gateways','fullName','usdcPolygonWallet','725896YTcueR','gatewaySettings','status','findUnique','create','2463174iwHNxZ','default','6XjjYOc','paymentGateways','telegram','754390YTHEIR','delete','createdAt','__esModule','wallets','parse','shop','name','createUser','password','merchantUrl','80074peMkJm','usdtPolygonWallet','UserService','usdtErcWallet','generateApiKeys','stringify','pk_','desc','publicKey','defineProperty','username','usdtTrcWallet'];a59_0x1478=function(){return _0xe8b86d;};return a59_0x1478();}var __importDefault=this&&this[a59_0x2774b8(0x151)]||function(_0x41ee84){const _0x55de68=a59_0x2774b8;return _0x41ee84&&_0x41ee84[_0x55de68(0x168)]?_0x41ee84:{'default':_0x41ee84};};Object[a59_0x2774b8(0x179)](exports,a59_0x2774b8(0x168),{'value':!![]}),exports['UserService']=void 0x0;const bcryptjs_1=__importDefault(require(a59_0x2774b8(0x157))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));function a59_0x1e5c(_0x1731b2,_0x330c23){const _0x1478d4=a59_0x1478();return a59_0x1e5c=function(_0x1e5c7f,_0x2d0ffe){_0x1e5c7f=_0x1e5c7f-0x14c;let _0x17c439=_0x1478d4[_0x1e5c7f];return _0x17c439;},a59_0x1e5c(_0x1731b2,_0x330c23);}class UserService{[a59_0x2774b8(0x174)](){const _0x42d592=a59_0x2774b8,_0xecf1b=_0x42d592(0x176)+crypto_1['default']['randomBytes'](0x20)[_0x42d592(0x14d)](_0x42d592(0x156)),_0x3c76da='sk_'+crypto_1[_0x42d592(0x161)][_0x42d592(0x180)](0x20)[_0x42d592(0x14d)](_0x42d592(0x156));return{'publicKey':_0xecf1b,'secretKey':_0x3c76da};}async[a59_0x2774b8(0x16d)](_0x8ec5ba){const _0x458a8d=a59_0x2774b8,{fullName:_0x3dbaa2,username:_0x5cb1fe,password:_0x15d32a,telegramId:_0x96354b,merchantUrl:_0x3c65d6,gateways:_0x5cda79,gatewaySettings:_0x4ae0e,wallets:_0x476cd3}=_0x8ec5ba,_0x7e82c7=await database_1[_0x458a8d(0x161)][_0x458a8d(0x16b)]['findUnique']({'where':{'username':_0x5cb1fe}});if(_0x7e82c7)throw new Error(_0x458a8d(0x14f));if(_0x96354b){const _0x208601=await database_1['default'][_0x458a8d(0x16b)][_0x458a8d(0x15e)]({'where':{'telegram':_0x96354b}});if(_0x208601)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x19dfca=await bcryptjs_1[_0x458a8d(0x161)]['hash'](_0x15d32a,0xc),{publicKey:_0x7c4753,secretKey:_0x26c079}=this[_0x458a8d(0x174)](),_0x8e0b0e=await database_1['default'][_0x458a8d(0x16b)][_0x458a8d(0x15f)]({'data':{'name':_0x3dbaa2,'username':_0x5cb1fe,'password':_0x19dfca,'telegram':_0x96354b,'shopUrl':_0x3c65d6,'paymentGateways':_0x5cda79?JSON[_0x458a8d(0x175)](_0x5cda79):null,'gatewaySettings':_0x4ae0e?JSON[_0x458a8d(0x175)](_0x4ae0e):null,'usdtPolygonWallet':_0x476cd3?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x476cd3?.[_0x458a8d(0x17b)]||null,'usdtErcWallet':_0x476cd3?.[_0x458a8d(0x173)]||null,'usdcPolygonWallet':_0x476cd3?.[_0x458a8d(0x15a)]||null,'publicKey':_0x7c4753,'secretKey':_0x26c079,'status':_0x458a8d(0x150)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x8e0b0e['id'],'fullName':_0x8e0b0e[_0x458a8d(0x16c)],'username':_0x8e0b0e['username'],'telegramId':_0x8e0b0e[_0x458a8d(0x164)],'merchantUrl':_0x8e0b0e[_0x458a8d(0x17e)],'gateways':_0x8e0b0e['paymentGateways']?JSON['parse'](_0x8e0b0e['paymentGateways']):null,'gatewaySettings':_0x8e0b0e[_0x458a8d(0x15c)]?JSON[_0x458a8d(0x16a)](_0x8e0b0e['gatewaySettings']):null,'publicKey':_0x8e0b0e[_0x458a8d(0x178)],'wallets':{'usdtPolygonWallet':_0x8e0b0e[_0x458a8d(0x171)],'usdtTrcWallet':_0x8e0b0e['usdtTrcWallet'],'usdtErcWallet':_0x8e0b0e['usdtErcWallet'],'usdcPolygonWallet':_0x8e0b0e[_0x458a8d(0x15a)]},'status':_0x8e0b0e['status'],'createdAt':_0x8e0b0e[_0x458a8d(0x167)]};}async['getAllUsers'](){const _0x19afd1=a59_0x2774b8,_0x1ba7f2=await database_1[_0x19afd1(0x161)][_0x19afd1(0x16b)][_0x19afd1(0x14e)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x19afd1(0x177)}});return _0x1ba7f2[_0x19afd1(0x155)](_0x1d9518=>({'id':_0x1d9518['id'],'fullName':_0x1d9518[_0x19afd1(0x16c)],'username':_0x1d9518[_0x19afd1(0x17a)],'telegramId':_0x1d9518[_0x19afd1(0x164)],'merchantUrl':_0x1d9518[_0x19afd1(0x17e)],'gateways':_0x1d9518[_0x19afd1(0x163)]?JSON['parse'](_0x1d9518[_0x19afd1(0x163)]):null,'gatewaySettings':_0x1d9518['gatewaySettings']?JSON[_0x19afd1(0x16a)](_0x1d9518[_0x19afd1(0x15c)]):null,'publicKey':_0x1d9518[_0x19afd1(0x178)],'wallets':{'usdtPolygonWallet':_0x1d9518[_0x19afd1(0x171)],'usdtTrcWallet':_0x1d9518[_0x19afd1(0x17b)],'usdtErcWallet':_0x1d9518[_0x19afd1(0x173)],'usdcPolygonWallet':_0x1d9518[_0x19afd1(0x15a)]},'status':_0x1d9518[_0x19afd1(0x15d)],'createdAt':_0x1d9518[_0x19afd1(0x167)]}));}async['getUserById'](_0x5c527c){const _0x18a5cf=a59_0x2774b8,_0x685cee=await database_1['default'][_0x18a5cf(0x16b)]['findUnique']({'where':{'id':_0x5c527c},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x685cee)return null;return{'id':_0x685cee['id'],'fullName':_0x685cee[_0x18a5cf(0x16c)],'username':_0x685cee['username'],'telegramId':_0x685cee[_0x18a5cf(0x164)],'merchantUrl':_0x685cee[_0x18a5cf(0x17e)],'gateways':_0x685cee[_0x18a5cf(0x163)]?JSON[_0x18a5cf(0x16a)](_0x685cee[_0x18a5cf(0x163)]):null,'gatewaySettings':_0x685cee[_0x18a5cf(0x15c)]?JSON['parse'](_0x685cee[_0x18a5cf(0x15c)]):null,'publicKey':_0x685cee[_0x18a5cf(0x178)],'wallets':{'usdtPolygonWallet':_0x685cee[_0x18a5cf(0x171)],'usdtTrcWallet':_0x685cee[_0x18a5cf(0x17b)],'usdtErcWallet':_0x685cee[_0x18a5cf(0x173)],'usdcPolygonWallet':_0x685cee['usdcPolygonWallet']},'status':_0x685cee[_0x18a5cf(0x15d)],'createdAt':_0x685cee[_0x18a5cf(0x167)]};}async['updateUser'](_0x25228a,_0x13a04e){const _0x376fa7=a59_0x2774b8,_0x5bea62={..._0x13a04e};_0x13a04e[_0x376fa7(0x16e)]&&(_0x5bea62[_0x376fa7(0x16e)]=await bcryptjs_1[_0x376fa7(0x161)][_0x376fa7(0x152)](_0x13a04e['password'],0xc));_0x13a04e[_0x376fa7(0x159)]&&(_0x5bea62[_0x376fa7(0x16c)]=_0x13a04e[_0x376fa7(0x159)],delete _0x5bea62['fullName']);_0x13a04e['telegramId']&&(_0x5bea62[_0x376fa7(0x164)]=_0x13a04e[_0x376fa7(0x153)],delete _0x5bea62[_0x376fa7(0x153)]);_0x13a04e[_0x376fa7(0x16f)]&&(_0x5bea62[_0x376fa7(0x17e)]=_0x13a04e[_0x376fa7(0x16f)],delete _0x5bea62[_0x376fa7(0x16f)]);_0x13a04e[_0x376fa7(0x158)]&&(_0x5bea62[_0x376fa7(0x163)]=JSON['stringify'](_0x13a04e['gateways']),delete _0x5bea62[_0x376fa7(0x158)]);_0x13a04e[_0x376fa7(0x15c)]&&(_0x5bea62[_0x376fa7(0x15c)]=JSON[_0x376fa7(0x175)](_0x13a04e[_0x376fa7(0x15c)]),delete _0x5bea62[_0x376fa7(0x15c)]);_0x13a04e['wallets']&&(_0x13a04e[_0x376fa7(0x169)][_0x376fa7(0x171)]!==undefined&&(_0x5bea62[_0x376fa7(0x171)]=_0x13a04e[_0x376fa7(0x169)][_0x376fa7(0x171)]||null),_0x13a04e[_0x376fa7(0x169)][_0x376fa7(0x17b)]!==undefined&&(_0x5bea62[_0x376fa7(0x17b)]=_0x13a04e['wallets']['usdtTrcWallet']||null),_0x13a04e[_0x376fa7(0x169)]['usdtErcWallet']!==undefined&&(_0x5bea62[_0x376fa7(0x173)]=_0x13a04e[_0x376fa7(0x169)]['usdtErcWallet']||null),_0x13a04e['wallets'][_0x376fa7(0x15a)]!==undefined&&(_0x5bea62[_0x376fa7(0x15a)]=_0x13a04e['wallets'][_0x376fa7(0x15a)]||null),delete _0x5bea62[_0x376fa7(0x169)]);const _0x17c73d=await database_1[_0x376fa7(0x161)][_0x376fa7(0x16b)][_0x376fa7(0x154)]({'where':{'id':_0x25228a},'data':_0x5bea62,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x17c73d['id'],'fullName':_0x17c73d[_0x376fa7(0x16c)],'username':_0x17c73d[_0x376fa7(0x17a)],'telegramId':_0x17c73d[_0x376fa7(0x164)],'merchantUrl':_0x17c73d[_0x376fa7(0x17e)],'gateways':_0x17c73d['paymentGateways']?JSON[_0x376fa7(0x16a)](_0x17c73d['paymentGateways']):null,'gatewaySettings':_0x17c73d[_0x376fa7(0x15c)]?JSON[_0x376fa7(0x16a)](_0x17c73d['gatewaySettings']):null,'publicKey':_0x17c73d[_0x376fa7(0x178)],'wallets':{'usdtPolygonWallet':_0x17c73d[_0x376fa7(0x171)],'usdtTrcWallet':_0x17c73d[_0x376fa7(0x17b)],'usdtErcWallet':_0x17c73d[_0x376fa7(0x173)],'usdcPolygonWallet':_0x17c73d[_0x376fa7(0x15a)]},'status':_0x17c73d[_0x376fa7(0x15d)],'createdAt':_0x17c73d[_0x376fa7(0x167)]};}async['deleteUser'](_0x3e5f7d){const _0x3b0003=a59_0x2774b8;await database_1['default'][_0x3b0003(0x16b)][_0x3b0003(0x166)]({'where':{'id':_0x3e5f7d}});}}exports[a59_0x2774b8(0x172)]=UserService;