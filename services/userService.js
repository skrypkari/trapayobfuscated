'use strict';const a51_0x313801=a51_0x1f07;(function(_0x12d96c,_0x726e40){const _0x1f3c7c=a51_0x1f07,_0x1a43dd=_0x12d96c();while(!![]){try{const _0x2a0793=-parseInt(_0x1f3c7c(0x18f))/0x1+-parseInt(_0x1f3c7c(0x16e))/0x2*(parseInt(_0x1f3c7c(0x16a))/0x3)+parseInt(_0x1f3c7c(0x17a))/0x4*(-parseInt(_0x1f3c7c(0x178))/0x5)+parseInt(_0x1f3c7c(0x170))/0x6+-parseInt(_0x1f3c7c(0x165))/0x7+parseInt(_0x1f3c7c(0x161))/0x8*(-parseInt(_0x1f3c7c(0x17c))/0x9)+parseInt(_0x1f3c7c(0x17b))/0xa;if(_0x2a0793===_0x726e40)break;else _0x1a43dd['push'](_0x1a43dd['shift']());}catch(_0x530041){_0x1a43dd['push'](_0x1a43dd['shift']());}}}(a51_0x445c,0x5da39));function a51_0x1f07(_0x4a3d06,_0x58f292){const _0x445c3d=a51_0x445c();return a51_0x1f07=function(_0x1f07b3,_0x5cea4e){_0x1f07b3=_0x1f07b3-0x155;let _0x216403=_0x445c3d[_0x1f07b3];return _0x216403;},a51_0x1f07(_0x4a3d06,_0x58f292);}var __importDefault=this&&this[a51_0x313801(0x16f)]||function(_0xddf053){return _0xddf053&&_0xddf053['__esModule']?_0xddf053:{'default':_0xddf053};};function a51_0x445c(){const _0x1a1d53=['merchantUrl','fullName','update','updateUser','randomBytes','default','getAllUsers','Telegram\x20username\x20already\x20exists','shop','crypto','gateways','3752gGteBZ','password','gatewaySettings','getUserById','843605xmNqbw','map','delete','sk_','hash','11694YsOOTb','Username\x20already\x20exists','telegramId','pk_','118JKqLtV','__importDefault','456666PvNoOl','findMany','username','__esModule','wallets','create','hex','paymentGateways','884060snFfRd','UserService','16rQYCwI','22774990WBMTof','4734zkAPFG','usdcPolygonWallet','shopUrl','defineProperty','usdtErcWallet','desc','stringify','usdtTrcWallet','findUnique','telegram','toString','name','status','deleteUser','createdAt','usdtPolygonWallet','ACTIVE','publicKey','createUser','665626VTJdEs','parse','generateApiKeys'];a51_0x445c=function(){return _0x1a1d53;};return a51_0x445c();}Object[a51_0x313801(0x17f)](exports,a51_0x313801(0x173),{'value':!![]}),exports['UserService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a51_0x313801(0x15f))),database_1=__importDefault(require('../config/database'));class UserService{['generateApiKeys'](){const _0x461a34=a51_0x313801,_0x1f8bf1=_0x461a34(0x16d)+crypto_1['default'][_0x461a34(0x15a)](0x20)['toString']('hex'),_0x165f47=_0x461a34(0x168)+crypto_1[_0x461a34(0x15b)]['randomBytes'](0x20)[_0x461a34(0x186)](_0x461a34(0x176));return{'publicKey':_0x1f8bf1,'secretKey':_0x165f47};}async[a51_0x313801(0x18e)](_0x436569){const _0x437ada=a51_0x313801,{fullName:_0x1fba08,username:_0x580b6d,password:_0xb46a75,telegramId:_0x2125ca,merchantUrl:_0x30106e,gateways:_0x1855b8,gatewaySettings:_0x4be6b8,wallets:_0x356b5d}=_0x436569,_0x4e443c=await database_1[_0x437ada(0x15b)][_0x437ada(0x15e)][_0x437ada(0x184)]({'where':{'username':_0x580b6d}});if(_0x4e443c)throw new Error(_0x437ada(0x16b));if(_0x2125ca){const _0x663c02=await database_1[_0x437ada(0x15b)][_0x437ada(0x15e)]['findUnique']({'where':{'telegram':_0x2125ca}});if(_0x663c02)throw new Error(_0x437ada(0x15d));}const _0x46e9a5=await bcryptjs_1[_0x437ada(0x15b)][_0x437ada(0x169)](_0xb46a75,0xc),{publicKey:_0x8b6750,secretKey:_0x4602cc}=this[_0x437ada(0x155)](),_0xb33222=await database_1[_0x437ada(0x15b)][_0x437ada(0x15e)][_0x437ada(0x175)]({'data':{'name':_0x1fba08,'username':_0x580b6d,'password':_0x46e9a5,'telegram':_0x2125ca,'shopUrl':_0x30106e,'paymentGateways':_0x1855b8?JSON[_0x437ada(0x182)](_0x1855b8):null,'gatewaySettings':_0x4be6b8?JSON[_0x437ada(0x182)](_0x4be6b8):null,'usdtPolygonWallet':_0x356b5d?.[_0x437ada(0x18b)]||null,'usdtTrcWallet':_0x356b5d?.[_0x437ada(0x183)]||null,'usdtErcWallet':_0x356b5d?.[_0x437ada(0x180)]||null,'usdcPolygonWallet':_0x356b5d?.[_0x437ada(0x17d)]||null,'publicKey':_0x8b6750,'secretKey':_0x4602cc,'status':_0x437ada(0x18c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xb33222['id'],'fullName':_0xb33222['name'],'username':_0xb33222['username'],'telegramId':_0xb33222[_0x437ada(0x185)],'merchantUrl':_0xb33222['shopUrl'],'gateways':_0xb33222[_0x437ada(0x177)]?JSON[_0x437ada(0x190)](_0xb33222['paymentGateways']):null,'gatewaySettings':_0xb33222['gatewaySettings']?JSON[_0x437ada(0x190)](_0xb33222['gatewaySettings']):null,'publicKey':_0xb33222[_0x437ada(0x18d)],'wallets':{'usdtPolygonWallet':_0xb33222[_0x437ada(0x18b)],'usdtTrcWallet':_0xb33222[_0x437ada(0x183)],'usdtErcWallet':_0xb33222[_0x437ada(0x180)],'usdcPolygonWallet':_0xb33222[_0x437ada(0x17d)]},'status':_0xb33222[_0x437ada(0x188)],'createdAt':_0xb33222[_0x437ada(0x18a)]};}async[a51_0x313801(0x15c)](){const _0x19d0d6=a51_0x313801,_0x4d70ac=await database_1[_0x19d0d6(0x15b)][_0x19d0d6(0x15e)][_0x19d0d6(0x171)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x19d0d6(0x181)}});return _0x4d70ac[_0x19d0d6(0x166)](_0x1834ce=>({'id':_0x1834ce['id'],'fullName':_0x1834ce[_0x19d0d6(0x187)],'username':_0x1834ce['username'],'telegramId':_0x1834ce[_0x19d0d6(0x185)],'merchantUrl':_0x1834ce[_0x19d0d6(0x17e)],'gateways':_0x1834ce[_0x19d0d6(0x177)]?JSON[_0x19d0d6(0x190)](_0x1834ce[_0x19d0d6(0x177)]):null,'gatewaySettings':_0x1834ce[_0x19d0d6(0x163)]?JSON[_0x19d0d6(0x190)](_0x1834ce[_0x19d0d6(0x163)]):null,'publicKey':_0x1834ce['publicKey'],'wallets':{'usdtPolygonWallet':_0x1834ce[_0x19d0d6(0x18b)],'usdtTrcWallet':_0x1834ce[_0x19d0d6(0x183)],'usdtErcWallet':_0x1834ce[_0x19d0d6(0x180)],'usdcPolygonWallet':_0x1834ce[_0x19d0d6(0x17d)]},'status':_0x1834ce[_0x19d0d6(0x188)],'createdAt':_0x1834ce[_0x19d0d6(0x18a)]}));}async[a51_0x313801(0x164)](_0x135e9c){const _0x8600d5=a51_0x313801,_0x1281f1=await database_1[_0x8600d5(0x15b)]['shop'][_0x8600d5(0x184)]({'where':{'id':_0x135e9c},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x1281f1)return null;return{'id':_0x1281f1['id'],'fullName':_0x1281f1[_0x8600d5(0x187)],'username':_0x1281f1['username'],'telegramId':_0x1281f1[_0x8600d5(0x185)],'merchantUrl':_0x1281f1[_0x8600d5(0x17e)],'gateways':_0x1281f1[_0x8600d5(0x177)]?JSON[_0x8600d5(0x190)](_0x1281f1['paymentGateways']):null,'gatewaySettings':_0x1281f1['gatewaySettings']?JSON[_0x8600d5(0x190)](_0x1281f1['gatewaySettings']):null,'publicKey':_0x1281f1[_0x8600d5(0x18d)],'wallets':{'usdtPolygonWallet':_0x1281f1[_0x8600d5(0x18b)],'usdtTrcWallet':_0x1281f1[_0x8600d5(0x183)],'usdtErcWallet':_0x1281f1[_0x8600d5(0x180)],'usdcPolygonWallet':_0x1281f1[_0x8600d5(0x17d)]},'status':_0x1281f1['status'],'createdAt':_0x1281f1[_0x8600d5(0x18a)]};}async[a51_0x313801(0x159)](_0x51dc34,_0x43c347){const _0x452895=a51_0x313801,_0x34ff5f={..._0x43c347};_0x43c347[_0x452895(0x162)]&&(_0x34ff5f[_0x452895(0x162)]=await bcryptjs_1[_0x452895(0x15b)][_0x452895(0x169)](_0x43c347[_0x452895(0x162)],0xc));_0x43c347['fullName']&&(_0x34ff5f[_0x452895(0x187)]=_0x43c347[_0x452895(0x157)],delete _0x34ff5f[_0x452895(0x157)]);_0x43c347[_0x452895(0x16c)]&&(_0x34ff5f[_0x452895(0x185)]=_0x43c347[_0x452895(0x16c)],delete _0x34ff5f[_0x452895(0x16c)]);_0x43c347[_0x452895(0x156)]&&(_0x34ff5f[_0x452895(0x17e)]=_0x43c347[_0x452895(0x156)],delete _0x34ff5f['merchantUrl']);_0x43c347[_0x452895(0x160)]&&(_0x34ff5f[_0x452895(0x177)]=JSON['stringify'](_0x43c347['gateways']),delete _0x34ff5f[_0x452895(0x160)]);_0x43c347[_0x452895(0x163)]&&(_0x34ff5f['gatewaySettings']=JSON['stringify'](_0x43c347[_0x452895(0x163)]),delete _0x34ff5f[_0x452895(0x163)]);_0x43c347[_0x452895(0x174)]&&(_0x43c347[_0x452895(0x174)][_0x452895(0x18b)]!==undefined&&(_0x34ff5f[_0x452895(0x18b)]=_0x43c347[_0x452895(0x174)][_0x452895(0x18b)]||null),_0x43c347[_0x452895(0x174)]['usdtTrcWallet']!==undefined&&(_0x34ff5f[_0x452895(0x183)]=_0x43c347[_0x452895(0x174)]['usdtTrcWallet']||null),_0x43c347[_0x452895(0x174)][_0x452895(0x180)]!==undefined&&(_0x34ff5f[_0x452895(0x180)]=_0x43c347['wallets']['usdtErcWallet']||null),_0x43c347['wallets'][_0x452895(0x17d)]!==undefined&&(_0x34ff5f[_0x452895(0x17d)]=_0x43c347[_0x452895(0x174)]['usdcPolygonWallet']||null),delete _0x34ff5f['wallets']);const _0x576e2a=await database_1['default']['shop'][_0x452895(0x158)]({'where':{'id':_0x51dc34},'data':_0x34ff5f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x576e2a['id'],'fullName':_0x576e2a[_0x452895(0x187)],'username':_0x576e2a[_0x452895(0x172)],'telegramId':_0x576e2a[_0x452895(0x185)],'merchantUrl':_0x576e2a[_0x452895(0x17e)],'gateways':_0x576e2a[_0x452895(0x177)]?JSON[_0x452895(0x190)](_0x576e2a[_0x452895(0x177)]):null,'gatewaySettings':_0x576e2a[_0x452895(0x163)]?JSON['parse'](_0x576e2a['gatewaySettings']):null,'publicKey':_0x576e2a[_0x452895(0x18d)],'wallets':{'usdtPolygonWallet':_0x576e2a[_0x452895(0x18b)],'usdtTrcWallet':_0x576e2a[_0x452895(0x183)],'usdtErcWallet':_0x576e2a[_0x452895(0x180)],'usdcPolygonWallet':_0x576e2a['usdcPolygonWallet']},'status':_0x576e2a[_0x452895(0x188)],'createdAt':_0x576e2a[_0x452895(0x18a)]};}async[a51_0x313801(0x189)](_0x3897cd){const _0x5f50b9=a51_0x313801;await database_1[_0x5f50b9(0x15b)][_0x5f50b9(0x15e)][_0x5f50b9(0x167)]({'where':{'id':_0x3897cd}});}}exports[a51_0x313801(0x179)]=UserService;