'use strict';function a56_0x5147(){const _0x2ff1b4=['createdAt','pk_','merchantUrl','usdtErcWallet','getAllUsers','publicKey','5024KeHtGH','findUnique','username','Username\x20already\x20exists','toString','14505930ozMdLh','572522ZornOY','parse','map','crypto','hex','usdcPolygonWallet','gatewaySettings','desc','defineProperty','wallets','updateUser','name','shopUrl','fullName','telegram','412oehJbT','9786VBHSis','10KyrHmX','hash','ACTIVE','status','randomBytes','default','stringify','shop','__importDefault','7637XxyQoI','getUserById','sk_','password','paymentGateways','__esModule','UserService','435498YpkpGA','Telegram\x20username\x20already\x20exists','693792ypkbpB','gateways','findMany','3609135aGImrO','usdtTrcWallet','usdtPolygonWallet','telegramId'];a56_0x5147=function(){return _0x2ff1b4;};return a56_0x5147();}const a56_0xbc4ea=a56_0x5e62;function a56_0x5e62(_0x44751f,_0x1e8998){const _0x514749=a56_0x5147();return a56_0x5e62=function(_0x5e622a,_0xccffd4){_0x5e622a=_0x5e622a-0x170;let _0x2c7f92=_0x514749[_0x5e622a];return _0x2c7f92;},a56_0x5e62(_0x44751f,_0x1e8998);}(function(_0x3c55d7,_0x24554a){const _0x28b591=a56_0x5e62,_0x3e1302=_0x3c55d7();while(!![]){try{const _0xce7f55=-parseInt(_0x28b591(0x17c))/0x1+-parseInt(_0x28b591(0x18b))/0x2*(parseInt(_0x28b591(0x18c))/0x3)+parseInt(_0x28b591(0x19f))/0x4+-parseInt(_0x28b591(0x1a2))/0x5+-parseInt(_0x28b591(0x19d))/0x6+-parseInt(_0x28b591(0x196))/0x7*(-parseInt(_0x28b591(0x176))/0x8)+parseInt(_0x28b591(0x17b))/0x9*(parseInt(_0x28b591(0x18d))/0xa);if(_0xce7f55===_0x24554a)break;else _0x3e1302['push'](_0x3e1302['shift']());}catch(_0x25a5c3){_0x3e1302['push'](_0x3e1302['shift']());}}}(a56_0x5147,0x69566));var __importDefault=this&&this[a56_0xbc4ea(0x195)]||function(_0x495731){const _0x13aa90=a56_0xbc4ea;return _0x495731&&_0x495731[_0x13aa90(0x19b)]?_0x495731:{'default':_0x495731};};Object[a56_0xbc4ea(0x184)](exports,'__esModule',{'value':!![]}),exports[a56_0xbc4ea(0x19c)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a56_0xbc4ea(0x17f))),database_1=__importDefault(require('../config/database'));class UserService{['generateApiKeys'](){const _0x19c0cc=a56_0xbc4ea,_0x109a92=_0x19c0cc(0x171)+crypto_1[_0x19c0cc(0x192)]['randomBytes'](0x20)['toString'](_0x19c0cc(0x180)),_0x1b1075=_0x19c0cc(0x198)+crypto_1['default'][_0x19c0cc(0x191)](0x20)[_0x19c0cc(0x17a)](_0x19c0cc(0x180));return{'publicKey':_0x109a92,'secretKey':_0x1b1075};}async['createUser'](_0xdf95ce){const _0x82ce2f=a56_0xbc4ea,{fullName:_0x2e68ac,username:_0x2e9c76,password:_0x3c7205,telegramId:_0xc6b124,merchantUrl:_0xfd8c73,gateways:_0x28286f,gatewaySettings:_0x5c0a90,wallets:_0x45eadc}=_0xdf95ce,_0x5306d3=await database_1[_0x82ce2f(0x192)][_0x82ce2f(0x194)][_0x82ce2f(0x177)]({'where':{'username':_0x2e9c76}});if(_0x5306d3)throw new Error(_0x82ce2f(0x179));if(_0xc6b124){const _0x2f51c0=await database_1[_0x82ce2f(0x192)][_0x82ce2f(0x194)]['findUnique']({'where':{'telegram':_0xc6b124}});if(_0x2f51c0)throw new Error(_0x82ce2f(0x19e));}const _0x57af50=await bcryptjs_1['default'][_0x82ce2f(0x18e)](_0x3c7205,0xc),{publicKey:_0x2a8c9a,secretKey:_0x286635}=this['generateApiKeys'](),_0x38d416=await database_1[_0x82ce2f(0x192)]['shop']['create']({'data':{'name':_0x2e68ac,'username':_0x2e9c76,'password':_0x57af50,'telegram':_0xc6b124,'shopUrl':_0xfd8c73,'paymentGateways':_0x28286f?JSON[_0x82ce2f(0x193)](_0x28286f):null,'gatewaySettings':_0x5c0a90?JSON['stringify'](_0x5c0a90):null,'usdtPolygonWallet':_0x45eadc?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x45eadc?.[_0x82ce2f(0x1a3)]||null,'usdtErcWallet':_0x45eadc?.[_0x82ce2f(0x173)]||null,'usdcPolygonWallet':_0x45eadc?.['usdcPolygonWallet']||null,'publicKey':_0x2a8c9a,'secretKey':_0x286635,'status':_0x82ce2f(0x18f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x38d416['id'],'fullName':_0x38d416[_0x82ce2f(0x187)],'username':_0x38d416[_0x82ce2f(0x178)],'telegramId':_0x38d416[_0x82ce2f(0x18a)],'merchantUrl':_0x38d416[_0x82ce2f(0x188)],'gateways':_0x38d416['paymentGateways']?JSON[_0x82ce2f(0x17d)](_0x38d416[_0x82ce2f(0x19a)]):null,'gatewaySettings':_0x38d416[_0x82ce2f(0x182)]?JSON['parse'](_0x38d416[_0x82ce2f(0x182)]):null,'publicKey':_0x38d416[_0x82ce2f(0x175)],'wallets':{'usdtPolygonWallet':_0x38d416['usdtPolygonWallet'],'usdtTrcWallet':_0x38d416['usdtTrcWallet'],'usdtErcWallet':_0x38d416[_0x82ce2f(0x173)],'usdcPolygonWallet':_0x38d416[_0x82ce2f(0x181)]},'status':_0x38d416[_0x82ce2f(0x190)],'createdAt':_0x38d416[_0x82ce2f(0x170)]};}async[a56_0xbc4ea(0x174)](){const _0x4b5a40=a56_0xbc4ea,_0x503ce8=await database_1[_0x4b5a40(0x192)][_0x4b5a40(0x194)][_0x4b5a40(0x1a1)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x4b5a40(0x183)}});return _0x503ce8[_0x4b5a40(0x17e)](_0x8a968=>({'id':_0x8a968['id'],'fullName':_0x8a968[_0x4b5a40(0x187)],'username':_0x8a968[_0x4b5a40(0x178)],'telegramId':_0x8a968['telegram'],'merchantUrl':_0x8a968[_0x4b5a40(0x188)],'gateways':_0x8a968[_0x4b5a40(0x19a)]?JSON[_0x4b5a40(0x17d)](_0x8a968[_0x4b5a40(0x19a)]):null,'gatewaySettings':_0x8a968['gatewaySettings']?JSON[_0x4b5a40(0x17d)](_0x8a968[_0x4b5a40(0x182)]):null,'publicKey':_0x8a968['publicKey'],'wallets':{'usdtPolygonWallet':_0x8a968[_0x4b5a40(0x1a4)],'usdtTrcWallet':_0x8a968['usdtTrcWallet'],'usdtErcWallet':_0x8a968[_0x4b5a40(0x173)],'usdcPolygonWallet':_0x8a968[_0x4b5a40(0x181)]},'status':_0x8a968[_0x4b5a40(0x190)],'createdAt':_0x8a968[_0x4b5a40(0x170)]}));}async[a56_0xbc4ea(0x197)](_0x585a2d){const _0x435b10=a56_0xbc4ea,_0x44eb5f=await database_1[_0x435b10(0x192)]['shop'][_0x435b10(0x177)]({'where':{'id':_0x585a2d},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x44eb5f)return null;return{'id':_0x44eb5f['id'],'fullName':_0x44eb5f[_0x435b10(0x187)],'username':_0x44eb5f[_0x435b10(0x178)],'telegramId':_0x44eb5f[_0x435b10(0x18a)],'merchantUrl':_0x44eb5f[_0x435b10(0x188)],'gateways':_0x44eb5f['paymentGateways']?JSON[_0x435b10(0x17d)](_0x44eb5f[_0x435b10(0x19a)]):null,'gatewaySettings':_0x44eb5f[_0x435b10(0x182)]?JSON['parse'](_0x44eb5f['gatewaySettings']):null,'publicKey':_0x44eb5f[_0x435b10(0x175)],'wallets':{'usdtPolygonWallet':_0x44eb5f[_0x435b10(0x1a4)],'usdtTrcWallet':_0x44eb5f[_0x435b10(0x1a3)],'usdtErcWallet':_0x44eb5f['usdtErcWallet'],'usdcPolygonWallet':_0x44eb5f[_0x435b10(0x181)]},'status':_0x44eb5f['status'],'createdAt':_0x44eb5f['createdAt']};}async[a56_0xbc4ea(0x186)](_0x4d9d70,_0x3ddc5e){const _0x216634=a56_0xbc4ea,_0x12cde7={..._0x3ddc5e};_0x3ddc5e[_0x216634(0x199)]&&(_0x12cde7[_0x216634(0x199)]=await bcryptjs_1[_0x216634(0x192)][_0x216634(0x18e)](_0x3ddc5e[_0x216634(0x199)],0xc));_0x3ddc5e[_0x216634(0x189)]&&(_0x12cde7[_0x216634(0x187)]=_0x3ddc5e[_0x216634(0x189)],delete _0x12cde7['fullName']);_0x3ddc5e[_0x216634(0x1a5)]&&(_0x12cde7[_0x216634(0x18a)]=_0x3ddc5e['telegramId'],delete _0x12cde7[_0x216634(0x1a5)]);_0x3ddc5e[_0x216634(0x172)]&&(_0x12cde7[_0x216634(0x188)]=_0x3ddc5e['merchantUrl'],delete _0x12cde7[_0x216634(0x172)]);_0x3ddc5e[_0x216634(0x1a0)]&&(_0x12cde7[_0x216634(0x19a)]=JSON[_0x216634(0x193)](_0x3ddc5e['gateways']),delete _0x12cde7['gateways']);_0x3ddc5e[_0x216634(0x182)]&&(_0x12cde7['gatewaySettings']=JSON[_0x216634(0x193)](_0x3ddc5e[_0x216634(0x182)]),delete _0x12cde7[_0x216634(0x182)]);_0x3ddc5e[_0x216634(0x185)]&&(_0x3ddc5e[_0x216634(0x185)][_0x216634(0x1a4)]!==undefined&&(_0x12cde7[_0x216634(0x1a4)]=_0x3ddc5e[_0x216634(0x185)][_0x216634(0x1a4)]||null),_0x3ddc5e[_0x216634(0x185)][_0x216634(0x1a3)]!==undefined&&(_0x12cde7['usdtTrcWallet']=_0x3ddc5e[_0x216634(0x185)][_0x216634(0x1a3)]||null),_0x3ddc5e[_0x216634(0x185)][_0x216634(0x173)]!==undefined&&(_0x12cde7[_0x216634(0x173)]=_0x3ddc5e[_0x216634(0x185)][_0x216634(0x173)]||null),_0x3ddc5e['wallets'][_0x216634(0x181)]!==undefined&&(_0x12cde7[_0x216634(0x181)]=_0x3ddc5e[_0x216634(0x185)][_0x216634(0x181)]||null),delete _0x12cde7[_0x216634(0x185)]);const _0x5d91cf=await database_1[_0x216634(0x192)][_0x216634(0x194)]['update']({'where':{'id':_0x4d9d70},'data':_0x12cde7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5d91cf['id'],'fullName':_0x5d91cf[_0x216634(0x187)],'username':_0x5d91cf['username'],'telegramId':_0x5d91cf['telegram'],'merchantUrl':_0x5d91cf[_0x216634(0x188)],'gateways':_0x5d91cf[_0x216634(0x19a)]?JSON['parse'](_0x5d91cf[_0x216634(0x19a)]):null,'gatewaySettings':_0x5d91cf[_0x216634(0x182)]?JSON['parse'](_0x5d91cf[_0x216634(0x182)]):null,'publicKey':_0x5d91cf['publicKey'],'wallets':{'usdtPolygonWallet':_0x5d91cf['usdtPolygonWallet'],'usdtTrcWallet':_0x5d91cf[_0x216634(0x1a3)],'usdtErcWallet':_0x5d91cf[_0x216634(0x173)],'usdcPolygonWallet':_0x5d91cf['usdcPolygonWallet']},'status':_0x5d91cf[_0x216634(0x190)],'createdAt':_0x5d91cf[_0x216634(0x170)]};}async['deleteUser'](_0x4f0488){const _0x182e8f=a56_0xbc4ea;await database_1[_0x182e8f(0x192)][_0x182e8f(0x194)]['delete']({'where':{'id':_0x4f0488}});}}exports[a56_0xbc4ea(0x19c)]=UserService;