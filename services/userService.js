'use strict';const a57_0x83e745=a57_0x2bc9;(function(_0x28e423,_0xb58dd8){const _0x146cb6=a57_0x2bc9,_0x432c6=_0x28e423();while(!![]){try{const _0x10ab21=-parseInt(_0x146cb6(0x182))/0x1+parseInt(_0x146cb6(0x190))/0x2+-parseInt(_0x146cb6(0x172))/0x3+-parseInt(_0x146cb6(0x183))/0x4+parseInt(_0x146cb6(0x167))/0x5*(parseInt(_0x146cb6(0x17d))/0x6)+-parseInt(_0x146cb6(0x16c))/0x7+parseInt(_0x146cb6(0x193))/0x8;if(_0x10ab21===_0xb58dd8)break;else _0x432c6['push'](_0x432c6['shift']());}catch(_0x18ddea){_0x432c6['push'](_0x432c6['shift']());}}}(a57_0x28a1,0xea40f));function a57_0x28a1(){const _0x3e38c5=['429380VoNRfg','gateways','__esModule','fullName','getUserById','createdAt','telegramId','parse','create','bcryptjs','status','createUser','randomBytes','2516680QYtthR','paymentGateways','updateUser','25702880LDZWbw','telegram','shop','findMany','__importDefault','password','toString','stringify','hash','3492840hntIkO','deleteUser','shopUrl','usdtPolygonWallet','usdcPolygonWallet','11262776DYzpEr','pk_','getAllUsers','map','publicKey','username','3925086jUBRVN','findUnique','name','merchantUrl','default','Username\x20already\x20exists','generateApiKeys','delete','defineProperty','wallets','gatewaySettings','6UdWqRL','crypto','usdtErcWallet','usdtTrcWallet','UserService','1185590oZXxjN'];a57_0x28a1=function(){return _0x3e38c5;};return a57_0x28a1();}var __importDefault=this&&this[a57_0x83e745(0x162)]||function(_0x19d705){return _0x19d705&&_0x19d705['__esModule']?_0x19d705:{'default':_0x19d705};};Object[a57_0x83e745(0x17a)](exports,a57_0x83e745(0x185),{'value':!![]}),exports[a57_0x83e745(0x181)]=void 0x0;function a57_0x2bc9(_0x4d2ac7,_0x1a31d1){const _0x28a1eb=a57_0x28a1();return a57_0x2bc9=function(_0x2bc97e,_0x1f3230){_0x2bc97e=_0x2bc97e-0x15f;let _0x197513=_0x28a1eb[_0x2bc97e];return _0x197513;},a57_0x2bc9(_0x4d2ac7,_0x1a31d1);}const bcryptjs_1=__importDefault(require(a57_0x83e745(0x18c))),crypto_1=__importDefault(require(a57_0x83e745(0x17e))),database_1=__importDefault(require('../config/database'));class UserService{['generateApiKeys'](){const _0x2daddc=a57_0x83e745,_0x2e2783=_0x2daddc(0x16d)+crypto_1['default'][_0x2daddc(0x18f)](0x20)[_0x2daddc(0x164)]('hex'),_0x19378f='sk_'+crypto_1['default'][_0x2daddc(0x18f)](0x20)[_0x2daddc(0x164)]('hex');return{'publicKey':_0x2e2783,'secretKey':_0x19378f};}async[a57_0x83e745(0x18e)](_0x194ea8){const _0x471ffb=a57_0x83e745,{fullName:_0x26cbe1,username:_0x331b63,password:_0x5d4fc5,telegramId:_0x430f42,merchantUrl:_0x29b128,gateways:_0x5a8d8f,gatewaySettings:_0x3715b5,wallets:_0x2a991f}=_0x194ea8,_0x11bd8b=await database_1[_0x471ffb(0x176)]['shop'][_0x471ffb(0x173)]({'where':{'username':_0x331b63}});if(_0x11bd8b)throw new Error(_0x471ffb(0x177));if(_0x430f42){const _0xe5de31=await database_1['default']['shop'][_0x471ffb(0x173)]({'where':{'telegram':_0x430f42}});if(_0xe5de31)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x435257=await bcryptjs_1[_0x471ffb(0x176)]['hash'](_0x5d4fc5,0xc),{publicKey:_0x505b18,secretKey:_0x163ee0}=this[_0x471ffb(0x178)](),_0x4acc05=await database_1[_0x471ffb(0x176)]['shop'][_0x471ffb(0x18b)]({'data':{'name':_0x26cbe1,'username':_0x331b63,'password':_0x435257,'telegram':_0x430f42,'shopUrl':_0x29b128,'paymentGateways':_0x5a8d8f?JSON['stringify'](_0x5a8d8f):null,'gatewaySettings':_0x3715b5?JSON['stringify'](_0x3715b5):null,'usdtPolygonWallet':_0x2a991f?.[_0x471ffb(0x16a)]||null,'usdtTrcWallet':_0x2a991f?.['usdtTrcWallet']||null,'usdtErcWallet':_0x2a991f?.[_0x471ffb(0x17f)]||null,'usdcPolygonWallet':_0x2a991f?.[_0x471ffb(0x16b)]||null,'publicKey':_0x505b18,'secretKey':_0x163ee0,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4acc05['id'],'fullName':_0x4acc05[_0x471ffb(0x174)],'username':_0x4acc05[_0x471ffb(0x171)],'telegramId':_0x4acc05['telegram'],'merchantUrl':_0x4acc05['shopUrl'],'gateways':_0x4acc05[_0x471ffb(0x191)]?JSON[_0x471ffb(0x18a)](_0x4acc05[_0x471ffb(0x191)]):null,'gatewaySettings':_0x4acc05['gatewaySettings']?JSON[_0x471ffb(0x18a)](_0x4acc05[_0x471ffb(0x17c)]):null,'publicKey':_0x4acc05['publicKey'],'wallets':{'usdtPolygonWallet':_0x4acc05['usdtPolygonWallet'],'usdtTrcWallet':_0x4acc05[_0x471ffb(0x180)],'usdtErcWallet':_0x4acc05[_0x471ffb(0x17f)],'usdcPolygonWallet':_0x4acc05[_0x471ffb(0x16b)]},'status':_0x4acc05[_0x471ffb(0x18d)],'createdAt':_0x4acc05[_0x471ffb(0x188)]};}async[a57_0x83e745(0x16e)](){const _0x112944=a57_0x83e745,_0x1420fa=await database_1[_0x112944(0x176)][_0x112944(0x160)][_0x112944(0x161)]({'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':'desc'}});return _0x1420fa[_0x112944(0x16f)](_0x18c27c=>({'id':_0x18c27c['id'],'fullName':_0x18c27c['name'],'username':_0x18c27c[_0x112944(0x171)],'telegramId':_0x18c27c[_0x112944(0x15f)],'merchantUrl':_0x18c27c['shopUrl'],'gateways':_0x18c27c[_0x112944(0x191)]?JSON[_0x112944(0x18a)](_0x18c27c[_0x112944(0x191)]):null,'gatewaySettings':_0x18c27c[_0x112944(0x17c)]?JSON['parse'](_0x18c27c[_0x112944(0x17c)]):null,'publicKey':_0x18c27c[_0x112944(0x170)],'wallets':{'usdtPolygonWallet':_0x18c27c[_0x112944(0x16a)],'usdtTrcWallet':_0x18c27c['usdtTrcWallet'],'usdtErcWallet':_0x18c27c[_0x112944(0x17f)],'usdcPolygonWallet':_0x18c27c[_0x112944(0x16b)]},'status':_0x18c27c[_0x112944(0x18d)],'createdAt':_0x18c27c[_0x112944(0x188)]}));}async[a57_0x83e745(0x187)](_0x2a5e4b){const _0x7c3222=a57_0x83e745,_0x10955b=await database_1[_0x7c3222(0x176)][_0x7c3222(0x160)][_0x7c3222(0x173)]({'where':{'id':_0x2a5e4b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x10955b)return null;return{'id':_0x10955b['id'],'fullName':_0x10955b[_0x7c3222(0x174)],'username':_0x10955b[_0x7c3222(0x171)],'telegramId':_0x10955b[_0x7c3222(0x15f)],'merchantUrl':_0x10955b[_0x7c3222(0x169)],'gateways':_0x10955b[_0x7c3222(0x191)]?JSON['parse'](_0x10955b['paymentGateways']):null,'gatewaySettings':_0x10955b['gatewaySettings']?JSON[_0x7c3222(0x18a)](_0x10955b[_0x7c3222(0x17c)]):null,'publicKey':_0x10955b[_0x7c3222(0x170)],'wallets':{'usdtPolygonWallet':_0x10955b[_0x7c3222(0x16a)],'usdtTrcWallet':_0x10955b[_0x7c3222(0x180)],'usdtErcWallet':_0x10955b[_0x7c3222(0x17f)],'usdcPolygonWallet':_0x10955b[_0x7c3222(0x16b)]},'status':_0x10955b[_0x7c3222(0x18d)],'createdAt':_0x10955b[_0x7c3222(0x188)]};}async[a57_0x83e745(0x192)](_0x34984e,_0x1c2348){const _0x1fba63=a57_0x83e745,_0x360a1a={..._0x1c2348};_0x1c2348[_0x1fba63(0x163)]&&(_0x360a1a[_0x1fba63(0x163)]=await bcryptjs_1['default'][_0x1fba63(0x166)](_0x1c2348['password'],0xc));_0x1c2348[_0x1fba63(0x186)]&&(_0x360a1a['name']=_0x1c2348[_0x1fba63(0x186)],delete _0x360a1a[_0x1fba63(0x186)]);_0x1c2348[_0x1fba63(0x189)]&&(_0x360a1a['telegram']=_0x1c2348[_0x1fba63(0x189)],delete _0x360a1a[_0x1fba63(0x189)]);_0x1c2348['merchantUrl']&&(_0x360a1a[_0x1fba63(0x169)]=_0x1c2348['merchantUrl'],delete _0x360a1a[_0x1fba63(0x175)]);_0x1c2348[_0x1fba63(0x184)]&&(_0x360a1a[_0x1fba63(0x191)]=JSON[_0x1fba63(0x165)](_0x1c2348[_0x1fba63(0x184)]),delete _0x360a1a[_0x1fba63(0x184)]);_0x1c2348['gatewaySettings']&&(_0x360a1a[_0x1fba63(0x17c)]=JSON[_0x1fba63(0x165)](_0x1c2348[_0x1fba63(0x17c)]),delete _0x360a1a['gatewaySettings']);_0x1c2348['wallets']&&(_0x1c2348[_0x1fba63(0x17b)][_0x1fba63(0x16a)]!==undefined&&(_0x360a1a['usdtPolygonWallet']=_0x1c2348[_0x1fba63(0x17b)][_0x1fba63(0x16a)]||null),_0x1c2348['wallets'][_0x1fba63(0x180)]!==undefined&&(_0x360a1a[_0x1fba63(0x180)]=_0x1c2348[_0x1fba63(0x17b)]['usdtTrcWallet']||null),_0x1c2348[_0x1fba63(0x17b)]['usdtErcWallet']!==undefined&&(_0x360a1a[_0x1fba63(0x17f)]=_0x1c2348[_0x1fba63(0x17b)][_0x1fba63(0x17f)]||null),_0x1c2348[_0x1fba63(0x17b)][_0x1fba63(0x16b)]!==undefined&&(_0x360a1a[_0x1fba63(0x16b)]=_0x1c2348['wallets']['usdcPolygonWallet']||null),delete _0x360a1a[_0x1fba63(0x17b)]);const _0x20a734=await database_1[_0x1fba63(0x176)][_0x1fba63(0x160)]['update']({'where':{'id':_0x34984e},'data':_0x360a1a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x20a734['id'],'fullName':_0x20a734['name'],'username':_0x20a734[_0x1fba63(0x171)],'telegramId':_0x20a734[_0x1fba63(0x15f)],'merchantUrl':_0x20a734['shopUrl'],'gateways':_0x20a734[_0x1fba63(0x191)]?JSON[_0x1fba63(0x18a)](_0x20a734[_0x1fba63(0x191)]):null,'gatewaySettings':_0x20a734['gatewaySettings']?JSON[_0x1fba63(0x18a)](_0x20a734['gatewaySettings']):null,'publicKey':_0x20a734[_0x1fba63(0x170)],'wallets':{'usdtPolygonWallet':_0x20a734[_0x1fba63(0x16a)],'usdtTrcWallet':_0x20a734['usdtTrcWallet'],'usdtErcWallet':_0x20a734[_0x1fba63(0x17f)],'usdcPolygonWallet':_0x20a734[_0x1fba63(0x16b)]},'status':_0x20a734['status'],'createdAt':_0x20a734['createdAt']};}async[a57_0x83e745(0x168)](_0x254d5a){const _0x43d0ab=a57_0x83e745;await database_1[_0x43d0ab(0x176)][_0x43d0ab(0x160)][_0x43d0ab(0x179)]({'where':{'id':_0x254d5a}});}}exports['UserService']=UserService;