'use strict';const a72_0x27c357=a72_0x26fa;(function(_0x320032,_0x5cc6c6){const _0xfbfa2b=a72_0x26fa,_0x1c24a2=_0x320032();while(!![]){try{const _0x323d52=parseInt(_0xfbfa2b(0x8c))/0x1*(-parseInt(_0xfbfa2b(0xac))/0x2)+parseInt(_0xfbfa2b(0x7f))/0x3+-parseInt(_0xfbfa2b(0xa1))/0x4+parseInt(_0xfbfa2b(0x76))/0x5+parseInt(_0xfbfa2b(0x7a))/0x6+-parseInt(_0xfbfa2b(0xa9))/0x7+parseInt(_0xfbfa2b(0x75))/0x8;if(_0x323d52===_0x5cc6c6)break;else _0x1c24a2['push'](_0x1c24a2['shift']());}catch(_0xc0ef75){_0x1c24a2['push'](_0x1c24a2['shift']());}}}(a72_0x1434,0xdf267));function a72_0x26fa(_0x575d0f,_0x3e81cf){_0x575d0f=_0x575d0f-0x6e;const _0x143413=a72_0x1434();let _0x26fa9c=_0x143413[_0x575d0f];return _0x26fa9c;}function a72_0x1434(){const _0x3a66ff=['payment_failed','changePassword','api_error','length','notificationApiError','updateWebhookSettings','notificationPayout','delete','payout','randomBytes','shopSettings','password','444861SJjJJL','sk_','crypto','defineProperty','webhookEvents','repeat','telegramBotApiKey','hex','settings','default','compare','shop','notificationPaymentSuccess','hash','max','telegram','updateNotifications','notificationLogin','chatId','login','toString','1107812ABfoWW','pk_','__importDefault','deleteAccount','webhookUrl','findUnique','notificationRefund','botApiKey','3012156NiiulZ','__esModule','isArray','2iIVzQZ','payment_success','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','revokeAllApiKeys','create','name','parseWebhookEvents','Current\x20password\x20is\x20incorrect','Shop\x20not\x20found','parse','notificationPaymentFailed','852952DFyPIA','3957210LYEmvt','Password\x20confirmation\x20is\x20incorrect','ensureSettingsExist','maskApiKey','5303532JEetAP','bcryptjs','updateTelegramSettings','refund','update','852486eSWZQt'];a72_0x1434=function(){return _0x3a66ff;};return a72_0x1434();}var __importDefault=this&&this[a72_0x27c357(0xa3)]||function(_0x575294){const _0x472968=a72_0x27c357;return _0x575294&&_0x575294[_0x472968(0xaa)]?_0x575294:{'default':_0x575294};};Object[a72_0x27c357(0x8f)](exports,a72_0x27c357(0xaa),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a72_0x27c357(0x7b))),crypto_1=__importDefault(require(a72_0x27c357(0x8e))),database_1=__importDefault(require('../config/database'));class SettingsService{['maskApiKey'](_0x12195c){const _0x2972d2=a72_0x27c357;if(!_0x12195c)return'';if(_0x12195c[_0x2972d2(0x83)]<=0x8)return _0x12195c;const _0x54998b=_0x12195c['substring'](0x0,0x8),_0xc6fe81='*'[_0x2972d2(0x91)](Math[_0x2972d2(0x9a)](0x0,_0x12195c['length']-0x8));return _0x54998b+_0xc6fe81;}[a72_0x27c357(0x70)](_0x39444b){const _0x32f511=a72_0x27c357;if(!_0x39444b)return[];if(Array['isArray'](_0x39444b))return _0x39444b;if(typeof _0x39444b==='string')try{const _0x3f24d7=JSON[_0x32f511(0x73)](_0x39444b);return Array[_0x32f511(0xab)](_0x3f24d7)?_0x3f24d7:[];}catch{return[];}return[];}async['getShopSettings'](_0x254443){const _0xacf2fa=a72_0x27c357,_0x3505a7=await database_1[_0xacf2fa(0x95)][_0xacf2fa(0x97)][_0xacf2fa(0xa6)]({'where':{'id':_0x254443},'include':{'settings':!![]}});if(!_0x3505a7)throw new Error(_0xacf2fa(0x72));let _0x3c2103=_0x3505a7[_0xacf2fa(0x94)];return!_0x3c2103&&(_0x3c2103=await database_1[_0xacf2fa(0x95)]['shopSettings'][_0xacf2fa(0x6e)]({'data':{'shopId':_0x3505a7['id']}})),{'fullName':_0x3505a7[_0xacf2fa(0x6f)],'brand':_0x3505a7[_0xacf2fa(0x6f)],'merchantUrl':_0x3505a7['shopUrl'],'telegramUsername':_0x3505a7[_0xacf2fa(0x9b)],'telegramBotApiKey':_0x3c2103[_0xacf2fa(0x92)]?this[_0xacf2fa(0x79)](_0x3c2103['telegramBotApiKey']):null,'telegramChatId':_0x3c2103['telegramChatId'],'webhookUrl':_0x3c2103['webhookUrl'],'webhookEvents':this[_0xacf2fa(0x70)](_0x3c2103['webhookEvents']),'notifications':{'payment_success':_0x3c2103[_0xacf2fa(0x98)],'payment_failed':_0x3c2103[_0xacf2fa(0x74)],'refund':_0x3c2103[_0xacf2fa(0xa7)],'payout':_0x3c2103[_0xacf2fa(0x86)],'login':_0x3c2103[_0xacf2fa(0x9d)],'api_error':_0x3c2103[_0xacf2fa(0x84)]}};}async[a72_0x27c357(0x81)](_0x11dcd1,_0x4f2cc9){const _0x4639bb=a72_0x27c357,{currentPassword:_0x5cd155,newPassword:_0x7ce85d,confirmNewPassword:_0x40891c}=_0x4f2cc9;if(_0x7ce85d!==_0x40891c)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x7ce85d[_0x4639bb(0x83)]<0x6)throw new Error(_0x4639bb(0xae));const _0x30c679=await database_1[_0x4639bb(0x95)][_0x4639bb(0x97)][_0x4639bb(0xa6)]({'where':{'id':_0x11dcd1},'select':{'password':!![]}});if(!_0x30c679)throw new Error('Shop\x20not\x20found');const _0x4043e9=await bcryptjs_1[_0x4639bb(0x95)]['compare'](_0x5cd155,_0x30c679[_0x4639bb(0x8b)]);if(!_0x4043e9)throw new Error(_0x4639bb(0x71));const _0x5eef91=await bcryptjs_1[_0x4639bb(0x95)][_0x4639bb(0x99)](_0x7ce85d,0xc);await database_1[_0x4639bb(0x95)][_0x4639bb(0x97)][_0x4639bb(0x7e)]({'where':{'id':_0x11dcd1},'data':{'password':_0x5eef91}});}async[a72_0x27c357(0x9c)](_0x23550c,_0xee1a4c){const _0x2d7eab=a72_0x27c357;await this[_0x2d7eab(0x78)](_0x23550c);const _0x1ee678={};_0xee1a4c[_0x2d7eab(0xad)]!==undefined&&(_0x1ee678[_0x2d7eab(0x98)]=_0xee1a4c[_0x2d7eab(0xad)]),_0xee1a4c[_0x2d7eab(0x80)]!==undefined&&(_0x1ee678[_0x2d7eab(0x74)]=_0xee1a4c[_0x2d7eab(0x80)]),_0xee1a4c[_0x2d7eab(0x7d)]!==undefined&&(_0x1ee678[_0x2d7eab(0xa7)]=_0xee1a4c[_0x2d7eab(0x7d)]),_0xee1a4c['payout']!==undefined&&(_0x1ee678[_0x2d7eab(0x86)]=_0xee1a4c[_0x2d7eab(0x88)]),_0xee1a4c[_0x2d7eab(0x9f)]!==undefined&&(_0x1ee678['notificationLogin']=_0xee1a4c[_0x2d7eab(0x9f)]),_0xee1a4c[_0x2d7eab(0x82)]!==undefined&&(_0x1ee678['notificationApiError']=_0xee1a4c['api_error']),await database_1[_0x2d7eab(0x95)][_0x2d7eab(0x8a)]['update']({'where':{'shopId':_0x23550c},'data':_0x1ee678});}async[a72_0x27c357(0x7c)](_0x37212f,_0x1c9020){const _0x57d3ac=a72_0x27c357;await this[_0x57d3ac(0x78)](_0x37212f);const _0x29bee6={};_0x1c9020[_0x57d3ac(0xa8)]!==undefined&&(_0x29bee6[_0x57d3ac(0x92)]=_0x1c9020[_0x57d3ac(0xa8)]||null),_0x1c9020[_0x57d3ac(0x9e)]!==undefined&&(_0x29bee6['telegramChatId']=_0x1c9020[_0x57d3ac(0x9e)]||null),await database_1['default']['shopSettings']['update']({'where':{'shopId':_0x37212f},'data':_0x29bee6});}async[a72_0x27c357(0x85)](_0x5d6abc,_0x2b481b){const _0x47d901=a72_0x27c357;await this[_0x47d901(0x78)](_0x5d6abc);const _0x282594={};_0x2b481b[_0x47d901(0xa5)]!==undefined&&(_0x282594[_0x47d901(0xa5)]=_0x2b481b[_0x47d901(0xa5)]||null),_0x2b481b[_0x47d901(0x90)]!==undefined&&(_0x282594[_0x47d901(0x90)]=_0x2b481b[_0x47d901(0x90)]||[]),await database_1[_0x47d901(0x95)][_0x47d901(0x8a)][_0x47d901(0x7e)]({'where':{'shopId':_0x5d6abc},'data':_0x282594});}async[a72_0x27c357(0xaf)](_0x27998e){const _0xfd268=a72_0x27c357,_0x317904=_0xfd268(0xa2)+crypto_1['default'][_0xfd268(0x89)](0x20)[_0xfd268(0xa0)]('hex'),_0x5746a2=_0xfd268(0x8d)+crypto_1[_0xfd268(0x95)][_0xfd268(0x89)](0x20)[_0xfd268(0xa0)](_0xfd268(0x93));await database_1[_0xfd268(0x95)][_0xfd268(0x97)][_0xfd268(0x7e)]({'where':{'id':_0x27998e},'data':{'publicKey':_0x317904,'secretKey':_0x5746a2}});}async[a72_0x27c357(0xa4)](_0x3844db,_0x494669){const _0x1e4aac=a72_0x27c357,{passwordConfirmation:_0x48c6c8}=_0x494669,_0x2f2019=await database_1[_0x1e4aac(0x95)][_0x1e4aac(0x97)][_0x1e4aac(0xa6)]({'where':{'id':_0x3844db},'select':{'password':!![]}});if(!_0x2f2019)throw new Error('Shop\x20not\x20found');const _0x14bd94=await bcryptjs_1[_0x1e4aac(0x95)][_0x1e4aac(0x96)](_0x48c6c8,_0x2f2019[_0x1e4aac(0x8b)]);if(!_0x14bd94)throw new Error(_0x1e4aac(0x77));await database_1[_0x1e4aac(0x95)][_0x1e4aac(0x97)][_0x1e4aac(0x87)]({'where':{'id':_0x3844db}});}async['ensureSettingsExist'](_0x3b7ae3){const _0x294a60=a72_0x27c357,_0x7fa2c1=await database_1['default'][_0x294a60(0x8a)][_0x294a60(0xa6)]({'where':{'shopId':_0x3b7ae3}});!_0x7fa2c1&&await database_1[_0x294a60(0x95)][_0x294a60(0x8a)]['create']({'data':{'shopId':_0x3b7ae3}});}}exports['SettingsService']=SettingsService;