'use strict';const a56_0xfde46=a56_0x3957;(function(_0x7fdf36,_0x9c2c3e){const _0x4ef467=a56_0x3957,_0x53fbb0=_0x7fdf36();while(!![]){try{const _0x856e1e=-parseInt(_0x4ef467(0x1b1))/0x1+-parseInt(_0x4ef467(0x1d4))/0x2+-parseInt(_0x4ef467(0x1d1))/0x3+parseInt(_0x4ef467(0x1bb))/0x4+parseInt(_0x4ef467(0x1b3))/0x5*(-parseInt(_0x4ef467(0x1b2))/0x6)+-parseInt(_0x4ef467(0x195))/0x7+-parseInt(_0x4ef467(0x1a1))/0x8*(-parseInt(_0x4ef467(0x199))/0x9);if(_0x856e1e===_0x9c2c3e)break;else _0x53fbb0['push'](_0x53fbb0['shift']());}catch(_0x1b433d){_0x53fbb0['push'](_0x53fbb0['shift']());}}}(a56_0x31e0,0xc30bc));var __importDefault=this&&this[a56_0xfde46(0x1be)]||function(_0xae5013){const _0x382fbe=a56_0xfde46;return _0xae5013&&_0xae5013[_0x382fbe(0x1ac)]?_0xae5013:{'default':_0xae5013};};function a56_0x3957(_0x473f64,_0x1e0b22){const _0x31e06c=a56_0x31e0();return a56_0x3957=function(_0x395773,_0x75c01e){_0x395773=_0x395773-0x195;let _0x467d59=_0x31e06c[_0x395773];return _0x467d59;},a56_0x3957(_0x473f64,_0x1e0b22);}Object[a56_0xfde46(0x1bf)](exports,a56_0xfde46(0x1ac),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a56_0xfde46(0x1d0))),crypto_1=__importDefault(require(a56_0xfde46(0x1b9))),database_1=__importDefault(require('../config/database'));class SettingsService{['maskApiKey'](_0x2b0a3e){const _0x497ebd=a56_0xfde46;if(!_0x2b0a3e)return'';if(_0x2b0a3e['length']<=0x8)return _0x2b0a3e;const _0x158dd6=_0x2b0a3e[_0x497ebd(0x1ad)](0x0,0x8),_0xd4aa33='*'[_0x497ebd(0x1a7)](Math[_0x497ebd(0x1b0)](0x0,_0x2b0a3e['length']-0x8));return _0x158dd6+_0xd4aa33;}['parseWebhookEvents'](_0x2c7afe){const _0x122afd=a56_0xfde46;if(!_0x2c7afe)return[];if(Array['isArray'](_0x2c7afe))return _0x2c7afe;if(typeof _0x2c7afe===_0x122afd(0x1b7))try{const _0x4e9943=JSON[_0x122afd(0x1c3)](_0x2c7afe);return Array['isArray'](_0x4e9943)?_0x4e9943:[];}catch{return[];}return[];}async[a56_0xfde46(0x1cb)](_0x37f104){const _0x559ecb=a56_0xfde46,_0x479e69=await database_1[_0x559ecb(0x1d6)][_0x559ecb(0x1b4)][_0x559ecb(0x1ca)]({'where':{'id':_0x37f104},'include':{'settings':!![]}});if(!_0x479e69)throw new Error(_0x559ecb(0x1a2));let _0xfb60e1=_0x479e69[_0x559ecb(0x1c1)];return!_0xfb60e1&&(_0xfb60e1=await database_1['default'][_0x559ecb(0x19c)][_0x559ecb(0x1cd)]({'data':{'shopId':_0x479e69['id']}})),{'fullName':_0x479e69[_0x559ecb(0x1aa)],'brand':_0x479e69['name'],'merchantUrl':_0x479e69[_0x559ecb(0x1d2)],'telegramUsername':_0x479e69[_0x559ecb(0x1b6)],'telegramBotApiKey':_0xfb60e1['telegramBotApiKey']?this['maskApiKey'](_0xfb60e1[_0x559ecb(0x1c7)]):null,'telegramChatId':_0xfb60e1[_0x559ecb(0x1ab)],'webhookUrl':_0xfb60e1[_0x559ecb(0x1ce)],'webhookEvents':this['parseWebhookEvents'](_0xfb60e1['webhookEvents']),'notifications':{'payment_success':_0xfb60e1[_0x559ecb(0x198)],'payment_failed':_0xfb60e1[_0x559ecb(0x1c5)],'refund':_0xfb60e1[_0x559ecb(0x1c6)],'payout':_0xfb60e1[_0x559ecb(0x19f)],'login':_0xfb60e1[_0x559ecb(0x1a9)],'api_error':_0xfb60e1[_0x559ecb(0x1a5)]}};}async[a56_0xfde46(0x1d3)](_0x3e9524,_0x3cbf67){const _0x348816=a56_0xfde46,{currentPassword:_0x2df205,newPassword:_0x338e28,confirmNewPassword:_0x5ce194}=_0x3cbf67;if(_0x338e28!==_0x5ce194)throw new Error(_0x348816(0x197));if(_0x338e28[_0x348816(0x19e)]<0x6)throw new Error(_0x348816(0x1c9));const _0x2bbf08=await database_1[_0x348816(0x1d6)][_0x348816(0x1b4)]['findUnique']({'where':{'id':_0x3e9524},'select':{'password':!![]}});if(!_0x2bbf08)throw new Error('Shop\x20not\x20found');const _0x518772=await bcryptjs_1[_0x348816(0x1d6)][_0x348816(0x1bc)](_0x2df205,_0x2bbf08[_0x348816(0x1c0)]);if(!_0x518772)throw new Error(_0x348816(0x19b));const _0x5e813b=await bcryptjs_1[_0x348816(0x1d6)]['hash'](_0x338e28,0xc);await database_1[_0x348816(0x1d6)]['shop'][_0x348816(0x1a8)]({'where':{'id':_0x3e9524},'data':{'password':_0x5e813b}});}async[a56_0xfde46(0x196)](_0x1f5e79,_0x386e7b){const _0x8a9367=a56_0xfde46;await this[_0x8a9367(0x1b5)](_0x1f5e79);const _0x19cf44={};_0x386e7b[_0x8a9367(0x1c2)]!==undefined&&(_0x19cf44[_0x8a9367(0x198)]=_0x386e7b[_0x8a9367(0x1c2)]),_0x386e7b['payment_failed']!==undefined&&(_0x19cf44['notificationPaymentFailed']=_0x386e7b[_0x8a9367(0x1a4)]),_0x386e7b[_0x8a9367(0x19a)]!==undefined&&(_0x19cf44[_0x8a9367(0x1c6)]=_0x386e7b['refund']),_0x386e7b[_0x8a9367(0x1a6)]!==undefined&&(_0x19cf44['notificationPayout']=_0x386e7b[_0x8a9367(0x1a6)]),_0x386e7b['login']!==undefined&&(_0x19cf44['notificationLogin']=_0x386e7b[_0x8a9367(0x1d5)]),_0x386e7b[_0x8a9367(0x1ae)]!==undefined&&(_0x19cf44[_0x8a9367(0x1a5)]=_0x386e7b[_0x8a9367(0x1ae)]),await database_1[_0x8a9367(0x1d6)][_0x8a9367(0x19c)]['update']({'where':{'shopId':_0x1f5e79},'data':_0x19cf44});}async[a56_0xfde46(0x1af)](_0x5b9982,_0x33f793){const _0x48961e=a56_0xfde46;await this['ensureSettingsExist'](_0x5b9982);const _0x563ebb={};_0x33f793[_0x48961e(0x1cf)]!==undefined&&(_0x563ebb[_0x48961e(0x1c7)]=_0x33f793[_0x48961e(0x1cf)]||null),_0x33f793['chatId']!==undefined&&(_0x563ebb['telegramChatId']=_0x33f793['chatId']||null),await database_1[_0x48961e(0x1d6)][_0x48961e(0x19c)][_0x48961e(0x1a8)]({'where':{'shopId':_0x5b9982},'data':_0x563ebb});}async['updateWebhookSettings'](_0x23df19,_0x2ae418){const _0x13cdda=a56_0xfde46;await this[_0x13cdda(0x1b5)](_0x23df19);const _0x297a82={};_0x2ae418[_0x13cdda(0x1ce)]!==undefined&&(_0x297a82[_0x13cdda(0x1ce)]=_0x2ae418[_0x13cdda(0x1ce)]||null),_0x2ae418[_0x13cdda(0x1bd)]!==undefined&&(_0x297a82[_0x13cdda(0x1bd)]=_0x2ae418[_0x13cdda(0x1bd)]||[]),await database_1[_0x13cdda(0x1d6)][_0x13cdda(0x19c)][_0x13cdda(0x1a8)]({'where':{'shopId':_0x23df19},'data':_0x297a82});}async['revokeAllApiKeys'](_0x476ba0){const _0x102f3c=a56_0xfde46,_0x2e7754=_0x102f3c(0x1a3)+crypto_1[_0x102f3c(0x1d6)][_0x102f3c(0x1cc)](0x20)[_0x102f3c(0x1a0)]('hex'),_0x38530d=_0x102f3c(0x1d7)+crypto_1[_0x102f3c(0x1d6)]['randomBytes'](0x20)[_0x102f3c(0x1a0)](_0x102f3c(0x1c4));await database_1['default'][_0x102f3c(0x1b4)][_0x102f3c(0x1a8)]({'where':{'id':_0x476ba0},'data':{'publicKey':_0x2e7754,'secretKey':_0x38530d}});}async[a56_0xfde46(0x19d)](_0x3b5005,_0x2207be){const _0x1be27f=a56_0xfde46,{passwordConfirmation:_0x1bc4c2}=_0x2207be,_0x4aa8f6=await database_1['default'][_0x1be27f(0x1b4)][_0x1be27f(0x1ca)]({'where':{'id':_0x3b5005},'select':{'password':!![]}});if(!_0x4aa8f6)throw new Error(_0x1be27f(0x1a2));const _0x48772b=await bcryptjs_1[_0x1be27f(0x1d6)][_0x1be27f(0x1bc)](_0x1bc4c2,_0x4aa8f6['password']);if(!_0x48772b)throw new Error(_0x1be27f(0x1ba));await database_1[_0x1be27f(0x1d6)]['shop'][_0x1be27f(0x1c8)]({'where':{'id':_0x3b5005}});}async['ensureSettingsExist'](_0x2c112d){const _0xf04bd4=a56_0xfde46,_0x532456=await database_1[_0xf04bd4(0x1d6)][_0xf04bd4(0x19c)]['findUnique']({'where':{'shopId':_0x2c112d}});!_0x532456&&await database_1[_0xf04bd4(0x1d6)][_0xf04bd4(0x19c)][_0xf04bd4(0x1cd)]({'data':{'shopId':_0x2c112d}});}}function a56_0x31e0(){const _0x18f5c4=['deleteAccount','length','notificationPayout','toString','9490968YkuTiC','Shop\x20not\x20found','pk_','payment_failed','notificationApiError','payout','repeat','update','notificationLogin','name','telegramChatId','__esModule','substring','api_error','updateTelegramSettings','max','258140MWpkbi','6HXxkdb','1196865ygjoBH','shop','ensureSettingsExist','telegram','string','SettingsService','crypto','Password\x20confirmation\x20is\x20incorrect','5871068SRzoWN','compare','webhookEvents','__importDefault','defineProperty','password','settings','payment_success','parse','hex','notificationPaymentFailed','notificationRefund','telegramBotApiKey','delete','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','findUnique','getShopSettings','randomBytes','create','webhookUrl','botApiKey','bcryptjs','2508750UYMgLz','shopUrl','changePassword','2702642ttGxIn','login','default','sk_','2495619xQGcEg','updateNotifications','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','notificationPaymentSuccess','18uPnCSL','refund','Current\x20password\x20is\x20incorrect','shopSettings'];a56_0x31e0=function(){return _0x18f5c4;};return a56_0x31e0();}exports[a56_0xfde46(0x1b8)]=SettingsService;