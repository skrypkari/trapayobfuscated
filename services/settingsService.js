'use strict';const a64_0x308cd4=a64_0x32f0;(function(_0x22cea8,_0x47582e){const _0x44682f=a64_0x32f0,_0x134d52=_0x22cea8();while(!![]){try{const _0x46fc86=-parseInt(_0x44682f(0xa4))/0x1*(-parseInt(_0x44682f(0xad))/0x2)+parseInt(_0x44682f(0xb0))/0x3+-parseInt(_0x44682f(0xd5))/0x4+parseInt(_0x44682f(0xdd))/0x5*(parseInt(_0x44682f(0xa1))/0x6)+-parseInt(_0x44682f(0xb1))/0x7+parseInt(_0x44682f(0xdc))/0x8*(-parseInt(_0x44682f(0xd8))/0x9)+-parseInt(_0x44682f(0xba))/0xa*(-parseInt(_0x44682f(0x9d))/0xb);if(_0x46fc86===_0x47582e)break;else _0x134d52['push'](_0x134d52['shift']());}catch(_0x4d3f7e){_0x134d52['push'](_0x134d52['shift']());}}}(a64_0x4df6,0x7112e));function a64_0x4df6(){const _0x1c80d4=['length','3347343tZFIRv','sk_','ensureSettingsExist','SettingsService','8fqjPSB','255GSmWCs','bcryptjs','shopUrl','revokeAllApiKeys','44tkoJgb','parseWebhookEvents','updateWebhookSettings','settings','26196STUyDy','maskApiKey','notificationPaymentSuccess','12841bmzkFA','notificationApiError','notificationLogin','repeat','max','Shop\x20not\x20found','isArray','findUnique','getShopSettings','66jTGrjV','notificationPayout','crypto','1425579prOyoA','2096906XagttP','update','Current\x20password\x20is\x20incorrect','name','notificationPaymentFailed','api_error','webhookUrl','default','telegram','1327580QphfYU','payment_success','notificationRefund','defineProperty','changePassword','telegramChatId','webhookEvents','payout','Password\x20confirmation\x20is\x20incorrect','payment_failed','pk_','string','botApiKey','shop','updateNotifications','login','hex','chatId','parse','__esModule','updateTelegramSettings','toString','create','randomBytes','hash','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','shopSettings','2072036oxlzNC','telegramBotApiKey'];a64_0x4df6=function(){return _0x1c80d4;};return a64_0x4df6();}var __importDefault=this&&this['__importDefault']||function(_0xa4757){const _0x2cac70=a64_0x32f0;return _0xa4757&&_0xa4757[_0x2cac70(0xcd)]?_0xa4757:{'default':_0xa4757};};Object[a64_0x308cd4(0xbd)](exports,'__esModule',{'value':!![]}),exports[a64_0x308cd4(0xdb)]=void 0x0;const bcryptjs_1=__importDefault(require(a64_0x308cd4(0x9a))),crypto_1=__importDefault(require(a64_0x308cd4(0xaf))),database_1=__importDefault(require('../config/database'));class SettingsService{[a64_0x308cd4(0xa2)](_0xb4cdda){const _0x2d8af9=a64_0x308cd4;if(!_0xb4cdda)return'';if(_0xb4cdda[_0x2d8af9(0xd7)]<=0x8)return _0xb4cdda;const _0x390682=_0xb4cdda['substring'](0x0,0x8),_0x817685='*'[_0x2d8af9(0xa7)](Math[_0x2d8af9(0xa8)](0x0,_0xb4cdda['length']-0x8));return _0x390682+_0x817685;}[a64_0x308cd4(0x9e)](_0x489326){const _0x3a0f6c=a64_0x308cd4;if(!_0x489326)return[];if(Array[_0x3a0f6c(0xaa)](_0x489326))return _0x489326;if(typeof _0x489326===_0x3a0f6c(0xc5))try{const _0x4fccc0=JSON[_0x3a0f6c(0xcc)](_0x489326);return Array[_0x3a0f6c(0xaa)](_0x4fccc0)?_0x4fccc0:[];}catch{return[];}return[];}async[a64_0x308cd4(0xac)](_0x412b33){const _0x3c1dd1=a64_0x308cd4,_0x4136a6=await database_1['default'][_0x3c1dd1(0xc7)][_0x3c1dd1(0xab)]({'where':{'id':_0x412b33},'include':{'settings':!![]}});if(!_0x4136a6)throw new Error(_0x3c1dd1(0xa9));let _0xfd30a=_0x4136a6[_0x3c1dd1(0xa0)];return!_0xfd30a&&(_0xfd30a=await database_1['default'][_0x3c1dd1(0xd4)][_0x3c1dd1(0xd0)]({'data':{'shopId':_0x4136a6['id']}})),{'fullName':_0x4136a6['name'],'brand':_0x4136a6[_0x3c1dd1(0xb4)],'merchantUrl':_0x4136a6[_0x3c1dd1(0x9b)],'telegramUsername':_0x4136a6[_0x3c1dd1(0xb9)],'telegramBotApiKey':_0xfd30a[_0x3c1dd1(0xd6)]?this[_0x3c1dd1(0xa2)](_0xfd30a[_0x3c1dd1(0xd6)]):null,'telegramChatId':_0xfd30a['telegramChatId'],'webhookUrl':_0xfd30a[_0x3c1dd1(0xb7)],'webhookEvents':this[_0x3c1dd1(0x9e)](_0xfd30a['webhookEvents']),'notifications':{'payment_success':_0xfd30a[_0x3c1dd1(0xa3)],'payment_failed':_0xfd30a[_0x3c1dd1(0xb5)],'refund':_0xfd30a['notificationRefund'],'payout':_0xfd30a[_0x3c1dd1(0xae)],'login':_0xfd30a['notificationLogin'],'api_error':_0xfd30a[_0x3c1dd1(0xa5)]}};}async[a64_0x308cd4(0xbe)](_0x563727,_0x2ce357){const _0x1eea52=a64_0x308cd4,{currentPassword:_0xad59cc,newPassword:_0x332f0b,confirmNewPassword:_0x219c3d}=_0x2ce357;if(_0x332f0b!==_0x219c3d)throw new Error(_0x1eea52(0xd3));if(_0x332f0b[_0x1eea52(0xd7)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x265002=await database_1['default'][_0x1eea52(0xc7)][_0x1eea52(0xab)]({'where':{'id':_0x563727},'select':{'password':!![]}});if(!_0x265002)throw new Error('Shop\x20not\x20found');const _0x4ca3d7=await bcryptjs_1[_0x1eea52(0xb8)]['compare'](_0xad59cc,_0x265002['password']);if(!_0x4ca3d7)throw new Error(_0x1eea52(0xb3));const _0x2fdd0b=await bcryptjs_1[_0x1eea52(0xb8)][_0x1eea52(0xd2)](_0x332f0b,0xc);await database_1[_0x1eea52(0xb8)]['shop'][_0x1eea52(0xb2)]({'where':{'id':_0x563727},'data':{'password':_0x2fdd0b}});}async[a64_0x308cd4(0xc8)](_0xa15f2a,_0x5345ae){const _0x4dea58=a64_0x308cd4;await this[_0x4dea58(0xda)](_0xa15f2a);const _0xf9ea97={};_0x5345ae[_0x4dea58(0xbb)]!==undefined&&(_0xf9ea97['notificationPaymentSuccess']=_0x5345ae['payment_success']),_0x5345ae[_0x4dea58(0xc3)]!==undefined&&(_0xf9ea97[_0x4dea58(0xb5)]=_0x5345ae['payment_failed']),_0x5345ae['refund']!==undefined&&(_0xf9ea97[_0x4dea58(0xbc)]=_0x5345ae['refund']),_0x5345ae[_0x4dea58(0xc1)]!==undefined&&(_0xf9ea97[_0x4dea58(0xae)]=_0x5345ae[_0x4dea58(0xc1)]),_0x5345ae[_0x4dea58(0xc9)]!==undefined&&(_0xf9ea97[_0x4dea58(0xa6)]=_0x5345ae[_0x4dea58(0xc9)]),_0x5345ae[_0x4dea58(0xb6)]!==undefined&&(_0xf9ea97[_0x4dea58(0xa5)]=_0x5345ae[_0x4dea58(0xb6)]),await database_1[_0x4dea58(0xb8)][_0x4dea58(0xd4)][_0x4dea58(0xb2)]({'where':{'shopId':_0xa15f2a},'data':_0xf9ea97});}async[a64_0x308cd4(0xce)](_0x41186f,_0x798a8){const _0x76db95=a64_0x308cd4;await this[_0x76db95(0xda)](_0x41186f);const _0x191cbf={};_0x798a8[_0x76db95(0xc6)]!==undefined&&(_0x191cbf[_0x76db95(0xd6)]=_0x798a8[_0x76db95(0xc6)]||null),_0x798a8['chatId']!==undefined&&(_0x191cbf[_0x76db95(0xbf)]=_0x798a8[_0x76db95(0xcb)]||null),await database_1[_0x76db95(0xb8)]['shopSettings']['update']({'where':{'shopId':_0x41186f},'data':_0x191cbf});}async[a64_0x308cd4(0x9f)](_0x2f15d7,_0x1cd281){const _0x266892=a64_0x308cd4;await this['ensureSettingsExist'](_0x2f15d7);const _0x4e682e={};_0x1cd281['webhookUrl']!==undefined&&(_0x4e682e[_0x266892(0xb7)]=_0x1cd281[_0x266892(0xb7)]||null),_0x1cd281[_0x266892(0xc0)]!==undefined&&(_0x4e682e[_0x266892(0xc0)]=_0x1cd281[_0x266892(0xc0)]||[]),await database_1[_0x266892(0xb8)][_0x266892(0xd4)][_0x266892(0xb2)]({'where':{'shopId':_0x2f15d7},'data':_0x4e682e});}async[a64_0x308cd4(0x9c)](_0x45054b){const _0x258bbc=a64_0x308cd4,_0x5df5ac=_0x258bbc(0xc4)+crypto_1[_0x258bbc(0xb8)][_0x258bbc(0xd1)](0x20)[_0x258bbc(0xcf)]('hex'),_0x40a2dc=_0x258bbc(0xd9)+crypto_1[_0x258bbc(0xb8)][_0x258bbc(0xd1)](0x20)[_0x258bbc(0xcf)](_0x258bbc(0xca));await database_1[_0x258bbc(0xb8)][_0x258bbc(0xc7)]['update']({'where':{'id':_0x45054b},'data':{'publicKey':_0x5df5ac,'secretKey':_0x40a2dc}});}async['deleteAccount'](_0x44ae1f,_0x53b4a8){const _0xc0dcf7=a64_0x308cd4,{passwordConfirmation:_0x8966ac}=_0x53b4a8,_0x27702f=await database_1[_0xc0dcf7(0xb8)][_0xc0dcf7(0xc7)]['findUnique']({'where':{'id':_0x44ae1f},'select':{'password':!![]}});if(!_0x27702f)throw new Error(_0xc0dcf7(0xa9));const _0xb76844=await bcryptjs_1['default']['compare'](_0x8966ac,_0x27702f['password']);if(!_0xb76844)throw new Error(_0xc0dcf7(0xc2));await database_1[_0xc0dcf7(0xb8)][_0xc0dcf7(0xc7)]['delete']({'where':{'id':_0x44ae1f}});}async[a64_0x308cd4(0xda)](_0x3a5762){const _0x4b1df3=a64_0x308cd4,_0x2a9f10=await database_1[_0x4b1df3(0xb8)][_0x4b1df3(0xd4)][_0x4b1df3(0xab)]({'where':{'shopId':_0x3a5762}});!_0x2a9f10&&await database_1[_0x4b1df3(0xb8)][_0x4b1df3(0xd4)]['create']({'data':{'shopId':_0x3a5762}});}}function a64_0x32f0(_0x58f90b,_0x362ccd){const _0x4df6db=a64_0x4df6();return a64_0x32f0=function(_0x32f02a,_0x37ed91){_0x32f02a=_0x32f02a-0x9a;let _0x8a0a74=_0x4df6db[_0x32f02a];return _0x8a0a74;},a64_0x32f0(_0x58f90b,_0x362ccd);}exports['SettingsService']=SettingsService;