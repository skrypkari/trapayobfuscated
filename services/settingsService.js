'use strict';const a52_0x201e09=a52_0x4016;(function(_0x2d1f90,_0x56f500){const _0x36d6e8=a52_0x4016,_0x5b7b7d=_0x2d1f90();while(!![]){try{const _0x56b15e=parseInt(_0x36d6e8(0xd5))/0x1*(parseInt(_0x36d6e8(0xba))/0x2)+parseInt(_0x36d6e8(0x9c))/0x3*(parseInt(_0x36d6e8(0xd2))/0x4)+parseInt(_0x36d6e8(0xca))/0x5*(parseInt(_0x36d6e8(0x93))/0x6)+parseInt(_0x36d6e8(0xc7))/0x7*(-parseInt(_0x36d6e8(0x92))/0x8)+parseInt(_0x36d6e8(0xa3))/0x9*(parseInt(_0x36d6e8(0xa5))/0xa)+parseInt(_0x36d6e8(0xa8))/0xb*(parseInt(_0x36d6e8(0xc8))/0xc)+parseInt(_0x36d6e8(0xaa))/0xd*(-parseInt(_0x36d6e8(0x94))/0xe);if(_0x56b15e===_0x56f500)break;else _0x5b7b7d['push'](_0x5b7b7d['shift']());}catch(_0x9acdc5){_0x5b7b7d['push'](_0x5b7b7d['shift']());}}}(a52_0x31db,0xc7d65));var __importDefault=this&&this[a52_0x201e09(0x9d)]||function(_0x5c1976){const _0x326e05=a52_0x201e09;return _0x5c1976&&_0x5c1976[_0x326e05(0xd4)]?_0x5c1976:{'default':_0x5c1976};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a52_0x201e09(0xc4)]=void 0x0;function a52_0x31db(){const _0x252b50=['getShopSettings','delete','SettingsService','repeat','Current\x20password\x20is\x20incorrect','8911hMeZWB','12zHMRMX','telegram','326505YMkaFB','ensureSettingsExist','telegramChatId','botApiKey','shopSettings','payment_failed','webhookUrl','randomBytes','16804EgfzaS','toString','__esModule','11jYEZsx','changePassword','payout','parse','parseWebhookEvents','maskApiKey','isArray','shopUrl','5184GBtqMH','132XwbMEp','60200MedZOj','updateTelegramSettings','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','payment_success','pk_','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','settings','max','813yejkMS','__importDefault','default','Shop\x20not\x20found','bcryptjs','notificationPayout','shop','1353501jBFxGd','crypto','20RNNhlC','notificationLogin','password','969353gHUmJW','../config/database','5343cfJAaR','substring','webhookEvents','hash','updateNotifications','update','compare','hex','create','telegramBotApiKey','api_error','length','Password\x20confirmation\x20is\x20incorrect','name','findUnique','notificationPaymentFailed','81226fjHPDA','updateWebhookSettings','refund','chatId','notificationApiError','login','notificationPaymentSuccess','revokeAllApiKeys'];a52_0x31db=function(){return _0x252b50;};return a52_0x31db();}function a52_0x4016(_0x12b6af,_0xa3614b){const _0x31db5d=a52_0x31db();return a52_0x4016=function(_0x4016a2,_0x183314){_0x4016a2=_0x4016a2-0x91;let _0x153c77=_0x31db5d[_0x4016a2];return _0x153c77;},a52_0x4016(_0x12b6af,_0xa3614b);}const bcryptjs_1=__importDefault(require(a52_0x201e09(0xa0))),crypto_1=__importDefault(require(a52_0x201e09(0xa4))),database_1=__importDefault(require(a52_0x201e09(0xa9)));class SettingsService{[a52_0x201e09(0xda)](_0x1c9f69){const _0x3897c2=a52_0x201e09;if(!_0x1c9f69)return'';if(_0x1c9f69['length']<=0x8)return _0x1c9f69;const _0x409e34=_0x1c9f69[_0x3897c2(0xab)](0x0,0x8),_0x59d6c4='*'[_0x3897c2(0xc5)](Math[_0x3897c2(0x9b)](0x0,_0x1c9f69[_0x3897c2(0xb5)]-0x8));return _0x409e34+_0x59d6c4;}[a52_0x201e09(0xd9)](_0x2f742a){const _0xc39339=a52_0x201e09;if(!_0x2f742a)return[];if(Array['isArray'](_0x2f742a))return _0x2f742a;if(typeof _0x2f742a==='string')try{const _0x30b411=JSON[_0xc39339(0xd8)](_0x2f742a);return Array[_0xc39339(0xdb)](_0x30b411)?_0x30b411:[];}catch{return[];}return[];}async[a52_0x201e09(0xc2)](_0x339e20){const _0x4eab35=a52_0x201e09,_0x236563=await database_1[_0x4eab35(0x9e)]['shop'][_0x4eab35(0xb8)]({'where':{'id':_0x339e20},'include':{'settings':!![]}});if(!_0x236563)throw new Error(_0x4eab35(0x9f));let _0x485f24=_0x236563[_0x4eab35(0x9a)];return!_0x485f24&&(_0x485f24=await database_1['default'][_0x4eab35(0xce)][_0x4eab35(0xb2)]({'data':{'shopId':_0x236563['id']}})),{'fullName':_0x236563[_0x4eab35(0xb7)],'brand':_0x236563[_0x4eab35(0xb7)],'merchantUrl':_0x236563[_0x4eab35(0x91)],'telegramUsername':_0x236563[_0x4eab35(0xc9)],'telegramBotApiKey':_0x485f24['telegramBotApiKey']?this[_0x4eab35(0xda)](_0x485f24[_0x4eab35(0xb3)]):null,'telegramChatId':_0x485f24[_0x4eab35(0xcc)],'webhookUrl':_0x485f24[_0x4eab35(0xd0)],'webhookEvents':this[_0x4eab35(0xd9)](_0x485f24[_0x4eab35(0xac)]),'notifications':{'payment_success':_0x485f24['notificationPaymentSuccess'],'payment_failed':_0x485f24[_0x4eab35(0xb9)],'refund':_0x485f24['notificationRefund'],'payout':_0x485f24['notificationPayout'],'login':_0x485f24['notificationLogin'],'api_error':_0x485f24[_0x4eab35(0xbe)]}};}async[a52_0x201e09(0xd6)](_0xc81af5,_0x3afd3d){const _0x595515=a52_0x201e09,{currentPassword:_0x52e8e8,newPassword:_0x5c2612,confirmNewPassword:_0x400038}=_0x3afd3d;if(_0x5c2612!==_0x400038)throw new Error(_0x595515(0x99));if(_0x5c2612[_0x595515(0xb5)]<0x6)throw new Error(_0x595515(0x96));const _0xf2e173=await database_1[_0x595515(0x9e)]['shop'][_0x595515(0xb8)]({'where':{'id':_0xc81af5},'select':{'password':!![]}});if(!_0xf2e173)throw new Error(_0x595515(0x9f));const _0xf47b35=await bcryptjs_1['default'][_0x595515(0xb0)](_0x52e8e8,_0xf2e173[_0x595515(0xa7)]);if(!_0xf47b35)throw new Error(_0x595515(0xc6));const _0x371644=await bcryptjs_1[_0x595515(0x9e)][_0x595515(0xad)](_0x5c2612,0xc);await database_1[_0x595515(0x9e)][_0x595515(0xa2)][_0x595515(0xaf)]({'where':{'id':_0xc81af5},'data':{'password':_0x371644}});}async[a52_0x201e09(0xae)](_0xd42e26,_0x4fb06a){const _0x16b0e3=a52_0x201e09;await this[_0x16b0e3(0xcb)](_0xd42e26);const _0x5b77f0={};_0x4fb06a[_0x16b0e3(0x97)]!==undefined&&(_0x5b77f0[_0x16b0e3(0xc0)]=_0x4fb06a[_0x16b0e3(0x97)]),_0x4fb06a[_0x16b0e3(0xcf)]!==undefined&&(_0x5b77f0['notificationPaymentFailed']=_0x4fb06a[_0x16b0e3(0xcf)]),_0x4fb06a[_0x16b0e3(0xbc)]!==undefined&&(_0x5b77f0['notificationRefund']=_0x4fb06a['refund']),_0x4fb06a['payout']!==undefined&&(_0x5b77f0[_0x16b0e3(0xa1)]=_0x4fb06a[_0x16b0e3(0xd7)]),_0x4fb06a[_0x16b0e3(0xbf)]!==undefined&&(_0x5b77f0[_0x16b0e3(0xa6)]=_0x4fb06a[_0x16b0e3(0xbf)]),_0x4fb06a[_0x16b0e3(0xb4)]!==undefined&&(_0x5b77f0[_0x16b0e3(0xbe)]=_0x4fb06a[_0x16b0e3(0xb4)]),await database_1[_0x16b0e3(0x9e)]['shopSettings']['update']({'where':{'shopId':_0xd42e26},'data':_0x5b77f0});}async[a52_0x201e09(0x95)](_0x1a97d4,_0x5c0046){const _0x4cfbda=a52_0x201e09;await this[_0x4cfbda(0xcb)](_0x1a97d4);const _0x54e0d9={};_0x5c0046[_0x4cfbda(0xcd)]!==undefined&&(_0x54e0d9['telegramBotApiKey']=_0x5c0046[_0x4cfbda(0xcd)]||null),_0x5c0046[_0x4cfbda(0xbd)]!==undefined&&(_0x54e0d9[_0x4cfbda(0xcc)]=_0x5c0046['chatId']||null),await database_1[_0x4cfbda(0x9e)][_0x4cfbda(0xce)]['update']({'where':{'shopId':_0x1a97d4},'data':_0x54e0d9});}async[a52_0x201e09(0xbb)](_0x4db032,_0x2762da){const _0x13c534=a52_0x201e09;await this[_0x13c534(0xcb)](_0x4db032);const _0xca6ac7={};_0x2762da[_0x13c534(0xd0)]!==undefined&&(_0xca6ac7['webhookUrl']=_0x2762da[_0x13c534(0xd0)]||null),_0x2762da[_0x13c534(0xac)]!==undefined&&(_0xca6ac7[_0x13c534(0xac)]=_0x2762da['webhookEvents']||[]),await database_1[_0x13c534(0x9e)][_0x13c534(0xce)][_0x13c534(0xaf)]({'where':{'shopId':_0x4db032},'data':_0xca6ac7});}async[a52_0x201e09(0xc1)](_0x3e2b46){const _0x45798e=a52_0x201e09,_0x40bd5c=_0x45798e(0x98)+crypto_1[_0x45798e(0x9e)][_0x45798e(0xd1)](0x20)[_0x45798e(0xd3)](_0x45798e(0xb1)),_0x3e822d='sk_'+crypto_1['default']['randomBytes'](0x20)[_0x45798e(0xd3)](_0x45798e(0xb1));await database_1[_0x45798e(0x9e)][_0x45798e(0xa2)][_0x45798e(0xaf)]({'where':{'id':_0x3e2b46},'data':{'publicKey':_0x40bd5c,'secretKey':_0x3e822d}});}async['deleteAccount'](_0x10716c,_0x502953){const _0x103a09=a52_0x201e09,{passwordConfirmation:_0x5b7c14}=_0x502953,_0x34cdb8=await database_1['default']['shop'][_0x103a09(0xb8)]({'where':{'id':_0x10716c},'select':{'password':!![]}});if(!_0x34cdb8)throw new Error(_0x103a09(0x9f));const _0x250ede=await bcryptjs_1[_0x103a09(0x9e)][_0x103a09(0xb0)](_0x5b7c14,_0x34cdb8[_0x103a09(0xa7)]);if(!_0x250ede)throw new Error(_0x103a09(0xb6));await database_1[_0x103a09(0x9e)][_0x103a09(0xa2)][_0x103a09(0xc3)]({'where':{'id':_0x10716c}});}async['ensureSettingsExist'](_0x34ab34){const _0x54468d=a52_0x201e09,_0x26f6d8=await database_1[_0x54468d(0x9e)][_0x54468d(0xce)]['findUnique']({'where':{'shopId':_0x34ab34}});!_0x26f6d8&&await database_1[_0x54468d(0x9e)][_0x54468d(0xce)][_0x54468d(0xb2)]({'data':{'shopId':_0x34ab34}});}}exports[a52_0x201e09(0xc4)]=SettingsService;