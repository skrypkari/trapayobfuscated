'use strict';const a53_0x407011=a53_0x244f;(function(_0x92d2e3,_0x43dbcf){const _0x147cc0=a53_0x244f,_0x4a74c2=_0x92d2e3();while(!![]){try{const _0x44a5ae=-parseInt(_0x147cc0(0x191))/0x1+-parseInt(_0x147cc0(0x1a3))/0x2*(parseInt(_0x147cc0(0x1ac))/0x3)+-parseInt(_0x147cc0(0x187))/0x4*(-parseInt(_0x147cc0(0x1a6))/0x5)+-parseInt(_0x147cc0(0x1b0))/0x6+-parseInt(_0x147cc0(0x1ba))/0x7*(-parseInt(_0x147cc0(0x186))/0x8)+-parseInt(_0x147cc0(0x199))/0x9+parseInt(_0x147cc0(0x1b2))/0xa;if(_0x44a5ae===_0x43dbcf)break;else _0x4a74c2['push'](_0x4a74c2['shift']());}catch(_0x54863e){_0x4a74c2['push'](_0x4a74c2['shift']());}}}(a53_0x5321,0x81736));function a53_0x5321(){const _0x38dcf9=['login','default','notificationApiError','SettingsService','ensureSettingsExist','isArray','__importDefault','Shop\x20not\x20found','password','827261nyQUGV','getShopSettings','bcryptjs','notificationPayout','name','crypto','Current\x20password\x20is\x20incorrect','parseWebhookEvents','7890876dTalRs','substring','hex','payout','botApiKey','findUnique','chatId','deleteAccount','compare','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','54TPIqSB','notificationPaymentFailed','__esModule','5233760AfWMQo','webhookUrl','api_error','webhookEvents','shop','telegramBotApiKey','36249JTwqSG','notificationPaymentSuccess','changePassword','settings','951762pXsKcO','create','6130520yPuwEJ','Password\x20confirmation\x20is\x20incorrect','notificationLogin','../config/database','pk_','payment_success','defineProperty','notificationRefund','973QLEXxp','delete','length','maskApiKey','shopSettings','revokeAllApiKeys','update','toString','randomBytes','refund','payment_failed','parse','telegramChatId','60968FOVTYu','4kpCaxC'];a53_0x5321=function(){return _0x38dcf9;};return a53_0x5321();}function a53_0x244f(_0x424ba6,_0x6e98){const _0x53210b=a53_0x5321();return a53_0x244f=function(_0x244f56,_0x20f0c2){_0x244f56=_0x244f56-0x17a;let _0x5eea56=_0x53210b[_0x244f56];return _0x5eea56;},a53_0x244f(_0x424ba6,_0x6e98);}var __importDefault=this&&this[a53_0x407011(0x18e)]||function(_0x1fed24){const _0x163e2c=a53_0x407011;return _0x1fed24&&_0x1fed24[_0x163e2c(0x1a5)]?_0x1fed24:{'default':_0x1fed24};};Object[a53_0x407011(0x1b8)](exports,a53_0x407011(0x1a5),{'value':!![]}),exports[a53_0x407011(0x18b)]=void 0x0;const bcryptjs_1=__importDefault(require(a53_0x407011(0x193))),crypto_1=__importDefault(require(a53_0x407011(0x196))),database_1=__importDefault(require(a53_0x407011(0x1b5)));class SettingsService{[a53_0x407011(0x17c)](_0xe3a99e){const _0x351a47=a53_0x407011;if(!_0xe3a99e)return'';if(_0xe3a99e['length']<=0x8)return _0xe3a99e;const _0x387d0c=_0xe3a99e[_0x351a47(0x19a)](0x0,0x8),_0x56ac84='*'['repeat'](Math['max'](0x0,_0xe3a99e[_0x351a47(0x17b)]-0x8));return _0x387d0c+_0x56ac84;}[a53_0x407011(0x198)](_0x5eb8a5){const _0x5e698a=a53_0x407011;if(!_0x5eb8a5)return[];if(Array['isArray'](_0x5eb8a5))return _0x5eb8a5;if(typeof _0x5eb8a5==='string')try{const _0x156f31=JSON[_0x5e698a(0x184)](_0x5eb8a5);return Array[_0x5e698a(0x18d)](_0x156f31)?_0x156f31:[];}catch{return[];}return[];}async[a53_0x407011(0x192)](_0x3e3235){const _0x4c6196=a53_0x407011,_0x2cbb5e=await database_1[_0x4c6196(0x189)][_0x4c6196(0x1aa)][_0x4c6196(0x19e)]({'where':{'id':_0x3e3235},'include':{'settings':!![]}});if(!_0x2cbb5e)throw new Error('Shop\x20not\x20found');let _0x5dcdcc=_0x2cbb5e[_0x4c6196(0x1af)];return!_0x5dcdcc&&(_0x5dcdcc=await database_1[_0x4c6196(0x189)][_0x4c6196(0x17d)][_0x4c6196(0x1b1)]({'data':{'shopId':_0x2cbb5e['id']}})),{'fullName':_0x2cbb5e['name'],'brand':_0x2cbb5e[_0x4c6196(0x195)],'merchantUrl':_0x2cbb5e['shopUrl'],'telegramUsername':_0x2cbb5e['telegram'],'telegramBotApiKey':_0x5dcdcc['telegramBotApiKey']?this['maskApiKey'](_0x5dcdcc[_0x4c6196(0x1ab)]):null,'telegramChatId':_0x5dcdcc['telegramChatId'],'webhookUrl':_0x5dcdcc[_0x4c6196(0x1a7)],'webhookEvents':this[_0x4c6196(0x198)](_0x5dcdcc['webhookEvents']),'notifications':{'payment_success':_0x5dcdcc[_0x4c6196(0x1ad)],'payment_failed':_0x5dcdcc[_0x4c6196(0x1a4)],'refund':_0x5dcdcc[_0x4c6196(0x1b9)],'payout':_0x5dcdcc['notificationPayout'],'login':_0x5dcdcc[_0x4c6196(0x1b4)],'api_error':_0x5dcdcc[_0x4c6196(0x18a)]}};}async[a53_0x407011(0x1ae)](_0x24d1a4,_0x367b99){const _0x327780=a53_0x407011,{currentPassword:_0x5ada0f,newPassword:_0x446fae,confirmNewPassword:_0x325df4}=_0x367b99;if(_0x446fae!==_0x325df4)throw new Error(_0x327780(0x1a2));if(_0x446fae['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x474059=await database_1['default']['shop'][_0x327780(0x19e)]({'where':{'id':_0x24d1a4},'select':{'password':!![]}});if(!_0x474059)throw new Error(_0x327780(0x18f));const _0x8b2a40=await bcryptjs_1['default']['compare'](_0x5ada0f,_0x474059[_0x327780(0x190)]);if(!_0x8b2a40)throw new Error(_0x327780(0x197));const _0x32f611=await bcryptjs_1['default']['hash'](_0x446fae,0xc);await database_1[_0x327780(0x189)][_0x327780(0x1aa)][_0x327780(0x17f)]({'where':{'id':_0x24d1a4},'data':{'password':_0x32f611}});}async['updateNotifications'](_0x26327b,_0x55b332){const _0x532ceb=a53_0x407011;await this['ensureSettingsExist'](_0x26327b);const _0x4cdf23={};_0x55b332['payment_success']!==undefined&&(_0x4cdf23[_0x532ceb(0x1ad)]=_0x55b332[_0x532ceb(0x1b7)]),_0x55b332[_0x532ceb(0x183)]!==undefined&&(_0x4cdf23['notificationPaymentFailed']=_0x55b332[_0x532ceb(0x183)]),_0x55b332[_0x532ceb(0x182)]!==undefined&&(_0x4cdf23[_0x532ceb(0x1b9)]=_0x55b332['refund']),_0x55b332[_0x532ceb(0x19c)]!==undefined&&(_0x4cdf23[_0x532ceb(0x194)]=_0x55b332[_0x532ceb(0x19c)]),_0x55b332['login']!==undefined&&(_0x4cdf23[_0x532ceb(0x1b4)]=_0x55b332[_0x532ceb(0x188)]),_0x55b332[_0x532ceb(0x1a8)]!==undefined&&(_0x4cdf23[_0x532ceb(0x18a)]=_0x55b332[_0x532ceb(0x1a8)]),await database_1[_0x532ceb(0x189)]['shopSettings'][_0x532ceb(0x17f)]({'where':{'shopId':_0x26327b},'data':_0x4cdf23});}async['updateTelegramSettings'](_0x4335c4,_0xf3ed2a){const _0x5c5d72=a53_0x407011;await this[_0x5c5d72(0x18c)](_0x4335c4);const _0x489dcb={};_0xf3ed2a[_0x5c5d72(0x19d)]!==undefined&&(_0x489dcb['telegramBotApiKey']=_0xf3ed2a[_0x5c5d72(0x19d)]||null),_0xf3ed2a['chatId']!==undefined&&(_0x489dcb[_0x5c5d72(0x185)]=_0xf3ed2a[_0x5c5d72(0x19f)]||null),await database_1['default'][_0x5c5d72(0x17d)][_0x5c5d72(0x17f)]({'where':{'shopId':_0x4335c4},'data':_0x489dcb});}async['updateWebhookSettings'](_0x5378c7,_0x368005){const _0x1027c7=a53_0x407011;await this['ensureSettingsExist'](_0x5378c7);const _0x530053={};_0x368005[_0x1027c7(0x1a7)]!==undefined&&(_0x530053[_0x1027c7(0x1a7)]=_0x368005['webhookUrl']||null),_0x368005[_0x1027c7(0x1a9)]!==undefined&&(_0x530053['webhookEvents']=_0x368005['webhookEvents']||[]),await database_1['default'][_0x1027c7(0x17d)][_0x1027c7(0x17f)]({'where':{'shopId':_0x5378c7},'data':_0x530053});}async[a53_0x407011(0x17e)](_0xee457e){const _0x323ca0=a53_0x407011,_0x43dd13=_0x323ca0(0x1b6)+crypto_1[_0x323ca0(0x189)][_0x323ca0(0x181)](0x20)[_0x323ca0(0x180)](_0x323ca0(0x19b)),_0x5d01cd='sk_'+crypto_1['default'][_0x323ca0(0x181)](0x20)[_0x323ca0(0x180)](_0x323ca0(0x19b));await database_1[_0x323ca0(0x189)][_0x323ca0(0x1aa)][_0x323ca0(0x17f)]({'where':{'id':_0xee457e},'data':{'publicKey':_0x43dd13,'secretKey':_0x5d01cd}});}async[a53_0x407011(0x1a0)](_0x4fbed8,_0x76f474){const _0x440205=a53_0x407011,{passwordConfirmation:_0x4807e6}=_0x76f474,_0x4eae6a=await database_1['default'][_0x440205(0x1aa)]['findUnique']({'where':{'id':_0x4fbed8},'select':{'password':!![]}});if(!_0x4eae6a)throw new Error(_0x440205(0x18f));const _0x217590=await bcryptjs_1['default'][_0x440205(0x1a1)](_0x4807e6,_0x4eae6a[_0x440205(0x190)]);if(!_0x217590)throw new Error(_0x440205(0x1b3));await database_1[_0x440205(0x189)][_0x440205(0x1aa)][_0x440205(0x17a)]({'where':{'id':_0x4fbed8}});}async['ensureSettingsExist'](_0xdbea92){const _0x3e6d10=a53_0x407011,_0x32a6a5=await database_1[_0x3e6d10(0x189)][_0x3e6d10(0x17d)][_0x3e6d10(0x19e)]({'where':{'shopId':_0xdbea92}});!_0x32a6a5&&await database_1[_0x3e6d10(0x189)][_0x3e6d10(0x17d)][_0x3e6d10(0x1b1)]({'data':{'shopId':_0xdbea92}});}}exports[a53_0x407011(0x18b)]=SettingsService;