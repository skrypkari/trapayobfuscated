'use strict';function a52_0x52fc(){const _0x54399a=['findUnique','Shop\x20not\x20found','telegramChatId','6133730qpflPj','hash','telegramBotApiKey','updateWebhookSettings','__esModule','string','notificationRefund','1243800YDZNAb','login','parseWebhookEvents','substring','68EhyZzB','hex','create','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','default','1431360hixmRY','notificationPayout','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','payment_failed','isArray','api_error','maskApiKey','updateTelegramSettings','webhookUrl','payout','refund','randomBytes','shop','53hGMdru','9PZXypa','length','Password\x20confirmation\x20is\x20incorrect','notificationPaymentSuccess','2449976BKzkQL','2000929rndIZO','compare','chatId','shopSettings','settings','updateNotifications','ensureSettingsExist','15636QMzYhU','4832yoNQQx','toString','botApiKey','Current\x20password\x20is\x20incorrect','payment_success','password','revokeAllApiKeys','../config/database','parse','update','__importDefault','bcryptjs','webhookEvents','notificationPaymentFailed','notificationApiError','crypto','name','defineProperty'];a52_0x52fc=function(){return _0x54399a;};return a52_0x52fc();}const a52_0x47e6f2=a52_0x52d3;(function(_0x7a4d85,_0x1f6b38){const _0xb3c06f=a52_0x52d3,_0x5d6589=_0x7a4d85();while(!![]){try{const _0x5db6da=-parseInt(_0xb3c06f(0x183))/0x1*(-parseInt(_0xb3c06f(0x191))/0x2)+-parseInt(_0xb3c06f(0x190))/0x3*(parseInt(_0xb3c06f(0x171))/0x4)+-parseInt(_0xb3c06f(0x176))/0x5+-parseInt(_0xb3c06f(0x1ad))/0x6+-parseInt(_0xb3c06f(0x189))/0x7+parseInt(_0xb3c06f(0x188))/0x8*(parseInt(_0xb3c06f(0x184))/0x9)+parseInt(_0xb3c06f(0x1a6))/0xa;if(_0x5db6da===_0x1f6b38)break;else _0x5d6589['push'](_0x5d6589['shift']());}catch(_0x4cadf8){_0x5d6589['push'](_0x5d6589['shift']());}}}(a52_0x52fc,0x2bdbd));var __importDefault=this&&this[a52_0x47e6f2(0x19b)]||function(_0x3f7daf){const _0x3de257=a52_0x47e6f2;return _0x3f7daf&&_0x3f7daf[_0x3de257(0x1aa)]?_0x3f7daf:{'default':_0x3f7daf};};Object[a52_0x47e6f2(0x1a2)](exports,a52_0x47e6f2(0x1aa),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x47e6f2(0x19c))),crypto_1=__importDefault(require(a52_0x47e6f2(0x1a0))),database_1=__importDefault(require(a52_0x47e6f2(0x198)));function a52_0x52d3(_0x1768ef,_0x5d04bc){const _0x52fc46=a52_0x52fc();return a52_0x52d3=function(_0x52d357,_0x1a93d0){_0x52d357=_0x52d357-0x171;let _0x2013a7=_0x52fc46[_0x52d357];return _0x2013a7;},a52_0x52d3(_0x1768ef,_0x5d04bc);}class SettingsService{[a52_0x47e6f2(0x17c)](_0xaa6ac8){const _0x542281=a52_0x47e6f2;if(!_0xaa6ac8)return'';if(_0xaa6ac8[_0x542281(0x185)]<=0x8)return _0xaa6ac8;const _0x476cce=_0xaa6ac8[_0x542281(0x1b0)](0x0,0x8),_0x1c8ef4='*'['repeat'](Math['max'](0x0,_0xaa6ac8[_0x542281(0x185)]-0x8));return _0x476cce+_0x1c8ef4;}[a52_0x47e6f2(0x1af)](_0x3467c7){const _0x3f7589=a52_0x47e6f2;if(!_0x3467c7)return[];if(Array[_0x3f7589(0x17a)](_0x3467c7))return _0x3467c7;if(typeof _0x3467c7===_0x3f7589(0x1ab))try{const _0x4ad2c0=JSON[_0x3f7589(0x199)](_0x3467c7);return Array[_0x3f7589(0x17a)](_0x4ad2c0)?_0x4ad2c0:[];}catch{return[];}return[];}async['getShopSettings'](_0x30ff0b){const _0x1ff165=a52_0x47e6f2,_0x43d726=await database_1['default'][_0x1ff165(0x182)][_0x1ff165(0x1a3)]({'where':{'id':_0x30ff0b},'include':{'settings':!![]}});if(!_0x43d726)throw new Error(_0x1ff165(0x1a4));let _0x271e80=_0x43d726[_0x1ff165(0x18d)];return!_0x271e80&&(_0x271e80=await database_1[_0x1ff165(0x175)]['shopSettings'][_0x1ff165(0x173)]({'data':{'shopId':_0x43d726['id']}})),{'fullName':_0x43d726[_0x1ff165(0x1a1)],'brand':_0x43d726['name'],'merchantUrl':_0x43d726['shopUrl'],'telegramUsername':_0x43d726['telegram'],'telegramBotApiKey':_0x271e80[_0x1ff165(0x1a8)]?this['maskApiKey'](_0x271e80[_0x1ff165(0x1a8)]):null,'telegramChatId':_0x271e80[_0x1ff165(0x1a5)],'webhookUrl':_0x271e80[_0x1ff165(0x17e)],'webhookEvents':this[_0x1ff165(0x1af)](_0x271e80[_0x1ff165(0x19d)]),'notifications':{'payment_success':_0x271e80[_0x1ff165(0x187)],'payment_failed':_0x271e80[_0x1ff165(0x19e)],'refund':_0x271e80[_0x1ff165(0x1ac)],'payout':_0x271e80['notificationPayout'],'login':_0x271e80['notificationLogin'],'api_error':_0x271e80['notificationApiError']}};}async['changePassword'](_0x9b3246,_0xb790c2){const _0x23b6ac=a52_0x47e6f2,{currentPassword:_0x17a2fd,newPassword:_0x4c16d4,confirmNewPassword:_0x4dd8d6}=_0xb790c2;if(_0x4c16d4!==_0x4dd8d6)throw new Error(_0x23b6ac(0x178));if(_0x4c16d4[_0x23b6ac(0x185)]<0x6)throw new Error(_0x23b6ac(0x174));const _0x4a3b19=await database_1[_0x23b6ac(0x175)]['shop']['findUnique']({'where':{'id':_0x9b3246},'select':{'password':!![]}});if(!_0x4a3b19)throw new Error(_0x23b6ac(0x1a4));const _0x1589c7=await bcryptjs_1[_0x23b6ac(0x175)][_0x23b6ac(0x18a)](_0x17a2fd,_0x4a3b19[_0x23b6ac(0x196)]);if(!_0x1589c7)throw new Error(_0x23b6ac(0x194));const _0xfed83=await bcryptjs_1[_0x23b6ac(0x175)][_0x23b6ac(0x1a7)](_0x4c16d4,0xc);await database_1['default'][_0x23b6ac(0x182)]['update']({'where':{'id':_0x9b3246},'data':{'password':_0xfed83}});}async[a52_0x47e6f2(0x18e)](_0x50235f,_0xc87f52){const _0x4632c0=a52_0x47e6f2;await this['ensureSettingsExist'](_0x50235f);const _0x49652a={};_0xc87f52[_0x4632c0(0x195)]!==undefined&&(_0x49652a[_0x4632c0(0x187)]=_0xc87f52['payment_success']),_0xc87f52[_0x4632c0(0x179)]!==undefined&&(_0x49652a[_0x4632c0(0x19e)]=_0xc87f52[_0x4632c0(0x179)]),_0xc87f52[_0x4632c0(0x180)]!==undefined&&(_0x49652a[_0x4632c0(0x1ac)]=_0xc87f52[_0x4632c0(0x180)]),_0xc87f52[_0x4632c0(0x17f)]!==undefined&&(_0x49652a[_0x4632c0(0x177)]=_0xc87f52[_0x4632c0(0x17f)]),_0xc87f52[_0x4632c0(0x1ae)]!==undefined&&(_0x49652a['notificationLogin']=_0xc87f52[_0x4632c0(0x1ae)]),_0xc87f52[_0x4632c0(0x17b)]!==undefined&&(_0x49652a[_0x4632c0(0x19f)]=_0xc87f52[_0x4632c0(0x17b)]),await database_1[_0x4632c0(0x175)][_0x4632c0(0x18c)]['update']({'where':{'shopId':_0x50235f},'data':_0x49652a});}async[a52_0x47e6f2(0x17d)](_0x205532,_0x306b71){const _0x29c126=a52_0x47e6f2;await this['ensureSettingsExist'](_0x205532);const _0x165223={};_0x306b71[_0x29c126(0x193)]!==undefined&&(_0x165223[_0x29c126(0x1a8)]=_0x306b71['botApiKey']||null),_0x306b71[_0x29c126(0x18b)]!==undefined&&(_0x165223[_0x29c126(0x1a5)]=_0x306b71[_0x29c126(0x18b)]||null),await database_1[_0x29c126(0x175)][_0x29c126(0x18c)][_0x29c126(0x19a)]({'where':{'shopId':_0x205532},'data':_0x165223});}async[a52_0x47e6f2(0x1a9)](_0x3eb549,_0x42b753){const _0x44ad97=a52_0x47e6f2;await this['ensureSettingsExist'](_0x3eb549);const _0x4fa73e={};_0x42b753[_0x44ad97(0x17e)]!==undefined&&(_0x4fa73e[_0x44ad97(0x17e)]=_0x42b753['webhookUrl']||null),_0x42b753[_0x44ad97(0x19d)]!==undefined&&(_0x4fa73e[_0x44ad97(0x19d)]=_0x42b753['webhookEvents']||[]),await database_1[_0x44ad97(0x175)][_0x44ad97(0x18c)][_0x44ad97(0x19a)]({'where':{'shopId':_0x3eb549},'data':_0x4fa73e});}async[a52_0x47e6f2(0x197)](_0x5cfa59){const _0x24de00=a52_0x47e6f2,_0x9ed67a='pk_'+crypto_1[_0x24de00(0x175)]['randomBytes'](0x20)['toString'](_0x24de00(0x172)),_0x2d8356='sk_'+crypto_1[_0x24de00(0x175)][_0x24de00(0x181)](0x20)[_0x24de00(0x192)]('hex');await database_1[_0x24de00(0x175)][_0x24de00(0x182)][_0x24de00(0x19a)]({'where':{'id':_0x5cfa59},'data':{'publicKey':_0x9ed67a,'secretKey':_0x2d8356}});}async['deleteAccount'](_0x42fa97,_0x485ecc){const _0x118b65=a52_0x47e6f2,{passwordConfirmation:_0xe7841}=_0x485ecc,_0x53b388=await database_1[_0x118b65(0x175)][_0x118b65(0x182)][_0x118b65(0x1a3)]({'where':{'id':_0x42fa97},'select':{'password':!![]}});if(!_0x53b388)throw new Error(_0x118b65(0x1a4));const _0x474410=await bcryptjs_1[_0x118b65(0x175)][_0x118b65(0x18a)](_0xe7841,_0x53b388[_0x118b65(0x196)]);if(!_0x474410)throw new Error(_0x118b65(0x186));await database_1[_0x118b65(0x175)][_0x118b65(0x182)]['delete']({'where':{'id':_0x42fa97}});}async[a52_0x47e6f2(0x18f)](_0x556110){const _0x4757cf=a52_0x47e6f2,_0x446610=await database_1[_0x4757cf(0x175)][_0x4757cf(0x18c)]['findUnique']({'where':{'shopId':_0x556110}});!_0x446610&&await database_1[_0x4757cf(0x175)]['shopSettings'][_0x4757cf(0x173)]({'data':{'shopId':_0x556110}});}}exports['SettingsService']=SettingsService;