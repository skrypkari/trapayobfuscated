'use strict';const a56_0x3734f0=a56_0x1e0e;(function(_0x29b67d,_0x21f6a6){const _0x25a75a=a56_0x1e0e,_0x3a2b20=_0x29b67d();while(!![]){try{const _0xa9202c=parseInt(_0x25a75a(0xdb))/0x1*(-parseInt(_0x25a75a(0xe4))/0x2)+-parseInt(_0x25a75a(0x107))/0x3+parseInt(_0x25a75a(0x103))/0x4*(parseInt(_0x25a75a(0xe8))/0x5)+-parseInt(_0x25a75a(0xe3))/0x6+-parseInt(_0x25a75a(0xf1))/0x7*(parseInt(_0x25a75a(0xd9))/0x8)+parseInt(_0x25a75a(0xf5))/0x9*(-parseInt(_0x25a75a(0xe0))/0xa)+parseInt(_0x25a75a(0xec))/0xb;if(_0xa9202c===_0x21f6a6)break;else _0x3a2b20['push'](_0x3a2b20['shift']());}catch(_0xb7e8a2){_0x3a2b20['push'](_0x3a2b20['shift']());}}}(a56_0x3da0,0xdfcab));var __importDefault=this&&this[a56_0x3734f0(0xe9)]||function(_0x11865d){const _0x470e51=a56_0x3734f0;return _0x11865d&&_0x11865d[_0x470e51(0xe1)]?_0x11865d:{'default':_0x11865d};};Object[a56_0x3734f0(0x112)](exports,a56_0x3734f0(0xe1),{'value':!![]}),exports[a56_0x3734f0(0x104)]=void 0x0;function a56_0x1e0e(_0x17df01,_0x57fead){const _0x3da000=a56_0x3da0();return a56_0x1e0e=function(_0x1e0eda,_0x2d8cf8){_0x1e0eda=_0x1e0eda-0xd3;let _0x3742f8=_0x3da000[_0x1e0eda];return _0x3742f8;},a56_0x1e0e(_0x17df01,_0x57fead);}const bcryptjs_1=__importDefault(require(a56_0x3734f0(0x110))),crypto_1=__importDefault(require(a56_0x3734f0(0xd5))),database_1=__importDefault(require(a56_0x3734f0(0xe5)));class SettingsService{[a56_0x3734f0(0x10c)](_0x38258e){const _0x560a3d=a56_0x3734f0;if(!_0x38258e)return'';if(_0x38258e[_0x560a3d(0xfa)]<=0x8)return _0x38258e;const _0x2e196=_0x38258e[_0x560a3d(0xd6)](0x0,0x8),_0x417a84='*'[_0x560a3d(0xff)](Math['max'](0x0,_0x38258e[_0x560a3d(0xfa)]-0x8));return _0x2e196+_0x417a84;}[a56_0x3734f0(0x114)](_0x35b03e){const _0x5d0d7e=a56_0x3734f0;if(!_0x35b03e)return[];if(Array[_0x5d0d7e(0xd8)](_0x35b03e))return _0x35b03e;if(typeof _0x35b03e==='string')try{const _0x582ca4=JSON['parse'](_0x35b03e);return Array[_0x5d0d7e(0xd8)](_0x582ca4)?_0x582ca4:[];}catch{return[];}return[];}async['getShopSettings'](_0x57a853){const _0x1d381b=a56_0x3734f0,_0x551656=await database_1[_0x1d381b(0xfb)][_0x1d381b(0x108)][_0x1d381b(0xed)]({'where':{'id':_0x57a853},'include':{'settings':!![]}});if(!_0x551656)throw new Error(_0x1d381b(0x10b));let _0xd9f763=_0x551656['settings'];return!_0xd9f763&&(_0xd9f763=await database_1['default']['shopSettings'][_0x1d381b(0xe2)]({'data':{'shopId':_0x551656['id']}})),{'fullName':_0x551656[_0x1d381b(0xde)],'brand':_0x551656[_0x1d381b(0xde)],'merchantUrl':_0x551656[_0x1d381b(0x100)],'telegramUsername':_0x551656[_0x1d381b(0xf6)],'telegramBotApiKey':_0xd9f763[_0x1d381b(0xf3)]?this['maskApiKey'](_0xd9f763['telegramBotApiKey']):null,'telegramChatId':_0xd9f763[_0x1d381b(0xd7)],'webhookUrl':_0xd9f763['webhookUrl'],'webhookEvents':this['parseWebhookEvents'](_0xd9f763[_0x1d381b(0x109)]),'notifications':{'payment_success':_0xd9f763['notificationPaymentSuccess'],'payment_failed':_0xd9f763[_0x1d381b(0xdc)],'refund':_0xd9f763['notificationRefund'],'payout':_0xd9f763[_0x1d381b(0xf9)],'login':_0xd9f763[_0x1d381b(0xea)],'api_error':_0xd9f763[_0x1d381b(0x10f)]}};}async[a56_0x3734f0(0xd4)](_0x164d5c,_0x257bde){const _0x1c0c71=a56_0x3734f0,{currentPassword:_0x2f05fa,newPassword:_0x2565dd,confirmNewPassword:_0x56e417}=_0x257bde;if(_0x2565dd!==_0x56e417)throw new Error(_0x1c0c71(0xfd));if(_0x2565dd[_0x1c0c71(0xfa)]<0x6)throw new Error(_0x1c0c71(0xdf));const _0x5e76dc=await database_1[_0x1c0c71(0xfb)]['shop'][_0x1c0c71(0xed)]({'where':{'id':_0x164d5c},'select':{'password':!![]}});if(!_0x5e76dc)throw new Error(_0x1c0c71(0x10b));const _0xe965ed=await bcryptjs_1[_0x1c0c71(0xfb)][_0x1c0c71(0xf7)](_0x2f05fa,_0x5e76dc[_0x1c0c71(0xef)]);if(!_0xe965ed)throw new Error(_0x1c0c71(0xe7));const _0x5cf937=await bcryptjs_1[_0x1c0c71(0xfb)]['hash'](_0x2565dd,0xc);await database_1[_0x1c0c71(0xfb)][_0x1c0c71(0x108)][_0x1c0c71(0x10d)]({'where':{'id':_0x164d5c},'data':{'password':_0x5cf937}});}async[a56_0x3734f0(0x102)](_0x2ed73f,_0xbf55ab){const _0x22b51e=a56_0x3734f0;await this[_0x22b51e(0x106)](_0x2ed73f);const _0x3b51dc={};_0xbf55ab['payment_success']!==undefined&&(_0x3b51dc[_0x22b51e(0xfc)]=_0xbf55ab['payment_success']),_0xbf55ab[_0x22b51e(0xf2)]!==undefined&&(_0x3b51dc[_0x22b51e(0xdc)]=_0xbf55ab[_0x22b51e(0xf2)]),_0xbf55ab[_0x22b51e(0xeb)]!==undefined&&(_0x3b51dc['notificationRefund']=_0xbf55ab[_0x22b51e(0xeb)]),_0xbf55ab['payout']!==undefined&&(_0x3b51dc[_0x22b51e(0xf9)]=_0xbf55ab['payout']),_0xbf55ab['login']!==undefined&&(_0x3b51dc[_0x22b51e(0xea)]=_0xbf55ab['login']),_0xbf55ab[_0x22b51e(0x113)]!==undefined&&(_0x3b51dc[_0x22b51e(0x10f)]=_0xbf55ab['api_error']),await database_1[_0x22b51e(0xfb)][_0x22b51e(0x111)][_0x22b51e(0x10d)]({'where':{'shopId':_0x2ed73f},'data':_0x3b51dc});}async[a56_0x3734f0(0xee)](_0x4a5ce4,_0x4b2efa){const _0x436313=a56_0x3734f0;await this[_0x436313(0x106)](_0x4a5ce4);const _0x51d598={};_0x4b2efa[_0x436313(0xdd)]!==undefined&&(_0x51d598[_0x436313(0xf3)]=_0x4b2efa[_0x436313(0xdd)]||null),_0x4b2efa[_0x436313(0xda)]!==undefined&&(_0x51d598['telegramChatId']=_0x4b2efa['chatId']||null),await database_1[_0x436313(0xfb)][_0x436313(0x111)][_0x436313(0x10d)]({'where':{'shopId':_0x4a5ce4},'data':_0x51d598});}async[a56_0x3734f0(0x10a)](_0x4767ab,_0x174889){const _0x3b6db6=a56_0x3734f0;await this['ensureSettingsExist'](_0x4767ab);const _0x5001bb={};_0x174889[_0x3b6db6(0xfe)]!==undefined&&(_0x5001bb[_0x3b6db6(0xfe)]=_0x174889[_0x3b6db6(0xfe)]||null),_0x174889[_0x3b6db6(0x109)]!==undefined&&(_0x5001bb['webhookEvents']=_0x174889['webhookEvents']||[]),await database_1[_0x3b6db6(0xfb)][_0x3b6db6(0x111)][_0x3b6db6(0x10d)]({'where':{'shopId':_0x4767ab},'data':_0x5001bb});}async[a56_0x3734f0(0xf8)](_0x2df211){const _0x5f36c8=a56_0x3734f0,_0x1e94e6=_0x5f36c8(0xe6)+crypto_1[_0x5f36c8(0xfb)][_0x5f36c8(0xf0)](0x20)[_0x5f36c8(0x105)](_0x5f36c8(0x10e)),_0x1a278a=_0x5f36c8(0xf4)+crypto_1['default']['randomBytes'](0x20)[_0x5f36c8(0x105)](_0x5f36c8(0x10e));await database_1[_0x5f36c8(0xfb)][_0x5f36c8(0x108)]['update']({'where':{'id':_0x2df211},'data':{'publicKey':_0x1e94e6,'secretKey':_0x1a278a}});}async[a56_0x3734f0(0x115)](_0x43452d,_0x2d3bb2){const _0x2c4658=a56_0x3734f0,{passwordConfirmation:_0x37f1a7}=_0x2d3bb2,_0x178a04=await database_1[_0x2c4658(0xfb)][_0x2c4658(0x108)]['findUnique']({'where':{'id':_0x43452d},'select':{'password':!![]}});if(!_0x178a04)throw new Error(_0x2c4658(0x10b));const _0x5aee25=await bcryptjs_1[_0x2c4658(0xfb)][_0x2c4658(0xf7)](_0x37f1a7,_0x178a04[_0x2c4658(0xef)]);if(!_0x5aee25)throw new Error(_0x2c4658(0xd3));await database_1[_0x2c4658(0xfb)][_0x2c4658(0x108)][_0x2c4658(0x101)]({'where':{'id':_0x43452d}});}async[a56_0x3734f0(0x106)](_0x1f2947){const _0x13dbf0=a56_0x3734f0,_0x5f28a2=await database_1[_0x13dbf0(0xfb)][_0x13dbf0(0x111)][_0x13dbf0(0xed)]({'where':{'shopId':_0x1f2947}});!_0x5f28a2&&await database_1['default']['shopSettings']['create']({'data':{'shopId':_0x1f2947}});}}function a56_0x3da0(){const _0x48fdb0=['refund','72621164ilDApk','findUnique','updateTelegramSettings','password','randomBytes','800289gxQkeO','payment_failed','telegramBotApiKey','sk_','140022jRxExo','telegram','compare','revokeAllApiKeys','notificationPayout','length','default','notificationPaymentSuccess','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','webhookUrl','repeat','shopUrl','delete','updateNotifications','14356gGhtjk','SettingsService','toString','ensureSettingsExist','2514813FhRwuz','shop','webhookEvents','updateWebhookSettings','Shop\x20not\x20found','maskApiKey','update','hex','notificationApiError','bcryptjs','shopSettings','defineProperty','api_error','parseWebhookEvents','deleteAccount','Password\x20confirmation\x20is\x20incorrect','changePassword','crypto','substring','telegramChatId','isArray','24okWOXK','chatId','2jPDgNO','notificationPaymentFailed','botApiKey','name','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','1000cxnbOu','__esModule','create','8974710lEJLaR','1481148wSDsyG','../config/database','pk_','Current\x20password\x20is\x20incorrect','40abwwrD','__importDefault','notificationLogin'];a56_0x3da0=function(){return _0x48fdb0;};return a56_0x3da0();}exports['SettingsService']=SettingsService;