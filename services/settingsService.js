'use strict';function a52_0x1e03(){const _0x2ce15e=['4453590OviTmG','changePassword','notificationPaymentFailed','max','telegramChatId','compare','default','deleteAccount','webhookUrl','isArray','string','crypto','length','updateTelegramSettings','Password\x20confirmation\x20is\x20incorrect','payment_failed','notificationPaymentSuccess','notificationLogin','parse','108btLFkE','SettingsService','shopSettings','Current\x20password\x20is\x20incorrect','__importDefault','90252fPvPXu','../config/database','notificationApiError','bcryptjs','7sruwgD','__esModule','12126450UHejdp','ensureSettingsExist','refund','maskApiKey','parseWebhookEvents','api_error','pk_','botApiKey','substring','220118dTKfFp','Shop\x20not\x20found','sk_','5785011OfFdAp','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','defineProperty','password','payout','settings','randomBytes','findUnique','login','getShopSettings','hex','update','payment_success','hash','5656424PjHEJQ','notificationPayout','3fEBISZ','repeat','updateWebhookSettings','chatId','webhookEvents','create','telegram','revokeAllApiKeys','627438RVoMbB','telegramBotApiKey','shop','notificationRefund','toString'];a52_0x1e03=function(){return _0x2ce15e;};return a52_0x1e03();}const a52_0x4ca31a=a52_0x3d3f;(function(_0x26f10b,_0xbe1b6){const _0x558142=a52_0x3d3f,_0x49c4d0=_0x26f10b();while(!![]){try{const _0x12051d=-parseInt(_0x558142(0x1ca))/0x1*(-parseInt(_0x558142(0x1fe))/0x2)+parseInt(_0x558142(0x1ea))/0x3*(-parseInt(_0x558142(0x1ef))/0x4)+parseInt(_0x558142(0x1d7))/0x5+parseInt(_0x558142(0x1d2))/0x6*(parseInt(_0x558142(0x1f3))/0x7)+parseInt(_0x558142(0x1c8))/0x8+parseInt(_0x558142(0x201))/0x9+-parseInt(_0x558142(0x1f5))/0xa;if(_0x12051d===_0xbe1b6)break;else _0x49c4d0['push'](_0x49c4d0['shift']());}catch(_0x4f6d0a){_0x49c4d0['push'](_0x49c4d0['shift']());}}}(a52_0x1e03,0x9ec93));var __importDefault=this&&this[a52_0x4ca31a(0x1ee)]||function(_0x42dc0a){const _0x202067=a52_0x4ca31a;return _0x42dc0a&&_0x42dc0a[_0x202067(0x1f4)]?_0x42dc0a:{'default':_0x42dc0a};};Object[a52_0x4ca31a(0x203)](exports,'__esModule',{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x4ca31a(0x1f2))),crypto_1=__importDefault(require(a52_0x4ca31a(0x1e2))),database_1=__importDefault(require(a52_0x4ca31a(0x1f0)));class SettingsService{[a52_0x4ca31a(0x1f8)](_0x21558a){const _0xfb762d=a52_0x4ca31a;if(!_0x21558a)return'';if(_0x21558a[_0xfb762d(0x1e3)]<=0x8)return _0x21558a;const _0x15d516=_0x21558a[_0xfb762d(0x1fd)](0x0,0x8),_0x481ef9='*'[_0xfb762d(0x1cb)](Math[_0xfb762d(0x1da)](0x0,_0x21558a[_0xfb762d(0x1e3)]-0x8));return _0x15d516+_0x481ef9;}[a52_0x4ca31a(0x1f9)](_0x34c4dc){const _0x326712=a52_0x4ca31a;if(!_0x34c4dc)return[];if(Array[_0x326712(0x1e0)](_0x34c4dc))return _0x34c4dc;if(typeof _0x34c4dc===_0x326712(0x1e1))try{const _0xe98956=JSON[_0x326712(0x1e9)](_0x34c4dc);return Array['isArray'](_0xe98956)?_0xe98956:[];}catch{return[];}return[];}async[a52_0x4ca31a(0x20a)](_0x49571b){const _0x4e6878=a52_0x4ca31a,_0x41c248=await database_1[_0x4e6878(0x1dd)][_0x4e6878(0x1d4)][_0x4e6878(0x208)]({'where':{'id':_0x49571b},'include':{'settings':!![]}});if(!_0x41c248)throw new Error('Shop\x20not\x20found');let _0x2a374f=_0x41c248[_0x4e6878(0x206)];return!_0x2a374f&&(_0x2a374f=await database_1[_0x4e6878(0x1dd)][_0x4e6878(0x1ec)][_0x4e6878(0x1cf)]({'data':{'shopId':_0x41c248['id']}})),{'fullName':_0x41c248['name'],'brand':_0x41c248['name'],'merchantUrl':_0x41c248['shopUrl'],'telegramUsername':_0x41c248[_0x4e6878(0x1d0)],'telegramBotApiKey':_0x2a374f['telegramBotApiKey']?this[_0x4e6878(0x1f8)](_0x2a374f[_0x4e6878(0x1d3)]):null,'telegramChatId':_0x2a374f[_0x4e6878(0x1db)],'webhookUrl':_0x2a374f[_0x4e6878(0x1df)],'webhookEvents':this[_0x4e6878(0x1f9)](_0x2a374f[_0x4e6878(0x1ce)]),'notifications':{'payment_success':_0x2a374f[_0x4e6878(0x1e7)],'payment_failed':_0x2a374f[_0x4e6878(0x1d9)],'refund':_0x2a374f[_0x4e6878(0x1d5)],'payout':_0x2a374f[_0x4e6878(0x1c9)],'login':_0x2a374f['notificationLogin'],'api_error':_0x2a374f[_0x4e6878(0x1f1)]}};}async[a52_0x4ca31a(0x1d8)](_0x268df1,_0x541000){const _0x325a9e=a52_0x4ca31a,{currentPassword:_0x15273c,newPassword:_0x51faa0,confirmNewPassword:_0x4f7fb0}=_0x541000;if(_0x51faa0!==_0x4f7fb0)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x51faa0[_0x325a9e(0x1e3)]<0x6)throw new Error(_0x325a9e(0x202));const _0x42b6ee=await database_1[_0x325a9e(0x1dd)][_0x325a9e(0x1d4)][_0x325a9e(0x208)]({'where':{'id':_0x268df1},'select':{'password':!![]}});if(!_0x42b6ee)throw new Error(_0x325a9e(0x1ff));const _0x2a6dfa=await bcryptjs_1[_0x325a9e(0x1dd)][_0x325a9e(0x1dc)](_0x15273c,_0x42b6ee[_0x325a9e(0x204)]);if(!_0x2a6dfa)throw new Error(_0x325a9e(0x1ed));const _0xec2802=await bcryptjs_1[_0x325a9e(0x1dd)][_0x325a9e(0x1c7)](_0x51faa0,0xc);await database_1[_0x325a9e(0x1dd)][_0x325a9e(0x1d4)]['update']({'where':{'id':_0x268df1},'data':{'password':_0xec2802}});}async['updateNotifications'](_0x470ca9,_0x230fc5){const _0x450c2e=a52_0x4ca31a;await this[_0x450c2e(0x1f6)](_0x470ca9);const _0x34ade9={};_0x230fc5[_0x450c2e(0x1c6)]!==undefined&&(_0x34ade9[_0x450c2e(0x1e7)]=_0x230fc5[_0x450c2e(0x1c6)]),_0x230fc5[_0x450c2e(0x1e6)]!==undefined&&(_0x34ade9['notificationPaymentFailed']=_0x230fc5[_0x450c2e(0x1e6)]),_0x230fc5[_0x450c2e(0x1f7)]!==undefined&&(_0x34ade9[_0x450c2e(0x1d5)]=_0x230fc5[_0x450c2e(0x1f7)]),_0x230fc5['payout']!==undefined&&(_0x34ade9[_0x450c2e(0x1c9)]=_0x230fc5[_0x450c2e(0x205)]),_0x230fc5[_0x450c2e(0x209)]!==undefined&&(_0x34ade9[_0x450c2e(0x1e8)]=_0x230fc5[_0x450c2e(0x209)]),_0x230fc5[_0x450c2e(0x1fa)]!==undefined&&(_0x34ade9[_0x450c2e(0x1f1)]=_0x230fc5[_0x450c2e(0x1fa)]),await database_1[_0x450c2e(0x1dd)]['shopSettings'][_0x450c2e(0x20c)]({'where':{'shopId':_0x470ca9},'data':_0x34ade9});}async[a52_0x4ca31a(0x1e4)](_0x33f915,_0x212d75){const _0x51b19c=a52_0x4ca31a;await this[_0x51b19c(0x1f6)](_0x33f915);const _0xf5bab8={};_0x212d75[_0x51b19c(0x1fc)]!==undefined&&(_0xf5bab8['telegramBotApiKey']=_0x212d75[_0x51b19c(0x1fc)]||null),_0x212d75['chatId']!==undefined&&(_0xf5bab8['telegramChatId']=_0x212d75[_0x51b19c(0x1cd)]||null),await database_1[_0x51b19c(0x1dd)][_0x51b19c(0x1ec)][_0x51b19c(0x20c)]({'where':{'shopId':_0x33f915},'data':_0xf5bab8});}async[a52_0x4ca31a(0x1cc)](_0x541bd2,_0x8c9aa0){const _0x467494=a52_0x4ca31a;await this['ensureSettingsExist'](_0x541bd2);const _0x23c231={};_0x8c9aa0['webhookUrl']!==undefined&&(_0x23c231['webhookUrl']=_0x8c9aa0['webhookUrl']||null),_0x8c9aa0[_0x467494(0x1ce)]!==undefined&&(_0x23c231[_0x467494(0x1ce)]=_0x8c9aa0[_0x467494(0x1ce)]||[]),await database_1['default'][_0x467494(0x1ec)][_0x467494(0x20c)]({'where':{'shopId':_0x541bd2},'data':_0x23c231});}async[a52_0x4ca31a(0x1d1)](_0x50fd06){const _0x4acf3e=a52_0x4ca31a,_0x4272a8=_0x4acf3e(0x1fb)+crypto_1['default'][_0x4acf3e(0x207)](0x20)[_0x4acf3e(0x1d6)](_0x4acf3e(0x20b)),_0x2eac47=_0x4acf3e(0x200)+crypto_1[_0x4acf3e(0x1dd)]['randomBytes'](0x20)['toString'](_0x4acf3e(0x20b));await database_1[_0x4acf3e(0x1dd)]['shop']['update']({'where':{'id':_0x50fd06},'data':{'publicKey':_0x4272a8,'secretKey':_0x2eac47}});}async[a52_0x4ca31a(0x1de)](_0x1cbc87,_0x220a04){const _0x16f81a=a52_0x4ca31a,{passwordConfirmation:_0x52b6a5}=_0x220a04,_0x5a4aa6=await database_1[_0x16f81a(0x1dd)]['shop']['findUnique']({'where':{'id':_0x1cbc87},'select':{'password':!![]}});if(!_0x5a4aa6)throw new Error(_0x16f81a(0x1ff));const _0x59e101=await bcryptjs_1['default']['compare'](_0x52b6a5,_0x5a4aa6[_0x16f81a(0x204)]);if(!_0x59e101)throw new Error(_0x16f81a(0x1e5));await database_1['default'][_0x16f81a(0x1d4)]['delete']({'where':{'id':_0x1cbc87}});}async['ensureSettingsExist'](_0x507d66){const _0x47bdd8=a52_0x4ca31a,_0x5befd6=await database_1[_0x47bdd8(0x1dd)]['shopSettings'][_0x47bdd8(0x208)]({'where':{'shopId':_0x507d66}});!_0x5befd6&&await database_1[_0x47bdd8(0x1dd)][_0x47bdd8(0x1ec)][_0x47bdd8(0x1cf)]({'data':{'shopId':_0x507d66}});}}function a52_0x3d3f(_0x1d7670,_0x795ee7){const _0x1e03ca=a52_0x1e03();return a52_0x3d3f=function(_0x3d3f7b,_0x12180a){_0x3d3f7b=_0x3d3f7b-0x1c6;let _0x4d79e1=_0x1e03ca[_0x3d3f7b];return _0x4d79e1;},a52_0x3d3f(_0x1d7670,_0x795ee7);}exports[a52_0x4ca31a(0x1eb)]=SettingsService;