'use strict';const a76_0x32cc55=a76_0x173a;function a76_0x173a(_0x5dbcfb,_0x233004){_0x5dbcfb=_0x5dbcfb-0x7f;const _0x898edd=a76_0x898e();let _0x173a40=_0x898edd[_0x5dbcfb];return _0x173a40;}(function(_0x4907e8,_0x256e69){const _0x24e509=a76_0x173a,_0x254e30=_0x4907e8();while(!![]){try{const _0x487a62=-parseInt(_0x24e509(0x92))/0x1+-parseInt(_0x24e509(0xa6))/0x2+parseInt(_0x24e509(0xba))/0x3+parseInt(_0x24e509(0xa0))/0x4+-parseInt(_0x24e509(0x81))/0x5*(-parseInt(_0x24e509(0x9a))/0x6)+-parseInt(_0x24e509(0x88))/0x7+parseInt(_0x24e509(0xa8))/0x8;if(_0x487a62===_0x256e69)break;else _0x254e30['push'](_0x254e30['shift']());}catch(_0x2376dd){_0x254e30['push'](_0x254e30['shift']());}}}(a76_0x898e,0x44d9f));var __importDefault=this&&this['__importDefault']||function(_0x3fb858){const _0x10da19=a76_0x173a;return _0x3fb858&&_0x3fb858[_0x10da19(0x8c)]?_0x3fb858:{'default':_0x3fb858};};function a76_0x898e(){const _0x4fdd47=['login','default','updateWebhookSettings','botApiKey','Shop\x20not\x20found','871638mueyaQ','parse','495144JzkpNS','hash','update','name','notificationPaymentFailed','payout','notificationLogin','notificationRefund','shop','max','notificationApiError','chatId','shopUrl','changePassword','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','repeat','Password\x20confirmation\x20is\x20incorrect','getShopSettings','1230549ibqrqQ','shopSettings','telegram','Current\x20password\x20is\x20incorrect','toString','create','payment_failed','15020GouSQd','telegramChatId','webhookEvents','bcryptjs','refund','hex','maskApiKey','579243WZwPAs','webhookUrl','notificationPaymentSuccess','parseWebhookEvents','__esModule','pk_','delete','telegramBotApiKey','payment_success','compare','541203BupNQJ','defineProperty','findUnique','length','SettingsService','updateNotifications','api_error','sk_','1056xWRmsO','password','string','ensureSettingsExist','notificationPayout','randomBytes','1364024epgvxb'];a76_0x898e=function(){return _0x4fdd47;};return a76_0x898e();}Object[a76_0x32cc55(0x93)](exports,a76_0x32cc55(0x8c),{'value':!![]}),exports[a76_0x32cc55(0x96)]=void 0x0;const bcryptjs_1=__importDefault(require(a76_0x32cc55(0x84))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));class SettingsService{[a76_0x32cc55(0x87)](_0x39af05){const _0x445da1=a76_0x32cc55;if(!_0x39af05)return'';if(_0x39af05[_0x445da1(0x95)]<=0x8)return _0x39af05;const _0x2d69a1=_0x39af05['substring'](0x0,0x8),_0x292ce1='*'[_0x445da1(0xb7)](Math[_0x445da1(0xb1)](0x0,_0x39af05[_0x445da1(0x95)]-0x8));return _0x2d69a1+_0x292ce1;}['parseWebhookEvents'](_0x2e9435){const _0x16b773=a76_0x32cc55;if(!_0x2e9435)return[];if(Array['isArray'](_0x2e9435))return _0x2e9435;if(typeof _0x2e9435===_0x16b773(0x9c))try{const _0x5d2852=JSON[_0x16b773(0xa7)](_0x2e9435);return Array['isArray'](_0x5d2852)?_0x5d2852:[];}catch{return[];}return[];}async[a76_0x32cc55(0xb9)](_0x2f325a){const _0x5aad9e=a76_0x32cc55,_0x13dc2b=await database_1[_0x5aad9e(0xa2)][_0x5aad9e(0xb0)][_0x5aad9e(0x94)]({'where':{'id':_0x2f325a},'include':{'settings':!![]}});if(!_0x13dc2b)throw new Error(_0x5aad9e(0xa5));let _0x2c0a58=_0x13dc2b['settings'];return!_0x2c0a58&&(_0x2c0a58=await database_1[_0x5aad9e(0xa2)][_0x5aad9e(0xbb)]['create']({'data':{'shopId':_0x13dc2b['id']}})),{'fullName':_0x13dc2b[_0x5aad9e(0xab)],'brand':_0x13dc2b[_0x5aad9e(0xab)],'merchantUrl':_0x13dc2b[_0x5aad9e(0xb4)],'telegramUsername':_0x13dc2b[_0x5aad9e(0xbc)],'telegramBotApiKey':_0x2c0a58['telegramBotApiKey']?this['maskApiKey'](_0x2c0a58[_0x5aad9e(0x8f)]):null,'telegramChatId':_0x2c0a58['telegramChatId'],'webhookUrl':_0x2c0a58[_0x5aad9e(0x89)],'webhookEvents':this[_0x5aad9e(0x8b)](_0x2c0a58[_0x5aad9e(0x83)]),'notifications':{'payment_success':_0x2c0a58['notificationPaymentSuccess'],'payment_failed':_0x2c0a58[_0x5aad9e(0xac)],'refund':_0x2c0a58[_0x5aad9e(0xaf)],'payout':_0x2c0a58[_0x5aad9e(0x9e)],'login':_0x2c0a58[_0x5aad9e(0xae)],'api_error':_0x2c0a58[_0x5aad9e(0xb2)]}};}async[a76_0x32cc55(0xb5)](_0x136ffb,_0x3c1b08){const _0x486946=a76_0x32cc55,{currentPassword:_0x23ffea,newPassword:_0x14462a,confirmNewPassword:_0x1d5edb}=_0x3c1b08;if(_0x14462a!==_0x1d5edb)throw new Error(_0x486946(0xb6));if(_0x14462a[_0x486946(0x95)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x4120de=await database_1[_0x486946(0xa2)]['shop'][_0x486946(0x94)]({'where':{'id':_0x136ffb},'select':{'password':!![]}});if(!_0x4120de)throw new Error(_0x486946(0xa5));const _0xadc3a5=await bcryptjs_1[_0x486946(0xa2)]['compare'](_0x23ffea,_0x4120de[_0x486946(0x9b)]);if(!_0xadc3a5)throw new Error(_0x486946(0xbd));const _0x4b4d1b=await bcryptjs_1['default'][_0x486946(0xa9)](_0x14462a,0xc);await database_1[_0x486946(0xa2)][_0x486946(0xb0)][_0x486946(0xaa)]({'where':{'id':_0x136ffb},'data':{'password':_0x4b4d1b}});}async[a76_0x32cc55(0x97)](_0x1d8e3c,_0x4da063){const _0x43a61d=a76_0x32cc55;await this[_0x43a61d(0x9d)](_0x1d8e3c);const _0x54fe55={};_0x4da063['payment_success']!==undefined&&(_0x54fe55[_0x43a61d(0x8a)]=_0x4da063[_0x43a61d(0x90)]),_0x4da063[_0x43a61d(0x80)]!==undefined&&(_0x54fe55[_0x43a61d(0xac)]=_0x4da063[_0x43a61d(0x80)]),_0x4da063['refund']!==undefined&&(_0x54fe55[_0x43a61d(0xaf)]=_0x4da063[_0x43a61d(0x85)]),_0x4da063['payout']!==undefined&&(_0x54fe55[_0x43a61d(0x9e)]=_0x4da063[_0x43a61d(0xad)]),_0x4da063[_0x43a61d(0xa1)]!==undefined&&(_0x54fe55['notificationLogin']=_0x4da063[_0x43a61d(0xa1)]),_0x4da063[_0x43a61d(0x98)]!==undefined&&(_0x54fe55[_0x43a61d(0xb2)]=_0x4da063[_0x43a61d(0x98)]),await database_1[_0x43a61d(0xa2)][_0x43a61d(0xbb)][_0x43a61d(0xaa)]({'where':{'shopId':_0x1d8e3c},'data':_0x54fe55});}async['updateTelegramSettings'](_0x2ce425,_0xcf3611){const _0x6ffdbd=a76_0x32cc55;await this[_0x6ffdbd(0x9d)](_0x2ce425);const _0x38ffbf={};_0xcf3611[_0x6ffdbd(0xa4)]!==undefined&&(_0x38ffbf['telegramBotApiKey']=_0xcf3611[_0x6ffdbd(0xa4)]||null),_0xcf3611['chatId']!==undefined&&(_0x38ffbf[_0x6ffdbd(0x82)]=_0xcf3611[_0x6ffdbd(0xb3)]||null),await database_1[_0x6ffdbd(0xa2)][_0x6ffdbd(0xbb)][_0x6ffdbd(0xaa)]({'where':{'shopId':_0x2ce425},'data':_0x38ffbf});}async[a76_0x32cc55(0xa3)](_0x36845c,_0x139254){const _0x58f922=a76_0x32cc55;await this['ensureSettingsExist'](_0x36845c);const _0x1cf8bb={};_0x139254['webhookUrl']!==undefined&&(_0x1cf8bb[_0x58f922(0x89)]=_0x139254['webhookUrl']||null),_0x139254['webhookEvents']!==undefined&&(_0x1cf8bb['webhookEvents']=_0x139254[_0x58f922(0x83)]||[]),await database_1[_0x58f922(0xa2)]['shopSettings'][_0x58f922(0xaa)]({'where':{'shopId':_0x36845c},'data':_0x1cf8bb});}async['revokeAllApiKeys'](_0x5b216d){const _0x11fa19=a76_0x32cc55,_0x34e445=_0x11fa19(0x8d)+crypto_1['default'][_0x11fa19(0x9f)](0x20)['toString'](_0x11fa19(0x86)),_0x5e93aa=_0x11fa19(0x99)+crypto_1[_0x11fa19(0xa2)]['randomBytes'](0x20)[_0x11fa19(0xbe)](_0x11fa19(0x86));await database_1['default']['shop'][_0x11fa19(0xaa)]({'where':{'id':_0x5b216d},'data':{'publicKey':_0x34e445,'secretKey':_0x5e93aa}});}async['deleteAccount'](_0x18df0f,_0x4bbc3e){const _0x214729=a76_0x32cc55,{passwordConfirmation:_0xbc4898}=_0x4bbc3e,_0xf57ccf=await database_1[_0x214729(0xa2)]['shop'][_0x214729(0x94)]({'where':{'id':_0x18df0f},'select':{'password':!![]}});if(!_0xf57ccf)throw new Error(_0x214729(0xa5));const _0x4dee7e=await bcryptjs_1[_0x214729(0xa2)][_0x214729(0x91)](_0xbc4898,_0xf57ccf[_0x214729(0x9b)]);if(!_0x4dee7e)throw new Error(_0x214729(0xb8));await database_1[_0x214729(0xa2)][_0x214729(0xb0)][_0x214729(0x8e)]({'where':{'id':_0x18df0f}});}async[a76_0x32cc55(0x9d)](_0x5ad498){const _0x4352f5=a76_0x32cc55,_0x58e791=await database_1[_0x4352f5(0xa2)]['shopSettings'][_0x4352f5(0x94)]({'where':{'shopId':_0x5ad498}});!_0x58e791&&await database_1[_0x4352f5(0xa2)][_0x4352f5(0xbb)][_0x4352f5(0x7f)]({'data':{'shopId':_0x5ad498}});}}exports['SettingsService']=SettingsService;