'use strict';const a60_0x4b9162=a60_0xfcff;(function(_0xd4f81c,_0x55fad4){const _0x3953fa=a60_0xfcff,_0x37c3a6=_0xd4f81c();while(!![]){try{const _0x28d0e9=-parseInt(_0x3953fa(0xce))/0x1+parseInt(_0x3953fa(0xc0))/0x2+parseInt(_0x3953fa(0xd7))/0x3*(-parseInt(_0x3953fa(0xdf))/0x4)+-parseInt(_0x3953fa(0xef))/0x5*(parseInt(_0x3953fa(0xb0))/0x6)+parseInt(_0x3953fa(0xd0))/0x7*(-parseInt(_0x3953fa(0xba))/0x8)+parseInt(_0x3953fa(0xcc))/0x9+-parseInt(_0x3953fa(0xc8))/0xa*(-parseInt(_0x3953fa(0xf0))/0xb);if(_0x28d0e9===_0x55fad4)break;else _0x37c3a6['push'](_0x37c3a6['shift']());}catch(_0x5cd18d){_0x37c3a6['push'](_0x37c3a6['shift']());}}}(a60_0x11c8,0x9474a));function a60_0xfcff(_0x3c5673,_0x2edc77){const _0x11c8e1=a60_0x11c8();return a60_0xfcff=function(_0xfcff19,_0x1cd469){_0xfcff19=_0xfcff19-0xb0;let _0x3973d4=_0x11c8e1[_0xfcff19];return _0x3973d4;},a60_0xfcff(_0x3c5673,_0x2edc77);}var __importDefault=this&&this[a60_0x4b9162(0xde)]||function(_0x568870){const _0x2d959c=a60_0x4b9162;return _0x568870&&_0x568870[_0x2d959c(0xdb)]?_0x568870:{'default':_0x568870};};Object[a60_0x4b9162(0xe1)](exports,a60_0x4b9162(0xdb),{'value':!![]}),exports[a60_0x4b9162(0xe7)]=void 0x0;const bcryptjs_1=__importDefault(require(a60_0x4b9162(0xb5))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a60_0x4b9162(0xbd)));class SettingsService{[a60_0x4b9162(0xbc)](_0x1df1fd){const _0x515f9b=a60_0x4b9162;if(!_0x1df1fd)return'';if(_0x1df1fd['length']<=0x8)return _0x1df1fd;const _0x1d1ccb=_0x1df1fd['substring'](0x0,0x8),_0x42335a='*'[_0x515f9b(0xe8)](Math[_0x515f9b(0xb8)](0x0,_0x1df1fd[_0x515f9b(0xcd)]-0x8));return _0x1d1ccb+_0x42335a;}[a60_0x4b9162(0xd6)](_0x495bfc){const _0x2481bc=a60_0x4b9162;if(!_0x495bfc)return[];if(Array[_0x2481bc(0xe0)](_0x495bfc))return _0x495bfc;if(typeof _0x495bfc===_0x2481bc(0xd4))try{const _0x1e673e=JSON[_0x2481bc(0xe4)](_0x495bfc);return Array[_0x2481bc(0xe0)](_0x1e673e)?_0x1e673e:[];}catch{return[];}return[];}async[a60_0x4b9162(0xbb)](_0x4ca10a){const _0x132da9=a60_0x4b9162,_0x2de66e=await database_1['default']['shop'][_0x132da9(0xb4)]({'where':{'id':_0x4ca10a},'include':{'settings':!![]}});if(!_0x2de66e)throw new Error('Shop\x20not\x20found');let _0x5a3865=_0x2de66e[_0x132da9(0xc3)];return!_0x5a3865&&(_0x5a3865=await database_1['default'][_0x132da9(0xc5)]['create']({'data':{'shopId':_0x2de66e['id']}})),{'fullName':_0x2de66e['name'],'brand':_0x2de66e[_0x132da9(0xd3)],'merchantUrl':_0x2de66e[_0x132da9(0xea)],'telegramUsername':_0x2de66e[_0x132da9(0xbf)],'telegramBotApiKey':_0x5a3865[_0x132da9(0xdc)]?this[_0x132da9(0xbc)](_0x5a3865[_0x132da9(0xdc)]):null,'telegramChatId':_0x5a3865[_0x132da9(0xb7)],'webhookUrl':_0x5a3865['webhookUrl'],'webhookEvents':this[_0x132da9(0xd6)](_0x5a3865[_0x132da9(0xd9)]),'notifications':{'payment_success':_0x5a3865[_0x132da9(0xeb)],'payment_failed':_0x5a3865['notificationPaymentFailed'],'refund':_0x5a3865[_0x132da9(0xc9)],'payout':_0x5a3865['notificationPayout'],'login':_0x5a3865['notificationLogin'],'api_error':_0x5a3865['notificationApiError']}};}async[a60_0x4b9162(0xcf)](_0xb10c63,_0x5bc058){const _0x1232de=a60_0x4b9162,{currentPassword:_0x2cc628,newPassword:_0x5ee736,confirmNewPassword:_0x3bfd47}=_0x5bc058;if(_0x5ee736!==_0x3bfd47)throw new Error(_0x1232de(0xe2));if(_0x5ee736['length']<0x6)throw new Error(_0x1232de(0xd1));const _0x51dfa3=await database_1[_0x1232de(0xc1)][_0x1232de(0xdd)][_0x1232de(0xb4)]({'where':{'id':_0xb10c63},'select':{'password':!![]}});if(!_0x51dfa3)throw new Error(_0x1232de(0xc4));const _0x364566=await bcryptjs_1[_0x1232de(0xc1)][_0x1232de(0xd2)](_0x2cc628,_0x51dfa3[_0x1232de(0xc7)]);if(!_0x364566)throw new Error('Current\x20password\x20is\x20incorrect');const _0x3b5f7c=await bcryptjs_1[_0x1232de(0xc1)]['hash'](_0x5ee736,0xc);await database_1[_0x1232de(0xc1)]['shop'][_0x1232de(0xbe)]({'where':{'id':_0xb10c63},'data':{'password':_0x3b5f7c}});}async[a60_0x4b9162(0xe6)](_0x4c4ae8,_0x3bfaf2){const _0x3aa6f3=a60_0x4b9162;await this[_0x3aa6f3(0xb3)](_0x4c4ae8);const _0x31fa96={};_0x3bfaf2[_0x3aa6f3(0xd5)]!==undefined&&(_0x31fa96['notificationPaymentSuccess']=_0x3bfaf2[_0x3aa6f3(0xd5)]),_0x3bfaf2[_0x3aa6f3(0xed)]!==undefined&&(_0x31fa96['notificationPaymentFailed']=_0x3bfaf2[_0x3aa6f3(0xed)]),_0x3bfaf2['refund']!==undefined&&(_0x31fa96['notificationRefund']=_0x3bfaf2[_0x3aa6f3(0xee)]),_0x3bfaf2[_0x3aa6f3(0xe9)]!==undefined&&(_0x31fa96[_0x3aa6f3(0xe3)]=_0x3bfaf2[_0x3aa6f3(0xe9)]),_0x3bfaf2[_0x3aa6f3(0xe5)]!==undefined&&(_0x31fa96[_0x3aa6f3(0xec)]=_0x3bfaf2[_0x3aa6f3(0xe5)]),_0x3bfaf2[_0x3aa6f3(0xf1)]!==undefined&&(_0x31fa96['notificationApiError']=_0x3bfaf2[_0x3aa6f3(0xf1)]),await database_1[_0x3aa6f3(0xc1)][_0x3aa6f3(0xc5)]['update']({'where':{'shopId':_0x4c4ae8},'data':_0x31fa96});}async['updateTelegramSettings'](_0x63f463,_0x17a451){const _0x7972d3=a60_0x4b9162;await this[_0x7972d3(0xb3)](_0x63f463);const _0x575d2e={};_0x17a451['botApiKey']!==undefined&&(_0x575d2e['telegramBotApiKey']=_0x17a451[_0x7972d3(0xb2)]||null),_0x17a451['chatId']!==undefined&&(_0x575d2e[_0x7972d3(0xb7)]=_0x17a451['chatId']||null),await database_1[_0x7972d3(0xc1)]['shopSettings'][_0x7972d3(0xbe)]({'where':{'shopId':_0x63f463},'data':_0x575d2e});}async[a60_0x4b9162(0xd8)](_0x482845,_0x3b41b6){const _0x4cdbee=a60_0x4b9162;await this[_0x4cdbee(0xb3)](_0x482845);const _0x2501ef={};_0x3b41b6[_0x4cdbee(0xc6)]!==undefined&&(_0x2501ef[_0x4cdbee(0xc6)]=_0x3b41b6['webhookUrl']||null),_0x3b41b6['webhookEvents']!==undefined&&(_0x2501ef[_0x4cdbee(0xd9)]=_0x3b41b6[_0x4cdbee(0xd9)]||[]),await database_1[_0x4cdbee(0xc1)][_0x4cdbee(0xc5)]['update']({'where':{'shopId':_0x482845},'data':_0x2501ef});}async['revokeAllApiKeys'](_0x4480f6){const _0x1230a1=a60_0x4b9162,_0x46edb3='pk_'+crypto_1[_0x1230a1(0xc1)][_0x1230a1(0xcb)](0x20)[_0x1230a1(0xda)](_0x1230a1(0xc2)),_0x522e0a=_0x1230a1(0xb6)+crypto_1['default'][_0x1230a1(0xcb)](0x20)[_0x1230a1(0xda)](_0x1230a1(0xc2));await database_1[_0x1230a1(0xc1)][_0x1230a1(0xdd)][_0x1230a1(0xbe)]({'where':{'id':_0x4480f6},'data':{'publicKey':_0x46edb3,'secretKey':_0x522e0a}});}async['deleteAccount'](_0x49bf77,_0x306d06){const _0x5952a7=a60_0x4b9162,{passwordConfirmation:_0x213d62}=_0x306d06,_0x15e048=await database_1[_0x5952a7(0xc1)][_0x5952a7(0xdd)]['findUnique']({'where':{'id':_0x49bf77},'select':{'password':!![]}});if(!_0x15e048)throw new Error(_0x5952a7(0xc4));const _0x55947c=await bcryptjs_1['default'][_0x5952a7(0xd2)](_0x213d62,_0x15e048[_0x5952a7(0xc7)]);if(!_0x55947c)throw new Error(_0x5952a7(0xca));await database_1[_0x5952a7(0xc1)][_0x5952a7(0xdd)][_0x5952a7(0xb9)]({'where':{'id':_0x49bf77}});}async[a60_0x4b9162(0xb3)](_0x2000fe){const _0x40b018=a60_0x4b9162,_0x2f0602=await database_1['default'][_0x40b018(0xc5)]['findUnique']({'where':{'shopId':_0x2000fe}});!_0x2f0602&&await database_1[_0x40b018(0xc1)][_0x40b018(0xc5)][_0x40b018(0xb1)]({'data':{'shopId':_0x2000fe}});}}function a60_0x11c8(){const _0x123cf5=['payment_success','parseWebhookEvents','3UaqBUl','updateWebhookSettings','webhookEvents','toString','__esModule','telegramBotApiKey','shop','__importDefault','393524bSZSNo','isArray','defineProperty','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','notificationPayout','parse','login','updateNotifications','SettingsService','repeat','payout','shopUrl','notificationPaymentSuccess','notificationLogin','payment_failed','refund','5ywkQBL','143wspJyH','api_error','7200366TkioJs','create','botApiKey','ensureSettingsExist','findUnique','bcryptjs','sk_','telegramChatId','max','delete','8XxjUQK','getShopSettings','maskApiKey','../config/database','update','telegram','1152650Sdidxi','default','hex','settings','Shop\x20not\x20found','shopSettings','webhookUrl','password','956570YrMYID','notificationRefund','Password\x20confirmation\x20is\x20incorrect','randomBytes','7561071Ymforf','length','240942HjOEPT','changePassword','3587689fnaXXN','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','compare','name','string'];a60_0x11c8=function(){return _0x123cf5;};return a60_0x11c8();}exports['SettingsService']=SettingsService;