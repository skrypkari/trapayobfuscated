'use strict';const a64_0x5a913c=a64_0x4b21;function a64_0x286c(){const _0x27b7cd=['Password\x20confirmation\x20is\x20incorrect','deleteAccount','shopUrl','192opfZpl','webhookEvents','37210OtkuYD','42zwdeWe','SettingsService','telegramChatId','shop','changePassword','14601LOsRTN','notificationRefund','payment_success','16JpZiQe','create','isArray','notificationApiError','login','529011uDhOcD','compare','updateWebhookSettings','botApiKey','webhookUrl','notificationLogin','updateTelegramSettings','substring','maskApiKey','142905SnXgoz','payout','revokeAllApiKeys','name','sk_','notificationPayout','randomBytes','pk_','findUnique','password','ensureSettingsExist','500GtdldI','refund','delete','notificationPaymentFailed','length','62655EmFmwj','notificationPaymentSuccess','4340964otxcuY','../config/database','chatId','__importDefault','settings','hex','parseWebhookEvents','toString','crypto','Current\x20password\x20is\x20incorrect','118IttNjd','hash','payment_failed','default','telegramBotApiKey','max','21703uJghqG','update','repeat','shopSettings','Shop\x20not\x20found','getShopSettings','defineProperty','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','string','bcryptjs'];a64_0x286c=function(){return _0x27b7cd;};return a64_0x286c();}function a64_0x4b21(_0x4bb95c,_0x5df4d8){const _0x286c8e=a64_0x286c();return a64_0x4b21=function(_0x4b2179,_0x1caa43){_0x4b2179=_0x4b2179-0x85;let _0x58f996=_0x286c8e[_0x4b2179];return _0x58f996;},a64_0x4b21(_0x4bb95c,_0x5df4d8);}(function(_0x19d009,_0x2da217){const _0x8dc2a8=a64_0x4b21,_0x5f2df8=_0x19d009();while(!![]){try{const _0x423bf8=parseInt(_0x8dc2a8(0xab))/0x1+-parseInt(_0x8dc2a8(0xb7))/0x2*(-parseInt(_0x8dc2a8(0x8a))/0x3)+-parseInt(_0x8dc2a8(0xca))/0x4*(parseInt(_0x8dc2a8(0xcc))/0x5)+parseInt(_0x8dc2a8(0x85))/0x6*(-parseInt(_0x8dc2a8(0x9b))/0x7)+-parseInt(_0x8dc2a8(0x8d))/0x8*(parseInt(_0x8dc2a8(0x92))/0x9)+-parseInt(_0x8dc2a8(0xa6))/0xa*(-parseInt(_0x8dc2a8(0xbd))/0xb)+parseInt(_0x8dc2a8(0xad))/0xc;if(_0x423bf8===_0x2da217)break;else _0x5f2df8['push'](_0x5f2df8['shift']());}catch(_0x581023){_0x5f2df8['push'](_0x5f2df8['shift']());}}}(a64_0x286c,0x2f00e));var __importDefault=this&&this[a64_0x5a913c(0xb0)]||function(_0x9c95c0){return _0x9c95c0&&_0x9c95c0['__esModule']?_0x9c95c0:{'default':_0x9c95c0};};Object[a64_0x5a913c(0xc3)](exports,'__esModule',{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a64_0x5a913c(0xc6))),crypto_1=__importDefault(require(a64_0x5a913c(0xb5))),database_1=__importDefault(require(a64_0x5a913c(0xae)));class SettingsService{[a64_0x5a913c(0x9a)](_0x265e3e){const _0x100b30=a64_0x5a913c;if(!_0x265e3e)return'';if(_0x265e3e['length']<=0x8)return _0x265e3e;const _0x2240fe=_0x265e3e[_0x100b30(0x99)](0x0,0x8),_0x4cafb9='*'[_0x100b30(0xbf)](Math[_0x100b30(0xbc)](0x0,_0x265e3e[_0x100b30(0xaa)]-0x8));return _0x2240fe+_0x4cafb9;}[a64_0x5a913c(0xb3)](_0x2e5b99){const _0x5e8dd8=a64_0x5a913c;if(!_0x2e5b99)return[];if(Array[_0x5e8dd8(0x8f)](_0x2e5b99))return _0x2e5b99;if(typeof _0x2e5b99===_0x5e8dd8(0xc5))try{const _0x2dc7ec=JSON['parse'](_0x2e5b99);return Array[_0x5e8dd8(0x8f)](_0x2dc7ec)?_0x2dc7ec:[];}catch{return[];}return[];}async[a64_0x5a913c(0xc2)](_0x2d9334){const _0x5040bc=a64_0x5a913c,_0x1195ce=await database_1[_0x5040bc(0xba)][_0x5040bc(0x88)]['findUnique']({'where':{'id':_0x2d9334},'include':{'settings':!![]}});if(!_0x1195ce)throw new Error(_0x5040bc(0xc1));let _0x1406f3=_0x1195ce[_0x5040bc(0xb1)];return!_0x1406f3&&(_0x1406f3=await database_1['default'][_0x5040bc(0xc0)][_0x5040bc(0x8e)]({'data':{'shopId':_0x1195ce['id']}})),{'fullName':_0x1195ce[_0x5040bc(0x9e)],'brand':_0x1195ce[_0x5040bc(0x9e)],'merchantUrl':_0x1195ce[_0x5040bc(0xc9)],'telegramUsername':_0x1195ce['telegram'],'telegramBotApiKey':_0x1406f3[_0x5040bc(0xbb)]?this[_0x5040bc(0x9a)](_0x1406f3[_0x5040bc(0xbb)]):null,'telegramChatId':_0x1406f3['telegramChatId'],'webhookUrl':_0x1406f3[_0x5040bc(0x96)],'webhookEvents':this[_0x5040bc(0xb3)](_0x1406f3[_0x5040bc(0xcb)]),'notifications':{'payment_success':_0x1406f3[_0x5040bc(0xac)],'payment_failed':_0x1406f3[_0x5040bc(0xa9)],'refund':_0x1406f3[_0x5040bc(0x8b)],'payout':_0x1406f3[_0x5040bc(0xa0)],'login':_0x1406f3[_0x5040bc(0x97)],'api_error':_0x1406f3[_0x5040bc(0x90)]}};}async[a64_0x5a913c(0x89)](_0x5bdfb1,_0x4fb942){const _0x42e012=a64_0x5a913c,{currentPassword:_0x3c4a20,newPassword:_0x2662f3,confirmNewPassword:_0xc2394c}=_0x4fb942;if(_0x2662f3!==_0xc2394c)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x2662f3[_0x42e012(0xaa)]<0x6)throw new Error(_0x42e012(0xc4));const _0x50ac85=await database_1[_0x42e012(0xba)]['shop']['findUnique']({'where':{'id':_0x5bdfb1},'select':{'password':!![]}});if(!_0x50ac85)throw new Error(_0x42e012(0xc1));const _0x43d79d=await bcryptjs_1[_0x42e012(0xba)]['compare'](_0x3c4a20,_0x50ac85[_0x42e012(0xa4)]);if(!_0x43d79d)throw new Error(_0x42e012(0xb6));const _0x4dd902=await bcryptjs_1[_0x42e012(0xba)][_0x42e012(0xb8)](_0x2662f3,0xc);await database_1[_0x42e012(0xba)][_0x42e012(0x88)][_0x42e012(0xbe)]({'where':{'id':_0x5bdfb1},'data':{'password':_0x4dd902}});}async['updateNotifications'](_0xc5097,_0x1c14bc){const _0x54e342=a64_0x5a913c;await this[_0x54e342(0xa5)](_0xc5097);const _0x40d875={};_0x1c14bc[_0x54e342(0x8c)]!==undefined&&(_0x40d875['notificationPaymentSuccess']=_0x1c14bc[_0x54e342(0x8c)]),_0x1c14bc[_0x54e342(0xb9)]!==undefined&&(_0x40d875[_0x54e342(0xa9)]=_0x1c14bc['payment_failed']),_0x1c14bc[_0x54e342(0xa7)]!==undefined&&(_0x40d875['notificationRefund']=_0x1c14bc[_0x54e342(0xa7)]),_0x1c14bc[_0x54e342(0x9c)]!==undefined&&(_0x40d875['notificationPayout']=_0x1c14bc[_0x54e342(0x9c)]),_0x1c14bc[_0x54e342(0x91)]!==undefined&&(_0x40d875[_0x54e342(0x97)]=_0x1c14bc[_0x54e342(0x91)]),_0x1c14bc['api_error']!==undefined&&(_0x40d875['notificationApiError']=_0x1c14bc['api_error']),await database_1['default'][_0x54e342(0xc0)][_0x54e342(0xbe)]({'where':{'shopId':_0xc5097},'data':_0x40d875});}async[a64_0x5a913c(0x98)](_0x10e52e,_0x3b8f32){const _0x5749c8=a64_0x5a913c;await this[_0x5749c8(0xa5)](_0x10e52e);const _0xd7033a={};_0x3b8f32['botApiKey']!==undefined&&(_0xd7033a[_0x5749c8(0xbb)]=_0x3b8f32[_0x5749c8(0x95)]||null),_0x3b8f32[_0x5749c8(0xaf)]!==undefined&&(_0xd7033a[_0x5749c8(0x87)]=_0x3b8f32[_0x5749c8(0xaf)]||null),await database_1[_0x5749c8(0xba)][_0x5749c8(0xc0)][_0x5749c8(0xbe)]({'where':{'shopId':_0x10e52e},'data':_0xd7033a});}async[a64_0x5a913c(0x94)](_0x39d13f,_0x4a4f5c){const _0x2ecb53=a64_0x5a913c;await this[_0x2ecb53(0xa5)](_0x39d13f);const _0x183d6b={};_0x4a4f5c[_0x2ecb53(0x96)]!==undefined&&(_0x183d6b[_0x2ecb53(0x96)]=_0x4a4f5c[_0x2ecb53(0x96)]||null),_0x4a4f5c[_0x2ecb53(0xcb)]!==undefined&&(_0x183d6b[_0x2ecb53(0xcb)]=_0x4a4f5c[_0x2ecb53(0xcb)]||[]),await database_1[_0x2ecb53(0xba)]['shopSettings'][_0x2ecb53(0xbe)]({'where':{'shopId':_0x39d13f},'data':_0x183d6b});}async[a64_0x5a913c(0x9d)](_0x35d101){const _0x4a5ad2=a64_0x5a913c,_0x3e8a32=_0x4a5ad2(0xa2)+crypto_1[_0x4a5ad2(0xba)]['randomBytes'](0x20)[_0x4a5ad2(0xb4)](_0x4a5ad2(0xb2)),_0x182438=_0x4a5ad2(0x9f)+crypto_1['default'][_0x4a5ad2(0xa1)](0x20)[_0x4a5ad2(0xb4)](_0x4a5ad2(0xb2));await database_1['default'][_0x4a5ad2(0x88)][_0x4a5ad2(0xbe)]({'where':{'id':_0x35d101},'data':{'publicKey':_0x3e8a32,'secretKey':_0x182438}});}async[a64_0x5a913c(0xc8)](_0x28733e,_0x359c05){const _0x4c901b=a64_0x5a913c,{passwordConfirmation:_0x389830}=_0x359c05,_0x2d2055=await database_1[_0x4c901b(0xba)][_0x4c901b(0x88)]['findUnique']({'where':{'id':_0x28733e},'select':{'password':!![]}});if(!_0x2d2055)throw new Error('Shop\x20not\x20found');const _0x61c084=await bcryptjs_1[_0x4c901b(0xba)][_0x4c901b(0x93)](_0x389830,_0x2d2055[_0x4c901b(0xa4)]);if(!_0x61c084)throw new Error(_0x4c901b(0xc7));await database_1['default'][_0x4c901b(0x88)][_0x4c901b(0xa8)]({'where':{'id':_0x28733e}});}async[a64_0x5a913c(0xa5)](_0x244993){const _0x3e76ea=a64_0x5a913c,_0x558d8b=await database_1[_0x3e76ea(0xba)][_0x3e76ea(0xc0)][_0x3e76ea(0xa3)]({'where':{'shopId':_0x244993}});!_0x558d8b&&await database_1[_0x3e76ea(0xba)][_0x3e76ea(0xc0)][_0x3e76ea(0x8e)]({'data':{'shopId':_0x244993}});}}exports[a64_0x5a913c(0x86)]=SettingsService;