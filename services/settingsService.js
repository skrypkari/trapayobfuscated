'use strict';const a57_0x41ffd2=a57_0x203f;(function(_0x507f69,_0x4a7fae){const _0x3c5793=a57_0x203f,_0x20a256=_0x507f69();while(!![]){try{const _0x4c87b7=-parseInt(_0x3c5793(0x18f))/0x1*(-parseInt(_0x3c5793(0x187))/0x2)+-parseInt(_0x3c5793(0x173))/0x3*(parseInt(_0x3c5793(0x189))/0x4)+parseInt(_0x3c5793(0x153))/0x5+-parseInt(_0x3c5793(0x159))/0x6*(-parseInt(_0x3c5793(0x184))/0x7)+-parseInt(_0x3c5793(0x17a))/0x8*(-parseInt(_0x3c5793(0x193))/0x9)+parseInt(_0x3c5793(0x192))/0xa*(parseInt(_0x3c5793(0x15b))/0xb)+-parseInt(_0x3c5793(0x16a))/0xc;if(_0x4c87b7===_0x4a7fae)break;else _0x20a256['push'](_0x20a256['shift']());}catch(_0x193586){_0x20a256['push'](_0x20a256['shift']());}}}(a57_0x2df9,0x81f50));function a57_0x203f(_0x4b71e2,_0x319f45){const _0x2df977=a57_0x2df9();return a57_0x203f=function(_0x203f73,_0x177888){_0x203f73=_0x203f73-0x14d;let _0x5e4448=_0x2df977[_0x203f73];return _0x5e4448;},a57_0x203f(_0x4b71e2,_0x319f45);}var __importDefault=this&&this[a57_0x41ffd2(0x158)]||function(_0x3715b2){const _0x49abc5=a57_0x41ffd2;return _0x3715b2&&_0x3715b2[_0x49abc5(0x152)]?_0x3715b2:{'default':_0x3715b2};};Object[a57_0x41ffd2(0x191)](exports,'__esModule',{'value':!![]}),exports[a57_0x41ffd2(0x190)]=void 0x0;function a57_0x2df9(){const _0x4635c9=['Current\x20password\x20is\x20incorrect','create','notificationLogin','payment_success','webhookUrl','ensureSettingsExist','606jpHRcf','updateNotifications','notificationPaymentFailed','Shop\x20not\x20found','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','updateWebhookSettings','randomBytes','56AfEJuo','sk_','payout','deleteAccount','update','revokeAllApiKeys','../config/database','telegramChatId','password','notificationApiError','910623qpSowE','findUnique','refund','598vFKQmN','notificationRefund','1868rGsrEh','max','delete','webhookEvents','notificationPayout','settings','2713MgaHjE','SettingsService','defineProperty','870DWfJOP','130662CIwmOo','notificationPaymentSuccess','name','api_error','parse','pk_','shopUrl','parseWebhookEvents','toString','__esModule','4657865hrXnMM','crypto','payment_failed','substring','default','__importDefault','42izbLiy','length','39743yVarEX','getShopSettings','hex','chatId','updateTelegramSettings','shopSettings','changePassword','telegramBotApiKey','bcryptjs','shop','login','maskApiKey','telegram','botApiKey','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','29312424jxuUxk','string','hash'];a57_0x2df9=function(){return _0x4635c9;};return a57_0x2df9();}const bcryptjs_1=__importDefault(require(a57_0x41ffd2(0x163))),crypto_1=__importDefault(require(a57_0x41ffd2(0x154))),database_1=__importDefault(require(a57_0x41ffd2(0x180)));class SettingsService{[a57_0x41ffd2(0x166)](_0x1bbbbb){const _0x177b73=a57_0x41ffd2;if(!_0x1bbbbb)return'';if(_0x1bbbbb[_0x177b73(0x15a)]<=0x8)return _0x1bbbbb;const _0x48fe21=_0x1bbbbb[_0x177b73(0x156)](0x0,0x8),_0x45dbf0='*'['repeat'](Math[_0x177b73(0x18a)](0x0,_0x1bbbbb[_0x177b73(0x15a)]-0x8));return _0x48fe21+_0x45dbf0;}[a57_0x41ffd2(0x150)](_0x12576b){const _0x24ae5f=a57_0x41ffd2;if(!_0x12576b)return[];if(Array['isArray'](_0x12576b))return _0x12576b;if(typeof _0x12576b===_0x24ae5f(0x16b))try{const _0x421b5c=JSON[_0x24ae5f(0x14d)](_0x12576b);return Array['isArray'](_0x421b5c)?_0x421b5c:[];}catch{return[];}return[];}async[a57_0x41ffd2(0x15c)](_0x5ce90f){const _0x5189d5=a57_0x41ffd2,_0x2308cd=await database_1[_0x5189d5(0x157)][_0x5189d5(0x164)]['findUnique']({'where':{'id':_0x5ce90f},'include':{'settings':!![]}});if(!_0x2308cd)throw new Error(_0x5189d5(0x176));let _0x5941cb=_0x2308cd[_0x5189d5(0x18e)];return!_0x5941cb&&(_0x5941cb=await database_1[_0x5189d5(0x157)][_0x5189d5(0x160)][_0x5189d5(0x16e)]({'data':{'shopId':_0x2308cd['id']}})),{'fullName':_0x2308cd[_0x5189d5(0x195)],'brand':_0x2308cd[_0x5189d5(0x195)],'merchantUrl':_0x2308cd[_0x5189d5(0x14f)],'telegramUsername':_0x2308cd[_0x5189d5(0x167)],'telegramBotApiKey':_0x5941cb[_0x5189d5(0x162)]?this[_0x5189d5(0x166)](_0x5941cb[_0x5189d5(0x162)]):null,'telegramChatId':_0x5941cb[_0x5189d5(0x181)],'webhookUrl':_0x5941cb[_0x5189d5(0x171)],'webhookEvents':this['parseWebhookEvents'](_0x5941cb['webhookEvents']),'notifications':{'payment_success':_0x5941cb[_0x5189d5(0x194)],'payment_failed':_0x5941cb[_0x5189d5(0x175)],'refund':_0x5941cb[_0x5189d5(0x188)],'payout':_0x5941cb[_0x5189d5(0x18d)],'login':_0x5941cb[_0x5189d5(0x16f)],'api_error':_0x5941cb[_0x5189d5(0x183)]}};}async[a57_0x41ffd2(0x161)](_0x777460,_0x3e6d4a){const _0x3dc6e2=a57_0x41ffd2,{currentPassword:_0x466032,newPassword:_0x66b5b1,confirmNewPassword:_0x1048ef}=_0x3e6d4a;if(_0x66b5b1!==_0x1048ef)throw new Error(_0x3dc6e2(0x169));if(_0x66b5b1[_0x3dc6e2(0x15a)]<0x6)throw new Error(_0x3dc6e2(0x177));const _0x176e9a=await database_1['default'][_0x3dc6e2(0x164)][_0x3dc6e2(0x185)]({'where':{'id':_0x777460},'select':{'password':!![]}});if(!_0x176e9a)throw new Error('Shop\x20not\x20found');const _0x1049bd=await bcryptjs_1['default']['compare'](_0x466032,_0x176e9a[_0x3dc6e2(0x182)]);if(!_0x1049bd)throw new Error(_0x3dc6e2(0x16d));const _0x533234=await bcryptjs_1[_0x3dc6e2(0x157)][_0x3dc6e2(0x16c)](_0x66b5b1,0xc);await database_1[_0x3dc6e2(0x157)][_0x3dc6e2(0x164)]['update']({'where':{'id':_0x777460},'data':{'password':_0x533234}});}async[a57_0x41ffd2(0x174)](_0x4db2c6,_0x2fcdd4){const _0xa17731=a57_0x41ffd2;await this[_0xa17731(0x172)](_0x4db2c6);const _0x50a61d={};_0x2fcdd4[_0xa17731(0x170)]!==undefined&&(_0x50a61d[_0xa17731(0x194)]=_0x2fcdd4[_0xa17731(0x170)]),_0x2fcdd4['payment_failed']!==undefined&&(_0x50a61d[_0xa17731(0x175)]=_0x2fcdd4[_0xa17731(0x155)]),_0x2fcdd4[_0xa17731(0x186)]!==undefined&&(_0x50a61d[_0xa17731(0x188)]=_0x2fcdd4[_0xa17731(0x186)]),_0x2fcdd4[_0xa17731(0x17c)]!==undefined&&(_0x50a61d[_0xa17731(0x18d)]=_0x2fcdd4[_0xa17731(0x17c)]),_0x2fcdd4['login']!==undefined&&(_0x50a61d[_0xa17731(0x16f)]=_0x2fcdd4[_0xa17731(0x165)]),_0x2fcdd4[_0xa17731(0x196)]!==undefined&&(_0x50a61d[_0xa17731(0x183)]=_0x2fcdd4['api_error']),await database_1['default'][_0xa17731(0x160)][_0xa17731(0x17e)]({'where':{'shopId':_0x4db2c6},'data':_0x50a61d});}async[a57_0x41ffd2(0x15f)](_0x26ef73,_0xf3c1c5){const _0x35863d=a57_0x41ffd2;await this[_0x35863d(0x172)](_0x26ef73);const _0x2d9a47={};_0xf3c1c5[_0x35863d(0x168)]!==undefined&&(_0x2d9a47['telegramBotApiKey']=_0xf3c1c5[_0x35863d(0x168)]||null),_0xf3c1c5[_0x35863d(0x15e)]!==undefined&&(_0x2d9a47[_0x35863d(0x181)]=_0xf3c1c5['chatId']||null),await database_1['default'][_0x35863d(0x160)]['update']({'where':{'shopId':_0x26ef73},'data':_0x2d9a47});}async[a57_0x41ffd2(0x178)](_0x6e97a6,_0x432290){const _0x3bc68e=a57_0x41ffd2;await this[_0x3bc68e(0x172)](_0x6e97a6);const _0x4c5448={};_0x432290[_0x3bc68e(0x171)]!==undefined&&(_0x4c5448['webhookUrl']=_0x432290[_0x3bc68e(0x171)]||null),_0x432290[_0x3bc68e(0x18c)]!==undefined&&(_0x4c5448[_0x3bc68e(0x18c)]=_0x432290[_0x3bc68e(0x18c)]||[]),await database_1[_0x3bc68e(0x157)][_0x3bc68e(0x160)]['update']({'where':{'shopId':_0x6e97a6},'data':_0x4c5448});}async[a57_0x41ffd2(0x17f)](_0x6a6c3f){const _0x54c479=a57_0x41ffd2,_0x3dcef8=_0x54c479(0x14e)+crypto_1[_0x54c479(0x157)][_0x54c479(0x179)](0x20)[_0x54c479(0x151)](_0x54c479(0x15d)),_0x7c2541=_0x54c479(0x17b)+crypto_1[_0x54c479(0x157)][_0x54c479(0x179)](0x20)['toString']('hex');await database_1[_0x54c479(0x157)][_0x54c479(0x164)][_0x54c479(0x17e)]({'where':{'id':_0x6a6c3f},'data':{'publicKey':_0x3dcef8,'secretKey':_0x7c2541}});}async[a57_0x41ffd2(0x17d)](_0x4f9a0e,_0x87759){const _0x5ef9e2=a57_0x41ffd2,{passwordConfirmation:_0x2b948a}=_0x87759,_0x4b53e5=await database_1['default'][_0x5ef9e2(0x164)]['findUnique']({'where':{'id':_0x4f9a0e},'select':{'password':!![]}});if(!_0x4b53e5)throw new Error('Shop\x20not\x20found');const _0x3dec39=await bcryptjs_1[_0x5ef9e2(0x157)]['compare'](_0x2b948a,_0x4b53e5[_0x5ef9e2(0x182)]);if(!_0x3dec39)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x5ef9e2(0x157)]['shop'][_0x5ef9e2(0x18b)]({'where':{'id':_0x4f9a0e}});}async[a57_0x41ffd2(0x172)](_0x52e903){const _0x56ec31=a57_0x41ffd2,_0x319f2b=await database_1[_0x56ec31(0x157)][_0x56ec31(0x160)][_0x56ec31(0x185)]({'where':{'shopId':_0x52e903}});!_0x319f2b&&await database_1['default'][_0x56ec31(0x160)][_0x56ec31(0x16e)]({'data':{'shopId':_0x52e903}});}}exports[a57_0x41ffd2(0x190)]=SettingsService;