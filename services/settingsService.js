'use strict';const a52_0x450b7f=a52_0x25c8;function a52_0x25c8(_0x43e16f,_0x334f4c){const _0x349819=a52_0x3498();return a52_0x25c8=function(_0x25c8f5,_0x225738){_0x25c8f5=_0x25c8f5-0x113;let _0x23c762=_0x349819[_0x25c8f5];return _0x23c762;},a52_0x25c8(_0x43e16f,_0x334f4c);}(function(_0x5a8dba,_0x58496f){const _0xdd5779=a52_0x25c8,_0x58a10d=_0x5a8dba();while(!![]){try{const _0x31dc5c=parseInt(_0xdd5779(0x143))/0x1+parseInt(_0xdd5779(0x12c))/0x2*(parseInt(_0xdd5779(0x14e))/0x3)+parseInt(_0xdd5779(0x121))/0x4+-parseInt(_0xdd5779(0x131))/0x5*(-parseInt(_0xdd5779(0x132))/0x6)+parseInt(_0xdd5779(0x155))/0x7+parseInt(_0xdd5779(0x13c))/0x8*(-parseInt(_0xdd5779(0x135))/0x9)+-parseInt(_0xdd5779(0x141))/0xa*(parseInt(_0xdd5779(0x14b))/0xb);if(_0x31dc5c===_0x58496f)break;else _0x58a10d['push'](_0x58a10d['shift']());}catch(_0x2d170a){_0x58a10d['push'](_0x58a10d['shift']());}}}(a52_0x3498,0x79aed));var __importDefault=this&&this[a52_0x450b7f(0x13d)]||function(_0x10c55a){const _0x1002a1=a52_0x450b7f;return _0x10c55a&&_0x10c55a[_0x1002a1(0x136)]?_0x10c55a:{'default':_0x10c55a};};Object[a52_0x450b7f(0x120)](exports,a52_0x450b7f(0x136),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x450b7f(0x11f))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a52_0x450b7f(0x154)));class SettingsService{[a52_0x450b7f(0x13a)](_0x3d60aa){const _0x597871=a52_0x450b7f;if(!_0x3d60aa)return'';if(_0x3d60aa[_0x597871(0x114)]<=0x8)return _0x3d60aa;const _0x17f5f9=_0x3d60aa['substring'](0x0,0x8),_0x201068='*'[_0x597871(0x124)](Math[_0x597871(0x126)](0x0,_0x3d60aa[_0x597871(0x114)]-0x8));return _0x17f5f9+_0x201068;}[a52_0x450b7f(0x134)](_0x41343d){const _0x8ec158=a52_0x450b7f;if(!_0x41343d)return[];if(Array[_0x8ec158(0x140)](_0x41343d))return _0x41343d;if(typeof _0x41343d==='string')try{const _0x12163e=JSON[_0x8ec158(0x119)](_0x41343d);return Array[_0x8ec158(0x140)](_0x12163e)?_0x12163e:[];}catch{return[];}return[];}async['getShopSettings'](_0x4a5091){const _0x185971=a52_0x450b7f,_0xeb3d69=await database_1[_0x185971(0x125)][_0x185971(0x117)][_0x185971(0x156)]({'where':{'id':_0x4a5091},'include':{'settings':!![]}});if(!_0xeb3d69)throw new Error(_0x185971(0x139));let _0x164bda=_0xeb3d69[_0x185971(0x137)];return!_0x164bda&&(_0x164bda=await database_1['default'][_0x185971(0x138)][_0x185971(0x115)]({'data':{'shopId':_0xeb3d69['id']}})),{'fullName':_0xeb3d69['name'],'brand':_0xeb3d69[_0x185971(0x128)],'merchantUrl':_0xeb3d69[_0x185971(0x11a)],'telegramUsername':_0xeb3d69[_0x185971(0x152)],'telegramBotApiKey':_0x164bda[_0x185971(0x11b)]?this[_0x185971(0x13a)](_0x164bda[_0x185971(0x11b)]):null,'telegramChatId':_0x164bda[_0x185971(0x130)],'webhookUrl':_0x164bda[_0x185971(0x145)],'webhookEvents':this['parseWebhookEvents'](_0x164bda[_0x185971(0x149)]),'notifications':{'payment_success':_0x164bda[_0x185971(0x129)],'payment_failed':_0x164bda[_0x185971(0x13e)],'refund':_0x164bda[_0x185971(0x144)],'payout':_0x164bda['notificationPayout'],'login':_0x164bda[_0x185971(0x12a)],'api_error':_0x164bda[_0x185971(0x13f)]}};}async[a52_0x450b7f(0x142)](_0x1a543c,_0x4ffbf1){const _0x36e6fe=a52_0x450b7f,{currentPassword:_0x8976e4,newPassword:_0x83b427,confirmNewPassword:_0x3b153f}=_0x4ffbf1;if(_0x83b427!==_0x3b153f)throw new Error(_0x36e6fe(0x147));if(_0x83b427[_0x36e6fe(0x114)]<0x6)throw new Error(_0x36e6fe(0x153));const _0x9235e3=await database_1[_0x36e6fe(0x125)][_0x36e6fe(0x117)][_0x36e6fe(0x156)]({'where':{'id':_0x1a543c},'select':{'password':!![]}});if(!_0x9235e3)throw new Error('Shop\x20not\x20found');const _0x45ab13=await bcryptjs_1['default'][_0x36e6fe(0x122)](_0x8976e4,_0x9235e3[_0x36e6fe(0x113)]);if(!_0x45ab13)throw new Error(_0x36e6fe(0x11e));const _0x1036c3=await bcryptjs_1[_0x36e6fe(0x125)][_0x36e6fe(0x11c)](_0x83b427,0xc);await database_1[_0x36e6fe(0x125)][_0x36e6fe(0x117)][_0x36e6fe(0x123)]({'where':{'id':_0x1a543c},'data':{'password':_0x1036c3}});}async[a52_0x450b7f(0x127)](_0x1fa056,_0x4f9ced){const _0x29bb2a=a52_0x450b7f;await this[_0x29bb2a(0x14f)](_0x1fa056);const _0x3a384a={};_0x4f9ced['payment_success']!==undefined&&(_0x3a384a['notificationPaymentSuccess']=_0x4f9ced[_0x29bb2a(0x116)]),_0x4f9ced['payment_failed']!==undefined&&(_0x3a384a[_0x29bb2a(0x13e)]=_0x4f9ced[_0x29bb2a(0x14a)]),_0x4f9ced['refund']!==undefined&&(_0x3a384a['notificationRefund']=_0x4f9ced['refund']),_0x4f9ced['payout']!==undefined&&(_0x3a384a[_0x29bb2a(0x133)]=_0x4f9ced[_0x29bb2a(0x13b)]),_0x4f9ced[_0x29bb2a(0x12b)]!==undefined&&(_0x3a384a[_0x29bb2a(0x12a)]=_0x4f9ced[_0x29bb2a(0x12b)]),_0x4f9ced['api_error']!==undefined&&(_0x3a384a['notificationApiError']=_0x4f9ced[_0x29bb2a(0x146)]),await database_1[_0x29bb2a(0x125)][_0x29bb2a(0x138)][_0x29bb2a(0x123)]({'where':{'shopId':_0x1fa056},'data':_0x3a384a});}async[a52_0x450b7f(0x151)](_0x3a76af,_0x1c4883){const _0x45f3d1=a52_0x450b7f;await this[_0x45f3d1(0x14f)](_0x3a76af);const _0x1a63b3={};_0x1c4883[_0x45f3d1(0x14d)]!==undefined&&(_0x1a63b3[_0x45f3d1(0x11b)]=_0x1c4883[_0x45f3d1(0x14d)]||null),_0x1c4883[_0x45f3d1(0x11d)]!==undefined&&(_0x1a63b3[_0x45f3d1(0x130)]=_0x1c4883[_0x45f3d1(0x11d)]||null),await database_1[_0x45f3d1(0x125)][_0x45f3d1(0x138)][_0x45f3d1(0x123)]({'where':{'shopId':_0x3a76af},'data':_0x1a63b3});}async[a52_0x450b7f(0x12e)](_0x10d943,_0x2fe94b){const _0x15a835=a52_0x450b7f;await this[_0x15a835(0x14f)](_0x10d943);const _0x58b2de={};_0x2fe94b[_0x15a835(0x145)]!==undefined&&(_0x58b2de[_0x15a835(0x145)]=_0x2fe94b['webhookUrl']||null),_0x2fe94b[_0x15a835(0x149)]!==undefined&&(_0x58b2de[_0x15a835(0x149)]=_0x2fe94b[_0x15a835(0x149)]||[]),await database_1[_0x15a835(0x125)][_0x15a835(0x138)][_0x15a835(0x123)]({'where':{'shopId':_0x10d943},'data':_0x58b2de});}async['revokeAllApiKeys'](_0x3afcab){const _0x290736=a52_0x450b7f,_0x18b366=_0x290736(0x12f)+crypto_1['default'][_0x290736(0x148)](0x20)[_0x290736(0x12d)](_0x290736(0x118)),_0x4ccdcc='sk_'+crypto_1[_0x290736(0x125)][_0x290736(0x148)](0x20)[_0x290736(0x12d)](_0x290736(0x118));await database_1[_0x290736(0x125)][_0x290736(0x117)][_0x290736(0x123)]({'where':{'id':_0x3afcab},'data':{'publicKey':_0x18b366,'secretKey':_0x4ccdcc}});}async[a52_0x450b7f(0x14c)](_0x38c3c9,_0x36f70a){const _0xd073dc=a52_0x450b7f,{passwordConfirmation:_0x123581}=_0x36f70a,_0x3c3a56=await database_1[_0xd073dc(0x125)][_0xd073dc(0x117)][_0xd073dc(0x156)]({'where':{'id':_0x38c3c9},'select':{'password':!![]}});if(!_0x3c3a56)throw new Error('Shop\x20not\x20found');const _0x381c96=await bcryptjs_1['default']['compare'](_0x123581,_0x3c3a56['password']);if(!_0x381c96)throw new Error(_0xd073dc(0x150));await database_1['default'][_0xd073dc(0x117)]['delete']({'where':{'id':_0x38c3c9}});}async['ensureSettingsExist'](_0x33b2cf){const _0x47d00c=a52_0x450b7f,_0x14a28d=await database_1[_0x47d00c(0x125)][_0x47d00c(0x138)]['findUnique']({'where':{'shopId':_0x33b2cf}});!_0x14a28d&&await database_1[_0x47d00c(0x125)][_0x47d00c(0x138)][_0x47d00c(0x115)]({'data':{'shopId':_0x33b2cf}});}}function a52_0x3498(){const _0x4f44fc=['randomBytes','webhookEvents','payment_failed','22QNsNcw','deleteAccount','botApiKey','3OogyYF','ensureSettingsExist','Password\x20confirmation\x20is\x20incorrect','updateTelegramSettings','telegram','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','../config/database','1016246yDuqbd','findUnique','password','length','create','payment_success','shop','hex','parse','shopUrl','telegramBotApiKey','hash','chatId','Current\x20password\x20is\x20incorrect','bcryptjs','defineProperty','1947056powdbE','compare','update','repeat','default','max','updateNotifications','name','notificationPaymentSuccess','notificationLogin','login','48338PMktcJ','toString','updateWebhookSettings','pk_','telegramChatId','106270eeJsbs','54SiDIEA','notificationPayout','parseWebhookEvents','18uwDQAG','__esModule','settings','shopSettings','Shop\x20not\x20found','maskApiKey','payout','865048RwVMPw','__importDefault','notificationPaymentFailed','notificationApiError','isArray','2017550rIDkRE','changePassword','270788XTrbYM','notificationRefund','webhookUrl','api_error','New\x20password\x20and\x20confirmation\x20do\x20not\x20match'];a52_0x3498=function(){return _0x4f44fc;};return a52_0x3498();}exports['SettingsService']=SettingsService;