'use strict';const a55_0x1c48c1=a55_0x3b22;(function(_0x5687c8,_0x326083){const _0x48ade1=a55_0x3b22,_0x1153e0=_0x5687c8();while(!![]){try{const _0x3b0277=parseInt(_0x48ade1(0xab))/0x1*(-parseInt(_0x48ade1(0xaf))/0x2)+parseInt(_0x48ade1(0x90))/0x3*(parseInt(_0x48ade1(0x73))/0x4)+parseInt(_0x48ade1(0x8f))/0x5*(parseInt(_0x48ade1(0x96))/0x6)+-parseInt(_0x48ade1(0xac))/0x7+-parseInt(_0x48ade1(0x9b))/0x8+parseInt(_0x48ade1(0x8a))/0x9+-parseInt(_0x48ade1(0xa6))/0xa*(-parseInt(_0x48ade1(0x7b))/0xb);if(_0x3b0277===_0x326083)break;else _0x1153e0['push'](_0x1153e0['shift']());}catch(_0x292f42){_0x1153e0['push'](_0x1153e0['shift']());}}}(a55_0x8ee5,0x1ab6c));var __importDefault=this&&this['__importDefault']||function(_0x2b7623){const _0x1a7e9c=a55_0x3b22;return _0x2b7623&&_0x2b7623[_0x1a7e9c(0xa7)]?_0x2b7623:{'default':_0x2b7623};};function a55_0x8ee5(){const _0x49522f=['15XNBmmh','notificationLogin','ensureSettingsExist','substring','delete','shopSettings','550212iaWlKp','repeat','max','login','parse','775504LJqBAQ','refund','create','parseWebhookEvents','string','maskApiKey','shop','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','randomBytes','telegram','payment_failed','4330OjsjXx','__esModule','password','telegramChatId','botApiKey','190avavjQ','369943xqTRbm','payout','getShopSettings','1864GnsRCJ','toString','SettingsService','notificationPaymentSuccess','hex','revokeAllApiKeys','Shop\x20not\x20found','deleteAccount','Current\x20password\x20is\x20incorrect','findUnique','168860BqcjVj','name','payment_success','notificationApiError','bcryptjs','api_error','webhookUrl','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','638iDmjCe','default','crypto','pk_','length','isArray','hash','settings','updateWebhookSettings','telegramBotApiKey','webhookEvents','updateNotifications','notificationPaymentFailed','compare','notificationRefund','150246soiFYY','update','updateTelegramSettings','notificationPayout','chatId','10ILGhlj'];a55_0x8ee5=function(){return _0x49522f;};return a55_0x8ee5();}function a55_0x3b22(_0x38d3aa,_0xed28ad){const _0x8ee533=a55_0x8ee5();return a55_0x3b22=function(_0x3b2295,_0x4fb94e){_0x3b2295=_0x3b2295-0x6c;let _0x249d32=_0x8ee533[_0x3b2295];return _0x249d32;},a55_0x3b22(_0x38d3aa,_0xed28ad);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a55_0x1c48c1(0xb1)]=void 0x0;const bcryptjs_1=__importDefault(require(a55_0x1c48c1(0x77))),crypto_1=__importDefault(require(a55_0x1c48c1(0x7d))),database_1=__importDefault(require('../config/database'));class SettingsService{[a55_0x1c48c1(0xa0)](_0x15db1b){const _0x2d25ad=a55_0x1c48c1;if(!_0x15db1b)return'';if(_0x15db1b[_0x2d25ad(0x7f)]<=0x8)return _0x15db1b;const _0x22996f=_0x15db1b[_0x2d25ad(0x93)](0x0,0x8),_0x107a35='*'[_0x2d25ad(0x97)](Math[_0x2d25ad(0x98)](0x0,_0x15db1b[_0x2d25ad(0x7f)]-0x8));return _0x22996f+_0x107a35;}[a55_0x1c48c1(0x9e)](_0x20bb71){const _0x2869bf=a55_0x1c48c1;if(!_0x20bb71)return[];if(Array[_0x2869bf(0x80)](_0x20bb71))return _0x20bb71;if(typeof _0x20bb71===_0x2869bf(0x9f))try{const _0x3cf61c=JSON[_0x2869bf(0x9a)](_0x20bb71);return Array[_0x2869bf(0x80)](_0x3cf61c)?_0x3cf61c:[];}catch{return[];}return[];}async[a55_0x1c48c1(0xae)](_0x3f8722){const _0x3a0a43=a55_0x1c48c1,_0x16fafc=await database_1['default'][_0x3a0a43(0xa1)][_0x3a0a43(0x72)]({'where':{'id':_0x3f8722},'include':{'settings':!![]}});if(!_0x16fafc)throw new Error(_0x3a0a43(0x6f));let _0x170b12=_0x16fafc[_0x3a0a43(0x82)];return!_0x170b12&&(_0x170b12=await database_1[_0x3a0a43(0x7c)][_0x3a0a43(0x95)][_0x3a0a43(0x9d)]({'data':{'shopId':_0x16fafc['id']}})),{'fullName':_0x16fafc['name'],'brand':_0x16fafc[_0x3a0a43(0x74)],'merchantUrl':_0x16fafc['shopUrl'],'telegramUsername':_0x16fafc[_0x3a0a43(0xa4)],'telegramBotApiKey':_0x170b12[_0x3a0a43(0x84)]?this[_0x3a0a43(0xa0)](_0x170b12[_0x3a0a43(0x84)]):null,'telegramChatId':_0x170b12[_0x3a0a43(0xa9)],'webhookUrl':_0x170b12[_0x3a0a43(0x79)],'webhookEvents':this[_0x3a0a43(0x9e)](_0x170b12[_0x3a0a43(0x85)]),'notifications':{'payment_success':_0x170b12['notificationPaymentSuccess'],'payment_failed':_0x170b12[_0x3a0a43(0x87)],'refund':_0x170b12[_0x3a0a43(0x89)],'payout':_0x170b12['notificationPayout'],'login':_0x170b12[_0x3a0a43(0x91)],'api_error':_0x170b12[_0x3a0a43(0x76)]}};}async['changePassword'](_0x9d9ea3,_0xc4e69e){const _0xe8bf3=a55_0x1c48c1,{currentPassword:_0x2794c4,newPassword:_0x3a003a,confirmNewPassword:_0xc59880}=_0xc4e69e;if(_0x3a003a!==_0xc59880)throw new Error(_0xe8bf3(0xa2));if(_0x3a003a[_0xe8bf3(0x7f)]<0x6)throw new Error(_0xe8bf3(0x7a));const _0x449e24=await database_1[_0xe8bf3(0x7c)][_0xe8bf3(0xa1)][_0xe8bf3(0x72)]({'where':{'id':_0x9d9ea3},'select':{'password':!![]}});if(!_0x449e24)throw new Error(_0xe8bf3(0x6f));const _0x2bb0c0=await bcryptjs_1['default'][_0xe8bf3(0x88)](_0x2794c4,_0x449e24['password']);if(!_0x2bb0c0)throw new Error(_0xe8bf3(0x71));const _0x3f84c5=await bcryptjs_1[_0xe8bf3(0x7c)][_0xe8bf3(0x81)](_0x3a003a,0xc);await database_1[_0xe8bf3(0x7c)][_0xe8bf3(0xa1)][_0xe8bf3(0x8b)]({'where':{'id':_0x9d9ea3},'data':{'password':_0x3f84c5}});}async[a55_0x1c48c1(0x86)](_0x40d2ee,_0x4f7ec7){const _0x33d023=a55_0x1c48c1;await this['ensureSettingsExist'](_0x40d2ee);const _0x59eb41={};_0x4f7ec7[_0x33d023(0x75)]!==undefined&&(_0x59eb41[_0x33d023(0x6c)]=_0x4f7ec7[_0x33d023(0x75)]),_0x4f7ec7[_0x33d023(0xa5)]!==undefined&&(_0x59eb41[_0x33d023(0x87)]=_0x4f7ec7[_0x33d023(0xa5)]),_0x4f7ec7[_0x33d023(0x9c)]!==undefined&&(_0x59eb41[_0x33d023(0x89)]=_0x4f7ec7[_0x33d023(0x9c)]),_0x4f7ec7[_0x33d023(0xad)]!==undefined&&(_0x59eb41[_0x33d023(0x8d)]=_0x4f7ec7[_0x33d023(0xad)]),_0x4f7ec7['login']!==undefined&&(_0x59eb41[_0x33d023(0x91)]=_0x4f7ec7[_0x33d023(0x99)]),_0x4f7ec7[_0x33d023(0x78)]!==undefined&&(_0x59eb41[_0x33d023(0x76)]=_0x4f7ec7[_0x33d023(0x78)]),await database_1[_0x33d023(0x7c)][_0x33d023(0x95)][_0x33d023(0x8b)]({'where':{'shopId':_0x40d2ee},'data':_0x59eb41});}async[a55_0x1c48c1(0x8c)](_0x1d6edc,_0x2fd0dc){const _0x4d04e0=a55_0x1c48c1;await this['ensureSettingsExist'](_0x1d6edc);const _0x5efa94={};_0x2fd0dc['botApiKey']!==undefined&&(_0x5efa94['telegramBotApiKey']=_0x2fd0dc[_0x4d04e0(0xaa)]||null),_0x2fd0dc[_0x4d04e0(0x8e)]!==undefined&&(_0x5efa94[_0x4d04e0(0xa9)]=_0x2fd0dc[_0x4d04e0(0x8e)]||null),await database_1[_0x4d04e0(0x7c)][_0x4d04e0(0x95)][_0x4d04e0(0x8b)]({'where':{'shopId':_0x1d6edc},'data':_0x5efa94});}async[a55_0x1c48c1(0x83)](_0x287b7a,_0x2bfc08){const _0x3bed13=a55_0x1c48c1;await this[_0x3bed13(0x92)](_0x287b7a);const _0x4caa61={};_0x2bfc08['webhookUrl']!==undefined&&(_0x4caa61[_0x3bed13(0x79)]=_0x2bfc08[_0x3bed13(0x79)]||null),_0x2bfc08[_0x3bed13(0x85)]!==undefined&&(_0x4caa61[_0x3bed13(0x85)]=_0x2bfc08[_0x3bed13(0x85)]||[]),await database_1[_0x3bed13(0x7c)]['shopSettings']['update']({'where':{'shopId':_0x287b7a},'data':_0x4caa61});}async[a55_0x1c48c1(0x6e)](_0xbd083c){const _0x1a1a50=a55_0x1c48c1,_0x2ead75=_0x1a1a50(0x7e)+crypto_1['default']['randomBytes'](0x20)[_0x1a1a50(0xb0)](_0x1a1a50(0x6d)),_0x4902b7='sk_'+crypto_1['default'][_0x1a1a50(0xa3)](0x20)[_0x1a1a50(0xb0)](_0x1a1a50(0x6d));await database_1[_0x1a1a50(0x7c)][_0x1a1a50(0xa1)][_0x1a1a50(0x8b)]({'where':{'id':_0xbd083c},'data':{'publicKey':_0x2ead75,'secretKey':_0x4902b7}});}async[a55_0x1c48c1(0x70)](_0x9c22d6,_0xfa47df){const _0x34c9a8=a55_0x1c48c1,{passwordConfirmation:_0x7461bd}=_0xfa47df,_0x363baf=await database_1[_0x34c9a8(0x7c)][_0x34c9a8(0xa1)][_0x34c9a8(0x72)]({'where':{'id':_0x9c22d6},'select':{'password':!![]}});if(!_0x363baf)throw new Error(_0x34c9a8(0x6f));const _0x4b547b=await bcryptjs_1[_0x34c9a8(0x7c)][_0x34c9a8(0x88)](_0x7461bd,_0x363baf[_0x34c9a8(0xa8)]);if(!_0x4b547b)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1['default'][_0x34c9a8(0xa1)][_0x34c9a8(0x94)]({'where':{'id':_0x9c22d6}});}async[a55_0x1c48c1(0x92)](_0x4968a2){const _0x5078ee=a55_0x1c48c1,_0x392803=await database_1[_0x5078ee(0x7c)][_0x5078ee(0x95)][_0x5078ee(0x72)]({'where':{'shopId':_0x4968a2}});!_0x392803&&await database_1[_0x5078ee(0x7c)][_0x5078ee(0x95)][_0x5078ee(0x9d)]({'data':{'shopId':_0x4968a2}});}}exports[a55_0x1c48c1(0xb1)]=SettingsService;