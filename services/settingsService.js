'use strict';const a53_0x49f7d9=a53_0x4693;(function(_0x5729ae,_0x40e7d8){const _0x5ce2cc=a53_0x4693,_0x2aed7e=_0x5729ae();while(!![]){try{const _0x148011=parseInt(_0x5ce2cc(0x116))/0x1+-parseInt(_0x5ce2cc(0x141))/0x2*(parseInt(_0x5ce2cc(0x138))/0x3)+-parseInt(_0x5ce2cc(0x148))/0x4*(-parseInt(_0x5ce2cc(0x12e))/0x5)+-parseInt(_0x5ce2cc(0x10a))/0x6+-parseInt(_0x5ce2cc(0x117))/0x7+-parseInt(_0x5ce2cc(0x137))/0x8*(-parseInt(_0x5ce2cc(0x12b))/0x9)+-parseInt(_0x5ce2cc(0x13c))/0xa*(-parseInt(_0x5ce2cc(0x12a))/0xb);if(_0x148011===_0x40e7d8)break;else _0x2aed7e['push'](_0x2aed7e['shift']());}catch(_0x185327){_0x2aed7e['push'](_0x2aed7e['shift']());}}}(a53_0x49c6,0xa2eb3));var __importDefault=this&&this[a53_0x49f7d9(0x131)]||function(_0x49bb48){const _0x1cd109=a53_0x49f7d9;return _0x49bb48&&_0x49bb48[_0x1cd109(0x11a)]?_0x49bb48:{'default':_0x49bb48};};function a53_0x4693(_0x25db7b,_0x563a9a){const _0x49c6f4=a53_0x49c6();return a53_0x4693=function(_0x4693f8,_0x486ef1){_0x4693f8=_0x4693f8-0x109;let _0x422768=_0x49c6f4[_0x4693f8];return _0x422768;},a53_0x4693(_0x25db7b,_0x563a9a);}Object[a53_0x49f7d9(0x134)](exports,a53_0x49f7d9(0x11a),{'value':!![]}),exports[a53_0x49f7d9(0x147)]=void 0x0;const bcryptjs_1=__importDefault(require(a53_0x49f7d9(0x145))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a53_0x49f7d9(0x11f)));class SettingsService{[a53_0x49f7d9(0x135)](_0x5b5c04){const _0x58700c=a53_0x49f7d9;if(!_0x5b5c04)return'';if(_0x5b5c04[_0x58700c(0x113)]<=0x8)return _0x5b5c04;const _0x675672=_0x5b5c04['substring'](0x0,0x8),_0x194ddd='*'['repeat'](Math[_0x58700c(0x11c)](0x0,_0x5b5c04[_0x58700c(0x113)]-0x8));return _0x675672+_0x194ddd;}[a53_0x49f7d9(0x115)](_0x351798){const _0x568016=a53_0x49f7d9;if(!_0x351798)return[];if(Array[_0x568016(0x149)](_0x351798))return _0x351798;if(typeof _0x351798===_0x568016(0x128))try{const _0x3b5790=JSON['parse'](_0x351798);return Array[_0x568016(0x149)](_0x3b5790)?_0x3b5790:[];}catch{return[];}return[];}async[a53_0x49f7d9(0x111)](_0x117b89){const _0x4ab28c=a53_0x49f7d9,_0x292d55=await database_1[_0x4ab28c(0x11e)][_0x4ab28c(0x130)][_0x4ab28c(0x13f)]({'where':{'id':_0x117b89},'include':{'settings':!![]}});if(!_0x292d55)throw new Error(_0x4ab28c(0x13b));let _0x58c4e0=_0x292d55[_0x4ab28c(0x13e)];return!_0x58c4e0&&(_0x58c4e0=await database_1[_0x4ab28c(0x11e)]['shopSettings'][_0x4ab28c(0x10c)]({'data':{'shopId':_0x292d55['id']}})),{'fullName':_0x292d55[_0x4ab28c(0x12f)],'brand':_0x292d55[_0x4ab28c(0x12f)],'merchantUrl':_0x292d55[_0x4ab28c(0x114)],'telegramUsername':_0x292d55[_0x4ab28c(0x13d)],'telegramBotApiKey':_0x58c4e0[_0x4ab28c(0x133)]?this[_0x4ab28c(0x135)](_0x58c4e0[_0x4ab28c(0x133)]):null,'telegramChatId':_0x58c4e0['telegramChatId'],'webhookUrl':_0x58c4e0['webhookUrl'],'webhookEvents':this['parseWebhookEvents'](_0x58c4e0[_0x4ab28c(0x139)]),'notifications':{'payment_success':_0x58c4e0[_0x4ab28c(0x119)],'payment_failed':_0x58c4e0['notificationPaymentFailed'],'refund':_0x58c4e0[_0x4ab28c(0x125)],'payout':_0x58c4e0[_0x4ab28c(0x136)],'login':_0x58c4e0['notificationLogin'],'api_error':_0x58c4e0['notificationApiError']}};}async[a53_0x49f7d9(0x142)](_0x3eeac8,_0x351ec7){const _0x533070=a53_0x49f7d9,{currentPassword:_0x5a2473,newPassword:_0x38f9f1,confirmNewPassword:_0x51c164}=_0x351ec7;if(_0x38f9f1!==_0x51c164)throw new Error(_0x533070(0x118));if(_0x38f9f1['length']<0x6)throw new Error(_0x533070(0x121));const _0xf5bb83=await database_1['default'][_0x533070(0x130)][_0x533070(0x13f)]({'where':{'id':_0x3eeac8},'select':{'password':!![]}});if(!_0xf5bb83)throw new Error(_0x533070(0x13b));const _0x16fa68=await bcryptjs_1['default'][_0x533070(0x14a)](_0x5a2473,_0xf5bb83[_0x533070(0x132)]);if(!_0x16fa68)throw new Error(_0x533070(0x10f));const _0x20fd78=await bcryptjs_1[_0x533070(0x11e)][_0x533070(0x120)](_0x38f9f1,0xc);await database_1[_0x533070(0x11e)]['shop']['update']({'where':{'id':_0x3eeac8},'data':{'password':_0x20fd78}});}async[a53_0x49f7d9(0x110)](_0x3d3073,_0x5cdb18){const _0x4501a8=a53_0x49f7d9;await this[_0x4501a8(0x143)](_0x3d3073);const _0x36f869={};_0x5cdb18[_0x4501a8(0x13a)]!==undefined&&(_0x36f869[_0x4501a8(0x119)]=_0x5cdb18[_0x4501a8(0x13a)]),_0x5cdb18[_0x4501a8(0x144)]!==undefined&&(_0x36f869[_0x4501a8(0x126)]=_0x5cdb18[_0x4501a8(0x144)]),_0x5cdb18['refund']!==undefined&&(_0x36f869['notificationRefund']=_0x5cdb18[_0x4501a8(0x127)]),_0x5cdb18[_0x4501a8(0x123)]!==undefined&&(_0x36f869[_0x4501a8(0x136)]=_0x5cdb18[_0x4501a8(0x123)]),_0x5cdb18['login']!==undefined&&(_0x36f869['notificationLogin']=_0x5cdb18[_0x4501a8(0x11b)]),_0x5cdb18[_0x4501a8(0x10b)]!==undefined&&(_0x36f869[_0x4501a8(0x146)]=_0x5cdb18[_0x4501a8(0x10b)]),await database_1[_0x4501a8(0x11e)][_0x4501a8(0x109)][_0x4501a8(0x140)]({'where':{'shopId':_0x3d3073},'data':_0x36f869});}async['updateTelegramSettings'](_0x587886,_0x50bfe3){const _0x38c0f5=a53_0x49f7d9;await this[_0x38c0f5(0x143)](_0x587886);const _0x2260f9={};_0x50bfe3[_0x38c0f5(0x14b)]!==undefined&&(_0x2260f9[_0x38c0f5(0x133)]=_0x50bfe3[_0x38c0f5(0x14b)]||null),_0x50bfe3[_0x38c0f5(0x112)]!==undefined&&(_0x2260f9[_0x38c0f5(0x10e)]=_0x50bfe3[_0x38c0f5(0x112)]||null),await database_1[_0x38c0f5(0x11e)][_0x38c0f5(0x109)][_0x38c0f5(0x140)]({'where':{'shopId':_0x587886},'data':_0x2260f9});}async['updateWebhookSettings'](_0xd9727f,_0x38a0d4){const _0x5e6c38=a53_0x49f7d9;await this[_0x5e6c38(0x143)](_0xd9727f);const _0x43ff5a={};_0x38a0d4[_0x5e6c38(0x122)]!==undefined&&(_0x43ff5a['webhookUrl']=_0x38a0d4[_0x5e6c38(0x122)]||null),_0x38a0d4[_0x5e6c38(0x139)]!==undefined&&(_0x43ff5a['webhookEvents']=_0x38a0d4[_0x5e6c38(0x139)]||[]),await database_1['default'][_0x5e6c38(0x109)][_0x5e6c38(0x140)]({'where':{'shopId':_0xd9727f},'data':_0x43ff5a});}async[a53_0x49f7d9(0x11d)](_0x19eb56){const _0x28eec3=a53_0x49f7d9,_0x56af56='pk_'+crypto_1[_0x28eec3(0x11e)][_0x28eec3(0x10d)](0x20)[_0x28eec3(0x124)](_0x28eec3(0x12d)),_0x250366=_0x28eec3(0x12c)+crypto_1['default'][_0x28eec3(0x10d)](0x20)[_0x28eec3(0x124)](_0x28eec3(0x12d));await database_1[_0x28eec3(0x11e)][_0x28eec3(0x130)][_0x28eec3(0x140)]({'where':{'id':_0x19eb56},'data':{'publicKey':_0x56af56,'secretKey':_0x250366}});}async[a53_0x49f7d9(0x129)](_0x18b9ae,_0x1a7fb6){const _0x41864f=a53_0x49f7d9,{passwordConfirmation:_0x552bf8}=_0x1a7fb6,_0x26b4bb=await database_1[_0x41864f(0x11e)][_0x41864f(0x130)][_0x41864f(0x13f)]({'where':{'id':_0x18b9ae},'select':{'password':!![]}});if(!_0x26b4bb)throw new Error(_0x41864f(0x13b));const _0x2a291f=await bcryptjs_1[_0x41864f(0x11e)][_0x41864f(0x14a)](_0x552bf8,_0x26b4bb[_0x41864f(0x132)]);if(!_0x2a291f)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x41864f(0x11e)][_0x41864f(0x130)]['delete']({'where':{'id':_0x18b9ae}});}async[a53_0x49f7d9(0x143)](_0xe13377){const _0x43e16c=a53_0x49f7d9,_0x442083=await database_1[_0x43e16c(0x11e)]['shopSettings'][_0x43e16c(0x13f)]({'where':{'shopId':_0xe13377}});!_0x442083&&await database_1[_0x43e16c(0x11e)][_0x43e16c(0x109)][_0x43e16c(0x10c)]({'data':{'shopId':_0xe13377}});}}exports['SettingsService']=SettingsService;function a53_0x49c6(){const _0x2aea6e=['chatId','length','shopUrl','parseWebhookEvents','591711SrcroA','9334878NRpXit','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','notificationPaymentSuccess','__esModule','login','max','revokeAllApiKeys','default','../config/database','hash','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','webhookUrl','payout','toString','notificationRefund','notificationPaymentFailed','refund','string','deleteAccount','5357iGtGQv','90uGTYDz','sk_','hex','3285tdirfo','name','shop','__importDefault','password','telegramBotApiKey','defineProperty','maskApiKey','notificationPayout','282184KIspxI','395547SBWaQq','webhookEvents','payment_success','Shop\x20not\x20found','8650DMugSE','telegram','settings','findUnique','update','8qfiGFn','changePassword','ensureSettingsExist','payment_failed','bcryptjs','notificationApiError','SettingsService','7204cJFBZY','isArray','compare','botApiKey','shopSettings','124128pZbIDC','api_error','create','randomBytes','telegramChatId','Current\x20password\x20is\x20incorrect','updateNotifications','getShopSettings'];a53_0x49c6=function(){return _0x2aea6e;};return a53_0x49c6();}