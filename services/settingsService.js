'use strict';const a72_0x2f174d=a72_0x5431;(function(_0x1355fb,_0x240655){const _0x3df97a=a72_0x5431,_0x54df2e=_0x1355fb();while(!![]){try{const _0x1eba64=-parseInt(_0x3df97a(0x147))/0x1*(-parseInt(_0x3df97a(0x133))/0x2)+parseInt(_0x3df97a(0x11b))/0x3+-parseInt(_0x3df97a(0x13e))/0x4+parseInt(_0x3df97a(0x121))/0x5+-parseInt(_0x3df97a(0x110))/0x6*(-parseInt(_0x3df97a(0x119))/0x7)+parseInt(_0x3df97a(0x138))/0x8+-parseInt(_0x3df97a(0x10a))/0x9*(parseInt(_0x3df97a(0x12f))/0xa);if(_0x1eba64===_0x240655)break;else _0x54df2e['push'](_0x54df2e['shift']());}catch(_0x2d5e49){_0x54df2e['push'](_0x54df2e['shift']());}}}(a72_0x29d1,0x4ab45));function a72_0x29d1(){const _0x3a9749=['notificationLogin','length','Password\x20confirmation\x20is\x20incorrect','1466IWaogP','ensureSettingsExist','__importDefault','settings','payment_success','__esModule','notificationPayout','bcryptjs','3391083CewuRQ','Current\x20password\x20is\x20incorrect','shop','changePassword','notificationPaymentFailed','name','150KqOayE','payment_failed','delete','Shop\x20not\x20found','crypto','chatId','updateWebhookSettings','compare','shopSettings','97258HdNORH','string','1088958UBxOGn','updateNotifications','botApiKey','webhookUrl','telegramBotApiKey','../config/database','2810435uVWUhA','sk_','parseWebhookEvents','maskApiKey','webhookEvents','randomBytes','substring','telegram','api_error','hex','update','deleteAccount','create','notificationApiError','30uiPCGN','login','isArray','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','114lGeyOo','default','pk_','updateTelegramSettings','notificationRefund','1618088pMAKeA','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','payout','repeat','toString','hash','487584muAkgT','notificationPaymentSuccess','max','findUnique','telegramChatId','getShopSettings'];a72_0x29d1=function(){return _0x3a9749;};return a72_0x29d1();}function a72_0x5431(_0x2b103e,_0x274613){_0x2b103e=_0x2b103e-0x10a;const _0x29d1c0=a72_0x29d1();let _0x5431a6=_0x29d1c0[_0x2b103e];return _0x5431a6;}var __importDefault=this&&this[a72_0x2f174d(0x149)]||function(_0x5ee29e){return _0x5ee29e&&_0x5ee29e['__esModule']?_0x5ee29e:{'default':_0x5ee29e};};Object['defineProperty'](exports,a72_0x2f174d(0x14c),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a72_0x2f174d(0x14e))),crypto_1=__importDefault(require(a72_0x2f174d(0x114))),database_1=__importDefault(require(a72_0x2f174d(0x120)));class SettingsService{[a72_0x2f174d(0x124)](_0x30dc26){const _0xc3099a=a72_0x2f174d;if(!_0x30dc26)return'';if(_0x30dc26[_0xc3099a(0x145)]<=0x8)return _0x30dc26;const _0x15cb47=_0x30dc26[_0xc3099a(0x127)](0x0,0x8),_0x1d00ec='*'[_0xc3099a(0x13b)](Math[_0xc3099a(0x140)](0x0,_0x30dc26[_0xc3099a(0x145)]-0x8));return _0x15cb47+_0x1d00ec;}['parseWebhookEvents'](_0x4ac469){const _0x510338=a72_0x2f174d;if(!_0x4ac469)return[];if(Array[_0x510338(0x131)](_0x4ac469))return _0x4ac469;if(typeof _0x4ac469===_0x510338(0x11a))try{const _0x27909d=JSON['parse'](_0x4ac469);return Array[_0x510338(0x131)](_0x27909d)?_0x27909d:[];}catch{return[];}return[];}async[a72_0x2f174d(0x143)](_0x2f2552){const _0x235756=a72_0x2f174d,_0x56eb70=await database_1[_0x235756(0x134)]['shop']['findUnique']({'where':{'id':_0x2f2552},'include':{'settings':!![]}});if(!_0x56eb70)throw new Error('Shop\x20not\x20found');let _0x29b24d=_0x56eb70[_0x235756(0x14a)];return!_0x29b24d&&(_0x29b24d=await database_1['default'][_0x235756(0x118)][_0x235756(0x12d)]({'data':{'shopId':_0x56eb70['id']}})),{'fullName':_0x56eb70[_0x235756(0x10f)],'brand':_0x56eb70[_0x235756(0x10f)],'merchantUrl':_0x56eb70['shopUrl'],'telegramUsername':_0x56eb70[_0x235756(0x128)],'telegramBotApiKey':_0x29b24d[_0x235756(0x11f)]?this[_0x235756(0x124)](_0x29b24d[_0x235756(0x11f)]):null,'telegramChatId':_0x29b24d[_0x235756(0x142)],'webhookUrl':_0x29b24d[_0x235756(0x11e)],'webhookEvents':this[_0x235756(0x123)](_0x29b24d[_0x235756(0x125)]),'notifications':{'payment_success':_0x29b24d[_0x235756(0x13f)],'payment_failed':_0x29b24d[_0x235756(0x10e)],'refund':_0x29b24d[_0x235756(0x137)],'payout':_0x29b24d['notificationPayout'],'login':_0x29b24d[_0x235756(0x144)],'api_error':_0x29b24d['notificationApiError']}};}async[a72_0x2f174d(0x10d)](_0x5c06d3,_0x3299d2){const _0x3f85a2=a72_0x2f174d,{currentPassword:_0x487b5c,newPassword:_0x5b75f7,confirmNewPassword:_0x237681}=_0x3299d2;if(_0x5b75f7!==_0x237681)throw new Error(_0x3f85a2(0x132));if(_0x5b75f7[_0x3f85a2(0x145)]<0x6)throw new Error(_0x3f85a2(0x139));const _0x4bd363=await database_1[_0x3f85a2(0x134)][_0x3f85a2(0x10c)]['findUnique']({'where':{'id':_0x5c06d3},'select':{'password':!![]}});if(!_0x4bd363)throw new Error('Shop\x20not\x20found');const _0x9f69ab=await bcryptjs_1[_0x3f85a2(0x134)][_0x3f85a2(0x117)](_0x487b5c,_0x4bd363['password']);if(!_0x9f69ab)throw new Error(_0x3f85a2(0x10b));const _0x2c47af=await bcryptjs_1['default'][_0x3f85a2(0x13d)](_0x5b75f7,0xc);await database_1[_0x3f85a2(0x134)][_0x3f85a2(0x10c)][_0x3f85a2(0x12b)]({'where':{'id':_0x5c06d3},'data':{'password':_0x2c47af}});}async[a72_0x2f174d(0x11c)](_0x4ea2e5,_0x1966d5){const _0x582b81=a72_0x2f174d;await this[_0x582b81(0x148)](_0x4ea2e5);const _0x14a5d2={};_0x1966d5[_0x582b81(0x14b)]!==undefined&&(_0x14a5d2['notificationPaymentSuccess']=_0x1966d5[_0x582b81(0x14b)]),_0x1966d5[_0x582b81(0x111)]!==undefined&&(_0x14a5d2[_0x582b81(0x10e)]=_0x1966d5['payment_failed']),_0x1966d5['refund']!==undefined&&(_0x14a5d2['notificationRefund']=_0x1966d5['refund']),_0x1966d5[_0x582b81(0x13a)]!==undefined&&(_0x14a5d2[_0x582b81(0x14d)]=_0x1966d5[_0x582b81(0x13a)]),_0x1966d5[_0x582b81(0x130)]!==undefined&&(_0x14a5d2[_0x582b81(0x144)]=_0x1966d5[_0x582b81(0x130)]),_0x1966d5[_0x582b81(0x129)]!==undefined&&(_0x14a5d2[_0x582b81(0x12e)]=_0x1966d5[_0x582b81(0x129)]),await database_1[_0x582b81(0x134)][_0x582b81(0x118)][_0x582b81(0x12b)]({'where':{'shopId':_0x4ea2e5},'data':_0x14a5d2});}async[a72_0x2f174d(0x136)](_0x163bce,_0x536a66){const _0x2cf21f=a72_0x2f174d;await this[_0x2cf21f(0x148)](_0x163bce);const _0x3897d6={};_0x536a66[_0x2cf21f(0x11d)]!==undefined&&(_0x3897d6[_0x2cf21f(0x11f)]=_0x536a66[_0x2cf21f(0x11d)]||null),_0x536a66[_0x2cf21f(0x115)]!==undefined&&(_0x3897d6['telegramChatId']=_0x536a66[_0x2cf21f(0x115)]||null),await database_1[_0x2cf21f(0x134)]['shopSettings'][_0x2cf21f(0x12b)]({'where':{'shopId':_0x163bce},'data':_0x3897d6});}async[a72_0x2f174d(0x116)](_0x352fe8,_0x5a7799){const _0x3d5d8e=a72_0x2f174d;await this['ensureSettingsExist'](_0x352fe8);const _0x3a414a={};_0x5a7799['webhookUrl']!==undefined&&(_0x3a414a[_0x3d5d8e(0x11e)]=_0x5a7799['webhookUrl']||null),_0x5a7799[_0x3d5d8e(0x125)]!==undefined&&(_0x3a414a[_0x3d5d8e(0x125)]=_0x5a7799[_0x3d5d8e(0x125)]||[]),await database_1['default'][_0x3d5d8e(0x118)][_0x3d5d8e(0x12b)]({'where':{'shopId':_0x352fe8},'data':_0x3a414a});}async['revokeAllApiKeys'](_0x5838fe){const _0x53db40=a72_0x2f174d,_0x4a7174=_0x53db40(0x135)+crypto_1[_0x53db40(0x134)][_0x53db40(0x126)](0x20)[_0x53db40(0x13c)](_0x53db40(0x12a)),_0x138a87=_0x53db40(0x122)+crypto_1[_0x53db40(0x134)]['randomBytes'](0x20)[_0x53db40(0x13c)](_0x53db40(0x12a));await database_1[_0x53db40(0x134)][_0x53db40(0x10c)]['update']({'where':{'id':_0x5838fe},'data':{'publicKey':_0x4a7174,'secretKey':_0x138a87}});}async[a72_0x2f174d(0x12c)](_0x222403,_0x35dce3){const _0x5455e3=a72_0x2f174d,{passwordConfirmation:_0x304780}=_0x35dce3,_0x130612=await database_1[_0x5455e3(0x134)][_0x5455e3(0x10c)][_0x5455e3(0x141)]({'where':{'id':_0x222403},'select':{'password':!![]}});if(!_0x130612)throw new Error(_0x5455e3(0x113));const _0x3a2411=await bcryptjs_1[_0x5455e3(0x134)][_0x5455e3(0x117)](_0x304780,_0x130612['password']);if(!_0x3a2411)throw new Error(_0x5455e3(0x146));await database_1[_0x5455e3(0x134)]['shop'][_0x5455e3(0x112)]({'where':{'id':_0x222403}});}async[a72_0x2f174d(0x148)](_0x47aac4){const _0x46aee9=a72_0x2f174d,_0x55b321=await database_1[_0x46aee9(0x134)][_0x46aee9(0x118)]['findUnique']({'where':{'shopId':_0x47aac4}});!_0x55b321&&await database_1[_0x46aee9(0x134)][_0x46aee9(0x118)][_0x46aee9(0x12d)]({'data':{'shopId':_0x47aac4}});}}exports['SettingsService']=SettingsService;