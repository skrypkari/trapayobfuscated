'use strict';const a52_0x56513b=a52_0x313c;(function(_0x115930,_0x54adbe){const _0x3d1733=a52_0x313c,_0x12d014=_0x115930();while(!![]){try{const _0x1923dd=-parseInt(_0x3d1733(0x161))/0x1+parseInt(_0x3d1733(0x129))/0x2*(parseInt(_0x3d1733(0x12b))/0x3)+-parseInt(_0x3d1733(0x137))/0x4+parseInt(_0x3d1733(0x144))/0x5+-parseInt(_0x3d1733(0x14d))/0x6+parseInt(_0x3d1733(0x159))/0x7*(-parseInt(_0x3d1733(0x132))/0x8)+-parseInt(_0x3d1733(0x12f))/0x9*(-parseInt(_0x3d1733(0x146))/0xa);if(_0x1923dd===_0x54adbe)break;else _0x12d014['push'](_0x12d014['shift']());}catch(_0x2754d9){_0x12d014['push'](_0x12d014['shift']());}}}(a52_0x3b72,0x8abb0));function a52_0x3b72(){const _0x3726c8=['updateTelegramSettings','234072bsqUvE','botApiKey','updateWebhookSettings','696CvwGjL','compare','notificationLogin','notificationPaymentSuccess','payout','547680NUjIDv','isArray','getShopSettings','__esModule','findUnique','length','shopSettings','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','delete','Shop\x20not\x20found','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','shopUrl','updateNotifications','2608745AICMWi','bcryptjs','380ZSXCnr','randomBytes','crypto','toString','login','chatId','Current\x20password\x20is\x20incorrect','2251980RbnYgl','webhookEvents','parseWebhookEvents','notificationRefund','name','defineProperty','telegramChatId','telegramBotApiKey','hash','shop','notificationApiError','maskApiKey','47635wBKmLH','password','string','deleteAccount','pk_','notificationPayout','payment_success','default','621094XapWgl','telegram','hex','update','repeat','refund','api_error','__importDefault','notificationPaymentFailed','webhookUrl','Password\x20confirmation\x20is\x20incorrect','16156XLZvCw','create','291yZVBDd','payment_failed','ensureSettingsExist'];a52_0x3b72=function(){return _0x3726c8;};return a52_0x3b72();}var __importDefault=this&&this[a52_0x56513b(0x125)]||function(_0x5587a){const _0x4f2259=a52_0x56513b;return _0x5587a&&_0x5587a[_0x4f2259(0x13a)]?_0x5587a:{'default':_0x5587a};};Object[a52_0x56513b(0x152)](exports,'__esModule',{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x56513b(0x145))),crypto_1=__importDefault(require(a52_0x56513b(0x148))),database_1=__importDefault(require('../config/database'));function a52_0x313c(_0x3ea35d,_0x504f69){const _0x3b7246=a52_0x3b72();return a52_0x313c=function(_0x313ce7,_0x1610b0){_0x313ce7=_0x313ce7-0x124;let _0x4229f0=_0x3b7246[_0x313ce7];return _0x4229f0;},a52_0x313c(_0x3ea35d,_0x504f69);}class SettingsService{[a52_0x56513b(0x158)](_0x5e4bde){const _0x3e82c8=a52_0x56513b;if(!_0x5e4bde)return'';if(_0x5e4bde[_0x3e82c8(0x13c)]<=0x8)return _0x5e4bde;const _0x5adb83=_0x5e4bde['substring'](0x0,0x8),_0x2f6c5c='*'[_0x3e82c8(0x165)](Math['max'](0x0,_0x5e4bde[_0x3e82c8(0x13c)]-0x8));return _0x5adb83+_0x2f6c5c;}[a52_0x56513b(0x14f)](_0x339290){const _0x26f638=a52_0x56513b;if(!_0x339290)return[];if(Array[_0x26f638(0x138)](_0x339290))return _0x339290;if(typeof _0x339290===_0x26f638(0x15b))try{const _0x5a6dfe=JSON['parse'](_0x339290);return Array[_0x26f638(0x138)](_0x5a6dfe)?_0x5a6dfe:[];}catch{return[];}return[];}async[a52_0x56513b(0x139)](_0x54ca8c){const _0x22c197=a52_0x56513b,_0x977383=await database_1[_0x22c197(0x160)][_0x22c197(0x156)][_0x22c197(0x13b)]({'where':{'id':_0x54ca8c},'include':{'settings':!![]}});if(!_0x977383)throw new Error(_0x22c197(0x140));let _0x3b267e=_0x977383['settings'];return!_0x3b267e&&(_0x3b267e=await database_1[_0x22c197(0x160)]['shopSettings']['create']({'data':{'shopId':_0x977383['id']}})),{'fullName':_0x977383['name'],'brand':_0x977383[_0x22c197(0x151)],'merchantUrl':_0x977383[_0x22c197(0x142)],'telegramUsername':_0x977383[_0x22c197(0x162)],'telegramBotApiKey':_0x3b267e[_0x22c197(0x154)]?this[_0x22c197(0x158)](_0x3b267e['telegramBotApiKey']):null,'telegramChatId':_0x3b267e['telegramChatId'],'webhookUrl':_0x3b267e[_0x22c197(0x127)],'webhookEvents':this[_0x22c197(0x14f)](_0x3b267e[_0x22c197(0x14e)]),'notifications':{'payment_success':_0x3b267e[_0x22c197(0x135)],'payment_failed':_0x3b267e[_0x22c197(0x126)],'refund':_0x3b267e['notificationRefund'],'payout':_0x3b267e[_0x22c197(0x15e)],'login':_0x3b267e[_0x22c197(0x134)],'api_error':_0x3b267e[_0x22c197(0x157)]}};}async['changePassword'](_0x54f32a,_0x20d705){const _0xbee475=a52_0x56513b,{currentPassword:_0x21e482,newPassword:_0x4208c6,confirmNewPassword:_0x54d6e2}=_0x20d705;if(_0x4208c6!==_0x54d6e2)throw new Error(_0xbee475(0x141));if(_0x4208c6[_0xbee475(0x13c)]<0x6)throw new Error(_0xbee475(0x13e));const _0x174934=await database_1[_0xbee475(0x160)][_0xbee475(0x156)][_0xbee475(0x13b)]({'where':{'id':_0x54f32a},'select':{'password':!![]}});if(!_0x174934)throw new Error(_0xbee475(0x140));const _0x1940b3=await bcryptjs_1['default'][_0xbee475(0x133)](_0x21e482,_0x174934[_0xbee475(0x15a)]);if(!_0x1940b3)throw new Error(_0xbee475(0x14c));const _0x135098=await bcryptjs_1[_0xbee475(0x160)][_0xbee475(0x155)](_0x4208c6,0xc);await database_1['default'][_0xbee475(0x156)][_0xbee475(0x164)]({'where':{'id':_0x54f32a},'data':{'password':_0x135098}});}async[a52_0x56513b(0x143)](_0x366937,_0x2ea6f9){const _0x467586=a52_0x56513b;await this[_0x467586(0x12d)](_0x366937);const _0xc7ae12={};_0x2ea6f9[_0x467586(0x15f)]!==undefined&&(_0xc7ae12[_0x467586(0x135)]=_0x2ea6f9[_0x467586(0x15f)]),_0x2ea6f9[_0x467586(0x12c)]!==undefined&&(_0xc7ae12[_0x467586(0x126)]=_0x2ea6f9[_0x467586(0x12c)]),_0x2ea6f9[_0x467586(0x166)]!==undefined&&(_0xc7ae12[_0x467586(0x150)]=_0x2ea6f9['refund']),_0x2ea6f9[_0x467586(0x136)]!==undefined&&(_0xc7ae12['notificationPayout']=_0x2ea6f9['payout']),_0x2ea6f9[_0x467586(0x14a)]!==undefined&&(_0xc7ae12[_0x467586(0x134)]=_0x2ea6f9[_0x467586(0x14a)]),_0x2ea6f9[_0x467586(0x124)]!==undefined&&(_0xc7ae12[_0x467586(0x157)]=_0x2ea6f9['api_error']),await database_1[_0x467586(0x160)][_0x467586(0x13d)][_0x467586(0x164)]({'where':{'shopId':_0x366937},'data':_0xc7ae12});}async[a52_0x56513b(0x12e)](_0xb36c57,_0x4ca255){const _0xe72242=a52_0x56513b;await this['ensureSettingsExist'](_0xb36c57);const _0x2416e4={};_0x4ca255[_0xe72242(0x130)]!==undefined&&(_0x2416e4[_0xe72242(0x154)]=_0x4ca255[_0xe72242(0x130)]||null),_0x4ca255[_0xe72242(0x14b)]!==undefined&&(_0x2416e4[_0xe72242(0x153)]=_0x4ca255[_0xe72242(0x14b)]||null),await database_1[_0xe72242(0x160)][_0xe72242(0x13d)][_0xe72242(0x164)]({'where':{'shopId':_0xb36c57},'data':_0x2416e4});}async[a52_0x56513b(0x131)](_0x45b631,_0x4d4165){const _0x4faa57=a52_0x56513b;await this['ensureSettingsExist'](_0x45b631);const _0x433ed9={};_0x4d4165['webhookUrl']!==undefined&&(_0x433ed9[_0x4faa57(0x127)]=_0x4d4165[_0x4faa57(0x127)]||null),_0x4d4165[_0x4faa57(0x14e)]!==undefined&&(_0x433ed9[_0x4faa57(0x14e)]=_0x4d4165[_0x4faa57(0x14e)]||[]),await database_1[_0x4faa57(0x160)][_0x4faa57(0x13d)][_0x4faa57(0x164)]({'where':{'shopId':_0x45b631},'data':_0x433ed9});}async['revokeAllApiKeys'](_0x41e348){const _0x46fa0b=a52_0x56513b,_0x15d8c0=_0x46fa0b(0x15d)+crypto_1[_0x46fa0b(0x160)]['randomBytes'](0x20)[_0x46fa0b(0x149)]('hex'),_0x3baf33='sk_'+crypto_1[_0x46fa0b(0x160)][_0x46fa0b(0x147)](0x20)[_0x46fa0b(0x149)](_0x46fa0b(0x163));await database_1[_0x46fa0b(0x160)][_0x46fa0b(0x156)]['update']({'where':{'id':_0x41e348},'data':{'publicKey':_0x15d8c0,'secretKey':_0x3baf33}});}async[a52_0x56513b(0x15c)](_0x3af6c5,_0x2a3ad7){const _0x192671=a52_0x56513b,{passwordConfirmation:_0x7d827c}=_0x2a3ad7,_0x57bbe0=await database_1[_0x192671(0x160)][_0x192671(0x156)][_0x192671(0x13b)]({'where':{'id':_0x3af6c5},'select':{'password':!![]}});if(!_0x57bbe0)throw new Error('Shop\x20not\x20found');const _0x1bede3=await bcryptjs_1[_0x192671(0x160)][_0x192671(0x133)](_0x7d827c,_0x57bbe0[_0x192671(0x15a)]);if(!_0x1bede3)throw new Error(_0x192671(0x128));await database_1[_0x192671(0x160)]['shop'][_0x192671(0x13f)]({'where':{'id':_0x3af6c5}});}async[a52_0x56513b(0x12d)](_0x5f52fb){const _0x432445=a52_0x56513b,_0x158096=await database_1['default'][_0x432445(0x13d)][_0x432445(0x13b)]({'where':{'shopId':_0x5f52fb}});!_0x158096&&await database_1[_0x432445(0x160)][_0x432445(0x13d)][_0x432445(0x12a)]({'data':{'shopId':_0x5f52fb}});}}exports['SettingsService']=SettingsService;