'use strict';const a55_0x1e48ec=a55_0x765d;(function(_0x7d7d57,_0x4808ad){const _0x125cbb=a55_0x765d,_0x14e5b8=_0x7d7d57();while(!![]){try{const _0x3f24cb=-parseInt(_0x125cbb(0x76))/0x1*(parseInt(_0x125cbb(0xa4))/0x2)+parseInt(_0x125cbb(0x86))/0x3*(parseInt(_0x125cbb(0xa7))/0x4)+-parseInt(_0x125cbb(0xaf))/0x5*(parseInt(_0x125cbb(0x95))/0x6)+parseInt(_0x125cbb(0x7c))/0x7*(-parseInt(_0x125cbb(0xb7))/0x8)+parseInt(_0x125cbb(0x7e))/0x9*(parseInt(_0x125cbb(0x80))/0xa)+-parseInt(_0x125cbb(0xab))/0xb+-parseInt(_0x125cbb(0xa8))/0xc*(-parseInt(_0x125cbb(0xb9))/0xd);if(_0x3f24cb===_0x4808ad)break;else _0x14e5b8['push'](_0x14e5b8['shift']());}catch(_0x7da98c){_0x14e5b8['push'](_0x14e5b8['shift']());}}}(a55_0x5b0b,0xb7fb9));function a55_0x5b0b(){const _0x5606c2=['ensureSettingsExist','parseWebhookEvents','webhookUrl','api_error','botApiKey','pk_','notificationPaymentFailed','../config/database','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','28894yunwpb','notificationPaymentSuccess','compare','1975992ogQpoO','264MZZZoj','Current\x20password\x20is\x20incorrect','login','9879452AKlpxo','Shop\x20not\x20found','notificationApiError','settings','2425iosIDV','refund','webhookEvents','updateWebhookSettings','payout','default','maskApiKey','updateTelegramSettings','8neHQhF','telegramBotApiKey','834431WBeRXd','notificationLogin','password','payment_failed','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','hex','62tywtHt','shopSettings','SettingsService','name','max','revokeAllApiKeys','5322611ualfct','changePassword','3727701dUVIyr','notificationPayout','10SxBHqN','__importDefault','notificationRefund','chatId','parse','shop','9RmshzE','deleteAccount','findUnique','telegramChatId','__esModule','repeat','create','update','crypto','Password\x20confirmation\x20is\x20incorrect','telegram','toString','hash','length','string','6hSKvPa','payment_success','randomBytes','delete','defineProperty','getShopSettings'];a55_0x5b0b=function(){return _0x5606c2;};return a55_0x5b0b();}var __importDefault=this&&this[a55_0x1e48ec(0x81)]||function(_0x3a06fa){const _0x5be1df=a55_0x1e48ec;return _0x3a06fa&&_0x3a06fa[_0x5be1df(0x8a)]?_0x3a06fa:{'default':_0x3a06fa};};Object[a55_0x1e48ec(0x99)](exports,a55_0x1e48ec(0x8a),{'value':!![]}),exports[a55_0x1e48ec(0x78)]=void 0x0;function a55_0x765d(_0x312c0c,_0x45e3ca){const _0x5b0b19=a55_0x5b0b();return a55_0x765d=function(_0x765dd0,_0x5543e5){_0x765dd0=_0x765dd0-0x71;let _0x2e0292=_0x5b0b19[_0x765dd0];return _0x2e0292;},a55_0x765d(_0x312c0c,_0x45e3ca);}const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a55_0x1e48ec(0x8e))),database_1=__importDefault(require(a55_0x1e48ec(0xa2)));class SettingsService{[a55_0x1e48ec(0xb5)](_0x2d3659){const _0x494782=a55_0x1e48ec;if(!_0x2d3659)return'';if(_0x2d3659[_0x494782(0x93)]<=0x8)return _0x2d3659;const _0x1fd85f=_0x2d3659['substring'](0x0,0x8),_0xd33ab1='*'[_0x494782(0x8b)](Math[_0x494782(0x7a)](0x0,_0x2d3659['length']-0x8));return _0x1fd85f+_0xd33ab1;}[a55_0x1e48ec(0x9c)](_0x435491){const _0x2a9b6b=a55_0x1e48ec;if(!_0x435491)return[];if(Array['isArray'](_0x435491))return _0x435491;if(typeof _0x435491===_0x2a9b6b(0x94))try{const _0x155b33=JSON[_0x2a9b6b(0x84)](_0x435491);return Array['isArray'](_0x155b33)?_0x155b33:[];}catch{return[];}return[];}async[a55_0x1e48ec(0x9a)](_0x1883f7){const _0xa45577=a55_0x1e48ec,_0xb8410b=await database_1[_0xa45577(0xb4)][_0xa45577(0x85)][_0xa45577(0x88)]({'where':{'id':_0x1883f7},'include':{'settings':!![]}});if(!_0xb8410b)throw new Error('Shop\x20not\x20found');let _0x257d42=_0xb8410b[_0xa45577(0xae)];return!_0x257d42&&(_0x257d42=await database_1[_0xa45577(0xb4)][_0xa45577(0x77)][_0xa45577(0x8c)]({'data':{'shopId':_0xb8410b['id']}})),{'fullName':_0xb8410b[_0xa45577(0x79)],'brand':_0xb8410b['name'],'merchantUrl':_0xb8410b['shopUrl'],'telegramUsername':_0xb8410b[_0xa45577(0x90)],'telegramBotApiKey':_0x257d42[_0xa45577(0xb8)]?this['maskApiKey'](_0x257d42[_0xa45577(0xb8)]):null,'telegramChatId':_0x257d42[_0xa45577(0x89)],'webhookUrl':_0x257d42[_0xa45577(0x9d)],'webhookEvents':this[_0xa45577(0x9c)](_0x257d42['webhookEvents']),'notifications':{'payment_success':_0x257d42[_0xa45577(0xa5)],'payment_failed':_0x257d42[_0xa45577(0xa1)],'refund':_0x257d42[_0xa45577(0x82)],'payout':_0x257d42[_0xa45577(0x7f)],'login':_0x257d42[_0xa45577(0x71)],'api_error':_0x257d42[_0xa45577(0xad)]}};}async[a55_0x1e48ec(0x7d)](_0x58ba8e,_0x5d39e4){const _0x21c4ed=a55_0x1e48ec,{currentPassword:_0x1f67f3,newPassword:_0x19dbac,confirmNewPassword:_0x12f9c8}=_0x5d39e4;if(_0x19dbac!==_0x12f9c8)throw new Error(_0x21c4ed(0xa3));if(_0x19dbac[_0x21c4ed(0x93)]<0x6)throw new Error(_0x21c4ed(0x74));const _0x12c71c=await database_1['default'][_0x21c4ed(0x85)][_0x21c4ed(0x88)]({'where':{'id':_0x58ba8e},'select':{'password':!![]}});if(!_0x12c71c)throw new Error(_0x21c4ed(0xac));const _0x2d3ac2=await bcryptjs_1[_0x21c4ed(0xb4)][_0x21c4ed(0xa6)](_0x1f67f3,_0x12c71c[_0x21c4ed(0x72)]);if(!_0x2d3ac2)throw new Error(_0x21c4ed(0xa9));const _0x2e32e9=await bcryptjs_1[_0x21c4ed(0xb4)][_0x21c4ed(0x92)](_0x19dbac,0xc);await database_1[_0x21c4ed(0xb4)][_0x21c4ed(0x85)][_0x21c4ed(0x8d)]({'where':{'id':_0x58ba8e},'data':{'password':_0x2e32e9}});}async['updateNotifications'](_0x4245e7,_0x3107df){const _0xad8038=a55_0x1e48ec;await this[_0xad8038(0x9b)](_0x4245e7);const _0x2d1ef8={};_0x3107df[_0xad8038(0x96)]!==undefined&&(_0x2d1ef8[_0xad8038(0xa5)]=_0x3107df['payment_success']),_0x3107df[_0xad8038(0x73)]!==undefined&&(_0x2d1ef8[_0xad8038(0xa1)]=_0x3107df['payment_failed']),_0x3107df[_0xad8038(0xb0)]!==undefined&&(_0x2d1ef8[_0xad8038(0x82)]=_0x3107df[_0xad8038(0xb0)]),_0x3107df[_0xad8038(0xb3)]!==undefined&&(_0x2d1ef8[_0xad8038(0x7f)]=_0x3107df['payout']),_0x3107df[_0xad8038(0xaa)]!==undefined&&(_0x2d1ef8[_0xad8038(0x71)]=_0x3107df[_0xad8038(0xaa)]),_0x3107df[_0xad8038(0x9e)]!==undefined&&(_0x2d1ef8['notificationApiError']=_0x3107df['api_error']),await database_1[_0xad8038(0xb4)][_0xad8038(0x77)][_0xad8038(0x8d)]({'where':{'shopId':_0x4245e7},'data':_0x2d1ef8});}async[a55_0x1e48ec(0xb6)](_0x2f7a92,_0x50e024){const _0x336919=a55_0x1e48ec;await this['ensureSettingsExist'](_0x2f7a92);const _0x2d702b={};_0x50e024[_0x336919(0x9f)]!==undefined&&(_0x2d702b[_0x336919(0xb8)]=_0x50e024[_0x336919(0x9f)]||null),_0x50e024[_0x336919(0x83)]!==undefined&&(_0x2d702b[_0x336919(0x89)]=_0x50e024['chatId']||null),await database_1['default'][_0x336919(0x77)]['update']({'where':{'shopId':_0x2f7a92},'data':_0x2d702b});}async[a55_0x1e48ec(0xb2)](_0x44d396,_0x4b12d5){const _0x3d0e61=a55_0x1e48ec;await this[_0x3d0e61(0x9b)](_0x44d396);const _0x42cc26={};_0x4b12d5['webhookUrl']!==undefined&&(_0x42cc26[_0x3d0e61(0x9d)]=_0x4b12d5[_0x3d0e61(0x9d)]||null),_0x4b12d5[_0x3d0e61(0xb1)]!==undefined&&(_0x42cc26[_0x3d0e61(0xb1)]=_0x4b12d5[_0x3d0e61(0xb1)]||[]),await database_1[_0x3d0e61(0xb4)][_0x3d0e61(0x77)][_0x3d0e61(0x8d)]({'where':{'shopId':_0x44d396},'data':_0x42cc26});}async[a55_0x1e48ec(0x7b)](_0x55e22f){const _0x4c51d0=a55_0x1e48ec,_0x2df153=_0x4c51d0(0xa0)+crypto_1['default'][_0x4c51d0(0x97)](0x20)[_0x4c51d0(0x91)](_0x4c51d0(0x75)),_0x353bc2='sk_'+crypto_1['default'][_0x4c51d0(0x97)](0x20)['toString'](_0x4c51d0(0x75));await database_1[_0x4c51d0(0xb4)][_0x4c51d0(0x85)]['update']({'where':{'id':_0x55e22f},'data':{'publicKey':_0x2df153,'secretKey':_0x353bc2}});}async[a55_0x1e48ec(0x87)](_0x15e22e,_0x580ce1){const _0x274414=a55_0x1e48ec,{passwordConfirmation:_0x3c9882}=_0x580ce1,_0x4ca7c3=await database_1[_0x274414(0xb4)][_0x274414(0x85)][_0x274414(0x88)]({'where':{'id':_0x15e22e},'select':{'password':!![]}});if(!_0x4ca7c3)throw new Error(_0x274414(0xac));const _0xe9e2d9=await bcryptjs_1[_0x274414(0xb4)][_0x274414(0xa6)](_0x3c9882,_0x4ca7c3[_0x274414(0x72)]);if(!_0xe9e2d9)throw new Error(_0x274414(0x8f));await database_1[_0x274414(0xb4)][_0x274414(0x85)][_0x274414(0x98)]({'where':{'id':_0x15e22e}});}async[a55_0x1e48ec(0x9b)](_0x132199){const _0x80a6e2=a55_0x1e48ec,_0x31fee5=await database_1['default'][_0x80a6e2(0x77)][_0x80a6e2(0x88)]({'where':{'shopId':_0x132199}});!_0x31fee5&&await database_1['default']['shopSettings'][_0x80a6e2(0x8c)]({'data':{'shopId':_0x132199}});}}exports[a55_0x1e48ec(0x78)]=SettingsService;