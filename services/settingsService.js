'use strict';const a51_0x32d165=a51_0x2c93;(function(_0x28cd48,_0x580864){const _0x5b0aac=a51_0x2c93,_0x4330ec=_0x28cd48();while(!![]){try{const _0x123121=parseInt(_0x5b0aac(0x11a))/0x1+-parseInt(_0x5b0aac(0xea))/0x2*(-parseInt(_0x5b0aac(0x124))/0x3)+parseInt(_0x5b0aac(0xf5))/0x4*(-parseInt(_0x5b0aac(0x10a))/0x5)+-parseInt(_0x5b0aac(0xf6))/0x6+-parseInt(_0x5b0aac(0xee))/0x7+-parseInt(_0x5b0aac(0x11b))/0x8*(parseInt(_0x5b0aac(0x11d))/0x9)+parseInt(_0x5b0aac(0xec))/0xa;if(_0x123121===_0x580864)break;else _0x4330ec['push'](_0x4330ec['shift']());}catch(_0x4a921c){_0x4330ec['push'](_0x4330ec['shift']());}}}(a51_0x2c1d,0x79178));var __importDefault=this&&this[a51_0x32d165(0xe7)]||function(_0x3f46da){const _0x4ea8a9=a51_0x32d165;return _0x3f46da&&_0x3f46da[_0x4ea8a9(0xfd)]?_0x3f46da:{'default':_0x3f46da};};Object[a51_0x32d165(0x10d)](exports,a51_0x32d165(0xfd),{'value':!![]}),exports[a51_0x32d165(0x122)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a51_0x32d165(0xef))),database_1=__importDefault(require(a51_0x32d165(0xe3)));function a51_0x2c1d(){const _0x3dcf11=['__esModule','telegramChatId','parseWebhookEvents','compare','notificationPaymentSuccess','delete','webhookUrl','payout','updateNotifications','findUnique','revokeAllApiKeys','botApiKey','repeat','2539715EGYAqB','sk_','shopSettings','defineProperty','substring','Password\x20confirmation\x20is\x20incorrect','randomBytes','password','updateWebhookSettings','create','chatId','getShopSettings','notificationPayout','changePassword','Shop\x20not\x20found','shopUrl','270920LxXsBd','214184pCXgCY','Current\x20password\x20is\x20incorrect','18RLqzVb','login','update','notificationPaymentFailed','name','SettingsService','hash','965379tOaSuR','string','notificationRefund','../config/database','maskApiKey','webhookEvents','toString','__importDefault','max','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','2LCmeYa','payment_failed','7713400TVCgoP','telegramBotApiKey','1257984VFvcAZ','crypto','ensureSettingsExist','api_error','updateTelegramSettings','notificationLogin','isArray','4DDXZya','761160KdWADk','pk_','hex','shop','default','length','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long'];a51_0x2c1d=function(){return _0x3dcf11;};return a51_0x2c1d();}class SettingsService{[a51_0x32d165(0xe4)](_0x348164){const _0x9e49d6=a51_0x32d165;if(!_0x348164)return'';if(_0x348164[_0x9e49d6(0xfb)]<=0x8)return _0x348164;const _0x5063a9=_0x348164[_0x9e49d6(0x10e)](0x0,0x8),_0x5a2a60='*'[_0x9e49d6(0x109)](Math[_0x9e49d6(0xe8)](0x0,_0x348164[_0x9e49d6(0xfb)]-0x8));return _0x5063a9+_0x5a2a60;}['parseWebhookEvents'](_0x41cf0b){const _0x1084d4=a51_0x32d165;if(!_0x41cf0b)return[];if(Array[_0x1084d4(0xf4)](_0x41cf0b))return _0x41cf0b;if(typeof _0x41cf0b===_0x1084d4(0xe1))try{const _0x407579=JSON['parse'](_0x41cf0b);return Array[_0x1084d4(0xf4)](_0x407579)?_0x407579:[];}catch{return[];}return[];}async[a51_0x32d165(0x115)](_0x3b66ae){const _0x550a74=a51_0x32d165,_0x416e82=await database_1[_0x550a74(0xfa)][_0x550a74(0xf9)][_0x550a74(0x106)]({'where':{'id':_0x3b66ae},'include':{'settings':!![]}});if(!_0x416e82)throw new Error(_0x550a74(0x118));let _0x171da2=_0x416e82['settings'];return!_0x171da2&&(_0x171da2=await database_1['default'][_0x550a74(0x10c)][_0x550a74(0x113)]({'data':{'shopId':_0x416e82['id']}})),{'fullName':_0x416e82[_0x550a74(0x121)],'brand':_0x416e82[_0x550a74(0x121)],'merchantUrl':_0x416e82[_0x550a74(0x119)],'telegramUsername':_0x416e82['telegram'],'telegramBotApiKey':_0x171da2[_0x550a74(0xed)]?this['maskApiKey'](_0x171da2['telegramBotApiKey']):null,'telegramChatId':_0x171da2['telegramChatId'],'webhookUrl':_0x171da2[_0x550a74(0x103)],'webhookEvents':this[_0x550a74(0xff)](_0x171da2['webhookEvents']),'notifications':{'payment_success':_0x171da2[_0x550a74(0x101)],'payment_failed':_0x171da2[_0x550a74(0x120)],'refund':_0x171da2[_0x550a74(0xe2)],'payout':_0x171da2[_0x550a74(0x116)],'login':_0x171da2[_0x550a74(0xf3)],'api_error':_0x171da2['notificationApiError']}};}async[a51_0x32d165(0x117)](_0x2b818f,_0x586d1d){const _0xb7549e=a51_0x32d165,{currentPassword:_0x593135,newPassword:_0x5e5401,confirmNewPassword:_0x58b861}=_0x586d1d;if(_0x5e5401!==_0x58b861)throw new Error(_0xb7549e(0xe9));if(_0x5e5401[_0xb7549e(0xfb)]<0x6)throw new Error(_0xb7549e(0xfc));const _0x38c3d6=await database_1['default'][_0xb7549e(0xf9)][_0xb7549e(0x106)]({'where':{'id':_0x2b818f},'select':{'password':!![]}});if(!_0x38c3d6)throw new Error(_0xb7549e(0x118));const _0x46c476=await bcryptjs_1[_0xb7549e(0xfa)][_0xb7549e(0x100)](_0x593135,_0x38c3d6[_0xb7549e(0x111)]);if(!_0x46c476)throw new Error(_0xb7549e(0x11c));const _0x5d248d=await bcryptjs_1[_0xb7549e(0xfa)][_0xb7549e(0x123)](_0x5e5401,0xc);await database_1[_0xb7549e(0xfa)][_0xb7549e(0xf9)]['update']({'where':{'id':_0x2b818f},'data':{'password':_0x5d248d}});}async[a51_0x32d165(0x105)](_0x1e20a7,_0x20eeaa){const _0x560dd0=a51_0x32d165;await this[_0x560dd0(0xf0)](_0x1e20a7);const _0x43ea7b={};_0x20eeaa['payment_success']!==undefined&&(_0x43ea7b[_0x560dd0(0x101)]=_0x20eeaa['payment_success']),_0x20eeaa[_0x560dd0(0xeb)]!==undefined&&(_0x43ea7b[_0x560dd0(0x120)]=_0x20eeaa[_0x560dd0(0xeb)]),_0x20eeaa['refund']!==undefined&&(_0x43ea7b[_0x560dd0(0xe2)]=_0x20eeaa['refund']),_0x20eeaa['payout']!==undefined&&(_0x43ea7b[_0x560dd0(0x116)]=_0x20eeaa[_0x560dd0(0x104)]),_0x20eeaa[_0x560dd0(0x11e)]!==undefined&&(_0x43ea7b[_0x560dd0(0xf3)]=_0x20eeaa[_0x560dd0(0x11e)]),_0x20eeaa[_0x560dd0(0xf1)]!==undefined&&(_0x43ea7b['notificationApiError']=_0x20eeaa[_0x560dd0(0xf1)]),await database_1[_0x560dd0(0xfa)][_0x560dd0(0x10c)][_0x560dd0(0x11f)]({'where':{'shopId':_0x1e20a7},'data':_0x43ea7b});}async[a51_0x32d165(0xf2)](_0x3aa29f,_0x477827){const _0x33eb1b=a51_0x32d165;await this[_0x33eb1b(0xf0)](_0x3aa29f);const _0x1f7abd={};_0x477827[_0x33eb1b(0x108)]!==undefined&&(_0x1f7abd[_0x33eb1b(0xed)]=_0x477827[_0x33eb1b(0x108)]||null),_0x477827[_0x33eb1b(0x114)]!==undefined&&(_0x1f7abd[_0x33eb1b(0xfe)]=_0x477827[_0x33eb1b(0x114)]||null),await database_1[_0x33eb1b(0xfa)][_0x33eb1b(0x10c)][_0x33eb1b(0x11f)]({'where':{'shopId':_0x3aa29f},'data':_0x1f7abd});}async[a51_0x32d165(0x112)](_0x1f32c2,_0x3a59a6){const _0x1382bd=a51_0x32d165;await this['ensureSettingsExist'](_0x1f32c2);const _0x145b78={};_0x3a59a6[_0x1382bd(0x103)]!==undefined&&(_0x145b78[_0x1382bd(0x103)]=_0x3a59a6[_0x1382bd(0x103)]||null),_0x3a59a6[_0x1382bd(0xe5)]!==undefined&&(_0x145b78[_0x1382bd(0xe5)]=_0x3a59a6[_0x1382bd(0xe5)]||[]),await database_1[_0x1382bd(0xfa)][_0x1382bd(0x10c)]['update']({'where':{'shopId':_0x1f32c2},'data':_0x145b78});}async[a51_0x32d165(0x107)](_0x5cbd7f){const _0x5223d4=a51_0x32d165,_0x49ce3e=_0x5223d4(0xf7)+crypto_1[_0x5223d4(0xfa)][_0x5223d4(0x110)](0x20)[_0x5223d4(0xe6)]('hex'),_0x36bf58=_0x5223d4(0x10b)+crypto_1[_0x5223d4(0xfa)][_0x5223d4(0x110)](0x20)['toString'](_0x5223d4(0xf8));await database_1[_0x5223d4(0xfa)][_0x5223d4(0xf9)]['update']({'where':{'id':_0x5cbd7f},'data':{'publicKey':_0x49ce3e,'secretKey':_0x36bf58}});}async['deleteAccount'](_0x1f56ae,_0xe9ba33){const _0x103b06=a51_0x32d165,{passwordConfirmation:_0x1f1303}=_0xe9ba33,_0x2ecf5b=await database_1[_0x103b06(0xfa)][_0x103b06(0xf9)][_0x103b06(0x106)]({'where':{'id':_0x1f56ae},'select':{'password':!![]}});if(!_0x2ecf5b)throw new Error(_0x103b06(0x118));const _0x3c4897=await bcryptjs_1[_0x103b06(0xfa)]['compare'](_0x1f1303,_0x2ecf5b[_0x103b06(0x111)]);if(!_0x3c4897)throw new Error(_0x103b06(0x10f));await database_1[_0x103b06(0xfa)][_0x103b06(0xf9)][_0x103b06(0x102)]({'where':{'id':_0x1f56ae}});}async[a51_0x32d165(0xf0)](_0x3ebf08){const _0x1600c3=a51_0x32d165,_0x4aa84a=await database_1[_0x1600c3(0xfa)][_0x1600c3(0x10c)][_0x1600c3(0x106)]({'where':{'shopId':_0x3ebf08}});!_0x4aa84a&&await database_1[_0x1600c3(0xfa)][_0x1600c3(0x10c)][_0x1600c3(0x113)]({'data':{'shopId':_0x3ebf08}});}}function a51_0x2c93(_0x3d27da,_0x3f9676){const _0x2c1d6e=a51_0x2c1d();return a51_0x2c93=function(_0x2c932a,_0x2fc768){_0x2c932a=_0x2c932a-0xe1;let _0x3cb686=_0x2c1d6e[_0x2c932a];return _0x3cb686;},a51_0x2c93(_0x3d27da,_0x3f9676);}exports[a51_0x32d165(0x122)]=SettingsService;