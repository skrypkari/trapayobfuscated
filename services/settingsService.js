'use strict';const a47_0xa115b8=a47_0x44bf;(function(_0xbf2ea0,_0x4f360e){const _0x230605=a47_0x44bf,_0x573e4a=_0xbf2ea0();while(!![]){try{const _0x23bb13=-parseInt(_0x230605(0x1cf))/0x1*(-parseInt(_0x230605(0x19f))/0x2)+-parseInt(_0x230605(0x1a8))/0x3+-parseInt(_0x230605(0x1cb))/0x4*(-parseInt(_0x230605(0x1a0))/0x5)+parseInt(_0x230605(0x1a2))/0x6+parseInt(_0x230605(0x1d5))/0x7*(parseInt(_0x230605(0x1c9))/0x8)+-parseInt(_0x230605(0x1ce))/0x9*(-parseInt(_0x230605(0x1bf))/0xa)+-parseInt(_0x230605(0x1b8))/0xb;if(_0x23bb13===_0x4f360e)break;else _0x573e4a['push'](_0x573e4a['shift']());}catch(_0x4625fe){_0x573e4a['push'](_0x573e4a['shift']());}}}(a47_0x2595,0x3d04a));function a47_0x2595(){const _0xbe4178=['compare','api_error','shopUrl','parseWebhookEvents','telegramBotApiKey','max','notificationPaymentSuccess','webhookEvents','pk_','repeat','updateNotifications','deleteAccount','isArray','shop','Password\x20confirmation\x20is\x20incorrect','7606720MJDWEc','../config/database','default','changePassword','notificationPaymentFailed','substring','SettingsService','10LUIedS','hash','settings','refund','parse','notificationApiError','create','password','defineProperty','notificationRefund','96IeGUNk','chatId','8rgVEfd','__esModule','telegram','188658vJNuPU','69577jeLIAp','getShopSettings','Shop\x20not\x20found','length','sk_','maskApiKey','258454AGAqzg','payment_success','findUnique','bcryptjs','string','updateWebhookSettings','botApiKey','webhookUrl','payout','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','shopSettings','hex','ensureSettingsExist','toString','name','telegramChatId','revokeAllApiKeys','8nLPXuj','696760LVnXOo','payment_failed','887112dtTokm','randomBytes','login','notificationLogin','notificationPayout','update','682320momXpj'];a47_0x2595=function(){return _0xbe4178;};return a47_0x2595();}var __importDefault=this&&this['__importDefault']||function(_0x3c4f80){const _0x31fb01=a47_0x44bf;return _0x3c4f80&&_0x3c4f80[_0x31fb01(0x1cc)]?_0x3c4f80:{'default':_0x3c4f80};};Object[a47_0xa115b8(0x1c7)](exports,a47_0xa115b8(0x1cc),{'value':!![]}),exports[a47_0xa115b8(0x1be)]=void 0x0;const bcryptjs_1=__importDefault(require(a47_0xa115b8(0x191))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a47_0xa115b8(0x1b9)));class SettingsService{[a47_0xa115b8(0x1d4)](_0x34b82d){const _0x59b54f=a47_0xa115b8;if(!_0x34b82d)return'';if(_0x34b82d[_0x59b54f(0x1d2)]<=0x8)return _0x34b82d;const _0x2ea6e9=_0x34b82d[_0x59b54f(0x1bd)](0x0,0x8),_0x548230='*'[_0x59b54f(0x1b2)](Math[_0x59b54f(0x1ae)](0x0,_0x34b82d[_0x59b54f(0x1d2)]-0x8));return _0x2ea6e9+_0x548230;}[a47_0xa115b8(0x1ac)](_0x115fde){const _0x1b9632=a47_0xa115b8;if(!_0x115fde)return[];if(Array[_0x1b9632(0x1b5)](_0x115fde))return _0x115fde;if(typeof _0x115fde===_0x1b9632(0x192))try{const _0x230127=JSON[_0x1b9632(0x1c3)](_0x115fde);return Array['isArray'](_0x230127)?_0x230127:[];}catch{return[];}return[];}async[a47_0xa115b8(0x1d0)](_0x2604a2){const _0x1b535e=a47_0xa115b8,_0x169952=await database_1['default'][_0x1b535e(0x1b6)][_0x1b535e(0x190)]({'where':{'id':_0x2604a2},'include':{'settings':!![]}});if(!_0x169952)throw new Error('Shop\x20not\x20found');let _0x51c635=_0x169952[_0x1b535e(0x1c1)];return!_0x51c635&&(_0x51c635=await database_1[_0x1b535e(0x1ba)][_0x1b535e(0x198)][_0x1b535e(0x1c5)]({'data':{'shopId':_0x169952['id']}})),{'fullName':_0x169952['name'],'brand':_0x169952[_0x1b535e(0x19c)],'merchantUrl':_0x169952[_0x1b535e(0x1ab)],'telegramUsername':_0x169952[_0x1b535e(0x1cd)],'telegramBotApiKey':_0x51c635[_0x1b535e(0x1ad)]?this[_0x1b535e(0x1d4)](_0x51c635[_0x1b535e(0x1ad)]):null,'telegramChatId':_0x51c635[_0x1b535e(0x19d)],'webhookUrl':_0x51c635[_0x1b535e(0x195)],'webhookEvents':this[_0x1b535e(0x1ac)](_0x51c635[_0x1b535e(0x1b0)]),'notifications':{'payment_success':_0x51c635['notificationPaymentSuccess'],'payment_failed':_0x51c635[_0x1b535e(0x1bc)],'refund':_0x51c635[_0x1b535e(0x1c8)],'payout':_0x51c635[_0x1b535e(0x1a6)],'login':_0x51c635['notificationLogin'],'api_error':_0x51c635['notificationApiError']}};}async[a47_0xa115b8(0x1bb)](_0x474056,_0x7cadb5){const _0x4b0f80=a47_0xa115b8,{currentPassword:_0x47d57a,newPassword:_0x424155,confirmNewPassword:_0x5b80ae}=_0x7cadb5;if(_0x424155!==_0x5b80ae)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x424155[_0x4b0f80(0x1d2)]<0x6)throw new Error(_0x4b0f80(0x197));const _0x519862=await database_1[_0x4b0f80(0x1ba)][_0x4b0f80(0x1b6)][_0x4b0f80(0x190)]({'where':{'id':_0x474056},'select':{'password':!![]}});if(!_0x519862)throw new Error(_0x4b0f80(0x1d1));const _0x5a8169=await bcryptjs_1[_0x4b0f80(0x1ba)][_0x4b0f80(0x1a9)](_0x47d57a,_0x519862['password']);if(!_0x5a8169)throw new Error('Current\x20password\x20is\x20incorrect');const _0x3084d7=await bcryptjs_1[_0x4b0f80(0x1ba)][_0x4b0f80(0x1c0)](_0x424155,0xc);await database_1[_0x4b0f80(0x1ba)][_0x4b0f80(0x1b6)]['update']({'where':{'id':_0x474056},'data':{'password':_0x3084d7}});}async[a47_0xa115b8(0x1b3)](_0x206ccd,_0x45f055){const _0x66ad68=a47_0xa115b8;await this[_0x66ad68(0x19a)](_0x206ccd);const _0x2ed40c={};_0x45f055[_0x66ad68(0x18f)]!==undefined&&(_0x2ed40c[_0x66ad68(0x1af)]=_0x45f055['payment_success']),_0x45f055['payment_failed']!==undefined&&(_0x2ed40c[_0x66ad68(0x1bc)]=_0x45f055[_0x66ad68(0x1a1)]),_0x45f055[_0x66ad68(0x1c2)]!==undefined&&(_0x2ed40c[_0x66ad68(0x1c8)]=_0x45f055['refund']),_0x45f055[_0x66ad68(0x196)]!==undefined&&(_0x2ed40c[_0x66ad68(0x1a6)]=_0x45f055['payout']),_0x45f055['login']!==undefined&&(_0x2ed40c[_0x66ad68(0x1a5)]=_0x45f055[_0x66ad68(0x1a4)]),_0x45f055[_0x66ad68(0x1aa)]!==undefined&&(_0x2ed40c[_0x66ad68(0x1c4)]=_0x45f055[_0x66ad68(0x1aa)]),await database_1['default'][_0x66ad68(0x198)][_0x66ad68(0x1a7)]({'where':{'shopId':_0x206ccd},'data':_0x2ed40c});}async['updateTelegramSettings'](_0x2e6664,_0x234264){const _0x40ee62=a47_0xa115b8;await this['ensureSettingsExist'](_0x2e6664);const _0x33d45b={};_0x234264[_0x40ee62(0x194)]!==undefined&&(_0x33d45b[_0x40ee62(0x1ad)]=_0x234264['botApiKey']||null),_0x234264['chatId']!==undefined&&(_0x33d45b[_0x40ee62(0x19d)]=_0x234264[_0x40ee62(0x1ca)]||null),await database_1[_0x40ee62(0x1ba)]['shopSettings'][_0x40ee62(0x1a7)]({'where':{'shopId':_0x2e6664},'data':_0x33d45b});}async[a47_0xa115b8(0x193)](_0x529f2c,_0x5d688d){const _0x727b63=a47_0xa115b8;await this['ensureSettingsExist'](_0x529f2c);const _0x4b80ed={};_0x5d688d[_0x727b63(0x195)]!==undefined&&(_0x4b80ed['webhookUrl']=_0x5d688d[_0x727b63(0x195)]||null),_0x5d688d[_0x727b63(0x1b0)]!==undefined&&(_0x4b80ed[_0x727b63(0x1b0)]=_0x5d688d[_0x727b63(0x1b0)]||[]),await database_1[_0x727b63(0x1ba)][_0x727b63(0x198)]['update']({'where':{'shopId':_0x529f2c},'data':_0x4b80ed});}async[a47_0xa115b8(0x19e)](_0x405968){const _0x13141f=a47_0xa115b8,_0x127363=_0x13141f(0x1b1)+crypto_1[_0x13141f(0x1ba)][_0x13141f(0x1a3)](0x20)['toString'](_0x13141f(0x199)),_0x272971=_0x13141f(0x1d3)+crypto_1[_0x13141f(0x1ba)][_0x13141f(0x1a3)](0x20)[_0x13141f(0x19b)](_0x13141f(0x199));await database_1[_0x13141f(0x1ba)][_0x13141f(0x1b6)][_0x13141f(0x1a7)]({'where':{'id':_0x405968},'data':{'publicKey':_0x127363,'secretKey':_0x272971}});}async[a47_0xa115b8(0x1b4)](_0x5343a0,_0x3476a5){const _0x5d3c99=a47_0xa115b8,{passwordConfirmation:_0x22ece6}=_0x3476a5,_0x5bbd83=await database_1['default']['shop'][_0x5d3c99(0x190)]({'where':{'id':_0x5343a0},'select':{'password':!![]}});if(!_0x5bbd83)throw new Error('Shop\x20not\x20found');const _0x9672d5=await bcryptjs_1[_0x5d3c99(0x1ba)][_0x5d3c99(0x1a9)](_0x22ece6,_0x5bbd83[_0x5d3c99(0x1c6)]);if(!_0x9672d5)throw new Error(_0x5d3c99(0x1b7));await database_1[_0x5d3c99(0x1ba)]['shop']['delete']({'where':{'id':_0x5343a0}});}async[a47_0xa115b8(0x19a)](_0x1ffed4){const _0x313fe3=a47_0xa115b8,_0x3d5a93=await database_1[_0x313fe3(0x1ba)]['shopSettings'][_0x313fe3(0x190)]({'where':{'shopId':_0x1ffed4}});!_0x3d5a93&&await database_1[_0x313fe3(0x1ba)][_0x313fe3(0x198)]['create']({'data':{'shopId':_0x1ffed4}});}}function a47_0x44bf(_0x40b2,_0x1c66a1){const _0x259553=a47_0x2595();return a47_0x44bf=function(_0x44bfe7,_0x3e37d1){_0x44bfe7=_0x44bfe7-0x18f;let _0x364585=_0x259553[_0x44bfe7];return _0x364585;},a47_0x44bf(_0x40b2,_0x1c66a1);}exports[a47_0xa115b8(0x1be)]=SettingsService;