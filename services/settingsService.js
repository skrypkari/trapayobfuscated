'use strict';const a47_0x49a2ad=a47_0x38f7;(function(_0xe9645f,_0x35e1f5){const _0x563fda=a47_0x38f7,_0x473b22=_0xe9645f();while(!![]){try{const _0x39eee8=parseInt(_0x563fda(0x127))/0x1+parseInt(_0x563fda(0x151))/0x2*(-parseInt(_0x563fda(0x144))/0x3)+parseInt(_0x563fda(0x135))/0x4*(parseInt(_0x563fda(0x137))/0x5)+parseInt(_0x563fda(0x147))/0x6*(parseInt(_0x563fda(0x154))/0x7)+parseInt(_0x563fda(0x13a))/0x8*(parseInt(_0x563fda(0x152))/0x9)+parseInt(_0x563fda(0x13b))/0xa+-parseInt(_0x563fda(0x124))/0xb;if(_0x39eee8===_0x35e1f5)break;else _0x473b22['push'](_0x473b22['shift']());}catch(_0x5da3f0){_0x473b22['push'](_0x473b22['shift']());}}}(a47_0x2e24,0xcb54f));var __importDefault=this&&this[a47_0x49a2ad(0x134)]||function(_0x14b958){const _0x3c5b74=a47_0x49a2ad;return _0x14b958&&_0x14b958[_0x3c5b74(0x131)]?_0x14b958:{'default':_0x14b958};};function a47_0x2e24(){const _0x2e5b61=['notificationLogin','refund','notificationPaymentSuccess','randomBytes','default','api_error','max','__esModule','webhookEvents','Current\x20password\x20is\x20incorrect','__importDefault','12UIXaBT','notificationApiError','1554115DSDkxn','telegramChatId','parseWebhookEvents','132808ITVsjt','12217470TaJqvH','findUnique','Password\x20confirmation\x20is\x20incorrect','parse','../config/database','isArray','payment_success','telegramBotApiKey','shop','171723toxDDL','shopSettings','sk_','492Gxiyrm','crypto','length','update','string','delete','hex','create','chatId','notificationRefund','16oTzyXT','801EIgwPB','payment_failed','52605nfhmBN','password','settings','pk_','bcryptjs','compare','webhookUrl','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','toString','ensureSettingsExist','revokeAllApiKeys','substring','maskApiKey','botApiKey','login','notificationPaymentFailed','updateNotifications','50396720SsNgef','updateTelegramSettings','payout','1624360RnpIWj','Shop\x20not\x20found','notificationPayout'];a47_0x2e24=function(){return _0x2e5b61;};return a47_0x2e24();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['SettingsService']=void 0x0;function a47_0x38f7(_0x42b861,_0x2a663b){const _0x2e2483=a47_0x2e24();return a47_0x38f7=function(_0x38f772,_0x1ad175){_0x38f772=_0x38f772-0x119;let _0x4c9aff=_0x2e2483[_0x38f772];return _0x4c9aff;},a47_0x38f7(_0x42b861,_0x2a663b);}const bcryptjs_1=__importDefault(require(a47_0x49a2ad(0x158))),crypto_1=__importDefault(require(a47_0x49a2ad(0x148))),database_1=__importDefault(require(a47_0x49a2ad(0x13f)));class SettingsService{[a47_0x49a2ad(0x11f)](_0x37be7b){const _0x43c7f8=a47_0x49a2ad;if(!_0x37be7b)return'';if(_0x37be7b[_0x43c7f8(0x149)]<=0x8)return _0x37be7b;const _0x34d25b=_0x37be7b[_0x43c7f8(0x11e)](0x0,0x8),_0x5e1a3b='*'['repeat'](Math[_0x43c7f8(0x130)](0x0,_0x37be7b['length']-0x8));return _0x34d25b+_0x5e1a3b;}[a47_0x49a2ad(0x139)](_0x14a0a8){const _0x12ecaa=a47_0x49a2ad;if(!_0x14a0a8)return[];if(Array['isArray'](_0x14a0a8))return _0x14a0a8;if(typeof _0x14a0a8===_0x12ecaa(0x14b))try{const _0x1b2511=JSON[_0x12ecaa(0x13e)](_0x14a0a8);return Array[_0x12ecaa(0x140)](_0x1b2511)?_0x1b2511:[];}catch{return[];}return[];}async['getShopSettings'](_0x42d754){const _0x18f786=a47_0x49a2ad,_0x19ec0b=await database_1[_0x18f786(0x12e)][_0x18f786(0x143)][_0x18f786(0x13c)]({'where':{'id':_0x42d754},'include':{'settings':!![]}});if(!_0x19ec0b)throw new Error(_0x18f786(0x128));let _0x25323f=_0x19ec0b[_0x18f786(0x156)];return!_0x25323f&&(_0x25323f=await database_1[_0x18f786(0x12e)]['shopSettings'][_0x18f786(0x14e)]({'data':{'shopId':_0x19ec0b['id']}})),{'fullName':_0x19ec0b['name'],'brand':_0x19ec0b['name'],'merchantUrl':_0x19ec0b['shopUrl'],'telegramUsername':_0x19ec0b['telegram'],'telegramBotApiKey':_0x25323f['telegramBotApiKey']?this['maskApiKey'](_0x25323f['telegramBotApiKey']):null,'telegramChatId':_0x25323f[_0x18f786(0x138)],'webhookUrl':_0x25323f[_0x18f786(0x119)],'webhookEvents':this['parseWebhookEvents'](_0x25323f[_0x18f786(0x132)]),'notifications':{'payment_success':_0x25323f[_0x18f786(0x12c)],'payment_failed':_0x25323f['notificationPaymentFailed'],'refund':_0x25323f[_0x18f786(0x150)],'payout':_0x25323f[_0x18f786(0x129)],'login':_0x25323f[_0x18f786(0x12a)],'api_error':_0x25323f[_0x18f786(0x136)]}};}async['changePassword'](_0x581277,_0x7ad916){const _0x12e9b5=a47_0x49a2ad,{currentPassword:_0x216f89,newPassword:_0x58322a,confirmNewPassword:_0x23efbb}=_0x7ad916;if(_0x58322a!==_0x23efbb)throw new Error(_0x12e9b5(0x11a));if(_0x58322a['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x39c927=await database_1[_0x12e9b5(0x12e)]['shop'][_0x12e9b5(0x13c)]({'where':{'id':_0x581277},'select':{'password':!![]}});if(!_0x39c927)throw new Error('Shop\x20not\x20found');const _0x3acf66=await bcryptjs_1[_0x12e9b5(0x12e)][_0x12e9b5(0x159)](_0x216f89,_0x39c927[_0x12e9b5(0x155)]);if(!_0x3acf66)throw new Error(_0x12e9b5(0x133));const _0x3176f0=await bcryptjs_1[_0x12e9b5(0x12e)]['hash'](_0x58322a,0xc);await database_1[_0x12e9b5(0x12e)][_0x12e9b5(0x143)][_0x12e9b5(0x14a)]({'where':{'id':_0x581277},'data':{'password':_0x3176f0}});}async[a47_0x49a2ad(0x123)](_0x566e35,_0x1dedea){const _0x3b818b=a47_0x49a2ad;await this[_0x3b818b(0x11c)](_0x566e35);const _0x4f549a={};_0x1dedea[_0x3b818b(0x141)]!==undefined&&(_0x4f549a[_0x3b818b(0x12c)]=_0x1dedea[_0x3b818b(0x141)]),_0x1dedea[_0x3b818b(0x153)]!==undefined&&(_0x4f549a[_0x3b818b(0x122)]=_0x1dedea[_0x3b818b(0x153)]),_0x1dedea['refund']!==undefined&&(_0x4f549a['notificationRefund']=_0x1dedea[_0x3b818b(0x12b)]),_0x1dedea[_0x3b818b(0x126)]!==undefined&&(_0x4f549a['notificationPayout']=_0x1dedea[_0x3b818b(0x126)]),_0x1dedea[_0x3b818b(0x121)]!==undefined&&(_0x4f549a[_0x3b818b(0x12a)]=_0x1dedea[_0x3b818b(0x121)]),_0x1dedea[_0x3b818b(0x12f)]!==undefined&&(_0x4f549a[_0x3b818b(0x136)]=_0x1dedea[_0x3b818b(0x12f)]),await database_1[_0x3b818b(0x12e)][_0x3b818b(0x145)][_0x3b818b(0x14a)]({'where':{'shopId':_0x566e35},'data':_0x4f549a});}async[a47_0x49a2ad(0x125)](_0x486687,_0x21afb0){const _0x4ae916=a47_0x49a2ad;await this[_0x4ae916(0x11c)](_0x486687);const _0x2675cb={};_0x21afb0[_0x4ae916(0x120)]!==undefined&&(_0x2675cb[_0x4ae916(0x142)]=_0x21afb0['botApiKey']||null),_0x21afb0[_0x4ae916(0x14f)]!==undefined&&(_0x2675cb[_0x4ae916(0x138)]=_0x21afb0[_0x4ae916(0x14f)]||null),await database_1[_0x4ae916(0x12e)][_0x4ae916(0x145)][_0x4ae916(0x14a)]({'where':{'shopId':_0x486687},'data':_0x2675cb});}async['updateWebhookSettings'](_0x19c62a,_0x2e1a81){const _0x5acff0=a47_0x49a2ad;await this[_0x5acff0(0x11c)](_0x19c62a);const _0xc2aa04={};_0x2e1a81[_0x5acff0(0x119)]!==undefined&&(_0xc2aa04[_0x5acff0(0x119)]=_0x2e1a81[_0x5acff0(0x119)]||null),_0x2e1a81[_0x5acff0(0x132)]!==undefined&&(_0xc2aa04['webhookEvents']=_0x2e1a81[_0x5acff0(0x132)]||[]),await database_1[_0x5acff0(0x12e)][_0x5acff0(0x145)][_0x5acff0(0x14a)]({'where':{'shopId':_0x19c62a},'data':_0xc2aa04});}async[a47_0x49a2ad(0x11d)](_0xe4814a){const _0x4b951b=a47_0x49a2ad,_0x31f1b7=_0x4b951b(0x157)+crypto_1[_0x4b951b(0x12e)][_0x4b951b(0x12d)](0x20)[_0x4b951b(0x11b)](_0x4b951b(0x14d)),_0x614a8=_0x4b951b(0x146)+crypto_1[_0x4b951b(0x12e)][_0x4b951b(0x12d)](0x20)[_0x4b951b(0x11b)]('hex');await database_1[_0x4b951b(0x12e)][_0x4b951b(0x143)][_0x4b951b(0x14a)]({'where':{'id':_0xe4814a},'data':{'publicKey':_0x31f1b7,'secretKey':_0x614a8}});}async['deleteAccount'](_0x236517,_0x493704){const _0x11a505=a47_0x49a2ad,{passwordConfirmation:_0x2cc447}=_0x493704,_0x2e2256=await database_1[_0x11a505(0x12e)][_0x11a505(0x143)][_0x11a505(0x13c)]({'where':{'id':_0x236517},'select':{'password':!![]}});if(!_0x2e2256)throw new Error(_0x11a505(0x128));const _0x322cf6=await bcryptjs_1[_0x11a505(0x12e)]['compare'](_0x2cc447,_0x2e2256[_0x11a505(0x155)]);if(!_0x322cf6)throw new Error(_0x11a505(0x13d));await database_1[_0x11a505(0x12e)]['shop'][_0x11a505(0x14c)]({'where':{'id':_0x236517}});}async[a47_0x49a2ad(0x11c)](_0x1853dd){const _0x309b0f=a47_0x49a2ad,_0x6326f9=await database_1['default']['shopSettings']['findUnique']({'where':{'shopId':_0x1853dd}});!_0x6326f9&&await database_1['default'][_0x309b0f(0x145)][_0x309b0f(0x14e)]({'data':{'shopId':_0x1853dd}});}}exports['SettingsService']=SettingsService;