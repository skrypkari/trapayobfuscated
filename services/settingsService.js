'use strict';const a55_0x5e60e6=a55_0x42a4;function a55_0x42a4(_0x689ed8,_0x3f2f32){const _0x543ba7=a55_0x543b();return a55_0x42a4=function(_0x42a4b4,_0x320ce8){_0x42a4b4=_0x42a4b4-0x151;let _0x4ee1d0=_0x543ba7[_0x42a4b4];return _0x4ee1d0;},a55_0x42a4(_0x689ed8,_0x3f2f32);}(function(_0x88aace,_0x572e0a){const _0x567705=a55_0x42a4,_0x50c862=_0x88aace();while(!![]){try{const _0x2500a2=parseInt(_0x567705(0x160))/0x1+parseInt(_0x567705(0x18c))/0x2+parseInt(_0x567705(0x176))/0x3*(parseInt(_0x567705(0x18d))/0x4)+parseInt(_0x567705(0x177))/0x5*(-parseInt(_0x567705(0x166))/0x6)+-parseInt(_0x567705(0x15a))/0x7*(-parseInt(_0x567705(0x167))/0x8)+parseInt(_0x567705(0x152))/0x9+parseInt(_0x567705(0x187))/0xa*(-parseInt(_0x567705(0x169))/0xb);if(_0x2500a2===_0x572e0a)break;else _0x50c862['push'](_0x50c862['shift']());}catch(_0x47e2d4){_0x50c862['push'](_0x50c862['shift']());}}}(a55_0x543b,0x29076));var __importDefault=this&&this[a55_0x5e60e6(0x154)]||function(_0x163ce3){const _0x1218d8=a55_0x5e60e6;return _0x163ce3&&_0x163ce3[_0x1218d8(0x159)]?_0x163ce3:{'default':_0x163ce3};};Object['defineProperty'](exports,a55_0x5e60e6(0x159),{'value':!![]}),exports[a55_0x5e60e6(0x17b)]=void 0x0;function a55_0x543b(){const _0x47e197=['delete','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','hash','notificationRefund','6QwbOVt','744928RBqxSE','notificationApiError','11Qhubrv','maskApiKey','telegramChatId','payout','sk_','../config/database','toString','deleteAccount','create','findUnique','name','shopUrl','getShopSettings','9imuQnI','525485XzhpgX','Password\x20confirmation\x20is\x20incorrect','length','randomBytes','SettingsService','bcryptjs','webhookUrl','default','payment_success','notificationPaymentSuccess','shop','compare','ensureSettingsExist','api_error','string','botApiKey','3753530rkgZkH','Shop\x20not\x20found','telegramBotApiKey','login','pk_','286416jHJhuS','142412hEJKWQ','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','webhookEvents','update','updateNotifications','23670eAYQAj','Current\x20password\x20is\x20incorrect','__importDefault','chatId','hex','shopSettings','updateWebhookSettings','__esModule','7ecTvwN','refund','password','isArray','parseWebhookEvents','updateTelegramSettings','302741jxnFST','notificationPaymentFailed'];a55_0x543b=function(){return _0x47e197;};return a55_0x543b();}const bcryptjs_1=__importDefault(require(a55_0x5e60e6(0x17c))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a55_0x5e60e6(0x16e)));class SettingsService{[a55_0x5e60e6(0x16a)](_0x51fb38){const _0x34534e=a55_0x5e60e6;if(!_0x51fb38)return'';if(_0x51fb38[_0x34534e(0x179)]<=0x8)return _0x51fb38;const _0x1ce559=_0x51fb38['substring'](0x0,0x8),_0x24e0f8='*'['repeat'](Math['max'](0x0,_0x51fb38[_0x34534e(0x179)]-0x8));return _0x1ce559+_0x24e0f8;}[a55_0x5e60e6(0x15e)](_0x5a1c19){const _0x1c9107=a55_0x5e60e6;if(!_0x5a1c19)return[];if(Array[_0x1c9107(0x15d)](_0x5a1c19))return _0x5a1c19;if(typeof _0x5a1c19===_0x1c9107(0x185))try{const _0x199887=JSON['parse'](_0x5a1c19);return Array[_0x1c9107(0x15d)](_0x199887)?_0x199887:[];}catch{return[];}return[];}async[a55_0x5e60e6(0x175)](_0x57b2b2){const _0x22b6ae=a55_0x5e60e6,_0x30cadb=await database_1['default']['shop']['findUnique']({'where':{'id':_0x57b2b2},'include':{'settings':!![]}});if(!_0x30cadb)throw new Error(_0x22b6ae(0x188));let _0x25aabf=_0x30cadb['settings'];return!_0x25aabf&&(_0x25aabf=await database_1[_0x22b6ae(0x17e)]['shopSettings'][_0x22b6ae(0x171)]({'data':{'shopId':_0x30cadb['id']}})),{'fullName':_0x30cadb[_0x22b6ae(0x173)],'brand':_0x30cadb[_0x22b6ae(0x173)],'merchantUrl':_0x30cadb[_0x22b6ae(0x174)],'telegramUsername':_0x30cadb['telegram'],'telegramBotApiKey':_0x25aabf['telegramBotApiKey']?this[_0x22b6ae(0x16a)](_0x25aabf['telegramBotApiKey']):null,'telegramChatId':_0x25aabf[_0x22b6ae(0x16b)],'webhookUrl':_0x25aabf['webhookUrl'],'webhookEvents':this[_0x22b6ae(0x15e)](_0x25aabf[_0x22b6ae(0x18f)]),'notifications':{'payment_success':_0x25aabf['notificationPaymentSuccess'],'payment_failed':_0x25aabf[_0x22b6ae(0x161)],'refund':_0x25aabf['notificationRefund'],'payout':_0x25aabf['notificationPayout'],'login':_0x25aabf['notificationLogin'],'api_error':_0x25aabf[_0x22b6ae(0x168)]}};}async['changePassword'](_0x249d08,_0x253ced){const _0x45f2bd=a55_0x5e60e6,{currentPassword:_0x3e69fb,newPassword:_0x1efa0b,confirmNewPassword:_0x7e5bdb}=_0x253ced;if(_0x1efa0b!==_0x7e5bdb)throw new Error(_0x45f2bd(0x163));if(_0x1efa0b[_0x45f2bd(0x179)]<0x6)throw new Error(_0x45f2bd(0x18e));const _0x3aa3e5=await database_1['default']['shop'][_0x45f2bd(0x172)]({'where':{'id':_0x249d08},'select':{'password':!![]}});if(!_0x3aa3e5)throw new Error(_0x45f2bd(0x188));const _0x5a5670=await bcryptjs_1[_0x45f2bd(0x17e)]['compare'](_0x3e69fb,_0x3aa3e5['password']);if(!_0x5a5670)throw new Error(_0x45f2bd(0x153));const _0x361fad=await bcryptjs_1[_0x45f2bd(0x17e)][_0x45f2bd(0x164)](_0x1efa0b,0xc);await database_1[_0x45f2bd(0x17e)][_0x45f2bd(0x181)][_0x45f2bd(0x190)]({'where':{'id':_0x249d08},'data':{'password':_0x361fad}});}async[a55_0x5e60e6(0x151)](_0x272b28,_0xdb314){const _0x2c709f=a55_0x5e60e6;await this[_0x2c709f(0x183)](_0x272b28);const _0x11ecc5={};_0xdb314[_0x2c709f(0x17f)]!==undefined&&(_0x11ecc5[_0x2c709f(0x180)]=_0xdb314['payment_success']),_0xdb314['payment_failed']!==undefined&&(_0x11ecc5['notificationPaymentFailed']=_0xdb314['payment_failed']),_0xdb314[_0x2c709f(0x15b)]!==undefined&&(_0x11ecc5[_0x2c709f(0x165)]=_0xdb314[_0x2c709f(0x15b)]),_0xdb314[_0x2c709f(0x16c)]!==undefined&&(_0x11ecc5['notificationPayout']=_0xdb314['payout']),_0xdb314[_0x2c709f(0x18a)]!==undefined&&(_0x11ecc5['notificationLogin']=_0xdb314[_0x2c709f(0x18a)]),_0xdb314[_0x2c709f(0x184)]!==undefined&&(_0x11ecc5[_0x2c709f(0x168)]=_0xdb314['api_error']),await database_1[_0x2c709f(0x17e)][_0x2c709f(0x157)][_0x2c709f(0x190)]({'where':{'shopId':_0x272b28},'data':_0x11ecc5});}async[a55_0x5e60e6(0x15f)](_0x555ca1,_0x1a76a9){const _0x1af535=a55_0x5e60e6;await this['ensureSettingsExist'](_0x555ca1);const _0x19eb65={};_0x1a76a9[_0x1af535(0x186)]!==undefined&&(_0x19eb65[_0x1af535(0x189)]=_0x1a76a9[_0x1af535(0x186)]||null),_0x1a76a9['chatId']!==undefined&&(_0x19eb65[_0x1af535(0x16b)]=_0x1a76a9[_0x1af535(0x155)]||null),await database_1[_0x1af535(0x17e)][_0x1af535(0x157)]['update']({'where':{'shopId':_0x555ca1},'data':_0x19eb65});}async[a55_0x5e60e6(0x158)](_0x18189b,_0x27fed5){const _0x3cf2b1=a55_0x5e60e6;await this[_0x3cf2b1(0x183)](_0x18189b);const _0x2f344f={};_0x27fed5[_0x3cf2b1(0x17d)]!==undefined&&(_0x2f344f[_0x3cf2b1(0x17d)]=_0x27fed5[_0x3cf2b1(0x17d)]||null),_0x27fed5[_0x3cf2b1(0x18f)]!==undefined&&(_0x2f344f[_0x3cf2b1(0x18f)]=_0x27fed5[_0x3cf2b1(0x18f)]||[]),await database_1[_0x3cf2b1(0x17e)]['shopSettings'][_0x3cf2b1(0x190)]({'where':{'shopId':_0x18189b},'data':_0x2f344f});}async['revokeAllApiKeys'](_0xdbc5e1){const _0x3169c9=a55_0x5e60e6,_0x54d566=_0x3169c9(0x18b)+crypto_1['default'][_0x3169c9(0x17a)](0x20)[_0x3169c9(0x16f)](_0x3169c9(0x156)),_0x16da1b=_0x3169c9(0x16d)+crypto_1[_0x3169c9(0x17e)][_0x3169c9(0x17a)](0x20)[_0x3169c9(0x16f)](_0x3169c9(0x156));await database_1['default'][_0x3169c9(0x181)][_0x3169c9(0x190)]({'where':{'id':_0xdbc5e1},'data':{'publicKey':_0x54d566,'secretKey':_0x16da1b}});}async[a55_0x5e60e6(0x170)](_0x5c7af6,_0x1c7ab2){const _0x42a4d7=a55_0x5e60e6,{passwordConfirmation:_0x2ea685}=_0x1c7ab2,_0xc4320f=await database_1[_0x42a4d7(0x17e)][_0x42a4d7(0x181)][_0x42a4d7(0x172)]({'where':{'id':_0x5c7af6},'select':{'password':!![]}});if(!_0xc4320f)throw new Error(_0x42a4d7(0x188));const _0x184018=await bcryptjs_1[_0x42a4d7(0x17e)][_0x42a4d7(0x182)](_0x2ea685,_0xc4320f[_0x42a4d7(0x15c)]);if(!_0x184018)throw new Error(_0x42a4d7(0x178));await database_1['default']['shop'][_0x42a4d7(0x162)]({'where':{'id':_0x5c7af6}});}async[a55_0x5e60e6(0x183)](_0x33a03e){const _0x2c89a8=a55_0x5e60e6,_0x1f1abd=await database_1['default'][_0x2c89a8(0x157)]['findUnique']({'where':{'shopId':_0x33a03e}});!_0x1f1abd&&await database_1[_0x2c89a8(0x17e)][_0x2c89a8(0x157)][_0x2c89a8(0x171)]({'data':{'shopId':_0x33a03e}});}}exports[a55_0x5e60e6(0x17b)]=SettingsService;