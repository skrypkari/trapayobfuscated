'use strict';function a64_0x8c15(_0x137541,_0xef8b27){const _0xdedeee=a64_0xdede();return a64_0x8c15=function(_0x8c1593,_0x9cb80c){_0x8c1593=_0x8c1593-0x109;let _0xf4b193=_0xdedeee[_0x8c1593];return _0xf4b193;},a64_0x8c15(_0x137541,_0xef8b27);}const a64_0x13f7fa=a64_0x8c15;(function(_0x437038,_0x3473a4){const _0x872ae0=a64_0x8c15,_0x589987=_0x437038();while(!![]){try{const _0x2483c6=parseInt(_0x872ae0(0x146))/0x1+parseInt(_0x872ae0(0x133))/0x2*(-parseInt(_0x872ae0(0x137))/0x3)+-parseInt(_0x872ae0(0x121))/0x4*(-parseInt(_0x872ae0(0x13d))/0x5)+-parseInt(_0x872ae0(0x11e))/0x6+-parseInt(_0x872ae0(0x119))/0x7*(-parseInt(_0x872ae0(0x13f))/0x8)+-parseInt(_0x872ae0(0x11d))/0x9*(-parseInt(_0x872ae0(0x13e))/0xa)+-parseInt(_0x872ae0(0x11b))/0xb*(parseInt(_0x872ae0(0x128))/0xc);if(_0x2483c6===_0x3473a4)break;else _0x589987['push'](_0x589987['shift']());}catch(_0x33c9ac){_0x589987['push'](_0x589987['shift']());}}}(a64_0xdede,0xc382b));var __importDefault=this&&this[a64_0x13f7fa(0x115)]||function(_0x134ee3){const _0x5e6a09=a64_0x13f7fa;return _0x134ee3&&_0x134ee3[_0x5e6a09(0x127)]?_0x134ee3:{'default':_0x134ee3};};Object['defineProperty'](exports,a64_0x13f7fa(0x127),{'value':!![]}),exports[a64_0x13f7fa(0x114)]=void 0x0;const bcryptjs_1=__importDefault(require(a64_0x13f7fa(0x12c))),crypto_1=__importDefault(require(a64_0x13f7fa(0x130))),database_1=__importDefault(require(a64_0x13f7fa(0x14e)));function a64_0xdede(){const _0x5edd63=['notificationPaymentSuccess','../config/database','api_error','settings','webhookUrl','Current\x20password\x20is\x20incorrect','hex','notificationRefund','name','maskApiKey','repeat','shop','telegramChatId','SettingsService','__importDefault','payout','payment_failed','botApiKey','91NkZBCx','changePassword','11xqTopZ','Shop\x20not\x20found','9thGFJP','2276898LVAGFy','parse','getShopSettings','1853828YpsqTx','refund','toString','length','revokeAllApiKeys','ensureSettingsExist','__esModule','4367844fmscCO','login','shopSettings','notificationLogin','bcryptjs','create','telegram','update','crypto','updateNotifications','payment_success','1545368JQhWgj','substring','parseWebhookEvents','isArray','3ahCLbt','shopUrl','telegramBotApiKey','string','default','randomBytes','5ZDQMpH','560750rTFCiz','183800FHrzNZ','notificationApiError','Password\x20confirmation\x20is\x20incorrect','webhookEvents','password','notificationPaymentFailed','deleteAccount','1498758dCumUj','updateWebhookSettings','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','findUnique','sk_','notificationPayout','pk_'];a64_0xdede=function(){return _0x5edd63;};return a64_0xdede();}class SettingsService{[a64_0x13f7fa(0x110)](_0x5b9eb5){const _0x41ea3b=a64_0x13f7fa;if(!_0x5b9eb5)return'';if(_0x5b9eb5['length']<=0x8)return _0x5b9eb5;const _0x537081=_0x5b9eb5[_0x41ea3b(0x134)](0x0,0x8),_0x371e8c='*'[_0x41ea3b(0x111)](Math['max'](0x0,_0x5b9eb5[_0x41ea3b(0x124)]-0x8));return _0x537081+_0x371e8c;}[a64_0x13f7fa(0x135)](_0x92f2c9){const _0x327ed6=a64_0x13f7fa;if(!_0x92f2c9)return[];if(Array[_0x327ed6(0x136)](_0x92f2c9))return _0x92f2c9;if(typeof _0x92f2c9===_0x327ed6(0x13a))try{const _0x2b0811=JSON[_0x327ed6(0x11f)](_0x92f2c9);return Array[_0x327ed6(0x136)](_0x2b0811)?_0x2b0811:[];}catch{return[];}return[];}async[a64_0x13f7fa(0x120)](_0x3c0a38){const _0x3b4cb2=a64_0x13f7fa,_0x23909c=await database_1[_0x3b4cb2(0x13b)][_0x3b4cb2(0x112)][_0x3b4cb2(0x149)]({'where':{'id':_0x3c0a38},'include':{'settings':!![]}});if(!_0x23909c)throw new Error(_0x3b4cb2(0x11c));let _0x418196=_0x23909c[_0x3b4cb2(0x10a)];return!_0x418196&&(_0x418196=await database_1[_0x3b4cb2(0x13b)][_0x3b4cb2(0x12a)][_0x3b4cb2(0x12d)]({'data':{'shopId':_0x23909c['id']}})),{'fullName':_0x23909c['name'],'brand':_0x23909c[_0x3b4cb2(0x10f)],'merchantUrl':_0x23909c[_0x3b4cb2(0x138)],'telegramUsername':_0x23909c[_0x3b4cb2(0x12e)],'telegramBotApiKey':_0x418196[_0x3b4cb2(0x139)]?this[_0x3b4cb2(0x110)](_0x418196[_0x3b4cb2(0x139)]):null,'telegramChatId':_0x418196[_0x3b4cb2(0x113)],'webhookUrl':_0x418196['webhookUrl'],'webhookEvents':this[_0x3b4cb2(0x135)](_0x418196['webhookEvents']),'notifications':{'payment_success':_0x418196[_0x3b4cb2(0x14d)],'payment_failed':_0x418196[_0x3b4cb2(0x144)],'refund':_0x418196[_0x3b4cb2(0x10e)],'payout':_0x418196[_0x3b4cb2(0x14b)],'login':_0x418196[_0x3b4cb2(0x12b)],'api_error':_0x418196[_0x3b4cb2(0x140)]}};}async[a64_0x13f7fa(0x11a)](_0x357c59,_0x31aa62){const _0x1778d7=a64_0x13f7fa,{currentPassword:_0x143d01,newPassword:_0x393f78,confirmNewPassword:_0x4ce243}=_0x31aa62;if(_0x393f78!==_0x4ce243)throw new Error(_0x1778d7(0x148));if(_0x393f78[_0x1778d7(0x124)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x223a8d=await database_1['default'][_0x1778d7(0x112)][_0x1778d7(0x149)]({'where':{'id':_0x357c59},'select':{'password':!![]}});if(!_0x223a8d)throw new Error(_0x1778d7(0x11c));const _0x4027c3=await bcryptjs_1['default']['compare'](_0x143d01,_0x223a8d[_0x1778d7(0x143)]);if(!_0x4027c3)throw new Error(_0x1778d7(0x10c));const _0x530f7f=await bcryptjs_1[_0x1778d7(0x13b)]['hash'](_0x393f78,0xc);await database_1[_0x1778d7(0x13b)][_0x1778d7(0x112)]['update']({'where':{'id':_0x357c59},'data':{'password':_0x530f7f}});}async[a64_0x13f7fa(0x131)](_0x55eb1b,_0x47821b){const _0x3f1c53=a64_0x13f7fa;await this[_0x3f1c53(0x126)](_0x55eb1b);const _0x40cbf4={};_0x47821b[_0x3f1c53(0x132)]!==undefined&&(_0x40cbf4[_0x3f1c53(0x14d)]=_0x47821b[_0x3f1c53(0x132)]),_0x47821b['payment_failed']!==undefined&&(_0x40cbf4[_0x3f1c53(0x144)]=_0x47821b[_0x3f1c53(0x117)]),_0x47821b[_0x3f1c53(0x122)]!==undefined&&(_0x40cbf4[_0x3f1c53(0x10e)]=_0x47821b[_0x3f1c53(0x122)]),_0x47821b[_0x3f1c53(0x116)]!==undefined&&(_0x40cbf4[_0x3f1c53(0x14b)]=_0x47821b[_0x3f1c53(0x116)]),_0x47821b[_0x3f1c53(0x129)]!==undefined&&(_0x40cbf4[_0x3f1c53(0x12b)]=_0x47821b[_0x3f1c53(0x129)]),_0x47821b[_0x3f1c53(0x109)]!==undefined&&(_0x40cbf4[_0x3f1c53(0x140)]=_0x47821b[_0x3f1c53(0x109)]),await database_1['default'][_0x3f1c53(0x12a)][_0x3f1c53(0x12f)]({'where':{'shopId':_0x55eb1b},'data':_0x40cbf4});}async['updateTelegramSettings'](_0x493774,_0x1bd698){const _0x5c2ed7=a64_0x13f7fa;await this[_0x5c2ed7(0x126)](_0x493774);const _0x2bd61a={};_0x1bd698[_0x5c2ed7(0x118)]!==undefined&&(_0x2bd61a[_0x5c2ed7(0x139)]=_0x1bd698[_0x5c2ed7(0x118)]||null),_0x1bd698['chatId']!==undefined&&(_0x2bd61a[_0x5c2ed7(0x113)]=_0x1bd698['chatId']||null),await database_1[_0x5c2ed7(0x13b)][_0x5c2ed7(0x12a)][_0x5c2ed7(0x12f)]({'where':{'shopId':_0x493774},'data':_0x2bd61a});}async[a64_0x13f7fa(0x147)](_0x708c32,_0x516551){const _0xf23640=a64_0x13f7fa;await this[_0xf23640(0x126)](_0x708c32);const _0x5400b2={};_0x516551['webhookUrl']!==undefined&&(_0x5400b2[_0xf23640(0x10b)]=_0x516551[_0xf23640(0x10b)]||null),_0x516551['webhookEvents']!==undefined&&(_0x5400b2[_0xf23640(0x142)]=_0x516551['webhookEvents']||[]),await database_1[_0xf23640(0x13b)][_0xf23640(0x12a)]['update']({'where':{'shopId':_0x708c32},'data':_0x5400b2});}async[a64_0x13f7fa(0x125)](_0x330c84){const _0x5cbcfa=a64_0x13f7fa,_0x299f3c=_0x5cbcfa(0x14c)+crypto_1[_0x5cbcfa(0x13b)][_0x5cbcfa(0x13c)](0x20)[_0x5cbcfa(0x123)](_0x5cbcfa(0x10d)),_0x325af7=_0x5cbcfa(0x14a)+crypto_1['default'][_0x5cbcfa(0x13c)](0x20)[_0x5cbcfa(0x123)](_0x5cbcfa(0x10d));await database_1['default'][_0x5cbcfa(0x112)]['update']({'where':{'id':_0x330c84},'data':{'publicKey':_0x299f3c,'secretKey':_0x325af7}});}async[a64_0x13f7fa(0x145)](_0x1429cb,_0x53f874){const _0x375057=a64_0x13f7fa,{passwordConfirmation:_0x2f1f72}=_0x53f874,_0x40ad0e=await database_1[_0x375057(0x13b)][_0x375057(0x112)][_0x375057(0x149)]({'where':{'id':_0x1429cb},'select':{'password':!![]}});if(!_0x40ad0e)throw new Error('Shop\x20not\x20found');const _0x2022a7=await bcryptjs_1['default']['compare'](_0x2f1f72,_0x40ad0e[_0x375057(0x143)]);if(!_0x2022a7)throw new Error(_0x375057(0x141));await database_1['default'][_0x375057(0x112)]['delete']({'where':{'id':_0x1429cb}});}async[a64_0x13f7fa(0x126)](_0x13a464){const _0x2eeeb7=a64_0x13f7fa,_0x34af1c=await database_1[_0x2eeeb7(0x13b)][_0x2eeeb7(0x12a)][_0x2eeeb7(0x149)]({'where':{'shopId':_0x13a464}});!_0x34af1c&&await database_1[_0x2eeeb7(0x13b)]['shopSettings'][_0x2eeeb7(0x12d)]({'data':{'shopId':_0x13a464}});}}exports[a64_0x13f7fa(0x114)]=SettingsService;