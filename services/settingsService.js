'use strict';const a61_0x2c2faf=a61_0x4de0;(function(_0x542517,_0x32a32e){const _0x31ec6d=a61_0x4de0,_0x552c1c=_0x542517();while(!![]){try{const _0x4eab65=-parseInt(_0x31ec6d(0x215))/0x1+parseInt(_0x31ec6d(0x214))/0x2*(-parseInt(_0x31ec6d(0x22a))/0x3)+-parseInt(_0x31ec6d(0x200))/0x4+parseInt(_0x31ec6d(0x227))/0x5*(parseInt(_0x31ec6d(0x216))/0x6)+-parseInt(_0x31ec6d(0x20b))/0x7*(-parseInt(_0x31ec6d(0x210))/0x8)+-parseInt(_0x31ec6d(0x219))/0x9*(parseInt(_0x31ec6d(0x1f3))/0xa)+-parseInt(_0x31ec6d(0x217))/0xb*(-parseInt(_0x31ec6d(0x21f))/0xc);if(_0x4eab65===_0x32a32e)break;else _0x552c1c['push'](_0x552c1c['shift']());}catch(_0x55672b){_0x552c1c['push'](_0x552c1c['shift']());}}}(a61_0x252e,0xbe0de));function a61_0x4de0(_0x3e10d9,_0x38d629){const _0x252e7b=a61_0x252e();return a61_0x4de0=function(_0x4de033,_0x4c4797){_0x4de033=_0x4de033-0x1f3;let _0x5a1b65=_0x252e7b[_0x4de033];return _0x5a1b65;},a61_0x4de0(_0x3e10d9,_0x38d629);}var __importDefault=this&&this[a61_0x2c2faf(0x203)]||function(_0x3fb8de){const _0x24c97e=a61_0x2c2faf;return _0x3fb8de&&_0x3fb8de[_0x24c97e(0x20f)]?_0x3fb8de:{'default':_0x3fb8de};};Object['defineProperty'](exports,a61_0x2c2faf(0x20f),{'value':!![]}),exports[a61_0x2c2faf(0x211)]=void 0x0;const bcryptjs_1=__importDefault(require(a61_0x2c2faf(0x239))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a61_0x2c2faf(0x205)));function a61_0x252e(){const _0x55542c=['ensureSettingsExist','63EZwWaf','webhookEvents','update','password','__esModule','436680msgHkL','SettingsService','hex','shopUrl','29398pHlRep','649438zcAgdU','6hXDimC','187935saqPUM','api_error','12896379tUmxYX','parseWebhookEvents','notificationRefund','notificationApiError','login','randomBytes','2436eBVnho','updateWebhookSettings','string','refund','pk_','updateTelegramSettings','toString','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','2127715HwUqJj','findUnique','settings','291HSskdU','botApiKey','Current\x20password\x20is\x20incorrect','updateNotifications','shop','length','substring','repeat','getShopSettings','delete','max','compare','revokeAllApiKeys','payment_failed','shopSettings','bcryptjs','10zAceCq','telegramChatId','chatId','name','notificationPaymentFailed','webhookUrl','default','isArray','create','changePassword','hash','telegramBotApiKey','payment_success','393716jzCMYO','notificationPaymentSuccess','Password\x20confirmation\x20is\x20incorrect','__importDefault','telegram','../config/database','notificationLogin','notificationPayout','Shop\x20not\x20found','payout'];a61_0x252e=function(){return _0x55542c;};return a61_0x252e();}class SettingsService{['maskApiKey'](_0x541f28){const _0x4072f5=a61_0x2c2faf;if(!_0x541f28)return'';if(_0x541f28[_0x4072f5(0x22f)]<=0x8)return _0x541f28;const _0xf63cd7=_0x541f28[_0x4072f5(0x230)](0x0,0x8),_0x3e915e='*'[_0x4072f5(0x231)](Math[_0x4072f5(0x234)](0x0,_0x541f28[_0x4072f5(0x22f)]-0x8));return _0xf63cd7+_0x3e915e;}['parseWebhookEvents'](_0x26410){const _0x286a37=a61_0x2c2faf;if(!_0x26410)return[];if(Array[_0x286a37(0x1fa)](_0x26410))return _0x26410;if(typeof _0x26410===_0x286a37(0x221))try{const _0x4cbda3=JSON['parse'](_0x26410);return Array[_0x286a37(0x1fa)](_0x4cbda3)?_0x4cbda3:[];}catch{return[];}return[];}async[a61_0x2c2faf(0x232)](_0x2a0fe5){const _0x37e33d=a61_0x2c2faf,_0x3bd141=await database_1[_0x37e33d(0x1f9)][_0x37e33d(0x22e)][_0x37e33d(0x228)]({'where':{'id':_0x2a0fe5},'include':{'settings':!![]}});if(!_0x3bd141)throw new Error(_0x37e33d(0x208));let _0x2e39cf=_0x3bd141[_0x37e33d(0x229)];return!_0x2e39cf&&(_0x2e39cf=await database_1[_0x37e33d(0x1f9)][_0x37e33d(0x238)][_0x37e33d(0x1fb)]({'data':{'shopId':_0x3bd141['id']}})),{'fullName':_0x3bd141[_0x37e33d(0x1f6)],'brand':_0x3bd141[_0x37e33d(0x1f6)],'merchantUrl':_0x3bd141[_0x37e33d(0x213)],'telegramUsername':_0x3bd141[_0x37e33d(0x204)],'telegramBotApiKey':_0x2e39cf[_0x37e33d(0x1fe)]?this['maskApiKey'](_0x2e39cf[_0x37e33d(0x1fe)]):null,'telegramChatId':_0x2e39cf['telegramChatId'],'webhookUrl':_0x2e39cf[_0x37e33d(0x1f8)],'webhookEvents':this[_0x37e33d(0x21a)](_0x2e39cf[_0x37e33d(0x20c)]),'notifications':{'payment_success':_0x2e39cf[_0x37e33d(0x201)],'payment_failed':_0x2e39cf[_0x37e33d(0x1f7)],'refund':_0x2e39cf['notificationRefund'],'payout':_0x2e39cf[_0x37e33d(0x207)],'login':_0x2e39cf['notificationLogin'],'api_error':_0x2e39cf[_0x37e33d(0x21c)]}};}async[a61_0x2c2faf(0x1fc)](_0x2c818d,_0x4d6670){const _0x12e69e=a61_0x2c2faf,{currentPassword:_0x21f4a3,newPassword:_0x353afe,confirmNewPassword:_0x3b6d8b}=_0x4d6670;if(_0x353afe!==_0x3b6d8b)throw new Error(_0x12e69e(0x226));if(_0x353afe[_0x12e69e(0x22f)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x1be57d=await database_1[_0x12e69e(0x1f9)][_0x12e69e(0x22e)][_0x12e69e(0x228)]({'where':{'id':_0x2c818d},'select':{'password':!![]}});if(!_0x1be57d)throw new Error('Shop\x20not\x20found');const _0x357ca8=await bcryptjs_1[_0x12e69e(0x1f9)][_0x12e69e(0x235)](_0x21f4a3,_0x1be57d[_0x12e69e(0x20e)]);if(!_0x357ca8)throw new Error(_0x12e69e(0x22c));const _0x41177b=await bcryptjs_1['default'][_0x12e69e(0x1fd)](_0x353afe,0xc);await database_1['default'][_0x12e69e(0x22e)][_0x12e69e(0x20d)]({'where':{'id':_0x2c818d},'data':{'password':_0x41177b}});}async[a61_0x2c2faf(0x22d)](_0x326b64,_0x1c0930){const _0x492831=a61_0x2c2faf;await this[_0x492831(0x20a)](_0x326b64);const _0x389b72={};_0x1c0930[_0x492831(0x1ff)]!==undefined&&(_0x389b72[_0x492831(0x201)]=_0x1c0930[_0x492831(0x1ff)]),_0x1c0930[_0x492831(0x237)]!==undefined&&(_0x389b72['notificationPaymentFailed']=_0x1c0930[_0x492831(0x237)]),_0x1c0930[_0x492831(0x222)]!==undefined&&(_0x389b72[_0x492831(0x21b)]=_0x1c0930[_0x492831(0x222)]),_0x1c0930[_0x492831(0x209)]!==undefined&&(_0x389b72[_0x492831(0x207)]=_0x1c0930['payout']),_0x1c0930[_0x492831(0x21d)]!==undefined&&(_0x389b72[_0x492831(0x206)]=_0x1c0930[_0x492831(0x21d)]),_0x1c0930[_0x492831(0x218)]!==undefined&&(_0x389b72[_0x492831(0x21c)]=_0x1c0930[_0x492831(0x218)]),await database_1[_0x492831(0x1f9)][_0x492831(0x238)][_0x492831(0x20d)]({'where':{'shopId':_0x326b64},'data':_0x389b72});}async[a61_0x2c2faf(0x224)](_0x2dd87f,_0xb3800e){const _0x59a55a=a61_0x2c2faf;await this[_0x59a55a(0x20a)](_0x2dd87f);const _0xff9570={};_0xb3800e[_0x59a55a(0x22b)]!==undefined&&(_0xff9570[_0x59a55a(0x1fe)]=_0xb3800e[_0x59a55a(0x22b)]||null),_0xb3800e['chatId']!==undefined&&(_0xff9570[_0x59a55a(0x1f4)]=_0xb3800e[_0x59a55a(0x1f5)]||null),await database_1['default'][_0x59a55a(0x238)][_0x59a55a(0x20d)]({'where':{'shopId':_0x2dd87f},'data':_0xff9570});}async[a61_0x2c2faf(0x220)](_0x3b1303,_0x24834e){const _0x5771ef=a61_0x2c2faf;await this[_0x5771ef(0x20a)](_0x3b1303);const _0x4846f1={};_0x24834e[_0x5771ef(0x1f8)]!==undefined&&(_0x4846f1[_0x5771ef(0x1f8)]=_0x24834e['webhookUrl']||null),_0x24834e[_0x5771ef(0x20c)]!==undefined&&(_0x4846f1[_0x5771ef(0x20c)]=_0x24834e[_0x5771ef(0x20c)]||[]),await database_1['default'][_0x5771ef(0x238)]['update']({'where':{'shopId':_0x3b1303},'data':_0x4846f1});}async[a61_0x2c2faf(0x236)](_0x526aae){const _0x1a5e7c=a61_0x2c2faf,_0x51fc10=_0x1a5e7c(0x223)+crypto_1[_0x1a5e7c(0x1f9)][_0x1a5e7c(0x21e)](0x20)[_0x1a5e7c(0x225)]('hex'),_0x590ebb='sk_'+crypto_1[_0x1a5e7c(0x1f9)][_0x1a5e7c(0x21e)](0x20)[_0x1a5e7c(0x225)](_0x1a5e7c(0x212));await database_1[_0x1a5e7c(0x1f9)][_0x1a5e7c(0x22e)][_0x1a5e7c(0x20d)]({'where':{'id':_0x526aae},'data':{'publicKey':_0x51fc10,'secretKey':_0x590ebb}});}async['deleteAccount'](_0x55573a,_0x5ac3ef){const _0x52fd97=a61_0x2c2faf,{passwordConfirmation:_0x4b134a}=_0x5ac3ef,_0x20b573=await database_1[_0x52fd97(0x1f9)][_0x52fd97(0x22e)][_0x52fd97(0x228)]({'where':{'id':_0x55573a},'select':{'password':!![]}});if(!_0x20b573)throw new Error('Shop\x20not\x20found');const _0xf84601=await bcryptjs_1[_0x52fd97(0x1f9)]['compare'](_0x4b134a,_0x20b573[_0x52fd97(0x20e)]);if(!_0xf84601)throw new Error(_0x52fd97(0x202));await database_1['default'][_0x52fd97(0x22e)][_0x52fd97(0x233)]({'where':{'id':_0x55573a}});}async['ensureSettingsExist'](_0x4dc98e){const _0x2a9ec2=a61_0x2c2faf,_0x302143=await database_1['default']['shopSettings']['findUnique']({'where':{'shopId':_0x4dc98e}});!_0x302143&&await database_1[_0x2a9ec2(0x1f9)][_0x2a9ec2(0x238)]['create']({'data':{'shopId':_0x4dc98e}});}}exports[a61_0x2c2faf(0x211)]=SettingsService;