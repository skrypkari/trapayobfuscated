'use strict';const a72_0x245b56=a72_0x2e53;(function(_0x504d2b,_0x510311){const _0x24007e=a72_0x2e53,_0x4b0bd3=_0x504d2b();while(!![]){try{const _0x1f0663=parseInt(_0x24007e(0x113))/0x1+-parseInt(_0x24007e(0x109))/0x2+-parseInt(_0x24007e(0xe5))/0x3*(parseInt(_0x24007e(0x114))/0x4)+parseInt(_0x24007e(0x10e))/0x5+parseInt(_0x24007e(0x104))/0x6*(parseInt(_0x24007e(0xe8))/0x7)+-parseInt(_0x24007e(0xe0))/0x8*(parseInt(_0x24007e(0xfd))/0x9)+-parseInt(_0x24007e(0xe3))/0xa*(parseInt(_0x24007e(0x11b))/0xb);if(_0x1f0663===_0x510311)break;else _0x4b0bd3['push'](_0x4b0bd3['shift']());}catch(_0xadc6dd){_0x4b0bd3['push'](_0x4b0bd3['shift']());}}}(a72_0x3b7e,0xd7eac));function a72_0x2e53(_0x4e2198,_0x302803){_0x4e2198=_0x4e2198-0xde;const _0x3b7e1e=a72_0x3b7e();let _0x2e530b=_0x3b7e1e[_0x4e2198];return _0x2e530b;}var __importDefault=this&&this['__importDefault']||function(_0x5874d5){const _0x411cc1=a72_0x2e53;return _0x5874d5&&_0x5874d5[_0x411cc1(0x10c)]?_0x5874d5:{'default':_0x5874d5};};Object[a72_0x245b56(0x116)](exports,a72_0x245b56(0x10c),{'value':!![]}),exports[a72_0x245b56(0x102)]=void 0x0;function a72_0x3b7e(){const _0x1d3b61=['__esModule','pk_','8345615ETslIR','maskApiKey','webhookEvents','hex','compare','1250168WbyeFm','69512nqqUUs','crypto','defineProperty','payout','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','findUnique','bcryptjs','104379PPIGDV','sk_','telegramChatId','updateTelegramSettings','notificationLogin','Shop\x20not\x20found','hash','updateWebhookSettings','revokeAllApiKeys','8kTuHKt','settings','Current\x20password\x20is\x20incorrect','2360dQYFGM','notificationPaymentSuccess','3ZXFgnW','refund','api_error','28CsRPDm','parseWebhookEvents','max','../config/database','default','notificationRefund','updateNotifications','repeat','getShopSettings','botApiKey','payment_failed','login','toString','telegramBotApiKey','notificationApiError','length','isArray','webhookUrl','notificationPayout','update','delete','3762711IAXjnv','create','name','randomBytes','chatId','SettingsService','telegram','1558326egfHrb','shopSettings','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','payment_success','notificationPaymentFailed','797836SewHfn','ensureSettingsExist','shop'];a72_0x3b7e=function(){return _0x1d3b61;};return a72_0x3b7e();}const bcryptjs_1=__importDefault(require(a72_0x245b56(0x11a))),crypto_1=__importDefault(require(a72_0x245b56(0x115))),database_1=__importDefault(require(a72_0x245b56(0xeb)));class SettingsService{[a72_0x245b56(0x10f)](_0x1a8a93){const _0x2a0c85=a72_0x245b56;if(!_0x1a8a93)return'';if(_0x1a8a93[_0x2a0c85(0xf7)]<=0x8)return _0x1a8a93;const _0xd5fbaa=_0x1a8a93['substring'](0x0,0x8),_0x1484b7='*'[_0x2a0c85(0xef)](Math[_0x2a0c85(0xea)](0x0,_0x1a8a93['length']-0x8));return _0xd5fbaa+_0x1484b7;}[a72_0x245b56(0xe9)](_0x5232ce){const _0x4b2987=a72_0x245b56;if(!_0x5232ce)return[];if(Array[_0x4b2987(0xf8)](_0x5232ce))return _0x5232ce;if(typeof _0x5232ce==='string')try{const _0x899be0=JSON['parse'](_0x5232ce);return Array[_0x4b2987(0xf8)](_0x899be0)?_0x899be0:[];}catch{return[];}return[];}async[a72_0x245b56(0xf0)](_0x2d69f1){const _0x1479d2=a72_0x245b56,_0x51c80b=await database_1[_0x1479d2(0xec)][_0x1479d2(0x10b)][_0x1479d2(0x119)]({'where':{'id':_0x2d69f1},'include':{'settings':!![]}});if(!_0x51c80b)throw new Error(_0x1479d2(0x120));let _0x43794e=_0x51c80b[_0x1479d2(0xe1)];return!_0x43794e&&(_0x43794e=await database_1[_0x1479d2(0xec)]['shopSettings'][_0x1479d2(0xfe)]({'data':{'shopId':_0x51c80b['id']}})),{'fullName':_0x51c80b[_0x1479d2(0xff)],'brand':_0x51c80b[_0x1479d2(0xff)],'merchantUrl':_0x51c80b['shopUrl'],'telegramUsername':_0x51c80b[_0x1479d2(0x103)],'telegramBotApiKey':_0x43794e[_0x1479d2(0xf5)]?this[_0x1479d2(0x10f)](_0x43794e['telegramBotApiKey']):null,'telegramChatId':_0x43794e[_0x1479d2(0x11d)],'webhookUrl':_0x43794e['webhookUrl'],'webhookEvents':this[_0x1479d2(0xe9)](_0x43794e['webhookEvents']),'notifications':{'payment_success':_0x43794e[_0x1479d2(0xe4)],'payment_failed':_0x43794e[_0x1479d2(0x108)],'refund':_0x43794e[_0x1479d2(0xed)],'payout':_0x43794e[_0x1479d2(0xfa)],'login':_0x43794e[_0x1479d2(0x11f)],'api_error':_0x43794e[_0x1479d2(0xf6)]}};}async['changePassword'](_0x594e29,_0x4d1417){const _0xbf563c=a72_0x245b56,{currentPassword:_0x2974b6,newPassword:_0x657697,confirmNewPassword:_0x4110da}=_0x4d1417;if(_0x657697!==_0x4110da)throw new Error(_0xbf563c(0x118));if(_0x657697[_0xbf563c(0xf7)]<0x6)throw new Error(_0xbf563c(0x106));const _0x4ab434=await database_1[_0xbf563c(0xec)][_0xbf563c(0x10b)][_0xbf563c(0x119)]({'where':{'id':_0x594e29},'select':{'password':!![]}});if(!_0x4ab434)throw new Error(_0xbf563c(0x120));const _0x10f7e3=await bcryptjs_1[_0xbf563c(0xec)][_0xbf563c(0x112)](_0x2974b6,_0x4ab434['password']);if(!_0x10f7e3)throw new Error(_0xbf563c(0xe2));const _0x2708a2=await bcryptjs_1[_0xbf563c(0xec)][_0xbf563c(0x121)](_0x657697,0xc);await database_1[_0xbf563c(0xec)][_0xbf563c(0x10b)][_0xbf563c(0xfb)]({'where':{'id':_0x594e29},'data':{'password':_0x2708a2}});}async[a72_0x245b56(0xee)](_0xbf6915,_0x54727d){const _0x3c5481=a72_0x245b56;await this[_0x3c5481(0x10a)](_0xbf6915);const _0x368d2e={};_0x54727d[_0x3c5481(0x107)]!==undefined&&(_0x368d2e['notificationPaymentSuccess']=_0x54727d[_0x3c5481(0x107)]),_0x54727d['payment_failed']!==undefined&&(_0x368d2e[_0x3c5481(0x108)]=_0x54727d[_0x3c5481(0xf2)]),_0x54727d[_0x3c5481(0xe6)]!==undefined&&(_0x368d2e['notificationRefund']=_0x54727d[_0x3c5481(0xe6)]),_0x54727d[_0x3c5481(0x117)]!==undefined&&(_0x368d2e[_0x3c5481(0xfa)]=_0x54727d[_0x3c5481(0x117)]),_0x54727d['login']!==undefined&&(_0x368d2e[_0x3c5481(0x11f)]=_0x54727d[_0x3c5481(0xf3)]),_0x54727d[_0x3c5481(0xe7)]!==undefined&&(_0x368d2e['notificationApiError']=_0x54727d[_0x3c5481(0xe7)]),await database_1[_0x3c5481(0xec)][_0x3c5481(0x105)][_0x3c5481(0xfb)]({'where':{'shopId':_0xbf6915},'data':_0x368d2e});}async[a72_0x245b56(0x11e)](_0x20e51b,_0x14aaf6){const _0x10dcbb=a72_0x245b56;await this[_0x10dcbb(0x10a)](_0x20e51b);const _0x4328a0={};_0x14aaf6[_0x10dcbb(0xf1)]!==undefined&&(_0x4328a0[_0x10dcbb(0xf5)]=_0x14aaf6['botApiKey']||null),_0x14aaf6[_0x10dcbb(0x101)]!==undefined&&(_0x4328a0[_0x10dcbb(0x11d)]=_0x14aaf6[_0x10dcbb(0x101)]||null),await database_1['default'][_0x10dcbb(0x105)]['update']({'where':{'shopId':_0x20e51b},'data':_0x4328a0});}async[a72_0x245b56(0xde)](_0x21b548,_0x2ff69d){const _0x51924d=a72_0x245b56;await this['ensureSettingsExist'](_0x21b548);const _0xa382ec={};_0x2ff69d['webhookUrl']!==undefined&&(_0xa382ec[_0x51924d(0xf9)]=_0x2ff69d['webhookUrl']||null),_0x2ff69d['webhookEvents']!==undefined&&(_0xa382ec[_0x51924d(0x110)]=_0x2ff69d[_0x51924d(0x110)]||[]),await database_1[_0x51924d(0xec)]['shopSettings'][_0x51924d(0xfb)]({'where':{'shopId':_0x21b548},'data':_0xa382ec});}async[a72_0x245b56(0xdf)](_0x33a1ba){const _0x41b678=a72_0x245b56,_0x59cfab=_0x41b678(0x10d)+crypto_1['default'][_0x41b678(0x100)](0x20)[_0x41b678(0xf4)](_0x41b678(0x111)),_0x555c0f=_0x41b678(0x11c)+crypto_1[_0x41b678(0xec)][_0x41b678(0x100)](0x20)[_0x41b678(0xf4)](_0x41b678(0x111));await database_1[_0x41b678(0xec)][_0x41b678(0x10b)][_0x41b678(0xfb)]({'where':{'id':_0x33a1ba},'data':{'publicKey':_0x59cfab,'secretKey':_0x555c0f}});}async['deleteAccount'](_0x4debdb,_0x300bf1){const _0x421ec9=a72_0x245b56,{passwordConfirmation:_0x5ea34e}=_0x300bf1,_0x3f39c2=await database_1[_0x421ec9(0xec)][_0x421ec9(0x10b)][_0x421ec9(0x119)]({'where':{'id':_0x4debdb},'select':{'password':!![]}});if(!_0x3f39c2)throw new Error(_0x421ec9(0x120));const _0x589641=await bcryptjs_1[_0x421ec9(0xec)][_0x421ec9(0x112)](_0x5ea34e,_0x3f39c2['password']);if(!_0x589641)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x421ec9(0xec)][_0x421ec9(0x10b)][_0x421ec9(0xfc)]({'where':{'id':_0x4debdb}});}async[a72_0x245b56(0x10a)](_0x17c87a){const _0xd35a0e=a72_0x245b56,_0x91ca1d=await database_1[_0xd35a0e(0xec)][_0xd35a0e(0x105)][_0xd35a0e(0x119)]({'where':{'shopId':_0x17c87a}});!_0x91ca1d&&await database_1[_0xd35a0e(0xec)][_0xd35a0e(0x105)][_0xd35a0e(0xfe)]({'data':{'shopId':_0x17c87a}});}}exports[a72_0x245b56(0x102)]=SettingsService;