'use strict';function a52_0x1240(){const _0xc95d4d=['20473872czSerx','substring','randomBytes','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','4Uswuwl','maskApiKey','updateWebhookSettings','isArray','parse','notificationPayout','revokeAllApiKeys','payout','settings','botApiKey','refund','default','pk_','payment_failed','ensureSettingsExist','hex','Current\x20password\x20is\x20incorrect','__importDefault','1852346VMSZQX','payment_success','Shop\x20not\x20found','SettingsService','update','compare','delete','shop','findUnique','telegramBotApiKey','string','name','changePassword','crypto','Password\x20confirmation\x20is\x20incorrect','webhookUrl','sk_','defineProperty','shopSettings','bcryptjs','notificationLogin','hash','telegram','notificationApiError','api_error','8231650yQNusw','shopUrl','2243855AEjBFS','webhookEvents','password','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','notificationPaymentFailed','notificationRefund','login','parseWebhookEvents','create','110948tALMpt','toString','2889426orljAO','9rdoQPB','length','2904732LCZtQY','chatId','updateTelegramSettings','telegramChatId'];a52_0x1240=function(){return _0xc95d4d;};return a52_0x1240();}function a52_0x3122(_0xb7becb,_0x370838){const _0x12409f=a52_0x1240();return a52_0x3122=function(_0x312208,_0x584747){_0x312208=_0x312208-0x123;let _0x1a6225=_0x12409f[_0x312208];return _0x1a6225;},a52_0x3122(_0xb7becb,_0x370838);}const a52_0x46a856=a52_0x3122;(function(_0x21c14b,_0x44991d){const _0x22a433=a52_0x3122,_0x5c4c33=_0x21c14b();while(!![]){try{const _0x19df23=parseInt(_0x22a433(0x154))/0x1+parseInt(_0x22a433(0x130))/0x2+parseInt(_0x22a433(0x159))/0x3+parseInt(_0x22a433(0x161))/0x4*(parseInt(_0x22a433(0x14b))/0x5)+-parseInt(_0x22a433(0x156))/0x6+parseInt(_0x22a433(0x149))/0x7+-parseInt(_0x22a433(0x15d))/0x8*(parseInt(_0x22a433(0x157))/0x9);if(_0x19df23===_0x44991d)break;else _0x5c4c33['push'](_0x5c4c33['shift']());}catch(_0x202c28){_0x5c4c33['push'](_0x5c4c33['shift']());}}}(a52_0x1240,0x8fde1));var __importDefault=this&&this[a52_0x46a856(0x12f)]||function(_0x129f83){return _0x129f83&&_0x129f83['__esModule']?_0x129f83:{'default':_0x129f83};};Object[a52_0x46a856(0x141)](exports,'__esModule',{'value':!![]}),exports[a52_0x46a856(0x133)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x46a856(0x143))),crypto_1=__importDefault(require(a52_0x46a856(0x13d))),database_1=__importDefault(require('../config/database'));class SettingsService{[a52_0x46a856(0x162)](_0x3d5a85){const _0x5a5d46=a52_0x46a856;if(!_0x3d5a85)return'';if(_0x3d5a85[_0x5a5d46(0x158)]<=0x8)return _0x3d5a85;const _0x5a789f=_0x3d5a85[_0x5a5d46(0x15e)](0x0,0x8),_0x5937d9='*'['repeat'](Math['max'](0x0,_0x3d5a85[_0x5a5d46(0x158)]-0x8));return _0x5a789f+_0x5937d9;}[a52_0x46a856(0x152)](_0x46460f){const _0x22ebe4=a52_0x46a856;if(!_0x46460f)return[];if(Array[_0x22ebe4(0x164)](_0x46460f))return _0x46460f;if(typeof _0x46460f===_0x22ebe4(0x13a))try{const _0x52e2ac=JSON[_0x22ebe4(0x165)](_0x46460f);return Array[_0x22ebe4(0x164)](_0x52e2ac)?_0x52e2ac:[];}catch{return[];}return[];}async['getShopSettings'](_0x1afd29){const _0x25f3a2=a52_0x46a856,_0x1c4b16=await database_1['default']['shop'][_0x25f3a2(0x138)]({'where':{'id':_0x1afd29},'include':{'settings':!![]}});if(!_0x1c4b16)throw new Error('Shop\x20not\x20found');let _0x5f4b89=_0x1c4b16[_0x25f3a2(0x126)];return!_0x5f4b89&&(_0x5f4b89=await database_1[_0x25f3a2(0x129)][_0x25f3a2(0x142)][_0x25f3a2(0x153)]({'data':{'shopId':_0x1c4b16['id']}})),{'fullName':_0x1c4b16['name'],'brand':_0x1c4b16[_0x25f3a2(0x13b)],'merchantUrl':_0x1c4b16[_0x25f3a2(0x14a)],'telegramUsername':_0x1c4b16[_0x25f3a2(0x146)],'telegramBotApiKey':_0x5f4b89['telegramBotApiKey']?this[_0x25f3a2(0x162)](_0x5f4b89[_0x25f3a2(0x139)]):null,'telegramChatId':_0x5f4b89[_0x25f3a2(0x15c)],'webhookUrl':_0x5f4b89['webhookUrl'],'webhookEvents':this[_0x25f3a2(0x152)](_0x5f4b89[_0x25f3a2(0x14c)]),'notifications':{'payment_success':_0x5f4b89['notificationPaymentSuccess'],'payment_failed':_0x5f4b89['notificationPaymentFailed'],'refund':_0x5f4b89['notificationRefund'],'payout':_0x5f4b89[_0x25f3a2(0x123)],'login':_0x5f4b89[_0x25f3a2(0x144)],'api_error':_0x5f4b89[_0x25f3a2(0x147)]}};}async[a52_0x46a856(0x13c)](_0x18b275,_0x126207){const _0x61dfd7=a52_0x46a856,{currentPassword:_0x3b2fa0,newPassword:_0x3a4889,confirmNewPassword:_0x3a7034}=_0x126207;if(_0x3a4889!==_0x3a7034)throw new Error(_0x61dfd7(0x160));if(_0x3a4889[_0x61dfd7(0x158)]<0x6)throw new Error(_0x61dfd7(0x14e));const _0x20c041=await database_1[_0x61dfd7(0x129)]['shop']['findUnique']({'where':{'id':_0x18b275},'select':{'password':!![]}});if(!_0x20c041)throw new Error(_0x61dfd7(0x132));const _0x2107e0=await bcryptjs_1[_0x61dfd7(0x129)][_0x61dfd7(0x135)](_0x3b2fa0,_0x20c041[_0x61dfd7(0x14d)]);if(!_0x2107e0)throw new Error(_0x61dfd7(0x12e));const _0x4ddba1=await bcryptjs_1[_0x61dfd7(0x129)][_0x61dfd7(0x145)](_0x3a4889,0xc);await database_1['default'][_0x61dfd7(0x137)][_0x61dfd7(0x134)]({'where':{'id':_0x18b275},'data':{'password':_0x4ddba1}});}async['updateNotifications'](_0x5ca7c3,_0x5e644c){const _0x6b5671=a52_0x46a856;await this[_0x6b5671(0x12c)](_0x5ca7c3);const _0x4745fb={};_0x5e644c[_0x6b5671(0x131)]!==undefined&&(_0x4745fb['notificationPaymentSuccess']=_0x5e644c[_0x6b5671(0x131)]),_0x5e644c[_0x6b5671(0x12b)]!==undefined&&(_0x4745fb[_0x6b5671(0x14f)]=_0x5e644c[_0x6b5671(0x12b)]),_0x5e644c[_0x6b5671(0x128)]!==undefined&&(_0x4745fb[_0x6b5671(0x150)]=_0x5e644c[_0x6b5671(0x128)]),_0x5e644c[_0x6b5671(0x125)]!==undefined&&(_0x4745fb[_0x6b5671(0x123)]=_0x5e644c[_0x6b5671(0x125)]),_0x5e644c[_0x6b5671(0x151)]!==undefined&&(_0x4745fb[_0x6b5671(0x144)]=_0x5e644c[_0x6b5671(0x151)]),_0x5e644c[_0x6b5671(0x148)]!==undefined&&(_0x4745fb[_0x6b5671(0x147)]=_0x5e644c[_0x6b5671(0x148)]),await database_1['default']['shopSettings'][_0x6b5671(0x134)]({'where':{'shopId':_0x5ca7c3},'data':_0x4745fb});}async[a52_0x46a856(0x15b)](_0x2ad703,_0x37dfda){const _0x1e7a63=a52_0x46a856;await this['ensureSettingsExist'](_0x2ad703);const _0xd28543={};_0x37dfda[_0x1e7a63(0x127)]!==undefined&&(_0xd28543[_0x1e7a63(0x139)]=_0x37dfda['botApiKey']||null),_0x37dfda[_0x1e7a63(0x15a)]!==undefined&&(_0xd28543[_0x1e7a63(0x15c)]=_0x37dfda['chatId']||null),await database_1['default']['shopSettings'][_0x1e7a63(0x134)]({'where':{'shopId':_0x2ad703},'data':_0xd28543});}async[a52_0x46a856(0x163)](_0x91cbd1,_0x56af46){const _0xac8653=a52_0x46a856;await this[_0xac8653(0x12c)](_0x91cbd1);const _0x66c857={};_0x56af46[_0xac8653(0x13f)]!==undefined&&(_0x66c857[_0xac8653(0x13f)]=_0x56af46[_0xac8653(0x13f)]||null),_0x56af46[_0xac8653(0x14c)]!==undefined&&(_0x66c857[_0xac8653(0x14c)]=_0x56af46[_0xac8653(0x14c)]||[]),await database_1[_0xac8653(0x129)][_0xac8653(0x142)][_0xac8653(0x134)]({'where':{'shopId':_0x91cbd1},'data':_0x66c857});}async[a52_0x46a856(0x124)](_0x49e68a){const _0xc45bd4=a52_0x46a856,_0x59e329=_0xc45bd4(0x12a)+crypto_1[_0xc45bd4(0x129)]['randomBytes'](0x20)[_0xc45bd4(0x155)](_0xc45bd4(0x12d)),_0x5a8fda=_0xc45bd4(0x140)+crypto_1[_0xc45bd4(0x129)][_0xc45bd4(0x15f)](0x20)[_0xc45bd4(0x155)]('hex');await database_1[_0xc45bd4(0x129)][_0xc45bd4(0x137)][_0xc45bd4(0x134)]({'where':{'id':_0x49e68a},'data':{'publicKey':_0x59e329,'secretKey':_0x5a8fda}});}async['deleteAccount'](_0x327c3a,_0x5f28aa){const _0x5492a8=a52_0x46a856,{passwordConfirmation:_0x4123dc}=_0x5f28aa,_0x3272b7=await database_1[_0x5492a8(0x129)][_0x5492a8(0x137)][_0x5492a8(0x138)]({'where':{'id':_0x327c3a},'select':{'password':!![]}});if(!_0x3272b7)throw new Error('Shop\x20not\x20found');const _0x24b401=await bcryptjs_1['default'][_0x5492a8(0x135)](_0x4123dc,_0x3272b7['password']);if(!_0x24b401)throw new Error(_0x5492a8(0x13e));await database_1[_0x5492a8(0x129)]['shop'][_0x5492a8(0x136)]({'where':{'id':_0x327c3a}});}async[a52_0x46a856(0x12c)](_0x5e4636){const _0xdee1cc=a52_0x46a856,_0x41322e=await database_1[_0xdee1cc(0x129)][_0xdee1cc(0x142)]['findUnique']({'where':{'shopId':_0x5e4636}});!_0x41322e&&await database_1['default']['shopSettings']['create']({'data':{'shopId':_0x5e4636}});}}exports[a52_0x46a856(0x133)]=SettingsService;