'use strict';function a51_0x3181(){const _0x5dbd55=['shop','password','name','notificationRefund','deleteAccount','pk_','20TUGAjX','5519241HQUsJF','parse','notificationPayout','Password\x20confirmation\x20is\x20incorrect','3231436JdTdUT','274IqoDKY','login','updateNotifications','4346796acOcnU','compare','webhookEvents','92172ICEFvS','chatId','substring','telegram','botApiKey','default','telegramChatId','max','randomBytes','payout','payment_failed','payment_success','settings','defineProperty','revokeAllApiKeys','toString','SettingsService','notificationPaymentSuccess','update','parseWebhookEvents','18GgqLCV','sk_','Shop\x20not\x20found','3650122ikQvem','__esModule','string','Current\x20password\x20is\x20incorrect','getShopSettings','isArray','notificationPaymentFailed','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','notificationLogin','webhookUrl','notificationApiError','updateWebhookSettings','21259820akZNce','api_error','telegramBotApiKey','16NpHLIM','length','shopSettings','ensureSettingsExist','shopUrl','findUnique','repeat','refund','hex','maskApiKey','changePassword'];a51_0x3181=function(){return _0x5dbd55;};return a51_0x3181();}function a51_0x4694(_0x5dabb2,_0x25caa4){const _0x3181bb=a51_0x3181();return a51_0x4694=function(_0x469410,_0x343263){_0x469410=_0x469410-0xad;let _0x823e39=_0x3181bb[_0x469410];return _0x823e39;},a51_0x4694(_0x5dabb2,_0x25caa4);}const a51_0x4e8898=a51_0x4694;(function(_0x5c8644,_0x2fff29){const _0x48f2d0=a51_0x4694,_0x57d8cb=_0x5c8644();while(!![]){try{const _0x48b6aa=-parseInt(_0x48f2d0(0xba))/0x1*(parseInt(_0x48f2d0(0xe3))/0x2)+-parseInt(_0x48f2d0(0xe6))/0x3+parseInt(_0x48f2d0(0xe2))/0x4+parseInt(_0x48f2d0(0xdd))/0x5*(parseInt(_0x48f2d0(0xe9))/0x6)+parseInt(_0x48f2d0(0xbd))/0x7+parseInt(_0x48f2d0(0xcc))/0x8*(-parseInt(_0x48f2d0(0xde))/0x9)+parseInt(_0x48f2d0(0xc9))/0xa;if(_0x48b6aa===_0x2fff29)break;else _0x57d8cb['push'](_0x57d8cb['shift']());}catch(_0x548636){_0x57d8cb['push'](_0x57d8cb['shift']());}}}(a51_0x3181,0xcccb7));var __importDefault=this&&this['__importDefault']||function(_0x1f5233){const _0x534dde=a51_0x4694;return _0x1f5233&&_0x1f5233[_0x534dde(0xbe)]?_0x1f5233:{'default':_0x1f5233};};Object[a51_0x4e8898(0xb3)](exports,'__esModule',{'value':!![]}),exports[a51_0x4e8898(0xb6)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));class SettingsService{[a51_0x4e8898(0xd5)](_0x40934c){const _0x2be554=a51_0x4e8898;if(!_0x40934c)return'';if(_0x40934c['length']<=0x8)return _0x40934c;const _0x5a7907=_0x40934c[_0x2be554(0xeb)](0x0,0x8),_0x286911='*'[_0x2be554(0xd2)](Math[_0x2be554(0xad)](0x0,_0x40934c[_0x2be554(0xcd)]-0x8));return _0x5a7907+_0x286911;}[a51_0x4e8898(0xb9)](_0xc1a61b){const _0x3c0a14=a51_0x4e8898;if(!_0xc1a61b)return[];if(Array[_0x3c0a14(0xc2)](_0xc1a61b))return _0xc1a61b;if(typeof _0xc1a61b===_0x3c0a14(0xbf))try{const _0x5d020e=JSON[_0x3c0a14(0xdf)](_0xc1a61b);return Array[_0x3c0a14(0xc2)](_0x5d020e)?_0x5d020e:[];}catch{return[];}return[];}async[a51_0x4e8898(0xc1)](_0xcb51d0){const _0x565101=a51_0x4e8898,_0x30b50b=await database_1[_0x565101(0xee)][_0x565101(0xd7)][_0x565101(0xd1)]({'where':{'id':_0xcb51d0},'include':{'settings':!![]}});if(!_0x30b50b)throw new Error(_0x565101(0xbc));let _0x2ea1c7=_0x30b50b[_0x565101(0xb2)];return!_0x2ea1c7&&(_0x2ea1c7=await database_1['default'][_0x565101(0xce)]['create']({'data':{'shopId':_0x30b50b['id']}})),{'fullName':_0x30b50b['name'],'brand':_0x30b50b[_0x565101(0xd9)],'merchantUrl':_0x30b50b[_0x565101(0xd0)],'telegramUsername':_0x30b50b[_0x565101(0xec)],'telegramBotApiKey':_0x2ea1c7[_0x565101(0xcb)]?this[_0x565101(0xd5)](_0x2ea1c7[_0x565101(0xcb)]):null,'telegramChatId':_0x2ea1c7[_0x565101(0xef)],'webhookUrl':_0x2ea1c7[_0x565101(0xc6)],'webhookEvents':this[_0x565101(0xb9)](_0x2ea1c7[_0x565101(0xe8)]),'notifications':{'payment_success':_0x2ea1c7[_0x565101(0xb7)],'payment_failed':_0x2ea1c7[_0x565101(0xc3)],'refund':_0x2ea1c7[_0x565101(0xda)],'payout':_0x2ea1c7[_0x565101(0xe0)],'login':_0x2ea1c7[_0x565101(0xc5)],'api_error':_0x2ea1c7['notificationApiError']}};}async[a51_0x4e8898(0xd6)](_0x2a9d33,_0x13cc9a){const _0x330014=a51_0x4e8898,{currentPassword:_0x3a7efd,newPassword:_0x298e41,confirmNewPassword:_0x1632db}=_0x13cc9a;if(_0x298e41!==_0x1632db)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x298e41['length']<0x6)throw new Error(_0x330014(0xc4));const _0x1d2976=await database_1[_0x330014(0xee)]['shop'][_0x330014(0xd1)]({'where':{'id':_0x2a9d33},'select':{'password':!![]}});if(!_0x1d2976)throw new Error(_0x330014(0xbc));const _0x1287c3=await bcryptjs_1['default'][_0x330014(0xe7)](_0x3a7efd,_0x1d2976[_0x330014(0xd8)]);if(!_0x1287c3)throw new Error(_0x330014(0xc0));const _0x1c3f24=await bcryptjs_1['default']['hash'](_0x298e41,0xc);await database_1['default'][_0x330014(0xd7)][_0x330014(0xb8)]({'where':{'id':_0x2a9d33},'data':{'password':_0x1c3f24}});}async[a51_0x4e8898(0xe5)](_0x26366c,_0x5728bf){const _0x150297=a51_0x4e8898;await this[_0x150297(0xcf)](_0x26366c);const _0x330512={};_0x5728bf[_0x150297(0xb1)]!==undefined&&(_0x330512['notificationPaymentSuccess']=_0x5728bf[_0x150297(0xb1)]),_0x5728bf[_0x150297(0xb0)]!==undefined&&(_0x330512[_0x150297(0xc3)]=_0x5728bf[_0x150297(0xb0)]),_0x5728bf[_0x150297(0xd3)]!==undefined&&(_0x330512[_0x150297(0xda)]=_0x5728bf['refund']),_0x5728bf[_0x150297(0xaf)]!==undefined&&(_0x330512[_0x150297(0xe0)]=_0x5728bf[_0x150297(0xaf)]),_0x5728bf['login']!==undefined&&(_0x330512[_0x150297(0xc5)]=_0x5728bf[_0x150297(0xe4)]),_0x5728bf[_0x150297(0xca)]!==undefined&&(_0x330512[_0x150297(0xc7)]=_0x5728bf[_0x150297(0xca)]),await database_1[_0x150297(0xee)][_0x150297(0xce)][_0x150297(0xb8)]({'where':{'shopId':_0x26366c},'data':_0x330512});}async['updateTelegramSettings'](_0x39a9c8,_0x35c63e){const _0x4842c2=a51_0x4e8898;await this['ensureSettingsExist'](_0x39a9c8);const _0x495a44={};_0x35c63e[_0x4842c2(0xed)]!==undefined&&(_0x495a44[_0x4842c2(0xcb)]=_0x35c63e[_0x4842c2(0xed)]||null),_0x35c63e[_0x4842c2(0xea)]!==undefined&&(_0x495a44[_0x4842c2(0xef)]=_0x35c63e[_0x4842c2(0xea)]||null),await database_1['default'][_0x4842c2(0xce)][_0x4842c2(0xb8)]({'where':{'shopId':_0x39a9c8},'data':_0x495a44});}async[a51_0x4e8898(0xc8)](_0x883adc,_0x27ef0c){const _0x419d3a=a51_0x4e8898;await this['ensureSettingsExist'](_0x883adc);const _0x4ed32a={};_0x27ef0c[_0x419d3a(0xc6)]!==undefined&&(_0x4ed32a[_0x419d3a(0xc6)]=_0x27ef0c[_0x419d3a(0xc6)]||null),_0x27ef0c[_0x419d3a(0xe8)]!==undefined&&(_0x4ed32a[_0x419d3a(0xe8)]=_0x27ef0c['webhookEvents']||[]),await database_1[_0x419d3a(0xee)]['shopSettings'][_0x419d3a(0xb8)]({'where':{'shopId':_0x883adc},'data':_0x4ed32a});}async[a51_0x4e8898(0xb4)](_0x93ab49){const _0xcd2e6e=a51_0x4e8898,_0x3c6c97=_0xcd2e6e(0xdc)+crypto_1[_0xcd2e6e(0xee)][_0xcd2e6e(0xae)](0x20)['toString'](_0xcd2e6e(0xd4)),_0x26bdaa=_0xcd2e6e(0xbb)+crypto_1[_0xcd2e6e(0xee)][_0xcd2e6e(0xae)](0x20)[_0xcd2e6e(0xb5)]('hex');await database_1[_0xcd2e6e(0xee)]['shop'][_0xcd2e6e(0xb8)]({'where':{'id':_0x93ab49},'data':{'publicKey':_0x3c6c97,'secretKey':_0x26bdaa}});}async[a51_0x4e8898(0xdb)](_0x25a2a9,_0x10b4c8){const _0x271235=a51_0x4e8898,{passwordConfirmation:_0x25c97c}=_0x10b4c8,_0x2bb100=await database_1[_0x271235(0xee)][_0x271235(0xd7)][_0x271235(0xd1)]({'where':{'id':_0x25a2a9},'select':{'password':!![]}});if(!_0x2bb100)throw new Error(_0x271235(0xbc));const _0x42e1b8=await bcryptjs_1[_0x271235(0xee)]['compare'](_0x25c97c,_0x2bb100[_0x271235(0xd8)]);if(!_0x42e1b8)throw new Error(_0x271235(0xe1));await database_1[_0x271235(0xee)][_0x271235(0xd7)]['delete']({'where':{'id':_0x25a2a9}});}async[a51_0x4e8898(0xcf)](_0x2d9cd4){const _0x403a74=a51_0x4e8898,_0x5ab91f=await database_1[_0x403a74(0xee)][_0x403a74(0xce)][_0x403a74(0xd1)]({'where':{'shopId':_0x2d9cd4}});!_0x5ab91f&&await database_1[_0x403a74(0xee)]['shopSettings']['create']({'data':{'shopId':_0x2d9cd4}});}}exports[a51_0x4e8898(0xb6)]=SettingsService;