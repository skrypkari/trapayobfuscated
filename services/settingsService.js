'use strict';const a53_0x182960=a53_0x29ba;function a53_0x29ba(_0x5e848b,_0x574e20){const _0x46da00=a53_0x46da();return a53_0x29ba=function(_0x29ba6c,_0x5c8388){_0x29ba6c=_0x29ba6c-0xf0;let _0x8ce840=_0x46da00[_0x29ba6c];return _0x8ce840;},a53_0x29ba(_0x5e848b,_0x574e20);}function a53_0x46da(){const _0x1ce17b=['telegramChatId','notificationPaymentSuccess','refund','payout','18YuTDGv','toString','payment_failed','update','updateTelegramSettings','delete','hash','notificationLogin','Shop\x20not\x20found','notificationPaymentFailed','1024730rpnRUU','shopUrl','__esModule','repeat','sk_','207992IZjgwu','name','compare','SettingsService','5548560HzBxek','21yuNgKm','settings','default','login','ensureSettingsExist','4460UqdXGi','updateWebhookSettings','Password\x20confirmation\x20is\x20incorrect','bcryptjs','pk_','telegramBotApiKey','max','33708LUACaL','password','botApiKey','../config/database','hex','create','deleteAccount','notificationApiError','payment_success','randomBytes','shop','webhookUrl','crypto','api_error','317011OvswQN','length','getShopSettings','776qGpLsp','notificationPayout','notificationRefund','substring','string','revokeAllApiKeys','isArray','parse','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','1553454ehluAW','chatId','webhookEvents','parseWebhookEvents','__importDefault','shopSettings','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','maskApiKey','updateNotifications','changePassword','findUnique'];a53_0x46da=function(){return _0x1ce17b;};return a53_0x46da();}(function(_0x5a5a84,_0x557daa){const _0x352831=a53_0x29ba,_0x670332=_0x5a5a84();while(!![]){try{const _0x3e63ca=parseInt(_0x352831(0x12b))/0x1+-parseInt(_0x352831(0x11d))/0x2*(-parseInt(_0x352831(0x111))/0x3)+-parseInt(_0x352831(0x12e))/0x4*(parseInt(_0x352831(0x116))/0x5)+parseInt(_0x352831(0x137))/0x6+parseInt(_0x352831(0x107))/0x7+parseInt(_0x352831(0x10c))/0x8*(parseInt(_0x352831(0xfd))/0x9)+-parseInt(_0x352831(0x110))/0xa;if(_0x3e63ca===_0x557daa)break;else _0x670332['push'](_0x670332['shift']());}catch(_0x357185){_0x670332['push'](_0x670332['shift']());}}}(a53_0x46da,0x2821e));var __importDefault=this&&this[a53_0x182960(0xf2)]||function(_0x4d73d4){const _0xaaeaaf=a53_0x182960;return _0x4d73d4&&_0x4d73d4[_0xaaeaaf(0x109)]?_0x4d73d4:{'default':_0x4d73d4};};Object['defineProperty'](exports,a53_0x182960(0x109),{'value':!![]}),exports[a53_0x182960(0x10f)]=void 0x0;const bcryptjs_1=__importDefault(require(a53_0x182960(0x119))),crypto_1=__importDefault(require(a53_0x182960(0x129))),database_1=__importDefault(require(a53_0x182960(0x120)));class SettingsService{[a53_0x182960(0xf5)](_0x444f80){const _0x50e1d4=a53_0x182960;if(!_0x444f80)return'';if(_0x444f80[_0x50e1d4(0x12c)]<=0x8)return _0x444f80;const _0x518359=_0x444f80[_0x50e1d4(0x131)](0x0,0x8),_0x30af64='*'[_0x50e1d4(0x10a)](Math[_0x50e1d4(0x11c)](0x0,_0x444f80[_0x50e1d4(0x12c)]-0x8));return _0x518359+_0x30af64;}['parseWebhookEvents'](_0x34b987){const _0x2f05e7=a53_0x182960;if(!_0x34b987)return[];if(Array[_0x2f05e7(0x134)](_0x34b987))return _0x34b987;if(typeof _0x34b987===_0x2f05e7(0x132))try{const _0x326f80=JSON[_0x2f05e7(0x135)](_0x34b987);return Array[_0x2f05e7(0x134)](_0x326f80)?_0x326f80:[];}catch{return[];}return[];}async[a53_0x182960(0x12d)](_0x257813){const _0x3d7ac0=a53_0x182960,_0x32de1d=await database_1[_0x3d7ac0(0x113)][_0x3d7ac0(0x127)]['findUnique']({'where':{'id':_0x257813},'include':{'settings':!![]}});if(!_0x32de1d)throw new Error(_0x3d7ac0(0x105));let _0x124a50=_0x32de1d[_0x3d7ac0(0x112)];return!_0x124a50&&(_0x124a50=await database_1['default'][_0x3d7ac0(0xf3)]['create']({'data':{'shopId':_0x32de1d['id']}})),{'fullName':_0x32de1d[_0x3d7ac0(0x10d)],'brand':_0x32de1d[_0x3d7ac0(0x10d)],'merchantUrl':_0x32de1d[_0x3d7ac0(0x108)],'telegramUsername':_0x32de1d['telegram'],'telegramBotApiKey':_0x124a50[_0x3d7ac0(0x11b)]?this['maskApiKey'](_0x124a50[_0x3d7ac0(0x11b)]):null,'telegramChatId':_0x124a50[_0x3d7ac0(0xf9)],'webhookUrl':_0x124a50['webhookUrl'],'webhookEvents':this[_0x3d7ac0(0xf1)](_0x124a50['webhookEvents']),'notifications':{'payment_success':_0x124a50[_0x3d7ac0(0xfa)],'payment_failed':_0x124a50[_0x3d7ac0(0x106)],'refund':_0x124a50['notificationRefund'],'payout':_0x124a50[_0x3d7ac0(0x12f)],'login':_0x124a50[_0x3d7ac0(0x104)],'api_error':_0x124a50[_0x3d7ac0(0x124)]}};}async[a53_0x182960(0xf7)](_0x532c4c,_0x32a884){const _0x293337=a53_0x182960,{currentPassword:_0x33de4a,newPassword:_0x298b03,confirmNewPassword:_0x2d644}=_0x32a884;if(_0x298b03!==_0x2d644)throw new Error(_0x293337(0x136));if(_0x298b03[_0x293337(0x12c)]<0x6)throw new Error(_0x293337(0xf4));const _0x135f2c=await database_1[_0x293337(0x113)]['shop']['findUnique']({'where':{'id':_0x532c4c},'select':{'password':!![]}});if(!_0x135f2c)throw new Error(_0x293337(0x105));const _0xd032df=await bcryptjs_1[_0x293337(0x113)]['compare'](_0x33de4a,_0x135f2c['password']);if(!_0xd032df)throw new Error('Current\x20password\x20is\x20incorrect');const _0x4fe3b7=await bcryptjs_1[_0x293337(0x113)][_0x293337(0x103)](_0x298b03,0xc);await database_1['default'][_0x293337(0x127)]['update']({'where':{'id':_0x532c4c},'data':{'password':_0x4fe3b7}});}async[a53_0x182960(0xf6)](_0x15baab,_0x32b1aa){const _0x539909=a53_0x182960;await this[_0x539909(0x115)](_0x15baab);const _0x457059={};_0x32b1aa[_0x539909(0x125)]!==undefined&&(_0x457059['notificationPaymentSuccess']=_0x32b1aa[_0x539909(0x125)]),_0x32b1aa[_0x539909(0xff)]!==undefined&&(_0x457059[_0x539909(0x106)]=_0x32b1aa[_0x539909(0xff)]),_0x32b1aa[_0x539909(0xfb)]!==undefined&&(_0x457059[_0x539909(0x130)]=_0x32b1aa[_0x539909(0xfb)]),_0x32b1aa[_0x539909(0xfc)]!==undefined&&(_0x457059[_0x539909(0x12f)]=_0x32b1aa[_0x539909(0xfc)]),_0x32b1aa['login']!==undefined&&(_0x457059[_0x539909(0x104)]=_0x32b1aa[_0x539909(0x114)]),_0x32b1aa[_0x539909(0x12a)]!==undefined&&(_0x457059[_0x539909(0x124)]=_0x32b1aa[_0x539909(0x12a)]),await database_1[_0x539909(0x113)]['shopSettings'][_0x539909(0x100)]({'where':{'shopId':_0x15baab},'data':_0x457059});}async[a53_0x182960(0x101)](_0x378820,_0x28f838){const _0x44fbc7=a53_0x182960;await this['ensureSettingsExist'](_0x378820);const _0x34cee4={};_0x28f838[_0x44fbc7(0x11f)]!==undefined&&(_0x34cee4['telegramBotApiKey']=_0x28f838[_0x44fbc7(0x11f)]||null),_0x28f838[_0x44fbc7(0x138)]!==undefined&&(_0x34cee4['telegramChatId']=_0x28f838[_0x44fbc7(0x138)]||null),await database_1[_0x44fbc7(0x113)]['shopSettings']['update']({'where':{'shopId':_0x378820},'data':_0x34cee4});}async[a53_0x182960(0x117)](_0x9fcff6,_0x21bc8e){const _0xc2ca34=a53_0x182960;await this[_0xc2ca34(0x115)](_0x9fcff6);const _0x19223c={};_0x21bc8e[_0xc2ca34(0x128)]!==undefined&&(_0x19223c['webhookUrl']=_0x21bc8e[_0xc2ca34(0x128)]||null),_0x21bc8e[_0xc2ca34(0xf0)]!==undefined&&(_0x19223c[_0xc2ca34(0xf0)]=_0x21bc8e[_0xc2ca34(0xf0)]||[]),await database_1[_0xc2ca34(0x113)][_0xc2ca34(0xf3)][_0xc2ca34(0x100)]({'where':{'shopId':_0x9fcff6},'data':_0x19223c});}async[a53_0x182960(0x133)](_0x11be8a){const _0x4f85a8=a53_0x182960,_0x3a9144=_0x4f85a8(0x11a)+crypto_1['default'][_0x4f85a8(0x126)](0x20)[_0x4f85a8(0xfe)]('hex'),_0x321052=_0x4f85a8(0x10b)+crypto_1[_0x4f85a8(0x113)][_0x4f85a8(0x126)](0x20)[_0x4f85a8(0xfe)](_0x4f85a8(0x121));await database_1[_0x4f85a8(0x113)][_0x4f85a8(0x127)][_0x4f85a8(0x100)]({'where':{'id':_0x11be8a},'data':{'publicKey':_0x3a9144,'secretKey':_0x321052}});}async[a53_0x182960(0x123)](_0x12d901,_0x491267){const _0x44d06f=a53_0x182960,{passwordConfirmation:_0x44ab63}=_0x491267,_0x37b0a0=await database_1[_0x44d06f(0x113)]['shop']['findUnique']({'where':{'id':_0x12d901},'select':{'password':!![]}});if(!_0x37b0a0)throw new Error(_0x44d06f(0x105));const _0x54641c=await bcryptjs_1[_0x44d06f(0x113)][_0x44d06f(0x10e)](_0x44ab63,_0x37b0a0[_0x44d06f(0x11e)]);if(!_0x54641c)throw new Error(_0x44d06f(0x118));await database_1[_0x44d06f(0x113)]['shop'][_0x44d06f(0x102)]({'where':{'id':_0x12d901}});}async[a53_0x182960(0x115)](_0x5c5bab){const _0xc997d2=a53_0x182960,_0x1ba0ac=await database_1[_0xc997d2(0x113)]['shopSettings'][_0xc997d2(0xf8)]({'where':{'shopId':_0x5c5bab}});!_0x1ba0ac&&await database_1[_0xc997d2(0x113)][_0xc997d2(0xf3)][_0xc997d2(0x122)]({'data':{'shopId':_0x5c5bab}});}}exports['SettingsService']=SettingsService;