'use strict';function a47_0xf475(_0x3e7aa8,_0x15625e){const _0x354023=a47_0x3540();return a47_0xf475=function(_0xf4757,_0x2025b2){_0xf4757=_0xf4757-0x11f;let _0x472619=_0x354023[_0xf4757];return _0x472619;},a47_0xf475(_0x3e7aa8,_0x15625e);}const a47_0x307a8a=a47_0xf475;(function(_0x12ddb8,_0xd1a85e){const _0x1ec4f7=a47_0xf475,_0x195aa5=_0x12ddb8();while(!![]){try{const _0x13ab11=-parseInt(_0x1ec4f7(0x139))/0x1+parseInt(_0x1ec4f7(0x12d))/0x2*(parseInt(_0x1ec4f7(0x13f))/0x3)+-parseInt(_0x1ec4f7(0x137))/0x4+parseInt(_0x1ec4f7(0x15b))/0x5*(-parseInt(_0x1ec4f7(0x157))/0x6)+-parseInt(_0x1ec4f7(0x146))/0x7+-parseInt(_0x1ec4f7(0x150))/0x8+parseInt(_0x1ec4f7(0x12c))/0x9;if(_0x13ab11===_0xd1a85e)break;else _0x195aa5['push'](_0x195aa5['shift']());}catch(_0x3642f6){_0x195aa5['push'](_0x195aa5['shift']());}}}(a47_0x3540,0x82669));function a47_0x3540(){const _0x40b867=['ensureSettingsExist','string','isArray','update','webhookEvents','name','delete','pk_','password','findUnique','length','notificationLogin','__importDefault','create','hex','webhookUrl','30266145UUUEmG','2698eITPPK','updateNotifications','payout','parseWebhookEvents','hash','default','Shop\x20not\x20found','__esModule','refund','updateWebhookSettings','4129480MEJxTe','getShopSettings','784926uBxNnm','../config/database','maskApiKey','notificationRefund','telegramBotApiKey','notificationPaymentFailed','669obxNlB','login','randomBytes','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','chatId','payment_success','deleteAccount','4068820blbcTi','parse','Current\x20password\x20is\x20incorrect','notificationPaymentSuccess','revokeAllApiKeys','Password\x20confirmation\x20is\x20incorrect','compare','payment_failed','shop','defineProperty','5621728mIyxYc','api_error','shopSettings','crypto','botApiKey','telegramChatId','sk_','102clygbP','notificationApiError','bcryptjs','SettingsService','8335mOgFcs','toString','notificationPayout'];a47_0x3540=function(){return _0x40b867;};return a47_0x3540();}var __importDefault=this&&this[a47_0x307a8a(0x128)]||function(_0x4de753){const _0x2b23af=a47_0x307a8a;return _0x4de753&&_0x4de753[_0x2b23af(0x134)]?_0x4de753:{'default':_0x4de753};};Object[a47_0x307a8a(0x14f)](exports,a47_0x307a8a(0x134),{'value':!![]}),exports[a47_0x307a8a(0x15a)]=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x307a8a(0x159))),crypto_1=__importDefault(require(a47_0x307a8a(0x153))),database_1=__importDefault(require(a47_0x307a8a(0x13a)));class SettingsService{[a47_0x307a8a(0x13b)](_0xec512f){const _0x18019d=a47_0x307a8a;if(!_0xec512f)return'';if(_0xec512f['length']<=0x8)return _0xec512f;const _0x5a13a9=_0xec512f['substring'](0x0,0x8),_0x3e6430='*'['repeat'](Math['max'](0x0,_0xec512f[_0x18019d(0x126)]-0x8));return _0x5a13a9+_0x3e6430;}[a47_0x307a8a(0x130)](_0x51c274){const _0x11239a=a47_0x307a8a;if(!_0x51c274)return[];if(Array[_0x11239a(0x160)](_0x51c274))return _0x51c274;if(typeof _0x51c274===_0x11239a(0x15f))try{const _0x57d1b2=JSON[_0x11239a(0x147)](_0x51c274);return Array[_0x11239a(0x160)](_0x57d1b2)?_0x57d1b2:[];}catch{return[];}return[];}async[a47_0x307a8a(0x138)](_0x2da5ce){const _0x4e62aa=a47_0x307a8a,_0x5d8634=await database_1[_0x4e62aa(0x132)][_0x4e62aa(0x14e)][_0x4e62aa(0x125)]({'where':{'id':_0x2da5ce},'include':{'settings':!![]}});if(!_0x5d8634)throw new Error('Shop\x20not\x20found');let _0x289064=_0x5d8634['settings'];return!_0x289064&&(_0x289064=await database_1['default'][_0x4e62aa(0x152)][_0x4e62aa(0x129)]({'data':{'shopId':_0x5d8634['id']}})),{'fullName':_0x5d8634[_0x4e62aa(0x121)],'brand':_0x5d8634[_0x4e62aa(0x121)],'merchantUrl':_0x5d8634['shopUrl'],'telegramUsername':_0x5d8634['telegram'],'telegramBotApiKey':_0x289064['telegramBotApiKey']?this[_0x4e62aa(0x13b)](_0x289064['telegramBotApiKey']):null,'telegramChatId':_0x289064['telegramChatId'],'webhookUrl':_0x289064[_0x4e62aa(0x12b)],'webhookEvents':this[_0x4e62aa(0x130)](_0x289064['webhookEvents']),'notifications':{'payment_success':_0x289064[_0x4e62aa(0x149)],'payment_failed':_0x289064['notificationPaymentFailed'],'refund':_0x289064[_0x4e62aa(0x13c)],'payout':_0x289064[_0x4e62aa(0x15d)],'login':_0x289064[_0x4e62aa(0x127)],'api_error':_0x289064['notificationApiError']}};}async['changePassword'](_0x1e53e5,_0x5902ad){const _0x3ab756=a47_0x307a8a,{currentPassword:_0xc4f03a,newPassword:_0x499036,confirmNewPassword:_0x18ddb7}=_0x5902ad;if(_0x499036!==_0x18ddb7)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x499036['length']<0x6)throw new Error(_0x3ab756(0x142));const _0x191c7f=await database_1[_0x3ab756(0x132)][_0x3ab756(0x14e)][_0x3ab756(0x125)]({'where':{'id':_0x1e53e5},'select':{'password':!![]}});if(!_0x191c7f)throw new Error(_0x3ab756(0x133));const _0x5afeae=await bcryptjs_1[_0x3ab756(0x132)][_0x3ab756(0x14c)](_0xc4f03a,_0x191c7f['password']);if(!_0x5afeae)throw new Error(_0x3ab756(0x148));const _0x3ecf66=await bcryptjs_1[_0x3ab756(0x132)][_0x3ab756(0x131)](_0x499036,0xc);await database_1[_0x3ab756(0x132)]['shop'][_0x3ab756(0x11f)]({'where':{'id':_0x1e53e5},'data':{'password':_0x3ecf66}});}async[a47_0x307a8a(0x12e)](_0x93ebb7,_0x3c5572){const _0x52f94e=a47_0x307a8a;await this[_0x52f94e(0x15e)](_0x93ebb7);const _0x16ffc9={};_0x3c5572['payment_success']!==undefined&&(_0x16ffc9[_0x52f94e(0x149)]=_0x3c5572[_0x52f94e(0x144)]),_0x3c5572[_0x52f94e(0x14d)]!==undefined&&(_0x16ffc9[_0x52f94e(0x13e)]=_0x3c5572['payment_failed']),_0x3c5572['refund']!==undefined&&(_0x16ffc9[_0x52f94e(0x13c)]=_0x3c5572[_0x52f94e(0x135)]),_0x3c5572[_0x52f94e(0x12f)]!==undefined&&(_0x16ffc9['notificationPayout']=_0x3c5572['payout']),_0x3c5572[_0x52f94e(0x140)]!==undefined&&(_0x16ffc9[_0x52f94e(0x127)]=_0x3c5572[_0x52f94e(0x140)]),_0x3c5572[_0x52f94e(0x151)]!==undefined&&(_0x16ffc9[_0x52f94e(0x158)]=_0x3c5572['api_error']),await database_1[_0x52f94e(0x132)][_0x52f94e(0x152)]['update']({'where':{'shopId':_0x93ebb7},'data':_0x16ffc9});}async['updateTelegramSettings'](_0x1a0f83,_0x4ea0e8){const _0x289132=a47_0x307a8a;await this[_0x289132(0x15e)](_0x1a0f83);const _0x5e5fc7={};_0x4ea0e8[_0x289132(0x154)]!==undefined&&(_0x5e5fc7[_0x289132(0x13d)]=_0x4ea0e8['botApiKey']||null),_0x4ea0e8[_0x289132(0x143)]!==undefined&&(_0x5e5fc7[_0x289132(0x155)]=_0x4ea0e8[_0x289132(0x143)]||null),await database_1[_0x289132(0x132)][_0x289132(0x152)][_0x289132(0x11f)]({'where':{'shopId':_0x1a0f83},'data':_0x5e5fc7});}async[a47_0x307a8a(0x136)](_0x20fc66,_0x1bf6a7){const _0x5bf703=a47_0x307a8a;await this[_0x5bf703(0x15e)](_0x20fc66);const _0xe34690={};_0x1bf6a7['webhookUrl']!==undefined&&(_0xe34690[_0x5bf703(0x12b)]=_0x1bf6a7[_0x5bf703(0x12b)]||null),_0x1bf6a7[_0x5bf703(0x120)]!==undefined&&(_0xe34690[_0x5bf703(0x120)]=_0x1bf6a7[_0x5bf703(0x120)]||[]),await database_1[_0x5bf703(0x132)][_0x5bf703(0x152)][_0x5bf703(0x11f)]({'where':{'shopId':_0x20fc66},'data':_0xe34690});}async[a47_0x307a8a(0x14a)](_0x4502db){const _0x223e04=a47_0x307a8a,_0x25f376=_0x223e04(0x123)+crypto_1[_0x223e04(0x132)][_0x223e04(0x141)](0x20)[_0x223e04(0x15c)](_0x223e04(0x12a)),_0x40020d=_0x223e04(0x156)+crypto_1[_0x223e04(0x132)][_0x223e04(0x141)](0x20)['toString'](_0x223e04(0x12a));await database_1[_0x223e04(0x132)][_0x223e04(0x14e)][_0x223e04(0x11f)]({'where':{'id':_0x4502db},'data':{'publicKey':_0x25f376,'secretKey':_0x40020d}});}async[a47_0x307a8a(0x145)](_0x26f13c,_0x38685c){const _0x575ceb=a47_0x307a8a,{passwordConfirmation:_0x264f33}=_0x38685c,_0x4e9c2d=await database_1['default'][_0x575ceb(0x14e)]['findUnique']({'where':{'id':_0x26f13c},'select':{'password':!![]}});if(!_0x4e9c2d)throw new Error(_0x575ceb(0x133));const _0x8731b1=await bcryptjs_1[_0x575ceb(0x132)][_0x575ceb(0x14c)](_0x264f33,_0x4e9c2d[_0x575ceb(0x124)]);if(!_0x8731b1)throw new Error(_0x575ceb(0x14b));await database_1[_0x575ceb(0x132)][_0x575ceb(0x14e)][_0x575ceb(0x122)]({'where':{'id':_0x26f13c}});}async['ensureSettingsExist'](_0x3e322b){const _0x4b35f3=a47_0x307a8a,_0x255bfe=await database_1['default']['shopSettings'][_0x4b35f3(0x125)]({'where':{'shopId':_0x3e322b}});!_0x255bfe&&await database_1['default']['shopSettings'][_0x4b35f3(0x129)]({'data':{'shopId':_0x3e322b}});}}exports[a47_0x307a8a(0x15a)]=SettingsService;