'use strict';const a53_0x3ee733=a53_0x51ad;function a53_0x51ad(_0x5b9ff0,_0x5c67c3){const _0x38fd39=a53_0x38fd();return a53_0x51ad=function(_0x51ad2d,_0x2d49be){_0x51ad2d=_0x51ad2d-0x1aa;let _0x3cdfd1=_0x38fd39[_0x51ad2d];return _0x3cdfd1;},a53_0x51ad(_0x5b9ff0,_0x5c67c3);}(function(_0x54e0b8,_0x4ef616){const _0x89b01d=a53_0x51ad,_0x1b5d8d=_0x54e0b8();while(!![]){try{const _0xe5a9d9=parseInt(_0x89b01d(0x1c8))/0x1+parseInt(_0x89b01d(0x1df))/0x2*(parseInt(_0x89b01d(0x1bd))/0x3)+parseInt(_0x89b01d(0x1bf))/0x4*(parseInt(_0x89b01d(0x1e1))/0x5)+parseInt(_0x89b01d(0x1d0))/0x6*(-parseInt(_0x89b01d(0x1d9))/0x7)+parseInt(_0x89b01d(0x1e3))/0x8*(parseInt(_0x89b01d(0x1cb))/0x9)+-parseInt(_0x89b01d(0x1d4))/0xa*(-parseInt(_0x89b01d(0x1cd))/0xb)+parseInt(_0x89b01d(0x1ef))/0xc*(-parseInt(_0x89b01d(0x1dc))/0xd);if(_0xe5a9d9===_0x4ef616)break;else _0x1b5d8d['push'](_0x1b5d8d['shift']());}catch(_0x53ab33){_0x1b5d8d['push'](_0x1b5d8d['shift']());}}}(a53_0x38fd,0x90cad));var __importDefault=this&&this[a53_0x3ee733(0x1b5)]||function(_0x32ccba){const _0x526f8c=a53_0x3ee733;return _0x32ccba&&_0x32ccba[_0x526f8c(0x1d2)]?_0x32ccba:{'default':_0x32ccba};};Object[a53_0x3ee733(0x1c9)](exports,'__esModule',{'value':!![]}),exports[a53_0x3ee733(0x1e0)]=void 0x0;function a53_0x38fd(){const _0x51803a=['update','26922NHsiEF','payment_success','refund','91tlOEXw','telegramBotApiKey','../config/database','781538sOQkCB','SettingsService','188140lZHrKo','create','15464nNYESM','botApiKey','telegramChatId','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','parse','updateNotifications','shopSettings','parseWebhookEvents','sk_','payment_failed','password','changePassword','1147128NpMbCE','Shop\x20not\x20found','telegram','default','updateWebhookSettings','findUnique','login','revokeAllApiKeys','delete','shop','isArray','notificationRefund','substring','bcryptjs','max','__importDefault','Current\x20password\x20is\x20incorrect','repeat','notificationLogin','toString','notificationApiError','updateTelegramSettings','compare','3WZCdxg','settings','16WPXYrB','maskApiKey','hex','ensureSettingsExist','pk_','webhookUrl','Password\x20confirmation\x20is\x20incorrect','webhookEvents','string','203070jABRVE','defineProperty','notificationPaymentFailed','2529KZOeMv','randomBytes','11KcGPWR','getShopSettings','payout','1284iVpCMS','notificationPaymentSuccess','__esModule','name','7977470FgsMUR','crypto','shopUrl','deleteAccount'];a53_0x38fd=function(){return _0x51803a;};return a53_0x38fd();}const bcryptjs_1=__importDefault(require(a53_0x3ee733(0x1b3))),crypto_1=__importDefault(require(a53_0x3ee733(0x1d5))),database_1=__importDefault(require(a53_0x3ee733(0x1de)));class SettingsService{[a53_0x3ee733(0x1c0)](_0x22207e){const _0x350f95=a53_0x3ee733;if(!_0x22207e)return'';if(_0x22207e['length']<=0x8)return _0x22207e;const _0x16052c=_0x22207e[_0x350f95(0x1b2)](0x0,0x8),_0x5ac50b='*'[_0x350f95(0x1b7)](Math[_0x350f95(0x1b4)](0x0,_0x22207e['length']-0x8));return _0x16052c+_0x5ac50b;}[a53_0x3ee733(0x1ea)](_0x5870df){const _0x132e75=a53_0x3ee733;if(!_0x5870df)return[];if(Array[_0x132e75(0x1b0)](_0x5870df))return _0x5870df;if(typeof _0x5870df===_0x132e75(0x1c7))try{const _0x3d678d=JSON[_0x132e75(0x1e7)](_0x5870df);return Array['isArray'](_0x3d678d)?_0x3d678d:[];}catch{return[];}return[];}async[a53_0x3ee733(0x1ce)](_0x3ea4de){const _0x98232f=a53_0x3ee733,_0x224fd6=await database_1[_0x98232f(0x1f2)][_0x98232f(0x1af)][_0x98232f(0x1ab)]({'where':{'id':_0x3ea4de},'include':{'settings':!![]}});if(!_0x224fd6)throw new Error(_0x98232f(0x1f0));let _0xf52885=_0x224fd6[_0x98232f(0x1be)];return!_0xf52885&&(_0xf52885=await database_1[_0x98232f(0x1f2)][_0x98232f(0x1e9)][_0x98232f(0x1e2)]({'data':{'shopId':_0x224fd6['id']}})),{'fullName':_0x224fd6[_0x98232f(0x1d3)],'brand':_0x224fd6[_0x98232f(0x1d3)],'merchantUrl':_0x224fd6[_0x98232f(0x1d6)],'telegramUsername':_0x224fd6[_0x98232f(0x1f1)],'telegramBotApiKey':_0xf52885['telegramBotApiKey']?this['maskApiKey'](_0xf52885['telegramBotApiKey']):null,'telegramChatId':_0xf52885['telegramChatId'],'webhookUrl':_0xf52885[_0x98232f(0x1c4)],'webhookEvents':this[_0x98232f(0x1ea)](_0xf52885[_0x98232f(0x1c6)]),'notifications':{'payment_success':_0xf52885['notificationPaymentSuccess'],'payment_failed':_0xf52885[_0x98232f(0x1ca)],'refund':_0xf52885['notificationRefund'],'payout':_0xf52885['notificationPayout'],'login':_0xf52885['notificationLogin'],'api_error':_0xf52885[_0x98232f(0x1ba)]}};}async[a53_0x3ee733(0x1ee)](_0x12b2da,_0x30c634){const _0x9e2312=a53_0x3ee733,{currentPassword:_0x53b419,newPassword:_0x1919b3,confirmNewPassword:_0x2c5dfc}=_0x30c634;if(_0x1919b3!==_0x2c5dfc)throw new Error(_0x9e2312(0x1e6));if(_0x1919b3['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x19fc69=await database_1['default'][_0x9e2312(0x1af)][_0x9e2312(0x1ab)]({'where':{'id':_0x12b2da},'select':{'password':!![]}});if(!_0x19fc69)throw new Error(_0x9e2312(0x1f0));const _0x39e01b=await bcryptjs_1[_0x9e2312(0x1f2)][_0x9e2312(0x1bc)](_0x53b419,_0x19fc69[_0x9e2312(0x1ed)]);if(!_0x39e01b)throw new Error(_0x9e2312(0x1b6));const _0x3b0ab8=await bcryptjs_1[_0x9e2312(0x1f2)]['hash'](_0x1919b3,0xc);await database_1['default']['shop'][_0x9e2312(0x1d8)]({'where':{'id':_0x12b2da},'data':{'password':_0x3b0ab8}});}async[a53_0x3ee733(0x1e8)](_0x3f830c,_0x536c38){const _0x2824b9=a53_0x3ee733;await this[_0x2824b9(0x1c2)](_0x3f830c);const _0x3dc131={};_0x536c38[_0x2824b9(0x1da)]!==undefined&&(_0x3dc131[_0x2824b9(0x1d1)]=_0x536c38[_0x2824b9(0x1da)]),_0x536c38[_0x2824b9(0x1ec)]!==undefined&&(_0x3dc131[_0x2824b9(0x1ca)]=_0x536c38[_0x2824b9(0x1ec)]),_0x536c38[_0x2824b9(0x1db)]!==undefined&&(_0x3dc131[_0x2824b9(0x1b1)]=_0x536c38['refund']),_0x536c38[_0x2824b9(0x1cf)]!==undefined&&(_0x3dc131['notificationPayout']=_0x536c38[_0x2824b9(0x1cf)]),_0x536c38[_0x2824b9(0x1ac)]!==undefined&&(_0x3dc131[_0x2824b9(0x1b8)]=_0x536c38[_0x2824b9(0x1ac)]),_0x536c38['api_error']!==undefined&&(_0x3dc131[_0x2824b9(0x1ba)]=_0x536c38['api_error']),await database_1[_0x2824b9(0x1f2)]['shopSettings'][_0x2824b9(0x1d8)]({'where':{'shopId':_0x3f830c},'data':_0x3dc131});}async[a53_0x3ee733(0x1bb)](_0x431bb4,_0x494984){const _0x5f3246=a53_0x3ee733;await this[_0x5f3246(0x1c2)](_0x431bb4);const _0x126015={};_0x494984[_0x5f3246(0x1e4)]!==undefined&&(_0x126015[_0x5f3246(0x1dd)]=_0x494984[_0x5f3246(0x1e4)]||null),_0x494984['chatId']!==undefined&&(_0x126015[_0x5f3246(0x1e5)]=_0x494984['chatId']||null),await database_1[_0x5f3246(0x1f2)][_0x5f3246(0x1e9)][_0x5f3246(0x1d8)]({'where':{'shopId':_0x431bb4},'data':_0x126015});}async[a53_0x3ee733(0x1aa)](_0x2b85d6,_0x4f1c13){const _0xc841c6=a53_0x3ee733;await this[_0xc841c6(0x1c2)](_0x2b85d6);const _0x3c2584={};_0x4f1c13[_0xc841c6(0x1c4)]!==undefined&&(_0x3c2584[_0xc841c6(0x1c4)]=_0x4f1c13[_0xc841c6(0x1c4)]||null),_0x4f1c13[_0xc841c6(0x1c6)]!==undefined&&(_0x3c2584[_0xc841c6(0x1c6)]=_0x4f1c13[_0xc841c6(0x1c6)]||[]),await database_1[_0xc841c6(0x1f2)][_0xc841c6(0x1e9)][_0xc841c6(0x1d8)]({'where':{'shopId':_0x2b85d6},'data':_0x3c2584});}async[a53_0x3ee733(0x1ad)](_0x421106){const _0x221bd6=a53_0x3ee733,_0x4c2f2d=_0x221bd6(0x1c3)+crypto_1['default']['randomBytes'](0x20)[_0x221bd6(0x1b9)](_0x221bd6(0x1c1)),_0x2bbbe1=_0x221bd6(0x1eb)+crypto_1[_0x221bd6(0x1f2)][_0x221bd6(0x1cc)](0x20)[_0x221bd6(0x1b9)]('hex');await database_1['default'][_0x221bd6(0x1af)][_0x221bd6(0x1d8)]({'where':{'id':_0x421106},'data':{'publicKey':_0x4c2f2d,'secretKey':_0x2bbbe1}});}async[a53_0x3ee733(0x1d7)](_0x3c7718,_0x2fcf2e){const _0x354494=a53_0x3ee733,{passwordConfirmation:_0x1453dd}=_0x2fcf2e,_0x5e3f85=await database_1[_0x354494(0x1f2)][_0x354494(0x1af)][_0x354494(0x1ab)]({'where':{'id':_0x3c7718},'select':{'password':!![]}});if(!_0x5e3f85)throw new Error(_0x354494(0x1f0));const _0x3794e9=await bcryptjs_1[_0x354494(0x1f2)][_0x354494(0x1bc)](_0x1453dd,_0x5e3f85[_0x354494(0x1ed)]);if(!_0x3794e9)throw new Error(_0x354494(0x1c5));await database_1['default'][_0x354494(0x1af)][_0x354494(0x1ae)]({'where':{'id':_0x3c7718}});}async[a53_0x3ee733(0x1c2)](_0x5e46b9){const _0x5b2596=a53_0x3ee733,_0x3e6b5e=await database_1[_0x5b2596(0x1f2)][_0x5b2596(0x1e9)][_0x5b2596(0x1ab)]({'where':{'shopId':_0x5e46b9}});!_0x3e6b5e&&await database_1['default'][_0x5b2596(0x1e9)][_0x5b2596(0x1e2)]({'data':{'shopId':_0x5e46b9}});}}exports[a53_0x3ee733(0x1e0)]=SettingsService;