'use strict';function a55_0x52db(){const _0x421adc=['refund','webhookEvents','sk_','payout','updateWebhookSettings','substring','__esModule','2160894iSWqBh','findUnique','password','webhookUrl','notificationLogin','notificationPayout','isArray','SettingsService','shopSettings','7454600YSKIGY','repeat','17318655NcIiuH','Password\x20confirmation\x20is\x20incorrect','45aajYzd','pk_','5314464JLboDq','hash','randomBytes','payment_success','Current\x20password\x20is\x20incorrect','updateTelegramSettings','notificationApiError','parseWebhookEvents','shop','Shop\x20not\x20found','payment_failed','login','length','botApiKey','227496vibOKQ','__importDefault','notificationPaymentFailed','ensureSettingsExist','settings','maskApiKey','telegramBotApiKey','telegramChatId','string','max','118493hkhCGf','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','name','notificationPaymentSuccess','bcryptjs','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','249042GaTqKU','api_error','14wrPQmf','update','deleteAccount','default','delete','notificationRefund','create','chatId'];a55_0x52db=function(){return _0x421adc;};return a55_0x52db();}const a55_0x306ba1=a55_0x46fa;(function(_0xd80882,_0x3cea64){const _0x3b6454=a55_0x46fa,_0x15ef7a=_0xd80882();while(!![]){try{const _0x54781e=-parseInt(_0x3b6454(0x100))/0x1+-parseInt(_0x3b6454(0x117))/0x2+parseInt(_0x3b6454(0xf6))/0x3+-parseInt(_0x3b6454(0xe8))/0x4+-parseInt(_0x3b6454(0xe6))/0x5*(parseInt(_0x3b6454(0x106))/0x6)+parseInt(_0x3b6454(0x108))/0x7*(parseInt(_0x3b6454(0xe2))/0x8)+parseInt(_0x3b6454(0xe4))/0x9;if(_0x54781e===_0x3cea64)break;else _0x15ef7a['push'](_0x15ef7a['shift']());}catch(_0x12ae47){_0x15ef7a['push'](_0x15ef7a['shift']());}}}(a55_0x52db,0xeb062));var __importDefault=this&&this[a55_0x306ba1(0xf7)]||function(_0x22a9d3){const _0x5e15eb=a55_0x306ba1;return _0x22a9d3&&_0x22a9d3[_0x5e15eb(0x116)]?_0x22a9d3:{'default':_0x22a9d3};};Object['defineProperty'](exports,a55_0x306ba1(0x116),{'value':!![]}),exports[a55_0x306ba1(0xe0)]=void 0x0;const bcryptjs_1=__importDefault(require(a55_0x306ba1(0x104))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));function a55_0x46fa(_0x536192,_0x5e64bb){const _0x52dbdd=a55_0x52db();return a55_0x46fa=function(_0x46fa0a,_0x36915d){_0x46fa0a=_0x46fa0a-0xdd;let _0x4b3def=_0x52dbdd[_0x46fa0a];return _0x4b3def;},a55_0x46fa(_0x536192,_0x5e64bb);}class SettingsService{[a55_0x306ba1(0xfb)](_0x40c5db){const _0x9847ae=a55_0x306ba1;if(!_0x40c5db)return'';if(_0x40c5db[_0x9847ae(0xf4)]<=0x8)return _0x40c5db;const _0x513dd7=_0x40c5db[_0x9847ae(0x115)](0x0,0x8),_0x415822='*'[_0x9847ae(0xe3)](Math[_0x9847ae(0xff)](0x0,_0x40c5db[_0x9847ae(0xf4)]-0x8));return _0x513dd7+_0x415822;}[a55_0x306ba1(0xef)](_0x5c4144){const _0x324fab=a55_0x306ba1;if(!_0x5c4144)return[];if(Array[_0x324fab(0xdf)](_0x5c4144))return _0x5c4144;if(typeof _0x5c4144===_0x324fab(0xfe))try{const _0x4c6a4b=JSON['parse'](_0x5c4144);return Array[_0x324fab(0xdf)](_0x4c6a4b)?_0x4c6a4b:[];}catch{return[];}return[];}async['getShopSettings'](_0x2f7edc){const _0x1ad661=a55_0x306ba1,_0x3e7f40=await database_1['default'][_0x1ad661(0xf0)]['findUnique']({'where':{'id':_0x2f7edc},'include':{'settings':!![]}});if(!_0x3e7f40)throw new Error(_0x1ad661(0xf1));let _0x531de0=_0x3e7f40[_0x1ad661(0xfa)];return!_0x531de0&&(_0x531de0=await database_1[_0x1ad661(0x10b)][_0x1ad661(0xe1)][_0x1ad661(0x10e)]({'data':{'shopId':_0x3e7f40['id']}})),{'fullName':_0x3e7f40[_0x1ad661(0x102)],'brand':_0x3e7f40[_0x1ad661(0x102)],'merchantUrl':_0x3e7f40['shopUrl'],'telegramUsername':_0x3e7f40['telegram'],'telegramBotApiKey':_0x531de0[_0x1ad661(0xfc)]?this[_0x1ad661(0xfb)](_0x531de0[_0x1ad661(0xfc)]):null,'telegramChatId':_0x531de0[_0x1ad661(0xfd)],'webhookUrl':_0x531de0[_0x1ad661(0x11a)],'webhookEvents':this[_0x1ad661(0xef)](_0x531de0[_0x1ad661(0x111)]),'notifications':{'payment_success':_0x531de0[_0x1ad661(0x103)],'payment_failed':_0x531de0[_0x1ad661(0xf8)],'refund':_0x531de0[_0x1ad661(0x10d)],'payout':_0x531de0[_0x1ad661(0xde)],'login':_0x531de0['notificationLogin'],'api_error':_0x531de0[_0x1ad661(0xee)]}};}async['changePassword'](_0xebec69,_0x4e6b6e){const _0x28a6cf=a55_0x306ba1,{currentPassword:_0xd260f3,newPassword:_0x5163d9,confirmNewPassword:_0x30b455}=_0x4e6b6e;if(_0x5163d9!==_0x30b455)throw new Error(_0x28a6cf(0x101));if(_0x5163d9['length']<0x6)throw new Error(_0x28a6cf(0x105));const _0x4bb159=await database_1['default'][_0x28a6cf(0xf0)][_0x28a6cf(0x118)]({'where':{'id':_0xebec69},'select':{'password':!![]}});if(!_0x4bb159)throw new Error(_0x28a6cf(0xf1));const _0x5d2a29=await bcryptjs_1['default']['compare'](_0xd260f3,_0x4bb159[_0x28a6cf(0x119)]);if(!_0x5d2a29)throw new Error(_0x28a6cf(0xec));const _0x10730d=await bcryptjs_1['default'][_0x28a6cf(0xe9)](_0x5163d9,0xc);await database_1['default'][_0x28a6cf(0xf0)][_0x28a6cf(0x109)]({'where':{'id':_0xebec69},'data':{'password':_0x10730d}});}async['updateNotifications'](_0x264edf,_0x576493){const _0x46f5af=a55_0x306ba1;await this['ensureSettingsExist'](_0x264edf);const _0x163d48={};_0x576493['payment_success']!==undefined&&(_0x163d48[_0x46f5af(0x103)]=_0x576493[_0x46f5af(0xeb)]),_0x576493[_0x46f5af(0xf2)]!==undefined&&(_0x163d48[_0x46f5af(0xf8)]=_0x576493[_0x46f5af(0xf2)]),_0x576493[_0x46f5af(0x110)]!==undefined&&(_0x163d48['notificationRefund']=_0x576493[_0x46f5af(0x110)]),_0x576493['payout']!==undefined&&(_0x163d48[_0x46f5af(0xde)]=_0x576493[_0x46f5af(0x113)]),_0x576493[_0x46f5af(0xf3)]!==undefined&&(_0x163d48[_0x46f5af(0xdd)]=_0x576493[_0x46f5af(0xf3)]),_0x576493[_0x46f5af(0x107)]!==undefined&&(_0x163d48[_0x46f5af(0xee)]=_0x576493['api_error']),await database_1[_0x46f5af(0x10b)][_0x46f5af(0xe1)][_0x46f5af(0x109)]({'where':{'shopId':_0x264edf},'data':_0x163d48});}async[a55_0x306ba1(0xed)](_0x1edc6f,_0x129a9d){const _0x25ed47=a55_0x306ba1;await this[_0x25ed47(0xf9)](_0x1edc6f);const _0x13e8e3={};_0x129a9d['botApiKey']!==undefined&&(_0x13e8e3['telegramBotApiKey']=_0x129a9d[_0x25ed47(0xf5)]||null),_0x129a9d[_0x25ed47(0x10f)]!==undefined&&(_0x13e8e3[_0x25ed47(0xfd)]=_0x129a9d[_0x25ed47(0x10f)]||null),await database_1[_0x25ed47(0x10b)]['shopSettings'][_0x25ed47(0x109)]({'where':{'shopId':_0x1edc6f},'data':_0x13e8e3});}async[a55_0x306ba1(0x114)](_0x4b35b6,_0x2c8cd9){const _0x4d7e8b=a55_0x306ba1;await this[_0x4d7e8b(0xf9)](_0x4b35b6);const _0x27f07a={};_0x2c8cd9[_0x4d7e8b(0x11a)]!==undefined&&(_0x27f07a[_0x4d7e8b(0x11a)]=_0x2c8cd9['webhookUrl']||null),_0x2c8cd9[_0x4d7e8b(0x111)]!==undefined&&(_0x27f07a['webhookEvents']=_0x2c8cd9[_0x4d7e8b(0x111)]||[]),await database_1[_0x4d7e8b(0x10b)]['shopSettings'][_0x4d7e8b(0x109)]({'where':{'shopId':_0x4b35b6},'data':_0x27f07a});}async['revokeAllApiKeys'](_0xa4f6f8){const _0x4f8999=a55_0x306ba1,_0x57bd1a=_0x4f8999(0xe7)+crypto_1[_0x4f8999(0x10b)][_0x4f8999(0xea)](0x20)['toString']('hex'),_0x2fd313=_0x4f8999(0x112)+crypto_1[_0x4f8999(0x10b)]['randomBytes'](0x20)['toString']('hex');await database_1[_0x4f8999(0x10b)][_0x4f8999(0xf0)][_0x4f8999(0x109)]({'where':{'id':_0xa4f6f8},'data':{'publicKey':_0x57bd1a,'secretKey':_0x2fd313}});}async[a55_0x306ba1(0x10a)](_0x4beb9a,_0x2766e4){const _0x4f5c41=a55_0x306ba1,{passwordConfirmation:_0x4ac000}=_0x2766e4,_0x48b6e5=await database_1[_0x4f5c41(0x10b)]['shop']['findUnique']({'where':{'id':_0x4beb9a},'select':{'password':!![]}});if(!_0x48b6e5)throw new Error('Shop\x20not\x20found');const _0x2b4f10=await bcryptjs_1[_0x4f5c41(0x10b)]['compare'](_0x4ac000,_0x48b6e5['password']);if(!_0x2b4f10)throw new Error(_0x4f5c41(0xe5));await database_1[_0x4f5c41(0x10b)][_0x4f5c41(0xf0)][_0x4f5c41(0x10c)]({'where':{'id':_0x4beb9a}});}async[a55_0x306ba1(0xf9)](_0x478f6b){const _0x5805b6=a55_0x306ba1,_0x345252=await database_1[_0x5805b6(0x10b)][_0x5805b6(0xe1)]['findUnique']({'where':{'shopId':_0x478f6b}});!_0x345252&&await database_1['default'][_0x5805b6(0xe1)][_0x5805b6(0x10e)]({'data':{'shopId':_0x478f6b}});}}exports['SettingsService']=SettingsService;