'use strict';const a47_0x35a1c9=a47_0x28c6;function a47_0x54e0(){const _0x222af6=['44GONVGX','compare','sk_','3392mztBwf','shop','Shop\x20not\x20found','1067232BXQFTM','notificationPaymentFailed','__importDefault','botApiKey','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','2036923dwjyPZ','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','api_error','password','settings','1741784sRJUAl','delete','updateWebhookSettings','telegramBotApiKey','hash','notificationApiError','bcryptjs','notificationPaymentSuccess','notificationPayout','Current\x20password\x20is\x20incorrect','findUnique','SettingsService','substring','login','length','telegram','11493qKUZXC','default','parse','__esModule','toString','telegramChatId','refund','ensureSettingsExist','create','5OUvQCY','1159768ucIkrl','isArray','notificationLogin','hex','revokeAllApiKeys','6ZeZXdX','webhookEvents','repeat','../config/database','deleteAccount','name','webhookUrl','chatId','string','945036ZvTiKR','parseWebhookEvents','update','notificationRefund','shopSettings','maskApiKey','shopUrl','max','payment_failed','payout','5207350ikxZCK','defineProperty'];a47_0x54e0=function(){return _0x222af6;};return a47_0x54e0();}function a47_0x28c6(_0x2cd8a9,_0x1f2c92){const _0x54e0b5=a47_0x54e0();return a47_0x28c6=function(_0x28c619,_0x1f282a){_0x28c619=_0x28c619-0x1a7;let _0x365a38=_0x54e0b5[_0x28c619];return _0x365a38;},a47_0x28c6(_0x2cd8a9,_0x1f2c92);}(function(_0x597259,_0x4e62d9){const _0x386122=a47_0x28c6,_0x2039e3=_0x597259();while(!![]){try{const _0x54e3c9=parseInt(_0x386122(0x1b9))/0x1+parseInt(_0x386122(0x1c7))/0x2+parseInt(_0x386122(0x1d9))/0x3+parseInt(_0x386122(0x1e3))/0x4*(parseInt(_0x386122(0x1b8))/0x5)+parseInt(_0x386122(0x1be))/0x6*(-parseInt(_0x386122(0x1de))/0x7)+parseInt(_0x386122(0x1d6))/0x8*(parseInt(_0x386122(0x1af))/0x9)+-parseInt(_0x386122(0x1d1))/0xa*(parseInt(_0x386122(0x1d3))/0xb);if(_0x54e3c9===_0x4e62d9)break;else _0x2039e3['push'](_0x2039e3['shift']());}catch(_0x103beb){_0x2039e3['push'](_0x2039e3['shift']());}}}(a47_0x54e0,0x90493));var __importDefault=this&&this[a47_0x35a1c9(0x1db)]||function(_0x5a9bc5){return _0x5a9bc5&&_0x5a9bc5['__esModule']?_0x5a9bc5:{'default':_0x5a9bc5};};Object[a47_0x35a1c9(0x1d2)](exports,a47_0x35a1c9(0x1b2),{'value':!![]}),exports[a47_0x35a1c9(0x1aa)]=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x35a1c9(0x1e9))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a47_0x35a1c9(0x1c1)));class SettingsService{[a47_0x35a1c9(0x1cc)](_0x3eb974){const _0x1f0207=a47_0x35a1c9;if(!_0x3eb974)return'';if(_0x3eb974[_0x1f0207(0x1ad)]<=0x8)return _0x3eb974;const _0x2f1188=_0x3eb974[_0x1f0207(0x1ab)](0x0,0x8),_0xcf7296='*'[_0x1f0207(0x1c0)](Math[_0x1f0207(0x1ce)](0x0,_0x3eb974[_0x1f0207(0x1ad)]-0x8));return _0x2f1188+_0xcf7296;}['parseWebhookEvents'](_0x4b4474){const _0x5dd5e6=a47_0x35a1c9;if(!_0x4b4474)return[];if(Array[_0x5dd5e6(0x1ba)](_0x4b4474))return _0x4b4474;if(typeof _0x4b4474===_0x5dd5e6(0x1c6))try{const _0x12c3e5=JSON[_0x5dd5e6(0x1b1)](_0x4b4474);return Array[_0x5dd5e6(0x1ba)](_0x12c3e5)?_0x12c3e5:[];}catch{return[];}return[];}async['getShopSettings'](_0x20b396){const _0x228a10=a47_0x35a1c9,_0x41c0b2=await database_1[_0x228a10(0x1b0)]['shop'][_0x228a10(0x1a9)]({'where':{'id':_0x20b396},'include':{'settings':!![]}});if(!_0x41c0b2)throw new Error('Shop\x20not\x20found');let _0x32da57=_0x41c0b2[_0x228a10(0x1e2)];return!_0x32da57&&(_0x32da57=await database_1['default']['shopSettings'][_0x228a10(0x1b7)]({'data':{'shopId':_0x41c0b2['id']}})),{'fullName':_0x41c0b2[_0x228a10(0x1c3)],'brand':_0x41c0b2[_0x228a10(0x1c3)],'merchantUrl':_0x41c0b2[_0x228a10(0x1cd)],'telegramUsername':_0x41c0b2[_0x228a10(0x1ae)],'telegramBotApiKey':_0x32da57['telegramBotApiKey']?this[_0x228a10(0x1cc)](_0x32da57[_0x228a10(0x1e6)]):null,'telegramChatId':_0x32da57[_0x228a10(0x1b4)],'webhookUrl':_0x32da57[_0x228a10(0x1c4)],'webhookEvents':this[_0x228a10(0x1c8)](_0x32da57[_0x228a10(0x1bf)]),'notifications':{'payment_success':_0x32da57['notificationPaymentSuccess'],'payment_failed':_0x32da57[_0x228a10(0x1da)],'refund':_0x32da57[_0x228a10(0x1ca)],'payout':_0x32da57[_0x228a10(0x1a7)],'login':_0x32da57[_0x228a10(0x1bb)],'api_error':_0x32da57[_0x228a10(0x1e8)]}};}async['changePassword'](_0x430b22,_0x468a7a){const _0x50cad2=a47_0x35a1c9,{currentPassword:_0x6ace18,newPassword:_0x28e41,confirmNewPassword:_0x327e88}=_0x468a7a;if(_0x28e41!==_0x327e88)throw new Error(_0x50cad2(0x1df));if(_0x28e41['length']<0x6)throw new Error(_0x50cad2(0x1dd));const _0x5ed774=await database_1['default'][_0x50cad2(0x1d7)][_0x50cad2(0x1a9)]({'where':{'id':_0x430b22},'select':{'password':!![]}});if(!_0x5ed774)throw new Error(_0x50cad2(0x1d8));const _0x429013=await bcryptjs_1[_0x50cad2(0x1b0)][_0x50cad2(0x1d4)](_0x6ace18,_0x5ed774[_0x50cad2(0x1e1)]);if(!_0x429013)throw new Error(_0x50cad2(0x1a8));const _0x291119=await bcryptjs_1[_0x50cad2(0x1b0)][_0x50cad2(0x1e7)](_0x28e41,0xc);await database_1['default']['shop'][_0x50cad2(0x1c9)]({'where':{'id':_0x430b22},'data':{'password':_0x291119}});}async['updateNotifications'](_0x42f495,_0x31337f){const _0x41b235=a47_0x35a1c9;await this[_0x41b235(0x1b6)](_0x42f495);const _0x58c2ae={};_0x31337f['payment_success']!==undefined&&(_0x58c2ae[_0x41b235(0x1ea)]=_0x31337f['payment_success']),_0x31337f[_0x41b235(0x1cf)]!==undefined&&(_0x58c2ae['notificationPaymentFailed']=_0x31337f[_0x41b235(0x1cf)]),_0x31337f[_0x41b235(0x1b5)]!==undefined&&(_0x58c2ae[_0x41b235(0x1ca)]=_0x31337f[_0x41b235(0x1b5)]),_0x31337f[_0x41b235(0x1d0)]!==undefined&&(_0x58c2ae[_0x41b235(0x1a7)]=_0x31337f['payout']),_0x31337f[_0x41b235(0x1ac)]!==undefined&&(_0x58c2ae['notificationLogin']=_0x31337f[_0x41b235(0x1ac)]),_0x31337f[_0x41b235(0x1e0)]!==undefined&&(_0x58c2ae[_0x41b235(0x1e8)]=_0x31337f[_0x41b235(0x1e0)]),await database_1['default'][_0x41b235(0x1cb)]['update']({'where':{'shopId':_0x42f495},'data':_0x58c2ae});}async['updateTelegramSettings'](_0x39041b,_0x1e336c){const _0x1d4256=a47_0x35a1c9;await this[_0x1d4256(0x1b6)](_0x39041b);const _0x19ccfc={};_0x1e336c[_0x1d4256(0x1dc)]!==undefined&&(_0x19ccfc[_0x1d4256(0x1e6)]=_0x1e336c[_0x1d4256(0x1dc)]||null),_0x1e336c[_0x1d4256(0x1c5)]!==undefined&&(_0x19ccfc[_0x1d4256(0x1b4)]=_0x1e336c['chatId']||null),await database_1['default']['shopSettings'][_0x1d4256(0x1c9)]({'where':{'shopId':_0x39041b},'data':_0x19ccfc});}async[a47_0x35a1c9(0x1e5)](_0x429b87,_0x4307fe){const _0x31e39a=a47_0x35a1c9;await this[_0x31e39a(0x1b6)](_0x429b87);const _0x411bb3={};_0x4307fe['webhookUrl']!==undefined&&(_0x411bb3[_0x31e39a(0x1c4)]=_0x4307fe[_0x31e39a(0x1c4)]||null),_0x4307fe['webhookEvents']!==undefined&&(_0x411bb3[_0x31e39a(0x1bf)]=_0x4307fe[_0x31e39a(0x1bf)]||[]),await database_1[_0x31e39a(0x1b0)][_0x31e39a(0x1cb)][_0x31e39a(0x1c9)]({'where':{'shopId':_0x429b87},'data':_0x411bb3});}async[a47_0x35a1c9(0x1bd)](_0x63d787){const _0x11d886=a47_0x35a1c9,_0x56e103='pk_'+crypto_1[_0x11d886(0x1b0)]['randomBytes'](0x20)[_0x11d886(0x1b3)](_0x11d886(0x1bc)),_0x5d84d1=_0x11d886(0x1d5)+crypto_1[_0x11d886(0x1b0)]['randomBytes'](0x20)[_0x11d886(0x1b3)](_0x11d886(0x1bc));await database_1[_0x11d886(0x1b0)]['shop']['update']({'where':{'id':_0x63d787},'data':{'publicKey':_0x56e103,'secretKey':_0x5d84d1}});}async[a47_0x35a1c9(0x1c2)](_0x174296,_0x271ab5){const _0x3ac030=a47_0x35a1c9,{passwordConfirmation:_0xf850a}=_0x271ab5,_0x440e2c=await database_1[_0x3ac030(0x1b0)][_0x3ac030(0x1d7)][_0x3ac030(0x1a9)]({'where':{'id':_0x174296},'select':{'password':!![]}});if(!_0x440e2c)throw new Error(_0x3ac030(0x1d8));const _0x3b086e=await bcryptjs_1[_0x3ac030(0x1b0)][_0x3ac030(0x1d4)](_0xf850a,_0x440e2c[_0x3ac030(0x1e1)]);if(!_0x3b086e)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1['default']['shop'][_0x3ac030(0x1e4)]({'where':{'id':_0x174296}});}async[a47_0x35a1c9(0x1b6)](_0x18c74a){const _0x363f6f=a47_0x35a1c9,_0x2d7c32=await database_1[_0x363f6f(0x1b0)][_0x363f6f(0x1cb)][_0x363f6f(0x1a9)]({'where':{'shopId':_0x18c74a}});!_0x2d7c32&&await database_1[_0x363f6f(0x1b0)]['shopSettings'][_0x363f6f(0x1b7)]({'data':{'shopId':_0x18c74a}});}}exports[a47_0x35a1c9(0x1aa)]=SettingsService;