'use strict';function a64_0x4655(){const _0x238a25=['sk_','__esModule','isArray','hash','refund','hex','shopSettings','1571748LJIxly','payment_success','notificationPaymentFailed','api_error','102504UAOQQn','SettingsService','delete','toString','settings','telegram','create','getShopSettings','notificationPaymentSuccess','updateNotifications','update','206049gjKYEB','default','substring','8tgBZeD','crypto','parseWebhookEvents','password','defineProperty','__importDefault','Shop\x20not\x20found','webhookUrl','length','Current\x20password\x20is\x20incorrect','compare','2nwTopj','930438HAifJj','10IXBGrz','bcryptjs','updateTelegramSettings','repeat','name','revokeAllApiKeys','Password\x20confirmation\x20is\x20incorrect','telegramBotApiKey','login','deleteAccount','35KzGziU','shopUrl','notificationLogin','ensureSettingsExist','shop','notificationRefund','webhookEvents','payment_failed','string','findUnique','notificationApiError','payout','6031289tuLulV','randomBytes','222030BxylGm','telegramChatId','parse','../config/database','1037092pqpCyt','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','chatId'];a64_0x4655=function(){return _0x238a25;};return a64_0x4655();}function a64_0x34b6(_0x373599,_0x236ede){const _0x465570=a64_0x4655();return a64_0x34b6=function(_0x34b678,_0x1ae3f3){_0x34b678=_0x34b678-0x184;let _0x504492=_0x465570[_0x34b678];return _0x504492;},a64_0x34b6(_0x373599,_0x236ede);}const a64_0x515c5b=a64_0x34b6;(function(_0x7b0d27,_0x277831){const _0x262b0f=a64_0x34b6,_0x30aa33=_0x7b0d27();while(!![]){try{const _0x5b2fa2=-parseInt(_0x262b0f(0x19e))/0x1+parseInt(_0x262b0f(0x1ac))/0x2*(parseInt(_0x262b0f(0x1ad))/0x3)+-parseInt(_0x262b0f(0x18f))/0x4+-parseInt(_0x262b0f(0x1b8))/0x5*(parseInt(_0x262b0f(0x193))/0x6)+-parseInt(_0x262b0f(0x185))/0x7*(-parseInt(_0x262b0f(0x1a1))/0x8)+-parseInt(_0x262b0f(0x1c6))/0x9*(parseInt(_0x262b0f(0x1ae))/0xa)+parseInt(_0x262b0f(0x1c4))/0xb;if(_0x5b2fa2===_0x277831)break;else _0x30aa33['push'](_0x30aa33['shift']());}catch(_0x542764){_0x30aa33['push'](_0x30aa33['shift']());}}}(a64_0x4655,0x404bd));var __importDefault=this&&this[a64_0x515c5b(0x1a6)]||function(_0x34be7c){const _0x3452f2=a64_0x515c5b;return _0x34be7c&&_0x34be7c[_0x3452f2(0x189)]?_0x34be7c:{'default':_0x34be7c};};Object[a64_0x515c5b(0x1a5)](exports,a64_0x515c5b(0x189),{'value':!![]}),exports[a64_0x515c5b(0x194)]=void 0x0;const bcryptjs_1=__importDefault(require(a64_0x515c5b(0x1af))),crypto_1=__importDefault(require(a64_0x515c5b(0x1a2))),database_1=__importDefault(require(a64_0x515c5b(0x184)));class SettingsService{['maskApiKey'](_0x5b0bc5){const _0x4d6ca8=a64_0x515c5b;if(!_0x5b0bc5)return'';if(_0x5b0bc5[_0x4d6ca8(0x1a9)]<=0x8)return _0x5b0bc5;const _0x2ab7e2=_0x5b0bc5[_0x4d6ca8(0x1a0)](0x0,0x8),_0x2b9da9='*'[_0x4d6ca8(0x1b1)](Math['max'](0x0,_0x5b0bc5[_0x4d6ca8(0x1a9)]-0x8));return _0x2ab7e2+_0x2b9da9;}[a64_0x515c5b(0x1a3)](_0x516a51){const _0x5d494f=a64_0x515c5b;if(!_0x516a51)return[];if(Array[_0x5d494f(0x18a)](_0x516a51))return _0x516a51;if(typeof _0x516a51===_0x5d494f(0x1c0))try{const _0x18d119=JSON[_0x5d494f(0x1c8)](_0x516a51);return Array['isArray'](_0x18d119)?_0x18d119:[];}catch{return[];}return[];}async[a64_0x515c5b(0x19a)](_0x262ba3){const _0x507ffd=a64_0x515c5b,_0x15ce08=await database_1[_0x507ffd(0x19f)][_0x507ffd(0x1bc)][_0x507ffd(0x1c1)]({'where':{'id':_0x262ba3},'include':{'settings':!![]}});if(!_0x15ce08)throw new Error(_0x507ffd(0x1a7));let _0x13c7bb=_0x15ce08[_0x507ffd(0x197)];return!_0x13c7bb&&(_0x13c7bb=await database_1['default'][_0x507ffd(0x18e)][_0x507ffd(0x199)]({'data':{'shopId':_0x15ce08['id']}})),{'fullName':_0x15ce08[_0x507ffd(0x1b2)],'brand':_0x15ce08[_0x507ffd(0x1b2)],'merchantUrl':_0x15ce08[_0x507ffd(0x1b9)],'telegramUsername':_0x15ce08[_0x507ffd(0x198)],'telegramBotApiKey':_0x13c7bb[_0x507ffd(0x1b5)]?this['maskApiKey'](_0x13c7bb[_0x507ffd(0x1b5)]):null,'telegramChatId':_0x13c7bb[_0x507ffd(0x1c7)],'webhookUrl':_0x13c7bb[_0x507ffd(0x1a8)],'webhookEvents':this['parseWebhookEvents'](_0x13c7bb[_0x507ffd(0x1be)]),'notifications':{'payment_success':_0x13c7bb[_0x507ffd(0x19b)],'payment_failed':_0x13c7bb[_0x507ffd(0x191)],'refund':_0x13c7bb[_0x507ffd(0x1bd)],'payout':_0x13c7bb['notificationPayout'],'login':_0x13c7bb[_0x507ffd(0x1ba)],'api_error':_0x13c7bb[_0x507ffd(0x1c2)]}};}async['changePassword'](_0x4261c5,_0xa04ae0){const _0x402505=a64_0x515c5b,{currentPassword:_0x122e5a,newPassword:_0x5e10a3,confirmNewPassword:_0x6f8db8}=_0xa04ae0;if(_0x5e10a3!==_0x6f8db8)throw new Error(_0x402505(0x186));if(_0x5e10a3['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x2404b1=await database_1['default'][_0x402505(0x1bc)][_0x402505(0x1c1)]({'where':{'id':_0x4261c5},'select':{'password':!![]}});if(!_0x2404b1)throw new Error(_0x402505(0x1a7));const _0x43ec7e=await bcryptjs_1[_0x402505(0x19f)][_0x402505(0x1ab)](_0x122e5a,_0x2404b1[_0x402505(0x1a4)]);if(!_0x43ec7e)throw new Error(_0x402505(0x1aa));const _0x51f53e=await bcryptjs_1[_0x402505(0x19f)][_0x402505(0x18b)](_0x5e10a3,0xc);await database_1[_0x402505(0x19f)][_0x402505(0x1bc)]['update']({'where':{'id':_0x4261c5},'data':{'password':_0x51f53e}});}async[a64_0x515c5b(0x19c)](_0x4d9b20,_0x174750){const _0x424bae=a64_0x515c5b;await this[_0x424bae(0x1bb)](_0x4d9b20);const _0x15bb55={};_0x174750[_0x424bae(0x190)]!==undefined&&(_0x15bb55[_0x424bae(0x19b)]=_0x174750[_0x424bae(0x190)]),_0x174750['payment_failed']!==undefined&&(_0x15bb55['notificationPaymentFailed']=_0x174750[_0x424bae(0x1bf)]),_0x174750[_0x424bae(0x18c)]!==undefined&&(_0x15bb55[_0x424bae(0x1bd)]=_0x174750[_0x424bae(0x18c)]),_0x174750[_0x424bae(0x1c3)]!==undefined&&(_0x15bb55['notificationPayout']=_0x174750[_0x424bae(0x1c3)]),_0x174750[_0x424bae(0x1b6)]!==undefined&&(_0x15bb55['notificationLogin']=_0x174750[_0x424bae(0x1b6)]),_0x174750[_0x424bae(0x192)]!==undefined&&(_0x15bb55[_0x424bae(0x1c2)]=_0x174750[_0x424bae(0x192)]),await database_1['default'][_0x424bae(0x18e)][_0x424bae(0x19d)]({'where':{'shopId':_0x4d9b20},'data':_0x15bb55});}async[a64_0x515c5b(0x1b0)](_0x215fe4,_0xce7baf){const _0x216038=a64_0x515c5b;await this[_0x216038(0x1bb)](_0x215fe4);const _0x59300d={};_0xce7baf['botApiKey']!==undefined&&(_0x59300d[_0x216038(0x1b5)]=_0xce7baf['botApiKey']||null),_0xce7baf[_0x216038(0x187)]!==undefined&&(_0x59300d['telegramChatId']=_0xce7baf[_0x216038(0x187)]||null),await database_1[_0x216038(0x19f)][_0x216038(0x18e)][_0x216038(0x19d)]({'where':{'shopId':_0x215fe4},'data':_0x59300d});}async['updateWebhookSettings'](_0xbe5ade,_0x3cf57b){const _0x36020e=a64_0x515c5b;await this[_0x36020e(0x1bb)](_0xbe5ade);const _0x41b615={};_0x3cf57b[_0x36020e(0x1a8)]!==undefined&&(_0x41b615[_0x36020e(0x1a8)]=_0x3cf57b[_0x36020e(0x1a8)]||null),_0x3cf57b['webhookEvents']!==undefined&&(_0x41b615[_0x36020e(0x1be)]=_0x3cf57b[_0x36020e(0x1be)]||[]),await database_1[_0x36020e(0x19f)][_0x36020e(0x18e)][_0x36020e(0x19d)]({'where':{'shopId':_0xbe5ade},'data':_0x41b615});}async[a64_0x515c5b(0x1b3)](_0x4fdc48){const _0x5b5c7c=a64_0x515c5b,_0x56dd9a='pk_'+crypto_1['default'][_0x5b5c7c(0x1c5)](0x20)[_0x5b5c7c(0x196)](_0x5b5c7c(0x18d)),_0x43e4e5=_0x5b5c7c(0x188)+crypto_1['default'][_0x5b5c7c(0x1c5)](0x20)[_0x5b5c7c(0x196)](_0x5b5c7c(0x18d));await database_1[_0x5b5c7c(0x19f)][_0x5b5c7c(0x1bc)][_0x5b5c7c(0x19d)]({'where':{'id':_0x4fdc48},'data':{'publicKey':_0x56dd9a,'secretKey':_0x43e4e5}});}async[a64_0x515c5b(0x1b7)](_0x2a860d,_0x65c78){const _0xf73025=a64_0x515c5b,{passwordConfirmation:_0x6a6013}=_0x65c78,_0x1bfa33=await database_1[_0xf73025(0x19f)][_0xf73025(0x1bc)][_0xf73025(0x1c1)]({'where':{'id':_0x2a860d},'select':{'password':!![]}});if(!_0x1bfa33)throw new Error(_0xf73025(0x1a7));const _0x2c841a=await bcryptjs_1[_0xf73025(0x19f)][_0xf73025(0x1ab)](_0x6a6013,_0x1bfa33[_0xf73025(0x1a4)]);if(!_0x2c841a)throw new Error(_0xf73025(0x1b4));await database_1[_0xf73025(0x19f)]['shop'][_0xf73025(0x195)]({'where':{'id':_0x2a860d}});}async['ensureSettingsExist'](_0x30713a){const _0x49c44b=a64_0x515c5b,_0x15a013=await database_1[_0x49c44b(0x19f)][_0x49c44b(0x18e)]['findUnique']({'where':{'shopId':_0x30713a}});!_0x15a013&&await database_1['default'][_0x49c44b(0x18e)]['create']({'data':{'shopId':_0x30713a}});}}exports[a64_0x515c5b(0x194)]=SettingsService;