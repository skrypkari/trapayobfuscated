'use strict';const a52_0x20e005=a52_0x4a35;(function(_0x1d6f42,_0x14ecbd){const _0x1027c1=a52_0x4a35,_0x26b093=_0x1d6f42();while(!![]){try{const _0x3411ac=parseInt(_0x1027c1(0x165))/0x1*(-parseInt(_0x1027c1(0x156))/0x2)+parseInt(_0x1027c1(0x14c))/0x3+-parseInt(_0x1027c1(0x154))/0x4+parseInt(_0x1027c1(0x15e))/0x5*(-parseInt(_0x1027c1(0x12d))/0x6)+parseInt(_0x1027c1(0x12e))/0x7+-parseInt(_0x1027c1(0x143))/0x8*(parseInt(_0x1027c1(0x14f))/0x9)+parseInt(_0x1027c1(0x145))/0xa;if(_0x3411ac===_0x14ecbd)break;else _0x26b093['push'](_0x26b093['shift']());}catch(_0x481593){_0x26b093['push'](_0x26b093['shift']());}}}(a52_0x4678,0x21af4));function a52_0x4678(){const _0x4741fe=['string','324614TkFxLC','updateWebhookSettings','ensureSettingsExist','telegramChatId','substring','sk_','api_error','__importDefault','7265pUIIzW','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','payment_failed','payout','name','chatId','parseWebhookEvents','1TtdYHr','length','telegramBotApiKey','notificationPaymentFailed','repeat','revokeAllApiKeys','hex','toString','parse','notificationRefund','settings','hash','create','1074WWeLuz','836507QkhfeF','__esModule','updateTelegramSettings','botApiKey','pk_','default','webhookEvents','refund','notificationPaymentSuccess','crypto','updateNotifications','max','password','Current\x20password\x20is\x20incorrect','shop','defineProperty','compare','notificationPayout','update','telegram','notificationApiError','153504vEiZQQ','payment_success','6524670sBLoiX','Shop\x20not\x20found','getShopSettings','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','webhookUrl','shopSettings','login','317415YzxZWW','notificationLogin','isArray','54TISkiN','SettingsService','deleteAccount','Password\x20confirmation\x20is\x20incorrect','findUnique','809116RbOxIK'];a52_0x4678=function(){return _0x4741fe;};return a52_0x4678();}function a52_0x4a35(_0x497b52,_0x31ec8c){const _0x467892=a52_0x4678();return a52_0x4a35=function(_0x4a35c9,_0x381580){_0x4a35c9=_0x4a35c9-0x12a;let _0x31e19a=_0x467892[_0x4a35c9];return _0x31e19a;},a52_0x4a35(_0x497b52,_0x31ec8c);}var __importDefault=this&&this[a52_0x20e005(0x15d)]||function(_0x4d2a5a){const _0x1c6cfb=a52_0x20e005;return _0x4d2a5a&&_0x4d2a5a[_0x1c6cfb(0x12f)]?_0x4d2a5a:{'default':_0x4d2a5a};};Object[a52_0x20e005(0x13d)](exports,a52_0x20e005(0x12f),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a52_0x20e005(0x137))),database_1=__importDefault(require('../config/database'));class SettingsService{['maskApiKey'](_0x25edb0){const _0x381d48=a52_0x20e005;if(!_0x25edb0)return'';if(_0x25edb0[_0x381d48(0x166)]<=0x8)return _0x25edb0;const _0x463731=_0x25edb0[_0x381d48(0x15a)](0x0,0x8),_0x3fff43='*'[_0x381d48(0x169)](Math[_0x381d48(0x139)](0x0,_0x25edb0[_0x381d48(0x166)]-0x8));return _0x463731+_0x3fff43;}[a52_0x20e005(0x164)](_0x1e99bb){const _0x57560f=a52_0x20e005;if(!_0x1e99bb)return[];if(Array[_0x57560f(0x14e)](_0x1e99bb))return _0x1e99bb;if(typeof _0x1e99bb===_0x57560f(0x155))try{const _0x29c370=JSON[_0x57560f(0x16d)](_0x1e99bb);return Array[_0x57560f(0x14e)](_0x29c370)?_0x29c370:[];}catch{return[];}return[];}async[a52_0x20e005(0x147)](_0xdabab9){const _0x2bc58a=a52_0x20e005,_0x38172c=await database_1[_0x2bc58a(0x133)][_0x2bc58a(0x13c)][_0x2bc58a(0x153)]({'where':{'id':_0xdabab9},'include':{'settings':!![]}});if(!_0x38172c)throw new Error('Shop\x20not\x20found');let _0x2f34ed=_0x38172c[_0x2bc58a(0x12a)];return!_0x2f34ed&&(_0x2f34ed=await database_1[_0x2bc58a(0x133)][_0x2bc58a(0x14a)][_0x2bc58a(0x12c)]({'data':{'shopId':_0x38172c['id']}})),{'fullName':_0x38172c[_0x2bc58a(0x162)],'brand':_0x38172c[_0x2bc58a(0x162)],'merchantUrl':_0x38172c['shopUrl'],'telegramUsername':_0x38172c[_0x2bc58a(0x141)],'telegramBotApiKey':_0x2f34ed['telegramBotApiKey']?this['maskApiKey'](_0x2f34ed[_0x2bc58a(0x167)]):null,'telegramChatId':_0x2f34ed[_0x2bc58a(0x159)],'webhookUrl':_0x2f34ed['webhookUrl'],'webhookEvents':this['parseWebhookEvents'](_0x2f34ed[_0x2bc58a(0x134)]),'notifications':{'payment_success':_0x2f34ed['notificationPaymentSuccess'],'payment_failed':_0x2f34ed[_0x2bc58a(0x168)],'refund':_0x2f34ed['notificationRefund'],'payout':_0x2f34ed[_0x2bc58a(0x13f)],'login':_0x2f34ed['notificationLogin'],'api_error':_0x2f34ed[_0x2bc58a(0x142)]}};}async['changePassword'](_0x59d139,_0x5b6fd4){const _0x133e57=a52_0x20e005,{currentPassword:_0x4819af,newPassword:_0x4e3600,confirmNewPassword:_0x59d0d1}=_0x5b6fd4;if(_0x4e3600!==_0x59d0d1)throw new Error(_0x133e57(0x15f));if(_0x4e3600[_0x133e57(0x166)]<0x6)throw new Error(_0x133e57(0x148));const _0x4cf1ec=await database_1[_0x133e57(0x133)][_0x133e57(0x13c)]['findUnique']({'where':{'id':_0x59d139},'select':{'password':!![]}});if(!_0x4cf1ec)throw new Error('Shop\x20not\x20found');const _0x52eb33=await bcryptjs_1[_0x133e57(0x133)][_0x133e57(0x13e)](_0x4819af,_0x4cf1ec[_0x133e57(0x13a)]);if(!_0x52eb33)throw new Error(_0x133e57(0x13b));const _0x48683c=await bcryptjs_1[_0x133e57(0x133)][_0x133e57(0x12b)](_0x4e3600,0xc);await database_1[_0x133e57(0x133)][_0x133e57(0x13c)][_0x133e57(0x140)]({'where':{'id':_0x59d139},'data':{'password':_0x48683c}});}async[a52_0x20e005(0x138)](_0x234e98,_0x121195){const _0x5ccf15=a52_0x20e005;await this[_0x5ccf15(0x158)](_0x234e98);const _0x847cc1={};_0x121195[_0x5ccf15(0x144)]!==undefined&&(_0x847cc1[_0x5ccf15(0x136)]=_0x121195[_0x5ccf15(0x144)]),_0x121195[_0x5ccf15(0x160)]!==undefined&&(_0x847cc1[_0x5ccf15(0x168)]=_0x121195[_0x5ccf15(0x160)]),_0x121195[_0x5ccf15(0x135)]!==undefined&&(_0x847cc1[_0x5ccf15(0x16e)]=_0x121195[_0x5ccf15(0x135)]),_0x121195[_0x5ccf15(0x161)]!==undefined&&(_0x847cc1[_0x5ccf15(0x13f)]=_0x121195['payout']),_0x121195[_0x5ccf15(0x14b)]!==undefined&&(_0x847cc1[_0x5ccf15(0x14d)]=_0x121195[_0x5ccf15(0x14b)]),_0x121195[_0x5ccf15(0x15c)]!==undefined&&(_0x847cc1[_0x5ccf15(0x142)]=_0x121195[_0x5ccf15(0x15c)]),await database_1[_0x5ccf15(0x133)][_0x5ccf15(0x14a)]['update']({'where':{'shopId':_0x234e98},'data':_0x847cc1});}async[a52_0x20e005(0x130)](_0x457f36,_0x50b513){const _0x88b838=a52_0x20e005;await this[_0x88b838(0x158)](_0x457f36);const _0x539f1f={};_0x50b513[_0x88b838(0x131)]!==undefined&&(_0x539f1f[_0x88b838(0x167)]=_0x50b513[_0x88b838(0x131)]||null),_0x50b513[_0x88b838(0x163)]!==undefined&&(_0x539f1f['telegramChatId']=_0x50b513[_0x88b838(0x163)]||null),await database_1[_0x88b838(0x133)]['shopSettings'][_0x88b838(0x140)]({'where':{'shopId':_0x457f36},'data':_0x539f1f});}async[a52_0x20e005(0x157)](_0x22f35d,_0x30257b){const _0x42611a=a52_0x20e005;await this[_0x42611a(0x158)](_0x22f35d);const _0x395ba6={};_0x30257b[_0x42611a(0x149)]!==undefined&&(_0x395ba6[_0x42611a(0x149)]=_0x30257b[_0x42611a(0x149)]||null),_0x30257b[_0x42611a(0x134)]!==undefined&&(_0x395ba6[_0x42611a(0x134)]=_0x30257b['webhookEvents']||[]),await database_1['default'][_0x42611a(0x14a)][_0x42611a(0x140)]({'where':{'shopId':_0x22f35d},'data':_0x395ba6});}async[a52_0x20e005(0x16a)](_0x53538f){const _0x346b8b=a52_0x20e005,_0x2af604=_0x346b8b(0x132)+crypto_1[_0x346b8b(0x133)]['randomBytes'](0x20)[_0x346b8b(0x16c)](_0x346b8b(0x16b)),_0x3e8414=_0x346b8b(0x15b)+crypto_1[_0x346b8b(0x133)]['randomBytes'](0x20)['toString'](_0x346b8b(0x16b));await database_1['default']['shop']['update']({'where':{'id':_0x53538f},'data':{'publicKey':_0x2af604,'secretKey':_0x3e8414}});}async[a52_0x20e005(0x151)](_0x54fd8a,_0x3943c1){const _0x42b68f=a52_0x20e005,{passwordConfirmation:_0x5857f8}=_0x3943c1,_0x4804d5=await database_1[_0x42b68f(0x133)]['shop'][_0x42b68f(0x153)]({'where':{'id':_0x54fd8a},'select':{'password':!![]}});if(!_0x4804d5)throw new Error(_0x42b68f(0x146));const _0x2cd9e9=await bcryptjs_1['default'][_0x42b68f(0x13e)](_0x5857f8,_0x4804d5['password']);if(!_0x2cd9e9)throw new Error(_0x42b68f(0x152));await database_1[_0x42b68f(0x133)][_0x42b68f(0x13c)]['delete']({'where':{'id':_0x54fd8a}});}async['ensureSettingsExist'](_0x456754){const _0x1dd266=a52_0x20e005,_0x1add1d=await database_1[_0x1dd266(0x133)][_0x1dd266(0x14a)][_0x1dd266(0x153)]({'where':{'shopId':_0x456754}});!_0x1add1d&&await database_1[_0x1dd266(0x133)]['shopSettings'][_0x1dd266(0x12c)]({'data':{'shopId':_0x456754}});}}exports[a52_0x20e005(0x150)]=SettingsService;