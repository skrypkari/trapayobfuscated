'use strict';function a52_0x4475(_0x412f40,_0x3f2ba3){const _0x259a48=a52_0x259a();return a52_0x4475=function(_0x44755f,_0x250b33){_0x44755f=_0x44755f-0x1c3;let _0xa2ee8c=_0x259a48[_0x44755f];return _0xa2ee8c;},a52_0x4475(_0x412f40,_0x3f2ba3);}function a52_0x259a(){const _0xf43e0=['maskApiKey','isArray','notificationPayout','hex','password','notificationPaymentFailed','282AmxCWx','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','telegramChatId','5106600JqfatY','payout','delete','pk_','updateTelegramSettings','5677976kfjbbC','3877605NWAuLb','crypto','update','string','shop','Shop\x20not\x20found','227486HdzNFE','shopSettings','api_error','chatId','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','toString','notificationLogin','612772sGSOIG','bcryptjs','refund','SettingsService','default','substring','parseWebhookEvents','notificationPaymentSuccess','deleteAccount','updateWebhookSettings','getShopSettings','Password\x20confirmation\x20is\x20incorrect','compare','672DRUbYm','telegramBotApiKey','../config/database','__importDefault','webhookUrl','hash','create','payment_success','name','webhookEvents','login','botApiKey','3897730DzQQVd','ensureSettingsExist','55BevQaB','findUnique','length','notificationApiError','defineProperty','5562VpwoHZ','changePassword','sk_'];a52_0x259a=function(){return _0xf43e0;};return a52_0x259a();}const a52_0x179be7=a52_0x4475;(function(_0x559094,_0x2df068){const _0x522c8c=a52_0x4475,_0x1b2ef2=_0x559094();while(!![]){try{const _0x225084=parseInt(_0x522c8c(0x1d4))/0x1*(-parseInt(_0x522c8c(0x200))/0x2)+-parseInt(_0x522c8c(0x1e6))/0x3+-parseInt(_0x522c8c(0x1f3))/0x4*(-parseInt(_0x522c8c(0x1cf))/0x5)+parseInt(_0x522c8c(0x1dd))/0x6*(parseInt(_0x522c8c(0x1ec))/0x7)+parseInt(_0x522c8c(0x1e5))/0x8+parseInt(_0x522c8c(0x1e0))/0x9+-parseInt(_0x522c8c(0x1cd))/0xa;if(_0x225084===_0x2df068)break;else _0x1b2ef2['push'](_0x1b2ef2['shift']());}catch(_0x59e4e9){_0x1b2ef2['push'](_0x1b2ef2['shift']());}}}(a52_0x259a,0xe5228));var __importDefault=this&&this[a52_0x179be7(0x1c4)]||function(_0x3da826){return _0x3da826&&_0x3da826['__esModule']?_0x3da826:{'default':_0x3da826};};Object[a52_0x179be7(0x1d3)](exports,'__esModule',{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x179be7(0x1f4))),crypto_1=__importDefault(require(a52_0x179be7(0x1e7))),database_1=__importDefault(require(a52_0x179be7(0x1c3)));class SettingsService{[a52_0x179be7(0x1d7)](_0x322dfd){const _0x411ce3=a52_0x179be7;if(!_0x322dfd)return'';if(_0x322dfd['length']<=0x8)return _0x322dfd;const _0x213441=_0x322dfd[_0x411ce3(0x1f8)](0x0,0x8),_0x194c03='*'['repeat'](Math['max'](0x0,_0x322dfd[_0x411ce3(0x1d1)]-0x8));return _0x213441+_0x194c03;}['parseWebhookEvents'](_0x567d60){const _0x538a32=a52_0x179be7;if(!_0x567d60)return[];if(Array[_0x538a32(0x1d8)](_0x567d60))return _0x567d60;if(typeof _0x567d60===_0x538a32(0x1e9))try{const _0x16979b=JSON['parse'](_0x567d60);return Array[_0x538a32(0x1d8)](_0x16979b)?_0x16979b:[];}catch{return[];}return[];}async[a52_0x179be7(0x1fd)](_0x48144e){const _0xb395fa=a52_0x179be7,_0x3b451c=await database_1[_0xb395fa(0x1f7)][_0xb395fa(0x1ea)][_0xb395fa(0x1d0)]({'where':{'id':_0x48144e},'include':{'settings':!![]}});if(!_0x3b451c)throw new Error(_0xb395fa(0x1eb));let _0x3119f1=_0x3b451c['settings'];return!_0x3119f1&&(_0x3119f1=await database_1[_0xb395fa(0x1f7)][_0xb395fa(0x1ed)][_0xb395fa(0x1c7)]({'data':{'shopId':_0x3b451c['id']}})),{'fullName':_0x3b451c['name'],'brand':_0x3b451c[_0xb395fa(0x1c9)],'merchantUrl':_0x3b451c['shopUrl'],'telegramUsername':_0x3b451c['telegram'],'telegramBotApiKey':_0x3119f1[_0xb395fa(0x201)]?this['maskApiKey'](_0x3119f1[_0xb395fa(0x201)]):null,'telegramChatId':_0x3119f1[_0xb395fa(0x1df)],'webhookUrl':_0x3119f1[_0xb395fa(0x1c5)],'webhookEvents':this[_0xb395fa(0x1f9)](_0x3119f1[_0xb395fa(0x1ca)]),'notifications':{'payment_success':_0x3119f1[_0xb395fa(0x1fa)],'payment_failed':_0x3119f1['notificationPaymentFailed'],'refund':_0x3119f1['notificationRefund'],'payout':_0x3119f1[_0xb395fa(0x1d9)],'login':_0x3119f1['notificationLogin'],'api_error':_0x3119f1['notificationApiError']}};}async[a52_0x179be7(0x1d5)](_0x31b77e,_0x264115){const _0x45ec40=a52_0x179be7,{currentPassword:_0x170cbd,newPassword:_0x4eea65,confirmNewPassword:_0x454b0c}=_0x264115;if(_0x4eea65!==_0x454b0c)throw new Error(_0x45ec40(0x1de));if(_0x4eea65['length']<0x6)throw new Error(_0x45ec40(0x1f0));const _0x27e162=await database_1[_0x45ec40(0x1f7)][_0x45ec40(0x1ea)][_0x45ec40(0x1d0)]({'where':{'id':_0x31b77e},'select':{'password':!![]}});if(!_0x27e162)throw new Error(_0x45ec40(0x1eb));const _0x1ddfb5=await bcryptjs_1[_0x45ec40(0x1f7)][_0x45ec40(0x1ff)](_0x170cbd,_0x27e162[_0x45ec40(0x1db)]);if(!_0x1ddfb5)throw new Error('Current\x20password\x20is\x20incorrect');const _0x228d97=await bcryptjs_1['default'][_0x45ec40(0x1c6)](_0x4eea65,0xc);await database_1[_0x45ec40(0x1f7)][_0x45ec40(0x1ea)]['update']({'where':{'id':_0x31b77e},'data':{'password':_0x228d97}});}async['updateNotifications'](_0x445fd5,_0x5a2b8f){const _0x519c67=a52_0x179be7;await this[_0x519c67(0x1ce)](_0x445fd5);const _0x1b33ad={};_0x5a2b8f[_0x519c67(0x1c8)]!==undefined&&(_0x1b33ad[_0x519c67(0x1fa)]=_0x5a2b8f[_0x519c67(0x1c8)]),_0x5a2b8f['payment_failed']!==undefined&&(_0x1b33ad[_0x519c67(0x1dc)]=_0x5a2b8f['payment_failed']),_0x5a2b8f['refund']!==undefined&&(_0x1b33ad['notificationRefund']=_0x5a2b8f[_0x519c67(0x1f5)]),_0x5a2b8f[_0x519c67(0x1e1)]!==undefined&&(_0x1b33ad[_0x519c67(0x1d9)]=_0x5a2b8f[_0x519c67(0x1e1)]),_0x5a2b8f[_0x519c67(0x1cb)]!==undefined&&(_0x1b33ad[_0x519c67(0x1f2)]=_0x5a2b8f[_0x519c67(0x1cb)]),_0x5a2b8f[_0x519c67(0x1ee)]!==undefined&&(_0x1b33ad[_0x519c67(0x1d2)]=_0x5a2b8f[_0x519c67(0x1ee)]),await database_1[_0x519c67(0x1f7)][_0x519c67(0x1ed)]['update']({'where':{'shopId':_0x445fd5},'data':_0x1b33ad});}async[a52_0x179be7(0x1e4)](_0xc103f9,_0x3e5b85){const _0x24a424=a52_0x179be7;await this[_0x24a424(0x1ce)](_0xc103f9);const _0x1a5736={};_0x3e5b85[_0x24a424(0x1cc)]!==undefined&&(_0x1a5736[_0x24a424(0x201)]=_0x3e5b85[_0x24a424(0x1cc)]||null),_0x3e5b85[_0x24a424(0x1ef)]!==undefined&&(_0x1a5736[_0x24a424(0x1df)]=_0x3e5b85[_0x24a424(0x1ef)]||null),await database_1[_0x24a424(0x1f7)][_0x24a424(0x1ed)]['update']({'where':{'shopId':_0xc103f9},'data':_0x1a5736});}async[a52_0x179be7(0x1fc)](_0x597a64,_0x31c0d4){const _0x5037a9=a52_0x179be7;await this[_0x5037a9(0x1ce)](_0x597a64);const _0x3c543c={};_0x31c0d4[_0x5037a9(0x1c5)]!==undefined&&(_0x3c543c[_0x5037a9(0x1c5)]=_0x31c0d4[_0x5037a9(0x1c5)]||null),_0x31c0d4[_0x5037a9(0x1ca)]!==undefined&&(_0x3c543c[_0x5037a9(0x1ca)]=_0x31c0d4[_0x5037a9(0x1ca)]||[]),await database_1['default'][_0x5037a9(0x1ed)][_0x5037a9(0x1e8)]({'where':{'shopId':_0x597a64},'data':_0x3c543c});}async['revokeAllApiKeys'](_0x3e3ae6){const _0x417964=a52_0x179be7,_0x6baeeb=_0x417964(0x1e3)+crypto_1[_0x417964(0x1f7)]['randomBytes'](0x20)[_0x417964(0x1f1)]('hex'),_0x34fd93=_0x417964(0x1d6)+crypto_1[_0x417964(0x1f7)]['randomBytes'](0x20)[_0x417964(0x1f1)](_0x417964(0x1da));await database_1['default'][_0x417964(0x1ea)][_0x417964(0x1e8)]({'where':{'id':_0x3e3ae6},'data':{'publicKey':_0x6baeeb,'secretKey':_0x34fd93}});}async[a52_0x179be7(0x1fb)](_0x5b298f,_0x56a14f){const _0x101be8=a52_0x179be7,{passwordConfirmation:_0x37a0dc}=_0x56a14f,_0x1b19c1=await database_1[_0x101be8(0x1f7)][_0x101be8(0x1ea)][_0x101be8(0x1d0)]({'where':{'id':_0x5b298f},'select':{'password':!![]}});if(!_0x1b19c1)throw new Error(_0x101be8(0x1eb));const _0x250dd7=await bcryptjs_1[_0x101be8(0x1f7)]['compare'](_0x37a0dc,_0x1b19c1[_0x101be8(0x1db)]);if(!_0x250dd7)throw new Error(_0x101be8(0x1fe));await database_1[_0x101be8(0x1f7)][_0x101be8(0x1ea)][_0x101be8(0x1e2)]({'where':{'id':_0x5b298f}});}async['ensureSettingsExist'](_0x1dbb93){const _0x1f2d6f=a52_0x179be7,_0x4b932b=await database_1[_0x1f2d6f(0x1f7)]['shopSettings']['findUnique']({'where':{'shopId':_0x1dbb93}});!_0x4b932b&&await database_1[_0x1f2d6f(0x1f7)][_0x1f2d6f(0x1ed)][_0x1f2d6f(0x1c7)]({'data':{'shopId':_0x1dbb93}});}}exports[a52_0x179be7(0x1f6)]=SettingsService;