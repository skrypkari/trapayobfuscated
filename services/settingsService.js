'use strict';function a57_0x260a(){const _0x247ac1=['maskApiKey','3CoeiqP','hash','Shop\x20not\x20found','payment_success','21266VQAXiB','17240IWIrVe','compare','delete','1290dIQWOl','notificationRefund','length','default','crypto','findUnique','updateNotifications','__importDefault','name','api_error','isArray','changePassword','webhookUrl','create','telegramBotApiKey','password','repeat','60nXFQNs','562962LmEzOf','25377LUysbi','telegramChatId','notificationApiError','__esModule','ensureSettingsExist','webhookEvents','shopSettings','hex','payment_failed','1768pyWUvn','notificationLogin','13RprdKO','notificationPayout','payout','max','toString','shop','substring','shopUrl','chatId','refund','pk_','defineProperty','deleteAccount','telegram','8271ppkRNM','login','update','parse','string','182460NcavRQ','updateWebhookSettings','parseWebhookEvents','727172buDsOJ','../config/database','updateTelegramSettings','bcryptjs','notificationPaymentSuccess','notificationPaymentFailed','25KqmsFv','sk_','SettingsService'];a57_0x260a=function(){return _0x247ac1;};return a57_0x260a();}const a57_0x332f84=a57_0x4551;(function(_0x93dc81,_0x5ad9f0){const _0x12ad23=a57_0x4551,_0x2c9013=_0x93dc81();while(!![]){try{const _0xa85474=parseInt(_0x12ad23(0x1ce))/0x1*(-parseInt(_0x12ad23(0x1ba))/0x2)+-parseInt(_0x12ad23(0x1b5))/0x3*(parseInt(_0x12ad23(0x1ab))/0x4)+-parseInt(_0x12ad23(0x1b1))/0x5*(-parseInt(_0x12ad23(0x189))/0x6)+parseInt(_0x12ad23(0x1b9))/0x7+parseInt(_0x12ad23(0x193))/0x8*(parseInt(_0x12ad23(0x1a3))/0x9)+parseInt(_0x12ad23(0x1bd))/0xa*(parseInt(_0x12ad23(0x18a))/0xb)+parseInt(_0x12ad23(0x1a8))/0xc*(parseInt(_0x12ad23(0x195))/0xd);if(_0xa85474===_0x5ad9f0)break;else _0x2c9013['push'](_0x2c9013['shift']());}catch(_0x2f8f9a){_0x2c9013['push'](_0x2c9013['shift']());}}}(a57_0x260a,0x4693f));function a57_0x4551(_0x7ef6b8,_0x278791){const _0x260a58=a57_0x260a();return a57_0x4551=function(_0x4551c5,_0xf10ca){_0x4551c5=_0x4551c5-0x189;let _0x459766=_0x260a58[_0x4551c5];return _0x459766;},a57_0x4551(_0x7ef6b8,_0x278791);}var __importDefault=this&&this[a57_0x332f84(0x1c4)]||function(_0x21eac2){const _0x240827=a57_0x332f84;return _0x21eac2&&_0x21eac2[_0x240827(0x18d)]?_0x21eac2:{'default':_0x21eac2};};Object[a57_0x332f84(0x1a0)](exports,a57_0x332f84(0x18d),{'value':!![]}),exports[a57_0x332f84(0x1b3)]=void 0x0;const bcryptjs_1=__importDefault(require(a57_0x332f84(0x1ae))),crypto_1=__importDefault(require(a57_0x332f84(0x1c1))),database_1=__importDefault(require(a57_0x332f84(0x1ac)));class SettingsService{[a57_0x332f84(0x1b4)](_0x4966e8){const _0x4d6e84=a57_0x332f84;if(!_0x4966e8)return'';if(_0x4966e8[_0x4d6e84(0x1bf)]<=0x8)return _0x4966e8;const _0x332105=_0x4966e8[_0x4d6e84(0x19b)](0x0,0x8),_0x495eff='*'[_0x4d6e84(0x1cd)](Math[_0x4d6e84(0x198)](0x0,_0x4966e8[_0x4d6e84(0x1bf)]-0x8));return _0x332105+_0x495eff;}[a57_0x332f84(0x1aa)](_0x144bed){const _0x5868dc=a57_0x332f84;if(!_0x144bed)return[];if(Array[_0x5868dc(0x1c7)](_0x144bed))return _0x144bed;if(typeof _0x144bed===_0x5868dc(0x1a7))try{const _0x18ec89=JSON[_0x5868dc(0x1a6)](_0x144bed);return Array[_0x5868dc(0x1c7)](_0x18ec89)?_0x18ec89:[];}catch{return[];}return[];}async['getShopSettings'](_0x23b0ed){const _0x7d1963=a57_0x332f84,_0x480b05=await database_1[_0x7d1963(0x1c0)][_0x7d1963(0x19a)][_0x7d1963(0x1c2)]({'where':{'id':_0x23b0ed},'include':{'settings':!![]}});if(!_0x480b05)throw new Error(_0x7d1963(0x1b7));let _0x500505=_0x480b05['settings'];return!_0x500505&&(_0x500505=await database_1[_0x7d1963(0x1c0)]['shopSettings']['create']({'data':{'shopId':_0x480b05['id']}})),{'fullName':_0x480b05[_0x7d1963(0x1c5)],'brand':_0x480b05['name'],'merchantUrl':_0x480b05[_0x7d1963(0x19c)],'telegramUsername':_0x480b05[_0x7d1963(0x1a2)],'telegramBotApiKey':_0x500505[_0x7d1963(0x1cb)]?this[_0x7d1963(0x1b4)](_0x500505[_0x7d1963(0x1cb)]):null,'telegramChatId':_0x500505[_0x7d1963(0x18b)],'webhookUrl':_0x500505[_0x7d1963(0x1c9)],'webhookEvents':this[_0x7d1963(0x1aa)](_0x500505['webhookEvents']),'notifications':{'payment_success':_0x500505[_0x7d1963(0x1af)],'payment_failed':_0x500505[_0x7d1963(0x1b0)],'refund':_0x500505[_0x7d1963(0x1be)],'payout':_0x500505[_0x7d1963(0x196)],'login':_0x500505[_0x7d1963(0x194)],'api_error':_0x500505[_0x7d1963(0x18c)]}};}async[a57_0x332f84(0x1c8)](_0x1b64d6,_0x2afe66){const _0x539da3=a57_0x332f84,{currentPassword:_0x574625,newPassword:_0x4f3bd4,confirmNewPassword:_0x58fb6d}=_0x2afe66;if(_0x4f3bd4!==_0x58fb6d)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x4f3bd4[_0x539da3(0x1bf)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x280aee=await database_1[_0x539da3(0x1c0)][_0x539da3(0x19a)][_0x539da3(0x1c2)]({'where':{'id':_0x1b64d6},'select':{'password':!![]}});if(!_0x280aee)throw new Error(_0x539da3(0x1b7));const _0x2575cd=await bcryptjs_1[_0x539da3(0x1c0)][_0x539da3(0x1bb)](_0x574625,_0x280aee[_0x539da3(0x1cc)]);if(!_0x2575cd)throw new Error('Current\x20password\x20is\x20incorrect');const _0x50c6d0=await bcryptjs_1['default'][_0x539da3(0x1b6)](_0x4f3bd4,0xc);await database_1[_0x539da3(0x1c0)][_0x539da3(0x19a)][_0x539da3(0x1a5)]({'where':{'id':_0x1b64d6},'data':{'password':_0x50c6d0}});}async[a57_0x332f84(0x1c3)](_0x2cec82,_0x204d11){const _0x5b3fc2=a57_0x332f84;await this[_0x5b3fc2(0x18e)](_0x2cec82);const _0x4c87ce={};_0x204d11['payment_success']!==undefined&&(_0x4c87ce[_0x5b3fc2(0x1af)]=_0x204d11[_0x5b3fc2(0x1b8)]),_0x204d11[_0x5b3fc2(0x192)]!==undefined&&(_0x4c87ce[_0x5b3fc2(0x1b0)]=_0x204d11['payment_failed']),_0x204d11[_0x5b3fc2(0x19e)]!==undefined&&(_0x4c87ce[_0x5b3fc2(0x1be)]=_0x204d11[_0x5b3fc2(0x19e)]),_0x204d11['payout']!==undefined&&(_0x4c87ce[_0x5b3fc2(0x196)]=_0x204d11[_0x5b3fc2(0x197)]),_0x204d11[_0x5b3fc2(0x1a4)]!==undefined&&(_0x4c87ce[_0x5b3fc2(0x194)]=_0x204d11[_0x5b3fc2(0x1a4)]),_0x204d11[_0x5b3fc2(0x1c6)]!==undefined&&(_0x4c87ce[_0x5b3fc2(0x18c)]=_0x204d11[_0x5b3fc2(0x1c6)]),await database_1['default'][_0x5b3fc2(0x190)]['update']({'where':{'shopId':_0x2cec82},'data':_0x4c87ce});}async[a57_0x332f84(0x1ad)](_0x4d4662,_0x20c75d){const _0x3e25d8=a57_0x332f84;await this[_0x3e25d8(0x18e)](_0x4d4662);const _0x22ef53={};_0x20c75d['botApiKey']!==undefined&&(_0x22ef53[_0x3e25d8(0x1cb)]=_0x20c75d['botApiKey']||null),_0x20c75d[_0x3e25d8(0x19d)]!==undefined&&(_0x22ef53[_0x3e25d8(0x18b)]=_0x20c75d[_0x3e25d8(0x19d)]||null),await database_1['default'][_0x3e25d8(0x190)][_0x3e25d8(0x1a5)]({'where':{'shopId':_0x4d4662},'data':_0x22ef53});}async[a57_0x332f84(0x1a9)](_0x4b7fef,_0x338c35){const _0x2864c4=a57_0x332f84;await this[_0x2864c4(0x18e)](_0x4b7fef);const _0x57316e={};_0x338c35[_0x2864c4(0x1c9)]!==undefined&&(_0x57316e[_0x2864c4(0x1c9)]=_0x338c35[_0x2864c4(0x1c9)]||null),_0x338c35[_0x2864c4(0x18f)]!==undefined&&(_0x57316e[_0x2864c4(0x18f)]=_0x338c35[_0x2864c4(0x18f)]||[]),await database_1[_0x2864c4(0x1c0)]['shopSettings'][_0x2864c4(0x1a5)]({'where':{'shopId':_0x4b7fef},'data':_0x57316e});}async['revokeAllApiKeys'](_0x4e7e3d){const _0x308b3a=a57_0x332f84,_0x715e09=_0x308b3a(0x19f)+crypto_1[_0x308b3a(0x1c0)]['randomBytes'](0x20)[_0x308b3a(0x199)](_0x308b3a(0x191)),_0x157a4f=_0x308b3a(0x1b2)+crypto_1[_0x308b3a(0x1c0)]['randomBytes'](0x20)[_0x308b3a(0x199)](_0x308b3a(0x191));await database_1['default'][_0x308b3a(0x19a)][_0x308b3a(0x1a5)]({'where':{'id':_0x4e7e3d},'data':{'publicKey':_0x715e09,'secretKey':_0x157a4f}});}async[a57_0x332f84(0x1a1)](_0x1ca012,_0x23cd29){const _0x23395f=a57_0x332f84,{passwordConfirmation:_0x45c75e}=_0x23cd29,_0x2271f5=await database_1[_0x23395f(0x1c0)]['shop'][_0x23395f(0x1c2)]({'where':{'id':_0x1ca012},'select':{'password':!![]}});if(!_0x2271f5)throw new Error('Shop\x20not\x20found');const _0x9b2190=await bcryptjs_1['default'][_0x23395f(0x1bb)](_0x45c75e,_0x2271f5[_0x23395f(0x1cc)]);if(!_0x9b2190)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x23395f(0x1c0)][_0x23395f(0x19a)][_0x23395f(0x1bc)]({'where':{'id':_0x1ca012}});}async[a57_0x332f84(0x18e)](_0x5812da){const _0xbbaa8e=a57_0x332f84,_0xf0819c=await database_1[_0xbbaa8e(0x1c0)]['shopSettings'][_0xbbaa8e(0x1c2)]({'where':{'shopId':_0x5812da}});!_0xf0819c&&await database_1['default'][_0xbbaa8e(0x190)][_0xbbaa8e(0x1ca)]({'data':{'shopId':_0x5812da}});}}exports[a57_0x332f84(0x1b3)]=SettingsService;