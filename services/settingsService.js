'use strict';const a47_0x5d6512=a47_0x9f5d;(function(_0x9e660,_0x23e4b8){const _0x26160b=a47_0x9f5d,_0x294275=_0x9e660();while(!![]){try{const _0x3f628c=parseInt(_0x26160b(0xdf))/0x1+-parseInt(_0x26160b(0xe1))/0x2+-parseInt(_0x26160b(0xff))/0x3+-parseInt(_0x26160b(0xfc))/0x4*(parseInt(_0x26160b(0xef))/0x5)+-parseInt(_0x26160b(0xe6))/0x6+-parseInt(_0x26160b(0xf4))/0x7+parseInt(_0x26160b(0x107))/0x8;if(_0x3f628c===_0x23e4b8)break;else _0x294275['push'](_0x294275['shift']());}catch(_0x19738e){_0x294275['push'](_0x294275['shift']());}}}(a47_0x5055,0xa6cf0));var __importDefault=this&&this[a47_0x5d6512(0xcb)]||function(_0x5569fb){return _0x5569fb&&_0x5569fb['__esModule']?_0x5569fb:{'default':_0x5569fb};};Object[a47_0x5d6512(0xf2)](exports,a47_0x5d6512(0xe8),{'value':!![]}),exports[a47_0x5d6512(0xdc)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a47_0x5d6512(0xde))),database_1=__importDefault(require(a47_0x5d6512(0xe3)));class SettingsService{[a47_0x5d6512(0xe9)](_0x40160d){const _0x3e6495=a47_0x5d6512;if(!_0x40160d)return'';if(_0x40160d['length']<=0x8)return _0x40160d;const _0x9a398c=_0x40160d['substring'](0x0,0x8),_0x217164='*'['repeat'](Math['max'](0x0,_0x40160d[_0x3e6495(0xe2)]-0x8));return _0x9a398c+_0x217164;}[a47_0x5d6512(0x108)](_0xb5f736){const _0x3c0937=a47_0x5d6512;if(!_0xb5f736)return[];if(Array[_0x3c0937(0xd9)](_0xb5f736))return _0xb5f736;if(typeof _0xb5f736===_0x3c0937(0xd1))try{const _0x169749=JSON[_0x3c0937(0xda)](_0xb5f736);return Array[_0x3c0937(0xd9)](_0x169749)?_0x169749:[];}catch{return[];}return[];}async[a47_0x5d6512(0xd8)](_0x590df2){const _0x5e9cf4=a47_0x5d6512,_0x3b9f7b=await database_1[_0x5e9cf4(0xe5)][_0x5e9cf4(0xca)]['findUnique']({'where':{'id':_0x590df2},'include':{'settings':!![]}});if(!_0x3b9f7b)throw new Error(_0x5e9cf4(0xf6));let _0x31f882=_0x3b9f7b['settings'];return!_0x31f882&&(_0x31f882=await database_1[_0x5e9cf4(0xe5)][_0x5e9cf4(0xf0)][_0x5e9cf4(0x102)]({'data':{'shopId':_0x3b9f7b['id']}})),{'fullName':_0x3b9f7b[_0x5e9cf4(0xec)],'brand':_0x3b9f7b['name'],'merchantUrl':_0x3b9f7b[_0x5e9cf4(0x104)],'telegramUsername':_0x3b9f7b[_0x5e9cf4(0xf5)],'telegramBotApiKey':_0x31f882[_0x5e9cf4(0xe7)]?this[_0x5e9cf4(0xe9)](_0x31f882[_0x5e9cf4(0xe7)]):null,'telegramChatId':_0x31f882[_0x5e9cf4(0xe4)],'webhookUrl':_0x31f882['webhookUrl'],'webhookEvents':this[_0x5e9cf4(0x108)](_0x31f882[_0x5e9cf4(0xe0)]),'notifications':{'payment_success':_0x31f882[_0x5e9cf4(0x100)],'payment_failed':_0x31f882[_0x5e9cf4(0xd4)],'refund':_0x31f882['notificationRefund'],'payout':_0x31f882[_0x5e9cf4(0xf9)],'login':_0x31f882[_0x5e9cf4(0xdd)],'api_error':_0x31f882[_0x5e9cf4(0xed)]}};}async['changePassword'](_0x21e095,_0x1cbde7){const _0x37944f=a47_0x5d6512,{currentPassword:_0x21d749,newPassword:_0x4a4ffb,confirmNewPassword:_0xd58b21}=_0x1cbde7;if(_0x4a4ffb!==_0xd58b21)throw new Error(_0x37944f(0x101));if(_0x4a4ffb[_0x37944f(0xe2)]<0x6)throw new Error(_0x37944f(0xcf));const _0x1d1ff3=await database_1['default'][_0x37944f(0xca)][_0x37944f(0x105)]({'where':{'id':_0x21e095},'select':{'password':!![]}});if(!_0x1d1ff3)throw new Error(_0x37944f(0xf6));const _0x2ad4f9=await bcryptjs_1[_0x37944f(0xe5)]['compare'](_0x21d749,_0x1d1ff3[_0x37944f(0xcd)]);if(!_0x2ad4f9)throw new Error(_0x37944f(0x103));const _0x5b1b0d=await bcryptjs_1['default'][_0x37944f(0xd5)](_0x4a4ffb,0xc);await database_1['default'][_0x37944f(0xca)][_0x37944f(0xfd)]({'where':{'id':_0x21e095},'data':{'password':_0x5b1b0d}});}async[a47_0x5d6512(0xeb)](_0x963cd8,_0x13836b){const _0x1b34d0=a47_0x5d6512;await this[_0x1b34d0(0xf8)](_0x963cd8);const _0x4b2466={};_0x13836b[_0x1b34d0(0xfa)]!==undefined&&(_0x4b2466['notificationPaymentSuccess']=_0x13836b[_0x1b34d0(0xfa)]),_0x13836b[_0x1b34d0(0xf7)]!==undefined&&(_0x4b2466[_0x1b34d0(0xd4)]=_0x13836b[_0x1b34d0(0xf7)]),_0x13836b[_0x1b34d0(0xd2)]!==undefined&&(_0x4b2466[_0x1b34d0(0xd3)]=_0x13836b[_0x1b34d0(0xd2)]),_0x13836b[_0x1b34d0(0xea)]!==undefined&&(_0x4b2466[_0x1b34d0(0xf9)]=_0x13836b[_0x1b34d0(0xea)]),_0x13836b[_0x1b34d0(0xf3)]!==undefined&&(_0x4b2466[_0x1b34d0(0xdd)]=_0x13836b[_0x1b34d0(0xf3)]),_0x13836b[_0x1b34d0(0xd6)]!==undefined&&(_0x4b2466['notificationApiError']=_0x13836b[_0x1b34d0(0xd6)]),await database_1['default']['shopSettings'][_0x1b34d0(0xfd)]({'where':{'shopId':_0x963cd8},'data':_0x4b2466});}async[a47_0x5d6512(0xf1)](_0x33748b,_0x38a24b){const _0x327890=a47_0x5d6512;await this[_0x327890(0xf8)](_0x33748b);const _0x3be90e={};_0x38a24b['botApiKey']!==undefined&&(_0x3be90e[_0x327890(0xe7)]=_0x38a24b[_0x327890(0xdb)]||null),_0x38a24b['chatId']!==undefined&&(_0x3be90e[_0x327890(0xe4)]=_0x38a24b[_0x327890(0xee)]||null),await database_1[_0x327890(0xe5)]['shopSettings']['update']({'where':{'shopId':_0x33748b},'data':_0x3be90e});}async[a47_0x5d6512(0xc9)](_0x34a6af,_0x79a752){const _0x2cda6e=a47_0x5d6512;await this[_0x2cda6e(0xf8)](_0x34a6af);const _0x451be7={};_0x79a752[_0x2cda6e(0xfe)]!==undefined&&(_0x451be7[_0x2cda6e(0xfe)]=_0x79a752[_0x2cda6e(0xfe)]||null),_0x79a752['webhookEvents']!==undefined&&(_0x451be7[_0x2cda6e(0xe0)]=_0x79a752[_0x2cda6e(0xe0)]||[]),await database_1[_0x2cda6e(0xe5)][_0x2cda6e(0xf0)][_0x2cda6e(0xfd)]({'where':{'shopId':_0x34a6af},'data':_0x451be7});}async[a47_0x5d6512(0xc8)](_0x46a055){const _0x3a8e55=a47_0x5d6512,_0x512b8d=_0x3a8e55(0xd0)+crypto_1[_0x3a8e55(0xe5)][_0x3a8e55(0xcc)](0x20)['toString'](_0x3a8e55(0xce)),_0xce3a53=_0x3a8e55(0x109)+crypto_1[_0x3a8e55(0xe5)][_0x3a8e55(0xcc)](0x20)['toString'](_0x3a8e55(0xce));await database_1['default'][_0x3a8e55(0xca)]['update']({'where':{'id':_0x46a055},'data':{'publicKey':_0x512b8d,'secretKey':_0xce3a53}});}async[a47_0x5d6512(0xd7)](_0x2c5044,_0x16c3d9){const _0x33a262=a47_0x5d6512,{passwordConfirmation:_0x4fe773}=_0x16c3d9,_0x240db5=await database_1[_0x33a262(0xe5)]['shop'][_0x33a262(0x105)]({'where':{'id':_0x2c5044},'select':{'password':!![]}});if(!_0x240db5)throw new Error('Shop\x20not\x20found');const _0xabfad4=await bcryptjs_1[_0x33a262(0xe5)]['compare'](_0x4fe773,_0x240db5[_0x33a262(0xcd)]);if(!_0xabfad4)throw new Error(_0x33a262(0x106));await database_1['default'][_0x33a262(0xca)][_0x33a262(0xfb)]({'where':{'id':_0x2c5044}});}async[a47_0x5d6512(0xf8)](_0x8f54cb){const _0x5810ff=a47_0x5d6512,_0x1a4b18=await database_1[_0x5810ff(0xe5)][_0x5810ff(0xf0)][_0x5810ff(0x105)]({'where':{'shopId':_0x8f54cb}});!_0x1a4b18&&await database_1['default'][_0x5810ff(0xf0)][_0x5810ff(0x102)]({'data':{'shopId':_0x8f54cb}});}}exports['SettingsService']=SettingsService;function a47_0x9f5d(_0x33bffd,_0x3750f8){const _0x505507=a47_0x5055();return a47_0x9f5d=function(_0x9f5de1,_0x557bf1){_0x9f5de1=_0x9f5de1-0xc8;let _0x263b6c=_0x505507[_0x9f5de1];return _0x263b6c;},a47_0x9f5d(_0x33bffd,_0x3750f8);}function a47_0x5055(){const _0x126146=['Current\x20password\x20is\x20incorrect','shopUrl','findUnique','Password\x20confirmation\x20is\x20incorrect','27290088VppNor','parseWebhookEvents','sk_','revokeAllApiKeys','updateWebhookSettings','shop','__importDefault','randomBytes','password','hex','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','pk_','string','refund','notificationRefund','notificationPaymentFailed','hash','api_error','deleteAccount','getShopSettings','isArray','parse','botApiKey','SettingsService','notificationLogin','crypto','237763MgJKLA','webhookEvents','293492slPyZv','length','../config/database','telegramChatId','default','5267820GVxVwm','telegramBotApiKey','__esModule','maskApiKey','payout','updateNotifications','name','notificationApiError','chatId','2045BEbvzn','shopSettings','updateTelegramSettings','defineProperty','login','6888231yztBVe','telegram','Shop\x20not\x20found','payment_failed','ensureSettingsExist','notificationPayout','payment_success','delete','9052MvJOzz','update','webhookUrl','94380FqVfWg','notificationPaymentSuccess','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','create'];a47_0x5055=function(){return _0x126146;};return a47_0x5055();}