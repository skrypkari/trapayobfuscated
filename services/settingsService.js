'use strict';const a52_0x3376fb=a52_0x38c0;(function(_0xd4314e,_0x471277){const _0x631dd7=a52_0x38c0,_0x1e4a17=_0xd4314e();while(!![]){try{const _0x11835a=-parseInt(_0x631dd7(0xd0))/0x1*(parseInt(_0x631dd7(0xa7))/0x2)+-parseInt(_0x631dd7(0xb6))/0x3*(-parseInt(_0x631dd7(0x9f))/0x4)+-parseInt(_0x631dd7(0x99))/0x5+-parseInt(_0x631dd7(0xae))/0x6*(parseInt(_0x631dd7(0xce))/0x7)+parseInt(_0x631dd7(0xc8))/0x8*(parseInt(_0x631dd7(0xd9))/0x9)+-parseInt(_0x631dd7(0xbc))/0xa+parseInt(_0x631dd7(0xcc))/0xb;if(_0x11835a===_0x471277)break;else _0x1e4a17['push'](_0x1e4a17['shift']());}catch(_0x24543d){_0x1e4a17['push'](_0x1e4a17['shift']());}}}(a52_0x2f74,0x2931b));var __importDefault=this&&this[a52_0x3376fb(0xc1)]||function(_0x101abc){const _0x3465ed=a52_0x3376fb;return _0x101abc&&_0x101abc[_0x3465ed(0xb3)]?_0x101abc:{'default':_0x101abc};};function a52_0x38c0(_0x3d6998,_0xf365ab){const _0x2f747b=a52_0x2f74();return a52_0x38c0=function(_0x38c064,_0x12bb28){_0x38c064=_0x38c064-0x96;let _0x580a32=_0x2f747b[_0x38c064];return _0x580a32;},a52_0x38c0(_0x3d6998,_0xf365ab);}Object[a52_0x3376fb(0xca)](exports,a52_0x3376fb(0xb3),{'value':!![]}),exports[a52_0x3376fb(0xd8)]=void 0x0;function a52_0x2f74(){const _0x52e79f=['9sLhinZ','substring','webhookEvents','shopUrl','default','hex','323930gbdAKL','bcryptjs','../config/database','string','telegramBotApiKey','isArray','7080gtPgcT','notificationLogin','repeat','telegram','chatId','webhookUrl','deleteAccount','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','357902DGFaML','pk_','settings','delete','toString','refund','shopSettings','35382aoArPt','compare','payout','notificationApiError','revokeAllApiKeys','__esModule','name','Current\x20password\x20is\x20incorrect','51SJezCI','updateTelegramSettings','login','notificationPaymentSuccess','hash','telegramChatId','643390xXtyFl','shop','changePassword','notificationRefund','maskApiKey','__importDefault','findUnique','notificationPaymentFailed','Shop\x20not\x20found','create','update','botApiKey','2450072Yjcjua','randomBytes','defineProperty','updateNotifications','4723521bUupfk','ensureSettingsExist','343qSnBDz','payment_success','1AYycfg','api_error','parse','payment_failed','password','parseWebhookEvents','length','max','SettingsService'];a52_0x2f74=function(){return _0x52e79f;};return a52_0x2f74();}const bcryptjs_1=__importDefault(require(a52_0x3376fb(0x9a))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a52_0x3376fb(0x9b)));class SettingsService{[a52_0x3376fb(0xc0)](_0x388b27){const _0x218f8c=a52_0x3376fb;if(!_0x388b27)return'';if(_0x388b27[_0x218f8c(0xd6)]<=0x8)return _0x388b27;const _0x1087e1=_0x388b27[_0x218f8c(0xda)](0x0,0x8),_0x206093='*'[_0x218f8c(0xa1)](Math[_0x218f8c(0xd7)](0x0,_0x388b27[_0x218f8c(0xd6)]-0x8));return _0x1087e1+_0x206093;}[a52_0x3376fb(0xd5)](_0x38a9bb){const _0x2ec88b=a52_0x3376fb;if(!_0x38a9bb)return[];if(Array[_0x2ec88b(0x9e)](_0x38a9bb))return _0x38a9bb;if(typeof _0x38a9bb===_0x2ec88b(0x9c))try{const _0x268759=JSON[_0x2ec88b(0xd2)](_0x38a9bb);return Array[_0x2ec88b(0x9e)](_0x268759)?_0x268759:[];}catch{return[];}return[];}async['getShopSettings'](_0x38cf8f){const _0x2461bc=a52_0x3376fb,_0x58fe54=await database_1[_0x2461bc(0x97)][_0x2461bc(0xbd)]['findUnique']({'where':{'id':_0x38cf8f},'include':{'settings':!![]}});if(!_0x58fe54)throw new Error(_0x2461bc(0xc4));let _0x4ecd33=_0x58fe54[_0x2461bc(0xa9)];return!_0x4ecd33&&(_0x4ecd33=await database_1[_0x2461bc(0x97)][_0x2461bc(0xad)][_0x2461bc(0xc5)]({'data':{'shopId':_0x58fe54['id']}})),{'fullName':_0x58fe54[_0x2461bc(0xb4)],'brand':_0x58fe54[_0x2461bc(0xb4)],'merchantUrl':_0x58fe54[_0x2461bc(0x96)],'telegramUsername':_0x58fe54[_0x2461bc(0xa2)],'telegramBotApiKey':_0x4ecd33[_0x2461bc(0x9d)]?this[_0x2461bc(0xc0)](_0x4ecd33['telegramBotApiKey']):null,'telegramChatId':_0x4ecd33[_0x2461bc(0xbb)],'webhookUrl':_0x4ecd33[_0x2461bc(0xa4)],'webhookEvents':this[_0x2461bc(0xd5)](_0x4ecd33[_0x2461bc(0xdb)]),'notifications':{'payment_success':_0x4ecd33[_0x2461bc(0xb9)],'payment_failed':_0x4ecd33[_0x2461bc(0xc3)],'refund':_0x4ecd33[_0x2461bc(0xbf)],'payout':_0x4ecd33['notificationPayout'],'login':_0x4ecd33[_0x2461bc(0xa0)],'api_error':_0x4ecd33[_0x2461bc(0xb1)]}};}async[a52_0x3376fb(0xbe)](_0x135293,_0x23026a){const _0x1c1c7f=a52_0x3376fb,{currentPassword:_0x3755c3,newPassword:_0x2e0262,confirmNewPassword:_0x347cf0}=_0x23026a;if(_0x2e0262!==_0x347cf0)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x2e0262[_0x1c1c7f(0xd6)]<0x6)throw new Error(_0x1c1c7f(0xa6));const _0x57abef=await database_1[_0x1c1c7f(0x97)][_0x1c1c7f(0xbd)]['findUnique']({'where':{'id':_0x135293},'select':{'password':!![]}});if(!_0x57abef)throw new Error('Shop\x20not\x20found');const _0x1a1376=await bcryptjs_1['default'][_0x1c1c7f(0xaf)](_0x3755c3,_0x57abef['password']);if(!_0x1a1376)throw new Error(_0x1c1c7f(0xb5));const _0x4f9072=await bcryptjs_1[_0x1c1c7f(0x97)][_0x1c1c7f(0xba)](_0x2e0262,0xc);await database_1[_0x1c1c7f(0x97)]['shop'][_0x1c1c7f(0xc6)]({'where':{'id':_0x135293},'data':{'password':_0x4f9072}});}async[a52_0x3376fb(0xcb)](_0xc5af23,_0x544fc1){const _0x2be8b4=a52_0x3376fb;await this[_0x2be8b4(0xcd)](_0xc5af23);const _0x3ebf56={};_0x544fc1[_0x2be8b4(0xcf)]!==undefined&&(_0x3ebf56['notificationPaymentSuccess']=_0x544fc1[_0x2be8b4(0xcf)]),_0x544fc1[_0x2be8b4(0xd3)]!==undefined&&(_0x3ebf56[_0x2be8b4(0xc3)]=_0x544fc1[_0x2be8b4(0xd3)]),_0x544fc1[_0x2be8b4(0xac)]!==undefined&&(_0x3ebf56['notificationRefund']=_0x544fc1[_0x2be8b4(0xac)]),_0x544fc1[_0x2be8b4(0xb0)]!==undefined&&(_0x3ebf56['notificationPayout']=_0x544fc1[_0x2be8b4(0xb0)]),_0x544fc1[_0x2be8b4(0xb8)]!==undefined&&(_0x3ebf56[_0x2be8b4(0xa0)]=_0x544fc1[_0x2be8b4(0xb8)]),_0x544fc1[_0x2be8b4(0xd1)]!==undefined&&(_0x3ebf56['notificationApiError']=_0x544fc1[_0x2be8b4(0xd1)]),await database_1[_0x2be8b4(0x97)]['shopSettings']['update']({'where':{'shopId':_0xc5af23},'data':_0x3ebf56});}async[a52_0x3376fb(0xb7)](_0x373243,_0x176079){const _0x363e60=a52_0x3376fb;await this[_0x363e60(0xcd)](_0x373243);const _0x4d7b98={};_0x176079[_0x363e60(0xc7)]!==undefined&&(_0x4d7b98[_0x363e60(0x9d)]=_0x176079[_0x363e60(0xc7)]||null),_0x176079[_0x363e60(0xa3)]!==undefined&&(_0x4d7b98[_0x363e60(0xbb)]=_0x176079[_0x363e60(0xa3)]||null),await database_1[_0x363e60(0x97)][_0x363e60(0xad)][_0x363e60(0xc6)]({'where':{'shopId':_0x373243},'data':_0x4d7b98});}async['updateWebhookSettings'](_0x1b70db,_0x5ed710){const _0x3a4965=a52_0x3376fb;await this[_0x3a4965(0xcd)](_0x1b70db);const _0x310cb8={};_0x5ed710[_0x3a4965(0xa4)]!==undefined&&(_0x310cb8[_0x3a4965(0xa4)]=_0x5ed710[_0x3a4965(0xa4)]||null),_0x5ed710[_0x3a4965(0xdb)]!==undefined&&(_0x310cb8[_0x3a4965(0xdb)]=_0x5ed710['webhookEvents']||[]),await database_1[_0x3a4965(0x97)][_0x3a4965(0xad)]['update']({'where':{'shopId':_0x1b70db},'data':_0x310cb8});}async[a52_0x3376fb(0xb2)](_0x55c995){const _0x1a6e43=a52_0x3376fb,_0x52f121=_0x1a6e43(0xa8)+crypto_1[_0x1a6e43(0x97)][_0x1a6e43(0xc9)](0x20)[_0x1a6e43(0xab)](_0x1a6e43(0x98)),_0x235f36='sk_'+crypto_1[_0x1a6e43(0x97)][_0x1a6e43(0xc9)](0x20)[_0x1a6e43(0xab)](_0x1a6e43(0x98));await database_1['default'][_0x1a6e43(0xbd)][_0x1a6e43(0xc6)]({'where':{'id':_0x55c995},'data':{'publicKey':_0x52f121,'secretKey':_0x235f36}});}async[a52_0x3376fb(0xa5)](_0x589c3c,_0x571f64){const _0xbea929=a52_0x3376fb,{passwordConfirmation:_0x1b7692}=_0x571f64,_0x5e601e=await database_1[_0xbea929(0x97)][_0xbea929(0xbd)][_0xbea929(0xc2)]({'where':{'id':_0x589c3c},'select':{'password':!![]}});if(!_0x5e601e)throw new Error(_0xbea929(0xc4));const _0xedff61=await bcryptjs_1['default'][_0xbea929(0xaf)](_0x1b7692,_0x5e601e[_0xbea929(0xd4)]);if(!_0xedff61)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0xbea929(0x97)][_0xbea929(0xbd)][_0xbea929(0xaa)]({'where':{'id':_0x589c3c}});}async[a52_0x3376fb(0xcd)](_0x37ea0c){const _0x3bf40f=a52_0x3376fb,_0x44cdee=await database_1[_0x3bf40f(0x97)]['shopSettings'][_0x3bf40f(0xc2)]({'where':{'shopId':_0x37ea0c}});!_0x44cdee&&await database_1[_0x3bf40f(0x97)][_0x3bf40f(0xad)][_0x3bf40f(0xc5)]({'data':{'shopId':_0x37ea0c}});}}exports[a52_0x3376fb(0xd8)]=SettingsService;