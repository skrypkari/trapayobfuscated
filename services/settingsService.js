'use strict';const a64_0xb12173=a64_0x55c4;(function(_0x348857,_0x482cb8){const _0x5f0d0e=a64_0x55c4,_0xd83256=_0x348857();while(!![]){try{const _0x19dbd4=parseInt(_0x5f0d0e(0x7a))/0x1*(-parseInt(_0x5f0d0e(0x8f))/0x2)+-parseInt(_0x5f0d0e(0x95))/0x3*(-parseInt(_0x5f0d0e(0x68))/0x4)+parseInt(_0x5f0d0e(0x79))/0x5+parseInt(_0x5f0d0e(0x86))/0x6+-parseInt(_0x5f0d0e(0x8e))/0x7+-parseInt(_0x5f0d0e(0x8b))/0x8*(-parseInt(_0x5f0d0e(0xa1))/0x9)+-parseInt(_0x5f0d0e(0x88))/0xa*(parseInt(_0x5f0d0e(0xa8))/0xb);if(_0x19dbd4===_0x482cb8)break;else _0xd83256['push'](_0xd83256['shift']());}catch(_0x4f4ef1){_0xd83256['push'](_0xd83256['shift']());}}}(a64_0x40bd,0x201e3));function a64_0x40bd(){const _0x16cc28=['parse','findUnique','maskApiKey','shop','payment_failed','telegramBotApiKey','1500024ZkMEBf','notificationApiError','528870ShJkjY','refund','crypto','104zJcxix','repeat','../config/database','1787499HaUBbg','10046lnqufm','updateTelegramSettings','shopSettings','notificationPayout','login','SettingsService','3LrDNzP','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','name','__importDefault','Shop\x20not\x20found','notificationPaymentFailed','shopUrl','__esModule','Password\x20confirmation\x20is\x20incorrect','parseWebhookEvents','changePassword','settings','104724KPjRlV','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','Current\x20password\x20is\x20incorrect','notificationLogin','length','password','webhookUrl','77jOnNpu','ensureSettingsExist','max','substring','api_error','notificationRefund','defineProperty','hex','924932HkkeBk','getShopSettings','update','botApiKey','default','payment_success','randomBytes','revokeAllApiKeys','toString','sk_','deleteAccount','webhookEvents','payout','telegram','compare','telegramChatId','hash','1276070WoVgLW','26rSLSLR','updateNotifications','notificationPaymentSuccess','chatId','create','isArray'];a64_0x40bd=function(){return _0x16cc28;};return a64_0x40bd();}var __importDefault=this&&this[a64_0xb12173(0x98)]||function(_0x5b2ef3){const _0x44b9b1=a64_0xb12173;return _0x5b2ef3&&_0x5b2ef3[_0x44b9b1(0x9c)]?_0x5b2ef3:{'default':_0x5b2ef3};};Object[a64_0xb12173(0x66)](exports,a64_0xb12173(0x9c),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a64_0xb12173(0x8a))),database_1=__importDefault(require(a64_0xb12173(0x8d)));function a64_0x55c4(_0x36392a,_0x5b0618){const _0x40bd2a=a64_0x40bd();return a64_0x55c4=function(_0x55c487,_0x4a1be0){_0x55c487=_0x55c487-0x65;let _0x21b9de=_0x40bd2a[_0x55c487];return _0x21b9de;},a64_0x55c4(_0x36392a,_0x5b0618);}class SettingsService{[a64_0xb12173(0x82)](_0x249ed9){const _0x28ace0=a64_0xb12173;if(!_0x249ed9)return'';if(_0x249ed9[_0x28ace0(0xa5)]<=0x8)return _0x249ed9;const _0x3ca885=_0x249ed9[_0x28ace0(0xab)](0x0,0x8),_0x1e680d='*'[_0x28ace0(0x8c)](Math[_0x28ace0(0xaa)](0x0,_0x249ed9[_0x28ace0(0xa5)]-0x8));return _0x3ca885+_0x1e680d;}[a64_0xb12173(0x9e)](_0x122f3f){const _0x1ed436=a64_0xb12173;if(!_0x122f3f)return[];if(Array[_0x1ed436(0x7f)](_0x122f3f))return _0x122f3f;if(typeof _0x122f3f==='string')try{const _0x871e05=JSON[_0x1ed436(0x80)](_0x122f3f);return Array[_0x1ed436(0x7f)](_0x871e05)?_0x871e05:[];}catch{return[];}return[];}async[a64_0xb12173(0x69)](_0x64ccdc){const _0x2bb9a5=a64_0xb12173,_0x42c9bf=await database_1[_0x2bb9a5(0x6c)][_0x2bb9a5(0x83)][_0x2bb9a5(0x81)]({'where':{'id':_0x64ccdc},'include':{'settings':!![]}});if(!_0x42c9bf)throw new Error(_0x2bb9a5(0x99));let _0x1302eb=_0x42c9bf[_0x2bb9a5(0xa0)];return!_0x1302eb&&(_0x1302eb=await database_1['default'][_0x2bb9a5(0x91)][_0x2bb9a5(0x7e)]({'data':{'shopId':_0x42c9bf['id']}})),{'fullName':_0x42c9bf[_0x2bb9a5(0x97)],'brand':_0x42c9bf[_0x2bb9a5(0x97)],'merchantUrl':_0x42c9bf[_0x2bb9a5(0x9b)],'telegramUsername':_0x42c9bf[_0x2bb9a5(0x75)],'telegramBotApiKey':_0x1302eb['telegramBotApiKey']?this[_0x2bb9a5(0x82)](_0x1302eb[_0x2bb9a5(0x85)]):null,'telegramChatId':_0x1302eb[_0x2bb9a5(0x77)],'webhookUrl':_0x1302eb[_0x2bb9a5(0xa7)],'webhookEvents':this[_0x2bb9a5(0x9e)](_0x1302eb[_0x2bb9a5(0x73)]),'notifications':{'payment_success':_0x1302eb[_0x2bb9a5(0x7c)],'payment_failed':_0x1302eb[_0x2bb9a5(0x9a)],'refund':_0x1302eb[_0x2bb9a5(0x65)],'payout':_0x1302eb[_0x2bb9a5(0x92)],'login':_0x1302eb[_0x2bb9a5(0xa4)],'api_error':_0x1302eb[_0x2bb9a5(0x87)]}};}async[a64_0xb12173(0x9f)](_0x49c667,_0x502876){const _0x1a563b=a64_0xb12173,{currentPassword:_0x1f7800,newPassword:_0x291177,confirmNewPassword:_0x22bf96}=_0x502876;if(_0x291177!==_0x22bf96)throw new Error(_0x1a563b(0x96));if(_0x291177[_0x1a563b(0xa5)]<0x6)throw new Error(_0x1a563b(0xa2));const _0x322bd4=await database_1['default'][_0x1a563b(0x83)][_0x1a563b(0x81)]({'where':{'id':_0x49c667},'select':{'password':!![]}});if(!_0x322bd4)throw new Error(_0x1a563b(0x99));const _0x54f50b=await bcryptjs_1['default'][_0x1a563b(0x76)](_0x1f7800,_0x322bd4[_0x1a563b(0xa6)]);if(!_0x54f50b)throw new Error(_0x1a563b(0xa3));const _0x1a2381=await bcryptjs_1[_0x1a563b(0x6c)][_0x1a563b(0x78)](_0x291177,0xc);await database_1['default'][_0x1a563b(0x83)][_0x1a563b(0x6a)]({'where':{'id':_0x49c667},'data':{'password':_0x1a2381}});}async[a64_0xb12173(0x7b)](_0x1012d6,_0xc8d930){const _0x1fade7=a64_0xb12173;await this[_0x1fade7(0xa9)](_0x1012d6);const _0x4e05f9={};_0xc8d930[_0x1fade7(0x6d)]!==undefined&&(_0x4e05f9[_0x1fade7(0x7c)]=_0xc8d930[_0x1fade7(0x6d)]),_0xc8d930[_0x1fade7(0x84)]!==undefined&&(_0x4e05f9['notificationPaymentFailed']=_0xc8d930['payment_failed']),_0xc8d930[_0x1fade7(0x89)]!==undefined&&(_0x4e05f9[_0x1fade7(0x65)]=_0xc8d930['refund']),_0xc8d930[_0x1fade7(0x74)]!==undefined&&(_0x4e05f9[_0x1fade7(0x92)]=_0xc8d930['payout']),_0xc8d930[_0x1fade7(0x93)]!==undefined&&(_0x4e05f9['notificationLogin']=_0xc8d930[_0x1fade7(0x93)]),_0xc8d930[_0x1fade7(0xac)]!==undefined&&(_0x4e05f9[_0x1fade7(0x87)]=_0xc8d930[_0x1fade7(0xac)]),await database_1[_0x1fade7(0x6c)]['shopSettings'][_0x1fade7(0x6a)]({'where':{'shopId':_0x1012d6},'data':_0x4e05f9});}async[a64_0xb12173(0x90)](_0x31411f,_0x1f644e){const _0x431b20=a64_0xb12173;await this['ensureSettingsExist'](_0x31411f);const _0x4af50d={};_0x1f644e[_0x431b20(0x6b)]!==undefined&&(_0x4af50d[_0x431b20(0x85)]=_0x1f644e[_0x431b20(0x6b)]||null),_0x1f644e[_0x431b20(0x7d)]!==undefined&&(_0x4af50d[_0x431b20(0x77)]=_0x1f644e[_0x431b20(0x7d)]||null),await database_1[_0x431b20(0x6c)][_0x431b20(0x91)]['update']({'where':{'shopId':_0x31411f},'data':_0x4af50d});}async['updateWebhookSettings'](_0x4cbb29,_0x4e4b4c){const _0x2436d6=a64_0xb12173;await this[_0x2436d6(0xa9)](_0x4cbb29);const _0x7a367c={};_0x4e4b4c[_0x2436d6(0xa7)]!==undefined&&(_0x7a367c[_0x2436d6(0xa7)]=_0x4e4b4c[_0x2436d6(0xa7)]||null),_0x4e4b4c['webhookEvents']!==undefined&&(_0x7a367c[_0x2436d6(0x73)]=_0x4e4b4c[_0x2436d6(0x73)]||[]),await database_1['default'][_0x2436d6(0x91)]['update']({'where':{'shopId':_0x4cbb29},'data':_0x7a367c});}async[a64_0xb12173(0x6f)](_0x7c98f){const _0x7844f4=a64_0xb12173,_0xe059e8='pk_'+crypto_1[_0x7844f4(0x6c)][_0x7844f4(0x6e)](0x20)[_0x7844f4(0x70)](_0x7844f4(0x67)),_0xf1ed81=_0x7844f4(0x71)+crypto_1[_0x7844f4(0x6c)][_0x7844f4(0x6e)](0x20)[_0x7844f4(0x70)](_0x7844f4(0x67));await database_1[_0x7844f4(0x6c)][_0x7844f4(0x83)][_0x7844f4(0x6a)]({'where':{'id':_0x7c98f},'data':{'publicKey':_0xe059e8,'secretKey':_0xf1ed81}});}async[a64_0xb12173(0x72)](_0x7ca574,_0x7c0d34){const _0x482aae=a64_0xb12173,{passwordConfirmation:_0x5816fb}=_0x7c0d34,_0x5f2c04=await database_1[_0x482aae(0x6c)][_0x482aae(0x83)]['findUnique']({'where':{'id':_0x7ca574},'select':{'password':!![]}});if(!_0x5f2c04)throw new Error(_0x482aae(0x99));const _0x19fa98=await bcryptjs_1[_0x482aae(0x6c)]['compare'](_0x5816fb,_0x5f2c04[_0x482aae(0xa6)]);if(!_0x19fa98)throw new Error(_0x482aae(0x9d));await database_1[_0x482aae(0x6c)][_0x482aae(0x83)]['delete']({'where':{'id':_0x7ca574}});}async['ensureSettingsExist'](_0x2424e2){const _0x4e865e=a64_0xb12173,_0x17ed3a=await database_1['default']['shopSettings'][_0x4e865e(0x81)]({'where':{'shopId':_0x2424e2}});!_0x17ed3a&&await database_1[_0x4e865e(0x6c)]['shopSettings'][_0x4e865e(0x7e)]({'data':{'shopId':_0x2424e2}});}}exports[a64_0xb12173(0x94)]=SettingsService;