'use strict';const a76_0x15f76b=a76_0x201d;function a76_0x201d(_0x39fbbc,_0x814651){_0x39fbbc=_0x39fbbc-0x143;const _0xf7c4a3=a76_0xf7c4();let _0x201d23=_0xf7c4a3[_0x39fbbc];return _0x201d23;}(function(_0xec6474,_0x59bf3e){const _0x3fe7af=a76_0x201d,_0x360fd3=_0xec6474();while(!![]){try{const _0x4e4bca=parseInt(_0x3fe7af(0x153))/0x1+-parseInt(_0x3fe7af(0x14c))/0x2+-parseInt(_0x3fe7af(0x15f))/0x3*(parseInt(_0x3fe7af(0x15b))/0x4)+parseInt(_0x3fe7af(0x175))/0x5*(parseInt(_0x3fe7af(0x15a))/0x6)+-parseInt(_0x3fe7af(0x161))/0x7+parseInt(_0x3fe7af(0x166))/0x8*(parseInt(_0x3fe7af(0x181))/0x9)+parseInt(_0x3fe7af(0x14d))/0xa*(-parseInt(_0x3fe7af(0x14a))/0xb);if(_0x4e4bca===_0x59bf3e)break;else _0x360fd3['push'](_0x360fd3['shift']());}catch(_0xe3b867){_0x360fd3['push'](_0x360fd3['shift']());}}}(a76_0xf7c4,0xdc25a));function a76_0xf7c4(){const _0x356235=['115346kfaGIp','webhookUrl','1432134tLrybX','610TCWkbm','../config/database','payout','login','webhookEvents','defineProperty','771267HhDdfj','string','findUnique','api_error','parseWebhookEvents','create','updateTelegramSettings','18BzcsCG','29732pSstpS','pk_','compare','telegram','147QlCviZ','password','5917968JaVAgD','default','refund','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','payment_success','384QquJGQ','Shop\x20not\x20found','SettingsService','shopUrl','maskApiKey','revokeAllApiKeys','delete','telegramChatId','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','__importDefault','telegramBotApiKey','shop','chatId','payment_failed','ensureSettingsExist','1523495IgHCKa','notificationRefund','update','notificationPaymentFailed','toString','botApiKey','isArray','Current\x20password\x20is\x20incorrect','crypto','__esModule','length','settings','334071UkRpBR','notificationLogin','notificationApiError','substring','notificationPayout','updateWebhookSettings','randomBytes','bcryptjs','hex','name','shopSettings','hash'];a76_0xf7c4=function(){return _0x356235;};return a76_0xf7c4();}var __importDefault=this&&this[a76_0x15f76b(0x16f)]||function(_0x5b203c){const _0x507a66=a76_0x15f76b;return _0x5b203c&&_0x5b203c[_0x507a66(0x17e)]?_0x5b203c:{'default':_0x5b203c};};Object[a76_0x15f76b(0x152)](exports,a76_0x15f76b(0x17e),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a76_0x15f76b(0x145))),crypto_1=__importDefault(require(a76_0x15f76b(0x17d))),database_1=__importDefault(require(a76_0x15f76b(0x14e)));class SettingsService{[a76_0x15f76b(0x16a)](_0x325bda){const _0xffb513=a76_0x15f76b;if(!_0x325bda)return'';if(_0x325bda[_0xffb513(0x17f)]<=0x8)return _0x325bda;const _0x33c4e5=_0x325bda[_0xffb513(0x184)](0x0,0x8),_0x2c74b0='*'['repeat'](Math['max'](0x0,_0x325bda['length']-0x8));return _0x33c4e5+_0x2c74b0;}[a76_0x15f76b(0x157)](_0x22faf2){const _0x427cfa=a76_0x15f76b;if(!_0x22faf2)return[];if(Array['isArray'](_0x22faf2))return _0x22faf2;if(typeof _0x22faf2===_0x427cfa(0x154))try{const _0x430981=JSON['parse'](_0x22faf2);return Array[_0x427cfa(0x17b)](_0x430981)?_0x430981:[];}catch{return[];}return[];}async['getShopSettings'](_0xd4c2dc){const _0xd649a=a76_0x15f76b,_0x365c98=await database_1[_0xd649a(0x162)][_0xd649a(0x171)][_0xd649a(0x155)]({'where':{'id':_0xd4c2dc},'include':{'settings':!![]}});if(!_0x365c98)throw new Error(_0xd649a(0x167));let _0x118157=_0x365c98[_0xd649a(0x180)];return!_0x118157&&(_0x118157=await database_1['default'][_0xd649a(0x148)][_0xd649a(0x158)]({'data':{'shopId':_0x365c98['id']}})),{'fullName':_0x365c98['name'],'brand':_0x365c98[_0xd649a(0x147)],'merchantUrl':_0x365c98[_0xd649a(0x169)],'telegramUsername':_0x365c98[_0xd649a(0x15e)],'telegramBotApiKey':_0x118157[_0xd649a(0x170)]?this[_0xd649a(0x16a)](_0x118157['telegramBotApiKey']):null,'telegramChatId':_0x118157[_0xd649a(0x16d)],'webhookUrl':_0x118157[_0xd649a(0x14b)],'webhookEvents':this['parseWebhookEvents'](_0x118157[_0xd649a(0x151)]),'notifications':{'payment_success':_0x118157['notificationPaymentSuccess'],'payment_failed':_0x118157[_0xd649a(0x178)],'refund':_0x118157[_0xd649a(0x176)],'payout':_0x118157[_0xd649a(0x185)],'login':_0x118157[_0xd649a(0x182)],'api_error':_0x118157[_0xd649a(0x183)]}};}async['changePassword'](_0x56cf99,_0x8b418d){const _0x2147e9=a76_0x15f76b,{currentPassword:_0x1bf2a6,newPassword:_0x463410,confirmNewPassword:_0xa178c3}=_0x8b418d;if(_0x463410!==_0xa178c3)throw new Error(_0x2147e9(0x164));if(_0x463410[_0x2147e9(0x17f)]<0x6)throw new Error(_0x2147e9(0x16e));const _0x22274d=await database_1[_0x2147e9(0x162)][_0x2147e9(0x171)][_0x2147e9(0x155)]({'where':{'id':_0x56cf99},'select':{'password':!![]}});if(!_0x22274d)throw new Error('Shop\x20not\x20found');const _0xeb7bab=await bcryptjs_1[_0x2147e9(0x162)]['compare'](_0x1bf2a6,_0x22274d['password']);if(!_0xeb7bab)throw new Error(_0x2147e9(0x17c));const _0x2d2b74=await bcryptjs_1[_0x2147e9(0x162)][_0x2147e9(0x149)](_0x463410,0xc);await database_1[_0x2147e9(0x162)][_0x2147e9(0x171)][_0x2147e9(0x177)]({'where':{'id':_0x56cf99},'data':{'password':_0x2d2b74}});}async['updateNotifications'](_0x2debcc,_0x3bd164){const _0x324ac5=a76_0x15f76b;await this[_0x324ac5(0x174)](_0x2debcc);const _0x190655={};_0x3bd164[_0x324ac5(0x165)]!==undefined&&(_0x190655['notificationPaymentSuccess']=_0x3bd164[_0x324ac5(0x165)]),_0x3bd164['payment_failed']!==undefined&&(_0x190655[_0x324ac5(0x178)]=_0x3bd164[_0x324ac5(0x173)]),_0x3bd164[_0x324ac5(0x163)]!==undefined&&(_0x190655[_0x324ac5(0x176)]=_0x3bd164['refund']),_0x3bd164[_0x324ac5(0x14f)]!==undefined&&(_0x190655[_0x324ac5(0x185)]=_0x3bd164[_0x324ac5(0x14f)]),_0x3bd164[_0x324ac5(0x150)]!==undefined&&(_0x190655['notificationLogin']=_0x3bd164[_0x324ac5(0x150)]),_0x3bd164[_0x324ac5(0x156)]!==undefined&&(_0x190655[_0x324ac5(0x183)]=_0x3bd164['api_error']),await database_1['default'][_0x324ac5(0x148)][_0x324ac5(0x177)]({'where':{'shopId':_0x2debcc},'data':_0x190655});}async[a76_0x15f76b(0x159)](_0x35b31c,_0x33d1c3){const _0x37e427=a76_0x15f76b;await this[_0x37e427(0x174)](_0x35b31c);const _0xc9af87={};_0x33d1c3[_0x37e427(0x17a)]!==undefined&&(_0xc9af87[_0x37e427(0x170)]=_0x33d1c3[_0x37e427(0x17a)]||null),_0x33d1c3[_0x37e427(0x172)]!==undefined&&(_0xc9af87[_0x37e427(0x16d)]=_0x33d1c3['chatId']||null),await database_1[_0x37e427(0x162)][_0x37e427(0x148)][_0x37e427(0x177)]({'where':{'shopId':_0x35b31c},'data':_0xc9af87});}async[a76_0x15f76b(0x143)](_0x199238,_0x23f650){const _0x56acf4=a76_0x15f76b;await this[_0x56acf4(0x174)](_0x199238);const _0x1cfc2a={};_0x23f650['webhookUrl']!==undefined&&(_0x1cfc2a[_0x56acf4(0x14b)]=_0x23f650[_0x56acf4(0x14b)]||null),_0x23f650[_0x56acf4(0x151)]!==undefined&&(_0x1cfc2a[_0x56acf4(0x151)]=_0x23f650[_0x56acf4(0x151)]||[]),await database_1[_0x56acf4(0x162)][_0x56acf4(0x148)][_0x56acf4(0x177)]({'where':{'shopId':_0x199238},'data':_0x1cfc2a});}async[a76_0x15f76b(0x16b)](_0x8b6dd6){const _0x202b07=a76_0x15f76b,_0xbbfd99=_0x202b07(0x15c)+crypto_1['default'][_0x202b07(0x144)](0x20)['toString']('hex'),_0x191bd9='sk_'+crypto_1[_0x202b07(0x162)][_0x202b07(0x144)](0x20)[_0x202b07(0x179)](_0x202b07(0x146));await database_1[_0x202b07(0x162)]['shop'][_0x202b07(0x177)]({'where':{'id':_0x8b6dd6},'data':{'publicKey':_0xbbfd99,'secretKey':_0x191bd9}});}async['deleteAccount'](_0x108eef,_0x569cb6){const _0xcab055=a76_0x15f76b,{passwordConfirmation:_0x3aaecf}=_0x569cb6,_0x515be7=await database_1[_0xcab055(0x162)][_0xcab055(0x171)][_0xcab055(0x155)]({'where':{'id':_0x108eef},'select':{'password':!![]}});if(!_0x515be7)throw new Error(_0xcab055(0x167));const _0x21bf31=await bcryptjs_1[_0xcab055(0x162)][_0xcab055(0x15d)](_0x3aaecf,_0x515be7[_0xcab055(0x160)]);if(!_0x21bf31)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1['default']['shop'][_0xcab055(0x16c)]({'where':{'id':_0x108eef}});}async[a76_0x15f76b(0x174)](_0x523b22){const _0x3f5de3=a76_0x15f76b,_0x262510=await database_1[_0x3f5de3(0x162)][_0x3f5de3(0x148)][_0x3f5de3(0x155)]({'where':{'shopId':_0x523b22}});!_0x262510&&await database_1['default'][_0x3f5de3(0x148)]['create']({'data':{'shopId':_0x523b22}});}}exports[a76_0x15f76b(0x168)]=SettingsService;