'use strict';const a50_0x300687=a50_0x2406;(function(_0x4407e9,_0x3ef4fa){const _0x59963f=a50_0x2406,_0x18fded=_0x4407e9();while(!![]){try{const _0x4080ce=parseInt(_0x59963f(0x1a9))/0x1*(parseInt(_0x59963f(0x1b3))/0x2)+-parseInt(_0x59963f(0x1ca))/0x3+-parseInt(_0x59963f(0x1b6))/0x4+parseInt(_0x59963f(0x1d0))/0x5+parseInt(_0x59963f(0x1e5))/0x6+-parseInt(_0x59963f(0x1db))/0x7+parseInt(_0x59963f(0x1c8))/0x8;if(_0x4080ce===_0x3ef4fa)break;else _0x18fded['push'](_0x18fded['shift']());}catch(_0x199262){_0x18fded['push'](_0x18fded['shift']());}}}(a50_0x2a82,0xac648));function a50_0x2a82(){const _0x466c19=['hex','updateWebhookSettings','parse','create','string','delete','maskApiKey','webhookEvents','hash','chatId','8923621ktERmE','name','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','randomBytes','bcryptjs','notificationPayout','parseWebhookEvents','notificationLogin','login','defineProperty','7516962qLzwJR','shop','notificationPaymentFailed','Current\x20password\x20is\x20incorrect','notificationPaymentSuccess','5kLubCP','__esModule','shopSettings','pk_','update','payment_success','toString','deleteAccount','Shop\x20not\x20found','payment_failed','79766voLRUK','repeat','default','1386380LsWCTS','length','ensureSettingsExist','sk_','refund','notificationRefund','findUnique','updateTelegramSettings','max','notificationApiError','Password\x20confirmation\x20is\x20incorrect','updateNotifications','payout','SettingsService','password','telegramBotApiKey','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','isArray','7284736fklRvT','changePassword','1744530lzuwbD','settings','compare','api_error','__importDefault','webhookUrl','2730970bYpetf'];a50_0x2a82=function(){return _0x466c19;};return a50_0x2a82();}var __importDefault=this&&this[a50_0x300687(0x1ce)]||function(_0x554ab4){const _0x2fc08e=a50_0x300687;return _0x554ab4&&_0x554ab4[_0x2fc08e(0x1aa)]?_0x554ab4:{'default':_0x554ab4};};Object[a50_0x300687(0x1e4)](exports,a50_0x300687(0x1aa),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a50_0x300687(0x1df))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));function a50_0x2406(_0x37e012,_0x9995b2){const _0x2a8255=a50_0x2a82();return a50_0x2406=function(_0x24067b,_0x3c7a87){_0x24067b=_0x24067b-0x1a7;let _0x16910d=_0x2a8255[_0x24067b];return _0x16910d;},a50_0x2406(_0x37e012,_0x9995b2);}class SettingsService{['maskApiKey'](_0x3c20a8){const _0x2583bf=a50_0x300687;if(!_0x3c20a8)return'';if(_0x3c20a8[_0x2583bf(0x1b7)]<=0x8)return _0x3c20a8;const _0x1ef2f9=_0x3c20a8['substring'](0x0,0x8),_0x5b62b3='*'[_0x2583bf(0x1b4)](Math[_0x2583bf(0x1be)](0x0,_0x3c20a8[_0x2583bf(0x1b7)]-0x8));return _0x1ef2f9+_0x5b62b3;}[a50_0x300687(0x1e1)](_0x11a3b2){const _0x1a3e02=a50_0x300687;if(!_0x11a3b2)return[];if(Array['isArray'](_0x11a3b2))return _0x11a3b2;if(typeof _0x11a3b2===_0x1a3e02(0x1d5))try{const _0x43a34b=JSON[_0x1a3e02(0x1d3)](_0x11a3b2);return Array[_0x1a3e02(0x1c7)](_0x43a34b)?_0x43a34b:[];}catch{return[];}return[];}async['getShopSettings'](_0x3cc6db){const _0x1c21e9=a50_0x300687,_0x281a25=await database_1['default'][_0x1c21e9(0x1e6)][_0x1c21e9(0x1bc)]({'where':{'id':_0x3cc6db},'include':{'settings':!![]}});if(!_0x281a25)throw new Error(_0x1c21e9(0x1b1));let _0x9010=_0x281a25[_0x1c21e9(0x1cb)];return!_0x9010&&(_0x9010=await database_1[_0x1c21e9(0x1b5)][_0x1c21e9(0x1ab)]['create']({'data':{'shopId':_0x281a25['id']}})),{'fullName':_0x281a25[_0x1c21e9(0x1dc)],'brand':_0x281a25[_0x1c21e9(0x1dc)],'merchantUrl':_0x281a25['shopUrl'],'telegramUsername':_0x281a25['telegram'],'telegramBotApiKey':_0x9010['telegramBotApiKey']?this[_0x1c21e9(0x1d7)](_0x9010[_0x1c21e9(0x1c5)]):null,'telegramChatId':_0x9010['telegramChatId'],'webhookUrl':_0x9010[_0x1c21e9(0x1cf)],'webhookEvents':this[_0x1c21e9(0x1e1)](_0x9010[_0x1c21e9(0x1d8)]),'notifications':{'payment_success':_0x9010[_0x1c21e9(0x1a8)],'payment_failed':_0x9010[_0x1c21e9(0x1e7)],'refund':_0x9010[_0x1c21e9(0x1bb)],'payout':_0x9010[_0x1c21e9(0x1e0)],'login':_0x9010[_0x1c21e9(0x1e2)],'api_error':_0x9010['notificationApiError']}};}async[a50_0x300687(0x1c9)](_0x444bf8,_0x5e4dfc){const _0x2ffa69=a50_0x300687,{currentPassword:_0x25bf8f,newPassword:_0x388db0,confirmNewPassword:_0x553256}=_0x5e4dfc;if(_0x388db0!==_0x553256)throw new Error(_0x2ffa69(0x1c6));if(_0x388db0[_0x2ffa69(0x1b7)]<0x6)throw new Error(_0x2ffa69(0x1dd));const _0x206ada=await database_1[_0x2ffa69(0x1b5)][_0x2ffa69(0x1e6)]['findUnique']({'where':{'id':_0x444bf8},'select':{'password':!![]}});if(!_0x206ada)throw new Error('Shop\x20not\x20found');const _0x4e52a9=await bcryptjs_1['default'][_0x2ffa69(0x1cc)](_0x25bf8f,_0x206ada[_0x2ffa69(0x1c4)]);if(!_0x4e52a9)throw new Error(_0x2ffa69(0x1a7));const _0x55faa1=await bcryptjs_1[_0x2ffa69(0x1b5)][_0x2ffa69(0x1d9)](_0x388db0,0xc);await database_1[_0x2ffa69(0x1b5)][_0x2ffa69(0x1e6)][_0x2ffa69(0x1ad)]({'where':{'id':_0x444bf8},'data':{'password':_0x55faa1}});}async[a50_0x300687(0x1c1)](_0x5b9ee2,_0x4e6ea3){const _0xa9b333=a50_0x300687;await this[_0xa9b333(0x1b8)](_0x5b9ee2);const _0x475444={};_0x4e6ea3[_0xa9b333(0x1ae)]!==undefined&&(_0x475444[_0xa9b333(0x1a8)]=_0x4e6ea3[_0xa9b333(0x1ae)]),_0x4e6ea3[_0xa9b333(0x1b2)]!==undefined&&(_0x475444[_0xa9b333(0x1e7)]=_0x4e6ea3[_0xa9b333(0x1b2)]),_0x4e6ea3[_0xa9b333(0x1ba)]!==undefined&&(_0x475444[_0xa9b333(0x1bb)]=_0x4e6ea3['refund']),_0x4e6ea3[_0xa9b333(0x1c2)]!==undefined&&(_0x475444[_0xa9b333(0x1e0)]=_0x4e6ea3['payout']),_0x4e6ea3[_0xa9b333(0x1e3)]!==undefined&&(_0x475444[_0xa9b333(0x1e2)]=_0x4e6ea3['login']),_0x4e6ea3[_0xa9b333(0x1cd)]!==undefined&&(_0x475444[_0xa9b333(0x1bf)]=_0x4e6ea3[_0xa9b333(0x1cd)]),await database_1[_0xa9b333(0x1b5)][_0xa9b333(0x1ab)]['update']({'where':{'shopId':_0x5b9ee2},'data':_0x475444});}async[a50_0x300687(0x1bd)](_0x2b123b,_0x420caa){const _0x458145=a50_0x300687;await this[_0x458145(0x1b8)](_0x2b123b);const _0x8cf5fc={};_0x420caa['botApiKey']!==undefined&&(_0x8cf5fc[_0x458145(0x1c5)]=_0x420caa['botApiKey']||null),_0x420caa[_0x458145(0x1da)]!==undefined&&(_0x8cf5fc['telegramChatId']=_0x420caa['chatId']||null),await database_1[_0x458145(0x1b5)][_0x458145(0x1ab)][_0x458145(0x1ad)]({'where':{'shopId':_0x2b123b},'data':_0x8cf5fc});}async[a50_0x300687(0x1d2)](_0x139938,_0x28af3c){const _0x2db8d6=a50_0x300687;await this[_0x2db8d6(0x1b8)](_0x139938);const _0x5adb50={};_0x28af3c[_0x2db8d6(0x1cf)]!==undefined&&(_0x5adb50[_0x2db8d6(0x1cf)]=_0x28af3c[_0x2db8d6(0x1cf)]||null),_0x28af3c['webhookEvents']!==undefined&&(_0x5adb50[_0x2db8d6(0x1d8)]=_0x28af3c['webhookEvents']||[]),await database_1[_0x2db8d6(0x1b5)][_0x2db8d6(0x1ab)]['update']({'where':{'shopId':_0x139938},'data':_0x5adb50});}async['revokeAllApiKeys'](_0x500af1){const _0x5ecd84=a50_0x300687,_0x3474e3=_0x5ecd84(0x1ac)+crypto_1[_0x5ecd84(0x1b5)]['randomBytes'](0x20)[_0x5ecd84(0x1af)](_0x5ecd84(0x1d1)),_0x589318=_0x5ecd84(0x1b9)+crypto_1[_0x5ecd84(0x1b5)][_0x5ecd84(0x1de)](0x20)[_0x5ecd84(0x1af)](_0x5ecd84(0x1d1));await database_1[_0x5ecd84(0x1b5)][_0x5ecd84(0x1e6)]['update']({'where':{'id':_0x500af1},'data':{'publicKey':_0x3474e3,'secretKey':_0x589318}});}async[a50_0x300687(0x1b0)](_0x4d9a50,_0x22f70a){const _0x52c7c1=a50_0x300687,{passwordConfirmation:_0x23b76e}=_0x22f70a,_0xc0a6ce=await database_1[_0x52c7c1(0x1b5)]['shop'][_0x52c7c1(0x1bc)]({'where':{'id':_0x4d9a50},'select':{'password':!![]}});if(!_0xc0a6ce)throw new Error(_0x52c7c1(0x1b1));const _0x55cff2=await bcryptjs_1[_0x52c7c1(0x1b5)]['compare'](_0x23b76e,_0xc0a6ce['password']);if(!_0x55cff2)throw new Error(_0x52c7c1(0x1c0));await database_1['default'][_0x52c7c1(0x1e6)][_0x52c7c1(0x1d6)]({'where':{'id':_0x4d9a50}});}async['ensureSettingsExist'](_0x57d594){const _0x2b5754=a50_0x300687,_0x1591e8=await database_1[_0x2b5754(0x1b5)]['shopSettings']['findUnique']({'where':{'shopId':_0x57d594}});!_0x1591e8&&await database_1['default']['shopSettings'][_0x2b5754(0x1d4)]({'data':{'shopId':_0x57d594}});}}exports[a50_0x300687(0x1c3)]=SettingsService;