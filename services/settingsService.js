'use strict';const a53_0x1e611e=a53_0x4a0f;function a53_0x4a0f(_0x505387,_0x5d8b84){const _0x5f267b=a53_0x5f26();return a53_0x4a0f=function(_0x4a0f55,_0x318951){_0x4a0f55=_0x4a0f55-0x153;let _0x5c5c19=_0x5f267b[_0x4a0f55];return _0x5c5c19;},a53_0x4a0f(_0x505387,_0x5d8b84);}(function(_0x6a570e,_0x1084f3){const _0x1cb7f=a53_0x4a0f,_0x1fefdc=_0x6a570e();while(!![]){try{const _0x43245d=parseInt(_0x1cb7f(0x16e))/0x1+parseInt(_0x1cb7f(0x179))/0x2+parseInt(_0x1cb7f(0x175))/0x3+parseInt(_0x1cb7f(0x17c))/0x4+parseInt(_0x1cb7f(0x182))/0x5+-parseInt(_0x1cb7f(0x16c))/0x6+-parseInt(_0x1cb7f(0x17a))/0x7*(parseInt(_0x1cb7f(0x172))/0x8);if(_0x43245d===_0x1084f3)break;else _0x1fefdc['push'](_0x1fefdc['shift']());}catch(_0x9e0d95){_0x1fefdc['push'](_0x1fefdc['shift']());}}}(a53_0x5f26,0x2a2c1));var __importDefault=this&&this[a53_0x1e611e(0x157)]||function(_0x45d34d){const _0x2bdbe9=a53_0x1e611e;return _0x45d34d&&_0x45d34d[_0x2bdbe9(0x18f)]?_0x45d34d:{'default':_0x45d34d};};Object[a53_0x1e611e(0x186)](exports,a53_0x1e611e(0x18f),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a53_0x1e611e(0x16a))),crypto_1=__importDefault(require(a53_0x1e611e(0x185))),database_1=__importDefault(require(a53_0x1e611e(0x174)));class SettingsService{[a53_0x1e611e(0x18d)](_0xda789e){const _0x383ea1=a53_0x1e611e;if(!_0xda789e)return'';if(_0xda789e[_0x383ea1(0x154)]<=0x8)return _0xda789e;const _0x300d98=_0xda789e[_0x383ea1(0x189)](0x0,0x8),_0xc98d36='*'[_0x383ea1(0x18b)](Math['max'](0x0,_0xda789e[_0x383ea1(0x154)]-0x8));return _0x300d98+_0xc98d36;}[a53_0x1e611e(0x155)](_0x26ab87){const _0xa4043b=a53_0x1e611e;if(!_0x26ab87)return[];if(Array[_0xa4043b(0x15e)](_0x26ab87))return _0x26ab87;if(typeof _0x26ab87==='string')try{const _0x445874=JSON[_0xa4043b(0x18a)](_0x26ab87);return Array[_0xa4043b(0x15e)](_0x445874)?_0x445874:[];}catch{return[];}return[];}async['getShopSettings'](_0xa6de35){const _0xeb573=a53_0x1e611e,_0x5814d8=await database_1['default'][_0xeb573(0x171)]['findUnique']({'where':{'id':_0xa6de35},'include':{'settings':!![]}});if(!_0x5814d8)throw new Error(_0xeb573(0x177));let _0x1393fc=_0x5814d8[_0xeb573(0x163)];return!_0x1393fc&&(_0x1393fc=await database_1['default']['shopSettings'][_0xeb573(0x183)]({'data':{'shopId':_0x5814d8['id']}})),{'fullName':_0x5814d8[_0xeb573(0x18e)],'brand':_0x5814d8['name'],'merchantUrl':_0x5814d8[_0xeb573(0x181)],'telegramUsername':_0x5814d8[_0xeb573(0x164)],'telegramBotApiKey':_0x1393fc[_0xeb573(0x170)]?this[_0xeb573(0x18d)](_0x1393fc[_0xeb573(0x170)]):null,'telegramChatId':_0x1393fc[_0xeb573(0x161)],'webhookUrl':_0x1393fc['webhookUrl'],'webhookEvents':this[_0xeb573(0x155)](_0x1393fc[_0xeb573(0x162)]),'notifications':{'payment_success':_0x1393fc[_0xeb573(0x16f)],'payment_failed':_0x1393fc[_0xeb573(0x193)],'refund':_0x1393fc[_0xeb573(0x165)],'payout':_0x1393fc[_0xeb573(0x180)],'login':_0x1393fc[_0xeb573(0x167)],'api_error':_0x1393fc[_0xeb573(0x190)]}};}async[a53_0x1e611e(0x196)](_0x299a64,_0x5764e2){const _0x474766=a53_0x1e611e,{currentPassword:_0x3df464,newPassword:_0xb7bbe,confirmNewPassword:_0x280b1b}=_0x5764e2;if(_0xb7bbe!==_0x280b1b)throw new Error(_0x474766(0x15f));if(_0xb7bbe['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x1304d4=await database_1[_0x474766(0x153)][_0x474766(0x171)][_0x474766(0x191)]({'where':{'id':_0x299a64},'select':{'password':!![]}});if(!_0x1304d4)throw new Error(_0x474766(0x177));const _0x4ea24d=await bcryptjs_1[_0x474766(0x153)][_0x474766(0x168)](_0x3df464,_0x1304d4['password']);if(!_0x4ea24d)throw new Error(_0x474766(0x160));const _0x175a18=await bcryptjs_1[_0x474766(0x153)][_0x474766(0x17d)](_0xb7bbe,0xc);await database_1[_0x474766(0x153)][_0x474766(0x171)]['update']({'where':{'id':_0x299a64},'data':{'password':_0x175a18}});}async[a53_0x1e611e(0x156)](_0x1929ef,_0x417dd6){const _0xccdc5f=a53_0x1e611e;await this[_0xccdc5f(0x158)](_0x1929ef);const _0x2cdcc9={};_0x417dd6[_0xccdc5f(0x166)]!==undefined&&(_0x2cdcc9[_0xccdc5f(0x16f)]=_0x417dd6[_0xccdc5f(0x166)]),_0x417dd6[_0xccdc5f(0x188)]!==undefined&&(_0x2cdcc9[_0xccdc5f(0x193)]=_0x417dd6[_0xccdc5f(0x188)]),_0x417dd6['refund']!==undefined&&(_0x2cdcc9[_0xccdc5f(0x165)]=_0x417dd6[_0xccdc5f(0x15d)]),_0x417dd6[_0xccdc5f(0x16b)]!==undefined&&(_0x2cdcc9[_0xccdc5f(0x180)]=_0x417dd6[_0xccdc5f(0x16b)]),_0x417dd6[_0xccdc5f(0x192)]!==undefined&&(_0x2cdcc9[_0xccdc5f(0x167)]=_0x417dd6[_0xccdc5f(0x192)]),_0x417dd6[_0xccdc5f(0x176)]!==undefined&&(_0x2cdcc9[_0xccdc5f(0x190)]=_0x417dd6[_0xccdc5f(0x176)]),await database_1['default'][_0xccdc5f(0x17b)][_0xccdc5f(0x195)]({'where':{'shopId':_0x1929ef},'data':_0x2cdcc9});}async[a53_0x1e611e(0x169)](_0x52a76d,_0x5a4774){const _0x4c0e1d=a53_0x1e611e;await this[_0x4c0e1d(0x158)](_0x52a76d);const _0x5d487e={};_0x5a4774[_0x4c0e1d(0x15a)]!==undefined&&(_0x5d487e[_0x4c0e1d(0x170)]=_0x5a4774['botApiKey']||null),_0x5a4774[_0x4c0e1d(0x187)]!==undefined&&(_0x5d487e['telegramChatId']=_0x5a4774[_0x4c0e1d(0x187)]||null),await database_1[_0x4c0e1d(0x153)][_0x4c0e1d(0x17b)][_0x4c0e1d(0x195)]({'where':{'shopId':_0x52a76d},'data':_0x5d487e});}async[a53_0x1e611e(0x15c)](_0x2d7f39,_0x5f4d09){const _0x337c05=a53_0x1e611e;await this[_0x337c05(0x158)](_0x2d7f39);const _0x3610b6={};_0x5f4d09['webhookUrl']!==undefined&&(_0x3610b6[_0x337c05(0x173)]=_0x5f4d09[_0x337c05(0x173)]||null),_0x5f4d09[_0x337c05(0x162)]!==undefined&&(_0x3610b6[_0x337c05(0x162)]=_0x5f4d09[_0x337c05(0x162)]||[]),await database_1['default']['shopSettings'][_0x337c05(0x195)]({'where':{'shopId':_0x2d7f39},'data':_0x3610b6});}async['revokeAllApiKeys'](_0x30c3f1){const _0x988e6a=a53_0x1e611e,_0x51ad53=_0x988e6a(0x159)+crypto_1['default'][_0x988e6a(0x15b)](0x20)[_0x988e6a(0x17f)](_0x988e6a(0x17e)),_0x1c6307=_0x988e6a(0x194)+crypto_1[_0x988e6a(0x153)][_0x988e6a(0x15b)](0x20)[_0x988e6a(0x17f)]('hex');await database_1['default']['shop'][_0x988e6a(0x195)]({'where':{'id':_0x30c3f1},'data':{'publicKey':_0x51ad53,'secretKey':_0x1c6307}});}async[a53_0x1e611e(0x184)](_0x56f1d0,_0x35c6b3){const _0x2a5d71=a53_0x1e611e,{passwordConfirmation:_0x4c999e}=_0x35c6b3,_0x287154=await database_1['default'][_0x2a5d71(0x171)][_0x2a5d71(0x191)]({'where':{'id':_0x56f1d0},'select':{'password':!![]}});if(!_0x287154)throw new Error(_0x2a5d71(0x177));const _0x345960=await bcryptjs_1[_0x2a5d71(0x153)][_0x2a5d71(0x168)](_0x4c999e,_0x287154[_0x2a5d71(0x178)]);if(!_0x345960)throw new Error(_0x2a5d71(0x18c));await database_1['default'][_0x2a5d71(0x171)][_0x2a5d71(0x16d)]({'where':{'id':_0x56f1d0}});}async[a53_0x1e611e(0x158)](_0x2760b9){const _0x1d9f52=a53_0x1e611e,_0x31eaca=await database_1['default'][_0x1d9f52(0x17b)][_0x1d9f52(0x191)]({'where':{'shopId':_0x2760b9}});!_0x31eaca&&await database_1[_0x1d9f52(0x153)]['shopSettings'][_0x1d9f52(0x183)]({'data':{'shopId':_0x2760b9}});}}exports['SettingsService']=SettingsService;function a53_0x5f26(){const _0x43052f=['New\x20password\x20and\x20confirmation\x20do\x20not\x20match','Current\x20password\x20is\x20incorrect','telegramChatId','webhookEvents','settings','telegram','notificationRefund','payment_success','notificationLogin','compare','updateTelegramSettings','bcryptjs','payout','1276578WxIUEc','delete','27771kRMVtm','notificationPaymentSuccess','telegramBotApiKey','shop','37832vTNhJT','webhookUrl','../config/database','891348MgCGGS','api_error','Shop\x20not\x20found','password','576216jqNXFY','1001rRaeXk','shopSettings','894280sCUrBI','hash','hex','toString','notificationPayout','shopUrl','1125910hbYRGE','create','deleteAccount','crypto','defineProperty','chatId','payment_failed','substring','parse','repeat','Password\x20confirmation\x20is\x20incorrect','maskApiKey','name','__esModule','notificationApiError','findUnique','login','notificationPaymentFailed','sk_','update','changePassword','default','length','parseWebhookEvents','updateNotifications','__importDefault','ensureSettingsExist','pk_','botApiKey','randomBytes','updateWebhookSettings','refund','isArray'];a53_0x5f26=function(){return _0x43052f;};return a53_0x5f26();}