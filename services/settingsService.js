'use strict';const a53_0x970403=a53_0x2a3d;(function(_0x4392d8,_0x40fcef){const _0x378012=a53_0x2a3d,_0x3a8e8a=_0x4392d8();while(!![]){try{const _0x39b480=parseInt(_0x378012(0x149))/0x1*(parseInt(_0x378012(0x152))/0x2)+parseInt(_0x378012(0x164))/0x3+parseInt(_0x378012(0x165))/0x4+parseInt(_0x378012(0x162))/0x5+parseInt(_0x378012(0x153))/0x6*(-parseInt(_0x378012(0x138))/0x7)+-parseInt(_0x378012(0x156))/0x8+parseInt(_0x378012(0x13c))/0x9*(parseInt(_0x378012(0x157))/0xa);if(_0x39b480===_0x40fcef)break;else _0x3a8e8a['push'](_0x3a8e8a['shift']());}catch(_0x532911){_0x3a8e8a['push'](_0x3a8e8a['shift']());}}}(a53_0x1d4a,0xdbed1));var __importDefault=this&&this[a53_0x970403(0x15a)]||function(_0x248f86){const _0x3b8a28=a53_0x970403;return _0x248f86&&_0x248f86[_0x3b8a28(0x142)]?_0x248f86:{'default':_0x248f86};};function a53_0x2a3d(_0x14b305,_0x66a47b){const _0x1d4a1e=a53_0x1d4a();return a53_0x2a3d=function(_0x2a3d21,_0x50fb5c){_0x2a3d21=_0x2a3d21-0x122;let _0x58cfe9=_0x1d4a1e[_0x2a3d21];return _0x58cfe9;},a53_0x2a3d(_0x14b305,_0x66a47b);}Object[a53_0x970403(0x163)](exports,a53_0x970403(0x142),{'value':!![]}),exports[a53_0x970403(0x150)]=void 0x0;const bcryptjs_1=__importDefault(require(a53_0x970403(0x13b))),crypto_1=__importDefault(require(a53_0x970403(0x129))),database_1=__importDefault(require(a53_0x970403(0x148)));class SettingsService{[a53_0x970403(0x146)](_0x36686e){const _0x5ddd99=a53_0x970403;if(!_0x36686e)return'';if(_0x36686e[_0x5ddd99(0x12f)]<=0x8)return _0x36686e;const _0x3280f0=_0x36686e[_0x5ddd99(0x133)](0x0,0x8),_0xd06138='*'[_0x5ddd99(0x161)](Math[_0x5ddd99(0x155)](0x0,_0x36686e['length']-0x8));return _0x3280f0+_0xd06138;}[a53_0x970403(0x145)](_0xef484f){const _0x147589=a53_0x970403;if(!_0xef484f)return[];if(Array[_0x147589(0x151)](_0xef484f))return _0xef484f;if(typeof _0xef484f==='string')try{const _0x23e68f=JSON[_0x147589(0x154)](_0xef484f);return Array[_0x147589(0x151)](_0x23e68f)?_0x23e68f:[];}catch{return[];}return[];}async[a53_0x970403(0x132)](_0x521cfa){const _0x489ef3=a53_0x970403,_0x11d709=await database_1[_0x489ef3(0x130)][_0x489ef3(0x13e)][_0x489ef3(0x139)]({'where':{'id':_0x521cfa},'include':{'settings':!![]}});if(!_0x11d709)throw new Error('Shop\x20not\x20found');let _0x110508=_0x11d709['settings'];return!_0x110508&&(_0x110508=await database_1[_0x489ef3(0x130)][_0x489ef3(0x14c)]['create']({'data':{'shopId':_0x11d709['id']}})),{'fullName':_0x11d709[_0x489ef3(0x12c)],'brand':_0x11d709[_0x489ef3(0x12c)],'merchantUrl':_0x11d709['shopUrl'],'telegramUsername':_0x11d709[_0x489ef3(0x158)],'telegramBotApiKey':_0x110508[_0x489ef3(0x126)]?this[_0x489ef3(0x146)](_0x110508[_0x489ef3(0x126)]):null,'telegramChatId':_0x110508['telegramChatId'],'webhookUrl':_0x110508['webhookUrl'],'webhookEvents':this[_0x489ef3(0x145)](_0x110508[_0x489ef3(0x15c)]),'notifications':{'payment_success':_0x110508[_0x489ef3(0x131)],'payment_failed':_0x110508[_0x489ef3(0x14d)],'refund':_0x110508['notificationRefund'],'payout':_0x110508[_0x489ef3(0x137)],'login':_0x110508[_0x489ef3(0x12e)],'api_error':_0x110508[_0x489ef3(0x143)]}};}async['changePassword'](_0x1e5590,_0x2be20b){const _0x507ddb=a53_0x970403,{currentPassword:_0x58b548,newPassword:_0x2c50f5,confirmNewPassword:_0x7993d9}=_0x2be20b;if(_0x2c50f5!==_0x7993d9)throw new Error(_0x507ddb(0x15d));if(_0x2c50f5[_0x507ddb(0x12f)]<0x6)throw new Error(_0x507ddb(0x14b));const _0x1df851=await database_1['default'][_0x507ddb(0x13e)][_0x507ddb(0x139)]({'where':{'id':_0x1e5590},'select':{'password':!![]}});if(!_0x1df851)throw new Error('Shop\x20not\x20found');const _0x1c19ac=await bcryptjs_1[_0x507ddb(0x130)][_0x507ddb(0x140)](_0x58b548,_0x1df851[_0x507ddb(0x15f)]);if(!_0x1c19ac)throw new Error(_0x507ddb(0x15b));const _0x2736b5=await bcryptjs_1[_0x507ddb(0x130)][_0x507ddb(0x14e)](_0x2c50f5,0xc);await database_1[_0x507ddb(0x130)][_0x507ddb(0x13e)][_0x507ddb(0x134)]({'where':{'id':_0x1e5590},'data':{'password':_0x2736b5}});}async['updateNotifications'](_0x1dc452,_0x2cda3c){const _0x25ea05=a53_0x970403;await this[_0x25ea05(0x14a)](_0x1dc452);const _0x22698c={};_0x2cda3c[_0x25ea05(0x12d)]!==undefined&&(_0x22698c[_0x25ea05(0x131)]=_0x2cda3c[_0x25ea05(0x12d)]),_0x2cda3c[_0x25ea05(0x122)]!==undefined&&(_0x22698c[_0x25ea05(0x14d)]=_0x2cda3c['payment_failed']),_0x2cda3c[_0x25ea05(0x144)]!==undefined&&(_0x22698c[_0x25ea05(0x123)]=_0x2cda3c[_0x25ea05(0x144)]),_0x2cda3c['payout']!==undefined&&(_0x22698c['notificationPayout']=_0x2cda3c[_0x25ea05(0x12b)]),_0x2cda3c[_0x25ea05(0x160)]!==undefined&&(_0x22698c[_0x25ea05(0x12e)]=_0x2cda3c['login']),_0x2cda3c[_0x25ea05(0x125)]!==undefined&&(_0x22698c[_0x25ea05(0x143)]=_0x2cda3c[_0x25ea05(0x125)]),await database_1['default'][_0x25ea05(0x14c)][_0x25ea05(0x134)]({'where':{'shopId':_0x1dc452},'data':_0x22698c});}async[a53_0x970403(0x135)](_0x208645,_0x59013d){const _0x54240e=a53_0x970403;await this[_0x54240e(0x14a)](_0x208645);const _0x214e0b={};_0x59013d[_0x54240e(0x12a)]!==undefined&&(_0x214e0b[_0x54240e(0x126)]=_0x59013d[_0x54240e(0x12a)]||null),_0x59013d['chatId']!==undefined&&(_0x214e0b[_0x54240e(0x147)]=_0x59013d[_0x54240e(0x128)]||null),await database_1[_0x54240e(0x130)][_0x54240e(0x14c)]['update']({'where':{'shopId':_0x208645},'data':_0x214e0b});}async[a53_0x970403(0x13d)](_0x5af4e8,_0xeae27a){const _0x2bb56e=a53_0x970403;await this['ensureSettingsExist'](_0x5af4e8);const _0x210b8e={};_0xeae27a[_0x2bb56e(0x127)]!==undefined&&(_0x210b8e['webhookUrl']=_0xeae27a[_0x2bb56e(0x127)]||null),_0xeae27a[_0x2bb56e(0x15c)]!==undefined&&(_0x210b8e[_0x2bb56e(0x15c)]=_0xeae27a[_0x2bb56e(0x15c)]||[]),await database_1['default'][_0x2bb56e(0x14c)][_0x2bb56e(0x134)]({'where':{'shopId':_0x5af4e8},'data':_0x210b8e});}async[a53_0x970403(0x159)](_0xbdcb5){const _0x496255=a53_0x970403,_0x5772d5=_0x496255(0x124)+crypto_1[_0x496255(0x130)][_0x496255(0x14f)](0x20)['toString'](_0x496255(0x141)),_0x70c4da=_0x496255(0x15e)+crypto_1[_0x496255(0x130)][_0x496255(0x14f)](0x20)['toString'](_0x496255(0x141));await database_1[_0x496255(0x130)][_0x496255(0x13e)]['update']({'where':{'id':_0xbdcb5},'data':{'publicKey':_0x5772d5,'secretKey':_0x70c4da}});}async['deleteAccount'](_0x368133,_0x1f0ec5){const _0x16f4ab=a53_0x970403,{passwordConfirmation:_0x260759}=_0x1f0ec5,_0x1cebb0=await database_1[_0x16f4ab(0x130)][_0x16f4ab(0x13e)][_0x16f4ab(0x139)]({'where':{'id':_0x368133},'select':{'password':!![]}});if(!_0x1cebb0)throw new Error(_0x16f4ab(0x136));const _0x3adb9a=await bcryptjs_1[_0x16f4ab(0x130)][_0x16f4ab(0x140)](_0x260759,_0x1cebb0['password']);if(!_0x3adb9a)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x16f4ab(0x130)]['shop'][_0x16f4ab(0x13f)]({'where':{'id':_0x368133}});}async[a53_0x970403(0x14a)](_0x289166){const _0x55bce6=a53_0x970403,_0x3c39cb=await database_1['default']['shopSettings'][_0x55bce6(0x139)]({'where':{'shopId':_0x289166}});!_0x3c39cb&&await database_1[_0x55bce6(0x130)][_0x55bce6(0x14c)][_0x55bce6(0x13a)]({'data':{'shopId':_0x289166}});}}function a53_0x1d4a(){const _0x40b1fd=['1044188JQEkoN','payment_failed','notificationRefund','pk_','api_error','telegramBotApiKey','webhookUrl','chatId','crypto','botApiKey','payout','name','payment_success','notificationLogin','length','default','notificationPaymentSuccess','getShopSettings','substring','update','updateTelegramSettings','Shop\x20not\x20found','notificationPayout','91833qjiSVn','findUnique','create','bcryptjs','13599QEzYnj','updateWebhookSettings','shop','delete','compare','hex','__esModule','notificationApiError','refund','parseWebhookEvents','maskApiKey','telegramChatId','../config/database','215515KQFhrW','ensureSettingsExist','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','shopSettings','notificationPaymentFailed','hash','randomBytes','SettingsService','isArray','4PQmPDE','786LziJkk','parse','max','12099912JGwuMp','5110TbxhXI','telegram','revokeAllApiKeys','__importDefault','Current\x20password\x20is\x20incorrect','webhookEvents','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','sk_','password','login','repeat','6594470SEoByJ','defineProperty','4046409SyHsmi'];a53_0x1d4a=function(){return _0x40b1fd;};return a53_0x1d4a();}exports[a53_0x970403(0x150)]=SettingsService;