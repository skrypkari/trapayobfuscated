'use strict';function a72_0x307a(_0x22d981,_0x3c7dd0){_0x22d981=_0x22d981-0x1d5;const _0xfdc1d2=a72_0xfdc1();let _0x307a52=_0xfdc1d2[_0x22d981];return _0x307a52;}const a72_0x26a941=a72_0x307a;(function(_0x2045a7,_0x3f035e){const _0x220d37=a72_0x307a,_0x267a77=_0x2045a7();while(!![]){try{const _0x18a858=parseInt(_0x220d37(0x1e0))/0x1*(-parseInt(_0x220d37(0x1fc))/0x2)+parseInt(_0x220d37(0x1fe))/0x3*(parseInt(_0x220d37(0x1d8))/0x4)+parseInt(_0x220d37(0x201))/0x5+-parseInt(_0x220d37(0x1de))/0x6*(-parseInt(_0x220d37(0x20e))/0x7)+-parseInt(_0x220d37(0x1ed))/0x8*(-parseInt(_0x220d37(0x216))/0x9)+-parseInt(_0x220d37(0x218))/0xa*(-parseInt(_0x220d37(0x20f))/0xb)+-parseInt(_0x220d37(0x1d6))/0xc*(parseInt(_0x220d37(0x1ee))/0xd);if(_0x18a858===_0x3f035e)break;else _0x267a77['push'](_0x267a77['shift']());}catch(_0x481795){_0x267a77['push'](_0x267a77['shift']());}}}(a72_0xfdc1,0x5e793));var __importDefault=this&&this[a72_0x26a941(0x1fd)]||function(_0x168746){const _0x229064=a72_0x26a941;return _0x168746&&_0x168746[_0x229064(0x1fa)]?_0x168746:{'default':_0x168746};};function a72_0xfdc1(){const _0x45b101=['parse','Shop\x20not\x20found','api_error','notificationApiError','sk_','password','webhookUrl','notificationPaymentSuccess','__esModule','updateTelegramSettings','53218FejfTm','__importDefault','4983kDjzhU','compare','max','1302215DNDWlI','toString','shopUrl','randomBytes','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','hash','maskApiKey','update','changePassword','telegram','updateWebhookSettings','webhookEvents','settings','77bssSHg','5258VVbhuR','shopSettings','name','notificationPayout','payout','isArray','notificationRefund','145827tHeNKn','../config/database','5450twxJco','notificationPaymentFailed','bcryptjs','length','shop','8724924ulQLzt','default','1372JmLGbj','defineProperty','refund','findUnique','create','payment_failed','744ohsahl','ensureSettingsExist','1AoztTg','Current\x20password\x20is\x20incorrect','delete','hex','notificationLogin','telegramBotApiKey','crypto','getShopSettings','botApiKey','payment_success','telegramChatId','repeat','parseWebhookEvents','24UjDtIh','13wJNTKi','login','chatId','SettingsService'];a72_0xfdc1=function(){return _0x45b101;};return a72_0xfdc1();}Object[a72_0x26a941(0x1d9)](exports,a72_0x26a941(0x1fa),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a72_0x26a941(0x21a))),crypto_1=__importDefault(require(a72_0x26a941(0x1e6))),database_1=__importDefault(require(a72_0x26a941(0x217)));class SettingsService{[a72_0x26a941(0x207)](_0x29742e){const _0x3b6d36=a72_0x26a941;if(!_0x29742e)return'';if(_0x29742e[_0x3b6d36(0x21b)]<=0x8)return _0x29742e;const _0x4f57c0=_0x29742e['substring'](0x0,0x8),_0x4e5c4b='*'[_0x3b6d36(0x1eb)](Math[_0x3b6d36(0x200)](0x0,_0x29742e['length']-0x8));return _0x4f57c0+_0x4e5c4b;}[a72_0x26a941(0x1ec)](_0x286df5){const _0x1f8ee5=a72_0x26a941;if(!_0x286df5)return[];if(Array[_0x1f8ee5(0x214)](_0x286df5))return _0x286df5;if(typeof _0x286df5==='string')try{const _0x42ebb1=JSON[_0x1f8ee5(0x1f2)](_0x286df5);return Array[_0x1f8ee5(0x214)](_0x42ebb1)?_0x42ebb1:[];}catch{return[];}return[];}async[a72_0x26a941(0x1e7)](_0x1ddf0a){const _0x5e447c=a72_0x26a941,_0x1acf7a=await database_1['default'][_0x5e447c(0x1d5)][_0x5e447c(0x1db)]({'where':{'id':_0x1ddf0a},'include':{'settings':!![]}});if(!_0x1acf7a)throw new Error(_0x5e447c(0x1f3));let _0x1cd6ae=_0x1acf7a[_0x5e447c(0x20d)];return!_0x1cd6ae&&(_0x1cd6ae=await database_1[_0x5e447c(0x1d7)]['shopSettings'][_0x5e447c(0x1dc)]({'data':{'shopId':_0x1acf7a['id']}})),{'fullName':_0x1acf7a[_0x5e447c(0x211)],'brand':_0x1acf7a['name'],'merchantUrl':_0x1acf7a[_0x5e447c(0x203)],'telegramUsername':_0x1acf7a[_0x5e447c(0x20a)],'telegramBotApiKey':_0x1cd6ae[_0x5e447c(0x1e5)]?this['maskApiKey'](_0x1cd6ae[_0x5e447c(0x1e5)]):null,'telegramChatId':_0x1cd6ae[_0x5e447c(0x1ea)],'webhookUrl':_0x1cd6ae[_0x5e447c(0x1f8)],'webhookEvents':this[_0x5e447c(0x1ec)](_0x1cd6ae[_0x5e447c(0x20c)]),'notifications':{'payment_success':_0x1cd6ae[_0x5e447c(0x1f9)],'payment_failed':_0x1cd6ae['notificationPaymentFailed'],'refund':_0x1cd6ae[_0x5e447c(0x215)],'payout':_0x1cd6ae[_0x5e447c(0x212)],'login':_0x1cd6ae[_0x5e447c(0x1e4)],'api_error':_0x1cd6ae['notificationApiError']}};}async[a72_0x26a941(0x209)](_0x161d9a,_0x38fe67){const _0x247ce0=a72_0x26a941,{currentPassword:_0x211144,newPassword:_0x1c041e,confirmNewPassword:_0x4ec98b}=_0x38fe67;if(_0x1c041e!==_0x4ec98b)throw new Error(_0x247ce0(0x205));if(_0x1c041e[_0x247ce0(0x21b)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x34abc7=await database_1[_0x247ce0(0x1d7)][_0x247ce0(0x1d5)][_0x247ce0(0x1db)]({'where':{'id':_0x161d9a},'select':{'password':!![]}});if(!_0x34abc7)throw new Error(_0x247ce0(0x1f3));const _0x1494af=await bcryptjs_1['default'][_0x247ce0(0x1ff)](_0x211144,_0x34abc7['password']);if(!_0x1494af)throw new Error(_0x247ce0(0x1e1));const _0x205b6a=await bcryptjs_1[_0x247ce0(0x1d7)][_0x247ce0(0x206)](_0x1c041e,0xc);await database_1['default'][_0x247ce0(0x1d5)][_0x247ce0(0x208)]({'where':{'id':_0x161d9a},'data':{'password':_0x205b6a}});}async['updateNotifications'](_0x2add26,_0x3d5ad5){const _0x2054f3=a72_0x26a941;await this[_0x2054f3(0x1df)](_0x2add26);const _0x1d1ec6={};_0x3d5ad5[_0x2054f3(0x1e9)]!==undefined&&(_0x1d1ec6['notificationPaymentSuccess']=_0x3d5ad5[_0x2054f3(0x1e9)]),_0x3d5ad5[_0x2054f3(0x1dd)]!==undefined&&(_0x1d1ec6[_0x2054f3(0x219)]=_0x3d5ad5[_0x2054f3(0x1dd)]),_0x3d5ad5[_0x2054f3(0x1da)]!==undefined&&(_0x1d1ec6[_0x2054f3(0x215)]=_0x3d5ad5[_0x2054f3(0x1da)]),_0x3d5ad5[_0x2054f3(0x213)]!==undefined&&(_0x1d1ec6[_0x2054f3(0x212)]=_0x3d5ad5['payout']),_0x3d5ad5['login']!==undefined&&(_0x1d1ec6['notificationLogin']=_0x3d5ad5[_0x2054f3(0x1ef)]),_0x3d5ad5['api_error']!==undefined&&(_0x1d1ec6[_0x2054f3(0x1f5)]=_0x3d5ad5[_0x2054f3(0x1f4)]),await database_1[_0x2054f3(0x1d7)][_0x2054f3(0x210)][_0x2054f3(0x208)]({'where':{'shopId':_0x2add26},'data':_0x1d1ec6});}async[a72_0x26a941(0x1fb)](_0x402c98,_0x3b5416){const _0x8b9394=a72_0x26a941;await this[_0x8b9394(0x1df)](_0x402c98);const _0x335338={};_0x3b5416[_0x8b9394(0x1e8)]!==undefined&&(_0x335338['telegramBotApiKey']=_0x3b5416[_0x8b9394(0x1e8)]||null),_0x3b5416['chatId']!==undefined&&(_0x335338[_0x8b9394(0x1ea)]=_0x3b5416[_0x8b9394(0x1f0)]||null),await database_1[_0x8b9394(0x1d7)]['shopSettings']['update']({'where':{'shopId':_0x402c98},'data':_0x335338});}async[a72_0x26a941(0x20b)](_0x5cc567,_0x1d1ce5){const _0x4e8527=a72_0x26a941;await this[_0x4e8527(0x1df)](_0x5cc567);const _0x56926b={};_0x1d1ce5['webhookUrl']!==undefined&&(_0x56926b[_0x4e8527(0x1f8)]=_0x1d1ce5[_0x4e8527(0x1f8)]||null),_0x1d1ce5[_0x4e8527(0x20c)]!==undefined&&(_0x56926b['webhookEvents']=_0x1d1ce5[_0x4e8527(0x20c)]||[]),await database_1['default'][_0x4e8527(0x210)][_0x4e8527(0x208)]({'where':{'shopId':_0x5cc567},'data':_0x56926b});}async['revokeAllApiKeys'](_0x3be705){const _0x41c739=a72_0x26a941,_0x1ec599='pk_'+crypto_1['default'][_0x41c739(0x204)](0x20)[_0x41c739(0x202)](_0x41c739(0x1e3)),_0x4aedcb=_0x41c739(0x1f6)+crypto_1[_0x41c739(0x1d7)]['randomBytes'](0x20)[_0x41c739(0x202)]('hex');await database_1['default'][_0x41c739(0x1d5)]['update']({'where':{'id':_0x3be705},'data':{'publicKey':_0x1ec599,'secretKey':_0x4aedcb}});}async['deleteAccount'](_0x15dd4f,_0x3304e9){const _0x279a39=a72_0x26a941,{passwordConfirmation:_0x3e6305}=_0x3304e9,_0x195d59=await database_1[_0x279a39(0x1d7)][_0x279a39(0x1d5)][_0x279a39(0x1db)]({'where':{'id':_0x15dd4f},'select':{'password':!![]}});if(!_0x195d59)throw new Error(_0x279a39(0x1f3));const _0xaaaa7d=await bcryptjs_1['default'][_0x279a39(0x1ff)](_0x3e6305,_0x195d59[_0x279a39(0x1f7)]);if(!_0xaaaa7d)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x279a39(0x1d7)][_0x279a39(0x1d5)][_0x279a39(0x1e2)]({'where':{'id':_0x15dd4f}});}async[a72_0x26a941(0x1df)](_0x3a658){const _0x49341f=a72_0x26a941,_0x33db64=await database_1[_0x49341f(0x1d7)][_0x49341f(0x210)][_0x49341f(0x1db)]({'where':{'shopId':_0x3a658}});!_0x33db64&&await database_1[_0x49341f(0x1d7)][_0x49341f(0x210)][_0x49341f(0x1dc)]({'data':{'shopId':_0x3a658}});}}exports[a72_0x26a941(0x1f1)]=SettingsService;