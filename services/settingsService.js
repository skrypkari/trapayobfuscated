'use strict';const a72_0x1ef8e1=a72_0x32b1;(function(_0x3528f3,_0x54aef0){const _0x4f5386=a72_0x32b1,_0x23528f=_0x3528f3();while(!![]){try{const _0xd3046b=-parseInt(_0x4f5386(0x6b))/0x1*(-parseInt(_0x4f5386(0x79))/0x2)+parseInt(_0x4f5386(0x78))/0x3*(-parseInt(_0x4f5386(0xa3))/0x4)+-parseInt(_0x4f5386(0xa6))/0x5+parseInt(_0x4f5386(0x89))/0x6+parseInt(_0x4f5386(0x9a))/0x7*(-parseInt(_0x4f5386(0x97))/0x8)+-parseInt(_0x4f5386(0x90))/0x9+parseInt(_0x4f5386(0x6d))/0xa*(parseInt(_0x4f5386(0x8b))/0xb);if(_0xd3046b===_0x54aef0)break;else _0x23528f['push'](_0x23528f['shift']());}catch(_0x2fa3dc){_0x23528f['push'](_0x23528f['shift']());}}}(a72_0x88f9,0xae12c));var __importDefault=this&&this['__importDefault']||function(_0x157ecd){return _0x157ecd&&_0x157ecd['__esModule']?_0x157ecd:{'default':_0x157ecd};};function a72_0x32b1(_0x2a93f4,_0x5ed498){_0x2a93f4=_0x2a93f4-0x6a;const _0x88f90e=a72_0x88f9();let _0x32b190=_0x88f90e[_0x2a93f4];return _0x32b190;}function a72_0x88f9(){const _0x1a75fe=['7WdMYDE','login','hash','crypto','hex','payment_failed','string','__esModule','delete','220632qYApel','refund','password','3256920BppEjL','updateTelegramSettings','shopUrl','isArray','deleteAccount','settings','notificationPaymentSuccess','telegramBotApiKey','notificationPaymentFailed','7fScsQJ','shop','6710hItFuy','getShopSettings','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','payment_success','toString','ensureSettingsExist','notificationPayout','defineProperty','substring','botApiKey','name','69tXpDXg','168458xBZLSl','randomBytes','notificationLogin','maskApiKey','chatId','revokeAllApiKeys','api_error','notificationRefund','max','telegram','update','SettingsService','webhookEvents','findUnique','updateNotifications','changePassword','174576kDWjdx','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','68068PaKEqD','payout','telegramChatId','Current\x20password\x20is\x20incorrect','Shop\x20not\x20found','7911936WJjCNa','default','compare','create','shopSettings','notificationApiError','length','10069768mkFvei','webhookUrl','../config/database'];a72_0x88f9=function(){return _0x1a75fe;};return a72_0x88f9();}Object[a72_0x1ef8e1(0x74)](exports,a72_0x1ef8e1(0xa1),{'value':!![]}),exports[a72_0x1ef8e1(0x84)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a72_0x1ef8e1(0x9d))),database_1=__importDefault(require(a72_0x1ef8e1(0x99)));class SettingsService{[a72_0x1ef8e1(0x7c)](_0x394177){const _0x30b6ee=a72_0x1ef8e1;if(!_0x394177)return'';if(_0x394177[_0x30b6ee(0x96)]<=0x8)return _0x394177;const _0x55f510=_0x394177[_0x30b6ee(0x75)](0x0,0x8),_0x43c582='*'['repeat'](Math[_0x30b6ee(0x81)](0x0,_0x394177[_0x30b6ee(0x96)]-0x8));return _0x55f510+_0x43c582;}['parseWebhookEvents'](_0x3f9005){const _0x41cc09=a72_0x1ef8e1;if(!_0x3f9005)return[];if(Array[_0x41cc09(0xa9)](_0x3f9005))return _0x3f9005;if(typeof _0x3f9005===_0x41cc09(0xa0))try{const _0x23b912=JSON['parse'](_0x3f9005);return Array['isArray'](_0x23b912)?_0x23b912:[];}catch{return[];}return[];}async[a72_0x1ef8e1(0x6e)](_0x1a0fa0){const _0xc0c692=a72_0x1ef8e1,_0x1ff510=await database_1[_0xc0c692(0x91)]['shop']['findUnique']({'where':{'id':_0x1a0fa0},'include':{'settings':!![]}});if(!_0x1ff510)throw new Error('Shop\x20not\x20found');let _0x14017a=_0x1ff510[_0xc0c692(0xab)];return!_0x14017a&&(_0x14017a=await database_1[_0xc0c692(0x91)]['shopSettings'][_0xc0c692(0x93)]({'data':{'shopId':_0x1ff510['id']}})),{'fullName':_0x1ff510[_0xc0c692(0x77)],'brand':_0x1ff510[_0xc0c692(0x77)],'merchantUrl':_0x1ff510[_0xc0c692(0xa8)],'telegramUsername':_0x1ff510[_0xc0c692(0x82)],'telegramBotApiKey':_0x14017a[_0xc0c692(0xad)]?this[_0xc0c692(0x7c)](_0x14017a[_0xc0c692(0xad)]):null,'telegramChatId':_0x14017a[_0xc0c692(0x8d)],'webhookUrl':_0x14017a['webhookUrl'],'webhookEvents':this['parseWebhookEvents'](_0x14017a[_0xc0c692(0x85)]),'notifications':{'payment_success':_0x14017a[_0xc0c692(0xac)],'payment_failed':_0x14017a[_0xc0c692(0x6a)],'refund':_0x14017a[_0xc0c692(0x80)],'payout':_0x14017a[_0xc0c692(0x73)],'login':_0x14017a[_0xc0c692(0x7b)],'api_error':_0x14017a['notificationApiError']}};}async[a72_0x1ef8e1(0x88)](_0x30e6b0,_0x258ea8){const _0x31dc89=a72_0x1ef8e1,{currentPassword:_0x34a822,newPassword:_0x346676,confirmNewPassword:_0x55ab8}=_0x258ea8;if(_0x346676!==_0x55ab8)throw new Error(_0x31dc89(0x6f));if(_0x346676[_0x31dc89(0x96)]<0x6)throw new Error(_0x31dc89(0x8a));const _0x4ecdf2=await database_1['default'][_0x31dc89(0x6c)][_0x31dc89(0x86)]({'where':{'id':_0x30e6b0},'select':{'password':!![]}});if(!_0x4ecdf2)throw new Error('Shop\x20not\x20found');const _0x1e7e5d=await bcryptjs_1[_0x31dc89(0x91)][_0x31dc89(0x92)](_0x34a822,_0x4ecdf2[_0x31dc89(0xa5)]);if(!_0x1e7e5d)throw new Error(_0x31dc89(0x8e));const _0xd55a80=await bcryptjs_1[_0x31dc89(0x91)][_0x31dc89(0x9c)](_0x346676,0xc);await database_1[_0x31dc89(0x91)][_0x31dc89(0x6c)][_0x31dc89(0x83)]({'where':{'id':_0x30e6b0},'data':{'password':_0xd55a80}});}async[a72_0x1ef8e1(0x87)](_0x44b718,_0x1503d6){const _0x1f88da=a72_0x1ef8e1;await this['ensureSettingsExist'](_0x44b718);const _0x342e53={};_0x1503d6[_0x1f88da(0x70)]!==undefined&&(_0x342e53[_0x1f88da(0xac)]=_0x1503d6[_0x1f88da(0x70)]),_0x1503d6[_0x1f88da(0x9f)]!==undefined&&(_0x342e53[_0x1f88da(0x6a)]=_0x1503d6[_0x1f88da(0x9f)]),_0x1503d6[_0x1f88da(0xa4)]!==undefined&&(_0x342e53['notificationRefund']=_0x1503d6[_0x1f88da(0xa4)]),_0x1503d6[_0x1f88da(0x8c)]!==undefined&&(_0x342e53[_0x1f88da(0x73)]=_0x1503d6['payout']),_0x1503d6[_0x1f88da(0x9b)]!==undefined&&(_0x342e53[_0x1f88da(0x7b)]=_0x1503d6[_0x1f88da(0x9b)]),_0x1503d6[_0x1f88da(0x7f)]!==undefined&&(_0x342e53[_0x1f88da(0x95)]=_0x1503d6[_0x1f88da(0x7f)]),await database_1['default'][_0x1f88da(0x94)][_0x1f88da(0x83)]({'where':{'shopId':_0x44b718},'data':_0x342e53});}async[a72_0x1ef8e1(0xa7)](_0x58ebfd,_0x6a1c59){const _0x556b2b=a72_0x1ef8e1;await this[_0x556b2b(0x72)](_0x58ebfd);const _0x1f600d={};_0x6a1c59[_0x556b2b(0x76)]!==undefined&&(_0x1f600d[_0x556b2b(0xad)]=_0x6a1c59[_0x556b2b(0x76)]||null),_0x6a1c59[_0x556b2b(0x7d)]!==undefined&&(_0x1f600d[_0x556b2b(0x8d)]=_0x6a1c59[_0x556b2b(0x7d)]||null),await database_1['default'][_0x556b2b(0x94)]['update']({'where':{'shopId':_0x58ebfd},'data':_0x1f600d});}async['updateWebhookSettings'](_0x525031,_0x33f5ba){const _0x5ef625=a72_0x1ef8e1;await this['ensureSettingsExist'](_0x525031);const _0xb3226d={};_0x33f5ba[_0x5ef625(0x98)]!==undefined&&(_0xb3226d['webhookUrl']=_0x33f5ba[_0x5ef625(0x98)]||null),_0x33f5ba[_0x5ef625(0x85)]!==undefined&&(_0xb3226d[_0x5ef625(0x85)]=_0x33f5ba['webhookEvents']||[]),await database_1[_0x5ef625(0x91)][_0x5ef625(0x94)][_0x5ef625(0x83)]({'where':{'shopId':_0x525031},'data':_0xb3226d});}async[a72_0x1ef8e1(0x7e)](_0x2fe4aa){const _0x186eb4=a72_0x1ef8e1,_0x45dbc3='pk_'+crypto_1['default'][_0x186eb4(0x7a)](0x20)[_0x186eb4(0x71)](_0x186eb4(0x9e)),_0x3df218='sk_'+crypto_1[_0x186eb4(0x91)][_0x186eb4(0x7a)](0x20)[_0x186eb4(0x71)]('hex');await database_1[_0x186eb4(0x91)][_0x186eb4(0x6c)]['update']({'where':{'id':_0x2fe4aa},'data':{'publicKey':_0x45dbc3,'secretKey':_0x3df218}});}async[a72_0x1ef8e1(0xaa)](_0x24566f,_0x5a961d){const _0x20e30e=a72_0x1ef8e1,{passwordConfirmation:_0x50be65}=_0x5a961d,_0x5771a6=await database_1[_0x20e30e(0x91)][_0x20e30e(0x6c)]['findUnique']({'where':{'id':_0x24566f},'select':{'password':!![]}});if(!_0x5771a6)throw new Error(_0x20e30e(0x8f));const _0x3e2eb4=await bcryptjs_1[_0x20e30e(0x91)][_0x20e30e(0x92)](_0x50be65,_0x5771a6['password']);if(!_0x3e2eb4)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x20e30e(0x91)][_0x20e30e(0x6c)][_0x20e30e(0xa2)]({'where':{'id':_0x24566f}});}async['ensureSettingsExist'](_0x50c7da){const _0x494f35=a72_0x1ef8e1,_0x1366ec=await database_1[_0x494f35(0x91)][_0x494f35(0x94)][_0x494f35(0x86)]({'where':{'shopId':_0x50c7da}});!_0x1366ec&&await database_1['default'][_0x494f35(0x94)][_0x494f35(0x93)]({'data':{'shopId':_0x50c7da}});}}exports[a72_0x1ef8e1(0x84)]=SettingsService;