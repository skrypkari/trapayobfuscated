'use strict';const a72_0x58750d=a72_0x4af4;(function(_0x503ca4,_0x336ac5){const _0x196dec=a72_0x4af4,_0x5050fb=_0x503ca4();while(!![]){try{const _0x374cf8=-parseInt(_0x196dec(0x173))/0x1*(parseInt(_0x196dec(0x16a))/0x2)+parseInt(_0x196dec(0x188))/0x3*(-parseInt(_0x196dec(0x17d))/0x4)+parseInt(_0x196dec(0x17a))/0x5*(-parseInt(_0x196dec(0x14c))/0x6)+parseInt(_0x196dec(0x156))/0x7+parseInt(_0x196dec(0x181))/0x8*(parseInt(_0x196dec(0x17b))/0x9)+-parseInt(_0x196dec(0x167))/0xa*(-parseInt(_0x196dec(0x158))/0xb)+-parseInt(_0x196dec(0x151))/0xc;if(_0x374cf8===_0x336ac5)break;else _0x5050fb['push'](_0x5050fb['shift']());}catch(_0x400f82){_0x5050fb['push'](_0x5050fb['shift']());}}}(a72_0x2093,0x7a5f1));function a72_0x2093(){const _0x8011d3=['notificationRefund','substring','80cmKCaI','4422483cZGuQR','changePassword','8116hIjDRb','create','crypto','updateWebhookSettings','16ZNiJKC','ensureSettingsExist','telegram','login','maskApiKey','max','SettingsService','147dVtCIn','shop','length','parseWebhookEvents','string','botApiKey','shopSettings','__importDefault','bcryptjs','98814wbfEkp','api_error','toString','chatId','pk_','8806236OGZNxQ','notificationPayout','../config/database','getShopSettings','compare','6676187dzjAWh','name','16137fBSEud','delete','password','findUnique','webhookUrl','notificationPaymentFailed','hex','hash','isArray','payout','deleteAccount','randomBytes','telegramBotApiKey','defineProperty','revokeAllApiKeys','4440vENZYu','Shop\x20not\x20found','webhookEvents','494926jSUYDn','updateNotifications','notificationApiError','notificationLogin','Password\x20confirmation\x20is\x20incorrect','telegramChatId','update','Current\x20password\x20is\x20incorrect','__esModule','4xmkbhI','default','settings','notificationPaymentSuccess','payment_failed'];a72_0x2093=function(){return _0x8011d3;};return a72_0x2093();}var __importDefault=this&&this[a72_0x58750d(0x18f)]||function(_0x4f6901){const _0x222fc9=a72_0x58750d;return _0x4f6901&&_0x4f6901[_0x222fc9(0x172)]?_0x4f6901:{'default':_0x4f6901};};Object[a72_0x58750d(0x165)](exports,a72_0x58750d(0x172),{'value':!![]}),exports[a72_0x58750d(0x187)]=void 0x0;const bcryptjs_1=__importDefault(require(a72_0x58750d(0x190))),crypto_1=__importDefault(require(a72_0x58750d(0x17f))),database_1=__importDefault(require(a72_0x58750d(0x153)));function a72_0x4af4(_0x28dbd6,_0x4b6316){_0x28dbd6=_0x28dbd6-0x14c;const _0x209303=a72_0x2093();let _0x4af43d=_0x209303[_0x28dbd6];return _0x4af43d;}class SettingsService{[a72_0x58750d(0x185)](_0x6ef084){const _0x5ef13e=a72_0x58750d;if(!_0x6ef084)return'';if(_0x6ef084[_0x5ef13e(0x18a)]<=0x8)return _0x6ef084;const _0x543dad=_0x6ef084[_0x5ef13e(0x179)](0x0,0x8),_0x151c68='*'['repeat'](Math[_0x5ef13e(0x186)](0x0,_0x6ef084[_0x5ef13e(0x18a)]-0x8));return _0x543dad+_0x151c68;}['parseWebhookEvents'](_0x5950dc){const _0xf96ee3=a72_0x58750d;if(!_0x5950dc)return[];if(Array[_0xf96ee3(0x160)](_0x5950dc))return _0x5950dc;if(typeof _0x5950dc===_0xf96ee3(0x18c))try{const _0x83f939=JSON['parse'](_0x5950dc);return Array['isArray'](_0x83f939)?_0x83f939:[];}catch{return[];}return[];}async[a72_0x58750d(0x154)](_0x7f99c3){const _0x48aac2=a72_0x58750d,_0x3fda00=await database_1['default']['shop'][_0x48aac2(0x15b)]({'where':{'id':_0x7f99c3},'include':{'settings':!![]}});if(!_0x3fda00)throw new Error(_0x48aac2(0x168));let _0x5a5cee=_0x3fda00[_0x48aac2(0x175)];return!_0x5a5cee&&(_0x5a5cee=await database_1['default'][_0x48aac2(0x18e)][_0x48aac2(0x17e)]({'data':{'shopId':_0x3fda00['id']}})),{'fullName':_0x3fda00[_0x48aac2(0x157)],'brand':_0x3fda00['name'],'merchantUrl':_0x3fda00['shopUrl'],'telegramUsername':_0x3fda00[_0x48aac2(0x183)],'telegramBotApiKey':_0x5a5cee[_0x48aac2(0x164)]?this['maskApiKey'](_0x5a5cee[_0x48aac2(0x164)]):null,'telegramChatId':_0x5a5cee[_0x48aac2(0x16f)],'webhookUrl':_0x5a5cee[_0x48aac2(0x15c)],'webhookEvents':this[_0x48aac2(0x18b)](_0x5a5cee['webhookEvents']),'notifications':{'payment_success':_0x5a5cee[_0x48aac2(0x176)],'payment_failed':_0x5a5cee[_0x48aac2(0x15d)],'refund':_0x5a5cee[_0x48aac2(0x178)],'payout':_0x5a5cee[_0x48aac2(0x152)],'login':_0x5a5cee[_0x48aac2(0x16d)],'api_error':_0x5a5cee[_0x48aac2(0x16c)]}};}async[a72_0x58750d(0x17c)](_0x56fc2e,_0x380169){const _0x2bda28=a72_0x58750d,{currentPassword:_0x3615ac,newPassword:_0x1003f3,confirmNewPassword:_0x2981df}=_0x380169;if(_0x1003f3!==_0x2981df)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x1003f3[_0x2bda28(0x18a)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x4a2c30=await database_1[_0x2bda28(0x174)][_0x2bda28(0x189)][_0x2bda28(0x15b)]({'where':{'id':_0x56fc2e},'select':{'password':!![]}});if(!_0x4a2c30)throw new Error('Shop\x20not\x20found');const _0x77ecc5=await bcryptjs_1[_0x2bda28(0x174)][_0x2bda28(0x155)](_0x3615ac,_0x4a2c30[_0x2bda28(0x15a)]);if(!_0x77ecc5)throw new Error(_0x2bda28(0x171));const _0x10e6dc=await bcryptjs_1[_0x2bda28(0x174)][_0x2bda28(0x15f)](_0x1003f3,0xc);await database_1[_0x2bda28(0x174)]['shop'][_0x2bda28(0x170)]({'where':{'id':_0x56fc2e},'data':{'password':_0x10e6dc}});}async[a72_0x58750d(0x16b)](_0x240433,_0x587d97){const _0x16b213=a72_0x58750d;await this[_0x16b213(0x182)](_0x240433);const _0x1b50d2={};_0x587d97['payment_success']!==undefined&&(_0x1b50d2[_0x16b213(0x176)]=_0x587d97['payment_success']),_0x587d97[_0x16b213(0x177)]!==undefined&&(_0x1b50d2[_0x16b213(0x15d)]=_0x587d97[_0x16b213(0x177)]),_0x587d97['refund']!==undefined&&(_0x1b50d2['notificationRefund']=_0x587d97['refund']),_0x587d97[_0x16b213(0x161)]!==undefined&&(_0x1b50d2[_0x16b213(0x152)]=_0x587d97['payout']),_0x587d97[_0x16b213(0x184)]!==undefined&&(_0x1b50d2['notificationLogin']=_0x587d97[_0x16b213(0x184)]),_0x587d97[_0x16b213(0x14d)]!==undefined&&(_0x1b50d2[_0x16b213(0x16c)]=_0x587d97[_0x16b213(0x14d)]),await database_1['default'][_0x16b213(0x18e)][_0x16b213(0x170)]({'where':{'shopId':_0x240433},'data':_0x1b50d2});}async['updateTelegramSettings'](_0x23e09e,_0x1ebd6b){const _0x4e687a=a72_0x58750d;await this['ensureSettingsExist'](_0x23e09e);const _0x251f11={};_0x1ebd6b['botApiKey']!==undefined&&(_0x251f11[_0x4e687a(0x164)]=_0x1ebd6b[_0x4e687a(0x18d)]||null),_0x1ebd6b[_0x4e687a(0x14f)]!==undefined&&(_0x251f11['telegramChatId']=_0x1ebd6b[_0x4e687a(0x14f)]||null),await database_1[_0x4e687a(0x174)][_0x4e687a(0x18e)][_0x4e687a(0x170)]({'where':{'shopId':_0x23e09e},'data':_0x251f11});}async[a72_0x58750d(0x180)](_0x3a3e86,_0x4858e5){const _0x1dd07d=a72_0x58750d;await this['ensureSettingsExist'](_0x3a3e86);const _0x2fc8f6={};_0x4858e5[_0x1dd07d(0x15c)]!==undefined&&(_0x2fc8f6[_0x1dd07d(0x15c)]=_0x4858e5['webhookUrl']||null),_0x4858e5[_0x1dd07d(0x169)]!==undefined&&(_0x2fc8f6[_0x1dd07d(0x169)]=_0x4858e5[_0x1dd07d(0x169)]||[]),await database_1[_0x1dd07d(0x174)][_0x1dd07d(0x18e)][_0x1dd07d(0x170)]({'where':{'shopId':_0x3a3e86},'data':_0x2fc8f6});}async[a72_0x58750d(0x166)](_0x2063c1){const _0x5dc073=a72_0x58750d,_0x3bd07d=_0x5dc073(0x150)+crypto_1[_0x5dc073(0x174)][_0x5dc073(0x163)](0x20)['toString'](_0x5dc073(0x15e)),_0x58c8f2='sk_'+crypto_1['default'][_0x5dc073(0x163)](0x20)[_0x5dc073(0x14e)](_0x5dc073(0x15e));await database_1['default']['shop'][_0x5dc073(0x170)]({'where':{'id':_0x2063c1},'data':{'publicKey':_0x3bd07d,'secretKey':_0x58c8f2}});}async[a72_0x58750d(0x162)](_0x32670e,_0x4b8e20){const _0x139535=a72_0x58750d,{passwordConfirmation:_0x57d7a0}=_0x4b8e20,_0x235be9=await database_1[_0x139535(0x174)][_0x139535(0x189)][_0x139535(0x15b)]({'where':{'id':_0x32670e},'select':{'password':!![]}});if(!_0x235be9)throw new Error(_0x139535(0x168));const _0xa1785d=await bcryptjs_1[_0x139535(0x174)][_0x139535(0x155)](_0x57d7a0,_0x235be9[_0x139535(0x15a)]);if(!_0xa1785d)throw new Error(_0x139535(0x16e));await database_1[_0x139535(0x174)][_0x139535(0x189)][_0x139535(0x159)]({'where':{'id':_0x32670e}});}async[a72_0x58750d(0x182)](_0x40c98d){const _0xfb7058=a72_0x58750d,_0x46b4d3=await database_1[_0xfb7058(0x174)][_0xfb7058(0x18e)]['findUnique']({'where':{'shopId':_0x40c98d}});!_0x46b4d3&&await database_1[_0xfb7058(0x174)][_0xfb7058(0x18e)]['create']({'data':{'shopId':_0x40c98d}});}}exports[a72_0x58750d(0x187)]=SettingsService;