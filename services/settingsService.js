'use strict';const a47_0x14e140=a47_0x1e8a;(function(_0x2af358,_0x2ab0f0){const _0x2e7251=a47_0x1e8a,_0x31fb1e=_0x2af358();while(!![]){try{const _0x232782=parseInt(_0x2e7251(0xd2))/0x1+-parseInt(_0x2e7251(0xcb))/0x2*(parseInt(_0x2e7251(0xd4))/0x3)+-parseInt(_0x2e7251(0xa6))/0x4+parseInt(_0x2e7251(0xe7))/0x5+parseInt(_0x2e7251(0xb5))/0x6*(-parseInt(_0x2e7251(0xca))/0x7)+-parseInt(_0x2e7251(0xd0))/0x8*(-parseInt(_0x2e7251(0xb7))/0x9)+-parseInt(_0x2e7251(0xd6))/0xa*(-parseInt(_0x2e7251(0xa8))/0xb);if(_0x232782===_0x2ab0f0)break;else _0x31fb1e['push'](_0x31fb1e['shift']());}catch(_0x352f60){_0x31fb1e['push'](_0x31fb1e['shift']());}}}(a47_0xf4a2,0xd8637));function a47_0x1e8a(_0x237178,_0x24f3f1){const _0xf4a28f=a47_0xf4a2();return a47_0x1e8a=function(_0x1e8a05,_0xfcbc61){_0x1e8a05=_0x1e8a05-0xa2;let _0x51b376=_0xf4a28f[_0x1e8a05];return _0x51b376;},a47_0x1e8a(_0x237178,_0x24f3f1);}var __importDefault=this&&this[a47_0x14e140(0xa7)]||function(_0x504aaa){const _0x3c9fc3=a47_0x14e140;return _0x504aaa&&_0x504aaa[_0x3c9fc3(0xe3)]?_0x504aaa:{'default':_0x504aaa};};Object[a47_0x14e140(0xdf)](exports,a47_0x14e140(0xe3),{'value':!![]}),exports[a47_0x14e140(0xb3)]=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x14e140(0xa5))),crypto_1=__importDefault(require(a47_0x14e140(0xb8))),database_1=__importDefault(require(a47_0x14e140(0xb4)));function a47_0xf4a2(){const _0x292105=['notificationApiError','delete','botApiKey','password','name','compare','randomBytes','hash','default','sk_','repeat','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','payment_failed','string','4470277fgkfUb','1436SwEOvU','api_error','notificationPaymentFailed','telegramBotApiKey','webhookEvents','10135472iejsbY','login','1319387DwbTPL','length','6285gaLkcK','shopSettings','810COxDOx','shop','notificationRefund','notificationPayout','findUnique','notificationLogin','chatId','revokeAllApiKeys','pk_','defineProperty','ensureSettingsExist','notificationPaymentSuccess','Password\x20confirmation\x20is\x20incorrect','__esModule','isArray','payment_success','updateTelegramSettings','3061735MLWPuU','maskApiKey','shopUrl','update','bcryptjs','6173740WKEOoY','__importDefault','273306jfJKEn','hex','Current\x20password\x20is\x20incorrect','telegramChatId','parseWebhookEvents','toString','telegram','max','updateWebhookSettings','Shop\x20not\x20found','create','SettingsService','../config/database','12vMVqvN','getShopSettings','9wkgLdk','crypto','payout','webhookUrl','updateNotifications'];a47_0xf4a2=function(){return _0x292105;};return a47_0xf4a2();}class SettingsService{[a47_0x14e140(0xa2)](_0x262349){const _0x2bdd65=a47_0x14e140;if(!_0x262349)return'';if(_0x262349[_0x2bdd65(0xd3)]<=0x8)return _0x262349;const _0x33115f=_0x262349['substring'](0x0,0x8),_0x44396b='*'[_0x2bdd65(0xc6)](Math[_0x2bdd65(0xaf)](0x0,_0x262349['length']-0x8));return _0x33115f+_0x44396b;}[a47_0x14e140(0xac)](_0x2c9d65){const _0x2d5da4=a47_0x14e140;if(!_0x2c9d65)return[];if(Array[_0x2d5da4(0xe4)](_0x2c9d65))return _0x2c9d65;if(typeof _0x2c9d65===_0x2d5da4(0xc9))try{const _0x495edb=JSON['parse'](_0x2c9d65);return Array['isArray'](_0x495edb)?_0x495edb:[];}catch{return[];}return[];}async[a47_0x14e140(0xb6)](_0x2eea2b){const _0x5f5259=a47_0x14e140,_0x1dc685=await database_1[_0x5f5259(0xc4)][_0x5f5259(0xd7)]['findUnique']({'where':{'id':_0x2eea2b},'include':{'settings':!![]}});if(!_0x1dc685)throw new Error(_0x5f5259(0xb1));let _0x36130e=_0x1dc685['settings'];return!_0x36130e&&(_0x36130e=await database_1[_0x5f5259(0xc4)]['shopSettings'][_0x5f5259(0xb2)]({'data':{'shopId':_0x1dc685['id']}})),{'fullName':_0x1dc685['name'],'brand':_0x1dc685[_0x5f5259(0xc0)],'merchantUrl':_0x1dc685[_0x5f5259(0xa3)],'telegramUsername':_0x1dc685[_0x5f5259(0xae)],'telegramBotApiKey':_0x36130e['telegramBotApiKey']?this[_0x5f5259(0xa2)](_0x36130e[_0x5f5259(0xce)]):null,'telegramChatId':_0x36130e[_0x5f5259(0xab)],'webhookUrl':_0x36130e['webhookUrl'],'webhookEvents':this[_0x5f5259(0xac)](_0x36130e[_0x5f5259(0xcf)]),'notifications':{'payment_success':_0x36130e['notificationPaymentSuccess'],'payment_failed':_0x36130e[_0x5f5259(0xcd)],'refund':_0x36130e[_0x5f5259(0xd8)],'payout':_0x36130e[_0x5f5259(0xd9)],'login':_0x36130e['notificationLogin'],'api_error':_0x36130e[_0x5f5259(0xbc)]}};}async['changePassword'](_0x40bf00,_0x510ba7){const _0x4558b0=a47_0x14e140,{currentPassword:_0x15939c,newPassword:_0x386ad0,confirmNewPassword:_0x5e32dd}=_0x510ba7;if(_0x386ad0!==_0x5e32dd)throw new Error(_0x4558b0(0xc7));if(_0x386ad0['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x2a5e60=await database_1['default'][_0x4558b0(0xd7)][_0x4558b0(0xda)]({'where':{'id':_0x40bf00},'select':{'password':!![]}});if(!_0x2a5e60)throw new Error('Shop\x20not\x20found');const _0xdd2531=await bcryptjs_1['default'][_0x4558b0(0xc1)](_0x15939c,_0x2a5e60[_0x4558b0(0xbf)]);if(!_0xdd2531)throw new Error(_0x4558b0(0xaa));const _0x46e0d9=await bcryptjs_1[_0x4558b0(0xc4)][_0x4558b0(0xc3)](_0x386ad0,0xc);await database_1['default']['shop'][_0x4558b0(0xa4)]({'where':{'id':_0x40bf00},'data':{'password':_0x46e0d9}});}async[a47_0x14e140(0xbb)](_0x299670,_0x22fa4b){const _0x42278c=a47_0x14e140;await this[_0x42278c(0xe0)](_0x299670);const _0x537fde={};_0x22fa4b[_0x42278c(0xe5)]!==undefined&&(_0x537fde[_0x42278c(0xe1)]=_0x22fa4b[_0x42278c(0xe5)]),_0x22fa4b[_0x42278c(0xc8)]!==undefined&&(_0x537fde['notificationPaymentFailed']=_0x22fa4b[_0x42278c(0xc8)]),_0x22fa4b['refund']!==undefined&&(_0x537fde[_0x42278c(0xd8)]=_0x22fa4b['refund']),_0x22fa4b['payout']!==undefined&&(_0x537fde[_0x42278c(0xd9)]=_0x22fa4b[_0x42278c(0xb9)]),_0x22fa4b[_0x42278c(0xd1)]!==undefined&&(_0x537fde[_0x42278c(0xdb)]=_0x22fa4b[_0x42278c(0xd1)]),_0x22fa4b[_0x42278c(0xcc)]!==undefined&&(_0x537fde[_0x42278c(0xbc)]=_0x22fa4b[_0x42278c(0xcc)]),await database_1[_0x42278c(0xc4)][_0x42278c(0xd5)][_0x42278c(0xa4)]({'where':{'shopId':_0x299670},'data':_0x537fde});}async[a47_0x14e140(0xe6)](_0x5dc266,_0x3093e3){const _0x13eae1=a47_0x14e140;await this[_0x13eae1(0xe0)](_0x5dc266);const _0x2f9323={};_0x3093e3[_0x13eae1(0xbe)]!==undefined&&(_0x2f9323[_0x13eae1(0xce)]=_0x3093e3[_0x13eae1(0xbe)]||null),_0x3093e3[_0x13eae1(0xdc)]!==undefined&&(_0x2f9323[_0x13eae1(0xab)]=_0x3093e3[_0x13eae1(0xdc)]||null),await database_1[_0x13eae1(0xc4)][_0x13eae1(0xd5)][_0x13eae1(0xa4)]({'where':{'shopId':_0x5dc266},'data':_0x2f9323});}async[a47_0x14e140(0xb0)](_0x4b3ea0,_0x26021d){const _0xd2d0ff=a47_0x14e140;await this[_0xd2d0ff(0xe0)](_0x4b3ea0);const _0x204512={};_0x26021d[_0xd2d0ff(0xba)]!==undefined&&(_0x204512[_0xd2d0ff(0xba)]=_0x26021d[_0xd2d0ff(0xba)]||null),_0x26021d['webhookEvents']!==undefined&&(_0x204512[_0xd2d0ff(0xcf)]=_0x26021d[_0xd2d0ff(0xcf)]||[]),await database_1['default'][_0xd2d0ff(0xd5)][_0xd2d0ff(0xa4)]({'where':{'shopId':_0x4b3ea0},'data':_0x204512});}async[a47_0x14e140(0xdd)](_0x3412d4){const _0x358078=a47_0x14e140,_0x57d494=_0x358078(0xde)+crypto_1[_0x358078(0xc4)][_0x358078(0xc2)](0x20)[_0x358078(0xad)](_0x358078(0xa9)),_0x58a88e=_0x358078(0xc5)+crypto_1[_0x358078(0xc4)][_0x358078(0xc2)](0x20)[_0x358078(0xad)](_0x358078(0xa9));await database_1['default']['shop'][_0x358078(0xa4)]({'where':{'id':_0x3412d4},'data':{'publicKey':_0x57d494,'secretKey':_0x58a88e}});}async['deleteAccount'](_0x5c97ae,_0x2f12be){const _0x2a0ef6=a47_0x14e140,{passwordConfirmation:_0x5bcc22}=_0x2f12be,_0x3a7def=await database_1['default']['shop']['findUnique']({'where':{'id':_0x5c97ae},'select':{'password':!![]}});if(!_0x3a7def)throw new Error(_0x2a0ef6(0xb1));const _0x148789=await bcryptjs_1[_0x2a0ef6(0xc4)]['compare'](_0x5bcc22,_0x3a7def[_0x2a0ef6(0xbf)]);if(!_0x148789)throw new Error(_0x2a0ef6(0xe2));await database_1['default'][_0x2a0ef6(0xd7)][_0x2a0ef6(0xbd)]({'where':{'id':_0x5c97ae}});}async[a47_0x14e140(0xe0)](_0x38579a){const _0x8377f3=a47_0x14e140,_0x54bd8b=await database_1[_0x8377f3(0xc4)]['shopSettings'][_0x8377f3(0xda)]({'where':{'shopId':_0x38579a}});!_0x54bd8b&&await database_1[_0x8377f3(0xc4)][_0x8377f3(0xd5)][_0x8377f3(0xb2)]({'data':{'shopId':_0x38579a}});}}exports[a47_0x14e140(0xb3)]=SettingsService;