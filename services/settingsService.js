'use strict';const a56_0x58f0ce=a56_0x2a13;(function(_0x1bbb2d,_0x240ba7){const _0x53658d=a56_0x2a13,_0xd08723=_0x1bbb2d();while(!![]){try{const _0x7d337e=-parseInt(_0x53658d(0x1cc))/0x1+parseInt(_0x53658d(0x1e6))/0x2*(-parseInt(_0x53658d(0x1ea))/0x3)+parseInt(_0x53658d(0x1e0))/0x4+parseInt(_0x53658d(0x1e9))/0x5+parseInt(_0x53658d(0x200))/0x6*(parseInt(_0x53658d(0x1dc))/0x7)+-parseInt(_0x53658d(0x1e2))/0x8+parseInt(_0x53658d(0x1dd))/0x9;if(_0x7d337e===_0x240ba7)break;else _0xd08723['push'](_0xd08723['shift']());}catch(_0x31c816){_0xd08723['push'](_0xd08723['shift']());}}}(a56_0x3952,0x26a3a));var __importDefault=this&&this[a56_0x58f0ce(0x1d4)]||function(_0x2432ab){const _0x55173f=a56_0x58f0ce;return _0x2432ab&&_0x2432ab[_0x55173f(0x1ce)]?_0x2432ab:{'default':_0x2432ab};};function a56_0x2a13(_0x34773f,_0x971d78){const _0x3952ca=a56_0x3952();return a56_0x2a13=function(_0x2a1315,_0x46c11e){_0x2a1315=_0x2a1315-0x1c0;let _0x228f05=_0x3952ca[_0x2a1315];return _0x228f05;},a56_0x2a13(_0x34773f,_0x971d78);}Object[a56_0x58f0ce(0x1e4)](exports,a56_0x58f0ce(0x1ce),{'value':!![]}),exports[a56_0x58f0ce(0x202)]=void 0x0;const bcryptjs_1=__importDefault(require(a56_0x58f0ce(0x1d2))),crypto_1=__importDefault(require(a56_0x58f0ce(0x1d7))),database_1=__importDefault(require(a56_0x58f0ce(0x1e7)));class SettingsService{[a56_0x58f0ce(0x1d8)](_0x6d9b42){const _0x4ae6bf=a56_0x58f0ce;if(!_0x6d9b42)return'';if(_0x6d9b42[_0x4ae6bf(0x1d6)]<=0x8)return _0x6d9b42;const _0x200201=_0x6d9b42[_0x4ae6bf(0x1f4)](0x0,0x8),_0x48e2f8='*'['repeat'](Math[_0x4ae6bf(0x1f8)](0x0,_0x6d9b42['length']-0x8));return _0x200201+_0x48e2f8;}[a56_0x58f0ce(0x1cb)](_0xacded1){const _0x3317ee=a56_0x58f0ce;if(!_0xacded1)return[];if(Array['isArray'](_0xacded1))return _0xacded1;if(typeof _0xacded1==='string')try{const _0xa0d9c3=JSON[_0x3317ee(0x1f7)](_0xacded1);return Array[_0x3317ee(0x1c6)](_0xa0d9c3)?_0xa0d9c3:[];}catch{return[];}return[];}async['getShopSettings'](_0xff2a2a){const _0x3e460d=a56_0x58f0ce,_0x1fd312=await database_1[_0x3e460d(0x1f9)][_0x3e460d(0x1d9)][_0x3e460d(0x1ff)]({'where':{'id':_0xff2a2a},'include':{'settings':!![]}});if(!_0x1fd312)throw new Error('Shop\x20not\x20found');let _0x56c567=_0x1fd312[_0x3e460d(0x1f6)];return!_0x56c567&&(_0x56c567=await database_1[_0x3e460d(0x1f9)][_0x3e460d(0x1ec)][_0x3e460d(0x1f5)]({'data':{'shopId':_0x1fd312['id']}})),{'fullName':_0x1fd312[_0x3e460d(0x1ee)],'brand':_0x1fd312[_0x3e460d(0x1ee)],'merchantUrl':_0x1fd312[_0x3e460d(0x1f3)],'telegramUsername':_0x1fd312[_0x3e460d(0x1f2)],'telegramBotApiKey':_0x56c567[_0x3e460d(0x201)]?this[_0x3e460d(0x1d8)](_0x56c567[_0x3e460d(0x201)]):null,'telegramChatId':_0x56c567[_0x3e460d(0x1db)],'webhookUrl':_0x56c567[_0x3e460d(0x1c1)],'webhookEvents':this[_0x3e460d(0x1cb)](_0x56c567[_0x3e460d(0x1fa)]),'notifications':{'payment_success':_0x56c567[_0x3e460d(0x1fb)],'payment_failed':_0x56c567['notificationPaymentFailed'],'refund':_0x56c567[_0x3e460d(0x1cf)],'payout':_0x56c567[_0x3e460d(0x1df)],'login':_0x56c567[_0x3e460d(0x1d5)],'api_error':_0x56c567[_0x3e460d(0x1c7)]}};}async[a56_0x58f0ce(0x1c8)](_0x43d993,_0x1b6916){const _0x4fd6d5=a56_0x58f0ce,{currentPassword:_0x4cd46b,newPassword:_0x1a3650,confirmNewPassword:_0x341b16}=_0x1b6916;if(_0x1a3650!==_0x341b16)throw new Error(_0x4fd6d5(0x1f1));if(_0x1a3650[_0x4fd6d5(0x1d6)]<0x6)throw new Error(_0x4fd6d5(0x1e8));const _0x279f72=await database_1['default'][_0x4fd6d5(0x1d9)][_0x4fd6d5(0x1ff)]({'where':{'id':_0x43d993},'select':{'password':!![]}});if(!_0x279f72)throw new Error('Shop\x20not\x20found');const _0x24adcd=await bcryptjs_1[_0x4fd6d5(0x1f9)][_0x4fd6d5(0x1c9)](_0x4cd46b,_0x279f72[_0x4fd6d5(0x1e5)]);if(!_0x24adcd)throw new Error('Current\x20password\x20is\x20incorrect');const _0xbfb7cb=await bcryptjs_1[_0x4fd6d5(0x1f9)][_0x4fd6d5(0x1eb)](_0x1a3650,0xc);await database_1[_0x4fd6d5(0x1f9)]['shop'][_0x4fd6d5(0x1d0)]({'where':{'id':_0x43d993},'data':{'password':_0xbfb7cb}});}async['updateNotifications'](_0x56ca5e,_0x30e580){const _0x9a05e2=a56_0x58f0ce;await this[_0x9a05e2(0x1c2)](_0x56ca5e);const _0x46d1ba={};_0x30e580[_0x9a05e2(0x1ca)]!==undefined&&(_0x46d1ba[_0x9a05e2(0x1fb)]=_0x30e580[_0x9a05e2(0x1ca)]),_0x30e580[_0x9a05e2(0x1e1)]!==undefined&&(_0x46d1ba[_0x9a05e2(0x1f0)]=_0x30e580[_0x9a05e2(0x1e1)]),_0x30e580[_0x9a05e2(0x1cd)]!==undefined&&(_0x46d1ba[_0x9a05e2(0x1cf)]=_0x30e580[_0x9a05e2(0x1cd)]),_0x30e580['payout']!==undefined&&(_0x46d1ba[_0x9a05e2(0x1df)]=_0x30e580[_0x9a05e2(0x1c4)]),_0x30e580[_0x9a05e2(0x1d1)]!==undefined&&(_0x46d1ba[_0x9a05e2(0x1d5)]=_0x30e580[_0x9a05e2(0x1d1)]),_0x30e580['api_error']!==undefined&&(_0x46d1ba[_0x9a05e2(0x1c7)]=_0x30e580[_0x9a05e2(0x1de)]),await database_1[_0x9a05e2(0x1f9)]['shopSettings'][_0x9a05e2(0x1d0)]({'where':{'shopId':_0x56ca5e},'data':_0x46d1ba});}async[a56_0x58f0ce(0x1d3)](_0x56f254,_0x49456c){const _0x179c6e=a56_0x58f0ce;await this[_0x179c6e(0x1c2)](_0x56f254);const _0x116323={};_0x49456c[_0x179c6e(0x1c5)]!==undefined&&(_0x116323[_0x179c6e(0x201)]=_0x49456c['botApiKey']||null),_0x49456c[_0x179c6e(0x1c3)]!==undefined&&(_0x116323[_0x179c6e(0x1db)]=_0x49456c[_0x179c6e(0x1c3)]||null),await database_1[_0x179c6e(0x1f9)][_0x179c6e(0x1ec)]['update']({'where':{'shopId':_0x56f254},'data':_0x116323});}async[a56_0x58f0ce(0x1e3)](_0x40e042,_0x3b8563){const _0x44883b=a56_0x58f0ce;await this['ensureSettingsExist'](_0x40e042);const _0x88b2c={};_0x3b8563[_0x44883b(0x1c1)]!==undefined&&(_0x88b2c[_0x44883b(0x1c1)]=_0x3b8563['webhookUrl']||null),_0x3b8563[_0x44883b(0x1fa)]!==undefined&&(_0x88b2c[_0x44883b(0x1fa)]=_0x3b8563['webhookEvents']||[]),await database_1[_0x44883b(0x1f9)][_0x44883b(0x1ec)][_0x44883b(0x1d0)]({'where':{'shopId':_0x40e042},'data':_0x88b2c});}async[a56_0x58f0ce(0x1ed)](_0x1dbf79){const _0x29d67c=a56_0x58f0ce,_0x155b7f=_0x29d67c(0x1c0)+crypto_1[_0x29d67c(0x1f9)][_0x29d67c(0x1fe)](0x20)[_0x29d67c(0x1ef)](_0x29d67c(0x1fc)),_0x34418b='sk_'+crypto_1[_0x29d67c(0x1f9)][_0x29d67c(0x1fe)](0x20)[_0x29d67c(0x1ef)](_0x29d67c(0x1fc));await database_1[_0x29d67c(0x1f9)][_0x29d67c(0x1d9)][_0x29d67c(0x1d0)]({'where':{'id':_0x1dbf79},'data':{'publicKey':_0x155b7f,'secretKey':_0x34418b}});}async['deleteAccount'](_0x541465,_0x185fba){const _0x4d4dcb=a56_0x58f0ce,{passwordConfirmation:_0x169a93}=_0x185fba,_0x2166ba=await database_1['default'][_0x4d4dcb(0x1d9)][_0x4d4dcb(0x1ff)]({'where':{'id':_0x541465},'select':{'password':!![]}});if(!_0x2166ba)throw new Error(_0x4d4dcb(0x1da));const _0x528f97=await bcryptjs_1[_0x4d4dcb(0x1f9)]['compare'](_0x169a93,_0x2166ba[_0x4d4dcb(0x1e5)]);if(!_0x528f97)throw new Error(_0x4d4dcb(0x1fd));await database_1[_0x4d4dcb(0x1f9)][_0x4d4dcb(0x1d9)]['delete']({'where':{'id':_0x541465}});}async[a56_0x58f0ce(0x1c2)](_0x163785){const _0x8d23c0=a56_0x58f0ce,_0x25d94d=await database_1[_0x8d23c0(0x1f9)]['shopSettings'][_0x8d23c0(0x1ff)]({'where':{'shopId':_0x163785}});!_0x25d94d&&await database_1[_0x8d23c0(0x1f9)][_0x8d23c0(0x1ec)][_0x8d23c0(0x1f5)]({'data':{'shopId':_0x163785}});}}function a56_0x3952(){const _0x1de94c=['99442PyvyxJ','../config/database','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','1537655TXiCDa','18XkesEn','hash','shopSettings','revokeAllApiKeys','name','toString','notificationPaymentFailed','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','telegram','shopUrl','substring','create','settings','parse','max','default','webhookEvents','notificationPaymentSuccess','hex','Password\x20confirmation\x20is\x20incorrect','randomBytes','findUnique','214476oLTStM','telegramBotApiKey','SettingsService','pk_','webhookUrl','ensureSettingsExist','chatId','payout','botApiKey','isArray','notificationApiError','changePassword','compare','payment_success','parseWebhookEvents','29429YuQztX','refund','__esModule','notificationRefund','update','login','bcryptjs','updateTelegramSettings','__importDefault','notificationLogin','length','crypto','maskApiKey','shop','Shop\x20not\x20found','telegramChatId','14uLkkjI','2272248TFzaEh','api_error','notificationPayout','440576YGBYiB','payment_failed','2044944QgiLUK','updateWebhookSettings','defineProperty','password'];a56_0x3952=function(){return _0x1de94c;};return a56_0x3952();}exports[a56_0x58f0ce(0x202)]=SettingsService;