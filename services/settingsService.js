'use strict';const a55_0x10a090=a55_0x3906;(function(_0x3bb2b4,_0xb6dc43){const _0x3f7e3a=a55_0x3906,_0x244662=_0x3bb2b4();while(!![]){try{const _0x526d96=parseInt(_0x3f7e3a(0xb0))/0x1*(-parseInt(_0x3f7e3a(0xa5))/0x2)+-parseInt(_0x3f7e3a(0xbc))/0x3*(parseInt(_0x3f7e3a(0xa4))/0x4)+parseInt(_0x3f7e3a(0xa3))/0x5+-parseInt(_0x3f7e3a(0xaf))/0x6*(parseInt(_0x3f7e3a(0x99))/0x7)+parseInt(_0x3f7e3a(0xc0))/0x8+-parseInt(_0x3f7e3a(0xc1))/0x9*(parseInt(_0x3f7e3a(0x89))/0xa)+-parseInt(_0x3f7e3a(0xc3))/0xb*(-parseInt(_0x3f7e3a(0x97))/0xc);if(_0x526d96===_0xb6dc43)break;else _0x244662['push'](_0x244662['shift']());}catch(_0x4b907d){_0x244662['push'](_0x244662['shift']());}}}(a55_0x3ebd,0x6ae9c));function a55_0x3906(_0x3e24bf,_0x577f67){const _0x3ebd60=a55_0x3ebd();return a55_0x3906=function(_0x39066f,_0x56b701){_0x39066f=_0x39066f-0x89;let _0x31cc88=_0x3ebd60[_0x39066f];return _0x31cc88;},a55_0x3906(_0x3e24bf,_0x577f67);}var __importDefault=this&&this[a55_0x10a090(0xc9)]||function(_0x4d4538){const _0xe3234e=a55_0x10a090;return _0x4d4538&&_0x4d4538[_0xe3234e(0xb3)]?_0x4d4538:{'default':_0x4d4538};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a55_0x10a090(0x9c)]=void 0x0;const bcryptjs_1=__importDefault(require(a55_0x10a090(0xa9))),crypto_1=__importDefault(require(a55_0x10a090(0xb7))),database_1=__importDefault(require(a55_0x10a090(0xba)));function a55_0x3ebd(){const _0x26be34=['ensureSettingsExist','payment_failed','default','updateTelegramSettings','notificationLogin','telegram','changePassword','botApiKey','notificationApiError','refund','api_error','create','1788852PAXgDB','Password\x20confirmation\x20is\x20incorrect','196483gMaDQc','Shop\x20not\x20found','max','SettingsService','telegramChatId','findUnique','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','name','settings','hex','3892995HwoYSC','53572OpFSHw','163316pOtQVa','webhookEvents','login','webhookUrl','bcryptjs','update','updateNotifications','parseWebhookEvents','notificationRefund','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','42XYpmWu','2nqKOGr','payout','randomBytes','__esModule','payment_success','deleteAccount','hash','crypto','toString','getShopSettings','../config/database','delete','102PUXIpv','shop','notificationPaymentSuccess','shopSettings','4679768VoeKao','1673118aZazCc','revokeAllApiKeys','33DnEOEp','compare','telegramBotApiKey','updateWebhookSettings','sk_','string','__importDefault','password','notificationPayout','length','repeat','30VWBazd','notificationPaymentFailed'];a55_0x3ebd=function(){return _0x26be34;};return a55_0x3ebd();}class SettingsService{['maskApiKey'](_0x111a7a){const _0x32ff29=a55_0x10a090;if(!_0x111a7a)return'';if(_0x111a7a[_0x32ff29(0xcc)]<=0x8)return _0x111a7a;const _0x12bd21=_0x111a7a['substring'](0x0,0x8),_0x2c9685='*'[_0x32ff29(0xcd)](Math[_0x32ff29(0x9b)](0x0,_0x111a7a[_0x32ff29(0xcc)]-0x8));return _0x12bd21+_0x2c9685;}[a55_0x10a090(0xac)](_0x17694b){const _0x3fa16c=a55_0x10a090;if(!_0x17694b)return[];if(Array['isArray'](_0x17694b))return _0x17694b;if(typeof _0x17694b===_0x3fa16c(0xc8))try{const _0x1ea224=JSON['parse'](_0x17694b);return Array['isArray'](_0x1ea224)?_0x1ea224:[];}catch{return[];}return[];}async[a55_0x10a090(0xb9)](_0xab4946){const _0x1dcfa2=a55_0x10a090,_0x578678=await database_1[_0x1dcfa2(0x8d)][_0x1dcfa2(0xbd)]['findUnique']({'where':{'id':_0xab4946},'include':{'settings':!![]}});if(!_0x578678)throw new Error(_0x1dcfa2(0x9a));let _0x5d3014=_0x578678[_0x1dcfa2(0xa1)];return!_0x5d3014&&(_0x5d3014=await database_1[_0x1dcfa2(0x8d)][_0x1dcfa2(0xbf)]['create']({'data':{'shopId':_0x578678['id']}})),{'fullName':_0x578678['name'],'brand':_0x578678[_0x1dcfa2(0xa0)],'merchantUrl':_0x578678['shopUrl'],'telegramUsername':_0x578678[_0x1dcfa2(0x90)],'telegramBotApiKey':_0x5d3014[_0x1dcfa2(0xc5)]?this['maskApiKey'](_0x5d3014[_0x1dcfa2(0xc5)]):null,'telegramChatId':_0x5d3014[_0x1dcfa2(0x9d)],'webhookUrl':_0x5d3014[_0x1dcfa2(0xa8)],'webhookEvents':this[_0x1dcfa2(0xac)](_0x5d3014[_0x1dcfa2(0xa6)]),'notifications':{'payment_success':_0x5d3014['notificationPaymentSuccess'],'payment_failed':_0x5d3014[_0x1dcfa2(0x8a)],'refund':_0x5d3014[_0x1dcfa2(0xad)],'payout':_0x5d3014[_0x1dcfa2(0xcb)],'login':_0x5d3014[_0x1dcfa2(0x8f)],'api_error':_0x5d3014[_0x1dcfa2(0x93)]}};}async[a55_0x10a090(0x91)](_0x5c214f,_0x563c9b){const _0xb47cdc=a55_0x10a090,{currentPassword:_0x487eff,newPassword:_0x3e5e44,confirmNewPassword:_0x119109}=_0x563c9b;if(_0x3e5e44!==_0x119109)throw new Error(_0xb47cdc(0xae));if(_0x3e5e44[_0xb47cdc(0xcc)]<0x6)throw new Error(_0xb47cdc(0x9f));const _0x582358=await database_1[_0xb47cdc(0x8d)]['shop'][_0xb47cdc(0x9e)]({'where':{'id':_0x5c214f},'select':{'password':!![]}});if(!_0x582358)throw new Error(_0xb47cdc(0x9a));const _0x56b0da=await bcryptjs_1[_0xb47cdc(0x8d)]['compare'](_0x487eff,_0x582358[_0xb47cdc(0xca)]);if(!_0x56b0da)throw new Error('Current\x20password\x20is\x20incorrect');const _0x4eac1c=await bcryptjs_1[_0xb47cdc(0x8d)][_0xb47cdc(0xb6)](_0x3e5e44,0xc);await database_1[_0xb47cdc(0x8d)][_0xb47cdc(0xbd)][_0xb47cdc(0xaa)]({'where':{'id':_0x5c214f},'data':{'password':_0x4eac1c}});}async[a55_0x10a090(0xab)](_0x10b1ee,_0x4f8293){const _0x37fe0d=a55_0x10a090;await this[_0x37fe0d(0x8b)](_0x10b1ee);const _0x22e582={};_0x4f8293[_0x37fe0d(0xb4)]!==undefined&&(_0x22e582[_0x37fe0d(0xbe)]=_0x4f8293[_0x37fe0d(0xb4)]),_0x4f8293['payment_failed']!==undefined&&(_0x22e582[_0x37fe0d(0x8a)]=_0x4f8293[_0x37fe0d(0x8c)]),_0x4f8293[_0x37fe0d(0x94)]!==undefined&&(_0x22e582[_0x37fe0d(0xad)]=_0x4f8293[_0x37fe0d(0x94)]),_0x4f8293[_0x37fe0d(0xb1)]!==undefined&&(_0x22e582[_0x37fe0d(0xcb)]=_0x4f8293[_0x37fe0d(0xb1)]),_0x4f8293[_0x37fe0d(0xa7)]!==undefined&&(_0x22e582['notificationLogin']=_0x4f8293[_0x37fe0d(0xa7)]),_0x4f8293['api_error']!==undefined&&(_0x22e582[_0x37fe0d(0x93)]=_0x4f8293[_0x37fe0d(0x95)]),await database_1[_0x37fe0d(0x8d)]['shopSettings']['update']({'where':{'shopId':_0x10b1ee},'data':_0x22e582});}async[a55_0x10a090(0x8e)](_0x1b14e6,_0x372f64){const _0x5c5ed2=a55_0x10a090;await this[_0x5c5ed2(0x8b)](_0x1b14e6);const _0x381349={};_0x372f64[_0x5c5ed2(0x92)]!==undefined&&(_0x381349[_0x5c5ed2(0xc5)]=_0x372f64[_0x5c5ed2(0x92)]||null),_0x372f64['chatId']!==undefined&&(_0x381349[_0x5c5ed2(0x9d)]=_0x372f64['chatId']||null),await database_1[_0x5c5ed2(0x8d)][_0x5c5ed2(0xbf)][_0x5c5ed2(0xaa)]({'where':{'shopId':_0x1b14e6},'data':_0x381349});}async[a55_0x10a090(0xc6)](_0x3a101b,_0x5133f6){const _0x13acf6=a55_0x10a090;await this[_0x13acf6(0x8b)](_0x3a101b);const _0x4d2664={};_0x5133f6[_0x13acf6(0xa8)]!==undefined&&(_0x4d2664['webhookUrl']=_0x5133f6['webhookUrl']||null),_0x5133f6[_0x13acf6(0xa6)]!==undefined&&(_0x4d2664[_0x13acf6(0xa6)]=_0x5133f6[_0x13acf6(0xa6)]||[]),await database_1[_0x13acf6(0x8d)][_0x13acf6(0xbf)]['update']({'where':{'shopId':_0x3a101b},'data':_0x4d2664});}async[a55_0x10a090(0xc2)](_0x4cd506){const _0x5f337f=a55_0x10a090,_0x1cd25f='pk_'+crypto_1[_0x5f337f(0x8d)][_0x5f337f(0xb2)](0x20)[_0x5f337f(0xb8)]('hex'),_0x554324=_0x5f337f(0xc7)+crypto_1[_0x5f337f(0x8d)][_0x5f337f(0xb2)](0x20)[_0x5f337f(0xb8)](_0x5f337f(0xa2));await database_1[_0x5f337f(0x8d)][_0x5f337f(0xbd)][_0x5f337f(0xaa)]({'where':{'id':_0x4cd506},'data':{'publicKey':_0x1cd25f,'secretKey':_0x554324}});}async[a55_0x10a090(0xb5)](_0x326f60,_0x1bd80c){const _0x36714c=a55_0x10a090,{passwordConfirmation:_0x2ebf39}=_0x1bd80c,_0x55c201=await database_1[_0x36714c(0x8d)][_0x36714c(0xbd)]['findUnique']({'where':{'id':_0x326f60},'select':{'password':!![]}});if(!_0x55c201)throw new Error(_0x36714c(0x9a));const _0x2ef14a=await bcryptjs_1[_0x36714c(0x8d)][_0x36714c(0xc4)](_0x2ebf39,_0x55c201['password']);if(!_0x2ef14a)throw new Error(_0x36714c(0x98));await database_1['default']['shop'][_0x36714c(0xbb)]({'where':{'id':_0x326f60}});}async['ensureSettingsExist'](_0x40b21d){const _0x124f31=a55_0x10a090,_0x5a457d=await database_1[_0x124f31(0x8d)][_0x124f31(0xbf)][_0x124f31(0x9e)]({'where':{'shopId':_0x40b21d}});!_0x5a457d&&await database_1[_0x124f31(0x8d)]['shopSettings'][_0x124f31(0x96)]({'data':{'shopId':_0x40b21d}});}}exports['SettingsService']=SettingsService;