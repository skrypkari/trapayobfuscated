'use strict';const a51_0x5f1d63=a51_0x30f4;(function(_0x2b54c3,_0x3b911e){const _0x300b8d=a51_0x30f4,_0x1a0f60=_0x2b54c3();while(!![]){try{const _0x226bae=parseInt(_0x300b8d(0xd9))/0x1+parseInt(_0x300b8d(0xe1))/0x2+-parseInt(_0x300b8d(0xb3))/0x3*(-parseInt(_0x300b8d(0xdb))/0x4)+-parseInt(_0x300b8d(0xc8))/0x5*(-parseInt(_0x300b8d(0xd4))/0x6)+parseInt(_0x300b8d(0xc5))/0x7*(-parseInt(_0x300b8d(0xa5))/0x8)+-parseInt(_0x300b8d(0xb5))/0x9*(-parseInt(_0x300b8d(0xaf))/0xa)+-parseInt(_0x300b8d(0xcb))/0xb;if(_0x226bae===_0x3b911e)break;else _0x1a0f60['push'](_0x1a0f60['shift']());}catch(_0x180690){_0x1a0f60['push'](_0x1a0f60['shift']());}}}(a51_0x25a7,0x6ddbc));var __importDefault=this&&this[a51_0x5f1d63(0xb7)]||function(_0x36b42b){const _0x5312a3=a51_0x5f1d63;return _0x36b42b&&_0x36b42b[_0x5312a3(0xb9)]?_0x36b42b:{'default':_0x36b42b};};Object['defineProperty'](exports,a51_0x5f1d63(0xb9),{'value':!![]}),exports[a51_0x5f1d63(0xd7)]=void 0x0;function a51_0x30f4(_0x10dae9,_0x3efdbb){const _0x25a7d0=a51_0x25a7();return a51_0x30f4=function(_0x30f4f0,_0x269dc7){_0x30f4f0=_0x30f4f0-0xa0;let _0x30a7f4=_0x25a7d0[_0x30f4f0];return _0x30a7f4;},a51_0x30f4(_0x10dae9,_0x3efdbb);}const bcryptjs_1=__importDefault(require(a51_0x5f1d63(0xd8))),crypto_1=__importDefault(require(a51_0x5f1d63(0xdc))),database_1=__importDefault(require(a51_0x5f1d63(0xa0)));class SettingsService{[a51_0x5f1d63(0xd1)](_0xea6337){const _0x239a71=a51_0x5f1d63;if(!_0xea6337)return'';if(_0xea6337[_0x239a71(0xc4)]<=0x8)return _0xea6337;const _0x5c7cbd=_0xea6337[_0x239a71(0xa3)](0x0,0x8),_0x5df426='*'['repeat'](Math[_0x239a71(0xba)](0x0,_0xea6337[_0x239a71(0xc4)]-0x8));return _0x5c7cbd+_0x5df426;}['parseWebhookEvents'](_0x91457d){const _0xf717cd=a51_0x5f1d63;if(!_0x91457d)return[];if(Array[_0xf717cd(0xc9)](_0x91457d))return _0x91457d;if(typeof _0x91457d==='string')try{const _0x345d3e=JSON[_0xf717cd(0xbc)](_0x91457d);return Array['isArray'](_0x345d3e)?_0x345d3e:[];}catch{return[];}return[];}async['getShopSettings'](_0x52caed){const _0x1bec97=a51_0x5f1d63,_0x50ddb0=await database_1[_0x1bec97(0xad)]['shop'][_0x1bec97(0xce)]({'where':{'id':_0x52caed},'include':{'settings':!![]}});if(!_0x50ddb0)throw new Error('Shop\x20not\x20found');let _0x1bb22d=_0x50ddb0[_0x1bec97(0xa9)];return!_0x1bb22d&&(_0x1bb22d=await database_1[_0x1bec97(0xad)]['shopSettings'][_0x1bec97(0xbb)]({'data':{'shopId':_0x50ddb0['id']}})),{'fullName':_0x50ddb0[_0x1bec97(0xe0)],'brand':_0x50ddb0['name'],'merchantUrl':_0x50ddb0['shopUrl'],'telegramUsername':_0x50ddb0['telegram'],'telegramBotApiKey':_0x1bb22d['telegramBotApiKey']?this[_0x1bec97(0xd1)](_0x1bb22d[_0x1bec97(0xd3)]):null,'telegramChatId':_0x1bb22d[_0x1bec97(0xac)],'webhookUrl':_0x1bb22d[_0x1bec97(0xc6)],'webhookEvents':this[_0x1bec97(0xb6)](_0x1bb22d[_0x1bec97(0xa2)]),'notifications':{'payment_success':_0x1bb22d[_0x1bec97(0xc1)],'payment_failed':_0x1bb22d[_0x1bec97(0xb8)],'refund':_0x1bb22d[_0x1bec97(0xd5)],'payout':_0x1bb22d['notificationPayout'],'login':_0x1bb22d[_0x1bec97(0xbe)],'api_error':_0x1bb22d[_0x1bec97(0xcd)]}};}async[a51_0x5f1d63(0xdf)](_0x5e8343,_0x1d9afd){const _0x432827=a51_0x5f1d63,{currentPassword:_0x2fb3c1,newPassword:_0x5c8dc4,confirmNewPassword:_0x203332}=_0x1d9afd;if(_0x5c8dc4!==_0x203332)throw new Error(_0x432827(0xde));if(_0x5c8dc4[_0x432827(0xc4)]<0x6)throw new Error(_0x432827(0xab));const _0x59f1a8=await database_1['default'][_0x432827(0xd0)][_0x432827(0xce)]({'where':{'id':_0x5e8343},'select':{'password':!![]}});if(!_0x59f1a8)throw new Error(_0x432827(0xbf));const _0x2c06cf=await bcryptjs_1[_0x432827(0xad)][_0x432827(0xb2)](_0x2fb3c1,_0x59f1a8[_0x432827(0xd6)]);if(!_0x2c06cf)throw new Error(_0x432827(0xda));const _0x4082d1=await bcryptjs_1['default'][_0x432827(0xae)](_0x5c8dc4,0xc);await database_1[_0x432827(0xad)][_0x432827(0xd0)][_0x432827(0xcc)]({'where':{'id':_0x5e8343},'data':{'password':_0x4082d1}});}async[a51_0x5f1d63(0xa7)](_0xc57bbd,_0x1f93d7){const _0x3c6d66=a51_0x5f1d63;await this[_0x3c6d66(0xca)](_0xc57bbd);const _0xc0306={};_0x1f93d7[_0x3c6d66(0xcf)]!==undefined&&(_0xc0306[_0x3c6d66(0xc1)]=_0x1f93d7[_0x3c6d66(0xcf)]),_0x1f93d7['payment_failed']!==undefined&&(_0xc0306['notificationPaymentFailed']=_0x1f93d7[_0x3c6d66(0xb4)]),_0x1f93d7[_0x3c6d66(0xbd)]!==undefined&&(_0xc0306[_0x3c6d66(0xd5)]=_0x1f93d7[_0x3c6d66(0xbd)]),_0x1f93d7[_0x3c6d66(0xa6)]!==undefined&&(_0xc0306['notificationPayout']=_0x1f93d7[_0x3c6d66(0xa6)]),_0x1f93d7[_0x3c6d66(0xa8)]!==undefined&&(_0xc0306[_0x3c6d66(0xbe)]=_0x1f93d7['login']),_0x1f93d7[_0x3c6d66(0xaa)]!==undefined&&(_0xc0306[_0x3c6d66(0xcd)]=_0x1f93d7[_0x3c6d66(0xaa)]),await database_1[_0x3c6d66(0xad)][_0x3c6d66(0xc0)]['update']({'where':{'shopId':_0xc57bbd},'data':_0xc0306});}async[a51_0x5f1d63(0xb1)](_0x40c2db,_0x59c173){const _0x137b1f=a51_0x5f1d63;await this[_0x137b1f(0xca)](_0x40c2db);const _0xdc4121={};_0x59c173[_0x137b1f(0xe2)]!==undefined&&(_0xdc4121[_0x137b1f(0xd3)]=_0x59c173[_0x137b1f(0xe2)]||null),_0x59c173[_0x137b1f(0xb0)]!==undefined&&(_0xdc4121[_0x137b1f(0xac)]=_0x59c173[_0x137b1f(0xb0)]||null),await database_1[_0x137b1f(0xad)]['shopSettings'][_0x137b1f(0xcc)]({'where':{'shopId':_0x40c2db},'data':_0xdc4121});}async['updateWebhookSettings'](_0x2c8608,_0x4ede51){const _0x1f927c=a51_0x5f1d63;await this[_0x1f927c(0xca)](_0x2c8608);const _0x28c04e={};_0x4ede51['webhookUrl']!==undefined&&(_0x28c04e['webhookUrl']=_0x4ede51['webhookUrl']||null),_0x4ede51[_0x1f927c(0xa2)]!==undefined&&(_0x28c04e[_0x1f927c(0xa2)]=_0x4ede51[_0x1f927c(0xa2)]||[]),await database_1['default']['shopSettings'][_0x1f927c(0xcc)]({'where':{'shopId':_0x2c8608},'data':_0x28c04e});}async[a51_0x5f1d63(0xa4)](_0x50c765){const _0x4a1bdb=a51_0x5f1d63,_0x221052=_0x4a1bdb(0xc3)+crypto_1[_0x4a1bdb(0xad)]['randomBytes'](0x20)['toString']('hex'),_0x18f4a0=_0x4a1bdb(0xdd)+crypto_1[_0x4a1bdb(0xad)]['randomBytes'](0x20)['toString'](_0x4a1bdb(0xd2));await database_1[_0x4a1bdb(0xad)][_0x4a1bdb(0xd0)][_0x4a1bdb(0xcc)]({'where':{'id':_0x50c765},'data':{'publicKey':_0x221052,'secretKey':_0x18f4a0}});}async[a51_0x5f1d63(0xc2)](_0x14c04a,_0x5ae7e0){const _0x159b24=a51_0x5f1d63,{passwordConfirmation:_0x266734}=_0x5ae7e0,_0x20c4d9=await database_1[_0x159b24(0xad)][_0x159b24(0xd0)][_0x159b24(0xce)]({'where':{'id':_0x14c04a},'select':{'password':!![]}});if(!_0x20c4d9)throw new Error(_0x159b24(0xbf));const _0x525203=await bcryptjs_1[_0x159b24(0xad)][_0x159b24(0xb2)](_0x266734,_0x20c4d9[_0x159b24(0xd6)]);if(!_0x525203)throw new Error(_0x159b24(0xc7));await database_1[_0x159b24(0xad)][_0x159b24(0xd0)][_0x159b24(0xa1)]({'where':{'id':_0x14c04a}});}async[a51_0x5f1d63(0xca)](_0x37e455){const _0x114602=a51_0x5f1d63,_0x15029a=await database_1[_0x114602(0xad)][_0x114602(0xc0)][_0x114602(0xce)]({'where':{'shopId':_0x37e455}});!_0x15029a&&await database_1[_0x114602(0xad)][_0x114602(0xc0)][_0x114602(0xbb)]({'data':{'shopId':_0x37e455}});}}function a51_0x25a7(){const _0x588920=['96sukdZr','payout','updateNotifications','login','settings','api_error','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','telegramChatId','default','hash','40LdBeKZ','chatId','updateTelegramSettings','compare','3PtJCGM','payment_failed','1566981rWxsje','parseWebhookEvents','__importDefault','notificationPaymentFailed','__esModule','max','create','parse','refund','notificationLogin','Shop\x20not\x20found','shopSettings','notificationPaymentSuccess','deleteAccount','pk_','length','24843uOkWlR','webhookUrl','Password\x20confirmation\x20is\x20incorrect','355220KOFQaM','isArray','ensureSettingsExist','19571992fnyAsM','update','notificationApiError','findUnique','payment_success','shop','maskApiKey','hex','telegramBotApiKey','12ZwBPZr','notificationRefund','password','SettingsService','bcryptjs','856555pXekJP','Current\x20password\x20is\x20incorrect','778396EnrPIS','crypto','sk_','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','changePassword','name','764324pJamfl','botApiKey','../config/database','delete','webhookEvents','substring','revokeAllApiKeys'];a51_0x25a7=function(){return _0x588920;};return a51_0x25a7();}exports['SettingsService']=SettingsService;