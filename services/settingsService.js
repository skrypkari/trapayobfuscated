'use strict';function a52_0x1ca4(_0x5083fb,_0x3596fe){const _0x59a946=a52_0x59a9();return a52_0x1ca4=function(_0x1ca45d,_0x3d7f26){_0x1ca45d=_0x1ca45d-0xf1;let _0x25f512=_0x59a946[_0x1ca45d];return _0x25f512;},a52_0x1ca4(_0x5083fb,_0x3596fe);}const a52_0x22cd7a=a52_0x1ca4;(function(_0x5a73cf,_0x1a14f0){const _0x2abc9c=a52_0x1ca4,_0x552c01=_0x5a73cf();while(!![]){try{const _0x4f11a5=-parseInt(_0x2abc9c(0xf2))/0x1*(parseInt(_0x2abc9c(0x123))/0x2)+-parseInt(_0x2abc9c(0x11a))/0x3+parseInt(_0x2abc9c(0x11d))/0x4+-parseInt(_0x2abc9c(0x12a))/0x5+-parseInt(_0x2abc9c(0x129))/0x6+-parseInt(_0x2abc9c(0x11e))/0x7*(parseInt(_0x2abc9c(0x103))/0x8)+parseInt(_0x2abc9c(0x11b))/0x9;if(_0x4f11a5===_0x1a14f0)break;else _0x552c01['push'](_0x552c01['shift']());}catch(_0x3f7f58){_0x552c01['push'](_0x552c01['shift']());}}}(a52_0x59a9,0x9493e));var __importDefault=this&&this[a52_0x22cd7a(0x128)]||function(_0x5afe59){const _0x31a30f=a52_0x22cd7a;return _0x5afe59&&_0x5afe59[_0x31a30f(0x101)]?_0x5afe59:{'default':_0x5afe59};};function a52_0x59a9(){const _0x32bcd3=['New\x20password\x20and\x20confirmation\x20do\x20not\x20match','defineProperty','default','3154224XhBKmi','32709267nuxaIn','string','2569188qKRHts','7XfvBbx','randomBytes','maskApiKey','create','webhookUrl','22DWsxox','Shop\x20not\x20found','SettingsService','updateWebhookSettings','notificationPaymentSuccess','__importDefault','2191386PnLyVF','5491925qwqkyQ','ensureSettingsExist','deleteAccount','notificationLogin','hex','password','login','api_error','../config/database','87793SBnmCM','shop','delete','webhookEvents','hash','parseWebhookEvents','length','botApiKey','shopSettings','chatId','revokeAllApiKeys','refund','notificationApiError','findUnique','name','__esModule','telegramBotApiKey','1498712iukwNw','payout','toString','pk_','substring','payment_failed','Password\x20confirmation\x20is\x20incorrect','notificationRefund','Current\x20password\x20is\x20incorrect','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','updateTelegramSettings','notificationPayout','update','updateNotifications','crypto','payment_success','changePassword','compare','isArray','notificationPaymentFailed'];a52_0x59a9=function(){return _0x32bcd3;};return a52_0x59a9();}Object[a52_0x22cd7a(0x118)](exports,'__esModule',{'value':!![]}),exports[a52_0x22cd7a(0x125)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a52_0x22cd7a(0x111))),database_1=__importDefault(require(a52_0x22cd7a(0xf1)));class SettingsService{[a52_0x22cd7a(0x120)](_0x3eaea6){const _0x40c0a1=a52_0x22cd7a;if(!_0x3eaea6)return'';if(_0x3eaea6[_0x40c0a1(0xf8)]<=0x8)return _0x3eaea6;const _0xcc0288=_0x3eaea6[_0x40c0a1(0x107)](0x0,0x8),_0x547fd9='*'['repeat'](Math['max'](0x0,_0x3eaea6['length']-0x8));return _0xcc0288+_0x547fd9;}[a52_0x22cd7a(0xf7)](_0x198ee4){const _0x2116ea=a52_0x22cd7a;if(!_0x198ee4)return[];if(Array[_0x2116ea(0x115)](_0x198ee4))return _0x198ee4;if(typeof _0x198ee4===_0x2116ea(0x11c))try{const _0x481bf5=JSON['parse'](_0x198ee4);return Array[_0x2116ea(0x115)](_0x481bf5)?_0x481bf5:[];}catch{return[];}return[];}async['getShopSettings'](_0x3359af){const _0x22770d=a52_0x22cd7a,_0x59eeea=await database_1[_0x22770d(0x119)][_0x22770d(0xf3)][_0x22770d(0xff)]({'where':{'id':_0x3359af},'include':{'settings':!![]}});if(!_0x59eeea)throw new Error(_0x22770d(0x124));let _0x23f755=_0x59eeea['settings'];return!_0x23f755&&(_0x23f755=await database_1['default'][_0x22770d(0xfa)][_0x22770d(0x121)]({'data':{'shopId':_0x59eeea['id']}})),{'fullName':_0x59eeea[_0x22770d(0x100)],'brand':_0x59eeea[_0x22770d(0x100)],'merchantUrl':_0x59eeea['shopUrl'],'telegramUsername':_0x59eeea['telegram'],'telegramBotApiKey':_0x23f755[_0x22770d(0x102)]?this[_0x22770d(0x120)](_0x23f755[_0x22770d(0x102)]):null,'telegramChatId':_0x23f755['telegramChatId'],'webhookUrl':_0x23f755['webhookUrl'],'webhookEvents':this[_0x22770d(0xf7)](_0x23f755[_0x22770d(0xf5)]),'notifications':{'payment_success':_0x23f755[_0x22770d(0x127)],'payment_failed':_0x23f755[_0x22770d(0x116)],'refund':_0x23f755[_0x22770d(0x10a)],'payout':_0x23f755[_0x22770d(0x10e)],'login':_0x23f755[_0x22770d(0x12d)],'api_error':_0x23f755[_0x22770d(0xfe)]}};}async[a52_0x22cd7a(0x113)](_0x5cfb1a,_0x324923){const _0x22d409=a52_0x22cd7a,{currentPassword:_0x245042,newPassword:_0x21dc4c,confirmNewPassword:_0x20537f}=_0x324923;if(_0x21dc4c!==_0x20537f)throw new Error(_0x22d409(0x117));if(_0x21dc4c['length']<0x6)throw new Error(_0x22d409(0x10c));const _0x18dc2b=await database_1[_0x22d409(0x119)]['shop'][_0x22d409(0xff)]({'where':{'id':_0x5cfb1a},'select':{'password':!![]}});if(!_0x18dc2b)throw new Error(_0x22d409(0x124));const _0x81ae3a=await bcryptjs_1[_0x22d409(0x119)][_0x22d409(0x114)](_0x245042,_0x18dc2b[_0x22d409(0x12f)]);if(!_0x81ae3a)throw new Error(_0x22d409(0x10b));const _0x350865=await bcryptjs_1['default'][_0x22d409(0xf6)](_0x21dc4c,0xc);await database_1['default'][_0x22d409(0xf3)][_0x22d409(0x10f)]({'where':{'id':_0x5cfb1a},'data':{'password':_0x350865}});}async[a52_0x22cd7a(0x110)](_0x1eed34,_0x1f153a){const _0x1c0c39=a52_0x22cd7a;await this['ensureSettingsExist'](_0x1eed34);const _0x59b16e={};_0x1f153a['payment_success']!==undefined&&(_0x59b16e[_0x1c0c39(0x127)]=_0x1f153a[_0x1c0c39(0x112)]),_0x1f153a['payment_failed']!==undefined&&(_0x59b16e[_0x1c0c39(0x116)]=_0x1f153a[_0x1c0c39(0x108)]),_0x1f153a[_0x1c0c39(0xfd)]!==undefined&&(_0x59b16e[_0x1c0c39(0x10a)]=_0x1f153a[_0x1c0c39(0xfd)]),_0x1f153a[_0x1c0c39(0x104)]!==undefined&&(_0x59b16e['notificationPayout']=_0x1f153a[_0x1c0c39(0x104)]),_0x1f153a[_0x1c0c39(0x130)]!==undefined&&(_0x59b16e[_0x1c0c39(0x12d)]=_0x1f153a[_0x1c0c39(0x130)]),_0x1f153a[_0x1c0c39(0x131)]!==undefined&&(_0x59b16e['notificationApiError']=_0x1f153a[_0x1c0c39(0x131)]),await database_1[_0x1c0c39(0x119)][_0x1c0c39(0xfa)]['update']({'where':{'shopId':_0x1eed34},'data':_0x59b16e});}async[a52_0x22cd7a(0x10d)](_0x28aa0f,_0x28c2a2){const _0x4732e7=a52_0x22cd7a;await this[_0x4732e7(0x12b)](_0x28aa0f);const _0x1db8bd={};_0x28c2a2[_0x4732e7(0xf9)]!==undefined&&(_0x1db8bd[_0x4732e7(0x102)]=_0x28c2a2[_0x4732e7(0xf9)]||null),_0x28c2a2[_0x4732e7(0xfb)]!==undefined&&(_0x1db8bd['telegramChatId']=_0x28c2a2[_0x4732e7(0xfb)]||null),await database_1[_0x4732e7(0x119)][_0x4732e7(0xfa)][_0x4732e7(0x10f)]({'where':{'shopId':_0x28aa0f},'data':_0x1db8bd});}async[a52_0x22cd7a(0x126)](_0x4233e2,_0x365043){const _0x492567=a52_0x22cd7a;await this['ensureSettingsExist'](_0x4233e2);const _0x1b4d52={};_0x365043['webhookUrl']!==undefined&&(_0x1b4d52[_0x492567(0x122)]=_0x365043[_0x492567(0x122)]||null),_0x365043[_0x492567(0xf5)]!==undefined&&(_0x1b4d52[_0x492567(0xf5)]=_0x365043['webhookEvents']||[]),await database_1[_0x492567(0x119)]['shopSettings']['update']({'where':{'shopId':_0x4233e2},'data':_0x1b4d52});}async[a52_0x22cd7a(0xfc)](_0x484b0a){const _0x45f4e6=a52_0x22cd7a,_0x59dc7b=_0x45f4e6(0x106)+crypto_1[_0x45f4e6(0x119)]['randomBytes'](0x20)[_0x45f4e6(0x105)]('hex'),_0x1d2e24='sk_'+crypto_1[_0x45f4e6(0x119)][_0x45f4e6(0x11f)](0x20)['toString'](_0x45f4e6(0x12e));await database_1[_0x45f4e6(0x119)][_0x45f4e6(0xf3)][_0x45f4e6(0x10f)]({'where':{'id':_0x484b0a},'data':{'publicKey':_0x59dc7b,'secretKey':_0x1d2e24}});}async[a52_0x22cd7a(0x12c)](_0x75491a,_0xe5e560){const _0x158f40=a52_0x22cd7a,{passwordConfirmation:_0xe2f15c}=_0xe5e560,_0x5011e2=await database_1[_0x158f40(0x119)]['shop'][_0x158f40(0xff)]({'where':{'id':_0x75491a},'select':{'password':!![]}});if(!_0x5011e2)throw new Error(_0x158f40(0x124));const _0x214859=await bcryptjs_1[_0x158f40(0x119)]['compare'](_0xe2f15c,_0x5011e2[_0x158f40(0x12f)]);if(!_0x214859)throw new Error(_0x158f40(0x109));await database_1['default'][_0x158f40(0xf3)][_0x158f40(0xf4)]({'where':{'id':_0x75491a}});}async[a52_0x22cd7a(0x12b)](_0x586198){const _0x2a4e34=a52_0x22cd7a,_0x127c5f=await database_1[_0x2a4e34(0x119)][_0x2a4e34(0xfa)][_0x2a4e34(0xff)]({'where':{'shopId':_0x586198}});!_0x127c5f&&await database_1[_0x2a4e34(0x119)][_0x2a4e34(0xfa)][_0x2a4e34(0x121)]({'data':{'shopId':_0x586198}});}}exports[a52_0x22cd7a(0x125)]=SettingsService;