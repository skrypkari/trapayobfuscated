'use strict';const a64_0x1346bc=a64_0x9d2b;(function(_0x44698b,_0x59a007){const _0x3a1294=a64_0x9d2b,_0x2206f1=_0x44698b();while(!![]){try{const _0x47b497=-parseInt(_0x3a1294(0x1e3))/0x1*(parseInt(_0x3a1294(0x203))/0x2)+-parseInt(_0x3a1294(0x209))/0x3*(-parseInt(_0x3a1294(0x20e))/0x4)+parseInt(_0x3a1294(0x215))/0x5*(-parseInt(_0x3a1294(0x1f8))/0x6)+-parseInt(_0x3a1294(0x1e4))/0x7*(-parseInt(_0x3a1294(0x1ec))/0x8)+-parseInt(_0x3a1294(0x216))/0x9+-parseInt(_0x3a1294(0x1fc))/0xa*(parseInt(_0x3a1294(0x201))/0xb)+parseInt(_0x3a1294(0x219))/0xc;if(_0x47b497===_0x59a007)break;else _0x2206f1['push'](_0x2206f1['shift']());}catch(_0x1597e7){_0x2206f1['push'](_0x2206f1['shift']());}}}(a64_0x50f2,0xd483d));function a64_0x9d2b(_0x9b3c0b,_0x386b15){const _0x50f2b6=a64_0x50f2();return a64_0x9d2b=function(_0x9d2b2d,_0x465aeb){_0x9d2b2d=_0x9d2b2d-0x1de;let _0x33bf72=_0x50f2b6[_0x9d2b2d];return _0x33bf72;},a64_0x9d2b(_0x9b3c0b,_0x386b15);}var __importDefault=this&&this[a64_0x1346bc(0x1f3)]||function(_0x40a816){const _0x425e2a=a64_0x1346bc;return _0x40a816&&_0x40a816[_0x425e2a(0x217)]?_0x40a816:{'default':_0x40a816};};Object['defineProperty'](exports,a64_0x1346bc(0x217),{'value':!![]}),exports[a64_0x1346bc(0x1fb)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a64_0x1346bc(0x1ed))),database_1=__importDefault(require('../config/database'));class SettingsService{[a64_0x1346bc(0x221)](_0x46af73){const _0x4ed162=a64_0x1346bc;if(!_0x46af73)return'';if(_0x46af73[_0x4ed162(0x20a)]<=0x8)return _0x46af73;const _0x1327cd=_0x46af73[_0x4ed162(0x1e7)](0x0,0x8),_0x26f1d9='*'[_0x4ed162(0x207)](Math[_0x4ed162(0x1fa)](0x0,_0x46af73[_0x4ed162(0x20a)]-0x8));return _0x1327cd+_0x26f1d9;}[a64_0x1346bc(0x1fd)](_0xbcdbd9){const _0x2a2946=a64_0x1346bc;if(!_0xbcdbd9)return[];if(Array[_0x2a2946(0x1f7)](_0xbcdbd9))return _0xbcdbd9;if(typeof _0xbcdbd9==='string')try{const _0x100b7d=JSON['parse'](_0xbcdbd9);return Array[_0x2a2946(0x1f7)](_0x100b7d)?_0x100b7d:[];}catch{return[];}return[];}async['getShopSettings'](_0x3c69ca){const _0x24de65=a64_0x1346bc,_0x1b7b45=await database_1[_0x24de65(0x1ea)][_0x24de65(0x1ee)][_0x24de65(0x1e6)]({'where':{'id':_0x3c69ca},'include':{'settings':!![]}});if(!_0x1b7b45)throw new Error(_0x24de65(0x214));let _0x446bbb=_0x1b7b45[_0x24de65(0x1f2)];return!_0x446bbb&&(_0x446bbb=await database_1[_0x24de65(0x1ea)]['shopSettings'][_0x24de65(0x220)]({'data':{'shopId':_0x1b7b45['id']}})),{'fullName':_0x1b7b45[_0x24de65(0x21a)],'brand':_0x1b7b45[_0x24de65(0x21a)],'merchantUrl':_0x1b7b45[_0x24de65(0x1f0)],'telegramUsername':_0x1b7b45[_0x24de65(0x1f4)],'telegramBotApiKey':_0x446bbb[_0x24de65(0x202)]?this[_0x24de65(0x221)](_0x446bbb[_0x24de65(0x202)]):null,'telegramChatId':_0x446bbb[_0x24de65(0x21e)],'webhookUrl':_0x446bbb[_0x24de65(0x1e5)],'webhookEvents':this[_0x24de65(0x1fd)](_0x446bbb['webhookEvents']),'notifications':{'payment_success':_0x446bbb[_0x24de65(0x222)],'payment_failed':_0x446bbb[_0x24de65(0x21b)],'refund':_0x446bbb[_0x24de65(0x212)],'payout':_0x446bbb[_0x24de65(0x1e0)],'login':_0x446bbb[_0x24de65(0x1e2)],'api_error':_0x446bbb[_0x24de65(0x1ef)]}};}async[a64_0x1346bc(0x1eb)](_0x1186ab,_0x4d94cb){const _0x5be52e=a64_0x1346bc,{currentPassword:_0x242c21,newPassword:_0x1233ff,confirmNewPassword:_0x5ae9ef}=_0x4d94cb;if(_0x1233ff!==_0x5ae9ef)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x1233ff[_0x5be52e(0x20a)]<0x6)throw new Error(_0x5be52e(0x20d));const _0x32a945=await database_1['default'][_0x5be52e(0x1ee)][_0x5be52e(0x1e6)]({'where':{'id':_0x1186ab},'select':{'password':!![]}});if(!_0x32a945)throw new Error('Shop\x20not\x20found');const _0x485d21=await bcryptjs_1[_0x5be52e(0x1ea)][_0x5be52e(0x208)](_0x242c21,_0x32a945[_0x5be52e(0x1fe)]);if(!_0x485d21)throw new Error(_0x5be52e(0x205));const _0x301258=await bcryptjs_1[_0x5be52e(0x1ea)]['hash'](_0x1233ff,0xc);await database_1[_0x5be52e(0x1ea)]['shop'][_0x5be52e(0x20c)]({'where':{'id':_0x1186ab},'data':{'password':_0x301258}});}async[a64_0x1346bc(0x1f6)](_0x2d3967,_0x45662a){const _0x2c1aa5=a64_0x1346bc;await this[_0x2c1aa5(0x1f9)](_0x2d3967);const _0x155726={};_0x45662a['payment_success']!==undefined&&(_0x155726['notificationPaymentSuccess']=_0x45662a[_0x2c1aa5(0x21c)]),_0x45662a[_0x2c1aa5(0x21d)]!==undefined&&(_0x155726[_0x2c1aa5(0x21b)]=_0x45662a['payment_failed']),_0x45662a['refund']!==undefined&&(_0x155726['notificationRefund']=_0x45662a['refund']),_0x45662a[_0x2c1aa5(0x210)]!==undefined&&(_0x155726[_0x2c1aa5(0x1e0)]=_0x45662a['payout']),_0x45662a[_0x2c1aa5(0x1de)]!==undefined&&(_0x155726[_0x2c1aa5(0x1e2)]=_0x45662a[_0x2c1aa5(0x1de)]),_0x45662a[_0x2c1aa5(0x1e8)]!==undefined&&(_0x155726[_0x2c1aa5(0x1ef)]=_0x45662a['api_error']),await database_1['default']['shopSettings'][_0x2c1aa5(0x20c)]({'where':{'shopId':_0x2d3967},'data':_0x155726});}async[a64_0x1346bc(0x1f5)](_0x9a4dc3,_0x202645){const _0x4f4eb4=a64_0x1346bc;await this[_0x4f4eb4(0x1f9)](_0x9a4dc3);const _0x4bdd1d={};_0x202645['botApiKey']!==undefined&&(_0x4bdd1d[_0x4f4eb4(0x202)]=_0x202645[_0x4f4eb4(0x1ff)]||null),_0x202645[_0x4f4eb4(0x20b)]!==undefined&&(_0x4bdd1d['telegramChatId']=_0x202645[_0x4f4eb4(0x20b)]||null),await database_1[_0x4f4eb4(0x1ea)][_0x4f4eb4(0x1e1)][_0x4f4eb4(0x20c)]({'where':{'shopId':_0x9a4dc3},'data':_0x4bdd1d});}async[a64_0x1346bc(0x211)](_0x24c3ee,_0x3ac9c9){const _0xe81e3d=a64_0x1346bc;await this[_0xe81e3d(0x1f9)](_0x24c3ee);const _0x5eafe4={};_0x3ac9c9['webhookUrl']!==undefined&&(_0x5eafe4['webhookUrl']=_0x3ac9c9[_0xe81e3d(0x1e5)]||null),_0x3ac9c9[_0xe81e3d(0x21f)]!==undefined&&(_0x5eafe4[_0xe81e3d(0x21f)]=_0x3ac9c9[_0xe81e3d(0x21f)]||[]),await database_1[_0xe81e3d(0x1ea)][_0xe81e3d(0x1e1)]['update']({'where':{'shopId':_0x24c3ee},'data':_0x5eafe4});}async[a64_0x1346bc(0x204)](_0x1c85ea){const _0x19549c=a64_0x1346bc,_0x1a6610=_0x19549c(0x1f1)+crypto_1['default'][_0x19549c(0x20f)](0x20)[_0x19549c(0x218)](_0x19549c(0x200)),_0x1ed89f=_0x19549c(0x206)+crypto_1[_0x19549c(0x1ea)][_0x19549c(0x20f)](0x20)[_0x19549c(0x218)](_0x19549c(0x200));await database_1['default'][_0x19549c(0x1ee)][_0x19549c(0x20c)]({'where':{'id':_0x1c85ea},'data':{'publicKey':_0x1a6610,'secretKey':_0x1ed89f}});}async[a64_0x1346bc(0x213)](_0x13c477,_0x8f14c8){const _0x3cf120=a64_0x1346bc,{passwordConfirmation:_0x1277aa}=_0x8f14c8,_0x5dda5d=await database_1[_0x3cf120(0x1ea)][_0x3cf120(0x1ee)][_0x3cf120(0x1e6)]({'where':{'id':_0x13c477},'select':{'password':!![]}});if(!_0x5dda5d)throw new Error('Shop\x20not\x20found');const _0x1f5e27=await bcryptjs_1[_0x3cf120(0x1ea)]['compare'](_0x1277aa,_0x5dda5d[_0x3cf120(0x1fe)]);if(!_0x1f5e27)throw new Error(_0x3cf120(0x1df));await database_1['default'][_0x3cf120(0x1ee)][_0x3cf120(0x1e9)]({'where':{'id':_0x13c477}});}async['ensureSettingsExist'](_0x1afa90){const _0x4632b7=a64_0x1346bc,_0x5e828e=await database_1[_0x4632b7(0x1ea)][_0x4632b7(0x1e1)][_0x4632b7(0x1e6)]({'where':{'shopId':_0x1afa90}});!_0x5e828e&&await database_1[_0x4632b7(0x1ea)][_0x4632b7(0x1e1)][_0x4632b7(0x220)]({'data':{'shopId':_0x1afa90}});}}exports['SettingsService']=SettingsService;function a64_0x50f2(){const _0x5bd910=['delete','default','changePassword','134416yNWnaV','crypto','shop','notificationApiError','shopUrl','pk_','settings','__importDefault','telegram','updateTelegramSettings','updateNotifications','isArray','13770MZVoXy','ensureSettingsExist','max','SettingsService','21970qybKeY','parseWebhookEvents','password','botApiKey','hex','979jTlYhn','telegramBotApiKey','3646zoMzAS','revokeAllApiKeys','Current\x20password\x20is\x20incorrect','sk_','repeat','compare','3bYbxxj','length','chatId','update','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','4000852FszzsA','randomBytes','payout','updateWebhookSettings','notificationRefund','deleteAccount','Shop\x20not\x20found','2775irGXqa','1733778lcnPWV','__esModule','toString','22515228YpzrAO','name','notificationPaymentFailed','payment_success','payment_failed','telegramChatId','webhookEvents','create','maskApiKey','notificationPaymentSuccess','login','Password\x20confirmation\x20is\x20incorrect','notificationPayout','shopSettings','notificationLogin','539BVPSdj','266vISaMx','webhookUrl','findUnique','substring','api_error'];a64_0x50f2=function(){return _0x5bd910;};return a64_0x50f2();}