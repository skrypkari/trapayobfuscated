'use strict';const a53_0x1cdd5a=a53_0x12d7;(function(_0x4cad5c,_0x582158){const _0x7f1a36=a53_0x12d7,_0x345df8=_0x4cad5c();while(!![]){try{const _0x91b7b4=-parseInt(_0x7f1a36(0xd5))/0x1*(parseInt(_0x7f1a36(0xc6))/0x2)+-parseInt(_0x7f1a36(0xba))/0x3*(parseInt(_0x7f1a36(0xaa))/0x4)+parseInt(_0x7f1a36(0xa6))/0x5*(parseInt(_0x7f1a36(0xa3))/0x6)+parseInt(_0x7f1a36(0xda))/0x7*(parseInt(_0x7f1a36(0xa8))/0x8)+-parseInt(_0x7f1a36(0xa2))/0x9+-parseInt(_0x7f1a36(0xb6))/0xa+parseInt(_0x7f1a36(0xad))/0xb*(parseInt(_0x7f1a36(0xc7))/0xc);if(_0x91b7b4===_0x582158)break;else _0x345df8['push'](_0x345df8['shift']());}catch(_0x7d6dd8){_0x345df8['push'](_0x345df8['shift']());}}}(a53_0x19ae,0x9c488));var __importDefault=this&&this['__importDefault']||function(_0x3ea19a){const _0x533a12=a53_0x12d7;return _0x3ea19a&&_0x3ea19a[_0x533a12(0xbd)]?_0x3ea19a:{'default':_0x3ea19a};};Object['defineProperty'](exports,a53_0x1cdd5a(0xbd),{'value':!![]}),exports[a53_0x1cdd5a(0xb0)]=void 0x0;const bcryptjs_1=__importDefault(require(a53_0x1cdd5a(0xdc))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a53_0x1cdd5a(0xcc)));function a53_0x12d7(_0x1c124a,_0x4492ad){const _0x19aec5=a53_0x19ae();return a53_0x12d7=function(_0x12d76e,_0x2742cf){_0x12d76e=_0x12d76e-0xa0;let _0x5bd54d=_0x19aec5[_0x12d76e];return _0x5bd54d;},a53_0x12d7(_0x1c124a,_0x4492ad);}class SettingsService{[a53_0x1cdd5a(0xaf)](_0x40cd36){const _0x512648=a53_0x1cdd5a;if(!_0x40cd36)return'';if(_0x40cd36[_0x512648(0xe1)]<=0x8)return _0x40cd36;const _0x3d4cdb=_0x40cd36['substring'](0x0,0x8),_0x487825='*'['repeat'](Math[_0x512648(0xc0)](0x0,_0x40cd36[_0x512648(0xe1)]-0x8));return _0x3d4cdb+_0x487825;}[a53_0x1cdd5a(0xa0)](_0x2a5dbf){const _0x13f7e8=a53_0x1cdd5a;if(!_0x2a5dbf)return[];if(Array[_0x13f7e8(0xca)](_0x2a5dbf))return _0x2a5dbf;if(typeof _0x2a5dbf===_0x13f7e8(0xd4))try{const _0x894a33=JSON[_0x13f7e8(0xd7)](_0x2a5dbf);return Array['isArray'](_0x894a33)?_0x894a33:[];}catch{return[];}return[];}async[a53_0x1cdd5a(0xc2)](_0x5957ce){const _0x1a0a73=a53_0x1cdd5a,_0x1bfa17=await database_1[_0x1a0a73(0xb8)][_0x1a0a73(0xc3)][_0x1a0a73(0xd2)]({'where':{'id':_0x5957ce},'include':{'settings':!![]}});if(!_0x1bfa17)throw new Error(_0x1a0a73(0xb9));let _0x2525cd=_0x1bfa17[_0x1a0a73(0xab)];return!_0x2525cd&&(_0x2525cd=await database_1[_0x1a0a73(0xb8)]['shopSettings']['create']({'data':{'shopId':_0x1bfa17['id']}})),{'fullName':_0x1bfa17['name'],'brand':_0x1bfa17[_0x1a0a73(0xb1)],'merchantUrl':_0x1bfa17['shopUrl'],'telegramUsername':_0x1bfa17['telegram'],'telegramBotApiKey':_0x2525cd[_0x1a0a73(0xd1)]?this[_0x1a0a73(0xaf)](_0x2525cd[_0x1a0a73(0xd1)]):null,'telegramChatId':_0x2525cd[_0x1a0a73(0xa7)],'webhookUrl':_0x2525cd[_0x1a0a73(0xce)],'webhookEvents':this[_0x1a0a73(0xa0)](_0x2525cd[_0x1a0a73(0xbf)]),'notifications':{'payment_success':_0x2525cd['notificationPaymentSuccess'],'payment_failed':_0x2525cd[_0x1a0a73(0xbc)],'refund':_0x2525cd[_0x1a0a73(0xac)],'payout':_0x2525cd[_0x1a0a73(0xb3)],'login':_0x2525cd[_0x1a0a73(0xdd)],'api_error':_0x2525cd[_0x1a0a73(0xb5)]}};}async['changePassword'](_0x3c12ea,_0x27e943){const _0x3242b7=a53_0x1cdd5a,{currentPassword:_0x53fce9,newPassword:_0x3f7f11,confirmNewPassword:_0x21b14c}=_0x27e943;if(_0x3f7f11!==_0x21b14c)throw new Error(_0x3242b7(0xd3));if(_0x3f7f11[_0x3242b7(0xe1)]<0x6)throw new Error(_0x3242b7(0xde));const _0x309f70=await database_1['default'][_0x3242b7(0xc3)]['findUnique']({'where':{'id':_0x3c12ea},'select':{'password':!![]}});if(!_0x309f70)throw new Error('Shop\x20not\x20found');const _0x36d7a4=await bcryptjs_1['default'][_0x3242b7(0xbb)](_0x53fce9,_0x309f70[_0x3242b7(0xa5)]);if(!_0x36d7a4)throw new Error(_0x3242b7(0xb7));const _0x2639e6=await bcryptjs_1[_0x3242b7(0xb8)]['hash'](_0x3f7f11,0xc);await database_1[_0x3242b7(0xb8)][_0x3242b7(0xc3)][_0x3242b7(0xc1)]({'where':{'id':_0x3c12ea},'data':{'password':_0x2639e6}});}async[a53_0x1cdd5a(0xbe)](_0x8ceb54,_0x1cda2a){const _0x241469=a53_0x1cdd5a;await this[_0x241469(0xe0)](_0x8ceb54);const _0x456d51={};_0x1cda2a[_0x241469(0xa1)]!==undefined&&(_0x456d51[_0x241469(0xcf)]=_0x1cda2a[_0x241469(0xa1)]),_0x1cda2a[_0x241469(0xd9)]!==undefined&&(_0x456d51['notificationPaymentFailed']=_0x1cda2a[_0x241469(0xd9)]),_0x1cda2a[_0x241469(0xcd)]!==undefined&&(_0x456d51[_0x241469(0xac)]=_0x1cda2a['refund']),_0x1cda2a['payout']!==undefined&&(_0x456d51['notificationPayout']=_0x1cda2a[_0x241469(0xdb)]),_0x1cda2a['login']!==undefined&&(_0x456d51[_0x241469(0xdd)]=_0x1cda2a[_0x241469(0xb2)]),_0x1cda2a['api_error']!==undefined&&(_0x456d51[_0x241469(0xb5)]=_0x1cda2a[_0x241469(0xd6)]),await database_1[_0x241469(0xb8)][_0x241469(0xb4)][_0x241469(0xc1)]({'where':{'shopId':_0x8ceb54},'data':_0x456d51});}async[a53_0x1cdd5a(0xc4)](_0x339a3e,_0x985cd2){const _0x27c415=a53_0x1cdd5a;await this[_0x27c415(0xe0)](_0x339a3e);const _0x481fb7={};_0x985cd2[_0x27c415(0xd0)]!==undefined&&(_0x481fb7[_0x27c415(0xd1)]=_0x985cd2[_0x27c415(0xd0)]||null),_0x985cd2['chatId']!==undefined&&(_0x481fb7[_0x27c415(0xa7)]=_0x985cd2[_0x27c415(0xa9)]||null),await database_1['default']['shopSettings'][_0x27c415(0xc1)]({'where':{'shopId':_0x339a3e},'data':_0x481fb7});}async[a53_0x1cdd5a(0xc9)](_0x2ccac0,_0x5f07bd){const _0x4da166=a53_0x1cdd5a;await this[_0x4da166(0xe0)](_0x2ccac0);const _0x16d844={};_0x5f07bd[_0x4da166(0xce)]!==undefined&&(_0x16d844[_0x4da166(0xce)]=_0x5f07bd[_0x4da166(0xce)]||null),_0x5f07bd[_0x4da166(0xbf)]!==undefined&&(_0x16d844[_0x4da166(0xbf)]=_0x5f07bd[_0x4da166(0xbf)]||[]),await database_1[_0x4da166(0xb8)]['shopSettings'][_0x4da166(0xc1)]({'where':{'shopId':_0x2ccac0},'data':_0x16d844});}async[a53_0x1cdd5a(0xa4)](_0x5dd670){const _0x114c00=a53_0x1cdd5a,_0x4d8562=_0x114c00(0xdf)+crypto_1[_0x114c00(0xb8)][_0x114c00(0xcb)](0x20)[_0x114c00(0xe2)](_0x114c00(0xc8)),_0x2cb4fa=_0x114c00(0xae)+crypto_1[_0x114c00(0xb8)][_0x114c00(0xcb)](0x20)[_0x114c00(0xe2)](_0x114c00(0xc8));await database_1[_0x114c00(0xb8)][_0x114c00(0xc3)][_0x114c00(0xc1)]({'where':{'id':_0x5dd670},'data':{'publicKey':_0x4d8562,'secretKey':_0x2cb4fa}});}async[a53_0x1cdd5a(0xc5)](_0x127401,_0x18ed3b){const _0xd112c=a53_0x1cdd5a,{passwordConfirmation:_0x2c3cd9}=_0x18ed3b,_0x2d7f61=await database_1[_0xd112c(0xb8)]['shop'][_0xd112c(0xd2)]({'where':{'id':_0x127401},'select':{'password':!![]}});if(!_0x2d7f61)throw new Error(_0xd112c(0xb9));const _0x542f7f=await bcryptjs_1[_0xd112c(0xb8)]['compare'](_0x2c3cd9,_0x2d7f61[_0xd112c(0xa5)]);if(!_0x542f7f)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0xd112c(0xb8)][_0xd112c(0xc3)][_0xd112c(0xd8)]({'where':{'id':_0x127401}});}async[a53_0x1cdd5a(0xe0)](_0x381365){const _0x459e72=a53_0x1cdd5a,_0x3cb9c7=await database_1[_0x459e72(0xb8)][_0x459e72(0xb4)][_0x459e72(0xd2)]({'where':{'shopId':_0x381365}});!_0x3cb9c7&&await database_1[_0x459e72(0xb8)][_0x459e72(0xb4)]['create']({'data':{'shopId':_0x381365}});}}exports[a53_0x1cdd5a(0xb0)]=SettingsService;function a53_0x19ae(){const _0x1a5fe9=['revokeAllApiKeys','password','10VcqZCG','telegramChatId','16BFWGnB','chatId','8WktCje','settings','notificationRefund','6186158QCOMyv','sk_','maskApiKey','SettingsService','name','login','notificationPayout','shopSettings','notificationApiError','1686700nrzJRP','Current\x20password\x20is\x20incorrect','default','Shop\x20not\x20found','1189857Dwrtoc','compare','notificationPaymentFailed','__esModule','updateNotifications','webhookEvents','max','update','getShopSettings','shop','updateTelegramSettings','deleteAccount','4aHdRTX','60DneTxK','hex','updateWebhookSettings','isArray','randomBytes','../config/database','refund','webhookUrl','notificationPaymentSuccess','botApiKey','telegramBotApiKey','findUnique','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','string','565589KdLEqm','api_error','parse','delete','payment_failed','2748333gKnkop','payout','bcryptjs','notificationLogin','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','pk_','ensureSettingsExist','length','toString','parseWebhookEvents','payment_success','9379368IgkzXw','534738GxAxIw'];a53_0x19ae=function(){return _0x1a5fe9;};return a53_0x19ae();}