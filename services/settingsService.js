'use strict';const a64_0xf184a=a64_0x6939;function a64_0x8706(){const _0x36ccdc=['defineProperty','string','revokeAllApiKeys','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','3GbZyPM','api_error','webhookUrl','1740690nPjpVv','47020OJlFBM','SettingsService','compare','notificationPayout','name','shopSettings','notificationRefund','login','length','update','shop','parse','sk_','571674ZXlNOZ','chatId','notificationPaymentFailed','payout','ensureSettingsExist','password','settings','__importDefault','isArray','default','229996aehIbP','3DWRFpl','312976LQRVnu','hex','bcryptjs','updateTelegramSettings','1884408JdmoLh','Shop\x20not\x20found','30vmOfuy','randomBytes','notificationApiError','telegramBotApiKey','getShopSettings','maskApiKey','11OcxwgZ','substring','Current\x20password\x20is\x20incorrect','payment_success','findUnique','botApiKey','payment_failed','deleteAccount','2588644EoCpWU','updateNotifications','__esModule','918jYZaqE','notificationPaymentSuccess','telegramChatId','webhookEvents','refund','changePassword','create','notificationLogin'];a64_0x8706=function(){return _0x36ccdc;};return a64_0x8706();}(function(_0x359a6b,_0x24d485){const _0x28f129=a64_0x6939,_0x908c30=_0x359a6b();while(!![]){try{const _0x918751=-parseInt(_0x28f129(0x90))/0x1*(-parseInt(_0x28f129(0x8f))/0x2)+-parseInt(_0x28f129(0x74))/0x3*(-parseInt(_0x28f129(0xa5))/0x4)+-parseInt(_0x28f129(0x97))/0x5*(parseInt(_0x28f129(0x85))/0x6)+parseInt(_0x28f129(0x77))/0x7+parseInt(_0x28f129(0x91))/0x8+parseInt(_0x28f129(0xa8))/0x9*(-parseInt(_0x28f129(0x78))/0xa)+-parseInt(_0x28f129(0x9d))/0xb*(-parseInt(_0x28f129(0x95))/0xc);if(_0x918751===_0x24d485)break;else _0x908c30['push'](_0x908c30['shift']());}catch(_0x2be3f5){_0x908c30['push'](_0x908c30['shift']());}}}(a64_0x8706,0x5e2a7));var __importDefault=this&&this[a64_0xf184a(0x8c)]||function(_0x266529){const _0xba7ca2=a64_0xf184a;return _0x266529&&_0x266529[_0xba7ca2(0xa7)]?_0x266529:{'default':_0x266529};};Object[a64_0xf184a(0x70)](exports,a64_0xf184a(0xa7),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a64_0xf184a(0x93))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));class SettingsService{[a64_0xf184a(0x9c)](_0xc29189){const _0x44168f=a64_0xf184a;if(!_0xc29189)return'';if(_0xc29189[_0x44168f(0x80)]<=0x8)return _0xc29189;const _0x571af=_0xc29189[_0x44168f(0x9e)](0x0,0x8),_0x3b9fc5='*'['repeat'](Math['max'](0x0,_0xc29189[_0x44168f(0x80)]-0x8));return _0x571af+_0x3b9fc5;}['parseWebhookEvents'](_0x38796c){const _0x13904f=a64_0xf184a;if(!_0x38796c)return[];if(Array['isArray'](_0x38796c))return _0x38796c;if(typeof _0x38796c===_0x13904f(0x71))try{const _0x188b68=JSON[_0x13904f(0x83)](_0x38796c);return Array[_0x13904f(0x8d)](_0x188b68)?_0x188b68:[];}catch{return[];}return[];}async[a64_0xf184a(0x9b)](_0x4ef075){const _0x16054e=a64_0xf184a,_0x141740=await database_1[_0x16054e(0x8e)][_0x16054e(0x82)][_0x16054e(0xa1)]({'where':{'id':_0x4ef075},'include':{'settings':!![]}});if(!_0x141740)throw new Error(_0x16054e(0x96));let _0x12f1f1=_0x141740[_0x16054e(0x8b)];return!_0x12f1f1&&(_0x12f1f1=await database_1[_0x16054e(0x8e)]['shopSettings']['create']({'data':{'shopId':_0x141740['id']}})),{'fullName':_0x141740['name'],'brand':_0x141740[_0x16054e(0x7c)],'merchantUrl':_0x141740['shopUrl'],'telegramUsername':_0x141740['telegram'],'telegramBotApiKey':_0x12f1f1['telegramBotApiKey']?this['maskApiKey'](_0x12f1f1[_0x16054e(0x9a)]):null,'telegramChatId':_0x12f1f1['telegramChatId'],'webhookUrl':_0x12f1f1[_0x16054e(0x76)],'webhookEvents':this['parseWebhookEvents'](_0x12f1f1[_0x16054e(0x6b)]),'notifications':{'payment_success':_0x12f1f1[_0x16054e(0x69)],'payment_failed':_0x12f1f1['notificationPaymentFailed'],'refund':_0x12f1f1[_0x16054e(0x7e)],'payout':_0x12f1f1[_0x16054e(0x7b)],'login':_0x12f1f1[_0x16054e(0x6f)],'api_error':_0x12f1f1[_0x16054e(0x99)]}};}async[a64_0xf184a(0x6d)](_0x19655e,_0x43e01e){const _0x271499=a64_0xf184a,{currentPassword:_0x49da05,newPassword:_0x185ee8,confirmNewPassword:_0x423d4a}=_0x43e01e;if(_0x185ee8!==_0x423d4a)throw new Error(_0x271499(0x73));if(_0x185ee8[_0x271499(0x80)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x3287fc=await database_1[_0x271499(0x8e)][_0x271499(0x82)]['findUnique']({'where':{'id':_0x19655e},'select':{'password':!![]}});if(!_0x3287fc)throw new Error(_0x271499(0x96));const _0x67d251=await bcryptjs_1[_0x271499(0x8e)][_0x271499(0x7a)](_0x49da05,_0x3287fc[_0x271499(0x8a)]);if(!_0x67d251)throw new Error(_0x271499(0x9f));const _0x346570=await bcryptjs_1[_0x271499(0x8e)]['hash'](_0x185ee8,0xc);await database_1['default'][_0x271499(0x82)][_0x271499(0x81)]({'where':{'id':_0x19655e},'data':{'password':_0x346570}});}async[a64_0xf184a(0xa6)](_0x1ebbed,_0x410896){const _0x31230b=a64_0xf184a;await this[_0x31230b(0x89)](_0x1ebbed);const _0x22e332={};_0x410896['payment_success']!==undefined&&(_0x22e332[_0x31230b(0x69)]=_0x410896[_0x31230b(0xa0)]),_0x410896[_0x31230b(0xa3)]!==undefined&&(_0x22e332[_0x31230b(0x87)]=_0x410896[_0x31230b(0xa3)]),_0x410896[_0x31230b(0x6c)]!==undefined&&(_0x22e332[_0x31230b(0x7e)]=_0x410896[_0x31230b(0x6c)]),_0x410896['payout']!==undefined&&(_0x22e332[_0x31230b(0x7b)]=_0x410896[_0x31230b(0x88)]),_0x410896[_0x31230b(0x7f)]!==undefined&&(_0x22e332[_0x31230b(0x6f)]=_0x410896[_0x31230b(0x7f)]),_0x410896[_0x31230b(0x75)]!==undefined&&(_0x22e332[_0x31230b(0x99)]=_0x410896['api_error']),await database_1[_0x31230b(0x8e)]['shopSettings'][_0x31230b(0x81)]({'where':{'shopId':_0x1ebbed},'data':_0x22e332});}async[a64_0xf184a(0x94)](_0x51bcd9,_0x401ed3){const _0x737e95=a64_0xf184a;await this[_0x737e95(0x89)](_0x51bcd9);const _0x113b97={};_0x401ed3[_0x737e95(0xa2)]!==undefined&&(_0x113b97[_0x737e95(0x9a)]=_0x401ed3[_0x737e95(0xa2)]||null),_0x401ed3[_0x737e95(0x86)]!==undefined&&(_0x113b97[_0x737e95(0x6a)]=_0x401ed3[_0x737e95(0x86)]||null),await database_1[_0x737e95(0x8e)][_0x737e95(0x7d)][_0x737e95(0x81)]({'where':{'shopId':_0x51bcd9},'data':_0x113b97});}async['updateWebhookSettings'](_0x21735f,_0x4a44e1){const _0x4008d7=a64_0xf184a;await this[_0x4008d7(0x89)](_0x21735f);const _0x568f9a={};_0x4a44e1[_0x4008d7(0x76)]!==undefined&&(_0x568f9a[_0x4008d7(0x76)]=_0x4a44e1[_0x4008d7(0x76)]||null),_0x4a44e1[_0x4008d7(0x6b)]!==undefined&&(_0x568f9a['webhookEvents']=_0x4a44e1[_0x4008d7(0x6b)]||[]),await database_1[_0x4008d7(0x8e)][_0x4008d7(0x7d)]['update']({'where':{'shopId':_0x21735f},'data':_0x568f9a});}async[a64_0xf184a(0x72)](_0x1cd59e){const _0x5550b2=a64_0xf184a,_0x4f9efc='pk_'+crypto_1[_0x5550b2(0x8e)][_0x5550b2(0x98)](0x20)['toString'](_0x5550b2(0x92)),_0x2f51ee=_0x5550b2(0x84)+crypto_1[_0x5550b2(0x8e)][_0x5550b2(0x98)](0x20)['toString']('hex');await database_1['default']['shop'][_0x5550b2(0x81)]({'where':{'id':_0x1cd59e},'data':{'publicKey':_0x4f9efc,'secretKey':_0x2f51ee}});}async[a64_0xf184a(0xa4)](_0x5741d9,_0xbd795c){const _0x1e2827=a64_0xf184a,{passwordConfirmation:_0x3b3dc8}=_0xbd795c,_0x4d8f74=await database_1[_0x1e2827(0x8e)][_0x1e2827(0x82)][_0x1e2827(0xa1)]({'where':{'id':_0x5741d9},'select':{'password':!![]}});if(!_0x4d8f74)throw new Error(_0x1e2827(0x96));const _0x2b5df2=await bcryptjs_1[_0x1e2827(0x8e)]['compare'](_0x3b3dc8,_0x4d8f74[_0x1e2827(0x8a)]);if(!_0x2b5df2)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x1e2827(0x8e)][_0x1e2827(0x82)]['delete']({'where':{'id':_0x5741d9}});}async[a64_0xf184a(0x89)](_0x564f30){const _0x367b9e=a64_0xf184a,_0x1291eb=await database_1[_0x367b9e(0x8e)]['shopSettings']['findUnique']({'where':{'shopId':_0x564f30}});!_0x1291eb&&await database_1[_0x367b9e(0x8e)]['shopSettings'][_0x367b9e(0x6e)]({'data':{'shopId':_0x564f30}});}}function a64_0x6939(_0x53d177,_0xbc9a84){const _0x870683=a64_0x8706();return a64_0x6939=function(_0x693919,_0x24b2d8){_0x693919=_0x693919-0x69;let _0x28e4a8=_0x870683[_0x693919];return _0x28e4a8;},a64_0x6939(_0x53d177,_0xbc9a84);}exports[a64_0xf184a(0x79)]=SettingsService;