'use strict';const a64_0xcbfa43=a64_0x4e92;(function(_0x21697b,_0x38f2c7){const _0x361021=a64_0x4e92,_0x195c90=_0x21697b();while(!![]){try{const _0x48bc9d=parseInt(_0x361021(0x138))/0x1+parseInt(_0x361021(0x127))/0x2*(parseInt(_0x361021(0xfb))/0x3)+parseInt(_0x361021(0x115))/0x4*(parseInt(_0x361021(0x118))/0x5)+-parseInt(_0x361021(0x12c))/0x6*(-parseInt(_0x361021(0x111))/0x7)+-parseInt(_0x361021(0x101))/0x8+-parseInt(_0x361021(0x139))/0x9+parseInt(_0x361021(0x10d))/0xa*(parseInt(_0x361021(0x133))/0xb);if(_0x48bc9d===_0x38f2c7)break;else _0x195c90['push'](_0x195c90['shift']());}catch(_0x3bf415){_0x195c90['push'](_0x195c90['shift']());}}}(a64_0x53d5,0xa94bd));function a64_0x53d5(){const _0x59111a=['SettingsService','hex','shop','532iqYTMe','webhookUrl','payout','substring','4msEqYL','ensureSettingsExist','isArray','773960HLWkLE','compare','crypto','telegramBotApiKey','telegram','chatId','pk_','notificationRefund','Shop\x20not\x20found','webhookEvents','getShopSettings','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','bcryptjs','updateNotifications','length','2awnLTd','notificationLogin','botApiKey','repeat','delete','72642bzjhdp','__importDefault','updateWebhookSettings','create','defineProperty','revokeAllApiKeys','randomBytes','319968jGapiA','notificationApiError','shopSettings','deleteAccount','payment_success','282746xkHwET','12033414UOhLcb','maskApiKey','notificationPaymentSuccess','sk_','findUnique','api_error','notificationPaymentFailed','updateTelegramSettings','3462141tBySEV','__esModule','login','toString','Current\x20password\x20is\x20incorrect','notificationPayout','11063696gPHubk','telegramChatId','update','parseWebhookEvents','hash','../config/database','string','refund','Password\x20confirmation\x20is\x20incorrect','default','payment_failed','name','310dOIMJO'];a64_0x53d5=function(){return _0x59111a;};return a64_0x53d5();}var __importDefault=this&&this[a64_0xcbfa43(0x12d)]||function(_0x2bc6aa){const _0x3b4f0e=a64_0xcbfa43;return _0x2bc6aa&&_0x2bc6aa[_0x3b4f0e(0xfc)]?_0x2bc6aa:{'default':_0x2bc6aa};};Object[a64_0xcbfa43(0x130)](exports,a64_0xcbfa43(0xfc),{'value':!![]}),exports[a64_0xcbfa43(0x10e)]=void 0x0;const bcryptjs_1=__importDefault(require(a64_0xcbfa43(0x124))),crypto_1=__importDefault(require(a64_0xcbfa43(0x11a))),database_1=__importDefault(require(a64_0xcbfa43(0x106)));function a64_0x4e92(_0x56fee5,_0x22e5df){const _0x53d5cf=a64_0x53d5();return a64_0x4e92=function(_0x4e9201,_0x5883ab){_0x4e9201=_0x4e9201-0xf4;let _0x117d7d=_0x53d5cf[_0x4e9201];return _0x117d7d;},a64_0x4e92(_0x56fee5,_0x22e5df);}class SettingsService{[a64_0xcbfa43(0xf4)](_0x109fd0){const _0x3b6f49=a64_0xcbfa43;if(!_0x109fd0)return'';if(_0x109fd0[_0x3b6f49(0x126)]<=0x8)return _0x109fd0;const _0x3d3372=_0x109fd0[_0x3b6f49(0x114)](0x0,0x8),_0x50dadf='*'[_0x3b6f49(0x12a)](Math['max'](0x0,_0x109fd0[_0x3b6f49(0x126)]-0x8));return _0x3d3372+_0x50dadf;}[a64_0xcbfa43(0x104)](_0x33e9e9){const _0x20e61c=a64_0xcbfa43;if(!_0x33e9e9)return[];if(Array[_0x20e61c(0x117)](_0x33e9e9))return _0x33e9e9;if(typeof _0x33e9e9===_0x20e61c(0x107))try{const _0x547890=JSON['parse'](_0x33e9e9);return Array[_0x20e61c(0x117)](_0x547890)?_0x547890:[];}catch{return[];}return[];}async[a64_0xcbfa43(0x122)](_0x54c3f3){const _0x4c25ea=a64_0xcbfa43,_0x22b559=await database_1['default'][_0x4c25ea(0x110)][_0x4c25ea(0xf7)]({'where':{'id':_0x54c3f3},'include':{'settings':!![]}});if(!_0x22b559)throw new Error(_0x4c25ea(0x120));let _0x105f63=_0x22b559['settings'];return!_0x105f63&&(_0x105f63=await database_1[_0x4c25ea(0x10a)][_0x4c25ea(0x135)]['create']({'data':{'shopId':_0x22b559['id']}})),{'fullName':_0x22b559[_0x4c25ea(0x10c)],'brand':_0x22b559[_0x4c25ea(0x10c)],'merchantUrl':_0x22b559['shopUrl'],'telegramUsername':_0x22b559[_0x4c25ea(0x11c)],'telegramBotApiKey':_0x105f63[_0x4c25ea(0x11b)]?this[_0x4c25ea(0xf4)](_0x105f63[_0x4c25ea(0x11b)]):null,'telegramChatId':_0x105f63[_0x4c25ea(0x102)],'webhookUrl':_0x105f63[_0x4c25ea(0x112)],'webhookEvents':this['parseWebhookEvents'](_0x105f63[_0x4c25ea(0x121)]),'notifications':{'payment_success':_0x105f63[_0x4c25ea(0xf5)],'payment_failed':_0x105f63[_0x4c25ea(0xf9)],'refund':_0x105f63[_0x4c25ea(0x11f)],'payout':_0x105f63['notificationPayout'],'login':_0x105f63[_0x4c25ea(0x128)],'api_error':_0x105f63['notificationApiError']}};}async['changePassword'](_0x2ff54a,_0x41a2c0){const _0x1dfe9b=a64_0xcbfa43,{currentPassword:_0x1622b7,newPassword:_0xec8aee,confirmNewPassword:_0xd9e288}=_0x41a2c0;if(_0xec8aee!==_0xd9e288)throw new Error(_0x1dfe9b(0x123));if(_0xec8aee[_0x1dfe9b(0x126)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x4eddad=await database_1[_0x1dfe9b(0x10a)][_0x1dfe9b(0x110)][_0x1dfe9b(0xf7)]({'where':{'id':_0x2ff54a},'select':{'password':!![]}});if(!_0x4eddad)throw new Error(_0x1dfe9b(0x120));const _0x3b106d=await bcryptjs_1[_0x1dfe9b(0x10a)][_0x1dfe9b(0x119)](_0x1622b7,_0x4eddad['password']);if(!_0x3b106d)throw new Error(_0x1dfe9b(0xff));const _0xdbba61=await bcryptjs_1['default'][_0x1dfe9b(0x105)](_0xec8aee,0xc);await database_1[_0x1dfe9b(0x10a)]['shop'][_0x1dfe9b(0x103)]({'where':{'id':_0x2ff54a},'data':{'password':_0xdbba61}});}async[a64_0xcbfa43(0x125)](_0x17203c,_0x42af0d){const _0x4893e3=a64_0xcbfa43;await this[_0x4893e3(0x116)](_0x17203c);const _0x481c7c={};_0x42af0d[_0x4893e3(0x137)]!==undefined&&(_0x481c7c[_0x4893e3(0xf5)]=_0x42af0d[_0x4893e3(0x137)]),_0x42af0d[_0x4893e3(0x10b)]!==undefined&&(_0x481c7c['notificationPaymentFailed']=_0x42af0d[_0x4893e3(0x10b)]),_0x42af0d[_0x4893e3(0x108)]!==undefined&&(_0x481c7c[_0x4893e3(0x11f)]=_0x42af0d[_0x4893e3(0x108)]),_0x42af0d[_0x4893e3(0x113)]!==undefined&&(_0x481c7c[_0x4893e3(0x100)]=_0x42af0d['payout']),_0x42af0d[_0x4893e3(0xfd)]!==undefined&&(_0x481c7c[_0x4893e3(0x128)]=_0x42af0d[_0x4893e3(0xfd)]),_0x42af0d[_0x4893e3(0xf8)]!==undefined&&(_0x481c7c[_0x4893e3(0x134)]=_0x42af0d[_0x4893e3(0xf8)]),await database_1[_0x4893e3(0x10a)]['shopSettings'][_0x4893e3(0x103)]({'where':{'shopId':_0x17203c},'data':_0x481c7c});}async[a64_0xcbfa43(0xfa)](_0x5d8a5e,_0x315e45){const _0x33802c=a64_0xcbfa43;await this[_0x33802c(0x116)](_0x5d8a5e);const _0x3f5ffe={};_0x315e45[_0x33802c(0x129)]!==undefined&&(_0x3f5ffe[_0x33802c(0x11b)]=_0x315e45[_0x33802c(0x129)]||null),_0x315e45[_0x33802c(0x11d)]!==undefined&&(_0x3f5ffe[_0x33802c(0x102)]=_0x315e45[_0x33802c(0x11d)]||null),await database_1[_0x33802c(0x10a)][_0x33802c(0x135)][_0x33802c(0x103)]({'where':{'shopId':_0x5d8a5e},'data':_0x3f5ffe});}async[a64_0xcbfa43(0x12e)](_0x442742,_0x214346){const _0x2eb28d=a64_0xcbfa43;await this[_0x2eb28d(0x116)](_0x442742);const _0x1be9f2={};_0x214346[_0x2eb28d(0x112)]!==undefined&&(_0x1be9f2['webhookUrl']=_0x214346['webhookUrl']||null),_0x214346[_0x2eb28d(0x121)]!==undefined&&(_0x1be9f2[_0x2eb28d(0x121)]=_0x214346[_0x2eb28d(0x121)]||[]),await database_1[_0x2eb28d(0x10a)]['shopSettings'][_0x2eb28d(0x103)]({'where':{'shopId':_0x442742},'data':_0x1be9f2});}async[a64_0xcbfa43(0x131)](_0x107256){const _0x15ce27=a64_0xcbfa43,_0x557e65=_0x15ce27(0x11e)+crypto_1[_0x15ce27(0x10a)][_0x15ce27(0x132)](0x20)[_0x15ce27(0xfe)](_0x15ce27(0x10f)),_0x503bb0=_0x15ce27(0xf6)+crypto_1['default'][_0x15ce27(0x132)](0x20)[_0x15ce27(0xfe)](_0x15ce27(0x10f));await database_1[_0x15ce27(0x10a)][_0x15ce27(0x110)][_0x15ce27(0x103)]({'where':{'id':_0x107256},'data':{'publicKey':_0x557e65,'secretKey':_0x503bb0}});}async[a64_0xcbfa43(0x136)](_0x41a630,_0x4e4127){const _0x1beb54=a64_0xcbfa43,{passwordConfirmation:_0x1d31a7}=_0x4e4127,_0x3ed1db=await database_1[_0x1beb54(0x10a)][_0x1beb54(0x110)][_0x1beb54(0xf7)]({'where':{'id':_0x41a630},'select':{'password':!![]}});if(!_0x3ed1db)throw new Error(_0x1beb54(0x120));const _0x16ec68=await bcryptjs_1[_0x1beb54(0x10a)][_0x1beb54(0x119)](_0x1d31a7,_0x3ed1db['password']);if(!_0x16ec68)throw new Error(_0x1beb54(0x109));await database_1[_0x1beb54(0x10a)][_0x1beb54(0x110)][_0x1beb54(0x12b)]({'where':{'id':_0x41a630}});}async[a64_0xcbfa43(0x116)](_0x47fff9){const _0x45f4bb=a64_0xcbfa43,_0x247ee7=await database_1['default'][_0x45f4bb(0x135)]['findUnique']({'where':{'shopId':_0x47fff9}});!_0x247ee7&&await database_1[_0x45f4bb(0x10a)][_0x45f4bb(0x135)][_0x45f4bb(0x12f)]({'data':{'shopId':_0x47fff9}});}}exports[a64_0xcbfa43(0x10e)]=SettingsService;