'use strict';const a55_0x373f00=a55_0x3c25;(function(_0x15ae98,_0x17b8c6){const _0x13d8aa=a55_0x3c25,_0x29d4b6=_0x15ae98();while(!![]){try{const _0xb40c2e=parseInt(_0x13d8aa(0x82))/0x1*(-parseInt(_0x13d8aa(0xa5))/0x2)+-parseInt(_0x13d8aa(0xa0))/0x3+parseInt(_0x13d8aa(0x9f))/0x4+-parseInt(_0x13d8aa(0x70))/0x5*(parseInt(_0x13d8aa(0xaf))/0x6)+-parseInt(_0x13d8aa(0x8b))/0x7*(parseInt(_0x13d8aa(0xa3))/0x8)+-parseInt(_0x13d8aa(0x8c))/0x9*(-parseInt(_0x13d8aa(0x7c))/0xa)+parseInt(_0x13d8aa(0x95))/0xb*(parseInt(_0x13d8aa(0xa1))/0xc);if(_0xb40c2e===_0x17b8c6)break;else _0x29d4b6['push'](_0x29d4b6['shift']());}catch(_0x7a2917){_0x29d4b6['push'](_0x29d4b6['shift']());}}}(a55_0x5f47,0x1c5c4));var __importDefault=this&&this['__importDefault']||function(_0x2fe46b){const _0x2b7298=a55_0x3c25;return _0x2fe46b&&_0x2fe46b[_0x2b7298(0x7d)]?_0x2fe46b:{'default':_0x2fe46b};};function a55_0x3c25(_0x429e96,_0x2f7dce){const _0x5f47b7=a55_0x5f47();return a55_0x3c25=function(_0x3c25c3,_0x549dac){_0x3c25c3=_0x3c25c3-0x6f;let _0x356b21=_0x5f47b7[_0x3c25c3];return _0x356b21;},a55_0x3c25(_0x429e96,_0x2f7dce);}function a55_0x5f47(){const _0x37a064=['notificationApiError','defineProperty','botApiKey','notificationLogin','sk_','max','hash','462413tIUByZ','1769247PfRXsK','getShopSettings','shop','notificationPaymentFailed','telegramBotApiKey','password','isArray','payout','login','47399jRMEdA','update','maskApiKey','webhookUrl','refund','findUnique','name','SettingsService','notificationPayout','telegramChatId','634196MLoFtS','518163fMlqnW','600LbPmtX','notificationRefund','8hTHqUl','Current\x20password\x20is\x20incorrect','830tVDCsq','notificationPaymentSuccess','updateNotifications','compare','substring','payment_failed','hex','webhookEvents','bcryptjs','Password\x20confirmation\x20is\x20incorrect','99276kKSPHf','default','deleteAccount','15jaeMHW','string','shopSettings','telegram','payment_success','ensureSettingsExist','randomBytes','settings','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','Shop\x20not\x20found','chatId','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','10gpizmi','__esModule','parse','toString','delete','create','400BGHuwS','repeat'];a55_0x5f47=function(){return _0x37a064;};return a55_0x5f47();}Object[a55_0x373f00(0x85)](exports,'__esModule',{'value':!![]}),exports[a55_0x373f00(0x9c)]=void 0x0;const bcryptjs_1=__importDefault(require(a55_0x373f00(0xad))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));class SettingsService{[a55_0x373f00(0x97)](_0x1d6dcd){const _0x48f0f3=a55_0x373f00;if(!_0x1d6dcd)return'';if(_0x1d6dcd['length']<=0x8)return _0x1d6dcd;const _0x24508b=_0x1d6dcd[_0x48f0f3(0xa9)](0x0,0x8),_0x3a2da6='*'[_0x48f0f3(0x83)](Math[_0x48f0f3(0x89)](0x0,_0x1d6dcd['length']-0x8));return _0x24508b+_0x3a2da6;}['parseWebhookEvents'](_0x3764f8){const _0x5e99dc=a55_0x373f00;if(!_0x3764f8)return[];if(Array['isArray'](_0x3764f8))return _0x3764f8;if(typeof _0x3764f8===_0x5e99dc(0x71))try{const _0x3380f4=JSON[_0x5e99dc(0x7e)](_0x3764f8);return Array[_0x5e99dc(0x92)](_0x3380f4)?_0x3380f4:[];}catch{return[];}return[];}async[a55_0x373f00(0x8d)](_0x43d19f){const _0x26f9c5=a55_0x373f00,_0x519a0d=await database_1[_0x26f9c5(0xb0)][_0x26f9c5(0x8e)][_0x26f9c5(0x9a)]({'where':{'id':_0x43d19f},'include':{'settings':!![]}});if(!_0x519a0d)throw new Error(_0x26f9c5(0x79));let _0x3f171d=_0x519a0d[_0x26f9c5(0x77)];return!_0x3f171d&&(_0x3f171d=await database_1[_0x26f9c5(0xb0)][_0x26f9c5(0x72)][_0x26f9c5(0x81)]({'data':{'shopId':_0x519a0d['id']}})),{'fullName':_0x519a0d[_0x26f9c5(0x9b)],'brand':_0x519a0d[_0x26f9c5(0x9b)],'merchantUrl':_0x519a0d['shopUrl'],'telegramUsername':_0x519a0d[_0x26f9c5(0x73)],'telegramBotApiKey':_0x3f171d[_0x26f9c5(0x90)]?this[_0x26f9c5(0x97)](_0x3f171d[_0x26f9c5(0x90)]):null,'telegramChatId':_0x3f171d[_0x26f9c5(0x9e)],'webhookUrl':_0x3f171d['webhookUrl'],'webhookEvents':this['parseWebhookEvents'](_0x3f171d['webhookEvents']),'notifications':{'payment_success':_0x3f171d['notificationPaymentSuccess'],'payment_failed':_0x3f171d[_0x26f9c5(0x8f)],'refund':_0x3f171d[_0x26f9c5(0xa2)],'payout':_0x3f171d[_0x26f9c5(0x9d)],'login':_0x3f171d['notificationLogin'],'api_error':_0x3f171d[_0x26f9c5(0x84)]}};}async['changePassword'](_0x5d8746,_0x2a59d4){const _0x2c56bb=a55_0x373f00,{currentPassword:_0x294e28,newPassword:_0x87e3b1,confirmNewPassword:_0x2a954b}=_0x2a59d4;if(_0x87e3b1!==_0x2a954b)throw new Error(_0x2c56bb(0x78));if(_0x87e3b1['length']<0x6)throw new Error(_0x2c56bb(0x7b));const _0x360edf=await database_1['default'][_0x2c56bb(0x8e)]['findUnique']({'where':{'id':_0x5d8746},'select':{'password':!![]}});if(!_0x360edf)throw new Error('Shop\x20not\x20found');const _0x541eef=await bcryptjs_1['default'][_0x2c56bb(0xa8)](_0x294e28,_0x360edf[_0x2c56bb(0x91)]);if(!_0x541eef)throw new Error(_0x2c56bb(0xa4));const _0x4ba9bb=await bcryptjs_1['default'][_0x2c56bb(0x8a)](_0x87e3b1,0xc);await database_1[_0x2c56bb(0xb0)]['shop']['update']({'where':{'id':_0x5d8746},'data':{'password':_0x4ba9bb}});}async[a55_0x373f00(0xa7)](_0x1d6770,_0x31ae5d){const _0x526040=a55_0x373f00;await this[_0x526040(0x75)](_0x1d6770);const _0x270b43={};_0x31ae5d[_0x526040(0x74)]!==undefined&&(_0x270b43[_0x526040(0xa6)]=_0x31ae5d[_0x526040(0x74)]),_0x31ae5d[_0x526040(0xaa)]!==undefined&&(_0x270b43['notificationPaymentFailed']=_0x31ae5d[_0x526040(0xaa)]),_0x31ae5d[_0x526040(0x99)]!==undefined&&(_0x270b43['notificationRefund']=_0x31ae5d['refund']),_0x31ae5d[_0x526040(0x93)]!==undefined&&(_0x270b43[_0x526040(0x9d)]=_0x31ae5d[_0x526040(0x93)]),_0x31ae5d[_0x526040(0x94)]!==undefined&&(_0x270b43[_0x526040(0x87)]=_0x31ae5d['login']),_0x31ae5d['api_error']!==undefined&&(_0x270b43[_0x526040(0x84)]=_0x31ae5d['api_error']),await database_1[_0x526040(0xb0)][_0x526040(0x72)]['update']({'where':{'shopId':_0x1d6770},'data':_0x270b43});}async['updateTelegramSettings'](_0x4deb6a,_0x43b780){const _0x210e2a=a55_0x373f00;await this['ensureSettingsExist'](_0x4deb6a);const _0x568521={};_0x43b780[_0x210e2a(0x86)]!==undefined&&(_0x568521[_0x210e2a(0x90)]=_0x43b780[_0x210e2a(0x86)]||null),_0x43b780[_0x210e2a(0x7a)]!==undefined&&(_0x568521[_0x210e2a(0x9e)]=_0x43b780[_0x210e2a(0x7a)]||null),await database_1[_0x210e2a(0xb0)]['shopSettings'][_0x210e2a(0x96)]({'where':{'shopId':_0x4deb6a},'data':_0x568521});}async['updateWebhookSettings'](_0x3da042,_0x33b7e1){const _0x964b0b=a55_0x373f00;await this[_0x964b0b(0x75)](_0x3da042);const _0x82daa0={};_0x33b7e1['webhookUrl']!==undefined&&(_0x82daa0[_0x964b0b(0x98)]=_0x33b7e1[_0x964b0b(0x98)]||null),_0x33b7e1[_0x964b0b(0xac)]!==undefined&&(_0x82daa0[_0x964b0b(0xac)]=_0x33b7e1[_0x964b0b(0xac)]||[]),await database_1['default'][_0x964b0b(0x72)][_0x964b0b(0x96)]({'where':{'shopId':_0x3da042},'data':_0x82daa0});}async['revokeAllApiKeys'](_0x411d61){const _0x59c4bc=a55_0x373f00,_0x2c90b2='pk_'+crypto_1[_0x59c4bc(0xb0)][_0x59c4bc(0x76)](0x20)[_0x59c4bc(0x7f)]('hex'),_0x4cdb56=_0x59c4bc(0x88)+crypto_1[_0x59c4bc(0xb0)]['randomBytes'](0x20)['toString'](_0x59c4bc(0xab));await database_1[_0x59c4bc(0xb0)][_0x59c4bc(0x8e)][_0x59c4bc(0x96)]({'where':{'id':_0x411d61},'data':{'publicKey':_0x2c90b2,'secretKey':_0x4cdb56}});}async[a55_0x373f00(0x6f)](_0x4bdb9e,_0x563488){const _0x285a86=a55_0x373f00,{passwordConfirmation:_0x20880d}=_0x563488,_0x53ab1d=await database_1[_0x285a86(0xb0)]['shop'][_0x285a86(0x9a)]({'where':{'id':_0x4bdb9e},'select':{'password':!![]}});if(!_0x53ab1d)throw new Error(_0x285a86(0x79));const _0x49f13c=await bcryptjs_1[_0x285a86(0xb0)]['compare'](_0x20880d,_0x53ab1d[_0x285a86(0x91)]);if(!_0x49f13c)throw new Error(_0x285a86(0xae));await database_1[_0x285a86(0xb0)][_0x285a86(0x8e)][_0x285a86(0x80)]({'where':{'id':_0x4bdb9e}});}async[a55_0x373f00(0x75)](_0x107d8e){const _0x49daf1=a55_0x373f00,_0x526022=await database_1[_0x49daf1(0xb0)][_0x49daf1(0x72)][_0x49daf1(0x9a)]({'where':{'shopId':_0x107d8e}});!_0x526022&&await database_1['default'][_0x49daf1(0x72)]['create']({'data':{'shopId':_0x107d8e}});}}exports[a55_0x373f00(0x9c)]=SettingsService;