'use strict';const a56_0xe834d4=a56_0x16b9;(function(_0x37e1b8,_0x57a0ec){const _0x3cae52=a56_0x16b9,_0x4f0d1e=_0x37e1b8();while(!![]){try{const _0x41200c=parseInt(_0x3cae52(0xf2))/0x1*(-parseInt(_0x3cae52(0xe6))/0x2)+parseInt(_0x3cae52(0xdf))/0x3*(-parseInt(_0x3cae52(0x10b))/0x4)+-parseInt(_0x3cae52(0xfe))/0x5+-parseInt(_0x3cae52(0xc8))/0x6*(parseInt(_0x3cae52(0xde))/0x7)+parseInt(_0x3cae52(0xdc))/0x8*(-parseInt(_0x3cae52(0xe0))/0x9)+-parseInt(_0x3cae52(0xe9))/0xa*(-parseInt(_0x3cae52(0xe7))/0xb)+-parseInt(_0x3cae52(0x109))/0xc*(-parseInt(_0x3cae52(0xd0))/0xd);if(_0x41200c===_0x57a0ec)break;else _0x4f0d1e['push'](_0x4f0d1e['shift']());}catch(_0x1f0581){_0x4f0d1e['push'](_0x4f0d1e['shift']());}}}(a56_0x21c4,0x1ec26));var __importDefault=this&&this[a56_0xe834d4(0xcb)]||function(_0x28d38e){const _0x17fcee=a56_0xe834d4;return _0x28d38e&&_0x28d38e[_0x17fcee(0xcc)]?_0x28d38e:{'default':_0x28d38e};};Object[a56_0xe834d4(0x100)](exports,a56_0xe834d4(0xcc),{'value':!![]}),exports[a56_0xe834d4(0xe8)]=void 0x0;const bcryptjs_1=__importDefault(require(a56_0xe834d4(0xd3))),crypto_1=__importDefault(require(a56_0xe834d4(0xea))),database_1=__importDefault(require(a56_0xe834d4(0xf5)));class SettingsService{[a56_0xe834d4(0xff)](_0x480e4e){const _0x1c4eef=a56_0xe834d4;if(!_0x480e4e)return'';if(_0x480e4e[_0x1c4eef(0x108)]<=0x8)return _0x480e4e;const _0x5bbe19=_0x480e4e[_0x1c4eef(0xd8)](0x0,0x8),_0x360e67='*'[_0x1c4eef(0x10d)](Math[_0x1c4eef(0xe4)](0x0,_0x480e4e[_0x1c4eef(0x108)]-0x8));return _0x5bbe19+_0x360e67;}[a56_0xe834d4(0xfb)](_0x4eb1d7){const _0x5780cc=a56_0xe834d4;if(!_0x4eb1d7)return[];if(Array['isArray'](_0x4eb1d7))return _0x4eb1d7;if(typeof _0x4eb1d7===_0x5780cc(0x106))try{const _0x4875f3=JSON[_0x5780cc(0x110)](_0x4eb1d7);return Array[_0x5780cc(0xf8)](_0x4875f3)?_0x4875f3:[];}catch{return[];}return[];}async[a56_0xe834d4(0xc6)](_0x3f6da6){const _0x2c8fda=a56_0xe834d4,_0x52dc7f=await database_1['default'][_0x2c8fda(0xd5)][_0x2c8fda(0xe2)]({'where':{'id':_0x3f6da6},'include':{'settings':!![]}});if(!_0x52dc7f)throw new Error(_0x2c8fda(0xf4));let _0x1da28e=_0x52dc7f[_0x2c8fda(0xd6)];return!_0x1da28e&&(_0x1da28e=await database_1['default'][_0x2c8fda(0xee)]['create']({'data':{'shopId':_0x52dc7f['id']}})),{'fullName':_0x52dc7f[_0x2c8fda(0xd9)],'brand':_0x52dc7f[_0x2c8fda(0xd9)],'merchantUrl':_0x52dc7f[_0x2c8fda(0xca)],'telegramUsername':_0x52dc7f[_0x2c8fda(0xd7)],'telegramBotApiKey':_0x1da28e[_0x2c8fda(0x107)]?this[_0x2c8fda(0xff)](_0x1da28e['telegramBotApiKey']):null,'telegramChatId':_0x1da28e['telegramChatId'],'webhookUrl':_0x1da28e['webhookUrl'],'webhookEvents':this['parseWebhookEvents'](_0x1da28e['webhookEvents']),'notifications':{'payment_success':_0x1da28e[_0x2c8fda(0x10f)],'payment_failed':_0x1da28e['notificationPaymentFailed'],'refund':_0x1da28e[_0x2c8fda(0xce)],'payout':_0x1da28e[_0x2c8fda(0xc9)],'login':_0x1da28e[_0x2c8fda(0x102)],'api_error':_0x1da28e['notificationApiError']}};}async['changePassword'](_0x3b6921,_0xb7eb10){const _0x59dd1d=a56_0xe834d4,{currentPassword:_0x16d457,newPassword:_0x3a486e,confirmNewPassword:_0x285c6f}=_0xb7eb10;if(_0x3a486e!==_0x285c6f)throw new Error(_0x59dd1d(0xf1));if(_0x3a486e[_0x59dd1d(0x108)]<0x6)throw new Error(_0x59dd1d(0xe3));const _0x263e8e=await database_1[_0x59dd1d(0xcf)][_0x59dd1d(0xd5)]['findUnique']({'where':{'id':_0x3b6921},'select':{'password':!![]}});if(!_0x263e8e)throw new Error('Shop\x20not\x20found');const _0x245c90=await bcryptjs_1[_0x59dd1d(0xcf)]['compare'](_0x16d457,_0x263e8e[_0x59dd1d(0x103)]);if(!_0x245c90)throw new Error(_0x59dd1d(0xe1));const _0xb308de=await bcryptjs_1[_0x59dd1d(0xcf)][_0x59dd1d(0xfa)](_0x3a486e,0xc);await database_1[_0x59dd1d(0xcf)][_0x59dd1d(0xd5)]['update']({'where':{'id':_0x3b6921},'data':{'password':_0xb308de}});}async['updateNotifications'](_0x54dd5c,_0xbc02f4){const _0x2f01ef=a56_0xe834d4;await this[_0x2f01ef(0x10c)](_0x54dd5c);const _0x573731={};_0xbc02f4[_0x2f01ef(0xeb)]!==undefined&&(_0x573731[_0x2f01ef(0x10f)]=_0xbc02f4[_0x2f01ef(0xeb)]),_0xbc02f4['payment_failed']!==undefined&&(_0x573731[_0x2f01ef(0xf3)]=_0xbc02f4['payment_failed']),_0xbc02f4[_0x2f01ef(0xd4)]!==undefined&&(_0x573731[_0x2f01ef(0xce)]=_0xbc02f4[_0x2f01ef(0xd4)]),_0xbc02f4['payout']!==undefined&&(_0x573731[_0x2f01ef(0xc9)]=_0xbc02f4[_0x2f01ef(0xd2)]),_0xbc02f4[_0x2f01ef(0xec)]!==undefined&&(_0x573731[_0x2f01ef(0x102)]=_0xbc02f4[_0x2f01ef(0xec)]),_0xbc02f4['api_error']!==undefined&&(_0x573731[_0x2f01ef(0x111)]=_0xbc02f4[_0x2f01ef(0xe5)]),await database_1[_0x2f01ef(0xcf)][_0x2f01ef(0xee)][_0x2f01ef(0xdd)]({'where':{'shopId':_0x54dd5c},'data':_0x573731});}async[a56_0xe834d4(0xf6)](_0x224a2e,_0x27e5be){const _0x44f4f9=a56_0xe834d4;await this[_0x44f4f9(0x10c)](_0x224a2e);const _0x56032e={};_0x27e5be['botApiKey']!==undefined&&(_0x56032e[_0x44f4f9(0x107)]=_0x27e5be[_0x44f4f9(0xdb)]||null),_0x27e5be[_0x44f4f9(0xfd)]!==undefined&&(_0x56032e[_0x44f4f9(0x105)]=_0x27e5be[_0x44f4f9(0xfd)]||null),await database_1[_0x44f4f9(0xcf)][_0x44f4f9(0xee)][_0x44f4f9(0xdd)]({'where':{'shopId':_0x224a2e},'data':_0x56032e});}async[a56_0xe834d4(0x104)](_0x5d76d2,_0x4232ab){const _0x4e9fdb=a56_0xe834d4;await this[_0x4e9fdb(0x10c)](_0x5d76d2);const _0x1eec86={};_0x4232ab[_0x4e9fdb(0xf0)]!==undefined&&(_0x1eec86[_0x4e9fdb(0xf0)]=_0x4232ab[_0x4e9fdb(0xf0)]||null),_0x4232ab['webhookEvents']!==undefined&&(_0x1eec86[_0x4e9fdb(0x10e)]=_0x4232ab[_0x4e9fdb(0x10e)]||[]),await database_1[_0x4e9fdb(0xcf)][_0x4e9fdb(0xee)][_0x4e9fdb(0xdd)]({'where':{'shopId':_0x5d76d2},'data':_0x1eec86});}async[a56_0xe834d4(0x10a)](_0x2a57a4){const _0x3ee3a7=a56_0xe834d4,_0x145faf=_0x3ee3a7(0xef)+crypto_1[_0x3ee3a7(0xcf)]['randomBytes'](0x20)['toString'](_0x3ee3a7(0xfc)),_0xe44939=_0x3ee3a7(0xf7)+crypto_1[_0x3ee3a7(0xcf)][_0x3ee3a7(0xf9)](0x20)[_0x3ee3a7(0x101)](_0x3ee3a7(0xfc));await database_1[_0x3ee3a7(0xcf)][_0x3ee3a7(0xd5)][_0x3ee3a7(0xdd)]({'where':{'id':_0x2a57a4},'data':{'publicKey':_0x145faf,'secretKey':_0xe44939}});}async[a56_0xe834d4(0xc7)](_0x1c6dac,_0x2b91da){const _0x4cdf8d=a56_0xe834d4,{passwordConfirmation:_0x5d354e}=_0x2b91da,_0x174d3a=await database_1[_0x4cdf8d(0xcf)]['shop'][_0x4cdf8d(0xe2)]({'where':{'id':_0x1c6dac},'select':{'password':!![]}});if(!_0x174d3a)throw new Error(_0x4cdf8d(0xf4));const _0x37beef=await bcryptjs_1[_0x4cdf8d(0xcf)][_0x4cdf8d(0xed)](_0x5d354e,_0x174d3a[_0x4cdf8d(0x103)]);if(!_0x37beef)throw new Error(_0x4cdf8d(0xd1));await database_1[_0x4cdf8d(0xcf)][_0x4cdf8d(0xd5)][_0x4cdf8d(0xda)]({'where':{'id':_0x1c6dac}});}async[a56_0xe834d4(0x10c)](_0x555be6){const _0x2ad6af=a56_0xe834d4,_0x5c5809=await database_1['default'][_0x2ad6af(0xee)][_0x2ad6af(0xe2)]({'where':{'shopId':_0x555be6}});!_0x5c5809&&await database_1[_0x2ad6af(0xcf)][_0x2ad6af(0xee)][_0x2ad6af(0xcd)]({'data':{'shopId':_0x555be6}});}}exports[a56_0xe834d4(0xe8)]=SettingsService;function a56_0x16b9(_0x11b074,_0x17b55d){const _0x21c407=a56_0x21c4();return a56_0x16b9=function(_0x16b912,_0x5806dc){_0x16b912=_0x16b912-0xc6;let _0x2853fa=_0x21c407[_0x16b912];return _0x2853fa;},a56_0x16b9(_0x11b074,_0x17b55d);}function a56_0x21c4(){const _0x40a964=['payment_success','login','compare','shopSettings','pk_','webhookUrl','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','52FxlWlB','notificationPaymentFailed','Shop\x20not\x20found','../config/database','updateTelegramSettings','sk_','isArray','randomBytes','hash','parseWebhookEvents','hex','chatId','60365yaTVfo','maskApiKey','defineProperty','toString','notificationLogin','password','updateWebhookSettings','telegramChatId','string','telegramBotApiKey','length','108pPRFUH','revokeAllApiKeys','179148UNJOxW','ensureSettingsExist','repeat','webhookEvents','notificationPaymentSuccess','parse','notificationApiError','getShopSettings','deleteAccount','12QHrctC','notificationPayout','shopUrl','__importDefault','__esModule','create','notificationRefund','default','835146lZuSPx','Password\x20confirmation\x20is\x20incorrect','payout','bcryptjs','refund','shop','settings','telegram','substring','name','delete','botApiKey','8wWyefD','update','738899fkxQWb','15cAuPsA','244530npxknC','Current\x20password\x20is\x20incorrect','findUnique','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','max','api_error','322OhdJLW','17644mjMtTz','SettingsService','190mLEkCV','crypto'];a56_0x21c4=function(){return _0x40a964;};return a56_0x21c4();}