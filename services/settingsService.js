'use strict';const a64_0x60897a=a64_0x30cd;(function(_0x3173d2,_0x52612f){const _0x735b1=a64_0x30cd,_0xef60e3=_0x3173d2();while(!![]){try{const _0xc145ce=-parseInt(_0x735b1(0x1a2))/0x1*(parseInt(_0x735b1(0x18b))/0x2)+parseInt(_0x735b1(0x180))/0x3*(-parseInt(_0x735b1(0x189))/0x4)+parseInt(_0x735b1(0x1a1))/0x5+-parseInt(_0x735b1(0x1c0))/0x6+parseInt(_0x735b1(0x1a0))/0x7*(parseInt(_0x735b1(0x1a8))/0x8)+parseInt(_0x735b1(0x1bf))/0x9+parseInt(_0x735b1(0x1b4))/0xa;if(_0xc145ce===_0x52612f)break;else _0xef60e3['push'](_0xef60e3['shift']());}catch(_0x5e94fa){_0xef60e3['push'](_0xef60e3['shift']());}}}(a64_0x498a,0x890bc));var __importDefault=this&&this[a64_0x60897a(0x1a3)]||function(_0x514eb9){const _0x41a276=a64_0x60897a;return _0x514eb9&&_0x514eb9[_0x41a276(0x18c)]?_0x514eb9:{'default':_0x514eb9};};function a64_0x30cd(_0x5c3c7a,_0x27f054){const _0x498a85=a64_0x498a();return a64_0x30cd=function(_0x30cdf9,_0x183d6a){_0x30cdf9=_0x30cdf9-0x17e;let _0x5cd0b5=_0x498a85[_0x30cdf9];return _0x5cd0b5;},a64_0x30cd(_0x5c3c7a,_0x27f054);}function a64_0x498a(){const _0x84a5b5=['settings','chatId','default','getShopSettings','Shop\x20not\x20found','parse','sk_','notificationPaymentFailed','telegramBotApiKey','hash','name','1238140mAfnyM','substring','findUnique','telegram','notificationPaymentSuccess','create','shop','update','webhookEvents','payment_success','repeat','9068436SNGANy','4243290eFdqNm','notificationPayout','Current\x20password\x20is\x20incorrect','randomBytes','notificationApiError','1535742oRaGAz','max','Password\x20confirmation\x20is\x20incorrect','shopUrl','delete','botApiKey','maskApiKey','api_error','isArray','4TMYqHm','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','2cbMSkk','__esModule','../config/database','password','toString','ensureSettingsExist','login','bcryptjs','updateNotifications','string','parseWebhookEvents','notificationRefund','notificationLogin','webhookUrl','payment_failed','telegramChatId','length','compare','payout','refund','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','7ojISqJ','2429325mAZBMN','136583ZbeXUS','__importDefault','shopSettings','SettingsService','deleteAccount','updateTelegramSettings','2398152bmwzPs'];a64_0x498a=function(){return _0x84a5b5;};return a64_0x498a();}Object['defineProperty'](exports,a64_0x60897a(0x18c),{'value':!![]}),exports[a64_0x60897a(0x1a5)]=void 0x0;const bcryptjs_1=__importDefault(require(a64_0x60897a(0x192))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a64_0x60897a(0x18d)));class SettingsService{[a64_0x60897a(0x186)](_0x519399){const _0x5cf542=a64_0x60897a;if(!_0x519399)return'';if(_0x519399[_0x5cf542(0x19b)]<=0x8)return _0x519399;const _0x393b80=_0x519399[_0x5cf542(0x1b5)](0x0,0x8),_0x1babe2='*'[_0x5cf542(0x1be)](Math[_0x5cf542(0x181)](0x0,_0x519399[_0x5cf542(0x19b)]-0x8));return _0x393b80+_0x1babe2;}[a64_0x60897a(0x195)](_0x2ab16f){const _0x3da253=a64_0x60897a;if(!_0x2ab16f)return[];if(Array[_0x3da253(0x188)](_0x2ab16f))return _0x2ab16f;if(typeof _0x2ab16f===_0x3da253(0x194))try{const _0x4a9dc4=JSON[_0x3da253(0x1ae)](_0x2ab16f);return Array[_0x3da253(0x188)](_0x4a9dc4)?_0x4a9dc4:[];}catch{return[];}return[];}async[a64_0x60897a(0x1ac)](_0x3b94fd){const _0x2fd759=a64_0x60897a,_0x2782dd=await database_1[_0x2fd759(0x1ab)][_0x2fd759(0x1ba)][_0x2fd759(0x1b6)]({'where':{'id':_0x3b94fd},'include':{'settings':!![]}});if(!_0x2782dd)throw new Error(_0x2fd759(0x1ad));let _0x4a44e2=_0x2782dd[_0x2fd759(0x1a9)];return!_0x4a44e2&&(_0x4a44e2=await database_1['default'][_0x2fd759(0x1a4)][_0x2fd759(0x1b9)]({'data':{'shopId':_0x2782dd['id']}})),{'fullName':_0x2782dd[_0x2fd759(0x1b3)],'brand':_0x2782dd[_0x2fd759(0x1b3)],'merchantUrl':_0x2782dd[_0x2fd759(0x183)],'telegramUsername':_0x2782dd[_0x2fd759(0x1b7)],'telegramBotApiKey':_0x4a44e2[_0x2fd759(0x1b1)]?this[_0x2fd759(0x186)](_0x4a44e2[_0x2fd759(0x1b1)]):null,'telegramChatId':_0x4a44e2[_0x2fd759(0x19a)],'webhookUrl':_0x4a44e2[_0x2fd759(0x198)],'webhookEvents':this[_0x2fd759(0x195)](_0x4a44e2[_0x2fd759(0x1bc)]),'notifications':{'payment_success':_0x4a44e2[_0x2fd759(0x1b8)],'payment_failed':_0x4a44e2['notificationPaymentFailed'],'refund':_0x4a44e2['notificationRefund'],'payout':_0x4a44e2['notificationPayout'],'login':_0x4a44e2[_0x2fd759(0x197)],'api_error':_0x4a44e2[_0x2fd759(0x17f)]}};}async['changePassword'](_0x5469c4,_0x517c1e){const _0x93b6c6=a64_0x60897a,{currentPassword:_0x1c8872,newPassword:_0x2be45f,confirmNewPassword:_0x3562b1}=_0x517c1e;if(_0x2be45f!==_0x3562b1)throw new Error(_0x93b6c6(0x19f));if(_0x2be45f['length']<0x6)throw new Error(_0x93b6c6(0x18a));const _0x3e770=await database_1[_0x93b6c6(0x1ab)][_0x93b6c6(0x1ba)][_0x93b6c6(0x1b6)]({'where':{'id':_0x5469c4},'select':{'password':!![]}});if(!_0x3e770)throw new Error(_0x93b6c6(0x1ad));const _0x3cb277=await bcryptjs_1[_0x93b6c6(0x1ab)][_0x93b6c6(0x19c)](_0x1c8872,_0x3e770[_0x93b6c6(0x18e)]);if(!_0x3cb277)throw new Error(_0x93b6c6(0x1c2));const _0x298aac=await bcryptjs_1['default'][_0x93b6c6(0x1b2)](_0x2be45f,0xc);await database_1[_0x93b6c6(0x1ab)][_0x93b6c6(0x1ba)][_0x93b6c6(0x1bb)]({'where':{'id':_0x5469c4},'data':{'password':_0x298aac}});}async[a64_0x60897a(0x193)](_0x5ac616,_0x10e24b){const _0x5e5c57=a64_0x60897a;await this['ensureSettingsExist'](_0x5ac616);const _0x15f999={};_0x10e24b[_0x5e5c57(0x1bd)]!==undefined&&(_0x15f999[_0x5e5c57(0x1b8)]=_0x10e24b[_0x5e5c57(0x1bd)]),_0x10e24b[_0x5e5c57(0x199)]!==undefined&&(_0x15f999[_0x5e5c57(0x1b0)]=_0x10e24b[_0x5e5c57(0x199)]),_0x10e24b[_0x5e5c57(0x19e)]!==undefined&&(_0x15f999[_0x5e5c57(0x196)]=_0x10e24b[_0x5e5c57(0x19e)]),_0x10e24b['payout']!==undefined&&(_0x15f999[_0x5e5c57(0x1c1)]=_0x10e24b[_0x5e5c57(0x19d)]),_0x10e24b[_0x5e5c57(0x191)]!==undefined&&(_0x15f999['notificationLogin']=_0x10e24b[_0x5e5c57(0x191)]),_0x10e24b['api_error']!==undefined&&(_0x15f999[_0x5e5c57(0x17f)]=_0x10e24b[_0x5e5c57(0x187)]),await database_1[_0x5e5c57(0x1ab)][_0x5e5c57(0x1a4)][_0x5e5c57(0x1bb)]({'where':{'shopId':_0x5ac616},'data':_0x15f999});}async[a64_0x60897a(0x1a7)](_0x390e3e,_0x459672){const _0x2e563c=a64_0x60897a;await this[_0x2e563c(0x190)](_0x390e3e);const _0x21c3d5={};_0x459672[_0x2e563c(0x185)]!==undefined&&(_0x21c3d5[_0x2e563c(0x1b1)]=_0x459672[_0x2e563c(0x185)]||null),_0x459672[_0x2e563c(0x1aa)]!==undefined&&(_0x21c3d5[_0x2e563c(0x19a)]=_0x459672['chatId']||null),await database_1[_0x2e563c(0x1ab)]['shopSettings'][_0x2e563c(0x1bb)]({'where':{'shopId':_0x390e3e},'data':_0x21c3d5});}async['updateWebhookSettings'](_0x1fcb30,_0xc1894b){const _0x599056=a64_0x60897a;await this[_0x599056(0x190)](_0x1fcb30);const _0x3cc241={};_0xc1894b[_0x599056(0x198)]!==undefined&&(_0x3cc241['webhookUrl']=_0xc1894b['webhookUrl']||null),_0xc1894b[_0x599056(0x1bc)]!==undefined&&(_0x3cc241[_0x599056(0x1bc)]=_0xc1894b[_0x599056(0x1bc)]||[]),await database_1['default'][_0x599056(0x1a4)][_0x599056(0x1bb)]({'where':{'shopId':_0x1fcb30},'data':_0x3cc241});}async['revokeAllApiKeys'](_0x9b2a70){const _0x2ccf29=a64_0x60897a,_0x36f1b3='pk_'+crypto_1[_0x2ccf29(0x1ab)][_0x2ccf29(0x17e)](0x20)[_0x2ccf29(0x18f)]('hex'),_0x496fbe=_0x2ccf29(0x1af)+crypto_1[_0x2ccf29(0x1ab)][_0x2ccf29(0x17e)](0x20)[_0x2ccf29(0x18f)]('hex');await database_1[_0x2ccf29(0x1ab)][_0x2ccf29(0x1ba)]['update']({'where':{'id':_0x9b2a70},'data':{'publicKey':_0x36f1b3,'secretKey':_0x496fbe}});}async[a64_0x60897a(0x1a6)](_0x22d1b2,_0x5445b8){const _0x1a1892=a64_0x60897a,{passwordConfirmation:_0x2fc4f1}=_0x5445b8,_0x3e284a=await database_1[_0x1a1892(0x1ab)]['shop'][_0x1a1892(0x1b6)]({'where':{'id':_0x22d1b2},'select':{'password':!![]}});if(!_0x3e284a)throw new Error(_0x1a1892(0x1ad));const _0x2d4565=await bcryptjs_1['default'][_0x1a1892(0x19c)](_0x2fc4f1,_0x3e284a[_0x1a1892(0x18e)]);if(!_0x2d4565)throw new Error(_0x1a1892(0x182));await database_1['default']['shop'][_0x1a1892(0x184)]({'where':{'id':_0x22d1b2}});}async['ensureSettingsExist'](_0x4788aa){const _0x22a0a4=a64_0x60897a,_0x45cb23=await database_1[_0x22a0a4(0x1ab)][_0x22a0a4(0x1a4)][_0x22a0a4(0x1b6)]({'where':{'shopId':_0x4788aa}});!_0x45cb23&&await database_1['default'][_0x22a0a4(0x1a4)][_0x22a0a4(0x1b9)]({'data':{'shopId':_0x4788aa}});}}exports[a64_0x60897a(0x1a5)]=SettingsService;