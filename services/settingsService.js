'use strict';const a72_0x29c957=a72_0x5d85;function a72_0x9cdb(){const _0x4c0092=['length','string','updateTelegramSettings','SettingsService','changePassword','2670308CNAZuV','notificationPaymentSuccess','ensureSettingsExist','substring','botApiKey','webhookEvents','parse','Password\x20confirmation\x20is\x20incorrect','notificationPaymentFailed','50izHevW','api_error','webhookUrl','Shop\x20not\x20found','revokeAllApiKeys','578186XivUPG','telegramBotApiKey','chatId','name','deleteAccount','22482QvuHFk','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','findUnique','compare','4526186qwbgiV','repeat','settings','6EtbVHG','hex','max','hash','notificationLogin','../config/database','updateNotifications','pk_','isArray','payment_success','notificationRefund','__importDefault','parseWebhookEvents','telegramChatId','default','update','toString','691386SvZJPx','getShopSettings','Current\x20password\x20is\x20incorrect','randomBytes','telegram','1991429vajuxx','maskApiKey','payout','defineProperty','9JWnRqy','login','notificationPayout','85AOKDIg','3180392DCeEaL','updateWebhookSettings','crypto','bcryptjs','notificationApiError','shop','password','__esModule','shopSettings','delete','payment_failed','shopUrl','refund'];a72_0x9cdb=function(){return _0x4c0092;};return a72_0x9cdb();}(function(_0x805ced,_0x258adc){const _0x180255=a72_0x5d85,_0x2d657b=_0x805ced();while(!![]){try{const _0x28f195=parseInt(_0x180255(0x173))/0x1+parseInt(_0x180255(0x156))/0x2*(-parseInt(_0x180255(0x162))/0x3)+-parseInt(_0x180255(0x192))/0x4+parseInt(_0x180255(0x17f))/0x5*(-parseInt(_0x180255(0x15b))/0x6)+parseInt(_0x180255(0x15f))/0x7+-parseInt(_0x180255(0x180))/0x8*(parseInt(_0x180255(0x17c))/0x9)+-parseInt(_0x180255(0x151))/0xa*(-parseInt(_0x180255(0x178))/0xb);if(_0x28f195===_0x258adc)break;else _0x2d657b['push'](_0x2d657b['shift']());}catch(_0x42e628){_0x2d657b['push'](_0x2d657b['shift']());}}}(a72_0x9cdb,0x82e68));function a72_0x5d85(_0x182dbc,_0x53cf94){_0x182dbc=_0x182dbc-0x150;const _0x9cdb8e=a72_0x9cdb();let _0x5d8585=_0x9cdb8e[_0x182dbc];return _0x5d8585;}var __importDefault=this&&this[a72_0x29c957(0x16d)]||function(_0x35bba9){const _0x16da31=a72_0x29c957;return _0x35bba9&&_0x35bba9[_0x16da31(0x187)]?_0x35bba9:{'default':_0x35bba9};};Object[a72_0x29c957(0x17b)](exports,a72_0x29c957(0x187),{'value':!![]}),exports[a72_0x29c957(0x190)]=void 0x0;const bcryptjs_1=__importDefault(require(a72_0x29c957(0x183))),crypto_1=__importDefault(require(a72_0x29c957(0x182))),database_1=__importDefault(require(a72_0x29c957(0x167)));class SettingsService{[a72_0x29c957(0x179)](_0x38406a){const _0x4f5fd8=a72_0x29c957;if(!_0x38406a)return'';if(_0x38406a[_0x4f5fd8(0x18d)]<=0x8)return _0x38406a;const _0x1747b8=_0x38406a[_0x4f5fd8(0x195)](0x0,0x8),_0x5a41e2='*'[_0x4f5fd8(0x160)](Math[_0x4f5fd8(0x164)](0x0,_0x38406a[_0x4f5fd8(0x18d)]-0x8));return _0x1747b8+_0x5a41e2;}[a72_0x29c957(0x16e)](_0x20b00d){const _0xc6715a=a72_0x29c957;if(!_0x20b00d)return[];if(Array[_0xc6715a(0x16a)](_0x20b00d))return _0x20b00d;if(typeof _0x20b00d===_0xc6715a(0x18e))try{const _0x685560=JSON[_0xc6715a(0x198)](_0x20b00d);return Array['isArray'](_0x685560)?_0x685560:[];}catch{return[];}return[];}async[a72_0x29c957(0x174)](_0x1f4ae7){const _0x53438d=a72_0x29c957,_0x407a32=await database_1[_0x53438d(0x170)][_0x53438d(0x185)][_0x53438d(0x15d)]({'where':{'id':_0x1f4ae7},'include':{'settings':!![]}});if(!_0x407a32)throw new Error(_0x53438d(0x154));let _0x4f6e8f=_0x407a32[_0x53438d(0x161)];return!_0x4f6e8f&&(_0x4f6e8f=await database_1[_0x53438d(0x170)][_0x53438d(0x188)]['create']({'data':{'shopId':_0x407a32['id']}})),{'fullName':_0x407a32[_0x53438d(0x159)],'brand':_0x407a32[_0x53438d(0x159)],'merchantUrl':_0x407a32[_0x53438d(0x18b)],'telegramUsername':_0x407a32[_0x53438d(0x177)],'telegramBotApiKey':_0x4f6e8f['telegramBotApiKey']?this[_0x53438d(0x179)](_0x4f6e8f['telegramBotApiKey']):null,'telegramChatId':_0x4f6e8f[_0x53438d(0x16f)],'webhookUrl':_0x4f6e8f[_0x53438d(0x153)],'webhookEvents':this['parseWebhookEvents'](_0x4f6e8f['webhookEvents']),'notifications':{'payment_success':_0x4f6e8f[_0x53438d(0x193)],'payment_failed':_0x4f6e8f[_0x53438d(0x150)],'refund':_0x4f6e8f[_0x53438d(0x16c)],'payout':_0x4f6e8f[_0x53438d(0x17e)],'login':_0x4f6e8f[_0x53438d(0x166)],'api_error':_0x4f6e8f['notificationApiError']}};}async[a72_0x29c957(0x191)](_0x5f3f09,_0x2d4c23){const _0x47542e=a72_0x29c957,{currentPassword:_0x58e12e,newPassword:_0x22d146,confirmNewPassword:_0x20a621}=_0x2d4c23;if(_0x22d146!==_0x20a621)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x22d146[_0x47542e(0x18d)]<0x6)throw new Error(_0x47542e(0x15c));const _0x6612fd=await database_1[_0x47542e(0x170)][_0x47542e(0x185)][_0x47542e(0x15d)]({'where':{'id':_0x5f3f09},'select':{'password':!![]}});if(!_0x6612fd)throw new Error(_0x47542e(0x154));const _0x55ee29=await bcryptjs_1[_0x47542e(0x170)][_0x47542e(0x15e)](_0x58e12e,_0x6612fd[_0x47542e(0x186)]);if(!_0x55ee29)throw new Error(_0x47542e(0x175));const _0x529704=await bcryptjs_1[_0x47542e(0x170)][_0x47542e(0x165)](_0x22d146,0xc);await database_1['default']['shop'][_0x47542e(0x171)]({'where':{'id':_0x5f3f09},'data':{'password':_0x529704}});}async[a72_0x29c957(0x168)](_0x1ce739,_0x3fe9e5){const _0x5494ad=a72_0x29c957;await this[_0x5494ad(0x194)](_0x1ce739);const _0x495bdd={};_0x3fe9e5[_0x5494ad(0x16b)]!==undefined&&(_0x495bdd[_0x5494ad(0x193)]=_0x3fe9e5['payment_success']),_0x3fe9e5[_0x5494ad(0x18a)]!==undefined&&(_0x495bdd[_0x5494ad(0x150)]=_0x3fe9e5[_0x5494ad(0x18a)]),_0x3fe9e5['refund']!==undefined&&(_0x495bdd[_0x5494ad(0x16c)]=_0x3fe9e5[_0x5494ad(0x18c)]),_0x3fe9e5[_0x5494ad(0x17a)]!==undefined&&(_0x495bdd['notificationPayout']=_0x3fe9e5[_0x5494ad(0x17a)]),_0x3fe9e5['login']!==undefined&&(_0x495bdd[_0x5494ad(0x166)]=_0x3fe9e5[_0x5494ad(0x17d)]),_0x3fe9e5[_0x5494ad(0x152)]!==undefined&&(_0x495bdd[_0x5494ad(0x184)]=_0x3fe9e5[_0x5494ad(0x152)]),await database_1['default'][_0x5494ad(0x188)]['update']({'where':{'shopId':_0x1ce739},'data':_0x495bdd});}async[a72_0x29c957(0x18f)](_0x18d041,_0x5da6a5){const _0x2df540=a72_0x29c957;await this[_0x2df540(0x194)](_0x18d041);const _0xa66838={};_0x5da6a5[_0x2df540(0x196)]!==undefined&&(_0xa66838[_0x2df540(0x157)]=_0x5da6a5['botApiKey']||null),_0x5da6a5[_0x2df540(0x158)]!==undefined&&(_0xa66838[_0x2df540(0x16f)]=_0x5da6a5[_0x2df540(0x158)]||null),await database_1['default'][_0x2df540(0x188)][_0x2df540(0x171)]({'where':{'shopId':_0x18d041},'data':_0xa66838});}async[a72_0x29c957(0x181)](_0x250ebb,_0x17c565){const _0x2d9733=a72_0x29c957;await this[_0x2d9733(0x194)](_0x250ebb);const _0xed51bc={};_0x17c565['webhookUrl']!==undefined&&(_0xed51bc[_0x2d9733(0x153)]=_0x17c565['webhookUrl']||null),_0x17c565[_0x2d9733(0x197)]!==undefined&&(_0xed51bc[_0x2d9733(0x197)]=_0x17c565[_0x2d9733(0x197)]||[]),await database_1[_0x2d9733(0x170)][_0x2d9733(0x188)][_0x2d9733(0x171)]({'where':{'shopId':_0x250ebb},'data':_0xed51bc});}async[a72_0x29c957(0x155)](_0x341c87){const _0x4378c8=a72_0x29c957,_0xe5cd9f=_0x4378c8(0x169)+crypto_1[_0x4378c8(0x170)][_0x4378c8(0x176)](0x20)[_0x4378c8(0x172)](_0x4378c8(0x163)),_0x24bd60='sk_'+crypto_1[_0x4378c8(0x170)]['randomBytes'](0x20)[_0x4378c8(0x172)](_0x4378c8(0x163));await database_1['default'][_0x4378c8(0x185)]['update']({'where':{'id':_0x341c87},'data':{'publicKey':_0xe5cd9f,'secretKey':_0x24bd60}});}async[a72_0x29c957(0x15a)](_0x5d70af,_0x13e200){const _0x18a389=a72_0x29c957,{passwordConfirmation:_0x2c1a6a}=_0x13e200,_0x1bd142=await database_1[_0x18a389(0x170)][_0x18a389(0x185)][_0x18a389(0x15d)]({'where':{'id':_0x5d70af},'select':{'password':!![]}});if(!_0x1bd142)throw new Error(_0x18a389(0x154));const _0x5b0613=await bcryptjs_1[_0x18a389(0x170)][_0x18a389(0x15e)](_0x2c1a6a,_0x1bd142[_0x18a389(0x186)]);if(!_0x5b0613)throw new Error(_0x18a389(0x199));await database_1['default']['shop'][_0x18a389(0x189)]({'where':{'id':_0x5d70af}});}async[a72_0x29c957(0x194)](_0x1922fb){const _0x569fa0=a72_0x29c957,_0x3dd9f7=await database_1[_0x569fa0(0x170)]['shopSettings'][_0x569fa0(0x15d)]({'where':{'shopId':_0x1922fb}});!_0x3dd9f7&&await database_1['default'][_0x569fa0(0x188)]['create']({'data':{'shopId':_0x1922fb}});}}exports[a72_0x29c957(0x190)]=SettingsService;