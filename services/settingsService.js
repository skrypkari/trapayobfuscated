'use strict';const a51_0x31517c=a51_0x5558;(function(_0x2213fc,_0xec9038){const _0x5dc945=a51_0x5558,_0x3c3d9e=_0x2213fc();while(!![]){try{const _0x33c219=-parseInt(_0x5dc945(0xe4))/0x1+-parseInt(_0x5dc945(0xc1))/0x2*(-parseInt(_0x5dc945(0xba))/0x3)+-parseInt(_0x5dc945(0xf6))/0x4+parseInt(_0x5dc945(0xdb))/0x5+-parseInt(_0x5dc945(0xc6))/0x6*(-parseInt(_0x5dc945(0xce))/0x7)+parseInt(_0x5dc945(0xd7))/0x8*(-parseInt(_0x5dc945(0xd3))/0x9)+parseInt(_0x5dc945(0xee))/0xa*(parseInt(_0x5dc945(0xe6))/0xb);if(_0x33c219===_0xec9038)break;else _0x3c3d9e['push'](_0x3c3d9e['shift']());}catch(_0x34d35e){_0x3c3d9e['push'](_0x3c3d9e['shift']());}}}(a51_0x38f8,0x3d635));var __importDefault=this&&this['__importDefault']||function(_0x41bab4){const _0x48a6a2=a51_0x5558;return _0x41bab4&&_0x41bab4[_0x48a6a2(0xc2)]?_0x41bab4:{'default':_0x41bab4};};function a51_0x5558(_0x365d8b,_0x29ce10){const _0x38f8b9=a51_0x38f8();return a51_0x5558=function(_0x555874,_0x45a02c){_0x555874=_0x555874-0xb7;let _0x32f094=_0x38f8b9[_0x555874];return _0x32f094;},a51_0x5558(_0x365d8b,_0x29ce10);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a51_0x31517c(0xd0))),crypto_1=__importDefault(require(a51_0x31517c(0xb8))),database_1=__importDefault(require(a51_0x31517c(0xe3)));function a51_0x38f8(){const _0x431121=['webhookEvents','maskApiKey','webhookUrl','telegramChatId','parseWebhookEvents','length','../config/database','423152qERxlH','name','2940729IsAcCj','login','compare','isArray','settings','max','refund','hash','10UShkan','Shop\x20not\x20found','substring','telegramBotApiKey','string','default','ensureSettingsExist','payment_failed','1230808DkUxiv','password','crypto','parse','1321734xaVSHp','shop','findUnique','updateTelegramSettings','notificationRefund','create','deleteAccount','2XXlJCA','__esModule','payment_success','hex','notificationApiError','150768jBaanz','botApiKey','revokeAllApiKeys','repeat','telegram','shopSettings','Password\x20confirmation\x20is\x20incorrect','update','140GpJOMW','notificationPayout','bcryptjs','chatId','Current\x20password\x20is\x20incorrect','5724hcfZLy','shopUrl','toString','notificationPaymentFailed','4112hkBpqy','api_error','notificationLogin','notificationPaymentSuccess','493630lsGVMQ','New\x20password\x20and\x20confirmation\x20do\x20not\x20match'];a51_0x38f8=function(){return _0x431121;};return a51_0x38f8();}class SettingsService{['maskApiKey'](_0x11987f){const _0x889a12=a51_0x31517c;if(!_0x11987f)return'';if(_0x11987f[_0x889a12(0xe2)]<=0x8)return _0x11987f;const _0x12756a=_0x11987f[_0x889a12(0xf0)](0x0,0x8),_0x413c74='*'[_0x889a12(0xc9)](Math[_0x889a12(0xeb)](0x0,_0x11987f['length']-0x8));return _0x12756a+_0x413c74;}[a51_0x31517c(0xe1)](_0x5b3b5b){const _0x1f0cf0=a51_0x31517c;if(!_0x5b3b5b)return[];if(Array[_0x1f0cf0(0xe9)](_0x5b3b5b))return _0x5b3b5b;if(typeof _0x5b3b5b===_0x1f0cf0(0xf2))try{const _0x28fb24=JSON[_0x1f0cf0(0xb9)](_0x5b3b5b);return Array[_0x1f0cf0(0xe9)](_0x28fb24)?_0x28fb24:[];}catch{return[];}return[];}async['getShopSettings'](_0x334b90){const _0x2c000a=a51_0x31517c,_0x3fda86=await database_1[_0x2c000a(0xf3)][_0x2c000a(0xbb)][_0x2c000a(0xbc)]({'where':{'id':_0x334b90},'include':{'settings':!![]}});if(!_0x3fda86)throw new Error(_0x2c000a(0xef));let _0x9175a7=_0x3fda86[_0x2c000a(0xea)];return!_0x9175a7&&(_0x9175a7=await database_1[_0x2c000a(0xf3)]['shopSettings'][_0x2c000a(0xbf)]({'data':{'shopId':_0x3fda86['id']}})),{'fullName':_0x3fda86[_0x2c000a(0xe5)],'brand':_0x3fda86[_0x2c000a(0xe5)],'merchantUrl':_0x3fda86[_0x2c000a(0xd4)],'telegramUsername':_0x3fda86[_0x2c000a(0xca)],'telegramBotApiKey':_0x9175a7[_0x2c000a(0xf1)]?this[_0x2c000a(0xde)](_0x9175a7[_0x2c000a(0xf1)]):null,'telegramChatId':_0x9175a7['telegramChatId'],'webhookUrl':_0x9175a7[_0x2c000a(0xdf)],'webhookEvents':this['parseWebhookEvents'](_0x9175a7[_0x2c000a(0xdd)]),'notifications':{'payment_success':_0x9175a7[_0x2c000a(0xda)],'payment_failed':_0x9175a7[_0x2c000a(0xd6)],'refund':_0x9175a7[_0x2c000a(0xbe)],'payout':_0x9175a7[_0x2c000a(0xcf)],'login':_0x9175a7[_0x2c000a(0xd9)],'api_error':_0x9175a7[_0x2c000a(0xc5)]}};}async['changePassword'](_0x26163d,_0x17e60f){const _0x28e808=a51_0x31517c,{currentPassword:_0x4ac72b,newPassword:_0xa54f96,confirmNewPassword:_0x2d08d4}=_0x17e60f;if(_0xa54f96!==_0x2d08d4)throw new Error(_0x28e808(0xdc));if(_0xa54f96[_0x28e808(0xe2)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x240c6c=await database_1[_0x28e808(0xf3)]['shop'][_0x28e808(0xbc)]({'where':{'id':_0x26163d},'select':{'password':!![]}});if(!_0x240c6c)throw new Error(_0x28e808(0xef));const _0x8447c0=await bcryptjs_1[_0x28e808(0xf3)][_0x28e808(0xe8)](_0x4ac72b,_0x240c6c[_0x28e808(0xb7)]);if(!_0x8447c0)throw new Error(_0x28e808(0xd2));const _0x39349c=await bcryptjs_1[_0x28e808(0xf3)][_0x28e808(0xed)](_0xa54f96,0xc);await database_1[_0x28e808(0xf3)]['shop']['update']({'where':{'id':_0x26163d},'data':{'password':_0x39349c}});}async['updateNotifications'](_0x1d2490,_0x2f6b5f){const _0x1abe84=a51_0x31517c;await this[_0x1abe84(0xf4)](_0x1d2490);const _0x1b3941={};_0x2f6b5f[_0x1abe84(0xc3)]!==undefined&&(_0x1b3941[_0x1abe84(0xda)]=_0x2f6b5f[_0x1abe84(0xc3)]),_0x2f6b5f[_0x1abe84(0xf5)]!==undefined&&(_0x1b3941[_0x1abe84(0xd6)]=_0x2f6b5f['payment_failed']),_0x2f6b5f[_0x1abe84(0xec)]!==undefined&&(_0x1b3941[_0x1abe84(0xbe)]=_0x2f6b5f[_0x1abe84(0xec)]),_0x2f6b5f['payout']!==undefined&&(_0x1b3941[_0x1abe84(0xcf)]=_0x2f6b5f['payout']),_0x2f6b5f[_0x1abe84(0xe7)]!==undefined&&(_0x1b3941[_0x1abe84(0xd9)]=_0x2f6b5f[_0x1abe84(0xe7)]),_0x2f6b5f[_0x1abe84(0xd8)]!==undefined&&(_0x1b3941[_0x1abe84(0xc5)]=_0x2f6b5f['api_error']),await database_1[_0x1abe84(0xf3)][_0x1abe84(0xcb)][_0x1abe84(0xcd)]({'where':{'shopId':_0x1d2490},'data':_0x1b3941});}async[a51_0x31517c(0xbd)](_0x3e6d10,_0x353be4){const _0x3d07f2=a51_0x31517c;await this[_0x3d07f2(0xf4)](_0x3e6d10);const _0x566f4d={};_0x353be4['botApiKey']!==undefined&&(_0x566f4d[_0x3d07f2(0xf1)]=_0x353be4[_0x3d07f2(0xc7)]||null),_0x353be4[_0x3d07f2(0xd1)]!==undefined&&(_0x566f4d[_0x3d07f2(0xe0)]=_0x353be4[_0x3d07f2(0xd1)]||null),await database_1[_0x3d07f2(0xf3)][_0x3d07f2(0xcb)][_0x3d07f2(0xcd)]({'where':{'shopId':_0x3e6d10},'data':_0x566f4d});}async['updateWebhookSettings'](_0x44418a,_0x28f243){const _0x186fbf=a51_0x31517c;await this['ensureSettingsExist'](_0x44418a);const _0x379dfa={};_0x28f243['webhookUrl']!==undefined&&(_0x379dfa[_0x186fbf(0xdf)]=_0x28f243['webhookUrl']||null),_0x28f243[_0x186fbf(0xdd)]!==undefined&&(_0x379dfa[_0x186fbf(0xdd)]=_0x28f243[_0x186fbf(0xdd)]||[]),await database_1[_0x186fbf(0xf3)][_0x186fbf(0xcb)][_0x186fbf(0xcd)]({'where':{'shopId':_0x44418a},'data':_0x379dfa});}async[a51_0x31517c(0xc8)](_0x1b3f53){const _0x261df5=a51_0x31517c,_0x4fabe3='pk_'+crypto_1[_0x261df5(0xf3)]['randomBytes'](0x20)[_0x261df5(0xd5)](_0x261df5(0xc4)),_0x5c57fe='sk_'+crypto_1[_0x261df5(0xf3)]['randomBytes'](0x20)[_0x261df5(0xd5)](_0x261df5(0xc4));await database_1[_0x261df5(0xf3)]['shop'][_0x261df5(0xcd)]({'where':{'id':_0x1b3f53},'data':{'publicKey':_0x4fabe3,'secretKey':_0x5c57fe}});}async[a51_0x31517c(0xc0)](_0x18ce33,_0x21af3f){const _0x49525c=a51_0x31517c,{passwordConfirmation:_0x5ce32f}=_0x21af3f,_0x22450f=await database_1[_0x49525c(0xf3)][_0x49525c(0xbb)]['findUnique']({'where':{'id':_0x18ce33},'select':{'password':!![]}});if(!_0x22450f)throw new Error(_0x49525c(0xef));const _0x394314=await bcryptjs_1[_0x49525c(0xf3)][_0x49525c(0xe8)](_0x5ce32f,_0x22450f[_0x49525c(0xb7)]);if(!_0x394314)throw new Error(_0x49525c(0xcc));await database_1[_0x49525c(0xf3)][_0x49525c(0xbb)]['delete']({'where':{'id':_0x18ce33}});}async[a51_0x31517c(0xf4)](_0x4af833){const _0x530d08=a51_0x31517c,_0x3441ad=await database_1[_0x530d08(0xf3)][_0x530d08(0xcb)][_0x530d08(0xbc)]({'where':{'shopId':_0x4af833}});!_0x3441ad&&await database_1[_0x530d08(0xf3)][_0x530d08(0xcb)]['create']({'data':{'shopId':_0x4af833}});}}exports['SettingsService']=SettingsService;