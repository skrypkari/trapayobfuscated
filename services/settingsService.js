'use strict';const a59_0x38ffa7=a59_0x4ce0;function a59_0x8e96(){const _0x530a1f=['5030AnnUnP','compare','sk_','isArray','25047rWVnBp','create','update','shopUrl','revokeAllApiKeys','delete','SettingsService','telegram','payout','895uaibYs','parseWebhookEvents','telegramBotApiKey','parse','Shop\x20not\x20found','notificationPaymentSuccess','crypto','randomBytes','2964296SZWSJQ','shopSettings','refund','payment_failed','length','594550agWgLL','toString','api_error','payment_success','getShopSettings','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','findUnique','2549953RdmhUE','telegramChatId','password','notificationPayout','webhookUrl','../config/database','substring','updateNotifications','notificationLogin','max','notificationRefund','ensureSettingsExist','updateWebhookSettings','3lsZBvq','hex','default','webhookEvents','maskApiKey','defineProperty','4476AQJWzH','345750DfLztj','pk_','Password\x20confirmation\x20is\x20incorrect','hash','name','shop','notificationApiError','__importDefault','Current\x20password\x20is\x20incorrect','notificationPaymentFailed','repeat','1912242wBGWLn','bcryptjs','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','deleteAccount','login','chatId'];a59_0x8e96=function(){return _0x530a1f;};return a59_0x8e96();}(function(_0x4c25d5,_0x58bf9f){const _0x5ea058=a59_0x4ce0,_0x4f2573=_0x4c25d5();while(!![]){try{const _0x37e292=parseInt(_0x5ea058(0x1db))/0x1+-parseInt(_0x5ea058(0x1c0))/0x2*(parseInt(_0x5ea058(0x1d4))/0x3)+parseInt(_0x5ea058(0x1da))/0x4*(-parseInt(_0x5ea058(0x1f9))/0x5)+-parseInt(_0x5ea058(0x1e6))/0x6+-parseInt(_0x5ea058(0x1c7))/0x7+-parseInt(_0x5ea058(0x201))/0x8+parseInt(_0x5ea058(0x1f0))/0x9*(parseInt(_0x5ea058(0x1ec))/0xa);if(_0x37e292===_0x58bf9f)break;else _0x4f2573['push'](_0x4f2573['shift']());}catch(_0x3ecda2){_0x4f2573['push'](_0x4f2573['shift']());}}}(a59_0x8e96,0x2f7c4));function a59_0x4ce0(_0x33e610,_0x48b159){const _0x8e96fc=a59_0x8e96();return a59_0x4ce0=function(_0x4ce000,_0x1e8733){_0x4ce000=_0x4ce000-0x1bd;let _0x2bfdb2=_0x8e96fc[_0x4ce000];return _0x2bfdb2;},a59_0x4ce0(_0x33e610,_0x48b159);}var __importDefault=this&&this[a59_0x38ffa7(0x1e2)]||function(_0x344bc4){return _0x344bc4&&_0x344bc4['__esModule']?_0x344bc4:{'default':_0x344bc4};};Object[a59_0x38ffa7(0x1d9)](exports,'__esModule',{'value':!![]}),exports[a59_0x38ffa7(0x1f6)]=void 0x0;const bcryptjs_1=__importDefault(require(a59_0x38ffa7(0x1e7))),crypto_1=__importDefault(require(a59_0x38ffa7(0x1ff))),database_1=__importDefault(require(a59_0x38ffa7(0x1cc)));class SettingsService{['maskApiKey'](_0x3144e8){const _0x434415=a59_0x38ffa7;if(!_0x3144e8)return'';if(_0x3144e8['length']<=0x8)return _0x3144e8;const _0x236f02=_0x3144e8[_0x434415(0x1cd)](0x0,0x8),_0x4ed0d6='*'[_0x434415(0x1e5)](Math[_0x434415(0x1d0)](0x0,_0x3144e8[_0x434415(0x1bf)]-0x8));return _0x236f02+_0x4ed0d6;}[a59_0x38ffa7(0x1fa)](_0x64795f){const _0x1bcd2f=a59_0x38ffa7;if(!_0x64795f)return[];if(Array[_0x1bcd2f(0x1ef)](_0x64795f))return _0x64795f;if(typeof _0x64795f==='string')try{const _0xd7b59e=JSON[_0x1bcd2f(0x1fc)](_0x64795f);return Array[_0x1bcd2f(0x1ef)](_0xd7b59e)?_0xd7b59e:[];}catch{return[];}return[];}async[a59_0x38ffa7(0x1c4)](_0xc25494){const _0x3fd78e=a59_0x38ffa7,_0x5c6c6c=await database_1[_0x3fd78e(0x1d6)][_0x3fd78e(0x1e0)]['findUnique']({'where':{'id':_0xc25494},'include':{'settings':!![]}});if(!_0x5c6c6c)throw new Error(_0x3fd78e(0x1fd));let _0x592fbc=_0x5c6c6c['settings'];return!_0x592fbc&&(_0x592fbc=await database_1[_0x3fd78e(0x1d6)][_0x3fd78e(0x202)]['create']({'data':{'shopId':_0x5c6c6c['id']}})),{'fullName':_0x5c6c6c[_0x3fd78e(0x1df)],'brand':_0x5c6c6c[_0x3fd78e(0x1df)],'merchantUrl':_0x5c6c6c[_0x3fd78e(0x1f3)],'telegramUsername':_0x5c6c6c[_0x3fd78e(0x1f7)],'telegramBotApiKey':_0x592fbc['telegramBotApiKey']?this[_0x3fd78e(0x1d8)](_0x592fbc[_0x3fd78e(0x1fb)]):null,'telegramChatId':_0x592fbc['telegramChatId'],'webhookUrl':_0x592fbc[_0x3fd78e(0x1cb)],'webhookEvents':this[_0x3fd78e(0x1fa)](_0x592fbc[_0x3fd78e(0x1d7)]),'notifications':{'payment_success':_0x592fbc['notificationPaymentSuccess'],'payment_failed':_0x592fbc[_0x3fd78e(0x1e4)],'refund':_0x592fbc['notificationRefund'],'payout':_0x592fbc['notificationPayout'],'login':_0x592fbc[_0x3fd78e(0x1cf)],'api_error':_0x592fbc[_0x3fd78e(0x1e1)]}};}async['changePassword'](_0x5d1ae5,_0x366d9c){const _0x40f698=a59_0x38ffa7,{currentPassword:_0x23b02a,newPassword:_0x1eb959,confirmNewPassword:_0x15b418}=_0x366d9c;if(_0x1eb959!==_0x15b418)throw new Error(_0x40f698(0x1c5));if(_0x1eb959[_0x40f698(0x1bf)]<0x6)throw new Error(_0x40f698(0x1e8));const _0x511edd=await database_1['default'][_0x40f698(0x1e0)][_0x40f698(0x1c6)]({'where':{'id':_0x5d1ae5},'select':{'password':!![]}});if(!_0x511edd)throw new Error(_0x40f698(0x1fd));const _0x3a275c=await bcryptjs_1['default'][_0x40f698(0x1ed)](_0x23b02a,_0x511edd[_0x40f698(0x1c9)]);if(!_0x3a275c)throw new Error(_0x40f698(0x1e3));const _0x376eb7=await bcryptjs_1[_0x40f698(0x1d6)][_0x40f698(0x1de)](_0x1eb959,0xc);await database_1[_0x40f698(0x1d6)][_0x40f698(0x1e0)]['update']({'where':{'id':_0x5d1ae5},'data':{'password':_0x376eb7}});}async[a59_0x38ffa7(0x1ce)](_0x113986,_0x4388a5){const _0x29ea45=a59_0x38ffa7;await this[_0x29ea45(0x1d2)](_0x113986);const _0x33d401={};_0x4388a5[_0x29ea45(0x1c3)]!==undefined&&(_0x33d401[_0x29ea45(0x1fe)]=_0x4388a5[_0x29ea45(0x1c3)]),_0x4388a5[_0x29ea45(0x1be)]!==undefined&&(_0x33d401[_0x29ea45(0x1e4)]=_0x4388a5[_0x29ea45(0x1be)]),_0x4388a5[_0x29ea45(0x1bd)]!==undefined&&(_0x33d401[_0x29ea45(0x1d1)]=_0x4388a5['refund']),_0x4388a5[_0x29ea45(0x1f8)]!==undefined&&(_0x33d401[_0x29ea45(0x1ca)]=_0x4388a5[_0x29ea45(0x1f8)]),_0x4388a5[_0x29ea45(0x1ea)]!==undefined&&(_0x33d401[_0x29ea45(0x1cf)]=_0x4388a5['login']),_0x4388a5[_0x29ea45(0x1c2)]!==undefined&&(_0x33d401[_0x29ea45(0x1e1)]=_0x4388a5[_0x29ea45(0x1c2)]),await database_1[_0x29ea45(0x1d6)]['shopSettings'][_0x29ea45(0x1f2)]({'where':{'shopId':_0x113986},'data':_0x33d401});}async['updateTelegramSettings'](_0x5783bb,_0x4f6462){const _0x4399e5=a59_0x38ffa7;await this[_0x4399e5(0x1d2)](_0x5783bb);const _0x3bf659={};_0x4f6462['botApiKey']!==undefined&&(_0x3bf659['telegramBotApiKey']=_0x4f6462['botApiKey']||null),_0x4f6462[_0x4399e5(0x1eb)]!==undefined&&(_0x3bf659[_0x4399e5(0x1c8)]=_0x4f6462[_0x4399e5(0x1eb)]||null),await database_1[_0x4399e5(0x1d6)][_0x4399e5(0x202)][_0x4399e5(0x1f2)]({'where':{'shopId':_0x5783bb},'data':_0x3bf659});}async[a59_0x38ffa7(0x1d3)](_0x21556f,_0x98b85f){const _0x17f856=a59_0x38ffa7;await this[_0x17f856(0x1d2)](_0x21556f);const _0x55ea42={};_0x98b85f[_0x17f856(0x1cb)]!==undefined&&(_0x55ea42[_0x17f856(0x1cb)]=_0x98b85f[_0x17f856(0x1cb)]||null),_0x98b85f[_0x17f856(0x1d7)]!==undefined&&(_0x55ea42[_0x17f856(0x1d7)]=_0x98b85f[_0x17f856(0x1d7)]||[]),await database_1['default']['shopSettings'][_0x17f856(0x1f2)]({'where':{'shopId':_0x21556f},'data':_0x55ea42});}async[a59_0x38ffa7(0x1f4)](_0x361e96){const _0x2d761d=a59_0x38ffa7,_0x2a2d69=_0x2d761d(0x1dc)+crypto_1[_0x2d761d(0x1d6)][_0x2d761d(0x200)](0x20)[_0x2d761d(0x1c1)](_0x2d761d(0x1d5)),_0x75a91f=_0x2d761d(0x1ee)+crypto_1['default'][_0x2d761d(0x200)](0x20)[_0x2d761d(0x1c1)](_0x2d761d(0x1d5));await database_1[_0x2d761d(0x1d6)][_0x2d761d(0x1e0)][_0x2d761d(0x1f2)]({'where':{'id':_0x361e96},'data':{'publicKey':_0x2a2d69,'secretKey':_0x75a91f}});}async[a59_0x38ffa7(0x1e9)](_0x2524da,_0x5c2f26){const _0xe96e28=a59_0x38ffa7,{passwordConfirmation:_0x1bc830}=_0x5c2f26,_0x25bb04=await database_1[_0xe96e28(0x1d6)][_0xe96e28(0x1e0)][_0xe96e28(0x1c6)]({'where':{'id':_0x2524da},'select':{'password':!![]}});if(!_0x25bb04)throw new Error(_0xe96e28(0x1fd));const _0x209a8f=await bcryptjs_1[_0xe96e28(0x1d6)][_0xe96e28(0x1ed)](_0x1bc830,_0x25bb04[_0xe96e28(0x1c9)]);if(!_0x209a8f)throw new Error(_0xe96e28(0x1dd));await database_1['default']['shop'][_0xe96e28(0x1f5)]({'where':{'id':_0x2524da}});}async['ensureSettingsExist'](_0x2d6b5a){const _0x74a75c=a59_0x38ffa7,_0x320b84=await database_1['default'][_0x74a75c(0x202)]['findUnique']({'where':{'shopId':_0x2d6b5a}});!_0x320b84&&await database_1[_0x74a75c(0x1d6)][_0x74a75c(0x202)][_0x74a75c(0x1f1)]({'data':{'shopId':_0x2d6b5a}});}}exports['SettingsService']=SettingsService;