'use strict';function a59_0x4534(){const _0x2c9c1a=['deleteAccount','botApiKey','update','__esModule','notificationRefund','length','notificationLogin','webhookEvents','notificationPaymentSuccess','defineProperty','364426SuaPcC','5042526jCOGZl','telegramBotApiKey','default','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','login','substring','findUnique','randomBytes','updateWebhookSettings','SettingsService','telegramChatId','notificationPayout','payment_success','parse','351730TycdkX','updateTelegramSettings','Shop\x20not\x20found','shop','6280SxTLWf','../config/database','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','40aBhSSH','password','toString','crypto','16326YdDSlW','compare','refund','3QEHnpd','notificationPaymentFailed','settings','payment_failed','webhookUrl','create','Current\x20password\x20is\x20incorrect','api_error','parseWebhookEvents','repeat','string','928046wcadjq','name','ensureSettingsExist','max','hash','1162136mmGwbb','isArray','changePassword','18676438hlWNhq','shopSettings','payout','telegram','pk_','8tfJtqm','getShopSettings','chatId','notificationApiError','__importDefault','bcryptjs','hex','sk_'];a59_0x4534=function(){return _0x2c9c1a;};return a59_0x4534();}const a59_0x28bfb6=a59_0x2abb;function a59_0x2abb(_0x3e9a5c,_0x4c13ee){const _0x453416=a59_0x4534();return a59_0x2abb=function(_0x2abb09,_0x22c6a4){_0x2abb09=_0x2abb09-0x9a;let _0x32e79d=_0x453416[_0x2abb09];return _0x32e79d;},a59_0x2abb(_0x3e9a5c,_0x4c13ee);}(function(_0x320c2a,_0x413c3d){const _0x1f7622=a59_0x2abb,_0x3df2e8=_0x320c2a();while(!![]){try{const _0x4cf6e4=parseInt(_0x1f7622(0x9f))/0x1+-parseInt(_0x1f7622(0xcc))/0x2*(-parseInt(_0x1f7622(0xbc))/0x3)+parseInt(_0x1f7622(0xb5))/0x4*(-parseInt(_0x1f7622(0xae))/0x5)+parseInt(_0x1f7622(0xa0))/0x6+-parseInt(_0x1f7622(0xc7))/0x7*(-parseInt(_0x1f7622(0xd4))/0x8)+parseInt(_0x1f7622(0xb9))/0x9*(parseInt(_0x1f7622(0xb2))/0xa)+-parseInt(_0x1f7622(0xcf))/0xb;if(_0x4cf6e4===_0x413c3d)break;else _0x3df2e8['push'](_0x3df2e8['shift']());}catch(_0x25f231){_0x3df2e8['push'](_0x3df2e8['shift']());}}}(a59_0x4534,0xa03ef));var __importDefault=this&&this[a59_0x28bfb6(0xd8)]||function(_0x5710b4){return _0x5710b4&&_0x5710b4['__esModule']?_0x5710b4:{'default':_0x5710b4};};Object[a59_0x28bfb6(0x9e)](exports,a59_0x28bfb6(0xdf),{'value':!![]}),exports[a59_0x28bfb6(0xa9)]=void 0x0;const bcryptjs_1=__importDefault(require(a59_0x28bfb6(0xd9))),crypto_1=__importDefault(require(a59_0x28bfb6(0xb8))),database_1=__importDefault(require(a59_0x28bfb6(0xb3)));class SettingsService{['maskApiKey'](_0xcb3daf){const _0xcd3f72=a59_0x28bfb6;if(!_0xcb3daf)return'';if(_0xcb3daf[_0xcd3f72(0x9a)]<=0x8)return _0xcb3daf;const _0xd3e00c=_0xcb3daf[_0xcd3f72(0xa5)](0x0,0x8),_0x110bed='*'[_0xcd3f72(0xc5)](Math[_0xcd3f72(0xca)](0x0,_0xcb3daf['length']-0x8));return _0xd3e00c+_0x110bed;}[a59_0x28bfb6(0xc4)](_0x34cd5b){const _0x2f4422=a59_0x28bfb6;if(!_0x34cd5b)return[];if(Array['isArray'](_0x34cd5b))return _0x34cd5b;if(typeof _0x34cd5b===_0x2f4422(0xc6))try{const _0x43ff43=JSON[_0x2f4422(0xad)](_0x34cd5b);return Array[_0x2f4422(0xcd)](_0x43ff43)?_0x43ff43:[];}catch{return[];}return[];}async[a59_0x28bfb6(0xd5)](_0x223d03){const _0x2d388b=a59_0x28bfb6,_0x2287fa=await database_1[_0x2d388b(0xa2)]['shop'][_0x2d388b(0xa6)]({'where':{'id':_0x223d03},'include':{'settings':!![]}});if(!_0x2287fa)throw new Error(_0x2d388b(0xb0));let _0x13aac2=_0x2287fa[_0x2d388b(0xbe)];return!_0x13aac2&&(_0x13aac2=await database_1[_0x2d388b(0xa2)][_0x2d388b(0xd0)]['create']({'data':{'shopId':_0x2287fa['id']}})),{'fullName':_0x2287fa[_0x2d388b(0xc8)],'brand':_0x2287fa[_0x2d388b(0xc8)],'merchantUrl':_0x2287fa['shopUrl'],'telegramUsername':_0x2287fa[_0x2d388b(0xd2)],'telegramBotApiKey':_0x13aac2['telegramBotApiKey']?this['maskApiKey'](_0x13aac2[_0x2d388b(0xa1)]):null,'telegramChatId':_0x13aac2[_0x2d388b(0xaa)],'webhookUrl':_0x13aac2['webhookUrl'],'webhookEvents':this[_0x2d388b(0xc4)](_0x13aac2[_0x2d388b(0x9c)]),'notifications':{'payment_success':_0x13aac2[_0x2d388b(0x9d)],'payment_failed':_0x13aac2[_0x2d388b(0xbd)],'refund':_0x13aac2[_0x2d388b(0xe0)],'payout':_0x13aac2[_0x2d388b(0xab)],'login':_0x13aac2[_0x2d388b(0x9b)],'api_error':_0x13aac2[_0x2d388b(0xd7)]}};}async[a59_0x28bfb6(0xce)](_0x4f514d,_0x4d3739){const _0x1eda1d=a59_0x28bfb6,{currentPassword:_0xdb8e84,newPassword:_0x56f046,confirmNewPassword:_0x2d8fee}=_0x4d3739;if(_0x56f046!==_0x2d8fee)throw new Error(_0x1eda1d(0xa3));if(_0x56f046[_0x1eda1d(0x9a)]<0x6)throw new Error(_0x1eda1d(0xb4));const _0x117308=await database_1[_0x1eda1d(0xa2)][_0x1eda1d(0xb1)][_0x1eda1d(0xa6)]({'where':{'id':_0x4f514d},'select':{'password':!![]}});if(!_0x117308)throw new Error('Shop\x20not\x20found');const _0x57afca=await bcryptjs_1[_0x1eda1d(0xa2)][_0x1eda1d(0xba)](_0xdb8e84,_0x117308[_0x1eda1d(0xb6)]);if(!_0x57afca)throw new Error(_0x1eda1d(0xc2));const _0x106f41=await bcryptjs_1[_0x1eda1d(0xa2)][_0x1eda1d(0xcb)](_0x56f046,0xc);await database_1[_0x1eda1d(0xa2)]['shop'][_0x1eda1d(0xde)]({'where':{'id':_0x4f514d},'data':{'password':_0x106f41}});}async['updateNotifications'](_0x594967,_0x5a0de0){const _0x19aff9=a59_0x28bfb6;await this[_0x19aff9(0xc9)](_0x594967);const _0x559d56={};_0x5a0de0[_0x19aff9(0xac)]!==undefined&&(_0x559d56[_0x19aff9(0x9d)]=_0x5a0de0[_0x19aff9(0xac)]),_0x5a0de0[_0x19aff9(0xbf)]!==undefined&&(_0x559d56[_0x19aff9(0xbd)]=_0x5a0de0[_0x19aff9(0xbf)]),_0x5a0de0[_0x19aff9(0xbb)]!==undefined&&(_0x559d56[_0x19aff9(0xe0)]=_0x5a0de0[_0x19aff9(0xbb)]),_0x5a0de0[_0x19aff9(0xd1)]!==undefined&&(_0x559d56[_0x19aff9(0xab)]=_0x5a0de0[_0x19aff9(0xd1)]),_0x5a0de0[_0x19aff9(0xa4)]!==undefined&&(_0x559d56['notificationLogin']=_0x5a0de0[_0x19aff9(0xa4)]),_0x5a0de0[_0x19aff9(0xc3)]!==undefined&&(_0x559d56[_0x19aff9(0xd7)]=_0x5a0de0['api_error']),await database_1[_0x19aff9(0xa2)][_0x19aff9(0xd0)]['update']({'where':{'shopId':_0x594967},'data':_0x559d56});}async[a59_0x28bfb6(0xaf)](_0x242a0b,_0x1eec82){const _0x4a8db3=a59_0x28bfb6;await this['ensureSettingsExist'](_0x242a0b);const _0x2e1b71={};_0x1eec82[_0x4a8db3(0xdd)]!==undefined&&(_0x2e1b71[_0x4a8db3(0xa1)]=_0x1eec82[_0x4a8db3(0xdd)]||null),_0x1eec82[_0x4a8db3(0xd6)]!==undefined&&(_0x2e1b71[_0x4a8db3(0xaa)]=_0x1eec82[_0x4a8db3(0xd6)]||null),await database_1[_0x4a8db3(0xa2)]['shopSettings'][_0x4a8db3(0xde)]({'where':{'shopId':_0x242a0b},'data':_0x2e1b71});}async[a59_0x28bfb6(0xa8)](_0x28ab53,_0x32d65d){const _0x1cb2d8=a59_0x28bfb6;await this['ensureSettingsExist'](_0x28ab53);const _0xfd137e={};_0x32d65d[_0x1cb2d8(0xc0)]!==undefined&&(_0xfd137e[_0x1cb2d8(0xc0)]=_0x32d65d[_0x1cb2d8(0xc0)]||null),_0x32d65d[_0x1cb2d8(0x9c)]!==undefined&&(_0xfd137e[_0x1cb2d8(0x9c)]=_0x32d65d[_0x1cb2d8(0x9c)]||[]),await database_1[_0x1cb2d8(0xa2)]['shopSettings'][_0x1cb2d8(0xde)]({'where':{'shopId':_0x28ab53},'data':_0xfd137e});}async['revokeAllApiKeys'](_0x1eaea6){const _0x1d2f5d=a59_0x28bfb6,_0x5c2f77=_0x1d2f5d(0xd3)+crypto_1[_0x1d2f5d(0xa2)]['randomBytes'](0x20)[_0x1d2f5d(0xb7)](_0x1d2f5d(0xda)),_0x5058ad=_0x1d2f5d(0xdb)+crypto_1[_0x1d2f5d(0xa2)][_0x1d2f5d(0xa7)](0x20)['toString'](_0x1d2f5d(0xda));await database_1[_0x1d2f5d(0xa2)][_0x1d2f5d(0xb1)][_0x1d2f5d(0xde)]({'where':{'id':_0x1eaea6},'data':{'publicKey':_0x5c2f77,'secretKey':_0x5058ad}});}async[a59_0x28bfb6(0xdc)](_0x45bcf5,_0x384fbd){const _0x4c0130=a59_0x28bfb6,{passwordConfirmation:_0x5aff7e}=_0x384fbd,_0x1883e9=await database_1['default'][_0x4c0130(0xb1)][_0x4c0130(0xa6)]({'where':{'id':_0x45bcf5},'select':{'password':!![]}});if(!_0x1883e9)throw new Error(_0x4c0130(0xb0));const _0x17cd80=await bcryptjs_1[_0x4c0130(0xa2)][_0x4c0130(0xba)](_0x5aff7e,_0x1883e9[_0x4c0130(0xb6)]);if(!_0x17cd80)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x4c0130(0xa2)][_0x4c0130(0xb1)]['delete']({'where':{'id':_0x45bcf5}});}async[a59_0x28bfb6(0xc9)](_0x297dbf){const _0xe4f83e=a59_0x28bfb6,_0x53b751=await database_1['default'][_0xe4f83e(0xd0)]['findUnique']({'where':{'shopId':_0x297dbf}});!_0x53b751&&await database_1['default'][_0xe4f83e(0xd0)][_0xe4f83e(0xc1)]({'data':{'shopId':_0x297dbf}});}}exports[a59_0x28bfb6(0xa9)]=SettingsService;