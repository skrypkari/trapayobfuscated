'use strict';const a53_0xc53cf9=a53_0x5988;(function(_0x55c3b7,_0x11ae35){const _0x251900=a53_0x5988,_0x44049a=_0x55c3b7();while(!![]){try{const _0x58ec7d=parseInt(_0x251900(0x1b6))/0x1+-parseInt(_0x251900(0x1bf))/0x2+-parseInt(_0x251900(0x1e4))/0x3+-parseInt(_0x251900(0x1af))/0x4+parseInt(_0x251900(0x1cf))/0x5*(parseInt(_0x251900(0x1d1))/0x6)+-parseInt(_0x251900(0x1a9))/0x7*(parseInt(_0x251900(0x1db))/0x8)+parseInt(_0x251900(0x1e0))/0x9;if(_0x58ec7d===_0x11ae35)break;else _0x44049a['push'](_0x44049a['shift']());}catch(_0x1516d8){_0x44049a['push'](_0x44049a['shift']());}}}(a53_0x47f8,0x41ac9));function a53_0x5988(_0x2c9183,_0x3bf4bc){const _0x47f805=a53_0x47f8();return a53_0x5988=function(_0x5988e4,_0x11b4d6){_0x5988e4=_0x5988e4-0x1a7;let _0x473fd6=_0x47f805[_0x5988e4];return _0x473fd6;},a53_0x5988(_0x2c9183,_0x3bf4bc);}var __importDefault=this&&this['__importDefault']||function(_0xf4d56d){return _0xf4d56d&&_0xf4d56d['__esModule']?_0xf4d56d:{'default':_0xf4d56d};};Object[a53_0xc53cf9(0x1a7)](exports,a53_0xc53cf9(0x1e9),{'value':!![]}),exports[a53_0xc53cf9(0x1d3)]=void 0x0;const bcryptjs_1=__importDefault(require(a53_0xc53cf9(0x1d4))),crypto_1=__importDefault(require(a53_0xc53cf9(0x1da))),database_1=__importDefault(require(a53_0xc53cf9(0x1ac)));class SettingsService{[a53_0xc53cf9(0x1bd)](_0x2eb21e){const _0x31edb6=a53_0xc53cf9;if(!_0x2eb21e)return'';if(_0x2eb21e[_0x31edb6(0x1d2)]<=0x8)return _0x2eb21e;const _0x5453a2=_0x2eb21e[_0x31edb6(0x1dc)](0x0,0x8),_0x3e6f95='*'[_0x31edb6(0x1cc)](Math['max'](0x0,_0x2eb21e[_0x31edb6(0x1d2)]-0x8));return _0x5453a2+_0x3e6f95;}[a53_0xc53cf9(0x1d8)](_0x5bbca3){const _0x23fcef=a53_0xc53cf9;if(!_0x5bbca3)return[];if(Array[_0x23fcef(0x1a8)](_0x5bbca3))return _0x5bbca3;if(typeof _0x5bbca3===_0x23fcef(0x1d0))try{const _0x2d0a2d=JSON[_0x23fcef(0x1b2)](_0x5bbca3);return Array[_0x23fcef(0x1a8)](_0x2d0a2d)?_0x2d0a2d:[];}catch{return[];}return[];}async[a53_0xc53cf9(0x1eb)](_0x3a3a02){const _0x17bf3a=a53_0xc53cf9,_0x466af4=await database_1[_0x17bf3a(0x1ce)][_0x17bf3a(0x1e2)]['findUnique']({'where':{'id':_0x3a3a02},'include':{'settings':!![]}});if(!_0x466af4)throw new Error('Shop\x20not\x20found');let _0x53dd12=_0x466af4['settings'];return!_0x53dd12&&(_0x53dd12=await database_1[_0x17bf3a(0x1ce)]['shopSettings'][_0x17bf3a(0x1d6)]({'data':{'shopId':_0x466af4['id']}})),{'fullName':_0x466af4[_0x17bf3a(0x1b7)],'brand':_0x466af4['name'],'merchantUrl':_0x466af4[_0x17bf3a(0x1c5)],'telegramUsername':_0x466af4[_0x17bf3a(0x1ab)],'telegramBotApiKey':_0x53dd12[_0x17bf3a(0x1b1)]?this[_0x17bf3a(0x1bd)](_0x53dd12[_0x17bf3a(0x1b1)]):null,'telegramChatId':_0x53dd12[_0x17bf3a(0x1d7)],'webhookUrl':_0x53dd12[_0x17bf3a(0x1e1)],'webhookEvents':this[_0x17bf3a(0x1d8)](_0x53dd12['webhookEvents']),'notifications':{'payment_success':_0x53dd12['notificationPaymentSuccess'],'payment_failed':_0x53dd12['notificationPaymentFailed'],'refund':_0x53dd12[_0x17bf3a(0x1cb)],'payout':_0x53dd12[_0x17bf3a(0x1c0)],'login':_0x53dd12[_0x17bf3a(0x1e5)],'api_error':_0x53dd12[_0x17bf3a(0x1c7)]}};}async[a53_0xc53cf9(0x1e6)](_0x219fd6,_0x12b83b){const _0x1f9737=a53_0xc53cf9,{currentPassword:_0xc3f5d4,newPassword:_0x503915,confirmNewPassword:_0x4f49b0}=_0x12b83b;if(_0x503915!==_0x4f49b0)throw new Error(_0x1f9737(0x1be));if(_0x503915[_0x1f9737(0x1d2)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x56213=await database_1[_0x1f9737(0x1ce)][_0x1f9737(0x1e2)]['findUnique']({'where':{'id':_0x219fd6},'select':{'password':!![]}});if(!_0x56213)throw new Error(_0x1f9737(0x1b4));const _0x1f0919=await bcryptjs_1[_0x1f9737(0x1ce)][_0x1f9737(0x1de)](_0xc3f5d4,_0x56213[_0x1f9737(0x1c9)]);if(!_0x1f0919)throw new Error(_0x1f9737(0x1e8));const _0x18af76=await bcryptjs_1[_0x1f9737(0x1ce)][_0x1f9737(0x1dd)](_0x503915,0xc);await database_1[_0x1f9737(0x1ce)][_0x1f9737(0x1e2)][_0x1f9737(0x1c3)]({'where':{'id':_0x219fd6},'data':{'password':_0x18af76}});}async[a53_0xc53cf9(0x1df)](_0x55987f,_0x5c4305){const _0x44ba89=a53_0xc53cf9;await this[_0x44ba89(0x1e3)](_0x55987f);const _0x383b22={};_0x5c4305[_0x44ba89(0x1ca)]!==undefined&&(_0x383b22[_0x44ba89(0x1b8)]=_0x5c4305[_0x44ba89(0x1ca)]),_0x5c4305[_0x44ba89(0x1bb)]!==undefined&&(_0x383b22[_0x44ba89(0x1d9)]=_0x5c4305[_0x44ba89(0x1bb)]),_0x5c4305[_0x44ba89(0x1e7)]!==undefined&&(_0x383b22['notificationRefund']=_0x5c4305[_0x44ba89(0x1e7)]),_0x5c4305['payout']!==undefined&&(_0x383b22[_0x44ba89(0x1c0)]=_0x5c4305[_0x44ba89(0x1bc)]),_0x5c4305[_0x44ba89(0x1aa)]!==undefined&&(_0x383b22['notificationLogin']=_0x5c4305[_0x44ba89(0x1aa)]),_0x5c4305[_0x44ba89(0x1b9)]!==undefined&&(_0x383b22['notificationApiError']=_0x5c4305[_0x44ba89(0x1b9)]),await database_1[_0x44ba89(0x1ce)]['shopSettings'][_0x44ba89(0x1c3)]({'where':{'shopId':_0x55987f},'data':_0x383b22});}async[a53_0xc53cf9(0x1b3)](_0x53be0c,_0x25011c){const _0x5ea7ca=a53_0xc53cf9;await this[_0x5ea7ca(0x1e3)](_0x53be0c);const _0x5168db={};_0x25011c[_0x5ea7ca(0x1ea)]!==undefined&&(_0x5168db[_0x5ea7ca(0x1b1)]=_0x25011c[_0x5ea7ca(0x1ea)]||null),_0x25011c[_0x5ea7ca(0x1cd)]!==undefined&&(_0x5168db['telegramChatId']=_0x25011c[_0x5ea7ca(0x1cd)]||null),await database_1[_0x5ea7ca(0x1ce)][_0x5ea7ca(0x1d5)][_0x5ea7ca(0x1c3)]({'where':{'shopId':_0x53be0c},'data':_0x5168db});}async[a53_0xc53cf9(0x1ba)](_0x5adab2,_0x32b396){const _0x310797=a53_0xc53cf9;await this[_0x310797(0x1e3)](_0x5adab2);const _0x701ef3={};_0x32b396['webhookUrl']!==undefined&&(_0x701ef3['webhookUrl']=_0x32b396['webhookUrl']||null),_0x32b396[_0x310797(0x1c4)]!==undefined&&(_0x701ef3[_0x310797(0x1c4)]=_0x32b396['webhookEvents']||[]),await database_1['default'][_0x310797(0x1d5)][_0x310797(0x1c3)]({'where':{'shopId':_0x5adab2},'data':_0x701ef3});}async[a53_0xc53cf9(0x1c1)](_0x57e58e){const _0x21a16b=a53_0xc53cf9,_0x36a703=_0x21a16b(0x1ad)+crypto_1[_0x21a16b(0x1ce)][_0x21a16b(0x1c2)](0x20)[_0x21a16b(0x1b5)](_0x21a16b(0x1c6)),_0x527924='sk_'+crypto_1[_0x21a16b(0x1ce)][_0x21a16b(0x1c2)](0x20)[_0x21a16b(0x1b5)](_0x21a16b(0x1c6));await database_1['default'][_0x21a16b(0x1e2)][_0x21a16b(0x1c3)]({'where':{'id':_0x57e58e},'data':{'publicKey':_0x36a703,'secretKey':_0x527924}});}async[a53_0xc53cf9(0x1c8)](_0x32ac5c,_0x10fff1){const _0x19f1da=a53_0xc53cf9,{passwordConfirmation:_0x3ef610}=_0x10fff1,_0x4b15f0=await database_1[_0x19f1da(0x1ce)][_0x19f1da(0x1e2)][_0x19f1da(0x1ae)]({'where':{'id':_0x32ac5c},'select':{'password':!![]}});if(!_0x4b15f0)throw new Error(_0x19f1da(0x1b4));const _0x5e56f9=await bcryptjs_1['default'][_0x19f1da(0x1de)](_0x3ef610,_0x4b15f0[_0x19f1da(0x1c9)]);if(!_0x5e56f9)throw new Error(_0x19f1da(0x1b0));await database_1[_0x19f1da(0x1ce)][_0x19f1da(0x1e2)]['delete']({'where':{'id':_0x32ac5c}});}async['ensureSettingsExist'](_0x94bdd4){const _0x185a11=a53_0xc53cf9,_0x41b057=await database_1['default']['shopSettings']['findUnique']({'where':{'shopId':_0x94bdd4}});!_0x41b057&&await database_1[_0x185a11(0x1ce)]['shopSettings'][_0x185a11(0x1d6)]({'data':{'shopId':_0x94bdd4}});}}exports['SettingsService']=SettingsService;function a53_0x47f8(){const _0x9ff674=['toString','4928GLUbZb','name','notificationPaymentSuccess','api_error','updateWebhookSettings','payment_failed','payout','maskApiKey','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','949488DIBRQT','notificationPayout','revokeAllApiKeys','randomBytes','update','webhookEvents','shopUrl','hex','notificationApiError','deleteAccount','password','payment_success','notificationRefund','repeat','chatId','default','135FmRyxV','string','106698rixQbM','length','SettingsService','bcryptjs','shopSettings','create','telegramChatId','parseWebhookEvents','notificationPaymentFailed','crypto','2554824oDRLLj','substring','hash','compare','updateNotifications','9847314hcCAyG','webhookUrl','shop','ensureSettingsExist','548319IWkzYs','notificationLogin','changePassword','refund','Current\x20password\x20is\x20incorrect','__esModule','botApiKey','getShopSettings','defineProperty','isArray','7UfQbkB','login','telegram','../config/database','pk_','findUnique','1333376msksnE','Password\x20confirmation\x20is\x20incorrect','telegramBotApiKey','parse','updateTelegramSettings','Shop\x20not\x20found'];a53_0x47f8=function(){return _0x9ff674;};return a53_0x47f8();}