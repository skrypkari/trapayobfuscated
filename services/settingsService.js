'use strict';function a52_0x1314(){const _0x263182=['botApiKey','SettingsService','ensureSettingsExist','length','string','notificationRefund','update','190wmINaS','notificationApiError','1273208zWXPdB','chatId','revokeAllApiKeys','defineProperty','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','substring','updateWebhookSettings','getShopSettings','maskApiKey','sk_','changePassword','payout','login','create','Shop\x20not\x20found','Password\x20confirmation\x20is\x20incorrect','api_error','notificationPaymentSuccess','webhookUrl','name','8059338dJxdNi','payment_failed','590041MrnifK','max','updateNotifications','5054170sESCBS','4034288HbfrWc','repeat','../config/database','__importDefault','shopSettings','3CNlEgi','default','hash','telegramChatId','randomBytes','isArray','152268DyoBQh','7zwbVpl','toString','Current\x20password\x20is\x20incorrect','deleteAccount','parseWebhookEvents','telegramBotApiKey','refund','notificationPaymentFailed','findUnique','pk_','shopUrl','308022CLQdbM','shop','webhookEvents','hex','compare','__esModule','password','parse','payment_success','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','notificationPayout'];a52_0x1314=function(){return _0x263182;};return a52_0x1314();}const a52_0x31dea0=a52_0x8116;(function(_0x1bb6bd,_0x9e81e9){const _0x318847=a52_0x8116,_0xb8571=_0x1bb6bd();while(!![]){try{const _0x54eb23=parseInt(_0x318847(0x1da))/0x1+parseInt(_0x318847(0x1f5))/0x2+-parseInt(_0x318847(0x1e3))/0x3*(-parseInt(_0x318847(0x1de))/0x4)+parseInt(_0x318847(0x207))/0x5*(-parseInt(_0x318847(0x1e9))/0x6)+-parseInt(_0x318847(0x1ea))/0x7*(-parseInt(_0x318847(0x209))/0x8)+-parseInt(_0x318847(0x1d8))/0x9+parseInt(_0x318847(0x1dd))/0xa;if(_0x54eb23===_0x9e81e9)break;else _0xb8571['push'](_0xb8571['shift']());}catch(_0x46ab42){_0xb8571['push'](_0xb8571['shift']());}}}(a52_0x1314,0x88122));var __importDefault=this&&this[a52_0x31dea0(0x1e1)]||function(_0x2a43f8){const _0x4d9540=a52_0x31dea0;return _0x2a43f8&&_0x2a43f8[_0x4d9540(0x1fa)]?_0x2a43f8:{'default':_0x2a43f8};};Object[a52_0x31dea0(0x20c)](exports,'__esModule',{'value':!![]}),exports[a52_0x31dea0(0x201)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a52_0x31dea0(0x1e0)));function a52_0x8116(_0x5e12a9,_0x10366a){const _0x13146e=a52_0x1314();return a52_0x8116=function(_0x81165e,_0x1ffc1b){_0x81165e=_0x81165e-0x1c8;let _0x4083dd=_0x13146e[_0x81165e];return _0x4083dd;},a52_0x8116(_0x5e12a9,_0x10366a);}class SettingsService{[a52_0x31dea0(0x1cc)](_0x29f7a3){const _0xebecb3=a52_0x31dea0;if(!_0x29f7a3)return'';if(_0x29f7a3['length']<=0x8)return _0x29f7a3;const _0x2bde64=_0x29f7a3[_0xebecb3(0x1c9)](0x0,0x8),_0x58bb58='*'[_0xebecb3(0x1df)](Math[_0xebecb3(0x1db)](0x0,_0x29f7a3[_0xebecb3(0x203)]-0x8));return _0x2bde64+_0x58bb58;}[a52_0x31dea0(0x1ee)](_0x306058){const _0x21925e=a52_0x31dea0;if(!_0x306058)return[];if(Array[_0x21925e(0x1e8)](_0x306058))return _0x306058;if(typeof _0x306058===_0x21925e(0x204))try{const _0x541eda=JSON[_0x21925e(0x1fc)](_0x306058);return Array['isArray'](_0x541eda)?_0x541eda:[];}catch{return[];}return[];}async[a52_0x31dea0(0x1cb)](_0x185edf){const _0x354ff8=a52_0x31dea0,_0x47acf3=await database_1[_0x354ff8(0x1e4)]['shop'][_0x354ff8(0x1f2)]({'where':{'id':_0x185edf},'include':{'settings':!![]}});if(!_0x47acf3)throw new Error(_0x354ff8(0x1d2));let _0x3cb252=_0x47acf3['settings'];return!_0x3cb252&&(_0x3cb252=await database_1['default'][_0x354ff8(0x1e2)][_0x354ff8(0x1d1)]({'data':{'shopId':_0x47acf3['id']}})),{'fullName':_0x47acf3[_0x354ff8(0x1d7)],'brand':_0x47acf3[_0x354ff8(0x1d7)],'merchantUrl':_0x47acf3[_0x354ff8(0x1f4)],'telegramUsername':_0x47acf3['telegram'],'telegramBotApiKey':_0x3cb252[_0x354ff8(0x1ef)]?this['maskApiKey'](_0x3cb252[_0x354ff8(0x1ef)]):null,'telegramChatId':_0x3cb252[_0x354ff8(0x1e6)],'webhookUrl':_0x3cb252['webhookUrl'],'webhookEvents':this[_0x354ff8(0x1ee)](_0x3cb252[_0x354ff8(0x1f7)]),'notifications':{'payment_success':_0x3cb252['notificationPaymentSuccess'],'payment_failed':_0x3cb252[_0x354ff8(0x1f1)],'refund':_0x3cb252[_0x354ff8(0x205)],'payout':_0x3cb252['notificationPayout'],'login':_0x3cb252['notificationLogin'],'api_error':_0x3cb252['notificationApiError']}};}async[a52_0x31dea0(0x1ce)](_0x278fe5,_0x5bb24b){const _0x111e4c=a52_0x31dea0,{currentPassword:_0x1d048f,newPassword:_0x830f4f,confirmNewPassword:_0xaa2720}=_0x5bb24b;if(_0x830f4f!==_0xaa2720)throw new Error(_0x111e4c(0x1c8));if(_0x830f4f['length']<0x6)throw new Error(_0x111e4c(0x1fe));const _0x23c74f=await database_1[_0x111e4c(0x1e4)][_0x111e4c(0x1f6)][_0x111e4c(0x1f2)]({'where':{'id':_0x278fe5},'select':{'password':!![]}});if(!_0x23c74f)throw new Error(_0x111e4c(0x1d2));const _0x4b686c=await bcryptjs_1[_0x111e4c(0x1e4)][_0x111e4c(0x1f9)](_0x1d048f,_0x23c74f[_0x111e4c(0x1fb)]);if(!_0x4b686c)throw new Error(_0x111e4c(0x1ec));const _0x7fe023=await bcryptjs_1['default'][_0x111e4c(0x1e5)](_0x830f4f,0xc);await database_1[_0x111e4c(0x1e4)][_0x111e4c(0x1f6)][_0x111e4c(0x206)]({'where':{'id':_0x278fe5},'data':{'password':_0x7fe023}});}async[a52_0x31dea0(0x1dc)](_0x2a8d09,_0x3a167e){const _0x4a1df2=a52_0x31dea0;await this[_0x4a1df2(0x202)](_0x2a8d09);const _0x2dc2ba={};_0x3a167e['payment_success']!==undefined&&(_0x2dc2ba[_0x4a1df2(0x1d5)]=_0x3a167e[_0x4a1df2(0x1fd)]),_0x3a167e[_0x4a1df2(0x1d9)]!==undefined&&(_0x2dc2ba['notificationPaymentFailed']=_0x3a167e[_0x4a1df2(0x1d9)]),_0x3a167e[_0x4a1df2(0x1f0)]!==undefined&&(_0x2dc2ba[_0x4a1df2(0x205)]=_0x3a167e[_0x4a1df2(0x1f0)]),_0x3a167e[_0x4a1df2(0x1cf)]!==undefined&&(_0x2dc2ba[_0x4a1df2(0x1ff)]=_0x3a167e['payout']),_0x3a167e[_0x4a1df2(0x1d0)]!==undefined&&(_0x2dc2ba['notificationLogin']=_0x3a167e[_0x4a1df2(0x1d0)]),_0x3a167e[_0x4a1df2(0x1d4)]!==undefined&&(_0x2dc2ba[_0x4a1df2(0x208)]=_0x3a167e[_0x4a1df2(0x1d4)]),await database_1[_0x4a1df2(0x1e4)]['shopSettings'][_0x4a1df2(0x206)]({'where':{'shopId':_0x2a8d09},'data':_0x2dc2ba});}async['updateTelegramSettings'](_0x18df20,_0x2802a4){const _0x356998=a52_0x31dea0;await this[_0x356998(0x202)](_0x18df20);const _0x159b10={};_0x2802a4[_0x356998(0x200)]!==undefined&&(_0x159b10[_0x356998(0x1ef)]=_0x2802a4[_0x356998(0x200)]||null),_0x2802a4[_0x356998(0x20a)]!==undefined&&(_0x159b10['telegramChatId']=_0x2802a4['chatId']||null),await database_1[_0x356998(0x1e4)][_0x356998(0x1e2)][_0x356998(0x206)]({'where':{'shopId':_0x18df20},'data':_0x159b10});}async[a52_0x31dea0(0x1ca)](_0x599914,_0x99c05d){const _0x5b2075=a52_0x31dea0;await this[_0x5b2075(0x202)](_0x599914);const _0x491b0b={};_0x99c05d[_0x5b2075(0x1d6)]!==undefined&&(_0x491b0b[_0x5b2075(0x1d6)]=_0x99c05d['webhookUrl']||null),_0x99c05d['webhookEvents']!==undefined&&(_0x491b0b[_0x5b2075(0x1f7)]=_0x99c05d['webhookEvents']||[]),await database_1[_0x5b2075(0x1e4)][_0x5b2075(0x1e2)][_0x5b2075(0x206)]({'where':{'shopId':_0x599914},'data':_0x491b0b});}async[a52_0x31dea0(0x20b)](_0x4834b5){const _0xbcde8b=a52_0x31dea0,_0x561b37=_0xbcde8b(0x1f3)+crypto_1[_0xbcde8b(0x1e4)][_0xbcde8b(0x1e7)](0x20)['toString'](_0xbcde8b(0x1f8)),_0x1180e2=_0xbcde8b(0x1cd)+crypto_1[_0xbcde8b(0x1e4)][_0xbcde8b(0x1e7)](0x20)[_0xbcde8b(0x1eb)](_0xbcde8b(0x1f8));await database_1[_0xbcde8b(0x1e4)][_0xbcde8b(0x1f6)][_0xbcde8b(0x206)]({'where':{'id':_0x4834b5},'data':{'publicKey':_0x561b37,'secretKey':_0x1180e2}});}async[a52_0x31dea0(0x1ed)](_0x30ec81,_0x2ed361){const _0x21b4e9=a52_0x31dea0,{passwordConfirmation:_0x51dd4e}=_0x2ed361,_0x22965c=await database_1[_0x21b4e9(0x1e4)][_0x21b4e9(0x1f6)][_0x21b4e9(0x1f2)]({'where':{'id':_0x30ec81},'select':{'password':!![]}});if(!_0x22965c)throw new Error(_0x21b4e9(0x1d2));const _0x2e8a73=await bcryptjs_1[_0x21b4e9(0x1e4)][_0x21b4e9(0x1f9)](_0x51dd4e,_0x22965c[_0x21b4e9(0x1fb)]);if(!_0x2e8a73)throw new Error(_0x21b4e9(0x1d3));await database_1[_0x21b4e9(0x1e4)][_0x21b4e9(0x1f6)]['delete']({'where':{'id':_0x30ec81}});}async[a52_0x31dea0(0x202)](_0x4e831f){const _0x13eb2b=a52_0x31dea0,_0x52a6fc=await database_1[_0x13eb2b(0x1e4)]['shopSettings']['findUnique']({'where':{'shopId':_0x4e831f}});!_0x52a6fc&&await database_1[_0x13eb2b(0x1e4)][_0x13eb2b(0x1e2)][_0x13eb2b(0x1d1)]({'data':{'shopId':_0x4e831f}});}}exports[a52_0x31dea0(0x201)]=SettingsService;