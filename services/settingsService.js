'use strict';const a64_0x464a24=a64_0x43f0;(function(_0x51704a,_0x31a1da){const _0x489a07=a64_0x43f0,_0x565892=_0x51704a();while(!![]){try{const _0x2eba96=-parseInt(_0x489a07(0xfb))/0x1+-parseInt(_0x489a07(0x100))/0x2+parseInt(_0x489a07(0x109))/0x3+parseInt(_0x489a07(0x117))/0x4+parseInt(_0x489a07(0x107))/0x5*(-parseInt(_0x489a07(0x121))/0x6)+-parseInt(_0x489a07(0x127))/0x7*(-parseInt(_0x489a07(0xf5))/0x8)+parseInt(_0x489a07(0x126))/0x9;if(_0x2eba96===_0x31a1da)break;else _0x565892['push'](_0x565892['shift']());}catch(_0x3e2399){_0x565892['push'](_0x565892['shift']());}}}(a64_0x2f8f,0xe7f5e));var __importDefault=this&&this[a64_0x464a24(0x120)]||function(_0xabd042){return _0xabd042&&_0xabd042['__esModule']?_0xabd042:{'default':_0xabd042};};Object[a64_0x464a24(0x11b)](exports,a64_0x464a24(0x111),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a64_0x464a24(0x129))),crypto_1=__importDefault(require(a64_0x464a24(0x103))),database_1=__importDefault(require(a64_0x464a24(0x105)));class SettingsService{[a64_0x464a24(0xfd)](_0xa83fc5){const _0x41d45a=a64_0x464a24;if(!_0xa83fc5)return'';if(_0xa83fc5[_0x41d45a(0xf6)]<=0x8)return _0xa83fc5;const _0x2ee0d2=_0xa83fc5[_0x41d45a(0x11f)](0x0,0x8),_0x14817d='*'['repeat'](Math[_0x41d45a(0x122)](0x0,_0xa83fc5['length']-0x8));return _0x2ee0d2+_0x14817d;}[a64_0x464a24(0x124)](_0x21639a){const _0x1e1fa7=a64_0x464a24;if(!_0x21639a)return[];if(Array[_0x1e1fa7(0x12a)](_0x21639a))return _0x21639a;if(typeof _0x21639a===_0x1e1fa7(0x11a))try{const _0x37084d=JSON[_0x1e1fa7(0xef)](_0x21639a);return Array[_0x1e1fa7(0x12a)](_0x37084d)?_0x37084d:[];}catch{return[];}return[];}async[a64_0x464a24(0x10a)](_0x2d120f){const _0x402f5f=a64_0x464a24,_0x144cb5=await database_1['default'][_0x402f5f(0x113)][_0x402f5f(0x101)]({'where':{'id':_0x2d120f},'include':{'settings':!![]}});if(!_0x144cb5)throw new Error(_0x402f5f(0x128));let _0x5944df=_0x144cb5[_0x402f5f(0x102)];return!_0x5944df&&(_0x5944df=await database_1[_0x402f5f(0x110)][_0x402f5f(0xf4)]['create']({'data':{'shopId':_0x144cb5['id']}})),{'fullName':_0x144cb5['name'],'brand':_0x144cb5['name'],'merchantUrl':_0x144cb5['shopUrl'],'telegramUsername':_0x144cb5[_0x402f5f(0x115)],'telegramBotApiKey':_0x5944df['telegramBotApiKey']?this[_0x402f5f(0xfd)](_0x5944df['telegramBotApiKey']):null,'telegramChatId':_0x5944df[_0x402f5f(0x104)],'webhookUrl':_0x5944df[_0x402f5f(0x114)],'webhookEvents':this[_0x402f5f(0x124)](_0x5944df[_0x402f5f(0xfa)]),'notifications':{'payment_success':_0x5944df[_0x402f5f(0x10d)],'payment_failed':_0x5944df[_0x402f5f(0xf7)],'refund':_0x5944df[_0x402f5f(0x10b)],'payout':_0x5944df[_0x402f5f(0x123)],'login':_0x5944df['notificationLogin'],'api_error':_0x5944df[_0x402f5f(0x108)]}};}async['changePassword'](_0x2bf0a4,_0x9fc4c4){const _0x4e7722=a64_0x464a24,{currentPassword:_0x12ae40,newPassword:_0x21932d,confirmNewPassword:_0x1a4506}=_0x9fc4c4;if(_0x21932d!==_0x1a4506)throw new Error(_0x4e7722(0x125));if(_0x21932d['length']<0x6)throw new Error(_0x4e7722(0x106));const _0xa91d9=await database_1[_0x4e7722(0x110)][_0x4e7722(0x113)][_0x4e7722(0x101)]({'where':{'id':_0x2bf0a4},'select':{'password':!![]}});if(!_0xa91d9)throw new Error(_0x4e7722(0x128));const _0xcb1a79=await bcryptjs_1['default']['compare'](_0x12ae40,_0xa91d9[_0x4e7722(0x118)]);if(!_0xcb1a79)throw new Error('Current\x20password\x20is\x20incorrect');const _0x9b83a=await bcryptjs_1[_0x4e7722(0x110)]['hash'](_0x21932d,0xc);await database_1['default'][_0x4e7722(0x113)][_0x4e7722(0xfc)]({'where':{'id':_0x2bf0a4},'data':{'password':_0x9b83a}});}async[a64_0x464a24(0x12e)](_0x3fe60e,_0x47949c){const _0x57735c=a64_0x464a24;await this['ensureSettingsExist'](_0x3fe60e);const _0x1d3c68={};_0x47949c['payment_success']!==undefined&&(_0x1d3c68[_0x57735c(0x10d)]=_0x47949c[_0x57735c(0x11d)]),_0x47949c[_0x57735c(0x116)]!==undefined&&(_0x1d3c68[_0x57735c(0xf7)]=_0x47949c[_0x57735c(0x116)]),_0x47949c[_0x57735c(0xf9)]!==undefined&&(_0x1d3c68['notificationRefund']=_0x47949c[_0x57735c(0xf9)]),_0x47949c['payout']!==undefined&&(_0x1d3c68['notificationPayout']=_0x47949c['payout']),_0x47949c[_0x57735c(0xf0)]!==undefined&&(_0x1d3c68['notificationLogin']=_0x47949c[_0x57735c(0xf0)]),_0x47949c[_0x57735c(0x10e)]!==undefined&&(_0x1d3c68[_0x57735c(0x108)]=_0x47949c[_0x57735c(0x10e)]),await database_1[_0x57735c(0x110)][_0x57735c(0xf4)][_0x57735c(0xfc)]({'where':{'shopId':_0x3fe60e},'data':_0x1d3c68});}async[a64_0x464a24(0xee)](_0x23aea6,_0x19de11){const _0x4a274d=a64_0x464a24;await this[_0x4a274d(0x12b)](_0x23aea6);const _0x45fe8a={};_0x19de11[_0x4a274d(0xfe)]!==undefined&&(_0x45fe8a[_0x4a274d(0xff)]=_0x19de11[_0x4a274d(0xfe)]||null),_0x19de11[_0x4a274d(0xf3)]!==undefined&&(_0x45fe8a[_0x4a274d(0x104)]=_0x19de11['chatId']||null),await database_1[_0x4a274d(0x110)]['shopSettings'][_0x4a274d(0xfc)]({'where':{'shopId':_0x23aea6},'data':_0x45fe8a});}async[a64_0x464a24(0x11c)](_0x2cd07c,_0x404e44){const _0x2a09d5=a64_0x464a24;await this[_0x2a09d5(0x12b)](_0x2cd07c);const _0xb32161={};_0x404e44[_0x2a09d5(0x114)]!==undefined&&(_0xb32161[_0x2a09d5(0x114)]=_0x404e44[_0x2a09d5(0x114)]||null),_0x404e44[_0x2a09d5(0xfa)]!==undefined&&(_0xb32161[_0x2a09d5(0xfa)]=_0x404e44[_0x2a09d5(0xfa)]||[]),await database_1[_0x2a09d5(0x110)][_0x2a09d5(0xf4)][_0x2a09d5(0xfc)]({'where':{'shopId':_0x2cd07c},'data':_0xb32161});}async[a64_0x464a24(0x11e)](_0x1fe4db){const _0x1d51b7=a64_0x464a24,_0x5b7e84=_0x1d51b7(0xf1)+crypto_1[_0x1d51b7(0x110)][_0x1d51b7(0x10c)](0x20)[_0x1d51b7(0x12c)](_0x1d51b7(0x10f)),_0xfa40ef=_0x1d51b7(0x119)+crypto_1['default'][_0x1d51b7(0x10c)](0x20)['toString'](_0x1d51b7(0x10f));await database_1[_0x1d51b7(0x110)][_0x1d51b7(0x113)]['update']({'where':{'id':_0x1fe4db},'data':{'publicKey':_0x5b7e84,'secretKey':_0xfa40ef}});}async[a64_0x464a24(0x112)](_0x20769b,_0x5d37e3){const _0xae973b=a64_0x464a24,{passwordConfirmation:_0x54e5a9}=_0x5d37e3,_0x40bb8b=await database_1[_0xae973b(0x110)][_0xae973b(0x113)][_0xae973b(0x101)]({'where':{'id':_0x20769b},'select':{'password':!![]}});if(!_0x40bb8b)throw new Error('Shop\x20not\x20found');const _0x2f1d7e=await bcryptjs_1[_0xae973b(0x110)]['compare'](_0x54e5a9,_0x40bb8b[_0xae973b(0x118)]);if(!_0x2f1d7e)throw new Error(_0xae973b(0x12d));await database_1[_0xae973b(0x110)][_0xae973b(0x113)][_0xae973b(0xf8)]({'where':{'id':_0x20769b}});}async['ensureSettingsExist'](_0x135c04){const _0x2cd542=a64_0x464a24,_0x1c0dd5=await database_1[_0x2cd542(0x110)][_0x2cd542(0xf4)][_0x2cd542(0x101)]({'where':{'shopId':_0x135c04}});!_0x1c0dd5&&await database_1[_0x2cd542(0x110)][_0x2cd542(0xf4)]['create']({'data':{'shopId':_0x135c04}});}}function a64_0x43f0(_0x352e8f,_0x89d9dd){const _0x2f8f6b=a64_0x2f8f();return a64_0x43f0=function(_0x43f0b0,_0x346633){_0x43f0b0=_0x43f0b0-0xee;let _0x2c60e8=_0x2f8f6b[_0x43f0b0];return _0x2c60e8;},a64_0x43f0(_0x352e8f,_0x89d9dd);}function a64_0x2f8f(){const _0x371e47=['ensureSettingsExist','toString','Password\x20confirmation\x20is\x20incorrect','updateNotifications','updateTelegramSettings','parse','login','pk_','SettingsService','chatId','shopSettings','8dcsmRf','length','notificationPaymentFailed','delete','refund','webhookEvents','1317182WbvAei','update','maskApiKey','botApiKey','telegramBotApiKey','1121588bFOnyZ','findUnique','settings','crypto','telegramChatId','../config/database','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','4885nvAvAn','notificationApiError','3254958oPEupT','getShopSettings','notificationRefund','randomBytes','notificationPaymentSuccess','api_error','hex','default','__esModule','deleteAccount','shop','webhookUrl','telegram','payment_failed','2224392eBjxRA','password','sk_','string','defineProperty','updateWebhookSettings','payment_success','revokeAllApiKeys','substring','__importDefault','9636TrcUdU','max','notificationPayout','parseWebhookEvents','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','17879949PxhDkK','5385821MWjXqb','Shop\x20not\x20found','bcryptjs','isArray'];a64_0x2f8f=function(){return _0x371e47;};return a64_0x2f8f();}exports[a64_0x464a24(0xf2)]=SettingsService;