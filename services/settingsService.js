'use strict';const a47_0x31de67=a47_0x5bef;function a47_0x5bef(_0x4366af,_0x139b45){const _0x264cd2=a47_0x264c();return a47_0x5bef=function(_0x5bef37,_0x58cc19){_0x5bef37=_0x5bef37-0x1ec;let _0x5ee755=_0x264cd2[_0x5bef37];return _0x5ee755;},a47_0x5bef(_0x4366af,_0x139b45);}(function(_0x434e56,_0x48975b){const _0x1c2352=a47_0x5bef,_0x2db954=_0x434e56();while(!![]){try{const _0x5c74e3=parseInt(_0x1c2352(0x21f))/0x1*(parseInt(_0x1c2352(0x20b))/0x2)+-parseInt(_0x1c2352(0x226))/0x3+parseInt(_0x1c2352(0x22d))/0x4*(-parseInt(_0x1c2352(0x228))/0x5)+-parseInt(_0x1c2352(0x212))/0x6*(parseInt(_0x1c2352(0x21c))/0x7)+parseInt(_0x1c2352(0x1ee))/0x8*(-parseInt(_0x1c2352(0x20a))/0x9)+parseInt(_0x1c2352(0x21a))/0xa+parseInt(_0x1c2352(0x1f7))/0xb;if(_0x5c74e3===_0x48975b)break;else _0x2db954['push'](_0x2db954['shift']());}catch(_0x1284e8){_0x2db954['push'](_0x2db954['shift']());}}}(a47_0x264c,0xed75f));function a47_0x264c(){const _0x1c0ee7=['payment_success','notificationApiError','Password\x20confirmation\x20is\x20incorrect','11547129eSJuDz','notificationPayout','shopSettings','changePassword','shopUrl','isArray','__importDefault','deleteAccount','length','hex','parse','defineProperty','refund','bcryptjs','payout','sk_','pk_','string','randomBytes','855raiWmQ','4FRQujT','crypto','ensureSettingsExist','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','botApiKey','compare','../config/database','7940274VfSNQB','name','telegramBotApiKey','login','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','notificationRefund','password','toString','15816070XUQtdF','hash','7VsmRqa','api_error','notificationPaymentFailed','682003rqIpQw','getShopSettings','shop','Shop\x20not\x20found','substring','__esModule','notificationLogin','48066bKmgXD','maskApiKey','5ydBbeM','webhookUrl','parseWebhookEvents','notificationPaymentSuccess','default','5466328FeSixx','webhookEvents','SettingsService','update','chatId','findUnique','updateNotifications','26672vyZGjf','revokeAllApiKeys','Current\x20password\x20is\x20incorrect','telegram','create','delete'];a47_0x264c=function(){return _0x1c0ee7;};return a47_0x264c();}var __importDefault=this&&this[a47_0x31de67(0x1fd)]||function(_0x2fc8b3){return _0x2fc8b3&&_0x2fc8b3['__esModule']?_0x2fc8b3:{'default':_0x2fc8b3};};Object[a47_0x31de67(0x202)](exports,a47_0x31de67(0x224),{'value':!![]}),exports[a47_0x31de67(0x22f)]=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x31de67(0x204))),crypto_1=__importDefault(require(a47_0x31de67(0x20c))),database_1=__importDefault(require(a47_0x31de67(0x211)));class SettingsService{[a47_0x31de67(0x227)](_0x117ff4){const _0x168938=a47_0x31de67;if(!_0x117ff4)return'';if(_0x117ff4['length']<=0x8)return _0x117ff4;const _0xc5a426=_0x117ff4[_0x168938(0x223)](0x0,0x8),_0x2c6f3b='*'['repeat'](Math['max'](0x0,_0x117ff4[_0x168938(0x1ff)]-0x8));return _0xc5a426+_0x2c6f3b;}[a47_0x31de67(0x22a)](_0x4a2d30){const _0x294075=a47_0x31de67;if(!_0x4a2d30)return[];if(Array['isArray'](_0x4a2d30))return _0x4a2d30;if(typeof _0x4a2d30===_0x294075(0x208))try{const _0x125734=JSON[_0x294075(0x201)](_0x4a2d30);return Array[_0x294075(0x1fc)](_0x125734)?_0x125734:[];}catch{return[];}return[];}async[a47_0x31de67(0x220)](_0x45b01b){const _0x4b9206=a47_0x31de67,_0xd0b9b6=await database_1[_0x4b9206(0x22c)]['shop'][_0x4b9206(0x1ec)]({'where':{'id':_0x45b01b},'include':{'settings':!![]}});if(!_0xd0b9b6)throw new Error(_0x4b9206(0x222));let _0x30f0eb=_0xd0b9b6['settings'];return!_0x30f0eb&&(_0x30f0eb=await database_1['default'][_0x4b9206(0x1f9)][_0x4b9206(0x1f2)]({'data':{'shopId':_0xd0b9b6['id']}})),{'fullName':_0xd0b9b6[_0x4b9206(0x213)],'brand':_0xd0b9b6[_0x4b9206(0x213)],'merchantUrl':_0xd0b9b6[_0x4b9206(0x1fb)],'telegramUsername':_0xd0b9b6[_0x4b9206(0x1f1)],'telegramBotApiKey':_0x30f0eb[_0x4b9206(0x214)]?this[_0x4b9206(0x227)](_0x30f0eb[_0x4b9206(0x214)]):null,'telegramChatId':_0x30f0eb['telegramChatId'],'webhookUrl':_0x30f0eb[_0x4b9206(0x229)],'webhookEvents':this[_0x4b9206(0x22a)](_0x30f0eb[_0x4b9206(0x22e)]),'notifications':{'payment_success':_0x30f0eb[_0x4b9206(0x22b)],'payment_failed':_0x30f0eb[_0x4b9206(0x21e)],'refund':_0x30f0eb[_0x4b9206(0x217)],'payout':_0x30f0eb['notificationPayout'],'login':_0x30f0eb['notificationLogin'],'api_error':_0x30f0eb['notificationApiError']}};}async[a47_0x31de67(0x1fa)](_0x1e4e96,_0x92714f){const _0x2205dc=a47_0x31de67,{currentPassword:_0x29da19,newPassword:_0x26f5c5,confirmNewPassword:_0x596f48}=_0x92714f;if(_0x26f5c5!==_0x596f48)throw new Error(_0x2205dc(0x216));if(_0x26f5c5['length']<0x6)throw new Error(_0x2205dc(0x20e));const _0x3064f2=await database_1[_0x2205dc(0x22c)][_0x2205dc(0x221)][_0x2205dc(0x1ec)]({'where':{'id':_0x1e4e96},'select':{'password':!![]}});if(!_0x3064f2)throw new Error(_0x2205dc(0x222));const _0x56bd11=await bcryptjs_1[_0x2205dc(0x22c)][_0x2205dc(0x210)](_0x29da19,_0x3064f2[_0x2205dc(0x218)]);if(!_0x56bd11)throw new Error(_0x2205dc(0x1f0));const _0x159905=await bcryptjs_1[_0x2205dc(0x22c)][_0x2205dc(0x21b)](_0x26f5c5,0xc);await database_1['default'][_0x2205dc(0x221)]['update']({'where':{'id':_0x1e4e96},'data':{'password':_0x159905}});}async[a47_0x31de67(0x1ed)](_0x21d2f4,_0x78e07a){const _0x4a476d=a47_0x31de67;await this[_0x4a476d(0x20d)](_0x21d2f4);const _0x44a906={};_0x78e07a[_0x4a476d(0x1f4)]!==undefined&&(_0x44a906[_0x4a476d(0x22b)]=_0x78e07a[_0x4a476d(0x1f4)]),_0x78e07a['payment_failed']!==undefined&&(_0x44a906['notificationPaymentFailed']=_0x78e07a['payment_failed']),_0x78e07a['refund']!==undefined&&(_0x44a906[_0x4a476d(0x217)]=_0x78e07a[_0x4a476d(0x203)]),_0x78e07a[_0x4a476d(0x205)]!==undefined&&(_0x44a906[_0x4a476d(0x1f8)]=_0x78e07a[_0x4a476d(0x205)]),_0x78e07a[_0x4a476d(0x215)]!==undefined&&(_0x44a906[_0x4a476d(0x225)]=_0x78e07a[_0x4a476d(0x215)]),_0x78e07a[_0x4a476d(0x21d)]!==undefined&&(_0x44a906[_0x4a476d(0x1f5)]=_0x78e07a[_0x4a476d(0x21d)]),await database_1[_0x4a476d(0x22c)][_0x4a476d(0x1f9)][_0x4a476d(0x230)]({'where':{'shopId':_0x21d2f4},'data':_0x44a906});}async['updateTelegramSettings'](_0x18d853,_0x54c649){const _0x44bf5d=a47_0x31de67;await this[_0x44bf5d(0x20d)](_0x18d853);const _0x32dd27={};_0x54c649[_0x44bf5d(0x20f)]!==undefined&&(_0x32dd27[_0x44bf5d(0x214)]=_0x54c649[_0x44bf5d(0x20f)]||null),_0x54c649[_0x44bf5d(0x231)]!==undefined&&(_0x32dd27['telegramChatId']=_0x54c649[_0x44bf5d(0x231)]||null),await database_1[_0x44bf5d(0x22c)][_0x44bf5d(0x1f9)]['update']({'where':{'shopId':_0x18d853},'data':_0x32dd27});}async['updateWebhookSettings'](_0x853c0a,_0xa54547){const _0x434eff=a47_0x31de67;await this[_0x434eff(0x20d)](_0x853c0a);const _0x5359b7={};_0xa54547[_0x434eff(0x229)]!==undefined&&(_0x5359b7['webhookUrl']=_0xa54547['webhookUrl']||null),_0xa54547[_0x434eff(0x22e)]!==undefined&&(_0x5359b7[_0x434eff(0x22e)]=_0xa54547[_0x434eff(0x22e)]||[]),await database_1[_0x434eff(0x22c)]['shopSettings']['update']({'where':{'shopId':_0x853c0a},'data':_0x5359b7});}async[a47_0x31de67(0x1ef)](_0x1e96fd){const _0x459761=a47_0x31de67,_0x33f3ea=_0x459761(0x207)+crypto_1[_0x459761(0x22c)][_0x459761(0x209)](0x20)['toString'](_0x459761(0x200)),_0xf84c9b=_0x459761(0x206)+crypto_1['default'][_0x459761(0x209)](0x20)[_0x459761(0x219)](_0x459761(0x200));await database_1['default'][_0x459761(0x221)]['update']({'where':{'id':_0x1e96fd},'data':{'publicKey':_0x33f3ea,'secretKey':_0xf84c9b}});}async[a47_0x31de67(0x1fe)](_0xd15a55,_0x57ae26){const _0x129de5=a47_0x31de67,{passwordConfirmation:_0x3f6162}=_0x57ae26,_0x1a3c71=await database_1[_0x129de5(0x22c)]['shop'][_0x129de5(0x1ec)]({'where':{'id':_0xd15a55},'select':{'password':!![]}});if(!_0x1a3c71)throw new Error('Shop\x20not\x20found');const _0x7efd9f=await bcryptjs_1['default'][_0x129de5(0x210)](_0x3f6162,_0x1a3c71[_0x129de5(0x218)]);if(!_0x7efd9f)throw new Error(_0x129de5(0x1f6));await database_1[_0x129de5(0x22c)][_0x129de5(0x221)][_0x129de5(0x1f3)]({'where':{'id':_0xd15a55}});}async[a47_0x31de67(0x20d)](_0x4fcfc4){const _0x3de751=a47_0x31de67,_0x4cd541=await database_1[_0x3de751(0x22c)][_0x3de751(0x1f9)][_0x3de751(0x1ec)]({'where':{'shopId':_0x4fcfc4}});!_0x4cd541&&await database_1[_0x3de751(0x22c)][_0x3de751(0x1f9)]['create']({'data':{'shopId':_0x4fcfc4}});}}exports[a47_0x31de67(0x22f)]=SettingsService;