'use strict';const a52_0x2eab2c=a52_0x237d;(function(_0x47e2c0,_0x18b1d2){const _0x4c97ea=a52_0x237d,_0xbef11b=_0x47e2c0();while(!![]){try{const _0x38b45a=-parseInt(_0x4c97ea(0x1d5))/0x1*(-parseInt(_0x4c97ea(0x1f9))/0x2)+-parseInt(_0x4c97ea(0x1fc))/0x3+parseInt(_0x4c97ea(0x202))/0x4*(-parseInt(_0x4c97ea(0x1d7))/0x5)+-parseInt(_0x4c97ea(0x1ff))/0x6+parseInt(_0x4c97ea(0x1e6))/0x7*(-parseInt(_0x4c97ea(0x1ea))/0x8)+-parseInt(_0x4c97ea(0x1e4))/0x9+parseInt(_0x4c97ea(0x213))/0xa;if(_0x38b45a===_0x18b1d2)break;else _0xbef11b['push'](_0xbef11b['shift']());}catch(_0x10746c){_0xbef11b['push'](_0xbef11b['shift']());}}}(a52_0x133d,0x687b1));function a52_0x133d(){const _0x7896ea=['crypto','shop','412OcKwSa','notificationPaymentFailed','toString','telegramBotApiKey','webhookUrl','length','parseWebhookEvents','../config/database','Password\x20confirmation\x20is\x20incorrect','defineProperty','substring','notificationRefund','ensureSettingsExist','getShopSettings','refund','delete','updateWebhookSettings','18685500ZYWBLG','notificationPaymentSuccess','findUnique','__esModule','notificationPayout','create','__importDefault','6277aIDKBq','default','9010XbyCan','botApiKey','login','telegramChatId','payout','Current\x20password\x20is\x20incorrect','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','notificationLogin','sk_','maskApiKey','shopUrl','max','randomBytes','1038267WRivuc','settings','21cOuOZn','updateNotifications','webhookEvents','api_error','1642288bZUvUD','changePassword','payment_success','update','SettingsService','shopSettings','isArray','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','parse','payment_failed','pk_','chatId','password','updateTelegramSettings','string','106iydnGF','name','Shop\x20not\x20found','341064nEOYeE','compare','deleteAccount','4456578sxTfCI'];a52_0x133d=function(){return _0x7896ea;};return a52_0x133d();}function a52_0x237d(_0x44166d,_0x505d0a){const _0x133db2=a52_0x133d();return a52_0x237d=function(_0x237dba,_0x23a72a){_0x237dba=_0x237dba-0x1d2;let _0x438a0e=_0x133db2[_0x237dba];return _0x438a0e;},a52_0x237d(_0x44166d,_0x505d0a);}var __importDefault=this&&this[a52_0x2eab2c(0x1d4)]||function(_0x408ef9){return _0x408ef9&&_0x408ef9['__esModule']?_0x408ef9:{'default':_0x408ef9};};Object[a52_0x2eab2c(0x20b)](exports,a52_0x2eab2c(0x216),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a52_0x2eab2c(0x200))),database_1=__importDefault(require(a52_0x2eab2c(0x209)));class SettingsService{[a52_0x2eab2c(0x1e0)](_0x5ed5b0){const _0x57c7b5=a52_0x2eab2c;if(!_0x5ed5b0)return'';if(_0x5ed5b0[_0x57c7b5(0x207)]<=0x8)return _0x5ed5b0;const _0x4fb26b=_0x5ed5b0[_0x57c7b5(0x20c)](0x0,0x8),_0x29fa9e='*'['repeat'](Math[_0x57c7b5(0x1e2)](0x0,_0x5ed5b0[_0x57c7b5(0x207)]-0x8));return _0x4fb26b+_0x29fa9e;}[a52_0x2eab2c(0x208)](_0x18b3c2){const _0x2c9852=a52_0x2eab2c;if(!_0x18b3c2)return[];if(Array[_0x2c9852(0x1f0)](_0x18b3c2))return _0x18b3c2;if(typeof _0x18b3c2===_0x2c9852(0x1f8))try{const _0x5abc5d=JSON[_0x2c9852(0x1f2)](_0x18b3c2);return Array[_0x2c9852(0x1f0)](_0x5abc5d)?_0x5abc5d:[];}catch{return[];}return[];}async[a52_0x2eab2c(0x20f)](_0x3ea7d0){const _0x3636bc=a52_0x2eab2c,_0x2cad7c=await database_1['default'][_0x3636bc(0x201)][_0x3636bc(0x215)]({'where':{'id':_0x3ea7d0},'include':{'settings':!![]}});if(!_0x2cad7c)throw new Error(_0x3636bc(0x1fb));let _0x123e79=_0x2cad7c[_0x3636bc(0x1e5)];return!_0x123e79&&(_0x123e79=await database_1[_0x3636bc(0x1d6)]['shopSettings'][_0x3636bc(0x1d3)]({'data':{'shopId':_0x2cad7c['id']}})),{'fullName':_0x2cad7c[_0x3636bc(0x1fa)],'brand':_0x2cad7c[_0x3636bc(0x1fa)],'merchantUrl':_0x2cad7c[_0x3636bc(0x1e1)],'telegramUsername':_0x2cad7c['telegram'],'telegramBotApiKey':_0x123e79[_0x3636bc(0x205)]?this['maskApiKey'](_0x123e79[_0x3636bc(0x205)]):null,'telegramChatId':_0x123e79[_0x3636bc(0x1da)],'webhookUrl':_0x123e79['webhookUrl'],'webhookEvents':this['parseWebhookEvents'](_0x123e79[_0x3636bc(0x1e8)]),'notifications':{'payment_success':_0x123e79[_0x3636bc(0x214)],'payment_failed':_0x123e79[_0x3636bc(0x203)],'refund':_0x123e79[_0x3636bc(0x20d)],'payout':_0x123e79[_0x3636bc(0x1d2)],'login':_0x123e79[_0x3636bc(0x1de)],'api_error':_0x123e79['notificationApiError']}};}async[a52_0x2eab2c(0x1eb)](_0x266bd4,_0x4d0b6e){const _0x3f9539=a52_0x2eab2c,{currentPassword:_0x3a41b7,newPassword:_0x168eab,confirmNewPassword:_0x53034a}=_0x4d0b6e;if(_0x168eab!==_0x53034a)throw new Error(_0x3f9539(0x1f1));if(_0x168eab[_0x3f9539(0x207)]<0x6)throw new Error(_0x3f9539(0x1dd));const _0x378366=await database_1[_0x3f9539(0x1d6)][_0x3f9539(0x201)][_0x3f9539(0x215)]({'where':{'id':_0x266bd4},'select':{'password':!![]}});if(!_0x378366)throw new Error(_0x3f9539(0x1fb));const _0x2b77c9=await bcryptjs_1[_0x3f9539(0x1d6)][_0x3f9539(0x1fd)](_0x3a41b7,_0x378366[_0x3f9539(0x1f6)]);if(!_0x2b77c9)throw new Error(_0x3f9539(0x1dc));const _0x19e7bc=await bcryptjs_1[_0x3f9539(0x1d6)]['hash'](_0x168eab,0xc);await database_1[_0x3f9539(0x1d6)][_0x3f9539(0x201)][_0x3f9539(0x1ed)]({'where':{'id':_0x266bd4},'data':{'password':_0x19e7bc}});}async[a52_0x2eab2c(0x1e7)](_0x4ffb20,_0x447295){const _0x12b093=a52_0x2eab2c;await this[_0x12b093(0x20e)](_0x4ffb20);const _0xf124df={};_0x447295[_0x12b093(0x1ec)]!==undefined&&(_0xf124df[_0x12b093(0x214)]=_0x447295[_0x12b093(0x1ec)]),_0x447295[_0x12b093(0x1f3)]!==undefined&&(_0xf124df[_0x12b093(0x203)]=_0x447295[_0x12b093(0x1f3)]),_0x447295[_0x12b093(0x210)]!==undefined&&(_0xf124df[_0x12b093(0x20d)]=_0x447295[_0x12b093(0x210)]),_0x447295[_0x12b093(0x1db)]!==undefined&&(_0xf124df[_0x12b093(0x1d2)]=_0x447295[_0x12b093(0x1db)]),_0x447295[_0x12b093(0x1d9)]!==undefined&&(_0xf124df[_0x12b093(0x1de)]=_0x447295[_0x12b093(0x1d9)]),_0x447295[_0x12b093(0x1e9)]!==undefined&&(_0xf124df['notificationApiError']=_0x447295[_0x12b093(0x1e9)]),await database_1[_0x12b093(0x1d6)][_0x12b093(0x1ef)][_0x12b093(0x1ed)]({'where':{'shopId':_0x4ffb20},'data':_0xf124df});}async[a52_0x2eab2c(0x1f7)](_0x2b3c27,_0x50b6d7){const _0x2d22ab=a52_0x2eab2c;await this[_0x2d22ab(0x20e)](_0x2b3c27);const _0x5a2b97={};_0x50b6d7[_0x2d22ab(0x1d8)]!==undefined&&(_0x5a2b97['telegramBotApiKey']=_0x50b6d7[_0x2d22ab(0x1d8)]||null),_0x50b6d7[_0x2d22ab(0x1f5)]!==undefined&&(_0x5a2b97[_0x2d22ab(0x1da)]=_0x50b6d7[_0x2d22ab(0x1f5)]||null),await database_1[_0x2d22ab(0x1d6)][_0x2d22ab(0x1ef)][_0x2d22ab(0x1ed)]({'where':{'shopId':_0x2b3c27},'data':_0x5a2b97});}async[a52_0x2eab2c(0x212)](_0xb59095,_0x3b5e5c){const _0x3db39d=a52_0x2eab2c;await this[_0x3db39d(0x20e)](_0xb59095);const _0x4bb1d6={};_0x3b5e5c[_0x3db39d(0x206)]!==undefined&&(_0x4bb1d6['webhookUrl']=_0x3b5e5c['webhookUrl']||null),_0x3b5e5c[_0x3db39d(0x1e8)]!==undefined&&(_0x4bb1d6[_0x3db39d(0x1e8)]=_0x3b5e5c[_0x3db39d(0x1e8)]||[]),await database_1[_0x3db39d(0x1d6)]['shopSettings']['update']({'where':{'shopId':_0xb59095},'data':_0x4bb1d6});}async['revokeAllApiKeys'](_0x507c3a){const _0x361823=a52_0x2eab2c,_0x4941af=_0x361823(0x1f4)+crypto_1[_0x361823(0x1d6)][_0x361823(0x1e3)](0x20)[_0x361823(0x204)]('hex'),_0x1c01ce=_0x361823(0x1df)+crypto_1[_0x361823(0x1d6)][_0x361823(0x1e3)](0x20)[_0x361823(0x204)]('hex');await database_1[_0x361823(0x1d6)][_0x361823(0x201)][_0x361823(0x1ed)]({'where':{'id':_0x507c3a},'data':{'publicKey':_0x4941af,'secretKey':_0x1c01ce}});}async[a52_0x2eab2c(0x1fe)](_0x1d33b9,_0x97978e){const _0x58a4e7=a52_0x2eab2c,{passwordConfirmation:_0x4c3ad5}=_0x97978e,_0x3c6b72=await database_1[_0x58a4e7(0x1d6)][_0x58a4e7(0x201)][_0x58a4e7(0x215)]({'where':{'id':_0x1d33b9},'select':{'password':!![]}});if(!_0x3c6b72)throw new Error(_0x58a4e7(0x1fb));const _0x964167=await bcryptjs_1[_0x58a4e7(0x1d6)]['compare'](_0x4c3ad5,_0x3c6b72[_0x58a4e7(0x1f6)]);if(!_0x964167)throw new Error(_0x58a4e7(0x20a));await database_1[_0x58a4e7(0x1d6)][_0x58a4e7(0x201)][_0x58a4e7(0x211)]({'where':{'id':_0x1d33b9}});}async[a52_0x2eab2c(0x20e)](_0x3b3d2e){const _0x2dea27=a52_0x2eab2c,_0x1b3f69=await database_1['default'][_0x2dea27(0x1ef)][_0x2dea27(0x215)]({'where':{'shopId':_0x3b3d2e}});!_0x1b3f69&&await database_1['default'][_0x2dea27(0x1ef)][_0x2dea27(0x1d3)]({'data':{'shopId':_0x3b3d2e}});}}exports[a52_0x2eab2c(0x1ee)]=SettingsService;