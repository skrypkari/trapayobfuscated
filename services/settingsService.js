'use strict';function a57_0x5bde(_0x1f4dc2,_0x2e033a){const _0x5d76f5=a57_0x5d76();return a57_0x5bde=function(_0x5bde6b,_0x3bbbd4){_0x5bde6b=_0x5bde6b-0x105;let _0x2ee7d9=_0x5d76f5[_0x5bde6b];return _0x2ee7d9;},a57_0x5bde(_0x1f4dc2,_0x2e033a);}const a57_0xfeb557=a57_0x5bde;(function(_0x46aa03,_0x2f8e81){const _0xd886dc=a57_0x5bde,_0x1c9602=_0x46aa03();while(!![]){try{const _0x4d631b=-parseInt(_0xd886dc(0x12f))/0x1*(parseInt(_0xd886dc(0x144))/0x2)+-parseInt(_0xd886dc(0x135))/0x3*(parseInt(_0xd886dc(0x12b))/0x4)+-parseInt(_0xd886dc(0x11f))/0x5+parseInt(_0xd886dc(0x136))/0x6*(-parseInt(_0xd886dc(0x105))/0x7)+parseInt(_0xd886dc(0x115))/0x8+-parseInt(_0xd886dc(0x117))/0x9+-parseInt(_0xd886dc(0x141))/0xa*(-parseInt(_0xd886dc(0x11b))/0xb);if(_0x4d631b===_0x2f8e81)break;else _0x1c9602['push'](_0x1c9602['shift']());}catch(_0xb2e427){_0x1c9602['push'](_0x1c9602['shift']());}}}(a57_0x5d76,0x1f95d));var __importDefault=this&&this[a57_0xfeb557(0x129)]||function(_0x1d0ecd){return _0x1d0ecd&&_0x1d0ecd['__esModule']?_0x1d0ecd:{'default':_0x1d0ecd};};function a57_0x5d76(){const _0x345024=['shopSettings','delete','374YSZkRF','api_error','update','SettingsService','827365xBIOdB','deleteAccount','hex','parseWebhookEvents','ensureSettingsExist','max','updateNotifications','pk_','maskApiKey','Shop\x20not\x20found','__importDefault','updateWebhookSettings','88shZKxm','password','substring','payout','6301YXNNzx','telegramChatId','updateTelegramSettings','create','default','webhookUrl','24819GkrFYN','462OlZVZE','botApiKey','notificationPaymentFailed','getShopSettings','Password\x20confirmation\x20is\x20incorrect','name','notificationPaymentSuccess','string','shop','shopUrl','toString','274870qNNvgs','Current\x20password\x20is\x20incorrect','compare','62bXDxnU','14252MIQZSG','payment_failed','bcryptjs','revokeAllApiKeys','telegramBotApiKey','notificationRefund','crypto','webhookEvents','refund','randomBytes','findUnique','payment_success','notificationLogin','login','changePassword','length','879176sxQDbr','repeat','1939500GMpHwr','New\x20password\x20and\x20confirmation\x20do\x20not\x20match'];a57_0x5d76=function(){return _0x345024;};return a57_0x5d76();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a57_0xfeb557(0x11e)]=void 0x0;const bcryptjs_1=__importDefault(require(a57_0xfeb557(0x107))),crypto_1=__importDefault(require(a57_0xfeb557(0x10b))),database_1=__importDefault(require('../config/database'));class SettingsService{[a57_0xfeb557(0x127)](_0x502046){const _0xe3ba61=a57_0xfeb557;if(!_0x502046)return'';if(_0x502046[_0xe3ba61(0x114)]<=0x8)return _0x502046;const _0x5da3d4=_0x502046[_0xe3ba61(0x12d)](0x0,0x8),_0x338585='*'[_0xe3ba61(0x116)](Math[_0xe3ba61(0x124)](0x0,_0x502046[_0xe3ba61(0x114)]-0x8));return _0x5da3d4+_0x338585;}[a57_0xfeb557(0x122)](_0x5ac4c6){const _0x5d452b=a57_0xfeb557;if(!_0x5ac4c6)return[];if(Array['isArray'](_0x5ac4c6))return _0x5ac4c6;if(typeof _0x5ac4c6===_0x5d452b(0x13d))try{const _0x3ca591=JSON['parse'](_0x5ac4c6);return Array['isArray'](_0x3ca591)?_0x3ca591:[];}catch{return[];}return[];}async[a57_0xfeb557(0x139)](_0x445a14){const _0x1adde6=a57_0xfeb557,_0x132ff5=await database_1['default'][_0x1adde6(0x13e)]['findUnique']({'where':{'id':_0x445a14},'include':{'settings':!![]}});if(!_0x132ff5)throw new Error(_0x1adde6(0x128));let _0x260d0e=_0x132ff5['settings'];return!_0x260d0e&&(_0x260d0e=await database_1[_0x1adde6(0x133)]['shopSettings']['create']({'data':{'shopId':_0x132ff5['id']}})),{'fullName':_0x132ff5[_0x1adde6(0x13b)],'brand':_0x132ff5['name'],'merchantUrl':_0x132ff5[_0x1adde6(0x13f)],'telegramUsername':_0x132ff5['telegram'],'telegramBotApiKey':_0x260d0e[_0x1adde6(0x109)]?this['maskApiKey'](_0x260d0e[_0x1adde6(0x109)]):null,'telegramChatId':_0x260d0e[_0x1adde6(0x130)],'webhookUrl':_0x260d0e[_0x1adde6(0x134)],'webhookEvents':this[_0x1adde6(0x122)](_0x260d0e[_0x1adde6(0x10c)]),'notifications':{'payment_success':_0x260d0e[_0x1adde6(0x13c)],'payment_failed':_0x260d0e[_0x1adde6(0x138)],'refund':_0x260d0e[_0x1adde6(0x10a)],'payout':_0x260d0e['notificationPayout'],'login':_0x260d0e[_0x1adde6(0x111)],'api_error':_0x260d0e['notificationApiError']}};}async[a57_0xfeb557(0x113)](_0x40e359,_0x36c27a){const _0x161f10=a57_0xfeb557,{currentPassword:_0x239fa0,newPassword:_0x17367f,confirmNewPassword:_0x39ac3d}=_0x36c27a;if(_0x17367f!==_0x39ac3d)throw new Error(_0x161f10(0x118));if(_0x17367f['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x2eb303=await database_1[_0x161f10(0x133)][_0x161f10(0x13e)][_0x161f10(0x10f)]({'where':{'id':_0x40e359},'select':{'password':!![]}});if(!_0x2eb303)throw new Error(_0x161f10(0x128));const _0x58d308=await bcryptjs_1['default'][_0x161f10(0x143)](_0x239fa0,_0x2eb303[_0x161f10(0x12c)]);if(!_0x58d308)throw new Error(_0x161f10(0x142));const _0x714bf3=await bcryptjs_1[_0x161f10(0x133)]['hash'](_0x17367f,0xc);await database_1[_0x161f10(0x133)][_0x161f10(0x13e)][_0x161f10(0x11d)]({'where':{'id':_0x40e359},'data':{'password':_0x714bf3}});}async[a57_0xfeb557(0x125)](_0x50f53f,_0x52d1f8){const _0x49c54c=a57_0xfeb557;await this['ensureSettingsExist'](_0x50f53f);const _0x2216f0={};_0x52d1f8[_0x49c54c(0x110)]!==undefined&&(_0x2216f0[_0x49c54c(0x13c)]=_0x52d1f8[_0x49c54c(0x110)]),_0x52d1f8[_0x49c54c(0x106)]!==undefined&&(_0x2216f0[_0x49c54c(0x138)]=_0x52d1f8[_0x49c54c(0x106)]),_0x52d1f8[_0x49c54c(0x10d)]!==undefined&&(_0x2216f0[_0x49c54c(0x10a)]=_0x52d1f8[_0x49c54c(0x10d)]),_0x52d1f8[_0x49c54c(0x12e)]!==undefined&&(_0x2216f0['notificationPayout']=_0x52d1f8[_0x49c54c(0x12e)]),_0x52d1f8[_0x49c54c(0x112)]!==undefined&&(_0x2216f0[_0x49c54c(0x111)]=_0x52d1f8[_0x49c54c(0x112)]),_0x52d1f8[_0x49c54c(0x11c)]!==undefined&&(_0x2216f0['notificationApiError']=_0x52d1f8[_0x49c54c(0x11c)]),await database_1[_0x49c54c(0x133)][_0x49c54c(0x119)][_0x49c54c(0x11d)]({'where':{'shopId':_0x50f53f},'data':_0x2216f0});}async[a57_0xfeb557(0x131)](_0x526e45,_0x3f87e8){const _0x11d4c5=a57_0xfeb557;await this[_0x11d4c5(0x123)](_0x526e45);const _0x72baa2={};_0x3f87e8[_0x11d4c5(0x137)]!==undefined&&(_0x72baa2[_0x11d4c5(0x109)]=_0x3f87e8[_0x11d4c5(0x137)]||null),_0x3f87e8['chatId']!==undefined&&(_0x72baa2[_0x11d4c5(0x130)]=_0x3f87e8['chatId']||null),await database_1['default'][_0x11d4c5(0x119)][_0x11d4c5(0x11d)]({'where':{'shopId':_0x526e45},'data':_0x72baa2});}async[a57_0xfeb557(0x12a)](_0xc85091,_0x10a58a){const _0x2d904e=a57_0xfeb557;await this[_0x2d904e(0x123)](_0xc85091);const _0x14e329={};_0x10a58a[_0x2d904e(0x134)]!==undefined&&(_0x14e329[_0x2d904e(0x134)]=_0x10a58a[_0x2d904e(0x134)]||null),_0x10a58a['webhookEvents']!==undefined&&(_0x14e329['webhookEvents']=_0x10a58a[_0x2d904e(0x10c)]||[]),await database_1[_0x2d904e(0x133)][_0x2d904e(0x119)][_0x2d904e(0x11d)]({'where':{'shopId':_0xc85091},'data':_0x14e329});}async[a57_0xfeb557(0x108)](_0xbdbf5a){const _0x3b126e=a57_0xfeb557,_0x26604a=_0x3b126e(0x126)+crypto_1[_0x3b126e(0x133)]['randomBytes'](0x20)[_0x3b126e(0x140)]('hex'),_0x28cbfe='sk_'+crypto_1[_0x3b126e(0x133)][_0x3b126e(0x10e)](0x20)[_0x3b126e(0x140)](_0x3b126e(0x121));await database_1[_0x3b126e(0x133)]['shop']['update']({'where':{'id':_0xbdbf5a},'data':{'publicKey':_0x26604a,'secretKey':_0x28cbfe}});}async[a57_0xfeb557(0x120)](_0x90b5aa,_0x4ace85){const _0x5f590e=a57_0xfeb557,{passwordConfirmation:_0x22bb6a}=_0x4ace85,_0x1e144e=await database_1['default']['shop'][_0x5f590e(0x10f)]({'where':{'id':_0x90b5aa},'select':{'password':!![]}});if(!_0x1e144e)throw new Error('Shop\x20not\x20found');const _0x22175f=await bcryptjs_1['default'][_0x5f590e(0x143)](_0x22bb6a,_0x1e144e['password']);if(!_0x22175f)throw new Error(_0x5f590e(0x13a));await database_1['default'][_0x5f590e(0x13e)][_0x5f590e(0x11a)]({'where':{'id':_0x90b5aa}});}async[a57_0xfeb557(0x123)](_0x389f26){const _0x52ae5c=a57_0xfeb557,_0x48cae8=await database_1[_0x52ae5c(0x133)][_0x52ae5c(0x119)][_0x52ae5c(0x10f)]({'where':{'shopId':_0x389f26}});!_0x48cae8&&await database_1['default'][_0x52ae5c(0x119)][_0x52ae5c(0x132)]({'data':{'shopId':_0x389f26}});}}exports[a57_0xfeb557(0x11e)]=SettingsService;