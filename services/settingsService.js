'use strict';const a72_0x952f91=a72_0x2db5;(function(_0x58926d,_0x424ecc){const _0x5208d2=a72_0x2db5,_0xbe3e99=_0x58926d();while(!![]){try{const _0x15d766=parseInt(_0x5208d2(0x17c))/0x1*(parseInt(_0x5208d2(0x1ae))/0x2)+parseInt(_0x5208d2(0x190))/0x3+parseInt(_0x5208d2(0x1a0))/0x4*(-parseInt(_0x5208d2(0x19d))/0x5)+parseInt(_0x5208d2(0x1ad))/0x6*(parseInt(_0x5208d2(0x1b4))/0x7)+parseInt(_0x5208d2(0x1b7))/0x8*(-parseInt(_0x5208d2(0x18b))/0x9)+parseInt(_0x5208d2(0x189))/0xa+parseInt(_0x5208d2(0x199))/0xb*(-parseInt(_0x5208d2(0x19c))/0xc);if(_0x15d766===_0x424ecc)break;else _0xbe3e99['push'](_0xbe3e99['shift']());}catch(_0x3e2be4){_0xbe3e99['push'](_0xbe3e99['shift']());}}}(a72_0xe3d7,0x25335));function a72_0x2db5(_0xac6c50,_0x1beba8){_0xac6c50=_0xac6c50-0x16f;const _0xe3d79b=a72_0xe3d7();let _0x2db53e=_0xe3d79b[_0xac6c50];return _0x2db53e;}var __importDefault=this&&this['__importDefault']||function(_0x33785b){const _0x555286=a72_0x2db5;return _0x33785b&&_0x33785b[_0x555286(0x181)]?_0x33785b:{'default':_0x33785b};};function a72_0xe3d7(){const _0xd3e953=['toString','changePassword','settings','notificationPaymentFailed','shop','1972990WkWBCX','chatId','323991oZmZwY','bcryptjs','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','findUnique','getShopSettings','830907uqSoyJ','substring','sk_','SettingsService','ensureSettingsExist','notificationApiError','botApiKey','Shop\x20not\x20found','deleteAccount','11zHepIt','webhookEvents','hash','4143396tIiMVa','27865iVfEwh','../config/database','update','84HWzwZR','updateNotifications','repeat','parse','login','crypto','Current\x20password\x20is\x20incorrect','notificationPayout','create','telegramBotApiKey','shopSettings','telegramChatId','delete','780wleZJR','4KVHIRg','Password\x20confirmation\x20is\x20incorrect','max','notificationRefund','password','length','7483mnbEKT','payout','updateWebhookSettings','56rPQGbS','payment_failed','default','name','refund','pk_','telegram','isArray','notificationLogin','notificationPaymentSuccess','randomBytes','api_error','string','hex','126722gzaMfz','compare','parseWebhookEvents','shopUrl','revokeAllApiKeys','__esModule','webhookUrl','payment_success'];a72_0xe3d7=function(){return _0xd3e953;};return a72_0xe3d7();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a72_0x952f91(0x193)]=void 0x0;const bcryptjs_1=__importDefault(require(a72_0x952f91(0x18c))),crypto_1=__importDefault(require(a72_0x952f91(0x1a5))),database_1=__importDefault(require(a72_0x952f91(0x19e)));class SettingsService{['maskApiKey'](_0x554b33){const _0x37a6d2=a72_0x952f91;if(!_0x554b33)return'';if(_0x554b33[_0x37a6d2(0x1b3)]<=0x8)return _0x554b33;const _0x2b1475=_0x554b33[_0x37a6d2(0x191)](0x0,0x8),_0x2b27e3='*'[_0x37a6d2(0x1a2)](Math[_0x37a6d2(0x1b0)](0x0,_0x554b33[_0x37a6d2(0x1b3)]-0x8));return _0x2b1475+_0x2b27e3;}[a72_0x952f91(0x17e)](_0x46d8ff){const _0xfca0cc=a72_0x952f91;if(!_0x46d8ff)return[];if(Array[_0xfca0cc(0x175)](_0x46d8ff))return _0x46d8ff;if(typeof _0x46d8ff===_0xfca0cc(0x17a))try{const _0x15c564=JSON[_0xfca0cc(0x1a3)](_0x46d8ff);return Array[_0xfca0cc(0x175)](_0x15c564)?_0x15c564:[];}catch{return[];}return[];}async[a72_0x952f91(0x18f)](_0x3cfabc){const _0x53aa91=a72_0x952f91,_0x2a2f32=await database_1[_0x53aa91(0x170)]['shop'][_0x53aa91(0x18e)]({'where':{'id':_0x3cfabc},'include':{'settings':!![]}});if(!_0x2a2f32)throw new Error(_0x53aa91(0x197));let _0x27e161=_0x2a2f32[_0x53aa91(0x186)];return!_0x27e161&&(_0x27e161=await database_1[_0x53aa91(0x170)]['shopSettings'][_0x53aa91(0x1a8)]({'data':{'shopId':_0x2a2f32['id']}})),{'fullName':_0x2a2f32[_0x53aa91(0x171)],'brand':_0x2a2f32[_0x53aa91(0x171)],'merchantUrl':_0x2a2f32[_0x53aa91(0x17f)],'telegramUsername':_0x2a2f32[_0x53aa91(0x174)],'telegramBotApiKey':_0x27e161[_0x53aa91(0x1a9)]?this['maskApiKey'](_0x27e161[_0x53aa91(0x1a9)]):null,'telegramChatId':_0x27e161[_0x53aa91(0x1ab)],'webhookUrl':_0x27e161[_0x53aa91(0x182)],'webhookEvents':this[_0x53aa91(0x17e)](_0x27e161[_0x53aa91(0x19a)]),'notifications':{'payment_success':_0x27e161[_0x53aa91(0x177)],'payment_failed':_0x27e161['notificationPaymentFailed'],'refund':_0x27e161[_0x53aa91(0x1b1)],'payout':_0x27e161[_0x53aa91(0x1a7)],'login':_0x27e161[_0x53aa91(0x176)],'api_error':_0x27e161[_0x53aa91(0x195)]}};}async[a72_0x952f91(0x185)](_0xfdd8dc,_0x72ea8b){const _0x54783f=a72_0x952f91,{currentPassword:_0x1981db,newPassword:_0x2f2530,confirmNewPassword:_0x19033b}=_0x72ea8b;if(_0x2f2530!==_0x19033b)throw new Error(_0x54783f(0x18d));if(_0x2f2530[_0x54783f(0x1b3)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x19076a=await database_1[_0x54783f(0x170)]['shop']['findUnique']({'where':{'id':_0xfdd8dc},'select':{'password':!![]}});if(!_0x19076a)throw new Error(_0x54783f(0x197));const _0x5e6642=await bcryptjs_1[_0x54783f(0x170)][_0x54783f(0x17d)](_0x1981db,_0x19076a[_0x54783f(0x1b2)]);if(!_0x5e6642)throw new Error(_0x54783f(0x1a6));const _0x1e55d4=await bcryptjs_1['default'][_0x54783f(0x19b)](_0x2f2530,0xc);await database_1[_0x54783f(0x170)][_0x54783f(0x188)]['update']({'where':{'id':_0xfdd8dc},'data':{'password':_0x1e55d4}});}async[a72_0x952f91(0x1a1)](_0x528e44,_0x598ab0){const _0xd2637b=a72_0x952f91;await this[_0xd2637b(0x194)](_0x528e44);const _0x4abca8={};_0x598ab0[_0xd2637b(0x183)]!==undefined&&(_0x4abca8[_0xd2637b(0x177)]=_0x598ab0[_0xd2637b(0x183)]),_0x598ab0[_0xd2637b(0x16f)]!==undefined&&(_0x4abca8[_0xd2637b(0x187)]=_0x598ab0[_0xd2637b(0x16f)]),_0x598ab0[_0xd2637b(0x172)]!==undefined&&(_0x4abca8['notificationRefund']=_0x598ab0[_0xd2637b(0x172)]),_0x598ab0[_0xd2637b(0x1b5)]!==undefined&&(_0x4abca8[_0xd2637b(0x1a7)]=_0x598ab0[_0xd2637b(0x1b5)]),_0x598ab0[_0xd2637b(0x1a4)]!==undefined&&(_0x4abca8[_0xd2637b(0x176)]=_0x598ab0[_0xd2637b(0x1a4)]),_0x598ab0[_0xd2637b(0x179)]!==undefined&&(_0x4abca8[_0xd2637b(0x195)]=_0x598ab0['api_error']),await database_1[_0xd2637b(0x170)][_0xd2637b(0x1aa)][_0xd2637b(0x19f)]({'where':{'shopId':_0x528e44},'data':_0x4abca8});}async['updateTelegramSettings'](_0x12e3dc,_0x34edda){const _0x4a5287=a72_0x952f91;await this['ensureSettingsExist'](_0x12e3dc);const _0x52be17={};_0x34edda[_0x4a5287(0x196)]!==undefined&&(_0x52be17[_0x4a5287(0x1a9)]=_0x34edda[_0x4a5287(0x196)]||null),_0x34edda[_0x4a5287(0x18a)]!==undefined&&(_0x52be17[_0x4a5287(0x1ab)]=_0x34edda[_0x4a5287(0x18a)]||null),await database_1[_0x4a5287(0x170)]['shopSettings'][_0x4a5287(0x19f)]({'where':{'shopId':_0x12e3dc},'data':_0x52be17});}async[a72_0x952f91(0x1b6)](_0x2f2c8b,_0x2a7bd6){const _0x2c7632=a72_0x952f91;await this[_0x2c7632(0x194)](_0x2f2c8b);const _0x188ee6={};_0x2a7bd6[_0x2c7632(0x182)]!==undefined&&(_0x188ee6[_0x2c7632(0x182)]=_0x2a7bd6[_0x2c7632(0x182)]||null),_0x2a7bd6[_0x2c7632(0x19a)]!==undefined&&(_0x188ee6[_0x2c7632(0x19a)]=_0x2a7bd6[_0x2c7632(0x19a)]||[]),await database_1[_0x2c7632(0x170)]['shopSettings'][_0x2c7632(0x19f)]({'where':{'shopId':_0x2f2c8b},'data':_0x188ee6});}async[a72_0x952f91(0x180)](_0x5030ee){const _0x257fb5=a72_0x952f91,_0x1bafb6=_0x257fb5(0x173)+crypto_1[_0x257fb5(0x170)]['randomBytes'](0x20)[_0x257fb5(0x184)](_0x257fb5(0x17b)),_0x2a9674=_0x257fb5(0x192)+crypto_1[_0x257fb5(0x170)][_0x257fb5(0x178)](0x20)[_0x257fb5(0x184)]('hex');await database_1['default']['shop'][_0x257fb5(0x19f)]({'where':{'id':_0x5030ee},'data':{'publicKey':_0x1bafb6,'secretKey':_0x2a9674}});}async[a72_0x952f91(0x198)](_0x532d66,_0x45336c){const _0x3a798f=a72_0x952f91,{passwordConfirmation:_0x2deb82}=_0x45336c,_0x4c9ea9=await database_1[_0x3a798f(0x170)][_0x3a798f(0x188)][_0x3a798f(0x18e)]({'where':{'id':_0x532d66},'select':{'password':!![]}});if(!_0x4c9ea9)throw new Error('Shop\x20not\x20found');const _0x1f442e=await bcryptjs_1[_0x3a798f(0x170)][_0x3a798f(0x17d)](_0x2deb82,_0x4c9ea9[_0x3a798f(0x1b2)]);if(!_0x1f442e)throw new Error(_0x3a798f(0x1af));await database_1['default'][_0x3a798f(0x188)][_0x3a798f(0x1ac)]({'where':{'id':_0x532d66}});}async[a72_0x952f91(0x194)](_0x3ad0c3){const _0x34026d=a72_0x952f91,_0x18e817=await database_1[_0x34026d(0x170)][_0x34026d(0x1aa)][_0x34026d(0x18e)]({'where':{'shopId':_0x3ad0c3}});!_0x18e817&&await database_1[_0x34026d(0x170)][_0x34026d(0x1aa)][_0x34026d(0x1a8)]({'data':{'shopId':_0x3ad0c3}});}}exports[a72_0x952f91(0x193)]=SettingsService;