'use strict';const a72_0x4705be=a72_0x2a1c;(function(_0x18be87,_0x4e1ca9){const _0x4d3dff=a72_0x2a1c,_0x30adfc=_0x18be87();while(!![]){try{const _0x25be56=-parseInt(_0x4d3dff(0x117))/0x1+-parseInt(_0x4d3dff(0x122))/0x2*(parseInt(_0x4d3dff(0x10e))/0x3)+parseInt(_0x4d3dff(0x12d))/0x4*(parseInt(_0x4d3dff(0xfc))/0x5)+-parseInt(_0x4d3dff(0x124))/0x6+parseInt(_0x4d3dff(0x126))/0x7+parseInt(_0x4d3dff(0x10b))/0x8+parseInt(_0x4d3dff(0x100))/0x9;if(_0x25be56===_0x4e1ca9)break;else _0x30adfc['push'](_0x30adfc['shift']());}catch(_0xaf489d){_0x30adfc['push'](_0x30adfc['shift']());}}}(a72_0x178c,0xabe1c));function a72_0x2a1c(_0x368cb8,_0x469387){_0x368cb8=_0x368cb8-0xfa;const _0x178c89=a72_0x178c();let _0x2a1cb5=_0x178c89[_0x368cb8];return _0x2a1cb5;}var __importDefault=this&&this[a72_0x4705be(0x123)]||function(_0x1cc6b4){const _0x3971a7=a72_0x4705be;return _0x1cc6b4&&_0x1cc6b4[_0x3971a7(0x113)]?_0x1cc6b4:{'default':_0x1cc6b4};};Object[a72_0x4705be(0x135)](exports,'__esModule',{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a72_0x4705be(0x115))),crypto_1=__importDefault(require(a72_0x4705be(0x12b))),database_1=__importDefault(require('../config/database'));class SettingsService{[a72_0x4705be(0x118)](_0x5381b2){const _0x3dcc05=a72_0x4705be;if(!_0x5381b2)return'';if(_0x5381b2['length']<=0x8)return _0x5381b2;const _0x26bd02=_0x5381b2['substring'](0x0,0x8),_0x214916='*'[_0x3dcc05(0x12c)](Math[_0x3dcc05(0x127)](0x0,_0x5381b2[_0x3dcc05(0x11a)]-0x8));return _0x26bd02+_0x214916;}[a72_0x4705be(0x102)](_0x2ee266){const _0x19b5c7=a72_0x4705be;if(!_0x2ee266)return[];if(Array['isArray'](_0x2ee266))return _0x2ee266;if(typeof _0x2ee266===_0x19b5c7(0xfd))try{const _0x4f0b39=JSON[_0x19b5c7(0x129)](_0x2ee266);return Array[_0x19b5c7(0xfa)](_0x4f0b39)?_0x4f0b39:[];}catch{return[];}return[];}async[a72_0x4705be(0xfe)](_0xd7236){const _0x119ad7=a72_0x4705be,_0x46795c=await database_1[_0x119ad7(0x104)]['shop'][_0x119ad7(0x12e)]({'where':{'id':_0xd7236},'include':{'settings':!![]}});if(!_0x46795c)throw new Error('Shop\x20not\x20found');let _0x4d48cb=_0x46795c[_0x119ad7(0x119)];return!_0x4d48cb&&(_0x4d48cb=await database_1[_0x119ad7(0x104)]['shopSettings']['create']({'data':{'shopId':_0x46795c['id']}})),{'fullName':_0x46795c['name'],'brand':_0x46795c['name'],'merchantUrl':_0x46795c['shopUrl'],'telegramUsername':_0x46795c['telegram'],'telegramBotApiKey':_0x4d48cb[_0x119ad7(0x121)]?this['maskApiKey'](_0x4d48cb[_0x119ad7(0x121)]):null,'telegramChatId':_0x4d48cb['telegramChatId'],'webhookUrl':_0x4d48cb[_0x119ad7(0x11d)],'webhookEvents':this[_0x119ad7(0x102)](_0x4d48cb['webhookEvents']),'notifications':{'payment_success':_0x4d48cb[_0x119ad7(0x120)],'payment_failed':_0x4d48cb[_0x119ad7(0x125)],'refund':_0x4d48cb[_0x119ad7(0x112)],'payout':_0x4d48cb[_0x119ad7(0xfb)],'login':_0x4d48cb['notificationLogin'],'api_error':_0x4d48cb['notificationApiError']}};}async[a72_0x4705be(0x103)](_0x25d23b,_0x21b59a){const _0x3047ce=a72_0x4705be,{currentPassword:_0x4b5dba,newPassword:_0x86107c,confirmNewPassword:_0x482ca7}=_0x21b59a;if(_0x86107c!==_0x482ca7)throw new Error(_0x3047ce(0x10d));if(_0x86107c[_0x3047ce(0x11a)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x2cb744=await database_1[_0x3047ce(0x104)][_0x3047ce(0x107)]['findUnique']({'where':{'id':_0x25d23b},'select':{'password':!![]}});if(!_0x2cb744)throw new Error(_0x3047ce(0x136));const _0x455914=await bcryptjs_1['default'][_0x3047ce(0x137)](_0x4b5dba,_0x2cb744[_0x3047ce(0x128)]);if(!_0x455914)throw new Error(_0x3047ce(0x12a));const _0x38c6a8=await bcryptjs_1[_0x3047ce(0x104)][_0x3047ce(0x11f)](_0x86107c,0xc);await database_1[_0x3047ce(0x104)][_0x3047ce(0x107)]['update']({'where':{'id':_0x25d23b},'data':{'password':_0x38c6a8}});}async['updateNotifications'](_0x29db2e,_0x24d301){const _0x2f27a4=a72_0x4705be;await this[_0x2f27a4(0xff)](_0x29db2e);const _0x16cb03={};_0x24d301[_0x2f27a4(0x11e)]!==undefined&&(_0x16cb03[_0x2f27a4(0x120)]=_0x24d301[_0x2f27a4(0x11e)]),_0x24d301[_0x2f27a4(0x110)]!==undefined&&(_0x16cb03[_0x2f27a4(0x125)]=_0x24d301[_0x2f27a4(0x110)]),_0x24d301[_0x2f27a4(0x10a)]!==undefined&&(_0x16cb03[_0x2f27a4(0x112)]=_0x24d301[_0x2f27a4(0x10a)]),_0x24d301[_0x2f27a4(0x12f)]!==undefined&&(_0x16cb03[_0x2f27a4(0xfb)]=_0x24d301[_0x2f27a4(0x12f)]),_0x24d301['login']!==undefined&&(_0x16cb03[_0x2f27a4(0x106)]=_0x24d301['login']),_0x24d301[_0x2f27a4(0x131)]!==undefined&&(_0x16cb03['notificationApiError']=_0x24d301[_0x2f27a4(0x131)]),await database_1['default'][_0x2f27a4(0x111)][_0x2f27a4(0x114)]({'where':{'shopId':_0x29db2e},'data':_0x16cb03});}async[a72_0x4705be(0x108)](_0x4bc1d5,_0x48da09){const _0x4dca35=a72_0x4705be;await this[_0x4dca35(0xff)](_0x4bc1d5);const _0x9cff67={};_0x48da09[_0x4dca35(0x11b)]!==undefined&&(_0x9cff67[_0x4dca35(0x121)]=_0x48da09[_0x4dca35(0x11b)]||null),_0x48da09['chatId']!==undefined&&(_0x9cff67['telegramChatId']=_0x48da09['chatId']||null),await database_1[_0x4dca35(0x104)][_0x4dca35(0x111)][_0x4dca35(0x114)]({'where':{'shopId':_0x4bc1d5},'data':_0x9cff67});}async[a72_0x4705be(0x130)](_0x2f6c4c,_0x1d3751){const _0x28637a=a72_0x4705be;await this[_0x28637a(0xff)](_0x2f6c4c);const _0x3fa1e6={};_0x1d3751[_0x28637a(0x11d)]!==undefined&&(_0x3fa1e6['webhookUrl']=_0x1d3751[_0x28637a(0x11d)]||null),_0x1d3751[_0x28637a(0x132)]!==undefined&&(_0x3fa1e6[_0x28637a(0x132)]=_0x1d3751['webhookEvents']||[]),await database_1[_0x28637a(0x104)][_0x28637a(0x111)][_0x28637a(0x114)]({'where':{'shopId':_0x2f6c4c},'data':_0x3fa1e6});}async['revokeAllApiKeys'](_0x1ea3dd){const _0x17b6dc=a72_0x4705be,_0x2b1dc8=_0x17b6dc(0x11c)+crypto_1[_0x17b6dc(0x104)][_0x17b6dc(0x101)](0x20)[_0x17b6dc(0x105)](_0x17b6dc(0x133)),_0x21af5b=_0x17b6dc(0x134)+crypto_1[_0x17b6dc(0x104)][_0x17b6dc(0x101)](0x20)[_0x17b6dc(0x105)](_0x17b6dc(0x133));await database_1[_0x17b6dc(0x104)][_0x17b6dc(0x107)][_0x17b6dc(0x114)]({'where':{'id':_0x1ea3dd},'data':{'publicKey':_0x2b1dc8,'secretKey':_0x21af5b}});}async[a72_0x4705be(0x116)](_0x297ecc,_0x3ead3c){const _0x3cddbd=a72_0x4705be,{passwordConfirmation:_0x4ea726}=_0x3ead3c,_0x1728c4=await database_1[_0x3cddbd(0x104)]['shop']['findUnique']({'where':{'id':_0x297ecc},'select':{'password':!![]}});if(!_0x1728c4)throw new Error(_0x3cddbd(0x136));const _0x4daef7=await bcryptjs_1[_0x3cddbd(0x104)][_0x3cddbd(0x137)](_0x4ea726,_0x1728c4[_0x3cddbd(0x128)]);if(!_0x4daef7)throw new Error(_0x3cddbd(0x109));await database_1[_0x3cddbd(0x104)][_0x3cddbd(0x107)][_0x3cddbd(0x10f)]({'where':{'id':_0x297ecc}});}async[a72_0x4705be(0xff)](_0x1c10db){const _0x4b383e=a72_0x4705be,_0x5a3023=await database_1['default'][_0x4b383e(0x111)]['findUnique']({'where':{'shopId':_0x1c10db}});!_0x5a3023&&await database_1[_0x4b383e(0x104)]['shopSettings']['create']({'data':{'shopId':_0x1c10db}});}}function a72_0x178c(){const _0xf4b5fc=['10rugdmf','string','getShopSettings','ensureSettingsExist','6095133ohxJCd','randomBytes','parseWebhookEvents','changePassword','default','toString','notificationLogin','shop','updateTelegramSettings','Password\x20confirmation\x20is\x20incorrect','refund','11022968tBRBsx','SettingsService','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','12wxWoky','delete','payment_failed','shopSettings','notificationRefund','__esModule','update','bcryptjs','deleteAccount','387694HCmFfQ','maskApiKey','settings','length','botApiKey','pk_','webhookUrl','payment_success','hash','notificationPaymentSuccess','telegramBotApiKey','444988aLsnKY','__importDefault','5456850nhZkBm','notificationPaymentFailed','4337221HbUKwl','max','password','parse','Current\x20password\x20is\x20incorrect','crypto','repeat','432924BPIvLA','findUnique','payout','updateWebhookSettings','api_error','webhookEvents','hex','sk_','defineProperty','Shop\x20not\x20found','compare','isArray','notificationPayout'];a72_0x178c=function(){return _0xf4b5fc;};return a72_0x178c();}exports[a72_0x4705be(0x10c)]=SettingsService;