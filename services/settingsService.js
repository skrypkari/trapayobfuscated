'use strict';const a52_0x5d40ce=a52_0x34e5;(function(_0x4cd890,_0x365c9f){const _0x4b5dcf=a52_0x34e5,_0x34e958=_0x4cd890();while(!![]){try{const _0x2acb41=parseInt(_0x4b5dcf(0xe3))/0x1*(parseInt(_0x4b5dcf(0xef))/0x2)+parseInt(_0x4b5dcf(0x102))/0x3+-parseInt(_0x4b5dcf(0xee))/0x4*(-parseInt(_0x4b5dcf(0xf6))/0x5)+-parseInt(_0x4b5dcf(0xe9))/0x6+parseInt(_0x4b5dcf(0xcb))/0x7*(parseInt(_0x4b5dcf(0xe0))/0x8)+-parseInt(_0x4b5dcf(0xd0))/0x9+-parseInt(_0x4b5dcf(0xf9))/0xa*(parseInt(_0x4b5dcf(0xda))/0xb);if(_0x2acb41===_0x365c9f)break;else _0x34e958['push'](_0x34e958['shift']());}catch(_0x3b53ba){_0x34e958['push'](_0x34e958['shift']());}}}(a52_0x2145,0x34d91));function a52_0x34e5(_0x3a96e3,_0x28f6bf){const _0x2145ce=a52_0x2145();return a52_0x34e5=function(_0x34e510,_0x231731){_0x34e510=_0x34e510-0xca;let _0xe54280=_0x2145ce[_0x34e510];return _0xe54280;},a52_0x34e5(_0x3a96e3,_0x28f6bf);}var __importDefault=this&&this[a52_0x5d40ce(0x103)]||function(_0xd89e98){return _0xd89e98&&_0xd89e98['__esModule']?_0xd89e98:{'default':_0xd89e98};};Object['defineProperty'](exports,a52_0x5d40ce(0xe1),{'value':!![]}),exports[a52_0x5d40ce(0xe7)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x5d40ce(0xf8))),crypto_1=__importDefault(require(a52_0x5d40ce(0x107))),database_1=__importDefault(require(a52_0x5d40ce(0xce)));class SettingsService{[a52_0x5d40ce(0xf7)](_0x1b4e20){const _0x2f8ada=a52_0x5d40ce;if(!_0x1b4e20)return'';if(_0x1b4e20[_0x2f8ada(0xd9)]<=0x8)return _0x1b4e20;const _0x30826d=_0x1b4e20[_0x2f8ada(0xec)](0x0,0x8),_0x2a2e90='*'[_0x2f8ada(0x10a)](Math['max'](0x0,_0x1b4e20['length']-0x8));return _0x30826d+_0x2a2e90;}[a52_0x5d40ce(0x100)](_0x5e2c3f){const _0x4afeef=a52_0x5d40ce;if(!_0x5e2c3f)return[];if(Array[_0x4afeef(0x104)](_0x5e2c3f))return _0x5e2c3f;if(typeof _0x5e2c3f===_0x4afeef(0xe5))try{const _0x4f97a2=JSON['parse'](_0x5e2c3f);return Array[_0x4afeef(0x104)](_0x4f97a2)?_0x4f97a2:[];}catch{return[];}return[];}async[a52_0x5d40ce(0xfa)](_0x295cdd){const _0x137c8a=a52_0x5d40ce,_0x4fd722=await database_1[_0x137c8a(0x109)][_0x137c8a(0xcd)]['findUnique']({'where':{'id':_0x295cdd},'include':{'settings':!![]}});if(!_0x4fd722)throw new Error('Shop\x20not\x20found');let _0x5f367a=_0x4fd722[_0x137c8a(0xd4)];return!_0x5f367a&&(_0x5f367a=await database_1['default'][_0x137c8a(0xff)][_0x137c8a(0xe6)]({'data':{'shopId':_0x4fd722['id']}})),{'fullName':_0x4fd722[_0x137c8a(0xed)],'brand':_0x4fd722[_0x137c8a(0xed)],'merchantUrl':_0x4fd722['shopUrl'],'telegramUsername':_0x4fd722[_0x137c8a(0xfd)],'telegramBotApiKey':_0x5f367a[_0x137c8a(0xcf)]?this['maskApiKey'](_0x5f367a[_0x137c8a(0xcf)]):null,'telegramChatId':_0x5f367a[_0x137c8a(0xf1)],'webhookUrl':_0x5f367a[_0x137c8a(0xd1)],'webhookEvents':this[_0x137c8a(0x100)](_0x5f367a['webhookEvents']),'notifications':{'payment_success':_0x5f367a[_0x137c8a(0xd7)],'payment_failed':_0x5f367a[_0x137c8a(0xd2)],'refund':_0x5f367a[_0x137c8a(0xf2)],'payout':_0x5f367a['notificationPayout'],'login':_0x5f367a[_0x137c8a(0xdf)],'api_error':_0x5f367a['notificationApiError']}};}async[a52_0x5d40ce(0xf5)](_0x335e07,_0x274f05){const _0x270a10=a52_0x5d40ce,{currentPassword:_0x24772a,newPassword:_0x41d3f5,confirmNewPassword:_0x30f833}=_0x274f05;if(_0x41d3f5!==_0x30f833)throw new Error(_0x270a10(0x106));if(_0x41d3f5[_0x270a10(0xd9)]<0x6)throw new Error(_0x270a10(0xea));const _0x40e706=await database_1[_0x270a10(0x109)]['shop'][_0x270a10(0x101)]({'where':{'id':_0x335e07},'select':{'password':!![]}});if(!_0x40e706)throw new Error(_0x270a10(0xd6));const _0x68679=await bcryptjs_1['default'][_0x270a10(0x108)](_0x24772a,_0x40e706[_0x270a10(0x105)]);if(!_0x68679)throw new Error('Current\x20password\x20is\x20incorrect');const _0x1f478e=await bcryptjs_1[_0x270a10(0x109)][_0x270a10(0xeb)](_0x41d3f5,0xc);await database_1[_0x270a10(0x109)]['shop'][_0x270a10(0xe4)]({'where':{'id':_0x335e07},'data':{'password':_0x1f478e}});}async[a52_0x5d40ce(0xdb)](_0x3e904d,_0x146a68){const _0x21b2f5=a52_0x5d40ce;await this[_0x21b2f5(0xde)](_0x3e904d);const _0x537d37={};_0x146a68['payment_success']!==undefined&&(_0x537d37[_0x21b2f5(0xd7)]=_0x146a68['payment_success']),_0x146a68['payment_failed']!==undefined&&(_0x537d37[_0x21b2f5(0xd2)]=_0x146a68['payment_failed']),_0x146a68[_0x21b2f5(0x10b)]!==undefined&&(_0x537d37[_0x21b2f5(0xf2)]=_0x146a68['refund']),_0x146a68[_0x21b2f5(0x10d)]!==undefined&&(_0x537d37[_0x21b2f5(0xfe)]=_0x146a68[_0x21b2f5(0x10d)]),_0x146a68['login']!==undefined&&(_0x537d37['notificationLogin']=_0x146a68[_0x21b2f5(0xdd)]),_0x146a68[_0x21b2f5(0xcc)]!==undefined&&(_0x537d37[_0x21b2f5(0xca)]=_0x146a68[_0x21b2f5(0xcc)]),await database_1[_0x21b2f5(0x109)][_0x21b2f5(0xff)][_0x21b2f5(0xe4)]({'where':{'shopId':_0x3e904d},'data':_0x537d37});}async[a52_0x5d40ce(0xf0)](_0x46c8db,_0xf6db94){const _0x4d37a0=a52_0x5d40ce;await this[_0x4d37a0(0xde)](_0x46c8db);const _0x42d67a={};_0xf6db94[_0x4d37a0(0xe8)]!==undefined&&(_0x42d67a['telegramBotApiKey']=_0xf6db94[_0x4d37a0(0xe8)]||null),_0xf6db94[_0x4d37a0(0xd3)]!==undefined&&(_0x42d67a[_0x4d37a0(0xf1)]=_0xf6db94[_0x4d37a0(0xd3)]||null),await database_1[_0x4d37a0(0x109)][_0x4d37a0(0xff)][_0x4d37a0(0xe4)]({'where':{'shopId':_0x46c8db},'data':_0x42d67a});}async[a52_0x5d40ce(0xd8)](_0x56e851,_0x4398e8){const _0x3f9bbf=a52_0x5d40ce;await this[_0x3f9bbf(0xde)](_0x56e851);const _0x2862f0={};_0x4398e8['webhookUrl']!==undefined&&(_0x2862f0[_0x3f9bbf(0xd1)]=_0x4398e8[_0x3f9bbf(0xd1)]||null),_0x4398e8[_0x3f9bbf(0xe2)]!==undefined&&(_0x2862f0['webhookEvents']=_0x4398e8['webhookEvents']||[]),await database_1[_0x3f9bbf(0x109)]['shopSettings'][_0x3f9bbf(0xe4)]({'where':{'shopId':_0x56e851},'data':_0x2862f0});}async[a52_0x5d40ce(0xf4)](_0x3907c0){const _0x180e7e=a52_0x5d40ce,_0x38feec='pk_'+crypto_1[_0x180e7e(0x109)]['randomBytes'](0x20)[_0x180e7e(0xd5)]('hex'),_0x149856=_0x180e7e(0xdc)+crypto_1[_0x180e7e(0x109)]['randomBytes'](0x20)[_0x180e7e(0xd5)](_0x180e7e(0xf3));await database_1[_0x180e7e(0x109)]['shop'][_0x180e7e(0xe4)]({'where':{'id':_0x3907c0},'data':{'publicKey':_0x38feec,'secretKey':_0x149856}});}async[a52_0x5d40ce(0xfb)](_0x584016,_0x3ca432){const _0x175db7=a52_0x5d40ce,{passwordConfirmation:_0x37b706}=_0x3ca432,_0x12093c=await database_1[_0x175db7(0x109)][_0x175db7(0xcd)][_0x175db7(0x101)]({'where':{'id':_0x584016},'select':{'password':!![]}});if(!_0x12093c)throw new Error(_0x175db7(0xd6));const _0x32f5af=await bcryptjs_1[_0x175db7(0x109)]['compare'](_0x37b706,_0x12093c[_0x175db7(0x105)]);if(!_0x32f5af)throw new Error(_0x175db7(0x10c));await database_1[_0x175db7(0x109)]['shop'][_0x175db7(0xfc)]({'where':{'id':_0x584016}});}async[a52_0x5d40ce(0xde)](_0x1499fa){const _0x3534a5=a52_0x5d40ce,_0x1794e6=await database_1['default'][_0x3534a5(0xff)][_0x3534a5(0x101)]({'where':{'shopId':_0x1499fa}});!_0x1794e6&&await database_1['default'][_0x3534a5(0xff)][_0x3534a5(0xe6)]({'data':{'shopId':_0x1499fa}});}}function a52_0x2145(){const _0x45f877=['login','ensureSettingsExist','notificationLogin','20464YJcICp','__esModule','webhookEvents','105833gatjqC','update','string','create','SettingsService','botApiKey','1826448cInNqc','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','hash','substring','name','4kMwBaA','8gjyWWM','updateTelegramSettings','telegramChatId','notificationRefund','hex','revokeAllApiKeys','changePassword','1785305YfmzLE','maskApiKey','bcryptjs','4805860ZWROfL','getShopSettings','deleteAccount','delete','telegram','notificationPayout','shopSettings','parseWebhookEvents','findUnique','986064VmTejm','__importDefault','isArray','password','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','crypto','compare','default','repeat','refund','Password\x20confirmation\x20is\x20incorrect','payout','notificationApiError','392ISvBnv','api_error','shop','../config/database','telegramBotApiKey','2257830ADGAsh','webhookUrl','notificationPaymentFailed','chatId','settings','toString','Shop\x20not\x20found','notificationPaymentSuccess','updateWebhookSettings','length','11ENvTQf','updateNotifications','sk_'];a52_0x2145=function(){return _0x45f877;};return a52_0x2145();}exports[a52_0x5d40ce(0xe7)]=SettingsService;