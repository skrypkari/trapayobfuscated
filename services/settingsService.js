'use strict';const a55_0x371b88=a55_0x48e4;(function(_0x51e3cf,_0x439bcb){const _0x16fa84=a55_0x48e4,_0x57deab=_0x51e3cf();while(!![]){try{const _0x217c37=-parseInt(_0x16fa84(0xa1))/0x1*(-parseInt(_0x16fa84(0x72))/0x2)+parseInt(_0x16fa84(0x6f))/0x3*(-parseInt(_0x16fa84(0x9e))/0x4)+-parseInt(_0x16fa84(0x80))/0x5+parseInt(_0x16fa84(0x99))/0x6*(parseInt(_0x16fa84(0x88))/0x7)+-parseInt(_0x16fa84(0x6a))/0x8*(-parseInt(_0x16fa84(0x70))/0x9)+parseInt(_0x16fa84(0xa2))/0xa+-parseInt(_0x16fa84(0x9c))/0xb*(parseInt(_0x16fa84(0x98))/0xc);if(_0x217c37===_0x439bcb)break;else _0x57deab['push'](_0x57deab['shift']());}catch(_0x3184ca){_0x57deab['push'](_0x57deab['shift']());}}}(a55_0x1322,0xe3fcb));var __importDefault=this&&this[a55_0x371b88(0x95)]||function(_0x28f8f0){const _0x218001=a55_0x371b88;return _0x28f8f0&&_0x28f8f0[_0x218001(0xa3)]?_0x28f8f0:{'default':_0x28f8f0};};function a55_0x48e4(_0xd7c359,_0x3890b1){const _0x13221f=a55_0x1322();return a55_0x48e4=function(_0x48e41b,_0x4fe578){_0x48e41b=_0x48e41b-0x64;let _0x2086bc=_0x13221f[_0x48e41b];return _0x2086bc;},a55_0x48e4(_0xd7c359,_0x3890b1);}Object[a55_0x371b88(0x86)](exports,'__esModule',{'value':!![]}),exports[a55_0x371b88(0xa6)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a55_0x371b88(0x94))),database_1=__importDefault(require(a55_0x371b88(0x85)));class SettingsService{[a55_0x371b88(0x89)](_0x1d2672){const _0x10c2a6=a55_0x371b88;if(!_0x1d2672)return'';if(_0x1d2672[_0x10c2a6(0x9f)]<=0x8)return _0x1d2672;const _0x2b935b=_0x1d2672['substring'](0x0,0x8),_0x4a0b1a='*'['repeat'](Math[_0x10c2a6(0x6b)](0x0,_0x1d2672[_0x10c2a6(0x9f)]-0x8));return _0x2b935b+_0x4a0b1a;}[a55_0x371b88(0x64)](_0x5d3b70){const _0x5c9924=a55_0x371b88;if(!_0x5d3b70)return[];if(Array[_0x5c9924(0x68)](_0x5d3b70))return _0x5d3b70;if(typeof _0x5d3b70===_0x5c9924(0x77))try{const _0x5b4535=JSON[_0x5c9924(0x81)](_0x5d3b70);return Array[_0x5c9924(0x68)](_0x5b4535)?_0x5b4535:[];}catch{return[];}return[];}async['getShopSettings'](_0x1fd025){const _0x84e45c=a55_0x371b88,_0x581e85=await database_1[_0x84e45c(0xa5)]['shop'][_0x84e45c(0x79)]({'where':{'id':_0x1fd025},'include':{'settings':!![]}});if(!_0x581e85)throw new Error(_0x84e45c(0x83));let _0x52b06d=_0x581e85[_0x84e45c(0x69)];return!_0x52b06d&&(_0x52b06d=await database_1[_0x84e45c(0xa5)][_0x84e45c(0x71)]['create']({'data':{'shopId':_0x581e85['id']}})),{'fullName':_0x581e85[_0x84e45c(0x84)],'brand':_0x581e85[_0x84e45c(0x84)],'merchantUrl':_0x581e85[_0x84e45c(0x7e)],'telegramUsername':_0x581e85[_0x84e45c(0x8c)],'telegramBotApiKey':_0x52b06d[_0x84e45c(0x66)]?this[_0x84e45c(0x89)](_0x52b06d[_0x84e45c(0x66)]):null,'telegramChatId':_0x52b06d[_0x84e45c(0x97)],'webhookUrl':_0x52b06d[_0x84e45c(0x90)],'webhookEvents':this['parseWebhookEvents'](_0x52b06d[_0x84e45c(0x67)]),'notifications':{'payment_success':_0x52b06d[_0x84e45c(0xa0)],'payment_failed':_0x52b06d[_0x84e45c(0x7d)],'refund':_0x52b06d[_0x84e45c(0x78)],'payout':_0x52b06d['notificationPayout'],'login':_0x52b06d[_0x84e45c(0x92)],'api_error':_0x52b06d[_0x84e45c(0x82)]}};}async['changePassword'](_0x3ead94,_0x472df2){const _0x58ea3e=a55_0x371b88,{currentPassword:_0x49ba48,newPassword:_0x5f7da3,confirmNewPassword:_0x4913a1}=_0x472df2;if(_0x5f7da3!==_0x4913a1)throw new Error(_0x58ea3e(0x6e));if(_0x5f7da3[_0x58ea3e(0x9f)]<0x6)throw new Error(_0x58ea3e(0x75));const _0x11d861=await database_1['default'][_0x58ea3e(0x96)][_0x58ea3e(0x79)]({'where':{'id':_0x3ead94},'select':{'password':!![]}});if(!_0x11d861)throw new Error(_0x58ea3e(0x83));const _0x5bee49=await bcryptjs_1['default'][_0x58ea3e(0xa8)](_0x49ba48,_0x11d861[_0x58ea3e(0x73)]);if(!_0x5bee49)throw new Error(_0x58ea3e(0x8e));const _0xa8fb61=await bcryptjs_1[_0x58ea3e(0xa5)][_0x58ea3e(0x7b)](_0x5f7da3,0xc);await database_1[_0x58ea3e(0xa5)][_0x58ea3e(0x96)][_0x58ea3e(0x8d)]({'where':{'id':_0x3ead94},'data':{'password':_0xa8fb61}});}async[a55_0x371b88(0x7f)](_0x300e6f,_0x320373){const _0x2e3632=a55_0x371b88;await this[_0x2e3632(0x8a)](_0x300e6f);const _0xea01a7={};_0x320373['payment_success']!==undefined&&(_0xea01a7[_0x2e3632(0xa0)]=_0x320373[_0x2e3632(0x9a)]),_0x320373[_0x2e3632(0x6c)]!==undefined&&(_0xea01a7[_0x2e3632(0x7d)]=_0x320373[_0x2e3632(0x6c)]),_0x320373[_0x2e3632(0x8f)]!==undefined&&(_0xea01a7[_0x2e3632(0x78)]=_0x320373[_0x2e3632(0x8f)]),_0x320373['payout']!==undefined&&(_0xea01a7[_0x2e3632(0xa7)]=_0x320373['payout']),_0x320373[_0x2e3632(0xa4)]!==undefined&&(_0xea01a7['notificationLogin']=_0x320373[_0x2e3632(0xa4)]),_0x320373['api_error']!==undefined&&(_0xea01a7[_0x2e3632(0x82)]=_0x320373[_0x2e3632(0x65)]),await database_1[_0x2e3632(0xa5)][_0x2e3632(0x71)][_0x2e3632(0x8d)]({'where':{'shopId':_0x300e6f},'data':_0xea01a7});}async[a55_0x371b88(0xa9)](_0x2af016,_0x16d39c){const _0x31bd68=a55_0x371b88;await this[_0x31bd68(0x8a)](_0x2af016);const _0x2e2642={};_0x16d39c['botApiKey']!==undefined&&(_0x2e2642[_0x31bd68(0x66)]=_0x16d39c[_0x31bd68(0x7a)]||null),_0x16d39c[_0x31bd68(0x93)]!==undefined&&(_0x2e2642[_0x31bd68(0x97)]=_0x16d39c[_0x31bd68(0x93)]||null),await database_1['default']['shopSettings']['update']({'where':{'shopId':_0x2af016},'data':_0x2e2642});}async['updateWebhookSettings'](_0x442808,_0x2c9e9f){const _0x464532=a55_0x371b88;await this[_0x464532(0x8a)](_0x442808);const _0xb3f523={};_0x2c9e9f['webhookUrl']!==undefined&&(_0xb3f523['webhookUrl']=_0x2c9e9f[_0x464532(0x90)]||null),_0x2c9e9f[_0x464532(0x67)]!==undefined&&(_0xb3f523[_0x464532(0x67)]=_0x2c9e9f[_0x464532(0x67)]||[]),await database_1[_0x464532(0xa5)][_0x464532(0x71)][_0x464532(0x8d)]({'where':{'shopId':_0x442808},'data':_0xb3f523});}async[a55_0x371b88(0x87)](_0x3ad19d){const _0x32e889=a55_0x371b88,_0x50a4d6=_0x32e889(0x9d)+crypto_1['default'][_0x32e889(0x9b)](0x20)[_0x32e889(0x7c)](_0x32e889(0x8b)),_0x43c4cc=_0x32e889(0x6d)+crypto_1['default'][_0x32e889(0x9b)](0x20)[_0x32e889(0x7c)](_0x32e889(0x8b));await database_1[_0x32e889(0xa5)]['shop']['update']({'where':{'id':_0x3ad19d},'data':{'publicKey':_0x50a4d6,'secretKey':_0x43c4cc}});}async[a55_0x371b88(0x91)](_0x1a3692,_0x12d255){const _0x36ba2a=a55_0x371b88,{passwordConfirmation:_0x5310d9}=_0x12d255,_0x2a1e2a=await database_1[_0x36ba2a(0xa5)][_0x36ba2a(0x96)][_0x36ba2a(0x79)]({'where':{'id':_0x1a3692},'select':{'password':!![]}});if(!_0x2a1e2a)throw new Error('Shop\x20not\x20found');const _0x4f43f3=await bcryptjs_1[_0x36ba2a(0xa5)][_0x36ba2a(0xa8)](_0x5310d9,_0x2a1e2a[_0x36ba2a(0x73)]);if(!_0x4f43f3)throw new Error(_0x36ba2a(0x76));await database_1[_0x36ba2a(0xa5)][_0x36ba2a(0x96)]['delete']({'where':{'id':_0x1a3692}});}async[a55_0x371b88(0x8a)](_0x2589f7){const _0x580bed=a55_0x371b88,_0x2ca547=await database_1[_0x580bed(0xa5)][_0x580bed(0x71)][_0x580bed(0x79)]({'where':{'shopId':_0x2589f7}});!_0x2ca547&&await database_1[_0x580bed(0xa5)]['shopSettings'][_0x580bed(0x74)]({'data':{'shopId':_0x2589f7}});}}function a55_0x1322(){const _0x2054ce=['webhookUrl','deleteAccount','notificationLogin','chatId','crypto','__importDefault','shop','telegramChatId','33757476ikaqtw','942YJNQJW','payment_success','randomBytes','11weVcfw','pk_','270580udDaIQ','length','notificationPaymentSuccess','420437MFLCZg','16649320BYPzCA','__esModule','login','default','SettingsService','notificationPayout','compare','updateTelegramSettings','parseWebhookEvents','api_error','telegramBotApiKey','webhookEvents','isArray','settings','14233352oTxbae','max','payment_failed','sk_','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','24BjrEeq','9djhTYS','shopSettings','6ZFCxbo','password','create','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','Password\x20confirmation\x20is\x20incorrect','string','notificationRefund','findUnique','botApiKey','hash','toString','notificationPaymentFailed','shopUrl','updateNotifications','6858485DNTjtL','parse','notificationApiError','Shop\x20not\x20found','name','../config/database','defineProperty','revokeAllApiKeys','42553zHwHGP','maskApiKey','ensureSettingsExist','hex','telegram','update','Current\x20password\x20is\x20incorrect','refund'];a55_0x1322=function(){return _0x2054ce;};return a55_0x1322();}exports['SettingsService']=SettingsService;