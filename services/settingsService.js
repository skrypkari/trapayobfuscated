'use strict';const a60_0x3e5820=a60_0x53e8;(function(_0x1a65e1,_0x53d997){const _0x2b67e4=a60_0x53e8,_0x563b94=_0x1a65e1();while(!![]){try{const _0x1da2d8=parseInt(_0x2b67e4(0x14b))/0x1+parseInt(_0x2b67e4(0x16e))/0x2*(-parseInt(_0x2b67e4(0x162))/0x3)+-parseInt(_0x2b67e4(0x15a))/0x4+-parseInt(_0x2b67e4(0x13f))/0x5*(parseInt(_0x2b67e4(0x144))/0x6)+parseInt(_0x2b67e4(0x171))/0x7+-parseInt(_0x2b67e4(0x145))/0x8+parseInt(_0x2b67e4(0x161))/0x9*(parseInt(_0x2b67e4(0x16d))/0xa);if(_0x1da2d8===_0x53d997)break;else _0x563b94['push'](_0x563b94['shift']());}catch(_0x13f1f1){_0x563b94['push'](_0x563b94['shift']());}}}(a60_0x52e1,0xd71cc));var __importDefault=this&&this['__importDefault']||function(_0xde5ac4){const _0x557e38=a60_0x53e8;return _0xde5ac4&&_0xde5ac4[_0x557e38(0x139)]?_0xde5ac4:{'default':_0xde5ac4};};Object[a60_0x3e5820(0x153)](exports,a60_0x3e5820(0x139),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a60_0x3e5820(0x131))),crypto_1=__importDefault(require(a60_0x3e5820(0x15c))),database_1=__importDefault(require(a60_0x3e5820(0x14e)));class SettingsService{['maskApiKey'](_0x59a9c6){const _0x5647a5=a60_0x3e5820;if(!_0x59a9c6)return'';if(_0x59a9c6['length']<=0x8)return _0x59a9c6;const _0x31d294=_0x59a9c6[_0x5647a5(0x13c)](0x0,0x8),_0x511772='*'[_0x5647a5(0x166)](Math['max'](0x0,_0x59a9c6[_0x5647a5(0x141)]-0x8));return _0x31d294+_0x511772;}[a60_0x3e5820(0x14f)](_0x4fc537){const _0x59f211=a60_0x3e5820;if(!_0x4fc537)return[];if(Array[_0x59f211(0x146)](_0x4fc537))return _0x4fc537;if(typeof _0x4fc537===_0x59f211(0x168))try{const _0x40aa78=JSON[_0x59f211(0x172)](_0x4fc537);return Array[_0x59f211(0x146)](_0x40aa78)?_0x40aa78:[];}catch{return[];}return[];}async[a60_0x3e5820(0x135)](_0x231a9e){const _0x18394a=a60_0x3e5820,_0x160214=await database_1[_0x18394a(0x15f)][_0x18394a(0x163)][_0x18394a(0x13e)]({'where':{'id':_0x231a9e},'include':{'settings':!![]}});if(!_0x160214)throw new Error(_0x18394a(0x147));let _0xd901d3=_0x160214[_0x18394a(0x16f)];return!_0xd901d3&&(_0xd901d3=await database_1[_0x18394a(0x15f)][_0x18394a(0x16c)]['create']({'data':{'shopId':_0x160214['id']}})),{'fullName':_0x160214[_0x18394a(0x133)],'brand':_0x160214[_0x18394a(0x133)],'merchantUrl':_0x160214[_0x18394a(0x132)],'telegramUsername':_0x160214[_0x18394a(0x148)],'telegramBotApiKey':_0xd901d3[_0x18394a(0x151)]?this[_0x18394a(0x170)](_0xd901d3[_0x18394a(0x151)]):null,'telegramChatId':_0xd901d3[_0x18394a(0x16b)],'webhookUrl':_0xd901d3[_0x18394a(0x14a)],'webhookEvents':this['parseWebhookEvents'](_0xd901d3[_0x18394a(0x167)]),'notifications':{'payment_success':_0xd901d3['notificationPaymentSuccess'],'payment_failed':_0xd901d3[_0x18394a(0x14d)],'refund':_0xd901d3[_0x18394a(0x130)],'payout':_0xd901d3[_0x18394a(0x160)],'login':_0xd901d3[_0x18394a(0x157)],'api_error':_0xd901d3[_0x18394a(0x137)]}};}async[a60_0x3e5820(0x142)](_0x351be3,_0x4f5592){const _0x1d9d24=a60_0x3e5820,{currentPassword:_0xd316ea,newPassword:_0x1e1add,confirmNewPassword:_0x5f3def}=_0x4f5592;if(_0x1e1add!==_0x5f3def)throw new Error(_0x1d9d24(0x164));if(_0x1e1add[_0x1d9d24(0x141)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x5bbcbb=await database_1[_0x1d9d24(0x15f)][_0x1d9d24(0x163)][_0x1d9d24(0x13e)]({'where':{'id':_0x351be3},'select':{'password':!![]}});if(!_0x5bbcbb)throw new Error(_0x1d9d24(0x147));const _0x3289a7=await bcryptjs_1[_0x1d9d24(0x15f)][_0x1d9d24(0x136)](_0xd316ea,_0x5bbcbb[_0x1d9d24(0x14c)]);if(!_0x3289a7)throw new Error(_0x1d9d24(0x16a));const _0x161717=await bcryptjs_1['default'][_0x1d9d24(0x159)](_0x1e1add,0xc);await database_1[_0x1d9d24(0x15f)][_0x1d9d24(0x163)][_0x1d9d24(0x150)]({'where':{'id':_0x351be3},'data':{'password':_0x161717}});}async['updateNotifications'](_0x125eb2,_0x1925bc){const _0x606701=a60_0x3e5820;await this[_0x606701(0x13a)](_0x125eb2);const _0x57e465={};_0x1925bc[_0x606701(0x15b)]!==undefined&&(_0x57e465[_0x606701(0x173)]=_0x1925bc['payment_success']),_0x1925bc[_0x606701(0x143)]!==undefined&&(_0x57e465[_0x606701(0x14d)]=_0x1925bc[_0x606701(0x143)]),_0x1925bc[_0x606701(0x138)]!==undefined&&(_0x57e465[_0x606701(0x130)]=_0x1925bc['refund']),_0x1925bc[_0x606701(0x158)]!==undefined&&(_0x57e465['notificationPayout']=_0x1925bc[_0x606701(0x158)]),_0x1925bc[_0x606701(0x13b)]!==undefined&&(_0x57e465[_0x606701(0x157)]=_0x1925bc[_0x606701(0x13b)]),_0x1925bc[_0x606701(0x140)]!==undefined&&(_0x57e465[_0x606701(0x137)]=_0x1925bc['api_error']),await database_1[_0x606701(0x15f)][_0x606701(0x16c)]['update']({'where':{'shopId':_0x125eb2},'data':_0x57e465});}async['updateTelegramSettings'](_0x330373,_0x3c0e70){const _0x57b2f0=a60_0x3e5820;await this[_0x57b2f0(0x13a)](_0x330373);const _0x2b1f53={};_0x3c0e70[_0x57b2f0(0x169)]!==undefined&&(_0x2b1f53[_0x57b2f0(0x151)]=_0x3c0e70[_0x57b2f0(0x169)]||null),_0x3c0e70[_0x57b2f0(0x165)]!==undefined&&(_0x2b1f53[_0x57b2f0(0x16b)]=_0x3c0e70['chatId']||null),await database_1[_0x57b2f0(0x15f)][_0x57b2f0(0x16c)][_0x57b2f0(0x150)]({'where':{'shopId':_0x330373},'data':_0x2b1f53});}async[a60_0x3e5820(0x155)](_0x362a5d,_0x1ae13f){const _0x287fbc=a60_0x3e5820;await this['ensureSettingsExist'](_0x362a5d);const _0x1be74b={};_0x1ae13f[_0x287fbc(0x14a)]!==undefined&&(_0x1be74b[_0x287fbc(0x14a)]=_0x1ae13f['webhookUrl']||null),_0x1ae13f[_0x287fbc(0x167)]!==undefined&&(_0x1be74b[_0x287fbc(0x167)]=_0x1ae13f[_0x287fbc(0x167)]||[]),await database_1['default'][_0x287fbc(0x16c)]['update']({'where':{'shopId':_0x362a5d},'data':_0x1be74b});}async['revokeAllApiKeys'](_0x4d608c){const _0x128a5d=a60_0x3e5820,_0x3f62dd=_0x128a5d(0x134)+crypto_1[_0x128a5d(0x15f)]['randomBytes'](0x20)['toString'](_0x128a5d(0x149)),_0x324316=_0x128a5d(0x15d)+crypto_1[_0x128a5d(0x15f)][_0x128a5d(0x13d)](0x20)['toString'](_0x128a5d(0x149));await database_1[_0x128a5d(0x15f)][_0x128a5d(0x163)][_0x128a5d(0x150)]({'where':{'id':_0x4d608c},'data':{'publicKey':_0x3f62dd,'secretKey':_0x324316}});}async[a60_0x3e5820(0x152)](_0x181243,_0x2b5e3b){const _0x20c7be=a60_0x3e5820,{passwordConfirmation:_0x52b99d}=_0x2b5e3b,_0x49dca2=await database_1[_0x20c7be(0x15f)][_0x20c7be(0x163)][_0x20c7be(0x13e)]({'where':{'id':_0x181243},'select':{'password':!![]}});if(!_0x49dca2)throw new Error(_0x20c7be(0x147));const _0x389cfb=await bcryptjs_1[_0x20c7be(0x15f)][_0x20c7be(0x136)](_0x52b99d,_0x49dca2[_0x20c7be(0x14c)]);if(!_0x389cfb)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x20c7be(0x15f)][_0x20c7be(0x163)][_0x20c7be(0x15e)]({'where':{'id':_0x181243}});}async[a60_0x3e5820(0x13a)](_0xddeaa0){const _0xc93769=a60_0x3e5820,_0x3e0e03=await database_1[_0xc93769(0x15f)][_0xc93769(0x16c)][_0xc93769(0x13e)]({'where':{'shopId':_0xddeaa0}});!_0x3e0e03&&await database_1[_0xc93769(0x15f)][_0xc93769(0x16c)][_0xc93769(0x156)]({'data':{'shopId':_0xddeaa0}});}}exports[a60_0x3e5820(0x154)]=SettingsService;function a60_0x53e8(_0x2b6526,_0x163a50){const _0x52e196=a60_0x52e1();return a60_0x53e8=function(_0x53e83b,_0x41f1be){_0x53e83b=_0x53e83b-0x130;let _0x3dd49d=_0x52e196[_0x53e83b];return _0x3dd49d;},a60_0x53e8(_0x2b6526,_0x163a50);}function a60_0x52e1(){const _0x32691d=['chatId','repeat','webhookEvents','string','botApiKey','Current\x20password\x20is\x20incorrect','telegramChatId','shopSettings','45973030IlBugC','3423022OpMyds','settings','maskApiKey','4315661voBxzu','parse','notificationPaymentSuccess','notificationRefund','bcryptjs','shopUrl','name','pk_','getShopSettings','compare','notificationApiError','refund','__esModule','ensureSettingsExist','login','substring','randomBytes','findUnique','5aMMrrF','api_error','length','changePassword','payment_failed','5072568nNjDHz','14000128eTAvkI','isArray','Shop\x20not\x20found','telegram','hex','webhookUrl','1310729hdkJNG','password','notificationPaymentFailed','../config/database','parseWebhookEvents','update','telegramBotApiKey','deleteAccount','defineProperty','SettingsService','updateWebhookSettings','create','notificationLogin','payout','hash','5346000KjXhBp','payment_success','crypto','sk_','delete','default','notificationPayout','9AKdyey','3IRAQSj','shop','New\x20password\x20and\x20confirmation\x20do\x20not\x20match'];a60_0x52e1=function(){return _0x32691d;};return a60_0x52e1();}