'use strict';function a52_0xfc07(_0x51ef7a,_0x1a9c81){const _0x3c117d=a52_0x3c11();return a52_0xfc07=function(_0xfc07d9,_0x1b4180){_0xfc07d9=_0xfc07d9-0x7a;let _0x50ff8a=_0x3c117d[_0xfc07d9];return _0x50ff8a;},a52_0xfc07(_0x51ef7a,_0x1a9c81);}const a52_0x23a55a=a52_0xfc07;(function(_0x31c446,_0x33d98){const _0x4d0b75=a52_0xfc07,_0x126d05=_0x31c446();while(!![]){try{const _0x5e96aa=-parseInt(_0x4d0b75(0xae))/0x1+parseInt(_0x4d0b75(0x83))/0x2+parseInt(_0x4d0b75(0x94))/0x3*(parseInt(_0x4d0b75(0xa4))/0x4)+parseInt(_0x4d0b75(0x89))/0x5+-parseInt(_0x4d0b75(0xa7))/0x6+parseInt(_0x4d0b75(0x9c))/0x7*(-parseInt(_0x4d0b75(0x8a))/0x8)+-parseInt(_0x4d0b75(0x8e))/0x9;if(_0x5e96aa===_0x33d98)break;else _0x126d05['push'](_0x126d05['shift']());}catch(_0x5868c9){_0x126d05['push'](_0x126d05['shift']());}}}(a52_0x3c11,0xcde8b));var __importDefault=this&&this[a52_0x23a55a(0x9a)]||function(_0x3ee3fb){const _0x33f1e9=a52_0x23a55a;return _0x3ee3fb&&_0x3ee3fb[_0x33f1e9(0x7f)]?_0x3ee3fb:{'default':_0x3ee3fb};};Object[a52_0x23a55a(0xaf)](exports,'__esModule',{'value':!![]}),exports[a52_0x23a55a(0xa2)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x23a55a(0x7a))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a52_0x23a55a(0x7d)));class SettingsService{[a52_0x23a55a(0x88)](_0x270bd1){const _0x2dd59c=a52_0x23a55a;if(!_0x270bd1)return'';if(_0x270bd1[_0x2dd59c(0x80)]<=0x8)return _0x270bd1;const _0x24c2c9=_0x270bd1['substring'](0x0,0x8),_0x340162='*'['repeat'](Math[_0x2dd59c(0xa1)](0x0,_0x270bd1[_0x2dd59c(0x80)]-0x8));return _0x24c2c9+_0x340162;}[a52_0x23a55a(0xb9)](_0x111cc8){const _0x33a85c=a52_0x23a55a;if(!_0x111cc8)return[];if(Array[_0x33a85c(0x9e)](_0x111cc8))return _0x111cc8;if(typeof _0x111cc8===_0x33a85c(0xb5))try{const _0x30e375=JSON[_0x33a85c(0xa5)](_0x111cc8);return Array[_0x33a85c(0x9e)](_0x30e375)?_0x30e375:[];}catch{return[];}return[];}async['getShopSettings'](_0x5c4a26){const _0x8b8be7=a52_0x23a55a,_0x22d549=await database_1[_0x8b8be7(0xb6)]['shop'][_0x8b8be7(0x7b)]({'where':{'id':_0x5c4a26},'include':{'settings':!![]}});if(!_0x22d549)throw new Error(_0x8b8be7(0xab));let _0x47c989=_0x22d549[_0x8b8be7(0xac)];return!_0x47c989&&(_0x47c989=await database_1[_0x8b8be7(0xb6)][_0x8b8be7(0xb3)][_0x8b8be7(0xa9)]({'data':{'shopId':_0x22d549['id']}})),{'fullName':_0x22d549[_0x8b8be7(0x98)],'brand':_0x22d549[_0x8b8be7(0x98)],'merchantUrl':_0x22d549[_0x8b8be7(0x8c)],'telegramUsername':_0x22d549['telegram'],'telegramBotApiKey':_0x47c989[_0x8b8be7(0x86)]?this[_0x8b8be7(0x88)](_0x47c989[_0x8b8be7(0x86)]):null,'telegramChatId':_0x47c989['telegramChatId'],'webhookUrl':_0x47c989['webhookUrl'],'webhookEvents':this[_0x8b8be7(0xb9)](_0x47c989['webhookEvents']),'notifications':{'payment_success':_0x47c989[_0x8b8be7(0x90)],'payment_failed':_0x47c989[_0x8b8be7(0x82)],'refund':_0x47c989[_0x8b8be7(0x8f)],'payout':_0x47c989[_0x8b8be7(0x92)],'login':_0x47c989[_0x8b8be7(0x99)],'api_error':_0x47c989['notificationApiError']}};}async[a52_0x23a55a(0x91)](_0x1b55bd,_0x2fdab5){const _0x5abf15=a52_0x23a55a,{currentPassword:_0x3ddaeb,newPassword:_0x55474b,confirmNewPassword:_0x53f79c}=_0x2fdab5;if(_0x55474b!==_0x53f79c)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x55474b[_0x5abf15(0x80)]<0x6)throw new Error(_0x5abf15(0xa3));const _0x51a6f2=await database_1[_0x5abf15(0xb6)][_0x5abf15(0xb2)][_0x5abf15(0x7b)]({'where':{'id':_0x1b55bd},'select':{'password':!![]}});if(!_0x51a6f2)throw new Error(_0x5abf15(0xab));const _0x19af5b=await bcryptjs_1[_0x5abf15(0xb6)]['compare'](_0x3ddaeb,_0x51a6f2['password']);if(!_0x19af5b)throw new Error(_0x5abf15(0x81));const _0x53229f=await bcryptjs_1['default'][_0x5abf15(0x8d)](_0x55474b,0xc);await database_1[_0x5abf15(0xb6)]['shop'][_0x5abf15(0x9f)]({'where':{'id':_0x1b55bd},'data':{'password':_0x53229f}});}async[a52_0x23a55a(0xa0)](_0x4505d9,_0x4cf416){const _0x3d2ac6=a52_0x23a55a;await this[_0x3d2ac6(0x7c)](_0x4505d9);const _0x452e07={};_0x4cf416[_0x3d2ac6(0xa6)]!==undefined&&(_0x452e07[_0x3d2ac6(0x90)]=_0x4cf416[_0x3d2ac6(0xa6)]),_0x4cf416['payment_failed']!==undefined&&(_0x452e07[_0x3d2ac6(0x82)]=_0x4cf416[_0x3d2ac6(0x87)]),_0x4cf416['refund']!==undefined&&(_0x452e07['notificationRefund']=_0x4cf416[_0x3d2ac6(0xb0)]),_0x4cf416[_0x3d2ac6(0x7e)]!==undefined&&(_0x452e07[_0x3d2ac6(0x92)]=_0x4cf416[_0x3d2ac6(0x7e)]),_0x4cf416[_0x3d2ac6(0xad)]!==undefined&&(_0x452e07[_0x3d2ac6(0x99)]=_0x4cf416['login']),_0x4cf416[_0x3d2ac6(0xa8)]!==undefined&&(_0x452e07['notificationApiError']=_0x4cf416[_0x3d2ac6(0xa8)]),await database_1['default'][_0x3d2ac6(0xb3)][_0x3d2ac6(0x9f)]({'where':{'shopId':_0x4505d9},'data':_0x452e07});}async['updateTelegramSettings'](_0x495756,_0x5eae69){const _0x25f7ef=a52_0x23a55a;await this[_0x25f7ef(0x7c)](_0x495756);const _0x567d39={};_0x5eae69[_0x25f7ef(0x96)]!==undefined&&(_0x567d39['telegramBotApiKey']=_0x5eae69[_0x25f7ef(0x96)]||null),_0x5eae69[_0x25f7ef(0xaa)]!==undefined&&(_0x567d39['telegramChatId']=_0x5eae69[_0x25f7ef(0xaa)]||null),await database_1[_0x25f7ef(0xb6)][_0x25f7ef(0xb3)][_0x25f7ef(0x9f)]({'where':{'shopId':_0x495756},'data':_0x567d39});}async[a52_0x23a55a(0xb1)](_0x12d102,_0xf89e62){const _0x48b320=a52_0x23a55a;await this['ensureSettingsExist'](_0x12d102);const _0x519052={};_0xf89e62[_0x48b320(0x95)]!==undefined&&(_0x519052['webhookUrl']=_0xf89e62[_0x48b320(0x95)]||null),_0xf89e62['webhookEvents']!==undefined&&(_0x519052[_0x48b320(0x9b)]=_0xf89e62['webhookEvents']||[]),await database_1[_0x48b320(0xb6)][_0x48b320(0xb3)][_0x48b320(0x9f)]({'where':{'shopId':_0x12d102},'data':_0x519052});}async[a52_0x23a55a(0xb4)](_0x1f8d3c){const _0x2cbc54=a52_0x23a55a,_0x8f8bb5=_0x2cbc54(0x97)+crypto_1[_0x2cbc54(0xb6)][_0x2cbc54(0x85)](0x20)[_0x2cbc54(0xb8)](_0x2cbc54(0xb7)),_0x4f1d57=_0x2cbc54(0x84)+crypto_1[_0x2cbc54(0xb6)][_0x2cbc54(0x85)](0x20)[_0x2cbc54(0xb8)](_0x2cbc54(0xb7));await database_1[_0x2cbc54(0xb6)][_0x2cbc54(0xb2)][_0x2cbc54(0x9f)]({'where':{'id':_0x1f8d3c},'data':{'publicKey':_0x8f8bb5,'secretKey':_0x4f1d57}});}async['deleteAccount'](_0x58f6f8,_0x321ab1){const _0x45e56f=a52_0x23a55a,{passwordConfirmation:_0x2392f3}=_0x321ab1,_0x3ba47b=await database_1[_0x45e56f(0xb6)][_0x45e56f(0xb2)][_0x45e56f(0x7b)]({'where':{'id':_0x58f6f8},'select':{'password':!![]}});if(!_0x3ba47b)throw new Error('Shop\x20not\x20found');const _0x3482d5=await bcryptjs_1[_0x45e56f(0xb6)][_0x45e56f(0x8b)](_0x2392f3,_0x3ba47b['password']);if(!_0x3482d5)throw new Error(_0x45e56f(0x93));await database_1['default'][_0x45e56f(0xb2)][_0x45e56f(0x9d)]({'where':{'id':_0x58f6f8}});}async['ensureSettingsExist'](_0x160bb8){const _0x193d36=a52_0x23a55a,_0x97e1a2=await database_1[_0x193d36(0xb6)]['shopSettings']['findUnique']({'where':{'shopId':_0x160bb8}});!_0x97e1a2&&await database_1[_0x193d36(0xb6)][_0x193d36(0xb3)]['create']({'data':{'shopId':_0x160bb8}});}}exports['SettingsService']=SettingsService;function a52_0x3c11(){const _0x306d91=['api_error','create','chatId','Shop\x20not\x20found','settings','login','317658ZdIhdT','defineProperty','refund','updateWebhookSettings','shop','shopSettings','revokeAllApiKeys','string','default','hex','toString','parseWebhookEvents','bcryptjs','findUnique','ensureSettingsExist','../config/database','payout','__esModule','length','Current\x20password\x20is\x20incorrect','notificationPaymentFailed','2846882kUysBQ','sk_','randomBytes','telegramBotApiKey','payment_failed','maskApiKey','7684835JIWLgT','4167496enUYsk','compare','shopUrl','hash','9816678mdDoBu','notificationRefund','notificationPaymentSuccess','changePassword','notificationPayout','Password\x20confirmation\x20is\x20incorrect','5373sYDVos','webhookUrl','botApiKey','pk_','name','notificationLogin','__importDefault','webhookEvents','14hwIcvz','delete','isArray','update','updateNotifications','max','SettingsService','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','2836UwEzPl','parse','payment_success','5619300LWTIjZ'];a52_0x3c11=function(){return _0x306d91;};return a52_0x3c11();}