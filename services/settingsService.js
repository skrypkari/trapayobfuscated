'use strict';const a51_0x314269=a51_0x5d5e;(function(_0x3d6078,_0x302c55){const _0x457f7c=a51_0x5d5e,_0x4e72f9=_0x3d6078();while(!![]){try{const _0x4ba030=-parseInt(_0x457f7c(0x1ca))/0x1+-parseInt(_0x457f7c(0x1e2))/0x2+parseInt(_0x457f7c(0x1cb))/0x3*(parseInt(_0x457f7c(0x1bb))/0x4)+parseInt(_0x457f7c(0x1ec))/0x5+parseInt(_0x457f7c(0x1c8))/0x6+-parseInt(_0x457f7c(0x1f7))/0x7*(-parseInt(_0x457f7c(0x1f4))/0x8)+parseInt(_0x457f7c(0x1be))/0x9*(parseInt(_0x457f7c(0x1c0))/0xa);if(_0x4ba030===_0x302c55)break;else _0x4e72f9['push'](_0x4e72f9['shift']());}catch(_0x17a3db){_0x4e72f9['push'](_0x4e72f9['shift']());}}}(a51_0x362a,0xe3d41));var __importDefault=this&&this[a51_0x314269(0x1d7)]||function(_0x356b0e){const _0x30bdc4=a51_0x314269;return _0x356b0e&&_0x356b0e[_0x30bdc4(0x1f5)]?_0x356b0e:{'default':_0x356b0e};};Object[a51_0x314269(0x1ea)](exports,a51_0x314269(0x1f5),{'value':!![]}),exports[a51_0x314269(0x1bf)]=void 0x0;const bcryptjs_1=__importDefault(require(a51_0x314269(0x1f3))),crypto_1=__importDefault(require(a51_0x314269(0x1ef))),database_1=__importDefault(require(a51_0x314269(0x1e3)));function a51_0x5d5e(_0xd3a920,_0x23c0d0){const _0x362ab4=a51_0x362a();return a51_0x5d5e=function(_0x5d5ee5,_0x3e0fae){_0x5d5ee5=_0x5d5ee5-0x1b4;let _0x209543=_0x362ab4[_0x5d5ee5];return _0x209543;},a51_0x5d5e(_0xd3a920,_0x23c0d0);}class SettingsService{[a51_0x314269(0x1e7)](_0x19b293){const _0x39441f=a51_0x314269;if(!_0x19b293)return'';if(_0x19b293['length']<=0x8)return _0x19b293;const _0x5c2fc7=_0x19b293[_0x39441f(0x1b6)](0x0,0x8),_0x34d6f6='*'[_0x39441f(0x1bd)](Math[_0x39441f(0x1e4)](0x0,_0x19b293[_0x39441f(0x1e5)]-0x8));return _0x5c2fc7+_0x34d6f6;}[a51_0x314269(0x1c9)](_0x18e694){const _0x10823e=a51_0x314269;if(!_0x18e694)return[];if(Array[_0x10823e(0x1cc)](_0x18e694))return _0x18e694;if(typeof _0x18e694==='string')try{const _0xe08c38=JSON['parse'](_0x18e694);return Array[_0x10823e(0x1cc)](_0xe08c38)?_0xe08c38:[];}catch{return[];}return[];}async['getShopSettings'](_0x3095d2){const _0x30da08=a51_0x314269,_0x1c1abe=await database_1[_0x30da08(0x1de)]['shop'][_0x30da08(0x1f0)]({'where':{'id':_0x3095d2},'include':{'settings':!![]}});if(!_0x1c1abe)throw new Error('Shop\x20not\x20found');let _0x524552=_0x1c1abe['settings'];return!_0x524552&&(_0x524552=await database_1[_0x30da08(0x1de)][_0x30da08(0x1b4)]['create']({'data':{'shopId':_0x1c1abe['id']}})),{'fullName':_0x1c1abe[_0x30da08(0x1c2)],'brand':_0x1c1abe['name'],'merchantUrl':_0x1c1abe['shopUrl'],'telegramUsername':_0x1c1abe[_0x30da08(0x1e6)],'telegramBotApiKey':_0x524552[_0x30da08(0x1c1)]?this['maskApiKey'](_0x524552[_0x30da08(0x1c1)]):null,'telegramChatId':_0x524552['telegramChatId'],'webhookUrl':_0x524552[_0x30da08(0x1dc)],'webhookEvents':this[_0x30da08(0x1c9)](_0x524552[_0x30da08(0x1ce)]),'notifications':{'payment_success':_0x524552['notificationPaymentSuccess'],'payment_failed':_0x524552[_0x30da08(0x1da)],'refund':_0x524552['notificationRefund'],'payout':_0x524552['notificationPayout'],'login':_0x524552['notificationLogin'],'api_error':_0x524552[_0x30da08(0x1c4)]}};}async[a51_0x314269(0x1ee)](_0xda39fb,_0x429856){const _0x55eabf=a51_0x314269,{currentPassword:_0x158502,newPassword:_0x436693,confirmNewPassword:_0x18cf7b}=_0x429856;if(_0x436693!==_0x18cf7b)throw new Error(_0x55eabf(0x1c5));if(_0x436693[_0x55eabf(0x1e5)]<0x6)throw new Error(_0x55eabf(0x1b5));const _0x3eb91c=await database_1[_0x55eabf(0x1de)][_0x55eabf(0x1f6)]['findUnique']({'where':{'id':_0xda39fb},'select':{'password':!![]}});if(!_0x3eb91c)throw new Error(_0x55eabf(0x1b9));const _0x4fea70=await bcryptjs_1[_0x55eabf(0x1de)][_0x55eabf(0x1f1)](_0x158502,_0x3eb91c['password']);if(!_0x4fea70)throw new Error(_0x55eabf(0x1e9));const _0x315f2a=await bcryptjs_1[_0x55eabf(0x1de)][_0x55eabf(0x1e0)](_0x436693,0xc);await database_1[_0x55eabf(0x1de)][_0x55eabf(0x1f6)]['update']({'where':{'id':_0xda39fb},'data':{'password':_0x315f2a}});}async[a51_0x314269(0x1eb)](_0x497277,_0x1d6c39){const _0x155bfb=a51_0x314269;await this[_0x155bfb(0x1d2)](_0x497277);const _0xdea589={};_0x1d6c39['payment_success']!==undefined&&(_0xdea589['notificationPaymentSuccess']=_0x1d6c39[_0x155bfb(0x1d4)]),_0x1d6c39[_0x155bfb(0x1d1)]!==undefined&&(_0xdea589[_0x155bfb(0x1da)]=_0x1d6c39[_0x155bfb(0x1d1)]),_0x1d6c39[_0x155bfb(0x1cd)]!==undefined&&(_0xdea589[_0x155bfb(0x1d0)]=_0x1d6c39['refund']),_0x1d6c39[_0x155bfb(0x1dd)]!==undefined&&(_0xdea589[_0x155bfb(0x1d9)]=_0x1d6c39[_0x155bfb(0x1dd)]),_0x1d6c39['login']!==undefined&&(_0xdea589['notificationLogin']=_0x1d6c39[_0x155bfb(0x1c6)]),_0x1d6c39[_0x155bfb(0x1c3)]!==undefined&&(_0xdea589[_0x155bfb(0x1c4)]=_0x1d6c39['api_error']),await database_1[_0x155bfb(0x1de)][_0x155bfb(0x1b4)][_0x155bfb(0x1b7)]({'where':{'shopId':_0x497277},'data':_0xdea589});}async[a51_0x314269(0x1d8)](_0xd2735,_0x1fb743){const _0x489a0b=a51_0x314269;await this['ensureSettingsExist'](_0xd2735);const _0x5da669={};_0x1fb743['botApiKey']!==undefined&&(_0x5da669[_0x489a0b(0x1c1)]=_0x1fb743[_0x489a0b(0x1d5)]||null),_0x1fb743[_0x489a0b(0x1db)]!==undefined&&(_0x5da669[_0x489a0b(0x1c7)]=_0x1fb743[_0x489a0b(0x1db)]||null),await database_1[_0x489a0b(0x1de)][_0x489a0b(0x1b4)][_0x489a0b(0x1b7)]({'where':{'shopId':_0xd2735},'data':_0x5da669});}async[a51_0x314269(0x1ed)](_0x423fd6,_0x4de241){const _0x3524b6=a51_0x314269;await this['ensureSettingsExist'](_0x423fd6);const _0x1122b6={};_0x4de241[_0x3524b6(0x1dc)]!==undefined&&(_0x1122b6[_0x3524b6(0x1dc)]=_0x4de241[_0x3524b6(0x1dc)]||null),_0x4de241['webhookEvents']!==undefined&&(_0x1122b6[_0x3524b6(0x1ce)]=_0x4de241[_0x3524b6(0x1ce)]||[]),await database_1[_0x3524b6(0x1de)][_0x3524b6(0x1b4)]['update']({'where':{'shopId':_0x423fd6},'data':_0x1122b6});}async[a51_0x314269(0x1f2)](_0x4ce7b8){const _0x5cbfb4=a51_0x314269,_0x11180e=_0x5cbfb4(0x1e1)+crypto_1['default']['randomBytes'](0x20)[_0x5cbfb4(0x1d3)](_0x5cbfb4(0x1b8)),_0x46a7e3=_0x5cbfb4(0x1e8)+crypto_1[_0x5cbfb4(0x1de)][_0x5cbfb4(0x1bc)](0x20)['toString'](_0x5cbfb4(0x1b8));await database_1[_0x5cbfb4(0x1de)]['shop'][_0x5cbfb4(0x1b7)]({'where':{'id':_0x4ce7b8},'data':{'publicKey':_0x11180e,'secretKey':_0x46a7e3}});}async['deleteAccount'](_0x505831,_0x42a79a){const _0x168c00=a51_0x314269,{passwordConfirmation:_0x1f033e}=_0x42a79a,_0x2a63ae=await database_1[_0x168c00(0x1de)]['shop'][_0x168c00(0x1f0)]({'where':{'id':_0x505831},'select':{'password':!![]}});if(!_0x2a63ae)throw new Error(_0x168c00(0x1b9));const _0x212ef3=await bcryptjs_1[_0x168c00(0x1de)][_0x168c00(0x1f1)](_0x1f033e,_0x2a63ae[_0x168c00(0x1ba)]);if(!_0x212ef3)throw new Error(_0x168c00(0x1df));await database_1[_0x168c00(0x1de)]['shop'][_0x168c00(0x1d6)]({'where':{'id':_0x505831}});}async[a51_0x314269(0x1d2)](_0x4c4b05){const _0x204777=a51_0x314269,_0x216210=await database_1[_0x204777(0x1de)][_0x204777(0x1b4)]['findUnique']({'where':{'shopId':_0x4c4b05}});!_0x216210&&await database_1[_0x204777(0x1de)]['shopSettings'][_0x204777(0x1cf)]({'data':{'shopId':_0x4c4b05}});}}function a51_0x362a(){const _0x132709=['telegramBotApiKey','name','api_error','notificationApiError','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','login','telegramChatId','6270054iUrpwY','parseWebhookEvents','1659300SBWxcT','137562PShXFz','isArray','refund','webhookEvents','create','notificationRefund','payment_failed','ensureSettingsExist','toString','payment_success','botApiKey','delete','__importDefault','updateTelegramSettings','notificationPayout','notificationPaymentFailed','chatId','webhookUrl','payout','default','Password\x20confirmation\x20is\x20incorrect','hash','pk_','2475364jiUoPp','../config/database','max','length','telegram','maskApiKey','sk_','Current\x20password\x20is\x20incorrect','defineProperty','updateNotifications','8545205kydXnS','updateWebhookSettings','changePassword','crypto','findUnique','compare','revokeAllApiKeys','bcryptjs','4835152LAMytE','__esModule','shop','7Pqxhno','shopSettings','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','substring','update','hex','Shop\x20not\x20found','password','20LfeoEa','randomBytes','repeat','2182077GBZfWV','SettingsService','10lqJpHS'];a51_0x362a=function(){return _0x132709;};return a51_0x362a();}exports[a51_0x314269(0x1bf)]=SettingsService;