'use strict';const a53_0x1fded4=a53_0x566b;function a53_0x1e7e(){const _0x3111dc=['275DhniDO','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','shopUrl','payout','24JpDSya','payment_success','12HfYKtU','notificationLogin','login','name','hex','Shop\x20not\x20found','create','findUnique','notificationPaymentSuccess','webhookUrl','notificationRefund','password','toString','1845249wTbOYy','14801553BxrBxT','7270sjSUfa','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','Current\x20password\x20is\x20incorrect','2McVvfB','shopSettings','refund','11496DGetAU','revokeAllApiKeys','__esModule','updateNotifications','botApiKey','isArray','length','update','telegram','telegramBotApiKey','substring','__importDefault','Password\x20confirmation\x20is\x20incorrect','changePassword','../config/database','getShopSettings','pk_','3ZwOXJp','repeat','settings','compare','notificationPayout','parseWebhookEvents','payment_failed','telegramChatId','crypto','ensureSettingsExist','randomBytes','max','sk_','bcryptjs','114610szLSFm','maskApiKey','698787QanKxn','notificationPaymentFailed','default','96736OrjlCq','webhookEvents','chatId','string','shop','notificationApiError','SettingsService','api_error','500wcliod'];a53_0x1e7e=function(){return _0x3111dc;};return a53_0x1e7e();}(function(_0x45efb5,_0x1aea94){const _0x3a4eed=a53_0x566b,_0x2abdbb=_0x45efb5();while(!![]){try{const _0x5478b5=parseInt(_0x3a4eed(0xec))/0x1*(parseInt(_0x3a4eed(0xe9))/0x2)+-parseInt(_0x3a4eed(0x100))/0x3*(parseInt(_0x3a4eed(0xcb))/0x4)+parseInt(_0x3a4eed(0xd3))/0x5*(-parseInt(_0x3a4eed(0xef))/0x6)+-parseInt(_0x3a4eed(0xe7))/0x7+parseInt(_0x3a4eed(0xd8))/0x8*(-parseInt(_0x3a4eed(0xc8))/0x9)+parseInt(_0x3a4eed(0xc6))/0xa*(-parseInt(_0x3a4eed(0xd4))/0xb)+parseInt(_0x3a4eed(0xda))/0xc*(parseInt(_0x3a4eed(0xe8))/0xd);if(_0x5478b5===_0x1aea94)break;else _0x2abdbb['push'](_0x2abdbb['shift']());}catch(_0x10077e){_0x2abdbb['push'](_0x2abdbb['shift']());}}}(a53_0x1e7e,0x23e3e));function a53_0x566b(_0x583fd7,_0x286847){const _0x1e7e2b=a53_0x1e7e();return a53_0x566b=function(_0x566b36,_0x2e152f){_0x566b36=_0x566b36-0xbf;let _0x5e7321=_0x1e7e2b[_0x566b36];return _0x5e7321;},a53_0x566b(_0x583fd7,_0x286847);}var __importDefault=this&&this[a53_0x1fded4(0xfa)]||function(_0xcceeb){const _0x5aa2ea=a53_0x1fded4;return _0xcceeb&&_0xcceeb[_0x5aa2ea(0xf1)]?_0xcceeb:{'default':_0xcceeb};};Object['defineProperty'](exports,a53_0x1fded4(0xf1),{'value':!![]}),exports[a53_0x1fded4(0xd1)]=void 0x0;const bcryptjs_1=__importDefault(require(a53_0x1fded4(0xc5))),crypto_1=__importDefault(require(a53_0x1fded4(0xc0))),database_1=__importDefault(require(a53_0x1fded4(0xfd)));class SettingsService{[a53_0x1fded4(0xc7)](_0xc9e347){const _0x373a29=a53_0x1fded4;if(!_0xc9e347)return'';if(_0xc9e347[_0x373a29(0xf5)]<=0x8)return _0xc9e347;const _0x48fa23=_0xc9e347[_0x373a29(0xf9)](0x0,0x8),_0x4f8ea5='*'[_0x373a29(0x101)](Math[_0x373a29(0xc3)](0x0,_0xc9e347['length']-0x8));return _0x48fa23+_0x4f8ea5;}[a53_0x1fded4(0x105)](_0x2f9051){const _0x363dc9=a53_0x1fded4;if(!_0x2f9051)return[];if(Array[_0x363dc9(0xf4)](_0x2f9051))return _0x2f9051;if(typeof _0x2f9051===_0x363dc9(0xce))try{const _0x27d372=JSON['parse'](_0x2f9051);return Array[_0x363dc9(0xf4)](_0x27d372)?_0x27d372:[];}catch{return[];}return[];}async[a53_0x1fded4(0xfe)](_0x4d3f05){const _0x2dd8bf=a53_0x1fded4,_0x3a7422=await database_1[_0x2dd8bf(0xca)][_0x2dd8bf(0xcf)][_0x2dd8bf(0xe1)]({'where':{'id':_0x4d3f05},'include':{'settings':!![]}});if(!_0x3a7422)throw new Error(_0x2dd8bf(0xdf));let _0x3a4630=_0x3a7422[_0x2dd8bf(0x102)];return!_0x3a4630&&(_0x3a4630=await database_1[_0x2dd8bf(0xca)]['shopSettings'][_0x2dd8bf(0xe0)]({'data':{'shopId':_0x3a7422['id']}})),{'fullName':_0x3a7422[_0x2dd8bf(0xdd)],'brand':_0x3a7422['name'],'merchantUrl':_0x3a7422[_0x2dd8bf(0xd6)],'telegramUsername':_0x3a7422[_0x2dd8bf(0xf7)],'telegramBotApiKey':_0x3a4630[_0x2dd8bf(0xf8)]?this[_0x2dd8bf(0xc7)](_0x3a4630['telegramBotApiKey']):null,'telegramChatId':_0x3a4630[_0x2dd8bf(0xbf)],'webhookUrl':_0x3a4630['webhookUrl'],'webhookEvents':this[_0x2dd8bf(0x105)](_0x3a4630['webhookEvents']),'notifications':{'payment_success':_0x3a4630[_0x2dd8bf(0xe2)],'payment_failed':_0x3a4630[_0x2dd8bf(0xc9)],'refund':_0x3a4630[_0x2dd8bf(0xe4)],'payout':_0x3a4630[_0x2dd8bf(0x104)],'login':_0x3a4630[_0x2dd8bf(0xdb)],'api_error':_0x3a4630[_0x2dd8bf(0xd0)]}};}async[a53_0x1fded4(0xfc)](_0x393b89,_0x388645){const _0x1ef355=a53_0x1fded4,{currentPassword:_0x250712,newPassword:_0x38ce47,confirmNewPassword:_0x10b39}=_0x388645;if(_0x38ce47!==_0x10b39)throw new Error(_0x1ef355(0xea));if(_0x38ce47[_0x1ef355(0xf5)]<0x6)throw new Error(_0x1ef355(0xd5));const _0x2212c0=await database_1[_0x1ef355(0xca)][_0x1ef355(0xcf)][_0x1ef355(0xe1)]({'where':{'id':_0x393b89},'select':{'password':!![]}});if(!_0x2212c0)throw new Error(_0x1ef355(0xdf));const _0x2b23f9=await bcryptjs_1[_0x1ef355(0xca)][_0x1ef355(0x103)](_0x250712,_0x2212c0[_0x1ef355(0xe5)]);if(!_0x2b23f9)throw new Error(_0x1ef355(0xeb));const _0x3d224c=await bcryptjs_1[_0x1ef355(0xca)]['hash'](_0x38ce47,0xc);await database_1[_0x1ef355(0xca)]['shop'][_0x1ef355(0xf6)]({'where':{'id':_0x393b89},'data':{'password':_0x3d224c}});}async[a53_0x1fded4(0xf2)](_0x2e5505,_0x4fb9ee){const _0x1c4e66=a53_0x1fded4;await this[_0x1c4e66(0xc1)](_0x2e5505);const _0xd667ad={};_0x4fb9ee['payment_success']!==undefined&&(_0xd667ad['notificationPaymentSuccess']=_0x4fb9ee[_0x1c4e66(0xd9)]),_0x4fb9ee['payment_failed']!==undefined&&(_0xd667ad[_0x1c4e66(0xc9)]=_0x4fb9ee[_0x1c4e66(0x106)]),_0x4fb9ee[_0x1c4e66(0xee)]!==undefined&&(_0xd667ad[_0x1c4e66(0xe4)]=_0x4fb9ee['refund']),_0x4fb9ee[_0x1c4e66(0xd7)]!==undefined&&(_0xd667ad[_0x1c4e66(0x104)]=_0x4fb9ee['payout']),_0x4fb9ee[_0x1c4e66(0xdc)]!==undefined&&(_0xd667ad[_0x1c4e66(0xdb)]=_0x4fb9ee[_0x1c4e66(0xdc)]),_0x4fb9ee['api_error']!==undefined&&(_0xd667ad[_0x1c4e66(0xd0)]=_0x4fb9ee[_0x1c4e66(0xd2)]),await database_1[_0x1c4e66(0xca)][_0x1c4e66(0xed)][_0x1c4e66(0xf6)]({'where':{'shopId':_0x2e5505},'data':_0xd667ad});}async['updateTelegramSettings'](_0x124c6e,_0x56ac4c){const _0x566f8e=a53_0x1fded4;await this[_0x566f8e(0xc1)](_0x124c6e);const _0x5b3839={};_0x56ac4c['botApiKey']!==undefined&&(_0x5b3839[_0x566f8e(0xf8)]=_0x56ac4c[_0x566f8e(0xf3)]||null),_0x56ac4c[_0x566f8e(0xcd)]!==undefined&&(_0x5b3839[_0x566f8e(0xbf)]=_0x56ac4c[_0x566f8e(0xcd)]||null),await database_1[_0x566f8e(0xca)][_0x566f8e(0xed)][_0x566f8e(0xf6)]({'where':{'shopId':_0x124c6e},'data':_0x5b3839});}async['updateWebhookSettings'](_0x5f039d,_0x2cad35){const _0x52cbeb=a53_0x1fded4;await this['ensureSettingsExist'](_0x5f039d);const _0x19cb6e={};_0x2cad35[_0x52cbeb(0xe3)]!==undefined&&(_0x19cb6e[_0x52cbeb(0xe3)]=_0x2cad35[_0x52cbeb(0xe3)]||null),_0x2cad35[_0x52cbeb(0xcc)]!==undefined&&(_0x19cb6e['webhookEvents']=_0x2cad35[_0x52cbeb(0xcc)]||[]),await database_1[_0x52cbeb(0xca)][_0x52cbeb(0xed)]['update']({'where':{'shopId':_0x5f039d},'data':_0x19cb6e});}async[a53_0x1fded4(0xf0)](_0x25a89e){const _0xd6427d=a53_0x1fded4,_0x128671=_0xd6427d(0xff)+crypto_1[_0xd6427d(0xca)][_0xd6427d(0xc2)](0x20)[_0xd6427d(0xe6)](_0xd6427d(0xde)),_0x11189a=_0xd6427d(0xc4)+crypto_1[_0xd6427d(0xca)]['randomBytes'](0x20)[_0xd6427d(0xe6)](_0xd6427d(0xde));await database_1[_0xd6427d(0xca)][_0xd6427d(0xcf)][_0xd6427d(0xf6)]({'where':{'id':_0x25a89e},'data':{'publicKey':_0x128671,'secretKey':_0x11189a}});}async['deleteAccount'](_0x298264,_0x2b5e5b){const _0x1467d5=a53_0x1fded4,{passwordConfirmation:_0x1ede85}=_0x2b5e5b,_0x39f462=await database_1['default'][_0x1467d5(0xcf)][_0x1467d5(0xe1)]({'where':{'id':_0x298264},'select':{'password':!![]}});if(!_0x39f462)throw new Error(_0x1467d5(0xdf));const _0x231bb5=await bcryptjs_1[_0x1467d5(0xca)][_0x1467d5(0x103)](_0x1ede85,_0x39f462[_0x1467d5(0xe5)]);if(!_0x231bb5)throw new Error(_0x1467d5(0xfb));await database_1[_0x1467d5(0xca)][_0x1467d5(0xcf)]['delete']({'where':{'id':_0x298264}});}async[a53_0x1fded4(0xc1)](_0x10505a){const _0x4f34ff=a53_0x1fded4,_0x48adc1=await database_1['default'][_0x4f34ff(0xed)][_0x4f34ff(0xe1)]({'where':{'shopId':_0x10505a}});!_0x48adc1&&await database_1[_0x4f34ff(0xca)]['shopSettings'][_0x4f34ff(0xe0)]({'data':{'shopId':_0x10505a}});}}exports[a53_0x1fded4(0xd1)]=SettingsService;