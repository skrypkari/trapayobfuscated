'use strict';const a47_0x24e346=a47_0x2d8c;(function(_0x26a89c,_0x5f50be){const _0x2e3fde=a47_0x2d8c,_0x19dded=_0x26a89c();while(!![]){try{const _0x308c6f=parseInt(_0x2e3fde(0x10e))/0x1+-parseInt(_0x2e3fde(0x103))/0x2*(-parseInt(_0x2e3fde(0xfd))/0x3)+parseInt(_0x2e3fde(0x110))/0x4+parseInt(_0x2e3fde(0x106))/0x5+-parseInt(_0x2e3fde(0xfe))/0x6*(-parseInt(_0x2e3fde(0xf6))/0x7)+-parseInt(_0x2e3fde(0x124))/0x8*(parseInt(_0x2e3fde(0x10b))/0x9)+-parseInt(_0x2e3fde(0xfc))/0xa;if(_0x308c6f===_0x5f50be)break;else _0x19dded['push'](_0x19dded['shift']());}catch(_0x189e73){_0x19dded['push'](_0x19dded['shift']());}}}(a47_0x488c,0x3c994));function a47_0x2d8c(_0x1e3905,_0x38f8c6){const _0x488c66=a47_0x488c();return a47_0x2d8c=function(_0x2d8cad,_0x4cc539){_0x2d8cad=_0x2d8cad-0xe0;let _0x5d8971=_0x488c66[_0x2d8cad];return _0x5d8971;},a47_0x2d8c(_0x1e3905,_0x38f8c6);}var __importDefault=this&&this[a47_0x24e346(0x118)]||function(_0x40d5ef){return _0x40d5ef&&_0x40d5ef['__esModule']?_0x40d5ef:{'default':_0x40d5ef};};Object[a47_0x24e346(0xe0)](exports,'__esModule',{'value':!![]}),exports[a47_0x24e346(0xe7)]=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x24e346(0xea))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a47_0x24e346(0xf2)));class SettingsService{[a47_0x24e346(0xe5)](_0x589c1d){const _0x16ac7f=a47_0x24e346;if(!_0x589c1d)return'';if(_0x589c1d['length']<=0x8)return _0x589c1d;const _0x5d4056=_0x589c1d[_0x16ac7f(0xfb)](0x0,0x8),_0x2b15b4='*'['repeat'](Math['max'](0x0,_0x589c1d[_0x16ac7f(0xef)]-0x8));return _0x5d4056+_0x2b15b4;}[a47_0x24e346(0xe9)](_0x1f5b74){const _0x33eff1=a47_0x24e346;if(!_0x1f5b74)return[];if(Array[_0x33eff1(0xfa)](_0x1f5b74))return _0x1f5b74;if(typeof _0x1f5b74==='string')try{const _0x22310b=JSON['parse'](_0x1f5b74);return Array[_0x33eff1(0xfa)](_0x22310b)?_0x22310b:[];}catch{return[];}return[];}async[a47_0x24e346(0xf1)](_0x56db69){const _0x414a85=a47_0x24e346,_0x33582c=await database_1['default']['shop'][_0x414a85(0x120)]({'where':{'id':_0x56db69},'include':{'settings':!![]}});if(!_0x33582c)throw new Error(_0x414a85(0x11e));let _0x2c4490=_0x33582c[_0x414a85(0x116)];return!_0x2c4490&&(_0x2c4490=await database_1[_0x414a85(0x117)][_0x414a85(0xf7)][_0x414a85(0xf9)]({'data':{'shopId':_0x33582c['id']}})),{'fullName':_0x33582c[_0x414a85(0x102)],'brand':_0x33582c[_0x414a85(0x102)],'merchantUrl':_0x33582c[_0x414a85(0xf0)],'telegramUsername':_0x33582c[_0x414a85(0x123)],'telegramBotApiKey':_0x2c4490['telegramBotApiKey']?this[_0x414a85(0xe5)](_0x2c4490[_0x414a85(0x109)]):null,'telegramChatId':_0x2c4490[_0x414a85(0x100)],'webhookUrl':_0x2c4490['webhookUrl'],'webhookEvents':this[_0x414a85(0xe9)](_0x2c4490[_0x414a85(0xf3)]),'notifications':{'payment_success':_0x2c4490[_0x414a85(0x101)],'payment_failed':_0x2c4490['notificationPaymentFailed'],'refund':_0x2c4490[_0x414a85(0xee)],'payout':_0x2c4490[_0x414a85(0xf4)],'login':_0x2c4490[_0x414a85(0x10d)],'api_error':_0x2c4490['notificationApiError']}};}async[a47_0x24e346(0xe4)](_0x41f326,_0x58d5d7){const _0x452333=a47_0x24e346,{currentPassword:_0x4cae52,newPassword:_0x5e6eb2,confirmNewPassword:_0x8c5e7}=_0x58d5d7;if(_0x5e6eb2!==_0x8c5e7)throw new Error(_0x452333(0x119));if(_0x5e6eb2[_0x452333(0xef)]<0x6)throw new Error(_0x452333(0xf8));const _0x131cf8=await database_1[_0x452333(0x117)][_0x452333(0x114)][_0x452333(0x120)]({'where':{'id':_0x41f326},'select':{'password':!![]}});if(!_0x131cf8)throw new Error(_0x452333(0x11e));const _0xeaa94a=await bcryptjs_1[_0x452333(0x117)]['compare'](_0x4cae52,_0x131cf8[_0x452333(0x10c)]);if(!_0xeaa94a)throw new Error(_0x452333(0xf5));const _0x7f6cab=await bcryptjs_1[_0x452333(0x117)][_0x452333(0x104)](_0x5e6eb2,0xc);await database_1[_0x452333(0x117)]['shop'][_0x452333(0x11a)]({'where':{'id':_0x41f326},'data':{'password':_0x7f6cab}});}async[a47_0x24e346(0x121)](_0x52cdd5,_0xadfdbd){const _0x2b8fcd=a47_0x24e346;await this[_0x2b8fcd(0x115)](_0x52cdd5);const _0x4c6a1e={};_0xadfdbd[_0x2b8fcd(0x113)]!==undefined&&(_0x4c6a1e[_0x2b8fcd(0x101)]=_0xadfdbd['payment_success']),_0xadfdbd[_0x2b8fcd(0x111)]!==undefined&&(_0x4c6a1e[_0x2b8fcd(0xe3)]=_0xadfdbd[_0x2b8fcd(0x111)]),_0xadfdbd[_0x2b8fcd(0x112)]!==undefined&&(_0x4c6a1e[_0x2b8fcd(0xee)]=_0xadfdbd[_0x2b8fcd(0x112)]),_0xadfdbd['payout']!==undefined&&(_0x4c6a1e[_0x2b8fcd(0xf4)]=_0xadfdbd[_0x2b8fcd(0xe2)]),_0xadfdbd[_0x2b8fcd(0x11c)]!==undefined&&(_0x4c6a1e[_0x2b8fcd(0x10d)]=_0xadfdbd[_0x2b8fcd(0x11c)]),_0xadfdbd[_0x2b8fcd(0xe6)]!==undefined&&(_0x4c6a1e[_0x2b8fcd(0x122)]=_0xadfdbd[_0x2b8fcd(0xe6)]),await database_1[_0x2b8fcd(0x117)][_0x2b8fcd(0xf7)][_0x2b8fcd(0x11a)]({'where':{'shopId':_0x52cdd5},'data':_0x4c6a1e});}async[a47_0x24e346(0x11d)](_0x227f46,_0x3d094b){const _0xd6a256=a47_0x24e346;await this[_0xd6a256(0x115)](_0x227f46);const _0x2745db={};_0x3d094b['botApiKey']!==undefined&&(_0x2745db['telegramBotApiKey']=_0x3d094b[_0xd6a256(0xe1)]||null),_0x3d094b[_0xd6a256(0xe8)]!==undefined&&(_0x2745db[_0xd6a256(0x100)]=_0x3d094b[_0xd6a256(0xe8)]||null),await database_1[_0xd6a256(0x117)]['shopSettings'][_0xd6a256(0x11a)]({'where':{'shopId':_0x227f46},'data':_0x2745db});}async[a47_0x24e346(0xff)](_0x481b4e,_0xed524b){const _0x279dc6=a47_0x24e346;await this[_0x279dc6(0x115)](_0x481b4e);const _0x283f04={};_0xed524b[_0x279dc6(0x10f)]!==undefined&&(_0x283f04['webhookUrl']=_0xed524b[_0x279dc6(0x10f)]||null),_0xed524b['webhookEvents']!==undefined&&(_0x283f04['webhookEvents']=_0xed524b[_0x279dc6(0xf3)]||[]),await database_1[_0x279dc6(0x117)][_0x279dc6(0xf7)][_0x279dc6(0x11a)]({'where':{'shopId':_0x481b4e},'data':_0x283f04});}async[a47_0x24e346(0xed)](_0x42f2d1){const _0x1002d5=a47_0x24e346,_0x1cdee9=_0x1002d5(0x107)+crypto_1[_0x1002d5(0x117)][_0x1002d5(0xec)](0x20)[_0x1002d5(0x11f)]('hex'),_0x4c4aaa=_0x1002d5(0xeb)+crypto_1[_0x1002d5(0x117)][_0x1002d5(0xec)](0x20)[_0x1002d5(0x11f)](_0x1002d5(0x10a));await database_1['default'][_0x1002d5(0x114)][_0x1002d5(0x11a)]({'where':{'id':_0x42f2d1},'data':{'publicKey':_0x1cdee9,'secretKey':_0x4c4aaa}});}async[a47_0x24e346(0x108)](_0x5a611f,_0x53834b){const _0x2804b2=a47_0x24e346,{passwordConfirmation:_0x8bf1b0}=_0x53834b,_0x1eac92=await database_1[_0x2804b2(0x117)]['shop'][_0x2804b2(0x120)]({'where':{'id':_0x5a611f},'select':{'password':!![]}});if(!_0x1eac92)throw new Error(_0x2804b2(0x11e));const _0x507b2e=await bcryptjs_1[_0x2804b2(0x117)][_0x2804b2(0x11b)](_0x8bf1b0,_0x1eac92[_0x2804b2(0x10c)]);if(!_0x507b2e)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x2804b2(0x117)][_0x2804b2(0x114)][_0x2804b2(0x105)]({'where':{'id':_0x5a611f}});}async[a47_0x24e346(0x115)](_0x823925){const _0x14b41c=a47_0x24e346,_0x24123a=await database_1[_0x14b41c(0x117)][_0x14b41c(0xf7)]['findUnique']({'where':{'shopId':_0x823925}});!_0x24123a&&await database_1[_0x14b41c(0x117)]['shopSettings'][_0x14b41c(0xf9)]({'data':{'shopId':_0x823925}});}}exports[a47_0x24e346(0xe7)]=SettingsService;function a47_0x488c(){const _0x42e26c=['hash','delete','1655785dlPpLc','pk_','deleteAccount','telegramBotApiKey','hex','2022282HIngKt','password','notificationLogin','460005yQlTUh','webhookUrl','1254000ooRyte','payment_failed','refund','payment_success','shop','ensureSettingsExist','settings','default','__importDefault','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','update','compare','login','updateTelegramSettings','Shop\x20not\x20found','toString','findUnique','updateNotifications','notificationApiError','telegram','16oRbeFa','defineProperty','botApiKey','payout','notificationPaymentFailed','changePassword','maskApiKey','api_error','SettingsService','chatId','parseWebhookEvents','bcryptjs','sk_','randomBytes','revokeAllApiKeys','notificationRefund','length','shopUrl','getShopSettings','../config/database','webhookEvents','notificationPayout','Current\x20password\x20is\x20incorrect','379463WdBWAZ','shopSettings','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','create','isArray','substring','7699220QqIOga','925977yunMDL','6jATzEH','updateWebhookSettings','telegramChatId','notificationPaymentSuccess','name','2zbQoZx'];a47_0x488c=function(){return _0x42e26c;};return a47_0x488c();}