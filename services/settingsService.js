'use strict';function a57_0x5236(){const _0x672e4=['7847609fwPXdB','crypto','payment_failed','notificationPayout','hash','bcryptjs','getShopSettings','notificationLogin','update','parseWebhookEvents','payout','findUnique','payment_success','notificationPaymentSuccess','sk_','83986uFAGNq','shopUrl','compare','revokeAllApiKeys','Current\x20password\x20is\x20incorrect','telegram','4RSaVfb','webhookUrl','notificationRefund','shopSettings','../config/database','notificationPaymentFailed','parse','105hccoeH','__esModule','changePassword','name','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','settings','randomBytes','webhookEvents','Shop\x20not\x20found','password','create','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','416SFdkUY','96732fQQJxy','repeat','maskApiKey','default','isArray','SettingsService','telegramBotApiKey','toString','api_error','1919961KfgSXE','chatId','pk_','shop','426450uhsDrK','hex','length','ensureSettingsExist','substring','updateNotifications','Password\x20confirmation\x20is\x20incorrect','10MhPJGC','3875472aAFSkF','606102JjbwxN','max','refund','defineProperty','notificationApiError'];a57_0x5236=function(){return _0x672e4;};return a57_0x5236();}const a57_0x8b61ca=a57_0x5743;(function(_0x2b6cc8,_0x3fece7){const _0x1ecd64=a57_0x5743,_0x2ba074=_0x2b6cc8();while(!![]){try{const _0x42939f=parseInt(_0x1ecd64(0x1ca))/0x1+parseInt(_0x1ecd64(0x1e4))/0x2*(-parseInt(_0x1ecd64(0x1c1))/0x3)+-parseInt(_0x1ecd64(0x1b4))/0x4*(-parseInt(_0x1ecd64(0x1a7))/0x5)+parseInt(_0x1ecd64(0x1c9))/0x6+parseInt(_0x1ecd64(0x1de))/0x7*(-parseInt(_0x1ecd64(0x1b3))/0x8)+-parseInt(_0x1ecd64(0x1bd))/0x9*(-parseInt(_0x1ecd64(0x1c8))/0xa)+-parseInt(_0x1ecd64(0x1cf))/0xb;if(_0x42939f===_0x3fece7)break;else _0x2ba074['push'](_0x2ba074['shift']());}catch(_0x590b5d){_0x2ba074['push'](_0x2ba074['shift']());}}}(a57_0x5236,0x55d53));var __importDefault=this&&this['__importDefault']||function(_0x50d895){return _0x50d895&&_0x50d895['__esModule']?_0x50d895:{'default':_0x50d895};};Object[a57_0x8b61ca(0x1cd)](exports,a57_0x8b61ca(0x1a8),{'value':!![]}),exports[a57_0x8b61ca(0x1b9)]=void 0x0;const bcryptjs_1=__importDefault(require(a57_0x8b61ca(0x1d4))),crypto_1=__importDefault(require(a57_0x8b61ca(0x1d0))),database_1=__importDefault(require(a57_0x8b61ca(0x1e8)));class SettingsService{['maskApiKey'](_0x1be278){const _0x100523=a57_0x8b61ca;if(!_0x1be278)return'';if(_0x1be278['length']<=0x8)return _0x1be278;const _0x330ecb=_0x1be278[_0x100523(0x1c5)](0x0,0x8),_0x32b85b='*'[_0x100523(0x1b5)](Math[_0x100523(0x1cb)](0x0,_0x1be278[_0x100523(0x1c3)]-0x8));return _0x330ecb+_0x32b85b;}[a57_0x8b61ca(0x1d8)](_0x2b67a4){const _0x207d9c=a57_0x8b61ca;if(!_0x2b67a4)return[];if(Array[_0x207d9c(0x1b8)](_0x2b67a4))return _0x2b67a4;if(typeof _0x2b67a4==='string')try{const _0x38dbff=JSON[_0x207d9c(0x1a6)](_0x2b67a4);return Array[_0x207d9c(0x1b8)](_0x38dbff)?_0x38dbff:[];}catch{return[];}return[];}async[a57_0x8b61ca(0x1d5)](_0x4f8506){const _0x18b271=a57_0x8b61ca,_0x3f2d63=await database_1[_0x18b271(0x1b7)][_0x18b271(0x1c0)][_0x18b271(0x1da)]({'where':{'id':_0x4f8506},'include':{'settings':!![]}});if(!_0x3f2d63)throw new Error(_0x18b271(0x1af));let _0x168c79=_0x3f2d63[_0x18b271(0x1ac)];return!_0x168c79&&(_0x168c79=await database_1[_0x18b271(0x1b7)][_0x18b271(0x1e7)]['create']({'data':{'shopId':_0x3f2d63['id']}})),{'fullName':_0x3f2d63['name'],'brand':_0x3f2d63[_0x18b271(0x1aa)],'merchantUrl':_0x3f2d63[_0x18b271(0x1df)],'telegramUsername':_0x3f2d63[_0x18b271(0x1e3)],'telegramBotApiKey':_0x168c79['telegramBotApiKey']?this[_0x18b271(0x1b6)](_0x168c79[_0x18b271(0x1ba)]):null,'telegramChatId':_0x168c79['telegramChatId'],'webhookUrl':_0x168c79[_0x18b271(0x1e5)],'webhookEvents':this[_0x18b271(0x1d8)](_0x168c79[_0x18b271(0x1ae)]),'notifications':{'payment_success':_0x168c79[_0x18b271(0x1dc)],'payment_failed':_0x168c79[_0x18b271(0x1a5)],'refund':_0x168c79[_0x18b271(0x1e6)],'payout':_0x168c79['notificationPayout'],'login':_0x168c79['notificationLogin'],'api_error':_0x168c79[_0x18b271(0x1ce)]}};}async[a57_0x8b61ca(0x1a9)](_0x1eeda7,_0x386175){const _0x2029c3=a57_0x8b61ca,{currentPassword:_0x34e9a5,newPassword:_0x3679b9,confirmNewPassword:_0x1f11bf}=_0x386175;if(_0x3679b9!==_0x1f11bf)throw new Error(_0x2029c3(0x1ab));if(_0x3679b9[_0x2029c3(0x1c3)]<0x6)throw new Error(_0x2029c3(0x1b2));const _0x5e8351=await database_1[_0x2029c3(0x1b7)][_0x2029c3(0x1c0)][_0x2029c3(0x1da)]({'where':{'id':_0x1eeda7},'select':{'password':!![]}});if(!_0x5e8351)throw new Error('Shop\x20not\x20found');const _0x8cc901=await bcryptjs_1['default']['compare'](_0x34e9a5,_0x5e8351[_0x2029c3(0x1b0)]);if(!_0x8cc901)throw new Error(_0x2029c3(0x1e2));const _0x4da212=await bcryptjs_1['default'][_0x2029c3(0x1d3)](_0x3679b9,0xc);await database_1[_0x2029c3(0x1b7)][_0x2029c3(0x1c0)]['update']({'where':{'id':_0x1eeda7},'data':{'password':_0x4da212}});}async[a57_0x8b61ca(0x1c6)](_0x2f226e,_0x5ed9c0){const _0x1e4710=a57_0x8b61ca;await this['ensureSettingsExist'](_0x2f226e);const _0x59e9a6={};_0x5ed9c0['payment_success']!==undefined&&(_0x59e9a6[_0x1e4710(0x1dc)]=_0x5ed9c0[_0x1e4710(0x1db)]),_0x5ed9c0[_0x1e4710(0x1d1)]!==undefined&&(_0x59e9a6[_0x1e4710(0x1a5)]=_0x5ed9c0[_0x1e4710(0x1d1)]),_0x5ed9c0[_0x1e4710(0x1cc)]!==undefined&&(_0x59e9a6['notificationRefund']=_0x5ed9c0[_0x1e4710(0x1cc)]),_0x5ed9c0[_0x1e4710(0x1d9)]!==undefined&&(_0x59e9a6[_0x1e4710(0x1d2)]=_0x5ed9c0[_0x1e4710(0x1d9)]),_0x5ed9c0['login']!==undefined&&(_0x59e9a6[_0x1e4710(0x1d6)]=_0x5ed9c0['login']),_0x5ed9c0[_0x1e4710(0x1bc)]!==undefined&&(_0x59e9a6['notificationApiError']=_0x5ed9c0[_0x1e4710(0x1bc)]),await database_1[_0x1e4710(0x1b7)][_0x1e4710(0x1e7)][_0x1e4710(0x1d7)]({'where':{'shopId':_0x2f226e},'data':_0x59e9a6});}async['updateTelegramSettings'](_0x26e036,_0x1ff708){const _0x2c2a9c=a57_0x8b61ca;await this[_0x2c2a9c(0x1c4)](_0x26e036);const _0xfd8686={};_0x1ff708['botApiKey']!==undefined&&(_0xfd8686['telegramBotApiKey']=_0x1ff708['botApiKey']||null),_0x1ff708[_0x2c2a9c(0x1be)]!==undefined&&(_0xfd8686['telegramChatId']=_0x1ff708[_0x2c2a9c(0x1be)]||null),await database_1[_0x2c2a9c(0x1b7)]['shopSettings'][_0x2c2a9c(0x1d7)]({'where':{'shopId':_0x26e036},'data':_0xfd8686});}async['updateWebhookSettings'](_0x6b5e5c,_0x2d0ff9){const _0x6031fa=a57_0x8b61ca;await this[_0x6031fa(0x1c4)](_0x6b5e5c);const _0x7f184b={};_0x2d0ff9[_0x6031fa(0x1e5)]!==undefined&&(_0x7f184b[_0x6031fa(0x1e5)]=_0x2d0ff9['webhookUrl']||null),_0x2d0ff9[_0x6031fa(0x1ae)]!==undefined&&(_0x7f184b['webhookEvents']=_0x2d0ff9[_0x6031fa(0x1ae)]||[]),await database_1[_0x6031fa(0x1b7)][_0x6031fa(0x1e7)][_0x6031fa(0x1d7)]({'where':{'shopId':_0x6b5e5c},'data':_0x7f184b});}async[a57_0x8b61ca(0x1e1)](_0x159b4f){const _0x1deed4=a57_0x8b61ca,_0x20731b=_0x1deed4(0x1bf)+crypto_1[_0x1deed4(0x1b7)][_0x1deed4(0x1ad)](0x20)['toString'](_0x1deed4(0x1c2)),_0x205a82=_0x1deed4(0x1dd)+crypto_1[_0x1deed4(0x1b7)][_0x1deed4(0x1ad)](0x20)[_0x1deed4(0x1bb)]('hex');await database_1['default'][_0x1deed4(0x1c0)][_0x1deed4(0x1d7)]({'where':{'id':_0x159b4f},'data':{'publicKey':_0x20731b,'secretKey':_0x205a82}});}async['deleteAccount'](_0x48226b,_0x2dc483){const _0xa3bbb1=a57_0x8b61ca,{passwordConfirmation:_0x1d65a6}=_0x2dc483,_0x4b8877=await database_1[_0xa3bbb1(0x1b7)][_0xa3bbb1(0x1c0)][_0xa3bbb1(0x1da)]({'where':{'id':_0x48226b},'select':{'password':!![]}});if(!_0x4b8877)throw new Error(_0xa3bbb1(0x1af));const _0x4fa250=await bcryptjs_1[_0xa3bbb1(0x1b7)][_0xa3bbb1(0x1e0)](_0x1d65a6,_0x4b8877['password']);if(!_0x4fa250)throw new Error(_0xa3bbb1(0x1c7));await database_1[_0xa3bbb1(0x1b7)]['shop']['delete']({'where':{'id':_0x48226b}});}async[a57_0x8b61ca(0x1c4)](_0x3078e9){const _0x4a83c2=a57_0x8b61ca,_0x4bd8a3=await database_1[_0x4a83c2(0x1b7)][_0x4a83c2(0x1e7)][_0x4a83c2(0x1da)]({'where':{'shopId':_0x3078e9}});!_0x4bd8a3&&await database_1[_0x4a83c2(0x1b7)][_0x4a83c2(0x1e7)][_0x4a83c2(0x1b1)]({'data':{'shopId':_0x3078e9}});}}function a57_0x5743(_0x1143a2,_0x22a3ec){const _0x5236bc=a57_0x5236();return a57_0x5743=function(_0x5743dd,_0x3ec065){_0x5743dd=_0x5743dd-0x1a5;let _0x352fad=_0x5236bc[_0x5743dd];return _0x352fad;},a57_0x5743(_0x1143a2,_0x22a3ec);}exports[a57_0x8b61ca(0x1b9)]=SettingsService;