'use strict';function a52_0x58d4(){const _0x4fb773=['login','parseWebhookEvents','../config/database','5203842MmOqyA','telegramChatId','refund','notificationPaymentSuccess','randomBytes','compare','1867790OuWBlF','toString','478323fcDLlY','notificationApiError','2289128wgBwZq','__esModule','substring','updateWebhookSettings','notificationPayout','parse','chatId','7086639zNPSzI','5yMWQAh','findUnique','max','maskApiKey','sk_','9XovuoX','notificationPaymentFailed','shopUrl','__importDefault','121227YdMmuE','hex','telegramBotApiKey','hash','update','crypto','payout','14rqvwwm','create','payment_failed','shopSettings','getShopSettings','settings','Shop\x20not\x20found','default','webhookEvents','name','notificationRefund','3859692LVlyKF','SettingsService','pk_','delete','isArray','defineProperty','telegram','shop','botApiKey','updateTelegramSettings','api_error','length','password','webhookUrl','payment_success','Current\x20password\x20is\x20incorrect','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','bcryptjs','notificationLogin'];a52_0x58d4=function(){return _0x4fb773;};return a52_0x58d4();}const a52_0x336da9=a52_0x2ee9;(function(_0x5eaf49,_0x46f1c6){const _0x547e28=a52_0x2ee9,_0x5df8ca=_0x5eaf49();while(!![]){try{const _0x2e2304=-parseInt(_0x547e28(0x1ae))/0x1+parseInt(_0x547e28(0x1c8))/0x2*(parseInt(_0x547e28(0x1c1))/0x3)+parseInt(_0x547e28(0x1d3))/0x4+parseInt(_0x547e28(0x1b8))/0x5*(parseInt(_0x547e28(0x1a6))/0x6)+-parseInt(_0x547e28(0x1b7))/0x7+-parseInt(_0x547e28(0x1b0))/0x8*(parseInt(_0x547e28(0x1bd))/0x9)+parseInt(_0x547e28(0x1ac))/0xa;if(_0x2e2304===_0x46f1c6)break;else _0x5df8ca['push'](_0x5df8ca['shift']());}catch(_0xe39958){_0x5df8ca['push'](_0x5df8ca['shift']());}}}(a52_0x58d4,0x802e7));function a52_0x2ee9(_0x1352b2,_0x5cb612){const _0x58d4f4=a52_0x58d4();return a52_0x2ee9=function(_0x2ee9cb,_0x45e688){_0x2ee9cb=_0x2ee9cb-0x1a3;let _0x995120=_0x58d4f4[_0x2ee9cb];return _0x995120;},a52_0x2ee9(_0x1352b2,_0x5cb612);}var __importDefault=this&&this[a52_0x336da9(0x1c0)]||function(_0x503698){const _0x334440=a52_0x336da9;return _0x503698&&_0x503698[_0x334440(0x1b1)]?_0x503698:{'default':_0x503698};};Object[a52_0x336da9(0x1d8)](exports,a52_0x336da9(0x1b1),{'value':!![]}),exports[a52_0x336da9(0x1d4)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x336da9(0x1e4))),crypto_1=__importDefault(require(a52_0x336da9(0x1c6))),database_1=__importDefault(require(a52_0x336da9(0x1a5)));class SettingsService{[a52_0x336da9(0x1bb)](_0x442412){const _0x5cab7c=a52_0x336da9;if(!_0x442412)return'';if(_0x442412[_0x5cab7c(0x1de)]<=0x8)return _0x442412;const _0x12ac30=_0x442412[_0x5cab7c(0x1b2)](0x0,0x8),_0x12cdca='*'['repeat'](Math[_0x5cab7c(0x1ba)](0x0,_0x442412[_0x5cab7c(0x1de)]-0x8));return _0x12ac30+_0x12cdca;}[a52_0x336da9(0x1a4)](_0x1b8162){const _0x45a901=a52_0x336da9;if(!_0x1b8162)return[];if(Array[_0x45a901(0x1d7)](_0x1b8162))return _0x1b8162;if(typeof _0x1b8162==='string')try{const _0x5e99da=JSON[_0x45a901(0x1b5)](_0x1b8162);return Array[_0x45a901(0x1d7)](_0x5e99da)?_0x5e99da:[];}catch{return[];}return[];}async[a52_0x336da9(0x1cc)](_0x46c497){const _0x1e61d4=a52_0x336da9,_0x1bb29d=await database_1['default'][_0x1e61d4(0x1da)][_0x1e61d4(0x1b9)]({'where':{'id':_0x46c497},'include':{'settings':!![]}});if(!_0x1bb29d)throw new Error('Shop\x20not\x20found');let _0x355da3=_0x1bb29d[_0x1e61d4(0x1cd)];return!_0x355da3&&(_0x355da3=await database_1[_0x1e61d4(0x1cf)]['shopSettings'][_0x1e61d4(0x1c9)]({'data':{'shopId':_0x1bb29d['id']}})),{'fullName':_0x1bb29d[_0x1e61d4(0x1d1)],'brand':_0x1bb29d[_0x1e61d4(0x1d1)],'merchantUrl':_0x1bb29d[_0x1e61d4(0x1bf)],'telegramUsername':_0x1bb29d[_0x1e61d4(0x1d9)],'telegramBotApiKey':_0x355da3[_0x1e61d4(0x1c3)]?this['maskApiKey'](_0x355da3['telegramBotApiKey']):null,'telegramChatId':_0x355da3[_0x1e61d4(0x1a7)],'webhookUrl':_0x355da3['webhookUrl'],'webhookEvents':this[_0x1e61d4(0x1a4)](_0x355da3[_0x1e61d4(0x1d0)]),'notifications':{'payment_success':_0x355da3[_0x1e61d4(0x1a9)],'payment_failed':_0x355da3[_0x1e61d4(0x1be)],'refund':_0x355da3[_0x1e61d4(0x1d2)],'payout':_0x355da3[_0x1e61d4(0x1b4)],'login':_0x355da3[_0x1e61d4(0x1e5)],'api_error':_0x355da3['notificationApiError']}};}async['changePassword'](_0x464535,_0x126243){const _0x1c117b=a52_0x336da9,{currentPassword:_0x44942f,newPassword:_0x14f2a3,confirmNewPassword:_0x1cab62}=_0x126243;if(_0x14f2a3!==_0x1cab62)throw new Error(_0x1c117b(0x1e3));if(_0x14f2a3['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x3487c0=await database_1[_0x1c117b(0x1cf)][_0x1c117b(0x1da)][_0x1c117b(0x1b9)]({'where':{'id':_0x464535},'select':{'password':!![]}});if(!_0x3487c0)throw new Error(_0x1c117b(0x1ce));const _0x25663b=await bcryptjs_1[_0x1c117b(0x1cf)][_0x1c117b(0x1ab)](_0x44942f,_0x3487c0[_0x1c117b(0x1df)]);if(!_0x25663b)throw new Error(_0x1c117b(0x1e2));const _0x5af22f=await bcryptjs_1[_0x1c117b(0x1cf)][_0x1c117b(0x1c4)](_0x14f2a3,0xc);await database_1['default'][_0x1c117b(0x1da)][_0x1c117b(0x1c5)]({'where':{'id':_0x464535},'data':{'password':_0x5af22f}});}async['updateNotifications'](_0xb07e43,_0x2a0691){const _0x545a52=a52_0x336da9;await this['ensureSettingsExist'](_0xb07e43);const _0x1eb734={};_0x2a0691[_0x545a52(0x1e1)]!==undefined&&(_0x1eb734[_0x545a52(0x1a9)]=_0x2a0691['payment_success']),_0x2a0691[_0x545a52(0x1ca)]!==undefined&&(_0x1eb734[_0x545a52(0x1be)]=_0x2a0691[_0x545a52(0x1ca)]),_0x2a0691[_0x545a52(0x1a8)]!==undefined&&(_0x1eb734[_0x545a52(0x1d2)]=_0x2a0691[_0x545a52(0x1a8)]),_0x2a0691[_0x545a52(0x1c7)]!==undefined&&(_0x1eb734[_0x545a52(0x1b4)]=_0x2a0691[_0x545a52(0x1c7)]),_0x2a0691[_0x545a52(0x1a3)]!==undefined&&(_0x1eb734[_0x545a52(0x1e5)]=_0x2a0691[_0x545a52(0x1a3)]),_0x2a0691[_0x545a52(0x1dd)]!==undefined&&(_0x1eb734[_0x545a52(0x1af)]=_0x2a0691[_0x545a52(0x1dd)]),await database_1[_0x545a52(0x1cf)]['shopSettings'][_0x545a52(0x1c5)]({'where':{'shopId':_0xb07e43},'data':_0x1eb734});}async[a52_0x336da9(0x1dc)](_0x38a5a6,_0x34063c){const _0x300258=a52_0x336da9;await this['ensureSettingsExist'](_0x38a5a6);const _0x399e36={};_0x34063c[_0x300258(0x1db)]!==undefined&&(_0x399e36['telegramBotApiKey']=_0x34063c[_0x300258(0x1db)]||null),_0x34063c[_0x300258(0x1b6)]!==undefined&&(_0x399e36['telegramChatId']=_0x34063c[_0x300258(0x1b6)]||null),await database_1['default'][_0x300258(0x1cb)][_0x300258(0x1c5)]({'where':{'shopId':_0x38a5a6},'data':_0x399e36});}async[a52_0x336da9(0x1b3)](_0x1e2544,_0x18f8cf){const _0xac499=a52_0x336da9;await this['ensureSettingsExist'](_0x1e2544);const _0x19c5d7={};_0x18f8cf[_0xac499(0x1e0)]!==undefined&&(_0x19c5d7[_0xac499(0x1e0)]=_0x18f8cf[_0xac499(0x1e0)]||null),_0x18f8cf[_0xac499(0x1d0)]!==undefined&&(_0x19c5d7['webhookEvents']=_0x18f8cf['webhookEvents']||[]),await database_1[_0xac499(0x1cf)]['shopSettings'][_0xac499(0x1c5)]({'where':{'shopId':_0x1e2544},'data':_0x19c5d7});}async['revokeAllApiKeys'](_0x294861){const _0x517249=a52_0x336da9,_0x1d9bab=_0x517249(0x1d5)+crypto_1[_0x517249(0x1cf)][_0x517249(0x1aa)](0x20)[_0x517249(0x1ad)](_0x517249(0x1c2)),_0x81c011=_0x517249(0x1bc)+crypto_1[_0x517249(0x1cf)][_0x517249(0x1aa)](0x20)['toString'](_0x517249(0x1c2));await database_1[_0x517249(0x1cf)][_0x517249(0x1da)]['update']({'where':{'id':_0x294861},'data':{'publicKey':_0x1d9bab,'secretKey':_0x81c011}});}async['deleteAccount'](_0x56a925,_0x54b4d5){const _0x435477=a52_0x336da9,{passwordConfirmation:_0x3ba1a0}=_0x54b4d5,_0x35964b=await database_1[_0x435477(0x1cf)][_0x435477(0x1da)][_0x435477(0x1b9)]({'where':{'id':_0x56a925},'select':{'password':!![]}});if(!_0x35964b)throw new Error('Shop\x20not\x20found');const _0x199a8b=await bcryptjs_1['default'][_0x435477(0x1ab)](_0x3ba1a0,_0x35964b[_0x435477(0x1df)]);if(!_0x199a8b)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x435477(0x1cf)][_0x435477(0x1da)][_0x435477(0x1d6)]({'where':{'id':_0x56a925}});}async['ensureSettingsExist'](_0x173c72){const _0x45a5ab=a52_0x336da9,_0x4ea69d=await database_1[_0x45a5ab(0x1cf)]['shopSettings'][_0x45a5ab(0x1b9)]({'where':{'shopId':_0x173c72}});!_0x4ea69d&&await database_1[_0x45a5ab(0x1cf)][_0x45a5ab(0x1cb)][_0x45a5ab(0x1c9)]({'data':{'shopId':_0x173c72}});}}exports[a52_0x336da9(0x1d4)]=SettingsService;