'use strict';const a50_0xd4263b=a50_0x6132;(function(_0x456c2b,_0x4becac){const _0x5758f2=a50_0x6132,_0x2c547a=_0x456c2b();while(!![]){try{const _0x3b8c19=-parseInt(_0x5758f2(0x1b4))/0x1+-parseInt(_0x5758f2(0x1cc))/0x2*(-parseInt(_0x5758f2(0x1cd))/0x3)+-parseInt(_0x5758f2(0x1df))/0x4+parseInt(_0x5758f2(0x1c6))/0x5+-parseInt(_0x5758f2(0x1ee))/0x6+parseInt(_0x5758f2(0x1db))/0x7+parseInt(_0x5758f2(0x1b6))/0x8*(parseInt(_0x5758f2(0x1bd))/0x9);if(_0x3b8c19===_0x4becac)break;else _0x2c547a['push'](_0x2c547a['shift']());}catch(_0x3bab78){_0x2c547a['push'](_0x2c547a['shift']());}}}(a50_0x472b,0xcdee5));function a50_0x472b(){const _0x129b35=['shopUrl','default','maskApiKey','shopSettings','chatId','10104570WeSsnl','update','settings','../config/database','payment_failed','login','compare','toString','__importDefault','294033TVEmmC','telegram','6001144ArWQnU','getShopSettings','updateTelegramSettings','telegramChatId','notificationPaymentFailed','delete','defineProperty','18aHDEGe','bcryptjs','length','ensureSettingsExist','notificationPaymentSuccess','name','notificationLogin','notificationPayout','payout','5732755IrfZjT','Password\x20confirmation\x20is\x20incorrect','botApiKey','hex','notificationApiError','api_error','1539998CmAuOx','3qPgaqz','updateNotifications','string','changePassword','parseWebhookEvents','max','notificationRefund','create','Shop\x20not\x20found','payment_success','sk_','__esModule','shop','SettingsService','1016029dpYrNt','webhookUrl','webhookEvents','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','2961448tHtoPl','isArray','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','telegramBotApiKey','randomBytes','parse','password','findUnique','substring','hash'];a50_0x472b=function(){return _0x129b35;};return a50_0x472b();}var __importDefault=this&&this[a50_0xd4263b(0x1b3)]||function(_0xe2611){const _0x32ebd6=a50_0xd4263b;return _0xe2611&&_0xe2611[_0x32ebd6(0x1d8)]?_0xe2611:{'default':_0xe2611};};function a50_0x6132(_0x502c91,_0x28d683){const _0x472bfb=a50_0x472b();return a50_0x6132=function(_0x613278,_0x16c579){_0x613278=_0x613278-0x1b2;let _0xc08a7e=_0x472bfb[_0x613278];return _0xc08a7e;},a50_0x6132(_0x502c91,_0x28d683);}Object[a50_0xd4263b(0x1bc)](exports,a50_0xd4263b(0x1d8),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a50_0xd4263b(0x1be))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a50_0xd4263b(0x1f1)));class SettingsService{[a50_0xd4263b(0x1eb)](_0xf6f38f){const _0x334753=a50_0xd4263b;if(!_0xf6f38f)return'';if(_0xf6f38f[_0x334753(0x1bf)]<=0x8)return _0xf6f38f;const _0x564b10=_0xf6f38f[_0x334753(0x1e7)](0x0,0x8),_0x2b1d44='*'['repeat'](Math[_0x334753(0x1d2)](0x0,_0xf6f38f[_0x334753(0x1bf)]-0x8));return _0x564b10+_0x2b1d44;}[a50_0xd4263b(0x1d1)](_0x570e77){const _0x49bbbf=a50_0xd4263b;if(!_0x570e77)return[];if(Array[_0x49bbbf(0x1e0)](_0x570e77))return _0x570e77;if(typeof _0x570e77===_0x49bbbf(0x1cf))try{const _0x4c9918=JSON[_0x49bbbf(0x1e4)](_0x570e77);return Array[_0x49bbbf(0x1e0)](_0x4c9918)?_0x4c9918:[];}catch{return[];}return[];}async[a50_0xd4263b(0x1b7)](_0x162f02){const _0x4d393e=a50_0xd4263b,_0x1df694=await database_1[_0x4d393e(0x1ea)]['shop'][_0x4d393e(0x1e6)]({'where':{'id':_0x162f02},'include':{'settings':!![]}});if(!_0x1df694)throw new Error(_0x4d393e(0x1d5));let _0x1ba195=_0x1df694[_0x4d393e(0x1f0)];return!_0x1ba195&&(_0x1ba195=await database_1['default'][_0x4d393e(0x1ec)][_0x4d393e(0x1d4)]({'data':{'shopId':_0x1df694['id']}})),{'fullName':_0x1df694[_0x4d393e(0x1c2)],'brand':_0x1df694['name'],'merchantUrl':_0x1df694[_0x4d393e(0x1e9)],'telegramUsername':_0x1df694[_0x4d393e(0x1b5)],'telegramBotApiKey':_0x1ba195[_0x4d393e(0x1e2)]?this[_0x4d393e(0x1eb)](_0x1ba195['telegramBotApiKey']):null,'telegramChatId':_0x1ba195[_0x4d393e(0x1b9)],'webhookUrl':_0x1ba195[_0x4d393e(0x1dc)],'webhookEvents':this[_0x4d393e(0x1d1)](_0x1ba195['webhookEvents']),'notifications':{'payment_success':_0x1ba195['notificationPaymentSuccess'],'payment_failed':_0x1ba195[_0x4d393e(0x1ba)],'refund':_0x1ba195[_0x4d393e(0x1d3)],'payout':_0x1ba195['notificationPayout'],'login':_0x1ba195['notificationLogin'],'api_error':_0x1ba195[_0x4d393e(0x1ca)]}};}async[a50_0xd4263b(0x1d0)](_0x36ed5d,_0x3a2298){const _0x53fc6f=a50_0xd4263b,{currentPassword:_0x535ce1,newPassword:_0x562795,confirmNewPassword:_0x43b46a}=_0x3a2298;if(_0x562795!==_0x43b46a)throw new Error(_0x53fc6f(0x1e1));if(_0x562795['length']<0x6)throw new Error(_0x53fc6f(0x1de));const _0xf277a5=await database_1[_0x53fc6f(0x1ea)][_0x53fc6f(0x1d9)][_0x53fc6f(0x1e6)]({'where':{'id':_0x36ed5d},'select':{'password':!![]}});if(!_0xf277a5)throw new Error(_0x53fc6f(0x1d5));const _0x59fb86=await bcryptjs_1[_0x53fc6f(0x1ea)]['compare'](_0x535ce1,_0xf277a5[_0x53fc6f(0x1e5)]);if(!_0x59fb86)throw new Error('Current\x20password\x20is\x20incorrect');const _0x3aab9a=await bcryptjs_1[_0x53fc6f(0x1ea)][_0x53fc6f(0x1e8)](_0x562795,0xc);await database_1['default'][_0x53fc6f(0x1d9)]['update']({'where':{'id':_0x36ed5d},'data':{'password':_0x3aab9a}});}async[a50_0xd4263b(0x1ce)](_0x5dfa36,_0x227c11){const _0x257218=a50_0xd4263b;await this[_0x257218(0x1c0)](_0x5dfa36);const _0x41d427={};_0x227c11[_0x257218(0x1d6)]!==undefined&&(_0x41d427[_0x257218(0x1c1)]=_0x227c11[_0x257218(0x1d6)]),_0x227c11[_0x257218(0x1f2)]!==undefined&&(_0x41d427[_0x257218(0x1ba)]=_0x227c11['payment_failed']),_0x227c11['refund']!==undefined&&(_0x41d427[_0x257218(0x1d3)]=_0x227c11['refund']),_0x227c11[_0x257218(0x1c5)]!==undefined&&(_0x41d427[_0x257218(0x1c4)]=_0x227c11[_0x257218(0x1c5)]),_0x227c11[_0x257218(0x1f3)]!==undefined&&(_0x41d427[_0x257218(0x1c3)]=_0x227c11[_0x257218(0x1f3)]),_0x227c11[_0x257218(0x1cb)]!==undefined&&(_0x41d427[_0x257218(0x1ca)]=_0x227c11[_0x257218(0x1cb)]),await database_1[_0x257218(0x1ea)]['shopSettings'][_0x257218(0x1ef)]({'where':{'shopId':_0x5dfa36},'data':_0x41d427});}async[a50_0xd4263b(0x1b8)](_0xac9d9d,_0x2484d9){const _0x41a4d1=a50_0xd4263b;await this[_0x41a4d1(0x1c0)](_0xac9d9d);const _0xaeb368={};_0x2484d9['botApiKey']!==undefined&&(_0xaeb368[_0x41a4d1(0x1e2)]=_0x2484d9[_0x41a4d1(0x1c8)]||null),_0x2484d9[_0x41a4d1(0x1ed)]!==undefined&&(_0xaeb368[_0x41a4d1(0x1b9)]=_0x2484d9['chatId']||null),await database_1[_0x41a4d1(0x1ea)][_0x41a4d1(0x1ec)][_0x41a4d1(0x1ef)]({'where':{'shopId':_0xac9d9d},'data':_0xaeb368});}async['updateWebhookSettings'](_0x5efcc0,_0x41402f){const _0x4ca5d4=a50_0xd4263b;await this[_0x4ca5d4(0x1c0)](_0x5efcc0);const _0x1a56d3={};_0x41402f[_0x4ca5d4(0x1dc)]!==undefined&&(_0x1a56d3[_0x4ca5d4(0x1dc)]=_0x41402f[_0x4ca5d4(0x1dc)]||null),_0x41402f[_0x4ca5d4(0x1dd)]!==undefined&&(_0x1a56d3[_0x4ca5d4(0x1dd)]=_0x41402f[_0x4ca5d4(0x1dd)]||[]),await database_1[_0x4ca5d4(0x1ea)]['shopSettings'][_0x4ca5d4(0x1ef)]({'where':{'shopId':_0x5efcc0},'data':_0x1a56d3});}async['revokeAllApiKeys'](_0x2d6afd){const _0x113137=a50_0xd4263b,_0x5401fb='pk_'+crypto_1[_0x113137(0x1ea)][_0x113137(0x1e3)](0x20)[_0x113137(0x1b2)](_0x113137(0x1c9)),_0x58f2b6=_0x113137(0x1d7)+crypto_1[_0x113137(0x1ea)][_0x113137(0x1e3)](0x20)[_0x113137(0x1b2)](_0x113137(0x1c9));await database_1[_0x113137(0x1ea)][_0x113137(0x1d9)][_0x113137(0x1ef)]({'where':{'id':_0x2d6afd},'data':{'publicKey':_0x5401fb,'secretKey':_0x58f2b6}});}async['deleteAccount'](_0x17c83b,_0x33cf60){const _0x270032=a50_0xd4263b,{passwordConfirmation:_0xd69b1b}=_0x33cf60,_0x1ddca2=await database_1[_0x270032(0x1ea)][_0x270032(0x1d9)][_0x270032(0x1e6)]({'where':{'id':_0x17c83b},'select':{'password':!![]}});if(!_0x1ddca2)throw new Error(_0x270032(0x1d5));const _0x23b860=await bcryptjs_1[_0x270032(0x1ea)][_0x270032(0x1f4)](_0xd69b1b,_0x1ddca2[_0x270032(0x1e5)]);if(!_0x23b860)throw new Error(_0x270032(0x1c7));await database_1[_0x270032(0x1ea)][_0x270032(0x1d9)][_0x270032(0x1bb)]({'where':{'id':_0x17c83b}});}async['ensureSettingsExist'](_0x594f71){const _0x5961dd=a50_0xd4263b,_0x31db0a=await database_1['default'][_0x5961dd(0x1ec)][_0x5961dd(0x1e6)]({'where':{'shopId':_0x594f71}});!_0x31db0a&&await database_1['default'][_0x5961dd(0x1ec)][_0x5961dd(0x1d4)]({'data':{'shopId':_0x594f71}});}}exports[a50_0xd4263b(0x1da)]=SettingsService;