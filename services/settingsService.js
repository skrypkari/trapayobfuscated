'use strict';const a47_0x2c0426=a47_0x4b89;(function(_0x298534,_0x6249d0){const _0x237f9f=a47_0x4b89,_0x2b40be=_0x298534();while(!![]){try{const _0x50c3e1=parseInt(_0x237f9f(0xbe))/0x1+-parseInt(_0x237f9f(0xc3))/0x2+parseInt(_0x237f9f(0xb9))/0x3*(parseInt(_0x237f9f(0xec))/0x4)+-parseInt(_0x237f9f(0xf7))/0x5+parseInt(_0x237f9f(0xce))/0x6*(parseInt(_0x237f9f(0xbb))/0x7)+parseInt(_0x237f9f(0xcc))/0x8*(-parseInt(_0x237f9f(0xeb))/0x9)+parseInt(_0x237f9f(0xcb))/0xa*(parseInt(_0x237f9f(0xdf))/0xb);if(_0x50c3e1===_0x6249d0)break;else _0x2b40be['push'](_0x2b40be['shift']());}catch(_0x5b314f){_0x2b40be['push'](_0x2b40be['shift']());}}}(a47_0x31cf,0x90d61));function a47_0x31cf(){const _0x354e35=['New\x20password\x20and\x20confirmation\x20do\x20not\x20match','__importDefault','171ZEJKKS','52HFjMwv','hex','max','notificationPayout','SettingsService','repeat','bcryptjs','payment_success','hash','length','shopSettings','586335EBofXy','name','Shop\x20not\x20found','findUnique','parseWebhookEvents','updateTelegramSettings','maskApiKey','default','107373NFhabj','telegramBotApiKey','5485193oJyvHf','__esModule','toString','224518NqcvcK','notificationPaymentSuccess','update','notificationRefund','webhookEvents','1086564jvFAtN','crypto','create','isArray','notificationPaymentFailed','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','telegramChatId','substring','9810BZIqlG','241576OzMDWq','defineProperty','6ekyBgO','payment_failed','password','pk_','payout','shopUrl','getShopSettings','revokeAllApiKeys','shop','notificationLogin','webhookUrl','compare','notificationApiError','randomBytes','parse','settings','telegram','3971DSCVBK','deleteAccount','chatId','ensureSettingsExist','login','updateWebhookSettings','botApiKey','refund','Password\x20confirmation\x20is\x20incorrect','changePassword'];a47_0x31cf=function(){return _0x354e35;};return a47_0x31cf();}function a47_0x4b89(_0x1b2078,_0x30b6a4){const _0x31cfc9=a47_0x31cf();return a47_0x4b89=function(_0x4b89a0,_0x2e5c58){_0x4b89a0=_0x4b89a0-0xb3;let _0x40f85e=_0x31cfc9[_0x4b89a0];return _0x40f85e;},a47_0x4b89(_0x1b2078,_0x30b6a4);}var __importDefault=this&&this[a47_0x2c0426(0xea)]||function(_0x3d33d0){const _0x17f88f=a47_0x2c0426;return _0x3d33d0&&_0x3d33d0[_0x17f88f(0xbc)]?_0x3d33d0:{'default':_0x3d33d0};};Object[a47_0x2c0426(0xcd)](exports,a47_0x2c0426(0xbc),{'value':!![]}),exports[a47_0x2c0426(0xf0)]=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x2c0426(0xf2))),crypto_1=__importDefault(require(a47_0x2c0426(0xc4))),database_1=__importDefault(require('../config/database'));class SettingsService{[a47_0x2c0426(0xb7)](_0x3f33f4){const _0xeca889=a47_0x2c0426;if(!_0x3f33f4)return'';if(_0x3f33f4[_0xeca889(0xf5)]<=0x8)return _0x3f33f4;const _0x4a541f=_0x3f33f4[_0xeca889(0xca)](0x0,0x8),_0x1ce3c3='*'[_0xeca889(0xf1)](Math[_0xeca889(0xee)](0x0,_0x3f33f4['length']-0x8));return _0x4a541f+_0x1ce3c3;}[a47_0x2c0426(0xb5)](_0x4e2822){const _0x39b6c0=a47_0x2c0426;if(!_0x4e2822)return[];if(Array[_0x39b6c0(0xc6)](_0x4e2822))return _0x4e2822;if(typeof _0x4e2822==='string')try{const _0x8621aa=JSON[_0x39b6c0(0xdc)](_0x4e2822);return Array[_0x39b6c0(0xc6)](_0x8621aa)?_0x8621aa:[];}catch{return[];}return[];}async[a47_0x2c0426(0xd4)](_0x17bf1c){const _0x1292b2=a47_0x2c0426,_0xd96238=await database_1[_0x1292b2(0xb8)][_0x1292b2(0xd6)][_0x1292b2(0xb4)]({'where':{'id':_0x17bf1c},'include':{'settings':!![]}});if(!_0xd96238)throw new Error('Shop\x20not\x20found');let _0x1e3451=_0xd96238[_0x1292b2(0xdd)];return!_0x1e3451&&(_0x1e3451=await database_1['default'][_0x1292b2(0xf6)][_0x1292b2(0xc5)]({'data':{'shopId':_0xd96238['id']}})),{'fullName':_0xd96238[_0x1292b2(0xf8)],'brand':_0xd96238['name'],'merchantUrl':_0xd96238[_0x1292b2(0xd3)],'telegramUsername':_0xd96238[_0x1292b2(0xde)],'telegramBotApiKey':_0x1e3451[_0x1292b2(0xba)]?this[_0x1292b2(0xb7)](_0x1e3451[_0x1292b2(0xba)]):null,'telegramChatId':_0x1e3451['telegramChatId'],'webhookUrl':_0x1e3451[_0x1292b2(0xd8)],'webhookEvents':this[_0x1292b2(0xb5)](_0x1e3451[_0x1292b2(0xc2)]),'notifications':{'payment_success':_0x1e3451[_0x1292b2(0xbf)],'payment_failed':_0x1e3451[_0x1292b2(0xc7)],'refund':_0x1e3451[_0x1292b2(0xc1)],'payout':_0x1e3451[_0x1292b2(0xef)],'login':_0x1e3451[_0x1292b2(0xd7)],'api_error':_0x1e3451['notificationApiError']}};}async[a47_0x2c0426(0xe8)](_0x394230,_0x4b6432){const _0x8bc17b=a47_0x2c0426,{currentPassword:_0x3fec8c,newPassword:_0x5d59ba,confirmNewPassword:_0x35c6ec}=_0x4b6432;if(_0x5d59ba!==_0x35c6ec)throw new Error(_0x8bc17b(0xe9));if(_0x5d59ba[_0x8bc17b(0xf5)]<0x6)throw new Error(_0x8bc17b(0xc8));const _0x5073f3=await database_1[_0x8bc17b(0xb8)][_0x8bc17b(0xd6)][_0x8bc17b(0xb4)]({'where':{'id':_0x394230},'select':{'password':!![]}});if(!_0x5073f3)throw new Error('Shop\x20not\x20found');const _0xe0717d=await bcryptjs_1['default'][_0x8bc17b(0xd9)](_0x3fec8c,_0x5073f3[_0x8bc17b(0xd0)]);if(!_0xe0717d)throw new Error('Current\x20password\x20is\x20incorrect');const _0x4de9a1=await bcryptjs_1[_0x8bc17b(0xb8)][_0x8bc17b(0xf4)](_0x5d59ba,0xc);await database_1['default']['shop'][_0x8bc17b(0xc0)]({'where':{'id':_0x394230},'data':{'password':_0x4de9a1}});}async['updateNotifications'](_0x42f7f5,_0x49a8b8){const _0x1ec5be=a47_0x2c0426;await this[_0x1ec5be(0xe2)](_0x42f7f5);const _0x5ec389={};_0x49a8b8[_0x1ec5be(0xf3)]!==undefined&&(_0x5ec389[_0x1ec5be(0xbf)]=_0x49a8b8['payment_success']),_0x49a8b8[_0x1ec5be(0xcf)]!==undefined&&(_0x5ec389[_0x1ec5be(0xc7)]=_0x49a8b8[_0x1ec5be(0xcf)]),_0x49a8b8[_0x1ec5be(0xe6)]!==undefined&&(_0x5ec389[_0x1ec5be(0xc1)]=_0x49a8b8['refund']),_0x49a8b8[_0x1ec5be(0xd2)]!==undefined&&(_0x5ec389[_0x1ec5be(0xef)]=_0x49a8b8[_0x1ec5be(0xd2)]),_0x49a8b8[_0x1ec5be(0xe3)]!==undefined&&(_0x5ec389[_0x1ec5be(0xd7)]=_0x49a8b8['login']),_0x49a8b8['api_error']!==undefined&&(_0x5ec389[_0x1ec5be(0xda)]=_0x49a8b8['api_error']),await database_1[_0x1ec5be(0xb8)][_0x1ec5be(0xf6)]['update']({'where':{'shopId':_0x42f7f5},'data':_0x5ec389});}async[a47_0x2c0426(0xb6)](_0x38d248,_0x407a3e){const _0x17adf0=a47_0x2c0426;await this[_0x17adf0(0xe2)](_0x38d248);const _0x3f8816={};_0x407a3e[_0x17adf0(0xe5)]!==undefined&&(_0x3f8816[_0x17adf0(0xba)]=_0x407a3e['botApiKey']||null),_0x407a3e[_0x17adf0(0xe1)]!==undefined&&(_0x3f8816[_0x17adf0(0xc9)]=_0x407a3e['chatId']||null),await database_1[_0x17adf0(0xb8)][_0x17adf0(0xf6)][_0x17adf0(0xc0)]({'where':{'shopId':_0x38d248},'data':_0x3f8816});}async[a47_0x2c0426(0xe4)](_0x4e85f2,_0x5aa251){const _0x30e2f8=a47_0x2c0426;await this['ensureSettingsExist'](_0x4e85f2);const _0x2090de={};_0x5aa251[_0x30e2f8(0xd8)]!==undefined&&(_0x2090de[_0x30e2f8(0xd8)]=_0x5aa251[_0x30e2f8(0xd8)]||null),_0x5aa251[_0x30e2f8(0xc2)]!==undefined&&(_0x2090de[_0x30e2f8(0xc2)]=_0x5aa251['webhookEvents']||[]),await database_1[_0x30e2f8(0xb8)]['shopSettings'][_0x30e2f8(0xc0)]({'where':{'shopId':_0x4e85f2},'data':_0x2090de});}async[a47_0x2c0426(0xd5)](_0x78c07b){const _0x5e90e9=a47_0x2c0426,_0x213ee8=_0x5e90e9(0xd1)+crypto_1[_0x5e90e9(0xb8)][_0x5e90e9(0xdb)](0x20)[_0x5e90e9(0xbd)](_0x5e90e9(0xed)),_0x2db1f7='sk_'+crypto_1[_0x5e90e9(0xb8)][_0x5e90e9(0xdb)](0x20)['toString'](_0x5e90e9(0xed));await database_1[_0x5e90e9(0xb8)][_0x5e90e9(0xd6)][_0x5e90e9(0xc0)]({'where':{'id':_0x78c07b},'data':{'publicKey':_0x213ee8,'secretKey':_0x2db1f7}});}async[a47_0x2c0426(0xe0)](_0x1621db,_0x2cb868){const _0x1a98fc=a47_0x2c0426,{passwordConfirmation:_0x8aa408}=_0x2cb868,_0x4b2f57=await database_1['default'][_0x1a98fc(0xd6)]['findUnique']({'where':{'id':_0x1621db},'select':{'password':!![]}});if(!_0x4b2f57)throw new Error(_0x1a98fc(0xb3));const _0x313ea2=await bcryptjs_1[_0x1a98fc(0xb8)][_0x1a98fc(0xd9)](_0x8aa408,_0x4b2f57['password']);if(!_0x313ea2)throw new Error(_0x1a98fc(0xe7));await database_1['default'][_0x1a98fc(0xd6)]['delete']({'where':{'id':_0x1621db}});}async['ensureSettingsExist'](_0x39036e){const _0x1a789b=a47_0x2c0426,_0x44309e=await database_1[_0x1a789b(0xb8)]['shopSettings'][_0x1a789b(0xb4)]({'where':{'shopId':_0x39036e}});!_0x44309e&&await database_1[_0x1a789b(0xb8)][_0x1a789b(0xf6)][_0x1a789b(0xc5)]({'data':{'shopId':_0x39036e}});}}exports[a47_0x2c0426(0xf0)]=SettingsService;