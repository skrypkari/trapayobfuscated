'use strict';const a53_0x32052b=a53_0x151f;(function(_0x409730,_0x2f0ddd){const _0x357ee5=a53_0x151f,_0x4e49bc=_0x409730();while(!![]){try{const _0x56fb55=parseInt(_0x357ee5(0x1b7))/0x1*(-parseInt(_0x357ee5(0x1b0))/0x2)+-parseInt(_0x357ee5(0x1dc))/0x3+parseInt(_0x357ee5(0x1a7))/0x4*(parseInt(_0x357ee5(0x1e2))/0x5)+-parseInt(_0x357ee5(0x1b1))/0x6*(parseInt(_0x357ee5(0x1e0))/0x7)+parseInt(_0x357ee5(0x1cd))/0x8+parseInt(_0x357ee5(0x1db))/0x9*(parseInt(_0x357ee5(0x1ab))/0xa)+parseInt(_0x357ee5(0x1a9))/0xb*(parseInt(_0x357ee5(0x1e5))/0xc);if(_0x56fb55===_0x2f0ddd)break;else _0x4e49bc['push'](_0x4e49bc['shift']());}catch(_0x549228){_0x4e49bc['push'](_0x4e49bc['shift']());}}}(a53_0x52c1,0xbf131));function a53_0x151f(_0xf4b5f7,_0x3f41cf){const _0x52c142=a53_0x52c1();return a53_0x151f=function(_0x151ffa,_0x4c8aff){_0x151ffa=_0x151ffa-0x1a4;let _0x174e0f=_0x52c142[_0x151ffa];return _0x174e0f;},a53_0x151f(_0xf4b5f7,_0x3f41cf);}var __importDefault=this&&this[a53_0x32052b(0x1a6)]||function(_0x4daa8e){return _0x4daa8e&&_0x4daa8e['__esModule']?_0x4daa8e:{'default':_0x4daa8e};};function a53_0x52c1(){const _0x1f5081=['payment_success','password','botApiKey','webhookUrl','payout','webhookEvents','telegramBotApiKey','parse','189EpcjwO','2563428HkAtrz','refund','shop','delete','707jLjPEM','hex','5caFEaA','updateNotifications','chatId','12MOyxJM','deleteAccount','updateWebhookSettings','Current\x20password\x20is\x20incorrect','notificationRefund','randomBytes','findUnique','parseWebhookEvents','__importDefault','2411324FEXIMP','name','6201173HnCkMI','max','42610zsaALu','SettingsService','settings','update','telegram','1334930iGgDbE','16722yUUzFX','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','pk_','getShopSettings','create','default','1NSQHYW','string','shopUrl','ensureSettingsExist','crypto','payment_failed','repeat','substring','hash','notificationLogin','notificationPayout','revokeAllApiKeys','notificationApiError','__esModule','../config/database','Password\x20confirmation\x20is\x20incorrect','length','Shop\x20not\x20found','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','changePassword','toString','notificationPaymentSuccess','10640112PKHpwA','compare','isArray','login','shopSettings','updateTelegramSettings'];a53_0x52c1=function(){return _0x1f5081;};return a53_0x52c1();}Object['defineProperty'](exports,a53_0x32052b(0x1c4),{'value':!![]}),exports[a53_0x32052b(0x1ac)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a53_0x32052b(0x1bb))),database_1=__importDefault(require(a53_0x32052b(0x1c5)));class SettingsService{['maskApiKey'](_0x54fd5c){const _0x2757d8=a53_0x32052b;if(!_0x54fd5c)return'';if(_0x54fd5c['length']<=0x8)return _0x54fd5c;const _0x58bc32=_0x54fd5c[_0x2757d8(0x1be)](0x0,0x8),_0x1e5cfb='*'[_0x2757d8(0x1bd)](Math[_0x2757d8(0x1aa)](0x0,_0x54fd5c[_0x2757d8(0x1c7)]-0x8));return _0x58bc32+_0x1e5cfb;}[a53_0x32052b(0x1a5)](_0x8937d8){const _0x221f63=a53_0x32052b;if(!_0x8937d8)return[];if(Array[_0x221f63(0x1cf)](_0x8937d8))return _0x8937d8;if(typeof _0x8937d8===_0x221f63(0x1b8))try{const _0x204716=JSON[_0x221f63(0x1da)](_0x8937d8);return Array[_0x221f63(0x1cf)](_0x204716)?_0x204716:[];}catch{return[];}return[];}async[a53_0x32052b(0x1b4)](_0x441bd9){const _0x51dce0=a53_0x32052b,_0x252ff5=await database_1[_0x51dce0(0x1b6)]['shop'][_0x51dce0(0x1a4)]({'where':{'id':_0x441bd9},'include':{'settings':!![]}});if(!_0x252ff5)throw new Error('Shop\x20not\x20found');let _0x12ed6b=_0x252ff5[_0x51dce0(0x1ad)];return!_0x12ed6b&&(_0x12ed6b=await database_1[_0x51dce0(0x1b6)]['shopSettings'][_0x51dce0(0x1b5)]({'data':{'shopId':_0x252ff5['id']}})),{'fullName':_0x252ff5[_0x51dce0(0x1a8)],'brand':_0x252ff5[_0x51dce0(0x1a8)],'merchantUrl':_0x252ff5[_0x51dce0(0x1b9)],'telegramUsername':_0x252ff5[_0x51dce0(0x1af)],'telegramBotApiKey':_0x12ed6b[_0x51dce0(0x1d9)]?this['maskApiKey'](_0x12ed6b['telegramBotApiKey']):null,'telegramChatId':_0x12ed6b['telegramChatId'],'webhookUrl':_0x12ed6b[_0x51dce0(0x1d6)],'webhookEvents':this[_0x51dce0(0x1a5)](_0x12ed6b[_0x51dce0(0x1d8)]),'notifications':{'payment_success':_0x12ed6b[_0x51dce0(0x1cc)],'payment_failed':_0x12ed6b['notificationPaymentFailed'],'refund':_0x12ed6b[_0x51dce0(0x1e9)],'payout':_0x12ed6b['notificationPayout'],'login':_0x12ed6b[_0x51dce0(0x1c0)],'api_error':_0x12ed6b[_0x51dce0(0x1c3)]}};}async[a53_0x32052b(0x1ca)](_0xaffd92,_0x2891bc){const _0x2a8f85=a53_0x32052b,{currentPassword:_0x28629d,newPassword:_0x71283f,confirmNewPassword:_0x50edb6}=_0x2891bc;if(_0x71283f!==_0x50edb6)throw new Error(_0x2a8f85(0x1c9));if(_0x71283f[_0x2a8f85(0x1c7)]<0x6)throw new Error(_0x2a8f85(0x1b2));const _0x3bacec=await database_1[_0x2a8f85(0x1b6)]['shop'][_0x2a8f85(0x1a4)]({'where':{'id':_0xaffd92},'select':{'password':!![]}});if(!_0x3bacec)throw new Error(_0x2a8f85(0x1c8));const _0x23da9b=await bcryptjs_1[_0x2a8f85(0x1b6)]['compare'](_0x28629d,_0x3bacec[_0x2a8f85(0x1d4)]);if(!_0x23da9b)throw new Error(_0x2a8f85(0x1e8));const _0xa84a04=await bcryptjs_1[_0x2a8f85(0x1b6)][_0x2a8f85(0x1bf)](_0x71283f,0xc);await database_1['default']['shop'][_0x2a8f85(0x1ae)]({'where':{'id':_0xaffd92},'data':{'password':_0xa84a04}});}async[a53_0x32052b(0x1e3)](_0x577c66,_0x6f79d2){const _0x120e0e=a53_0x32052b;await this[_0x120e0e(0x1ba)](_0x577c66);const _0x2a3add={};_0x6f79d2[_0x120e0e(0x1d3)]!==undefined&&(_0x2a3add[_0x120e0e(0x1cc)]=_0x6f79d2[_0x120e0e(0x1d3)]),_0x6f79d2[_0x120e0e(0x1bc)]!==undefined&&(_0x2a3add['notificationPaymentFailed']=_0x6f79d2[_0x120e0e(0x1bc)]),_0x6f79d2['refund']!==undefined&&(_0x2a3add[_0x120e0e(0x1e9)]=_0x6f79d2[_0x120e0e(0x1dd)]),_0x6f79d2[_0x120e0e(0x1d7)]!==undefined&&(_0x2a3add[_0x120e0e(0x1c1)]=_0x6f79d2[_0x120e0e(0x1d7)]),_0x6f79d2['login']!==undefined&&(_0x2a3add[_0x120e0e(0x1c0)]=_0x6f79d2[_0x120e0e(0x1d0)]),_0x6f79d2['api_error']!==undefined&&(_0x2a3add[_0x120e0e(0x1c3)]=_0x6f79d2['api_error']),await database_1[_0x120e0e(0x1b6)][_0x120e0e(0x1d1)][_0x120e0e(0x1ae)]({'where':{'shopId':_0x577c66},'data':_0x2a3add});}async[a53_0x32052b(0x1d2)](_0x265f46,_0x37e7c0){const _0x78d92f=a53_0x32052b;await this[_0x78d92f(0x1ba)](_0x265f46);const _0x211b54={};_0x37e7c0[_0x78d92f(0x1d5)]!==undefined&&(_0x211b54[_0x78d92f(0x1d9)]=_0x37e7c0[_0x78d92f(0x1d5)]||null),_0x37e7c0['chatId']!==undefined&&(_0x211b54['telegramChatId']=_0x37e7c0[_0x78d92f(0x1e4)]||null),await database_1[_0x78d92f(0x1b6)][_0x78d92f(0x1d1)][_0x78d92f(0x1ae)]({'where':{'shopId':_0x265f46},'data':_0x211b54});}async[a53_0x32052b(0x1e7)](_0xcf65e8,_0x1c835d){const _0x39c522=a53_0x32052b;await this[_0x39c522(0x1ba)](_0xcf65e8);const _0x19db05={};_0x1c835d['webhookUrl']!==undefined&&(_0x19db05['webhookUrl']=_0x1c835d[_0x39c522(0x1d6)]||null),_0x1c835d[_0x39c522(0x1d8)]!==undefined&&(_0x19db05[_0x39c522(0x1d8)]=_0x1c835d[_0x39c522(0x1d8)]||[]),await database_1[_0x39c522(0x1b6)][_0x39c522(0x1d1)][_0x39c522(0x1ae)]({'where':{'shopId':_0xcf65e8},'data':_0x19db05});}async[a53_0x32052b(0x1c2)](_0x3602a2){const _0x1c5cec=a53_0x32052b,_0x2a4368=_0x1c5cec(0x1b3)+crypto_1[_0x1c5cec(0x1b6)]['randomBytes'](0x20)['toString'](_0x1c5cec(0x1e1)),_0x182ff3='sk_'+crypto_1[_0x1c5cec(0x1b6)][_0x1c5cec(0x1ea)](0x20)[_0x1c5cec(0x1cb)](_0x1c5cec(0x1e1));await database_1[_0x1c5cec(0x1b6)]['shop'][_0x1c5cec(0x1ae)]({'where':{'id':_0x3602a2},'data':{'publicKey':_0x2a4368,'secretKey':_0x182ff3}});}async[a53_0x32052b(0x1e6)](_0x445c16,_0x35e48f){const _0x3aa9f4=a53_0x32052b,{passwordConfirmation:_0x342674}=_0x35e48f,_0x4cbefb=await database_1[_0x3aa9f4(0x1b6)][_0x3aa9f4(0x1de)][_0x3aa9f4(0x1a4)]({'where':{'id':_0x445c16},'select':{'password':!![]}});if(!_0x4cbefb)throw new Error(_0x3aa9f4(0x1c8));const _0x4617bd=await bcryptjs_1[_0x3aa9f4(0x1b6)][_0x3aa9f4(0x1ce)](_0x342674,_0x4cbefb[_0x3aa9f4(0x1d4)]);if(!_0x4617bd)throw new Error(_0x3aa9f4(0x1c6));await database_1['default']['shop'][_0x3aa9f4(0x1df)]({'where':{'id':_0x445c16}});}async[a53_0x32052b(0x1ba)](_0xa43e96){const _0xc9b81d=a53_0x32052b,_0x577e90=await database_1[_0xc9b81d(0x1b6)][_0xc9b81d(0x1d1)][_0xc9b81d(0x1a4)]({'where':{'shopId':_0xa43e96}});!_0x577e90&&await database_1[_0xc9b81d(0x1b6)][_0xc9b81d(0x1d1)][_0xc9b81d(0x1b5)]({'data':{'shopId':_0xa43e96}});}}exports[a53_0x32052b(0x1ac)]=SettingsService;