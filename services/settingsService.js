'use strict';const a55_0x5d0384=a55_0x3bcf;(function(_0x7a8b6b,_0x413fe7){const _0x46e821=a55_0x3bcf,_0xe2dddc=_0x7a8b6b();while(!![]){try{const _0x28d034=parseInt(_0x46e821(0x1aa))/0x1*(parseInt(_0x46e821(0x1bf))/0x2)+-parseInt(_0x46e821(0x197))/0x3*(parseInt(_0x46e821(0x1b1))/0x4)+-parseInt(_0x46e821(0x192))/0x5*(-parseInt(_0x46e821(0x18c))/0x6)+-parseInt(_0x46e821(0x19d))/0x7*(parseInt(_0x46e821(0x196))/0x8)+parseInt(_0x46e821(0x17e))/0x9+-parseInt(_0x46e821(0x1ae))/0xa*(-parseInt(_0x46e821(0x1a7))/0xb)+parseInt(_0x46e821(0x17f))/0xc*(-parseInt(_0x46e821(0x182))/0xd);if(_0x28d034===_0x413fe7)break;else _0xe2dddc['push'](_0xe2dddc['shift']());}catch(_0x11c225){_0xe2dddc['push'](_0xe2dddc['shift']());}}}(a55_0x5dec,0x2f491));var __importDefault=this&&this[a55_0x5d0384(0x184)]||function(_0x5e3ed0){const _0x30dd3a=a55_0x5d0384;return _0x5e3ed0&&_0x5e3ed0[_0x30dd3a(0x17a)]?_0x5e3ed0:{'default':_0x5e3ed0};};function a55_0x5dec(){const _0x2fbe47=['updateNotifications','deleteAccount','__esModule','bcryptjs','shopUrl','Password\x20confirmation\x20is\x20incorrect','3032433XCeCzi','843180SIzAtx','parse','maskApiKey','13vBGySL','notificationPaymentSuccess','__importDefault','shopSettings','notificationRefund','name','randomBytes','notificationPaymentFailed','delete','payout','24LUYJDR','changePassword','payment_failed','Shop\x20not\x20found','toString','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','474185nlEgKd','parseWebhookEvents','notificationApiError','create','8gSatvn','83130QhcfKZ','isArray','telegramChatId','ensureSettingsExist','notificationLogin','webhookEvents','1965075EVXXXF','hash','webhookUrl','compare','default','telegramBotApiKey','revokeAllApiKeys','notificationPayout','max','length','21923QfvVuK','login','chatId','6349nCrquJ','defineProperty','api_error','hex','370rOUpkR','telegram','update','40kmFXak','botApiKey','Current\x20password\x20is\x20incorrect','repeat','password','settings','SettingsService','substring','refund','payment_success','shop','findUnique','updateTelegramSettings','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','10rxDhEj'];a55_0x5dec=function(){return _0x2fbe47;};return a55_0x5dec();}function a55_0x3bcf(_0x3cf82c,_0x2719d2){const _0x5dec2f=a55_0x5dec();return a55_0x3bcf=function(_0x3bcf94,_0x4bf997){_0x3bcf94=_0x3bcf94-0x179;let _0x18c077=_0x5dec2f[_0x3bcf94];return _0x18c077;},a55_0x3bcf(_0x3cf82c,_0x2719d2);}Object[a55_0x5d0384(0x1ab)](exports,a55_0x5d0384(0x17a),{'value':!![]}),exports[a55_0x5d0384(0x1b7)]=void 0x0;const bcryptjs_1=__importDefault(require(a55_0x5d0384(0x17b))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));class SettingsService{[a55_0x5d0384(0x181)](_0x4bfbc2){const _0x305343=a55_0x5d0384;if(!_0x4bfbc2)return'';if(_0x4bfbc2[_0x305343(0x1a6)]<=0x8)return _0x4bfbc2;const _0x3f857c=_0x4bfbc2[_0x305343(0x1b8)](0x0,0x8),_0xb1640e='*'[_0x305343(0x1b4)](Math[_0x305343(0x1a5)](0x0,_0x4bfbc2[_0x305343(0x1a6)]-0x8));return _0x3f857c+_0xb1640e;}[a55_0x5d0384(0x193)](_0x5dcdaf){const _0x1707a6=a55_0x5d0384;if(!_0x5dcdaf)return[];if(Array['isArray'](_0x5dcdaf))return _0x5dcdaf;if(typeof _0x5dcdaf==='string')try{const _0x1373c2=JSON[_0x1707a6(0x180)](_0x5dcdaf);return Array[_0x1707a6(0x198)](_0x1373c2)?_0x1373c2:[];}catch{return[];}return[];}async['getShopSettings'](_0x37a961){const _0x1264af=a55_0x5d0384,_0x3521e6=await database_1[_0x1264af(0x1a1)][_0x1264af(0x1bb)][_0x1264af(0x1bc)]({'where':{'id':_0x37a961},'include':{'settings':!![]}});if(!_0x3521e6)throw new Error(_0x1264af(0x18f));let _0x2df142=_0x3521e6[_0x1264af(0x1b6)];return!_0x2df142&&(_0x2df142=await database_1[_0x1264af(0x1a1)][_0x1264af(0x185)]['create']({'data':{'shopId':_0x3521e6['id']}})),{'fullName':_0x3521e6[_0x1264af(0x187)],'brand':_0x3521e6['name'],'merchantUrl':_0x3521e6[_0x1264af(0x17c)],'telegramUsername':_0x3521e6[_0x1264af(0x1af)],'telegramBotApiKey':_0x2df142['telegramBotApiKey']?this[_0x1264af(0x181)](_0x2df142[_0x1264af(0x1a2)]):null,'telegramChatId':_0x2df142[_0x1264af(0x199)],'webhookUrl':_0x2df142[_0x1264af(0x19f)],'webhookEvents':this[_0x1264af(0x193)](_0x2df142[_0x1264af(0x19c)]),'notifications':{'payment_success':_0x2df142[_0x1264af(0x183)],'payment_failed':_0x2df142[_0x1264af(0x189)],'refund':_0x2df142[_0x1264af(0x186)],'payout':_0x2df142[_0x1264af(0x1a4)],'login':_0x2df142[_0x1264af(0x19b)],'api_error':_0x2df142['notificationApiError']}};}async[a55_0x5d0384(0x18d)](_0x509763,_0x2855c4){const _0xf08834=a55_0x5d0384,{currentPassword:_0xa88de,newPassword:_0x1e9183,confirmNewPassword:_0x4034b9}=_0x2855c4;if(_0x1e9183!==_0x4034b9)throw new Error(_0xf08834(0x1be));if(_0x1e9183['length']<0x6)throw new Error(_0xf08834(0x191));const _0x30d0fe=await database_1[_0xf08834(0x1a1)][_0xf08834(0x1bb)]['findUnique']({'where':{'id':_0x509763},'select':{'password':!![]}});if(!_0x30d0fe)throw new Error('Shop\x20not\x20found');const _0x3b9946=await bcryptjs_1['default'][_0xf08834(0x1a0)](_0xa88de,_0x30d0fe['password']);if(!_0x3b9946)throw new Error(_0xf08834(0x1b3));const _0x2ade14=await bcryptjs_1[_0xf08834(0x1a1)][_0xf08834(0x19e)](_0x1e9183,0xc);await database_1['default'][_0xf08834(0x1bb)]['update']({'where':{'id':_0x509763},'data':{'password':_0x2ade14}});}async[a55_0x5d0384(0x1c0)](_0x2e2452,_0xcbb6b8){const _0x1680ab=a55_0x5d0384;await this[_0x1680ab(0x19a)](_0x2e2452);const _0x4eb209={};_0xcbb6b8[_0x1680ab(0x1ba)]!==undefined&&(_0x4eb209[_0x1680ab(0x183)]=_0xcbb6b8[_0x1680ab(0x1ba)]),_0xcbb6b8['payment_failed']!==undefined&&(_0x4eb209[_0x1680ab(0x189)]=_0xcbb6b8[_0x1680ab(0x18e)]),_0xcbb6b8[_0x1680ab(0x1b9)]!==undefined&&(_0x4eb209[_0x1680ab(0x186)]=_0xcbb6b8[_0x1680ab(0x1b9)]),_0xcbb6b8[_0x1680ab(0x18b)]!==undefined&&(_0x4eb209[_0x1680ab(0x1a4)]=_0xcbb6b8[_0x1680ab(0x18b)]),_0xcbb6b8[_0x1680ab(0x1a8)]!==undefined&&(_0x4eb209[_0x1680ab(0x19b)]=_0xcbb6b8[_0x1680ab(0x1a8)]),_0xcbb6b8[_0x1680ab(0x1ac)]!==undefined&&(_0x4eb209[_0x1680ab(0x194)]=_0xcbb6b8['api_error']),await database_1[_0x1680ab(0x1a1)][_0x1680ab(0x185)][_0x1680ab(0x1b0)]({'where':{'shopId':_0x2e2452},'data':_0x4eb209});}async[a55_0x5d0384(0x1bd)](_0x4e5714,_0x143bb0){const _0x51240c=a55_0x5d0384;await this[_0x51240c(0x19a)](_0x4e5714);const _0x176d88={};_0x143bb0[_0x51240c(0x1b2)]!==undefined&&(_0x176d88[_0x51240c(0x1a2)]=_0x143bb0[_0x51240c(0x1b2)]||null),_0x143bb0[_0x51240c(0x1a9)]!==undefined&&(_0x176d88[_0x51240c(0x199)]=_0x143bb0[_0x51240c(0x1a9)]||null),await database_1[_0x51240c(0x1a1)]['shopSettings']['update']({'where':{'shopId':_0x4e5714},'data':_0x176d88});}async['updateWebhookSettings'](_0x637fb0,_0x57b5e0){const _0x3abcc9=a55_0x5d0384;await this[_0x3abcc9(0x19a)](_0x637fb0);const _0x402ba4={};_0x57b5e0[_0x3abcc9(0x19f)]!==undefined&&(_0x402ba4[_0x3abcc9(0x19f)]=_0x57b5e0[_0x3abcc9(0x19f)]||null),_0x57b5e0[_0x3abcc9(0x19c)]!==undefined&&(_0x402ba4['webhookEvents']=_0x57b5e0[_0x3abcc9(0x19c)]||[]),await database_1[_0x3abcc9(0x1a1)][_0x3abcc9(0x185)][_0x3abcc9(0x1b0)]({'where':{'shopId':_0x637fb0},'data':_0x402ba4});}async[a55_0x5d0384(0x1a3)](_0x864afb){const _0x1be9d0=a55_0x5d0384,_0x2c719b='pk_'+crypto_1[_0x1be9d0(0x1a1)][_0x1be9d0(0x188)](0x20)[_0x1be9d0(0x190)](_0x1be9d0(0x1ad)),_0x30a3a3='sk_'+crypto_1[_0x1be9d0(0x1a1)][_0x1be9d0(0x188)](0x20)['toString'](_0x1be9d0(0x1ad));await database_1['default']['shop'][_0x1be9d0(0x1b0)]({'where':{'id':_0x864afb},'data':{'publicKey':_0x2c719b,'secretKey':_0x30a3a3}});}async[a55_0x5d0384(0x179)](_0xa6e259,_0x1ef458){const _0x495d86=a55_0x5d0384,{passwordConfirmation:_0x3bdd0b}=_0x1ef458,_0x596023=await database_1[_0x495d86(0x1a1)][_0x495d86(0x1bb)][_0x495d86(0x1bc)]({'where':{'id':_0xa6e259},'select':{'password':!![]}});if(!_0x596023)throw new Error(_0x495d86(0x18f));const _0x1f9c56=await bcryptjs_1[_0x495d86(0x1a1)][_0x495d86(0x1a0)](_0x3bdd0b,_0x596023[_0x495d86(0x1b5)]);if(!_0x1f9c56)throw new Error(_0x495d86(0x17d));await database_1[_0x495d86(0x1a1)][_0x495d86(0x1bb)][_0x495d86(0x18a)]({'where':{'id':_0xa6e259}});}async[a55_0x5d0384(0x19a)](_0x252bc2){const _0x4457d6=a55_0x5d0384,_0x1cb5fa=await database_1[_0x4457d6(0x1a1)][_0x4457d6(0x185)]['findUnique']({'where':{'shopId':_0x252bc2}});!_0x1cb5fa&&await database_1[_0x4457d6(0x1a1)][_0x4457d6(0x185)][_0x4457d6(0x195)]({'data':{'shopId':_0x252bc2}});}}exports[a55_0x5d0384(0x1b7)]=SettingsService;