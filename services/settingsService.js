'use strict';const a53_0x444aa2=a53_0x5a62;(function(_0x1fb114,_0x3be695){const _0x578e34=a53_0x5a62,_0x10d4d2=_0x1fb114();while(!![]){try{const _0x561da0=parseInt(_0x578e34(0x19c))/0x1+-parseInt(_0x578e34(0x19f))/0x2+parseInt(_0x578e34(0x18a))/0x3*(parseInt(_0x578e34(0x17b))/0x4)+parseInt(_0x578e34(0x16a))/0x5*(parseInt(_0x578e34(0x198))/0x6)+parseInt(_0x578e34(0x189))/0x7+-parseInt(_0x578e34(0x1a5))/0x8+parseInt(_0x578e34(0x164))/0x9*(-parseInt(_0x578e34(0x171))/0xa);if(_0x561da0===_0x3be695)break;else _0x10d4d2['push'](_0x10d4d2['shift']());}catch(_0x5af62a){_0x10d4d2['push'](_0x10d4d2['shift']());}}}(a53_0x2afb,0x8090c));var __importDefault=this&&this[a53_0x444aa2(0x18c)]||function(_0x40cdae){const _0xdf1a97=a53_0x444aa2;return _0x40cdae&&_0x40cdae[_0xdf1a97(0x165)]?_0x40cdae:{'default':_0x40cdae};};function a53_0x2afb(){const _0x4f20b8=['webhookUrl','toString','revokeAllApiKeys','refund','Current\x20password\x20is\x20incorrect','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','966Rreejh','notificationPayout','../config/database','update','722271gcvSYD','shop','deleteAccount','1001188dDrkRD','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','updateNotifications','payment_failed','settings','repeat','6365656Waxzeq','notificationPaymentFailed','payout','telegram','54bLANwF','__esModule','notificationApiError','substring','crypto','hex','4315aBnylR','payment_success','telegramChatId','api_error','length','findUnique','telegramBotApiKey','131350jeBNMA','randomBytes','webhookEvents','updateWebhookSettings','getShopSettings','shopSettings','sk_','default','updateTelegramSettings','notificationLogin','28LmktNt','parseWebhookEvents','login','hash','Shop\x20not\x20found','pk_','ensureSettingsExist','maskApiKey','botApiKey','name','notificationPaymentSuccess','string','password','create','5289599djQenp','122076fdrxZz','chatId','__importDefault','shopUrl','notificationRefund','changePassword','defineProperty','compare'];a53_0x2afb=function(){return _0x4f20b8;};return a53_0x2afb();}Object[a53_0x444aa2(0x190)](exports,a53_0x444aa2(0x165),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a53_0x444aa2(0x168))),database_1=__importDefault(require(a53_0x444aa2(0x19a)));class SettingsService{[a53_0x444aa2(0x182)](_0x31388b){const _0x5a8b52=a53_0x444aa2;if(!_0x31388b)return'';if(_0x31388b[_0x5a8b52(0x16e)]<=0x8)return _0x31388b;const _0x48c123=_0x31388b[_0x5a8b52(0x167)](0x0,0x8),_0x4e6abe='*'[_0x5a8b52(0x1a4)](Math['max'](0x0,_0x31388b[_0x5a8b52(0x16e)]-0x8));return _0x48c123+_0x4e6abe;}[a53_0x444aa2(0x17c)](_0x197e7c){const _0x2e976a=a53_0x444aa2;if(!_0x197e7c)return[];if(Array['isArray'](_0x197e7c))return _0x197e7c;if(typeof _0x197e7c===_0x2e976a(0x186))try{const _0x256071=JSON['parse'](_0x197e7c);return Array['isArray'](_0x256071)?_0x256071:[];}catch{return[];}return[];}async[a53_0x444aa2(0x175)](_0x2c1119){const _0x1b46dc=a53_0x444aa2,_0x526001=await database_1[_0x1b46dc(0x178)]['shop'][_0x1b46dc(0x16f)]({'where':{'id':_0x2c1119},'include':{'settings':!![]}});if(!_0x526001)throw new Error(_0x1b46dc(0x17f));let _0x50ea86=_0x526001[_0x1b46dc(0x1a3)];return!_0x50ea86&&(_0x50ea86=await database_1[_0x1b46dc(0x178)][_0x1b46dc(0x176)][_0x1b46dc(0x188)]({'data':{'shopId':_0x526001['id']}})),{'fullName':_0x526001[_0x1b46dc(0x184)],'brand':_0x526001[_0x1b46dc(0x184)],'merchantUrl':_0x526001[_0x1b46dc(0x18d)],'telegramUsername':_0x526001[_0x1b46dc(0x163)],'telegramBotApiKey':_0x50ea86[_0x1b46dc(0x170)]?this[_0x1b46dc(0x182)](_0x50ea86[_0x1b46dc(0x170)]):null,'telegramChatId':_0x50ea86[_0x1b46dc(0x16c)],'webhookUrl':_0x50ea86[_0x1b46dc(0x192)],'webhookEvents':this[_0x1b46dc(0x17c)](_0x50ea86[_0x1b46dc(0x173)]),'notifications':{'payment_success':_0x50ea86[_0x1b46dc(0x185)],'payment_failed':_0x50ea86[_0x1b46dc(0x1a6)],'refund':_0x50ea86['notificationRefund'],'payout':_0x50ea86[_0x1b46dc(0x199)],'login':_0x50ea86[_0x1b46dc(0x17a)],'api_error':_0x50ea86[_0x1b46dc(0x166)]}};}async[a53_0x444aa2(0x18f)](_0x572cf0,_0xbdd986){const _0x51493f=a53_0x444aa2,{currentPassword:_0x2596d3,newPassword:_0xdafda,confirmNewPassword:_0x402167}=_0xbdd986;if(_0xdafda!==_0x402167)throw new Error(_0x51493f(0x197));if(_0xdafda['length']<0x6)throw new Error(_0x51493f(0x1a0));const _0xc3f685=await database_1['default'][_0x51493f(0x19d)][_0x51493f(0x16f)]({'where':{'id':_0x572cf0},'select':{'password':!![]}});if(!_0xc3f685)throw new Error('Shop\x20not\x20found');const _0x5b4e1a=await bcryptjs_1[_0x51493f(0x178)][_0x51493f(0x191)](_0x2596d3,_0xc3f685[_0x51493f(0x187)]);if(!_0x5b4e1a)throw new Error(_0x51493f(0x196));const _0x2f5aa0=await bcryptjs_1[_0x51493f(0x178)][_0x51493f(0x17e)](_0xdafda,0xc);await database_1['default'][_0x51493f(0x19d)][_0x51493f(0x19b)]({'where':{'id':_0x572cf0},'data':{'password':_0x2f5aa0}});}async[a53_0x444aa2(0x1a1)](_0x5ecc94,_0x1c20ce){const _0x193f1b=a53_0x444aa2;await this[_0x193f1b(0x181)](_0x5ecc94);const _0x5d2578={};_0x1c20ce['payment_success']!==undefined&&(_0x5d2578[_0x193f1b(0x185)]=_0x1c20ce[_0x193f1b(0x16b)]),_0x1c20ce['payment_failed']!==undefined&&(_0x5d2578[_0x193f1b(0x1a6)]=_0x1c20ce[_0x193f1b(0x1a2)]),_0x1c20ce[_0x193f1b(0x195)]!==undefined&&(_0x5d2578[_0x193f1b(0x18e)]=_0x1c20ce[_0x193f1b(0x195)]),_0x1c20ce[_0x193f1b(0x1a7)]!==undefined&&(_0x5d2578['notificationPayout']=_0x1c20ce[_0x193f1b(0x1a7)]),_0x1c20ce[_0x193f1b(0x17d)]!==undefined&&(_0x5d2578['notificationLogin']=_0x1c20ce[_0x193f1b(0x17d)]),_0x1c20ce[_0x193f1b(0x16d)]!==undefined&&(_0x5d2578['notificationApiError']=_0x1c20ce[_0x193f1b(0x16d)]),await database_1[_0x193f1b(0x178)][_0x193f1b(0x176)][_0x193f1b(0x19b)]({'where':{'shopId':_0x5ecc94},'data':_0x5d2578});}async[a53_0x444aa2(0x179)](_0x22539c,_0xcb649b){const _0x30b7fa=a53_0x444aa2;await this[_0x30b7fa(0x181)](_0x22539c);const _0x3ca03d={};_0xcb649b[_0x30b7fa(0x183)]!==undefined&&(_0x3ca03d[_0x30b7fa(0x170)]=_0xcb649b[_0x30b7fa(0x183)]||null),_0xcb649b['chatId']!==undefined&&(_0x3ca03d['telegramChatId']=_0xcb649b[_0x30b7fa(0x18b)]||null),await database_1[_0x30b7fa(0x178)][_0x30b7fa(0x176)][_0x30b7fa(0x19b)]({'where':{'shopId':_0x22539c},'data':_0x3ca03d});}async[a53_0x444aa2(0x174)](_0x6bb39d,_0x49c127){const _0x2b37b8=a53_0x444aa2;await this[_0x2b37b8(0x181)](_0x6bb39d);const _0x29b230={};_0x49c127[_0x2b37b8(0x192)]!==undefined&&(_0x29b230[_0x2b37b8(0x192)]=_0x49c127[_0x2b37b8(0x192)]||null),_0x49c127[_0x2b37b8(0x173)]!==undefined&&(_0x29b230[_0x2b37b8(0x173)]=_0x49c127['webhookEvents']||[]),await database_1[_0x2b37b8(0x178)][_0x2b37b8(0x176)][_0x2b37b8(0x19b)]({'where':{'shopId':_0x6bb39d},'data':_0x29b230});}async[a53_0x444aa2(0x194)](_0x5ef4aa){const _0x619e3d=a53_0x444aa2,_0x51720a=_0x619e3d(0x180)+crypto_1[_0x619e3d(0x178)][_0x619e3d(0x172)](0x20)[_0x619e3d(0x193)](_0x619e3d(0x169)),_0x341688=_0x619e3d(0x177)+crypto_1[_0x619e3d(0x178)][_0x619e3d(0x172)](0x20)[_0x619e3d(0x193)](_0x619e3d(0x169));await database_1['default'][_0x619e3d(0x19d)][_0x619e3d(0x19b)]({'where':{'id':_0x5ef4aa},'data':{'publicKey':_0x51720a,'secretKey':_0x341688}});}async[a53_0x444aa2(0x19e)](_0x26347a,_0x4161b6){const _0x105676=a53_0x444aa2,{passwordConfirmation:_0x4f15e7}=_0x4161b6,_0x4f78c3=await database_1[_0x105676(0x178)][_0x105676(0x19d)][_0x105676(0x16f)]({'where':{'id':_0x26347a},'select':{'password':!![]}});if(!_0x4f78c3)throw new Error(_0x105676(0x17f));const _0x5592b3=await bcryptjs_1['default']['compare'](_0x4f15e7,_0x4f78c3['password']);if(!_0x5592b3)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x105676(0x178)][_0x105676(0x19d)]['delete']({'where':{'id':_0x26347a}});}async[a53_0x444aa2(0x181)](_0x298aa1){const _0x3f9766=a53_0x444aa2,_0x1a0d0a=await database_1[_0x3f9766(0x178)][_0x3f9766(0x176)]['findUnique']({'where':{'shopId':_0x298aa1}});!_0x1a0d0a&&await database_1[_0x3f9766(0x178)][_0x3f9766(0x176)][_0x3f9766(0x188)]({'data':{'shopId':_0x298aa1}});}}function a53_0x5a62(_0x5bf981,_0x365365){const _0x2afbd5=a53_0x2afb();return a53_0x5a62=function(_0x5a6229,_0x5934ae){_0x5a6229=_0x5a6229-0x163;let _0xdbf74f=_0x2afbd5[_0x5a6229];return _0xdbf74f;},a53_0x5a62(_0x5bf981,_0x365365);}exports['SettingsService']=SettingsService;