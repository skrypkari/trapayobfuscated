'use strict';const a47_0x404b48=a47_0x6596;(function(_0x1cc886,_0x563f1d){const _0x135acc=a47_0x6596,_0x1f840d=_0x1cc886();while(!![]){try{const _0x5c6cdc=parseInt(_0x135acc(0x111))/0x1*(parseInt(_0x135acc(0xf9))/0x2)+parseInt(_0x135acc(0xee))/0x3+parseInt(_0x135acc(0x105))/0x4+-parseInt(_0x135acc(0x100))/0x5+parseInt(_0x135acc(0x104))/0x6+parseInt(_0x135acc(0xf4))/0x7*(-parseInt(_0x135acc(0xf3))/0x8)+parseInt(_0x135acc(0xe0))/0x9*(-parseInt(_0x135acc(0xd6))/0xa);if(_0x5c6cdc===_0x563f1d)break;else _0x1f840d['push'](_0x1f840d['shift']());}catch(_0x326da3){_0x1f840d['push'](_0x1f840d['shift']());}}}(a47_0xf473,0x1f2ac));var __importDefault=this&&this[a47_0x404b48(0xf7)]||function(_0x51c0a9){const _0x69b07a=a47_0x404b48;return _0x51c0a9&&_0x51c0a9[_0x69b07a(0xf2)]?_0x51c0a9:{'default':_0x51c0a9};};function a47_0x6596(_0x398c21,_0x416599){const _0xf4731e=a47_0xf473();return a47_0x6596=function(_0x659698,_0x4370cf){_0x659698=_0x659698-0xd4;let _0x571bd7=_0xf4731e[_0x659698];return _0x571bd7;},a47_0x6596(_0x398c21,_0x416599);}Object[a47_0x404b48(0xe7)](exports,a47_0x404b48(0xf2),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));function a47_0xf473(){const _0xa93c23=['updateWebhookSettings','shop','1234230ezFmOP','921564BNtUdT','password','notificationLogin','delete','sk_','payout','findUnique','shopSettings','chatId','payment_success','api_error','isArray','205663ZdNjjw','refund','notificationRefund','18010cReOAQ','string','updateNotifications','notificationPaymentSuccess','substring','compare','webhookEvents','maskApiKey','settings','name','1431zlTvau','changePassword','notificationPayout','shopUrl','revokeAllApiKeys','hash','toString','defineProperty','notificationApiError','updateTelegramSettings','length','login','telegramBotApiKey','default','45972tKXyce','randomBytes','hex','ensureSettingsExist','__esModule','696rXgzXC','7784LUjNer','create','botApiKey','__importDefault','pk_','2CcfWsF','parseWebhookEvents','webhookUrl','notificationPaymentFailed','update','Password\x20confirmation\x20is\x20incorrect','telegramChatId','731600cCJXdm','Shop\x20not\x20found'];a47_0xf473=function(){return _0xa93c23;};return a47_0xf473();}class SettingsService{[a47_0x404b48(0xdd)](_0x17553e){const _0x3c6f72=a47_0x404b48;if(!_0x17553e)return'';if(_0x17553e['length']<=0x8)return _0x17553e;const _0x1cae3d=_0x17553e[_0x3c6f72(0xda)](0x0,0x8),_0x182942='*'['repeat'](Math['max'](0x0,_0x17553e[_0x3c6f72(0xea)]-0x8));return _0x1cae3d+_0x182942;}['parseWebhookEvents'](_0x2a99c9){const _0x1510e8=a47_0x404b48;if(!_0x2a99c9)return[];if(Array[_0x1510e8(0x110)](_0x2a99c9))return _0x2a99c9;if(typeof _0x2a99c9===_0x1510e8(0xd7))try{const _0x5d7ce0=JSON['parse'](_0x2a99c9);return Array[_0x1510e8(0x110)](_0x5d7ce0)?_0x5d7ce0:[];}catch{return[];}return[];}async['getShopSettings'](_0x1d7e9a){const _0x489071=a47_0x404b48,_0x52fafe=await database_1[_0x489071(0xed)][_0x489071(0x103)][_0x489071(0x10b)]({'where':{'id':_0x1d7e9a},'include':{'settings':!![]}});if(!_0x52fafe)throw new Error('Shop\x20not\x20found');let _0x3186b0=_0x52fafe[_0x489071(0xde)];return!_0x3186b0&&(_0x3186b0=await database_1['default'][_0x489071(0x10c)][_0x489071(0xf5)]({'data':{'shopId':_0x52fafe['id']}})),{'fullName':_0x52fafe[_0x489071(0xdf)],'brand':_0x52fafe[_0x489071(0xdf)],'merchantUrl':_0x52fafe[_0x489071(0xe3)],'telegramUsername':_0x52fafe['telegram'],'telegramBotApiKey':_0x3186b0[_0x489071(0xec)]?this[_0x489071(0xdd)](_0x3186b0[_0x489071(0xec)]):null,'telegramChatId':_0x3186b0[_0x489071(0xff)],'webhookUrl':_0x3186b0['webhookUrl'],'webhookEvents':this[_0x489071(0xfa)](_0x3186b0[_0x489071(0xdc)]),'notifications':{'payment_success':_0x3186b0[_0x489071(0xd9)],'payment_failed':_0x3186b0[_0x489071(0xfc)],'refund':_0x3186b0[_0x489071(0xd5)],'payout':_0x3186b0[_0x489071(0xe2)],'login':_0x3186b0[_0x489071(0x107)],'api_error':_0x3186b0[_0x489071(0xe8)]}};}async[a47_0x404b48(0xe1)](_0x59a3c3,_0x2ec87b){const _0x395e18=a47_0x404b48,{currentPassword:_0x209886,newPassword:_0x181865,confirmNewPassword:_0x2d4b20}=_0x2ec87b;if(_0x181865!==_0x2d4b20)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x181865['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x7a3ecf=await database_1['default']['shop']['findUnique']({'where':{'id':_0x59a3c3},'select':{'password':!![]}});if(!_0x7a3ecf)throw new Error(_0x395e18(0x101));const _0x4d86e6=await bcryptjs_1[_0x395e18(0xed)][_0x395e18(0xdb)](_0x209886,_0x7a3ecf[_0x395e18(0x106)]);if(!_0x4d86e6)throw new Error('Current\x20password\x20is\x20incorrect');const _0x4ac037=await bcryptjs_1[_0x395e18(0xed)][_0x395e18(0xe5)](_0x181865,0xc);await database_1[_0x395e18(0xed)]['shop'][_0x395e18(0xfd)]({'where':{'id':_0x59a3c3},'data':{'password':_0x4ac037}});}async[a47_0x404b48(0xd8)](_0x2bbea4,_0x593d0b){const _0x410811=a47_0x404b48;await this[_0x410811(0xf1)](_0x2bbea4);const _0x1cc292={};_0x593d0b['payment_success']!==undefined&&(_0x1cc292[_0x410811(0xd9)]=_0x593d0b[_0x410811(0x10e)]),_0x593d0b['payment_failed']!==undefined&&(_0x1cc292[_0x410811(0xfc)]=_0x593d0b['payment_failed']),_0x593d0b[_0x410811(0xd4)]!==undefined&&(_0x1cc292[_0x410811(0xd5)]=_0x593d0b['refund']),_0x593d0b['payout']!==undefined&&(_0x1cc292[_0x410811(0xe2)]=_0x593d0b[_0x410811(0x10a)]),_0x593d0b[_0x410811(0xeb)]!==undefined&&(_0x1cc292[_0x410811(0x107)]=_0x593d0b['login']),_0x593d0b[_0x410811(0x10f)]!==undefined&&(_0x1cc292['notificationApiError']=_0x593d0b['api_error']),await database_1[_0x410811(0xed)][_0x410811(0x10c)]['update']({'where':{'shopId':_0x2bbea4},'data':_0x1cc292});}async[a47_0x404b48(0xe9)](_0x2b179c,_0x497af8){const _0x24c580=a47_0x404b48;await this['ensureSettingsExist'](_0x2b179c);const _0x4b9da8={};_0x497af8[_0x24c580(0xf6)]!==undefined&&(_0x4b9da8[_0x24c580(0xec)]=_0x497af8[_0x24c580(0xf6)]||null),_0x497af8[_0x24c580(0x10d)]!==undefined&&(_0x4b9da8[_0x24c580(0xff)]=_0x497af8[_0x24c580(0x10d)]||null),await database_1[_0x24c580(0xed)][_0x24c580(0x10c)][_0x24c580(0xfd)]({'where':{'shopId':_0x2b179c},'data':_0x4b9da8});}async[a47_0x404b48(0x102)](_0x572dbb,_0x577344){const _0x3f0a1d=a47_0x404b48;await this[_0x3f0a1d(0xf1)](_0x572dbb);const _0x52d39c={};_0x577344[_0x3f0a1d(0xfb)]!==undefined&&(_0x52d39c[_0x3f0a1d(0xfb)]=_0x577344[_0x3f0a1d(0xfb)]||null),_0x577344[_0x3f0a1d(0xdc)]!==undefined&&(_0x52d39c[_0x3f0a1d(0xdc)]=_0x577344[_0x3f0a1d(0xdc)]||[]),await database_1[_0x3f0a1d(0xed)][_0x3f0a1d(0x10c)][_0x3f0a1d(0xfd)]({'where':{'shopId':_0x572dbb},'data':_0x52d39c});}async[a47_0x404b48(0xe4)](_0x47dfce){const _0x48f864=a47_0x404b48,_0x5833d2=_0x48f864(0xf8)+crypto_1[_0x48f864(0xed)][_0x48f864(0xef)](0x20)[_0x48f864(0xe6)](_0x48f864(0xf0)),_0x162e5d=_0x48f864(0x109)+crypto_1['default'][_0x48f864(0xef)](0x20)[_0x48f864(0xe6)]('hex');await database_1[_0x48f864(0xed)][_0x48f864(0x103)]['update']({'where':{'id':_0x47dfce},'data':{'publicKey':_0x5833d2,'secretKey':_0x162e5d}});}async['deleteAccount'](_0xb5326,_0x37d6d3){const _0x27e17a=a47_0x404b48,{passwordConfirmation:_0x44d9f5}=_0x37d6d3,_0xd36d74=await database_1[_0x27e17a(0xed)][_0x27e17a(0x103)][_0x27e17a(0x10b)]({'where':{'id':_0xb5326},'select':{'password':!![]}});if(!_0xd36d74)throw new Error(_0x27e17a(0x101));const _0x1e844e=await bcryptjs_1[_0x27e17a(0xed)][_0x27e17a(0xdb)](_0x44d9f5,_0xd36d74[_0x27e17a(0x106)]);if(!_0x1e844e)throw new Error(_0x27e17a(0xfe));await database_1[_0x27e17a(0xed)][_0x27e17a(0x103)][_0x27e17a(0x108)]({'where':{'id':_0xb5326}});}async[a47_0x404b48(0xf1)](_0x18489f){const _0x2f4fdb=a47_0x404b48,_0xefb333=await database_1[_0x2f4fdb(0xed)][_0x2f4fdb(0x10c)][_0x2f4fdb(0x10b)]({'where':{'shopId':_0x18489f}});!_0xefb333&&await database_1[_0x2f4fdb(0xed)][_0x2f4fdb(0x10c)]['create']({'data':{'shopId':_0x18489f}});}}exports['SettingsService']=SettingsService;