'use strict';const a53_0x343bba=a53_0xc0b2;function a53_0xc0b2(_0x1d42cd,_0x335514){const _0x2b7534=a53_0x2b75();return a53_0xc0b2=function(_0xc0b204,_0x174c86){_0xc0b204=_0xc0b204-0x14b;let _0x3ebce2=_0x2b7534[_0xc0b204];return _0x3ebce2;},a53_0xc0b2(_0x1d42cd,_0x335514);}function a53_0x2b75(){const _0x586b68=['toString','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','__importDefault','updateWebhookSettings','../config/database','2275660TCFQss','webhookEvents','Current\x20password\x20is\x20incorrect','notificationLogin','24842oLmHFG','__esModule','refund','substring','ensureSettingsExist','default','shopUrl','parseWebhookEvents','payout','findUnique','4402072bhBbfR','update','hash','11398486UjNszb','notificationPaymentFailed','deleteAccount','notificationPaymentSuccess','isArray','length','414cTAgGW','Shop\x20not\x20found','randomBytes','api_error','settings','notificationPayout','9MKeJuG','payment_failed','telegramChatId','telegram','notificationApiError','pk_','maskApiKey','shopSettings','sk_','84154abFely','create','1661615uRAfDH','notificationRefund','password','shop','4gQisjY','parse','compare','672837QOCKRF','login','payment_success','botApiKey','SettingsService','40BoKzZQ','repeat','telegramBotApiKey','webhookUrl','name','chatId','defineProperty'];a53_0x2b75=function(){return _0x586b68;};return a53_0x2b75();}(function(_0x49ed44,_0xa438fb){const _0x48d4ed=a53_0xc0b2,_0x32394a=_0x49ed44();while(!![]){try{const _0x370709=-parseInt(_0x48d4ed(0x166))/0x1*(-parseInt(_0x48d4ed(0x176))/0x2)+-parseInt(_0x48d4ed(0x161))/0x3*(-parseInt(_0x48d4ed(0x15e))/0x4)+-parseInt(_0x48d4ed(0x15a))/0x5+parseInt(_0x48d4ed(0x189))/0x6*(parseInt(_0x48d4ed(0x158))/0x7)+parseInt(_0x48d4ed(0x180))/0x8+parseInt(_0x48d4ed(0x14f))/0x9*(-parseInt(_0x48d4ed(0x172))/0xa)+-parseInt(_0x48d4ed(0x183))/0xb;if(_0x370709===_0xa438fb)break;else _0x32394a['push'](_0x32394a['shift']());}catch(_0x7bdce0){_0x32394a['push'](_0x32394a['shift']());}}}(a53_0x2b75,0x7b3cd));var __importDefault=this&&this[a53_0x343bba(0x16f)]||function(_0x18a24b){const _0x56d199=a53_0x343bba;return _0x18a24b&&_0x18a24b[_0x56d199(0x177)]?_0x18a24b:{'default':_0x18a24b};};Object[a53_0x343bba(0x16c)](exports,'__esModule',{'value':!![]}),exports[a53_0x343bba(0x165)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a53_0x343bba(0x171)));class SettingsService{['maskApiKey'](_0x49d67f){const _0x244b7b=a53_0x343bba;if(!_0x49d67f)return'';if(_0x49d67f[_0x244b7b(0x188)]<=0x8)return _0x49d67f;const _0x48c5e6=_0x49d67f[_0x244b7b(0x179)](0x0,0x8),_0x5e26c9='*'[_0x244b7b(0x167)](Math['max'](0x0,_0x49d67f[_0x244b7b(0x188)]-0x8));return _0x48c5e6+_0x5e26c9;}[a53_0x343bba(0x17d)](_0x24cfb9){const _0x29db23=a53_0x343bba;if(!_0x24cfb9)return[];if(Array[_0x29db23(0x187)](_0x24cfb9))return _0x24cfb9;if(typeof _0x24cfb9==='string')try{const _0x408ae5=JSON[_0x29db23(0x15f)](_0x24cfb9);return Array[_0x29db23(0x187)](_0x408ae5)?_0x408ae5:[];}catch{return[];}return[];}async['getShopSettings'](_0x41ea7f){const _0x231185=a53_0x343bba,_0x207450=await database_1[_0x231185(0x17b)]['shop'][_0x231185(0x17f)]({'where':{'id':_0x41ea7f},'include':{'settings':!![]}});if(!_0x207450)throw new Error('Shop\x20not\x20found');let _0x230b39=_0x207450[_0x231185(0x14d)];return!_0x230b39&&(_0x230b39=await database_1[_0x231185(0x17b)]['shopSettings'][_0x231185(0x159)]({'data':{'shopId':_0x207450['id']}})),{'fullName':_0x207450[_0x231185(0x16a)],'brand':_0x207450[_0x231185(0x16a)],'merchantUrl':_0x207450[_0x231185(0x17c)],'telegramUsername':_0x207450[_0x231185(0x152)],'telegramBotApiKey':_0x230b39[_0x231185(0x168)]?this[_0x231185(0x155)](_0x230b39['telegramBotApiKey']):null,'telegramChatId':_0x230b39[_0x231185(0x151)],'webhookUrl':_0x230b39['webhookUrl'],'webhookEvents':this[_0x231185(0x17d)](_0x230b39[_0x231185(0x173)]),'notifications':{'payment_success':_0x230b39[_0x231185(0x186)],'payment_failed':_0x230b39[_0x231185(0x184)],'refund':_0x230b39[_0x231185(0x15b)],'payout':_0x230b39[_0x231185(0x14e)],'login':_0x230b39['notificationLogin'],'api_error':_0x230b39[_0x231185(0x153)]}};}async['changePassword'](_0x2a400c,_0x82c919){const _0x48d013=a53_0x343bba,{currentPassword:_0x587399,newPassword:_0x302294,confirmNewPassword:_0xd728ad}=_0x82c919;if(_0x302294!==_0xd728ad)throw new Error(_0x48d013(0x16e));if(_0x302294[_0x48d013(0x188)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x2f37cb=await database_1[_0x48d013(0x17b)][_0x48d013(0x15d)][_0x48d013(0x17f)]({'where':{'id':_0x2a400c},'select':{'password':!![]}});if(!_0x2f37cb)throw new Error(_0x48d013(0x18a));const _0x139700=await bcryptjs_1['default'][_0x48d013(0x160)](_0x587399,_0x2f37cb['password']);if(!_0x139700)throw new Error(_0x48d013(0x174));const _0xca45c=await bcryptjs_1['default'][_0x48d013(0x182)](_0x302294,0xc);await database_1['default'][_0x48d013(0x15d)]['update']({'where':{'id':_0x2a400c},'data':{'password':_0xca45c}});}async['updateNotifications'](_0x49097a,_0x5b0d9d){const _0x3222c2=a53_0x343bba;await this[_0x3222c2(0x17a)](_0x49097a);const _0x41ca8b={};_0x5b0d9d[_0x3222c2(0x163)]!==undefined&&(_0x41ca8b[_0x3222c2(0x186)]=_0x5b0d9d[_0x3222c2(0x163)]),_0x5b0d9d['payment_failed']!==undefined&&(_0x41ca8b['notificationPaymentFailed']=_0x5b0d9d[_0x3222c2(0x150)]),_0x5b0d9d['refund']!==undefined&&(_0x41ca8b['notificationRefund']=_0x5b0d9d[_0x3222c2(0x178)]),_0x5b0d9d[_0x3222c2(0x17e)]!==undefined&&(_0x41ca8b[_0x3222c2(0x14e)]=_0x5b0d9d['payout']),_0x5b0d9d['login']!==undefined&&(_0x41ca8b[_0x3222c2(0x175)]=_0x5b0d9d[_0x3222c2(0x162)]),_0x5b0d9d[_0x3222c2(0x14c)]!==undefined&&(_0x41ca8b[_0x3222c2(0x153)]=_0x5b0d9d[_0x3222c2(0x14c)]),await database_1[_0x3222c2(0x17b)][_0x3222c2(0x156)][_0x3222c2(0x181)]({'where':{'shopId':_0x49097a},'data':_0x41ca8b});}async['updateTelegramSettings'](_0x387f2e,_0x526fa5){const _0x3406f5=a53_0x343bba;await this[_0x3406f5(0x17a)](_0x387f2e);const _0xe81fb7={};_0x526fa5[_0x3406f5(0x164)]!==undefined&&(_0xe81fb7[_0x3406f5(0x168)]=_0x526fa5[_0x3406f5(0x164)]||null),_0x526fa5[_0x3406f5(0x16b)]!==undefined&&(_0xe81fb7[_0x3406f5(0x151)]=_0x526fa5['chatId']||null),await database_1[_0x3406f5(0x17b)][_0x3406f5(0x156)][_0x3406f5(0x181)]({'where':{'shopId':_0x387f2e},'data':_0xe81fb7});}async[a53_0x343bba(0x170)](_0x1e6734,_0x29bf54){const _0x259d42=a53_0x343bba;await this['ensureSettingsExist'](_0x1e6734);const _0x450041={};_0x29bf54[_0x259d42(0x169)]!==undefined&&(_0x450041['webhookUrl']=_0x29bf54[_0x259d42(0x169)]||null),_0x29bf54['webhookEvents']!==undefined&&(_0x450041[_0x259d42(0x173)]=_0x29bf54['webhookEvents']||[]),await database_1['default'][_0x259d42(0x156)][_0x259d42(0x181)]({'where':{'shopId':_0x1e6734},'data':_0x450041});}async['revokeAllApiKeys'](_0x57954f){const _0x2ce650=a53_0x343bba,_0x368a16=_0x2ce650(0x154)+crypto_1[_0x2ce650(0x17b)][_0x2ce650(0x14b)](0x20)[_0x2ce650(0x16d)]('hex'),_0x17a4a5=_0x2ce650(0x157)+crypto_1['default'][_0x2ce650(0x14b)](0x20)[_0x2ce650(0x16d)]('hex');await database_1[_0x2ce650(0x17b)][_0x2ce650(0x15d)][_0x2ce650(0x181)]({'where':{'id':_0x57954f},'data':{'publicKey':_0x368a16,'secretKey':_0x17a4a5}});}async[a53_0x343bba(0x185)](_0x4a8b50,_0x41d3d2){const _0x3cc468=a53_0x343bba,{passwordConfirmation:_0x2518ca}=_0x41d3d2,_0x21f230=await database_1[_0x3cc468(0x17b)]['shop']['findUnique']({'where':{'id':_0x4a8b50},'select':{'password':!![]}});if(!_0x21f230)throw new Error('Shop\x20not\x20found');const _0x32e6ed=await bcryptjs_1[_0x3cc468(0x17b)][_0x3cc468(0x160)](_0x2518ca,_0x21f230[_0x3cc468(0x15c)]);if(!_0x32e6ed)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1['default'][_0x3cc468(0x15d)]['delete']({'where':{'id':_0x4a8b50}});}async[a53_0x343bba(0x17a)](_0x2fb153){const _0x365834=a53_0x343bba,_0x48e3fd=await database_1['default'][_0x365834(0x156)][_0x365834(0x17f)]({'where':{'shopId':_0x2fb153}});!_0x48e3fd&&await database_1[_0x365834(0x17b)]['shopSettings'][_0x365834(0x159)]({'data':{'shopId':_0x2fb153}});}}exports[a53_0x343bba(0x165)]=SettingsService;