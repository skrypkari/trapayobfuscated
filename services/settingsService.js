'use strict';const a50_0x3462c8=a50_0x3232;(function(_0x21635b,_0x4491b2){const _0x31c9c3=a50_0x3232,_0x53bdcd=_0x21635b();while(!![]){try{const _0x46ce39=-parseInt(_0x31c9c3(0x14c))/0x1*(parseInt(_0x31c9c3(0x126))/0x2)+parseInt(_0x31c9c3(0x155))/0x3*(-parseInt(_0x31c9c3(0x144))/0x4)+-parseInt(_0x31c9c3(0x11e))/0x5*(parseInt(_0x31c9c3(0x128))/0x6)+parseInt(_0x31c9c3(0x139))/0x7+-parseInt(_0x31c9c3(0x150))/0x8+parseInt(_0x31c9c3(0x129))/0x9+parseInt(_0x31c9c3(0x13d))/0xa;if(_0x46ce39===_0x4491b2)break;else _0x53bdcd['push'](_0x53bdcd['shift']());}catch(_0xd244b5){_0x53bdcd['push'](_0x53bdcd['shift']());}}}(a50_0x50e1,0xc4ff8));var __importDefault=this&&this[a50_0x3462c8(0x130)]||function(_0x5aa241){const _0x1f229d=a50_0x3462c8;return _0x5aa241&&_0x5aa241[_0x1f229d(0x13c)]?_0x5aa241:{'default':_0x5aa241};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a50_0x3462c8(0x151)]=void 0x0;const bcryptjs_1=__importDefault(require(a50_0x3462c8(0x12d))),crypto_1=__importDefault(require(a50_0x3462c8(0x125))),database_1=__importDefault(require('../config/database'));class SettingsService{[a50_0x3462c8(0x123)](_0x496490){const _0x256c62=a50_0x3462c8;if(!_0x496490)return'';if(_0x496490[_0x256c62(0x15f)]<=0x8)return _0x496490;const _0x4a41c0=_0x496490[_0x256c62(0x12f)](0x0,0x8),_0x5462d6='*'[_0x256c62(0x134)](Math[_0x256c62(0x15b)](0x0,_0x496490[_0x256c62(0x15f)]-0x8));return _0x4a41c0+_0x5462d6;}[a50_0x3462c8(0x153)](_0x49b9c0){const _0x40d521=a50_0x3462c8;if(!_0x49b9c0)return[];if(Array[_0x40d521(0x12b)](_0x49b9c0))return _0x49b9c0;if(typeof _0x49b9c0===_0x40d521(0x143))try{const _0x579e43=JSON[_0x40d521(0x133)](_0x49b9c0);return Array[_0x40d521(0x12b)](_0x579e43)?_0x579e43:[];}catch{return[];}return[];}async[a50_0x3462c8(0x154)](_0x2edc72){const _0x45698d=a50_0x3462c8,_0x536216=await database_1['default'][_0x45698d(0x15c)][_0x45698d(0x124)]({'where':{'id':_0x2edc72},'include':{'settings':!![]}});if(!_0x536216)throw new Error(_0x45698d(0x12c));let _0x5373b0=_0x536216[_0x45698d(0x141)];return!_0x5373b0&&(_0x5373b0=await database_1[_0x45698d(0x160)][_0x45698d(0x142)][_0x45698d(0x146)]({'data':{'shopId':_0x536216['id']}})),{'fullName':_0x536216[_0x45698d(0x121)],'brand':_0x536216[_0x45698d(0x121)],'merchantUrl':_0x536216[_0x45698d(0x158)],'telegramUsername':_0x536216[_0x45698d(0x13f)],'telegramBotApiKey':_0x5373b0[_0x45698d(0x135)]?this[_0x45698d(0x123)](_0x5373b0[_0x45698d(0x135)]):null,'telegramChatId':_0x5373b0[_0x45698d(0x120)],'webhookUrl':_0x5373b0[_0x45698d(0x13e)],'webhookEvents':this['parseWebhookEvents'](_0x5373b0[_0x45698d(0x131)]),'notifications':{'payment_success':_0x5373b0[_0x45698d(0x156)],'payment_failed':_0x5373b0[_0x45698d(0x136)],'refund':_0x5373b0['notificationRefund'],'payout':_0x5373b0['notificationPayout'],'login':_0x5373b0[_0x45698d(0x149)],'api_error':_0x5373b0[_0x45698d(0x13b)]}};}async['changePassword'](_0x130f97,_0x455a23){const _0x22b9db=a50_0x3462c8,{currentPassword:_0x5dd55f,newPassword:_0x24c1e0,confirmNewPassword:_0x4155aa}=_0x455a23;if(_0x24c1e0!==_0x4155aa)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x24c1e0['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x20f86c=await database_1[_0x22b9db(0x160)][_0x22b9db(0x15c)][_0x22b9db(0x124)]({'where':{'id':_0x130f97},'select':{'password':!![]}});if(!_0x20f86c)throw new Error(_0x22b9db(0x12c));const _0x131448=await bcryptjs_1[_0x22b9db(0x160)][_0x22b9db(0x14f)](_0x5dd55f,_0x20f86c['password']);if(!_0x131448)throw new Error(_0x22b9db(0x159));const _0x57b027=await bcryptjs_1[_0x22b9db(0x160)][_0x22b9db(0x12e)](_0x24c1e0,0xc);await database_1[_0x22b9db(0x160)][_0x22b9db(0x15c)]['update']({'where':{'id':_0x130f97},'data':{'password':_0x57b027}});}async[a50_0x3462c8(0x157)](_0x2c2d09,_0x1f3d49){const _0x46136e=a50_0x3462c8;await this[_0x46136e(0x127)](_0x2c2d09);const _0x1a06d3={};_0x1f3d49[_0x46136e(0x12a)]!==undefined&&(_0x1a06d3[_0x46136e(0x156)]=_0x1f3d49[_0x46136e(0x12a)]),_0x1f3d49['payment_failed']!==undefined&&(_0x1a06d3[_0x46136e(0x136)]=_0x1f3d49['payment_failed']),_0x1f3d49[_0x46136e(0x140)]!==undefined&&(_0x1a06d3[_0x46136e(0x147)]=_0x1f3d49['refund']),_0x1f3d49[_0x46136e(0x15d)]!==undefined&&(_0x1a06d3[_0x46136e(0x138)]=_0x1f3d49[_0x46136e(0x15d)]),_0x1f3d49['login']!==undefined&&(_0x1a06d3[_0x46136e(0x149)]=_0x1f3d49[_0x46136e(0x137)]),_0x1f3d49[_0x46136e(0x152)]!==undefined&&(_0x1a06d3[_0x46136e(0x13b)]=_0x1f3d49[_0x46136e(0x152)]),await database_1[_0x46136e(0x160)][_0x46136e(0x142)][_0x46136e(0x13a)]({'where':{'shopId':_0x2c2d09},'data':_0x1a06d3});}async[a50_0x3462c8(0x132)](_0x423844,_0x3c9535){const _0x2bef53=a50_0x3462c8;await this[_0x2bef53(0x127)](_0x423844);const _0x41dd23={};_0x3c9535[_0x2bef53(0x11f)]!==undefined&&(_0x41dd23[_0x2bef53(0x135)]=_0x3c9535[_0x2bef53(0x11f)]||null),_0x3c9535[_0x2bef53(0x145)]!==undefined&&(_0x41dd23[_0x2bef53(0x120)]=_0x3c9535[_0x2bef53(0x145)]||null),await database_1[_0x2bef53(0x160)]['shopSettings'][_0x2bef53(0x13a)]({'where':{'shopId':_0x423844},'data':_0x41dd23});}async[a50_0x3462c8(0x15e)](_0x25abbd,_0x1aafee){const _0x412dec=a50_0x3462c8;await this[_0x412dec(0x127)](_0x25abbd);const _0x402ee7={};_0x1aafee['webhookUrl']!==undefined&&(_0x402ee7[_0x412dec(0x13e)]=_0x1aafee[_0x412dec(0x13e)]||null),_0x1aafee[_0x412dec(0x131)]!==undefined&&(_0x402ee7[_0x412dec(0x131)]=_0x1aafee[_0x412dec(0x131)]||[]),await database_1[_0x412dec(0x160)][_0x412dec(0x142)][_0x412dec(0x13a)]({'where':{'shopId':_0x25abbd},'data':_0x402ee7});}async[a50_0x3462c8(0x15a)](_0x387153){const _0x2ac9b8=a50_0x3462c8,_0x5c99ef=_0x2ac9b8(0x14a)+crypto_1[_0x2ac9b8(0x160)][_0x2ac9b8(0x148)](0x20)[_0x2ac9b8(0x14b)]('hex'),_0x44e235='sk_'+crypto_1[_0x2ac9b8(0x160)][_0x2ac9b8(0x148)](0x20)[_0x2ac9b8(0x14b)](_0x2ac9b8(0x14e));await database_1[_0x2ac9b8(0x160)]['shop'][_0x2ac9b8(0x13a)]({'where':{'id':_0x387153},'data':{'publicKey':_0x5c99ef,'secretKey':_0x44e235}});}async[a50_0x3462c8(0x122)](_0x238a13,_0x19c7ea){const _0x378557=a50_0x3462c8,{passwordConfirmation:_0x550754}=_0x19c7ea,_0x2ed270=await database_1['default'][_0x378557(0x15c)][_0x378557(0x124)]({'where':{'id':_0x238a13},'select':{'password':!![]}});if(!_0x2ed270)throw new Error(_0x378557(0x12c));const _0x45507b=await bcryptjs_1[_0x378557(0x160)][_0x378557(0x14f)](_0x550754,_0x2ed270[_0x378557(0x11d)]);if(!_0x45507b)throw new Error(_0x378557(0x14d));await database_1[_0x378557(0x160)][_0x378557(0x15c)]['delete']({'where':{'id':_0x238a13}});}async[a50_0x3462c8(0x127)](_0x46385f){const _0x4ac80b=a50_0x3462c8,_0x1379cd=await database_1[_0x4ac80b(0x160)][_0x4ac80b(0x142)][_0x4ac80b(0x124)]({'where':{'shopId':_0x46385f}});!_0x1379cd&&await database_1['default'][_0x4ac80b(0x142)][_0x4ac80b(0x146)]({'data':{'shopId':_0x46385f}});}}function a50_0x3232(_0x3a87a8,_0x547de8){const _0x50e1d1=a50_0x50e1();return a50_0x3232=function(_0x3232b9,_0xb778a1){_0x3232b9=_0x3232b9-0x11d;let _0xa42809=_0x50e1d1[_0x3232b9];return _0xa42809;},a50_0x3232(_0x3a87a8,_0x547de8);}function a50_0x50e1(){const _0x4941a=['shop','payout','updateWebhookSettings','length','default','password','5303420YdVFTv','botApiKey','telegramChatId','name','deleteAccount','maskApiKey','findUnique','crypto','59146kgChlY','ensureSettingsExist','6yVXBfH','8212320JcvjXN','payment_success','isArray','Shop\x20not\x20found','bcryptjs','hash','substring','__importDefault','webhookEvents','updateTelegramSettings','parse','repeat','telegramBotApiKey','notificationPaymentFailed','login','notificationPayout','4031650jEyvRZ','update','notificationApiError','__esModule','30893900JzvTPP','webhookUrl','telegram','refund','settings','shopSettings','string','8dRZmHn','chatId','create','notificationRefund','randomBytes','notificationLogin','pk_','toString','37qGNHHh','Password\x20confirmation\x20is\x20incorrect','hex','compare','9025832vRbWkh','SettingsService','api_error','parseWebhookEvents','getShopSettings','731703NvlMIf','notificationPaymentSuccess','updateNotifications','shopUrl','Current\x20password\x20is\x20incorrect','revokeAllApiKeys','max'];a50_0x50e1=function(){return _0x4941a;};return a50_0x50e1();}exports['SettingsService']=SettingsService;