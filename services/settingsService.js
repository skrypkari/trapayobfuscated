'use strict';function a51_0x4119(_0xe8e34a,_0x453d6f){const _0x37df28=a51_0x37df();return a51_0x4119=function(_0x411969,_0x2b9866){_0x411969=_0x411969-0x146;let _0x2b107b=_0x37df28[_0x411969];return _0x2b107b;},a51_0x4119(_0xe8e34a,_0x453d6f);}function a51_0x37df(){const _0x5a7755=['__esModule','1758772iiuvdx','Current\x20password\x20is\x20incorrect','notificationPayout','length','notificationApiError','4530530EzeEhZ','update','644dQQXQu','notificationPaymentSuccess','payment_success','default','botApiKey','hex','repeat','telegramChatId','password','api_error','maskApiKey','defineProperty','553686NegjPr','payout','bcryptjs','findUnique','parse','25WLLsDr','1053yllxza','Password\x20confirmation\x20is\x20incorrect','getShopSettings','max','randomBytes','compare','updateNotifications','telegramBotApiKey','shopSettings','refund','webhookUrl','158eglEMz','settings','create','24336RTQzza','shop','payment_failed','shopUrl','updateWebhookSettings','webhookEvents','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','hash','delete','notificationLogin','chatId','__importDefault','1529925IjVvmJ','../config/database','parseWebhookEvents','crypto','toString','login','notificationRefund','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','name','sk_','1622411PBRHKS','ensureSettingsExist','notificationPaymentFailed','pk_','Shop\x20not\x20found'];a51_0x37df=function(){return _0x5a7755;};return a51_0x37df();}const a51_0x53d56b=a51_0x4119;(function(_0x5a4136,_0x28df84){const _0x4cd24c=a51_0x4119,_0x51ace8=_0x5a4136();while(!![]){try{const _0x4aa710=-parseInt(_0x4cd24c(0x180))/0x1*(parseInt(_0x4cd24c(0x15a))/0x2)+parseInt(_0x4cd24c(0x169))/0x3+-parseInt(_0x4cd24c(0x179))/0x4+parseInt(_0x4cd24c(0x14e))/0x5*(parseInt(_0x4cd24c(0x149))/0x6)+-parseInt(_0x4cd24c(0x173))/0x7+parseInt(_0x4cd24c(0x15d))/0x8*(-parseInt(_0x4cd24c(0x14f))/0x9)+parseInt(_0x4cd24c(0x17e))/0xa;if(_0x4aa710===_0x28df84)break;else _0x51ace8['push'](_0x51ace8['shift']());}catch(_0x33e6e6){_0x51ace8['push'](_0x51ace8['shift']());}}}(a51_0x37df,0x54841));var __importDefault=this&&this[a51_0x53d56b(0x168)]||function(_0x28df5f){const _0x2338ae=a51_0x53d56b;return _0x28df5f&&_0x28df5f[_0x2338ae(0x178)]?_0x28df5f:{'default':_0x28df5f};};Object[a51_0x53d56b(0x148)](exports,a51_0x53d56b(0x178),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a51_0x53d56b(0x14b))),crypto_1=__importDefault(require(a51_0x53d56b(0x16c))),database_1=__importDefault(require(a51_0x53d56b(0x16a)));class SettingsService{[a51_0x53d56b(0x147)](_0x5ea621){const _0x532653=a51_0x53d56b;if(!_0x5ea621)return'';if(_0x5ea621[_0x532653(0x17c)]<=0x8)return _0x5ea621;const _0x59f41d=_0x5ea621['substring'](0x0,0x8),_0x1b92ff='*'[_0x532653(0x186)](Math[_0x532653(0x152)](0x0,_0x5ea621['length']-0x8));return _0x59f41d+_0x1b92ff;}['parseWebhookEvents'](_0x1d6ffb){const _0x48d448=a51_0x53d56b;if(!_0x1d6ffb)return[];if(Array['isArray'](_0x1d6ffb))return _0x1d6ffb;if(typeof _0x1d6ffb==='string')try{const _0x52fcb8=JSON[_0x48d448(0x14d)](_0x1d6ffb);return Array['isArray'](_0x52fcb8)?_0x52fcb8:[];}catch{return[];}return[];}async[a51_0x53d56b(0x151)](_0x222009){const _0x5d92ad=a51_0x53d56b,_0x81a2ef=await database_1[_0x5d92ad(0x183)][_0x5d92ad(0x15e)][_0x5d92ad(0x14c)]({'where':{'id':_0x222009},'include':{'settings':!![]}});if(!_0x81a2ef)throw new Error(_0x5d92ad(0x177));let _0x47cba9=_0x81a2ef[_0x5d92ad(0x15b)];return!_0x47cba9&&(_0x47cba9=await database_1[_0x5d92ad(0x183)][_0x5d92ad(0x157)][_0x5d92ad(0x15c)]({'data':{'shopId':_0x81a2ef['id']}})),{'fullName':_0x81a2ef[_0x5d92ad(0x171)],'brand':_0x81a2ef[_0x5d92ad(0x171)],'merchantUrl':_0x81a2ef[_0x5d92ad(0x160)],'telegramUsername':_0x81a2ef['telegram'],'telegramBotApiKey':_0x47cba9[_0x5d92ad(0x156)]?this['maskApiKey'](_0x47cba9[_0x5d92ad(0x156)]):null,'telegramChatId':_0x47cba9['telegramChatId'],'webhookUrl':_0x47cba9[_0x5d92ad(0x159)],'webhookEvents':this[_0x5d92ad(0x16b)](_0x47cba9[_0x5d92ad(0x162)]),'notifications':{'payment_success':_0x47cba9[_0x5d92ad(0x181)],'payment_failed':_0x47cba9[_0x5d92ad(0x175)],'refund':_0x47cba9[_0x5d92ad(0x16f)],'payout':_0x47cba9[_0x5d92ad(0x17b)],'login':_0x47cba9[_0x5d92ad(0x166)],'api_error':_0x47cba9['notificationApiError']}};}async['changePassword'](_0x461a7f,_0x566d3d){const _0x3be7a6=a51_0x53d56b,{currentPassword:_0x2333ee,newPassword:_0x238587,confirmNewPassword:_0x536fd8}=_0x566d3d;if(_0x238587!==_0x536fd8)throw new Error(_0x3be7a6(0x170));if(_0x238587[_0x3be7a6(0x17c)]<0x6)throw new Error(_0x3be7a6(0x163));const _0xea3a74=await database_1['default'][_0x3be7a6(0x15e)][_0x3be7a6(0x14c)]({'where':{'id':_0x461a7f},'select':{'password':!![]}});if(!_0xea3a74)throw new Error(_0x3be7a6(0x177));const _0x59de9e=await bcryptjs_1['default']['compare'](_0x2333ee,_0xea3a74[_0x3be7a6(0x188)]);if(!_0x59de9e)throw new Error(_0x3be7a6(0x17a));const _0x924d33=await bcryptjs_1[_0x3be7a6(0x183)][_0x3be7a6(0x164)](_0x238587,0xc);await database_1[_0x3be7a6(0x183)][_0x3be7a6(0x15e)][_0x3be7a6(0x17f)]({'where':{'id':_0x461a7f},'data':{'password':_0x924d33}});}async[a51_0x53d56b(0x155)](_0x1f08ce,_0x56a8ee){const _0x41568e=a51_0x53d56b;await this[_0x41568e(0x174)](_0x1f08ce);const _0x55f577={};_0x56a8ee[_0x41568e(0x182)]!==undefined&&(_0x55f577[_0x41568e(0x181)]=_0x56a8ee[_0x41568e(0x182)]),_0x56a8ee[_0x41568e(0x15f)]!==undefined&&(_0x55f577[_0x41568e(0x175)]=_0x56a8ee[_0x41568e(0x15f)]),_0x56a8ee[_0x41568e(0x158)]!==undefined&&(_0x55f577[_0x41568e(0x16f)]=_0x56a8ee[_0x41568e(0x158)]),_0x56a8ee[_0x41568e(0x14a)]!==undefined&&(_0x55f577['notificationPayout']=_0x56a8ee[_0x41568e(0x14a)]),_0x56a8ee[_0x41568e(0x16e)]!==undefined&&(_0x55f577[_0x41568e(0x166)]=_0x56a8ee[_0x41568e(0x16e)]),_0x56a8ee[_0x41568e(0x146)]!==undefined&&(_0x55f577[_0x41568e(0x17d)]=_0x56a8ee[_0x41568e(0x146)]),await database_1['default']['shopSettings'][_0x41568e(0x17f)]({'where':{'shopId':_0x1f08ce},'data':_0x55f577});}async['updateTelegramSettings'](_0x2b5b1b,_0x498bf0){const _0x3cf254=a51_0x53d56b;await this['ensureSettingsExist'](_0x2b5b1b);const _0x15d480={};_0x498bf0[_0x3cf254(0x184)]!==undefined&&(_0x15d480['telegramBotApiKey']=_0x498bf0[_0x3cf254(0x184)]||null),_0x498bf0['chatId']!==undefined&&(_0x15d480[_0x3cf254(0x187)]=_0x498bf0[_0x3cf254(0x167)]||null),await database_1[_0x3cf254(0x183)][_0x3cf254(0x157)][_0x3cf254(0x17f)]({'where':{'shopId':_0x2b5b1b},'data':_0x15d480});}async[a51_0x53d56b(0x161)](_0x2fcac8,_0x4a4ea8){const _0x1ab679=a51_0x53d56b;await this[_0x1ab679(0x174)](_0x2fcac8);const _0x56ab43={};_0x4a4ea8['webhookUrl']!==undefined&&(_0x56ab43['webhookUrl']=_0x4a4ea8[_0x1ab679(0x159)]||null),_0x4a4ea8[_0x1ab679(0x162)]!==undefined&&(_0x56ab43['webhookEvents']=_0x4a4ea8[_0x1ab679(0x162)]||[]),await database_1[_0x1ab679(0x183)][_0x1ab679(0x157)][_0x1ab679(0x17f)]({'where':{'shopId':_0x2fcac8},'data':_0x56ab43});}async['revokeAllApiKeys'](_0x1f2eae){const _0x5411b7=a51_0x53d56b,_0x446592=_0x5411b7(0x176)+crypto_1[_0x5411b7(0x183)][_0x5411b7(0x153)](0x20)[_0x5411b7(0x16d)]('hex'),_0x30e6b5=_0x5411b7(0x172)+crypto_1[_0x5411b7(0x183)][_0x5411b7(0x153)](0x20)['toString'](_0x5411b7(0x185));await database_1['default'][_0x5411b7(0x15e)]['update']({'where':{'id':_0x1f2eae},'data':{'publicKey':_0x446592,'secretKey':_0x30e6b5}});}async['deleteAccount'](_0x2e199e,_0x55f60a){const _0x346be9=a51_0x53d56b,{passwordConfirmation:_0x4f45dc}=_0x55f60a,_0x26f2b0=await database_1[_0x346be9(0x183)]['shop'][_0x346be9(0x14c)]({'where':{'id':_0x2e199e},'select':{'password':!![]}});if(!_0x26f2b0)throw new Error('Shop\x20not\x20found');const _0x1dc6c5=await bcryptjs_1[_0x346be9(0x183)][_0x346be9(0x154)](_0x4f45dc,_0x26f2b0['password']);if(!_0x1dc6c5)throw new Error(_0x346be9(0x150));await database_1[_0x346be9(0x183)][_0x346be9(0x15e)][_0x346be9(0x165)]({'where':{'id':_0x2e199e}});}async['ensureSettingsExist'](_0x2ed0ab){const _0x1f8159=a51_0x53d56b,_0x26c151=await database_1[_0x1f8159(0x183)][_0x1f8159(0x157)][_0x1f8159(0x14c)]({'where':{'shopId':_0x2ed0ab}});!_0x26c151&&await database_1[_0x1f8159(0x183)][_0x1f8159(0x157)][_0x1f8159(0x15c)]({'data':{'shopId':_0x2ed0ab}});}}exports['SettingsService']=SettingsService;