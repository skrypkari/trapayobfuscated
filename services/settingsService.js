'use strict';function a52_0x5154(){const _0x4bb9ab=['telegramBotApiKey','updateNotifications','deleteAccount','payout','notificationPaymentSuccess','37740lLyLek','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','203070khnpdL','telegramChatId','33fjvqpp','webhookUrl','payment_success','532777nJsJqo','parseWebhookEvents','update','sk_','webhookEvents','crypto','shop','1649925DyXres','bcryptjs','notificationRefund','Password\x20confirmation\x20is\x20incorrect','ensureSettingsExist','../config/database','login','length','chatId','botApiKey','notificationLogin','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','shopSettings','notificationApiError','getShopSettings','1240iJfWbs','2900004IBUAvI','revokeAllApiKeys','19551PqrLHz','password','repeat','parse','compare','refund','max','create','Current\x20password\x20is\x20incorrect','updateWebhookSettings','findUnique','Shop\x20not\x20found','pk_','SettingsService','name','api_error','51rnrKez','5mcDRYf','notificationPaymentFailed','randomBytes','1596552yQTMZD','shopUrl','delete','hex','default','isArray','maskApiKey','telegram'];a52_0x5154=function(){return _0x4bb9ab;};return a52_0x5154();}const a52_0x3d411d=a52_0x2f57;(function(_0x4eebb5,_0x46bf85){const _0x2d61c8=a52_0x2f57,_0x40ec38=_0x4eebb5();while(!![]){try{const _0x2ff351=-parseInt(_0x2d61c8(0x98))/0x1+-parseInt(_0x2d61c8(0x91))/0x2*(-parseInt(_0x2d61c8(0x80))/0x3)+parseInt(_0x2d61c8(0x84))/0x4+-parseInt(_0x2d61c8(0x81))/0x5*(-parseInt(_0x2d61c8(0xaf))/0x6)+-parseInt(_0x2d61c8(0xb1))/0x7*(parseInt(_0x2d61c8(0xae))/0x8)+parseInt(_0x2d61c8(0x9f))/0x9+parseInt(_0x2d61c8(0x93))/0xa*(-parseInt(_0x2d61c8(0x95))/0xb);if(_0x2ff351===_0x46bf85)break;else _0x40ec38['push'](_0x40ec38['shift']());}catch(_0x2bfbf0){_0x40ec38['push'](_0x40ec38['shift']());}}}(a52_0x5154,0x57e26));var __importDefault=this&&this['__importDefault']||function(_0x317f9b){return _0x317f9b&&_0x317f9b['__esModule']?_0x317f9b:{'default':_0x317f9b};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a52_0x3d411d(0x7d)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x3d411d(0xa0))),crypto_1=__importDefault(require(a52_0x3d411d(0x9d))),database_1=__importDefault(require(a52_0x3d411d(0xa4)));class SettingsService{['maskApiKey'](_0x15d406){const _0x1b55ed=a52_0x3d411d;if(!_0x15d406)return'';if(_0x15d406[_0x1b55ed(0xa6)]<=0x8)return _0x15d406;const _0x4cdd6d=_0x15d406['substring'](0x0,0x8),_0x3902b3='*'[_0x1b55ed(0xb3)](Math[_0x1b55ed(0xb7)](0x0,_0x15d406['length']-0x8));return _0x4cdd6d+_0x3902b3;}[a52_0x3d411d(0x99)](_0x164e8c){const _0x54c6d7=a52_0x3d411d;if(!_0x164e8c)return[];if(Array['isArray'](_0x164e8c))return _0x164e8c;if(typeof _0x164e8c==='string')try{const _0x4bef36=JSON[_0x54c6d7(0xb4)](_0x164e8c);return Array[_0x54c6d7(0x89)](_0x4bef36)?_0x4bef36:[];}catch{return[];}return[];}async[a52_0x3d411d(0xad)](_0xdc21b5){const _0x545198=a52_0x3d411d,_0x246dd0=await database_1[_0x545198(0x88)][_0x545198(0x9e)][_0x545198(0x7a)]({'where':{'id':_0xdc21b5},'include':{'settings':!![]}});if(!_0x246dd0)throw new Error(_0x545198(0x7b));let _0x132b4e=_0x246dd0['settings'];return!_0x132b4e&&(_0x132b4e=await database_1[_0x545198(0x88)][_0x545198(0xab)][_0x545198(0xb8)]({'data':{'shopId':_0x246dd0['id']}})),{'fullName':_0x246dd0[_0x545198(0x7e)],'brand':_0x246dd0[_0x545198(0x7e)],'merchantUrl':_0x246dd0[_0x545198(0x85)],'telegramUsername':_0x246dd0[_0x545198(0x8b)],'telegramBotApiKey':_0x132b4e['telegramBotApiKey']?this[_0x545198(0x8a)](_0x132b4e[_0x545198(0x8c)]):null,'telegramChatId':_0x132b4e[_0x545198(0x94)],'webhookUrl':_0x132b4e['webhookUrl'],'webhookEvents':this[_0x545198(0x99)](_0x132b4e[_0x545198(0x9c)]),'notifications':{'payment_success':_0x132b4e[_0x545198(0x90)],'payment_failed':_0x132b4e[_0x545198(0x82)],'refund':_0x132b4e[_0x545198(0xa1)],'payout':_0x132b4e['notificationPayout'],'login':_0x132b4e[_0x545198(0xa9)],'api_error':_0x132b4e['notificationApiError']}};}async['changePassword'](_0xd830a4,_0x42be0f){const _0x26e2ed=a52_0x3d411d,{currentPassword:_0x2fa759,newPassword:_0x18f2e7,confirmNewPassword:_0x185424}=_0x42be0f;if(_0x18f2e7!==_0x185424)throw new Error(_0x26e2ed(0x92));if(_0x18f2e7['length']<0x6)throw new Error(_0x26e2ed(0xaa));const _0x5c90e0=await database_1[_0x26e2ed(0x88)][_0x26e2ed(0x9e)]['findUnique']({'where':{'id':_0xd830a4},'select':{'password':!![]}});if(!_0x5c90e0)throw new Error(_0x26e2ed(0x7b));const _0x1e419b=await bcryptjs_1[_0x26e2ed(0x88)]['compare'](_0x2fa759,_0x5c90e0[_0x26e2ed(0xb2)]);if(!_0x1e419b)throw new Error(_0x26e2ed(0x78));const _0x31214b=await bcryptjs_1['default']['hash'](_0x18f2e7,0xc);await database_1[_0x26e2ed(0x88)]['shop'][_0x26e2ed(0x9a)]({'where':{'id':_0xd830a4},'data':{'password':_0x31214b}});}async[a52_0x3d411d(0x8d)](_0x5badf1,_0x4376f9){const _0x4b2bd2=a52_0x3d411d;await this['ensureSettingsExist'](_0x5badf1);const _0x2f9c8f={};_0x4376f9[_0x4b2bd2(0x97)]!==undefined&&(_0x2f9c8f[_0x4b2bd2(0x90)]=_0x4376f9[_0x4b2bd2(0x97)]),_0x4376f9['payment_failed']!==undefined&&(_0x2f9c8f[_0x4b2bd2(0x82)]=_0x4376f9['payment_failed']),_0x4376f9[_0x4b2bd2(0xb6)]!==undefined&&(_0x2f9c8f[_0x4b2bd2(0xa1)]=_0x4376f9[_0x4b2bd2(0xb6)]),_0x4376f9[_0x4b2bd2(0x8f)]!==undefined&&(_0x2f9c8f['notificationPayout']=_0x4376f9[_0x4b2bd2(0x8f)]),_0x4376f9[_0x4b2bd2(0xa5)]!==undefined&&(_0x2f9c8f[_0x4b2bd2(0xa9)]=_0x4376f9[_0x4b2bd2(0xa5)]),_0x4376f9['api_error']!==undefined&&(_0x2f9c8f[_0x4b2bd2(0xac)]=_0x4376f9[_0x4b2bd2(0x7f)]),await database_1[_0x4b2bd2(0x88)]['shopSettings'][_0x4b2bd2(0x9a)]({'where':{'shopId':_0x5badf1},'data':_0x2f9c8f});}async['updateTelegramSettings'](_0x347e88,_0x5428fc){const _0x18a43f=a52_0x3d411d;await this[_0x18a43f(0xa3)](_0x347e88);const _0x5a97f6={};_0x5428fc[_0x18a43f(0xa8)]!==undefined&&(_0x5a97f6[_0x18a43f(0x8c)]=_0x5428fc['botApiKey']||null),_0x5428fc['chatId']!==undefined&&(_0x5a97f6[_0x18a43f(0x94)]=_0x5428fc[_0x18a43f(0xa7)]||null),await database_1[_0x18a43f(0x88)][_0x18a43f(0xab)][_0x18a43f(0x9a)]({'where':{'shopId':_0x347e88},'data':_0x5a97f6});}async[a52_0x3d411d(0x79)](_0x21be96,_0x41069e){const _0x3ec615=a52_0x3d411d;await this['ensureSettingsExist'](_0x21be96);const _0x3b0c6c={};_0x41069e['webhookUrl']!==undefined&&(_0x3b0c6c[_0x3ec615(0x96)]=_0x41069e[_0x3ec615(0x96)]||null),_0x41069e['webhookEvents']!==undefined&&(_0x3b0c6c['webhookEvents']=_0x41069e['webhookEvents']||[]),await database_1[_0x3ec615(0x88)][_0x3ec615(0xab)][_0x3ec615(0x9a)]({'where':{'shopId':_0x21be96},'data':_0x3b0c6c});}async[a52_0x3d411d(0xb0)](_0x3e9410){const _0x1e6798=a52_0x3d411d,_0x2a3af3=_0x1e6798(0x7c)+crypto_1[_0x1e6798(0x88)][_0x1e6798(0x83)](0x20)['toString']('hex'),_0x2a94b7=_0x1e6798(0x9b)+crypto_1['default'][_0x1e6798(0x83)](0x20)['toString'](_0x1e6798(0x87));await database_1[_0x1e6798(0x88)][_0x1e6798(0x9e)][_0x1e6798(0x9a)]({'where':{'id':_0x3e9410},'data':{'publicKey':_0x2a3af3,'secretKey':_0x2a94b7}});}async[a52_0x3d411d(0x8e)](_0x58bb9d,_0x5dfdc0){const _0x5d8970=a52_0x3d411d,{passwordConfirmation:_0x5f40f1}=_0x5dfdc0,_0x1a894c=await database_1[_0x5d8970(0x88)]['shop'][_0x5d8970(0x7a)]({'where':{'id':_0x58bb9d},'select':{'password':!![]}});if(!_0x1a894c)throw new Error(_0x5d8970(0x7b));const _0x13254d=await bcryptjs_1['default'][_0x5d8970(0xb5)](_0x5f40f1,_0x1a894c[_0x5d8970(0xb2)]);if(!_0x13254d)throw new Error(_0x5d8970(0xa2));await database_1[_0x5d8970(0x88)][_0x5d8970(0x9e)][_0x5d8970(0x86)]({'where':{'id':_0x58bb9d}});}async[a52_0x3d411d(0xa3)](_0x161a75){const _0x4a7244=a52_0x3d411d,_0x17a8d5=await database_1[_0x4a7244(0x88)][_0x4a7244(0xab)]['findUnique']({'where':{'shopId':_0x161a75}});!_0x17a8d5&&await database_1['default'][_0x4a7244(0xab)][_0x4a7244(0xb8)]({'data':{'shopId':_0x161a75}});}}function a52_0x2f57(_0x426ae7,_0x48491f){const _0x515454=a52_0x5154();return a52_0x2f57=function(_0x2f5730,_0x2f0ee5){_0x2f5730=_0x2f5730-0x78;let _0x4697c0=_0x515454[_0x2f5730];return _0x4697c0;},a52_0x2f57(_0x426ae7,_0x48491f);}exports['SettingsService']=SettingsService;