'use strict';function a52_0x45a4(_0x450164,_0x3ca4f6){const _0x1cd481=a52_0x1cd4();return a52_0x45a4=function(_0x45a496,_0x443b84){_0x45a496=_0x45a496-0x1e6;let _0x522a5e=_0x1cd481[_0x45a496];return _0x522a5e;},a52_0x45a4(_0x450164,_0x3ca4f6);}const a52_0x3db4a5=a52_0x45a4;function a52_0x1cd4(){const _0x1c43c1=['getShopSettings','chatId','notificationPaymentSuccess','shopSettings','payout','updateTelegramSettings','__esModule','toString','delete','10tmaksW','parseWebhookEvents','1456688ExJNKR','repeat','notificationPaymentFailed','changePassword','crypto','botApiKey','2481NhVDrk','maskApiKey','telegramChatId','updateNotifications','api_error','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','webhookEvents','length','telegram','payment_failed','shop','refund','3265ritIlW','webhookUrl','4842PbgqOZ','create','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','payment_success','compare','updateWebhookSettings','notificationRefund','SettingsService','notificationPayout','update','19272NkYrBc','findUnique','name','max','login','7628NZKkyY','shopUrl','2038yzjafI','telegramBotApiKey','default','settings','pk_','defineProperty','notificationLogin','Shop\x20not\x20found','substring','3697950FYhEBM','3662197QozTRJ','ensureSettingsExist','revokeAllApiKeys','parse','isArray','randomBytes','8569533iHQBNh','hex','notificationApiError','password'];a52_0x1cd4=function(){return _0x1c43c1;};return a52_0x1cd4();}(function(_0x1bcc20,_0x5e8a19){const _0x310aeb=a52_0x45a4,_0x29c909=_0x1bcc20();while(!![]){try{const _0x126abf=parseInt(_0x310aeb(0x1fc))/0x1+-parseInt(_0x310aeb(0x221))/0x2*(-parseInt(_0x310aeb(0x202))/0x3)+-parseInt(_0x310aeb(0x21f))/0x4*(parseInt(_0x310aeb(0x20e))/0x5)+-parseInt(_0x310aeb(0x1e6))/0x6+-parseInt(_0x310aeb(0x1ed))/0x7+-parseInt(_0x310aeb(0x21a))/0x8*(-parseInt(_0x310aeb(0x210))/0x9)+parseInt(_0x310aeb(0x1fa))/0xa*(parseInt(_0x310aeb(0x1e7))/0xb);if(_0x126abf===_0x5e8a19)break;else _0x29c909['push'](_0x29c909['shift']());}catch(_0x14aa4f){_0x29c909['push'](_0x29c909['shift']());}}}(a52_0x1cd4,0xcdb3b));var __importDefault=this&&this['__importDefault']||function(_0x4a4276){return _0x4a4276&&_0x4a4276['__esModule']?_0x4a4276:{'default':_0x4a4276};};Object[a52_0x3db4a5(0x226)](exports,a52_0x3db4a5(0x1f7),{'value':!![]}),exports[a52_0x3db4a5(0x217)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a52_0x3db4a5(0x200))),database_1=__importDefault(require('../config/database'));class SettingsService{['maskApiKey'](_0x25ebe7){const _0x113274=a52_0x3db4a5;if(!_0x25ebe7)return'';if(_0x25ebe7[_0x113274(0x209)]<=0x8)return _0x25ebe7;const _0x322b9b=_0x25ebe7[_0x113274(0x229)](0x0,0x8),_0x2193a3='*'[_0x113274(0x1fd)](Math[_0x113274(0x21d)](0x0,_0x25ebe7['length']-0x8));return _0x322b9b+_0x2193a3;}[a52_0x3db4a5(0x1fb)](_0x2c0283){const _0x358cae=a52_0x3db4a5;if(!_0x2c0283)return[];if(Array[_0x358cae(0x1eb)](_0x2c0283))return _0x2c0283;if(typeof _0x2c0283==='string')try{const _0x5a0f55=JSON[_0x358cae(0x1ea)](_0x2c0283);return Array[_0x358cae(0x1eb)](_0x5a0f55)?_0x5a0f55:[];}catch{return[];}return[];}async[a52_0x3db4a5(0x1f1)](_0x572c17){const _0x3a4cd4=a52_0x3db4a5,_0x10173a=await database_1[_0x3a4cd4(0x223)][_0x3a4cd4(0x20c)]['findUnique']({'where':{'id':_0x572c17},'include':{'settings':!![]}});if(!_0x10173a)throw new Error(_0x3a4cd4(0x228));let _0x56e83f=_0x10173a[_0x3a4cd4(0x224)];return!_0x56e83f&&(_0x56e83f=await database_1[_0x3a4cd4(0x223)][_0x3a4cd4(0x1f4)][_0x3a4cd4(0x211)]({'data':{'shopId':_0x10173a['id']}})),{'fullName':_0x10173a[_0x3a4cd4(0x21c)],'brand':_0x10173a[_0x3a4cd4(0x21c)],'merchantUrl':_0x10173a[_0x3a4cd4(0x220)],'telegramUsername':_0x10173a[_0x3a4cd4(0x20a)],'telegramBotApiKey':_0x56e83f['telegramBotApiKey']?this[_0x3a4cd4(0x203)](_0x56e83f['telegramBotApiKey']):null,'telegramChatId':_0x56e83f[_0x3a4cd4(0x204)],'webhookUrl':_0x56e83f['webhookUrl'],'webhookEvents':this[_0x3a4cd4(0x1fb)](_0x56e83f[_0x3a4cd4(0x208)]),'notifications':{'payment_success':_0x56e83f[_0x3a4cd4(0x1f3)],'payment_failed':_0x56e83f[_0x3a4cd4(0x1fe)],'refund':_0x56e83f['notificationRefund'],'payout':_0x56e83f['notificationPayout'],'login':_0x56e83f['notificationLogin'],'api_error':_0x56e83f[_0x3a4cd4(0x1ef)]}};}async[a52_0x3db4a5(0x1ff)](_0x4243a4,_0x9866ce){const _0x1c31fe=a52_0x3db4a5,{currentPassword:_0x2d2b55,newPassword:_0xeaa815,confirmNewPassword:_0x1364f0}=_0x9866ce;if(_0xeaa815!==_0x1364f0)throw new Error(_0x1c31fe(0x207));if(_0xeaa815[_0x1c31fe(0x209)]<0x6)throw new Error(_0x1c31fe(0x212));const _0x4bcf7e=await database_1[_0x1c31fe(0x223)][_0x1c31fe(0x20c)]['findUnique']({'where':{'id':_0x4243a4},'select':{'password':!![]}});if(!_0x4bcf7e)throw new Error(_0x1c31fe(0x228));const _0x18e56e=await bcryptjs_1[_0x1c31fe(0x223)][_0x1c31fe(0x214)](_0x2d2b55,_0x4bcf7e[_0x1c31fe(0x1f0)]);if(!_0x18e56e)throw new Error('Current\x20password\x20is\x20incorrect');const _0x4c4797=await bcryptjs_1[_0x1c31fe(0x223)]['hash'](_0xeaa815,0xc);await database_1[_0x1c31fe(0x223)]['shop'][_0x1c31fe(0x219)]({'where':{'id':_0x4243a4},'data':{'password':_0x4c4797}});}async[a52_0x3db4a5(0x205)](_0x5863b3,_0x5c8af8){const _0x4e22ab=a52_0x3db4a5;await this['ensureSettingsExist'](_0x5863b3);const _0x2c432c={};_0x5c8af8[_0x4e22ab(0x213)]!==undefined&&(_0x2c432c[_0x4e22ab(0x1f3)]=_0x5c8af8['payment_success']),_0x5c8af8[_0x4e22ab(0x20b)]!==undefined&&(_0x2c432c['notificationPaymentFailed']=_0x5c8af8[_0x4e22ab(0x20b)]),_0x5c8af8['refund']!==undefined&&(_0x2c432c[_0x4e22ab(0x216)]=_0x5c8af8[_0x4e22ab(0x20d)]),_0x5c8af8[_0x4e22ab(0x1f5)]!==undefined&&(_0x2c432c[_0x4e22ab(0x218)]=_0x5c8af8[_0x4e22ab(0x1f5)]),_0x5c8af8['login']!==undefined&&(_0x2c432c[_0x4e22ab(0x227)]=_0x5c8af8[_0x4e22ab(0x21e)]),_0x5c8af8[_0x4e22ab(0x206)]!==undefined&&(_0x2c432c[_0x4e22ab(0x1ef)]=_0x5c8af8[_0x4e22ab(0x206)]),await database_1[_0x4e22ab(0x223)][_0x4e22ab(0x1f4)][_0x4e22ab(0x219)]({'where':{'shopId':_0x5863b3},'data':_0x2c432c});}async[a52_0x3db4a5(0x1f6)](_0x2e7b32,_0x565ff4){const _0x29679d=a52_0x3db4a5;await this[_0x29679d(0x1e8)](_0x2e7b32);const _0x61bd03={};_0x565ff4[_0x29679d(0x201)]!==undefined&&(_0x61bd03[_0x29679d(0x222)]=_0x565ff4[_0x29679d(0x201)]||null),_0x565ff4[_0x29679d(0x1f2)]!==undefined&&(_0x61bd03[_0x29679d(0x204)]=_0x565ff4[_0x29679d(0x1f2)]||null),await database_1[_0x29679d(0x223)][_0x29679d(0x1f4)][_0x29679d(0x219)]({'where':{'shopId':_0x2e7b32},'data':_0x61bd03});}async[a52_0x3db4a5(0x215)](_0x47bd88,_0x51c1fd){const _0x1fdb9b=a52_0x3db4a5;await this[_0x1fdb9b(0x1e8)](_0x47bd88);const _0x580013={};_0x51c1fd[_0x1fdb9b(0x20f)]!==undefined&&(_0x580013['webhookUrl']=_0x51c1fd[_0x1fdb9b(0x20f)]||null),_0x51c1fd['webhookEvents']!==undefined&&(_0x580013[_0x1fdb9b(0x208)]=_0x51c1fd['webhookEvents']||[]),await database_1['default'][_0x1fdb9b(0x1f4)][_0x1fdb9b(0x219)]({'where':{'shopId':_0x47bd88},'data':_0x580013});}async[a52_0x3db4a5(0x1e9)](_0xb0a394){const _0x1008c0=a52_0x3db4a5,_0x1307fb=_0x1008c0(0x225)+crypto_1['default'][_0x1008c0(0x1ec)](0x20)[_0x1008c0(0x1f8)](_0x1008c0(0x1ee)),_0x1baf3d='sk_'+crypto_1['default'][_0x1008c0(0x1ec)](0x20)[_0x1008c0(0x1f8)]('hex');await database_1[_0x1008c0(0x223)][_0x1008c0(0x20c)]['update']({'where':{'id':_0xb0a394},'data':{'publicKey':_0x1307fb,'secretKey':_0x1baf3d}});}async['deleteAccount'](_0x264532,_0x355c8e){const _0x48e7b1=a52_0x3db4a5,{passwordConfirmation:_0xc2e39c}=_0x355c8e,_0x197690=await database_1[_0x48e7b1(0x223)][_0x48e7b1(0x20c)][_0x48e7b1(0x21b)]({'where':{'id':_0x264532},'select':{'password':!![]}});if(!_0x197690)throw new Error(_0x48e7b1(0x228));const _0x17d0cb=await bcryptjs_1[_0x48e7b1(0x223)]['compare'](_0xc2e39c,_0x197690[_0x48e7b1(0x1f0)]);if(!_0x17d0cb)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1['default'][_0x48e7b1(0x20c)][_0x48e7b1(0x1f9)]({'where':{'id':_0x264532}});}async[a52_0x3db4a5(0x1e8)](_0x49c43d){const _0x1b2916=a52_0x3db4a5,_0x57bf96=await database_1[_0x1b2916(0x223)][_0x1b2916(0x1f4)]['findUnique']({'where':{'shopId':_0x49c43d}});!_0x57bf96&&await database_1[_0x1b2916(0x223)][_0x1b2916(0x1f4)][_0x1b2916(0x211)]({'data':{'shopId':_0x49c43d}});}}exports[a52_0x3db4a5(0x217)]=SettingsService;