'use strict';function a46_0x538e(_0x717d17,_0x15cf55){const _0x4cfa8d=a46_0x4cfa();return a46_0x538e=function(_0x538e0d,_0x203995){_0x538e0d=_0x538e0d-0x107;let _0x309877=_0x4cfa8d[_0x538e0d];return _0x309877;},a46_0x538e(_0x717d17,_0x15cf55);}const a46_0x55774c=a46_0x538e;(function(_0xc283c2,_0x190bd7){const _0x68d24=a46_0x538e,_0x3b750c=_0xc283c2();while(!![]){try{const _0x4f3372=parseInt(_0x68d24(0x149))/0x1*(-parseInt(_0x68d24(0x137))/0x2)+-parseInt(_0x68d24(0x136))/0x3+-parseInt(_0x68d24(0x14a))/0x4+-parseInt(_0x68d24(0x11e))/0x5+parseInt(_0x68d24(0x116))/0x6+-parseInt(_0x68d24(0x130))/0x7*(parseInt(_0x68d24(0x10d))/0x8)+-parseInt(_0x68d24(0x128))/0x9*(-parseInt(_0x68d24(0x129))/0xa);if(_0x4f3372===_0x190bd7)break;else _0x3b750c['push'](_0x3b750c['shift']());}catch(_0x25d6b8){_0x3b750c['push'](_0x3b750c['shift']());}}}(a46_0x4cfa,0x7fed5));function a46_0x4cfa(){const _0x2aa719=['maskApiKey','botApiKey','18272mBnuIq','parseWebhookEvents','webhookUrl','findUnique','webhookEvents','bcryptjs','notificationPayout','payout','name','3518322RoXuJq','updateWebhookSettings','notificationRefund','delete','crypto','hash','updateNotifications','hex','3585355QpUmtH','shop','login','notificationPaymentFailed','update','create','isArray','__esModule','telegramChatId','revokeAllApiKeys','1791gpAvTd','152610ycHEno','shopUrl','Shop\x20not\x20found','notificationApiError','length','settings','max','1379izIWDr','Password\x20confirmation\x20is\x20incorrect','string','payment_failed','chatId','repeat','1863210UDmhNA','22252ZfJtIN','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','api_error','toString','shopSettings','notificationLogin','default','telegram','ensureSettingsExist','payment_success','../config/database','Current\x20password\x20is\x20incorrect','compare','telegramBotApiKey','SettingsService','notificationPaymentSuccess','deleteAccount','password','87vVrKRE','1373144MNPtbY','pk_','__importDefault','changePassword','getShopSettings','New\x20password\x20and\x20confirmation\x20do\x20not\x20match'];a46_0x4cfa=function(){return _0x2aa719;};return a46_0x4cfa();}var __importDefault=this&&this[a46_0x55774c(0x107)]||function(_0x49da69){const _0x3711f4=a46_0x55774c;return _0x49da69&&_0x49da69[_0x3711f4(0x125)]?_0x49da69:{'default':_0x49da69};};Object['defineProperty'](exports,a46_0x55774c(0x125),{'value':!![]}),exports[a46_0x55774c(0x145)]=void 0x0;const bcryptjs_1=__importDefault(require(a46_0x55774c(0x112))),crypto_1=__importDefault(require(a46_0x55774c(0x11a))),database_1=__importDefault(require(a46_0x55774c(0x141)));class SettingsService{[a46_0x55774c(0x10b)](_0x5a02f0){const _0x14b2aa=a46_0x55774c;if(!_0x5a02f0)return'';if(_0x5a02f0[_0x14b2aa(0x12d)]<=0x8)return _0x5a02f0;const _0x144073=_0x5a02f0['substring'](0x0,0x8),_0x5a7e5d='*'[_0x14b2aa(0x135)](Math[_0x14b2aa(0x12f)](0x0,_0x5a02f0['length']-0x8));return _0x144073+_0x5a7e5d;}[a46_0x55774c(0x10e)](_0x26c835){const _0x230aa2=a46_0x55774c;if(!_0x26c835)return[];if(Array[_0x230aa2(0x124)](_0x26c835))return _0x26c835;if(typeof _0x26c835===_0x230aa2(0x132))try{const _0x5005e4=JSON['parse'](_0x26c835);return Array[_0x230aa2(0x124)](_0x5005e4)?_0x5005e4:[];}catch{return[];}return[];}async[a46_0x55774c(0x109)](_0x42c8b8){const _0x32929d=a46_0x55774c,_0x4afe46=await database_1['default'][_0x32929d(0x11f)][_0x32929d(0x110)]({'where':{'id':_0x42c8b8},'include':{'settings':!![]}});if(!_0x4afe46)throw new Error('Shop\x20not\x20found');let _0x4f4e07=_0x4afe46[_0x32929d(0x12e)];return!_0x4f4e07&&(_0x4f4e07=await database_1[_0x32929d(0x13d)]['shopSettings'][_0x32929d(0x123)]({'data':{'shopId':_0x4afe46['id']}})),{'fullName':_0x4afe46['name'],'brand':_0x4afe46[_0x32929d(0x115)],'merchantUrl':_0x4afe46[_0x32929d(0x12a)],'telegramUsername':_0x4afe46[_0x32929d(0x13e)],'telegramBotApiKey':_0x4f4e07[_0x32929d(0x144)]?this[_0x32929d(0x10b)](_0x4f4e07['telegramBotApiKey']):null,'telegramChatId':_0x4f4e07[_0x32929d(0x126)],'webhookUrl':_0x4f4e07[_0x32929d(0x10f)],'webhookEvents':this[_0x32929d(0x10e)](_0x4f4e07[_0x32929d(0x111)]),'notifications':{'payment_success':_0x4f4e07[_0x32929d(0x146)],'payment_failed':_0x4f4e07['notificationPaymentFailed'],'refund':_0x4f4e07[_0x32929d(0x118)],'payout':_0x4f4e07[_0x32929d(0x113)],'login':_0x4f4e07['notificationLogin'],'api_error':_0x4f4e07[_0x32929d(0x12c)]}};}async[a46_0x55774c(0x108)](_0x364c71,_0x246b3a){const _0x2c64fc=a46_0x55774c,{currentPassword:_0x41cab8,newPassword:_0x2152d0,confirmNewPassword:_0x3dad70}=_0x246b3a;if(_0x2152d0!==_0x3dad70)throw new Error(_0x2c64fc(0x10a));if(_0x2152d0[_0x2c64fc(0x12d)]<0x6)throw new Error(_0x2c64fc(0x138));const _0x1fdb5a=await database_1['default'][_0x2c64fc(0x11f)][_0x2c64fc(0x110)]({'where':{'id':_0x364c71},'select':{'password':!![]}});if(!_0x1fdb5a)throw new Error(_0x2c64fc(0x12b));const _0x20bcc6=await bcryptjs_1[_0x2c64fc(0x13d)]['compare'](_0x41cab8,_0x1fdb5a[_0x2c64fc(0x148)]);if(!_0x20bcc6)throw new Error(_0x2c64fc(0x142));const _0x4c4aff=await bcryptjs_1[_0x2c64fc(0x13d)][_0x2c64fc(0x11b)](_0x2152d0,0xc);await database_1['default'][_0x2c64fc(0x11f)][_0x2c64fc(0x122)]({'where':{'id':_0x364c71},'data':{'password':_0x4c4aff}});}async[a46_0x55774c(0x11c)](_0x158e60,_0x56894b){const _0x2106a6=a46_0x55774c;await this[_0x2106a6(0x13f)](_0x158e60);const _0x2270de={};_0x56894b[_0x2106a6(0x140)]!==undefined&&(_0x2270de[_0x2106a6(0x146)]=_0x56894b[_0x2106a6(0x140)]),_0x56894b[_0x2106a6(0x133)]!==undefined&&(_0x2270de[_0x2106a6(0x121)]=_0x56894b[_0x2106a6(0x133)]),_0x56894b['refund']!==undefined&&(_0x2270de[_0x2106a6(0x118)]=_0x56894b['refund']),_0x56894b[_0x2106a6(0x114)]!==undefined&&(_0x2270de[_0x2106a6(0x113)]=_0x56894b[_0x2106a6(0x114)]),_0x56894b[_0x2106a6(0x120)]!==undefined&&(_0x2270de[_0x2106a6(0x13c)]=_0x56894b[_0x2106a6(0x120)]),_0x56894b[_0x2106a6(0x139)]!==undefined&&(_0x2270de[_0x2106a6(0x12c)]=_0x56894b[_0x2106a6(0x139)]),await database_1[_0x2106a6(0x13d)][_0x2106a6(0x13b)][_0x2106a6(0x122)]({'where':{'shopId':_0x158e60},'data':_0x2270de});}async['updateTelegramSettings'](_0x43435f,_0x3473d9){const _0xe9a8be=a46_0x55774c;await this[_0xe9a8be(0x13f)](_0x43435f);const _0x3c31b5={};_0x3473d9[_0xe9a8be(0x10c)]!==undefined&&(_0x3c31b5[_0xe9a8be(0x144)]=_0x3473d9[_0xe9a8be(0x10c)]||null),_0x3473d9[_0xe9a8be(0x134)]!==undefined&&(_0x3c31b5[_0xe9a8be(0x126)]=_0x3473d9[_0xe9a8be(0x134)]||null),await database_1['default'][_0xe9a8be(0x13b)][_0xe9a8be(0x122)]({'where':{'shopId':_0x43435f},'data':_0x3c31b5});}async[a46_0x55774c(0x117)](_0x1216c4,_0x1703d7){const _0x191029=a46_0x55774c;await this[_0x191029(0x13f)](_0x1216c4);const _0x1fe482={};_0x1703d7[_0x191029(0x10f)]!==undefined&&(_0x1fe482[_0x191029(0x10f)]=_0x1703d7[_0x191029(0x10f)]||null),_0x1703d7[_0x191029(0x111)]!==undefined&&(_0x1fe482[_0x191029(0x111)]=_0x1703d7[_0x191029(0x111)]||[]),await database_1[_0x191029(0x13d)][_0x191029(0x13b)][_0x191029(0x122)]({'where':{'shopId':_0x1216c4},'data':_0x1fe482});}async[a46_0x55774c(0x127)](_0x1bceeb){const _0x286974=a46_0x55774c,_0x4f4792=_0x286974(0x14b)+crypto_1[_0x286974(0x13d)]['randomBytes'](0x20)[_0x286974(0x13a)](_0x286974(0x11d)),_0x1b1dc0='sk_'+crypto_1[_0x286974(0x13d)]['randomBytes'](0x20)[_0x286974(0x13a)](_0x286974(0x11d));await database_1[_0x286974(0x13d)][_0x286974(0x11f)][_0x286974(0x122)]({'where':{'id':_0x1bceeb},'data':{'publicKey':_0x4f4792,'secretKey':_0x1b1dc0}});}async[a46_0x55774c(0x147)](_0x2dd2fc,_0x3dfe44){const _0x2f37f8=a46_0x55774c,{passwordConfirmation:_0x3a82a1}=_0x3dfe44,_0x48cbfc=await database_1['default'][_0x2f37f8(0x11f)][_0x2f37f8(0x110)]({'where':{'id':_0x2dd2fc},'select':{'password':!![]}});if(!_0x48cbfc)throw new Error(_0x2f37f8(0x12b));const _0x33c14e=await bcryptjs_1[_0x2f37f8(0x13d)][_0x2f37f8(0x143)](_0x3a82a1,_0x48cbfc[_0x2f37f8(0x148)]);if(!_0x33c14e)throw new Error(_0x2f37f8(0x131));await database_1['default'][_0x2f37f8(0x11f)][_0x2f37f8(0x119)]({'where':{'id':_0x2dd2fc}});}async[a46_0x55774c(0x13f)](_0x260800){const _0x175608=a46_0x55774c,_0x354ddc=await database_1[_0x175608(0x13d)][_0x175608(0x13b)][_0x175608(0x110)]({'where':{'shopId':_0x260800}});!_0x354ddc&&await database_1[_0x175608(0x13d)][_0x175608(0x13b)][_0x175608(0x123)]({'data':{'shopId':_0x260800}});}}exports['SettingsService']=SettingsService;