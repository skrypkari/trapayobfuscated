'use strict';const a55_0x491e70=a55_0xfec0;(function(_0x2c6bcf,_0x3316be){const _0x579b5b=a55_0xfec0,_0x1cfc0b=_0x2c6bcf();while(!![]){try{const _0x4c9cf5=-parseInt(_0x579b5b(0x134))/0x1+parseInt(_0x579b5b(0xfc))/0x2+parseInt(_0x579b5b(0x11a))/0x3+-parseInt(_0x579b5b(0x117))/0x4+parseInt(_0x579b5b(0x115))/0x5*(-parseInt(_0x579b5b(0x126))/0x6)+-parseInt(_0x579b5b(0x123))/0x7+-parseInt(_0x579b5b(0x124))/0x8*(-parseInt(_0x579b5b(0x119))/0x9);if(_0x4c9cf5===_0x3316be)break;else _0x1cfc0b['push'](_0x1cfc0b['shift']());}catch(_0x5280fe){_0x1cfc0b['push'](_0x1cfc0b['shift']());}}}(a55_0x5360,0x6ccfc));var __importDefault=this&&this[a55_0x491e70(0x11c)]||function(_0x2b48ee){const _0x409bea=a55_0x491e70;return _0x2b48ee&&_0x2b48ee[_0x409bea(0x10f)]?_0x2b48ee:{'default':_0x2b48ee};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a55_0x491e70(0x12c)]=void 0x0;function a55_0xfec0(_0x5c05e6,_0x558c32){const _0x536075=a55_0x5360();return a55_0xfec0=function(_0xfec0cb,_0x486966){_0xfec0cb=_0xfec0cb-0xfc;let _0x3ddf7e=_0x536075[_0xfec0cb];return _0x3ddf7e;},a55_0xfec0(_0x5c05e6,_0x558c32);}const bcryptjs_1=__importDefault(require(a55_0x491e70(0x12f))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a55_0x491e70(0x12a)));class SettingsService{[a55_0x491e70(0x108)](_0x3035d3){const _0x2ec78=a55_0x491e70;if(!_0x3035d3)return'';if(_0x3035d3['length']<=0x8)return _0x3035d3;const _0x25a047=_0x3035d3[_0x2ec78(0x12d)](0x0,0x8),_0x52b904='*'[_0x2ec78(0x11d)](Math['max'](0x0,_0x3035d3[_0x2ec78(0x137)]-0x8));return _0x25a047+_0x52b904;}[a55_0x491e70(0x131)](_0x1b9316){const _0x2fcf1f=a55_0x491e70;if(!_0x1b9316)return[];if(Array[_0x2fcf1f(0x10e)](_0x1b9316))return _0x1b9316;if(typeof _0x1b9316==='string')try{const _0x4d237f=JSON[_0x2fcf1f(0x105)](_0x1b9316);return Array[_0x2fcf1f(0x10e)](_0x4d237f)?_0x4d237f:[];}catch{return[];}return[];}async[a55_0x491e70(0x103)](_0x16319c){const _0x4a7298=a55_0x491e70,_0x1a3b7c=await database_1[_0x4a7298(0x12e)][_0x4a7298(0x101)][_0x4a7298(0x138)]({'where':{'id':_0x16319c},'include':{'settings':!![]}});if(!_0x1a3b7c)throw new Error(_0x4a7298(0x136));let _0x193a43=_0x1a3b7c[_0x4a7298(0x11f)];return!_0x193a43&&(_0x193a43=await database_1[_0x4a7298(0x12e)][_0x4a7298(0x112)][_0x4a7298(0x107)]({'data':{'shopId':_0x1a3b7c['id']}})),{'fullName':_0x1a3b7c[_0x4a7298(0x139)],'brand':_0x1a3b7c[_0x4a7298(0x139)],'merchantUrl':_0x1a3b7c[_0x4a7298(0x111)],'telegramUsername':_0x1a3b7c[_0x4a7298(0x100)],'telegramBotApiKey':_0x193a43[_0x4a7298(0x13a)]?this[_0x4a7298(0x108)](_0x193a43[_0x4a7298(0x13a)]):null,'telegramChatId':_0x193a43[_0x4a7298(0xfd)],'webhookUrl':_0x193a43[_0x4a7298(0x128)],'webhookEvents':this[_0x4a7298(0x131)](_0x193a43[_0x4a7298(0x106)]),'notifications':{'payment_success':_0x193a43[_0x4a7298(0x129)],'payment_failed':_0x193a43['notificationPaymentFailed'],'refund':_0x193a43[_0x4a7298(0x10a)],'payout':_0x193a43['notificationPayout'],'login':_0x193a43[_0x4a7298(0x122)],'api_error':_0x193a43[_0x4a7298(0xfe)]}};}async['changePassword'](_0x3f7012,_0x293dd0){const _0x13c243=a55_0x491e70,{currentPassword:_0x27602d,newPassword:_0xa7b2c7,confirmNewPassword:_0x2b8099}=_0x293dd0;if(_0xa7b2c7!==_0x2b8099)throw new Error(_0x13c243(0x120));if(_0xa7b2c7[_0x13c243(0x137)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0xdc417a=await database_1[_0x13c243(0x12e)][_0x13c243(0x101)]['findUnique']({'where':{'id':_0x3f7012},'select':{'password':!![]}});if(!_0xdc417a)throw new Error(_0x13c243(0x136));const _0x47d1f8=await bcryptjs_1[_0x13c243(0x12e)][_0x13c243(0x104)](_0x27602d,_0xdc417a['password']);if(!_0x47d1f8)throw new Error('Current\x20password\x20is\x20incorrect');const _0x285226=await bcryptjs_1[_0x13c243(0x12e)][_0x13c243(0x125)](_0xa7b2c7,0xc);await database_1[_0x13c243(0x12e)][_0x13c243(0x101)][_0x13c243(0x10c)]({'where':{'id':_0x3f7012},'data':{'password':_0x285226}});}async['updateNotifications'](_0x250efe,_0x22420f){const _0xd67f92=a55_0x491e70;await this[_0xd67f92(0x10b)](_0x250efe);const _0x2d2a35={};_0x22420f[_0xd67f92(0x113)]!==undefined&&(_0x2d2a35[_0xd67f92(0x129)]=_0x22420f[_0xd67f92(0x113)]),_0x22420f['payment_failed']!==undefined&&(_0x2d2a35[_0xd67f92(0x133)]=_0x22420f['payment_failed']),_0x22420f[_0xd67f92(0x102)]!==undefined&&(_0x2d2a35[_0xd67f92(0x10a)]=_0x22420f[_0xd67f92(0x102)]),_0x22420f['payout']!==undefined&&(_0x2d2a35[_0xd67f92(0xff)]=_0x22420f[_0xd67f92(0x127)]),_0x22420f['login']!==undefined&&(_0x2d2a35['notificationLogin']=_0x22420f['login']),_0x22420f['api_error']!==undefined&&(_0x2d2a35[_0xd67f92(0xfe)]=_0x22420f[_0xd67f92(0x11b)]),await database_1[_0xd67f92(0x12e)][_0xd67f92(0x112)][_0xd67f92(0x10c)]({'where':{'shopId':_0x250efe},'data':_0x2d2a35});}async[a55_0x491e70(0x12b)](_0x4e97bb,_0x2f617a){const _0x25811c=a55_0x491e70;await this[_0x25811c(0x10b)](_0x4e97bb);const _0x4f4ad9={};_0x2f617a[_0x25811c(0x132)]!==undefined&&(_0x4f4ad9[_0x25811c(0x13a)]=_0x2f617a['botApiKey']||null),_0x2f617a[_0x25811c(0x130)]!==undefined&&(_0x4f4ad9[_0x25811c(0xfd)]=_0x2f617a[_0x25811c(0x130)]||null),await database_1[_0x25811c(0x12e)][_0x25811c(0x112)][_0x25811c(0x10c)]({'where':{'shopId':_0x4e97bb},'data':_0x4f4ad9});}async[a55_0x491e70(0x10d)](_0x2e9a12,_0x85e62){const _0x2ce6f1=a55_0x491e70;await this[_0x2ce6f1(0x10b)](_0x2e9a12);const _0x60de5={};_0x85e62[_0x2ce6f1(0x128)]!==undefined&&(_0x60de5[_0x2ce6f1(0x128)]=_0x85e62[_0x2ce6f1(0x128)]||null),_0x85e62[_0x2ce6f1(0x106)]!==undefined&&(_0x60de5['webhookEvents']=_0x85e62[_0x2ce6f1(0x106)]||[]),await database_1[_0x2ce6f1(0x12e)][_0x2ce6f1(0x112)]['update']({'where':{'shopId':_0x2e9a12},'data':_0x60de5});}async[a55_0x491e70(0x118)](_0x12d62b){const _0x3525a7=a55_0x491e70,_0x35e2f5=_0x3525a7(0x109)+crypto_1[_0x3525a7(0x12e)][_0x3525a7(0x116)](0x20)[_0x3525a7(0x11e)](_0x3525a7(0x135)),_0x2632cb='sk_'+crypto_1['default'][_0x3525a7(0x116)](0x20)['toString'](_0x3525a7(0x135));await database_1[_0x3525a7(0x12e)][_0x3525a7(0x101)][_0x3525a7(0x10c)]({'where':{'id':_0x12d62b},'data':{'publicKey':_0x35e2f5,'secretKey':_0x2632cb}});}async[a55_0x491e70(0x114)](_0x1a9725,_0x58f0a8){const _0x2299a0=a55_0x491e70,{passwordConfirmation:_0x47d889}=_0x58f0a8,_0x14d206=await database_1['default']['shop'][_0x2299a0(0x138)]({'where':{'id':_0x1a9725},'select':{'password':!![]}});if(!_0x14d206)throw new Error('Shop\x20not\x20found');const _0xe1d994=await bcryptjs_1[_0x2299a0(0x12e)]['compare'](_0x47d889,_0x14d206['password']);if(!_0xe1d994)throw new Error(_0x2299a0(0x121));await database_1[_0x2299a0(0x12e)][_0x2299a0(0x101)][_0x2299a0(0x110)]({'where':{'id':_0x1a9725}});}async['ensureSettingsExist'](_0x369537){const _0x358ea2=a55_0x491e70,_0x175af5=await database_1[_0x358ea2(0x12e)][_0x358ea2(0x112)][_0x358ea2(0x138)]({'where':{'shopId':_0x369537}});!_0x175af5&&await database_1['default'][_0x358ea2(0x112)][_0x358ea2(0x107)]({'data':{'shopId':_0x369537}});}}function a55_0x5360(){const _0x168ca7=['parseWebhookEvents','botApiKey','notificationPaymentFailed','131859IeenAi','hex','Shop\x20not\x20found','length','findUnique','name','telegramBotApiKey','958196vyFzUl','telegramChatId','notificationApiError','notificationPayout','telegram','shop','refund','getShopSettings','compare','parse','webhookEvents','create','maskApiKey','pk_','notificationRefund','ensureSettingsExist','update','updateWebhookSettings','isArray','__esModule','delete','shopUrl','shopSettings','payment_success','deleteAccount','5DHbyIQ','randomBytes','1255944nXhyzL','revokeAllApiKeys','45CEeKih','1723830JxALrb','api_error','__importDefault','repeat','toString','settings','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','Password\x20confirmation\x20is\x20incorrect','notificationLogin','500829iaVmJN','994456LuAGtu','hash','4272954lDNJRx','payout','webhookUrl','notificationPaymentSuccess','../config/database','updateTelegramSettings','SettingsService','substring','default','bcryptjs','chatId'];a55_0x5360=function(){return _0x168ca7;};return a55_0x5360();}exports[a55_0x491e70(0x12c)]=SettingsService;