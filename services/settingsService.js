'use strict';const a52_0x5c62df=a52_0x1d4b;(function(_0x1b75c8,_0x16c1f4){const _0x345d6e=a52_0x1d4b,_0xb96820=_0x1b75c8();while(!![]){try{const _0x3f8875=-parseInt(_0x345d6e(0x167))/0x1*(-parseInt(_0x345d6e(0x18b))/0x2)+-parseInt(_0x345d6e(0x159))/0x3+-parseInt(_0x345d6e(0x175))/0x4+-parseInt(_0x345d6e(0x15a))/0x5+parseInt(_0x345d6e(0x16c))/0x6*(parseInt(_0x345d6e(0x174))/0x7)+-parseInt(_0x345d6e(0x17a))/0x8*(parseInt(_0x345d6e(0x17d))/0x9)+parseInt(_0x345d6e(0x155))/0xa;if(_0x3f8875===_0x16c1f4)break;else _0xb96820['push'](_0xb96820['shift']());}catch(_0x129216){_0xb96820['push'](_0xb96820['shift']());}}}(a52_0x59c2,0x7c735));var __importDefault=this&&this[a52_0x5c62df(0x157)]||function(_0x233e41){return _0x233e41&&_0x233e41['__esModule']?_0x233e41:{'default':_0x233e41};};Object[a52_0x5c62df(0x186)](exports,a52_0x5c62df(0x176),{'value':!![]}),exports[a52_0x5c62df(0x17e)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x5c62df(0x196))),crypto_1=__importDefault(require(a52_0x5c62df(0x154))),database_1=__importDefault(require(a52_0x5c62df(0x153)));function a52_0x1d4b(_0xd37c53,_0x323074){const _0x59c24e=a52_0x59c2();return a52_0x1d4b=function(_0x1d4be9,_0x383a36){_0x1d4be9=_0x1d4be9-0x150;let _0x39c699=_0x59c24e[_0x1d4be9];return _0x39c699;},a52_0x1d4b(_0xd37c53,_0x323074);}class SettingsService{[a52_0x5c62df(0x18c)](_0x1bde2d){const _0x3ee02b=a52_0x5c62df;if(!_0x1bde2d)return'';if(_0x1bde2d[_0x3ee02b(0x179)]<=0x8)return _0x1bde2d;const _0x2778b9=_0x1bde2d[_0x3ee02b(0x15e)](0x0,0x8),_0x2590ff='*'[_0x3ee02b(0x190)](Math[_0x3ee02b(0x192)](0x0,_0x1bde2d[_0x3ee02b(0x179)]-0x8));return _0x2778b9+_0x2590ff;}[a52_0x5c62df(0x177)](_0x5a502c){const _0x3c43c1=a52_0x5c62df;if(!_0x5a502c)return[];if(Array[_0x3c43c1(0x193)](_0x5a502c))return _0x5a502c;if(typeof _0x5a502c===_0x3c43c1(0x16d))try{const _0x4e2626=JSON[_0x3c43c1(0x18e)](_0x5a502c);return Array['isArray'](_0x4e2626)?_0x4e2626:[];}catch{return[];}return[];}async[a52_0x5c62df(0x164)](_0x35d427){const _0x1aca09=a52_0x5c62df,_0x2a30d3=await database_1[_0x1aca09(0x158)][_0x1aca09(0x184)][_0x1aca09(0x172)]({'where':{'id':_0x35d427},'include':{'settings':!![]}});if(!_0x2a30d3)throw new Error('Shop\x20not\x20found');let _0x22a797=_0x2a30d3[_0x1aca09(0x15c)];return!_0x22a797&&(_0x22a797=await database_1['default'][_0x1aca09(0x188)][_0x1aca09(0x16e)]({'data':{'shopId':_0x2a30d3['id']}})),{'fullName':_0x2a30d3[_0x1aca09(0x161)],'brand':_0x2a30d3[_0x1aca09(0x161)],'merchantUrl':_0x2a30d3[_0x1aca09(0x182)],'telegramUsername':_0x2a30d3[_0x1aca09(0x17b)],'telegramBotApiKey':_0x22a797[_0x1aca09(0x170)]?this[_0x1aca09(0x18c)](_0x22a797[_0x1aca09(0x170)]):null,'telegramChatId':_0x22a797[_0x1aca09(0x156)],'webhookUrl':_0x22a797[_0x1aca09(0x162)],'webhookEvents':this[_0x1aca09(0x177)](_0x22a797['webhookEvents']),'notifications':{'payment_success':_0x22a797[_0x1aca09(0x180)],'payment_failed':_0x22a797[_0x1aca09(0x163)],'refund':_0x22a797[_0x1aca09(0x171)],'payout':_0x22a797['notificationPayout'],'login':_0x22a797[_0x1aca09(0x185)],'api_error':_0x22a797['notificationApiError']}};}async[a52_0x5c62df(0x194)](_0x186292,_0x25c6e9){const _0x161f52=a52_0x5c62df,{currentPassword:_0x745be7,newPassword:_0x2974e0,confirmNewPassword:_0x3cab8e}=_0x25c6e9;if(_0x2974e0!==_0x3cab8e)throw new Error(_0x161f52(0x173));if(_0x2974e0[_0x161f52(0x179)]<0x6)throw new Error(_0x161f52(0x197));const _0x57cf70=await database_1[_0x161f52(0x158)][_0x161f52(0x184)][_0x161f52(0x172)]({'where':{'id':_0x186292},'select':{'password':!![]}});if(!_0x57cf70)throw new Error('Shop\x20not\x20found');const _0x2ccd55=await bcryptjs_1[_0x161f52(0x158)]['compare'](_0x745be7,_0x57cf70['password']);if(!_0x2ccd55)throw new Error('Current\x20password\x20is\x20incorrect');const _0x13c213=await bcryptjs_1[_0x161f52(0x158)][_0x161f52(0x150)](_0x2974e0,0xc);await database_1[_0x161f52(0x158)][_0x161f52(0x184)][_0x161f52(0x18a)]({'where':{'id':_0x186292},'data':{'password':_0x13c213}});}async['updateNotifications'](_0x3b35a7,_0x3512d6){const _0x49d55b=a52_0x5c62df;await this['ensureSettingsExist'](_0x3b35a7);const _0x3f7a2d={};_0x3512d6[_0x49d55b(0x16b)]!==undefined&&(_0x3f7a2d[_0x49d55b(0x180)]=_0x3512d6['payment_success']),_0x3512d6[_0x49d55b(0x165)]!==undefined&&(_0x3f7a2d[_0x49d55b(0x163)]=_0x3512d6[_0x49d55b(0x165)]),_0x3512d6['refund']!==undefined&&(_0x3f7a2d['notificationRefund']=_0x3512d6[_0x49d55b(0x168)]),_0x3512d6[_0x49d55b(0x169)]!==undefined&&(_0x3f7a2d[_0x49d55b(0x187)]=_0x3512d6[_0x49d55b(0x169)]),_0x3512d6['login']!==undefined&&(_0x3f7a2d[_0x49d55b(0x185)]=_0x3512d6[_0x49d55b(0x152)]),_0x3512d6['api_error']!==undefined&&(_0x3f7a2d[_0x49d55b(0x166)]=_0x3512d6[_0x49d55b(0x178)]),await database_1[_0x49d55b(0x158)][_0x49d55b(0x188)][_0x49d55b(0x18a)]({'where':{'shopId':_0x3b35a7},'data':_0x3f7a2d});}async['updateTelegramSettings'](_0x1f57e2,_0x3b92b4){const _0x7ef325=a52_0x5c62df;await this['ensureSettingsExist'](_0x1f57e2);const _0x540c5d={};_0x3b92b4[_0x7ef325(0x191)]!==undefined&&(_0x540c5d['telegramBotApiKey']=_0x3b92b4[_0x7ef325(0x191)]||null),_0x3b92b4['chatId']!==undefined&&(_0x540c5d[_0x7ef325(0x156)]=_0x3b92b4[_0x7ef325(0x195)]||null),await database_1[_0x7ef325(0x158)][_0x7ef325(0x188)][_0x7ef325(0x18a)]({'where':{'shopId':_0x1f57e2},'data':_0x540c5d});}async[a52_0x5c62df(0x151)](_0x262966,_0x3e5eb0){const _0x1a85e3=a52_0x5c62df;await this[_0x1a85e3(0x160)](_0x262966);const _0x4188c5={};_0x3e5eb0[_0x1a85e3(0x162)]!==undefined&&(_0x4188c5[_0x1a85e3(0x162)]=_0x3e5eb0['webhookUrl']||null),_0x3e5eb0[_0x1a85e3(0x15d)]!==undefined&&(_0x4188c5['webhookEvents']=_0x3e5eb0['webhookEvents']||[]),await database_1[_0x1a85e3(0x158)][_0x1a85e3(0x188)]['update']({'where':{'shopId':_0x262966},'data':_0x4188c5});}async[a52_0x5c62df(0x15b)](_0xb6b22f){const _0x209539=a52_0x5c62df,_0x24fba7=_0x209539(0x18d)+crypto_1[_0x209539(0x158)][_0x209539(0x17f)](0x20)[_0x209539(0x181)]('hex'),_0x373ee7='sk_'+crypto_1['default'][_0x209539(0x17f)](0x20)['toString'](_0x209539(0x17c));await database_1[_0x209539(0x158)][_0x209539(0x184)][_0x209539(0x18a)]({'where':{'id':_0xb6b22f},'data':{'publicKey':_0x24fba7,'secretKey':_0x373ee7}});}async[a52_0x5c62df(0x183)](_0x17d347,_0x340b93){const _0x534078=a52_0x5c62df,{passwordConfirmation:_0x4bd0f5}=_0x340b93,_0x396505=await database_1[_0x534078(0x158)][_0x534078(0x184)][_0x534078(0x172)]({'where':{'id':_0x17d347},'select':{'password':!![]}});if(!_0x396505)throw new Error(_0x534078(0x16f));const _0x10cf76=await bcryptjs_1['default'][_0x534078(0x15f)](_0x4bd0f5,_0x396505[_0x534078(0x189)]);if(!_0x10cf76)throw new Error(_0x534078(0x18f));await database_1[_0x534078(0x158)][_0x534078(0x184)][_0x534078(0x16a)]({'where':{'id':_0x17d347}});}async['ensureSettingsExist'](_0x3a010c){const _0x126e11=a52_0x5c62df,_0x350bf0=await database_1[_0x126e11(0x158)][_0x126e11(0x188)][_0x126e11(0x172)]({'where':{'shopId':_0x3a010c}});!_0x350bf0&&await database_1[_0x126e11(0x158)][_0x126e11(0x188)][_0x126e11(0x16e)]({'data':{'shopId':_0x3a010c}});}}exports[a52_0x5c62df(0x17e)]=SettingsService;function a52_0x59c2(){const _0xb6b508=['updateWebhookSettings','login','../config/database','crypto','26749320UCBMfc','telegramChatId','__importDefault','default','1735173CXQMUy','1938655AAvooj','revokeAllApiKeys','settings','webhookEvents','substring','compare','ensureSettingsExist','name','webhookUrl','notificationPaymentFailed','getShopSettings','payment_failed','notificationApiError','1lcDVCU','refund','payout','delete','payment_success','17724WYxOAp','string','create','Shop\x20not\x20found','telegramBotApiKey','notificationRefund','findUnique','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','98qxKwQL','1428628UKRZSI','__esModule','parseWebhookEvents','api_error','length','8rMEKKE','telegram','hex','8157411nEqfhR','SettingsService','randomBytes','notificationPaymentSuccess','toString','shopUrl','deleteAccount','shop','notificationLogin','defineProperty','notificationPayout','shopSettings','password','update','46238WfSJDY','maskApiKey','pk_','parse','Password\x20confirmation\x20is\x20incorrect','repeat','botApiKey','max','isArray','changePassword','chatId','bcryptjs','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','hash'];a52_0x59c2=function(){return _0xb6b508;};return a52_0x59c2();}