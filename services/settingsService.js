'use strict';function a52_0x3bee(_0x53f6ef,_0x4ac961){const _0x49af16=a52_0x49af();return a52_0x3bee=function(_0x3bee1b,_0x13f01c){_0x3bee1b=_0x3bee1b-0x1a2;let _0x15e251=_0x49af16[_0x3bee1b];return _0x15e251;},a52_0x3bee(_0x53f6ef,_0x4ac961);}const a52_0x2e8cfb=a52_0x3bee;(function(_0x181c02,_0x20ec1f){const _0x3c187a=a52_0x3bee,_0x36d180=_0x181c02();while(!![]){try{const _0x23e95e=-parseInt(_0x3c187a(0x1b7))/0x1+parseInt(_0x3c187a(0x1a7))/0x2*(-parseInt(_0x3c187a(0x1ab))/0x3)+-parseInt(_0x3c187a(0x1d8))/0x4*(-parseInt(_0x3c187a(0x1bd))/0x5)+parseInt(_0x3c187a(0x1ae))/0x6+parseInt(_0x3c187a(0x1b4))/0x7*(parseInt(_0x3c187a(0x1ac))/0x8)+-parseInt(_0x3c187a(0x1c7))/0x9*(parseInt(_0x3c187a(0x1d4))/0xa)+parseInt(_0x3c187a(0x1e2))/0xb*(parseInt(_0x3c187a(0x1c5))/0xc);if(_0x23e95e===_0x20ec1f)break;else _0x36d180['push'](_0x36d180['shift']());}catch(_0x1a80f2){_0x36d180['push'](_0x36d180['shift']());}}}(a52_0x49af,0x58416));function a52_0x49af(){const _0x25378d=['substring','../config/database','Shop\x20not\x20found','bcryptjs','chatId','48lWIGQW','notificationPaymentFailed','688131eeSqfC','telegram','payout','Password\x20confirmation\x20is\x20incorrect','telegramBotApiKey','shop','notificationPaymentSuccess','updateTelegramSettings','payment_success','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','length','findUnique','webhookUrl','10kBXuFf','crypto','__esModule','parseWebhookEvents','4VAouzn','password','botApiKey','telegramChatId','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','parse','notificationRefund','defineProperty','updateNotifications','create','1241339babtEQ','maskApiKey','string','default','api_error','payment_failed','webhookEvents','revokeAllApiKeys','refund','notificationApiError','307466YGLKKZ','hex','isArray','notificationPayout','3QFaYrY','200YbfBPn','settings','1090494YeFWlO','compare','randomBytes','ensureSettingsExist','SettingsService','name','43309fwFhmN','updateWebhookSettings','login','543041CdfpRs','getShopSettings','pk_','notificationLogin','repeat','Current\x20password\x20is\x20incorrect','1734535EcvCBr','shopSettings','update'];a52_0x49af=function(){return _0x25378d;};return a52_0x49af();}var __importDefault=this&&this['__importDefault']||function(_0x3de729){const _0x315e14=a52_0x3bee;return _0x3de729&&_0x3de729[_0x315e14(0x1d6)]?_0x3de729:{'default':_0x3de729};};Object[a52_0x2e8cfb(0x1df)](exports,a52_0x2e8cfb(0x1d6),{'value':!![]}),exports[a52_0x2e8cfb(0x1b2)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x2e8cfb(0x1c3))),crypto_1=__importDefault(require(a52_0x2e8cfb(0x1d5))),database_1=__importDefault(require(a52_0x2e8cfb(0x1c1)));class SettingsService{[a52_0x2e8cfb(0x1e3)](_0x2ea8e8){const _0x280b36=a52_0x2e8cfb;if(!_0x2ea8e8)return'';if(_0x2ea8e8[_0x280b36(0x1d1)]<=0x8)return _0x2ea8e8;const _0x464f29=_0x2ea8e8[_0x280b36(0x1c0)](0x0,0x8),_0x57e15c='*'[_0x280b36(0x1bb)](Math['max'](0x0,_0x2ea8e8['length']-0x8));return _0x464f29+_0x57e15c;}['parseWebhookEvents'](_0x2100d7){const _0x252fbd=a52_0x2e8cfb;if(!_0x2100d7)return[];if(Array[_0x252fbd(0x1a9)](_0x2100d7))return _0x2100d7;if(typeof _0x2100d7===_0x252fbd(0x1e4))try{const _0x180309=JSON[_0x252fbd(0x1dd)](_0x2100d7);return Array['isArray'](_0x180309)?_0x180309:[];}catch{return[];}return[];}async[a52_0x2e8cfb(0x1b8)](_0x36c913){const _0x439291=a52_0x2e8cfb,_0x511416=await database_1['default']['shop'][_0x439291(0x1d2)]({'where':{'id':_0x36c913},'include':{'settings':!![]}});if(!_0x511416)throw new Error(_0x439291(0x1c2));let _0x1696b8=_0x511416[_0x439291(0x1ad)];return!_0x1696b8&&(_0x1696b8=await database_1[_0x439291(0x1e5)][_0x439291(0x1be)]['create']({'data':{'shopId':_0x511416['id']}})),{'fullName':_0x511416[_0x439291(0x1b3)],'brand':_0x511416['name'],'merchantUrl':_0x511416['shopUrl'],'telegramUsername':_0x511416[_0x439291(0x1c8)],'telegramBotApiKey':_0x1696b8[_0x439291(0x1cb)]?this[_0x439291(0x1e3)](_0x1696b8['telegramBotApiKey']):null,'telegramChatId':_0x1696b8['telegramChatId'],'webhookUrl':_0x1696b8[_0x439291(0x1d3)],'webhookEvents':this[_0x439291(0x1d7)](_0x1696b8[_0x439291(0x1a3)]),'notifications':{'payment_success':_0x1696b8[_0x439291(0x1cd)],'payment_failed':_0x1696b8[_0x439291(0x1c6)],'refund':_0x1696b8[_0x439291(0x1de)],'payout':_0x1696b8[_0x439291(0x1aa)],'login':_0x1696b8[_0x439291(0x1ba)],'api_error':_0x1696b8[_0x439291(0x1a6)]}};}async['changePassword'](_0x48d8ac,_0x18af1a){const _0x46c192=a52_0x2e8cfb,{currentPassword:_0xb28631,newPassword:_0x589f85,confirmNewPassword:_0x424eb4}=_0x18af1a;if(_0x589f85!==_0x424eb4)throw new Error(_0x46c192(0x1dc));if(_0x589f85['length']<0x6)throw new Error(_0x46c192(0x1d0));const _0x10cb00=await database_1['default'][_0x46c192(0x1cc)][_0x46c192(0x1d2)]({'where':{'id':_0x48d8ac},'select':{'password':!![]}});if(!_0x10cb00)throw new Error(_0x46c192(0x1c2));const _0x17ff82=await bcryptjs_1[_0x46c192(0x1e5)][_0x46c192(0x1af)](_0xb28631,_0x10cb00['password']);if(!_0x17ff82)throw new Error(_0x46c192(0x1bc));const _0x35465a=await bcryptjs_1[_0x46c192(0x1e5)]['hash'](_0x589f85,0xc);await database_1['default'][_0x46c192(0x1cc)][_0x46c192(0x1bf)]({'where':{'id':_0x48d8ac},'data':{'password':_0x35465a}});}async[a52_0x2e8cfb(0x1e0)](_0xb6d833,_0x30d9a3){const _0x4a0ab5=a52_0x2e8cfb;await this[_0x4a0ab5(0x1b1)](_0xb6d833);const _0xcf11cc={};_0x30d9a3[_0x4a0ab5(0x1cf)]!==undefined&&(_0xcf11cc[_0x4a0ab5(0x1cd)]=_0x30d9a3[_0x4a0ab5(0x1cf)]),_0x30d9a3[_0x4a0ab5(0x1a2)]!==undefined&&(_0xcf11cc[_0x4a0ab5(0x1c6)]=_0x30d9a3['payment_failed']),_0x30d9a3[_0x4a0ab5(0x1a5)]!==undefined&&(_0xcf11cc[_0x4a0ab5(0x1de)]=_0x30d9a3[_0x4a0ab5(0x1a5)]),_0x30d9a3[_0x4a0ab5(0x1c9)]!==undefined&&(_0xcf11cc[_0x4a0ab5(0x1aa)]=_0x30d9a3[_0x4a0ab5(0x1c9)]),_0x30d9a3['login']!==undefined&&(_0xcf11cc[_0x4a0ab5(0x1ba)]=_0x30d9a3[_0x4a0ab5(0x1b6)]),_0x30d9a3[_0x4a0ab5(0x1e6)]!==undefined&&(_0xcf11cc[_0x4a0ab5(0x1a6)]=_0x30d9a3[_0x4a0ab5(0x1e6)]),await database_1[_0x4a0ab5(0x1e5)]['shopSettings'][_0x4a0ab5(0x1bf)]({'where':{'shopId':_0xb6d833},'data':_0xcf11cc});}async[a52_0x2e8cfb(0x1ce)](_0x465e89,_0x4f7710){const _0x2bc382=a52_0x2e8cfb;await this['ensureSettingsExist'](_0x465e89);const _0x15d8e6={};_0x4f7710[_0x2bc382(0x1da)]!==undefined&&(_0x15d8e6[_0x2bc382(0x1cb)]=_0x4f7710[_0x2bc382(0x1da)]||null),_0x4f7710['chatId']!==undefined&&(_0x15d8e6[_0x2bc382(0x1db)]=_0x4f7710[_0x2bc382(0x1c4)]||null),await database_1[_0x2bc382(0x1e5)][_0x2bc382(0x1be)][_0x2bc382(0x1bf)]({'where':{'shopId':_0x465e89},'data':_0x15d8e6});}async[a52_0x2e8cfb(0x1b5)](_0x382d00,_0x1af0e5){const _0x41149c=a52_0x2e8cfb;await this[_0x41149c(0x1b1)](_0x382d00);const _0x2c70c3={};_0x1af0e5[_0x41149c(0x1d3)]!==undefined&&(_0x2c70c3[_0x41149c(0x1d3)]=_0x1af0e5[_0x41149c(0x1d3)]||null),_0x1af0e5[_0x41149c(0x1a3)]!==undefined&&(_0x2c70c3[_0x41149c(0x1a3)]=_0x1af0e5[_0x41149c(0x1a3)]||[]),await database_1[_0x41149c(0x1e5)][_0x41149c(0x1be)][_0x41149c(0x1bf)]({'where':{'shopId':_0x382d00},'data':_0x2c70c3});}async[a52_0x2e8cfb(0x1a4)](_0x10b1dd){const _0xefee83=a52_0x2e8cfb,_0x3d70ec=_0xefee83(0x1b9)+crypto_1[_0xefee83(0x1e5)][_0xefee83(0x1b0)](0x20)['toString'](_0xefee83(0x1a8)),_0x675e7c='sk_'+crypto_1[_0xefee83(0x1e5)][_0xefee83(0x1b0)](0x20)['toString']('hex');await database_1[_0xefee83(0x1e5)][_0xefee83(0x1cc)][_0xefee83(0x1bf)]({'where':{'id':_0x10b1dd},'data':{'publicKey':_0x3d70ec,'secretKey':_0x675e7c}});}async['deleteAccount'](_0x373caa,_0x15a118){const _0xbd32c7=a52_0x2e8cfb,{passwordConfirmation:_0x14eadd}=_0x15a118,_0x10336f=await database_1[_0xbd32c7(0x1e5)][_0xbd32c7(0x1cc)][_0xbd32c7(0x1d2)]({'where':{'id':_0x373caa},'select':{'password':!![]}});if(!_0x10336f)throw new Error(_0xbd32c7(0x1c2));const _0x318cd3=await bcryptjs_1['default'][_0xbd32c7(0x1af)](_0x14eadd,_0x10336f[_0xbd32c7(0x1d9)]);if(!_0x318cd3)throw new Error(_0xbd32c7(0x1ca));await database_1[_0xbd32c7(0x1e5)][_0xbd32c7(0x1cc)]['delete']({'where':{'id':_0x373caa}});}async[a52_0x2e8cfb(0x1b1)](_0xf866fa){const _0x387634=a52_0x2e8cfb,_0x352a26=await database_1[_0x387634(0x1e5)]['shopSettings'][_0x387634(0x1d2)]({'where':{'shopId':_0xf866fa}});!_0x352a26&&await database_1[_0x387634(0x1e5)][_0x387634(0x1be)][_0x387634(0x1e1)]({'data':{'shopId':_0xf866fa}});}}exports[a52_0x2e8cfb(0x1b2)]=SettingsService;