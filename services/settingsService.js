'use strict';const a52_0x136393=a52_0x2b58;(function(_0x3e430c,_0x440b10){const _0x3bc1a4=a52_0x2b58,_0x2cbafc=_0x3e430c();while(!![]){try{const _0x151e23=parseInt(_0x3bc1a4(0x1b2))/0x1*(-parseInt(_0x3bc1a4(0x197))/0x2)+parseInt(_0x3bc1a4(0x1a2))/0x3*(-parseInt(_0x3bc1a4(0x187))/0x4)+parseInt(_0x3bc1a4(0x19d))/0x5*(parseInt(_0x3bc1a4(0x186))/0x6)+parseInt(_0x3bc1a4(0x174))/0x7+-parseInt(_0x3bc1a4(0x196))/0x8*(parseInt(_0x3bc1a4(0x171))/0x9)+-parseInt(_0x3bc1a4(0x190))/0xa+-parseInt(_0x3bc1a4(0x19f))/0xb*(-parseInt(_0x3bc1a4(0x198))/0xc);if(_0x151e23===_0x440b10)break;else _0x2cbafc['push'](_0x2cbafc['shift']());}catch(_0x5a09b5){_0x2cbafc['push'](_0x2cbafc['shift']());}}}(a52_0xfa23,0x6a2c4));function a52_0x2b58(_0x429bb8,_0x370dfa){const _0xfa23d1=a52_0xfa23();return a52_0x2b58=function(_0x2b58ee,_0x312355){_0x2b58ee=_0x2b58ee-0x16c;let _0xd54956=_0xfa23d1[_0x2b58ee];return _0xd54956;},a52_0x2b58(_0x429bb8,_0x370dfa);}var __importDefault=this&&this['__importDefault']||function(_0x368722){const _0x406f60=a52_0x2b58;return _0x368722&&_0x368722[_0x406f60(0x1b5)]?_0x368722:{'default':_0x368722};};Object[a52_0x136393(0x18c)](exports,a52_0x136393(0x1b5),{'value':!![]}),exports[a52_0x136393(0x1b3)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x136393(0x1af))),crypto_1=__importDefault(require(a52_0x136393(0x192))),database_1=__importDefault(require(a52_0x136393(0x1a3)));class SettingsService{[a52_0x136393(0x1a7)](_0x5e4cc6){const _0x571f20=a52_0x136393;if(!_0x5e4cc6)return'';if(_0x5e4cc6['length']<=0x8)return _0x5e4cc6;const _0x434e04=_0x5e4cc6[_0x571f20(0x19b)](0x0,0x8),_0x45b769='*'['repeat'](Math[_0x571f20(0x19e)](0x0,_0x5e4cc6[_0x571f20(0x179)]-0x8));return _0x434e04+_0x45b769;}[a52_0x136393(0x172)](_0x43e6f4){const _0x5de723=a52_0x136393;if(!_0x43e6f4)return[];if(Array[_0x5de723(0x17f)](_0x43e6f4))return _0x43e6f4;if(typeof _0x43e6f4===_0x5de723(0x17e))try{const _0x27fb3d=JSON[_0x5de723(0x1a4)](_0x43e6f4);return Array[_0x5de723(0x17f)](_0x27fb3d)?_0x27fb3d:[];}catch{return[];}return[];}async[a52_0x136393(0x16c)](_0x2fe809){const _0x55fcea=a52_0x136393,_0xf50804=await database_1[_0x55fcea(0x193)][_0x55fcea(0x19c)]['findUnique']({'where':{'id':_0x2fe809},'include':{'settings':!![]}});if(!_0xf50804)throw new Error(_0x55fcea(0x182));let _0xcd20ed=_0xf50804[_0x55fcea(0x178)];return!_0xcd20ed&&(_0xcd20ed=await database_1[_0x55fcea(0x193)]['shopSettings'][_0x55fcea(0x189)]({'data':{'shopId':_0xf50804['id']}})),{'fullName':_0xf50804[_0x55fcea(0x1ae)],'brand':_0xf50804[_0x55fcea(0x1ae)],'merchantUrl':_0xf50804[_0x55fcea(0x1a9)],'telegramUsername':_0xf50804[_0x55fcea(0x17b)],'telegramBotApiKey':_0xcd20ed[_0x55fcea(0x19a)]?this[_0x55fcea(0x1a7)](_0xcd20ed['telegramBotApiKey']):null,'telegramChatId':_0xcd20ed[_0x55fcea(0x18b)],'webhookUrl':_0xcd20ed[_0x55fcea(0x194)],'webhookEvents':this['parseWebhookEvents'](_0xcd20ed['webhookEvents']),'notifications':{'payment_success':_0xcd20ed[_0x55fcea(0x180)],'payment_failed':_0xcd20ed[_0x55fcea(0x1a5)],'refund':_0xcd20ed[_0x55fcea(0x1a1)],'payout':_0xcd20ed[_0x55fcea(0x183)],'login':_0xcd20ed[_0x55fcea(0x173)],'api_error':_0xcd20ed[_0x55fcea(0x1ab)]}};}async[a52_0x136393(0x184)](_0x415c81,_0xb35375){const _0x277259=a52_0x136393,{currentPassword:_0x122435,newPassword:_0x33e024,confirmNewPassword:_0x1d4963}=_0xb35375;if(_0x33e024!==_0x1d4963)throw new Error(_0x277259(0x181));if(_0x33e024[_0x277259(0x179)]<0x6)throw new Error(_0x277259(0x17a));const _0x3e59c1=await database_1['default']['shop'][_0x277259(0x175)]({'where':{'id':_0x415c81},'select':{'password':!![]}});if(!_0x3e59c1)throw new Error(_0x277259(0x182));const _0x4fae58=await bcryptjs_1[_0x277259(0x193)][_0x277259(0x185)](_0x122435,_0x3e59c1[_0x277259(0x17c)]);if(!_0x4fae58)throw new Error(_0x277259(0x176));const _0x2e5bce=await bcryptjs_1[_0x277259(0x193)][_0x277259(0x1ad)](_0x33e024,0xc);await database_1[_0x277259(0x193)][_0x277259(0x19c)][_0x277259(0x16f)]({'where':{'id':_0x415c81},'data':{'password':_0x2e5bce}});}async['updateNotifications'](_0x3d1b06,_0x56c0c6){const _0x437827=a52_0x136393;await this[_0x437827(0x170)](_0x3d1b06);const _0x2df37e={};_0x56c0c6[_0x437827(0x1a0)]!==undefined&&(_0x2df37e[_0x437827(0x180)]=_0x56c0c6[_0x437827(0x1a0)]),_0x56c0c6[_0x437827(0x18d)]!==undefined&&(_0x2df37e['notificationPaymentFailed']=_0x56c0c6[_0x437827(0x18d)]),_0x56c0c6['refund']!==undefined&&(_0x2df37e[_0x437827(0x1a1)]=_0x56c0c6[_0x437827(0x16e)]),_0x56c0c6[_0x437827(0x18a)]!==undefined&&(_0x2df37e[_0x437827(0x183)]=_0x56c0c6[_0x437827(0x18a)]),_0x56c0c6[_0x437827(0x188)]!==undefined&&(_0x2df37e[_0x437827(0x173)]=_0x56c0c6['login']),_0x56c0c6[_0x437827(0x1a6)]!==undefined&&(_0x2df37e['notificationApiError']=_0x56c0c6[_0x437827(0x1a6)]),await database_1[_0x437827(0x193)][_0x437827(0x16d)][_0x437827(0x16f)]({'where':{'shopId':_0x3d1b06},'data':_0x2df37e});}async[a52_0x136393(0x1b1)](_0x306108,_0x1908c2){const _0x240237=a52_0x136393;await this[_0x240237(0x170)](_0x306108);const _0x199dd7={};_0x1908c2[_0x240237(0x195)]!==undefined&&(_0x199dd7[_0x240237(0x19a)]=_0x1908c2[_0x240237(0x195)]||null),_0x1908c2[_0x240237(0x18f)]!==undefined&&(_0x199dd7['telegramChatId']=_0x1908c2[_0x240237(0x18f)]||null),await database_1[_0x240237(0x193)][_0x240237(0x16d)][_0x240237(0x16f)]({'where':{'shopId':_0x306108},'data':_0x199dd7});}async[a52_0x136393(0x1a8)](_0x2023ed,_0x7a9c7a){const _0x1d858d=a52_0x136393;await this[_0x1d858d(0x170)](_0x2023ed);const _0x218a90={};_0x7a9c7a[_0x1d858d(0x194)]!==undefined&&(_0x218a90[_0x1d858d(0x194)]=_0x7a9c7a[_0x1d858d(0x194)]||null),_0x7a9c7a[_0x1d858d(0x18e)]!==undefined&&(_0x218a90[_0x1d858d(0x18e)]=_0x7a9c7a[_0x1d858d(0x18e)]||[]),await database_1[_0x1d858d(0x193)]['shopSettings'][_0x1d858d(0x16f)]({'where':{'shopId':_0x2023ed},'data':_0x218a90});}async[a52_0x136393(0x17d)](_0x4268e5){const _0x4941e0=a52_0x136393,_0x262060='pk_'+crypto_1['default'][_0x4941e0(0x191)](0x20)[_0x4941e0(0x1ac)](_0x4941e0(0x177)),_0x42129b=_0x4941e0(0x1b4)+crypto_1['default'][_0x4941e0(0x191)](0x20)[_0x4941e0(0x1ac)](_0x4941e0(0x177));await database_1[_0x4941e0(0x193)][_0x4941e0(0x19c)][_0x4941e0(0x16f)]({'where':{'id':_0x4268e5},'data':{'publicKey':_0x262060,'secretKey':_0x42129b}});}async[a52_0x136393(0x1b0)](_0x378975,_0x34093a){const _0x2f413e=a52_0x136393,{passwordConfirmation:_0x2cfe03}=_0x34093a,_0x36b030=await database_1[_0x2f413e(0x193)][_0x2f413e(0x19c)][_0x2f413e(0x175)]({'where':{'id':_0x378975},'select':{'password':!![]}});if(!_0x36b030)throw new Error('Shop\x20not\x20found');const _0xe5969=await bcryptjs_1[_0x2f413e(0x193)]['compare'](_0x2cfe03,_0x36b030['password']);if(!_0xe5969)throw new Error(_0x2f413e(0x1aa));await database_1['default'][_0x2f413e(0x19c)][_0x2f413e(0x199)]({'where':{'id':_0x378975}});}async[a52_0x136393(0x170)](_0x1870ad){const _0x26b47d=a52_0x136393,_0x333b29=await database_1[_0x26b47d(0x193)]['shopSettings'][_0x26b47d(0x175)]({'where':{'shopId':_0x1870ad}});!_0x333b29&&await database_1[_0x26b47d(0x193)]['shopSettings'][_0x26b47d(0x189)]({'data':{'shopId':_0x1870ad}});}}exports[a52_0x136393(0x1b3)]=SettingsService;function a52_0xfa23(){const _0x5687ab=['isArray','notificationPaymentSuccess','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','Shop\x20not\x20found','notificationPayout','changePassword','compare','156mjUBjS','56nRjhBF','login','create','payout','telegramChatId','defineProperty','payment_failed','webhookEvents','chatId','6850280ayannn','randomBytes','crypto','default','webhookUrl','botApiKey','3030184gqtwSR','2IfIlKc','5028EiluRj','delete','telegramBotApiKey','substring','shop','76810gTUQmG','max','58168piBsyk','payment_success','notificationRefund','172278zMDUQJ','../config/database','parse','notificationPaymentFailed','api_error','maskApiKey','updateWebhookSettings','shopUrl','Password\x20confirmation\x20is\x20incorrect','notificationApiError','toString','hash','name','bcryptjs','deleteAccount','updateTelegramSettings','43581dflerD','SettingsService','sk_','__esModule','getShopSettings','shopSettings','refund','update','ensureSettingsExist','18GuLLAu','parseWebhookEvents','notificationLogin','769433qJfIxS','findUnique','Current\x20password\x20is\x20incorrect','hex','settings','length','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','telegram','password','revokeAllApiKeys','string'];a52_0xfa23=function(){return _0x5687ab;};return a52_0xfa23();}