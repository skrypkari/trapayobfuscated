'use strict';const a47_0x11b1bf=a47_0x3559;function a47_0x3559(_0x2ac244,_0x238466){const _0x419c9c=a47_0x419c();return a47_0x3559=function(_0x35592f,_0x9a4e5b){_0x35592f=_0x35592f-0x1ec;let _0x457951=_0x419c9c[_0x35592f];return _0x457951;},a47_0x3559(_0x2ac244,_0x238466);}(function(_0x21e633,_0x24fb2b){const _0x411097=a47_0x3559,_0x2c8092=_0x21e633();while(!![]){try{const _0x323e9d=parseInt(_0x411097(0x213))/0x1*(-parseInt(_0x411097(0x21b))/0x2)+-parseInt(_0x411097(0x204))/0x3*(parseInt(_0x411097(0x21e))/0x4)+parseInt(_0x411097(0x1f7))/0x5+-parseInt(_0x411097(0x1f5))/0x6+parseInt(_0x411097(0x1f2))/0x7+-parseInt(_0x411097(0x220))/0x8+-parseInt(_0x411097(0x1ef))/0x9*(-parseInt(_0x411097(0x216))/0xa);if(_0x323e9d===_0x24fb2b)break;else _0x2c8092['push'](_0x2c8092['shift']());}catch(_0x2e82f6){_0x2c8092['push'](_0x2c8092['shift']());}}}(a47_0x419c,0xaa825));function a47_0x419c(){const _0x220de8=['string','Shop\x20not\x20found','3070YnwbZl','randomBytes','../config/database','notificationApiError','api_error','6WWGODv','notificationRefund','toString','225668GcwycD','findUnique','9979632tMLwON','payout','chatId','repeat','length','notificationPaymentFailed','create','delete','notificationPaymentSuccess','shopSettings','defineProperty','webhookUrl','revokeAllApiKeys','hash','payment_success','telegramBotApiKey','115524jxkvMe','telegramChatId','crypto','1340367VxQAxh','hex','parseWebhookEvents','5508222NTvdVL','update','5690480oZxcpH','sk_','Current\x20password\x20is\x20incorrect','refund','compare','notificationPayout','maskApiKey','__esModule','ensureSettingsExist','deleteAccount','login','updateTelegramSettings','changePassword','54aMwJQr','webhookEvents','updateNotifications','SettingsService','updateWebhookSettings','payment_failed','settings','botApiKey','shop','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','default','parse','notificationLogin','getShopSettings','pk_','463609iInCNY'];a47_0x419c=function(){return _0x220de8;};return a47_0x419c();}var __importDefault=this&&this['__importDefault']||function(_0x14e60b){const _0x2bc459=a47_0x3559;return _0x14e60b&&_0x14e60b[_0x2bc459(0x1fe)]?_0x14e60b:{'default':_0x14e60b};};Object[a47_0x11b1bf(0x22a)](exports,a47_0x11b1bf(0x1fe),{'value':!![]}),exports[a47_0x11b1bf(0x207)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a47_0x11b1bf(0x1f1))),database_1=__importDefault(require(a47_0x11b1bf(0x218)));class SettingsService{[a47_0x11b1bf(0x1fd)](_0x4a120f){const _0x29baab=a47_0x11b1bf;if(!_0x4a120f)return'';if(_0x4a120f[_0x29baab(0x224)]<=0x8)return _0x4a120f;const _0xec8477=_0x4a120f['substring'](0x0,0x8),_0x5a8a73='*'[_0x29baab(0x223)](Math['max'](0x0,_0x4a120f[_0x29baab(0x224)]-0x8));return _0xec8477+_0x5a8a73;}[a47_0x11b1bf(0x1f4)](_0x5482e1){const _0x2b9839=a47_0x11b1bf;if(!_0x5482e1)return[];if(Array['isArray'](_0x5482e1))return _0x5482e1;if(typeof _0x5482e1===_0x2b9839(0x214))try{const _0xaa6c54=JSON[_0x2b9839(0x20f)](_0x5482e1);return Array['isArray'](_0xaa6c54)?_0xaa6c54:[];}catch{return[];}return[];}async[a47_0x11b1bf(0x211)](_0xa9b346){const _0x7eb14e=a47_0x11b1bf,_0x2e8eee=await database_1['default'][_0x7eb14e(0x20c)][_0x7eb14e(0x21f)]({'where':{'id':_0xa9b346},'include':{'settings':!![]}});if(!_0x2e8eee)throw new Error(_0x7eb14e(0x215));let _0x4b9f51=_0x2e8eee[_0x7eb14e(0x20a)];return!_0x4b9f51&&(_0x4b9f51=await database_1['default'][_0x7eb14e(0x229)]['create']({'data':{'shopId':_0x2e8eee['id']}})),{'fullName':_0x2e8eee['name'],'brand':_0x2e8eee['name'],'merchantUrl':_0x2e8eee['shopUrl'],'telegramUsername':_0x2e8eee['telegram'],'telegramBotApiKey':_0x4b9f51['telegramBotApiKey']?this[_0x7eb14e(0x1fd)](_0x4b9f51['telegramBotApiKey']):null,'telegramChatId':_0x4b9f51['telegramChatId'],'webhookUrl':_0x4b9f51[_0x7eb14e(0x22b)],'webhookEvents':this['parseWebhookEvents'](_0x4b9f51[_0x7eb14e(0x205)]),'notifications':{'payment_success':_0x4b9f51[_0x7eb14e(0x228)],'payment_failed':_0x4b9f51[_0x7eb14e(0x225)],'refund':_0x4b9f51[_0x7eb14e(0x21c)],'payout':_0x4b9f51[_0x7eb14e(0x1fc)],'login':_0x4b9f51[_0x7eb14e(0x210)],'api_error':_0x4b9f51[_0x7eb14e(0x219)]}};}async[a47_0x11b1bf(0x203)](_0xda6bc,_0x352bc0){const _0x59e0b7=a47_0x11b1bf,{currentPassword:_0x111e8c,newPassword:_0xb6fc91,confirmNewPassword:_0x11f5f9}=_0x352bc0;if(_0xb6fc91!==_0x11f5f9)throw new Error(_0x59e0b7(0x20d));if(_0xb6fc91['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x2851cc=await database_1[_0x59e0b7(0x20e)][_0x59e0b7(0x20c)]['findUnique']({'where':{'id':_0xda6bc},'select':{'password':!![]}});if(!_0x2851cc)throw new Error('Shop\x20not\x20found');const _0x2c4894=await bcryptjs_1[_0x59e0b7(0x20e)][_0x59e0b7(0x1fb)](_0x111e8c,_0x2851cc['password']);if(!_0x2c4894)throw new Error(_0x59e0b7(0x1f9));const _0x46e2b3=await bcryptjs_1[_0x59e0b7(0x20e)][_0x59e0b7(0x1ec)](_0xb6fc91,0xc);await database_1[_0x59e0b7(0x20e)][_0x59e0b7(0x20c)][_0x59e0b7(0x1f6)]({'where':{'id':_0xda6bc},'data':{'password':_0x46e2b3}});}async[a47_0x11b1bf(0x206)](_0x453203,_0x495e66){const _0x28282b=a47_0x11b1bf;await this['ensureSettingsExist'](_0x453203);const _0x164965={};_0x495e66[_0x28282b(0x1ed)]!==undefined&&(_0x164965['notificationPaymentSuccess']=_0x495e66['payment_success']),_0x495e66['payment_failed']!==undefined&&(_0x164965['notificationPaymentFailed']=_0x495e66[_0x28282b(0x209)]),_0x495e66['refund']!==undefined&&(_0x164965['notificationRefund']=_0x495e66[_0x28282b(0x1fa)]),_0x495e66['payout']!==undefined&&(_0x164965['notificationPayout']=_0x495e66[_0x28282b(0x221)]),_0x495e66['login']!==undefined&&(_0x164965[_0x28282b(0x210)]=_0x495e66[_0x28282b(0x201)]),_0x495e66[_0x28282b(0x21a)]!==undefined&&(_0x164965['notificationApiError']=_0x495e66[_0x28282b(0x21a)]),await database_1[_0x28282b(0x20e)][_0x28282b(0x229)][_0x28282b(0x1f6)]({'where':{'shopId':_0x453203},'data':_0x164965});}async[a47_0x11b1bf(0x202)](_0x48591f,_0x336abd){const _0x17b6b1=a47_0x11b1bf;await this[_0x17b6b1(0x1ff)](_0x48591f);const _0x17a3c4={};_0x336abd['botApiKey']!==undefined&&(_0x17a3c4[_0x17b6b1(0x1ee)]=_0x336abd[_0x17b6b1(0x20b)]||null),_0x336abd[_0x17b6b1(0x222)]!==undefined&&(_0x17a3c4[_0x17b6b1(0x1f0)]=_0x336abd['chatId']||null),await database_1[_0x17b6b1(0x20e)][_0x17b6b1(0x229)]['update']({'where':{'shopId':_0x48591f},'data':_0x17a3c4});}async[a47_0x11b1bf(0x208)](_0x1f2340,_0xdaa823){const _0x102c5e=a47_0x11b1bf;await this[_0x102c5e(0x1ff)](_0x1f2340);const _0x26108e={};_0xdaa823['webhookUrl']!==undefined&&(_0x26108e['webhookUrl']=_0xdaa823[_0x102c5e(0x22b)]||null),_0xdaa823[_0x102c5e(0x205)]!==undefined&&(_0x26108e[_0x102c5e(0x205)]=_0xdaa823[_0x102c5e(0x205)]||[]),await database_1['default'][_0x102c5e(0x229)][_0x102c5e(0x1f6)]({'where':{'shopId':_0x1f2340},'data':_0x26108e});}async[a47_0x11b1bf(0x22c)](_0x708188){const _0x412b26=a47_0x11b1bf,_0x4aaf92=_0x412b26(0x212)+crypto_1['default'][_0x412b26(0x217)](0x20)[_0x412b26(0x21d)](_0x412b26(0x1f3)),_0x539850=_0x412b26(0x1f8)+crypto_1[_0x412b26(0x20e)]['randomBytes'](0x20)[_0x412b26(0x21d)](_0x412b26(0x1f3));await database_1['default'][_0x412b26(0x20c)]['update']({'where':{'id':_0x708188},'data':{'publicKey':_0x4aaf92,'secretKey':_0x539850}});}async[a47_0x11b1bf(0x200)](_0x5c88aa,_0x1f9e78){const _0x17d54f=a47_0x11b1bf,{passwordConfirmation:_0xd2e392}=_0x1f9e78,_0x50999f=await database_1[_0x17d54f(0x20e)][_0x17d54f(0x20c)][_0x17d54f(0x21f)]({'where':{'id':_0x5c88aa},'select':{'password':!![]}});if(!_0x50999f)throw new Error(_0x17d54f(0x215));const _0x5df43f=await bcryptjs_1[_0x17d54f(0x20e)]['compare'](_0xd2e392,_0x50999f['password']);if(!_0x5df43f)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x17d54f(0x20e)][_0x17d54f(0x20c)][_0x17d54f(0x227)]({'where':{'id':_0x5c88aa}});}async[a47_0x11b1bf(0x1ff)](_0x56e146){const _0x854b4a=a47_0x11b1bf,_0x5d9a20=await database_1[_0x854b4a(0x20e)][_0x854b4a(0x229)][_0x854b4a(0x21f)]({'where':{'shopId':_0x56e146}});!_0x5d9a20&&await database_1[_0x854b4a(0x20e)][_0x854b4a(0x229)][_0x854b4a(0x226)]({'data':{'shopId':_0x56e146}});}}exports['SettingsService']=SettingsService;