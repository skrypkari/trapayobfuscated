'use strict';const a50_0x28a04c=a50_0x1dde;function a50_0x1dde(_0x5d90e6,_0x4dc991){const _0x2c72c5=a50_0x2c72();return a50_0x1dde=function(_0x1ddea8,_0x4e8f67){_0x1ddea8=_0x1ddea8-0xc8;let _0x540e41=_0x2c72c5[_0x1ddea8];return _0x540e41;},a50_0x1dde(_0x5d90e6,_0x4dc991);}(function(_0x1a36ac,_0x5548ed){const _0xf74ba9=a50_0x1dde,_0x283bee=_0x1a36ac();while(!![]){try{const _0x4a7fea=parseInt(_0xf74ba9(0x108))/0x1*(-parseInt(_0xf74ba9(0xd0))/0x2)+parseInt(_0xf74ba9(0xf1))/0x3*(parseInt(_0xf74ba9(0xe8))/0x4)+-parseInt(_0xf74ba9(0xce))/0x5*(-parseInt(_0xf74ba9(0x102))/0x6)+-parseInt(_0xf74ba9(0x110))/0x7*(-parseInt(_0xf74ba9(0xf7))/0x8)+parseInt(_0xf74ba9(0xe7))/0x9*(parseInt(_0xf74ba9(0x100))/0xa)+-parseInt(_0xf74ba9(0xdc))/0xb*(parseInt(_0xf74ba9(0xd9))/0xc)+parseInt(_0xf74ba9(0xde))/0xd*(-parseInt(_0xf74ba9(0xdd))/0xe);if(_0x4a7fea===_0x5548ed)break;else _0x283bee['push'](_0x283bee['shift']());}catch(_0x59bb57){_0x283bee['push'](_0x283bee['shift']());}}}(a50_0x2c72,0xc95c6));function a50_0x2c72(){const _0x41bccb=['3fnOAde','telegram','isArray','Shop\x20not\x20found','getShopSettings','repeat','8GKTVBH','create','notificationRefund','settings','string','ensureSettingsExist','findUnique','hash','default','871870JcNmKc','telegramBotApiKey','4884918Avykke','shop','toString','delete','updateNotifications','shopSettings','1UQdCQU','hex','botApiKey','name','parseWebhookEvents','notificationPayout','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','Password\x20confirmation\x20is\x20incorrect','4500559UJsbkM','payment_failed','webhookUrl','crypto','notificationPaymentFailed','notificationLogin','substring','10ZgMArJ','updateWebhookSettings','2472234TJqBsB','password','api_error','login','deleteAccount','defineProperty','SettingsService','max','__importDefault','252qscMRa','update','pk_','751091RmlIxZ','5390658Tfezsu','13xlWKJX','changePassword','webhookEvents','shopUrl','randomBytes','compare','length','telegramChatId','../config/database','27ZdoeBX','5388140pyCciW','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','sk_','notificationPaymentSuccess','maskApiKey','payout','updateTelegramSettings','__esModule','notificationApiError'];a50_0x2c72=function(){return _0x41bccb;};return a50_0x2c72();}var __importDefault=this&&this[a50_0x28a04c(0xd8)]||function(_0x58d87f){const _0x1325e5=a50_0x28a04c;return _0x58d87f&&_0x58d87f[_0x1325e5(0xef)]?_0x58d87f:{'default':_0x58d87f};};Object[a50_0x28a04c(0xd5)](exports,a50_0x28a04c(0xef),{'value':!![]}),exports[a50_0x28a04c(0xd6)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a50_0x28a04c(0xca))),database_1=__importDefault(require(a50_0x28a04c(0xe6)));class SettingsService{[a50_0x28a04c(0xec)](_0xb81c49){const _0x1f909c=a50_0x28a04c;if(!_0xb81c49)return'';if(_0xb81c49[_0x1f909c(0xe4)]<=0x8)return _0xb81c49;const _0x4c5fba=_0xb81c49[_0x1f909c(0xcd)](0x0,0x8),_0xd40379='*'[_0x1f909c(0xf6)](Math[_0x1f909c(0xd7)](0x0,_0xb81c49[_0x1f909c(0xe4)]-0x8));return _0x4c5fba+_0xd40379;}[a50_0x28a04c(0x10c)](_0x3d2d9f){const _0x1c737a=a50_0x28a04c;if(!_0x3d2d9f)return[];if(Array[_0x1c737a(0xf3)](_0x3d2d9f))return _0x3d2d9f;if(typeof _0x3d2d9f===_0x1c737a(0xfb))try{const _0xde0bc6=JSON['parse'](_0x3d2d9f);return Array[_0x1c737a(0xf3)](_0xde0bc6)?_0xde0bc6:[];}catch{return[];}return[];}async[a50_0x28a04c(0xf5)](_0x3eba27){const _0x4ab25b=a50_0x28a04c,_0x3c13a5=await database_1['default']['shop'][_0x4ab25b(0xfd)]({'where':{'id':_0x3eba27},'include':{'settings':!![]}});if(!_0x3c13a5)throw new Error(_0x4ab25b(0xf4));let _0x261670=_0x3c13a5[_0x4ab25b(0xfa)];return!_0x261670&&(_0x261670=await database_1[_0x4ab25b(0xff)][_0x4ab25b(0x107)][_0x4ab25b(0xf8)]({'data':{'shopId':_0x3c13a5['id']}})),{'fullName':_0x3c13a5[_0x4ab25b(0x10b)],'brand':_0x3c13a5['name'],'merchantUrl':_0x3c13a5[_0x4ab25b(0xe1)],'telegramUsername':_0x3c13a5[_0x4ab25b(0xf2)],'telegramBotApiKey':_0x261670[_0x4ab25b(0x101)]?this[_0x4ab25b(0xec)](_0x261670[_0x4ab25b(0x101)]):null,'telegramChatId':_0x261670[_0x4ab25b(0xe5)],'webhookUrl':_0x261670[_0x4ab25b(0xc9)],'webhookEvents':this[_0x4ab25b(0x10c)](_0x261670[_0x4ab25b(0xe0)]),'notifications':{'payment_success':_0x261670[_0x4ab25b(0xeb)],'payment_failed':_0x261670[_0x4ab25b(0xcb)],'refund':_0x261670[_0x4ab25b(0xf9)],'payout':_0x261670[_0x4ab25b(0x10d)],'login':_0x261670[_0x4ab25b(0xcc)],'api_error':_0x261670['notificationApiError']}};}async[a50_0x28a04c(0xdf)](_0x286437,_0x289b1a){const _0x15d6e8=a50_0x28a04c,{currentPassword:_0xb2c598,newPassword:_0x453bb8,confirmNewPassword:_0x2eb4ef}=_0x289b1a;if(_0x453bb8!==_0x2eb4ef)throw new Error(_0x15d6e8(0xe9));if(_0x453bb8[_0x15d6e8(0xe4)]<0x6)throw new Error(_0x15d6e8(0x10e));const _0x24aa9b=await database_1[_0x15d6e8(0xff)][_0x15d6e8(0x103)]['findUnique']({'where':{'id':_0x286437},'select':{'password':!![]}});if(!_0x24aa9b)throw new Error(_0x15d6e8(0xf4));const _0x37d7f=await bcryptjs_1[_0x15d6e8(0xff)][_0x15d6e8(0xe3)](_0xb2c598,_0x24aa9b[_0x15d6e8(0xd1)]);if(!_0x37d7f)throw new Error('Current\x20password\x20is\x20incorrect');const _0xb6efb4=await bcryptjs_1[_0x15d6e8(0xff)][_0x15d6e8(0xfe)](_0x453bb8,0xc);await database_1['default'][_0x15d6e8(0x103)][_0x15d6e8(0xda)]({'where':{'id':_0x286437},'data':{'password':_0xb6efb4}});}async[a50_0x28a04c(0x106)](_0xd5dd42,_0x1705ab){const _0x756bc1=a50_0x28a04c;await this[_0x756bc1(0xfc)](_0xd5dd42);const _0x245964={};_0x1705ab['payment_success']!==undefined&&(_0x245964[_0x756bc1(0xeb)]=_0x1705ab['payment_success']),_0x1705ab[_0x756bc1(0xc8)]!==undefined&&(_0x245964['notificationPaymentFailed']=_0x1705ab[_0x756bc1(0xc8)]),_0x1705ab['refund']!==undefined&&(_0x245964[_0x756bc1(0xf9)]=_0x1705ab['refund']),_0x1705ab['payout']!==undefined&&(_0x245964['notificationPayout']=_0x1705ab[_0x756bc1(0xed)]),_0x1705ab[_0x756bc1(0xd3)]!==undefined&&(_0x245964['notificationLogin']=_0x1705ab[_0x756bc1(0xd3)]),_0x1705ab['api_error']!==undefined&&(_0x245964[_0x756bc1(0xf0)]=_0x1705ab[_0x756bc1(0xd2)]),await database_1[_0x756bc1(0xff)][_0x756bc1(0x107)][_0x756bc1(0xda)]({'where':{'shopId':_0xd5dd42},'data':_0x245964});}async[a50_0x28a04c(0xee)](_0x50d769,_0x541c7b){const _0x24bdc3=a50_0x28a04c;await this['ensureSettingsExist'](_0x50d769);const _0x22bf55={};_0x541c7b[_0x24bdc3(0x10a)]!==undefined&&(_0x22bf55['telegramBotApiKey']=_0x541c7b[_0x24bdc3(0x10a)]||null),_0x541c7b['chatId']!==undefined&&(_0x22bf55[_0x24bdc3(0xe5)]=_0x541c7b['chatId']||null),await database_1[_0x24bdc3(0xff)]['shopSettings'][_0x24bdc3(0xda)]({'where':{'shopId':_0x50d769},'data':_0x22bf55});}async[a50_0x28a04c(0xcf)](_0x2c8ccb,_0xa333b7){const _0x262cbb=a50_0x28a04c;await this[_0x262cbb(0xfc)](_0x2c8ccb);const _0x4fd697={};_0xa333b7[_0x262cbb(0xc9)]!==undefined&&(_0x4fd697['webhookUrl']=_0xa333b7[_0x262cbb(0xc9)]||null),_0xa333b7[_0x262cbb(0xe0)]!==undefined&&(_0x4fd697['webhookEvents']=_0xa333b7['webhookEvents']||[]),await database_1[_0x262cbb(0xff)][_0x262cbb(0x107)][_0x262cbb(0xda)]({'where':{'shopId':_0x2c8ccb},'data':_0x4fd697});}async['revokeAllApiKeys'](_0x2c307f){const _0x287887=a50_0x28a04c,_0x578826=_0x287887(0xdb)+crypto_1[_0x287887(0xff)]['randomBytes'](0x20)[_0x287887(0x104)](_0x287887(0x109)),_0x5a90e5=_0x287887(0xea)+crypto_1[_0x287887(0xff)][_0x287887(0xe2)](0x20)['toString'](_0x287887(0x109));await database_1['default'][_0x287887(0x103)][_0x287887(0xda)]({'where':{'id':_0x2c307f},'data':{'publicKey':_0x578826,'secretKey':_0x5a90e5}});}async[a50_0x28a04c(0xd4)](_0x2722f8,_0x218e9c){const _0x52cd9f=a50_0x28a04c,{passwordConfirmation:_0x1258cf}=_0x218e9c,_0x146889=await database_1[_0x52cd9f(0xff)]['shop'][_0x52cd9f(0xfd)]({'where':{'id':_0x2722f8},'select':{'password':!![]}});if(!_0x146889)throw new Error(_0x52cd9f(0xf4));const _0x42da63=await bcryptjs_1['default'][_0x52cd9f(0xe3)](_0x1258cf,_0x146889[_0x52cd9f(0xd1)]);if(!_0x42da63)throw new Error(_0x52cd9f(0x10f));await database_1['default'][_0x52cd9f(0x103)][_0x52cd9f(0x105)]({'where':{'id':_0x2722f8}});}async[a50_0x28a04c(0xfc)](_0x16bcc3){const _0x3892a6=a50_0x28a04c,_0x2f996d=await database_1[_0x3892a6(0xff)]['shopSettings'][_0x3892a6(0xfd)]({'where':{'shopId':_0x16bcc3}});!_0x2f996d&&await database_1[_0x3892a6(0xff)][_0x3892a6(0x107)][_0x3892a6(0xf8)]({'data':{'shopId':_0x16bcc3}});}}exports[a50_0x28a04c(0xd6)]=SettingsService;