'use strict';const a51_0x17a74a=a51_0xaec5;(function(_0x1d75d1,_0x4d7c3a){const _0x2604b6=a51_0xaec5,_0x44e11a=_0x1d75d1();while(!![]){try{const _0x5a2a3f=parseInt(_0x2604b6(0x1f5))/0x1*(-parseInt(_0x2604b6(0x1ce))/0x2)+parseInt(_0x2604b6(0x1e9))/0x3+-parseInt(_0x2604b6(0x1fe))/0x4+parseInt(_0x2604b6(0x1e8))/0x5+parseInt(_0x2604b6(0x1d9))/0x6*(parseInt(_0x2604b6(0x1fc))/0x7)+-parseInt(_0x2604b6(0x1f1))/0x8+parseInt(_0x2604b6(0x1d5))/0x9*(parseInt(_0x2604b6(0x1df))/0xa);if(_0x5a2a3f===_0x4d7c3a)break;else _0x44e11a['push'](_0x44e11a['shift']());}catch(_0x124e76){_0x44e11a['push'](_0x44e11a['shift']());}}}(a51_0x21d0,0x7f6a5));function a51_0xaec5(_0x1f0787,_0x16fb48){const _0x21d0a0=a51_0x21d0();return a51_0xaec5=function(_0xaec522,_0x129a2f){_0xaec522=_0xaec522-0x1c5;let _0x44f56e=_0x21d0a0[_0xaec522];return _0x44f56e;},a51_0xaec5(_0x1f0787,_0x16fb48);}function a51_0x21d0(){const _0x2dcf95=['payout','telegram','bcryptjs','update','findUnique','hex','notificationApiError','3097416TDUFnT','updateTelegramSettings','getShopSettings','parseWebhookEvents','1AQasMl','deleteAccount','create','notificationPaymentFailed','Password\x20confirmation\x20is\x20incorrect','notificationPayout','length','7srFbpr','shop','1285332ohruPe','hash','__importDefault','randomBytes','Shop\x20not\x20found','max','delete','webhookUrl','api_error','ensureSettingsExist','compare','notificationPaymentSuccess','name','default','1016454cNwHnj','botApiKey','notificationRefund','login','crypto','telegramChatId','notificationLogin','245889AvBqOy','sk_','webhookEvents','payment_failed','2867574YXkToh','shopSettings','payment_success','isArray','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','SettingsService','410TKtkiW','substring','refund','parse','maskApiKey','updateWebhookSettings','telegramBotApiKey','chatId','password','324350qDboGx','227010IxiEWU'];a51_0x21d0=function(){return _0x2dcf95;};return a51_0x21d0();}var __importDefault=this&&this[a51_0x17a74a(0x200)]||function(_0x3da1fd){return _0x3da1fd&&_0x3da1fd['__esModule']?_0x3da1fd:{'default':_0x3da1fd};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a51_0x17a74a(0x1de)]=void 0x0;const bcryptjs_1=__importDefault(require(a51_0x17a74a(0x1ec))),crypto_1=__importDefault(require(a51_0x17a74a(0x1d2))),database_1=__importDefault(require('../config/database'));class SettingsService{[a51_0x17a74a(0x1e3)](_0x104e4a){const _0x480a17=a51_0x17a74a;if(!_0x104e4a)return'';if(_0x104e4a[_0x480a17(0x1fb)]<=0x8)return _0x104e4a;const _0x3322dc=_0x104e4a[_0x480a17(0x1e0)](0x0,0x8),_0x4c5ba9='*'['repeat'](Math[_0x480a17(0x1c5)](0x0,_0x104e4a[_0x480a17(0x1fb)]-0x8));return _0x3322dc+_0x4c5ba9;}[a51_0x17a74a(0x1f4)](_0xccd5e9){const _0x38f064=a51_0x17a74a;if(!_0xccd5e9)return[];if(Array[_0x38f064(0x1dc)](_0xccd5e9))return _0xccd5e9;if(typeof _0xccd5e9==='string')try{const _0x83e0a=JSON[_0x38f064(0x1e2)](_0xccd5e9);return Array[_0x38f064(0x1dc)](_0x83e0a)?_0x83e0a:[];}catch{return[];}return[];}async[a51_0x17a74a(0x1f3)](_0x39e507){const _0x1e65c3=a51_0x17a74a,_0x4fb65d=await database_1[_0x1e65c3(0x1cd)][_0x1e65c3(0x1fd)][_0x1e65c3(0x1ee)]({'where':{'id':_0x39e507},'include':{'settings':!![]}});if(!_0x4fb65d)throw new Error(_0x1e65c3(0x202));let _0x1016c4=_0x4fb65d['settings'];return!_0x1016c4&&(_0x1016c4=await database_1[_0x1e65c3(0x1cd)]['shopSettings'][_0x1e65c3(0x1f7)]({'data':{'shopId':_0x4fb65d['id']}})),{'fullName':_0x4fb65d[_0x1e65c3(0x1cc)],'brand':_0x4fb65d[_0x1e65c3(0x1cc)],'merchantUrl':_0x4fb65d['shopUrl'],'telegramUsername':_0x4fb65d[_0x1e65c3(0x1eb)],'telegramBotApiKey':_0x1016c4[_0x1e65c3(0x1e5)]?this[_0x1e65c3(0x1e3)](_0x1016c4['telegramBotApiKey']):null,'telegramChatId':_0x1016c4['telegramChatId'],'webhookUrl':_0x1016c4[_0x1e65c3(0x1c7)],'webhookEvents':this[_0x1e65c3(0x1f4)](_0x1016c4[_0x1e65c3(0x1d7)]),'notifications':{'payment_success':_0x1016c4['notificationPaymentSuccess'],'payment_failed':_0x1016c4['notificationPaymentFailed'],'refund':_0x1016c4[_0x1e65c3(0x1d0)],'payout':_0x1016c4[_0x1e65c3(0x1fa)],'login':_0x1016c4[_0x1e65c3(0x1d4)],'api_error':_0x1016c4[_0x1e65c3(0x1f0)]}};}async['changePassword'](_0x356838,_0xd23510){const _0x18aecb=a51_0x17a74a,{currentPassword:_0x253420,newPassword:_0xedab31,confirmNewPassword:_0x4c1a76}=_0xd23510;if(_0xedab31!==_0x4c1a76)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0xedab31[_0x18aecb(0x1fb)]<0x6)throw new Error(_0x18aecb(0x1dd));const _0x4979b4=await database_1['default'][_0x18aecb(0x1fd)]['findUnique']({'where':{'id':_0x356838},'select':{'password':!![]}});if(!_0x4979b4)throw new Error(_0x18aecb(0x202));const _0x12f0db=await bcryptjs_1[_0x18aecb(0x1cd)][_0x18aecb(0x1ca)](_0x253420,_0x4979b4[_0x18aecb(0x1e7)]);if(!_0x12f0db)throw new Error('Current\x20password\x20is\x20incorrect');const _0x2a4a1a=await bcryptjs_1[_0x18aecb(0x1cd)][_0x18aecb(0x1ff)](_0xedab31,0xc);await database_1[_0x18aecb(0x1cd)][_0x18aecb(0x1fd)]['update']({'where':{'id':_0x356838},'data':{'password':_0x2a4a1a}});}async['updateNotifications'](_0x59a7b2,_0x54a540){const _0xb1de2=a51_0x17a74a;await this[_0xb1de2(0x1c9)](_0x59a7b2);const _0x412967={};_0x54a540[_0xb1de2(0x1db)]!==undefined&&(_0x412967[_0xb1de2(0x1cb)]=_0x54a540[_0xb1de2(0x1db)]),_0x54a540[_0xb1de2(0x1d8)]!==undefined&&(_0x412967[_0xb1de2(0x1f8)]=_0x54a540[_0xb1de2(0x1d8)]),_0x54a540[_0xb1de2(0x1e1)]!==undefined&&(_0x412967[_0xb1de2(0x1d0)]=_0x54a540[_0xb1de2(0x1e1)]),_0x54a540[_0xb1de2(0x1ea)]!==undefined&&(_0x412967['notificationPayout']=_0x54a540['payout']),_0x54a540[_0xb1de2(0x1d1)]!==undefined&&(_0x412967[_0xb1de2(0x1d4)]=_0x54a540[_0xb1de2(0x1d1)]),_0x54a540[_0xb1de2(0x1c8)]!==undefined&&(_0x412967[_0xb1de2(0x1f0)]=_0x54a540[_0xb1de2(0x1c8)]),await database_1[_0xb1de2(0x1cd)][_0xb1de2(0x1da)][_0xb1de2(0x1ed)]({'where':{'shopId':_0x59a7b2},'data':_0x412967});}async[a51_0x17a74a(0x1f2)](_0x31c593,_0x54dbf6){const _0x34aee0=a51_0x17a74a;await this[_0x34aee0(0x1c9)](_0x31c593);const _0x4faa4a={};_0x54dbf6[_0x34aee0(0x1cf)]!==undefined&&(_0x4faa4a[_0x34aee0(0x1e5)]=_0x54dbf6[_0x34aee0(0x1cf)]||null),_0x54dbf6[_0x34aee0(0x1e6)]!==undefined&&(_0x4faa4a[_0x34aee0(0x1d3)]=_0x54dbf6[_0x34aee0(0x1e6)]||null),await database_1[_0x34aee0(0x1cd)][_0x34aee0(0x1da)][_0x34aee0(0x1ed)]({'where':{'shopId':_0x31c593},'data':_0x4faa4a});}async[a51_0x17a74a(0x1e4)](_0x107526,_0x9b55e4){const _0x3bba91=a51_0x17a74a;await this[_0x3bba91(0x1c9)](_0x107526);const _0x320f7e={};_0x9b55e4[_0x3bba91(0x1c7)]!==undefined&&(_0x320f7e[_0x3bba91(0x1c7)]=_0x9b55e4[_0x3bba91(0x1c7)]||null),_0x9b55e4[_0x3bba91(0x1d7)]!==undefined&&(_0x320f7e[_0x3bba91(0x1d7)]=_0x9b55e4['webhookEvents']||[]),await database_1[_0x3bba91(0x1cd)][_0x3bba91(0x1da)]['update']({'where':{'shopId':_0x107526},'data':_0x320f7e});}async['revokeAllApiKeys'](_0x316d60){const _0x135376=a51_0x17a74a,_0x4b61c0='pk_'+crypto_1[_0x135376(0x1cd)]['randomBytes'](0x20)['toString'](_0x135376(0x1ef)),_0x58ceb8=_0x135376(0x1d6)+crypto_1[_0x135376(0x1cd)][_0x135376(0x201)](0x20)['toString'](_0x135376(0x1ef));await database_1['default'][_0x135376(0x1fd)][_0x135376(0x1ed)]({'where':{'id':_0x316d60},'data':{'publicKey':_0x4b61c0,'secretKey':_0x58ceb8}});}async[a51_0x17a74a(0x1f6)](_0x31e640,_0x387868){const _0x89a713=a51_0x17a74a,{passwordConfirmation:_0x4ed05c}=_0x387868,_0x3e87c6=await database_1[_0x89a713(0x1cd)][_0x89a713(0x1fd)][_0x89a713(0x1ee)]({'where':{'id':_0x31e640},'select':{'password':!![]}});if(!_0x3e87c6)throw new Error(_0x89a713(0x202));const _0x4c2644=await bcryptjs_1[_0x89a713(0x1cd)][_0x89a713(0x1ca)](_0x4ed05c,_0x3e87c6[_0x89a713(0x1e7)]);if(!_0x4c2644)throw new Error(_0x89a713(0x1f9));await database_1[_0x89a713(0x1cd)][_0x89a713(0x1fd)][_0x89a713(0x1c6)]({'where':{'id':_0x31e640}});}async['ensureSettingsExist'](_0x486af3){const _0x1a9545=a51_0x17a74a,_0x356512=await database_1[_0x1a9545(0x1cd)][_0x1a9545(0x1da)][_0x1a9545(0x1ee)]({'where':{'shopId':_0x486af3}});!_0x356512&&await database_1[_0x1a9545(0x1cd)][_0x1a9545(0x1da)][_0x1a9545(0x1f7)]({'data':{'shopId':_0x486af3}});}}exports[a51_0x17a74a(0x1de)]=SettingsService;