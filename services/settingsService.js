'use strict';function a61_0x4438(_0x4b41ac,_0x38268f){const _0x541945=a61_0x5419();return a61_0x4438=function(_0x443814,_0x550a6c){_0x443814=_0x443814-0xb3;let _0x1958b3=_0x541945[_0x443814];return _0x1958b3;},a61_0x4438(_0x4b41ac,_0x38268f);}const a61_0x31efde=a61_0x4438;(function(_0x4e7ac1,_0x381ecd){const _0x46d580=a61_0x4438,_0x2ce6cb=_0x4e7ac1();while(!![]){try{const _0x5d8591=parseInt(_0x46d580(0xc0))/0x1*(parseInt(_0x46d580(0xb3))/0x2)+parseInt(_0x46d580(0xb5))/0x3+parseInt(_0x46d580(0xe7))/0x4*(parseInt(_0x46d580(0xc2))/0x5)+-parseInt(_0x46d580(0xd1))/0x6+-parseInt(_0x46d580(0xd2))/0x7*(parseInt(_0x46d580(0xc4))/0x8)+parseInt(_0x46d580(0xc9))/0x9*(parseInt(_0x46d580(0xf1))/0xa)+parseInt(_0x46d580(0xde))/0xb*(parseInt(_0x46d580(0xd6))/0xc);if(_0x5d8591===_0x381ecd)break;else _0x2ce6cb['push'](_0x2ce6cb['shift']());}catch(_0x358545){_0x2ce6cb['push'](_0x2ce6cb['shift']());}}}(a61_0x5419,0x7ae96));var __importDefault=this&&this[a61_0x31efde(0xcb)]||function(_0x17f116){const _0x3832b3=a61_0x31efde;return _0x17f116&&_0x17f116[_0x3832b3(0xb7)]?_0x17f116:{'default':_0x17f116};};Object['defineProperty'](exports,a61_0x31efde(0xb7),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a61_0x31efde(0xe4))),database_1=__importDefault(require(a61_0x31efde(0xcc)));class SettingsService{[a61_0x31efde(0xe9)](_0x22ced0){const _0x336604=a61_0x31efde;if(!_0x22ced0)return'';if(_0x22ced0[_0x336604(0xf2)]<=0x8)return _0x22ced0;const _0x332f9a=_0x22ced0['substring'](0x0,0x8),_0x5418e7='*'['repeat'](Math[_0x336604(0xea)](0x0,_0x22ced0[_0x336604(0xf2)]-0x8));return _0x332f9a+_0x5418e7;}['parseWebhookEvents'](_0x49fa81){const _0xc08cbd=a61_0x31efde;if(!_0x49fa81)return[];if(Array[_0xc08cbd(0xe2)](_0x49fa81))return _0x49fa81;if(typeof _0x49fa81===_0xc08cbd(0xf6))try{const _0x30b40c=JSON[_0xc08cbd(0xe6)](_0x49fa81);return Array[_0xc08cbd(0xe2)](_0x30b40c)?_0x30b40c:[];}catch{return[];}return[];}async[a61_0x31efde(0xd4)](_0x5e4556){const _0x5b0f82=a61_0x31efde,_0x230873=await database_1['default'][_0x5b0f82(0xe1)][_0x5b0f82(0xbd)]({'where':{'id':_0x5e4556},'include':{'settings':!![]}});if(!_0x230873)throw new Error(_0x5b0f82(0xcf));let _0x5d7476=_0x230873[_0x5b0f82(0xc1)];return!_0x5d7476&&(_0x5d7476=await database_1[_0x5b0f82(0xc6)][_0x5b0f82(0xca)]['create']({'data':{'shopId':_0x230873['id']}})),{'fullName':_0x230873[_0x5b0f82(0xf0)],'brand':_0x230873['name'],'merchantUrl':_0x230873[_0x5b0f82(0xd5)],'telegramUsername':_0x230873[_0x5b0f82(0xba)],'telegramBotApiKey':_0x5d7476[_0x5b0f82(0xe8)]?this['maskApiKey'](_0x5d7476[_0x5b0f82(0xe8)]):null,'telegramChatId':_0x5d7476['telegramChatId'],'webhookUrl':_0x5d7476[_0x5b0f82(0xbe)],'webhookEvents':this['parseWebhookEvents'](_0x5d7476[_0x5b0f82(0xbf)]),'notifications':{'payment_success':_0x5d7476['notificationPaymentSuccess'],'payment_failed':_0x5d7476['notificationPaymentFailed'],'refund':_0x5d7476['notificationRefund'],'payout':_0x5d7476[_0x5b0f82(0xbb)],'login':_0x5d7476[_0x5b0f82(0xda)],'api_error':_0x5d7476[_0x5b0f82(0xf7)]}};}async[a61_0x31efde(0xd0)](_0x27f883,_0x28a7a5){const _0x4e305e=a61_0x31efde,{currentPassword:_0x22197c,newPassword:_0x4765a6,confirmNewPassword:_0x4b0952}=_0x28a7a5;if(_0x4765a6!==_0x4b0952)throw new Error(_0x4e305e(0xc5));if(_0x4765a6['length']<0x6)throw new Error(_0x4e305e(0xbc));const _0x48fa64=await database_1['default'][_0x4e305e(0xe1)][_0x4e305e(0xbd)]({'where':{'id':_0x27f883},'select':{'password':!![]}});if(!_0x48fa64)throw new Error(_0x4e305e(0xcf));const _0x101f43=await bcryptjs_1[_0x4e305e(0xc6)][_0x4e305e(0xe5)](_0x22197c,_0x48fa64[_0x4e305e(0xce)]);if(!_0x101f43)throw new Error(_0x4e305e(0xd7));const _0x304be9=await bcryptjs_1[_0x4e305e(0xc6)][_0x4e305e(0xef)](_0x4765a6,0xc);await database_1[_0x4e305e(0xc6)][_0x4e305e(0xe1)]['update']({'where':{'id':_0x27f883},'data':{'password':_0x304be9}});}async[a61_0x31efde(0xeb)](_0x3c3689,_0x4bf754){const _0x3c6c24=a61_0x31efde;await this[_0x3c6c24(0xb9)](_0x3c3689);const _0x2ef068={};_0x4bf754[_0x3c6c24(0xd8)]!==undefined&&(_0x2ef068[_0x3c6c24(0xf3)]=_0x4bf754[_0x3c6c24(0xd8)]),_0x4bf754['payment_failed']!==undefined&&(_0x2ef068['notificationPaymentFailed']=_0x4bf754['payment_failed']),_0x4bf754[_0x3c6c24(0xf5)]!==undefined&&(_0x2ef068[_0x3c6c24(0xec)]=_0x4bf754[_0x3c6c24(0xf5)]),_0x4bf754[_0x3c6c24(0xcd)]!==undefined&&(_0x2ef068['notificationPayout']=_0x4bf754[_0x3c6c24(0xcd)]),_0x4bf754[_0x3c6c24(0xdd)]!==undefined&&(_0x2ef068[_0x3c6c24(0xda)]=_0x4bf754[_0x3c6c24(0xdd)]),_0x4bf754[_0x3c6c24(0xe0)]!==undefined&&(_0x2ef068[_0x3c6c24(0xf7)]=_0x4bf754[_0x3c6c24(0xe0)]),await database_1[_0x3c6c24(0xc6)][_0x3c6c24(0xca)][_0x3c6c24(0xed)]({'where':{'shopId':_0x3c3689},'data':_0x2ef068});}async['updateTelegramSettings'](_0x3f94c4,_0x343598){const _0x19f9e4=a61_0x31efde;await this[_0x19f9e4(0xb9)](_0x3f94c4);const _0xb86295={};_0x343598['botApiKey']!==undefined&&(_0xb86295['telegramBotApiKey']=_0x343598[_0x19f9e4(0xdf)]||null),_0x343598[_0x19f9e4(0xdb)]!==undefined&&(_0xb86295[_0x19f9e4(0xd3)]=_0x343598['chatId']||null),await database_1[_0x19f9e4(0xc6)]['shopSettings'][_0x19f9e4(0xed)]({'where':{'shopId':_0x3f94c4},'data':_0xb86295});}async[a61_0x31efde(0xc3)](_0x361d38,_0x4f2f5a){const _0xe145e8=a61_0x31efde;await this[_0xe145e8(0xb9)](_0x361d38);const _0x4a8aca={};_0x4f2f5a['webhookUrl']!==undefined&&(_0x4a8aca[_0xe145e8(0xbe)]=_0x4f2f5a[_0xe145e8(0xbe)]||null),_0x4f2f5a[_0xe145e8(0xbf)]!==undefined&&(_0x4a8aca['webhookEvents']=_0x4f2f5a['webhookEvents']||[]),await database_1[_0xe145e8(0xc6)]['shopSettings'][_0xe145e8(0xed)]({'where':{'shopId':_0x361d38},'data':_0x4a8aca});}async[a61_0x31efde(0xc8)](_0x1e0e86){const _0x3d1887=a61_0x31efde,_0x37836=_0x3d1887(0xb6)+crypto_1[_0x3d1887(0xc6)][_0x3d1887(0xb4)](0x20)[_0x3d1887(0xdc)](_0x3d1887(0xe3)),_0x1796f8=_0x3d1887(0xee)+crypto_1['default'][_0x3d1887(0xb4)](0x20)[_0x3d1887(0xdc)](_0x3d1887(0xe3));await database_1[_0x3d1887(0xc6)][_0x3d1887(0xe1)][_0x3d1887(0xed)]({'where':{'id':_0x1e0e86},'data':{'publicKey':_0x37836,'secretKey':_0x1796f8}});}async['deleteAccount'](_0x30f263,_0x183cd4){const _0x5134c0=a61_0x31efde,{passwordConfirmation:_0x4d49cd}=_0x183cd4,_0x58ff1c=await database_1['default']['shop']['findUnique']({'where':{'id':_0x30f263},'select':{'password':!![]}});if(!_0x58ff1c)throw new Error('Shop\x20not\x20found');const _0x2b4823=await bcryptjs_1['default'][_0x5134c0(0xe5)](_0x4d49cd,_0x58ff1c['password']);if(!_0x2b4823)throw new Error(_0x5134c0(0xf4));await database_1[_0x5134c0(0xc6)]['shop'][_0x5134c0(0xc7)]({'where':{'id':_0x30f263}});}async[a61_0x31efde(0xb9)](_0x442552){const _0x6f5dd8=a61_0x31efde,_0x12e045=await database_1[_0x6f5dd8(0xc6)][_0x6f5dd8(0xca)][_0x6f5dd8(0xbd)]({'where':{'shopId':_0x442552}});!_0x12e045&&await database_1[_0x6f5dd8(0xc6)][_0x6f5dd8(0xca)][_0x6f5dd8(0xb8)]({'data':{'shopId':_0x442552}});}}exports[a61_0x31efde(0xd9)]=SettingsService;function a61_0x5419(){const _0x269cc0=['create','ensureSettingsExist','telegram','notificationPayout','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','findUnique','webhookUrl','webhookEvents','13xgunqu','settings','849865XoSvLO','updateWebhookSettings','48ggwPaD','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','default','delete','revokeAllApiKeys','81018XNYvyX','shopSettings','__importDefault','../config/database','payout','password','Shop\x20not\x20found','changePassword','178518OxjSbp','838789PKzWPE','telegramChatId','getShopSettings','shopUrl','36DxsGya','Current\x20password\x20is\x20incorrect','payment_success','SettingsService','notificationLogin','chatId','toString','login','631048RCSsdB','botApiKey','api_error','shop','isArray','hex','crypto','compare','parse','4XvDNWB','telegramBotApiKey','maskApiKey','max','updateNotifications','notificationRefund','update','sk_','hash','name','510lCyFlV','length','notificationPaymentSuccess','Password\x20confirmation\x20is\x20incorrect','refund','string','notificationApiError','18376HOHjmh','randomBytes','994614glnKNE','pk_','__esModule'];a61_0x5419=function(){return _0x269cc0;};return a61_0x5419();}