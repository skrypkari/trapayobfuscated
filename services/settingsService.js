'use strict';const a57_0x59d9a0=a57_0x1d07;(function(_0x2c3716,_0x2e30bd){const _0x587cfe=a57_0x1d07,_0x2943dd=_0x2c3716();while(!![]){try{const _0x3b87e6=parseInt(_0x587cfe(0xc3))/0x1*(-parseInt(_0x587cfe(0xe1))/0x2)+-parseInt(_0x587cfe(0xb9))/0x3+-parseInt(_0x587cfe(0xbd))/0x4+-parseInt(_0x587cfe(0xcd))/0x5+-parseInt(_0x587cfe(0xd7))/0x6*(parseInt(_0x587cfe(0xba))/0x7)+-parseInt(_0x587cfe(0xb5))/0x8+-parseInt(_0x587cfe(0xc5))/0x9*(-parseInt(_0x587cfe(0xe5))/0xa);if(_0x3b87e6===_0x2e30bd)break;else _0x2943dd['push'](_0x2943dd['shift']());}catch(_0x4cbe6c){_0x2943dd['push'](_0x2943dd['shift']());}}}(a57_0x6bc5,0x18bba));var __importDefault=this&&this[a57_0x59d9a0(0xa9)]||function(_0x62b272){const _0x1c5c80=a57_0x59d9a0;return _0x62b272&&_0x62b272[_0x1c5c80(0xb8)]?_0x62b272:{'default':_0x62b272};};Object[a57_0x59d9a0(0xbf)](exports,a57_0x59d9a0(0xb8),{'value':!![]}),exports['SettingsService']=void 0x0;function a57_0x1d07(_0x4e4de8,_0x393e27){const _0x6bc566=a57_0x6bc5();return a57_0x1d07=function(_0x1d0782,_0x4b81b6){_0x1d0782=_0x1d0782-0xa8;let _0x46a4e4=_0x6bc566[_0x1d0782];return _0x46a4e4;},a57_0x1d07(_0x4e4de8,_0x393e27);}function a57_0x6bc5(){const _0x115cd8=['329070ykdJRd','webhookEvents','api_error','725024sUQXDb','password','defineProperty','notificationPaymentFailed','ensureSettingsExist','maskApiKey','15643OKkkES','notificationRefund','98370FmiEiV','settings','getShopSettings','findUnique','telegramBotApiKey','changePassword','bcryptjs','notificationLogin','135725Ejjphv','compare','updateTelegramSettings','create','../config/database','hash','delete','payment_success','payout','crypto','18mUSPZB','parseWebhookEvents','telegram','telegramChatId','chatId','string','shopUrl','notificationPayout','toString','max','12qJXYcv','deleteAccount','refund','shop','760OLXUak','name','notificationApiError','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','randomBytes','isArray','Shop\x20not\x20found','update','shopSettings','__importDefault','hex','parse','botApiKey','Current\x20password\x20is\x20incorrect','default','notificationPaymentSuccess','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','webhookUrl','substring','Password\x20confirmation\x20is\x20incorrect','login','728304HFIRQe','length','SettingsService','__esModule','585141KgsqHd'];a57_0x6bc5=function(){return _0x115cd8;};return a57_0x6bc5();}const bcryptjs_1=__importDefault(require(a57_0x59d9a0(0xcb))),crypto_1=__importDefault(require(a57_0x59d9a0(0xd6))),database_1=__importDefault(require(a57_0x59d9a0(0xd1)));class SettingsService{[a57_0x59d9a0(0xc2)](_0x578b53){const _0x49af5e=a57_0x59d9a0;if(!_0x578b53)return'';if(_0x578b53[_0x49af5e(0xb6)]<=0x8)return _0x578b53;const _0x772266=_0x578b53[_0x49af5e(0xb2)](0x0,0x8),_0x346c3f='*'['repeat'](Math[_0x49af5e(0xe0)](0x0,_0x578b53['length']-0x8));return _0x772266+_0x346c3f;}['parseWebhookEvents'](_0x1fa501){const _0x1d26f8=a57_0x59d9a0;if(!_0x1fa501)return[];if(Array[_0x1d26f8(0xea)](_0x1fa501))return _0x1fa501;if(typeof _0x1fa501===_0x1d26f8(0xdc))try{const _0x52a545=JSON[_0x1d26f8(0xab)](_0x1fa501);return Array[_0x1d26f8(0xea)](_0x52a545)?_0x52a545:[];}catch{return[];}return[];}async[a57_0x59d9a0(0xc7)](_0x388e6){const _0xc544cb=a57_0x59d9a0,_0x49997e=await database_1[_0xc544cb(0xae)][_0xc544cb(0xe4)]['findUnique']({'where':{'id':_0x388e6},'include':{'settings':!![]}});if(!_0x49997e)throw new Error(_0xc544cb(0xeb));let _0x591a3a=_0x49997e[_0xc544cb(0xc6)];return!_0x591a3a&&(_0x591a3a=await database_1[_0xc544cb(0xae)][_0xc544cb(0xa8)][_0xc544cb(0xd0)]({'data':{'shopId':_0x49997e['id']}})),{'fullName':_0x49997e[_0xc544cb(0xe6)],'brand':_0x49997e['name'],'merchantUrl':_0x49997e[_0xc544cb(0xdd)],'telegramUsername':_0x49997e[_0xc544cb(0xd9)],'telegramBotApiKey':_0x591a3a[_0xc544cb(0xc9)]?this[_0xc544cb(0xc2)](_0x591a3a[_0xc544cb(0xc9)]):null,'telegramChatId':_0x591a3a[_0xc544cb(0xda)],'webhookUrl':_0x591a3a[_0xc544cb(0xb1)],'webhookEvents':this[_0xc544cb(0xd8)](_0x591a3a[_0xc544cb(0xbb)]),'notifications':{'payment_success':_0x591a3a['notificationPaymentSuccess'],'payment_failed':_0x591a3a[_0xc544cb(0xc0)],'refund':_0x591a3a['notificationRefund'],'payout':_0x591a3a['notificationPayout'],'login':_0x591a3a[_0xc544cb(0xcc)],'api_error':_0x591a3a[_0xc544cb(0xe7)]}};}async[a57_0x59d9a0(0xca)](_0x5f4e86,_0x2c637d){const _0x2ea1fa=a57_0x59d9a0,{currentPassword:_0x8965be,newPassword:_0x4abb84,confirmNewPassword:_0x193574}=_0x2c637d;if(_0x4abb84!==_0x193574)throw new Error(_0x2ea1fa(0xb0));if(_0x4abb84[_0x2ea1fa(0xb6)]<0x6)throw new Error(_0x2ea1fa(0xe8));const _0x3e6173=await database_1[_0x2ea1fa(0xae)][_0x2ea1fa(0xe4)][_0x2ea1fa(0xc8)]({'where':{'id':_0x5f4e86},'select':{'password':!![]}});if(!_0x3e6173)throw new Error(_0x2ea1fa(0xeb));const _0x5295c3=await bcryptjs_1[_0x2ea1fa(0xae)]['compare'](_0x8965be,_0x3e6173['password']);if(!_0x5295c3)throw new Error(_0x2ea1fa(0xad));const _0x20e026=await bcryptjs_1[_0x2ea1fa(0xae)][_0x2ea1fa(0xd2)](_0x4abb84,0xc);await database_1[_0x2ea1fa(0xae)]['shop'][_0x2ea1fa(0xec)]({'where':{'id':_0x5f4e86},'data':{'password':_0x20e026}});}async['updateNotifications'](_0x2dd915,_0x1ca07a){const _0x1c3fd9=a57_0x59d9a0;await this[_0x1c3fd9(0xc1)](_0x2dd915);const _0x21c41f={};_0x1ca07a[_0x1c3fd9(0xd4)]!==undefined&&(_0x21c41f[_0x1c3fd9(0xaf)]=_0x1ca07a[_0x1c3fd9(0xd4)]),_0x1ca07a['payment_failed']!==undefined&&(_0x21c41f[_0x1c3fd9(0xc0)]=_0x1ca07a['payment_failed']),_0x1ca07a[_0x1c3fd9(0xe3)]!==undefined&&(_0x21c41f[_0x1c3fd9(0xc4)]=_0x1ca07a[_0x1c3fd9(0xe3)]),_0x1ca07a[_0x1c3fd9(0xd5)]!==undefined&&(_0x21c41f[_0x1c3fd9(0xde)]=_0x1ca07a[_0x1c3fd9(0xd5)]),_0x1ca07a['login']!==undefined&&(_0x21c41f['notificationLogin']=_0x1ca07a[_0x1c3fd9(0xb4)]),_0x1ca07a[_0x1c3fd9(0xbc)]!==undefined&&(_0x21c41f[_0x1c3fd9(0xe7)]=_0x1ca07a[_0x1c3fd9(0xbc)]),await database_1['default']['shopSettings']['update']({'where':{'shopId':_0x2dd915},'data':_0x21c41f});}async[a57_0x59d9a0(0xcf)](_0xc20a47,_0x439961){const _0x1201af=a57_0x59d9a0;await this[_0x1201af(0xc1)](_0xc20a47);const _0x4ee5fc={};_0x439961[_0x1201af(0xac)]!==undefined&&(_0x4ee5fc[_0x1201af(0xc9)]=_0x439961['botApiKey']||null),_0x439961['chatId']!==undefined&&(_0x4ee5fc[_0x1201af(0xda)]=_0x439961[_0x1201af(0xdb)]||null),await database_1[_0x1201af(0xae)][_0x1201af(0xa8)][_0x1201af(0xec)]({'where':{'shopId':_0xc20a47},'data':_0x4ee5fc});}async['updateWebhookSettings'](_0x3b0c6d,_0x19d392){const _0x122dff=a57_0x59d9a0;await this['ensureSettingsExist'](_0x3b0c6d);const _0x4bf729={};_0x19d392[_0x122dff(0xb1)]!==undefined&&(_0x4bf729[_0x122dff(0xb1)]=_0x19d392[_0x122dff(0xb1)]||null),_0x19d392['webhookEvents']!==undefined&&(_0x4bf729[_0x122dff(0xbb)]=_0x19d392[_0x122dff(0xbb)]||[]),await database_1[_0x122dff(0xae)][_0x122dff(0xa8)][_0x122dff(0xec)]({'where':{'shopId':_0x3b0c6d},'data':_0x4bf729});}async['revokeAllApiKeys'](_0x23ea8f){const _0x2efd87=a57_0x59d9a0,_0x65a209='pk_'+crypto_1[_0x2efd87(0xae)][_0x2efd87(0xe9)](0x20)[_0x2efd87(0xdf)](_0x2efd87(0xaa)),_0x515b5b='sk_'+crypto_1[_0x2efd87(0xae)]['randomBytes'](0x20)['toString'](_0x2efd87(0xaa));await database_1[_0x2efd87(0xae)]['shop'][_0x2efd87(0xec)]({'where':{'id':_0x23ea8f},'data':{'publicKey':_0x65a209,'secretKey':_0x515b5b}});}async[a57_0x59d9a0(0xe2)](_0x45f68c,_0x1b6b47){const _0x32d120=a57_0x59d9a0,{passwordConfirmation:_0x401ce}=_0x1b6b47,_0xe3675b=await database_1[_0x32d120(0xae)][_0x32d120(0xe4)]['findUnique']({'where':{'id':_0x45f68c},'select':{'password':!![]}});if(!_0xe3675b)throw new Error(_0x32d120(0xeb));const _0x5bb457=await bcryptjs_1['default'][_0x32d120(0xce)](_0x401ce,_0xe3675b[_0x32d120(0xbe)]);if(!_0x5bb457)throw new Error(_0x32d120(0xb3));await database_1[_0x32d120(0xae)][_0x32d120(0xe4)][_0x32d120(0xd3)]({'where':{'id':_0x45f68c}});}async[a57_0x59d9a0(0xc1)](_0x35983a){const _0x18cc3a=a57_0x59d9a0,_0x19c0d5=await database_1[_0x18cc3a(0xae)][_0x18cc3a(0xa8)][_0x18cc3a(0xc8)]({'where':{'shopId':_0x35983a}});!_0x19c0d5&&await database_1['default'][_0x18cc3a(0xa8)][_0x18cc3a(0xd0)]({'data':{'shopId':_0x35983a}});}}exports[a57_0x59d9a0(0xb7)]=SettingsService;