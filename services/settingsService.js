'use strict';const a53_0x2f9f02=a53_0x4aa0;(function(_0x101d0e,_0x4f620d){const _0x1a9388=a53_0x4aa0,_0x12c600=_0x101d0e();while(!![]){try{const _0x500d19=parseInt(_0x1a9388(0x20f))/0x1*(parseInt(_0x1a9388(0x1f7))/0x2)+-parseInt(_0x1a9388(0x1d3))/0x3*(-parseInt(_0x1a9388(0x1f4))/0x4)+parseInt(_0x1a9388(0x1ec))/0x5*(-parseInt(_0x1a9388(0x1f3))/0x6)+-parseInt(_0x1a9388(0x1d8))/0x7+-parseInt(_0x1a9388(0x1da))/0x8+parseInt(_0x1a9388(0x1cf))/0x9*(parseInt(_0x1a9388(0x1e8))/0xa)+-parseInt(_0x1a9388(0x1df))/0xb*(-parseInt(_0x1a9388(0x1ee))/0xc);if(_0x500d19===_0x4f620d)break;else _0x12c600['push'](_0x12c600['shift']());}catch(_0x27892c){_0x12c600['push'](_0x12c600['shift']());}}}(a53_0x29de,0xa15fa));function a53_0x4aa0(_0x471f93,_0xb8b0f){const _0x29dec7=a53_0x29de();return a53_0x4aa0=function(_0x4aa08d,_0x542730){_0x4aa08d=_0x4aa08d-0x1ce;let _0x5edb74=_0x29dec7[_0x4aa08d];return _0x5edb74;},a53_0x4aa0(_0x471f93,_0xb8b0f);}function a53_0x29de(){const _0x17d296=['max','settings','updateNotifications','defineProperty','webhookUrl','notificationPayout','notificationLogin','telegramChatId','refund','SettingsService','api_error','update','telegramBotApiKey','Shop\x20not\x20found','hash','login','pk_','__esModule','1vzUoGV','shopUrl','compare','delete','11435319rSlhvs','sk_','payment_success','default','6uvYCrk','shop','notificationApiError','length','payment_failed','9219749OkikQP','getShopSettings','6910440zXYTyx','chatId','maskApiKey','ensureSettingsExist','../config/database','1697036hkRBMu','revokeAllApiKeys','payout','parseWebhookEvents','repeat','deleteAccount','updateWebhookSettings','name','Current\x20password\x20is\x20incorrect','10ITFSXg','shopSettings','isArray','hex','10kaYguP','telegram','48Farsrz','randomBytes','updateTelegramSettings','webhookEvents','notificationPaymentFailed','1792542XdfpaJ','1869956JWtLSG','changePassword','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','1233478fxKIFF','password','findUnique','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','create','notificationPaymentSuccess'];a53_0x29de=function(){return _0x17d296;};return a53_0x29de();}var __importDefault=this&&this['__importDefault']||function(_0x1c2f09){const _0x50ef1e=a53_0x4aa0;return _0x1c2f09&&_0x1c2f09[_0x50ef1e(0x20e)]?_0x1c2f09:{'default':_0x1c2f09};};Object[a53_0x2f9f02(0x200)](exports,a53_0x2f9f02(0x20e),{'value':!![]}),exports[a53_0x2f9f02(0x206)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a53_0x2f9f02(0x1de)));class SettingsService{[a53_0x2f9f02(0x1dc)](_0x366bb2){const _0x297f1f=a53_0x2f9f02;if(!_0x366bb2)return'';if(_0x366bb2[_0x297f1f(0x1d6)]<=0x8)return _0x366bb2;const _0x44fde2=_0x366bb2['substring'](0x0,0x8),_0x466dc1='*'[_0x297f1f(0x1e3)](Math[_0x297f1f(0x1fd)](0x0,_0x366bb2[_0x297f1f(0x1d6)]-0x8));return _0x44fde2+_0x466dc1;}[a53_0x2f9f02(0x1e2)](_0x40a903){const _0x5c57cd=a53_0x2f9f02;if(!_0x40a903)return[];if(Array[_0x5c57cd(0x1ea)](_0x40a903))return _0x40a903;if(typeof _0x40a903==='string')try{const _0x4b8bed=JSON['parse'](_0x40a903);return Array['isArray'](_0x4b8bed)?_0x4b8bed:[];}catch{return[];}return[];}async[a53_0x2f9f02(0x1d9)](_0x317b4d){const _0x712823=a53_0x2f9f02,_0xd491ed=await database_1['default'][_0x712823(0x1d4)][_0x712823(0x1f9)]({'where':{'id':_0x317b4d},'include':{'settings':!![]}});if(!_0xd491ed)throw new Error('Shop\x20not\x20found');let _0x1bca4d=_0xd491ed[_0x712823(0x1fe)];return!_0x1bca4d&&(_0x1bca4d=await database_1[_0x712823(0x1d2)][_0x712823(0x1e9)][_0x712823(0x1fb)]({'data':{'shopId':_0xd491ed['id']}})),{'fullName':_0xd491ed[_0x712823(0x1e6)],'brand':_0xd491ed[_0x712823(0x1e6)],'merchantUrl':_0xd491ed[_0x712823(0x210)],'telegramUsername':_0xd491ed[_0x712823(0x1ed)],'telegramBotApiKey':_0x1bca4d[_0x712823(0x209)]?this[_0x712823(0x1dc)](_0x1bca4d['telegramBotApiKey']):null,'telegramChatId':_0x1bca4d['telegramChatId'],'webhookUrl':_0x1bca4d[_0x712823(0x201)],'webhookEvents':this[_0x712823(0x1e2)](_0x1bca4d['webhookEvents']),'notifications':{'payment_success':_0x1bca4d['notificationPaymentSuccess'],'payment_failed':_0x1bca4d['notificationPaymentFailed'],'refund':_0x1bca4d['notificationRefund'],'payout':_0x1bca4d['notificationPayout'],'login':_0x1bca4d[_0x712823(0x203)],'api_error':_0x1bca4d[_0x712823(0x1d5)]}};}async[a53_0x2f9f02(0x1f5)](_0x5a04e5,_0x3f0c30){const _0x77515a=a53_0x2f9f02,{currentPassword:_0x3a850b,newPassword:_0x549ac1,confirmNewPassword:_0x10fbe2}=_0x3f0c30;if(_0x549ac1!==_0x10fbe2)throw new Error(_0x77515a(0x1fa));if(_0x549ac1[_0x77515a(0x1d6)]<0x6)throw new Error(_0x77515a(0x1f6));const _0x423031=await database_1[_0x77515a(0x1d2)][_0x77515a(0x1d4)]['findUnique']({'where':{'id':_0x5a04e5},'select':{'password':!![]}});if(!_0x423031)throw new Error(_0x77515a(0x20a));const _0x338e75=await bcryptjs_1[_0x77515a(0x1d2)][_0x77515a(0x211)](_0x3a850b,_0x423031[_0x77515a(0x1f8)]);if(!_0x338e75)throw new Error(_0x77515a(0x1e7));const _0x1d59c9=await bcryptjs_1[_0x77515a(0x1d2)][_0x77515a(0x20b)](_0x549ac1,0xc);await database_1[_0x77515a(0x1d2)][_0x77515a(0x1d4)][_0x77515a(0x208)]({'where':{'id':_0x5a04e5},'data':{'password':_0x1d59c9}});}async[a53_0x2f9f02(0x1ff)](_0x55b68a,_0x47c83b){const _0x28140c=a53_0x2f9f02;await this[_0x28140c(0x1dd)](_0x55b68a);const _0x5b42df={};_0x47c83b[_0x28140c(0x1d1)]!==undefined&&(_0x5b42df[_0x28140c(0x1fc)]=_0x47c83b[_0x28140c(0x1d1)]),_0x47c83b[_0x28140c(0x1d7)]!==undefined&&(_0x5b42df[_0x28140c(0x1f2)]=_0x47c83b[_0x28140c(0x1d7)]),_0x47c83b[_0x28140c(0x205)]!==undefined&&(_0x5b42df['notificationRefund']=_0x47c83b[_0x28140c(0x205)]),_0x47c83b['payout']!==undefined&&(_0x5b42df[_0x28140c(0x202)]=_0x47c83b[_0x28140c(0x1e1)]),_0x47c83b[_0x28140c(0x20c)]!==undefined&&(_0x5b42df[_0x28140c(0x203)]=_0x47c83b['login']),_0x47c83b['api_error']!==undefined&&(_0x5b42df[_0x28140c(0x1d5)]=_0x47c83b[_0x28140c(0x207)]),await database_1['default']['shopSettings'][_0x28140c(0x208)]({'where':{'shopId':_0x55b68a},'data':_0x5b42df});}async[a53_0x2f9f02(0x1f0)](_0x239368,_0x4d9d70){const _0x3290f3=a53_0x2f9f02;await this[_0x3290f3(0x1dd)](_0x239368);const _0x485593={};_0x4d9d70['botApiKey']!==undefined&&(_0x485593['telegramBotApiKey']=_0x4d9d70['botApiKey']||null),_0x4d9d70[_0x3290f3(0x1db)]!==undefined&&(_0x485593[_0x3290f3(0x204)]=_0x4d9d70['chatId']||null),await database_1[_0x3290f3(0x1d2)][_0x3290f3(0x1e9)][_0x3290f3(0x208)]({'where':{'shopId':_0x239368},'data':_0x485593});}async[a53_0x2f9f02(0x1e5)](_0x5f02d2,_0x2e0012){const _0x15f187=a53_0x2f9f02;await this[_0x15f187(0x1dd)](_0x5f02d2);const _0x32ece1={};_0x2e0012[_0x15f187(0x201)]!==undefined&&(_0x32ece1['webhookUrl']=_0x2e0012[_0x15f187(0x201)]||null),_0x2e0012['webhookEvents']!==undefined&&(_0x32ece1[_0x15f187(0x1f1)]=_0x2e0012[_0x15f187(0x1f1)]||[]),await database_1[_0x15f187(0x1d2)][_0x15f187(0x1e9)]['update']({'where':{'shopId':_0x5f02d2},'data':_0x32ece1});}async[a53_0x2f9f02(0x1e0)](_0xb22a1f){const _0x59bca0=a53_0x2f9f02,_0x3a57ed=_0x59bca0(0x20d)+crypto_1[_0x59bca0(0x1d2)]['randomBytes'](0x20)['toString'](_0x59bca0(0x1eb)),_0x19aaba=_0x59bca0(0x1d0)+crypto_1['default'][_0x59bca0(0x1ef)](0x20)['toString'](_0x59bca0(0x1eb));await database_1[_0x59bca0(0x1d2)][_0x59bca0(0x1d4)]['update']({'where':{'id':_0xb22a1f},'data':{'publicKey':_0x3a57ed,'secretKey':_0x19aaba}});}async[a53_0x2f9f02(0x1e4)](_0x25a6e6,_0x4e3d73){const _0x4381c8=a53_0x2f9f02,{passwordConfirmation:_0x23842c}=_0x4e3d73,_0x2ce59e=await database_1['default'][_0x4381c8(0x1d4)][_0x4381c8(0x1f9)]({'where':{'id':_0x25a6e6},'select':{'password':!![]}});if(!_0x2ce59e)throw new Error(_0x4381c8(0x20a));const _0x1b4770=await bcryptjs_1[_0x4381c8(0x1d2)][_0x4381c8(0x211)](_0x23842c,_0x2ce59e[_0x4381c8(0x1f8)]);if(!_0x1b4770)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1['default']['shop'][_0x4381c8(0x1ce)]({'where':{'id':_0x25a6e6}});}async[a53_0x2f9f02(0x1dd)](_0x7f7cc1){const _0x3a97f3=a53_0x2f9f02,_0x7a2960=await database_1[_0x3a97f3(0x1d2)]['shopSettings'][_0x3a97f3(0x1f9)]({'where':{'shopId':_0x7f7cc1}});!_0x7a2960&&await database_1[_0x3a97f3(0x1d2)][_0x3a97f3(0x1e9)][_0x3a97f3(0x1fb)]({'data':{'shopId':_0x7f7cc1}});}}exports[a53_0x2f9f02(0x206)]=SettingsService;