'use strict';function a52_0x1f20(_0xec4c0c,_0x310b44){const _0x1aafde=a52_0x1aaf();return a52_0x1f20=function(_0x1f20bf,_0x56db7e){_0x1f20bf=_0x1f20bf-0xe9;let _0x5afb78=_0x1aafde[_0x1f20bf];return _0x5afb78;},a52_0x1f20(_0xec4c0c,_0x310b44);}const a52_0x2e47c8=a52_0x1f20;function a52_0x1aaf(){const _0x4e4367=['shopUrl','Current\x20password\x20is\x20incorrect','Shop\x20not\x20found','payment_failed','toString','../config/database','SettingsService','telegram','hash','create','defineProperty','Password\x20confirmation\x20is\x20incorrect','notificationPaymentSuccess','notificationRefund','4990GtcuQM','maskApiKey','default','findUnique','parseWebhookEvents','refund','api_error','22ZgNhug','payout','length','chatId','changePassword','192eepkvh','deleteAccount','pk_','notificationPayout','string','telegramBotApiKey','settings','116301VBcyiX','6280260iMztri','3605754kIeCNs','notificationLogin','__importDefault','shopSettings','sk_','3763342wVyrjn','9YEVCKr','telegramChatId','crypto','login','isArray','webhookUrl','update','__esModule','10yhiwNS','compare','repeat','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','updateTelegramSettings','notificationPaymentFailed','2888872njFrsx','name','parse','notificationApiError','7QLOHnT','randomBytes','getShopSettings','ensureSettingsExist','delete','webhookEvents','max','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','updateNotifications','886554Zmgdof','revokeAllApiKeys','shop','substring','password'];a52_0x1aaf=function(){return _0x4e4367;};return a52_0x1aaf();}(function(_0x453ea0,_0x5069f5){const _0x42960d=a52_0x1f20,_0x5c23eb=_0x453ea0();while(!![]){try{const _0x30cad0=parseInt(_0x42960d(0x10a))/0x1+parseInt(_0x42960d(0x124))/0x2*(parseInt(_0x42960d(0x130))/0x3)+-parseInt(_0x42960d(0x129))/0x4*(-parseInt(_0x42960d(0x11d))/0x5)+parseInt(_0x42960d(0xe9))/0x6*(-parseInt(_0x42960d(0x101))/0x7)+-parseInt(_0x42960d(0xfd))/0x8*(parseInt(_0x42960d(0xef))/0x9)+-parseInt(_0x42960d(0xf7))/0xa*(parseInt(_0x42960d(0xee))/0xb)+parseInt(_0x42960d(0x131))/0xc;if(_0x30cad0===_0x5069f5)break;else _0x5c23eb['push'](_0x5c23eb['shift']());}catch(_0x5d7e2e){_0x5c23eb['push'](_0x5c23eb['shift']());}}}(a52_0x1aaf,0x8d9dc));var __importDefault=this&&this[a52_0x2e47c8(0xeb)]||function(_0x27291e){const _0x5884b3=a52_0x2e47c8;return _0x27291e&&_0x27291e[_0x5884b3(0xf6)]?_0x27291e:{'default':_0x27291e};};Object[a52_0x2e47c8(0x119)](exports,'__esModule',{'value':!![]}),exports[a52_0x2e47c8(0x115)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a52_0x2e47c8(0xf1))),database_1=__importDefault(require(a52_0x2e47c8(0x114)));class SettingsService{[a52_0x2e47c8(0x11e)](_0x5383c8){const _0x3323ed=a52_0x2e47c8;if(!_0x5383c8)return'';if(_0x5383c8[_0x3323ed(0x126)]<=0x8)return _0x5383c8;const _0x1b2ad1=_0x5383c8[_0x3323ed(0x10d)](0x0,0x8),_0x124b10='*'[_0x3323ed(0xf9)](Math[_0x3323ed(0x107)](0x0,_0x5383c8[_0x3323ed(0x126)]-0x8));return _0x1b2ad1+_0x124b10;}[a52_0x2e47c8(0x121)](_0x27a3fa){const _0x50858f=a52_0x2e47c8;if(!_0x27a3fa)return[];if(Array[_0x50858f(0xf3)](_0x27a3fa))return _0x27a3fa;if(typeof _0x27a3fa===_0x50858f(0x12d))try{const _0x5a5583=JSON[_0x50858f(0xff)](_0x27a3fa);return Array[_0x50858f(0xf3)](_0x5a5583)?_0x5a5583:[];}catch{return[];}return[];}async[a52_0x2e47c8(0x103)](_0x19738b){const _0x3031b2=a52_0x2e47c8,_0x5b5698=await database_1[_0x3031b2(0x11f)][_0x3031b2(0x10c)][_0x3031b2(0x120)]({'where':{'id':_0x19738b},'include':{'settings':!![]}});if(!_0x5b5698)throw new Error(_0x3031b2(0x111));let _0x32fcdf=_0x5b5698[_0x3031b2(0x12f)];return!_0x32fcdf&&(_0x32fcdf=await database_1[_0x3031b2(0x11f)][_0x3031b2(0xec)][_0x3031b2(0x118)]({'data':{'shopId':_0x5b5698['id']}})),{'fullName':_0x5b5698[_0x3031b2(0xfe)],'brand':_0x5b5698[_0x3031b2(0xfe)],'merchantUrl':_0x5b5698[_0x3031b2(0x10f)],'telegramUsername':_0x5b5698[_0x3031b2(0x116)],'telegramBotApiKey':_0x32fcdf[_0x3031b2(0x12e)]?this[_0x3031b2(0x11e)](_0x32fcdf[_0x3031b2(0x12e)]):null,'telegramChatId':_0x32fcdf['telegramChatId'],'webhookUrl':_0x32fcdf[_0x3031b2(0xf4)],'webhookEvents':this[_0x3031b2(0x121)](_0x32fcdf['webhookEvents']),'notifications':{'payment_success':_0x32fcdf[_0x3031b2(0x11b)],'payment_failed':_0x32fcdf[_0x3031b2(0xfc)],'refund':_0x32fcdf[_0x3031b2(0x11c)],'payout':_0x32fcdf[_0x3031b2(0x12c)],'login':_0x32fcdf[_0x3031b2(0xea)],'api_error':_0x32fcdf[_0x3031b2(0x100)]}};}async[a52_0x2e47c8(0x128)](_0x5d063a,_0x1f2cb5){const _0xb9377f=a52_0x2e47c8,{currentPassword:_0x425084,newPassword:_0x42ab9d,confirmNewPassword:_0x463d20}=_0x1f2cb5;if(_0x42ab9d!==_0x463d20)throw new Error(_0xb9377f(0xfa));if(_0x42ab9d[_0xb9377f(0x126)]<0x6)throw new Error(_0xb9377f(0x108));const _0x3debf8=await database_1[_0xb9377f(0x11f)][_0xb9377f(0x10c)][_0xb9377f(0x120)]({'where':{'id':_0x5d063a},'select':{'password':!![]}});if(!_0x3debf8)throw new Error(_0xb9377f(0x111));const _0xc3e9fa=await bcryptjs_1[_0xb9377f(0x11f)][_0xb9377f(0xf8)](_0x425084,_0x3debf8[_0xb9377f(0x10e)]);if(!_0xc3e9fa)throw new Error(_0xb9377f(0x110));const _0x26a096=await bcryptjs_1[_0xb9377f(0x11f)][_0xb9377f(0x117)](_0x42ab9d,0xc);await database_1[_0xb9377f(0x11f)]['shop'][_0xb9377f(0xf5)]({'where':{'id':_0x5d063a},'data':{'password':_0x26a096}});}async[a52_0x2e47c8(0x109)](_0x1545bb,_0x1f2808){const _0x16836d=a52_0x2e47c8;await this[_0x16836d(0x104)](_0x1545bb);const _0x55a86d={};_0x1f2808['payment_success']!==undefined&&(_0x55a86d[_0x16836d(0x11b)]=_0x1f2808['payment_success']),_0x1f2808[_0x16836d(0x112)]!==undefined&&(_0x55a86d['notificationPaymentFailed']=_0x1f2808[_0x16836d(0x112)]),_0x1f2808[_0x16836d(0x122)]!==undefined&&(_0x55a86d['notificationRefund']=_0x1f2808['refund']),_0x1f2808[_0x16836d(0x125)]!==undefined&&(_0x55a86d[_0x16836d(0x12c)]=_0x1f2808[_0x16836d(0x125)]),_0x1f2808[_0x16836d(0xf2)]!==undefined&&(_0x55a86d['notificationLogin']=_0x1f2808[_0x16836d(0xf2)]),_0x1f2808[_0x16836d(0x123)]!==undefined&&(_0x55a86d['notificationApiError']=_0x1f2808['api_error']),await database_1[_0x16836d(0x11f)][_0x16836d(0xec)][_0x16836d(0xf5)]({'where':{'shopId':_0x1545bb},'data':_0x55a86d});}async[a52_0x2e47c8(0xfb)](_0x325e23,_0x3ed792){const _0xaadf3c=a52_0x2e47c8;await this[_0xaadf3c(0x104)](_0x325e23);const _0x4ed104={};_0x3ed792['botApiKey']!==undefined&&(_0x4ed104[_0xaadf3c(0x12e)]=_0x3ed792['botApiKey']||null),_0x3ed792[_0xaadf3c(0x127)]!==undefined&&(_0x4ed104[_0xaadf3c(0xf0)]=_0x3ed792[_0xaadf3c(0x127)]||null),await database_1[_0xaadf3c(0x11f)][_0xaadf3c(0xec)]['update']({'where':{'shopId':_0x325e23},'data':_0x4ed104});}async['updateWebhookSettings'](_0x304364,_0x499202){const _0x5e8b64=a52_0x2e47c8;await this['ensureSettingsExist'](_0x304364);const _0x1e9fed={};_0x499202[_0x5e8b64(0xf4)]!==undefined&&(_0x1e9fed[_0x5e8b64(0xf4)]=_0x499202[_0x5e8b64(0xf4)]||null),_0x499202[_0x5e8b64(0x106)]!==undefined&&(_0x1e9fed['webhookEvents']=_0x499202[_0x5e8b64(0x106)]||[]),await database_1[_0x5e8b64(0x11f)][_0x5e8b64(0xec)][_0x5e8b64(0xf5)]({'where':{'shopId':_0x304364},'data':_0x1e9fed});}async[a52_0x2e47c8(0x10b)](_0x43d969){const _0x13714c=a52_0x2e47c8,_0x5e2573=_0x13714c(0x12b)+crypto_1[_0x13714c(0x11f)][_0x13714c(0x102)](0x20)[_0x13714c(0x113)]('hex'),_0x5bb998=_0x13714c(0xed)+crypto_1[_0x13714c(0x11f)][_0x13714c(0x102)](0x20)[_0x13714c(0x113)]('hex');await database_1[_0x13714c(0x11f)][_0x13714c(0x10c)][_0x13714c(0xf5)]({'where':{'id':_0x43d969},'data':{'publicKey':_0x5e2573,'secretKey':_0x5bb998}});}async[a52_0x2e47c8(0x12a)](_0x35ad4e,_0x20b951){const _0x3220a8=a52_0x2e47c8,{passwordConfirmation:_0x320513}=_0x20b951,_0x3fee79=await database_1[_0x3220a8(0x11f)][_0x3220a8(0x10c)]['findUnique']({'where':{'id':_0x35ad4e},'select':{'password':!![]}});if(!_0x3fee79)throw new Error(_0x3220a8(0x111));const _0x1ea5d7=await bcryptjs_1[_0x3220a8(0x11f)][_0x3220a8(0xf8)](_0x320513,_0x3fee79[_0x3220a8(0x10e)]);if(!_0x1ea5d7)throw new Error(_0x3220a8(0x11a));await database_1['default'][_0x3220a8(0x10c)][_0x3220a8(0x105)]({'where':{'id':_0x35ad4e}});}async[a52_0x2e47c8(0x104)](_0x4792e3){const _0x374b53=a52_0x2e47c8,_0x269daf=await database_1['default'][_0x374b53(0xec)]['findUnique']({'where':{'shopId':_0x4792e3}});!_0x269daf&&await database_1[_0x374b53(0x11f)][_0x374b53(0xec)][_0x374b53(0x118)]({'data':{'shopId':_0x4792e3}});}}exports[a52_0x2e47c8(0x115)]=SettingsService;