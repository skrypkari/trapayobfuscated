'use strict';function a57_0x102c(){const _0x1f7e95=['randomBytes','hex','repeat','1870149bAbwNM','notificationApiError','Shop\x20not\x20found','create','getShopSettings','__esModule','ensureSettingsExist','settings','findUnique','../config/database','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','parseWebhookEvents','shop','defineProperty','447015jdCSUH','notificationPayout','maskApiKey','updateWebhookSettings','botApiKey','password','revokeAllApiKeys','parse','7bzXcbp','payout','max','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','sk_','notificationPaymentFailed','changePassword','isArray','SettingsService','deleteAccount','3448974IJqZuu','chatId','update','pk_','hash','telegramBotApiKey','length','4QDkNzp','telegram','notificationLogin','toString','updateNotifications','payment_failed','shopUrl','webhookEvents','default','delete','payment_success','login','shopSettings','910898mrgIWC','Password\x20confirmation\x20is\x20incorrect','crypto','refund','webhookUrl','194168xBRlzd','__importDefault','notificationPaymentSuccess','10363860pYFMdt','notificationRefund','name','63xPDjCR','api_error','670804KglLTx'];a57_0x102c=function(){return _0x1f7e95;};return a57_0x102c();}function a57_0x418f(_0x534719,_0x1feb0f){const _0x102cfa=a57_0x102c();return a57_0x418f=function(_0x418f77,_0x4bbebc){_0x418f77=_0x418f77-0x151;let _0x33e627=_0x102cfa[_0x418f77];return _0x33e627;},a57_0x418f(_0x534719,_0x1feb0f);}const a57_0x401777=a57_0x418f;(function(_0x19dc51,_0x5c62d5){const _0x1e78f1=a57_0x418f,_0x3cbd25=_0x19dc51();while(!![]){try{const _0x2c2968=-parseInt(_0x1e78f1(0x18f))/0x1+parseInt(_0x1e78f1(0x157))/0x2+parseInt(_0x1e78f1(0x15b))/0x3*(parseInt(_0x1e78f1(0x182))/0x4)+-parseInt(_0x1e78f1(0x169))/0x5+parseInt(_0x1e78f1(0x17b))/0x6*(-parseInt(_0x1e78f1(0x171))/0x7)+-parseInt(_0x1e78f1(0x194))/0x8*(-parseInt(_0x1e78f1(0x155))/0x9)+parseInt(_0x1e78f1(0x152))/0xa;if(_0x2c2968===_0x5c62d5)break;else _0x3cbd25['push'](_0x3cbd25['shift']());}catch(_0x2f3617){_0x3cbd25['push'](_0x3cbd25['shift']());}}}(a57_0x102c,0x90072));var __importDefault=this&&this[a57_0x401777(0x195)]||function(_0x171086){const _0x6faf88=a57_0x401777;return _0x171086&&_0x171086[_0x6faf88(0x160)]?_0x171086:{'default':_0x171086};};Object[a57_0x401777(0x168)](exports,'__esModule',{'value':!![]}),exports[a57_0x401777(0x179)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a57_0x401777(0x191))),database_1=__importDefault(require(a57_0x401777(0x164)));class SettingsService{[a57_0x401777(0x16b)](_0x5a6c94){const _0x569bbe=a57_0x401777;if(!_0x5a6c94)return'';if(_0x5a6c94[_0x569bbe(0x181)]<=0x8)return _0x5a6c94;const _0x241b6f=_0x5a6c94['substring'](0x0,0x8),_0x1cafa1='*'[_0x569bbe(0x15a)](Math[_0x569bbe(0x173)](0x0,_0x5a6c94[_0x569bbe(0x181)]-0x8));return _0x241b6f+_0x1cafa1;}[a57_0x401777(0x166)](_0x2ee76a){const _0x47588c=a57_0x401777;if(!_0x2ee76a)return[];if(Array[_0x47588c(0x178)](_0x2ee76a))return _0x2ee76a;if(typeof _0x2ee76a==='string')try{const _0x528c9d=JSON[_0x47588c(0x170)](_0x2ee76a);return Array[_0x47588c(0x178)](_0x528c9d)?_0x528c9d:[];}catch{return[];}return[];}async[a57_0x401777(0x15f)](_0x2bf4c3){const _0x3d6f02=a57_0x401777,_0x31936c=await database_1[_0x3d6f02(0x18a)][_0x3d6f02(0x167)][_0x3d6f02(0x163)]({'where':{'id':_0x2bf4c3},'include':{'settings':!![]}});if(!_0x31936c)throw new Error('Shop\x20not\x20found');let _0x28fb24=_0x31936c[_0x3d6f02(0x162)];return!_0x28fb24&&(_0x28fb24=await database_1[_0x3d6f02(0x18a)][_0x3d6f02(0x18e)][_0x3d6f02(0x15e)]({'data':{'shopId':_0x31936c['id']}})),{'fullName':_0x31936c['name'],'brand':_0x31936c[_0x3d6f02(0x154)],'merchantUrl':_0x31936c[_0x3d6f02(0x188)],'telegramUsername':_0x31936c[_0x3d6f02(0x183)],'telegramBotApiKey':_0x28fb24[_0x3d6f02(0x180)]?this[_0x3d6f02(0x16b)](_0x28fb24[_0x3d6f02(0x180)]):null,'telegramChatId':_0x28fb24['telegramChatId'],'webhookUrl':_0x28fb24[_0x3d6f02(0x193)],'webhookEvents':this[_0x3d6f02(0x166)](_0x28fb24[_0x3d6f02(0x189)]),'notifications':{'payment_success':_0x28fb24[_0x3d6f02(0x151)],'payment_failed':_0x28fb24['notificationPaymentFailed'],'refund':_0x28fb24['notificationRefund'],'payout':_0x28fb24[_0x3d6f02(0x16a)],'login':_0x28fb24[_0x3d6f02(0x184)],'api_error':_0x28fb24[_0x3d6f02(0x15c)]}};}async[a57_0x401777(0x177)](_0x39881e,_0x2a521f){const _0xd0f917=a57_0x401777,{currentPassword:_0x512463,newPassword:_0x2d961e,confirmNewPassword:_0x3b3bbe}=_0x2a521f;if(_0x2d961e!==_0x3b3bbe)throw new Error(_0xd0f917(0x174));if(_0x2d961e['length']<0x6)throw new Error(_0xd0f917(0x165));const _0x4dad32=await database_1[_0xd0f917(0x18a)]['shop'][_0xd0f917(0x163)]({'where':{'id':_0x39881e},'select':{'password':!![]}});if(!_0x4dad32)throw new Error(_0xd0f917(0x15d));const _0x2aa593=await bcryptjs_1[_0xd0f917(0x18a)]['compare'](_0x512463,_0x4dad32[_0xd0f917(0x16e)]);if(!_0x2aa593)throw new Error('Current\x20password\x20is\x20incorrect');const _0x3f77ca=await bcryptjs_1[_0xd0f917(0x18a)][_0xd0f917(0x17f)](_0x2d961e,0xc);await database_1[_0xd0f917(0x18a)][_0xd0f917(0x167)]['update']({'where':{'id':_0x39881e},'data':{'password':_0x3f77ca}});}async[a57_0x401777(0x186)](_0x4a73a6,_0x86f6c0){const _0x38f892=a57_0x401777;await this[_0x38f892(0x161)](_0x4a73a6);const _0x2afd48={};_0x86f6c0[_0x38f892(0x18c)]!==undefined&&(_0x2afd48[_0x38f892(0x151)]=_0x86f6c0['payment_success']),_0x86f6c0[_0x38f892(0x187)]!==undefined&&(_0x2afd48[_0x38f892(0x176)]=_0x86f6c0['payment_failed']),_0x86f6c0[_0x38f892(0x192)]!==undefined&&(_0x2afd48[_0x38f892(0x153)]=_0x86f6c0[_0x38f892(0x192)]),_0x86f6c0[_0x38f892(0x172)]!==undefined&&(_0x2afd48['notificationPayout']=_0x86f6c0['payout']),_0x86f6c0[_0x38f892(0x18d)]!==undefined&&(_0x2afd48[_0x38f892(0x184)]=_0x86f6c0[_0x38f892(0x18d)]),_0x86f6c0[_0x38f892(0x156)]!==undefined&&(_0x2afd48[_0x38f892(0x15c)]=_0x86f6c0[_0x38f892(0x156)]),await database_1['default']['shopSettings']['update']({'where':{'shopId':_0x4a73a6},'data':_0x2afd48});}async['updateTelegramSettings'](_0x5ed966,_0x45f6b3){const _0x24dc93=a57_0x401777;await this[_0x24dc93(0x161)](_0x5ed966);const _0x416022={};_0x45f6b3[_0x24dc93(0x16d)]!==undefined&&(_0x416022['telegramBotApiKey']=_0x45f6b3[_0x24dc93(0x16d)]||null),_0x45f6b3[_0x24dc93(0x17c)]!==undefined&&(_0x416022['telegramChatId']=_0x45f6b3[_0x24dc93(0x17c)]||null),await database_1[_0x24dc93(0x18a)][_0x24dc93(0x18e)][_0x24dc93(0x17d)]({'where':{'shopId':_0x5ed966},'data':_0x416022});}async[a57_0x401777(0x16c)](_0x25ab5d,_0xfbba6b){const _0x379d91=a57_0x401777;await this[_0x379d91(0x161)](_0x25ab5d);const _0x3189f8={};_0xfbba6b[_0x379d91(0x193)]!==undefined&&(_0x3189f8['webhookUrl']=_0xfbba6b[_0x379d91(0x193)]||null),_0xfbba6b[_0x379d91(0x189)]!==undefined&&(_0x3189f8[_0x379d91(0x189)]=_0xfbba6b[_0x379d91(0x189)]||[]),await database_1[_0x379d91(0x18a)]['shopSettings'][_0x379d91(0x17d)]({'where':{'shopId':_0x25ab5d},'data':_0x3189f8});}async[a57_0x401777(0x16f)](_0x30efe6){const _0x225872=a57_0x401777,_0x21b18f=_0x225872(0x17e)+crypto_1[_0x225872(0x18a)][_0x225872(0x158)](0x20)[_0x225872(0x185)](_0x225872(0x159)),_0x1708eb=_0x225872(0x175)+crypto_1['default'][_0x225872(0x158)](0x20)[_0x225872(0x185)](_0x225872(0x159));await database_1['default']['shop'][_0x225872(0x17d)]({'where':{'id':_0x30efe6},'data':{'publicKey':_0x21b18f,'secretKey':_0x1708eb}});}async[a57_0x401777(0x17a)](_0x19ca55,_0x125375){const _0x2b619e=a57_0x401777,{passwordConfirmation:_0x12af29}=_0x125375,_0x5504bc=await database_1[_0x2b619e(0x18a)]['shop'][_0x2b619e(0x163)]({'where':{'id':_0x19ca55},'select':{'password':!![]}});if(!_0x5504bc)throw new Error(_0x2b619e(0x15d));const _0x50ab10=await bcryptjs_1[_0x2b619e(0x18a)]['compare'](_0x12af29,_0x5504bc[_0x2b619e(0x16e)]);if(!_0x50ab10)throw new Error(_0x2b619e(0x190));await database_1['default'][_0x2b619e(0x167)][_0x2b619e(0x18b)]({'where':{'id':_0x19ca55}});}async[a57_0x401777(0x161)](_0x124211){const _0xd6f85b=a57_0x401777,_0x569d44=await database_1[_0xd6f85b(0x18a)][_0xd6f85b(0x18e)][_0xd6f85b(0x163)]({'where':{'shopId':_0x124211}});!_0x569d44&&await database_1[_0xd6f85b(0x18a)][_0xd6f85b(0x18e)][_0xd6f85b(0x15e)]({'data':{'shopId':_0x124211}});}}exports['SettingsService']=SettingsService;