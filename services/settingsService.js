'use strict';const a47_0x64156b=a47_0x2e68;(function(_0x132ebd,_0x7b9ebf){const _0x3d973a=a47_0x2e68,_0x27abd8=_0x132ebd();while(!![]){try{const _0x428b9e=parseInt(_0x3d973a(0xf1))/0x1+parseInt(_0x3d973a(0xde))/0x2+parseInt(_0x3d973a(0xec))/0x3*(-parseInt(_0x3d973a(0xed))/0x4)+-parseInt(_0x3d973a(0xf2))/0x5*(-parseInt(_0x3d973a(0xfa))/0x6)+parseInt(_0x3d973a(0xdf))/0x7+parseInt(_0x3d973a(0x100))/0x8*(parseInt(_0x3d973a(0xe6))/0x9)+-parseInt(_0x3d973a(0xe8))/0xa*(parseInt(_0x3d973a(0xf7))/0xb);if(_0x428b9e===_0x7b9ebf)break;else _0x27abd8['push'](_0x27abd8['shift']());}catch(_0x80b228){_0x27abd8['push'](_0x27abd8['shift']());}}}(a47_0x1986,0xb0692));function a47_0x1986(){const _0x414413=['50LyVOtP','payment_failed','SettingsService','delete','45573TgTtia','160iwdqiI','deleteAccount','parseWebhookEvents','default','73409DdebyP','63770foLUJJ','api_error','botApiKey','notificationLogin','login','5973770nknXWz','password','maskApiKey','654hWtfZX','notificationPayout','webhookEvents','getShopSettings','length','notificationPaymentFailed','2154712izPgfR','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','telegramChatId','bcryptjs','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','updateWebhookSettings','max','compare','settings','updateNotifications','telegramBotApiKey','shopSettings','hex','notificationApiError','create','__importDefault','payout','../config/database','__esModule','defineProperty','string','refund','parse','notificationRefund','crypto','revokeAllApiKeys','isArray','Password\x20confirmation\x20is\x20incorrect','name','notificationPaymentSuccess','ensureSettingsExist','chatId','update','shop','2525584KwhjbT','7348894cLtXPX','webhookUrl','shopUrl','Shop\x20not\x20found','findUnique','substring','hash','9vyqkxm','payment_success'];a47_0x1986=function(){return _0x414413;};return a47_0x1986();}var __importDefault=this&&this[a47_0x64156b(0xcb)]||function(_0x357f26){return _0x357f26&&_0x357f26['__esModule']?_0x357f26:{'default':_0x357f26};};function a47_0x2e68(_0x2d670c,_0x156f8e){const _0x1986db=a47_0x1986();return a47_0x2e68=function(_0x2e68f4,_0x5048f8){_0x2e68f4=_0x2e68f4-0xc5;let _0x583829=_0x1986db[_0x2e68f4];return _0x583829;},a47_0x2e68(_0x2d670c,_0x156f8e);}Object[a47_0x64156b(0xcf)](exports,a47_0x64156b(0xce),{'value':!![]}),exports[a47_0x64156b(0xea)]=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x64156b(0x103))),crypto_1=__importDefault(require(a47_0x64156b(0xd4))),database_1=__importDefault(require(a47_0x64156b(0xcd)));class SettingsService{[a47_0x64156b(0xf9)](_0x14cdf7){const _0xf7fd7b=a47_0x64156b;if(!_0x14cdf7)return'';if(_0x14cdf7['length']<=0x8)return _0x14cdf7;const _0x37f61f=_0x14cdf7[_0xf7fd7b(0xe4)](0x0,0x8),_0x363ff5='*'['repeat'](Math[_0xf7fd7b(0x106)](0x0,_0x14cdf7['length']-0x8));return _0x37f61f+_0x363ff5;}[a47_0x64156b(0xef)](_0x236f09){const _0x5e9987=a47_0x64156b;if(!_0x236f09)return[];if(Array[_0x5e9987(0xd6)](_0x236f09))return _0x236f09;if(typeof _0x236f09===_0x5e9987(0xd0))try{const _0x513d5e=JSON[_0x5e9987(0xd2)](_0x236f09);return Array['isArray'](_0x513d5e)?_0x513d5e:[];}catch{return[];}return[];}async[a47_0x64156b(0xfd)](_0x2ed5ce){const _0x13a310=a47_0x64156b,_0xb934a=await database_1['default'][_0x13a310(0xdd)][_0x13a310(0xe3)]({'where':{'id':_0x2ed5ce},'include':{'settings':!![]}});if(!_0xb934a)throw new Error(_0x13a310(0xe2));let _0x267dc9=_0xb934a[_0x13a310(0x108)];return!_0x267dc9&&(_0x267dc9=await database_1[_0x13a310(0xf0)]['shopSettings'][_0x13a310(0xca)]({'data':{'shopId':_0xb934a['id']}})),{'fullName':_0xb934a[_0x13a310(0xd8)],'brand':_0xb934a[_0x13a310(0xd8)],'merchantUrl':_0xb934a[_0x13a310(0xe1)],'telegramUsername':_0xb934a['telegram'],'telegramBotApiKey':_0x267dc9['telegramBotApiKey']?this[_0x13a310(0xf9)](_0x267dc9[_0x13a310(0xc6)]):null,'telegramChatId':_0x267dc9[_0x13a310(0x102)],'webhookUrl':_0x267dc9[_0x13a310(0xe0)],'webhookEvents':this[_0x13a310(0xef)](_0x267dc9['webhookEvents']),'notifications':{'payment_success':_0x267dc9[_0x13a310(0xd9)],'payment_failed':_0x267dc9[_0x13a310(0xff)],'refund':_0x267dc9[_0x13a310(0xd3)],'payout':_0x267dc9[_0x13a310(0xfb)],'login':_0x267dc9[_0x13a310(0xf5)],'api_error':_0x267dc9[_0x13a310(0xc9)]}};}async['changePassword'](_0x5e7ceb,_0xa30e7a){const _0xc00870=a47_0x64156b,{currentPassword:_0x29153b,newPassword:_0x37b275,confirmNewPassword:_0x18ba39}=_0xa30e7a;if(_0x37b275!==_0x18ba39)throw new Error(_0xc00870(0x104));if(_0x37b275[_0xc00870(0xfe)]<0x6)throw new Error(_0xc00870(0x101));const _0x3de6d8=await database_1[_0xc00870(0xf0)]['shop'][_0xc00870(0xe3)]({'where':{'id':_0x5e7ceb},'select':{'password':!![]}});if(!_0x3de6d8)throw new Error(_0xc00870(0xe2));const _0x4dc8ea=await bcryptjs_1[_0xc00870(0xf0)][_0xc00870(0x107)](_0x29153b,_0x3de6d8[_0xc00870(0xf8)]);if(!_0x4dc8ea)throw new Error('Current\x20password\x20is\x20incorrect');const _0x1e8b1f=await bcryptjs_1[_0xc00870(0xf0)][_0xc00870(0xe5)](_0x37b275,0xc);await database_1['default'][_0xc00870(0xdd)]['update']({'where':{'id':_0x5e7ceb},'data':{'password':_0x1e8b1f}});}async[a47_0x64156b(0xc5)](_0x37b8b8,_0x37991b){const _0x565de2=a47_0x64156b;await this[_0x565de2(0xda)](_0x37b8b8);const _0x4373ed={};_0x37991b[_0x565de2(0xe7)]!==undefined&&(_0x4373ed[_0x565de2(0xd9)]=_0x37991b[_0x565de2(0xe7)]),_0x37991b[_0x565de2(0xe9)]!==undefined&&(_0x4373ed[_0x565de2(0xff)]=_0x37991b[_0x565de2(0xe9)]),_0x37991b[_0x565de2(0xd1)]!==undefined&&(_0x4373ed[_0x565de2(0xd3)]=_0x37991b[_0x565de2(0xd1)]),_0x37991b['payout']!==undefined&&(_0x4373ed[_0x565de2(0xfb)]=_0x37991b[_0x565de2(0xcc)]),_0x37991b[_0x565de2(0xf6)]!==undefined&&(_0x4373ed[_0x565de2(0xf5)]=_0x37991b[_0x565de2(0xf6)]),_0x37991b[_0x565de2(0xf3)]!==undefined&&(_0x4373ed['notificationApiError']=_0x37991b[_0x565de2(0xf3)]),await database_1['default'][_0x565de2(0xc7)]['update']({'where':{'shopId':_0x37b8b8},'data':_0x4373ed});}async['updateTelegramSettings'](_0x1725eb,_0x16839f){const _0x382306=a47_0x64156b;await this[_0x382306(0xda)](_0x1725eb);const _0x159c45={};_0x16839f[_0x382306(0xf4)]!==undefined&&(_0x159c45[_0x382306(0xc6)]=_0x16839f[_0x382306(0xf4)]||null),_0x16839f[_0x382306(0xdb)]!==undefined&&(_0x159c45[_0x382306(0x102)]=_0x16839f[_0x382306(0xdb)]||null),await database_1[_0x382306(0xf0)]['shopSettings']['update']({'where':{'shopId':_0x1725eb},'data':_0x159c45});}async[a47_0x64156b(0x105)](_0x296a2f,_0x309f2e){const _0x34f893=a47_0x64156b;await this[_0x34f893(0xda)](_0x296a2f);const _0x16cc57={};_0x309f2e[_0x34f893(0xe0)]!==undefined&&(_0x16cc57['webhookUrl']=_0x309f2e[_0x34f893(0xe0)]||null),_0x309f2e[_0x34f893(0xfc)]!==undefined&&(_0x16cc57[_0x34f893(0xfc)]=_0x309f2e[_0x34f893(0xfc)]||[]),await database_1['default']['shopSettings'][_0x34f893(0xdc)]({'where':{'shopId':_0x296a2f},'data':_0x16cc57});}async[a47_0x64156b(0xd5)](_0x3d2761){const _0x5ad2aa=a47_0x64156b,_0x19cb0a='pk_'+crypto_1['default']['randomBytes'](0x20)['toString'](_0x5ad2aa(0xc8)),_0x4e82e4='sk_'+crypto_1[_0x5ad2aa(0xf0)]['randomBytes'](0x20)['toString'](_0x5ad2aa(0xc8));await database_1[_0x5ad2aa(0xf0)]['shop']['update']({'where':{'id':_0x3d2761},'data':{'publicKey':_0x19cb0a,'secretKey':_0x4e82e4}});}async[a47_0x64156b(0xee)](_0x406cab,_0x587c32){const _0x11821d=a47_0x64156b,{passwordConfirmation:_0x16c91a}=_0x587c32,_0x22e7d8=await database_1['default'][_0x11821d(0xdd)][_0x11821d(0xe3)]({'where':{'id':_0x406cab},'select':{'password':!![]}});if(!_0x22e7d8)throw new Error(_0x11821d(0xe2));const _0x507c0a=await bcryptjs_1[_0x11821d(0xf0)][_0x11821d(0x107)](_0x16c91a,_0x22e7d8['password']);if(!_0x507c0a)throw new Error(_0x11821d(0xd7));await database_1['default'][_0x11821d(0xdd)][_0x11821d(0xeb)]({'where':{'id':_0x406cab}});}async[a47_0x64156b(0xda)](_0x2d8716){const _0x5973a5=a47_0x64156b,_0x3828aa=await database_1['default']['shopSettings'][_0x5973a5(0xe3)]({'where':{'shopId':_0x2d8716}});!_0x3828aa&&await database_1[_0x5973a5(0xf0)][_0x5973a5(0xc7)][_0x5973a5(0xca)]({'data':{'shopId':_0x2d8716}});}}exports[a47_0x64156b(0xea)]=SettingsService;