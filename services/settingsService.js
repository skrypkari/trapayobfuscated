'use strict';function a53_0x21f2(){const _0xe6f066=['substring','findUnique','sk_','notificationRefund','repeat','telegram','911251gJShNe','password','payment_success','6693540sliqbU','delete','updateWebhookSettings','676xMskmK','create','ensureSettingsExist','refund','getShopSettings','notificationApiError','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','13383rfpBtB','maskApiKey','notificationPaymentFailed','default','376LtIvkS','shopUrl','length','updateNotifications','max','randomBytes','SettingsService','settings','deleteAccount','1481484fPRTeu','notificationLogin','telegramBotApiKey','revokeAllApiKeys','shopSettings','shop','webhookUrl','update','payout','5ulFWPA','notificationPayout','parse','Current\x20password\x20is\x20incorrect','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','parseWebhookEvents','notificationPaymentSuccess','3416120nIQwKQ','../config/database','697448OWssMd','toString','payment_failed','changePassword','Shop\x20not\x20found','chatId','login','crypto','telegramChatId','27EayNTx','hash','webhookEvents','hex','isArray','2414SbVNzY','api_error','defineProperty'];a53_0x21f2=function(){return _0xe6f066;};return a53_0x21f2();}const a53_0x3d48b6=a53_0x264c;(function(_0x52247d,_0x2d5168){const _0x3216a1=a53_0x264c,_0x15e4d6=_0x52247d();while(!![]){try{const _0x100bd2=parseInt(_0x3216a1(0x1a7))/0x1*(parseInt(_0x3216a1(0x1b6))/0x2)+-parseInt(_0x3216a1(0x1bd))/0x3*(-parseInt(_0x3216a1(0x1c1))/0x4)+-parseInt(_0x3216a1(0x1d3))/0x5*(-parseInt(_0x3216a1(0x1ca))/0x6)+-parseInt(_0x3216a1(0x1b3))/0x7+parseInt(_0x3216a1(0x1dc))/0x8*(parseInt(_0x3216a1(0x1e5))/0x9)+-parseInt(_0x3216a1(0x1da))/0xa+parseInt(_0x3216a1(0x1b0))/0xb;if(_0x100bd2===_0x2d5168)break;else _0x15e4d6['push'](_0x15e4d6['shift']());}catch(_0x58ee14){_0x15e4d6['push'](_0x15e4d6['shift']());}}}(a53_0x21f2,0x8115c));function a53_0x264c(_0x5880ab,_0x18021b){const _0x21f2b5=a53_0x21f2();return a53_0x264c=function(_0x264c40,_0x5cc749){_0x264c40=_0x264c40-0x1a4;let _0x4dd855=_0x21f2b5[_0x264c40];return _0x4dd855;},a53_0x264c(_0x5880ab,_0x18021b);}var __importDefault=this&&this['__importDefault']||function(_0x179968){return _0x179968&&_0x179968['__esModule']?_0x179968:{'default':_0x179968};};Object[a53_0x3d48b6(0x1a9)](exports,'__esModule',{'value':!![]}),exports[a53_0x3d48b6(0x1c7)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a53_0x3d48b6(0x1e3))),database_1=__importDefault(require(a53_0x3d48b6(0x1db)));class SettingsService{[a53_0x3d48b6(0x1be)](_0x27b5fc){const _0x180944=a53_0x3d48b6;if(!_0x27b5fc)return'';if(_0x27b5fc[_0x180944(0x1c3)]<=0x8)return _0x27b5fc;const _0x55c1ad=_0x27b5fc[_0x180944(0x1aa)](0x0,0x8),_0x2035c4='*'[_0x180944(0x1ae)](Math[_0x180944(0x1c5)](0x0,_0x27b5fc['length']-0x8));return _0x55c1ad+_0x2035c4;}['parseWebhookEvents'](_0x2e2d2a){const _0xc92718=a53_0x3d48b6;if(!_0x2e2d2a)return[];if(Array['isArray'](_0x2e2d2a))return _0x2e2d2a;if(typeof _0x2e2d2a==='string')try{const _0xf3d5c3=JSON[_0xc92718(0x1d5)](_0x2e2d2a);return Array[_0xc92718(0x1a6)](_0xf3d5c3)?_0xf3d5c3:[];}catch{return[];}return[];}async[a53_0x3d48b6(0x1ba)](_0x34c90c){const _0x4cdb83=a53_0x3d48b6,_0x2907ad=await database_1[_0x4cdb83(0x1c0)]['shop'][_0x4cdb83(0x1ab)]({'where':{'id':_0x34c90c},'include':{'settings':!![]}});if(!_0x2907ad)throw new Error('Shop\x20not\x20found');let _0xeb6c66=_0x2907ad[_0x4cdb83(0x1c8)];return!_0xeb6c66&&(_0xeb6c66=await database_1[_0x4cdb83(0x1c0)]['shopSettings'][_0x4cdb83(0x1b7)]({'data':{'shopId':_0x2907ad['id']}})),{'fullName':_0x2907ad['name'],'brand':_0x2907ad['name'],'merchantUrl':_0x2907ad[_0x4cdb83(0x1c2)],'telegramUsername':_0x2907ad[_0x4cdb83(0x1af)],'telegramBotApiKey':_0xeb6c66[_0x4cdb83(0x1cc)]?this[_0x4cdb83(0x1be)](_0xeb6c66[_0x4cdb83(0x1cc)]):null,'telegramChatId':_0xeb6c66[_0x4cdb83(0x1e4)],'webhookUrl':_0xeb6c66[_0x4cdb83(0x1d0)],'webhookEvents':this[_0x4cdb83(0x1d8)](_0xeb6c66[_0x4cdb83(0x1a4)]),'notifications':{'payment_success':_0xeb6c66[_0x4cdb83(0x1d9)],'payment_failed':_0xeb6c66['notificationPaymentFailed'],'refund':_0xeb6c66[_0x4cdb83(0x1ad)],'payout':_0xeb6c66[_0x4cdb83(0x1d4)],'login':_0xeb6c66[_0x4cdb83(0x1cb)],'api_error':_0xeb6c66[_0x4cdb83(0x1bb)]}};}async[a53_0x3d48b6(0x1df)](_0x4d1daf,_0x5e4ee9){const _0x395cdb=a53_0x3d48b6,{currentPassword:_0x122b2e,newPassword:_0x4573aa,confirmNewPassword:_0xdea038}=_0x5e4ee9;if(_0x4573aa!==_0xdea038)throw new Error(_0x395cdb(0x1bc));if(_0x4573aa['length']<0x6)throw new Error(_0x395cdb(0x1d7));const _0x49ecd1=await database_1[_0x395cdb(0x1c0)][_0x395cdb(0x1cf)][_0x395cdb(0x1ab)]({'where':{'id':_0x4d1daf},'select':{'password':!![]}});if(!_0x49ecd1)throw new Error(_0x395cdb(0x1e0));const _0x1513e7=await bcryptjs_1['default']['compare'](_0x122b2e,_0x49ecd1[_0x395cdb(0x1b1)]);if(!_0x1513e7)throw new Error(_0x395cdb(0x1d6));const _0x10a3a2=await bcryptjs_1[_0x395cdb(0x1c0)][_0x395cdb(0x1e6)](_0x4573aa,0xc);await database_1[_0x395cdb(0x1c0)][_0x395cdb(0x1cf)][_0x395cdb(0x1d1)]({'where':{'id':_0x4d1daf},'data':{'password':_0x10a3a2}});}async[a53_0x3d48b6(0x1c4)](_0x4713a6,_0xe66de2){const _0x515be0=a53_0x3d48b6;await this[_0x515be0(0x1b8)](_0x4713a6);const _0x4e416c={};_0xe66de2['payment_success']!==undefined&&(_0x4e416c[_0x515be0(0x1d9)]=_0xe66de2[_0x515be0(0x1b2)]),_0xe66de2[_0x515be0(0x1de)]!==undefined&&(_0x4e416c[_0x515be0(0x1bf)]=_0xe66de2['payment_failed']),_0xe66de2[_0x515be0(0x1b9)]!==undefined&&(_0x4e416c[_0x515be0(0x1ad)]=_0xe66de2[_0x515be0(0x1b9)]),_0xe66de2[_0x515be0(0x1d2)]!==undefined&&(_0x4e416c['notificationPayout']=_0xe66de2[_0x515be0(0x1d2)]),_0xe66de2[_0x515be0(0x1e2)]!==undefined&&(_0x4e416c['notificationLogin']=_0xe66de2[_0x515be0(0x1e2)]),_0xe66de2['api_error']!==undefined&&(_0x4e416c['notificationApiError']=_0xe66de2[_0x515be0(0x1a8)]),await database_1[_0x515be0(0x1c0)][_0x515be0(0x1ce)][_0x515be0(0x1d1)]({'where':{'shopId':_0x4713a6},'data':_0x4e416c});}async['updateTelegramSettings'](_0xb2f876,_0x5349e5){const _0x116e34=a53_0x3d48b6;await this['ensureSettingsExist'](_0xb2f876);const _0x4d4708={};_0x5349e5['botApiKey']!==undefined&&(_0x4d4708[_0x116e34(0x1cc)]=_0x5349e5['botApiKey']||null),_0x5349e5[_0x116e34(0x1e1)]!==undefined&&(_0x4d4708[_0x116e34(0x1e4)]=_0x5349e5['chatId']||null),await database_1[_0x116e34(0x1c0)]['shopSettings'][_0x116e34(0x1d1)]({'where':{'shopId':_0xb2f876},'data':_0x4d4708});}async[a53_0x3d48b6(0x1b5)](_0x2a80f9,_0x4b3973){const _0x37514c=a53_0x3d48b6;await this[_0x37514c(0x1b8)](_0x2a80f9);const _0x17392e={};_0x4b3973['webhookUrl']!==undefined&&(_0x17392e[_0x37514c(0x1d0)]=_0x4b3973['webhookUrl']||null),_0x4b3973[_0x37514c(0x1a4)]!==undefined&&(_0x17392e[_0x37514c(0x1a4)]=_0x4b3973['webhookEvents']||[]),await database_1['default'][_0x37514c(0x1ce)][_0x37514c(0x1d1)]({'where':{'shopId':_0x2a80f9},'data':_0x17392e});}async[a53_0x3d48b6(0x1cd)](_0x4611d1){const _0x388424=a53_0x3d48b6,_0x248def='pk_'+crypto_1['default'][_0x388424(0x1c6)](0x20)[_0x388424(0x1dd)](_0x388424(0x1a5)),_0xc1a8c1=_0x388424(0x1ac)+crypto_1['default']['randomBytes'](0x20)[_0x388424(0x1dd)](_0x388424(0x1a5));await database_1[_0x388424(0x1c0)][_0x388424(0x1cf)]['update']({'where':{'id':_0x4611d1},'data':{'publicKey':_0x248def,'secretKey':_0xc1a8c1}});}async[a53_0x3d48b6(0x1c9)](_0x4f77c3,_0xbf8359){const _0xee6d20=a53_0x3d48b6,{passwordConfirmation:_0x1c9db3}=_0xbf8359,_0x9a2197=await database_1[_0xee6d20(0x1c0)][_0xee6d20(0x1cf)][_0xee6d20(0x1ab)]({'where':{'id':_0x4f77c3},'select':{'password':!![]}});if(!_0x9a2197)throw new Error(_0xee6d20(0x1e0));const _0x5d8439=await bcryptjs_1[_0xee6d20(0x1c0)]['compare'](_0x1c9db3,_0x9a2197[_0xee6d20(0x1b1)]);if(!_0x5d8439)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0xee6d20(0x1c0)][_0xee6d20(0x1cf)][_0xee6d20(0x1b4)]({'where':{'id':_0x4f77c3}});}async[a53_0x3d48b6(0x1b8)](_0x56c722){const _0x4ba184=a53_0x3d48b6,_0x21d51a=await database_1[_0x4ba184(0x1c0)][_0x4ba184(0x1ce)][_0x4ba184(0x1ab)]({'where':{'shopId':_0x56c722}});!_0x21d51a&&await database_1[_0x4ba184(0x1c0)]['shopSettings']['create']({'data':{'shopId':_0x56c722}});}}exports[a53_0x3d48b6(0x1c7)]=SettingsService;