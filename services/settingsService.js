'use strict';const a52_0x554595=a52_0x5123;(function(_0x4d1b6d,_0x24fb98){const _0x5096d8=a52_0x5123,_0x5a7d2c=_0x4d1b6d();while(!![]){try{const _0x28a201=-parseInt(_0x5096d8(0x17e))/0x1*(parseInt(_0x5096d8(0x182))/0x2)+-parseInt(_0x5096d8(0x18d))/0x3+parseInt(_0x5096d8(0x15b))/0x4*(-parseInt(_0x5096d8(0x194))/0x5)+-parseInt(_0x5096d8(0x197))/0x6*(parseInt(_0x5096d8(0x178))/0x7)+-parseInt(_0x5096d8(0x16d))/0x8*(parseInt(_0x5096d8(0x192))/0x9)+parseInt(_0x5096d8(0x15c))/0xa+-parseInt(_0x5096d8(0x184))/0xb*(-parseInt(_0x5096d8(0x18e))/0xc);if(_0x28a201===_0x24fb98)break;else _0x5a7d2c['push'](_0x5a7d2c['shift']());}catch(_0x30260b){_0x5a7d2c['push'](_0x5a7d2c['shift']());}}}(a52_0xd74f,0x5d2e0));var __importDefault=this&&this[a52_0x554595(0x15e)]||function(_0x26c77d){return _0x26c77d&&_0x26c77d['__esModule']?_0x26c77d:{'default':_0x26c77d};};Object['defineProperty'](exports,a52_0x554595(0x17a),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x554595(0x172))),crypto_1=__importDefault(require(a52_0x554595(0x156))),database_1=__importDefault(require(a52_0x554595(0x177)));class SettingsService{[a52_0x554595(0x168)](_0x2ed48d){const _0x27fa91=a52_0x554595;if(!_0x2ed48d)return'';if(_0x2ed48d[_0x27fa91(0x166)]<=0x8)return _0x2ed48d;const _0x5a1aaf=_0x2ed48d[_0x27fa91(0x195)](0x0,0x8),_0x288e34='*'[_0x27fa91(0x193)](Math[_0x27fa91(0x186)](0x0,_0x2ed48d[_0x27fa91(0x166)]-0x8));return _0x5a1aaf+_0x288e34;}['parseWebhookEvents'](_0x72466b){const _0x44e363=a52_0x554595;if(!_0x72466b)return[];if(Array['isArray'](_0x72466b))return _0x72466b;if(typeof _0x72466b==='string')try{const _0x4230e6=JSON[_0x44e363(0x161)](_0x72466b);return Array[_0x44e363(0x157)](_0x4230e6)?_0x4230e6:[];}catch{return[];}return[];}async[a52_0x554595(0x173)](_0x3c654a){const _0x10e1fa=a52_0x554595,_0x2b4d57=await database_1['default'][_0x10e1fa(0x15d)][_0x10e1fa(0x16a)]({'where':{'id':_0x3c654a},'include':{'settings':!![]}});if(!_0x2b4d57)throw new Error(_0x10e1fa(0x18c));let _0x2e6027=_0x2b4d57[_0x10e1fa(0x16b)];return!_0x2e6027&&(_0x2e6027=await database_1[_0x10e1fa(0x152)][_0x10e1fa(0x181)][_0x10e1fa(0x163)]({'data':{'shopId':_0x2b4d57['id']}})),{'fullName':_0x2b4d57[_0x10e1fa(0x167)],'brand':_0x2b4d57['name'],'merchantUrl':_0x2b4d57[_0x10e1fa(0x174)],'telegramUsername':_0x2b4d57[_0x10e1fa(0x196)],'telegramBotApiKey':_0x2e6027[_0x10e1fa(0x18a)]?this['maskApiKey'](_0x2e6027[_0x10e1fa(0x18a)]):null,'telegramChatId':_0x2e6027[_0x10e1fa(0x153)],'webhookUrl':_0x2e6027['webhookUrl'],'webhookEvents':this[_0x10e1fa(0x176)](_0x2e6027[_0x10e1fa(0x15a)]),'notifications':{'payment_success':_0x2e6027[_0x10e1fa(0x160)],'payment_failed':_0x2e6027[_0x10e1fa(0x18f)],'refund':_0x2e6027[_0x10e1fa(0x154)],'payout':_0x2e6027[_0x10e1fa(0x169)],'login':_0x2e6027[_0x10e1fa(0x175)],'api_error':_0x2e6027[_0x10e1fa(0x187)]}};}async[a52_0x554595(0x191)](_0x564135,_0x5201ed){const _0x1f2dc5=a52_0x554595,{currentPassword:_0x6417ee,newPassword:_0x41510d,confirmNewPassword:_0x3c8c45}=_0x5201ed;if(_0x41510d!==_0x3c8c45)throw new Error(_0x1f2dc5(0x199));if(_0x41510d[_0x1f2dc5(0x166)]<0x6)throw new Error(_0x1f2dc5(0x17c));const _0x325413=await database_1[_0x1f2dc5(0x152)][_0x1f2dc5(0x15d)][_0x1f2dc5(0x16a)]({'where':{'id':_0x564135},'select':{'password':!![]}});if(!_0x325413)throw new Error(_0x1f2dc5(0x18c));const _0x1895ab=await bcryptjs_1[_0x1f2dc5(0x152)]['compare'](_0x6417ee,_0x325413['password']);if(!_0x1895ab)throw new Error(_0x1f2dc5(0x17b));const _0x1d0d7f=await bcryptjs_1[_0x1f2dc5(0x152)]['hash'](_0x41510d,0xc);await database_1[_0x1f2dc5(0x152)][_0x1f2dc5(0x15d)]['update']({'where':{'id':_0x564135},'data':{'password':_0x1d0d7f}});}async['updateNotifications'](_0x29d4d1,_0x5e6d47){const _0x17ee22=a52_0x554595;await this[_0x17ee22(0x16f)](_0x29d4d1);const _0x3c11a9={};_0x5e6d47[_0x17ee22(0x198)]!==undefined&&(_0x3c11a9[_0x17ee22(0x160)]=_0x5e6d47['payment_success']),_0x5e6d47[_0x17ee22(0x158)]!==undefined&&(_0x3c11a9[_0x17ee22(0x18f)]=_0x5e6d47[_0x17ee22(0x158)]),_0x5e6d47[_0x17ee22(0x162)]!==undefined&&(_0x3c11a9['notificationRefund']=_0x5e6d47[_0x17ee22(0x162)]),_0x5e6d47[_0x17ee22(0x164)]!==undefined&&(_0x3c11a9['notificationPayout']=_0x5e6d47[_0x17ee22(0x164)]),_0x5e6d47[_0x17ee22(0x183)]!==undefined&&(_0x3c11a9[_0x17ee22(0x175)]=_0x5e6d47[_0x17ee22(0x183)]),_0x5e6d47['api_error']!==undefined&&(_0x3c11a9[_0x17ee22(0x187)]=_0x5e6d47[_0x17ee22(0x189)]),await database_1[_0x17ee22(0x152)][_0x17ee22(0x181)][_0x17ee22(0x165)]({'where':{'shopId':_0x29d4d1},'data':_0x3c11a9});}async[a52_0x554595(0x159)](_0x136ec7,_0x235c99){const _0x1d27b7=a52_0x554595;await this[_0x1d27b7(0x16f)](_0x136ec7);const _0x5c3e07={};_0x235c99[_0x1d27b7(0x170)]!==undefined&&(_0x5c3e07[_0x1d27b7(0x18a)]=_0x235c99['botApiKey']||null),_0x235c99[_0x1d27b7(0x155)]!==undefined&&(_0x5c3e07[_0x1d27b7(0x153)]=_0x235c99[_0x1d27b7(0x155)]||null),await database_1[_0x1d27b7(0x152)][_0x1d27b7(0x181)][_0x1d27b7(0x165)]({'where':{'shopId':_0x136ec7},'data':_0x5c3e07});}async[a52_0x554595(0x17f)](_0x5a942a,_0x398885){const _0xae08c5=a52_0x554595;await this[_0xae08c5(0x16f)](_0x5a942a);const _0xd430ec={};_0x398885['webhookUrl']!==undefined&&(_0xd430ec[_0xae08c5(0x188)]=_0x398885[_0xae08c5(0x188)]||null),_0x398885[_0xae08c5(0x15a)]!==undefined&&(_0xd430ec[_0xae08c5(0x15a)]=_0x398885[_0xae08c5(0x15a)]||[]),await database_1[_0xae08c5(0x152)][_0xae08c5(0x181)][_0xae08c5(0x165)]({'where':{'shopId':_0x5a942a},'data':_0xd430ec});}async[a52_0x554595(0x171)](_0x2eaf8c){const _0x2324e4=a52_0x554595,_0x5b0985=_0x2324e4(0x16e)+crypto_1[_0x2324e4(0x152)][_0x2324e4(0x15f)](0x20)[_0x2324e4(0x18b)](_0x2324e4(0x17d)),_0x4702dd=_0x2324e4(0x180)+crypto_1['default']['randomBytes'](0x20)['toString']('hex');await database_1[_0x2324e4(0x152)][_0x2324e4(0x15d)][_0x2324e4(0x165)]({'where':{'id':_0x2eaf8c},'data':{'publicKey':_0x5b0985,'secretKey':_0x4702dd}});}async[a52_0x554595(0x190)](_0xc52ce6,_0x40c52f){const _0x26e1a3=a52_0x554595,{passwordConfirmation:_0xa7b6af}=_0x40c52f,_0x39c251=await database_1[_0x26e1a3(0x152)][_0x26e1a3(0x15d)][_0x26e1a3(0x16a)]({'where':{'id':_0xc52ce6},'select':{'password':!![]}});if(!_0x39c251)throw new Error(_0x26e1a3(0x18c));const _0x4f766b=await bcryptjs_1[_0x26e1a3(0x152)][_0x26e1a3(0x16c)](_0xa7b6af,_0x39c251[_0x26e1a3(0x179)]);if(!_0x4f766b)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x26e1a3(0x152)][_0x26e1a3(0x15d)][_0x26e1a3(0x185)]({'where':{'id':_0xc52ce6}});}async['ensureSettingsExist'](_0xc000c2){const _0x5a16bb=a52_0x554595,_0x405569=await database_1['default'][_0x5a16bb(0x181)][_0x5a16bb(0x16a)]({'where':{'shopId':_0xc000c2}});!_0x405569&&await database_1['default']['shopSettings'][_0x5a16bb(0x163)]({'data':{'shopId':_0xc000c2}});}}exports['SettingsService']=SettingsService;function a52_0x5123(_0x2ee96d,_0x4a252e){const _0xd74f0c=a52_0xd74f();return a52_0x5123=function(_0x512341,_0x316589){_0x512341=_0x512341-0x152;let _0x44cac2=_0xd74f0c[_0x512341];return _0x44cac2;},a52_0x5123(_0x2ee96d,_0x4a252e);}function a52_0xd74f(){const _0x23267f=['payment_success','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','default','telegramChatId','notificationRefund','chatId','crypto','isArray','payment_failed','updateTelegramSettings','webhookEvents','4TGrTKj','3563050qWdSZT','shop','__importDefault','randomBytes','notificationPaymentSuccess','parse','refund','create','payout','update','length','name','maskApiKey','notificationPayout','findUnique','settings','compare','64Lgpmcb','pk_','ensureSettingsExist','botApiKey','revokeAllApiKeys','bcryptjs','getShopSettings','shopUrl','notificationLogin','parseWebhookEvents','../config/database','434574aytzyU','password','__esModule','Current\x20password\x20is\x20incorrect','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','hex','8Bprdfw','updateWebhookSettings','sk_','shopSettings','165132xkMUaR','login','7298225HaJBiq','delete','max','notificationApiError','webhookUrl','api_error','telegramBotApiKey','toString','Shop\x20not\x20found','1008240VqiNyy','36jYXFgw','notificationPaymentFailed','deleteAccount','changePassword','747657SywoJj','repeat','1208960CtWFji','substring','telegram','6EhQdXI'];a52_0xd74f=function(){return _0x23267f;};return a52_0xd74f();}