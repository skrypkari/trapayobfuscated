'use strict';const a57_0x3c5e61=a57_0x1966;function a57_0x1966(_0x529358,_0xfb0c20){const _0x7a1df7=a57_0x7a1d();return a57_0x1966=function(_0x1966c7,_0x592b5f){_0x1966c7=_0x1966c7-0x1ea;let _0x34b2b7=_0x7a1df7[_0x1966c7];return _0x34b2b7;},a57_0x1966(_0x529358,_0xfb0c20);}(function(_0x189668,_0x5168b5){const _0x590fed=a57_0x1966,_0x39c59b=_0x189668();while(!![]){try{const _0x4cf0b3=-parseInt(_0x590fed(0x202))/0x1+parseInt(_0x590fed(0x1ef))/0x2*(-parseInt(_0x590fed(0x209))/0x3)+-parseInt(_0x590fed(0x1f1))/0x4*(parseInt(_0x590fed(0x22c))/0x5)+parseInt(_0x590fed(0x203))/0x6+parseInt(_0x590fed(0x1fd))/0x7*(-parseInt(_0x590fed(0x1f8))/0x8)+-parseInt(_0x590fed(0x1ff))/0x9*(-parseInt(_0x590fed(0x1fa))/0xa)+-parseInt(_0x590fed(0x1ed))/0xb*(-parseInt(_0x590fed(0x205))/0xc);if(_0x4cf0b3===_0x5168b5)break;else _0x39c59b['push'](_0x39c59b['shift']());}catch(_0x3a9965){_0x39c59b['push'](_0x39c59b['shift']());}}}(a57_0x7a1d,0x6f9ff));var __importDefault=this&&this['__importDefault']||function(_0x8023b9){return _0x8023b9&&_0x8023b9['__esModule']?_0x8023b9:{'default':_0x8023b9};};Object[a57_0x3c5e61(0x22b)](exports,'__esModule',{'value':!![]}),exports[a57_0x3c5e61(0x1f3)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a57_0x3c5e61(0x20b))),database_1=__importDefault(require(a57_0x3c5e61(0x21c)));class SettingsService{['maskApiKey'](_0x29cd24){const _0x10de3f=a57_0x3c5e61;if(!_0x29cd24)return'';if(_0x29cd24['length']<=0x8)return _0x29cd24;const _0x52307f=_0x29cd24[_0x10de3f(0x216)](0x0,0x8),_0x288e33='*'[_0x10de3f(0x20e)](Math[_0x10de3f(0x21e)](0x0,_0x29cd24['length']-0x8));return _0x52307f+_0x288e33;}[a57_0x3c5e61(0x1f7)](_0x28960c){const _0x3a442e=a57_0x3c5e61;if(!_0x28960c)return[];if(Array[_0x3a442e(0x228)](_0x28960c))return _0x28960c;if(typeof _0x28960c==='string')try{const _0x5a3d2c=JSON[_0x3a442e(0x217)](_0x28960c);return Array[_0x3a442e(0x228)](_0x5a3d2c)?_0x5a3d2c:[];}catch{return[];}return[];}async['getShopSettings'](_0x44ae00){const _0x4a6766=a57_0x3c5e61,_0x4f8b5b=await database_1[_0x4a6766(0x224)][_0x4a6766(0x207)][_0x4a6766(0x1f0)]({'where':{'id':_0x44ae00},'include':{'settings':!![]}});if(!_0x4f8b5b)throw new Error(_0x4a6766(0x225));let _0x3b07cf=_0x4f8b5b[_0x4a6766(0x21b)];return!_0x3b07cf&&(_0x3b07cf=await database_1[_0x4a6766(0x224)][_0x4a6766(0x206)][_0x4a6766(0x218)]({'data':{'shopId':_0x4f8b5b['id']}})),{'fullName':_0x4f8b5b[_0x4a6766(0x212)],'brand':_0x4f8b5b[_0x4a6766(0x212)],'merchantUrl':_0x4f8b5b[_0x4a6766(0x223)],'telegramUsername':_0x4f8b5b['telegram'],'telegramBotApiKey':_0x3b07cf[_0x4a6766(0x204)]?this[_0x4a6766(0x208)](_0x3b07cf[_0x4a6766(0x204)]):null,'telegramChatId':_0x3b07cf[_0x4a6766(0x210)],'webhookUrl':_0x3b07cf['webhookUrl'],'webhookEvents':this[_0x4a6766(0x1f7)](_0x3b07cf['webhookEvents']),'notifications':{'payment_success':_0x3b07cf[_0x4a6766(0x211)],'payment_failed':_0x3b07cf[_0x4a6766(0x22a)],'refund':_0x3b07cf[_0x4a6766(0x20d)],'payout':_0x3b07cf[_0x4a6766(0x1f9)],'login':_0x3b07cf['notificationLogin'],'api_error':_0x3b07cf[_0x4a6766(0x221)]}};}async[a57_0x3c5e61(0x20f)](_0x230a0d,_0x54195c){const _0x16c653=a57_0x3c5e61,{currentPassword:_0x4531aa,newPassword:_0x1ab665,confirmNewPassword:_0x1af588}=_0x54195c;if(_0x1ab665!==_0x1af588)throw new Error(_0x16c653(0x20c));if(_0x1ab665[_0x16c653(0x226)]<0x6)throw new Error(_0x16c653(0x1fb));const _0x40b598=await database_1['default'][_0x16c653(0x207)][_0x16c653(0x1f0)]({'where':{'id':_0x230a0d},'select':{'password':!![]}});if(!_0x40b598)throw new Error('Shop\x20not\x20found');const _0x5f4343=await bcryptjs_1['default'][_0x16c653(0x1fe)](_0x4531aa,_0x40b598[_0x16c653(0x220)]);if(!_0x5f4343)throw new Error(_0x16c653(0x21d));const _0x71d4c7=await bcryptjs_1[_0x16c653(0x224)]['hash'](_0x1ab665,0xc);await database_1[_0x16c653(0x224)][_0x16c653(0x207)][_0x16c653(0x1f6)]({'where':{'id':_0x230a0d},'data':{'password':_0x71d4c7}});}async[a57_0x3c5e61(0x200)](_0x17caa2,_0x1bd73b){const _0x5bb036=a57_0x3c5e61;await this['ensureSettingsExist'](_0x17caa2);const _0x1d2388={};_0x1bd73b[_0x5bb036(0x229)]!==undefined&&(_0x1d2388[_0x5bb036(0x211)]=_0x1bd73b[_0x5bb036(0x229)]),_0x1bd73b[_0x5bb036(0x20a)]!==undefined&&(_0x1d2388[_0x5bb036(0x22a)]=_0x1bd73b['payment_failed']),_0x1bd73b['refund']!==undefined&&(_0x1d2388[_0x5bb036(0x20d)]=_0x1bd73b[_0x5bb036(0x21f)]),_0x1bd73b['payout']!==undefined&&(_0x1d2388[_0x5bb036(0x1f9)]=_0x1bd73b[_0x5bb036(0x1f4)]),_0x1bd73b[_0x5bb036(0x1fc)]!==undefined&&(_0x1d2388[_0x5bb036(0x1eb)]=_0x1bd73b[_0x5bb036(0x1fc)]),_0x1bd73b[_0x5bb036(0x214)]!==undefined&&(_0x1d2388['notificationApiError']=_0x1bd73b[_0x5bb036(0x214)]),await database_1[_0x5bb036(0x224)]['shopSettings'][_0x5bb036(0x1f6)]({'where':{'shopId':_0x17caa2},'data':_0x1d2388});}async[a57_0x3c5e61(0x21a)](_0x4bdbcb,_0x18a09b){const _0x1e59e4=a57_0x3c5e61;await this[_0x1e59e4(0x1f2)](_0x4bdbcb);const _0x24b493={};_0x18a09b[_0x1e59e4(0x1f5)]!==undefined&&(_0x24b493[_0x1e59e4(0x204)]=_0x18a09b['botApiKey']||null),_0x18a09b[_0x1e59e4(0x213)]!==undefined&&(_0x24b493[_0x1e59e4(0x210)]=_0x18a09b['chatId']||null),await database_1[_0x1e59e4(0x224)][_0x1e59e4(0x206)][_0x1e59e4(0x1f6)]({'where':{'shopId':_0x4bdbcb},'data':_0x24b493});}async['updateWebhookSettings'](_0x32c02a,_0x3e0771){const _0x24b44c=a57_0x3c5e61;await this[_0x24b44c(0x1f2)](_0x32c02a);const _0x140c90={};_0x3e0771[_0x24b44c(0x219)]!==undefined&&(_0x140c90[_0x24b44c(0x219)]=_0x3e0771[_0x24b44c(0x219)]||null),_0x3e0771[_0x24b44c(0x215)]!==undefined&&(_0x140c90[_0x24b44c(0x215)]=_0x3e0771[_0x24b44c(0x215)]||[]),await database_1['default'][_0x24b44c(0x206)][_0x24b44c(0x1f6)]({'where':{'shopId':_0x32c02a},'data':_0x140c90});}async['revokeAllApiKeys'](_0x344c89){const _0x47ecd1=a57_0x3c5e61,_0x5a1ec0=_0x47ecd1(0x1ee)+crypto_1[_0x47ecd1(0x224)][_0x47ecd1(0x1ea)](0x20)[_0x47ecd1(0x222)](_0x47ecd1(0x201)),_0x580f3e='sk_'+crypto_1[_0x47ecd1(0x224)][_0x47ecd1(0x1ea)](0x20)[_0x47ecd1(0x222)]('hex');await database_1[_0x47ecd1(0x224)][_0x47ecd1(0x207)][_0x47ecd1(0x1f6)]({'where':{'id':_0x344c89},'data':{'publicKey':_0x5a1ec0,'secretKey':_0x580f3e}});}async[a57_0x3c5e61(0x227)](_0x2c165f,_0x2574f0){const _0x4756d9=a57_0x3c5e61,{passwordConfirmation:_0x36af16}=_0x2574f0,_0x1cba43=await database_1[_0x4756d9(0x224)][_0x4756d9(0x207)][_0x4756d9(0x1f0)]({'where':{'id':_0x2c165f},'select':{'password':!![]}});if(!_0x1cba43)throw new Error(_0x4756d9(0x225));const _0x57338d=await bcryptjs_1['default'][_0x4756d9(0x1fe)](_0x36af16,_0x1cba43[_0x4756d9(0x220)]);if(!_0x57338d)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x4756d9(0x224)][_0x4756d9(0x207)][_0x4756d9(0x1ec)]({'where':{'id':_0x2c165f}});}async[a57_0x3c5e61(0x1f2)](_0x708cf4){const _0x1712dd=a57_0x3c5e61,_0x3bef95=await database_1[_0x1712dd(0x224)]['shopSettings'][_0x1712dd(0x1f0)]({'where':{'shopId':_0x708cf4}});!_0x3bef95&&await database_1[_0x1712dd(0x224)][_0x1712dd(0x206)][_0x1712dd(0x218)]({'data':{'shopId':_0x708cf4}});}}function a57_0x7a1d(){const _0x41e292=['Shop\x20not\x20found','length','deleteAccount','isArray','payment_success','notificationPaymentFailed','defineProperty','3405405bOGoBp','randomBytes','notificationLogin','delete','51557uFkBCB','pk_','557490FtBCfY','findUnique','4FesRuK','ensureSettingsExist','SettingsService','payout','botApiKey','update','parseWebhookEvents','8WRovMu','notificationPayout','190DDtcAB','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','login','4476997SncONd','compare','341883WHEhpc','updateNotifications','hex','64395CRmEuZ','5371620UAvigz','telegramBotApiKey','2004vvZIfi','shopSettings','shop','maskApiKey','6XDDbEk','payment_failed','crypto','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','notificationRefund','repeat','changePassword','telegramChatId','notificationPaymentSuccess','name','chatId','api_error','webhookEvents','substring','parse','create','webhookUrl','updateTelegramSettings','settings','../config/database','Current\x20password\x20is\x20incorrect','max','refund','password','notificationApiError','toString','shopUrl','default'];a57_0x7a1d=function(){return _0x41e292;};return a57_0x7a1d();}exports[a57_0x3c5e61(0x1f3)]=SettingsService;