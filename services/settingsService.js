'use strict';function a72_0x5594(_0x36faa1,_0x22d926){_0x36faa1=_0x36faa1-0x136;const _0x47ede4=a72_0x47ed();let _0x55941d=_0x47ede4[_0x36faa1];return _0x55941d;}const a72_0x10a414=a72_0x5594;(function(_0x472f5a,_0x2866ca){const _0x3a296a=a72_0x5594,_0x3c64f7=_0x472f5a();while(!![]){try{const _0x5ebbac=parseInt(_0x3a296a(0x149))/0x1*(-parseInt(_0x3a296a(0x16d))/0x2)+parseInt(_0x3a296a(0x15a))/0x3*(-parseInt(_0x3a296a(0x13a))/0x4)+parseInt(_0x3a296a(0x166))/0x5*(parseInt(_0x3a296a(0x16a))/0x6)+-parseInt(_0x3a296a(0x163))/0x7*(-parseInt(_0x3a296a(0x136))/0x8)+parseInt(_0x3a296a(0x171))/0x9+-parseInt(_0x3a296a(0x153))/0xa+-parseInt(_0x3a296a(0x139))/0xb*(parseInt(_0x3a296a(0x13c))/0xc);if(_0x5ebbac===_0x2866ca)break;else _0x3c64f7['push'](_0x3c64f7['shift']());}catch(_0x1b0195){_0x3c64f7['push'](_0x3c64f7['shift']());}}}(a72_0x47ed,0x1f6d6));function a72_0x47ed(){const _0x42f1ec=['findUnique','shopUrl','1012hzFQUC','hex','__esModule','telegramChatId','491760pZozzz','notificationLogin','hash','updateNotifications','deleteAccount','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','repeat','create','1789176WFRQNl','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','login','1603349ZOygqz','75976tnnOwh','notificationPaymentFailed','12dsUbpO','shopSettings','name','password','settings','SettingsService','api_error','webhookUrl','updateTelegramSettings','changePassword','telegramBotApiKey','notificationPayout','string','51ceLPzS','chatId','length','payout','Current\x20password\x20is\x20incorrect','isArray','toString','update','botApiKey','Shop\x20not\x20found','2087180DffnbC','notificationRefund','ensureSettingsExist','payment_success','updateWebhookSettings','maskApiKey','compare','3AwpnDo','notificationApiError','shop','randomBytes','parseWebhookEvents','payment_failed','substring','default','revokeAllApiKeys','7gVHABE','bcryptjs','max','312145KlxsIy','webhookEvents','notificationPaymentSuccess','refund','24AQKdFZ'];a72_0x47ed=function(){return _0x42f1ec;};return a72_0x47ed();}var __importDefault=this&&this['__importDefault']||function(_0x2bcfa1){const _0x180cd0=a72_0x5594;return _0x2bcfa1&&_0x2bcfa1[_0x180cd0(0x16f)]?_0x2bcfa1:{'default':_0x2bcfa1};};Object['defineProperty'](exports,a72_0x10a414(0x16f),{'value':!![]}),exports[a72_0x10a414(0x141)]=void 0x0;const bcryptjs_1=__importDefault(require(a72_0x10a414(0x164))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));class SettingsService{[a72_0x10a414(0x158)](_0x4347f9){const _0x4ca7ee=a72_0x10a414;if(!_0x4347f9)return'';if(_0x4347f9[_0x4ca7ee(0x14b)]<=0x8)return _0x4347f9;const _0x1ac728=_0x4347f9[_0x4ca7ee(0x160)](0x0,0x8),_0x5e30ac='*'[_0x4ca7ee(0x177)](Math[_0x4ca7ee(0x165)](0x0,_0x4347f9[_0x4ca7ee(0x14b)]-0x8));return _0x1ac728+_0x5e30ac;}[a72_0x10a414(0x15e)](_0xfdf303){const _0x258c9c=a72_0x10a414;if(!_0xfdf303)return[];if(Array[_0x258c9c(0x14e)](_0xfdf303))return _0xfdf303;if(typeof _0xfdf303===_0x258c9c(0x148))try{const _0x4b75b1=JSON['parse'](_0xfdf303);return Array[_0x258c9c(0x14e)](_0x4b75b1)?_0x4b75b1:[];}catch{return[];}return[];}async['getShopSettings'](_0x5b9faa){const _0x200fd5=a72_0x10a414,_0x2f9021=await database_1['default']['shop'][_0x200fd5(0x16b)]({'where':{'id':_0x5b9faa},'include':{'settings':!![]}});if(!_0x2f9021)throw new Error(_0x200fd5(0x152));let _0x569c50=_0x2f9021[_0x200fd5(0x140)];return!_0x569c50&&(_0x569c50=await database_1['default']['shopSettings'][_0x200fd5(0x178)]({'data':{'shopId':_0x2f9021['id']}})),{'fullName':_0x2f9021['name'],'brand':_0x2f9021[_0x200fd5(0x13e)],'merchantUrl':_0x2f9021[_0x200fd5(0x16c)],'telegramUsername':_0x2f9021['telegram'],'telegramBotApiKey':_0x569c50[_0x200fd5(0x146)]?this[_0x200fd5(0x158)](_0x569c50[_0x200fd5(0x146)]):null,'telegramChatId':_0x569c50[_0x200fd5(0x170)],'webhookUrl':_0x569c50[_0x200fd5(0x143)],'webhookEvents':this[_0x200fd5(0x15e)](_0x569c50[_0x200fd5(0x167)]),'notifications':{'payment_success':_0x569c50[_0x200fd5(0x168)],'payment_failed':_0x569c50['notificationPaymentFailed'],'refund':_0x569c50[_0x200fd5(0x154)],'payout':_0x569c50[_0x200fd5(0x147)],'login':_0x569c50['notificationLogin'],'api_error':_0x569c50[_0x200fd5(0x15b)]}};}async[a72_0x10a414(0x145)](_0x443c03,_0x2d943e){const _0x2155fa=a72_0x10a414,{currentPassword:_0x57dfa0,newPassword:_0x2b77d4,confirmNewPassword:_0x910965}=_0x2d943e;if(_0x2b77d4!==_0x910965)throw new Error(_0x2155fa(0x176));if(_0x2b77d4['length']<0x6)throw new Error(_0x2155fa(0x137));const _0xb3a61=await database_1[_0x2155fa(0x161)]['shop'][_0x2155fa(0x16b)]({'where':{'id':_0x443c03},'select':{'password':!![]}});if(!_0xb3a61)throw new Error('Shop\x20not\x20found');const _0x22d298=await bcryptjs_1[_0x2155fa(0x161)][_0x2155fa(0x159)](_0x57dfa0,_0xb3a61[_0x2155fa(0x13f)]);if(!_0x22d298)throw new Error(_0x2155fa(0x14d));const _0x309738=await bcryptjs_1[_0x2155fa(0x161)][_0x2155fa(0x173)](_0x2b77d4,0xc);await database_1[_0x2155fa(0x161)][_0x2155fa(0x15c)][_0x2155fa(0x150)]({'where':{'id':_0x443c03},'data':{'password':_0x309738}});}async[a72_0x10a414(0x174)](_0x2f390d,_0x14f0f9){const _0x1a4b23=a72_0x10a414;await this['ensureSettingsExist'](_0x2f390d);const _0x2c6a1f={};_0x14f0f9['payment_success']!==undefined&&(_0x2c6a1f[_0x1a4b23(0x168)]=_0x14f0f9[_0x1a4b23(0x156)]),_0x14f0f9[_0x1a4b23(0x15f)]!==undefined&&(_0x2c6a1f[_0x1a4b23(0x13b)]=_0x14f0f9['payment_failed']),_0x14f0f9[_0x1a4b23(0x169)]!==undefined&&(_0x2c6a1f[_0x1a4b23(0x154)]=_0x14f0f9[_0x1a4b23(0x169)]),_0x14f0f9['payout']!==undefined&&(_0x2c6a1f[_0x1a4b23(0x147)]=_0x14f0f9[_0x1a4b23(0x14c)]),_0x14f0f9[_0x1a4b23(0x138)]!==undefined&&(_0x2c6a1f[_0x1a4b23(0x172)]=_0x14f0f9[_0x1a4b23(0x138)]),_0x14f0f9[_0x1a4b23(0x142)]!==undefined&&(_0x2c6a1f[_0x1a4b23(0x15b)]=_0x14f0f9[_0x1a4b23(0x142)]),await database_1[_0x1a4b23(0x161)][_0x1a4b23(0x13d)][_0x1a4b23(0x150)]({'where':{'shopId':_0x2f390d},'data':_0x2c6a1f});}async[a72_0x10a414(0x144)](_0x34af4b,_0xa2e243){const _0x1204fd=a72_0x10a414;await this[_0x1204fd(0x155)](_0x34af4b);const _0x3c71d9={};_0xa2e243[_0x1204fd(0x151)]!==undefined&&(_0x3c71d9[_0x1204fd(0x146)]=_0xa2e243[_0x1204fd(0x151)]||null),_0xa2e243['chatId']!==undefined&&(_0x3c71d9['telegramChatId']=_0xa2e243[_0x1204fd(0x14a)]||null),await database_1['default'][_0x1204fd(0x13d)]['update']({'where':{'shopId':_0x34af4b},'data':_0x3c71d9});}async[a72_0x10a414(0x157)](_0x1e8bdf,_0xf87834){const _0x11f23a=a72_0x10a414;await this[_0x11f23a(0x155)](_0x1e8bdf);const _0x27895d={};_0xf87834[_0x11f23a(0x143)]!==undefined&&(_0x27895d['webhookUrl']=_0xf87834[_0x11f23a(0x143)]||null),_0xf87834[_0x11f23a(0x167)]!==undefined&&(_0x27895d['webhookEvents']=_0xf87834[_0x11f23a(0x167)]||[]),await database_1[_0x11f23a(0x161)]['shopSettings'][_0x11f23a(0x150)]({'where':{'shopId':_0x1e8bdf},'data':_0x27895d});}async[a72_0x10a414(0x162)](_0x24a952){const _0x5a8905=a72_0x10a414,_0x25bb1f='pk_'+crypto_1['default'][_0x5a8905(0x15d)](0x20)[_0x5a8905(0x14f)](_0x5a8905(0x16e)),_0x2eb6d2='sk_'+crypto_1[_0x5a8905(0x161)][_0x5a8905(0x15d)](0x20)[_0x5a8905(0x14f)](_0x5a8905(0x16e));await database_1[_0x5a8905(0x161)]['shop'][_0x5a8905(0x150)]({'where':{'id':_0x24a952},'data':{'publicKey':_0x25bb1f,'secretKey':_0x2eb6d2}});}async[a72_0x10a414(0x175)](_0x658361,_0x303445){const _0x11c029=a72_0x10a414,{passwordConfirmation:_0x210cf8}=_0x303445,_0x5d0686=await database_1[_0x11c029(0x161)][_0x11c029(0x15c)][_0x11c029(0x16b)]({'where':{'id':_0x658361},'select':{'password':!![]}});if(!_0x5d0686)throw new Error(_0x11c029(0x152));const _0x54dbcf=await bcryptjs_1[_0x11c029(0x161)][_0x11c029(0x159)](_0x210cf8,_0x5d0686['password']);if(!_0x54dbcf)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x11c029(0x161)][_0x11c029(0x15c)]['delete']({'where':{'id':_0x658361}});}async[a72_0x10a414(0x155)](_0x30602b){const _0x525b3b=a72_0x10a414,_0x15e73e=await database_1[_0x525b3b(0x161)]['shopSettings'][_0x525b3b(0x16b)]({'where':{'shopId':_0x30602b}});!_0x15e73e&&await database_1[_0x525b3b(0x161)][_0x525b3b(0x13d)][_0x525b3b(0x178)]({'data':{'shopId':_0x30602b}});}}exports['SettingsService']=SettingsService;