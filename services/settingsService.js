'use strict';const a55_0x206cfd=a55_0x2695;(function(_0x1bb5ea,_0x127165){const _0x19654d=a55_0x2695,_0x13dac2=_0x1bb5ea();while(!![]){try{const _0x30f5ed=-parseInt(_0x19654d(0x1d7))/0x1+-parseInt(_0x19654d(0x1bf))/0x2+-parseInt(_0x19654d(0x1be))/0x3+parseInt(_0x19654d(0x1ee))/0x4*(-parseInt(_0x19654d(0x1cd))/0x5)+parseInt(_0x19654d(0x1bb))/0x6*(-parseInt(_0x19654d(0x1d3))/0x7)+-parseInt(_0x19654d(0x1ad))/0x8*(-parseInt(_0x19654d(0x1d0))/0x9)+parseInt(_0x19654d(0x1ec))/0xa;if(_0x30f5ed===_0x127165)break;else _0x13dac2['push'](_0x13dac2['shift']());}catch(_0x537cdf){_0x13dac2['push'](_0x13dac2['shift']());}}}(a55_0x1368,0x3cf67));var __importDefault=this&&this[a55_0x206cfd(0x1b1)]||function(_0x440ddb){const _0x22c021=a55_0x206cfd;return _0x440ddb&&_0x440ddb[_0x22c021(0x1e8)]?_0x440ddb:{'default':_0x440ddb};};Object[a55_0x206cfd(0x1b7)](exports,a55_0x206cfd(0x1e8),{'value':!![]}),exports[a55_0x206cfd(0x1bd)]=void 0x0;function a55_0x1368(){const _0x2d6839=['parseWebhookEvents','name','refund','6UfKRYW','payment_success','SettingsService','965673zTJALK','396236XLYrqb','botApiKey','../config/database','chatId','login','hex','Shop\x20not\x20found','notificationLogin','Password\x20confirmation\x20is\x20incorrect','string','updateTelegramSettings','settings','api_error','notificationRefund','99995tLJADU','compare','shopSettings','3567411rqqrYs','isArray','telegramBotApiKey','584143TAZqBs','changePassword','bcryptjs','notificationApiError','384664jRKoyA','delete','parse','telegramChatId','webhookEvents','revokeAllApiKeys','maskApiKey','shop','password','telegram','findUnique','notificationPayout','shopUrl','length','deleteAccount','notificationPaymentFailed','update','__esModule','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','default','create','13014230ROptDZ','Current\x20password\x20is\x20incorrect','92WdSomD','webhookUrl','ensureSettingsExist','sk_','payment_failed','8oQpwds','substring','randomBytes','hash','__importDefault','pk_','max','repeat','payout','toString','defineProperty'];a55_0x1368=function(){return _0x2d6839;};return a55_0x1368();}function a55_0x2695(_0x5e11a1,_0x143f06){const _0x136814=a55_0x1368();return a55_0x2695=function(_0x2695e6,_0xdc04d6){_0x2695e6=_0x2695e6-0x1aa;let _0x24f551=_0x136814[_0x2695e6];return _0x24f551;},a55_0x2695(_0x5e11a1,_0x143f06);}const bcryptjs_1=__importDefault(require(a55_0x206cfd(0x1d5))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a55_0x206cfd(0x1c1)));class SettingsService{[a55_0x206cfd(0x1dd)](_0x34ecd4){const _0x4f9114=a55_0x206cfd;if(!_0x34ecd4)return'';if(_0x34ecd4[_0x4f9114(0x1e4)]<=0x8)return _0x34ecd4;const _0x3a853c=_0x34ecd4[_0x4f9114(0x1ae)](0x0,0x8),_0x445535='*'[_0x4f9114(0x1b4)](Math[_0x4f9114(0x1b3)](0x0,_0x34ecd4['length']-0x8));return _0x3a853c+_0x445535;}[a55_0x206cfd(0x1b8)](_0x166490){const _0x827fa2=a55_0x206cfd;if(!_0x166490)return[];if(Array[_0x827fa2(0x1d1)](_0x166490))return _0x166490;if(typeof _0x166490===_0x827fa2(0x1c8))try{const _0x30dc5e=JSON[_0x827fa2(0x1d9)](_0x166490);return Array[_0x827fa2(0x1d1)](_0x30dc5e)?_0x30dc5e:[];}catch{return[];}return[];}async['getShopSettings'](_0x534928){const _0x50da7e=a55_0x206cfd,_0xec09ac=await database_1['default']['shop'][_0x50da7e(0x1e1)]({'where':{'id':_0x534928},'include':{'settings':!![]}});if(!_0xec09ac)throw new Error(_0x50da7e(0x1c5));let _0x30259e=_0xec09ac[_0x50da7e(0x1ca)];return!_0x30259e&&(_0x30259e=await database_1[_0x50da7e(0x1ea)][_0x50da7e(0x1cf)][_0x50da7e(0x1eb)]({'data':{'shopId':_0xec09ac['id']}})),{'fullName':_0xec09ac['name'],'brand':_0xec09ac[_0x50da7e(0x1b9)],'merchantUrl':_0xec09ac[_0x50da7e(0x1e3)],'telegramUsername':_0xec09ac[_0x50da7e(0x1e0)],'telegramBotApiKey':_0x30259e[_0x50da7e(0x1d2)]?this[_0x50da7e(0x1dd)](_0x30259e[_0x50da7e(0x1d2)]):null,'telegramChatId':_0x30259e[_0x50da7e(0x1da)],'webhookUrl':_0x30259e['webhookUrl'],'webhookEvents':this[_0x50da7e(0x1b8)](_0x30259e[_0x50da7e(0x1db)]),'notifications':{'payment_success':_0x30259e['notificationPaymentSuccess'],'payment_failed':_0x30259e[_0x50da7e(0x1e6)],'refund':_0x30259e[_0x50da7e(0x1cc)],'payout':_0x30259e['notificationPayout'],'login':_0x30259e[_0x50da7e(0x1c6)],'api_error':_0x30259e[_0x50da7e(0x1d6)]}};}async[a55_0x206cfd(0x1d4)](_0x142740,_0x60a6b4){const _0x2d7feb=a55_0x206cfd,{currentPassword:_0x3c91ef,newPassword:_0x313e94,confirmNewPassword:_0x20fb01}=_0x60a6b4;if(_0x313e94!==_0x20fb01)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x313e94[_0x2d7feb(0x1e4)]<0x6)throw new Error(_0x2d7feb(0x1e9));const _0xfafdc3=await database_1['default'][_0x2d7feb(0x1de)][_0x2d7feb(0x1e1)]({'where':{'id':_0x142740},'select':{'password':!![]}});if(!_0xfafdc3)throw new Error(_0x2d7feb(0x1c5));const _0x4a16a8=await bcryptjs_1['default'][_0x2d7feb(0x1ce)](_0x3c91ef,_0xfafdc3[_0x2d7feb(0x1df)]);if(!_0x4a16a8)throw new Error(_0x2d7feb(0x1ed));const _0x3bf4fe=await bcryptjs_1['default'][_0x2d7feb(0x1b0)](_0x313e94,0xc);await database_1[_0x2d7feb(0x1ea)][_0x2d7feb(0x1de)]['update']({'where':{'id':_0x142740},'data':{'password':_0x3bf4fe}});}async['updateNotifications'](_0x8b21ec,_0x198b08){const _0x3bac18=a55_0x206cfd;await this[_0x3bac18(0x1aa)](_0x8b21ec);const _0x2e1dbb={};_0x198b08[_0x3bac18(0x1bc)]!==undefined&&(_0x2e1dbb['notificationPaymentSuccess']=_0x198b08[_0x3bac18(0x1bc)]),_0x198b08[_0x3bac18(0x1ac)]!==undefined&&(_0x2e1dbb['notificationPaymentFailed']=_0x198b08[_0x3bac18(0x1ac)]),_0x198b08[_0x3bac18(0x1ba)]!==undefined&&(_0x2e1dbb[_0x3bac18(0x1cc)]=_0x198b08[_0x3bac18(0x1ba)]),_0x198b08[_0x3bac18(0x1b5)]!==undefined&&(_0x2e1dbb[_0x3bac18(0x1e2)]=_0x198b08[_0x3bac18(0x1b5)]),_0x198b08[_0x3bac18(0x1c3)]!==undefined&&(_0x2e1dbb[_0x3bac18(0x1c6)]=_0x198b08[_0x3bac18(0x1c3)]),_0x198b08[_0x3bac18(0x1cb)]!==undefined&&(_0x2e1dbb['notificationApiError']=_0x198b08[_0x3bac18(0x1cb)]),await database_1[_0x3bac18(0x1ea)]['shopSettings']['update']({'where':{'shopId':_0x8b21ec},'data':_0x2e1dbb});}async[a55_0x206cfd(0x1c9)](_0x506aaf,_0x45a1fa){const _0x4990ed=a55_0x206cfd;await this[_0x4990ed(0x1aa)](_0x506aaf);const _0x454fed={};_0x45a1fa[_0x4990ed(0x1c0)]!==undefined&&(_0x454fed[_0x4990ed(0x1d2)]=_0x45a1fa['botApiKey']||null),_0x45a1fa[_0x4990ed(0x1c2)]!==undefined&&(_0x454fed['telegramChatId']=_0x45a1fa[_0x4990ed(0x1c2)]||null),await database_1['default'][_0x4990ed(0x1cf)][_0x4990ed(0x1e7)]({'where':{'shopId':_0x506aaf},'data':_0x454fed});}async['updateWebhookSettings'](_0x20b888,_0x4a695f){const _0x41f1f6=a55_0x206cfd;await this[_0x41f1f6(0x1aa)](_0x20b888);const _0x1229a1={};_0x4a695f[_0x41f1f6(0x1ef)]!==undefined&&(_0x1229a1[_0x41f1f6(0x1ef)]=_0x4a695f[_0x41f1f6(0x1ef)]||null),_0x4a695f[_0x41f1f6(0x1db)]!==undefined&&(_0x1229a1['webhookEvents']=_0x4a695f[_0x41f1f6(0x1db)]||[]),await database_1[_0x41f1f6(0x1ea)]['shopSettings']['update']({'where':{'shopId':_0x20b888},'data':_0x1229a1});}async[a55_0x206cfd(0x1dc)](_0x1c68ee){const _0x151c81=a55_0x206cfd,_0x12e039=_0x151c81(0x1b2)+crypto_1['default'][_0x151c81(0x1af)](0x20)[_0x151c81(0x1b6)](_0x151c81(0x1c4)),_0x15a01e=_0x151c81(0x1ab)+crypto_1[_0x151c81(0x1ea)][_0x151c81(0x1af)](0x20)[_0x151c81(0x1b6)](_0x151c81(0x1c4));await database_1[_0x151c81(0x1ea)][_0x151c81(0x1de)]['update']({'where':{'id':_0x1c68ee},'data':{'publicKey':_0x12e039,'secretKey':_0x15a01e}});}async[a55_0x206cfd(0x1e5)](_0x51daf3,_0x42f745){const _0x1aeac7=a55_0x206cfd,{passwordConfirmation:_0x3f5de7}=_0x42f745,_0x1ba316=await database_1[_0x1aeac7(0x1ea)][_0x1aeac7(0x1de)]['findUnique']({'where':{'id':_0x51daf3},'select':{'password':!![]}});if(!_0x1ba316)throw new Error(_0x1aeac7(0x1c5));const _0x57a71e=await bcryptjs_1[_0x1aeac7(0x1ea)][_0x1aeac7(0x1ce)](_0x3f5de7,_0x1ba316[_0x1aeac7(0x1df)]);if(!_0x57a71e)throw new Error(_0x1aeac7(0x1c7));await database_1[_0x1aeac7(0x1ea)][_0x1aeac7(0x1de)][_0x1aeac7(0x1d8)]({'where':{'id':_0x51daf3}});}async[a55_0x206cfd(0x1aa)](_0x2451b1){const _0x31dbde=a55_0x206cfd,_0x1660a4=await database_1[_0x31dbde(0x1ea)]['shopSettings'][_0x31dbde(0x1e1)]({'where':{'shopId':_0x2451b1}});!_0x1660a4&&await database_1[_0x31dbde(0x1ea)]['shopSettings'][_0x31dbde(0x1eb)]({'data':{'shopId':_0x2451b1}});}}exports[a55_0x206cfd(0x1bd)]=SettingsService;