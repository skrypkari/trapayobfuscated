'use strict';const a53_0x585914=a53_0x3308;function a53_0x3308(_0x209df9,_0x41cd68){const _0x486d1d=a53_0x486d();return a53_0x3308=function(_0x33082a,_0x4faa8b){_0x33082a=_0x33082a-0x15c;let _0x450410=_0x486d1d[_0x33082a];return _0x450410;},a53_0x3308(_0x209df9,_0x41cd68);}(function(_0x2137b1,_0x25fc77){const _0x3e930f=a53_0x3308,_0x468c59=_0x2137b1();while(!![]){try{const _0x49bfa3=parseInt(_0x3e930f(0x188))/0x1+parseInt(_0x3e930f(0x187))/0x2+parseInt(_0x3e930f(0x165))/0x3*(parseInt(_0x3e930f(0x175))/0x4)+-parseInt(_0x3e930f(0x17b))/0x5+-parseInt(_0x3e930f(0x179))/0x6+-parseInt(_0x3e930f(0x198))/0x7*(-parseInt(_0x3e930f(0x17a))/0x8)+parseInt(_0x3e930f(0x18f))/0x9*(-parseInt(_0x3e930f(0x170))/0xa);if(_0x49bfa3===_0x25fc77)break;else _0x468c59['push'](_0x468c59['shift']());}catch(_0x4ae423){_0x468c59['push'](_0x468c59['shift']());}}}(a53_0x486d,0xea1a4));var __importDefault=this&&this['__importDefault']||function(_0xaef843){const _0x332df7=a53_0x3308;return _0xaef843&&_0xaef843[_0x332df7(0x168)]?_0xaef843:{'default':_0xaef843};};function a53_0x486d(){const _0x5cc3fe=['../config/database','telegram','telegramBotApiKey','parseWebhookEvents','substring','9HzmfNW','payout','api_error','telegramChatId','toString','notificationPaymentFailed','hex','login','default','56PgCOgA','sk_','webhookEvents','shopSettings','botApiKey','getShopSettings','refund','defineProperty','findUnique','revokeAllApiKeys','notificationPayout','chatId','SettingsService','171XYNneu','updateWebhookSettings','max','__esModule','maskApiKey','crypto','update','notificationApiError','randomBytes','Current\x20password\x20is\x20incorrect','pk_','4014730kLcXnU','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','ensureSettingsExist','settings','80876gEjvvo','changePassword','create','notificationRefund','8237598zczDFy','50408Uyacfd','239785prFYOT','webhookUrl','shop','name','compare','deleteAccount','Shop\x20not\x20found','password','length','repeat','updateTelegramSettings','notificationLogin','2979066PanbOx','88823SomERg','notificationPaymentSuccess'];a53_0x486d=function(){return _0x5cc3fe;};return a53_0x486d();}Object[a53_0x585914(0x15f)](exports,a53_0x585914(0x168),{'value':!![]}),exports[a53_0x585914(0x164)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a53_0x585914(0x16a))),database_1=__importDefault(require(a53_0x585914(0x18a)));class SettingsService{[a53_0x585914(0x169)](_0x3f1e98){const _0x4710bd=a53_0x585914;if(!_0x3f1e98)return'';if(_0x3f1e98[_0x4710bd(0x183)]<=0x8)return _0x3f1e98;const _0x559c0b=_0x3f1e98[_0x4710bd(0x18e)](0x0,0x8),_0x3ec908='*'[_0x4710bd(0x184)](Math[_0x4710bd(0x167)](0x0,_0x3f1e98[_0x4710bd(0x183)]-0x8));return _0x559c0b+_0x3ec908;}[a53_0x585914(0x18d)](_0x367f73){if(!_0x367f73)return[];if(Array['isArray'](_0x367f73))return _0x367f73;if(typeof _0x367f73==='string')try{const _0x58de2f=JSON['parse'](_0x367f73);return Array['isArray'](_0x58de2f)?_0x58de2f:[];}catch{return[];}return[];}async[a53_0x585914(0x15d)](_0x4278e8){const _0x498d59=a53_0x585914,_0x553c56=await database_1[_0x498d59(0x197)]['shop']['findUnique']({'where':{'id':_0x4278e8},'include':{'settings':!![]}});if(!_0x553c56)throw new Error(_0x498d59(0x181));let _0xf10788=_0x553c56[_0x498d59(0x174)];return!_0xf10788&&(_0xf10788=await database_1[_0x498d59(0x197)][_0x498d59(0x19b)][_0x498d59(0x177)]({'data':{'shopId':_0x553c56['id']}})),{'fullName':_0x553c56[_0x498d59(0x17e)],'brand':_0x553c56[_0x498d59(0x17e)],'merchantUrl':_0x553c56['shopUrl'],'telegramUsername':_0x553c56[_0x498d59(0x18b)],'telegramBotApiKey':_0xf10788['telegramBotApiKey']?this['maskApiKey'](_0xf10788[_0x498d59(0x18c)]):null,'telegramChatId':_0xf10788[_0x498d59(0x192)],'webhookUrl':_0xf10788[_0x498d59(0x17c)],'webhookEvents':this['parseWebhookEvents'](_0xf10788[_0x498d59(0x19a)]),'notifications':{'payment_success':_0xf10788[_0x498d59(0x189)],'payment_failed':_0xf10788['notificationPaymentFailed'],'refund':_0xf10788[_0x498d59(0x178)],'payout':_0xf10788[_0x498d59(0x162)],'login':_0xf10788[_0x498d59(0x186)],'api_error':_0xf10788[_0x498d59(0x16c)]}};}async[a53_0x585914(0x176)](_0x25194d,_0x32a83a){const _0x5f4587=a53_0x585914,{currentPassword:_0xce2fdd,newPassword:_0x59eb16,confirmNewPassword:_0x4a89d0}=_0x32a83a;if(_0x59eb16!==_0x4a89d0)throw new Error(_0x5f4587(0x171));if(_0x59eb16[_0x5f4587(0x183)]<0x6)throw new Error(_0x5f4587(0x172));const _0x2c39fa=await database_1[_0x5f4587(0x197)][_0x5f4587(0x17d)]['findUnique']({'where':{'id':_0x25194d},'select':{'password':!![]}});if(!_0x2c39fa)throw new Error(_0x5f4587(0x181));const _0x2ce722=await bcryptjs_1['default'][_0x5f4587(0x17f)](_0xce2fdd,_0x2c39fa[_0x5f4587(0x182)]);if(!_0x2ce722)throw new Error(_0x5f4587(0x16e));const _0x49b985=await bcryptjs_1[_0x5f4587(0x197)]['hash'](_0x59eb16,0xc);await database_1[_0x5f4587(0x197)][_0x5f4587(0x17d)][_0x5f4587(0x16b)]({'where':{'id':_0x25194d},'data':{'password':_0x49b985}});}async['updateNotifications'](_0x108da7,_0x3317c9){const _0x2b2560=a53_0x585914;await this['ensureSettingsExist'](_0x108da7);const _0x19e06c={};_0x3317c9['payment_success']!==undefined&&(_0x19e06c[_0x2b2560(0x189)]=_0x3317c9['payment_success']),_0x3317c9['payment_failed']!==undefined&&(_0x19e06c[_0x2b2560(0x194)]=_0x3317c9['payment_failed']),_0x3317c9[_0x2b2560(0x15e)]!==undefined&&(_0x19e06c[_0x2b2560(0x178)]=_0x3317c9[_0x2b2560(0x15e)]),_0x3317c9['payout']!==undefined&&(_0x19e06c['notificationPayout']=_0x3317c9[_0x2b2560(0x190)]),_0x3317c9[_0x2b2560(0x196)]!==undefined&&(_0x19e06c[_0x2b2560(0x186)]=_0x3317c9[_0x2b2560(0x196)]),_0x3317c9[_0x2b2560(0x191)]!==undefined&&(_0x19e06c[_0x2b2560(0x16c)]=_0x3317c9[_0x2b2560(0x191)]),await database_1[_0x2b2560(0x197)]['shopSettings'][_0x2b2560(0x16b)]({'where':{'shopId':_0x108da7},'data':_0x19e06c});}async[a53_0x585914(0x185)](_0x24ac81,_0x37a93b){const _0x437840=a53_0x585914;await this['ensureSettingsExist'](_0x24ac81);const _0x62204d={};_0x37a93b[_0x437840(0x15c)]!==undefined&&(_0x62204d[_0x437840(0x18c)]=_0x37a93b['botApiKey']||null),_0x37a93b['chatId']!==undefined&&(_0x62204d[_0x437840(0x192)]=_0x37a93b[_0x437840(0x163)]||null),await database_1['default'][_0x437840(0x19b)][_0x437840(0x16b)]({'where':{'shopId':_0x24ac81},'data':_0x62204d});}async[a53_0x585914(0x166)](_0x565f87,_0xf51403){const _0x20f624=a53_0x585914;await this['ensureSettingsExist'](_0x565f87);const _0x3324bf={};_0xf51403[_0x20f624(0x17c)]!==undefined&&(_0x3324bf['webhookUrl']=_0xf51403[_0x20f624(0x17c)]||null),_0xf51403[_0x20f624(0x19a)]!==undefined&&(_0x3324bf[_0x20f624(0x19a)]=_0xf51403['webhookEvents']||[]),await database_1[_0x20f624(0x197)][_0x20f624(0x19b)]['update']({'where':{'shopId':_0x565f87},'data':_0x3324bf});}async[a53_0x585914(0x161)](_0x48d7c6){const _0x9b1fc8=a53_0x585914,_0x2cb70a=_0x9b1fc8(0x16f)+crypto_1['default'][_0x9b1fc8(0x16d)](0x20)[_0x9b1fc8(0x193)](_0x9b1fc8(0x195)),_0x4ec8a7=_0x9b1fc8(0x199)+crypto_1[_0x9b1fc8(0x197)][_0x9b1fc8(0x16d)](0x20)[_0x9b1fc8(0x193)](_0x9b1fc8(0x195));await database_1[_0x9b1fc8(0x197)][_0x9b1fc8(0x17d)][_0x9b1fc8(0x16b)]({'where':{'id':_0x48d7c6},'data':{'publicKey':_0x2cb70a,'secretKey':_0x4ec8a7}});}async[a53_0x585914(0x180)](_0x272ec6,_0x5cf941){const _0x2fd4d4=a53_0x585914,{passwordConfirmation:_0x357356}=_0x5cf941,_0x3d566f=await database_1[_0x2fd4d4(0x197)][_0x2fd4d4(0x17d)][_0x2fd4d4(0x160)]({'where':{'id':_0x272ec6},'select':{'password':!![]}});if(!_0x3d566f)throw new Error(_0x2fd4d4(0x181));const _0x58554c=await bcryptjs_1[_0x2fd4d4(0x197)][_0x2fd4d4(0x17f)](_0x357356,_0x3d566f[_0x2fd4d4(0x182)]);if(!_0x58554c)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x2fd4d4(0x197)][_0x2fd4d4(0x17d)]['delete']({'where':{'id':_0x272ec6}});}async[a53_0x585914(0x173)](_0x5f189a){const _0x5ea09c=a53_0x585914,_0x453e01=await database_1['default']['shopSettings'][_0x5ea09c(0x160)]({'where':{'shopId':_0x5f189a}});!_0x453e01&&await database_1[_0x5ea09c(0x197)][_0x5ea09c(0x19b)]['create']({'data':{'shopId':_0x5f189a}});}}exports[a53_0x585914(0x164)]=SettingsService;