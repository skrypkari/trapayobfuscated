'use strict';const a55_0x1482c6=a55_0x5161;(function(_0x466071,_0x4c52f9){const _0x403ce7=a55_0x5161,_0x1fb2a7=_0x466071();while(!![]){try{const _0x315eee=-parseInt(_0x403ce7(0x1d0))/0x1*(parseInt(_0x403ce7(0x1b3))/0x2)+-parseInt(_0x403ce7(0x1c5))/0x3+parseInt(_0x403ce7(0x1b8))/0x4*(parseInt(_0x403ce7(0x1db))/0x5)+parseInt(_0x403ce7(0x1ad))/0x6*(parseInt(_0x403ce7(0x1ce))/0x7)+parseInt(_0x403ce7(0x1a2))/0x8*(parseInt(_0x403ce7(0x1dc))/0x9)+-parseInt(_0x403ce7(0x1ca))/0xa+-parseInt(_0x403ce7(0x1b6))/0xb*(-parseInt(_0x403ce7(0x1cd))/0xc);if(_0x315eee===_0x4c52f9)break;else _0x1fb2a7['push'](_0x1fb2a7['shift']());}catch(_0x4d522e){_0x1fb2a7['push'](_0x1fb2a7['shift']());}}}(a55_0x2a28,0xcb782));function a55_0x5161(_0x86fb42,_0x5c92b4){const _0x2a28ae=a55_0x2a28();return a55_0x5161=function(_0x51619d,_0x2d5180){_0x51619d=_0x51619d-0x198;let _0x5d393a=_0x2a28ae[_0x51619d];return _0x5d393a;},a55_0x5161(_0x86fb42,_0x5c92b4);}var __importDefault=this&&this['__importDefault']||function(_0x1bfeae){const _0x259c58=a55_0x5161;return _0x1bfeae&&_0x1bfeae[_0x259c58(0x1b5)]?_0x1bfeae:{'default':_0x1bfeae};};Object['defineProperty'](exports,a55_0x1482c6(0x1b5),{'value':!![]}),exports[a55_0x1482c6(0x1d5)]=void 0x0;const bcryptjs_1=__importDefault(require(a55_0x1482c6(0x1c1))),crypto_1=__importDefault(require(a55_0x1482c6(0x1ab))),database_1=__importDefault(require(a55_0x1482c6(0x1cc)));class SettingsService{[a55_0x1482c6(0x199)](_0x3a4e01){const _0x52f4e9=a55_0x1482c6;if(!_0x3a4e01)return'';if(_0x3a4e01['length']<=0x8)return _0x3a4e01;const _0x2daeb4=_0x3a4e01[_0x52f4e9(0x1a8)](0x0,0x8),_0xf9755d='*'['repeat'](Math[_0x52f4e9(0x1a3)](0x0,_0x3a4e01[_0x52f4e9(0x1de)]-0x8));return _0x2daeb4+_0xf9755d;}[a55_0x1482c6(0x1d8)](_0x322a0d){const _0x5c19c7=a55_0x1482c6;if(!_0x322a0d)return[];if(Array[_0x5c19c7(0x19e)](_0x322a0d))return _0x322a0d;if(typeof _0x322a0d===_0x5c19c7(0x1d9))try{const _0x4e7812=JSON[_0x5c19c7(0x1d4)](_0x322a0d);return Array[_0x5c19c7(0x19e)](_0x4e7812)?_0x4e7812:[];}catch{return[];}return[];}async[a55_0x1482c6(0x1b4)](_0x4b8089){const _0x182486=a55_0x1482c6,_0x7de5f4=await database_1['default'][_0x182486(0x1ae)][_0x182486(0x1a0)]({'where':{'id':_0x4b8089},'include':{'settings':!![]}});if(!_0x7de5f4)throw new Error('Shop\x20not\x20found');let _0x52f303=_0x7de5f4[_0x182486(0x1b1)];return!_0x52f303&&(_0x52f303=await database_1[_0x182486(0x198)][_0x182486(0x1c0)][_0x182486(0x1c4)]({'data':{'shopId':_0x7de5f4['id']}})),{'fullName':_0x7de5f4[_0x182486(0x1c7)],'brand':_0x7de5f4[_0x182486(0x1c7)],'merchantUrl':_0x7de5f4[_0x182486(0x1bf)],'telegramUsername':_0x7de5f4[_0x182486(0x19a)],'telegramBotApiKey':_0x52f303[_0x182486(0x1a1)]?this[_0x182486(0x199)](_0x52f303['telegramBotApiKey']):null,'telegramChatId':_0x52f303[_0x182486(0x1ba)],'webhookUrl':_0x52f303[_0x182486(0x1aa)],'webhookEvents':this[_0x182486(0x1d8)](_0x52f303['webhookEvents']),'notifications':{'payment_success':_0x52f303['notificationPaymentSuccess'],'payment_failed':_0x52f303[_0x182486(0x1bd)],'refund':_0x52f303[_0x182486(0x1af)],'payout':_0x52f303['notificationPayout'],'login':_0x52f303['notificationLogin'],'api_error':_0x52f303[_0x182486(0x19b)]}};}async[a55_0x1482c6(0x1a4)](_0x38ed73,_0x2d54f6){const _0x1276b5=a55_0x1482c6,{currentPassword:_0x126dcd,newPassword:_0x540e06,confirmNewPassword:_0x4428b7}=_0x2d54f6;if(_0x540e06!==_0x4428b7)throw new Error(_0x1276b5(0x1b0));if(_0x540e06[_0x1276b5(0x1de)]<0x6)throw new Error(_0x1276b5(0x1ac));const _0x278c3f=await database_1[_0x1276b5(0x198)]['shop']['findUnique']({'where':{'id':_0x38ed73},'select':{'password':!![]}});if(!_0x278c3f)throw new Error('Shop\x20not\x20found');const _0x5b8766=await bcryptjs_1[_0x1276b5(0x198)][_0x1276b5(0x19c)](_0x126dcd,_0x278c3f[_0x1276b5(0x1c3)]);if(!_0x5b8766)throw new Error(_0x1276b5(0x1b2));const _0x33824a=await bcryptjs_1[_0x1276b5(0x198)]['hash'](_0x540e06,0xc);await database_1['default'][_0x1276b5(0x1ae)]['update']({'where':{'id':_0x38ed73},'data':{'password':_0x33824a}});}async[a55_0x1482c6(0x1d3)](_0xe56d77,_0x362a8d){const _0x56b5ac=a55_0x1482c6;await this['ensureSettingsExist'](_0xe56d77);const _0x2a2e62={};_0x362a8d[_0x56b5ac(0x1c6)]!==undefined&&(_0x2a2e62[_0x56b5ac(0x1a9)]=_0x362a8d[_0x56b5ac(0x1c6)]),_0x362a8d['payment_failed']!==undefined&&(_0x2a2e62[_0x56b5ac(0x1bd)]=_0x362a8d[_0x56b5ac(0x1bc)]),_0x362a8d[_0x56b5ac(0x1c9)]!==undefined&&(_0x2a2e62['notificationRefund']=_0x362a8d[_0x56b5ac(0x1c9)]),_0x362a8d[_0x56b5ac(0x1d2)]!==undefined&&(_0x2a2e62[_0x56b5ac(0x19d)]=_0x362a8d[_0x56b5ac(0x1d2)]),_0x362a8d[_0x56b5ac(0x1a5)]!==undefined&&(_0x2a2e62['notificationLogin']=_0x362a8d[_0x56b5ac(0x1a5)]),_0x362a8d[_0x56b5ac(0x19f)]!==undefined&&(_0x2a2e62[_0x56b5ac(0x19b)]=_0x362a8d[_0x56b5ac(0x19f)]),await database_1[_0x56b5ac(0x198)][_0x56b5ac(0x1c0)][_0x56b5ac(0x1cb)]({'where':{'shopId':_0xe56d77},'data':_0x2a2e62});}async[a55_0x1482c6(0x1a7)](_0x250bee,_0x392393){const _0x341673=a55_0x1482c6;await this[_0x341673(0x1b7)](_0x250bee);const _0xf58b20={};_0x392393[_0x341673(0x1b9)]!==undefined&&(_0xf58b20[_0x341673(0x1a1)]=_0x392393[_0x341673(0x1b9)]||null),_0x392393['chatId']!==undefined&&(_0xf58b20[_0x341673(0x1ba)]=_0x392393[_0x341673(0x1d1)]||null),await database_1[_0x341673(0x198)][_0x341673(0x1c0)][_0x341673(0x1cb)]({'where':{'shopId':_0x250bee},'data':_0xf58b20});}async[a55_0x1482c6(0x1c8)](_0x393aef,_0x57c36a){const _0x146a06=a55_0x1482c6;await this['ensureSettingsExist'](_0x393aef);const _0x1e9795={};_0x57c36a[_0x146a06(0x1aa)]!==undefined&&(_0x1e9795['webhookUrl']=_0x57c36a[_0x146a06(0x1aa)]||null),_0x57c36a[_0x146a06(0x1bb)]!==undefined&&(_0x1e9795[_0x146a06(0x1bb)]=_0x57c36a[_0x146a06(0x1bb)]||[]),await database_1[_0x146a06(0x198)][_0x146a06(0x1c0)]['update']({'where':{'shopId':_0x393aef},'data':_0x1e9795});}async[a55_0x1482c6(0x1cf)](_0x11b82a){const _0x4e7726=a55_0x1482c6,_0x1e0afb='pk_'+crypto_1[_0x4e7726(0x198)]['randomBytes'](0x20)[_0x4e7726(0x1c2)](_0x4e7726(0x1d6)),_0x455451=_0x4e7726(0x1d7)+crypto_1[_0x4e7726(0x198)][_0x4e7726(0x1be)](0x20)[_0x4e7726(0x1c2)](_0x4e7726(0x1d6));await database_1[_0x4e7726(0x198)][_0x4e7726(0x1ae)][_0x4e7726(0x1cb)]({'where':{'id':_0x11b82a},'data':{'publicKey':_0x1e0afb,'secretKey':_0x455451}});}async[a55_0x1482c6(0x1dd)](_0x402445,_0x4e9d6d){const _0x4c2b36=a55_0x1482c6,{passwordConfirmation:_0x247df0}=_0x4e9d6d,_0x2fa9b7=await database_1[_0x4c2b36(0x198)][_0x4c2b36(0x1ae)][_0x4c2b36(0x1a0)]({'where':{'id':_0x402445},'select':{'password':!![]}});if(!_0x2fa9b7)throw new Error(_0x4c2b36(0x1a6));const _0x3b003f=await bcryptjs_1[_0x4c2b36(0x198)][_0x4c2b36(0x19c)](_0x247df0,_0x2fa9b7[_0x4c2b36(0x1c3)]);if(!_0x3b003f)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x4c2b36(0x198)]['shop'][_0x4c2b36(0x1da)]({'where':{'id':_0x402445}});}async[a55_0x1482c6(0x1b7)](_0x2c55f0){const _0x44c2be=a55_0x1482c6,_0x280ca2=await database_1[_0x44c2be(0x198)][_0x44c2be(0x1c0)][_0x44c2be(0x1a0)]({'where':{'shopId':_0x2c55f0}});!_0x280ca2&&await database_1[_0x44c2be(0x198)][_0x44c2be(0x1c0)][_0x44c2be(0x1c4)]({'data':{'shopId':_0x2c55f0}});}}exports[a55_0x1482c6(0x1d5)]=SettingsService;function a55_0x2a28(){const _0xdef6fd=['randomBytes','shopUrl','shopSettings','bcryptjs','toString','password','create','2767332LNCzYH','payment_success','name','updateWebhookSettings','refund','9026180rpSyRY','update','../config/database','1380HQZvlK','3882179terVNS','revokeAllApiKeys','49277dypvkt','chatId','payout','updateNotifications','parse','SettingsService','hex','sk_','parseWebhookEvents','string','delete','36825OyuwBr','9CWAPcG','deleteAccount','length','default','maskApiKey','telegram','notificationApiError','compare','notificationPayout','isArray','api_error','findUnique','telegramBotApiKey','2468584sxbCPq','max','changePassword','login','Shop\x20not\x20found','updateTelegramSettings','substring','notificationPaymentSuccess','webhookUrl','crypto','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','18GNbuHU','shop','notificationRefund','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','settings','Current\x20password\x20is\x20incorrect','32jKPQxj','getShopSettings','__esModule','26213QayWas','ensureSettingsExist','652kjnCoj','botApiKey','telegramChatId','webhookEvents','payment_failed','notificationPaymentFailed'];a55_0x2a28=function(){return _0xdef6fd;};return a55_0x2a28();}