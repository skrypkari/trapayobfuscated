'use strict';const a53_0x34bdc3=a53_0x51e2;(function(_0x3251a6,_0xcbc6aa){const _0x345209=a53_0x51e2,_0x2d7757=_0x3251a6();while(!![]){try{const _0x4e53ec=-parseInt(_0x345209(0x18b))/0x1*(parseInt(_0x345209(0x157))/0x2)+-parseInt(_0x345209(0x17d))/0x3+-parseInt(_0x345209(0x16a))/0x4+parseInt(_0x345209(0x194))/0x5+-parseInt(_0x345209(0x172))/0x6+parseInt(_0x345209(0x188))/0x7*(-parseInt(_0x345209(0x15f))/0x8)+parseInt(_0x345209(0x14d))/0x9;if(_0x4e53ec===_0xcbc6aa)break;else _0x2d7757['push'](_0x2d7757['shift']());}catch(_0x379178){_0x2d7757['push'](_0x2d7757['shift']());}}}(a53_0x3c2e,0x3eed0));function a53_0x51e2(_0x3c212b,_0x1d4fd1){const _0x3c2eb4=a53_0x3c2e();return a53_0x51e2=function(_0x51e287,_0x80dd68){_0x51e287=_0x51e287-0x14d;let _0x10d74c=_0x3c2eb4[_0x51e287];return _0x10d74c;},a53_0x51e2(_0x3c212b,_0x1d4fd1);}var __importDefault=this&&this['__importDefault']||function(_0x2b2526){const _0x3c7a14=a53_0x51e2;return _0x2b2526&&_0x2b2526[_0x3c7a14(0x18f)]?_0x2b2526:{'default':_0x2b2526};};Object[a53_0x34bdc3(0x17e)](exports,'__esModule',{'value':!![]}),exports[a53_0x34bdc3(0x174)]=void 0x0;function a53_0x3c2e(){const _0x494547=['api_error','notificationRefund','notificationApiError','create','shopUrl','notificationPaymentSuccess','878604bOwmEP','defineProperty','isArray','updateTelegramSettings','getShopSettings','pk_','telegramChatId','updateNotifications','telegram','payment_failed','webhookUrl','234857AEGGKs','hex','parseWebhookEvents','10103OPWRqw','delete','password','shop','__esModule','settings','login','max','ensureSettingsExist','316040rGmlfc','13912749inJDBo','Password\x20confirmation\x20is\x20incorrect','substring','changePassword','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','notificationPaymentFailed','bcryptjs','telegramBotApiKey','length','sk_','50SSXHul','notificationLogin','Shop\x20not\x20found','deleteAccount','crypto','repeat','update','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','104ODNpdG','toString','Current\x20password\x20is\x20incorrect','chatId','shopSettings','botApiKey','default','payment_success','webhookEvents','hash','payout','1294640QQNISH','maskApiKey','../config/database','randomBytes','revokeAllApiKeys','name','refund','findUnique','276354CsENiR','compare','SettingsService','string','notificationPayout'];a53_0x3c2e=function(){return _0x494547;};return a53_0x3c2e();}const bcryptjs_1=__importDefault(require(a53_0x34bdc3(0x153))),crypto_1=__importDefault(require(a53_0x34bdc3(0x15b))),database_1=__importDefault(require(a53_0x34bdc3(0x16c)));class SettingsService{[a53_0x34bdc3(0x16b)](_0x3b4744){const _0x3e6f72=a53_0x34bdc3;if(!_0x3b4744)return'';if(_0x3b4744[_0x3e6f72(0x155)]<=0x8)return _0x3b4744;const _0x3d3159=_0x3b4744[_0x3e6f72(0x14f)](0x0,0x8),_0x1c56f4='*'[_0x3e6f72(0x15c)](Math[_0x3e6f72(0x192)](0x0,_0x3b4744[_0x3e6f72(0x155)]-0x8));return _0x3d3159+_0x1c56f4;}[a53_0x34bdc3(0x18a)](_0x58b7f0){const _0x509d17=a53_0x34bdc3;if(!_0x58b7f0)return[];if(Array[_0x509d17(0x17f)](_0x58b7f0))return _0x58b7f0;if(typeof _0x58b7f0===_0x509d17(0x175))try{const _0x41a212=JSON['parse'](_0x58b7f0);return Array[_0x509d17(0x17f)](_0x41a212)?_0x41a212:[];}catch{return[];}return[];}async[a53_0x34bdc3(0x181)](_0xd57b78){const _0x4b90f0=a53_0x34bdc3,_0x36afde=await database_1[_0x4b90f0(0x165)]['shop'][_0x4b90f0(0x171)]({'where':{'id':_0xd57b78},'include':{'settings':!![]}});if(!_0x36afde)throw new Error('Shop\x20not\x20found');let _0x1e75b7=_0x36afde[_0x4b90f0(0x190)];return!_0x1e75b7&&(_0x1e75b7=await database_1[_0x4b90f0(0x165)][_0x4b90f0(0x163)][_0x4b90f0(0x17a)]({'data':{'shopId':_0x36afde['id']}})),{'fullName':_0x36afde[_0x4b90f0(0x16f)],'brand':_0x36afde[_0x4b90f0(0x16f)],'merchantUrl':_0x36afde[_0x4b90f0(0x17b)],'telegramUsername':_0x36afde[_0x4b90f0(0x185)],'telegramBotApiKey':_0x1e75b7[_0x4b90f0(0x154)]?this['maskApiKey'](_0x1e75b7[_0x4b90f0(0x154)]):null,'telegramChatId':_0x1e75b7[_0x4b90f0(0x183)],'webhookUrl':_0x1e75b7[_0x4b90f0(0x187)],'webhookEvents':this[_0x4b90f0(0x18a)](_0x1e75b7[_0x4b90f0(0x167)]),'notifications':{'payment_success':_0x1e75b7[_0x4b90f0(0x17c)],'payment_failed':_0x1e75b7['notificationPaymentFailed'],'refund':_0x1e75b7['notificationRefund'],'payout':_0x1e75b7[_0x4b90f0(0x176)],'login':_0x1e75b7[_0x4b90f0(0x158)],'api_error':_0x1e75b7[_0x4b90f0(0x179)]}};}async[a53_0x34bdc3(0x150)](_0x537c87,_0x2c2d24){const _0x2b6139=a53_0x34bdc3,{currentPassword:_0x2ec3b9,newPassword:_0x3a4915,confirmNewPassword:_0x1e586b}=_0x2c2d24;if(_0x3a4915!==_0x1e586b)throw new Error(_0x2b6139(0x15e));if(_0x3a4915[_0x2b6139(0x155)]<0x6)throw new Error(_0x2b6139(0x151));const _0x51237b=await database_1['default']['shop'][_0x2b6139(0x171)]({'where':{'id':_0x537c87},'select':{'password':!![]}});if(!_0x51237b)throw new Error('Shop\x20not\x20found');const _0x5da5bb=await bcryptjs_1[_0x2b6139(0x165)]['compare'](_0x2ec3b9,_0x51237b[_0x2b6139(0x18d)]);if(!_0x5da5bb)throw new Error(_0x2b6139(0x161));const _0x3ee04a=await bcryptjs_1['default'][_0x2b6139(0x168)](_0x3a4915,0xc);await database_1[_0x2b6139(0x165)][_0x2b6139(0x18e)][_0x2b6139(0x15d)]({'where':{'id':_0x537c87},'data':{'password':_0x3ee04a}});}async[a53_0x34bdc3(0x184)](_0xcf0035,_0x4aa935){const _0x5364b7=a53_0x34bdc3;await this[_0x5364b7(0x193)](_0xcf0035);const _0x19c36c={};_0x4aa935[_0x5364b7(0x166)]!==undefined&&(_0x19c36c['notificationPaymentSuccess']=_0x4aa935[_0x5364b7(0x166)]),_0x4aa935[_0x5364b7(0x186)]!==undefined&&(_0x19c36c[_0x5364b7(0x152)]=_0x4aa935['payment_failed']),_0x4aa935[_0x5364b7(0x170)]!==undefined&&(_0x19c36c[_0x5364b7(0x178)]=_0x4aa935['refund']),_0x4aa935[_0x5364b7(0x169)]!==undefined&&(_0x19c36c[_0x5364b7(0x176)]=_0x4aa935[_0x5364b7(0x169)]),_0x4aa935[_0x5364b7(0x191)]!==undefined&&(_0x19c36c['notificationLogin']=_0x4aa935[_0x5364b7(0x191)]),_0x4aa935[_0x5364b7(0x177)]!==undefined&&(_0x19c36c[_0x5364b7(0x179)]=_0x4aa935[_0x5364b7(0x177)]),await database_1[_0x5364b7(0x165)][_0x5364b7(0x163)][_0x5364b7(0x15d)]({'where':{'shopId':_0xcf0035},'data':_0x19c36c});}async[a53_0x34bdc3(0x180)](_0x3d67df,_0x516bac){const _0x2aede6=a53_0x34bdc3;await this[_0x2aede6(0x193)](_0x3d67df);const _0x4e6089={};_0x516bac['botApiKey']!==undefined&&(_0x4e6089[_0x2aede6(0x154)]=_0x516bac[_0x2aede6(0x164)]||null),_0x516bac['chatId']!==undefined&&(_0x4e6089['telegramChatId']=_0x516bac[_0x2aede6(0x162)]||null),await database_1['default']['shopSettings'][_0x2aede6(0x15d)]({'where':{'shopId':_0x3d67df},'data':_0x4e6089});}async['updateWebhookSettings'](_0x1c3de1,_0x463c1d){const _0xb52ccd=a53_0x34bdc3;await this[_0xb52ccd(0x193)](_0x1c3de1);const _0x1009e9={};_0x463c1d['webhookUrl']!==undefined&&(_0x1009e9[_0xb52ccd(0x187)]=_0x463c1d[_0xb52ccd(0x187)]||null),_0x463c1d[_0xb52ccd(0x167)]!==undefined&&(_0x1009e9[_0xb52ccd(0x167)]=_0x463c1d['webhookEvents']||[]),await database_1['default'][_0xb52ccd(0x163)][_0xb52ccd(0x15d)]({'where':{'shopId':_0x1c3de1},'data':_0x1009e9});}async[a53_0x34bdc3(0x16e)](_0x442fad){const _0x47e785=a53_0x34bdc3,_0xc3e6cf=_0x47e785(0x182)+crypto_1[_0x47e785(0x165)][_0x47e785(0x16d)](0x20)[_0x47e785(0x160)](_0x47e785(0x189)),_0x1ef06c=_0x47e785(0x156)+crypto_1[_0x47e785(0x165)][_0x47e785(0x16d)](0x20)[_0x47e785(0x160)](_0x47e785(0x189));await database_1[_0x47e785(0x165)][_0x47e785(0x18e)][_0x47e785(0x15d)]({'where':{'id':_0x442fad},'data':{'publicKey':_0xc3e6cf,'secretKey':_0x1ef06c}});}async[a53_0x34bdc3(0x15a)](_0x10c330,_0x44b436){const _0xd19db2=a53_0x34bdc3,{passwordConfirmation:_0x32424f}=_0x44b436,_0x3e3ff3=await database_1[_0xd19db2(0x165)][_0xd19db2(0x18e)]['findUnique']({'where':{'id':_0x10c330},'select':{'password':!![]}});if(!_0x3e3ff3)throw new Error(_0xd19db2(0x159));const _0x5d62dc=await bcryptjs_1[_0xd19db2(0x165)][_0xd19db2(0x173)](_0x32424f,_0x3e3ff3[_0xd19db2(0x18d)]);if(!_0x5d62dc)throw new Error(_0xd19db2(0x14e));await database_1[_0xd19db2(0x165)][_0xd19db2(0x18e)][_0xd19db2(0x18c)]({'where':{'id':_0x10c330}});}async[a53_0x34bdc3(0x193)](_0x24cb47){const _0x39c18d=a53_0x34bdc3,_0x36004b=await database_1[_0x39c18d(0x165)][_0x39c18d(0x163)][_0x39c18d(0x171)]({'where':{'shopId':_0x24cb47}});!_0x36004b&&await database_1[_0x39c18d(0x165)]['shopSettings'][_0x39c18d(0x17a)]({'data':{'shopId':_0x24cb47}});}}exports[a53_0x34bdc3(0x174)]=SettingsService;