'use strict';const a47_0x8abc76=a47_0x54e7;(function(_0x4de54e,_0xf987c6){const _0x3d07d8=a47_0x54e7,_0x3c95eb=_0x4de54e();while(!![]){try{const _0x4a9921=parseInt(_0x3d07d8(0xd2))/0x1*(parseInt(_0x3d07d8(0xe7))/0x2)+parseInt(_0x3d07d8(0xeb))/0x3*(parseInt(_0x3d07d8(0xc8))/0x4)+parseInt(_0x3d07d8(0xca))/0x5*(parseInt(_0x3d07d8(0xd0))/0x6)+-parseInt(_0x3d07d8(0xc4))/0x7+parseInt(_0x3d07d8(0x102))/0x8+parseInt(_0x3d07d8(0xfa))/0x9*(-parseInt(_0x3d07d8(0xf6))/0xa)+parseInt(_0x3d07d8(0xc9))/0xb*(-parseInt(_0x3d07d8(0xd5))/0xc);if(_0x4a9921===_0xf987c6)break;else _0x3c95eb['push'](_0x3c95eb['shift']());}catch(_0x30041d){_0x3c95eb['push'](_0x3c95eb['shift']());}}}(a47_0x2d13,0xb391a));function a47_0x54e7(_0xf2d831,_0x4ae7da){const _0x2d13c3=a47_0x2d13();return a47_0x54e7=function(_0x54e791,_0x2eb923){_0x54e791=_0x54e791-0xc2;let _0x101fb1=_0x2d13c3[_0x54e791];return _0x101fb1;},a47_0x54e7(_0xf2d831,_0x4ae7da);}var __importDefault=this&&this[a47_0x8abc76(0xf8)]||function(_0x4f8c7c){return _0x4f8c7c&&_0x4f8c7c['__esModule']?_0x4f8c7c:{'default':_0x4f8c7c};};function a47_0x2d13(){const _0x293388=['shop','ensureSettingsExist','40ZOpxZV','hash','__importDefault','name','30123pSITmz','compare','defineProperty','notificationPayout','toString','notificationLogin','crypto','parseWebhookEvents','171464lFeCXV','notificationPaymentSuccess','payment_success','api_error','updateTelegramSettings','9872695veaQuR','chatId','SettingsService','substring','4339340FoWIda','14012317uledvR','3442090DChWMJ','Password\x20confirmation\x20is\x20incorrect','payout','telegramChatId','updateNotifications','telegram','12AFNWQi','__esModule','10ggHPkK','max','sk_','12VSoKwX','botApiKey','notificationApiError','hex','length','repeat','refund','maskApiKey','isArray','webhookUrl','notificationRefund','randomBytes','create','parse','notificationPaymentFailed','update','revokeAllApiKeys','bcryptjs','190006jOhKHe','shopSettings','updateWebhookSettings','getShopSettings','3nFsOrf','webhookEvents','pk_','default','deleteAccount','telegramBotApiKey','shopUrl','Shop\x20not\x20found','findUnique'];a47_0x2d13=function(){return _0x293388;};return a47_0x2d13();}Object[a47_0x8abc76(0xfc)](exports,a47_0x8abc76(0xd1),{'value':!![]}),exports[a47_0x8abc76(0xc6)]=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x8abc76(0xe6))),crypto_1=__importDefault(require(a47_0x8abc76(0x100))),database_1=__importDefault(require('../config/database'));class SettingsService{[a47_0x8abc76(0xdc)](_0x248a68){const _0x405edc=a47_0x8abc76;if(!_0x248a68)return'';if(_0x248a68['length']<=0x8)return _0x248a68;const _0x4b8f97=_0x248a68[_0x405edc(0xc7)](0x0,0x8),_0x4c11e9='*'[_0x405edc(0xda)](Math[_0x405edc(0xd3)](0x0,_0x248a68[_0x405edc(0xd9)]-0x8));return _0x4b8f97+_0x4c11e9;}[a47_0x8abc76(0x101)](_0x4dd95d){const _0x3f61ef=a47_0x8abc76;if(!_0x4dd95d)return[];if(Array[_0x3f61ef(0xdd)](_0x4dd95d))return _0x4dd95d;if(typeof _0x4dd95d==='string')try{const _0x3c2ce1=JSON[_0x3f61ef(0xe2)](_0x4dd95d);return Array[_0x3f61ef(0xdd)](_0x3c2ce1)?_0x3c2ce1:[];}catch{return[];}return[];}async[a47_0x8abc76(0xea)](_0x23c70e){const _0x1c7062=a47_0x8abc76,_0x30fe7d=await database_1[_0x1c7062(0xee)]['shop'][_0x1c7062(0xf3)]({'where':{'id':_0x23c70e},'include':{'settings':!![]}});if(!_0x30fe7d)throw new Error(_0x1c7062(0xf2));let _0x2a2d23=_0x30fe7d['settings'];return!_0x2a2d23&&(_0x2a2d23=await database_1[_0x1c7062(0xee)][_0x1c7062(0xe8)][_0x1c7062(0xe1)]({'data':{'shopId':_0x30fe7d['id']}})),{'fullName':_0x30fe7d[_0x1c7062(0xf9)],'brand':_0x30fe7d['name'],'merchantUrl':_0x30fe7d[_0x1c7062(0xf1)],'telegramUsername':_0x30fe7d[_0x1c7062(0xcf)],'telegramBotApiKey':_0x2a2d23[_0x1c7062(0xf0)]?this[_0x1c7062(0xdc)](_0x2a2d23['telegramBotApiKey']):null,'telegramChatId':_0x2a2d23[_0x1c7062(0xcd)],'webhookUrl':_0x2a2d23[_0x1c7062(0xde)],'webhookEvents':this[_0x1c7062(0x101)](_0x2a2d23[_0x1c7062(0xec)]),'notifications':{'payment_success':_0x2a2d23[_0x1c7062(0x103)],'payment_failed':_0x2a2d23['notificationPaymentFailed'],'refund':_0x2a2d23[_0x1c7062(0xdf)],'payout':_0x2a2d23[_0x1c7062(0xfd)],'login':_0x2a2d23[_0x1c7062(0xff)],'api_error':_0x2a2d23[_0x1c7062(0xd7)]}};}async['changePassword'](_0x2816d0,_0x501a6b){const _0x39db50=a47_0x8abc76,{currentPassword:_0xb46ac9,newPassword:_0x243223,confirmNewPassword:_0x59d5c9}=_0x501a6b;if(_0x243223!==_0x59d5c9)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x243223[_0x39db50(0xd9)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x560a6c=await database_1['default']['shop']['findUnique']({'where':{'id':_0x2816d0},'select':{'password':!![]}});if(!_0x560a6c)throw new Error(_0x39db50(0xf2));const _0x17860a=await bcryptjs_1['default'][_0x39db50(0xfb)](_0xb46ac9,_0x560a6c['password']);if(!_0x17860a)throw new Error('Current\x20password\x20is\x20incorrect');const _0xb429bd=await bcryptjs_1['default'][_0x39db50(0xf7)](_0x243223,0xc);await database_1[_0x39db50(0xee)][_0x39db50(0xf4)][_0x39db50(0xe4)]({'where':{'id':_0x2816d0},'data':{'password':_0xb429bd}});}async[a47_0x8abc76(0xce)](_0x5d4859,_0x45313f){const _0x46f604=a47_0x8abc76;await this[_0x46f604(0xf5)](_0x5d4859);const _0x63886={};_0x45313f[_0x46f604(0x104)]!==undefined&&(_0x63886['notificationPaymentSuccess']=_0x45313f[_0x46f604(0x104)]),_0x45313f['payment_failed']!==undefined&&(_0x63886[_0x46f604(0xe3)]=_0x45313f['payment_failed']),_0x45313f[_0x46f604(0xdb)]!==undefined&&(_0x63886[_0x46f604(0xdf)]=_0x45313f[_0x46f604(0xdb)]),_0x45313f[_0x46f604(0xcc)]!==undefined&&(_0x63886[_0x46f604(0xfd)]=_0x45313f[_0x46f604(0xcc)]),_0x45313f['login']!==undefined&&(_0x63886['notificationLogin']=_0x45313f['login']),_0x45313f['api_error']!==undefined&&(_0x63886['notificationApiError']=_0x45313f[_0x46f604(0xc2)]),await database_1[_0x46f604(0xee)][_0x46f604(0xe8)][_0x46f604(0xe4)]({'where':{'shopId':_0x5d4859},'data':_0x63886});}async[a47_0x8abc76(0xc3)](_0x51ea5e,_0x235809){const _0x26423d=a47_0x8abc76;await this[_0x26423d(0xf5)](_0x51ea5e);const _0xd1a375={};_0x235809[_0x26423d(0xd6)]!==undefined&&(_0xd1a375['telegramBotApiKey']=_0x235809['botApiKey']||null),_0x235809[_0x26423d(0xc5)]!==undefined&&(_0xd1a375[_0x26423d(0xcd)]=_0x235809[_0x26423d(0xc5)]||null),await database_1[_0x26423d(0xee)][_0x26423d(0xe8)]['update']({'where':{'shopId':_0x51ea5e},'data':_0xd1a375});}async[a47_0x8abc76(0xe9)](_0xd8624b,_0x3bce15){const _0x1f3573=a47_0x8abc76;await this[_0x1f3573(0xf5)](_0xd8624b);const _0x483987={};_0x3bce15['webhookUrl']!==undefined&&(_0x483987['webhookUrl']=_0x3bce15['webhookUrl']||null),_0x3bce15['webhookEvents']!==undefined&&(_0x483987[_0x1f3573(0xec)]=_0x3bce15[_0x1f3573(0xec)]||[]),await database_1['default'][_0x1f3573(0xe8)][_0x1f3573(0xe4)]({'where':{'shopId':_0xd8624b},'data':_0x483987});}async[a47_0x8abc76(0xe5)](_0x44876a){const _0x231618=a47_0x8abc76,_0x5f0da8=_0x231618(0xed)+crypto_1[_0x231618(0xee)][_0x231618(0xe0)](0x20)[_0x231618(0xfe)](_0x231618(0xd8)),_0x5c9e4c=_0x231618(0xd4)+crypto_1[_0x231618(0xee)][_0x231618(0xe0)](0x20)['toString'](_0x231618(0xd8));await database_1[_0x231618(0xee)]['shop'][_0x231618(0xe4)]({'where':{'id':_0x44876a},'data':{'publicKey':_0x5f0da8,'secretKey':_0x5c9e4c}});}async[a47_0x8abc76(0xef)](_0x4fe870,_0x1d5c76){const _0x298f1b=a47_0x8abc76,{passwordConfirmation:_0xa1c803}=_0x1d5c76,_0x76d5ef=await database_1[_0x298f1b(0xee)][_0x298f1b(0xf4)][_0x298f1b(0xf3)]({'where':{'id':_0x4fe870},'select':{'password':!![]}});if(!_0x76d5ef)throw new Error(_0x298f1b(0xf2));const _0x236666=await bcryptjs_1[_0x298f1b(0xee)][_0x298f1b(0xfb)](_0xa1c803,_0x76d5ef['password']);if(!_0x236666)throw new Error(_0x298f1b(0xcb));await database_1[_0x298f1b(0xee)][_0x298f1b(0xf4)]['delete']({'where':{'id':_0x4fe870}});}async['ensureSettingsExist'](_0x2b0c35){const _0x584d1c=a47_0x8abc76,_0x3a9b7a=await database_1['default']['shopSettings'][_0x584d1c(0xf3)]({'where':{'shopId':_0x2b0c35}});!_0x3a9b7a&&await database_1[_0x584d1c(0xee)][_0x584d1c(0xe8)][_0x584d1c(0xe1)]({'data':{'shopId':_0x2b0c35}});}}exports[a47_0x8abc76(0xc6)]=SettingsService;