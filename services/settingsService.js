'use strict';function a46_0x579e(){const _0x5dbb6e=['24RrCAnY','pk_','defineProperty','deleteAccount','shopSettings','default','webhookUrl','toString','../config/database','findUnique','parseWebhookEvents','substring','max','length','botApiKey','compare','chatId','Password\x20confirmation\x20is\x20incorrect','719844tsmyGS','parse','update','238128vpJQrS','payment_success','telegram','settings','notificationPaymentSuccess','updateTelegramSettings','2549729ngxbIS','ensureSettingsExist','hex','notificationPayout','webhookEvents','bcryptjs','1104438MLjZKd','telegramBotApiKey','344535tUrqyC','login','password','notificationApiError','Current\x20password\x20is\x20incorrect','payment_failed','Shop\x20not\x20found','randomBytes','updateNotifications','shop','name','payout','notificationLogin','notificationPaymentFailed','api_error','telegramChatId','notificationRefund','isArray','getShopSettings','9066942aWDXat','__esModule','maskApiKey','SettingsService','updateWebhookSettings','__importDefault','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','create','131873xeOhKt','refund','delete','4UajXfc'];a46_0x579e=function(){return _0x5dbb6e;};return a46_0x579e();}const a46_0xb5c24b=a46_0x16bc;(function(_0x27eec4,_0x5e418e){const _0x1abb83=a46_0x16bc,_0x489a98=_0x27eec4();while(!![]){try{const _0x3b292e=parseInt(_0x1abb83(0x100))/0x1*(parseInt(_0x1abb83(0x103))/0x2)+-parseInt(_0x1abb83(0xe3))/0x3+-parseInt(_0x1abb83(0x104))/0x4*(parseInt(_0x1abb83(0xe5))/0x5)+parseInt(_0x1abb83(0xd4))/0x6+-parseInt(_0x1abb83(0xdd))/0x7+-parseInt(_0x1abb83(0xd7))/0x8+parseInt(_0x1abb83(0xf8))/0x9;if(_0x3b292e===_0x5e418e)break;else _0x489a98['push'](_0x489a98['shift']());}catch(_0x47ca66){_0x489a98['push'](_0x489a98['shift']());}}}(a46_0x579e,0x34a05));function a46_0x16bc(_0x2dae2d,_0x290d29){const _0x579eeb=a46_0x579e();return a46_0x16bc=function(_0x16bc58,_0x365a57){_0x16bc58=_0x16bc58-0xcc;let _0x23a1e4=_0x579eeb[_0x16bc58];return _0x23a1e4;},a46_0x16bc(_0x2dae2d,_0x290d29);}var __importDefault=this&&this[a46_0xb5c24b(0xfd)]||function(_0x86ecad){return _0x86ecad&&_0x86ecad['__esModule']?_0x86ecad:{'default':_0x86ecad};};Object[a46_0xb5c24b(0x106)](exports,a46_0xb5c24b(0xf9),{'value':!![]}),exports[a46_0xb5c24b(0xfb)]=void 0x0;const bcryptjs_1=__importDefault(require(a46_0xb5c24b(0xe2))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a46_0xb5c24b(0x10c)));class SettingsService{[a46_0xb5c24b(0xfa)](_0x48d9cb){const _0x41dbe0=a46_0xb5c24b;if(!_0x48d9cb)return'';if(_0x48d9cb[_0x41dbe0(0xcf)]<=0x8)return _0x48d9cb;const _0x536396=_0x48d9cb[_0x41dbe0(0xcd)](0x0,0x8),_0x209089='*'['repeat'](Math[_0x41dbe0(0xce)](0x0,_0x48d9cb[_0x41dbe0(0xcf)]-0x8));return _0x536396+_0x209089;}[a46_0xb5c24b(0xcc)](_0x4a4a88){const _0x40fe4a=a46_0xb5c24b;if(!_0x4a4a88)return[];if(Array[_0x40fe4a(0xf6)](_0x4a4a88))return _0x4a4a88;if(typeof _0x4a4a88==='string')try{const _0x3a1051=JSON[_0x40fe4a(0xd5)](_0x4a4a88);return Array[_0x40fe4a(0xf6)](_0x3a1051)?_0x3a1051:[];}catch{return[];}return[];}async[a46_0xb5c24b(0xf7)](_0x57f8f5){const _0x2ecd39=a46_0xb5c24b,_0x3d8afa=await database_1[_0x2ecd39(0x109)][_0x2ecd39(0xee)][_0x2ecd39(0x10d)]({'where':{'id':_0x57f8f5},'include':{'settings':!![]}});if(!_0x3d8afa)throw new Error(_0x2ecd39(0xeb));let _0x54c8ec=_0x3d8afa[_0x2ecd39(0xda)];return!_0x54c8ec&&(_0x54c8ec=await database_1[_0x2ecd39(0x109)][_0x2ecd39(0x108)][_0x2ecd39(0xff)]({'data':{'shopId':_0x3d8afa['id']}})),{'fullName':_0x3d8afa[_0x2ecd39(0xef)],'brand':_0x3d8afa[_0x2ecd39(0xef)],'merchantUrl':_0x3d8afa['shopUrl'],'telegramUsername':_0x3d8afa[_0x2ecd39(0xd9)],'telegramBotApiKey':_0x54c8ec[_0x2ecd39(0xe4)]?this[_0x2ecd39(0xfa)](_0x54c8ec[_0x2ecd39(0xe4)]):null,'telegramChatId':_0x54c8ec['telegramChatId'],'webhookUrl':_0x54c8ec['webhookUrl'],'webhookEvents':this[_0x2ecd39(0xcc)](_0x54c8ec[_0x2ecd39(0xe1)]),'notifications':{'payment_success':_0x54c8ec['notificationPaymentSuccess'],'payment_failed':_0x54c8ec[_0x2ecd39(0xf2)],'refund':_0x54c8ec['notificationRefund'],'payout':_0x54c8ec[_0x2ecd39(0xe0)],'login':_0x54c8ec[_0x2ecd39(0xf1)],'api_error':_0x54c8ec[_0x2ecd39(0xe8)]}};}async['changePassword'](_0x1ba84b,_0x295e47){const _0x2c5a11=a46_0xb5c24b,{currentPassword:_0x287c17,newPassword:_0x3ba7d8,confirmNewPassword:_0x28f51d}=_0x295e47;if(_0x3ba7d8!==_0x28f51d)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x3ba7d8[_0x2c5a11(0xcf)]<0x6)throw new Error(_0x2c5a11(0xfe));const _0x51c4b2=await database_1[_0x2c5a11(0x109)][_0x2c5a11(0xee)][_0x2c5a11(0x10d)]({'where':{'id':_0x1ba84b},'select':{'password':!![]}});if(!_0x51c4b2)throw new Error('Shop\x20not\x20found');const _0x1b5f79=await bcryptjs_1[_0x2c5a11(0x109)][_0x2c5a11(0xd1)](_0x287c17,_0x51c4b2[_0x2c5a11(0xe7)]);if(!_0x1b5f79)throw new Error(_0x2c5a11(0xe9));const _0x11b445=await bcryptjs_1[_0x2c5a11(0x109)]['hash'](_0x3ba7d8,0xc);await database_1[_0x2c5a11(0x109)]['shop']['update']({'where':{'id':_0x1ba84b},'data':{'password':_0x11b445}});}async[a46_0xb5c24b(0xed)](_0x256b6e,_0x5cad15){const _0x32fd5b=a46_0xb5c24b;await this[_0x32fd5b(0xde)](_0x256b6e);const _0x355ff4={};_0x5cad15['payment_success']!==undefined&&(_0x355ff4[_0x32fd5b(0xdb)]=_0x5cad15[_0x32fd5b(0xd8)]),_0x5cad15[_0x32fd5b(0xea)]!==undefined&&(_0x355ff4[_0x32fd5b(0xf2)]=_0x5cad15[_0x32fd5b(0xea)]),_0x5cad15[_0x32fd5b(0x101)]!==undefined&&(_0x355ff4[_0x32fd5b(0xf5)]=_0x5cad15['refund']),_0x5cad15[_0x32fd5b(0xf0)]!==undefined&&(_0x355ff4[_0x32fd5b(0xe0)]=_0x5cad15['payout']),_0x5cad15[_0x32fd5b(0xe6)]!==undefined&&(_0x355ff4[_0x32fd5b(0xf1)]=_0x5cad15[_0x32fd5b(0xe6)]),_0x5cad15[_0x32fd5b(0xf3)]!==undefined&&(_0x355ff4[_0x32fd5b(0xe8)]=_0x5cad15[_0x32fd5b(0xf3)]),await database_1['default']['shopSettings'][_0x32fd5b(0xd6)]({'where':{'shopId':_0x256b6e},'data':_0x355ff4});}async[a46_0xb5c24b(0xdc)](_0x524983,_0x27a159){const _0x4bdcdc=a46_0xb5c24b;await this['ensureSettingsExist'](_0x524983);const _0x280acf={};_0x27a159[_0x4bdcdc(0xd0)]!==undefined&&(_0x280acf[_0x4bdcdc(0xe4)]=_0x27a159[_0x4bdcdc(0xd0)]||null),_0x27a159['chatId']!==undefined&&(_0x280acf[_0x4bdcdc(0xf4)]=_0x27a159[_0x4bdcdc(0xd2)]||null),await database_1[_0x4bdcdc(0x109)]['shopSettings'][_0x4bdcdc(0xd6)]({'where':{'shopId':_0x524983},'data':_0x280acf});}async[a46_0xb5c24b(0xfc)](_0x163776,_0x528143){const _0x2309ff=a46_0xb5c24b;await this[_0x2309ff(0xde)](_0x163776);const _0x18034d={};_0x528143[_0x2309ff(0x10a)]!==undefined&&(_0x18034d[_0x2309ff(0x10a)]=_0x528143[_0x2309ff(0x10a)]||null),_0x528143[_0x2309ff(0xe1)]!==undefined&&(_0x18034d[_0x2309ff(0xe1)]=_0x528143['webhookEvents']||[]),await database_1['default'][_0x2309ff(0x108)][_0x2309ff(0xd6)]({'where':{'shopId':_0x163776},'data':_0x18034d});}async['revokeAllApiKeys'](_0x12c35c){const _0xf6e0b8=a46_0xb5c24b,_0x5e3c07=_0xf6e0b8(0x105)+crypto_1['default']['randomBytes'](0x20)[_0xf6e0b8(0x10b)](_0xf6e0b8(0xdf)),_0x2f037c='sk_'+crypto_1[_0xf6e0b8(0x109)][_0xf6e0b8(0xec)](0x20)[_0xf6e0b8(0x10b)](_0xf6e0b8(0xdf));await database_1['default']['shop']['update']({'where':{'id':_0x12c35c},'data':{'publicKey':_0x5e3c07,'secretKey':_0x2f037c}});}async[a46_0xb5c24b(0x107)](_0x230337,_0x6f044){const _0x8a7894=a46_0xb5c24b,{passwordConfirmation:_0x297deb}=_0x6f044,_0x184488=await database_1[_0x8a7894(0x109)][_0x8a7894(0xee)][_0x8a7894(0x10d)]({'where':{'id':_0x230337},'select':{'password':!![]}});if(!_0x184488)throw new Error(_0x8a7894(0xeb));const _0x276c80=await bcryptjs_1[_0x8a7894(0x109)][_0x8a7894(0xd1)](_0x297deb,_0x184488[_0x8a7894(0xe7)]);if(!_0x276c80)throw new Error(_0x8a7894(0xd3));await database_1[_0x8a7894(0x109)][_0x8a7894(0xee)][_0x8a7894(0x102)]({'where':{'id':_0x230337}});}async['ensureSettingsExist'](_0x2fa732){const _0x16cb88=a46_0xb5c24b,_0x44c6e0=await database_1['default']['shopSettings']['findUnique']({'where':{'shopId':_0x2fa732}});!_0x44c6e0&&await database_1[_0x16cb88(0x109)]['shopSettings'][_0x16cb88(0xff)]({'data':{'shopId':_0x2fa732}});}}exports[a46_0xb5c24b(0xfb)]=SettingsService;