'use strict';const a59_0x42271c=a59_0x5394;(function(_0x5ecc7d,_0x28929f){const _0x14a0aa=a59_0x5394,_0xcc726b=_0x5ecc7d();while(!![]){try{const _0x4937df=parseInt(_0x14a0aa(0x173))/0x1*(-parseInt(_0x14a0aa(0x162))/0x2)+parseInt(_0x14a0aa(0x141))/0x3*(-parseInt(_0x14a0aa(0x143))/0x4)+-parseInt(_0x14a0aa(0x13d))/0x5*(-parseInt(_0x14a0aa(0x14f))/0x6)+-parseInt(_0x14a0aa(0x17e))/0x7+parseInt(_0x14a0aa(0x153))/0x8+parseInt(_0x14a0aa(0x140))/0x9+-parseInt(_0x14a0aa(0x168))/0xa*(parseInt(_0x14a0aa(0x174))/0xb);if(_0x4937df===_0x28929f)break;else _0xcc726b['push'](_0xcc726b['shift']());}catch(_0x22e6ef){_0xcc726b['push'](_0xcc726b['shift']());}}}(a59_0x3a06,0xcd110));var __importDefault=this&&this[a59_0x42271c(0x17a)]||function(_0x46d5e0){const _0x6d7486=a59_0x42271c;return _0x46d5e0&&_0x46d5e0[_0x6d7486(0x17d)]?_0x46d5e0:{'default':_0x46d5e0};};Object[a59_0x42271c(0x150)](exports,a59_0x42271c(0x17d),{'value':!![]}),exports[a59_0x42271c(0x14d)]=void 0x0;function a59_0x5394(_0x29e233,_0x6394b){const _0x3a0640=a59_0x3a06();return a59_0x5394=function(_0x5394ff,_0x54e763){_0x5394ff=_0x5394ff-0x13d;let _0x475f7c=_0x3a0640[_0x5394ff];return _0x475f7c;},a59_0x5394(_0x29e233,_0x6394b);}const bcryptjs_1=__importDefault(require(a59_0x42271c(0x166))),crypto_1=__importDefault(require(a59_0x42271c(0x176))),database_1=__importDefault(require(a59_0x42271c(0x148)));class SettingsService{['maskApiKey'](_0x2c2df6){const _0x416a65=a59_0x42271c;if(!_0x2c2df6)return'';if(_0x2c2df6[_0x416a65(0x17b)]<=0x8)return _0x2c2df6;const _0x2a5309=_0x2c2df6['substring'](0x0,0x8),_0x3e46a1='*'[_0x416a65(0x16e)](Math[_0x416a65(0x16c)](0x0,_0x2c2df6[_0x416a65(0x17b)]-0x8));return _0x2a5309+_0x3e46a1;}[a59_0x42271c(0x151)](_0x5f385c){const _0x57e4b0=a59_0x42271c;if(!_0x5f385c)return[];if(Array['isArray'](_0x5f385c))return _0x5f385c;if(typeof _0x5f385c===_0x57e4b0(0x165))try{const _0x2c1415=JSON[_0x57e4b0(0x156)](_0x5f385c);return Array[_0x57e4b0(0x155)](_0x2c1415)?_0x2c1415:[];}catch{return[];}return[];}async[a59_0x42271c(0x169)](_0x1a04a0){const _0x5c224e=a59_0x42271c,_0x56b0f4=await database_1[_0x5c224e(0x147)][_0x5c224e(0x16a)][_0x5c224e(0x163)]({'where':{'id':_0x1a04a0},'include':{'settings':!![]}});if(!_0x56b0f4)throw new Error(_0x5c224e(0x15d));let _0xdc1afb=_0x56b0f4[_0x5c224e(0x15c)];return!_0xdc1afb&&(_0xdc1afb=await database_1[_0x5c224e(0x147)]['shopSettings'][_0x5c224e(0x172)]({'data':{'shopId':_0x56b0f4['id']}})),{'fullName':_0x56b0f4[_0x5c224e(0x177)],'brand':_0x56b0f4[_0x5c224e(0x177)],'merchantUrl':_0x56b0f4[_0x5c224e(0x161)],'telegramUsername':_0x56b0f4['telegram'],'telegramBotApiKey':_0xdc1afb['telegramBotApiKey']?this[_0x5c224e(0x157)](_0xdc1afb[_0x5c224e(0x149)]):null,'telegramChatId':_0xdc1afb[_0x5c224e(0x17c)],'webhookUrl':_0xdc1afb['webhookUrl'],'webhookEvents':this[_0x5c224e(0x151)](_0xdc1afb['webhookEvents']),'notifications':{'payment_success':_0xdc1afb['notificationPaymentSuccess'],'payment_failed':_0xdc1afb[_0x5c224e(0x167)],'refund':_0xdc1afb['notificationRefund'],'payout':_0xdc1afb[_0x5c224e(0x16f)],'login':_0xdc1afb[_0x5c224e(0x17f)],'api_error':_0xdc1afb[_0x5c224e(0x164)]}};}async[a59_0x42271c(0x14b)](_0x585a10,_0x11093c){const _0x1fc3bb=a59_0x42271c,{currentPassword:_0x1fbd9d,newPassword:_0x51d7de,confirmNewPassword:_0x34037e}=_0x11093c;if(_0x51d7de!==_0x34037e)throw new Error(_0x1fc3bb(0x14e));if(_0x51d7de['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x256f85=await database_1[_0x1fc3bb(0x147)][_0x1fc3bb(0x16a)][_0x1fc3bb(0x163)]({'where':{'id':_0x585a10},'select':{'password':!![]}});if(!_0x256f85)throw new Error(_0x1fc3bb(0x15d));const _0x25c9ce=await bcryptjs_1[_0x1fc3bb(0x147)]['compare'](_0x1fbd9d,_0x256f85[_0x1fc3bb(0x15a)]);if(!_0x25c9ce)throw new Error('Current\x20password\x20is\x20incorrect');const _0x237671=await bcryptjs_1[_0x1fc3bb(0x147)][_0x1fc3bb(0x14c)](_0x51d7de,0xc);await database_1['default'][_0x1fc3bb(0x16a)][_0x1fc3bb(0x178)]({'where':{'id':_0x585a10},'data':{'password':_0x237671}});}async[a59_0x42271c(0x13f)](_0xeccde3,_0x13cb2d){const _0x22f888=a59_0x42271c;await this['ensureSettingsExist'](_0xeccde3);const _0x3413a1={};_0x13cb2d['payment_success']!==undefined&&(_0x3413a1[_0x22f888(0x159)]=_0x13cb2d[_0x22f888(0x158)]),_0x13cb2d[_0x22f888(0x146)]!==undefined&&(_0x3413a1[_0x22f888(0x167)]=_0x13cb2d['payment_failed']),_0x13cb2d[_0x22f888(0x152)]!==undefined&&(_0x3413a1[_0x22f888(0x175)]=_0x13cb2d['refund']),_0x13cb2d[_0x22f888(0x154)]!==undefined&&(_0x3413a1[_0x22f888(0x16f)]=_0x13cb2d[_0x22f888(0x154)]),_0x13cb2d[_0x22f888(0x14a)]!==undefined&&(_0x3413a1[_0x22f888(0x17f)]=_0x13cb2d['login']),_0x13cb2d[_0x22f888(0x15b)]!==undefined&&(_0x3413a1[_0x22f888(0x164)]=_0x13cb2d[_0x22f888(0x15b)]),await database_1[_0x22f888(0x147)][_0x22f888(0x144)][_0x22f888(0x178)]({'where':{'shopId':_0xeccde3},'data':_0x3413a1});}async[a59_0x42271c(0x170)](_0x4be6b6,_0x5dde6b){const _0x6c6995=a59_0x42271c;await this[_0x6c6995(0x15e)](_0x4be6b6);const _0x19fba0={};_0x5dde6b[_0x6c6995(0x142)]!==undefined&&(_0x19fba0[_0x6c6995(0x149)]=_0x5dde6b[_0x6c6995(0x142)]||null),_0x5dde6b[_0x6c6995(0x180)]!==undefined&&(_0x19fba0[_0x6c6995(0x17c)]=_0x5dde6b[_0x6c6995(0x180)]||null),await database_1['default'][_0x6c6995(0x144)]['update']({'where':{'shopId':_0x4be6b6},'data':_0x19fba0});}async['updateWebhookSettings'](_0x210161,_0x97bac1){const _0x155601=a59_0x42271c;await this[_0x155601(0x15e)](_0x210161);const _0x40e06b={};_0x97bac1['webhookUrl']!==undefined&&(_0x40e06b[_0x155601(0x160)]=_0x97bac1[_0x155601(0x160)]||null),_0x97bac1[_0x155601(0x13e)]!==undefined&&(_0x40e06b[_0x155601(0x13e)]=_0x97bac1['webhookEvents']||[]),await database_1[_0x155601(0x147)][_0x155601(0x144)][_0x155601(0x178)]({'where':{'shopId':_0x210161},'data':_0x40e06b});}async[a59_0x42271c(0x145)](_0x813ed){const _0x2cc88e=a59_0x42271c,_0x1472c0=_0x2cc88e(0x15f)+crypto_1[_0x2cc88e(0x147)]['randomBytes'](0x20)[_0x2cc88e(0x16b)](_0x2cc88e(0x181)),_0x211b16=_0x2cc88e(0x179)+crypto_1[_0x2cc88e(0x147)]['randomBytes'](0x20)[_0x2cc88e(0x16b)](_0x2cc88e(0x181));await database_1[_0x2cc88e(0x147)]['shop'][_0x2cc88e(0x178)]({'where':{'id':_0x813ed},'data':{'publicKey':_0x1472c0,'secretKey':_0x211b16}});}async[a59_0x42271c(0x16d)](_0x9f1c4f,_0xfeb7cd){const _0x12f1a1=a59_0x42271c,{passwordConfirmation:_0x3ae76e}=_0xfeb7cd,_0xa4c87f=await database_1[_0x12f1a1(0x147)][_0x12f1a1(0x16a)][_0x12f1a1(0x163)]({'where':{'id':_0x9f1c4f},'select':{'password':!![]}});if(!_0xa4c87f)throw new Error(_0x12f1a1(0x15d));const _0x3a2eee=await bcryptjs_1[_0x12f1a1(0x147)]['compare'](_0x3ae76e,_0xa4c87f[_0x12f1a1(0x15a)]);if(!_0x3a2eee)throw new Error(_0x12f1a1(0x171));await database_1[_0x12f1a1(0x147)][_0x12f1a1(0x16a)]['delete']({'where':{'id':_0x9f1c4f}});}async[a59_0x42271c(0x15e)](_0x3da062){const _0x5efccc=a59_0x42271c,_0x5ad0be=await database_1[_0x5efccc(0x147)]['shopSettings'][_0x5efccc(0x163)]({'where':{'shopId':_0x3da062}});!_0x5ad0be&&await database_1[_0x5efccc(0x147)][_0x5efccc(0x144)]['create']({'data':{'shopId':_0x3da062}});}}exports[a59_0x42271c(0x14d)]=SettingsService;function a59_0x3a06(){const _0x20d8cd=['ensureSettingsExist','pk_','webhookUrl','shopUrl','20kwmZHR','findUnique','notificationApiError','string','bcryptjs','notificationPaymentFailed','20wFqPAP','getShopSettings','shop','toString','max','deleteAccount','repeat','notificationPayout','updateTelegramSettings','Password\x20confirmation\x20is\x20incorrect','create','11083HwiDoZ','482801ezzQKb','notificationRefund','crypto','name','update','sk_','__importDefault','length','telegramChatId','__esModule','2031568FWahUG','notificationLogin','chatId','hex','5uuHbSc','webhookEvents','updateNotifications','340488fwoopV','238827vEGDfO','botApiKey','32TnwVkn','shopSettings','revokeAllApiKeys','payment_failed','default','../config/database','telegramBotApiKey','login','changePassword','hash','SettingsService','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','5390082HGkiNd','defineProperty','parseWebhookEvents','refund','8235848wFQqbM','payout','isArray','parse','maskApiKey','payment_success','notificationPaymentSuccess','password','api_error','settings','Shop\x20not\x20found'];a59_0x3a06=function(){return _0x20d8cd;};return a59_0x3a06();}