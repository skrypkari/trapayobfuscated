'use strict';const a53_0x21fec2=a53_0x4f85;(function(_0xb8689b,_0x357281){const _0x5c401a=a53_0x4f85,_0x1f244d=_0xb8689b();while(!![]){try{const _0x4e35b7=-parseInt(_0x5c401a(0x137))/0x1+parseInt(_0x5c401a(0x146))/0x2*(-parseInt(_0x5c401a(0x155))/0x3)+parseInt(_0x5c401a(0x136))/0x4+-parseInt(_0x5c401a(0x123))/0x5+-parseInt(_0x5c401a(0x147))/0x6*(parseInt(_0x5c401a(0x12e))/0x7)+parseInt(_0x5c401a(0x11d))/0x8*(-parseInt(_0x5c401a(0x157))/0x9)+parseInt(_0x5c401a(0x143))/0xa*(parseInt(_0x5c401a(0x12f))/0xb);if(_0x4e35b7===_0x357281)break;else _0x1f244d['push'](_0x1f244d['shift']());}catch(_0x19c0a4){_0x1f244d['push'](_0x1f244d['shift']());}}}(a53_0x3168,0xe78e1));function a53_0x4f85(_0x380670,_0x4c0c0b){const _0x31687a=a53_0x3168();return a53_0x4f85=function(_0x4f8570,_0x56b390){_0x4f8570=_0x4f8570-0x11d;let _0x9c1fa1=_0x31687a[_0x4f8570];return _0x9c1fa1;},a53_0x4f85(_0x380670,_0x4c0c0b);}var __importDefault=this&&this[a53_0x21fec2(0x148)]||function(_0xb6579c){const _0x7494c1=a53_0x21fec2;return _0xb6579c&&_0xb6579c[_0x7494c1(0x128)]?_0xb6579c:{'default':_0xb6579c};};Object[a53_0x21fec2(0x142)](exports,a53_0x21fec2(0x128),{'value':!![]}),exports[a53_0x21fec2(0x138)]=void 0x0;const bcryptjs_1=__importDefault(require(a53_0x21fec2(0x11e))),crypto_1=__importDefault(require(a53_0x21fec2(0x13a))),database_1=__importDefault(require('../config/database'));class SettingsService{[a53_0x21fec2(0x151)](_0x359825){const _0x100fe1=a53_0x21fec2;if(!_0x359825)return'';if(_0x359825[_0x100fe1(0x144)]<=0x8)return _0x359825;const _0x3e08fe=_0x359825[_0x100fe1(0x15c)](0x0,0x8),_0x18066e='*'[_0x100fe1(0x14f)](Math[_0x100fe1(0x13d)](0x0,_0x359825['length']-0x8));return _0x3e08fe+_0x18066e;}['parseWebhookEvents'](_0x5aa6cb){const _0x11b986=a53_0x21fec2;if(!_0x5aa6cb)return[];if(Array['isArray'](_0x5aa6cb))return _0x5aa6cb;if(typeof _0x5aa6cb===_0x11b986(0x125))try{const _0x1a10a7=JSON[_0x11b986(0x159)](_0x5aa6cb);return Array[_0x11b986(0x132)](_0x1a10a7)?_0x1a10a7:[];}catch{return[];}return[];}async[a53_0x21fec2(0x15f)](_0x35e076){const _0x50bf3d=a53_0x21fec2,_0x36a21f=await database_1[_0x50bf3d(0x158)][_0x50bf3d(0x14c)][_0x50bf3d(0x13f)]({'where':{'id':_0x35e076},'include':{'settings':!![]}});if(!_0x36a21f)throw new Error('Shop\x20not\x20found');let _0x29b801=_0x36a21f['settings'];return!_0x29b801&&(_0x29b801=await database_1['default'][_0x50bf3d(0x14a)][_0x50bf3d(0x14d)]({'data':{'shopId':_0x36a21f['id']}})),{'fullName':_0x36a21f[_0x50bf3d(0x13b)],'brand':_0x36a21f['name'],'merchantUrl':_0x36a21f[_0x50bf3d(0x141)],'telegramUsername':_0x36a21f[_0x50bf3d(0x150)],'telegramBotApiKey':_0x29b801[_0x50bf3d(0x15e)]?this[_0x50bf3d(0x151)](_0x29b801['telegramBotApiKey']):null,'telegramChatId':_0x29b801[_0x50bf3d(0x15d)],'webhookUrl':_0x29b801[_0x50bf3d(0x129)],'webhookEvents':this[_0x50bf3d(0x139)](_0x29b801[_0x50bf3d(0x15a)]),'notifications':{'payment_success':_0x29b801[_0x50bf3d(0x14e)],'payment_failed':_0x29b801['notificationPaymentFailed'],'refund':_0x29b801[_0x50bf3d(0x135)],'payout':_0x29b801[_0x50bf3d(0x126)],'login':_0x29b801[_0x50bf3d(0x131)],'api_error':_0x29b801[_0x50bf3d(0x12a)]}};}async['changePassword'](_0x43351f,_0x53fafa){const _0x994897=a53_0x21fec2,{currentPassword:_0x1df35c,newPassword:_0xbb305d,confirmNewPassword:_0x1280df}=_0x53fafa;if(_0xbb305d!==_0x1280df)throw new Error(_0x994897(0x156));if(_0xbb305d['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x139f45=await database_1[_0x994897(0x158)][_0x994897(0x14c)][_0x994897(0x13f)]({'where':{'id':_0x43351f},'select':{'password':!![]}});if(!_0x139f45)throw new Error('Shop\x20not\x20found');const _0x56da65=await bcryptjs_1[_0x994897(0x158)][_0x994897(0x15b)](_0x1df35c,_0x139f45[_0x994897(0x133)]);if(!_0x56da65)throw new Error(_0x994897(0x149));const _0x4c0213=await bcryptjs_1[_0x994897(0x158)][_0x994897(0x140)](_0xbb305d,0xc);await database_1[_0x994897(0x158)]['shop']['update']({'where':{'id':_0x43351f},'data':{'password':_0x4c0213}});}async[a53_0x21fec2(0x12c)](_0x78e55f,_0x3990d4){const _0x3668fc=a53_0x21fec2;await this['ensureSettingsExist'](_0x78e55f);const _0x617e22={};_0x3990d4[_0x3668fc(0x152)]!==undefined&&(_0x617e22[_0x3668fc(0x14e)]=_0x3990d4[_0x3668fc(0x152)]),_0x3990d4[_0x3668fc(0x145)]!==undefined&&(_0x617e22[_0x3668fc(0x13c)]=_0x3990d4[_0x3668fc(0x145)]),_0x3990d4[_0x3668fc(0x121)]!==undefined&&(_0x617e22[_0x3668fc(0x135)]=_0x3990d4['refund']),_0x3990d4['payout']!==undefined&&(_0x617e22['notificationPayout']=_0x3990d4[_0x3668fc(0x153)]),_0x3990d4[_0x3668fc(0x14b)]!==undefined&&(_0x617e22[_0x3668fc(0x131)]=_0x3990d4[_0x3668fc(0x14b)]),_0x3990d4[_0x3668fc(0x134)]!==undefined&&(_0x617e22[_0x3668fc(0x12a)]=_0x3990d4[_0x3668fc(0x134)]),await database_1[_0x3668fc(0x158)][_0x3668fc(0x14a)][_0x3668fc(0x11f)]({'where':{'shopId':_0x78e55f},'data':_0x617e22});}async[a53_0x21fec2(0x127)](_0x55fcf0,_0x15c314){const _0x5d2ca1=a53_0x21fec2;await this[_0x5d2ca1(0x130)](_0x55fcf0);const _0x1b492c={};_0x15c314[_0x5d2ca1(0x13e)]!==undefined&&(_0x1b492c[_0x5d2ca1(0x15e)]=_0x15c314[_0x5d2ca1(0x13e)]||null),_0x15c314['chatId']!==undefined&&(_0x1b492c[_0x5d2ca1(0x15d)]=_0x15c314['chatId']||null),await database_1[_0x5d2ca1(0x158)][_0x5d2ca1(0x14a)]['update']({'where':{'shopId':_0x55fcf0},'data':_0x1b492c});}async['updateWebhookSettings'](_0x57b669,_0x4c68b3){const _0x53ff25=a53_0x21fec2;await this[_0x53ff25(0x130)](_0x57b669);const _0x3b184b={};_0x4c68b3[_0x53ff25(0x129)]!==undefined&&(_0x3b184b[_0x53ff25(0x129)]=_0x4c68b3[_0x53ff25(0x129)]||null),_0x4c68b3[_0x53ff25(0x15a)]!==undefined&&(_0x3b184b[_0x53ff25(0x15a)]=_0x4c68b3['webhookEvents']||[]),await database_1[_0x53ff25(0x158)][_0x53ff25(0x14a)][_0x53ff25(0x11f)]({'where':{'shopId':_0x57b669},'data':_0x3b184b});}async[a53_0x21fec2(0x12b)](_0x24220d){const _0x54a56c=a53_0x21fec2,_0xcddabc='pk_'+crypto_1[_0x54a56c(0x158)][_0x54a56c(0x122)](0x20)[_0x54a56c(0x12d)](_0x54a56c(0x124)),_0x2faacb=_0x54a56c(0x120)+crypto_1[_0x54a56c(0x158)][_0x54a56c(0x122)](0x20)[_0x54a56c(0x12d)]('hex');await database_1[_0x54a56c(0x158)][_0x54a56c(0x14c)]['update']({'where':{'id':_0x24220d},'data':{'publicKey':_0xcddabc,'secretKey':_0x2faacb}});}async[a53_0x21fec2(0x160)](_0x43d685,_0x23ef00){const _0x1431ef=a53_0x21fec2,{passwordConfirmation:_0x4d0550}=_0x23ef00,_0x4b8062=await database_1[_0x1431ef(0x158)][_0x1431ef(0x14c)]['findUnique']({'where':{'id':_0x43d685},'select':{'password':!![]}});if(!_0x4b8062)throw new Error('Shop\x20not\x20found');const _0xeeba76=await bcryptjs_1[_0x1431ef(0x158)]['compare'](_0x4d0550,_0x4b8062[_0x1431ef(0x133)]);if(!_0xeeba76)throw new Error(_0x1431ef(0x154));await database_1['default'][_0x1431ef(0x14c)]['delete']({'where':{'id':_0x43d685}});}async[a53_0x21fec2(0x130)](_0x4b1764){const _0x35f716=a53_0x21fec2,_0x57837a=await database_1[_0x35f716(0x158)][_0x35f716(0x14a)][_0x35f716(0x13f)]({'where':{'shopId':_0x4b1764}});!_0x57837a&&await database_1[_0x35f716(0x158)][_0x35f716(0x14a)][_0x35f716(0x14d)]({'data':{'shopId':_0x4b1764}});}}exports[a53_0x21fec2(0x138)]=SettingsService;function a53_0x3168(){const _0x45698e=['payment_success','payout','Password\x20confirmation\x20is\x20incorrect','51ieyLOv','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','1188YkLAms','default','parse','webhookEvents','compare','substring','telegramChatId','telegramBotApiKey','getShopSettings','deleteAccount','83888aylzLe','bcryptjs','update','sk_','refund','randomBytes','9283690TudrkR','hex','string','notificationPayout','updateTelegramSettings','__esModule','webhookUrl','notificationApiError','revokeAllApiKeys','updateNotifications','toString','7TSNDUj','22jtHZsA','ensureSettingsExist','notificationLogin','isArray','password','api_error','notificationRefund','3768916kWpVYe','1454704HHiedy','SettingsService','parseWebhookEvents','crypto','name','notificationPaymentFailed','max','botApiKey','findUnique','hash','shopUrl','defineProperty','27074080UMJMET','length','payment_failed','75778GgTquK','413334MsyAEo','__importDefault','Current\x20password\x20is\x20incorrect','shopSettings','login','shop','create','notificationPaymentSuccess','repeat','telegram','maskApiKey'];a53_0x3168=function(){return _0x45698e;};return a53_0x3168();}