'use strict';const a61_0x58a60e=a61_0x59be;(function(_0x195f66,_0x39eac4){const _0x467a45=a61_0x59be,_0x4bbfdd=_0x195f66();while(!![]){try{const _0x927308=-parseInt(_0x467a45(0x1af))/0x1+-parseInt(_0x467a45(0x1a2))/0x2*(parseInt(_0x467a45(0x1a1))/0x3)+-parseInt(_0x467a45(0x1a8))/0x4*(parseInt(_0x467a45(0x1a4))/0x5)+-parseInt(_0x467a45(0x193))/0x6*(-parseInt(_0x467a45(0x180))/0x7)+parseInt(_0x467a45(0x197))/0x8*(-parseInt(_0x467a45(0x1b6))/0x9)+parseInt(_0x467a45(0x1a9))/0xa*(-parseInt(_0x467a45(0x184))/0xb)+parseInt(_0x467a45(0x1ab))/0xc;if(_0x927308===_0x39eac4)break;else _0x4bbfdd['push'](_0x4bbfdd['shift']());}catch(_0x29415e){_0x4bbfdd['push'](_0x4bbfdd['shift']());}}}(a61_0x58d2,0x9d75f));var __importDefault=this&&this['__importDefault']||function(_0x1c521b){const _0xc783ff=a61_0x59be;return _0x1c521b&&_0x1c521b[_0xc783ff(0x19e)]?_0x1c521b:{'default':_0x1c521b};};Object[a61_0x58a60e(0x1ad)](exports,a61_0x58a60e(0x19e),{'value':!![]}),exports[a61_0x58a60e(0x186)]=void 0x0;function a61_0x58d2(){const _0x18fb0c=['updateNotifications','changePassword','settings','notificationLogin','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','webhookEvents','create','notificationPaymentFailed','string','repeat','delete','843899RjDrMx','notificationApiError','name','notificationRefund','11sDkzUY','password','SettingsService','parseWebhookEvents','hex','webhookUrl','update','payment_failed','updateWebhookSettings','parse','default','botApiKey','telegramChatId','toString','pk_','6cEkslJ','ensureSettingsExist','maskApiKey','telegramBotApiKey','122072wBaMbz','payout','isArray','updateTelegramSettings','randomBytes','sk_','hash','__esModule','shop','shopSettings','9pQUWTC','61450IgTZKN','shopUrl','456055hlLhCY','crypto','notificationPaymentSuccess','login','40cHypRj','7603070aFUdfw','Shop\x20not\x20found','44190312hatsbZ','max','defineProperty','../config/database','310143MlDGaF','Current\x20password\x20is\x20incorrect','chatId','payment_success','refund','Password\x20confirmation\x20is\x20incorrect','api_error','639CBNkGD','findUnique','length','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','compare','notificationPayout','deleteAccount','substring','telegram'];a61_0x58d2=function(){return _0x18fb0c;};return a61_0x58d2();}const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a61_0x58a60e(0x1a5))),database_1=__importDefault(require(a61_0x58a60e(0x1ae)));class SettingsService{['maskApiKey'](_0x36f8ee){const _0x31d0e6=a61_0x58a60e;if(!_0x36f8ee)return'';if(_0x36f8ee[_0x31d0e6(0x1b8)]<=0x8)return _0x36f8ee;const _0x331683=_0x36f8ee[_0x31d0e6(0x173)](0x0,0x8),_0xcb150a='*'[_0x31d0e6(0x17e)](Math[_0x31d0e6(0x1ac)](0x0,_0x36f8ee['length']-0x8));return _0x331683+_0xcb150a;}[a61_0x58a60e(0x187)](_0x3abdfd){const _0x3a8108=a61_0x58a60e;if(!_0x3abdfd)return[];if(Array[_0x3a8108(0x199)](_0x3abdfd))return _0x3abdfd;if(typeof _0x3abdfd===_0x3a8108(0x17d))try{const _0x1f33a9=JSON[_0x3a8108(0x18d)](_0x3abdfd);return Array['isArray'](_0x1f33a9)?_0x1f33a9:[];}catch{return[];}return[];}async['getShopSettings'](_0x5b05dd){const _0x5cf56e=a61_0x58a60e,_0x36e603=await database_1['default'][_0x5cf56e(0x19f)][_0x5cf56e(0x1b7)]({'where':{'id':_0x5b05dd},'include':{'settings':!![]}});if(!_0x36e603)throw new Error('Shop\x20not\x20found');let _0x340c1a=_0x36e603[_0x5cf56e(0x177)];return!_0x340c1a&&(_0x340c1a=await database_1[_0x5cf56e(0x18e)][_0x5cf56e(0x1a0)][_0x5cf56e(0x17b)]({'data':{'shopId':_0x36e603['id']}})),{'fullName':_0x36e603[_0x5cf56e(0x182)],'brand':_0x36e603[_0x5cf56e(0x182)],'merchantUrl':_0x36e603[_0x5cf56e(0x1a3)],'telegramUsername':_0x36e603[_0x5cf56e(0x174)],'telegramBotApiKey':_0x340c1a['telegramBotApiKey']?this[_0x5cf56e(0x195)](_0x340c1a['telegramBotApiKey']):null,'telegramChatId':_0x340c1a['telegramChatId'],'webhookUrl':_0x340c1a[_0x5cf56e(0x189)],'webhookEvents':this['parseWebhookEvents'](_0x340c1a[_0x5cf56e(0x17a)]),'notifications':{'payment_success':_0x340c1a[_0x5cf56e(0x1a6)],'payment_failed':_0x340c1a['notificationPaymentFailed'],'refund':_0x340c1a[_0x5cf56e(0x183)],'payout':_0x340c1a['notificationPayout'],'login':_0x340c1a[_0x5cf56e(0x178)],'api_error':_0x340c1a[_0x5cf56e(0x181)]}};}async[a61_0x58a60e(0x176)](_0x398c0a,_0x5d3865){const _0xaf79a9=a61_0x58a60e,{currentPassword:_0x5de67d,newPassword:_0x210f93,confirmNewPassword:_0x33c31a}=_0x5d3865;if(_0x210f93!==_0x33c31a)throw new Error(_0xaf79a9(0x179));if(_0x210f93[_0xaf79a9(0x1b8)]<0x6)throw new Error(_0xaf79a9(0x1b9));const _0x5bd698=await database_1['default'][_0xaf79a9(0x19f)][_0xaf79a9(0x1b7)]({'where':{'id':_0x398c0a},'select':{'password':!![]}});if(!_0x5bd698)throw new Error(_0xaf79a9(0x1aa));const _0x3ba5f5=await bcryptjs_1[_0xaf79a9(0x18e)][_0xaf79a9(0x1ba)](_0x5de67d,_0x5bd698['password']);if(!_0x3ba5f5)throw new Error(_0xaf79a9(0x1b0));const _0xcf23e1=await bcryptjs_1[_0xaf79a9(0x18e)][_0xaf79a9(0x19d)](_0x210f93,0xc);await database_1[_0xaf79a9(0x18e)][_0xaf79a9(0x19f)][_0xaf79a9(0x18a)]({'where':{'id':_0x398c0a},'data':{'password':_0xcf23e1}});}async[a61_0x58a60e(0x175)](_0x9304f8,_0x14f813){const _0xec9949=a61_0x58a60e;await this[_0xec9949(0x194)](_0x9304f8);const _0x215cd7={};_0x14f813[_0xec9949(0x1b2)]!==undefined&&(_0x215cd7['notificationPaymentSuccess']=_0x14f813[_0xec9949(0x1b2)]),_0x14f813[_0xec9949(0x18b)]!==undefined&&(_0x215cd7[_0xec9949(0x17c)]=_0x14f813['payment_failed']),_0x14f813[_0xec9949(0x1b3)]!==undefined&&(_0x215cd7[_0xec9949(0x183)]=_0x14f813['refund']),_0x14f813[_0xec9949(0x198)]!==undefined&&(_0x215cd7[_0xec9949(0x171)]=_0x14f813[_0xec9949(0x198)]),_0x14f813[_0xec9949(0x1a7)]!==undefined&&(_0x215cd7[_0xec9949(0x178)]=_0x14f813[_0xec9949(0x1a7)]),_0x14f813[_0xec9949(0x1b5)]!==undefined&&(_0x215cd7[_0xec9949(0x181)]=_0x14f813[_0xec9949(0x1b5)]),await database_1[_0xec9949(0x18e)][_0xec9949(0x1a0)][_0xec9949(0x18a)]({'where':{'shopId':_0x9304f8},'data':_0x215cd7});}async[a61_0x58a60e(0x19a)](_0x29fa96,_0x30574b){const _0x447b36=a61_0x58a60e;await this['ensureSettingsExist'](_0x29fa96);const _0x1e3e22={};_0x30574b[_0x447b36(0x18f)]!==undefined&&(_0x1e3e22[_0x447b36(0x196)]=_0x30574b[_0x447b36(0x18f)]||null),_0x30574b[_0x447b36(0x1b1)]!==undefined&&(_0x1e3e22[_0x447b36(0x190)]=_0x30574b[_0x447b36(0x1b1)]||null),await database_1[_0x447b36(0x18e)][_0x447b36(0x1a0)][_0x447b36(0x18a)]({'where':{'shopId':_0x29fa96},'data':_0x1e3e22});}async[a61_0x58a60e(0x18c)](_0x19e51f,_0x3793b0){const _0x5dd3ba=a61_0x58a60e;await this[_0x5dd3ba(0x194)](_0x19e51f);const _0x1948a1={};_0x3793b0[_0x5dd3ba(0x189)]!==undefined&&(_0x1948a1[_0x5dd3ba(0x189)]=_0x3793b0[_0x5dd3ba(0x189)]||null),_0x3793b0[_0x5dd3ba(0x17a)]!==undefined&&(_0x1948a1[_0x5dd3ba(0x17a)]=_0x3793b0['webhookEvents']||[]),await database_1[_0x5dd3ba(0x18e)][_0x5dd3ba(0x1a0)]['update']({'where':{'shopId':_0x19e51f},'data':_0x1948a1});}async['revokeAllApiKeys'](_0x10c620){const _0x218412=a61_0x58a60e,_0x2e3018=_0x218412(0x192)+crypto_1[_0x218412(0x18e)][_0x218412(0x19b)](0x20)[_0x218412(0x191)](_0x218412(0x188)),_0xffb6b5=_0x218412(0x19c)+crypto_1[_0x218412(0x18e)][_0x218412(0x19b)](0x20)[_0x218412(0x191)]('hex');await database_1['default'][_0x218412(0x19f)]['update']({'where':{'id':_0x10c620},'data':{'publicKey':_0x2e3018,'secretKey':_0xffb6b5}});}async[a61_0x58a60e(0x172)](_0x4886b5,_0x146a49){const _0x14f6b3=a61_0x58a60e,{passwordConfirmation:_0x33b31c}=_0x146a49,_0x5f53bf=await database_1[_0x14f6b3(0x18e)]['shop'][_0x14f6b3(0x1b7)]({'where':{'id':_0x4886b5},'select':{'password':!![]}});if(!_0x5f53bf)throw new Error(_0x14f6b3(0x1aa));const _0x4ebb97=await bcryptjs_1[_0x14f6b3(0x18e)]['compare'](_0x33b31c,_0x5f53bf[_0x14f6b3(0x185)]);if(!_0x4ebb97)throw new Error(_0x14f6b3(0x1b4));await database_1[_0x14f6b3(0x18e)][_0x14f6b3(0x19f)][_0x14f6b3(0x17f)]({'where':{'id':_0x4886b5}});}async[a61_0x58a60e(0x194)](_0x53769b){const _0x450a81=a61_0x58a60e,_0x12fb1f=await database_1['default'][_0x450a81(0x1a0)][_0x450a81(0x1b7)]({'where':{'shopId':_0x53769b}});!_0x12fb1f&&await database_1[_0x450a81(0x18e)][_0x450a81(0x1a0)]['create']({'data':{'shopId':_0x53769b}});}}function a61_0x59be(_0x53f1fb,_0x204fbd){const _0x58d26a=a61_0x58d2();return a61_0x59be=function(_0x59be41,_0x19f5e1){_0x59be41=_0x59be41-0x171;let _0x162da7=_0x58d26a[_0x59be41];return _0x162da7;},a61_0x59be(_0x53f1fb,_0x204fbd);}exports[a61_0x58a60e(0x186)]=SettingsService;