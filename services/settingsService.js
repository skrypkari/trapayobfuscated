'use strict';const a47_0x3e0139=a47_0x3930;(function(_0x17d548,_0x1ee0bc){const _0x6fdbd=a47_0x3930,_0xc848c4=_0x17d548();while(!![]){try{const _0x54f98d=-parseInt(_0x6fdbd(0x113))/0x1*(-parseInt(_0x6fdbd(0x11d))/0x2)+-parseInt(_0x6fdbd(0x154))/0x3*(-parseInt(_0x6fdbd(0x114))/0x4)+-parseInt(_0x6fdbd(0x131))/0x5+parseInt(_0x6fdbd(0x13b))/0x6+parseInt(_0x6fdbd(0x11f))/0x7+parseInt(_0x6fdbd(0x13d))/0x8*(-parseInt(_0x6fdbd(0x13c))/0x9)+parseInt(_0x6fdbd(0x12f))/0xa;if(_0x54f98d===_0x1ee0bc)break;else _0xc848c4['push'](_0xc848c4['shift']());}catch(_0x699194){_0xc848c4['push'](_0xc848c4['shift']());}}}(a47_0x5c17,0x23264));var __importDefault=this&&this[a47_0x3e0139(0x11a)]||function(_0x5182b5){const _0xd413f9=a47_0x3e0139;return _0x5182b5&&_0x5182b5[_0xd413f9(0x147)]?_0x5182b5:{'default':_0x5182b5};};Object[a47_0x3e0139(0x128)](exports,a47_0x3e0139(0x147),{'value':!![]}),exports[a47_0x3e0139(0x14a)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a47_0x3e0139(0x124))),database_1=__importDefault(require('../config/database'));class SettingsService{[a47_0x3e0139(0x151)](_0x43ca6c){const _0x2ea18c=a47_0x3e0139;if(!_0x43ca6c)return'';if(_0x43ca6c['length']<=0x8)return _0x43ca6c;const _0x326885=_0x43ca6c[_0x2ea18c(0x136)](0x0,0x8),_0x2372da='*'[_0x2ea18c(0x12d)](Math[_0x2ea18c(0x135)](0x0,_0x43ca6c[_0x2ea18c(0x146)]-0x8));return _0x326885+_0x2372da;}[a47_0x3e0139(0x133)](_0x4f75f3){const _0x17f497=a47_0x3e0139;if(!_0x4f75f3)return[];if(Array[_0x17f497(0x13f)](_0x4f75f3))return _0x4f75f3;if(typeof _0x4f75f3===_0x17f497(0x138))try{const _0x18c7bb=JSON[_0x17f497(0x139)](_0x4f75f3);return Array[_0x17f497(0x13f)](_0x18c7bb)?_0x18c7bb:[];}catch{return[];}return[];}async[a47_0x3e0139(0x130)](_0x219e0f){const _0x25336f=a47_0x3e0139,_0x334cc9=await database_1['default'][_0x25336f(0x13e)][_0x25336f(0x11e)]({'where':{'id':_0x219e0f},'include':{'settings':!![]}});if(!_0x334cc9)throw new Error(_0x25336f(0x140));let _0x5960f6=_0x334cc9[_0x25336f(0x123)];return!_0x5960f6&&(_0x5960f6=await database_1[_0x25336f(0x127)][_0x25336f(0x129)]['create']({'data':{'shopId':_0x334cc9['id']}})),{'fullName':_0x334cc9[_0x25336f(0x153)],'brand':_0x334cc9[_0x25336f(0x153)],'merchantUrl':_0x334cc9[_0x25336f(0x112)],'telegramUsername':_0x334cc9[_0x25336f(0x111)],'telegramBotApiKey':_0x5960f6[_0x25336f(0x14f)]?this[_0x25336f(0x151)](_0x5960f6[_0x25336f(0x14f)]):null,'telegramChatId':_0x5960f6[_0x25336f(0x148)],'webhookUrl':_0x5960f6[_0x25336f(0x141)],'webhookEvents':this[_0x25336f(0x133)](_0x5960f6['webhookEvents']),'notifications':{'payment_success':_0x5960f6['notificationPaymentSuccess'],'payment_failed':_0x5960f6['notificationPaymentFailed'],'refund':_0x5960f6[_0x25336f(0x116)],'payout':_0x5960f6[_0x25336f(0x115)],'login':_0x5960f6['notificationLogin'],'api_error':_0x5960f6[_0x25336f(0x155)]}};}async[a47_0x3e0139(0x137)](_0x20dbd5,_0x826572){const _0x4d0c61=a47_0x3e0139,{currentPassword:_0x2214ac,newPassword:_0x456b6b,confirmNewPassword:_0x8fa2b4}=_0x826572;if(_0x456b6b!==_0x8fa2b4)throw new Error(_0x4d0c61(0x125));if(_0x456b6b['length']<0x6)throw new Error(_0x4d0c61(0x120));const _0x2b479e=await database_1[_0x4d0c61(0x127)][_0x4d0c61(0x13e)][_0x4d0c61(0x11e)]({'where':{'id':_0x20dbd5},'select':{'password':!![]}});if(!_0x2b479e)throw new Error('Shop\x20not\x20found');const _0x34be5b=await bcryptjs_1[_0x4d0c61(0x127)][_0x4d0c61(0x126)](_0x2214ac,_0x2b479e[_0x4d0c61(0x14e)]);if(!_0x34be5b)throw new Error('Current\x20password\x20is\x20incorrect');const _0x266e87=await bcryptjs_1[_0x4d0c61(0x127)][_0x4d0c61(0x12a)](_0x456b6b,0xc);await database_1[_0x4d0c61(0x127)][_0x4d0c61(0x13e)][_0x4d0c61(0x121)]({'where':{'id':_0x20dbd5},'data':{'password':_0x266e87}});}async[a47_0x3e0139(0x11c)](_0x12a1d4,_0x3b2a8c){const _0x5dee30=a47_0x3e0139;await this[_0x5dee30(0x132)](_0x12a1d4);const _0x194291={};_0x3b2a8c['payment_success']!==undefined&&(_0x194291[_0x5dee30(0x110)]=_0x3b2a8c['payment_success']),_0x3b2a8c[_0x5dee30(0x145)]!==undefined&&(_0x194291[_0x5dee30(0x143)]=_0x3b2a8c[_0x5dee30(0x145)]),_0x3b2a8c['refund']!==undefined&&(_0x194291[_0x5dee30(0x116)]=_0x3b2a8c[_0x5dee30(0x14c)]),_0x3b2a8c[_0x5dee30(0x149)]!==undefined&&(_0x194291['notificationPayout']=_0x3b2a8c[_0x5dee30(0x149)]),_0x3b2a8c['login']!==undefined&&(_0x194291[_0x5dee30(0x150)]=_0x3b2a8c[_0x5dee30(0x118)]),_0x3b2a8c[_0x5dee30(0x144)]!==undefined&&(_0x194291[_0x5dee30(0x155)]=_0x3b2a8c[_0x5dee30(0x144)]),await database_1[_0x5dee30(0x127)][_0x5dee30(0x129)][_0x5dee30(0x121)]({'where':{'shopId':_0x12a1d4},'data':_0x194291});}async[a47_0x3e0139(0x152)](_0x2baf71,_0x4a8e31){const _0x363b7e=a47_0x3e0139;await this['ensureSettingsExist'](_0x2baf71);const _0x43e09a={};_0x4a8e31[_0x363b7e(0x122)]!==undefined&&(_0x43e09a[_0x363b7e(0x14f)]=_0x4a8e31[_0x363b7e(0x122)]||null),_0x4a8e31[_0x363b7e(0x117)]!==undefined&&(_0x43e09a[_0x363b7e(0x148)]=_0x4a8e31[_0x363b7e(0x117)]||null),await database_1[_0x363b7e(0x127)][_0x363b7e(0x129)]['update']({'where':{'shopId':_0x2baf71},'data':_0x43e09a});}async[a47_0x3e0139(0x119)](_0x80ce89,_0x587cd3){const _0x593824=a47_0x3e0139;await this['ensureSettingsExist'](_0x80ce89);const _0x343b76={};_0x587cd3[_0x593824(0x141)]!==undefined&&(_0x343b76['webhookUrl']=_0x587cd3['webhookUrl']||null),_0x587cd3[_0x593824(0x13a)]!==undefined&&(_0x343b76[_0x593824(0x13a)]=_0x587cd3[_0x593824(0x13a)]||[]),await database_1[_0x593824(0x127)]['shopSettings'][_0x593824(0x121)]({'where':{'shopId':_0x80ce89},'data':_0x343b76});}async[a47_0x3e0139(0x12c)](_0x36ded0){const _0x313276=a47_0x3e0139,_0x4cd5cb=_0x313276(0x134)+crypto_1[_0x313276(0x127)][_0x313276(0x142)](0x20)[_0x313276(0x14b)](_0x313276(0x14d)),_0x4bc7a9=_0x313276(0x12e)+crypto_1['default'][_0x313276(0x142)](0x20)['toString'](_0x313276(0x14d));await database_1['default'][_0x313276(0x13e)]['update']({'where':{'id':_0x36ded0},'data':{'publicKey':_0x4cd5cb,'secretKey':_0x4bc7a9}});}async['deleteAccount'](_0x174edb,_0x1f4226){const _0x250212=a47_0x3e0139,{passwordConfirmation:_0x85a4a}=_0x1f4226,_0x5c7d1b=await database_1[_0x250212(0x127)][_0x250212(0x13e)][_0x250212(0x11e)]({'where':{'id':_0x174edb},'select':{'password':!![]}});if(!_0x5c7d1b)throw new Error(_0x250212(0x140));const _0x51708a=await bcryptjs_1[_0x250212(0x127)][_0x250212(0x126)](_0x85a4a,_0x5c7d1b[_0x250212(0x14e)]);if(!_0x51708a)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1['default'][_0x250212(0x13e)][_0x250212(0x12b)]({'where':{'id':_0x174edb}});}async[a47_0x3e0139(0x132)](_0x768a4){const _0x311eda=a47_0x3e0139,_0x112ac7=await database_1[_0x311eda(0x127)][_0x311eda(0x129)]['findUnique']({'where':{'shopId':_0x768a4}});!_0x112ac7&&await database_1[_0x311eda(0x127)][_0x311eda(0x129)][_0x311eda(0x11b)]({'data':{'shopId':_0x768a4}});}}exports['SettingsService']=SettingsService;function a47_0x3930(_0x2b6410,_0x331c97){const _0x5c178e=a47_0x5c17();return a47_0x3930=function(_0x39307d,_0x25c52b){_0x39307d=_0x39307d-0x110;let _0x2878ef=_0x5c178e[_0x39307d];return _0x2878ef;},a47_0x3930(_0x2b6410,_0x331c97);}function a47_0x5c17(){const _0x3021c5=['shopUrl','3dEhdTm','4bzEodZ','notificationPayout','notificationRefund','chatId','login','updateWebhookSettings','__importDefault','create','updateNotifications','13718nkgbEc','findUnique','715750ImfXaQ','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','update','botApiKey','settings','crypto','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','compare','default','defineProperty','shopSettings','hash','delete','revokeAllApiKeys','repeat','sk_','1296250rtRNGZ','getShopSettings','444420hAJtNu','ensureSettingsExist','parseWebhookEvents','pk_','max','substring','changePassword','string','parse','webhookEvents','561468yPbEqV','1017cyzGeM','18232Zacyxm','shop','isArray','Shop\x20not\x20found','webhookUrl','randomBytes','notificationPaymentFailed','api_error','payment_failed','length','__esModule','telegramChatId','payout','SettingsService','toString','refund','hex','password','telegramBotApiKey','notificationLogin','maskApiKey','updateTelegramSettings','name','433059OUJsNK','notificationApiError','notificationPaymentSuccess','telegram'];a47_0x5c17=function(){return _0x3021c5;};return a47_0x5c17();}