'use strict';const a47_0x252a66=a47_0x1109;(function(_0x189913,_0x319413){const _0x53ee70=a47_0x1109,_0x3f9c84=_0x189913();while(!![]){try{const _0x2ce345=-parseInt(_0x53ee70(0x115))/0x1*(parseInt(_0x53ee70(0x109))/0x2)+parseInt(_0x53ee70(0x11b))/0x3*(parseInt(_0x53ee70(0x10f))/0x4)+parseInt(_0x53ee70(0x106))/0x5*(-parseInt(_0x53ee70(0x104))/0x6)+-parseInt(_0x53ee70(0x122))/0x7+parseInt(_0x53ee70(0x10d))/0x8*(parseInt(_0x53ee70(0x10c))/0x9)+parseInt(_0x53ee70(0x119))/0xa*(parseInt(_0x53ee70(0x123))/0xb)+parseInt(_0x53ee70(0xfa))/0xc;if(_0x2ce345===_0x319413)break;else _0x3f9c84['push'](_0x3f9c84['shift']());}catch(_0x27b26e){_0x3f9c84['push'](_0x3f9c84['shift']());}}}(a47_0x490c,0xe8dbf));function a47_0x1109(_0x28ef67,_0x14d891){const _0x490c25=a47_0x490c();return a47_0x1109=function(_0x1109f6,_0x5c3693){_0x1109f6=_0x1109f6-0xee;let _0xa2871c=_0x490c25[_0x1109f6];return _0xa2871c;},a47_0x1109(_0x28ef67,_0x14d891);}var __importDefault=this&&this[a47_0x252a66(0x117)]||function(_0x40db3a){return _0x40db3a&&_0x40db3a['__esModule']?_0x40db3a:{'default':_0x40db3a};};Object[a47_0x252a66(0xfe)](exports,'__esModule',{'value':!![]}),exports[a47_0x252a66(0xf2)]=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x252a66(0x113))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a47_0x252a66(0x114)));class SettingsService{[a47_0x252a66(0x100)](_0x4ac0ca){const _0x2f1b6e=a47_0x252a66;if(!_0x4ac0ca)return'';if(_0x4ac0ca[_0x2f1b6e(0x107)]<=0x8)return _0x4ac0ca;const _0x1da44e=_0x4ac0ca['substring'](0x0,0x8),_0xe5f876='*'[_0x2f1b6e(0x128)](Math['max'](0x0,_0x4ac0ca[_0x2f1b6e(0x107)]-0x8));return _0x1da44e+_0xe5f876;}[a47_0x252a66(0x11e)](_0x51421c){const _0x76f8a1=a47_0x252a66;if(!_0x51421c)return[];if(Array[_0x76f8a1(0x126)](_0x51421c))return _0x51421c;if(typeof _0x51421c==='string')try{const _0x11b8aa=JSON[_0x76f8a1(0xf0)](_0x51421c);return Array['isArray'](_0x11b8aa)?_0x11b8aa:[];}catch{return[];}return[];}async[a47_0x252a66(0x12d)](_0x7ad6a7){const _0x48d334=a47_0x252a66,_0x2054e4=await database_1['default'][_0x48d334(0xff)][_0x48d334(0x105)]({'where':{'id':_0x7ad6a7},'include':{'settings':!![]}});if(!_0x2054e4)throw new Error(_0x48d334(0xf3));let _0x366a5c=_0x2054e4[_0x48d334(0x103)];return!_0x366a5c&&(_0x366a5c=await database_1[_0x48d334(0x111)]['shopSettings'][_0x48d334(0x129)]({'data':{'shopId':_0x2054e4['id']}})),{'fullName':_0x2054e4['name'],'brand':_0x2054e4[_0x48d334(0xee)],'merchantUrl':_0x2054e4['shopUrl'],'telegramUsername':_0x2054e4[_0x48d334(0xfd)],'telegramBotApiKey':_0x366a5c[_0x48d334(0xf9)]?this[_0x48d334(0x100)](_0x366a5c[_0x48d334(0xf9)]):null,'telegramChatId':_0x366a5c['telegramChatId'],'webhookUrl':_0x366a5c[_0x48d334(0x11f)],'webhookEvents':this[_0x48d334(0x11e)](_0x366a5c[_0x48d334(0xfc)]),'notifications':{'payment_success':_0x366a5c['notificationPaymentSuccess'],'payment_failed':_0x366a5c[_0x48d334(0xf1)],'refund':_0x366a5c[_0x48d334(0x112)],'payout':_0x366a5c[_0x48d334(0xf7)],'login':_0x366a5c[_0x48d334(0x11c)],'api_error':_0x366a5c[_0x48d334(0xf8)]}};}async[a47_0x252a66(0x11a)](_0x32acc6,_0xb2b572){const _0x5b256f=a47_0x252a66,{currentPassword:_0xedb51e,newPassword:_0x33136b,confirmNewPassword:_0x5f2984}=_0xb2b572;if(_0x33136b!==_0x5f2984)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x33136b[_0x5b256f(0x107)]<0x6)throw new Error(_0x5b256f(0x10a));const _0x1425d0=await database_1[_0x5b256f(0x111)][_0x5b256f(0xff)]['findUnique']({'where':{'id':_0x32acc6},'select':{'password':!![]}});if(!_0x1425d0)throw new Error(_0x5b256f(0xf3));const _0x578592=await bcryptjs_1[_0x5b256f(0x111)][_0x5b256f(0xf5)](_0xedb51e,_0x1425d0['password']);if(!_0x578592)throw new Error(_0x5b256f(0x12c));const _0x3861a4=await bcryptjs_1[_0x5b256f(0x111)][_0x5b256f(0x125)](_0x33136b,0xc);await database_1['default']['shop'][_0x5b256f(0x110)]({'where':{'id':_0x32acc6},'data':{'password':_0x3861a4}});}async['updateNotifications'](_0x3ffca0,_0x56d671){const _0x1200d4=a47_0x252a66;await this[_0x1200d4(0x102)](_0x3ffca0);const _0x3f5c09={};_0x56d671[_0x1200d4(0x108)]!==undefined&&(_0x3f5c09['notificationPaymentSuccess']=_0x56d671[_0x1200d4(0x108)]),_0x56d671[_0x1200d4(0x120)]!==undefined&&(_0x3f5c09[_0x1200d4(0xf1)]=_0x56d671[_0x1200d4(0x120)]),_0x56d671['refund']!==undefined&&(_0x3f5c09[_0x1200d4(0x112)]=_0x56d671[_0x1200d4(0xef)]),_0x56d671['payout']!==undefined&&(_0x3f5c09['notificationPayout']=_0x56d671[_0x1200d4(0xf6)]),_0x56d671['login']!==undefined&&(_0x3f5c09[_0x1200d4(0x11c)]=_0x56d671[_0x1200d4(0xf4)]),_0x56d671[_0x1200d4(0x101)]!==undefined&&(_0x3f5c09[_0x1200d4(0xf8)]=_0x56d671['api_error']),await database_1[_0x1200d4(0x111)][_0x1200d4(0x11d)][_0x1200d4(0x110)]({'where':{'shopId':_0x3ffca0},'data':_0x3f5c09});}async[a47_0x252a66(0x121)](_0x52f817,_0x25b21f){const _0xd9d282=a47_0x252a66;await this[_0xd9d282(0x102)](_0x52f817);const _0xb5bfbd={};_0x25b21f['botApiKey']!==undefined&&(_0xb5bfbd[_0xd9d282(0xf9)]=_0x25b21f['botApiKey']||null),_0x25b21f[_0xd9d282(0x10b)]!==undefined&&(_0xb5bfbd[_0xd9d282(0x127)]=_0x25b21f[_0xd9d282(0x10b)]||null),await database_1[_0xd9d282(0x111)]['shopSettings']['update']({'where':{'shopId':_0x52f817},'data':_0xb5bfbd});}async['updateWebhookSettings'](_0x1969d4,_0x2f0628){const _0xd5b0f0=a47_0x252a66;await this[_0xd5b0f0(0x102)](_0x1969d4);const _0x416daf={};_0x2f0628[_0xd5b0f0(0x11f)]!==undefined&&(_0x416daf[_0xd5b0f0(0x11f)]=_0x2f0628['webhookUrl']||null),_0x2f0628[_0xd5b0f0(0xfc)]!==undefined&&(_0x416daf[_0xd5b0f0(0xfc)]=_0x2f0628[_0xd5b0f0(0xfc)]||[]),await database_1[_0xd5b0f0(0x111)][_0xd5b0f0(0x11d)]['update']({'where':{'shopId':_0x1969d4},'data':_0x416daf});}async[a47_0x252a66(0xfb)](_0x142e4f){const _0x2ab3a5=a47_0x252a66,_0x1bcae9=_0x2ab3a5(0x10e)+crypto_1[_0x2ab3a5(0x111)][_0x2ab3a5(0x124)](0x20)['toString'](_0x2ab3a5(0x12a)),_0xb0dac=_0x2ab3a5(0x12b)+crypto_1[_0x2ab3a5(0x111)][_0x2ab3a5(0x124)](0x20)['toString'](_0x2ab3a5(0x12a));await database_1[_0x2ab3a5(0x111)][_0x2ab3a5(0xff)][_0x2ab3a5(0x110)]({'where':{'id':_0x142e4f},'data':{'publicKey':_0x1bcae9,'secretKey':_0xb0dac}});}async[a47_0x252a66(0x116)](_0xb0fd5a,_0x1a8463){const _0x106996=a47_0x252a66,{passwordConfirmation:_0x4b8f27}=_0x1a8463,_0x2be4c0=await database_1[_0x106996(0x111)][_0x106996(0xff)][_0x106996(0x105)]({'where':{'id':_0xb0fd5a},'select':{'password':!![]}});if(!_0x2be4c0)throw new Error(_0x106996(0xf3));const _0x2a0705=await bcryptjs_1[_0x106996(0x111)][_0x106996(0xf5)](_0x4b8f27,_0x2be4c0['password']);if(!_0x2a0705)throw new Error(_0x106996(0x118));await database_1['default'][_0x106996(0xff)]['delete']({'where':{'id':_0xb0fd5a}});}async[a47_0x252a66(0x102)](_0x8c7d65){const _0x601f97=a47_0x252a66,_0x99e260=await database_1['default'][_0x601f97(0x11d)][_0x601f97(0x105)]({'where':{'shopId':_0x8c7d65}});!_0x99e260&&await database_1['default']['shopSettings'][_0x601f97(0x129)]({'data':{'shopId':_0x8c7d65}});}}function a47_0x490c(){const _0x42b2e6=['notificationApiError','telegramBotApiKey','22152432PKJVpt','revokeAllApiKeys','webhookEvents','telegram','defineProperty','shop','maskApiKey','api_error','ensureSettingsExist','settings','6RCFNOs','findUnique','9122395YaiCux','length','payment_success','74yyGkCE','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','chatId','162smMoFc','63432lNMtmr','pk_','6489908bxucCs','update','default','notificationRefund','bcryptjs','../config/database','917RoTtfG','deleteAccount','__importDefault','Password\x20confirmation\x20is\x20incorrect','1510wgiawd','changePassword','3cIebuW','notificationLogin','shopSettings','parseWebhookEvents','webhookUrl','payment_failed','updateTelegramSettings','10012569MYeqRd','45991btyIJt','randomBytes','hash','isArray','telegramChatId','repeat','create','hex','sk_','Current\x20password\x20is\x20incorrect','getShopSettings','name','refund','parse','notificationPaymentFailed','SettingsService','Shop\x20not\x20found','login','compare','payout','notificationPayout'];a47_0x490c=function(){return _0x42b2e6;};return a47_0x490c();}exports[a47_0x252a66(0xf2)]=SettingsService;