'use strict';const a55_0x5bf978=a55_0x3865;(function(_0x2763a1,_0x13e186){const _0x34fc7d=a55_0x3865,_0x49b766=_0x2763a1();while(!![]){try{const _0x544770=parseInt(_0x34fc7d(0x153))/0x1*(-parseInt(_0x34fc7d(0x13b))/0x2)+parseInt(_0x34fc7d(0x155))/0x3*(-parseInt(_0x34fc7d(0x16d))/0x4)+-parseInt(_0x34fc7d(0x138))/0x5+-parseInt(_0x34fc7d(0x14a))/0x6+parseInt(_0x34fc7d(0x140))/0x7*(parseInt(_0x34fc7d(0x135))/0x8)+parseInt(_0x34fc7d(0x13a))/0x9+parseInt(_0x34fc7d(0x157))/0xa*(parseInt(_0x34fc7d(0x15e))/0xb);if(_0x544770===_0x13e186)break;else _0x49b766['push'](_0x49b766['shift']());}catch(_0x185530){_0x49b766['push'](_0x49b766['shift']());}}}(a55_0x3f4e,0x654ce));function a55_0x3f4e(){const _0x361336=['telegramChatId','803WLNWyh','updateTelegramSettings','default','webhookEvents','login','__esModule','pk_','../config/database','maskApiKey','notificationApiError','isArray','chatId','notificationLogin','defineProperty','randomBytes','4SxIdKi','create','webhookUrl','name','8mWcMbK','notificationPayout','revokeAllApiKeys','2871405dhDHcA','update','2581488PWXkgH','2TNUEjo','shop','hex','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','shopUrl','1131767tZrexr','payment_failed','shopSettings','refund','telegramBotApiKey','ensureSettingsExist','Shop\x20not\x20found','telegram','length','botApiKey','2289708YzEUHX','deleteAccount','Current\x20password\x20is\x20incorrect','notificationRefund','password','api_error','payment_success','findUnique','toString','352906hdFSMe','payout','1384575cOOsQo','parseWebhookEvents','237910kFPfCc','compare','SettingsService','sk_','notificationPaymentSuccess','settings'];a55_0x3f4e=function(){return _0x361336;};return a55_0x3f4e();}var __importDefault=this&&this['__importDefault']||function(_0x105f3c){const _0x77d42d=a55_0x3865;return _0x105f3c&&_0x105f3c[_0x77d42d(0x163)]?_0x105f3c:{'default':_0x105f3c};};function a55_0x3865(_0x37c21c,_0xbcd7c5){const _0x3f4efa=a55_0x3f4e();return a55_0x3865=function(_0x386522,_0x4fea84){_0x386522=_0x386522-0x135;let _0x5ce8ea=_0x3f4efa[_0x386522];return _0x5ce8ea;},a55_0x3865(_0x37c21c,_0xbcd7c5);}Object[a55_0x5bf978(0x16b)](exports,a55_0x5bf978(0x163),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a55_0x5bf978(0x165)));class SettingsService{[a55_0x5bf978(0x166)](_0x4fd90f){const _0x5a1a31=a55_0x5bf978;if(!_0x4fd90f)return'';if(_0x4fd90f[_0x5a1a31(0x148)]<=0x8)return _0x4fd90f;const _0x5d9507=_0x4fd90f['substring'](0x0,0x8),_0x5ee4bd='*'['repeat'](Math['max'](0x0,_0x4fd90f[_0x5a1a31(0x148)]-0x8));return _0x5d9507+_0x5ee4bd;}[a55_0x5bf978(0x156)](_0x5dc135){const _0x4896ff=a55_0x5bf978;if(!_0x5dc135)return[];if(Array['isArray'](_0x5dc135))return _0x5dc135;if(typeof _0x5dc135==='string')try{const _0x187fd7=JSON['parse'](_0x5dc135);return Array[_0x4896ff(0x168)](_0x187fd7)?_0x187fd7:[];}catch{return[];}return[];}async['getShopSettings'](_0x52d57d){const _0x5ae65f=a55_0x5bf978,_0x3d4051=await database_1['default']['shop'][_0x5ae65f(0x151)]({'where':{'id':_0x52d57d},'include':{'settings':!![]}});if(!_0x3d4051)throw new Error(_0x5ae65f(0x146));let _0x5f4ac4=_0x3d4051[_0x5ae65f(0x15c)];return!_0x5f4ac4&&(_0x5f4ac4=await database_1[_0x5ae65f(0x160)][_0x5ae65f(0x142)][_0x5ae65f(0x16e)]({'data':{'shopId':_0x3d4051['id']}})),{'fullName':_0x3d4051[_0x5ae65f(0x170)],'brand':_0x3d4051[_0x5ae65f(0x170)],'merchantUrl':_0x3d4051[_0x5ae65f(0x13f)],'telegramUsername':_0x3d4051[_0x5ae65f(0x147)],'telegramBotApiKey':_0x5f4ac4['telegramBotApiKey']?this[_0x5ae65f(0x166)](_0x5f4ac4[_0x5ae65f(0x144)]):null,'telegramChatId':_0x5f4ac4[_0x5ae65f(0x15d)],'webhookUrl':_0x5f4ac4[_0x5ae65f(0x16f)],'webhookEvents':this[_0x5ae65f(0x156)](_0x5f4ac4[_0x5ae65f(0x161)]),'notifications':{'payment_success':_0x5f4ac4['notificationPaymentSuccess'],'payment_failed':_0x5f4ac4['notificationPaymentFailed'],'refund':_0x5f4ac4[_0x5ae65f(0x14d)],'payout':_0x5f4ac4[_0x5ae65f(0x136)],'login':_0x5f4ac4[_0x5ae65f(0x16a)],'api_error':_0x5f4ac4[_0x5ae65f(0x167)]}};}async['changePassword'](_0x1d4b4e,_0x57d169){const _0x5c8cdf=a55_0x5bf978,{currentPassword:_0x580c9c,newPassword:_0x30194d,confirmNewPassword:_0x281638}=_0x57d169;if(_0x30194d!==_0x281638)throw new Error(_0x5c8cdf(0x13e));if(_0x30194d[_0x5c8cdf(0x148)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x2c25a0=await database_1[_0x5c8cdf(0x160)][_0x5c8cdf(0x13c)][_0x5c8cdf(0x151)]({'where':{'id':_0x1d4b4e},'select':{'password':!![]}});if(!_0x2c25a0)throw new Error(_0x5c8cdf(0x146));const _0x10f882=await bcryptjs_1[_0x5c8cdf(0x160)][_0x5c8cdf(0x158)](_0x580c9c,_0x2c25a0[_0x5c8cdf(0x14e)]);if(!_0x10f882)throw new Error(_0x5c8cdf(0x14c));const _0xa084af=await bcryptjs_1[_0x5c8cdf(0x160)]['hash'](_0x30194d,0xc);await database_1[_0x5c8cdf(0x160)][_0x5c8cdf(0x13c)][_0x5c8cdf(0x139)]({'where':{'id':_0x1d4b4e},'data':{'password':_0xa084af}});}async['updateNotifications'](_0x5f401b,_0x2d7b0c){const _0x3c1a2=a55_0x5bf978;await this['ensureSettingsExist'](_0x5f401b);const _0x427ff7={};_0x2d7b0c['payment_success']!==undefined&&(_0x427ff7[_0x3c1a2(0x15b)]=_0x2d7b0c[_0x3c1a2(0x150)]),_0x2d7b0c[_0x3c1a2(0x141)]!==undefined&&(_0x427ff7['notificationPaymentFailed']=_0x2d7b0c[_0x3c1a2(0x141)]),_0x2d7b0c[_0x3c1a2(0x143)]!==undefined&&(_0x427ff7[_0x3c1a2(0x14d)]=_0x2d7b0c[_0x3c1a2(0x143)]),_0x2d7b0c['payout']!==undefined&&(_0x427ff7[_0x3c1a2(0x136)]=_0x2d7b0c[_0x3c1a2(0x154)]),_0x2d7b0c[_0x3c1a2(0x162)]!==undefined&&(_0x427ff7[_0x3c1a2(0x16a)]=_0x2d7b0c[_0x3c1a2(0x162)]),_0x2d7b0c['api_error']!==undefined&&(_0x427ff7[_0x3c1a2(0x167)]=_0x2d7b0c[_0x3c1a2(0x14f)]),await database_1[_0x3c1a2(0x160)]['shopSettings'][_0x3c1a2(0x139)]({'where':{'shopId':_0x5f401b},'data':_0x427ff7});}async[a55_0x5bf978(0x15f)](_0x3cb78d,_0x3afbdc){const _0x287ba7=a55_0x5bf978;await this[_0x287ba7(0x145)](_0x3cb78d);const _0x1864b0={};_0x3afbdc['botApiKey']!==undefined&&(_0x1864b0[_0x287ba7(0x144)]=_0x3afbdc[_0x287ba7(0x149)]||null),_0x3afbdc[_0x287ba7(0x169)]!==undefined&&(_0x1864b0['telegramChatId']=_0x3afbdc[_0x287ba7(0x169)]||null),await database_1[_0x287ba7(0x160)][_0x287ba7(0x142)]['update']({'where':{'shopId':_0x3cb78d},'data':_0x1864b0});}async['updateWebhookSettings'](_0x164cf2,_0x46813f){const _0x2aebea=a55_0x5bf978;await this[_0x2aebea(0x145)](_0x164cf2);const _0xdedb6b={};_0x46813f[_0x2aebea(0x16f)]!==undefined&&(_0xdedb6b['webhookUrl']=_0x46813f['webhookUrl']||null),_0x46813f[_0x2aebea(0x161)]!==undefined&&(_0xdedb6b[_0x2aebea(0x161)]=_0x46813f[_0x2aebea(0x161)]||[]),await database_1[_0x2aebea(0x160)][_0x2aebea(0x142)]['update']({'where':{'shopId':_0x164cf2},'data':_0xdedb6b});}async[a55_0x5bf978(0x137)](_0x1df9ea){const _0x2a0738=a55_0x5bf978,_0x2c2948=_0x2a0738(0x164)+crypto_1[_0x2a0738(0x160)][_0x2a0738(0x16c)](0x20)[_0x2a0738(0x152)](_0x2a0738(0x13d)),_0x4b8a29=_0x2a0738(0x15a)+crypto_1[_0x2a0738(0x160)][_0x2a0738(0x16c)](0x20)[_0x2a0738(0x152)](_0x2a0738(0x13d));await database_1[_0x2a0738(0x160)][_0x2a0738(0x13c)][_0x2a0738(0x139)]({'where':{'id':_0x1df9ea},'data':{'publicKey':_0x2c2948,'secretKey':_0x4b8a29}});}async[a55_0x5bf978(0x14b)](_0x165403,_0x1c16d1){const _0x2c7471=a55_0x5bf978,{passwordConfirmation:_0x4c929b}=_0x1c16d1,_0x494292=await database_1[_0x2c7471(0x160)]['shop'][_0x2c7471(0x151)]({'where':{'id':_0x165403},'select':{'password':!![]}});if(!_0x494292)throw new Error('Shop\x20not\x20found');const _0x39ce7d=await bcryptjs_1[_0x2c7471(0x160)][_0x2c7471(0x158)](_0x4c929b,_0x494292[_0x2c7471(0x14e)]);if(!_0x39ce7d)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x2c7471(0x160)][_0x2c7471(0x13c)]['delete']({'where':{'id':_0x165403}});}async[a55_0x5bf978(0x145)](_0x3ae43b){const _0x9e8ad7=a55_0x5bf978,_0x516963=await database_1[_0x9e8ad7(0x160)]['shopSettings'][_0x9e8ad7(0x151)]({'where':{'shopId':_0x3ae43b}});!_0x516963&&await database_1['default']['shopSettings'][_0x9e8ad7(0x16e)]({'data':{'shopId':_0x3ae43b}});}}exports[a55_0x5bf978(0x159)]=SettingsService;