'use strict';const a52_0x6305bc=a52_0x3232;(function(_0x31ec91,_0xd0267d){const _0x1248bd=a52_0x3232,_0x502207=_0x31ec91();while(!![]){try{const _0x442079=parseInt(_0x1248bd(0x113))/0x1+-parseInt(_0x1248bd(0x12c))/0x2*(-parseInt(_0x1248bd(0x115))/0x3)+parseInt(_0x1248bd(0x10b))/0x4*(parseInt(_0x1248bd(0x116))/0x5)+-parseInt(_0x1248bd(0x11e))/0x6+-parseInt(_0x1248bd(0x12e))/0x7*(parseInt(_0x1248bd(0x11d))/0x8)+parseInt(_0x1248bd(0xf9))/0x9*(parseInt(_0x1248bd(0x134))/0xa)+-parseInt(_0x1248bd(0x127))/0xb*(-parseInt(_0x1248bd(0x100))/0xc);if(_0x442079===_0xd0267d)break;else _0x502207['push'](_0x502207['shift']());}catch(_0x39c150){_0x502207['push'](_0x502207['shift']());}}}(a52_0x3db4,0x9b196));function a52_0x3db4(){const _0x486c10=['shopSettings','10kLsCgV','create','update','parseWebhookEvents','shopUrl','repeat','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','__importDefault','defineProperty','492687JAkTdd','notificationRefund','webhookUrl','default','notificationLogin','telegramChatId','string','36XPuUIH','length','randomBytes','password','notificationPayout','hex','parse','webhookEvents','payment_success','updateTelegramSettings','findUnique','79928pbUJGg','SettingsService','substring','api_error','Password\x20confirmation\x20is\x20incorrect','payout','isArray','ensureSettingsExist','152066dVOIAv','getShopSettings','193233AdXpfN','255CdiPpy','shop','__esModule','Shop\x20not\x20found','refund','notificationPaymentFailed','maskApiKey','29056xVtbUH','791718YUVTgo','pk_','name','sk_','crypto','updateWebhookSettings','login','bcryptjs','compare','1625349ZWSKZd','notificationApiError','toString','botApiKey','deleteAccount','10DXLqHQ','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','2359JHxHFo','settings','notificationPaymentSuccess','telegram','chatId'];a52_0x3db4=function(){return _0x486c10;};return a52_0x3db4();}var __importDefault=this&&this[a52_0x6305bc(0xf7)]||function(_0x288564){const _0x18292a=a52_0x6305bc;return _0x288564&&_0x288564[_0x18292a(0x118)]?_0x288564:{'default':_0x288564};};function a52_0x3232(_0x4a8017,_0x1e7af7){const _0x3db448=a52_0x3db4();return a52_0x3232=function(_0x3232f3,_0x82842e){_0x3232f3=_0x3232f3-0xf1;let _0x50e709=_0x3db448[_0x3232f3];return _0x50e709;},a52_0x3232(_0x4a8017,_0x1e7af7);}Object[a52_0x6305bc(0xf8)](exports,a52_0x6305bc(0x118),{'value':!![]}),exports[a52_0x6305bc(0x10c)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x6305bc(0x125))),crypto_1=__importDefault(require(a52_0x6305bc(0x122))),database_1=__importDefault(require('../config/database'));class SettingsService{[a52_0x6305bc(0x11c)](_0x1013b6){const _0x201c8c=a52_0x6305bc;if(!_0x1013b6)return'';if(_0x1013b6[_0x201c8c(0x101)]<=0x8)return _0x1013b6;const _0x523929=_0x1013b6[_0x201c8c(0x10d)](0x0,0x8),_0x5c54ba='*'[_0x201c8c(0xf5)](Math['max'](0x0,_0x1013b6[_0x201c8c(0x101)]-0x8));return _0x523929+_0x5c54ba;}[a52_0x6305bc(0xf3)](_0x35a937){const _0x437497=a52_0x6305bc;if(!_0x35a937)return[];if(Array[_0x437497(0x111)](_0x35a937))return _0x35a937;if(typeof _0x35a937===_0x437497(0xff))try{const _0x4fde58=JSON[_0x437497(0x106)](_0x35a937);return Array[_0x437497(0x111)](_0x4fde58)?_0x4fde58:[];}catch{return[];}return[];}async[a52_0x6305bc(0x114)](_0x442f9c){const _0x2c664e=a52_0x6305bc,_0x106334=await database_1[_0x2c664e(0xfc)][_0x2c664e(0x117)][_0x2c664e(0x10a)]({'where':{'id':_0x442f9c},'include':{'settings':!![]}});if(!_0x106334)throw new Error(_0x2c664e(0x119));let _0x3730b6=_0x106334[_0x2c664e(0x12f)];return!_0x3730b6&&(_0x3730b6=await database_1[_0x2c664e(0xfc)][_0x2c664e(0x133)][_0x2c664e(0xf1)]({'data':{'shopId':_0x106334['id']}})),{'fullName':_0x106334['name'],'brand':_0x106334[_0x2c664e(0x120)],'merchantUrl':_0x106334[_0x2c664e(0xf4)],'telegramUsername':_0x106334[_0x2c664e(0x131)],'telegramBotApiKey':_0x3730b6['telegramBotApiKey']?this['maskApiKey'](_0x3730b6['telegramBotApiKey']):null,'telegramChatId':_0x3730b6['telegramChatId'],'webhookUrl':_0x3730b6['webhookUrl'],'webhookEvents':this[_0x2c664e(0xf3)](_0x3730b6['webhookEvents']),'notifications':{'payment_success':_0x3730b6[_0x2c664e(0x130)],'payment_failed':_0x3730b6[_0x2c664e(0x11b)],'refund':_0x3730b6[_0x2c664e(0xfa)],'payout':_0x3730b6[_0x2c664e(0x104)],'login':_0x3730b6[_0x2c664e(0xfd)],'api_error':_0x3730b6[_0x2c664e(0x128)]}};}async['changePassword'](_0x2a82aa,_0xfa2b76){const _0x246b64=a52_0x6305bc,{currentPassword:_0x1c3d50,newPassword:_0x4ca422,confirmNewPassword:_0x4fd9fc}=_0xfa2b76;if(_0x4ca422!==_0x4fd9fc)throw new Error(_0x246b64(0x12d));if(_0x4ca422[_0x246b64(0x101)]<0x6)throw new Error(_0x246b64(0xf6));const _0xc881de=await database_1[_0x246b64(0xfc)][_0x246b64(0x117)][_0x246b64(0x10a)]({'where':{'id':_0x2a82aa},'select':{'password':!![]}});if(!_0xc881de)throw new Error(_0x246b64(0x119));const _0x24cfd1=await bcryptjs_1['default'][_0x246b64(0x126)](_0x1c3d50,_0xc881de[_0x246b64(0x103)]);if(!_0x24cfd1)throw new Error('Current\x20password\x20is\x20incorrect');const _0x50b41b=await bcryptjs_1['default']['hash'](_0x4ca422,0xc);await database_1[_0x246b64(0xfc)][_0x246b64(0x117)][_0x246b64(0xf2)]({'where':{'id':_0x2a82aa},'data':{'password':_0x50b41b}});}async['updateNotifications'](_0x4a69ea,_0x30286f){const _0xec0f3a=a52_0x6305bc;await this[_0xec0f3a(0x112)](_0x4a69ea);const _0x492de1={};_0x30286f['payment_success']!==undefined&&(_0x492de1['notificationPaymentSuccess']=_0x30286f[_0xec0f3a(0x108)]),_0x30286f['payment_failed']!==undefined&&(_0x492de1[_0xec0f3a(0x11b)]=_0x30286f['payment_failed']),_0x30286f[_0xec0f3a(0x11a)]!==undefined&&(_0x492de1[_0xec0f3a(0xfa)]=_0x30286f[_0xec0f3a(0x11a)]),_0x30286f[_0xec0f3a(0x110)]!==undefined&&(_0x492de1[_0xec0f3a(0x104)]=_0x30286f[_0xec0f3a(0x110)]),_0x30286f[_0xec0f3a(0x124)]!==undefined&&(_0x492de1['notificationLogin']=_0x30286f[_0xec0f3a(0x124)]),_0x30286f[_0xec0f3a(0x10e)]!==undefined&&(_0x492de1[_0xec0f3a(0x128)]=_0x30286f[_0xec0f3a(0x10e)]),await database_1[_0xec0f3a(0xfc)][_0xec0f3a(0x133)][_0xec0f3a(0xf2)]({'where':{'shopId':_0x4a69ea},'data':_0x492de1});}async[a52_0x6305bc(0x109)](_0x28f775,_0x5a1a37){const _0x5a09f7=a52_0x6305bc;await this[_0x5a09f7(0x112)](_0x28f775);const _0x2f8d75={};_0x5a1a37[_0x5a09f7(0x12a)]!==undefined&&(_0x2f8d75['telegramBotApiKey']=_0x5a1a37[_0x5a09f7(0x12a)]||null),_0x5a1a37[_0x5a09f7(0x132)]!==undefined&&(_0x2f8d75[_0x5a09f7(0xfe)]=_0x5a1a37[_0x5a09f7(0x132)]||null),await database_1[_0x5a09f7(0xfc)][_0x5a09f7(0x133)]['update']({'where':{'shopId':_0x28f775},'data':_0x2f8d75});}async[a52_0x6305bc(0x123)](_0x4dfbbf,_0xf59803){const _0x47afec=a52_0x6305bc;await this['ensureSettingsExist'](_0x4dfbbf);const _0x236f00={};_0xf59803['webhookUrl']!==undefined&&(_0x236f00[_0x47afec(0xfb)]=_0xf59803[_0x47afec(0xfb)]||null),_0xf59803[_0x47afec(0x107)]!==undefined&&(_0x236f00[_0x47afec(0x107)]=_0xf59803['webhookEvents']||[]),await database_1[_0x47afec(0xfc)][_0x47afec(0x133)][_0x47afec(0xf2)]({'where':{'shopId':_0x4dfbbf},'data':_0x236f00});}async['revokeAllApiKeys'](_0x15e7d7){const _0x78776d=a52_0x6305bc,_0x30ba8d=_0x78776d(0x11f)+crypto_1[_0x78776d(0xfc)][_0x78776d(0x102)](0x20)[_0x78776d(0x129)](_0x78776d(0x105)),_0x1e1f47=_0x78776d(0x121)+crypto_1[_0x78776d(0xfc)][_0x78776d(0x102)](0x20)[_0x78776d(0x129)](_0x78776d(0x105));await database_1[_0x78776d(0xfc)][_0x78776d(0x117)][_0x78776d(0xf2)]({'where':{'id':_0x15e7d7},'data':{'publicKey':_0x30ba8d,'secretKey':_0x1e1f47}});}async[a52_0x6305bc(0x12b)](_0x476e8f,_0x375177){const _0x1fcee0=a52_0x6305bc,{passwordConfirmation:_0x1e2cc7}=_0x375177,_0x31fe21=await database_1[_0x1fcee0(0xfc)]['shop']['findUnique']({'where':{'id':_0x476e8f},'select':{'password':!![]}});if(!_0x31fe21)throw new Error(_0x1fcee0(0x119));const _0x5a97e2=await bcryptjs_1[_0x1fcee0(0xfc)][_0x1fcee0(0x126)](_0x1e2cc7,_0x31fe21[_0x1fcee0(0x103)]);if(!_0x5a97e2)throw new Error(_0x1fcee0(0x10f));await database_1[_0x1fcee0(0xfc)][_0x1fcee0(0x117)]['delete']({'where':{'id':_0x476e8f}});}async['ensureSettingsExist'](_0x5352b6){const _0x126c34=a52_0x6305bc,_0x3ecb25=await database_1[_0x126c34(0xfc)][_0x126c34(0x133)]['findUnique']({'where':{'shopId':_0x5352b6}});!_0x3ecb25&&await database_1['default'][_0x126c34(0x133)][_0x126c34(0xf1)]({'data':{'shopId':_0x5352b6}});}}exports[a52_0x6305bc(0x10c)]=SettingsService;