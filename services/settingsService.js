'use strict';const a53_0x2bda81=a53_0x5c55;(function(_0x2bcc2e,_0xf6d68f){const _0x2c03a6=a53_0x5c55,_0x4f76c2=_0x2bcc2e();while(!![]){try{const _0x19fdb4=parseInt(_0x2c03a6(0x165))/0x1*(-parseInt(_0x2c03a6(0x149))/0x2)+-parseInt(_0x2c03a6(0x17d))/0x3+parseInt(_0x2c03a6(0x164))/0x4+parseInt(_0x2c03a6(0x143))/0x5*(parseInt(_0x2c03a6(0x174))/0x6)+-parseInt(_0x2c03a6(0x14b))/0x7*(parseInt(_0x2c03a6(0x161))/0x8)+-parseInt(_0x2c03a6(0x15a))/0x9+parseInt(_0x2c03a6(0x17e))/0xa*(parseInt(_0x2c03a6(0x14d))/0xb);if(_0x19fdb4===_0xf6d68f)break;else _0x4f76c2['push'](_0x4f76c2['shift']());}catch(_0x497e8d){_0x4f76c2['push'](_0x4f76c2['shift']());}}}(a53_0x4b0d,0x71282));function a53_0x5c55(_0x2095b0,_0x33b30f){const _0x4b0d5b=a53_0x4b0d();return a53_0x5c55=function(_0x5c5591,_0x7cb5a3){_0x5c5591=_0x5c5591-0x143;let _0x28b3c5=_0x4b0d5b[_0x5c5591];return _0x28b3c5;},a53_0x5c55(_0x2095b0,_0x33b30f);}var __importDefault=this&&this['__importDefault']||function(_0x149697){return _0x149697&&_0x149697['__esModule']?_0x149697:{'default':_0x149697};};Object[a53_0x2bda81(0x172)](exports,'__esModule',{'value':!![]}),exports[a53_0x2bda81(0x173)]=void 0x0;const bcryptjs_1=__importDefault(require(a53_0x2bda81(0x16f))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a53_0x2bda81(0x17f)));function a53_0x4b0d(){const _0x4e946c=['ensureSettingsExist','payout','shopSettings','134841sLLYlC','184150NPsMBe','../config/database','sk_','changePassword','shopUrl','update','hash','5vOLzpT','telegram','notificationPayout','Shop\x20not\x20found','create','webhookEvents','171398phDllk','substring','22806OoSNUF','updateWebhookSettings','704hMKBhg','refund','randomBytes','settings','notificationRefund','payment_failed','string','notificationPaymentSuccess','compare','findUnique','name','login','default','4187196xyOJaU','toString','updateNotifications','payment_success','api_error','maskApiKey','notificationPaymentFailed','1248XCtajF','notificationLogin','telegramBotApiKey','3383108nOxfpt','7UoQGSr','isArray','revokeAllApiKeys','max','parseWebhookEvents','notificationApiError','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','webhookUrl','hex','deleteAccount','bcryptjs','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','length','defineProperty','SettingsService','344910HNUtUZ','parse','shop','pk_','chatId','telegramChatId'];a53_0x4b0d=function(){return _0x4e946c;};return a53_0x4b0d();}class SettingsService{[a53_0x2bda81(0x15f)](_0x740f52){const _0x45f382=a53_0x2bda81;if(!_0x740f52)return'';if(_0x740f52[_0x45f382(0x171)]<=0x8)return _0x740f52;const _0x49108e=_0x740f52[_0x45f382(0x14a)](0x0,0x8),_0x56c6f2='*'['repeat'](Math[_0x45f382(0x168)](0x0,_0x740f52[_0x45f382(0x171)]-0x8));return _0x49108e+_0x56c6f2;}[a53_0x2bda81(0x169)](_0x26f9e1){const _0x4c0c21=a53_0x2bda81;if(!_0x26f9e1)return[];if(Array[_0x4c0c21(0x166)](_0x26f9e1))return _0x26f9e1;if(typeof _0x26f9e1===_0x4c0c21(0x153))try{const _0x5f206e=JSON[_0x4c0c21(0x175)](_0x26f9e1);return Array[_0x4c0c21(0x166)](_0x5f206e)?_0x5f206e:[];}catch{return[];}return[];}async['getShopSettings'](_0x3d56f3){const _0x335c2d=a53_0x2bda81,_0x2f47c7=await database_1[_0x335c2d(0x159)]['shop'][_0x335c2d(0x156)]({'where':{'id':_0x3d56f3},'include':{'settings':!![]}});if(!_0x2f47c7)throw new Error(_0x335c2d(0x146));let _0x4d459b=_0x2f47c7[_0x335c2d(0x150)];return!_0x4d459b&&(_0x4d459b=await database_1['default']['shopSettings'][_0x335c2d(0x147)]({'data':{'shopId':_0x2f47c7['id']}})),{'fullName':_0x2f47c7['name'],'brand':_0x2f47c7[_0x335c2d(0x157)],'merchantUrl':_0x2f47c7[_0x335c2d(0x182)],'telegramUsername':_0x2f47c7[_0x335c2d(0x144)],'telegramBotApiKey':_0x4d459b[_0x335c2d(0x163)]?this[_0x335c2d(0x15f)](_0x4d459b[_0x335c2d(0x163)]):null,'telegramChatId':_0x4d459b['telegramChatId'],'webhookUrl':_0x4d459b[_0x335c2d(0x16c)],'webhookEvents':this[_0x335c2d(0x169)](_0x4d459b['webhookEvents']),'notifications':{'payment_success':_0x4d459b[_0x335c2d(0x154)],'payment_failed':_0x4d459b[_0x335c2d(0x160)],'refund':_0x4d459b[_0x335c2d(0x151)],'payout':_0x4d459b[_0x335c2d(0x145)],'login':_0x4d459b[_0x335c2d(0x162)],'api_error':_0x4d459b[_0x335c2d(0x16a)]}};}async[a53_0x2bda81(0x181)](_0x51a0c6,_0xf00450){const _0x2590f5=a53_0x2bda81,{currentPassword:_0x43f2df,newPassword:_0x15784,confirmNewPassword:_0x534dee}=_0xf00450;if(_0x15784!==_0x534dee)throw new Error(_0x2590f5(0x170));if(_0x15784[_0x2590f5(0x171)]<0x6)throw new Error(_0x2590f5(0x16b));const _0x21d5fc=await database_1['default']['shop']['findUnique']({'where':{'id':_0x51a0c6},'select':{'password':!![]}});if(!_0x21d5fc)throw new Error(_0x2590f5(0x146));const _0xe0c2d9=await bcryptjs_1[_0x2590f5(0x159)][_0x2590f5(0x155)](_0x43f2df,_0x21d5fc['password']);if(!_0xe0c2d9)throw new Error('Current\x20password\x20is\x20incorrect');const _0x22b841=await bcryptjs_1[_0x2590f5(0x159)][_0x2590f5(0x184)](_0x15784,0xc);await database_1[_0x2590f5(0x159)][_0x2590f5(0x176)]['update']({'where':{'id':_0x51a0c6},'data':{'password':_0x22b841}});}async[a53_0x2bda81(0x15c)](_0x3d7463,_0x17e115){const _0x163450=a53_0x2bda81;await this[_0x163450(0x17a)](_0x3d7463);const _0x1d1159={};_0x17e115[_0x163450(0x15d)]!==undefined&&(_0x1d1159[_0x163450(0x154)]=_0x17e115[_0x163450(0x15d)]),_0x17e115['payment_failed']!==undefined&&(_0x1d1159[_0x163450(0x160)]=_0x17e115[_0x163450(0x152)]),_0x17e115['refund']!==undefined&&(_0x1d1159['notificationRefund']=_0x17e115[_0x163450(0x14e)]),_0x17e115[_0x163450(0x17b)]!==undefined&&(_0x1d1159[_0x163450(0x145)]=_0x17e115[_0x163450(0x17b)]),_0x17e115[_0x163450(0x158)]!==undefined&&(_0x1d1159[_0x163450(0x162)]=_0x17e115[_0x163450(0x158)]),_0x17e115[_0x163450(0x15e)]!==undefined&&(_0x1d1159['notificationApiError']=_0x17e115[_0x163450(0x15e)]),await database_1[_0x163450(0x159)][_0x163450(0x17c)][_0x163450(0x183)]({'where':{'shopId':_0x3d7463},'data':_0x1d1159});}async['updateTelegramSettings'](_0x3d55d1,_0x3fe162){const _0x123447=a53_0x2bda81;await this['ensureSettingsExist'](_0x3d55d1);const _0x4a3745={};_0x3fe162['botApiKey']!==undefined&&(_0x4a3745[_0x123447(0x163)]=_0x3fe162['botApiKey']||null),_0x3fe162[_0x123447(0x178)]!==undefined&&(_0x4a3745[_0x123447(0x179)]=_0x3fe162['chatId']||null),await database_1[_0x123447(0x159)][_0x123447(0x17c)][_0x123447(0x183)]({'where':{'shopId':_0x3d55d1},'data':_0x4a3745});}async[a53_0x2bda81(0x14c)](_0x1121a2,_0x4c5ea9){const _0xe519cd=a53_0x2bda81;await this['ensureSettingsExist'](_0x1121a2);const _0xeb49b1={};_0x4c5ea9[_0xe519cd(0x16c)]!==undefined&&(_0xeb49b1[_0xe519cd(0x16c)]=_0x4c5ea9[_0xe519cd(0x16c)]||null),_0x4c5ea9['webhookEvents']!==undefined&&(_0xeb49b1[_0xe519cd(0x148)]=_0x4c5ea9['webhookEvents']||[]),await database_1[_0xe519cd(0x159)][_0xe519cd(0x17c)]['update']({'where':{'shopId':_0x1121a2},'data':_0xeb49b1});}async[a53_0x2bda81(0x167)](_0x3536c6){const _0x2d5890=a53_0x2bda81,_0x511b24=_0x2d5890(0x177)+crypto_1[_0x2d5890(0x159)][_0x2d5890(0x14f)](0x20)['toString'](_0x2d5890(0x16d)),_0x1be5b9=_0x2d5890(0x180)+crypto_1['default'][_0x2d5890(0x14f)](0x20)[_0x2d5890(0x15b)]('hex');await database_1[_0x2d5890(0x159)][_0x2d5890(0x176)]['update']({'where':{'id':_0x3536c6},'data':{'publicKey':_0x511b24,'secretKey':_0x1be5b9}});}async[a53_0x2bda81(0x16e)](_0x11f155,_0x538e43){const _0x11bb95=a53_0x2bda81,{passwordConfirmation:_0x8ba11}=_0x538e43,_0x18117b=await database_1[_0x11bb95(0x159)][_0x11bb95(0x176)][_0x11bb95(0x156)]({'where':{'id':_0x11f155},'select':{'password':!![]}});if(!_0x18117b)throw new Error(_0x11bb95(0x146));const _0x1ba39b=await bcryptjs_1[_0x11bb95(0x159)][_0x11bb95(0x155)](_0x8ba11,_0x18117b['password']);if(!_0x1ba39b)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x11bb95(0x159)][_0x11bb95(0x176)]['delete']({'where':{'id':_0x11f155}});}async['ensureSettingsExist'](_0x359ec0){const _0x529950=a53_0x2bda81,_0x29c4a5=await database_1[_0x529950(0x159)][_0x529950(0x17c)][_0x529950(0x156)]({'where':{'shopId':_0x359ec0}});!_0x29c4a5&&await database_1[_0x529950(0x159)]['shopSettings'][_0x529950(0x147)]({'data':{'shopId':_0x359ec0}});}}exports[a53_0x2bda81(0x173)]=SettingsService;