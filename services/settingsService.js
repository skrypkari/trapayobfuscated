'use strict';const a50_0x4e5fad=a50_0x1d13;(function(_0x4a61f1,_0x3f2609){const _0x47f9f9=a50_0x1d13,_0x657fbd=_0x4a61f1();while(!![]){try{const _0x1be8a0=parseInt(_0x47f9f9(0x166))/0x1*(parseInt(_0x47f9f9(0x154))/0x2)+-parseInt(_0x47f9f9(0x16a))/0x3*(-parseInt(_0x47f9f9(0x17a))/0x4)+-parseInt(_0x47f9f9(0x14b))/0x5*(parseInt(_0x47f9f9(0x15f))/0x6)+parseInt(_0x47f9f9(0x151))/0x7+-parseInt(_0x47f9f9(0x153))/0x8+parseInt(_0x47f9f9(0x169))/0x9*(-parseInt(_0x47f9f9(0x160))/0xa)+-parseInt(_0x47f9f9(0x143))/0xb;if(_0x1be8a0===_0x3f2609)break;else _0x657fbd['push'](_0x657fbd['shift']());}catch(_0x1acc18){_0x657fbd['push'](_0x657fbd['shift']());}}}(a50_0x4665,0x977b6));function a50_0x1d13(_0x21380b,_0x3f394c){const _0x4665d8=a50_0x4665();return a50_0x1d13=function(_0x1d131a,_0x45d958){_0x1d131a=_0x1d131a-0x143;let _0x51be41=_0x4665d8[_0x1d131a];return _0x51be41;},a50_0x1d13(_0x21380b,_0x3f394c);}function a50_0x4665(){const _0x2f08ce=['repeat','shopUrl','updateWebhookSettings','password','sk_','deleteAccount','hex','webhookEvents','bcryptjs','updateTelegramSettings','4601444dvSFgy','Password\x20confirmation\x20is\x20incorrect','changePassword','login','api_error','compare','update','parseWebhookEvents','crypto','max','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','telegramBotApiKey','notificationApiError','10955758CpxufX','payment_failed','payout','notificationLogin','shop','payment_success','length','notificationRefund','308030mwNokX','notificationPaymentFailed','isArray','botApiKey','defineProperty','name','8442161CnTvaF','telegramChatId','1627592cpyYDQ','2000CKVyCj','maskApiKey','telegram','parse','settings','randomBytes','string','create','__importDefault','ensureSettingsExist','default','60IZFiqz','670cQvljx','SettingsService','webhookUrl','__esModule','notificationPayout','shopSettings','755Cxdeqc','chatId','Shop\x20not\x20found','90729kebueX','3zhXYmH','notificationPaymentSuccess','updateNotifications','toString','pk_','findUnique'];a50_0x4665=function(){return _0x2f08ce;};return a50_0x4665();}var __importDefault=this&&this[a50_0x4e5fad(0x15c)]||function(_0x1ffd6f){const _0x589a77=a50_0x4e5fad;return _0x1ffd6f&&_0x1ffd6f[_0x589a77(0x163)]?_0x1ffd6f:{'default':_0x1ffd6f};};Object[a50_0x4e5fad(0x14f)](exports,'__esModule',{'value':!![]}),exports[a50_0x4e5fad(0x161)]=void 0x0;const bcryptjs_1=__importDefault(require(a50_0x4e5fad(0x178))),crypto_1=__importDefault(require(a50_0x4e5fad(0x182))),database_1=__importDefault(require('../config/database'));class SettingsService{['maskApiKey'](_0x286aec){const _0x4a76f9=a50_0x4e5fad;if(!_0x286aec)return'';if(_0x286aec[_0x4a76f9(0x149)]<=0x8)return _0x286aec;const _0x2e8c04=_0x286aec['substring'](0x0,0x8),_0xbd7025='*'[_0x4a76f9(0x170)](Math[_0x4a76f9(0x183)](0x0,_0x286aec[_0x4a76f9(0x149)]-0x8));return _0x2e8c04+_0xbd7025;}[a50_0x4e5fad(0x181)](_0x2d9982){const _0x4fa637=a50_0x4e5fad;if(!_0x2d9982)return[];if(Array[_0x4fa637(0x14d)](_0x2d9982))return _0x2d9982;if(typeof _0x2d9982===_0x4fa637(0x15a))try{const _0x54fd5c=JSON[_0x4fa637(0x157)](_0x2d9982);return Array[_0x4fa637(0x14d)](_0x54fd5c)?_0x54fd5c:[];}catch{return[];}return[];}async['getShopSettings'](_0x56e666){const _0x49c710=a50_0x4e5fad,_0x1ac529=await database_1[_0x49c710(0x15e)][_0x49c710(0x147)]['findUnique']({'where':{'id':_0x56e666},'include':{'settings':!![]}});if(!_0x1ac529)throw new Error(_0x49c710(0x168));let _0x1e27db=_0x1ac529[_0x49c710(0x158)];return!_0x1e27db&&(_0x1e27db=await database_1[_0x49c710(0x15e)][_0x49c710(0x165)][_0x49c710(0x15b)]({'data':{'shopId':_0x1ac529['id']}})),{'fullName':_0x1ac529[_0x49c710(0x150)],'brand':_0x1ac529[_0x49c710(0x150)],'merchantUrl':_0x1ac529[_0x49c710(0x171)],'telegramUsername':_0x1ac529[_0x49c710(0x156)],'telegramBotApiKey':_0x1e27db[_0x49c710(0x185)]?this[_0x49c710(0x155)](_0x1e27db[_0x49c710(0x185)]):null,'telegramChatId':_0x1e27db[_0x49c710(0x152)],'webhookUrl':_0x1e27db[_0x49c710(0x162)],'webhookEvents':this[_0x49c710(0x181)](_0x1e27db['webhookEvents']),'notifications':{'payment_success':_0x1e27db[_0x49c710(0x16b)],'payment_failed':_0x1e27db[_0x49c710(0x14c)],'refund':_0x1e27db[_0x49c710(0x14a)],'payout':_0x1e27db['notificationPayout'],'login':_0x1e27db[_0x49c710(0x146)],'api_error':_0x1e27db[_0x49c710(0x186)]}};}async[a50_0x4e5fad(0x17c)](_0x29da0f,_0x509488){const _0x566901=a50_0x4e5fad,{currentPassword:_0x13619c,newPassword:_0x3c97c5,confirmNewPassword:_0x51f2e6}=_0x509488;if(_0x3c97c5!==_0x51f2e6)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x3c97c5[_0x566901(0x149)]<0x6)throw new Error(_0x566901(0x184));const _0x2056e3=await database_1[_0x566901(0x15e)][_0x566901(0x147)][_0x566901(0x16f)]({'where':{'id':_0x29da0f},'select':{'password':!![]}});if(!_0x2056e3)throw new Error(_0x566901(0x168));const _0x43beaa=await bcryptjs_1[_0x566901(0x15e)]['compare'](_0x13619c,_0x2056e3[_0x566901(0x173)]);if(!_0x43beaa)throw new Error('Current\x20password\x20is\x20incorrect');const _0x519885=await bcryptjs_1[_0x566901(0x15e)]['hash'](_0x3c97c5,0xc);await database_1[_0x566901(0x15e)][_0x566901(0x147)][_0x566901(0x180)]({'where':{'id':_0x29da0f},'data':{'password':_0x519885}});}async[a50_0x4e5fad(0x16c)](_0x5b456a,_0x21fd81){const _0x2fc71b=a50_0x4e5fad;await this['ensureSettingsExist'](_0x5b456a);const _0x58e56d={};_0x21fd81[_0x2fc71b(0x148)]!==undefined&&(_0x58e56d['notificationPaymentSuccess']=_0x21fd81[_0x2fc71b(0x148)]),_0x21fd81[_0x2fc71b(0x144)]!==undefined&&(_0x58e56d[_0x2fc71b(0x14c)]=_0x21fd81['payment_failed']),_0x21fd81['refund']!==undefined&&(_0x58e56d[_0x2fc71b(0x14a)]=_0x21fd81['refund']),_0x21fd81[_0x2fc71b(0x145)]!==undefined&&(_0x58e56d[_0x2fc71b(0x164)]=_0x21fd81[_0x2fc71b(0x145)]),_0x21fd81['login']!==undefined&&(_0x58e56d[_0x2fc71b(0x146)]=_0x21fd81[_0x2fc71b(0x17d)]),_0x21fd81[_0x2fc71b(0x17e)]!==undefined&&(_0x58e56d[_0x2fc71b(0x186)]=_0x21fd81[_0x2fc71b(0x17e)]),await database_1[_0x2fc71b(0x15e)]['shopSettings'][_0x2fc71b(0x180)]({'where':{'shopId':_0x5b456a},'data':_0x58e56d});}async[a50_0x4e5fad(0x179)](_0x4feff5,_0x2ef199){const _0x2bf176=a50_0x4e5fad;await this[_0x2bf176(0x15d)](_0x4feff5);const _0x35ba2a={};_0x2ef199[_0x2bf176(0x14e)]!==undefined&&(_0x35ba2a[_0x2bf176(0x185)]=_0x2ef199[_0x2bf176(0x14e)]||null),_0x2ef199['chatId']!==undefined&&(_0x35ba2a[_0x2bf176(0x152)]=_0x2ef199[_0x2bf176(0x167)]||null),await database_1[_0x2bf176(0x15e)]['shopSettings'][_0x2bf176(0x180)]({'where':{'shopId':_0x4feff5},'data':_0x35ba2a});}async[a50_0x4e5fad(0x172)](_0x47008f,_0x5aaf97){const _0x14f45b=a50_0x4e5fad;await this[_0x14f45b(0x15d)](_0x47008f);const _0x25a945={};_0x5aaf97[_0x14f45b(0x162)]!==undefined&&(_0x25a945['webhookUrl']=_0x5aaf97[_0x14f45b(0x162)]||null),_0x5aaf97[_0x14f45b(0x177)]!==undefined&&(_0x25a945[_0x14f45b(0x177)]=_0x5aaf97[_0x14f45b(0x177)]||[]),await database_1[_0x14f45b(0x15e)]['shopSettings']['update']({'where':{'shopId':_0x47008f},'data':_0x25a945});}async['revokeAllApiKeys'](_0x5eb2d1){const _0x55a9fd=a50_0x4e5fad,_0xfc894c=_0x55a9fd(0x16e)+crypto_1[_0x55a9fd(0x15e)][_0x55a9fd(0x159)](0x20)[_0x55a9fd(0x16d)](_0x55a9fd(0x176)),_0x306afe=_0x55a9fd(0x174)+crypto_1[_0x55a9fd(0x15e)]['randomBytes'](0x20)[_0x55a9fd(0x16d)](_0x55a9fd(0x176));await database_1[_0x55a9fd(0x15e)][_0x55a9fd(0x147)][_0x55a9fd(0x180)]({'where':{'id':_0x5eb2d1},'data':{'publicKey':_0xfc894c,'secretKey':_0x306afe}});}async[a50_0x4e5fad(0x175)](_0x142661,_0x26733b){const _0x2929e0=a50_0x4e5fad,{passwordConfirmation:_0x4602d5}=_0x26733b,_0x55e3d6=await database_1[_0x2929e0(0x15e)]['shop'][_0x2929e0(0x16f)]({'where':{'id':_0x142661},'select':{'password':!![]}});if(!_0x55e3d6)throw new Error(_0x2929e0(0x168));const _0x37daee=await bcryptjs_1['default'][_0x2929e0(0x17f)](_0x4602d5,_0x55e3d6[_0x2929e0(0x173)]);if(!_0x37daee)throw new Error(_0x2929e0(0x17b));await database_1[_0x2929e0(0x15e)]['shop']['delete']({'where':{'id':_0x142661}});}async[a50_0x4e5fad(0x15d)](_0x3a2a55){const _0x2bac57=a50_0x4e5fad,_0x2f1139=await database_1[_0x2bac57(0x15e)][_0x2bac57(0x165)]['findUnique']({'where':{'shopId':_0x3a2a55}});!_0x2f1139&&await database_1['default']['shopSettings'][_0x2bac57(0x15b)]({'data':{'shopId':_0x3a2a55}});}}exports[a50_0x4e5fad(0x161)]=SettingsService;