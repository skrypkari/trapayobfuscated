'use strict';const a47_0x2a9390=a47_0x817f;(function(_0x54e4ff,_0x5511fc){const _0xfeda0=a47_0x817f,_0xf9ba07=_0x54e4ff();while(!![]){try{const _0x1ab724=-parseInt(_0xfeda0(0xc3))/0x1+-parseInt(_0xfeda0(0xdf))/0x2+parseInt(_0xfeda0(0xe7))/0x3+-parseInt(_0xfeda0(0xec))/0x4+parseInt(_0xfeda0(0xc4))/0x5*(-parseInt(_0xfeda0(0xd6))/0x6)+parseInt(_0xfeda0(0xdb))/0x7+-parseInt(_0xfeda0(0xd7))/0x8*(-parseInt(_0xfeda0(0xdc))/0x9);if(_0x1ab724===_0x5511fc)break;else _0xf9ba07['push'](_0xf9ba07['shift']());}catch(_0x5b223b){_0xf9ba07['push'](_0xf9ba07['shift']());}}}(a47_0x2052,0xade44));function a47_0x2052(){const _0xe8dc04=['defineProperty','refund','706302DZhsko','264ZqNEcw','payout','chatId','bcryptjs','1189391itDzJo','483147YnpVBU','deleteAccount','ensureSettingsExist','988888NQJlPt','password','hex','notificationRefund','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','notificationPayout','compare','updateWebhookSettings','2289774mxhdSD','__importDefault','notificationPaymentSuccess','botApiKey','name','630756hmZwPy','updateNotifications','api_error','shopSettings','notificationLogin','telegramBotApiKey','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','default','repeat','Current\x20password\x20is\x20incorrect','hash','string','update','updateTelegramSettings','webhookUrl','isArray','shopUrl','length','payment_failed','telegramChatId','pk_','toString','payment_success','create','shop','Password\x20confirmation\x20is\x20incorrect','1222600eKwbto','5ifbHEj','__esModule','revokeAllApiKeys','SettingsService','randomBytes','login','notificationPaymentFailed','max','getShopSettings','findUnique','maskApiKey','parseWebhookEvents','sk_','Shop\x20not\x20found','notificationApiError','webhookEvents'];a47_0x2052=function(){return _0xe8dc04;};return a47_0x2052();}var __importDefault=this&&this[a47_0x2a9390(0xe8)]||function(_0x2ab923){return _0x2ab923&&_0x2ab923['__esModule']?_0x2ab923:{'default':_0x2ab923};};Object[a47_0x2a9390(0xd4)](exports,a47_0x2a9390(0xc5),{'value':!![]}),exports[a47_0x2a9390(0xc7)]=void 0x0;function a47_0x817f(_0x1f4994,_0x51ed9e){const _0x2052d9=a47_0x2052();return a47_0x817f=function(_0x817fff,_0x113936){_0x817fff=_0x817fff-0xac;let _0x45652a=_0x2052d9[_0x817fff];return _0x45652a;},a47_0x817f(_0x1f4994,_0x51ed9e);}const bcryptjs_1=__importDefault(require(a47_0x2a9390(0xda))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));class SettingsService{[a47_0x2a9390(0xce)](_0xe61237){const _0x497bf5=a47_0x2a9390;if(!_0xe61237)return'';if(_0xe61237[_0x497bf5(0xba)]<=0x8)return _0xe61237;const _0x4432d8=_0xe61237['substring'](0x0,0x8),_0x4e05ef='*'[_0x497bf5(0xb1)](Math[_0x497bf5(0xcb)](0x0,_0xe61237[_0x497bf5(0xba)]-0x8));return _0x4432d8+_0x4e05ef;}[a47_0x2a9390(0xcf)](_0x40c8e4){const _0x436644=a47_0x2a9390;if(!_0x40c8e4)return[];if(Array[_0x436644(0xb8)](_0x40c8e4))return _0x40c8e4;if(typeof _0x40c8e4===_0x436644(0xb4))try{const _0x40f74b=JSON['parse'](_0x40c8e4);return Array[_0x436644(0xb8)](_0x40f74b)?_0x40f74b:[];}catch{return[];}return[];}async[a47_0x2a9390(0xcc)](_0x2af3a1){const _0x2db2fb=a47_0x2a9390,_0x585bef=await database_1[_0x2db2fb(0xb0)][_0x2db2fb(0xc1)][_0x2db2fb(0xcd)]({'where':{'id':_0x2af3a1},'include':{'settings':!![]}});if(!_0x585bef)throw new Error(_0x2db2fb(0xd1));let _0x3cf153=_0x585bef['settings'];return!_0x3cf153&&(_0x3cf153=await database_1[_0x2db2fb(0xb0)][_0x2db2fb(0xac)][_0x2db2fb(0xc0)]({'data':{'shopId':_0x585bef['id']}})),{'fullName':_0x585bef[_0x2db2fb(0xeb)],'brand':_0x585bef[_0x2db2fb(0xeb)],'merchantUrl':_0x585bef[_0x2db2fb(0xb9)],'telegramUsername':_0x585bef['telegram'],'telegramBotApiKey':_0x3cf153['telegramBotApiKey']?this[_0x2db2fb(0xce)](_0x3cf153['telegramBotApiKey']):null,'telegramChatId':_0x3cf153[_0x2db2fb(0xbc)],'webhookUrl':_0x3cf153[_0x2db2fb(0xb7)],'webhookEvents':this[_0x2db2fb(0xcf)](_0x3cf153[_0x2db2fb(0xd3)]),'notifications':{'payment_success':_0x3cf153[_0x2db2fb(0xe9)],'payment_failed':_0x3cf153[_0x2db2fb(0xca)],'refund':_0x3cf153[_0x2db2fb(0xe2)],'payout':_0x3cf153[_0x2db2fb(0xe4)],'login':_0x3cf153[_0x2db2fb(0xad)],'api_error':_0x3cf153[_0x2db2fb(0xd2)]}};}async['changePassword'](_0x3e13bc,_0x3d392e){const _0x2a1f51=a47_0x2a9390,{currentPassword:_0x439307,newPassword:_0x3513e5,confirmNewPassword:_0x31b909}=_0x3d392e;if(_0x3513e5!==_0x31b909)throw new Error(_0x2a1f51(0xe3));if(_0x3513e5['length']<0x6)throw new Error(_0x2a1f51(0xaf));const _0x369c94=await database_1['default'][_0x2a1f51(0xc1)][_0x2a1f51(0xcd)]({'where':{'id':_0x3e13bc},'select':{'password':!![]}});if(!_0x369c94)throw new Error(_0x2a1f51(0xd1));const _0x4b6c03=await bcryptjs_1[_0x2a1f51(0xb0)][_0x2a1f51(0xe5)](_0x439307,_0x369c94[_0x2a1f51(0xe0)]);if(!_0x4b6c03)throw new Error(_0x2a1f51(0xb2));const _0x49e64c=await bcryptjs_1[_0x2a1f51(0xb0)][_0x2a1f51(0xb3)](_0x3513e5,0xc);await database_1[_0x2a1f51(0xb0)]['shop'][_0x2a1f51(0xb5)]({'where':{'id':_0x3e13bc},'data':{'password':_0x49e64c}});}async[a47_0x2a9390(0xed)](_0x5ab3d4,_0x1ef766){const _0x45043f=a47_0x2a9390;await this[_0x45043f(0xde)](_0x5ab3d4);const _0x360e27={};_0x1ef766[_0x45043f(0xbf)]!==undefined&&(_0x360e27[_0x45043f(0xe9)]=_0x1ef766[_0x45043f(0xbf)]),_0x1ef766[_0x45043f(0xbb)]!==undefined&&(_0x360e27['notificationPaymentFailed']=_0x1ef766[_0x45043f(0xbb)]),_0x1ef766[_0x45043f(0xd5)]!==undefined&&(_0x360e27['notificationRefund']=_0x1ef766[_0x45043f(0xd5)]),_0x1ef766[_0x45043f(0xd8)]!==undefined&&(_0x360e27[_0x45043f(0xe4)]=_0x1ef766['payout']),_0x1ef766[_0x45043f(0xc9)]!==undefined&&(_0x360e27[_0x45043f(0xad)]=_0x1ef766['login']),_0x1ef766['api_error']!==undefined&&(_0x360e27[_0x45043f(0xd2)]=_0x1ef766[_0x45043f(0xee)]),await database_1['default']['shopSettings'][_0x45043f(0xb5)]({'where':{'shopId':_0x5ab3d4},'data':_0x360e27});}async[a47_0x2a9390(0xb6)](_0x3d21c7,_0xe2f6eb){const _0x2fc990=a47_0x2a9390;await this['ensureSettingsExist'](_0x3d21c7);const _0x52e9f5={};_0xe2f6eb[_0x2fc990(0xea)]!==undefined&&(_0x52e9f5[_0x2fc990(0xae)]=_0xe2f6eb[_0x2fc990(0xea)]||null),_0xe2f6eb[_0x2fc990(0xd9)]!==undefined&&(_0x52e9f5[_0x2fc990(0xbc)]=_0xe2f6eb['chatId']||null),await database_1[_0x2fc990(0xb0)][_0x2fc990(0xac)][_0x2fc990(0xb5)]({'where':{'shopId':_0x3d21c7},'data':_0x52e9f5});}async[a47_0x2a9390(0xe6)](_0x2c1040,_0x3a1395){const _0xc76040=a47_0x2a9390;await this[_0xc76040(0xde)](_0x2c1040);const _0x38479b={};_0x3a1395[_0xc76040(0xb7)]!==undefined&&(_0x38479b[_0xc76040(0xb7)]=_0x3a1395[_0xc76040(0xb7)]||null),_0x3a1395[_0xc76040(0xd3)]!==undefined&&(_0x38479b[_0xc76040(0xd3)]=_0x3a1395[_0xc76040(0xd3)]||[]),await database_1[_0xc76040(0xb0)]['shopSettings']['update']({'where':{'shopId':_0x2c1040},'data':_0x38479b});}async[a47_0x2a9390(0xc6)](_0x574d6e){const _0x46b476=a47_0x2a9390,_0x1ba85c=_0x46b476(0xbd)+crypto_1[_0x46b476(0xb0)][_0x46b476(0xc8)](0x20)[_0x46b476(0xbe)](_0x46b476(0xe1)),_0xdfb209=_0x46b476(0xd0)+crypto_1[_0x46b476(0xb0)][_0x46b476(0xc8)](0x20)[_0x46b476(0xbe)](_0x46b476(0xe1));await database_1[_0x46b476(0xb0)][_0x46b476(0xc1)]['update']({'where':{'id':_0x574d6e},'data':{'publicKey':_0x1ba85c,'secretKey':_0xdfb209}});}async[a47_0x2a9390(0xdd)](_0x520671,_0x572768){const _0x3053b8=a47_0x2a9390,{passwordConfirmation:_0x169f4b}=_0x572768,_0xe51be7=await database_1['default']['shop'][_0x3053b8(0xcd)]({'where':{'id':_0x520671},'select':{'password':!![]}});if(!_0xe51be7)throw new Error(_0x3053b8(0xd1));const _0x553c45=await bcryptjs_1['default'][_0x3053b8(0xe5)](_0x169f4b,_0xe51be7[_0x3053b8(0xe0)]);if(!_0x553c45)throw new Error(_0x3053b8(0xc2));await database_1['default'][_0x3053b8(0xc1)]['delete']({'where':{'id':_0x520671}});}async[a47_0x2a9390(0xde)](_0x2c15f6){const _0x12cdb1=a47_0x2a9390,_0x36a174=await database_1[_0x12cdb1(0xb0)][_0x12cdb1(0xac)][_0x12cdb1(0xcd)]({'where':{'shopId':_0x2c15f6}});!_0x36a174&&await database_1[_0x12cdb1(0xb0)][_0x12cdb1(0xac)][_0x12cdb1(0xc0)]({'data':{'shopId':_0x2c15f6}});}}exports['SettingsService']=SettingsService;