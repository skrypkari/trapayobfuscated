'use strict';const a47_0xf63dc5=a47_0x31fe;(function(_0x5a7d86,_0x40b806){const _0x17f847=a47_0x31fe,_0x330fb0=_0x5a7d86();while(!![]){try{const _0x32feb1=-parseInt(_0x17f847(0x220))/0x1*(parseInt(_0x17f847(0x1f6))/0x2)+parseInt(_0x17f847(0x21b))/0x3*(-parseInt(_0x17f847(0x1ee))/0x4)+-parseInt(_0x17f847(0x1f5))/0x5*(-parseInt(_0x17f847(0x21e))/0x6)+-parseInt(_0x17f847(0x1fd))/0x7+parseInt(_0x17f847(0x226))/0x8*(-parseInt(_0x17f847(0x221))/0x9)+-parseInt(_0x17f847(0x219))/0xa*(parseInt(_0x17f847(0x1fc))/0xb)+parseInt(_0x17f847(0x200))/0xc;if(_0x32feb1===_0x40b806)break;else _0x330fb0['push'](_0x330fb0['shift']());}catch(_0x3ca68b){_0x330fb0['push'](_0x330fb0['shift']());}}}(a47_0x426c,0xdcfe7));var __importDefault=this&&this[a47_0xf63dc5(0x208)]||function(_0x53233d){const _0x2d056a=a47_0xf63dc5;return _0x53233d&&_0x53233d[_0x2d056a(0x1fe)]?_0x53233d:{'default':_0x53233d};};function a47_0x31fe(_0x2f3689,_0x3133e9){const _0x426c91=a47_0x426c();return a47_0x31fe=function(_0x31fe09,_0x36d138){_0x31fe09=_0x31fe09-0x1ee;let _0x4d690d=_0x426c91[_0x31fe09];return _0x4d690d;},a47_0x31fe(_0x2f3689,_0x3133e9);}Object[a47_0xf63dc5(0x21c)](exports,'__esModule',{'value':!![]}),exports[a47_0xf63dc5(0x203)]=void 0x0;const bcryptjs_1=__importDefault(require(a47_0xf63dc5(0x20e))),crypto_1=__importDefault(require(a47_0xf63dc5(0x229))),database_1=__importDefault(require('../config/database'));class SettingsService{[a47_0xf63dc5(0x22f)](_0x3cd7b7){const _0x797cc0=a47_0xf63dc5;if(!_0x3cd7b7)return'';if(_0x3cd7b7[_0x797cc0(0x212)]<=0x8)return _0x3cd7b7;const _0x3bf5c8=_0x3cd7b7['substring'](0x0,0x8),_0x13b7f9='*'[_0x797cc0(0x22e)](Math[_0x797cc0(0x231)](0x0,_0x3cd7b7[_0x797cc0(0x212)]-0x8));return _0x3bf5c8+_0x13b7f9;}[a47_0xf63dc5(0x20c)](_0x4de802){const _0x10f261=a47_0xf63dc5;if(!_0x4de802)return[];if(Array[_0x10f261(0x1f4)](_0x4de802))return _0x4de802;if(typeof _0x4de802==='string')try{const _0x2f7c7d=JSON[_0x10f261(0x206)](_0x4de802);return Array['isArray'](_0x2f7c7d)?_0x2f7c7d:[];}catch{return[];}return[];}async[a47_0xf63dc5(0x22c)](_0x354997){const _0x63804=a47_0xf63dc5,_0x505071=await database_1[_0x63804(0x1f7)][_0x63804(0x228)][_0x63804(0x213)]({'where':{'id':_0x354997},'include':{'settings':!![]}});if(!_0x505071)throw new Error(_0x63804(0x1ff));let _0x4731c7=_0x505071['settings'];return!_0x4731c7&&(_0x4731c7=await database_1[_0x63804(0x1f7)][_0x63804(0x224)][_0x63804(0x215)]({'data':{'shopId':_0x505071['id']}})),{'fullName':_0x505071['name'],'brand':_0x505071[_0x63804(0x210)],'merchantUrl':_0x505071['shopUrl'],'telegramUsername':_0x505071[_0x63804(0x232)],'telegramBotApiKey':_0x4731c7[_0x63804(0x205)]?this[_0x63804(0x22f)](_0x4731c7[_0x63804(0x205)]):null,'telegramChatId':_0x4731c7[_0x63804(0x20f)],'webhookUrl':_0x4731c7[_0x63804(0x1f3)],'webhookEvents':this[_0x63804(0x20c)](_0x4731c7[_0x63804(0x20b)]),'notifications':{'payment_success':_0x4731c7['notificationPaymentSuccess'],'payment_failed':_0x4731c7[_0x63804(0x1ef)],'refund':_0x4731c7[_0x63804(0x22b)],'payout':_0x4731c7['notificationPayout'],'login':_0x4731c7[_0x63804(0x21a)],'api_error':_0x4731c7[_0x63804(0x22a)]}};}async[a47_0xf63dc5(0x20a)](_0x3c80f9,_0x3ee1ac){const _0x521ed3=a47_0xf63dc5,{currentPassword:_0x9f6e9d,newPassword:_0xb6e914,confirmNewPassword:_0x305df5}=_0x3ee1ac;if(_0xb6e914!==_0x305df5)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0xb6e914[_0x521ed3(0x212)]<0x6)throw new Error(_0x521ed3(0x21f));const _0xe0cbc5=await database_1[_0x521ed3(0x1f7)][_0x521ed3(0x228)][_0x521ed3(0x213)]({'where':{'id':_0x3c80f9},'select':{'password':!![]}});if(!_0xe0cbc5)throw new Error(_0x521ed3(0x1ff));const _0x479706=await bcryptjs_1[_0x521ed3(0x1f7)][_0x521ed3(0x1f0)](_0x9f6e9d,_0xe0cbc5[_0x521ed3(0x1f9)]);if(!_0x479706)throw new Error(_0x521ed3(0x218));const _0x5f05e9=await bcryptjs_1[_0x521ed3(0x1f7)][_0x521ed3(0x209)](_0xb6e914,0xc);await database_1[_0x521ed3(0x1f7)]['shop']['update']({'where':{'id':_0x3c80f9},'data':{'password':_0x5f05e9}});}async[a47_0xf63dc5(0x1fa)](_0xdf13e1,_0x26da90){const _0x3d8735=a47_0xf63dc5;await this[_0x3d8735(0x230)](_0xdf13e1);const _0x663f62={};_0x26da90[_0x3d8735(0x227)]!==undefined&&(_0x663f62[_0x3d8735(0x22d)]=_0x26da90[_0x3d8735(0x227)]),_0x26da90[_0x3d8735(0x217)]!==undefined&&(_0x663f62[_0x3d8735(0x1ef)]=_0x26da90[_0x3d8735(0x217)]),_0x26da90['refund']!==undefined&&(_0x663f62[_0x3d8735(0x22b)]=_0x26da90['refund']),_0x26da90[_0x3d8735(0x216)]!==undefined&&(_0x663f62[_0x3d8735(0x204)]=_0x26da90[_0x3d8735(0x216)]),_0x26da90[_0x3d8735(0x201)]!==undefined&&(_0x663f62[_0x3d8735(0x21a)]=_0x26da90['login']),_0x26da90['api_error']!==undefined&&(_0x663f62[_0x3d8735(0x22a)]=_0x26da90['api_error']),await database_1[_0x3d8735(0x1f7)]['shopSettings'][_0x3d8735(0x211)]({'where':{'shopId':_0xdf13e1},'data':_0x663f62});}async[a47_0xf63dc5(0x207)](_0x41c76e,_0x3c6fc0){const _0x34c0e4=a47_0xf63dc5;await this[_0x34c0e4(0x230)](_0x41c76e);const _0x1a34b8={};_0x3c6fc0[_0x34c0e4(0x202)]!==undefined&&(_0x1a34b8[_0x34c0e4(0x205)]=_0x3c6fc0[_0x34c0e4(0x202)]||null),_0x3c6fc0[_0x34c0e4(0x214)]!==undefined&&(_0x1a34b8[_0x34c0e4(0x20f)]=_0x3c6fc0[_0x34c0e4(0x214)]||null),await database_1[_0x34c0e4(0x1f7)][_0x34c0e4(0x224)]['update']({'where':{'shopId':_0x41c76e},'data':_0x1a34b8});}async['updateWebhookSettings'](_0x17c628,_0x35676e){const _0x3984cd=a47_0xf63dc5;await this['ensureSettingsExist'](_0x17c628);const _0x1731f1={};_0x35676e[_0x3984cd(0x1f3)]!==undefined&&(_0x1731f1[_0x3984cd(0x1f3)]=_0x35676e['webhookUrl']||null),_0x35676e[_0x3984cd(0x20b)]!==undefined&&(_0x1731f1[_0x3984cd(0x20b)]=_0x35676e[_0x3984cd(0x20b)]||[]),await database_1[_0x3984cd(0x1f7)][_0x3984cd(0x224)][_0x3984cd(0x211)]({'where':{'shopId':_0x17c628},'data':_0x1731f1});}async[a47_0xf63dc5(0x20d)](_0x529763){const _0x1214e0=a47_0xf63dc5,_0x3f3745=_0x1214e0(0x223)+crypto_1['default'][_0x1214e0(0x1fb)](0x20)[_0x1214e0(0x225)](_0x1214e0(0x222)),_0x278810=_0x1214e0(0x21d)+crypto_1[_0x1214e0(0x1f7)][_0x1214e0(0x1fb)](0x20)[_0x1214e0(0x225)](_0x1214e0(0x222));await database_1[_0x1214e0(0x1f7)][_0x1214e0(0x228)]['update']({'where':{'id':_0x529763},'data':{'publicKey':_0x3f3745,'secretKey':_0x278810}});}async[a47_0xf63dc5(0x1f1)](_0x165048,_0x574a40){const _0x38f98c=a47_0xf63dc5,{passwordConfirmation:_0xb65042}=_0x574a40,_0x1222e4=await database_1[_0x38f98c(0x1f7)][_0x38f98c(0x228)][_0x38f98c(0x213)]({'where':{'id':_0x165048},'select':{'password':!![]}});if(!_0x1222e4)throw new Error(_0x38f98c(0x1ff));const _0x3814c2=await bcryptjs_1[_0x38f98c(0x1f7)][_0x38f98c(0x1f0)](_0xb65042,_0x1222e4[_0x38f98c(0x1f9)]);if(!_0x3814c2)throw new Error(_0x38f98c(0x1f2));await database_1[_0x38f98c(0x1f7)][_0x38f98c(0x228)][_0x38f98c(0x1f8)]({'where':{'id':_0x165048}});}async[a47_0xf63dc5(0x230)](_0x5e552b){const _0x3e1243=a47_0xf63dc5,_0x1970b5=await database_1['default'][_0x3e1243(0x224)][_0x3e1243(0x213)]({'where':{'shopId':_0x5e552b}});!_0x1970b5&&await database_1[_0x3e1243(0x1f7)]['shopSettings']['create']({'data':{'shopId':_0x5e552b}});}}exports[a47_0xf63dc5(0x203)]=SettingsService;function a47_0x426c(){const _0x21b400=['ensureSettingsExist','max','telegram','2116332DBdpBZ','notificationPaymentFailed','compare','deleteAccount','Password\x20confirmation\x20is\x20incorrect','webhookUrl','isArray','130vmhFpU','10zcjPOT','default','delete','password','updateNotifications','randomBytes','22PEDPbb','4545149DQkEOy','__esModule','Shop\x20not\x20found','76808088ScuSuJ','login','botApiKey','SettingsService','notificationPayout','telegramBotApiKey','parse','updateTelegramSettings','__importDefault','hash','changePassword','webhookEvents','parseWebhookEvents','revokeAllApiKeys','bcryptjs','telegramChatId','name','update','length','findUnique','chatId','create','payout','payment_failed','Current\x20password\x20is\x20incorrect','6989420KxvNUn','notificationLogin','9urKWEv','defineProperty','sk_','259878rZFImC','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','316301qKFmbN','1692RdCaGq','hex','pk_','shopSettings','toString','59816kwJqnj','payment_success','shop','crypto','notificationApiError','notificationRefund','getShopSettings','notificationPaymentSuccess','repeat','maskApiKey'];a47_0x426c=function(){return _0x21b400;};return a47_0x426c();}