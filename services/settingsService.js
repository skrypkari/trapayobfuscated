'use strict';const a59_0x13c18e=a59_0x3323;function a59_0x1f76(){const _0x532eda=['91084aeNLKB','parse','hex','maskApiKey','api_error','create','revokeAllApiKeys','telegramChatId','changePassword','telegramBotApiKey','findUnique','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','1595346JdESev','4AjXPia','settings','isArray','30151EEYLqX','name','notificationPaymentFailed','104gffTNu','update','notificationPaymentSuccess','parseWebhookEvents','295214uAuJBJ','notificationPayout','payout','bcryptjs','payment_success','botApiKey','3938785ffwLpK','webhookUrl','default','pk_','hash','substring','refund','2tIeBJS','toString','repeat','payment_failed','updateNotifications','chatId','SettingsService','updateWebhookSettings','getShopSettings','deleteAccount','shop','shopSettings','string','delete','shopUrl','defineProperty','webhookEvents','Shop\x20not\x20found','notificationApiError','password','ensureSettingsExist','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','3747726Bfjwea','randomBytes','912bNqtRY','length','compare','3609PKYlXy','updateTelegramSettings','2910Lqvzla','notificationRefund','Current\x20password\x20is\x20incorrect'];a59_0x1f76=function(){return _0x532eda;};return a59_0x1f76();}(function(_0x2843a8,_0x2c5f6d){const _0x37ce46=a59_0x3323,_0x20c073=_0x2843a8();while(!![]){try{const _0x242209=parseInt(_0x37ce46(0xe9))/0x1+-parseInt(_0x37ce46(0xf6))/0x2*(parseInt(_0x37ce46(0x122))/0x3)+-parseInt(_0x37ce46(0xdf))/0x4*(-parseInt(_0x37ce46(0xef))/0x5)+-parseInt(_0x37ce46(0x10c))/0x6+-parseInt(_0x37ce46(0x116))/0x7*(-parseInt(_0x37ce46(0xe5))/0x8)+-parseInt(_0x37ce46(0x111))/0x9*(-parseInt(_0x37ce46(0x113))/0xa)+parseInt(_0x37ce46(0xe2))/0xb*(parseInt(_0x37ce46(0x10e))/0xc);if(_0x242209===_0x2c5f6d)break;else _0x20c073['push'](_0x20c073['shift']());}catch(_0x536b33){_0x20c073['push'](_0x20c073['shift']());}}}(a59_0x1f76,0x66b7b));var __importDefault=this&&this['__importDefault']||function(_0x38c1fd){return _0x38c1fd&&_0x38c1fd['__esModule']?_0x38c1fd:{'default':_0x38c1fd};};Object[a59_0x13c18e(0x105)](exports,'__esModule',{'value':!![]}),exports[a59_0x13c18e(0xfc)]=void 0x0;const bcryptjs_1=__importDefault(require(a59_0x13c18e(0xec))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));function a59_0x3323(_0x3c0990,_0x58dcf5){const _0x1f76a7=a59_0x1f76();return a59_0x3323=function(_0x332387,_0x2b8a3b){_0x332387=_0x332387-0xdf;let _0x434ea0=_0x1f76a7[_0x332387];return _0x434ea0;},a59_0x3323(_0x3c0990,_0x58dcf5);}class SettingsService{[a59_0x13c18e(0x119)](_0x56614e){const _0x56c959=a59_0x13c18e;if(!_0x56614e)return'';if(_0x56614e['length']<=0x8)return _0x56614e;const _0x505993=_0x56614e[_0x56c959(0xf4)](0x0,0x8),_0xc34542='*'[_0x56c959(0xf8)](Math['max'](0x0,_0x56614e[_0x56c959(0x10f)]-0x8));return _0x505993+_0xc34542;}[a59_0x13c18e(0xe8)](_0x125c68){const _0x9c0b87=a59_0x13c18e;if(!_0x125c68)return[];if(Array[_0x9c0b87(0xe1)](_0x125c68))return _0x125c68;if(typeof _0x125c68===_0x9c0b87(0x102))try{const _0xc4957e=JSON[_0x9c0b87(0x117)](_0x125c68);return Array[_0x9c0b87(0xe1)](_0xc4957e)?_0xc4957e:[];}catch{return[];}return[];}async[a59_0x13c18e(0xfe)](_0x18fe57){const _0x2b4c13=a59_0x13c18e,_0x5f2b6b=await database_1[_0x2b4c13(0xf1)]['shop']['findUnique']({'where':{'id':_0x18fe57},'include':{'settings':!![]}});if(!_0x5f2b6b)throw new Error(_0x2b4c13(0x107));let _0x45ddd0=_0x5f2b6b[_0x2b4c13(0xe0)];return!_0x45ddd0&&(_0x45ddd0=await database_1[_0x2b4c13(0xf1)][_0x2b4c13(0x101)]['create']({'data':{'shopId':_0x5f2b6b['id']}})),{'fullName':_0x5f2b6b[_0x2b4c13(0xe3)],'brand':_0x5f2b6b[_0x2b4c13(0xe3)],'merchantUrl':_0x5f2b6b[_0x2b4c13(0x104)],'telegramUsername':_0x5f2b6b['telegram'],'telegramBotApiKey':_0x45ddd0[_0x2b4c13(0x11f)]?this[_0x2b4c13(0x119)](_0x45ddd0[_0x2b4c13(0x11f)]):null,'telegramChatId':_0x45ddd0['telegramChatId'],'webhookUrl':_0x45ddd0[_0x2b4c13(0xf0)],'webhookEvents':this['parseWebhookEvents'](_0x45ddd0[_0x2b4c13(0x106)]),'notifications':{'payment_success':_0x45ddd0['notificationPaymentSuccess'],'payment_failed':_0x45ddd0['notificationPaymentFailed'],'refund':_0x45ddd0['notificationRefund'],'payout':_0x45ddd0[_0x2b4c13(0xea)],'login':_0x45ddd0['notificationLogin'],'api_error':_0x45ddd0[_0x2b4c13(0x108)]}};}async[a59_0x13c18e(0x11e)](_0x4de35a,_0x4e0bb5){const _0x55b315=a59_0x13c18e,{currentPassword:_0x44a7bb,newPassword:_0x456454,confirmNewPassword:_0x39022d}=_0x4e0bb5;if(_0x456454!==_0x39022d)throw new Error(_0x55b315(0x121));if(_0x456454[_0x55b315(0x10f)]<0x6)throw new Error(_0x55b315(0x10b));const _0x372f4e=await database_1[_0x55b315(0xf1)]['shop']['findUnique']({'where':{'id':_0x4de35a},'select':{'password':!![]}});if(!_0x372f4e)throw new Error('Shop\x20not\x20found');const _0x15c723=await bcryptjs_1[_0x55b315(0xf1)][_0x55b315(0x110)](_0x44a7bb,_0x372f4e[_0x55b315(0x109)]);if(!_0x15c723)throw new Error(_0x55b315(0x115));const _0x9e562e=await bcryptjs_1[_0x55b315(0xf1)][_0x55b315(0xf3)](_0x456454,0xc);await database_1[_0x55b315(0xf1)][_0x55b315(0x100)]['update']({'where':{'id':_0x4de35a},'data':{'password':_0x9e562e}});}async[a59_0x13c18e(0xfa)](_0x4ef734,_0x5bee31){const _0x106f8c=a59_0x13c18e;await this[_0x106f8c(0x10a)](_0x4ef734);const _0x3779e5={};_0x5bee31[_0x106f8c(0xed)]!==undefined&&(_0x3779e5[_0x106f8c(0xe7)]=_0x5bee31[_0x106f8c(0xed)]),_0x5bee31[_0x106f8c(0xf9)]!==undefined&&(_0x3779e5[_0x106f8c(0xe4)]=_0x5bee31[_0x106f8c(0xf9)]),_0x5bee31['refund']!==undefined&&(_0x3779e5[_0x106f8c(0x114)]=_0x5bee31[_0x106f8c(0xf5)]),_0x5bee31['payout']!==undefined&&(_0x3779e5['notificationPayout']=_0x5bee31[_0x106f8c(0xeb)]),_0x5bee31['login']!==undefined&&(_0x3779e5['notificationLogin']=_0x5bee31['login']),_0x5bee31[_0x106f8c(0x11a)]!==undefined&&(_0x3779e5[_0x106f8c(0x108)]=_0x5bee31['api_error']),await database_1['default'][_0x106f8c(0x101)][_0x106f8c(0xe6)]({'where':{'shopId':_0x4ef734},'data':_0x3779e5});}async[a59_0x13c18e(0x112)](_0x1c11b5,_0x155697){const _0x428703=a59_0x13c18e;await this['ensureSettingsExist'](_0x1c11b5);const _0x180c8a={};_0x155697[_0x428703(0xee)]!==undefined&&(_0x180c8a[_0x428703(0x11f)]=_0x155697[_0x428703(0xee)]||null),_0x155697[_0x428703(0xfb)]!==undefined&&(_0x180c8a[_0x428703(0x11d)]=_0x155697[_0x428703(0xfb)]||null),await database_1[_0x428703(0xf1)][_0x428703(0x101)][_0x428703(0xe6)]({'where':{'shopId':_0x1c11b5},'data':_0x180c8a});}async[a59_0x13c18e(0xfd)](_0x152c9f,_0x84c97a){const _0x3f5dee=a59_0x13c18e;await this['ensureSettingsExist'](_0x152c9f);const _0x1f44f3={};_0x84c97a['webhookUrl']!==undefined&&(_0x1f44f3[_0x3f5dee(0xf0)]=_0x84c97a[_0x3f5dee(0xf0)]||null),_0x84c97a[_0x3f5dee(0x106)]!==undefined&&(_0x1f44f3[_0x3f5dee(0x106)]=_0x84c97a['webhookEvents']||[]),await database_1[_0x3f5dee(0xf1)][_0x3f5dee(0x101)][_0x3f5dee(0xe6)]({'where':{'shopId':_0x152c9f},'data':_0x1f44f3});}async[a59_0x13c18e(0x11c)](_0x5998cf){const _0x3a115c=a59_0x13c18e,_0x2a70be=_0x3a115c(0xf2)+crypto_1[_0x3a115c(0xf1)][_0x3a115c(0x10d)](0x20)[_0x3a115c(0xf7)](_0x3a115c(0x118)),_0x3fe419='sk_'+crypto_1['default']['randomBytes'](0x20)[_0x3a115c(0xf7)](_0x3a115c(0x118));await database_1[_0x3a115c(0xf1)][_0x3a115c(0x100)]['update']({'where':{'id':_0x5998cf},'data':{'publicKey':_0x2a70be,'secretKey':_0x3fe419}});}async[a59_0x13c18e(0xff)](_0x52fc13,_0x5968f8){const _0x5785f1=a59_0x13c18e,{passwordConfirmation:_0x3b2b5f}=_0x5968f8,_0x1aec31=await database_1[_0x5785f1(0xf1)][_0x5785f1(0x100)][_0x5785f1(0x120)]({'where':{'id':_0x52fc13},'select':{'password':!![]}});if(!_0x1aec31)throw new Error(_0x5785f1(0x107));const _0x5dfa8a=await bcryptjs_1[_0x5785f1(0xf1)][_0x5785f1(0x110)](_0x3b2b5f,_0x1aec31['password']);if(!_0x5dfa8a)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x5785f1(0xf1)][_0x5785f1(0x100)][_0x5785f1(0x103)]({'where':{'id':_0x52fc13}});}async[a59_0x13c18e(0x10a)](_0x3e50db){const _0x29c2c9=a59_0x13c18e,_0x5d290e=await database_1[_0x29c2c9(0xf1)][_0x29c2c9(0x101)][_0x29c2c9(0x120)]({'where':{'shopId':_0x3e50db}});!_0x5d290e&&await database_1[_0x29c2c9(0xf1)][_0x29c2c9(0x101)][_0x29c2c9(0x11b)]({'data':{'shopId':_0x3e50db}});}}exports['SettingsService']=SettingsService;