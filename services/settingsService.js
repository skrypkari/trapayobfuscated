'use strict';const a55_0x41d49a=a55_0x2c36;function a55_0x4fb6(){const _0x3f5f87=['hex','randomBytes','shopSettings','crypto','701403PZVSqi','Shop\x20not\x20found','api_error','settings','Password\x20confirmation\x20is\x20incorrect','ensureSettingsExist','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','telegramChatId','delete','login','notificationPaymentSuccess','toString','payment_failed','135GlbpYX','webhookEvents','compare','isArray','repeat','1767800JUBdKo','revokeAllApiKeys','payout','shop','create','changePassword','refund','__esModule','webhookUrl','default','9348713JdtOSP','telegram','notificationRefund','telegramBotApiKey','string','updateNotifications','updateTelegramSettings','SettingsService','36UUZPNf','1NgWVXJ','maskApiKey','31764qeBiPF','parseWebhookEvents','max','4445472njkORK','substring','692086CZGruT','password','pk_','__importDefault','12GIKxUU','33964FryTDe','length','name','notificationLogin','update','deleteAccount','chatId','findUnique','notificationPaymentFailed','botApiKey','getShopSettings','notificationPayout','payment_success','New\x20password\x20and\x20confirmation\x20do\x20not\x20match'];a55_0x4fb6=function(){return _0x3f5f87;};return a55_0x4fb6();}(function(_0x971e43,_0x1c3f12){const _0x2fc5ab=a55_0x2c36,_0x38ae60=_0x971e43();while(!![]){try{const _0x2582bc=-parseInt(_0x2fc5ab(0x183))/0x1*(-parseInt(_0x2fc5ab(0x18a))/0x2)+parseInt(_0x2fc5ab(0x1a1))/0x3+parseInt(_0x2fc5ab(0x185))/0x4*(parseInt(_0x2fc5ab(0x16b))/0x5)+-parseInt(_0x2fc5ab(0x18e))/0x6*(parseInt(_0x2fc5ab(0x18f))/0x7)+-parseInt(_0x2fc5ab(0x188))/0x8+-parseInt(_0x2fc5ab(0x182))/0x9*(parseInt(_0x2fc5ab(0x170))/0xa)+parseInt(_0x2fc5ab(0x17a))/0xb;if(_0x2582bc===_0x1c3f12)break;else _0x38ae60['push'](_0x38ae60['shift']());}catch(_0x5c5f29){_0x38ae60['push'](_0x38ae60['shift']());}}}(a55_0x4fb6,0x5abaa));var __importDefault=this&&this[a55_0x41d49a(0x18d)]||function(_0x1b9d2c){const _0x30b0b7=a55_0x41d49a;return _0x1b9d2c&&_0x1b9d2c[_0x30b0b7(0x177)]?_0x1b9d2c:{'default':_0x1b9d2c};};Object['defineProperty'](exports,a55_0x41d49a(0x177),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a55_0x41d49a(0x1a0))),database_1=__importDefault(require('../config/database'));class SettingsService{[a55_0x41d49a(0x184)](_0x1cd1b0){const _0x36114c=a55_0x41d49a;if(!_0x1cd1b0)return'';if(_0x1cd1b0[_0x36114c(0x190)]<=0x8)return _0x1cd1b0;const _0x4e4148=_0x1cd1b0[_0x36114c(0x189)](0x0,0x8),_0x14302b='*'[_0x36114c(0x16f)](Math[_0x36114c(0x187)](0x0,_0x1cd1b0['length']-0x8));return _0x4e4148+_0x14302b;}[a55_0x41d49a(0x186)](_0x4326a0){const _0x7bc8dd=a55_0x41d49a;if(!_0x4326a0)return[];if(Array[_0x7bc8dd(0x16e)](_0x4326a0))return _0x4326a0;if(typeof _0x4326a0===_0x7bc8dd(0x17e))try{const _0x56b994=JSON['parse'](_0x4326a0);return Array['isArray'](_0x56b994)?_0x56b994:[];}catch{return[];}return[];}async[a55_0x41d49a(0x199)](_0x3df317){const _0x4abca9=a55_0x41d49a,_0x9a0328=await database_1[_0x4abca9(0x179)]['shop'][_0x4abca9(0x196)]({'where':{'id':_0x3df317},'include':{'settings':!![]}});if(!_0x9a0328)throw new Error('Shop\x20not\x20found');let _0x1bf320=_0x9a0328[_0x4abca9(0x161)];return!_0x1bf320&&(_0x1bf320=await database_1[_0x4abca9(0x179)]['shopSettings'][_0x4abca9(0x174)]({'data':{'shopId':_0x9a0328['id']}})),{'fullName':_0x9a0328['name'],'brand':_0x9a0328[_0x4abca9(0x191)],'merchantUrl':_0x9a0328['shopUrl'],'telegramUsername':_0x9a0328[_0x4abca9(0x17b)],'telegramBotApiKey':_0x1bf320[_0x4abca9(0x17d)]?this[_0x4abca9(0x184)](_0x1bf320['telegramBotApiKey']):null,'telegramChatId':_0x1bf320[_0x4abca9(0x165)],'webhookUrl':_0x1bf320[_0x4abca9(0x178)],'webhookEvents':this['parseWebhookEvents'](_0x1bf320[_0x4abca9(0x16c)]),'notifications':{'payment_success':_0x1bf320[_0x4abca9(0x168)],'payment_failed':_0x1bf320[_0x4abca9(0x197)],'refund':_0x1bf320[_0x4abca9(0x17c)],'payout':_0x1bf320['notificationPayout'],'login':_0x1bf320[_0x4abca9(0x192)],'api_error':_0x1bf320['notificationApiError']}};}async[a55_0x41d49a(0x175)](_0x2b9eea,_0x9d98a9){const _0x540eb8=a55_0x41d49a,{currentPassword:_0x2294fe,newPassword:_0x415871,confirmNewPassword:_0x5dadfe}=_0x9d98a9;if(_0x415871!==_0x5dadfe)throw new Error(_0x540eb8(0x19c));if(_0x415871[_0x540eb8(0x190)]<0x6)throw new Error(_0x540eb8(0x164));const _0x5213ec=await database_1[_0x540eb8(0x179)][_0x540eb8(0x173)]['findUnique']({'where':{'id':_0x2b9eea},'select':{'password':!![]}});if(!_0x5213ec)throw new Error(_0x540eb8(0x1a2));const _0x5693de=await bcryptjs_1[_0x540eb8(0x179)]['compare'](_0x2294fe,_0x5213ec[_0x540eb8(0x18b)]);if(!_0x5693de)throw new Error('Current\x20password\x20is\x20incorrect');const _0x5de42e=await bcryptjs_1[_0x540eb8(0x179)]['hash'](_0x415871,0xc);await database_1[_0x540eb8(0x179)][_0x540eb8(0x173)][_0x540eb8(0x193)]({'where':{'id':_0x2b9eea},'data':{'password':_0x5de42e}});}async[a55_0x41d49a(0x17f)](_0x4856b0,_0x4f8407){const _0x99987d=a55_0x41d49a;await this[_0x99987d(0x163)](_0x4856b0);const _0x19f7af={};_0x4f8407[_0x99987d(0x19b)]!==undefined&&(_0x19f7af[_0x99987d(0x168)]=_0x4f8407[_0x99987d(0x19b)]),_0x4f8407[_0x99987d(0x16a)]!==undefined&&(_0x19f7af['notificationPaymentFailed']=_0x4f8407[_0x99987d(0x16a)]),_0x4f8407[_0x99987d(0x176)]!==undefined&&(_0x19f7af['notificationRefund']=_0x4f8407[_0x99987d(0x176)]),_0x4f8407[_0x99987d(0x172)]!==undefined&&(_0x19f7af[_0x99987d(0x19a)]=_0x4f8407[_0x99987d(0x172)]),_0x4f8407[_0x99987d(0x167)]!==undefined&&(_0x19f7af[_0x99987d(0x192)]=_0x4f8407[_0x99987d(0x167)]),_0x4f8407[_0x99987d(0x1a3)]!==undefined&&(_0x19f7af['notificationApiError']=_0x4f8407[_0x99987d(0x1a3)]),await database_1['default'][_0x99987d(0x19f)]['update']({'where':{'shopId':_0x4856b0},'data':_0x19f7af});}async[a55_0x41d49a(0x180)](_0x455368,_0xf1345a){const _0x49abd7=a55_0x41d49a;await this[_0x49abd7(0x163)](_0x455368);const _0x3ec23b={};_0xf1345a[_0x49abd7(0x198)]!==undefined&&(_0x3ec23b[_0x49abd7(0x17d)]=_0xf1345a['botApiKey']||null),_0xf1345a[_0x49abd7(0x195)]!==undefined&&(_0x3ec23b[_0x49abd7(0x165)]=_0xf1345a[_0x49abd7(0x195)]||null),await database_1['default'][_0x49abd7(0x19f)][_0x49abd7(0x193)]({'where':{'shopId':_0x455368},'data':_0x3ec23b});}async['updateWebhookSettings'](_0xc78e67,_0x3b0a3a){const _0x5bfda6=a55_0x41d49a;await this[_0x5bfda6(0x163)](_0xc78e67);const _0x1459fc={};_0x3b0a3a[_0x5bfda6(0x178)]!==undefined&&(_0x1459fc[_0x5bfda6(0x178)]=_0x3b0a3a[_0x5bfda6(0x178)]||null),_0x3b0a3a[_0x5bfda6(0x16c)]!==undefined&&(_0x1459fc[_0x5bfda6(0x16c)]=_0x3b0a3a[_0x5bfda6(0x16c)]||[]),await database_1['default'][_0x5bfda6(0x19f)]['update']({'where':{'shopId':_0xc78e67},'data':_0x1459fc});}async[a55_0x41d49a(0x171)](_0x44639f){const _0x22d21e=a55_0x41d49a,_0x128e85=_0x22d21e(0x18c)+crypto_1[_0x22d21e(0x179)][_0x22d21e(0x19e)](0x20)[_0x22d21e(0x169)](_0x22d21e(0x19d)),_0x1d99af='sk_'+crypto_1[_0x22d21e(0x179)][_0x22d21e(0x19e)](0x20)[_0x22d21e(0x169)](_0x22d21e(0x19d));await database_1[_0x22d21e(0x179)][_0x22d21e(0x173)][_0x22d21e(0x193)]({'where':{'id':_0x44639f},'data':{'publicKey':_0x128e85,'secretKey':_0x1d99af}});}async[a55_0x41d49a(0x194)](_0x78f6d9,_0x1ff019){const _0x2cee02=a55_0x41d49a,{passwordConfirmation:_0x2f1326}=_0x1ff019,_0x313658=await database_1[_0x2cee02(0x179)][_0x2cee02(0x173)][_0x2cee02(0x196)]({'where':{'id':_0x78f6d9},'select':{'password':!![]}});if(!_0x313658)throw new Error(_0x2cee02(0x1a2));const _0x1f905a=await bcryptjs_1['default'][_0x2cee02(0x16d)](_0x2f1326,_0x313658[_0x2cee02(0x18b)]);if(!_0x1f905a)throw new Error(_0x2cee02(0x162));await database_1[_0x2cee02(0x179)]['shop'][_0x2cee02(0x166)]({'where':{'id':_0x78f6d9}});}async[a55_0x41d49a(0x163)](_0x5314af){const _0x1960ce=a55_0x41d49a,_0x5a88b4=await database_1[_0x1960ce(0x179)][_0x1960ce(0x19f)][_0x1960ce(0x196)]({'where':{'shopId':_0x5314af}});!_0x5a88b4&&await database_1[_0x1960ce(0x179)][_0x1960ce(0x19f)][_0x1960ce(0x174)]({'data':{'shopId':_0x5314af}});}}function a55_0x2c36(_0x27afac,_0x3fe7b4){const _0x4fb6c7=a55_0x4fb6();return a55_0x2c36=function(_0x2c3602,_0x293539){_0x2c3602=_0x2c3602-0x161;let _0x4a0435=_0x4fb6c7[_0x2c3602];return _0x4a0435;},a55_0x2c36(_0x27afac,_0x3fe7b4);}exports[a55_0x41d49a(0x181)]=SettingsService;