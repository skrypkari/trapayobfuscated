'use strict';const a51_0x1a2a7c=a51_0x26a6;(function(_0x189502,_0x18218b){const _0x54aea3=a51_0x26a6,_0x5bc94f=_0x189502();while(!![]){try{const _0x16eb56=-parseInt(_0x54aea3(0x7e))/0x1+parseInt(_0x54aea3(0xad))/0x2+-parseInt(_0x54aea3(0x90))/0x3*(parseInt(_0x54aea3(0x9a))/0x4)+-parseInt(_0x54aea3(0x73))/0x5+-parseInt(_0x54aea3(0x86))/0x6+parseInt(_0x54aea3(0x8b))/0x7+parseInt(_0x54aea3(0x7a))/0x8;if(_0x16eb56===_0x18218b)break;else _0x5bc94f['push'](_0x5bc94f['shift']());}catch(_0x4dd098){_0x5bc94f['push'](_0x5bc94f['shift']());}}}(a51_0x430f,0x881e0));var __importDefault=this&&this[a51_0x1a2a7c(0x9b)]||function(_0x5da66f){const _0x22f357=a51_0x1a2a7c;return _0x5da66f&&_0x5da66f[_0x22f357(0xaa)]?_0x5da66f:{'default':_0x5da66f};};function a51_0x26a6(_0x1be6b4,_0x498eee){const _0x430f58=a51_0x430f();return a51_0x26a6=function(_0x26a6e5,_0x19816a){_0x26a6e5=_0x26a6e5-0x71;let _0x2702cf=_0x430f58[_0x26a6e5];return _0x2702cf;},a51_0x26a6(_0x1be6b4,_0x498eee);}Object[a51_0x1a2a7c(0xab)](exports,a51_0x1a2a7c(0xaa),{'value':!![]}),exports[a51_0x1a2a7c(0x8f)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a51_0x1a2a7c(0x80))),database_1=__importDefault(require('../config/database'));class SettingsService{[a51_0x1a2a7c(0x78)](_0x2c1786){const _0x21b68d=a51_0x1a2a7c;if(!_0x2c1786)return'';if(_0x2c1786[_0x21b68d(0x88)]<=0x8)return _0x2c1786;const _0x14e497=_0x2c1786[_0x21b68d(0xa3)](0x0,0x8),_0x1efddd='*'[_0x21b68d(0x92)](Math[_0x21b68d(0x95)](0x0,_0x2c1786['length']-0x8));return _0x14e497+_0x1efddd;}[a51_0x1a2a7c(0x7d)](_0x2ff323){const _0x463ed3=a51_0x1a2a7c;if(!_0x2ff323)return[];if(Array[_0x463ed3(0x8a)](_0x2ff323))return _0x2ff323;if(typeof _0x2ff323===_0x463ed3(0x96))try{const _0xc40d44=JSON[_0x463ed3(0x93)](_0x2ff323);return Array[_0x463ed3(0x8a)](_0xc40d44)?_0xc40d44:[];}catch{return[];}return[];}async[a51_0x1a2a7c(0x81)](_0x1714a1){const _0x45e21b=a51_0x1a2a7c,_0x4cdc1c=await database_1[_0x45e21b(0x83)][_0x45e21b(0x87)][_0x45e21b(0xa4)]({'where':{'id':_0x1714a1},'include':{'settings':!![]}});if(!_0x4cdc1c)throw new Error('Shop\x20not\x20found');let _0x4282d7=_0x4cdc1c['settings'];return!_0x4282d7&&(_0x4282d7=await database_1['default']['shopSettings'][_0x45e21b(0x76)]({'data':{'shopId':_0x4cdc1c['id']}})),{'fullName':_0x4cdc1c[_0x45e21b(0xa6)],'brand':_0x4cdc1c[_0x45e21b(0xa6)],'merchantUrl':_0x4cdc1c['shopUrl'],'telegramUsername':_0x4cdc1c[_0x45e21b(0xa1)],'telegramBotApiKey':_0x4282d7['telegramBotApiKey']?this[_0x45e21b(0x78)](_0x4282d7['telegramBotApiKey']):null,'telegramChatId':_0x4282d7['telegramChatId'],'webhookUrl':_0x4282d7[_0x45e21b(0x71)],'webhookEvents':this['parseWebhookEvents'](_0x4282d7[_0x45e21b(0xa9)]),'notifications':{'payment_success':_0x4282d7[_0x45e21b(0x89)],'payment_failed':_0x4282d7['notificationPaymentFailed'],'refund':_0x4282d7[_0x45e21b(0xa2)],'payout':_0x4282d7['notificationPayout'],'login':_0x4282d7['notificationLogin'],'api_error':_0x4282d7['notificationApiError']}};}async[a51_0x1a2a7c(0xa0)](_0x1e231c,_0x3ce393){const _0x16d257=a51_0x1a2a7c,{currentPassword:_0x189c55,newPassword:_0x8a9146,confirmNewPassword:_0x206f83}=_0x3ce393;if(_0x8a9146!==_0x206f83)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x8a9146[_0x16d257(0x88)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x256393=await database_1[_0x16d257(0x83)][_0x16d257(0x87)]['findUnique']({'where':{'id':_0x1e231c},'select':{'password':!![]}});if(!_0x256393)throw new Error(_0x16d257(0x7c));const _0x24d19e=await bcryptjs_1[_0x16d257(0x83)][_0x16d257(0x79)](_0x189c55,_0x256393['password']);if(!_0x24d19e)throw new Error(_0x16d257(0x98));const _0x35a116=await bcryptjs_1[_0x16d257(0x83)][_0x16d257(0x8e)](_0x8a9146,0xc);await database_1[_0x16d257(0x83)][_0x16d257(0x87)]['update']({'where':{'id':_0x1e231c},'data':{'password':_0x35a116}});}async[a51_0x1a2a7c(0x9f)](_0x40c159,_0x22c181){const _0x5782b7=a51_0x1a2a7c;await this[_0x5782b7(0x7b)](_0x40c159);const _0x217052={};_0x22c181[_0x5782b7(0x74)]!==undefined&&(_0x217052[_0x5782b7(0x89)]=_0x22c181[_0x5782b7(0x74)]),_0x22c181['payment_failed']!==undefined&&(_0x217052[_0x5782b7(0x72)]=_0x22c181[_0x5782b7(0x75)]),_0x22c181['refund']!==undefined&&(_0x217052[_0x5782b7(0xa2)]=_0x22c181[_0x5782b7(0x97)]),_0x22c181[_0x5782b7(0x9d)]!==undefined&&(_0x217052['notificationPayout']=_0x22c181['payout']),_0x22c181[_0x5782b7(0x94)]!==undefined&&(_0x217052[_0x5782b7(0x82)]=_0x22c181[_0x5782b7(0x94)]),_0x22c181[_0x5782b7(0x8c)]!==undefined&&(_0x217052[_0x5782b7(0xac)]=_0x22c181[_0x5782b7(0x8c)]),await database_1['default'][_0x5782b7(0x85)][_0x5782b7(0x8d)]({'where':{'shopId':_0x40c159},'data':_0x217052});}async[a51_0x1a2a7c(0x7f)](_0x1df61f,_0x386907){const _0x48eb30=a51_0x1a2a7c;await this[_0x48eb30(0x7b)](_0x1df61f);const _0x3ee3ec={};_0x386907[_0x48eb30(0x99)]!==undefined&&(_0x3ee3ec[_0x48eb30(0x9e)]=_0x386907[_0x48eb30(0x99)]||null),_0x386907[_0x48eb30(0xa5)]!==undefined&&(_0x3ee3ec['telegramChatId']=_0x386907['chatId']||null),await database_1[_0x48eb30(0x83)][_0x48eb30(0x85)][_0x48eb30(0x8d)]({'where':{'shopId':_0x1df61f},'data':_0x3ee3ec});}async[a51_0x1a2a7c(0x91)](_0x101f5f,_0x140358){const _0x4cbacb=a51_0x1a2a7c;await this[_0x4cbacb(0x7b)](_0x101f5f);const _0x509a6d={};_0x140358[_0x4cbacb(0x71)]!==undefined&&(_0x509a6d['webhookUrl']=_0x140358[_0x4cbacb(0x71)]||null),_0x140358['webhookEvents']!==undefined&&(_0x509a6d[_0x4cbacb(0xa9)]=_0x140358[_0x4cbacb(0xa9)]||[]),await database_1[_0x4cbacb(0x83)][_0x4cbacb(0x85)][_0x4cbacb(0x8d)]({'where':{'shopId':_0x101f5f},'data':_0x509a6d});}async['revokeAllApiKeys'](_0x34389a){const _0x14f11f=a51_0x1a2a7c,_0x5c4f28='pk_'+crypto_1[_0x14f11f(0x83)]['randomBytes'](0x20)[_0x14f11f(0xa8)]('hex'),_0x2959c5='sk_'+crypto_1[_0x14f11f(0x83)][_0x14f11f(0x84)](0x20)['toString'](_0x14f11f(0x77));await database_1[_0x14f11f(0x83)][_0x14f11f(0x87)][_0x14f11f(0x8d)]({'where':{'id':_0x34389a},'data':{'publicKey':_0x5c4f28,'secretKey':_0x2959c5}});}async['deleteAccount'](_0x5acfc3,_0x13669a){const _0x49f62a=a51_0x1a2a7c,{passwordConfirmation:_0x235201}=_0x13669a,_0xfe9e37=await database_1[_0x49f62a(0x83)][_0x49f62a(0x87)][_0x49f62a(0xa4)]({'where':{'id':_0x5acfc3},'select':{'password':!![]}});if(!_0xfe9e37)throw new Error(_0x49f62a(0x7c));const _0x22f56b=await bcryptjs_1[_0x49f62a(0x83)]['compare'](_0x235201,_0xfe9e37[_0x49f62a(0x9c)]);if(!_0x22f56b)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x49f62a(0x83)][_0x49f62a(0x87)][_0x49f62a(0xa7)]({'where':{'id':_0x5acfc3}});}async[a51_0x1a2a7c(0x7b)](_0x377df7){const _0x5d6ac9=a51_0x1a2a7c,_0x102d22=await database_1[_0x5d6ac9(0x83)]['shopSettings'][_0x5d6ac9(0xa4)]({'where':{'shopId':_0x377df7}});!_0x102d22&&await database_1[_0x5d6ac9(0x83)][_0x5d6ac9(0x85)][_0x5d6ac9(0x76)]({'data':{'shopId':_0x377df7}});}}exports['SettingsService']=SettingsService;function a51_0x430f(){const _0x1ebc5c=['max','string','refund','Current\x20password\x20is\x20incorrect','botApiKey','316KkUCwd','__importDefault','password','payout','telegramBotApiKey','updateNotifications','changePassword','telegram','notificationRefund','substring','findUnique','chatId','name','delete','toString','webhookEvents','__esModule','defineProperty','notificationApiError','113892CAHXrM','webhookUrl','notificationPaymentFailed','1436515uPcbzX','payment_success','payment_failed','create','hex','maskApiKey','compare','4869288HSUxbQ','ensureSettingsExist','Shop\x20not\x20found','parseWebhookEvents','260850ulAsvT','updateTelegramSettings','crypto','getShopSettings','notificationLogin','default','randomBytes','shopSettings','3404988wycFhR','shop','length','notificationPaymentSuccess','isArray','7528087VCroLU','api_error','update','hash','SettingsService','2577xyUvco','updateWebhookSettings','repeat','parse','login'];a51_0x430f=function(){return _0x1ebc5c;};return a51_0x430f();}