'use strict';const a55_0x5e40a3=a55_0x1900;(function(_0x4ec1b7,_0x14c5ba){const _0x4617c4=a55_0x1900,_0x5af5f1=_0x4ec1b7();while(!![]){try{const _0x2ecc6f=parseInt(_0x4617c4(0x11a))/0x1+-parseInt(_0x4617c4(0x13f))/0x2*(parseInt(_0x4617c4(0x121))/0x3)+-parseInt(_0x4617c4(0x134))/0x4*(-parseInt(_0x4617c4(0x137))/0x5)+-parseInt(_0x4617c4(0x12e))/0x6+parseInt(_0x4617c4(0x155))/0x7+parseInt(_0x4617c4(0x128))/0x8*(parseInt(_0x4617c4(0x14e))/0x9)+-parseInt(_0x4617c4(0x12d))/0xa;if(_0x2ecc6f===_0x14c5ba)break;else _0x5af5f1['push'](_0x5af5f1['shift']());}catch(_0x434c7b){_0x5af5f1['push'](_0x5af5f1['shift']());}}}(a55_0x412c,0x6d7c4));function a55_0x1900(_0xed7db7,_0x33ff63){const _0x412c12=a55_0x412c();return a55_0x1900=function(_0x19007a,_0x2feeba){_0x19007a=_0x19007a-0x111;let _0x3d69d7=_0x412c12[_0x19007a];return _0x3d69d7;},a55_0x1900(_0xed7db7,_0x33ff63);}function a55_0x412c(){const _0x5c79eb=['notificationPayout','SettingsService','132046kkMVSB','updateWebhookSettings','pk_','delete','ensureSettingsExist','substring','Shop\x20not\x20found','9kPyduY','payment_failed','api_error','getShopSettings','toString','compare','notificationRefund','48fnSxnh','revokeAllApiKeys','botApiKey','payout','updateTelegramSettings','10807700jASVCZ','1026234CGqOmQ','refund','findUnique','crypto','notificationApiError','webhookEvents','148dqWERV','randomBytes','maskApiKey','26300dHvndk','update','sk_','name','telegramBotApiKey','../config/database','defineProperty','length','142342xuHOHL','__importDefault','telegramChatId','create','default','webhookUrl','notificationPaymentSuccess','shopSettings','parse','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','changePassword','notificationPaymentFailed','bcryptjs','chatId','shop','1125900oQTMcC','__esModule','repeat','payment_success','isArray','password','Password\x20confirmation\x20is\x20incorrect','5855556DBqQWb','deleteAccount','login','hex','Current\x20password\x20is\x20incorrect','hash','notificationLogin','updateNotifications'];a55_0x412c=function(){return _0x5c79eb;};return a55_0x412c();}var __importDefault=this&&this[a55_0x5e40a3(0x140)]||function(_0x320488){const _0x57cff9=a55_0x5e40a3;return _0x320488&&_0x320488[_0x57cff9(0x14f)]?_0x320488:{'default':_0x320488};};Object[a55_0x5e40a3(0x13d)](exports,a55_0x5e40a3(0x14f),{'value':!![]}),exports[a55_0x5e40a3(0x119)]=void 0x0;const bcryptjs_1=__importDefault(require(a55_0x5e40a3(0x14b))),crypto_1=__importDefault(require(a55_0x5e40a3(0x131))),database_1=__importDefault(require(a55_0x5e40a3(0x13c)));class SettingsService{[a55_0x5e40a3(0x136)](_0x19cf4d){const _0x681206=a55_0x5e40a3;if(!_0x19cf4d)return'';if(_0x19cf4d[_0x681206(0x13e)]<=0x8)return _0x19cf4d;const _0x266bc5=_0x19cf4d[_0x681206(0x11f)](0x0,0x8),_0x317525='*'[_0x681206(0x150)](Math['max'](0x0,_0x19cf4d[_0x681206(0x13e)]-0x8));return _0x266bc5+_0x317525;}['parseWebhookEvents'](_0x5529c4){const _0x2298d7=a55_0x5e40a3;if(!_0x5529c4)return[];if(Array[_0x2298d7(0x152)](_0x5529c4))return _0x5529c4;if(typeof _0x5529c4==='string')try{const _0x13f6e1=JSON[_0x2298d7(0x147)](_0x5529c4);return Array[_0x2298d7(0x152)](_0x13f6e1)?_0x13f6e1:[];}catch{return[];}return[];}async[a55_0x5e40a3(0x124)](_0x5bb0ea){const _0x33a7fd=a55_0x5e40a3,_0x20d76b=await database_1['default'][_0x33a7fd(0x14d)][_0x33a7fd(0x130)]({'where':{'id':_0x5bb0ea},'include':{'settings':!![]}});if(!_0x20d76b)throw new Error(_0x33a7fd(0x120));let _0x2fd32b=_0x20d76b['settings'];return!_0x2fd32b&&(_0x2fd32b=await database_1['default'][_0x33a7fd(0x146)][_0x33a7fd(0x142)]({'data':{'shopId':_0x20d76b['id']}})),{'fullName':_0x20d76b[_0x33a7fd(0x13a)],'brand':_0x20d76b[_0x33a7fd(0x13a)],'merchantUrl':_0x20d76b['shopUrl'],'telegramUsername':_0x20d76b['telegram'],'telegramBotApiKey':_0x2fd32b[_0x33a7fd(0x13b)]?this[_0x33a7fd(0x136)](_0x2fd32b[_0x33a7fd(0x13b)]):null,'telegramChatId':_0x2fd32b['telegramChatId'],'webhookUrl':_0x2fd32b[_0x33a7fd(0x144)],'webhookEvents':this['parseWebhookEvents'](_0x2fd32b[_0x33a7fd(0x133)]),'notifications':{'payment_success':_0x2fd32b[_0x33a7fd(0x145)],'payment_failed':_0x2fd32b[_0x33a7fd(0x14a)],'refund':_0x2fd32b[_0x33a7fd(0x127)],'payout':_0x2fd32b[_0x33a7fd(0x118)],'login':_0x2fd32b[_0x33a7fd(0x116)],'api_error':_0x2fd32b[_0x33a7fd(0x132)]}};}async[a55_0x5e40a3(0x149)](_0xac964f,_0x327650){const _0x933f0d=a55_0x5e40a3,{currentPassword:_0x6e8dcc,newPassword:_0x86ec82,confirmNewPassword:_0x60dc34}=_0x327650;if(_0x86ec82!==_0x60dc34)throw new Error(_0x933f0d(0x148));if(_0x86ec82[_0x933f0d(0x13e)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x57520a=await database_1[_0x933f0d(0x143)]['shop'][_0x933f0d(0x130)]({'where':{'id':_0xac964f},'select':{'password':!![]}});if(!_0x57520a)throw new Error(_0x933f0d(0x120));const _0x52950c=await bcryptjs_1[_0x933f0d(0x143)][_0x933f0d(0x126)](_0x6e8dcc,_0x57520a[_0x933f0d(0x153)]);if(!_0x52950c)throw new Error(_0x933f0d(0x114));const _0x573047=await bcryptjs_1['default'][_0x933f0d(0x115)](_0x86ec82,0xc);await database_1[_0x933f0d(0x143)][_0x933f0d(0x14d)][_0x933f0d(0x138)]({'where':{'id':_0xac964f},'data':{'password':_0x573047}});}async[a55_0x5e40a3(0x117)](_0x2c369d,_0x12c0a6){const _0x1b567a=a55_0x5e40a3;await this[_0x1b567a(0x11e)](_0x2c369d);const _0x334204={};_0x12c0a6['payment_success']!==undefined&&(_0x334204[_0x1b567a(0x145)]=_0x12c0a6[_0x1b567a(0x151)]),_0x12c0a6[_0x1b567a(0x122)]!==undefined&&(_0x334204['notificationPaymentFailed']=_0x12c0a6['payment_failed']),_0x12c0a6[_0x1b567a(0x12f)]!==undefined&&(_0x334204['notificationRefund']=_0x12c0a6[_0x1b567a(0x12f)]),_0x12c0a6[_0x1b567a(0x12b)]!==undefined&&(_0x334204[_0x1b567a(0x118)]=_0x12c0a6[_0x1b567a(0x12b)]),_0x12c0a6['login']!==undefined&&(_0x334204[_0x1b567a(0x116)]=_0x12c0a6[_0x1b567a(0x112)]),_0x12c0a6[_0x1b567a(0x123)]!==undefined&&(_0x334204[_0x1b567a(0x132)]=_0x12c0a6['api_error']),await database_1['default'][_0x1b567a(0x146)]['update']({'where':{'shopId':_0x2c369d},'data':_0x334204});}async[a55_0x5e40a3(0x12c)](_0x30c720,_0x5b9d26){const _0x42c7ef=a55_0x5e40a3;await this[_0x42c7ef(0x11e)](_0x30c720);const _0x1610e4={};_0x5b9d26[_0x42c7ef(0x12a)]!==undefined&&(_0x1610e4[_0x42c7ef(0x13b)]=_0x5b9d26[_0x42c7ef(0x12a)]||null),_0x5b9d26[_0x42c7ef(0x14c)]!==undefined&&(_0x1610e4[_0x42c7ef(0x141)]=_0x5b9d26[_0x42c7ef(0x14c)]||null),await database_1['default'][_0x42c7ef(0x146)]['update']({'where':{'shopId':_0x30c720},'data':_0x1610e4});}async[a55_0x5e40a3(0x11b)](_0xb40b34,_0x427383){const _0x23a91c=a55_0x5e40a3;await this[_0x23a91c(0x11e)](_0xb40b34);const _0xb3ee23={};_0x427383[_0x23a91c(0x144)]!==undefined&&(_0xb3ee23[_0x23a91c(0x144)]=_0x427383['webhookUrl']||null),_0x427383['webhookEvents']!==undefined&&(_0xb3ee23['webhookEvents']=_0x427383[_0x23a91c(0x133)]||[]),await database_1['default']['shopSettings'][_0x23a91c(0x138)]({'where':{'shopId':_0xb40b34},'data':_0xb3ee23});}async[a55_0x5e40a3(0x129)](_0x3a11a3){const _0x215b19=a55_0x5e40a3,_0x596799=_0x215b19(0x11c)+crypto_1['default'][_0x215b19(0x135)](0x20)[_0x215b19(0x125)](_0x215b19(0x113)),_0x4c2f6c=_0x215b19(0x139)+crypto_1[_0x215b19(0x143)][_0x215b19(0x135)](0x20)[_0x215b19(0x125)](_0x215b19(0x113));await database_1[_0x215b19(0x143)]['shop'][_0x215b19(0x138)]({'where':{'id':_0x3a11a3},'data':{'publicKey':_0x596799,'secretKey':_0x4c2f6c}});}async[a55_0x5e40a3(0x111)](_0x41b311,_0x1d8da1){const _0x4e4552=a55_0x5e40a3,{passwordConfirmation:_0x2ba959}=_0x1d8da1,_0x10fd54=await database_1[_0x4e4552(0x143)][_0x4e4552(0x14d)][_0x4e4552(0x130)]({'where':{'id':_0x41b311},'select':{'password':!![]}});if(!_0x10fd54)throw new Error(_0x4e4552(0x120));const _0x3ca189=await bcryptjs_1[_0x4e4552(0x143)][_0x4e4552(0x126)](_0x2ba959,_0x10fd54[_0x4e4552(0x153)]);if(!_0x3ca189)throw new Error(_0x4e4552(0x154));await database_1[_0x4e4552(0x143)][_0x4e4552(0x14d)][_0x4e4552(0x11d)]({'where':{'id':_0x41b311}});}async[a55_0x5e40a3(0x11e)](_0x324851){const _0x50c6c6=a55_0x5e40a3,_0x212775=await database_1[_0x50c6c6(0x143)][_0x50c6c6(0x146)][_0x50c6c6(0x130)]({'where':{'shopId':_0x324851}});!_0x212775&&await database_1['default'][_0x50c6c6(0x146)][_0x50c6c6(0x142)]({'data':{'shopId':_0x324851}});}}exports['SettingsService']=SettingsService;