'use strict';function a52_0x3489(_0x48543d,_0x779d6a){const _0x47e964=a52_0x47e9();return a52_0x3489=function(_0x3489b4,_0x3f614d){_0x3489b4=_0x3489b4-0x15d;let _0x3279cb=_0x47e964[_0x3489b4];return _0x3279cb;},a52_0x3489(_0x48543d,_0x779d6a);}const a52_0x5033bf=a52_0x3489;(function(_0x3d25ed,_0x35027f){const _0x5a8092=a52_0x3489,_0x3210d8=_0x3d25ed();while(!![]){try{const _0x784985=-parseInt(_0x5a8092(0x196))/0x1*(-parseInt(_0x5a8092(0x174))/0x2)+-parseInt(_0x5a8092(0x15f))/0x3*(-parseInt(_0x5a8092(0x182))/0x4)+parseInt(_0x5a8092(0x167))/0x5+parseInt(_0x5a8092(0x17d))/0x6*(parseInt(_0x5a8092(0x171))/0x7)+parseInt(_0x5a8092(0x194))/0x8+-parseInt(_0x5a8092(0x190))/0x9*(parseInt(_0x5a8092(0x162))/0xa)+-parseInt(_0x5a8092(0x169))/0xb;if(_0x784985===_0x35027f)break;else _0x3210d8['push'](_0x3210d8['shift']());}catch(_0x35f576){_0x3210d8['push'](_0x3210d8['shift']());}}}(a52_0x47e9,0x90c91));var __importDefault=this&&this[a52_0x5033bf(0x165)]||function(_0x538588){const _0x5f3c4e=a52_0x5033bf;return _0x538588&&_0x538588[_0x5f3c4e(0x172)]?_0x538588:{'default':_0x538588};};Object[a52_0x5033bf(0x195)](exports,a52_0x5033bf(0x172),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x5033bf(0x168))),crypto_1=__importDefault(require(a52_0x5033bf(0x17c))),database_1=__importDefault(require('../config/database'));class SettingsService{[a52_0x5033bf(0x16c)](_0x114071){const _0x9cd6ec=a52_0x5033bf;if(!_0x114071)return'';if(_0x114071[_0x9cd6ec(0x1a1)]<=0x8)return _0x114071;const _0x8133f0=_0x114071[_0x9cd6ec(0x177)](0x0,0x8),_0x5031bb='*'[_0x9cd6ec(0x175)](Math['max'](0x0,_0x114071[_0x9cd6ec(0x1a1)]-0x8));return _0x8133f0+_0x5031bb;}[a52_0x5033bf(0x163)](_0x1db0c9){const _0x247589=a52_0x5033bf;if(!_0x1db0c9)return[];if(Array[_0x247589(0x19d)](_0x1db0c9))return _0x1db0c9;if(typeof _0x1db0c9===_0x247589(0x160))try{const _0x4f1c86=JSON['parse'](_0x1db0c9);return Array['isArray'](_0x4f1c86)?_0x4f1c86:[];}catch{return[];}return[];}async['getShopSettings'](_0x24beb7){const _0x708af4=a52_0x5033bf,_0x3cf006=await database_1[_0x708af4(0x188)][_0x708af4(0x16b)][_0x708af4(0x18b)]({'where':{'id':_0x24beb7},'include':{'settings':!![]}});if(!_0x3cf006)throw new Error(_0x708af4(0x18e));let _0x28c0fa=_0x3cf006[_0x708af4(0x191)];return!_0x28c0fa&&(_0x28c0fa=await database_1['default'][_0x708af4(0x197)][_0x708af4(0x17b)]({'data':{'shopId':_0x3cf006['id']}})),{'fullName':_0x3cf006['name'],'brand':_0x3cf006[_0x708af4(0x166)],'merchantUrl':_0x3cf006[_0x708af4(0x199)],'telegramUsername':_0x3cf006[_0x708af4(0x180)],'telegramBotApiKey':_0x28c0fa['telegramBotApiKey']?this[_0x708af4(0x16c)](_0x28c0fa['telegramBotApiKey']):null,'telegramChatId':_0x28c0fa[_0x708af4(0x18a)],'webhookUrl':_0x28c0fa[_0x708af4(0x183)],'webhookEvents':this[_0x708af4(0x163)](_0x28c0fa[_0x708af4(0x19f)]),'notifications':{'payment_success':_0x28c0fa['notificationPaymentSuccess'],'payment_failed':_0x28c0fa[_0x708af4(0x19a)],'refund':_0x28c0fa['notificationRefund'],'payout':_0x28c0fa[_0x708af4(0x17f)],'login':_0x28c0fa[_0x708af4(0x15d)],'api_error':_0x28c0fa['notificationApiError']}};}async[a52_0x5033bf(0x16a)](_0x27211a,_0x1086cc){const _0x5e9119=a52_0x5033bf,{currentPassword:_0x168de8,newPassword:_0x42552b,confirmNewPassword:_0x21d102}=_0x1086cc;if(_0x42552b!==_0x21d102)throw new Error(_0x5e9119(0x173));if(_0x42552b['length']<0x6)throw new Error(_0x5e9119(0x186));const _0x51d4f6=await database_1[_0x5e9119(0x188)][_0x5e9119(0x16b)][_0x5e9119(0x18b)]({'where':{'id':_0x27211a},'select':{'password':!![]}});if(!_0x51d4f6)throw new Error('Shop\x20not\x20found');const _0x5b5c5f=await bcryptjs_1[_0x5e9119(0x188)][_0x5e9119(0x16d)](_0x168de8,_0x51d4f6[_0x5e9119(0x1a0)]);if(!_0x5b5c5f)throw new Error(_0x5e9119(0x18c));const _0x2a3f29=await bcryptjs_1['default'][_0x5e9119(0x181)](_0x42552b,0xc);await database_1[_0x5e9119(0x188)][_0x5e9119(0x16b)][_0x5e9119(0x161)]({'where':{'id':_0x27211a},'data':{'password':_0x2a3f29}});}async[a52_0x5033bf(0x176)](_0x14029d,_0x4b6a28){const _0x496778=a52_0x5033bf;await this[_0x496778(0x193)](_0x14029d);const _0x242faf={};_0x4b6a28[_0x496778(0x17a)]!==undefined&&(_0x242faf[_0x496778(0x15e)]=_0x4b6a28[_0x496778(0x17a)]),_0x4b6a28[_0x496778(0x189)]!==undefined&&(_0x242faf[_0x496778(0x19a)]=_0x4b6a28[_0x496778(0x189)]),_0x4b6a28[_0x496778(0x19e)]!==undefined&&(_0x242faf[_0x496778(0x16e)]=_0x4b6a28[_0x496778(0x19e)]),_0x4b6a28[_0x496778(0x187)]!==undefined&&(_0x242faf[_0x496778(0x17f)]=_0x4b6a28[_0x496778(0x187)]),_0x4b6a28[_0x496778(0x179)]!==undefined&&(_0x242faf['notificationLogin']=_0x4b6a28[_0x496778(0x179)]),_0x4b6a28[_0x496778(0x18d)]!==undefined&&(_0x242faf[_0x496778(0x185)]=_0x4b6a28[_0x496778(0x18d)]),await database_1[_0x496778(0x188)][_0x496778(0x197)]['update']({'where':{'shopId':_0x14029d},'data':_0x242faf});}async[a52_0x5033bf(0x19c)](_0x1d7fe1,_0xc07668){const _0x2c0b90=a52_0x5033bf;await this[_0x2c0b90(0x193)](_0x1d7fe1);const _0x4b19a5={};_0xc07668['botApiKey']!==undefined&&(_0x4b19a5['telegramBotApiKey']=_0xc07668[_0x2c0b90(0x198)]||null),_0xc07668[_0x2c0b90(0x16f)]!==undefined&&(_0x4b19a5[_0x2c0b90(0x18a)]=_0xc07668[_0x2c0b90(0x16f)]||null),await database_1[_0x2c0b90(0x188)][_0x2c0b90(0x197)][_0x2c0b90(0x161)]({'where':{'shopId':_0x1d7fe1},'data':_0x4b19a5});}async['updateWebhookSettings'](_0x5517e5,_0x1901d1){const _0x5b0267=a52_0x5033bf;await this[_0x5b0267(0x193)](_0x5517e5);const _0x4696dd={};_0x1901d1[_0x5b0267(0x183)]!==undefined&&(_0x4696dd[_0x5b0267(0x183)]=_0x1901d1[_0x5b0267(0x183)]||null),_0x1901d1['webhookEvents']!==undefined&&(_0x4696dd[_0x5b0267(0x19f)]=_0x1901d1[_0x5b0267(0x19f)]||[]),await database_1[_0x5b0267(0x188)][_0x5b0267(0x197)][_0x5b0267(0x161)]({'where':{'shopId':_0x5517e5},'data':_0x4696dd});}async['revokeAllApiKeys'](_0x349cef){const _0x4c4173=a52_0x5033bf,_0x1dc02e=_0x4c4173(0x170)+crypto_1[_0x4c4173(0x188)][_0x4c4173(0x18f)](0x20)[_0x4c4173(0x184)](_0x4c4173(0x192)),_0x3ada94=_0x4c4173(0x178)+crypto_1['default'][_0x4c4173(0x18f)](0x20)[_0x4c4173(0x184)](_0x4c4173(0x192));await database_1[_0x4c4173(0x188)]['shop']['update']({'where':{'id':_0x349cef},'data':{'publicKey':_0x1dc02e,'secretKey':_0x3ada94}});}async['deleteAccount'](_0x4f0d3a,_0x21fd41){const _0x47ccb7=a52_0x5033bf,{passwordConfirmation:_0x7ad7e9}=_0x21fd41,_0x15204a=await database_1['default'][_0x47ccb7(0x16b)][_0x47ccb7(0x18b)]({'where':{'id':_0x4f0d3a},'select':{'password':!![]}});if(!_0x15204a)throw new Error(_0x47ccb7(0x18e));const _0x784afa=await bcryptjs_1[_0x47ccb7(0x188)][_0x47ccb7(0x16d)](_0x7ad7e9,_0x15204a['password']);if(!_0x784afa)throw new Error(_0x47ccb7(0x17e));await database_1[_0x47ccb7(0x188)][_0x47ccb7(0x16b)][_0x47ccb7(0x164)]({'where':{'id':_0x4f0d3a}});}async[a52_0x5033bf(0x193)](_0x231980){const _0x3539b3=a52_0x5033bf,_0x40e1cd=await database_1[_0x3539b3(0x188)]['shopSettings']['findUnique']({'where':{'shopId':_0x231980}});!_0x40e1cd&&await database_1['default'][_0x3539b3(0x197)]['create']({'data':{'shopId':_0x231980}});}}exports[a52_0x5033bf(0x19b)]=SettingsService;function a52_0x47e9(){const _0xcd8290=['New\x20password\x20and\x20confirmation\x20do\x20not\x20match','98kkrqeQ','repeat','updateNotifications','substring','sk_','login','payment_success','create','crypto','1909056gVYeLo','Password\x20confirmation\x20is\x20incorrect','notificationPayout','telegram','hash','348QAlkES','webhookUrl','toString','notificationApiError','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','payout','default','payment_failed','telegramChatId','findUnique','Current\x20password\x20is\x20incorrect','api_error','Shop\x20not\x20found','randomBytes','6699213GhdEyn','settings','hex','ensureSettingsExist','4992840xWBwlp','defineProperty','12077shbYlO','shopSettings','botApiKey','shopUrl','notificationPaymentFailed','SettingsService','updateTelegramSettings','isArray','refund','webhookEvents','password','length','notificationLogin','notificationPaymentSuccess','8121rZFUcz','string','update','10xONwlg','parseWebhookEvents','delete','__importDefault','name','1476050TwxQge','bcryptjs','8001125bovDPT','changePassword','shop','maskApiKey','compare','notificationRefund','chatId','pk_','7gnfZbQ','__esModule'];a52_0x47e9=function(){return _0xcd8290;};return a52_0x47e9();}