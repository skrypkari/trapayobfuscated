'use strict';const a52_0x15bb5a=a52_0x2b2a;(function(_0x1245d0,_0x2c1e05){const _0xedc148=a52_0x2b2a,_0x1f0895=_0x1245d0();while(!![]){try{const _0x4d61ee=parseInt(_0xedc148(0x1d7))/0x1+-parseInt(_0xedc148(0x1d4))/0x2*(parseInt(_0xedc148(0x1ad))/0x3)+-parseInt(_0xedc148(0x1ba))/0x4+parseInt(_0xedc148(0x1bd))/0x5*(parseInt(_0xedc148(0x1d5))/0x6)+-parseInt(_0xedc148(0x1be))/0x7+-parseInt(_0xedc148(0x1b3))/0x8+parseInt(_0xedc148(0x1cf))/0x9*(parseInt(_0xedc148(0x1bc))/0xa);if(_0x4d61ee===_0x2c1e05)break;else _0x1f0895['push'](_0x1f0895['shift']());}catch(_0xa28e11){_0x1f0895['push'](_0x1f0895['shift']());}}}(a52_0x44a1,0x47b1b));var __importDefault=this&&this['__importDefault']||function(_0x19fb6b){const _0x514f8d=a52_0x2b2a;return _0x19fb6b&&_0x19fb6b[_0x514f8d(0x1b1)]?_0x19fb6b:{'default':_0x19fb6b};};function a52_0x2b2a(_0x58b2bc,_0x6e8bec){const _0x44a185=a52_0x44a1();return a52_0x2b2a=function(_0x2b2a35,_0x102f47){_0x2b2a35=_0x2b2a35-0x1a4;let _0x5c2671=_0x44a185[_0x2b2a35];return _0x5c2671;},a52_0x2b2a(_0x58b2bc,_0x6e8bec);}Object[a52_0x15bb5a(0x1c5)](exports,'__esModule',{'value':!![]}),exports[a52_0x15bb5a(0x1d9)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a52_0x15bb5a(0x1e1)));class SettingsService{[a52_0x15bb5a(0x1c7)](_0x1b44fd){const _0x33f89e=a52_0x15bb5a;if(!_0x1b44fd)return'';if(_0x1b44fd[_0x33f89e(0x1d2)]<=0x8)return _0x1b44fd;const _0x329fca=_0x1b44fd[_0x33f89e(0x1d3)](0x0,0x8),_0x53e40a='*'[_0x33f89e(0x1af)](Math['max'](0x0,_0x1b44fd[_0x33f89e(0x1d2)]-0x8));return _0x329fca+_0x53e40a;}['parseWebhookEvents'](_0x43dfbc){const _0x428e0b=a52_0x15bb5a;if(!_0x43dfbc)return[];if(Array[_0x428e0b(0x1c2)](_0x43dfbc))return _0x43dfbc;if(typeof _0x43dfbc===_0x428e0b(0x1aa))try{const _0x554265=JSON[_0x428e0b(0x1d6)](_0x43dfbc);return Array[_0x428e0b(0x1c2)](_0x554265)?_0x554265:[];}catch{return[];}return[];}async[a52_0x15bb5a(0x1b9)](_0x2e545b){const _0x1fd85c=a52_0x15bb5a,_0x5aa213=await database_1['default'][_0x1fd85c(0x1ac)]['findUnique']({'where':{'id':_0x2e545b},'include':{'settings':!![]}});if(!_0x5aa213)throw new Error('Shop\x20not\x20found');let _0x171c86=_0x5aa213[_0x1fd85c(0x1c8)];return!_0x171c86&&(_0x171c86=await database_1[_0x1fd85c(0x1c3)][_0x1fd85c(0x1da)][_0x1fd85c(0x1d0)]({'data':{'shopId':_0x5aa213['id']}})),{'fullName':_0x5aa213[_0x1fd85c(0x1b7)],'brand':_0x5aa213[_0x1fd85c(0x1b7)],'merchantUrl':_0x5aa213['shopUrl'],'telegramUsername':_0x5aa213[_0x1fd85c(0x1d8)],'telegramBotApiKey':_0x171c86['telegramBotApiKey']?this[_0x1fd85c(0x1c7)](_0x171c86[_0x1fd85c(0x1bf)]):null,'telegramChatId':_0x171c86[_0x1fd85c(0x1df)],'webhookUrl':_0x171c86[_0x1fd85c(0x1c9)],'webhookEvents':this[_0x1fd85c(0x1a7)](_0x171c86[_0x1fd85c(0x1a4)]),'notifications':{'payment_success':_0x171c86[_0x1fd85c(0x1ce)],'payment_failed':_0x171c86['notificationPaymentFailed'],'refund':_0x171c86[_0x1fd85c(0x1a8)],'payout':_0x171c86[_0x1fd85c(0x1cd)],'login':_0x171c86[_0x1fd85c(0x1c0)],'api_error':_0x171c86[_0x1fd85c(0x1a6)]}};}async['changePassword'](_0x3dfc5d,_0x5f1bbb){const _0xcf3491=a52_0x15bb5a,{currentPassword:_0x4d2a31,newPassword:_0x160ceb,confirmNewPassword:_0x1e7795}=_0x5f1bbb;if(_0x160ceb!==_0x1e7795)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x160ceb[_0xcf3491(0x1d2)]<0x6)throw new Error(_0xcf3491(0x1a5));const _0x4efdb9=await database_1[_0xcf3491(0x1c3)][_0xcf3491(0x1ac)][_0xcf3491(0x1bb)]({'where':{'id':_0x3dfc5d},'select':{'password':!![]}});if(!_0x4efdb9)throw new Error(_0xcf3491(0x1b8));const _0x56acc9=await bcryptjs_1[_0xcf3491(0x1c3)]['compare'](_0x4d2a31,_0x4efdb9[_0xcf3491(0x1d1)]);if(!_0x56acc9)throw new Error(_0xcf3491(0x1de));const _0x127742=await bcryptjs_1[_0xcf3491(0x1c3)]['hash'](_0x160ceb,0xc);await database_1[_0xcf3491(0x1c3)]['shop']['update']({'where':{'id':_0x3dfc5d},'data':{'password':_0x127742}});}async['updateNotifications'](_0x176727,_0x4b65ab){const _0x33784=a52_0x15bb5a;await this[_0x33784(0x1b6)](_0x176727);const _0x460c8f={};_0x4b65ab[_0x33784(0x1db)]!==undefined&&(_0x460c8f['notificationPaymentSuccess']=_0x4b65ab['payment_success']),_0x4b65ab[_0x33784(0x1cb)]!==undefined&&(_0x460c8f[_0x33784(0x1b2)]=_0x4b65ab[_0x33784(0x1cb)]),_0x4b65ab[_0x33784(0x1c6)]!==undefined&&(_0x460c8f[_0x33784(0x1a8)]=_0x4b65ab[_0x33784(0x1c6)]),_0x4b65ab[_0x33784(0x1dc)]!==undefined&&(_0x460c8f[_0x33784(0x1cd)]=_0x4b65ab[_0x33784(0x1dc)]),_0x4b65ab[_0x33784(0x1b0)]!==undefined&&(_0x460c8f['notificationLogin']=_0x4b65ab[_0x33784(0x1b0)]),_0x4b65ab[_0x33784(0x1ae)]!==undefined&&(_0x460c8f[_0x33784(0x1a6)]=_0x4b65ab[_0x33784(0x1ae)]),await database_1['default'][_0x33784(0x1da)][_0x33784(0x1ca)]({'where':{'shopId':_0x176727},'data':_0x460c8f});}async[a52_0x15bb5a(0x1cc)](_0x5eee47,_0x36dece){const _0x6ece85=a52_0x15bb5a;await this[_0x6ece85(0x1b6)](_0x5eee47);const _0x16e9b0={};_0x36dece['botApiKey']!==undefined&&(_0x16e9b0[_0x6ece85(0x1bf)]=_0x36dece['botApiKey']||null),_0x36dece[_0x6ece85(0x1c4)]!==undefined&&(_0x16e9b0[_0x6ece85(0x1df)]=_0x36dece[_0x6ece85(0x1c4)]||null),await database_1[_0x6ece85(0x1c3)][_0x6ece85(0x1da)][_0x6ece85(0x1ca)]({'where':{'shopId':_0x5eee47},'data':_0x16e9b0});}async['updateWebhookSettings'](_0x4dc664,_0x16b121){const _0x2529f7=a52_0x15bb5a;await this['ensureSettingsExist'](_0x4dc664);const _0x5961ac={};_0x16b121[_0x2529f7(0x1c9)]!==undefined&&(_0x5961ac[_0x2529f7(0x1c9)]=_0x16b121[_0x2529f7(0x1c9)]||null),_0x16b121['webhookEvents']!==undefined&&(_0x5961ac[_0x2529f7(0x1a4)]=_0x16b121[_0x2529f7(0x1a4)]||[]),await database_1[_0x2529f7(0x1c3)]['shopSettings'][_0x2529f7(0x1ca)]({'where':{'shopId':_0x4dc664},'data':_0x5961ac});}async[a52_0x15bb5a(0x1e0)](_0x7da6f0){const _0x167bb6=a52_0x15bb5a,_0x593e11=_0x167bb6(0x1e2)+crypto_1[_0x167bb6(0x1c3)][_0x167bb6(0x1ab)](0x20)[_0x167bb6(0x1dd)](_0x167bb6(0x1b5)),_0x1f92fe=_0x167bb6(0x1b4)+crypto_1[_0x167bb6(0x1c3)][_0x167bb6(0x1ab)](0x20)['toString'](_0x167bb6(0x1b5));await database_1[_0x167bb6(0x1c3)][_0x167bb6(0x1ac)][_0x167bb6(0x1ca)]({'where':{'id':_0x7da6f0},'data':{'publicKey':_0x593e11,'secretKey':_0x1f92fe}});}async[a52_0x15bb5a(0x1a9)](_0x30e0d7,_0x16d61d){const _0x57c886=a52_0x15bb5a,{passwordConfirmation:_0x3f66d6}=_0x16d61d,_0xd9db62=await database_1[_0x57c886(0x1c3)][_0x57c886(0x1ac)][_0x57c886(0x1bb)]({'where':{'id':_0x30e0d7},'select':{'password':!![]}});if(!_0xd9db62)throw new Error(_0x57c886(0x1b8));const _0x8c1b9f=await bcryptjs_1[_0x57c886(0x1c3)][_0x57c886(0x1e3)](_0x3f66d6,_0xd9db62[_0x57c886(0x1d1)]);if(!_0x8c1b9f)throw new Error(_0x57c886(0x1c1));await database_1['default'][_0x57c886(0x1ac)]['delete']({'where':{'id':_0x30e0d7}});}async[a52_0x15bb5a(0x1b6)](_0x468fc7){const _0x1a2390=a52_0x15bb5a,_0x2066c4=await database_1[_0x1a2390(0x1c3)][_0x1a2390(0x1da)]['findUnique']({'where':{'shopId':_0x468fc7}});!_0x2066c4&&await database_1[_0x1a2390(0x1c3)]['shopSettings'][_0x1a2390(0x1d0)]({'data':{'shopId':_0x468fc7}});}}exports[a52_0x15bb5a(0x1d9)]=SettingsService;function a52_0x44a1(){const _0x22bba4=['substring','1100534XFADKx','588TzPlBU','parse','106347VkQTwV','telegram','SettingsService','shopSettings','payment_success','payout','toString','Current\x20password\x20is\x20incorrect','telegramChatId','revokeAllApiKeys','../config/database','pk_','compare','webhookEvents','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','notificationApiError','parseWebhookEvents','notificationRefund','deleteAccount','string','randomBytes','shop','3ZhRIEY','api_error','repeat','login','__esModule','notificationPaymentFailed','3605064lTmOWj','sk_','hex','ensureSettingsExist','name','Shop\x20not\x20found','getShopSettings','394588LrJjQl','findUnique','12854890SVLZuq','14810hAvBTP','2022342lKMeTs','telegramBotApiKey','notificationLogin','Password\x20confirmation\x20is\x20incorrect','isArray','default','chatId','defineProperty','refund','maskApiKey','settings','webhookUrl','update','payment_failed','updateTelegramSettings','notificationPayout','notificationPaymentSuccess','9UgFwWi','create','password','length'];a52_0x44a1=function(){return _0x22bba4;};return a52_0x44a1();}