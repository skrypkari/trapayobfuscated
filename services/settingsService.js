'use strict';const a52_0x5f1cef=a52_0x3d38;(function(_0x5969be,_0x2243a8){const _0x2762d4=a52_0x3d38,_0x3882cf=_0x5969be();while(!![]){try{const _0x51e84a=parseInt(_0x2762d4(0x19b))/0x1*(-parseInt(_0x2762d4(0x182))/0x2)+parseInt(_0x2762d4(0x196))/0x3*(parseInt(_0x2762d4(0x184))/0x4)+-parseInt(_0x2762d4(0x16d))/0x5*(parseInt(_0x2762d4(0x173))/0x6)+parseInt(_0x2762d4(0x195))/0x7*(parseInt(_0x2762d4(0x199))/0x8)+-parseInt(_0x2762d4(0x17f))/0x9*(-parseInt(_0x2762d4(0x177))/0xa)+parseInt(_0x2762d4(0x180))/0xb*(parseInt(_0x2762d4(0x178))/0xc)+-parseInt(_0x2762d4(0x161))/0xd;if(_0x51e84a===_0x2243a8)break;else _0x3882cf['push'](_0x3882cf['shift']());}catch(_0x31d34c){_0x3882cf['push'](_0x3882cf['shift']());}}}(a52_0x2619,0xc90a1));function a52_0x3d38(_0x59c2de,_0x19c8e2){const _0x2619cd=a52_0x2619();return a52_0x3d38=function(_0x3d38fe,_0x2d639e){_0x3d38fe=_0x3d38fe-0x160;let _0xfbe237=_0x2619cd[_0x3d38fe];return _0xfbe237;},a52_0x3d38(_0x59c2de,_0x19c8e2);}var __importDefault=this&&this[a52_0x5f1cef(0x174)]||function(_0x1699c2){return _0x1699c2&&_0x1699c2['__esModule']?_0x1699c2:{'default':_0x1699c2};};Object[a52_0x5f1cef(0x183)](exports,a52_0x5f1cef(0x19e),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a52_0x5f1cef(0x18a))),database_1=__importDefault(require(a52_0x5f1cef(0x1a1)));class SettingsService{['maskApiKey'](_0x37ebb5){const _0x551eb8=a52_0x5f1cef;if(!_0x37ebb5)return'';if(_0x37ebb5[_0x551eb8(0x171)]<=0x8)return _0x37ebb5;const _0x1aae92=_0x37ebb5[_0x551eb8(0x18b)](0x0,0x8),_0x4bcfeb='*'['repeat'](Math[_0x551eb8(0x16c)](0x0,_0x37ebb5[_0x551eb8(0x171)]-0x8));return _0x1aae92+_0x4bcfeb;}[a52_0x5f1cef(0x16e)](_0x586e29){const _0x526f03=a52_0x5f1cef;if(!_0x586e29)return[];if(Array['isArray'](_0x586e29))return _0x586e29;if(typeof _0x586e29==='string')try{const _0x9f7d0f=JSON[_0x526f03(0x169)](_0x586e29);return Array['isArray'](_0x9f7d0f)?_0x9f7d0f:[];}catch{return[];}return[];}async[a52_0x5f1cef(0x165)](_0x440df7){const _0x4c603f=a52_0x5f1cef,_0x15990f=await database_1[_0x4c603f(0x162)][_0x4c603f(0x188)]['findUnique']({'where':{'id':_0x440df7},'include':{'settings':!![]}});if(!_0x15990f)throw new Error(_0x4c603f(0x160));let _0x2b794d=_0x15990f[_0x4c603f(0x17c)];return!_0x2b794d&&(_0x2b794d=await database_1[_0x4c603f(0x162)][_0x4c603f(0x1a4)]['create']({'data':{'shopId':_0x15990f['id']}})),{'fullName':_0x15990f[_0x4c603f(0x17d)],'brand':_0x15990f[_0x4c603f(0x17d)],'merchantUrl':_0x15990f[_0x4c603f(0x163)],'telegramUsername':_0x15990f['telegram'],'telegramBotApiKey':_0x2b794d[_0x4c603f(0x17b)]?this[_0x4c603f(0x190)](_0x2b794d[_0x4c603f(0x17b)]):null,'telegramChatId':_0x2b794d[_0x4c603f(0x181)],'webhookUrl':_0x2b794d[_0x4c603f(0x179)],'webhookEvents':this[_0x4c603f(0x16e)](_0x2b794d[_0x4c603f(0x198)]),'notifications':{'payment_success':_0x2b794d['notificationPaymentSuccess'],'payment_failed':_0x2b794d['notificationPaymentFailed'],'refund':_0x2b794d[_0x4c603f(0x164)],'payout':_0x2b794d[_0x4c603f(0x170)],'login':_0x2b794d[_0x4c603f(0x192)],'api_error':_0x2b794d[_0x4c603f(0x191)]}};}async[a52_0x5f1cef(0x189)](_0x484077,_0x17e001){const _0x357c0b=a52_0x5f1cef,{currentPassword:_0x3d5983,newPassword:_0x5e5c34,confirmNewPassword:_0x5a327d}=_0x17e001;if(_0x5e5c34!==_0x5a327d)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x5e5c34[_0x357c0b(0x171)]<0x6)throw new Error(_0x357c0b(0x187));const _0x14fed0=await database_1[_0x357c0b(0x162)]['shop'][_0x357c0b(0x172)]({'where':{'id':_0x484077},'select':{'password':!![]}});if(!_0x14fed0)throw new Error('Shop\x20not\x20found');const _0x1ca39d=await bcryptjs_1['default'][_0x357c0b(0x168)](_0x3d5983,_0x14fed0[_0x357c0b(0x18c)]);if(!_0x1ca39d)throw new Error(_0x357c0b(0x194));const _0x3acc54=await bcryptjs_1[_0x357c0b(0x162)]['hash'](_0x5e5c34,0xc);await database_1['default']['shop'][_0x357c0b(0x17a)]({'where':{'id':_0x484077},'data':{'password':_0x3acc54}});}async[a52_0x5f1cef(0x16a)](_0x33a581,_0x365ad2){const _0xf55e61=a52_0x5f1cef;await this[_0xf55e61(0x166)](_0x33a581);const _0x357b5c={};_0x365ad2['payment_success']!==undefined&&(_0x357b5c[_0xf55e61(0x19d)]=_0x365ad2[_0xf55e61(0x167)]),_0x365ad2[_0xf55e61(0x19f)]!==undefined&&(_0x357b5c['notificationPaymentFailed']=_0x365ad2[_0xf55e61(0x19f)]),_0x365ad2['refund']!==undefined&&(_0x357b5c[_0xf55e61(0x164)]=_0x365ad2[_0xf55e61(0x16b)]),_0x365ad2[_0xf55e61(0x175)]!==undefined&&(_0x357b5c[_0xf55e61(0x170)]=_0x365ad2[_0xf55e61(0x175)]),_0x365ad2[_0xf55e61(0x197)]!==undefined&&(_0x357b5c['notificationLogin']=_0x365ad2['login']),_0x365ad2[_0xf55e61(0x18e)]!==undefined&&(_0x357b5c[_0xf55e61(0x191)]=_0x365ad2['api_error']),await database_1['default'][_0xf55e61(0x1a4)][_0xf55e61(0x17a)]({'where':{'shopId':_0x33a581},'data':_0x357b5c});}async[a52_0x5f1cef(0x1a3)](_0x41df97,_0x286fd4){const _0x310ab5=a52_0x5f1cef;await this[_0x310ab5(0x166)](_0x41df97);const _0x28b1d7={};_0x286fd4[_0x310ab5(0x16f)]!==undefined&&(_0x28b1d7[_0x310ab5(0x17b)]=_0x286fd4[_0x310ab5(0x16f)]||null),_0x286fd4[_0x310ab5(0x186)]!==undefined&&(_0x28b1d7[_0x310ab5(0x181)]=_0x286fd4[_0x310ab5(0x186)]||null),await database_1[_0x310ab5(0x162)][_0x310ab5(0x1a4)][_0x310ab5(0x17a)]({'where':{'shopId':_0x41df97},'data':_0x28b1d7});}async['updateWebhookSettings'](_0x5bb40c,_0x16e844){const _0xb68759=a52_0x5f1cef;await this[_0xb68759(0x166)](_0x5bb40c);const _0x554ab0={};_0x16e844[_0xb68759(0x179)]!==undefined&&(_0x554ab0[_0xb68759(0x179)]=_0x16e844[_0xb68759(0x179)]||null),_0x16e844['webhookEvents']!==undefined&&(_0x554ab0[_0xb68759(0x198)]=_0x16e844[_0xb68759(0x198)]||[]),await database_1[_0xb68759(0x162)][_0xb68759(0x1a4)][_0xb68759(0x17a)]({'where':{'shopId':_0x5bb40c},'data':_0x554ab0});}async[a52_0x5f1cef(0x185)](_0xf76586){const _0x3416dc=a52_0x5f1cef,_0x29a5d8=_0x3416dc(0x18f)+crypto_1[_0x3416dc(0x162)][_0x3416dc(0x193)](0x20)['toString'](_0x3416dc(0x1a0)),_0x1355c6='sk_'+crypto_1['default'][_0x3416dc(0x193)](0x20)[_0x3416dc(0x19a)](_0x3416dc(0x1a0));await database_1[_0x3416dc(0x162)][_0x3416dc(0x188)][_0x3416dc(0x17a)]({'where':{'id':_0xf76586},'data':{'publicKey':_0x29a5d8,'secretKey':_0x1355c6}});}async[a52_0x5f1cef(0x19c)](_0x4227a8,_0x4ee2c9){const _0x2ee2d4=a52_0x5f1cef,{passwordConfirmation:_0x594bce}=_0x4ee2c9,_0x530ed4=await database_1[_0x2ee2d4(0x162)][_0x2ee2d4(0x188)][_0x2ee2d4(0x172)]({'where':{'id':_0x4227a8},'select':{'password':!![]}});if(!_0x530ed4)throw new Error('Shop\x20not\x20found');const _0x432d74=await bcryptjs_1['default'][_0x2ee2d4(0x168)](_0x594bce,_0x530ed4[_0x2ee2d4(0x18c)]);if(!_0x432d74)throw new Error(_0x2ee2d4(0x18d));await database_1[_0x2ee2d4(0x162)][_0x2ee2d4(0x188)][_0x2ee2d4(0x17e)]({'where':{'id':_0x4227a8}});}async[a52_0x5f1cef(0x166)](_0x455abb){const _0x936b26=a52_0x5f1cef,_0x5c1c71=await database_1[_0x936b26(0x162)]['shopSettings'][_0x936b26(0x172)]({'where':{'shopId':_0x455abb}});!_0x5c1c71&&await database_1[_0x936b26(0x162)][_0x936b26(0x1a4)][_0x936b26(0x1a2)]({'data':{'shopId':_0x455abb}});}}exports[a52_0x5f1cef(0x176)]=SettingsService;function a52_0x2619(){const _0x271f9b=['refund','max','65PNSJdV','parseWebhookEvents','botApiKey','notificationPayout','length','findUnique','70296LpiDjD','__importDefault','payout','SettingsService','4559260IIWjOi','15888eyeZPp','webhookUrl','update','telegramBotApiKey','settings','name','delete','9vsmOAJ','10923oUSqWQ','telegramChatId','4zjIgRd','defineProperty','825236NffsoU','revokeAllApiKeys','chatId','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','shop','changePassword','crypto','substring','password','Password\x20confirmation\x20is\x20incorrect','api_error','pk_','maskApiKey','notificationApiError','notificationLogin','randomBytes','Current\x20password\x20is\x20incorrect','2838598fUZIgY','6RWzXfh','login','webhookEvents','32jZbBzG','toString','673841wDFuGC','deleteAccount','notificationPaymentSuccess','__esModule','payment_failed','hex','../config/database','create','updateTelegramSettings','shopSettings','Shop\x20not\x20found','19264505rvFLVW','default','shopUrl','notificationRefund','getShopSettings','ensureSettingsExist','payment_success','compare','parse','updateNotifications'];a52_0x2619=function(){return _0x271f9b;};return a52_0x2619();}