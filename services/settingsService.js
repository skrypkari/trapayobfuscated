'use strict';const a47_0x69762f=a47_0x57b1;(function(_0x4bfab4,_0x4af4e9){const _0x275393=a47_0x57b1,_0x346de5=_0x4bfab4();while(!![]){try{const _0x1e4dd9=-parseInt(_0x275393(0x206))/0x1+parseInt(_0x275393(0x1e6))/0x2+parseInt(_0x275393(0x1d9))/0x3+parseInt(_0x275393(0x1e7))/0x4+-parseInt(_0x275393(0x1d4))/0x5+parseInt(_0x275393(0x1eb))/0x6*(parseInt(_0x275393(0x1fe))/0x7)+-parseInt(_0x275393(0x1d8))/0x8;if(_0x1e4dd9===_0x4af4e9)break;else _0x346de5['push'](_0x346de5['shift']());}catch(_0x2b74fc){_0x346de5['push'](_0x346de5['shift']());}}}(a47_0x571b,0x20bfe));var __importDefault=this&&this[a47_0x69762f(0x1ef)]||function(_0xfd225b){const _0xb05d8e=a47_0x69762f;return _0xfd225b&&_0xfd225b[_0xb05d8e(0x1da)]?_0xfd225b:{'default':_0xfd225b};};Object[a47_0x69762f(0x1f1)](exports,a47_0x69762f(0x1da),{'value':!![]}),exports[a47_0x69762f(0x210)]=void 0x0;function a47_0x57b1(_0xc1779e,_0x3ba331){const _0x571b78=a47_0x571b();return a47_0x57b1=function(_0x57b182,_0x326217){_0x57b182=_0x57b182-0x1d4;let _0x3365ef=_0x571b78[_0x57b182];return _0x3365ef;},a47_0x57b1(_0xc1779e,_0x3ba331);}const bcryptjs_1=__importDefault(require(a47_0x69762f(0x1ff))),crypto_1=__importDefault(require(a47_0x69762f(0x203))),database_1=__importDefault(require(a47_0x69762f(0x207)));class SettingsService{[a47_0x69762f(0x1e2)](_0x55419b){const _0x338a03=a47_0x69762f;if(!_0x55419b)return'';if(_0x55419b[_0x338a03(0x209)]<=0x8)return _0x55419b;const _0xcd67f9=_0x55419b[_0x338a03(0x1d5)](0x0,0x8),_0xf3e177='*'['repeat'](Math[_0x338a03(0x1e1)](0x0,_0x55419b['length']-0x8));return _0xcd67f9+_0xf3e177;}[a47_0x69762f(0x208)](_0x2998ed){const _0x16f525=a47_0x69762f;if(!_0x2998ed)return[];if(Array[_0x16f525(0x1d7)](_0x2998ed))return _0x2998ed;if(typeof _0x2998ed===_0x16f525(0x1f4))try{const _0x4685aa=JSON[_0x16f525(0x1ec)](_0x2998ed);return Array[_0x16f525(0x1d7)](_0x4685aa)?_0x4685aa:[];}catch{return[];}return[];}async[a47_0x69762f(0x1de)](_0x58ff4b){const _0x4ed68e=a47_0x69762f,_0x7f8b5b=await database_1[_0x4ed68e(0x1f7)][_0x4ed68e(0x1dc)][_0x4ed68e(0x1fb)]({'where':{'id':_0x58ff4b},'include':{'settings':!![]}});if(!_0x7f8b5b)throw new Error(_0x4ed68e(0x20e));let _0xd30788=_0x7f8b5b[_0x4ed68e(0x213)];return!_0xd30788&&(_0xd30788=await database_1[_0x4ed68e(0x1f7)][_0x4ed68e(0x202)]['create']({'data':{'shopId':_0x7f8b5b['id']}})),{'fullName':_0x7f8b5b[_0x4ed68e(0x1ed)],'brand':_0x7f8b5b[_0x4ed68e(0x1ed)],'merchantUrl':_0x7f8b5b[_0x4ed68e(0x20c)],'telegramUsername':_0x7f8b5b['telegram'],'telegramBotApiKey':_0xd30788[_0x4ed68e(0x1e0)]?this[_0x4ed68e(0x1e2)](_0xd30788[_0x4ed68e(0x1e0)]):null,'telegramChatId':_0xd30788[_0x4ed68e(0x1f2)],'webhookUrl':_0xd30788[_0x4ed68e(0x205)],'webhookEvents':this[_0x4ed68e(0x208)](_0xd30788[_0x4ed68e(0x201)]),'notifications':{'payment_success':_0xd30788[_0x4ed68e(0x214)],'payment_failed':_0xd30788[_0x4ed68e(0x200)],'refund':_0xd30788[_0x4ed68e(0x20d)],'payout':_0xd30788[_0x4ed68e(0x1d6)],'login':_0xd30788[_0x4ed68e(0x1f8)],'api_error':_0xd30788[_0x4ed68e(0x20b)]}};}async[a47_0x69762f(0x1fd)](_0x19bede,_0x2c6133){const _0x29bcbd=a47_0x69762f,{currentPassword:_0x496521,newPassword:_0x102e62,confirmNewPassword:_0xf0f64}=_0x2c6133;if(_0x102e62!==_0xf0f64)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x102e62[_0x29bcbd(0x209)]<0x6)throw new Error(_0x29bcbd(0x1f6));const _0x1ee304=await database_1[_0x29bcbd(0x1f7)][_0x29bcbd(0x1dc)]['findUnique']({'where':{'id':_0x19bede},'select':{'password':!![]}});if(!_0x1ee304)throw new Error(_0x29bcbd(0x20e));const _0x109464=await bcryptjs_1[_0x29bcbd(0x1f7)][_0x29bcbd(0x1ea)](_0x496521,_0x1ee304[_0x29bcbd(0x1e9)]);if(!_0x109464)throw new Error(_0x29bcbd(0x20a));const _0x5209b3=await bcryptjs_1['default']['hash'](_0x102e62,0xc);await database_1[_0x29bcbd(0x1f7)][_0x29bcbd(0x1dc)][_0x29bcbd(0x217)]({'where':{'id':_0x19bede},'data':{'password':_0x5209b3}});}async[a47_0x69762f(0x1f5)](_0x11dfcd,_0xf4141e){const _0x326d35=a47_0x69762f;await this[_0x326d35(0x1f3)](_0x11dfcd);const _0x5d84fd={};_0xf4141e[_0x326d35(0x1e8)]!==undefined&&(_0x5d84fd[_0x326d35(0x214)]=_0xf4141e[_0x326d35(0x1e8)]),_0xf4141e['payment_failed']!==undefined&&(_0x5d84fd['notificationPaymentFailed']=_0xf4141e[_0x326d35(0x1fa)]),_0xf4141e['refund']!==undefined&&(_0x5d84fd[_0x326d35(0x20d)]=_0xf4141e[_0x326d35(0x1f0)]),_0xf4141e[_0x326d35(0x1e5)]!==undefined&&(_0x5d84fd[_0x326d35(0x1d6)]=_0xf4141e[_0x326d35(0x1e5)]),_0xf4141e[_0x326d35(0x212)]!==undefined&&(_0x5d84fd[_0x326d35(0x1f8)]=_0xf4141e[_0x326d35(0x212)]),_0xf4141e[_0x326d35(0x1dd)]!==undefined&&(_0x5d84fd['notificationApiError']=_0xf4141e[_0x326d35(0x1dd)]),await database_1[_0x326d35(0x1f7)][_0x326d35(0x202)][_0x326d35(0x217)]({'where':{'shopId':_0x11dfcd},'data':_0x5d84fd});}async[a47_0x69762f(0x1ee)](_0x25cea7,_0x289cd3){const _0x3fbd17=a47_0x69762f;await this[_0x3fbd17(0x1f3)](_0x25cea7);const _0x4a135a={};_0x289cd3[_0x3fbd17(0x215)]!==undefined&&(_0x4a135a[_0x3fbd17(0x1e0)]=_0x289cd3[_0x3fbd17(0x215)]||null),_0x289cd3[_0x3fbd17(0x1df)]!==undefined&&(_0x4a135a[_0x3fbd17(0x1f2)]=_0x289cd3[_0x3fbd17(0x1df)]||null),await database_1[_0x3fbd17(0x1f7)][_0x3fbd17(0x202)][_0x3fbd17(0x217)]({'where':{'shopId':_0x25cea7},'data':_0x4a135a});}async['updateWebhookSettings'](_0x434421,_0x4fb5bd){const _0x51488b=a47_0x69762f;await this['ensureSettingsExist'](_0x434421);const _0x3f3af3={};_0x4fb5bd[_0x51488b(0x205)]!==undefined&&(_0x3f3af3['webhookUrl']=_0x4fb5bd[_0x51488b(0x205)]||null),_0x4fb5bd[_0x51488b(0x201)]!==undefined&&(_0x3f3af3[_0x51488b(0x201)]=_0x4fb5bd[_0x51488b(0x201)]||[]),await database_1[_0x51488b(0x1f7)][_0x51488b(0x202)][_0x51488b(0x217)]({'where':{'shopId':_0x434421},'data':_0x3f3af3});}async[a47_0x69762f(0x204)](_0x4b1fa0){const _0x2b739b=a47_0x69762f,_0x5a96e2=_0x2b739b(0x1e4)+crypto_1[_0x2b739b(0x1f7)]['randomBytes'](0x20)[_0x2b739b(0x211)]('hex'),_0x5a7131=_0x2b739b(0x1fc)+crypto_1['default'][_0x2b739b(0x216)](0x20)['toString'](_0x2b739b(0x1f9));await database_1[_0x2b739b(0x1f7)][_0x2b739b(0x1dc)][_0x2b739b(0x217)]({'where':{'id':_0x4b1fa0},'data':{'publicKey':_0x5a96e2,'secretKey':_0x5a7131}});}async[a47_0x69762f(0x20f)](_0x31096e,_0x814b1d){const _0x422254=a47_0x69762f,{passwordConfirmation:_0x435b6c}=_0x814b1d,_0xf42e94=await database_1[_0x422254(0x1f7)]['shop'][_0x422254(0x1fb)]({'where':{'id':_0x31096e},'select':{'password':!![]}});if(!_0xf42e94)throw new Error(_0x422254(0x20e));const _0xaec724=await bcryptjs_1[_0x422254(0x1f7)][_0x422254(0x1ea)](_0x435b6c,_0xf42e94[_0x422254(0x1e9)]);if(!_0xaec724)throw new Error(_0x422254(0x1db));await database_1[_0x422254(0x1f7)][_0x422254(0x1dc)][_0x422254(0x1e3)]({'where':{'id':_0x31096e}});}async[a47_0x69762f(0x1f3)](_0x235045){const _0x1565c1=a47_0x69762f,_0x34e976=await database_1[_0x1565c1(0x1f7)][_0x1565c1(0x202)][_0x1565c1(0x1fb)]({'where':{'shopId':_0x235045}});!_0x34e976&&await database_1[_0x1565c1(0x1f7)][_0x1565c1(0x202)]['create']({'data':{'shopId':_0x235045}});}}exports[a47_0x69762f(0x210)]=SettingsService;function a47_0x571b(){const _0x37670e=['findUnique','sk_','changePassword','1001yGXazV','bcryptjs','notificationPaymentFailed','webhookEvents','shopSettings','crypto','revokeAllApiKeys','webhookUrl','130720sLxBdP','../config/database','parseWebhookEvents','length','Current\x20password\x20is\x20incorrect','notificationApiError','shopUrl','notificationRefund','Shop\x20not\x20found','deleteAccount','SettingsService','toString','login','settings','notificationPaymentSuccess','botApiKey','randomBytes','update','493615mzLwCi','substring','notificationPayout','isArray','2013704zsBgZs','686427WSgQeP','__esModule','Password\x20confirmation\x20is\x20incorrect','shop','api_error','getShopSettings','chatId','telegramBotApiKey','max','maskApiKey','delete','pk_','payout','310284hfNAiJ','734340qhmAdy','payment_success','password','compare','2004HqEPzv','parse','name','updateTelegramSettings','__importDefault','refund','defineProperty','telegramChatId','ensureSettingsExist','string','updateNotifications','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','default','notificationLogin','hex','payment_failed'];a47_0x571b=function(){return _0x37670e;};return a47_0x571b();}