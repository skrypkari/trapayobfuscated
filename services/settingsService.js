'use strict';const a64_0x23078e=a64_0x2423;(function(_0x4862ad,_0x4ed924){const _0x6a8ab5=a64_0x2423,_0x329f09=_0x4862ad();while(!![]){try{const _0x4872d7=parseInt(_0x6a8ab5(0x209))/0x1*(parseInt(_0x6a8ab5(0x1ea))/0x2)+parseInt(_0x6a8ab5(0x213))/0x3+-parseInt(_0x6a8ab5(0x217))/0x4*(-parseInt(_0x6a8ab5(0x1d5))/0x5)+parseInt(_0x6a8ab5(0x20e))/0x6+parseInt(_0x6a8ab5(0x20a))/0x7*(parseInt(_0x6a8ab5(0x1fb))/0x8)+-parseInt(_0x6a8ab5(0x202))/0x9*(parseInt(_0x6a8ab5(0x20d))/0xa)+-parseInt(_0x6a8ab5(0x1ef))/0xb*(parseInt(_0x6a8ab5(0x1f1))/0xc);if(_0x4872d7===_0x4ed924)break;else _0x329f09['push'](_0x329f09['shift']());}catch(_0x3e1f6d){_0x329f09['push'](_0x329f09['shift']());}}}(a64_0x1768,0x675c8));var __importDefault=this&&this['__importDefault']||function(_0x298a98){const _0x40cff1=a64_0x2423;return _0x298a98&&_0x298a98[_0x40cff1(0x1d4)]?_0x298a98:{'default':_0x298a98};};Object[a64_0x23078e(0x1e8)](exports,a64_0x23078e(0x1d4),{'value':!![]}),exports[a64_0x23078e(0x1d7)]=void 0x0;const bcryptjs_1=__importDefault(require(a64_0x23078e(0x1ff))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a64_0x23078e(0x206)));function a64_0x1768(){const _0x4232f6=['notificationPaymentSuccess','updateWebhookSettings','1397241VUROll','updateTelegramSettings','shopSettings','notificationPaymentFailed','../config/database','notificationPayout','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','25BgFWDR','1295QSVVXM','length','payout','50tpwbQg','1634112oPKnGi','refund','Current\x20password\x20is\x20incorrect','chatId','max','1716591hDQCND','telegramBotApiKey','deleteAccount','notificationLogin','1171624SETIoW','parseWebhookEvents','settings','botApiKey','getShopSettings','__esModule','10SWhUJy','ensureSettingsExist','SettingsService','telegramChatId','name','telegram','update','shopUrl','toString','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','password','updateNotifications','webhookEvents','login','payment_failed','isArray','string','substring','Shop\x20not\x20found','defineProperty','hex','17642rvLXsR','changePassword','webhookUrl','revokeAllApiKeys','payment_success','11dTjICz','api_error','8496636KFEtDA','hash','parse','notificationApiError','randomBytes','compare','pk_','delete','sk_','repeat','11104ElmbWf','shop','findUnique','default','bcryptjs'];a64_0x1768=function(){return _0x4232f6;};return a64_0x1768();}function a64_0x2423(_0x21f01f,_0xd84c89){const _0x176836=a64_0x1768();return a64_0x2423=function(_0x24236c,_0x4618bb){_0x24236c=_0x24236c-0x1d4;let _0x3d0dbb=_0x176836[_0x24236c];return _0x3d0dbb;},a64_0x2423(_0x21f01f,_0xd84c89);}class SettingsService{['maskApiKey'](_0x4911de){const _0x484809=a64_0x23078e;if(!_0x4911de)return'';if(_0x4911de[_0x484809(0x20b)]<=0x8)return _0x4911de;const _0xf7c9d2=_0x4911de[_0x484809(0x1e6)](0x0,0x8),_0x11ff80='*'[_0x484809(0x1fa)](Math[_0x484809(0x212)](0x0,_0x4911de[_0x484809(0x20b)]-0x8));return _0xf7c9d2+_0x11ff80;}[a64_0x23078e(0x218)](_0x5361ca){const _0x2774d6=a64_0x23078e;if(!_0x5361ca)return[];if(Array[_0x2774d6(0x1e4)](_0x5361ca))return _0x5361ca;if(typeof _0x5361ca===_0x2774d6(0x1e5))try{const _0x641365=JSON[_0x2774d6(0x1f3)](_0x5361ca);return Array[_0x2774d6(0x1e4)](_0x641365)?_0x641365:[];}catch{return[];}return[];}async[a64_0x23078e(0x21b)](_0x878dba){const _0x2e3fb4=a64_0x23078e,_0x2582f1=await database_1[_0x2e3fb4(0x1fe)][_0x2e3fb4(0x1fc)]['findUnique']({'where':{'id':_0x878dba},'include':{'settings':!![]}});if(!_0x2582f1)throw new Error(_0x2e3fb4(0x1e7));let _0x137173=_0x2582f1[_0x2e3fb4(0x219)];return!_0x137173&&(_0x137173=await database_1[_0x2e3fb4(0x1fe)][_0x2e3fb4(0x204)]['create']({'data':{'shopId':_0x2582f1['id']}})),{'fullName':_0x2582f1[_0x2e3fb4(0x1d9)],'brand':_0x2582f1[_0x2e3fb4(0x1d9)],'merchantUrl':_0x2582f1[_0x2e3fb4(0x1dc)],'telegramUsername':_0x2582f1[_0x2e3fb4(0x1da)],'telegramBotApiKey':_0x137173[_0x2e3fb4(0x214)]?this['maskApiKey'](_0x137173[_0x2e3fb4(0x214)]):null,'telegramChatId':_0x137173[_0x2e3fb4(0x1d8)],'webhookUrl':_0x137173[_0x2e3fb4(0x1ec)],'webhookEvents':this[_0x2e3fb4(0x218)](_0x137173[_0x2e3fb4(0x1e1)]),'notifications':{'payment_success':_0x137173[_0x2e3fb4(0x200)],'payment_failed':_0x137173['notificationPaymentFailed'],'refund':_0x137173['notificationRefund'],'payout':_0x137173[_0x2e3fb4(0x207)],'login':_0x137173['notificationLogin'],'api_error':_0x137173[_0x2e3fb4(0x1f4)]}};}async[a64_0x23078e(0x1eb)](_0x189991,_0x4c472c){const _0x1e608f=a64_0x23078e,{currentPassword:_0x51c7b6,newPassword:_0x218898,confirmNewPassword:_0x1664d1}=_0x4c472c;if(_0x218898!==_0x1664d1)throw new Error(_0x1e608f(0x1de));if(_0x218898['length']<0x6)throw new Error(_0x1e608f(0x208));const _0x43230e=await database_1['default'][_0x1e608f(0x1fc)][_0x1e608f(0x1fd)]({'where':{'id':_0x189991},'select':{'password':!![]}});if(!_0x43230e)throw new Error(_0x1e608f(0x1e7));const _0x45fea3=await bcryptjs_1[_0x1e608f(0x1fe)]['compare'](_0x51c7b6,_0x43230e[_0x1e608f(0x1df)]);if(!_0x45fea3)throw new Error(_0x1e608f(0x210));const _0x41e036=await bcryptjs_1['default'][_0x1e608f(0x1f2)](_0x218898,0xc);await database_1[_0x1e608f(0x1fe)][_0x1e608f(0x1fc)][_0x1e608f(0x1db)]({'where':{'id':_0x189991},'data':{'password':_0x41e036}});}async[a64_0x23078e(0x1e0)](_0x2f7f19,_0x4e6a03){const _0x4e44c3=a64_0x23078e;await this[_0x4e44c3(0x1d6)](_0x2f7f19);const _0x3b49ef={};_0x4e6a03[_0x4e44c3(0x1ee)]!==undefined&&(_0x3b49ef[_0x4e44c3(0x200)]=_0x4e6a03[_0x4e44c3(0x1ee)]),_0x4e6a03[_0x4e44c3(0x1e3)]!==undefined&&(_0x3b49ef[_0x4e44c3(0x205)]=_0x4e6a03['payment_failed']),_0x4e6a03[_0x4e44c3(0x20f)]!==undefined&&(_0x3b49ef['notificationRefund']=_0x4e6a03['refund']),_0x4e6a03[_0x4e44c3(0x20c)]!==undefined&&(_0x3b49ef[_0x4e44c3(0x207)]=_0x4e6a03['payout']),_0x4e6a03[_0x4e44c3(0x1e2)]!==undefined&&(_0x3b49ef[_0x4e44c3(0x216)]=_0x4e6a03[_0x4e44c3(0x1e2)]),_0x4e6a03[_0x4e44c3(0x1f0)]!==undefined&&(_0x3b49ef[_0x4e44c3(0x1f4)]=_0x4e6a03[_0x4e44c3(0x1f0)]),await database_1[_0x4e44c3(0x1fe)]['shopSettings'][_0x4e44c3(0x1db)]({'where':{'shopId':_0x2f7f19},'data':_0x3b49ef});}async[a64_0x23078e(0x203)](_0x6bcbf,_0x282d16){const _0x247430=a64_0x23078e;await this[_0x247430(0x1d6)](_0x6bcbf);const _0x379def={};_0x282d16[_0x247430(0x21a)]!==undefined&&(_0x379def[_0x247430(0x214)]=_0x282d16[_0x247430(0x21a)]||null),_0x282d16[_0x247430(0x211)]!==undefined&&(_0x379def[_0x247430(0x1d8)]=_0x282d16[_0x247430(0x211)]||null),await database_1[_0x247430(0x1fe)]['shopSettings']['update']({'where':{'shopId':_0x6bcbf},'data':_0x379def});}async[a64_0x23078e(0x201)](_0x2db84e,_0x225d46){const _0x2dd0c7=a64_0x23078e;await this[_0x2dd0c7(0x1d6)](_0x2db84e);const _0x563410={};_0x225d46[_0x2dd0c7(0x1ec)]!==undefined&&(_0x563410['webhookUrl']=_0x225d46[_0x2dd0c7(0x1ec)]||null),_0x225d46[_0x2dd0c7(0x1e1)]!==undefined&&(_0x563410[_0x2dd0c7(0x1e1)]=_0x225d46[_0x2dd0c7(0x1e1)]||[]),await database_1['default'][_0x2dd0c7(0x204)][_0x2dd0c7(0x1db)]({'where':{'shopId':_0x2db84e},'data':_0x563410});}async[a64_0x23078e(0x1ed)](_0x27bd15){const _0x193407=a64_0x23078e,_0x4dbed7=_0x193407(0x1f7)+crypto_1[_0x193407(0x1fe)][_0x193407(0x1f5)](0x20)[_0x193407(0x1dd)](_0x193407(0x1e9)),_0x50b582=_0x193407(0x1f9)+crypto_1['default'][_0x193407(0x1f5)](0x20)[_0x193407(0x1dd)](_0x193407(0x1e9));await database_1[_0x193407(0x1fe)][_0x193407(0x1fc)][_0x193407(0x1db)]({'where':{'id':_0x27bd15},'data':{'publicKey':_0x4dbed7,'secretKey':_0x50b582}});}async[a64_0x23078e(0x215)](_0xc26a3e,_0x18ceba){const _0x562925=a64_0x23078e,{passwordConfirmation:_0x2445a1}=_0x18ceba,_0x1735ab=await database_1['default'][_0x562925(0x1fc)][_0x562925(0x1fd)]({'where':{'id':_0xc26a3e},'select':{'password':!![]}});if(!_0x1735ab)throw new Error('Shop\x20not\x20found');const _0x748bf5=await bcryptjs_1[_0x562925(0x1fe)][_0x562925(0x1f6)](_0x2445a1,_0x1735ab[_0x562925(0x1df)]);if(!_0x748bf5)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x562925(0x1fe)][_0x562925(0x1fc)][_0x562925(0x1f8)]({'where':{'id':_0xc26a3e}});}async[a64_0x23078e(0x1d6)](_0xd27a4b){const _0x59c2e7=a64_0x23078e,_0x51e5a2=await database_1[_0x59c2e7(0x1fe)]['shopSettings']['findUnique']({'where':{'shopId':_0xd27a4b}});!_0x51e5a2&&await database_1['default']['shopSettings']['create']({'data':{'shopId':_0xd27a4b}});}}exports[a64_0x23078e(0x1d7)]=SettingsService;