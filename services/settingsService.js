'use strict';const a61_0x501fc7=a61_0x23d3;(function(_0x45d95e,_0x159fe6){const _0x485b78=a61_0x23d3,_0x321a38=_0x45d95e();while(!![]){try{const _0x245340=-parseInt(_0x485b78(0x1bf))/0x1*(-parseInt(_0x485b78(0x1a7))/0x2)+parseInt(_0x485b78(0x1e9))/0x3*(parseInt(_0x485b78(0x1c3))/0x4)+parseInt(_0x485b78(0x1d4))/0x5+-parseInt(_0x485b78(0x1af))/0x6*(-parseInt(_0x485b78(0x1dd))/0x7)+parseInt(_0x485b78(0x1dc))/0x8+-parseInt(_0x485b78(0x1c6))/0x9+-parseInt(_0x485b78(0x1d8))/0xa*(parseInt(_0x485b78(0x1c7))/0xb);if(_0x245340===_0x159fe6)break;else _0x321a38['push'](_0x321a38['shift']());}catch(_0x240c9){_0x321a38['push'](_0x321a38['shift']());}}}(a61_0x1317,0x38b69));var __importDefault=this&&this[a61_0x501fc7(0x1a8)]||function(_0x2d0b72){const _0x5c63fb=a61_0x501fc7;return _0x2d0b72&&_0x2d0b72[_0x5c63fb(0x1b3)]?_0x2d0b72:{'default':_0x2d0b72};};Object['defineProperty'](exports,a61_0x501fc7(0x1b3),{'value':!![]}),exports[a61_0x501fc7(0x1d0)]=void 0x0;const bcryptjs_1=__importDefault(require(a61_0x501fc7(0x1a4))),crypto_1=__importDefault(require(a61_0x501fc7(0x1ae))),database_1=__importDefault(require(a61_0x501fc7(0x1d2)));function a61_0x1317(){const _0x27c817=['string','length','create','shopSettings','crypto','195846UowJSS','updateTelegramSettings','repeat','max','__esModule','notificationRefund','Current\x20password\x20is\x20incorrect','api_error','payment_failed','updateWebhookSettings','revokeAllApiKeys','refund','notificationPaymentSuccess','chatId','hex','deleteAccount','8591PtJjEG','login','webhookEvents','sk_','28632aRXdCy','notificationApiError','delete','3110805dinbaJ','308WDDbie','webhookUrl','notificationPayout','substring','parseWebhookEvents','getShopSettings','payment_success','randomBytes','isArray','SettingsService','telegram','../config/database','parse','2204995fGfsTh','compare','password','notificationPaymentFailed','190940gHVHMV','changePassword','telegramChatId','shopUrl','967464tQxtoU','14HfpjOO','Shop\x20not\x20found','update','notificationLogin','maskApiKey','shop','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','default','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','botApiKey','toString','findUnique','81ktNwqG','bcryptjs','telegramBotApiKey','pk_','68JRDzCW','__importDefault','ensureSettingsExist'];a61_0x1317=function(){return _0x27c817;};return a61_0x1317();}class SettingsService{['maskApiKey'](_0x1aef5b){const _0x1441d7=a61_0x501fc7;if(!_0x1aef5b)return'';if(_0x1aef5b[_0x1441d7(0x1ab)]<=0x8)return _0x1aef5b;const _0x2f7cd6=_0x1aef5b[_0x1441d7(0x1ca)](0x0,0x8),_0x3667ca='*'[_0x1441d7(0x1b1)](Math[_0x1441d7(0x1b2)](0x0,_0x1aef5b[_0x1441d7(0x1ab)]-0x8));return _0x2f7cd6+_0x3667ca;}[a61_0x501fc7(0x1cb)](_0x28172c){const _0x243675=a61_0x501fc7;if(!_0x28172c)return[];if(Array['isArray'](_0x28172c))return _0x28172c;if(typeof _0x28172c===_0x243675(0x1aa))try{const _0x59a3e9=JSON[_0x243675(0x1d3)](_0x28172c);return Array[_0x243675(0x1cf)](_0x59a3e9)?_0x59a3e9:[];}catch{return[];}return[];}async[a61_0x501fc7(0x1cc)](_0x44e413){const _0xb987d6=a61_0x501fc7,_0x22cf37=await database_1[_0xb987d6(0x1e4)]['shop'][_0xb987d6(0x1e8)]({'where':{'id':_0x44e413},'include':{'settings':!![]}});if(!_0x22cf37)throw new Error('Shop\x20not\x20found');let _0x2943ba=_0x22cf37['settings'];return!_0x2943ba&&(_0x2943ba=await database_1[_0xb987d6(0x1e4)][_0xb987d6(0x1ad)][_0xb987d6(0x1ac)]({'data':{'shopId':_0x22cf37['id']}})),{'fullName':_0x22cf37['name'],'brand':_0x22cf37['name'],'merchantUrl':_0x22cf37[_0xb987d6(0x1db)],'telegramUsername':_0x22cf37[_0xb987d6(0x1d1)],'telegramBotApiKey':_0x2943ba[_0xb987d6(0x1a5)]?this[_0xb987d6(0x1e1)](_0x2943ba['telegramBotApiKey']):null,'telegramChatId':_0x2943ba[_0xb987d6(0x1da)],'webhookUrl':_0x2943ba[_0xb987d6(0x1c8)],'webhookEvents':this[_0xb987d6(0x1cb)](_0x2943ba[_0xb987d6(0x1c1)]),'notifications':{'payment_success':_0x2943ba[_0xb987d6(0x1bb)],'payment_failed':_0x2943ba[_0xb987d6(0x1d7)],'refund':_0x2943ba[_0xb987d6(0x1b4)],'payout':_0x2943ba['notificationPayout'],'login':_0x2943ba[_0xb987d6(0x1e0)],'api_error':_0x2943ba[_0xb987d6(0x1c4)]}};}async[a61_0x501fc7(0x1d9)](_0x1ae3bc,_0x4b2046){const _0x257a71=a61_0x501fc7,{currentPassword:_0x5d8d12,newPassword:_0x2b1d4d,confirmNewPassword:_0x4c18ae}=_0x4b2046;if(_0x2b1d4d!==_0x4c18ae)throw new Error(_0x257a71(0x1e5));if(_0x2b1d4d[_0x257a71(0x1ab)]<0x6)throw new Error(_0x257a71(0x1e3));const _0x32ccef=await database_1[_0x257a71(0x1e4)][_0x257a71(0x1e2)][_0x257a71(0x1e8)]({'where':{'id':_0x1ae3bc},'select':{'password':!![]}});if(!_0x32ccef)throw new Error('Shop\x20not\x20found');const _0x499806=await bcryptjs_1[_0x257a71(0x1e4)]['compare'](_0x5d8d12,_0x32ccef[_0x257a71(0x1d6)]);if(!_0x499806)throw new Error(_0x257a71(0x1b5));const _0x57183d=await bcryptjs_1['default']['hash'](_0x2b1d4d,0xc);await database_1[_0x257a71(0x1e4)]['shop'][_0x257a71(0x1df)]({'where':{'id':_0x1ae3bc},'data':{'password':_0x57183d}});}async['updateNotifications'](_0x25f5fb,_0x514bf5){const _0x9b9cc6=a61_0x501fc7;await this[_0x9b9cc6(0x1a9)](_0x25f5fb);const _0x421115={};_0x514bf5['payment_success']!==undefined&&(_0x421115['notificationPaymentSuccess']=_0x514bf5[_0x9b9cc6(0x1cd)]),_0x514bf5[_0x9b9cc6(0x1b7)]!==undefined&&(_0x421115['notificationPaymentFailed']=_0x514bf5[_0x9b9cc6(0x1b7)]),_0x514bf5['refund']!==undefined&&(_0x421115[_0x9b9cc6(0x1b4)]=_0x514bf5[_0x9b9cc6(0x1ba)]),_0x514bf5['payout']!==undefined&&(_0x421115[_0x9b9cc6(0x1c9)]=_0x514bf5['payout']),_0x514bf5['login']!==undefined&&(_0x421115[_0x9b9cc6(0x1e0)]=_0x514bf5[_0x9b9cc6(0x1c0)]),_0x514bf5[_0x9b9cc6(0x1b6)]!==undefined&&(_0x421115[_0x9b9cc6(0x1c4)]=_0x514bf5['api_error']),await database_1[_0x9b9cc6(0x1e4)][_0x9b9cc6(0x1ad)][_0x9b9cc6(0x1df)]({'where':{'shopId':_0x25f5fb},'data':_0x421115});}async[a61_0x501fc7(0x1b0)](_0x354ce0,_0x33e9bf){const _0x56ebae=a61_0x501fc7;await this[_0x56ebae(0x1a9)](_0x354ce0);const _0x34b05c={};_0x33e9bf['botApiKey']!==undefined&&(_0x34b05c[_0x56ebae(0x1a5)]=_0x33e9bf[_0x56ebae(0x1e6)]||null),_0x33e9bf[_0x56ebae(0x1bc)]!==undefined&&(_0x34b05c[_0x56ebae(0x1da)]=_0x33e9bf['chatId']||null),await database_1[_0x56ebae(0x1e4)][_0x56ebae(0x1ad)][_0x56ebae(0x1df)]({'where':{'shopId':_0x354ce0},'data':_0x34b05c});}async[a61_0x501fc7(0x1b8)](_0xdeca3,_0x55fe31){const _0x5e6f7c=a61_0x501fc7;await this[_0x5e6f7c(0x1a9)](_0xdeca3);const _0x40f665={};_0x55fe31[_0x5e6f7c(0x1c8)]!==undefined&&(_0x40f665[_0x5e6f7c(0x1c8)]=_0x55fe31[_0x5e6f7c(0x1c8)]||null),_0x55fe31[_0x5e6f7c(0x1c1)]!==undefined&&(_0x40f665[_0x5e6f7c(0x1c1)]=_0x55fe31['webhookEvents']||[]),await database_1[_0x5e6f7c(0x1e4)]['shopSettings'][_0x5e6f7c(0x1df)]({'where':{'shopId':_0xdeca3},'data':_0x40f665});}async[a61_0x501fc7(0x1b9)](_0x51f0ff){const _0x1c184e=a61_0x501fc7,_0x3379ef=_0x1c184e(0x1a6)+crypto_1[_0x1c184e(0x1e4)]['randomBytes'](0x20)[_0x1c184e(0x1e7)]('hex'),_0x37a4a7=_0x1c184e(0x1c2)+crypto_1[_0x1c184e(0x1e4)][_0x1c184e(0x1ce)](0x20)[_0x1c184e(0x1e7)](_0x1c184e(0x1bd));await database_1[_0x1c184e(0x1e4)]['shop']['update']({'where':{'id':_0x51f0ff},'data':{'publicKey':_0x3379ef,'secretKey':_0x37a4a7}});}async[a61_0x501fc7(0x1be)](_0x49b004,_0x25af54){const _0x434993=a61_0x501fc7,{passwordConfirmation:_0x41133e}=_0x25af54,_0x2d5530=await database_1[_0x434993(0x1e4)]['shop'][_0x434993(0x1e8)]({'where':{'id':_0x49b004},'select':{'password':!![]}});if(!_0x2d5530)throw new Error(_0x434993(0x1de));const _0x25de2b=await bcryptjs_1[_0x434993(0x1e4)][_0x434993(0x1d5)](_0x41133e,_0x2d5530[_0x434993(0x1d6)]);if(!_0x25de2b)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x434993(0x1e4)]['shop'][_0x434993(0x1c5)]({'where':{'id':_0x49b004}});}async[a61_0x501fc7(0x1a9)](_0xfc001b){const _0xf69087=a61_0x501fc7,_0x590e85=await database_1['default'][_0xf69087(0x1ad)][_0xf69087(0x1e8)]({'where':{'shopId':_0xfc001b}});!_0x590e85&&await database_1['default'][_0xf69087(0x1ad)][_0xf69087(0x1ac)]({'data':{'shopId':_0xfc001b}});}}function a61_0x23d3(_0x188a4f,_0x3d8193){const _0x1317a5=a61_0x1317();return a61_0x23d3=function(_0x23d3f4,_0x4728c6){_0x23d3f4=_0x23d3f4-0x1a4;let _0x5401c8=_0x1317a5[_0x23d3f4];return _0x5401c8;},a61_0x23d3(_0x188a4f,_0x3d8193);}exports[a61_0x501fc7(0x1d0)]=SettingsService;