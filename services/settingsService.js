'use strict';const a52_0x30305d=a52_0x3d8f;(function(_0x324a5e,_0x2ae933){const _0x13f896=a52_0x3d8f,_0x136f34=_0x324a5e();while(!![]){try{const _0x3486e5=parseInt(_0x13f896(0x17e))/0x1+-parseInt(_0x13f896(0x184))/0x2+-parseInt(_0x13f896(0x179))/0x3*(parseInt(_0x13f896(0x18e))/0x4)+parseInt(_0x13f896(0x18f))/0x5*(-parseInt(_0x13f896(0x167))/0x6)+parseInt(_0x13f896(0x161))/0x7*(parseInt(_0x13f896(0x15f))/0x8)+parseInt(_0x13f896(0x191))/0x9+parseInt(_0x13f896(0x185))/0xa;if(_0x3486e5===_0x2ae933)break;else _0x136f34['push'](_0x136f34['shift']());}catch(_0x41e386){_0x136f34['push'](_0x136f34['shift']());}}}(a52_0x2c9a,0xf2a72));function a52_0x3d8f(_0x962549,_0x38a12a){const _0x2c9ab3=a52_0x2c9a();return a52_0x3d8f=function(_0x3d8f91,_0x12d1e0){_0x3d8f91=_0x3d8f91-0x158;let _0x132513=_0x2c9ab3[_0x3d8f91];return _0x132513;},a52_0x3d8f(_0x962549,_0x38a12a);}function a52_0x2c9a(){const _0x11562c=['telegram','update','refund','134534IHlacm','findUnique','deleteAccount','password','changePassword','parse','3820474KfuHrG','35009230tcgiiy','string','compare','SettingsService','updateTelegramSettings','defineProperty','bcryptjs','crypto','default','2624844ObsZJG','133555TUGsSu','notificationPayout','27306DMWNoR','repeat','../config/database','telegramChatId','ensureSettingsExist','shop','shopSettings','length','substring','maskApiKey','settings','botApiKey','updateNotifications','Shop\x20not\x20found','chatId','randomBytes','33936wWNWZU','hex','973Mnucym','webhookEvents','__esModule','notificationRefund','payment_failed','payout','150dfPDEp','sk_','api_error','notificationApiError','telegramBotApiKey','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','login','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','payment_success','name','revokeAllApiKeys','notificationLogin','webhookUrl','notificationPaymentFailed','Current\x20password\x20is\x20incorrect','notificationPaymentSuccess','create','parseWebhookEvents','3zZVDTn','pk_'];a52_0x2c9a=function(){return _0x11562c;};return a52_0x2c9a();}var __importDefault=this&&this['__importDefault']||function(_0x2449be){const _0xf78935=a52_0x3d8f;return _0x2449be&&_0x2449be[_0xf78935(0x163)]?_0x2449be:{'default':_0x2449be};};Object[a52_0x30305d(0x18a)](exports,a52_0x30305d(0x163),{'value':!![]}),exports[a52_0x30305d(0x188)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x30305d(0x18b))),crypto_1=__importDefault(require(a52_0x30305d(0x18c))),database_1=__importDefault(require(a52_0x30305d(0x193)));class SettingsService{[a52_0x30305d(0x158)](_0x5c3ffa){const _0x42af3e=a52_0x30305d;if(!_0x5c3ffa)return'';if(_0x5c3ffa['length']<=0x8)return _0x5c3ffa;const _0x534a4d=_0x5c3ffa[_0x42af3e(0x199)](0x0,0x8),_0x545d99='*'[_0x42af3e(0x192)](Math['max'](0x0,_0x5c3ffa['length']-0x8));return _0x534a4d+_0x545d99;}[a52_0x30305d(0x178)](_0x4aa325){const _0x714f3f=a52_0x30305d;if(!_0x4aa325)return[];if(Array['isArray'](_0x4aa325))return _0x4aa325;if(typeof _0x4aa325===_0x714f3f(0x186))try{const _0x1b4fe9=JSON[_0x714f3f(0x183)](_0x4aa325);return Array['isArray'](_0x1b4fe9)?_0x1b4fe9:[];}catch{return[];}return[];}async['getShopSettings'](_0x19dd81){const _0x330ac0=a52_0x30305d,_0x4681de=await database_1[_0x330ac0(0x18d)][_0x330ac0(0x196)][_0x330ac0(0x17f)]({'where':{'id':_0x19dd81},'include':{'settings':!![]}});if(!_0x4681de)throw new Error(_0x330ac0(0x15c));let _0x12d642=_0x4681de[_0x330ac0(0x159)];return!_0x12d642&&(_0x12d642=await database_1[_0x330ac0(0x18d)][_0x330ac0(0x197)][_0x330ac0(0x177)]({'data':{'shopId':_0x4681de['id']}})),{'fullName':_0x4681de['name'],'brand':_0x4681de[_0x330ac0(0x170)],'merchantUrl':_0x4681de['shopUrl'],'telegramUsername':_0x4681de[_0x330ac0(0x17b)],'telegramBotApiKey':_0x12d642[_0x330ac0(0x16b)]?this[_0x330ac0(0x158)](_0x12d642[_0x330ac0(0x16b)]):null,'telegramChatId':_0x12d642[_0x330ac0(0x194)],'webhookUrl':_0x12d642[_0x330ac0(0x173)],'webhookEvents':this[_0x330ac0(0x178)](_0x12d642[_0x330ac0(0x162)]),'notifications':{'payment_success':_0x12d642['notificationPaymentSuccess'],'payment_failed':_0x12d642[_0x330ac0(0x174)],'refund':_0x12d642['notificationRefund'],'payout':_0x12d642['notificationPayout'],'login':_0x12d642[_0x330ac0(0x172)],'api_error':_0x12d642[_0x330ac0(0x16a)]}};}async[a52_0x30305d(0x182)](_0x41f462,_0x5ea743){const _0x4c4687=a52_0x30305d,{currentPassword:_0x3504cc,newPassword:_0x41fd43,confirmNewPassword:_0xd416c8}=_0x5ea743;if(_0x41fd43!==_0xd416c8)throw new Error(_0x4c4687(0x16c));if(_0x41fd43[_0x4c4687(0x198)]<0x6)throw new Error(_0x4c4687(0x16e));const _0x67dde1=await database_1['default'][_0x4c4687(0x196)][_0x4c4687(0x17f)]({'where':{'id':_0x41f462},'select':{'password':!![]}});if(!_0x67dde1)throw new Error(_0x4c4687(0x15c));const _0x5d57c9=await bcryptjs_1[_0x4c4687(0x18d)]['compare'](_0x3504cc,_0x67dde1[_0x4c4687(0x181)]);if(!_0x5d57c9)throw new Error(_0x4c4687(0x175));const _0x148242=await bcryptjs_1[_0x4c4687(0x18d)]['hash'](_0x41fd43,0xc);await database_1[_0x4c4687(0x18d)][_0x4c4687(0x196)][_0x4c4687(0x17c)]({'where':{'id':_0x41f462},'data':{'password':_0x148242}});}async[a52_0x30305d(0x15b)](_0x1da5ac,_0x11ea63){const _0x3b9ac1=a52_0x30305d;await this[_0x3b9ac1(0x195)](_0x1da5ac);const _0x522e28={};_0x11ea63[_0x3b9ac1(0x16f)]!==undefined&&(_0x522e28[_0x3b9ac1(0x176)]=_0x11ea63[_0x3b9ac1(0x16f)]),_0x11ea63['payment_failed']!==undefined&&(_0x522e28[_0x3b9ac1(0x174)]=_0x11ea63[_0x3b9ac1(0x165)]),_0x11ea63[_0x3b9ac1(0x17d)]!==undefined&&(_0x522e28[_0x3b9ac1(0x164)]=_0x11ea63[_0x3b9ac1(0x17d)]),_0x11ea63['payout']!==undefined&&(_0x522e28[_0x3b9ac1(0x190)]=_0x11ea63[_0x3b9ac1(0x166)]),_0x11ea63['login']!==undefined&&(_0x522e28[_0x3b9ac1(0x172)]=_0x11ea63[_0x3b9ac1(0x16d)]),_0x11ea63[_0x3b9ac1(0x169)]!==undefined&&(_0x522e28[_0x3b9ac1(0x16a)]=_0x11ea63[_0x3b9ac1(0x169)]),await database_1[_0x3b9ac1(0x18d)][_0x3b9ac1(0x197)][_0x3b9ac1(0x17c)]({'where':{'shopId':_0x1da5ac},'data':_0x522e28});}async[a52_0x30305d(0x189)](_0xfe3c3d,_0x43c119){const _0x4da32d=a52_0x30305d;await this[_0x4da32d(0x195)](_0xfe3c3d);const _0xa141e8={};_0x43c119[_0x4da32d(0x15a)]!==undefined&&(_0xa141e8['telegramBotApiKey']=_0x43c119[_0x4da32d(0x15a)]||null),_0x43c119[_0x4da32d(0x15d)]!==undefined&&(_0xa141e8['telegramChatId']=_0x43c119['chatId']||null),await database_1[_0x4da32d(0x18d)][_0x4da32d(0x197)][_0x4da32d(0x17c)]({'where':{'shopId':_0xfe3c3d},'data':_0xa141e8});}async['updateWebhookSettings'](_0x329b4e,_0x34f0de){const _0x1c9109=a52_0x30305d;await this[_0x1c9109(0x195)](_0x329b4e);const _0xcd8bc0={};_0x34f0de['webhookUrl']!==undefined&&(_0xcd8bc0[_0x1c9109(0x173)]=_0x34f0de['webhookUrl']||null),_0x34f0de['webhookEvents']!==undefined&&(_0xcd8bc0[_0x1c9109(0x162)]=_0x34f0de[_0x1c9109(0x162)]||[]),await database_1[_0x1c9109(0x18d)][_0x1c9109(0x197)]['update']({'where':{'shopId':_0x329b4e},'data':_0xcd8bc0});}async[a52_0x30305d(0x171)](_0x385656){const _0x550910=a52_0x30305d,_0x3a7d26=_0x550910(0x17a)+crypto_1[_0x550910(0x18d)][_0x550910(0x15e)](0x20)['toString'](_0x550910(0x160)),_0x5bc8f6=_0x550910(0x168)+crypto_1[_0x550910(0x18d)][_0x550910(0x15e)](0x20)['toString'](_0x550910(0x160));await database_1[_0x550910(0x18d)][_0x550910(0x196)][_0x550910(0x17c)]({'where':{'id':_0x385656},'data':{'publicKey':_0x3a7d26,'secretKey':_0x5bc8f6}});}async[a52_0x30305d(0x180)](_0x2ff312,_0x12b590){const _0x151ffc=a52_0x30305d,{passwordConfirmation:_0x442b4a}=_0x12b590,_0x3c2def=await database_1[_0x151ffc(0x18d)][_0x151ffc(0x196)][_0x151ffc(0x17f)]({'where':{'id':_0x2ff312},'select':{'password':!![]}});if(!_0x3c2def)throw new Error('Shop\x20not\x20found');const _0x15e707=await bcryptjs_1[_0x151ffc(0x18d)][_0x151ffc(0x187)](_0x442b4a,_0x3c2def[_0x151ffc(0x181)]);if(!_0x15e707)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x151ffc(0x18d)][_0x151ffc(0x196)]['delete']({'where':{'id':_0x2ff312}});}async[a52_0x30305d(0x195)](_0x212a27){const _0x27126c=a52_0x30305d,_0x3d8ced=await database_1[_0x27126c(0x18d)][_0x27126c(0x197)][_0x27126c(0x17f)]({'where':{'shopId':_0x212a27}});!_0x3d8ced&&await database_1['default'][_0x27126c(0x197)][_0x27126c(0x177)]({'data':{'shopId':_0x212a27}});}}exports['SettingsService']=SettingsService;