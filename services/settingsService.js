'use strict';const a47_0x209a3c=a47_0x529f;function a47_0x529f(_0x19ddb3,_0x4082eb){const _0x13d0de=a47_0x13d0();return a47_0x529f=function(_0x529fff,_0xab6b){_0x529fff=_0x529fff-0x176;let _0x376a82=_0x13d0de[_0x529fff];return _0x376a82;},a47_0x529f(_0x19ddb3,_0x4082eb);}(function(_0x269525,_0xedc94){const _0xc5fc32=a47_0x529f,_0x1acbb6=_0x269525();while(!![]){try{const _0xf9c041=-parseInt(_0xc5fc32(0x1a8))/0x1+parseInt(_0xc5fc32(0x19c))/0x2+parseInt(_0xc5fc32(0x188))/0x3+-parseInt(_0xc5fc32(0x180))/0x4*(parseInt(_0xc5fc32(0x1a4))/0x5)+-parseInt(_0xc5fc32(0x198))/0x6+-parseInt(_0xc5fc32(0x183))/0x7*(-parseInt(_0xc5fc32(0x1aa))/0x8)+-parseInt(_0xc5fc32(0x18a))/0x9*(-parseInt(_0xc5fc32(0x1ae))/0xa);if(_0xf9c041===_0xedc94)break;else _0x1acbb6['push'](_0x1acbb6['shift']());}catch(_0x289175){_0x1acbb6['push'](_0x1acbb6['shift']());}}}(a47_0x13d0,0xda056));var __importDefault=this&&this['__importDefault']||function(_0xb9e8c3){return _0xb9e8c3&&_0xb9e8c3['__esModule']?_0xb9e8c3:{'default':_0xb9e8c3};};Object[a47_0x209a3c(0x184)](exports,a47_0x209a3c(0x178),{'value':!![]}),exports[a47_0x209a3c(0x1ab)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a47_0x209a3c(0x189))),database_1=__importDefault(require(a47_0x209a3c(0x191)));class SettingsService{[a47_0x209a3c(0x17e)](_0x58beca){const _0x5ba8f7=a47_0x209a3c;if(!_0x58beca)return'';if(_0x58beca['length']<=0x8)return _0x58beca;const _0x523f9a=_0x58beca[_0x5ba8f7(0x177)](0x0,0x8),_0x48f34d='*'[_0x5ba8f7(0x199)](Math[_0x5ba8f7(0x17a)](0x0,_0x58beca[_0x5ba8f7(0x192)]-0x8));return _0x523f9a+_0x48f34d;}[a47_0x209a3c(0x17b)](_0x34df03){const _0x355baa=a47_0x209a3c;if(!_0x34df03)return[];if(Array[_0x355baa(0x1a5)](_0x34df03))return _0x34df03;if(typeof _0x34df03===_0x355baa(0x1a1))try{const _0x1ae6d8=JSON[_0x355baa(0x19d)](_0x34df03);return Array['isArray'](_0x1ae6d8)?_0x1ae6d8:[];}catch{return[];}return[];}async['getShopSettings'](_0x7c4b43){const _0x4a86a7=a47_0x209a3c,_0x2a3e54=await database_1[_0x4a86a7(0x18e)][_0x4a86a7(0x1b2)][_0x4a86a7(0x194)]({'where':{'id':_0x7c4b43},'include':{'settings':!![]}});if(!_0x2a3e54)throw new Error('Shop\x20not\x20found');let _0x5e15c5=_0x2a3e54[_0x4a86a7(0x1ad)];return!_0x5e15c5&&(_0x5e15c5=await database_1['default'][_0x4a86a7(0x193)][_0x4a86a7(0x187)]({'data':{'shopId':_0x2a3e54['id']}})),{'fullName':_0x2a3e54[_0x4a86a7(0x1b4)],'brand':_0x2a3e54[_0x4a86a7(0x1b4)],'merchantUrl':_0x2a3e54['shopUrl'],'telegramUsername':_0x2a3e54['telegram'],'telegramBotApiKey':_0x5e15c5[_0x4a86a7(0x196)]?this[_0x4a86a7(0x17e)](_0x5e15c5[_0x4a86a7(0x196)]):null,'telegramChatId':_0x5e15c5[_0x4a86a7(0x1a9)],'webhookUrl':_0x5e15c5[_0x4a86a7(0x1b5)],'webhookEvents':this['parseWebhookEvents'](_0x5e15c5[_0x4a86a7(0x1a7)]),'notifications':{'payment_success':_0x5e15c5['notificationPaymentSuccess'],'payment_failed':_0x5e15c5[_0x4a86a7(0x176)],'refund':_0x5e15c5['notificationRefund'],'payout':_0x5e15c5[_0x4a86a7(0x17c)],'login':_0x5e15c5['notificationLogin'],'api_error':_0x5e15c5[_0x4a86a7(0x1a6)]}};}async[a47_0x209a3c(0x1af)](_0x16af72,_0x494882){const _0x2efc5a=a47_0x209a3c,{currentPassword:_0x20b103,newPassword:_0x445020,confirmNewPassword:_0x2653da}=_0x494882;if(_0x445020!==_0x2653da)throw new Error(_0x2efc5a(0x19e));if(_0x445020[_0x2efc5a(0x192)]<0x6)throw new Error(_0x2efc5a(0x186));const _0x29fd74=await database_1[_0x2efc5a(0x18e)][_0x2efc5a(0x1b2)][_0x2efc5a(0x194)]({'where':{'id':_0x16af72},'select':{'password':!![]}});if(!_0x29fd74)throw new Error('Shop\x20not\x20found');const _0x11e6f8=await bcryptjs_1['default'][_0x2efc5a(0x1a3)](_0x20b103,_0x29fd74[_0x2efc5a(0x179)]);if(!_0x11e6f8)throw new Error('Current\x20password\x20is\x20incorrect');const _0x50e818=await bcryptjs_1[_0x2efc5a(0x18e)]['hash'](_0x445020,0xc);await database_1['default'][_0x2efc5a(0x1b2)]['update']({'where':{'id':_0x16af72},'data':{'password':_0x50e818}});}async[a47_0x209a3c(0x190)](_0x176a69,_0x5877ae){const _0x397fc5=a47_0x209a3c;await this['ensureSettingsExist'](_0x176a69);const _0x59b408={};_0x5877ae[_0x397fc5(0x19b)]!==undefined&&(_0x59b408['notificationPaymentSuccess']=_0x5877ae[_0x397fc5(0x19b)]),_0x5877ae[_0x397fc5(0x17f)]!==undefined&&(_0x59b408[_0x397fc5(0x176)]=_0x5877ae['payment_failed']),_0x5877ae[_0x397fc5(0x181)]!==undefined&&(_0x59b408[_0x397fc5(0x19a)]=_0x5877ae[_0x397fc5(0x181)]),_0x5877ae[_0x397fc5(0x18f)]!==undefined&&(_0x59b408[_0x397fc5(0x17c)]=_0x5877ae[_0x397fc5(0x18f)]),_0x5877ae[_0x397fc5(0x182)]!==undefined&&(_0x59b408[_0x397fc5(0x18d)]=_0x5877ae[_0x397fc5(0x182)]),_0x5877ae[_0x397fc5(0x1a2)]!==undefined&&(_0x59b408['notificationApiError']=_0x5877ae[_0x397fc5(0x1a2)]),await database_1[_0x397fc5(0x18e)][_0x397fc5(0x193)][_0x397fc5(0x1a0)]({'where':{'shopId':_0x176a69},'data':_0x59b408});}async['updateTelegramSettings'](_0x35ded3,_0x67a676){const _0x2f9aef=a47_0x209a3c;await this['ensureSettingsExist'](_0x35ded3);const _0x1fc3d6={};_0x67a676[_0x2f9aef(0x1b1)]!==undefined&&(_0x1fc3d6[_0x2f9aef(0x196)]=_0x67a676['botApiKey']||null),_0x67a676[_0x2f9aef(0x1b0)]!==undefined&&(_0x1fc3d6['telegramChatId']=_0x67a676[_0x2f9aef(0x1b0)]||null),await database_1[_0x2f9aef(0x18e)][_0x2f9aef(0x193)][_0x2f9aef(0x1a0)]({'where':{'shopId':_0x35ded3},'data':_0x1fc3d6});}async['updateWebhookSettings'](_0x42e762,_0x1d68b7){const _0x31dfcd=a47_0x209a3c;await this[_0x31dfcd(0x17d)](_0x42e762);const _0x37c975={};_0x1d68b7[_0x31dfcd(0x1b5)]!==undefined&&(_0x37c975[_0x31dfcd(0x1b5)]=_0x1d68b7[_0x31dfcd(0x1b5)]||null),_0x1d68b7[_0x31dfcd(0x1a7)]!==undefined&&(_0x37c975['webhookEvents']=_0x1d68b7['webhookEvents']||[]),await database_1['default'][_0x31dfcd(0x193)]['update']({'where':{'shopId':_0x42e762},'data':_0x37c975});}async[a47_0x209a3c(0x19f)](_0x2f1f54){const _0xcb5a46=a47_0x209a3c,_0x5b5e23=_0xcb5a46(0x18b)+crypto_1[_0xcb5a46(0x18e)][_0xcb5a46(0x185)](0x20)[_0xcb5a46(0x197)](_0xcb5a46(0x1b3)),_0x372d74='sk_'+crypto_1[_0xcb5a46(0x18e)][_0xcb5a46(0x185)](0x20)['toString'](_0xcb5a46(0x1b3));await database_1[_0xcb5a46(0x18e)][_0xcb5a46(0x1b2)]['update']({'where':{'id':_0x2f1f54},'data':{'publicKey':_0x5b5e23,'secretKey':_0x372d74}});}async['deleteAccount'](_0x4feb35,_0x5cc2c4){const _0x27f76a=a47_0x209a3c,{passwordConfirmation:_0x1f2cd7}=_0x5cc2c4,_0x19e5eb=await database_1[_0x27f76a(0x18e)][_0x27f76a(0x1b2)][_0x27f76a(0x194)]({'where':{'id':_0x4feb35},'select':{'password':!![]}});if(!_0x19e5eb)throw new Error(_0x27f76a(0x1ac));const _0x5bc12c=await bcryptjs_1[_0x27f76a(0x18e)][_0x27f76a(0x1a3)](_0x1f2cd7,_0x19e5eb[_0x27f76a(0x179)]);if(!_0x5bc12c)throw new Error(_0x27f76a(0x195));await database_1[_0x27f76a(0x18e)][_0x27f76a(0x1b2)][_0x27f76a(0x18c)]({'where':{'id':_0x4feb35}});}async[a47_0x209a3c(0x17d)](_0x556cb6){const _0x3b5346=a47_0x209a3c,_0x4f9edb=await database_1[_0x3b5346(0x18e)][_0x3b5346(0x193)]['findUnique']({'where':{'shopId':_0x556cb6}});!_0x4f9edb&&await database_1['default'][_0x3b5346(0x193)]['create']({'data':{'shopId':_0x556cb6}});}}exports[a47_0x209a3c(0x1ab)]=SettingsService;function a47_0x13d0(){const _0x519c55=['ensureSettingsExist','maskApiKey','payment_failed','4cOtnQb','refund','login','14ZbvyaG','defineProperty','randomBytes','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','create','1183767bZIVgj','crypto','3527703LuSQGy','pk_','delete','notificationLogin','default','payout','updateNotifications','../config/database','length','shopSettings','findUnique','Password\x20confirmation\x20is\x20incorrect','telegramBotApiKey','toString','988878YotiTr','repeat','notificationRefund','payment_success','397704BQdLNS','parse','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','revokeAllApiKeys','update','string','api_error','compare','2856085WLNJDp','isArray','notificationApiError','webhookEvents','953553xEbrhw','telegramChatId','4820888qPytzS','SettingsService','Shop\x20not\x20found','settings','20VDVRFR','changePassword','chatId','botApiKey','shop','hex','name','webhookUrl','notificationPaymentFailed','substring','__esModule','password','max','parseWebhookEvents','notificationPayout'];a47_0x13d0=function(){return _0x519c55;};return a47_0x13d0();}