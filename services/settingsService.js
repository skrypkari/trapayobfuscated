'use strict';const a52_0xf4fbc=a52_0x4655;(function(_0x9a401f,_0x5ee1e1){const _0x35e3c7=a52_0x4655,_0x492fe1=_0x9a401f();while(!![]){try{const _0x3d6107=-parseInt(_0x35e3c7(0xcd))/0x1+parseInt(_0x35e3c7(0x103))/0x2*(-parseInt(_0x35e3c7(0xc5))/0x3)+parseInt(_0x35e3c7(0xea))/0x4*(-parseInt(_0x35e3c7(0xed))/0x5)+parseInt(_0x35e3c7(0xcc))/0x6+-parseInt(_0x35e3c7(0xf4))/0x7+-parseInt(_0x35e3c7(0xe8))/0x8+parseInt(_0x35e3c7(0xc8))/0x9*(parseInt(_0x35e3c7(0xe3))/0xa);if(_0x3d6107===_0x5ee1e1)break;else _0x492fe1['push'](_0x492fe1['shift']());}catch(_0x2a7f21){_0x492fe1['push'](_0x492fe1['shift']());}}}(a52_0x2e71,0xe7f1d));function a52_0x2e71(){const _0x3576ec=['webhookUrl','substring','delete','notificationPaymentFailed','updateTelegramSettings','SettingsService','getShopSettings','botApiKey','toString','changePassword','__esModule','notificationRefund','webhookEvents','122EonhyF','pk_','name','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','hash','ensureSettingsExist','payout','settings','67239VbTtGi','isArray','payment_success','26649ZzwJcV','refund','parse','update','1454598TavdCe','1660219kbkAfL','crypto','payment_failed','password','default','compare','shopSettings','revokeAllApiKeys','__importDefault','Shop\x20not\x20found','notificationLogin','randomBytes','findUnique','create','telegramBotApiKey','shopUrl','login','length','hex','chatId','notificationPaymentSuccess','parseWebhookEvents','18790utPGDG','shop','max','notificationPayout','Current\x20password\x20is\x20incorrect','11305216IHbzdZ','deleteAccount','23636yzxnXB','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','../config/database','170FINeKv','bcryptjs','repeat','sk_','string','maskApiKey','notificationApiError','1502459OgeuLj','defineProperty'];a52_0x2e71=function(){return _0x3576ec;};return a52_0x2e71();}var __importDefault=this&&this[a52_0xf4fbc(0xd5)]||function(_0x348f85){const _0x244e37=a52_0xf4fbc;return _0x348f85&&_0x348f85[_0x244e37(0x100)]?_0x348f85:{'default':_0x348f85};};Object[a52_0xf4fbc(0xf5)](exports,a52_0xf4fbc(0x100),{'value':!![]}),exports[a52_0xf4fbc(0xfb)]=void 0x0;function a52_0x4655(_0x3ba0ee,_0x57d861){const _0x2e7198=a52_0x2e71();return a52_0x4655=function(_0x4655c0,_0x40b9e3){_0x4655c0=_0x4655c0-0xc3;let _0x5bbe30=_0x2e7198[_0x4655c0];return _0x5bbe30;},a52_0x4655(_0x3ba0ee,_0x57d861);}const bcryptjs_1=__importDefault(require(a52_0xf4fbc(0xee))),crypto_1=__importDefault(require(a52_0xf4fbc(0xce))),database_1=__importDefault(require(a52_0xf4fbc(0xec)));class SettingsService{[a52_0xf4fbc(0xf2)](_0x1200f6){const _0x208ad6=a52_0xf4fbc;if(!_0x1200f6)return'';if(_0x1200f6[_0x208ad6(0xde)]<=0x8)return _0x1200f6;const _0x1de68f=_0x1200f6[_0x208ad6(0xf7)](0x0,0x8),_0x4cee38='*'[_0x208ad6(0xef)](Math[_0x208ad6(0xe5)](0x0,_0x1200f6[_0x208ad6(0xde)]-0x8));return _0x1de68f+_0x4cee38;}[a52_0xf4fbc(0xe2)](_0x57cb08){const _0x340f24=a52_0xf4fbc;if(!_0x57cb08)return[];if(Array[_0x340f24(0xc6)](_0x57cb08))return _0x57cb08;if(typeof _0x57cb08===_0x340f24(0xf1))try{const _0x3956f9=JSON[_0x340f24(0xca)](_0x57cb08);return Array[_0x340f24(0xc6)](_0x3956f9)?_0x3956f9:[];}catch{return[];}return[];}async[a52_0xf4fbc(0xfc)](_0x40e6ec){const _0xd6c6ff=a52_0xf4fbc,_0xec5c69=await database_1[_0xd6c6ff(0xd1)][_0xd6c6ff(0xe4)][_0xd6c6ff(0xd9)]({'where':{'id':_0x40e6ec},'include':{'settings':!![]}});if(!_0xec5c69)throw new Error('Shop\x20not\x20found');let _0x279c1e=_0xec5c69[_0xd6c6ff(0xc4)];return!_0x279c1e&&(_0x279c1e=await database_1[_0xd6c6ff(0xd1)][_0xd6c6ff(0xd3)][_0xd6c6ff(0xda)]({'data':{'shopId':_0xec5c69['id']}})),{'fullName':_0xec5c69[_0xd6c6ff(0x105)],'brand':_0xec5c69[_0xd6c6ff(0x105)],'merchantUrl':_0xec5c69[_0xd6c6ff(0xdc)],'telegramUsername':_0xec5c69['telegram'],'telegramBotApiKey':_0x279c1e[_0xd6c6ff(0xdb)]?this['maskApiKey'](_0x279c1e['telegramBotApiKey']):null,'telegramChatId':_0x279c1e['telegramChatId'],'webhookUrl':_0x279c1e[_0xd6c6ff(0xf6)],'webhookEvents':this[_0xd6c6ff(0xe2)](_0x279c1e['webhookEvents']),'notifications':{'payment_success':_0x279c1e['notificationPaymentSuccess'],'payment_failed':_0x279c1e['notificationPaymentFailed'],'refund':_0x279c1e[_0xd6c6ff(0x101)],'payout':_0x279c1e[_0xd6c6ff(0xe6)],'login':_0x279c1e['notificationLogin'],'api_error':_0x279c1e[_0xd6c6ff(0xf3)]}};}async[a52_0xf4fbc(0xff)](_0x3580e0,_0x227c9c){const _0x18d395=a52_0xf4fbc,{currentPassword:_0x17b9d4,newPassword:_0x4c162e,confirmNewPassword:_0x4232c0}=_0x227c9c;if(_0x4c162e!==_0x4232c0)throw new Error(_0x18d395(0xeb));if(_0x4c162e[_0x18d395(0xde)]<0x6)throw new Error(_0x18d395(0x106));const _0x46ee3a=await database_1[_0x18d395(0xd1)][_0x18d395(0xe4)][_0x18d395(0xd9)]({'where':{'id':_0x3580e0},'select':{'password':!![]}});if(!_0x46ee3a)throw new Error(_0x18d395(0xd6));const _0x24a05b=await bcryptjs_1[_0x18d395(0xd1)][_0x18d395(0xd2)](_0x17b9d4,_0x46ee3a[_0x18d395(0xd0)]);if(!_0x24a05b)throw new Error(_0x18d395(0xe7));const _0x8d3bb4=await bcryptjs_1[_0x18d395(0xd1)][_0x18d395(0x107)](_0x4c162e,0xc);await database_1[_0x18d395(0xd1)]['shop'][_0x18d395(0xcb)]({'where':{'id':_0x3580e0},'data':{'password':_0x8d3bb4}});}async['updateNotifications'](_0x2bc621,_0x5cb8f4){const _0x592071=a52_0xf4fbc;await this[_0x592071(0x108)](_0x2bc621);const _0x3cbacb={};_0x5cb8f4[_0x592071(0xc7)]!==undefined&&(_0x3cbacb[_0x592071(0xe1)]=_0x5cb8f4[_0x592071(0xc7)]),_0x5cb8f4['payment_failed']!==undefined&&(_0x3cbacb[_0x592071(0xf9)]=_0x5cb8f4[_0x592071(0xcf)]),_0x5cb8f4[_0x592071(0xc9)]!==undefined&&(_0x3cbacb[_0x592071(0x101)]=_0x5cb8f4[_0x592071(0xc9)]),_0x5cb8f4[_0x592071(0xc3)]!==undefined&&(_0x3cbacb[_0x592071(0xe6)]=_0x5cb8f4[_0x592071(0xc3)]),_0x5cb8f4[_0x592071(0xdd)]!==undefined&&(_0x3cbacb[_0x592071(0xd7)]=_0x5cb8f4['login']),_0x5cb8f4['api_error']!==undefined&&(_0x3cbacb[_0x592071(0xf3)]=_0x5cb8f4['api_error']),await database_1['default']['shopSettings'][_0x592071(0xcb)]({'where':{'shopId':_0x2bc621},'data':_0x3cbacb});}async[a52_0xf4fbc(0xfa)](_0x3d670e,_0x4679d2){const _0x3a5e11=a52_0xf4fbc;await this[_0x3a5e11(0x108)](_0x3d670e);const _0x371e29={};_0x4679d2[_0x3a5e11(0xfd)]!==undefined&&(_0x371e29[_0x3a5e11(0xdb)]=_0x4679d2[_0x3a5e11(0xfd)]||null),_0x4679d2[_0x3a5e11(0xe0)]!==undefined&&(_0x371e29['telegramChatId']=_0x4679d2[_0x3a5e11(0xe0)]||null),await database_1[_0x3a5e11(0xd1)]['shopSettings'][_0x3a5e11(0xcb)]({'where':{'shopId':_0x3d670e},'data':_0x371e29});}async['updateWebhookSettings'](_0x3ffd0c,_0xc5c1d6){const _0x13a5d3=a52_0xf4fbc;await this[_0x13a5d3(0x108)](_0x3ffd0c);const _0x4fd9ef={};_0xc5c1d6[_0x13a5d3(0xf6)]!==undefined&&(_0x4fd9ef['webhookUrl']=_0xc5c1d6[_0x13a5d3(0xf6)]||null),_0xc5c1d6[_0x13a5d3(0x102)]!==undefined&&(_0x4fd9ef[_0x13a5d3(0x102)]=_0xc5c1d6['webhookEvents']||[]),await database_1[_0x13a5d3(0xd1)][_0x13a5d3(0xd3)][_0x13a5d3(0xcb)]({'where':{'shopId':_0x3ffd0c},'data':_0x4fd9ef});}async[a52_0xf4fbc(0xd4)](_0x5b47d6){const _0x4ac188=a52_0xf4fbc,_0x3141f8=_0x4ac188(0x104)+crypto_1[_0x4ac188(0xd1)][_0x4ac188(0xd8)](0x20)[_0x4ac188(0xfe)]('hex'),_0x3ee1ca=_0x4ac188(0xf0)+crypto_1[_0x4ac188(0xd1)][_0x4ac188(0xd8)](0x20)[_0x4ac188(0xfe)](_0x4ac188(0xdf));await database_1[_0x4ac188(0xd1)][_0x4ac188(0xe4)]['update']({'where':{'id':_0x5b47d6},'data':{'publicKey':_0x3141f8,'secretKey':_0x3ee1ca}});}async[a52_0xf4fbc(0xe9)](_0x20b61e,_0x239377){const _0x4a09ec=a52_0xf4fbc,{passwordConfirmation:_0x1cb145}=_0x239377,_0x570b35=await database_1[_0x4a09ec(0xd1)][_0x4a09ec(0xe4)]['findUnique']({'where':{'id':_0x20b61e},'select':{'password':!![]}});if(!_0x570b35)throw new Error(_0x4a09ec(0xd6));const _0x235ff8=await bcryptjs_1[_0x4a09ec(0xd1)][_0x4a09ec(0xd2)](_0x1cb145,_0x570b35[_0x4a09ec(0xd0)]);if(!_0x235ff8)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x4a09ec(0xd1)][_0x4a09ec(0xe4)][_0x4a09ec(0xf8)]({'where':{'id':_0x20b61e}});}async[a52_0xf4fbc(0x108)](_0x3cac20){const _0x36e6ad=a52_0xf4fbc,_0x169d4a=await database_1[_0x36e6ad(0xd1)]['shopSettings'][_0x36e6ad(0xd9)]({'where':{'shopId':_0x3cac20}});!_0x169d4a&&await database_1[_0x36e6ad(0xd1)]['shopSettings'][_0x36e6ad(0xda)]({'data':{'shopId':_0x3cac20}});}}exports[a52_0xf4fbc(0xfb)]=SettingsService;