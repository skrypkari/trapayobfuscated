'use strict';function a50_0x5aa5(_0x3c5207,_0x4d7cb7){const _0x48fd3a=a50_0x48fd();return a50_0x5aa5=function(_0x5aa5f5,_0x228ea4){_0x5aa5f5=_0x5aa5f5-0xfa;let _0x551237=_0x48fd3a[_0x5aa5f5];return _0x551237;},a50_0x5aa5(_0x3c5207,_0x4d7cb7);}const a50_0x49bbea=a50_0x5aa5;(function(_0x5ceee6,_0x317f3c){const _0x4e7d2b=a50_0x5aa5,_0x3e5b87=_0x5ceee6();while(!![]){try{const _0x45af52=parseInt(_0x4e7d2b(0x13f))/0x1*(-parseInt(_0x4e7d2b(0x115))/0x2)+-parseInt(_0x4e7d2b(0x13e))/0x3+-parseInt(_0x4e7d2b(0x10c))/0x4+-parseInt(_0x4e7d2b(0x108))/0x5+parseInt(_0x4e7d2b(0x13d))/0x6*(parseInt(_0x4e7d2b(0x11f))/0x7)+-parseInt(_0x4e7d2b(0xfd))/0x8*(-parseInt(_0x4e7d2b(0x118))/0x9)+-parseInt(_0x4e7d2b(0x136))/0xa*(-parseInt(_0x4e7d2b(0x10b))/0xb);if(_0x45af52===_0x317f3c)break;else _0x3e5b87['push'](_0x3e5b87['shift']());}catch(_0x3f6f81){_0x3e5b87['push'](_0x3e5b87['shift']());}}}(a50_0x48fd,0x54149));function a50_0x48fd(){const _0x335554=['settings','api_error','73686dlPdYW','1913937xHAnRP','1oUCUrn','default','payment_success','updateWebhookSettings','defineProperty','max','358168oSYNSi','notificationPaymentSuccess','shop','webhookEvents','__esModule','length','revokeAllApiKeys','parse','telegramBotApiKey','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','password','471680spSFCp','pk_','notificationPaymentFailed','22veAuQr','657844eaPOmE','name','delete','bcryptjs','login','findUnique','compare','string','__importDefault','29450fJbGzp','randomBytes','webhookUrl','117VMfAjF','notificationPayout','ensureSettingsExist','Shop\x20not\x20found','update','hex','updateTelegramSettings','35WTdAuA','toString','shopSettings','telegramChatId','SettingsService','notificationLogin','deleteAccount','updateNotifications','shopUrl','payment_failed','substring','botApiKey','crypto','parseWebhookEvents','../config/database','payout','chatId','sk_','refund','maskApiKey','Current\x20password\x20is\x20incorrect','telegram','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','3062330QNcFto','hash','notificationApiError','isArray','getShopSettings'];a50_0x48fd=function(){return _0x335554;};return a50_0x48fd();}var __importDefault=this&&this[a50_0x49bbea(0x114)]||function(_0x32061b){const _0x43e365=a50_0x49bbea;return _0x32061b&&_0x32061b[_0x43e365(0x101)]?_0x32061b:{'default':_0x32061b};};Object[a50_0x49bbea(0xfb)](exports,a50_0x49bbea(0x101),{'value':!![]}),exports[a50_0x49bbea(0x123)]=void 0x0;const bcryptjs_1=__importDefault(require(a50_0x49bbea(0x10f))),crypto_1=__importDefault(require(a50_0x49bbea(0x12b))),database_1=__importDefault(require(a50_0x49bbea(0x12d)));class SettingsService{['maskApiKey'](_0x67a104){const _0x28d873=a50_0x49bbea;if(!_0x67a104)return'';if(_0x67a104[_0x28d873(0x102)]<=0x8)return _0x67a104;const _0x55ed35=_0x67a104[_0x28d873(0x129)](0x0,0x8),_0xa8532='*'['repeat'](Math[_0x28d873(0xfc)](0x0,_0x67a104[_0x28d873(0x102)]-0x8));return _0x55ed35+_0xa8532;}['parseWebhookEvents'](_0x5d43c0){const _0xa4e9f1=a50_0x49bbea;if(!_0x5d43c0)return[];if(Array[_0xa4e9f1(0x139)](_0x5d43c0))return _0x5d43c0;if(typeof _0x5d43c0===_0xa4e9f1(0x113))try{const _0x5bfc5b=JSON[_0xa4e9f1(0x104)](_0x5d43c0);return Array[_0xa4e9f1(0x139)](_0x5bfc5b)?_0x5bfc5b:[];}catch{return[];}return[];}async[a50_0x49bbea(0x13a)](_0x54af3a){const _0x573fb1=a50_0x49bbea,_0xae6134=await database_1[_0x573fb1(0x140)][_0x573fb1(0xff)][_0x573fb1(0x111)]({'where':{'id':_0x54af3a},'include':{'settings':!![]}});if(!_0xae6134)throw new Error(_0x573fb1(0x11b));let _0x4b508b=_0xae6134[_0x573fb1(0x13b)];return!_0x4b508b&&(_0x4b508b=await database_1[_0x573fb1(0x140)]['shopSettings']['create']({'data':{'shopId':_0xae6134['id']}})),{'fullName':_0xae6134[_0x573fb1(0x10d)],'brand':_0xae6134['name'],'merchantUrl':_0xae6134[_0x573fb1(0x127)],'telegramUsername':_0xae6134[_0x573fb1(0x134)],'telegramBotApiKey':_0x4b508b[_0x573fb1(0x105)]?this[_0x573fb1(0x132)](_0x4b508b['telegramBotApiKey']):null,'telegramChatId':_0x4b508b[_0x573fb1(0x122)],'webhookUrl':_0x4b508b[_0x573fb1(0x117)],'webhookEvents':this[_0x573fb1(0x12c)](_0x4b508b[_0x573fb1(0x100)]),'notifications':{'payment_success':_0x4b508b[_0x573fb1(0xfe)],'payment_failed':_0x4b508b[_0x573fb1(0x10a)],'refund':_0x4b508b['notificationRefund'],'payout':_0x4b508b['notificationPayout'],'login':_0x4b508b['notificationLogin'],'api_error':_0x4b508b[_0x573fb1(0x138)]}};}async['changePassword'](_0x28a9e1,_0x20f060){const _0xf46f4d=a50_0x49bbea,{currentPassword:_0x1c9551,newPassword:_0x4fc7c7,confirmNewPassword:_0x475e29}=_0x20f060;if(_0x4fc7c7!==_0x475e29)throw new Error(_0xf46f4d(0x135));if(_0x4fc7c7['length']<0x6)throw new Error(_0xf46f4d(0x106));const _0x25cedf=await database_1['default'][_0xf46f4d(0xff)]['findUnique']({'where':{'id':_0x28a9e1},'select':{'password':!![]}});if(!_0x25cedf)throw new Error(_0xf46f4d(0x11b));const _0x402208=await bcryptjs_1[_0xf46f4d(0x140)][_0xf46f4d(0x112)](_0x1c9551,_0x25cedf['password']);if(!_0x402208)throw new Error(_0xf46f4d(0x133));const _0x21132b=await bcryptjs_1['default'][_0xf46f4d(0x137)](_0x4fc7c7,0xc);await database_1[_0xf46f4d(0x140)][_0xf46f4d(0xff)][_0xf46f4d(0x11c)]({'where':{'id':_0x28a9e1},'data':{'password':_0x21132b}});}async[a50_0x49bbea(0x126)](_0x159763,_0x3bb304){const _0x18e162=a50_0x49bbea;await this['ensureSettingsExist'](_0x159763);const _0x274438={};_0x3bb304[_0x18e162(0x141)]!==undefined&&(_0x274438[_0x18e162(0xfe)]=_0x3bb304[_0x18e162(0x141)]),_0x3bb304[_0x18e162(0x128)]!==undefined&&(_0x274438[_0x18e162(0x10a)]=_0x3bb304['payment_failed']),_0x3bb304[_0x18e162(0x131)]!==undefined&&(_0x274438['notificationRefund']=_0x3bb304[_0x18e162(0x131)]),_0x3bb304['payout']!==undefined&&(_0x274438[_0x18e162(0x119)]=_0x3bb304[_0x18e162(0x12e)]),_0x3bb304[_0x18e162(0x110)]!==undefined&&(_0x274438[_0x18e162(0x124)]=_0x3bb304['login']),_0x3bb304[_0x18e162(0x13c)]!==undefined&&(_0x274438[_0x18e162(0x138)]=_0x3bb304[_0x18e162(0x13c)]),await database_1[_0x18e162(0x140)][_0x18e162(0x121)]['update']({'where':{'shopId':_0x159763},'data':_0x274438});}async[a50_0x49bbea(0x11e)](_0x15e7a1,_0x116ca3){const _0x26fdbf=a50_0x49bbea;await this['ensureSettingsExist'](_0x15e7a1);const _0x249fb5={};_0x116ca3[_0x26fdbf(0x12a)]!==undefined&&(_0x249fb5[_0x26fdbf(0x105)]=_0x116ca3['botApiKey']||null),_0x116ca3[_0x26fdbf(0x12f)]!==undefined&&(_0x249fb5['telegramChatId']=_0x116ca3[_0x26fdbf(0x12f)]||null),await database_1[_0x26fdbf(0x140)][_0x26fdbf(0x121)][_0x26fdbf(0x11c)]({'where':{'shopId':_0x15e7a1},'data':_0x249fb5});}async[a50_0x49bbea(0xfa)](_0x2f2c3b,_0x57785e){const _0x2cf2fd=a50_0x49bbea;await this['ensureSettingsExist'](_0x2f2c3b);const _0x17b738={};_0x57785e[_0x2cf2fd(0x117)]!==undefined&&(_0x17b738[_0x2cf2fd(0x117)]=_0x57785e[_0x2cf2fd(0x117)]||null),_0x57785e[_0x2cf2fd(0x100)]!==undefined&&(_0x17b738[_0x2cf2fd(0x100)]=_0x57785e[_0x2cf2fd(0x100)]||[]),await database_1[_0x2cf2fd(0x140)][_0x2cf2fd(0x121)][_0x2cf2fd(0x11c)]({'where':{'shopId':_0x2f2c3b},'data':_0x17b738});}async[a50_0x49bbea(0x103)](_0xf5b37d){const _0x55423b=a50_0x49bbea,_0x354157=_0x55423b(0x109)+crypto_1[_0x55423b(0x140)][_0x55423b(0x116)](0x20)[_0x55423b(0x120)](_0x55423b(0x11d)),_0x1e35d0=_0x55423b(0x130)+crypto_1['default'][_0x55423b(0x116)](0x20)[_0x55423b(0x120)](_0x55423b(0x11d));await database_1[_0x55423b(0x140)][_0x55423b(0xff)][_0x55423b(0x11c)]({'where':{'id':_0xf5b37d},'data':{'publicKey':_0x354157,'secretKey':_0x1e35d0}});}async[a50_0x49bbea(0x125)](_0x1a616d,_0x48e4d5){const _0x59b1ca=a50_0x49bbea,{passwordConfirmation:_0x2573cc}=_0x48e4d5,_0x431343=await database_1[_0x59b1ca(0x140)][_0x59b1ca(0xff)][_0x59b1ca(0x111)]({'where':{'id':_0x1a616d},'select':{'password':!![]}});if(!_0x431343)throw new Error(_0x59b1ca(0x11b));const _0x34fc9f=await bcryptjs_1[_0x59b1ca(0x140)]['compare'](_0x2573cc,_0x431343[_0x59b1ca(0x107)]);if(!_0x34fc9f)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x59b1ca(0x140)][_0x59b1ca(0xff)][_0x59b1ca(0x10e)]({'where':{'id':_0x1a616d}});}async[a50_0x49bbea(0x11a)](_0x2a9f41){const _0x2a6f1f=a50_0x49bbea,_0x1e4ba1=await database_1[_0x2a6f1f(0x140)][_0x2a6f1f(0x121)][_0x2a6f1f(0x111)]({'where':{'shopId':_0x2a9f41}});!_0x1e4ba1&&await database_1[_0x2a6f1f(0x140)]['shopSettings']['create']({'data':{'shopId':_0x2a9f41}});}}exports[a50_0x49bbea(0x123)]=SettingsService;