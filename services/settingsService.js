'use strict';const a57_0x1c2857=a57_0x1766;(function(_0x467078,_0x338b3c){const _0x30f1de=a57_0x1766,_0x196ef6=_0x467078();while(!![]){try{const _0x56cddf=-parseInt(_0x30f1de(0x209))/0x1+parseInt(_0x30f1de(0x201))/0x2+parseInt(_0x30f1de(0x211))/0x3*(-parseInt(_0x30f1de(0x1d3))/0x4)+parseInt(_0x30f1de(0x202))/0x5*(parseInt(_0x30f1de(0x20c))/0x6)+parseInt(_0x30f1de(0x1ea))/0x7+parseInt(_0x30f1de(0x1d8))/0x8+parseInt(_0x30f1de(0x1f1))/0x9*(-parseInt(_0x30f1de(0x1f7))/0xa);if(_0x56cddf===_0x338b3c)break;else _0x196ef6['push'](_0x196ef6['shift']());}catch(_0x40b236){_0x196ef6['push'](_0x196ef6['shift']());}}}(a57_0x5a84,0x75028));function a57_0x5a84(){const _0x3998dd=['revokeAllApiKeys','__esModule','112699YRaGZO','shopUrl','login','1964874cvnyMy','chatId','notificationPaymentFailed','Current\x20password\x20is\x20incorrect','crypto','1662Iwltxu','webhookEvents','__importDefault','isArray','2972lppToT','randomBytes','botApiKey','getShopSettings','refund','6091352Kthvwy','notificationLogin','create','payout','delete','updateTelegramSettings','payment_failed','shopSettings','updateWebhookSettings','ensureSettingsExist','length','repeat','SettingsService','max','sk_','Shop\x20not\x20found','shop','payment_success','5643008weUnIB','notificationPayout','telegram','compare','api_error','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','telegramBotApiKey','189SHwIZO','default','Password\x20confirmation\x20is\x20incorrect','parse','notificationApiError','toString','558710ceTlKX','hex','findUnique','notificationPaymentSuccess','maskApiKey','substring','telegramChatId','webhookUrl','password','hash','563684Kmjize','5dWvhuC','update','parseWebhookEvents','../config/database','deleteAccount'];a57_0x5a84=function(){return _0x3998dd;};return a57_0x5a84();}function a57_0x1766(_0x4646e7,_0x50ff76){const _0x5a845b=a57_0x5a84();return a57_0x1766=function(_0x17668e,_0x31a34a){_0x17668e=_0x17668e-0x1d2;let _0x45d8a4=_0x5a845b[_0x17668e];return _0x45d8a4;},a57_0x1766(_0x4646e7,_0x50ff76);}var __importDefault=this&&this[a57_0x1c2857(0x213)]||function(_0x13c08c){const _0xca5ff9=a57_0x1c2857;return _0x13c08c&&_0x13c08c[_0xca5ff9(0x208)]?_0x13c08c:{'default':_0x13c08c};};Object['defineProperty'](exports,a57_0x1c2857(0x208),{'value':!![]}),exports[a57_0x1c2857(0x1e4)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a57_0x1c2857(0x210))),database_1=__importDefault(require(a57_0x1c2857(0x205)));class SettingsService{[a57_0x1c2857(0x1fb)](_0x27dda2){const _0x4f2ecf=a57_0x1c2857;if(!_0x27dda2)return'';if(_0x27dda2[_0x4f2ecf(0x1e2)]<=0x8)return _0x27dda2;const _0x38c69c=_0x27dda2[_0x4f2ecf(0x1fc)](0x0,0x8),_0x2bee75='*'[_0x4f2ecf(0x1e3)](Math[_0x4f2ecf(0x1e5)](0x0,_0x27dda2[_0x4f2ecf(0x1e2)]-0x8));return _0x38c69c+_0x2bee75;}['parseWebhookEvents'](_0x3ccc51){const _0x4ea109=a57_0x1c2857;if(!_0x3ccc51)return[];if(Array[_0x4ea109(0x1d2)](_0x3ccc51))return _0x3ccc51;if(typeof _0x3ccc51==='string')try{const _0x17d2b2=JSON[_0x4ea109(0x1f4)](_0x3ccc51);return Array[_0x4ea109(0x1d2)](_0x17d2b2)?_0x17d2b2:[];}catch{return[];}return[];}async[a57_0x1c2857(0x1d6)](_0x3a4142){const _0x502649=a57_0x1c2857,_0x4ce3b2=await database_1[_0x502649(0x1f2)]['shop'][_0x502649(0x1f9)]({'where':{'id':_0x3a4142},'include':{'settings':!![]}});if(!_0x4ce3b2)throw new Error('Shop\x20not\x20found');let _0x22838a=_0x4ce3b2['settings'];return!_0x22838a&&(_0x22838a=await database_1[_0x502649(0x1f2)][_0x502649(0x1df)][_0x502649(0x1da)]({'data':{'shopId':_0x4ce3b2['id']}})),{'fullName':_0x4ce3b2['name'],'brand':_0x4ce3b2['name'],'merchantUrl':_0x4ce3b2[_0x502649(0x20a)],'telegramUsername':_0x4ce3b2[_0x502649(0x1ec)],'telegramBotApiKey':_0x22838a[_0x502649(0x1f0)]?this[_0x502649(0x1fb)](_0x22838a['telegramBotApiKey']):null,'telegramChatId':_0x22838a[_0x502649(0x1fd)],'webhookUrl':_0x22838a[_0x502649(0x1fe)],'webhookEvents':this[_0x502649(0x204)](_0x22838a[_0x502649(0x212)]),'notifications':{'payment_success':_0x22838a[_0x502649(0x1fa)],'payment_failed':_0x22838a[_0x502649(0x20e)],'refund':_0x22838a['notificationRefund'],'payout':_0x22838a[_0x502649(0x1eb)],'login':_0x22838a[_0x502649(0x1d9)],'api_error':_0x22838a['notificationApiError']}};}async['changePassword'](_0x315a4c,_0x2c7c82){const _0x4531b7=a57_0x1c2857,{currentPassword:_0x42c3d7,newPassword:_0x16115a,confirmNewPassword:_0x337f9c}=_0x2c7c82;if(_0x16115a!==_0x337f9c)throw new Error(_0x4531b7(0x1ef));if(_0x16115a[_0x4531b7(0x1e2)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x50ea2d=await database_1[_0x4531b7(0x1f2)][_0x4531b7(0x1e8)][_0x4531b7(0x1f9)]({'where':{'id':_0x315a4c},'select':{'password':!![]}});if(!_0x50ea2d)throw new Error(_0x4531b7(0x1e7));const _0x3965b7=await bcryptjs_1['default'][_0x4531b7(0x1ed)](_0x42c3d7,_0x50ea2d[_0x4531b7(0x1ff)]);if(!_0x3965b7)throw new Error(_0x4531b7(0x20f));const _0x2913ec=await bcryptjs_1[_0x4531b7(0x1f2)][_0x4531b7(0x200)](_0x16115a,0xc);await database_1[_0x4531b7(0x1f2)]['shop'][_0x4531b7(0x203)]({'where':{'id':_0x315a4c},'data':{'password':_0x2913ec}});}async['updateNotifications'](_0x3bc5ce,_0x260bb1){const _0x31c9f9=a57_0x1c2857;await this[_0x31c9f9(0x1e1)](_0x3bc5ce);const _0x12518a={};_0x260bb1['payment_success']!==undefined&&(_0x12518a[_0x31c9f9(0x1fa)]=_0x260bb1[_0x31c9f9(0x1e9)]),_0x260bb1[_0x31c9f9(0x1de)]!==undefined&&(_0x12518a[_0x31c9f9(0x20e)]=_0x260bb1['payment_failed']),_0x260bb1[_0x31c9f9(0x1d7)]!==undefined&&(_0x12518a['notificationRefund']=_0x260bb1[_0x31c9f9(0x1d7)]),_0x260bb1['payout']!==undefined&&(_0x12518a[_0x31c9f9(0x1eb)]=_0x260bb1[_0x31c9f9(0x1db)]),_0x260bb1[_0x31c9f9(0x20b)]!==undefined&&(_0x12518a[_0x31c9f9(0x1d9)]=_0x260bb1[_0x31c9f9(0x20b)]),_0x260bb1[_0x31c9f9(0x1ee)]!==undefined&&(_0x12518a[_0x31c9f9(0x1f5)]=_0x260bb1[_0x31c9f9(0x1ee)]),await database_1['default']['shopSettings']['update']({'where':{'shopId':_0x3bc5ce},'data':_0x12518a});}async[a57_0x1c2857(0x1dd)](_0x1cb10d,_0x398e7b){const _0x1f4909=a57_0x1c2857;await this[_0x1f4909(0x1e1)](_0x1cb10d);const _0x44a12a={};_0x398e7b[_0x1f4909(0x1d5)]!==undefined&&(_0x44a12a['telegramBotApiKey']=_0x398e7b['botApiKey']||null),_0x398e7b[_0x1f4909(0x20d)]!==undefined&&(_0x44a12a[_0x1f4909(0x1fd)]=_0x398e7b[_0x1f4909(0x20d)]||null),await database_1[_0x1f4909(0x1f2)][_0x1f4909(0x1df)][_0x1f4909(0x203)]({'where':{'shopId':_0x1cb10d},'data':_0x44a12a});}async[a57_0x1c2857(0x1e0)](_0x2b8874,_0x764aea){const _0x5b5cd6=a57_0x1c2857;await this[_0x5b5cd6(0x1e1)](_0x2b8874);const _0x19f337={};_0x764aea[_0x5b5cd6(0x1fe)]!==undefined&&(_0x19f337[_0x5b5cd6(0x1fe)]=_0x764aea['webhookUrl']||null),_0x764aea['webhookEvents']!==undefined&&(_0x19f337[_0x5b5cd6(0x212)]=_0x764aea['webhookEvents']||[]),await database_1[_0x5b5cd6(0x1f2)][_0x5b5cd6(0x1df)][_0x5b5cd6(0x203)]({'where':{'shopId':_0x2b8874},'data':_0x19f337});}async[a57_0x1c2857(0x207)](_0x450315){const _0x27fffb=a57_0x1c2857,_0x54b17e='pk_'+crypto_1[_0x27fffb(0x1f2)][_0x27fffb(0x1d4)](0x20)['toString'](_0x27fffb(0x1f8)),_0x3268e1=_0x27fffb(0x1e6)+crypto_1[_0x27fffb(0x1f2)]['randomBytes'](0x20)[_0x27fffb(0x1f6)](_0x27fffb(0x1f8));await database_1[_0x27fffb(0x1f2)]['shop'][_0x27fffb(0x203)]({'where':{'id':_0x450315},'data':{'publicKey':_0x54b17e,'secretKey':_0x3268e1}});}async[a57_0x1c2857(0x206)](_0xbfd10f,_0x28d5f6){const _0x142868=a57_0x1c2857,{passwordConfirmation:_0x12ed32}=_0x28d5f6,_0x27693c=await database_1[_0x142868(0x1f2)]['shop'][_0x142868(0x1f9)]({'where':{'id':_0xbfd10f},'select':{'password':!![]}});if(!_0x27693c)throw new Error(_0x142868(0x1e7));const _0x10de97=await bcryptjs_1[_0x142868(0x1f2)]['compare'](_0x12ed32,_0x27693c['password']);if(!_0x10de97)throw new Error(_0x142868(0x1f3));await database_1['default']['shop'][_0x142868(0x1dc)]({'where':{'id':_0xbfd10f}});}async['ensureSettingsExist'](_0x56da43){const _0x518eea=a57_0x1c2857,_0x5c33bb=await database_1['default'][_0x518eea(0x1df)][_0x518eea(0x1f9)]({'where':{'shopId':_0x56da43}});!_0x5c33bb&&await database_1[_0x518eea(0x1f2)][_0x518eea(0x1df)][_0x518eea(0x1da)]({'data':{'shopId':_0x56da43}});}}exports['SettingsService']=SettingsService;