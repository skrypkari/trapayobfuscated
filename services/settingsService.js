'use strict';const a52_0x52032f=a52_0x3bc5;(function(_0x615846,_0x5b3915){const _0x1419cc=a52_0x3bc5,_0x52a254=_0x615846();while(!![]){try{const _0x53567a=-parseInt(_0x1419cc(0xd7))/0x1*(parseInt(_0x1419cc(0xf6))/0x2)+-parseInt(_0x1419cc(0xf9))/0x3+-parseInt(_0x1419cc(0xfb))/0x4*(-parseInt(_0x1419cc(0x108))/0x5)+-parseInt(_0x1419cc(0xd9))/0x6+-parseInt(_0x1419cc(0x10a))/0x7+parseInt(_0x1419cc(0x104))/0x8+parseInt(_0x1419cc(0xe0))/0x9;if(_0x53567a===_0x5b3915)break;else _0x52a254['push'](_0x52a254['shift']());}catch(_0x5ca0bd){_0x52a254['push'](_0x52a254['shift']());}}}(a52_0x22a8,0xc64d0));var __importDefault=this&&this[a52_0x52032f(0xe5)]||function(_0x57779e){return _0x57779e&&_0x57779e['__esModule']?_0x57779e:{'default':_0x57779e};};function a52_0x3bc5(_0xe6de4f,_0x4c205b){const _0x22a849=a52_0x22a8();return a52_0x3bc5=function(_0x3bc591,_0x275739){_0x3bc591=_0x3bc591-0xd4;let _0x2efa6a=_0x22a849[_0x3bc591];return _0x2efa6a;},a52_0x3bc5(_0xe6de4f,_0x4c205b);}Object[a52_0x52032f(0xdf)](exports,a52_0x52032f(0x112),{'value':!![]}),exports[a52_0x52032f(0xdd)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x52032f(0x101))),crypto_1=__importDefault(require(a52_0x52032f(0xdb))),database_1=__importDefault(require(a52_0x52032f(0x109)));class SettingsService{[a52_0x52032f(0xe3)](_0x564fa9){const _0x2725c3=a52_0x52032f;if(!_0x564fa9)return'';if(_0x564fa9['length']<=0x8)return _0x564fa9;const _0x4583bc=_0x564fa9[_0x2725c3(0xf1)](0x0,0x8),_0x384c6f='*'['repeat'](Math[_0x2725c3(0xef)](0x0,_0x564fa9[_0x2725c3(0xf2)]-0x8));return _0x4583bc+_0x384c6f;}['parseWebhookEvents'](_0x365318){const _0x531811=a52_0x52032f;if(!_0x365318)return[];if(Array[_0x531811(0x105)](_0x365318))return _0x365318;if(typeof _0x365318==='string')try{const _0x3c3220=JSON[_0x531811(0xe8)](_0x365318);return Array[_0x531811(0x105)](_0x3c3220)?_0x3c3220:[];}catch{return[];}return[];}async[a52_0x52032f(0x10e)](_0x20c9f7){const _0x21a538=a52_0x52032f,_0x1638c5=await database_1[_0x21a538(0xfe)][_0x21a538(0xf3)][_0x21a538(0xf5)]({'where':{'id':_0x20c9f7},'include':{'settings':!![]}});if(!_0x1638c5)throw new Error(_0x21a538(0xe4));let _0x2895b3=_0x1638c5[_0x21a538(0xeb)];return!_0x2895b3&&(_0x2895b3=await database_1['default'][_0x21a538(0x106)]['create']({'data':{'shopId':_0x1638c5['id']}})),{'fullName':_0x1638c5[_0x21a538(0xd5)],'brand':_0x1638c5[_0x21a538(0xd5)],'merchantUrl':_0x1638c5['shopUrl'],'telegramUsername':_0x1638c5[_0x21a538(0x113)],'telegramBotApiKey':_0x2895b3[_0x21a538(0xfd)]?this['maskApiKey'](_0x2895b3['telegramBotApiKey']):null,'telegramChatId':_0x2895b3[_0x21a538(0xd8)],'webhookUrl':_0x2895b3[_0x21a538(0x102)],'webhookEvents':this[_0x21a538(0xf4)](_0x2895b3[_0x21a538(0xd4)]),'notifications':{'payment_success':_0x2895b3[_0x21a538(0xda)],'payment_failed':_0x2895b3[_0x21a538(0x10b)],'refund':_0x2895b3[_0x21a538(0x103)],'payout':_0x2895b3[_0x21a538(0x10c)],'login':_0x2895b3[_0x21a538(0xfa)],'api_error':_0x2895b3[_0x21a538(0x107)]}};}async[a52_0x52032f(0x100)](_0x44283e,_0x5b86cf){const _0x5ccde5=a52_0x52032f,{currentPassword:_0x4d3973,newPassword:_0x47f22c,confirmNewPassword:_0x5af4b1}=_0x5b86cf;if(_0x47f22c!==_0x5af4b1)throw new Error(_0x5ccde5(0xf0));if(_0x47f22c[_0x5ccde5(0xf2)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x559c44=await database_1[_0x5ccde5(0xfe)][_0x5ccde5(0xf3)][_0x5ccde5(0xf5)]({'where':{'id':_0x44283e},'select':{'password':!![]}});if(!_0x559c44)throw new Error(_0x5ccde5(0xe4));const _0x450926=await bcryptjs_1['default'][_0x5ccde5(0xe1)](_0x4d3973,_0x559c44[_0x5ccde5(0xea)]);if(!_0x450926)throw new Error('Current\x20password\x20is\x20incorrect');const _0x5efa65=await bcryptjs_1[_0x5ccde5(0xfe)][_0x5ccde5(0x10f)](_0x47f22c,0xc);await database_1['default'][_0x5ccde5(0xf3)][_0x5ccde5(0xff)]({'where':{'id':_0x44283e},'data':{'password':_0x5efa65}});}async[a52_0x52032f(0xf8)](_0x40dc46,_0x43ec70){const _0x3a7b2c=a52_0x52032f;await this[_0x3a7b2c(0xe2)](_0x40dc46);const _0x46f7e0={};_0x43ec70[_0x3a7b2c(0xde)]!==undefined&&(_0x46f7e0[_0x3a7b2c(0xda)]=_0x43ec70['payment_success']),_0x43ec70[_0x3a7b2c(0xe7)]!==undefined&&(_0x46f7e0[_0x3a7b2c(0x10b)]=_0x43ec70[_0x3a7b2c(0xe7)]),_0x43ec70['refund']!==undefined&&(_0x46f7e0[_0x3a7b2c(0x103)]=_0x43ec70[_0x3a7b2c(0xee)]),_0x43ec70['payout']!==undefined&&(_0x46f7e0[_0x3a7b2c(0x10c)]=_0x43ec70[_0x3a7b2c(0xf7)]),_0x43ec70['login']!==undefined&&(_0x46f7e0[_0x3a7b2c(0xfa)]=_0x43ec70['login']),_0x43ec70['api_error']!==undefined&&(_0x46f7e0[_0x3a7b2c(0x107)]=_0x43ec70[_0x3a7b2c(0xe6)]),await database_1[_0x3a7b2c(0xfe)]['shopSettings']['update']({'where':{'shopId':_0x40dc46},'data':_0x46f7e0});}async[a52_0x52032f(0xfc)](_0x143198,_0x1163eb){const _0x168073=a52_0x52032f;await this[_0x168073(0xe2)](_0x143198);const _0x3d354a={};_0x1163eb[_0x168073(0xe9)]!==undefined&&(_0x3d354a[_0x168073(0xfd)]=_0x1163eb[_0x168073(0xe9)]||null),_0x1163eb[_0x168073(0xec)]!==undefined&&(_0x3d354a[_0x168073(0xd8)]=_0x1163eb[_0x168073(0xec)]||null),await database_1[_0x168073(0xfe)][_0x168073(0x106)][_0x168073(0xff)]({'where':{'shopId':_0x143198},'data':_0x3d354a});}async['updateWebhookSettings'](_0x3cff98,_0x38a455){const _0x5df2ed=a52_0x52032f;await this[_0x5df2ed(0xe2)](_0x3cff98);const _0x1b57e3={};_0x38a455[_0x5df2ed(0x102)]!==undefined&&(_0x1b57e3[_0x5df2ed(0x102)]=_0x38a455[_0x5df2ed(0x102)]||null),_0x38a455[_0x5df2ed(0xd4)]!==undefined&&(_0x1b57e3[_0x5df2ed(0xd4)]=_0x38a455[_0x5df2ed(0xd4)]||[]),await database_1[_0x5df2ed(0xfe)][_0x5df2ed(0x106)][_0x5df2ed(0xff)]({'where':{'shopId':_0x3cff98},'data':_0x1b57e3});}async['revokeAllApiKeys'](_0x49dc11){const _0x18ab89=a52_0x52032f,_0x383dbc='pk_'+crypto_1[_0x18ab89(0xfe)][_0x18ab89(0xed)](0x20)[_0x18ab89(0xdc)]('hex'),_0x659b2f=_0x18ab89(0x110)+crypto_1[_0x18ab89(0xfe)][_0x18ab89(0xed)](0x20)['toString']('hex');await database_1[_0x18ab89(0xfe)][_0x18ab89(0xf3)]['update']({'where':{'id':_0x49dc11},'data':{'publicKey':_0x383dbc,'secretKey':_0x659b2f}});}async[a52_0x52032f(0x10d)](_0x4bd90f,_0x7cd400){const _0x200531=a52_0x52032f,{passwordConfirmation:_0x2aa9a2}=_0x7cd400,_0x24815f=await database_1[_0x200531(0xfe)][_0x200531(0xf3)][_0x200531(0xf5)]({'where':{'id':_0x4bd90f},'select':{'password':!![]}});if(!_0x24815f)throw new Error(_0x200531(0xe4));const _0x5eab40=await bcryptjs_1[_0x200531(0xfe)]['compare'](_0x2aa9a2,_0x24815f[_0x200531(0xea)]);if(!_0x5eab40)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1['default'][_0x200531(0xf3)][_0x200531(0x111)]({'where':{'id':_0x4bd90f}});}async['ensureSettingsExist'](_0x3fe7a8){const _0xa15aad=a52_0x52032f,_0x25a97a=await database_1[_0xa15aad(0xfe)]['shopSettings']['findUnique']({'where':{'shopId':_0x3fe7a8}});!_0x25a97a&&await database_1[_0xa15aad(0xfe)][_0xa15aad(0x106)][_0xa15aad(0xd6)]({'data':{'shopId':_0x3fe7a8}});}}function a52_0x22a8(){const _0x2aa9e0=['maskApiKey','Shop\x20not\x20found','__importDefault','api_error','payment_failed','parse','botApiKey','password','settings','chatId','randomBytes','refund','max','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','substring','length','shop','parseWebhookEvents','findUnique','5336vXVfJA','payout','updateNotifications','4425564DPpyWP','notificationLogin','12lTnLZK','updateTelegramSettings','telegramBotApiKey','default','update','changePassword','bcryptjs','webhookUrl','notificationRefund','8869088DBKvVN','isArray','shopSettings','notificationApiError','1263235QgfOSv','../config/database','2839361HazCoC','notificationPaymentFailed','notificationPayout','deleteAccount','getShopSettings','hash','sk_','delete','__esModule','telegram','webhookEvents','name','create','177deopkI','telegramChatId','2070348ddOLmL','notificationPaymentSuccess','crypto','toString','SettingsService','payment_success','defineProperty','14793912uhmuwA','compare','ensureSettingsExist'];a52_0x22a8=function(){return _0x2aa9e0;};return a52_0x22a8();}exports['SettingsService']=SettingsService;