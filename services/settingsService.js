'use strict';const a64_0x2c3340=a64_0x3c0f;(function(_0x25bbfa,_0x22c1c){const _0x37fc5c=a64_0x3c0f,_0x115a92=_0x25bbfa();while(!![]){try{const _0x484a3c=parseInt(_0x37fc5c(0xb4))/0x1*(parseInt(_0x37fc5c(0xf2))/0x2)+parseInt(_0x37fc5c(0xe5))/0x3+-parseInt(_0x37fc5c(0xda))/0x4+parseInt(_0x37fc5c(0xef))/0x5+parseInt(_0x37fc5c(0xdb))/0x6+-parseInt(_0x37fc5c(0xd3))/0x7*(-parseInt(_0x37fc5c(0xe8))/0x8)+-parseInt(_0x37fc5c(0xd7))/0x9*(parseInt(_0x37fc5c(0xb3))/0xa);if(_0x484a3c===_0x22c1c)break;else _0x115a92['push'](_0x115a92['shift']());}catch(_0x539468){_0x115a92['push'](_0x115a92['shift']());}}}(a64_0x3a5a,0x3da27));var __importDefault=this&&this[a64_0x2c3340(0xd9)]||function(_0x312ece){const _0xda8df1=a64_0x2c3340;return _0x312ece&&_0x312ece[_0xda8df1(0xb2)]?_0x312ece:{'default':_0x312ece};};Object[a64_0x2c3340(0xcd)](exports,a64_0x2c3340(0xb2),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a64_0x2c3340(0xf4))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a64_0x2c3340(0xc1)));class SettingsService{['maskApiKey'](_0x5543a6){const _0x366cc8=a64_0x2c3340;if(!_0x5543a6)return'';if(_0x5543a6[_0x366cc8(0xe7)]<=0x8)return _0x5543a6;const _0xe62da=_0x5543a6[_0x366cc8(0xea)](0x0,0x8),_0x46e115='*'[_0x366cc8(0xf0)](Math[_0x366cc8(0xe1)](0x0,_0x5543a6[_0x366cc8(0xe7)]-0x8));return _0xe62da+_0x46e115;}['parseWebhookEvents'](_0x174069){const _0x26c035=a64_0x2c3340;if(!_0x174069)return[];if(Array[_0x26c035(0xb5)](_0x174069))return _0x174069;if(typeof _0x174069===_0x26c035(0xee))try{const _0x2e7274=JSON[_0x26c035(0xdc)](_0x174069);return Array[_0x26c035(0xb5)](_0x2e7274)?_0x2e7274:[];}catch{return[];}return[];}async[a64_0x2c3340(0xe2)](_0x29e604){const _0x40fb78=a64_0x2c3340,_0x5a8091=await database_1[_0x40fb78(0xe3)][_0x40fb78(0xe4)][_0x40fb78(0xd4)]({'where':{'id':_0x29e604},'include':{'settings':!![]}});if(!_0x5a8091)throw new Error(_0x40fb78(0xc2));let _0x2be0cd=_0x5a8091['settings'];return!_0x2be0cd&&(_0x2be0cd=await database_1[_0x40fb78(0xe3)]['shopSettings'][_0x40fb78(0xf3)]({'data':{'shopId':_0x5a8091['id']}})),{'fullName':_0x5a8091[_0x40fb78(0xc6)],'brand':_0x5a8091[_0x40fb78(0xc6)],'merchantUrl':_0x5a8091[_0x40fb78(0xb8)],'telegramUsername':_0x5a8091[_0x40fb78(0xc5)],'telegramBotApiKey':_0x2be0cd[_0x40fb78(0xcc)]?this[_0x40fb78(0xb9)](_0x2be0cd[_0x40fb78(0xcc)]):null,'telegramChatId':_0x2be0cd[_0x40fb78(0xc7)],'webhookUrl':_0x2be0cd[_0x40fb78(0xd6)],'webhookEvents':this['parseWebhookEvents'](_0x2be0cd[_0x40fb78(0xbc)]),'notifications':{'payment_success':_0x2be0cd[_0x40fb78(0xca)],'payment_failed':_0x2be0cd[_0x40fb78(0xba)],'refund':_0x2be0cd[_0x40fb78(0xe6)],'payout':_0x2be0cd[_0x40fb78(0xc8)],'login':_0x2be0cd[_0x40fb78(0xf1)],'api_error':_0x2be0cd['notificationApiError']}};}async[a64_0x2c3340(0xeb)](_0x5225a9,_0x12edb8){const _0x11549f=a64_0x2c3340,{currentPassword:_0x1ee7d7,newPassword:_0x5464e4,confirmNewPassword:_0x46d485}=_0x12edb8;if(_0x5464e4!==_0x46d485)throw new Error(_0x11549f(0xbe));if(_0x5464e4[_0x11549f(0xe7)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x369a76=await database_1['default'][_0x11549f(0xe4)][_0x11549f(0xd4)]({'where':{'id':_0x5225a9},'select':{'password':!![]}});if(!_0x369a76)throw new Error('Shop\x20not\x20found');const _0x76eb3e=await bcryptjs_1[_0x11549f(0xe3)][_0x11549f(0xb6)](_0x1ee7d7,_0x369a76['password']);if(!_0x76eb3e)throw new Error(_0x11549f(0xe9));const _0x5f3623=await bcryptjs_1[_0x11549f(0xe3)]['hash'](_0x5464e4,0xc);await database_1[_0x11549f(0xe3)][_0x11549f(0xe4)][_0x11549f(0xdd)]({'where':{'id':_0x5225a9},'data':{'password':_0x5f3623}});}async[a64_0x2c3340(0xc3)](_0x2c8b39,_0x552f1a){const _0x367403=a64_0x2c3340;await this[_0x367403(0xce)](_0x2c8b39);const _0xd3d5c0={};_0x552f1a[_0x367403(0xd0)]!==undefined&&(_0xd3d5c0['notificationPaymentSuccess']=_0x552f1a['payment_success']),_0x552f1a['payment_failed']!==undefined&&(_0xd3d5c0[_0x367403(0xba)]=_0x552f1a[_0x367403(0xbd)]),_0x552f1a['refund']!==undefined&&(_0xd3d5c0[_0x367403(0xe6)]=_0x552f1a['refund']),_0x552f1a[_0x367403(0xe0)]!==undefined&&(_0xd3d5c0[_0x367403(0xc8)]=_0x552f1a[_0x367403(0xe0)]),_0x552f1a['login']!==undefined&&(_0xd3d5c0[_0x367403(0xf1)]=_0x552f1a['login']),_0x552f1a[_0x367403(0xed)]!==undefined&&(_0xd3d5c0[_0x367403(0xd5)]=_0x552f1a[_0x367403(0xed)]),await database_1[_0x367403(0xe3)][_0x367403(0xbf)]['update']({'where':{'shopId':_0x2c8b39},'data':_0xd3d5c0});}async[a64_0x2c3340(0xec)](_0x30417a,_0x137b33){const _0x44ad7a=a64_0x2c3340;await this['ensureSettingsExist'](_0x30417a);const _0x34f0ac={};_0x137b33['botApiKey']!==undefined&&(_0x34f0ac['telegramBotApiKey']=_0x137b33[_0x44ad7a(0xd1)]||null),_0x137b33[_0x44ad7a(0xd8)]!==undefined&&(_0x34f0ac[_0x44ad7a(0xc7)]=_0x137b33[_0x44ad7a(0xd8)]||null),await database_1['default'][_0x44ad7a(0xbf)][_0x44ad7a(0xdd)]({'where':{'shopId':_0x30417a},'data':_0x34f0ac});}async[a64_0x2c3340(0xde)](_0x12c250,_0x5be1f1){const _0x105d04=a64_0x2c3340;await this[_0x105d04(0xce)](_0x12c250);const _0x371ef3={};_0x5be1f1[_0x105d04(0xd6)]!==undefined&&(_0x371ef3[_0x105d04(0xd6)]=_0x5be1f1[_0x105d04(0xd6)]||null),_0x5be1f1['webhookEvents']!==undefined&&(_0x371ef3[_0x105d04(0xbc)]=_0x5be1f1[_0x105d04(0xbc)]||[]),await database_1['default'][_0x105d04(0xbf)][_0x105d04(0xdd)]({'where':{'shopId':_0x12c250},'data':_0x371ef3});}async[a64_0x2c3340(0xcb)](_0x5a3f3a){const _0x53f428=a64_0x2c3340,_0x239d62=_0x53f428(0xbb)+crypto_1[_0x53f428(0xe3)][_0x53f428(0xcf)](0x20)[_0x53f428(0xb7)](_0x53f428(0xdf)),_0x2f7ab0='sk_'+crypto_1['default'][_0x53f428(0xcf)](0x20)['toString']('hex');await database_1['default'][_0x53f428(0xe4)][_0x53f428(0xdd)]({'where':{'id':_0x5a3f3a},'data':{'publicKey':_0x239d62,'secretKey':_0x2f7ab0}});}async['deleteAccount'](_0x385872,_0x542087){const _0x569d19=a64_0x2c3340,{passwordConfirmation:_0x5d8f01}=_0x542087,_0x48d2de=await database_1[_0x569d19(0xe3)][_0x569d19(0xe4)]['findUnique']({'where':{'id':_0x385872},'select':{'password':!![]}});if(!_0x48d2de)throw new Error(_0x569d19(0xc2));const _0x2a5afc=await bcryptjs_1['default'][_0x569d19(0xb6)](_0x5d8f01,_0x48d2de[_0x569d19(0xc4)]);if(!_0x2a5afc)throw new Error(_0x569d19(0xc0));await database_1['default']['shop'][_0x569d19(0xd2)]({'where':{'id':_0x385872}});}async[a64_0x2c3340(0xce)](_0x30760e){const _0x22531e=a64_0x2c3340,_0x55d8ac=await database_1[_0x22531e(0xe3)][_0x22531e(0xbf)][_0x22531e(0xd4)]({'where':{'shopId':_0x30760e}});!_0x55d8ac&&await database_1[_0x22531e(0xe3)]['shopSettings'][_0x22531e(0xf3)]({'data':{'shopId':_0x30760e}});}}exports[a64_0x2c3340(0xc9)]=SettingsService;function a64_0x3c0f(_0x33bb93,_0x4e893f){const _0x3a5a2a=a64_0x3a5a();return a64_0x3c0f=function(_0x3c0f13,_0x20f9c4){_0x3c0f13=_0x3c0f13-0xb2;let _0x54cc19=_0x3a5a2a[_0x3c0f13];return _0x54cc19;},a64_0x3c0f(_0x33bb93,_0x4e893f);}function a64_0x3a5a(){const _0x3cbf82=['6hIBSwN','isArray','compare','toString','shopUrl','maskApiKey','notificationPaymentFailed','pk_','webhookEvents','payment_failed','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','shopSettings','Password\x20confirmation\x20is\x20incorrect','../config/database','Shop\x20not\x20found','updateNotifications','password','telegram','name','telegramChatId','notificationPayout','SettingsService','notificationPaymentSuccess','revokeAllApiKeys','telegramBotApiKey','defineProperty','ensureSettingsExist','randomBytes','payment_success','botApiKey','delete','679EBoZzd','findUnique','notificationApiError','webhookUrl','36TjuJUn','chatId','__importDefault','562896vuGcpw','569928ViejBX','parse','update','updateWebhookSettings','hex','payout','max','getShopSettings','default','shop','205647hGvYYC','notificationRefund','length','23704HHeVnB','Current\x20password\x20is\x20incorrect','substring','changePassword','updateTelegramSettings','api_error','string','937545AJtAtm','repeat','notificationLogin','36786mBLqrX','create','bcryptjs','__esModule','889090EjTmcV'];a64_0x3a5a=function(){return _0x3cbf82;};return a64_0x3a5a();}