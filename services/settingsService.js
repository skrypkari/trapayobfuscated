'use strict';const a47_0x1f189c=a47_0x5ccf;(function(_0x29136f,_0x26227a){const _0x514622=a47_0x5ccf,_0x3a3611=_0x29136f();while(!![]){try{const _0x11b2d5=-parseInt(_0x514622(0x18e))/0x1*(parseInt(_0x514622(0x182))/0x2)+-parseInt(_0x514622(0x16e))/0x3*(parseInt(_0x514622(0x16b))/0x4)+parseInt(_0x514622(0x195))/0x5*(parseInt(_0x514622(0x198))/0x6)+parseInt(_0x514622(0x18c))/0x7+parseInt(_0x514622(0x17c))/0x8*(parseInt(_0x514622(0x174))/0x9)+-parseInt(_0x514622(0x183))/0xa+-parseInt(_0x514622(0x19e))/0xb*(-parseInt(_0x514622(0x166))/0xc);if(_0x11b2d5===_0x26227a)break;else _0x3a3611['push'](_0x3a3611['shift']());}catch(_0x1c15e3){_0x3a3611['push'](_0x3a3611['shift']());}}}(a47_0x4f08,0x86a4c));function a47_0x4f08(){const _0x181459=['__importDefault','login','parseWebhookEvents','updateWebhookSettings','randomBytes','length','Current\x20password\x20is\x20incorrect','compare','payment_success','name','findUnique','37656aghJNX','../config/database','notificationLogin','changePassword','telegram','67524nMlVAZ','default','api_error','6EWcDpl','revokeAllApiKeys','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','notificationRefund','defineProperty','notificationPaymentFailed','845892lyrBUe','__esModule','substring','maskApiKey','webhookEvents','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','payout','notificationPayout','24lJnjue','crypto','refund','Shop\x20not\x20found','password','webhookUrl','198118FlVKjT','3002360hQvCGk','pk_','string','shop','telegramChatId','payment_failed','botApiKey','notificationPaymentSuccess','updateTelegramSettings','47817xprpga','chatId','5nVcUYi','ensureSettingsExist','shopSettings','parse','Password\x20confirmation\x20is\x20incorrect','create','getShopSettings','5oCNaoF','isArray','update','5441136ImbSXh','toString','telegramBotApiKey','sk_','bcryptjs','shopUrl','649evULiw','notificationApiError'];a47_0x4f08=function(){return _0x181459;};return a47_0x4f08();}var __importDefault=this&&this[a47_0x1f189c(0x1a0)]||function(_0xd963f){return _0xd963f&&_0xd963f['__esModule']?_0xd963f:{'default':_0xd963f};};Object[a47_0x1f189c(0x172)](exports,a47_0x1f189c(0x175),{'value':!![]}),exports['SettingsService']=void 0x0;function a47_0x5ccf(_0x2be0a1,_0x387876){const _0x4f08d6=a47_0x4f08();return a47_0x5ccf=function(_0x5ccff0,_0x2ecdeb){_0x5ccff0=_0x5ccff0-0x165;let _0x470362=_0x4f08d6[_0x5ccff0];return _0x470362;},a47_0x5ccf(_0x2be0a1,_0x387876);}const bcryptjs_1=__importDefault(require(a47_0x1f189c(0x19c))),crypto_1=__importDefault(require(a47_0x1f189c(0x17d))),database_1=__importDefault(require(a47_0x1f189c(0x167)));class SettingsService{[a47_0x1f189c(0x177)](_0xf465d2){const _0x59e806=a47_0x1f189c;if(!_0xf465d2)return'';if(_0xf465d2[_0x59e806(0x1a5)]<=0x8)return _0xf465d2;const _0x5127c9=_0xf465d2[_0x59e806(0x176)](0x0,0x8),_0x36bf1e='*'['repeat'](Math['max'](0x0,_0xf465d2[_0x59e806(0x1a5)]-0x8));return _0x5127c9+_0x36bf1e;}[a47_0x1f189c(0x1a2)](_0x5ea889){const _0x4313e6=a47_0x1f189c;if(!_0x5ea889)return[];if(Array[_0x4313e6(0x196)](_0x5ea889))return _0x5ea889;if(typeof _0x5ea889===_0x4313e6(0x185))try{const _0x191258=JSON[_0x4313e6(0x191)](_0x5ea889);return Array[_0x4313e6(0x196)](_0x191258)?_0x191258:[];}catch{return[];}return[];}async[a47_0x1f189c(0x194)](_0x553651){const _0x57d9b2=a47_0x1f189c,_0x4a614b=await database_1[_0x57d9b2(0x16c)][_0x57d9b2(0x186)]['findUnique']({'where':{'id':_0x553651},'include':{'settings':!![]}});if(!_0x4a614b)throw new Error('Shop\x20not\x20found');let _0x1539e6=_0x4a614b['settings'];return!_0x1539e6&&(_0x1539e6=await database_1[_0x57d9b2(0x16c)][_0x57d9b2(0x190)][_0x57d9b2(0x193)]({'data':{'shopId':_0x4a614b['id']}})),{'fullName':_0x4a614b['name'],'brand':_0x4a614b[_0x57d9b2(0x1a9)],'merchantUrl':_0x4a614b[_0x57d9b2(0x19d)],'telegramUsername':_0x4a614b[_0x57d9b2(0x16a)],'telegramBotApiKey':_0x1539e6[_0x57d9b2(0x19a)]?this[_0x57d9b2(0x177)](_0x1539e6[_0x57d9b2(0x19a)]):null,'telegramChatId':_0x1539e6[_0x57d9b2(0x187)],'webhookUrl':_0x1539e6[_0x57d9b2(0x181)],'webhookEvents':this[_0x57d9b2(0x1a2)](_0x1539e6['webhookEvents']),'notifications':{'payment_success':_0x1539e6['notificationPaymentSuccess'],'payment_failed':_0x1539e6[_0x57d9b2(0x173)],'refund':_0x1539e6['notificationRefund'],'payout':_0x1539e6[_0x57d9b2(0x17b)],'login':_0x1539e6[_0x57d9b2(0x168)],'api_error':_0x1539e6[_0x57d9b2(0x19f)]}};}async[a47_0x1f189c(0x169)](_0x24bd67,_0x3059ac){const _0x3151d7=a47_0x1f189c,{currentPassword:_0x1baf79,newPassword:_0x4a83d6,confirmNewPassword:_0xdfd3d8}=_0x3059ac;if(_0x4a83d6!==_0xdfd3d8)throw new Error(_0x3151d7(0x170));if(_0x4a83d6[_0x3151d7(0x1a5)]<0x6)throw new Error(_0x3151d7(0x179));const _0x26dd48=await database_1[_0x3151d7(0x16c)]['shop'][_0x3151d7(0x165)]({'where':{'id':_0x24bd67},'select':{'password':!![]}});if(!_0x26dd48)throw new Error('Shop\x20not\x20found');const _0x170290=await bcryptjs_1[_0x3151d7(0x16c)]['compare'](_0x1baf79,_0x26dd48['password']);if(!_0x170290)throw new Error(_0x3151d7(0x1a6));const _0x5cb852=await bcryptjs_1[_0x3151d7(0x16c)]['hash'](_0x4a83d6,0xc);await database_1['default'][_0x3151d7(0x186)]['update']({'where':{'id':_0x24bd67},'data':{'password':_0x5cb852}});}async['updateNotifications'](_0x2c7bd3,_0x4d30d1){const _0x393ff5=a47_0x1f189c;await this[_0x393ff5(0x18f)](_0x2c7bd3);const _0x38817d={};_0x4d30d1[_0x393ff5(0x1a8)]!==undefined&&(_0x38817d[_0x393ff5(0x18a)]=_0x4d30d1[_0x393ff5(0x1a8)]),_0x4d30d1[_0x393ff5(0x188)]!==undefined&&(_0x38817d[_0x393ff5(0x173)]=_0x4d30d1['payment_failed']),_0x4d30d1[_0x393ff5(0x17e)]!==undefined&&(_0x38817d[_0x393ff5(0x171)]=_0x4d30d1[_0x393ff5(0x17e)]),_0x4d30d1[_0x393ff5(0x17a)]!==undefined&&(_0x38817d['notificationPayout']=_0x4d30d1[_0x393ff5(0x17a)]),_0x4d30d1[_0x393ff5(0x1a1)]!==undefined&&(_0x38817d[_0x393ff5(0x168)]=_0x4d30d1['login']),_0x4d30d1[_0x393ff5(0x16d)]!==undefined&&(_0x38817d[_0x393ff5(0x19f)]=_0x4d30d1['api_error']),await database_1[_0x393ff5(0x16c)]['shopSettings'][_0x393ff5(0x197)]({'where':{'shopId':_0x2c7bd3},'data':_0x38817d});}async[a47_0x1f189c(0x18b)](_0x172a05,_0x218b4a){const _0x4a236d=a47_0x1f189c;await this[_0x4a236d(0x18f)](_0x172a05);const _0x22de6c={};_0x218b4a[_0x4a236d(0x189)]!==undefined&&(_0x22de6c[_0x4a236d(0x19a)]=_0x218b4a[_0x4a236d(0x189)]||null),_0x218b4a[_0x4a236d(0x18d)]!==undefined&&(_0x22de6c['telegramChatId']=_0x218b4a[_0x4a236d(0x18d)]||null),await database_1[_0x4a236d(0x16c)][_0x4a236d(0x190)][_0x4a236d(0x197)]({'where':{'shopId':_0x172a05},'data':_0x22de6c});}async[a47_0x1f189c(0x1a3)](_0x32e179,_0x43f59c){const _0x4220fe=a47_0x1f189c;await this[_0x4220fe(0x18f)](_0x32e179);const _0x3ff96a={};_0x43f59c[_0x4220fe(0x181)]!==undefined&&(_0x3ff96a['webhookUrl']=_0x43f59c[_0x4220fe(0x181)]||null),_0x43f59c[_0x4220fe(0x178)]!==undefined&&(_0x3ff96a['webhookEvents']=_0x43f59c[_0x4220fe(0x178)]||[]),await database_1[_0x4220fe(0x16c)][_0x4220fe(0x190)][_0x4220fe(0x197)]({'where':{'shopId':_0x32e179},'data':_0x3ff96a});}async[a47_0x1f189c(0x16f)](_0x43189c){const _0x17053b=a47_0x1f189c,_0x3205ca=_0x17053b(0x184)+crypto_1[_0x17053b(0x16c)][_0x17053b(0x1a4)](0x20)[_0x17053b(0x199)]('hex'),_0x2fe292=_0x17053b(0x19b)+crypto_1[_0x17053b(0x16c)][_0x17053b(0x1a4)](0x20)[_0x17053b(0x199)]('hex');await database_1['default'][_0x17053b(0x186)][_0x17053b(0x197)]({'where':{'id':_0x43189c},'data':{'publicKey':_0x3205ca,'secretKey':_0x2fe292}});}async['deleteAccount'](_0x789b31,_0xf1daa6){const _0x10a59d=a47_0x1f189c,{passwordConfirmation:_0x2db521}=_0xf1daa6,_0xe17d1c=await database_1[_0x10a59d(0x16c)][_0x10a59d(0x186)]['findUnique']({'where':{'id':_0x789b31},'select':{'password':!![]}});if(!_0xe17d1c)throw new Error(_0x10a59d(0x17f));const _0x4855ce=await bcryptjs_1[_0x10a59d(0x16c)][_0x10a59d(0x1a7)](_0x2db521,_0xe17d1c[_0x10a59d(0x180)]);if(!_0x4855ce)throw new Error(_0x10a59d(0x192));await database_1[_0x10a59d(0x16c)][_0x10a59d(0x186)]['delete']({'where':{'id':_0x789b31}});}async['ensureSettingsExist'](_0x406499){const _0xc22637=a47_0x1f189c,_0x531910=await database_1[_0xc22637(0x16c)][_0xc22637(0x190)][_0xc22637(0x165)]({'where':{'shopId':_0x406499}});!_0x531910&&await database_1[_0xc22637(0x16c)][_0xc22637(0x190)][_0xc22637(0x193)]({'data':{'shopId':_0x406499}});}}exports['SettingsService']=SettingsService;