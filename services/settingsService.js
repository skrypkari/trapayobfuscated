'use strict';const a47_0x2d75ec=a47_0x5aaf;(function(_0x573e9f,_0x4765d2){const _0x46bc33=a47_0x5aaf,_0x40b155=_0x573e9f();while(!![]){try{const _0x4d95b5=parseInt(_0x46bc33(0xdb))/0x1+parseInt(_0x46bc33(0xdd))/0x2*(parseInt(_0x46bc33(0xa4))/0x3)+-parseInt(_0x46bc33(0xbe))/0x4+-parseInt(_0x46bc33(0xd1))/0x5+parseInt(_0x46bc33(0xa5))/0x6*(parseInt(_0x46bc33(0x9e))/0x7)+-parseInt(_0x46bc33(0xbb))/0x8*(-parseInt(_0x46bc33(0xbf))/0x9)+-parseInt(_0x46bc33(0xb2))/0xa*(parseInt(_0x46bc33(0xd9))/0xb);if(_0x4d95b5===_0x4765d2)break;else _0x40b155['push'](_0x40b155['shift']());}catch(_0xfe6504){_0x40b155['push'](_0x40b155['shift']());}}}(a47_0x4ed8,0x6178e));function a47_0x5aaf(_0x1299d8,_0x2f09fb){const _0x4ed8de=a47_0x4ed8();return a47_0x5aaf=function(_0x5aafc8,_0x55fd46){_0x5aafc8=_0x5aafc8-0x9a;let _0x3ce319=_0x4ed8de[_0x5aafc8];return _0x3ce319;},a47_0x5aaf(_0x1299d8,_0x2f09fb);}function a47_0x4ed8(){const _0x1dc57d=['webhookUrl','notificationLogin','max','api_error','7703090juKqxV','Shop\x20not\x20found','maskApiKey','parse','notificationPaymentFailed','updateTelegramSettings','telegramChatId','login','ensureSettingsExist','2664BOKfLM','webhookEvents','hex','2104964cjwaxd','13131DynhtA','hash','length','payout','sk_','telegram','settings','name','payment_success','botApiKey','substring','repeat','notificationPayout','compare','crypto','update','notificationRefund','telegramBotApiKey','2011500sJZwVi','create','notificationApiError','default','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','shopSettings','payment_failed','delete','11ddFnjG','pk_','760813OzyUKg','chatId','76242LrVmtw','revokeAllApiKeys','SettingsService','notificationPaymentSuccess','password','parseWebhookEvents','168oRIiSq','refund','toString','../config/database','updateNotifications','Current\x20password\x20is\x20incorrect','12SJEHjs','174738gCXXCh','defineProperty','isArray','shop','getShopSettings','randomBytes','updateWebhookSettings','changePassword','findUnique'];a47_0x4ed8=function(){return _0x1dc57d;};return a47_0x4ed8();}var __importDefault=this&&this['__importDefault']||function(_0x5432a2){return _0x5432a2&&_0x5432a2['__esModule']?_0x5432a2:{'default':_0x5432a2};};Object[a47_0x2d75ec(0xa6)](exports,'__esModule',{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a47_0x2d75ec(0xcd))),database_1=__importDefault(require(a47_0x2d75ec(0xa1)));class SettingsService{['maskApiKey'](_0x3f0b86){const _0x52082a=a47_0x2d75ec;if(!_0x3f0b86)return'';if(_0x3f0b86[_0x52082a(0xc1)]<=0x8)return _0x3f0b86;const _0x905120=_0x3f0b86[_0x52082a(0xc9)](0x0,0x8),_0x8a5b8f='*'[_0x52082a(0xca)](Math[_0x52082a(0xb0)](0x0,_0x3f0b86[_0x52082a(0xc1)]-0x8));return _0x905120+_0x8a5b8f;}[a47_0x2d75ec(0x9d)](_0xa7101d){const _0x547245=a47_0x2d75ec;if(!_0xa7101d)return[];if(Array[_0x547245(0xa7)](_0xa7101d))return _0xa7101d;if(typeof _0xa7101d==='string')try{const _0x102ef8=JSON[_0x547245(0xb5)](_0xa7101d);return Array[_0x547245(0xa7)](_0x102ef8)?_0x102ef8:[];}catch{return[];}return[];}async[a47_0x2d75ec(0xa9)](_0x15483b){const _0x8c5eb7=a47_0x2d75ec,_0x57d8b8=await database_1['default'][_0x8c5eb7(0xa8)][_0x8c5eb7(0xad)]({'where':{'id':_0x15483b},'include':{'settings':!![]}});if(!_0x57d8b8)throw new Error(_0x8c5eb7(0xb3));let _0x41101f=_0x57d8b8[_0x8c5eb7(0xc5)];return!_0x41101f&&(_0x41101f=await database_1[_0x8c5eb7(0xd4)]['shopSettings'][_0x8c5eb7(0xd2)]({'data':{'shopId':_0x57d8b8['id']}})),{'fullName':_0x57d8b8['name'],'brand':_0x57d8b8[_0x8c5eb7(0xc6)],'merchantUrl':_0x57d8b8['shopUrl'],'telegramUsername':_0x57d8b8[_0x8c5eb7(0xc4)],'telegramBotApiKey':_0x41101f['telegramBotApiKey']?this[_0x8c5eb7(0xb4)](_0x41101f[_0x8c5eb7(0xd0)]):null,'telegramChatId':_0x41101f[_0x8c5eb7(0xb8)],'webhookUrl':_0x41101f[_0x8c5eb7(0xae)],'webhookEvents':this[_0x8c5eb7(0x9d)](_0x41101f[_0x8c5eb7(0xbc)]),'notifications':{'payment_success':_0x41101f[_0x8c5eb7(0x9b)],'payment_failed':_0x41101f[_0x8c5eb7(0xb6)],'refund':_0x41101f[_0x8c5eb7(0xcf)],'payout':_0x41101f[_0x8c5eb7(0xcb)],'login':_0x41101f[_0x8c5eb7(0xaf)],'api_error':_0x41101f[_0x8c5eb7(0xd3)]}};}async[a47_0x2d75ec(0xac)](_0x180141,_0x530ae5){const _0x6337cb=a47_0x2d75ec,{currentPassword:_0x403dc7,newPassword:_0x231631,confirmNewPassword:_0x548ddf}=_0x530ae5;if(_0x231631!==_0x548ddf)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x231631[_0x6337cb(0xc1)]<0x6)throw new Error(_0x6337cb(0xd5));const _0x39d0ca=await database_1[_0x6337cb(0xd4)]['shop']['findUnique']({'where':{'id':_0x180141},'select':{'password':!![]}});if(!_0x39d0ca)throw new Error(_0x6337cb(0xb3));const _0x30dc57=await bcryptjs_1['default']['compare'](_0x403dc7,_0x39d0ca[_0x6337cb(0x9c)]);if(!_0x30dc57)throw new Error(_0x6337cb(0xa3));const _0x2c62ac=await bcryptjs_1[_0x6337cb(0xd4)][_0x6337cb(0xc0)](_0x231631,0xc);await database_1[_0x6337cb(0xd4)][_0x6337cb(0xa8)][_0x6337cb(0xce)]({'where':{'id':_0x180141},'data':{'password':_0x2c62ac}});}async[a47_0x2d75ec(0xa2)](_0x1c0631,_0x3e35cd){const _0x121fa6=a47_0x2d75ec;await this['ensureSettingsExist'](_0x1c0631);const _0x193bf2={};_0x3e35cd[_0x121fa6(0xc7)]!==undefined&&(_0x193bf2[_0x121fa6(0x9b)]=_0x3e35cd[_0x121fa6(0xc7)]),_0x3e35cd[_0x121fa6(0xd7)]!==undefined&&(_0x193bf2['notificationPaymentFailed']=_0x3e35cd[_0x121fa6(0xd7)]),_0x3e35cd[_0x121fa6(0x9f)]!==undefined&&(_0x193bf2[_0x121fa6(0xcf)]=_0x3e35cd['refund']),_0x3e35cd[_0x121fa6(0xc2)]!==undefined&&(_0x193bf2[_0x121fa6(0xcb)]=_0x3e35cd[_0x121fa6(0xc2)]),_0x3e35cd[_0x121fa6(0xb9)]!==undefined&&(_0x193bf2[_0x121fa6(0xaf)]=_0x3e35cd[_0x121fa6(0xb9)]),_0x3e35cd['api_error']!==undefined&&(_0x193bf2[_0x121fa6(0xd3)]=_0x3e35cd[_0x121fa6(0xb1)]),await database_1[_0x121fa6(0xd4)][_0x121fa6(0xd6)][_0x121fa6(0xce)]({'where':{'shopId':_0x1c0631},'data':_0x193bf2});}async[a47_0x2d75ec(0xb7)](_0x2a0237,_0x21f3f3){const _0x3495de=a47_0x2d75ec;await this[_0x3495de(0xba)](_0x2a0237);const _0x335bc6={};_0x21f3f3[_0x3495de(0xc8)]!==undefined&&(_0x335bc6['telegramBotApiKey']=_0x21f3f3[_0x3495de(0xc8)]||null),_0x21f3f3[_0x3495de(0xdc)]!==undefined&&(_0x335bc6[_0x3495de(0xb8)]=_0x21f3f3[_0x3495de(0xdc)]||null),await database_1[_0x3495de(0xd4)]['shopSettings'][_0x3495de(0xce)]({'where':{'shopId':_0x2a0237},'data':_0x335bc6});}async[a47_0x2d75ec(0xab)](_0x58c5b6,_0x338a6a){const _0x38bd95=a47_0x2d75ec;await this[_0x38bd95(0xba)](_0x58c5b6);const _0x22212a={};_0x338a6a[_0x38bd95(0xae)]!==undefined&&(_0x22212a['webhookUrl']=_0x338a6a[_0x38bd95(0xae)]||null),_0x338a6a[_0x38bd95(0xbc)]!==undefined&&(_0x22212a[_0x38bd95(0xbc)]=_0x338a6a['webhookEvents']||[]),await database_1['default']['shopSettings'][_0x38bd95(0xce)]({'where':{'shopId':_0x58c5b6},'data':_0x22212a});}async[a47_0x2d75ec(0xde)](_0x4272b5){const _0x23ca62=a47_0x2d75ec,_0x4189b4=_0x23ca62(0xda)+crypto_1[_0x23ca62(0xd4)][_0x23ca62(0xaa)](0x20)['toString'](_0x23ca62(0xbd)),_0x4ac2fb=_0x23ca62(0xc3)+crypto_1[_0x23ca62(0xd4)]['randomBytes'](0x20)[_0x23ca62(0xa0)](_0x23ca62(0xbd));await database_1[_0x23ca62(0xd4)][_0x23ca62(0xa8)][_0x23ca62(0xce)]({'where':{'id':_0x4272b5},'data':{'publicKey':_0x4189b4,'secretKey':_0x4ac2fb}});}async['deleteAccount'](_0xad6aa,_0x164548){const _0x19b5c0=a47_0x2d75ec,{passwordConfirmation:_0x118494}=_0x164548,_0x437111=await database_1['default']['shop']['findUnique']({'where':{'id':_0xad6aa},'select':{'password':!![]}});if(!_0x437111)throw new Error(_0x19b5c0(0xb3));const _0x11fbd1=await bcryptjs_1[_0x19b5c0(0xd4)][_0x19b5c0(0xcc)](_0x118494,_0x437111[_0x19b5c0(0x9c)]);if(!_0x11fbd1)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x19b5c0(0xd4)][_0x19b5c0(0xa8)][_0x19b5c0(0xd8)]({'where':{'id':_0xad6aa}});}async[a47_0x2d75ec(0xba)](_0x5805ba){const _0x3f3880=a47_0x2d75ec,_0x12dc22=await database_1[_0x3f3880(0xd4)][_0x3f3880(0xd6)][_0x3f3880(0xad)]({'where':{'shopId':_0x5805ba}});!_0x12dc22&&await database_1[_0x3f3880(0xd4)][_0x3f3880(0xd6)][_0x3f3880(0xd2)]({'data':{'shopId':_0x5805ba}});}}exports[a47_0x2d75ec(0x9a)]=SettingsService;