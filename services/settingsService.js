'use strict';const a52_0x16deda=a52_0x2447;(function(_0x158b92,_0x555a00){const _0x1e5f20=a52_0x2447,_0x4de078=_0x158b92();while(!![]){try{const _0x34470e=-parseInt(_0x1e5f20(0xb0))/0x1*(-parseInt(_0x1e5f20(0x79))/0x2)+parseInt(_0x1e5f20(0x76))/0x3*(-parseInt(_0x1e5f20(0x70))/0x4)+-parseInt(_0x1e5f20(0x98))/0x5+-parseInt(_0x1e5f20(0x83))/0x6*(-parseInt(_0x1e5f20(0x74))/0x7)+parseInt(_0x1e5f20(0x84))/0x8+parseInt(_0x1e5f20(0x8c))/0x9+-parseInt(_0x1e5f20(0x6e))/0xa*(parseInt(_0x1e5f20(0x9f))/0xb);if(_0x34470e===_0x555a00)break;else _0x4de078['push'](_0x4de078['shift']());}catch(_0x4e0218){_0x4de078['push'](_0x4de078['shift']());}}}(a52_0x3f0d,0x27f2d));function a52_0x2447(_0x58ef6e,_0x40e158){const _0x3f0dfc=a52_0x3f0d();return a52_0x2447=function(_0x24479b,_0x40c3c1){_0x24479b=_0x24479b-0x69;let _0x1a2e33=_0x3f0dfc[_0x24479b];return _0x1a2e33;},a52_0x2447(_0x58ef6e,_0x40e158);}function a52_0x3f0d(){const _0x47ea55=['chatId','botApiKey','substring','revokeAllApiKeys','194550ewxJkT','payout','notificationRefund','telegramChatId','Shop\x20not\x20found','password','repeat','91630ImiykL','parse','findUnique','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','telegramBotApiKey','deleteAccount','__importDefault','pk_','notificationApiError','changePassword','max','defineProperty','api_error','updateWebhookSettings','webhookEvents','ensureSettingsExist','notificationPaymentFailed','41444LOkaWk','string','update','hash','SettingsService','isArray','710YVTKTQ','maskApiKey','4RpIfwv','getShopSettings','shopSettings','__esModule','1646288ahsTnE','toString','753933UBRybL','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','payment_failed','14OpnERH','telegram','notificationPaymentSuccess','login','webhookUrl','../config/database','Password\x20confirmation\x20is\x20incorrect','compare','shopUrl','payment_success','6ONgphN','1727256rrhqdo','parseWebhookEvents','create','default','Current\x20password\x20is\x20incorrect','length','randomBytes','bcryptjs','2736729XkaEJS','notificationLogin','notificationPayout','shop','name','updateNotifications','refund','delete'];a52_0x3f0d=function(){return _0x47ea55;};return a52_0x3f0d();}var __importDefault=this&&this[a52_0x16deda(0xa5)]||function(_0x5eed22){const _0x492412=a52_0x16deda;return _0x5eed22&&_0x5eed22[_0x492412(0x73)]?_0x5eed22:{'default':_0x5eed22};};Object[a52_0x16deda(0xaa)](exports,'__esModule',{'value':!![]}),exports[a52_0x16deda(0x6c)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x16deda(0x8b))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a52_0x16deda(0x7e)));class SettingsService{['maskApiKey'](_0x4208a8){const _0x96a71c=a52_0x16deda;if(!_0x4208a8)return'';if(_0x4208a8['length']<=0x8)return _0x4208a8;const _0x46b26d=_0x4208a8[_0x96a71c(0x96)](0x0,0x8),_0x324c7a='*'[_0x96a71c(0x9e)](Math[_0x96a71c(0xa9)](0x0,_0x4208a8['length']-0x8));return _0x46b26d+_0x324c7a;}[a52_0x16deda(0x85)](_0x550c68){const _0x149189=a52_0x16deda;if(!_0x550c68)return[];if(Array['isArray'](_0x550c68))return _0x550c68;if(typeof _0x550c68===_0x149189(0x69))try{const _0x164713=JSON[_0x149189(0xa0)](_0x550c68);return Array[_0x149189(0x6d)](_0x164713)?_0x164713:[];}catch{return[];}return[];}async[a52_0x16deda(0x71)](_0x5668a4){const _0x10cc8a=a52_0x16deda,_0x277f4f=await database_1[_0x10cc8a(0x87)][_0x10cc8a(0x8f)][_0x10cc8a(0xa1)]({'where':{'id':_0x5668a4},'include':{'settings':!![]}});if(!_0x277f4f)throw new Error('Shop\x20not\x20found');let _0x27ba10=_0x277f4f['settings'];return!_0x27ba10&&(_0x27ba10=await database_1['default'][_0x10cc8a(0x72)][_0x10cc8a(0x86)]({'data':{'shopId':_0x277f4f['id']}})),{'fullName':_0x277f4f[_0x10cc8a(0x90)],'brand':_0x277f4f[_0x10cc8a(0x90)],'merchantUrl':_0x277f4f[_0x10cc8a(0x81)],'telegramUsername':_0x277f4f[_0x10cc8a(0x7a)],'telegramBotApiKey':_0x27ba10[_0x10cc8a(0xa3)]?this[_0x10cc8a(0x6f)](_0x27ba10[_0x10cc8a(0xa3)]):null,'telegramChatId':_0x27ba10['telegramChatId'],'webhookUrl':_0x27ba10[_0x10cc8a(0x7d)],'webhookEvents':this[_0x10cc8a(0x85)](_0x27ba10[_0x10cc8a(0xad)]),'notifications':{'payment_success':_0x27ba10[_0x10cc8a(0x7b)],'payment_failed':_0x27ba10['notificationPaymentFailed'],'refund':_0x27ba10['notificationRefund'],'payout':_0x27ba10[_0x10cc8a(0x8e)],'login':_0x27ba10[_0x10cc8a(0x8d)],'api_error':_0x27ba10[_0x10cc8a(0xa7)]}};}async[a52_0x16deda(0xa8)](_0xaa4233,_0x85d061){const _0x222cfc=a52_0x16deda,{currentPassword:_0x12f54a,newPassword:_0x2c5db8,confirmNewPassword:_0x3e1d34}=_0x85d061;if(_0x2c5db8!==_0x3e1d34)throw new Error(_0x222cfc(0xa2));if(_0x2c5db8[_0x222cfc(0x89)]<0x6)throw new Error(_0x222cfc(0x77));const _0x517688=await database_1[_0x222cfc(0x87)][_0x222cfc(0x8f)][_0x222cfc(0xa1)]({'where':{'id':_0xaa4233},'select':{'password':!![]}});if(!_0x517688)throw new Error(_0x222cfc(0x9c));const _0x7f08a7=await bcryptjs_1[_0x222cfc(0x87)][_0x222cfc(0x80)](_0x12f54a,_0x517688['password']);if(!_0x7f08a7)throw new Error(_0x222cfc(0x88));const _0x2eb0b9=await bcryptjs_1[_0x222cfc(0x87)][_0x222cfc(0x6b)](_0x2c5db8,0xc);await database_1['default'][_0x222cfc(0x8f)]['update']({'where':{'id':_0xaa4233},'data':{'password':_0x2eb0b9}});}async[a52_0x16deda(0x91)](_0x3b61d6,_0x188745){const _0x542b22=a52_0x16deda;await this[_0x542b22(0xae)](_0x3b61d6);const _0xa4cc05={};_0x188745[_0x542b22(0x82)]!==undefined&&(_0xa4cc05[_0x542b22(0x7b)]=_0x188745[_0x542b22(0x82)]),_0x188745[_0x542b22(0x78)]!==undefined&&(_0xa4cc05[_0x542b22(0xaf)]=_0x188745[_0x542b22(0x78)]),_0x188745[_0x542b22(0x92)]!==undefined&&(_0xa4cc05[_0x542b22(0x9a)]=_0x188745['refund']),_0x188745[_0x542b22(0x99)]!==undefined&&(_0xa4cc05[_0x542b22(0x8e)]=_0x188745[_0x542b22(0x99)]),_0x188745['login']!==undefined&&(_0xa4cc05[_0x542b22(0x8d)]=_0x188745[_0x542b22(0x7c)]),_0x188745[_0x542b22(0xab)]!==undefined&&(_0xa4cc05['notificationApiError']=_0x188745['api_error']),await database_1[_0x542b22(0x87)][_0x542b22(0x72)][_0x542b22(0x6a)]({'where':{'shopId':_0x3b61d6},'data':_0xa4cc05});}async['updateTelegramSettings'](_0xf3eb6e,_0x11ce54){const _0x336841=a52_0x16deda;await this[_0x336841(0xae)](_0xf3eb6e);const _0x39709c={};_0x11ce54[_0x336841(0x95)]!==undefined&&(_0x39709c[_0x336841(0xa3)]=_0x11ce54[_0x336841(0x95)]||null),_0x11ce54[_0x336841(0x94)]!==undefined&&(_0x39709c[_0x336841(0x9b)]=_0x11ce54['chatId']||null),await database_1[_0x336841(0x87)]['shopSettings'][_0x336841(0x6a)]({'where':{'shopId':_0xf3eb6e},'data':_0x39709c});}async[a52_0x16deda(0xac)](_0x3c02fd,_0x3e0f89){const _0x3ed853=a52_0x16deda;await this['ensureSettingsExist'](_0x3c02fd);const _0x3e7243={};_0x3e0f89[_0x3ed853(0x7d)]!==undefined&&(_0x3e7243[_0x3ed853(0x7d)]=_0x3e0f89[_0x3ed853(0x7d)]||null),_0x3e0f89[_0x3ed853(0xad)]!==undefined&&(_0x3e7243[_0x3ed853(0xad)]=_0x3e0f89[_0x3ed853(0xad)]||[]),await database_1[_0x3ed853(0x87)][_0x3ed853(0x72)][_0x3ed853(0x6a)]({'where':{'shopId':_0x3c02fd},'data':_0x3e7243});}async[a52_0x16deda(0x97)](_0x19fe20){const _0x5b11ad=a52_0x16deda,_0x43accb=_0x5b11ad(0xa6)+crypto_1[_0x5b11ad(0x87)][_0x5b11ad(0x8a)](0x20)['toString']('hex'),_0x8f6399='sk_'+crypto_1[_0x5b11ad(0x87)][_0x5b11ad(0x8a)](0x20)[_0x5b11ad(0x75)]('hex');await database_1[_0x5b11ad(0x87)][_0x5b11ad(0x8f)][_0x5b11ad(0x6a)]({'where':{'id':_0x19fe20},'data':{'publicKey':_0x43accb,'secretKey':_0x8f6399}});}async[a52_0x16deda(0xa4)](_0x5004dd,_0x529e17){const _0x5f5b2d=a52_0x16deda,{passwordConfirmation:_0x158448}=_0x529e17,_0x425159=await database_1[_0x5f5b2d(0x87)][_0x5f5b2d(0x8f)][_0x5f5b2d(0xa1)]({'where':{'id':_0x5004dd},'select':{'password':!![]}});if(!_0x425159)throw new Error(_0x5f5b2d(0x9c));const _0x5435f5=await bcryptjs_1[_0x5f5b2d(0x87)][_0x5f5b2d(0x80)](_0x158448,_0x425159[_0x5f5b2d(0x9d)]);if(!_0x5435f5)throw new Error(_0x5f5b2d(0x7f));await database_1[_0x5f5b2d(0x87)][_0x5f5b2d(0x8f)][_0x5f5b2d(0x93)]({'where':{'id':_0x5004dd}});}async[a52_0x16deda(0xae)](_0x12d32f){const _0x171899=a52_0x16deda,_0x37dc20=await database_1['default'][_0x171899(0x72)][_0x171899(0xa1)]({'where':{'shopId':_0x12d32f}});!_0x37dc20&&await database_1['default']['shopSettings'][_0x171899(0x86)]({'data':{'shopId':_0x12d32f}});}}exports[a52_0x16deda(0x6c)]=SettingsService;