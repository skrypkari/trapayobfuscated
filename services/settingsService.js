'use strict';const a52_0x3e953d=a52_0x4fc0;(function(_0x50ab77,_0x5ac1fa){const _0x205622=a52_0x4fc0,_0x27487c=_0x50ab77();while(!![]){try{const _0x4f6bb6=-parseInt(_0x205622(0x17c))/0x1+parseInt(_0x205622(0x18e))/0x2+-parseInt(_0x205622(0x187))/0x3+parseInt(_0x205622(0x1a1))/0x4*(parseInt(_0x205622(0x17b))/0x5)+parseInt(_0x205622(0x16c))/0x6*(-parseInt(_0x205622(0x1b1))/0x7)+-parseInt(_0x205622(0x18b))/0x8*(-parseInt(_0x205622(0x19c))/0x9)+parseInt(_0x205622(0x19f))/0xa;if(_0x4f6bb6===_0x5ac1fa)break;else _0x27487c['push'](_0x27487c['shift']());}catch(_0x170170){_0x27487c['push'](_0x27487c['shift']());}}}(a52_0x550e,0x89f34));function a52_0x4fc0(_0x8d6cbb,_0x4460c3){const _0x550ec2=a52_0x550e();return a52_0x4fc0=function(_0x4fc0e7,_0x1cd45d){_0x4fc0e7=_0x4fc0e7-0x16a;let _0x3a4cfe=_0x550ec2[_0x4fc0e7];return _0x3a4cfe;},a52_0x4fc0(_0x8d6cbb,_0x4460c3);}var __importDefault=this&&this[a52_0x3e953d(0x17f)]||function(_0x482a9d){const _0x41eb39=a52_0x3e953d;return _0x482a9d&&_0x482a9d[_0x41eb39(0x184)]?_0x482a9d:{'default':_0x482a9d};};function a52_0x550e(){const _0x141540=['notificationLogin','notificationApiError','__importDefault','create','notificationPaymentSuccess','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','chatId','__esModule','substring','settings','3219288JGhdys','name','api_error','maskApiKey','8doouvk','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','botApiKey','1244762fYmrgK','notificationPayout','length','webhookEvents','parse','notificationRefund','default','revokeAllApiKeys','Password\x20confirmation\x20is\x20incorrect','changePassword','findUnique','telegram','password','../config/database','3070206GiheFj','crypto','repeat','24344610BNRQPk','SettingsService','4yJdMDX','telegramBotApiKey','updateTelegramSettings','deleteAccount','randomBytes','ensureSettingsExist','defineProperty','payout','parseWebhookEvents','login','shopUrl','payment_success','shop','shopSettings','update','refund','433888HceNoM','webhookUrl','Shop\x20not\x20found','78XiflAG','updateNotifications','payment_failed','delete','notificationPaymentFailed','toString','telegramChatId','updateWebhookSettings','compare','hex','getShopSettings','Current\x20password\x20is\x20incorrect','hash','pk_','isArray','92845lrfvix','972613eQTVwd'];a52_0x550e=function(){return _0x141540;};return a52_0x550e();}Object[a52_0x3e953d(0x1a7)](exports,a52_0x3e953d(0x184),{'value':!![]}),exports[a52_0x3e953d(0x1a0)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a52_0x3e953d(0x19d))),database_1=__importDefault(require(a52_0x3e953d(0x19b)));class SettingsService{[a52_0x3e953d(0x18a)](_0x5b9664){const _0x590f1f=a52_0x3e953d;if(!_0x5b9664)return'';if(_0x5b9664[_0x590f1f(0x190)]<=0x8)return _0x5b9664;const _0x13e491=_0x5b9664[_0x590f1f(0x185)](0x0,0x8),_0x4b6ea4='*'[_0x590f1f(0x19e)](Math['max'](0x0,_0x5b9664['length']-0x8));return _0x13e491+_0x4b6ea4;}[a52_0x3e953d(0x1a9)](_0x5be4ff){const _0x3cc7c9=a52_0x3e953d;if(!_0x5be4ff)return[];if(Array[_0x3cc7c9(0x17a)](_0x5be4ff))return _0x5be4ff;if(typeof _0x5be4ff==='string')try{const _0x1f228e=JSON[_0x3cc7c9(0x192)](_0x5be4ff);return Array[_0x3cc7c9(0x17a)](_0x1f228e)?_0x1f228e:[];}catch{return[];}return[];}async[a52_0x3e953d(0x176)](_0x46b9ac){const _0x44467b=a52_0x3e953d,_0x13521a=await database_1['default'][_0x44467b(0x1ad)]['findUnique']({'where':{'id':_0x46b9ac},'include':{'settings':!![]}});if(!_0x13521a)throw new Error(_0x44467b(0x16b));let _0xa9d826=_0x13521a[_0x44467b(0x186)];return!_0xa9d826&&(_0xa9d826=await database_1[_0x44467b(0x194)][_0x44467b(0x1ae)][_0x44467b(0x180)]({'data':{'shopId':_0x13521a['id']}})),{'fullName':_0x13521a[_0x44467b(0x188)],'brand':_0x13521a['name'],'merchantUrl':_0x13521a[_0x44467b(0x1ab)],'telegramUsername':_0x13521a[_0x44467b(0x199)],'telegramBotApiKey':_0xa9d826[_0x44467b(0x1a2)]?this[_0x44467b(0x18a)](_0xa9d826['telegramBotApiKey']):null,'telegramChatId':_0xa9d826[_0x44467b(0x172)],'webhookUrl':_0xa9d826[_0x44467b(0x16a)],'webhookEvents':this[_0x44467b(0x1a9)](_0xa9d826[_0x44467b(0x191)]),'notifications':{'payment_success':_0xa9d826[_0x44467b(0x181)],'payment_failed':_0xa9d826[_0x44467b(0x170)],'refund':_0xa9d826['notificationRefund'],'payout':_0xa9d826[_0x44467b(0x18f)],'login':_0xa9d826[_0x44467b(0x17d)],'api_error':_0xa9d826[_0x44467b(0x17e)]}};}async[a52_0x3e953d(0x197)](_0x243861,_0x1e4a28){const _0x235a73=a52_0x3e953d,{currentPassword:_0x23139d,newPassword:_0x393c34,confirmNewPassword:_0xf0c142}=_0x1e4a28;if(_0x393c34!==_0xf0c142)throw new Error(_0x235a73(0x182));if(_0x393c34[_0x235a73(0x190)]<0x6)throw new Error(_0x235a73(0x18c));const _0x3e9e3f=await database_1[_0x235a73(0x194)][_0x235a73(0x1ad)]['findUnique']({'where':{'id':_0x243861},'select':{'password':!![]}});if(!_0x3e9e3f)throw new Error('Shop\x20not\x20found');const _0x14aa36=await bcryptjs_1[_0x235a73(0x194)][_0x235a73(0x174)](_0x23139d,_0x3e9e3f[_0x235a73(0x19a)]);if(!_0x14aa36)throw new Error(_0x235a73(0x177));const _0x179ac0=await bcryptjs_1[_0x235a73(0x194)][_0x235a73(0x178)](_0x393c34,0xc);await database_1[_0x235a73(0x194)][_0x235a73(0x1ad)][_0x235a73(0x1af)]({'where':{'id':_0x243861},'data':{'password':_0x179ac0}});}async[a52_0x3e953d(0x16d)](_0x5bd1bd,_0x54e5f2){const _0x2445be=a52_0x3e953d;await this['ensureSettingsExist'](_0x5bd1bd);const _0x42648b={};_0x54e5f2[_0x2445be(0x1ac)]!==undefined&&(_0x42648b[_0x2445be(0x181)]=_0x54e5f2[_0x2445be(0x1ac)]),_0x54e5f2['payment_failed']!==undefined&&(_0x42648b[_0x2445be(0x170)]=_0x54e5f2[_0x2445be(0x16e)]),_0x54e5f2['refund']!==undefined&&(_0x42648b[_0x2445be(0x193)]=_0x54e5f2[_0x2445be(0x1b0)]),_0x54e5f2[_0x2445be(0x1a8)]!==undefined&&(_0x42648b['notificationPayout']=_0x54e5f2[_0x2445be(0x1a8)]),_0x54e5f2[_0x2445be(0x1aa)]!==undefined&&(_0x42648b[_0x2445be(0x17d)]=_0x54e5f2[_0x2445be(0x1aa)]),_0x54e5f2[_0x2445be(0x189)]!==undefined&&(_0x42648b['notificationApiError']=_0x54e5f2['api_error']),await database_1[_0x2445be(0x194)]['shopSettings'][_0x2445be(0x1af)]({'where':{'shopId':_0x5bd1bd},'data':_0x42648b});}async[a52_0x3e953d(0x1a3)](_0x1904e1,_0x196b8f){const _0x30e9e9=a52_0x3e953d;await this[_0x30e9e9(0x1a6)](_0x1904e1);const _0x42aa72={};_0x196b8f[_0x30e9e9(0x18d)]!==undefined&&(_0x42aa72[_0x30e9e9(0x1a2)]=_0x196b8f['botApiKey']||null),_0x196b8f['chatId']!==undefined&&(_0x42aa72[_0x30e9e9(0x172)]=_0x196b8f[_0x30e9e9(0x183)]||null),await database_1['default']['shopSettings'][_0x30e9e9(0x1af)]({'where':{'shopId':_0x1904e1},'data':_0x42aa72});}async[a52_0x3e953d(0x173)](_0x4faecb,_0x1bca6e){const _0x58bff5=a52_0x3e953d;await this[_0x58bff5(0x1a6)](_0x4faecb);const _0x3b4e4b={};_0x1bca6e[_0x58bff5(0x16a)]!==undefined&&(_0x3b4e4b[_0x58bff5(0x16a)]=_0x1bca6e[_0x58bff5(0x16a)]||null),_0x1bca6e[_0x58bff5(0x191)]!==undefined&&(_0x3b4e4b[_0x58bff5(0x191)]=_0x1bca6e[_0x58bff5(0x191)]||[]),await database_1[_0x58bff5(0x194)]['shopSettings'][_0x58bff5(0x1af)]({'where':{'shopId':_0x4faecb},'data':_0x3b4e4b});}async[a52_0x3e953d(0x195)](_0x2a4e8c){const _0x2b225f=a52_0x3e953d,_0x2c4106=_0x2b225f(0x179)+crypto_1[_0x2b225f(0x194)]['randomBytes'](0x20)[_0x2b225f(0x171)](_0x2b225f(0x175)),_0x25e87e='sk_'+crypto_1[_0x2b225f(0x194)][_0x2b225f(0x1a5)](0x20)[_0x2b225f(0x171)](_0x2b225f(0x175));await database_1[_0x2b225f(0x194)][_0x2b225f(0x1ad)][_0x2b225f(0x1af)]({'where':{'id':_0x2a4e8c},'data':{'publicKey':_0x2c4106,'secretKey':_0x25e87e}});}async[a52_0x3e953d(0x1a4)](_0x4358fc,_0x42fa54){const _0x836bf4=a52_0x3e953d,{passwordConfirmation:_0x452aef}=_0x42fa54,_0x4a2571=await database_1[_0x836bf4(0x194)][_0x836bf4(0x1ad)][_0x836bf4(0x198)]({'where':{'id':_0x4358fc},'select':{'password':!![]}});if(!_0x4a2571)throw new Error('Shop\x20not\x20found');const _0x25c073=await bcryptjs_1[_0x836bf4(0x194)][_0x836bf4(0x174)](_0x452aef,_0x4a2571[_0x836bf4(0x19a)]);if(!_0x25c073)throw new Error(_0x836bf4(0x196));await database_1[_0x836bf4(0x194)][_0x836bf4(0x1ad)][_0x836bf4(0x16f)]({'where':{'id':_0x4358fc}});}async[a52_0x3e953d(0x1a6)](_0x25a33a){const _0x3a7848=a52_0x3e953d,_0x196171=await database_1[_0x3a7848(0x194)]['shopSettings'][_0x3a7848(0x198)]({'where':{'shopId':_0x25a33a}});!_0x196171&&await database_1['default']['shopSettings'][_0x3a7848(0x180)]({'data':{'shopId':_0x25a33a}});}}exports[a52_0x3e953d(0x1a0)]=SettingsService;