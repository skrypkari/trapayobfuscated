'use strict';const a64_0x24e0d3=a64_0xc184;function a64_0xc184(_0x49e55a,_0x2992a2){const _0x494b33=a64_0x494b();return a64_0xc184=function(_0xc18434,_0x40c2ac){_0xc18434=_0xc18434-0x156;let _0xff8adf=_0x494b33[_0xc18434];return _0xff8adf;},a64_0xc184(_0x49e55a,_0x2992a2);}(function(_0x4019c3,_0x38b58c){const _0x2c5601=a64_0xc184,_0x1f86e2=_0x4019c3();while(!![]){try{const _0x3e3117=-parseInt(_0x2c5601(0x18e))/0x1*(parseInt(_0x2c5601(0x16d))/0x2)+parseInt(_0x2c5601(0x157))/0x3+-parseInt(_0x2c5601(0x168))/0x4*(-parseInt(_0x2c5601(0x170))/0x5)+parseInt(_0x2c5601(0x186))/0x6+parseInt(_0x2c5601(0x179))/0x7*(-parseInt(_0x2c5601(0x16f))/0x8)+-parseInt(_0x2c5601(0x156))/0x9*(-parseInt(_0x2c5601(0x194))/0xa)+-parseInt(_0x2c5601(0x17f))/0xb;if(_0x3e3117===_0x38b58c)break;else _0x1f86e2['push'](_0x1f86e2['shift']());}catch(_0x12ad9f){_0x1f86e2['push'](_0x1f86e2['shift']());}}}(a64_0x494b,0x3bd1b));var __importDefault=this&&this[a64_0x24e0d3(0x183)]||function(_0x5b131f){const _0x18e5d1=a64_0x24e0d3;return _0x5b131f&&_0x5b131f[_0x18e5d1(0x193)]?_0x5b131f:{'default':_0x5b131f};};function a64_0x494b(){const _0x3f5493=['../config/database','defineProperty','4341429OcWlDX','436962Mwfhpl','SettingsService','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','Current\x20password\x20is\x20incorrect','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','telegramBotApiKey','hex','substring','parseWebhookEvents','payment_success','payout','revokeAllApiKeys','crypto','shop','default','length','sk_','36576lVnJmh','notificationRefund','notificationPayout','isArray','webhookUrl','692606DYNpyh','parse','333720GcsSyr','155wxhGys','delete','maskApiKey','getShopSettings','repeat','toString','Shop\x20not\x20found','notificationPaymentSuccess','shopSettings','21ynWXlu','notificationPaymentFailed','updateNotifications','settings','telegramChatId','create','3404599CGpovc','findUnique','pk_','webhookEvents','__importDefault','name','Password\x20confirmation\x20is\x20incorrect','686862mJTVZU','login','api_error','notificationApiError','updateWebhookSettings','bcryptjs','hash','payment_failed','1MlzdQT','botApiKey','refund','chatId','string','__esModule','10JWlUnD','ensureSettingsExist','update','randomBytes','updateTelegramSettings'];a64_0x494b=function(){return _0x3f5493;};return a64_0x494b();}Object[a64_0x24e0d3(0x19a)](exports,a64_0x24e0d3(0x193),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a64_0x24e0d3(0x18b))),crypto_1=__importDefault(require(a64_0x24e0d3(0x163))),database_1=__importDefault(require(a64_0x24e0d3(0x199)));class SettingsService{[a64_0x24e0d3(0x172)](_0x1d5709){const _0xd0047d=a64_0x24e0d3;if(!_0x1d5709)return'';if(_0x1d5709[_0xd0047d(0x166)]<=0x8)return _0x1d5709;const _0x2e6a07=_0x1d5709[_0xd0047d(0x15e)](0x0,0x8),_0x4afadf='*'[_0xd0047d(0x174)](Math['max'](0x0,_0x1d5709[_0xd0047d(0x166)]-0x8));return _0x2e6a07+_0x4afadf;}[a64_0x24e0d3(0x15f)](_0x11f60d){const _0x591751=a64_0x24e0d3;if(!_0x11f60d)return[];if(Array[_0x591751(0x16b)](_0x11f60d))return _0x11f60d;if(typeof _0x11f60d===_0x591751(0x192))try{const _0x482f1d=JSON[_0x591751(0x16e)](_0x11f60d);return Array[_0x591751(0x16b)](_0x482f1d)?_0x482f1d:[];}catch{return[];}return[];}async[a64_0x24e0d3(0x173)](_0x68e6cb){const _0x509acd=a64_0x24e0d3,_0xd44807=await database_1['default'][_0x509acd(0x164)]['findUnique']({'where':{'id':_0x68e6cb},'include':{'settings':!![]}});if(!_0xd44807)throw new Error(_0x509acd(0x176));let _0x5374c0=_0xd44807[_0x509acd(0x17c)];return!_0x5374c0&&(_0x5374c0=await database_1['default']['shopSettings'][_0x509acd(0x17e)]({'data':{'shopId':_0xd44807['id']}})),{'fullName':_0xd44807['name'],'brand':_0xd44807[_0x509acd(0x184)],'merchantUrl':_0xd44807['shopUrl'],'telegramUsername':_0xd44807['telegram'],'telegramBotApiKey':_0x5374c0[_0x509acd(0x15c)]?this['maskApiKey'](_0x5374c0['telegramBotApiKey']):null,'telegramChatId':_0x5374c0[_0x509acd(0x17d)],'webhookUrl':_0x5374c0[_0x509acd(0x16c)],'webhookEvents':this['parseWebhookEvents'](_0x5374c0[_0x509acd(0x182)]),'notifications':{'payment_success':_0x5374c0['notificationPaymentSuccess'],'payment_failed':_0x5374c0['notificationPaymentFailed'],'refund':_0x5374c0[_0x509acd(0x169)],'payout':_0x5374c0[_0x509acd(0x16a)],'login':_0x5374c0['notificationLogin'],'api_error':_0x5374c0[_0x509acd(0x189)]}};}async['changePassword'](_0x82ca78,_0x24d303){const _0x46a2fe=a64_0x24e0d3,{currentPassword:_0x45b5d7,newPassword:_0x2d6684,confirmNewPassword:_0x3b2be9}=_0x24d303;if(_0x2d6684!==_0x3b2be9)throw new Error(_0x46a2fe(0x15b));if(_0x2d6684[_0x46a2fe(0x166)]<0x6)throw new Error(_0x46a2fe(0x159));const _0x177b08=await database_1[_0x46a2fe(0x165)][_0x46a2fe(0x164)][_0x46a2fe(0x180)]({'where':{'id':_0x82ca78},'select':{'password':!![]}});if(!_0x177b08)throw new Error('Shop\x20not\x20found');const _0x163b7c=await bcryptjs_1[_0x46a2fe(0x165)]['compare'](_0x45b5d7,_0x177b08['password']);if(!_0x163b7c)throw new Error(_0x46a2fe(0x15a));const _0x54c609=await bcryptjs_1[_0x46a2fe(0x165)][_0x46a2fe(0x18c)](_0x2d6684,0xc);await database_1[_0x46a2fe(0x165)][_0x46a2fe(0x164)]['update']({'where':{'id':_0x82ca78},'data':{'password':_0x54c609}});}async[a64_0x24e0d3(0x17b)](_0x4f9e4b,_0x115845){const _0x11ed45=a64_0x24e0d3;await this['ensureSettingsExist'](_0x4f9e4b);const _0x1e9b6a={};_0x115845['payment_success']!==undefined&&(_0x1e9b6a[_0x11ed45(0x177)]=_0x115845[_0x11ed45(0x160)]),_0x115845[_0x11ed45(0x18d)]!==undefined&&(_0x1e9b6a[_0x11ed45(0x17a)]=_0x115845[_0x11ed45(0x18d)]),_0x115845[_0x11ed45(0x190)]!==undefined&&(_0x1e9b6a['notificationRefund']=_0x115845['refund']),_0x115845[_0x11ed45(0x161)]!==undefined&&(_0x1e9b6a[_0x11ed45(0x16a)]=_0x115845['payout']),_0x115845['login']!==undefined&&(_0x1e9b6a['notificationLogin']=_0x115845[_0x11ed45(0x187)]),_0x115845[_0x11ed45(0x188)]!==undefined&&(_0x1e9b6a[_0x11ed45(0x189)]=_0x115845[_0x11ed45(0x188)]),await database_1[_0x11ed45(0x165)][_0x11ed45(0x178)][_0x11ed45(0x196)]({'where':{'shopId':_0x4f9e4b},'data':_0x1e9b6a});}async[a64_0x24e0d3(0x198)](_0x22e48d,_0x573c10){const _0x35952e=a64_0x24e0d3;await this['ensureSettingsExist'](_0x22e48d);const _0x5e015a={};_0x573c10[_0x35952e(0x18f)]!==undefined&&(_0x5e015a[_0x35952e(0x15c)]=_0x573c10['botApiKey']||null),_0x573c10[_0x35952e(0x191)]!==undefined&&(_0x5e015a[_0x35952e(0x17d)]=_0x573c10['chatId']||null),await database_1[_0x35952e(0x165)][_0x35952e(0x178)][_0x35952e(0x196)]({'where':{'shopId':_0x22e48d},'data':_0x5e015a});}async[a64_0x24e0d3(0x18a)](_0xc24483,_0x3d074b){const _0x9112a0=a64_0x24e0d3;await this[_0x9112a0(0x195)](_0xc24483);const _0x2c30a2={};_0x3d074b[_0x9112a0(0x16c)]!==undefined&&(_0x2c30a2[_0x9112a0(0x16c)]=_0x3d074b[_0x9112a0(0x16c)]||null),_0x3d074b['webhookEvents']!==undefined&&(_0x2c30a2[_0x9112a0(0x182)]=_0x3d074b[_0x9112a0(0x182)]||[]),await database_1[_0x9112a0(0x165)][_0x9112a0(0x178)]['update']({'where':{'shopId':_0xc24483},'data':_0x2c30a2});}async[a64_0x24e0d3(0x162)](_0x3cf896){const _0x2c38ef=a64_0x24e0d3,_0x36ea68=_0x2c38ef(0x181)+crypto_1['default'][_0x2c38ef(0x197)](0x20)[_0x2c38ef(0x175)](_0x2c38ef(0x15d)),_0x6a41b5=_0x2c38ef(0x167)+crypto_1[_0x2c38ef(0x165)]['randomBytes'](0x20)[_0x2c38ef(0x175)]('hex');await database_1[_0x2c38ef(0x165)][_0x2c38ef(0x164)][_0x2c38ef(0x196)]({'where':{'id':_0x3cf896},'data':{'publicKey':_0x36ea68,'secretKey':_0x6a41b5}});}async['deleteAccount'](_0x10dd37,_0x10c705){const _0x244cf1=a64_0x24e0d3,{passwordConfirmation:_0x220022}=_0x10c705,_0x8315bc=await database_1[_0x244cf1(0x165)][_0x244cf1(0x164)]['findUnique']({'where':{'id':_0x10dd37},'select':{'password':!![]}});if(!_0x8315bc)throw new Error(_0x244cf1(0x176));const _0x1956d7=await bcryptjs_1[_0x244cf1(0x165)]['compare'](_0x220022,_0x8315bc['password']);if(!_0x1956d7)throw new Error(_0x244cf1(0x185));await database_1[_0x244cf1(0x165)][_0x244cf1(0x164)][_0x244cf1(0x171)]({'where':{'id':_0x10dd37}});}async[a64_0x24e0d3(0x195)](_0x34384d){const _0x2efcb5=a64_0x24e0d3,_0x3623d3=await database_1[_0x2efcb5(0x165)][_0x2efcb5(0x178)][_0x2efcb5(0x180)]({'where':{'shopId':_0x34384d}});!_0x3623d3&&await database_1[_0x2efcb5(0x165)]['shopSettings']['create']({'data':{'shopId':_0x34384d}});}}exports[a64_0x24e0d3(0x158)]=SettingsService;