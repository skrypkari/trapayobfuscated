'use strict';const a57_0x1cc37a=a57_0xb78f;(function(_0x5c47b5,_0x2b75c0){const _0x49f21c=a57_0xb78f,_0x43cef0=_0x5c47b5();while(!![]){try{const _0x317e5e=parseInt(_0x49f21c(0x86))/0x1*(-parseInt(_0x49f21c(0x9d))/0x2)+-parseInt(_0x49f21c(0x8b))/0x3+parseInt(_0x49f21c(0x6d))/0x4*(-parseInt(_0x49f21c(0x6f))/0x5)+parseInt(_0x49f21c(0xab))/0x6+-parseInt(_0x49f21c(0x7b))/0x7+parseInt(_0x49f21c(0xa9))/0x8*(-parseInt(_0x49f21c(0x71))/0x9)+parseInt(_0x49f21c(0x77))/0xa;if(_0x317e5e===_0x2b75c0)break;else _0x43cef0['push'](_0x43cef0['shift']());}catch(_0x1a40a3){_0x43cef0['push'](_0x43cef0['shift']());}}}(a57_0xb981,0x96187));var __importDefault=this&&this[a57_0x1cc37a(0x9c)]||function(_0x1a2da4){return _0x1a2da4&&_0x1a2da4['__esModule']?_0x1a2da4:{'default':_0x1a2da4};};Object[a57_0x1cc37a(0x73)](exports,a57_0x1cc37a(0xa8),{'value':!![]}),exports[a57_0x1cc37a(0x95)]=void 0x0;function a57_0xb78f(_0x55a28a,_0x2dbd0b){const _0xb981e1=a57_0xb981();return a57_0xb78f=function(_0xb78f7b,_0x5b45f2){_0xb78f7b=_0xb78f7b-0x67;let _0x8bc1c4=_0xb981e1[_0xb78f7b];return _0x8bc1c4;},a57_0xb78f(_0x55a28a,_0x2dbd0b);}const bcryptjs_1=__importDefault(require(a57_0x1cc37a(0x90))),crypto_1=__importDefault(require(a57_0x1cc37a(0x70))),database_1=__importDefault(require(a57_0x1cc37a(0x74)));class SettingsService{[a57_0x1cc37a(0x69)](_0x5aa44e){const _0x533db0=a57_0x1cc37a;if(!_0x5aa44e)return'';if(_0x5aa44e['length']<=0x8)return _0x5aa44e;const _0x3e7f17=_0x5aa44e[_0x533db0(0x96)](0x0,0x8),_0x401bf9='*'['repeat'](Math[_0x533db0(0x87)](0x0,_0x5aa44e[_0x533db0(0xa4)]-0x8));return _0x3e7f17+_0x401bf9;}[a57_0x1cc37a(0x75)](_0x1cf82a){const _0x36ad13=a57_0x1cc37a;if(!_0x1cf82a)return[];if(Array[_0x36ad13(0x82)](_0x1cf82a))return _0x1cf82a;if(typeof _0x1cf82a===_0x36ad13(0xa6))try{const _0x2a9591=JSON[_0x36ad13(0x7e)](_0x1cf82a);return Array[_0x36ad13(0x82)](_0x2a9591)?_0x2a9591:[];}catch{return[];}return[];}async['getShopSettings'](_0x4e6ca3){const _0x2758bd=a57_0x1cc37a,_0xc6289e=await database_1[_0x2758bd(0x8c)][_0x2758bd(0x67)][_0x2758bd(0x83)]({'where':{'id':_0x4e6ca3},'include':{'settings':!![]}});if(!_0xc6289e)throw new Error(_0x2758bd(0x6b));let _0x907fec=_0xc6289e['settings'];return!_0x907fec&&(_0x907fec=await database_1[_0x2758bd(0x8c)][_0x2758bd(0x7f)][_0x2758bd(0x85)]({'data':{'shopId':_0xc6289e['id']}})),{'fullName':_0xc6289e[_0x2758bd(0x91)],'brand':_0xc6289e['name'],'merchantUrl':_0xc6289e[_0x2758bd(0x97)],'telegramUsername':_0xc6289e[_0x2758bd(0x80)],'telegramBotApiKey':_0x907fec[_0x2758bd(0x99)]?this[_0x2758bd(0x69)](_0x907fec[_0x2758bd(0x99)]):null,'telegramChatId':_0x907fec[_0x2758bd(0x76)],'webhookUrl':_0x907fec[_0x2758bd(0x81)],'webhookEvents':this[_0x2758bd(0x75)](_0x907fec['webhookEvents']),'notifications':{'payment_success':_0x907fec['notificationPaymentSuccess'],'payment_failed':_0x907fec[_0x2758bd(0xa0)],'refund':_0x907fec[_0x2758bd(0xac)],'payout':_0x907fec[_0x2758bd(0x7d)],'login':_0x907fec[_0x2758bd(0x84)],'api_error':_0x907fec[_0x2758bd(0x92)]}};}async[a57_0x1cc37a(0x9f)](_0x42baa6,_0x3b9e63){const _0x35df05=a57_0x1cc37a,{currentPassword:_0x196610,newPassword:_0x215e01,confirmNewPassword:_0x57436e}=_0x3b9e63;if(_0x215e01!==_0x57436e)throw new Error(_0x35df05(0x88));if(_0x215e01[_0x35df05(0xa4)]<0x6)throw new Error(_0x35df05(0x79));const _0x17681a=await database_1['default'][_0x35df05(0x67)]['findUnique']({'where':{'id':_0x42baa6},'select':{'password':!![]}});if(!_0x17681a)throw new Error('Shop\x20not\x20found');const _0x3c5d8b=await bcryptjs_1[_0x35df05(0x8c)][_0x35df05(0x9e)](_0x196610,_0x17681a['password']);if(!_0x3c5d8b)throw new Error(_0x35df05(0x6e));const _0x3b3961=await bcryptjs_1[_0x35df05(0x8c)][_0x35df05(0x72)](_0x215e01,0xc);await database_1[_0x35df05(0x8c)][_0x35df05(0x67)][_0x35df05(0x7c)]({'where':{'id':_0x42baa6},'data':{'password':_0x3b3961}});}async[a57_0x1cc37a(0xa3)](_0x11fb01,_0x592f14){const _0x46fba9=a57_0x1cc37a;await this[_0x46fba9(0x89)](_0x11fb01);const _0x2f6a57={};_0x592f14['payment_success']!==undefined&&(_0x2f6a57[_0x46fba9(0x8a)]=_0x592f14['payment_success']),_0x592f14[_0x46fba9(0x6a)]!==undefined&&(_0x2f6a57[_0x46fba9(0xa0)]=_0x592f14[_0x46fba9(0x6a)]),_0x592f14[_0x46fba9(0x94)]!==undefined&&(_0x2f6a57[_0x46fba9(0xac)]=_0x592f14['refund']),_0x592f14[_0x46fba9(0x6c)]!==undefined&&(_0x2f6a57['notificationPayout']=_0x592f14['payout']),_0x592f14[_0x46fba9(0x93)]!==undefined&&(_0x2f6a57['notificationLogin']=_0x592f14['login']),_0x592f14[_0x46fba9(0x8d)]!==undefined&&(_0x2f6a57[_0x46fba9(0x92)]=_0x592f14[_0x46fba9(0x8d)]),await database_1[_0x46fba9(0x8c)][_0x46fba9(0x7f)][_0x46fba9(0x7c)]({'where':{'shopId':_0x11fb01},'data':_0x2f6a57});}async[a57_0x1cc37a(0x8e)](_0x366cda,_0x1baa26){const _0x330ae3=a57_0x1cc37a;await this[_0x330ae3(0x89)](_0x366cda);const _0x31a469={};_0x1baa26[_0x330ae3(0xa5)]!==undefined&&(_0x31a469[_0x330ae3(0x99)]=_0x1baa26['botApiKey']||null),_0x1baa26[_0x330ae3(0x68)]!==undefined&&(_0x31a469['telegramChatId']=_0x1baa26[_0x330ae3(0x68)]||null),await database_1[_0x330ae3(0x8c)][_0x330ae3(0x7f)][_0x330ae3(0x7c)]({'where':{'shopId':_0x366cda},'data':_0x31a469});}async['updateWebhookSettings'](_0x163b08,_0x588033){const _0x3a7036=a57_0x1cc37a;await this[_0x3a7036(0x89)](_0x163b08);const _0x127903={};_0x588033['webhookUrl']!==undefined&&(_0x127903[_0x3a7036(0x81)]=_0x588033['webhookUrl']||null),_0x588033[_0x3a7036(0xa2)]!==undefined&&(_0x127903['webhookEvents']=_0x588033['webhookEvents']||[]),await database_1[_0x3a7036(0x8c)][_0x3a7036(0x7f)][_0x3a7036(0x7c)]({'where':{'shopId':_0x163b08},'data':_0x127903});}async[a57_0x1cc37a(0xa1)](_0x3580f0){const _0x9fbfa8=a57_0x1cc37a,_0x413f8e=_0x9fbfa8(0x78)+crypto_1[_0x9fbfa8(0x8c)][_0x9fbfa8(0x98)](0x20)[_0x9fbfa8(0xad)](_0x9fbfa8(0x8f)),_0x1c28c0=_0x9fbfa8(0xaa)+crypto_1[_0x9fbfa8(0x8c)][_0x9fbfa8(0x98)](0x20)[_0x9fbfa8(0xad)](_0x9fbfa8(0x8f));await database_1['default'][_0x9fbfa8(0x67)][_0x9fbfa8(0x7c)]({'where':{'id':_0x3580f0},'data':{'publicKey':_0x413f8e,'secretKey':_0x1c28c0}});}async[a57_0x1cc37a(0x7a)](_0x66b7bd,_0x320a90){const _0x13ff17=a57_0x1cc37a,{passwordConfirmation:_0x40ed89}=_0x320a90,_0x5baa5d=await database_1['default']['shop'][_0x13ff17(0x83)]({'where':{'id':_0x66b7bd},'select':{'password':!![]}});if(!_0x5baa5d)throw new Error(_0x13ff17(0x6b));const _0x287519=await bcryptjs_1[_0x13ff17(0x8c)][_0x13ff17(0x9e)](_0x40ed89,_0x5baa5d[_0x13ff17(0xa7)]);if(!_0x287519)throw new Error(_0x13ff17(0x9b));await database_1[_0x13ff17(0x8c)][_0x13ff17(0x67)][_0x13ff17(0x9a)]({'where':{'id':_0x66b7bd}});}async[a57_0x1cc37a(0x89)](_0x487024){const _0x446b85=a57_0x1cc37a,_0x1531f7=await database_1['default'][_0x446b85(0x7f)]['findUnique']({'where':{'shopId':_0x487024}});!_0x1531f7&&await database_1[_0x446b85(0x8c)]['shopSettings'][_0x446b85(0x85)]({'data':{'shopId':_0x487024}});}}exports[a57_0x1cc37a(0x95)]=SettingsService;function a57_0xb981(){const _0x2cc437=['notificationPayout','parse','shopSettings','telegram','webhookUrl','isArray','findUnique','notificationLogin','create','537bHPNyA','max','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','ensureSettingsExist','notificationPaymentSuccess','928674guTlFX','default','api_error','updateTelegramSettings','hex','bcryptjs','name','notificationApiError','login','refund','SettingsService','substring','shopUrl','randomBytes','telegramBotApiKey','delete','Password\x20confirmation\x20is\x20incorrect','__importDefault','2406TdJeAU','compare','changePassword','notificationPaymentFailed','revokeAllApiKeys','webhookEvents','updateNotifications','length','botApiKey','string','password','__esModule','1695752NXnEqZ','sk_','1719732bRycmJ','notificationRefund','toString','shop','chatId','maskApiKey','payment_failed','Shop\x20not\x20found','payout','96204elndUe','Current\x20password\x20is\x20incorrect','105kwQDiD','crypto','9dAvSSV','hash','defineProperty','../config/database','parseWebhookEvents','telegramChatId','29837220iIJsFd','pk_','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','deleteAccount','6880608pFAyDj','update'];a57_0xb981=function(){return _0x2cc437;};return a57_0xb981();}