'use strict';function a52_0x3ae2(){const _0x5071e7=['SettingsService','telegramChatId','updateWebhookSettings','default','2584932oAjbvr','shopSettings','updateTelegramSettings','notificationPaymentSuccess','botApiKey','__importDefault','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','4dzQvIu','toString','crypto','settings','api_error','payout','24355370MYZKqV','isArray','findUnique','../config/database','length','refund','ensureSettingsExist','telegramBotApiKey','randomBytes','deleteAccount','getShopSettings','shopUrl','update','notificationApiError','revokeAllApiKeys','Shop\x20not\x20found','bcryptjs','payment_success','repeat','notificationPaymentFailed','substring','delete','Password\x20confirmation\x20is\x20incorrect','hex','parse','maskApiKey','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','webhookUrl','notificationPayout','password','1279794ORtXNj','webhookEvents','notificationLogin','sk_','8FSkXAA','changePassword','updateNotifications','notificationRefund','pk_','parseWebhookEvents','4531926jMwGpV','206KdJmDc','367VnPXID','telegram','max','name','6445053PBUaqi','defineProperty','string','shop','compare','chatId','create','2752725JkuZGT'];a52_0x3ae2=function(){return _0x5071e7;};return a52_0x3ae2();}const a52_0x4cd989=a52_0x2983;(function(_0x3650c9,_0x4c88a1){const _0x5d423c=a52_0x2983,_0x54d297=_0x3650c9();while(!![]){try{const _0x5288c1=parseInt(_0x5d423c(0x84))/0x1*(parseInt(_0x5d423c(0x83))/0x2)+-parseInt(_0x5d423c(0x94))/0x3+-parseInt(_0x5d423c(0x9b))/0x4*(-parseInt(_0x5d423c(0x8f))/0x5)+-parseInt(_0x5d423c(0xbf))/0x6+-parseInt(_0x5d423c(0x82))/0x7+parseInt(_0x5d423c(0xc3))/0x8*(-parseInt(_0x5d423c(0x88))/0x9)+parseInt(_0x5d423c(0xa1))/0xa;if(_0x5288c1===_0x4c88a1)break;else _0x54d297['push'](_0x54d297['shift']());}catch(_0x10e0ce){_0x54d297['push'](_0x54d297['shift']());}}}(a52_0x3ae2,0x8eebd));var __importDefault=this&&this[a52_0x4cd989(0x99)]||function(_0x453a6b){return _0x453a6b&&_0x453a6b['__esModule']?_0x453a6b:{'default':_0x453a6b};};function a52_0x2983(_0x1bcb7a,_0x146aa7){const _0x3ae237=a52_0x3ae2();return a52_0x2983=function(_0x298341,_0x46b9e1){_0x298341=_0x298341-0x82;let _0x573151=_0x3ae237[_0x298341];return _0x573151;},a52_0x2983(_0x1bcb7a,_0x146aa7);}Object[a52_0x4cd989(0x89)](exports,'__esModule',{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x4cd989(0xb1))),crypto_1=__importDefault(require(a52_0x4cd989(0x9d))),database_1=__importDefault(require(a52_0x4cd989(0xa4)));class SettingsService{['maskApiKey'](_0x44cbdb){const _0x39ab59=a52_0x4cd989;if(!_0x44cbdb)return'';if(_0x44cbdb[_0x39ab59(0xa5)]<=0x8)return _0x44cbdb;const _0x48991a=_0x44cbdb[_0x39ab59(0xb5)](0x0,0x8),_0x521ab2='*'[_0x39ab59(0xb3)](Math[_0x39ab59(0x86)](0x0,_0x44cbdb[_0x39ab59(0xa5)]-0x8));return _0x48991a+_0x521ab2;}[a52_0x4cd989(0xc8)](_0x5b17d6){const _0xecbd34=a52_0x4cd989;if(!_0x5b17d6)return[];if(Array[_0xecbd34(0xa2)](_0x5b17d6))return _0x5b17d6;if(typeof _0x5b17d6===_0xecbd34(0x8a))try{const _0xa99e1a=JSON[_0xecbd34(0xb9)](_0x5b17d6);return Array[_0xecbd34(0xa2)](_0xa99e1a)?_0xa99e1a:[];}catch{return[];}return[];}async[a52_0x4cd989(0xab)](_0x5bf58b){const _0x2dc98b=a52_0x4cd989,_0x34bf38=await database_1[_0x2dc98b(0x93)][_0x2dc98b(0x8b)][_0x2dc98b(0xa3)]({'where':{'id':_0x5bf58b},'include':{'settings':!![]}});if(!_0x34bf38)throw new Error('Shop\x20not\x20found');let _0x45e4a1=_0x34bf38[_0x2dc98b(0x9e)];return!_0x45e4a1&&(_0x45e4a1=await database_1[_0x2dc98b(0x93)][_0x2dc98b(0x95)][_0x2dc98b(0x8e)]({'data':{'shopId':_0x34bf38['id']}})),{'fullName':_0x34bf38[_0x2dc98b(0x87)],'brand':_0x34bf38[_0x2dc98b(0x87)],'merchantUrl':_0x34bf38[_0x2dc98b(0xac)],'telegramUsername':_0x34bf38[_0x2dc98b(0x85)],'telegramBotApiKey':_0x45e4a1[_0x2dc98b(0xa8)]?this[_0x2dc98b(0xba)](_0x45e4a1['telegramBotApiKey']):null,'telegramChatId':_0x45e4a1[_0x2dc98b(0x91)],'webhookUrl':_0x45e4a1[_0x2dc98b(0xbc)],'webhookEvents':this[_0x2dc98b(0xc8)](_0x45e4a1[_0x2dc98b(0xc0)]),'notifications':{'payment_success':_0x45e4a1[_0x2dc98b(0x97)],'payment_failed':_0x45e4a1[_0x2dc98b(0xb4)],'refund':_0x45e4a1[_0x2dc98b(0xc6)],'payout':_0x45e4a1[_0x2dc98b(0xbd)],'login':_0x45e4a1[_0x2dc98b(0xc1)],'api_error':_0x45e4a1[_0x2dc98b(0xae)]}};}async[a52_0x4cd989(0xc4)](_0x585fb0,_0x345e28){const _0x31f644=a52_0x4cd989,{currentPassword:_0x237cd2,newPassword:_0x599fd0,confirmNewPassword:_0x107cd0}=_0x345e28;if(_0x599fd0!==_0x107cd0)throw new Error(_0x31f644(0x9a));if(_0x599fd0[_0x31f644(0xa5)]<0x6)throw new Error(_0x31f644(0xbb));const _0x33e007=await database_1['default'][_0x31f644(0x8b)]['findUnique']({'where':{'id':_0x585fb0},'select':{'password':!![]}});if(!_0x33e007)throw new Error('Shop\x20not\x20found');const _0x38f3b0=await bcryptjs_1[_0x31f644(0x93)]['compare'](_0x237cd2,_0x33e007[_0x31f644(0xbe)]);if(!_0x38f3b0)throw new Error('Current\x20password\x20is\x20incorrect');const _0x3f3ef2=await bcryptjs_1[_0x31f644(0x93)]['hash'](_0x599fd0,0xc);await database_1[_0x31f644(0x93)]['shop']['update']({'where':{'id':_0x585fb0},'data':{'password':_0x3f3ef2}});}async[a52_0x4cd989(0xc5)](_0x4ebc01,_0x940c64){const _0x58fae8=a52_0x4cd989;await this[_0x58fae8(0xa7)](_0x4ebc01);const _0x440e85={};_0x940c64[_0x58fae8(0xb2)]!==undefined&&(_0x440e85[_0x58fae8(0x97)]=_0x940c64['payment_success']),_0x940c64['payment_failed']!==undefined&&(_0x440e85[_0x58fae8(0xb4)]=_0x940c64['payment_failed']),_0x940c64[_0x58fae8(0xa6)]!==undefined&&(_0x440e85[_0x58fae8(0xc6)]=_0x940c64[_0x58fae8(0xa6)]),_0x940c64[_0x58fae8(0xa0)]!==undefined&&(_0x440e85[_0x58fae8(0xbd)]=_0x940c64[_0x58fae8(0xa0)]),_0x940c64['login']!==undefined&&(_0x440e85[_0x58fae8(0xc1)]=_0x940c64['login']),_0x940c64[_0x58fae8(0x9f)]!==undefined&&(_0x440e85[_0x58fae8(0xae)]=_0x940c64[_0x58fae8(0x9f)]),await database_1['default']['shopSettings'][_0x58fae8(0xad)]({'where':{'shopId':_0x4ebc01},'data':_0x440e85});}async[a52_0x4cd989(0x96)](_0x186335,_0xa9517e){const _0x177dea=a52_0x4cd989;await this['ensureSettingsExist'](_0x186335);const _0x529728={};_0xa9517e['botApiKey']!==undefined&&(_0x529728['telegramBotApiKey']=_0xa9517e[_0x177dea(0x98)]||null),_0xa9517e[_0x177dea(0x8d)]!==undefined&&(_0x529728['telegramChatId']=_0xa9517e[_0x177dea(0x8d)]||null),await database_1[_0x177dea(0x93)][_0x177dea(0x95)][_0x177dea(0xad)]({'where':{'shopId':_0x186335},'data':_0x529728});}async[a52_0x4cd989(0x92)](_0x4d0d87,_0x3d0109){const _0x31113f=a52_0x4cd989;await this['ensureSettingsExist'](_0x4d0d87);const _0x18aead={};_0x3d0109[_0x31113f(0xbc)]!==undefined&&(_0x18aead[_0x31113f(0xbc)]=_0x3d0109[_0x31113f(0xbc)]||null),_0x3d0109[_0x31113f(0xc0)]!==undefined&&(_0x18aead['webhookEvents']=_0x3d0109[_0x31113f(0xc0)]||[]),await database_1['default'][_0x31113f(0x95)][_0x31113f(0xad)]({'where':{'shopId':_0x4d0d87},'data':_0x18aead});}async[a52_0x4cd989(0xaf)](_0x295013){const _0x23077f=a52_0x4cd989,_0x474797=_0x23077f(0xc7)+crypto_1['default'][_0x23077f(0xa9)](0x20)['toString']('hex'),_0x36faff=_0x23077f(0xc2)+crypto_1[_0x23077f(0x93)][_0x23077f(0xa9)](0x20)[_0x23077f(0x9c)](_0x23077f(0xb8));await database_1[_0x23077f(0x93)][_0x23077f(0x8b)][_0x23077f(0xad)]({'where':{'id':_0x295013},'data':{'publicKey':_0x474797,'secretKey':_0x36faff}});}async[a52_0x4cd989(0xaa)](_0x565783,_0x18dbef){const _0x5e8179=a52_0x4cd989,{passwordConfirmation:_0x5b4d16}=_0x18dbef,_0x2a636c=await database_1[_0x5e8179(0x93)][_0x5e8179(0x8b)][_0x5e8179(0xa3)]({'where':{'id':_0x565783},'select':{'password':!![]}});if(!_0x2a636c)throw new Error(_0x5e8179(0xb0));const _0x371524=await bcryptjs_1[_0x5e8179(0x93)][_0x5e8179(0x8c)](_0x5b4d16,_0x2a636c['password']);if(!_0x371524)throw new Error(_0x5e8179(0xb7));await database_1[_0x5e8179(0x93)][_0x5e8179(0x8b)][_0x5e8179(0xb6)]({'where':{'id':_0x565783}});}async[a52_0x4cd989(0xa7)](_0x30afac){const _0x2b5ad4=a52_0x4cd989,_0x1acb3a=await database_1[_0x2b5ad4(0x93)][_0x2b5ad4(0x95)][_0x2b5ad4(0xa3)]({'where':{'shopId':_0x30afac}});!_0x1acb3a&&await database_1[_0x2b5ad4(0x93)]['shopSettings'][_0x2b5ad4(0x8e)]({'data':{'shopId':_0x30afac}});}}exports[a52_0x4cd989(0x90)]=SettingsService;