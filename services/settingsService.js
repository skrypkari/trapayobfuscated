'use strict';const a57_0x5f0bd0=a57_0x2083;(function(_0x3b109b,_0x282a70){const _0x1f2f13=a57_0x2083,_0x54f6df=_0x3b109b();while(!![]){try{const _0x103d7f=-parseInt(_0x1f2f13(0x6d))/0x1+-parseInt(_0x1f2f13(0x76))/0x2*(parseInt(_0x1f2f13(0x89))/0x3)+parseInt(_0x1f2f13(0x7a))/0x4*(parseInt(_0x1f2f13(0xa9))/0x5)+-parseInt(_0x1f2f13(0x8b))/0x6+-parseInt(_0x1f2f13(0xb1))/0x7*(parseInt(_0x1f2f13(0xa0))/0x8)+-parseInt(_0x1f2f13(0x6f))/0x9+parseInt(_0x1f2f13(0x9c))/0xa*(parseInt(_0x1f2f13(0x9a))/0xb);if(_0x103d7f===_0x282a70)break;else _0x54f6df['push'](_0x54f6df['shift']());}catch(_0x333478){_0x54f6df['push'](_0x54f6df['shift']());}}}(a57_0x2a69,0x648fc));function a57_0x2083(_0x57f4d7,_0x4dd8c6){const _0x2a694e=a57_0x2a69();return a57_0x2083=function(_0x2083f4,_0x41f0fd){_0x2083f4=_0x2083f4-0x6d;let _0x4b66a2=_0x2a694e[_0x2083f4];return _0x4b66a2;},a57_0x2083(_0x57f4d7,_0x4dd8c6);}var __importDefault=this&&this['__importDefault']||function(_0x1385a5){const _0x392319=a57_0x2083;return _0x1385a5&&_0x1385a5[_0x392319(0x95)]?_0x1385a5:{'default':_0x1385a5};};function a57_0x2a69(){const _0x115871=['login','shopSettings','isArray','substring','notificationPayout','28Lwrmog','default','create','Shop\x20not\x20found','4GiNrNY','telegram','SettingsService','notificationLogin','refund','compare','shopUrl','bcryptjs','updateWebhookSettings','notificationRefund','parseWebhookEvents','ensureSettingsExist','delete','updateNotifications','api_error','81843BkIYTC','password','3969984mnTuCS','../config/database','deleteAccount','pk_','update','telegramBotApiKey','maskApiKey','findUnique','changePassword','repeat','__esModule','getShopSettings','name','payout','shop','22769813qgELtT','updateTelegramSettings','10zSFeLE','parse','webhookUrl','webhookEvents','88sUKgNB','payment_success','toString','randomBytes','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','telegramChatId','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','max','payment_failed','1994615fASFts','revokeAllApiKeys','notificationPaymentFailed','hex','crypto','hash','notificationApiError','length','254653cZzHLD','settings','173916aPtWrh','notificationPaymentSuccess','3953907CTxpuL','chatId'];a57_0x2a69=function(){return _0x115871;};return a57_0x2a69();}Object['defineProperty'](exports,a57_0x5f0bd0(0x95),{'value':!![]}),exports[a57_0x5f0bd0(0x7c)]=void 0x0;const bcryptjs_1=__importDefault(require(a57_0x5f0bd0(0x81))),crypto_1=__importDefault(require(a57_0x5f0bd0(0xad))),database_1=__importDefault(require(a57_0x5f0bd0(0x8c)));class SettingsService{['maskApiKey'](_0x40e26d){const _0x4fc6ea=a57_0x5f0bd0;if(!_0x40e26d)return'';if(_0x40e26d[_0x4fc6ea(0xb0)]<=0x8)return _0x40e26d;const _0x53cf95=_0x40e26d[_0x4fc6ea(0x74)](0x0,0x8),_0x1f679c='*'[_0x4fc6ea(0x94)](Math[_0x4fc6ea(0xa7)](0x0,_0x40e26d[_0x4fc6ea(0xb0)]-0x8));return _0x53cf95+_0x1f679c;}[a57_0x5f0bd0(0x84)](_0x14a982){const _0x247228=a57_0x5f0bd0;if(!_0x14a982)return[];if(Array[_0x247228(0x73)](_0x14a982))return _0x14a982;if(typeof _0x14a982==='string')try{const _0x428c28=JSON[_0x247228(0x9d)](_0x14a982);return Array[_0x247228(0x73)](_0x428c28)?_0x428c28:[];}catch{return[];}return[];}async[a57_0x5f0bd0(0x96)](_0x4dcf4c){const _0x3c0217=a57_0x5f0bd0,_0x2deba1=await database_1[_0x3c0217(0x77)][_0x3c0217(0x99)]['findUnique']({'where':{'id':_0x4dcf4c},'include':{'settings':!![]}});if(!_0x2deba1)throw new Error(_0x3c0217(0x79));let _0x424999=_0x2deba1[_0x3c0217(0xb2)];return!_0x424999&&(_0x424999=await database_1['default'][_0x3c0217(0x72)][_0x3c0217(0x78)]({'data':{'shopId':_0x2deba1['id']}})),{'fullName':_0x2deba1['name'],'brand':_0x2deba1[_0x3c0217(0x97)],'merchantUrl':_0x2deba1[_0x3c0217(0x80)],'telegramUsername':_0x2deba1[_0x3c0217(0x7b)],'telegramBotApiKey':_0x424999[_0x3c0217(0x90)]?this[_0x3c0217(0x91)](_0x424999[_0x3c0217(0x90)]):null,'telegramChatId':_0x424999[_0x3c0217(0xa5)],'webhookUrl':_0x424999['webhookUrl'],'webhookEvents':this[_0x3c0217(0x84)](_0x424999[_0x3c0217(0x9f)]),'notifications':{'payment_success':_0x424999[_0x3c0217(0x6e)],'payment_failed':_0x424999[_0x3c0217(0xab)],'refund':_0x424999[_0x3c0217(0x83)],'payout':_0x424999['notificationPayout'],'login':_0x424999[_0x3c0217(0x7d)],'api_error':_0x424999[_0x3c0217(0xaf)]}};}async[a57_0x5f0bd0(0x93)](_0xb5eea,_0x50a862){const _0x5d9e37=a57_0x5f0bd0,{currentPassword:_0x1e1ece,newPassword:_0x31b59b,confirmNewPassword:_0x363036}=_0x50a862;if(_0x31b59b!==_0x363036)throw new Error(_0x5d9e37(0xa6));if(_0x31b59b['length']<0x6)throw new Error(_0x5d9e37(0xa4));const _0x48c93d=await database_1[_0x5d9e37(0x77)][_0x5d9e37(0x99)][_0x5d9e37(0x92)]({'where':{'id':_0xb5eea},'select':{'password':!![]}});if(!_0x48c93d)throw new Error(_0x5d9e37(0x79));const _0x14902e=await bcryptjs_1[_0x5d9e37(0x77)][_0x5d9e37(0x7f)](_0x1e1ece,_0x48c93d[_0x5d9e37(0x8a)]);if(!_0x14902e)throw new Error('Current\x20password\x20is\x20incorrect');const _0x588fcd=await bcryptjs_1['default'][_0x5d9e37(0xae)](_0x31b59b,0xc);await database_1[_0x5d9e37(0x77)][_0x5d9e37(0x99)]['update']({'where':{'id':_0xb5eea},'data':{'password':_0x588fcd}});}async[a57_0x5f0bd0(0x87)](_0x140b91,_0x1ddaaa){const _0x62ec43=a57_0x5f0bd0;await this['ensureSettingsExist'](_0x140b91);const _0x5b022a={};_0x1ddaaa[_0x62ec43(0xa1)]!==undefined&&(_0x5b022a[_0x62ec43(0x6e)]=_0x1ddaaa[_0x62ec43(0xa1)]),_0x1ddaaa['payment_failed']!==undefined&&(_0x5b022a[_0x62ec43(0xab)]=_0x1ddaaa[_0x62ec43(0xa8)]),_0x1ddaaa[_0x62ec43(0x7e)]!==undefined&&(_0x5b022a[_0x62ec43(0x83)]=_0x1ddaaa[_0x62ec43(0x7e)]),_0x1ddaaa[_0x62ec43(0x98)]!==undefined&&(_0x5b022a[_0x62ec43(0x75)]=_0x1ddaaa[_0x62ec43(0x98)]),_0x1ddaaa[_0x62ec43(0x71)]!==undefined&&(_0x5b022a['notificationLogin']=_0x1ddaaa[_0x62ec43(0x71)]),_0x1ddaaa[_0x62ec43(0x88)]!==undefined&&(_0x5b022a[_0x62ec43(0xaf)]=_0x1ddaaa[_0x62ec43(0x88)]),await database_1[_0x62ec43(0x77)][_0x62ec43(0x72)][_0x62ec43(0x8f)]({'where':{'shopId':_0x140b91},'data':_0x5b022a});}async[a57_0x5f0bd0(0x9b)](_0x5c363d,_0x303205){const _0x398037=a57_0x5f0bd0;await this[_0x398037(0x85)](_0x5c363d);const _0x158971={};_0x303205['botApiKey']!==undefined&&(_0x158971['telegramBotApiKey']=_0x303205['botApiKey']||null),_0x303205[_0x398037(0x70)]!==undefined&&(_0x158971[_0x398037(0xa5)]=_0x303205[_0x398037(0x70)]||null),await database_1[_0x398037(0x77)][_0x398037(0x72)][_0x398037(0x8f)]({'where':{'shopId':_0x5c363d},'data':_0x158971});}async[a57_0x5f0bd0(0x82)](_0x170c5b,_0x83bc25){const _0x5998db=a57_0x5f0bd0;await this[_0x5998db(0x85)](_0x170c5b);const _0x25afe2={};_0x83bc25[_0x5998db(0x9e)]!==undefined&&(_0x25afe2[_0x5998db(0x9e)]=_0x83bc25[_0x5998db(0x9e)]||null),_0x83bc25[_0x5998db(0x9f)]!==undefined&&(_0x25afe2['webhookEvents']=_0x83bc25[_0x5998db(0x9f)]||[]),await database_1[_0x5998db(0x77)]['shopSettings'][_0x5998db(0x8f)]({'where':{'shopId':_0x170c5b},'data':_0x25afe2});}async[a57_0x5f0bd0(0xaa)](_0x2566df){const _0x43374e=a57_0x5f0bd0,_0x460ee3=_0x43374e(0x8e)+crypto_1[_0x43374e(0x77)]['randomBytes'](0x20)['toString'](_0x43374e(0xac)),_0x4fb6b7='sk_'+crypto_1['default'][_0x43374e(0xa3)](0x20)[_0x43374e(0xa2)](_0x43374e(0xac));await database_1['default'][_0x43374e(0x99)][_0x43374e(0x8f)]({'where':{'id':_0x2566df},'data':{'publicKey':_0x460ee3,'secretKey':_0x4fb6b7}});}async[a57_0x5f0bd0(0x8d)](_0x78f384,_0x57dadb){const _0x58a180=a57_0x5f0bd0,{passwordConfirmation:_0x5200e9}=_0x57dadb,_0x35ad6a=await database_1['default'][_0x58a180(0x99)][_0x58a180(0x92)]({'where':{'id':_0x78f384},'select':{'password':!![]}});if(!_0x35ad6a)throw new Error('Shop\x20not\x20found');const _0x6659e9=await bcryptjs_1[_0x58a180(0x77)][_0x58a180(0x7f)](_0x5200e9,_0x35ad6a[_0x58a180(0x8a)]);if(!_0x6659e9)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1['default'][_0x58a180(0x99)][_0x58a180(0x86)]({'where':{'id':_0x78f384}});}async[a57_0x5f0bd0(0x85)](_0x1c7d27){const _0xeb3780=a57_0x5f0bd0,_0x457213=await database_1[_0xeb3780(0x77)][_0xeb3780(0x72)][_0xeb3780(0x92)]({'where':{'shopId':_0x1c7d27}});!_0x457213&&await database_1[_0xeb3780(0x77)][_0xeb3780(0x72)][_0xeb3780(0x78)]({'data':{'shopId':_0x1c7d27}});}}exports[a57_0x5f0bd0(0x7c)]=SettingsService;