'use strict';const a59_0x44db06=a59_0x4ebe;function a59_0x4ebe(_0x220b86,_0x2be525){const _0x2185dd=a59_0x2185();return a59_0x4ebe=function(_0x4ebe49,_0x2b8946){_0x4ebe49=_0x4ebe49-0x1da;let _0x5b494c=_0x2185dd[_0x4ebe49];return _0x5b494c;},a59_0x4ebe(_0x220b86,_0x2be525);}function a59_0x2185(){const _0x364bca=['randomBytes','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','findUnique','name','64659latnCM','crypto','682910HgTqob','parse','notificationPaymentSuccess','toString','ensureSettingsExist','delete','../config/database','notificationApiError','bcryptjs','getShopSettings','parseWebhookEvents','854520PaWNWR','notificationPayout','sk_','create','400433VvHQVy','30697Qdktqy','telegram','defineProperty','114oqkUyp','settings','updateWebhookSettings','telegramChatId','__importDefault','default','shopSettings','SettingsService','shopUrl','string','revokeAllApiKeys','login','webhookEvents','compare','21oVYrZK','api_error','isArray','__esModule','webhookUrl','deleteAccount','pk_','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','notificationPaymentFailed','refund','notificationRefund','shop','payment_success','length','update','password','telegramBotApiKey','substring','Current\x20password\x20is\x20incorrect','6cOtKUG','notificationLogin','545745tTRdMP','maskApiKey','payout','12THPdHg','Password\x20confirmation\x20is\x20incorrect','hash','61564ArDtcc','18vraMJn','botApiKey','payment_failed','chatId'];a59_0x2185=function(){return _0x364bca;};return a59_0x2185();}(function(_0x17944d,_0x6090d0){const _0x8da19b=a59_0x4ebe,_0x3ddd59=_0x17944d();while(!![]){try{const _0x5ab4ee=-parseInt(_0x8da19b(0x215))/0x1*(-parseInt(_0x8da19b(0x1f2))/0x2)+parseInt(_0x8da19b(0x1df))/0x3*(-parseInt(_0x8da19b(0x1fa))/0x4)+-parseInt(_0x8da19b(0x1f4))/0x5+parseInt(_0x8da19b(0x218))/0x6*(parseInt(_0x8da19b(0x203))/0x7)+-parseInt(_0x8da19b(0x210))/0x8+parseInt(_0x8da19b(0x1fb))/0x9*(parseInt(_0x8da19b(0x205))/0xa)+parseInt(_0x8da19b(0x214))/0xb*(parseInt(_0x8da19b(0x1f7))/0xc);if(_0x5ab4ee===_0x6090d0)break;else _0x3ddd59['push'](_0x3ddd59['shift']());}catch(_0x46b441){_0x3ddd59['push'](_0x3ddd59['shift']());}}}(a59_0x2185,0x1c88e));var __importDefault=this&&this[a59_0x44db06(0x21c)]||function(_0x559752){const _0x6a5add=a59_0x44db06;return _0x559752&&_0x559752[_0x6a5add(0x1e2)]?_0x559752:{'default':_0x559752};};Object[a59_0x44db06(0x217)](exports,a59_0x44db06(0x1e2),{'value':!![]}),exports[a59_0x44db06(0x21f)]=void 0x0;const bcryptjs_1=__importDefault(require(a59_0x44db06(0x20d))),crypto_1=__importDefault(require(a59_0x44db06(0x204))),database_1=__importDefault(require(a59_0x44db06(0x20b)));class SettingsService{['maskApiKey'](_0x559422){const _0x180fb7=a59_0x44db06;if(!_0x559422)return'';if(_0x559422[_0x180fb7(0x1ec)]<=0x8)return _0x559422;const _0xe6427d=_0x559422[_0x180fb7(0x1f0)](0x0,0x8),_0x24e97b='*'['repeat'](Math['max'](0x0,_0x559422[_0x180fb7(0x1ec)]-0x8));return _0xe6427d+_0x24e97b;}['parseWebhookEvents'](_0x13fe27){const _0x188ce6=a59_0x44db06;if(!_0x13fe27)return[];if(Array[_0x188ce6(0x1e1)](_0x13fe27))return _0x13fe27;if(typeof _0x13fe27===_0x188ce6(0x1da))try{const _0x87b484=JSON[_0x188ce6(0x206)](_0x13fe27);return Array[_0x188ce6(0x1e1)](_0x87b484)?_0x87b484:[];}catch{return[];}return[];}async[a59_0x44db06(0x20e)](_0x1ffdf3){const _0x24edd6=a59_0x44db06,_0x358e94=await database_1[_0x24edd6(0x21d)][_0x24edd6(0x1ea)]['findUnique']({'where':{'id':_0x1ffdf3},'include':{'settings':!![]}});if(!_0x358e94)throw new Error('Shop\x20not\x20found');let _0x3627c4=_0x358e94[_0x24edd6(0x219)];return!_0x3627c4&&(_0x3627c4=await database_1[_0x24edd6(0x21d)][_0x24edd6(0x21e)][_0x24edd6(0x213)]({'data':{'shopId':_0x358e94['id']}})),{'fullName':_0x358e94[_0x24edd6(0x202)],'brand':_0x358e94[_0x24edd6(0x202)],'merchantUrl':_0x358e94[_0x24edd6(0x220)],'telegramUsername':_0x358e94[_0x24edd6(0x216)],'telegramBotApiKey':_0x3627c4[_0x24edd6(0x1ef)]?this[_0x24edd6(0x1f5)](_0x3627c4['telegramBotApiKey']):null,'telegramChatId':_0x3627c4[_0x24edd6(0x21b)],'webhookUrl':_0x3627c4['webhookUrl'],'webhookEvents':this[_0x24edd6(0x20f)](_0x3627c4[_0x24edd6(0x1dd)]),'notifications':{'payment_success':_0x3627c4[_0x24edd6(0x207)],'payment_failed':_0x3627c4['notificationPaymentFailed'],'refund':_0x3627c4[_0x24edd6(0x1e9)],'payout':_0x3627c4[_0x24edd6(0x211)],'login':_0x3627c4[_0x24edd6(0x1f3)],'api_error':_0x3627c4[_0x24edd6(0x20c)]}};}async['changePassword'](_0x2b81bf,_0x266a2f){const _0x5d7b93=a59_0x44db06,{currentPassword:_0x312b6a,newPassword:_0x4ac7b9,confirmNewPassword:_0x200dce}=_0x266a2f;if(_0x4ac7b9!==_0x200dce)throw new Error(_0x5d7b93(0x200));if(_0x4ac7b9[_0x5d7b93(0x1ec)]<0x6)throw new Error(_0x5d7b93(0x1e6));const _0x5287e1=await database_1[_0x5d7b93(0x21d)][_0x5d7b93(0x1ea)][_0x5d7b93(0x201)]({'where':{'id':_0x2b81bf},'select':{'password':!![]}});if(!_0x5287e1)throw new Error('Shop\x20not\x20found');const _0x28c2ef=await bcryptjs_1[_0x5d7b93(0x21d)][_0x5d7b93(0x1de)](_0x312b6a,_0x5287e1[_0x5d7b93(0x1ee)]);if(!_0x28c2ef)throw new Error(_0x5d7b93(0x1f1));const _0x600463=await bcryptjs_1['default'][_0x5d7b93(0x1f9)](_0x4ac7b9,0xc);await database_1[_0x5d7b93(0x21d)]['shop'][_0x5d7b93(0x1ed)]({'where':{'id':_0x2b81bf},'data':{'password':_0x600463}});}async['updateNotifications'](_0x15f1c3,_0x68678c){const _0x2663c4=a59_0x44db06;await this[_0x2663c4(0x209)](_0x15f1c3);const _0x581cd7={};_0x68678c[_0x2663c4(0x1eb)]!==undefined&&(_0x581cd7['notificationPaymentSuccess']=_0x68678c[_0x2663c4(0x1eb)]),_0x68678c[_0x2663c4(0x1fd)]!==undefined&&(_0x581cd7[_0x2663c4(0x1e7)]=_0x68678c[_0x2663c4(0x1fd)]),_0x68678c[_0x2663c4(0x1e8)]!==undefined&&(_0x581cd7[_0x2663c4(0x1e9)]=_0x68678c[_0x2663c4(0x1e8)]),_0x68678c[_0x2663c4(0x1f6)]!==undefined&&(_0x581cd7[_0x2663c4(0x211)]=_0x68678c[_0x2663c4(0x1f6)]),_0x68678c[_0x2663c4(0x1dc)]!==undefined&&(_0x581cd7[_0x2663c4(0x1f3)]=_0x68678c[_0x2663c4(0x1dc)]),_0x68678c[_0x2663c4(0x1e0)]!==undefined&&(_0x581cd7['notificationApiError']=_0x68678c[_0x2663c4(0x1e0)]),await database_1[_0x2663c4(0x21d)][_0x2663c4(0x21e)][_0x2663c4(0x1ed)]({'where':{'shopId':_0x15f1c3},'data':_0x581cd7});}async['updateTelegramSettings'](_0xf6fc4e,_0x479bff){const _0x4e7c84=a59_0x44db06;await this[_0x4e7c84(0x209)](_0xf6fc4e);const _0x5f5135={};_0x479bff[_0x4e7c84(0x1fc)]!==undefined&&(_0x5f5135[_0x4e7c84(0x1ef)]=_0x479bff['botApiKey']||null),_0x479bff[_0x4e7c84(0x1fe)]!==undefined&&(_0x5f5135[_0x4e7c84(0x21b)]=_0x479bff['chatId']||null),await database_1[_0x4e7c84(0x21d)][_0x4e7c84(0x21e)]['update']({'where':{'shopId':_0xf6fc4e},'data':_0x5f5135});}async[a59_0x44db06(0x21a)](_0x1b4059,_0x20ca6b){const _0x416381=a59_0x44db06;await this['ensureSettingsExist'](_0x1b4059);const _0x42c153={};_0x20ca6b[_0x416381(0x1e3)]!==undefined&&(_0x42c153[_0x416381(0x1e3)]=_0x20ca6b['webhookUrl']||null),_0x20ca6b['webhookEvents']!==undefined&&(_0x42c153[_0x416381(0x1dd)]=_0x20ca6b[_0x416381(0x1dd)]||[]),await database_1[_0x416381(0x21d)][_0x416381(0x21e)][_0x416381(0x1ed)]({'where':{'shopId':_0x1b4059},'data':_0x42c153});}async[a59_0x44db06(0x1db)](_0xd042e4){const _0x160f93=a59_0x44db06,_0x2c0bb0=_0x160f93(0x1e5)+crypto_1[_0x160f93(0x21d)][_0x160f93(0x1ff)](0x20)['toString']('hex'),_0x5424d2=_0x160f93(0x212)+crypto_1[_0x160f93(0x21d)][_0x160f93(0x1ff)](0x20)[_0x160f93(0x208)]('hex');await database_1[_0x160f93(0x21d)][_0x160f93(0x1ea)]['update']({'where':{'id':_0xd042e4},'data':{'publicKey':_0x2c0bb0,'secretKey':_0x5424d2}});}async[a59_0x44db06(0x1e4)](_0x209053,_0x4c5315){const _0x17b5d1=a59_0x44db06,{passwordConfirmation:_0x5b10f9}=_0x4c5315,_0x4cc161=await database_1[_0x17b5d1(0x21d)]['shop']['findUnique']({'where':{'id':_0x209053},'select':{'password':!![]}});if(!_0x4cc161)throw new Error('Shop\x20not\x20found');const _0x2ca2f5=await bcryptjs_1[_0x17b5d1(0x21d)][_0x17b5d1(0x1de)](_0x5b10f9,_0x4cc161[_0x17b5d1(0x1ee)]);if(!_0x2ca2f5)throw new Error(_0x17b5d1(0x1f8));await database_1[_0x17b5d1(0x21d)][_0x17b5d1(0x1ea)][_0x17b5d1(0x20a)]({'where':{'id':_0x209053}});}async['ensureSettingsExist'](_0x472e51){const _0x15284c=a59_0x44db06,_0x222e2b=await database_1['default'][_0x15284c(0x21e)]['findUnique']({'where':{'shopId':_0x472e51}});!_0x222e2b&&await database_1[_0x15284c(0x21d)][_0x15284c(0x21e)][_0x15284c(0x213)]({'data':{'shopId':_0x472e51}});}}exports['SettingsService']=SettingsService;