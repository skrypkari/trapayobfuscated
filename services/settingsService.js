'use strict';const a52_0x23c217=a52_0x48be;function a52_0x1e44(){const _0x37e603=['webhookEvents','deleteAccount','1104306mEtMGk','__esModule','login','payment_success','payment_failed','updateWebhookSettings','ensureSettingsExist','payout','defineProperty','1926280akYCpq','toString','findUnique','notificationPaymentSuccess','getShopSettings','changePassword','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','delete','shop','bcryptjs','notificationRefund','sk_','__importDefault','api_error','73999KwbicK','799137aqhRUF','create','Shop\x20not\x20found','2zIPfjK','default','notificationLogin','parseWebhookEvents','9770dUKgzS','repeat','updateTelegramSettings','hex','crypto','Current\x20password\x20is\x20incorrect','notificationApiError','randomBytes','maskApiKey','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','settings','update','pk_','9XrHCPp','hash','revokeAllApiKeys','refund','260JvFIZW','Password\x20confirmation\x20is\x20incorrect','8301706zmNKiW','chatId','length','max','19622250AMZbsa','password','botApiKey','../config/database','compare','SettingsService','notificationPayout','updateNotifications','webhookUrl','telegramBotApiKey','isArray','shopSettings'];a52_0x1e44=function(){return _0x37e603;};return a52_0x1e44();}function a52_0x48be(_0x279d0b,_0x1478fd){const _0x1e4497=a52_0x1e44();return a52_0x48be=function(_0x48be02,_0x3ca6fc){_0x48be02=_0x48be02-0x162;let _0x25e18c=_0x1e4497[_0x48be02];return _0x25e18c;},a52_0x48be(_0x279d0b,_0x1478fd);}(function(_0x3facd4,_0x53ae60){const _0x1202ff=a52_0x48be,_0x32e617=_0x3facd4();while(!![]){try{const _0x39425c=parseInt(_0x1202ff(0x185))/0x1*(parseInt(_0x1202ff(0x189))/0x2)+-parseInt(_0x1202ff(0x186))/0x3+parseInt(_0x1202ff(0x19e))/0x4*(parseInt(_0x1202ff(0x18d))/0x5)+-parseInt(_0x1202ff(0x16e))/0x6+-parseInt(_0x1202ff(0x1a0))/0x7+parseInt(_0x1202ff(0x177))/0x8*(parseInt(_0x1202ff(0x19a))/0x9)+parseInt(_0x1202ff(0x1a4))/0xa;if(_0x39425c===_0x53ae60)break;else _0x32e617['push'](_0x32e617['shift']());}catch(_0x3d80da){_0x32e617['push'](_0x32e617['shift']());}}}(a52_0x1e44,0xbb68f));var __importDefault=this&&this[a52_0x23c217(0x183)]||function(_0x26dc33){return _0x26dc33&&_0x26dc33['__esModule']?_0x26dc33:{'default':_0x26dc33};};Object[a52_0x23c217(0x176)](exports,a52_0x23c217(0x16f),{'value':!![]}),exports[a52_0x23c217(0x165)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x23c217(0x180))),crypto_1=__importDefault(require(a52_0x23c217(0x191))),database_1=__importDefault(require(a52_0x23c217(0x163)));class SettingsService{[a52_0x23c217(0x195)](_0x5d1fa0){const _0x1b49ae=a52_0x23c217;if(!_0x5d1fa0)return'';if(_0x5d1fa0[_0x1b49ae(0x1a2)]<=0x8)return _0x5d1fa0;const _0x27e68a=_0x5d1fa0['substring'](0x0,0x8),_0x21b0ba='*'[_0x1b49ae(0x18e)](Math[_0x1b49ae(0x1a3)](0x0,_0x5d1fa0['length']-0x8));return _0x27e68a+_0x21b0ba;}[a52_0x23c217(0x18c)](_0x231498){const _0x24e95d=a52_0x23c217;if(!_0x231498)return[];if(Array[_0x24e95d(0x16a)](_0x231498))return _0x231498;if(typeof _0x231498==='string')try{const _0xf28c90=JSON['parse'](_0x231498);return Array[_0x24e95d(0x16a)](_0xf28c90)?_0xf28c90:[];}catch{return[];}return[];}async[a52_0x23c217(0x17b)](_0x4aec0f){const _0x285375=a52_0x23c217,_0x59b9ed=await database_1['default'][_0x285375(0x17f)]['findUnique']({'where':{'id':_0x4aec0f},'include':{'settings':!![]}});if(!_0x59b9ed)throw new Error(_0x285375(0x188));let _0x5cac6b=_0x59b9ed[_0x285375(0x197)];return!_0x5cac6b&&(_0x5cac6b=await database_1[_0x285375(0x18a)][_0x285375(0x16b)][_0x285375(0x187)]({'data':{'shopId':_0x59b9ed['id']}})),{'fullName':_0x59b9ed['name'],'brand':_0x59b9ed['name'],'merchantUrl':_0x59b9ed['shopUrl'],'telegramUsername':_0x59b9ed['telegram'],'telegramBotApiKey':_0x5cac6b[_0x285375(0x169)]?this['maskApiKey'](_0x5cac6b['telegramBotApiKey']):null,'telegramChatId':_0x5cac6b['telegramChatId'],'webhookUrl':_0x5cac6b[_0x285375(0x168)],'webhookEvents':this[_0x285375(0x18c)](_0x5cac6b[_0x285375(0x16c)]),'notifications':{'payment_success':_0x5cac6b['notificationPaymentSuccess'],'payment_failed':_0x5cac6b['notificationPaymentFailed'],'refund':_0x5cac6b[_0x285375(0x181)],'payout':_0x5cac6b[_0x285375(0x166)],'login':_0x5cac6b[_0x285375(0x18b)],'api_error':_0x5cac6b[_0x285375(0x193)]}};}async[a52_0x23c217(0x17c)](_0xb86c0c,_0x55d921){const _0x37f94a=a52_0x23c217,{currentPassword:_0x3bed7b,newPassword:_0x537fee,confirmNewPassword:_0x985800}=_0x55d921;if(_0x537fee!==_0x985800)throw new Error(_0x37f94a(0x196));if(_0x537fee[_0x37f94a(0x1a2)]<0x6)throw new Error(_0x37f94a(0x17d));const _0x345b01=await database_1['default'][_0x37f94a(0x17f)]['findUnique']({'where':{'id':_0xb86c0c},'select':{'password':!![]}});if(!_0x345b01)throw new Error('Shop\x20not\x20found');const _0x214138=await bcryptjs_1[_0x37f94a(0x18a)]['compare'](_0x3bed7b,_0x345b01[_0x37f94a(0x1a5)]);if(!_0x214138)throw new Error(_0x37f94a(0x192));const _0x501a74=await bcryptjs_1[_0x37f94a(0x18a)][_0x37f94a(0x19b)](_0x537fee,0xc);await database_1[_0x37f94a(0x18a)][_0x37f94a(0x17f)][_0x37f94a(0x198)]({'where':{'id':_0xb86c0c},'data':{'password':_0x501a74}});}async[a52_0x23c217(0x167)](_0x2965fc,_0x1f4b02){const _0x5de211=a52_0x23c217;await this[_0x5de211(0x174)](_0x2965fc);const _0x2881f6={};_0x1f4b02[_0x5de211(0x171)]!==undefined&&(_0x2881f6[_0x5de211(0x17a)]=_0x1f4b02[_0x5de211(0x171)]),_0x1f4b02['payment_failed']!==undefined&&(_0x2881f6['notificationPaymentFailed']=_0x1f4b02[_0x5de211(0x172)]),_0x1f4b02[_0x5de211(0x19d)]!==undefined&&(_0x2881f6['notificationRefund']=_0x1f4b02[_0x5de211(0x19d)]),_0x1f4b02[_0x5de211(0x175)]!==undefined&&(_0x2881f6[_0x5de211(0x166)]=_0x1f4b02[_0x5de211(0x175)]),_0x1f4b02[_0x5de211(0x170)]!==undefined&&(_0x2881f6[_0x5de211(0x18b)]=_0x1f4b02[_0x5de211(0x170)]),_0x1f4b02[_0x5de211(0x184)]!==undefined&&(_0x2881f6[_0x5de211(0x193)]=_0x1f4b02[_0x5de211(0x184)]),await database_1[_0x5de211(0x18a)][_0x5de211(0x16b)]['update']({'where':{'shopId':_0x2965fc},'data':_0x2881f6});}async[a52_0x23c217(0x18f)](_0x39e111,_0xd7974f){const _0x305ac3=a52_0x23c217;await this[_0x305ac3(0x174)](_0x39e111);const _0x926fa8={};_0xd7974f[_0x305ac3(0x162)]!==undefined&&(_0x926fa8[_0x305ac3(0x169)]=_0xd7974f[_0x305ac3(0x162)]||null),_0xd7974f[_0x305ac3(0x1a1)]!==undefined&&(_0x926fa8['telegramChatId']=_0xd7974f['chatId']||null),await database_1[_0x305ac3(0x18a)][_0x305ac3(0x16b)][_0x305ac3(0x198)]({'where':{'shopId':_0x39e111},'data':_0x926fa8});}async[a52_0x23c217(0x173)](_0x206857,_0x41d0c7){const _0x5d664f=a52_0x23c217;await this[_0x5d664f(0x174)](_0x206857);const _0x12bc06={};_0x41d0c7[_0x5d664f(0x168)]!==undefined&&(_0x12bc06[_0x5d664f(0x168)]=_0x41d0c7[_0x5d664f(0x168)]||null),_0x41d0c7[_0x5d664f(0x16c)]!==undefined&&(_0x12bc06[_0x5d664f(0x16c)]=_0x41d0c7[_0x5d664f(0x16c)]||[]),await database_1['default'][_0x5d664f(0x16b)][_0x5d664f(0x198)]({'where':{'shopId':_0x206857},'data':_0x12bc06});}async[a52_0x23c217(0x19c)](_0x22ef78){const _0x3a57cf=a52_0x23c217,_0x5c84af=_0x3a57cf(0x199)+crypto_1[_0x3a57cf(0x18a)][_0x3a57cf(0x194)](0x20)['toString']('hex'),_0x3ba306=_0x3a57cf(0x182)+crypto_1['default']['randomBytes'](0x20)[_0x3a57cf(0x178)](_0x3a57cf(0x190));await database_1[_0x3a57cf(0x18a)][_0x3a57cf(0x17f)][_0x3a57cf(0x198)]({'where':{'id':_0x22ef78},'data':{'publicKey':_0x5c84af,'secretKey':_0x3ba306}});}async[a52_0x23c217(0x16d)](_0x524b3e,_0x48e125){const _0x11cd4a=a52_0x23c217,{passwordConfirmation:_0x2ccc6b}=_0x48e125,_0x4aa845=await database_1[_0x11cd4a(0x18a)][_0x11cd4a(0x17f)][_0x11cd4a(0x179)]({'where':{'id':_0x524b3e},'select':{'password':!![]}});if(!_0x4aa845)throw new Error(_0x11cd4a(0x188));const _0x3e4b2f=await bcryptjs_1[_0x11cd4a(0x18a)][_0x11cd4a(0x164)](_0x2ccc6b,_0x4aa845[_0x11cd4a(0x1a5)]);if(!_0x3e4b2f)throw new Error(_0x11cd4a(0x19f));await database_1[_0x11cd4a(0x18a)]['shop'][_0x11cd4a(0x17e)]({'where':{'id':_0x524b3e}});}async[a52_0x23c217(0x174)](_0x5e03f6){const _0x5b4b06=a52_0x23c217,_0x31587a=await database_1[_0x5b4b06(0x18a)]['shopSettings'][_0x5b4b06(0x179)]({'where':{'shopId':_0x5e03f6}});!_0x31587a&&await database_1[_0x5b4b06(0x18a)][_0x5b4b06(0x16b)][_0x5b4b06(0x187)]({'data':{'shopId':_0x5e03f6}});}}exports[a52_0x23c217(0x165)]=SettingsService;