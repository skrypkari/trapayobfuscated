'use strict';const a53_0x38ef3c=a53_0x2d2b;function a53_0x2d2b(_0x2bc932,_0x3be795){const _0x4c7a9d=a53_0x4c7a();return a53_0x2d2b=function(_0x2d2b16,_0x1cca54){_0x2d2b16=_0x2d2b16-0x1e1;let _0x153e85=_0x4c7a9d[_0x2d2b16];return _0x153e85;},a53_0x2d2b(_0x2bc932,_0x3be795);}(function(_0x57a49b,_0x2defae){const _0x13559a=a53_0x2d2b,_0x5b6993=_0x57a49b();while(!![]){try{const _0x5b8d0a=-parseInt(_0x13559a(0x1fa))/0x1*(-parseInt(_0x13559a(0x1f6))/0x2)+parseInt(_0x13559a(0x200))/0x3+-parseInt(_0x13559a(0x1e3))/0x4*(-parseInt(_0x13559a(0x21b))/0x5)+parseInt(_0x13559a(0x220))/0x6*(-parseInt(_0x13559a(0x207))/0x7)+parseInt(_0x13559a(0x20f))/0x8+parseInt(_0x13559a(0x21c))/0x9*(-parseInt(_0x13559a(0x1ea))/0xa)+-parseInt(_0x13559a(0x1ed))/0xb*(parseInt(_0x13559a(0x213))/0xc);if(_0x5b8d0a===_0x2defae)break;else _0x5b6993['push'](_0x5b6993['shift']());}catch(_0x2ab823){_0x5b6993['push'](_0x5b6993['shift']());}}}(a53_0x4c7a,0xc84c5));var __importDefault=this&&this['__importDefault']||function(_0x276083){return _0x276083&&_0x276083['__esModule']?_0x276083:{'default':_0x276083};};function a53_0x4c7a(){const _0x3492e8=['hash','updateWebhookSettings','login','deleteAccount','2453814bKvzes','notificationPayout','default','name','telegramChatId','create','payout','8897iCwmyq','telegramBotApiKey','telegram','chatId','compare','notificationRefund','notificationLogin','notificationApiError','6186752TeTjbx','maskApiKey','webhookEvents','../config/database','48SpdBVS','length','randomBytes','shopUrl','delete','api_error','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','defineProperty','22735hVRfXm','458595HuJuQU','botApiKey','ensureSettingsExist','__esModule','3756eojmfG','parseWebhookEvents','crypto','updateNotifications','notificationPaymentFailed','Shop\x20not\x20found','revokeAllApiKeys','shop','shopSettings','changePassword','1172rybTlI','repeat','password','sk_','parse','payment_success','update','10lMyScT','payment_failed','findUnique','5595293EQDdtc','hex','webhookUrl','max','toString','pk_','notificationPaymentSuccess','refund','isArray','2ZISRnM','getShopSettings','substring','SettingsService','778121jOAbEW','Password\x20confirmation\x20is\x20incorrect'];a53_0x4c7a=function(){return _0x3492e8;};return a53_0x4c7a();}Object[a53_0x38ef3c(0x21a)](exports,a53_0x38ef3c(0x21f),{'value':!![]}),exports[a53_0x38ef3c(0x1f9)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a53_0x38ef3c(0x222))),database_1=__importDefault(require(a53_0x38ef3c(0x212)));class SettingsService{[a53_0x38ef3c(0x210)](_0x586e8d){const _0x36d2ee=a53_0x38ef3c;if(!_0x586e8d)return'';if(_0x586e8d[_0x36d2ee(0x214)]<=0x8)return _0x586e8d;const _0x31b3c6=_0x586e8d[_0x36d2ee(0x1f8)](0x0,0x8),_0x2a93f9='*'[_0x36d2ee(0x1e4)](Math[_0x36d2ee(0x1f0)](0x0,_0x586e8d[_0x36d2ee(0x214)]-0x8));return _0x31b3c6+_0x2a93f9;}[a53_0x38ef3c(0x221)](_0x503113){const _0x3c8df3=a53_0x38ef3c;if(!_0x503113)return[];if(Array[_0x3c8df3(0x1f5)](_0x503113))return _0x503113;if(typeof _0x503113==='string')try{const _0x1b33a2=JSON[_0x3c8df3(0x1e7)](_0x503113);return Array[_0x3c8df3(0x1f5)](_0x1b33a2)?_0x1b33a2:[];}catch{return[];}return[];}async[a53_0x38ef3c(0x1f7)](_0x4f3f89){const _0x456ab7=a53_0x38ef3c,_0x5aadaa=await database_1[_0x456ab7(0x202)][_0x456ab7(0x227)][_0x456ab7(0x1ec)]({'where':{'id':_0x4f3f89},'include':{'settings':!![]}});if(!_0x5aadaa)throw new Error(_0x456ab7(0x225));let _0x3fca7f=_0x5aadaa['settings'];return!_0x3fca7f&&(_0x3fca7f=await database_1[_0x456ab7(0x202)]['shopSettings'][_0x456ab7(0x205)]({'data':{'shopId':_0x5aadaa['id']}})),{'fullName':_0x5aadaa[_0x456ab7(0x203)],'brand':_0x5aadaa[_0x456ab7(0x203)],'merchantUrl':_0x5aadaa[_0x456ab7(0x216)],'telegramUsername':_0x5aadaa[_0x456ab7(0x209)],'telegramBotApiKey':_0x3fca7f[_0x456ab7(0x208)]?this[_0x456ab7(0x210)](_0x3fca7f[_0x456ab7(0x208)]):null,'telegramChatId':_0x3fca7f[_0x456ab7(0x204)],'webhookUrl':_0x3fca7f[_0x456ab7(0x1ef)],'webhookEvents':this['parseWebhookEvents'](_0x3fca7f[_0x456ab7(0x211)]),'notifications':{'payment_success':_0x3fca7f[_0x456ab7(0x1f3)],'payment_failed':_0x3fca7f['notificationPaymentFailed'],'refund':_0x3fca7f['notificationRefund'],'payout':_0x3fca7f[_0x456ab7(0x201)],'login':_0x3fca7f['notificationLogin'],'api_error':_0x3fca7f[_0x456ab7(0x20e)]}};}async[a53_0x38ef3c(0x1e2)](_0x44e079,_0x2aea89){const _0x430905=a53_0x38ef3c,{currentPassword:_0x6c4559,newPassword:_0x2727ed,confirmNewPassword:_0x182095}=_0x2aea89;if(_0x2727ed!==_0x182095)throw new Error(_0x430905(0x219));if(_0x2727ed[_0x430905(0x214)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0xf3ea62=await database_1[_0x430905(0x202)]['shop'][_0x430905(0x1ec)]({'where':{'id':_0x44e079},'select':{'password':!![]}});if(!_0xf3ea62)throw new Error(_0x430905(0x225));const _0x4b3ae9=await bcryptjs_1[_0x430905(0x202)][_0x430905(0x20b)](_0x6c4559,_0xf3ea62['password']);if(!_0x4b3ae9)throw new Error('Current\x20password\x20is\x20incorrect');const _0xab4654=await bcryptjs_1['default'][_0x430905(0x1fc)](_0x2727ed,0xc);await database_1[_0x430905(0x202)][_0x430905(0x227)]['update']({'where':{'id':_0x44e079},'data':{'password':_0xab4654}});}async[a53_0x38ef3c(0x223)](_0x7b1932,_0x313184){const _0x5503a9=a53_0x38ef3c;await this[_0x5503a9(0x21e)](_0x7b1932);const _0x20b780={};_0x313184[_0x5503a9(0x1e8)]!==undefined&&(_0x20b780['notificationPaymentSuccess']=_0x313184[_0x5503a9(0x1e8)]),_0x313184[_0x5503a9(0x1eb)]!==undefined&&(_0x20b780[_0x5503a9(0x224)]=_0x313184[_0x5503a9(0x1eb)]),_0x313184[_0x5503a9(0x1f4)]!==undefined&&(_0x20b780[_0x5503a9(0x20c)]=_0x313184[_0x5503a9(0x1f4)]),_0x313184[_0x5503a9(0x206)]!==undefined&&(_0x20b780[_0x5503a9(0x201)]=_0x313184['payout']),_0x313184[_0x5503a9(0x1fe)]!==undefined&&(_0x20b780[_0x5503a9(0x20d)]=_0x313184['login']),_0x313184['api_error']!==undefined&&(_0x20b780[_0x5503a9(0x20e)]=_0x313184[_0x5503a9(0x218)]),await database_1[_0x5503a9(0x202)][_0x5503a9(0x1e1)][_0x5503a9(0x1e9)]({'where':{'shopId':_0x7b1932},'data':_0x20b780});}async['updateTelegramSettings'](_0x4edd64,_0x448c90){const _0x1f9045=a53_0x38ef3c;await this[_0x1f9045(0x21e)](_0x4edd64);const _0x24b536={};_0x448c90[_0x1f9045(0x21d)]!==undefined&&(_0x24b536[_0x1f9045(0x208)]=_0x448c90['botApiKey']||null),_0x448c90[_0x1f9045(0x20a)]!==undefined&&(_0x24b536[_0x1f9045(0x204)]=_0x448c90[_0x1f9045(0x20a)]||null),await database_1[_0x1f9045(0x202)][_0x1f9045(0x1e1)]['update']({'where':{'shopId':_0x4edd64},'data':_0x24b536});}async[a53_0x38ef3c(0x1fd)](_0x151f29,_0x4c3d3b){const _0x276021=a53_0x38ef3c;await this[_0x276021(0x21e)](_0x151f29);const _0x2f0cb5={};_0x4c3d3b[_0x276021(0x1ef)]!==undefined&&(_0x2f0cb5[_0x276021(0x1ef)]=_0x4c3d3b[_0x276021(0x1ef)]||null),_0x4c3d3b[_0x276021(0x211)]!==undefined&&(_0x2f0cb5[_0x276021(0x211)]=_0x4c3d3b['webhookEvents']||[]),await database_1[_0x276021(0x202)]['shopSettings'][_0x276021(0x1e9)]({'where':{'shopId':_0x151f29},'data':_0x2f0cb5});}async[a53_0x38ef3c(0x226)](_0x2d078c){const _0x3af95d=a53_0x38ef3c,_0xca2a63=_0x3af95d(0x1f2)+crypto_1[_0x3af95d(0x202)][_0x3af95d(0x215)](0x20)['toString'](_0x3af95d(0x1ee)),_0x1a9987=_0x3af95d(0x1e6)+crypto_1['default'][_0x3af95d(0x215)](0x20)[_0x3af95d(0x1f1)](_0x3af95d(0x1ee));await database_1[_0x3af95d(0x202)][_0x3af95d(0x227)][_0x3af95d(0x1e9)]({'where':{'id':_0x2d078c},'data':{'publicKey':_0xca2a63,'secretKey':_0x1a9987}});}async[a53_0x38ef3c(0x1ff)](_0x2e5513,_0x1a84cc){const _0x55e422=a53_0x38ef3c,{passwordConfirmation:_0x36c15a}=_0x1a84cc,_0x391249=await database_1[_0x55e422(0x202)][_0x55e422(0x227)][_0x55e422(0x1ec)]({'where':{'id':_0x2e5513},'select':{'password':!![]}});if(!_0x391249)throw new Error(_0x55e422(0x225));const _0x5e2187=await bcryptjs_1[_0x55e422(0x202)]['compare'](_0x36c15a,_0x391249[_0x55e422(0x1e5)]);if(!_0x5e2187)throw new Error(_0x55e422(0x1fb));await database_1[_0x55e422(0x202)][_0x55e422(0x227)][_0x55e422(0x217)]({'where':{'id':_0x2e5513}});}async['ensureSettingsExist'](_0x112ec0){const _0x1aed2b=a53_0x38ef3c,_0x272f84=await database_1['default'][_0x1aed2b(0x1e1)][_0x1aed2b(0x1ec)]({'where':{'shopId':_0x112ec0}});!_0x272f84&&await database_1[_0x1aed2b(0x202)][_0x1aed2b(0x1e1)][_0x1aed2b(0x205)]({'data':{'shopId':_0x112ec0}});}}exports[a53_0x38ef3c(0x1f9)]=SettingsService;