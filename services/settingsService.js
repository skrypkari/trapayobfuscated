'use strict';const a52_0x4fbe29=a52_0xa4c3;(function(_0x548c8d,_0x86c155){const _0x605277=a52_0xa4c3,_0x37cc2a=_0x548c8d();while(!![]){try{const _0x2abfd9=-parseInt(_0x605277(0x140))/0x1*(-parseInt(_0x605277(0x179))/0x2)+parseInt(_0x605277(0x16c))/0x3*(parseInt(_0x605277(0x169))/0x4)+parseInt(_0x605277(0x144))/0x5*(parseInt(_0x605277(0x176))/0x6)+parseInt(_0x605277(0x15e))/0x7*(-parseInt(_0x605277(0x173))/0x8)+parseInt(_0x605277(0x164))/0x9+parseInt(_0x605277(0x157))/0xa+-parseInt(_0x605277(0x14e))/0xb;if(_0x2abfd9===_0x86c155)break;else _0x37cc2a['push'](_0x37cc2a['shift']());}catch(_0x4248b2){_0x37cc2a['push'](_0x37cc2a['shift']());}}}(a52_0x1f88,0xbab6d));function a52_0xa4c3(_0x4044b6,_0x41d648){const _0x1f88a4=a52_0x1f88();return a52_0xa4c3=function(_0xa4c373,_0x13727f){_0xa4c373=_0xa4c373-0x13c;let _0x196924=_0x1f88a4[_0xa4c373];return _0x196924;},a52_0xa4c3(_0x4044b6,_0x41d648);}var __importDefault=this&&this[a52_0x4fbe29(0x13e)]||function(_0x57ea4e){const _0x147aae=a52_0x4fbe29;return _0x57ea4e&&_0x57ea4e[_0x147aae(0x145)]?_0x57ea4e:{'default':_0x57ea4e};};Object[a52_0x4fbe29(0x172)](exports,a52_0x4fbe29(0x145),{'value':!![]}),exports[a52_0x4fbe29(0x153)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x4fbe29(0x14f))),crypto_1=__importDefault(require(a52_0x4fbe29(0x143))),database_1=__importDefault(require(a52_0x4fbe29(0x150)));class SettingsService{[a52_0x4fbe29(0x161)](_0x5b40b6){const _0x1f2158=a52_0x4fbe29;if(!_0x5b40b6)return'';if(_0x5b40b6['length']<=0x8)return _0x5b40b6;const _0x3a09c7=_0x5b40b6[_0x1f2158(0x17c)](0x0,0x8),_0x159a43='*'['repeat'](Math[_0x1f2158(0x13f)](0x0,_0x5b40b6['length']-0x8));return _0x3a09c7+_0x159a43;}[a52_0x4fbe29(0x168)](_0xedbd5e){const _0x25a760=a52_0x4fbe29;if(!_0xedbd5e)return[];if(Array['isArray'](_0xedbd5e))return _0xedbd5e;if(typeof _0xedbd5e===_0x25a760(0x15f))try{const _0x42c4ea=JSON[_0x25a760(0x16e)](_0xedbd5e);return Array[_0x25a760(0x14d)](_0x42c4ea)?_0x42c4ea:[];}catch{return[];}return[];}async[a52_0x4fbe29(0x17f)](_0x542137){const _0x20ee2f=a52_0x4fbe29,_0x5cddf2=await database_1['default'][_0x20ee2f(0x16f)][_0x20ee2f(0x16b)]({'where':{'id':_0x542137},'include':{'settings':!![]}});if(!_0x5cddf2)throw new Error(_0x20ee2f(0x182));let _0xaeb7c0=_0x5cddf2[_0x20ee2f(0x148)];return!_0xaeb7c0&&(_0xaeb7c0=await database_1[_0x20ee2f(0x177)][_0x20ee2f(0x178)]['create']({'data':{'shopId':_0x5cddf2['id']}})),{'fullName':_0x5cddf2['name'],'brand':_0x5cddf2[_0x20ee2f(0x166)],'merchantUrl':_0x5cddf2[_0x20ee2f(0x171)],'telegramUsername':_0x5cddf2[_0x20ee2f(0x170)],'telegramBotApiKey':_0xaeb7c0[_0x20ee2f(0x142)]?this[_0x20ee2f(0x161)](_0xaeb7c0['telegramBotApiKey']):null,'telegramChatId':_0xaeb7c0[_0x20ee2f(0x17e)],'webhookUrl':_0xaeb7c0[_0x20ee2f(0x181)],'webhookEvents':this['parseWebhookEvents'](_0xaeb7c0[_0x20ee2f(0x14a)]),'notifications':{'payment_success':_0xaeb7c0['notificationPaymentSuccess'],'payment_failed':_0xaeb7c0[_0x20ee2f(0x13d)],'refund':_0xaeb7c0['notificationRefund'],'payout':_0xaeb7c0['notificationPayout'],'login':_0xaeb7c0[_0x20ee2f(0x167)],'api_error':_0xaeb7c0[_0x20ee2f(0x16a)]}};}async[a52_0x4fbe29(0x165)](_0x108afd,_0x191930){const _0x4ae4e8=a52_0x4fbe29,{currentPassword:_0x5ae35b,newPassword:_0x3fb776,confirmNewPassword:_0x364084}=_0x191930;if(_0x3fb776!==_0x364084)throw new Error(_0x4ae4e8(0x152));if(_0x3fb776['length']<0x6)throw new Error(_0x4ae4e8(0x14b));const _0x629b38=await database_1[_0x4ae4e8(0x177)][_0x4ae4e8(0x16f)][_0x4ae4e8(0x16b)]({'where':{'id':_0x108afd},'select':{'password':!![]}});if(!_0x629b38)throw new Error(_0x4ae4e8(0x182));const _0x22a40f=await bcryptjs_1[_0x4ae4e8(0x177)][_0x4ae4e8(0x154)](_0x5ae35b,_0x629b38[_0x4ae4e8(0x13c)]);if(!_0x22a40f)throw new Error(_0x4ae4e8(0x147));const _0xbe71d5=await bcryptjs_1[_0x4ae4e8(0x177)]['hash'](_0x3fb776,0xc);await database_1[_0x4ae4e8(0x177)][_0x4ae4e8(0x16f)][_0x4ae4e8(0x16d)]({'where':{'id':_0x108afd},'data':{'password':_0xbe71d5}});}async[a52_0x4fbe29(0x162)](_0x36f22f,_0x29fd2e){const _0x2b1b64=a52_0x4fbe29;await this['ensureSettingsExist'](_0x36f22f);const _0x2432ae={};_0x29fd2e[_0x2b1b64(0x15a)]!==undefined&&(_0x2432ae[_0x2b1b64(0x14c)]=_0x29fd2e[_0x2b1b64(0x15a)]),_0x29fd2e['payment_failed']!==undefined&&(_0x2432ae[_0x2b1b64(0x13d)]=_0x29fd2e[_0x2b1b64(0x156)]),_0x29fd2e[_0x2b1b64(0x180)]!==undefined&&(_0x2432ae[_0x2b1b64(0x146)]=_0x29fd2e[_0x2b1b64(0x180)]),_0x29fd2e['payout']!==undefined&&(_0x2432ae[_0x2b1b64(0x17d)]=_0x29fd2e[_0x2b1b64(0x15b)]),_0x29fd2e[_0x2b1b64(0x163)]!==undefined&&(_0x2432ae[_0x2b1b64(0x167)]=_0x29fd2e[_0x2b1b64(0x163)]),_0x29fd2e['api_error']!==undefined&&(_0x2432ae[_0x2b1b64(0x16a)]=_0x29fd2e['api_error']),await database_1[_0x2b1b64(0x177)]['shopSettings'][_0x2b1b64(0x16d)]({'where':{'shopId':_0x36f22f},'data':_0x2432ae});}async[a52_0x4fbe29(0x159)](_0xb3840f,_0x2d83f9){const _0x1ebe16=a52_0x4fbe29;await this[_0x1ebe16(0x174)](_0xb3840f);const _0x2dd67d={};_0x2d83f9[_0x1ebe16(0x15d)]!==undefined&&(_0x2dd67d[_0x1ebe16(0x142)]=_0x2d83f9['botApiKey']||null),_0x2d83f9[_0x1ebe16(0x17b)]!==undefined&&(_0x2dd67d[_0x1ebe16(0x17e)]=_0x2d83f9[_0x1ebe16(0x17b)]||null),await database_1[_0x1ebe16(0x177)][_0x1ebe16(0x178)][_0x1ebe16(0x16d)]({'where':{'shopId':_0xb3840f},'data':_0x2dd67d});}async[a52_0x4fbe29(0x155)](_0x2b167c,_0x1d0c41){const _0x4f1650=a52_0x4fbe29;await this[_0x4f1650(0x174)](_0x2b167c);const _0xe8c422={};_0x1d0c41[_0x4f1650(0x181)]!==undefined&&(_0xe8c422['webhookUrl']=_0x1d0c41[_0x4f1650(0x181)]||null),_0x1d0c41[_0x4f1650(0x14a)]!==undefined&&(_0xe8c422[_0x4f1650(0x14a)]=_0x1d0c41['webhookEvents']||[]),await database_1[_0x4f1650(0x177)]['shopSettings'][_0x4f1650(0x16d)]({'where':{'shopId':_0x2b167c},'data':_0xe8c422});}async[a52_0x4fbe29(0x149)](_0x50bd6d){const _0x1ba8a0=a52_0x4fbe29,_0x304765=_0x1ba8a0(0x158)+crypto_1['default'][_0x1ba8a0(0x151)](0x20)[_0x1ba8a0(0x175)](_0x1ba8a0(0x15c)),_0xbdc030='sk_'+crypto_1[_0x1ba8a0(0x177)]['randomBytes'](0x20)['toString'](_0x1ba8a0(0x15c));await database_1[_0x1ba8a0(0x177)][_0x1ba8a0(0x16f)][_0x1ba8a0(0x16d)]({'where':{'id':_0x50bd6d},'data':{'publicKey':_0x304765,'secretKey':_0xbdc030}});}async[a52_0x4fbe29(0x141)](_0x48fecb,_0xa289d0){const _0x44d29c=a52_0x4fbe29,{passwordConfirmation:_0x3d2eb0}=_0xa289d0,_0x28e510=await database_1[_0x44d29c(0x177)][_0x44d29c(0x16f)][_0x44d29c(0x16b)]({'where':{'id':_0x48fecb},'select':{'password':!![]}});if(!_0x28e510)throw new Error('Shop\x20not\x20found');const _0x3a8073=await bcryptjs_1[_0x44d29c(0x177)][_0x44d29c(0x154)](_0x3d2eb0,_0x28e510[_0x44d29c(0x13c)]);if(!_0x3a8073)throw new Error(_0x44d29c(0x17a));await database_1['default'][_0x44d29c(0x16f)][_0x44d29c(0x160)]({'where':{'id':_0x48fecb}});}async['ensureSettingsExist'](_0x45923a){const _0x1bf4a3=a52_0x4fbe29,_0x1da65b=await database_1[_0x1bf4a3(0x177)][_0x1bf4a3(0x178)]['findUnique']({'where':{'shopId':_0x45923a}});!_0x1da65b&&await database_1['default']['shopSettings']['create']({'data':{'shopId':_0x45923a}});}}exports['SettingsService']=SettingsService;function a52_0x1f88(){const _0x103b47=['changePassword','name','notificationLogin','parseWebhookEvents','326264dHfprM','notificationApiError','findUnique','27nXDIFB','update','parse','shop','telegram','shopUrl','defineProperty','49152WGtUbw','ensureSettingsExist','toString','6rLLXeJ','default','shopSettings','14nFhNFT','Password\x20confirmation\x20is\x20incorrect','chatId','substring','notificationPayout','telegramChatId','getShopSettings','refund','webhookUrl','Shop\x20not\x20found','password','notificationPaymentFailed','__importDefault','max','151449LVqHjU','deleteAccount','telegramBotApiKey','crypto','4256125vbbYfw','__esModule','notificationRefund','Current\x20password\x20is\x20incorrect','settings','revokeAllApiKeys','webhookEvents','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','notificationPaymentSuccess','isArray','16920013dmumvh','bcryptjs','../config/database','randomBytes','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','SettingsService','compare','updateWebhookSettings','payment_failed','2156430SvCSjX','pk_','updateTelegramSettings','payment_success','payout','hex','botApiKey','1337Klmpgr','string','delete','maskApiKey','updateNotifications','login','5538267rCAVLk'];a52_0x1f88=function(){return _0x103b47;};return a52_0x1f88();}