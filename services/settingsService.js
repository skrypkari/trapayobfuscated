'use strict';function a51_0x37bf(_0x412b3a,_0x217fa8){const _0x526aab=a51_0x526a();return a51_0x37bf=function(_0x37bf64,_0x1e215e){_0x37bf64=_0x37bf64-0x97;let _0x10636c=_0x526aab[_0x37bf64];return _0x10636c;},a51_0x37bf(_0x412b3a,_0x217fa8);}const a51_0x137233=a51_0x37bf;(function(_0x2d3f0f,_0x2c29a9){const _0x29effb=a51_0x37bf,_0x2e90c0=_0x2d3f0f();while(!![]){try{const _0x33646b=parseInt(_0x29effb(0x9d))/0x1*(parseInt(_0x29effb(0xb0))/0x2)+parseInt(_0x29effb(0xdb))/0x3+-parseInt(_0x29effb(0xc6))/0x4*(-parseInt(_0x29effb(0xc4))/0x5)+parseInt(_0x29effb(0xaf))/0x6*(parseInt(_0x29effb(0xc1))/0x7)+parseInt(_0x29effb(0xd3))/0x8*(-parseInt(_0x29effb(0xce))/0x9)+-parseInt(_0x29effb(0xca))/0xa+-parseInt(_0x29effb(0xa0))/0xb*(parseInt(_0x29effb(0xd6))/0xc);if(_0x33646b===_0x2c29a9)break;else _0x2e90c0['push'](_0x2e90c0['shift']());}catch(_0x49ff54){_0x2e90c0['push'](_0x2e90c0['shift']());}}}(a51_0x526a,0x325f8));var __importDefault=this&&this['__importDefault']||function(_0x39a2ab){const _0x56b397=a51_0x37bf;return _0x39a2ab&&_0x39a2ab[_0x56b397(0xd8)]?_0x39a2ab:{'default':_0x39a2ab};};Object['defineProperty'](exports,a51_0x137233(0xd8),{'value':!![]}),exports[a51_0x137233(0xd2)]=void 0x0;const bcryptjs_1=__importDefault(require(a51_0x137233(0xa5))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a51_0x137233(0xc0)));class SettingsService{[a51_0x137233(0xb5)](_0x5e5a28){const _0x4b2ee6=a51_0x137233;if(!_0x5e5a28)return'';if(_0x5e5a28[_0x4b2ee6(0xcb)]<=0x8)return _0x5e5a28;const _0x7d8770=_0x5e5a28[_0x4b2ee6(0xae)](0x0,0x8),_0x175931='*'[_0x4b2ee6(0xda)](Math[_0x4b2ee6(0xa3)](0x0,_0x5e5a28[_0x4b2ee6(0xcb)]-0x8));return _0x7d8770+_0x175931;}['parseWebhookEvents'](_0x1fec87){const _0x2c35bc=a51_0x137233;if(!_0x1fec87)return[];if(Array[_0x2c35bc(0xbe)](_0x1fec87))return _0x1fec87;if(typeof _0x1fec87===_0x2c35bc(0xad))try{const _0x4fd486=JSON['parse'](_0x1fec87);return Array[_0x2c35bc(0xbe)](_0x4fd486)?_0x4fd486:[];}catch{return[];}return[];}async[a51_0x137233(0xb3)](_0x244327){const _0x9cb3ce=a51_0x137233,_0x4aaf04=await database_1['default'][_0x9cb3ce(0xd9)]['findUnique']({'where':{'id':_0x244327},'include':{'settings':!![]}});if(!_0x4aaf04)throw new Error(_0x9cb3ce(0xcd));let _0x20e712=_0x4aaf04['settings'];return!_0x20e712&&(_0x20e712=await database_1[_0x9cb3ce(0xb8)][_0x9cb3ce(0xa6)]['create']({'data':{'shopId':_0x4aaf04['id']}})),{'fullName':_0x4aaf04[_0x9cb3ce(0x9f)],'brand':_0x4aaf04[_0x9cb3ce(0x9f)],'merchantUrl':_0x4aaf04[_0x9cb3ce(0xbd)],'telegramUsername':_0x4aaf04[_0x9cb3ce(0x97)],'telegramBotApiKey':_0x20e712['telegramBotApiKey']?this[_0x9cb3ce(0xb5)](_0x20e712[_0x9cb3ce(0x9c)]):null,'telegramChatId':_0x20e712[_0x9cb3ce(0xa7)],'webhookUrl':_0x20e712['webhookUrl'],'webhookEvents':this[_0x9cb3ce(0xa9)](_0x20e712[_0x9cb3ce(0xac)]),'notifications':{'payment_success':_0x20e712['notificationPaymentSuccess'],'payment_failed':_0x20e712[_0x9cb3ce(0xc3)],'refund':_0x20e712[_0x9cb3ce(0x98)],'payout':_0x20e712[_0x9cb3ce(0xa2)],'login':_0x20e712[_0x9cb3ce(0xd5)],'api_error':_0x20e712[_0x9cb3ce(0x99)]}};}async[a51_0x137233(0xd4)](_0x4a677b,_0x304658){const _0x51091c=a51_0x137233,{currentPassword:_0xb2b8fe,newPassword:_0x225453,confirmNewPassword:_0x567dd9}=_0x304658;if(_0x225453!==_0x567dd9)throw new Error(_0x51091c(0xa4));if(_0x225453[_0x51091c(0xcb)]<0x6)throw new Error(_0x51091c(0xa1));const _0x4a65aa=await database_1[_0x51091c(0xb8)][_0x51091c(0xd9)][_0x51091c(0xb1)]({'where':{'id':_0x4a677b},'select':{'password':!![]}});if(!_0x4a65aa)throw new Error('Shop\x20not\x20found');const _0x55311b=await bcryptjs_1['default'][_0x51091c(0xcc)](_0xb2b8fe,_0x4a65aa[_0x51091c(0xb6)]);if(!_0x55311b)throw new Error('Current\x20password\x20is\x20incorrect');const _0x400e79=await bcryptjs_1[_0x51091c(0xb8)][_0x51091c(0xcf)](_0x225453,0xc);await database_1['default'][_0x51091c(0xd9)][_0x51091c(0xab)]({'where':{'id':_0x4a677b},'data':{'password':_0x400e79}});}async['updateNotifications'](_0x5c6dd1,_0x2d9a8f){const _0x4641a7=a51_0x137233;await this[_0x4641a7(0xc9)](_0x5c6dd1);const _0x11b82d={};_0x2d9a8f[_0x4641a7(0x9e)]!==undefined&&(_0x11b82d[_0x4641a7(0xc2)]=_0x2d9a8f['payment_success']),_0x2d9a8f[_0x4641a7(0xc7)]!==undefined&&(_0x11b82d['notificationPaymentFailed']=_0x2d9a8f[_0x4641a7(0xc7)]),_0x2d9a8f[_0x4641a7(0xb9)]!==undefined&&(_0x11b82d[_0x4641a7(0x98)]=_0x2d9a8f[_0x4641a7(0xb9)]),_0x2d9a8f[_0x4641a7(0xaa)]!==undefined&&(_0x11b82d[_0x4641a7(0xa2)]=_0x2d9a8f[_0x4641a7(0xaa)]),_0x2d9a8f[_0x4641a7(0xba)]!==undefined&&(_0x11b82d[_0x4641a7(0xd5)]=_0x2d9a8f[_0x4641a7(0xba)]),_0x2d9a8f[_0x4641a7(0xc5)]!==undefined&&(_0x11b82d['notificationApiError']=_0x2d9a8f['api_error']),await database_1[_0x4641a7(0xb8)]['shopSettings'][_0x4641a7(0xab)]({'where':{'shopId':_0x5c6dd1},'data':_0x11b82d});}async['updateTelegramSettings'](_0x2aebbc,_0x5ec290){const _0x1ac157=a51_0x137233;await this[_0x1ac157(0xc9)](_0x2aebbc);const _0x1043a3={};_0x5ec290['botApiKey']!==undefined&&(_0x1043a3[_0x1ac157(0x9c)]=_0x5ec290[_0x1ac157(0x9b)]||null),_0x5ec290[_0x1ac157(0xb2)]!==undefined&&(_0x1043a3[_0x1ac157(0xa7)]=_0x5ec290[_0x1ac157(0xb2)]||null),await database_1[_0x1ac157(0xb8)][_0x1ac157(0xa6)][_0x1ac157(0xab)]({'where':{'shopId':_0x2aebbc},'data':_0x1043a3});}async[a51_0x137233(0xbb)](_0x59b205,_0x3ad27b){const _0x290607=a51_0x137233;await this[_0x290607(0xc9)](_0x59b205);const _0x44d627={};_0x3ad27b[_0x290607(0x9a)]!==undefined&&(_0x44d627[_0x290607(0x9a)]=_0x3ad27b[_0x290607(0x9a)]||null),_0x3ad27b[_0x290607(0xac)]!==undefined&&(_0x44d627['webhookEvents']=_0x3ad27b['webhookEvents']||[]),await database_1['default'][_0x290607(0xa6)][_0x290607(0xab)]({'where':{'shopId':_0x59b205},'data':_0x44d627});}async[a51_0x137233(0xd1)](_0x46b90c){const _0x45ec56=a51_0x137233,_0x4f8bd6=_0x45ec56(0xc8)+crypto_1['default'][_0x45ec56(0xbf)](0x20)[_0x45ec56(0xbc)](_0x45ec56(0xd7)),_0x3382d7=_0x45ec56(0xa8)+crypto_1['default'][_0x45ec56(0xbf)](0x20)[_0x45ec56(0xbc)](_0x45ec56(0xd7));await database_1['default'][_0x45ec56(0xd9)][_0x45ec56(0xab)]({'where':{'id':_0x46b90c},'data':{'publicKey':_0x4f8bd6,'secretKey':_0x3382d7}});}async[a51_0x137233(0xb4)](_0x362ecc,_0x4e025f){const _0xca105b=a51_0x137233,{passwordConfirmation:_0x26ec03}=_0x4e025f,_0x275a95=await database_1[_0xca105b(0xb8)][_0xca105b(0xd9)][_0xca105b(0xb1)]({'where':{'id':_0x362ecc},'select':{'password':!![]}});if(!_0x275a95)throw new Error(_0xca105b(0xcd));const _0x5d5e7a=await bcryptjs_1[_0xca105b(0xb8)]['compare'](_0x26ec03,_0x275a95[_0xca105b(0xb6)]);if(!_0x5d5e7a)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0xca105b(0xb8)]['shop'][_0xca105b(0xb7)]({'where':{'id':_0x362ecc}});}async['ensureSettingsExist'](_0x540624){const _0x2a669f=a51_0x137233,_0x241ca9=await database_1[_0x2a669f(0xb8)][_0x2a669f(0xa6)][_0x2a669f(0xb1)]({'where':{'shopId':_0x540624}});!_0x241ca9&&await database_1[_0x2a669f(0xb8)]['shopSettings'][_0x2a669f(0xd0)]({'data':{'shopId':_0x540624}});}}exports[a51_0x137233(0xd2)]=SettingsService;function a51_0x526a(){const _0x32b91a=['repeat','1214247zmvwJm','telegram','notificationRefund','notificationApiError','webhookUrl','botApiKey','telegramBotApiKey','69ylrxTN','payment_success','name','11sWlrvr','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','notificationPayout','max','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','bcryptjs','shopSettings','telegramChatId','sk_','parseWebhookEvents','payout','update','webhookEvents','string','substring','1206738tVQSXl','2062SrRSKa','findUnique','chatId','getShopSettings','deleteAccount','maskApiKey','password','delete','default','refund','login','updateWebhookSettings','toString','shopUrl','isArray','randomBytes','../config/database','7nZxBWx','notificationPaymentSuccess','notificationPaymentFailed','1185aEEUWL','api_error','324wSPGtN','payment_failed','pk_','ensureSettingsExist','1214850DBjisC','length','compare','Shop\x20not\x20found','9ZsphJO','hash','create','revokeAllApiKeys','SettingsService','2143592CreShB','changePassword','notificationLogin','1205352skQgVp','hex','__esModule','shop'];a51_0x526a=function(){return _0x32b91a;};return a51_0x526a();}