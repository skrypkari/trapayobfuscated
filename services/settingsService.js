'use strict';const a52_0x21c77d=a52_0x3a86;(function(_0x3d6782,_0x19ddf3){const _0x1fc2a8=a52_0x3a86,_0x4121a5=_0x3d6782();while(!![]){try{const _0xbff386=parseInt(_0x1fc2a8(0xa3))/0x1*(parseInt(_0x1fc2a8(0xd6))/0x2)+parseInt(_0x1fc2a8(0xaa))/0x3*(parseInt(_0x1fc2a8(0xc3))/0x4)+-parseInt(_0x1fc2a8(0xbf))/0x5+-parseInt(_0x1fc2a8(0xc4))/0x6*(parseInt(_0x1fc2a8(0x96))/0x7)+parseInt(_0x1fc2a8(0xb8))/0x8+-parseInt(_0x1fc2a8(0xbd))/0x9+parseInt(_0x1fc2a8(0xdd))/0xa*(parseInt(_0x1fc2a8(0xdc))/0xb);if(_0xbff386===_0x19ddf3)break;else _0x4121a5['push'](_0x4121a5['shift']());}catch(_0x5f59f6){_0x4121a5['push'](_0x4121a5['shift']());}}}(a52_0x1333,0x5d499));function a52_0x1333(){const _0x29a41f=['shopSettings','7LlQcxb','name','pk_','shop','revokeAllApiKeys','ensureSettingsExist','payment_failed','hash','Shop\x20not\x20found','notificationApiError','notificationPayout','botApiKey','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','1ccGfdH','length','telegramBotApiKey','isArray','api_error','../config/database','hex','18jHYVrQ','notificationLogin','compare','webhookEvents','randomBytes','refund','getShopSettings','max','Password\x20confirmation\x20is\x20incorrect','updateTelegramSettings','__esModule','updateNotifications','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','default','3485168YAajfV','deleteAccount','payment_success','defineProperty','chatId','3570786HndqPq','substring','2932450jvoKGC','crypto','webhookUrl','maskApiKey','8220aygfuc','3452826LwDzza','toString','notificationPaymentSuccess','login','Current\x20password\x20is\x20incorrect','password','telegramChatId','create','telegram','findUnique','settings','SettingsService','notificationRefund','payout','string','shopUrl','__importDefault','update','13432iMbyRE','bcryptjs','updateWebhookSettings','parse','parseWebhookEvents','repeat','462czkVfb','353840yklIYh'];a52_0x1333=function(){return _0x29a41f;};return a52_0x1333();}var __importDefault=this&&this[a52_0x21c77d(0xd4)]||function(_0x4f67c0){const _0x5a3a28=a52_0x21c77d;return _0x4f67c0&&_0x4f67c0[_0x5a3a28(0xb4)]?_0x4f67c0:{'default':_0x4f67c0};};Object[a52_0x21c77d(0xbb)](exports,'__esModule',{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x21c77d(0xd7))),crypto_1=__importDefault(require(a52_0x21c77d(0xc0))),database_1=__importDefault(require(a52_0x21c77d(0xa8)));class SettingsService{[a52_0x21c77d(0xc2)](_0xae6dc4){const _0x2f0c6d=a52_0x21c77d;if(!_0xae6dc4)return'';if(_0xae6dc4[_0x2f0c6d(0xa4)]<=0x8)return _0xae6dc4;const _0x3e85de=_0xae6dc4[_0x2f0c6d(0xbe)](0x0,0x8),_0x4837d3='*'[_0x2f0c6d(0xdb)](Math[_0x2f0c6d(0xb1)](0x0,_0xae6dc4['length']-0x8));return _0x3e85de+_0x4837d3;}[a52_0x21c77d(0xda)](_0x470d4a){const _0x2b3a3f=a52_0x21c77d;if(!_0x470d4a)return[];if(Array['isArray'](_0x470d4a))return _0x470d4a;if(typeof _0x470d4a===_0x2b3a3f(0xd2))try{const _0x1e2da5=JSON[_0x2b3a3f(0xd9)](_0x470d4a);return Array[_0x2b3a3f(0xa6)](_0x1e2da5)?_0x1e2da5:[];}catch{return[];}return[];}async[a52_0x21c77d(0xb0)](_0x15cd41){const _0x2240c2=a52_0x21c77d,_0x59e9b1=await database_1[_0x2240c2(0xb7)][_0x2240c2(0x99)][_0x2240c2(0xcd)]({'where':{'id':_0x15cd41},'include':{'settings':!![]}});if(!_0x59e9b1)throw new Error('Shop\x20not\x20found');let _0x588f33=_0x59e9b1[_0x2240c2(0xce)];return!_0x588f33&&(_0x588f33=await database_1['default'][_0x2240c2(0x95)][_0x2240c2(0xcb)]({'data':{'shopId':_0x59e9b1['id']}})),{'fullName':_0x59e9b1[_0x2240c2(0x97)],'brand':_0x59e9b1[_0x2240c2(0x97)],'merchantUrl':_0x59e9b1[_0x2240c2(0xd3)],'telegramUsername':_0x59e9b1[_0x2240c2(0xcc)],'telegramBotApiKey':_0x588f33[_0x2240c2(0xa5)]?this[_0x2240c2(0xc2)](_0x588f33[_0x2240c2(0xa5)]):null,'telegramChatId':_0x588f33[_0x2240c2(0xca)],'webhookUrl':_0x588f33['webhookUrl'],'webhookEvents':this['parseWebhookEvents'](_0x588f33[_0x2240c2(0xad)]),'notifications':{'payment_success':_0x588f33[_0x2240c2(0xc6)],'payment_failed':_0x588f33['notificationPaymentFailed'],'refund':_0x588f33[_0x2240c2(0xd0)],'payout':_0x588f33[_0x2240c2(0xa0)],'login':_0x588f33[_0x2240c2(0xab)],'api_error':_0x588f33['notificationApiError']}};}async['changePassword'](_0x21024d,_0x142086){const _0x4641aa=a52_0x21c77d,{currentPassword:_0x232fb5,newPassword:_0x5c4d21,confirmNewPassword:_0x3a0909}=_0x142086;if(_0x5c4d21!==_0x3a0909)throw new Error(_0x4641aa(0xb6));if(_0x5c4d21['length']<0x6)throw new Error(_0x4641aa(0xa2));const _0x42da25=await database_1[_0x4641aa(0xb7)][_0x4641aa(0x99)][_0x4641aa(0xcd)]({'where':{'id':_0x21024d},'select':{'password':!![]}});if(!_0x42da25)throw new Error(_0x4641aa(0x9e));const _0x37777c=await bcryptjs_1[_0x4641aa(0xb7)][_0x4641aa(0xac)](_0x232fb5,_0x42da25[_0x4641aa(0xc9)]);if(!_0x37777c)throw new Error(_0x4641aa(0xc8));const _0x23b98c=await bcryptjs_1[_0x4641aa(0xb7)][_0x4641aa(0x9d)](_0x5c4d21,0xc);await database_1['default'][_0x4641aa(0x99)]['update']({'where':{'id':_0x21024d},'data':{'password':_0x23b98c}});}async[a52_0x21c77d(0xb5)](_0xc24d8f,_0x5d2575){const _0x7a8bd7=a52_0x21c77d;await this[_0x7a8bd7(0x9b)](_0xc24d8f);const _0x3780f7={};_0x5d2575['payment_success']!==undefined&&(_0x3780f7[_0x7a8bd7(0xc6)]=_0x5d2575[_0x7a8bd7(0xba)]),_0x5d2575[_0x7a8bd7(0x9c)]!==undefined&&(_0x3780f7['notificationPaymentFailed']=_0x5d2575['payment_failed']),_0x5d2575[_0x7a8bd7(0xaf)]!==undefined&&(_0x3780f7[_0x7a8bd7(0xd0)]=_0x5d2575[_0x7a8bd7(0xaf)]),_0x5d2575['payout']!==undefined&&(_0x3780f7[_0x7a8bd7(0xa0)]=_0x5d2575[_0x7a8bd7(0xd1)]),_0x5d2575[_0x7a8bd7(0xc7)]!==undefined&&(_0x3780f7[_0x7a8bd7(0xab)]=_0x5d2575[_0x7a8bd7(0xc7)]),_0x5d2575[_0x7a8bd7(0xa7)]!==undefined&&(_0x3780f7[_0x7a8bd7(0x9f)]=_0x5d2575[_0x7a8bd7(0xa7)]),await database_1['default'][_0x7a8bd7(0x95)][_0x7a8bd7(0xd5)]({'where':{'shopId':_0xc24d8f},'data':_0x3780f7});}async[a52_0x21c77d(0xb3)](_0x1ade28,_0x226c4d){const _0x563f97=a52_0x21c77d;await this[_0x563f97(0x9b)](_0x1ade28);const _0x4f9ce7={};_0x226c4d[_0x563f97(0xa1)]!==undefined&&(_0x4f9ce7[_0x563f97(0xa5)]=_0x226c4d[_0x563f97(0xa1)]||null),_0x226c4d[_0x563f97(0xbc)]!==undefined&&(_0x4f9ce7[_0x563f97(0xca)]=_0x226c4d['chatId']||null),await database_1[_0x563f97(0xb7)]['shopSettings'][_0x563f97(0xd5)]({'where':{'shopId':_0x1ade28},'data':_0x4f9ce7});}async[a52_0x21c77d(0xd8)](_0x11c5d6,_0x1974e1){const _0x3832fb=a52_0x21c77d;await this['ensureSettingsExist'](_0x11c5d6);const _0x58171d={};_0x1974e1[_0x3832fb(0xc1)]!==undefined&&(_0x58171d[_0x3832fb(0xc1)]=_0x1974e1[_0x3832fb(0xc1)]||null),_0x1974e1['webhookEvents']!==undefined&&(_0x58171d['webhookEvents']=_0x1974e1[_0x3832fb(0xad)]||[]),await database_1[_0x3832fb(0xb7)][_0x3832fb(0x95)]['update']({'where':{'shopId':_0x11c5d6},'data':_0x58171d});}async[a52_0x21c77d(0x9a)](_0x2209fa){const _0x58b17d=a52_0x21c77d,_0x1c9aba=_0x58b17d(0x98)+crypto_1[_0x58b17d(0xb7)][_0x58b17d(0xae)](0x20)[_0x58b17d(0xc5)](_0x58b17d(0xa9)),_0x2c1d41='sk_'+crypto_1[_0x58b17d(0xb7)][_0x58b17d(0xae)](0x20)[_0x58b17d(0xc5)](_0x58b17d(0xa9));await database_1[_0x58b17d(0xb7)][_0x58b17d(0x99)]['update']({'where':{'id':_0x2209fa},'data':{'publicKey':_0x1c9aba,'secretKey':_0x2c1d41}});}async[a52_0x21c77d(0xb9)](_0x5254b5,_0x1f2336){const _0x567e5f=a52_0x21c77d,{passwordConfirmation:_0x4127fa}=_0x1f2336,_0x7fb4dd=await database_1['default']['shop']['findUnique']({'where':{'id':_0x5254b5},'select':{'password':!![]}});if(!_0x7fb4dd)throw new Error('Shop\x20not\x20found');const _0x374d91=await bcryptjs_1['default'][_0x567e5f(0xac)](_0x4127fa,_0x7fb4dd['password']);if(!_0x374d91)throw new Error(_0x567e5f(0xb2));await database_1[_0x567e5f(0xb7)][_0x567e5f(0x99)]['delete']({'where':{'id':_0x5254b5}});}async['ensureSettingsExist'](_0x3a25b5){const _0x29643a=a52_0x21c77d,_0x285473=await database_1[_0x29643a(0xb7)][_0x29643a(0x95)][_0x29643a(0xcd)]({'where':{'shopId':_0x3a25b5}});!_0x285473&&await database_1[_0x29643a(0xb7)][_0x29643a(0x95)][_0x29643a(0xcb)]({'data':{'shopId':_0x3a25b5}});}}function a52_0x3a86(_0x4df857,_0x2cea77){const _0x1333a9=a52_0x1333();return a52_0x3a86=function(_0x3a8675,_0x196baa){_0x3a8675=_0x3a8675-0x95;let _0x4c7962=_0x1333a9[_0x3a8675];return _0x4c7962;},a52_0x3a86(_0x4df857,_0x2cea77);}exports[a52_0x21c77d(0xcf)]=SettingsService;