'use strict';function a47_0x55c7(_0x12f619,_0x3772ec){const _0x131b53=a47_0x131b();return a47_0x55c7=function(_0x55c724,_0x6b825e){_0x55c724=_0x55c724-0x17a;let _0x2e63eb=_0x131b53[_0x55c724];return _0x2e63eb;},a47_0x55c7(_0x12f619,_0x3772ec);}const a47_0x1643e9=a47_0x55c7;(function(_0x1c4cd5,_0x5bd623){const _0x23391f=a47_0x55c7,_0x13a18d=_0x1c4cd5();while(!![]){try{const _0x5c0dc7=parseInt(_0x23391f(0x1a1))/0x1+-parseInt(_0x23391f(0x18a))/0x2*(-parseInt(_0x23391f(0x1bb))/0x3)+-parseInt(_0x23391f(0x1b8))/0x4*(-parseInt(_0x23391f(0x19d))/0x5)+parseInt(_0x23391f(0x1b6))/0x6+-parseInt(_0x23391f(0x1a7))/0x7+-parseInt(_0x23391f(0x19b))/0x8+parseInt(_0x23391f(0x1a4))/0x9*(-parseInt(_0x23391f(0x197))/0xa);if(_0x5c0dc7===_0x5bd623)break;else _0x13a18d['push'](_0x13a18d['shift']());}catch(_0x38d399){_0x13a18d['push'](_0x13a18d['shift']());}}}(a47_0x131b,0x2eeba));var __importDefault=this&&this[a47_0x1643e9(0x184)]||function(_0x3e737f){return _0x3e737f&&_0x3e737f['__esModule']?_0x3e737f:{'default':_0x3e737f};};Object[a47_0x1643e9(0x19e)](exports,a47_0x1643e9(0x1bc),{'value':!![]}),exports[a47_0x1643e9(0x19a)]=void 0x0;function a47_0x131b(){const _0x86709e=['update','shopUrl','2562098iiRtjv','notificationRefund','refund','payment_failed','name','isArray','length','payout','botApiKey','notificationPaymentSuccess','hex','parse','randomBytes','changePassword','maskApiKey','607290qidPaL','Current\x20password\x20is\x20incorrect','4HEpWPs','max','chatId','277107NAjFfp','__esModule','shopSettings','pk_','shop','ensureSettingsExist','api_error','deleteAccount','notificationPayout','string','telegram','webhookUrl','repeat','sk_','__importDefault','compare','parseWebhookEvents','findUnique','telegramBotApiKey','default','8OuDeCG','updateNotifications','updateWebhookSettings','Password\x20confirmation\x20is\x20incorrect','notificationLogin','webhookEvents','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','password','updateTelegramSettings','create','notificationApiError','payment_success','Shop\x20not\x20found','2290760uPTqcE','notificationPaymentFailed','toString','SettingsService','401912tVNSPY','telegramChatId','1318145QTEfqN','defineProperty','substring','login','103195nuNGJj','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','delete','9MGNwUy'];a47_0x131b=function(){return _0x86709e;};return a47_0x131b();}const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));class SettingsService{[a47_0x1643e9(0x1b5)](_0x5c9c95){const _0x374df5=a47_0x1643e9;if(!_0x5c9c95)return'';if(_0x5c9c95[_0x374df5(0x1ad)]<=0x8)return _0x5c9c95;const _0x859008=_0x5c9c95[_0x374df5(0x19f)](0x0,0x8),_0x2273f5='*'[_0x374df5(0x182)](Math[_0x374df5(0x1b9)](0x0,_0x5c9c95[_0x374df5(0x1ad)]-0x8));return _0x859008+_0x2273f5;}[a47_0x1643e9(0x186)](_0x58f0e3){const _0x2bd85f=a47_0x1643e9;if(!_0x58f0e3)return[];if(Array[_0x2bd85f(0x1ac)](_0x58f0e3))return _0x58f0e3;if(typeof _0x58f0e3===_0x2bd85f(0x17f))try{const _0x5f029c=JSON[_0x2bd85f(0x1b2)](_0x58f0e3);return Array['isArray'](_0x5f029c)?_0x5f029c:[];}catch{return[];}return[];}async['getShopSettings'](_0xfe5b2d){const _0x41fb4d=a47_0x1643e9,_0x14c400=await database_1['default']['shop']['findUnique']({'where':{'id':_0xfe5b2d},'include':{'settings':!![]}});if(!_0x14c400)throw new Error(_0x41fb4d(0x196));let _0x8c6b70=_0x14c400['settings'];return!_0x8c6b70&&(_0x8c6b70=await database_1[_0x41fb4d(0x189)]['shopSettings'][_0x41fb4d(0x193)]({'data':{'shopId':_0x14c400['id']}})),{'fullName':_0x14c400[_0x41fb4d(0x1ab)],'brand':_0x14c400[_0x41fb4d(0x1ab)],'merchantUrl':_0x14c400[_0x41fb4d(0x1a6)],'telegramUsername':_0x14c400[_0x41fb4d(0x180)],'telegramBotApiKey':_0x8c6b70['telegramBotApiKey']?this[_0x41fb4d(0x1b5)](_0x8c6b70[_0x41fb4d(0x188)]):null,'telegramChatId':_0x8c6b70[_0x41fb4d(0x19c)],'webhookUrl':_0x8c6b70['webhookUrl'],'webhookEvents':this[_0x41fb4d(0x186)](_0x8c6b70[_0x41fb4d(0x18f)]),'notifications':{'payment_success':_0x8c6b70[_0x41fb4d(0x1b0)],'payment_failed':_0x8c6b70[_0x41fb4d(0x198)],'refund':_0x8c6b70[_0x41fb4d(0x1a8)],'payout':_0x8c6b70[_0x41fb4d(0x17e)],'login':_0x8c6b70[_0x41fb4d(0x18e)],'api_error':_0x8c6b70[_0x41fb4d(0x194)]}};}async[a47_0x1643e9(0x1b4)](_0x164fc0,_0x3a5a36){const _0x31f5c9=a47_0x1643e9,{currentPassword:_0x245064,newPassword:_0x226df6,confirmNewPassword:_0x12f48a}=_0x3a5a36;if(_0x226df6!==_0x12f48a)throw new Error(_0x31f5c9(0x1a2));if(_0x226df6[_0x31f5c9(0x1ad)]<0x6)throw new Error(_0x31f5c9(0x190));const _0x959333=await database_1['default'][_0x31f5c9(0x17a)][_0x31f5c9(0x187)]({'where':{'id':_0x164fc0},'select':{'password':!![]}});if(!_0x959333)throw new Error(_0x31f5c9(0x196));const _0x4e935b=await bcryptjs_1[_0x31f5c9(0x189)][_0x31f5c9(0x185)](_0x245064,_0x959333['password']);if(!_0x4e935b)throw new Error(_0x31f5c9(0x1b7));const _0x23bad8=await bcryptjs_1[_0x31f5c9(0x189)]['hash'](_0x226df6,0xc);await database_1[_0x31f5c9(0x189)][_0x31f5c9(0x17a)]['update']({'where':{'id':_0x164fc0},'data':{'password':_0x23bad8}});}async[a47_0x1643e9(0x18b)](_0x35a94d,_0x16042a){const _0x13419f=a47_0x1643e9;await this[_0x13419f(0x17b)](_0x35a94d);const _0x290e35={};_0x16042a[_0x13419f(0x195)]!==undefined&&(_0x290e35[_0x13419f(0x1b0)]=_0x16042a[_0x13419f(0x195)]),_0x16042a[_0x13419f(0x1aa)]!==undefined&&(_0x290e35[_0x13419f(0x198)]=_0x16042a[_0x13419f(0x1aa)]),_0x16042a[_0x13419f(0x1a9)]!==undefined&&(_0x290e35[_0x13419f(0x1a8)]=_0x16042a[_0x13419f(0x1a9)]),_0x16042a[_0x13419f(0x1ae)]!==undefined&&(_0x290e35['notificationPayout']=_0x16042a[_0x13419f(0x1ae)]),_0x16042a[_0x13419f(0x1a0)]!==undefined&&(_0x290e35['notificationLogin']=_0x16042a[_0x13419f(0x1a0)]),_0x16042a[_0x13419f(0x17c)]!==undefined&&(_0x290e35[_0x13419f(0x194)]=_0x16042a[_0x13419f(0x17c)]),await database_1[_0x13419f(0x189)]['shopSettings'][_0x13419f(0x1a5)]({'where':{'shopId':_0x35a94d},'data':_0x290e35});}async[a47_0x1643e9(0x192)](_0xd5ae96,_0x1213f5){const _0xd7d885=a47_0x1643e9;await this['ensureSettingsExist'](_0xd5ae96);const _0x1668d9={};_0x1213f5[_0xd7d885(0x1af)]!==undefined&&(_0x1668d9[_0xd7d885(0x188)]=_0x1213f5[_0xd7d885(0x1af)]||null),_0x1213f5['chatId']!==undefined&&(_0x1668d9[_0xd7d885(0x19c)]=_0x1213f5[_0xd7d885(0x1ba)]||null),await database_1[_0xd7d885(0x189)][_0xd7d885(0x1bd)][_0xd7d885(0x1a5)]({'where':{'shopId':_0xd5ae96},'data':_0x1668d9});}async[a47_0x1643e9(0x18c)](_0x5b7fd6,_0xc8a0af){const _0x1fa8bd=a47_0x1643e9;await this[_0x1fa8bd(0x17b)](_0x5b7fd6);const _0x180b09={};_0xc8a0af[_0x1fa8bd(0x181)]!==undefined&&(_0x180b09[_0x1fa8bd(0x181)]=_0xc8a0af[_0x1fa8bd(0x181)]||null),_0xc8a0af['webhookEvents']!==undefined&&(_0x180b09['webhookEvents']=_0xc8a0af[_0x1fa8bd(0x18f)]||[]),await database_1[_0x1fa8bd(0x189)][_0x1fa8bd(0x1bd)][_0x1fa8bd(0x1a5)]({'where':{'shopId':_0x5b7fd6},'data':_0x180b09});}async['revokeAllApiKeys'](_0x3c139c){const _0x332475=a47_0x1643e9,_0x212d60=_0x332475(0x1be)+crypto_1[_0x332475(0x189)][_0x332475(0x1b3)](0x20)[_0x332475(0x199)]('hex'),_0x4b2524=_0x332475(0x183)+crypto_1['default']['randomBytes'](0x20)[_0x332475(0x199)](_0x332475(0x1b1));await database_1[_0x332475(0x189)][_0x332475(0x17a)]['update']({'where':{'id':_0x3c139c},'data':{'publicKey':_0x212d60,'secretKey':_0x4b2524}});}async[a47_0x1643e9(0x17d)](_0x5be5d0,_0x3e7420){const _0x34469a=a47_0x1643e9,{passwordConfirmation:_0x2f3a0a}=_0x3e7420,_0x61665=await database_1[_0x34469a(0x189)][_0x34469a(0x17a)]['findUnique']({'where':{'id':_0x5be5d0},'select':{'password':!![]}});if(!_0x61665)throw new Error(_0x34469a(0x196));const _0x169fb9=await bcryptjs_1[_0x34469a(0x189)][_0x34469a(0x185)](_0x2f3a0a,_0x61665[_0x34469a(0x191)]);if(!_0x169fb9)throw new Error(_0x34469a(0x18d));await database_1['default'][_0x34469a(0x17a)][_0x34469a(0x1a3)]({'where':{'id':_0x5be5d0}});}async['ensureSettingsExist'](_0x5b7082){const _0x6d30a1=a47_0x1643e9,_0x21c1af=await database_1[_0x6d30a1(0x189)]['shopSettings'][_0x6d30a1(0x187)]({'where':{'shopId':_0x5b7082}});!_0x21c1af&&await database_1[_0x6d30a1(0x189)][_0x6d30a1(0x1bd)][_0x6d30a1(0x193)]({'data':{'shopId':_0x5b7082}});}}exports[a47_0x1643e9(0x19a)]=SettingsService;