'use strict';const a61_0x436b7b=a61_0x2318;(function(_0x3ec738,_0x100137){const _0x2ce93d=a61_0x2318,_0x14e46d=_0x3ec738();while(!![]){try{const _0x477114=-parseInt(_0x2ce93d(0x196))/0x1*(-parseInt(_0x2ce93d(0x1b5))/0x2)+-parseInt(_0x2ce93d(0x17a))/0x3*(parseInt(_0x2ce93d(0x1a2))/0x4)+-parseInt(_0x2ce93d(0x17b))/0x5+-parseInt(_0x2ce93d(0x195))/0x6+parseInt(_0x2ce93d(0x19a))/0x7+parseInt(_0x2ce93d(0x198))/0x8+-parseInt(_0x2ce93d(0x193))/0x9*(parseInt(_0x2ce93d(0x19d))/0xa);if(_0x477114===_0x100137)break;else _0x14e46d['push'](_0x14e46d['shift']());}catch(_0x377b68){_0x14e46d['push'](_0x14e46d['shift']());}}}(a61_0x5efa,0x4df66));var __importDefault=this&&this[a61_0x436b7b(0x190)]||function(_0x1290fd){const _0x149821=a61_0x436b7b;return _0x1290fd&&_0x1290fd[_0x149821(0x191)]?_0x1290fd:{'default':_0x1290fd};};function a61_0x5efa(){const _0x180c6f=['delete','login','ensureSettingsExist','deleteAccount','updateTelegramSettings','password','api_error','getShopSettings','notificationApiError','notificationPaymentFailed','parse','729658YpJPga','create','default','telegramChatId','Password\x20confirmation\x20is\x20incorrect','name','SettingsService','shopUrl','settings','findUnique','246GIcLpu','915395jkiMeR','chatId','crypto','shop','max','notificationRefund','hex','botApiKey','Shop\x20not\x20found','webhookEvents','payout','notificationPayout','substring','notificationPaymentSuccess','payment_failed','bcryptjs','parseWebhookEvents','telegramBotApiKey','compare','../config/database','pk_','__importDefault','__esModule','shopSettings','9XUUipJ','refund','70662rRqORx','1uxjCbi','telegram','2103248zkaqDe','changePassword','3937661KTejOB','update','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','5928380pKTZgr','randomBytes','length','webhookUrl','updateNotifications','4060fEdIYk','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','payment_success','repeat','defineProperty','sk_','isArray','toString'];a61_0x5efa=function(){return _0x180c6f;};return a61_0x5efa();}Object[a61_0x436b7b(0x1a6)](exports,a61_0x436b7b(0x191),{'value':!![]}),exports[a61_0x436b7b(0x176)]=void 0x0;const bcryptjs_1=__importDefault(require(a61_0x436b7b(0x18a))),crypto_1=__importDefault(require(a61_0x436b7b(0x17d))),database_1=__importDefault(require(a61_0x436b7b(0x18e)));class SettingsService{['maskApiKey'](_0x19c245){const _0x494e17=a61_0x436b7b;if(!_0x19c245)return'';if(_0x19c245[_0x494e17(0x19f)]<=0x8)return _0x19c245;const _0x4010b0=_0x19c245[_0x494e17(0x187)](0x0,0x8),_0x119201='*'[_0x494e17(0x1a5)](Math[_0x494e17(0x17f)](0x0,_0x19c245['length']-0x8));return _0x4010b0+_0x119201;}[a61_0x436b7b(0x18b)](_0x4f7f97){const _0x153d39=a61_0x436b7b;if(!_0x4f7f97)return[];if(Array[_0x153d39(0x1a8)](_0x4f7f97))return _0x4f7f97;if(typeof _0x4f7f97==='string')try{const _0x39db44=JSON[_0x153d39(0x1b4)](_0x4f7f97);return Array[_0x153d39(0x1a8)](_0x39db44)?_0x39db44:[];}catch{return[];}return[];}async[a61_0x436b7b(0x1b1)](_0x2f47be){const _0x384f66=a61_0x436b7b,_0x100ad3=await database_1[_0x384f66(0x1b7)][_0x384f66(0x17e)][_0x384f66(0x179)]({'where':{'id':_0x2f47be},'include':{'settings':!![]}});if(!_0x100ad3)throw new Error('Shop\x20not\x20found');let _0x87d617=_0x100ad3[_0x384f66(0x178)];return!_0x87d617&&(_0x87d617=await database_1[_0x384f66(0x1b7)]['shopSettings'][_0x384f66(0x1b6)]({'data':{'shopId':_0x100ad3['id']}})),{'fullName':_0x100ad3[_0x384f66(0x175)],'brand':_0x100ad3['name'],'merchantUrl':_0x100ad3[_0x384f66(0x177)],'telegramUsername':_0x100ad3[_0x384f66(0x197)],'telegramBotApiKey':_0x87d617[_0x384f66(0x18c)]?this['maskApiKey'](_0x87d617[_0x384f66(0x18c)]):null,'telegramChatId':_0x87d617['telegramChatId'],'webhookUrl':_0x87d617[_0x384f66(0x1a0)],'webhookEvents':this[_0x384f66(0x18b)](_0x87d617[_0x384f66(0x184)]),'notifications':{'payment_success':_0x87d617[_0x384f66(0x188)],'payment_failed':_0x87d617[_0x384f66(0x1b3)],'refund':_0x87d617[_0x384f66(0x180)],'payout':_0x87d617[_0x384f66(0x186)],'login':_0x87d617['notificationLogin'],'api_error':_0x87d617['notificationApiError']}};}async[a61_0x436b7b(0x199)](_0x85b5c6,_0x322ba0){const _0x6b8028=a61_0x436b7b,{currentPassword:_0x34b469,newPassword:_0x599339,confirmNewPassword:_0x1fb554}=_0x322ba0;if(_0x599339!==_0x1fb554)throw new Error(_0x6b8028(0x19c));if(_0x599339['length']<0x6)throw new Error(_0x6b8028(0x1a3));const _0x490f18=await database_1[_0x6b8028(0x1b7)][_0x6b8028(0x17e)][_0x6b8028(0x179)]({'where':{'id':_0x85b5c6},'select':{'password':!![]}});if(!_0x490f18)throw new Error(_0x6b8028(0x183));const _0x4c4968=await bcryptjs_1[_0x6b8028(0x1b7)][_0x6b8028(0x18d)](_0x34b469,_0x490f18[_0x6b8028(0x1af)]);if(!_0x4c4968)throw new Error('Current\x20password\x20is\x20incorrect');const _0x1638ef=await bcryptjs_1['default']['hash'](_0x599339,0xc);await database_1['default'][_0x6b8028(0x17e)]['update']({'where':{'id':_0x85b5c6},'data':{'password':_0x1638ef}});}async[a61_0x436b7b(0x1a1)](_0x4ece73,_0xc14e85){const _0x28a034=a61_0x436b7b;await this[_0x28a034(0x1ac)](_0x4ece73);const _0x15b24a={};_0xc14e85[_0x28a034(0x1a4)]!==undefined&&(_0x15b24a['notificationPaymentSuccess']=_0xc14e85['payment_success']),_0xc14e85[_0x28a034(0x189)]!==undefined&&(_0x15b24a[_0x28a034(0x1b3)]=_0xc14e85[_0x28a034(0x189)]),_0xc14e85[_0x28a034(0x194)]!==undefined&&(_0x15b24a[_0x28a034(0x180)]=_0xc14e85[_0x28a034(0x194)]),_0xc14e85[_0x28a034(0x185)]!==undefined&&(_0x15b24a[_0x28a034(0x186)]=_0xc14e85[_0x28a034(0x185)]),_0xc14e85['login']!==undefined&&(_0x15b24a['notificationLogin']=_0xc14e85[_0x28a034(0x1ab)]),_0xc14e85[_0x28a034(0x1b0)]!==undefined&&(_0x15b24a[_0x28a034(0x1b2)]=_0xc14e85['api_error']),await database_1[_0x28a034(0x1b7)][_0x28a034(0x192)][_0x28a034(0x19b)]({'where':{'shopId':_0x4ece73},'data':_0x15b24a});}async[a61_0x436b7b(0x1ae)](_0x324c64,_0x278fa7){const _0x22bc5d=a61_0x436b7b;await this[_0x22bc5d(0x1ac)](_0x324c64);const _0x3c3b3a={};_0x278fa7['botApiKey']!==undefined&&(_0x3c3b3a['telegramBotApiKey']=_0x278fa7[_0x22bc5d(0x182)]||null),_0x278fa7[_0x22bc5d(0x17c)]!==undefined&&(_0x3c3b3a[_0x22bc5d(0x173)]=_0x278fa7['chatId']||null),await database_1[_0x22bc5d(0x1b7)]['shopSettings'][_0x22bc5d(0x19b)]({'where':{'shopId':_0x324c64},'data':_0x3c3b3a});}async['updateWebhookSettings'](_0x3de0a3,_0x391467){const _0x352785=a61_0x436b7b;await this['ensureSettingsExist'](_0x3de0a3);const _0x3fd758={};_0x391467[_0x352785(0x1a0)]!==undefined&&(_0x3fd758['webhookUrl']=_0x391467[_0x352785(0x1a0)]||null),_0x391467['webhookEvents']!==undefined&&(_0x3fd758[_0x352785(0x184)]=_0x391467[_0x352785(0x184)]||[]),await database_1['default']['shopSettings'][_0x352785(0x19b)]({'where':{'shopId':_0x3de0a3},'data':_0x3fd758});}async['revokeAllApiKeys'](_0x572106){const _0x1cb28d=a61_0x436b7b,_0x2185a3=_0x1cb28d(0x18f)+crypto_1['default'][_0x1cb28d(0x19e)](0x20)['toString'](_0x1cb28d(0x181)),_0x26b80b=_0x1cb28d(0x1a7)+crypto_1[_0x1cb28d(0x1b7)][_0x1cb28d(0x19e)](0x20)[_0x1cb28d(0x1a9)](_0x1cb28d(0x181));await database_1[_0x1cb28d(0x1b7)]['shop'][_0x1cb28d(0x19b)]({'where':{'id':_0x572106},'data':{'publicKey':_0x2185a3,'secretKey':_0x26b80b}});}async[a61_0x436b7b(0x1ad)](_0x316eae,_0x224a10){const _0x2f0971=a61_0x436b7b,{passwordConfirmation:_0x1f0280}=_0x224a10,_0x467b40=await database_1['default'][_0x2f0971(0x17e)]['findUnique']({'where':{'id':_0x316eae},'select':{'password':!![]}});if(!_0x467b40)throw new Error(_0x2f0971(0x183));const _0x2f2174=await bcryptjs_1[_0x2f0971(0x1b7)][_0x2f0971(0x18d)](_0x1f0280,_0x467b40[_0x2f0971(0x1af)]);if(!_0x2f2174)throw new Error(_0x2f0971(0x174));await database_1['default'][_0x2f0971(0x17e)][_0x2f0971(0x1aa)]({'where':{'id':_0x316eae}});}async[a61_0x436b7b(0x1ac)](_0x26fe41){const _0x240565=a61_0x436b7b,_0x3b603e=await database_1[_0x240565(0x1b7)][_0x240565(0x192)]['findUnique']({'where':{'shopId':_0x26fe41}});!_0x3b603e&&await database_1[_0x240565(0x1b7)]['shopSettings'][_0x240565(0x1b6)]({'data':{'shopId':_0x26fe41}});}}function a61_0x2318(_0x22c15d,_0x47e29f){const _0x5efa42=a61_0x5efa();return a61_0x2318=function(_0x2318bc,_0x3d6f25){_0x2318bc=_0x2318bc-0x173;let _0x57dfe5=_0x5efa42[_0x2318bc];return _0x57dfe5;},a61_0x2318(_0x22c15d,_0x47e29f);}exports['SettingsService']=SettingsService;