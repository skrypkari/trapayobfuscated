'use strict';const a64_0xe48383=a64_0x3577;(function(_0x433723,_0x52500a){const _0x570cf3=a64_0x3577,_0x15ce93=_0x433723();while(!![]){try{const _0x3a8e76=-parseInt(_0x570cf3(0xdb))/0x1*(-parseInt(_0x570cf3(0x11e))/0x2)+parseInt(_0x570cf3(0xdc))/0x3+parseInt(_0x570cf3(0xe8))/0x4+parseInt(_0x570cf3(0xf9))/0x5*(-parseInt(_0x570cf3(0x10c))/0x6)+-parseInt(_0x570cf3(0xf6))/0x7*(parseInt(_0x570cf3(0x119))/0x8)+-parseInt(_0x570cf3(0xed))/0x9*(parseInt(_0x570cf3(0x107))/0xa)+parseInt(_0x570cf3(0x114))/0xb;if(_0x3a8e76===_0x52500a)break;else _0x15ce93['push'](_0x15ce93['shift']());}catch(_0x23f49f){_0x15ce93['push'](_0x15ce93['shift']());}}}(a64_0x47f6,0xec671));var __importDefault=this&&this[a64_0xe48383(0x112)]||function(_0x5202db){return _0x5202db&&_0x5202db['__esModule']?_0x5202db:{'default':_0x5202db};};Object[a64_0xe48383(0xf7)](exports,a64_0xe48383(0xd8),{'value':!![]}),exports[a64_0xe48383(0xeb)]=void 0x0;const bcryptjs_1=__importDefault(require(a64_0xe48383(0xdf))),crypto_1=__importDefault(require(a64_0xe48383(0xd9))),database_1=__importDefault(require(a64_0xe48383(0xda)));function a64_0x47f6(){const _0x2ca351=['webhookUrl','pk_','create','Shop\x20not\x20found','210bTueMN','notificationApiError','string','repeat','botApiKey','24jNjdRD','deleteAccount','password','findUnique','length','isArray','__importDefault','parse','44572770KABsEh','updateTelegramSettings','ensureSettingsExist','delete','hex','24BHVLjr','notificationPayout','maskApiKey','updateWebhookSettings','changePassword','58450xmNrha','name','toString','payout','__esModule','crypto','../config/database','8wQdhLP','1014762qOUDJF','shopUrl','Current\x20password\x20is\x20incorrect','bcryptjs','settings','Password\x20confirmation\x20is\x20incorrect','notificationPaymentSuccess','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','payment_failed','default','revokeAllApiKeys','parseWebhookEvents','1105772HcCxGK','shop','max','SettingsService','payment_success','500301MPWLEQ','shopSettings','refund','hash','update','sk_','substring','api_error','login','3826109uszWec','defineProperty','telegram','1406415jhjWNy','notificationRefund','telegramBotApiKey','webhookEvents','telegramChatId','getShopSettings','randomBytes','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','notificationLogin','notificationPaymentFailed'];a64_0x47f6=function(){return _0x2ca351;};return a64_0x47f6();}class SettingsService{['maskApiKey'](_0x5f1a1e){const _0x573d37=a64_0xe48383;if(!_0x5f1a1e)return'';if(_0x5f1a1e[_0x573d37(0x110)]<=0x8)return _0x5f1a1e;const _0x2d2bf5=_0x5f1a1e[_0x573d37(0xf3)](0x0,0x8),_0x315b54='*'[_0x573d37(0x10a)](Math[_0x573d37(0xea)](0x0,_0x5f1a1e[_0x573d37(0x110)]-0x8));return _0x2d2bf5+_0x315b54;}[a64_0xe48383(0xe7)](_0x483b26){const _0x5dfecd=a64_0xe48383;if(!_0x483b26)return[];if(Array[_0x5dfecd(0x111)](_0x483b26))return _0x483b26;if(typeof _0x483b26===_0x5dfecd(0x109))try{const _0x50788a=JSON[_0x5dfecd(0x113)](_0x483b26);return Array['isArray'](_0x50788a)?_0x50788a:[];}catch{return[];}return[];}async[a64_0xe48383(0xfe)](_0x5c5196){const _0x1c2aab=a64_0xe48383,_0xac2bfd=await database_1[_0x1c2aab(0xe5)][_0x1c2aab(0xe9)][_0x1c2aab(0x10f)]({'where':{'id':_0x5c5196},'include':{'settings':!![]}});if(!_0xac2bfd)throw new Error(_0x1c2aab(0x106));let _0x4b7658=_0xac2bfd[_0x1c2aab(0xe0)];return!_0x4b7658&&(_0x4b7658=await database_1['default']['shopSettings'][_0x1c2aab(0x105)]({'data':{'shopId':_0xac2bfd['id']}})),{'fullName':_0xac2bfd[_0x1c2aab(0xd5)],'brand':_0xac2bfd[_0x1c2aab(0xd5)],'merchantUrl':_0xac2bfd[_0x1c2aab(0xdd)],'telegramUsername':_0xac2bfd[_0x1c2aab(0xf8)],'telegramBotApiKey':_0x4b7658['telegramBotApiKey']?this[_0x1c2aab(0x11b)](_0x4b7658['telegramBotApiKey']):null,'telegramChatId':_0x4b7658['telegramChatId'],'webhookUrl':_0x4b7658[_0x1c2aab(0x103)],'webhookEvents':this['parseWebhookEvents'](_0x4b7658[_0x1c2aab(0xfc)]),'notifications':{'payment_success':_0x4b7658[_0x1c2aab(0xe2)],'payment_failed':_0x4b7658[_0x1c2aab(0x102)],'refund':_0x4b7658['notificationRefund'],'payout':_0x4b7658[_0x1c2aab(0x11a)],'login':_0x4b7658[_0x1c2aab(0x101)],'api_error':_0x4b7658[_0x1c2aab(0x108)]}};}async[a64_0xe48383(0x11d)](_0x13155a,_0x112d52){const _0x508957=a64_0xe48383,{currentPassword:_0xb792f,newPassword:_0x10c60d,confirmNewPassword:_0x22a195}=_0x112d52;if(_0x10c60d!==_0x22a195)throw new Error(_0x508957(0x100));if(_0x10c60d[_0x508957(0x110)]<0x6)throw new Error(_0x508957(0xe3));const _0x58ec1e=await database_1[_0x508957(0xe5)][_0x508957(0xe9)][_0x508957(0x10f)]({'where':{'id':_0x13155a},'select':{'password':!![]}});if(!_0x58ec1e)throw new Error(_0x508957(0x106));const _0x2b3407=await bcryptjs_1[_0x508957(0xe5)]['compare'](_0xb792f,_0x58ec1e[_0x508957(0x10e)]);if(!_0x2b3407)throw new Error(_0x508957(0xde));const _0x4b7f63=await bcryptjs_1['default'][_0x508957(0xf0)](_0x10c60d,0xc);await database_1[_0x508957(0xe5)][_0x508957(0xe9)][_0x508957(0xf1)]({'where':{'id':_0x13155a},'data':{'password':_0x4b7f63}});}async['updateNotifications'](_0x179478,_0x4e276a){const _0x506908=a64_0xe48383;await this[_0x506908(0x116)](_0x179478);const _0x3c05fc={};_0x4e276a[_0x506908(0xec)]!==undefined&&(_0x3c05fc[_0x506908(0xe2)]=_0x4e276a[_0x506908(0xec)]),_0x4e276a[_0x506908(0xe4)]!==undefined&&(_0x3c05fc['notificationPaymentFailed']=_0x4e276a[_0x506908(0xe4)]),_0x4e276a['refund']!==undefined&&(_0x3c05fc[_0x506908(0xfa)]=_0x4e276a[_0x506908(0xef)]),_0x4e276a[_0x506908(0xd7)]!==undefined&&(_0x3c05fc[_0x506908(0x11a)]=_0x4e276a['payout']),_0x4e276a['login']!==undefined&&(_0x3c05fc[_0x506908(0x101)]=_0x4e276a[_0x506908(0xf5)]),_0x4e276a[_0x506908(0xf4)]!==undefined&&(_0x3c05fc['notificationApiError']=_0x4e276a['api_error']),await database_1['default'][_0x506908(0xee)][_0x506908(0xf1)]({'where':{'shopId':_0x179478},'data':_0x3c05fc});}async[a64_0xe48383(0x115)](_0x22ab88,_0x519935){const _0x300a89=a64_0xe48383;await this[_0x300a89(0x116)](_0x22ab88);const _0x260cc5={};_0x519935[_0x300a89(0x10b)]!==undefined&&(_0x260cc5[_0x300a89(0xfb)]=_0x519935[_0x300a89(0x10b)]||null),_0x519935['chatId']!==undefined&&(_0x260cc5[_0x300a89(0xfd)]=_0x519935['chatId']||null),await database_1['default']['shopSettings'][_0x300a89(0xf1)]({'where':{'shopId':_0x22ab88},'data':_0x260cc5});}async[a64_0xe48383(0x11c)](_0x45cbcb,_0x2a965d){const _0x247226=a64_0xe48383;await this['ensureSettingsExist'](_0x45cbcb);const _0x46a915={};_0x2a965d[_0x247226(0x103)]!==undefined&&(_0x46a915[_0x247226(0x103)]=_0x2a965d[_0x247226(0x103)]||null),_0x2a965d['webhookEvents']!==undefined&&(_0x46a915['webhookEvents']=_0x2a965d[_0x247226(0xfc)]||[]),await database_1['default'][_0x247226(0xee)][_0x247226(0xf1)]({'where':{'shopId':_0x45cbcb},'data':_0x46a915});}async[a64_0xe48383(0xe6)](_0x3db047){const _0xd12703=a64_0xe48383,_0x19c483=_0xd12703(0x104)+crypto_1[_0xd12703(0xe5)][_0xd12703(0xff)](0x20)['toString'](_0xd12703(0x118)),_0x39ed3f=_0xd12703(0xf2)+crypto_1[_0xd12703(0xe5)][_0xd12703(0xff)](0x20)[_0xd12703(0xd6)](_0xd12703(0x118));await database_1['default'][_0xd12703(0xe9)][_0xd12703(0xf1)]({'where':{'id':_0x3db047},'data':{'publicKey':_0x19c483,'secretKey':_0x39ed3f}});}async[a64_0xe48383(0x10d)](_0x466072,_0x20a07f){const _0x260acb=a64_0xe48383,{passwordConfirmation:_0x9d4f0c}=_0x20a07f,_0x1db375=await database_1[_0x260acb(0xe5)][_0x260acb(0xe9)][_0x260acb(0x10f)]({'where':{'id':_0x466072},'select':{'password':!![]}});if(!_0x1db375)throw new Error('Shop\x20not\x20found');const _0x1df46d=await bcryptjs_1[_0x260acb(0xe5)]['compare'](_0x9d4f0c,_0x1db375[_0x260acb(0x10e)]);if(!_0x1df46d)throw new Error(_0x260acb(0xe1));await database_1[_0x260acb(0xe5)][_0x260acb(0xe9)][_0x260acb(0x117)]({'where':{'id':_0x466072}});}async[a64_0xe48383(0x116)](_0xec1a6d){const _0x3d76e0=a64_0xe48383,_0xbf8545=await database_1[_0x3d76e0(0xe5)]['shopSettings'][_0x3d76e0(0x10f)]({'where':{'shopId':_0xec1a6d}});!_0xbf8545&&await database_1[_0x3d76e0(0xe5)][_0x3d76e0(0xee)]['create']({'data':{'shopId':_0xec1a6d}});}}function a64_0x3577(_0x9eada0,_0x3e440f){const _0x47f652=a64_0x47f6();return a64_0x3577=function(_0x357761,_0x21a66d){_0x357761=_0x357761-0xd5;let _0x5ba8d6=_0x47f652[_0x357761];return _0x5ba8d6;},a64_0x3577(_0x9eada0,_0x3e440f);}exports['SettingsService']=SettingsService;