'use strict';function a55_0x36a2(_0x5dc0d3,_0x289a5f){const _0x280569=a55_0x2805();return a55_0x36a2=function(_0x36a2e8,_0x295e27){_0x36a2e8=_0x36a2e8-0x106;let _0x1071ab=_0x280569[_0x36a2e8];return _0x1071ab;},a55_0x36a2(_0x5dc0d3,_0x289a5f);}const a55_0x50b89c=a55_0x36a2;function a55_0x2805(){const _0x5d406b=['randomBytes','name','payment_success','findUnique','1sPDZyw','payment_failed','deleteAccount','hash','revokeAllApiKeys','telegramBotApiKey','isArray','2837650gBPtJE','repeat','telegram','923CtwwFp','hex','9498AYNqwq','Current\x20password\x20is\x20incorrect','10HzjFpu','bcryptjs','15153226NnNOah','Shop\x20not\x20found','updateNotifications','payout','updateWebhookSettings','substring','844uJCzaI','612156JQVGfY','shop','1061436sdrUGV','notificationApiError','login','webhookEvents','default','changePassword','__esModule','16fSdHlj','notificationPayout','chatId','create','1607242AUnotz','max','SettingsService','webhookUrl','api_error','notificationPaymentFailed','3696687DazXIB','shopUrl','update','shopSettings','updateTelegramSettings','notificationPaymentSuccess','maskApiKey','botApiKey','parseWebhookEvents','password','settings','compare','refund','getShopSettings','ensureSettingsExist','string','length','sk_','notificationLogin','__importDefault','Password\x20confirmation\x20is\x20incorrect','30jtKWYC','crypto','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','New\x20password\x20and\x20confirmation\x20do\x20not\x20match'];a55_0x2805=function(){return _0x5d406b;};return a55_0x2805();}(function(_0x29353c,_0x49e6ed){const _0x260307=a55_0x36a2,_0x17d413=_0x29353c();while(!![]){try{const _0x45bb1b=-parseInt(_0x260307(0x116))/0x1*(-parseInt(_0x260307(0x11d))/0x2)+parseInt(_0x260307(0x122))/0x3*(-parseInt(_0x260307(0x12c))/0x4)+parseInt(_0x260307(0x10e))/0x5*(-parseInt(_0x260307(0x12f))/0x6)+-parseInt(_0x260307(0x13a))/0x7+-parseInt(_0x260307(0x136))/0x8*(parseInt(_0x260307(0x140))/0x9)+-parseInt(_0x260307(0x124))/0xa*(parseInt(_0x260307(0x126))/0xb)+parseInt(_0x260307(0x12d))/0xc*(parseInt(_0x260307(0x120))/0xd);if(_0x45bb1b===_0x49e6ed)break;else _0x17d413['push'](_0x17d413['shift']());}catch(_0x45bf1e){_0x17d413['push'](_0x17d413['shift']());}}}(a55_0x2805,0xd77c4));var __importDefault=this&&this[a55_0x50b89c(0x10c)]||function(_0x5bed72){return _0x5bed72&&_0x5bed72['__esModule']?_0x5bed72:{'default':_0x5bed72};};Object['defineProperty'](exports,a55_0x50b89c(0x135),{'value':!![]}),exports[a55_0x50b89c(0x13c)]=void 0x0;const bcryptjs_1=__importDefault(require(a55_0x50b89c(0x125))),crypto_1=__importDefault(require(a55_0x50b89c(0x10f))),database_1=__importDefault(require('../config/database'));class SettingsService{[a55_0x50b89c(0x146)](_0x3b7b25){const _0x21114c=a55_0x50b89c;if(!_0x3b7b25)return'';if(_0x3b7b25[_0x21114c(0x109)]<=0x8)return _0x3b7b25;const _0x52d4bb=_0x3b7b25[_0x21114c(0x12b)](0x0,0x8),_0x1507a0='*'[_0x21114c(0x11e)](Math[_0x21114c(0x13b)](0x0,_0x3b7b25[_0x21114c(0x109)]-0x8));return _0x52d4bb+_0x1507a0;}[a55_0x50b89c(0x148)](_0x2130a7){const _0x4f0faa=a55_0x50b89c;if(!_0x2130a7)return[];if(Array[_0x4f0faa(0x11c)](_0x2130a7))return _0x2130a7;if(typeof _0x2130a7===_0x4f0faa(0x108))try{const _0x2db39e=JSON['parse'](_0x2130a7);return Array[_0x4f0faa(0x11c)](_0x2db39e)?_0x2db39e:[];}catch{return[];}return[];}async[a55_0x50b89c(0x106)](_0x339b13){const _0x47a5a1=a55_0x50b89c,_0x2390df=await database_1['default']['shop'][_0x47a5a1(0x115)]({'where':{'id':_0x339b13},'include':{'settings':!![]}});if(!_0x2390df)throw new Error(_0x47a5a1(0x127));let _0x3f0f52=_0x2390df[_0x47a5a1(0x14a)];return!_0x3f0f52&&(_0x3f0f52=await database_1['default']['shopSettings'][_0x47a5a1(0x139)]({'data':{'shopId':_0x2390df['id']}})),{'fullName':_0x2390df[_0x47a5a1(0x113)],'brand':_0x2390df['name'],'merchantUrl':_0x2390df[_0x47a5a1(0x141)],'telegramUsername':_0x2390df[_0x47a5a1(0x11f)],'telegramBotApiKey':_0x3f0f52[_0x47a5a1(0x11b)]?this[_0x47a5a1(0x146)](_0x3f0f52[_0x47a5a1(0x11b)]):null,'telegramChatId':_0x3f0f52['telegramChatId'],'webhookUrl':_0x3f0f52[_0x47a5a1(0x13d)],'webhookEvents':this[_0x47a5a1(0x148)](_0x3f0f52[_0x47a5a1(0x132)]),'notifications':{'payment_success':_0x3f0f52['notificationPaymentSuccess'],'payment_failed':_0x3f0f52[_0x47a5a1(0x13f)],'refund':_0x3f0f52['notificationRefund'],'payout':_0x3f0f52['notificationPayout'],'login':_0x3f0f52[_0x47a5a1(0x10b)],'api_error':_0x3f0f52[_0x47a5a1(0x130)]}};}async[a55_0x50b89c(0x134)](_0x27dc97,_0x4fabcb){const _0x559ffb=a55_0x50b89c,{currentPassword:_0x10e1ac,newPassword:_0x12c387,confirmNewPassword:_0x17e10f}=_0x4fabcb;if(_0x12c387!==_0x17e10f)throw new Error(_0x559ffb(0x111));if(_0x12c387[_0x559ffb(0x109)]<0x6)throw new Error(_0x559ffb(0x110));const _0x2093bf=await database_1[_0x559ffb(0x133)]['shop']['findUnique']({'where':{'id':_0x27dc97},'select':{'password':!![]}});if(!_0x2093bf)throw new Error(_0x559ffb(0x127));const _0x484513=await bcryptjs_1[_0x559ffb(0x133)][_0x559ffb(0x14b)](_0x10e1ac,_0x2093bf[_0x559ffb(0x149)]);if(!_0x484513)throw new Error(_0x559ffb(0x123));const _0x1aa1cf=await bcryptjs_1[_0x559ffb(0x133)][_0x559ffb(0x119)](_0x12c387,0xc);await database_1[_0x559ffb(0x133)][_0x559ffb(0x12e)][_0x559ffb(0x142)]({'where':{'id':_0x27dc97},'data':{'password':_0x1aa1cf}});}async[a55_0x50b89c(0x128)](_0x22dadf,_0x39dc09){const _0x4e49fc=a55_0x50b89c;await this[_0x4e49fc(0x107)](_0x22dadf);const _0xbad8a={};_0x39dc09[_0x4e49fc(0x114)]!==undefined&&(_0xbad8a[_0x4e49fc(0x145)]=_0x39dc09['payment_success']),_0x39dc09[_0x4e49fc(0x117)]!==undefined&&(_0xbad8a[_0x4e49fc(0x13f)]=_0x39dc09[_0x4e49fc(0x117)]),_0x39dc09['refund']!==undefined&&(_0xbad8a['notificationRefund']=_0x39dc09[_0x4e49fc(0x14c)]),_0x39dc09['payout']!==undefined&&(_0xbad8a[_0x4e49fc(0x137)]=_0x39dc09[_0x4e49fc(0x129)]),_0x39dc09[_0x4e49fc(0x131)]!==undefined&&(_0xbad8a['notificationLogin']=_0x39dc09['login']),_0x39dc09['api_error']!==undefined&&(_0xbad8a['notificationApiError']=_0x39dc09[_0x4e49fc(0x13e)]),await database_1[_0x4e49fc(0x133)][_0x4e49fc(0x143)][_0x4e49fc(0x142)]({'where':{'shopId':_0x22dadf},'data':_0xbad8a});}async[a55_0x50b89c(0x144)](_0x48670e,_0x568601){const _0x3804c8=a55_0x50b89c;await this[_0x3804c8(0x107)](_0x48670e);const _0x22dd8c={};_0x568601['botApiKey']!==undefined&&(_0x22dd8c[_0x3804c8(0x11b)]=_0x568601[_0x3804c8(0x147)]||null),_0x568601[_0x3804c8(0x138)]!==undefined&&(_0x22dd8c['telegramChatId']=_0x568601['chatId']||null),await database_1['default']['shopSettings'][_0x3804c8(0x142)]({'where':{'shopId':_0x48670e},'data':_0x22dd8c});}async[a55_0x50b89c(0x12a)](_0x2d487a,_0x44aab1){const _0x238e0d=a55_0x50b89c;await this[_0x238e0d(0x107)](_0x2d487a);const _0x4cc0a0={};_0x44aab1[_0x238e0d(0x13d)]!==undefined&&(_0x4cc0a0[_0x238e0d(0x13d)]=_0x44aab1[_0x238e0d(0x13d)]||null),_0x44aab1[_0x238e0d(0x132)]!==undefined&&(_0x4cc0a0['webhookEvents']=_0x44aab1[_0x238e0d(0x132)]||[]),await database_1[_0x238e0d(0x133)][_0x238e0d(0x143)][_0x238e0d(0x142)]({'where':{'shopId':_0x2d487a},'data':_0x4cc0a0});}async[a55_0x50b89c(0x11a)](_0x280125){const _0x47042f=a55_0x50b89c,_0x2f3311='pk_'+crypto_1['default'][_0x47042f(0x112)](0x20)['toString'](_0x47042f(0x121)),_0x400483=_0x47042f(0x10a)+crypto_1[_0x47042f(0x133)]['randomBytes'](0x20)['toString'](_0x47042f(0x121));await database_1[_0x47042f(0x133)][_0x47042f(0x12e)][_0x47042f(0x142)]({'where':{'id':_0x280125},'data':{'publicKey':_0x2f3311,'secretKey':_0x400483}});}async[a55_0x50b89c(0x118)](_0x5a63a4,_0x1e062b){const _0x389415=a55_0x50b89c,{passwordConfirmation:_0x5818b2}=_0x1e062b,_0x4cce4a=await database_1['default'][_0x389415(0x12e)]['findUnique']({'where':{'id':_0x5a63a4},'select':{'password':!![]}});if(!_0x4cce4a)throw new Error(_0x389415(0x127));const _0x3f2286=await bcryptjs_1[_0x389415(0x133)]['compare'](_0x5818b2,_0x4cce4a['password']);if(!_0x3f2286)throw new Error(_0x389415(0x10d));await database_1[_0x389415(0x133)][_0x389415(0x12e)]['delete']({'where':{'id':_0x5a63a4}});}async['ensureSettingsExist'](_0x5c937e){const _0x11a127=a55_0x50b89c,_0x172882=await database_1[_0x11a127(0x133)][_0x11a127(0x143)][_0x11a127(0x115)]({'where':{'shopId':_0x5c937e}});!_0x172882&&await database_1[_0x11a127(0x133)]['shopSettings']['create']({'data':{'shopId':_0x5c937e}});}}exports[a55_0x50b89c(0x13c)]=SettingsService;