'use strict';const a59_0x29e6d3=a59_0x5c20;(function(_0x5ec1a3,_0x5059bd){const _0x525915=a59_0x5c20,_0x4251e0=_0x5ec1a3();while(!![]){try{const _0xec364e=-parseInt(_0x525915(0x191))/0x1*(parseInt(_0x525915(0x19c))/0x2)+-parseInt(_0x525915(0x183))/0x3+-parseInt(_0x525915(0x194))/0x4*(parseInt(_0x525915(0x1b7))/0x5)+parseInt(_0x525915(0x1a4))/0x6+-parseInt(_0x525915(0x18f))/0x7*(parseInt(_0x525915(0x1b4))/0x8)+-parseInt(_0x525915(0x198))/0x9+-parseInt(_0x525915(0x1b0))/0xa*(-parseInt(_0x525915(0x17e))/0xb);if(_0xec364e===_0x5059bd)break;else _0x4251e0['push'](_0x4251e0['shift']());}catch(_0x6491ea){_0x4251e0['push'](_0x4251e0['shift']());}}}(a59_0x5eae,0x53cea));var __importDefault=this&&this[a59_0x29e6d3(0x197)]||function(_0x49e6a9){const _0x3cbe17=a59_0x29e6d3;return _0x49e6a9&&_0x49e6a9[_0x3cbe17(0x1ae)]?_0x49e6a9:{'default':_0x49e6a9};};function a59_0x5eae(){const _0x14b415=['findUnique','max','payment_success','create','../config/database','crypto','parse','28020927HNKKyD','telegramChatId','payout','refund','compare','1346754ZNNtqU','Shop\x20not\x20found','changePassword','substring','bcryptjs','length','isArray','update','toString','randomBytes','parseWebhookEvents','login','126pclTYO','deleteAccount','222dpIXal','botApiKey','telegramBotApiKey','4cKFJUv','notificationPaymentFailed','SettingsService','__importDefault','5386239EzOWrU','hash','shopUrl','shopSettings','5264dHYZQV','notificationRefund','chatId','updateWebhookSettings','password','revokeAllApiKeys','Password\x20confirmation\x20is\x20incorrect','api_error','1367640sJgMRc','notificationLogin','shop','updateTelegramSettings','updateNotifications','telegram','default','settings','repeat','getShopSettings','__esModule','ensureSettingsExist','10MXyfPr','hex','webhookUrl','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','250664wQLYva','maskApiKey','webhookEvents','1181680pfEkiW','notificationApiError','sk_','notificationPaymentSuccess'];a59_0x5eae=function(){return _0x14b415;};return a59_0x5eae();}Object['defineProperty'](exports,a59_0x29e6d3(0x1ae),{'value':!![]}),exports[a59_0x29e6d3(0x196)]=void 0x0;const bcryptjs_1=__importDefault(require(a59_0x29e6d3(0x187))),crypto_1=__importDefault(require(a59_0x29e6d3(0x17c))),database_1=__importDefault(require(a59_0x29e6d3(0x17b)));class SettingsService{[a59_0x29e6d3(0x1b5)](_0x5d7ef1){const _0x4849db=a59_0x29e6d3;if(!_0x5d7ef1)return'';if(_0x5d7ef1[_0x4849db(0x188)]<=0x8)return _0x5d7ef1;const _0x2e88b9=_0x5d7ef1[_0x4849db(0x186)](0x0,0x8),_0x6e1c00='*'[_0x4849db(0x1ac)](Math[_0x4849db(0x178)](0x0,_0x5d7ef1[_0x4849db(0x188)]-0x8));return _0x2e88b9+_0x6e1c00;}[a59_0x29e6d3(0x18d)](_0x3678e3){const _0x445c23=a59_0x29e6d3;if(!_0x3678e3)return[];if(Array['isArray'](_0x3678e3))return _0x3678e3;if(typeof _0x3678e3==='string')try{const _0x3971c0=JSON[_0x445c23(0x17d)](_0x3678e3);return Array[_0x445c23(0x189)](_0x3971c0)?_0x3971c0:[];}catch{return[];}return[];}async[a59_0x29e6d3(0x1ad)](_0x498d37){const _0x5a024a=a59_0x29e6d3,_0x36ae78=await database_1[_0x5a024a(0x1aa)]['shop'][_0x5a024a(0x1bb)]({'where':{'id':_0x498d37},'include':{'settings':!![]}});if(!_0x36ae78)throw new Error(_0x5a024a(0x184));let _0xbb4aa9=_0x36ae78[_0x5a024a(0x1ab)];return!_0xbb4aa9&&(_0xbb4aa9=await database_1[_0x5a024a(0x1aa)][_0x5a024a(0x19b)]['create']({'data':{'shopId':_0x36ae78['id']}})),{'fullName':_0x36ae78['name'],'brand':_0x36ae78['name'],'merchantUrl':_0x36ae78[_0x5a024a(0x19a)],'telegramUsername':_0x36ae78[_0x5a024a(0x1a9)],'telegramBotApiKey':_0xbb4aa9[_0x5a024a(0x193)]?this['maskApiKey'](_0xbb4aa9[_0x5a024a(0x193)]):null,'telegramChatId':_0xbb4aa9['telegramChatId'],'webhookUrl':_0xbb4aa9['webhookUrl'],'webhookEvents':this[_0x5a024a(0x18d)](_0xbb4aa9[_0x5a024a(0x1b6)]),'notifications':{'payment_success':_0xbb4aa9[_0x5a024a(0x1ba)],'payment_failed':_0xbb4aa9['notificationPaymentFailed'],'refund':_0xbb4aa9['notificationRefund'],'payout':_0xbb4aa9['notificationPayout'],'login':_0xbb4aa9[_0x5a024a(0x1a5)],'api_error':_0xbb4aa9[_0x5a024a(0x1b8)]}};}async[a59_0x29e6d3(0x185)](_0x4e222d,_0x5aa216){const _0x55edf9=a59_0x29e6d3,{currentPassword:_0x5930c6,newPassword:_0x3940b8,confirmNewPassword:_0x4e6599}=_0x5aa216;if(_0x3940b8!==_0x4e6599)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x3940b8['length']<0x6)throw new Error(_0x55edf9(0x1b3));const _0x44f4db=await database_1[_0x55edf9(0x1aa)][_0x55edf9(0x1a6)]['findUnique']({'where':{'id':_0x4e222d},'select':{'password':!![]}});if(!_0x44f4db)throw new Error(_0x55edf9(0x184));const _0x29dba0=await bcryptjs_1[_0x55edf9(0x1aa)]['compare'](_0x5930c6,_0x44f4db[_0x55edf9(0x1a0)]);if(!_0x29dba0)throw new Error('Current\x20password\x20is\x20incorrect');const _0x2faaa1=await bcryptjs_1['default'][_0x55edf9(0x199)](_0x3940b8,0xc);await database_1[_0x55edf9(0x1aa)][_0x55edf9(0x1a6)][_0x55edf9(0x18a)]({'where':{'id':_0x4e222d},'data':{'password':_0x2faaa1}});}async[a59_0x29e6d3(0x1a8)](_0x15c82a,_0x5baa51){const _0x450140=a59_0x29e6d3;await this[_0x450140(0x1af)](_0x15c82a);const _0x37f24b={};_0x5baa51[_0x450140(0x179)]!==undefined&&(_0x37f24b[_0x450140(0x1ba)]=_0x5baa51['payment_success']),_0x5baa51['payment_failed']!==undefined&&(_0x37f24b[_0x450140(0x195)]=_0x5baa51['payment_failed']),_0x5baa51[_0x450140(0x181)]!==undefined&&(_0x37f24b[_0x450140(0x19d)]=_0x5baa51[_0x450140(0x181)]),_0x5baa51[_0x450140(0x180)]!==undefined&&(_0x37f24b['notificationPayout']=_0x5baa51['payout']),_0x5baa51[_0x450140(0x18e)]!==undefined&&(_0x37f24b[_0x450140(0x1a5)]=_0x5baa51['login']),_0x5baa51[_0x450140(0x1a3)]!==undefined&&(_0x37f24b[_0x450140(0x1b8)]=_0x5baa51['api_error']),await database_1[_0x450140(0x1aa)][_0x450140(0x19b)]['update']({'where':{'shopId':_0x15c82a},'data':_0x37f24b});}async[a59_0x29e6d3(0x1a7)](_0x277249,_0x2b27e0){const _0xeed3de=a59_0x29e6d3;await this[_0xeed3de(0x1af)](_0x277249);const _0x24fdac={};_0x2b27e0['botApiKey']!==undefined&&(_0x24fdac[_0xeed3de(0x193)]=_0x2b27e0[_0xeed3de(0x192)]||null),_0x2b27e0[_0xeed3de(0x19e)]!==undefined&&(_0x24fdac[_0xeed3de(0x17f)]=_0x2b27e0[_0xeed3de(0x19e)]||null),await database_1[_0xeed3de(0x1aa)][_0xeed3de(0x19b)][_0xeed3de(0x18a)]({'where':{'shopId':_0x277249},'data':_0x24fdac});}async[a59_0x29e6d3(0x19f)](_0x5d922d,_0x8a71af){const _0x336269=a59_0x29e6d3;await this[_0x336269(0x1af)](_0x5d922d);const _0x4dafb0={};_0x8a71af['webhookUrl']!==undefined&&(_0x4dafb0[_0x336269(0x1b2)]=_0x8a71af['webhookUrl']||null),_0x8a71af[_0x336269(0x1b6)]!==undefined&&(_0x4dafb0[_0x336269(0x1b6)]=_0x8a71af[_0x336269(0x1b6)]||[]),await database_1[_0x336269(0x1aa)]['shopSettings'][_0x336269(0x18a)]({'where':{'shopId':_0x5d922d},'data':_0x4dafb0});}async[a59_0x29e6d3(0x1a1)](_0x931ffd){const _0x217294=a59_0x29e6d3,_0x8ae629='pk_'+crypto_1[_0x217294(0x1aa)]['randomBytes'](0x20)[_0x217294(0x18b)](_0x217294(0x1b1)),_0x258aa0=_0x217294(0x1b9)+crypto_1[_0x217294(0x1aa)][_0x217294(0x18c)](0x20)['toString'](_0x217294(0x1b1));await database_1[_0x217294(0x1aa)][_0x217294(0x1a6)][_0x217294(0x18a)]({'where':{'id':_0x931ffd},'data':{'publicKey':_0x8ae629,'secretKey':_0x258aa0}});}async[a59_0x29e6d3(0x190)](_0x332d38,_0x237eba){const _0x5b3f27=a59_0x29e6d3,{passwordConfirmation:_0x5044c5}=_0x237eba,_0x5b7eae=await database_1['default'][_0x5b3f27(0x1a6)][_0x5b3f27(0x1bb)]({'where':{'id':_0x332d38},'select':{'password':!![]}});if(!_0x5b7eae)throw new Error(_0x5b3f27(0x184));const _0x5c0025=await bcryptjs_1[_0x5b3f27(0x1aa)][_0x5b3f27(0x182)](_0x5044c5,_0x5b7eae[_0x5b3f27(0x1a0)]);if(!_0x5c0025)throw new Error(_0x5b3f27(0x1a2));await database_1[_0x5b3f27(0x1aa)]['shop']['delete']({'where':{'id':_0x332d38}});}async[a59_0x29e6d3(0x1af)](_0x59fb34){const _0x55f7a0=a59_0x29e6d3,_0xa6ffb5=await database_1[_0x55f7a0(0x1aa)][_0x55f7a0(0x19b)]['findUnique']({'where':{'shopId':_0x59fb34}});!_0xa6ffb5&&await database_1[_0x55f7a0(0x1aa)][_0x55f7a0(0x19b)][_0x55f7a0(0x17a)]({'data':{'shopId':_0x59fb34}});}}function a59_0x5c20(_0x3573b3,_0x3e44e8){const _0x5eae00=a59_0x5eae();return a59_0x5c20=function(_0x5c20a9,_0x1cc3b2){_0x5c20a9=_0x5c20a9-0x178;let _0x33eeb5=_0x5eae00[_0x5c20a9];return _0x33eeb5;},a59_0x5c20(_0x3573b3,_0x3e44e8);}exports['SettingsService']=SettingsService;