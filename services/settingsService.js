'use strict';const a47_0x30247e=a47_0x1fae;(function(_0x431284,_0x5bf463){const _0x5b469c=a47_0x1fae,_0x13d3cf=_0x431284();while(!![]){try{const _0x4f8631=-parseInt(_0x5b469c(0xad))/0x1*(parseInt(_0x5b469c(0x8e))/0x2)+-parseInt(_0x5b469c(0x8f))/0x3*(parseInt(_0x5b469c(0x8a))/0x4)+-parseInt(_0x5b469c(0x84))/0x5*(-parseInt(_0x5b469c(0xae))/0x6)+-parseInt(_0x5b469c(0x77))/0x7*(-parseInt(_0x5b469c(0xb4))/0x8)+-parseInt(_0x5b469c(0xa2))/0x9+-parseInt(_0x5b469c(0x98))/0xa+-parseInt(_0x5b469c(0x90))/0xb*(-parseInt(_0x5b469c(0x94))/0xc);if(_0x4f8631===_0x5bf463)break;else _0x13d3cf['push'](_0x13d3cf['shift']());}catch(_0x1926fb){_0x13d3cf['push'](_0x13d3cf['shift']());}}}(a47_0x22cb,0x92182));var __importDefault=this&&this['__importDefault']||function(_0x4d3fb8){const _0x26fcea=a47_0x1fae;return _0x4d3fb8&&_0x4d3fb8[_0x26fcea(0x85)]?_0x4d3fb8:{'default':_0x4d3fb8};};function a47_0x1fae(_0x186195,_0x838e1b){const _0x22cbff=a47_0x22cb();return a47_0x1fae=function(_0x1fae87,_0x2dd6be){_0x1fae87=_0x1fae87-0x77;let _0x476a5f=_0x22cbff[_0x1fae87];return _0x476a5f;},a47_0x1fae(_0x186195,_0x838e1b);}Object[a47_0x30247e(0x92)](exports,'__esModule',{'value':!![]}),exports['SettingsService']=void 0x0;function a47_0x22cb(){const _0x3d67c6=['1508114pRIFYh','867tIFnpS','26947569nEJEtl','updateNotifications','defineProperty','ensureSettingsExist','12nXVOSA','notificationLogin','../config/database','notificationRefund','11514510QDTVeY','default','isArray','notificationPaymentSuccess','getShopSettings','delete','api_error','parseWebhookEvents','webhookEvents','telegramBotApiKey','1740609krlsjJ','findUnique','webhookUrl','login','notificationApiError','sk_','crypto','Current\x20password\x20is\x20incorrect','length','Shop\x20not\x20found','password','1HIGSlZ','6ZNnvps','randomBytes','hex','compare','name','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','4744nGeBuM','botApiKey','revokeAllApiKeys','changePassword','chatId','shop','toString','max','10024PkhCyd','string','SettingsService','telegram','telegramChatId','pk_','notificationPayout','repeat','hash','update','shopUrl','payout','shopSettings','2599825pqXJYR','__esModule','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','maskApiKey','create','substring','15524umdGcG','bcryptjs','deleteAccount','refund'];a47_0x22cb=function(){return _0x3d67c6;};return a47_0x22cb();}const bcryptjs_1=__importDefault(require(a47_0x30247e(0x8b))),crypto_1=__importDefault(require(a47_0x30247e(0xa8))),database_1=__importDefault(require(a47_0x30247e(0x96)));class SettingsService{[a47_0x30247e(0x87)](_0x3e582a){const _0x220cb6=a47_0x30247e;if(!_0x3e582a)return'';if(_0x3e582a[_0x220cb6(0xaa)]<=0x8)return _0x3e582a;const _0x4e7567=_0x3e582a[_0x220cb6(0x89)](0x0,0x8),_0x418ffc='*'[_0x220cb6(0x7e)](Math[_0x220cb6(0xbb)](0x0,_0x3e582a['length']-0x8));return _0x4e7567+_0x418ffc;}[a47_0x30247e(0x9f)](_0x158ac){const _0x1658ea=a47_0x30247e;if(!_0x158ac)return[];if(Array[_0x1658ea(0x9a)](_0x158ac))return _0x158ac;if(typeof _0x158ac===_0x1658ea(0x78))try{const _0x43f053=JSON['parse'](_0x158ac);return Array[_0x1658ea(0x9a)](_0x43f053)?_0x43f053:[];}catch{return[];}return[];}async[a47_0x30247e(0x9c)](_0x1a7436){const _0x278d08=a47_0x30247e,_0x48afe0=await database_1[_0x278d08(0x99)]['shop']['findUnique']({'where':{'id':_0x1a7436},'include':{'settings':!![]}});if(!_0x48afe0)throw new Error('Shop\x20not\x20found');let _0x11b657=_0x48afe0['settings'];return!_0x11b657&&(_0x11b657=await database_1[_0x278d08(0x99)][_0x278d08(0x83)][_0x278d08(0x88)]({'data':{'shopId':_0x48afe0['id']}})),{'fullName':_0x48afe0[_0x278d08(0xb2)],'brand':_0x48afe0[_0x278d08(0xb2)],'merchantUrl':_0x48afe0[_0x278d08(0x81)],'telegramUsername':_0x48afe0[_0x278d08(0x7a)],'telegramBotApiKey':_0x11b657[_0x278d08(0xa1)]?this[_0x278d08(0x87)](_0x11b657['telegramBotApiKey']):null,'telegramChatId':_0x11b657[_0x278d08(0x7b)],'webhookUrl':_0x11b657['webhookUrl'],'webhookEvents':this[_0x278d08(0x9f)](_0x11b657[_0x278d08(0xa0)]),'notifications':{'payment_success':_0x11b657[_0x278d08(0x9b)],'payment_failed':_0x11b657['notificationPaymentFailed'],'refund':_0x11b657[_0x278d08(0x97)],'payout':_0x11b657[_0x278d08(0x7d)],'login':_0x11b657['notificationLogin'],'api_error':_0x11b657[_0x278d08(0xa6)]}};}async[a47_0x30247e(0xb7)](_0x3aca85,_0xa6b64c){const _0x3f340c=a47_0x30247e,{currentPassword:_0x4e843f,newPassword:_0x2609db,confirmNewPassword:_0x458b1b}=_0xa6b64c;if(_0x2609db!==_0x458b1b)throw new Error(_0x3f340c(0x86));if(_0x2609db[_0x3f340c(0xaa)]<0x6)throw new Error(_0x3f340c(0xb3));const _0x2c8de3=await database_1[_0x3f340c(0x99)]['shop'][_0x3f340c(0xa3)]({'where':{'id':_0x3aca85},'select':{'password':!![]}});if(!_0x2c8de3)throw new Error(_0x3f340c(0xab));const _0x392818=await bcryptjs_1[_0x3f340c(0x99)]['compare'](_0x4e843f,_0x2c8de3[_0x3f340c(0xac)]);if(!_0x392818)throw new Error(_0x3f340c(0xa9));const _0x471ad9=await bcryptjs_1[_0x3f340c(0x99)][_0x3f340c(0x7f)](_0x2609db,0xc);await database_1[_0x3f340c(0x99)][_0x3f340c(0xb9)][_0x3f340c(0x80)]({'where':{'id':_0x3aca85},'data':{'password':_0x471ad9}});}async[a47_0x30247e(0x91)](_0x35efe4,_0x4880c4){const _0xa20ff9=a47_0x30247e;await this[_0xa20ff9(0x93)](_0x35efe4);const _0x487d92={};_0x4880c4['payment_success']!==undefined&&(_0x487d92[_0xa20ff9(0x9b)]=_0x4880c4['payment_success']),_0x4880c4['payment_failed']!==undefined&&(_0x487d92['notificationPaymentFailed']=_0x4880c4['payment_failed']),_0x4880c4['refund']!==undefined&&(_0x487d92[_0xa20ff9(0x97)]=_0x4880c4[_0xa20ff9(0x8d)]),_0x4880c4[_0xa20ff9(0x82)]!==undefined&&(_0x487d92[_0xa20ff9(0x7d)]=_0x4880c4[_0xa20ff9(0x82)]),_0x4880c4[_0xa20ff9(0xa5)]!==undefined&&(_0x487d92[_0xa20ff9(0x95)]=_0x4880c4[_0xa20ff9(0xa5)]),_0x4880c4['api_error']!==undefined&&(_0x487d92[_0xa20ff9(0xa6)]=_0x4880c4[_0xa20ff9(0x9e)]),await database_1['default'][_0xa20ff9(0x83)][_0xa20ff9(0x80)]({'where':{'shopId':_0x35efe4},'data':_0x487d92});}async['updateTelegramSettings'](_0x310a23,_0x2dffad){const _0x16906d=a47_0x30247e;await this[_0x16906d(0x93)](_0x310a23);const _0x154058={};_0x2dffad['botApiKey']!==undefined&&(_0x154058[_0x16906d(0xa1)]=_0x2dffad[_0x16906d(0xb5)]||null),_0x2dffad[_0x16906d(0xb8)]!==undefined&&(_0x154058['telegramChatId']=_0x2dffad['chatId']||null),await database_1['default'][_0x16906d(0x83)]['update']({'where':{'shopId':_0x310a23},'data':_0x154058});}async['updateWebhookSettings'](_0x536f15,_0x58a605){const _0x351c79=a47_0x30247e;await this[_0x351c79(0x93)](_0x536f15);const _0x6af0a5={};_0x58a605[_0x351c79(0xa4)]!==undefined&&(_0x6af0a5[_0x351c79(0xa4)]=_0x58a605[_0x351c79(0xa4)]||null),_0x58a605[_0x351c79(0xa0)]!==undefined&&(_0x6af0a5[_0x351c79(0xa0)]=_0x58a605[_0x351c79(0xa0)]||[]),await database_1[_0x351c79(0x99)][_0x351c79(0x83)][_0x351c79(0x80)]({'where':{'shopId':_0x536f15},'data':_0x6af0a5});}async[a47_0x30247e(0xb6)](_0x37ba6d){const _0x3a3c36=a47_0x30247e,_0x479482=_0x3a3c36(0x7c)+crypto_1[_0x3a3c36(0x99)][_0x3a3c36(0xaf)](0x20)[_0x3a3c36(0xba)](_0x3a3c36(0xb0)),_0x4934f0=_0x3a3c36(0xa7)+crypto_1[_0x3a3c36(0x99)][_0x3a3c36(0xaf)](0x20)[_0x3a3c36(0xba)]('hex');await database_1['default'][_0x3a3c36(0xb9)]['update']({'where':{'id':_0x37ba6d},'data':{'publicKey':_0x479482,'secretKey':_0x4934f0}});}async[a47_0x30247e(0x8c)](_0x2b416d,_0x3121d3){const _0xb71d78=a47_0x30247e,{passwordConfirmation:_0x4ab8f2}=_0x3121d3,_0x5e9561=await database_1[_0xb71d78(0x99)][_0xb71d78(0xb9)][_0xb71d78(0xa3)]({'where':{'id':_0x2b416d},'select':{'password':!![]}});if(!_0x5e9561)throw new Error(_0xb71d78(0xab));const _0x2f17be=await bcryptjs_1['default'][_0xb71d78(0xb1)](_0x4ab8f2,_0x5e9561['password']);if(!_0x2f17be)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0xb71d78(0x99)]['shop'][_0xb71d78(0x9d)]({'where':{'id':_0x2b416d}});}async['ensureSettingsExist'](_0x5999b2){const _0x473293=a47_0x30247e,_0x9ab983=await database_1['default'][_0x473293(0x83)][_0x473293(0xa3)]({'where':{'shopId':_0x5999b2}});!_0x9ab983&&await database_1['default'][_0x473293(0x83)]['create']({'data':{'shopId':_0x5999b2}});}}exports[a47_0x30247e(0x79)]=SettingsService;