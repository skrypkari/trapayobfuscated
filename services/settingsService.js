'use strict';const a72_0x3df9a8=a72_0x2883;(function(_0x4d8646,_0x25444e){const _0x4ad919=a72_0x2883,_0x1af359=_0x4d8646();while(!![]){try{const _0x53660b=parseInt(_0x4ad919(0x15c))/0x1*(parseInt(_0x4ad919(0x13f))/0x2)+parseInt(_0x4ad919(0x13c))/0x3*(parseInt(_0x4ad919(0x124))/0x4)+parseInt(_0x4ad919(0x160))/0x5+-parseInt(_0x4ad919(0x133))/0x6*(parseInt(_0x4ad919(0x121))/0x7)+parseInt(_0x4ad919(0x131))/0x8+-parseInt(_0x4ad919(0x152))/0x9*(parseInt(_0x4ad919(0x128))/0xa)+parseInt(_0x4ad919(0x14b))/0xb*(parseInt(_0x4ad919(0x13b))/0xc);if(_0x53660b===_0x25444e)break;else _0x1af359['push'](_0x1af359['shift']());}catch(_0x4b0f4d){_0x1af359['push'](_0x1af359['shift']());}}}(a72_0x127d,0xd9b7e));function a72_0x127d(){const _0x1e4234=['isArray','9535196LblbUk','max','Current\x20password\x20is\x20incorrect','login','shop','notificationPayout','notificationLogin','1278vTcKvz','getShopSettings','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','SettingsService','updateWebhookSettings','bcryptjs','default','payment_success','updateNotifications','webhookUrl','13dPyHYI','__esModule','parseWebhookEvents','sk_','3897125Jsryts','__importDefault','settings','update','deleteAccount','notificationApiError','maskApiKey','7Vylydd','length','changePassword','328mgdApW','ensureSettingsExist','crypto','notificationPaymentFailed','125470IrugtO','password','botApiKey','create','telegramBotApiKey','notificationPaymentSuccess','../config/database','toString','randomBytes','4077112TVttnk','compare','4921842OVQxTS','telegramChatId','hex','notificationRefund','webhookEvents','chatId','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','name','12BUPRVw','38775IAcbmF','Shop\x20not\x20found','findUnique','42770zVFfQx','payment_failed','updateTelegramSettings','shopSettings','delete','telegram','api_error','defineProperty','substring','refund','pk_'];a72_0x127d=function(){return _0x1e4234;};return a72_0x127d();}var __importDefault=this&&this[a72_0x3df9a8(0x161)]||function(_0x45a822){return _0x45a822&&_0x45a822['__esModule']?_0x45a822:{'default':_0x45a822};};Object[a72_0x3df9a8(0x146)](exports,a72_0x3df9a8(0x15d),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a72_0x3df9a8(0x157))),crypto_1=__importDefault(require(a72_0x3df9a8(0x126))),database_1=__importDefault(require(a72_0x3df9a8(0x12e)));function a72_0x2883(_0x4f01ec,_0x5c28e3){_0x4f01ec=_0x4f01ec-0x11f;const _0x127d66=a72_0x127d();let _0x28838b=_0x127d66[_0x4f01ec];return _0x28838b;}class SettingsService{[a72_0x3df9a8(0x120)](_0x32a7ba){const _0x3ee4ce=a72_0x3df9a8;if(!_0x32a7ba)return'';if(_0x32a7ba[_0x3ee4ce(0x122)]<=0x8)return _0x32a7ba;const _0x11a091=_0x32a7ba[_0x3ee4ce(0x147)](0x0,0x8),_0x4edc12='*'['repeat'](Math[_0x3ee4ce(0x14c)](0x0,_0x32a7ba[_0x3ee4ce(0x122)]-0x8));return _0x11a091+_0x4edc12;}['parseWebhookEvents'](_0x30dfa0){const _0x316daf=a72_0x3df9a8;if(!_0x30dfa0)return[];if(Array[_0x316daf(0x14a)](_0x30dfa0))return _0x30dfa0;if(typeof _0x30dfa0==='string')try{const _0x637b5f=JSON['parse'](_0x30dfa0);return Array[_0x316daf(0x14a)](_0x637b5f)?_0x637b5f:[];}catch{return[];}return[];}async[a72_0x3df9a8(0x153)](_0x171bbc){const _0x1293d2=a72_0x3df9a8,_0x4d940f=await database_1[_0x1293d2(0x158)][_0x1293d2(0x14f)][_0x1293d2(0x13e)]({'where':{'id':_0x171bbc},'include':{'settings':!![]}});if(!_0x4d940f)throw new Error(_0x1293d2(0x13d));let _0x3e1a6c=_0x4d940f[_0x1293d2(0x162)];return!_0x3e1a6c&&(_0x3e1a6c=await database_1['default'][_0x1293d2(0x142)][_0x1293d2(0x12b)]({'data':{'shopId':_0x4d940f['id']}})),{'fullName':_0x4d940f['name'],'brand':_0x4d940f[_0x1293d2(0x13a)],'merchantUrl':_0x4d940f['shopUrl'],'telegramUsername':_0x4d940f[_0x1293d2(0x144)],'telegramBotApiKey':_0x3e1a6c[_0x1293d2(0x12c)]?this['maskApiKey'](_0x3e1a6c[_0x1293d2(0x12c)]):null,'telegramChatId':_0x3e1a6c[_0x1293d2(0x134)],'webhookUrl':_0x3e1a6c[_0x1293d2(0x15b)],'webhookEvents':this[_0x1293d2(0x15e)](_0x3e1a6c[_0x1293d2(0x137)]),'notifications':{'payment_success':_0x3e1a6c[_0x1293d2(0x12d)],'payment_failed':_0x3e1a6c[_0x1293d2(0x127)],'refund':_0x3e1a6c[_0x1293d2(0x136)],'payout':_0x3e1a6c['notificationPayout'],'login':_0x3e1a6c['notificationLogin'],'api_error':_0x3e1a6c[_0x1293d2(0x11f)]}};}async[a72_0x3df9a8(0x123)](_0x4b4176,_0x290b27){const _0xf92b70=a72_0x3df9a8,{currentPassword:_0x3f654e,newPassword:_0x2fb1c9,confirmNewPassword:_0x2e61c7}=_0x290b27;if(_0x2fb1c9!==_0x2e61c7)throw new Error(_0xf92b70(0x139));if(_0x2fb1c9[_0xf92b70(0x122)]<0x6)throw new Error(_0xf92b70(0x154));const _0x188f54=await database_1[_0xf92b70(0x158)][_0xf92b70(0x14f)][_0xf92b70(0x13e)]({'where':{'id':_0x4b4176},'select':{'password':!![]}});if(!_0x188f54)throw new Error('Shop\x20not\x20found');const _0x297c4d=await bcryptjs_1[_0xf92b70(0x158)][_0xf92b70(0x132)](_0x3f654e,_0x188f54[_0xf92b70(0x129)]);if(!_0x297c4d)throw new Error(_0xf92b70(0x14d));const _0x150c44=await bcryptjs_1[_0xf92b70(0x158)]['hash'](_0x2fb1c9,0xc);await database_1[_0xf92b70(0x158)][_0xf92b70(0x14f)][_0xf92b70(0x163)]({'where':{'id':_0x4b4176},'data':{'password':_0x150c44}});}async[a72_0x3df9a8(0x15a)](_0x2eb817,_0x41f9aa){const _0x4294d0=a72_0x3df9a8;await this['ensureSettingsExist'](_0x2eb817);const _0x1af39b={};_0x41f9aa['payment_success']!==undefined&&(_0x1af39b[_0x4294d0(0x12d)]=_0x41f9aa[_0x4294d0(0x159)]),_0x41f9aa[_0x4294d0(0x140)]!==undefined&&(_0x1af39b['notificationPaymentFailed']=_0x41f9aa[_0x4294d0(0x140)]),_0x41f9aa[_0x4294d0(0x148)]!==undefined&&(_0x1af39b[_0x4294d0(0x136)]=_0x41f9aa[_0x4294d0(0x148)]),_0x41f9aa['payout']!==undefined&&(_0x1af39b[_0x4294d0(0x150)]=_0x41f9aa['payout']),_0x41f9aa['login']!==undefined&&(_0x1af39b[_0x4294d0(0x151)]=_0x41f9aa[_0x4294d0(0x14e)]),_0x41f9aa[_0x4294d0(0x145)]!==undefined&&(_0x1af39b['notificationApiError']=_0x41f9aa[_0x4294d0(0x145)]),await database_1[_0x4294d0(0x158)][_0x4294d0(0x142)][_0x4294d0(0x163)]({'where':{'shopId':_0x2eb817},'data':_0x1af39b});}async[a72_0x3df9a8(0x141)](_0x4d8483,_0x15bf28){const _0x19c739=a72_0x3df9a8;await this[_0x19c739(0x125)](_0x4d8483);const _0x55f53b={};_0x15bf28['botApiKey']!==undefined&&(_0x55f53b['telegramBotApiKey']=_0x15bf28[_0x19c739(0x12a)]||null),_0x15bf28[_0x19c739(0x138)]!==undefined&&(_0x55f53b[_0x19c739(0x134)]=_0x15bf28['chatId']||null),await database_1[_0x19c739(0x158)][_0x19c739(0x142)][_0x19c739(0x163)]({'where':{'shopId':_0x4d8483},'data':_0x55f53b});}async[a72_0x3df9a8(0x156)](_0x1589cd,_0x43db3f){const _0x3c3932=a72_0x3df9a8;await this['ensureSettingsExist'](_0x1589cd);const _0x31a8ac={};_0x43db3f[_0x3c3932(0x15b)]!==undefined&&(_0x31a8ac[_0x3c3932(0x15b)]=_0x43db3f[_0x3c3932(0x15b)]||null),_0x43db3f[_0x3c3932(0x137)]!==undefined&&(_0x31a8ac['webhookEvents']=_0x43db3f['webhookEvents']||[]),await database_1[_0x3c3932(0x158)]['shopSettings'][_0x3c3932(0x163)]({'where':{'shopId':_0x1589cd},'data':_0x31a8ac});}async['revokeAllApiKeys'](_0x571b8e){const _0x37ef4d=a72_0x3df9a8,_0x31129c=_0x37ef4d(0x149)+crypto_1['default'][_0x37ef4d(0x130)](0x20)[_0x37ef4d(0x12f)]('hex'),_0x5df9a7=_0x37ef4d(0x15f)+crypto_1[_0x37ef4d(0x158)]['randomBytes'](0x20)[_0x37ef4d(0x12f)](_0x37ef4d(0x135));await database_1['default'][_0x37ef4d(0x14f)][_0x37ef4d(0x163)]({'where':{'id':_0x571b8e},'data':{'publicKey':_0x31129c,'secretKey':_0x5df9a7}});}async[a72_0x3df9a8(0x164)](_0x1c1be4,_0x2027b2){const _0x5215ad=a72_0x3df9a8,{passwordConfirmation:_0x4a258b}=_0x2027b2,_0x58d592=await database_1[_0x5215ad(0x158)][_0x5215ad(0x14f)]['findUnique']({'where':{'id':_0x1c1be4},'select':{'password':!![]}});if(!_0x58d592)throw new Error(_0x5215ad(0x13d));const _0x42c82f=await bcryptjs_1[_0x5215ad(0x158)]['compare'](_0x4a258b,_0x58d592[_0x5215ad(0x129)]);if(!_0x42c82f)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x5215ad(0x158)][_0x5215ad(0x14f)][_0x5215ad(0x143)]({'where':{'id':_0x1c1be4}});}async[a72_0x3df9a8(0x125)](_0x5afc22){const _0x126294=a72_0x3df9a8,_0x54d7de=await database_1[_0x126294(0x158)]['shopSettings'][_0x126294(0x13e)]({'where':{'shopId':_0x5afc22}});!_0x54d7de&&await database_1[_0x126294(0x158)][_0x126294(0x142)][_0x126294(0x12b)]({'data':{'shopId':_0x5afc22}});}}exports[a72_0x3df9a8(0x155)]=SettingsService;