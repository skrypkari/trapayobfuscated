'use strict';const a53_0x342ce7=a53_0x537c;function a53_0x537c(_0x12c3da,_0x56a9fd){const _0x35c78d=a53_0x35c7();return a53_0x537c=function(_0x537cde,_0x19312d){_0x537cde=_0x537cde-0xd7;let _0x3b1ec4=_0x35c78d[_0x537cde];return _0x3b1ec4;},a53_0x537c(_0x12c3da,_0x56a9fd);}(function(_0x130d14,_0x4414a8){const _0x5bd171=a53_0x537c,_0xbecec8=_0x130d14();while(!![]){try{const _0x1cc591=parseInt(_0x5bd171(0xe0))/0x1+parseInt(_0x5bd171(0xdf))/0x2*(-parseInt(_0x5bd171(0x10c))/0x3)+parseInt(_0x5bd171(0x105))/0x4*(-parseInt(_0x5bd171(0xfb))/0x5)+parseInt(_0x5bd171(0x114))/0x6+-parseInt(_0x5bd171(0xe1))/0x7+parseInt(_0x5bd171(0xec))/0x8*(parseInt(_0x5bd171(0x10f))/0x9)+-parseInt(_0x5bd171(0x11c))/0xa;if(_0x1cc591===_0x4414a8)break;else _0xbecec8['push'](_0xbecec8['shift']());}catch(_0x4ae744){_0xbecec8['push'](_0xbecec8['shift']());}}}(a53_0x35c7,0xd6ca7));var __importDefault=this&&this[a53_0x342ce7(0xd7)]||function(_0x266321){const _0x2146c9=a53_0x342ce7;return _0x266321&&_0x266321[_0x2146c9(0x106)]?_0x266321:{'default':_0x266321};};Object[a53_0x342ce7(0x119)](exports,a53_0x342ce7(0x106),{'value':!![]}),exports[a53_0x342ce7(0xe2)]=void 0x0;const bcryptjs_1=__importDefault(require(a53_0x342ce7(0xe5))),crypto_1=__importDefault(require(a53_0x342ce7(0x101))),database_1=__importDefault(require(a53_0x342ce7(0x103)));function a53_0x35c7(){const _0x56c9bd=['create','20pzhuNM','678951xrdUEE','3424344hEZnLK','SettingsService','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','delete','bcryptjs','notificationRefund','payment_success','telegram','hash','telegramChatId','repeat','2908976nrljvy','length','sk_','parse','hex','notificationLogin','botApiKey','chatId','updateWebhookSettings','maskApiKey','notificationPaymentFailed','Current\x20password\x20is\x20incorrect','Password\x20confirmation\x20is\x20incorrect','Shop\x20not\x20found','default','395JQTXOH','login','password','randomBytes','api_error','compare','crypto','settings','../config/database','payment_failed','260GUQUzh','__esModule','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','getShopSettings','name','substring','shopUrl','139497vGylbP','notificationPayout','webhookUrl','18IdBmOz','deleteAccount','pk_','shop','updateTelegramSettings','8651556aTnwFj','shopSettings','payout','refund','findUnique','defineProperty','ensureSettingsExist','notificationPaymentSuccess','10090210jOoVKz','parseWebhookEvents','webhookEvents','telegramBotApiKey','__importDefault','changePassword','notificationApiError','toString','update','isArray','max'];a53_0x35c7=function(){return _0x56c9bd;};return a53_0x35c7();}class SettingsService{[a53_0x342ce7(0xf5)](_0x203354){const _0x550c44=a53_0x342ce7;if(!_0x203354)return'';if(_0x203354['length']<=0x8)return _0x203354;const _0x1a10a5=_0x203354[_0x550c44(0x10a)](0x0,0x8),_0x56a2bb='*'[_0x550c44(0xeb)](Math[_0x550c44(0xdd)](0x0,_0x203354[_0x550c44(0xed)]-0x8));return _0x1a10a5+_0x56a2bb;}[a53_0x342ce7(0x11d)](_0x9a71c5){const _0x3a9eab=a53_0x342ce7;if(!_0x9a71c5)return[];if(Array[_0x3a9eab(0xdc)](_0x9a71c5))return _0x9a71c5;if(typeof _0x9a71c5==='string')try{const _0x12c193=JSON[_0x3a9eab(0xef)](_0x9a71c5);return Array['isArray'](_0x12c193)?_0x12c193:[];}catch{return[];}return[];}async[a53_0x342ce7(0x108)](_0x157324){const _0x5eab96=a53_0x342ce7,_0x1a991b=await database_1[_0x5eab96(0xfa)][_0x5eab96(0x112)][_0x5eab96(0x118)]({'where':{'id':_0x157324},'include':{'settings':!![]}});if(!_0x1a991b)throw new Error('Shop\x20not\x20found');let _0x4b8e2d=_0x1a991b[_0x5eab96(0x102)];return!_0x4b8e2d&&(_0x4b8e2d=await database_1[_0x5eab96(0xfa)]['shopSettings'][_0x5eab96(0xde)]({'data':{'shopId':_0x1a991b['id']}})),{'fullName':_0x1a991b[_0x5eab96(0x109)],'brand':_0x1a991b[_0x5eab96(0x109)],'merchantUrl':_0x1a991b[_0x5eab96(0x10b)],'telegramUsername':_0x1a991b[_0x5eab96(0xe8)],'telegramBotApiKey':_0x4b8e2d['telegramBotApiKey']?this[_0x5eab96(0xf5)](_0x4b8e2d[_0x5eab96(0x11f)]):null,'telegramChatId':_0x4b8e2d[_0x5eab96(0xea)],'webhookUrl':_0x4b8e2d[_0x5eab96(0x10e)],'webhookEvents':this['parseWebhookEvents'](_0x4b8e2d[_0x5eab96(0x11e)]),'notifications':{'payment_success':_0x4b8e2d[_0x5eab96(0x11b)],'payment_failed':_0x4b8e2d[_0x5eab96(0xf6)],'refund':_0x4b8e2d[_0x5eab96(0xe6)],'payout':_0x4b8e2d[_0x5eab96(0x10d)],'login':_0x4b8e2d[_0x5eab96(0xf1)],'api_error':_0x4b8e2d[_0x5eab96(0xd9)]}};}async[a53_0x342ce7(0xd8)](_0x421fae,_0x5c10ca){const _0x42267c=a53_0x342ce7,{currentPassword:_0x56ab5d,newPassword:_0x4c6260,confirmNewPassword:_0x5cdffc}=_0x5c10ca;if(_0x4c6260!==_0x5cdffc)throw new Error(_0x42267c(0xe3));if(_0x4c6260['length']<0x6)throw new Error(_0x42267c(0x107));const _0x39733e=await database_1['default'][_0x42267c(0x112)][_0x42267c(0x118)]({'where':{'id':_0x421fae},'select':{'password':!![]}});if(!_0x39733e)throw new Error(_0x42267c(0xf9));const _0x59235b=await bcryptjs_1['default'][_0x42267c(0x100)](_0x56ab5d,_0x39733e[_0x42267c(0xfd)]);if(!_0x59235b)throw new Error(_0x42267c(0xf7));const _0x37a8e5=await bcryptjs_1['default'][_0x42267c(0xe9)](_0x4c6260,0xc);await database_1[_0x42267c(0xfa)][_0x42267c(0x112)]['update']({'where':{'id':_0x421fae},'data':{'password':_0x37a8e5}});}async['updateNotifications'](_0x12cc54,_0x3c6c0b){const _0x535e24=a53_0x342ce7;await this[_0x535e24(0x11a)](_0x12cc54);const _0x4ee9fe={};_0x3c6c0b[_0x535e24(0xe7)]!==undefined&&(_0x4ee9fe[_0x535e24(0x11b)]=_0x3c6c0b[_0x535e24(0xe7)]),_0x3c6c0b[_0x535e24(0x104)]!==undefined&&(_0x4ee9fe[_0x535e24(0xf6)]=_0x3c6c0b[_0x535e24(0x104)]),_0x3c6c0b[_0x535e24(0x117)]!==undefined&&(_0x4ee9fe[_0x535e24(0xe6)]=_0x3c6c0b[_0x535e24(0x117)]),_0x3c6c0b[_0x535e24(0x116)]!==undefined&&(_0x4ee9fe[_0x535e24(0x10d)]=_0x3c6c0b[_0x535e24(0x116)]),_0x3c6c0b[_0x535e24(0xfc)]!==undefined&&(_0x4ee9fe[_0x535e24(0xf1)]=_0x3c6c0b['login']),_0x3c6c0b['api_error']!==undefined&&(_0x4ee9fe[_0x535e24(0xd9)]=_0x3c6c0b[_0x535e24(0xff)]),await database_1[_0x535e24(0xfa)][_0x535e24(0x115)]['update']({'where':{'shopId':_0x12cc54},'data':_0x4ee9fe});}async[a53_0x342ce7(0x113)](_0x38f00b,_0x2c788b){const _0x2dff21=a53_0x342ce7;await this[_0x2dff21(0x11a)](_0x38f00b);const _0x4d8f82={};_0x2c788b[_0x2dff21(0xf2)]!==undefined&&(_0x4d8f82[_0x2dff21(0x11f)]=_0x2c788b[_0x2dff21(0xf2)]||null),_0x2c788b['chatId']!==undefined&&(_0x4d8f82[_0x2dff21(0xea)]=_0x2c788b[_0x2dff21(0xf3)]||null),await database_1['default'][_0x2dff21(0x115)][_0x2dff21(0xdb)]({'where':{'shopId':_0x38f00b},'data':_0x4d8f82});}async[a53_0x342ce7(0xf4)](_0x5dd539,_0x1256dd){const _0x31d2b0=a53_0x342ce7;await this['ensureSettingsExist'](_0x5dd539);const _0x2f01df={};_0x1256dd[_0x31d2b0(0x10e)]!==undefined&&(_0x2f01df[_0x31d2b0(0x10e)]=_0x1256dd[_0x31d2b0(0x10e)]||null),_0x1256dd[_0x31d2b0(0x11e)]!==undefined&&(_0x2f01df[_0x31d2b0(0x11e)]=_0x1256dd[_0x31d2b0(0x11e)]||[]),await database_1[_0x31d2b0(0xfa)][_0x31d2b0(0x115)][_0x31d2b0(0xdb)]({'where':{'shopId':_0x5dd539},'data':_0x2f01df});}async['revokeAllApiKeys'](_0x1cf5d4){const _0x3b8411=a53_0x342ce7,_0x5e0a7b=_0x3b8411(0x111)+crypto_1[_0x3b8411(0xfa)][_0x3b8411(0xfe)](0x20)[_0x3b8411(0xda)](_0x3b8411(0xf0)),_0x1530d4=_0x3b8411(0xee)+crypto_1[_0x3b8411(0xfa)]['randomBytes'](0x20)['toString'](_0x3b8411(0xf0));await database_1[_0x3b8411(0xfa)][_0x3b8411(0x112)]['update']({'where':{'id':_0x1cf5d4},'data':{'publicKey':_0x5e0a7b,'secretKey':_0x1530d4}});}async[a53_0x342ce7(0x110)](_0x378d3c,_0x4a3d08){const _0x531826=a53_0x342ce7,{passwordConfirmation:_0x41b07d}=_0x4a3d08,_0x5688cf=await database_1[_0x531826(0xfa)][_0x531826(0x112)][_0x531826(0x118)]({'where':{'id':_0x378d3c},'select':{'password':!![]}});if(!_0x5688cf)throw new Error(_0x531826(0xf9));const _0x2efa83=await bcryptjs_1[_0x531826(0xfa)][_0x531826(0x100)](_0x41b07d,_0x5688cf[_0x531826(0xfd)]);if(!_0x2efa83)throw new Error(_0x531826(0xf8));await database_1[_0x531826(0xfa)][_0x531826(0x112)][_0x531826(0xe4)]({'where':{'id':_0x378d3c}});}async[a53_0x342ce7(0x11a)](_0x4a85bc){const _0x3680a3=a53_0x342ce7,_0x1df887=await database_1[_0x3680a3(0xfa)][_0x3680a3(0x115)]['findUnique']({'where':{'shopId':_0x4a85bc}});!_0x1df887&&await database_1['default'][_0x3680a3(0x115)][_0x3680a3(0xde)]({'data':{'shopId':_0x4a85bc}});}}exports[a53_0x342ce7(0xe2)]=SettingsService;