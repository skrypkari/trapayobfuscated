'use strict';const a53_0x1cc450=a53_0x23b2;(function(_0x7d1fdb,_0x5afcb3){const _0x309b0c=a53_0x23b2,_0xba636c=_0x7d1fdb();while(!![]){try{const _0x6553a0=parseInt(_0x309b0c(0xf1))/0x1*(-parseInt(_0x309b0c(0xf2))/0x2)+parseInt(_0x309b0c(0xf6))/0x3*(-parseInt(_0x309b0c(0xce))/0x4)+parseInt(_0x309b0c(0xdc))/0x5*(parseInt(_0x309b0c(0x108))/0x6)+parseInt(_0x309b0c(0xf7))/0x7*(-parseInt(_0x309b0c(0x100))/0x8)+parseInt(_0x309b0c(0xd5))/0x9*(-parseInt(_0x309b0c(0x109))/0xa)+parseInt(_0x309b0c(0xcf))/0xb+-parseInt(_0x309b0c(0xe3))/0xc*(-parseInt(_0x309b0c(0x107))/0xd);if(_0x6553a0===_0x5afcb3)break;else _0xba636c['push'](_0xba636c['shift']());}catch(_0x13ceef){_0xba636c['push'](_0xba636c['shift']());}}}(a53_0x3a6c,0x28dd9));var __importDefault=this&&this[a53_0x1cc450(0xdf)]||function(_0x1b7a2f){const _0x4a5965=a53_0x1cc450;return _0x1b7a2f&&_0x1b7a2f[_0x4a5965(0xed)]?_0x1b7a2f:{'default':_0x1b7a2f};};Object[a53_0x1cc450(0xd1)](exports,a53_0x1cc450(0xed),{'value':!![]}),exports[a53_0x1cc450(0xd7)]=void 0x0;function a53_0x23b2(_0x410fac,_0x2f5e9b){const _0x3a6c10=a53_0x3a6c();return a53_0x23b2=function(_0x23b2d4,_0x1630e3){_0x23b2d4=_0x23b2d4-0xc7;let _0x493e4e=_0x3a6c10[_0x23b2d4];return _0x493e4e;},a53_0x23b2(_0x410fac,_0x2f5e9b);}const bcryptjs_1=__importDefault(require(a53_0x1cc450(0xfd))),crypto_1=__importDefault(require(a53_0x1cc450(0xf4))),database_1=__importDefault(require('../config/database'));class SettingsService{[a53_0x1cc450(0xef)](_0x1530f0){const _0x363610=a53_0x1cc450;if(!_0x1530f0)return'';if(_0x1530f0[_0x363610(0xfa)]<=0x8)return _0x1530f0;const _0x52dba7=_0x1530f0[_0x363610(0xf8)](0x0,0x8),_0x28ffb7='*'['repeat'](Math['max'](0x0,_0x1530f0[_0x363610(0xfa)]-0x8));return _0x52dba7+_0x28ffb7;}[a53_0x1cc450(0xf9)](_0x526818){const _0x3cc321=a53_0x1cc450;if(!_0x526818)return[];if(Array['isArray'](_0x526818))return _0x526818;if(typeof _0x526818===_0x3cc321(0xe8))try{const _0x3f7318=JSON['parse'](_0x526818);return Array[_0x3cc321(0xdd)](_0x3f7318)?_0x3f7318:[];}catch{return[];}return[];}async[a53_0x1cc450(0xdb)](_0x59c4df){const _0x532df6=a53_0x1cc450,_0x207257=await database_1[_0x532df6(0x10e)][_0x532df6(0xca)]['findUnique']({'where':{'id':_0x59c4df},'include':{'settings':!![]}});if(!_0x207257)throw new Error(_0x532df6(0xe0));let _0x154a55=_0x207257[_0x532df6(0xfe)];return!_0x154a55&&(_0x154a55=await database_1[_0x532df6(0x10e)][_0x532df6(0xd4)]['create']({'data':{'shopId':_0x207257['id']}})),{'fullName':_0x207257[_0x532df6(0xe4)],'brand':_0x207257['name'],'merchantUrl':_0x207257[_0x532df6(0xff)],'telegramUsername':_0x207257[_0x532df6(0xd2)],'telegramBotApiKey':_0x154a55[_0x532df6(0xeb)]?this[_0x532df6(0xef)](_0x154a55['telegramBotApiKey']):null,'telegramChatId':_0x154a55[_0x532df6(0xe6)],'webhookUrl':_0x154a55[_0x532df6(0xcb)],'webhookEvents':this[_0x532df6(0xf9)](_0x154a55[_0x532df6(0xe1)]),'notifications':{'payment_success':_0x154a55[_0x532df6(0x10d)],'payment_failed':_0x154a55[_0x532df6(0xda)],'refund':_0x154a55[_0x532df6(0x10a)],'payout':_0x154a55[_0x532df6(0x104)],'login':_0x154a55[_0x532df6(0xcc)],'api_error':_0x154a55[_0x532df6(0x106)]}};}async[a53_0x1cc450(0xf3)](_0x10b108,_0x264553){const _0x2e1b12=a53_0x1cc450,{currentPassword:_0x42a301,newPassword:_0x364408,confirmNewPassword:_0x3329a0}=_0x264553;if(_0x364408!==_0x3329a0)throw new Error(_0x2e1b12(0xc8));if(_0x364408[_0x2e1b12(0xfa)]<0x6)throw new Error(_0x2e1b12(0xd3));const _0x348f73=await database_1[_0x2e1b12(0x10e)][_0x2e1b12(0xca)][_0x2e1b12(0x102)]({'where':{'id':_0x10b108},'select':{'password':!![]}});if(!_0x348f73)throw new Error(_0x2e1b12(0xe0));const _0x3a3a05=await bcryptjs_1['default']['compare'](_0x42a301,_0x348f73[_0x2e1b12(0x10b)]);if(!_0x3a3a05)throw new Error(_0x2e1b12(0x101));const _0x319704=await bcryptjs_1[_0x2e1b12(0x10e)]['hash'](_0x364408,0xc);await database_1['default'][_0x2e1b12(0xca)][_0x2e1b12(0xfc)]({'where':{'id':_0x10b108},'data':{'password':_0x319704}});}async[a53_0x1cc450(0xc9)](_0x264c3d,_0x254ce4){const _0x83bdeb=a53_0x1cc450;await this[_0x83bdeb(0x10f)](_0x264c3d);const _0x48b6bb={};_0x254ce4[_0x83bdeb(0xe9)]!==undefined&&(_0x48b6bb[_0x83bdeb(0x10d)]=_0x254ce4[_0x83bdeb(0xe9)]),_0x254ce4[_0x83bdeb(0x10c)]!==undefined&&(_0x48b6bb[_0x83bdeb(0xda)]=_0x254ce4['payment_failed']),_0x254ce4[_0x83bdeb(0xde)]!==undefined&&(_0x48b6bb['notificationRefund']=_0x254ce4[_0x83bdeb(0xde)]),_0x254ce4['payout']!==undefined&&(_0x48b6bb[_0x83bdeb(0x104)]=_0x254ce4[_0x83bdeb(0x103)]),_0x254ce4[_0x83bdeb(0xee)]!==undefined&&(_0x48b6bb[_0x83bdeb(0xcc)]=_0x254ce4[_0x83bdeb(0xee)]),_0x254ce4[_0x83bdeb(0xe2)]!==undefined&&(_0x48b6bb[_0x83bdeb(0x106)]=_0x254ce4['api_error']),await database_1[_0x83bdeb(0x10e)][_0x83bdeb(0xd4)][_0x83bdeb(0xfc)]({'where':{'shopId':_0x264c3d},'data':_0x48b6bb});}async[a53_0x1cc450(0xd6)](_0x16d85d,_0x4f00f4){const _0x24fbcb=a53_0x1cc450;await this[_0x24fbcb(0x10f)](_0x16d85d);const _0x2cdd7d={};_0x4f00f4[_0x24fbcb(0x105)]!==undefined&&(_0x2cdd7d['telegramBotApiKey']=_0x4f00f4[_0x24fbcb(0x105)]||null),_0x4f00f4[_0x24fbcb(0xec)]!==undefined&&(_0x2cdd7d['telegramChatId']=_0x4f00f4[_0x24fbcb(0xec)]||null),await database_1['default'][_0x24fbcb(0xd4)][_0x24fbcb(0xfc)]({'where':{'shopId':_0x16d85d},'data':_0x2cdd7d});}async[a53_0x1cc450(0xe5)](_0x33c588,_0x1d383b){const _0x4028b3=a53_0x1cc450;await this['ensureSettingsExist'](_0x33c588);const _0x46d110={};_0x1d383b[_0x4028b3(0xcb)]!==undefined&&(_0x46d110[_0x4028b3(0xcb)]=_0x1d383b['webhookUrl']||null),_0x1d383b['webhookEvents']!==undefined&&(_0x46d110[_0x4028b3(0xe1)]=_0x1d383b[_0x4028b3(0xe1)]||[]),await database_1[_0x4028b3(0x10e)][_0x4028b3(0xd4)][_0x4028b3(0xfc)]({'where':{'shopId':_0x33c588},'data':_0x46d110});}async['revokeAllApiKeys'](_0x51cd4b){const _0x2a1a94=a53_0x1cc450,_0x284101=_0x2a1a94(0xea)+crypto_1['default'][_0x2a1a94(0xc7)](0x20)[_0x2a1a94(0xcd)](_0x2a1a94(0xfb)),_0x4ba946=_0x2a1a94(0xd8)+crypto_1[_0x2a1a94(0x10e)][_0x2a1a94(0xc7)](0x20)[_0x2a1a94(0xcd)](_0x2a1a94(0xfb));await database_1['default'][_0x2a1a94(0xca)][_0x2a1a94(0xfc)]({'where':{'id':_0x51cd4b},'data':{'publicKey':_0x284101,'secretKey':_0x4ba946}});}async[a53_0x1cc450(0xe7)](_0x5eb2e8,_0x327f28){const _0x57e956=a53_0x1cc450,{passwordConfirmation:_0x2e27d3}=_0x327f28,_0x5c0281=await database_1[_0x57e956(0x10e)][_0x57e956(0xca)][_0x57e956(0x102)]({'where':{'id':_0x5eb2e8},'select':{'password':!![]}});if(!_0x5c0281)throw new Error(_0x57e956(0xe0));const _0x2febdb=await bcryptjs_1[_0x57e956(0x10e)][_0x57e956(0xf5)](_0x2e27d3,_0x5c0281[_0x57e956(0x10b)]);if(!_0x2febdb)throw new Error(_0x57e956(0xd9));await database_1[_0x57e956(0x10e)][_0x57e956(0xca)][_0x57e956(0xf0)]({'where':{'id':_0x5eb2e8}});}async[a53_0x1cc450(0x10f)](_0x572981){const _0x4a2718=a53_0x1cc450,_0x364f18=await database_1[_0x4a2718(0x10e)]['shopSettings'][_0x4a2718(0x102)]({'where':{'shopId':_0x572981}});!_0x364f18&&await database_1[_0x4a2718(0x10e)][_0x4a2718(0xd4)][_0x4a2718(0xd0)]({'data':{'shopId':_0x572981}});}}exports[a53_0x1cc450(0xd7)]=SettingsService;function a53_0x3a6c(){const _0x527253=['shopSettings','2709KZjxuX','updateTelegramSettings','SettingsService','sk_','Password\x20confirmation\x20is\x20incorrect','notificationPaymentFailed','getShopSettings','3055atRoeI','isArray','refund','__importDefault','Shop\x20not\x20found','webhookEvents','api_error','3746388MnhoXQ','name','updateWebhookSettings','telegramChatId','deleteAccount','string','payment_success','pk_','telegramBotApiKey','chatId','__esModule','login','maskApiKey','delete','207880OtDwRU','2rpttuE','changePassword','crypto','compare','39471ISIbBr','7jphubm','substring','parseWebhookEvents','length','hex','update','bcryptjs','settings','shopUrl','1728112RPNaHY','Current\x20password\x20is\x20incorrect','findUnique','payout','notificationPayout','botApiKey','notificationApiError','26IZDMsD','1122TFVSXn','8180HFgyxL','notificationRefund','password','payment_failed','notificationPaymentSuccess','default','ensureSettingsExist','randomBytes','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','updateNotifications','shop','webhookUrl','notificationLogin','toString','12erhRyY','1521443fitvVn','create','defineProperty','telegram','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long'];a53_0x3a6c=function(){return _0x527253;};return a53_0x3a6c();}