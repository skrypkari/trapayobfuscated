'use strict';const a50_0x51234a=a50_0x4a71;(function(_0x49ac4c,_0x283462){const _0x41c4c3=a50_0x4a71,_0x5e73b4=_0x49ac4c();while(!![]){try{const _0x12ab6f=-parseInt(_0x41c4c3(0x169))/0x1*(parseInt(_0x41c4c3(0x160))/0x2)+parseInt(_0x41c4c3(0x133))/0x3+-parseInt(_0x41c4c3(0x141))/0x4*(parseInt(_0x41c4c3(0x158))/0x5)+parseInt(_0x41c4c3(0x14b))/0x6*(-parseInt(_0x41c4c3(0x138))/0x7)+parseInt(_0x41c4c3(0x13d))/0x8+parseInt(_0x41c4c3(0x129))/0x9+parseInt(_0x41c4c3(0x14d))/0xa*(parseInt(_0x41c4c3(0x168))/0xb);if(_0x12ab6f===_0x283462)break;else _0x5e73b4['push'](_0x5e73b4['shift']());}catch(_0x351ac6){_0x5e73b4['push'](_0x5e73b4['shift']());}}}(a50_0x35d5,0x318cf));function a50_0x35d5(){const _0x3e5ffc=['hex','name','login','compare','parseWebhookEvents','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','deleteAccount','2020TIsQjW','bcryptjs','shop','updateTelegramSettings','payment_success','default','sk_','payout','3868vmrTsN','parse','shopSettings','Password\x20confirmation\x20is\x20incorrect','settings','repeat','telegramBotApiKey','Shop\x20not\x20found','4145977UdlVun','131ZevOMj','findUnique','updateWebhookSettings','isArray','refund','webhookUrl','1322046lTzCQE','notificationPaymentSuccess','substring','updateNotifications','payment_failed','revokeAllApiKeys','chatId','notificationLogin','maskApiKey','api_error','25674GgZgql','webhookEvents','ensureSettingsExist','max','create','7GrxyZY','randomBytes','hash','defineProperty','notificationPaymentFailed','1076808kDORgV','password','notificationPayout','__esModule','1404AYkkls','update','SettingsService','crypto','toString','notificationApiError','pk_','length','botApiKey','notificationRefund','413058hIwzoL','changePassword','10VYtqyZ','Current\x20password\x20is\x20incorrect','string','telegram'];a50_0x35d5=function(){return _0x3e5ffc;};return a50_0x35d5();}var __importDefault=this&&this['__importDefault']||function(_0x3fb26a){const _0x463329=a50_0x4a71;return _0x3fb26a&&_0x3fb26a[_0x463329(0x140)]?_0x3fb26a:{'default':_0x3fb26a};};function a50_0x4a71(_0x1177c1,_0x3aa17b){const _0x35d557=a50_0x35d5();return a50_0x4a71=function(_0x4a7130,_0xb865fe){_0x4a7130=_0x4a7130-0x128;let _0x3ca883=_0x35d557[_0x4a7130];return _0x3ca883;},a50_0x4a71(_0x1177c1,_0x3aa17b);}Object[a50_0x51234a(0x13b)](exports,a50_0x51234a(0x140),{'value':!![]}),exports[a50_0x51234a(0x143)]=void 0x0;const bcryptjs_1=__importDefault(require(a50_0x51234a(0x159))),crypto_1=__importDefault(require(a50_0x51234a(0x144))),database_1=__importDefault(require('../config/database'));class SettingsService{[a50_0x51234a(0x131)](_0x88b99c){const _0x4f56f2=a50_0x51234a;if(!_0x88b99c)return'';if(_0x88b99c[_0x4f56f2(0x148)]<=0x8)return _0x88b99c;const _0x1073a4=_0x88b99c[_0x4f56f2(0x12b)](0x0,0x8),_0x2eed43='*'[_0x4f56f2(0x165)](Math[_0x4f56f2(0x136)](0x0,_0x88b99c[_0x4f56f2(0x148)]-0x8));return _0x1073a4+_0x2eed43;}[a50_0x51234a(0x155)](_0x47ac2b){const _0x52b7f4=a50_0x51234a;if(!_0x47ac2b)return[];if(Array[_0x52b7f4(0x16c)](_0x47ac2b))return _0x47ac2b;if(typeof _0x47ac2b===_0x52b7f4(0x14f))try{const _0x54c393=JSON[_0x52b7f4(0x161)](_0x47ac2b);return Array[_0x52b7f4(0x16c)](_0x54c393)?_0x54c393:[];}catch{return[];}return[];}async['getShopSettings'](_0xebc82f){const _0x1ff1b4=a50_0x51234a,_0x21196a=await database_1[_0x1ff1b4(0x15d)][_0x1ff1b4(0x15a)][_0x1ff1b4(0x16a)]({'where':{'id':_0xebc82f},'include':{'settings':!![]}});if(!_0x21196a)throw new Error(_0x1ff1b4(0x167));let _0x1c0d1e=_0x21196a[_0x1ff1b4(0x164)];return!_0x1c0d1e&&(_0x1c0d1e=await database_1[_0x1ff1b4(0x15d)]['shopSettings'][_0x1ff1b4(0x137)]({'data':{'shopId':_0x21196a['id']}})),{'fullName':_0x21196a[_0x1ff1b4(0x152)],'brand':_0x21196a[_0x1ff1b4(0x152)],'merchantUrl':_0x21196a['shopUrl'],'telegramUsername':_0x21196a[_0x1ff1b4(0x150)],'telegramBotApiKey':_0x1c0d1e[_0x1ff1b4(0x166)]?this[_0x1ff1b4(0x131)](_0x1c0d1e['telegramBotApiKey']):null,'telegramChatId':_0x1c0d1e['telegramChatId'],'webhookUrl':_0x1c0d1e[_0x1ff1b4(0x128)],'webhookEvents':this[_0x1ff1b4(0x155)](_0x1c0d1e[_0x1ff1b4(0x134)]),'notifications':{'payment_success':_0x1c0d1e[_0x1ff1b4(0x12a)],'payment_failed':_0x1c0d1e[_0x1ff1b4(0x13c)],'refund':_0x1c0d1e[_0x1ff1b4(0x14a)],'payout':_0x1c0d1e[_0x1ff1b4(0x13f)],'login':_0x1c0d1e[_0x1ff1b4(0x130)],'api_error':_0x1c0d1e['notificationApiError']}};}async[a50_0x51234a(0x14c)](_0x2322a3,_0x453c33){const _0x15c4b3=a50_0x51234a,{currentPassword:_0x412534,newPassword:_0x194538,confirmNewPassword:_0x103cf7}=_0x453c33;if(_0x194538!==_0x103cf7)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x194538['length']<0x6)throw new Error(_0x15c4b3(0x156));const _0x287742=await database_1['default'][_0x15c4b3(0x15a)]['findUnique']({'where':{'id':_0x2322a3},'select':{'password':!![]}});if(!_0x287742)throw new Error('Shop\x20not\x20found');const _0x137ea2=await bcryptjs_1[_0x15c4b3(0x15d)][_0x15c4b3(0x154)](_0x412534,_0x287742[_0x15c4b3(0x13e)]);if(!_0x137ea2)throw new Error(_0x15c4b3(0x14e));const _0x5acfb4=await bcryptjs_1[_0x15c4b3(0x15d)][_0x15c4b3(0x13a)](_0x194538,0xc);await database_1[_0x15c4b3(0x15d)][_0x15c4b3(0x15a)][_0x15c4b3(0x142)]({'where':{'id':_0x2322a3},'data':{'password':_0x5acfb4}});}async[a50_0x51234a(0x12c)](_0x56ad8e,_0x1586e5){const _0x59cf14=a50_0x51234a;await this['ensureSettingsExist'](_0x56ad8e);const _0x33b0ff={};_0x1586e5[_0x59cf14(0x15c)]!==undefined&&(_0x33b0ff[_0x59cf14(0x12a)]=_0x1586e5[_0x59cf14(0x15c)]),_0x1586e5[_0x59cf14(0x12d)]!==undefined&&(_0x33b0ff[_0x59cf14(0x13c)]=_0x1586e5['payment_failed']),_0x1586e5[_0x59cf14(0x16d)]!==undefined&&(_0x33b0ff[_0x59cf14(0x14a)]=_0x1586e5['refund']),_0x1586e5[_0x59cf14(0x15f)]!==undefined&&(_0x33b0ff[_0x59cf14(0x13f)]=_0x1586e5[_0x59cf14(0x15f)]),_0x1586e5['login']!==undefined&&(_0x33b0ff[_0x59cf14(0x130)]=_0x1586e5[_0x59cf14(0x153)]),_0x1586e5[_0x59cf14(0x132)]!==undefined&&(_0x33b0ff[_0x59cf14(0x146)]=_0x1586e5[_0x59cf14(0x132)]),await database_1[_0x59cf14(0x15d)][_0x59cf14(0x162)][_0x59cf14(0x142)]({'where':{'shopId':_0x56ad8e},'data':_0x33b0ff});}async[a50_0x51234a(0x15b)](_0x34a0ad,_0x20801c){const _0x131826=a50_0x51234a;await this[_0x131826(0x135)](_0x34a0ad);const _0x2818d0={};_0x20801c[_0x131826(0x149)]!==undefined&&(_0x2818d0[_0x131826(0x166)]=_0x20801c['botApiKey']||null),_0x20801c['chatId']!==undefined&&(_0x2818d0['telegramChatId']=_0x20801c[_0x131826(0x12f)]||null),await database_1['default'][_0x131826(0x162)][_0x131826(0x142)]({'where':{'shopId':_0x34a0ad},'data':_0x2818d0});}async[a50_0x51234a(0x16b)](_0x1ae4e8,_0x15c84a){const _0x148267=a50_0x51234a;await this[_0x148267(0x135)](_0x1ae4e8);const _0x19d7b4={};_0x15c84a['webhookUrl']!==undefined&&(_0x19d7b4['webhookUrl']=_0x15c84a[_0x148267(0x128)]||null),_0x15c84a[_0x148267(0x134)]!==undefined&&(_0x19d7b4[_0x148267(0x134)]=_0x15c84a[_0x148267(0x134)]||[]),await database_1['default'][_0x148267(0x162)][_0x148267(0x142)]({'where':{'shopId':_0x1ae4e8},'data':_0x19d7b4});}async[a50_0x51234a(0x12e)](_0x36beec){const _0x196db0=a50_0x51234a,_0x43a549=_0x196db0(0x147)+crypto_1['default'][_0x196db0(0x139)](0x20)['toString'](_0x196db0(0x151)),_0xf1754b=_0x196db0(0x15e)+crypto_1[_0x196db0(0x15d)][_0x196db0(0x139)](0x20)[_0x196db0(0x145)](_0x196db0(0x151));await database_1['default'][_0x196db0(0x15a)][_0x196db0(0x142)]({'where':{'id':_0x36beec},'data':{'publicKey':_0x43a549,'secretKey':_0xf1754b}});}async[a50_0x51234a(0x157)](_0x47c54c,_0xd947e9){const _0x5264d6=a50_0x51234a,{passwordConfirmation:_0x17bcc7}=_0xd947e9,_0x18629f=await database_1['default'][_0x5264d6(0x15a)][_0x5264d6(0x16a)]({'where':{'id':_0x47c54c},'select':{'password':!![]}});if(!_0x18629f)throw new Error(_0x5264d6(0x167));const _0xbceceb=await bcryptjs_1[_0x5264d6(0x15d)][_0x5264d6(0x154)](_0x17bcc7,_0x18629f[_0x5264d6(0x13e)]);if(!_0xbceceb)throw new Error(_0x5264d6(0x163));await database_1[_0x5264d6(0x15d)][_0x5264d6(0x15a)]['delete']({'where':{'id':_0x47c54c}});}async['ensureSettingsExist'](_0x561edf){const _0x3c7363=a50_0x51234a,_0x45beac=await database_1[_0x3c7363(0x15d)][_0x3c7363(0x162)][_0x3c7363(0x16a)]({'where':{'shopId':_0x561edf}});!_0x45beac&&await database_1[_0x3c7363(0x15d)]['shopSettings']['create']({'data':{'shopId':_0x561edf}});}}exports[a50_0x51234a(0x143)]=SettingsService;