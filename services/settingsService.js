'use strict';const a57_0x1f63a9=a57_0x5bce;(function(_0x19a1c8,_0x531576){const _0x4dd056=a57_0x5bce,_0x53ecf3=_0x19a1c8();while(!![]){try{const _0x191ea5=-parseInt(_0x4dd056(0x1ee))/0x1*(-parseInt(_0x4dd056(0x1b8))/0x2)+parseInt(_0x4dd056(0x1f7))/0x3*(parseInt(_0x4dd056(0x1fb))/0x4)+-parseInt(_0x4dd056(0x1c5))/0x5*(-parseInt(_0x4dd056(0x1ed))/0x6)+-parseInt(_0x4dd056(0x1d4))/0x7*(-parseInt(_0x4dd056(0x1f9))/0x8)+-parseInt(_0x4dd056(0x1b9))/0x9*(-parseInt(_0x4dd056(0x1ef))/0xa)+-parseInt(_0x4dd056(0x1e8))/0xb*(-parseInt(_0x4dd056(0x1f4))/0xc)+-parseInt(_0x4dd056(0x1c7))/0xd;if(_0x191ea5===_0x531576)break;else _0x53ecf3['push'](_0x53ecf3['shift']());}catch(_0x3de1e9){_0x53ecf3['push'](_0x53ecf3['shift']());}}}(a57_0x1d41,0xc1601));function a57_0x5bce(_0xefedff,_0x1ca178){const _0x1d41c4=a57_0x1d41();return a57_0x5bce=function(_0x5bce48,_0x548b85){_0x5bce48=_0x5bce48-0x1b8;let _0x223c9c=_0x1d41c4[_0x5bce48];return _0x223c9c;},a57_0x5bce(_0xefedff,_0x1ca178);}var __importDefault=this&&this[a57_0x1f63a9(0x1f0)]||function(_0x38aca7){const _0x13d136=a57_0x1f63a9;return _0x38aca7&&_0x38aca7[_0x13d136(0x1cf)]?_0x38aca7:{'default':_0x38aca7};};Object[a57_0x1f63a9(0x1dc)](exports,a57_0x1f63a9(0x1cf),{'value':!![]}),exports[a57_0x1f63a9(0x1e7)]=void 0x0;const bcryptjs_1=__importDefault(require(a57_0x1f63a9(0x1d3))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));class SettingsService{[a57_0x1f63a9(0x1eb)](_0x336739){const _0x4d3f2e=a57_0x1f63a9;if(!_0x336739)return'';if(_0x336739[_0x4d3f2e(0x1c4)]<=0x8)return _0x336739;const _0x42c8a1=_0x336739[_0x4d3f2e(0x1d0)](0x0,0x8),_0x50dd2d='*'['repeat'](Math[_0x4d3f2e(0x1cd)](0x0,_0x336739['length']-0x8));return _0x42c8a1+_0x50dd2d;}['parseWebhookEvents'](_0x2c0186){const _0x23fe7f=a57_0x1f63a9;if(!_0x2c0186)return[];if(Array['isArray'](_0x2c0186))return _0x2c0186;if(typeof _0x2c0186==='string')try{const _0x369c63=JSON[_0x23fe7f(0x1d2)](_0x2c0186);return Array[_0x23fe7f(0x1c2)](_0x369c63)?_0x369c63:[];}catch{return[];}return[];}async[a57_0x1f63a9(0x1e2)](_0x70e7f3){const _0x1f8325=a57_0x1f63a9,_0x3e3f28=await database_1[_0x1f8325(0x1e4)][_0x1f8325(0x1f8)][_0x1f8325(0x1be)]({'where':{'id':_0x70e7f3},'include':{'settings':!![]}});if(!_0x3e3f28)throw new Error(_0x1f8325(0x1bc));let _0x3b2341=_0x3e3f28[_0x1f8325(0x1e3)];return!_0x3b2341&&(_0x3b2341=await database_1[_0x1f8325(0x1e4)][_0x1f8325(0x1cc)]['create']({'data':{'shopId':_0x3e3f28['id']}})),{'fullName':_0x3e3f28['name'],'brand':_0x3e3f28[_0x1f8325(0x1f3)],'merchantUrl':_0x3e3f28['shopUrl'],'telegramUsername':_0x3e3f28[_0x1f8325(0x1d6)],'telegramBotApiKey':_0x3b2341[_0x1f8325(0x1c9)]?this[_0x1f8325(0x1eb)](_0x3b2341[_0x1f8325(0x1c9)]):null,'telegramChatId':_0x3b2341[_0x1f8325(0x1f2)],'webhookUrl':_0x3b2341[_0x1f8325(0x1c8)],'webhookEvents':this[_0x1f8325(0x1cb)](_0x3b2341['webhookEvents']),'notifications':{'payment_success':_0x3b2341[_0x1f8325(0x1c3)],'payment_failed':_0x3b2341[_0x1f8325(0x1e6)],'refund':_0x3b2341['notificationRefund'],'payout':_0x3b2341['notificationPayout'],'login':_0x3b2341[_0x1f8325(0x1ec)],'api_error':_0x3b2341[_0x1f8325(0x1d5)]}};}async[a57_0x1f63a9(0x1bb)](_0x13683d,_0x5f2633){const _0x260577=a57_0x1f63a9,{currentPassword:_0x4144b5,newPassword:_0x544367,confirmNewPassword:_0x28e0e1}=_0x5f2633;if(_0x544367!==_0x28e0e1)throw new Error(_0x260577(0x1bf));if(_0x544367[_0x260577(0x1c4)]<0x6)throw new Error(_0x260577(0x1bd));const _0x16fbaa=await database_1[_0x260577(0x1e4)][_0x260577(0x1f8)]['findUnique']({'where':{'id':_0x13683d},'select':{'password':!![]}});if(!_0x16fbaa)throw new Error(_0x260577(0x1bc));const _0x16cefe=await bcryptjs_1['default'][_0x260577(0x1c1)](_0x4144b5,_0x16fbaa[_0x260577(0x1da)]);if(!_0x16cefe)throw new Error(_0x260577(0x1f5));const _0x184bf9=await bcryptjs_1['default']['hash'](_0x544367,0xc);await database_1['default'][_0x260577(0x1f8)][_0x260577(0x1d7)]({'where':{'id':_0x13683d},'data':{'password':_0x184bf9}});}async['updateNotifications'](_0x58cd85,_0x74c7b8){const _0x21ce75=a57_0x1f63a9;await this[_0x21ce75(0x1df)](_0x58cd85);const _0x39dc8a={};_0x74c7b8['payment_success']!==undefined&&(_0x39dc8a[_0x21ce75(0x1c3)]=_0x74c7b8[_0x21ce75(0x1e0)]),_0x74c7b8[_0x21ce75(0x1d1)]!==undefined&&(_0x39dc8a[_0x21ce75(0x1e6)]=_0x74c7b8['payment_failed']),_0x74c7b8[_0x21ce75(0x1dd)]!==undefined&&(_0x39dc8a[_0x21ce75(0x1f6)]=_0x74c7b8[_0x21ce75(0x1dd)]),_0x74c7b8[_0x21ce75(0x1db)]!==undefined&&(_0x39dc8a[_0x21ce75(0x1e5)]=_0x74c7b8[_0x21ce75(0x1db)]),_0x74c7b8[_0x21ce75(0x1ba)]!==undefined&&(_0x39dc8a[_0x21ce75(0x1ec)]=_0x74c7b8[_0x21ce75(0x1ba)]),_0x74c7b8[_0x21ce75(0x1e9)]!==undefined&&(_0x39dc8a[_0x21ce75(0x1d5)]=_0x74c7b8['api_error']),await database_1[_0x21ce75(0x1e4)]['shopSettings'][_0x21ce75(0x1d7)]({'where':{'shopId':_0x58cd85},'data':_0x39dc8a});}async['updateTelegramSettings'](_0x143b01,_0x4808db){const _0x3493fd=a57_0x1f63a9;await this['ensureSettingsExist'](_0x143b01);const _0x4d547f={};_0x4808db[_0x3493fd(0x1d9)]!==undefined&&(_0x4d547f[_0x3493fd(0x1c9)]=_0x4808db[_0x3493fd(0x1d9)]||null),_0x4808db[_0x3493fd(0x1e1)]!==undefined&&(_0x4d547f[_0x3493fd(0x1f2)]=_0x4808db['chatId']||null),await database_1['default'][_0x3493fd(0x1cc)][_0x3493fd(0x1d7)]({'where':{'shopId':_0x143b01},'data':_0x4d547f});}async[a57_0x1f63a9(0x1fa)](_0x1873db,_0x3750d8){const _0xd82799=a57_0x1f63a9;await this[_0xd82799(0x1df)](_0x1873db);const _0x305cde={};_0x3750d8[_0xd82799(0x1c8)]!==undefined&&(_0x305cde[_0xd82799(0x1c8)]=_0x3750d8[_0xd82799(0x1c8)]||null),_0x3750d8[_0xd82799(0x1ca)]!==undefined&&(_0x305cde['webhookEvents']=_0x3750d8[_0xd82799(0x1ca)]||[]),await database_1[_0xd82799(0x1e4)][_0xd82799(0x1cc)][_0xd82799(0x1d7)]({'where':{'shopId':_0x1873db},'data':_0x305cde});}async[a57_0x1f63a9(0x1ce)](_0x1a4b9e){const _0x2fca71=a57_0x1f63a9,_0x527357='pk_'+crypto_1[_0x2fca71(0x1e4)][_0x2fca71(0x1fc)](0x20)['toString'](_0x2fca71(0x1de)),_0x9756a5=_0x2fca71(0x1fd)+crypto_1[_0x2fca71(0x1e4)][_0x2fca71(0x1fc)](0x20)[_0x2fca71(0x1c6)](_0x2fca71(0x1de));await database_1[_0x2fca71(0x1e4)]['shop'][_0x2fca71(0x1d7)]({'where':{'id':_0x1a4b9e},'data':{'publicKey':_0x527357,'secretKey':_0x9756a5}});}async[a57_0x1f63a9(0x1f1)](_0x5191cb,_0x2263e6){const _0x591d72=a57_0x1f63a9,{passwordConfirmation:_0x5c2b0d}=_0x2263e6,_0x327b57=await database_1[_0x591d72(0x1e4)][_0x591d72(0x1f8)]['findUnique']({'where':{'id':_0x5191cb},'select':{'password':!![]}});if(!_0x327b57)throw new Error(_0x591d72(0x1bc));const _0x4c57b8=await bcryptjs_1[_0x591d72(0x1e4)][_0x591d72(0x1c1)](_0x5c2b0d,_0x327b57[_0x591d72(0x1da)]);if(!_0x4c57b8)throw new Error(_0x591d72(0x1d8));await database_1[_0x591d72(0x1e4)][_0x591d72(0x1f8)][_0x591d72(0x1c0)]({'where':{'id':_0x5191cb}});}async[a57_0x1f63a9(0x1df)](_0x1a64d0){const _0x11a081=a57_0x1f63a9,_0x556690=await database_1[_0x11a081(0x1e4)][_0x11a081(0x1cc)]['findUnique']({'where':{'shopId':_0x1a64d0}});!_0x556690&&await database_1[_0x11a081(0x1e4)][_0x11a081(0x1cc)][_0x11a081(0x1ea)]({'data':{'shopId':_0x1a64d0}});}}function a57_0x1d41(){const _0x2efc36=['notificationLogin','2544FdGyHq','1RSrFVk','21040CpUKoT','__importDefault','deleteAccount','telegramChatId','name','57072aQhlUF','Current\x20password\x20is\x20incorrect','notificationRefund','75135CBKcLh','shop','16HVFONW','updateWebhookSettings','120nyQDrS','randomBytes','sk_','51826geprnj','3222MJczJu','login','changePassword','Shop\x20not\x20found','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','findUnique','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','delete','compare','isArray','notificationPaymentSuccess','length','13340KpQMYp','toString','30214756KkZyMm','webhookUrl','telegramBotApiKey','webhookEvents','parseWebhookEvents','shopSettings','max','revokeAllApiKeys','__esModule','substring','payment_failed','parse','bcryptjs','1307943KymEyO','notificationApiError','telegram','update','Password\x20confirmation\x20is\x20incorrect','botApiKey','password','payout','defineProperty','refund','hex','ensureSettingsExist','payment_success','chatId','getShopSettings','settings','default','notificationPayout','notificationPaymentFailed','SettingsService','187ZJNDUk','api_error','create','maskApiKey'];a57_0x1d41=function(){return _0x2efc36;};return a57_0x1d41();}exports['SettingsService']=SettingsService;