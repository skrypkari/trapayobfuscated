'use strict';const a52_0x1ca977=a52_0x11b3;function a52_0x11b3(_0x184f18,_0x505768){const _0x3c39a4=a52_0x3c39();return a52_0x11b3=function(_0x11b356,_0x29b3bb){_0x11b356=_0x11b356-0x1cd;let _0x337b36=_0x3c39a4[_0x11b356];return _0x337b36;},a52_0x11b3(_0x184f18,_0x505768);}(function(_0x561906,_0x3e4ca9){const _0x5e52e8=a52_0x11b3,_0x59215f=_0x561906();while(!![]){try{const _0x56ad07=parseInt(_0x5e52e8(0x1e8))/0x1*(-parseInt(_0x5e52e8(0x20c))/0x2)+parseInt(_0x5e52e8(0x1f8))/0x3+-parseInt(_0x5e52e8(0x1f2))/0x4*(parseInt(_0x5e52e8(0x1cf))/0x5)+parseInt(_0x5e52e8(0x1e3))/0x6*(parseInt(_0x5e52e8(0x1fe))/0x7)+-parseInt(_0x5e52e8(0x1dc))/0x8+parseInt(_0x5e52e8(0x1d8))/0x9*(parseInt(_0x5e52e8(0x20d))/0xa)+parseInt(_0x5e52e8(0x1ed))/0xb;if(_0x56ad07===_0x3e4ca9)break;else _0x59215f['push'](_0x59215f['shift']());}catch(_0x19680c){_0x59215f['push'](_0x59215f['shift']());}}}(a52_0x3c39,0xedab2));var __importDefault=this&&this[a52_0x1ca977(0x1ef)]||function(_0x43147f){return _0x43147f&&_0x43147f['__esModule']?_0x43147f:{'default':_0x43147f};};Object['defineProperty'](exports,a52_0x1ca977(0x1ff),{'value':!![]}),exports[a52_0x1ca977(0x207)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x1ca977(0x1d7))),crypto_1=__importDefault(require(a52_0x1ca977(0x1f5))),database_1=__importDefault(require(a52_0x1ca977(0x1df)));function a52_0x3c39(){const _0x35b5fb=['hex','compare','revokeAllApiKeys','delete','6Uludus','30NSjgPj','shopUrl','default','updateTelegramSettings','notificationPayout','5XUdAjo','toString','parseWebhookEvents','repeat','name','substring','sk_','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','bcryptjs','147645IuXOmh','changePassword','webhookUrl','api_error','15513344nRsSOa','notificationPaymentSuccess','payout','../config/database','settings','Password\x20confirmation\x20is\x20incorrect','shop','2124uPYMnb','shopSettings','length','Shop\x20not\x20found','deleteAccount','166403PdwvUg','findUnique','notificationRefund','updateNotifications','Current\x20password\x20is\x20incorrect','15880744LhTbdS','isArray','__importDefault','pk_','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','2543468vpEYac','update','create','crypto','telegramChatId','telegram','4838463qDOAjP','login','payment_failed','refund','botApiKey','payment_success','18627NzJhck','__esModule','chatId','string','notificationApiError','webhookEvents','ensureSettingsExist','telegramBotApiKey','getShopSettings','SettingsService'];a52_0x3c39=function(){return _0x35b5fb;};return a52_0x3c39();}class SettingsService{['maskApiKey'](_0x246a6e){const _0x28d876=a52_0x1ca977;if(!_0x246a6e)return'';if(_0x246a6e[_0x28d876(0x1e5)]<=0x8)return _0x246a6e;const _0x539f28=_0x246a6e[_0x28d876(0x1d4)](0x0,0x8),_0x22e788='*'[_0x28d876(0x1d2)](Math['max'](0x0,_0x246a6e[_0x28d876(0x1e5)]-0x8));return _0x539f28+_0x22e788;}['parseWebhookEvents'](_0x107664){const _0x46b713=a52_0x1ca977;if(!_0x107664)return[];if(Array[_0x46b713(0x1ee)](_0x107664))return _0x107664;if(typeof _0x107664===_0x46b713(0x201))try{const _0x5197fe=JSON['parse'](_0x107664);return Array['isArray'](_0x5197fe)?_0x5197fe:[];}catch{return[];}return[];}async[a52_0x1ca977(0x206)](_0x5192b3){const _0x52b6e3=a52_0x1ca977,_0x178316=await database_1[_0x52b6e3(0x20f)][_0x52b6e3(0x1e2)][_0x52b6e3(0x1e9)]({'where':{'id':_0x5192b3},'include':{'settings':!![]}});if(!_0x178316)throw new Error(_0x52b6e3(0x1e6));let _0x4ecb1e=_0x178316[_0x52b6e3(0x1e0)];return!_0x4ecb1e&&(_0x4ecb1e=await database_1[_0x52b6e3(0x20f)]['shopSettings']['create']({'data':{'shopId':_0x178316['id']}})),{'fullName':_0x178316[_0x52b6e3(0x1d3)],'brand':_0x178316[_0x52b6e3(0x1d3)],'merchantUrl':_0x178316[_0x52b6e3(0x20e)],'telegramUsername':_0x178316[_0x52b6e3(0x1f7)],'telegramBotApiKey':_0x4ecb1e[_0x52b6e3(0x205)]?this['maskApiKey'](_0x4ecb1e[_0x52b6e3(0x205)]):null,'telegramChatId':_0x4ecb1e['telegramChatId'],'webhookUrl':_0x4ecb1e[_0x52b6e3(0x1da)],'webhookEvents':this[_0x52b6e3(0x1d1)](_0x4ecb1e[_0x52b6e3(0x203)]),'notifications':{'payment_success':_0x4ecb1e[_0x52b6e3(0x1dd)],'payment_failed':_0x4ecb1e['notificationPaymentFailed'],'refund':_0x4ecb1e[_0x52b6e3(0x1ea)],'payout':_0x4ecb1e[_0x52b6e3(0x1ce)],'login':_0x4ecb1e['notificationLogin'],'api_error':_0x4ecb1e[_0x52b6e3(0x202)]}};}async[a52_0x1ca977(0x1d9)](_0xa8faa0,_0x524f6c){const _0x358a94=a52_0x1ca977,{currentPassword:_0x12a369,newPassword:_0x507de1,confirmNewPassword:_0x12dda4}=_0x524f6c;if(_0x507de1!==_0x12dda4)throw new Error(_0x358a94(0x1d6));if(_0x507de1[_0x358a94(0x1e5)]<0x6)throw new Error(_0x358a94(0x1f1));const _0x49bd88=await database_1[_0x358a94(0x20f)][_0x358a94(0x1e2)][_0x358a94(0x1e9)]({'where':{'id':_0xa8faa0},'select':{'password':!![]}});if(!_0x49bd88)throw new Error(_0x358a94(0x1e6));const _0x15a91f=await bcryptjs_1[_0x358a94(0x20f)]['compare'](_0x12a369,_0x49bd88['password']);if(!_0x15a91f)throw new Error(_0x358a94(0x1ec));const _0x18888c=await bcryptjs_1['default']['hash'](_0x507de1,0xc);await database_1[_0x358a94(0x20f)]['shop']['update']({'where':{'id':_0xa8faa0},'data':{'password':_0x18888c}});}async[a52_0x1ca977(0x1eb)](_0x136e51,_0x13b8c5){const _0x4bf0ab=a52_0x1ca977;await this['ensureSettingsExist'](_0x136e51);const _0x3eb04d={};_0x13b8c5[_0x4bf0ab(0x1fd)]!==undefined&&(_0x3eb04d[_0x4bf0ab(0x1dd)]=_0x13b8c5[_0x4bf0ab(0x1fd)]),_0x13b8c5[_0x4bf0ab(0x1fa)]!==undefined&&(_0x3eb04d['notificationPaymentFailed']=_0x13b8c5['payment_failed']),_0x13b8c5[_0x4bf0ab(0x1fb)]!==undefined&&(_0x3eb04d[_0x4bf0ab(0x1ea)]=_0x13b8c5[_0x4bf0ab(0x1fb)]),_0x13b8c5[_0x4bf0ab(0x1de)]!==undefined&&(_0x3eb04d['notificationPayout']=_0x13b8c5[_0x4bf0ab(0x1de)]),_0x13b8c5[_0x4bf0ab(0x1f9)]!==undefined&&(_0x3eb04d['notificationLogin']=_0x13b8c5[_0x4bf0ab(0x1f9)]),_0x13b8c5[_0x4bf0ab(0x1db)]!==undefined&&(_0x3eb04d[_0x4bf0ab(0x202)]=_0x13b8c5[_0x4bf0ab(0x1db)]),await database_1[_0x4bf0ab(0x20f)][_0x4bf0ab(0x1e4)]['update']({'where':{'shopId':_0x136e51},'data':_0x3eb04d});}async[a52_0x1ca977(0x1cd)](_0x4aaa99,_0x5c3a46){const _0x469e56=a52_0x1ca977;await this[_0x469e56(0x204)](_0x4aaa99);const _0x533afc={};_0x5c3a46[_0x469e56(0x1fc)]!==undefined&&(_0x533afc[_0x469e56(0x205)]=_0x5c3a46[_0x469e56(0x1fc)]||null),_0x5c3a46['chatId']!==undefined&&(_0x533afc[_0x469e56(0x1f6)]=_0x5c3a46[_0x469e56(0x200)]||null),await database_1[_0x469e56(0x20f)][_0x469e56(0x1e4)][_0x469e56(0x1f3)]({'where':{'shopId':_0x4aaa99},'data':_0x533afc});}async['updateWebhookSettings'](_0x24df4a,_0x20178d){const _0x136c64=a52_0x1ca977;await this[_0x136c64(0x204)](_0x24df4a);const _0x4ec431={};_0x20178d[_0x136c64(0x1da)]!==undefined&&(_0x4ec431[_0x136c64(0x1da)]=_0x20178d['webhookUrl']||null),_0x20178d[_0x136c64(0x203)]!==undefined&&(_0x4ec431[_0x136c64(0x203)]=_0x20178d[_0x136c64(0x203)]||[]),await database_1[_0x136c64(0x20f)][_0x136c64(0x1e4)]['update']({'where':{'shopId':_0x24df4a},'data':_0x4ec431});}async[a52_0x1ca977(0x20a)](_0x5c4909){const _0x34b333=a52_0x1ca977,_0x3dd4f5=_0x34b333(0x1f0)+crypto_1[_0x34b333(0x20f)]['randomBytes'](0x20)[_0x34b333(0x1d0)](_0x34b333(0x208)),_0x80b95f=_0x34b333(0x1d5)+crypto_1[_0x34b333(0x20f)]['randomBytes'](0x20)[_0x34b333(0x1d0)]('hex');await database_1[_0x34b333(0x20f)][_0x34b333(0x1e2)]['update']({'where':{'id':_0x5c4909},'data':{'publicKey':_0x3dd4f5,'secretKey':_0x80b95f}});}async[a52_0x1ca977(0x1e7)](_0x21b959,_0x8a30c7){const _0x23b07b=a52_0x1ca977,{passwordConfirmation:_0x1df426}=_0x8a30c7,_0x42baaa=await database_1[_0x23b07b(0x20f)]['shop']['findUnique']({'where':{'id':_0x21b959},'select':{'password':!![]}});if(!_0x42baaa)throw new Error(_0x23b07b(0x1e6));const _0x47c88c=await bcryptjs_1[_0x23b07b(0x20f)][_0x23b07b(0x209)](_0x1df426,_0x42baaa['password']);if(!_0x47c88c)throw new Error(_0x23b07b(0x1e1));await database_1[_0x23b07b(0x20f)][_0x23b07b(0x1e2)][_0x23b07b(0x20b)]({'where':{'id':_0x21b959}});}async[a52_0x1ca977(0x204)](_0x3febaa){const _0x2e1d12=a52_0x1ca977,_0x371f49=await database_1[_0x2e1d12(0x20f)][_0x2e1d12(0x1e4)][_0x2e1d12(0x1e9)]({'where':{'shopId':_0x3febaa}});!_0x371f49&&await database_1[_0x2e1d12(0x20f)][_0x2e1d12(0x1e4)][_0x2e1d12(0x1f4)]({'data':{'shopId':_0x3febaa}});}}exports[a52_0x1ca977(0x207)]=SettingsService;