'use strict';function a55_0x55d3(_0x1dd731,_0x14a1cb){const _0x761bdf=a55_0x761b();return a55_0x55d3=function(_0x55d36d,_0x4f5983){_0x55d36d=_0x55d36d-0x17a;let _0x20f5f6=_0x761bdf[_0x55d36d];return _0x20f5f6;},a55_0x55d3(_0x1dd731,_0x14a1cb);}const a55_0x10ca51=a55_0x55d3;function a55_0x761b(){const _0x1ed762=['1099bZUcwz','Current\x20password\x20is\x20incorrect','defineProperty','login','Shop\x20not\x20found','toString','string','55APGXyE','payment_failed','deleteAccount','notificationPayout','create','getShopSettings','findUnique','telegram','telegramBotApiKey','423811zlPPJn','2935233pyAJHE','changePassword','1496184FhbCyQ','botApiKey','parse','__esModule','webhookEvents','notificationPaymentFailed','1933664QGJjSF','parseWebhookEvents','updateWebhookSettings','compare','revokeAllApiKeys','default','updateNotifications','maskApiKey','delete','api_error','webhookUrl','payment_success','updateTelegramSettings','max','Password\x20confirmation\x20is\x20incorrect','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','10789480THAzbm','9nSomaz','notificationPaymentSuccess','chatId','hex','repeat','shop','shopUrl','update','hash','393392ldNHWT','SettingsService','length','name','ensureSettingsExist','isArray','password','notificationLogin','../config/database','shopSettings','refund','settings','sk_','notificationApiError','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','__importDefault','substring','pk_','payout','bcryptjs','62840ZlsiBi'];a55_0x761b=function(){return _0x1ed762;};return a55_0x761b();}(function(_0x5208ca,_0x1a8506){const _0x2d6963=a55_0x55d3,_0x2df546=_0x5208ca();while(!![]){try{const _0x81eaa5=-parseInt(_0x2d6963(0x181))/0x1+-parseInt(_0x2d6963(0x18a))/0x2+-parseInt(_0x2d6963(0x182))/0x3+-parseInt(_0x2d6963(0x1a4))/0x4*(-parseInt(_0x2d6963(0x1c0))/0x5)+-parseInt(_0x2d6963(0x184))/0x6+-parseInt(_0x2d6963(0x1b9))/0x7*(-parseInt(_0x2d6963(0x1b8))/0x8)+parseInt(_0x2d6963(0x19b))/0x9*(parseInt(_0x2d6963(0x19a))/0xa);if(_0x81eaa5===_0x1a8506)break;else _0x2df546['push'](_0x2df546['shift']());}catch(_0x34ad26){_0x2df546['push'](_0x2df546['shift']());}}}(a55_0x761b,0xbd5a9));var __importDefault=this&&this[a55_0x10ca51(0x1b3)]||function(_0x436c3f){return _0x436c3f&&_0x436c3f['__esModule']?_0x436c3f:{'default':_0x436c3f};};Object[a55_0x10ca51(0x1bb)](exports,a55_0x10ca51(0x187),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a55_0x10ca51(0x1b7))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a55_0x10ca51(0x1ac)));class SettingsService{['maskApiKey'](_0x36cb9c){const _0x73f755=a55_0x10ca51;if(!_0x36cb9c)return'';if(_0x36cb9c[_0x73f755(0x1a6)]<=0x8)return _0x36cb9c;const _0x5070f9=_0x36cb9c[_0x73f755(0x1b4)](0x0,0x8),_0x1523d0='*'[_0x73f755(0x19f)](Math[_0x73f755(0x197)](0x0,_0x36cb9c[_0x73f755(0x1a6)]-0x8));return _0x5070f9+_0x1523d0;}['parseWebhookEvents'](_0x17deb1){const _0x2e262d=a55_0x10ca51;if(!_0x17deb1)return[];if(Array[_0x2e262d(0x1a9)](_0x17deb1))return _0x17deb1;if(typeof _0x17deb1===_0x2e262d(0x1bf))try{const _0x44fe4=JSON[_0x2e262d(0x186)](_0x17deb1);return Array['isArray'](_0x44fe4)?_0x44fe4:[];}catch{return[];}return[];}async[a55_0x10ca51(0x17d)](_0x2522c1){const _0x432f26=a55_0x10ca51,_0x1fded8=await database_1[_0x432f26(0x18f)][_0x432f26(0x1a0)][_0x432f26(0x17e)]({'where':{'id':_0x2522c1},'include':{'settings':!![]}});if(!_0x1fded8)throw new Error(_0x432f26(0x1bd));let _0x201754=_0x1fded8[_0x432f26(0x1af)];return!_0x201754&&(_0x201754=await database_1[_0x432f26(0x18f)][_0x432f26(0x1ad)][_0x432f26(0x17c)]({'data':{'shopId':_0x1fded8['id']}})),{'fullName':_0x1fded8[_0x432f26(0x1a7)],'brand':_0x1fded8[_0x432f26(0x1a7)],'merchantUrl':_0x1fded8[_0x432f26(0x1a1)],'telegramUsername':_0x1fded8[_0x432f26(0x17f)],'telegramBotApiKey':_0x201754[_0x432f26(0x180)]?this[_0x432f26(0x191)](_0x201754[_0x432f26(0x180)]):null,'telegramChatId':_0x201754['telegramChatId'],'webhookUrl':_0x201754['webhookUrl'],'webhookEvents':this[_0x432f26(0x18b)](_0x201754['webhookEvents']),'notifications':{'payment_success':_0x201754['notificationPaymentSuccess'],'payment_failed':_0x201754['notificationPaymentFailed'],'refund':_0x201754['notificationRefund'],'payout':_0x201754[_0x432f26(0x17b)],'login':_0x201754['notificationLogin'],'api_error':_0x201754[_0x432f26(0x1b1)]}};}async[a55_0x10ca51(0x183)](_0x45be74,_0x18ef45){const _0x4dc293=a55_0x10ca51,{currentPassword:_0x18f798,newPassword:_0x14eebf,confirmNewPassword:_0x5d053c}=_0x18ef45;if(_0x14eebf!==_0x5d053c)throw new Error(_0x4dc293(0x1b2));if(_0x14eebf[_0x4dc293(0x1a6)]<0x6)throw new Error(_0x4dc293(0x199));const _0x430e3d=await database_1['default'][_0x4dc293(0x1a0)][_0x4dc293(0x17e)]({'where':{'id':_0x45be74},'select':{'password':!![]}});if(!_0x430e3d)throw new Error('Shop\x20not\x20found');const _0x573e96=await bcryptjs_1[_0x4dc293(0x18f)][_0x4dc293(0x18d)](_0x18f798,_0x430e3d[_0x4dc293(0x1aa)]);if(!_0x573e96)throw new Error(_0x4dc293(0x1ba));const _0x910ce7=await bcryptjs_1[_0x4dc293(0x18f)][_0x4dc293(0x1a3)](_0x14eebf,0xc);await database_1[_0x4dc293(0x18f)][_0x4dc293(0x1a0)][_0x4dc293(0x1a2)]({'where':{'id':_0x45be74},'data':{'password':_0x910ce7}});}async[a55_0x10ca51(0x190)](_0x1d1bdd,_0x5b6845){const _0x408b45=a55_0x10ca51;await this[_0x408b45(0x1a8)](_0x1d1bdd);const _0x135e05={};_0x5b6845[_0x408b45(0x195)]!==undefined&&(_0x135e05[_0x408b45(0x19c)]=_0x5b6845[_0x408b45(0x195)]),_0x5b6845[_0x408b45(0x1c1)]!==undefined&&(_0x135e05[_0x408b45(0x189)]=_0x5b6845[_0x408b45(0x1c1)]),_0x5b6845['refund']!==undefined&&(_0x135e05['notificationRefund']=_0x5b6845[_0x408b45(0x1ae)]),_0x5b6845[_0x408b45(0x1b6)]!==undefined&&(_0x135e05[_0x408b45(0x17b)]=_0x5b6845[_0x408b45(0x1b6)]),_0x5b6845[_0x408b45(0x1bc)]!==undefined&&(_0x135e05[_0x408b45(0x1ab)]=_0x5b6845['login']),_0x5b6845[_0x408b45(0x193)]!==undefined&&(_0x135e05['notificationApiError']=_0x5b6845[_0x408b45(0x193)]),await database_1[_0x408b45(0x18f)][_0x408b45(0x1ad)]['update']({'where':{'shopId':_0x1d1bdd},'data':_0x135e05});}async[a55_0x10ca51(0x196)](_0x58f78a,_0x91c718){const _0x58145c=a55_0x10ca51;await this['ensureSettingsExist'](_0x58f78a);const _0x48fc66={};_0x91c718[_0x58145c(0x185)]!==undefined&&(_0x48fc66[_0x58145c(0x180)]=_0x91c718[_0x58145c(0x185)]||null),_0x91c718[_0x58145c(0x19d)]!==undefined&&(_0x48fc66['telegramChatId']=_0x91c718[_0x58145c(0x19d)]||null),await database_1[_0x58145c(0x18f)]['shopSettings'][_0x58145c(0x1a2)]({'where':{'shopId':_0x58f78a},'data':_0x48fc66});}async[a55_0x10ca51(0x18c)](_0x5231c3,_0xeac08e){const _0x3b61a0=a55_0x10ca51;await this[_0x3b61a0(0x1a8)](_0x5231c3);const _0x4cd8a3={};_0xeac08e[_0x3b61a0(0x194)]!==undefined&&(_0x4cd8a3[_0x3b61a0(0x194)]=_0xeac08e[_0x3b61a0(0x194)]||null),_0xeac08e[_0x3b61a0(0x188)]!==undefined&&(_0x4cd8a3[_0x3b61a0(0x188)]=_0xeac08e[_0x3b61a0(0x188)]||[]),await database_1[_0x3b61a0(0x18f)][_0x3b61a0(0x1ad)][_0x3b61a0(0x1a2)]({'where':{'shopId':_0x5231c3},'data':_0x4cd8a3});}async[a55_0x10ca51(0x18e)](_0x38fb07){const _0x58ab35=a55_0x10ca51,_0x49e500=_0x58ab35(0x1b5)+crypto_1[_0x58ab35(0x18f)]['randomBytes'](0x20)['toString'](_0x58ab35(0x19e)),_0x206b4b=_0x58ab35(0x1b0)+crypto_1[_0x58ab35(0x18f)]['randomBytes'](0x20)[_0x58ab35(0x1be)](_0x58ab35(0x19e));await database_1[_0x58ab35(0x18f)]['shop'][_0x58ab35(0x1a2)]({'where':{'id':_0x38fb07},'data':{'publicKey':_0x49e500,'secretKey':_0x206b4b}});}async[a55_0x10ca51(0x17a)](_0x132686,_0xcc5a65){const _0x227ae2=a55_0x10ca51,{passwordConfirmation:_0x13ba71}=_0xcc5a65,_0xdcb164=await database_1[_0x227ae2(0x18f)]['shop'][_0x227ae2(0x17e)]({'where':{'id':_0x132686},'select':{'password':!![]}});if(!_0xdcb164)throw new Error(_0x227ae2(0x1bd));const _0x2be278=await bcryptjs_1[_0x227ae2(0x18f)][_0x227ae2(0x18d)](_0x13ba71,_0xdcb164[_0x227ae2(0x1aa)]);if(!_0x2be278)throw new Error(_0x227ae2(0x198));await database_1[_0x227ae2(0x18f)][_0x227ae2(0x1a0)][_0x227ae2(0x192)]({'where':{'id':_0x132686}});}async['ensureSettingsExist'](_0x4d5ca3){const _0x434813=a55_0x10ca51,_0x546578=await database_1['default'][_0x434813(0x1ad)][_0x434813(0x17e)]({'where':{'shopId':_0x4d5ca3}});!_0x546578&&await database_1[_0x434813(0x18f)][_0x434813(0x1ad)][_0x434813(0x17c)]({'data':{'shopId':_0x4d5ca3}});}}exports[a55_0x10ca51(0x1a5)]=SettingsService;