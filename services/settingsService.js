'use strict';const a53_0x15a322=a53_0x179d;(function(_0x4d7fdd,_0x45e2c1){const _0x4fcdac=a53_0x179d,_0x413a24=_0x4d7fdd();while(!![]){try{const _0x142099=-parseInt(_0x4fcdac(0x1fc))/0x1*(parseInt(_0x4fcdac(0x1e7))/0x2)+parseInt(_0x4fcdac(0x1f0))/0x3*(-parseInt(_0x4fcdac(0x203))/0x4)+-parseInt(_0x4fcdac(0x21e))/0x5*(-parseInt(_0x4fcdac(0x212))/0x6)+-parseInt(_0x4fcdac(0x207))/0x7*(-parseInt(_0x4fcdac(0x224))/0x8)+parseInt(_0x4fcdac(0x225))/0x9*(-parseInt(_0x4fcdac(0x1f8))/0xa)+parseInt(_0x4fcdac(0x1ec))/0xb*(parseInt(_0x4fcdac(0x1f5))/0xc)+parseInt(_0x4fcdac(0x1ed))/0xd;if(_0x142099===_0x45e2c1)break;else _0x413a24['push'](_0x413a24['shift']());}catch(_0x5f550b){_0x413a24['push'](_0x413a24['shift']());}}}(a53_0x381b,0x1bc65));function a53_0x179d(_0x1ae184,_0x132028){const _0x381b65=a53_0x381b();return a53_0x179d=function(_0x179d7d,_0x14219e){_0x179d7d=_0x179d7d-0x1e6;let _0x4ecaaa=_0x381b65[_0x179d7d];return _0x4ecaaa;},a53_0x179d(_0x1ae184,_0x132028);}function a53_0x381b(){const _0x1bf0d1=['update','maskApiKey','654370yRVqqT','SettingsService','telegramChatId','revokeAllApiKeys','1IfejFs','shop','max','notificationPayout','updateWebhookSettings','webhookUrl','deleteAccount','1000IwYkZH','notificationPaymentSuccess','shopUrl','isArray','7XNlplt','changePassword','parseWebhookEvents','webhookEvents','name','notificationRefund','toString','__esModule','compare','telegramBotApiKey','api_error','140250mhliFq','ensureSettingsExist','settings','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','notificationPaymentFailed','notificationApiError','Shop\x20not\x20found','telegram','defineProperty','botApiKey','hex','payout','10rSHLXJ','updateNotifications','login','refund','parse','hash','79384DnWmJo','9wuBDVd','repeat','Current\x20password\x20is\x20incorrect','chatId','crypto','default','372586AmuhjP','length','create','shopSettings','string','11gWIAnT','4959643HgUTxR','sk_','findUnique','2217wYGWKa','__importDefault','randomBytes','notificationLogin','Password\x20confirmation\x20is\x20incorrect','1344732uNpTHM'];a53_0x381b=function(){return _0x1bf0d1;};return a53_0x381b();}var __importDefault=this&&this[a53_0x15a322(0x1f1)]||function(_0x50cd51){const _0xcdea6d=a53_0x15a322;return _0x50cd51&&_0x50cd51[_0xcdea6d(0x20e)]?_0x50cd51:{'default':_0x50cd51};};Object[a53_0x15a322(0x21a)](exports,a53_0x15a322(0x20e),{'value':!![]}),exports[a53_0x15a322(0x1f9)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a53_0x15a322(0x229))),database_1=__importDefault(require('../config/database'));class SettingsService{[a53_0x15a322(0x1f7)](_0x515782){const _0x1a8972=a53_0x15a322;if(!_0x515782)return'';if(_0x515782[_0x1a8972(0x1e8)]<=0x8)return _0x515782;const _0x19d710=_0x515782['substring'](0x0,0x8),_0x57cf04='*'[_0x1a8972(0x226)](Math[_0x1a8972(0x1fe)](0x0,_0x515782[_0x1a8972(0x1e8)]-0x8));return _0x19d710+_0x57cf04;}[a53_0x15a322(0x209)](_0x292583){const _0x2d40ef=a53_0x15a322;if(!_0x292583)return[];if(Array[_0x2d40ef(0x206)](_0x292583))return _0x292583;if(typeof _0x292583===_0x2d40ef(0x1eb))try{const _0x5136ec=JSON[_0x2d40ef(0x222)](_0x292583);return Array['isArray'](_0x5136ec)?_0x5136ec:[];}catch{return[];}return[];}async['getShopSettings'](_0x41faa2){const _0x4208f0=a53_0x15a322,_0x433ed3=await database_1['default'][_0x4208f0(0x1fd)][_0x4208f0(0x1ef)]({'where':{'id':_0x41faa2},'include':{'settings':!![]}});if(!_0x433ed3)throw new Error(_0x4208f0(0x218));let _0x8dda2c=_0x433ed3[_0x4208f0(0x214)];return!_0x8dda2c&&(_0x8dda2c=await database_1[_0x4208f0(0x1e6)]['shopSettings'][_0x4208f0(0x1e9)]({'data':{'shopId':_0x433ed3['id']}})),{'fullName':_0x433ed3[_0x4208f0(0x20b)],'brand':_0x433ed3[_0x4208f0(0x20b)],'merchantUrl':_0x433ed3[_0x4208f0(0x205)],'telegramUsername':_0x433ed3[_0x4208f0(0x219)],'telegramBotApiKey':_0x8dda2c[_0x4208f0(0x210)]?this[_0x4208f0(0x1f7)](_0x8dda2c[_0x4208f0(0x210)]):null,'telegramChatId':_0x8dda2c['telegramChatId'],'webhookUrl':_0x8dda2c[_0x4208f0(0x201)],'webhookEvents':this['parseWebhookEvents'](_0x8dda2c[_0x4208f0(0x20a)]),'notifications':{'payment_success':_0x8dda2c[_0x4208f0(0x204)],'payment_failed':_0x8dda2c['notificationPaymentFailed'],'refund':_0x8dda2c['notificationRefund'],'payout':_0x8dda2c[_0x4208f0(0x1ff)],'login':_0x8dda2c[_0x4208f0(0x1f3)],'api_error':_0x8dda2c[_0x4208f0(0x217)]}};}async[a53_0x15a322(0x208)](_0x172f94,_0x79b071){const _0x9f3314=a53_0x15a322,{currentPassword:_0x5d3043,newPassword:_0x219536,confirmNewPassword:_0x4c162b}=_0x79b071;if(_0x219536!==_0x4c162b)throw new Error(_0x9f3314(0x215));if(_0x219536[_0x9f3314(0x1e8)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x2f85ec=await database_1[_0x9f3314(0x1e6)][_0x9f3314(0x1fd)][_0x9f3314(0x1ef)]({'where':{'id':_0x172f94},'select':{'password':!![]}});if(!_0x2f85ec)throw new Error(_0x9f3314(0x218));const _0x3b2b6d=await bcryptjs_1[_0x9f3314(0x1e6)][_0x9f3314(0x20f)](_0x5d3043,_0x2f85ec['password']);if(!_0x3b2b6d)throw new Error(_0x9f3314(0x227));const _0x495a6f=await bcryptjs_1[_0x9f3314(0x1e6)][_0x9f3314(0x223)](_0x219536,0xc);await database_1[_0x9f3314(0x1e6)][_0x9f3314(0x1fd)]['update']({'where':{'id':_0x172f94},'data':{'password':_0x495a6f}});}async[a53_0x15a322(0x21f)](_0x4ce53d,_0x1d8493){const _0x512ee6=a53_0x15a322;await this[_0x512ee6(0x213)](_0x4ce53d);const _0x170873={};_0x1d8493['payment_success']!==undefined&&(_0x170873[_0x512ee6(0x204)]=_0x1d8493['payment_success']),_0x1d8493['payment_failed']!==undefined&&(_0x170873[_0x512ee6(0x216)]=_0x1d8493['payment_failed']),_0x1d8493[_0x512ee6(0x221)]!==undefined&&(_0x170873[_0x512ee6(0x20c)]=_0x1d8493[_0x512ee6(0x221)]),_0x1d8493[_0x512ee6(0x21d)]!==undefined&&(_0x170873[_0x512ee6(0x1ff)]=_0x1d8493[_0x512ee6(0x21d)]),_0x1d8493[_0x512ee6(0x220)]!==undefined&&(_0x170873[_0x512ee6(0x1f3)]=_0x1d8493[_0x512ee6(0x220)]),_0x1d8493[_0x512ee6(0x211)]!==undefined&&(_0x170873[_0x512ee6(0x217)]=_0x1d8493[_0x512ee6(0x211)]),await database_1[_0x512ee6(0x1e6)][_0x512ee6(0x1ea)][_0x512ee6(0x1f6)]({'where':{'shopId':_0x4ce53d},'data':_0x170873});}async['updateTelegramSettings'](_0x568662,_0xe5f629){const _0x3462ed=a53_0x15a322;await this['ensureSettingsExist'](_0x568662);const _0x1e6c16={};_0xe5f629[_0x3462ed(0x21b)]!==undefined&&(_0x1e6c16['telegramBotApiKey']=_0xe5f629['botApiKey']||null),_0xe5f629[_0x3462ed(0x228)]!==undefined&&(_0x1e6c16[_0x3462ed(0x1fa)]=_0xe5f629['chatId']||null),await database_1['default'][_0x3462ed(0x1ea)][_0x3462ed(0x1f6)]({'where':{'shopId':_0x568662},'data':_0x1e6c16});}async[a53_0x15a322(0x200)](_0x15342e,_0xf0fdcd){const _0x580f65=a53_0x15a322;await this[_0x580f65(0x213)](_0x15342e);const _0x50fa1f={};_0xf0fdcd[_0x580f65(0x201)]!==undefined&&(_0x50fa1f[_0x580f65(0x201)]=_0xf0fdcd[_0x580f65(0x201)]||null),_0xf0fdcd[_0x580f65(0x20a)]!==undefined&&(_0x50fa1f['webhookEvents']=_0xf0fdcd[_0x580f65(0x20a)]||[]),await database_1[_0x580f65(0x1e6)][_0x580f65(0x1ea)]['update']({'where':{'shopId':_0x15342e},'data':_0x50fa1f});}async[a53_0x15a322(0x1fb)](_0x232ae7){const _0x4c153b=a53_0x15a322,_0x2289b5='pk_'+crypto_1[_0x4c153b(0x1e6)][_0x4c153b(0x1f2)](0x20)[_0x4c153b(0x20d)](_0x4c153b(0x21c)),_0x40f036=_0x4c153b(0x1ee)+crypto_1[_0x4c153b(0x1e6)][_0x4c153b(0x1f2)](0x20)[_0x4c153b(0x20d)](_0x4c153b(0x21c));await database_1[_0x4c153b(0x1e6)]['shop'][_0x4c153b(0x1f6)]({'where':{'id':_0x232ae7},'data':{'publicKey':_0x2289b5,'secretKey':_0x40f036}});}async[a53_0x15a322(0x202)](_0x333353,_0x2b7127){const _0x17dc23=a53_0x15a322,{passwordConfirmation:_0x357b7b}=_0x2b7127,_0x435cce=await database_1[_0x17dc23(0x1e6)][_0x17dc23(0x1fd)][_0x17dc23(0x1ef)]({'where':{'id':_0x333353},'select':{'password':!![]}});if(!_0x435cce)throw new Error(_0x17dc23(0x218));const _0x2a2c6e=await bcryptjs_1[_0x17dc23(0x1e6)][_0x17dc23(0x20f)](_0x357b7b,_0x435cce['password']);if(!_0x2a2c6e)throw new Error(_0x17dc23(0x1f4));await database_1[_0x17dc23(0x1e6)][_0x17dc23(0x1fd)]['delete']({'where':{'id':_0x333353}});}async['ensureSettingsExist'](_0x10ff84){const _0x1061e6=a53_0x15a322,_0x2bdf2e=await database_1[_0x1061e6(0x1e6)][_0x1061e6(0x1ea)]['findUnique']({'where':{'shopId':_0x10ff84}});!_0x2bdf2e&&await database_1[_0x1061e6(0x1e6)]['shopSettings'][_0x1061e6(0x1e9)]({'data':{'shopId':_0x10ff84}});}}exports[a53_0x15a322(0x1f9)]=SettingsService;