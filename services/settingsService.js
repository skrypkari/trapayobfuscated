'use strict';function a76_0x70c4(_0x2a3032,_0x54b8ed){_0x2a3032=_0x2a3032-0x75;const _0x1e2270=a76_0x1e22();let _0x70c4d=_0x1e2270[_0x2a3032];return _0x70c4d;}function a76_0x1e22(){const _0x232af5=['630BtEAMS','delete','revokeAllApiKeys','substring','notificationLogin','pk_','maskApiKey','__importDefault','Password\x20confirmation\x20is\x20incorrect','settings','ensureSettingsExist','76856iUKnBZ','randomBytes','payment_failed','refund','default','toString','parse','1709484BvwZkb','shopSettings','name','chatId','string','deleteAccount','crypto','Current\x20password\x20is\x20incorrect','notificationPaymentFailed','notificationPaymentSuccess','notificationPayout','../config/database','shop','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','1084120aHVgqQ','webhookUrl','__esModule','update','compare','hex','parseWebhookEvents','updateTelegramSettings','hash','password','bcryptjs','changePassword','telegramBotApiKey','botApiKey','Shop\x20not\x20found','1087994dpkQrQ','login','telegramChatId','api_error','repeat','payment_success','1349831glmTbs','isArray','notificationRefund','104540xvPuua','SettingsService','findUnique','getShopSettings','6IEYYlQ','webhookEvents','shopUrl','473032LqOzPx','notificationApiError','length'];a76_0x1e22=function(){return _0x232af5;};return a76_0x1e22();}const a76_0x24ceac=a76_0x70c4;(function(_0x237082,_0x513064){const _0x465880=a76_0x70c4,_0x236da2=_0x237082();while(!![]){try{const _0x3c4211=parseInt(_0x465880(0xa9))/0x1+-parseInt(_0x465880(0x99))/0x2+parseInt(_0x465880(0xa6))/0x3*(parseInt(_0x465880(0x8a))/0x4)+parseInt(_0x465880(0xa2))/0x5+parseInt(_0x465880(0x7c))/0x6+parseInt(_0x465880(0x9f))/0x7+-parseInt(_0x465880(0x75))/0x8*(parseInt(_0x465880(0xac))/0x9);if(_0x3c4211===_0x513064)break;else _0x236da2['push'](_0x236da2['shift']());}catch(_0x12db06){_0x236da2['push'](_0x236da2['shift']());}}}(a76_0x1e22,0x4892c));var __importDefault=this&&this[a76_0x24ceac(0xb3)]||function(_0x4b750c){const _0x3c246d=a76_0x24ceac;return _0x4b750c&&_0x4b750c[_0x3c246d(0x8c)]?_0x4b750c:{'default':_0x4b750c};};Object['defineProperty'](exports,a76_0x24ceac(0x8c),{'value':!![]}),exports[a76_0x24ceac(0xa3)]=void 0x0;const bcryptjs_1=__importDefault(require(a76_0x24ceac(0x94))),crypto_1=__importDefault(require(a76_0x24ceac(0x82))),database_1=__importDefault(require(a76_0x24ceac(0x87)));class SettingsService{[a76_0x24ceac(0xb2)](_0x1867c5){const _0x17e7fb=a76_0x24ceac;if(!_0x1867c5)return'';if(_0x1867c5[_0x17e7fb(0xab)]<=0x8)return _0x1867c5;const _0x1a713a=_0x1867c5[_0x17e7fb(0xaf)](0x0,0x8),_0x130696='*'[_0x17e7fb(0x9d)](Math['max'](0x0,_0x1867c5[_0x17e7fb(0xab)]-0x8));return _0x1a713a+_0x130696;}[a76_0x24ceac(0x90)](_0x510657){const _0x173097=a76_0x24ceac;if(!_0x510657)return[];if(Array['isArray'](_0x510657))return _0x510657;if(typeof _0x510657===_0x173097(0x80))try{const _0x4aa7b5=JSON[_0x173097(0x7b)](_0x510657);return Array[_0x173097(0xa0)](_0x4aa7b5)?_0x4aa7b5:[];}catch{return[];}return[];}async[a76_0x24ceac(0xa5)](_0x5ddbb1){const _0x62a7dd=a76_0x24ceac,_0xa7a8b6=await database_1[_0x62a7dd(0x79)][_0x62a7dd(0x88)][_0x62a7dd(0xa4)]({'where':{'id':_0x5ddbb1},'include':{'settings':!![]}});if(!_0xa7a8b6)throw new Error(_0x62a7dd(0x98));let _0x38a9ef=_0xa7a8b6[_0x62a7dd(0xb5)];return!_0x38a9ef&&(_0x38a9ef=await database_1['default']['shopSettings']['create']({'data':{'shopId':_0xa7a8b6['id']}})),{'fullName':_0xa7a8b6[_0x62a7dd(0x7e)],'brand':_0xa7a8b6[_0x62a7dd(0x7e)],'merchantUrl':_0xa7a8b6[_0x62a7dd(0xa8)],'telegramUsername':_0xa7a8b6['telegram'],'telegramBotApiKey':_0x38a9ef['telegramBotApiKey']?this[_0x62a7dd(0xb2)](_0x38a9ef[_0x62a7dd(0x96)]):null,'telegramChatId':_0x38a9ef['telegramChatId'],'webhookUrl':_0x38a9ef[_0x62a7dd(0x8b)],'webhookEvents':this[_0x62a7dd(0x90)](_0x38a9ef[_0x62a7dd(0xa7)]),'notifications':{'payment_success':_0x38a9ef[_0x62a7dd(0x85)],'payment_failed':_0x38a9ef['notificationPaymentFailed'],'refund':_0x38a9ef[_0x62a7dd(0xa1)],'payout':_0x38a9ef[_0x62a7dd(0x86)],'login':_0x38a9ef[_0x62a7dd(0xb0)],'api_error':_0x38a9ef['notificationApiError']}};}async[a76_0x24ceac(0x95)](_0x19c02e,_0x31ac72){const _0x3c590c=a76_0x24ceac,{currentPassword:_0x364f45,newPassword:_0x31b398,confirmNewPassword:_0x3c977f}=_0x31ac72;if(_0x31b398!==_0x3c977f)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x31b398[_0x3c590c(0xab)]<0x6)throw new Error(_0x3c590c(0x89));const _0xf81ad7=await database_1[_0x3c590c(0x79)][_0x3c590c(0x88)][_0x3c590c(0xa4)]({'where':{'id':_0x19c02e},'select':{'password':!![]}});if(!_0xf81ad7)throw new Error('Shop\x20not\x20found');const _0x199f96=await bcryptjs_1[_0x3c590c(0x79)][_0x3c590c(0x8e)](_0x364f45,_0xf81ad7[_0x3c590c(0x93)]);if(!_0x199f96)throw new Error(_0x3c590c(0x83));const _0x3dfdab=await bcryptjs_1[_0x3c590c(0x79)][_0x3c590c(0x92)](_0x31b398,0xc);await database_1[_0x3c590c(0x79)][_0x3c590c(0x88)][_0x3c590c(0x8d)]({'where':{'id':_0x19c02e},'data':{'password':_0x3dfdab}});}async['updateNotifications'](_0x181019,_0x3edf2d){const _0xa8c138=a76_0x24ceac;await this[_0xa8c138(0xb6)](_0x181019);const _0x245d67={};_0x3edf2d[_0xa8c138(0x9e)]!==undefined&&(_0x245d67['notificationPaymentSuccess']=_0x3edf2d[_0xa8c138(0x9e)]),_0x3edf2d[_0xa8c138(0x77)]!==undefined&&(_0x245d67[_0xa8c138(0x84)]=_0x3edf2d['payment_failed']),_0x3edf2d[_0xa8c138(0x78)]!==undefined&&(_0x245d67[_0xa8c138(0xa1)]=_0x3edf2d['refund']),_0x3edf2d['payout']!==undefined&&(_0x245d67[_0xa8c138(0x86)]=_0x3edf2d['payout']),_0x3edf2d[_0xa8c138(0x9a)]!==undefined&&(_0x245d67[_0xa8c138(0xb0)]=_0x3edf2d['login']),_0x3edf2d['api_error']!==undefined&&(_0x245d67[_0xa8c138(0xaa)]=_0x3edf2d[_0xa8c138(0x9c)]),await database_1[_0xa8c138(0x79)][_0xa8c138(0x7d)]['update']({'where':{'shopId':_0x181019},'data':_0x245d67});}async[a76_0x24ceac(0x91)](_0x5884ab,_0x3d087e){const _0x33360f=a76_0x24ceac;await this[_0x33360f(0xb6)](_0x5884ab);const _0x5266a3={};_0x3d087e[_0x33360f(0x97)]!==undefined&&(_0x5266a3[_0x33360f(0x96)]=_0x3d087e[_0x33360f(0x97)]||null),_0x3d087e['chatId']!==undefined&&(_0x5266a3[_0x33360f(0x9b)]=_0x3d087e[_0x33360f(0x7f)]||null),await database_1['default'][_0x33360f(0x7d)][_0x33360f(0x8d)]({'where':{'shopId':_0x5884ab},'data':_0x5266a3});}async['updateWebhookSettings'](_0x321698,_0x1d9327){const _0x2ee49d=a76_0x24ceac;await this['ensureSettingsExist'](_0x321698);const _0x2f8cab={};_0x1d9327[_0x2ee49d(0x8b)]!==undefined&&(_0x2f8cab[_0x2ee49d(0x8b)]=_0x1d9327[_0x2ee49d(0x8b)]||null),_0x1d9327[_0x2ee49d(0xa7)]!==undefined&&(_0x2f8cab['webhookEvents']=_0x1d9327[_0x2ee49d(0xa7)]||[]),await database_1[_0x2ee49d(0x79)][_0x2ee49d(0x7d)][_0x2ee49d(0x8d)]({'where':{'shopId':_0x321698},'data':_0x2f8cab});}async[a76_0x24ceac(0xae)](_0x49d49b){const _0x22cc25=a76_0x24ceac,_0x470fb2=_0x22cc25(0xb1)+crypto_1[_0x22cc25(0x79)][_0x22cc25(0x76)](0x20)[_0x22cc25(0x7a)](_0x22cc25(0x8f)),_0x22e8df='sk_'+crypto_1['default'][_0x22cc25(0x76)](0x20)[_0x22cc25(0x7a)](_0x22cc25(0x8f));await database_1[_0x22cc25(0x79)]['shop'][_0x22cc25(0x8d)]({'where':{'id':_0x49d49b},'data':{'publicKey':_0x470fb2,'secretKey':_0x22e8df}});}async[a76_0x24ceac(0x81)](_0x16c55f,_0x2b3a1e){const _0xff9a7=a76_0x24ceac,{passwordConfirmation:_0x3c6ff9}=_0x2b3a1e,_0x19de26=await database_1[_0xff9a7(0x79)][_0xff9a7(0x88)][_0xff9a7(0xa4)]({'where':{'id':_0x16c55f},'select':{'password':!![]}});if(!_0x19de26)throw new Error(_0xff9a7(0x98));const _0xf23455=await bcryptjs_1[_0xff9a7(0x79)][_0xff9a7(0x8e)](_0x3c6ff9,_0x19de26[_0xff9a7(0x93)]);if(!_0xf23455)throw new Error(_0xff9a7(0xb4));await database_1[_0xff9a7(0x79)]['shop'][_0xff9a7(0xad)]({'where':{'id':_0x16c55f}});}async[a76_0x24ceac(0xb6)](_0x13b4f1){const _0x5e4848=a76_0x24ceac,_0x256254=await database_1['default'][_0x5e4848(0x7d)][_0x5e4848(0xa4)]({'where':{'shopId':_0x13b4f1}});!_0x256254&&await database_1[_0x5e4848(0x79)][_0x5e4848(0x7d)]['create']({'data':{'shopId':_0x13b4f1}});}}exports[a76_0x24ceac(0xa3)]=SettingsService;