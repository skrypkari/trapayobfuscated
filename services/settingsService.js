'use strict';const a56_0x18d4e1=a56_0xa990;(function(_0x591982,_0x796f63){const _0x5d43e9=a56_0xa990,_0x3853c6=_0x591982();while(!![]){try{const _0x8988e0=parseInt(_0x5d43e9(0x1a3))/0x1*(parseInt(_0x5d43e9(0x168))/0x2)+parseInt(_0x5d43e9(0x180))/0x3+-parseInt(_0x5d43e9(0x170))/0x4+-parseInt(_0x5d43e9(0x197))/0x5+-parseInt(_0x5d43e9(0x17e))/0x6+parseInt(_0x5d43e9(0x19f))/0x7*(parseInt(_0x5d43e9(0x165))/0x8)+-parseInt(_0x5d43e9(0x183))/0x9*(-parseInt(_0x5d43e9(0x18a))/0xa);if(_0x8988e0===_0x796f63)break;else _0x3853c6['push'](_0x3853c6['shift']());}catch(_0x59f28b){_0x3853c6['push'](_0x3853c6['shift']());}}}(a56_0x484d,0x4ee57));function a56_0x484d(){const _0x5a8f27=['settings','telegramChatId','updateNotifications','notificationLogin','update','parseWebhookEvents','login','ensureSettingsExist','shopSettings','2109876OzFHac','name','12339wUuzDs','pk_','Shop\x20not\x20found','34182whRpMK','updateWebhookSettings','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','../config/database','payment_success','botApiKey','webhookUrl','1490ccHUsj','webhookEvents','defineProperty','shop','toString','notificationApiError','notificationRefund','string','payout','create','parse','bcryptjs','notificationPayout','2625550ZEGNHk','findUnique','password','api_error','Password\x20confirmation\x20is\x20incorrect','changePassword','SettingsService','refund','259651YLCibf','getShopSettings','hash','payment_failed','7402WJMoYe','repeat','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','notificationPaymentSuccess','shopUrl','chatId','sk_','80zytSGN','hex','__importDefault','92mVaTgp','crypto','length','default','isArray','max','telegramBotApiKey','notificationPaymentFailed','326088uIvwfh','randomBytes','delete','telegram','compare'];a56_0x484d=function(){return _0x5a8f27;};return a56_0x484d();}function a56_0xa990(_0x29447b,_0x11316a){const _0x484d84=a56_0x484d();return a56_0xa990=function(_0xa990ba,_0x36bf3a){_0xa990ba=_0xa990ba-0x161;let _0x2fef0c=_0x484d84[_0xa990ba];return _0x2fef0c;},a56_0xa990(_0x29447b,_0x11316a);}var __importDefault=this&&this[a56_0x18d4e1(0x167)]||function(_0x4f0cab){return _0x4f0cab&&_0x4f0cab['__esModule']?_0x4f0cab:{'default':_0x4f0cab};};Object[a56_0x18d4e1(0x18c)](exports,'__esModule',{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a56_0x18d4e1(0x195))),crypto_1=__importDefault(require(a56_0x18d4e1(0x169))),database_1=__importDefault(require(a56_0x18d4e1(0x186)));class SettingsService{['maskApiKey'](_0x53970e){const _0x87e909=a56_0x18d4e1;if(!_0x53970e)return'';if(_0x53970e[_0x87e909(0x16a)]<=0x8)return _0x53970e;const _0x2ef5ce=_0x53970e['substring'](0x0,0x8),_0x189bbf='*'[_0x87e909(0x1a4)](Math[_0x87e909(0x16d)](0x0,_0x53970e[_0x87e909(0x16a)]-0x8));return _0x2ef5ce+_0x189bbf;}[a56_0x18d4e1(0x17a)](_0x4126fa){const _0xe06121=a56_0x18d4e1;if(!_0x4126fa)return[];if(Array['isArray'](_0x4126fa))return _0x4126fa;if(typeof _0x4126fa===_0xe06121(0x191))try{const _0x1a55a5=JSON[_0xe06121(0x194)](_0x4126fa);return Array[_0xe06121(0x16c)](_0x1a55a5)?_0x1a55a5:[];}catch{return[];}return[];}async[a56_0x18d4e1(0x1a0)](_0x2191f3){const _0x23c658=a56_0x18d4e1,_0xba36e0=await database_1[_0x23c658(0x16b)][_0x23c658(0x18d)][_0x23c658(0x198)]({'where':{'id':_0x2191f3},'include':{'settings':!![]}});if(!_0xba36e0)throw new Error(_0x23c658(0x182));let _0x188da3=_0xba36e0[_0x23c658(0x175)];return!_0x188da3&&(_0x188da3=await database_1['default'][_0x23c658(0x17d)][_0x23c658(0x193)]({'data':{'shopId':_0xba36e0['id']}})),{'fullName':_0xba36e0[_0x23c658(0x17f)],'brand':_0xba36e0[_0x23c658(0x17f)],'merchantUrl':_0xba36e0[_0x23c658(0x162)],'telegramUsername':_0xba36e0[_0x23c658(0x173)],'telegramBotApiKey':_0x188da3[_0x23c658(0x16e)]?this['maskApiKey'](_0x188da3[_0x23c658(0x16e)]):null,'telegramChatId':_0x188da3[_0x23c658(0x176)],'webhookUrl':_0x188da3[_0x23c658(0x189)],'webhookEvents':this[_0x23c658(0x17a)](_0x188da3[_0x23c658(0x18b)]),'notifications':{'payment_success':_0x188da3[_0x23c658(0x161)],'payment_failed':_0x188da3[_0x23c658(0x16f)],'refund':_0x188da3['notificationRefund'],'payout':_0x188da3[_0x23c658(0x196)],'login':_0x188da3[_0x23c658(0x178)],'api_error':_0x188da3[_0x23c658(0x18f)]}};}async[a56_0x18d4e1(0x19c)](_0x12dd2f,_0x49f3d5){const _0x82dd5c=a56_0x18d4e1,{currentPassword:_0x2b291d,newPassword:_0xb24370,confirmNewPassword:_0x26ee2e}=_0x49f3d5;if(_0xb24370!==_0x26ee2e)throw new Error(_0x82dd5c(0x1a5));if(_0xb24370['length']<0x6)throw new Error(_0x82dd5c(0x185));const _0x10e14b=await database_1[_0x82dd5c(0x16b)][_0x82dd5c(0x18d)][_0x82dd5c(0x198)]({'where':{'id':_0x12dd2f},'select':{'password':!![]}});if(!_0x10e14b)throw new Error(_0x82dd5c(0x182));const _0x56fff1=await bcryptjs_1[_0x82dd5c(0x16b)][_0x82dd5c(0x174)](_0x2b291d,_0x10e14b[_0x82dd5c(0x199)]);if(!_0x56fff1)throw new Error('Current\x20password\x20is\x20incorrect');const _0x4ac92b=await bcryptjs_1[_0x82dd5c(0x16b)][_0x82dd5c(0x1a1)](_0xb24370,0xc);await database_1[_0x82dd5c(0x16b)][_0x82dd5c(0x18d)][_0x82dd5c(0x179)]({'where':{'id':_0x12dd2f},'data':{'password':_0x4ac92b}});}async[a56_0x18d4e1(0x177)](_0x3ef0d4,_0x109ca5){const _0x2869fe=a56_0x18d4e1;await this[_0x2869fe(0x17c)](_0x3ef0d4);const _0x13d096={};_0x109ca5[_0x2869fe(0x187)]!==undefined&&(_0x13d096[_0x2869fe(0x161)]=_0x109ca5[_0x2869fe(0x187)]),_0x109ca5[_0x2869fe(0x1a2)]!==undefined&&(_0x13d096[_0x2869fe(0x16f)]=_0x109ca5[_0x2869fe(0x1a2)]),_0x109ca5[_0x2869fe(0x19e)]!==undefined&&(_0x13d096[_0x2869fe(0x190)]=_0x109ca5['refund']),_0x109ca5[_0x2869fe(0x192)]!==undefined&&(_0x13d096[_0x2869fe(0x196)]=_0x109ca5[_0x2869fe(0x192)]),_0x109ca5[_0x2869fe(0x17b)]!==undefined&&(_0x13d096[_0x2869fe(0x178)]=_0x109ca5[_0x2869fe(0x17b)]),_0x109ca5[_0x2869fe(0x19a)]!==undefined&&(_0x13d096['notificationApiError']=_0x109ca5[_0x2869fe(0x19a)]),await database_1[_0x2869fe(0x16b)][_0x2869fe(0x17d)]['update']({'where':{'shopId':_0x3ef0d4},'data':_0x13d096});}async['updateTelegramSettings'](_0x1a0ce0,_0x28da7f){const _0x2de029=a56_0x18d4e1;await this[_0x2de029(0x17c)](_0x1a0ce0);const _0x47e718={};_0x28da7f[_0x2de029(0x188)]!==undefined&&(_0x47e718[_0x2de029(0x16e)]=_0x28da7f['botApiKey']||null),_0x28da7f[_0x2de029(0x163)]!==undefined&&(_0x47e718['telegramChatId']=_0x28da7f['chatId']||null),await database_1[_0x2de029(0x16b)]['shopSettings'][_0x2de029(0x179)]({'where':{'shopId':_0x1a0ce0},'data':_0x47e718});}async[a56_0x18d4e1(0x184)](_0x260f37,_0x5dab94){const _0x432ab4=a56_0x18d4e1;await this[_0x432ab4(0x17c)](_0x260f37);const _0x2335f6={};_0x5dab94[_0x432ab4(0x189)]!==undefined&&(_0x2335f6[_0x432ab4(0x189)]=_0x5dab94[_0x432ab4(0x189)]||null),_0x5dab94[_0x432ab4(0x18b)]!==undefined&&(_0x2335f6[_0x432ab4(0x18b)]=_0x5dab94['webhookEvents']||[]),await database_1[_0x432ab4(0x16b)]['shopSettings']['update']({'where':{'shopId':_0x260f37},'data':_0x2335f6});}async['revokeAllApiKeys'](_0x3943f3){const _0x3d141f=a56_0x18d4e1,_0x12bad6=_0x3d141f(0x181)+crypto_1[_0x3d141f(0x16b)][_0x3d141f(0x171)](0x20)[_0x3d141f(0x18e)](_0x3d141f(0x166)),_0x1cab9a=_0x3d141f(0x164)+crypto_1[_0x3d141f(0x16b)][_0x3d141f(0x171)](0x20)[_0x3d141f(0x18e)](_0x3d141f(0x166));await database_1[_0x3d141f(0x16b)][_0x3d141f(0x18d)][_0x3d141f(0x179)]({'where':{'id':_0x3943f3},'data':{'publicKey':_0x12bad6,'secretKey':_0x1cab9a}});}async['deleteAccount'](_0x4df130,_0x26a9e8){const _0x502c5f=a56_0x18d4e1,{passwordConfirmation:_0x4a1697}=_0x26a9e8,_0x4587b4=await database_1[_0x502c5f(0x16b)][_0x502c5f(0x18d)]['findUnique']({'where':{'id':_0x4df130},'select':{'password':!![]}});if(!_0x4587b4)throw new Error(_0x502c5f(0x182));const _0x59c88e=await bcryptjs_1[_0x502c5f(0x16b)][_0x502c5f(0x174)](_0x4a1697,_0x4587b4['password']);if(!_0x59c88e)throw new Error(_0x502c5f(0x19b));await database_1[_0x502c5f(0x16b)][_0x502c5f(0x18d)][_0x502c5f(0x172)]({'where':{'id':_0x4df130}});}async[a56_0x18d4e1(0x17c)](_0x573438){const _0x359ca9=a56_0x18d4e1,_0x185669=await database_1[_0x359ca9(0x16b)][_0x359ca9(0x17d)][_0x359ca9(0x198)]({'where':{'shopId':_0x573438}});!_0x185669&&await database_1['default'][_0x359ca9(0x17d)]['create']({'data':{'shopId':_0x573438}});}}exports[a56_0x18d4e1(0x19d)]=SettingsService;