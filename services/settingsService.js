'use strict';const a52_0x49e85a=a52_0x3bdf;function a52_0x3bdf(_0x35fe32,_0x7d05df){const _0x7e7799=a52_0x7e77();return a52_0x3bdf=function(_0x3bdfb4,_0x5e6fa7){_0x3bdfb4=_0x3bdfb4-0x86;let _0x4f080f=_0x7e7799[_0x3bdfb4];return _0x4f080f;},a52_0x3bdf(_0x35fe32,_0x7d05df);}(function(_0x412b20,_0x5baf52){const _0x2bc112=a52_0x3bdf,_0x248d7b=_0x412b20();while(!![]){try{const _0x122bbe=-parseInt(_0x2bc112(0xbc))/0x1+parseInt(_0x2bc112(0xc5))/0x2+-parseInt(_0x2bc112(0xa2))/0x3+-parseInt(_0x2bc112(0xb8))/0x4*(parseInt(_0x2bc112(0x91))/0x5)+-parseInt(_0x2bc112(0xaa))/0x6+parseInt(_0x2bc112(0xb1))/0x7*(-parseInt(_0x2bc112(0xaf))/0x8)+parseInt(_0x2bc112(0x90))/0x9;if(_0x122bbe===_0x5baf52)break;else _0x248d7b['push'](_0x248d7b['shift']());}catch(_0x157544){_0x248d7b['push'](_0x248d7b['shift']());}}}(a52_0x7e77,0x237ce));function a52_0x7e77(){const _0x46c00f=['isArray','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','settings','1018592erYgAY','substring','7oIvSZr','updateTelegramSettings','notificationApiError','getShopSettings','pk_','notificationLogin','telegramChatId','4GdlaZO','default','hex','Current\x20password\x20is\x20incorrect','118254qoXMDo','create','api_error','shopSettings','chatId','telegramBotApiKey','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','botApiKey','length','89238EhgzRX','string','notificationPayout','revokeAllApiKeys','../config/database','payment_failed','updateWebhookSettings','shop','hash','findUnique','notificationPaymentFailed','webhookEvents','deleteAccount','notificationPaymentSuccess','6844203fmJNXs','507895XmIaSB','Shop\x20not\x20found','ensureSettingsExist','compare','changePassword','defineProperty','parse','payment_success','name','update','randomBytes','notificationRefund','delete','payout','login','webhookUrl','__esModule','145386XNlxst','refund','toString','maskApiKey','max','SettingsService','updateNotifications','crypto','1584654nTIWyg','bcryptjs'];a52_0x7e77=function(){return _0x46c00f;};return a52_0x7e77();}var __importDefault=this&&this['__importDefault']||function(_0x1c8398){const _0x2ffe1e=a52_0x3bdf;return _0x1c8398&&_0x1c8398[_0x2ffe1e(0xa1)]?_0x1c8398:{'default':_0x1c8398};};Object[a52_0x49e85a(0x96)](exports,a52_0x49e85a(0xa1),{'value':!![]}),exports[a52_0x49e85a(0xa7)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x49e85a(0xab))),crypto_1=__importDefault(require(a52_0x49e85a(0xa9))),database_1=__importDefault(require(a52_0x49e85a(0x86)));class SettingsService{['maskApiKey'](_0x5be018){const _0x22b08a=a52_0x49e85a;if(!_0x5be018)return'';if(_0x5be018[_0x22b08a(0xc4)]<=0x8)return _0x5be018;const _0xa76b54=_0x5be018[_0x22b08a(0xb0)](0x0,0x8),_0x2514fb='*'['repeat'](Math[_0x22b08a(0xa6)](0x0,_0x5be018['length']-0x8));return _0xa76b54+_0x2514fb;}['parseWebhookEvents'](_0x18face){const _0x53d9e9=a52_0x49e85a;if(!_0x18face)return[];if(Array[_0x53d9e9(0xac)](_0x18face))return _0x18face;if(typeof _0x18face===_0x53d9e9(0xc6))try{const _0x4c8ce9=JSON[_0x53d9e9(0x97)](_0x18face);return Array[_0x53d9e9(0xac)](_0x4c8ce9)?_0x4c8ce9:[];}catch{return[];}return[];}async[a52_0x49e85a(0xb4)](_0x57998b){const _0x14b6cb=a52_0x49e85a,_0x473fd4=await database_1[_0x14b6cb(0xb9)][_0x14b6cb(0x89)][_0x14b6cb(0x8b)]({'where':{'id':_0x57998b},'include':{'settings':!![]}});if(!_0x473fd4)throw new Error(_0x14b6cb(0x92));let _0x5c321b=_0x473fd4[_0x14b6cb(0xae)];return!_0x5c321b&&(_0x5c321b=await database_1[_0x14b6cb(0xb9)][_0x14b6cb(0xbf)][_0x14b6cb(0xbd)]({'data':{'shopId':_0x473fd4['id']}})),{'fullName':_0x473fd4[_0x14b6cb(0x99)],'brand':_0x473fd4[_0x14b6cb(0x99)],'merchantUrl':_0x473fd4['shopUrl'],'telegramUsername':_0x473fd4['telegram'],'telegramBotApiKey':_0x5c321b['telegramBotApiKey']?this[_0x14b6cb(0xa5)](_0x5c321b['telegramBotApiKey']):null,'telegramChatId':_0x5c321b[_0x14b6cb(0xb7)],'webhookUrl':_0x5c321b['webhookUrl'],'webhookEvents':this['parseWebhookEvents'](_0x5c321b['webhookEvents']),'notifications':{'payment_success':_0x5c321b[_0x14b6cb(0x8f)],'payment_failed':_0x5c321b[_0x14b6cb(0x8c)],'refund':_0x5c321b[_0x14b6cb(0x9c)],'payout':_0x5c321b[_0x14b6cb(0xc7)],'login':_0x5c321b[_0x14b6cb(0xb6)],'api_error':_0x5c321b[_0x14b6cb(0xb3)]}};}async[a52_0x49e85a(0x95)](_0x28f9df,_0x2d2154){const _0x27058e=a52_0x49e85a,{currentPassword:_0x2b2e19,newPassword:_0x37c935,confirmNewPassword:_0x13a2f7}=_0x2d2154;if(_0x37c935!==_0x13a2f7)throw new Error(_0x27058e(0xc2));if(_0x37c935[_0x27058e(0xc4)]<0x6)throw new Error(_0x27058e(0xad));const _0x550b39=await database_1[_0x27058e(0xb9)][_0x27058e(0x89)][_0x27058e(0x8b)]({'where':{'id':_0x28f9df},'select':{'password':!![]}});if(!_0x550b39)throw new Error(_0x27058e(0x92));const _0x35c4cc=await bcryptjs_1[_0x27058e(0xb9)][_0x27058e(0x94)](_0x2b2e19,_0x550b39['password']);if(!_0x35c4cc)throw new Error(_0x27058e(0xbb));const _0x13a948=await bcryptjs_1['default'][_0x27058e(0x8a)](_0x37c935,0xc);await database_1['default'][_0x27058e(0x89)]['update']({'where':{'id':_0x28f9df},'data':{'password':_0x13a948}});}async[a52_0x49e85a(0xa8)](_0xb31c19,_0x46eb43){const _0xb6cc9d=a52_0x49e85a;await this[_0xb6cc9d(0x93)](_0xb31c19);const _0x1bc18d={};_0x46eb43[_0xb6cc9d(0x98)]!==undefined&&(_0x1bc18d[_0xb6cc9d(0x8f)]=_0x46eb43['payment_success']),_0x46eb43[_0xb6cc9d(0x87)]!==undefined&&(_0x1bc18d[_0xb6cc9d(0x8c)]=_0x46eb43['payment_failed']),_0x46eb43[_0xb6cc9d(0xa3)]!==undefined&&(_0x1bc18d[_0xb6cc9d(0x9c)]=_0x46eb43[_0xb6cc9d(0xa3)]),_0x46eb43[_0xb6cc9d(0x9e)]!==undefined&&(_0x1bc18d[_0xb6cc9d(0xc7)]=_0x46eb43['payout']),_0x46eb43[_0xb6cc9d(0x9f)]!==undefined&&(_0x1bc18d['notificationLogin']=_0x46eb43['login']),_0x46eb43[_0xb6cc9d(0xbe)]!==undefined&&(_0x1bc18d[_0xb6cc9d(0xb3)]=_0x46eb43[_0xb6cc9d(0xbe)]),await database_1[_0xb6cc9d(0xb9)][_0xb6cc9d(0xbf)][_0xb6cc9d(0x9a)]({'where':{'shopId':_0xb31c19},'data':_0x1bc18d});}async[a52_0x49e85a(0xb2)](_0x50555a,_0x1089a1){const _0xee6f68=a52_0x49e85a;await this[_0xee6f68(0x93)](_0x50555a);const _0x2695ae={};_0x1089a1[_0xee6f68(0xc3)]!==undefined&&(_0x2695ae[_0xee6f68(0xc1)]=_0x1089a1[_0xee6f68(0xc3)]||null),_0x1089a1[_0xee6f68(0xc0)]!==undefined&&(_0x2695ae[_0xee6f68(0xb7)]=_0x1089a1[_0xee6f68(0xc0)]||null),await database_1['default'][_0xee6f68(0xbf)][_0xee6f68(0x9a)]({'where':{'shopId':_0x50555a},'data':_0x2695ae});}async[a52_0x49e85a(0x88)](_0x48ca95,_0xae8cdb){const _0x227540=a52_0x49e85a;await this[_0x227540(0x93)](_0x48ca95);const _0x591a92={};_0xae8cdb['webhookUrl']!==undefined&&(_0x591a92[_0x227540(0xa0)]=_0xae8cdb[_0x227540(0xa0)]||null),_0xae8cdb[_0x227540(0x8d)]!==undefined&&(_0x591a92['webhookEvents']=_0xae8cdb[_0x227540(0x8d)]||[]),await database_1[_0x227540(0xb9)][_0x227540(0xbf)][_0x227540(0x9a)]({'where':{'shopId':_0x48ca95},'data':_0x591a92});}async[a52_0x49e85a(0xc8)](_0xdeb55a){const _0x389a9e=a52_0x49e85a,_0x2b2159=_0x389a9e(0xb5)+crypto_1[_0x389a9e(0xb9)][_0x389a9e(0x9b)](0x20)[_0x389a9e(0xa4)](_0x389a9e(0xba)),_0x24d39b='sk_'+crypto_1[_0x389a9e(0xb9)]['randomBytes'](0x20)[_0x389a9e(0xa4)](_0x389a9e(0xba));await database_1[_0x389a9e(0xb9)]['shop'][_0x389a9e(0x9a)]({'where':{'id':_0xdeb55a},'data':{'publicKey':_0x2b2159,'secretKey':_0x24d39b}});}async[a52_0x49e85a(0x8e)](_0x41dc34,_0x296590){const _0xa894de=a52_0x49e85a,{passwordConfirmation:_0x52b5b3}=_0x296590,_0x394cb4=await database_1[_0xa894de(0xb9)]['shop'][_0xa894de(0x8b)]({'where':{'id':_0x41dc34},'select':{'password':!![]}});if(!_0x394cb4)throw new Error(_0xa894de(0x92));const _0x373f7a=await bcryptjs_1[_0xa894de(0xb9)][_0xa894de(0x94)](_0x52b5b3,_0x394cb4['password']);if(!_0x373f7a)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0xa894de(0xb9)][_0xa894de(0x89)][_0xa894de(0x9d)]({'where':{'id':_0x41dc34}});}async['ensureSettingsExist'](_0xac8112){const _0x2c5e7a=a52_0x49e85a,_0x56ede4=await database_1[_0x2c5e7a(0xb9)][_0x2c5e7a(0xbf)][_0x2c5e7a(0x8b)]({'where':{'shopId':_0xac8112}});!_0x56ede4&&await database_1['default'][_0x2c5e7a(0xbf)]['create']({'data':{'shopId':_0xac8112}});}}exports['SettingsService']=SettingsService;