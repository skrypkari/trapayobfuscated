'use strict';const a53_0x193c70=a53_0x5431;function a53_0x5431(_0x36d267,_0x4f94c2){const _0x4bd1f5=a53_0x4bd1();return a53_0x5431=function(_0x5431fd,_0x29fff4){_0x5431fd=_0x5431fd-0x69;let _0x6858f6=_0x4bd1f5[_0x5431fd];return _0x6858f6;},a53_0x5431(_0x36d267,_0x4f94c2);}(function(_0x394ce6,_0x509690){const _0x223c3d=a53_0x5431,_0x3ceb7e=_0x394ce6();while(!![]){try{const _0x497037=parseInt(_0x223c3d(0xa4))/0x1+parseInt(_0x223c3d(0x88))/0x2*(-parseInt(_0x223c3d(0xa5))/0x3)+-parseInt(_0x223c3d(0x79))/0x4+-parseInt(_0x223c3d(0xa6))/0x5+parseInt(_0x223c3d(0x8b))/0x6+parseInt(_0x223c3d(0x8e))/0x7*(parseInt(_0x223c3d(0x77))/0x8)+-parseInt(_0x223c3d(0x7e))/0x9*(-parseInt(_0x223c3d(0x7a))/0xa);if(_0x497037===_0x509690)break;else _0x3ceb7e['push'](_0x3ceb7e['shift']());}catch(_0x11dce3){_0x3ceb7e['push'](_0x3ceb7e['shift']());}}}(a53_0x4bd1,0xcf4bd));var __importDefault=this&&this[a53_0x193c70(0x93)]||function(_0xbfcf47){return _0xbfcf47&&_0xbfcf47['__esModule']?_0xbfcf47:{'default':_0xbfcf47};};Object[a53_0x193c70(0xa1)](exports,a53_0x193c70(0x90),{'value':!![]}),exports[a53_0x193c70(0x84)]=void 0x0;function a53_0x4bd1(){const _0x405a1c=['randomBytes','refund','substring','password','defineProperty','findUnique','isArray','528911gREjFJ','58983FKPuIg','7842225yEnXAB','Current\x20password\x20is\x20incorrect','repeat','ensureSettingsExist','sk_','hash','notificationPaymentFailed','updateWebhookSettings','string','payment_failed','changePassword','updateTelegramSettings','webhookEvents','api_error','../config/database','Shop\x20not\x20found','parseWebhookEvents','shopSettings','hex','5762312TLMAuj','login','2117420DTFkCL','90apcvPC','payment_success','parse','pk_','1500255ADSmcM','crypto','max','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','payout','notificationRefund','SettingsService','deleteAccount','webhookUrl','create','106sLAQwu','notificationApiError','delete','7436778luvWbd','update','toString','7BByLnh','notificationPayout','__esModule','length','botApiKey','__importDefault','Password\x20confirmation\x20is\x20incorrect','maskApiKey','shop','telegramBotApiKey','compare','default','notificationPaymentSuccess','telegramChatId','bcryptjs'];a53_0x4bd1=function(){return _0x405a1c;};return a53_0x4bd1();}const bcryptjs_1=__importDefault(require(a53_0x193c70(0x9c))),crypto_1=__importDefault(require(a53_0x193c70(0x7f))),database_1=__importDefault(require(a53_0x193c70(0x72)));class SettingsService{['maskApiKey'](_0x5cea0c){const _0x422242=a53_0x193c70;if(!_0x5cea0c)return'';if(_0x5cea0c[_0x422242(0x91)]<=0x8)return _0x5cea0c;const _0x237901=_0x5cea0c[_0x422242(0x9f)](0x0,0x8),_0x5a0959='*'[_0x422242(0xa8)](Math[_0x422242(0x80)](0x0,_0x5cea0c['length']-0x8));return _0x237901+_0x5a0959;}[a53_0x193c70(0x74)](_0x36f574){const _0x9caec7=a53_0x193c70;if(!_0x36f574)return[];if(Array['isArray'](_0x36f574))return _0x36f574;if(typeof _0x36f574===_0x9caec7(0x6c))try{const _0x11c62e=JSON[_0x9caec7(0x7c)](_0x36f574);return Array[_0x9caec7(0xa3)](_0x11c62e)?_0x11c62e:[];}catch{return[];}return[];}async['getShopSettings'](_0x155a64){const _0x2a907b=a53_0x193c70,_0x1aed04=await database_1[_0x2a907b(0x99)]['shop'][_0x2a907b(0xa2)]({'where':{'id':_0x155a64},'include':{'settings':!![]}});if(!_0x1aed04)throw new Error(_0x2a907b(0x73));let _0x43da9f=_0x1aed04['settings'];return!_0x43da9f&&(_0x43da9f=await database_1['default'][_0x2a907b(0x75)][_0x2a907b(0x87)]({'data':{'shopId':_0x1aed04['id']}})),{'fullName':_0x1aed04['name'],'brand':_0x1aed04['name'],'merchantUrl':_0x1aed04['shopUrl'],'telegramUsername':_0x1aed04['telegram'],'telegramBotApiKey':_0x43da9f[_0x2a907b(0x97)]?this[_0x2a907b(0x95)](_0x43da9f[_0x2a907b(0x97)]):null,'telegramChatId':_0x43da9f[_0x2a907b(0x9b)],'webhookUrl':_0x43da9f[_0x2a907b(0x86)],'webhookEvents':this[_0x2a907b(0x74)](_0x43da9f['webhookEvents']),'notifications':{'payment_success':_0x43da9f[_0x2a907b(0x9a)],'payment_failed':_0x43da9f['notificationPaymentFailed'],'refund':_0x43da9f[_0x2a907b(0x83)],'payout':_0x43da9f[_0x2a907b(0x8f)],'login':_0x43da9f['notificationLogin'],'api_error':_0x43da9f[_0x2a907b(0x89)]}};}async[a53_0x193c70(0x6e)](_0x35da7b,_0x5b4a07){const _0xc369da=a53_0x193c70,{currentPassword:_0x46d5f1,newPassword:_0x117791,confirmNewPassword:_0x4ed9dc}=_0x5b4a07;if(_0x117791!==_0x4ed9dc)throw new Error(_0xc369da(0x81));if(_0x117791[_0xc369da(0x91)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0xd82df0=await database_1['default'][_0xc369da(0x96)][_0xc369da(0xa2)]({'where':{'id':_0x35da7b},'select':{'password':!![]}});if(!_0xd82df0)throw new Error(_0xc369da(0x73));const _0x5a03d1=await bcryptjs_1[_0xc369da(0x99)]['compare'](_0x46d5f1,_0xd82df0['password']);if(!_0x5a03d1)throw new Error(_0xc369da(0xa7));const _0x1e0e7e=await bcryptjs_1['default'][_0xc369da(0x69)](_0x117791,0xc);await database_1['default']['shop'][_0xc369da(0x8c)]({'where':{'id':_0x35da7b},'data':{'password':_0x1e0e7e}});}async['updateNotifications'](_0x4ed3f8,_0x3f85f8){const _0x20ab4a=a53_0x193c70;await this[_0x20ab4a(0xa9)](_0x4ed3f8);const _0x1e1fc0={};_0x3f85f8[_0x20ab4a(0x7b)]!==undefined&&(_0x1e1fc0[_0x20ab4a(0x9a)]=_0x3f85f8[_0x20ab4a(0x7b)]),_0x3f85f8['payment_failed']!==undefined&&(_0x1e1fc0[_0x20ab4a(0x6a)]=_0x3f85f8[_0x20ab4a(0x6d)]),_0x3f85f8[_0x20ab4a(0x9e)]!==undefined&&(_0x1e1fc0[_0x20ab4a(0x83)]=_0x3f85f8[_0x20ab4a(0x9e)]),_0x3f85f8['payout']!==undefined&&(_0x1e1fc0[_0x20ab4a(0x8f)]=_0x3f85f8[_0x20ab4a(0x82)]),_0x3f85f8[_0x20ab4a(0x78)]!==undefined&&(_0x1e1fc0['notificationLogin']=_0x3f85f8['login']),_0x3f85f8[_0x20ab4a(0x71)]!==undefined&&(_0x1e1fc0[_0x20ab4a(0x89)]=_0x3f85f8[_0x20ab4a(0x71)]),await database_1[_0x20ab4a(0x99)][_0x20ab4a(0x75)][_0x20ab4a(0x8c)]({'where':{'shopId':_0x4ed3f8},'data':_0x1e1fc0});}async[a53_0x193c70(0x6f)](_0x19c8d1,_0x11f46d){const _0x31462c=a53_0x193c70;await this['ensureSettingsExist'](_0x19c8d1);const _0x5a638e={};_0x11f46d[_0x31462c(0x92)]!==undefined&&(_0x5a638e['telegramBotApiKey']=_0x11f46d[_0x31462c(0x92)]||null),_0x11f46d['chatId']!==undefined&&(_0x5a638e[_0x31462c(0x9b)]=_0x11f46d['chatId']||null),await database_1[_0x31462c(0x99)][_0x31462c(0x75)][_0x31462c(0x8c)]({'where':{'shopId':_0x19c8d1},'data':_0x5a638e});}async[a53_0x193c70(0x6b)](_0x36a3f2,_0x22e1e6){const _0x279550=a53_0x193c70;await this['ensureSettingsExist'](_0x36a3f2);const _0x8c5800={};_0x22e1e6[_0x279550(0x86)]!==undefined&&(_0x8c5800[_0x279550(0x86)]=_0x22e1e6[_0x279550(0x86)]||null),_0x22e1e6[_0x279550(0x70)]!==undefined&&(_0x8c5800['webhookEvents']=_0x22e1e6[_0x279550(0x70)]||[]),await database_1['default']['shopSettings'][_0x279550(0x8c)]({'where':{'shopId':_0x36a3f2},'data':_0x8c5800});}async['revokeAllApiKeys'](_0x8996e2){const _0x481f7c=a53_0x193c70,_0x228591=_0x481f7c(0x7d)+crypto_1['default'][_0x481f7c(0x9d)](0x20)['toString'](_0x481f7c(0x76)),_0xa8bce=_0x481f7c(0xaa)+crypto_1['default'][_0x481f7c(0x9d)](0x20)[_0x481f7c(0x8d)](_0x481f7c(0x76));await database_1[_0x481f7c(0x99)][_0x481f7c(0x96)][_0x481f7c(0x8c)]({'where':{'id':_0x8996e2},'data':{'publicKey':_0x228591,'secretKey':_0xa8bce}});}async[a53_0x193c70(0x85)](_0x2ed63c,_0x170b08){const _0x28a92b=a53_0x193c70,{passwordConfirmation:_0x434580}=_0x170b08,_0x547124=await database_1[_0x28a92b(0x99)][_0x28a92b(0x96)]['findUnique']({'where':{'id':_0x2ed63c},'select':{'password':!![]}});if(!_0x547124)throw new Error('Shop\x20not\x20found');const _0x343285=await bcryptjs_1[_0x28a92b(0x99)][_0x28a92b(0x98)](_0x434580,_0x547124[_0x28a92b(0xa0)]);if(!_0x343285)throw new Error(_0x28a92b(0x94));await database_1[_0x28a92b(0x99)][_0x28a92b(0x96)][_0x28a92b(0x8a)]({'where':{'id':_0x2ed63c}});}async[a53_0x193c70(0xa9)](_0x2a8eeb){const _0x3cc906=a53_0x193c70,_0x119f4c=await database_1[_0x3cc906(0x99)][_0x3cc906(0x75)][_0x3cc906(0xa2)]({'where':{'shopId':_0x2a8eeb}});!_0x119f4c&&await database_1['default'][_0x3cc906(0x75)][_0x3cc906(0x87)]({'data':{'shopId':_0x2a8eeb}});}}exports['SettingsService']=SettingsService;