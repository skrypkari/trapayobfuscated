'use strict';const a47_0x3dc5a8=a47_0xe570;(function(_0x13a5fc,_0xd67ed8){const _0x3b7322=a47_0xe570,_0x3f2f3e=_0x13a5fc();while(!![]){try{const _0x1736e4=parseInt(_0x3b7322(0x93))/0x1*(-parseInt(_0x3b7322(0xcd))/0x2)+-parseInt(_0x3b7322(0x99))/0x3*(parseInt(_0x3b7322(0x92))/0x4)+parseInt(_0x3b7322(0x91))/0x5*(-parseInt(_0x3b7322(0xba))/0x6)+-parseInt(_0x3b7322(0xcc))/0x7*(parseInt(_0x3b7322(0xaf))/0x8)+-parseInt(_0x3b7322(0x9e))/0x9*(parseInt(_0x3b7322(0xbf))/0xa)+parseInt(_0x3b7322(0xa0))/0xb+parseInt(_0x3b7322(0xb1))/0xc*(parseInt(_0x3b7322(0xb9))/0xd);if(_0x1736e4===_0xd67ed8)break;else _0x3f2f3e['push'](_0x3f2f3e['shift']());}catch(_0x3667cb){_0x3f2f3e['push'](_0x3f2f3e['shift']());}}}(a47_0x13d5,0xec962));function a47_0xe570(_0x2c934e,_0x43062d){const _0x13d568=a47_0x13d5();return a47_0xe570=function(_0xe57082,_0x4c01af){_0xe57082=_0xe57082-0x8c;let _0x3e4837=_0x13d568[_0xe57082];return _0x3e4837;},a47_0xe570(_0x2c934e,_0x43062d);}var __importDefault=this&&this[a47_0x3dc5a8(0xbb)]||function(_0x27f4fc){const _0x1a9ea8=a47_0x3dc5a8;return _0x27f4fc&&_0x27f4fc[_0x1a9ea8(0xc7)]?_0x27f4fc:{'default':_0x27f4fc};};Object['defineProperty'](exports,a47_0x3dc5a8(0xc7),{'value':!![]}),exports[a47_0x3dc5a8(0xc8)]=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x3dc5a8(0xa7))),crypto_1=__importDefault(require(a47_0x3dc5a8(0xd3))),database_1=__importDefault(require('../config/database'));class SettingsService{[a47_0x3dc5a8(0xac)](_0xa2e6d5){const _0x2195c7=a47_0x3dc5a8;if(!_0xa2e6d5)return'';if(_0xa2e6d5[_0x2195c7(0xce)]<=0x8)return _0xa2e6d5;const _0x27eea8=_0xa2e6d5[_0x2195c7(0x8d)](0x0,0x8),_0x1c59ed='*'[_0x2195c7(0xa3)](Math[_0x2195c7(0xc0)](0x0,_0xa2e6d5['length']-0x8));return _0x27eea8+_0x1c59ed;}[a47_0x3dc5a8(0xc4)](_0x4a4c97){const _0x7c1229=a47_0x3dc5a8;if(!_0x4a4c97)return[];if(Array[_0x7c1229(0xb6)](_0x4a4c97))return _0x4a4c97;if(typeof _0x4a4c97===_0x7c1229(0xa8))try{const _0x5cba8b=JSON[_0x7c1229(0x90)](_0x4a4c97);return Array[_0x7c1229(0xb6)](_0x5cba8b)?_0x5cba8b:[];}catch{return[];}return[];}async[a47_0x3dc5a8(0xb3)](_0x19509c){const _0x2f6dc4=a47_0x3dc5a8,_0x3ee18f=await database_1[_0x2f6dc4(0x9a)][_0x2f6dc4(0xd0)][_0x2f6dc4(0xc2)]({'where':{'id':_0x19509c},'include':{'settings':!![]}});if(!_0x3ee18f)throw new Error('Shop\x20not\x20found');let _0x22d3a7=_0x3ee18f['settings'];return!_0x22d3a7&&(_0x22d3a7=await database_1['default'][_0x2f6dc4(0xbc)][_0x2f6dc4(0xb5)]({'data':{'shopId':_0x3ee18f['id']}})),{'fullName':_0x3ee18f[_0x2f6dc4(0xca)],'brand':_0x3ee18f[_0x2f6dc4(0xca)],'merchantUrl':_0x3ee18f[_0x2f6dc4(0x9d)],'telegramUsername':_0x3ee18f[_0x2f6dc4(0xb7)],'telegramBotApiKey':_0x22d3a7[_0x2f6dc4(0xb2)]?this['maskApiKey'](_0x22d3a7[_0x2f6dc4(0xb2)]):null,'telegramChatId':_0x22d3a7[_0x2f6dc4(0xbd)],'webhookUrl':_0x22d3a7[_0x2f6dc4(0x8c)],'webhookEvents':this[_0x2f6dc4(0xc4)](_0x22d3a7[_0x2f6dc4(0x97)]),'notifications':{'payment_success':_0x22d3a7[_0x2f6dc4(0x9f)],'payment_failed':_0x22d3a7[_0x2f6dc4(0xa5)],'refund':_0x22d3a7[_0x2f6dc4(0xaa)],'payout':_0x22d3a7[_0x2f6dc4(0x9b)],'login':_0x22d3a7[_0x2f6dc4(0x95)],'api_error':_0x22d3a7[_0x2f6dc4(0xae)]}};}async[a47_0x3dc5a8(0xb4)](_0x55be03,_0x1b7308){const _0x2db873=a47_0x3dc5a8,{currentPassword:_0x3f7b1f,newPassword:_0x19865c,confirmNewPassword:_0x3fa80a}=_0x1b7308;if(_0x19865c!==_0x3fa80a)throw new Error(_0x2db873(0xad));if(_0x19865c[_0x2db873(0xce)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x59c1cb=await database_1[_0x2db873(0x9a)][_0x2db873(0xd0)][_0x2db873(0xc2)]({'where':{'id':_0x55be03},'select':{'password':!![]}});if(!_0x59c1cb)throw new Error('Shop\x20not\x20found');const _0x5197d4=await bcryptjs_1[_0x2db873(0x9a)][_0x2db873(0xc1)](_0x3f7b1f,_0x59c1cb[_0x2db873(0x9c)]);if(!_0x5197d4)throw new Error(_0x2db873(0xcf));const _0x10f1cd=await bcryptjs_1['default'][_0x2db873(0xa4)](_0x19865c,0xc);await database_1[_0x2db873(0x9a)]['shop'][_0x2db873(0xb0)]({'where':{'id':_0x55be03},'data':{'password':_0x10f1cd}});}async[a47_0x3dc5a8(0x8f)](_0x2616c0,_0x169adb){const _0x24a130=a47_0x3dc5a8;await this[_0x24a130(0xa1)](_0x2616c0);const _0x1fbc3b={};_0x169adb[_0x24a130(0xab)]!==undefined&&(_0x1fbc3b[_0x24a130(0x9f)]=_0x169adb[_0x24a130(0xab)]),_0x169adb[_0x24a130(0x8e)]!==undefined&&(_0x1fbc3b[_0x24a130(0xa5)]=_0x169adb[_0x24a130(0x8e)]),_0x169adb[_0x24a130(0xc6)]!==undefined&&(_0x1fbc3b[_0x24a130(0xaa)]=_0x169adb[_0x24a130(0xc6)]),_0x169adb[_0x24a130(0xa6)]!==undefined&&(_0x1fbc3b['notificationPayout']=_0x169adb[_0x24a130(0xa6)]),_0x169adb[_0x24a130(0xc9)]!==undefined&&(_0x1fbc3b[_0x24a130(0x95)]=_0x169adb[_0x24a130(0xc9)]),_0x169adb['api_error']!==undefined&&(_0x1fbc3b['notificationApiError']=_0x169adb['api_error']),await database_1['default'][_0x24a130(0xbc)][_0x24a130(0xb0)]({'where':{'shopId':_0x2616c0},'data':_0x1fbc3b});}async[a47_0x3dc5a8(0x94)](_0x5743eb,_0x4da01a){const _0x139b75=a47_0x3dc5a8;await this[_0x139b75(0xa1)](_0x5743eb);const _0x415285={};_0x4da01a[_0x139b75(0xb8)]!==undefined&&(_0x415285[_0x139b75(0xb2)]=_0x4da01a[_0x139b75(0xb8)]||null),_0x4da01a[_0x139b75(0xc5)]!==undefined&&(_0x415285['telegramChatId']=_0x4da01a[_0x139b75(0xc5)]||null),await database_1['default'][_0x139b75(0xbc)][_0x139b75(0xb0)]({'where':{'shopId':_0x5743eb},'data':_0x415285});}async[a47_0x3dc5a8(0xbe)](_0x5cabd5,_0x10ed66){const _0x1a47e4=a47_0x3dc5a8;await this[_0x1a47e4(0xa1)](_0x5cabd5);const _0x4b8d88={};_0x10ed66['webhookUrl']!==undefined&&(_0x4b8d88[_0x1a47e4(0x8c)]=_0x10ed66[_0x1a47e4(0x8c)]||null),_0x10ed66[_0x1a47e4(0x97)]!==undefined&&(_0x4b8d88[_0x1a47e4(0x97)]=_0x10ed66[_0x1a47e4(0x97)]||[]),await database_1['default'][_0x1a47e4(0xbc)][_0x1a47e4(0xb0)]({'where':{'shopId':_0x5cabd5},'data':_0x4b8d88});}async[a47_0x3dc5a8(0x98)](_0x2b72bf){const _0x63bc28=a47_0x3dc5a8,_0x4214c0=_0x63bc28(0xcb)+crypto_1[_0x63bc28(0x9a)][_0x63bc28(0xa2)](0x20)[_0x63bc28(0xd2)](_0x63bc28(0xd1)),_0x16afd5=_0x63bc28(0xa9)+crypto_1[_0x63bc28(0x9a)][_0x63bc28(0xa2)](0x20)[_0x63bc28(0xd2)](_0x63bc28(0xd1));await database_1[_0x63bc28(0x9a)][_0x63bc28(0xd0)][_0x63bc28(0xb0)]({'where':{'id':_0x2b72bf},'data':{'publicKey':_0x4214c0,'secretKey':_0x16afd5}});}async['deleteAccount'](_0x5dddeb,_0x358fcb){const _0x125abf=a47_0x3dc5a8,{passwordConfirmation:_0x5c78cb}=_0x358fcb,_0x323504=await database_1[_0x125abf(0x9a)][_0x125abf(0xd0)][_0x125abf(0xc2)]({'where':{'id':_0x5dddeb},'select':{'password':!![]}});if(!_0x323504)throw new Error('Shop\x20not\x20found');const _0x40acef=await bcryptjs_1[_0x125abf(0x9a)][_0x125abf(0xc1)](_0x5c78cb,_0x323504[_0x125abf(0x9c)]);if(!_0x40acef)throw new Error(_0x125abf(0xc3));await database_1[_0x125abf(0x9a)][_0x125abf(0xd0)][_0x125abf(0x96)]({'where':{'id':_0x5dddeb}});}async[a47_0x3dc5a8(0xa1)](_0x4549d9){const _0x2324b8=a47_0x3dc5a8,_0x32538a=await database_1[_0x2324b8(0x9a)][_0x2324b8(0xbc)][_0x2324b8(0xc2)]({'where':{'shopId':_0x4549d9}});!_0x32538a&&await database_1[_0x2324b8(0x9a)]['shopSettings']['create']({'data':{'shopId':_0x4549d9}});}}exports[a47_0x3dc5a8(0xc8)]=SettingsService;function a47_0x13d5(){const _0x1802f3=['shop','hex','toString','crypto','webhookUrl','substring','payment_failed','updateNotifications','parse','5pkKFeU','112gAcbVn','598197VFErCR','updateTelegramSettings','notificationLogin','delete','webhookEvents','revokeAllApiKeys','84003hbMkRl','default','notificationPayout','password','shopUrl','9VOfvnZ','notificationPaymentSuccess','11110429DLpiHz','ensureSettingsExist','randomBytes','repeat','hash','notificationPaymentFailed','payout','bcryptjs','string','sk_','notificationRefund','payment_success','maskApiKey','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','notificationApiError','3230632lXKkbM','update','167568YNTwGW','telegramBotApiKey','getShopSettings','changePassword','create','isArray','telegram','botApiKey','3471XlXXvu','301458JYANCl','__importDefault','shopSettings','telegramChatId','updateWebhookSettings','15292430atxYrW','max','compare','findUnique','Password\x20confirmation\x20is\x20incorrect','parseWebhookEvents','chatId','refund','__esModule','SettingsService','login','name','pk_','14hfmWGM','2pGsyKU','length','Current\x20password\x20is\x20incorrect'];a47_0x13d5=function(){return _0x1802f3;};return a47_0x13d5();}