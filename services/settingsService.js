'use strict';const a59_0x4ad083=a59_0xce99;function a59_0x525d(){const _0x9d67dc=['sk_','73156zUBowF','33xFMsOf','5366388syjETq','refund','18kqpfFG','__importDefault','substring','telegramChatId','2520CNFGMX','26776Ngbiiq','payment_success','2160JoWwer','telegramBotApiKey','notificationPayout','notificationPaymentSuccess','ensureSettingsExist','parse','update','randomBytes','isArray','parseWebhookEvents','settings','shopSettings','Current\x20password\x20is\x20incorrect','getShopSettings','payment_failed','__esModule','pk_','findUnique','notificationLogin','changePassword','api_error','login','notificationPaymentFailed','name','109LHwEFK','updateNotifications','webhookEvents','defineProperty','113530YmHVSS','telegram','chatId','delete','revokeAllApiKeys','webhookUrl','hex','length','shop','609KwukOX','default','notificationRefund','Shop\x20not\x20found','13LQmKXA','password','maskApiKey','crypto','create','string','2497338ZZoYbb','toString','compare','5702llMuqw','payout','deleteAccount','botApiKey','New\x20password\x20and\x20confirmation\x20do\x20not\x20match'];a59_0x525d=function(){return _0x9d67dc;};return a59_0x525d();}function a59_0xce99(_0x4f48cb,_0x484028){const _0x525dad=a59_0x525d();return a59_0xce99=function(_0xce999d,_0x14aadf){_0xce999d=_0xce999d-0xac;let _0x3cc4b0=_0x525dad[_0xce999d];return _0x3cc4b0;},a59_0xce99(_0x4f48cb,_0x484028);}(function(_0x4f2b51,_0x4b60d4){const _0x4899ef=a59_0xce99,_0x3ec46d=_0x4f2b51();while(!![]){try{const _0x153f7b=-parseInt(_0x4899ef(0xd9))/0x1*(parseInt(_0x4899ef(0xb0))/0x2)+-parseInt(_0x4899ef(0xba))/0x3*(parseInt(_0x4899ef(0xb6))/0x4)+parseInt(_0x4899ef(0xbe))/0x5*(parseInt(_0x4899ef(0xc1))/0x6)+parseInt(_0x4899ef(0xe6))/0x7*(-parseInt(_0x4899ef(0xbf))/0x8)+parseInt(_0x4899ef(0xad))/0x9+-parseInt(_0x4899ef(0xdd))/0xa*(parseInt(_0x4899ef(0xb7))/0xb)+-parseInt(_0x4899ef(0xb8))/0xc*(-parseInt(_0x4899ef(0xea))/0xd);if(_0x153f7b===_0x4b60d4)break;else _0x3ec46d['push'](_0x3ec46d['shift']());}catch(_0x351b89){_0x3ec46d['push'](_0x3ec46d['shift']());}}}(a59_0x525d,0x2727c));var __importDefault=this&&this[a59_0x4ad083(0xbb)]||function(_0x3eee27){const _0x550022=a59_0x4ad083;return _0x3eee27&&_0x3eee27[_0x550022(0xd0)]?_0x3eee27:{'default':_0x3eee27};};Object[a59_0x4ad083(0xdc)](exports,a59_0x4ad083(0xd0),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a59_0x4ad083(0xed))),database_1=__importDefault(require('../config/database'));class SettingsService{[a59_0x4ad083(0xec)](_0xb107b1){const _0x2ef4b7=a59_0x4ad083;if(!_0xb107b1)return'';if(_0xb107b1['length']<=0x8)return _0xb107b1;const _0x412bd0=_0xb107b1[_0x2ef4b7(0xbc)](0x0,0x8),_0x8c4330='*'['repeat'](Math['max'](0x0,_0xb107b1['length']-0x8));return _0x412bd0+_0x8c4330;}[a59_0x4ad083(0xca)](_0x45d225){const _0x54fdaf=a59_0x4ad083;if(!_0x45d225)return[];if(Array[_0x54fdaf(0xc9)](_0x45d225))return _0x45d225;if(typeof _0x45d225===_0x54fdaf(0xac))try{const _0x31717b=JSON[_0x54fdaf(0xc6)](_0x45d225);return Array[_0x54fdaf(0xc9)](_0x31717b)?_0x31717b:[];}catch{return[];}return[];}async[a59_0x4ad083(0xce)](_0x23c8e8){const _0x40ece2=a59_0x4ad083,_0x36611c=await database_1['default'][_0x40ece2(0xe5)]['findUnique']({'where':{'id':_0x23c8e8},'include':{'settings':!![]}});if(!_0x36611c)throw new Error(_0x40ece2(0xe9));let _0x171c5e=_0x36611c[_0x40ece2(0xcb)];return!_0x171c5e&&(_0x171c5e=await database_1[_0x40ece2(0xe7)]['shopSettings'][_0x40ece2(0xee)]({'data':{'shopId':_0x36611c['id']}})),{'fullName':_0x36611c['name'],'brand':_0x36611c[_0x40ece2(0xd8)],'merchantUrl':_0x36611c['shopUrl'],'telegramUsername':_0x36611c[_0x40ece2(0xde)],'telegramBotApiKey':_0x171c5e[_0x40ece2(0xc2)]?this[_0x40ece2(0xec)](_0x171c5e[_0x40ece2(0xc2)]):null,'telegramChatId':_0x171c5e[_0x40ece2(0xbd)],'webhookUrl':_0x171c5e['webhookUrl'],'webhookEvents':this['parseWebhookEvents'](_0x171c5e['webhookEvents']),'notifications':{'payment_success':_0x171c5e[_0x40ece2(0xc4)],'payment_failed':_0x171c5e['notificationPaymentFailed'],'refund':_0x171c5e[_0x40ece2(0xe8)],'payout':_0x171c5e['notificationPayout'],'login':_0x171c5e[_0x40ece2(0xd3)],'api_error':_0x171c5e['notificationApiError']}};}async[a59_0x4ad083(0xd4)](_0x134c80,_0x56c580){const _0x1b744b=a59_0x4ad083,{currentPassword:_0x43b1f1,newPassword:_0x2e7d13,confirmNewPassword:_0x83e59}=_0x56c580;if(_0x2e7d13!==_0x83e59)throw new Error(_0x1b744b(0xb4));if(_0x2e7d13[_0x1b744b(0xe4)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x5859f8=await database_1[_0x1b744b(0xe7)][_0x1b744b(0xe5)][_0x1b744b(0xd2)]({'where':{'id':_0x134c80},'select':{'password':!![]}});if(!_0x5859f8)throw new Error(_0x1b744b(0xe9));const _0x5afc60=await bcryptjs_1['default'][_0x1b744b(0xaf)](_0x43b1f1,_0x5859f8[_0x1b744b(0xeb)]);if(!_0x5afc60)throw new Error(_0x1b744b(0xcd));const _0x418328=await bcryptjs_1[_0x1b744b(0xe7)]['hash'](_0x2e7d13,0xc);await database_1['default']['shop'][_0x1b744b(0xc7)]({'where':{'id':_0x134c80},'data':{'password':_0x418328}});}async[a59_0x4ad083(0xda)](_0x56a194,_0x523f07){const _0x455868=a59_0x4ad083;await this['ensureSettingsExist'](_0x56a194);const _0x3f4a7b={};_0x523f07[_0x455868(0xc0)]!==undefined&&(_0x3f4a7b['notificationPaymentSuccess']=_0x523f07[_0x455868(0xc0)]),_0x523f07[_0x455868(0xcf)]!==undefined&&(_0x3f4a7b[_0x455868(0xd7)]=_0x523f07['payment_failed']),_0x523f07[_0x455868(0xb9)]!==undefined&&(_0x3f4a7b[_0x455868(0xe8)]=_0x523f07[_0x455868(0xb9)]),_0x523f07[_0x455868(0xb1)]!==undefined&&(_0x3f4a7b[_0x455868(0xc3)]=_0x523f07[_0x455868(0xb1)]),_0x523f07['login']!==undefined&&(_0x3f4a7b[_0x455868(0xd3)]=_0x523f07[_0x455868(0xd6)]),_0x523f07[_0x455868(0xd5)]!==undefined&&(_0x3f4a7b['notificationApiError']=_0x523f07['api_error']),await database_1[_0x455868(0xe7)][_0x455868(0xcc)]['update']({'where':{'shopId':_0x56a194},'data':_0x3f4a7b});}async['updateTelegramSettings'](_0x504b65,_0x295163){const _0x58bf7b=a59_0x4ad083;await this['ensureSettingsExist'](_0x504b65);const _0xd03635={};_0x295163['botApiKey']!==undefined&&(_0xd03635[_0x58bf7b(0xc2)]=_0x295163[_0x58bf7b(0xb3)]||null),_0x295163['chatId']!==undefined&&(_0xd03635[_0x58bf7b(0xbd)]=_0x295163[_0x58bf7b(0xdf)]||null),await database_1['default'][_0x58bf7b(0xcc)][_0x58bf7b(0xc7)]({'where':{'shopId':_0x504b65},'data':_0xd03635});}async['updateWebhookSettings'](_0x43f09f,_0x3410a1){const _0x1fea86=a59_0x4ad083;await this[_0x1fea86(0xc5)](_0x43f09f);const _0x59bfbf={};_0x3410a1[_0x1fea86(0xe2)]!==undefined&&(_0x59bfbf['webhookUrl']=_0x3410a1[_0x1fea86(0xe2)]||null),_0x3410a1[_0x1fea86(0xdb)]!==undefined&&(_0x59bfbf[_0x1fea86(0xdb)]=_0x3410a1[_0x1fea86(0xdb)]||[]),await database_1[_0x1fea86(0xe7)]['shopSettings']['update']({'where':{'shopId':_0x43f09f},'data':_0x59bfbf});}async[a59_0x4ad083(0xe1)](_0x5a049e){const _0x676dce=a59_0x4ad083,_0x41a761=_0x676dce(0xd1)+crypto_1[_0x676dce(0xe7)][_0x676dce(0xc8)](0x20)[_0x676dce(0xae)](_0x676dce(0xe3)),_0x15900f=_0x676dce(0xb5)+crypto_1[_0x676dce(0xe7)][_0x676dce(0xc8)](0x20)[_0x676dce(0xae)](_0x676dce(0xe3));await database_1[_0x676dce(0xe7)]['shop'][_0x676dce(0xc7)]({'where':{'id':_0x5a049e},'data':{'publicKey':_0x41a761,'secretKey':_0x15900f}});}async[a59_0x4ad083(0xb2)](_0x3b2d75,_0x117e4e){const _0x16c4c9=a59_0x4ad083,{passwordConfirmation:_0x858eb3}=_0x117e4e,_0x5f3c60=await database_1[_0x16c4c9(0xe7)][_0x16c4c9(0xe5)]['findUnique']({'where':{'id':_0x3b2d75},'select':{'password':!![]}});if(!_0x5f3c60)throw new Error(_0x16c4c9(0xe9));const _0x168431=await bcryptjs_1[_0x16c4c9(0xe7)]['compare'](_0x858eb3,_0x5f3c60[_0x16c4c9(0xeb)]);if(!_0x168431)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x16c4c9(0xe7)]['shop'][_0x16c4c9(0xe0)]({'where':{'id':_0x3b2d75}});}async['ensureSettingsExist'](_0x4ab34d){const _0x140b85=a59_0x4ad083,_0x540a0c=await database_1[_0x140b85(0xe7)][_0x140b85(0xcc)][_0x140b85(0xd2)]({'where':{'shopId':_0x4ab34d}});!_0x540a0c&&await database_1[_0x140b85(0xe7)][_0x140b85(0xcc)][_0x140b85(0xee)]({'data':{'shopId':_0x4ab34d}});}}exports['SettingsService']=SettingsService;