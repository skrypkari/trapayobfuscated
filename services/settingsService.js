'use strict';const a55_0x2a30c5=a55_0x4458;(function(_0x5aacd4,_0x5b989f){const _0x1d6f14=a55_0x4458,_0x3fe883=_0x5aacd4();while(!![]){try{const _0x4bc22a=parseInt(_0x1d6f14(0xc3))/0x1*(parseInt(_0x1d6f14(0xc2))/0x2)+-parseInt(_0x1d6f14(0xba))/0x3*(parseInt(_0x1d6f14(0xb0))/0x4)+parseInt(_0x1d6f14(0xde))/0x5+parseInt(_0x1d6f14(0xc7))/0x6*(-parseInt(_0x1d6f14(0xae))/0x7)+-parseInt(_0x1d6f14(0xbf))/0x8*(-parseInt(_0x1d6f14(0xd7))/0x9)+parseInt(_0x1d6f14(0x9a))/0xa*(-parseInt(_0x1d6f14(0xcd))/0xb)+parseInt(_0x1d6f14(0x9e))/0xc*(parseInt(_0x1d6f14(0x9d))/0xd);if(_0x4bc22a===_0x5b989f)break;else _0x3fe883['push'](_0x3fe883['shift']());}catch(_0x5e244c){_0x3fe883['push'](_0x3fe883['shift']());}}}(a55_0x43aa,0xae823));var __importDefault=this&&this['__importDefault']||function(_0x23f36d){const _0x5db6c5=a55_0x4458;return _0x23f36d&&_0x23f36d[_0x5db6c5(0xd6)]?_0x23f36d:{'default':_0x23f36d};};function a55_0x43aa(){const _0x54b124=['shopSettings','webhookEvents','hex','repeat','findUnique','pk_','isArray','../config/database','compare','6903729FhXQmb','refund','4072612mXezUN','hash','toString','payment_failed','shopUrl','parse','Current\x20password\x20is\x20incorrect','api_error','create','bcryptjs','3eoIYGz','changePassword','delete','parseWebhookEvents','sk_','5161960vBCygT','updateTelegramSettings','length','1486ccvAGK','473Bqtbkn','randomBytes','Shop\x20not\x20found','updateWebhookSettings','6VKFTCg','telegramBotApiKey','notificationPaymentFailed','payout','name','Password\x20confirmation\x20is\x20incorrect','3586pVQEno','string','password','telegramChatId','max','telegram','defineProperty','update','chatId','__esModule','18JbGvpU','notificationApiError','crypto','updateNotifications','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','default','maskApiKey','5515350hVldAy','notificationRefund','notificationPaymentSuccess','botApiKey','30630ouDDUX','ensureSettingsExist','substring','9451UCDBZn','16056ZXiNPR','login','SettingsService','notificationPayout','shop','webhookUrl','New\x20password\x20and\x20confirmation\x20do\x20not\x20match'];a55_0x43aa=function(){return _0x54b124;};return a55_0x43aa();}Object[a55_0x2a30c5(0xd3)](exports,'__esModule',{'value':!![]}),exports[a55_0x2a30c5(0xa0)]=void 0x0;const bcryptjs_1=__importDefault(require(a55_0x2a30c5(0xb9))),crypto_1=__importDefault(require(a55_0x2a30c5(0xd9))),database_1=__importDefault(require(a55_0x2a30c5(0xac)));function a55_0x4458(_0x1cdd3b,_0x17a25c){const _0x43aa0b=a55_0x43aa();return a55_0x4458=function(_0x44583f,_0x2132f8){_0x44583f=_0x44583f-0x98;let _0x4a37c8=_0x43aa0b[_0x44583f];return _0x4a37c8;},a55_0x4458(_0x1cdd3b,_0x17a25c);}class SettingsService{[a55_0x2a30c5(0xdd)](_0x5ba7ee){const _0x1bf951=a55_0x2a30c5;if(!_0x5ba7ee)return'';if(_0x5ba7ee[_0x1bf951(0xc1)]<=0x8)return _0x5ba7ee;const _0x500f91=_0x5ba7ee[_0x1bf951(0x9c)](0x0,0x8),_0x44ff81='*'[_0x1bf951(0xa8)](Math[_0x1bf951(0xd1)](0x0,_0x5ba7ee['length']-0x8));return _0x500f91+_0x44ff81;}[a55_0x2a30c5(0xbd)](_0x5a8f3f){const _0x3da984=a55_0x2a30c5;if(!_0x5a8f3f)return[];if(Array['isArray'](_0x5a8f3f))return _0x5a8f3f;if(typeof _0x5a8f3f===_0x3da984(0xce))try{const _0x5e6be8=JSON[_0x3da984(0xb5)](_0x5a8f3f);return Array[_0x3da984(0xab)](_0x5e6be8)?_0x5e6be8:[];}catch{return[];}return[];}async['getShopSettings'](_0x5c9e76){const _0x336954=a55_0x2a30c5,_0x8c7ec5=await database_1[_0x336954(0xdc)][_0x336954(0xa2)]['findUnique']({'where':{'id':_0x5c9e76},'include':{'settings':!![]}});if(!_0x8c7ec5)throw new Error(_0x336954(0xc5));let _0x5bcfb3=_0x8c7ec5['settings'];return!_0x5bcfb3&&(_0x5bcfb3=await database_1[_0x336954(0xdc)][_0x336954(0xa5)][_0x336954(0xb8)]({'data':{'shopId':_0x8c7ec5['id']}})),{'fullName':_0x8c7ec5[_0x336954(0xcb)],'brand':_0x8c7ec5[_0x336954(0xcb)],'merchantUrl':_0x8c7ec5[_0x336954(0xb4)],'telegramUsername':_0x8c7ec5[_0x336954(0xd2)],'telegramBotApiKey':_0x5bcfb3['telegramBotApiKey']?this['maskApiKey'](_0x5bcfb3[_0x336954(0xc8)]):null,'telegramChatId':_0x5bcfb3['telegramChatId'],'webhookUrl':_0x5bcfb3['webhookUrl'],'webhookEvents':this['parseWebhookEvents'](_0x5bcfb3[_0x336954(0xa6)]),'notifications':{'payment_success':_0x5bcfb3[_0x336954(0x98)],'payment_failed':_0x5bcfb3[_0x336954(0xc9)],'refund':_0x5bcfb3[_0x336954(0xdf)],'payout':_0x5bcfb3[_0x336954(0xa1)],'login':_0x5bcfb3['notificationLogin'],'api_error':_0x5bcfb3[_0x336954(0xd8)]}};}async[a55_0x2a30c5(0xbb)](_0x537d39,_0x636702){const _0x3930a1=a55_0x2a30c5,{currentPassword:_0x1c2937,newPassword:_0x417a3a,confirmNewPassword:_0x81e13c}=_0x636702;if(_0x417a3a!==_0x81e13c)throw new Error(_0x3930a1(0xa4));if(_0x417a3a[_0x3930a1(0xc1)]<0x6)throw new Error(_0x3930a1(0xdb));const _0x2e2d4b=await database_1[_0x3930a1(0xdc)][_0x3930a1(0xa2)][_0x3930a1(0xa9)]({'where':{'id':_0x537d39},'select':{'password':!![]}});if(!_0x2e2d4b)throw new Error(_0x3930a1(0xc5));const _0x5e7c9e=await bcryptjs_1[_0x3930a1(0xdc)][_0x3930a1(0xad)](_0x1c2937,_0x2e2d4b[_0x3930a1(0xcf)]);if(!_0x5e7c9e)throw new Error(_0x3930a1(0xb6));const _0x2211c9=await bcryptjs_1[_0x3930a1(0xdc)][_0x3930a1(0xb1)](_0x417a3a,0xc);await database_1[_0x3930a1(0xdc)]['shop'][_0x3930a1(0xd4)]({'where':{'id':_0x537d39},'data':{'password':_0x2211c9}});}async[a55_0x2a30c5(0xda)](_0x1005dd,_0x45c808){const _0x1ff774=a55_0x2a30c5;await this[_0x1ff774(0x9b)](_0x1005dd);const _0x5f3272={};_0x45c808['payment_success']!==undefined&&(_0x5f3272[_0x1ff774(0x98)]=_0x45c808['payment_success']),_0x45c808[_0x1ff774(0xb3)]!==undefined&&(_0x5f3272['notificationPaymentFailed']=_0x45c808['payment_failed']),_0x45c808[_0x1ff774(0xaf)]!==undefined&&(_0x5f3272['notificationRefund']=_0x45c808[_0x1ff774(0xaf)]),_0x45c808[_0x1ff774(0xca)]!==undefined&&(_0x5f3272['notificationPayout']=_0x45c808[_0x1ff774(0xca)]),_0x45c808[_0x1ff774(0x9f)]!==undefined&&(_0x5f3272['notificationLogin']=_0x45c808[_0x1ff774(0x9f)]),_0x45c808[_0x1ff774(0xb7)]!==undefined&&(_0x5f3272['notificationApiError']=_0x45c808[_0x1ff774(0xb7)]),await database_1[_0x1ff774(0xdc)][_0x1ff774(0xa5)][_0x1ff774(0xd4)]({'where':{'shopId':_0x1005dd},'data':_0x5f3272});}async[a55_0x2a30c5(0xc0)](_0x355a57,_0x39ff6c){const _0xf84fee=a55_0x2a30c5;await this[_0xf84fee(0x9b)](_0x355a57);const _0x3d34fc={};_0x39ff6c[_0xf84fee(0x99)]!==undefined&&(_0x3d34fc[_0xf84fee(0xc8)]=_0x39ff6c[_0xf84fee(0x99)]||null),_0x39ff6c[_0xf84fee(0xd5)]!==undefined&&(_0x3d34fc[_0xf84fee(0xd0)]=_0x39ff6c[_0xf84fee(0xd5)]||null),await database_1['default']['shopSettings'][_0xf84fee(0xd4)]({'where':{'shopId':_0x355a57},'data':_0x3d34fc});}async[a55_0x2a30c5(0xc6)](_0x1f304e,_0x9302d){const _0x2ce01a=a55_0x2a30c5;await this[_0x2ce01a(0x9b)](_0x1f304e);const _0x4f9c73={};_0x9302d['webhookUrl']!==undefined&&(_0x4f9c73[_0x2ce01a(0xa3)]=_0x9302d[_0x2ce01a(0xa3)]||null),_0x9302d[_0x2ce01a(0xa6)]!==undefined&&(_0x4f9c73['webhookEvents']=_0x9302d[_0x2ce01a(0xa6)]||[]),await database_1[_0x2ce01a(0xdc)][_0x2ce01a(0xa5)][_0x2ce01a(0xd4)]({'where':{'shopId':_0x1f304e},'data':_0x4f9c73});}async['revokeAllApiKeys'](_0x5e59b8){const _0x49e540=a55_0x2a30c5,_0x517bf5=_0x49e540(0xaa)+crypto_1[_0x49e540(0xdc)]['randomBytes'](0x20)[_0x49e540(0xb2)](_0x49e540(0xa7)),_0x2bf2e2=_0x49e540(0xbe)+crypto_1[_0x49e540(0xdc)][_0x49e540(0xc4)](0x20)[_0x49e540(0xb2)](_0x49e540(0xa7));await database_1[_0x49e540(0xdc)][_0x49e540(0xa2)][_0x49e540(0xd4)]({'where':{'id':_0x5e59b8},'data':{'publicKey':_0x517bf5,'secretKey':_0x2bf2e2}});}async['deleteAccount'](_0x45370e,_0x33ea9f){const _0x1ce030=a55_0x2a30c5,{passwordConfirmation:_0x1b7bc9}=_0x33ea9f,_0x461e9f=await database_1[_0x1ce030(0xdc)][_0x1ce030(0xa2)][_0x1ce030(0xa9)]({'where':{'id':_0x45370e},'select':{'password':!![]}});if(!_0x461e9f)throw new Error(_0x1ce030(0xc5));const _0x529f28=await bcryptjs_1['default'][_0x1ce030(0xad)](_0x1b7bc9,_0x461e9f[_0x1ce030(0xcf)]);if(!_0x529f28)throw new Error(_0x1ce030(0xcc));await database_1[_0x1ce030(0xdc)][_0x1ce030(0xa2)][_0x1ce030(0xbc)]({'where':{'id':_0x45370e}});}async[a55_0x2a30c5(0x9b)](_0x50d926){const _0x7100=a55_0x2a30c5,_0x4c925e=await database_1[_0x7100(0xdc)]['shopSettings'][_0x7100(0xa9)]({'where':{'shopId':_0x50d926}});!_0x4c925e&&await database_1[_0x7100(0xdc)]['shopSettings']['create']({'data':{'shopId':_0x50d926}});}}exports[a55_0x2a30c5(0xa0)]=SettingsService;