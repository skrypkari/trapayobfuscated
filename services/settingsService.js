'use strict';const a59_0x4b6f6a=a59_0x40e4;(function(_0x340ec0,_0x36b8b1){const _0x524d3d=a59_0x40e4,_0x3974f9=_0x340ec0();while(!![]){try{const _0x2726ec=-parseInt(_0x524d3d(0xa9))/0x1*(parseInt(_0x524d3d(0xa2))/0x2)+parseInt(_0x524d3d(0x99))/0x3*(-parseInt(_0x524d3d(0xb4))/0x4)+parseInt(_0x524d3d(0x83))/0x5+-parseInt(_0x524d3d(0x80))/0x6+-parseInt(_0x524d3d(0x7b))/0x7*(parseInt(_0x524d3d(0x8f))/0x8)+parseInt(_0x524d3d(0x72))/0x9*(parseInt(_0x524d3d(0x92))/0xa)+parseInt(_0x524d3d(0x79))/0xb*(parseInt(_0x524d3d(0x8a))/0xc);if(_0x2726ec===_0x36b8b1)break;else _0x3974f9['push'](_0x3974f9['shift']());}catch(_0x277623){_0x3974f9['push'](_0x3974f9['shift']());}}}(a59_0x34fe,0x25a7b));var __importDefault=this&&this['__importDefault']||function(_0x55c121){return _0x55c121&&_0x55c121['__esModule']?_0x55c121:{'default':_0x55c121};};Object['defineProperty'](exports,a59_0x4b6f6a(0xb3),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a59_0x4b6f6a(0x7a))),crypto_1=__importDefault(require(a59_0x4b6f6a(0x88))),database_1=__importDefault(require(a59_0x4b6f6a(0x9b)));class SettingsService{[a59_0x4b6f6a(0x86)](_0x2797e9){const _0x385239=a59_0x4b6f6a;if(!_0x2797e9)return'';if(_0x2797e9['length']<=0x8)return _0x2797e9;const _0x558049=_0x2797e9[_0x385239(0x7e)](0x0,0x8),_0x2eb123='*'[_0x385239(0x8d)](Math[_0x385239(0x73)](0x0,_0x2797e9[_0x385239(0x74)]-0x8));return _0x558049+_0x2eb123;}['parseWebhookEvents'](_0x3ab513){const _0x3132bc=a59_0x4b6f6a;if(!_0x3ab513)return[];if(Array['isArray'](_0x3ab513))return _0x3ab513;if(typeof _0x3ab513===_0x3132bc(0x84))try{const _0xdace6e=JSON[_0x3132bc(0xa8)](_0x3ab513);return Array[_0x3132bc(0xac)](_0xdace6e)?_0xdace6e:[];}catch{return[];}return[];}async[a59_0x4b6f6a(0x7f)](_0x24450b){const _0x31d3de=a59_0x4b6f6a,_0x5b129e=await database_1[_0x31d3de(0x8e)][_0x31d3de(0x7c)][_0x31d3de(0x78)]({'where':{'id':_0x24450b},'include':{'settings':!![]}});if(!_0x5b129e)throw new Error(_0x31d3de(0xa7));let _0x2a68da=_0x5b129e[_0x31d3de(0x9f)];return!_0x2a68da&&(_0x2a68da=await database_1[_0x31d3de(0x8e)][_0x31d3de(0x90)][_0x31d3de(0x87)]({'data':{'shopId':_0x5b129e['id']}})),{'fullName':_0x5b129e[_0x31d3de(0x9e)],'brand':_0x5b129e['name'],'merchantUrl':_0x5b129e['shopUrl'],'telegramUsername':_0x5b129e[_0x31d3de(0xab)],'telegramBotApiKey':_0x2a68da[_0x31d3de(0x9c)]?this[_0x31d3de(0x86)](_0x2a68da[_0x31d3de(0x9c)]):null,'telegramChatId':_0x2a68da[_0x31d3de(0xa0)],'webhookUrl':_0x2a68da[_0x31d3de(0xb0)],'webhookEvents':this[_0x31d3de(0x9d)](_0x2a68da['webhookEvents']),'notifications':{'payment_success':_0x2a68da[_0x31d3de(0x97)],'payment_failed':_0x2a68da[_0x31d3de(0xb2)],'refund':_0x2a68da[_0x31d3de(0x96)],'payout':_0x2a68da[_0x31d3de(0x91)],'login':_0x2a68da[_0x31d3de(0x70)],'api_error':_0x2a68da[_0x31d3de(0x76)]}};}async[a59_0x4b6f6a(0x95)](_0xb0d738,_0x3accdc){const _0x526e8b=a59_0x4b6f6a,{currentPassword:_0x3de830,newPassword:_0x31a2c6,confirmNewPassword:_0x17d5e5}=_0x3accdc;if(_0x31a2c6!==_0x17d5e5)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x31a2c6[_0x526e8b(0x74)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x1cf349=await database_1[_0x526e8b(0x8e)][_0x526e8b(0x7c)][_0x526e8b(0x78)]({'where':{'id':_0xb0d738},'select':{'password':!![]}});if(!_0x1cf349)throw new Error('Shop\x20not\x20found');const _0xb46d28=await bcryptjs_1[_0x526e8b(0x8e)][_0x526e8b(0xa6)](_0x3de830,_0x1cf349['password']);if(!_0xb46d28)throw new Error(_0x526e8b(0x9a));const _0x274dee=await bcryptjs_1[_0x526e8b(0x8e)]['hash'](_0x31a2c6,0xc);await database_1[_0x526e8b(0x8e)]['shop'][_0x526e8b(0xad)]({'where':{'id':_0xb0d738},'data':{'password':_0x274dee}});}async[a59_0x4b6f6a(0x71)](_0x51f34d,_0x4bf707){const _0x2e9e6d=a59_0x4b6f6a;await this[_0x2e9e6d(0x89)](_0x51f34d);const _0x29c49b={};_0x4bf707[_0x2e9e6d(0x98)]!==undefined&&(_0x29c49b[_0x2e9e6d(0x97)]=_0x4bf707[_0x2e9e6d(0x98)]),_0x4bf707[_0x2e9e6d(0xb1)]!==undefined&&(_0x29c49b['notificationPaymentFailed']=_0x4bf707[_0x2e9e6d(0xb1)]),_0x4bf707[_0x2e9e6d(0xa3)]!==undefined&&(_0x29c49b[_0x2e9e6d(0x96)]=_0x4bf707[_0x2e9e6d(0xa3)]),_0x4bf707[_0x2e9e6d(0xaf)]!==undefined&&(_0x29c49b[_0x2e9e6d(0x91)]=_0x4bf707['payout']),_0x4bf707['login']!==undefined&&(_0x29c49b[_0x2e9e6d(0x70)]=_0x4bf707[_0x2e9e6d(0xa1)]),_0x4bf707[_0x2e9e6d(0x81)]!==undefined&&(_0x29c49b['notificationApiError']=_0x4bf707['api_error']),await database_1[_0x2e9e6d(0x8e)]['shopSettings'][_0x2e9e6d(0xad)]({'where':{'shopId':_0x51f34d},'data':_0x29c49b});}async[a59_0x4b6f6a(0x77)](_0x159cc9,_0x402fe6){const _0x387e1d=a59_0x4b6f6a;await this[_0x387e1d(0x89)](_0x159cc9);const _0x526b4f={};_0x402fe6[_0x387e1d(0x7d)]!==undefined&&(_0x526b4f['telegramBotApiKey']=_0x402fe6[_0x387e1d(0x7d)]||null),_0x402fe6[_0x387e1d(0x82)]!==undefined&&(_0x526b4f[_0x387e1d(0xa0)]=_0x402fe6[_0x387e1d(0x82)]||null),await database_1[_0x387e1d(0x8e)]['shopSettings']['update']({'where':{'shopId':_0x159cc9},'data':_0x526b4f});}async[a59_0x4b6f6a(0xae)](_0x1cd84e,_0x4022a2){const _0x242b05=a59_0x4b6f6a;await this[_0x242b05(0x89)](_0x1cd84e);const _0x45ee2b={};_0x4022a2[_0x242b05(0xb0)]!==undefined&&(_0x45ee2b[_0x242b05(0xb0)]=_0x4022a2['webhookUrl']||null),_0x4022a2[_0x242b05(0x8b)]!==undefined&&(_0x45ee2b[_0x242b05(0x8b)]=_0x4022a2[_0x242b05(0x8b)]||[]),await database_1[_0x242b05(0x8e)][_0x242b05(0x90)][_0x242b05(0xad)]({'where':{'shopId':_0x1cd84e},'data':_0x45ee2b});}async['revokeAllApiKeys'](_0x5715ad){const _0xd4929b=a59_0x4b6f6a,_0x3eb42d=_0xd4929b(0x93)+crypto_1['default'][_0xd4929b(0xa5)](0x20)[_0xd4929b(0x85)](_0xd4929b(0xa4)),_0x5935a9=_0xd4929b(0x94)+crypto_1['default'][_0xd4929b(0xa5)](0x20)['toString']('hex');await database_1[_0xd4929b(0x8e)][_0xd4929b(0x7c)]['update']({'where':{'id':_0x5715ad},'data':{'publicKey':_0x3eb42d,'secretKey':_0x5935a9}});}async[a59_0x4b6f6a(0xaa)](_0x2df624,_0x3d582e){const _0x4864df=a59_0x4b6f6a,{passwordConfirmation:_0x1ef256}=_0x3d582e,_0x199eba=await database_1['default'][_0x4864df(0x7c)][_0x4864df(0x78)]({'where':{'id':_0x2df624},'select':{'password':!![]}});if(!_0x199eba)throw new Error(_0x4864df(0xa7));const _0x2f0af4=await bcryptjs_1[_0x4864df(0x8e)]['compare'](_0x1ef256,_0x199eba[_0x4864df(0x8c)]);if(!_0x2f0af4)throw new Error(_0x4864df(0x75));await database_1[_0x4864df(0x8e)][_0x4864df(0x7c)]['delete']({'where':{'id':_0x2df624}});}async[a59_0x4b6f6a(0x89)](_0x206636){const _0x1f2f61=a59_0x4b6f6a,_0x2b2d68=await database_1[_0x1f2f61(0x8e)][_0x1f2f61(0x90)][_0x1f2f61(0x78)]({'where':{'shopId':_0x206636}});!_0x2b2d68&&await database_1[_0x1f2f61(0x8e)][_0x1f2f61(0x90)][_0x1f2f61(0x87)]({'data':{'shopId':_0x206636}});}}function a59_0x40e4(_0x37b6ac,_0x3558a4){const _0x34fec8=a59_0x34fe();return a59_0x40e4=function(_0x40e48c,_0x25811f){_0x40e48c=_0x40e48c-0x70;let _0x239470=_0x34fec8[_0x40e48c];return _0x239470;},a59_0x40e4(_0x37b6ac,_0x3558a4);}function a59_0x34fe(){const _0x45834d=['payout','webhookUrl','payment_failed','notificationPaymentFailed','__esModule','1143148LyiqGv','notificationLogin','updateNotifications','9WiCEXM','max','length','Password\x20confirmation\x20is\x20incorrect','notificationApiError','updateTelegramSettings','findUnique','14641tEpBiW','bcryptjs','442162fFaCGq','shop','botApiKey','substring','getShopSettings','557580aiZccj','api_error','chatId','1341295AFVtfg','string','toString','maskApiKey','create','crypto','ensureSettingsExist','2628HXMSHa','webhookEvents','password','repeat','default','24CHwFXk','shopSettings','notificationPayout','1751010CrJTJq','pk_','sk_','changePassword','notificationRefund','notificationPaymentSuccess','payment_success','3ccOjIv','Current\x20password\x20is\x20incorrect','../config/database','telegramBotApiKey','parseWebhookEvents','name','settings','telegramChatId','login','8266GsKiGG','refund','hex','randomBytes','compare','Shop\x20not\x20found','parse','3XbxMYO','deleteAccount','telegram','isArray','update','updateWebhookSettings'];a59_0x34fe=function(){return _0x45834d;};return a59_0x34fe();}exports['SettingsService']=SettingsService;