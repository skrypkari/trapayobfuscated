'use strict';const a52_0x578865=a52_0x3ea8;(function(_0x363037,_0x288449){const _0xe7f237=a52_0x3ea8,_0x213720=_0x363037();while(!![]){try{const _0x3dfdca=parseInt(_0xe7f237(0xb4))/0x1*(-parseInt(_0xe7f237(0xca))/0x2)+-parseInt(_0xe7f237(0xda))/0x3*(parseInt(_0xe7f237(0xc2))/0x4)+-parseInt(_0xe7f237(0xdd))/0x5*(-parseInt(_0xe7f237(0xb9))/0x6)+parseInt(_0xe7f237(0xce))/0x7*(parseInt(_0xe7f237(0xaf))/0x8)+parseInt(_0xe7f237(0xba))/0x9+parseInt(_0xe7f237(0xe3))/0xa*(parseInt(_0xe7f237(0xf0))/0xb)+-parseInt(_0xe7f237(0xbe))/0xc*(parseInt(_0xe7f237(0xde))/0xd);if(_0x3dfdca===_0x288449)break;else _0x213720['push'](_0x213720['shift']());}catch(_0x512182){_0x213720['push'](_0x213720['shift']());}}}(a52_0x4ee7,0xc9d4b));var __importDefault=this&&this[a52_0x578865(0xee)]||function(_0x5b3d7b){const _0x12146d=a52_0x578865;return _0x5b3d7b&&_0x5b3d7b[_0x12146d(0xd2)]?_0x5b3d7b:{'default':_0x5b3d7b};};Object[a52_0x578865(0xf2)](exports,a52_0x578865(0xd2),{'value':!![]}),exports[a52_0x578865(0xf1)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x578865(0xc7))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a52_0x578865(0xb3)));function a52_0x4ee7(){const _0x1337e3=['Shop\x20not\x20found','randomBytes','telegram','chatId','30NlytJd','botApiKey','updateNotifications','name','notificationPaymentSuccess','payout','compare','password','length','parseWebhookEvents','max','__importDefault','shopUrl','3607285PFBMmu','SettingsService','defineProperty','revokeAllApiKeys','notificationPaymentFailed','webhookEvents','768qberLa','isArray','refund','webhookUrl','../config/database','40661bEnyIE','parse','delete','telegramBotApiKey','Current\x20password\x20is\x20incorrect','8703678lyBngz','9561816BHgANB','hash','telegramChatId','ensureSettingsExist','2280WNSyyN','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','repeat','default','642652hWfZyw','notificationApiError','notificationPayout','sk_','login','bcryptjs','notificationRefund','payment_success','8iJUVki','shop','hex','maskApiKey','74123mYQggB','findUnique','update','notificationLogin','__esModule','api_error','payment_failed','toString','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','deleteAccount','updateTelegramSettings','create','3lBHSvL','shopSettings','Password\x20confirmation\x20is\x20incorrect','5CRlsci','230126uIRoMW'];a52_0x4ee7=function(){return _0x1337e3;};return a52_0x4ee7();}function a52_0x3ea8(_0x36af95,_0x470fe6){const _0x4ee74d=a52_0x4ee7();return a52_0x3ea8=function(_0x3ea82d,_0x3fd494){_0x3ea82d=_0x3ea82d-0xac;let _0x15b658=_0x4ee74d[_0x3ea82d];return _0x15b658;},a52_0x3ea8(_0x36af95,_0x470fe6);}class SettingsService{[a52_0x578865(0xcd)](_0x49324f){const _0x12155a=a52_0x578865;if(!_0x49324f)return'';if(_0x49324f['length']<=0x8)return _0x49324f;const _0x5e1458=_0x49324f['substring'](0x0,0x8),_0x29b32b='*'[_0x12155a(0xc0)](Math[_0x12155a(0xed)](0x0,_0x49324f[_0x12155a(0xeb)]-0x8));return _0x5e1458+_0x29b32b;}[a52_0x578865(0xec)](_0x5bb49d){const _0x3ed76e=a52_0x578865;if(!_0x5bb49d)return[];if(Array['isArray'](_0x5bb49d))return _0x5bb49d;if(typeof _0x5bb49d==='string')try{const _0x264d8d=JSON[_0x3ed76e(0xb5)](_0x5bb49d);return Array[_0x3ed76e(0xb0)](_0x264d8d)?_0x264d8d:[];}catch{return[];}return[];}async['getShopSettings'](_0x1143e6){const _0x16dc52=a52_0x578865,_0x1d0df5=await database_1[_0x16dc52(0xc1)]['shop'][_0x16dc52(0xcf)]({'where':{'id':_0x1143e6},'include':{'settings':!![]}});if(!_0x1d0df5)throw new Error(_0x16dc52(0xdf));let _0x3d868f=_0x1d0df5['settings'];return!_0x3d868f&&(_0x3d868f=await database_1[_0x16dc52(0xc1)]['shopSettings'][_0x16dc52(0xd9)]({'data':{'shopId':_0x1d0df5['id']}})),{'fullName':_0x1d0df5['name'],'brand':_0x1d0df5[_0x16dc52(0xe6)],'merchantUrl':_0x1d0df5[_0x16dc52(0xef)],'telegramUsername':_0x1d0df5[_0x16dc52(0xe1)],'telegramBotApiKey':_0x3d868f[_0x16dc52(0xb7)]?this[_0x16dc52(0xcd)](_0x3d868f['telegramBotApiKey']):null,'telegramChatId':_0x3d868f[_0x16dc52(0xbc)],'webhookUrl':_0x3d868f[_0x16dc52(0xb2)],'webhookEvents':this['parseWebhookEvents'](_0x3d868f['webhookEvents']),'notifications':{'payment_success':_0x3d868f['notificationPaymentSuccess'],'payment_failed':_0x3d868f[_0x16dc52(0xad)],'refund':_0x3d868f[_0x16dc52(0xc8)],'payout':_0x3d868f[_0x16dc52(0xc4)],'login':_0x3d868f[_0x16dc52(0xd1)],'api_error':_0x3d868f[_0x16dc52(0xc3)]}};}async['changePassword'](_0x3e665a,_0x40a740){const _0x138d89=a52_0x578865,{currentPassword:_0x3574b6,newPassword:_0x588ba0,confirmNewPassword:_0x29fb38}=_0x40a740;if(_0x588ba0!==_0x29fb38)throw new Error(_0x138d89(0xd6));if(_0x588ba0[_0x138d89(0xeb)]<0x6)throw new Error(_0x138d89(0xbf));const _0x54be1d=await database_1[_0x138d89(0xc1)][_0x138d89(0xcb)][_0x138d89(0xcf)]({'where':{'id':_0x3e665a},'select':{'password':!![]}});if(!_0x54be1d)throw new Error(_0x138d89(0xdf));const _0x63691a=await bcryptjs_1[_0x138d89(0xc1)][_0x138d89(0xe9)](_0x3574b6,_0x54be1d[_0x138d89(0xea)]);if(!_0x63691a)throw new Error(_0x138d89(0xb8));const _0x18ab47=await bcryptjs_1['default'][_0x138d89(0xbb)](_0x588ba0,0xc);await database_1[_0x138d89(0xc1)][_0x138d89(0xcb)][_0x138d89(0xd0)]({'where':{'id':_0x3e665a},'data':{'password':_0x18ab47}});}async[a52_0x578865(0xe5)](_0x53dd67,_0x1312e5){const _0xe3d230=a52_0x578865;await this[_0xe3d230(0xbd)](_0x53dd67);const _0x1c9222={};_0x1312e5[_0xe3d230(0xc9)]!==undefined&&(_0x1c9222[_0xe3d230(0xe7)]=_0x1312e5[_0xe3d230(0xc9)]),_0x1312e5[_0xe3d230(0xd4)]!==undefined&&(_0x1c9222['notificationPaymentFailed']=_0x1312e5[_0xe3d230(0xd4)]),_0x1312e5[_0xe3d230(0xb1)]!==undefined&&(_0x1c9222['notificationRefund']=_0x1312e5['refund']),_0x1312e5[_0xe3d230(0xe8)]!==undefined&&(_0x1c9222[_0xe3d230(0xc4)]=_0x1312e5['payout']),_0x1312e5[_0xe3d230(0xc6)]!==undefined&&(_0x1c9222[_0xe3d230(0xd1)]=_0x1312e5[_0xe3d230(0xc6)]),_0x1312e5[_0xe3d230(0xd3)]!==undefined&&(_0x1c9222['notificationApiError']=_0x1312e5[_0xe3d230(0xd3)]),await database_1[_0xe3d230(0xc1)][_0xe3d230(0xdb)][_0xe3d230(0xd0)]({'where':{'shopId':_0x53dd67},'data':_0x1c9222});}async[a52_0x578865(0xd8)](_0x2a1bf7,_0x219036){const _0xd21ed3=a52_0x578865;await this[_0xd21ed3(0xbd)](_0x2a1bf7);const _0x4a77e5={};_0x219036['botApiKey']!==undefined&&(_0x4a77e5[_0xd21ed3(0xb7)]=_0x219036[_0xd21ed3(0xe4)]||null),_0x219036[_0xd21ed3(0xe2)]!==undefined&&(_0x4a77e5[_0xd21ed3(0xbc)]=_0x219036[_0xd21ed3(0xe2)]||null),await database_1[_0xd21ed3(0xc1)][_0xd21ed3(0xdb)]['update']({'where':{'shopId':_0x2a1bf7},'data':_0x4a77e5});}async['updateWebhookSettings'](_0x8a228d,_0x8b15e0){const _0x817388=a52_0x578865;await this[_0x817388(0xbd)](_0x8a228d);const _0x22e0d3={};_0x8b15e0[_0x817388(0xb2)]!==undefined&&(_0x22e0d3[_0x817388(0xb2)]=_0x8b15e0[_0x817388(0xb2)]||null),_0x8b15e0[_0x817388(0xae)]!==undefined&&(_0x22e0d3[_0x817388(0xae)]=_0x8b15e0[_0x817388(0xae)]||[]),await database_1[_0x817388(0xc1)]['shopSettings']['update']({'where':{'shopId':_0x8a228d},'data':_0x22e0d3});}async[a52_0x578865(0xac)](_0xd67865){const _0x2438ca=a52_0x578865,_0x2e88bb='pk_'+crypto_1[_0x2438ca(0xc1)][_0x2438ca(0xe0)](0x20)[_0x2438ca(0xd5)](_0x2438ca(0xcc)),_0x452fb0=_0x2438ca(0xc5)+crypto_1[_0x2438ca(0xc1)][_0x2438ca(0xe0)](0x20)[_0x2438ca(0xd5)]('hex');await database_1['default'][_0x2438ca(0xcb)]['update']({'where':{'id':_0xd67865},'data':{'publicKey':_0x2e88bb,'secretKey':_0x452fb0}});}async[a52_0x578865(0xd7)](_0xd02b67,_0x2cac1d){const _0x2179ab=a52_0x578865,{passwordConfirmation:_0x4336ea}=_0x2cac1d,_0x3f121e=await database_1[_0x2179ab(0xc1)][_0x2179ab(0xcb)][_0x2179ab(0xcf)]({'where':{'id':_0xd02b67},'select':{'password':!![]}});if(!_0x3f121e)throw new Error(_0x2179ab(0xdf));const _0x4381ad=await bcryptjs_1[_0x2179ab(0xc1)][_0x2179ab(0xe9)](_0x4336ea,_0x3f121e[_0x2179ab(0xea)]);if(!_0x4381ad)throw new Error(_0x2179ab(0xdc));await database_1[_0x2179ab(0xc1)][_0x2179ab(0xcb)][_0x2179ab(0xb6)]({'where':{'id':_0xd02b67}});}async[a52_0x578865(0xbd)](_0x1984da){const _0x4b9f49=a52_0x578865,_0x4103c7=await database_1[_0x4b9f49(0xc1)]['shopSettings'][_0x4b9f49(0xcf)]({'where':{'shopId':_0x1984da}});!_0x4103c7&&await database_1['default'][_0x4b9f49(0xdb)][_0x4b9f49(0xd9)]({'data':{'shopId':_0x1984da}});}}exports[a52_0x578865(0xf1)]=SettingsService;