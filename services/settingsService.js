'use strict';const a53_0x45d9e1=a53_0x188d;(function(_0xa180e0,_0x2e4539){const _0x37b905=a53_0x188d,_0x451a66=_0xa180e0();while(!![]){try{const _0x3cd3aa=parseInt(_0x37b905(0x14f))/0x1+-parseInt(_0x37b905(0x155))/0x2*(-parseInt(_0x37b905(0x168))/0x3)+parseInt(_0x37b905(0x147))/0x4+-parseInt(_0x37b905(0x130))/0x5+-parseInt(_0x37b905(0x12c))/0x6+parseInt(_0x37b905(0x157))/0x7*(parseInt(_0x37b905(0x15c))/0x8)+parseInt(_0x37b905(0x150))/0x9*(-parseInt(_0x37b905(0x15b))/0xa);if(_0x3cd3aa===_0x2e4539)break;else _0x451a66['push'](_0x451a66['shift']());}catch(_0x320fcf){_0x451a66['push'](_0x451a66['shift']());}}}(a53_0x3266,0xa92c7));function a53_0x3266(){const _0x40acbb=['__esModule','ensureSettingsExist','isArray','compare','82625LjJzQi','3555eMmUNm','toString','sk_','notificationPayout','randomBytes','906962kIHqxF','telegramChatId','133YwkLDT','Shop\x20not\x20found','notificationRefund','string','16540MSuFzC','456160DXZFZT','Password\x20confirmation\x20is\x20incorrect','repeat','length','crypto','name','default','hex','refund','maskApiKey','parse','notificationPaymentFailed','3wbbTmv','payout','password','parseWebhookEvents','delete','shop','updateTelegramSettings','login','hash','webhookEvents','3232758sqFxjY','api_error','botApiKey','shopSettings','4855915OWFgjH','bcryptjs','../config/database','updateWebhookSettings','findUnique','payment_failed','settings','substring','Current\x20password\x20is\x20incorrect','telegramBotApiKey','update','pk_','__importDefault','telegram','webhookUrl','shopUrl','max','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','changePassword','notificationLogin','notificationPaymentSuccess','deleteAccount','SettingsService','4947020KpgqCZ','create','chatId','notificationApiError'];a53_0x3266=function(){return _0x40acbb;};return a53_0x3266();}var __importDefault=this&&this[a53_0x45d9e1(0x13c)]||function(_0x13d475){const _0x364861=a53_0x45d9e1;return _0x13d475&&_0x13d475[_0x364861(0x14b)]?_0x13d475:{'default':_0x13d475};};Object['defineProperty'](exports,a53_0x45d9e1(0x14b),{'value':!![]}),exports[a53_0x45d9e1(0x146)]=void 0x0;const bcryptjs_1=__importDefault(require(a53_0x45d9e1(0x131))),crypto_1=__importDefault(require(a53_0x45d9e1(0x160))),database_1=__importDefault(require(a53_0x45d9e1(0x132)));function a53_0x188d(_0x209d03,_0x1c85b0){const _0x326671=a53_0x3266();return a53_0x188d=function(_0x188d9d,_0x493312){_0x188d9d=_0x188d9d-0x124;let _0x330250=_0x326671[_0x188d9d];return _0x330250;},a53_0x188d(_0x209d03,_0x1c85b0);}class SettingsService{[a53_0x45d9e1(0x165)](_0x21f753){const _0x424d5a=a53_0x45d9e1;if(!_0x21f753)return'';if(_0x21f753[_0x424d5a(0x15f)]<=0x8)return _0x21f753;const _0x46439c=_0x21f753[_0x424d5a(0x137)](0x0,0x8),_0x188c5f='*'[_0x424d5a(0x15e)](Math[_0x424d5a(0x140)](0x0,_0x21f753[_0x424d5a(0x15f)]-0x8));return _0x46439c+_0x188c5f;}[a53_0x45d9e1(0x125)](_0x24e3d1){const _0x3e7395=a53_0x45d9e1;if(!_0x24e3d1)return[];if(Array[_0x3e7395(0x14d)](_0x24e3d1))return _0x24e3d1;if(typeof _0x24e3d1===_0x3e7395(0x15a))try{const _0x52bed7=JSON[_0x3e7395(0x166)](_0x24e3d1);return Array[_0x3e7395(0x14d)](_0x52bed7)?_0x52bed7:[];}catch{return[];}return[];}async['getShopSettings'](_0x305acd){const _0xa8faf=a53_0x45d9e1,_0x124f8f=await database_1['default'][_0xa8faf(0x127)][_0xa8faf(0x134)]({'where':{'id':_0x305acd},'include':{'settings':!![]}});if(!_0x124f8f)throw new Error(_0xa8faf(0x158));let _0x192399=_0x124f8f[_0xa8faf(0x136)];return!_0x192399&&(_0x192399=await database_1['default'][_0xa8faf(0x12f)][_0xa8faf(0x148)]({'data':{'shopId':_0x124f8f['id']}})),{'fullName':_0x124f8f[_0xa8faf(0x161)],'brand':_0x124f8f[_0xa8faf(0x161)],'merchantUrl':_0x124f8f[_0xa8faf(0x13f)],'telegramUsername':_0x124f8f[_0xa8faf(0x13d)],'telegramBotApiKey':_0x192399[_0xa8faf(0x139)]?this[_0xa8faf(0x165)](_0x192399[_0xa8faf(0x139)]):null,'telegramChatId':_0x192399['telegramChatId'],'webhookUrl':_0x192399[_0xa8faf(0x13e)],'webhookEvents':this[_0xa8faf(0x125)](_0x192399[_0xa8faf(0x12b)]),'notifications':{'payment_success':_0x192399['notificationPaymentSuccess'],'payment_failed':_0x192399[_0xa8faf(0x167)],'refund':_0x192399[_0xa8faf(0x159)],'payout':_0x192399[_0xa8faf(0x153)],'login':_0x192399[_0xa8faf(0x143)],'api_error':_0x192399[_0xa8faf(0x14a)]}};}async[a53_0x45d9e1(0x142)](_0x1b4ec7,_0x5a10bd){const _0x530cb8=a53_0x45d9e1,{currentPassword:_0x3d743e,newPassword:_0x572ce1,confirmNewPassword:_0x237338}=_0x5a10bd;if(_0x572ce1!==_0x237338)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x572ce1['length']<0x6)throw new Error(_0x530cb8(0x141));const _0x3ef21d=await database_1['default'][_0x530cb8(0x127)][_0x530cb8(0x134)]({'where':{'id':_0x1b4ec7},'select':{'password':!![]}});if(!_0x3ef21d)throw new Error(_0x530cb8(0x158));const _0x191bdd=await bcryptjs_1[_0x530cb8(0x162)][_0x530cb8(0x14e)](_0x3d743e,_0x3ef21d[_0x530cb8(0x124)]);if(!_0x191bdd)throw new Error(_0x530cb8(0x138));const _0x226298=await bcryptjs_1[_0x530cb8(0x162)][_0x530cb8(0x12a)](_0x572ce1,0xc);await database_1[_0x530cb8(0x162)][_0x530cb8(0x127)][_0x530cb8(0x13a)]({'where':{'id':_0x1b4ec7},'data':{'password':_0x226298}});}async['updateNotifications'](_0x1246eb,_0x237099){const _0xb3b494=a53_0x45d9e1;await this[_0xb3b494(0x14c)](_0x1246eb);const _0x4757c5={};_0x237099['payment_success']!==undefined&&(_0x4757c5[_0xb3b494(0x144)]=_0x237099['payment_success']),_0x237099['payment_failed']!==undefined&&(_0x4757c5['notificationPaymentFailed']=_0x237099[_0xb3b494(0x135)]),_0x237099[_0xb3b494(0x164)]!==undefined&&(_0x4757c5['notificationRefund']=_0x237099['refund']),_0x237099[_0xb3b494(0x169)]!==undefined&&(_0x4757c5[_0xb3b494(0x153)]=_0x237099[_0xb3b494(0x169)]),_0x237099[_0xb3b494(0x129)]!==undefined&&(_0x4757c5[_0xb3b494(0x143)]=_0x237099['login']),_0x237099[_0xb3b494(0x12d)]!==undefined&&(_0x4757c5[_0xb3b494(0x14a)]=_0x237099[_0xb3b494(0x12d)]),await database_1[_0xb3b494(0x162)][_0xb3b494(0x12f)][_0xb3b494(0x13a)]({'where':{'shopId':_0x1246eb},'data':_0x4757c5});}async[a53_0x45d9e1(0x128)](_0x2e049f,_0x310c81){const _0x512dcb=a53_0x45d9e1;await this['ensureSettingsExist'](_0x2e049f);const _0x3f08de={};_0x310c81[_0x512dcb(0x12e)]!==undefined&&(_0x3f08de[_0x512dcb(0x139)]=_0x310c81['botApiKey']||null),_0x310c81[_0x512dcb(0x149)]!==undefined&&(_0x3f08de[_0x512dcb(0x156)]=_0x310c81[_0x512dcb(0x149)]||null),await database_1[_0x512dcb(0x162)][_0x512dcb(0x12f)][_0x512dcb(0x13a)]({'where':{'shopId':_0x2e049f},'data':_0x3f08de});}async[a53_0x45d9e1(0x133)](_0x5f4e22,_0xeba680){const _0x32fc07=a53_0x45d9e1;await this[_0x32fc07(0x14c)](_0x5f4e22);const _0x355e51={};_0xeba680[_0x32fc07(0x13e)]!==undefined&&(_0x355e51[_0x32fc07(0x13e)]=_0xeba680[_0x32fc07(0x13e)]||null),_0xeba680[_0x32fc07(0x12b)]!==undefined&&(_0x355e51['webhookEvents']=_0xeba680[_0x32fc07(0x12b)]||[]),await database_1['default']['shopSettings'][_0x32fc07(0x13a)]({'where':{'shopId':_0x5f4e22},'data':_0x355e51});}async['revokeAllApiKeys'](_0x527e3d){const _0x58a65d=a53_0x45d9e1,_0x398df1=_0x58a65d(0x13b)+crypto_1['default'][_0x58a65d(0x154)](0x20)[_0x58a65d(0x151)](_0x58a65d(0x163)),_0x27f7ce=_0x58a65d(0x152)+crypto_1[_0x58a65d(0x162)][_0x58a65d(0x154)](0x20)[_0x58a65d(0x151)](_0x58a65d(0x163));await database_1[_0x58a65d(0x162)][_0x58a65d(0x127)][_0x58a65d(0x13a)]({'where':{'id':_0x527e3d},'data':{'publicKey':_0x398df1,'secretKey':_0x27f7ce}});}async[a53_0x45d9e1(0x145)](_0x112dd0,_0x5d3ea8){const _0x490703=a53_0x45d9e1,{passwordConfirmation:_0x542efa}=_0x5d3ea8,_0x4309f7=await database_1[_0x490703(0x162)][_0x490703(0x127)][_0x490703(0x134)]({'where':{'id':_0x112dd0},'select':{'password':!![]}});if(!_0x4309f7)throw new Error(_0x490703(0x158));const _0x1e54df=await bcryptjs_1[_0x490703(0x162)][_0x490703(0x14e)](_0x542efa,_0x4309f7['password']);if(!_0x1e54df)throw new Error(_0x490703(0x15d));await database_1[_0x490703(0x162)]['shop'][_0x490703(0x126)]({'where':{'id':_0x112dd0}});}async[a53_0x45d9e1(0x14c)](_0x158e59){const _0x49f412=a53_0x45d9e1,_0x4195dd=await database_1[_0x49f412(0x162)][_0x49f412(0x12f)][_0x49f412(0x134)]({'where':{'shopId':_0x158e59}});!_0x4195dd&&await database_1[_0x49f412(0x162)]['shopSettings'][_0x49f412(0x148)]({'data':{'shopId':_0x158e59}});}}exports['SettingsService']=SettingsService;