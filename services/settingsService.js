'use strict';const a46_0x227784=a46_0x4c71;(function(_0x417cb9,_0x56d885){const _0x3a3c6b=a46_0x4c71,_0x582dfe=_0x417cb9();while(!![]){try{const _0x3e6748=parseInt(_0x3a3c6b(0x1be))/0x1*(-parseInt(_0x3a3c6b(0x1c2))/0x2)+-parseInt(_0x3a3c6b(0x194))/0x3+-parseInt(_0x3a3c6b(0x1a8))/0x4+-parseInt(_0x3a3c6b(0x1aa))/0x5*(parseInt(_0x3a3c6b(0x1c3))/0x6)+-parseInt(_0x3a3c6b(0x1b1))/0x7+-parseInt(_0x3a3c6b(0x1c8))/0x8*(parseInt(_0x3a3c6b(0x1cb))/0x9)+-parseInt(_0x3a3c6b(0x1d0))/0xa*(-parseInt(_0x3a3c6b(0x1b2))/0xb);if(_0x3e6748===_0x56d885)break;else _0x582dfe['push'](_0x582dfe['shift']());}catch(_0x2446ea){_0x582dfe['push'](_0x582dfe['shift']());}}}(a46_0x4ec6,0xa43c0));var __importDefault=this&&this[a46_0x227784(0x1c0)]||function(_0x1c7302){return _0x1c7302&&_0x1c7302['__esModule']?_0x1c7302:{'default':_0x1c7302};};Object[a46_0x227784(0x1b5)](exports,'__esModule',{'value':!![]}),exports[a46_0x227784(0x1ca)]=void 0x0;function a46_0x4c71(_0x57fc30,_0x2861a2){const _0x4ec66c=a46_0x4ec6();return a46_0x4c71=function(_0x4c71ec,_0x1b01dd){_0x4c71ec=_0x4c71ec-0x193;let _0x113c35=_0x4ec66c[_0x4c71ec];return _0x113c35;},a46_0x4c71(_0x57fc30,_0x2861a2);}const bcryptjs_1=__importDefault(require(a46_0x227784(0x1ba))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require(a46_0x227784(0x1ab)));class SettingsService{[a46_0x227784(0x1a4)](_0x4e9185){const _0x384b98=a46_0x227784;if(!_0x4e9185)return'';if(_0x4e9185[_0x384b98(0x1ce)]<=0x8)return _0x4e9185;const _0x354a1e=_0x4e9185[_0x384b98(0x19f)](0x0,0x8),_0x5f3ccd='*'[_0x384b98(0x199)](Math[_0x384b98(0x1cd)](0x0,_0x4e9185[_0x384b98(0x1ce)]-0x8));return _0x354a1e+_0x5f3ccd;}[a46_0x227784(0x1d5)](_0x2ba554){const _0x117d00=a46_0x227784;if(!_0x2ba554)return[];if(Array[_0x117d00(0x195)](_0x2ba554))return _0x2ba554;if(typeof _0x2ba554==='string')try{const _0x570daa=JSON['parse'](_0x2ba554);return Array[_0x117d00(0x195)](_0x570daa)?_0x570daa:[];}catch{return[];}return[];}async[a46_0x227784(0x1a6)](_0x588c9b){const _0x1991f7=a46_0x227784,_0x2bdd05=await database_1[_0x1991f7(0x1b6)][_0x1991f7(0x1cc)][_0x1991f7(0x1b8)]({'where':{'id':_0x588c9b},'include':{'settings':!![]}});if(!_0x2bdd05)throw new Error('Shop\x20not\x20found');let _0x38dd05=_0x2bdd05[_0x1991f7(0x1bd)];return!_0x38dd05&&(_0x38dd05=await database_1[_0x1991f7(0x1b6)][_0x1991f7(0x1c9)]['create']({'data':{'shopId':_0x2bdd05['id']}})),{'fullName':_0x2bdd05['name'],'brand':_0x2bdd05[_0x1991f7(0x1d2)],'merchantUrl':_0x2bdd05[_0x1991f7(0x1af)],'telegramUsername':_0x2bdd05[_0x1991f7(0x19d)],'telegramBotApiKey':_0x38dd05[_0x1991f7(0x1a1)]?this['maskApiKey'](_0x38dd05[_0x1991f7(0x1a1)]):null,'telegramChatId':_0x38dd05[_0x1991f7(0x1d1)],'webhookUrl':_0x38dd05[_0x1991f7(0x1c5)],'webhookEvents':this[_0x1991f7(0x1d5)](_0x38dd05['webhookEvents']),'notifications':{'payment_success':_0x38dd05[_0x1991f7(0x1a2)],'payment_failed':_0x38dd05[_0x1991f7(0x1b4)],'refund':_0x38dd05[_0x1991f7(0x1d3)],'payout':_0x38dd05[_0x1991f7(0x1c4)],'login':_0x38dd05[_0x1991f7(0x1ad)],'api_error':_0x38dd05['notificationApiError']}};}async[a46_0x227784(0x1ae)](_0x4f7035,_0x5d92a6){const _0x49cb21=a46_0x227784,{currentPassword:_0x2cb928,newPassword:_0x475cc3,confirmNewPassword:_0x3d8c42}=_0x5d92a6;if(_0x475cc3!==_0x3d8c42)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x475cc3['length']<0x6)throw new Error(_0x49cb21(0x1b9));const _0x513f91=await database_1[_0x49cb21(0x1b6)]['shop'][_0x49cb21(0x1b8)]({'where':{'id':_0x4f7035},'select':{'password':!![]}});if(!_0x513f91)throw new Error(_0x49cb21(0x19e));const _0x505473=await bcryptjs_1[_0x49cb21(0x1b6)][_0x49cb21(0x1c6)](_0x2cb928,_0x513f91['password']);if(!_0x505473)throw new Error(_0x49cb21(0x1a0));const _0x28a019=await bcryptjs_1[_0x49cb21(0x1b6)][_0x49cb21(0x196)](_0x475cc3,0xc);await database_1[_0x49cb21(0x1b6)]['shop'][_0x49cb21(0x1bf)]({'where':{'id':_0x4f7035},'data':{'password':_0x28a019}});}async['updateNotifications'](_0xdfba5d,_0x8cdff7){const _0x422c1e=a46_0x227784;await this[_0x422c1e(0x1a7)](_0xdfba5d);const _0x44ee25={};_0x8cdff7[_0x422c1e(0x1bc)]!==undefined&&(_0x44ee25[_0x422c1e(0x1a2)]=_0x8cdff7[_0x422c1e(0x1bc)]),_0x8cdff7[_0x422c1e(0x1c1)]!==undefined&&(_0x44ee25['notificationPaymentFailed']=_0x8cdff7['payment_failed']),_0x8cdff7[_0x422c1e(0x1bb)]!==undefined&&(_0x44ee25['notificationRefund']=_0x8cdff7[_0x422c1e(0x1bb)]),_0x8cdff7[_0x422c1e(0x1cf)]!==undefined&&(_0x44ee25['notificationPayout']=_0x8cdff7[_0x422c1e(0x1cf)]),_0x8cdff7[_0x422c1e(0x1a3)]!==undefined&&(_0x44ee25[_0x422c1e(0x1ad)]=_0x8cdff7[_0x422c1e(0x1a3)]),_0x8cdff7[_0x422c1e(0x19c)]!==undefined&&(_0x44ee25[_0x422c1e(0x193)]=_0x8cdff7['api_error']),await database_1[_0x422c1e(0x1b6)]['shopSettings'][_0x422c1e(0x1bf)]({'where':{'shopId':_0xdfba5d},'data':_0x44ee25});}async['updateTelegramSettings'](_0xf110dd,_0x3444f9){const _0x19eab4=a46_0x227784;await this[_0x19eab4(0x1a7)](_0xf110dd);const _0x5d24f4={};_0x3444f9[_0x19eab4(0x197)]!==undefined&&(_0x5d24f4[_0x19eab4(0x1a1)]=_0x3444f9[_0x19eab4(0x197)]||null),_0x3444f9[_0x19eab4(0x1d6)]!==undefined&&(_0x5d24f4['telegramChatId']=_0x3444f9[_0x19eab4(0x1d6)]||null),await database_1[_0x19eab4(0x1b6)][_0x19eab4(0x1c9)][_0x19eab4(0x1bf)]({'where':{'shopId':_0xf110dd},'data':_0x5d24f4});}async[a46_0x227784(0x1b3)](_0x11a864,_0x1e7c31){const _0x2d2f35=a46_0x227784;await this[_0x2d2f35(0x1a7)](_0x11a864);const _0x1de829={};_0x1e7c31[_0x2d2f35(0x1c5)]!==undefined&&(_0x1de829[_0x2d2f35(0x1c5)]=_0x1e7c31[_0x2d2f35(0x1c5)]||null),_0x1e7c31[_0x2d2f35(0x19a)]!==undefined&&(_0x1de829['webhookEvents']=_0x1e7c31[_0x2d2f35(0x19a)]||[]),await database_1['default'][_0x2d2f35(0x1c9)][_0x2d2f35(0x1bf)]({'where':{'shopId':_0x11a864},'data':_0x1de829});}async[a46_0x227784(0x1a5)](_0x370961){const _0x554f7f=a46_0x227784,_0x597296=_0x554f7f(0x1a9)+crypto_1[_0x554f7f(0x1b6)]['randomBytes'](0x20)[_0x554f7f(0x19b)](_0x554f7f(0x1c7)),_0x5b2620='sk_'+crypto_1[_0x554f7f(0x1b6)][_0x554f7f(0x1b0)](0x20)['toString']('hex');await database_1[_0x554f7f(0x1b6)]['shop'][_0x554f7f(0x1bf)]({'where':{'id':_0x370961},'data':{'publicKey':_0x597296,'secretKey':_0x5b2620}});}async[a46_0x227784(0x1b7)](_0x3c253b,_0x3d9de4){const _0x5e24ce=a46_0x227784,{passwordConfirmation:_0x38f2e4}=_0x3d9de4,_0x3518c0=await database_1[_0x5e24ce(0x1b6)]['shop'][_0x5e24ce(0x1b8)]({'where':{'id':_0x3c253b},'select':{'password':!![]}});if(!_0x3518c0)throw new Error('Shop\x20not\x20found');const _0x2824c5=await bcryptjs_1[_0x5e24ce(0x1b6)][_0x5e24ce(0x1c6)](_0x38f2e4,_0x3518c0['password']);if(!_0x2824c5)throw new Error(_0x5e24ce(0x1ac));await database_1['default']['shop'][_0x5e24ce(0x1d4)]({'where':{'id':_0x3c253b}});}async['ensureSettingsExist'](_0x3730fb){const _0x30127c=a46_0x227784,_0x1b038c=await database_1[_0x30127c(0x1b6)][_0x30127c(0x1c9)][_0x30127c(0x1b8)]({'where':{'shopId':_0x3730fb}});!_0x1b038c&&await database_1['default'][_0x30127c(0x1c9)][_0x30127c(0x198)]({'data':{'shopId':_0x3730fb}});}}function a46_0x4ec6(){const _0x6bf0b0=['pk_','1835sDMvxm','../config/database','Password\x20confirmation\x20is\x20incorrect','notificationLogin','changePassword','shopUrl','randomBytes','163597icXEmy','38778443jaWcFY','updateWebhookSettings','notificationPaymentFailed','defineProperty','default','deleteAccount','findUnique','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','bcryptjs','refund','payment_success','settings','1zikzeC','update','__importDefault','payment_failed','989922zomqxA','11082mmzMlT','notificationPayout','webhookUrl','compare','hex','167224kbEXsD','shopSettings','SettingsService','162cpDEAP','shop','max','length','payout','10vJhClc','telegramChatId','name','notificationRefund','delete','parseWebhookEvents','chatId','notificationApiError','1558599zPiDmX','isArray','hash','botApiKey','create','repeat','webhookEvents','toString','api_error','telegram','Shop\x20not\x20found','substring','Current\x20password\x20is\x20incorrect','telegramBotApiKey','notificationPaymentSuccess','login','maskApiKey','revokeAllApiKeys','getShopSettings','ensureSettingsExist','3042564LbttCb'];a46_0x4ec6=function(){return _0x6bf0b0;};return a46_0x4ec6();}exports[a46_0x227784(0x1ca)]=SettingsService;