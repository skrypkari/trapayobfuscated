'use strict';const a55_0x43e059=a55_0x2044;(function(_0x46a3dd,_0x3a6a48){const _0x1283e0=a55_0x2044,_0x3dd994=_0x46a3dd();while(!![]){try{const _0x293454=-parseInt(_0x1283e0(0x1b3))/0x1+-parseInt(_0x1283e0(0x1da))/0x2+-parseInt(_0x1283e0(0x1ab))/0x3*(-parseInt(_0x1283e0(0x1a0))/0x4)+parseInt(_0x1283e0(0x1c5))/0x5*(parseInt(_0x1283e0(0x1bf))/0x6)+parseInt(_0x1283e0(0x1d8))/0x7*(-parseInt(_0x1283e0(0x1dc))/0x8)+-parseInt(_0x1283e0(0x1a7))/0x9*(-parseInt(_0x1283e0(0x1a4))/0xa)+parseInt(_0x1283e0(0x1c4))/0xb;if(_0x293454===_0x3a6a48)break;else _0x3dd994['push'](_0x3dd994['shift']());}catch(_0xd76b93){_0x3dd994['push'](_0x3dd994['shift']());}}}(a55_0x8cea,0xef0bc));var __importDefault=this&&this[a55_0x43e059(0x1d6)]||function(_0x1d9a02){const _0x4a1b63=a55_0x43e059;return _0x1d9a02&&_0x1d9a02[_0x4a1b63(0x1b1)]?_0x1d9a02:{'default':_0x1d9a02};};Object[a55_0x43e059(0x1dd)](exports,a55_0x43e059(0x1b1),{'value':!![]}),exports[a55_0x43e059(0x1ad)]=void 0x0;const bcryptjs_1=__importDefault(require(a55_0x43e059(0x1b7))),crypto_1=__importDefault(require(a55_0x43e059(0x1d3))),database_1=__importDefault(require(a55_0x43e059(0x1be)));class SettingsService{['maskApiKey'](_0x1fe601){const _0x603520=a55_0x43e059;if(!_0x1fe601)return'';if(_0x1fe601[_0x603520(0x1bb)]<=0x8)return _0x1fe601;const _0x326b6e=_0x1fe601[_0x603520(0x1d7)](0x0,0x8),_0x585053='*'[_0x603520(0x1b8)](Math[_0x603520(0x1e1)](0x0,_0x1fe601[_0x603520(0x1bb)]-0x8));return _0x326b6e+_0x585053;}[a55_0x43e059(0x1cd)](_0x51a49d){const _0x327e76=a55_0x43e059;if(!_0x51a49d)return[];if(Array['isArray'](_0x51a49d))return _0x51a49d;if(typeof _0x51a49d===_0x327e76(0x1a5))try{const _0x43eb79=JSON[_0x327e76(0x1c7)](_0x51a49d);return Array[_0x327e76(0x1a8)](_0x43eb79)?_0x43eb79:[];}catch{return[];}return[];}async[a55_0x43e059(0x1c3)](_0x5920a6){const _0x1c978=a55_0x43e059,_0x83c61b=await database_1[_0x1c978(0x1cc)][_0x1c978(0x1de)][_0x1c978(0x1a6)]({'where':{'id':_0x5920a6},'include':{'settings':!![]}});if(!_0x83c61b)throw new Error(_0x1c978(0x1ca));let _0x3293f8=_0x83c61b[_0x1c978(0x1b6)];return!_0x3293f8&&(_0x3293f8=await database_1[_0x1c978(0x1cc)][_0x1c978(0x1b0)]['create']({'data':{'shopId':_0x83c61b['id']}})),{'fullName':_0x83c61b['name'],'brand':_0x83c61b[_0x1c978(0x1ce)],'merchantUrl':_0x83c61b[_0x1c978(0x1a1)],'telegramUsername':_0x83c61b['telegram'],'telegramBotApiKey':_0x3293f8[_0x1c978(0x1d5)]?this[_0x1c978(0x1af)](_0x3293f8[_0x1c978(0x1d5)]):null,'telegramChatId':_0x3293f8['telegramChatId'],'webhookUrl':_0x3293f8[_0x1c978(0x1bd)],'webhookEvents':this[_0x1c978(0x1cd)](_0x3293f8[_0x1c978(0x1ac)]),'notifications':{'payment_success':_0x3293f8['notificationPaymentSuccess'],'payment_failed':_0x3293f8['notificationPaymentFailed'],'refund':_0x3293f8[_0x1c978(0x1cf)],'payout':_0x3293f8[_0x1c978(0x1b9)],'login':_0x3293f8['notificationLogin'],'api_error':_0x3293f8[_0x1c978(0x19d)]}};}async[a55_0x43e059(0x1cb)](_0x46c287,_0x49dcb0){const _0x371352=a55_0x43e059,{currentPassword:_0x38de5e,newPassword:_0x257a27,confirmNewPassword:_0x5101d4}=_0x49dcb0;if(_0x257a27!==_0x5101d4)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x257a27[_0x371352(0x1bb)]<0x6)throw new Error(_0x371352(0x1c2));const _0x362869=await database_1[_0x371352(0x1cc)]['shop'][_0x371352(0x1a6)]({'where':{'id':_0x46c287},'select':{'password':!![]}});if(!_0x362869)throw new Error('Shop\x20not\x20found');const _0x454e18=await bcryptjs_1['default'][_0x371352(0x1d1)](_0x38de5e,_0x362869[_0x371352(0x1c6)]);if(!_0x454e18)throw new Error(_0x371352(0x1bc));const _0x39c6e0=await bcryptjs_1[_0x371352(0x1cc)][_0x371352(0x1e0)](_0x257a27,0xc);await database_1[_0x371352(0x1cc)][_0x371352(0x1de)][_0x371352(0x1ba)]({'where':{'id':_0x46c287},'data':{'password':_0x39c6e0}});}async[a55_0x43e059(0x1db)](_0x3fba21,_0x1c9775){const _0x3ec52f=a55_0x43e059;await this[_0x3ec52f(0x1c9)](_0x3fba21);const _0x235db4={};_0x1c9775[_0x3ec52f(0x1b5)]!==undefined&&(_0x235db4[_0x3ec52f(0x1d4)]=_0x1c9775[_0x3ec52f(0x1b5)]),_0x1c9775[_0x3ec52f(0x1d9)]!==undefined&&(_0x235db4['notificationPaymentFailed']=_0x1c9775['payment_failed']),_0x1c9775[_0x3ec52f(0x1aa)]!==undefined&&(_0x235db4[_0x3ec52f(0x1cf)]=_0x1c9775[_0x3ec52f(0x1aa)]),_0x1c9775[_0x3ec52f(0x1c0)]!==undefined&&(_0x235db4['notificationPayout']=_0x1c9775[_0x3ec52f(0x1c0)]),_0x1c9775['login']!==undefined&&(_0x235db4['notificationLogin']=_0x1c9775[_0x3ec52f(0x1a3)]),_0x1c9775[_0x3ec52f(0x1c8)]!==undefined&&(_0x235db4[_0x3ec52f(0x19d)]=_0x1c9775[_0x3ec52f(0x1c8)]),await database_1['default']['shopSettings']['update']({'where':{'shopId':_0x3fba21},'data':_0x235db4});}async[a55_0x43e059(0x1b4)](_0x1ad426,_0x8c0ff2){const _0x17846f=a55_0x43e059;await this['ensureSettingsExist'](_0x1ad426);const _0x5d3d74={};_0x8c0ff2[_0x17846f(0x1a9)]!==undefined&&(_0x5d3d74[_0x17846f(0x1d5)]=_0x8c0ff2[_0x17846f(0x1a9)]||null),_0x8c0ff2[_0x17846f(0x1b2)]!==undefined&&(_0x5d3d74[_0x17846f(0x1ae)]=_0x8c0ff2[_0x17846f(0x1b2)]||null),await database_1['default'][_0x17846f(0x1b0)][_0x17846f(0x1ba)]({'where':{'shopId':_0x1ad426},'data':_0x5d3d74});}async[a55_0x43e059(0x1e2)](_0x5d0151,_0x4612d1){const _0x305d27=a55_0x43e059;await this[_0x305d27(0x1c9)](_0x5d0151);const _0x4191dd={};_0x4612d1['webhookUrl']!==undefined&&(_0x4191dd['webhookUrl']=_0x4612d1[_0x305d27(0x1bd)]||null),_0x4612d1['webhookEvents']!==undefined&&(_0x4191dd['webhookEvents']=_0x4612d1[_0x305d27(0x1ac)]||[]),await database_1[_0x305d27(0x1cc)]['shopSettings'][_0x305d27(0x1ba)]({'where':{'shopId':_0x5d0151},'data':_0x4191dd});}async[a55_0x43e059(0x1df)](_0x2da961){const _0x4739a7=a55_0x43e059,_0x213fb2=_0x4739a7(0x19f)+crypto_1[_0x4739a7(0x1cc)][_0x4739a7(0x1c1)](0x20)['toString']('hex'),_0x4a707f=_0x4739a7(0x1d2)+crypto_1[_0x4739a7(0x1cc)][_0x4739a7(0x1c1)](0x20)[_0x4739a7(0x1d0)](_0x4739a7(0x19c));await database_1[_0x4739a7(0x1cc)][_0x4739a7(0x1de)][_0x4739a7(0x1ba)]({'where':{'id':_0x2da961},'data':{'publicKey':_0x213fb2,'secretKey':_0x4a707f}});}async['deleteAccount'](_0x337df9,_0x2c20ac){const _0x58b60b=a55_0x43e059,{passwordConfirmation:_0x1e78ed}=_0x2c20ac,_0x4bbf15=await database_1[_0x58b60b(0x1cc)][_0x58b60b(0x1de)]['findUnique']({'where':{'id':_0x337df9},'select':{'password':!![]}});if(!_0x4bbf15)throw new Error(_0x58b60b(0x1ca));const _0x3dccd3=await bcryptjs_1[_0x58b60b(0x1cc)]['compare'](_0x1e78ed,_0x4bbf15['password']);if(!_0x3dccd3)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1[_0x58b60b(0x1cc)][_0x58b60b(0x1de)][_0x58b60b(0x1a2)]({'where':{'id':_0x337df9}});}async[a55_0x43e059(0x1c9)](_0x1a01c4){const _0x21c22e=a55_0x43e059,_0x5c5071=await database_1[_0x21c22e(0x1cc)]['shopSettings'][_0x21c22e(0x1a6)]({'where':{'shopId':_0x1a01c4}});!_0x5c5071&&await database_1[_0x21c22e(0x1cc)][_0x21c22e(0x1b0)][_0x21c22e(0x19e)]({'data':{'shopId':_0x1a01c4}});}}function a55_0x8cea(){const _0x4e849b=['parse','api_error','ensureSettingsExist','Shop\x20not\x20found','changePassword','default','parseWebhookEvents','name','notificationRefund','toString','compare','sk_','crypto','notificationPaymentSuccess','telegramBotApiKey','__importDefault','substring','3104381OhIeGI','payment_failed','2040626gDiaHR','updateNotifications','16YyIYAN','defineProperty','shop','revokeAllApiKeys','hash','max','updateWebhookSettings','hex','notificationApiError','create','pk_','17144LjTFMd','shopUrl','delete','login','10391790iuEtls','string','findUnique','9bcjAuf','isArray','botApiKey','refund','984ZyMmyc','webhookEvents','SettingsService','telegramChatId','maskApiKey','shopSettings','__esModule','chatId','785158KGGzRp','updateTelegramSettings','payment_success','settings','bcryptjs','repeat','notificationPayout','update','length','Current\x20password\x20is\x20incorrect','webhookUrl','../config/database','6khMvWO','payout','randomBytes','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','getShopSettings','6412890xcsQgt','3217960LBZtEw','password'];a55_0x8cea=function(){return _0x4e849b;};return a55_0x8cea();}function a55_0x2044(_0x5d339a,_0x11186d){const _0x8cea6e=a55_0x8cea();return a55_0x2044=function(_0x2044fe,_0x25f772){_0x2044fe=_0x2044fe-0x19c;let _0x369d3d=_0x8cea6e[_0x2044fe];return _0x369d3d;},a55_0x2044(_0x5d339a,_0x11186d);}exports[a55_0x43e059(0x1ad)]=SettingsService;