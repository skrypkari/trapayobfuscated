'use strict';const a57_0x1d130b=a57_0x3653;(function(_0x2ec20c,_0xe05a2c){const _0x4b484f=a57_0x3653,_0x21e4d8=_0x2ec20c();while(!![]){try{const _0x77bbd=-parseInt(_0x4b484f(0x10e))/0x1*(parseInt(_0x4b484f(0x10b))/0x2)+parseInt(_0x4b484f(0xf6))/0x3+parseInt(_0x4b484f(0xf4))/0x4*(-parseInt(_0x4b484f(0xec))/0x5)+parseInt(_0x4b484f(0x115))/0x6+parseInt(_0x4b484f(0xfd))/0x7*(parseInt(_0x4b484f(0x100))/0x8)+-parseInt(_0x4b484f(0xe1))/0x9+-parseInt(_0x4b484f(0xf1))/0xa;if(_0x77bbd===_0xe05a2c)break;else _0x21e4d8['push'](_0x21e4d8['shift']());}catch(_0x249e9f){_0x21e4d8['push'](_0x21e4d8['shift']());}}}(a57_0x48ae,0x9d2fc));var __importDefault=this&&this[a57_0x1d130b(0xe5)]||function(_0x176095){const _0x1de536=a57_0x1d130b;return _0x176095&&_0x176095[_0x1de536(0xf0)]?_0x176095:{'default':_0x176095};};Object[a57_0x1d130b(0xe2)](exports,a57_0x1d130b(0xf0),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a57_0x1d130b(0x117))),crypto_1=__importDefault(require(a57_0x1d130b(0x109))),database_1=__importDefault(require(a57_0x1d130b(0xfa)));function a57_0x3653(_0x142eeb,_0x39d78b){const _0x48aed8=a57_0x48ae();return a57_0x3653=function(_0x36535d,_0x2dd0ce){_0x36535d=_0x36535d-0xd9;let _0x354106=_0x48aed8[_0x36535d];return _0x354106;},a57_0x3653(_0x142eeb,_0x39d78b);}function a57_0x48ae(){const _0x5a26e6=['hex','Current\x20password\x20is\x20incorrect','7487760zcveaQ','chatId','bcryptjs','telegramBotApiKey','parseWebhookEvents','Shop\x20not\x20found','repeat','password','getShopSettings','refund','telegramChatId','updateWebhookSettings','toString','shopUrl','updateNotifications','string','5448051cfptyc','defineProperty','login','payment_failed','__importDefault','notificationPayout','notificationRefund','Password\x20confirmation\x20is\x20incorrect','shop','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','parse','5523855hwWCja','notificationLogin','findUnique','randomBytes','__esModule','6105180vDclSa','updateTelegramSettings','isArray','4ZJGywN','notificationApiError','3359721ZhgVeB','settings','sk_','delete','../config/database','payout','webhookEvents','2485343COIEFC','ensureSettingsExist','SettingsService','16DwreYC','pk_','api_error','shopSettings','name','update','notificationPaymentFailed','notificationPaymentSuccess','compare','crypto','webhookUrl','227002FfiZfI','default','payment_success','1tAItJv','botApiKey','create','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','length'];a57_0x48ae=function(){return _0x5a26e6;};return a57_0x48ae();}class SettingsService{['maskApiKey'](_0x37e04a){const _0x39d820=a57_0x1d130b;if(!_0x37e04a)return'';if(_0x37e04a[_0x39d820(0x112)]<=0x8)return _0x37e04a;const _0x7b7058=_0x37e04a['substring'](0x0,0x8),_0x47a4c4='*'[_0x39d820(0x11b)](Math['max'](0x0,_0x37e04a[_0x39d820(0x112)]-0x8));return _0x7b7058+_0x47a4c4;}[a57_0x1d130b(0x119)](_0x400bfe){const _0x57ad83=a57_0x1d130b;if(!_0x400bfe)return[];if(Array[_0x57ad83(0xf3)](_0x400bfe))return _0x400bfe;if(typeof _0x400bfe===_0x57ad83(0xe0))try{const _0x1ec0bf=JSON[_0x57ad83(0xeb)](_0x400bfe);return Array[_0x57ad83(0xf3)](_0x1ec0bf)?_0x1ec0bf:[];}catch{return[];}return[];}async[a57_0x1d130b(0xd9)](_0x861191){const _0x3254d7=a57_0x1d130b,_0x3a118e=await database_1['default'][_0x3254d7(0xe9)][_0x3254d7(0xee)]({'where':{'id':_0x861191},'include':{'settings':!![]}});if(!_0x3a118e)throw new Error(_0x3254d7(0x11a));let _0xbd8e6d=_0x3a118e[_0x3254d7(0xf7)];return!_0xbd8e6d&&(_0xbd8e6d=await database_1[_0x3254d7(0x10c)][_0x3254d7(0x103)][_0x3254d7(0x110)]({'data':{'shopId':_0x3a118e['id']}})),{'fullName':_0x3a118e[_0x3254d7(0x104)],'brand':_0x3a118e[_0x3254d7(0x104)],'merchantUrl':_0x3a118e[_0x3254d7(0xde)],'telegramUsername':_0x3a118e['telegram'],'telegramBotApiKey':_0xbd8e6d[_0x3254d7(0x118)]?this['maskApiKey'](_0xbd8e6d['telegramBotApiKey']):null,'telegramChatId':_0xbd8e6d[_0x3254d7(0xdb)],'webhookUrl':_0xbd8e6d[_0x3254d7(0x10a)],'webhookEvents':this[_0x3254d7(0x119)](_0xbd8e6d[_0x3254d7(0xfc)]),'notifications':{'payment_success':_0xbd8e6d[_0x3254d7(0x107)],'payment_failed':_0xbd8e6d[_0x3254d7(0x106)],'refund':_0xbd8e6d[_0x3254d7(0xe7)],'payout':_0xbd8e6d[_0x3254d7(0xe6)],'login':_0xbd8e6d['notificationLogin'],'api_error':_0xbd8e6d[_0x3254d7(0xf5)]}};}async['changePassword'](_0x5b5bd6,_0x49f3f5){const _0x580c1e=a57_0x1d130b,{currentPassword:_0x478cd1,newPassword:_0x433ef7,confirmNewPassword:_0x1405d0}=_0x49f3f5;if(_0x433ef7!==_0x1405d0)throw new Error(_0x580c1e(0x111));if(_0x433ef7[_0x580c1e(0x112)]<0x6)throw new Error(_0x580c1e(0xea));const _0x51cc82=await database_1['default'][_0x580c1e(0xe9)]['findUnique']({'where':{'id':_0x5b5bd6},'select':{'password':!![]}});if(!_0x51cc82)throw new Error(_0x580c1e(0x11a));const _0x52380f=await bcryptjs_1['default']['compare'](_0x478cd1,_0x51cc82[_0x580c1e(0x11c)]);if(!_0x52380f)throw new Error(_0x580c1e(0x114));const _0x133799=await bcryptjs_1[_0x580c1e(0x10c)]['hash'](_0x433ef7,0xc);await database_1[_0x580c1e(0x10c)][_0x580c1e(0xe9)][_0x580c1e(0x105)]({'where':{'id':_0x5b5bd6},'data':{'password':_0x133799}});}async[a57_0x1d130b(0xdf)](_0x14c126,_0x237585){const _0x4db628=a57_0x1d130b;await this[_0x4db628(0xfe)](_0x14c126);const _0x4662b5={};_0x237585[_0x4db628(0x10d)]!==undefined&&(_0x4662b5[_0x4db628(0x107)]=_0x237585['payment_success']),_0x237585[_0x4db628(0xe4)]!==undefined&&(_0x4662b5[_0x4db628(0x106)]=_0x237585[_0x4db628(0xe4)]),_0x237585[_0x4db628(0xda)]!==undefined&&(_0x4662b5[_0x4db628(0xe7)]=_0x237585[_0x4db628(0xda)]),_0x237585[_0x4db628(0xfb)]!==undefined&&(_0x4662b5[_0x4db628(0xe6)]=_0x237585['payout']),_0x237585[_0x4db628(0xe3)]!==undefined&&(_0x4662b5[_0x4db628(0xed)]=_0x237585[_0x4db628(0xe3)]),_0x237585[_0x4db628(0x102)]!==undefined&&(_0x4662b5[_0x4db628(0xf5)]=_0x237585['api_error']),await database_1[_0x4db628(0x10c)][_0x4db628(0x103)][_0x4db628(0x105)]({'where':{'shopId':_0x14c126},'data':_0x4662b5});}async[a57_0x1d130b(0xf2)](_0x44e232,_0x50de8d){const _0x2b4d34=a57_0x1d130b;await this[_0x2b4d34(0xfe)](_0x44e232);const _0x53a1d5={};_0x50de8d['botApiKey']!==undefined&&(_0x53a1d5[_0x2b4d34(0x118)]=_0x50de8d[_0x2b4d34(0x10f)]||null),_0x50de8d[_0x2b4d34(0x116)]!==undefined&&(_0x53a1d5[_0x2b4d34(0xdb)]=_0x50de8d[_0x2b4d34(0x116)]||null),await database_1['default'][_0x2b4d34(0x103)]['update']({'where':{'shopId':_0x44e232},'data':_0x53a1d5});}async[a57_0x1d130b(0xdc)](_0x1a8a80,_0xa410ca){const _0x318fe4=a57_0x1d130b;await this[_0x318fe4(0xfe)](_0x1a8a80);const _0x3fd743={};_0xa410ca[_0x318fe4(0x10a)]!==undefined&&(_0x3fd743[_0x318fe4(0x10a)]=_0xa410ca[_0x318fe4(0x10a)]||null),_0xa410ca[_0x318fe4(0xfc)]!==undefined&&(_0x3fd743[_0x318fe4(0xfc)]=_0xa410ca[_0x318fe4(0xfc)]||[]),await database_1[_0x318fe4(0x10c)]['shopSettings']['update']({'where':{'shopId':_0x1a8a80},'data':_0x3fd743});}async['revokeAllApiKeys'](_0x3ca012){const _0x2f4071=a57_0x1d130b,_0x29b42a=_0x2f4071(0x101)+crypto_1['default'][_0x2f4071(0xef)](0x20)['toString'](_0x2f4071(0x113)),_0x306917=_0x2f4071(0xf8)+crypto_1[_0x2f4071(0x10c)][_0x2f4071(0xef)](0x20)[_0x2f4071(0xdd)](_0x2f4071(0x113));await database_1['default'][_0x2f4071(0xe9)][_0x2f4071(0x105)]({'where':{'id':_0x3ca012},'data':{'publicKey':_0x29b42a,'secretKey':_0x306917}});}async['deleteAccount'](_0x52ad16,_0x2d0c84){const _0x3585b5=a57_0x1d130b,{passwordConfirmation:_0x634413}=_0x2d0c84,_0x4dd25c=await database_1[_0x3585b5(0x10c)][_0x3585b5(0xe9)][_0x3585b5(0xee)]({'where':{'id':_0x52ad16},'select':{'password':!![]}});if(!_0x4dd25c)throw new Error(_0x3585b5(0x11a));const _0x5f4dce=await bcryptjs_1[_0x3585b5(0x10c)][_0x3585b5(0x108)](_0x634413,_0x4dd25c['password']);if(!_0x5f4dce)throw new Error(_0x3585b5(0xe8));await database_1[_0x3585b5(0x10c)][_0x3585b5(0xe9)][_0x3585b5(0xf9)]({'where':{'id':_0x52ad16}});}async[a57_0x1d130b(0xfe)](_0x50ff2d){const _0x4bd7ca=a57_0x1d130b,_0x468dd3=await database_1['default'][_0x4bd7ca(0x103)][_0x4bd7ca(0xee)]({'where':{'shopId':_0x50ff2d}});!_0x468dd3&&await database_1['default'][_0x4bd7ca(0x103)][_0x4bd7ca(0x110)]({'data':{'shopId':_0x50ff2d}});}}exports[a57_0x1d130b(0xff)]=SettingsService;