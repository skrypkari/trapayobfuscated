'use strict';const a51_0x1616ab=a51_0x1e55;(function(_0x321751,_0x16edd2){const _0x99776c=a51_0x1e55,_0x5c004d=_0x321751();while(!![]){try{const _0x5a7601=-parseInt(_0x99776c(0x1e7))/0x1*(parseInt(_0x99776c(0x1cc))/0x2)+-parseInt(_0x99776c(0x203))/0x3+parseInt(_0x99776c(0x1ff))/0x4+-parseInt(_0x99776c(0x20e))/0x5*(-parseInt(_0x99776c(0x201))/0x6)+parseInt(_0x99776c(0x205))/0x7*(parseInt(_0x99776c(0x1db))/0x8)+-parseInt(_0x99776c(0x1d9))/0x9+parseInt(_0x99776c(0x1ea))/0xa;if(_0x5a7601===_0x16edd2)break;else _0x5c004d['push'](_0x5c004d['shift']());}catch(_0x191c51){_0x5c004d['push'](_0x5c004d['shift']());}}}(a51_0x5d86,0xbd0f5));function a51_0x1e55(_0x56dd0d,_0x2b5de5){const _0x5d86cb=a51_0x5d86();return a51_0x1e55=function(_0x1e558f,_0x46a97f){_0x1e558f=_0x1e558f-0x1cb;let _0x109579=_0x5d86cb[_0x1e558f];return _0x109579;},a51_0x1e55(_0x56dd0d,_0x2b5de5);}var __importDefault=this&&this['__importDefault']||function(_0x103867){return _0x103867&&_0x103867['__esModule']?_0x103867:{'default':_0x103867};};Object[a51_0x1616ab(0x20f)](exports,a51_0x1616ab(0x1d3),{'value':!![]}),exports[a51_0x1616ab(0x1eb)]=void 0x0;function a51_0x5d86(){const _0x43a681=['New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','isArray','3803508YxCYym','revokeAllApiKeys','400aOHILX','notificationPayout','ensureSettingsExist','updateNotifications','delete','findUnique','bcryptjs','payment_failed','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','substring','string','parseWebhookEvents','138UiilKA','maskApiKey','Shop\x20not\x20found','7299200cWwOuM','SettingsService','telegramBotApiKey','settings','botApiKey','length','webhookUrl','shopUrl','payment_success','compare','getShopSettings','repeat','hex','notificationPaymentSuccess','updateTelegramSettings','deleteAccount','notificationApiError','shopSettings','chatId','hash','randomBytes','5274436Eqddcy','webhookEvents','7050LLhoSy','create','4537719JGrHsh','telegramChatId','59668fEWJrK','pk_','default','update','api_error','payout','notificationLogin','notificationRefund','crypto','2165XYhLjF','defineProperty','login','3970HzSwjn','Password\x20confirmation\x20is\x20incorrect','max','password','refund','parse','shop','__esModule','notificationPaymentFailed','../config/database','name'];a51_0x5d86=function(){return _0x43a681;};return a51_0x5d86();}const bcryptjs_1=__importDefault(require(a51_0x1616ab(0x1e1))),crypto_1=__importDefault(require(a51_0x1616ab(0x20d))),database_1=__importDefault(require(a51_0x1616ab(0x1d5)));class SettingsService{[a51_0x1616ab(0x1e8)](_0x5be617){const _0x2dc3b0=a51_0x1616ab;if(!_0x5be617)return'';if(_0x5be617['length']<=0x8)return _0x5be617;const _0x52c85c=_0x5be617[_0x2dc3b0(0x1e4)](0x0,0x8),_0x4864c7='*'[_0x2dc3b0(0x1f5)](Math[_0x2dc3b0(0x1ce)](0x0,_0x5be617['length']-0x8));return _0x52c85c+_0x4864c7;}['parseWebhookEvents'](_0x6865cb){const _0x43cf27=a51_0x1616ab;if(!_0x6865cb)return[];if(Array[_0x43cf27(0x1d8)](_0x6865cb))return _0x6865cb;if(typeof _0x6865cb===_0x43cf27(0x1e5))try{const _0x5e7cf7=JSON[_0x43cf27(0x1d1)](_0x6865cb);return Array[_0x43cf27(0x1d8)](_0x5e7cf7)?_0x5e7cf7:[];}catch{return[];}return[];}async[a51_0x1616ab(0x1f4)](_0x2ad0f6){const _0xfa03a=a51_0x1616ab,_0x1312ca=await database_1[_0xfa03a(0x207)][_0xfa03a(0x1d2)][_0xfa03a(0x1e0)]({'where':{'id':_0x2ad0f6},'include':{'settings':!![]}});if(!_0x1312ca)throw new Error(_0xfa03a(0x1e9));let _0x31213d=_0x1312ca[_0xfa03a(0x1ed)];return!_0x31213d&&(_0x31213d=await database_1[_0xfa03a(0x207)][_0xfa03a(0x1fb)][_0xfa03a(0x202)]({'data':{'shopId':_0x1312ca['id']}})),{'fullName':_0x1312ca['name'],'brand':_0x1312ca[_0xfa03a(0x1d6)],'merchantUrl':_0x1312ca[_0xfa03a(0x1f1)],'telegramUsername':_0x1312ca['telegram'],'telegramBotApiKey':_0x31213d[_0xfa03a(0x1ec)]?this[_0xfa03a(0x1e8)](_0x31213d[_0xfa03a(0x1ec)]):null,'telegramChatId':_0x31213d[_0xfa03a(0x204)],'webhookUrl':_0x31213d[_0xfa03a(0x1f0)],'webhookEvents':this[_0xfa03a(0x1e6)](_0x31213d[_0xfa03a(0x200)]),'notifications':{'payment_success':_0x31213d[_0xfa03a(0x1f7)],'payment_failed':_0x31213d[_0xfa03a(0x1d4)],'refund':_0x31213d[_0xfa03a(0x20c)],'payout':_0x31213d[_0xfa03a(0x1dc)],'login':_0x31213d['notificationLogin'],'api_error':_0x31213d[_0xfa03a(0x1fa)]}};}async['changePassword'](_0x3631df,_0x2180aa){const _0x52dbfd=a51_0x1616ab,{currentPassword:_0x2f6f0e,newPassword:_0x561b9a,confirmNewPassword:_0xe00c74}=_0x2180aa;if(_0x561b9a!==_0xe00c74)throw new Error(_0x52dbfd(0x1e3));if(_0x561b9a[_0x52dbfd(0x1ef)]<0x6)throw new Error(_0x52dbfd(0x1d7));const _0x5f50de=await database_1[_0x52dbfd(0x207)][_0x52dbfd(0x1d2)][_0x52dbfd(0x1e0)]({'where':{'id':_0x3631df},'select':{'password':!![]}});if(!_0x5f50de)throw new Error('Shop\x20not\x20found');const _0x5538e6=await bcryptjs_1[_0x52dbfd(0x207)][_0x52dbfd(0x1f3)](_0x2f6f0e,_0x5f50de[_0x52dbfd(0x1cf)]);if(!_0x5538e6)throw new Error('Current\x20password\x20is\x20incorrect');const _0x15dc35=await bcryptjs_1[_0x52dbfd(0x207)][_0x52dbfd(0x1fd)](_0x561b9a,0xc);await database_1['default']['shop']['update']({'where':{'id':_0x3631df},'data':{'password':_0x15dc35}});}async[a51_0x1616ab(0x1de)](_0x235d42,_0x2aefb9){const _0x1d65b1=a51_0x1616ab;await this[_0x1d65b1(0x1dd)](_0x235d42);const _0x261342={};_0x2aefb9['payment_success']!==undefined&&(_0x261342[_0x1d65b1(0x1f7)]=_0x2aefb9[_0x1d65b1(0x1f2)]),_0x2aefb9[_0x1d65b1(0x1e2)]!==undefined&&(_0x261342[_0x1d65b1(0x1d4)]=_0x2aefb9['payment_failed']),_0x2aefb9['refund']!==undefined&&(_0x261342[_0x1d65b1(0x20c)]=_0x2aefb9[_0x1d65b1(0x1d0)]),_0x2aefb9[_0x1d65b1(0x20a)]!==undefined&&(_0x261342[_0x1d65b1(0x1dc)]=_0x2aefb9['payout']),_0x2aefb9[_0x1d65b1(0x1cb)]!==undefined&&(_0x261342[_0x1d65b1(0x20b)]=_0x2aefb9[_0x1d65b1(0x1cb)]),_0x2aefb9[_0x1d65b1(0x209)]!==undefined&&(_0x261342[_0x1d65b1(0x1fa)]=_0x2aefb9[_0x1d65b1(0x209)]),await database_1[_0x1d65b1(0x207)]['shopSettings'][_0x1d65b1(0x208)]({'where':{'shopId':_0x235d42},'data':_0x261342});}async[a51_0x1616ab(0x1f8)](_0x50361b,_0x351a3f){const _0x307bdf=a51_0x1616ab;await this[_0x307bdf(0x1dd)](_0x50361b);const _0x257aac={};_0x351a3f[_0x307bdf(0x1ee)]!==undefined&&(_0x257aac[_0x307bdf(0x1ec)]=_0x351a3f[_0x307bdf(0x1ee)]||null),_0x351a3f[_0x307bdf(0x1fc)]!==undefined&&(_0x257aac[_0x307bdf(0x204)]=_0x351a3f[_0x307bdf(0x1fc)]||null),await database_1[_0x307bdf(0x207)][_0x307bdf(0x1fb)]['update']({'where':{'shopId':_0x50361b},'data':_0x257aac});}async['updateWebhookSettings'](_0x1df60b,_0x5d0c1a){const _0x56abe6=a51_0x1616ab;await this['ensureSettingsExist'](_0x1df60b);const _0x55c918={};_0x5d0c1a[_0x56abe6(0x1f0)]!==undefined&&(_0x55c918[_0x56abe6(0x1f0)]=_0x5d0c1a[_0x56abe6(0x1f0)]||null),_0x5d0c1a[_0x56abe6(0x200)]!==undefined&&(_0x55c918[_0x56abe6(0x200)]=_0x5d0c1a['webhookEvents']||[]),await database_1[_0x56abe6(0x207)][_0x56abe6(0x1fb)][_0x56abe6(0x208)]({'where':{'shopId':_0x1df60b},'data':_0x55c918});}async[a51_0x1616ab(0x1da)](_0x316eac){const _0x1dc3d3=a51_0x1616ab,_0x3d43a8=_0x1dc3d3(0x206)+crypto_1[_0x1dc3d3(0x207)][_0x1dc3d3(0x1fe)](0x20)['toString'](_0x1dc3d3(0x1f6)),_0x2933ad='sk_'+crypto_1[_0x1dc3d3(0x207)][_0x1dc3d3(0x1fe)](0x20)['toString']('hex');await database_1['default'][_0x1dc3d3(0x1d2)][_0x1dc3d3(0x208)]({'where':{'id':_0x316eac},'data':{'publicKey':_0x3d43a8,'secretKey':_0x2933ad}});}async[a51_0x1616ab(0x1f9)](_0x219f00,_0x24b131){const _0x284b74=a51_0x1616ab,{passwordConfirmation:_0x202ff1}=_0x24b131,_0x2c00ac=await database_1[_0x284b74(0x207)][_0x284b74(0x1d2)][_0x284b74(0x1e0)]({'where':{'id':_0x219f00},'select':{'password':!![]}});if(!_0x2c00ac)throw new Error(_0x284b74(0x1e9));const _0x4faf9d=await bcryptjs_1[_0x284b74(0x207)]['compare'](_0x202ff1,_0x2c00ac[_0x284b74(0x1cf)]);if(!_0x4faf9d)throw new Error(_0x284b74(0x1cd));await database_1['default'][_0x284b74(0x1d2)][_0x284b74(0x1df)]({'where':{'id':_0x219f00}});}async[a51_0x1616ab(0x1dd)](_0x419bdd){const _0x29e7c4=a51_0x1616ab,_0x3a95af=await database_1['default'][_0x29e7c4(0x1fb)][_0x29e7c4(0x1e0)]({'where':{'shopId':_0x419bdd}});!_0x3a95af&&await database_1[_0x29e7c4(0x207)][_0x29e7c4(0x1fb)]['create']({'data':{'shopId':_0x419bdd}});}}exports['SettingsService']=SettingsService;