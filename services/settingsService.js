'use strict';const a52_0x5cadd3=a52_0x26cb;function a52_0x26cb(_0x54a4fb,_0xfe71e7){const _0x20e6b6=a52_0x20e6();return a52_0x26cb=function(_0x26cbe1,_0x2d195e){_0x26cbe1=_0x26cbe1-0x1f1;let _0x34cd3d=_0x20e6b6[_0x26cbe1];return _0x34cd3d;},a52_0x26cb(_0x54a4fb,_0xfe71e7);}(function(_0xcc183d,_0x2817b3){const _0x4f7531=a52_0x26cb,_0xd1ff56=_0xcc183d();while(!![]){try{const _0x3b2ba5=-parseInt(_0x4f7531(0x229))/0x1+parseInt(_0x4f7531(0x213))/0x2+parseInt(_0x4f7531(0x20e))/0x3+parseInt(_0x4f7531(0x21c))/0x4*(-parseInt(_0x4f7531(0x1f8))/0x5)+-parseInt(_0x4f7531(0x231))/0x6*(parseInt(_0x4f7531(0x200))/0x7)+parseInt(_0x4f7531(0x1fc))/0x8*(-parseInt(_0x4f7531(0x21b))/0x9)+-parseInt(_0x4f7531(0x1fd))/0xa*(-parseInt(_0x4f7531(0x22f))/0xb);if(_0x3b2ba5===_0x2817b3)break;else _0xd1ff56['push'](_0xd1ff56['shift']());}catch(_0x435c56){_0xd1ff56['push'](_0xd1ff56['shift']());}}}(a52_0x20e6,0xc95da));function a52_0x20e6(){const _0x5a28a5=['__esModule','password','sk_','maskApiKey','compare','777673tfAdiA','crypto','payment_success','chatId','hex','shopSettings','46746469tfCOqP','updateWebhookSettings','54GQgtkD','substring','SettingsService','webhookEvents','Password\x20confirmation\x20is\x20incorrect','updateTelegramSettings','Current\x20password\x20is\x20incorrect','hash','changePassword','parseWebhookEvents','5kWMRGI','repeat','telegram','shop','12100768ChZcVh','10bhTXan','telegramBotApiKey','webhookUrl','272503rpDtaH','default','isArray','ensureSettingsExist','payout','api_error','../config/database','notificationApiError','__importDefault','notificationLogin','refund','toString','pk_','delete','1734285YPVgoA','length','string','bcryptjs','telegramChatId','15650ckqIgB','notificationPaymentSuccess','updateNotifications','findUnique','update','notificationRefund','botApiKey','parse','9vlxARZ','5480700IGDheF','login','name','Shop\x20not\x20found','notificationPayout','notificationPaymentFailed','shopUrl','create'];a52_0x20e6=function(){return _0x5a28a5;};return a52_0x20e6();}var __importDefault=this&&this[a52_0x5cadd3(0x208)]||function(_0x5d42b9){const _0x2b2586=a52_0x5cadd3;return _0x5d42b9&&_0x5d42b9[_0x2b2586(0x224)]?_0x5d42b9:{'default':_0x5d42b9};};Object['defineProperty'](exports,a52_0x5cadd3(0x224),{'value':!![]}),exports[a52_0x5cadd3(0x233)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x5cadd3(0x211))),crypto_1=__importDefault(require(a52_0x5cadd3(0x22a))),database_1=__importDefault(require(a52_0x5cadd3(0x206)));class SettingsService{[a52_0x5cadd3(0x227)](_0x53cce0){const _0x5dc5ac=a52_0x5cadd3;if(!_0x53cce0)return'';if(_0x53cce0[_0x5dc5ac(0x20f)]<=0x8)return _0x53cce0;const _0x2c5fbc=_0x53cce0[_0x5dc5ac(0x232)](0x0,0x8),_0x136ad6='*'[_0x5dc5ac(0x1f9)](Math['max'](0x0,_0x53cce0[_0x5dc5ac(0x20f)]-0x8));return _0x2c5fbc+_0x136ad6;}[a52_0x5cadd3(0x1f7)](_0x3d4f75){const _0x1cdd59=a52_0x5cadd3;if(!_0x3d4f75)return[];if(Array['isArray'](_0x3d4f75))return _0x3d4f75;if(typeof _0x3d4f75===_0x1cdd59(0x210))try{const _0x54ab28=JSON[_0x1cdd59(0x21a)](_0x3d4f75);return Array[_0x1cdd59(0x202)](_0x54ab28)?_0x54ab28:[];}catch{return[];}return[];}async['getShopSettings'](_0x83e934){const _0x3863e5=a52_0x5cadd3,_0x1ab8ea=await database_1[_0x3863e5(0x201)][_0x3863e5(0x1fb)][_0x3863e5(0x216)]({'where':{'id':_0x83e934},'include':{'settings':!![]}});if(!_0x1ab8ea)throw new Error(_0x3863e5(0x21f));let _0x2dfca7=_0x1ab8ea['settings'];return!_0x2dfca7&&(_0x2dfca7=await database_1['default'][_0x3863e5(0x22e)][_0x3863e5(0x223)]({'data':{'shopId':_0x1ab8ea['id']}})),{'fullName':_0x1ab8ea['name'],'brand':_0x1ab8ea[_0x3863e5(0x21e)],'merchantUrl':_0x1ab8ea[_0x3863e5(0x222)],'telegramUsername':_0x1ab8ea[_0x3863e5(0x1fa)],'telegramBotApiKey':_0x2dfca7[_0x3863e5(0x1fe)]?this[_0x3863e5(0x227)](_0x2dfca7['telegramBotApiKey']):null,'telegramChatId':_0x2dfca7[_0x3863e5(0x212)],'webhookUrl':_0x2dfca7['webhookUrl'],'webhookEvents':this[_0x3863e5(0x1f7)](_0x2dfca7['webhookEvents']),'notifications':{'payment_success':_0x2dfca7['notificationPaymentSuccess'],'payment_failed':_0x2dfca7[_0x3863e5(0x221)],'refund':_0x2dfca7[_0x3863e5(0x218)],'payout':_0x2dfca7[_0x3863e5(0x220)],'login':_0x2dfca7[_0x3863e5(0x209)],'api_error':_0x2dfca7[_0x3863e5(0x207)]}};}async[a52_0x5cadd3(0x1f6)](_0x4e8878,_0xd0aacc){const _0x223e2b=a52_0x5cadd3,{currentPassword:_0x51c74c,newPassword:_0x483f37,confirmNewPassword:_0x5ec7bb}=_0xd0aacc;if(_0x483f37!==_0x5ec7bb)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x483f37[_0x223e2b(0x20f)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x4f36f0=await database_1[_0x223e2b(0x201)][_0x223e2b(0x1fb)][_0x223e2b(0x216)]({'where':{'id':_0x4e8878},'select':{'password':!![]}});if(!_0x4f36f0)throw new Error('Shop\x20not\x20found');const _0x5eea5c=await bcryptjs_1[_0x223e2b(0x201)][_0x223e2b(0x228)](_0x51c74c,_0x4f36f0[_0x223e2b(0x225)]);if(!_0x5eea5c)throw new Error(_0x223e2b(0x1f4));const _0x1eaf15=await bcryptjs_1['default'][_0x223e2b(0x1f5)](_0x483f37,0xc);await database_1[_0x223e2b(0x201)]['shop'][_0x223e2b(0x217)]({'where':{'id':_0x4e8878},'data':{'password':_0x1eaf15}});}async[a52_0x5cadd3(0x215)](_0x4127e2,_0x53d399){const _0x5a8e50=a52_0x5cadd3;await this['ensureSettingsExist'](_0x4127e2);const _0xe25910={};_0x53d399[_0x5a8e50(0x22b)]!==undefined&&(_0xe25910[_0x5a8e50(0x214)]=_0x53d399['payment_success']),_0x53d399['payment_failed']!==undefined&&(_0xe25910[_0x5a8e50(0x221)]=_0x53d399['payment_failed']),_0x53d399[_0x5a8e50(0x20a)]!==undefined&&(_0xe25910[_0x5a8e50(0x218)]=_0x53d399[_0x5a8e50(0x20a)]),_0x53d399[_0x5a8e50(0x204)]!==undefined&&(_0xe25910['notificationPayout']=_0x53d399[_0x5a8e50(0x204)]),_0x53d399[_0x5a8e50(0x21d)]!==undefined&&(_0xe25910['notificationLogin']=_0x53d399['login']),_0x53d399[_0x5a8e50(0x205)]!==undefined&&(_0xe25910[_0x5a8e50(0x207)]=_0x53d399['api_error']),await database_1[_0x5a8e50(0x201)][_0x5a8e50(0x22e)][_0x5a8e50(0x217)]({'where':{'shopId':_0x4127e2},'data':_0xe25910});}async[a52_0x5cadd3(0x1f3)](_0x9332dd,_0x3a1337){const _0x2c0852=a52_0x5cadd3;await this['ensureSettingsExist'](_0x9332dd);const _0xd9b084={};_0x3a1337[_0x2c0852(0x219)]!==undefined&&(_0xd9b084[_0x2c0852(0x1fe)]=_0x3a1337[_0x2c0852(0x219)]||null),_0x3a1337[_0x2c0852(0x22c)]!==undefined&&(_0xd9b084[_0x2c0852(0x212)]=_0x3a1337['chatId']||null),await database_1['default']['shopSettings'][_0x2c0852(0x217)]({'where':{'shopId':_0x9332dd},'data':_0xd9b084});}async[a52_0x5cadd3(0x230)](_0x20c21e,_0x3370cc){const _0x31d717=a52_0x5cadd3;await this[_0x31d717(0x203)](_0x20c21e);const _0xfd6d97={};_0x3370cc[_0x31d717(0x1ff)]!==undefined&&(_0xfd6d97[_0x31d717(0x1ff)]=_0x3370cc[_0x31d717(0x1ff)]||null),_0x3370cc[_0x31d717(0x1f1)]!==undefined&&(_0xfd6d97[_0x31d717(0x1f1)]=_0x3370cc[_0x31d717(0x1f1)]||[]),await database_1[_0x31d717(0x201)][_0x31d717(0x22e)]['update']({'where':{'shopId':_0x20c21e},'data':_0xfd6d97});}async['revokeAllApiKeys'](_0xf6ef95){const _0x3c111e=a52_0x5cadd3,_0x3e5033=_0x3c111e(0x20c)+crypto_1[_0x3c111e(0x201)]['randomBytes'](0x20)[_0x3c111e(0x20b)]('hex'),_0x381e42=_0x3c111e(0x226)+crypto_1[_0x3c111e(0x201)]['randomBytes'](0x20)['toString'](_0x3c111e(0x22d));await database_1[_0x3c111e(0x201)][_0x3c111e(0x1fb)][_0x3c111e(0x217)]({'where':{'id':_0xf6ef95},'data':{'publicKey':_0x3e5033,'secretKey':_0x381e42}});}async['deleteAccount'](_0x11fd78,_0x1a7e9f){const _0x1419cb=a52_0x5cadd3,{passwordConfirmation:_0x54877b}=_0x1a7e9f,_0x3ce9eb=await database_1['default'][_0x1419cb(0x1fb)][_0x1419cb(0x216)]({'where':{'id':_0x11fd78},'select':{'password':!![]}});if(!_0x3ce9eb)throw new Error(_0x1419cb(0x21f));const _0x2bf7da=await bcryptjs_1[_0x1419cb(0x201)][_0x1419cb(0x228)](_0x54877b,_0x3ce9eb[_0x1419cb(0x225)]);if(!_0x2bf7da)throw new Error(_0x1419cb(0x1f2));await database_1[_0x1419cb(0x201)][_0x1419cb(0x1fb)][_0x1419cb(0x20d)]({'where':{'id':_0x11fd78}});}async[a52_0x5cadd3(0x203)](_0x42e5c9){const _0x45c697=a52_0x5cadd3,_0x1241cd=await database_1[_0x45c697(0x201)][_0x45c697(0x22e)][_0x45c697(0x216)]({'where':{'shopId':_0x42e5c9}});!_0x1241cd&&await database_1[_0x45c697(0x201)][_0x45c697(0x22e)]['create']({'data':{'shopId':_0x42e5c9}});}}exports[a52_0x5cadd3(0x233)]=SettingsService;