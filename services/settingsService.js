'use strict';const a52_0xba00a7=a52_0x2220;function a52_0x2220(_0x2d975c,_0x6f19f0){const _0x5187e8=a52_0x5187();return a52_0x2220=function(_0x22207a,_0x24edb5){_0x22207a=_0x22207a-0x19f;let _0x592ec6=_0x5187e8[_0x22207a];return _0x592ec6;},a52_0x2220(_0x2d975c,_0x6f19f0);}(function(_0x114c72,_0xfb3c14){const _0x1c3d21=a52_0x2220,_0x5562aa=_0x114c72();while(!![]){try{const _0x4d403c=parseInt(_0x1c3d21(0x1c2))/0x1*(-parseInt(_0x1c3d21(0x1aa))/0x2)+parseInt(_0x1c3d21(0x1c1))/0x3+-parseInt(_0x1c3d21(0x1c0))/0x4+parseInt(_0x1c3d21(0x1a3))/0x5+-parseInt(_0x1c3d21(0x1be))/0x6*(-parseInt(_0x1c3d21(0x1b8))/0x7)+-parseInt(_0x1c3d21(0x1a5))/0x8*(parseInt(_0x1c3d21(0x1b5))/0x9)+-parseInt(_0x1c3d21(0x1d6))/0xa*(-parseInt(_0x1c3d21(0x1ac))/0xb);if(_0x4d403c===_0xfb3c14)break;else _0x5562aa['push'](_0x5562aa['shift']());}catch(_0x15874f){_0x5562aa['push'](_0x5562aa['shift']());}}}(a52_0x5187,0x5623f));function a52_0x5187(){const _0x18f16b=['217327fOoHEY','toString','notificationApiError','telegramBotApiKey','isArray','webhookUrl','default','updateTelegramSettings','settings','99hnYamc','notificationRefund','length','2261iOZDqx','login','pk_','Password\x20confirmation\x20is\x20incorrect','parse','create','468ixPZmk','notificationPaymentSuccess','511864QDTMMa','314913mBdhup','1268FKkZtT','bcryptjs','ensureSettingsExist','parseWebhookEvents','payment_success','notificationPaymentFailed','chatId','compare','shop','hash','__esModule','webhookEvents','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','refund','getShopSettings','findUnique','Current\x20password\x20is\x20incorrect','SettingsService','Shop\x20not\x20found','payment_failed','310Maramt','crypto','payout','notificationLogin','defineProperty','updateNotifications','hex','shopSettings','sk_','changePassword','update','max','updateWebhookSettings','1289915MJOVSl','randomBytes','56208KdIeEW','notificationPayout','botApiKey','../config/database','repeat','698yLznYH','telegram'];a52_0x5187=function(){return _0x18f16b;};return a52_0x5187();}var __importDefault=this&&this['__importDefault']||function(_0x18b96f){const _0x2d94bd=a52_0x2220;return _0x18b96f&&_0x18b96f[_0x2d94bd(0x1cc)]?_0x18b96f:{'default':_0x18b96f};};Object[a52_0xba00a7(0x1da)](exports,a52_0xba00a7(0x1cc),{'value':!![]}),exports[a52_0xba00a7(0x1d3)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0xba00a7(0x1c3))),crypto_1=__importDefault(require(a52_0xba00a7(0x1d7))),database_1=__importDefault(require(a52_0xba00a7(0x1a8)));class SettingsService{['maskApiKey'](_0x54d8ae){const _0x35e8b2=a52_0xba00a7;if(!_0x54d8ae)return'';if(_0x54d8ae[_0x35e8b2(0x1b7)]<=0x8)return _0x54d8ae;const _0x4998ef=_0x54d8ae['substring'](0x0,0x8),_0x11854f='*'[_0x35e8b2(0x1a9)](Math[_0x35e8b2(0x1a1)](0x0,_0x54d8ae['length']-0x8));return _0x4998ef+_0x11854f;}['parseWebhookEvents'](_0x3a0ad2){const _0x1cbc07=a52_0xba00a7;if(!_0x3a0ad2)return[];if(Array[_0x1cbc07(0x1b0)](_0x3a0ad2))return _0x3a0ad2;if(typeof _0x3a0ad2==='string')try{const _0x3c59e8=JSON[_0x1cbc07(0x1bc)](_0x3a0ad2);return Array[_0x1cbc07(0x1b0)](_0x3c59e8)?_0x3c59e8:[];}catch{return[];}return[];}async[a52_0xba00a7(0x1d0)](_0x304a31){const _0x3be20e=a52_0xba00a7,_0x213f6c=await database_1[_0x3be20e(0x1b2)]['shop'][_0x3be20e(0x1d1)]({'where':{'id':_0x304a31},'include':{'settings':!![]}});if(!_0x213f6c)throw new Error(_0x3be20e(0x1d4));let _0x106677=_0x213f6c[_0x3be20e(0x1b4)];return!_0x106677&&(_0x106677=await database_1[_0x3be20e(0x1b2)][_0x3be20e(0x1dd)][_0x3be20e(0x1bd)]({'data':{'shopId':_0x213f6c['id']}})),{'fullName':_0x213f6c['name'],'brand':_0x213f6c['name'],'merchantUrl':_0x213f6c['shopUrl'],'telegramUsername':_0x213f6c[_0x3be20e(0x1ab)],'telegramBotApiKey':_0x106677[_0x3be20e(0x1af)]?this['maskApiKey'](_0x106677[_0x3be20e(0x1af)]):null,'telegramChatId':_0x106677['telegramChatId'],'webhookUrl':_0x106677[_0x3be20e(0x1b1)],'webhookEvents':this[_0x3be20e(0x1c5)](_0x106677[_0x3be20e(0x1cd)]),'notifications':{'payment_success':_0x106677['notificationPaymentSuccess'],'payment_failed':_0x106677[_0x3be20e(0x1c7)],'refund':_0x106677[_0x3be20e(0x1b6)],'payout':_0x106677[_0x3be20e(0x1a6)],'login':_0x106677['notificationLogin'],'api_error':_0x106677[_0x3be20e(0x1ae)]}};}async[a52_0xba00a7(0x19f)](_0x367b4c,_0x1b0159){const _0x10d73c=a52_0xba00a7,{currentPassword:_0x40a350,newPassword:_0x5a82d9,confirmNewPassword:_0x53aa5f}=_0x1b0159;if(_0x5a82d9!==_0x53aa5f)throw new Error(_0x10d73c(0x1ce));if(_0x5a82d9[_0x10d73c(0x1b7)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x2f24e7=await database_1[_0x10d73c(0x1b2)]['shop'][_0x10d73c(0x1d1)]({'where':{'id':_0x367b4c},'select':{'password':!![]}});if(!_0x2f24e7)throw new Error(_0x10d73c(0x1d4));const _0x544612=await bcryptjs_1[_0x10d73c(0x1b2)][_0x10d73c(0x1c9)](_0x40a350,_0x2f24e7['password']);if(!_0x544612)throw new Error(_0x10d73c(0x1d2));const _0x23b2b0=await bcryptjs_1[_0x10d73c(0x1b2)][_0x10d73c(0x1cb)](_0x5a82d9,0xc);await database_1[_0x10d73c(0x1b2)][_0x10d73c(0x1ca)][_0x10d73c(0x1a0)]({'where':{'id':_0x367b4c},'data':{'password':_0x23b2b0}});}async[a52_0xba00a7(0x1db)](_0x354238,_0x4ba304){const _0x4e89de=a52_0xba00a7;await this[_0x4e89de(0x1c4)](_0x354238);const _0x59a21c={};_0x4ba304['payment_success']!==undefined&&(_0x59a21c[_0x4e89de(0x1bf)]=_0x4ba304[_0x4e89de(0x1c6)]),_0x4ba304[_0x4e89de(0x1d5)]!==undefined&&(_0x59a21c[_0x4e89de(0x1c7)]=_0x4ba304[_0x4e89de(0x1d5)]),_0x4ba304[_0x4e89de(0x1cf)]!==undefined&&(_0x59a21c['notificationRefund']=_0x4ba304['refund']),_0x4ba304[_0x4e89de(0x1d8)]!==undefined&&(_0x59a21c[_0x4e89de(0x1a6)]=_0x4ba304[_0x4e89de(0x1d8)]),_0x4ba304[_0x4e89de(0x1b9)]!==undefined&&(_0x59a21c[_0x4e89de(0x1d9)]=_0x4ba304[_0x4e89de(0x1b9)]),_0x4ba304['api_error']!==undefined&&(_0x59a21c[_0x4e89de(0x1ae)]=_0x4ba304['api_error']),await database_1[_0x4e89de(0x1b2)][_0x4e89de(0x1dd)][_0x4e89de(0x1a0)]({'where':{'shopId':_0x354238},'data':_0x59a21c});}async[a52_0xba00a7(0x1b3)](_0xf272a9,_0x3bf84f){const _0x207949=a52_0xba00a7;await this[_0x207949(0x1c4)](_0xf272a9);const _0x2891ba={};_0x3bf84f[_0x207949(0x1a7)]!==undefined&&(_0x2891ba[_0x207949(0x1af)]=_0x3bf84f['botApiKey']||null),_0x3bf84f[_0x207949(0x1c8)]!==undefined&&(_0x2891ba['telegramChatId']=_0x3bf84f[_0x207949(0x1c8)]||null),await database_1[_0x207949(0x1b2)][_0x207949(0x1dd)][_0x207949(0x1a0)]({'where':{'shopId':_0xf272a9},'data':_0x2891ba});}async[a52_0xba00a7(0x1a2)](_0x4c14ae,_0x41f9c7){const _0x55b04d=a52_0xba00a7;await this['ensureSettingsExist'](_0x4c14ae);const _0x4ba4fd={};_0x41f9c7[_0x55b04d(0x1b1)]!==undefined&&(_0x4ba4fd['webhookUrl']=_0x41f9c7[_0x55b04d(0x1b1)]||null),_0x41f9c7['webhookEvents']!==undefined&&(_0x4ba4fd[_0x55b04d(0x1cd)]=_0x41f9c7[_0x55b04d(0x1cd)]||[]),await database_1[_0x55b04d(0x1b2)]['shopSettings'][_0x55b04d(0x1a0)]({'where':{'shopId':_0x4c14ae},'data':_0x4ba4fd});}async['revokeAllApiKeys'](_0x3721ec){const _0x26c2b6=a52_0xba00a7,_0x29ec39=_0x26c2b6(0x1ba)+crypto_1['default'][_0x26c2b6(0x1a4)](0x20)['toString'](_0x26c2b6(0x1dc)),_0x59713f=_0x26c2b6(0x1de)+crypto_1[_0x26c2b6(0x1b2)][_0x26c2b6(0x1a4)](0x20)[_0x26c2b6(0x1ad)](_0x26c2b6(0x1dc));await database_1['default'][_0x26c2b6(0x1ca)][_0x26c2b6(0x1a0)]({'where':{'id':_0x3721ec},'data':{'publicKey':_0x29ec39,'secretKey':_0x59713f}});}async['deleteAccount'](_0xd5ea89,_0x3720d9){const _0x240549=a52_0xba00a7,{passwordConfirmation:_0x53a0b5}=_0x3720d9,_0x5c057b=await database_1[_0x240549(0x1b2)][_0x240549(0x1ca)]['findUnique']({'where':{'id':_0xd5ea89},'select':{'password':!![]}});if(!_0x5c057b)throw new Error(_0x240549(0x1d4));const _0x4271b4=await bcryptjs_1[_0x240549(0x1b2)][_0x240549(0x1c9)](_0x53a0b5,_0x5c057b['password']);if(!_0x4271b4)throw new Error(_0x240549(0x1bb));await database_1[_0x240549(0x1b2)]['shop']['delete']({'where':{'id':_0xd5ea89}});}async[a52_0xba00a7(0x1c4)](_0x3d8f8b){const _0x141c9e=a52_0xba00a7,_0x2d5f8c=await database_1[_0x141c9e(0x1b2)]['shopSettings'][_0x141c9e(0x1d1)]({'where':{'shopId':_0x3d8f8b}});!_0x2d5f8c&&await database_1[_0x141c9e(0x1b2)][_0x141c9e(0x1dd)][_0x141c9e(0x1bd)]({'data':{'shopId':_0x3d8f8b}});}}exports[a52_0xba00a7(0x1d3)]=SettingsService;