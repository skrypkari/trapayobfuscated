'use strict';const a47_0x328576=a47_0x191b;(function(_0x39539e,_0x495508){const _0x48c791=a47_0x191b,_0x190f16=_0x39539e();while(!![]){try{const _0x204da8=-parseInt(_0x48c791(0x137))/0x1+parseInt(_0x48c791(0x12f))/0x2*(-parseInt(_0x48c791(0x10a))/0x3)+parseInt(_0x48c791(0x147))/0x4+-parseInt(_0x48c791(0x106))/0x5+-parseInt(_0x48c791(0x145))/0x6*(-parseInt(_0x48c791(0x136))/0x7)+parseInt(_0x48c791(0x138))/0x8*(parseInt(_0x48c791(0x143))/0x9)+-parseInt(_0x48c791(0x10c))/0xa;if(_0x204da8===_0x495508)break;else _0x190f16['push'](_0x190f16['shift']());}catch(_0x1c037e){_0x190f16['push'](_0x190f16['shift']());}}}(a47_0x3409,0x842b1));function a47_0x3409(){const _0x3d7550=['shop','chatId','hex','length','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','parseWebhookEvents','updateTelegramSettings','notificationPaymentFailed','notificationApiError','telegram','isArray','telegramChatId','sk_','updateNotifications','shopSettings','repeat','create','webhookUrl','notificationRefund','crypto','notificationPayout','__importDefault','compare','default','botApiKey','toString','maskApiKey','201094HxjDMy','revokeAllApiKeys','randomBytes','Password\x20confirmation\x20is\x20incorrect','max','payout','changePassword','7YRVomm','782377zyiYlq','6563312ZvdvrW','api_error','ensureSettingsExist','payment_success','login','notificationPaymentSuccess','getShopSettings','password','defineProperty','SettingsService','../config/database','9kAXlqd','deleteAccount','4719048VhjgfT','settings','4209992NjNzbz','string','Shop\x20not\x20found','name','findUnique','hash','substring','bcryptjs','notificationLogin','266650ntJnSH','telegramBotApiKey','refund','parse','27IYqcUh','updateWebhookSettings','3774290UBHCja','update','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','webhookEvents','pk_','__esModule','payment_failed','shopUrl'];a47_0x3409=function(){return _0x3d7550;};return a47_0x3409();}var __importDefault=this&&this[a47_0x328576(0x129)]||function(_0x440339){const _0x54d202=a47_0x328576;return _0x440339&&_0x440339[_0x54d202(0x111)]?_0x440339:{'default':_0x440339};};Object[a47_0x328576(0x140)](exports,a47_0x328576(0x111),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x328576(0x14e))),crypto_1=__importDefault(require(a47_0x328576(0x127))),database_1=__importDefault(require(a47_0x328576(0x142)));function a47_0x191b(_0x218e08,_0x264087){const _0x3409ba=a47_0x3409();return a47_0x191b=function(_0x191b6a,_0x564339){_0x191b6a=_0x191b6a-0x105;let _0x21d2c3=_0x3409ba[_0x191b6a];return _0x21d2c3;},a47_0x191b(_0x218e08,_0x264087);}class SettingsService{[a47_0x328576(0x12e)](_0x5d27c8){const _0x569221=a47_0x328576;if(!_0x5d27c8)return'';if(_0x5d27c8[_0x569221(0x117)]<=0x8)return _0x5d27c8;const _0x9aea95=_0x5d27c8[_0x569221(0x14d)](0x0,0x8),_0xbca961='*'[_0x569221(0x123)](Math[_0x569221(0x133)](0x0,_0x5d27c8['length']-0x8));return _0x9aea95+_0xbca961;}[a47_0x328576(0x119)](_0x58b5f8){const _0x1b17e1=a47_0x328576;if(!_0x58b5f8)return[];if(Array[_0x1b17e1(0x11e)](_0x58b5f8))return _0x58b5f8;if(typeof _0x58b5f8===_0x1b17e1(0x148))try{const _0x3186b2=JSON[_0x1b17e1(0x109)](_0x58b5f8);return Array[_0x1b17e1(0x11e)](_0x3186b2)?_0x3186b2:[];}catch{return[];}return[];}async[a47_0x328576(0x13e)](_0x2e0e0b){const _0x5f39f9=a47_0x328576,_0x543c8e=await database_1[_0x5f39f9(0x12b)][_0x5f39f9(0x114)][_0x5f39f9(0x14b)]({'where':{'id':_0x2e0e0b},'include':{'settings':!![]}});if(!_0x543c8e)throw new Error(_0x5f39f9(0x149));let _0x32fe2e=_0x543c8e[_0x5f39f9(0x146)];return!_0x32fe2e&&(_0x32fe2e=await database_1[_0x5f39f9(0x12b)][_0x5f39f9(0x122)]['create']({'data':{'shopId':_0x543c8e['id']}})),{'fullName':_0x543c8e['name'],'brand':_0x543c8e[_0x5f39f9(0x14a)],'merchantUrl':_0x543c8e[_0x5f39f9(0x113)],'telegramUsername':_0x543c8e[_0x5f39f9(0x11d)],'telegramBotApiKey':_0x32fe2e[_0x5f39f9(0x107)]?this[_0x5f39f9(0x12e)](_0x32fe2e[_0x5f39f9(0x107)]):null,'telegramChatId':_0x32fe2e[_0x5f39f9(0x11f)],'webhookUrl':_0x32fe2e['webhookUrl'],'webhookEvents':this[_0x5f39f9(0x119)](_0x32fe2e[_0x5f39f9(0x10f)]),'notifications':{'payment_success':_0x32fe2e[_0x5f39f9(0x13d)],'payment_failed':_0x32fe2e[_0x5f39f9(0x11b)],'refund':_0x32fe2e[_0x5f39f9(0x126)],'payout':_0x32fe2e[_0x5f39f9(0x128)],'login':_0x32fe2e[_0x5f39f9(0x105)],'api_error':_0x32fe2e['notificationApiError']}};}async[a47_0x328576(0x135)](_0x2e3508,_0x1a6b6e){const _0x362b9c=a47_0x328576,{currentPassword:_0x45343e,newPassword:_0x10d7f1,confirmNewPassword:_0x44f921}=_0x1a6b6e;if(_0x10d7f1!==_0x44f921)throw new Error(_0x362b9c(0x10e));if(_0x10d7f1[_0x362b9c(0x117)]<0x6)throw new Error(_0x362b9c(0x118));const _0x3d92c2=await database_1[_0x362b9c(0x12b)][_0x362b9c(0x114)][_0x362b9c(0x14b)]({'where':{'id':_0x2e3508},'select':{'password':!![]}});if(!_0x3d92c2)throw new Error(_0x362b9c(0x149));const _0x5c96c0=await bcryptjs_1['default'][_0x362b9c(0x12a)](_0x45343e,_0x3d92c2[_0x362b9c(0x13f)]);if(!_0x5c96c0)throw new Error('Current\x20password\x20is\x20incorrect');const _0x4007bd=await bcryptjs_1['default'][_0x362b9c(0x14c)](_0x10d7f1,0xc);await database_1[_0x362b9c(0x12b)][_0x362b9c(0x114)][_0x362b9c(0x10d)]({'where':{'id':_0x2e3508},'data':{'password':_0x4007bd}});}async[a47_0x328576(0x121)](_0x22e1a6,_0x3b4e8b){const _0x42a5d9=a47_0x328576;await this[_0x42a5d9(0x13a)](_0x22e1a6);const _0x251a2f={};_0x3b4e8b[_0x42a5d9(0x13b)]!==undefined&&(_0x251a2f[_0x42a5d9(0x13d)]=_0x3b4e8b['payment_success']),_0x3b4e8b[_0x42a5d9(0x112)]!==undefined&&(_0x251a2f[_0x42a5d9(0x11b)]=_0x3b4e8b[_0x42a5d9(0x112)]),_0x3b4e8b[_0x42a5d9(0x108)]!==undefined&&(_0x251a2f[_0x42a5d9(0x126)]=_0x3b4e8b['refund']),_0x3b4e8b[_0x42a5d9(0x134)]!==undefined&&(_0x251a2f[_0x42a5d9(0x128)]=_0x3b4e8b[_0x42a5d9(0x134)]),_0x3b4e8b['login']!==undefined&&(_0x251a2f[_0x42a5d9(0x105)]=_0x3b4e8b[_0x42a5d9(0x13c)]),_0x3b4e8b['api_error']!==undefined&&(_0x251a2f[_0x42a5d9(0x11c)]=_0x3b4e8b[_0x42a5d9(0x139)]),await database_1[_0x42a5d9(0x12b)][_0x42a5d9(0x122)]['update']({'where':{'shopId':_0x22e1a6},'data':_0x251a2f});}async[a47_0x328576(0x11a)](_0x5227a1,_0x55fce3){const _0x5524a3=a47_0x328576;await this[_0x5524a3(0x13a)](_0x5227a1);const _0x3abb7d={};_0x55fce3[_0x5524a3(0x12c)]!==undefined&&(_0x3abb7d[_0x5524a3(0x107)]=_0x55fce3[_0x5524a3(0x12c)]||null),_0x55fce3['chatId']!==undefined&&(_0x3abb7d[_0x5524a3(0x11f)]=_0x55fce3[_0x5524a3(0x115)]||null),await database_1['default']['shopSettings'][_0x5524a3(0x10d)]({'where':{'shopId':_0x5227a1},'data':_0x3abb7d});}async[a47_0x328576(0x10b)](_0x32e458,_0x3a692d){const _0x2fbc97=a47_0x328576;await this['ensureSettingsExist'](_0x32e458);const _0x30c50d={};_0x3a692d['webhookUrl']!==undefined&&(_0x30c50d['webhookUrl']=_0x3a692d[_0x2fbc97(0x125)]||null),_0x3a692d[_0x2fbc97(0x10f)]!==undefined&&(_0x30c50d[_0x2fbc97(0x10f)]=_0x3a692d['webhookEvents']||[]),await database_1[_0x2fbc97(0x12b)]['shopSettings'][_0x2fbc97(0x10d)]({'where':{'shopId':_0x32e458},'data':_0x30c50d});}async[a47_0x328576(0x130)](_0x395fea){const _0x5da6b3=a47_0x328576,_0x187c68=_0x5da6b3(0x110)+crypto_1[_0x5da6b3(0x12b)][_0x5da6b3(0x131)](0x20)[_0x5da6b3(0x12d)](_0x5da6b3(0x116)),_0x27845c=_0x5da6b3(0x120)+crypto_1[_0x5da6b3(0x12b)][_0x5da6b3(0x131)](0x20)[_0x5da6b3(0x12d)](_0x5da6b3(0x116));await database_1[_0x5da6b3(0x12b)]['shop'][_0x5da6b3(0x10d)]({'where':{'id':_0x395fea},'data':{'publicKey':_0x187c68,'secretKey':_0x27845c}});}async[a47_0x328576(0x144)](_0xf5e0e2,_0x47fda1){const _0x4ae1c1=a47_0x328576,{passwordConfirmation:_0x398a3b}=_0x47fda1,_0x53d7a0=await database_1[_0x4ae1c1(0x12b)][_0x4ae1c1(0x114)][_0x4ae1c1(0x14b)]({'where':{'id':_0xf5e0e2},'select':{'password':!![]}});if(!_0x53d7a0)throw new Error(_0x4ae1c1(0x149));const _0xe6114f=await bcryptjs_1[_0x4ae1c1(0x12b)]['compare'](_0x398a3b,_0x53d7a0['password']);if(!_0xe6114f)throw new Error(_0x4ae1c1(0x132));await database_1['default'][_0x4ae1c1(0x114)]['delete']({'where':{'id':_0xf5e0e2}});}async['ensureSettingsExist'](_0x5c0c76){const _0x4945c0=a47_0x328576,_0x65d10a=await database_1['default']['shopSettings'][_0x4945c0(0x14b)]({'where':{'shopId':_0x5c0c76}});!_0x65d10a&&await database_1['default'][_0x4945c0(0x122)][_0x4945c0(0x124)]({'data':{'shopId':_0x5c0c76}});}}exports[a47_0x328576(0x141)]=SettingsService;