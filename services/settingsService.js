'use strict';const a52_0x2b7b10=a52_0x1be2;(function(_0x58af34,_0x4352e1){const _0x270840=a52_0x1be2,_0xdd8ae6=_0x58af34();while(!![]){try{const _0x5473a5=-parseInt(_0x270840(0xd4))/0x1*(-parseInt(_0x270840(0x10c))/0x2)+-parseInt(_0x270840(0xe1))/0x3*(-parseInt(_0x270840(0x105))/0x4)+parseInt(_0x270840(0xf3))/0x5+-parseInt(_0x270840(0xdb))/0x6*(parseInt(_0x270840(0xd5))/0x7)+parseInt(_0x270840(0x115))/0x8*(parseInt(_0x270840(0xe7))/0x9)+parseInt(_0x270840(0x111))/0xa+parseInt(_0x270840(0xe6))/0xb*(-parseInt(_0x270840(0xf1))/0xc);if(_0x5473a5===_0x4352e1)break;else _0xdd8ae6['push'](_0xdd8ae6['shift']());}catch(_0x50d668){_0xdd8ae6['push'](_0xdd8ae6['shift']());}}}(a52_0x1eca,0x8ea60));function a52_0x1be2(_0x3c91a1,_0x2a1582){const _0x1ecabe=a52_0x1eca();return a52_0x1be2=function(_0x1be2e3,_0x1c3585){_0x1be2e3=_0x1be2e3-0xcf;let _0x3943b9=_0x1ecabe[_0x1be2e3];return _0x3943b9;},a52_0x1be2(_0x3c91a1,_0x2a1582);}var __importDefault=this&&this[a52_0x2b7b10(0x106)]||function(_0x20fef2){return _0x20fef2&&_0x20fef2['__esModule']?_0x20fef2:{'default':_0x20fef2};};Object[a52_0x2b7b10(0x100)](exports,a52_0x2b7b10(0xd2),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x2b7b10(0xf6))),crypto_1=__importDefault(require(a52_0x2b7b10(0xfb))),database_1=__importDefault(require(a52_0x2b7b10(0xd6)));function a52_0x1eca(){const _0x55ba2a=['29039ESnawu','14dUMNLJ','../config/database','chatId','webhookUrl','hex','default','142446lTdEQY','webhookEvents','revokeAllApiKeys','update','name','delete','2652891ECDDyQ','payment_success','notificationRefund','shopUrl','Password\x20confirmation\x20is\x20incorrect','206657MMiBiL','117fWmYsd','notificationPaymentFailed','shopSettings','compare','telegramChatId','shop','max','notificationPayout','maskApiKey','updateNotifications','1164ZnHYtg','changePassword','2610535aBtOgp','length','login','bcryptjs','payment_failed','parseWebhookEvents','deleteAccount','findUnique','crypto','Shop\x20not\x20found','refund','password','parse','defineProperty','sk_','getShopSettings','settings','updateWebhookSettings','4CKrcsP','__importDefault','create','Current\x20password\x20is\x20incorrect','SettingsService','telegramBotApiKey','pk_','46scGtPu','randomBytes','notificationLogin','ensureSettingsExist','payout','714740ZdIMvN','isArray','botApiKey','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','189744DRsBBB','notificationApiError','api_error','hash','__esModule','string'];a52_0x1eca=function(){return _0x55ba2a;};return a52_0x1eca();}class SettingsService{[a52_0x2b7b10(0xef)](_0x4f8d28){const _0x82d148=a52_0x2b7b10;if(!_0x4f8d28)return'';if(_0x4f8d28[_0x82d148(0xf4)]<=0x8)return _0x4f8d28;const _0xcfd1da=_0x4f8d28['substring'](0x0,0x8),_0x2e6c20='*'['repeat'](Math[_0x82d148(0xed)](0x0,_0x4f8d28[_0x82d148(0xf4)]-0x8));return _0xcfd1da+_0x2e6c20;}[a52_0x2b7b10(0xf8)](_0x59653f){const _0x416af9=a52_0x2b7b10;if(!_0x59653f)return[];if(Array[_0x416af9(0x112)](_0x59653f))return _0x59653f;if(typeof _0x59653f===_0x416af9(0xd3))try{const _0x260aab=JSON[_0x416af9(0xff)](_0x59653f);return Array[_0x416af9(0x112)](_0x260aab)?_0x260aab:[];}catch{return[];}return[];}async[a52_0x2b7b10(0x102)](_0x230505){const _0x4c22e7=a52_0x2b7b10,_0x2472c3=await database_1[_0x4c22e7(0xda)][_0x4c22e7(0xec)]['findUnique']({'where':{'id':_0x230505},'include':{'settings':!![]}});if(!_0x2472c3)throw new Error(_0x4c22e7(0xfc));let _0x1c9d5d=_0x2472c3[_0x4c22e7(0x103)];return!_0x1c9d5d&&(_0x1c9d5d=await database_1['default'][_0x4c22e7(0xe9)]['create']({'data':{'shopId':_0x2472c3['id']}})),{'fullName':_0x2472c3[_0x4c22e7(0xdf)],'brand':_0x2472c3[_0x4c22e7(0xdf)],'merchantUrl':_0x2472c3[_0x4c22e7(0xe4)],'telegramUsername':_0x2472c3['telegram'],'telegramBotApiKey':_0x1c9d5d['telegramBotApiKey']?this[_0x4c22e7(0xef)](_0x1c9d5d[_0x4c22e7(0x10a)]):null,'telegramChatId':_0x1c9d5d[_0x4c22e7(0xeb)],'webhookUrl':_0x1c9d5d[_0x4c22e7(0xd8)],'webhookEvents':this[_0x4c22e7(0xf8)](_0x1c9d5d[_0x4c22e7(0xdc)]),'notifications':{'payment_success':_0x1c9d5d['notificationPaymentSuccess'],'payment_failed':_0x1c9d5d[_0x4c22e7(0xe8)],'refund':_0x1c9d5d[_0x4c22e7(0xe3)],'payout':_0x1c9d5d['notificationPayout'],'login':_0x1c9d5d[_0x4c22e7(0x10e)],'api_error':_0x1c9d5d[_0x4c22e7(0xcf)]}};}async[a52_0x2b7b10(0xf2)](_0x2fbd5c,_0x495421){const _0x19f897=a52_0x2b7b10,{currentPassword:_0x3d7b37,newPassword:_0x5718a5,confirmNewPassword:_0x5c0f73}=_0x495421;if(_0x5718a5!==_0x5c0f73)throw new Error(_0x19f897(0x114));if(_0x5718a5['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x165d87=await database_1[_0x19f897(0xda)][_0x19f897(0xec)][_0x19f897(0xfa)]({'where':{'id':_0x2fbd5c},'select':{'password':!![]}});if(!_0x165d87)throw new Error(_0x19f897(0xfc));const _0x327db0=await bcryptjs_1['default'][_0x19f897(0xea)](_0x3d7b37,_0x165d87[_0x19f897(0xfe)]);if(!_0x327db0)throw new Error(_0x19f897(0x108));const _0x2e7fc5=await bcryptjs_1[_0x19f897(0xda)][_0x19f897(0xd1)](_0x5718a5,0xc);await database_1[_0x19f897(0xda)][_0x19f897(0xec)]['update']({'where':{'id':_0x2fbd5c},'data':{'password':_0x2e7fc5}});}async[a52_0x2b7b10(0xf0)](_0x418e2f,_0xcff646){const _0x1a4018=a52_0x2b7b10;await this[_0x1a4018(0x10f)](_0x418e2f);const _0x3a764d={};_0xcff646[_0x1a4018(0xe2)]!==undefined&&(_0x3a764d['notificationPaymentSuccess']=_0xcff646[_0x1a4018(0xe2)]),_0xcff646[_0x1a4018(0xf7)]!==undefined&&(_0x3a764d['notificationPaymentFailed']=_0xcff646[_0x1a4018(0xf7)]),_0xcff646[_0x1a4018(0xfd)]!==undefined&&(_0x3a764d[_0x1a4018(0xe3)]=_0xcff646['refund']),_0xcff646[_0x1a4018(0x110)]!==undefined&&(_0x3a764d[_0x1a4018(0xee)]=_0xcff646[_0x1a4018(0x110)]),_0xcff646[_0x1a4018(0xf5)]!==undefined&&(_0x3a764d[_0x1a4018(0x10e)]=_0xcff646['login']),_0xcff646[_0x1a4018(0xd0)]!==undefined&&(_0x3a764d[_0x1a4018(0xcf)]=_0xcff646[_0x1a4018(0xd0)]),await database_1[_0x1a4018(0xda)][_0x1a4018(0xe9)][_0x1a4018(0xde)]({'where':{'shopId':_0x418e2f},'data':_0x3a764d});}async['updateTelegramSettings'](_0xd781db,_0x29e003){const _0x5c5524=a52_0x2b7b10;await this['ensureSettingsExist'](_0xd781db);const _0x31828e={};_0x29e003['botApiKey']!==undefined&&(_0x31828e[_0x5c5524(0x10a)]=_0x29e003[_0x5c5524(0x113)]||null),_0x29e003['chatId']!==undefined&&(_0x31828e[_0x5c5524(0xeb)]=_0x29e003[_0x5c5524(0xd7)]||null),await database_1[_0x5c5524(0xda)][_0x5c5524(0xe9)]['update']({'where':{'shopId':_0xd781db},'data':_0x31828e});}async[a52_0x2b7b10(0x104)](_0x38abb9,_0x352b0){const _0x495656=a52_0x2b7b10;await this[_0x495656(0x10f)](_0x38abb9);const _0x1cba1e={};_0x352b0['webhookUrl']!==undefined&&(_0x1cba1e[_0x495656(0xd8)]=_0x352b0[_0x495656(0xd8)]||null),_0x352b0[_0x495656(0xdc)]!==undefined&&(_0x1cba1e[_0x495656(0xdc)]=_0x352b0[_0x495656(0xdc)]||[]),await database_1[_0x495656(0xda)]['shopSettings'][_0x495656(0xde)]({'where':{'shopId':_0x38abb9},'data':_0x1cba1e});}async[a52_0x2b7b10(0xdd)](_0x28a587){const _0x3d7298=a52_0x2b7b10,_0xa0090d=_0x3d7298(0x10b)+crypto_1[_0x3d7298(0xda)][_0x3d7298(0x10d)](0x20)['toString'](_0x3d7298(0xd9)),_0x5a5aca=_0x3d7298(0x101)+crypto_1['default'][_0x3d7298(0x10d)](0x20)['toString'](_0x3d7298(0xd9));await database_1['default'][_0x3d7298(0xec)]['update']({'where':{'id':_0x28a587},'data':{'publicKey':_0xa0090d,'secretKey':_0x5a5aca}});}async[a52_0x2b7b10(0xf9)](_0x2889d7,_0x14e34a){const _0xae0502=a52_0x2b7b10,{passwordConfirmation:_0x9fe56f}=_0x14e34a,_0x1d3351=await database_1[_0xae0502(0xda)]['shop'][_0xae0502(0xfa)]({'where':{'id':_0x2889d7},'select':{'password':!![]}});if(!_0x1d3351)throw new Error(_0xae0502(0xfc));const _0x4ad8d0=await bcryptjs_1[_0xae0502(0xda)][_0xae0502(0xea)](_0x9fe56f,_0x1d3351['password']);if(!_0x4ad8d0)throw new Error(_0xae0502(0xe5));await database_1['default'][_0xae0502(0xec)][_0xae0502(0xe0)]({'where':{'id':_0x2889d7}});}async[a52_0x2b7b10(0x10f)](_0x3fd4a8){const _0x140b12=a52_0x2b7b10,_0x4e8dc7=await database_1[_0x140b12(0xda)]['shopSettings'][_0x140b12(0xfa)]({'where':{'shopId':_0x3fd4a8}});!_0x4e8dc7&&await database_1[_0x140b12(0xda)]['shopSettings'][_0x140b12(0x107)]({'data':{'shopId':_0x3fd4a8}});}}exports[a52_0x2b7b10(0x109)]=SettingsService;