'use strict';function a51_0x3ad7(_0x3554f8,_0x55472e){const _0x3667cc=a51_0x3667();return a51_0x3ad7=function(_0x3ad776,_0x78c676){_0x3ad776=_0x3ad776-0x171;let _0x421040=_0x3667cc[_0x3ad776];return _0x421040;},a51_0x3ad7(_0x3554f8,_0x55472e);}const a51_0x9a440f=a51_0x3ad7;(function(_0x5b1272,_0x1f8c36){const _0x4e5bbd=a51_0x3ad7,_0x51aec3=_0x5b1272();while(!![]){try{const _0x2ba24=parseInt(_0x4e5bbd(0x196))/0x1*(-parseInt(_0x4e5bbd(0x175))/0x2)+parseInt(_0x4e5bbd(0x178))/0x3*(-parseInt(_0x4e5bbd(0x18e))/0x4)+-parseInt(_0x4e5bbd(0x187))/0x5+-parseInt(_0x4e5bbd(0x172))/0x6+parseInt(_0x4e5bbd(0x1a4))/0x7+-parseInt(_0x4e5bbd(0x18d))/0x8+parseInt(_0x4e5bbd(0x191))/0x9*(parseInt(_0x4e5bbd(0x1a2))/0xa);if(_0x2ba24===_0x1f8c36)break;else _0x51aec3['push'](_0x51aec3['shift']());}catch(_0x1c54bf){_0x51aec3['push'](_0x51aec3['shift']());}}}(a51_0x3667,0x832e6));var __importDefault=this&&this[a51_0x9a440f(0x182)]||function(_0x308af1){const _0x195da3=a51_0x9a440f;return _0x308af1&&_0x308af1[_0x195da3(0x173)]?_0x308af1:{'default':_0x308af1};};Object['defineProperty'](exports,a51_0x9a440f(0x173),{'value':!![]}),exports[a51_0x9a440f(0x183)]=void 0x0;const bcryptjs_1=__importDefault(require(a51_0x9a440f(0x1aa))),crypto_1=__importDefault(require(a51_0x9a440f(0x1ac))),database_1=__importDefault(require(a51_0x9a440f(0x171)));class SettingsService{[a51_0x9a440f(0x17b)](_0x1023f5){const _0x59dbfd=a51_0x9a440f;if(!_0x1023f5)return'';if(_0x1023f5[_0x59dbfd(0x1a7)]<=0x8)return _0x1023f5;const _0x14259c=_0x1023f5['substring'](0x0,0x8),_0x596daf='*'['repeat'](Math['max'](0x0,_0x1023f5['length']-0x8));return _0x14259c+_0x596daf;}[a51_0x9a440f(0x180)](_0x35332b){const _0x220073=a51_0x9a440f;if(!_0x35332b)return[];if(Array[_0x220073(0x19b)](_0x35332b))return _0x35332b;if(typeof _0x35332b==='string')try{const _0x282498=JSON[_0x220073(0x181)](_0x35332b);return Array[_0x220073(0x19b)](_0x282498)?_0x282498:[];}catch{return[];}return[];}async['getShopSettings'](_0x3be09a){const _0x3cb52e=a51_0x9a440f,_0x2de6b5=await database_1[_0x3cb52e(0x1a9)][_0x3cb52e(0x17c)][_0x3cb52e(0x1ab)]({'where':{'id':_0x3be09a},'include':{'settings':!![]}});if(!_0x2de6b5)throw new Error('Shop\x20not\x20found');let _0x5ee4bd=_0x2de6b5[_0x3cb52e(0x186)];return!_0x5ee4bd&&(_0x5ee4bd=await database_1['default'][_0x3cb52e(0x1a8)][_0x3cb52e(0x19f)]({'data':{'shopId':_0x2de6b5['id']}})),{'fullName':_0x2de6b5['name'],'brand':_0x2de6b5[_0x3cb52e(0x199)],'merchantUrl':_0x2de6b5['shopUrl'],'telegramUsername':_0x2de6b5[_0x3cb52e(0x19c)],'telegramBotApiKey':_0x5ee4bd['telegramBotApiKey']?this['maskApiKey'](_0x5ee4bd[_0x3cb52e(0x17a)]):null,'telegramChatId':_0x5ee4bd['telegramChatId'],'webhookUrl':_0x5ee4bd[_0x3cb52e(0x17f)],'webhookEvents':this[_0x3cb52e(0x180)](_0x5ee4bd[_0x3cb52e(0x1a3)]),'notifications':{'payment_success':_0x5ee4bd[_0x3cb52e(0x176)],'payment_failed':_0x5ee4bd[_0x3cb52e(0x17e)],'refund':_0x5ee4bd[_0x3cb52e(0x197)],'payout':_0x5ee4bd[_0x3cb52e(0x184)],'login':_0x5ee4bd[_0x3cb52e(0x19e)],'api_error':_0x5ee4bd[_0x3cb52e(0x195)]}};}async[a51_0x9a440f(0x188)](_0x575bfc,_0x3ae5ac){const _0x119859=a51_0x9a440f,{currentPassword:_0x130800,newPassword:_0x6e2562,confirmNewPassword:_0x58b202}=_0x3ae5ac;if(_0x6e2562!==_0x58b202)throw new Error(_0x119859(0x19d));if(_0x6e2562[_0x119859(0x1a7)]<0x6)throw new Error(_0x119859(0x179));const _0x4257c0=await database_1[_0x119859(0x1a9)][_0x119859(0x17c)][_0x119859(0x1ab)]({'where':{'id':_0x575bfc},'select':{'password':!![]}});if(!_0x4257c0)throw new Error('Shop\x20not\x20found');const _0x554260=await bcryptjs_1[_0x119859(0x1a9)][_0x119859(0x189)](_0x130800,_0x4257c0[_0x119859(0x185)]);if(!_0x554260)throw new Error('Current\x20password\x20is\x20incorrect');const _0x2e62e0=await bcryptjs_1[_0x119859(0x1a9)][_0x119859(0x19a)](_0x6e2562,0xc);await database_1['default'][_0x119859(0x17c)][_0x119859(0x177)]({'where':{'id':_0x575bfc},'data':{'password':_0x2e62e0}});}async[a51_0x9a440f(0x18f)](_0x305929,_0x49d883){const _0x5b2043=a51_0x9a440f;await this[_0x5b2043(0x198)](_0x305929);const _0x194103={};_0x49d883['payment_success']!==undefined&&(_0x194103[_0x5b2043(0x176)]=_0x49d883['payment_success']),_0x49d883[_0x5b2043(0x192)]!==undefined&&(_0x194103[_0x5b2043(0x17e)]=_0x49d883['payment_failed']),_0x49d883[_0x5b2043(0x1a5)]!==undefined&&(_0x194103[_0x5b2043(0x197)]=_0x49d883[_0x5b2043(0x1a5)]),_0x49d883[_0x5b2043(0x190)]!==undefined&&(_0x194103[_0x5b2043(0x184)]=_0x49d883[_0x5b2043(0x190)]),_0x49d883[_0x5b2043(0x18a)]!==undefined&&(_0x194103[_0x5b2043(0x19e)]=_0x49d883[_0x5b2043(0x18a)]),_0x49d883[_0x5b2043(0x1a6)]!==undefined&&(_0x194103[_0x5b2043(0x195)]=_0x49d883[_0x5b2043(0x1a6)]),await database_1[_0x5b2043(0x1a9)][_0x5b2043(0x1a8)][_0x5b2043(0x177)]({'where':{'shopId':_0x305929},'data':_0x194103});}async['updateTelegramSettings'](_0x3a96ef,_0x3d002a){const _0x4df4a7=a51_0x9a440f;await this['ensureSettingsExist'](_0x3a96ef);const _0x1eb4fa={};_0x3d002a['botApiKey']!==undefined&&(_0x1eb4fa[_0x4df4a7(0x17a)]=_0x3d002a['botApiKey']||null),_0x3d002a['chatId']!==undefined&&(_0x1eb4fa[_0x4df4a7(0x174)]=_0x3d002a[_0x4df4a7(0x1a0)]||null),await database_1[_0x4df4a7(0x1a9)][_0x4df4a7(0x1a8)][_0x4df4a7(0x177)]({'where':{'shopId':_0x3a96ef},'data':_0x1eb4fa});}async[a51_0x9a440f(0x18c)](_0x6dc6d5,_0x24cacc){const _0x535f9c=a51_0x9a440f;await this[_0x535f9c(0x198)](_0x6dc6d5);const _0x5cf7c6={};_0x24cacc[_0x535f9c(0x17f)]!==undefined&&(_0x5cf7c6[_0x535f9c(0x17f)]=_0x24cacc[_0x535f9c(0x17f)]||null),_0x24cacc['webhookEvents']!==undefined&&(_0x5cf7c6[_0x535f9c(0x1a3)]=_0x24cacc[_0x535f9c(0x1a3)]||[]),await database_1[_0x535f9c(0x1a9)]['shopSettings'][_0x535f9c(0x177)]({'where':{'shopId':_0x6dc6d5},'data':_0x5cf7c6});}async[a51_0x9a440f(0x1ad)](_0x5a735a){const _0x428389=a51_0x9a440f,_0x3f35b7=_0x428389(0x17d)+crypto_1[_0x428389(0x1a9)][_0x428389(0x1a1)](0x20)['toString'](_0x428389(0x194)),_0x5c838c=_0x428389(0x18b)+crypto_1[_0x428389(0x1a9)]['randomBytes'](0x20)['toString'](_0x428389(0x194));await database_1['default'][_0x428389(0x17c)][_0x428389(0x177)]({'where':{'id':_0x5a735a},'data':{'publicKey':_0x3f35b7,'secretKey':_0x5c838c}});}async['deleteAccount'](_0x10ecae,_0x295909){const _0x41e11a=a51_0x9a440f,{passwordConfirmation:_0x52e304}=_0x295909,_0x18c9af=await database_1[_0x41e11a(0x1a9)][_0x41e11a(0x17c)][_0x41e11a(0x1ab)]({'where':{'id':_0x10ecae},'select':{'password':!![]}});if(!_0x18c9af)throw new Error('Shop\x20not\x20found');const _0x53df95=await bcryptjs_1[_0x41e11a(0x1a9)][_0x41e11a(0x189)](_0x52e304,_0x18c9af[_0x41e11a(0x185)]);if(!_0x53df95)throw new Error(_0x41e11a(0x193));await database_1[_0x41e11a(0x1a9)]['shop']['delete']({'where':{'id':_0x10ecae}});}async[a51_0x9a440f(0x198)](_0x3c1148){const _0x15b4f6=a51_0x9a440f,_0x2eb7a8=await database_1[_0x15b4f6(0x1a9)][_0x15b4f6(0x1a8)]['findUnique']({'where':{'shopId':_0x3c1148}});!_0x2eb7a8&&await database_1[_0x15b4f6(0x1a9)]['shopSettings'][_0x15b4f6(0x19f)]({'data':{'shopId':_0x3c1148}});}}exports[a51_0x9a440f(0x183)]=SettingsService;function a51_0x3667(){const _0x4dc67e=['407670TOfGBa','webhookEvents','4339874TZoAdl','refund','api_error','length','shopSettings','default','bcryptjs','findUnique','crypto','revokeAllApiKeys','../config/database','3461988lFmZuX','__esModule','telegramChatId','11086iSnOOg','notificationPaymentSuccess','update','610455gaeYnj','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','telegramBotApiKey','maskApiKey','shop','pk_','notificationPaymentFailed','webhookUrl','parseWebhookEvents','parse','__importDefault','SettingsService','notificationPayout','password','settings','4476060trwgvE','changePassword','compare','login','sk_','updateWebhookSettings','2827192YsOIsJ','12iQWYXa','updateNotifications','payout','522ncTwVE','payment_failed','Password\x20confirmation\x20is\x20incorrect','hex','notificationApiError','2JqOIAb','notificationRefund','ensureSettingsExist','name','hash','isArray','telegram','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','notificationLogin','create','chatId','randomBytes'];a51_0x3667=function(){return _0x4dc67e;};return a51_0x3667();}