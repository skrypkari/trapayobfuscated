'use strict';const a52_0x51af19=a52_0x2760;(function(_0x2a9e6a,_0x3165c3){const _0x3b7b6b=a52_0x2760,_0x53dc78=_0x2a9e6a();while(!![]){try{const _0x7043e=-parseInt(_0x3b7b6b(0x7c))/0x1+parseInt(_0x3b7b6b(0x8a))/0x2+-parseInt(_0x3b7b6b(0xad))/0x3*(parseInt(_0x3b7b6b(0xb4))/0x4)+parseInt(_0x3b7b6b(0x86))/0x5+parseInt(_0x3b7b6b(0x94))/0x6*(parseInt(_0x3b7b6b(0x7f))/0x7)+parseInt(_0x3b7b6b(0xa3))/0x8*(-parseInt(_0x3b7b6b(0xaa))/0x9)+-parseInt(_0x3b7b6b(0xb3))/0xa*(-parseInt(_0x3b7b6b(0x7d))/0xb);if(_0x7043e===_0x3165c3)break;else _0x53dc78['push'](_0x53dc78['shift']());}catch(_0x5436a9){_0x53dc78['push'](_0x53dc78['shift']());}}}(a52_0x1ae2,0x7def5));var __importDefault=this&&this['__importDefault']||function(_0x5c7b67){const _0x4979fc=a52_0x2760;return _0x5c7b67&&_0x5c7b67[_0x4979fc(0x7e)]?_0x5c7b67:{'default':_0x5c7b67};};function a52_0x1ae2(){const _0x2a7807=['notificationPaymentFailed','bcryptjs','SettingsService','shopSettings','telegramChatId','notificationPayout','randomBytes','24gqDmrf','webhookUrl','name','hex','isArray','deleteAccount','Current\x20password\x20is\x20incorrect','shop','length','findUnique','maskApiKey','Password\x20confirmation\x20is\x20incorrect','login','botApiKey','max','16UMaMPB','api_error','notificationLogin','notificationPaymentSuccess','sk_','Shop\x20not\x20found','notificationApiError','166365zeFmUy','compare','create','1933419aQzQjF','crypto','payout','../config/database','pk_','settings','10bZWCqn','4OCyuLs','update','parseWebhookEvents','payment_success','defineProperty','telegramBotApiKey','delete','notificationRefund','substring','updateWebhookSettings','878782VKjdoh','9138151SYmYID','__esModule','897988JpBomy','toString','payment_failed','password','updateNotifications','ensureSettingsExist','hash','1808545sqnSuI','revokeAllApiKeys','updateTelegramSettings','webhookEvents','740936hVIVIL','default','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long'];a52_0x1ae2=function(){return _0x2a7807;};return a52_0x1ae2();}Object[a52_0x51af19(0xb8)](exports,a52_0x51af19(0x7e),{'value':!![]}),exports[a52_0x51af19(0x8f)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x51af19(0x8e))),crypto_1=__importDefault(require(a52_0x51af19(0xae))),database_1=__importDefault(require(a52_0x51af19(0xb0)));class SettingsService{[a52_0x51af19(0x9e)](_0x711afe){const _0x285d68=a52_0x51af19;if(!_0x711afe)return'';if(_0x711afe[_0x285d68(0x9c)]<=0x8)return _0x711afe;const _0x964461=_0x711afe[_0x285d68(0xbc)](0x0,0x8),_0x7618b='*'['repeat'](Math[_0x285d68(0xa2)](0x0,_0x711afe[_0x285d68(0x9c)]-0x8));return _0x964461+_0x7618b;}[a52_0x51af19(0xb6)](_0x47771a){const _0x1334d3=a52_0x51af19;if(!_0x47771a)return[];if(Array[_0x1334d3(0x98)](_0x47771a))return _0x47771a;if(typeof _0x47771a==='string')try{const _0x37b28e=JSON['parse'](_0x47771a);return Array[_0x1334d3(0x98)](_0x37b28e)?_0x37b28e:[];}catch{return[];}return[];}async['getShopSettings'](_0x773555){const _0x5cbb50=a52_0x51af19,_0xdd094c=await database_1[_0x5cbb50(0x8b)][_0x5cbb50(0x9b)]['findUnique']({'where':{'id':_0x773555},'include':{'settings':!![]}});if(!_0xdd094c)throw new Error('Shop\x20not\x20found');let _0x3e59af=_0xdd094c[_0x5cbb50(0xb2)];return!_0x3e59af&&(_0x3e59af=await database_1[_0x5cbb50(0x8b)][_0x5cbb50(0x90)][_0x5cbb50(0xac)]({'data':{'shopId':_0xdd094c['id']}})),{'fullName':_0xdd094c[_0x5cbb50(0x96)],'brand':_0xdd094c['name'],'merchantUrl':_0xdd094c['shopUrl'],'telegramUsername':_0xdd094c['telegram'],'telegramBotApiKey':_0x3e59af[_0x5cbb50(0xb9)]?this[_0x5cbb50(0x9e)](_0x3e59af[_0x5cbb50(0xb9)]):null,'telegramChatId':_0x3e59af['telegramChatId'],'webhookUrl':_0x3e59af[_0x5cbb50(0x95)],'webhookEvents':this[_0x5cbb50(0xb6)](_0x3e59af[_0x5cbb50(0x89)]),'notifications':{'payment_success':_0x3e59af[_0x5cbb50(0xa6)],'payment_failed':_0x3e59af[_0x5cbb50(0x8d)],'refund':_0x3e59af[_0x5cbb50(0xbb)],'payout':_0x3e59af[_0x5cbb50(0x92)],'login':_0x3e59af[_0x5cbb50(0xa5)],'api_error':_0x3e59af[_0x5cbb50(0xa9)]}};}async['changePassword'](_0x2afc0e,_0x2a7fd2){const _0x2b1a99=a52_0x51af19,{currentPassword:_0x4db86a,newPassword:_0xfcfdf6,confirmNewPassword:_0x3ef408}=_0x2a7fd2;if(_0xfcfdf6!==_0x3ef408)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0xfcfdf6[_0x2b1a99(0x9c)]<0x6)throw new Error(_0x2b1a99(0x8c));const _0x42489e=await database_1['default'][_0x2b1a99(0x9b)][_0x2b1a99(0x9d)]({'where':{'id':_0x2afc0e},'select':{'password':!![]}});if(!_0x42489e)throw new Error('Shop\x20not\x20found');const _0x2f8c60=await bcryptjs_1[_0x2b1a99(0x8b)][_0x2b1a99(0xab)](_0x4db86a,_0x42489e['password']);if(!_0x2f8c60)throw new Error(_0x2b1a99(0x9a));const _0x3dd697=await bcryptjs_1[_0x2b1a99(0x8b)][_0x2b1a99(0x85)](_0xfcfdf6,0xc);await database_1[_0x2b1a99(0x8b)][_0x2b1a99(0x9b)]['update']({'where':{'id':_0x2afc0e},'data':{'password':_0x3dd697}});}async[a52_0x51af19(0x83)](_0x2a65e0,_0x10bbdc){const _0x5b10e7=a52_0x51af19;await this[_0x5b10e7(0x84)](_0x2a65e0);const _0x50506b={};_0x10bbdc[_0x5b10e7(0xb7)]!==undefined&&(_0x50506b[_0x5b10e7(0xa6)]=_0x10bbdc[_0x5b10e7(0xb7)]),_0x10bbdc[_0x5b10e7(0x81)]!==undefined&&(_0x50506b[_0x5b10e7(0x8d)]=_0x10bbdc[_0x5b10e7(0x81)]),_0x10bbdc['refund']!==undefined&&(_0x50506b[_0x5b10e7(0xbb)]=_0x10bbdc['refund']),_0x10bbdc[_0x5b10e7(0xaf)]!==undefined&&(_0x50506b['notificationPayout']=_0x10bbdc[_0x5b10e7(0xaf)]),_0x10bbdc[_0x5b10e7(0xa0)]!==undefined&&(_0x50506b[_0x5b10e7(0xa5)]=_0x10bbdc['login']),_0x10bbdc[_0x5b10e7(0xa4)]!==undefined&&(_0x50506b['notificationApiError']=_0x10bbdc[_0x5b10e7(0xa4)]),await database_1['default']['shopSettings'][_0x5b10e7(0xb5)]({'where':{'shopId':_0x2a65e0},'data':_0x50506b});}async[a52_0x51af19(0x88)](_0x2f9478,_0x4da2e9){const _0x42344d=a52_0x51af19;await this[_0x42344d(0x84)](_0x2f9478);const _0x14b4ff={};_0x4da2e9['botApiKey']!==undefined&&(_0x14b4ff['telegramBotApiKey']=_0x4da2e9[_0x42344d(0xa1)]||null),_0x4da2e9['chatId']!==undefined&&(_0x14b4ff[_0x42344d(0x91)]=_0x4da2e9['chatId']||null),await database_1['default'][_0x42344d(0x90)][_0x42344d(0xb5)]({'where':{'shopId':_0x2f9478},'data':_0x14b4ff});}async[a52_0x51af19(0xbd)](_0x238c21,_0x3ff44c){const _0x482371=a52_0x51af19;await this['ensureSettingsExist'](_0x238c21);const _0x325a1c={};_0x3ff44c[_0x482371(0x95)]!==undefined&&(_0x325a1c[_0x482371(0x95)]=_0x3ff44c['webhookUrl']||null),_0x3ff44c[_0x482371(0x89)]!==undefined&&(_0x325a1c[_0x482371(0x89)]=_0x3ff44c[_0x482371(0x89)]||[]),await database_1[_0x482371(0x8b)][_0x482371(0x90)]['update']({'where':{'shopId':_0x238c21},'data':_0x325a1c});}async[a52_0x51af19(0x87)](_0x30e0d7){const _0x220d00=a52_0x51af19,_0x45cbb8=_0x220d00(0xb1)+crypto_1['default'][_0x220d00(0x93)](0x20)[_0x220d00(0x80)](_0x220d00(0x97)),_0x599d87=_0x220d00(0xa7)+crypto_1[_0x220d00(0x8b)][_0x220d00(0x93)](0x20)[_0x220d00(0x80)](_0x220d00(0x97));await database_1[_0x220d00(0x8b)][_0x220d00(0x9b)][_0x220d00(0xb5)]({'where':{'id':_0x30e0d7},'data':{'publicKey':_0x45cbb8,'secretKey':_0x599d87}});}async[a52_0x51af19(0x99)](_0x260865,_0x425f5d){const _0x252904=a52_0x51af19,{passwordConfirmation:_0x209c39}=_0x425f5d,_0x5c7e43=await database_1[_0x252904(0x8b)][_0x252904(0x9b)]['findUnique']({'where':{'id':_0x260865},'select':{'password':!![]}});if(!_0x5c7e43)throw new Error(_0x252904(0xa8));const _0x171990=await bcryptjs_1[_0x252904(0x8b)][_0x252904(0xab)](_0x209c39,_0x5c7e43[_0x252904(0x82)]);if(!_0x171990)throw new Error(_0x252904(0x9f));await database_1[_0x252904(0x8b)]['shop'][_0x252904(0xba)]({'where':{'id':_0x260865}});}async['ensureSettingsExist'](_0x30768a){const _0x313af6=a52_0x51af19,_0x1ee6b1=await database_1['default']['shopSettings']['findUnique']({'where':{'shopId':_0x30768a}});!_0x1ee6b1&&await database_1[_0x313af6(0x8b)][_0x313af6(0x90)][_0x313af6(0xac)]({'data':{'shopId':_0x30768a}});}}function a52_0x2760(_0xbbcdb6,_0xbce858){const _0x1ae243=a52_0x1ae2();return a52_0x2760=function(_0x276015,_0x1e2d41){_0x276015=_0x276015-0x7c;let _0x39bc6d=_0x1ae243[_0x276015];return _0x39bc6d;},a52_0x2760(_0xbbcdb6,_0xbce858);}exports[a52_0x51af19(0x8f)]=SettingsService;