'use strict';const a47_0x2f28cf=a47_0x3ba0;(function(_0x71f3bb,_0x4ab325){const _0x281f0b=a47_0x3ba0,_0x2cd1fc=_0x71f3bb();while(!![]){try{const _0x4e6b89=-parseInt(_0x281f0b(0x9f))/0x1*(-parseInt(_0x281f0b(0xa3))/0x2)+-parseInt(_0x281f0b(0xd7))/0x3+parseInt(_0x281f0b(0xb2))/0x4*(-parseInt(_0x281f0b(0xb4))/0x5)+-parseInt(_0x281f0b(0xcc))/0x6*(-parseInt(_0x281f0b(0xc2))/0x7)+parseInt(_0x281f0b(0xc1))/0x8*(-parseInt(_0x281f0b(0xc6))/0x9)+-parseInt(_0x281f0b(0x9b))/0xa*(parseInt(_0x281f0b(0xac))/0xb)+-parseInt(_0x281f0b(0xb3))/0xc*(-parseInt(_0x281f0b(0xbd))/0xd);if(_0x4e6b89===_0x4ab325)break;else _0x2cd1fc['push'](_0x2cd1fc['shift']());}catch(_0x281bae){_0x2cd1fc['push'](_0x2cd1fc['shift']());}}}(a47_0x84ca,0x463bc));var __importDefault=this&&this[a47_0x2f28cf(0x9c)]||function(_0x1c47bc){return _0x1c47bc&&_0x1c47bc['__esModule']?_0x1c47bc:{'default':_0x1c47bc};};function a47_0x3ba0(_0x5e4aa1,_0x375257){const _0x84ca95=a47_0x84ca();return a47_0x3ba0=function(_0x3ba0bc,_0x13bc2a){_0x3ba0bc=_0x3ba0bc-0x9b;let _0x23880d=_0x84ca95[_0x3ba0bc];return _0x23880d;},a47_0x3ba0(_0x5e4aa1,_0x375257);}Object[a47_0x2f28cf(0xab)](exports,a47_0x2f28cf(0xd9),{'value':!![]}),exports[a47_0x2f28cf(0xa0)]=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x2f28cf(0xaf))),crypto_1=__importDefault(require('crypto')),database_1=__importDefault(require('../config/database'));class SettingsService{['maskApiKey'](_0x4c8c4){const _0x34ffb7=a47_0x2f28cf;if(!_0x4c8c4)return'';if(_0x4c8c4[_0x34ffb7(0xdc)]<=0x8)return _0x4c8c4;const _0x4750d6=_0x4c8c4[_0x34ffb7(0xa4)](0x0,0x8),_0x89f734='*'[_0x34ffb7(0xdb)](Math[_0x34ffb7(0xb8)](0x0,_0x4c8c4['length']-0x8));return _0x4750d6+_0x89f734;}['parseWebhookEvents'](_0x3ef090){const _0x7c1d9a=a47_0x2f28cf;if(!_0x3ef090)return[];if(Array[_0x7c1d9a(0xb9)](_0x3ef090))return _0x3ef090;if(typeof _0x3ef090===_0x7c1d9a(0xb5))try{const _0xa2dcd9=JSON[_0x7c1d9a(0xb0)](_0x3ef090);return Array[_0x7c1d9a(0xb9)](_0xa2dcd9)?_0xa2dcd9:[];}catch{return[];}return[];}async[a47_0x2f28cf(0xb7)](_0x5262da){const _0x14c2a1=a47_0x2f28cf,_0x471939=await database_1[_0x14c2a1(0xd2)][_0x14c2a1(0xa2)]['findUnique']({'where':{'id':_0x5262da},'include':{'settings':!![]}});if(!_0x471939)throw new Error('Shop\x20not\x20found');let _0x2876db=_0x471939[_0x14c2a1(0xc4)];return!_0x2876db&&(_0x2876db=await database_1[_0x14c2a1(0xd2)][_0x14c2a1(0xa5)][_0x14c2a1(0xc9)]({'data':{'shopId':_0x471939['id']}})),{'fullName':_0x471939[_0x14c2a1(0xaa)],'brand':_0x471939[_0x14c2a1(0xaa)],'merchantUrl':_0x471939[_0x14c2a1(0xd8)],'telegramUsername':_0x471939['telegram'],'telegramBotApiKey':_0x2876db[_0x14c2a1(0x9e)]?this['maskApiKey'](_0x2876db[_0x14c2a1(0x9e)]):null,'telegramChatId':_0x2876db['telegramChatId'],'webhookUrl':_0x2876db[_0x14c2a1(0xbe)],'webhookEvents':this[_0x14c2a1(0xc8)](_0x2876db[_0x14c2a1(0xad)]),'notifications':{'payment_success':_0x2876db['notificationPaymentSuccess'],'payment_failed':_0x2876db[_0x14c2a1(0xbf)],'refund':_0x2876db[_0x14c2a1(0xc0)],'payout':_0x2876db[_0x14c2a1(0xd6)],'login':_0x2876db[_0x14c2a1(0xa7)],'api_error':_0x2876db['notificationApiError']}};}async['changePassword'](_0x1d161f,_0x3791df){const _0x6b689a=a47_0x2f28cf,{currentPassword:_0xeb9df,newPassword:_0x332dfa,confirmNewPassword:_0x149522}=_0x3791df;if(_0x332dfa!==_0x149522)throw new Error(_0x6b689a(0xcb));if(_0x332dfa[_0x6b689a(0xdc)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x359398=await database_1[_0x6b689a(0xd2)][_0x6b689a(0xa2)][_0x6b689a(0xba)]({'where':{'id':_0x1d161f},'select':{'password':!![]}});if(!_0x359398)throw new Error(_0x6b689a(0xce));const _0x3bfa86=await bcryptjs_1[_0x6b689a(0xd2)][_0x6b689a(0xae)](_0xeb9df,_0x359398['password']);if(!_0x3bfa86)throw new Error('Current\x20password\x20is\x20incorrect');const _0x345256=await bcryptjs_1[_0x6b689a(0xd2)][_0x6b689a(0xb6)](_0x332dfa,0xc);await database_1['default'][_0x6b689a(0xa2)][_0x6b689a(0xb1)]({'where':{'id':_0x1d161f},'data':{'password':_0x345256}});}async['updateNotifications'](_0x15d787,_0x2ff11b){const _0x7a8c8e=a47_0x2f28cf;await this[_0x7a8c8e(0xa9)](_0x15d787);const _0x1bd140={};_0x2ff11b[_0x7a8c8e(0xd1)]!==undefined&&(_0x1bd140[_0x7a8c8e(0xa6)]=_0x2ff11b[_0x7a8c8e(0xd1)]),_0x2ff11b[_0x7a8c8e(0xc7)]!==undefined&&(_0x1bd140[_0x7a8c8e(0xbf)]=_0x2ff11b[_0x7a8c8e(0xc7)]),_0x2ff11b[_0x7a8c8e(0xdd)]!==undefined&&(_0x1bd140[_0x7a8c8e(0xc0)]=_0x2ff11b['refund']),_0x2ff11b[_0x7a8c8e(0xda)]!==undefined&&(_0x1bd140[_0x7a8c8e(0xd6)]=_0x2ff11b[_0x7a8c8e(0xda)]),_0x2ff11b['login']!==undefined&&(_0x1bd140[_0x7a8c8e(0xa7)]=_0x2ff11b[_0x7a8c8e(0xca)]),_0x2ff11b[_0x7a8c8e(0x9d)]!==undefined&&(_0x1bd140[_0x7a8c8e(0xa1)]=_0x2ff11b[_0x7a8c8e(0x9d)]),await database_1[_0x7a8c8e(0xd2)][_0x7a8c8e(0xa5)][_0x7a8c8e(0xb1)]({'where':{'shopId':_0x15d787},'data':_0x1bd140});}async['updateTelegramSettings'](_0x34fb03,_0x4fc69f){const _0x27cc02=a47_0x2f28cf;await this[_0x27cc02(0xa9)](_0x34fb03);const _0x1ba1d6={};_0x4fc69f[_0x27cc02(0xd5)]!==undefined&&(_0x1ba1d6[_0x27cc02(0x9e)]=_0x4fc69f[_0x27cc02(0xd5)]||null),_0x4fc69f['chatId']!==undefined&&(_0x1ba1d6[_0x27cc02(0xd0)]=_0x4fc69f['chatId']||null),await database_1[_0x27cc02(0xd2)][_0x27cc02(0xa5)][_0x27cc02(0xb1)]({'where':{'shopId':_0x34fb03},'data':_0x1ba1d6});}async[a47_0x2f28cf(0xd3)](_0xe90c87,_0x3c6af3){const _0x4d2aa5=a47_0x2f28cf;await this[_0x4d2aa5(0xa9)](_0xe90c87);const _0x4ebf79={};_0x3c6af3[_0x4d2aa5(0xbe)]!==undefined&&(_0x4ebf79[_0x4d2aa5(0xbe)]=_0x3c6af3[_0x4d2aa5(0xbe)]||null),_0x3c6af3[_0x4d2aa5(0xad)]!==undefined&&(_0x4ebf79[_0x4d2aa5(0xad)]=_0x3c6af3['webhookEvents']||[]),await database_1['default'][_0x4d2aa5(0xa5)][_0x4d2aa5(0xb1)]({'where':{'shopId':_0xe90c87},'data':_0x4ebf79});}async[a47_0x2f28cf(0xc5)](_0x4e2106){const _0x2dab1c=a47_0x2f28cf,_0x2022e8=_0x2dab1c(0xa8)+crypto_1['default']['randomBytes'](0x20)[_0x2dab1c(0xbb)](_0x2dab1c(0xc3)),_0x3d0cd2='sk_'+crypto_1[_0x2dab1c(0xd2)][_0x2dab1c(0xbc)](0x20)['toString'](_0x2dab1c(0xc3));await database_1[_0x2dab1c(0xd2)][_0x2dab1c(0xa2)][_0x2dab1c(0xb1)]({'where':{'id':_0x4e2106},'data':{'publicKey':_0x2022e8,'secretKey':_0x3d0cd2}});}async[a47_0x2f28cf(0xd4)](_0x1bfebe,_0x5f572b){const _0x37a808=a47_0x2f28cf,{passwordConfirmation:_0xe52e33}=_0x5f572b,_0x27792d=await database_1[_0x37a808(0xd2)][_0x37a808(0xa2)]['findUnique']({'where':{'id':_0x1bfebe},'select':{'password':!![]}});if(!_0x27792d)throw new Error(_0x37a808(0xce));const _0x3f4e45=await bcryptjs_1['default'][_0x37a808(0xae)](_0xe52e33,_0x27792d['password']);if(!_0x3f4e45)throw new Error(_0x37a808(0xcf));await database_1[_0x37a808(0xd2)][_0x37a808(0xa2)][_0x37a808(0xcd)]({'where':{'id':_0x1bfebe}});}async['ensureSettingsExist'](_0x339d14){const _0x5d5652=a47_0x2f28cf,_0x3424cb=await database_1['default'][_0x5d5652(0xa5)][_0x5d5652(0xba)]({'where':{'shopId':_0x339d14}});!_0x3424cb&&await database_1[_0x5d5652(0xd2)][_0x5d5652(0xa5)][_0x5d5652(0xc9)]({'data':{'shopId':_0x339d14}});}}function a47_0x84ca(){const _0x687b75=['ensureSettingsExist','name','defineProperty','121JxaKTF','webhookEvents','compare','bcryptjs','parse','update','260PCmuxv','24unEjHq','12605HeYveT','string','hash','getShopSettings','max','isArray','findUnique','toString','randomBytes','3372252JkfvRc','webhookUrl','notificationPaymentFailed','notificationRefund','46336GoDcuj','2422enQOlt','hex','settings','revokeAllApiKeys','180SinITW','payment_failed','parseWebhookEvents','create','login','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','6294cQqHtk','delete','Shop\x20not\x20found','Password\x20confirmation\x20is\x20incorrect','telegramChatId','payment_success','default','updateWebhookSettings','deleteAccount','botApiKey','notificationPayout','602985fxopcs','shopUrl','__esModule','payout','repeat','length','refund','455330hfAoka','__importDefault','api_error','telegramBotApiKey','381WBLpyY','SettingsService','notificationApiError','shop','2034jMaWHg','substring','shopSettings','notificationPaymentSuccess','notificationLogin','pk_'];a47_0x84ca=function(){return _0x687b75;};return a47_0x84ca();}exports[a47_0x2f28cf(0xa0)]=SettingsService;