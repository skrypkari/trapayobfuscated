'use strict';const a64_0x106167=a64_0x59bb;function a64_0x59bb(_0x5b0815,_0x443855){const _0x5032c9=a64_0x5032();return a64_0x59bb=function(_0x59bb45,_0x16aaa2){_0x59bb45=_0x59bb45-0xe2;let _0x4bf86c=_0x5032c9[_0x59bb45];return _0x4bf86c;},a64_0x59bb(_0x5b0815,_0x443855);}function a64_0x5032(){const _0x22bf85=['__importDefault','max','ensureSettingsExist','4859561zzYRRY','Password\x20confirmation\x20is\x20incorrect','defineProperty','api_error','toString','randomBytes','notificationPaymentFailed','webhookEvents','pk_','name','password','notificationLogin','10670LEcdmt','shop','payment_failed','substring','update','chatId','length','9ShjtQj','revokeAllApiKeys','7239992AHZFdG','hash','compare','1865358khfkGq','botApiKey','33qLmaHM','changePassword','payment_success','isArray','1148102hIqQzQ','updateNotifications','parse','378430vePKzq','notificationRefund','shopSettings','maskApiKey','sk_','2KwnkgO','create','webhookUrl','telegram','notificationPaymentSuccess','notificationApiError','default','hex','2008ohTfdN','findUnique','repeat','bcryptjs','notificationPayout','login','crypto','shopUrl','18241596ZioVhy','Shop\x20not\x20found','6IxxLzK','__esModule','settings','string','SettingsService','telegramBotApiKey','delete','parseWebhookEvents','payout'];a64_0x5032=function(){return _0x22bf85;};return a64_0x5032();}(function(_0x239e3b,_0x1a354a){const _0x2f1825=a64_0x59bb,_0x4da37a=_0x239e3b();while(!![]){try{const _0x1d28ba=-parseInt(_0x2f1825(0x123))/0x1*(-parseInt(_0x2f1825(0xe7))/0x2)+-parseInt(_0x2f1825(0x11d))/0x3+-parseInt(_0x2f1825(0xef))/0x4*(parseInt(_0x2f1825(0x111))/0x5)+-parseInt(_0x2f1825(0xf9))/0x6*(-parseInt(_0x2f1825(0x105))/0x7)+-parseInt(_0x2f1825(0x11a))/0x8*(parseInt(_0x2f1825(0x118))/0x9)+-parseInt(_0x2f1825(0xe2))/0xa*(parseInt(_0x2f1825(0x11f))/0xb)+parseInt(_0x2f1825(0xf7))/0xc;if(_0x1d28ba===_0x1a354a)break;else _0x4da37a['push'](_0x4da37a['shift']());}catch(_0x38edd4){_0x4da37a['push'](_0x4da37a['shift']());}}}(a64_0x5032,0x9ee7c));var __importDefault=this&&this[a64_0x106167(0x102)]||function(_0x2c675d){const _0x12c235=a64_0x106167;return _0x2c675d&&_0x2c675d[_0x12c235(0xfa)]?_0x2c675d:{'default':_0x2c675d};};Object[a64_0x106167(0x107)](exports,a64_0x106167(0xfa),{'value':!![]}),exports[a64_0x106167(0xfd)]=void 0x0;const bcryptjs_1=__importDefault(require(a64_0x106167(0xf2))),crypto_1=__importDefault(require(a64_0x106167(0xf5))),database_1=__importDefault(require('../config/database'));class SettingsService{[a64_0x106167(0xe5)](_0x229d22){const _0x533f76=a64_0x106167;if(!_0x229d22)return'';if(_0x229d22[_0x533f76(0x117)]<=0x8)return _0x229d22;const _0x5d05d7=_0x229d22[_0x533f76(0x114)](0x0,0x8),_0x5530bf='*'[_0x533f76(0xf1)](Math[_0x533f76(0x103)](0x0,_0x229d22[_0x533f76(0x117)]-0x8));return _0x5d05d7+_0x5530bf;}[a64_0x106167(0x100)](_0x2e734b){const _0x5cf1f3=a64_0x106167;if(!_0x2e734b)return[];if(Array[_0x5cf1f3(0x122)](_0x2e734b))return _0x2e734b;if(typeof _0x2e734b===_0x5cf1f3(0xfc))try{const _0x195311=JSON[_0x5cf1f3(0x125)](_0x2e734b);return Array[_0x5cf1f3(0x122)](_0x195311)?_0x195311:[];}catch{return[];}return[];}async['getShopSettings'](_0x190b5f){const _0xc5b265=a64_0x106167,_0x52c248=await database_1[_0xc5b265(0xed)][_0xc5b265(0x112)][_0xc5b265(0xf0)]({'where':{'id':_0x190b5f},'include':{'settings':!![]}});if(!_0x52c248)throw new Error('Shop\x20not\x20found');let _0x560c33=_0x52c248[_0xc5b265(0xfb)];return!_0x560c33&&(_0x560c33=await database_1[_0xc5b265(0xed)]['shopSettings']['create']({'data':{'shopId':_0x52c248['id']}})),{'fullName':_0x52c248[_0xc5b265(0x10e)],'brand':_0x52c248[_0xc5b265(0x10e)],'merchantUrl':_0x52c248[_0xc5b265(0xf6)],'telegramUsername':_0x52c248[_0xc5b265(0xea)],'telegramBotApiKey':_0x560c33[_0xc5b265(0xfe)]?this[_0xc5b265(0xe5)](_0x560c33['telegramBotApiKey']):null,'telegramChatId':_0x560c33['telegramChatId'],'webhookUrl':_0x560c33[_0xc5b265(0xe9)],'webhookEvents':this[_0xc5b265(0x100)](_0x560c33[_0xc5b265(0x10c)]),'notifications':{'payment_success':_0x560c33[_0xc5b265(0xeb)],'payment_failed':_0x560c33[_0xc5b265(0x10b)],'refund':_0x560c33[_0xc5b265(0xe3)],'payout':_0x560c33[_0xc5b265(0xf3)],'login':_0x560c33['notificationLogin'],'api_error':_0x560c33[_0xc5b265(0xec)]}};}async[a64_0x106167(0x120)](_0x1b0972,_0x2a84af){const _0x2a26cf=a64_0x106167,{currentPassword:_0x30d25e,newPassword:_0x3e13c2,confirmNewPassword:_0x3ace91}=_0x2a84af;if(_0x3e13c2!==_0x3ace91)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x3e13c2[_0x2a26cf(0x117)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x57498a=await database_1[_0x2a26cf(0xed)][_0x2a26cf(0x112)][_0x2a26cf(0xf0)]({'where':{'id':_0x1b0972},'select':{'password':!![]}});if(!_0x57498a)throw new Error('Shop\x20not\x20found');const _0x1234e5=await bcryptjs_1['default'][_0x2a26cf(0x11c)](_0x30d25e,_0x57498a[_0x2a26cf(0x10f)]);if(!_0x1234e5)throw new Error('Current\x20password\x20is\x20incorrect');const _0x1fb2a5=await bcryptjs_1[_0x2a26cf(0xed)][_0x2a26cf(0x11b)](_0x3e13c2,0xc);await database_1[_0x2a26cf(0xed)]['shop'][_0x2a26cf(0x115)]({'where':{'id':_0x1b0972},'data':{'password':_0x1fb2a5}});}async[a64_0x106167(0x124)](_0x4fa8c4,_0x433cc6){const _0xba8ae7=a64_0x106167;await this[_0xba8ae7(0x104)](_0x4fa8c4);const _0x3e80c2={};_0x433cc6[_0xba8ae7(0x121)]!==undefined&&(_0x3e80c2[_0xba8ae7(0xeb)]=_0x433cc6['payment_success']),_0x433cc6[_0xba8ae7(0x113)]!==undefined&&(_0x3e80c2[_0xba8ae7(0x10b)]=_0x433cc6[_0xba8ae7(0x113)]),_0x433cc6['refund']!==undefined&&(_0x3e80c2[_0xba8ae7(0xe3)]=_0x433cc6['refund']),_0x433cc6[_0xba8ae7(0x101)]!==undefined&&(_0x3e80c2[_0xba8ae7(0xf3)]=_0x433cc6[_0xba8ae7(0x101)]),_0x433cc6[_0xba8ae7(0xf4)]!==undefined&&(_0x3e80c2[_0xba8ae7(0x110)]=_0x433cc6[_0xba8ae7(0xf4)]),_0x433cc6[_0xba8ae7(0x108)]!==undefined&&(_0x3e80c2[_0xba8ae7(0xec)]=_0x433cc6[_0xba8ae7(0x108)]),await database_1['default'][_0xba8ae7(0xe4)][_0xba8ae7(0x115)]({'where':{'shopId':_0x4fa8c4},'data':_0x3e80c2});}async['updateTelegramSettings'](_0x8ff242,_0x2683dc){const _0x125fad=a64_0x106167;await this[_0x125fad(0x104)](_0x8ff242);const _0x5649c3={};_0x2683dc[_0x125fad(0x11e)]!==undefined&&(_0x5649c3[_0x125fad(0xfe)]=_0x2683dc[_0x125fad(0x11e)]||null),_0x2683dc[_0x125fad(0x116)]!==undefined&&(_0x5649c3['telegramChatId']=_0x2683dc[_0x125fad(0x116)]||null),await database_1['default'][_0x125fad(0xe4)]['update']({'where':{'shopId':_0x8ff242},'data':_0x5649c3});}async['updateWebhookSettings'](_0xa68ce8,_0xe78820){const _0x25ab17=a64_0x106167;await this['ensureSettingsExist'](_0xa68ce8);const _0x542d2f={};_0xe78820[_0x25ab17(0xe9)]!==undefined&&(_0x542d2f[_0x25ab17(0xe9)]=_0xe78820[_0x25ab17(0xe9)]||null),_0xe78820[_0x25ab17(0x10c)]!==undefined&&(_0x542d2f['webhookEvents']=_0xe78820[_0x25ab17(0x10c)]||[]),await database_1[_0x25ab17(0xed)][_0x25ab17(0xe4)][_0x25ab17(0x115)]({'where':{'shopId':_0xa68ce8},'data':_0x542d2f});}async[a64_0x106167(0x119)](_0x4fc9aa){const _0x24a379=a64_0x106167,_0x55fa10=_0x24a379(0x10d)+crypto_1[_0x24a379(0xed)][_0x24a379(0x10a)](0x20)[_0x24a379(0x109)]('hex'),_0x5d9f4=_0x24a379(0xe6)+crypto_1['default'][_0x24a379(0x10a)](0x20)['toString'](_0x24a379(0xee));await database_1[_0x24a379(0xed)][_0x24a379(0x112)][_0x24a379(0x115)]({'where':{'id':_0x4fc9aa},'data':{'publicKey':_0x55fa10,'secretKey':_0x5d9f4}});}async['deleteAccount'](_0x5b3f1e,_0x30a24c){const _0xd85be2=a64_0x106167,{passwordConfirmation:_0x40edd7}=_0x30a24c,_0x32501d=await database_1[_0xd85be2(0xed)][_0xd85be2(0x112)][_0xd85be2(0xf0)]({'where':{'id':_0x5b3f1e},'select':{'password':!![]}});if(!_0x32501d)throw new Error(_0xd85be2(0xf8));const _0x4d8b66=await bcryptjs_1[_0xd85be2(0xed)][_0xd85be2(0x11c)](_0x40edd7,_0x32501d['password']);if(!_0x4d8b66)throw new Error(_0xd85be2(0x106));await database_1[_0xd85be2(0xed)][_0xd85be2(0x112)][_0xd85be2(0xff)]({'where':{'id':_0x5b3f1e}});}async[a64_0x106167(0x104)](_0x4cc517){const _0x2a461a=a64_0x106167,_0x3a47f4=await database_1[_0x2a461a(0xed)][_0x2a461a(0xe4)][_0x2a461a(0xf0)]({'where':{'shopId':_0x4cc517}});!_0x3a47f4&&await database_1['default'][_0x2a461a(0xe4)][_0x2a461a(0xe8)]({'data':{'shopId':_0x4cc517}});}}exports[a64_0x106167(0xfd)]=SettingsService;