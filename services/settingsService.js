'use strict';const a72_0x49cff0=a72_0x256b;(function(_0x4bb545,_0x4fcc4d){const _0x115061=a72_0x256b,_0x392430=_0x4bb545();while(!![]){try{const _0xe6be08=-parseInt(_0x115061(0x10d))/0x1+-parseInt(_0x115061(0x117))/0x2*(-parseInt(_0x115061(0x130))/0x3)+-parseInt(_0x115061(0x12d))/0x4+parseInt(_0x115061(0x118))/0x5*(-parseInt(_0x115061(0x114))/0x6)+parseInt(_0x115061(0x12f))/0x7*(parseInt(_0x115061(0x141))/0x8)+parseInt(_0x115061(0x119))/0x9+parseInt(_0x115061(0x102))/0xa;if(_0xe6be08===_0x4fcc4d)break;else _0x392430['push'](_0x392430['shift']());}catch(_0x2b08c6){_0x392430['push'](_0x392430['shift']());}}}(a72_0x7f49,0x6fdde));var __importDefault=this&&this[a72_0x49cff0(0x138)]||function(_0x96d643){const _0x1b85fa=a72_0x49cff0;return _0x96d643&&_0x96d643[_0x1b85fa(0x110)]?_0x96d643:{'default':_0x96d643};};function a72_0x256b(_0x49275e,_0x3fe152){_0x49275e=_0x49275e-0xfd;const _0x7f49df=a72_0x7f49();let _0x256b4a=_0x7f49df[_0x49275e];return _0x256b4a;}function a72_0x7f49(){const _0x52dacd=['New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','Password\x20confirmation\x20is\x20incorrect','isArray','login','Current\x20password\x20is\x20incorrect','hex','string','name','maskApiKey','hash','webhookEvents','toString','Shop\x20not\x20found','revokeAllApiKeys','notificationPayout','updateNotifications','3596472yiKrzd','password','2786294XPMGwW','49179jAlEGG','delete','../config/database','update','findUnique','bcryptjs','SettingsService','substring','__importDefault','compare','notificationPaymentSuccess','chatId','crypto','shopUrl','randomBytes','api_error','settings','8wbIawd','default','shop','defineProperty','notificationLogin','shopSettings','telegram','3627660wocoQX','notificationPaymentFailed','deleteAccount','ensureSettingsExist','payout','updateWebhookSettings','telegramChatId','length','updateTelegramSettings','botApiKey','max','564941qadvwg','payment_failed','payment_success','__esModule','telegramBotApiKey','getShopSettings','pk_','46146wYavUa','parse','refund','102ijfAuZ','70CVxKuj','3897792GtFvaP','create','webhookUrl','notificationApiError'];a72_0x7f49=function(){return _0x52dacd;};return a72_0x7f49();}Object[a72_0x49cff0(0xfe)](exports,a72_0x49cff0(0x110),{'value':!![]}),exports[a72_0x49cff0(0x136)]=void 0x0;const bcryptjs_1=__importDefault(require(a72_0x49cff0(0x135))),crypto_1=__importDefault(require(a72_0x49cff0(0x13c))),database_1=__importDefault(require(a72_0x49cff0(0x132)));class SettingsService{[a72_0x49cff0(0x125)](_0xd408fd){const _0x572b05=a72_0x49cff0;if(!_0xd408fd)return'';if(_0xd408fd[_0x572b05(0x109)]<=0x8)return _0xd408fd;const _0xd26f6=_0xd408fd[_0x572b05(0x137)](0x0,0x8),_0x5bb605='*'['repeat'](Math[_0x572b05(0x10c)](0x0,_0xd408fd[_0x572b05(0x109)]-0x8));return _0xd26f6+_0x5bb605;}['parseWebhookEvents'](_0x34f58e){const _0x2b282b=a72_0x49cff0;if(!_0x34f58e)return[];if(Array[_0x2b282b(0x11f)](_0x34f58e))return _0x34f58e;if(typeof _0x34f58e===_0x2b282b(0x123))try{const _0x534af8=JSON[_0x2b282b(0x115)](_0x34f58e);return Array[_0x2b282b(0x11f)](_0x534af8)?_0x534af8:[];}catch{return[];}return[];}async[a72_0x49cff0(0x112)](_0x2278fb){const _0x3c16fa=a72_0x49cff0,_0x7e4f9f=await database_1[_0x3c16fa(0x142)]['shop'][_0x3c16fa(0x134)]({'where':{'id':_0x2278fb},'include':{'settings':!![]}});if(!_0x7e4f9f)throw new Error(_0x3c16fa(0x129));let _0x1245aa=_0x7e4f9f[_0x3c16fa(0x140)];return!_0x1245aa&&(_0x1245aa=await database_1[_0x3c16fa(0x142)][_0x3c16fa(0x100)]['create']({'data':{'shopId':_0x7e4f9f['id']}})),{'fullName':_0x7e4f9f[_0x3c16fa(0x124)],'brand':_0x7e4f9f[_0x3c16fa(0x124)],'merchantUrl':_0x7e4f9f[_0x3c16fa(0x13d)],'telegramUsername':_0x7e4f9f[_0x3c16fa(0x101)],'telegramBotApiKey':_0x1245aa[_0x3c16fa(0x111)]?this[_0x3c16fa(0x125)](_0x1245aa['telegramBotApiKey']):null,'telegramChatId':_0x1245aa[_0x3c16fa(0x108)],'webhookUrl':_0x1245aa['webhookUrl'],'webhookEvents':this['parseWebhookEvents'](_0x1245aa[_0x3c16fa(0x127)]),'notifications':{'payment_success':_0x1245aa['notificationPaymentSuccess'],'payment_failed':_0x1245aa['notificationPaymentFailed'],'refund':_0x1245aa['notificationRefund'],'payout':_0x1245aa[_0x3c16fa(0x12b)],'login':_0x1245aa[_0x3c16fa(0xff)],'api_error':_0x1245aa[_0x3c16fa(0x11c)]}};}async['changePassword'](_0x538f00,_0x21b070){const _0x3b116f=a72_0x49cff0,{currentPassword:_0x4783c6,newPassword:_0x28b96c,confirmNewPassword:_0xf22dce}=_0x21b070;if(_0x28b96c!==_0xf22dce)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x28b96c[_0x3b116f(0x109)]<0x6)throw new Error(_0x3b116f(0x11d));const _0x35d897=await database_1[_0x3b116f(0x142)]['shop'][_0x3b116f(0x134)]({'where':{'id':_0x538f00},'select':{'password':!![]}});if(!_0x35d897)throw new Error(_0x3b116f(0x129));const _0x3f63b0=await bcryptjs_1[_0x3b116f(0x142)][_0x3b116f(0x139)](_0x4783c6,_0x35d897['password']);if(!_0x3f63b0)throw new Error(_0x3b116f(0x121));const _0x4439fd=await bcryptjs_1[_0x3b116f(0x142)][_0x3b116f(0x126)](_0x28b96c,0xc);await database_1['default'][_0x3b116f(0xfd)][_0x3b116f(0x133)]({'where':{'id':_0x538f00},'data':{'password':_0x4439fd}});}async[a72_0x49cff0(0x12c)](_0x393934,_0x54e97f){const _0x40249e=a72_0x49cff0;await this[_0x40249e(0x105)](_0x393934);const _0x38a122={};_0x54e97f[_0x40249e(0x10f)]!==undefined&&(_0x38a122[_0x40249e(0x13a)]=_0x54e97f[_0x40249e(0x10f)]),_0x54e97f[_0x40249e(0x10e)]!==undefined&&(_0x38a122[_0x40249e(0x103)]=_0x54e97f[_0x40249e(0x10e)]),_0x54e97f['refund']!==undefined&&(_0x38a122['notificationRefund']=_0x54e97f[_0x40249e(0x116)]),_0x54e97f[_0x40249e(0x106)]!==undefined&&(_0x38a122[_0x40249e(0x12b)]=_0x54e97f[_0x40249e(0x106)]),_0x54e97f[_0x40249e(0x120)]!==undefined&&(_0x38a122[_0x40249e(0xff)]=_0x54e97f[_0x40249e(0x120)]),_0x54e97f[_0x40249e(0x13f)]!==undefined&&(_0x38a122[_0x40249e(0x11c)]=_0x54e97f[_0x40249e(0x13f)]),await database_1['default'][_0x40249e(0x100)][_0x40249e(0x133)]({'where':{'shopId':_0x393934},'data':_0x38a122});}async[a72_0x49cff0(0x10a)](_0x18a84e,_0x2833f0){const _0x1e48a2=a72_0x49cff0;await this[_0x1e48a2(0x105)](_0x18a84e);const _0x127de0={};_0x2833f0[_0x1e48a2(0x10b)]!==undefined&&(_0x127de0[_0x1e48a2(0x111)]=_0x2833f0['botApiKey']||null),_0x2833f0['chatId']!==undefined&&(_0x127de0['telegramChatId']=_0x2833f0[_0x1e48a2(0x13b)]||null),await database_1[_0x1e48a2(0x142)][_0x1e48a2(0x100)][_0x1e48a2(0x133)]({'where':{'shopId':_0x18a84e},'data':_0x127de0});}async[a72_0x49cff0(0x107)](_0x349d3f,_0x3e93f3){const _0x3d7144=a72_0x49cff0;await this['ensureSettingsExist'](_0x349d3f);const _0x2c14bd={};_0x3e93f3[_0x3d7144(0x11b)]!==undefined&&(_0x2c14bd[_0x3d7144(0x11b)]=_0x3e93f3[_0x3d7144(0x11b)]||null),_0x3e93f3[_0x3d7144(0x127)]!==undefined&&(_0x2c14bd[_0x3d7144(0x127)]=_0x3e93f3[_0x3d7144(0x127)]||[]),await database_1[_0x3d7144(0x142)][_0x3d7144(0x100)][_0x3d7144(0x133)]({'where':{'shopId':_0x349d3f},'data':_0x2c14bd});}async[a72_0x49cff0(0x12a)](_0x3838b6){const _0x4a4cbf=a72_0x49cff0,_0x4a006a=_0x4a4cbf(0x113)+crypto_1[_0x4a4cbf(0x142)][_0x4a4cbf(0x13e)](0x20)[_0x4a4cbf(0x128)](_0x4a4cbf(0x122)),_0x2498b='sk_'+crypto_1[_0x4a4cbf(0x142)][_0x4a4cbf(0x13e)](0x20)[_0x4a4cbf(0x128)](_0x4a4cbf(0x122));await database_1[_0x4a4cbf(0x142)][_0x4a4cbf(0xfd)][_0x4a4cbf(0x133)]({'where':{'id':_0x3838b6},'data':{'publicKey':_0x4a006a,'secretKey':_0x2498b}});}async[a72_0x49cff0(0x104)](_0x45b9f1,_0x20657b){const _0x494715=a72_0x49cff0,{passwordConfirmation:_0x13a3cb}=_0x20657b,_0x53a78a=await database_1[_0x494715(0x142)]['shop'][_0x494715(0x134)]({'where':{'id':_0x45b9f1},'select':{'password':!![]}});if(!_0x53a78a)throw new Error(_0x494715(0x129));const _0x5af5c3=await bcryptjs_1[_0x494715(0x142)][_0x494715(0x139)](_0x13a3cb,_0x53a78a[_0x494715(0x12e)]);if(!_0x5af5c3)throw new Error(_0x494715(0x11e));await database_1[_0x494715(0x142)][_0x494715(0xfd)][_0x494715(0x131)]({'where':{'id':_0x45b9f1}});}async[a72_0x49cff0(0x105)](_0x3ac2c2){const _0x1a2760=a72_0x49cff0,_0x5efde8=await database_1['default'][_0x1a2760(0x100)][_0x1a2760(0x134)]({'where':{'shopId':_0x3ac2c2}});!_0x5efde8&&await database_1[_0x1a2760(0x142)][_0x1a2760(0x100)][_0x1a2760(0x11a)]({'data':{'shopId':_0x3ac2c2}});}}exports[a72_0x49cff0(0x136)]=SettingsService;