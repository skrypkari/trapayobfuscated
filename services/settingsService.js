'use strict';const a47_0x32a4cf=a47_0x4877;(function(_0x240319,_0x28247a){const _0x25efc4=a47_0x4877,_0x2f8cee=_0x240319();while(!![]){try{const _0x140bb4=-parseInt(_0x25efc4(0x9d))/0x1*(parseInt(_0x25efc4(0xbd))/0x2)+-parseInt(_0x25efc4(0xa4))/0x3*(parseInt(_0x25efc4(0x96))/0x4)+-parseInt(_0x25efc4(0x88))/0x5+parseInt(_0x25efc4(0xbe))/0x6+parseInt(_0x25efc4(0x91))/0x7*(parseInt(_0x25efc4(0x8c))/0x8)+parseInt(_0x25efc4(0xb6))/0x9*(-parseInt(_0x25efc4(0xaa))/0xa)+parseInt(_0x25efc4(0x80))/0xb*(parseInt(_0x25efc4(0xb0))/0xc);if(_0x140bb4===_0x28247a)break;else _0x2f8cee['push'](_0x2f8cee['shift']());}catch(_0x587977){_0x2f8cee['push'](_0x2f8cee['shift']());}}}(a47_0x5edc,0x88a6a));function a47_0x5edc(){const _0x35ada4=['2418JJqgRE','compare','webhookUrl','chatId','randomBytes','pk_','730XyUfKp','repeat','Shop\x20not\x20found','notificationPaymentFailed','__importDefault','notificationLogin','416352GoqZTJ','default','notificationRefund','telegram','refund','updateNotifications','49293OMnWyf','changePassword','login','name','deleteAccount','substring','password','2IMVoxT','3954948zMPvEg','shopUrl','notificationPayout','shop','updateWebhookSettings','407HRZqxq','payment_failed','SettingsService','webhookEvents','crypto','defineProperty','update','telegramChatId','4774225VKfLBq','parseWebhookEvents','create','updateTelegramSettings','184sZTuLk','Password\x20confirmation\x20is\x20incorrect','ensureSettingsExist','hash','telegramBotApiKey','332843XzcMDq','shopSettings','isArray','notificationPaymentSuccess','parse','5048HdWfqn','payment_success','settings','sk_','length','findUnique','hex','104977VVQcYg','../config/database','botApiKey','notificationApiError','__esModule','toString','maskApiKey'];a47_0x5edc=function(){return _0x35ada4;};return a47_0x5edc();}var __importDefault=this&&this[a47_0x32a4cf(0xae)]||function(_0x2441bb){const _0x337a79=a47_0x32a4cf;return _0x2441bb&&_0x2441bb[_0x337a79(0xa1)]?_0x2441bb:{'default':_0x2441bb};};Object[a47_0x32a4cf(0x85)](exports,'__esModule',{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a47_0x32a4cf(0x84))),database_1=__importDefault(require(a47_0x32a4cf(0x9e)));class SettingsService{[a47_0x32a4cf(0xa3)](_0x40069b){const _0x320bb7=a47_0x32a4cf;if(!_0x40069b)return'';if(_0x40069b[_0x320bb7(0x9a)]<=0x8)return _0x40069b;const _0x36970d=_0x40069b[_0x320bb7(0xbb)](0x0,0x8),_0x2eb181='*'[_0x320bb7(0xab)](Math['max'](0x0,_0x40069b[_0x320bb7(0x9a)]-0x8));return _0x36970d+_0x2eb181;}[a47_0x32a4cf(0x89)](_0x5ca017){const _0x27721c=a47_0x32a4cf;if(!_0x5ca017)return[];if(Array[_0x27721c(0x93)](_0x5ca017))return _0x5ca017;if(typeof _0x5ca017==='string')try{const _0x2d2a22=JSON[_0x27721c(0x95)](_0x5ca017);return Array['isArray'](_0x2d2a22)?_0x2d2a22:[];}catch{return[];}return[];}async['getShopSettings'](_0x3685cd){const _0x3432b4=a47_0x32a4cf,_0x41f150=await database_1[_0x3432b4(0xb1)]['shop'][_0x3432b4(0x9b)]({'where':{'id':_0x3685cd},'include':{'settings':!![]}});if(!_0x41f150)throw new Error('Shop\x20not\x20found');let _0x375362=_0x41f150[_0x3432b4(0x98)];return!_0x375362&&(_0x375362=await database_1['default']['shopSettings']['create']({'data':{'shopId':_0x41f150['id']}})),{'fullName':_0x41f150[_0x3432b4(0xb9)],'brand':_0x41f150[_0x3432b4(0xb9)],'merchantUrl':_0x41f150[_0x3432b4(0xbf)],'telegramUsername':_0x41f150[_0x3432b4(0xb3)],'telegramBotApiKey':_0x375362[_0x3432b4(0x90)]?this['maskApiKey'](_0x375362[_0x3432b4(0x90)]):null,'telegramChatId':_0x375362['telegramChatId'],'webhookUrl':_0x375362['webhookUrl'],'webhookEvents':this[_0x3432b4(0x89)](_0x375362[_0x3432b4(0x83)]),'notifications':{'payment_success':_0x375362[_0x3432b4(0x94)],'payment_failed':_0x375362['notificationPaymentFailed'],'refund':_0x375362[_0x3432b4(0xb2)],'payout':_0x375362[_0x3432b4(0xc0)],'login':_0x375362[_0x3432b4(0xaf)],'api_error':_0x375362[_0x3432b4(0xa0)]}};}async[a47_0x32a4cf(0xb7)](_0x48a1ed,_0x2afdc0){const _0x3ec2ac=a47_0x32a4cf,{currentPassword:_0x77cf84,newPassword:_0x1ac25c,confirmNewPassword:_0x1f458c}=_0x2afdc0;if(_0x1ac25c!==_0x1f458c)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x1ac25c['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x44e15d=await database_1[_0x3ec2ac(0xb1)][_0x3ec2ac(0x7e)][_0x3ec2ac(0x9b)]({'where':{'id':_0x48a1ed},'select':{'password':!![]}});if(!_0x44e15d)throw new Error(_0x3ec2ac(0xac));const _0x4d7e64=await bcryptjs_1[_0x3ec2ac(0xb1)][_0x3ec2ac(0xa5)](_0x77cf84,_0x44e15d[_0x3ec2ac(0xbc)]);if(!_0x4d7e64)throw new Error('Current\x20password\x20is\x20incorrect');const _0xe055da=await bcryptjs_1[_0x3ec2ac(0xb1)][_0x3ec2ac(0x8f)](_0x1ac25c,0xc);await database_1[_0x3ec2ac(0xb1)]['shop'][_0x3ec2ac(0x86)]({'where':{'id':_0x48a1ed},'data':{'password':_0xe055da}});}async[a47_0x32a4cf(0xb5)](_0x1b3ddb,_0x2c55a3){const _0x2c8df=a47_0x32a4cf;await this[_0x2c8df(0x8e)](_0x1b3ddb);const _0x5e4287={};_0x2c55a3['payment_success']!==undefined&&(_0x5e4287[_0x2c8df(0x94)]=_0x2c55a3[_0x2c8df(0x97)]),_0x2c55a3[_0x2c8df(0x81)]!==undefined&&(_0x5e4287[_0x2c8df(0xad)]=_0x2c55a3[_0x2c8df(0x81)]),_0x2c55a3[_0x2c8df(0xb4)]!==undefined&&(_0x5e4287[_0x2c8df(0xb2)]=_0x2c55a3[_0x2c8df(0xb4)]),_0x2c55a3['payout']!==undefined&&(_0x5e4287[_0x2c8df(0xc0)]=_0x2c55a3['payout']),_0x2c55a3[_0x2c8df(0xb8)]!==undefined&&(_0x5e4287[_0x2c8df(0xaf)]=_0x2c55a3['login']),_0x2c55a3['api_error']!==undefined&&(_0x5e4287[_0x2c8df(0xa0)]=_0x2c55a3['api_error']),await database_1['default'][_0x2c8df(0x92)][_0x2c8df(0x86)]({'where':{'shopId':_0x1b3ddb},'data':_0x5e4287});}async[a47_0x32a4cf(0x8b)](_0x3778d7,_0xa1fd96){const _0x16086e=a47_0x32a4cf;await this['ensureSettingsExist'](_0x3778d7);const _0x1fe930={};_0xa1fd96['botApiKey']!==undefined&&(_0x1fe930[_0x16086e(0x90)]=_0xa1fd96[_0x16086e(0x9f)]||null),_0xa1fd96[_0x16086e(0xa7)]!==undefined&&(_0x1fe930[_0x16086e(0x87)]=_0xa1fd96[_0x16086e(0xa7)]||null),await database_1[_0x16086e(0xb1)][_0x16086e(0x92)][_0x16086e(0x86)]({'where':{'shopId':_0x3778d7},'data':_0x1fe930});}async[a47_0x32a4cf(0x7f)](_0x714f0d,_0x48ddaa){const _0x173aaa=a47_0x32a4cf;await this[_0x173aaa(0x8e)](_0x714f0d);const _0x34f7cb={};_0x48ddaa['webhookUrl']!==undefined&&(_0x34f7cb[_0x173aaa(0xa6)]=_0x48ddaa['webhookUrl']||null),_0x48ddaa['webhookEvents']!==undefined&&(_0x34f7cb[_0x173aaa(0x83)]=_0x48ddaa[_0x173aaa(0x83)]||[]),await database_1[_0x173aaa(0xb1)]['shopSettings'][_0x173aaa(0x86)]({'where':{'shopId':_0x714f0d},'data':_0x34f7cb});}async['revokeAllApiKeys'](_0x26bf62){const _0x2f08a2=a47_0x32a4cf,_0x1bac41=_0x2f08a2(0xa9)+crypto_1['default']['randomBytes'](0x20)[_0x2f08a2(0xa2)](_0x2f08a2(0x9c)),_0xe3b5af=_0x2f08a2(0x99)+crypto_1[_0x2f08a2(0xb1)][_0x2f08a2(0xa8)](0x20)[_0x2f08a2(0xa2)](_0x2f08a2(0x9c));await database_1[_0x2f08a2(0xb1)][_0x2f08a2(0x7e)][_0x2f08a2(0x86)]({'where':{'id':_0x26bf62},'data':{'publicKey':_0x1bac41,'secretKey':_0xe3b5af}});}async[a47_0x32a4cf(0xba)](_0x2d5fd9,_0x119da2){const _0x3a23cc=a47_0x32a4cf,{passwordConfirmation:_0x19273d}=_0x119da2,_0x55af28=await database_1[_0x3a23cc(0xb1)]['shop'][_0x3a23cc(0x9b)]({'where':{'id':_0x2d5fd9},'select':{'password':!![]}});if(!_0x55af28)throw new Error(_0x3a23cc(0xac));const _0x558927=await bcryptjs_1[_0x3a23cc(0xb1)][_0x3a23cc(0xa5)](_0x19273d,_0x55af28[_0x3a23cc(0xbc)]);if(!_0x558927)throw new Error(_0x3a23cc(0x8d));await database_1[_0x3a23cc(0xb1)][_0x3a23cc(0x7e)]['delete']({'where':{'id':_0x2d5fd9}});}async[a47_0x32a4cf(0x8e)](_0x25f165){const _0x2d71ee=a47_0x32a4cf,_0xecd613=await database_1[_0x2d71ee(0xb1)][_0x2d71ee(0x92)][_0x2d71ee(0x9b)]({'where':{'shopId':_0x25f165}});!_0xecd613&&await database_1[_0x2d71ee(0xb1)][_0x2d71ee(0x92)][_0x2d71ee(0x8a)]({'data':{'shopId':_0x25f165}});}}function a47_0x4877(_0x46ef0d,_0x66c7d){const _0x5edcc8=a47_0x5edc();return a47_0x4877=function(_0x4877f6,_0x48b751){_0x4877f6=_0x4877f6-0x7e;let _0x47878f=_0x5edcc8[_0x4877f6];return _0x47878f;},a47_0x4877(_0x46ef0d,_0x66c7d);}exports[a47_0x32a4cf(0x82)]=SettingsService;