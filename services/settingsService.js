'use strict';const a47_0xd7dee4=a47_0x4181;(function(_0x5276f0,_0x513d9f){const _0x32e4df=a47_0x4181,_0x385418=_0x5276f0();while(!![]){try{const _0x4e9853=-parseInt(_0x32e4df(0x1cc))/0x1*(-parseInt(_0x32e4df(0x1c6))/0x2)+-parseInt(_0x32e4df(0x1ea))/0x3*(parseInt(_0x32e4df(0x1d8))/0x4)+parseInt(_0x32e4df(0x1d3))/0x5*(-parseInt(_0x32e4df(0x1d2))/0x6)+-parseInt(_0x32e4df(0x1cd))/0x7+parseInt(_0x32e4df(0x1eb))/0x8+parseInt(_0x32e4df(0x1e4))/0x9+parseInt(_0x32e4df(0x1e9))/0xa*(parseInt(_0x32e4df(0x1e6))/0xb);if(_0x4e9853===_0x513d9f)break;else _0x385418['push'](_0x385418['shift']());}catch(_0x147e96){_0x385418['push'](_0x385418['shift']());}}}(a47_0x389e,0x80859));function a47_0x389e(){const _0x265e4b=['1735272JmclMN','parse','ensureSettingsExist','settings','payment_failed','1704STqarN','7165cGDouV','name','telegramBotApiKey','shop','login','1364eUAUYs','substring','Shop\x20not\x20found','hex','payout','chatId','shopSettings','create','pk_','compare','updateTelegramSettings','default','1069065evUoXi','api_error','275VDQSXw','Password\x20confirmation\x20is\x20incorrect','botApiKey','416410lPlkjd','8034tcrbyh','5146904LDmBcY','crypto','password','deleteAccount','defineProperty','randomBytes','SettingsService','findUnique','notificationRefund','string','__importDefault','toString','parseWebhookEvents','payment_success','telegram','notificationPaymentFailed','revokeAllApiKeys','update','max','updateWebhookSettings','maskApiKey','__esModule','webhookUrl','telegramChatId','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','refund','shopUrl','webhookEvents','length','4SGebNJ','notificationPaymentSuccess','hash','delete','isArray','notificationApiError','145659dHLYjT'];a47_0x389e=function(){return _0x265e4b;};return a47_0x389e();}function a47_0x4181(_0xe006df,_0x562677){const _0x389e89=a47_0x389e();return a47_0x4181=function(_0x418142,_0x4aaac6){_0x418142=_0x418142-0x1ae;let _0x544061=_0x389e89[_0x418142];return _0x544061;},a47_0x4181(_0xe006df,_0x562677);}var __importDefault=this&&this[a47_0xd7dee4(0x1b3)]||function(_0x332400){const _0x248574=a47_0xd7dee4;return _0x332400&&_0x332400[_0x248574(0x1be)]?_0x332400:{'default':_0x332400};};Object[a47_0xd7dee4(0x1ef)](exports,a47_0xd7dee4(0x1be),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a47_0xd7dee4(0x1ec))),database_1=__importDefault(require('../config/database'));class SettingsService{[a47_0xd7dee4(0x1bd)](_0x857122){const _0x7e5bb6=a47_0xd7dee4;if(!_0x857122)return'';if(_0x857122[_0x7e5bb6(0x1c5)]<=0x8)return _0x857122;const _0x4f5bf0=_0x857122[_0x7e5bb6(0x1d9)](0x0,0x8),_0x23cc42='*'['repeat'](Math[_0x7e5bb6(0x1bb)](0x0,_0x857122[_0x7e5bb6(0x1c5)]-0x8));return _0x4f5bf0+_0x23cc42;}[a47_0xd7dee4(0x1b5)](_0x184ddc){const _0x29642c=a47_0xd7dee4;if(!_0x184ddc)return[];if(Array[_0x29642c(0x1ca)](_0x184ddc))return _0x184ddc;if(typeof _0x184ddc===_0x29642c(0x1b2))try{const _0x11741c=JSON[_0x29642c(0x1ce)](_0x184ddc);return Array['isArray'](_0x11741c)?_0x11741c:[];}catch{return[];}return[];}async['getShopSettings'](_0x27ce45){const _0x8307c0=a47_0xd7dee4,_0x402a12=await database_1['default'][_0x8307c0(0x1d6)][_0x8307c0(0x1b0)]({'where':{'id':_0x27ce45},'include':{'settings':!![]}});if(!_0x402a12)throw new Error(_0x8307c0(0x1da));let _0x4ac3e4=_0x402a12[_0x8307c0(0x1d0)];return!_0x4ac3e4&&(_0x4ac3e4=await database_1[_0x8307c0(0x1e3)][_0x8307c0(0x1de)][_0x8307c0(0x1df)]({'data':{'shopId':_0x402a12['id']}})),{'fullName':_0x402a12[_0x8307c0(0x1d4)],'brand':_0x402a12[_0x8307c0(0x1d4)],'merchantUrl':_0x402a12[_0x8307c0(0x1c3)],'telegramUsername':_0x402a12[_0x8307c0(0x1b7)],'telegramBotApiKey':_0x4ac3e4[_0x8307c0(0x1d5)]?this['maskApiKey'](_0x4ac3e4['telegramBotApiKey']):null,'telegramChatId':_0x4ac3e4['telegramChatId'],'webhookUrl':_0x4ac3e4[_0x8307c0(0x1bf)],'webhookEvents':this[_0x8307c0(0x1b5)](_0x4ac3e4['webhookEvents']),'notifications':{'payment_success':_0x4ac3e4[_0x8307c0(0x1c7)],'payment_failed':_0x4ac3e4[_0x8307c0(0x1b8)],'refund':_0x4ac3e4[_0x8307c0(0x1b1)],'payout':_0x4ac3e4['notificationPayout'],'login':_0x4ac3e4['notificationLogin'],'api_error':_0x4ac3e4[_0x8307c0(0x1cb)]}};}async['changePassword'](_0x285d02,_0x508e82){const _0x4bbb4e=a47_0xd7dee4,{currentPassword:_0x3474b5,newPassword:_0x3c6d88,confirmNewPassword:_0x625521}=_0x508e82;if(_0x3c6d88!==_0x625521)throw new Error(_0x4bbb4e(0x1c1));if(_0x3c6d88[_0x4bbb4e(0x1c5)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x42b69d=await database_1['default'][_0x4bbb4e(0x1d6)]['findUnique']({'where':{'id':_0x285d02},'select':{'password':!![]}});if(!_0x42b69d)throw new Error('Shop\x20not\x20found');const _0x3ed2d3=await bcryptjs_1[_0x4bbb4e(0x1e3)]['compare'](_0x3474b5,_0x42b69d[_0x4bbb4e(0x1ed)]);if(!_0x3ed2d3)throw new Error('Current\x20password\x20is\x20incorrect');const _0x43b8d1=await bcryptjs_1['default'][_0x4bbb4e(0x1c8)](_0x3c6d88,0xc);await database_1[_0x4bbb4e(0x1e3)][_0x4bbb4e(0x1d6)][_0x4bbb4e(0x1ba)]({'where':{'id':_0x285d02},'data':{'password':_0x43b8d1}});}async['updateNotifications'](_0x35a8d0,_0x144485){const _0x4e6d7f=a47_0xd7dee4;await this[_0x4e6d7f(0x1cf)](_0x35a8d0);const _0xefc827={};_0x144485[_0x4e6d7f(0x1b6)]!==undefined&&(_0xefc827['notificationPaymentSuccess']=_0x144485[_0x4e6d7f(0x1b6)]),_0x144485[_0x4e6d7f(0x1d1)]!==undefined&&(_0xefc827[_0x4e6d7f(0x1b8)]=_0x144485[_0x4e6d7f(0x1d1)]),_0x144485[_0x4e6d7f(0x1c2)]!==undefined&&(_0xefc827['notificationRefund']=_0x144485[_0x4e6d7f(0x1c2)]),_0x144485[_0x4e6d7f(0x1dc)]!==undefined&&(_0xefc827['notificationPayout']=_0x144485[_0x4e6d7f(0x1dc)]),_0x144485[_0x4e6d7f(0x1d7)]!==undefined&&(_0xefc827['notificationLogin']=_0x144485['login']),_0x144485[_0x4e6d7f(0x1e5)]!==undefined&&(_0xefc827['notificationApiError']=_0x144485[_0x4e6d7f(0x1e5)]),await database_1[_0x4e6d7f(0x1e3)][_0x4e6d7f(0x1de)][_0x4e6d7f(0x1ba)]({'where':{'shopId':_0x35a8d0},'data':_0xefc827});}async[a47_0xd7dee4(0x1e2)](_0xb0e258,_0x314157){const _0x16cb7b=a47_0xd7dee4;await this[_0x16cb7b(0x1cf)](_0xb0e258);const _0x4162ac={};_0x314157[_0x16cb7b(0x1e8)]!==undefined&&(_0x4162ac[_0x16cb7b(0x1d5)]=_0x314157[_0x16cb7b(0x1e8)]||null),_0x314157[_0x16cb7b(0x1dd)]!==undefined&&(_0x4162ac[_0x16cb7b(0x1c0)]=_0x314157[_0x16cb7b(0x1dd)]||null),await database_1[_0x16cb7b(0x1e3)][_0x16cb7b(0x1de)][_0x16cb7b(0x1ba)]({'where':{'shopId':_0xb0e258},'data':_0x4162ac});}async[a47_0xd7dee4(0x1bc)](_0x1424a8,_0x4681df){const _0xce39bc=a47_0xd7dee4;await this['ensureSettingsExist'](_0x1424a8);const _0x3fb7d0={};_0x4681df[_0xce39bc(0x1bf)]!==undefined&&(_0x3fb7d0[_0xce39bc(0x1bf)]=_0x4681df[_0xce39bc(0x1bf)]||null),_0x4681df[_0xce39bc(0x1c4)]!==undefined&&(_0x3fb7d0['webhookEvents']=_0x4681df[_0xce39bc(0x1c4)]||[]),await database_1[_0xce39bc(0x1e3)]['shopSettings'][_0xce39bc(0x1ba)]({'where':{'shopId':_0x1424a8},'data':_0x3fb7d0});}async[a47_0xd7dee4(0x1b9)](_0x4a751b){const _0x317019=a47_0xd7dee4,_0x47d89b=_0x317019(0x1e0)+crypto_1[_0x317019(0x1e3)][_0x317019(0x1ae)](0x20)[_0x317019(0x1b4)](_0x317019(0x1db)),_0x3f994f='sk_'+crypto_1[_0x317019(0x1e3)][_0x317019(0x1ae)](0x20)[_0x317019(0x1b4)](_0x317019(0x1db));await database_1[_0x317019(0x1e3)][_0x317019(0x1d6)][_0x317019(0x1ba)]({'where':{'id':_0x4a751b},'data':{'publicKey':_0x47d89b,'secretKey':_0x3f994f}});}async[a47_0xd7dee4(0x1ee)](_0x1c6811,_0x1f66e1){const _0x49ff8d=a47_0xd7dee4,{passwordConfirmation:_0x1f754f}=_0x1f66e1,_0x5968d8=await database_1[_0x49ff8d(0x1e3)][_0x49ff8d(0x1d6)][_0x49ff8d(0x1b0)]({'where':{'id':_0x1c6811},'select':{'password':!![]}});if(!_0x5968d8)throw new Error(_0x49ff8d(0x1da));const _0x55cc6d=await bcryptjs_1[_0x49ff8d(0x1e3)][_0x49ff8d(0x1e1)](_0x1f754f,_0x5968d8[_0x49ff8d(0x1ed)]);if(!_0x55cc6d)throw new Error(_0x49ff8d(0x1e7));await database_1[_0x49ff8d(0x1e3)][_0x49ff8d(0x1d6)][_0x49ff8d(0x1c9)]({'where':{'id':_0x1c6811}});}async[a47_0xd7dee4(0x1cf)](_0x4d1121){const _0x3f4639=a47_0xd7dee4,_0x367053=await database_1['default'][_0x3f4639(0x1de)][_0x3f4639(0x1b0)]({'where':{'shopId':_0x4d1121}});!_0x367053&&await database_1['default']['shopSettings'][_0x3f4639(0x1df)]({'data':{'shopId':_0x4d1121}});}}exports[a47_0xd7dee4(0x1af)]=SettingsService;