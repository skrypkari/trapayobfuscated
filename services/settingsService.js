'use strict';const a47_0x28cab2=a47_0x2bf2;(function(_0x189c82,_0x74ef22){const _0xa7d112=a47_0x2bf2,_0xd277dc=_0x189c82();while(!![]){try{const _0x56e9c5=-parseInt(_0xa7d112(0xad))/0x1*(-parseInt(_0xa7d112(0x89))/0x2)+-parseInt(_0xa7d112(0x6b))/0x3*(parseInt(_0xa7d112(0x90))/0x4)+-parseInt(_0xa7d112(0x8d))/0x5+parseInt(_0xa7d112(0x9f))/0x6*(parseInt(_0xa7d112(0x9e))/0x7)+parseInt(_0xa7d112(0x69))/0x8*(-parseInt(_0xa7d112(0xa6))/0x9)+parseInt(_0xa7d112(0x91))/0xa*(parseInt(_0xa7d112(0xac))/0xb)+-parseInt(_0xa7d112(0x73))/0xc*(-parseInt(_0xa7d112(0xa3))/0xd);if(_0x56e9c5===_0x74ef22)break;else _0xd277dc['push'](_0xd277dc['shift']());}catch(_0x20b1e5){_0xd277dc['push'](_0xd277dc['shift']());}}}(a47_0x3099,0xcdee1));function a47_0x2bf2(_0x249bb3,_0x5059b1){const _0x309954=a47_0x3099();return a47_0x2bf2=function(_0x2bf2d9,_0x203438){_0x2bf2d9=_0x2bf2d9-0x69;let _0x406d76=_0x309954[_0x2bf2d9];return _0x406d76;},a47_0x2bf2(_0x249bb3,_0x5059b1);}var __importDefault=this&&this['__importDefault']||function(_0x5e0332){const _0x211bbc=a47_0x2bf2;return _0x5e0332&&_0x5e0332[_0x211bbc(0xaa)]?_0x5e0332:{'default':_0x5e0332};};Object[a47_0x28cab2(0xae)](exports,a47_0x28cab2(0xaa),{'value':!![]}),exports['SettingsService']=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x28cab2(0x95))),crypto_1=__importDefault(require(a47_0x28cab2(0x9c))),database_1=__importDefault(require(a47_0x28cab2(0x93)));function a47_0x3099(){const _0x17b859=['ensureSettingsExist','1984314uocBmI','hash','telegram','repeat','payment_success','refund','notificationPaymentFailed','maskApiKey','14754804iDMlqu','isArray','payout','notificationRefund','shop','pk_','sk_','Current\x20password\x20is\x20incorrect','Shop\x20not\x20found','substring','webhookUrl','name','toString','settings','SettingsService','randomBytes','chatId','parse','api_error','findUnique','botApiKey','default','2374852ckMuYx','notificationPaymentSuccess','payment_failed','notificationApiError','75670uefZCB','login','deleteAccount','8icUqjI','57830BGuEGT','delete','../config/database','max','bcryptjs','changePassword','revokeAllApiKeys','webhookEvents','telegramBotApiKey','create','update','crypto','length','2393447uTEHtY','12tQAOTH','notificationLogin','updateTelegramSettings','compare','13icYwTR','string','hex','15570hPRExt','Password\x20confirmation\x20is\x20incorrect','password','shopUrl','__esModule','updateWebhookSettings','1078apmVEi','1hAtGoq','defineProperty','parseWebhookEvents','notificationPayout','6872ckgZlR'];a47_0x3099=function(){return _0x17b859;};return a47_0x3099();}class SettingsService{[a47_0x28cab2(0x72)](_0x48eaf0){const _0x326347=a47_0x28cab2;if(!_0x48eaf0)return'';if(_0x48eaf0[_0x326347(0x9d)]<=0x8)return _0x48eaf0;const _0x35ff16=_0x48eaf0[_0x326347(0x7c)](0x0,0x8),_0x32b0b6='*'[_0x326347(0x6e)](Math[_0x326347(0x94)](0x0,_0x48eaf0['length']-0x8));return _0x35ff16+_0x32b0b6;}[a47_0x28cab2(0xaf)](_0x4902cc){const _0x4d835b=a47_0x28cab2;if(!_0x4902cc)return[];if(Array[_0x4d835b(0x74)](_0x4902cc))return _0x4902cc;if(typeof _0x4902cc===_0x4d835b(0xa4))try{const _0x1704a9=JSON[_0x4d835b(0x84)](_0x4902cc);return Array[_0x4d835b(0x74)](_0x1704a9)?_0x1704a9:[];}catch{return[];}return[];}async['getShopSettings'](_0x536c84){const _0x246452=a47_0x28cab2,_0x3f69e4=await database_1[_0x246452(0x88)][_0x246452(0x77)]['findUnique']({'where':{'id':_0x536c84},'include':{'settings':!![]}});if(!_0x3f69e4)throw new Error(_0x246452(0x7b));let _0x465dfc=_0x3f69e4[_0x246452(0x80)];return!_0x465dfc&&(_0x465dfc=await database_1[_0x246452(0x88)]['shopSettings'][_0x246452(0x9a)]({'data':{'shopId':_0x3f69e4['id']}})),{'fullName':_0x3f69e4[_0x246452(0x7e)],'brand':_0x3f69e4[_0x246452(0x7e)],'merchantUrl':_0x3f69e4[_0x246452(0xa9)],'telegramUsername':_0x3f69e4[_0x246452(0x6d)],'telegramBotApiKey':_0x465dfc[_0x246452(0x99)]?this['maskApiKey'](_0x465dfc['telegramBotApiKey']):null,'telegramChatId':_0x465dfc['telegramChatId'],'webhookUrl':_0x465dfc['webhookUrl'],'webhookEvents':this[_0x246452(0xaf)](_0x465dfc[_0x246452(0x98)]),'notifications':{'payment_success':_0x465dfc[_0x246452(0x8a)],'payment_failed':_0x465dfc['notificationPaymentFailed'],'refund':_0x465dfc[_0x246452(0x76)],'payout':_0x465dfc[_0x246452(0xb0)],'login':_0x465dfc[_0x246452(0xa0)],'api_error':_0x465dfc['notificationApiError']}};}async[a47_0x28cab2(0x96)](_0x42430e,_0x5298ac){const _0xa1a26e=a47_0x28cab2,{currentPassword:_0x1df1a2,newPassword:_0x438811,confirmNewPassword:_0x33c6b2}=_0x5298ac;if(_0x438811!==_0x33c6b2)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x438811['length']<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x26ec7a=await database_1['default'][_0xa1a26e(0x77)]['findUnique']({'where':{'id':_0x42430e},'select':{'password':!![]}});if(!_0x26ec7a)throw new Error(_0xa1a26e(0x7b));const _0x431f0e=await bcryptjs_1[_0xa1a26e(0x88)][_0xa1a26e(0xa2)](_0x1df1a2,_0x26ec7a['password']);if(!_0x431f0e)throw new Error(_0xa1a26e(0x7a));const _0x587bdb=await bcryptjs_1[_0xa1a26e(0x88)][_0xa1a26e(0x6c)](_0x438811,0xc);await database_1[_0xa1a26e(0x88)][_0xa1a26e(0x77)]['update']({'where':{'id':_0x42430e},'data':{'password':_0x587bdb}});}async['updateNotifications'](_0x1f2223,_0x44f8f7){const _0x5ed423=a47_0x28cab2;await this[_0x5ed423(0x6a)](_0x1f2223);const _0x2b6c75={};_0x44f8f7[_0x5ed423(0x6f)]!==undefined&&(_0x2b6c75[_0x5ed423(0x8a)]=_0x44f8f7[_0x5ed423(0x6f)]),_0x44f8f7[_0x5ed423(0x8b)]!==undefined&&(_0x2b6c75[_0x5ed423(0x71)]=_0x44f8f7[_0x5ed423(0x8b)]),_0x44f8f7[_0x5ed423(0x70)]!==undefined&&(_0x2b6c75[_0x5ed423(0x76)]=_0x44f8f7[_0x5ed423(0x70)]),_0x44f8f7['payout']!==undefined&&(_0x2b6c75[_0x5ed423(0xb0)]=_0x44f8f7[_0x5ed423(0x75)]),_0x44f8f7['login']!==undefined&&(_0x2b6c75[_0x5ed423(0xa0)]=_0x44f8f7[_0x5ed423(0x8e)]),_0x44f8f7[_0x5ed423(0x85)]!==undefined&&(_0x2b6c75[_0x5ed423(0x8c)]=_0x44f8f7[_0x5ed423(0x85)]),await database_1[_0x5ed423(0x88)]['shopSettings'][_0x5ed423(0x9b)]({'where':{'shopId':_0x1f2223},'data':_0x2b6c75});}async[a47_0x28cab2(0xa1)](_0x2bc681,_0xa2f46d){const _0x45a583=a47_0x28cab2;await this[_0x45a583(0x6a)](_0x2bc681);const _0x30ae79={};_0xa2f46d[_0x45a583(0x87)]!==undefined&&(_0x30ae79[_0x45a583(0x99)]=_0xa2f46d[_0x45a583(0x87)]||null),_0xa2f46d[_0x45a583(0x83)]!==undefined&&(_0x30ae79['telegramChatId']=_0xa2f46d[_0x45a583(0x83)]||null),await database_1[_0x45a583(0x88)]['shopSettings'][_0x45a583(0x9b)]({'where':{'shopId':_0x2bc681},'data':_0x30ae79});}async[a47_0x28cab2(0xab)](_0x510f97,_0x3b9335){const _0xb687d2=a47_0x28cab2;await this[_0xb687d2(0x6a)](_0x510f97);const _0x1f05fb={};_0x3b9335['webhookUrl']!==undefined&&(_0x1f05fb[_0xb687d2(0x7d)]=_0x3b9335['webhookUrl']||null),_0x3b9335[_0xb687d2(0x98)]!==undefined&&(_0x1f05fb[_0xb687d2(0x98)]=_0x3b9335[_0xb687d2(0x98)]||[]),await database_1['default']['shopSettings']['update']({'where':{'shopId':_0x510f97},'data':_0x1f05fb});}async[a47_0x28cab2(0x97)](_0x2a2cdf){const _0x4656e8=a47_0x28cab2,_0x3a9602=_0x4656e8(0x78)+crypto_1[_0x4656e8(0x88)][_0x4656e8(0x82)](0x20)[_0x4656e8(0x7f)]('hex'),_0xb11294=_0x4656e8(0x79)+crypto_1[_0x4656e8(0x88)][_0x4656e8(0x82)](0x20)['toString'](_0x4656e8(0xa5));await database_1['default'][_0x4656e8(0x77)][_0x4656e8(0x9b)]({'where':{'id':_0x2a2cdf},'data':{'publicKey':_0x3a9602,'secretKey':_0xb11294}});}async[a47_0x28cab2(0x8f)](_0x341f35,_0x10d1b4){const _0x261dc1=a47_0x28cab2,{passwordConfirmation:_0x22e407}=_0x10d1b4,_0x14d854=await database_1[_0x261dc1(0x88)][_0x261dc1(0x77)][_0x261dc1(0x86)]({'where':{'id':_0x341f35},'select':{'password':!![]}});if(!_0x14d854)throw new Error('Shop\x20not\x20found');const _0x59aa80=await bcryptjs_1[_0x261dc1(0x88)][_0x261dc1(0xa2)](_0x22e407,_0x14d854[_0x261dc1(0xa8)]);if(!_0x59aa80)throw new Error(_0x261dc1(0xa7));await database_1['default'][_0x261dc1(0x77)][_0x261dc1(0x92)]({'where':{'id':_0x341f35}});}async[a47_0x28cab2(0x6a)](_0x3bf5be){const _0x190286=a47_0x28cab2,_0x3fc739=await database_1[_0x190286(0x88)]['shopSettings'][_0x190286(0x86)]({'where':{'shopId':_0x3bf5be}});!_0x3fc739&&await database_1['default']['shopSettings'][_0x190286(0x9a)]({'data':{'shopId':_0x3bf5be}});}}exports[a47_0x28cab2(0x81)]=SettingsService;