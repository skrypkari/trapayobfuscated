'use strict';function a64_0x1265(){const _0x3d0932=['payment_success','Current\x20password\x20is\x20incorrect','15718544CuseJw','deleteAccount','max','botApiKey','randomBytes','findUnique','update','notificationPaymentSuccess','Password\x20confirmation\x20is\x20incorrect','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','2416295LHLqDI','2401060wrrOTK','telegramBotApiKey','delete','notificationPayout','default','__importDefault','substring','settings','updateNotifications','Shop\x20not\x20found','ensureSettingsExist','__esModule','../config/database','shopUrl','compare','api_error','5xfbAnp','webhookEvents','1194058tIvUdk','toString','2714086OtRTYf','create','2101164oayYah','notificationRefund','updateWebhookSettings','changePassword','6171888AiPgdc','defineProperty','payment_failed','notificationLogin','payout','string','telegramChatId','login','name','SettingsService','hex','bcryptjs','length','refund','notificationPaymentFailed','notificationApiError','shop','shopSettings','hash','pk_','parseWebhookEvents','crypto','password','isArray','webhookUrl'];a64_0x1265=function(){return _0x3d0932;};return a64_0x1265();}function a64_0x4c9e(_0x1080cd,_0x3f75d2){const _0x12650c=a64_0x1265();return a64_0x4c9e=function(_0x4c9efb,_0x1636c4){_0x4c9efb=_0x4c9efb-0xe8;let _0x36d55d=_0x12650c[_0x4c9efb];return _0x36d55d;},a64_0x4c9e(_0x1080cd,_0x3f75d2);}const a64_0x25afaf=a64_0x4c9e;(function(_0x23272e,_0x131c35){const _0x49acf3=a64_0x4c9e,_0x270082=_0x23272e();while(!![]){try{const _0x37fbac=-parseInt(_0x49acf3(0x108))/0x1+-parseInt(_0x49acf3(0x10a))/0x2+parseInt(_0x49acf3(0x10c))/0x3+-parseInt(_0x49acf3(0xf6))/0x4+parseInt(_0x49acf3(0x106))/0x5*(parseInt(_0x49acf3(0x110))/0x6)+parseInt(_0x49acf3(0xf5))/0x7+parseInt(_0x49acf3(0xeb))/0x8;if(_0x37fbac===_0x131c35)break;else _0x270082['push'](_0x270082['shift']());}catch(_0x5ed6c0){_0x270082['push'](_0x270082['shift']());}}}(a64_0x1265,0xd8b79));var __importDefault=this&&this[a64_0x25afaf(0xfb)]||function(_0x4f8d45){const _0x41a602=a64_0x25afaf;return _0x4f8d45&&_0x4f8d45[_0x41a602(0x101)]?_0x4f8d45:{'default':_0x4f8d45};};Object[a64_0x25afaf(0x111)](exports,a64_0x25afaf(0x101),{'value':!![]}),exports[a64_0x25afaf(0x119)]=void 0x0;const bcryptjs_1=__importDefault(require(a64_0x25afaf(0x11b))),crypto_1=__importDefault(require(a64_0x25afaf(0x125))),database_1=__importDefault(require(a64_0x25afaf(0x102)));class SettingsService{['maskApiKey'](_0x1752c4){const _0x51edc3=a64_0x25afaf;if(!_0x1752c4)return'';if(_0x1752c4[_0x51edc3(0x11c)]<=0x8)return _0x1752c4;const _0x1f1988=_0x1752c4[_0x51edc3(0xfc)](0x0,0x8),_0x32d896='*'['repeat'](Math[_0x51edc3(0xed)](0x0,_0x1752c4[_0x51edc3(0x11c)]-0x8));return _0x1f1988+_0x32d896;}[a64_0x25afaf(0x124)](_0x5d1824){const _0x858bf0=a64_0x25afaf;if(!_0x5d1824)return[];if(Array['isArray'](_0x5d1824))return _0x5d1824;if(typeof _0x5d1824===_0x858bf0(0x115))try{const _0x4a1d24=JSON['parse'](_0x5d1824);return Array[_0x858bf0(0x127)](_0x4a1d24)?_0x4a1d24:[];}catch{return[];}return[];}async['getShopSettings'](_0x12cd74){const _0x2e92e9=a64_0x25afaf,_0x230209=await database_1[_0x2e92e9(0xfa)][_0x2e92e9(0x120)][_0x2e92e9(0xf0)]({'where':{'id':_0x12cd74},'include':{'settings':!![]}});if(!_0x230209)throw new Error('Shop\x20not\x20found');let _0x1685a3=_0x230209[_0x2e92e9(0xfd)];return!_0x1685a3&&(_0x1685a3=await database_1[_0x2e92e9(0xfa)][_0x2e92e9(0x121)][_0x2e92e9(0x10b)]({'data':{'shopId':_0x230209['id']}})),{'fullName':_0x230209[_0x2e92e9(0x118)],'brand':_0x230209[_0x2e92e9(0x118)],'merchantUrl':_0x230209[_0x2e92e9(0x103)],'telegramUsername':_0x230209['telegram'],'telegramBotApiKey':_0x1685a3['telegramBotApiKey']?this['maskApiKey'](_0x1685a3[_0x2e92e9(0xf7)]):null,'telegramChatId':_0x1685a3[_0x2e92e9(0x116)],'webhookUrl':_0x1685a3[_0x2e92e9(0xe8)],'webhookEvents':this['parseWebhookEvents'](_0x1685a3[_0x2e92e9(0x107)]),'notifications':{'payment_success':_0x1685a3[_0x2e92e9(0xf2)],'payment_failed':_0x1685a3[_0x2e92e9(0x11e)],'refund':_0x1685a3[_0x2e92e9(0x10d)],'payout':_0x1685a3[_0x2e92e9(0xf9)],'login':_0x1685a3[_0x2e92e9(0x113)],'api_error':_0x1685a3[_0x2e92e9(0x11f)]}};}async[a64_0x25afaf(0x10f)](_0x46d4c0,_0x323383){const _0x1427c0=a64_0x25afaf,{currentPassword:_0x3b5750,newPassword:_0x1316ee,confirmNewPassword:_0x445640}=_0x323383;if(_0x1316ee!==_0x445640)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x1316ee[_0x1427c0(0x11c)]<0x6)throw new Error(_0x1427c0(0xf4));const _0x866c84=await database_1[_0x1427c0(0xfa)][_0x1427c0(0x120)][_0x1427c0(0xf0)]({'where':{'id':_0x46d4c0},'select':{'password':!![]}});if(!_0x866c84)throw new Error('Shop\x20not\x20found');const _0x4b7556=await bcryptjs_1[_0x1427c0(0xfa)][_0x1427c0(0x104)](_0x3b5750,_0x866c84['password']);if(!_0x4b7556)throw new Error(_0x1427c0(0xea));const _0xb0ff02=await bcryptjs_1['default'][_0x1427c0(0x122)](_0x1316ee,0xc);await database_1[_0x1427c0(0xfa)][_0x1427c0(0x120)][_0x1427c0(0xf1)]({'where':{'id':_0x46d4c0},'data':{'password':_0xb0ff02}});}async[a64_0x25afaf(0xfe)](_0xfadcdc,_0x4a0f17){const _0x1bff35=a64_0x25afaf;await this[_0x1bff35(0x100)](_0xfadcdc);const _0x3c2d68={};_0x4a0f17[_0x1bff35(0xe9)]!==undefined&&(_0x3c2d68[_0x1bff35(0xf2)]=_0x4a0f17[_0x1bff35(0xe9)]),_0x4a0f17[_0x1bff35(0x112)]!==undefined&&(_0x3c2d68[_0x1bff35(0x11e)]=_0x4a0f17[_0x1bff35(0x112)]),_0x4a0f17['refund']!==undefined&&(_0x3c2d68['notificationRefund']=_0x4a0f17[_0x1bff35(0x11d)]),_0x4a0f17[_0x1bff35(0x114)]!==undefined&&(_0x3c2d68[_0x1bff35(0xf9)]=_0x4a0f17['payout']),_0x4a0f17['login']!==undefined&&(_0x3c2d68['notificationLogin']=_0x4a0f17[_0x1bff35(0x117)]),_0x4a0f17['api_error']!==undefined&&(_0x3c2d68['notificationApiError']=_0x4a0f17[_0x1bff35(0x105)]),await database_1[_0x1bff35(0xfa)][_0x1bff35(0x121)][_0x1bff35(0xf1)]({'where':{'shopId':_0xfadcdc},'data':_0x3c2d68});}async['updateTelegramSettings'](_0x4f4e0e,_0x3f6e7f){const _0x734aa5=a64_0x25afaf;await this[_0x734aa5(0x100)](_0x4f4e0e);const _0x3e5f31={};_0x3f6e7f[_0x734aa5(0xee)]!==undefined&&(_0x3e5f31[_0x734aa5(0xf7)]=_0x3f6e7f['botApiKey']||null),_0x3f6e7f['chatId']!==undefined&&(_0x3e5f31[_0x734aa5(0x116)]=_0x3f6e7f['chatId']||null),await database_1[_0x734aa5(0xfa)][_0x734aa5(0x121)][_0x734aa5(0xf1)]({'where':{'shopId':_0x4f4e0e},'data':_0x3e5f31});}async[a64_0x25afaf(0x10e)](_0x2f729e,_0x1598c4){const _0x3d666b=a64_0x25afaf;await this[_0x3d666b(0x100)](_0x2f729e);const _0x280a9f={};_0x1598c4[_0x3d666b(0xe8)]!==undefined&&(_0x280a9f[_0x3d666b(0xe8)]=_0x1598c4[_0x3d666b(0xe8)]||null),_0x1598c4[_0x3d666b(0x107)]!==undefined&&(_0x280a9f[_0x3d666b(0x107)]=_0x1598c4[_0x3d666b(0x107)]||[]),await database_1['default']['shopSettings'][_0x3d666b(0xf1)]({'where':{'shopId':_0x2f729e},'data':_0x280a9f});}async['revokeAllApiKeys'](_0x8212e3){const _0x45633e=a64_0x25afaf,_0x5b4689=_0x45633e(0x123)+crypto_1['default'][_0x45633e(0xef)](0x20)[_0x45633e(0x109)](_0x45633e(0x11a)),_0xae425e='sk_'+crypto_1[_0x45633e(0xfa)]['randomBytes'](0x20)[_0x45633e(0x109)](_0x45633e(0x11a));await database_1['default'][_0x45633e(0x120)][_0x45633e(0xf1)]({'where':{'id':_0x8212e3},'data':{'publicKey':_0x5b4689,'secretKey':_0xae425e}});}async[a64_0x25afaf(0xec)](_0xcfeb4,_0x4ad9e8){const _0x29b358=a64_0x25afaf,{passwordConfirmation:_0x2ca06d}=_0x4ad9e8,_0x14c15e=await database_1['default']['shop'][_0x29b358(0xf0)]({'where':{'id':_0xcfeb4},'select':{'password':!![]}});if(!_0x14c15e)throw new Error(_0x29b358(0xff));const _0x3e7044=await bcryptjs_1[_0x29b358(0xfa)][_0x29b358(0x104)](_0x2ca06d,_0x14c15e[_0x29b358(0x126)]);if(!_0x3e7044)throw new Error(_0x29b358(0xf3));await database_1[_0x29b358(0xfa)][_0x29b358(0x120)][_0x29b358(0xf8)]({'where':{'id':_0xcfeb4}});}async[a64_0x25afaf(0x100)](_0x1e1b00){const _0xd4e3a2=a64_0x25afaf,_0x2e681d=await database_1[_0xd4e3a2(0xfa)][_0xd4e3a2(0x121)][_0xd4e3a2(0xf0)]({'where':{'shopId':_0x1e1b00}});!_0x2e681d&&await database_1[_0xd4e3a2(0xfa)][_0xd4e3a2(0x121)]['create']({'data':{'shopId':_0x1e1b00}});}}exports['SettingsService']=SettingsService;