'use strict';const a52_0x391af8=a52_0xb6db;(function(_0x4c5214,_0x1ae387){const _0x369a3c=a52_0xb6db,_0x1fb869=_0x4c5214();while(!![]){try{const _0x33ee39=-parseInt(_0x369a3c(0x97))/0x1*(-parseInt(_0x369a3c(0xaf))/0x2)+parseInt(_0x369a3c(0x83))/0x3*(-parseInt(_0x369a3c(0x98))/0x4)+-parseInt(_0x369a3c(0xa8))/0x5*(-parseInt(_0x369a3c(0xbb))/0x6)+parseInt(_0x369a3c(0xac))/0x7*(parseInt(_0x369a3c(0xc0))/0x8)+-parseInt(_0x369a3c(0x8e))/0x9+-parseInt(_0x369a3c(0xc3))/0xa*(parseInt(_0x369a3c(0x90))/0xb)+parseInt(_0x369a3c(0xb3))/0xc*(parseInt(_0x369a3c(0xc1))/0xd);if(_0x33ee39===_0x1ae387)break;else _0x1fb869['push'](_0x1fb869['shift']());}catch(_0x116da3){_0x1fb869['push'](_0x1fb869['shift']());}}}(a52_0xf122,0xeff4c));function a52_0xf122(){const _0x419461=['telegramChatId','refund','shop','10102707NbfAED','chatId','11sPWxJs','findUnique','../config/database','shopUrl','crypto','updateTelegramSettings','length','7534iUeeoj','4tNVsTa','defineProperty','parseWebhookEvents','notificationLogin','updateNotifications','login','update','deleteAccount','toString','__importDefault','__esModule','name','hex','Current\x20password\x20is\x20incorrect','notificationRefund','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','1502275cUBHSB','telegramBotApiKey','notificationPayout','notificationApiError','11058418LKSrgK','api_error','create','46PimaTA','repeat','Password\x20confirmation\x20is\x20incorrect','payment_failed','522708oIBjTt','maskApiKey','payout','compare','settings','max','default','parse','6auhxbZ','webhookUrl','notificationPaymentSuccess','notificationPaymentFailed','updateWebhookSettings','8bzztrb','1066TpuFGd','webhookEvents','15583150BcKPJL','getShopSettings','bcryptjs','payment_success','SettingsService','delete','telegram','5884953LDnHvE','ensureSettingsExist','botApiKey','changePassword','shopSettings','randomBytes','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','Shop\x20not\x20found'];a52_0xf122=function(){return _0x419461;};return a52_0xf122();}var __importDefault=this&&this[a52_0x391af8(0xa1)]||function(_0x457d4c){const _0x34f1ca=a52_0x391af8;return _0x457d4c&&_0x457d4c[_0x34f1ca(0xa2)]?_0x457d4c:{'default':_0x457d4c};};Object[a52_0x391af8(0x99)](exports,a52_0x391af8(0xa2),{'value':!![]}),exports[a52_0x391af8(0xc7)]=void 0x0;function a52_0xb6db(_0x44ea2d,_0x32bc7b){const _0xf122a5=a52_0xf122();return a52_0xb6db=function(_0xb6dbc3,_0x3f2901){_0xb6dbc3=_0xb6dbc3-0x81;let _0x590a65=_0xf122a5[_0xb6dbc3];return _0x590a65;},a52_0xb6db(_0x44ea2d,_0x32bc7b);}const bcryptjs_1=__importDefault(require(a52_0x391af8(0xc5))),crypto_1=__importDefault(require(a52_0x391af8(0x94))),database_1=__importDefault(require(a52_0x391af8(0x92)));class SettingsService{[a52_0x391af8(0xb4)](_0x52b96c){const _0x117aac=a52_0x391af8;if(!_0x52b96c)return'';if(_0x52b96c['length']<=0x8)return _0x52b96c;const _0x15bf33=_0x52b96c['substring'](0x0,0x8),_0x1ce895='*'[_0x117aac(0xb0)](Math[_0x117aac(0xb8)](0x0,_0x52b96c[_0x117aac(0x96)]-0x8));return _0x15bf33+_0x1ce895;}[a52_0x391af8(0x9a)](_0x584f5f){const _0xa28d43=a52_0x391af8;if(!_0x584f5f)return[];if(Array['isArray'](_0x584f5f))return _0x584f5f;if(typeof _0x584f5f==='string')try{const _0xeae722=JSON[_0xa28d43(0xba)](_0x584f5f);return Array['isArray'](_0xeae722)?_0xeae722:[];}catch{return[];}return[];}async[a52_0x391af8(0xc4)](_0x53695e){const _0x3fa162=a52_0x391af8,_0x3ab4c5=await database_1[_0x3fa162(0xb9)]['shop']['findUnique']({'where':{'id':_0x53695e},'include':{'settings':!![]}});if(!_0x3ab4c5)throw new Error(_0x3fa162(0x8a));let _0x38ddaa=_0x3ab4c5[_0x3fa162(0xb7)];return!_0x38ddaa&&(_0x38ddaa=await database_1['default'][_0x3fa162(0x87)][_0x3fa162(0xae)]({'data':{'shopId':_0x3ab4c5['id']}})),{'fullName':_0x3ab4c5[_0x3fa162(0xa3)],'brand':_0x3ab4c5[_0x3fa162(0xa3)],'merchantUrl':_0x3ab4c5[_0x3fa162(0x93)],'telegramUsername':_0x3ab4c5[_0x3fa162(0x82)],'telegramBotApiKey':_0x38ddaa['telegramBotApiKey']?this[_0x3fa162(0xb4)](_0x38ddaa[_0x3fa162(0xa9)]):null,'telegramChatId':_0x38ddaa[_0x3fa162(0x8b)],'webhookUrl':_0x38ddaa['webhookUrl'],'webhookEvents':this['parseWebhookEvents'](_0x38ddaa[_0x3fa162(0xc2)]),'notifications':{'payment_success':_0x38ddaa[_0x3fa162(0xbd)],'payment_failed':_0x38ddaa[_0x3fa162(0xbe)],'refund':_0x38ddaa[_0x3fa162(0xa6)],'payout':_0x38ddaa[_0x3fa162(0xaa)],'login':_0x38ddaa[_0x3fa162(0x9b)],'api_error':_0x38ddaa[_0x3fa162(0xab)]}};}async[a52_0x391af8(0x86)](_0x5e607d,_0x2dcb23){const _0x9ece24=a52_0x391af8,{currentPassword:_0x374d2b,newPassword:_0x47b173,confirmNewPassword:_0x301022}=_0x2dcb23;if(_0x47b173!==_0x301022)throw new Error(_0x9ece24(0x89));if(_0x47b173[_0x9ece24(0x96)]<0x6)throw new Error(_0x9ece24(0xa7));const _0x187e0e=await database_1[_0x9ece24(0xb9)][_0x9ece24(0x8d)]['findUnique']({'where':{'id':_0x5e607d},'select':{'password':!![]}});if(!_0x187e0e)throw new Error(_0x9ece24(0x8a));const _0x425a8d=await bcryptjs_1[_0x9ece24(0xb9)][_0x9ece24(0xb6)](_0x374d2b,_0x187e0e['password']);if(!_0x425a8d)throw new Error(_0x9ece24(0xa5));const _0x287671=await bcryptjs_1[_0x9ece24(0xb9)]['hash'](_0x47b173,0xc);await database_1[_0x9ece24(0xb9)][_0x9ece24(0x8d)][_0x9ece24(0x9e)]({'where':{'id':_0x5e607d},'data':{'password':_0x287671}});}async[a52_0x391af8(0x9c)](_0x87c31e,_0x445f0b){const _0x74f41=a52_0x391af8;await this['ensureSettingsExist'](_0x87c31e);const _0x18d5b2={};_0x445f0b[_0x74f41(0xc6)]!==undefined&&(_0x18d5b2[_0x74f41(0xbd)]=_0x445f0b['payment_success']),_0x445f0b[_0x74f41(0xb2)]!==undefined&&(_0x18d5b2['notificationPaymentFailed']=_0x445f0b[_0x74f41(0xb2)]),_0x445f0b[_0x74f41(0x8c)]!==undefined&&(_0x18d5b2['notificationRefund']=_0x445f0b[_0x74f41(0x8c)]),_0x445f0b[_0x74f41(0xb5)]!==undefined&&(_0x18d5b2[_0x74f41(0xaa)]=_0x445f0b['payout']),_0x445f0b['login']!==undefined&&(_0x18d5b2[_0x74f41(0x9b)]=_0x445f0b[_0x74f41(0x9d)]),_0x445f0b[_0x74f41(0xad)]!==undefined&&(_0x18d5b2[_0x74f41(0xab)]=_0x445f0b[_0x74f41(0xad)]),await database_1[_0x74f41(0xb9)][_0x74f41(0x87)]['update']({'where':{'shopId':_0x87c31e},'data':_0x18d5b2});}async[a52_0x391af8(0x95)](_0x3f09fd,_0x27eb23){const _0x4950f2=a52_0x391af8;await this['ensureSettingsExist'](_0x3f09fd);const _0x575586={};_0x27eb23['botApiKey']!==undefined&&(_0x575586[_0x4950f2(0xa9)]=_0x27eb23[_0x4950f2(0x85)]||null),_0x27eb23[_0x4950f2(0x8f)]!==undefined&&(_0x575586[_0x4950f2(0x8b)]=_0x27eb23['chatId']||null),await database_1['default']['shopSettings'][_0x4950f2(0x9e)]({'where':{'shopId':_0x3f09fd},'data':_0x575586});}async[a52_0x391af8(0xbf)](_0xbfea44,_0x3d164e){const _0x4aceb7=a52_0x391af8;await this[_0x4aceb7(0x84)](_0xbfea44);const _0x3cac86={};_0x3d164e[_0x4aceb7(0xbc)]!==undefined&&(_0x3cac86[_0x4aceb7(0xbc)]=_0x3d164e[_0x4aceb7(0xbc)]||null),_0x3d164e[_0x4aceb7(0xc2)]!==undefined&&(_0x3cac86[_0x4aceb7(0xc2)]=_0x3d164e[_0x4aceb7(0xc2)]||[]),await database_1[_0x4aceb7(0xb9)][_0x4aceb7(0x87)][_0x4aceb7(0x9e)]({'where':{'shopId':_0xbfea44},'data':_0x3cac86});}async['revokeAllApiKeys'](_0x15b44f){const _0x499a6a=a52_0x391af8,_0x290402='pk_'+crypto_1[_0x499a6a(0xb9)][_0x499a6a(0x88)](0x20)['toString'](_0x499a6a(0xa4)),_0x2c7779='sk_'+crypto_1[_0x499a6a(0xb9)]['randomBytes'](0x20)[_0x499a6a(0xa0)]('hex');await database_1[_0x499a6a(0xb9)]['shop'][_0x499a6a(0x9e)]({'where':{'id':_0x15b44f},'data':{'publicKey':_0x290402,'secretKey':_0x2c7779}});}async[a52_0x391af8(0x9f)](_0x554ff5,_0x490888){const _0x3ef454=a52_0x391af8,{passwordConfirmation:_0x198bc5}=_0x490888,_0x1762fa=await database_1[_0x3ef454(0xb9)][_0x3ef454(0x8d)][_0x3ef454(0x91)]({'where':{'id':_0x554ff5},'select':{'password':!![]}});if(!_0x1762fa)throw new Error('Shop\x20not\x20found');const _0x2e2b00=await bcryptjs_1['default']['compare'](_0x198bc5,_0x1762fa['password']);if(!_0x2e2b00)throw new Error(_0x3ef454(0xb1));await database_1['default'][_0x3ef454(0x8d)][_0x3ef454(0x81)]({'where':{'id':_0x554ff5}});}async['ensureSettingsExist'](_0x2e483f){const _0x1011a7=a52_0x391af8,_0x2c3024=await database_1[_0x1011a7(0xb9)]['shopSettings'][_0x1011a7(0x91)]({'where':{'shopId':_0x2e483f}});!_0x2c3024&&await database_1[_0x1011a7(0xb9)]['shopSettings'][_0x1011a7(0xae)]({'data':{'shopId':_0x2e483f}});}}exports[a52_0x391af8(0xc7)]=SettingsService;