'use strict';const a61_0x3e2ed5=a61_0x5a7b;function a61_0x5a7b(_0x35ecd6,_0x494556){const _0x19e2b4=a61_0x19e2();return a61_0x5a7b=function(_0x5a7ba7,_0x1f525e){_0x5a7ba7=_0x5a7ba7-0x114;let _0x152df6=_0x19e2b4[_0x5a7ba7];return _0x152df6;},a61_0x5a7b(_0x35ecd6,_0x494556);}(function(_0x126a0a,_0x47fb72){const _0x4ae8e4=a61_0x5a7b,_0x333066=_0x126a0a();while(!![]){try{const _0x3711f6=parseInt(_0x4ae8e4(0x138))/0x1*(parseInt(_0x4ae8e4(0x123))/0x2)+parseInt(_0x4ae8e4(0x13b))/0x3*(parseInt(_0x4ae8e4(0x140))/0x4)+parseInt(_0x4ae8e4(0x12f))/0x5+parseInt(_0x4ae8e4(0x124))/0x6+parseInt(_0x4ae8e4(0x132))/0x7+parseInt(_0x4ae8e4(0x129))/0x8*(parseInt(_0x4ae8e4(0x114))/0x9)+-parseInt(_0x4ae8e4(0x137))/0xa;if(_0x3711f6===_0x47fb72)break;else _0x333066['push'](_0x333066['shift']());}catch(_0x5cdd64){_0x333066['push'](_0x333066['shift']());}}}(a61_0x19e2,0x58eec));var __importDefault=this&&this[a61_0x3e2ed5(0x148)]||function(_0x48c998){const _0x1908d4=a61_0x3e2ed5;return _0x48c998&&_0x48c998[_0x1908d4(0x127)]?_0x48c998:{'default':_0x48c998};};function a61_0x19e2(){const _0x4c19a2=['findUnique','substring','create','notificationPaymentSuccess','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','hex','1492yzAxre','530400ZCvCsn','length','update','__esModule','delete','440PzlJMp','telegramChatId','notificationPaymentFailed','pk_','updateWebhookSettings','SettingsService','164310EDWEkP','notificationApiError','telegram','110194qdViqF','Current\x20password\x20is\x20incorrect','notificationLogin','parseWebhookEvents','changePassword','6743340WakSND','720TMOVKg','api_error','password','132543PfphEi','shopSettings','payout','parse','telegramBotApiKey','12sKYMjD','getShopSettings','settings','randomBytes','chatId','updateNotifications','bcryptjs','botApiKey','__importDefault','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','Shop\x20not\x20found','maskApiKey','refund','notificationRefund','notificationPayout','login','name','payment_success','defineProperty','shop','webhookEvents','webhookUrl','Password\x20confirmation\x20is\x20incorrect','37953QlxnMO','compare','shopUrl','crypto','ensureSettingsExist','payment_failed','toString','default','deleteAccount'];a61_0x19e2=function(){return _0x4c19a2;};return a61_0x19e2();}Object[a61_0x3e2ed5(0x152)](exports,a61_0x3e2ed5(0x127),{'value':!![]}),exports[a61_0x3e2ed5(0x12e)]=void 0x0;const bcryptjs_1=__importDefault(require(a61_0x3e2ed5(0x146))),crypto_1=__importDefault(require(a61_0x3e2ed5(0x117))),database_1=__importDefault(require('../config/database'));class SettingsService{[a61_0x3e2ed5(0x14b)](_0x2d93ab){const _0x55a5b5=a61_0x3e2ed5;if(!_0x2d93ab)return'';if(_0x2d93ab[_0x55a5b5(0x125)]<=0x8)return _0x2d93ab;const _0x214b92=_0x2d93ab[_0x55a5b5(0x11e)](0x0,0x8),_0x2a8ea5='*'['repeat'](Math['max'](0x0,_0x2d93ab[_0x55a5b5(0x125)]-0x8));return _0x214b92+_0x2a8ea5;}[a61_0x3e2ed5(0x135)](_0x318b33){const _0x58ab29=a61_0x3e2ed5;if(!_0x318b33)return[];if(Array['isArray'](_0x318b33))return _0x318b33;if(typeof _0x318b33==='string')try{const _0xdfc222=JSON[_0x58ab29(0x13e)](_0x318b33);return Array['isArray'](_0xdfc222)?_0xdfc222:[];}catch{return[];}return[];}async[a61_0x3e2ed5(0x141)](_0xd6705f){const _0x37f492=a61_0x3e2ed5,_0x301a51=await database_1[_0x37f492(0x11b)][_0x37f492(0x153)]['findUnique']({'where':{'id':_0xd6705f},'include':{'settings':!![]}});if(!_0x301a51)throw new Error(_0x37f492(0x14a));let _0x47ec94=_0x301a51[_0x37f492(0x142)];return!_0x47ec94&&(_0x47ec94=await database_1['default'][_0x37f492(0x13c)][_0x37f492(0x11f)]({'data':{'shopId':_0x301a51['id']}})),{'fullName':_0x301a51['name'],'brand':_0x301a51[_0x37f492(0x150)],'merchantUrl':_0x301a51[_0x37f492(0x116)],'telegramUsername':_0x301a51[_0x37f492(0x131)],'telegramBotApiKey':_0x47ec94[_0x37f492(0x13f)]?this[_0x37f492(0x14b)](_0x47ec94[_0x37f492(0x13f)]):null,'telegramChatId':_0x47ec94[_0x37f492(0x12a)],'webhookUrl':_0x47ec94['webhookUrl'],'webhookEvents':this[_0x37f492(0x135)](_0x47ec94['webhookEvents']),'notifications':{'payment_success':_0x47ec94['notificationPaymentSuccess'],'payment_failed':_0x47ec94[_0x37f492(0x12b)],'refund':_0x47ec94[_0x37f492(0x14d)],'payout':_0x47ec94[_0x37f492(0x14e)],'login':_0x47ec94[_0x37f492(0x134)],'api_error':_0x47ec94[_0x37f492(0x130)]}};}async[a61_0x3e2ed5(0x136)](_0x56ad99,_0x1350a4){const _0x153e23=a61_0x3e2ed5,{currentPassword:_0x328ebb,newPassword:_0x4cd2bb,confirmNewPassword:_0x391f65}=_0x1350a4;if(_0x4cd2bb!==_0x391f65)throw new Error(_0x153e23(0x121));if(_0x4cd2bb[_0x153e23(0x125)]<0x6)throw new Error(_0x153e23(0x149));const _0x5b44f5=await database_1[_0x153e23(0x11b)][_0x153e23(0x153)][_0x153e23(0x11d)]({'where':{'id':_0x56ad99},'select':{'password':!![]}});if(!_0x5b44f5)throw new Error('Shop\x20not\x20found');const _0xcd04df=await bcryptjs_1[_0x153e23(0x11b)][_0x153e23(0x115)](_0x328ebb,_0x5b44f5[_0x153e23(0x13a)]);if(!_0xcd04df)throw new Error(_0x153e23(0x133));const _0x5be7bb=await bcryptjs_1[_0x153e23(0x11b)]['hash'](_0x4cd2bb,0xc);await database_1['default'][_0x153e23(0x153)]['update']({'where':{'id':_0x56ad99},'data':{'password':_0x5be7bb}});}async[a61_0x3e2ed5(0x145)](_0x42c09a,_0x331252){const _0x4f6843=a61_0x3e2ed5;await this[_0x4f6843(0x118)](_0x42c09a);const _0x102c23={};_0x331252[_0x4f6843(0x151)]!==undefined&&(_0x102c23[_0x4f6843(0x120)]=_0x331252[_0x4f6843(0x151)]),_0x331252[_0x4f6843(0x119)]!==undefined&&(_0x102c23[_0x4f6843(0x12b)]=_0x331252[_0x4f6843(0x119)]),_0x331252[_0x4f6843(0x14c)]!==undefined&&(_0x102c23['notificationRefund']=_0x331252[_0x4f6843(0x14c)]),_0x331252[_0x4f6843(0x13d)]!==undefined&&(_0x102c23[_0x4f6843(0x14e)]=_0x331252[_0x4f6843(0x13d)]),_0x331252[_0x4f6843(0x14f)]!==undefined&&(_0x102c23[_0x4f6843(0x134)]=_0x331252[_0x4f6843(0x14f)]),_0x331252[_0x4f6843(0x139)]!==undefined&&(_0x102c23[_0x4f6843(0x130)]=_0x331252['api_error']),await database_1[_0x4f6843(0x11b)][_0x4f6843(0x13c)][_0x4f6843(0x126)]({'where':{'shopId':_0x42c09a},'data':_0x102c23});}async['updateTelegramSettings'](_0x398441,_0x1de2a1){const _0x11b707=a61_0x3e2ed5;await this['ensureSettingsExist'](_0x398441);const _0x356a82={};_0x1de2a1['botApiKey']!==undefined&&(_0x356a82[_0x11b707(0x13f)]=_0x1de2a1[_0x11b707(0x147)]||null),_0x1de2a1[_0x11b707(0x144)]!==undefined&&(_0x356a82[_0x11b707(0x12a)]=_0x1de2a1[_0x11b707(0x144)]||null),await database_1[_0x11b707(0x11b)][_0x11b707(0x13c)][_0x11b707(0x126)]({'where':{'shopId':_0x398441},'data':_0x356a82});}async[a61_0x3e2ed5(0x12d)](_0x12f183,_0x57b79c){const _0x3ec8a4=a61_0x3e2ed5;await this[_0x3ec8a4(0x118)](_0x12f183);const _0x2b72e3={};_0x57b79c['webhookUrl']!==undefined&&(_0x2b72e3['webhookUrl']=_0x57b79c[_0x3ec8a4(0x155)]||null),_0x57b79c[_0x3ec8a4(0x154)]!==undefined&&(_0x2b72e3[_0x3ec8a4(0x154)]=_0x57b79c['webhookEvents']||[]),await database_1[_0x3ec8a4(0x11b)][_0x3ec8a4(0x13c)]['update']({'where':{'shopId':_0x12f183},'data':_0x2b72e3});}async['revokeAllApiKeys'](_0x571c96){const _0x42ad7b=a61_0x3e2ed5,_0x2d3687=_0x42ad7b(0x12c)+crypto_1[_0x42ad7b(0x11b)][_0x42ad7b(0x143)](0x20)[_0x42ad7b(0x11a)](_0x42ad7b(0x122)),_0x2a7918='sk_'+crypto_1[_0x42ad7b(0x11b)][_0x42ad7b(0x143)](0x20)['toString'](_0x42ad7b(0x122));await database_1[_0x42ad7b(0x11b)]['shop'][_0x42ad7b(0x126)]({'where':{'id':_0x571c96},'data':{'publicKey':_0x2d3687,'secretKey':_0x2a7918}});}async[a61_0x3e2ed5(0x11c)](_0x5ce29f,_0x501c71){const _0x4008f2=a61_0x3e2ed5,{passwordConfirmation:_0x155962}=_0x501c71,_0x453327=await database_1[_0x4008f2(0x11b)]['shop'][_0x4008f2(0x11d)]({'where':{'id':_0x5ce29f},'select':{'password':!![]}});if(!_0x453327)throw new Error(_0x4008f2(0x14a));const _0xb395da=await bcryptjs_1[_0x4008f2(0x11b)][_0x4008f2(0x115)](_0x155962,_0x453327['password']);if(!_0xb395da)throw new Error(_0x4008f2(0x156));await database_1['default'][_0x4008f2(0x153)][_0x4008f2(0x128)]({'where':{'id':_0x5ce29f}});}async[a61_0x3e2ed5(0x118)](_0x1279a0){const _0x1b573b=a61_0x3e2ed5,_0xf1919e=await database_1[_0x1b573b(0x11b)][_0x1b573b(0x13c)]['findUnique']({'where':{'shopId':_0x1279a0}});!_0xf1919e&&await database_1[_0x1b573b(0x11b)][_0x1b573b(0x13c)][_0x1b573b(0x11f)]({'data':{'shopId':_0x1279a0}});}}exports[a61_0x3e2ed5(0x12e)]=SettingsService;