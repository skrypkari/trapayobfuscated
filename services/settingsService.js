'use strict';const a52_0x4f692a=a52_0x9172;function a52_0x9172(_0x3b0f89,_0x30d0a0){const _0x388aa0=a52_0x388a();return a52_0x9172=function(_0x917228,_0x1a7384){_0x917228=_0x917228-0xae;let _0x5c51af=_0x388aa0[_0x917228];return _0x5c51af;},a52_0x9172(_0x3b0f89,_0x30d0a0);}(function(_0x164e1b,_0x466fb2){const _0x533fe6=a52_0x9172,_0x42ebe0=_0x164e1b();while(!![]){try{const _0x4d61bf=parseInt(_0x533fe6(0xb7))/0x1+parseInt(_0x533fe6(0xc0))/0x2+-parseInt(_0x533fe6(0xd7))/0x3+parseInt(_0x533fe6(0xed))/0x4+-parseInt(_0x533fe6(0xcc))/0x5+parseInt(_0x533fe6(0xf0))/0x6*(parseInt(_0x533fe6(0xdf))/0x7)+-parseInt(_0x533fe6(0xc5))/0x8*(-parseInt(_0x533fe6(0xb2))/0x9);if(_0x4d61bf===_0x466fb2)break;else _0x42ebe0['push'](_0x42ebe0['shift']());}catch(_0x287678){_0x42ebe0['push'](_0x42ebe0['shift']());}}}(a52_0x388a,0x1f21d));function a52_0x388a(){const _0x501692=['revokeAllApiKeys','18UTwARJ','randomBytes','api_error','Shop\x20not\x20found','length','144655rkswCV','default','hex','maskApiKey','bcryptjs','pk_','notificationPaymentFailed','getShopSettings','chatId','115376zDlMLR','telegram','shop','update','hash','12968ZQkfYC','parse','notificationLogin','notificationApiError','findUnique','Current\x20password\x20is\x20incorrect','payout','1210460wOrJIk','isArray','changePassword','telegramChatId','substring','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','__esModule','compare','repeat','toString','shopUrl','106194JZouSh','settings','create','../config/database','sk_','Password\x20confirmation\x20is\x20incorrect','SettingsService','defineProperty','21xIvtFE','login','botApiKey','payment_success','webhookUrl','string','payment_failed','name','notificationRefund','crypto','shopSettings','ensureSettingsExist','refund','notificationPaymentSuccess','528144pNcexf','updateTelegramSettings','parseWebhookEvents','134772nKOatV','notificationPayout','telegramBotApiKey','deleteAccount','webhookEvents'];a52_0x388a=function(){return _0x501692;};return a52_0x388a();}var __importDefault=this&&this['__importDefault']||function(_0x963ca8){return _0x963ca8&&_0x963ca8['__esModule']?_0x963ca8:{'default':_0x963ca8};};Object[a52_0x4f692a(0xde)](exports,a52_0x4f692a(0xd2),{'value':!![]}),exports[a52_0x4f692a(0xdd)]=void 0x0;const bcryptjs_1=__importDefault(require(a52_0x4f692a(0xbb))),crypto_1=__importDefault(require(a52_0x4f692a(0xe8))),database_1=__importDefault(require(a52_0x4f692a(0xda)));class SettingsService{['maskApiKey'](_0x4d0863){const _0x470c2a=a52_0x4f692a;if(!_0x4d0863)return'';if(_0x4d0863['length']<=0x8)return _0x4d0863;const _0x47b971=_0x4d0863[_0x470c2a(0xd0)](0x0,0x8),_0x1006f0='*'[_0x470c2a(0xd4)](Math['max'](0x0,_0x4d0863[_0x470c2a(0xb6)]-0x8));return _0x47b971+_0x1006f0;}['parseWebhookEvents'](_0xd792e2){const _0x220cb5=a52_0x4f692a;if(!_0xd792e2)return[];if(Array[_0x220cb5(0xcd)](_0xd792e2))return _0xd792e2;if(typeof _0xd792e2===_0x220cb5(0xe4))try{const _0x51bed5=JSON[_0x220cb5(0xc6)](_0xd792e2);return Array[_0x220cb5(0xcd)](_0x51bed5)?_0x51bed5:[];}catch{return[];}return[];}async[a52_0x4f692a(0xbe)](_0x3e8aab){const _0x5c2deb=a52_0x4f692a,_0x16ab77=await database_1['default'][_0x5c2deb(0xc2)][_0x5c2deb(0xc9)]({'where':{'id':_0x3e8aab},'include':{'settings':!![]}});if(!_0x16ab77)throw new Error(_0x5c2deb(0xb5));let _0x8943cd=_0x16ab77[_0x5c2deb(0xd8)];return!_0x8943cd&&(_0x8943cd=await database_1['default'][_0x5c2deb(0xe9)][_0x5c2deb(0xd9)]({'data':{'shopId':_0x16ab77['id']}})),{'fullName':_0x16ab77[_0x5c2deb(0xe6)],'brand':_0x16ab77[_0x5c2deb(0xe6)],'merchantUrl':_0x16ab77[_0x5c2deb(0xd6)],'telegramUsername':_0x16ab77[_0x5c2deb(0xc1)],'telegramBotApiKey':_0x8943cd['telegramBotApiKey']?this[_0x5c2deb(0xba)](_0x8943cd['telegramBotApiKey']):null,'telegramChatId':_0x8943cd['telegramChatId'],'webhookUrl':_0x8943cd[_0x5c2deb(0xe3)],'webhookEvents':this[_0x5c2deb(0xef)](_0x8943cd[_0x5c2deb(0xb0)]),'notifications':{'payment_success':_0x8943cd[_0x5c2deb(0xec)],'payment_failed':_0x8943cd['notificationPaymentFailed'],'refund':_0x8943cd[_0x5c2deb(0xe7)],'payout':_0x8943cd[_0x5c2deb(0xf1)],'login':_0x8943cd[_0x5c2deb(0xc7)],'api_error':_0x8943cd[_0x5c2deb(0xc8)]}};}async[a52_0x4f692a(0xce)](_0x29c142,_0x17d73e){const _0x53b69d=a52_0x4f692a,{currentPassword:_0x4f8a85,newPassword:_0x36fa2a,confirmNewPassword:_0x3ece05}=_0x17d73e;if(_0x36fa2a!==_0x3ece05)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x36fa2a['length']<0x6)throw new Error(_0x53b69d(0xd1));const _0x18123b=await database_1[_0x53b69d(0xb8)][_0x53b69d(0xc2)][_0x53b69d(0xc9)]({'where':{'id':_0x29c142},'select':{'password':!![]}});if(!_0x18123b)throw new Error(_0x53b69d(0xb5));const _0x51179f=await bcryptjs_1['default'][_0x53b69d(0xd3)](_0x4f8a85,_0x18123b['password']);if(!_0x51179f)throw new Error(_0x53b69d(0xca));const _0x512bb5=await bcryptjs_1[_0x53b69d(0xb8)][_0x53b69d(0xc4)](_0x36fa2a,0xc);await database_1[_0x53b69d(0xb8)][_0x53b69d(0xc2)][_0x53b69d(0xc3)]({'where':{'id':_0x29c142},'data':{'password':_0x512bb5}});}async['updateNotifications'](_0x585ad0,_0xa4c6c9){const _0x33233a=a52_0x4f692a;await this[_0x33233a(0xea)](_0x585ad0);const _0x50e404={};_0xa4c6c9[_0x33233a(0xe2)]!==undefined&&(_0x50e404[_0x33233a(0xec)]=_0xa4c6c9[_0x33233a(0xe2)]),_0xa4c6c9[_0x33233a(0xe5)]!==undefined&&(_0x50e404[_0x33233a(0xbd)]=_0xa4c6c9[_0x33233a(0xe5)]),_0xa4c6c9[_0x33233a(0xeb)]!==undefined&&(_0x50e404['notificationRefund']=_0xa4c6c9[_0x33233a(0xeb)]),_0xa4c6c9[_0x33233a(0xcb)]!==undefined&&(_0x50e404[_0x33233a(0xf1)]=_0xa4c6c9[_0x33233a(0xcb)]),_0xa4c6c9[_0x33233a(0xe0)]!==undefined&&(_0x50e404[_0x33233a(0xc7)]=_0xa4c6c9[_0x33233a(0xe0)]),_0xa4c6c9['api_error']!==undefined&&(_0x50e404[_0x33233a(0xc8)]=_0xa4c6c9[_0x33233a(0xb4)]),await database_1[_0x33233a(0xb8)]['shopSettings'][_0x33233a(0xc3)]({'where':{'shopId':_0x585ad0},'data':_0x50e404});}async[a52_0x4f692a(0xee)](_0x6438bc,_0x740a71){const _0x1e6941=a52_0x4f692a;await this[_0x1e6941(0xea)](_0x6438bc);const _0x23f5f8={};_0x740a71[_0x1e6941(0xe1)]!==undefined&&(_0x23f5f8[_0x1e6941(0xae)]=_0x740a71['botApiKey']||null),_0x740a71[_0x1e6941(0xbf)]!==undefined&&(_0x23f5f8[_0x1e6941(0xcf)]=_0x740a71[_0x1e6941(0xbf)]||null),await database_1['default']['shopSettings'][_0x1e6941(0xc3)]({'where':{'shopId':_0x6438bc},'data':_0x23f5f8});}async['updateWebhookSettings'](_0x2d06fb,_0x1086df){const _0x450d04=a52_0x4f692a;await this[_0x450d04(0xea)](_0x2d06fb);const _0x42579e={};_0x1086df['webhookUrl']!==undefined&&(_0x42579e[_0x450d04(0xe3)]=_0x1086df['webhookUrl']||null),_0x1086df['webhookEvents']!==undefined&&(_0x42579e[_0x450d04(0xb0)]=_0x1086df[_0x450d04(0xb0)]||[]),await database_1[_0x450d04(0xb8)][_0x450d04(0xe9)][_0x450d04(0xc3)]({'where':{'shopId':_0x2d06fb},'data':_0x42579e});}async[a52_0x4f692a(0xb1)](_0x53d185){const _0x840793=a52_0x4f692a,_0x11aa7d=_0x840793(0xbc)+crypto_1[_0x840793(0xb8)]['randomBytes'](0x20)['toString'](_0x840793(0xb9)),_0x1e218a=_0x840793(0xdb)+crypto_1[_0x840793(0xb8)][_0x840793(0xb3)](0x20)[_0x840793(0xd5)](_0x840793(0xb9));await database_1[_0x840793(0xb8)][_0x840793(0xc2)][_0x840793(0xc3)]({'where':{'id':_0x53d185},'data':{'publicKey':_0x11aa7d,'secretKey':_0x1e218a}});}async[a52_0x4f692a(0xaf)](_0x2591e4,_0x445e6b){const _0x27f7ed=a52_0x4f692a,{passwordConfirmation:_0x2542f4}=_0x445e6b,_0x3db036=await database_1[_0x27f7ed(0xb8)]['shop']['findUnique']({'where':{'id':_0x2591e4},'select':{'password':!![]}});if(!_0x3db036)throw new Error(_0x27f7ed(0xb5));const _0x1ac5e8=await bcryptjs_1[_0x27f7ed(0xb8)][_0x27f7ed(0xd3)](_0x2542f4,_0x3db036['password']);if(!_0x1ac5e8)throw new Error(_0x27f7ed(0xdc));await database_1[_0x27f7ed(0xb8)][_0x27f7ed(0xc2)]['delete']({'where':{'id':_0x2591e4}});}async[a52_0x4f692a(0xea)](_0xc2e9c9){const _0x388239=a52_0x4f692a,_0x377e02=await database_1[_0x388239(0xb8)][_0x388239(0xe9)]['findUnique']({'where':{'shopId':_0xc2e9c9}});!_0x377e02&&await database_1['default'][_0x388239(0xe9)]['create']({'data':{'shopId':_0xc2e9c9}});}}exports['SettingsService']=SettingsService;