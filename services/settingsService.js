'use strict';const a51_0x5acf1f=a51_0x341b;(function(_0x5a0267,_0x2d0261){const _0x2fe255=a51_0x341b,_0x400411=_0x5a0267();while(!![]){try{const _0x389511=parseInt(_0x2fe255(0x9e))/0x1+parseInt(_0x2fe255(0xa3))/0x2+-parseInt(_0x2fe255(0xc2))/0x3*(parseInt(_0x2fe255(0xc3))/0x4)+-parseInt(_0x2fe255(0xae))/0x5+parseInt(_0x2fe255(0xa6))/0x6*(-parseInt(_0x2fe255(0xb9))/0x7)+-parseInt(_0x2fe255(0xab))/0x8*(parseInt(_0x2fe255(0xb7))/0x9)+parseInt(_0x2fe255(0x91))/0xa*(parseInt(_0x2fe255(0xcb))/0xb);if(_0x389511===_0x2d0261)break;else _0x400411['push'](_0x400411['shift']());}catch(_0x14f2f9){_0x400411['push'](_0x400411['shift']());}}}(a51_0x29fa,0x87164));function a51_0x29fa(){const _0x4dbaf1=['bcryptjs','telegram','toString','string','botApiKey','telegramBotApiKey','SettingsService','333uZtTgv','parse','5936qptFBx','update','randomBytes','notificationRefund','substring','payment_success','getShopSettings','create','max','3pbdeAY','1982804MBPeIk','defineProperty','shop','Password\x20confirmation\x20is\x20incorrect','password','deleteAccount','hash','updateWebhookSettings','33uoInwp','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','webhookUrl','settings','findUnique','length','maskApiKey','changePassword','payout','crypto','default','parseWebhookEvents','6681160cUOgqz','notificationPayout','chatId','refund','Shop\x20not\x20found','name','shopSettings','telegramChatId','repeat','revokeAllApiKeys','pk_','notificationLogin','delete','674499CUdbVw','sk_','Current\x20password\x20is\x20incorrect','notificationPaymentSuccess','ensureSettingsExist','647284wTRCzU','notificationApiError','__esModule','4986bZRwTr','shopUrl','webhookEvents','isArray','updateTelegramSettings','174672pBdbgP','payment_failed','hex','2204630ExnTIw','login'];a51_0x29fa=function(){return _0x4dbaf1;};return a51_0x29fa();}var __importDefault=this&&this['__importDefault']||function(_0x224ef4){const _0x501360=a51_0x341b;return _0x224ef4&&_0x224ef4[_0x501360(0xa5)]?_0x224ef4:{'default':_0x224ef4};};Object[a51_0x5acf1f(0xc4)](exports,a51_0x5acf1f(0xa5),{'value':!![]}),exports[a51_0x5acf1f(0xb6)]=void 0x0;const bcryptjs_1=__importDefault(require(a51_0x5acf1f(0xb0))),crypto_1=__importDefault(require(a51_0x5acf1f(0x8e))),database_1=__importDefault(require('../config/database'));class SettingsService{[a51_0x5acf1f(0xd1)](_0x21a2bc){const _0x331ba4=a51_0x5acf1f;if(!_0x21a2bc)return'';if(_0x21a2bc['length']<=0x8)return _0x21a2bc;const _0x1a5a67=_0x21a2bc[_0x331ba4(0xbd)](0x0,0x8),_0x45e52f='*'[_0x331ba4(0x99)](Math[_0x331ba4(0xc1)](0x0,_0x21a2bc[_0x331ba4(0xd0)]-0x8));return _0x1a5a67+_0x45e52f;}[a51_0x5acf1f(0x90)](_0x24d6c2){const _0x2261bc=a51_0x5acf1f;if(!_0x24d6c2)return[];if(Array[_0x2261bc(0xa9)](_0x24d6c2))return _0x24d6c2;if(typeof _0x24d6c2===_0x2261bc(0xb3))try{const _0xd1855=JSON[_0x2261bc(0xb8)](_0x24d6c2);return Array[_0x2261bc(0xa9)](_0xd1855)?_0xd1855:[];}catch{return[];}return[];}async[a51_0x5acf1f(0xbf)](_0x434694){const _0x54134a=a51_0x5acf1f,_0x5b692f=await database_1[_0x54134a(0x8f)][_0x54134a(0xc5)][_0x54134a(0xcf)]({'where':{'id':_0x434694},'include':{'settings':!![]}});if(!_0x5b692f)throw new Error(_0x54134a(0x95));let _0x1ae680=_0x5b692f[_0x54134a(0xce)];return!_0x1ae680&&(_0x1ae680=await database_1[_0x54134a(0x8f)]['shopSettings'][_0x54134a(0xc0)]({'data':{'shopId':_0x5b692f['id']}})),{'fullName':_0x5b692f[_0x54134a(0x96)],'brand':_0x5b692f[_0x54134a(0x96)],'merchantUrl':_0x5b692f[_0x54134a(0xa7)],'telegramUsername':_0x5b692f[_0x54134a(0xb1)],'telegramBotApiKey':_0x1ae680[_0x54134a(0xb5)]?this['maskApiKey'](_0x1ae680[_0x54134a(0xb5)]):null,'telegramChatId':_0x1ae680[_0x54134a(0x98)],'webhookUrl':_0x1ae680[_0x54134a(0xcd)],'webhookEvents':this[_0x54134a(0x90)](_0x1ae680[_0x54134a(0xa8)]),'notifications':{'payment_success':_0x1ae680[_0x54134a(0xa1)],'payment_failed':_0x1ae680['notificationPaymentFailed'],'refund':_0x1ae680[_0x54134a(0xbc)],'payout':_0x1ae680['notificationPayout'],'login':_0x1ae680['notificationLogin'],'api_error':_0x1ae680[_0x54134a(0xa4)]}};}async[a51_0x5acf1f(0xd2)](_0x3a0daf,_0x166fe3){const _0x3a5c30=a51_0x5acf1f,{currentPassword:_0x3005c0,newPassword:_0xd2d386,confirmNewPassword:_0x487291}=_0x166fe3;if(_0xd2d386!==_0x487291)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0xd2d386[_0x3a5c30(0xd0)]<0x6)throw new Error(_0x3a5c30(0xcc));const _0x37c9cd=await database_1['default'][_0x3a5c30(0xc5)][_0x3a5c30(0xcf)]({'where':{'id':_0x3a0daf},'select':{'password':!![]}});if(!_0x37c9cd)throw new Error(_0x3a5c30(0x95));const _0x45b427=await bcryptjs_1['default']['compare'](_0x3005c0,_0x37c9cd[_0x3a5c30(0xc7)]);if(!_0x45b427)throw new Error(_0x3a5c30(0xa0));const _0x286a0a=await bcryptjs_1[_0x3a5c30(0x8f)][_0x3a5c30(0xc9)](_0xd2d386,0xc);await database_1[_0x3a5c30(0x8f)][_0x3a5c30(0xc5)]['update']({'where':{'id':_0x3a0daf},'data':{'password':_0x286a0a}});}async['updateNotifications'](_0x37a07f,_0xd2ae44){const _0x384bdd=a51_0x5acf1f;await this[_0x384bdd(0xa2)](_0x37a07f);const _0x562c4d={};_0xd2ae44[_0x384bdd(0xbe)]!==undefined&&(_0x562c4d[_0x384bdd(0xa1)]=_0xd2ae44[_0x384bdd(0xbe)]),_0xd2ae44[_0x384bdd(0xac)]!==undefined&&(_0x562c4d['notificationPaymentFailed']=_0xd2ae44[_0x384bdd(0xac)]),_0xd2ae44[_0x384bdd(0x94)]!==undefined&&(_0x562c4d['notificationRefund']=_0xd2ae44[_0x384bdd(0x94)]),_0xd2ae44[_0x384bdd(0xd3)]!==undefined&&(_0x562c4d[_0x384bdd(0x92)]=_0xd2ae44[_0x384bdd(0xd3)]),_0xd2ae44[_0x384bdd(0xaf)]!==undefined&&(_0x562c4d[_0x384bdd(0x9c)]=_0xd2ae44[_0x384bdd(0xaf)]),_0xd2ae44['api_error']!==undefined&&(_0x562c4d[_0x384bdd(0xa4)]=_0xd2ae44['api_error']),await database_1[_0x384bdd(0x8f)]['shopSettings'][_0x384bdd(0xba)]({'where':{'shopId':_0x37a07f},'data':_0x562c4d});}async[a51_0x5acf1f(0xaa)](_0x5e8be2,_0x35cb50){const _0x1af465=a51_0x5acf1f;await this['ensureSettingsExist'](_0x5e8be2);const _0x5616fb={};_0x35cb50[_0x1af465(0xb4)]!==undefined&&(_0x5616fb[_0x1af465(0xb5)]=_0x35cb50['botApiKey']||null),_0x35cb50[_0x1af465(0x93)]!==undefined&&(_0x5616fb[_0x1af465(0x98)]=_0x35cb50[_0x1af465(0x93)]||null),await database_1[_0x1af465(0x8f)][_0x1af465(0x97)][_0x1af465(0xba)]({'where':{'shopId':_0x5e8be2},'data':_0x5616fb});}async[a51_0x5acf1f(0xca)](_0x6a9606,_0x594452){const _0x59f2eb=a51_0x5acf1f;await this[_0x59f2eb(0xa2)](_0x6a9606);const _0x289e8f={};_0x594452[_0x59f2eb(0xcd)]!==undefined&&(_0x289e8f[_0x59f2eb(0xcd)]=_0x594452[_0x59f2eb(0xcd)]||null),_0x594452[_0x59f2eb(0xa8)]!==undefined&&(_0x289e8f[_0x59f2eb(0xa8)]=_0x594452[_0x59f2eb(0xa8)]||[]),await database_1[_0x59f2eb(0x8f)][_0x59f2eb(0x97)]['update']({'where':{'shopId':_0x6a9606},'data':_0x289e8f});}async[a51_0x5acf1f(0x9a)](_0x38ea60){const _0xd47036=a51_0x5acf1f,_0x3709e2=_0xd47036(0x9b)+crypto_1[_0xd47036(0x8f)]['randomBytes'](0x20)[_0xd47036(0xb2)](_0xd47036(0xad)),_0x20a413=_0xd47036(0x9f)+crypto_1['default'][_0xd47036(0xbb)](0x20)[_0xd47036(0xb2)](_0xd47036(0xad));await database_1[_0xd47036(0x8f)][_0xd47036(0xc5)]['update']({'where':{'id':_0x38ea60},'data':{'publicKey':_0x3709e2,'secretKey':_0x20a413}});}async[a51_0x5acf1f(0xc8)](_0x1ce0db,_0x593924){const _0x14d8de=a51_0x5acf1f,{passwordConfirmation:_0x6e29ad}=_0x593924,_0x48e600=await database_1[_0x14d8de(0x8f)][_0x14d8de(0xc5)][_0x14d8de(0xcf)]({'where':{'id':_0x1ce0db},'select':{'password':!![]}});if(!_0x48e600)throw new Error(_0x14d8de(0x95));const _0x5a8b70=await bcryptjs_1[_0x14d8de(0x8f)]['compare'](_0x6e29ad,_0x48e600[_0x14d8de(0xc7)]);if(!_0x5a8b70)throw new Error(_0x14d8de(0xc6));await database_1['default'][_0x14d8de(0xc5)][_0x14d8de(0x9d)]({'where':{'id':_0x1ce0db}});}async[a51_0x5acf1f(0xa2)](_0x552c24){const _0xdfc1c0=a51_0x5acf1f,_0x5944bf=await database_1[_0xdfc1c0(0x8f)][_0xdfc1c0(0x97)][_0xdfc1c0(0xcf)]({'where':{'shopId':_0x552c24}});!_0x5944bf&&await database_1[_0xdfc1c0(0x8f)][_0xdfc1c0(0x97)][_0xdfc1c0(0xc0)]({'data':{'shopId':_0x552c24}});}}function a51_0x341b(_0x2c64ea,_0x35994f){const _0x29fa9c=a51_0x29fa();return a51_0x341b=function(_0x341b66,_0x466239){_0x341b66=_0x341b66-0x8e;let _0x548e22=_0x29fa9c[_0x341b66];return _0x548e22;},a51_0x341b(_0x2c64ea,_0x35994f);}exports['SettingsService']=SettingsService;