'use strict';function a57_0x3e91(){const _0x2327c9=['52iypnhQ','notificationPayout','telegramBotApiKey','shop','length','compare','__importDefault','179238qEUMSu','notificationPaymentFailed','webhookEvents','randomBytes','telegram','372WlVvWA','notificationApiError','1178418nzmFOV','delete','876933WCTtSb','parseWebhookEvents','substring','toString','shopSettings','chatId','shopUrl','update','refund','pk_','Password\x20confirmation\x20is\x20incorrect','parse','notificationRefund','Shop\x20not\x20found','670970gzccpw','crypto','default','login','changePassword','deleteAccount','hash','string','webhookUrl','Current\x20password\x20is\x20incorrect','create','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','name','payment_success','sk_','getShopSettings','password','__esModule','repeat','revokeAllApiKeys','payment_failed','api_error','max','telegramChatId','407qVOqSs','isArray','hex','findUnique','ensureSettingsExist','notificationPaymentSuccess','SettingsService','2183976zYpUpI','2642492ncWyPz','10DcddlR','138859yhYEEN','botApiKey','notificationLogin'];a57_0x3e91=function(){return _0x2327c9;};return a57_0x3e91();}const a57_0x1ca743=a57_0x1988;(function(_0x4c232e,_0x8d917a){const _0x456143=a57_0x1988,_0x54584f=_0x4c232e();while(!![]){try{const _0x564ef6=-parseInt(_0x456143(0xaa))/0x1+parseInt(_0x456143(0x9c))/0x2*(parseInt(_0x456143(0xa3))/0x3)+parseInt(_0x456143(0x97))/0x4*(parseInt(_0x456143(0x98))/0x5)+-parseInt(_0x456143(0xa8))/0x6*(-parseInt(_0x456143(0x99))/0x7)+parseInt(_0x456143(0x96))/0x8+parseInt(_0x456143(0x69))/0x9+-parseInt(_0x456143(0x77))/0xa*(parseInt(_0x456143(0x8f))/0xb);if(_0x564ef6===_0x8d917a)break;else _0x54584f['push'](_0x54584f['shift']());}catch(_0xaf1799){_0x54584f['push'](_0x54584f['shift']());}}}(a57_0x3e91,0xc6b8b));function a57_0x1988(_0x278175,_0x13ada5){const _0x3e914f=a57_0x3e91();return a57_0x1988=function(_0x19888a,_0x27649e){_0x19888a=_0x19888a-0x69;let _0x57744f=_0x3e914f[_0x19888a];return _0x57744f;},a57_0x1988(_0x278175,_0x13ada5);}var __importDefault=this&&this[a57_0x1ca743(0xa2)]||function(_0xc2a08c){const _0x21de58=a57_0x1ca743;return _0xc2a08c&&_0xc2a08c[_0x21de58(0x88)]?_0xc2a08c:{'default':_0xc2a08c};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a57_0x1ca743(0x95)]=void 0x0;const bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a57_0x1ca743(0x78))),database_1=__importDefault(require('../config/database'));class SettingsService{['maskApiKey'](_0x1f531a){const _0x4c0e5b=a57_0x1ca743;if(!_0x1f531a)return'';if(_0x1f531a[_0x4c0e5b(0xa0)]<=0x8)return _0x1f531a;const _0x1d0d68=_0x1f531a[_0x4c0e5b(0x6b)](0x0,0x8),_0x4fab4e='*'[_0x4c0e5b(0x89)](Math[_0x4c0e5b(0x8d)](0x0,_0x1f531a[_0x4c0e5b(0xa0)]-0x8));return _0x1d0d68+_0x4fab4e;}[a57_0x1ca743(0x6a)](_0x129d77){const _0x49c235=a57_0x1ca743;if(!_0x129d77)return[];if(Array[_0x49c235(0x90)](_0x129d77))return _0x129d77;if(typeof _0x129d77===_0x49c235(0x7e))try{const _0x1593f4=JSON[_0x49c235(0x74)](_0x129d77);return Array[_0x49c235(0x90)](_0x1593f4)?_0x1593f4:[];}catch{return[];}return[];}async[a57_0x1ca743(0x86)](_0x27b675){const _0x10a205=a57_0x1ca743,_0x55012b=await database_1[_0x10a205(0x79)][_0x10a205(0x9f)]['findUnique']({'where':{'id':_0x27b675},'include':{'settings':!![]}});if(!_0x55012b)throw new Error(_0x10a205(0x76));let _0x522fa5=_0x55012b['settings'];return!_0x522fa5&&(_0x522fa5=await database_1[_0x10a205(0x79)][_0x10a205(0x6d)]['create']({'data':{'shopId':_0x55012b['id']}})),{'fullName':_0x55012b[_0x10a205(0x83)],'brand':_0x55012b[_0x10a205(0x83)],'merchantUrl':_0x55012b[_0x10a205(0x6f)],'telegramUsername':_0x55012b[_0x10a205(0xa7)],'telegramBotApiKey':_0x522fa5[_0x10a205(0x9e)]?this['maskApiKey'](_0x522fa5[_0x10a205(0x9e)]):null,'telegramChatId':_0x522fa5['telegramChatId'],'webhookUrl':_0x522fa5[_0x10a205(0x7f)],'webhookEvents':this['parseWebhookEvents'](_0x522fa5[_0x10a205(0xa5)]),'notifications':{'payment_success':_0x522fa5['notificationPaymentSuccess'],'payment_failed':_0x522fa5[_0x10a205(0xa4)],'refund':_0x522fa5[_0x10a205(0x75)],'payout':_0x522fa5[_0x10a205(0x9d)],'login':_0x522fa5['notificationLogin'],'api_error':_0x522fa5[_0x10a205(0xa9)]}};}async[a57_0x1ca743(0x7b)](_0x446b06,_0x27c396){const _0xac8b30=a57_0x1ca743,{currentPassword:_0x55d64a,newPassword:_0xdadff8,confirmNewPassword:_0x1b0bfb}=_0x27c396;if(_0xdadff8!==_0x1b0bfb)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0xdadff8[_0xac8b30(0xa0)]<0x6)throw new Error(_0xac8b30(0x82));const _0x30c9c4=await database_1[_0xac8b30(0x79)]['shop']['findUnique']({'where':{'id':_0x446b06},'select':{'password':!![]}});if(!_0x30c9c4)throw new Error(_0xac8b30(0x76));const _0x19dd67=await bcryptjs_1[_0xac8b30(0x79)][_0xac8b30(0xa1)](_0x55d64a,_0x30c9c4[_0xac8b30(0x87)]);if(!_0x19dd67)throw new Error(_0xac8b30(0x80));const _0x983f71=await bcryptjs_1[_0xac8b30(0x79)][_0xac8b30(0x7d)](_0xdadff8,0xc);await database_1[_0xac8b30(0x79)]['shop']['update']({'where':{'id':_0x446b06},'data':{'password':_0x983f71}});}async['updateNotifications'](_0x3b5b2,_0x2b8a4c){const _0x3f7bcf=a57_0x1ca743;await this[_0x3f7bcf(0x93)](_0x3b5b2);const _0x45c294={};_0x2b8a4c[_0x3f7bcf(0x84)]!==undefined&&(_0x45c294[_0x3f7bcf(0x94)]=_0x2b8a4c[_0x3f7bcf(0x84)]),_0x2b8a4c['payment_failed']!==undefined&&(_0x45c294[_0x3f7bcf(0xa4)]=_0x2b8a4c[_0x3f7bcf(0x8b)]),_0x2b8a4c[_0x3f7bcf(0x71)]!==undefined&&(_0x45c294[_0x3f7bcf(0x75)]=_0x2b8a4c[_0x3f7bcf(0x71)]),_0x2b8a4c['payout']!==undefined&&(_0x45c294[_0x3f7bcf(0x9d)]=_0x2b8a4c['payout']),_0x2b8a4c[_0x3f7bcf(0x7a)]!==undefined&&(_0x45c294[_0x3f7bcf(0x9b)]=_0x2b8a4c[_0x3f7bcf(0x7a)]),_0x2b8a4c[_0x3f7bcf(0x8c)]!==undefined&&(_0x45c294[_0x3f7bcf(0xa9)]=_0x2b8a4c['api_error']),await database_1['default'][_0x3f7bcf(0x6d)][_0x3f7bcf(0x70)]({'where':{'shopId':_0x3b5b2},'data':_0x45c294});}async['updateTelegramSettings'](_0x1eccf9,_0x56e627){const _0x3587e1=a57_0x1ca743;await this[_0x3587e1(0x93)](_0x1eccf9);const _0x54bf88={};_0x56e627['botApiKey']!==undefined&&(_0x54bf88[_0x3587e1(0x9e)]=_0x56e627[_0x3587e1(0x9a)]||null),_0x56e627[_0x3587e1(0x6e)]!==undefined&&(_0x54bf88[_0x3587e1(0x8e)]=_0x56e627[_0x3587e1(0x6e)]||null),await database_1['default']['shopSettings'][_0x3587e1(0x70)]({'where':{'shopId':_0x1eccf9},'data':_0x54bf88});}async['updateWebhookSettings'](_0x1d7921,_0x3b1aaa){const _0xdd8745=a57_0x1ca743;await this[_0xdd8745(0x93)](_0x1d7921);const _0xb2c5ae={};_0x3b1aaa[_0xdd8745(0x7f)]!==undefined&&(_0xb2c5ae[_0xdd8745(0x7f)]=_0x3b1aaa[_0xdd8745(0x7f)]||null),_0x3b1aaa['webhookEvents']!==undefined&&(_0xb2c5ae[_0xdd8745(0xa5)]=_0x3b1aaa[_0xdd8745(0xa5)]||[]),await database_1[_0xdd8745(0x79)]['shopSettings'][_0xdd8745(0x70)]({'where':{'shopId':_0x1d7921},'data':_0xb2c5ae});}async[a57_0x1ca743(0x8a)](_0x1c2428){const _0x874b4a=a57_0x1ca743,_0x240744=_0x874b4a(0x72)+crypto_1[_0x874b4a(0x79)][_0x874b4a(0xa6)](0x20)[_0x874b4a(0x6c)](_0x874b4a(0x91)),_0x3e270d=_0x874b4a(0x85)+crypto_1[_0x874b4a(0x79)][_0x874b4a(0xa6)](0x20)[_0x874b4a(0x6c)]('hex');await database_1[_0x874b4a(0x79)][_0x874b4a(0x9f)]['update']({'where':{'id':_0x1c2428},'data':{'publicKey':_0x240744,'secretKey':_0x3e270d}});}async[a57_0x1ca743(0x7c)](_0x4584fd,_0x288fe6){const _0x491a28=a57_0x1ca743,{passwordConfirmation:_0x19fe05}=_0x288fe6,_0x1231be=await database_1['default'][_0x491a28(0x9f)][_0x491a28(0x92)]({'where':{'id':_0x4584fd},'select':{'password':!![]}});if(!_0x1231be)throw new Error(_0x491a28(0x76));const _0x21b44e=await bcryptjs_1[_0x491a28(0x79)][_0x491a28(0xa1)](_0x19fe05,_0x1231be[_0x491a28(0x87)]);if(!_0x21b44e)throw new Error(_0x491a28(0x73));await database_1[_0x491a28(0x79)]['shop'][_0x491a28(0xab)]({'where':{'id':_0x4584fd}});}async[a57_0x1ca743(0x93)](_0x212960){const _0x350013=a57_0x1ca743,_0x3df8a8=await database_1[_0x350013(0x79)]['shopSettings']['findUnique']({'where':{'shopId':_0x212960}});!_0x3df8a8&&await database_1['default'][_0x350013(0x6d)][_0x350013(0x81)]({'data':{'shopId':_0x212960}});}}exports['SettingsService']=SettingsService;