'use strict';function a53_0x3da5(){const _0x12a272=['chatId','parseWebhookEvents','telegramChatId','payment_failed','compare','35dKopQb','delete','updateNotifications','updateTelegramSettings','isArray','changePassword','notificationLogin','notificationRefund','login','hash','__esModule','updateWebhookSettings','shop','2583FhbWqb','settings','botApiKey','ensureSettingsExist','65298dFHfRw','shopUrl','revokeAllApiKeys','parse','bcryptjs','update','webhookUrl','maskApiKey','payment_success','../config/database','password','default','name','toString','22xAFAnK','174370gZxZEj','shopSettings','notificationPayout','randomBytes','telegramBotApiKey','payout','hex','notificationPaymentFailed','4901116QyJvjO','notificationPaymentSuccess','webhookEvents','findUnique','string','max','SettingsService','25947rFBiFN','substring','api_error','crypto','getShopSettings','create','length','40FlURpm','1077468ExuoQj','__importDefault','sk_','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','telegram','14430fZAhJz','39849fxvyga','Shop\x20not\x20found','pk_'];a53_0x3da5=function(){return _0x12a272;};return a53_0x3da5();}const a53_0x26467c=a53_0x5136;function a53_0x5136(_0x1b6814,_0x2fe1c6){const _0x3da5d7=a53_0x3da5();return a53_0x5136=function(_0x5136d5,_0xbc4c){_0x5136d5=_0x5136d5-0x123;let _0x1f7c81=_0x3da5d7[_0x5136d5];return _0x1f7c81;},a53_0x5136(_0x1b6814,_0x2fe1c6);}(function(_0x9976e6,_0x45434){const _0x3138d9=a53_0x5136,_0x20056e=_0x9976e6();while(!![]){try{const _0x39e4e3=parseInt(_0x3138d9(0x14c))/0x1+-parseInt(_0x3138d9(0x13c))/0x2*(-parseInt(_0x3138d9(0x15a))/0x3)+parseInt(_0x3138d9(0x154))/0x4+parseInt(_0x3138d9(0x162))/0x5*(-parseInt(_0x3138d9(0x12e))/0x6)+parseInt(_0x3138d9(0x13d))/0x7*(-parseInt(_0x3138d9(0x153))/0x8)+-parseInt(_0x3138d9(0x12a))/0x9*(-parseInt(_0x3138d9(0x159))/0xa)+-parseInt(_0x3138d9(0x145))/0xb;if(_0x39e4e3===_0x45434)break;else _0x20056e['push'](_0x20056e['shift']());}catch(_0x3f8258){_0x20056e['push'](_0x20056e['shift']());}}}(a53_0x3da5,0x33181));var __importDefault=this&&this[a53_0x26467c(0x155)]||function(_0x1acfd9){const _0x449ae1=a53_0x26467c;return _0x1acfd9&&_0x1acfd9[_0x449ae1(0x127)]?_0x1acfd9:{'default':_0x1acfd9};};Object['defineProperty'](exports,a53_0x26467c(0x127),{'value':!![]}),exports[a53_0x26467c(0x14b)]=void 0x0;const bcryptjs_1=__importDefault(require(a53_0x26467c(0x132))),crypto_1=__importDefault(require(a53_0x26467c(0x14f))),database_1=__importDefault(require(a53_0x26467c(0x137)));class SettingsService{[a53_0x26467c(0x135)](_0x369fdd){const _0x213f45=a53_0x26467c;if(!_0x369fdd)return'';if(_0x369fdd[_0x213f45(0x152)]<=0x8)return _0x369fdd;const _0x3e2188=_0x369fdd[_0x213f45(0x14d)](0x0,0x8),_0x2e5fd7='*'['repeat'](Math[_0x213f45(0x14a)](0x0,_0x369fdd[_0x213f45(0x152)]-0x8));return _0x3e2188+_0x2e5fd7;}[a53_0x26467c(0x15e)](_0x3d9859){const _0x15fec5=a53_0x26467c;if(!_0x3d9859)return[];if(Array[_0x15fec5(0x166)](_0x3d9859))return _0x3d9859;if(typeof _0x3d9859===_0x15fec5(0x149))try{const _0x33704a=JSON[_0x15fec5(0x131)](_0x3d9859);return Array['isArray'](_0x33704a)?_0x33704a:[];}catch{return[];}return[];}async[a53_0x26467c(0x150)](_0x1a31dd){const _0x2376b1=a53_0x26467c,_0x46f4a6=await database_1[_0x2376b1(0x139)]['shop'][_0x2376b1(0x148)]({'where':{'id':_0x1a31dd},'include':{'settings':!![]}});if(!_0x46f4a6)throw new Error(_0x2376b1(0x15b));let _0x30f928=_0x46f4a6[_0x2376b1(0x12b)];return!_0x30f928&&(_0x30f928=await database_1['default'][_0x2376b1(0x13e)][_0x2376b1(0x151)]({'data':{'shopId':_0x46f4a6['id']}})),{'fullName':_0x46f4a6[_0x2376b1(0x13a)],'brand':_0x46f4a6[_0x2376b1(0x13a)],'merchantUrl':_0x46f4a6[_0x2376b1(0x12f)],'telegramUsername':_0x46f4a6[_0x2376b1(0x158)],'telegramBotApiKey':_0x30f928[_0x2376b1(0x141)]?this[_0x2376b1(0x135)](_0x30f928[_0x2376b1(0x141)]):null,'telegramChatId':_0x30f928[_0x2376b1(0x15f)],'webhookUrl':_0x30f928[_0x2376b1(0x134)],'webhookEvents':this[_0x2376b1(0x15e)](_0x30f928[_0x2376b1(0x147)]),'notifications':{'payment_success':_0x30f928[_0x2376b1(0x146)],'payment_failed':_0x30f928[_0x2376b1(0x144)],'refund':_0x30f928[_0x2376b1(0x124)],'payout':_0x30f928[_0x2376b1(0x13f)],'login':_0x30f928[_0x2376b1(0x123)],'api_error':_0x30f928['notificationApiError']}};}async[a53_0x26467c(0x167)](_0x1be831,_0x3e580b){const _0x4f256c=a53_0x26467c,{currentPassword:_0x3aea75,newPassword:_0x14be6c,confirmNewPassword:_0x3c98b9}=_0x3e580b;if(_0x14be6c!==_0x3c98b9)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x14be6c[_0x4f256c(0x152)]<0x6)throw new Error(_0x4f256c(0x157));const _0x116dd9=await database_1[_0x4f256c(0x139)][_0x4f256c(0x129)][_0x4f256c(0x148)]({'where':{'id':_0x1be831},'select':{'password':!![]}});if(!_0x116dd9)throw new Error(_0x4f256c(0x15b));const _0x1ade0f=await bcryptjs_1[_0x4f256c(0x139)]['compare'](_0x3aea75,_0x116dd9['password']);if(!_0x1ade0f)throw new Error('Current\x20password\x20is\x20incorrect');const _0x1b0121=await bcryptjs_1[_0x4f256c(0x139)][_0x4f256c(0x126)](_0x14be6c,0xc);await database_1[_0x4f256c(0x139)][_0x4f256c(0x129)][_0x4f256c(0x133)]({'where':{'id':_0x1be831},'data':{'password':_0x1b0121}});}async[a53_0x26467c(0x164)](_0x3e0b53,_0x59f923){const _0x476f4b=a53_0x26467c;await this[_0x476f4b(0x12d)](_0x3e0b53);const _0x14c0d7={};_0x59f923[_0x476f4b(0x136)]!==undefined&&(_0x14c0d7[_0x476f4b(0x146)]=_0x59f923[_0x476f4b(0x136)]),_0x59f923[_0x476f4b(0x160)]!==undefined&&(_0x14c0d7[_0x476f4b(0x144)]=_0x59f923[_0x476f4b(0x160)]),_0x59f923['refund']!==undefined&&(_0x14c0d7[_0x476f4b(0x124)]=_0x59f923['refund']),_0x59f923['payout']!==undefined&&(_0x14c0d7[_0x476f4b(0x13f)]=_0x59f923[_0x476f4b(0x142)]),_0x59f923[_0x476f4b(0x125)]!==undefined&&(_0x14c0d7[_0x476f4b(0x123)]=_0x59f923['login']),_0x59f923[_0x476f4b(0x14e)]!==undefined&&(_0x14c0d7['notificationApiError']=_0x59f923['api_error']),await database_1[_0x476f4b(0x139)][_0x476f4b(0x13e)]['update']({'where':{'shopId':_0x3e0b53},'data':_0x14c0d7});}async[a53_0x26467c(0x165)](_0x91b5d5,_0x17814a){const _0x59fd9e=a53_0x26467c;await this['ensureSettingsExist'](_0x91b5d5);const _0x436aaa={};_0x17814a[_0x59fd9e(0x12c)]!==undefined&&(_0x436aaa[_0x59fd9e(0x141)]=_0x17814a[_0x59fd9e(0x12c)]||null),_0x17814a[_0x59fd9e(0x15d)]!==undefined&&(_0x436aaa[_0x59fd9e(0x15f)]=_0x17814a[_0x59fd9e(0x15d)]||null),await database_1[_0x59fd9e(0x139)]['shopSettings'][_0x59fd9e(0x133)]({'where':{'shopId':_0x91b5d5},'data':_0x436aaa});}async[a53_0x26467c(0x128)](_0x17daf1,_0x2650f0){const _0x181dfd=a53_0x26467c;await this[_0x181dfd(0x12d)](_0x17daf1);const _0x3b05a6={};_0x2650f0[_0x181dfd(0x134)]!==undefined&&(_0x3b05a6[_0x181dfd(0x134)]=_0x2650f0[_0x181dfd(0x134)]||null),_0x2650f0['webhookEvents']!==undefined&&(_0x3b05a6['webhookEvents']=_0x2650f0[_0x181dfd(0x147)]||[]),await database_1[_0x181dfd(0x139)][_0x181dfd(0x13e)][_0x181dfd(0x133)]({'where':{'shopId':_0x17daf1},'data':_0x3b05a6});}async[a53_0x26467c(0x130)](_0x320739){const _0x160ba8=a53_0x26467c,_0x906175=_0x160ba8(0x15c)+crypto_1[_0x160ba8(0x139)][_0x160ba8(0x140)](0x20)['toString'](_0x160ba8(0x143)),_0x3389a1=_0x160ba8(0x156)+crypto_1[_0x160ba8(0x139)][_0x160ba8(0x140)](0x20)[_0x160ba8(0x13b)](_0x160ba8(0x143));await database_1[_0x160ba8(0x139)][_0x160ba8(0x129)][_0x160ba8(0x133)]({'where':{'id':_0x320739},'data':{'publicKey':_0x906175,'secretKey':_0x3389a1}});}async['deleteAccount'](_0x4dedb1,_0x4d4194){const _0x4d93ba=a53_0x26467c,{passwordConfirmation:_0x204c01}=_0x4d4194,_0x5aacb6=await database_1[_0x4d93ba(0x139)][_0x4d93ba(0x129)]['findUnique']({'where':{'id':_0x4dedb1},'select':{'password':!![]}});if(!_0x5aacb6)throw new Error(_0x4d93ba(0x15b));const _0x1cd41b=await bcryptjs_1['default'][_0x4d93ba(0x161)](_0x204c01,_0x5aacb6[_0x4d93ba(0x138)]);if(!_0x1cd41b)throw new Error('Password\x20confirmation\x20is\x20incorrect');await database_1['default'][_0x4d93ba(0x129)][_0x4d93ba(0x163)]({'where':{'id':_0x4dedb1}});}async['ensureSettingsExist'](_0x2592a5){const _0x1cc305=a53_0x26467c,_0x2fcc79=await database_1[_0x1cc305(0x139)][_0x1cc305(0x13e)][_0x1cc305(0x148)]({'where':{'shopId':_0x2592a5}});!_0x2fcc79&&await database_1['default'][_0x1cc305(0x13e)][_0x1cc305(0x151)]({'data':{'shopId':_0x2592a5}});}}exports[a53_0x26467c(0x14b)]=SettingsService;