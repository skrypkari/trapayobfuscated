'use strict';function a47_0x6cd6(){const _0x2bd389=['38180mFxidw','default','AuthService','3318208QnIWYc','status','bcryptjs','verifyToken','password','7PenUVt','__esModule','4287065CyEAMP','shop','660454wcQlKZ','1707906VPWuDE','verify','sign','secret','defineProperty','passwordHash','config','__importDefault','compare','username','1611aMFKBs','name','admin','4tHSsaZ','expiresIn','jwt','4843648KUFhfP','jsonwebtoken','2431839zyoCTH','Invalid\x20credentials'];a47_0x6cd6=function(){return _0x2bd389;};return a47_0x6cd6();}const a47_0x36c113=a47_0x4f95;(function(_0xe3e104,_0x46665b){const _0xf2190=a47_0x4f95,_0x2212fc=_0xe3e104();while(!![]){try{const _0x30b6a5=parseInt(_0xf2190(0x161))/0x1*(parseInt(_0xf2190(0x16f))/0x2)+-parseInt(_0xf2190(0x174))/0x3+parseInt(_0xf2190(0x172))/0x4+-parseInt(_0xf2190(0x15f))/0x5+-parseInt(_0xf2190(0x162))/0x6*(-parseInt(_0xf2190(0x15d))/0x7)+parseInt(_0xf2190(0x158))/0x8+parseInt(_0xf2190(0x16c))/0x9*(-parseInt(_0xf2190(0x176))/0xa);if(_0x30b6a5===_0x46665b)break;else _0x2212fc['push'](_0x2212fc['shift']());}catch(_0x43cc31){_0x2212fc['push'](_0x2212fc['shift']());}}}(a47_0x6cd6,0xd6cb7));function a47_0x4f95(_0x5947a5,_0x8b518){_0x5947a5=_0x5947a5-0x158;const _0x6cd6c2=a47_0x6cd6();let _0x4f9551=_0x6cd6c2[_0x5947a5];return _0x4f9551;}var __importDefault=this&&this[a47_0x36c113(0x169)]||function(_0x4a8ddc){const _0x2d0402=a47_0x36c113;return _0x4a8ddc&&_0x4a8ddc[_0x2d0402(0x15e)]?_0x4a8ddc:{'default':_0x4a8ddc};};Object[a47_0x36c113(0x166)](exports,a47_0x36c113(0x15e),{'value':!![]}),exports['AuthService']=void 0x0;const bcryptjs_1=__importDefault(require(a47_0x36c113(0x15a))),jsonwebtoken_1=__importDefault(require(a47_0x36c113(0x173))),database_1=__importDefault(require('../config/database')),config_1=require('../config/config');class AuthService{['generateToken'](_0x56db42){const _0x4bea45=a47_0x36c113;return jsonwebtoken_1[_0x4bea45(0x177)][_0x4bea45(0x164)](_0x56db42,config_1[_0x4bea45(0x168)]['jwt']['secret'],{'expiresIn':String(config_1['config'][_0x4bea45(0x171)][_0x4bea45(0x170)])});}async['login'](_0x5925d6){const _0x2762ad=a47_0x36c113,{username:_0x1eefb5,password:_0x4bda5d}=_0x5925d6;if(_0x1eefb5===config_1[_0x2762ad(0x168)][_0x2762ad(0x16e)][_0x2762ad(0x16b)]){const _0x49590b=await bcryptjs_1[_0x2762ad(0x177)]['compare'](_0x4bda5d,config_1[_0x2762ad(0x168)][_0x2762ad(0x16e)][_0x2762ad(0x167)]);if(_0x49590b){const _0x4eee21=this['generateToken']({'id':_0x2762ad(0x16e),'username':config_1[_0x2762ad(0x168)][_0x2762ad(0x16e)]['username'],'role':'admin'});return{'access_token':_0x4eee21,'role':'admin'};}}const _0x538732=await database_1[_0x2762ad(0x177)][_0x2762ad(0x160)]['findUnique']({'where':{'username':_0x1eefb5},'select':{'id':!![],'name':!![],'username':!![],'password':!![],'status':!![]}});if(!_0x538732)throw new Error(_0x2762ad(0x175));if(_0x538732[_0x2762ad(0x159)]!=='ACTIVE')throw new Error('Account\x20is\x20not\x20active');const _0x1ee057=await bcryptjs_1[_0x2762ad(0x177)][_0x2762ad(0x16a)](_0x4bda5d,_0x538732[_0x2762ad(0x15c)]);if(!_0x1ee057)throw new Error('Invalid\x20credentials');const _0x594957=this['generateToken']({'id':_0x538732['id'],'username':_0x538732[_0x2762ad(0x16b)],'role':_0x2762ad(0x160)});return{'access_token':_0x594957,'role':'shop','user':{'id':_0x538732['id'],'name':_0x538732[_0x2762ad(0x16d)],'username':_0x538732[_0x2762ad(0x16b)]}};}async[a47_0x36c113(0x15b)](_0x1b4c2b){const _0x226b72=a47_0x36c113;try{const _0x6c2bb6=jsonwebtoken_1[_0x226b72(0x177)][_0x226b72(0x163)](_0x1b4c2b,config_1[_0x226b72(0x168)][_0x226b72(0x171)][_0x226b72(0x165)]);return _0x6c2bb6;}catch(_0x1af3e7){throw new Error('Invalid\x20token');}}}exports[a47_0x36c113(0x178)]=AuthService;