'use strict';const a47_0x53f107=a47_0x3f6a;(function(_0x5cdb26,_0x420704){const _0x400f09=a47_0x3f6a,_0xbf9c49=_0x5cdb26();while(!![]){try{const _0x3f7806=parseInt(_0x400f09(0x1ef))/0x1+parseInt(_0x400f09(0x1ec))/0x2+parseInt(_0x400f09(0x1e7))/0x3+-parseInt(_0x400f09(0x1e8))/0x4+parseInt(_0x400f09(0x1fb))/0x5+parseInt(_0x400f09(0x204))/0x6*(-parseInt(_0x400f09(0x1f5))/0x7)+-parseInt(_0x400f09(0x1ff))/0x8*(parseInt(_0x400f09(0x200))/0x9);if(_0x3f7806===_0x420704)break;else _0xbf9c49['push'](_0xbf9c49['shift']());}catch(_0x5c8f9d){_0xbf9c49['push'](_0xbf9c49['shift']());}}}(a47_0x2ce7,0x2fef5));function a47_0x2ce7(){const _0x211bf1=['../config/database','shop','password','compare','Invalid\x20credentials','1630580jRfXzw','jsonwebtoken','AuthService','findUnique','328sxopjZ','16641pnHHaQ','ACTIVE','status','username','6222vjFaMw','__importDefault','__esModule','bcryptjs','jwt','862173itbKFH','1241384ILEAqW','Invalid\x20token','name','config','491142orwKqw','admin','../config/config','39703vQJSlh','generateToken','defineProperty','verify','secret','default','2135wuOOxy'];a47_0x2ce7=function(){return _0x211bf1;};return a47_0x2ce7();}var __importDefault=this&&this[a47_0x53f107(0x205)]||function(_0x2c3dd9){const _0x5b8dc8=a47_0x53f107;return _0x2c3dd9&&_0x2c3dd9[_0x5b8dc8(0x206)]?_0x2c3dd9:{'default':_0x2c3dd9};};Object[a47_0x53f107(0x1f1)](exports,a47_0x53f107(0x206),{'value':!![]}),exports['AuthService']=void 0x0;function a47_0x3f6a(_0x1f9769,_0x1ccf44){_0x1f9769=_0x1f9769-0x1e7;const _0x2ce748=a47_0x2ce7();let _0x3f6a1d=_0x2ce748[_0x1f9769];return _0x3f6a1d;}const bcryptjs_1=__importDefault(require(a47_0x53f107(0x207))),jsonwebtoken_1=__importDefault(require(a47_0x53f107(0x1fc))),database_1=__importDefault(require(a47_0x53f107(0x1f6))),config_1=require(a47_0x53f107(0x1ee));class AuthService{[a47_0x53f107(0x1f0)](_0x4eb229){const _0x5e371c=a47_0x53f107;return jsonwebtoken_1['default']['sign'](_0x4eb229,config_1[_0x5e371c(0x1eb)][_0x5e371c(0x208)][_0x5e371c(0x1f3)],{'expiresIn':String(config_1[_0x5e371c(0x1eb)][_0x5e371c(0x208)]['expiresIn'])});}async['login'](_0x25969b){const _0x5265be=a47_0x53f107,{username:_0x3fa868,password:_0x49af2a}=_0x25969b;if(_0x3fa868===config_1['config'][_0x5265be(0x1ed)][_0x5265be(0x203)]){const _0x23ef42=await bcryptjs_1[_0x5265be(0x1f4)][_0x5265be(0x1f9)](_0x49af2a,config_1[_0x5265be(0x1eb)]['admin']['passwordHash']);if(_0x23ef42){const _0x2a9810=this[_0x5265be(0x1f0)]({'id':_0x5265be(0x1ed),'username':config_1[_0x5265be(0x1eb)][_0x5265be(0x1ed)][_0x5265be(0x203)],'role':_0x5265be(0x1ed)});return{'access_token':_0x2a9810,'role':_0x5265be(0x1ed)};}}const _0x4688f6=await database_1['default'][_0x5265be(0x1f7)][_0x5265be(0x1fe)]({'where':{'username':_0x3fa868},'select':{'id':!![],'name':!![],'username':!![],'password':!![],'status':!![]}});if(!_0x4688f6)throw new Error('Invalid\x20credentials');if(_0x4688f6[_0x5265be(0x202)]!==_0x5265be(0x201))throw new Error('Account\x20is\x20not\x20active');const _0x9589fc=await bcryptjs_1[_0x5265be(0x1f4)][_0x5265be(0x1f9)](_0x49af2a,_0x4688f6[_0x5265be(0x1f8)]);if(!_0x9589fc)throw new Error(_0x5265be(0x1fa));const _0x439d66=this[_0x5265be(0x1f0)]({'id':_0x4688f6['id'],'username':_0x4688f6[_0x5265be(0x203)],'role':_0x5265be(0x1f7)});return{'access_token':_0x439d66,'role':_0x5265be(0x1f7),'user':{'id':_0x4688f6['id'],'name':_0x4688f6[_0x5265be(0x1ea)],'username':_0x4688f6['username']}};}async['verifyToken'](_0x4ff256){const _0x610ee3=a47_0x53f107;try{const _0x4304cf=jsonwebtoken_1[_0x610ee3(0x1f4)][_0x610ee3(0x1f2)](_0x4ff256,config_1[_0x610ee3(0x1eb)][_0x610ee3(0x208)][_0x610ee3(0x1f3)]);return _0x4304cf;}catch(_0x4c66ae){throw new Error(_0x610ee3(0x1e9));}}}exports[a47_0x53f107(0x1fd)]=AuthService;