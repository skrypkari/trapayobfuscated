'use strict';const a39_0x3a2b77=a39_0x2621;function a39_0x5b6a(){const _0x28421b=['username','password','jwt','compare','shop','Invalid\x20token','4782188uJDQNR','secret','jsonwebtoken','786rmfDyd','defineProperty','__esModule','4595WFMsQz','140409TPHLwU','10153384TgtXGl','Invalid\x20credentials','status','bcryptjs','default','1266003MiLlbX','config','5614462HijLJG','ACTIVE','__importDefault','admin','sign','generateToken','1760480ulyZSz','verify','../config/config','AuthService'];a39_0x5b6a=function(){return _0x28421b;};return a39_0x5b6a();}(function(_0x3a26a8,_0x444606){const _0x44e30c=a39_0x2621,_0x54c48a=_0x3a26a8();while(!![]){try{const _0x145967=-parseInt(_0x44e30c(0xd3))/0x1+parseInt(_0x44e30c(0xdb))/0x2+parseInt(_0x44e30c(0xcd))/0x3+-parseInt(_0x44e30c(0xe5))/0x4+-parseInt(_0x44e30c(0xeb))/0x5*(-parseInt(_0x44e30c(0xe8))/0x6)+parseInt(_0x44e30c(0xd5))/0x7+parseInt(_0x44e30c(0xce))/0x8;if(_0x145967===_0x444606)break;else _0x54c48a['push'](_0x54c48a['shift']());}catch(_0x5a7a5f){_0x54c48a['push'](_0x54c48a['shift']());}}}(a39_0x5b6a,0xa06e1));function a39_0x2621(_0x44e18e,_0x419d8a){const _0x5b6a47=a39_0x5b6a();return a39_0x2621=function(_0x26210d,_0x3fa3a5){_0x26210d=_0x26210d-0xcd;let _0x2dd775=_0x5b6a47[_0x26210d];return _0x2dd775;},a39_0x2621(_0x44e18e,_0x419d8a);}var __importDefault=this&&this[a39_0x3a2b77(0xd7)]||function(_0x3a37c6){const _0x59176d=a39_0x3a2b77;return _0x3a37c6&&_0x3a37c6[_0x59176d(0xea)]?_0x3a37c6:{'default':_0x3a37c6};};Object[a39_0x3a2b77(0xe9)](exports,a39_0x3a2b77(0xea),{'value':!![]}),exports['AuthService']=void 0x0;const bcryptjs_1=__importDefault(require(a39_0x3a2b77(0xd1))),jsonwebtoken_1=__importDefault(require(a39_0x3a2b77(0xe7))),database_1=__importDefault(require('../config/database')),config_1=require(a39_0x3a2b77(0xdd));class AuthService{[a39_0x3a2b77(0xda)](_0x4a2d2c){const _0x576b53=a39_0x3a2b77;return jsonwebtoken_1['default'][_0x576b53(0xd9)](_0x4a2d2c,config_1[_0x576b53(0xd4)][_0x576b53(0xe1)][_0x576b53(0xe6)],{'expiresIn':String(config_1['config'][_0x576b53(0xe1)]['expiresIn'])});}async['login'](_0xde47c){const _0x1c3879=a39_0x3a2b77,{username:_0x3bf3fb,password:_0xa28b8f}=_0xde47c;if(_0x3bf3fb===config_1['config'][_0x1c3879(0xd8)][_0x1c3879(0xdf)]){const _0xc0081a=await bcryptjs_1['default'][_0x1c3879(0xe2)](_0xa28b8f,config_1[_0x1c3879(0xd4)][_0x1c3879(0xd8)]['passwordHash']);if(_0xc0081a){const _0x1ab75e=this[_0x1c3879(0xda)]({'id':'admin','username':config_1['config'][_0x1c3879(0xd8)][_0x1c3879(0xdf)],'role':_0x1c3879(0xd8)});return{'access_token':_0x1ab75e,'role':_0x1c3879(0xd8)};}}const _0x1c88e5=await database_1[_0x1c3879(0xd2)][_0x1c3879(0xe3)]['findUnique']({'where':{'username':_0x3bf3fb},'select':{'id':!![],'name':!![],'username':!![],'password':!![],'status':!![]}});if(!_0x1c88e5)throw new Error(_0x1c3879(0xcf));if(_0x1c88e5[_0x1c3879(0xd0)]!==_0x1c3879(0xd6))throw new Error('Account\x20is\x20not\x20active');const _0x42df9a=await bcryptjs_1[_0x1c3879(0xd2)]['compare'](_0xa28b8f,_0x1c88e5[_0x1c3879(0xe0)]);if(!_0x42df9a)throw new Error(_0x1c3879(0xcf));const _0x24a85c=this['generateToken']({'id':_0x1c88e5['id'],'username':_0x1c88e5[_0x1c3879(0xdf)],'role':'shop'});return{'access_token':_0x24a85c,'role':'shop','user':{'id':_0x1c88e5['id'],'name':_0x1c88e5['name'],'username':_0x1c88e5[_0x1c3879(0xdf)]}};}async['verifyToken'](_0x2b069b){const _0x1e9f1a=a39_0x3a2b77;try{const _0x3dfe06=jsonwebtoken_1[_0x1e9f1a(0xd2)][_0x1e9f1a(0xdc)](_0x2b069b,config_1['config']['jwt']['secret']);return _0x3dfe06;}catch(_0x253af8){throw new Error(_0x1e9f1a(0xe4));}}}exports[a39_0x3a2b77(0xde)]=AuthService;