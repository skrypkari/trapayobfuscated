'use strict';function a42_0x2360(_0x4b4122,_0x106ff3){const _0x1b72bf=a42_0x1b72();return a42_0x2360=function(_0x236052,_0x1eb5c7){_0x236052=_0x236052-0x104;let _0x57c213=_0x1b72bf[_0x236052];return _0x57c213;},a42_0x2360(_0x4b4122,_0x106ff3);}const a42_0x3d3a45=a42_0x2360;(function(_0xd24cdd,_0x5e4ef4){const _0x24460a=a42_0x2360,_0x2174df=_0xd24cdd();while(!![]){try{const _0x38ea28=parseInt(_0x24460a(0x12a))/0x1*(-parseInt(_0x24460a(0x1d3))/0x2)+-parseInt(_0x24460a(0x152))/0x3*(-parseInt(_0x24460a(0x149))/0x4)+parseInt(_0x24460a(0x155))/0x5*(parseInt(_0x24460a(0x15c))/0x6)+-parseInt(_0x24460a(0x143))/0x7*(parseInt(_0x24460a(0x212))/0x8)+parseInt(_0x24460a(0x1c2))/0x9*(parseInt(_0x24460a(0x1a8))/0xa)+parseInt(_0x24460a(0x21a))/0xb*(-parseInt(_0x24460a(0x127))/0xc)+-parseInt(_0x24460a(0x1d6))/0xd;if(_0x38ea28===_0x5e4ef4)break;else _0x2174df['push'](_0x2174df['shift']());}catch(_0x2010fc){_0x2174df['push'](_0x2174df['shift']());}}}(a42_0x1b72,0x66784));var __importDefault=this&&this[a42_0x3d3a45(0x1ef)]||function(_0x3bc062){const _0x39888d=a42_0x3d3a45;return _0x3bc062&&_0x3bc062[_0x39888d(0x1b9)]?_0x3bc062:{'default':_0x3bc062};};Object[a42_0x3d3a45(0x18b)](exports,a42_0x3d3a45(0x1b9),{'value':!![]}),exports[a42_0x3d3a45(0x202)]=exports[a42_0x3d3a45(0x174)]=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a42_0x3d3a45(0x177)),gateway_1=require(a42_0x3d3a45(0x204)),database_1=__importDefault(require(a42_0x3d3a45(0x122))),telegramBotService_1=require(a42_0x3d3a45(0x1b4)),loggerService_1=require(a42_0x3d3a45(0x11f)),currencyService_1=require(a42_0x3d3a45(0x20f));class CoinToPayStatusService{constructor(){const _0x14e62b=a42_0x3d3a45;this[_0x14e62b(0x1a4)]=null,this[_0x14e62b(0x125)]=0x3c*0x3c*0x3e8,this[_0x14e62b(0x14b)]=0x5,this[_0x14e62b(0x132)]=new Map(),this[_0x14e62b(0x1b6)]=new coinToPayService_1[(_0x14e62b(0x11a))](),this[_0x14e62b(0x19f)]=new coinToPay2Service_1[(_0x14e62b(0x16d))](),console[_0x14e62b(0x1d9)](_0x14e62b(0x172));}[a42_0x3d3a45(0x198)](_0x43919e,_0x2bd697){const _0x1f9dc2=a42_0x3d3a45;console['log'](_0x1f9dc2(0x169)),console[_0x1f9dc2(0x1d9)](_0x1f9dc2(0x201)+_0x43919e),console['log'](_0x1f9dc2(0x1bb)+_0x2bd697),this[_0x1f9dc2(0x1e8)](_0x43919e);const _0x4caea2=[],_0x4b1a03=new Date(),_0x224760=[{'delay':0x1*0x3c*0x3e8,'description':_0x1f9dc2(0x193)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console[_0x1f9dc2(0x1d9)](_0x1f9dc2(0x14c)+_0x224760[_0x1f9dc2(0x130)]+_0x1f9dc2(0x216)+_0x43919e);let _0x354077=0x0;_0x224760[_0x1f9dc2(0x107)]((_0x2a9bb8,_0x19901f)=>{const _0x453bda=_0x1f9dc2;_0x354077+=_0x2a9bb8[_0x453bda(0x131)];const _0x23112a=setTimeout(async()=>{const _0x2fc693=_0x453bda;console[_0x2fc693(0x1d9)](_0x2fc693(0x1a5)+(_0x19901f+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x43919e+_0x2fc693(0x219)+_0x2a9bb8['description']+')');try{await this[_0x2fc693(0x200)](_0x43919e),console[_0x2fc693(0x1d9)](_0x2fc693(0x113)+(_0x19901f+0x1)+_0x2fc693(0x1c6)+_0x43919e);}catch(_0x3f466a){console[_0x2fc693(0x1a2)](_0x2fc693(0x1f9)+(_0x19901f+0x1)+_0x2fc693(0x129)+_0x43919e+':',_0x3f466a),this['logCoinToPayError'](_0x43919e,_0x2bd697,_0x3f466a,'status_check',{'checkNumber':_0x19901f+0x1,'scheduledAfter':_0x2a9bb8[_0x2fc693(0x10b)],'isIndividualCheck':!![]});}},_0x354077);_0x4caea2[_0x453bda(0x1a6)](_0x23112a),console[_0x453bda(0x1d9)](_0x453bda(0x1d5)+(_0x19901f+0x1)+_0x453bda(0x129)+_0x43919e+'\x20in\x20'+_0x354077/0x3e8+_0x453bda(0x142)+_0x2a9bb8['description']+')');});const _0x2ea967=setInterval(async()=>{const _0x4dd9f1=_0x1f9dc2;console[_0x4dd9f1(0x1d9)](_0x4dd9f1(0x217)+_0x43919e);try{const _0x36742f=await database_1[_0x4dd9f1(0x1cf)]['payment'][_0x4dd9f1(0x15e)]({'where':{'id':_0x43919e},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x36742f){console['log'](_0x4dd9f1(0x17d)+_0x43919e+'\x20not\x20found,\x20clearing\x20timers'),this[_0x4dd9f1(0x1e8)](_0x43919e);return;}console['log'](_0x4dd9f1(0x196)+_0x43919e+_0x4dd9f1(0x156)+_0x36742f[_0x4dd9f1(0x1b0)]);if(_0x36742f[_0x4dd9f1(0x1b0)]!==_0x4dd9f1(0x123)){console[_0x4dd9f1(0x1d9)](_0x4dd9f1(0x16a)+_0x43919e+_0x4dd9f1(0x180)+_0x36742f[_0x4dd9f1(0x1b0)]+',\x20stopping\x20individual\x20checks'),this[_0x4dd9f1(0x1e8)](_0x43919e);return;}const _0x1f7f13=Math[_0x4dd9f1(0x121)]((Date[_0x4dd9f1(0x1e2)]()-_0x36742f[_0x4dd9f1(0x1b3)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x1f7f13>=this['EXPIRY_DAYS']){console['log'](_0x4dd9f1(0x1d2)+_0x43919e+_0x4dd9f1(0x167)+this[_0x4dd9f1(0x14b)]+_0x4dd9f1(0x213)),this['clearPaymentTimers'](_0x43919e);return;}await this['checkSinglePaymentById'](_0x43919e),console[_0x4dd9f1(0x1d9)]('✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x43919e);}catch(_0x11182e){console[_0x4dd9f1(0x1a2)](_0x4dd9f1(0x1a0)+_0x43919e+':',_0x11182e),this[_0x4dd9f1(0x176)](_0x43919e,_0x2bd697,_0x11182e,_0x4dd9f1(0x1af),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x4caea2['push'](_0x2ea967),this[_0x1f9dc2(0x132)][_0x1f9dc2(0x210)](_0x43919e,{'timers':_0x4caea2,'paymentId':_0x43919e,'gatewayPaymentId':_0x2bd697,'createdAt':_0x4b1a03}),console[_0x1f9dc2(0x1d9)](_0x1f9dc2(0x1fe)+_0x224760['length']+_0x1f9dc2(0x117)+_0x43919e),console[_0x1f9dc2(0x1d9)](_0x1f9dc2(0x1ec)+this['paymentTimers']['size']),this['logCoinToPayStatus'](_0x43919e,_0x2bd697,'PENDING',_0x1f9dc2(0x123),_0x1f9dc2(0x1af),{'action':_0x1f9dc2(0x151),'scheduledChecks':_0x224760[_0x1f9dc2(0x130)],'firstCheckIn':_0x224760[0x0][_0x1f9dc2(0x131)]/0x3e8,'totalTimers':this[_0x1f9dc2(0x132)]['size']});}['clearPaymentTimers'](_0x1ff51b){const _0x5e32af=a42_0x3d3a45,_0x3043f4=this['paymentTimers'][_0x5e32af(0x1eb)](_0x1ff51b);_0x3043f4?(console[_0x5e32af(0x1d9)](_0x5e32af(0x1fc)+_0x3043f4[_0x5e32af(0x178)][_0x5e32af(0x130)]+_0x5e32af(0x1e5)+_0x1ff51b),_0x3043f4[_0x5e32af(0x178)][_0x5e32af(0x107)]((_0x16b674,_0x3e2495)=>{const _0x88478f=_0x5e32af;_0x16b674&&(clearTimeout(_0x16b674),clearInterval(_0x16b674),console[_0x88478f(0x1d9)](_0x88478f(0x105)+(_0x3e2495+0x1)+_0x88478f(0x129)+_0x1ff51b));}),this['paymentTimers'][_0x5e32af(0x1f3)](_0x1ff51b),console['log'](_0x5e32af(0x170)+_0x1ff51b+'.\x20Remaining\x20active\x20timers:\x20'+this['paymentTimers'][_0x5e32af(0x214)])):console[_0x5e32af(0x1d9)](_0x5e32af(0x161)+_0x1ff51b+_0x5e32af(0x126));}async[a42_0x3d3a45(0x200)](_0x251d7f){const _0x348a35=a42_0x3d3a45;console[_0x348a35(0x1d9)](_0x348a35(0x13c)+_0x251d7f);const _0x533abd=await database_1[_0x348a35(0x1cf)][_0x348a35(0x119)]['findUnique']({'where':{'id':_0x251d7f},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x533abd){console[_0x348a35(0x1d9)]('❌\x20[CHECK]\x20Payment\x20'+_0x251d7f+'\x20not\x20found\x20in\x20database');return;}console['log'](_0x348a35(0x1f4)+_0x251d7f+_0x348a35(0x183)),console['log']('\x20\x20\x20-\x20Gateway:\x20'+_0x533abd[_0x348a35(0x137)]),console[_0x348a35(0x1d9)](_0x348a35(0x1f8)+_0x533abd[_0x348a35(0x1b0)]),console['log'](_0x348a35(0x15b)+_0x533abd[_0x348a35(0x134)]),console[_0x348a35(0x1d9)](_0x348a35(0x1c9)+_0x533abd['amount']+'\x20'+_0x533abd[_0x348a35(0x1e1)]),console[_0x348a35(0x1d9)]('\x20\x20\x20-\x20ShopId:\x20'+_0x533abd[_0x348a35(0x163)]);if(_0x533abd[_0x348a35(0x137)]!==_0x348a35(0x160)&&_0x533abd[_0x348a35(0x137)]!==_0x348a35(0x108)){console['log']('⚠️\x20[CHECK]\x20Payment\x20'+_0x251d7f+_0x348a35(0x1c8)+_0x533abd['gateway']+')');return;}if(_0x533abd['status']!==_0x348a35(0x123)){console['log']('⚠️\x20[CHECK]\x20Payment\x20'+_0x251d7f+_0x348a35(0x180)+_0x533abd[_0x348a35(0x1b0)]+_0x348a35(0x17b)),this['clearPaymentTimers'](_0x251d7f);return;}if(!_0x533abd[_0x348a35(0x134)]){console[_0x348a35(0x1d9)](_0x348a35(0x1ad)+_0x251d7f+_0x348a35(0x1e0));return;}console[_0x348a35(0x1d9)]('✅\x20[CHECK]\x20Payment\x20'+_0x251d7f+_0x348a35(0x18d)),await this[_0x348a35(0x1f0)](_0x533abd);}[a42_0x3d3a45(0x12b)](_0x327597,_0x2e3b60,_0x47a018,_0x22fd57,_0x121cb7,_0x483f45){const _0x366428=a42_0x3d3a45,_0x163726={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x327597,'gatewayPaymentId':_0x2e3b60,'oldStatus':_0x47a018,'newStatus':_0x22fd57,'source':_0x121cb7,'timestamp':new Date()[_0x366428(0x18c)](),'details':_0x483f45||{}};loggerService_1[_0x366428(0x16f)]['logCoinToPayStatus'](_0x163726),console['log']('🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x327597+'\x20('+_0x2e3b60+')'),console['log']('\x20\x20\x20📊\x20Status:\x20'+_0x47a018+_0x366428(0x19d)+_0x22fd57),console[_0x366428(0x1d9)](_0x366428(0x1e9)+_0x121cb7),console[_0x366428(0x1d9)](_0x366428(0x1b8)+_0x163726['timestamp']),_0x483f45&&console[_0x366428(0x1d9)](_0x366428(0x1f7),_0x483f45);}[a42_0x3d3a45(0x176)](_0x4e9e27,_0x202ff6,_0x303254,_0x1269c3,_0x537902){const _0x26b34f=a42_0x3d3a45,_0x2fbdd5={'type':_0x26b34f(0x206),'paymentId':_0x4e9e27,'gatewayPaymentId':_0x202ff6,'error':_0x303254 instanceof Error?{'message':_0x303254[_0x26b34f(0x186)],'stack':_0x303254[_0x26b34f(0x1be)]}:_0x303254,'source':_0x1269c3,'timestamp':new Date()['toISOString'](),'context':_0x537902||{}};loggerService_1[_0x26b34f(0x16f)][_0x26b34f(0x176)](_0x2fbdd5),console[_0x26b34f(0x1a2)](_0x26b34f(0x168)+_0x4e9e27+'\x20('+_0x202ff6+')'),console['error'](_0x26b34f(0x12f)+(_0x303254 instanceof Error?_0x303254[_0x26b34f(0x186)]:_0x303254)),console[_0x26b34f(0x1a2)](_0x26b34f(0x1e9)+_0x1269c3),console[_0x26b34f(0x1a2)](_0x26b34f(0x1b8)+_0x2fbdd5[_0x26b34f(0x211)]),_0x537902&&console[_0x26b34f(0x1a2)](_0x26b34f(0x12c),_0x537902);}['startPeriodicStatusCheck'](){const _0x426b3c=a42_0x3d3a45;console[_0x426b3c(0x1d9)](_0x426b3c(0x1ed)),this[_0x426b3c(0x1e7)]()['catch'](_0x23c7ad=>{const _0x4258f8=_0x426b3c;console[_0x4258f8(0x1a2)](_0x4258f8(0x1f6),_0x23c7ad);}),this[_0x426b3c(0x1a4)]=setInterval(async()=>{const _0x46c47b=_0x426b3c;try{console['log']('🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x46c47b(0x1e7)](),console[_0x46c47b(0x1d9)]('✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x570aa9){console[_0x46c47b(0x1a2)](_0x46c47b(0x13a),_0x570aa9);}},this[_0x426b3c(0x125)]),console[_0x426b3c(0x1d9)]('✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a42_0x3d3a45(0x104)](){const _0x2da1b8=a42_0x3d3a45;console[_0x2da1b8(0x1d9)](_0x2da1b8(0x112));this[_0x2da1b8(0x1a4)]&&(clearInterval(this['globalCheckInterval']),this['globalCheckInterval']=null,console[_0x2da1b8(0x1d9)](_0x2da1b8(0x12e)));const _0x372be8=this['paymentTimers']['size'];for(const [_0x59f9e7]of this[_0x2da1b8(0x132)]){this[_0x2da1b8(0x1e8)](_0x59f9e7);}console[_0x2da1b8(0x1d9)](_0x2da1b8(0x1d8)+_0x372be8+_0x2da1b8(0x165));}async[a42_0x3d3a45(0x1e7)](){const _0x1fa889=a42_0x3d3a45;try{console[_0x1fa889(0x1d9)]('🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x20ad81=await database_1[_0x1fa889(0x1cf)][_0x1fa889(0x119)][_0x1fa889(0x1bf)]({'where':{'gateway':{'in':['cointopay',_0x1fa889(0x108)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x1fa889(0x13e)+_0x20ad81[_0x1fa889(0x130)]+_0x1fa889(0x19b));if(_0x20ad81[_0x1fa889(0x130)]===0x0){console[_0x1fa889(0x1d9)]('🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x3d9d8d=await this['checkExpiredPayments'](_0x20ad81);console[_0x1fa889(0x1d9)](_0x1fa889(0x150)+_0x3d9d8d[_0x1fa889(0x130)]+_0x1fa889(0x1c3));let _0x5e383c=0x0,_0x7864ab=0x0;for(const _0x523669 of _0x20ad81){try{if(_0x3d9d8d[_0x1fa889(0x175)](_0x523669['id'])){console[_0x1fa889(0x1d9)](_0x1fa889(0x218)+_0x523669['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x7864ab++;continue;}if(this['paymentTimers'][_0x1fa889(0x1e3)](_0x523669['id'])){console['log'](_0x1fa889(0x218)+_0x523669['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x7864ab++;continue;}const _0x5d4d88=(Date['now']()-_0x523669['createdAt'][_0x1fa889(0x20b)]())/(0x3e8*0x3c*0x3c);if(_0x5d4d88<0x1){console[_0x1fa889(0x1d9)](_0x1fa889(0x218)+_0x523669['id']+'\x20is\x20too\x20new\x20('+_0x5d4d88[_0x1fa889(0x15d)](0x1)+_0x1fa889(0x153)),_0x7864ab++;continue;}console[_0x1fa889(0x1d9)](_0x1fa889(0x187)+_0x523669['id']+'\x20(age:\x20'+_0x5d4d88[_0x1fa889(0x15d)](0x1)+'h)'),await this[_0x1fa889(0x1f0)](_0x523669),_0x5e383c++,await new Promise(_0x3ba3f2=>setTimeout(_0x3ba3f2,0x7d0));}catch(_0x1defba){console[_0x1fa889(0x1a2)]('❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x523669['id']+':',_0x1defba),this[_0x1fa889(0x176)](_0x523669['id'],_0x523669[_0x1fa889(0x134)]||_0x1fa889(0x19c),_0x1defba,_0x1fa889(0x1af),{'isGlobalCheck':!![],'paymentAmount':_0x523669[_0x1fa889(0x148)],'paymentCurrency':_0x523669[_0x1fa889(0x1e1)],'shopId':_0x523669[_0x1fa889(0x163)],'createdAt':_0x523669['createdAt']}),loggerService_1[_0x1fa889(0x16f)][_0x1fa889(0x1f2)]('cointopay',_0x1fa889(0x19a)+_0x523669['gatewayPaymentId'],_0x1defba);}}console[_0x1fa889(0x1d9)](_0x1fa889(0x13b)+_0x5e383c+_0x1fa889(0x1df)+_0x7864ab+_0x1fa889(0x185)+_0x3d9d8d[_0x1fa889(0x130)]+_0x1fa889(0x1a9));}catch(_0x3f569a){console['error'](_0x1fa889(0x181),_0x3f569a);}}async[a42_0x3d3a45(0x141)](_0x5c3c90){const _0x4499dd=a42_0x3d3a45,_0x8345e4=[],_0x59df56=new Date();_0x59df56[_0x4499dd(0x197)](_0x59df56[_0x4499dd(0x164)]()-this[_0x4499dd(0x14b)]),console[_0x4499dd(0x1d9)](_0x4499dd(0x1cb)+this[_0x4499dd(0x14b)]+_0x4499dd(0x1ea)+_0x59df56['toISOString']()+')');for(const _0x587f0c of _0x5c3c90){if(_0x587f0c[_0x4499dd(0x1b3)]<_0x59df56){console[_0x4499dd(0x1d9)](_0x4499dd(0x19e)+_0x587f0c['id']+'\x20is\x20older\x20than\x20'+this[_0x4499dd(0x14b)]+_0x4499dd(0x1dc));try{this['logCoinToPayStatus'](_0x587f0c['id'],_0x587f0c[_0x4499dd(0x134)]||_0x4499dd(0x19c),_0x4499dd(0x123),_0x4499dd(0x209),_0x4499dd(0x166),{'reason':_0x4499dd(0x116)+this[_0x4499dd(0x14b)]+_0x4499dd(0x190),'createdAt':_0x587f0c[_0x4499dd(0x1b3)],'daysSinceCreation':Math[_0x4499dd(0x121)]((Date[_0x4499dd(0x1e2)]()-_0x587f0c[_0x4499dd(0x1b3)][_0x4499dd(0x20b)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x587f0c[_0x4499dd(0x148)],'paymentCurrency':_0x587f0c['currency'],'shopId':_0x587f0c[_0x4499dd(0x163)]}),await database_1[_0x4499dd(0x1cf)][_0x4499dd(0x119)][_0x4499dd(0x1e6)]({'where':{'id':_0x587f0c['id']},'data':{'status':_0x4499dd(0x209),'updatedAt':new Date(),'adminNotes':_0x4499dd(0x215)+this[_0x4499dd(0x14b)]+'\x20days\x20without\x20payment\x20confirmation'}}),await database_1[_0x4499dd(0x1cf)][_0x4499dd(0x1d1)][_0x4499dd(0x106)]({'data':{'paymentId':_0x587f0c['id'],'shopId':_0x587f0c[_0x4499dd(0x163)],'event':_0x4499dd(0x10e),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x4499dd(0x116)+this[_0x4499dd(0x14b)]+_0x4499dd(0x190),'createdAt':_0x587f0c[_0x4499dd(0x1b3)],'expiredAt':new Date()[_0x4499dd(0x18c)](),'daysSinceCreation':Math[_0x4499dd(0x121)]((Date['now']()-_0x587f0c['createdAt'][_0x4499dd(0x20b)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x4499dd(0x17a)](_0x587f0c,_0x4499dd(0x209)),await this[_0x4499dd(0x208)](_0x587f0c,_0x4499dd(0x209)),this['clearPaymentTimers'](_0x587f0c['id']),_0x8345e4[_0x4499dd(0x1a6)](_0x587f0c['id']),console[_0x4499dd(0x1d9)](_0x4499dd(0x109)+_0x587f0c['id']+_0x4499dd(0x11e)+this[_0x4499dd(0x14b)]+'-day\x20timeout');}catch(_0x3be657){console[_0x4499dd(0x1a2)](_0x4499dd(0x11b)+_0x587f0c['id']+':',_0x3be657),this[_0x4499dd(0x176)](_0x587f0c['id'],_0x587f0c[_0x4499dd(0x134)]||_0x4499dd(0x19c),_0x3be657,_0x4499dd(0x166),{'reason':_0x4499dd(0x157),'createdAt':_0x587f0c['createdAt'],'daysSinceCreation':Math[_0x4499dd(0x121)]((Date[_0x4499dd(0x1e2)]()-_0x587f0c[_0x4499dd(0x1b3)][_0x4499dd(0x20b)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x8345e4;}async['checkSinglePayment'](_0x194f3c){const _0x269852=a42_0x3d3a45;if(!_0x194f3c['gatewayPaymentId']){console[_0x269852(0x1d9)](_0x269852(0x1ad)+_0x194f3c['id']+_0x269852(0x1da));return;}console[_0x269852(0x1d9)](_0x269852(0x207)+_0x194f3c[_0x269852(0x137)]+_0x269852(0x140)+_0x194f3c['id']+'\x20('+_0x194f3c['gatewayPaymentId']+')');try{let _0x49ff6c;_0x194f3c['gateway']==='cointopay2'?(_0x49ff6c=await this[_0x269852(0x19f)][_0x269852(0x17f)](_0x194f3c['gatewayPaymentId']),console[_0x269852(0x1d9)](_0x269852(0x1ee)+_0x194f3c['id']+_0x269852(0x16e)+_0x49ff6c[_0x269852(0x1b0)])):(_0x49ff6c=await this[_0x269852(0x1b6)][_0x269852(0x17f)](_0x194f3c[_0x269852(0x134)]),console[_0x269852(0x1d9)]('📊\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x194f3c['id']+_0x269852(0x16e)+_0x49ff6c[_0x269852(0x1b0)]));_0x49ff6c[_0x269852(0x1ae)]&&console['log'](_0x269852(0x1f4)+_0x194f3c['id']+_0x269852(0x179),{'iban':_0x49ff6c[_0x269852(0x1ae)][_0x269852(0x15f)]||_0x269852(0x1cd),'transactionId':_0x49ff6c[_0x269852(0x1ae)][_0x269852(0x1b2)],'createdOn':_0x49ff6c[_0x269852(0x1ae)]['createdOn'],'confirmedOn':_0x49ff6c['paymentDetails']['confirmedOn']||_0x269852(0x128)});if(_0x49ff6c[_0x269852(0x1b0)]!==_0x194f3c[_0x269852(0x1b0)]){console[_0x269852(0x1d9)](_0x269852(0x20e)+_0x194f3c['id']+'\x20status\x20from\x20'+_0x194f3c[_0x269852(0x1b0)]+_0x269852(0x14a)+_0x49ff6c[_0x269852(0x1b0)]),this['logCoinToPayStatus'](_0x194f3c['id'],_0x194f3c['gatewayPaymentId'],_0x194f3c[_0x269852(0x1b0)],_0x49ff6c[_0x269852(0x1b0)],_0x269852(0x1af),{'paymentDetails':_0x49ff6c[_0x269852(0x1ae)],'amount':_0x49ff6c[_0x269852(0x148)],'currency':_0x49ff6c[_0x269852(0x1e1)],'shopId':_0x194f3c['shopId'],'checkTimestamp':new Date()[_0x269852(0x18c)]()});const _0x20b975={'status':_0x49ff6c[_0x269852(0x1b0)],'updatedAt':new Date()};if(_0x49ff6c['status']===_0x269852(0x191)&&_0x194f3c[_0x269852(0x1b0)]!=='PAID'){_0x20b975[_0x269852(0x1c0)]=new Date();if(!_0x194f3c['amountUSDT']){const _0x1952d6=await currencyService_1[_0x269852(0x184)]['convertToUSDT'](_0x194f3c[_0x269852(0x148)],_0x194f3c[_0x269852(0x1e1)]);_0x20b975['amountUSDT']=_0x1952d6;const _0x24b84a=await this[_0x269852(0x171)](_0x194f3c[_0x269852(0x163)],_0x194f3c[_0x269852(0x137)]),_0x4c6b41=_0x1952d6*(0x1-_0x24b84a/0x64);_0x20b975[_0x269852(0x1cc)]=_0x4c6b41,_0x20b975[_0x269852(0x1ca)]=_0x24b84a,console[_0x269852(0x1d9)](_0x269852(0x136)+_0x194f3c['id']+_0x269852(0x110)),console['log'](_0x269852(0x18f)+_0x194f3c[_0x269852(0x148)]+'\x20'+_0x194f3c['currency']+_0x269852(0x19d)+_0x1952d6[_0x269852(0x15d)](0x6)+_0x269852(0x1e4)),console[_0x269852(0x1d9)]('\x20\x20\x20Gateway\x20'+_0x194f3c['gateway']+_0x269852(0x203)+_0x24b84a+'%'),console['log'](_0x269852(0x1c1)+_0x4c6b41['toFixed'](0x6)+_0x269852(0x1e4));}console['log']('💰\x20[CHECK]\x20Payment\x20'+_0x194f3c['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x20b975[_0x269852(0x1c0)]['toISOString']());}if(_0x49ff6c['paymentDetails']){const _0x5533e5=_0x49ff6c[_0x269852(0x1ae)];_0x5533e5[_0x269852(0x15f)]&&(_0x20b975[_0x269852(0x17e)]=_0x5533e5['iban'],console[_0x269852(0x1d9)](_0x269852(0x1db)+_0x5533e5[_0x269852(0x15f)]));if(_0x5533e5[_0x269852(0x158)]){const _0x24d247=_0x194f3c[_0x269852(0x1aa)]||'',_0x4d3240=_0x269852(0x182)+_0x5533e5[_0x269852(0x158)];_0x20b975[_0x269852(0x1aa)]=_0x24d247?_0x24d247+'\x0a\x0a'+_0x4d3240:_0x4d3240,console[_0x269852(0x1d9)](_0x269852(0x120));}_0x5533e5[_0x269852(0x1b2)]&&console[_0x269852(0x1d9)](_0x269852(0x159)+_0x5533e5['transactionId']),_0x5533e5['confirmedOn']&&console[_0x269852(0x1d9)](_0x269852(0x144)+_0x5533e5[_0x269852(0x20d)]);}await database_1[_0x269852(0x1cf)][_0x269852(0x119)][_0x269852(0x1e6)]({'where':{'id':_0x194f3c['id']},'data':_0x20b975});if(_0x49ff6c['status']===_0x269852(0x191)&&_0x194f3c['status']!==_0x269852(0x191)){console[_0x269852(0x1d9)](_0x269852(0x14e)+_0x194f3c['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x3332cc=await database_1[_0x269852(0x1cf)]['payment'][_0x269852(0x15e)]({'where':{'id':_0x194f3c['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x3332cc?.[_0x269852(0x199)]&&_0x3332cc[_0x269852(0x114)])try{const _0x1aeeb4=_0x3332cc['paymentLink'];console['log'](_0x269852(0x1b1)+_0x1aeeb4['id']+_0x269852(0x192)+_0x1aeeb4['type']+_0x269852(0x1bc)+_0x1aeeb4[_0x269852(0x1fb)]+',\x20status='+_0x1aeeb4[_0x269852(0x1b0)]);const _0x1e9b0d=_0x1aeeb4[_0x269852(0x1fb)]+0x1,_0x4f4dc8=_0x1aeeb4['type']==='SINGLE'?_0x269852(0x189):_0x1aeeb4[_0x269852(0x1b0)];await database_1[_0x269852(0x1cf)][_0x269852(0x114)][_0x269852(0x1e6)]({'where':{'id':_0x1aeeb4['id']},'data':{'currentPayments':_0x1e9b0d,'status':_0x4f4dc8,'updatedAt':new Date()}}),console[_0x269852(0x1d9)](_0x269852(0x139)+_0x1aeeb4['id']+'\x20updated:\x20currentPayments='+_0x1aeeb4[_0x269852(0x1fb)]+'\x20->\x20'+_0x1e9b0d+',\x20status='+_0x1aeeb4[_0x269852(0x1b0)]+'\x20->\x20'+_0x4f4dc8);}catch(_0x1c6806){console[_0x269852(0x1a2)](_0x269852(0x10a),_0x1c6806);}else console['log'](_0x269852(0x14e)+_0x194f3c['id']+_0x269852(0x1b7));}await database_1[_0x269852(0x1cf)]['webhookLog'][_0x269852(0x106)]({'data':{'paymentId':_0x194f3c['id'],'shopId':_0x194f3c[_0x269852(0x163)],'event':_0x269852(0x195)+_0x49ff6c[_0x269852(0x1b0)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x194f3c[_0x269852(0x1b0)],'newStatus':_0x49ff6c[_0x269852(0x1b0)],'paymentDetails':_0x49ff6c['paymentDetails'],'checkedAt':new Date()[_0x269852(0x18c)]()})}}),await this[_0x269852(0x17a)](_0x194f3c,_0x49ff6c[_0x269852(0x1b0)]),await this[_0x269852(0x208)](_0x194f3c,_0x49ff6c[_0x269852(0x1b0)]),_0x49ff6c[_0x269852(0x1b0)]!==_0x269852(0x123)&&(console[_0x269852(0x1d9)]('🧹\x20[CHECK]\x20Payment\x20'+_0x194f3c['id']+_0x269852(0x194)+_0x49ff6c[_0x269852(0x1b0)]+_0x269852(0x20c)),this[_0x269852(0x1e8)](_0x194f3c['id'])),console[_0x269852(0x1d9)]('✅\x20[CHECK]\x20Payment\x20'+_0x194f3c['id']+_0x269852(0x13f));}else console[_0x269852(0x1d9)](_0x269852(0x1f4)+_0x194f3c['id']+_0x269852(0x188)+_0x49ff6c[_0x269852(0x1b0)]+')'),this['logCoinToPayStatus'](_0x194f3c['id'],_0x194f3c[_0x269852(0x134)],_0x194f3c[_0x269852(0x1b0)],_0x49ff6c[_0x269852(0x1b0)],_0x269852(0x1af),{'statusUnchanged':!![],'paymentDetails':_0x49ff6c[_0x269852(0x1ae)],'amount':_0x49ff6c[_0x269852(0x148)],'currency':_0x49ff6c[_0x269852(0x1e1)],'shopId':_0x194f3c['shopId'],'checkTimestamp':new Date()[_0x269852(0x18c)]()});}catch(_0x16a595){console[_0x269852(0x1a2)](_0x269852(0x17c)+_0x194f3c['id']+':',_0x16a595),this[_0x269852(0x176)](_0x194f3c['id'],_0x194f3c[_0x269852(0x134)],_0x16a595,_0x269852(0x1af),{'paymentAmount':_0x194f3c[_0x269852(0x148)],'paymentCurrency':_0x194f3c[_0x269852(0x1e1)],'shopId':_0x194f3c[_0x269852(0x163)],'createdAt':_0x194f3c[_0x269852(0x1b3)]}),await database_1[_0x269852(0x1cf)][_0x269852(0x1d1)][_0x269852(0x106)]({'data':{'paymentId':_0x194f3c['id'],'shopId':_0x194f3c[_0x269852(0x163)],'event':_0x269852(0x11d),'statusCode':0x1f4,'responseBody':JSON[_0x269852(0x16c)]({'error':_0x16a595 instanceof Error?_0x16a595['message']:_0x269852(0x147),'gatewayPaymentId':_0x194f3c[_0x269852(0x134)],'checkedAt':new Date()[_0x269852(0x18c)]()})}});}}async[a42_0x3d3a45(0x17a)](_0x1d8fe2,_0x170264){const _0x17ccc4=a42_0x3d3a45,_0x198048=Date['now']();try{const _0x2d7113=_0x1d8fe2[_0x17ccc4(0x1d4)],_0x4e4bbb=_0x2d7113[_0x17ccc4(0x1c4)];if(!_0x4e4bbb?.[_0x17ccc4(0x20a)]){console[_0x17ccc4(0x1d9)](_0x17ccc4(0x1ba)+_0x2d7113['id']);return;}const _0x18c4e9=_0x170264===_0x17ccc4(0x191)?_0x17ccc4(0x162):_0x170264===_0x17ccc4(0x1a3)?'payment.failed':_0x170264===_0x17ccc4(0x209)?_0x17ccc4(0x1a1):_0x17ccc4(0x1de);if(!_0x4e4bbb[_0x17ccc4(0x118)]?.[_0x17ccc4(0x175)](_0x18c4e9)){console[_0x17ccc4(0x1d9)](_0x17ccc4(0x1dd)+_0x18c4e9+_0x17ccc4(0x1d7)+_0x2d7113['id']);return;}const _0x13a004=(0x0,gateway_1[_0x17ccc4(0x138)])(_0x1d8fe2['gateway'])||_0x1d8fe2[_0x17ccc4(0x137)],_0x39f205={'event':_0x18c4e9,'payment':{'id':_0x1d8fe2['id'],'order_id':_0x1d8fe2['orderId'],'gateway_order_id':_0x1d8fe2[_0x17ccc4(0x11c)],'gateway':_0x13a004,'amount':_0x1d8fe2[_0x17ccc4(0x148)],'currency':_0x1d8fe2[_0x17ccc4(0x1e1)],'status':_0x170264[_0x17ccc4(0x1c7)](),'customer_email':_0x1d8fe2['customerEmail'],'customer_name':_0x1d8fe2['customerName'],'created_at':_0x1d8fe2['createdAt'],'updated_at':new Date()}},_0x759d4a=await fetch(_0x4e4bbb[_0x17ccc4(0x20a)],{'method':_0x17ccc4(0x14d),'headers':{'Content-Type':_0x17ccc4(0x115),'User-Agent':_0x17ccc4(0x173)},'body':JSON[_0x17ccc4(0x16c)](_0x39f205)}),_0x1b884a=Date[_0x17ccc4(0x1e2)]()-_0x198048,_0x52bb89=_0x759d4a['ok']?_0x17ccc4(0x111):await _0x759d4a[_0x17ccc4(0x124)]();loggerService_1[_0x17ccc4(0x16f)][_0x17ccc4(0x12d)](_0x1d8fe2[_0x17ccc4(0x163)],_0x4e4bbb[_0x17ccc4(0x20a)],_0x18c4e9,_0x759d4a[_0x17ccc4(0x1b0)],_0x1b884a,_0x39f205),console[_0x17ccc4(0x1d9)](_0x17ccc4(0x1f1)+_0x4e4bbb['webhookUrl']+'\x20with\x20status\x20'+_0x759d4a[_0x17ccc4(0x1b0)]+'\x20('+_0x1b884a+_0x17ccc4(0x1fa));}catch(_0x2de273){console[_0x17ccc4(0x1a2)](_0x17ccc4(0x1bd),_0x2de273),loggerService_1[_0x17ccc4(0x16f)][_0x17ccc4(0x1a7)](_0x1d8fe2[_0x17ccc4(0x163)],_0x1d8fe2['shop']?.[_0x17ccc4(0x1c4)]?.['webhookUrl']||'unknown',_0x17ccc4(0x18e),_0x2de273,{});}}async[a42_0x3d3a45(0x208)](_0x13cf69,_0x2ba856){const _0x56ace1=a42_0x3d3a45;try{const _0x428e74={'PENDING':'created','PAID':_0x56ace1(0x1b5),'FAILED':_0x56ace1(0x18a),'EXPIRED':_0x56ace1(0x1c5)},_0x4d997e=_0x428e74[_0x2ba856];if(!_0x4d997e||_0x4d997e===_0x56ace1(0x146))return;await telegramBotService_1['telegramBotService'][_0x56ace1(0x133)](_0x13cf69[_0x56ace1(0x163)],_0x13cf69,_0x4d997e);}catch(_0x18c245){console[_0x56ace1(0x1a2)](_0x56ace1(0x1fd),_0x18c245);}}async['checkPaymentById'](_0x327588){const _0x48fd1f=a42_0x3d3a45;console[_0x48fd1f(0x1d9)]('🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x327588);const _0x4c6056=await database_1[_0x48fd1f(0x1cf)][_0x48fd1f(0x119)][_0x48fd1f(0x15e)]({'where':{'id':_0x327588},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4c6056)throw new Error(_0x48fd1f(0x154));if(_0x4c6056[_0x48fd1f(0x137)]!=='cointopay'&&_0x4c6056[_0x48fd1f(0x137)]!==_0x48fd1f(0x108))throw new Error(_0x48fd1f(0x15a));console[_0x48fd1f(0x1d9)](_0x48fd1f(0x1ab)+_0x4c6056['gateway']+_0x48fd1f(0x140)+_0x327588),await this[_0x48fd1f(0x1f0)](_0x4c6056),console[_0x48fd1f(0x1d9)](_0x48fd1f(0x1d0)+_0x327588);}[a42_0x3d3a45(0x10d)](){const _0x2d35c9=a42_0x3d3a45,_0x3d492c=this['globalCheckInterval']?this[_0x2d35c9(0x125)]:undefined,_0x3a1b40=Array[_0x2d35c9(0x1f5)](this[_0x2d35c9(0x132)]['values']())[_0x2d35c9(0x1ff)](_0x45ec21=>({'paymentId':_0x45ec21['paymentId'],'gatewayPaymentId':_0x45ec21[_0x2d35c9(0x134)],'createdAt':_0x45ec21['createdAt'],'timersCount':_0x45ec21[_0x2d35c9(0x178)]['length']}));return{'isActive':!!this[_0x2d35c9(0x1a4)],'globalCheckIntervalMinutes':this[_0x2d35c9(0x125)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x2d35c9(0x132)][_0x2d35c9(0x214)],'nextGlobalCheckIn':_0x3d492c,'paymentTimersDetails':_0x3a1b40};}['getPaymentTimerInfo'](_0x2adaeb){const _0x1b2f88=a42_0x3d3a45,_0x2b046b=this[_0x1b2f88(0x132)][_0x1b2f88(0x1eb)](_0x2adaeb);if(_0x2b046b)return{'hasTimers':!![],'timersCount':_0x2b046b[_0x1b2f88(0x178)][_0x1b2f88(0x130)],'createdAt':_0x2b046b['createdAt'],'gatewayPaymentId':_0x2b046b[_0x1b2f88(0x134)]};return{'hasTimers':![]};}async[a42_0x3d3a45(0x171)](_0x4490cf,_0x286df1){const _0xcd68a=a42_0x3d3a45;try{const _0x57f087=await database_1['default'][_0xcd68a(0x1d4)]['findUnique']({'where':{'id':_0x4490cf},'select':{'gatewaySettings':!![]}});if(!_0x57f087?.[_0xcd68a(0x205)])return console[_0xcd68a(0x1d9)](_0xcd68a(0x10f)+_0x4490cf+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x883d85=JSON[_0xcd68a(0x145)](_0x57f087[_0xcd68a(0x205)]);for(const [_0x123ee8,_0x314bdf]of Object[_0xcd68a(0x16b)](_0x883d85)){if(_0x123ee8[_0xcd68a(0x1c7)]()===_0x286df1[_0xcd68a(0x1c7)]()){const _0x4c39f9=_0x314bdf[_0xcd68a(0x1ce)]||0xa;return console['log'](_0xcd68a(0x14f)+_0x286df1+'\x20commission\x20for\x20shop\x20'+_0x4490cf+':\x20'+_0x4c39f9+'%'),_0x4c39f9;}}return console['log'](_0xcd68a(0x135)+_0x286df1+_0xcd68a(0x1ac)+_0x4490cf+_0xcd68a(0x13d)),0xa;}catch(_0xa2f734){return console[_0xcd68a(0x1a2)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x4490cf+_0xcd68a(0x10c)+_0x286df1+':',_0xa2f734),0xa;}}}function a42_0x1b72(){const _0x11f062=['paid','coinToPayService','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20\x20\x20📅\x20Time:\x20','__esModule','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20',',\x20currentPayments=','Failed\x20to\x20send\x20shop\x20webhook:','stack','findMany','paidAt','\x20\x20\x20Amount\x20after\x20commission:\x20','3460194ZszQUA','\x20expired\x20CoinToPay\x20payments','settings','expired','\x20completed\x20for\x20payment\x20','toLowerCase','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','\x20\x20\x20-\x20Amount:\x20','gatewayCommissionRate','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','amountAfterGatewayCommissionUSDT','not\x20found','commission','default','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','webhookLog','⏰\x20[HOURLY]\x20Payment\x20','680014uZUMmu','shop','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','4062227lWfWBy','\x20not\x20enabled\x20for\x20shop\x20','🛑\x20[SHUTDOWN]\x20Cleared\x20','log','\x20has\x20no\x20gatewayPaymentId,\x20skipping','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','\x20days,\x20marking\x20as\x20EXPIRED','Webhook\x20event\x20','payment.pending','\x20checked,\x20','\x20has\x20no\x20gatewayPaymentId','currency','now','has','\x20USDT','\x20timers\x20for\x20payment\x20','update','checkAllPendingPayments','clearPaymentTimers','\x20\x20\x20📍\x20Source:\x20','\x20days\x20(created\x20before\x20','get','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','__importDefault','checkSinglePayment','Shop\x20webhook\x20sent\x20to\x20','logWhiteDomainError','delete','📊\x20[CHECK]\x20Payment\x20','from','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','\x20\x20\x20📝\x20Details:','\x20\x20\x20-\x20Status:\x20','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','ms)','currentPayments','🧹\x20[DEBUG]\x20Clearing\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','map','checkSinglePaymentById','\x20\x20\x20-\x20paymentId:\x20','coinToPayStatusService','\x20commission:\x20','../types/gateway','gatewaySettings','COINTOPAY_ERROR','🔍\x20[CHECK]\x20Checking\x20','sendPaymentStatusNotification','EXPIRED','webhookUrl','getTime',',\x20clearing\x20individual\x20timers','confirmedOn','🔄\x20[CHECK]\x20Updating\x20payment\x20','./currencyService','set','timestamp','648104wuXFxX','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','size','Automatically\x20expired\x20after\x20','\x20initial\x20timers\x20for\x20payment\x20','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','⏰\x20[GLOBAL]\x20Payment\x20','\x20(after\x20','208769iAtxAa','stopPeriodicStatusCheck','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','create','forEach','cointopay2','✅\x20[EXPIRY]\x20Payment\x20','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','description',',\x20gateway\x20','getServiceStats','cointopay_auto_expired','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','\x20amounts\x20calculated:','Success','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','✅\x20[TIMER]\x20Individual\x20check\x20#','paymentLink','application/json','Payment\x20older\x20than\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','webhookEvents','payment','CoinToPayService','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','gatewayOrderId','cointopay_status_check_error','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','./loggerService','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','floor','../config/database','PENDING','text','GLOBAL_CHECK_INTERVAL_MS','\x20to\x20clear','300HoDShz','not\x20confirmed','\x20for\x20payment\x20','1OSshni','logCoinToPayStatus','\x20\x20\x20📝\x20Context:','logShopWebhookSent','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20\x20\x20❌\x20Error:\x20','length','delay','paymentTimers','sendPaymentNotification','gatewayPaymentId','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','💰\x20[CHECK]\x20Payment\x20','gateway','getGatewayIdByName','✅\x20[COINTOPAY]\x20Payment\x20link\x20','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20',',\x20using\x20default\x2010%','🪙\x20[GLOBAL]\x20Found\x20','\x20updated\x20successfully','\x20payment\x20','checkExpiredPayments','\x20seconds\x20(','7rYnyoo','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','parse','created','Unknown\x20error','amount','48HTaqLp','\x20to\x20','EXPIRY_DAYS','🪙\x20[DEBUG]\x20Creating\x20','POST','📈\x20[COINTOPAY]\x20Payment\x20','Gateway\x20','⏰\x20[GLOBAL]\x20Found\x20','schedule_created','118218JJbDrP','h),\x20skipping\x20global\x20check','Payment\x20not\x20found','5NBDKjU','\x20current\x20status:\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','bankDetails','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20\x20\x20-\x20GatewayPaymentId:\x20','2315316GFOCVA','toFixed','findUnique','iban','cointopay','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','payment.success','shopId','getDate','\x20individual\x20payment\x20timers','auto_expire','\x20is\x20older\x20than\x20','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','✅\x20[HOURLY]\x20Payment\x20','entries','stringify','CoinToPay2Service','\x20status:\x20','loggerService','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','getGatewayCommission','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','Payment\x20System/1.0','CoinToPayStatusService','includes','logCoinToPayError','./gateways/coinToPay2Service','timers','\x20details:','sendShopWebhook',',\x20stopping\x20individual\x20checks','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','❌\x20[HOURLY]\x20Payment\x20','remitterIban','checkPaymentStatus','\x20status\x20is\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','Bank\x20Details:\x20','\x20found:','currencyService','\x20skipped,\x20','message','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20status\x20unchanged\x20(','COMPLETED','failed','defineProperty','toISOString','\x20is\x20valid\x20for\x20checking,\x20proceeding...','webhook_send','\x20\x20\x20Amount:\x20','\x20days','PAID',':\x20type=','1\x20minute','\x20status\x20changed\x20to\x20','cointopay_status_check_','📊\x20[HOURLY]\x20Payment\x20','setDate','schedulePaymentChecks','paymentLinkId','/status/','\x20pending\x20CoinToPay\x20payments','unknown','\x20->\x20','⏰\x20[EXPIRY]\x20Payment\x20','coinToPay2Service','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','payment.failed','error','FAILED','globalCheckInterval','🪙\x20[TIMER]\x20Individual\x20check\x20#','push','logShopWebhookError','20dSYJPo','\x20expired','adminNotes','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20in\x20shop\x20','⚠️\x20[CHECK]\x20Payment\x20','paymentDetails','status_check','status','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','transactionId','createdAt','./telegramBotService'];a42_0x1b72=function(){return _0x11f062;};return a42_0x1b72();}exports['CoinToPayStatusService']=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();