'use strict';const a42_0x126e92=a42_0x2aa0;(function(_0x36e7fa,_0x4d6e6d){const _0x3328b6=a42_0x2aa0,_0x47ce22=_0x36e7fa();while(!![]){try{const _0x3cd437=parseInt(_0x3328b6(0x154))/0x1*(-parseInt(_0x3328b6(0x175))/0x2)+-parseInt(_0x3328b6(0xfd))/0x3*(-parseInt(_0x3328b6(0x199))/0x4)+parseInt(_0x3328b6(0x19e))/0x5+parseInt(_0x3328b6(0xd3))/0x6+parseInt(_0x3328b6(0x1c6))/0x7*(-parseInt(_0x3328b6(0x1d8))/0x8)+parseInt(_0x3328b6(0x18d))/0x9*(parseInt(_0x3328b6(0xed))/0xa)+parseInt(_0x3328b6(0x195))/0xb*(-parseInt(_0x3328b6(0xf6))/0xc);if(_0x3cd437===_0x4d6e6d)break;else _0x47ce22['push'](_0x47ce22['shift']());}catch(_0x41f196){_0x47ce22['push'](_0x47ce22['shift']());}}}(a42_0x15ed,0x97c4e));var __importDefault=this&&this[a42_0x126e92(0xf8)]||function(_0x17880a){const _0x592c5f=a42_0x126e92;return _0x17880a&&_0x17880a[_0x592c5f(0x104)]?_0x17880a:{'default':_0x17880a};};function a42_0x15ed(){const _0x343e9e=['223488vURJAt','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','__importDefault','Failed\x20to\x20mark\x20payment\x20as\x20expired','./currencyService',',\x20using\x20default\x20commission\x2010%','\x20triggered\x20for\x20payment\x20','183CIlInk','payment.success','ms)','\x20is\x20too\x20new\x20(','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20marked\x20as\x20paid\x20at:\x20','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','__esModule','toISOString','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','status_check','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','paidAt','CoinToPayStatusService','\x20\x20\x20Amount\x20after\x20commission:\x20','entries','amountUSDT','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','default','⚠️\x20[CHECK]\x20Payment\x20','webhookUrl','gatewaySettings','logWhiteDomainError','timestamp','from','1\x20minute','\x20\x20\x20-\x20paymentId:\x20','now','defineProperty','update','🪙\x20[TIMER]\x20Individual\x20check\x20#','get','CoinToPay2Service','checkExpiredPayments','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','commission','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','📊\x20[CHECK]\x20Payment\x20','loggerService','cointopay_status_check_error','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','confirmedOn','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','currentPayments','telegramBotService','💰\x20[CHECK]\x20Payment\x20','delete','gatewayPaymentId','\x20expired','🔍\x20[CHECK]\x20Checking\x20','\x20\x20\x20📝\x20Context:','log','create','\x20\x20\x20📍\x20Source:\x20','error','delay','cointopay','🛑\x20[SHUTDOWN]\x20Cleared\x20','logCoinToPayError','Payment\x20older\x20than\x20','settings','gatewayCommissionRate','🧹\x20[CHECK]\x20Payment\x20','getGatewayCommission','\x20\x20\x20📊\x20Status:\x20','globalCheckInterval','\x20checked,\x20','✅\x20[EXPIRY]\x20Payment\x20','logCoinToPayStatus','paymentLink','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','not\x20found','GLOBAL_CHECK_INTERVAL_MS','status','cointopay_status_check_','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','COINTOPAY_STATUS_CHANGE','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','\x20\x20\x20Gateway\x20','size','stringify','text','stack','cointopay2','schedule_created','100099renhPG','\x20status\x20is\x20','gateway','\x20skipped,\x20','CoinToPayService','webhookLog','created','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','checkPaymentStatus','./loggerService','iban','❌\x20[CHECK]\x20Payment\x20','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','clearPaymentTimers','\x20updated\x20successfully','getServiceStats','getTime','sendShopWebhook','checkSinglePaymentById','\x20status\x20changed\x20to\x20','\x20days,\x20marking\x20as\x20EXPIRED','createdOn','/status/','COINTOPAY_ERROR','\x20individual\x20payment\x20timers','Payment\x20System/1.0','🪙\x20[GLOBAL]\x20Found\x20','Shop\x20webhook\x20sent\x20to\x20','getDate','unknown','../config/database','\x20to\x20clear','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','14xihEKG','auto_expire','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','customerEmail','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','floor','\x20amounts\x20calculated:','paymentDetails','Unknown\x20error',':\x20type=','sendPaymentStatusNotification',',\x20stopping\x20individual\x20checks','logShopWebhookError','COMPLETED','./telegramBotService','\x20details:','\x20\x20\x20-\x20GatewayPaymentId:\x20','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','PENDING','\x20days','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','description','./gateways/coinToPayService','map','36eGOZne','paymentTimers','set','shop','webhookEvents','customerName','webhook_send','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','330DIxztk','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20updated:\x20currentPayments=','push','54308gRdVWZ','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','paymentId','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','4743485kVMkIZ','✅\x20[HOURLY]\x20Payment\x20','forEach','message','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20not\x20enabled\x20for\x20shop\x20','orderId','PAID','timers','\x20\x20\x20-\x20Gateway:\x20','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','payment.failed','\x20found:','POST','startPeriodicStatusCheck','includes','cointopay_auto_expired','\x20(age:\x20','payment','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','coinToPayService','./gateways/coinToPay2Service','\x20\x20\x20📝\x20Details:','coinToPayStatusService','paid','EXPIRY_DAYS','bankDetails','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','length','toLowerCase','\x20payment\x20','createdAt','convertToUSDT','\x20commission:\x20','logShopWebhookSent','expired','\x20\x20\x20❌\x20Error:\x20','findMany','📈\x20[COINTOPAY]\x20Payment\x20','⏰\x20[EXPIRY]\x20Payment\x20','1021510LhcHjP','findUnique','toFixed','📊\x20[HOURLY]\x20Payment\x20','🧹\x20[DEBUG]\x20Clearing\x20','checkAllPendingPayments','\x20(after\x20','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','has',',\x20status=','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20',',\x20gateway\x20','amount','shopId','\x20seconds\x20(','coinToPay2Service','5\x20minutes','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','48xMLSuJ','\x20expired\x20CoinToPay\x20payments',',\x20using\x20default\x2010%','\x20days\x20(created\x20before\x20','Success','4192350ylhsWo','\x20\x20\x20📅\x20Time:\x20','\x20USDT','gatewayOrderId','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','remitterIban','schedulePaymentChecks','✅\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','transactionId','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','\x20not\x20found,\x20clearing\x20timers','currency','\x20for\x20payment\x20',',\x20currentPayments=','SINGLE','⏰\x20[GLOBAL]\x20Payment\x20','✅\x20[TIMER]\x20Individual\x20check\x20#','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','\x20is\x20older\x20than\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','type','\x20not\x20found\x20in\x20database','.\x20Remaining\x20active\x20timers:\x20','EXPIRED','\x20\x20\x20Amount:\x20','702550EoAodw','\x20has\x20no\x20gatewayPaymentId','parse','currencyService','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','amountAfterGatewayCommissionUSDT','checkSinglePayment','\x20status:\x20','\x20->\x20'];a42_0x15ed=function(){return _0x343e9e;};return a42_0x15ed();}Object[a42_0x126e92(0x119)](exports,a42_0x126e92(0x104),{'value':!![]}),exports[a42_0x126e92(0x1b5)]=exports[a42_0x126e92(0x10a)]=void 0x0;function a42_0x2aa0(_0x2c3132,_0x4df26a){const _0x15eda5=a42_0x15ed();return a42_0x2aa0=function(_0x2aa087,_0x22a10b){_0x2aa087=_0x2aa087-0xd3;let _0x186797=_0x15eda5[_0x2aa087];return _0x186797;},a42_0x2aa0(_0x2c3132,_0x4df26a);}const coinToPayService_1=require(a42_0x126e92(0x18b)),coinToPay2Service_1=require(a42_0x126e92(0x1b3)),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a42_0x126e92(0x172))),telegramBotService_1=require(a42_0x126e92(0x183)),loggerService_1=require(a42_0x126e92(0x15d)),currencyService_1=require(a42_0x126e92(0xfa));class CoinToPayStatusService{constructor(){const _0x3a35bf=a42_0x126e92;this['globalCheckInterval']=null,this[_0x3a35bf(0x147)]=0x3c*0x3c*0x3e8,this[_0x3a35bf(0x1b7)]=0x5,this['paymentTimers']=new Map(),this[_0x3a35bf(0x1b2)]=new coinToPayService_1[(_0x3a35bf(0x158))](),this[_0x3a35bf(0x1d5)]=new coinToPay2Service_1[(_0x3a35bf(0x11d))](),console[_0x3a35bf(0x132)](_0x3a35bf(0x1a2));}[a42_0x126e92(0xd9)](_0x288732,_0x219bc2){const _0x43339b=a42_0x126e92;console['log']('🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x43339b(0x132)](_0x43339b(0x117)+_0x288732),console[_0x43339b(0x132)](_0x43339b(0xdb)+_0x219bc2),this['clearPaymentTimers'](_0x288732);const _0x91b2fd=[],_0x3f1511=new Date(),_0x3b87cc=[{'delay':0x1*0x3c*0x3e8,'description':_0x43339b(0x116)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x43339b(0x1d6)},{'delay':0x5*0x3c*0x3e8,'description':_0x43339b(0x1d6)}];console[_0x43339b(0x132)]('🪙\x20[DEBUG]\x20Creating\x20'+_0x3b87cc['length']+'\x20initial\x20timers\x20for\x20payment\x20'+_0x288732);let _0x4d0283=0x0;_0x3b87cc[_0x43339b(0x1a0)]((_0xa12b96,_0x5108f5)=>{const _0x5cb7c7=_0x43339b;_0x4d0283+=_0xa12b96[_0x5cb7c7(0x136)];const _0x2ee287=setTimeout(async()=>{const _0x1a5c41=_0x5cb7c7;console[_0x1a5c41(0x132)](_0x1a5c41(0x11b)+(_0x5108f5+0x1)+_0x1a5c41(0xfc)+_0x288732+_0x1a5c41(0x1cc)+_0xa12b96[_0x1a5c41(0x18a)]+')');try{await this['checkSinglePaymentById'](_0x288732),console['log'](_0x1a5c41(0xe4)+(_0x5108f5+0x1)+'\x20completed\x20for\x20payment\x20'+_0x288732);}catch(_0x4b25d7){console['error'](_0x1a5c41(0x127)+(_0x5108f5+0x1)+_0x1a5c41(0xe0)+_0x288732+':',_0x4b25d7),this[_0x1a5c41(0x139)](_0x288732,_0x219bc2,_0x4b25d7,'status_check',{'checkNumber':_0x5108f5+0x1,'scheduledAfter':_0xa12b96[_0x1a5c41(0x18a)],'isIndividualCheck':!![]});}},_0x4d0283);_0x91b2fd[_0x5cb7c7(0x198)](_0x2ee287),console[_0x5cb7c7(0x132)]('⏰\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x5108f5+0x1)+'\x20for\x20payment\x20'+_0x288732+'\x20in\x20'+_0x4d0283/0x3e8+_0x5cb7c7(0x1d4)+_0xa12b96[_0x5cb7c7(0x18a)]+')');});const _0x188ee3=setInterval(async()=>{const _0x5c51f8=_0x43339b;console[_0x5c51f8(0x132)](_0x5c51f8(0x186)+_0x288732);try{const _0x4773f5=await database_1[_0x5c51f8(0x10f)]['payment'][_0x5c51f8(0x1c7)]({'where':{'id':_0x288732},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x4773f5){console[_0x5c51f8(0x132)]('❌\x20[HOURLY]\x20Payment\x20'+_0x288732+_0x5c51f8(0xde)),this[_0x5c51f8(0x161)](_0x288732);return;}console[_0x5c51f8(0x132)](_0x5c51f8(0x1c9)+_0x288732+'\x20current\x20status:\x20'+_0x4773f5[_0x5c51f8(0x148)]);if(_0x4773f5[_0x5c51f8(0x148)]!==_0x5c51f8(0x187)){console[_0x5c51f8(0x132)](_0x5c51f8(0x19f)+_0x288732+_0x5c51f8(0x155)+_0x4773f5[_0x5c51f8(0x148)]+',\x20stopping\x20individual\x20checks'),this[_0x5c51f8(0x161)](_0x288732);return;}const _0x4e4d6e=Math['floor']((Date['now']()-_0x4773f5[_0x5c51f8(0x1bd)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x4e4d6e>=this[_0x5c51f8(0x1b7)]){console[_0x5c51f8(0x132)]('⏰\x20[HOURLY]\x20Payment\x20'+_0x288732+_0x5c51f8(0xe6)+this[_0x5c51f8(0x1b7)]+_0x5c51f8(0x189)),this[_0x5c51f8(0x161)](_0x288732);return;}await this[_0x5c51f8(0x166)](_0x288732),console[_0x5c51f8(0x132)](_0x5c51f8(0x1d0)+_0x288732);}catch(_0x2f552c){console[_0x5c51f8(0x135)](_0x5c51f8(0x11f)+_0x288732+':',_0x2f552c),this[_0x5c51f8(0x139)](_0x288732,_0x219bc2,_0x2f552c,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x91b2fd[_0x43339b(0x198)](_0x188ee3),this[_0x43339b(0x18e)][_0x43339b(0x18f)](_0x288732,{'timers':_0x91b2fd,'paymentId':_0x288732,'gatewayPaymentId':_0x219bc2,'createdAt':_0x3f1511}),console['log']('✅\x20[DEBUG]\x20Successfully\x20scheduled\x20'+_0x3b87cc[_0x43339b(0x1ba)]+_0x43339b(0x1b1)+_0x288732),console[_0x43339b(0x132)](_0x43339b(0x177)+this[_0x43339b(0x18e)][_0x43339b(0x14e)]),this[_0x43339b(0x143)](_0x288732,_0x219bc2,_0x43339b(0x187),'PENDING',_0x43339b(0x107),{'action':_0x43339b(0x153),'scheduledChecks':_0x3b87cc[_0x43339b(0x1ba)],'firstCheckIn':_0x3b87cc[0x0][_0x43339b(0x136)]/0x3e8,'totalTimers':this['paymentTimers']['size']});}[a42_0x126e92(0x161)](_0x17b531){const _0x21c33e=a42_0x126e92,_0x3b2b6e=this['paymentTimers'][_0x21c33e(0x11c)](_0x17b531);_0x3b2b6e?(console[_0x21c33e(0x132)](_0x21c33e(0x1ca)+_0x3b2b6e[_0x21c33e(0x1a6)]['length']+'\x20timers\x20for\x20payment\x20'+_0x17b531),_0x3b2b6e[_0x21c33e(0x1a6)][_0x21c33e(0x1a0)]((_0x1bf237,_0x14d56e)=>{const _0x3784cf=_0x21c33e;_0x1bf237&&(clearTimeout(_0x1bf237),clearInterval(_0x1bf237),console['log'](_0x3784cf(0x1a8)+(_0x14d56e+0x1)+_0x3784cf(0xe0)+_0x17b531));}),this['paymentTimers'][_0x21c33e(0x12d)](_0x17b531),console['log']('✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x17b531+_0x21c33e(0xea)+this[_0x21c33e(0x18e)][_0x21c33e(0x14e)])):console['log'](_0x21c33e(0x19d)+_0x17b531+_0x21c33e(0x173));}async[a42_0x126e92(0x166)](_0x381b01){const _0x20e809=a42_0x126e92;console[_0x20e809(0x132)]('🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x381b01);const _0x3be367=await database_1['default']['payment'][_0x20e809(0x1c7)]({'where':{'id':_0x381b01},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x3be367){console[_0x20e809(0x132)](_0x20e809(0x15f)+_0x381b01+_0x20e809(0xe9));return;}console[_0x20e809(0x132)](_0x20e809(0x124)+_0x381b01+_0x20e809(0x1aa)),console['log'](_0x20e809(0x1a7)+_0x3be367['gateway']),console[_0x20e809(0x132)]('\x20\x20\x20-\x20Status:\x20'+_0x3be367[_0x20e809(0x148)]),console[_0x20e809(0x132)](_0x20e809(0x185)+_0x3be367[_0x20e809(0x12e)]),console['log']('\x20\x20\x20-\x20Amount:\x20'+_0x3be367['amount']+'\x20'+_0x3be367['currency']),console[_0x20e809(0x132)]('\x20\x20\x20-\x20ShopId:\x20'+_0x3be367[_0x20e809(0x1d3)]);if(_0x3be367[_0x20e809(0x156)]!==_0x20e809(0x137)&&_0x3be367[_0x20e809(0x156)]!==_0x20e809(0x152)){console[_0x20e809(0x132)](_0x20e809(0x110)+_0x381b01+_0x20e809(0x123)+_0x3be367[_0x20e809(0x156)]+')');return;}if(_0x3be367[_0x20e809(0x148)]!==_0x20e809(0x187)){console[_0x20e809(0x132)](_0x20e809(0x110)+_0x381b01+_0x20e809(0x155)+_0x3be367[_0x20e809(0x148)]+_0x20e809(0x180)),this[_0x20e809(0x161)](_0x381b01);return;}if(!_0x3be367[_0x20e809(0x12e)]){console['log'](_0x20e809(0x110)+_0x381b01+_0x20e809(0xee));return;}console[_0x20e809(0x132)](_0x20e809(0xda)+_0x381b01+_0x20e809(0xe7)),await this[_0x20e809(0xf3)](_0x3be367);}[a42_0x126e92(0x143)](_0x22b560,_0x55da79,_0x2b7de4,_0xaf7f6a,_0x59ef0b,_0x534292){const _0x59f920=a42_0x126e92,_0x564ca6={'type':_0x59f920(0x14b),'paymentId':_0x22b560,'gatewayPaymentId':_0x55da79,'oldStatus':_0x2b7de4,'newStatus':_0xaf7f6a,'source':_0x59ef0b,'timestamp':new Date()[_0x59f920(0x105)](),'details':_0x534292||{}};loggerService_1['loggerService'][_0x59f920(0x143)](_0x564ca6),console[_0x59f920(0x132)]('🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x22b560+'\x20('+_0x55da79+')'),console[_0x59f920(0x132)](_0x59f920(0x13f)+_0x2b7de4+_0x59f920(0xf5)+_0xaf7f6a),console[_0x59f920(0x132)](_0x59f920(0x134)+_0x59ef0b),console[_0x59f920(0x132)](_0x59f920(0xd4)+_0x564ca6[_0x59f920(0x114)]),_0x534292&&console[_0x59f920(0x132)](_0x59f920(0x1b4),_0x534292);}[a42_0x126e92(0x139)](_0x5e6cb2,_0x16e97a,_0x1c9fc9,_0x529c0c,_0x124549){const _0x4a88f7=a42_0x126e92,_0x5b4491={'type':_0x4a88f7(0x16b),'paymentId':_0x5e6cb2,'gatewayPaymentId':_0x16e97a,'error':_0x1c9fc9 instanceof Error?{'message':_0x1c9fc9[_0x4a88f7(0x1a1)],'stack':_0x1c9fc9[_0x4a88f7(0x151)]}:_0x1c9fc9,'source':_0x529c0c,'timestamp':new Date()[_0x4a88f7(0x105)](),'context':_0x124549||{}};loggerService_1[_0x4a88f7(0x125)]['logCoinToPayError'](_0x5b4491),console[_0x4a88f7(0x135)](_0x4a88f7(0x179)+_0x5e6cb2+'\x20('+_0x16e97a+')'),console['error'](_0x4a88f7(0x1c2)+(_0x1c9fc9 instanceof Error?_0x1c9fc9[_0x4a88f7(0x1a1)]:_0x1c9fc9)),console[_0x4a88f7(0x135)](_0x4a88f7(0x134)+_0x529c0c),console['error'](_0x4a88f7(0xd4)+_0x5b4491[_0x4a88f7(0x114)]),_0x124549&&console['error'](_0x4a88f7(0x131),_0x124549);}[a42_0x126e92(0x1ac)](){const _0x369785=a42_0x126e92;console[_0x369785(0x132)]('🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this['checkAllPendingPayments']()['catch'](_0x35f1fa=>{const _0x429a78=_0x369785;console[_0x429a78(0x135)](_0x429a78(0x1cd),_0x35f1fa);}),this[_0x369785(0x140)]=setInterval(async()=>{const _0x3e7dd3=_0x369785;try{console[_0x3e7dd3(0x132)](_0x3e7dd3(0x196)),await this[_0x3e7dd3(0x1cb)](),console[_0x3e7dd3(0x132)](_0x3e7dd3(0x15b));}catch(_0x3f3acd){console[_0x3e7dd3(0x135)](_0x3e7dd3(0x19a),_0x3f3acd);}},this[_0x369785(0x147)]),console[_0x369785(0x132)](_0x369785(0xd7));}['stopPeriodicStatusCheck'](){const _0x21e50e=a42_0x126e92;console[_0x21e50e(0x132)](_0x21e50e(0x129));this[_0x21e50e(0x140)]&&(clearInterval(this[_0x21e50e(0x140)]),this[_0x21e50e(0x140)]=null,console[_0x21e50e(0x132)]('🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x3d41c9=this[_0x21e50e(0x18e)]['size'];for(const [_0xb9bea2]of this[_0x21e50e(0x18e)]){this[_0x21e50e(0x161)](_0xb9bea2);}console[_0x21e50e(0x132)](_0x21e50e(0x138)+_0x3d41c9+_0x21e50e(0x16c));}async[a42_0x126e92(0x1cb)](){const _0x1b32c2=a42_0x126e92;try{console[_0x1b32c2(0x132)](_0x1b32c2(0xf7));const _0x1ee7c1=await database_1[_0x1b32c2(0x10f)][_0x1b32c2(0x1b0)][_0x1b32c2(0x1c3)]({'where':{'gateway':{'in':['cointopay','cointopay2']},'status':_0x1b32c2(0x187),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x1b32c2(0x132)](_0x1b32c2(0x16e)+_0x1ee7c1[_0x1b32c2(0x1ba)]+'\x20pending\x20CoinToPay\x20payments');if(_0x1ee7c1[_0x1b32c2(0x1ba)]===0x0){console[_0x1b32c2(0x132)](_0x1b32c2(0x174));return;}const _0x3d4fc8=await this[_0x1b32c2(0x11e)](_0x1ee7c1);console[_0x1b32c2(0x132)]('⏰\x20[GLOBAL]\x20Found\x20'+_0x3d4fc8['length']+_0x1b32c2(0x1d9));let _0x4e5242=0x0,_0x224529=0x0;for(const _0x4038dc of _0x1ee7c1){try{if(_0x3d4fc8['includes'](_0x4038dc['id'])){console[_0x1b32c2(0x132)](_0x1b32c2(0xe3)+_0x4038dc['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x224529++;continue;}if(this[_0x1b32c2(0x18e)][_0x1b32c2(0x1ce)](_0x4038dc['id'])){console[_0x1b32c2(0x132)](_0x1b32c2(0xe3)+_0x4038dc['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x224529++;continue;}const _0x59fe1b=(Date[_0x1b32c2(0x118)]()-_0x4038dc['createdAt'][_0x1b32c2(0x164)]())/(0x3e8*0x3c*0x3c);if(_0x59fe1b<0x1){console[_0x1b32c2(0x132)](_0x1b32c2(0xe3)+_0x4038dc['id']+_0x1b32c2(0x100)+_0x59fe1b[_0x1b32c2(0x1c8)](0x1)+'h),\x20skipping\x20global\x20check'),_0x224529++;continue;}console[_0x1b32c2(0x132)](_0x1b32c2(0xf1)+_0x4038dc['id']+_0x1b32c2(0x1af)+_0x59fe1b[_0x1b32c2(0x1c8)](0x1)+'h)'),await this['checkSinglePayment'](_0x4038dc),_0x4e5242++,await new Promise(_0x1edeeb=>setTimeout(_0x1edeeb,0x7d0));}catch(_0x3c6407){console['error'](_0x1b32c2(0xdd)+_0x4038dc['id']+':',_0x3c6407),this[_0x1b32c2(0x139)](_0x4038dc['id'],_0x4038dc[_0x1b32c2(0x12e)]||_0x1b32c2(0x171),_0x3c6407,_0x1b32c2(0x107),{'isGlobalCheck':!![],'paymentAmount':_0x4038dc[_0x1b32c2(0x1d2)],'paymentCurrency':_0x4038dc[_0x1b32c2(0xdf)],'shopId':_0x4038dc[_0x1b32c2(0x1d3)],'createdAt':_0x4038dc[_0x1b32c2(0x1bd)]}),loggerService_1[_0x1b32c2(0x125)][_0x1b32c2(0x113)](_0x1b32c2(0x137),_0x1b32c2(0x16a)+_0x4038dc[_0x1b32c2(0x12e)],_0x3c6407);}}console[_0x1b32c2(0x132)]('✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x4e5242+_0x1b32c2(0x141)+_0x224529+_0x1b32c2(0x157)+_0x3d4fc8[_0x1b32c2(0x1ba)]+_0x1b32c2(0x12f));}catch(_0x334a5c){console['error'](_0x1b32c2(0x1b9),_0x334a5c);}}async[a42_0x126e92(0x11e)](_0x587748){const _0xe3234a=a42_0x126e92,_0x1b952b=[],_0x2c0907=new Date();_0x2c0907['setDate'](_0x2c0907[_0xe3234a(0x170)]()-this[_0xe3234a(0x1b7)]),console[_0xe3234a(0x132)]('⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0xe3234a(0x1b7)]+_0xe3234a(0x1db)+_0x2c0907[_0xe3234a(0x105)]()+')');for(const _0x36f533 of _0x587748){if(_0x36f533[_0xe3234a(0x1bd)]<_0x2c0907){console[_0xe3234a(0x132)](_0xe3234a(0x1c5)+_0x36f533['id']+_0xe3234a(0xe6)+this[_0xe3234a(0x1b7)]+_0xe3234a(0x168));try{this[_0xe3234a(0x143)](_0x36f533['id'],_0x36f533[_0xe3234a(0x12e)]||_0xe3234a(0x171),_0xe3234a(0x187),_0xe3234a(0xeb),_0xe3234a(0x176),{'reason':_0xe3234a(0x13a)+this['EXPIRY_DAYS']+_0xe3234a(0x188),'createdAt':_0x36f533[_0xe3234a(0x1bd)],'daysSinceCreation':Math['floor']((Date['now']()-_0x36f533[_0xe3234a(0x1bd)][_0xe3234a(0x164)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x36f533[_0xe3234a(0x1d2)],'paymentCurrency':_0x36f533[_0xe3234a(0xdf)],'shopId':_0x36f533[_0xe3234a(0x1d3)]}),await database_1[_0xe3234a(0x10f)][_0xe3234a(0x1b0)][_0xe3234a(0x11a)]({'where':{'id':_0x36f533['id']},'data':{'status':_0xe3234a(0xeb),'updatedAt':new Date()}}),await database_1[_0xe3234a(0x10f)]['webhookLog'][_0xe3234a(0x133)]({'data':{'paymentId':_0x36f533['id'],'shopId':_0x36f533[_0xe3234a(0x1d3)],'event':_0xe3234a(0x1ae),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0xe3234a(0x13a)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x36f533[_0xe3234a(0x1bd)],'expiredAt':new Date()[_0xe3234a(0x105)](),'daysSinceCreation':Math[_0xe3234a(0x17a)]((Date[_0xe3234a(0x118)]()-_0x36f533[_0xe3234a(0x1bd)][_0xe3234a(0x164)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0xe3234a(0x165)](_0x36f533,_0xe3234a(0xeb)),await this[_0xe3234a(0x17f)](_0x36f533,'EXPIRED'),this[_0xe3234a(0x161)](_0x36f533['id']),_0x1b952b[_0xe3234a(0x198)](_0x36f533['id']),console[_0xe3234a(0x132)](_0xe3234a(0x142)+_0x36f533['id']+_0xe3234a(0x14a)+this[_0xe3234a(0x1b7)]+'-day\x20timeout');}catch(_0x327703){console['error']('❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x36f533['id']+':',_0x327703),this[_0xe3234a(0x139)](_0x36f533['id'],_0x36f533['gatewayPaymentId']||'unknown',_0x327703,_0xe3234a(0x176),{'reason':_0xe3234a(0xf9),'createdAt':_0x36f533['createdAt'],'daysSinceCreation':Math[_0xe3234a(0x17a)]((Date['now']()-_0x36f533[_0xe3234a(0x1bd)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x1b952b;}async[a42_0x126e92(0xf3)](_0x393bf){const _0x459a15=a42_0x126e92;if(!_0x393bf['gatewayPaymentId']){console[_0x459a15(0x132)](_0x459a15(0x110)+_0x393bf['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x459a15(0x132)](_0x459a15(0x130)+_0x393bf[_0x459a15(0x156)]+'\x20payment\x20'+_0x393bf['id']+'\x20('+_0x393bf[_0x459a15(0x12e)]+')');try{let _0x5a0128;_0x393bf[_0x459a15(0x156)]===_0x459a15(0x152)?(_0x5a0128=await this[_0x459a15(0x1d5)]['checkPaymentStatus'](_0x393bf[_0x459a15(0x12e)]),console[_0x459a15(0x132)](_0x459a15(0x1d7)+_0x393bf['id']+_0x459a15(0xf4)+_0x5a0128[_0x459a15(0x148)])):(_0x5a0128=await this[_0x459a15(0x1b2)][_0x459a15(0x15c)](_0x393bf[_0x459a15(0x12e)]),console[_0x459a15(0x132)](_0x459a15(0x103)+_0x393bf['id']+'\x20status:\x20'+_0x5a0128[_0x459a15(0x148)]));_0x5a0128[_0x459a15(0x17c)]&&console[_0x459a15(0x132)](_0x459a15(0x124)+_0x393bf['id']+_0x459a15(0x184),{'iban':_0x5a0128[_0x459a15(0x17c)][_0x459a15(0x15e)]||_0x459a15(0x146),'transactionId':_0x5a0128[_0x459a15(0x17c)][_0x459a15(0xdc)],'createdOn':_0x5a0128[_0x459a15(0x17c)][_0x459a15(0x169)],'confirmedOn':_0x5a0128[_0x459a15(0x17c)]['confirmedOn']||'not\x20confirmed'});if(_0x5a0128[_0x459a15(0x148)]!==_0x393bf[_0x459a15(0x148)]){console[_0x459a15(0x132)]('🔄\x20[CHECK]\x20Updating\x20payment\x20'+_0x393bf['id']+'\x20status\x20from\x20'+_0x393bf[_0x459a15(0x148)]+'\x20to\x20'+_0x5a0128['status']),this[_0x459a15(0x143)](_0x393bf['id'],_0x393bf[_0x459a15(0x12e)],_0x393bf[_0x459a15(0x148)],_0x5a0128['status'],'status_check',{'paymentDetails':_0x5a0128[_0x459a15(0x17c)],'amount':_0x5a0128[_0x459a15(0x1d2)],'currency':_0x5a0128[_0x459a15(0xdf)],'shopId':_0x393bf[_0x459a15(0x1d3)],'checkTimestamp':new Date()['toISOString']()});const _0x2007cb={'status':_0x5a0128[_0x459a15(0x148)],'updatedAt':new Date()};if(_0x5a0128[_0x459a15(0x148)]===_0x459a15(0x1a5)&&_0x393bf[_0x459a15(0x148)]!=='PAID'){_0x2007cb[_0x459a15(0x109)]=new Date();if(!_0x393bf['amountUSDT']){const _0x260d4f=await currencyService_1[_0x459a15(0xf0)][_0x459a15(0x1be)](_0x393bf[_0x459a15(0x1d2)],_0x393bf[_0x459a15(0xdf)]);_0x2007cb[_0x459a15(0x10d)]=_0x260d4f;const _0x42c14e=await this[_0x459a15(0x13e)](_0x393bf[_0x459a15(0x1d3)],_0x393bf[_0x459a15(0x156)]),_0x301539=_0x260d4f*(0x1-_0x42c14e/0x64);_0x2007cb[_0x459a15(0xf2)]=_0x301539,_0x2007cb[_0x459a15(0x13c)]=_0x42c14e,console['log'](_0x459a15(0x12c)+_0x393bf['id']+_0x459a15(0x17b)),console['log'](_0x459a15(0xec)+_0x393bf[_0x459a15(0x1d2)]+'\x20'+_0x393bf['currency']+_0x459a15(0xf5)+_0x260d4f[_0x459a15(0x1c8)](0x6)+_0x459a15(0xd5)),console[_0x459a15(0x132)](_0x459a15(0x14d)+_0x393bf[_0x459a15(0x156)]+_0x459a15(0x1bf)+_0x42c14e+'%'),console[_0x459a15(0x132)](_0x459a15(0x10b)+_0x301539['toFixed'](0x6)+'\x20USDT');}console[_0x459a15(0x132)](_0x459a15(0x12c)+_0x393bf['id']+_0x459a15(0x102)+_0x2007cb['paidAt']['toISOString']());}if(_0x5a0128[_0x459a15(0x17c)]){const _0x20892f=_0x5a0128[_0x459a15(0x17c)];_0x20892f[_0x459a15(0x15e)]&&(_0x2007cb[_0x459a15(0xd8)]=_0x20892f[_0x459a15(0x15e)],console[_0x459a15(0x132)](_0x459a15(0xe5)+_0x20892f['iban'])),_0x20892f[_0x459a15(0x1b8)]&&console[_0x459a15(0x132)]('🏦\x20[CHECK]\x20Bank\x20details\x20provided:\x20'+_0x20892f['bankDetails']),_0x20892f[_0x459a15(0xdc)]&&console[_0x459a15(0x132)](_0x459a15(0x120)+_0x20892f['transactionId']),_0x20892f[_0x459a15(0x128)]&&console[_0x459a15(0x132)](_0x459a15(0x160)+_0x20892f[_0x459a15(0x128)]);}await database_1[_0x459a15(0x10f)][_0x459a15(0x1b0)][_0x459a15(0x11a)]({'where':{'id':_0x393bf['id']},'data':_0x2007cb});if(_0x5a0128['status']===_0x459a15(0x1a5)&&_0x393bf[_0x459a15(0x148)]!==_0x459a15(0x1a5)){console[_0x459a15(0x132)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x393bf['id']+_0x459a15(0x106));const _0x42895c=await database_1[_0x459a15(0x10f)]['payment']['findUnique']({'where':{'id':_0x393bf['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x42895c?.['paymentLinkId']&&_0x42895c[_0x459a15(0x144)])try{const _0xf5fd54=_0x42895c['paymentLink'];console[_0x459a15(0x132)](_0x459a15(0x19c)+_0xf5fd54['id']+_0x459a15(0x17e)+_0xf5fd54['type']+_0x459a15(0xe1)+_0xf5fd54[_0x459a15(0x12a)]+',\x20status='+_0xf5fd54[_0x459a15(0x148)]);const _0x29d2fb=_0xf5fd54['currentPayments']+0x1,_0x358bec=_0xf5fd54[_0x459a15(0xe8)]===_0x459a15(0xe2)?_0x459a15(0x182):_0xf5fd54['status'];await database_1['default'][_0x459a15(0x144)][_0x459a15(0x11a)]({'where':{'id':_0xf5fd54['id']},'data':{'currentPayments':_0x29d2fb,'status':_0x358bec,'updatedAt':new Date()}}),console['log']('✅\x20[COINTOPAY]\x20Payment\x20link\x20'+_0xf5fd54['id']+_0x459a15(0x197)+_0xf5fd54[_0x459a15(0x12a)]+_0x459a15(0xf5)+_0x29d2fb+_0x459a15(0x1cf)+_0xf5fd54[_0x459a15(0x148)]+_0x459a15(0xf5)+_0x358bec);}catch(_0x17dbcd){console[_0x459a15(0x135)](_0x459a15(0x14c),_0x17dbcd);}else console[_0x459a15(0x132)](_0x459a15(0x1c4)+_0x393bf['id']+_0x459a15(0x101));}await database_1[_0x459a15(0x10f)][_0x459a15(0x159)][_0x459a15(0x133)]({'data':{'paymentId':_0x393bf['id'],'shopId':_0x393bf['shopId'],'event':_0x459a15(0x149)+_0x5a0128[_0x459a15(0x148)][_0x459a15(0x1bb)](),'statusCode':0xc8,'responseBody':JSON[_0x459a15(0x14f)]({'oldStatus':_0x393bf[_0x459a15(0x148)],'newStatus':_0x5a0128[_0x459a15(0x148)],'paymentDetails':_0x5a0128[_0x459a15(0x17c)],'checkedAt':new Date()[_0x459a15(0x105)]()})}}),await this[_0x459a15(0x165)](_0x393bf,_0x5a0128[_0x459a15(0x148)]),await this[_0x459a15(0x17f)](_0x393bf,_0x5a0128[_0x459a15(0x148)]),_0x5a0128['status']!==_0x459a15(0x187)&&(console[_0x459a15(0x132)](_0x459a15(0x13d)+_0x393bf['id']+_0x459a15(0x167)+_0x5a0128['status']+',\x20clearing\x20individual\x20timers'),this[_0x459a15(0x161)](_0x393bf['id'])),console[_0x459a15(0x132)](_0x459a15(0xda)+_0x393bf['id']+_0x459a15(0x162));}else console[_0x459a15(0x132)](_0x459a15(0x124)+_0x393bf['id']+'\x20status\x20unchanged\x20('+_0x5a0128[_0x459a15(0x148)]+')'),this[_0x459a15(0x143)](_0x393bf['id'],_0x393bf[_0x459a15(0x12e)],_0x393bf['status'],_0x5a0128[_0x459a15(0x148)],_0x459a15(0x107),{'statusUnchanged':!![],'paymentDetails':_0x5a0128['paymentDetails'],'amount':_0x5a0128[_0x459a15(0x1d2)],'currency':_0x5a0128[_0x459a15(0xdf)],'shopId':_0x393bf[_0x459a15(0x1d3)],'checkTimestamp':new Date()[_0x459a15(0x105)]()});}catch(_0x59b8ea){console[_0x459a15(0x135)](_0x459a15(0x122)+_0x393bf['id']+':',_0x59b8ea),this[_0x459a15(0x139)](_0x393bf['id'],_0x393bf['gatewayPaymentId'],_0x59b8ea,_0x459a15(0x107),{'paymentAmount':_0x393bf['amount'],'paymentCurrency':_0x393bf[_0x459a15(0xdf)],'shopId':_0x393bf[_0x459a15(0x1d3)],'createdAt':_0x393bf[_0x459a15(0x1bd)]}),await database_1['default'][_0x459a15(0x159)][_0x459a15(0x133)]({'data':{'paymentId':_0x393bf['id'],'shopId':_0x393bf[_0x459a15(0x1d3)],'event':_0x459a15(0x126),'statusCode':0x1f4,'responseBody':JSON[_0x459a15(0x14f)]({'error':_0x59b8ea instanceof Error?_0x59b8ea[_0x459a15(0x1a1)]:_0x459a15(0x17d),'gatewayPaymentId':_0x393bf[_0x459a15(0x12e)],'checkedAt':new Date()[_0x459a15(0x105)]()})}});}}async[a42_0x126e92(0x165)](_0x564da8,_0x1b69d2){const _0x386aa5=a42_0x126e92,_0x259313=Date['now']();try{const _0x2bc524=_0x564da8['shop'],_0x3e85e0=_0x2bc524[_0x386aa5(0x13b)];if(!_0x3e85e0?.[_0x386aa5(0x111)]){console['log']('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x2bc524['id']);return;}const _0x3ced8b=_0x1b69d2===_0x386aa5(0x1a5)?_0x386aa5(0xfe):_0x1b69d2==='FAILED'?_0x386aa5(0x1a9):_0x1b69d2===_0x386aa5(0xeb)?_0x386aa5(0x1a9):'payment.pending';if(!_0x3e85e0[_0x386aa5(0x191)]?.[_0x386aa5(0x1ad)](_0x3ced8b)){console[_0x386aa5(0x132)]('Webhook\x20event\x20'+_0x3ced8b+_0x386aa5(0x1a3)+_0x2bc524['id']);return;}const _0x59dc98=(0x0,gateway_1['getGatewayIdByName'])(_0x564da8['gateway'])||_0x564da8[_0x386aa5(0x156)],_0x539f4c={'event':_0x3ced8b,'payment':{'id':_0x564da8['id'],'order_id':_0x564da8[_0x386aa5(0x1a4)],'gateway_order_id':_0x564da8[_0x386aa5(0xd6)],'gateway':_0x59dc98,'amount':_0x564da8['amount'],'currency':_0x564da8['currency'],'status':_0x1b69d2['toLowerCase'](),'customer_email':_0x564da8[_0x386aa5(0x178)],'customer_name':_0x564da8[_0x386aa5(0x192)],'created_at':_0x564da8['createdAt'],'updated_at':new Date()}},_0x4f54e6=await fetch(_0x3e85e0[_0x386aa5(0x111)],{'method':_0x386aa5(0x1ab),'headers':{'Content-Type':'application/json','User-Agent':_0x386aa5(0x16d)},'body':JSON['stringify'](_0x539f4c)}),_0x213827=Date[_0x386aa5(0x118)]()-_0x259313,_0x8993a0=_0x4f54e6['ok']?_0x386aa5(0x1dc):await _0x4f54e6[_0x386aa5(0x150)]();loggerService_1[_0x386aa5(0x125)][_0x386aa5(0x1c0)](_0x564da8['shopId'],_0x3e85e0[_0x386aa5(0x111)],_0x3ced8b,_0x4f54e6[_0x386aa5(0x148)],_0x213827,_0x539f4c),console['log'](_0x386aa5(0x16f)+_0x3e85e0['webhookUrl']+'\x20with\x20status\x20'+_0x4f54e6['status']+'\x20('+_0x213827+_0x386aa5(0xff));}catch(_0x2b78c4){console[_0x386aa5(0x135)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x2b78c4),loggerService_1[_0x386aa5(0x125)][_0x386aa5(0x181)](_0x564da8[_0x386aa5(0x1d3)],_0x564da8[_0x386aa5(0x190)]?.[_0x386aa5(0x13b)]?.['webhookUrl']||_0x386aa5(0x171),_0x386aa5(0x193),_0x2b78c4,{});}}async[a42_0x126e92(0x17f)](_0x875526,_0x84316d){const _0x2ff0db=a42_0x126e92;try{const _0x1dabdd={'PENDING':_0x2ff0db(0x15a),'PAID':_0x2ff0db(0x1b6),'FAILED':'failed','EXPIRED':_0x2ff0db(0x1c1)},_0x5db514=_0x1dabdd[_0x84316d];if(!_0x5db514||_0x5db514===_0x2ff0db(0x15a))return;await telegramBotService_1[_0x2ff0db(0x12b)]['sendPaymentNotification'](_0x875526['shopId'],_0x875526,_0x5db514);}catch(_0x4076da){console[_0x2ff0db(0x135)](_0x2ff0db(0x10e),_0x4076da);}}async['checkPaymentById'](_0x55552e){const _0x3c3d20=a42_0x126e92;console[_0x3c3d20(0x132)](_0x3c3d20(0x108)+_0x55552e);const _0x41bafe=await database_1[_0x3c3d20(0x10f)]['payment'][_0x3c3d20(0x1c7)]({'where':{'id':_0x55552e},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x41bafe)throw new Error('Payment\x20not\x20found');if(_0x41bafe['gateway']!==_0x3c3d20(0x137)&&_0x41bafe[_0x3c3d20(0x156)]!==_0x3c3d20(0x152))throw new Error(_0x3c3d20(0x194));console[_0x3c3d20(0x132)](_0x3c3d20(0x145)+_0x41bafe['gateway']+_0x3c3d20(0x1bc)+_0x55552e),await this[_0x3c3d20(0xf3)](_0x41bafe),console['log']('✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x55552e);}[a42_0x126e92(0x163)](){const _0x5d3ec9=a42_0x126e92,_0x11197d=this[_0x5d3ec9(0x140)]?this[_0x5d3ec9(0x147)]:undefined,_0x354ecb=Array[_0x5d3ec9(0x115)](this[_0x5d3ec9(0x18e)]['values']())[_0x5d3ec9(0x18c)](_0x3bcf81=>({'paymentId':_0x3bcf81[_0x5d3ec9(0x19b)],'gatewayPaymentId':_0x3bcf81['gatewayPaymentId'],'createdAt':_0x3bcf81[_0x5d3ec9(0x1bd)],'timersCount':_0x3bcf81['timers'][_0x5d3ec9(0x1ba)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x5d3ec9(0x147)]/(0x3e8*0x3c),'expiryDays':this[_0x5d3ec9(0x1b7)],'activeIndividualTimers':this[_0x5d3ec9(0x18e)][_0x5d3ec9(0x14e)],'nextGlobalCheckIn':_0x11197d,'paymentTimersDetails':_0x354ecb};}['getPaymentTimerInfo'](_0x5da368){const _0x399b35=a42_0x126e92,_0x238722=this['paymentTimers'][_0x399b35(0x11c)](_0x5da368);if(_0x238722)return{'hasTimers':!![],'timersCount':_0x238722['timers'][_0x399b35(0x1ba)],'createdAt':_0x238722[_0x399b35(0x1bd)],'gatewayPaymentId':_0x238722['gatewayPaymentId']};return{'hasTimers':![]};}async[a42_0x126e92(0x13e)](_0x26ef54,_0x284229){const _0x31a9a4=a42_0x126e92;try{const _0x4b4bd7=await database_1['default'][_0x31a9a4(0x190)][_0x31a9a4(0x1c7)]({'where':{'id':_0x26ef54},'select':{'gatewaySettings':!![]}});if(!_0x4b4bd7?.['gatewaySettings'])return console[_0x31a9a4(0x132)]('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0x26ef54+_0x31a9a4(0xfb)),0xa;const _0xea468a=JSON[_0x31a9a4(0xef)](_0x4b4bd7[_0x31a9a4(0x112)]);for(const [_0xfeaa41,_0x4a774a]of Object[_0x31a9a4(0x10c)](_0xea468a)){if(_0xfeaa41[_0x31a9a4(0x1bb)]()===_0x284229[_0x31a9a4(0x1bb)]()){const _0x326db2=_0x4a774a[_0x31a9a4(0x121)]||0xa;return console[_0x31a9a4(0x132)]('Gateway\x20'+_0x284229+'\x20commission\x20for\x20shop\x20'+_0x26ef54+':\x20'+_0x326db2+'%'),_0x326db2;}}return console[_0x31a9a4(0x132)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x284229+'\x20in\x20shop\x20'+_0x26ef54+_0x31a9a4(0x1da)),0xa;}catch(_0x37b579){return console[_0x31a9a4(0x135)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x26ef54+_0x31a9a4(0x1d1)+_0x284229+':',_0x37b579),0xa;}}}exports[a42_0x126e92(0x10a)]=CoinToPayStatusService,exports[a42_0x126e92(0x1b5)]=new CoinToPayStatusService();