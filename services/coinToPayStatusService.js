'use strict';const a48_0x2ae551=a48_0x3a5e;(function(_0x30adc0,_0x39d37a){const _0x56b4aa=a48_0x3a5e,_0x73452e=_0x30adc0();while(!![]){try{const _0x564b89=parseInt(_0x56b4aa(0x204))/0x1+-parseInt(_0x56b4aa(0x213))/0x2*(parseInt(_0x56b4aa(0x1aa))/0x3)+-parseInt(_0x56b4aa(0x139))/0x4+-parseInt(_0x56b4aa(0x1ae))/0x5+-parseInt(_0x56b4aa(0x23e))/0x6+-parseInt(_0x56b4aa(0x163))/0x7+parseInt(_0x56b4aa(0x1e5))/0x8;if(_0x564b89===_0x39d37a)break;else _0x73452e['push'](_0x73452e['shift']());}catch(_0x2265ac){_0x73452e['push'](_0x73452e['shift']());}}}(a48_0x42b5,0x7ece8));function a48_0x42b5(){const _0x379230=['\x20\x20\x20-\x20GatewayPaymentId:\x20','createdOn','\x20is\x20older\x20than\x20','sendShopWebhook','\x20completed\x20for\x20payment\x20','__importDefault','type','üõë\x20[SHUTDOWN]\x20Cleared\x20','customerName','gatewaySettings','create','ü™ô\x20[DEBUG]\x20Creating\x20','globalCheckInterval','timestamp','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20expired','commission','Unknown\x20error','now','currentPayments','\x20\x20\x20üìù\x20Context:','error','logCoinToPayError','\x20status\x20from\x20','POST','\x20skipped,\x20','checkPaymentStatus','\x20\x20\x20üìç\x20Source:\x20','length','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20checked,\x20','\x20initial\x20timers\x20for\x20payment\x20','push','logCoinToPayStatus','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','not\x20found','\x20is\x20too\x20new\x20(','\x20has\x20no\x20gatewayPaymentId','\x20\x20\x20-\x20Amount:\x20','settings','2\x20minutes','EXPIRED','paymentLinkId','webhookUrl','./currencyService','checkSinglePaymentById','iban','transactionId','\x20\x20\x20-\x20ShopId:\x20','bankDetails','sendPaymentStatusNotification','\x20with\x20status\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','orderId','./gateways/coinToPayService','getGatewayIdByName','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','startPeriodicStatusCheck',',\x20clearing\x20individual\x20timers','toISOString','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','3eEPZUF','COINTOPAY_ERROR','paidAt','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','229710taLEvt','expired','\x20details:','payment.success','5\x20minutes','\x20updated:\x20currentPayments=','\x20->\x20','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','-day\x20timeout','\x20\x20\x20-\x20paymentId:\x20',',\x20currentPayments=','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20not\x20enabled\x20for\x20shop\x20',':\x20type=','__esModule','\x20days','sendPaymentNotification','gatewayCommissionRate','checkSinglePayment','üßπ\x20[DEBUG]\x20Clearing\x20','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20',',\x20stopping\x20individual\x20checks','\x20\x20\x20üìù\x20Details:','gatewayOrderId','\x20to\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','Failed\x20to\x20send\x20shop\x20webhook:','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','log','SINGLE','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','üìä\x20[CHECK]\x20Payment\x20','update','webhook_send','includes','‚úÖ\x20[HOURLY]\x20Payment\x20','description','schedulePaymentChecks','\x20USDT','\x20triggered\x20for\x20payment\x20','üìà\x20[COINTOPAY]\x20Payment\x20','gateway','checkAllPendingPayments','Success','logShopWebhookError','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','\x20\x20\x20Gateway\x20','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20payment\x20','default','coinToPayService','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','checkExpiredPayments','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','8555784aIoenb','getDate','‚úÖ\x20[EXPIRY]\x20Payment\x20','PENDING','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','getGatewayCommission','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','\x20individual\x20payment\x20timers','telegramBotService','\x20(age:\x20','.\x20Remaining\x20active\x20timers:\x20','\x20timers\x20for\x20payment\x20','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','\x20expired\x20CoinToPay\x20payments','\x20has\x20no\x20gatewayPaymentId,\x20skipping','webhookEvents','üßπ\x20[CHECK]\x20Payment\x20','paymentLink','message','confirmedOn','toFixed','status_check','\x20status\x20is\x20','‚úÖ\x20[CHECK]\x20Payment\x20','üìä\x20[HOURLY]\x20Payment\x20','toLowerCase','status','shop','payment.failed','delay','‚è∞\x20[EXPIRY]\x20Payment\x20','180969ItkBkA','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','getPaymentTimerInfo','remitterIban','not\x20confirmed','defineProperty','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20pending\x20CoinToPay\x20payments','customerEmail','\x20in\x20shop\x20','Gateway\x20','shopId','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','cointopay','\x20seconds\x20(','76886msqhgY','getTime','‚ùå\x20[HOURLY]\x20Payment\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','Payment\x20older\x20than\x20','cointopay_status_check_','has',',\x20using\x20default\x2010%','\x20days\x20(created\x20before\x20','createdAt','loggerService','amount','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','stack','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','PAID','set','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','size','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','amountUSDT','Payment\x20System/1.0','paymentDetails','CoinToPayStatusService','stringify',',\x20gateway\x20','convertToUSDT','\x20amounts\x20calculated:','\x20to\x20clear','payment','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','entries','../types/gateway','floor','coinToPayStatusService','‚ùå\x20[CHECK]\x20Payment\x20','\x20updated\x20successfully','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','auto_expire','77640KdtVpX','üí∞\x20[CHECK]\x20Payment\x20','gatewayPaymentId','amountAfterGatewayCommissionUSDT','\x20(after\x20','logWhiteDomainError','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','application/json','currency',',\x20status=','unknown','text','paymentTimers','CoinToPay2Service','timers','1018396aIAAqL','\x20\x20\x20-\x20Gateway:\x20','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','Payment\x20not\x20found','\x20is\x20valid\x20for\x20checking,\x20proceeding...','stopPeriodicStatusCheck','created','paymentId','parse','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','\x20in\x20','Shop\x20webhook\x20sent\x20to\x20','\x20status\x20changed\x20to\x20','clearPaymentTimers','\x20for\x20payment\x20','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','\x20\x20\x20üìÖ\x20Time:\x20','EXPIRY_DAYS','GLOBAL_CHECK_INTERVAL_MS','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','\x20status:\x20','Webhook\x20event\x20','\x20status\x20unchanged\x20(','COINTOPAY_STATUS_CHANGE','forEach','findMany','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','webhookLog','\x20not\x20found,\x20clearing\x20timers','delete','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','payment.pending','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','schedule_created','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','\x20commission\x20for\x20shop\x20','cointopay2','logShopWebhookSent','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20',',\x20using\x20default\x20commission\x2010%','2653826uKgjza','findUnique','get','./loggerService','coinToPay2Service'];a48_0x42b5=function(){return _0x379230;};return a48_0x42b5();}var __importDefault=this&&this[a48_0x2ae551(0x16d)]||function(_0x2c67e7){return _0x2c67e7&&_0x2c67e7['__esModule']?_0x2c67e7:{'default':_0x2c67e7};};Object[a48_0x2ae551(0x209)](exports,a48_0x2ae551(0x1bc),{'value':!![]}),exports['coinToPayStatusService']=exports[a48_0x2ae551(0x22d)]=void 0x0;const coinToPayService_1=require(a48_0x2ae551(0x19e)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a48_0x2ae551(0x236)),database_1=__importDefault(require('../config/database')),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a48_0x2ae551(0x166)),currencyService_1=require(a48_0x2ae551(0x194));function a48_0x3a5e(_0xc64102,_0x4e0dd7){_0xc64102=_0xc64102-0x132;const _0x42b5a3=a48_0x42b5();let _0x3a5eda=_0x42b5a3[_0xc64102];return _0x3a5eda;}class CoinToPayStatusService{constructor(){const _0x1396e8=a48_0x2ae551;this[_0x1396e8(0x174)]=null,this[_0x1396e8(0x14b)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x1396e8(0x136)]=new Map(),this['coinToPayService']=new coinToPayService_1['CoinToPayService'](),this[_0x1396e8(0x167)]=new coinToPay2Service_1[(_0x1396e8(0x137))](),console[_0x1396e8(0x1cb)](_0x1396e8(0x229));}[a48_0x2ae551(0x1d4)](_0x2d72b5,_0x14cd2d){const _0x1ef734=a48_0x2ae551;console[_0x1ef734(0x1cb)]('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x1ef734(0x1cb)](_0x1ef734(0x1b7)+_0x2d72b5),console[_0x1ef734(0x1cb)]('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x14cd2d),this[_0x1ef734(0x146)](_0x2d72b5);const _0x2f7d55=[],_0x212786=new Date(),_0x1afbbf=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x1ef734(0x190)},{'delay':0x5*0x3c*0x3e8,'description':_0x1ef734(0x1b2)},{'delay':0x5*0x3c*0x3e8,'description':_0x1ef734(0x1b2)}];console[_0x1ef734(0x1cb)](_0x1ef734(0x173)+_0x1afbbf['length']+_0x1ef734(0x187)+_0x2d72b5);let _0x95889e=0x0;_0x1afbbf[_0x1ef734(0x152)]((_0x2bd1f8,_0x5b1652)=>{const _0x140262=_0x1ef734;_0x95889e+=_0x2bd1f8[_0x140262(0x202)];const _0x1b89c7=setTimeout(async()=>{const _0x554b07=_0x140262;console[_0x554b07(0x1cb)](_0x554b07(0x1eb)+(_0x5b1652+0x1)+_0x554b07(0x1d6)+_0x2d72b5+_0x554b07(0x242)+_0x2bd1f8[_0x554b07(0x1d3)]+')');try{await this[_0x554b07(0x195)](_0x2d72b5),console[_0x554b07(0x1cb)](_0x554b07(0x1a7)+(_0x5b1652+0x1)+_0x554b07(0x16c)+_0x2d72b5);}catch(_0x543c5a){console[_0x554b07(0x17d)](_0x554b07(0x176)+(_0x5b1652+0x1)+'\x20for\x20payment\x20'+_0x2d72b5+':',_0x543c5a),this['logCoinToPayError'](_0x2d72b5,_0x14cd2d,_0x543c5a,_0x554b07(0x1fa),{'checkNumber':_0x5b1652+0x1,'scheduledAfter':_0x2bd1f8[_0x554b07(0x1d3)],'isIndividualCheck':!![]});}},_0x95889e);_0x2f7d55[_0x140262(0x188)](_0x1b89c7),console['log'](_0x140262(0x225)+(_0x5b1652+0x1)+'\x20for\x20payment\x20'+_0x2d72b5+_0x140262(0x143)+_0x95889e/0x3e8+_0x140262(0x212)+_0x2bd1f8[_0x140262(0x1d3)]+')');});const _0x4d9799=setInterval(async()=>{const _0x4627a3=_0x1ef734;console[_0x4627a3(0x1cb)](_0x4627a3(0x1c2)+_0x2d72b5);try{const _0x5ab864=await database_1[_0x4627a3(0x1e0)]['payment'][_0x4627a3(0x164)]({'where':{'id':_0x2d72b5},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x5ab864){console[_0x4627a3(0x1cb)](_0x4627a3(0x215)+_0x2d72b5+_0x4627a3(0x157)),this[_0x4627a3(0x146)](_0x2d72b5);return;}console[_0x4627a3(0x1cb)](_0x4627a3(0x1fd)+_0x2d72b5+'\x20current\x20status:\x20'+_0x5ab864[_0x4627a3(0x1ff)]);if(_0x5ab864['status']!==_0x4627a3(0x1e8)){console[_0x4627a3(0x1cb)](_0x4627a3(0x1d2)+_0x2d72b5+'\x20status\x20is\x20'+_0x5ab864[_0x4627a3(0x1ff)]+_0x4627a3(0x1c3)),this[_0x4627a3(0x146)](_0x2d72b5);return;}const _0x5e782e=Math[_0x4627a3(0x237)]((Date['now']()-_0x5ab864[_0x4627a3(0x21c)][_0x4627a3(0x214)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x5e782e>=this[_0x4627a3(0x14a)]){console[_0x4627a3(0x1cb)]('‚è∞\x20[HOURLY]\x20Payment\x20'+_0x2d72b5+_0x4627a3(0x16a)+this[_0x4627a3(0x14a)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x4627a3(0x146)](_0x2d72b5);return;}await this[_0x4627a3(0x195)](_0x2d72b5),console[_0x4627a3(0x1cb)](_0x4627a3(0x220)+_0x2d72b5);}catch(_0x4c6fe8){console[_0x4627a3(0x17d)](_0x4627a3(0x234)+_0x2d72b5+':',_0x4c6fe8),this['logCoinToPayError'](_0x2d72b5,_0x14cd2d,_0x4c6fe8,_0x4627a3(0x1fa),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x2f7d55['push'](_0x4d9799),this['paymentTimers'][_0x1ef734(0x224)](_0x2d72b5,{'timers':_0x2f7d55,'paymentId':_0x2d72b5,'gatewayPaymentId':_0x14cd2d,'createdAt':_0x212786}),console['log'](_0x1ef734(0x210)+_0x1afbbf[_0x1ef734(0x184)]+_0x1ef734(0x205)+_0x2d72b5),console['log'](_0x1ef734(0x1e4)+this[_0x1ef734(0x136)][_0x1ef734(0x227)]),this[_0x1ef734(0x189)](_0x2d72b5,_0x14cd2d,_0x1ef734(0x1e8),_0x1ef734(0x1e8),_0x1ef734(0x1fa),{'action':_0x1ef734(0x15c),'scheduledChecks':_0x1afbbf[_0x1ef734(0x184)],'firstCheckIn':_0x1afbbf[0x0]['delay']/0x3e8,'totalTimers':this[_0x1ef734(0x136)][_0x1ef734(0x227)]});}[a48_0x2ae551(0x146)](_0x1b013f){const _0x2de982=a48_0x2ae551,_0x1bb4ce=this[_0x2de982(0x136)][_0x2de982(0x165)](_0x1b013f);_0x1bb4ce?(console[_0x2de982(0x1cb)](_0x2de982(0x1c1)+_0x1bb4ce['timers'][_0x2de982(0x184)]+_0x2de982(0x1f0)+_0x1b013f),_0x1bb4ce[_0x2de982(0x138)][_0x2de982(0x152)]((_0x18a900,_0x6ab071)=>{const _0x224b26=_0x2de982;_0x18a900&&(clearTimeout(_0x18a900),clearInterval(_0x18a900),console['log']('üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x6ab071+0x1)+_0x224b26(0x147)+_0x1b013f));}),this['paymentTimers'][_0x2de982(0x158)](_0x1b013f),console[_0x2de982(0x1cb)](_0x2de982(0x1b5)+_0x1b013f+_0x2de982(0x1ef)+this[_0x2de982(0x136)][_0x2de982(0x227)])):console[_0x2de982(0x1cb)](_0x2de982(0x1b9)+_0x1b013f+_0x2de982(0x232));}async['checkSinglePaymentById'](_0x250982){const _0x438e18=a48_0x2ae551;console[_0x438e18(0x1cb)](_0x438e18(0x1a4)+_0x250982);const _0x4e364e=await database_1[_0x438e18(0x1e0)][_0x438e18(0x233)]['findUnique']({'where':{'id':_0x250982},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4e364e){console[_0x438e18(0x1cb)](_0x438e18(0x239)+_0x250982+'\x20not\x20found\x20in\x20database');return;}console[_0x438e18(0x1cb)](_0x438e18(0x1ce)+_0x250982+'\x20found:'),console[_0x438e18(0x1cb)](_0x438e18(0x13a)+_0x4e364e[_0x438e18(0x1d8)]),console['log']('\x20\x20\x20-\x20Status:\x20'+_0x4e364e[_0x438e18(0x1ff)]),console[_0x438e18(0x1cb)](_0x438e18(0x168)+_0x4e364e[_0x438e18(0x240)]),console[_0x438e18(0x1cb)](_0x438e18(0x18e)+_0x4e364e['amount']+'\x20'+_0x4e364e[_0x438e18(0x132)]),console[_0x438e18(0x1cb)](_0x438e18(0x198)+_0x4e364e[_0x438e18(0x20f)]);if(_0x4e364e[_0x438e18(0x1d8)]!==_0x438e18(0x211)&&_0x4e364e[_0x438e18(0x1d8)]!==_0x438e18(0x15f)){console[_0x438e18(0x1cb)](_0x438e18(0x142)+_0x250982+_0x438e18(0x1ca)+_0x4e364e['gateway']+')');return;}if(_0x4e364e[_0x438e18(0x1ff)]!==_0x438e18(0x1e8)){console[_0x438e18(0x1cb)](_0x438e18(0x142)+_0x250982+_0x438e18(0x1fb)+_0x4e364e[_0x438e18(0x1ff)]+_0x438e18(0x1c3)),this[_0x438e18(0x146)](_0x250982);return;}if(!_0x4e364e[_0x438e18(0x240)]){console[_0x438e18(0x1cb)](_0x438e18(0x142)+_0x250982+_0x438e18(0x18d));return;}console[_0x438e18(0x1cb)](_0x438e18(0x1fc)+_0x250982+_0x438e18(0x13d)),await this[_0x438e18(0x1c0)](_0x4e364e);}['logCoinToPayStatus'](_0x318b7c,_0x40657c,_0x3bfec2,_0x5621df,_0x16686a,_0x3dc4a9){const _0x41d149=a48_0x2ae551,_0x44dd0f={'type':_0x41d149(0x151),'paymentId':_0x318b7c,'gatewayPaymentId':_0x40657c,'oldStatus':_0x3bfec2,'newStatus':_0x5621df,'source':_0x16686a,'timestamp':new Date()['toISOString'](),'details':_0x3dc4a9||{}};loggerService_1[_0x41d149(0x21d)][_0x41d149(0x189)](_0x44dd0f),console[_0x41d149(0x1cb)](_0x41d149(0x159)+_0x318b7c+'\x20('+_0x40657c+')'),console[_0x41d149(0x1cb)]('\x20\x20\x20üìä\x20Status:\x20'+_0x3bfec2+_0x41d149(0x1b4)+_0x5621df),console[_0x41d149(0x1cb)](_0x41d149(0x183)+_0x16686a),console[_0x41d149(0x1cb)](_0x41d149(0x149)+_0x44dd0f[_0x41d149(0x175)]),_0x3dc4a9&&console['log'](_0x41d149(0x1c4),_0x3dc4a9);}['logCoinToPayError'](_0x58ebac,_0x2a654b,_0x17c5d3,_0x4a2a32,_0x3dfd02){const _0x52a8c3=a48_0x2ae551,_0x5cac56={'type':_0x52a8c3(0x1ab),'paymentId':_0x58ebac,'gatewayPaymentId':_0x2a654b,'error':_0x17c5d3 instanceof Error?{'message':_0x17c5d3[_0x52a8c3(0x1f7)],'stack':_0x17c5d3[_0x52a8c3(0x221)]}:_0x17c5d3,'source':_0x4a2a32,'timestamp':new Date()[_0x52a8c3(0x1a3)](),'context':_0x3dfd02||{}};loggerService_1[_0x52a8c3(0x21d)][_0x52a8c3(0x17e)](_0x5cac56),console[_0x52a8c3(0x17d)](_0x52a8c3(0x161)+_0x58ebac+'\x20('+_0x2a654b+')'),console[_0x52a8c3(0x17d)]('\x20\x20\x20‚ùå\x20Error:\x20'+(_0x17c5d3 instanceof Error?_0x17c5d3[_0x52a8c3(0x1f7)]:_0x17c5d3)),console['error'](_0x52a8c3(0x183)+_0x4a2a32),console[_0x52a8c3(0x17d)](_0x52a8c3(0x149)+_0x5cac56[_0x52a8c3(0x175)]),_0x3dfd02&&console[_0x52a8c3(0x17d)](_0x52a8c3(0x17c),_0x3dfd02);}[a48_0x2ae551(0x1a1)](){const _0x543054=a48_0x2ae551;console['log'](_0x543054(0x222)),this[_0x543054(0x1d9)]()['catch'](_0x2b7c3d=>{const _0x4dd59e=_0x543054;console['error'](_0x4dd59e(0x15d),_0x2b7c3d);}),this[_0x543054(0x174)]=setInterval(async()=>{const _0x3c5089=_0x543054;try{console[_0x3c5089(0x1cb)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x3c5089(0x1d9)](),console['log'](_0x3c5089(0x1ad));}catch(_0x4d2aa0){console[_0x3c5089(0x17d)]('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x4d2aa0);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x543054(0x1cb)](_0x543054(0x20a));}[a48_0x2ae551(0x13e)](){const _0x3eca72=a48_0x2ae551;console[_0x3eca72(0x1cb)](_0x3eca72(0x23c));this[_0x3eca72(0x174)]&&(clearInterval(this[_0x3eca72(0x174)]),this['globalCheckInterval']=null,console[_0x3eca72(0x1cb)]('üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x34eb43=this['paymentTimers'][_0x3eca72(0x227)];for(const [_0x4b9857]of this[_0x3eca72(0x136)]){this[_0x3eca72(0x146)](_0x4b9857);}console[_0x3eca72(0x1cb)](_0x3eca72(0x16f)+_0x34eb43+_0x3eca72(0x1ec));}async[a48_0x2ae551(0x1d9)](){const _0x4e0f11=a48_0x2ae551;try{console['log'](_0x4e0f11(0x1de));const _0x4793f2=await database_1['default'][_0x4e0f11(0x233)][_0x4e0f11(0x153)]({'where':{'gateway':{'in':[_0x4e0f11(0x211),_0x4e0f11(0x15f)]},'status':_0x4e0f11(0x1e8),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x4e0f11(0x1cb)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x4793f2['length']+_0x4e0f11(0x20b));if(_0x4793f2[_0x4e0f11(0x184)]===0x0){console[_0x4e0f11(0x1cb)](_0x4e0f11(0x1cd));return;}const _0x12efa4=await this[_0x4e0f11(0x1e3)](_0x4793f2);console[_0x4e0f11(0x1cb)]('‚è∞\x20[GLOBAL]\x20Found\x20'+_0x12efa4[_0x4e0f11(0x184)]+_0x4e0f11(0x1f2));let _0x1c0f15=0x0,_0xb178c1=0x0;for(const _0x1ca8de of _0x4793f2){try{if(_0x12efa4[_0x4e0f11(0x1d1)](_0x1ca8de['id'])){console[_0x4e0f11(0x1cb)](_0x4e0f11(0x1a9)+_0x1ca8de['id']+_0x4e0f11(0x155)),_0xb178c1++;continue;}if(this['paymentTimers'][_0x4e0f11(0x219)](_0x1ca8de['id'])){console[_0x4e0f11(0x1cb)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x1ca8de['id']+_0x4e0f11(0x1a5)),_0xb178c1++;continue;}const _0x283e3f=(Date[_0x4e0f11(0x17a)]()-_0x1ca8de[_0x4e0f11(0x21c)][_0x4e0f11(0x214)]())/(0x3e8*0x3c*0x3c);if(_0x283e3f<0x1){console[_0x4e0f11(0x1cb)](_0x4e0f11(0x1a9)+_0x1ca8de['id']+_0x4e0f11(0x18c)+_0x283e3f['toFixed'](0x1)+'h),\x20skipping\x20global\x20check'),_0xb178c1++;continue;}console[_0x4e0f11(0x1cb)](_0x4e0f11(0x13b)+_0x1ca8de['id']+_0x4e0f11(0x1ee)+_0x283e3f['toFixed'](0x1)+'h)'),await this[_0x4e0f11(0x1c0)](_0x1ca8de),_0x1c0f15++,await new Promise(_0xcb72e0=>setTimeout(_0xcb72e0,0x7d0));}catch(_0x2fa894){console['error'](_0x4e0f11(0x23b)+_0x1ca8de['id']+':',_0x2fa894),this[_0x4e0f11(0x17e)](_0x1ca8de['id'],_0x1ca8de[_0x4e0f11(0x240)]||_0x4e0f11(0x134),_0x2fa894,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x1ca8de[_0x4e0f11(0x21e)],'paymentCurrency':_0x1ca8de[_0x4e0f11(0x132)],'shopId':_0x1ca8de['shopId'],'createdAt':_0x1ca8de[_0x4e0f11(0x21c)]}),loggerService_1[_0x4e0f11(0x21d)][_0x4e0f11(0x243)]('cointopay','/status/'+_0x1ca8de[_0x4e0f11(0x240)],_0x2fa894);}}console['log'](_0x4e0f11(0x1a0)+_0x1c0f15+_0x4e0f11(0x186)+_0xb178c1+_0x4e0f11(0x181)+_0x12efa4[_0x4e0f11(0x184)]+_0x4e0f11(0x177));}catch(_0x5d5416){console[_0x4e0f11(0x17d)](_0x4e0f11(0x18a),_0x5d5416);}}async[a48_0x2ae551(0x1e3)](_0x336e41){const _0x412df8=a48_0x2ae551,_0x1e6a84=[],_0x132ba6=new Date();_0x132ba6['setDate'](_0x132ba6[_0x412df8(0x1e6)]()-this['EXPIRY_DAYS']),console[_0x412df8(0x1cb)]('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x412df8(0x14a)]+_0x412df8(0x21b)+_0x132ba6[_0x412df8(0x1a3)]()+')');for(const _0x179556 of _0x336e41){if(_0x179556[_0x412df8(0x21c)]<_0x132ba6){console['log'](_0x412df8(0x203)+_0x179556['id']+'\x20is\x20older\x20than\x20'+this[_0x412df8(0x14a)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this['logCoinToPayStatus'](_0x179556['id'],_0x179556[_0x412df8(0x240)]||_0x412df8(0x134),_0x412df8(0x1e8),_0x412df8(0x191),_0x412df8(0x23d),{'reason':_0x412df8(0x217)+this[_0x412df8(0x14a)]+_0x412df8(0x1bd),'createdAt':_0x179556[_0x412df8(0x21c)],'daysSinceCreation':Math[_0x412df8(0x237)]((Date[_0x412df8(0x17a)]()-_0x179556['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x179556[_0x412df8(0x21e)],'paymentCurrency':_0x179556['currency'],'shopId':_0x179556[_0x412df8(0x20f)]}),await database_1[_0x412df8(0x1e0)][_0x412df8(0x233)][_0x412df8(0x1cf)]({'where':{'id':_0x179556['id']},'data':{'status':_0x412df8(0x191),'updatedAt':new Date()}}),await database_1[_0x412df8(0x1e0)]['webhookLog'][_0x412df8(0x172)]({'data':{'paymentId':_0x179556['id'],'shopId':_0x179556[_0x412df8(0x20f)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x412df8(0x217)+this[_0x412df8(0x14a)]+_0x412df8(0x1bd),'createdAt':_0x179556[_0x412df8(0x21c)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x412df8(0x237)]((Date[_0x412df8(0x17a)]()-_0x179556['createdAt'][_0x412df8(0x214)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x179556,_0x412df8(0x191)),await this[_0x412df8(0x19a)](_0x179556,_0x412df8(0x191)),this[_0x412df8(0x146)](_0x179556['id']),_0x1e6a84[_0x412df8(0x188)](_0x179556['id']),console['log'](_0x412df8(0x1e7)+_0x179556['id']+_0x412df8(0x216)+this[_0x412df8(0x14a)]+_0x412df8(0x1b6));}catch(_0x375daa){console['error'](_0x412df8(0x19c)+_0x179556['id']+':',_0x375daa),this['logCoinToPayError'](_0x179556['id'],_0x179556[_0x412df8(0x240)]||_0x412df8(0x134),_0x375daa,_0x412df8(0x23d),{'reason':_0x412df8(0x185),'createdAt':_0x179556[_0x412df8(0x21c)],'daysSinceCreation':Math[_0x412df8(0x237)]((Date[_0x412df8(0x17a)]()-_0x179556[_0x412df8(0x21c)][_0x412df8(0x214)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x1e6a84;}async['checkSinglePayment'](_0x14ff2d){const _0x336dc0=a48_0x2ae551;if(!_0x14ff2d['gatewayPaymentId']){console[_0x336dc0(0x1cb)](_0x336dc0(0x142)+_0x14ff2d['id']+_0x336dc0(0x1f3));return;}console[_0x336dc0(0x1cb)]('üîç\x20[CHECK]\x20Checking\x20'+_0x14ff2d['gateway']+_0x336dc0(0x1df)+_0x14ff2d['id']+'\x20('+_0x14ff2d[_0x336dc0(0x240)]+')');try{let _0x32f6a3;_0x14ff2d[_0x336dc0(0x1d8)]===_0x336dc0(0x15f)?(_0x32f6a3=await this[_0x336dc0(0x167)][_0x336dc0(0x182)](_0x14ff2d['gatewayPaymentId']),console[_0x336dc0(0x1cb)]('üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x14ff2d['id']+'\x20status:\x20'+_0x32f6a3[_0x336dc0(0x1ff)])):(_0x32f6a3=await this[_0x336dc0(0x1e1)]['checkPaymentStatus'](_0x14ff2d[_0x336dc0(0x240)]),console[_0x336dc0(0x1cb)](_0x336dc0(0x226)+_0x14ff2d['id']+_0x336dc0(0x14e)+_0x32f6a3[_0x336dc0(0x1ff)]));_0x32f6a3['paymentDetails']&&console[_0x336dc0(0x1cb)]('üìä\x20[CHECK]\x20Payment\x20'+_0x14ff2d['id']+_0x336dc0(0x1b0),{'iban':_0x32f6a3[_0x336dc0(0x22c)][_0x336dc0(0x196)]||_0x336dc0(0x18b),'transactionId':_0x32f6a3[_0x336dc0(0x22c)][_0x336dc0(0x197)],'createdOn':_0x32f6a3['paymentDetails'][_0x336dc0(0x169)],'confirmedOn':_0x32f6a3[_0x336dc0(0x22c)]['confirmedOn']||_0x336dc0(0x208)});if(_0x32f6a3[_0x336dc0(0x1ff)]!==_0x14ff2d[_0x336dc0(0x1ff)]){console[_0x336dc0(0x1cb)](_0x336dc0(0x15b)+_0x14ff2d['id']+_0x336dc0(0x17f)+_0x14ff2d['status']+_0x336dc0(0x1c6)+_0x32f6a3[_0x336dc0(0x1ff)]),this[_0x336dc0(0x189)](_0x14ff2d['id'],_0x14ff2d[_0x336dc0(0x240)],_0x14ff2d[_0x336dc0(0x1ff)],_0x32f6a3[_0x336dc0(0x1ff)],_0x336dc0(0x1fa),{'paymentDetails':_0x32f6a3[_0x336dc0(0x22c)],'amount':_0x32f6a3['amount'],'currency':_0x32f6a3[_0x336dc0(0x132)],'shopId':_0x14ff2d[_0x336dc0(0x20f)],'checkTimestamp':new Date()[_0x336dc0(0x1a3)]()});const _0xb39f80={'status':_0x32f6a3[_0x336dc0(0x1ff)],'updatedAt':new Date()};if(_0x32f6a3[_0x336dc0(0x1ff)]===_0x336dc0(0x223)&&_0x14ff2d[_0x336dc0(0x1ff)]!==_0x336dc0(0x223)){_0xb39f80[_0x336dc0(0x1ac)]=new Date();if(!_0x14ff2d[_0x336dc0(0x22a)]){const _0x5165b6=await currencyService_1['currencyService'][_0x336dc0(0x230)](_0x14ff2d['amount'],_0x14ff2d['currency']);_0xb39f80[_0x336dc0(0x22a)]=_0x5165b6;const _0x31205a=await this[_0x336dc0(0x1ea)](_0x14ff2d[_0x336dc0(0x20f)],_0x14ff2d[_0x336dc0(0x1d8)]),_0x165bf9=_0x5165b6*(0x1-_0x31205a/0x64);_0xb39f80[_0x336dc0(0x241)]=_0x165bf9,_0xb39f80[_0x336dc0(0x1bf)]=_0x31205a,console[_0x336dc0(0x1cb)](_0x336dc0(0x23f)+_0x14ff2d['id']+_0x336dc0(0x231)),console[_0x336dc0(0x1cb)]('\x20\x20\x20Amount:\x20'+_0x14ff2d['amount']+'\x20'+_0x14ff2d[_0x336dc0(0x132)]+_0x336dc0(0x1b4)+_0x5165b6[_0x336dc0(0x1f9)](0x6)+'\x20USDT'),console[_0x336dc0(0x1cb)](_0x336dc0(0x1dd)+_0x14ff2d[_0x336dc0(0x1d8)]+'\x20commission:\x20'+_0x31205a+'%'),console['log']('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x165bf9[_0x336dc0(0x1f9)](0x6)+_0x336dc0(0x1d5));}console[_0x336dc0(0x1cb)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x14ff2d['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0xb39f80['paidAt'][_0x336dc0(0x1a3)]());}if(_0x32f6a3[_0x336dc0(0x22c)]){const _0x3ee2bb=_0x32f6a3[_0x336dc0(0x22c)];_0x3ee2bb[_0x336dc0(0x196)]&&(_0xb39f80[_0x336dc0(0x207)]=_0x3ee2bb['iban'],console[_0x336dc0(0x1cb)](_0x336dc0(0x1f1)+_0x3ee2bb[_0x336dc0(0x196)])),_0x3ee2bb[_0x336dc0(0x199)]&&console[_0x336dc0(0x1cb)](_0x336dc0(0x21f)+_0x3ee2bb[_0x336dc0(0x199)]),_0x3ee2bb[_0x336dc0(0x197)]&&console[_0x336dc0(0x1cb)]('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x3ee2bb[_0x336dc0(0x197)]),_0x3ee2bb['confirmedOn']&&console['log'](_0x336dc0(0x228)+_0x3ee2bb[_0x336dc0(0x1f8)]);}await database_1[_0x336dc0(0x1e0)]['payment'][_0x336dc0(0x1cf)]({'where':{'id':_0x14ff2d['id']},'data':_0xb39f80});if(_0x32f6a3['status']===_0x336dc0(0x223)&&_0x14ff2d[_0x336dc0(0x1ff)]!==_0x336dc0(0x223)){console[_0x336dc0(0x1cb)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x14ff2d['id']+_0x336dc0(0x1dc));const _0x21af11=await database_1[_0x336dc0(0x1e0)][_0x336dc0(0x233)][_0x336dc0(0x164)]({'where':{'id':_0x14ff2d['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x21af11?.[_0x336dc0(0x192)]&&_0x21af11['paymentLink'])try{const _0x3f6d3b=_0x21af11[_0x336dc0(0x1f6)];console[_0x336dc0(0x1cb)](_0x336dc0(0x1a8)+_0x3f6d3b['id']+_0x336dc0(0x1bb)+_0x3f6d3b[_0x336dc0(0x16e)]+_0x336dc0(0x1b8)+_0x3f6d3b['currentPayments']+_0x336dc0(0x133)+_0x3f6d3b['status']);const _0x3170d3=_0x3f6d3b[_0x336dc0(0x17b)]+0x1,_0xd5bc18=_0x3f6d3b['type']===_0x336dc0(0x1cc)?'COMPLETED':_0x3f6d3b[_0x336dc0(0x1ff)];await database_1['default'][_0x336dc0(0x1f6)][_0x336dc0(0x1cf)]({'where':{'id':_0x3f6d3b['id']},'data':{'currentPayments':_0x3170d3,'status':_0xd5bc18,'updatedAt':new Date()}}),console[_0x336dc0(0x1cb)](_0x336dc0(0x148)+_0x3f6d3b['id']+_0x336dc0(0x1b3)+_0x3f6d3b[_0x336dc0(0x17b)]+'\x20->\x20'+_0x3170d3+',\x20status='+_0x3f6d3b[_0x336dc0(0x1ff)]+'\x20->\x20'+_0xd5bc18);}catch(_0x2c3b15){console[_0x336dc0(0x17d)](_0x336dc0(0x14d),_0x2c3b15);}else console[_0x336dc0(0x1cb)](_0x336dc0(0x1d7)+_0x14ff2d['id']+_0x336dc0(0x154));}await database_1[_0x336dc0(0x1e0)][_0x336dc0(0x156)][_0x336dc0(0x172)]({'data':{'paymentId':_0x14ff2d['id'],'shopId':_0x14ff2d['shopId'],'event':_0x336dc0(0x218)+_0x32f6a3[_0x336dc0(0x1ff)][_0x336dc0(0x1fe)](),'statusCode':0xc8,'responseBody':JSON[_0x336dc0(0x22e)]({'oldStatus':_0x14ff2d[_0x336dc0(0x1ff)],'newStatus':_0x32f6a3[_0x336dc0(0x1ff)],'paymentDetails':_0x32f6a3[_0x336dc0(0x22c)],'checkedAt':new Date()[_0x336dc0(0x1a3)]()})}}),await this[_0x336dc0(0x16b)](_0x14ff2d,_0x32f6a3[_0x336dc0(0x1ff)]),await this['sendPaymentStatusNotification'](_0x14ff2d,_0x32f6a3['status']),_0x32f6a3[_0x336dc0(0x1ff)]!=='PENDING'&&(console[_0x336dc0(0x1cb)](_0x336dc0(0x1f5)+_0x14ff2d['id']+_0x336dc0(0x145)+_0x32f6a3['status']+_0x336dc0(0x1a2)),this[_0x336dc0(0x146)](_0x14ff2d['id'])),console['log']('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x14ff2d['id']+_0x336dc0(0x23a));}else console[_0x336dc0(0x1cb)](_0x336dc0(0x1ce)+_0x14ff2d['id']+_0x336dc0(0x150)+_0x32f6a3[_0x336dc0(0x1ff)]+')'),this[_0x336dc0(0x189)](_0x14ff2d['id'],_0x14ff2d[_0x336dc0(0x240)],_0x14ff2d[_0x336dc0(0x1ff)],_0x32f6a3[_0x336dc0(0x1ff)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x32f6a3[_0x336dc0(0x22c)],'amount':_0x32f6a3[_0x336dc0(0x21e)],'currency':_0x32f6a3['currency'],'shopId':_0x14ff2d['shopId'],'checkTimestamp':new Date()[_0x336dc0(0x1a3)]()});}catch(_0x240b64){console['error'](_0x336dc0(0x14c)+_0x14ff2d['id']+':',_0x240b64),this[_0x336dc0(0x17e)](_0x14ff2d['id'],_0x14ff2d[_0x336dc0(0x240)],_0x240b64,'status_check',{'paymentAmount':_0x14ff2d[_0x336dc0(0x21e)],'paymentCurrency':_0x14ff2d[_0x336dc0(0x132)],'shopId':_0x14ff2d['shopId'],'createdAt':_0x14ff2d[_0x336dc0(0x21c)]}),await database_1[_0x336dc0(0x1e0)][_0x336dc0(0x156)][_0x336dc0(0x172)]({'data':{'paymentId':_0x14ff2d['id'],'shopId':_0x14ff2d['shopId'],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x240b64 instanceof Error?_0x240b64[_0x336dc0(0x1f7)]:_0x336dc0(0x179),'gatewayPaymentId':_0x14ff2d[_0x336dc0(0x240)],'checkedAt':new Date()['toISOString']()})}});}}async['sendShopWebhook'](_0x81c249,_0x2f0a2d){const _0x116b0f=a48_0x2ae551,_0x326c30=Date[_0x116b0f(0x17a)]();try{const _0x331a5d=_0x81c249[_0x116b0f(0x200)],_0x289ad6=_0x331a5d[_0x116b0f(0x18f)];if(!_0x289ad6?.[_0x116b0f(0x193)]){console[_0x116b0f(0x1cb)](_0x116b0f(0x1c9)+_0x331a5d['id']);return;}const _0x5ea321=_0x2f0a2d===_0x116b0f(0x223)?_0x116b0f(0x1b1):_0x2f0a2d==='FAILED'?_0x116b0f(0x201):_0x2f0a2d===_0x116b0f(0x191)?_0x116b0f(0x201):_0x116b0f(0x15a);if(!_0x289ad6[_0x116b0f(0x1f4)]?.[_0x116b0f(0x1d1)](_0x5ea321)){console[_0x116b0f(0x1cb)](_0x116b0f(0x14f)+_0x5ea321+_0x116b0f(0x1ba)+_0x331a5d['id']);return;}const _0x4dc6db=(0x0,gateway_1[_0x116b0f(0x19f)])(_0x81c249[_0x116b0f(0x1d8)])||_0x81c249[_0x116b0f(0x1d8)],_0x2eace5={'event':_0x5ea321,'payment':{'id':_0x81c249['id'],'order_id':_0x81c249[_0x116b0f(0x19d)],'gateway_order_id':_0x81c249[_0x116b0f(0x1c5)],'gateway':_0x4dc6db,'amount':_0x81c249[_0x116b0f(0x21e)],'currency':_0x81c249['currency'],'status':_0x2f0a2d[_0x116b0f(0x1fe)](),'customer_email':_0x81c249[_0x116b0f(0x20c)],'customer_name':_0x81c249[_0x116b0f(0x170)],'created_at':_0x81c249[_0x116b0f(0x21c)],'updated_at':new Date()}},_0x59c7a5=await fetch(_0x289ad6[_0x116b0f(0x193)],{'method':_0x116b0f(0x180),'headers':{'Content-Type':_0x116b0f(0x245),'User-Agent':_0x116b0f(0x22b)},'body':JSON[_0x116b0f(0x22e)](_0x2eace5)}),_0x33109c=Date[_0x116b0f(0x17a)]()-_0x326c30,_0xa264f7=_0x59c7a5['ok']?_0x116b0f(0x1da):await _0x59c7a5[_0x116b0f(0x135)]();loggerService_1['loggerService'][_0x116b0f(0x160)](_0x81c249[_0x116b0f(0x20f)],_0x289ad6[_0x116b0f(0x193)],_0x5ea321,_0x59c7a5[_0x116b0f(0x1ff)],_0x33109c,_0x2eace5),console[_0x116b0f(0x1cb)](_0x116b0f(0x144)+_0x289ad6[_0x116b0f(0x193)]+_0x116b0f(0x19b)+_0x59c7a5[_0x116b0f(0x1ff)]+'\x20('+_0x33109c+'ms)');}catch(_0x369d00){console['error'](_0x116b0f(0x1c8),_0x369d00),loggerService_1[_0x116b0f(0x21d)][_0x116b0f(0x1db)](_0x81c249[_0x116b0f(0x20f)],_0x81c249['shop']?.[_0x116b0f(0x18f)]?.[_0x116b0f(0x193)]||'unknown',_0x116b0f(0x1d0),_0x369d00,{});}}async[a48_0x2ae551(0x19a)](_0x2c5f18,_0x5a8562){const _0x4487e3=a48_0x2ae551;try{const _0x16e23f={'PENDING':_0x4487e3(0x13f),'PAID':'paid','FAILED':'failed','EXPIRED':_0x4487e3(0x1af)},_0x3260db=_0x16e23f[_0x5a8562];if(!_0x3260db||_0x3260db==='created')return;await telegramBotService_1[_0x4487e3(0x1ed)][_0x4487e3(0x1be)](_0x2c5f18[_0x4487e3(0x20f)],_0x2c5f18,_0x3260db);}catch(_0x2f07df){console[_0x4487e3(0x17d)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x2f07df);}}async['checkPaymentById'](_0xe6cb77){const _0x4b4f9f=a48_0x2ae551;console[_0x4b4f9f(0x1cb)](_0x4b4f9f(0x1e2)+_0xe6cb77);const _0x103c3d=await database_1['default'][_0x4b4f9f(0x233)][_0x4b4f9f(0x164)]({'where':{'id':_0xe6cb77},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x103c3d)throw new Error(_0x4b4f9f(0x13c));if(_0x103c3d[_0x4b4f9f(0x1d8)]!==_0x4b4f9f(0x211)&&_0x103c3d[_0x4b4f9f(0x1d8)]!==_0x4b4f9f(0x15f))throw new Error(_0x4b4f9f(0x1c7));console['log'](_0x4b4f9f(0x1e9)+_0x103c3d[_0x4b4f9f(0x1d8)]+_0x4b4f9f(0x1df)+_0xe6cb77),await this[_0x4b4f9f(0x1c0)](_0x103c3d),console[_0x4b4f9f(0x1cb)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0xe6cb77);}['getServiceStats'](){const _0x3d4799=a48_0x2ae551,_0x4b2b1a=this[_0x3d4799(0x174)]?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x5a2bf6=Array['from'](this[_0x3d4799(0x136)]['values']())['map'](_0x5eee51=>({'paymentId':_0x5eee51[_0x3d4799(0x140)],'gatewayPaymentId':_0x5eee51['gatewayPaymentId'],'createdAt':_0x5eee51['createdAt'],'timersCount':_0x5eee51['timers'][_0x3d4799(0x184)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x3d4799(0x14b)]/(0x3e8*0x3c),'expiryDays':this[_0x3d4799(0x14a)],'activeIndividualTimers':this[_0x3d4799(0x136)][_0x3d4799(0x227)],'nextGlobalCheckIn':_0x4b2b1a,'paymentTimersDetails':_0x5a2bf6};}[a48_0x2ae551(0x206)](_0x50ca78){const _0x21973e=a48_0x2ae551,_0xdafe22=this['paymentTimers'][_0x21973e(0x165)](_0x50ca78);if(_0xdafe22)return{'hasTimers':!![],'timersCount':_0xdafe22['timers'][_0x21973e(0x184)],'createdAt':_0xdafe22['createdAt'],'gatewayPaymentId':_0xdafe22[_0x21973e(0x240)]};return{'hasTimers':![]};}async[a48_0x2ae551(0x1ea)](_0x5244e5,_0x24dc2d){const _0x335d12=a48_0x2ae551;try{const _0x444558=await database_1[_0x335d12(0x1e0)][_0x335d12(0x200)][_0x335d12(0x164)]({'where':{'id':_0x5244e5},'select':{'gatewaySettings':!![]}});if(!_0x444558?.['gatewaySettings'])return console[_0x335d12(0x1cb)](_0x335d12(0x244)+_0x5244e5+_0x335d12(0x162)),0xa;const _0x2b6270=JSON[_0x335d12(0x141)](_0x444558[_0x335d12(0x171)]);for(const [_0x2d7c93,_0x2cd832]of Object[_0x335d12(0x235)](_0x2b6270)){if(_0x2d7c93[_0x335d12(0x1fe)]()===_0x24dc2d[_0x335d12(0x1fe)]()){const _0x3141a5=_0x2cd832[_0x335d12(0x178)]||0xa;return console['log'](_0x335d12(0x20e)+_0x24dc2d+_0x335d12(0x15e)+_0x5244e5+':\x20'+_0x3141a5+'%'),_0x3141a5;}}return console[_0x335d12(0x1cb)](_0x335d12(0x1a6)+_0x24dc2d+_0x335d12(0x20d)+_0x5244e5+_0x335d12(0x21a)),0xa;}catch(_0x2997dd){return console['error']('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x5244e5+_0x335d12(0x22f)+_0x24dc2d+':',_0x2997dd),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a48_0x2ae551(0x238)]=new CoinToPayStatusService();