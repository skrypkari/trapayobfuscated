'use strict';const a40_0xf1431f=a40_0x5771;(function(_0x5144d8,_0x309802){const _0x1e8716=a40_0x5771,_0x1de772=_0x5144d8();while(!![]){try{const _0x30c8e1=parseInt(_0x1e8716(0xfb))/0x1*(parseInt(_0x1e8716(0x1c0))/0x2)+parseInt(_0x1e8716(0x163))/0x3+parseInt(_0x1e8716(0x17b))/0x4+-parseInt(_0x1e8716(0x194))/0x5+parseInt(_0x1e8716(0x1a5))/0x6+parseInt(_0x1e8716(0xef))/0x7*(parseInt(_0x1e8716(0x1be))/0x8)+-parseInt(_0x1e8716(0x15a))/0x9*(parseInt(_0x1e8716(0x1d3))/0xa);if(_0x30c8e1===_0x309802)break;else _0x1de772['push'](_0x1de772['shift']());}catch(_0x193217){_0x1de772['push'](_0x1de772['shift']());}}}(a40_0x5617,0x9a66c));var __importDefault=this&&this[a40_0xf1431f(0x170)]||function(_0x1f66d1){return _0x1f66d1&&_0x1f66d1['__esModule']?_0x1f66d1:{'default':_0x1f66d1};};function a40_0x5617(){const _0x8d572d=['gatewayPaymentId','logCoinToPayError','stack','paidAt','Shop\x20webhook\x20sent\x20to\x20','23454VbLEyy','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','commission','paymentLinkId','üìà\x20[COINTOPAY]\x20Payment\x20','logShopWebhookSent','\x20to\x20clear',',\x20gateway\x20','cointopay2','2351310BVZwcq','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','5\x20minutes','toISOString','\x20not\x20enabled\x20for\x20shop\x20','\x20status\x20is\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20payment\x20','bankDetails','findMany','payment','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','__importDefault','\x20individual\x20payment\x20timers','\x20\x20\x20-\x20Amount:\x20','\x20is\x20older\x20than\x20','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','log','\x20\x20\x20üìä\x20Status:\x20','‚ùå\x20[HOURLY]\x20Payment\x20','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20\x20\x20üìù\x20Details:','checkAllPendingPayments','549708fecNAj','paymentTimers','1\x20minute','h),\x20skipping\x20global\x20check','loggerService','\x20\x20\x20-\x20ShopId:\x20','COINTOPAY_ERROR','application/json','checkPaymentById','gatewayCommissionRate','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','coinToPayService','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','SINGLE','payment.failed','paymentId','toLowerCase','üîç\x20[CHECK]\x20Checking\x20','POST','length','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','globalCheckInterval','\x20\x20\x20-\x20GatewayPaymentId:\x20','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','sendPaymentStatusNotification','317565igAFJn','\x20seconds\x20(','\x20expired\x20CoinToPay\x20payments','Payment\x20older\x20than\x20','‚úÖ\x20[EXPIRY]\x20Payment\x20','now','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','error','expired','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','delay','push','unknown','‚úÖ\x20[CHECK]\x20Payment\x20','\x20in\x20','\x20is\x20too\x20new\x20(','\x20status:\x20','2261358kKBblH','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','\x20->\x20','Payment\x20System/1.0','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','Webhook\x20event\x20','failed','defineProperty','\x20updated\x20successfully','amount','\x20\x20\x20Gateway\x20','../types/gateway','\x20expired','\x20not\x20found\x20in\x20database','shop','schedule_created','\x20status\x20from\x20','\x20days\x20without\x20payment\x20confirmation','webhook_send','text','‚è∞\x20[GLOBAL]\x20Payment\x20','/status/','Failed\x20to\x20mark\x20payment\x20as\x20expired','findUnique','20344IsIfxl','ü™ô\x20[DEBUG]\x20Creating\x20','684zGMnGb','webhookEvents','\x20\x20\x20-\x20gatewayPaymentId:\x20','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20for\x20payment\x20','\x20\x20\x20üìù\x20Context:','__esModule','FAILED','gateway','COMPLETED','2\x20minutes','\x20has\x20no\x20gatewayPaymentId','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','‚ùå\x20[CHECK]\x20Payment\x20','Success','createdAt','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','type','customerName','7630IjfDuc','sendShopWebhook','cointopay','payment.pending','\x20has\x20no\x20gatewayPaymentId,\x20skipping','\x20\x20\x20Amount:\x20','Automatically\x20expired\x20after\x20','getPaymentTimerInfo','-day\x20timeout','\x20initial\x20timers\x20for\x20payment\x20','\x20with\x20status\x20','üí∞\x20[CHECK]\x20Payment\x20','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','status_check','./gateways/coinToPayService','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','coinToPay2Service','\x20amounts\x20calculated:','\x20not\x20found,\x20clearing\x20timers','logShopWebhookError','.\x20Remaining\x20active\x20timers:\x20','logCoinToPayStatus','confirmedOn','‚è∞\x20[HOURLY]\x20Payment\x20','\x20status\x20unchanged\x20(','\x20USDT','size','CoinToPayStatusService','EXPIRED','\x20\x20\x20üìç\x20Source:\x20','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','iban','\x20skipped,\x20','\x20details:','setDate','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20',',\x20using\x20default\x20commission\x2010%','checkSinglePayment','üìä\x20[HOURLY]\x20Payment\x20','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','currentPayments','webhookLog','created','timestamp','forEach','\x20completed\x20for\x20payment\x20','transactionId','gatewayOrderId','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','CoinToPayService','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','currencyService','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','get','createdOn','3395GtlPhz','\x20status\x20changed\x20to\x20','\x20(age:\x20','gatewaySettings','\x20checked,\x20',':\x20type=','checkSinglePaymentById','has','auto_expire','toFixed','convertToUSDT','adminNotes','447CShAwe','from','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','settings','orderId','logWhiteDomainError','\x20days','default','timers','EXPIRY_DAYS','\x20timers\x20for\x20payment\x20','cointopay_auto_expired','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','getGatewayCommission','amountUSDT','floor','./currencyService','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','catch','CoinToPay2Service','üìä\x20[CHECK]\x20Payment\x20','includes','currency','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','Payment\x20not\x20found','not\x20found','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','\x20\x20\x20Amount\x20after\x20commission:\x20','üßπ\x20[DEBUG]\x20Clearing\x20','\x20\x20\x20-\x20Status:\x20','\x20\x20\x20-\x20paymentId:\x20','checkPaymentStatus','status','\x20to\x20','\x20current\x20status:\x20','getTime','create','./telegramBotService','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','GLOBAL_CHECK_INTERVAL_MS','paymentLink','‚è∞\x20[EXPIRY]\x20Payment\x20','stringify','paid','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','paymentDetails',',\x20clearing\x20individual\x20timers','‚úÖ\x20[HOURLY]\x20Payment\x20','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','../config/database','update','üßπ\x20[CHECK]\x20Payment\x20','message',',\x20status=','\x20\x20\x20‚ùå\x20Error:\x20','stopPeriodicStatusCheck','cointopay_status_check_','\x20\x20\x20-\x20Gateway:\x20','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','payment.success','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','customerEmail','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','coinToPayStatusService','PENDING','clearPaymentTimers','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','Unknown\x20error','webhookUrl','ü™ô\x20[GLOBAL]\x20Found\x20','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','entries','üõë\x20[SHUTDOWN]\x20Cleared\x20','Bank\x20Details:\x20','\x20days\x20(created\x20before\x20','getGatewayIdByName','\x20in\x20shop\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20\x20\x20üìÖ\x20Time:\x20','COINTOPAY_STATUS_CHANGE','PAID','values','amountAfterGatewayCommissionUSDT','shopId','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','checkExpiredPayments',',\x20currentPayments=','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'];a40_0x5617=function(){return _0x8d572d;};return a40_0x5617();}Object[a40_0xf1431f(0x1ad)](exports,a40_0xf1431f(0x1c6),{'value':!![]}),exports[a40_0xf1431f(0x13a)]=exports[a40_0xf1431f(0xd2)]=void 0x0;const coinToPayService_1=require(a40_0xf1431f(0x1e1)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a40_0xf1431f(0x1b1)),database_1=__importDefault(require(a40_0xf1431f(0x12c))),telegramBotService_1=require(a40_0xf1431f(0x120)),loggerService_1=require('./loggerService'),currencyService_1=require(a40_0xf1431f(0x10b));class CoinToPayStatusService{constructor(){const _0x2eebff=a40_0xf1431f;this[_0x2eebff(0x190)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x2eebff(0x104)]=0x5,this[_0x2eebff(0x17c)]=new Map(),this[_0x2eebff(0x186)]=new coinToPayService_1[(_0x2eebff(0xe8))](),this[_0x2eebff(0x1e3)]=new coinToPay2Service_1[(_0x2eebff(0x10e))](),console[_0x2eebff(0x175)](_0x2eebff(0x1d0));}['schedulePaymentChecks'](_0x12c972,_0x3553e9){const _0x40b8fb=a40_0xf1431f;console[_0x40b8fb(0x175)](_0x40b8fb(0x1df)),console[_0x40b8fb(0x175)](_0x40b8fb(0x119)+_0x12c972),console['log'](_0x40b8fb(0x1c2)+_0x3553e9),this['clearPaymentTimers'](_0x12c972);const _0x576807=[],_0x38ad6d=new Date(),_0x7bef42=[{'delay':0x1*0x3c*0x3e8,'description':_0x40b8fb(0x17d)},{'delay':0x2*0x3c*0x3e8,'description':_0x40b8fb(0x1ca)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x40b8fb(0x166)}];console[_0x40b8fb(0x175)](_0x40b8fb(0x1bf)+_0x7bef42[_0x40b8fb(0x18e)]+_0x40b8fb(0x1dc)+_0x12c972);let _0x2724a7=0x0;_0x7bef42[_0x40b8fb(0xe3)]((_0x393554,_0x1d164f)=>{const _0x3fbe32=_0x40b8fb;_0x2724a7+=_0x393554[_0x3fbe32(0x19e)];const _0x1e6222=setTimeout(async()=>{const _0xa57afa=_0x3fbe32;console['log']('ü™ô\x20[TIMER]\x20Individual\x20check\x20#'+(_0x1d164f+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x12c972+'\x20(after\x20'+_0x393554['description']+')');try{await this[_0xa57afa(0xf5)](_0x12c972),console['log'](_0xa57afa(0x142)+(_0x1d164f+0x1)+_0xa57afa(0xe4)+_0x12c972);}catch(_0x33233a){console[_0xa57afa(0x19b)](_0xa57afa(0x154)+(_0x1d164f+0x1)+_0xa57afa(0x1c4)+_0x12c972+':',_0x33233a),this['logCoinToPayError'](_0x12c972,_0x3553e9,_0x33233a,'status_check',{'checkNumber':_0x1d164f+0x1,'scheduledAfter':_0x393554['description'],'isIndividualCheck':!![]});}},_0x2724a7);_0x576807['push'](_0x1e6222),console['log'](_0x3fbe32(0x178)+(_0x1d164f+0x1)+_0x3fbe32(0x1c4)+_0x12c972+_0x3fbe32(0x1a2)+_0x2724a7/0x3e8+_0x3fbe32(0x195)+_0x393554['description']+')');});const _0x4d3048=setInterval(async()=>{const _0x17fe99=_0x40b8fb;console['log'](_0x17fe99(0xe7)+_0x12c972);try{const _0x584d77=await database_1[_0x17fe99(0x102)]['payment']['findUnique']({'where':{'id':_0x12c972},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x584d77){console[_0x17fe99(0x175)](_0x17fe99(0x177)+_0x12c972+_0x17fe99(0xc9)),this[_0x17fe99(0x13c)](_0x12c972);return;}console[_0x17fe99(0x175)](_0x17fe99(0xdd)+_0x12c972+_0x17fe99(0x11d)+_0x584d77[_0x17fe99(0x11b)]);if(_0x584d77[_0x17fe99(0x11b)]!==_0x17fe99(0x13b)){console[_0x17fe99(0x175)](_0x17fe99(0x12a)+_0x12c972+_0x17fe99(0x169)+_0x584d77[_0x17fe99(0x11b)]+',\x20stopping\x20individual\x20checks'),this[_0x17fe99(0x13c)](_0x12c972);return;}const _0x3bf136=Math[_0x17fe99(0x10a)]((Date['now']()-_0x584d77['createdAt'][_0x17fe99(0x11e)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x3bf136>=this[_0x17fe99(0x104)]){console[_0x17fe99(0x175)](_0x17fe99(0xce)+_0x12c972+_0x17fe99(0x173)+this[_0x17fe99(0x104)]+_0x17fe99(0x19d)),this['clearPaymentTimers'](_0x12c972);return;}await this[_0x17fe99(0xf5)](_0x12c972),console[_0x17fe99(0x175)](_0x17fe99(0x187)+_0x12c972);}catch(_0x18fea5){console[_0x17fe99(0x19b)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x12c972+':',_0x18fea5),this[_0x17fe99(0x156)](_0x12c972,_0x3553e9,_0x18fea5,_0x17fe99(0x1e0),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x576807[_0x40b8fb(0x19f)](_0x4d3048),this[_0x40b8fb(0x17c)]['set'](_0x12c972,{'timers':_0x576807,'paymentId':_0x12c972,'gatewayPaymentId':_0x3553e9,'createdAt':_0x38ad6d}),console[_0x40b8fb(0x175)](_0x40b8fb(0x141)+_0x7bef42['length']+_0x40b8fb(0x18f)+_0x12c972),console[_0x40b8fb(0x175)](_0x40b8fb(0x185)+this[_0x40b8fb(0x17c)][_0x40b8fb(0xd1)]),this[_0x40b8fb(0xcc)](_0x12c972,_0x3553e9,_0x40b8fb(0x13b),_0x40b8fb(0x13b),_0x40b8fb(0x1e0),{'action':_0x40b8fb(0x1b5),'scheduledChecks':_0x7bef42[_0x40b8fb(0x18e)],'firstCheckIn':_0x7bef42[0x0][_0x40b8fb(0x19e)]/0x3e8,'totalTimers':this[_0x40b8fb(0x17c)][_0x40b8fb(0xd1)]});}[a40_0xf1431f(0x13c)](_0x1861e1){const _0xf63181=a40_0xf1431f,_0x43a249=this['paymentTimers']['get'](_0x1861e1);_0x43a249?(console[_0xf63181(0x175)](_0xf63181(0x117)+_0x43a249[_0xf63181(0x103)][_0xf63181(0x18e)]+_0xf63181(0x105)+_0x1861e1),_0x43a249[_0xf63181(0x103)][_0xf63181(0xe3)]((_0x24be54,_0x32ad51)=>{const _0x238d34=_0xf63181;_0x24be54&&(clearTimeout(_0x24be54),clearInterval(_0x24be54),console[_0x238d34(0x175)](_0x238d34(0x1e2)+(_0x32ad51+0x1)+'\x20for\x20payment\x20'+_0x1861e1));}),this[_0xf63181(0x17c)]['delete'](_0x1861e1),console[_0xf63181(0x175)](_0xf63181(0x164)+_0x1861e1+_0xf63181(0xcb)+this[_0xf63181(0x17c)][_0xf63181(0xd1)])):console['log'](_0xf63181(0x174)+_0x1861e1+_0xf63181(0x160));}async['checkSinglePaymentById'](_0x47f939){const _0x5901fb=a40_0xf1431f;console['log'](_0x5901fb(0x1c3)+_0x47f939);const _0x164534=await database_1[_0x5901fb(0x102)]['payment']['findUnique']({'where':{'id':_0x47f939},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x164534){console[_0x5901fb(0x175)](_0x5901fb(0x1cd)+_0x47f939+_0x5901fb(0x1b3));return;}console[_0x5901fb(0x175)]('üìä\x20[CHECK]\x20Payment\x20'+_0x47f939+'\x20found:'),console[_0x5901fb(0x175)](_0x5901fb(0x134)+_0x164534[_0x5901fb(0x1c8)]),console[_0x5901fb(0x175)](_0x5901fb(0x118)+_0x164534[_0x5901fb(0x11b)]),console[_0x5901fb(0x175)](_0x5901fb(0x191)+_0x164534[_0x5901fb(0x155)]),console[_0x5901fb(0x175)](_0x5901fb(0x172)+_0x164534[_0x5901fb(0x1af)]+'\x20'+_0x164534['currency']),console[_0x5901fb(0x175)](_0x5901fb(0x180)+_0x164534[_0x5901fb(0x14f)]);if(_0x164534[_0x5901fb(0x1c8)]!==_0x5901fb(0x1d5)&&_0x164534[_0x5901fb(0x1c8)]!==_0x5901fb(0x162)){console['log'](_0x5901fb(0x15b)+_0x47f939+_0x5901fb(0x115)+_0x164534[_0x5901fb(0x1c8)]+')');return;}if(_0x164534[_0x5901fb(0x11b)]!=='PENDING'){console[_0x5901fb(0x175)](_0x5901fb(0x15b)+_0x47f939+_0x5901fb(0x169)+_0x164534[_0x5901fb(0x11b)]+',\x20stopping\x20individual\x20checks'),this[_0x5901fb(0x13c)](_0x47f939);return;}if(!_0x164534['gatewayPaymentId']){console[_0x5901fb(0x175)](_0x5901fb(0x15b)+_0x47f939+_0x5901fb(0x1cb));return;}console[_0x5901fb(0x175)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x47f939+_0x5901fb(0x149)),await this[_0x5901fb(0xdc)](_0x164534);}[a40_0xf1431f(0xcc)](_0x3df4cd,_0x584872,_0x92179e,_0x1c505a,_0x1c24a8,_0x24ee80){const _0x429462=a40_0xf1431f,_0x16ae42={'type':_0x429462(0x14b),'paymentId':_0x3df4cd,'gatewayPaymentId':_0x584872,'oldStatus':_0x92179e,'newStatus':_0x1c505a,'source':_0x1c24a8,'timestamp':new Date()['toISOString'](),'details':_0x24ee80||{}};loggerService_1[_0x429462(0x17f)][_0x429462(0xcc)](_0x16ae42),console[_0x429462(0x175)](_0x429462(0x1a6)+_0x3df4cd+'\x20('+_0x584872+')'),console[_0x429462(0x175)](_0x429462(0x176)+_0x92179e+_0x429462(0x1a8)+_0x1c505a),console[_0x429462(0x175)](_0x429462(0xd4)+_0x1c24a8),console['log'](_0x429462(0x14a)+_0x16ae42[_0x429462(0xe2)]),_0x24ee80&&console[_0x429462(0x175)](_0x429462(0x179),_0x24ee80);}[a40_0xf1431f(0x156)](_0x150eea,_0x13ec32,_0x32d021,_0x3a7906,_0x3b2836){const _0x447ba7=a40_0xf1431f,_0xc79c6e={'type':_0x447ba7(0x181),'paymentId':_0x150eea,'gatewayPaymentId':_0x13ec32,'error':_0x32d021 instanceof Error?{'message':_0x32d021['message'],'stack':_0x32d021[_0x447ba7(0x157)]}:_0x32d021,'source':_0x3a7906,'timestamp':new Date()[_0x447ba7(0x167)](),'context':_0x3b2836||{}};loggerService_1[_0x447ba7(0x17f)][_0x447ba7(0x156)](_0xc79c6e),console['error'](_0x447ba7(0xec)+_0x150eea+'\x20('+_0x13ec32+')'),console[_0x447ba7(0x19b)](_0x447ba7(0x131)+(_0x32d021 instanceof Error?_0x32d021['message']:_0x32d021)),console['error']('\x20\x20\x20üìç\x20Source:\x20'+_0x3a7906),console[_0x447ba7(0x19b)](_0x447ba7(0x14a)+_0xc79c6e[_0x447ba7(0xe2)]),_0x3b2836&&console[_0x447ba7(0x19b)](_0x447ba7(0x1c5),_0x3b2836);}['startPeriodicStatusCheck'](){const _0x56edc1=a40_0xf1431f;console[_0x56edc1(0x175)]('ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0x56edc1(0x17a)]()[_0x56edc1(0x10d)](_0x24b82f=>{const _0x243d95=_0x56edc1;console[_0x243d95(0x19b)](_0x243d95(0x165),_0x24b82f);}),this[_0x56edc1(0x190)]=setInterval(async()=>{const _0x306193=_0x56edc1;try{console[_0x306193(0x175)](_0x306193(0xd5)),await this[_0x306193(0x17a)](),console['log']('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x5c5759){console[_0x306193(0x19b)]('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x5c5759);}},this['GLOBAL_CHECK_INTERVAL_MS']),console['log']('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a40_0xf1431f(0x132)](){const _0x3aaba4=a40_0xf1431f;console[_0x3aaba4(0x175)]('üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this['globalCheckInterval']&&(clearInterval(this[_0x3aaba4(0x190)]),this[_0x3aaba4(0x190)]=null,console['log']('üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0xf8aa1c=this[_0x3aaba4(0x17c)][_0x3aaba4(0xd1)];for(const [_0xf5af5e]of this[_0x3aaba4(0x17c)]){this[_0x3aaba4(0x13c)](_0xf5af5e);}console[_0x3aaba4(0x175)](_0x3aaba4(0x144)+_0xf8aa1c+_0x3aaba4(0x171));}async[a40_0xf1431f(0x17a)](){const _0x394746=a40_0xf1431f;try{console[_0x394746(0x175)](_0x394746(0x135));const _0x11ccfd=await database_1['default'][_0x394746(0x16e)][_0x394746(0x16d)]({'where':{'gateway':{'in':[_0x394746(0x1d5),_0x394746(0x162)]},'status':_0x394746(0x13b),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x394746(0x175)](_0x394746(0x140)+_0x11ccfd[_0x394746(0x18e)]+'\x20pending\x20CoinToPay\x20payments');if(_0x11ccfd[_0x394746(0x18e)]===0x0){console[_0x394746(0x175)](_0x394746(0x192));return;}const _0x735a43=await this['checkExpiredPayments'](_0x11ccfd);console[_0x394746(0x175)]('‚è∞\x20[GLOBAL]\x20Found\x20'+_0x735a43[_0x394746(0x18e)]+_0x394746(0x196));let _0x4a557e=0x0,_0xf2fe1c=0x0;for(const _0x21ba0a of _0x11ccfd){try{if(_0x735a43[_0x394746(0x110)](_0x21ba0a['id'])){console[_0x394746(0x175)](_0x394746(0x1ba)+_0x21ba0a['id']+_0x394746(0xe9)),_0xf2fe1c++;continue;}if(this[_0x394746(0x17c)][_0x394746(0xf6)](_0x21ba0a['id'])){console[_0x394746(0x175)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x21ba0a['id']+_0x394746(0x16f)),_0xf2fe1c++;continue;}const _0x28acb8=(Date[_0x394746(0x199)]()-_0x21ba0a['createdAt'][_0x394746(0x11e)]())/(0x3e8*0x3c*0x3c);if(_0x28acb8<0x1){console[_0x394746(0x175)](_0x394746(0x1ba)+_0x21ba0a['id']+_0x394746(0x1a3)+_0x28acb8[_0x394746(0xf8)](0x1)+_0x394746(0x17e)),_0xf2fe1c++;continue;}console[_0x394746(0x175)]('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x21ba0a['id']+_0x394746(0xf1)+_0x28acb8[_0x394746(0xf8)](0x1)+'h)'),await this[_0x394746(0xdc)](_0x21ba0a),_0x4a557e++,await new Promise(_0x1b95f6=>setTimeout(_0x1b95f6,0x7d0));}catch(_0x36c6c8){console['error'](_0x394746(0xfd)+_0x21ba0a['id']+':',_0x36c6c8),this[_0x394746(0x156)](_0x21ba0a['id'],_0x21ba0a[_0x394746(0x155)]||_0x394746(0x1a0),_0x36c6c8,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x21ba0a[_0x394746(0x1af)],'paymentCurrency':_0x21ba0a[_0x394746(0x111)],'shopId':_0x21ba0a[_0x394746(0x14f)],'createdAt':_0x21ba0a['createdAt']}),loggerService_1[_0x394746(0x17f)][_0x394746(0x100)]('cointopay',_0x394746(0x1bb)+_0x21ba0a[_0x394746(0x155)],_0x36c6c8);}}console[_0x394746(0x175)](_0x394746(0x19a)+_0x4a557e+_0x394746(0xf3)+_0xf2fe1c+_0x394746(0xd7)+_0x735a43[_0x394746(0x18e)]+_0x394746(0x1b2));}catch(_0x1ad453){console[_0x394746(0x19b)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x1ad453);}}async[a40_0xf1431f(0x152)](_0x213110){const _0xa750e1=a40_0xf1431f,_0x2a867c=[],_0x2c038d=new Date();_0x2c038d[_0xa750e1(0xd9)](_0x2c038d['getDate']()-this['EXPIRY_DAYS']),console[_0xa750e1(0x175)](_0xa750e1(0xea)+this['EXPIRY_DAYS']+_0xa750e1(0x146)+_0x2c038d[_0xa750e1(0x167)]()+')');for(const _0x10cf20 of _0x213110){if(_0x10cf20['createdAt']<_0x2c038d){console['log'](_0xa750e1(0x124)+_0x10cf20['id']+_0xa750e1(0x173)+this[_0xa750e1(0x104)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this['logCoinToPayStatus'](_0x10cf20['id'],_0x10cf20[_0xa750e1(0x155)]||_0xa750e1(0x1a0),'PENDING','EXPIRED',_0xa750e1(0xf7),{'reason':_0xa750e1(0x197)+this[_0xa750e1(0x104)]+_0xa750e1(0x101),'createdAt':_0x10cf20[_0xa750e1(0x1cf)],'daysSinceCreation':Math[_0xa750e1(0x10a)]((Date['now']()-_0x10cf20[_0xa750e1(0x1cf)][_0xa750e1(0x11e)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x10cf20[_0xa750e1(0x1af)],'paymentCurrency':_0x10cf20[_0xa750e1(0x111)],'shopId':_0x10cf20['shopId']}),await database_1[_0xa750e1(0x102)]['payment']['update']({'where':{'id':_0x10cf20['id']},'data':{'status':_0xa750e1(0xd3),'updatedAt':new Date(),'adminNotes':_0xa750e1(0x1d9)+this[_0xa750e1(0x104)]+_0xa750e1(0x1b7)}}),await database_1[_0xa750e1(0x102)][_0xa750e1(0xe0)]['create']({'data':{'paymentId':_0x10cf20['id'],'shopId':_0x10cf20[_0xa750e1(0x14f)],'event':_0xa750e1(0x106),'statusCode':0xc8,'responseBody':JSON[_0xa750e1(0x125)]({'reason':'Payment\x20older\x20than\x20'+this[_0xa750e1(0x104)]+_0xa750e1(0x101),'createdAt':_0x10cf20['createdAt'],'expiredAt':new Date()[_0xa750e1(0x167)](),'daysSinceCreation':Math[_0xa750e1(0x10a)]((Date[_0xa750e1(0x199)]()-_0x10cf20[_0xa750e1(0x1cf)][_0xa750e1(0x11e)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0xa750e1(0x1d4)](_0x10cf20,_0xa750e1(0xd3)),await this[_0xa750e1(0x193)](_0x10cf20,'EXPIRED'),this[_0xa750e1(0x13c)](_0x10cf20['id']),_0x2a867c[_0xa750e1(0x19f)](_0x10cf20['id']),console['log'](_0xa750e1(0x198)+_0x10cf20['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0xa750e1(0x104)]+_0xa750e1(0x1db));}catch(_0x1cef42){console[_0xa750e1(0x19b)](_0xa750e1(0x107)+_0x10cf20['id']+':',_0x1cef42),this[_0xa750e1(0x156)](_0x10cf20['id'],_0x10cf20['gatewayPaymentId']||_0xa750e1(0x1a0),_0x1cef42,_0xa750e1(0xf7),{'reason':_0xa750e1(0x1bc),'createdAt':_0x10cf20['createdAt'],'daysSinceCreation':Math[_0xa750e1(0x10a)]((Date[_0xa750e1(0x199)]()-_0x10cf20[_0xa750e1(0x1cf)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x2a867c;}async[a40_0xf1431f(0xdc)](_0x495b58){const _0x67be70=a40_0xf1431f;if(!_0x495b58['gatewayPaymentId']){console[_0x67be70(0x175)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x495b58['id']+_0x67be70(0x1d7));return;}console[_0x67be70(0x175)](_0x67be70(0x18c)+_0x495b58['gateway']+_0x67be70(0x16b)+_0x495b58['id']+'\x20('+_0x495b58['gatewayPaymentId']+')');try{let _0x1ed5fb;_0x495b58[_0x67be70(0x1c8)]===_0x67be70(0x162)?(_0x1ed5fb=await this['coinToPay2Service'][_0x67be70(0x11a)](_0x495b58['gatewayPaymentId']),console[_0x67be70(0x175)](_0x67be70(0xda)+_0x495b58['id']+_0x67be70(0x1a4)+_0x1ed5fb[_0x67be70(0x11b)])):(_0x1ed5fb=await this[_0x67be70(0x186)][_0x67be70(0x11a)](_0x495b58[_0x67be70(0x155)]),console[_0x67be70(0x175)]('üìä\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x495b58['id']+'\x20status:\x20'+_0x1ed5fb['status']));_0x1ed5fb[_0x67be70(0x128)]&&console['log'](_0x67be70(0x10f)+_0x495b58['id']+_0x67be70(0xd8),{'iban':_0x1ed5fb['paymentDetails'][_0x67be70(0xd6)]||_0x67be70(0x114),'transactionId':_0x1ed5fb['paymentDetails']['transactionId'],'createdOn':_0x1ed5fb[_0x67be70(0x128)][_0x67be70(0xee)],'confirmedOn':_0x1ed5fb[_0x67be70(0x128)][_0x67be70(0xcd)]||'not\x20confirmed'});if(_0x1ed5fb[_0x67be70(0x11b)]!==_0x495b58[_0x67be70(0x11b)]){console['log'](_0x67be70(0x10c)+_0x495b58['id']+_0x67be70(0x1b6)+_0x495b58[_0x67be70(0x11b)]+_0x67be70(0x11c)+_0x1ed5fb[_0x67be70(0x11b)]),this[_0x67be70(0xcc)](_0x495b58['id'],_0x495b58[_0x67be70(0x155)],_0x495b58[_0x67be70(0x11b)],_0x1ed5fb['status'],_0x67be70(0x1e0),{'paymentDetails':_0x1ed5fb['paymentDetails'],'amount':_0x1ed5fb['amount'],'currency':_0x1ed5fb[_0x67be70(0x111)],'shopId':_0x495b58[_0x67be70(0x14f)],'checkTimestamp':new Date()[_0x67be70(0x167)]()});const _0x4ecb5f={'status':_0x1ed5fb[_0x67be70(0x11b)],'updatedAt':new Date()};if(_0x1ed5fb[_0x67be70(0x11b)]===_0x67be70(0x14c)&&_0x495b58['status']!==_0x67be70(0x14c)){_0x4ecb5f[_0x67be70(0x158)]=new Date();if(!_0x495b58[_0x67be70(0x109)]){const _0x13da62=await currencyService_1[_0x67be70(0xeb)][_0x67be70(0xf9)](_0x495b58['amount'],_0x495b58[_0x67be70(0x111)]);_0x4ecb5f[_0x67be70(0x109)]=_0x13da62;const _0x42f62b=await this[_0x67be70(0x108)](_0x495b58[_0x67be70(0x14f)],_0x495b58[_0x67be70(0x1c8)]),_0x231c1a=_0x13da62*(0x1-_0x42f62b/0x64);_0x4ecb5f[_0x67be70(0x14e)]=_0x231c1a,_0x4ecb5f[_0x67be70(0x184)]=_0x42f62b,console['log'](_0x67be70(0x1de)+_0x495b58['id']+_0x67be70(0x1e4)),console[_0x67be70(0x175)](_0x67be70(0x1d8)+_0x495b58[_0x67be70(0x1af)]+'\x20'+_0x495b58[_0x67be70(0x111)]+'\x20->\x20'+_0x13da62[_0x67be70(0xf8)](0x6)+'\x20USDT'),console[_0x67be70(0x175)](_0x67be70(0x1b0)+_0x495b58[_0x67be70(0x1c8)]+'\x20commission:\x20'+_0x42f62b+'%'),console[_0x67be70(0x175)](_0x67be70(0x116)+_0x231c1a['toFixed'](0x6)+_0x67be70(0xd0));}console[_0x67be70(0x175)](_0x67be70(0x1de)+_0x495b58['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x4ecb5f['paidAt'][_0x67be70(0x167)]());}if(_0x1ed5fb['paymentDetails']){const _0x546484=_0x1ed5fb['paymentDetails'];_0x546484[_0x67be70(0xd6)]&&(_0x4ecb5f['remitterIban']=_0x546484[_0x67be70(0xd6)],console[_0x67be70(0x175)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x546484[_0x67be70(0xd6)]));if(_0x546484[_0x67be70(0x16c)]){const _0x538896=_0x495b58[_0x67be70(0xfa)]||'',_0x3cdc58=_0x67be70(0x145)+_0x546484[_0x67be70(0x16c)];_0x4ecb5f[_0x67be70(0xfa)]=_0x538896?_0x538896+'\x0a\x0a'+_0x3cdc58:_0x3cdc58,console[_0x67be70(0x175)](_0x67be70(0x1a7));}_0x546484[_0x67be70(0xe5)]&&console[_0x67be70(0x175)]('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x546484[_0x67be70(0xe5)]),_0x546484[_0x67be70(0xcd)]&&console[_0x67be70(0x175)](_0x67be70(0x121)+_0x546484[_0x67be70(0xcd)]);}await database_1[_0x67be70(0x102)][_0x67be70(0x16e)][_0x67be70(0x12d)]({'where':{'id':_0x495b58['id']},'data':_0x4ecb5f});if(_0x1ed5fb['status']===_0x67be70(0x14c)&&_0x495b58[_0x67be70(0x11b)]!=='PAID'){console[_0x67be70(0x175)](_0x67be70(0x15e)+_0x495b58['id']+_0x67be70(0x112));const _0x1e9e51=await database_1['default'][_0x67be70(0x16e)]['findUnique']({'where':{'id':_0x495b58['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x1e9e51?.[_0x67be70(0x15d)]&&_0x1e9e51[_0x67be70(0x123)])try{const _0x16bbd3=_0x1e9e51[_0x67be70(0x123)];console['log'](_0x67be70(0x12b)+_0x16bbd3['id']+_0x67be70(0xf4)+_0x16bbd3['type']+_0x67be70(0x153)+_0x16bbd3[_0x67be70(0xdf)]+_0x67be70(0x130)+_0x16bbd3[_0x67be70(0x11b)]);const _0x5da4d7=_0x16bbd3[_0x67be70(0xdf)]+0x1,_0x18350e=_0x16bbd3[_0x67be70(0x1d1)]===_0x67be70(0x188)?_0x67be70(0x1c9):_0x16bbd3[_0x67be70(0x11b)];await database_1['default'][_0x67be70(0x123)][_0x67be70(0x12d)]({'where':{'id':_0x16bbd3['id']},'data':{'currentPayments':_0x5da4d7,'status':_0x18350e,'updatedAt':new Date()}}),console[_0x67be70(0x175)](_0x67be70(0x127)+_0x16bbd3['id']+'\x20updated:\x20currentPayments='+_0x16bbd3['currentPayments']+'\x20->\x20'+_0x5da4d7+_0x67be70(0x130)+_0x16bbd3[_0x67be70(0x11b)]+_0x67be70(0x1a8)+_0x18350e);}catch(_0x33aa54){console['error'](_0x67be70(0x1cc),_0x33aa54);}else console[_0x67be70(0x175)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x495b58['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x67be70(0x102)]['webhookLog'][_0x67be70(0x11f)]({'data':{'paymentId':_0x495b58['id'],'shopId':_0x495b58[_0x67be70(0x14f)],'event':_0x67be70(0x133)+_0x1ed5fb['status'][_0x67be70(0x18b)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x495b58['status'],'newStatus':_0x1ed5fb[_0x67be70(0x11b)],'paymentDetails':_0x1ed5fb[_0x67be70(0x128)],'checkedAt':new Date()[_0x67be70(0x167)]()})}}),await this[_0x67be70(0x1d4)](_0x495b58,_0x1ed5fb[_0x67be70(0x11b)]),await this[_0x67be70(0x193)](_0x495b58,_0x1ed5fb[_0x67be70(0x11b)]),_0x1ed5fb['status']!==_0x67be70(0x13b)&&(console[_0x67be70(0x175)](_0x67be70(0x12e)+_0x495b58['id']+_0x67be70(0xf0)+_0x1ed5fb[_0x67be70(0x11b)]+_0x67be70(0x129)),this[_0x67be70(0x13c)](_0x495b58['id'])),console[_0x67be70(0x175)](_0x67be70(0x1a1)+_0x495b58['id']+_0x67be70(0x1ae));}else console[_0x67be70(0x175)](_0x67be70(0x10f)+_0x495b58['id']+_0x67be70(0xcf)+_0x1ed5fb[_0x67be70(0x11b)]+')'),this['logCoinToPayStatus'](_0x495b58['id'],_0x495b58[_0x67be70(0x155)],_0x495b58[_0x67be70(0x11b)],_0x1ed5fb[_0x67be70(0x11b)],_0x67be70(0x1e0),{'statusUnchanged':!![],'paymentDetails':_0x1ed5fb[_0x67be70(0x128)],'amount':_0x1ed5fb['amount'],'currency':_0x1ed5fb['currency'],'shopId':_0x495b58['shopId'],'checkTimestamp':new Date()['toISOString']()});}catch(_0x2a9d18){console['error'](_0x67be70(0x1aa)+_0x495b58['id']+':',_0x2a9d18),this[_0x67be70(0x156)](_0x495b58['id'],_0x495b58[_0x67be70(0x155)],_0x2a9d18,'status_check',{'paymentAmount':_0x495b58['amount'],'paymentCurrency':_0x495b58[_0x67be70(0x111)],'shopId':_0x495b58['shopId'],'createdAt':_0x495b58[_0x67be70(0x1cf)]}),await database_1[_0x67be70(0x102)][_0x67be70(0xe0)][_0x67be70(0x11f)]({'data':{'paymentId':_0x495b58['id'],'shopId':_0x495b58[_0x67be70(0x14f)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x67be70(0x125)]({'error':_0x2a9d18 instanceof Error?_0x2a9d18[_0x67be70(0x12f)]:_0x67be70(0x13e),'gatewayPaymentId':_0x495b58['gatewayPaymentId'],'checkedAt':new Date()[_0x67be70(0x167)]()})}});}}async[a40_0xf1431f(0x1d4)](_0x19c0d0,_0x3695b0){const _0x44e861=a40_0xf1431f,_0xcc17cd=Date[_0x44e861(0x199)]();try{const _0x2f5a83=_0x19c0d0[_0x44e861(0x1b4)],_0x59d109=_0x2f5a83['settings'];if(!_0x59d109?.[_0x44e861(0x13f)]){console[_0x44e861(0x175)](_0x44e861(0x137)+_0x2f5a83['id']);return;}const _0x496fa7=_0x3695b0===_0x44e861(0x14c)?_0x44e861(0x136):_0x3695b0===_0x44e861(0x1c7)?_0x44e861(0x189):_0x3695b0===_0x44e861(0xd3)?_0x44e861(0x189):_0x44e861(0x1d6);if(!_0x59d109[_0x44e861(0x1c1)]?.[_0x44e861(0x110)](_0x496fa7)){console['log'](_0x44e861(0x1ab)+_0x496fa7+_0x44e861(0x168)+_0x2f5a83['id']);return;}const _0x136dd0=(0x0,gateway_1[_0x44e861(0x147)])(_0x19c0d0[_0x44e861(0x1c8)])||_0x19c0d0[_0x44e861(0x1c8)],_0xc1e19={'event':_0x496fa7,'payment':{'id':_0x19c0d0['id'],'order_id':_0x19c0d0[_0x44e861(0xff)],'gateway_order_id':_0x19c0d0[_0x44e861(0xe6)],'gateway':_0x136dd0,'amount':_0x19c0d0[_0x44e861(0x1af)],'currency':_0x19c0d0['currency'],'status':_0x3695b0['toLowerCase'](),'customer_email':_0x19c0d0[_0x44e861(0x138)],'customer_name':_0x19c0d0[_0x44e861(0x1d2)],'created_at':_0x19c0d0[_0x44e861(0x1cf)],'updated_at':new Date()}},_0x8f3c06=await fetch(_0x59d109[_0x44e861(0x13f)],{'method':_0x44e861(0x18d),'headers':{'Content-Type':_0x44e861(0x182),'User-Agent':_0x44e861(0x1a9)},'body':JSON[_0x44e861(0x125)](_0xc1e19)}),_0x4ee23e=Date[_0x44e861(0x199)]()-_0xcc17cd,_0x161494=_0x8f3c06['ok']?_0x44e861(0x1ce):await _0x8f3c06[_0x44e861(0x1b9)]();loggerService_1[_0x44e861(0x17f)][_0x44e861(0x15f)](_0x19c0d0[_0x44e861(0x14f)],_0x59d109[_0x44e861(0x13f)],_0x496fa7,_0x8f3c06['status'],_0x4ee23e,_0xc1e19),console[_0x44e861(0x175)](_0x44e861(0x159)+_0x59d109[_0x44e861(0x13f)]+_0x44e861(0x1dd)+_0x8f3c06[_0x44e861(0x11b)]+'\x20('+_0x4ee23e+'ms)');}catch(_0x2c15ef){console[_0x44e861(0x19b)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x2c15ef),loggerService_1[_0x44e861(0x17f)][_0x44e861(0xca)](_0x19c0d0[_0x44e861(0x14f)],_0x19c0d0['shop']?.[_0x44e861(0xfe)]?.[_0x44e861(0x13f)]||_0x44e861(0x1a0),_0x44e861(0x1b8),_0x2c15ef,{});}}async['sendPaymentStatusNotification'](_0x3516af,_0x3c0c21){const _0x316184=a40_0xf1431f;try{const _0x1bf241={'PENDING':'created','PAID':_0x316184(0x126),'FAILED':_0x316184(0x1ac),'EXPIRED':_0x316184(0x19c)},_0x400f37=_0x1bf241[_0x3c0c21];if(!_0x400f37||_0x400f37===_0x316184(0xe1))return;await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x3516af[_0x316184(0x14f)],_0x3516af,_0x400f37);}catch(_0x27f083){console['error'](_0x316184(0x151),_0x27f083);}}async[a40_0xf1431f(0x183)](_0x382e35){const _0x4c24d3=a40_0xf1431f;console[_0x4c24d3(0x175)](_0x4c24d3(0x139)+_0x382e35);const _0x5c6dfc=await database_1[_0x4c24d3(0x102)]['payment']['findUnique']({'where':{'id':_0x382e35},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x5c6dfc)throw new Error(_0x4c24d3(0x113));if(_0x5c6dfc[_0x4c24d3(0x1c8)]!==_0x4c24d3(0x1d5)&&_0x5c6dfc[_0x4c24d3(0x1c8)]!==_0x4c24d3(0x162))throw new Error(_0x4c24d3(0x16a));console[_0x4c24d3(0x175)]('‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x5c6dfc[_0x4c24d3(0x1c8)]+_0x4c24d3(0x16b)+_0x382e35),await this[_0x4c24d3(0xdc)](_0x5c6dfc),console['log'](_0x4c24d3(0x13d)+_0x382e35);}['getServiceStats'](){const _0x24d30e=a40_0xf1431f,_0xd9646c=this['globalCheckInterval']?this[_0x24d30e(0x122)]:undefined,_0x96ec4f=Array[_0x24d30e(0xfc)](this[_0x24d30e(0x17c)][_0x24d30e(0x14d)]())['map'](_0x2a55ea=>({'paymentId':_0x2a55ea[_0x24d30e(0x18a)],'gatewayPaymentId':_0x2a55ea[_0x24d30e(0x155)],'createdAt':_0x2a55ea[_0x24d30e(0x1cf)],'timersCount':_0x2a55ea[_0x24d30e(0x103)][_0x24d30e(0x18e)]}));return{'isActive':!!this[_0x24d30e(0x190)],'globalCheckIntervalMinutes':this[_0x24d30e(0x122)]/(0x3e8*0x3c),'expiryDays':this[_0x24d30e(0x104)],'activeIndividualTimers':this[_0x24d30e(0x17c)]['size'],'nextGlobalCheckIn':_0xd9646c,'paymentTimersDetails':_0x96ec4f};}[a40_0xf1431f(0x1da)](_0x1704be){const _0x1a93e9=a40_0xf1431f,_0x2f8428=this[_0x1a93e9(0x17c)][_0x1a93e9(0xed)](_0x1704be);if(_0x2f8428)return{'hasTimers':!![],'timersCount':_0x2f8428[_0x1a93e9(0x103)]['length'],'createdAt':_0x2f8428[_0x1a93e9(0x1cf)],'gatewayPaymentId':_0x2f8428[_0x1a93e9(0x155)]};return{'hasTimers':![]};}async[a40_0xf1431f(0x108)](_0x2764e9,_0x416829){const _0x579e34=a40_0xf1431f;try{const _0x5e5848=await database_1['default'][_0x579e34(0x1b4)][_0x579e34(0x1bd)]({'where':{'id':_0x2764e9},'select':{'gatewaySettings':!![]}});if(!_0x5e5848?.[_0x579e34(0xf2)])return console[_0x579e34(0x175)]('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0x2764e9+_0x579e34(0xdb)),0xa;const _0x45e954=JSON['parse'](_0x5e5848[_0x579e34(0xf2)]);for(const [_0x280188,_0x437182]of Object[_0x579e34(0x143)](_0x45e954)){if(_0x280188[_0x579e34(0x18b)]()===_0x416829['toLowerCase']()){const _0x559f71=_0x437182[_0x579e34(0x15c)]||0xa;return console[_0x579e34(0x175)]('Gateway\x20'+_0x416829+'\x20commission\x20for\x20shop\x20'+_0x2764e9+':\x20'+_0x559f71+'%'),_0x559f71;}}return console[_0x579e34(0x175)](_0x579e34(0x150)+_0x416829+_0x579e34(0x148)+_0x2764e9+',\x20using\x20default\x2010%'),0xa;}catch(_0x44a2ff){return console['error'](_0x579e34(0xde)+_0x2764e9+_0x579e34(0x161)+_0x416829+':',_0x44a2ff),0xa;}}}function a40_0x5771(_0x3624c1,_0x449547){const _0x5617d9=a40_0x5617();return a40_0x5771=function(_0x5771cf,_0x3a4cc6){_0x5771cf=_0x5771cf-0xc9;let _0x27072a=_0x5617d9[_0x5771cf];return _0x27072a;},a40_0x5771(_0x3624c1,_0x449547);}exports[a40_0xf1431f(0xd2)]=CoinToPayStatusService,exports[a40_0xf1431f(0x13a)]=new CoinToPayStatusService();