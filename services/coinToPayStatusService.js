'use strict';const a40_0x4499f0=a40_0xfd3a;(function(_0x32deb9,_0x22cba0){const _0x142b18=a40_0xfd3a,_0x15f38e=_0x32deb9();while(!![]){try{const _0x5cca14=parseInt(_0x142b18(0x118))/0x1+-parseInt(_0x142b18(0xd7))/0x2+parseInt(_0x142b18(0x17b))/0x3+-parseInt(_0x142b18(0xbc))/0x4+-parseInt(_0x142b18(0x1ad))/0x5+parseInt(_0x142b18(0x186))/0x6+-parseInt(_0x142b18(0x16b))/0x7*(-parseInt(_0x142b18(0x134))/0x8);if(_0x5cca14===_0x22cba0)break;else _0x15f38e['push'](_0x15f38e['shift']());}catch(_0x151c33){_0x15f38e['push'](_0x15f38e['shift']());}}}(a40_0x2ea2,0xbc74d));var __importDefault=this&&this[a40_0x4499f0(0x188)]||function(_0x4bf782){const _0xbbed7d=a40_0x4499f0;return _0x4bf782&&_0x4bf782[_0xbbed7d(0x11a)]?_0x4bf782:{'default':_0x4bf782};};Object[a40_0x4499f0(0xfb)](exports,'__esModule',{'value':!![]}),exports[a40_0x4499f0(0x11f)]=exports[a40_0x4499f0(0x189)]=void 0x0;function a40_0x2ea2(){const _0x1d7742=['\x20\x20\x20📝\x20Context:','payment.failed','type','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','PENDING','length','⏰\x20[HOURLY]\x20Payment\x20','getGatewayIdByName','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','shop','payment.success','bankDetails',',\x20using\x20default\x20commission\x2010%','✅\x20[HOURLY]\x20Payment\x20','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','checkExpiredPayments','getDate','\x20\x20\x20-\x20gatewayPaymentId:\x20','52928eDihnG','\x20for\x20payment\x20','\x20pending\x20CoinToPay\x20payments','expired','\x20\x20\x20📅\x20Time:\x20','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','CoinToPay2Service','\x20not\x20enabled\x20for\x20shop\x20','🔄\x20[CHECK]\x20Updating\x20payment\x20','\x20\x20\x20📍\x20Source:\x20','\x20status\x20from\x20',':\x20type=','Success','./gateways/coinToPay2Service','paymentLinkId','logShopWebhookError','cointopay_status_check_','\x20payment\x20','\x20with\x20status\x20','Gateway\x20','🪙\x20[GLOBAL]\x20Found\x20','default','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','not\x20found','logWhiteDomainError','\x20\x20\x20Amount:\x20','cointopay_status_check_error','sendPaymentStatusNotification',',\x20using\x20default\x2010%','\x20\x20\x20-\x20paymentId:\x20','stringify','checkSinglePayment',',\x20gateway\x20','\x20in\x20','gatewayPaymentId','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','gateway','includes','currentPayments','EXPIRY_DAYS','toFixed','error','./gateways/coinToPayService','sendShopWebhook','Payment\x20not\x20found','stopPeriodicStatusCheck','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','\x20individual\x20payment\x20timers','log','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20timers\x20for\x20payment\x20','🧹\x20[DEBUG]\x20Clearing\x20','EXPIRED','COMPLETED','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','3423xbaKfb','currency','⚠️\x20[CHECK]\x20Payment\x20','\x20expired','commission','now','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20updated\x20successfully','convertToUSDT','\x20days\x20(created\x20before\x20','paymentLink','\x20status\x20is\x20','gatewaySettings','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','571074SMudtF','🪙\x20[DEBUG]\x20Creating\x20','set','logCoinToPayStatus','delete','✅\x20[EXPIRY]\x20Payment\x20','auto_expire','has','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','-day\x20timeout','toLowerCase','1289958ggbbIQ','payment','__importDefault','CoinToPayStatusService','timers','entries',',\x20stopping\x20individual\x20checks','getServiceStats','\x20status\x20unchanged\x20(','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','message','findMany','push','toISOString','\x20->\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20skipped,\x20','checkAllPendingPayments','\x20is\x20valid\x20for\x20checking,\x20proceeding...','💰\x20[CHECK]\x20Payment\x20','\x20status\x20changed\x20to\x20','checkPaymentById','checkPaymentStatus','status','❌\x20[HOURLY]\x20Payment\x20','⏰\x20[EXPIRY]\x20Payment\x20','cointopay2','map','./telegramBotService','\x20current\x20status:\x20','.\x20Remaining\x20active\x20timers:\x20','clearPaymentTimers','update','ms)','\x20commission:\x20','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','../config/database','📊\x20[HOURLY]\x20Payment\x20','4017745ahrxBm','create','forEach','catch','Automatically\x20expired\x20after\x20','\x20not\x20found,\x20clearing\x20timers','sendPaymentNotification','\x20USDT','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','\x20days,\x20marking\x20as\x20EXPIRED','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','1\x20minute','\x20to\x20clear','\x20details:','\x20status:\x20','coinToPay2Service','not\x20confirmed','cointopay','\x20(after\x20','findUnique','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','SINGLE','5700876PJLbow','shopId','customerEmail','🛑\x20[SHUTDOWN]\x20Cleared\x20','\x20found:','unknown','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20commission\x20for\x20shop\x20','status_check','coinToPayService','\x20\x20\x20-\x20Amount:\x20','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','globalCheckInterval','confirmedOn','loggerService','h),\x20skipping\x20global\x20check','failed','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','COINTOPAY_ERROR','⏰\x20[GLOBAL]\x20Payment\x20','\x20completed\x20for\x20payment\x20','webhookUrl','\x20days','COINTOPAY_STATUS_CHANGE',',\x20clearing\x20individual\x20timers','\x20triggered\x20for\x20payment\x20','2092266cERRSa','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','5\x20minutes','paymentTimers','✅\x20[CHECK]\x20Payment\x20','\x20updated:\x20currentPayments=','FAILED','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','transactionId','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','startPeriodicStatusCheck','floor','remitterIban','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20\x20\x20📝\x20Details:','GLOBAL_CHECK_INTERVAL_MS','amountUSDT','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','Failed\x20to\x20send\x20shop\x20webhook:','text','Bank\x20Details:\x20','gatewayOrderId','\x20in\x20shop\x20','CoinToPayService','\x20not\x20found\x20in\x20database','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','orderId','customerName','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','description','adminNotes','⏰\x20[GLOBAL]\x20Found\x20','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','timestamp','schedulePaymentChecks','settings','defineProperty','amount','🔍\x20[CHECK]\x20Checking\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','logCoinToPayError','telegramBotService','payment.pending','\x20expired\x20CoinToPay\x20payments','Payment\x20older\x20than\x20','webhookLog','PAID','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','currencyService','❌\x20[CHECK]\x20Payment\x20','createdAt','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','iban','get','from','📈\x20[COINTOPAY]\x20Payment\x20','🪙\x20[TIMER]\x20Individual\x20check\x20#','📊\x20[CHECK]\x20Payment\x20','size','\x20has\x20no\x20gatewayPaymentId','✅\x20[TIMER]\x20Individual\x20check\x20#','setDate','values','checkSinglePaymentById','\x20amounts\x20calculated:','406243JdqsdB','\x20seconds\x20(','__esModule','paymentDetails','Unknown\x20error','\x20\x20\x20❌\x20Error:\x20','✅\x20[COINTOPAY]\x20Payment\x20link\x20','coinToPayStatusService','Webhook\x20event\x20','getTime'];a40_0x2ea2=function(){return _0x1d7742;};return a40_0x2ea2();}function a40_0xfd3a(_0x4eb3ba,_0x3aa952){const _0x2ea22e=a40_0x2ea2();return a40_0xfd3a=function(_0xfd3ae9,_0x22f346){_0xfd3ae9=_0xfd3ae9-0xb1;let _0x3e544e=_0x2ea22e[_0xfd3ae9];return _0x3e544e;},a40_0xfd3a(_0x4eb3ba,_0x3aa952);}const coinToPayService_1=require(a40_0x4499f0(0x15e)),coinToPay2Service_1=require(a40_0x4499f0(0x141)),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a40_0x4499f0(0x1ab))),telegramBotService_1=require(a40_0x4499f0(0x1a3)),loggerService_1=require('./loggerService'),currencyService_1=require('./currencyService');class CoinToPayStatusService{constructor(){const _0x84eb15=a40_0x4499f0;this['globalCheckInterval']=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x84eb15(0x15b)]=0x5,this['paymentTimers']=new Map(),this[_0x84eb15(0xc5)]=new coinToPayService_1[(_0x84eb15(0xee))](),this[_0x84eb15(0xb5)]=new coinToPay2Service_1[(_0x84eb15(0x13a))](),console[_0x84eb15(0x164)](_0x84eb15(0x173));}[a40_0x4499f0(0xf9)](_0x2ac63b,_0x4d1a1f){const _0x39a2c9=a40_0x4499f0;console[_0x39a2c9(0x164)]('🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console['log'](_0x39a2c9(0x151)+_0x2ac63b),console[_0x39a2c9(0x164)](_0x39a2c9(0x133)+_0x4d1a1f),this[_0x39a2c9(0x1a6)](_0x2ac63b);const _0x555a01=[],_0x5d3ddb=new Date(),_0x32e3e2=[{'delay':0x1*0x3c*0x3e8,'description':_0x39a2c9(0xb1)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x39a2c9(0xd9)},{'delay':0x5*0x3c*0x3e8,'description':_0x39a2c9(0xd9)}];console[_0x39a2c9(0x164)](_0x39a2c9(0x17c)+_0x32e3e2[_0x39a2c9(0x127)]+'\x20initial\x20timers\x20for\x20payment\x20'+_0x2ac63b);let _0x40bc54=0x0;_0x32e3e2['forEach']((_0x565a58,_0x49c59e)=>{const _0x42ab7e=_0x39a2c9;_0x40bc54+=_0x565a58['delay'];const _0x14a0b9=setTimeout(async()=>{const _0x37a472=a40_0xfd3a;console[_0x37a472(0x164)](_0x37a472(0x10f)+(_0x49c59e+0x1)+_0x37a472(0xd6)+_0x2ac63b+_0x37a472(0xb8)+_0x565a58['description']+')');try{await this[_0x37a472(0x116)](_0x2ac63b),console[_0x37a472(0x164)](_0x37a472(0x113)+(_0x49c59e+0x1)+_0x37a472(0xd1)+_0x2ac63b);}catch(_0x224995){console['error'](_0x37a472(0xc7)+(_0x49c59e+0x1)+'\x20for\x20payment\x20'+_0x2ac63b+':',_0x224995),this['logCoinToPayError'](_0x2ac63b,_0x4d1a1f,_0x224995,_0x37a472(0xc4),{'checkNumber':_0x49c59e+0x1,'scheduledAfter':_0x565a58['description'],'isIndividualCheck':!![]});}},_0x40bc54);_0x555a01['push'](_0x14a0b9),console[_0x42ab7e(0x164)](_0x42ab7e(0x1aa)+(_0x49c59e+0x1)+_0x42ab7e(0x135)+_0x2ac63b+_0x42ab7e(0x155)+_0x40bc54/0x3e8+_0x42ab7e(0x119)+_0x565a58[_0x42ab7e(0xf4)]+')');});const _0x2e887d=setInterval(async()=>{const _0x32bb54=_0x39a2c9;console[_0x32bb54(0x164)]('🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x2ac63b);try{const _0xb2a15c=await database_1[_0x32bb54(0x149)][_0x32bb54(0x187)][_0x32bb54(0xb9)]({'where':{'id':_0x2ac63b},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0xb2a15c){console['log'](_0x32bb54(0x19f)+_0x2ac63b+_0x32bb54(0x1b2)),this[_0x32bb54(0x1a6)](_0x2ac63b);return;}console[_0x32bb54(0x164)](_0x32bb54(0x1ac)+_0x2ac63b+_0x32bb54(0x1a4)+_0xb2a15c[_0x32bb54(0x19e)]);if(_0xb2a15c[_0x32bb54(0x19e)]!=='PENDING'){console[_0x32bb54(0x164)](_0x32bb54(0x12f)+_0x2ac63b+_0x32bb54(0x178)+_0xb2a15c['status']+_0x32bb54(0x18c)),this['clearPaymentTimers'](_0x2ac63b);return;}const _0x47fb6b=Math['floor']((Date[_0x32bb54(0x170)]()-_0xb2a15c[_0x32bb54(0x109)][_0x32bb54(0x121)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x47fb6b>=this[_0x32bb54(0x15b)]){console[_0x32bb54(0x164)](_0x32bb54(0x128)+_0x2ac63b+'\x20is\x20older\x20than\x20'+this[_0x32bb54(0x15b)]+_0x32bb54(0x190)),this[_0x32bb54(0x1a6)](_0x2ac63b);return;}await this['checkSinglePaymentById'](_0x2ac63b),console[_0x32bb54(0x164)](_0x32bb54(0x10a)+_0x2ac63b);}catch(_0x5ae20b){console[_0x32bb54(0x15d)](_0x32bb54(0x125)+_0x2ac63b+':',_0x5ae20b),this[_0x32bb54(0xff)](_0x2ac63b,_0x4d1a1f,_0x5ae20b,_0x32bb54(0xc4),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x555a01['push'](_0x2e887d),this['paymentTimers'][_0x39a2c9(0x17d)](_0x2ac63b,{'timers':_0x555a01,'paymentId':_0x2ac63b,'gatewayPaymentId':_0x4d1a1f,'createdAt':_0x5d3ddb}),console[_0x39a2c9(0x164)](_0x39a2c9(0x16a)+_0x32e3e2['length']+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x2ac63b),console[_0x39a2c9(0x164)]('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x39a2c9(0xda)][_0x39a2c9(0x111)]),this[_0x39a2c9(0x17e)](_0x2ac63b,_0x4d1a1f,_0x39a2c9(0x126),_0x39a2c9(0x126),_0x39a2c9(0xc4),{'action':'schedule_created','scheduledChecks':_0x32e3e2[_0x39a2c9(0x127)],'firstCheckIn':_0x32e3e2[0x0]['delay']/0x3e8,'totalTimers':this[_0x39a2c9(0xda)]['size']});}[a40_0x4499f0(0x1a6)](_0x3dcf64){const _0xf395e9=a40_0x4499f0,_0x5b9f95=this[_0xf395e9(0xda)][_0xf395e9(0x10c)](_0x3dcf64);_0x5b9f95?(console['log'](_0xf395e9(0x167)+_0x5b9f95[_0xf395e9(0x18a)]['length']+_0xf395e9(0x166)+_0x3dcf64),_0x5b9f95[_0xf395e9(0x18a)][_0xf395e9(0x1af)]((_0x4e1097,_0xacb56c)=>{const _0x22fa3b=_0xf395e9;_0x4e1097&&(clearTimeout(_0x4e1097),clearInterval(_0x4e1097),console['log']('🧹\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0xacb56c+0x1)+_0x22fa3b(0x135)+_0x3dcf64));}),this[_0xf395e9(0xda)][_0xf395e9(0x17f)](_0x3dcf64),console['log'](_0xf395e9(0xe4)+_0x3dcf64+_0xf395e9(0x1a5)+this[_0xf395e9(0xda)][_0xf395e9(0x111)])):console['log'](_0xf395e9(0x14a)+_0x3dcf64+_0xf395e9(0xb2));}async['checkSinglePaymentById'](_0x2bb9f1){const _0x432dc2=a40_0x4499f0;console[_0x432dc2(0x164)](_0x432dc2(0xf3)+_0x2bb9f1);const _0x166e68=await database_1[_0x432dc2(0x149)][_0x432dc2(0x187)][_0x432dc2(0xb9)]({'where':{'id':_0x2bb9f1},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x166e68){console['log'](_0x432dc2(0x108)+_0x2bb9f1+_0x432dc2(0xef));return;}console[_0x432dc2(0x164)](_0x432dc2(0x110)+_0x2bb9f1+_0x432dc2(0xc0)),console[_0x432dc2(0x164)]('\x20\x20\x20-\x20Gateway:\x20'+_0x166e68['gateway']),console[_0x432dc2(0x164)]('\x20\x20\x20-\x20Status:\x20'+_0x166e68[_0x432dc2(0x19e)]),console[_0x432dc2(0x164)](_0x432dc2(0xc2)+_0x166e68[_0x432dc2(0x156)]),console[_0x432dc2(0x164)](_0x432dc2(0xc6)+_0x166e68[_0x432dc2(0xfc)]+'\x20'+_0x166e68[_0x432dc2(0x16c)]),console['log']('\x20\x20\x20-\x20ShopId:\x20'+_0x166e68[_0x432dc2(0xbd)]);if(_0x166e68['gateway']!==_0x432dc2(0xb7)&&_0x166e68['gateway']!==_0x432dc2(0x1a1)){console[_0x432dc2(0x164)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x2bb9f1+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x166e68['gateway']+')');return;}if(_0x166e68[_0x432dc2(0x19e)]!==_0x432dc2(0x126)){console[_0x432dc2(0x164)](_0x432dc2(0x16d)+_0x2bb9f1+_0x432dc2(0x178)+_0x166e68[_0x432dc2(0x19e)]+',\x20stopping\x20individual\x20checks'),this[_0x432dc2(0x1a6)](_0x2bb9f1);return;}if(!_0x166e68['gatewayPaymentId']){console[_0x432dc2(0x164)](_0x432dc2(0x16d)+_0x2bb9f1+_0x432dc2(0x112));return;}console[_0x432dc2(0x164)](_0x432dc2(0xdb)+_0x2bb9f1+_0x432dc2(0x199)),await this[_0x432dc2(0x153)](_0x166e68);}[a40_0x4499f0(0x17e)](_0x15499c,_0xfe3f82,_0x369077,_0x24b116,_0x263cb6,_0x351529){const _0x1d8fa5=a40_0x4499f0,_0x5acbbe={'type':_0x1d8fa5(0xd4),'paymentId':_0x15499c,'gatewayPaymentId':_0xfe3f82,'oldStatus':_0x369077,'newStatus':_0x24b116,'source':_0x263cb6,'timestamp':new Date()[_0x1d8fa5(0x194)](),'details':_0x351529||{}};loggerService_1[_0x1d8fa5(0xca)][_0x1d8fa5(0x17e)](_0x5acbbe),console[_0x1d8fa5(0x164)](_0x1d8fa5(0xd8)+_0x15499c+'\x20('+_0xfe3f82+')'),console[_0x1d8fa5(0x164)]('\x20\x20\x20📊\x20Status:\x20'+_0x369077+_0x1d8fa5(0x195)+_0x24b116),console['log'](_0x1d8fa5(0x13d)+_0x263cb6),console[_0x1d8fa5(0x164)](_0x1d8fa5(0x138)+_0x5acbbe[_0x1d8fa5(0xf8)]),_0x351529&&console[_0x1d8fa5(0x164)](_0x1d8fa5(0xe5),_0x351529);}[a40_0x4499f0(0xff)](_0x31de36,_0x519ca7,_0x5df383,_0x16d0a1,_0x228cd7){const _0x35563c=a40_0x4499f0,_0xca282b={'type':_0x35563c(0xcf),'paymentId':_0x31de36,'gatewayPaymentId':_0x519ca7,'error':_0x5df383 instanceof Error?{'message':_0x5df383[_0x35563c(0x191)],'stack':_0x5df383['stack']}:_0x5df383,'source':_0x16d0a1,'timestamp':new Date()[_0x35563c(0x194)](),'context':_0x228cd7||{}};loggerService_1[_0x35563c(0xca)][_0x35563c(0xff)](_0xca282b),console[_0x35563c(0x15d)]('🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x31de36+'\x20('+_0x519ca7+')'),console[_0x35563c(0x15d)](_0x35563c(0x11d)+(_0x5df383 instanceof Error?_0x5df383[_0x35563c(0x191)]:_0x5df383)),console[_0x35563c(0x15d)](_0x35563c(0x13d)+_0x16d0a1),console[_0x35563c(0x15d)](_0x35563c(0x138)+_0xca282b[_0x35563c(0xf8)]),_0x228cd7&&console[_0x35563c(0x15d)](_0x35563c(0x122),_0x228cd7);}[a40_0x4499f0(0xe1)](){const _0x2c0906=a40_0x4499f0;console['log'](_0x2c0906(0x172)),this['checkAllPendingPayments']()[_0x2c0906(0x1b0)](_0x309c5b=>{console['error']('❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x309c5b);}),this[_0x2c0906(0xc8)]=setInterval(async()=>{const _0x211a97=_0x2c0906;try{console[_0x211a97(0x164)]('🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x211a97(0x198)](),console[_0x211a97(0x164)](_0x211a97(0x139));}catch(_0x47f3b2){console[_0x211a97(0x15d)](_0x211a97(0x1b7),_0x47f3b2);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x2c0906(0x164)]('✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a40_0x4499f0(0x161)](){const _0x2a58f2=a40_0x4499f0;console[_0x2a58f2(0x164)](_0x2a58f2(0xf7));this[_0x2a58f2(0xc8)]&&(clearInterval(this[_0x2a58f2(0xc8)]),this[_0x2a58f2(0xc8)]=null,console[_0x2a58f2(0x164)]('🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x5e2e88=this[_0x2a58f2(0xda)][_0x2a58f2(0x111)];for(const [_0x1774e5]of this[_0x2a58f2(0xda)]){this['clearPaymentTimers'](_0x1774e5);}console['log'](_0x2a58f2(0xbf)+_0x5e2e88+_0x2a58f2(0x163));}async[a40_0x4499f0(0x198)](){const _0x293a95=a40_0x4499f0;try{console[_0x293a95(0x164)]('🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x37a667=await database_1[_0x293a95(0x149)][_0x293a95(0x187)][_0x293a95(0x192)]({'where':{'gateway':{'in':[_0x293a95(0xb7),_0x293a95(0x1a1)]},'status':_0x293a95(0x126),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x293a95(0x164)](_0x293a95(0x148)+_0x37a667[_0x293a95(0x127)]+_0x293a95(0x136));if(_0x37a667['length']===0x0){console[_0x293a95(0x164)]('🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x32521b=await this[_0x293a95(0x131)](_0x37a667);console[_0x293a95(0x164)](_0x293a95(0xf6)+_0x32521b[_0x293a95(0x127)]+_0x293a95(0x102));let _0x18a256=0x0,_0x511a80=0x0;for(const _0xbd756f of _0x37a667){try{if(_0x32521b[_0x293a95(0x159)](_0xbd756f['id'])){console[_0x293a95(0x164)](_0x293a95(0xd0)+_0xbd756f['id']+_0x293a95(0xfe)),_0x511a80++;continue;}if(this[_0x293a95(0xda)][_0x293a95(0x182)](_0xbd756f['id'])){console[_0x293a95(0x164)](_0x293a95(0xd0)+_0xbd756f['id']+_0x293a95(0xba)),_0x511a80++;continue;}const _0x983b2e=(Date[_0x293a95(0x170)]()-_0xbd756f[_0x293a95(0x109)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x983b2e<0x1){console['log']('⏰\x20[GLOBAL]\x20Payment\x20'+_0xbd756f['id']+'\x20is\x20too\x20new\x20('+_0x983b2e[_0x293a95(0x15c)](0x1)+_0x293a95(0xcb)),_0x511a80++;continue;}console[_0x293a95(0x164)](_0x293a95(0x183)+_0xbd756f['id']+'\x20(age:\x20'+_0x983b2e[_0x293a95(0x15c)](0x1)+'h)'),await this[_0x293a95(0x153)](_0xbd756f),_0x18a256++,await new Promise(_0x39acb3=>setTimeout(_0x39acb3,0x7d0));}catch(_0x5490df){console['error'](_0x293a95(0xe0)+_0xbd756f['id']+':',_0x5490df),this['logCoinToPayError'](_0xbd756f['id'],_0xbd756f[_0x293a95(0x156)]||_0x293a95(0xc1),_0x5490df,_0x293a95(0xc4),{'isGlobalCheck':!![],'paymentAmount':_0xbd756f[_0x293a95(0xfc)],'paymentCurrency':_0xbd756f[_0x293a95(0x16c)],'shopId':_0xbd756f[_0x293a95(0xbd)],'createdAt':_0xbd756f[_0x293a95(0x109)]}),loggerService_1['loggerService'][_0x293a95(0x14c)](_0x293a95(0xb7),'/status/'+_0xbd756f[_0x293a95(0x156)],_0x5490df);}}console['log'](_0x293a95(0xf0)+_0x18a256+'\x20checked,\x20'+_0x511a80+_0x293a95(0x197)+_0x32521b['length']+_0x293a95(0x16e));}catch(_0x2a421e){console[_0x293a95(0x15d)]('❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x2a421e);}}async[a40_0x4499f0(0x131)](_0x5c357d){const _0x174415=a40_0x4499f0,_0x5a7861=[],_0x5a0fa3=new Date();_0x5a0fa3[_0x174415(0x114)](_0x5a0fa3[_0x174415(0x132)]()-this['EXPIRY_DAYS']),console[_0x174415(0x164)](_0x174415(0x165)+this['EXPIRY_DAYS']+_0x174415(0x176)+_0x5a0fa3[_0x174415(0x194)]()+')');for(const _0x3ab775 of _0x5c357d){if(_0x3ab775['createdAt']<_0x5a0fa3){console['log'](_0x174415(0x1a0)+_0x3ab775['id']+'\x20is\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x174415(0x1b6));try{this[_0x174415(0x17e)](_0x3ab775['id'],_0x3ab775['gatewayPaymentId']||_0x174415(0xc1),_0x174415(0x126),'EXPIRED','auto_expire',{'reason':_0x174415(0x103)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x3ab775[_0x174415(0x109)],'daysSinceCreation':Math['floor']((Date[_0x174415(0x170)]()-_0x3ab775[_0x174415(0x109)]['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x3ab775['amount'],'paymentCurrency':_0x3ab775[_0x174415(0x16c)],'shopId':_0x3ab775[_0x174415(0xbd)]}),await database_1[_0x174415(0x149)][_0x174415(0x187)][_0x174415(0x1a7)]({'where':{'id':_0x3ab775['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':_0x174415(0x1b1)+this['EXPIRY_DAYS']+'\x20days\x20without\x20payment\x20confirmation'}}),await database_1[_0x174415(0x149)][_0x174415(0x104)][_0x174415(0x1ae)]({'data':{'paymentId':_0x3ab775['id'],'shopId':_0x3ab775[_0x174415(0xbd)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x174415(0x152)]({'reason':_0x174415(0x103)+this[_0x174415(0x15b)]+_0x174415(0xd3),'createdAt':_0x3ab775[_0x174415(0x109)],'expiredAt':new Date()[_0x174415(0x194)](),'daysSinceCreation':Math['floor']((Date['now']()-_0x3ab775['createdAt'][_0x174415(0x121)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x174415(0x15f)](_0x3ab775,_0x174415(0x168)),await this['sendPaymentStatusNotification'](_0x3ab775,'EXPIRED'),this['clearPaymentTimers'](_0x3ab775['id']),_0x5a7861[_0x174415(0x193)](_0x3ab775['id']),console['log'](_0x174415(0x180)+_0x3ab775['id']+_0x174415(0xce)+this[_0x174415(0x15b)]+_0x174415(0x184));}catch(_0x32ba63){console[_0x174415(0x15d)]('❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x3ab775['id']+':',_0x32ba63),this[_0x174415(0xff)](_0x3ab775['id'],_0x3ab775[_0x174415(0x156)]||_0x174415(0xc1),_0x32ba63,_0x174415(0x181),{'reason':_0x174415(0x196),'createdAt':_0x3ab775[_0x174415(0x109)],'daysSinceCreation':Math[_0x174415(0xe2)]((Date[_0x174415(0x170)]()-_0x3ab775[_0x174415(0x109)][_0x174415(0x121)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x5a7861;}async['checkSinglePayment'](_0x38d767){const _0x403121=a40_0x4499f0;if(!_0x38d767[_0x403121(0x156)]){console[_0x403121(0x164)](_0x403121(0x16d)+_0x38d767['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x403121(0x164)](_0x403121(0xfd)+_0x38d767[_0x403121(0x158)]+_0x403121(0x145)+_0x38d767['id']+'\x20('+_0x38d767[_0x403121(0x156)]+')');try{let _0x1d27a1;_0x38d767['gateway']===_0x403121(0x1a1)?(_0x1d27a1=await this[_0x403121(0xb5)][_0x403121(0x19d)](_0x38d767[_0x403121(0x156)]),console[_0x403121(0x164)]('📊\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x38d767['id']+_0x403121(0xb4)+_0x1d27a1[_0x403121(0x19e)])):(_0x1d27a1=await this[_0x403121(0xc5)]['checkPaymentStatus'](_0x38d767['gatewayPaymentId']),console['log'](_0x403121(0xcd)+_0x38d767['id']+_0x403121(0xb4)+_0x1d27a1[_0x403121(0x19e)]));_0x1d27a1[_0x403121(0x11b)]&&console[_0x403121(0x164)](_0x403121(0x110)+_0x38d767['id']+_0x403121(0xb3),{'iban':_0x1d27a1[_0x403121(0x11b)]['iban']||_0x403121(0x14b),'transactionId':_0x1d27a1[_0x403121(0x11b)]['transactionId'],'createdOn':_0x1d27a1[_0x403121(0x11b)]['createdOn'],'confirmedOn':_0x1d27a1[_0x403121(0x11b)][_0x403121(0xc9)]||_0x403121(0xb6)});if(_0x1d27a1[_0x403121(0x19e)]!==_0x38d767['status']){console[_0x403121(0x164)](_0x403121(0x13c)+_0x38d767['id']+_0x403121(0x13e)+_0x38d767['status']+'\x20to\x20'+_0x1d27a1[_0x403121(0x19e)]),this[_0x403121(0x17e)](_0x38d767['id'],_0x38d767[_0x403121(0x156)],_0x38d767['status'],_0x1d27a1[_0x403121(0x19e)],_0x403121(0xc4),{'paymentDetails':_0x1d27a1['paymentDetails'],'amount':_0x1d27a1[_0x403121(0xfc)],'currency':_0x1d27a1[_0x403121(0x16c)],'shopId':_0x38d767['shopId'],'checkTimestamp':new Date()['toISOString']()});const _0x4aa445={'status':_0x1d27a1[_0x403121(0x19e)],'updatedAt':new Date()};if(_0x1d27a1[_0x403121(0x19e)]===_0x403121(0x105)&&_0x38d767[_0x403121(0x19e)]!==_0x403121(0x105)){_0x4aa445['paidAt']=new Date();if(!_0x38d767[_0x403121(0xe7)]){const _0x3eda81=await currencyService_1[_0x403121(0x107)][_0x403121(0x175)](_0x38d767[_0x403121(0xfc)],_0x38d767['currency']);_0x4aa445[_0x403121(0xe7)]=_0x3eda81;const _0x47b104=await this['getGatewayCommission'](_0x38d767['shopId'],_0x38d767[_0x403121(0x158)]),_0x1bb9ff=_0x3eda81*(0x1-_0x47b104/0x64);_0x4aa445['amountAfterGatewayCommissionUSDT']=_0x1bb9ff,_0x4aa445['gatewayCommissionRate']=_0x47b104,console[_0x403121(0x164)](_0x403121(0x19a)+_0x38d767['id']+_0x403121(0x117)),console[_0x403121(0x164)](_0x403121(0x14d)+_0x38d767[_0x403121(0xfc)]+'\x20'+_0x38d767[_0x403121(0x16c)]+_0x403121(0x195)+_0x3eda81[_0x403121(0x15c)](0x6)+_0x403121(0x1b4)),console['log']('\x20\x20\x20Gateway\x20'+_0x38d767[_0x403121(0x158)]+_0x403121(0x1a9)+_0x47b104+'%'),console[_0x403121(0x164)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x1bb9ff[_0x403121(0x15c)](0x6)+_0x403121(0x1b4));}console[_0x403121(0x164)](_0x403121(0x19a)+_0x38d767['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x4aa445['paidAt']['toISOString']());}if(_0x1d27a1['paymentDetails']){const _0x5ce8e6=_0x1d27a1['paymentDetails'];_0x5ce8e6['iban']&&(_0x4aa445[_0x403121(0xe3)]=_0x5ce8e6[_0x403121(0x10b)],console[_0x403121(0x164)](_0x403121(0x1b5)+_0x5ce8e6['iban']));if(_0x5ce8e6['bankDetails']){const _0x349490=_0x38d767[_0x403121(0xf5)]||'',_0x144f3f=_0x403121(0xeb)+_0x5ce8e6[_0x403121(0x12d)];_0x4aa445[_0x403121(0xf5)]=_0x349490?_0x349490+'\x0a\x0a'+_0x144f3f:_0x144f3f,console['log']('🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0x5ce8e6[_0x403121(0xdf)]&&console['log'](_0x403121(0x162)+_0x5ce8e6['transactionId']),_0x5ce8e6[_0x403121(0xc9)]&&console[_0x403121(0x164)]('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x5ce8e6[_0x403121(0xc9)]);}await database_1[_0x403121(0x149)][_0x403121(0x187)][_0x403121(0x1a7)]({'where':{'id':_0x38d767['id']},'data':_0x4aa445});if(_0x1d27a1[_0x403121(0x19e)]==='PAID'&&_0x38d767[_0x403121(0x19e)]!=='PAID'){console[_0x403121(0x164)](_0x403121(0x10e)+_0x38d767['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x5ec984=await database_1['default'][_0x403121(0x187)][_0x403121(0xb9)]({'where':{'id':_0x38d767['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x5ec984?.[_0x403121(0x142)]&&_0x5ec984['paymentLink'])try{const _0x50822d=_0x5ec984[_0x403121(0x177)];console[_0x403121(0x164)](_0x403121(0x17a)+_0x50822d['id']+_0x403121(0x13f)+_0x50822d[_0x403121(0x124)]+',\x20currentPayments='+_0x50822d[_0x403121(0x15a)]+',\x20status='+_0x50822d[_0x403121(0x19e)]);const _0x57bca9=_0x50822d[_0x403121(0x15a)]+0x1,_0x398f39=_0x50822d[_0x403121(0x124)]===_0x403121(0xbb)?_0x403121(0x169):_0x50822d['status'];await database_1['default'][_0x403121(0x177)][_0x403121(0x1a7)]({'where':{'id':_0x50822d['id']},'data':{'currentPayments':_0x57bca9,'status':_0x398f39,'updatedAt':new Date()}}),console[_0x403121(0x164)](_0x403121(0x11e)+_0x50822d['id']+_0x403121(0xdc)+_0x50822d[_0x403121(0x15a)]+'\x20->\x20'+_0x57bca9+',\x20status='+_0x50822d[_0x403121(0x19e)]+'\x20->\x20'+_0x398f39);}catch(_0x1f5660){console[_0x403121(0x15d)]('❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x1f5660);}else console[_0x403121(0x164)](_0x403121(0x10e)+_0x38d767['id']+_0x403121(0xe8));}await database_1[_0x403121(0x149)][_0x403121(0x104)][_0x403121(0x1ae)]({'data':{'paymentId':_0x38d767['id'],'shopId':_0x38d767[_0x403121(0xbd)],'event':_0x403121(0x144)+_0x1d27a1['status'][_0x403121(0x185)](),'statusCode':0xc8,'responseBody':JSON[_0x403121(0x152)]({'oldStatus':_0x38d767['status'],'newStatus':_0x1d27a1[_0x403121(0x19e)],'paymentDetails':_0x1d27a1[_0x403121(0x11b)],'checkedAt':new Date()[_0x403121(0x194)]()})}}),await this[_0x403121(0x15f)](_0x38d767,_0x1d27a1['status']),await this[_0x403121(0x14f)](_0x38d767,_0x1d27a1['status']),_0x1d27a1['status']!==_0x403121(0x126)&&(console[_0x403121(0x164)]('🧹\x20[CHECK]\x20Payment\x20'+_0x38d767['id']+_0x403121(0x19b)+_0x1d27a1[_0x403121(0x19e)]+_0x403121(0xd5)),this[_0x403121(0x1a6)](_0x38d767['id'])),console['log'](_0x403121(0xdb)+_0x38d767['id']+_0x403121(0x174));}else console[_0x403121(0x164)]('📊\x20[CHECK]\x20Payment\x20'+_0x38d767['id']+_0x403121(0x18e)+_0x1d27a1[_0x403121(0x19e)]+')'),this[_0x403121(0x17e)](_0x38d767['id'],_0x38d767[_0x403121(0x156)],_0x38d767[_0x403121(0x19e)],_0x1d27a1[_0x403121(0x19e)],_0x403121(0xc4),{'statusUnchanged':!![],'paymentDetails':_0x1d27a1['paymentDetails'],'amount':_0x1d27a1[_0x403121(0xfc)],'currency':_0x1d27a1[_0x403121(0x16c)],'shopId':_0x38d767[_0x403121(0xbd)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x186008){console['error']('❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x38d767['id']+':',_0x186008),this['logCoinToPayError'](_0x38d767['id'],_0x38d767[_0x403121(0x156)],_0x186008,_0x403121(0xc4),{'paymentAmount':_0x38d767[_0x403121(0xfc)],'paymentCurrency':_0x38d767[_0x403121(0x16c)],'shopId':_0x38d767[_0x403121(0xbd)],'createdAt':_0x38d767[_0x403121(0x109)]}),await database_1['default'][_0x403121(0x104)][_0x403121(0x1ae)]({'data':{'paymentId':_0x38d767['id'],'shopId':_0x38d767[_0x403121(0xbd)],'event':_0x403121(0x14e),'statusCode':0x1f4,'responseBody':JSON[_0x403121(0x152)]({'error':_0x186008 instanceof Error?_0x186008[_0x403121(0x191)]:_0x403121(0x11c),'gatewayPaymentId':_0x38d767[_0x403121(0x156)],'checkedAt':new Date()[_0x403121(0x194)]()})}});}}async[a40_0x4499f0(0x15f)](_0x4a6331,_0x5c6ec5){const _0x1f6bc3=a40_0x4499f0,_0x409897=Date[_0x1f6bc3(0x170)]();try{const _0xeeab3a=_0x4a6331[_0x1f6bc3(0x12b)],_0x47f9b2=_0xeeab3a[_0x1f6bc3(0xfa)];if(!_0x47f9b2?.[_0x1f6bc3(0xd2)]){console[_0x1f6bc3(0x164)](_0x1f6bc3(0x171)+_0xeeab3a['id']);return;}const _0x135013=_0x5c6ec5===_0x1f6bc3(0x105)?_0x1f6bc3(0x12c):_0x5c6ec5===_0x1f6bc3(0xdd)?_0x1f6bc3(0x123):_0x5c6ec5===_0x1f6bc3(0x168)?'payment.failed':_0x1f6bc3(0x101);if(!_0x47f9b2['webhookEvents']?.['includes'](_0x135013)){console[_0x1f6bc3(0x164)](_0x1f6bc3(0x120)+_0x135013+_0x1f6bc3(0x13b)+_0xeeab3a['id']);return;}const _0x1c7b6c=(0x0,gateway_1[_0x1f6bc3(0x129)])(_0x4a6331[_0x1f6bc3(0x158)])||_0x4a6331[_0x1f6bc3(0x158)],_0xbd296d={'event':_0x135013,'payment':{'id':_0x4a6331['id'],'order_id':_0x4a6331[_0x1f6bc3(0xf1)],'gateway_order_id':_0x4a6331[_0x1f6bc3(0xec)],'gateway':_0x1c7b6c,'amount':_0x4a6331[_0x1f6bc3(0xfc)],'currency':_0x4a6331[_0x1f6bc3(0x16c)],'status':_0x5c6ec5[_0x1f6bc3(0x185)](),'customer_email':_0x4a6331[_0x1f6bc3(0xbe)],'customer_name':_0x4a6331[_0x1f6bc3(0xf2)],'created_at':_0x4a6331['createdAt'],'updated_at':new Date()}},_0x2e47f2=await fetch(_0x47f9b2[_0x1f6bc3(0xd2)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1f6bc3(0x152)](_0xbd296d)}),_0x17e877=Date[_0x1f6bc3(0x170)]()-_0x409897,_0x3f7275=_0x2e47f2['ok']?_0x1f6bc3(0x140):await _0x2e47f2[_0x1f6bc3(0xea)]();loggerService_1[_0x1f6bc3(0xca)]['logShopWebhookSent'](_0x4a6331[_0x1f6bc3(0xbd)],_0x47f9b2[_0x1f6bc3(0xd2)],_0x135013,_0x2e47f2[_0x1f6bc3(0x19e)],_0x17e877,_0xbd296d),console[_0x1f6bc3(0x164)]('Shop\x20webhook\x20sent\x20to\x20'+_0x47f9b2['webhookUrl']+_0x1f6bc3(0x146)+_0x2e47f2['status']+'\x20('+_0x17e877+_0x1f6bc3(0x1a8));}catch(_0x543e3b){console[_0x1f6bc3(0x15d)](_0x1f6bc3(0xe9),_0x543e3b),loggerService_1[_0x1f6bc3(0xca)][_0x1f6bc3(0x143)](_0x4a6331[_0x1f6bc3(0xbd)],_0x4a6331[_0x1f6bc3(0x12b)]?.[_0x1f6bc3(0xfa)]?.[_0x1f6bc3(0xd2)]||_0x1f6bc3(0xc1),'webhook_send',_0x543e3b,{});}}async['sendPaymentStatusNotification'](_0x466f0a,_0x1fbf44){const _0x22d44b=a40_0x4499f0;try{const _0x3d1893={'PENDING':'created','PAID':'paid','FAILED':_0x22d44b(0xcc),'EXPIRED':_0x22d44b(0x137)},_0x3346eb=_0x3d1893[_0x1fbf44];if(!_0x3346eb||_0x3346eb==='created')return;await telegramBotService_1[_0x22d44b(0x100)][_0x22d44b(0x1b3)](_0x466f0a[_0x22d44b(0xbd)],_0x466f0a,_0x3346eb);}catch(_0x470883){console['error']('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x470883);}}async[a40_0x4499f0(0x19c)](_0x266f4c){const _0x50dc7e=a40_0x4499f0;console[_0x50dc7e(0x164)](_0x50dc7e(0x18f)+_0x266f4c);const _0x3d48bd=await database_1[_0x50dc7e(0x149)]['payment'][_0x50dc7e(0xb9)]({'where':{'id':_0x266f4c},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x3d48bd)throw new Error(_0x50dc7e(0x160));if(_0x3d48bd[_0x50dc7e(0x158)]!==_0x50dc7e(0xb7)&&_0x3d48bd['gateway']!==_0x50dc7e(0x1a1))throw new Error(_0x50dc7e(0x12a));console[_0x50dc7e(0x164)](_0x50dc7e(0x130)+_0x3d48bd[_0x50dc7e(0x158)]+_0x50dc7e(0x145)+_0x266f4c),await this[_0x50dc7e(0x153)](_0x3d48bd),console[_0x50dc7e(0x164)](_0x50dc7e(0x157)+_0x266f4c);}[a40_0x4499f0(0x18d)](){const _0x4396aa=a40_0x4499f0,_0x4c4d90=this[_0x4396aa(0xc8)]?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x52967e=Array[_0x4396aa(0x10d)](this[_0x4396aa(0xda)][_0x4396aa(0x115)]())[_0x4396aa(0x1a2)](_0x288cea=>({'paymentId':_0x288cea['paymentId'],'gatewayPaymentId':_0x288cea[_0x4396aa(0x156)],'createdAt':_0x288cea[_0x4396aa(0x109)],'timersCount':_0x288cea['timers']['length']}));return{'isActive':!!this[_0x4396aa(0xc8)],'globalCheckIntervalMinutes':this[_0x4396aa(0xe6)]/(0x3e8*0x3c),'expiryDays':this[_0x4396aa(0x15b)],'activeIndividualTimers':this[_0x4396aa(0xda)][_0x4396aa(0x111)],'nextGlobalCheckIn':_0x4c4d90,'paymentTimersDetails':_0x52967e};}['getPaymentTimerInfo'](_0x3b664d){const _0x54858d=a40_0x4499f0,_0x5cca22=this[_0x54858d(0xda)][_0x54858d(0x10c)](_0x3b664d);if(_0x5cca22)return{'hasTimers':!![],'timersCount':_0x5cca22[_0x54858d(0x18a)]['length'],'createdAt':_0x5cca22[_0x54858d(0x109)],'gatewayPaymentId':_0x5cca22['gatewayPaymentId']};return{'hasTimers':![]};}async['getGatewayCommission'](_0x551c64,_0x357fda){const _0x17f50e=a40_0x4499f0;try{const _0x336ead=await database_1['default']['shop'][_0x17f50e(0xb9)]({'where':{'id':_0x551c64},'select':{'gatewaySettings':!![]}});if(!_0x336ead?.['gatewaySettings'])return console[_0x17f50e(0x164)](_0x17f50e(0x106)+_0x551c64+_0x17f50e(0x12e)),0xa;const _0x49ed5e=JSON['parse'](_0x336ead[_0x17f50e(0x179)]);for(const [_0x236a91,_0xeb022b]of Object[_0x17f50e(0x18b)](_0x49ed5e)){if(_0x236a91[_0x17f50e(0x185)]()===_0x357fda[_0x17f50e(0x185)]()){const _0x43e365=_0xeb022b[_0x17f50e(0x16f)]||0xa;return console[_0x17f50e(0x164)](_0x17f50e(0x147)+_0x357fda+_0x17f50e(0xc3)+_0x551c64+':\x20'+_0x43e365+'%'),_0x43e365;}}return console[_0x17f50e(0x164)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x357fda+_0x17f50e(0xed)+_0x551c64+_0x17f50e(0x150)),0xa;}catch(_0x42a934){return console['error'](_0x17f50e(0xde)+_0x551c64+_0x17f50e(0x154)+_0x357fda+':',_0x42a934),0xa;}}}exports[a40_0x4499f0(0x189)]=CoinToPayStatusService,exports[a40_0x4499f0(0x11f)]=new CoinToPayStatusService();