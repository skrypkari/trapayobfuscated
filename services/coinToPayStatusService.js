'use strict';const a48_0x12f973=a48_0x4cd2;(function(_0x934f9f,_0x45eb11){const _0x4f4f74=a48_0x4cd2,_0x3049b3=_0x934f9f();while(!![]){try{const _0x117908=-parseInt(_0x4f4f74(0x17e))/0x1+parseInt(_0x4f4f74(0xa2))/0x2*(-parseInt(_0x4f4f74(0xfd))/0x3)+-parseInt(_0x4f4f74(0x10f))/0x4+-parseInt(_0x4f4f74(0xe2))/0x5+parseInt(_0x4f4f74(0xdc))/0x6+parseInt(_0x4f4f74(0x106))/0x7*(-parseInt(_0x4f4f74(0xd6))/0x8)+parseInt(_0x4f4f74(0x152))/0x9;if(_0x117908===_0x45eb11)break;else _0x3049b3['push'](_0x3049b3['shift']());}catch(_0x526cad){_0x3049b3['push'](_0x3049b3['shift']());}}}(a48_0x4043,0x8be21));function a48_0x4043(){const _0xa96b67=['\x20in\x20shop\x20','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','checkSinglePaymentById','69643rplSWV','commission','üí∞\x20[CHECK]\x20Payment\x20','log','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','payment','currentPayments','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','startPeriodicStatusCheck','764720ZVjpth','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20->\x20','üßπ\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20paymentId:\x20','checkPaymentStatus','has','getServiceStats','entries','\x20days,\x20marking\x20as\x20EXPIRED','text','\x20\x20\x20üìÖ\x20Time:\x20','COINTOPAY_STATUS_CHANGE','üõë\x20[SHUTDOWN]\x20Cleared\x20','\x20\x20\x20Amount:\x20','telegramBotService','amount','floor','cointopay_status_check_','\x20updated:\x20currentPayments=','not\x20confirmed','getDate','amountAfterGatewayCommissionUSDT','\x20status\x20unchanged\x20(','logShopWebhookError','clearPaymentTimers','\x20completed\x20for\x20payment\x20','cointopay','\x20is\x20older\x20than\x20','paymentLink','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','\x20USDT','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','EXPIRY_DAYS','‚úÖ\x20[HOURLY]\x20Payment\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','webhook_send','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','message','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','‚ùå\x20[HOURLY]\x20Payment\x20','PAID','gatewayCommissionRate','‚úÖ\x20[EXPIRY]\x20Payment\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','\x20\x20\x20üìç\x20Source:\x20','COMPLETED','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20to\x20','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','COINTOPAY_ERROR','timestamp','\x20days\x20(created\x20before\x20',',\x20currentPayments=','amountUSDT',',\x20stopping\x20individual\x20checks','created','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','EXPIRED','h),\x20skipping\x20global\x20check','payment.failed','now','application/json','sendShopWebhook','update','19682883xySdLQ','üìä\x20[HOURLY]\x20Payment\x20','coinToPayService','customerName','Payment\x20older\x20than\x20','‚è∞\x20[HOURLY]\x20Payment\x20','shop','\x20commission:\x20','./loggerService','\x20current\x20status:\x20','type','./currencyService','1\x20minute','\x20pending\x20CoinToPay\x20payments','iban','coinToPay2Service','\x20marked\x20as\x20paid\x20at:\x20','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','\x20(age:\x20','checkAllPendingPayments','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20',',\x20clearing\x20individual\x20timers','.\x20Remaining\x20active\x20timers:\x20','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','\x20timers\x20for\x20payment\x20','5\x20minutes','\x20expired','\x20status\x20from\x20','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','__esModule','stopPeriodicStatusCheck','CoinToPayService','map','from','coinToPayStatusService','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','logWhiteDomainError','gatewaySettings','includes',':\x20type=','‚ùå\x20[CHECK]\x20Payment\x20','../types/gateway','stringify','\x20for\x20payment\x20','927447FOvpGf','-day\x20timeout','\x20\x20\x20üìù\x20Details:','‚è∞\x20[GLOBAL]\x20Found\x20','\x20has\x20no\x20gatewayPaymentId','\x20days','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','ms)','\x20\x20\x20üìä\x20Status:\x20','Payment\x20not\x20found',',\x20status=','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','Webhook\x20event\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','Failed\x20to\x20send\x20shop\x20webhook:','getGatewayIdByName','timers','toFixed','\x20\x20\x20-\x20Gateway:\x20','üîç\x20[CHECK]\x20Checking\x20','sendPaymentStatusNotification','failed','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','payment.pending','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','findUnique','‚è∞\x20[GLOBAL]\x20Payment\x20','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','create','__importDefault','expired','\x20skipped,\x20','schedulePaymentChecks','length','settings','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','\x20(after\x20','paymentDetails','webhookUrl','\x20seconds\x20(','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20status\x20is\x20','getTime','Payment\x20System/1.0','Shop\x20webhook\x20sent\x20to\x20','FAILED','getGatewayCommission','transactionId','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','toISOString','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','Success','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','getPaymentTimerInfo','default','globalCheckInterval','toLowerCase','338dPsKpw','size','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20amounts\x20calculated:','checkSinglePayment','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20initial\x20timers\x20for\x20payment\x20','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','payment.success','../config/database','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20not\x20found,\x20clearing\x20timers','webhookEvents','gateway','./gateways/coinToPayService','schedule_created','error','forEach','customerEmail','unknown','parse','status_check','createdAt','gatewayPaymentId','bankDetails','push','‚è∞\x20[EXPIRY]\x20Payment\x20','findMany','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','delay','shopId','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','currency','\x20commission\x20for\x20shop\x20','\x20details:','\x20payment\x20','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','\x20updated\x20successfully','\x20is\x20valid\x20for\x20checking,\x20proceeding...','delete','description','\x20checked,\x20','\x20with\x20status\x20','not\x20found','loggerService','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','defineProperty','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','üìà\x20[COINTOPAY]\x20Payment\x20','32elXoUi','paidAt','paymentLinkId','CoinToPayStatusService','‚úÖ\x20[CHECK]\x20Payment\x20','gatewayOrderId','1008090hDKWAo','cointopay2','üìä\x20[CHECK]\x20Payment\x20','logShopWebhookSent','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','PENDING','1123045YPYdFX','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','remitterIban','sendPaymentNotification','\x20\x20\x20-\x20Status:\x20','cointopay_status_check_error','checkExpiredPayments','\x20not\x20enabled\x20for\x20shop\x20','get','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','CoinToPay2Service','orderId','Gateway\x20','logCoinToPayStatus','./telegramBotService','status','logCoinToPayError',',\x20gateway\x20','\x20found:','paymentTimers','auto_expire','\x20status:\x20','\x20\x20\x20Amount\x20after\x20commission:\x20',',\x20using\x20default\x2010%','catch','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','\x20\x20\x20‚ùå\x20Error:\x20','7083Njigen','GLOBAL_CHECK_INTERVAL_MS','\x20\x20\x20-\x20ShopId:\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','webhookLog'];a48_0x4043=function(){return _0xa96b67;};return a48_0x4043();}var __importDefault=this&&this[a48_0x12f973(0x84)]||function(_0x167b63){const _0x34a7d9=a48_0x12f973;return _0x167b63&&_0x167b63[_0x34a7d9(0x16f)]?_0x167b63:{'default':_0x167b63};};Object[a48_0x12f973(0xd3)](exports,a48_0x12f973(0x16f),{'value':!![]}),exports[a48_0x12f973(0x174)]=exports[a48_0x12f973(0xd9)]=void 0x0;function a48_0x4cd2(_0x2363e6,_0x496b9f){_0x2363e6=_0x2363e6-0x7f;const _0x404362=a48_0x4043();let _0x4cd2a8=_0x404362[_0x2363e6];return _0x4cd2a8;}const coinToPayService_1=require(a48_0x12f973(0xb3)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a48_0x12f973(0x17b)),database_1=__importDefault(require(a48_0x12f973(0xae))),telegramBotService_1=require(a48_0x12f973(0xf0)),loggerService_1=require(a48_0x12f973(0x15a)),currencyService_1=require(a48_0x12f973(0x15d));class CoinToPayStatusService{constructor(){const _0x928a1f=a48_0x12f973;this[_0x928a1f(0xa0)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x928a1f(0xf5)]=new Map(),this[_0x928a1f(0x154)]=new coinToPayService_1[(_0x928a1f(0x171))](),this[_0x928a1f(0x161)]=new coinToPay2Service_1[(_0x928a1f(0xec))](),console[_0x928a1f(0x109)](_0x928a1f(0x12e));}[a48_0x12f973(0x87)](_0x58cf62,_0x3f4c43){const _0xe830e6=a48_0x12f973;console[_0xe830e6(0x109)](_0xe830e6(0x194)),console[_0xe830e6(0x109)](_0xe830e6(0x114)+_0x58cf62),console[_0xe830e6(0x109)](_0xe830e6(0x13d)+_0x3f4c43),this['clearPaymentTimers'](_0x58cf62);const _0x338a31=[],_0xd54a22=new Date(),_0x563b64=[{'delay':0x1*0x3c*0x3e8,'description':_0xe830e6(0x15e)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0xe830e6(0x16b)}];console[_0xe830e6(0x109)]('ü™ô\x20[DEBUG]\x20Creating\x20'+_0x563b64['length']+_0xe830e6(0xa8)+_0x58cf62);let _0x2f4a2b=0x0;_0x563b64[_0xe830e6(0xb6)]((_0x3d6e5f,_0x4de61d)=>{const _0x568623=_0xe830e6;_0x2f4a2b+=_0x3d6e5f[_0x568623(0xc2)];const _0x2ba6f5=setTimeout(async()=>{const _0x506eb1=_0x568623;console[_0x506eb1(0x109)](_0x506eb1(0x169)+(_0x4de61d+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x58cf62+_0x506eb1(0x8b)+_0x3d6e5f[_0x506eb1(0xcd)]+')');try{await this[_0x506eb1(0x105)](_0x58cf62),console[_0x506eb1(0x109)]('‚úÖ\x20[TIMER]\x20Individual\x20check\x20#'+(_0x4de61d+0x1)+_0x506eb1(0x12a)+_0x58cf62);}catch(_0x206453){console[_0x506eb1(0xb5)](_0x506eb1(0x9b)+(_0x4de61d+0x1)+'\x20for\x20payment\x20'+_0x58cf62+':',_0x206453),this[_0x506eb1(0xf2)](_0x58cf62,_0x3f4c43,_0x206453,_0x506eb1(0xba),{'checkNumber':_0x4de61d+0x1,'scheduledAfter':_0x3d6e5f[_0x506eb1(0xcd)],'isIndividualCheck':!![]});}},_0x2f4a2b);_0x338a31['push'](_0x2ba6f5),console['log'](_0x568623(0x184)+(_0x4de61d+0x1)+_0x568623(0x17d)+_0x58cf62+'\x20in\x20'+_0x2f4a2b/0x3e8+_0x568623(0x8e)+_0x3d6e5f['description']+')');});const _0x9e9c62=setInterval(async()=>{const _0x3bbc97=_0xe830e6;console[_0x3bbc97(0x109)](_0x3bbc97(0x166)+_0x58cf62);try{const _0x1c3543=await database_1['default'][_0x3bbc97(0x10b)][_0x3bbc97(0x197)]({'where':{'id':_0x58cf62},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x1c3543){console[_0x3bbc97(0x109)](_0x3bbc97(0x139)+_0x58cf62+_0x3bbc97(0xb0)),this[_0x3bbc97(0x129)](_0x58cf62);return;}console[_0x3bbc97(0x109)](_0x3bbc97(0x153)+_0x58cf62+_0x3bbc97(0x15b)+_0x1c3543['status']);if(_0x1c3543[_0x3bbc97(0xf1)]!==_0x3bbc97(0xe1)){console[_0x3bbc97(0x109)](_0x3bbc97(0x133)+_0x58cf62+_0x3bbc97(0x90)+_0x1c3543[_0x3bbc97(0xf1)]+_0x3bbc97(0x148)),this[_0x3bbc97(0x129)](_0x58cf62);return;}const _0x21e9dc=Math[_0x3bbc97(0x121)]((Date[_0x3bbc97(0x14e)]()-_0x1c3543[_0x3bbc97(0xbb)][_0x3bbc97(0x91)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x21e9dc>=this[_0x3bbc97(0x132)]){console[_0x3bbc97(0x109)](_0x3bbc97(0x157)+_0x58cf62+_0x3bbc97(0x12c)+this[_0x3bbc97(0x132)]+_0x3bbc97(0xc1)),this[_0x3bbc97(0x129)](_0x58cf62);return;}await this[_0x3bbc97(0x105)](_0x58cf62),console[_0x3bbc97(0x109)](_0x3bbc97(0xd2)+_0x58cf62);}catch(_0x11e6aa){console[_0x3bbc97(0xb5)](_0x3bbc97(0x136)+_0x58cf62+':',_0x11e6aa),this[_0x3bbc97(0xf2)](_0x58cf62,_0x3f4c43,_0x11e6aa,_0x3bbc97(0xba),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x338a31[_0xe830e6(0xbe)](_0x9e9c62),this[_0xe830e6(0xf5)]['set'](_0x58cf62,{'timers':_0x338a31,'paymentId':_0x58cf62,'gatewayPaymentId':_0x3f4c43,'createdAt':_0xd54a22}),console['log']('‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20'+_0x563b64[_0xe830e6(0x88)]+_0xe830e6(0xeb)+_0x58cf62),console['log']('üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0xe830e6(0xf5)][_0xe830e6(0xa3)]),this[_0xe830e6(0xef)](_0x58cf62,_0x3f4c43,_0xe830e6(0xe1),_0xe830e6(0xe1),_0xe830e6(0xba),{'action':_0xe830e6(0xb4),'scheduledChecks':_0x563b64[_0xe830e6(0x88)],'firstCheckIn':_0x563b64[0x0][_0xe830e6(0xc2)]/0x3e8,'totalTimers':this[_0xe830e6(0xf5)][_0xe830e6(0xa3)]});}[a48_0x12f973(0x129)](_0x210bb6){const _0x425dac=a48_0x12f973,_0x194502=this[_0x425dac(0xf5)]['get'](_0x210bb6);_0x194502?(console[_0x425dac(0x109)]('üßπ\x20[DEBUG]\x20Clearing\x20'+_0x194502['timers']['length']+_0x425dac(0x16a)+_0x210bb6),_0x194502['timers']['forEach']((_0xd38b8b,_0x15e713)=>{const _0x445037=_0x425dac;_0xd38b8b&&(clearTimeout(_0xd38b8b),clearInterval(_0xd38b8b),console[_0x445037(0x109)](_0x445037(0x82)+(_0x15e713+0x1)+'\x20for\x20payment\x20'+_0x210bb6));}),this[_0x425dac(0xf5)][_0x425dac(0xcc)](_0x210bb6),console[_0x425dac(0x109)](_0x425dac(0x8f)+_0x210bb6+_0x425dac(0x168)+this[_0x425dac(0xf5)][_0x425dac(0xa3)])):console[_0x425dac(0x109)](_0x425dac(0x103)+_0x210bb6+'\x20to\x20clear');}async['checkSinglePaymentById'](_0x599b96){const _0x3ca77f=a48_0x12f973;console[_0x3ca77f(0x109)]('üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x599b96);const _0x34c6ba=await database_1[_0x3ca77f(0x9f)][_0x3ca77f(0x10b)][_0x3ca77f(0x197)]({'where':{'id':_0x599b96},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x34c6ba){console['log'](_0x3ca77f(0x17a)+_0x599b96+'\x20not\x20found\x20in\x20database');return;}console[_0x3ca77f(0x109)](_0x3ca77f(0xde)+_0x599b96+_0x3ca77f(0xf4)),console[_0x3ca77f(0x109)](_0x3ca77f(0x190)+_0x34c6ba[_0x3ca77f(0xb2)]),console[_0x3ca77f(0x109)](_0x3ca77f(0xe6)+_0x34c6ba[_0x3ca77f(0xf1)]),console['log'](_0x3ca77f(0xab)+_0x34c6ba[_0x3ca77f(0xbc)]),console[_0x3ca77f(0x109)]('\x20\x20\x20-\x20Amount:\x20'+_0x34c6ba[_0x3ca77f(0x120)]+'\x20'+_0x34c6ba['currency']),console[_0x3ca77f(0x109)](_0x3ca77f(0xff)+_0x34c6ba[_0x3ca77f(0xc3)]);if(_0x34c6ba[_0x3ca77f(0xb2)]!=='cointopay'&&_0x34c6ba['gateway']!==_0x3ca77f(0xdd)){console[_0x3ca77f(0x109)](_0x3ca77f(0x18b)+_0x599b96+_0x3ca77f(0xd4)+_0x34c6ba[_0x3ca77f(0xb2)]+')');return;}if(_0x34c6ba['status']!==_0x3ca77f(0xe1)){console[_0x3ca77f(0x109)](_0x3ca77f(0x18b)+_0x599b96+_0x3ca77f(0x90)+_0x34c6ba['status']+_0x3ca77f(0x148)),this[_0x3ca77f(0x129)](_0x599b96);return;}if(!_0x34c6ba[_0x3ca77f(0xbc)]){console['log']('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x599b96+_0x3ca77f(0x182));return;}console['log'](_0x3ca77f(0xda)+_0x599b96+_0x3ca77f(0xcb)),await this[_0x3ca77f(0xa6)](_0x34c6ba);}['logCoinToPayStatus'](_0x56cc2a,_0x5ecaf4,_0x2afcb8,_0x4984a5,_0x329005,_0x584141){const _0x46f4d1=a48_0x12f973,_0x8a8e82={'type':_0x46f4d1(0x11c),'paymentId':_0x56cc2a,'gatewayPaymentId':_0x5ecaf4,'oldStatus':_0x2afcb8,'newStatus':_0x4984a5,'source':_0x329005,'timestamp':new Date()['toISOString'](),'details':_0x584141||{}};loggerService_1[_0x46f4d1(0xd1)][_0x46f4d1(0xef)](_0x8a8e82),console['log'](_0x46f4d1(0xaa)+_0x56cc2a+'\x20('+_0x5ecaf4+')'),console[_0x46f4d1(0x109)](_0x46f4d1(0x186)+_0x2afcb8+_0x46f4d1(0x112)+_0x4984a5),console['log'](_0x46f4d1(0x13e)+_0x329005),console['log'](_0x46f4d1(0x11b)+_0x8a8e82['timestamp']),_0x584141&&console[_0x46f4d1(0x109)](_0x46f4d1(0x180),_0x584141);}[a48_0x12f973(0xf2)](_0x419ba6,_0x2766cb,_0x213990,_0x381013,_0x342599){const _0x26d1c0=a48_0x12f973,_0x3a3f0c={'type':_0x26d1c0(0x143),'paymentId':_0x419ba6,'gatewayPaymentId':_0x2766cb,'error':_0x213990 instanceof Error?{'message':_0x213990[_0x26d1c0(0x137)],'stack':_0x213990['stack']}:_0x213990,'source':_0x381013,'timestamp':new Date()['toISOString'](),'context':_0x342599||{}};loggerService_1[_0x26d1c0(0xd1)][_0x26d1c0(0xf2)](_0x3a3f0c),console[_0x26d1c0(0xb5)](_0x26d1c0(0x97)+_0x419ba6+'\x20('+_0x2766cb+')'),console[_0x26d1c0(0xb5)](_0x26d1c0(0xfc)+(_0x213990 instanceof Error?_0x213990[_0x26d1c0(0x137)]:_0x213990)),console[_0x26d1c0(0xb5)]('\x20\x20\x20üìç\x20Source:\x20'+_0x381013),console[_0x26d1c0(0xb5)](_0x26d1c0(0x11b)+_0x3a3f0c[_0x26d1c0(0x144)]),_0x342599&&console[_0x26d1c0(0xb5)]('\x20\x20\x20üìù\x20Context:',_0x342599);}[a48_0x12f973(0x10e)](){const _0x114c31=a48_0x12f973;console[_0x114c31(0x109)](_0x114c31(0xa7)),this['checkAllPendingPayments']()[_0x114c31(0xfa)](_0x31acb5=>{const _0x5b117d=_0x114c31;console[_0x5b117d(0xb5)](_0x5b117d(0x163),_0x31acb5);}),this[_0x114c31(0xa0)]=setInterval(async()=>{const _0x215e72=_0x114c31;try{console['log'](_0x215e72(0x81)),await this[_0x215e72(0x165)](),console[_0x215e72(0x109)](_0x215e72(0x9d));}catch(_0x592144){console[_0x215e72(0xb5)](_0x215e72(0x10d),_0x592144);}},this[_0x114c31(0xfe)]),console[_0x114c31(0x109)](_0x114c31(0xe0));}[a48_0x12f973(0x170)](){const _0x57ddca=a48_0x12f973;console['log'](_0x57ddca(0x99));this[_0x57ddca(0xa0)]&&(clearInterval(this[_0x57ddca(0xa0)]),this[_0x57ddca(0xa0)]=null,console[_0x57ddca(0x109)](_0x57ddca(0xaf)));const _0x264c63=this[_0x57ddca(0xf5)][_0x57ddca(0xa3)];for(const [_0x161e5f]of this[_0x57ddca(0xf5)]){this[_0x57ddca(0x129)](_0x161e5f);}console[_0x57ddca(0x109)](_0x57ddca(0x11d)+_0x264c63+'\x20individual\x20payment\x20timers');}async['checkAllPendingPayments'](){const _0x4a81af=a48_0x12f973;try{console[_0x4a81af(0x109)](_0x4a81af(0x9c));const _0x458a4a=await database_1[_0x4a81af(0x9f)][_0x4a81af(0x10b)][_0x4a81af(0xc0)]({'where':{'gateway':{'in':[_0x4a81af(0x12b),_0x4a81af(0xdd)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log']('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x458a4a[_0x4a81af(0x88)]+_0x4a81af(0x15f));if(_0x458a4a[_0x4a81af(0x88)]===0x0){console[_0x4a81af(0x109)](_0x4a81af(0x189));return;}const _0x42f1bd=await this[_0x4a81af(0xe8)](_0x458a4a);console[_0x4a81af(0x109)](_0x4a81af(0x181)+_0x42f1bd[_0x4a81af(0x88)]+'\x20expired\x20CoinToPay\x20payments');let _0x51ef03=0x0,_0x595f4d=0x0;for(const _0x4186fc of _0x458a4a){try{if(_0x42f1bd['includes'](_0x4186fc['id'])){console[_0x4a81af(0x109)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x4186fc['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x595f4d++;continue;}if(this[_0x4a81af(0xf5)][_0x4a81af(0x116)](_0x4186fc['id'])){console[_0x4a81af(0x109)](_0x4a81af(0x7f)+_0x4186fc['id']+_0x4a81af(0x8a)),_0x595f4d++;continue;}const _0x4c92d7=(Date[_0x4a81af(0x14e)]()-_0x4186fc[_0x4a81af(0xbb)][_0x4a81af(0x91)]())/(0x3e8*0x3c*0x3c);if(_0x4c92d7<0x1){console[_0x4a81af(0x109)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x4186fc['id']+'\x20is\x20too\x20new\x20('+_0x4c92d7[_0x4a81af(0x18f)](0x1)+_0x4a81af(0x14c)),_0x595f4d++;continue;}console[_0x4a81af(0x109)](_0x4a81af(0x142)+_0x4186fc['id']+_0x4a81af(0x164)+_0x4c92d7[_0x4a81af(0x18f)](0x1)+'h)'),await this[_0x4a81af(0xa6)](_0x4186fc),_0x51ef03++,await new Promise(_0x180ed6=>setTimeout(_0x180ed6,0x7d0));}catch(_0x33681d){console['error']('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x4186fc['id']+':',_0x33681d),this['logCoinToPayError'](_0x4186fc['id'],_0x4186fc['gatewayPaymentId']||'unknown',_0x33681d,_0x4a81af(0xba),{'isGlobalCheck':!![],'paymentAmount':_0x4186fc[_0x4a81af(0x120)],'paymentCurrency':_0x4186fc['currency'],'shopId':_0x4186fc[_0x4a81af(0xc3)],'createdAt':_0x4186fc[_0x4a81af(0xbb)]}),loggerService_1[_0x4a81af(0xd1)][_0x4a81af(0x176)](_0x4a81af(0x12b),'/status/'+_0x4186fc[_0x4a81af(0xbc)],_0x33681d);}}console[_0x4a81af(0x109)](_0x4a81af(0x134)+_0x51ef03+_0x4a81af(0xce)+_0x595f4d+_0x4a81af(0x86)+_0x42f1bd[_0x4a81af(0x88)]+_0x4a81af(0x16c));}catch(_0x514935){console[_0x4a81af(0xb5)](_0x4a81af(0xa4),_0x514935);}}async['checkExpiredPayments'](_0xa6dc1){const _0x19510f=a48_0x12f973,_0x53e388=[],_0x208874=new Date();_0x208874['setDate'](_0x208874[_0x19510f(0x125)]()-this[_0x19510f(0x132)]),console[_0x19510f(0x109)](_0x19510f(0x196)+this[_0x19510f(0x132)]+_0x19510f(0x145)+_0x208874[_0x19510f(0x98)]()+')');for(const _0x35ed57 of _0xa6dc1){if(_0x35ed57[_0x19510f(0xbb)]<_0x208874){console[_0x19510f(0x109)](_0x19510f(0xbf)+_0x35ed57['id']+_0x19510f(0x12c)+this[_0x19510f(0x132)]+_0x19510f(0x119));try{this[_0x19510f(0xef)](_0x35ed57['id'],_0x35ed57[_0x19510f(0xbc)]||_0x19510f(0xb8),'PENDING',_0x19510f(0x14b),_0x19510f(0xf6),{'reason':_0x19510f(0x156)+this[_0x19510f(0x132)]+'\x20days','createdAt':_0x35ed57['createdAt'],'daysSinceCreation':Math['floor']((Date['now']()-_0x35ed57[_0x19510f(0xbb)][_0x19510f(0x91)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x35ed57['amount'],'paymentCurrency':_0x35ed57[_0x19510f(0xc5)],'shopId':_0x35ed57['shopId']}),await database_1[_0x19510f(0x9f)]['payment']['update']({'where':{'id':_0x35ed57['id']},'data':{'status':_0x19510f(0x14b),'updatedAt':new Date()}}),await database_1[_0x19510f(0x9f)]['webhookLog'][_0x19510f(0x83)]({'data':{'paymentId':_0x35ed57['id'],'shopId':_0x35ed57['shopId'],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON['stringify']({'reason':'Payment\x20older\x20than\x20'+this[_0x19510f(0x132)]+_0x19510f(0x183),'createdAt':_0x35ed57[_0x19510f(0xbb)],'expiredAt':new Date()[_0x19510f(0x98)](),'daysSinceCreation':Math[_0x19510f(0x121)]((Date['now']()-_0x35ed57[_0x19510f(0xbb)][_0x19510f(0x91)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x35ed57,_0x19510f(0x14b)),await this[_0x19510f(0x192)](_0x35ed57,_0x19510f(0x14b)),this[_0x19510f(0x129)](_0x35ed57['id']),_0x53e388[_0x19510f(0xbe)](_0x35ed57['id']),console[_0x19510f(0x109)](_0x19510f(0x13c)+_0x35ed57['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this['EXPIRY_DAYS']+_0x19510f(0x17f));}catch(_0xc5b0c){console[_0x19510f(0xb5)](_0x19510f(0x104)+_0x35ed57['id']+':',_0xc5b0c),this[_0x19510f(0xf2)](_0x35ed57['id'],_0x35ed57[_0x19510f(0xbc)]||_0x19510f(0xb8),_0xc5b0c,'auto_expire',{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x35ed57[_0x19510f(0xbb)],'daysSinceCreation':Math[_0x19510f(0x121)]((Date[_0x19510f(0x14e)]()-_0x35ed57[_0x19510f(0xbb)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x53e388;}async['checkSinglePayment'](_0x1fccb2){const _0x2cc3eb=a48_0x12f973;if(!_0x1fccb2[_0x2cc3eb(0xbc)]){console['log']('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x1fccb2['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console['log'](_0x2cc3eb(0x191)+_0x1fccb2['gateway']+_0x2cc3eb(0xc8)+_0x1fccb2['id']+'\x20('+_0x1fccb2['gatewayPaymentId']+')');try{let _0x28d3f3;_0x1fccb2[_0x2cc3eb(0xb2)]===_0x2cc3eb(0xdd)?(_0x28d3f3=await this['coinToPay2Service'][_0x2cc3eb(0x115)](_0x1fccb2[_0x2cc3eb(0xbc)]),console[_0x2cc3eb(0x109)](_0x2cc3eb(0x131)+_0x1fccb2['id']+'\x20status:\x20'+_0x28d3f3[_0x2cc3eb(0xf1)])):(_0x28d3f3=await this[_0x2cc3eb(0x154)][_0x2cc3eb(0x115)](_0x1fccb2['gatewayPaymentId']),console[_0x2cc3eb(0x109)](_0x2cc3eb(0x140)+_0x1fccb2['id']+_0x2cc3eb(0xf7)+_0x28d3f3['status']));_0x28d3f3[_0x2cc3eb(0x8c)]&&console['log'](_0x2cc3eb(0xde)+_0x1fccb2['id']+_0x2cc3eb(0xc7),{'iban':_0x28d3f3['paymentDetails'][_0x2cc3eb(0x160)]||_0x2cc3eb(0xd0),'transactionId':_0x28d3f3[_0x2cc3eb(0x8c)]['transactionId'],'createdOn':_0x28d3f3['paymentDetails']['createdOn'],'confirmedOn':_0x28d3f3[_0x2cc3eb(0x8c)]['confirmedOn']||_0x2cc3eb(0x124)});if(_0x28d3f3[_0x2cc3eb(0xf1)]!==_0x1fccb2['status']){console['log'](_0x2cc3eb(0x138)+_0x1fccb2['id']+_0x2cc3eb(0x16d)+_0x1fccb2['status']+_0x2cc3eb(0x141)+_0x28d3f3['status']),this['logCoinToPayStatus'](_0x1fccb2['id'],_0x1fccb2[_0x2cc3eb(0xbc)],_0x1fccb2[_0x2cc3eb(0xf1)],_0x28d3f3[_0x2cc3eb(0xf1)],_0x2cc3eb(0xba),{'paymentDetails':_0x28d3f3[_0x2cc3eb(0x8c)],'amount':_0x28d3f3[_0x2cc3eb(0x120)],'currency':_0x28d3f3[_0x2cc3eb(0xc5)],'shopId':_0x1fccb2['shopId'],'checkTimestamp':new Date()[_0x2cc3eb(0x98)]()});const _0x20ee34={'status':_0x28d3f3[_0x2cc3eb(0xf1)],'updatedAt':new Date()};if(_0x28d3f3['status']===_0x2cc3eb(0x13a)&&_0x1fccb2[_0x2cc3eb(0xf1)]!==_0x2cc3eb(0x13a)){_0x20ee34[_0x2cc3eb(0xd7)]=new Date();if(!_0x1fccb2['amountUSDT']){const _0xc574ea=await currencyService_1['currencyService']['convertToUSDT'](_0x1fccb2[_0x2cc3eb(0x120)],_0x1fccb2['currency']);_0x20ee34[_0x2cc3eb(0x147)]=_0xc574ea;const _0x50fc16=await this[_0x2cc3eb(0x95)](_0x1fccb2[_0x2cc3eb(0xc3)],_0x1fccb2[_0x2cc3eb(0xb2)]),_0x2eb740=_0xc574ea*(0x1-_0x50fc16/0x64);_0x20ee34[_0x2cc3eb(0x126)]=_0x2eb740,_0x20ee34[_0x2cc3eb(0x13b)]=_0x50fc16,console[_0x2cc3eb(0x109)](_0x2cc3eb(0x108)+_0x1fccb2['id']+_0x2cc3eb(0xa5)),console['log'](_0x2cc3eb(0x11e)+_0x1fccb2[_0x2cc3eb(0x120)]+'\x20'+_0x1fccb2[_0x2cc3eb(0xc5)]+_0x2cc3eb(0x112)+_0xc574ea[_0x2cc3eb(0x18f)](0x6)+_0x2cc3eb(0x130)),console['log']('\x20\x20\x20Gateway\x20'+_0x1fccb2[_0x2cc3eb(0xb2)]+_0x2cc3eb(0x159)+_0x50fc16+'%'),console['log'](_0x2cc3eb(0xf8)+_0x2eb740[_0x2cc3eb(0x18f)](0x6)+'\x20USDT');}console['log'](_0x2cc3eb(0x108)+_0x1fccb2['id']+_0x2cc3eb(0x162)+_0x20ee34[_0x2cc3eb(0xd7)][_0x2cc3eb(0x98)]());}if(_0x28d3f3[_0x2cc3eb(0x8c)]){const _0x523deb=_0x28d3f3[_0x2cc3eb(0x8c)];_0x523deb[_0x2cc3eb(0x160)]&&(_0x20ee34[_0x2cc3eb(0xe4)]=_0x523deb[_0x2cc3eb(0x160)],console['log'](_0x2cc3eb(0xac)+_0x523deb[_0x2cc3eb(0x160)])),_0x523deb[_0x2cc3eb(0xbd)]&&console['log'](_0x2cc3eb(0x16e)+_0x523deb[_0x2cc3eb(0xbd)]),_0x523deb[_0x2cc3eb(0x96)]&&console[_0x2cc3eb(0x109)](_0x2cc3eb(0x14a)+_0x523deb[_0x2cc3eb(0x96)]),_0x523deb['confirmedOn']&&console[_0x2cc3eb(0x109)]('‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x523deb['confirmedOn']);}await database_1['default'][_0x2cc3eb(0x10b)][_0x2cc3eb(0x151)]({'where':{'id':_0x1fccb2['id']},'data':_0x20ee34});if(_0x28d3f3['status']==='PAID'&&_0x1fccb2['status']!==_0x2cc3eb(0x13a)){console[_0x2cc3eb(0x109)](_0x2cc3eb(0xd5)+_0x1fccb2['id']+_0x2cc3eb(0x12f));const _0x335ac6=await database_1[_0x2cc3eb(0x9f)]['payment']['findUnique']({'where':{'id':_0x1fccb2['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x335ac6?.[_0x2cc3eb(0xd8)]&&_0x335ac6[_0x2cc3eb(0x12d)])try{const _0x12bd68=_0x335ac6[_0x2cc3eb(0x12d)];console[_0x2cc3eb(0x109)](_0x2cc3eb(0x110)+_0x12bd68['id']+_0x2cc3eb(0x179)+_0x12bd68[_0x2cc3eb(0x15c)]+_0x2cc3eb(0x146)+_0x12bd68['currentPayments']+',\x20status='+_0x12bd68[_0x2cc3eb(0xf1)]);const _0x3f862a=_0x12bd68[_0x2cc3eb(0x10c)]+0x1,_0x472b8c=_0x12bd68[_0x2cc3eb(0x15c)]==='SINGLE'?_0x2cc3eb(0x13f):_0x12bd68[_0x2cc3eb(0xf1)];await database_1[_0x2cc3eb(0x9f)][_0x2cc3eb(0x12d)]['update']({'where':{'id':_0x12bd68['id']},'data':{'currentPayments':_0x3f862a,'status':_0x472b8c,'updatedAt':new Date()}}),console['log'](_0x2cc3eb(0xa9)+_0x12bd68['id']+_0x2cc3eb(0x123)+_0x12bd68[_0x2cc3eb(0x10c)]+_0x2cc3eb(0x112)+_0x3f862a+_0x2cc3eb(0x188)+_0x12bd68[_0x2cc3eb(0xf1)]+_0x2cc3eb(0x112)+_0x472b8c);}catch(_0x599204){console[_0x2cc3eb(0xb5)](_0x2cc3eb(0xfb),_0x599204);}else console[_0x2cc3eb(0x109)](_0x2cc3eb(0xd5)+_0x1fccb2['id']+_0x2cc3eb(0xc4));}await database_1[_0x2cc3eb(0x9f)][_0x2cc3eb(0x101)][_0x2cc3eb(0x83)]({'data':{'paymentId':_0x1fccb2['id'],'shopId':_0x1fccb2[_0x2cc3eb(0xc3)],'event':_0x2cc3eb(0x122)+_0x28d3f3[_0x2cc3eb(0xf1)][_0x2cc3eb(0xa1)](),'statusCode':0xc8,'responseBody':JSON[_0x2cc3eb(0x17c)]({'oldStatus':_0x1fccb2['status'],'newStatus':_0x28d3f3[_0x2cc3eb(0xf1)],'paymentDetails':_0x28d3f3[_0x2cc3eb(0x8c)],'checkedAt':new Date()['toISOString']()})}}),await this[_0x2cc3eb(0x150)](_0x1fccb2,_0x28d3f3[_0x2cc3eb(0xf1)]),await this[_0x2cc3eb(0x192)](_0x1fccb2,_0x28d3f3[_0x2cc3eb(0xf1)]),_0x28d3f3[_0x2cc3eb(0xf1)]!=='PENDING'&&(console[_0x2cc3eb(0x109)](_0x2cc3eb(0x113)+_0x1fccb2['id']+'\x20status\x20changed\x20to\x20'+_0x28d3f3[_0x2cc3eb(0xf1)]+_0x2cc3eb(0x167)),this[_0x2cc3eb(0x129)](_0x1fccb2['id'])),console[_0x2cc3eb(0x109)](_0x2cc3eb(0xda)+_0x1fccb2['id']+_0x2cc3eb(0xca));}else console[_0x2cc3eb(0x109)](_0x2cc3eb(0xde)+_0x1fccb2['id']+_0x2cc3eb(0x127)+_0x28d3f3['status']+')'),this[_0x2cc3eb(0xef)](_0x1fccb2['id'],_0x1fccb2[_0x2cc3eb(0xbc)],_0x1fccb2[_0x2cc3eb(0xf1)],_0x28d3f3[_0x2cc3eb(0xf1)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x28d3f3[_0x2cc3eb(0x8c)],'amount':_0x28d3f3[_0x2cc3eb(0x120)],'currency':_0x28d3f3[_0x2cc3eb(0xc5)],'shopId':_0x1fccb2['shopId'],'checkTimestamp':new Date()['toISOString']()});}catch(_0x97b92f){console['error'](_0x2cc3eb(0x175)+_0x1fccb2['id']+':',_0x97b92f),this[_0x2cc3eb(0xf2)](_0x1fccb2['id'],_0x1fccb2[_0x2cc3eb(0xbc)],_0x97b92f,'status_check',{'paymentAmount':_0x1fccb2[_0x2cc3eb(0x120)],'paymentCurrency':_0x1fccb2[_0x2cc3eb(0xc5)],'shopId':_0x1fccb2[_0x2cc3eb(0xc3)],'createdAt':_0x1fccb2[_0x2cc3eb(0xbb)]}),await database_1[_0x2cc3eb(0x9f)][_0x2cc3eb(0x101)][_0x2cc3eb(0x83)]({'data':{'paymentId':_0x1fccb2['id'],'shopId':_0x1fccb2[_0x2cc3eb(0xc3)],'event':_0x2cc3eb(0xe7),'statusCode':0x1f4,'responseBody':JSON[_0x2cc3eb(0x17c)]({'error':_0x97b92f instanceof Error?_0x97b92f['message']:'Unknown\x20error','gatewayPaymentId':_0x1fccb2[_0x2cc3eb(0xbc)],'checkedAt':new Date()['toISOString']()})}});}}async[a48_0x12f973(0x150)](_0x7d7b94,_0xd9f19f){const _0x589bbd=a48_0x12f973,_0x53c6de=Date[_0x589bbd(0x14e)]();try{const _0x227394=_0x7d7b94['shop'],_0x4d19a1=_0x227394[_0x589bbd(0x89)];if(!_0x4d19a1?.[_0x589bbd(0x8d)]){console[_0x589bbd(0x109)](_0x589bbd(0x10a)+_0x227394['id']);return;}const _0x41ef70=_0xd9f19f===_0x589bbd(0x13a)?_0x589bbd(0xad):_0xd9f19f===_0x589bbd(0x94)?'payment.failed':_0xd9f19f===_0x589bbd(0x14b)?_0x589bbd(0x14d):_0x589bbd(0x195);if(!_0x4d19a1[_0x589bbd(0xb1)]?.[_0x589bbd(0x178)](_0x41ef70)){console[_0x589bbd(0x109)](_0x589bbd(0x18a)+_0x41ef70+_0x589bbd(0xe9)+_0x227394['id']);return;}const _0x427738=(0x0,gateway_1[_0x589bbd(0x18d)])(_0x7d7b94[_0x589bbd(0xb2)])||_0x7d7b94[_0x589bbd(0xb2)],_0x4e9517={'event':_0x41ef70,'payment':{'id':_0x7d7b94['id'],'order_id':_0x7d7b94[_0x589bbd(0xed)],'gateway_order_id':_0x7d7b94[_0x589bbd(0xdb)],'gateway':_0x427738,'amount':_0x7d7b94[_0x589bbd(0x120)],'currency':_0x7d7b94[_0x589bbd(0xc5)],'status':_0xd9f19f[_0x589bbd(0xa1)](),'customer_email':_0x7d7b94[_0x589bbd(0xb7)],'customer_name':_0x7d7b94[_0x589bbd(0x155)],'created_at':_0x7d7b94[_0x589bbd(0xbb)],'updated_at':new Date()}},_0x4e59f2=await fetch(_0x4d19a1[_0x589bbd(0x8d)],{'method':'POST','headers':{'Content-Type':_0x589bbd(0x14f),'User-Agent':_0x589bbd(0x92)},'body':JSON[_0x589bbd(0x17c)](_0x4e9517)}),_0x545f72=Date[_0x589bbd(0x14e)]()-_0x53c6de,_0x1e251f=_0x4e59f2['ok']?_0x589bbd(0x9a):await _0x4e59f2[_0x589bbd(0x11a)]();loggerService_1[_0x589bbd(0xd1)][_0x589bbd(0xdf)](_0x7d7b94['shopId'],_0x4d19a1[_0x589bbd(0x8d)],_0x41ef70,_0x4e59f2[_0x589bbd(0xf1)],_0x545f72,_0x4e9517),console[_0x589bbd(0x109)](_0x589bbd(0x93)+_0x4d19a1[_0x589bbd(0x8d)]+_0x589bbd(0xcf)+_0x4e59f2['status']+'\x20('+_0x545f72+_0x589bbd(0x185));}catch(_0x384e69){console['error'](_0x589bbd(0x18c),_0x384e69),loggerService_1[_0x589bbd(0xd1)][_0x589bbd(0x128)](_0x7d7b94['shopId'],_0x7d7b94[_0x589bbd(0x158)]?.[_0x589bbd(0x89)]?.[_0x589bbd(0x8d)]||_0x589bbd(0xb8),_0x589bbd(0x135),_0x384e69,{});}}async[a48_0x12f973(0x192)](_0x1f9076,_0x4387c1){const _0x59ff3a=a48_0x12f973;try{const _0x3838af={'PENDING':_0x59ff3a(0x149),'PAID':'paid','FAILED':_0x59ff3a(0x193),'EXPIRED':_0x59ff3a(0x85)},_0x5b8604=_0x3838af[_0x4387c1];if(!_0x5b8604||_0x5b8604==='created')return;await telegramBotService_1[_0x59ff3a(0x11f)][_0x59ff3a(0xe5)](_0x1f9076[_0x59ff3a(0xc3)],_0x1f9076,_0x5b8604);}catch(_0x4c154a){console[_0x59ff3a(0xb5)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x4c154a);}}async['checkPaymentById'](_0x498113){const _0x314405=a48_0x12f973;console['log'](_0x314405(0xe3)+_0x498113);const _0x4ec0bd=await database_1[_0x314405(0x9f)][_0x314405(0x10b)][_0x314405(0x197)]({'where':{'id':_0x498113},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4ec0bd)throw new Error(_0x314405(0x187));if(_0x4ec0bd[_0x314405(0xb2)]!==_0x314405(0x12b)&&_0x4ec0bd[_0x314405(0xb2)]!==_0x314405(0xdd))throw new Error(_0x314405(0x100));console[_0x314405(0x109)]('‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x4ec0bd[_0x314405(0xb2)]+_0x314405(0xc8)+_0x498113),await this['checkSinglePayment'](_0x4ec0bd),console[_0x314405(0x109)](_0x314405(0xc9)+_0x498113);}[a48_0x12f973(0x117)](){const _0x844f3c=a48_0x12f973,_0x240bc1=this[_0x844f3c(0xa0)]?this[_0x844f3c(0xfe)]:undefined,_0x5515db=Array[_0x844f3c(0x173)](this[_0x844f3c(0xf5)]['values']())[_0x844f3c(0x172)](_0xe3a13a=>({'paymentId':_0xe3a13a['paymentId'],'gatewayPaymentId':_0xe3a13a[_0x844f3c(0xbc)],'createdAt':_0xe3a13a['createdAt'],'timersCount':_0xe3a13a[_0x844f3c(0x18e)]['length']}));return{'isActive':!!this[_0x844f3c(0xa0)],'globalCheckIntervalMinutes':this[_0x844f3c(0xfe)]/(0x3e8*0x3c),'expiryDays':this[_0x844f3c(0x132)],'activeIndividualTimers':this[_0x844f3c(0xf5)]['size'],'nextGlobalCheckIn':_0x240bc1,'paymentTimersDetails':_0x5515db};}[a48_0x12f973(0x9e)](_0x2e6b38){const _0x37c6e9=a48_0x12f973,_0x36596b=this[_0x37c6e9(0xf5)][_0x37c6e9(0xea)](_0x2e6b38);if(_0x36596b)return{'hasTimers':!![],'timersCount':_0x36596b[_0x37c6e9(0x18e)][_0x37c6e9(0x88)],'createdAt':_0x36596b['createdAt'],'gatewayPaymentId':_0x36596b[_0x37c6e9(0xbc)]};return{'hasTimers':![]};}async['getGatewayCommission'](_0x4a5d45,_0x3c8b81){const _0x4a1c9b=a48_0x12f973;try{const _0xdfec6e=await database_1[_0x4a1c9b(0x9f)][_0x4a1c9b(0x158)][_0x4a1c9b(0x197)]({'where':{'id':_0x4a5d45},'select':{'gatewaySettings':!![]}});if(!_0xdfec6e?.[_0x4a1c9b(0x177)])return console[_0x4a1c9b(0x109)]('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0x4a5d45+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x2764b3=JSON[_0x4a1c9b(0xb9)](_0xdfec6e[_0x4a1c9b(0x177)]);for(const [_0x7a6f62,_0x1dacad]of Object[_0x4a1c9b(0x118)](_0x2764b3)){if(_0x7a6f62[_0x4a1c9b(0xa1)]()===_0x3c8b81[_0x4a1c9b(0xa1)]()){const _0x2d0c5a=_0x1dacad[_0x4a1c9b(0x107)]||0xa;return console[_0x4a1c9b(0x109)](_0x4a1c9b(0xee)+_0x3c8b81+_0x4a1c9b(0xc6)+_0x4a5d45+':\x20'+_0x2d0c5a+'%'),_0x2d0c5a;}}return console[_0x4a1c9b(0x109)](_0x4a1c9b(0x80)+_0x3c8b81+_0x4a1c9b(0x102)+_0x4a5d45+_0x4a1c9b(0xf9)),0xa;}catch(_0x3b83d8){return console[_0x4a1c9b(0xb5)](_0x4a1c9b(0x111)+_0x4a5d45+_0x4a1c9b(0xf3)+_0x3c8b81+':',_0x3b83d8),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a48_0x12f973(0x174)]=new CoinToPayStatusService();