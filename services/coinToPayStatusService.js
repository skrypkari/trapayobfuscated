'use strict';const a57_0x26267a=a57_0x5d4e;(function(_0x2d4a20,_0x3bf724){const _0x32b8b2=a57_0x5d4e,_0x4cb035=_0x2d4a20();while(!![]){try{const _0x157208=-parseInt(_0x32b8b2(0x1db))/0x1*(parseInt(_0x32b8b2(0x169))/0x2)+parseInt(_0x32b8b2(0x1fa))/0x3+-parseInt(_0x32b8b2(0x16a))/0x4+parseInt(_0x32b8b2(0x1ef))/0x5*(parseInt(_0x32b8b2(0x1f3))/0x6)+parseInt(_0x32b8b2(0x138))/0x7+-parseInt(_0x32b8b2(0x1c7))/0x8*(-parseInt(_0x32b8b2(0x10a))/0x9)+parseInt(_0x32b8b2(0x10b))/0xa*(parseInt(_0x32b8b2(0x1b2))/0xb);if(_0x157208===_0x3bf724)break;else _0x4cb035['push'](_0x4cb035['shift']());}catch(_0x138d93){_0x4cb035['push'](_0x4cb035['shift']());}}}(a57_0x59e1,0xc4935));function a57_0x59e1(){const _0xf7cdee=['‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20\x20\x20-\x20gatewayPaymentId:\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','payment.success','convertToUSDT','timestamp','paymentTimers','webhook_send','GLOBAL_CHECK_INTERVAL_MS','payment.failed','‚úÖ\x20[CHECK]\x20Payment\x20','\x20USDT','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','customerEmail','üìà\x20[COINTOPAY]\x20Payment\x20','payment','toFixed','status','‚è∞\x20[HOURLY]\x20Payment\x20','1\x20minute','hex','1342106zLLQhB','2912352gsZWHO','createdAt','Shop\x20webhook\x20sent\x20to\x20','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','size','shop','findUnique','./gateways/coinToPayService','\x20\x20\x20üìä\x20Status:\x20',',\x20stopping\x20individual\x20checks','\x20has\x20no\x20gatewayPaymentId','Unknown\x20error','getGatewayCommission','\x20expired','\x20checked,\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20to\x20','not\x20confirmed','coinToPay2Service','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','includes','delay','timers','\x20current\x20status:\x20','findMany','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','\x20completed\x20for\x20payment\x20','webhookUrl','\x20amounts\x20calculated:','payment.pending','getGatewayIdByName','\x20initial\x20timers\x20for\x20payment\x20','checkAllPendingPayments','catch','toLowerCase','\x20pending\x20CoinToPay\x20payments','\x20in\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','-day\x20timeout','sha256','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','\x20commission:\x20','iban','application/json','unknown','cointopay','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','\x20\x20\x20Gateway\x20','\x20status\x20from\x20','createdOn','üìä\x20[CHECK]\x20Payment\x20','paidAt','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','schedulePaymentChecks','\x20\x20\x20-\x20Amount:\x20','\x20is\x20older\x20than\x20','log','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','has','üßπ\x20[CHECK]\x20Payment\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','__esModule','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','\x20marked\x20as\x20paid\x20at:\x20','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','\x20\x20\x20üìù\x20Context:','Payment\x20System/1.0','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','/status/','stack','\x20\x20\x20-\x20Gateway:\x20','2723017kafgnD','logShopWebhookError','__importDefault','transactionId','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','map','üõë\x20[SHUTDOWN]\x20Cleared\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20status:\x20','parse','entries','CoinToPayStatusService','toISOString','\x20\x20\x20üìç\x20Source:\x20','./telegramBotService','ms)','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','checkPaymentById','üìä\x20[HOURLY]\x20Payment\x20','type','16hdPhJJ','.\x20Remaining\x20active\x20timers:\x20','settings','logWhiteDomainError','\x20\x20\x20üìÖ\x20Time:\x20','üßπ\x20[DEBUG]\x20Clearing\x20','Payment\x20older\x20than\x20','checkSinglePayment','\x20\x20\x20Amount\x20after\x20commission:\x20','not\x20found','üí∞\x20[CHECK]\x20Payment\x20','remitterIban','message','update','currency','COMPLETED','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','\x20is\x20too\x20new\x20(','length','\x20timers\x20for\x20payment\x20','2UuXCSa','‚úÖ\x20[HOURLY]\x20Payment\x20','\x20payment\x20','now','sendPaymentNotification','paid','\x20individual\x20payment\x20timers','loggerService','cointopay_status_check_error','Webhook\x20event\x20','floor','crypto','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','getDate',',\x20using\x20default\x2010%','customerName','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','commission','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','getTime','229945lIkMqu','description','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','amountAfterGatewayCommissionUSDT','18lGZXAW','sendPaymentStatusNotification','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','‚ùå\x20[CHECK]\x20Payment\x20','setDate','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','2909874VKCSwL','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','\x20days,\x20marking\x20as\x20EXPIRED','\x20for\x20payment\x20','\x20->\x20','paymentLink','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','auto_expire','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','Failed\x20to\x20mark\x20payment\x20as\x20expired','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','values','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','digest','checkPaymentStatus','forEach','\x20not\x20found,\x20clearing\x20timers','globalCheckInterval','cointopay_auto_expired','‚è∞\x20[GLOBAL]\x20Payment\x20','../types/gateway','getPaymentTimerInfo','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','logCoinToPayError','clearPaymentTimers','shopId','CoinToPayService',',\x20status=','checkExpiredPayments','gateway','../config/database','amountUSDT','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','default','getServiceStats','push','578169ayHMmm','20SbpCrl','\x20days','startPeriodicStatusCheck','\x20days\x20(created\x20before\x20','./gateways/coinToPay2Service','\x20status\x20unchanged\x20(','\x20status\x20is\x20','5\x20minutes','\x20\x20\x20-\x20ShopId:\x20','FAILED','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','error','defineProperty','\x20has\x20no\x20gatewayPaymentId,\x20skipping','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','gatewayPaymentId','text','POST','gatewayCommissionRate','amount','EXPIRY_DAYS','get','Payment\x20not\x20found','stopPeriodicStatusCheck',':\x20type=','webhookLog','orderId','paymentDetails',',\x20using\x20default\x20commission\x2010%','gatewaySettings','confirmedOn','create','\x20not\x20found\x20in\x20database','\x20updated:\x20currentPayments=','currencyService','created','PAID','‚úÖ\x20[EXPIRY]\x20Payment\x20','currentPayments','EXPIRED','\x20commission\x20for\x20shop\x20','coinToPayService','from','8007062IdujSC','\x20\x20\x20Amount:\x20','\x20updated\x20successfully','stringify','status_check','set','./currencyService','\x20\x20\x20‚ùå\x20Error:\x20','checkSinglePaymentById','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20',',\x20gateway\x20','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','cointopay2','logCoinToPayStatus','\x20details:','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','expired','COINTOPAY_STATUS_CHANGE','delete','üîç\x20[CHECK]\x20Checking\x20','sendShopWebhook','COINTOPAY_ERROR','\x20expired\x20CoinToPay\x20payments','\x20skipped,\x20','Success','logShopWebhookSent','PENDING'];a57_0x59e1=function(){return _0xf7cdee;};return a57_0x59e1();}function a57_0x5d4e(_0x389dfb,_0x305f95){_0x389dfb=_0x389dfb-0xf9;const _0x59e127=a57_0x59e1();let _0x5d4e72=_0x59e127[_0x389dfb];return _0x5d4e72;}var __importDefault=this&&this[a57_0x26267a(0x1b4)]||function(_0x1ff770){return _0x1ff770&&_0x1ff770['__esModule']?_0x1ff770:{'default':_0x1ff770};};Object[a57_0x26267a(0x119)](exports,a57_0x26267a(0x1a8),{'value':!![]}),exports['coinToPayStatusService']=exports[a57_0x26267a(0x1bd)]=void 0x0;const crypto_1=__importDefault(require(a57_0x26267a(0x1e6))),coinToPayService_1=require(a57_0x26267a(0x171)),coinToPay2Service_1=require(a57_0x26267a(0x10f)),gateway_1=require(a57_0x26267a(0xfa)),database_1=__importDefault(require(a57_0x26267a(0x104))),telegramBotService_1=require(a57_0x26267a(0x1c0)),loggerService_1=require('./loggerService'),currencyService_1=require(a57_0x26267a(0x13e));class CoinToPayStatusService{constructor(){const _0x51d84f=a57_0x26267a;this[_0x51d84f(0x20d)]=null,this[_0x51d84f(0x15c)]=0x3c*0x3c*0x3e8,this[_0x51d84f(0x121)]=0x5,this[_0x51d84f(0x15a)]=new Map(),this[_0x51d84f(0x136)]=new coinToPayService_1[(_0x51d84f(0x100))](),this[_0x51d84f(0x17d)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x51d84f(0x1a3)](_0x51d84f(0x1f8));}[a57_0x26267a(0x1a0)](_0xe3773c,_0x8db9f2){const _0x1540f1=a57_0x26267a;console['log'](_0x1540f1(0x117)),console[_0x1540f1(0x1a3)]('\x20\x20\x20-\x20paymentId:\x20'+_0xe3773c),console[_0x1540f1(0x1a3)](_0x1540f1(0x155)+_0x8db9f2),this[_0x1540f1(0xfe)](_0xe3773c);const _0x59e9dc=[],_0x16f87b=new Date(),_0x339c65=[{'delay':0x1*0x3c*0x3e8,'description':_0x1540f1(0x167)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x1540f1(0x112)},{'delay':0x5*0x3c*0x3e8,'description':_0x1540f1(0x112)}];console[_0x1540f1(0x1a3)]('ü™ô\x20[DEBUG]\x20Creating\x20'+_0x339c65['length']+_0x1540f1(0x18a)+_0xe3773c);let _0x148774=0x0;_0x339c65[_0x1540f1(0x20b)]((_0x3e8de4,_0x50d190)=>{const _0x265d5a=_0x1540f1;_0x148774+=_0x3e8de4['delay'];const _0x31ebe2=setTimeout(async()=>{const _0x34e831=a57_0x5d4e;console[_0x34e831(0x1a3)]('ü™ô\x20[TIMER]\x20Individual\x20check\x20#'+(_0x50d190+0x1)+'\x20triggered\x20for\x20payment\x20'+_0xe3773c+'\x20(after\x20'+_0x3e8de4[_0x34e831(0x1f0)]+')');try{await this[_0x34e831(0x140)](_0xe3773c),console[_0x34e831(0x1a3)](_0x34e831(0x1fc)+(_0x50d190+0x1)+_0x34e831(0x185)+_0xe3773c);}catch(_0x5e4855){console[_0x34e831(0x118)](_0x34e831(0x154)+(_0x50d190+0x1)+_0x34e831(0x1fe)+_0xe3773c+':',_0x5e4855),this[_0x34e831(0xfd)](_0xe3773c,_0x8db9f2,_0x5e4855,_0x34e831(0x13c),{'checkNumber':_0x50d190+0x1,'scheduledAfter':_0x3e8de4['description'],'isIndividualCheck':!![]});}},_0x148774);_0x59e9dc[_0x265d5a(0x109)](_0x31ebe2),console[_0x265d5a(0x1a3)](_0x265d5a(0x203)+(_0x50d190+0x1)+_0x265d5a(0x1fe)+_0xe3773c+_0x265d5a(0x18f)+_0x148774/0x3e8+'\x20seconds\x20('+_0x3e8de4[_0x265d5a(0x1f0)]+')');});const _0x467a90=setInterval(async()=>{const _0x3038f2=_0x1540f1;console[_0x3038f2(0x1a3)](_0x3038f2(0x1c2)+_0xe3773c);try{const _0x15daba=await database_1['default'][_0x3038f2(0x163)][_0x3038f2(0x170)]({'where':{'id':_0xe3773c},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x15daba){console['log']('‚ùå\x20[HOURLY]\x20Payment\x20'+_0xe3773c+_0x3038f2(0x20c)),this[_0x3038f2(0xfe)](_0xe3773c);return;}console[_0x3038f2(0x1a3)](_0x3038f2(0x1c5)+_0xe3773c+_0x3038f2(0x182)+_0x15daba['status']);if(_0x15daba[_0x3038f2(0x165)]!==_0x3038f2(0x153)){console[_0x3038f2(0x1a3)](_0x3038f2(0x1dc)+_0xe3773c+_0x3038f2(0x111)+_0x15daba['status']+',\x20stopping\x20individual\x20checks'),this[_0x3038f2(0xfe)](_0xe3773c);return;}const _0x2f2836=Math[_0x3038f2(0x1e5)]((Date[_0x3038f2(0x1de)]()-_0x15daba[_0x3038f2(0x16b)][_0x3038f2(0x1ee)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x2f2836>=this[_0x3038f2(0x121)]){console['log'](_0x3038f2(0x166)+_0xe3773c+_0x3038f2(0x1a2)+this[_0x3038f2(0x121)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this['clearPaymentTimers'](_0xe3773c);return;}await this[_0x3038f2(0x140)](_0xe3773c),console[_0x3038f2(0x1a3)]('‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0xe3773c);}catch(_0x586ebb){console[_0x3038f2(0x118)](_0x3038f2(0x1e7)+_0xe3773c+':',_0x586ebb),this[_0x3038f2(0xfd)](_0xe3773c,_0x8db9f2,_0x586ebb,_0x3038f2(0x13c),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x59e9dc[_0x1540f1(0x109)](_0x467a90),this[_0x1540f1(0x15a)][_0x1540f1(0x13d)](_0xe3773c,{'timers':_0x59e9dc,'paymentId':_0xe3773c,'gatewayPaymentId':_0x8db9f2,'createdAt':_0x16f87b}),console[_0x1540f1(0x1a3)](_0x1540f1(0x106)+_0x339c65['length']+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0xe3773c),console['log'](_0x1540f1(0x1c3)+this[_0x1540f1(0x15a)]['size']),this[_0x1540f1(0x146)](_0xe3773c,_0x8db9f2,_0x1540f1(0x153),_0x1540f1(0x153),_0x1540f1(0x13c),{'action':'schedule_created','scheduledChecks':_0x339c65['length'],'firstCheckIn':_0x339c65[0x0][_0x1540f1(0x180)]/0x3e8,'totalTimers':this[_0x1540f1(0x15a)][_0x1540f1(0x16e)]});}['clearPaymentTimers'](_0x43cb2e){const _0x2ddd63=a57_0x26267a,_0x43716c=this[_0x2ddd63(0x15a)][_0x2ddd63(0x122)](_0x43cb2e);_0x43716c?(console[_0x2ddd63(0x1a3)](_0x2ddd63(0x1cc)+_0x43716c[_0x2ddd63(0x181)]['length']+_0x2ddd63(0x1da)+_0x43cb2e),_0x43716c[_0x2ddd63(0x181)][_0x2ddd63(0x20b)]((_0x5031a6,_0x294310)=>{const _0x18c5d8=_0x2ddd63;_0x5031a6&&(clearTimeout(_0x5031a6),clearInterval(_0x5031a6),console['log'](_0x18c5d8(0x1ae)+(_0x294310+0x1)+_0x18c5d8(0x1fe)+_0x43cb2e));}),this['paymentTimers'][_0x2ddd63(0x14b)](_0x43cb2e),console[_0x2ddd63(0x1a3)]('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x43cb2e+_0x2ddd63(0x1c8)+this[_0x2ddd63(0x15a)][_0x2ddd63(0x16e)])):console[_0x2ddd63(0x1a3)](_0x2ddd63(0x148)+_0x43cb2e+'\x20to\x20clear');}async['checkSinglePaymentById'](_0x52f388){const _0x56d920=a57_0x26267a;console['log']('üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x52f388);const _0x2c58ec=await database_1[_0x56d920(0x107)][_0x56d920(0x163)]['findUnique']({'where':{'id':_0x52f388},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2c58ec){console[_0x56d920(0x1a3)](_0x56d920(0x1f6)+_0x52f388+_0x56d920(0x12d));return;}console[_0x56d920(0x1a3)](_0x56d920(0x19d)+_0x52f388+'\x20found:'),console[_0x56d920(0x1a3)](_0x56d920(0x1b1)+_0x2c58ec[_0x56d920(0x103)]),console[_0x56d920(0x1a3)]('\x20\x20\x20-\x20Status:\x20'+_0x2c58ec['status']),console[_0x56d920(0x1a3)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x2c58ec[_0x56d920(0x11c)]),console[_0x56d920(0x1a3)](_0x56d920(0x1a1)+_0x2c58ec[_0x56d920(0x120)]+'\x20'+_0x2c58ec['currency']),console[_0x56d920(0x1a3)](_0x56d920(0x113)+_0x2c58ec[_0x56d920(0xff)]);if(_0x2c58ec['gateway']!==_0x56d920(0x198)&&_0x2c58ec[_0x56d920(0x103)]!==_0x56d920(0x145)){console[_0x56d920(0x1a3)](_0x56d920(0x184)+_0x52f388+_0x56d920(0x1ed)+_0x2c58ec[_0x56d920(0x103)]+')');return;}if(_0x2c58ec['status']!==_0x56d920(0x153)){console['log'](_0x56d920(0x184)+_0x52f388+'\x20status\x20is\x20'+_0x2c58ec[_0x56d920(0x165)]+_0x56d920(0x173)),this[_0x56d920(0xfe)](_0x52f388);return;}if(!_0x2c58ec['gatewayPaymentId']){console[_0x56d920(0x1a3)](_0x56d920(0x184)+_0x52f388+_0x56d920(0x174));return;}console['log']('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x52f388+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this[_0x56d920(0x1ce)](_0x2c58ec);}[a57_0x26267a(0x146)](_0x496e92,_0x402f41,_0x1f868b,_0x242f74,_0x4ae6f2,_0x331c05){const _0x2242bc=a57_0x26267a,_0x55401e={'type':_0x2242bc(0x14a),'paymentId':_0x496e92,'gatewayPaymentId':_0x402f41,'oldStatus':_0x1f868b,'newStatus':_0x242f74,'source':_0x4ae6f2,'timestamp':new Date()[_0x2242bc(0x1be)](),'details':_0x331c05||{}};loggerService_1[_0x2242bc(0x1e2)][_0x2242bc(0x146)](_0x55401e),console[_0x2242bc(0x1a3)]('ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x496e92+'\x20('+_0x402f41+')'),console[_0x2242bc(0x1a3)](_0x2242bc(0x172)+_0x1f868b+_0x2242bc(0x1ff)+_0x242f74),console[_0x2242bc(0x1a3)](_0x2242bc(0x1bf)+_0x4ae6f2),console[_0x2242bc(0x1a3)](_0x2242bc(0x1cb)+_0x55401e[_0x2242bc(0x159)]),_0x331c05&&console[_0x2242bc(0x1a3)]('\x20\x20\x20üìù\x20Details:',_0x331c05);}['logCoinToPayError'](_0x142cd8,_0x4c0d84,_0x3afd8a,_0x138e0a,_0x45e8c0){const _0x196d8e=a57_0x26267a,_0x5cee62={'type':_0x196d8e(0x14e),'paymentId':_0x142cd8,'gatewayPaymentId':_0x4c0d84,'error':_0x3afd8a instanceof Error?{'message':_0x3afd8a['message'],'stack':_0x3afd8a[_0x196d8e(0x1b0)]}:_0x3afd8a,'source':_0x138e0a,'timestamp':new Date()['toISOString'](),'context':_0x45e8c0||{}};loggerService_1['loggerService'][_0x196d8e(0xfd)](_0x5cee62),console[_0x196d8e(0x118)](_0x196d8e(0x142)+_0x142cd8+'\x20('+_0x4c0d84+')'),console['error'](_0x196d8e(0x13f)+(_0x3afd8a instanceof Error?_0x3afd8a[_0x196d8e(0x1d3)]:_0x3afd8a)),console[_0x196d8e(0x118)](_0x196d8e(0x1bf)+_0x138e0a),console[_0x196d8e(0x118)](_0x196d8e(0x1cb)+_0x5cee62[_0x196d8e(0x159)]),_0x45e8c0&&console[_0x196d8e(0x118)](_0x196d8e(0x1ac),_0x45e8c0);}[a57_0x26267a(0x10d)](){const _0x47629b=a57_0x26267a;console['log'](_0x47629b(0x1eb)),this[_0x47629b(0x18b)]()[_0x47629b(0x18c)](_0x159bc3=>{const _0x3bede2=_0x47629b;console[_0x3bede2(0x118)](_0x3bede2(0x116),_0x159bc3);}),this['globalCheckInterval']=setInterval(async()=>{const _0x192d26=_0x47629b;try{console[_0x192d26(0x1a3)](_0x192d26(0x144)),await this[_0x192d26(0x18b)](),console[_0x192d26(0x1a3)](_0x192d26(0x1a4));}catch(_0x2e02b){console[_0x192d26(0x118)]('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x2e02b);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x47629b(0x1a3)]('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a57_0x26267a(0x124)](){const _0xa369f=a57_0x26267a;console[_0xa369f(0x1a3)]('üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0xa369f(0x20d)]&&(clearInterval(this[_0xa369f(0x20d)]),this[_0xa369f(0x20d)]=null,console['log'](_0xa369f(0x17a)));const _0x4b0817=this['paymentTimers'][_0xa369f(0x16e)];for(const [_0x3b3e74]of this[_0xa369f(0x15a)]){this['clearPaymentTimers'](_0x3b3e74);}console[_0xa369f(0x1a3)](_0xa369f(0x1b8)+_0x4b0817+_0xa369f(0x1e1));}async[a57_0x26267a(0x18b)](){const _0xeaa13c=a57_0x26267a;try{console['log'](_0xeaa13c(0x17e));const _0xdad240=await database_1['default'][_0xeaa13c(0x163)][_0xeaa13c(0x183)]({'where':{'gateway':{'in':[_0xeaa13c(0x198),_0xeaa13c(0x145)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0xeaa13c(0x1a3)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0xdad240['length']+_0xeaa13c(0x18e));if(_0xdad240['length']===0x0){console[_0xeaa13c(0x1a3)](_0xeaa13c(0x1f5));return;}const _0x2dc67e=await this[_0xeaa13c(0x102)](_0xdad240);console[_0xeaa13c(0x1a3)]('‚è∞\x20[GLOBAL]\x20Found\x20'+_0x2dc67e[_0xeaa13c(0x1d9)]+_0xeaa13c(0x14f));let _0x8ce4cf=0x0,_0x33a54b=0x0;for(const _0x545b72 of _0xdad240){try{if(_0x2dc67e[_0xeaa13c(0x17f)](_0x545b72['id'])){console[_0xeaa13c(0x1a3)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x545b72['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x33a54b++;continue;}if(this[_0xeaa13c(0x15a)][_0xeaa13c(0x1a5)](_0x545b72['id'])){console['log'](_0xeaa13c(0xf9)+_0x545b72['id']+_0xeaa13c(0x141)),_0x33a54b++;continue;}const _0x4867b8=(Date[_0xeaa13c(0x1de)]()-_0x545b72['createdAt'][_0xeaa13c(0x1ee)]())/(0x3e8*0x3c*0x3c);if(_0x4867b8<0x1){console[_0xeaa13c(0x1a3)](_0xeaa13c(0xf9)+_0x545b72['id']+_0xeaa13c(0x1d8)+_0x4867b8[_0xeaa13c(0x164)](0x1)+'h),\x20skipping\x20global\x20check'),_0x33a54b++;continue;}console[_0xeaa13c(0x1a3)](_0xeaa13c(0x11b)+_0x545b72['id']+'\x20(age:\x20'+_0x4867b8[_0xeaa13c(0x164)](0x1)+'h)'),await this[_0xeaa13c(0x1ce)](_0x545b72),_0x8ce4cf++,await new Promise(_0x1b1995=>setTimeout(_0x1b1995,0x7d0));}catch(_0x23947c){console[_0xeaa13c(0x118)](_0xeaa13c(0x1a7)+_0x545b72['id']+':',_0x23947c),this[_0xeaa13c(0xfd)](_0x545b72['id'],_0x545b72[_0xeaa13c(0x11c)]||'unknown',_0x23947c,_0xeaa13c(0x13c),{'isGlobalCheck':!![],'paymentAmount':_0x545b72[_0xeaa13c(0x120)],'paymentCurrency':_0x545b72[_0xeaa13c(0x1d5)],'shopId':_0x545b72[_0xeaa13c(0xff)],'createdAt':_0x545b72['createdAt']}),loggerService_1[_0xeaa13c(0x1e2)][_0xeaa13c(0x1ca)](_0xeaa13c(0x198),_0xeaa13c(0x1af)+_0x545b72[_0xeaa13c(0x11c)],_0x23947c);}}console[_0xeaa13c(0x1a3)](_0xeaa13c(0x1fb)+_0x8ce4cf+_0xeaa13c(0x178)+_0x33a54b+_0xeaa13c(0x150)+_0x2dc67e['length']+_0xeaa13c(0x177));}catch(_0x1f16ea){console['error']('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x1f16ea);}}async['checkExpiredPayments'](_0x130f17){const _0x57e4e2=a57_0x26267a,_0x38dba=[],_0x3a3d6d=new Date();_0x3a3d6d[_0x57e4e2(0x1f7)](_0x3a3d6d[_0x57e4e2(0x1e8)]()-this['EXPIRY_DAYS']),console['log']('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x57e4e2(0x10e)+_0x3a3d6d[_0x57e4e2(0x1be)]()+')');for(const _0x556a45 of _0x130f17){if(_0x556a45[_0x57e4e2(0x16b)]<_0x3a3d6d){console[_0x57e4e2(0x1a3)]('‚è∞\x20[EXPIRY]\x20Payment\x20'+_0x556a45['id']+'\x20is\x20older\x20than\x20'+this[_0x57e4e2(0x121)]+_0x57e4e2(0x1fd));try{this[_0x57e4e2(0x146)](_0x556a45['id'],_0x556a45[_0x57e4e2(0x11c)]||_0x57e4e2(0x197),_0x57e4e2(0x153),_0x57e4e2(0x134),_0x57e4e2(0x202),{'reason':_0x57e4e2(0x1cd)+this[_0x57e4e2(0x121)]+_0x57e4e2(0x10c),'createdAt':_0x556a45['createdAt'],'daysSinceCreation':Math[_0x57e4e2(0x1e5)]((Date[_0x57e4e2(0x1de)]()-_0x556a45[_0x57e4e2(0x16b)]['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x556a45[_0x57e4e2(0x120)],'paymentCurrency':_0x556a45[_0x57e4e2(0x1d5)],'shopId':_0x556a45[_0x57e4e2(0xff)]}),await database_1[_0x57e4e2(0x107)][_0x57e4e2(0x163)]['update']({'where':{'id':_0x556a45['id']},'data':{'status':_0x57e4e2(0x134),'updatedAt':new Date()}}),await database_1[_0x57e4e2(0x107)][_0x57e4e2(0x126)][_0x57e4e2(0x12c)]({'data':{'paymentId':_0x556a45['id'],'shopId':_0x556a45[_0x57e4e2(0xff)],'event':_0x57e4e2(0x20e),'statusCode':0xc8,'responseBody':JSON[_0x57e4e2(0x13b)]({'reason':_0x57e4e2(0x1cd)+this[_0x57e4e2(0x121)]+_0x57e4e2(0x10c),'createdAt':_0x556a45[_0x57e4e2(0x16b)],'expiredAt':new Date()[_0x57e4e2(0x1be)](),'daysSinceCreation':Math[_0x57e4e2(0x1e5)]((Date['now']()-_0x556a45[_0x57e4e2(0x16b)][_0x57e4e2(0x1ee)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x556a45,_0x57e4e2(0x134)),await this[_0x57e4e2(0x1f4)](_0x556a45,'EXPIRED'),this[_0x57e4e2(0xfe)](_0x556a45['id']),_0x38dba[_0x57e4e2(0x109)](_0x556a45['id']),console['log'](_0x57e4e2(0x132)+_0x556a45['id']+_0x57e4e2(0x199)+this[_0x57e4e2(0x121)]+_0x57e4e2(0x191));}catch(_0x325676){console['error'](_0x57e4e2(0x206)+_0x556a45['id']+':',_0x325676),this['logCoinToPayError'](_0x556a45['id'],_0x556a45[_0x57e4e2(0x11c)]||'unknown',_0x325676,'auto_expire',{'reason':_0x57e4e2(0x204),'createdAt':_0x556a45[_0x57e4e2(0x16b)],'daysSinceCreation':Math[_0x57e4e2(0x1e5)]((Date[_0x57e4e2(0x1de)]()-_0x556a45[_0x57e4e2(0x16b)][_0x57e4e2(0x1ee)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x38dba;}async[a57_0x26267a(0x1ce)](_0x37a9de){const _0x368ade=a57_0x26267a;if(!_0x37a9de[_0x368ade(0x11c)]){console[_0x368ade(0x1a3)](_0x368ade(0x184)+_0x37a9de['id']+_0x368ade(0x11a));return;}console[_0x368ade(0x1a3)](_0x368ade(0x14c)+_0x37a9de[_0x368ade(0x103)]+'\x20payment\x20'+_0x37a9de['id']+'\x20('+_0x37a9de[_0x368ade(0x11c)]+')');try{let _0x3186d5;_0x37a9de[_0x368ade(0x103)]===_0x368ade(0x145)?(_0x3186d5=await this[_0x368ade(0x17d)]['checkPaymentStatus'](_0x37a9de[_0x368ade(0x11c)]),console[_0x368ade(0x1a3)](_0x368ade(0x201)+_0x37a9de['id']+_0x368ade(0x1ba)+_0x3186d5[_0x368ade(0x165)])):(_0x3186d5=await this['coinToPayService'][_0x368ade(0x20a)](_0x37a9de[_0x368ade(0x11c)]),console[_0x368ade(0x1a3)](_0x368ade(0xfc)+_0x37a9de['id']+_0x368ade(0x1ba)+_0x3186d5[_0x368ade(0x165)]));_0x3186d5[_0x368ade(0x128)]&&console[_0x368ade(0x1a3)](_0x368ade(0x19d)+_0x37a9de['id']+_0x368ade(0x147),{'iban':_0x3186d5[_0x368ade(0x128)]['iban']||_0x368ade(0x1d0),'transactionId':_0x3186d5[_0x368ade(0x128)]['transactionId'],'createdOn':_0x3186d5[_0x368ade(0x128)][_0x368ade(0x19c)],'confirmedOn':_0x3186d5[_0x368ade(0x128)][_0x368ade(0x12b)]||_0x368ade(0x17c)});if(_0x3186d5[_0x368ade(0x165)]!==_0x37a9de['status']){console[_0x368ade(0x1a3)](_0x368ade(0x1a9)+_0x37a9de['id']+_0x368ade(0x19b)+_0x37a9de[_0x368ade(0x165)]+_0x368ade(0x17b)+_0x3186d5[_0x368ade(0x165)]),this[_0x368ade(0x146)](_0x37a9de['id'],_0x37a9de[_0x368ade(0x11c)],_0x37a9de[_0x368ade(0x165)],_0x3186d5[_0x368ade(0x165)],'status_check',{'paymentDetails':_0x3186d5[_0x368ade(0x128)],'amount':_0x3186d5[_0x368ade(0x120)],'currency':_0x3186d5[_0x368ade(0x1d5)],'shopId':_0x37a9de[_0x368ade(0xff)],'checkTimestamp':new Date()[_0x368ade(0x1be)]()});const _0x3d534c={'status':_0x3186d5[_0x368ade(0x165)],'updatedAt':new Date()};if(_0x3186d5['status']===_0x368ade(0x131)&&_0x37a9de['status']!==_0x368ade(0x131)){_0x3d534c[_0x368ade(0x19e)]=new Date();if(!_0x37a9de['amountUSDT']){const _0x374b64=await currencyService_1[_0x368ade(0x12f)][_0x368ade(0x158)](_0x37a9de[_0x368ade(0x120)],_0x37a9de[_0x368ade(0x1d5)]);_0x3d534c[_0x368ade(0x105)]=_0x374b64;const _0x24aa5f=await this['getGatewayCommission'](_0x37a9de[_0x368ade(0xff)],_0x37a9de[_0x368ade(0x103)]),_0x54b1c0=_0x374b64*(0x1-_0x24aa5f/0x64);_0x3d534c[_0x368ade(0x1f2)]=_0x54b1c0,_0x3d534c[_0x368ade(0x11f)]=_0x24aa5f,console['log'](_0x368ade(0x1d1)+_0x37a9de['id']+_0x368ade(0x187)),console[_0x368ade(0x1a3)](_0x368ade(0x139)+_0x37a9de[_0x368ade(0x120)]+'\x20'+_0x37a9de['currency']+_0x368ade(0x1ff)+_0x374b64[_0x368ade(0x164)](0x6)+_0x368ade(0x15f)),console['log'](_0x368ade(0x19a)+_0x37a9de[_0x368ade(0x103)]+_0x368ade(0x194)+_0x24aa5f+'%'),console[_0x368ade(0x1a3)](_0x368ade(0x1cf)+_0x54b1c0[_0x368ade(0x164)](0x6)+_0x368ade(0x15f));}console[_0x368ade(0x1a3)](_0x368ade(0x1d1)+_0x37a9de['id']+_0x368ade(0x1aa)+_0x3d534c[_0x368ade(0x19e)][_0x368ade(0x1be)]());}if(_0x3186d5[_0x368ade(0x128)]){const _0x3db132=_0x3186d5[_0x368ade(0x128)];_0x3db132['iban']&&(_0x3d534c[_0x368ade(0x1d2)]=_0x3db132[_0x368ade(0x195)],console['log'](_0x368ade(0x205)+_0x3db132['iban'])),_0x3db132['bankDetails']&&console[_0x368ade(0x1a3)](_0x368ade(0x1d7)+_0x3db132['bankDetails']),_0x3db132[_0x368ade(0x1b5)]&&console[_0x368ade(0x1a3)](_0x368ade(0x1f1)+_0x3db132[_0x368ade(0x1b5)]),_0x3db132[_0x368ade(0x12b)]&&console[_0x368ade(0x1a3)](_0x368ade(0x16d)+_0x3db132[_0x368ade(0x12b)]);}await database_1[_0x368ade(0x107)][_0x368ade(0x163)][_0x368ade(0x1d4)]({'where':{'id':_0x37a9de['id']},'data':_0x3d534c});if(_0x3186d5['status']===_0x368ade(0x131)&&_0x37a9de[_0x368ade(0x165)]!==_0x368ade(0x131)){console[_0x368ade(0x1a3)](_0x368ade(0x162)+_0x37a9de['id']+_0x368ade(0x179));const _0x29a650=await database_1[_0x368ade(0x107)][_0x368ade(0x163)][_0x368ade(0x170)]({'where':{'id':_0x37a9de['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x29a650?.['paymentLinkId']&&_0x29a650['paymentLink'])try{const _0x1061fb=_0x29a650[_0x368ade(0x200)];console[_0x368ade(0x1a3)]('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x1061fb['id']+_0x368ade(0x125)+_0x1061fb[_0x368ade(0x1c6)]+',\x20currentPayments='+_0x1061fb['currentPayments']+_0x368ade(0x101)+_0x1061fb['status']);const _0x39981d=_0x1061fb[_0x368ade(0x133)]+0x1,_0x25d6a8=_0x1061fb[_0x368ade(0x1c6)]==='SINGLE'?_0x368ade(0x1d6):_0x1061fb['status'];await database_1[_0x368ade(0x107)]['paymentLink'][_0x368ade(0x1d4)]({'where':{'id':_0x1061fb['id']},'data':{'currentPayments':_0x39981d,'status':_0x25d6a8,'updatedAt':new Date()}}),console[_0x368ade(0x1a3)](_0x368ade(0x1ab)+_0x1061fb['id']+_0x368ade(0x12e)+_0x1061fb['currentPayments']+'\x20->\x20'+_0x39981d+',\x20status='+_0x1061fb[_0x368ade(0x165)]+'\x20->\x20'+_0x25d6a8);}catch(_0x530ad6){console[_0x368ade(0x118)](_0x368ade(0x156),_0x530ad6);}else console[_0x368ade(0x1a3)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x37a9de['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x368ade(0x107)][_0x368ade(0x126)][_0x368ade(0x12c)]({'data':{'paymentId':_0x37a9de['id'],'shopId':_0x37a9de[_0x368ade(0xff)],'event':'cointopay_status_check_'+_0x3186d5[_0x368ade(0x165)][_0x368ade(0x18d)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x37a9de[_0x368ade(0x165)],'newStatus':_0x3186d5[_0x368ade(0x165)],'paymentDetails':_0x3186d5['paymentDetails'],'checkedAt':new Date()['toISOString']()})}}),await this[_0x368ade(0x14d)](_0x37a9de,_0x3186d5[_0x368ade(0x165)]),await this[_0x368ade(0x1f4)](_0x37a9de,_0x3186d5['status']),_0x3186d5[_0x368ade(0x165)]!==_0x368ade(0x153)&&(console[_0x368ade(0x1a3)](_0x368ade(0x1a6)+_0x37a9de['id']+'\x20status\x20changed\x20to\x20'+_0x3186d5[_0x368ade(0x165)]+',\x20clearing\x20individual\x20timers'),this[_0x368ade(0xfe)](_0x37a9de['id'])),console['log'](_0x368ade(0x15e)+_0x37a9de['id']+_0x368ade(0x13a));}else console['log'](_0x368ade(0x19d)+_0x37a9de['id']+_0x368ade(0x110)+_0x3186d5[_0x368ade(0x165)]+')'),this['logCoinToPayStatus'](_0x37a9de['id'],_0x37a9de[_0x368ade(0x11c)],_0x37a9de[_0x368ade(0x165)],_0x3186d5[_0x368ade(0x165)],_0x368ade(0x13c),{'statusUnchanged':!![],'paymentDetails':_0x3186d5['paymentDetails'],'amount':_0x3186d5[_0x368ade(0x120)],'currency':_0x3186d5[_0x368ade(0x1d5)],'shopId':_0x37a9de[_0x368ade(0xff)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x2f43da){console[_0x368ade(0x118)](_0x368ade(0x208)+_0x37a9de['id']+':',_0x2f43da),this[_0x368ade(0xfd)](_0x37a9de['id'],_0x37a9de['gatewayPaymentId'],_0x2f43da,_0x368ade(0x13c),{'paymentAmount':_0x37a9de[_0x368ade(0x120)],'paymentCurrency':_0x37a9de[_0x368ade(0x1d5)],'shopId':_0x37a9de[_0x368ade(0xff)],'createdAt':_0x37a9de[_0x368ade(0x16b)]}),await database_1[_0x368ade(0x107)][_0x368ade(0x126)]['create']({'data':{'paymentId':_0x37a9de['id'],'shopId':_0x37a9de[_0x368ade(0xff)],'event':_0x368ade(0x1e3),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x2f43da instanceof Error?_0x2f43da[_0x368ade(0x1d3)]:_0x368ade(0x175),'gatewayPaymentId':_0x37a9de['gatewayPaymentId'],'checkedAt':new Date()['toISOString']()})}});}}async[a57_0x26267a(0x14d)](_0x26e985,_0x5c05ea){const _0x1a24c7=a57_0x26267a,_0x1043b2=Date[_0x1a24c7(0x1de)]();try{const _0x42b40d=_0x26e985['shop'],_0x3372cf=_0x42b40d[_0x1a24c7(0x1c9)];if(!_0x3372cf?.[_0x1a24c7(0x186)]){console['log'](_0x1a24c7(0x1b9)+_0x42b40d['id']);return;}const _0x50b471=_0x5c05ea===_0x1a24c7(0x131)?_0x1a24c7(0x157):_0x5c05ea===_0x1a24c7(0x114)?_0x1a24c7(0x15d):_0x5c05ea===_0x1a24c7(0x134)?_0x1a24c7(0x15d):_0x1a24c7(0x188);if(!_0x3372cf['webhookEvents']?.[_0x1a24c7(0x17f)](_0x50b471)){console[_0x1a24c7(0x1a3)](_0x1a24c7(0x1e4)+_0x50b471+'\x20not\x20enabled\x20for\x20shop\x20'+_0x42b40d['id']);return;}const _0x2394f8=(0x0,gateway_1[_0x1a24c7(0x189)])(_0x26e985[_0x1a24c7(0x103)])||_0x26e985[_0x1a24c7(0x103)],_0x566b00={'event':_0x50b471,'payment':{'id':_0x26e985['id'],'order_id':_0x26e985[_0x1a24c7(0x127)],'gateway_order_id':_0x26e985['gatewayOrderId'],'gateway':_0x2394f8,'amount':_0x26e985[_0x1a24c7(0x120)],'currency':_0x26e985[_0x1a24c7(0x1d5)],'status':_0x5c05ea[_0x1a24c7(0x18d)](),'customer_email':_0x26e985[_0x1a24c7(0x161)],'customer_name':_0x26e985[_0x1a24c7(0x1ea)],'created_at':_0x26e985[_0x1a24c7(0x16b)],'updated_at':new Date()}},_0x4be51e=JSON[_0x1a24c7(0x13b)](_0x566b00),_0x2c5ab3=crypto_1[_0x1a24c7(0x107)]['createHmac'](_0x1a24c7(0x192),_0x26e985[_0x1a24c7(0x16f)]['secretKey'])[_0x1a24c7(0x1d4)](_0x4be51e)[_0x1a24c7(0x209)](_0x1a24c7(0x168)),_0x263169=await fetch(_0x3372cf[_0x1a24c7(0x186)],{'method':_0x1a24c7(0x11e),'headers':{'Content-Type':_0x1a24c7(0x196),'User-Agent':_0x1a24c7(0x1ad),'X-Webhook-Signature':_0x2c5ab3},'body':_0x4be51e}),_0x4779ff=Date[_0x1a24c7(0x1de)]()-_0x1043b2,_0x269e85=_0x263169['ok']?_0x1a24c7(0x151):await _0x263169[_0x1a24c7(0x11d)]();loggerService_1[_0x1a24c7(0x1e2)][_0x1a24c7(0x152)](_0x26e985[_0x1a24c7(0xff)],_0x3372cf[_0x1a24c7(0x186)],_0x50b471,_0x263169[_0x1a24c7(0x165)],_0x4779ff,_0x566b00),console[_0x1a24c7(0x1a3)](_0x1a24c7(0x16c)+_0x3372cf[_0x1a24c7(0x186)]+'\x20with\x20status\x20'+_0x263169[_0x1a24c7(0x165)]+'\x20('+_0x4779ff+_0x1a24c7(0x1c1));}catch(_0x196ce4){console['error']('Failed\x20to\x20send\x20shop\x20webhook:',_0x196ce4),loggerService_1[_0x1a24c7(0x1e2)][_0x1a24c7(0x1b3)](_0x26e985[_0x1a24c7(0xff)],_0x26e985['shop']?.[_0x1a24c7(0x1c9)]?.[_0x1a24c7(0x186)]||_0x1a24c7(0x197),_0x1a24c7(0x15b),_0x196ce4,{});}}async[a57_0x26267a(0x1f4)](_0x12be7b,_0x4de7c2){const _0x4fba7d=a57_0x26267a;try{const _0x13d62d={'PENDING':_0x4fba7d(0x130),'PAID':_0x4fba7d(0x1e0),'FAILED':'failed','EXPIRED':_0x4fba7d(0x149)},_0x6afa0a=_0x13d62d[_0x4de7c2];if(!_0x6afa0a||_0x6afa0a===_0x4fba7d(0x130))return;await telegramBotService_1['telegramBotService'][_0x4fba7d(0x1df)](_0x12be7b[_0x4fba7d(0xff)],_0x12be7b,_0x6afa0a);}catch(_0x2748b2){console['error'](_0x4fba7d(0x193),_0x2748b2);}}async[a57_0x26267a(0x1c4)](_0x241e04){const _0x3892a5=a57_0x26267a;console[_0x3892a5(0x1a3)](_0x3892a5(0x19f)+_0x241e04);const _0x2444e3=await database_1['default'][_0x3892a5(0x163)]['findUnique']({'where':{'id':_0x241e04},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2444e3)throw new Error(_0x3892a5(0x123));if(_0x2444e3[_0x3892a5(0x103)]!==_0x3892a5(0x198)&&_0x2444e3[_0x3892a5(0x103)]!==_0x3892a5(0x145))throw new Error(_0x3892a5(0x190));console['log'](_0x3892a5(0x1f9)+_0x2444e3[_0x3892a5(0x103)]+_0x3892a5(0x1dd)+_0x241e04),await this['checkSinglePayment'](_0x2444e3),console['log'](_0x3892a5(0x1b6)+_0x241e04);}[a57_0x26267a(0x108)](){const _0x59110d=a57_0x26267a,_0x33ac31=this['globalCheckInterval']?this[_0x59110d(0x15c)]:undefined,_0x2b08f2=Array[_0x59110d(0x137)](this[_0x59110d(0x15a)][_0x59110d(0x207)]())[_0x59110d(0x1b7)](_0x4277a5=>({'paymentId':_0x4277a5['paymentId'],'gatewayPaymentId':_0x4277a5['gatewayPaymentId'],'createdAt':_0x4277a5['createdAt'],'timersCount':_0x4277a5[_0x59110d(0x181)][_0x59110d(0x1d9)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x59110d(0x15c)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x59110d(0x15a)][_0x59110d(0x16e)],'nextGlobalCheckIn':_0x33ac31,'paymentTimersDetails':_0x2b08f2};}[a57_0x26267a(0xfb)](_0x18dcdf){const _0x10a479=a57_0x26267a,_0x4041e0=this['paymentTimers']['get'](_0x18dcdf);if(_0x4041e0)return{'hasTimers':!![],'timersCount':_0x4041e0['timers'][_0x10a479(0x1d9)],'createdAt':_0x4041e0[_0x10a479(0x16b)],'gatewayPaymentId':_0x4041e0[_0x10a479(0x11c)]};return{'hasTimers':![]};}async[a57_0x26267a(0x176)](_0xccbe3b,_0x2a7d23){const _0x127668=a57_0x26267a;try{const _0x3861f3=await database_1[_0x127668(0x107)][_0x127668(0x16f)][_0x127668(0x170)]({'where':{'id':_0xccbe3b},'select':{'gatewaySettings':!![]}});if(!_0x3861f3?.[_0x127668(0x12a)])return console[_0x127668(0x1a3)]('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0xccbe3b+_0x127668(0x129)),0xa;const _0x18c68c=JSON[_0x127668(0x1bb)](_0x3861f3[_0x127668(0x12a)]);for(const [_0x29faa6,_0x54dcb2]of Object[_0x127668(0x1bc)](_0x18c68c)){if(_0x29faa6['toLowerCase']()===_0x2a7d23[_0x127668(0x18d)]()){const _0x230881=_0x54dcb2[_0x127668(0x1ec)]||0xa;return console[_0x127668(0x1a3)]('Gateway\x20'+_0x2a7d23+_0x127668(0x135)+_0xccbe3b+':\x20'+_0x230881+'%'),_0x230881;}}return console['log'](_0x127668(0x115)+_0x2a7d23+'\x20in\x20shop\x20'+_0xccbe3b+_0x127668(0x1e9)),0xa;}catch(_0x32aa49){return console['error'](_0x127668(0x160)+_0xccbe3b+_0x127668(0x143)+_0x2a7d23+':',_0x32aa49),0xa;}}}exports[a57_0x26267a(0x1bd)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();