'use strict';const a38_0x461fff=a38_0x671b;function a38_0x1210(){const _0x2ea1c5=['\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','\x20commission:\x20','iban','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20(after\x20','customerName','‚è∞\x20[GLOBAL]\x20Found\x20','amount','cointopay_status_check_error','clearPaymentTimers','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','delay','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','logCoinToPayStatus','./gateways/coinToPayService','COINTOPAY_ERROR','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','sendShopWebhook','\x20\x20\x20üìù\x20Details:','\x20\x20\x20-\x20Status:\x20','\x20status:\x20','coinToPayStatusService','\x20updated:\x20currentPayments=','logCoinToPayError','shop','stringify','\x20\x20\x20-\x20ShopId:\x20','\x20to\x20clear','./currencyService','POST','\x20individual\x20payment\x20timers','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20status\x20changed\x20to\x20','\x20timers\x20for\x20payment\x20','paymentDetails','currency','cointopay2','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20\x20\x20üìÖ\x20Time:\x20','TesSoft\x20Payment\x20System/1.0','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','CoinToPayStatusService','text','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','gatewaySettings','coinToPay2Service','Gateway\x20',':\x20type=',',\x20clearing\x20individual\x20timers','cointopay_auto_expired','log','\x20in\x20','checkAllPendingPayments','now','‚è∞\x20[GLOBAL]\x20Payment\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','Unknown\x20error','\x20commission\x20for\x20shop\x20','has','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','bankDetails','includes','description','transactionId','auto_expire','1012164mQXuqP','cointopay','\x20in\x20shop\x20','convertToUSDT','\x20status\x20unchanged\x20(','catch','currentPayments','\x20not\x20found,\x20clearing\x20timers','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','./gateways/coinToPay2Service','create','üìä\x20[CHECK]\x20Payment\x20','shopId','\x20\x20\x20Gateway\x20','gatewayPaymentId','üìà\x20[COINTOPAY]\x20Payment\x20','\x20\x20\x20üìä\x20Status:\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','‚úÖ\x20[EXPIRY]\x20Payment\x20','Payment\x20older\x20than\x20','timestamp','checkSinglePayment','\x20checked,\x20','paymentId','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20USDT','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','153559ivNuyI','getPaymentTimerInfo','toISOString','logShopWebhookSent','checkPaymentById','settings','\x20days\x20(created\x20before\x20','length','floor','1296468DGLZgA','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','üßπ\x20[CHECK]\x20Payment\x20','type','\x20expired\x20CoinToPay\x20payments','error','paymentTimers','cointopay_status_check_','PAID','\x20->\x20','get','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','webhookLog','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','payment.success','gatewayOrderId','COINTOPAY_STATUS_CHANGE','webhookUrl','sendPaymentStatusNotification','\x20days,\x20marking\x20as\x20EXPIRED','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','getGatewayCommission','\x20\x20\x20Amount\x20after\x20commission:\x20','set','status_check','COMPLETED','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','created','112jMxZTp','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment',',\x20using\x20default\x20commission\x2010%','getTime','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20\x20\x20‚ùå\x20Error:\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','entries','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','coinToPayService','\x20\x20\x20üìç\x20Source:\x20','‚úÖ\x20[CHECK]\x20Payment\x20','\x20\x20\x20Amount:\x20','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20payment\x20','Shop\x20webhook\x20sent\x20to\x20','Automatically\x20expired\x20after\x20','\x20\x20\x20-\x20paymentId:\x20','customerEmail','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','ms)','\x20has\x20no\x20gatewayPaymentId','\x20\x20\x20-\x20Amount:\x20','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','size','paid','\x20to\x20','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','EXPIRED','orderId','findUnique','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20is\x20older\x20than\x20','2\x20minutes','confirmedOn','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','createdAt','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','webhookEvents','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','remitterIban','\x20completed\x20for\x20payment\x20','10SFdJIU','webhook_send','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','payment','logShopWebhookError','unknown','paymentLink','toLowerCase','../config/database','globalCheckInterval','not\x20found','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','toFixed','\x20for\x20payment\x20','-day\x20timeout','adminNotes','paymentLinkId','üí∞\x20[CHECK]\x20Payment\x20','sendPaymentNotification','üßπ\x20[DEBUG]\x20Clearing\x20','map','loggerService','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','üìä\x20[HOURLY]\x20Payment\x20','amountAfterGatewayCommissionUSDT','349764zIXPil','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','message','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','push','currencyService','EXPIRY_DAYS','üõë\x20[SHUTDOWN]\x20Cleared\x20','\x20days','1605018BZraxD','forEach','failed','getGatewayIdByName',',\x20status=','GLOBAL_CHECK_INTERVAL_MS','createdOn','2092998OgNwta','update','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','__esModule','\x20details:','parse','\x20triggered\x20for\x20payment\x20','10380170BbSSTV','\x20\x20\x20-\x20gatewayPaymentId:\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#',',\x20currentPayments=','\x20not\x20enabled\x20for\x20shop\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','Bank\x20Details:\x20','ü™ô\x20[DEBUG]\x20Creating\x20','\x20\x20\x20üìù\x20Context:','‚úÖ\x20[HOURLY]\x20Payment\x20','application/json','\x20updated\x20successfully','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20',',\x20stopping\x20individual\x20checks','telegramBotService','checkSinglePaymentById','gateway','getDate','18GbgjfJ','amountUSDT','\x20(age:\x20',',\x20gateway\x20','h),\x20skipping\x20global\x20check','timers','\x20found:','PENDING','\x20with\x20status\x20','findMany','schedule_created','status','logWhiteDomainError','payment.failed','defineProperty','Webhook\x20event\x20','‚è∞\x20[HOURLY]\x20Payment\x20','5\x20minutes','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','schedulePaymentChecks','checkPaymentStatus','\x20initial\x20timers\x20for\x20payment\x20','default','CoinToPayService','Failed\x20to\x20send\x20shop\x20webhook:'];a38_0x1210=function(){return _0x2ea1c5;};return a38_0x1210();}(function(_0x51d338,_0x2a8edb){const _0x442a40=a38_0x671b,_0x1ca178=_0x51d338();while(!![]){try{const _0x5f156f=-parseInt(_0x442a40(0x1b8))/0x1+-parseInt(_0x442a40(0x117))/0x2+parseInt(_0x442a40(0x11e))/0x3+parseInt(_0x442a40(0x10e))/0x4+-parseInt(_0x442a40(0xf5))/0x5*(-parseInt(_0x442a40(0x192))/0x6)+parseInt(_0x442a40(0x1af))/0x7*(-parseInt(_0x442a40(0xc6))/0x8)+-parseInt(_0x442a40(0x137))/0x9*(-parseInt(_0x442a40(0x125))/0xa);if(_0x5f156f===_0x2a8edb)break;else _0x1ca178['push'](_0x1ca178['shift']());}catch(_0x46b5a8){_0x1ca178['push'](_0x1ca178['shift']());}}}(a38_0x1210,0xc1772));function a38_0x671b(_0x524114,_0x1906ef){const _0x1210ce=a38_0x1210();return a38_0x671b=function(_0x671bd9,_0x261700){_0x671bd9=_0x671bd9-0xb2;let _0x11096a=_0x1210ce[_0x671bd9];return _0x11096a;},a38_0x671b(_0x524114,_0x1906ef);}var __importDefault=this&&this['__importDefault']||function(_0x4e5e27){const _0x3ca959=a38_0x671b;return _0x4e5e27&&_0x4e5e27[_0x3ca959(0x121)]?_0x4e5e27:{'default':_0x4e5e27};};Object[a38_0x461fff(0x145)](exports,a38_0x461fff(0x121),{'value':!![]}),exports['coinToPayStatusService']=exports[a38_0x461fff(0x179)]=void 0x0;const coinToPayService_1=require(a38_0x461fff(0x15e)),coinToPay2Service_1=require(a38_0x461fff(0x19b)),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a38_0x461fff(0xfd))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require('./loggerService'),currencyService_1=require(a38_0x461fff(0x16c));class CoinToPayStatusService{constructor(){const _0x1966bd=a38_0x461fff;this['globalCheckInterval']=null,this[_0x1966bd(0x11c)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x1966bd(0x1be)]=new Map(),this[_0x1966bd(0xd0)]=new coinToPayService_1[(_0x1966bd(0x14e))](),this[_0x1966bd(0x17d)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x1966bd(0x182)](_0x1966bd(0xf2));}[a38_0x461fff(0x14a)](_0x1cb2d9,_0x19ff72){const _0x4b4b5f=a38_0x461fff;console[_0x4b4b5f(0x182)](_0x4b4b5f(0xcf)),console[_0x4b4b5f(0x182)](_0x4b4b5f(0xdb)+_0x1cb2d9),console[_0x4b4b5f(0x182)](_0x4b4b5f(0x126)+_0x19ff72),this[_0x4b4b5f(0x159)](_0x1cb2d9);const _0x355d5c=[],_0x2d4596=new Date(),_0x39b850=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x4b4b5f(0xeb)},{'delay':0x5*0x3c*0x3e8,'description':_0x4b4b5f(0x148)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console['log'](_0x4b4b5f(0x12c)+_0x39b850[_0x4b4b5f(0x1b6)]+_0x4b4b5f(0x14c)+_0x1cb2d9);let _0x4ab6d8=0x0;_0x39b850[_0x4b4b5f(0x118)]((_0x58033b,_0x50e517)=>{const _0x54009e=_0x4b4b5f;_0x4ab6d8+=_0x58033b['delay'];const _0x5cbb6e=setTimeout(async()=>{const _0x1b5bd0=a38_0x671b;console[_0x1b5bd0(0x182)](_0x1b5bd0(0x10b)+(_0x50e517+0x1)+_0x1b5bd0(0x124)+_0x1cb2d9+_0x1b5bd0(0x154)+_0x58033b[_0x1b5bd0(0x18f)]+')');try{await this[_0x1b5bd0(0x134)](_0x1cb2d9),console[_0x1b5bd0(0x182)](_0x1b5bd0(0x120)+(_0x50e517+0x1)+_0x1b5bd0(0xf4)+_0x1cb2d9);}catch(_0x1966ad){console[_0x1b5bd0(0x1bd)](_0x1b5bd0(0x175)+(_0x50e517+0x1)+'\x20for\x20payment\x20'+_0x1cb2d9+':',_0x1966ad),this['logCoinToPayError'](_0x1cb2d9,_0x19ff72,_0x1966ad,'status_check',{'checkNumber':_0x50e517+0x1,'scheduledAfter':_0x58033b[_0x1b5bd0(0x18f)],'isIndividualCheck':!![]});}},_0x4ab6d8);_0x355d5c[_0x54009e(0x112)](_0x5cbb6e),console[_0x54009e(0x182)](_0x54009e(0x15c)+(_0x50e517+0x1)+'\x20for\x20payment\x20'+_0x1cb2d9+_0x54009e(0x183)+_0x4ab6d8/0x3e8+'\x20seconds\x20('+_0x58033b['description']+')');});const _0x35a7ac=setInterval(async()=>{const _0x29457f=_0x4b4b5f;console[_0x29457f(0x182)](_0x29457f(0x131)+_0x1cb2d9);try{const _0x50675c=await database_1[_0x29457f(0x14d)]['payment']['findUnique']({'where':{'id':_0x1cb2d9},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x50675c){console[_0x29457f(0x182)]('‚ùå\x20[HOURLY]\x20Payment\x20'+_0x1cb2d9+_0x29457f(0x199)),this['clearPaymentTimers'](_0x1cb2d9);return;}console[_0x29457f(0x182)](_0x29457f(0x10c)+_0x1cb2d9+'\x20current\x20status:\x20'+_0x50675c[_0x29457f(0x142)]);if(_0x50675c[_0x29457f(0x142)]!==_0x29457f(0x13e)){console[_0x29457f(0x182)](_0x29457f(0x12e)+_0x1cb2d9+'\x20status\x20is\x20'+_0x50675c[_0x29457f(0x142)]+_0x29457f(0x132)),this[_0x29457f(0x159)](_0x1cb2d9);return;}const _0x5685aa=Math['floor']((Date[_0x29457f(0x185)]()-_0x50675c[_0x29457f(0xee)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x5685aa>=this[_0x29457f(0x114)]){console[_0x29457f(0x182)](_0x29457f(0x147)+_0x1cb2d9+_0x29457f(0xea)+this[_0x29457f(0x114)]+_0x29457f(0x17b)),this[_0x29457f(0x159)](_0x1cb2d9);return;}await this[_0x29457f(0x134)](_0x1cb2d9),console[_0x29457f(0x182)]('‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x1cb2d9);}catch(_0x5e46a6){console['error'](_0x29457f(0xcb)+_0x1cb2d9+':',_0x5e46a6),this[_0x29457f(0x167)](_0x1cb2d9,_0x19ff72,_0x5e46a6,_0x29457f(0xc2),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x355d5c[_0x4b4b5f(0x112)](_0x35a7ac),this['paymentTimers'][_0x4b4b5f(0xc1)](_0x1cb2d9,{'timers':_0x355d5c,'paymentId':_0x1cb2d9,'gatewayPaymentId':_0x19ff72,'createdAt':_0x2d4596}),console[_0x4b4b5f(0x182)](_0x4b4b5f(0xf7)+_0x39b850[_0x4b4b5f(0x1b6)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x1cb2d9),console[_0x4b4b5f(0x182)](_0x4b4b5f(0xd5)+this[_0x4b4b5f(0x1be)]['size']),this['logCoinToPayStatus'](_0x1cb2d9,_0x19ff72,_0x4b4b5f(0x13e),'PENDING',_0x4b4b5f(0xc2),{'action':_0x4b4b5f(0x141),'scheduledChecks':_0x39b850['length'],'firstCheckIn':_0x39b850[0x0][_0x4b4b5f(0x15b)]/0x3e8,'totalTimers':this[_0x4b4b5f(0x1be)]['size']});}['clearPaymentTimers'](_0x19c328){const _0x63048b=a38_0x461fff,_0x20995d=this[_0x63048b(0x1be)]['get'](_0x19c328);_0x20995d?(console['log'](_0x63048b(0x108)+_0x20995d[_0x63048b(0x13c)][_0x63048b(0x1b6)]+_0x63048b(0x171)+_0x19c328),_0x20995d['timers'][_0x63048b(0x118)]((_0x1a7f69,_0x3302e3)=>{const _0x153344=_0x63048b;_0x1a7f69&&(clearTimeout(_0x1a7f69),clearInterval(_0x1a7f69),console[_0x153344(0x182)](_0x153344(0x127)+(_0x3302e3+0x1)+_0x153344(0x102)+_0x19c328));}),this[_0x63048b(0x1be)]['delete'](_0x19c328),console[_0x63048b(0x182)](_0x63048b(0xe1)+_0x19c328+'.\x20Remaining\x20active\x20timers:\x20'+this[_0x63048b(0x1be)][_0x63048b(0xe2)])):console['log'](_0x63048b(0xe5)+_0x19c328+_0x63048b(0x16b));}async[a38_0x461fff(0x134)](_0x104d03){const _0x221fba=a38_0x461fff;console[_0x221fba(0x182)](_0x221fba(0x160)+_0x104d03);const _0x4d4e19=await database_1[_0x221fba(0x14d)][_0x221fba(0xf8)][_0x221fba(0xe8)]({'where':{'id':_0x104d03},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4d4e19){console[_0x221fba(0x182)]('‚ùå\x20[CHECK]\x20Payment\x20'+_0x104d03+'\x20not\x20found\x20in\x20database');return;}console[_0x221fba(0x182)]('üìä\x20[CHECK]\x20Payment\x20'+_0x104d03+_0x221fba(0x13d)),console[_0x221fba(0x182)]('\x20\x20\x20-\x20Gateway:\x20'+_0x4d4e19[_0x221fba(0x135)]),console['log'](_0x221fba(0x163)+_0x4d4e19[_0x221fba(0x142)]),console[_0x221fba(0x182)](_0x221fba(0x153)+_0x4d4e19[_0x221fba(0x1a0)]),console[_0x221fba(0x182)](_0x221fba(0xe0)+_0x4d4e19[_0x221fba(0x157)]+'\x20'+_0x4d4e19[_0x221fba(0x173)]),console['log'](_0x221fba(0x16a)+_0x4d4e19[_0x221fba(0x19e)]);if(_0x4d4e19['gateway']!==_0x221fba(0x193)&&_0x4d4e19[_0x221fba(0x135)]!=='cointopay2'){console[_0x221fba(0x182)](_0x221fba(0x187)+_0x104d03+_0x221fba(0xbe)+_0x4d4e19[_0x221fba(0x135)]+')');return;}if(_0x4d4e19['status']!=='PENDING'){console[_0x221fba(0x182)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x104d03+'\x20status\x20is\x20'+_0x4d4e19[_0x221fba(0x142)]+_0x221fba(0x132)),this['clearPaymentTimers'](_0x104d03);return;}if(!_0x4d4e19[_0x221fba(0x1a0)]){console['log'](_0x221fba(0x187)+_0x104d03+_0x221fba(0xdf));return;}console['log']('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x104d03+_0x221fba(0x18c)),await this[_0x221fba(0x1a8)](_0x4d4e19);}[a38_0x461fff(0x15d)](_0x5704df,_0x10bebb,_0x2a4fa3,_0x59df10,_0x1cb4fc,_0x3c8f88){const _0xa22434=a38_0x461fff,_0x1f77e0={'type':_0xa22434(0xba),'paymentId':_0x5704df,'gatewayPaymentId':_0x10bebb,'oldStatus':_0x2a4fa3,'newStatus':_0x59df10,'source':_0x1cb4fc,'timestamp':new Date()[_0xa22434(0x1b1)](),'details':_0x3c8f88||{}};loggerService_1[_0xa22434(0x10a)][_0xa22434(0x15d)](_0x1f77e0),console[_0xa22434(0x182)]('ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x5704df+'\x20('+_0x10bebb+')'),console['log'](_0xa22434(0x1a2)+_0x2a4fa3+'\x20->\x20'+_0x59df10),console['log']('\x20\x20\x20üìç\x20Source:\x20'+_0x1cb4fc),console['log'](_0xa22434(0x176)+_0x1f77e0['timestamp']),_0x3c8f88&&console[_0xa22434(0x182)](_0xa22434(0x162),_0x3c8f88);}[a38_0x461fff(0x167)](_0x323e95,_0x566da5,_0x21b03f,_0xaa62f5,_0x10277e){const _0x5b180b=a38_0x461fff,_0x49d35d={'type':_0x5b180b(0x15f),'paymentId':_0x323e95,'gatewayPaymentId':_0x566da5,'error':_0x21b03f instanceof Error?{'message':_0x21b03f[_0x5b180b(0x110)],'stack':_0x21b03f['stack']}:_0x21b03f,'source':_0xaa62f5,'timestamp':new Date()[_0x5b180b(0x1b1)](),'context':_0x10277e||{}};loggerService_1['loggerService'][_0x5b180b(0x167)](_0x49d35d),console[_0x5b180b(0x1bd)](_0x5b180b(0xd4)+_0x323e95+'\x20('+_0x566da5+')'),console[_0x5b180b(0x1bd)](_0x5b180b(0xcc)+(_0x21b03f instanceof Error?_0x21b03f[_0x5b180b(0x110)]:_0x21b03f)),console[_0x5b180b(0x1bd)](_0x5b180b(0xd1)+_0xaa62f5),console['error'](_0x5b180b(0x176)+_0x49d35d[_0x5b180b(0x1a7)]),_0x10277e&&console[_0x5b180b(0x1bd)](_0x5b180b(0x12d),_0x10277e);}['startPeriodicStatusCheck'](){const _0x55002a=a38_0x461fff;console[_0x55002a(0x182)](_0x55002a(0xed)),this[_0x55002a(0x184)]()[_0x55002a(0x197)](_0x3127c5=>{const _0x70c661=_0x55002a;console[_0x70c661(0x1bd)](_0x70c661(0x111),_0x3127c5);}),this[_0x55002a(0xfe)]=setInterval(async()=>{const _0x31efdc=_0x55002a;try{console[_0x31efdc(0x182)](_0x31efdc(0x1ab)),await this['checkAllPendingPayments'](),console[_0x31efdc(0x182)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x8da447){console[_0x31efdc(0x1bd)](_0x31efdc(0xc7),_0x8da447);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x55002a(0x182)]('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}['stopPeriodicStatusCheck'](){const _0x2ef850=a38_0x461fff;console[_0x2ef850(0x182)](_0x2ef850(0xb5));this[_0x2ef850(0xfe)]&&(clearInterval(this[_0x2ef850(0xfe)]),this[_0x2ef850(0xfe)]=null,console[_0x2ef850(0x182)](_0x2ef850(0xf1)));const _0x4378cc=this['paymentTimers'][_0x2ef850(0xe2)];for(const [_0x1abd6f]of this[_0x2ef850(0x1be)]){this[_0x2ef850(0x159)](_0x1abd6f);}console[_0x2ef850(0x182)](_0x2ef850(0x115)+_0x4378cc+_0x2ef850(0x16e));}async[a38_0x461fff(0x184)](){const _0x30e9df=a38_0x461fff;try{console['log'](_0x30e9df(0x149));const _0x1959a4=await database_1['default'][_0x30e9df(0xf8)][_0x30e9df(0x140)]({'where':{'gateway':{'in':[_0x30e9df(0x193),_0x30e9df(0x174)]},'status':_0x30e9df(0x13e),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x30e9df(0x182)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x1959a4[_0x30e9df(0x1b6)]+'\x20pending\x20CoinToPay\x20payments');if(_0x1959a4[_0x30e9df(0x1b6)]===0x0){console[_0x30e9df(0x182)](_0x30e9df(0xef));return;}const _0x681a8f=await this['checkExpiredPayments'](_0x1959a4);console[_0x30e9df(0x182)](_0x30e9df(0x156)+_0x681a8f[_0x30e9df(0x1b6)]+_0x30e9df(0x1bc));let _0x443be7=0x0,_0xcc515f=0x0;for(const _0xa3839c of _0x1959a4){try{if(_0x681a8f['includes'](_0xa3839c['id'])){console[_0x30e9df(0x182)](_0x30e9df(0x186)+_0xa3839c['id']+_0x30e9df(0xb7)),_0xcc515f++;continue;}if(this[_0x30e9df(0x1be)][_0x30e9df(0x18a)](_0xa3839c['id'])){console[_0x30e9df(0x182)](_0x30e9df(0x186)+_0xa3839c['id']+_0x30e9df(0x150)),_0xcc515f++;continue;}const _0x254cb1=(Date['now']()-_0xa3839c[_0x30e9df(0xee)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x254cb1<0x1){console[_0x30e9df(0x182)](_0x30e9df(0x186)+_0xa3839c['id']+'\x20is\x20too\x20new\x20('+_0x254cb1[_0x30e9df(0x101)](0x1)+_0x30e9df(0x13b)),_0xcc515f++;continue;}console[_0x30e9df(0x182)](_0x30e9df(0xc4)+_0xa3839c['id']+_0x30e9df(0x139)+_0x254cb1['toFixed'](0x1)+'h)'),await this[_0x30e9df(0x1a8)](_0xa3839c),_0x443be7++,await new Promise(_0x2ba537=>setTimeout(_0x2ba537,0x7d0));}catch(_0x3733c4){console[_0x30e9df(0x1bd)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0xa3839c['id']+':',_0x3733c4),this[_0x30e9df(0x167)](_0xa3839c['id'],_0xa3839c['gatewayPaymentId']||_0x30e9df(0xfa),_0x3733c4,_0x30e9df(0xc2),{'isGlobalCheck':!![],'paymentAmount':_0xa3839c[_0x30e9df(0x157)],'paymentCurrency':_0xa3839c[_0x30e9df(0x173)],'shopId':_0xa3839c[_0x30e9df(0x19e)],'createdAt':_0xa3839c[_0x30e9df(0xee)]}),loggerService_1['loggerService'][_0x30e9df(0x143)](_0x30e9df(0x193),'/status/'+_0xa3839c[_0x30e9df(0x1a0)],_0x3733c4);}}console[_0x30e9df(0x182)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x443be7+_0x30e9df(0x1a9)+_0xcc515f+'\x20skipped,\x20'+_0x681a8f[_0x30e9df(0x1b6)]+'\x20expired');}catch(_0x583f23){console[_0x30e9df(0x1bd)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x583f23);}}async['checkExpiredPayments'](_0x2cf0b2){const _0x48c908=a38_0x461fff,_0x49b466=[],_0x3e9953=new Date();_0x3e9953['setDate'](_0x3e9953[_0x48c908(0x136)]()-this[_0x48c908(0x114)]),console[_0x48c908(0x182)](_0x48c908(0x1a4)+this[_0x48c908(0x114)]+_0x48c908(0x1b5)+_0x3e9953[_0x48c908(0x1b1)]()+')');for(const _0x381540 of _0x2cf0b2){if(_0x381540[_0x48c908(0xee)]<_0x3e9953){console[_0x48c908(0x182)](_0x48c908(0xcd)+_0x381540['id']+'\x20is\x20older\x20than\x20'+this[_0x48c908(0x114)]+_0x48c908(0xbd));try{this[_0x48c908(0x15d)](_0x381540['id'],_0x381540[_0x48c908(0x1a0)]||_0x48c908(0xfa),_0x48c908(0x13e),'EXPIRED',_0x48c908(0x191),{'reason':_0x48c908(0x1a6)+this[_0x48c908(0x114)]+_0x48c908(0x116),'createdAt':_0x381540[_0x48c908(0xee)],'daysSinceCreation':Math['floor']((Date['now']()-_0x381540['createdAt'][_0x48c908(0xca)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x381540['amount'],'paymentCurrency':_0x381540[_0x48c908(0x173)],'shopId':_0x381540[_0x48c908(0x19e)]}),await database_1['default'][_0x48c908(0xf8)][_0x48c908(0x11f)]({'where':{'id':_0x381540['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':_0x48c908(0xda)+this[_0x48c908(0x114)]+'\x20days\x20without\x20payment\x20confirmation'}}),await database_1[_0x48c908(0x14d)][_0x48c908(0xb6)][_0x48c908(0x19c)]({'data':{'paymentId':_0x381540['id'],'shopId':_0x381540[_0x48c908(0x19e)],'event':_0x48c908(0x181),'statusCode':0xc8,'responseBody':JSON[_0x48c908(0x169)]({'reason':_0x48c908(0x1a6)+this['EXPIRY_DAYS']+_0x48c908(0x116),'createdAt':_0x381540[_0x48c908(0xee)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x48c908(0x1b7)]((Date['now']()-_0x381540[_0x48c908(0xee)][_0x48c908(0xca)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x48c908(0x161)](_0x381540,_0x48c908(0xe6)),await this[_0x48c908(0xbc)](_0x381540,_0x48c908(0xe6)),this[_0x48c908(0x159)](_0x381540['id']),_0x49b466[_0x48c908(0x112)](_0x381540['id']),console[_0x48c908(0x182)](_0x48c908(0x1a5)+_0x381540['id']+_0x48c908(0x19a)+this[_0x48c908(0x114)]+_0x48c908(0x103));}catch(_0x39a66a){console[_0x48c908(0x1bd)]('‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x381540['id']+':',_0x39a66a),this['logCoinToPayError'](_0x381540['id'],_0x381540[_0x48c908(0x1a0)]||'unknown',_0x39a66a,_0x48c908(0x191),{'reason':_0x48c908(0xe9),'createdAt':_0x381540['createdAt'],'daysSinceCreation':Math['floor']((Date['now']()-_0x381540[_0x48c908(0xee)][_0x48c908(0xca)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x49b466;}async[a38_0x461fff(0x1a8)](_0x2395f8){const _0x38fd02=a38_0x461fff;if(!_0x2395f8[_0x38fd02(0x1a0)]){console[_0x38fd02(0x182)](_0x38fd02(0x187)+_0x2395f8['id']+_0x38fd02(0x1ae));return;}console[_0x38fd02(0x182)]('üîç\x20[CHECK]\x20Checking\x20'+_0x2395f8[_0x38fd02(0x135)]+_0x38fd02(0xd8)+_0x2395f8['id']+'\x20('+_0x2395f8['gatewayPaymentId']+')');try{let _0x35abb9;_0x2395f8[_0x38fd02(0x135)]===_0x38fd02(0x174)?(_0x35abb9=await this[_0x38fd02(0x17d)][_0x38fd02(0x14b)](_0x2395f8['gatewayPaymentId']),console[_0x38fd02(0x182)](_0x38fd02(0x18b)+_0x2395f8['id']+_0x38fd02(0x164)+_0x35abb9[_0x38fd02(0x142)])):(_0x35abb9=await this[_0x38fd02(0xd0)][_0x38fd02(0x14b)](_0x2395f8['gatewayPaymentId']),console['log'](_0x38fd02(0x100)+_0x2395f8['id']+_0x38fd02(0x164)+_0x35abb9[_0x38fd02(0x142)]));_0x35abb9[_0x38fd02(0x172)]&&console['log'](_0x38fd02(0x19d)+_0x2395f8['id']+_0x38fd02(0x122),{'iban':_0x35abb9[_0x38fd02(0x172)][_0x38fd02(0x152)]||_0x38fd02(0xff),'transactionId':_0x35abb9[_0x38fd02(0x172)][_0x38fd02(0x190)],'createdOn':_0x35abb9[_0x38fd02(0x172)][_0x38fd02(0x11d)],'confirmedOn':_0x35abb9[_0x38fd02(0x172)]['confirmedOn']||'not\x20confirmed'});if(_0x35abb9[_0x38fd02(0x142)]!==_0x2395f8[_0x38fd02(0x142)]){console[_0x38fd02(0x182)](_0x38fd02(0x10f)+_0x2395f8['id']+'\x20status\x20from\x20'+_0x2395f8['status']+_0x38fd02(0xe4)+_0x35abb9[_0x38fd02(0x142)]),this[_0x38fd02(0x15d)](_0x2395f8['id'],_0x2395f8[_0x38fd02(0x1a0)],_0x2395f8[_0x38fd02(0x142)],_0x35abb9['status'],_0x38fd02(0xc2),{'paymentDetails':_0x35abb9[_0x38fd02(0x172)],'amount':_0x35abb9[_0x38fd02(0x157)],'currency':_0x35abb9[_0x38fd02(0x173)],'shopId':_0x2395f8[_0x38fd02(0x19e)],'checkTimestamp':new Date()[_0x38fd02(0x1b1)]()});const _0x18ff2d={'status':_0x35abb9[_0x38fd02(0x142)],'updatedAt':new Date()};if(_0x35abb9['status']===_0x38fd02(0xb2)&&_0x2395f8[_0x38fd02(0x142)]!=='PAID'){_0x18ff2d['paidAt']=new Date();if(!_0x2395f8[_0x38fd02(0x138)]){const _0x3ebce1=await currencyService_1[_0x38fd02(0x113)][_0x38fd02(0x195)](_0x2395f8['amount'],_0x2395f8[_0x38fd02(0x173)]);_0x18ff2d[_0x38fd02(0x138)]=_0x3ebce1;const _0x4cf2fe=await this[_0x38fd02(0xbf)](_0x2395f8['shopId'],_0x2395f8[_0x38fd02(0x135)]),_0x26b64f=_0x3ebce1*(0x1-_0x4cf2fe/0x64);_0x18ff2d[_0x38fd02(0x10d)]=_0x26b64f,console[_0x38fd02(0x182)](_0x38fd02(0x106)+_0x2395f8['id']+'\x20amounts\x20calculated:'),console[_0x38fd02(0x182)](_0x38fd02(0xd3)+_0x2395f8[_0x38fd02(0x157)]+'\x20'+_0x2395f8[_0x38fd02(0x173)]+'\x20->\x20'+_0x3ebce1[_0x38fd02(0x101)](0x6)+_0x38fd02(0x1ac)),console[_0x38fd02(0x182)](_0x38fd02(0x19f)+_0x2395f8[_0x38fd02(0x135)]+_0x38fd02(0x151)+_0x4cf2fe+'%'),console[_0x38fd02(0x182)](_0x38fd02(0xc0)+_0x26b64f['toFixed'](0x6)+_0x38fd02(0x1ac));}console['log']('üí∞\x20[CHECK]\x20Payment\x20'+_0x2395f8['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x18ff2d['paidAt'][_0x38fd02(0x1b1)]());}if(_0x35abb9[_0x38fd02(0x172)]){const _0x47bcd0=_0x35abb9[_0x38fd02(0x172)];_0x47bcd0[_0x38fd02(0x152)]&&(_0x18ff2d[_0x38fd02(0xf3)]=_0x47bcd0[_0x38fd02(0x152)],console['log']('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x47bcd0[_0x38fd02(0x152)]));if(_0x47bcd0[_0x38fd02(0x18d)]){const _0x189e32=_0x2395f8[_0x38fd02(0x104)]||'',_0x4f1281=_0x38fd02(0x12b)+_0x47bcd0[_0x38fd02(0x18d)];_0x18ff2d[_0x38fd02(0x104)]=_0x189e32?_0x189e32+'\x0a\x0a'+_0x4f1281:_0x4f1281,console[_0x38fd02(0x182)]('üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0x47bcd0[_0x38fd02(0x190)]&&console[_0x38fd02(0x182)](_0x38fd02(0xd6)+_0x47bcd0[_0x38fd02(0x190)]),_0x47bcd0[_0x38fd02(0xec)]&&console['log']('‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x47bcd0[_0x38fd02(0xec)]);}await database_1[_0x38fd02(0x14d)][_0x38fd02(0xf8)][_0x38fd02(0x11f)]({'where':{'id':_0x2395f8['id']},'data':_0x18ff2d});if(_0x35abb9['status']===_0x38fd02(0xb2)&&_0x2395f8[_0x38fd02(0x142)]!==_0x38fd02(0xb2)){console['log'](_0x38fd02(0x1a1)+_0x2395f8['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x1e4ab7=await database_1['default'][_0x38fd02(0xf8)]['findUnique']({'where':{'id':_0x2395f8['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x1e4ab7?.[_0x38fd02(0x105)]&&_0x1e4ab7[_0x38fd02(0xfb)])try{const _0x44b3ca=_0x1e4ab7['paymentLink'];console[_0x38fd02(0x182)](_0x38fd02(0x178)+_0x44b3ca['id']+_0x38fd02(0x17f)+_0x44b3ca['type']+_0x38fd02(0x128)+_0x44b3ca[_0x38fd02(0x198)]+_0x38fd02(0x11b)+_0x44b3ca[_0x38fd02(0x142)]);const _0x262c8a=_0x44b3ca[_0x38fd02(0x198)]+0x1,_0xfb1690=_0x44b3ca[_0x38fd02(0x1bb)]==='SINGLE'?_0x38fd02(0xc3):_0x44b3ca[_0x38fd02(0x142)];await database_1[_0x38fd02(0x14d)][_0x38fd02(0xfb)]['update']({'where':{'id':_0x44b3ca['id']},'data':{'currentPayments':_0x262c8a,'status':_0xfb1690,'updatedAt':new Date()}}),console[_0x38fd02(0x182)](_0x38fd02(0x1ad)+_0x44b3ca['id']+_0x38fd02(0x166)+_0x44b3ca[_0x38fd02(0x198)]+'\x20->\x20'+_0x262c8a+_0x38fd02(0x11b)+_0x44b3ca[_0x38fd02(0x142)]+_0x38fd02(0xb3)+_0xfb1690);}catch(_0x3f6acf){console[_0x38fd02(0x1bd)](_0x38fd02(0xdd),_0x3f6acf);}else console[_0x38fd02(0x182)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x2395f8['id']+_0x38fd02(0x1b9));}await database_1[_0x38fd02(0x14d)][_0x38fd02(0xb6)][_0x38fd02(0x19c)]({'data':{'paymentId':_0x2395f8['id'],'shopId':_0x2395f8['shopId'],'event':_0x38fd02(0x1bf)+_0x35abb9[_0x38fd02(0x142)][_0x38fd02(0xfc)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x2395f8['status'],'newStatus':_0x35abb9[_0x38fd02(0x142)],'paymentDetails':_0x35abb9[_0x38fd02(0x172)],'checkedAt':new Date()[_0x38fd02(0x1b1)]()})}}),await this[_0x38fd02(0x161)](_0x2395f8,_0x35abb9[_0x38fd02(0x142)]),await this['sendPaymentStatusNotification'](_0x2395f8,_0x35abb9[_0x38fd02(0x142)]),_0x35abb9[_0x38fd02(0x142)]!==_0x38fd02(0x13e)&&(console[_0x38fd02(0x182)](_0x38fd02(0x1ba)+_0x2395f8['id']+_0x38fd02(0x170)+_0x35abb9[_0x38fd02(0x142)]+_0x38fd02(0x180)),this[_0x38fd02(0x159)](_0x2395f8['id'])),console[_0x38fd02(0x182)](_0x38fd02(0xd2)+_0x2395f8['id']+_0x38fd02(0x130));}else console[_0x38fd02(0x182)](_0x38fd02(0x19d)+_0x2395f8['id']+_0x38fd02(0x196)+_0x35abb9[_0x38fd02(0x142)]+')'),this[_0x38fd02(0x15d)](_0x2395f8['id'],_0x2395f8[_0x38fd02(0x1a0)],_0x2395f8['status'],_0x35abb9[_0x38fd02(0x142)],_0x38fd02(0xc2),{'statusUnchanged':!![],'paymentDetails':_0x35abb9[_0x38fd02(0x172)],'amount':_0x35abb9[_0x38fd02(0x157)],'currency':_0x35abb9['currency'],'shopId':_0x2395f8['shopId'],'checkTimestamp':new Date()[_0x38fd02(0x1b1)]()});}catch(_0x532dba){console[_0x38fd02(0x1bd)](_0x38fd02(0x15a)+_0x2395f8['id']+':',_0x532dba),this[_0x38fd02(0x167)](_0x2395f8['id'],_0x2395f8[_0x38fd02(0x1a0)],_0x532dba,_0x38fd02(0xc2),{'paymentAmount':_0x2395f8['amount'],'paymentCurrency':_0x2395f8['currency'],'shopId':_0x2395f8[_0x38fd02(0x19e)],'createdAt':_0x2395f8[_0x38fd02(0xee)]}),await database_1[_0x38fd02(0x14d)][_0x38fd02(0xb6)]['create']({'data':{'paymentId':_0x2395f8['id'],'shopId':_0x2395f8[_0x38fd02(0x19e)],'event':_0x38fd02(0x158),'statusCode':0x1f4,'responseBody':JSON[_0x38fd02(0x169)]({'error':_0x532dba instanceof Error?_0x532dba['message']:_0x38fd02(0x188),'gatewayPaymentId':_0x2395f8[_0x38fd02(0x1a0)],'checkedAt':new Date()[_0x38fd02(0x1b1)]()})}});}}async[a38_0x461fff(0x161)](_0xa36fa6,_0x564e92){const _0xa46c29=a38_0x461fff,_0x5c085d=Date['now']();try{const _0xcd21e4=_0xa36fa6[_0xa46c29(0x168)],_0x465ab7=_0xcd21e4[_0xa46c29(0x1b4)];if(!_0x465ab7?.['webhookUrl']){console[_0xa46c29(0x182)](_0xa46c29(0x1a3)+_0xcd21e4['id']);return;}const _0x573d2a=_0x564e92===_0xa46c29(0xb2)?_0xa46c29(0xb8):_0x564e92==='FAILED'?_0xa46c29(0x144):_0x564e92===_0xa46c29(0xe6)?'payment.failed':'payment.pending';if(!_0x465ab7[_0xa46c29(0xf0)]?.[_0xa46c29(0x18e)](_0x573d2a)){console['log'](_0xa46c29(0x146)+_0x573d2a+_0xa46c29(0x129)+_0xcd21e4['id']);return;}const _0xbbaff5=(0x0,gateway_1[_0xa46c29(0x11a)])(_0xa36fa6[_0xa46c29(0x135)])||_0xa36fa6[_0xa46c29(0x135)],_0xcfa60={'event':_0x573d2a,'payment':{'id':_0xa36fa6['id'],'order_id':_0xa36fa6[_0xa46c29(0xe7)],'gateway_order_id':_0xa36fa6[_0xa46c29(0xb9)],'gateway':_0xbbaff5,'amount':_0xa36fa6[_0xa46c29(0x157)],'currency':_0xa36fa6[_0xa46c29(0x173)],'status':_0x564e92[_0xa46c29(0xfc)](),'customer_email':_0xa36fa6[_0xa46c29(0xdc)],'customer_name':_0xa36fa6[_0xa46c29(0x155)],'created_at':_0xa36fa6[_0xa46c29(0xee)],'updated_at':new Date()}},_0x5b4747=await fetch(_0x465ab7[_0xa46c29(0xbb)],{'method':_0xa46c29(0x16d),'headers':{'Content-Type':_0xa46c29(0x12f),'User-Agent':_0xa46c29(0x177)},'body':JSON['stringify'](_0xcfa60)}),_0x4b9349=Date[_0xa46c29(0x185)]()-_0x5c085d,_0x24a13c=_0x5b4747['ok']?'Success':await _0x5b4747[_0xa46c29(0x17a)]();loggerService_1[_0xa46c29(0x10a)][_0xa46c29(0x1b2)](_0xa36fa6['shopId'],_0x465ab7[_0xa46c29(0xbb)],_0x573d2a,_0x5b4747[_0xa46c29(0x142)],_0x4b9349,_0xcfa60),console[_0xa46c29(0x182)](_0xa46c29(0xd9)+_0x465ab7['webhookUrl']+_0xa46c29(0x13f)+_0x5b4747[_0xa46c29(0x142)]+'\x20('+_0x4b9349+_0xa46c29(0xde));}catch(_0x238b9c){console[_0xa46c29(0x1bd)](_0xa46c29(0x14f),_0x238b9c),loggerService_1[_0xa46c29(0x10a)][_0xa46c29(0xf9)](_0xa36fa6[_0xa46c29(0x19e)],_0xa36fa6[_0xa46c29(0x168)]?.[_0xa46c29(0x1b4)]?.[_0xa46c29(0xbb)]||'unknown',_0xa46c29(0xf6),_0x238b9c,{});}}async[a38_0x461fff(0xbc)](_0x441331,_0x209dc4){const _0x241232=a38_0x461fff;try{const _0x4f14c2={'PENDING':_0x241232(0xc5),'PAID':_0x241232(0xe3),'FAILED':_0x241232(0x119),'EXPIRED':'expired'},_0xd6af97=_0x4f14c2[_0x209dc4];if(!_0xd6af97||_0xd6af97===_0x241232(0xc5))return;await telegramBotService_1[_0x241232(0x133)][_0x241232(0x107)](_0x441331[_0x241232(0x19e)],_0x441331,_0xd6af97);}catch(_0x27e10e){console[_0x241232(0x1bd)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x27e10e);}}async[a38_0x461fff(0x1b3)](_0x417d27){const _0x5c0a66=a38_0x461fff;console[_0x5c0a66(0x182)]('üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x417d27);const _0x124975=await database_1[_0x5c0a66(0x14d)]['payment']['findUnique']({'where':{'id':_0x417d27},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x124975)throw new Error('Payment\x20not\x20found');if(_0x124975[_0x5c0a66(0x135)]!==_0x5c0a66(0x193)&&_0x124975['gateway']!==_0x5c0a66(0x174))throw new Error(_0x5c0a66(0xc8));console[_0x5c0a66(0x182)](_0x5c0a66(0x16f)+_0x124975[_0x5c0a66(0x135)]+_0x5c0a66(0xd8)+_0x417d27),await this[_0x5c0a66(0x1a8)](_0x124975),console[_0x5c0a66(0x182)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x417d27);}['getServiceStats'](){const _0x1198bb=a38_0x461fff,_0x389007=this['globalCheckInterval']?this[_0x1198bb(0x11c)]:undefined,_0x5f0f36=Array['from'](this[_0x1198bb(0x1be)]['values']())[_0x1198bb(0x109)](_0x188ed7=>({'paymentId':_0x188ed7[_0x1198bb(0x1aa)],'gatewayPaymentId':_0x188ed7['gatewayPaymentId'],'createdAt':_0x188ed7['createdAt'],'timersCount':_0x188ed7[_0x1198bb(0x13c)][_0x1198bb(0x1b6)]}));return{'isActive':!!this[_0x1198bb(0xfe)],'globalCheckIntervalMinutes':this[_0x1198bb(0x11c)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x1198bb(0x1be)][_0x1198bb(0xe2)],'nextGlobalCheckIn':_0x389007,'paymentTimersDetails':_0x5f0f36};}[a38_0x461fff(0x1b0)](_0x32494d){const _0x2ed9d6=a38_0x461fff,_0x37bb38=this[_0x2ed9d6(0x1be)][_0x2ed9d6(0xb4)](_0x32494d);if(_0x37bb38)return{'hasTimers':!![],'timersCount':_0x37bb38[_0x2ed9d6(0x13c)]['length'],'createdAt':_0x37bb38['createdAt'],'gatewayPaymentId':_0x37bb38['gatewayPaymentId']};return{'hasTimers':![]};}async[a38_0x461fff(0xbf)](_0x578710,_0xeb84ba){const _0x1b0139=a38_0x461fff;try{const _0x59ecc1=await database_1[_0x1b0139(0x14d)][_0x1b0139(0x168)][_0x1b0139(0xe8)]({'where':{'id':_0x578710},'select':{'gatewaySettings':!![]}});if(!_0x59ecc1?.[_0x1b0139(0x17c)])return console[_0x1b0139(0x182)](_0x1b0139(0x12a)+_0x578710+_0x1b0139(0xc9)),0xa;const _0x493836=JSON[_0x1b0139(0x123)](_0x59ecc1[_0x1b0139(0x17c)]);for(const [_0x222f46,_0x33a1f6]of Object[_0x1b0139(0xce)](_0x493836)){if(_0x222f46[_0x1b0139(0xfc)]()===_0xeb84ba['toLowerCase']()){const _0x1208fd=_0x33a1f6['commission']||0xa;return console['log'](_0x1b0139(0x17e)+_0xeb84ba+_0x1b0139(0x189)+_0x578710+':\x20'+_0x1208fd+'%'),_0x1208fd;}}return console['log']('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0xeb84ba+_0x1b0139(0x194)+_0x578710+',\x20using\x20default\x2010%'),0xa;}catch(_0x39d1c2){return console[_0x1b0139(0x1bd)](_0x1b0139(0xd7)+_0x578710+_0x1b0139(0x13a)+_0xeb84ba+':',_0x39d1c2),0xa;}}}exports[a38_0x461fff(0x179)]=CoinToPayStatusService,exports[a38_0x461fff(0x165)]=new CoinToPayStatusService();