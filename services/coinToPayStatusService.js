'use strict';function a38_0x5222(){const _0x1c3c12=['paymentLink','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','timestamp','FAILED','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','description','length','.\x20Remaining\x20active\x20timers:\x20','toLowerCase','POST','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#',',\x20currentPayments=','gatewaySettings','Bank\x20Details:\x20','gateway','üìä\x20[HOURLY]\x20Payment\x20','delay','PAID','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20in\x20','getPaymentTimerInfo','\x20not\x20found,\x20clearing\x20timers','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','\x20is\x20older\x20than\x20','clearPaymentTimers',',\x20using\x20default\x20commission\x2010%','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20->\x20','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20expired','getGatewayCommission','expired','currentPayments','3apcQSQ','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','__importDefault','CoinToPay2Service','now','\x20\x20\x20Amount\x20after\x20commission:\x20','üßπ\x20[DEBUG]\x20Clearing\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','EXPIRED','paymentLinkId','\x20\x20\x20üìù\x20Details:','checkPaymentById','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','startPeriodicStatusCheck','Gateway\x20','\x20\x20\x20-\x20paymentId:\x20','5254278aifAvi','h),\x20skipping\x20global\x20check','customerName','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','‚è∞\x20[EXPIRY]\x20Payment\x20','\x20\x20\x20-\x20Amount:\x20','amountUSDT','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','forEach','schedulePaymentChecks','coinToPayService','\x20pending\x20CoinToPay\x20payments','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','failed','application/json','logCoinToPayStatus','includes','customerEmail','payment.success','\x20to\x20clear',',\x20stopping\x20individual\x20checks','Success','\x20\x20\x20-\x20gatewayPaymentId:\x20','stack','checkExpiredPayments','\x20status\x20changed\x20to\x20','toISOString','COINTOPAY_ERROR','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20days,\x20marking\x20as\x20EXPIRED','createdOn','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','5246937wkozwm','\x20days\x20(created\x20before\x20','checkSinglePaymentById','webhookEvents','logShopWebhookSent','getTime','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20updated\x20successfully','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','payment','\x20\x20\x20Amount:\x20','\x20individual\x20payment\x20timers',',\x20status=','1790fQNzqj','2\x20minutes','delete','unknown','type','payment.failed','864746LSkqmH','error','‚úÖ\x20[HOURLY]\x20Payment\x20','currency','SINGLE','8ztjEFU','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','default','logCoinToPayError','getServiceStats','webhookUrl','\x20days\x20without\x20payment\x20confirmation','\x20commission:\x20','floor','sendPaymentNotification','‚ùå\x20[HOURLY]\x20Payment\x20','paid','\x20\x20\x20üìç\x20Source:\x20','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','__esModule','792730VJvwAo','\x20\x20\x20‚ùå\x20Error:\x20','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','set','gatewayOrderId','parse','/status/','checkSinglePayment','log','sendShopWebhook','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','üßπ\x20[CHECK]\x20Payment\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','checkPaymentStatus','\x20\x20\x20-\x20Status:\x20','stringify','toFixed','\x20(age:\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','cointopay_status_check_','Shop\x20webhook\x20sent\x20to\x20','\x20\x20\x20-\x20Gateway:\x20','paymentId','TesSoft\x20Payment\x20System/1.0','remitterIban','convertToUSDT','CoinToPayService','1\x20minute','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','\x20checked,\x20','‚úÖ\x20[CHECK]\x20Payment\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','shop','COINTOPAY_STATUS_CHANGE','5\x20minutes','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20timers\x20for\x20payment\x20','üìà\x20[COINTOPAY]\x20Payment\x20','\x20completed\x20for\x20payment\x20','ü™ô\x20[GLOBAL]\x20Found\x20','-day\x20timeout','gatewayPaymentId','size','from','findUnique','\x20(after\x20','text','Payment\x20not\x20found','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','Payment\x20older\x20than\x20','push','\x20not\x20enabled\x20for\x20shop\x20','currencyService','Automatically\x20expired\x20after\x20','created','auto_expire','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','createdAt','message','\x20amounts\x20calculated:','timers','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','../types/gateway','amount',',\x20clearing\x20individual\x20timers','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','sendPaymentStatusNotification','paymentTimers','ms)','üí∞\x20[CHECK]\x20Payment\x20','payment.pending','\x20with\x20status\x20','defineProperty','bankDetails','\x20status:\x20','\x20to\x20','EXPIRY_DAYS','GLOBAL_CHECK_INTERVAL_MS','10216hHHgmG','status','entries','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','logShopWebhookError','webhook_send','shopId','CoinToPayStatusService','Unknown\x20error','adminNotes','coinToPayStatusService','‚è∞\x20[GLOBAL]\x20Payment\x20','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','‚è∞\x20[GLOBAL]\x20Found\x20','cointopay2','\x20expired\x20CoinToPay\x20payments','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','\x20seconds\x20(','globalCheckInterval','\x20current\x20status:\x20','create','1449dHLPZd','\x20\x20\x20Gateway\x20','./gateways/coinToPay2Service','paidAt','schedule_created','544688kmpfeY','\x20\x20\x20üìÖ\x20Time:\x20','\x20USDT','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20details:','not\x20confirmed','üìä\x20[CHECK]\x20Payment\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','getDate','Failed\x20to\x20send\x20shop\x20webhook:','Webhook\x20event\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','telegramBotService','get','\x20updated:\x20currentPayments=','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20is\x20too\x20new\x20(','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','webhookLog','settings','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','transactionId','cointopay','üõë\x20[SHUTDOWN]\x20Cleared\x20','cointopay_status_check_error','COMPLETED',',\x20gateway\x20','getGatewayIdByName','status_check','cointopay_auto_expired','checkAllPendingPayments','update','coinToPay2Service','loggerService','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','ü™ô\x20[DEBUG]\x20Creating\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','catch','map','orderId','\x20for\x20payment\x20','\x20has\x20no\x20gatewayPaymentId','findMany','paymentDetails','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','\x20skipped,\x20','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','confirmedOn','../config/database','PENDING','iban','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','./currencyService'];a38_0x5222=function(){return _0x1c3c12;};return a38_0x5222();}const a38_0x295807=a38_0x2a7e;(function(_0x42bb72,_0x529328){const _0xaa5deb=a38_0x2a7e,_0x64c8f7=_0x42bb72();while(!![]){try{const _0x462575=-parseInt(_0xaa5deb(0xea))/0x1+parseInt(_0xaa5deb(0x18b))/0x2*(-parseInt(_0xaa5deb(0x147))/0x3)+-parseInt(_0xaa5deb(0x190))/0x4*(-parseInt(_0xaa5deb(0x19f))/0x5)+parseInt(_0xaa5deb(0x157))/0x6+-parseInt(_0xaa5deb(0xe5))/0x7*(parseInt(_0xaa5deb(0xd0))/0x8)+parseInt(_0xaa5deb(0x178))/0x9+-parseInt(_0xaa5deb(0x185))/0xa;if(_0x462575===_0x529328)break;else _0x64c8f7['push'](_0x64c8f7['shift']());}catch(_0x316cc1){_0x64c8f7['push'](_0x64c8f7['shift']());}}}(a38_0x5222,0x826cb));var __importDefault=this&&this[a38_0x295807(0x149)]||function(_0x483546){const _0x2c9c93=a38_0x295807;return _0x483546&&_0x483546[_0x2c9c93(0x19e)]?_0x483546:{'default':_0x483546};};Object[a38_0x295807(0xca)](exports,'__esModule',{'value':!![]}),exports[a38_0x295807(0xda)]=exports[a38_0x295807(0xd7)]=void 0x0;function a38_0x2a7e(_0x3adce0,_0x5d504c){const _0x5222f4=a38_0x5222();return a38_0x2a7e=function(_0x2a7e3d,_0x28a284){_0x2a7e3d=_0x2a7e3d-0xb6;let _0x34e347=_0x5222f4[_0x2a7e3d];return _0x34e347;},a38_0x2a7e(_0x3adce0,_0x5d504c);}const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a38_0x295807(0xe7)),gateway_1=require(a38_0x295807(0xbf)),database_1=__importDefault(require(a38_0x295807(0x11c))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require('./loggerService'),currencyService_1=require(a38_0x295807(0x120));class CoinToPayStatusService{constructor(){const _0xbb272c=a38_0x295807;this[_0xbb272c(0xe2)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0xbb272c(0xc5)]=new Map(),this[_0xbb272c(0x161)]=new coinToPayService_1[(_0xbb272c(0x1b9))](),this[_0xbb272c(0x10b)]=new coinToPay2Service_1[(_0xbb272c(0x14a))](),console[_0xbb272c(0x1a7)](_0xbb272c(0xd3));}[a38_0x295807(0x160)](_0x510d0d,_0x537835){const _0x2e15e2=a38_0x295807;console['log'](_0x2e15e2(0x138)),console[_0x2e15e2(0x1a7)](_0x2e15e2(0x156)+_0x510d0d),console[_0x2e15e2(0x1a7)](_0x2e15e2(0x16d)+_0x537835),this['clearPaymentTimers'](_0x510d0d);const _0xda5192=[],_0x40af50=new Date(),_0x4a5ab3=[{'delay':0x1*0x3c*0x3e8,'description':_0x2e15e2(0x1ba)},{'delay':0x2*0x3c*0x3e8,'description':_0x2e15e2(0x186)},{'delay':0x5*0x3c*0x3e8,'description':_0x2e15e2(0x1c1)},{'delay':0x5*0x3c*0x3e8,'description':_0x2e15e2(0x1c1)}];console['log'](_0x2e15e2(0x10f)+_0x4a5ab3['length']+'\x20initial\x20timers\x20for\x20payment\x20'+_0x510d0d);let _0x3e3c52=0x0;_0x4a5ab3[_0x2e15e2(0x15f)]((_0x5ef51d,_0x14d3ed)=>{const _0x1b6acb=_0x2e15e2;_0x3e3c52+=_0x5ef51d[_0x1b6acb(0x132)];const _0x4a1efc=setTimeout(async()=>{const _0x5481e1=_0x1b6acb;console['log'](_0x5481e1(0x191)+(_0x14d3ed+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x510d0d+_0x5481e1(0x1cd)+_0x5ef51d['description']+')');try{await this['checkSinglePaymentById'](_0x510d0d),console[_0x5481e1(0x1a7)](_0x5481e1(0x12c)+(_0x14d3ed+0x1)+_0x5481e1(0x1c6)+_0x510d0d);}catch(_0x363b77){console[_0x5481e1(0x18c)]('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x14d3ed+0x1)+_0x5481e1(0x114)+_0x510d0d+':',_0x363b77),this[_0x5481e1(0x193)](_0x510d0d,_0x537835,_0x363b77,_0x5481e1(0x107),{'checkNumber':_0x14d3ed+0x1,'scheduledAfter':_0x5ef51d['description'],'isIndividualCheck':!![]});}},_0x3e3c52);_0xda5192['push'](_0x4a1efc),console['log'](_0x1b6acb(0x1a1)+(_0x14d3ed+0x1)+_0x1b6acb(0x114)+_0x510d0d+_0x1b6acb(0x135)+_0x3e3c52/0x3e8+_0x1b6acb(0xe1)+_0x5ef51d[_0x1b6acb(0x127)]+')');});const _0x40a604=setInterval(async()=>{const _0x273b44=_0x2e15e2;console[_0x273b44(0x1a7)](_0x273b44(0x141)+_0x510d0d);try{const _0x3f192e=await database_1['default'][_0x273b44(0x181)][_0x273b44(0x1cc)]({'where':{'id':_0x510d0d},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x3f192e){console[_0x273b44(0x1a7)](_0x273b44(0x19a)+_0x510d0d+_0x273b44(0x137)),this[_0x273b44(0x13d)](_0x510d0d);return;}console[_0x273b44(0x1a7)](_0x273b44(0x131)+_0x510d0d+_0x273b44(0xe3)+_0x3f192e[_0x273b44(0xd1)]);if(_0x3f192e[_0x273b44(0xd1)]!==_0x273b44(0x11d)){console[_0x273b44(0x1a7)](_0x273b44(0x18d)+_0x510d0d+'\x20status\x20is\x20'+_0x3f192e[_0x273b44(0xd1)]+_0x273b44(0x16b)),this[_0x273b44(0x13d)](_0x510d0d);return;}const _0x5c0112=Math[_0x273b44(0x198)]((Date[_0x273b44(0x14b)]()-_0x3f192e[_0x273b44(0xba)][_0x273b44(0x17d)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x5c0112>=this[_0x273b44(0xce)]){console[_0x273b44(0x1a7)]('‚è∞\x20[HOURLY]\x20Payment\x20'+_0x510d0d+'\x20is\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x273b44(0x15e)),this['clearPaymentTimers'](_0x510d0d);return;}await this[_0x273b44(0x17a)](_0x510d0d),console[_0x273b44(0x1a7)]('‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x510d0d);}catch(_0xb5ca82){console[_0x273b44(0x18c)](_0x273b44(0xb9)+_0x510d0d+':',_0xb5ca82),this[_0x273b44(0x193)](_0x510d0d,_0x537835,_0xb5ca82,_0x273b44(0x107),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0xda5192[_0x2e15e2(0x1d2)](_0x40a604),this[_0x2e15e2(0xc5)][_0x2e15e2(0x1a2)](_0x510d0d,{'timers':_0xda5192,'paymentId':_0x510d0d,'gatewayPaymentId':_0x537835,'createdAt':_0x40af50}),console[_0x2e15e2(0x1a7)](_0x2e15e2(0x1c2)+_0x4a5ab3[_0x2e15e2(0x128)]+_0x2e15e2(0x1d0)+_0x510d0d),console[_0x2e15e2(0x1a7)](_0x2e15e2(0x177)+this[_0x2e15e2(0xc5)][_0x2e15e2(0x1ca)]),this['logCoinToPayStatus'](_0x510d0d,_0x537835,_0x2e15e2(0x11d),_0x2e15e2(0x11d),_0x2e15e2(0x107),{'action':_0x2e15e2(0xe9),'scheduledChecks':_0x4a5ab3['length'],'firstCheckIn':_0x4a5ab3[0x0]['delay']/0x3e8,'totalTimers':this[_0x2e15e2(0xc5)]['size']});}[a38_0x295807(0x13d)](_0x30fc6b){const _0xd8d3d5=a38_0x295807,_0x509f84=this['paymentTimers'][_0xd8d3d5(0xf8)](_0x30fc6b);_0x509f84?(console['log'](_0xd8d3d5(0x14d)+_0x509f84[_0xd8d3d5(0xbd)][_0xd8d3d5(0x128)]+_0xd8d3d5(0x1c4)+_0x30fc6b),_0x509f84[_0xd8d3d5(0xbd)]['forEach']((_0x1092da,_0xbcc398)=>{const _0x28877b=_0xd8d3d5;_0x1092da&&(clearTimeout(_0x1092da),clearInterval(_0x1092da),console['log'](_0x28877b(0x1a9)+(_0xbcc398+0x1)+_0x28877b(0x114)+_0x30fc6b));}),this[_0xd8d3d5(0xc5)][_0xd8d3d5(0x187)](_0x30fc6b),console[_0xd8d3d5(0x1a7)](_0xd8d3d5(0xff)+_0x30fc6b+_0xd8d3d5(0x129)+this['paymentTimers'][_0xd8d3d5(0x1ca)])):console[_0xd8d3d5(0x1a7)](_0xd8d3d5(0x153)+_0x30fc6b+_0xd8d3d5(0x16a));}async[a38_0x295807(0x17a)](_0x3e1578){const _0x46f84f=a38_0x295807;console[_0x46f84f(0x1a7)](_0x46f84f(0x139)+_0x3e1578);const _0x16d083=await database_1[_0x46f84f(0x192)][_0x46f84f(0x181)][_0x46f84f(0x1cc)]({'where':{'id':_0x3e1578},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x16d083){console[_0x46f84f(0x1a7)]('‚ùå\x20[CHECK]\x20Payment\x20'+_0x3e1578+'\x20not\x20found\x20in\x20database');return;}console['log'](_0x46f84f(0xf1)+_0x3e1578+'\x20found:'),console[_0x46f84f(0x1a7)](_0x46f84f(0x1b4)+_0x16d083[_0x46f84f(0x130)]),console[_0x46f84f(0x1a7)](_0x46f84f(0x1ad)+_0x16d083[_0x46f84f(0xd1)]),console[_0x46f84f(0x1a7)](_0x46f84f(0x14e)+_0x16d083[_0x46f84f(0x1c9)]),console[_0x46f84f(0x1a7)](_0x46f84f(0x15c)+_0x16d083['amount']+'\x20'+_0x16d083['currency']),console[_0x46f84f(0x1a7)]('\x20\x20\x20-\x20ShopId:\x20'+_0x16d083['shopId']);if(_0x16d083[_0x46f84f(0x130)]!==_0x46f84f(0x101)&&_0x16d083[_0x46f84f(0x130)]!=='cointopay2'){console['log'](_0x46f84f(0x110)+_0x3e1578+_0x46f84f(0x163)+_0x16d083[_0x46f84f(0x130)]+')');return;}if(_0x16d083[_0x46f84f(0xd1)]!=='PENDING'){console[_0x46f84f(0x1a7)](_0x46f84f(0x110)+_0x3e1578+'\x20status\x20is\x20'+_0x16d083[_0x46f84f(0xd1)]+_0x46f84f(0x16b)),this[_0x46f84f(0x13d)](_0x3e1578);return;}if(!_0x16d083['gatewayPaymentId']){console[_0x46f84f(0x1a7)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x3e1578+_0x46f84f(0x115));return;}console[_0x46f84f(0x1a7)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x3e1578+_0x46f84f(0x142)),await this[_0x46f84f(0x1a6)](_0x16d083);}[a38_0x295807(0x166)](_0x213567,_0x5ede3e,_0x435fe0,_0xf441f,_0x4f2c43,_0x4cc32b){const _0x5c4636=a38_0x295807,_0x58ea31={'type':_0x5c4636(0x1c0),'paymentId':_0x213567,'gatewayPaymentId':_0x5ede3e,'oldStatus':_0x435fe0,'newStatus':_0xf441f,'source':_0x4f2c43,'timestamp':new Date()[_0x5c4636(0x171)](),'details':_0x4cc32b||{}};loggerService_1[_0x5c4636(0x10c)][_0x5c4636(0x166)](_0x58ea31),console[_0x5c4636(0x1a7)](_0x5c4636(0x118)+_0x213567+'\x20('+_0x5ede3e+')'),console['log']('\x20\x20\x20üìä\x20Status:\x20'+_0x435fe0+_0x5c4636(0x140)+_0xf441f),console[_0x5c4636(0x1a7)](_0x5c4636(0x19c)+_0x4f2c43),console['log'](_0x5c4636(0xeb)+_0x58ea31[_0x5c4636(0x123)]),_0x4cc32b&&console[_0x5c4636(0x1a7)](_0x5c4636(0x151),_0x4cc32b);}[a38_0x295807(0x193)](_0x5c28a2,_0x1095b7,_0x2badbb,_0x5327ce,_0x1475c9){const _0x30f90c=a38_0x295807,_0x2630cc={'type':_0x30f90c(0x172),'paymentId':_0x5c28a2,'gatewayPaymentId':_0x1095b7,'error':_0x2badbb instanceof Error?{'message':_0x2badbb[_0x30f90c(0xbb)],'stack':_0x2badbb[_0x30f90c(0x16e)]}:_0x2badbb,'source':_0x5327ce,'timestamp':new Date()['toISOString'](),'context':_0x1475c9||{}};loggerService_1[_0x30f90c(0x10c)]['logCoinToPayError'](_0x2630cc),console[_0x30f90c(0x18c)](_0x30f90c(0x17e)+_0x5c28a2+'\x20('+_0x1095b7+')'),console[_0x30f90c(0x18c)](_0x30f90c(0x1a0)+(_0x2badbb instanceof Error?_0x2badbb[_0x30f90c(0xbb)]:_0x2badbb)),console[_0x30f90c(0x18c)](_0x30f90c(0x19c)+_0x5327ce),console[_0x30f90c(0x18c)](_0x30f90c(0xeb)+_0x2630cc[_0x30f90c(0x123)]),_0x1475c9&&console[_0x30f90c(0x18c)]('\x20\x20\x20üìù\x20Context:',_0x1475c9);}[a38_0x295807(0x154)](){const _0x140d7f=a38_0x295807;console[_0x140d7f(0x1a7)](_0x140d7f(0xf2)),this['checkAllPendingPayments']()[_0x140d7f(0x111)](_0x2e11ea=>{const _0x2fa304=_0x140d7f;console[_0x2fa304(0x18c)](_0x2fa304(0xed),_0x2e11ea);}),this[_0x140d7f(0xe2)]=setInterval(async()=>{const _0x3de12c=_0x140d7f;try{console[_0x3de12c(0x1a7)](_0x3de12c(0x148)),await this[_0x3de12c(0x109)](),console['log'](_0x3de12c(0x1be));}catch(_0x3954be){console[_0x3de12c(0x18c)](_0x3de12c(0xbe),_0x3954be);}},this[_0x140d7f(0xcf)]),console[_0x140d7f(0x1a7)](_0x140d7f(0x180));}['stopPeriodicStatusCheck'](){const _0x487c23=a38_0x295807;console['log'](_0x487c23(0x10e));this[_0x487c23(0xe2)]&&(clearInterval(this[_0x487c23(0xe2)]),this[_0x487c23(0xe2)]=null,console[_0x487c23(0x1a7)](_0x487c23(0x173)));const _0x35ee0d=this['paymentTimers']['size'];for(const [_0x6cc8c3]of this[_0x487c23(0xc5)]){this[_0x487c23(0x13d)](_0x6cc8c3);}console[_0x487c23(0x1a7)](_0x487c23(0x102)+_0x35ee0d+_0x487c23(0x183));}async[a38_0x295807(0x109)](){const _0x1a1057=a38_0x295807;try{console['log'](_0x1a1057(0x11a));const _0x10ee44=await database_1[_0x1a1057(0x192)]['payment'][_0x1a1057(0x116)]({'where':{'gateway':{'in':[_0x1a1057(0x101),_0x1a1057(0xde)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x1a1057(0x1a7)](_0x1a1057(0x1c7)+_0x10ee44[_0x1a1057(0x128)]+_0x1a1057(0x162));if(_0x10ee44[_0x1a1057(0x128)]===0x0){console[_0x1a1057(0x1a7)]('ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x26f97d=await this[_0x1a1057(0x16f)](_0x10ee44);console[_0x1a1057(0x1a7)](_0x1a1057(0xdd)+_0x26f97d[_0x1a1057(0x128)]+_0x1a1057(0xdf));let _0x3171ae=0x0,_0x1771f9=0x0;for(const _0x17b440 of _0x10ee44){try{if(_0x26f97d[_0x1a1057(0x167)](_0x17b440['id'])){console[_0x1a1057(0x1a7)](_0x1a1057(0xdb)+_0x17b440['id']+_0x1a1057(0x15a)),_0x1771f9++;continue;}if(this[_0x1a1057(0xc5)]['has'](_0x17b440['id'])){console[_0x1a1057(0x1a7)](_0x1a1057(0xdb)+_0x17b440['id']+_0x1a1057(0xe0)),_0x1771f9++;continue;}const _0x2c96e0=(Date[_0x1a1057(0x14b)]()-_0x17b440[_0x1a1057(0xba)][_0x1a1057(0x17d)]())/(0x3e8*0x3c*0x3c);if(_0x2c96e0<0x1){console[_0x1a1057(0x1a7)](_0x1a1057(0xdb)+_0x17b440['id']+_0x1a1057(0xfb)+_0x2c96e0[_0x1a1057(0x1af)](0x1)+_0x1a1057(0x158)),_0x1771f9++;continue;}console['log'](_0x1a1057(0xdc)+_0x17b440['id']+_0x1a1057(0x1b0)+_0x2c96e0[_0x1a1057(0x1af)](0x1)+'h)'),await this[_0x1a1057(0x1a6)](_0x17b440),_0x3171ae++,await new Promise(_0xeba463=>setTimeout(_0xeba463,0x7d0));}catch(_0x34487b){console[_0x1a1057(0x18c)](_0x1a1057(0x1b1)+_0x17b440['id']+':',_0x34487b),this[_0x1a1057(0x193)](_0x17b440['id'],_0x17b440[_0x1a1057(0x1c9)]||_0x1a1057(0x188),_0x34487b,_0x1a1057(0x107),{'isGlobalCheck':!![],'paymentAmount':_0x17b440['amount'],'paymentCurrency':_0x17b440['currency'],'shopId':_0x17b440[_0x1a1057(0xd6)],'createdAt':_0x17b440[_0x1a1057(0xba)]}),loggerService_1[_0x1a1057(0x10c)]['logWhiteDomainError'](_0x1a1057(0x101),_0x1a1057(0x1a5)+_0x17b440[_0x1a1057(0x1c9)],_0x34487b);}}console[_0x1a1057(0x1a7)](_0x1a1057(0x13a)+_0x3171ae+_0x1a1057(0x1bc)+_0x1771f9+_0x1a1057(0x119)+_0x26f97d[_0x1a1057(0x128)]+_0x1a1057(0x143));}catch(_0x4f8813){console['error'](_0x1a1057(0x134),_0x4f8813);}}async[a38_0x295807(0x16f)](_0x4ba8f6){const _0x4410bd=a38_0x295807,_0x1800c8=[],_0x327bdd=new Date();_0x327bdd['setDate'](_0x327bdd[_0x4410bd(0xf3)]()-this[_0x4410bd(0xce)]),console[_0x4410bd(0x1a7)](_0x4410bd(0x11f)+this[_0x4410bd(0xce)]+_0x4410bd(0x179)+_0x327bdd['toISOString']()+')');for(const _0x380834 of _0x4ba8f6){if(_0x380834['createdAt']<_0x327bdd){console[_0x4410bd(0x1a7)](_0x4410bd(0x15b)+_0x380834['id']+_0x4410bd(0x13c)+this[_0x4410bd(0xce)]+_0x4410bd(0x174));try{this[_0x4410bd(0x166)](_0x380834['id'],_0x380834[_0x4410bd(0x1c9)]||_0x4410bd(0x188),_0x4410bd(0x11d),_0x4410bd(0x14f),_0x4410bd(0xb8),{'reason':_0x4410bd(0x1d1)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x380834['createdAt'],'daysSinceCreation':Math[_0x4410bd(0x198)]((Date[_0x4410bd(0x14b)]()-_0x380834[_0x4410bd(0xba)]['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x380834[_0x4410bd(0xc0)],'paymentCurrency':_0x380834['currency'],'shopId':_0x380834['shopId']}),await database_1[_0x4410bd(0x192)]['payment']['update']({'where':{'id':_0x380834['id']},'data':{'status':_0x4410bd(0x14f),'updatedAt':new Date(),'adminNotes':_0x4410bd(0xb6)+this['EXPIRY_DAYS']+_0x4410bd(0x196)}}),await database_1[_0x4410bd(0x192)][_0x4410bd(0xfd)][_0x4410bd(0xe4)]({'data':{'paymentId':_0x380834['id'],'shopId':_0x380834['shopId'],'event':_0x4410bd(0x108),'statusCode':0xc8,'responseBody':JSON[_0x4410bd(0x1ae)]({'reason':_0x4410bd(0x1d1)+this[_0x4410bd(0xce)]+'\x20days','createdAt':_0x380834['createdAt'],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x4410bd(0x198)]((Date[_0x4410bd(0x14b)]()-_0x380834[_0x4410bd(0xba)][_0x4410bd(0x17d)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x4410bd(0x1a8)](_0x380834,_0x4410bd(0x14f)),await this[_0x4410bd(0xc4)](_0x380834,_0x4410bd(0x14f)),this[_0x4410bd(0x13d)](_0x380834['id']),_0x1800c8[_0x4410bd(0x1d2)](_0x380834['id']),console[_0x4410bd(0x1a7)]('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x380834['id']+_0x4410bd(0x1bb)+this['EXPIRY_DAYS']+_0x4410bd(0x1c8));}catch(_0x2c6b4d){console['error']('‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x380834['id']+':',_0x2c6b4d),this[_0x4410bd(0x193)](_0x380834['id'],_0x380834[_0x4410bd(0x1c9)]||'unknown',_0x2c6b4d,_0x4410bd(0xb8),{'reason':_0x4410bd(0x1ab),'createdAt':_0x380834[_0x4410bd(0xba)],'daysSinceCreation':Math[_0x4410bd(0x198)]((Date[_0x4410bd(0x14b)]()-_0x380834[_0x4410bd(0xba)][_0x4410bd(0x17d)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x1800c8;}async[a38_0x295807(0x1a6)](_0x3ef932){const _0x1c680c=a38_0x295807;if(!_0x3ef932[_0x1c680c(0x1c9)]){console[_0x1c680c(0x1a7)](_0x1c680c(0x110)+_0x3ef932['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x1c680c(0x1a7)]('üîç\x20[CHECK]\x20Checking\x20'+_0x3ef932['gateway']+'\x20payment\x20'+_0x3ef932['id']+'\x20('+_0x3ef932[_0x1c680c(0x1c9)]+')');try{let _0x537dda;_0x3ef932[_0x1c680c(0x130)]==='cointopay2'?(_0x537dda=await this['coinToPay2Service']['checkPaymentStatus'](_0x3ef932['gatewayPaymentId']),console[_0x1c680c(0x1a7)](_0x1c680c(0x125)+_0x3ef932['id']+_0x1c680c(0xcc)+_0x537dda[_0x1c680c(0xd1)])):(_0x537dda=await this[_0x1c680c(0x161)][_0x1c680c(0x1ac)](_0x3ef932['gatewayPaymentId']),console[_0x1c680c(0x1a7)]('üìä\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x3ef932['id']+_0x1c680c(0xcc)+_0x537dda[_0x1c680c(0xd1)]));_0x537dda[_0x1c680c(0x117)]&&console[_0x1c680c(0x1a7)]('üìä\x20[CHECK]\x20Payment\x20'+_0x3ef932['id']+_0x1c680c(0xef),{'iban':_0x537dda[_0x1c680c(0x117)][_0x1c680c(0x11e)]||'not\x20found','transactionId':_0x537dda['paymentDetails'][_0x1c680c(0x100)],'createdOn':_0x537dda[_0x1c680c(0x117)][_0x1c680c(0x175)],'confirmedOn':_0x537dda[_0x1c680c(0x117)]['confirmedOn']||_0x1c680c(0xf0)});if(_0x537dda[_0x1c680c(0xd1)]!==_0x3ef932[_0x1c680c(0xd1)]){console[_0x1c680c(0x1a7)](_0x1c680c(0xc3)+_0x3ef932['id']+'\x20status\x20from\x20'+_0x3ef932[_0x1c680c(0xd1)]+_0x1c680c(0xcd)+_0x537dda[_0x1c680c(0xd1)]),this['logCoinToPayStatus'](_0x3ef932['id'],_0x3ef932['gatewayPaymentId'],_0x3ef932[_0x1c680c(0xd1)],_0x537dda['status'],_0x1c680c(0x107),{'paymentDetails':_0x537dda[_0x1c680c(0x117)],'amount':_0x537dda[_0x1c680c(0xc0)],'currency':_0x537dda[_0x1c680c(0x18e)],'shopId':_0x3ef932['shopId'],'checkTimestamp':new Date()[_0x1c680c(0x171)]()});const _0x2461e6={'status':_0x537dda['status'],'updatedAt':new Date()};if(_0x537dda['status']===_0x1c680c(0x133)&&_0x3ef932[_0x1c680c(0xd1)]!==_0x1c680c(0x133)){_0x2461e6[_0x1c680c(0xe8)]=new Date();if(!_0x3ef932['amountUSDT']){const _0x5ae649=await currencyService_1[_0x1c680c(0x1d4)][_0x1c680c(0x1b8)](_0x3ef932[_0x1c680c(0xc0)],_0x3ef932[_0x1c680c(0x18e)]);_0x2461e6[_0x1c680c(0x15d)]=_0x5ae649;const _0x372a1c=await this[_0x1c680c(0x144)](_0x3ef932[_0x1c680c(0xd6)],_0x3ef932[_0x1c680c(0x130)]),_0x4a1cad=_0x5ae649*(0x1-_0x372a1c/0x64);_0x2461e6['amountAfterGatewayCommissionUSDT']=_0x4a1cad,console[_0x1c680c(0x1a7)](_0x1c680c(0xc7)+_0x3ef932['id']+_0x1c680c(0xbc)),console[_0x1c680c(0x1a7)](_0x1c680c(0x182)+_0x3ef932[_0x1c680c(0xc0)]+'\x20'+_0x3ef932['currency']+_0x1c680c(0x140)+_0x5ae649[_0x1c680c(0x1af)](0x6)+_0x1c680c(0xec)),console[_0x1c680c(0x1a7)](_0x1c680c(0xe6)+_0x3ef932['gateway']+_0x1c680c(0x197)+_0x372a1c+'%'),console[_0x1c680c(0x1a7)](_0x1c680c(0x14c)+_0x4a1cad['toFixed'](0x6)+_0x1c680c(0xec));}console[_0x1c680c(0x1a7)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x3ef932['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x2461e6[_0x1c680c(0xe8)][_0x1c680c(0x171)]());}if(_0x537dda['paymentDetails']){const _0x245f0b=_0x537dda['paymentDetails'];_0x245f0b['iban']&&(_0x2461e6[_0x1c680c(0x1b7)]=_0x245f0b[_0x1c680c(0x11e)],console['log']('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x245f0b[_0x1c680c(0x11e)]));if(_0x245f0b[_0x1c680c(0xcb)]){const _0x49033b=_0x3ef932[_0x1c680c(0xd9)]||'',_0x22e4ca=_0x1c680c(0x12f)+_0x245f0b['bankDetails'];_0x2461e6[_0x1c680c(0xd9)]=_0x49033b?_0x49033b+'\x0a\x0a'+_0x22e4ca:_0x22e4ca,console['log'](_0x1c680c(0x13b));}_0x245f0b[_0x1c680c(0x100)]&&console['log'](_0x1c680c(0x10d)+_0x245f0b[_0x1c680c(0x100)]),_0x245f0b[_0x1c680c(0x11b)]&&console[_0x1c680c(0x1a7)](_0x1c680c(0xc2)+_0x245f0b[_0x1c680c(0x11b)]);}await database_1[_0x1c680c(0x192)][_0x1c680c(0x181)]['update']({'where':{'id':_0x3ef932['id']},'data':_0x2461e6});if(_0x537dda[_0x1c680c(0xd1)]===_0x1c680c(0x133)&&_0x3ef932[_0x1c680c(0xd1)]!=='PAID'){console[_0x1c680c(0x1a7)](_0x1c680c(0x1c5)+_0x3ef932['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x3f33b8=await database_1[_0x1c680c(0x192)]['payment'][_0x1c680c(0x1cc)]({'where':{'id':_0x3ef932['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x3f33b8?.[_0x1c680c(0x150)]&&_0x3f33b8[_0x1c680c(0x121)])try{const _0x5390f7=_0x3f33b8[_0x1c680c(0x121)];console[_0x1c680c(0x1a7)]('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x5390f7['id']+':\x20type='+_0x5390f7[_0x1c680c(0x189)]+_0x1c680c(0x12d)+_0x5390f7[_0x1c680c(0x146)]+_0x1c680c(0x184)+_0x5390f7[_0x1c680c(0xd1)]);const _0x9322ac=_0x5390f7[_0x1c680c(0x146)]+0x1,_0x494064=_0x5390f7[_0x1c680c(0x189)]===_0x1c680c(0x18f)?_0x1c680c(0x104):_0x5390f7[_0x1c680c(0xd1)];await database_1[_0x1c680c(0x192)][_0x1c680c(0x121)][_0x1c680c(0x10a)]({'where':{'id':_0x5390f7['id']},'data':{'currentPayments':_0x9322ac,'status':_0x494064,'updatedAt':new Date()}}),console[_0x1c680c(0x1a7)](_0x1c680c(0x122)+_0x5390f7['id']+_0x1c680c(0xf9)+_0x5390f7['currentPayments']+_0x1c680c(0x140)+_0x9322ac+_0x1c680c(0x184)+_0x5390f7['status']+_0x1c680c(0x140)+_0x494064);}catch(_0x3e1b6c){console[_0x1c680c(0x18c)](_0x1c680c(0xf6),_0x3e1b6c);}else console[_0x1c680c(0x1a7)](_0x1c680c(0x1c5)+_0x3ef932['id']+_0x1c680c(0xee));}await database_1[_0x1c680c(0x192)][_0x1c680c(0xfd)]['create']({'data':{'paymentId':_0x3ef932['id'],'shopId':_0x3ef932[_0x1c680c(0xd6)],'event':_0x1c680c(0x1b2)+_0x537dda[_0x1c680c(0xd1)][_0x1c680c(0x12a)](),'statusCode':0xc8,'responseBody':JSON[_0x1c680c(0x1ae)]({'oldStatus':_0x3ef932[_0x1c680c(0xd1)],'newStatus':_0x537dda[_0x1c680c(0xd1)],'paymentDetails':_0x537dda[_0x1c680c(0x117)],'checkedAt':new Date()[_0x1c680c(0x171)]()})}}),await this['sendShopWebhook'](_0x3ef932,_0x537dda[_0x1c680c(0xd1)]),await this[_0x1c680c(0xc4)](_0x3ef932,_0x537dda[_0x1c680c(0xd1)]),_0x537dda[_0x1c680c(0xd1)]!==_0x1c680c(0x11d)&&(console[_0x1c680c(0x1a7)](_0x1c680c(0x1aa)+_0x3ef932['id']+_0x1c680c(0x170)+_0x537dda['status']+_0x1c680c(0xc1)),this[_0x1c680c(0x13d)](_0x3ef932['id'])),console['log'](_0x1c680c(0x1bd)+_0x3ef932['id']+_0x1c680c(0x17f));}else console['log'](_0x1c680c(0xf1)+_0x3ef932['id']+'\x20status\x20unchanged\x20('+_0x537dda['status']+')'),this[_0x1c680c(0x166)](_0x3ef932['id'],_0x3ef932[_0x1c680c(0x1c9)],_0x3ef932[_0x1c680c(0xd1)],_0x537dda[_0x1c680c(0xd1)],_0x1c680c(0x107),{'statusUnchanged':!![],'paymentDetails':_0x537dda['paymentDetails'],'amount':_0x537dda[_0x1c680c(0xc0)],'currency':_0x537dda['currency'],'shopId':_0x3ef932['shopId'],'checkTimestamp':new Date()[_0x1c680c(0x171)]()});}catch(_0x2a921e){console[_0x1c680c(0x18c)](_0x1c680c(0xfa)+_0x3ef932['id']+':',_0x2a921e),this[_0x1c680c(0x193)](_0x3ef932['id'],_0x3ef932[_0x1c680c(0x1c9)],_0x2a921e,_0x1c680c(0x107),{'paymentAmount':_0x3ef932[_0x1c680c(0xc0)],'paymentCurrency':_0x3ef932['currency'],'shopId':_0x3ef932[_0x1c680c(0xd6)],'createdAt':_0x3ef932['createdAt']}),await database_1[_0x1c680c(0x192)]['webhookLog'][_0x1c680c(0xe4)]({'data':{'paymentId':_0x3ef932['id'],'shopId':_0x3ef932['shopId'],'event':_0x1c680c(0x103),'statusCode':0x1f4,'responseBody':JSON[_0x1c680c(0x1ae)]({'error':_0x2a921e instanceof Error?_0x2a921e['message']:_0x1c680c(0xd8),'gatewayPaymentId':_0x3ef932['gatewayPaymentId'],'checkedAt':new Date()[_0x1c680c(0x171)]()})}});}}async[a38_0x295807(0x1a8)](_0xa6f07,_0x1f1f69){const _0x5a3ab0=a38_0x295807,_0x2bbed8=Date[_0x5a3ab0(0x14b)]();try{const _0x4411da=_0xa6f07['shop'],_0x33e035=_0x4411da[_0x5a3ab0(0xfe)];if(!_0x33e035?.['webhookUrl']){console[_0x5a3ab0(0x1a7)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x4411da['id']);return;}const _0xf89a50=_0x1f1f69==='PAID'?_0x5a3ab0(0x169):_0x1f1f69===_0x5a3ab0(0x124)?'payment.failed':_0x1f1f69===_0x5a3ab0(0x14f)?_0x5a3ab0(0x18a):_0x5a3ab0(0xc8);if(!_0x33e035[_0x5a3ab0(0x17b)]?.[_0x5a3ab0(0x167)](_0xf89a50)){console[_0x5a3ab0(0x1a7)](_0x5a3ab0(0xf5)+_0xf89a50+_0x5a3ab0(0x1d3)+_0x4411da['id']);return;}const _0x9f8c46=(0x0,gateway_1[_0x5a3ab0(0x106)])(_0xa6f07[_0x5a3ab0(0x130)])||_0xa6f07[_0x5a3ab0(0x130)],_0x5bf2fa={'event':_0xf89a50,'payment':{'id':_0xa6f07['id'],'order_id':_0xa6f07[_0x5a3ab0(0x113)],'gateway_order_id':_0xa6f07[_0x5a3ab0(0x1a3)],'gateway':_0x9f8c46,'amount':_0xa6f07['amount'],'currency':_0xa6f07['currency'],'status':_0x1f1f69[_0x5a3ab0(0x12a)](),'customer_email':_0xa6f07[_0x5a3ab0(0x168)],'customer_name':_0xa6f07[_0x5a3ab0(0x159)],'created_at':_0xa6f07[_0x5a3ab0(0xba)],'updated_at':new Date()}},_0x3c49af=await fetch(_0x33e035['webhookUrl'],{'method':_0x5a3ab0(0x12b),'headers':{'Content-Type':_0x5a3ab0(0x165),'User-Agent':_0x5a3ab0(0x1b6)},'body':JSON[_0x5a3ab0(0x1ae)](_0x5bf2fa)}),_0x55c145=Date[_0x5a3ab0(0x14b)]()-_0x2bbed8,_0x287dd8=_0x3c49af['ok']?_0x5a3ab0(0x16c):await _0x3c49af[_0x5a3ab0(0x1ce)]();loggerService_1[_0x5a3ab0(0x10c)][_0x5a3ab0(0x17c)](_0xa6f07[_0x5a3ab0(0xd6)],_0x33e035['webhookUrl'],_0xf89a50,_0x3c49af[_0x5a3ab0(0xd1)],_0x55c145,_0x5bf2fa),console[_0x5a3ab0(0x1a7)](_0x5a3ab0(0x1b3)+_0x33e035['webhookUrl']+_0x5a3ab0(0xc9)+_0x3c49af[_0x5a3ab0(0xd1)]+'\x20('+_0x55c145+_0x5a3ab0(0xc6));}catch(_0x47914a){console[_0x5a3ab0(0x18c)](_0x5a3ab0(0xf4),_0x47914a),loggerService_1[_0x5a3ab0(0x10c)][_0x5a3ab0(0xd4)](_0xa6f07[_0x5a3ab0(0xd6)],_0xa6f07[_0x5a3ab0(0x1bf)]?.[_0x5a3ab0(0xfe)]?.[_0x5a3ab0(0x195)]||_0x5a3ab0(0x188),_0x5a3ab0(0xd5),_0x47914a,{});}}async[a38_0x295807(0xc4)](_0x5c925b,_0x48ec89){const _0x41ed37=a38_0x295807;try{const _0x1e25a9={'PENDING':_0x41ed37(0xb7),'PAID':_0x41ed37(0x19b),'FAILED':_0x41ed37(0x164),'EXPIRED':_0x41ed37(0x145)},_0x1ee14a=_0x1e25a9[_0x48ec89];if(!_0x1ee14a||_0x1ee14a===_0x41ed37(0xb7))return;await telegramBotService_1[_0x41ed37(0xf7)][_0x41ed37(0x199)](_0x5c925b[_0x41ed37(0xd6)],_0x5c925b,_0x1ee14a);}catch(_0x4fe96b){console['error'](_0x41ed37(0x126),_0x4fe96b);}}async[a38_0x295807(0x152)](_0xb148b){const _0x30fb83=a38_0x295807;console[_0x30fb83(0x1a7)](_0x30fb83(0x1c3)+_0xb148b);const _0x2346c6=await database_1[_0x30fb83(0x192)]['payment'][_0x30fb83(0x1cc)]({'where':{'id':_0xb148b},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2346c6)throw new Error(_0x30fb83(0x1cf));if(_0x2346c6[_0x30fb83(0x130)]!==_0x30fb83(0x101)&&_0x2346c6[_0x30fb83(0x130)]!==_0x30fb83(0xde))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console[_0x30fb83(0x1a7)](_0x30fb83(0x13f)+_0x2346c6['gateway']+'\x20payment\x20'+_0xb148b),await this[_0x30fb83(0x1a6)](_0x2346c6),console[_0x30fb83(0x1a7)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0xb148b);}[a38_0x295807(0x194)](){const _0x280f33=a38_0x295807,_0x141e7c=this[_0x280f33(0xe2)]?this[_0x280f33(0xcf)]:undefined,_0x4f1711=Array[_0x280f33(0x1cb)](this[_0x280f33(0xc5)]['values']())[_0x280f33(0x112)](_0x1ad11a=>({'paymentId':_0x1ad11a[_0x280f33(0x1b5)],'gatewayPaymentId':_0x1ad11a[_0x280f33(0x1c9)],'createdAt':_0x1ad11a[_0x280f33(0xba)],'timersCount':_0x1ad11a[_0x280f33(0xbd)][_0x280f33(0x128)]}));return{'isActive':!!this[_0x280f33(0xe2)],'globalCheckIntervalMinutes':this[_0x280f33(0xcf)]/(0x3e8*0x3c),'expiryDays':this[_0x280f33(0xce)],'activeIndividualTimers':this['paymentTimers']['size'],'nextGlobalCheckIn':_0x141e7c,'paymentTimersDetails':_0x4f1711};}[a38_0x295807(0x136)](_0x4c6338){const _0x41122e=a38_0x295807,_0x1fe7d7=this['paymentTimers'][_0x41122e(0xf8)](_0x4c6338);if(_0x1fe7d7)return{'hasTimers':!![],'timersCount':_0x1fe7d7[_0x41122e(0xbd)][_0x41122e(0x128)],'createdAt':_0x1fe7d7['createdAt'],'gatewayPaymentId':_0x1fe7d7['gatewayPaymentId']};return{'hasTimers':![]};}async['getGatewayCommission'](_0x241adc,_0x50b79a){const _0x319c97=a38_0x295807;try{const _0x447d4b=await database_1['default'][_0x319c97(0x1bf)]['findUnique']({'where':{'id':_0x241adc},'select':{'gatewaySettings':!![]}});if(!_0x447d4b?.[_0x319c97(0x12e)])return console[_0x319c97(0x1a7)](_0x319c97(0x176)+_0x241adc+_0x319c97(0x13e)),0xa;const _0x39df75=JSON[_0x319c97(0x1a4)](_0x447d4b[_0x319c97(0x12e)]);for(const [_0x7a3d9b,_0x2be776]of Object[_0x319c97(0xd2)](_0x39df75)){if(_0x7a3d9b[_0x319c97(0x12a)]()===_0x50b79a[_0x319c97(0x12a)]()){const _0x3ded33=_0x2be776['commission']||0xa;return console[_0x319c97(0x1a7)](_0x319c97(0x155)+_0x50b79a+'\x20commission\x20for\x20shop\x20'+_0x241adc+':\x20'+_0x3ded33+'%'),_0x3ded33;}}return console[_0x319c97(0x1a7)](_0x319c97(0xfc)+_0x50b79a+'\x20in\x20shop\x20'+_0x241adc+',\x20using\x20default\x2010%'),0xa;}catch(_0x2f606b){return console['error'](_0x319c97(0x19d)+_0x241adc+_0x319c97(0x105)+_0x50b79a+':',_0x2f606b),0xa;}}}exports[a38_0x295807(0xd7)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();