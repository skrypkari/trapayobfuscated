'use strict';const a48_0x492dda=a48_0x2259;function a48_0x6a3f(){const _0x15561e=['\x20(after\x20','3336JYWUXK','\x20current\x20status:\x20','\x20status\x20is\x20','currentPayments','log',',\x20gateway\x20','catch','get','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20\x20\x20-\x20Status:\x20','\x20triggered\x20for\x20payment\x20','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','\x20\x20\x20üìç\x20Source:\x20','\x20payment\x20','\x20\x20\x20‚ùå\x20Error:\x20','‚è∞\x20[GLOBAL]\x20Found\x20','paid','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','\x20commission:\x20','getTime','description','transactionId','\x20has\x20no\x20gatewayPaymentId,\x20skipping','status_check','stack','payment.pending',',\x20currentPayments=','üìà\x20[COINTOPAY]\x20Payment\x20','entries','PAID','stringify','‚úÖ\x20[EXPIRY]\x20Payment\x20','schedulePaymentChecks','loggerService','webhookUrl','\x20\x20\x20üìù\x20Context:','5247AOcgOP','unknown','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','\x20completed\x20for\x20payment\x20','getDate','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','shop','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','13428sYopLH','\x20not\x20found\x20in\x20database','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','cointopay_status_check_error','schedule_created','Payment\x20older\x20than\x20','/status/','./gateways/coinToPayService','parse','‚úÖ\x20[HOURLY]\x20Payment\x20','\x20\x20\x20üìÖ\x20Time:\x20','5808705XvWIBz','‚è∞\x20[GLOBAL]\x20Payment\x20','ms)','timestamp','\x20status\x20changed\x20to\x20','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','paymentDetails','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20USDT','amount','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','message','\x20days,\x20marking\x20as\x20EXPIRED','coinToPayStatusService','stopPeriodicStatusCheck','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20\x20\x20Gateway\x20','remitterIban','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','üîç\x20[CHECK]\x20Checking\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','logCoinToPayError','createdAt','getPaymentTimerInfo','getGatewayCommission','\x20updated:\x20currentPayments=','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','logShopWebhookError','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','CoinToPayService','map','CoinToPayStatusService','\x20seconds\x20(','convertToUSDT','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','from',',\x20status=','type','\x20\x20\x20Amount\x20after\x20commission:\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...',',\x20using\x20default\x2010%','üõë\x20[SHUTDOWN]\x20Cleared\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','COINTOPAY_ERROR','\x20for\x20payment\x20','\x20not\x20found,\x20clearing\x20timers','4365XGuZjQ','\x20\x20\x20Amount:\x20','create','paymentLink','application/json','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','gateway','checkSinglePaymentById','logCoinToPayStatus','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','gatewayPaymentId','38212oDRJhk','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','checkExpiredPayments','created','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','gatewayOrderId','cointopay',':\x20type=','sendShopWebhook','webhook_send','üìä\x20[HOURLY]\x20Payment\x20','\x20marked\x20as\x20paid\x20at:\x20','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','COMPLETED','../types/gateway','\x20skipped,\x20','PENDING','\x20amounts\x20calculated:','values','currencyService','FAILED','confirmedOn','\x20status:\x20','status','Payment\x20not\x20found','\x20found:','not\x20found','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','EXPIRY_DAYS','EXPIRED','startPeriodicStatusCheck','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','1031890AaWtSV','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','toISOString','size','üßπ\x20[CHECK]\x20Payment\x20','currency','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','__esModule','logShopWebhookSent','checkPaymentStatus','Gateway\x20','\x20has\x20no\x20gatewayPaymentId','\x20to\x20clear','error','coinToPayService','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','gatewayCommissionRate','ü™ô\x20[DEBUG]\x20Creating\x20','üí∞\x20[CHECK]\x20Payment\x20','coinToPay2Service','findUnique','\x20not\x20enabled\x20for\x20shop\x20','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','webhookEvents','payment.failed','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20->\x20','./currencyService','delete','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','2247NsrTlR','Unknown\x20error','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','bankDetails','defineProperty','CoinToPay2Service','payment','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','‚úÖ\x20[CHECK]\x20Payment\x20','has','\x20\x20\x20üìù\x20Details:','clearPaymentTimers','\x20expired','\x20days','868oGRfqz','\x20with\x20status\x20','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','length','Webhook\x20event\x20','paymentLinkId','shopId','failed','\x20pending\x20CoinToPay\x20payments','logWhiteDomainError','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','commission','settings','‚ùå\x20[CHECK]\x20Payment\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','\x20individual\x20payment\x20timers','GLOBAL_CHECK_INTERVAL_MS','timers','checkAllPendingPayments','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','iban','Success','\x20is\x20too\x20new\x20(','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','findMany','customerEmail','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','2\x20minutes','toFixed','h),\x20skipping\x20global\x20check','\x20commission\x20for\x20shop\x20','push','\x20initial\x20timers\x20for\x20payment\x20','expired','checkSinglePayment','setDate','-day\x20timeout','\x20expired\x20CoinToPay\x20payments','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','orderId','gatewaySettings','webhookLog','paidAt','\x20checked,\x20','POST','update','sendPaymentNotification','amountUSDT','5\x20minutes','now','auto_expire','11mKtngM','\x20updated\x20successfully','\x20is\x20older\x20than\x20','globalCheckInterval','delay','\x20\x20\x20-\x20Amount:\x20','floor','paymentTimers','\x20timers\x20for\x20payment\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed',',\x20stopping\x20individual\x20checks','6065270XGBrBY','\x20details:','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','cointopay2','../config/database','COINTOPAY_STATUS_CHANGE','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','default','toLowerCase','sendPaymentStatusNotification','üìä\x20[CHECK]\x20Payment\x20','text','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','not\x20confirmed','\x20\x20\x20-\x20gatewayPaymentId:\x20'];a48_0x6a3f=function(){return _0x15561e;};return a48_0x6a3f();}function a48_0x2259(_0x594982,_0x2e00a9){_0x594982=_0x594982-0x8c;const _0x6a3fa6=a48_0x6a3f();let _0x225974=_0x6a3fa6[_0x594982];return _0x225974;}(function(_0x4aa8cc,_0x1e8c83){const _0x11467f=a48_0x2259,_0x4cabbe=_0x4aa8cc();while(!![]){try{const _0x43cee1=-parseInt(_0x11467f(0x12d))/0x1+parseInt(_0x11467f(0x14f))/0x2+parseInt(_0x11467f(0x120))/0x3*(-parseInt(_0x11467f(0x17b))/0x4)+parseInt(_0x11467f(0xf1))/0x5+parseInt(_0x11467f(0xe6))/0x6*(-parseInt(_0x11467f(0x16d))/0x7)+parseInt(_0x11467f(0xba))/0x8*(-parseInt(_0x11467f(0xde))/0x9)+-parseInt(_0x11467f(0xa9))/0xa*(-parseInt(_0x11467f(0x9e))/0xb);if(_0x43cee1===_0x1e8c83)break;else _0x4cabbe['push'](_0x4cabbe['shift']());}catch(_0x33847f){_0x4cabbe['push'](_0x4cabbe['shift']());}}}(a48_0x6a3f,0xec835));var __importDefault=this&&this['__importDefault']||function(_0x314668){return _0x314668&&_0x314668['__esModule']?_0x314668:{'default':_0x314668};};Object[a48_0x492dda(0x171)](exports,a48_0x492dda(0x156),{'value':!![]}),exports[a48_0x492dda(0xfe)]=exports[a48_0x492dda(0x110)]=void 0x0;const coinToPayService_1=require(a48_0x492dda(0xed)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a48_0x492dda(0x13d)),database_1=__importDefault(require(a48_0x492dda(0xae))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require('./loggerService'),currencyService_1=require(a48_0x492dda(0x16a));class CoinToPayStatusService{constructor(){const _0x3995b7=a48_0x492dda;this[_0x3995b7(0xa1)]=null,this[_0x3995b7(0x18b)]=0x3c*0x3c*0x3e8,this[_0x3995b7(0x14b)]=0x5,this['paymentTimers']=new Map(),this[_0x3995b7(0x15d)]=new coinToPayService_1[(_0x3995b7(0x10e))](),this['coinToPay2Service']=new coinToPay2Service_1[(_0x3995b7(0x172))](),console[_0x3995b7(0xbe)](_0x3995b7(0x17d));}[a48_0x492dda(0xda)](_0x55772f,_0x31424e){const _0x4d47ad=a48_0x492dda;console['log'](_0x4d47ad(0xf6)),console[_0x4d47ad(0xbe)]('\x20\x20\x20-\x20paymentId:\x20'+_0x55772f),console[_0x4d47ad(0xbe)](_0x4d47ad(0xb8)+_0x31424e),this[_0x4d47ad(0x178)](_0x55772f);const _0x2680b4=[],_0x1cbe4c=new Date(),_0x3c88da=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x4d47ad(0x196)},{'delay':0x5*0x3c*0x3e8,'description':_0x4d47ad(0x9b)},{'delay':0x5*0x3c*0x3e8,'description':_0x4d47ad(0x9b)}];console['log'](_0x4d47ad(0x160)+_0x3c88da[_0x4d47ad(0x17e)]+_0x4d47ad(0x19b)+_0x55772f);let _0x47ea26=0x0;_0x3c88da['forEach']((_0x565a58,_0x1c7305)=>{const _0x4a325c=_0x4d47ad;_0x47ea26+=_0x565a58[_0x4a325c(0xa2)];const _0x21549a=setTimeout(async()=>{const _0x3f327d=_0x4a325c;console[_0x3f327d(0xbe)]('ü™ô\x20[TIMER]\x20Individual\x20check\x20#'+(_0x1c7305+0x1)+_0x3f327d(0xc4)+_0x55772f+_0x3f327d(0xb9)+_0x565a58[_0x3f327d(0xce)]+')');try{await this[_0x3f327d(0x129)](_0x55772f),console[_0x3f327d(0xbe)](_0x3f327d(0x127)+(_0x1c7305+0x1)+_0x3f327d(0xe1)+_0x55772f);}catch(_0x36a404){console[_0x3f327d(0x15c)](_0x3f327d(0x12e)+(_0x1c7305+0x1)+'\x20for\x20payment\x20'+_0x55772f+':',_0x36a404),this[_0x3f327d(0x106)](_0x55772f,_0x31424e,_0x36a404,_0x3f327d(0xd1),{'checkNumber':_0x1c7305+0x1,'scheduledAfter':_0x565a58[_0x3f327d(0xce)],'isIndividualCheck':!![]});}},_0x47ea26);_0x2680b4[_0x4a325c(0x19a)](_0x21549a),console['log']('‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x1c7305+0x1)+_0x4a325c(0x11e)+_0x55772f+'\x20in\x20'+_0x47ea26/0x3e8+_0x4a325c(0x111)+_0x565a58[_0x4a325c(0xce)]+')');});const _0x2c96bc=setInterval(async()=>{const _0x5338fd=_0x4d47ad;console[_0x5338fd(0xbe)](_0x5338fd(0x174)+_0x55772f);try{const _0xaf6eb3=await database_1[_0x5338fd(0xb1)]['payment'][_0x5338fd(0x163)]({'where':{'id':_0x55772f},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0xaf6eb3){console['log']('‚ùå\x20[HOURLY]\x20Payment\x20'+_0x55772f+_0x5338fd(0x11f)),this['clearPaymentTimers'](_0x55772f);return;}console[_0x5338fd(0xbe)](_0x5338fd(0x139)+_0x55772f+_0x5338fd(0xbb)+_0xaf6eb3[_0x5338fd(0x146)]);if(_0xaf6eb3[_0x5338fd(0x146)]!=='PENDING'){console[_0x5338fd(0xbe)](_0x5338fd(0xef)+_0x55772f+_0x5338fd(0xbc)+_0xaf6eb3['status']+_0x5338fd(0xa8)),this[_0x5338fd(0x178)](_0x55772f);return;}const _0xa408aa=Math[_0x5338fd(0xa4)]((Date[_0x5338fd(0x9c)]()-_0xaf6eb3[_0x5338fd(0x107)][_0x5338fd(0xcd)]())/(0x3e8*0x3c*0x3c*0x18));if(_0xa408aa>=this[_0x5338fd(0x14b)]){console[_0x5338fd(0xbe)]('‚è∞\x20[HOURLY]\x20Payment\x20'+_0x55772f+_0x5338fd(0xa0)+this[_0x5338fd(0x14b)]+_0x5338fd(0xb0)),this[_0x5338fd(0x178)](_0x55772f);return;}await this[_0x5338fd(0x129)](_0x55772f),console[_0x5338fd(0xbe)](_0x5338fd(0xcb)+_0x55772f);}catch(_0xd69012){console[_0x5338fd(0x15c)](_0x5338fd(0x132)+_0x55772f+':',_0xd69012),this[_0x5338fd(0x106)](_0x55772f,_0x31424e,_0xd69012,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x2680b4[_0x4d47ad(0x19a)](_0x2c96bc),this['paymentTimers']['set'](_0x55772f,{'timers':_0x2680b4,'paymentId':_0x55772f,'gatewayPaymentId':_0x31424e,'createdAt':_0x1cbe4c}),console[_0x4d47ad(0xbe)](_0x4d47ad(0x91)+_0x3c88da[_0x4d47ad(0x17e)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x55772f),console[_0x4d47ad(0xbe)](_0x4d47ad(0xb6)+this['paymentTimers'][_0x4d47ad(0x152)]),this[_0x4d47ad(0x12a)](_0x55772f,_0x31424e,'PENDING',_0x4d47ad(0x13f),_0x4d47ad(0xd1),{'action':_0x4d47ad(0xea),'scheduledChecks':_0x3c88da[_0x4d47ad(0x17e)],'firstCheckIn':_0x3c88da[0x0][_0x4d47ad(0xa2)]/0x3e8,'totalTimers':this['paymentTimers']['size']});}[a48_0x492dda(0x178)](_0x1f5a3e){const _0x39ca99=a48_0x492dda,_0x687505=this[_0x39ca99(0xa5)][_0x39ca99(0xc1)](_0x1f5a3e);_0x687505?(console['log']('üßπ\x20[DEBUG]\x20Clearing\x20'+_0x687505[_0x39ca99(0x18c)][_0x39ca99(0x17e)]+_0x39ca99(0xa6)+_0x1f5a3e),_0x687505[_0x39ca99(0x18c)]['forEach']((_0x40aba5,_0x38da0d)=>{const _0x305f8a=_0x39ca99;_0x40aba5&&(clearTimeout(_0x40aba5),clearInterval(_0x40aba5),console[_0x305f8a(0xbe)](_0x305f8a(0x103)+(_0x38da0d+0x1)+_0x305f8a(0x11e)+_0x1f5a3e));}),this[_0x39ca99(0xa5)][_0x39ca99(0x16b)](_0x1f5a3e),console['log'](_0x39ca99(0xf8)+_0x1f5a3e+'.\x20Remaining\x20active\x20timers:\x20'+this['paymentTimers'][_0x39ca99(0x152)])):console[_0x39ca99(0xbe)](_0x39ca99(0x150)+_0x1f5a3e+_0x39ca99(0x15b));}async[a48_0x492dda(0x129)](_0x55e6ee){const _0x3db269=a48_0x492dda;console[_0x3db269(0xbe)](_0x3db269(0x195)+_0x55e6ee);const _0x117692=await database_1['default']['payment'][_0x3db269(0x163)]({'where':{'id':_0x55e6ee},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x117692){console[_0x3db269(0xbe)](_0x3db269(0x188)+_0x55e6ee+_0x3db269(0xe7));return;}console[_0x3db269(0xbe)](_0x3db269(0xb4)+_0x55e6ee+_0x3db269(0x148)),console[_0x3db269(0xbe)]('\x20\x20\x20-\x20Gateway:\x20'+_0x117692[_0x3db269(0x128)]),console[_0x3db269(0xbe)](_0x3db269(0xc3)+_0x117692[_0x3db269(0x146)]),console[_0x3db269(0xbe)](_0x3db269(0x118)+_0x117692[_0x3db269(0x12c)]),console['log'](_0x3db269(0xa3)+_0x117692['amount']+'\x20'+_0x117692[_0x3db269(0x154)]),console['log']('\x20\x20\x20-\x20ShopId:\x20'+_0x117692[_0x3db269(0x181)]);if(_0x117692[_0x3db269(0x128)]!==_0x3db269(0x135)&&_0x117692['gateway']!=='cointopay2'){console[_0x3db269(0xbe)](_0x3db269(0x16c)+_0x55e6ee+_0x3db269(0xab)+_0x117692[_0x3db269(0x128)]+')');return;}if(_0x117692[_0x3db269(0x146)]!==_0x3db269(0x13f)){console[_0x3db269(0xbe)](_0x3db269(0x16c)+_0x55e6ee+_0x3db269(0xbc)+_0x117692[_0x3db269(0x146)]+',\x20stopping\x20individual\x20checks'),this[_0x3db269(0x178)](_0x55e6ee);return;}if(!_0x117692[_0x3db269(0x12c)]){console[_0x3db269(0xbe)](_0x3db269(0x16c)+_0x55e6ee+_0x3db269(0x15a));return;}console['log'](_0x3db269(0x175)+_0x55e6ee+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this[_0x3db269(0x8d)](_0x117692);}['logCoinToPayStatus'](_0x1f3a82,_0x3975ec,_0xe2851a,_0x23a7c7,_0x1f01ea,_0x3794d7){const _0x416c83=a48_0x492dda,_0x1a817a={'type':_0x416c83(0xaf),'paymentId':_0x1f3a82,'gatewayPaymentId':_0x3975ec,'oldStatus':_0xe2851a,'newStatus':_0x23a7c7,'source':_0x1f01ea,'timestamp':new Date()[_0x416c83(0x151)](),'details':_0x3794d7||{}};loggerService_1[_0x416c83(0xdb)][_0x416c83(0x12a)](_0x1a817a),console['log'](_0x416c83(0xc5)+_0x1f3a82+'\x20('+_0x3975ec+')'),console[_0x416c83(0xbe)]('\x20\x20\x20üìä\x20Status:\x20'+_0xe2851a+_0x416c83(0x169)+_0x23a7c7),console['log'](_0x416c83(0xc6)+_0x1f01ea),console[_0x416c83(0xbe)](_0x416c83(0xf0)+_0x1a817a[_0x416c83(0xf4)]),_0x3794d7&&console[_0x416c83(0xbe)](_0x416c83(0x177),_0x3794d7);}[a48_0x492dda(0x106)](_0x4f6a54,_0x4f6c7a,_0xcac1d7,_0x28a95d,_0x331e12){const _0x31f6d3=a48_0x492dda,_0x5ce605={'type':_0x31f6d3(0x11d),'paymentId':_0x4f6a54,'gatewayPaymentId':_0x4f6c7a,'error':_0xcac1d7 instanceof Error?{'message':_0xcac1d7[_0x31f6d3(0xfc)],'stack':_0xcac1d7[_0x31f6d3(0xd2)]}:_0xcac1d7,'source':_0x28a95d,'timestamp':new Date()[_0x31f6d3(0x151)](),'context':_0x331e12||{}};loggerService_1[_0x31f6d3(0xdb)][_0x31f6d3(0x106)](_0x5ce605),console[_0x31f6d3(0x15c)](_0x31f6d3(0x155)+_0x4f6a54+'\x20('+_0x4f6c7a+')'),console[_0x31f6d3(0x15c)](_0x31f6d3(0xc8)+(_0xcac1d7 instanceof Error?_0xcac1d7[_0x31f6d3(0xfc)]:_0xcac1d7)),console['error']('\x20\x20\x20üìç\x20Source:\x20'+_0x28a95d),console['error'](_0x31f6d3(0xf0)+_0x5ce605[_0x31f6d3(0xf4)]),_0x331e12&&console[_0x31f6d3(0x15c)](_0x31f6d3(0xdd),_0x331e12);}[a48_0x492dda(0x14d)](){const _0x3dffc0=a48_0x492dda;console[_0x3dffc0(0xbe)](_0x3dffc0(0xac)),this[_0x3dffc0(0x18d)]()[_0x3dffc0(0xc0)](_0x4a6980=>{const _0x5ac640=_0x3dffc0;console[_0x5ac640(0x15c)](_0x5ac640(0x185),_0x4a6980);}),this['globalCheckInterval']=setInterval(async()=>{const _0x6885ea=_0x3dffc0;try{console[_0x6885ea(0xbe)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x6885ea(0x18d)](),console[_0x6885ea(0xbe)](_0x6885ea(0xa7));}catch(_0x195125){console[_0x6885ea(0x15c)](_0x6885ea(0x10d),_0x195125);}},this[_0x3dffc0(0x18b)]),console[_0x3dffc0(0xbe)](_0x3dffc0(0x13b));}[a48_0x492dda(0xff)](){const _0x381afd=a48_0x492dda;console[_0x381afd(0xbe)](_0x381afd(0x105));this[_0x381afd(0xa1)]&&(clearInterval(this[_0x381afd(0xa1)]),this[_0x381afd(0xa1)]=null,console[_0x381afd(0xbe)]('üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x5baa3d=this['paymentTimers'][_0x381afd(0x152)];for(const [_0xfd74e6]of this['paymentTimers']){this['clearPaymentTimers'](_0xfd74e6);}console[_0x381afd(0xbe)](_0x381afd(0x11b)+_0x5baa3d+_0x381afd(0x18a));}async['checkAllPendingPayments'](){const _0x23b456=a48_0x492dda;try{console['log'](_0x23b456(0x119));const _0x11cdbd=await database_1[_0x23b456(0xb1)][_0x23b456(0x173)][_0x23b456(0x193)]({'where':{'gateway':{'in':[_0x23b456(0x135),_0x23b456(0xad)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x23b456(0xbe)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x11cdbd['length']+_0x23b456(0x183));if(_0x11cdbd['length']===0x0){console[_0x23b456(0xbe)]('ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x2dea19=await this['checkExpiredPayments'](_0x11cdbd);console[_0x23b456(0xbe)](_0x23b456(0xc9)+_0x2dea19[_0x23b456(0x17e)]+_0x23b456(0x90));let _0x3f9c41=0x0,_0x1b45a7=0x0;for(const _0x349091 of _0x11cdbd){try{if(_0x2dea19['includes'](_0x349091['id'])){console[_0x23b456(0xbe)](_0x23b456(0xf2)+_0x349091['id']+_0x23b456(0xe0)),_0x1b45a7++;continue;}if(this[_0x23b456(0xa5)][_0x23b456(0x176)](_0x349091['id'])){console['log'](_0x23b456(0xf2)+_0x349091['id']+_0x23b456(0x165)),_0x1b45a7++;continue;}const _0x11f2d4=(Date[_0x23b456(0x9c)]()-_0x349091[_0x23b456(0x107)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x11f2d4<0x1){console[_0x23b456(0xbe)](_0x23b456(0xf2)+_0x349091['id']+_0x23b456(0x191)+_0x11f2d4[_0x23b456(0x197)](0x1)+_0x23b456(0x198)),_0x1b45a7++;continue;}console['log'](_0x23b456(0x18e)+_0x349091['id']+'\x20(age:\x20'+_0x11f2d4['toFixed'](0x1)+'h)'),await this[_0x23b456(0x8d)](_0x349091),_0x3f9c41++,await new Promise(_0x419db6=>setTimeout(_0x419db6,0x7d0));}catch(_0x240624){console[_0x23b456(0x15c)](_0x23b456(0xfb)+_0x349091['id']+':',_0x240624),this[_0x23b456(0x106)](_0x349091['id'],_0x349091['gatewayPaymentId']||'unknown',_0x240624,_0x23b456(0xd1),{'isGlobalCheck':!![],'paymentAmount':_0x349091[_0x23b456(0xfa)],'paymentCurrency':_0x349091[_0x23b456(0x154)],'shopId':_0x349091[_0x23b456(0x181)],'createdAt':_0x349091[_0x23b456(0x107)]}),loggerService_1[_0x23b456(0xdb)][_0x23b456(0x184)]('cointopay',_0x23b456(0xec)+_0x349091[_0x23b456(0x12c)],_0x240624);}}console[_0x23b456(0xbe)](_0x23b456(0xe8)+_0x3f9c41+_0x23b456(0x96)+_0x1b45a7+_0x23b456(0x13e)+_0x2dea19[_0x23b456(0x17e)]+_0x23b456(0x179));}catch(_0x2bec2e){console['error']('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x2bec2e);}}async[a48_0x492dda(0x130)](_0x2ae60f){const _0x24270a=a48_0x492dda,_0x5ded2f=[],_0x55cf7b=new Date();_0x55cf7b[_0x24270a(0x8e)](_0x55cf7b[_0x24270a(0xe2)]()-this[_0x24270a(0x14b)]),console[_0x24270a(0xbe)](_0x24270a(0xc2)+this[_0x24270a(0x14b)]+'\x20days\x20(created\x20before\x20'+_0x55cf7b[_0x24270a(0x151)]()+')');for(const _0x410476 of _0x2ae60f){if(_0x410476[_0x24270a(0x107)]<_0x55cf7b){console[_0x24270a(0xbe)](_0x24270a(0x11c)+_0x410476['id']+_0x24270a(0xa0)+this[_0x24270a(0x14b)]+_0x24270a(0xfd));try{this[_0x24270a(0x12a)](_0x410476['id'],_0x410476[_0x24270a(0x12c)]||_0x24270a(0xdf),_0x24270a(0x13f),_0x24270a(0x14c),_0x24270a(0x9d),{'reason':_0x24270a(0xeb)+this[_0x24270a(0x14b)]+_0x24270a(0x17a),'createdAt':_0x410476[_0x24270a(0x107)],'daysSinceCreation':Math[_0x24270a(0xa4)]((Date[_0x24270a(0x9c)]()-_0x410476['createdAt'][_0x24270a(0xcd)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x410476[_0x24270a(0xfa)],'paymentCurrency':_0x410476['currency'],'shopId':_0x410476[_0x24270a(0x181)]}),await database_1[_0x24270a(0xb1)][_0x24270a(0x173)]['update']({'where':{'id':_0x410476['id']},'data':{'status':_0x24270a(0x14c),'updatedAt':new Date()}}),await database_1[_0x24270a(0xb1)][_0x24270a(0x94)][_0x24270a(0x122)]({'data':{'paymentId':_0x410476['id'],'shopId':_0x410476[_0x24270a(0x181)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x24270a(0xd8)]({'reason':'Payment\x20older\x20than\x20'+this[_0x24270a(0x14b)]+_0x24270a(0x17a),'createdAt':_0x410476[_0x24270a(0x107)],'expiredAt':new Date()[_0x24270a(0x151)](),'daysSinceCreation':Math[_0x24270a(0xa4)]((Date[_0x24270a(0x9c)]()-_0x410476[_0x24270a(0x107)][_0x24270a(0xcd)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x410476,_0x24270a(0x14c)),await this[_0x24270a(0xb3)](_0x410476,_0x24270a(0x14c)),this['clearPaymentTimers'](_0x410476['id']),_0x5ded2f[_0x24270a(0x19a)](_0x410476['id']),console[_0x24270a(0xbe)](_0x24270a(0xd9)+_0x410476['id']+_0x24270a(0x192)+this[_0x24270a(0x14b)]+_0x24270a(0x8f));}catch(_0x5953cd){console['error'](_0x24270a(0x168)+_0x410476['id']+':',_0x5953cd),this[_0x24270a(0x106)](_0x410476['id'],_0x410476[_0x24270a(0x12c)]||_0x24270a(0xdf),_0x5953cd,_0x24270a(0x9d),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x410476['createdAt'],'daysSinceCreation':Math['floor']((Date['now']()-_0x410476[_0x24270a(0x107)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x5ded2f;}async['checkSinglePayment'](_0x3102f4){const _0x473215=a48_0x492dda;if(!_0x3102f4['gatewayPaymentId']){console[_0x473215(0xbe)](_0x473215(0x16c)+_0x3102f4['id']+_0x473215(0xd0));return;}console[_0x473215(0xbe)](_0x473215(0x104)+_0x3102f4['gateway']+_0x473215(0xc7)+_0x3102f4['id']+'\x20('+_0x3102f4[_0x473215(0x12c)]+')');try{let _0x52f087;_0x3102f4[_0x473215(0x128)]==='cointopay2'?(_0x52f087=await this[_0x473215(0x162)][_0x473215(0x158)](_0x3102f4[_0x473215(0x12c)]),console['log'](_0x473215(0x15e)+_0x3102f4['id']+_0x473215(0x145)+_0x52f087[_0x473215(0x146)])):(_0x52f087=await this[_0x473215(0x15d)]['checkPaymentStatus'](_0x3102f4['gatewayPaymentId']),console[_0x473215(0xbe)](_0x473215(0x12f)+_0x3102f4['id']+'\x20status:\x20'+_0x52f087[_0x473215(0x146)]));_0x52f087[_0x473215(0xf7)]&&console[_0x473215(0xbe)](_0x473215(0xb4)+_0x3102f4['id']+_0x473215(0xaa),{'iban':_0x52f087[_0x473215(0xf7)][_0x473215(0x18f)]||_0x473215(0x149),'transactionId':_0x52f087[_0x473215(0xf7)]['transactionId'],'createdOn':_0x52f087[_0x473215(0xf7)]['createdOn'],'confirmedOn':_0x52f087['paymentDetails'][_0x473215(0x144)]||_0x473215(0xb7)});if(_0x52f087[_0x473215(0x146)]!==_0x3102f4[_0x473215(0x146)]){console[_0x473215(0xbe)](_0x473215(0x14a)+_0x3102f4['id']+'\x20status\x20from\x20'+_0x3102f4[_0x473215(0x146)]+'\x20to\x20'+_0x52f087[_0x473215(0x146)]),this[_0x473215(0x12a)](_0x3102f4['id'],_0x3102f4[_0x473215(0x12c)],_0x3102f4['status'],_0x52f087[_0x473215(0x146)],'status_check',{'paymentDetails':_0x52f087[_0x473215(0xf7)],'amount':_0x52f087[_0x473215(0xfa)],'currency':_0x52f087[_0x473215(0x154)],'shopId':_0x3102f4[_0x473215(0x181)],'checkTimestamp':new Date()[_0x473215(0x151)]()});const _0x3f3f5a={'status':_0x52f087[_0x473215(0x146)],'updatedAt':new Date()};if(_0x52f087['status']===_0x473215(0xd7)&&_0x3102f4[_0x473215(0x146)]!==_0x473215(0xd7)){_0x3f3f5a[_0x473215(0x95)]=new Date();if(!_0x3102f4[_0x473215(0x9a)]){const _0x535990=await currencyService_1[_0x473215(0x142)][_0x473215(0x112)](_0x3102f4[_0x473215(0xfa)],_0x3102f4[_0x473215(0x154)]);_0x3f3f5a['amountUSDT']=_0x535990;const _0x3a177d=await this['getGatewayCommission'](_0x3102f4[_0x473215(0x181)],_0x3102f4[_0x473215(0x128)]),_0x2684b6=_0x535990*(0x1-_0x3a177d/0x64);_0x3f3f5a['amountAfterGatewayCommissionUSDT']=_0x2684b6,_0x3f3f5a[_0x473215(0x15f)]=_0x3a177d,console['log'](_0x473215(0x161)+_0x3102f4['id']+_0x473215(0x140)),console[_0x473215(0xbe)](_0x473215(0x121)+_0x3102f4[_0x473215(0xfa)]+'\x20'+_0x3102f4[_0x473215(0x154)]+'\x20->\x20'+_0x535990['toFixed'](0x6)+'\x20USDT'),console[_0x473215(0xbe)](_0x473215(0x101)+_0x3102f4[_0x473215(0x128)]+_0x473215(0xcc)+_0x3a177d+'%'),console['log'](_0x473215(0x117)+_0x2684b6['toFixed'](0x6)+_0x473215(0xf9));}console[_0x473215(0xbe)](_0x473215(0x161)+_0x3102f4['id']+_0x473215(0x13a)+_0x3f3f5a[_0x473215(0x95)][_0x473215(0x151)]());}if(_0x52f087[_0x473215(0xf7)]){const _0x2a611c=_0x52f087[_0x473215(0xf7)];_0x2a611c[_0x473215(0x18f)]&&(_0x3f3f5a[_0x473215(0x102)]=_0x2a611c[_0x473215(0x18f)],console[_0x473215(0xbe)](_0x473215(0xe5)+_0x2a611c[_0x473215(0x18f)])),_0x2a611c[_0x473215(0x170)]&&console[_0x473215(0xbe)](_0x473215(0x113)+_0x2a611c[_0x473215(0x170)]),_0x2a611c['transactionId']&&console['log'](_0x473215(0x12b)+_0x2a611c[_0x473215(0xcf)]),_0x2a611c[_0x473215(0x144)]&&console['log']('‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x2a611c[_0x473215(0x144)]);}await database_1[_0x473215(0xb1)][_0x473215(0x173)]['update']({'where':{'id':_0x3102f4['id']},'data':_0x3f3f5a});if(_0x52f087['status']==='PAID'&&_0x3102f4[_0x473215(0x146)]!==_0x473215(0xd7)){console[_0x473215(0xbe)](_0x473215(0xd5)+_0x3102f4['id']+_0x473215(0x14e));const _0x16b167=await database_1[_0x473215(0xb1)][_0x473215(0x173)][_0x473215(0x163)]({'where':{'id':_0x3102f4['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x16b167?.[_0x473215(0x180)]&&_0x16b167[_0x473215(0x123)])try{const _0x3bb238=_0x16b167[_0x473215(0x123)];console[_0x473215(0xbe)](_0x473215(0x125)+_0x3bb238['id']+_0x473215(0x136)+_0x3bb238[_0x473215(0x116)]+_0x473215(0xd4)+_0x3bb238[_0x473215(0xbd)]+_0x473215(0x115)+_0x3bb238[_0x473215(0x146)]);const _0x59af00=_0x3bb238['currentPayments']+0x1,_0x5caee9=_0x3bb238[_0x473215(0x116)]==='SINGLE'?_0x473215(0x13c):_0x3bb238['status'];await database_1[_0x473215(0xb1)]['paymentLink'][_0x473215(0x98)]({'where':{'id':_0x3bb238['id']},'data':{'currentPayments':_0x59af00,'status':_0x5caee9,'updatedAt':new Date()}}),console[_0x473215(0xbe)](_0x473215(0x133)+_0x3bb238['id']+_0x473215(0x10a)+_0x3bb238['currentPayments']+'\x20->\x20'+_0x59af00+',\x20status='+_0x3bb238['status']+_0x473215(0x169)+_0x5caee9);}catch(_0x57de13){console['error'](_0x473215(0x189),_0x57de13);}else console[_0x473215(0xbe)](_0x473215(0xd5)+_0x3102f4['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x473215(0xb1)]['webhookLog']['create']({'data':{'paymentId':_0x3102f4['id'],'shopId':_0x3102f4[_0x473215(0x181)],'event':'cointopay_status_check_'+_0x52f087[_0x473215(0x146)][_0x473215(0xb2)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x3102f4[_0x473215(0x146)],'newStatus':_0x52f087[_0x473215(0x146)],'paymentDetails':_0x52f087[_0x473215(0xf7)],'checkedAt':new Date()[_0x473215(0x151)]()})}}),await this['sendShopWebhook'](_0x3102f4,_0x52f087[_0x473215(0x146)]),await this[_0x473215(0xb3)](_0x3102f4,_0x52f087[_0x473215(0x146)]),_0x52f087[_0x473215(0x146)]!==_0x473215(0x13f)&&(console['log'](_0x473215(0x153)+_0x3102f4['id']+_0x473215(0xf5)+_0x52f087[_0x473215(0x146)]+',\x20clearing\x20individual\x20timers'),this[_0x473215(0x178)](_0x3102f4['id'])),console[_0x473215(0xbe)](_0x473215(0x175)+_0x3102f4['id']+_0x473215(0x9f));}else console['log']('üìä\x20[CHECK]\x20Payment\x20'+_0x3102f4['id']+'\x20status\x20unchanged\x20('+_0x52f087[_0x473215(0x146)]+')'),this['logCoinToPayStatus'](_0x3102f4['id'],_0x3102f4[_0x473215(0x12c)],_0x3102f4[_0x473215(0x146)],_0x52f087[_0x473215(0x146)],_0x473215(0xd1),{'statusUnchanged':!![],'paymentDetails':_0x52f087['paymentDetails'],'amount':_0x52f087[_0x473215(0xfa)],'currency':_0x52f087[_0x473215(0x154)],'shopId':_0x3102f4[_0x473215(0x181)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x59bb3c){console[_0x473215(0x15c)]('‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x3102f4['id']+':',_0x59bb3c),this[_0x473215(0x106)](_0x3102f4['id'],_0x3102f4[_0x473215(0x12c)],_0x59bb3c,_0x473215(0xd1),{'paymentAmount':_0x3102f4[_0x473215(0xfa)],'paymentCurrency':_0x3102f4[_0x473215(0x154)],'shopId':_0x3102f4[_0x473215(0x181)],'createdAt':_0x3102f4[_0x473215(0x107)]}),await database_1[_0x473215(0xb1)]['webhookLog'][_0x473215(0x122)]({'data':{'paymentId':_0x3102f4['id'],'shopId':_0x3102f4[_0x473215(0x181)],'event':_0x473215(0xe9),'statusCode':0x1f4,'responseBody':JSON[_0x473215(0xd8)]({'error':_0x59bb3c instanceof Error?_0x59bb3c[_0x473215(0xfc)]:_0x473215(0x16e),'gatewayPaymentId':_0x3102f4[_0x473215(0x12c)],'checkedAt':new Date()['toISOString']()})}});}}async[a48_0x492dda(0x137)](_0x379ed9,_0x5b2b30){const _0x2c2c2a=a48_0x492dda,_0x303f4e=Date[_0x2c2c2a(0x9c)]();try{const _0x3e482d=_0x379ed9[_0x2c2c2a(0xe4)],_0x13afeb=_0x3e482d['settings'];if(!_0x13afeb?.['webhookUrl']){console[_0x2c2c2a(0xbe)](_0x2c2c2a(0x16f)+_0x3e482d['id']);return;}const _0x2d2091=_0x5b2b30===_0x2c2c2a(0xd7)?'payment.success':_0x5b2b30===_0x2c2c2a(0x143)?_0x2c2c2a(0x167):_0x5b2b30===_0x2c2c2a(0x14c)?'payment.failed':_0x2c2c2a(0xd3);if(!_0x13afeb[_0x2c2c2a(0x166)]?.['includes'](_0x2d2091)){console['log'](_0x2c2c2a(0x17f)+_0x2d2091+_0x2c2c2a(0x164)+_0x3e482d['id']);return;}const _0x36eea8=(0x0,gateway_1['getGatewayIdByName'])(_0x379ed9['gateway'])||_0x379ed9[_0x2c2c2a(0x128)],_0x21a0e3={'event':_0x2d2091,'payment':{'id':_0x379ed9['id'],'order_id':_0x379ed9[_0x2c2c2a(0x92)],'gateway_order_id':_0x379ed9[_0x2c2c2a(0x134)],'gateway':_0x36eea8,'amount':_0x379ed9['amount'],'currency':_0x379ed9['currency'],'status':_0x5b2b30[_0x2c2c2a(0xb2)](),'customer_email':_0x379ed9[_0x2c2c2a(0x194)],'customer_name':_0x379ed9['customerName'],'created_at':_0x379ed9[_0x2c2c2a(0x107)],'updated_at':new Date()}},_0x411d1c=await fetch(_0x13afeb[_0x2c2c2a(0xdc)],{'method':_0x2c2c2a(0x97),'headers':{'Content-Type':_0x2c2c2a(0x124),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x2c2c2a(0xd8)](_0x21a0e3)}),_0x2190db=Date[_0x2c2c2a(0x9c)]()-_0x303f4e,_0xd330c1=_0x411d1c['ok']?_0x2c2c2a(0x190):await _0x411d1c[_0x2c2c2a(0xb5)]();loggerService_1[_0x2c2c2a(0xdb)][_0x2c2c2a(0x157)](_0x379ed9[_0x2c2c2a(0x181)],_0x13afeb[_0x2c2c2a(0xdc)],_0x2d2091,_0x411d1c[_0x2c2c2a(0x146)],_0x2190db,_0x21a0e3),console[_0x2c2c2a(0xbe)]('Shop\x20webhook\x20sent\x20to\x20'+_0x13afeb[_0x2c2c2a(0xdc)]+_0x2c2c2a(0x17c)+_0x411d1c[_0x2c2c2a(0x146)]+'\x20('+_0x2190db+_0x2c2c2a(0xf3));}catch(_0x45a731){console[_0x2c2c2a(0x15c)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x45a731),loggerService_1[_0x2c2c2a(0xdb)][_0x2c2c2a(0x10c)](_0x379ed9[_0x2c2c2a(0x181)],_0x379ed9[_0x2c2c2a(0xe4)]?.[_0x2c2c2a(0x187)]?.[_0x2c2c2a(0xdc)]||_0x2c2c2a(0xdf),_0x2c2c2a(0x138),_0x45a731,{});}}async['sendPaymentStatusNotification'](_0x4d6910,_0x126208){const _0x481a7e=a48_0x492dda;try{const _0x66f23b={'PENDING':_0x481a7e(0x131),'PAID':_0x481a7e(0xca),'FAILED':_0x481a7e(0x182),'EXPIRED':_0x481a7e(0x8c)},_0x1c5161=_0x66f23b[_0x126208];if(!_0x1c5161||_0x1c5161===_0x481a7e(0x131))return;await telegramBotService_1['telegramBotService'][_0x481a7e(0x99)](_0x4d6910['shopId'],_0x4d6910,_0x1c5161);}catch(_0x3a0c53){console[_0x481a7e(0x15c)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x3a0c53);}}async['checkPaymentById'](_0x1f6569){const _0x4420b2=a48_0x492dda;console['log'](_0x4420b2(0x10b)+_0x1f6569);const _0x133b90=await database_1['default'][_0x4420b2(0x173)]['findUnique']({'where':{'id':_0x1f6569},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x133b90)throw new Error(_0x4420b2(0x147));if(_0x133b90['gateway']!==_0x4420b2(0x135)&&_0x133b90['gateway']!==_0x4420b2(0xad))throw new Error(_0x4420b2(0x126));console[_0x4420b2(0xbe)]('‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x133b90[_0x4420b2(0x128)]+'\x20payment\x20'+_0x1f6569),await this[_0x4420b2(0x8d)](_0x133b90),console[_0x4420b2(0xbe)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x1f6569);}['getServiceStats'](){const _0x505b26=a48_0x492dda,_0x43f30e=this[_0x505b26(0xa1)]?this[_0x505b26(0x18b)]:undefined,_0x2ea618=Array[_0x505b26(0x114)](this[_0x505b26(0xa5)][_0x505b26(0x141)]())[_0x505b26(0x10f)](_0x5f2fe6=>({'paymentId':_0x5f2fe6['paymentId'],'gatewayPaymentId':_0x5f2fe6[_0x505b26(0x12c)],'createdAt':_0x5f2fe6[_0x505b26(0x107)],'timersCount':_0x5f2fe6[_0x505b26(0x18c)][_0x505b26(0x17e)]}));return{'isActive':!!this[_0x505b26(0xa1)],'globalCheckIntervalMinutes':this[_0x505b26(0x18b)]/(0x3e8*0x3c),'expiryDays':this[_0x505b26(0x14b)],'activeIndividualTimers':this[_0x505b26(0xa5)]['size'],'nextGlobalCheckIn':_0x43f30e,'paymentTimersDetails':_0x2ea618};}[a48_0x492dda(0x108)](_0x2ebc31){const _0xf0fdb=a48_0x492dda,_0x5147b9=this[_0xf0fdb(0xa5)]['get'](_0x2ebc31);if(_0x5147b9)return{'hasTimers':!![],'timersCount':_0x5147b9['timers'][_0xf0fdb(0x17e)],'createdAt':_0x5147b9[_0xf0fdb(0x107)],'gatewayPaymentId':_0x5147b9[_0xf0fdb(0x12c)]};return{'hasTimers':![]};}async[a48_0x492dda(0x109)](_0x469f82,_0x270949){const _0x58736e=a48_0x492dda;try{const _0x20a28f=await database_1[_0x58736e(0xb1)][_0x58736e(0xe4)][_0x58736e(0x163)]({'where':{'id':_0x469f82},'select':{'gatewaySettings':!![]}});if(!_0x20a28f?.[_0x58736e(0x93)])return console[_0x58736e(0xbe)]('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0x469f82+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x166326=JSON[_0x58736e(0xee)](_0x20a28f[_0x58736e(0x93)]);for(const [_0x28a307,_0x22cf6c]of Object[_0x58736e(0xd6)](_0x166326)){if(_0x28a307['toLowerCase']()===_0x270949[_0x58736e(0xb2)]()){const _0x129fed=_0x22cf6c[_0x58736e(0x186)]||0xa;return console[_0x58736e(0xbe)](_0x58736e(0x159)+_0x270949+_0x58736e(0x199)+_0x469f82+':\x20'+_0x129fed+'%'),_0x129fed;}}return console[_0x58736e(0xbe)](_0x58736e(0xe3)+_0x270949+'\x20in\x20shop\x20'+_0x469f82+_0x58736e(0x11a)),0xa;}catch(_0x1c4503){return console[_0x58736e(0x15c)](_0x58736e(0x100)+_0x469f82+_0x58736e(0xbf)+_0x270949+':',_0x1c4503),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a48_0x492dda(0xfe)]=new CoinToPayStatusService();