'use strict';const a40_0x34995c=a40_0xc265;(function(_0x586f3f,_0x57be23){const _0x1ae8e0=a40_0xc265,_0x13c31a=_0x586f3f();while(!![]){try{const _0x5e7ecb=parseInt(_0x1ae8e0(0x194))/0x1+parseInt(_0x1ae8e0(0x141))/0x2+-parseInt(_0x1ae8e0(0x187))/0x3*(parseInt(_0x1ae8e0(0x1e2))/0x4)+parseInt(_0x1ae8e0(0x1c2))/0x5*(parseInt(_0x1ae8e0(0x151))/0x6)+parseInt(_0x1ae8e0(0x1f4))/0x7+-parseInt(_0x1ae8e0(0x14e))/0x8+-parseInt(_0x1ae8e0(0x1f2))/0x9;if(_0x5e7ecb===_0x57be23)break;else _0x13c31a['push'](_0x13c31a['shift']());}catch(_0x594b87){_0x13c31a['push'](_0x13c31a['shift']());}}}(a40_0x2c2f,0x388d0));function a40_0xc265(_0xd7abab,_0x2a7ddc){const _0x2c2fcd=a40_0x2c2f();return a40_0xc265=function(_0xc2657b,_0x128b65){_0xc2657b=_0xc2657b-0x10c;let _0x3e2d80=_0x2c2fcd[_0xc2657b];return _0x3e2d80;},a40_0xc265(_0xd7abab,_0x2a7ddc);}var __importDefault=this&&this[a40_0x34995c(0x161)]||function(_0x41b6e2){const _0x371681=a40_0x34995c;return _0x41b6e2&&_0x41b6e2[_0x371681(0x1b6)]?_0x41b6e2:{'default':_0x41b6e2};};function a40_0x2c2f(){const _0x205c73=['cointopay2','\x20details:','\x20days,\x20marking\x20as\x20EXPIRED','type','getGatewayIdByName','\x20updated\x20successfully','\x20\x20\x20üìÖ\x20Time:\x20','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','unknown','\x20status:\x20','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','findMany','status_check','\x20timers\x20for\x20payment\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20initial\x20timers\x20for\x20payment\x20','currentPayments','CoinToPayService','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','gatewaySettings','PAID','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20\x20\x20üìù\x20Context:','\x20in\x20','./loggerService','gatewayCommissionRate','customerName','Payment\x20not\x20found','__esModule','\x20\x20\x20Gateway\x20','getDate','toISOString','./currencyService','\x20not\x20found,\x20clearing\x20timers','bankDetails','schedulePaymentChecks','‚è∞\x20[GLOBAL]\x20Payment\x20','\x20is\x20older\x20than\x20','convertToUSDT','checkSinglePayment','2097955WRShUN','\x20\x20\x20-\x20Gateway:\x20','\x20not\x20found\x20in\x20database','\x20commission:\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','shopId','amountAfterGatewayCommissionUSDT','\x20payment\x20','amountUSDT','paidAt','description','\x20in\x20shop\x20','not\x20confirmed','globalCheckInterval','EXPIRED','cointopay_status_check_','currencyService','TesSoft\x20Payment\x20System/1.0','‚úÖ\x20[HOURLY]\x20Payment\x20','push','gateway',',\x20clearing\x20individual\x20timers','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','toLowerCase',',\x20using\x20default\x20commission\x2010%','üßπ\x20[DEBUG]\x20Clearing\x20','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20skipped,\x20','loggerService','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','update','4ukfZZo','CoinToPayStatusService','getServiceStats','\x20found:','5\x20minutes','sendShopWebhook','/status/','setDate','üí∞\x20[CHECK]\x20Payment\x20','confirmedOn','settings','cointopay_auto_expired','\x20completed\x20for\x20payment\x20','\x20\x20\x20Amount\x20after\x20commission:\x20','logCoinToPayError','\x20is\x20valid\x20for\x20checking,\x20proceeding...','895518JrqQWM','\x20USDT','286510UPhHJV','\x20\x20\x20-\x20ShopId:\x20','createdAt','paid','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','sendPaymentStatusNotification','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','./gateways/coinToPay2Service','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','text','\x20for\x20payment\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','COMPLETED','webhookUrl','üìà\x20[COINTOPAY]\x20Payment\x20',',\x20status=','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','getGatewayCommission','‚è∞\x20[HOURLY]\x20Payment\x20','status','findUnique','FAILED','catch','\x20current\x20status:\x20','default','gatewayPaymentId','customerEmail','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','Gateway\x20','\x20\x20\x20-\x20Amount:\x20','üîç\x20[CHECK]\x20Checking\x20','create','\x20\x20\x20Amount:\x20','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','üìä\x20[CHECK]\x20Payment\x20','webhook_send','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','parse','CoinToPay2Service','checkAllPendingPayments','‚è∞\x20[GLOBAL]\x20Found\x20','\x20amounts\x20calculated:','currency','\x20triggered\x20for\x20payment\x20','transactionId','entries','telegramBotService','Success','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','coinToPay2Service','EXPIRY_DAYS','cointopay_status_check_error','\x20has\x20no\x20gatewayPaymentId,\x20skipping','includes','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','ü™ô\x20[DEBUG]\x20Creating\x20','\x20updated:\x20currentPayments=','\x20days','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','stringify',',\x20stopping\x20individual\x20checks','startPeriodicStatusCheck','\x20\x20\x20üìç\x20Source:\x20','Webhook\x20event\x20','COINTOPAY_ERROR','üßπ\x20[CHECK]\x20Payment\x20','Failed\x20to\x20send\x20shop\x20webhook:','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','ms)','.\x20Remaining\x20active\x20timers:\x20','\x20marked\x20as\x20paid\x20at:\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','Unknown\x20error','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','\x20to\x20','./gateways/coinToPayService','\x20\x20\x20‚ùå\x20Error:\x20','length','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','from','logShopWebhookSent','\x20to\x20clear','logWhiteDomainError','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','../types/gateway','\x20\x20\x20üìä\x20Status:\x20','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','application/json','webhookLog','timestamp','sendPaymentNotification','timers','h),\x20skipping\x20global\x20check','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20->\x20','floor','1\x20minute','paymentDetails','GLOBAL_CHECK_INTERVAL_MS','128170aylZID','shop','payment','‚úÖ\x20[CHECK]\x20Payment\x20','has','gatewayOrderId','./telegramBotService','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','cointopay','COINTOPAY_STATUS_CHANGE','failed','ü™ô\x20[GLOBAL]\x20Found\x20',':\x20type=','2255248MUBzQM','payment.failed','get','6aftPjg','‚ùå\x20[CHECK]\x20Payment\x20','toFixed','coinToPayStatusService','stack','forEach','\x20status\x20is\x20','auto_expire','PENDING','iban','getTime','size','paymentLinkId','amount','adminNotes','\x20\x20\x20üìù\x20Details:','__importDefault','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','Shop\x20webhook\x20sent\x20to\x20','coinToPayService','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','\x20expired','message','defineProperty','\x20individual\x20payment\x20timers','checkSinglePaymentById','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20\x20\x20-\x20Status:\x20','checkPaymentById','\x20commission\x20for\x20shop\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','Payment\x20older\x20than\x20','paymentLink','\x20not\x20enabled\x20for\x20shop\x20','clearPaymentTimers','error','now','‚úÖ\x20[EXPIRY]\x20Payment\x20','\x20status\x20from\x20','getPaymentTimerInfo','Automatically\x20expired\x20after\x20','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','üìä\x20[HOURLY]\x20Payment\x20','delay','\x20(after\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','log','logShopWebhookError','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','POST','created','checkPaymentStatus','910443OdnxiA',',\x20using\x20default\x2010%','map','schedule_created','logCoinToPayStatus','payment.pending','\x20is\x20too\x20new\x20(','paymentTimers','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','checkExpiredPayments','createdOn','not\x20found','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','391915tsQJrN','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20(age:\x20'];a40_0x2c2f=function(){return _0x205c73;};return a40_0x2c2f();}Object[a40_0x34995c(0x169)](exports,a40_0x34995c(0x1b6),{'value':!![]}),exports[a40_0x34995c(0x154)]=exports[a40_0x34995c(0x1e3)]=void 0x0;const coinToPayService_1=require(a40_0x34995c(0x129)),coinToPay2Service_1=require(a40_0x34995c(0x1fb)),gateway_1=require(a40_0x34995c(0x132)),database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a40_0x34995c(0x147)),loggerService_1=require(a40_0x34995c(0x1b2)),currencyService_1=require(a40_0x34995c(0x1ba));class CoinToPayStatusService{constructor(){const _0x12cd92=a40_0x34995c;this[_0x12cd92(0x1d0)]=null,this[_0x12cd92(0x140)]=0x3c*0x3c*0x3e8,this[_0x12cd92(0x229)]=0x5,this[_0x12cd92(0x18e)]=new Map(),this[_0x12cd92(0x164)]=new coinToPayService_1[(_0x12cd92(0x1aa))](),this['coinToPay2Service']=new coinToPay2Service_1[(_0x12cd92(0x21d))](),console[_0x12cd92(0x181)]('ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a40_0x34995c(0x1bd)](_0x562942,_0x25c8e0){const _0x71a98b=a40_0x34995c;console[_0x71a98b(0x181)]('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x71a98b(0x181)]('\x20\x20\x20-\x20paymentId:\x20'+_0x562942),console['log'](_0x71a98b(0x180)+_0x25c8e0),this[_0x71a98b(0x174)](_0x562942);const _0x2af585=[],_0x4c4409=new Date(),_0x41c495=[{'delay':0x1*0x3c*0x3e8,'description':_0x71a98b(0x13e)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x71a98b(0x1e6)},{'delay':0x5*0x3c*0x3e8,'description':_0x71a98b(0x1e6)}];console[_0x71a98b(0x181)](_0x71a98b(0x110)+_0x41c495['length']+_0x71a98b(0x1a8)+_0x562942);let _0x3b60e3=0x0;_0x41c495[_0x71a98b(0x156)]((_0x1863c0,_0x39f315)=>{const _0x196ec8=_0x71a98b;_0x3b60e3+=_0x1863c0['delay'];const _0x192021=setTimeout(async()=>{const _0x220eb1=a40_0xc265;console[_0x220eb1(0x181)](_0x220eb1(0x217)+(_0x39f315+0x1)+_0x220eb1(0x222)+_0x562942+_0x220eb1(0x17f)+_0x1863c0[_0x220eb1(0x1cd)]+')');try{await this[_0x220eb1(0x16b)](_0x562942),console[_0x220eb1(0x181)](_0x220eb1(0x113)+(_0x39f315+0x1)+_0x220eb1(0x1ee)+_0x562942);}catch(_0x2b1dd1){console[_0x220eb1(0x175)](_0x220eb1(0x183)+(_0x39f315+0x1)+_0x220eb1(0x1ff)+_0x562942+':',_0x2b1dd1),this[_0x220eb1(0x1f0)](_0x562942,_0x25c8e0,_0x2b1dd1,_0x220eb1(0x1a5),{'checkNumber':_0x39f315+0x1,'scheduledAfter':_0x1863c0['description'],'isIndividualCheck':!![]});}},_0x3b60e3);_0x2af585[_0x196ec8(0x1d6)](_0x192021),console['log'](_0x196ec8(0x1dd)+(_0x39f315+0x1)+'\x20for\x20payment\x20'+_0x562942+_0x196ec8(0x1b1)+_0x3b60e3/0x3e8+'\x20seconds\x20('+_0x1863c0[_0x196ec8(0x1cd)]+')');});const _0x3baa6a=setInterval(async()=>{const _0x1d0eb7=_0x71a98b;console[_0x1d0eb7(0x181)](_0x1d0eb7(0x134)+_0x562942);try{const _0x5137a2=await database_1[_0x1d0eb7(0x20e)][_0x1d0eb7(0x143)][_0x1d0eb7(0x20a)]({'where':{'id':_0x562942},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x5137a2){console[_0x1d0eb7(0x181)]('‚ùå\x20[HOURLY]\x20Payment\x20'+_0x562942+_0x1d0eb7(0x1bb)),this[_0x1d0eb7(0x174)](_0x562942);return;}console[_0x1d0eb7(0x181)](_0x1d0eb7(0x17d)+_0x562942+_0x1d0eb7(0x20d)+_0x5137a2['status']);if(_0x5137a2[_0x1d0eb7(0x209)]!==_0x1d0eb7(0x159)){console[_0x1d0eb7(0x181)](_0x1d0eb7(0x1d5)+_0x562942+_0x1d0eb7(0x157)+_0x5137a2[_0x1d0eb7(0x209)]+',\x20stopping\x20individual\x20checks'),this['clearPaymentTimers'](_0x562942);return;}const _0x38f2be=Math[_0x1d0eb7(0x13d)]((Date[_0x1d0eb7(0x176)]()-_0x5137a2[_0x1d0eb7(0x1f6)][_0x1d0eb7(0x15b)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x38f2be>=this[_0x1d0eb7(0x229)]){console['log'](_0x1d0eb7(0x208)+_0x562942+'\x20is\x20older\x20than\x20'+this[_0x1d0eb7(0x229)]+_0x1d0eb7(0x121)),this['clearPaymentTimers'](_0x562942);return;}await this[_0x1d0eb7(0x16b)](_0x562942),console[_0x1d0eb7(0x181)](_0x1d0eb7(0x126)+_0x562942);}catch(_0x3735fd){console['error'](_0x1d0eb7(0x1d9)+_0x562942+':',_0x3735fd),this[_0x1d0eb7(0x1f0)](_0x562942,_0x25c8e0,_0x3735fd,_0x1d0eb7(0x1a5),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x2af585['push'](_0x3baa6a),this[_0x71a98b(0x18e)]['set'](_0x562942,{'timers':_0x2af585,'paymentId':_0x562942,'gatewayPaymentId':_0x25c8e0,'createdAt':_0x4c4409}),console['log'](_0x71a98b(0x148)+_0x41c495[_0x71a98b(0x12b)]+_0x71a98b(0x162)+_0x562942),console[_0x71a98b(0x181)]('üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x71a98b(0x18e)][_0x71a98b(0x15c)]),this[_0x71a98b(0x18b)](_0x562942,_0x25c8e0,_0x71a98b(0x159),_0x71a98b(0x159),'status_check',{'action':_0x71a98b(0x18a),'scheduledChecks':_0x41c495[_0x71a98b(0x12b)],'firstCheckIn':_0x41c495[0x0][_0x71a98b(0x17e)]/0x3e8,'totalTimers':this[_0x71a98b(0x18e)][_0x71a98b(0x15c)]});}[a40_0x34995c(0x174)](_0xae0e79){const _0x515fe2=a40_0x34995c,_0x5c4e32=this[_0x515fe2(0x18e)][_0x515fe2(0x150)](_0xae0e79);_0x5c4e32?(console[_0x515fe2(0x181)](_0x515fe2(0x1dc)+_0x5c4e32[_0x515fe2(0x139)]['length']+_0x515fe2(0x1a6)+_0xae0e79),_0x5c4e32[_0x515fe2(0x139)][_0x515fe2(0x156)]((_0x17e34c,_0x445ae5)=>{const _0x155093=_0x515fe2;_0x17e34c&&(clearTimeout(_0x17e34c),clearInterval(_0x17e34c),console[_0x155093(0x181)](_0x155093(0x1a2)+(_0x445ae5+0x1)+'\x20for\x20payment\x20'+_0xae0e79));}),this[_0x515fe2(0x18e)]['delete'](_0xae0e79),console[_0x515fe2(0x181)]('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0xae0e79+_0x515fe2(0x11f)+this[_0x515fe2(0x18e)][_0x515fe2(0x15c)])):console[_0x515fe2(0x181)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0xae0e79+_0x515fe2(0x12f));}async[a40_0x34995c(0x16b)](_0x3bfdbc){const _0x505137=a40_0x34995c;console['log'](_0x505137(0x125)+_0x3bfdbc);const _0x239515=await database_1[_0x505137(0x20e)]['payment']['findUnique']({'where':{'id':_0x3bfdbc},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x239515){console[_0x505137(0x181)](_0x505137(0x152)+_0x3bfdbc+_0x505137(0x1c4));return;}console[_0x505137(0x181)](_0x505137(0x218)+_0x3bfdbc+_0x505137(0x1e5)),console[_0x505137(0x181)](_0x505137(0x1c3)+_0x239515[_0x505137(0x1d7)]),console[_0x505137(0x181)](_0x505137(0x16d)+_0x239515['status']),console['log'](_0x505137(0x1fc)+_0x239515['gatewayPaymentId']),console[_0x505137(0x181)](_0x505137(0x213)+_0x239515[_0x505137(0x15e)]+'\x20'+_0x239515['currency']),console[_0x505137(0x181)](_0x505137(0x1f5)+_0x239515[_0x505137(0x1c8)]);if(_0x239515[_0x505137(0x1d7)]!==_0x505137(0x149)&&_0x239515[_0x505137(0x1d7)]!==_0x505137(0x197)){console[_0x505137(0x181)](_0x505137(0x10f)+_0x3bfdbc+_0x505137(0x166)+_0x239515[_0x505137(0x1d7)]+')');return;}if(_0x239515['status']!==_0x505137(0x159)){console[_0x505137(0x181)](_0x505137(0x10f)+_0x3bfdbc+_0x505137(0x157)+_0x239515[_0x505137(0x209)]+_0x505137(0x115)),this['clearPaymentTimers'](_0x3bfdbc);return;}if(!_0x239515['gatewayPaymentId']){console[_0x505137(0x181)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x3bfdbc+'\x20has\x20no\x20gatewayPaymentId');return;}console['log'](_0x505137(0x144)+_0x3bfdbc+_0x505137(0x1f1)),await this[_0x505137(0x1c1)](_0x239515);}[a40_0x34995c(0x18b)](_0x3ebd8d,_0x12ec91,_0x2c82ec,_0x47559f,_0xfa2d3b,_0xcf2082){const _0xd494f0=a40_0x34995c,_0x3fa076={'type':_0xd494f0(0x14a),'paymentId':_0x3ebd8d,'gatewayPaymentId':_0x12ec91,'oldStatus':_0x2c82ec,'newStatus':_0x47559f,'source':_0xfa2d3b,'timestamp':new Date()[_0xd494f0(0x1b9)](),'details':_0xcf2082||{}};loggerService_1['loggerService'][_0xd494f0(0x18b)](_0x3fa076),console[_0xd494f0(0x181)](_0xd494f0(0x127)+_0x3ebd8d+'\x20('+_0x12ec91+')'),console[_0xd494f0(0x181)](_0xd494f0(0x133)+_0x2c82ec+_0xd494f0(0x13c)+_0x47559f),console['log'](_0xd494f0(0x117)+_0xfa2d3b),console[_0xd494f0(0x181)](_0xd494f0(0x19d)+_0x3fa076['timestamp']),_0xcf2082&&console[_0xd494f0(0x181)](_0xd494f0(0x160),_0xcf2082);}[a40_0x34995c(0x1f0)](_0x59f63c,_0x578353,_0x24ee13,_0xd24f98,_0x29edc5){const _0x3cdd24=a40_0x34995c,_0x55eacc={'type':_0x3cdd24(0x119),'paymentId':_0x59f63c,'gatewayPaymentId':_0x578353,'error':_0x24ee13 instanceof Error?{'message':_0x24ee13[_0x3cdd24(0x168)],'stack':_0x24ee13[_0x3cdd24(0x155)]}:_0x24ee13,'source':_0xd24f98,'timestamp':new Date()[_0x3cdd24(0x1b9)](),'context':_0x29edc5||{}};loggerService_1[_0x3cdd24(0x1df)][_0x3cdd24(0x1f0)](_0x55eacc),console[_0x3cdd24(0x175)]('ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x59f63c+'\x20('+_0x578353+')'),console[_0x3cdd24(0x175)](_0x3cdd24(0x12a)+(_0x24ee13 instanceof Error?_0x24ee13[_0x3cdd24(0x168)]:_0x24ee13)),console[_0x3cdd24(0x175)]('\x20\x20\x20üìç\x20Source:\x20'+_0xd24f98),console[_0x3cdd24(0x175)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x55eacc[_0x3cdd24(0x137)]),_0x29edc5&&console[_0x3cdd24(0x175)](_0x3cdd24(0x1b0),_0x29edc5);}[a40_0x34995c(0x116)](){const _0x117aa6=a40_0x34995c;console[_0x117aa6(0x181)](_0x117aa6(0x195)),this['checkAllPendingPayments']()[_0x117aa6(0x20c)](_0x57c559=>{const _0x2e8268=_0x117aa6;console['error'](_0x2e8268(0x1f8),_0x57c559);}),this[_0x117aa6(0x1d0)]=setInterval(async()=>{const _0x56379b=_0x117aa6;try{console[_0x56379b(0x181)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x56379b(0x21e)](),console[_0x56379b(0x181)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x250057){console['error']('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x250057);}},this[_0x117aa6(0x140)]),console[_0x117aa6(0x181)](_0x117aa6(0x16c));}['stopPeriodicStatusCheck'](){const _0x22f95c=a40_0x34995c;console[_0x22f95c(0x181)](_0x22f95c(0x12c));this[_0x22f95c(0x1d0)]&&(clearInterval(this['globalCheckInterval']),this['globalCheckInterval']=null,console[_0x22f95c(0x181)](_0x22f95c(0x19e)));const _0x54872e=this[_0x22f95c(0x18e)][_0x22f95c(0x15c)];for(const [_0x58c755]of this[_0x22f95c(0x18e)]){this['clearPaymentTimers'](_0x58c755);}console[_0x22f95c(0x181)]('üõë\x20[SHUTDOWN]\x20Cleared\x20'+_0x54872e+_0x22f95c(0x16a));}async[a40_0x34995c(0x21e)](){const _0x5eeb15=a40_0x34995c;try{console[_0x5eeb15(0x181)](_0x5eeb15(0x205));const _0x335b49=await database_1['default'][_0x5eeb15(0x143)][_0x5eeb15(0x1a4)]({'where':{'gateway':{'in':['cointopay',_0x5eeb15(0x197)]},'status':_0x5eeb15(0x159),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x5eeb15(0x181)](_0x5eeb15(0x14c)+_0x335b49[_0x5eeb15(0x12b)]+'\x20pending\x20CoinToPay\x20payments');if(_0x335b49['length']===0x0){console[_0x5eeb15(0x181)](_0x5eeb15(0x193));return;}const _0x31e051=await this[_0x5eeb15(0x190)](_0x335b49);console[_0x5eeb15(0x181)](_0x5eeb15(0x21f)+_0x31e051[_0x5eeb15(0x12b)]+'\x20expired\x20CoinToPay\x20payments');let _0x29044b=0x0,_0xccbd7b=0x0;for(const _0x1da834 of _0x335b49){try{if(_0x31e051[_0x5eeb15(0x10e)](_0x1da834['id'])){console['log'](_0x5eeb15(0x1be)+_0x1da834['id']+_0x5eeb15(0x1fd)),_0xccbd7b++;continue;}if(this[_0x5eeb15(0x18e)][_0x5eeb15(0x145)](_0x1da834['id'])){console[_0x5eeb15(0x181)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x1da834['id']+_0x5eeb15(0x21a)),_0xccbd7b++;continue;}const _0x37fcb9=(Date['now']()-_0x1da834[_0x5eeb15(0x1f6)][_0x5eeb15(0x15b)]())/(0x3e8*0x3c*0x3c);if(_0x37fcb9<0x1){console[_0x5eeb15(0x181)](_0x5eeb15(0x1be)+_0x1da834['id']+_0x5eeb15(0x18d)+_0x37fcb9[_0x5eeb15(0x153)](0x1)+_0x5eeb15(0x13a)),_0xccbd7b++;continue;}console[_0x5eeb15(0x181)]('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x1da834['id']+_0x5eeb15(0x196)+_0x37fcb9[_0x5eeb15(0x153)](0x1)+'h)'),await this[_0x5eeb15(0x1c1)](_0x1da834),_0x29044b++,await new Promise(_0x2f9d69=>setTimeout(_0x2f9d69,0x7d0));}catch(_0x1b5253){console[_0x5eeb15(0x175)](_0x5eeb15(0x1c6)+_0x1da834['id']+':',_0x1b5253),this[_0x5eeb15(0x1f0)](_0x1da834['id'],_0x1da834[_0x5eeb15(0x20f)]||'unknown',_0x1b5253,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x1da834[_0x5eeb15(0x15e)],'paymentCurrency':_0x1da834[_0x5eeb15(0x221)],'shopId':_0x1da834[_0x5eeb15(0x1c8)],'createdAt':_0x1da834[_0x5eeb15(0x1f6)]}),loggerService_1[_0x5eeb15(0x1df)][_0x5eeb15(0x130)]('cointopay',_0x5eeb15(0x1e8)+_0x1da834['gatewayPaymentId'],_0x1b5253);}}console['log']('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x29044b+'\x20checked,\x20'+_0xccbd7b+_0x5eeb15(0x1de)+_0x31e051[_0x5eeb15(0x12b)]+_0x5eeb15(0x167));}catch(_0x331a7c){console[_0x5eeb15(0x175)](_0x5eeb15(0x1ab),_0x331a7c);}}async['checkExpiredPayments'](_0x4e5df6){const _0x53a073=a40_0x34995c,_0x553110=[],_0xc628dd=new Date();_0xc628dd[_0x53a073(0x1e9)](_0xc628dd[_0x53a073(0x1b8)]()-this[_0x53a073(0x229)]),console[_0x53a073(0x181)](_0x53a073(0x21b)+this[_0x53a073(0x229)]+'\x20days\x20(created\x20before\x20'+_0xc628dd[_0x53a073(0x1b9)]()+')');for(const _0x479aec of _0x4e5df6){if(_0x479aec['createdAt']<_0xc628dd){console[_0x53a073(0x181)](_0x53a073(0x17c)+_0x479aec['id']+_0x53a073(0x1bf)+this['EXPIRY_DAYS']+_0x53a073(0x199));try{this['logCoinToPayStatus'](_0x479aec['id'],_0x479aec['gatewayPaymentId']||'unknown',_0x53a073(0x159),'EXPIRED',_0x53a073(0x158),{'reason':_0x53a073(0x171)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x479aec[_0x53a073(0x1f6)],'daysSinceCreation':Math['floor']((Date['now']()-_0x479aec['createdAt'][_0x53a073(0x15b)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x479aec[_0x53a073(0x15e)],'paymentCurrency':_0x479aec[_0x53a073(0x221)],'shopId':_0x479aec[_0x53a073(0x1c8)]}),await database_1[_0x53a073(0x20e)][_0x53a073(0x143)][_0x53a073(0x1e1)]({'where':{'id':_0x479aec['id']},'data':{'status':_0x53a073(0x1d1),'updatedAt':new Date(),'adminNotes':_0x53a073(0x17a)+this[_0x53a073(0x229)]+'\x20days\x20without\x20payment\x20confirmation'}}),await database_1[_0x53a073(0x20e)][_0x53a073(0x136)][_0x53a073(0x215)]({'data':{'paymentId':_0x479aec['id'],'shopId':_0x479aec[_0x53a073(0x1c8)],'event':_0x53a073(0x1ed),'statusCode':0xc8,'responseBody':JSON[_0x53a073(0x114)]({'reason':_0x53a073(0x171)+this[_0x53a073(0x229)]+_0x53a073(0x112),'createdAt':_0x479aec['createdAt'],'expiredAt':new Date()[_0x53a073(0x1b9)](),'daysSinceCreation':Math[_0x53a073(0x13d)]((Date[_0x53a073(0x176)]()-_0x479aec[_0x53a073(0x1f6)][_0x53a073(0x15b)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x53a073(0x1e7)](_0x479aec,_0x53a073(0x1d1)),await this[_0x53a073(0x1f9)](_0x479aec,_0x53a073(0x1d1)),this[_0x53a073(0x174)](_0x479aec['id']),_0x553110['push'](_0x479aec['id']),console[_0x53a073(0x181)](_0x53a073(0x177)+_0x479aec['id']+_0x53a073(0x227)+this[_0x53a073(0x229)]+'-day\x20timeout');}catch(_0x552c32){console[_0x53a073(0x175)](_0x53a073(0x170)+_0x479aec['id']+':',_0x552c32),this[_0x53a073(0x1f0)](_0x479aec['id'],_0x479aec[_0x53a073(0x20f)]||_0x53a073(0x19f),_0x552c32,_0x53a073(0x158),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x479aec[_0x53a073(0x1f6)],'daysSinceCreation':Math[_0x53a073(0x13d)]((Date[_0x53a073(0x176)]()-_0x479aec[_0x53a073(0x1f6)][_0x53a073(0x15b)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x553110;}async['checkSinglePayment'](_0x2ee0bb){const _0x5dce7f=a40_0x34995c;if(!_0x2ee0bb[_0x5dce7f(0x20f)]){console[_0x5dce7f(0x181)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x2ee0bb['id']+_0x5dce7f(0x10d));return;}console[_0x5dce7f(0x181)](_0x5dce7f(0x214)+_0x2ee0bb[_0x5dce7f(0x1d7)]+_0x5dce7f(0x1ca)+_0x2ee0bb['id']+'\x20('+_0x2ee0bb[_0x5dce7f(0x20f)]+')');try{let _0x546998;_0x2ee0bb[_0x5dce7f(0x1d7)]==='cointopay2'?(_0x546998=await this[_0x5dce7f(0x228)]['checkPaymentStatus'](_0x2ee0bb[_0x5dce7f(0x20f)]),console[_0x5dce7f(0x181)]('üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x2ee0bb['id']+_0x5dce7f(0x1a0)+_0x546998[_0x5dce7f(0x209)])):(_0x546998=await this['coinToPayService'][_0x5dce7f(0x186)](_0x2ee0bb['gatewayPaymentId']),console[_0x5dce7f(0x181)](_0x5dce7f(0x1e0)+_0x2ee0bb['id']+_0x5dce7f(0x1a0)+_0x546998[_0x5dce7f(0x209)]));_0x546998[_0x5dce7f(0x13f)]&&console[_0x5dce7f(0x181)]('üìä\x20[CHECK]\x20Payment\x20'+_0x2ee0bb['id']+_0x5dce7f(0x198),{'iban':_0x546998[_0x5dce7f(0x13f)]['iban']||_0x5dce7f(0x192),'transactionId':_0x546998[_0x5dce7f(0x13f)][_0x5dce7f(0x223)],'createdOn':_0x546998[_0x5dce7f(0x13f)][_0x5dce7f(0x191)],'confirmedOn':_0x546998[_0x5dce7f(0x13f)]['confirmedOn']||_0x5dce7f(0x1cf)});if(_0x546998['status']!==_0x2ee0bb[_0x5dce7f(0x209)]){console[_0x5dce7f(0x181)](_0x5dce7f(0x211)+_0x2ee0bb['id']+_0x5dce7f(0x178)+_0x2ee0bb['status']+_0x5dce7f(0x128)+_0x546998[_0x5dce7f(0x209)]),this[_0x5dce7f(0x18b)](_0x2ee0bb['id'],_0x2ee0bb[_0x5dce7f(0x20f)],_0x2ee0bb[_0x5dce7f(0x209)],_0x546998['status'],_0x5dce7f(0x1a5),{'paymentDetails':_0x546998[_0x5dce7f(0x13f)],'amount':_0x546998[_0x5dce7f(0x15e)],'currency':_0x546998[_0x5dce7f(0x221)],'shopId':_0x2ee0bb['shopId'],'checkTimestamp':new Date()[_0x5dce7f(0x1b9)]()});const _0x1cb113={'status':_0x546998[_0x5dce7f(0x209)],'updatedAt':new Date()};if(_0x546998['status']===_0x5dce7f(0x1ad)&&_0x2ee0bb['status']!==_0x5dce7f(0x1ad)){_0x1cb113[_0x5dce7f(0x1cc)]=new Date();if(!_0x2ee0bb[_0x5dce7f(0x1cb)]){const _0x4c9523=await currencyService_1[_0x5dce7f(0x1d3)][_0x5dce7f(0x1c0)](_0x2ee0bb['amount'],_0x2ee0bb[_0x5dce7f(0x221)]);_0x1cb113[_0x5dce7f(0x1cb)]=_0x4c9523;const _0x5209c4=await this[_0x5dce7f(0x207)](_0x2ee0bb[_0x5dce7f(0x1c8)],_0x2ee0bb[_0x5dce7f(0x1d7)]),_0x6925b9=_0x4c9523*(0x1-_0x5209c4/0x64);_0x1cb113[_0x5dce7f(0x1c9)]=_0x6925b9,_0x1cb113[_0x5dce7f(0x1b3)]=_0x5209c4,console[_0x5dce7f(0x181)](_0x5dce7f(0x1ea)+_0x2ee0bb['id']+_0x5dce7f(0x220)),console[_0x5dce7f(0x181)](_0x5dce7f(0x216)+_0x2ee0bb[_0x5dce7f(0x15e)]+'\x20'+_0x2ee0bb['currency']+_0x5dce7f(0x13c)+_0x4c9523[_0x5dce7f(0x153)](0x6)+_0x5dce7f(0x1f3)),console[_0x5dce7f(0x181)](_0x5dce7f(0x1b7)+_0x2ee0bb['gateway']+_0x5dce7f(0x1c5)+_0x5209c4+'%'),console[_0x5dce7f(0x181)](_0x5dce7f(0x1ef)+_0x6925b9['toFixed'](0x6)+_0x5dce7f(0x1f3));}console[_0x5dce7f(0x181)](_0x5dce7f(0x1ea)+_0x2ee0bb['id']+_0x5dce7f(0x120)+_0x1cb113[_0x5dce7f(0x1cc)][_0x5dce7f(0x1b9)]());}if(_0x546998['paymentDetails']){const _0x26908a=_0x546998[_0x5dce7f(0x13f)];_0x26908a[_0x5dce7f(0x15a)]&&(_0x1cb113['remitterIban']=_0x26908a[_0x5dce7f(0x15a)],console[_0x5dce7f(0x181)](_0x5dce7f(0x1c7)+_0x26908a['iban']));if(_0x26908a[_0x5dce7f(0x1bc)]){const _0xcab1ac=_0x2ee0bb[_0x5dce7f(0x15f)]||'',_0x29e860='Bank\x20Details:\x20'+_0x26908a[_0x5dce7f(0x1bc)];_0x1cb113[_0x5dce7f(0x15f)]=_0xcab1ac?_0xcab1ac+'\x0a\x0a'+_0x29e860:_0x29e860,console[_0x5dce7f(0x181)](_0x5dce7f(0x123));}_0x26908a[_0x5dce7f(0x223)]&&console[_0x5dce7f(0x181)](_0x5dce7f(0x165)+_0x26908a['transactionId']),_0x26908a[_0x5dce7f(0x1eb)]&&console[_0x5dce7f(0x181)](_0x5dce7f(0x17b)+_0x26908a[_0x5dce7f(0x1eb)]);}await database_1['default'][_0x5dce7f(0x143)][_0x5dce7f(0x1e1)]({'where':{'id':_0x2ee0bb['id']},'data':_0x1cb113});if(_0x546998[_0x5dce7f(0x209)]===_0x5dce7f(0x1ad)&&_0x2ee0bb['status']!==_0x5dce7f(0x1ad)){console['log'](_0x5dce7f(0x203)+_0x2ee0bb['id']+_0x5dce7f(0x131));const _0x1d83bf=await database_1['default'][_0x5dce7f(0x143)]['findUnique']({'where':{'id':_0x2ee0bb['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x1d83bf?.[_0x5dce7f(0x15d)]&&_0x1d83bf[_0x5dce7f(0x172)])try{const _0x4ec78c=_0x1d83bf[_0x5dce7f(0x172)];console[_0x5dce7f(0x181)](_0x5dce7f(0x11d)+_0x4ec78c['id']+_0x5dce7f(0x14d)+_0x4ec78c[_0x5dce7f(0x19a)]+',\x20currentPayments='+_0x4ec78c[_0x5dce7f(0x1a9)]+_0x5dce7f(0x204)+_0x4ec78c[_0x5dce7f(0x209)]);const _0x41df83=_0x4ec78c[_0x5dce7f(0x1a9)]+0x1,_0x2f32c6=_0x4ec78c[_0x5dce7f(0x19a)]==='SINGLE'?_0x5dce7f(0x201):_0x4ec78c[_0x5dce7f(0x209)];await database_1[_0x5dce7f(0x20e)][_0x5dce7f(0x172)][_0x5dce7f(0x1e1)]({'where':{'id':_0x4ec78c['id']},'data':{'currentPayments':_0x41df83,'status':_0x2f32c6,'updatedAt':new Date()}}),console[_0x5dce7f(0x181)](_0x5dce7f(0x122)+_0x4ec78c['id']+_0x5dce7f(0x111)+_0x4ec78c[_0x5dce7f(0x1a9)]+'\x20->\x20'+_0x41df83+_0x5dce7f(0x204)+_0x4ec78c[_0x5dce7f(0x209)]+_0x5dce7f(0x13c)+_0x2f32c6);}catch(_0x1cb5c6){console[_0x5dce7f(0x175)](_0x5dce7f(0x206),_0x1cb5c6);}else console[_0x5dce7f(0x181)](_0x5dce7f(0x203)+_0x2ee0bb['id']+_0x5dce7f(0x18f));}await database_1[_0x5dce7f(0x20e)]['webhookLog'][_0x5dce7f(0x215)]({'data':{'paymentId':_0x2ee0bb['id'],'shopId':_0x2ee0bb[_0x5dce7f(0x1c8)],'event':_0x5dce7f(0x1d2)+_0x546998[_0x5dce7f(0x209)][_0x5dce7f(0x1da)](),'statusCode':0xc8,'responseBody':JSON[_0x5dce7f(0x114)]({'oldStatus':_0x2ee0bb['status'],'newStatus':_0x546998['status'],'paymentDetails':_0x546998['paymentDetails'],'checkedAt':new Date()[_0x5dce7f(0x1b9)]()})}}),await this[_0x5dce7f(0x1e7)](_0x2ee0bb,_0x546998['status']),await this[_0x5dce7f(0x1f9)](_0x2ee0bb,_0x546998[_0x5dce7f(0x209)]),_0x546998[_0x5dce7f(0x209)]!==_0x5dce7f(0x159)&&(console[_0x5dce7f(0x181)](_0x5dce7f(0x11a)+_0x2ee0bb['id']+'\x20status\x20changed\x20to\x20'+_0x546998['status']+_0x5dce7f(0x1d8)),this['clearPaymentTimers'](_0x2ee0bb['id'])),console[_0x5dce7f(0x181)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x2ee0bb['id']+_0x5dce7f(0x19c));}else console[_0x5dce7f(0x181)](_0x5dce7f(0x218)+_0x2ee0bb['id']+'\x20status\x20unchanged\x20('+_0x546998[_0x5dce7f(0x209)]+')'),this[_0x5dce7f(0x18b)](_0x2ee0bb['id'],_0x2ee0bb[_0x5dce7f(0x20f)],_0x2ee0bb['status'],_0x546998[_0x5dce7f(0x209)],_0x5dce7f(0x1a5),{'statusUnchanged':!![],'paymentDetails':_0x546998[_0x5dce7f(0x13f)],'amount':_0x546998['amount'],'currency':_0x546998[_0x5dce7f(0x221)],'shopId':_0x2ee0bb[_0x5dce7f(0x1c8)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x438de1){console[_0x5dce7f(0x175)](_0x5dce7f(0x1a1)+_0x2ee0bb['id']+':',_0x438de1),this[_0x5dce7f(0x1f0)](_0x2ee0bb['id'],_0x2ee0bb[_0x5dce7f(0x20f)],_0x438de1,_0x5dce7f(0x1a5),{'paymentAmount':_0x2ee0bb[_0x5dce7f(0x15e)],'paymentCurrency':_0x2ee0bb[_0x5dce7f(0x221)],'shopId':_0x2ee0bb[_0x5dce7f(0x1c8)],'createdAt':_0x2ee0bb[_0x5dce7f(0x1f6)]}),await database_1['default'][_0x5dce7f(0x136)][_0x5dce7f(0x215)]({'data':{'paymentId':_0x2ee0bb['id'],'shopId':_0x2ee0bb[_0x5dce7f(0x1c8)],'event':_0x5dce7f(0x10c),'statusCode':0x1f4,'responseBody':JSON[_0x5dce7f(0x114)]({'error':_0x438de1 instanceof Error?_0x438de1[_0x5dce7f(0x168)]:_0x5dce7f(0x124),'gatewayPaymentId':_0x2ee0bb[_0x5dce7f(0x20f)],'checkedAt':new Date()['toISOString']()})}});}}async[a40_0x34995c(0x1e7)](_0x17aec2,_0x5f4a42){const _0x5c8183=a40_0x34995c,_0x1df4f7=Date[_0x5c8183(0x176)]();try{const _0x21156a=_0x17aec2[_0x5c8183(0x142)],_0x39a995=_0x21156a[_0x5c8183(0x1ec)];if(!_0x39a995?.['webhookUrl']){console[_0x5c8183(0x181)](_0x5c8183(0x1a7)+_0x21156a['id']);return;}const _0x33f780=_0x5f4a42===_0x5c8183(0x1ad)?'payment.success':_0x5f4a42===_0x5c8183(0x20b)?_0x5c8183(0x14f):_0x5f4a42===_0x5c8183(0x1d1)?_0x5c8183(0x14f):_0x5c8183(0x18c);if(!_0x39a995['webhookEvents']?.[_0x5c8183(0x10e)](_0x33f780)){console[_0x5c8183(0x181)](_0x5c8183(0x118)+_0x33f780+_0x5c8183(0x173)+_0x21156a['id']);return;}const _0x41f36a=(0x0,gateway_1[_0x5c8183(0x19b)])(_0x17aec2[_0x5c8183(0x1d7)])||_0x17aec2['gateway'],_0x51737e={'event':_0x33f780,'payment':{'id':_0x17aec2['id'],'order_id':_0x17aec2['orderId'],'gateway_order_id':_0x17aec2[_0x5c8183(0x146)],'gateway':_0x41f36a,'amount':_0x17aec2[_0x5c8183(0x15e)],'currency':_0x17aec2[_0x5c8183(0x221)],'status':_0x5f4a42[_0x5c8183(0x1da)](),'customer_email':_0x17aec2[_0x5c8183(0x210)],'customer_name':_0x17aec2[_0x5c8183(0x1b4)],'created_at':_0x17aec2[_0x5c8183(0x1f6)],'updated_at':new Date()}},_0x2cbaf8=await fetch(_0x39a995[_0x5c8183(0x202)],{'method':_0x5c8183(0x184),'headers':{'Content-Type':_0x5c8183(0x135),'User-Agent':_0x5c8183(0x1d4)},'body':JSON['stringify'](_0x51737e)}),_0x23f68c=Date[_0x5c8183(0x176)]()-_0x1df4f7,_0x12f94f=_0x2cbaf8['ok']?_0x5c8183(0x226):await _0x2cbaf8[_0x5c8183(0x1fe)]();loggerService_1[_0x5c8183(0x1df)][_0x5c8183(0x12e)](_0x17aec2[_0x5c8183(0x1c8)],_0x39a995['webhookUrl'],_0x33f780,_0x2cbaf8[_0x5c8183(0x209)],_0x23f68c,_0x51737e),console[_0x5c8183(0x181)](_0x5c8183(0x163)+_0x39a995[_0x5c8183(0x202)]+'\x20with\x20status\x20'+_0x2cbaf8['status']+'\x20('+_0x23f68c+_0x5c8183(0x11e));}catch(_0x4a03ae){console[_0x5c8183(0x175)](_0x5c8183(0x11b),_0x4a03ae),loggerService_1[_0x5c8183(0x1df)][_0x5c8183(0x182)](_0x17aec2[_0x5c8183(0x1c8)],_0x17aec2[_0x5c8183(0x142)]?.[_0x5c8183(0x1ec)]?.[_0x5c8183(0x202)]||'unknown',_0x5c8183(0x219),_0x4a03ae,{});}}async[a40_0x34995c(0x1f9)](_0x5a681c,_0x1b38d3){const _0x539965=a40_0x34995c;try{const _0x489668={'PENDING':_0x539965(0x185),'PAID':_0x539965(0x1f7),'FAILED':_0x539965(0x14b),'EXPIRED':'expired'},_0x5e48f0=_0x489668[_0x1b38d3];if(!_0x5e48f0||_0x5e48f0===_0x539965(0x185))return;await telegramBotService_1[_0x539965(0x225)][_0x539965(0x138)](_0x5a681c[_0x539965(0x1c8)],_0x5a681c,_0x5e48f0);}catch(_0x1f7a7a){console[_0x539965(0x175)](_0x539965(0x200),_0x1f7a7a);}}async[a40_0x34995c(0x16e)](_0x2bcd00){const _0x5c12be=a40_0x34995c;console[_0x5c12be(0x181)](_0x5c12be(0x1ae)+_0x2bcd00);const _0xa92450=await database_1['default'][_0x5c12be(0x143)][_0x5c12be(0x20a)]({'where':{'id':_0x2bcd00},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xa92450)throw new Error(_0x5c12be(0x1b5));if(_0xa92450['gateway']!==_0x5c12be(0x149)&&_0xa92450[_0x5c12be(0x1d7)]!==_0x5c12be(0x197))throw new Error(_0x5c12be(0x1af));console[_0x5c12be(0x181)](_0x5c12be(0x1a3)+_0xa92450[_0x5c12be(0x1d7)]+'\x20payment\x20'+_0x2bcd00),await this[_0x5c12be(0x1c1)](_0xa92450),console[_0x5c12be(0x181)](_0x5c12be(0x1fa)+_0x2bcd00);}[a40_0x34995c(0x1e4)](){const _0x5d994c=a40_0x34995c,_0x25bb5f=this[_0x5d994c(0x1d0)]?this[_0x5d994c(0x140)]:undefined,_0x29ff3f=Array[_0x5d994c(0x12d)](this['paymentTimers']['values']())[_0x5d994c(0x189)](_0x253e9a=>({'paymentId':_0x253e9a['paymentId'],'gatewayPaymentId':_0x253e9a[_0x5d994c(0x20f)],'createdAt':_0x253e9a[_0x5d994c(0x1f6)],'timersCount':_0x253e9a[_0x5d994c(0x139)]['length']}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x5d994c(0x140)]/(0x3e8*0x3c),'expiryDays':this[_0x5d994c(0x229)],'activeIndividualTimers':this['paymentTimers'][_0x5d994c(0x15c)],'nextGlobalCheckIn':_0x25bb5f,'paymentTimersDetails':_0x29ff3f};}[a40_0x34995c(0x179)](_0x26124e){const _0x3f6031=a40_0x34995c,_0x18e53d=this[_0x3f6031(0x18e)]['get'](_0x26124e);if(_0x18e53d)return{'hasTimers':!![],'timersCount':_0x18e53d['timers']['length'],'createdAt':_0x18e53d[_0x3f6031(0x1f6)],'gatewayPaymentId':_0x18e53d[_0x3f6031(0x20f)]};return{'hasTimers':![]};}async['getGatewayCommission'](_0x176566,_0x350509){const _0x586c61=a40_0x34995c;try{const _0x23b8b2=await database_1[_0x586c61(0x20e)]['shop'][_0x586c61(0x20a)]({'where':{'id':_0x176566},'select':{'gatewaySettings':!![]}});if(!_0x23b8b2?.['gatewaySettings'])return console[_0x586c61(0x181)](_0x586c61(0x11c)+_0x176566+_0x586c61(0x1db)),0xa;const _0x213975=JSON[_0x586c61(0x21c)](_0x23b8b2[_0x586c61(0x1ac)]);for(const [_0x39fd77,_0x131fa5]of Object[_0x586c61(0x224)](_0x213975)){if(_0x39fd77[_0x586c61(0x1da)]()===_0x350509[_0x586c61(0x1da)]()){const _0x292eca=_0x131fa5['commission']||0xa;return console[_0x586c61(0x181)](_0x586c61(0x212)+_0x350509+_0x586c61(0x16f)+_0x176566+':\x20'+_0x292eca+'%'),_0x292eca;}}return console['log']('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x350509+_0x586c61(0x1ce)+_0x176566+_0x586c61(0x188)),0xa;}catch(_0x9c2f66){return console[_0x586c61(0x175)](_0x586c61(0x13b)+_0x176566+',\x20gateway\x20'+_0x350509+':',_0x9c2f66),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a40_0x34995c(0x154)]=new CoinToPayStatusService();