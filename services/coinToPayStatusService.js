'use strict';const a38_0x1356e0=a38_0x88ae;(function(_0x15db5f,_0x17233a){const _0x1177da=a38_0x88ae,_0x4ac047=_0x15db5f();while(!![]){try{const _0x375c15=parseInt(_0x1177da(0x1cb))/0x1*(parseInt(_0x1177da(0x15e))/0x2)+parseInt(_0x1177da(0x1dc))/0x3*(-parseInt(_0x1177da(0x1a5))/0x4)+-parseInt(_0x1177da(0x17d))/0x5+parseInt(_0x1177da(0x1ce))/0x6*(-parseInt(_0x1177da(0x182))/0x7)+parseInt(_0x1177da(0x1d6))/0x8+parseInt(_0x1177da(0xfb))/0x9*(parseInt(_0x1177da(0x14b))/0xa)+parseInt(_0x1177da(0x1ee))/0xb;if(_0x375c15===_0x17233a)break;else _0x4ac047['push'](_0x4ac047['shift']());}catch(_0x4f0945){_0x4ac047['push'](_0x4ac047['shift']());}}}(a38_0x3909,0x52fc3));var __importDefault=this&&this[a38_0x1356e0(0x102)]||function(_0x15cf9f){const _0x44acde=a38_0x1356e0;return _0x15cf9f&&_0x15cf9f[_0x44acde(0x135)]?_0x15cf9f:{'default':_0x15cf9f};};function a38_0x88ae(_0x262ed4,_0x5e643e){const _0x390951=a38_0x3909();return a38_0x88ae=function(_0x88ae95,_0x8d350d){_0x88ae95=_0x88ae95-0xee;let _0x2d98f5=_0x390951[_0x88ae95];return _0x2d98f5;},a38_0x88ae(_0x262ed4,_0x5e643e);}Object['defineProperty'](exports,a38_0x1356e0(0x135),{'value':!![]}),exports[a38_0x1356e0(0x18a)]=exports[a38_0x1356e0(0x112)]=void 0x0;const coinToPayService_1=require(a38_0x1356e0(0x19c)),coinToPay2Service_1=require(a38_0x1356e0(0x1c0)),gateway_1=require(a38_0x1356e0(0x145)),database_1=__importDefault(require(a38_0x1356e0(0xf5))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a38_0x1356e0(0x111)),currencyService_1=require(a38_0x1356e0(0x160));class CoinToPayStatusService{constructor(){const _0x3b5ebb=a38_0x1356e0;this[_0x3b5ebb(0x122)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x3b5ebb(0x11f)]=new Map(),this[_0x3b5ebb(0x151)]=new coinToPayService_1['CoinToPayService'](),this[_0x3b5ebb(0x12f)]=new coinToPay2Service_1[(_0x3b5ebb(0x19d))](),console[_0x3b5ebb(0x169)](_0x3b5ebb(0x150));}[a38_0x1356e0(0x1a0)](_0x7e345e,_0x4bbe79){const _0x1954a2=a38_0x1356e0;console[_0x1954a2(0x169)](_0x1954a2(0x13d)),console['log']('\x20\x20\x20-\x20paymentId:\x20'+_0x7e345e),console[_0x1954a2(0x169)](_0x1954a2(0x15f)+_0x4bbe79),this[_0x1954a2(0x154)](_0x7e345e);const _0x22f0f8=[],_0x59bfea=new Date(),_0x149385=[{'delay':0x1*0x3c*0x3e8,'description':_0x1954a2(0xf9)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x1954a2(0xfc)},{'delay':0x5*0x3c*0x3e8,'description':_0x1954a2(0xfc)}];console[_0x1954a2(0x169)](_0x1954a2(0x1ec)+_0x149385[_0x1954a2(0x127)]+'\x20initial\x20timers\x20for\x20payment\x20'+_0x7e345e);let _0x798d19=0x0;_0x149385['forEach']((_0xbf6e0d,_0x237890)=>{const _0x336e01=_0x1954a2;_0x798d19+=_0xbf6e0d[_0x336e01(0x124)];const _0x566119=setTimeout(async()=>{const _0x115d89=_0x336e01;console['log'](_0x115d89(0x15a)+(_0x237890+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x7e345e+_0x115d89(0xf6)+_0xbf6e0d['description']+')');try{await this[_0x115d89(0x197)](_0x7e345e),console[_0x115d89(0x169)](_0x115d89(0x168)+(_0x237890+0x1)+_0x115d89(0x1c8)+_0x7e345e);}catch(_0x2c5c1d){console[_0x115d89(0x149)](_0x115d89(0x114)+(_0x237890+0x1)+_0x115d89(0x176)+_0x7e345e+':',_0x2c5c1d),this[_0x115d89(0x1b0)](_0x7e345e,_0x4bbe79,_0x2c5c1d,_0x115d89(0x13e),{'checkNumber':_0x237890+0x1,'scheduledAfter':_0xbf6e0d[_0x115d89(0x1a1)],'isIndividualCheck':!![]});}},_0x798d19);_0x22f0f8[_0x336e01(0x13a)](_0x566119),console[_0x336e01(0x169)](_0x336e01(0xf0)+(_0x237890+0x1)+_0x336e01(0x176)+_0x7e345e+_0x336e01(0x12c)+_0x798d19/0x3e8+'\x20seconds\x20('+_0xbf6e0d[_0x336e01(0x1a1)]+')');});const _0x4f476f=setInterval(async()=>{const _0x71f94a=_0x1954a2;console[_0x71f94a(0x169)](_0x71f94a(0x11d)+_0x7e345e);try{const _0xcaa6db=await database_1[_0x71f94a(0x16c)][_0x71f94a(0x11c)]['findUnique']({'where':{'id':_0x7e345e},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0xcaa6db){console[_0x71f94a(0x169)]('❌\x20[HOURLY]\x20Payment\x20'+_0x7e345e+_0x71f94a(0x1ef)),this[_0x71f94a(0x154)](_0x7e345e);return;}console['log'](_0x71f94a(0x15b)+_0x7e345e+_0x71f94a(0x1ca)+_0xcaa6db[_0x71f94a(0x1d5)]);if(_0xcaa6db[_0x71f94a(0x1d5)]!==_0x71f94a(0x10b)){console[_0x71f94a(0x169)](_0x71f94a(0x1cd)+_0x7e345e+_0x71f94a(0x139)+_0xcaa6db[_0x71f94a(0x1d5)]+_0x71f94a(0x117)),this['clearPaymentTimers'](_0x7e345e);return;}const _0x4aafe5=Math[_0x71f94a(0x1b9)]((Date[_0x71f94a(0x16b)]()-_0xcaa6db[_0x71f94a(0xf3)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x4aafe5>=this[_0x71f94a(0x19f)]){console[_0x71f94a(0x169)](_0x71f94a(0x1f4)+_0x7e345e+_0x71f94a(0x12a)+this['EXPIRY_DAYS']+_0x71f94a(0xf4)),this[_0x71f94a(0x154)](_0x7e345e);return;}await this['checkSinglePaymentById'](_0x7e345e),console['log'](_0x71f94a(0x158)+_0x7e345e);}catch(_0x5489df){console[_0x71f94a(0x149)](_0x71f94a(0x104)+_0x7e345e+':',_0x5489df),this['logCoinToPayError'](_0x7e345e,_0x4bbe79,_0x5489df,_0x71f94a(0x13e),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x22f0f8[_0x1954a2(0x13a)](_0x4f476f),this[_0x1954a2(0x11f)]['set'](_0x7e345e,{'timers':_0x22f0f8,'paymentId':_0x7e345e,'gatewayPaymentId':_0x4bbe79,'createdAt':_0x59bfea}),console[_0x1954a2(0x169)](_0x1954a2(0x1bd)+_0x149385[_0x1954a2(0x127)]+_0x1954a2(0x1be)+_0x7e345e),console['log']('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x1954a2(0x11f)]['size']),this['logCoinToPayStatus'](_0x7e345e,_0x4bbe79,_0x1954a2(0x10b),_0x1954a2(0x10b),_0x1954a2(0x13e),{'action':'schedule_created','scheduledChecks':_0x149385['length'],'firstCheckIn':_0x149385[0x0][_0x1954a2(0x124)]/0x3e8,'totalTimers':this[_0x1954a2(0x11f)]['size']});}[a38_0x1356e0(0x154)](_0x5b5294){const _0x5297d8=a38_0x1356e0,_0x2ead40=this[_0x5297d8(0x11f)][_0x5297d8(0x1f1)](_0x5b5294);_0x2ead40?(console['log']('🧹\x20[DEBUG]\x20Clearing\x20'+_0x2ead40[_0x5297d8(0x186)][_0x5297d8(0x127)]+_0x5297d8(0x1f8)+_0x5b5294),_0x2ead40[_0x5297d8(0x186)][_0x5297d8(0x15d)]((_0x50f0d3,_0x4ad7cf)=>{const _0x2d791b=_0x5297d8;_0x50f0d3&&(clearTimeout(_0x50f0d3),clearInterval(_0x50f0d3),console['log'](_0x2d791b(0x106)+(_0x4ad7cf+0x1)+_0x2d791b(0x176)+_0x5b5294));}),this[_0x5297d8(0x11f)][_0x5297d8(0x199)](_0x5b5294),console[_0x5297d8(0x169)](_0x5297d8(0x14a)+_0x5b5294+'.\x20Remaining\x20active\x20timers:\x20'+this[_0x5297d8(0x11f)][_0x5297d8(0x121)])):console['log'](_0x5297d8(0x193)+_0x5b5294+_0x5297d8(0x19b));}async[a38_0x1356e0(0x197)](_0x389d1c){const _0x5608d6=a38_0x1356e0;console[_0x5608d6(0x169)](_0x5608d6(0x10e)+_0x389d1c);const _0xf5584a=await database_1[_0x5608d6(0x16c)]['payment'][_0x5608d6(0x13f)]({'where':{'id':_0x389d1c},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xf5584a){console['log'](_0x5608d6(0x179)+_0x389d1c+'\x20not\x20found\x20in\x20database');return;}console[_0x5608d6(0x169)](_0x5608d6(0x184)+_0x389d1c+_0x5608d6(0x1c1)),console['log'](_0x5608d6(0x1f3)+_0xf5584a[_0x5608d6(0x1de)]),console['log'](_0x5608d6(0x164)+_0xf5584a[_0x5608d6(0x1d5)]),console['log'](_0x5608d6(0x141)+_0xf5584a[_0x5608d6(0x162)]),console[_0x5608d6(0x169)]('\x20\x20\x20-\x20Amount:\x20'+_0xf5584a[_0x5608d6(0x144)]+'\x20'+_0xf5584a['currency']),console[_0x5608d6(0x169)]('\x20\x20\x20-\x20ShopId:\x20'+_0xf5584a[_0x5608d6(0x1b1)]);if(_0xf5584a[_0x5608d6(0x1de)]!=='cointopay'&&_0xf5584a['gateway']!=='cointopay2'){console['log'](_0x5608d6(0x1af)+_0x389d1c+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0xf5584a[_0x5608d6(0x1de)]+')');return;}if(_0xf5584a[_0x5608d6(0x1d5)]!==_0x5608d6(0x10b)){console[_0x5608d6(0x169)](_0x5608d6(0x1af)+_0x389d1c+'\x20status\x20is\x20'+_0xf5584a[_0x5608d6(0x1d5)]+',\x20stopping\x20individual\x20checks'),this[_0x5608d6(0x154)](_0x389d1c);return;}if(!_0xf5584a['gatewayPaymentId']){console['log'](_0x5608d6(0x1af)+_0x389d1c+_0x5608d6(0x1ad));return;}console[_0x5608d6(0x169)](_0x5608d6(0x196)+_0x389d1c+_0x5608d6(0x1ae)),await this['checkSinglePayment'](_0xf5584a);}['logCoinToPayStatus'](_0x34bf39,_0x385964,_0x38dc61,_0xd206fa,_0x5498c1,_0x4c17dd){const _0x4e532f=a38_0x1356e0,_0x18c7a5={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x34bf39,'gatewayPaymentId':_0x385964,'oldStatus':_0x38dc61,'newStatus':_0xd206fa,'source':_0x5498c1,'timestamp':new Date()['toISOString'](),'details':_0x4c17dd||{}};loggerService_1[_0x4e532f(0x115)]['logCoinToPayStatus'](_0x18c7a5),console[_0x4e532f(0x169)](_0x4e532f(0x1c4)+_0x34bf39+'\x20('+_0x385964+')'),console[_0x4e532f(0x169)](_0x4e532f(0x17a)+_0x38dc61+'\x20->\x20'+_0xd206fa),console['log'](_0x4e532f(0xf8)+_0x5498c1),console['log'](_0x4e532f(0x18e)+_0x18c7a5['timestamp']),_0x4c17dd&&console[_0x4e532f(0x169)](_0x4e532f(0x16e),_0x4c17dd);}[a38_0x1356e0(0x1b0)](_0x212eab,_0x402cd2,_0x25e35c,_0x30c148,_0x5a9d41){const _0x32ec42=a38_0x1356e0,_0x3ab0ab={'type':'COINTOPAY_ERROR','paymentId':_0x212eab,'gatewayPaymentId':_0x402cd2,'error':_0x25e35c instanceof Error?{'message':_0x25e35c[_0x32ec42(0xfa)],'stack':_0x25e35c[_0x32ec42(0x19e)]}:_0x25e35c,'source':_0x30c148,'timestamp':new Date()['toISOString'](),'context':_0x5a9d41||{}};loggerService_1[_0x32ec42(0x115)][_0x32ec42(0x1b0)](_0x3ab0ab),console[_0x32ec42(0x149)]('🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x212eab+'\x20('+_0x402cd2+')'),console['error'](_0x32ec42(0x17f)+(_0x25e35c instanceof Error?_0x25e35c[_0x32ec42(0xfa)]:_0x25e35c)),console[_0x32ec42(0x149)](_0x32ec42(0xf8)+_0x30c148),console[_0x32ec42(0x149)]('\x20\x20\x20📅\x20Time:\x20'+_0x3ab0ab['timestamp']),_0x5a9d41&&console[_0x32ec42(0x149)](_0x32ec42(0x1e0),_0x5a9d41);}[a38_0x1356e0(0x1f2)](){const _0x374af3=a38_0x1356e0;console['log'](_0x374af3(0x195)),this[_0x374af3(0x173)]()[_0x374af3(0x13b)](_0x21c798=>{const _0x2d56ee=_0x374af3;console[_0x2d56ee(0x149)](_0x2d56ee(0x13c),_0x21c798);}),this['globalCheckInterval']=setInterval(async()=>{const _0xe72481=_0x374af3;try{console['log'](_0xe72481(0x1eb)),await this[_0xe72481(0x173)](),console[_0xe72481(0x169)](_0xe72481(0x18d));}catch(_0x57ae45){console[_0xe72481(0x149)](_0xe72481(0x129),_0x57ae45);}},this[_0x374af3(0x14c)]),console[_0x374af3(0x169)](_0x374af3(0x188));}[a38_0x1356e0(0x1cc)](){const _0x2a348e=a38_0x1356e0;console['log'](_0x2a348e(0xfe));this[_0x2a348e(0x122)]&&(clearInterval(this[_0x2a348e(0x122)]),this[_0x2a348e(0x122)]=null,console[_0x2a348e(0x169)](_0x2a348e(0x136)));const _0x37b8de=this[_0x2a348e(0x11f)][_0x2a348e(0x121)];for(const [_0x13dd35]of this[_0x2a348e(0x11f)]){this[_0x2a348e(0x154)](_0x13dd35);}console[_0x2a348e(0x169)](_0x2a348e(0x1e2)+_0x37b8de+_0x2a348e(0x146));}async[a38_0x1356e0(0x173)](){const _0x3b85eb=a38_0x1356e0;try{console[_0x3b85eb(0x169)]('🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0xc732ff=await database_1[_0x3b85eb(0x16c)][_0x3b85eb(0x11c)][_0x3b85eb(0x107)]({'where':{'gateway':{'in':[_0x3b85eb(0x171),'cointopay2']},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x3b85eb(0x169)](_0x3b85eb(0x1f0)+_0xc732ff[_0x3b85eb(0x127)]+_0x3b85eb(0x101));if(_0xc732ff[_0x3b85eb(0x127)]===0x0){console['log'](_0x3b85eb(0x126));return;}const _0x4eca95=await this[_0x3b85eb(0x1b4)](_0xc732ff);console[_0x3b85eb(0x169)](_0x3b85eb(0x103)+_0x4eca95[_0x3b85eb(0x127)]+_0x3b85eb(0x1b6));let _0xdf1844=0x0,_0x2731a4=0x0;for(const _0x4f2398 of _0xc732ff){try{if(_0x4eca95[_0x3b85eb(0x105)](_0x4f2398['id'])){console[_0x3b85eb(0x169)](_0x3b85eb(0x1b2)+_0x4f2398['id']+_0x3b85eb(0x1c9)),_0x2731a4++;continue;}if(this[_0x3b85eb(0x11f)][_0x3b85eb(0x172)](_0x4f2398['id'])){console['log'](_0x3b85eb(0x1b2)+_0x4f2398['id']+_0x3b85eb(0x18b)),_0x2731a4++;continue;}const _0x415741=(Date['now']()-_0x4f2398[_0x3b85eb(0xf3)][_0x3b85eb(0x1d0)]())/(0x3e8*0x3c*0x3c);if(_0x415741<0x1){console[_0x3b85eb(0x169)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x4f2398['id']+_0x3b85eb(0x1a4)+_0x415741[_0x3b85eb(0x11a)](0x1)+'h),\x20skipping\x20global\x20check'),_0x2731a4++;continue;}console[_0x3b85eb(0x169)](_0x3b85eb(0x170)+_0x4f2398['id']+_0x3b85eb(0x16d)+_0x415741[_0x3b85eb(0x11a)](0x1)+'h)'),await this[_0x3b85eb(0x143)](_0x4f2398),_0xdf1844++,await new Promise(_0x5e0347=>setTimeout(_0x5e0347,0x7d0));}catch(_0x628205){console[_0x3b85eb(0x149)](_0x3b85eb(0x1a6)+_0x4f2398['id']+':',_0x628205),this[_0x3b85eb(0x1b0)](_0x4f2398['id'],_0x4f2398[_0x3b85eb(0x162)]||_0x3b85eb(0x17e),_0x628205,_0x3b85eb(0x13e),{'isGlobalCheck':!![],'paymentAmount':_0x4f2398[_0x3b85eb(0x144)],'paymentCurrency':_0x4f2398[_0x3b85eb(0x113)],'shopId':_0x4f2398[_0x3b85eb(0x1b1)],'createdAt':_0x4f2398['createdAt']}),loggerService_1[_0x3b85eb(0x115)][_0x3b85eb(0xef)]('cointopay','/status/'+_0x4f2398[_0x3b85eb(0x162)],_0x628205);}}console[_0x3b85eb(0x169)](_0x3b85eb(0x128)+_0xdf1844+_0x3b85eb(0x10c)+_0x2731a4+_0x3b85eb(0x1d3)+_0x4eca95[_0x3b85eb(0x127)]+'\x20expired');}catch(_0x57388e){console[_0x3b85eb(0x149)](_0x3b85eb(0x165),_0x57388e);}}async[a38_0x1356e0(0x1b4)](_0xc36320){const _0x54b91a=a38_0x1356e0,_0x56f07c=[],_0x3221d9=new Date();_0x3221d9['setDate'](_0x3221d9['getDate']()-this[_0x54b91a(0x19f)]),console['log'](_0x54b91a(0x19a)+this[_0x54b91a(0x19f)]+_0x54b91a(0x166)+_0x3221d9[_0x54b91a(0x189)]()+')');for(const _0x19a5a8 of _0xc36320){if(_0x19a5a8['createdAt']<_0x3221d9){console[_0x54b91a(0x169)](_0x54b91a(0x1fb)+_0x19a5a8['id']+_0x54b91a(0x12a)+this[_0x54b91a(0x19f)]+_0x54b91a(0x1b3));try{this['logCoinToPayStatus'](_0x19a5a8['id'],_0x19a5a8['gatewayPaymentId']||_0x54b91a(0x17e),'PENDING',_0x54b91a(0x118),_0x54b91a(0x1e3),{'reason':_0x54b91a(0x156)+this[_0x54b91a(0x19f)]+_0x54b91a(0x1e9),'createdAt':_0x19a5a8['createdAt'],'daysSinceCreation':Math[_0x54b91a(0x1b9)]((Date[_0x54b91a(0x16b)]()-_0x19a5a8[_0x54b91a(0xf3)]['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x19a5a8['amount'],'paymentCurrency':_0x19a5a8[_0x54b91a(0x113)],'shopId':_0x19a5a8[_0x54b91a(0x1b1)]}),await database_1[_0x54b91a(0x16c)][_0x54b91a(0x11c)]['update']({'where':{'id':_0x19a5a8['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':_0x54b91a(0x1db)+this['EXPIRY_DAYS']+_0x54b91a(0x1d2)}}),await database_1['default'][_0x54b91a(0x123)]['create']({'data':{'paymentId':_0x19a5a8['id'],'shopId':_0x19a5a8[_0x54b91a(0x1b1)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x54b91a(0x161)]({'reason':_0x54b91a(0x156)+this[_0x54b91a(0x19f)]+_0x54b91a(0x1e9),'createdAt':_0x19a5a8[_0x54b91a(0xf3)],'expiredAt':new Date()[_0x54b91a(0x189)](),'daysSinceCreation':Math[_0x54b91a(0x1b9)]((Date['now']()-_0x19a5a8[_0x54b91a(0xf3)][_0x54b91a(0x1d0)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x19a5a8,_0x54b91a(0x118)),await this[_0x54b91a(0x119)](_0x19a5a8,'EXPIRED'),this[_0x54b91a(0x154)](_0x19a5a8['id']),_0x56f07c[_0x54b91a(0x13a)](_0x19a5a8['id']),console['log'](_0x54b91a(0x190)+_0x19a5a8['id']+_0x54b91a(0x1a2)+this[_0x54b91a(0x19f)]+_0x54b91a(0x1e8));}catch(_0x22d4e7){console[_0x54b91a(0x149)](_0x54b91a(0x1c6)+_0x19a5a8['id']+':',_0x22d4e7),this[_0x54b91a(0x1b0)](_0x19a5a8['id'],_0x19a5a8['gatewayPaymentId']||'unknown',_0x22d4e7,'auto_expire',{'reason':_0x54b91a(0x192),'createdAt':_0x19a5a8['createdAt'],'daysSinceCreation':Math[_0x54b91a(0x1b9)]((Date['now']()-_0x19a5a8[_0x54b91a(0xf3)][_0x54b91a(0x1d0)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x56f07c;}async[a38_0x1356e0(0x143)](_0xd6a5c9){const _0x354190=a38_0x1356e0;if(!_0xd6a5c9[_0x354190(0x162)]){console['log'](_0x354190(0x1af)+_0xd6a5c9['id']+_0x354190(0x11e));return;}console[_0x354190(0x169)](_0x354190(0x16a)+_0xd6a5c9[_0x354190(0x1de)]+_0x354190(0x1f7)+_0xd6a5c9['id']+'\x20('+_0xd6a5c9[_0x354190(0x162)]+')');try{let _0x33cf91;_0xd6a5c9[_0x354190(0x1de)]==='cointopay2'?(_0x33cf91=await this['coinToPay2Service'][_0x354190(0x14f)](_0xd6a5c9[_0x354190(0x162)]),console[_0x354190(0x169)](_0x354190(0x1b5)+_0xd6a5c9['id']+_0x354190(0x1ed)+_0x33cf91[_0x354190(0x1d5)])):(_0x33cf91=await this[_0x354190(0x151)][_0x354190(0x14f)](_0xd6a5c9['gatewayPaymentId']),console[_0x354190(0x169)](_0x354190(0x1d9)+_0xd6a5c9['id']+_0x354190(0x1ed)+_0x33cf91['status']));_0x33cf91[_0x354190(0x1a3)]&&console[_0x354190(0x169)](_0x354190(0x184)+_0xd6a5c9['id']+'\x20details:',{'iban':_0x33cf91[_0x354190(0x1a3)][_0x354190(0x133)]||'not\x20found','transactionId':_0x33cf91['paymentDetails'][_0x354190(0x178)],'createdOn':_0x33cf91[_0x354190(0x1a3)]['createdOn'],'confirmedOn':_0x33cf91[_0x354190(0x1a3)][_0x354190(0x198)]||'not\x20confirmed'});if(_0x33cf91['status']!==_0xd6a5c9[_0x354190(0x1d5)]){console[_0x354190(0x169)](_0x354190(0x1f5)+_0xd6a5c9['id']+_0x354190(0x1fd)+_0xd6a5c9['status']+_0x354190(0x194)+_0x33cf91['status']),this[_0x354190(0x17c)](_0xd6a5c9['id'],_0xd6a5c9[_0x354190(0x162)],_0xd6a5c9[_0x354190(0x1d5)],_0x33cf91[_0x354190(0x1d5)],_0x354190(0x13e),{'paymentDetails':_0x33cf91[_0x354190(0x1a3)],'amount':_0x33cf91[_0x354190(0x144)],'currency':_0x33cf91['currency'],'shopId':_0xd6a5c9[_0x354190(0x1b1)],'checkTimestamp':new Date()['toISOString']()});const _0x36bddb={'status':_0x33cf91['status'],'updatedAt':new Date()};if(_0x33cf91[_0x354190(0x1d5)]===_0x354190(0x120)&&_0xd6a5c9[_0x354190(0x1d5)]!=='PAID'){_0x36bddb[_0x354190(0x1ab)]=new Date();if(!_0xd6a5c9['amountUSDT']){const _0x156d09=await currencyService_1[_0x354190(0x10d)][_0x354190(0x18f)](_0xd6a5c9[_0x354190(0x144)],_0xd6a5c9[_0x354190(0x113)]);_0x36bddb[_0x354190(0x147)]=_0x156d09;const _0xb0d387=await this[_0x354190(0xee)](_0xd6a5c9[_0x354190(0x1b1)],_0xd6a5c9[_0x354190(0x1de)]),_0x32271f=_0x156d09*(0x1-_0xb0d387/0x64);_0x36bddb['amountAfterGatewayCommissionUSDT']=_0x32271f,console[_0x354190(0x169)]('💰\x20[CHECK]\x20Payment\x20'+_0xd6a5c9['id']+'\x20amounts\x20calculated:'),console[_0x354190(0x169)](_0x354190(0x1dd)+_0xd6a5c9[_0x354190(0x144)]+'\x20'+_0xd6a5c9[_0x354190(0x113)]+_0x354190(0x12e)+_0x156d09[_0x354190(0x11a)](0x6)+_0x354190(0x1da)),console[_0x354190(0x169)](_0x354190(0x18c)+_0xd6a5c9[_0x354190(0x1de)]+_0x354190(0x131)+_0xb0d387+'%'),console['log']('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x32271f['toFixed'](0x6)+_0x354190(0x1da));}console[_0x354190(0x169)](_0x354190(0x180)+_0xd6a5c9['id']+_0x354190(0x134)+_0x36bddb[_0x354190(0x1ab)]['toISOString']());}if(_0x33cf91[_0x354190(0x1a3)]){const _0x3bf556=_0x33cf91[_0x354190(0x1a3)];_0x3bf556[_0x354190(0x133)]&&(_0x36bddb[_0x354190(0x1d1)]=_0x3bf556[_0x354190(0x133)],console['log']('🏦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x3bf556[_0x354190(0x133)]));if(_0x3bf556[_0x354190(0x157)]){const _0x283a46=_0xd6a5c9[_0x354190(0x1a8)]||'',_0xbf31e6='Bank\x20Details:\x20'+_0x3bf556['bankDetails'];_0x36bddb['adminNotes']=_0x283a46?_0x283a46+'\x0a\x0a'+_0xbf31e6:_0xbf31e6,console[_0x354190(0x169)](_0x354190(0x1e6));}_0x3bf556[_0x354190(0x178)]&&console[_0x354190(0x169)](_0x354190(0x1c7)+_0x3bf556['transactionId']),_0x3bf556[_0x354190(0x198)]&&console[_0x354190(0x169)]('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x3bf556[_0x354190(0x198)]);}await database_1[_0x354190(0x16c)]['payment'][_0x354190(0x148)]({'where':{'id':_0xd6a5c9['id']},'data':_0x36bddb});if(_0x33cf91['status']===_0x354190(0x120)&&_0xd6a5c9[_0x354190(0x1d5)]!=='PAID'){console[_0x354190(0x169)](_0x354190(0x132)+_0xd6a5c9['id']+_0x354190(0x1d8));const _0x301b14=await database_1[_0x354190(0x16c)]['payment'][_0x354190(0x13f)]({'where':{'id':_0xd6a5c9['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x301b14?.['paymentLinkId']&&_0x301b14[_0x354190(0x155)])try{const _0x42fd62=_0x301b14[_0x354190(0x155)];console[_0x354190(0x169)](_0x354190(0x159)+_0x42fd62['id']+_0x354190(0x1c3)+_0x42fd62[_0x354190(0x10a)]+_0x354190(0x12b)+_0x42fd62[_0x354190(0xff)]+_0x354190(0x163)+_0x42fd62['status']);const _0x1d4a41=_0x42fd62[_0x354190(0xff)]+0x1,_0x513ef9=_0x42fd62[_0x354190(0x10a)]===_0x354190(0x1f6)?'COMPLETED':_0x42fd62[_0x354190(0x1d5)];await database_1[_0x354190(0x16c)][_0x354190(0x155)][_0x354190(0x148)]({'where':{'id':_0x42fd62['id']},'data':{'currentPayments':_0x1d4a41,'status':_0x513ef9,'updatedAt':new Date()}}),console[_0x354190(0x169)](_0x354190(0x177)+_0x42fd62['id']+_0x354190(0x11b)+_0x42fd62[_0x354190(0xff)]+_0x354190(0x12e)+_0x1d4a41+_0x354190(0x163)+_0x42fd62[_0x354190(0x1d5)]+_0x354190(0x12e)+_0x513ef9);}catch(_0x2bfebc){console[_0x354190(0x149)](_0x354190(0x1fc),_0x2bfebc);}else console[_0x354190(0x169)](_0x354190(0x132)+_0xd6a5c9['id']+_0x354190(0x153));}await database_1[_0x354190(0x16c)][_0x354190(0x123)]['create']({'data':{'paymentId':_0xd6a5c9['id'],'shopId':_0xd6a5c9[_0x354190(0x1b1)],'event':'cointopay_status_check_'+_0x33cf91[_0x354190(0x1d5)][_0x354190(0x1f9)](),'statusCode':0xc8,'responseBody':JSON[_0x354190(0x161)]({'oldStatus':_0xd6a5c9['status'],'newStatus':_0x33cf91[_0x354190(0x1d5)],'paymentDetails':_0x33cf91['paymentDetails'],'checkedAt':new Date()['toISOString']()})}}),await this[_0x354190(0x1fa)](_0xd6a5c9,_0x33cf91[_0x354190(0x1d5)]),await this[_0x354190(0x119)](_0xd6a5c9,_0x33cf91[_0x354190(0x1d5)]),_0x33cf91[_0x354190(0x1d5)]!=='PENDING'&&(console[_0x354190(0x169)](_0x354190(0xf2)+_0xd6a5c9['id']+_0x354190(0x16f)+_0x33cf91['status']+_0x354190(0x181)),this[_0x354190(0x154)](_0xd6a5c9['id'])),console[_0x354190(0x169)](_0x354190(0x196)+_0xd6a5c9['id']+_0x354190(0x1ea));}else console[_0x354190(0x169)](_0x354190(0x184)+_0xd6a5c9['id']+_0x354190(0x1cf)+_0x33cf91['status']+')'),this[_0x354190(0x17c)](_0xd6a5c9['id'],_0xd6a5c9['gatewayPaymentId'],_0xd6a5c9['status'],_0x33cf91[_0x354190(0x1d5)],_0x354190(0x13e),{'statusUnchanged':!![],'paymentDetails':_0x33cf91[_0x354190(0x1a3)],'amount':_0x33cf91['amount'],'currency':_0x33cf91[_0x354190(0x113)],'shopId':_0xd6a5c9['shopId'],'checkTimestamp':new Date()[_0x354190(0x189)]()});}catch(_0x1be041){console[_0x354190(0x149)]('❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0xd6a5c9['id']+':',_0x1be041),this[_0x354190(0x1b0)](_0xd6a5c9['id'],_0xd6a5c9['gatewayPaymentId'],_0x1be041,_0x354190(0x13e),{'paymentAmount':_0xd6a5c9[_0x354190(0x144)],'paymentCurrency':_0xd6a5c9['currency'],'shopId':_0xd6a5c9[_0x354190(0x1b1)],'createdAt':_0xd6a5c9[_0x354190(0xf3)]}),await database_1[_0x354190(0x16c)][_0x354190(0x123)][_0x354190(0x10f)]({'data':{'paymentId':_0xd6a5c9['id'],'shopId':_0xd6a5c9[_0x354190(0x1b1)],'event':_0x354190(0x1d4),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x1be041 instanceof Error?_0x1be041[_0x354190(0xfa)]:_0x354190(0x108),'gatewayPaymentId':_0xd6a5c9[_0x354190(0x162)],'checkedAt':new Date()[_0x354190(0x189)]()})}});}}async[a38_0x1356e0(0x1fa)](_0x369762,_0x1d1572){const _0x26d80f=a38_0x1356e0,_0x4dd40c=Date[_0x26d80f(0x16b)]();try{const _0x32b1e2=_0x369762[_0x26d80f(0x14e)],_0x55e14d=_0x32b1e2[_0x26d80f(0x1c2)];if(!_0x55e14d?.['webhookUrl']){console[_0x26d80f(0x169)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x32b1e2['id']);return;}const _0x5b09e7=_0x1d1572===_0x26d80f(0x120)?_0x26d80f(0x142):_0x1d1572===_0x26d80f(0x174)?_0x26d80f(0x1e1):_0x1d1572===_0x26d80f(0x118)?_0x26d80f(0x1e1):_0x26d80f(0x1e4);if(!_0x55e14d[_0x26d80f(0x137)]?.['includes'](_0x5b09e7)){console['log'](_0x26d80f(0x1b7)+_0x5b09e7+'\x20not\x20enabled\x20for\x20shop\x20'+_0x32b1e2['id']);return;}const _0x3195fa=(0x0,gateway_1['getGatewayIdByName'])(_0x369762[_0x26d80f(0x1de)])||_0x369762['gateway'],_0x2f0dd7={'event':_0x5b09e7,'payment':{'id':_0x369762['id'],'order_id':_0x369762[_0x26d80f(0x1ac)],'gateway_order_id':_0x369762[_0x26d80f(0x100)],'gateway':_0x3195fa,'amount':_0x369762['amount'],'currency':_0x369762['currency'],'status':_0x1d1572[_0x26d80f(0x1f9)](),'customer_email':_0x369762['customerEmail'],'customer_name':_0x369762[_0x26d80f(0x138)],'created_at':_0x369762[_0x26d80f(0xf3)],'updated_at':new Date()}},_0x45d0d9=await fetch(_0x55e14d['webhookUrl'],{'method':_0x26d80f(0x1a7),'headers':{'Content-Type':_0x26d80f(0x1e5),'User-Agent':_0x26d80f(0x191)},'body':JSON[_0x26d80f(0x161)](_0x2f0dd7)}),_0x187356=Date[_0x26d80f(0x16b)]()-_0x4dd40c,_0x1ab53c=_0x45d0d9['ok']?'Success':await _0x45d0d9['text']();loggerService_1['loggerService'][_0x26d80f(0x167)](_0x369762[_0x26d80f(0x1b1)],_0x55e14d[_0x26d80f(0x130)],_0x5b09e7,_0x45d0d9['status'],_0x187356,_0x2f0dd7),console['log']('Shop\x20webhook\x20sent\x20to\x20'+_0x55e14d[_0x26d80f(0x130)]+_0x26d80f(0x1ba)+_0x45d0d9['status']+'\x20('+_0x187356+_0x26d80f(0x110));}catch(_0xabca97){console['error'](_0x26d80f(0x1c5),_0xabca97),loggerService_1[_0x26d80f(0x115)]['logShopWebhookError'](_0x369762['shopId'],_0x369762[_0x26d80f(0x14e)]?.[_0x26d80f(0x1c2)]?.['webhookUrl']||'unknown',_0x26d80f(0x183),_0xabca97,{});}}async['sendPaymentStatusNotification'](_0x23f6a8,_0x4444f4){const _0x1d50e7=a38_0x1356e0;try{const _0x5afd1f={'PENDING':_0x1d50e7(0x1df),'PAID':'paid','FAILED':_0x1d50e7(0x152),'EXPIRED':_0x1d50e7(0xf7)},_0x25371f=_0x5afd1f[_0x4444f4];if(!_0x25371f||_0x25371f==='created')return;await telegramBotService_1[_0x1d50e7(0x109)][_0x1d50e7(0x1b8)](_0x23f6a8[_0x1d50e7(0x1b1)],_0x23f6a8,_0x25371f);}catch(_0x45981a){console['error']('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x45981a);}}async['checkPaymentById'](_0x2cba93){const _0x56411a=a38_0x1356e0;console[_0x56411a(0x169)](_0x56411a(0x187)+_0x2cba93);const _0x184b54=await database_1[_0x56411a(0x16c)][_0x56411a(0x11c)][_0x56411a(0x13f)]({'where':{'id':_0x2cba93},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x184b54)throw new Error(_0x56411a(0x1e7));if(_0x184b54[_0x56411a(0x1de)]!==_0x56411a(0x171)&&_0x184b54[_0x56411a(0x1de)]!=='cointopay2')throw new Error(_0x56411a(0x17b));console[_0x56411a(0x169)](_0x56411a(0x1bc)+_0x184b54[_0x56411a(0x1de)]+_0x56411a(0x1f7)+_0x2cba93),await this[_0x56411a(0x143)](_0x184b54),console[_0x56411a(0x169)](_0x56411a(0x1bb)+_0x2cba93);}['getServiceStats'](){const _0x5eef29=a38_0x1356e0,_0x4f6345=this[_0x5eef29(0x122)]?this[_0x5eef29(0x14c)]:undefined,_0x449e80=Array['from'](this[_0x5eef29(0x11f)]['values']())[_0x5eef29(0x1aa)](_0x4e4271=>({'paymentId':_0x4e4271[_0x5eef29(0xf1)],'gatewayPaymentId':_0x4e4271[_0x5eef29(0x162)],'createdAt':_0x4e4271[_0x5eef29(0xf3)],'timersCount':_0x4e4271[_0x5eef29(0x186)][_0x5eef29(0x127)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x5eef29(0x14c)]/(0x3e8*0x3c),'expiryDays':this[_0x5eef29(0x19f)],'activeIndividualTimers':this[_0x5eef29(0x11f)][_0x5eef29(0x121)],'nextGlobalCheckIn':_0x4f6345,'paymentTimersDetails':_0x449e80};}['getPaymentTimerInfo'](_0x571b16){const _0x167b97=a38_0x1356e0,_0x3c3b01=this[_0x167b97(0x11f)]['get'](_0x571b16);if(_0x3c3b01)return{'hasTimers':!![],'timersCount':_0x3c3b01['timers'][_0x167b97(0x127)],'createdAt':_0x3c3b01[_0x167b97(0xf3)],'gatewayPaymentId':_0x3c3b01[_0x167b97(0x162)]};return{'hasTimers':![]};}async[a38_0x1356e0(0xee)](_0x2ec11d,_0xecac91){const _0x3c2735=a38_0x1356e0;try{const _0x57389c=await database_1['default'][_0x3c2735(0x14e)][_0x3c2735(0x13f)]({'where':{'id':_0x2ec11d},'select':{'gatewaySettings':!![]}});if(!_0x57389c?.[_0x3c2735(0x140)])return console['log'](_0x3c2735(0xfd)+_0x2ec11d+_0x3c2735(0x125)),0xa;const _0x10f51c=JSON[_0x3c2735(0x185)](_0x57389c[_0x3c2735(0x140)]);for(const [_0x4d3f85,_0x447e49]of Object[_0x3c2735(0x14d)](_0x10f51c)){if(_0x4d3f85['toLowerCase']()===_0xecac91[_0x3c2735(0x1f9)]()){const _0x41f8cf=_0x447e49[_0x3c2735(0x12d)]||0xa;return console['log'](_0x3c2735(0x1d7)+_0xecac91+_0x3c2735(0x15c)+_0x2ec11d+':\x20'+_0x41f8cf+'%'),_0x41f8cf;}}return console[_0x3c2735(0x169)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0xecac91+_0x3c2735(0x1a9)+_0x2ec11d+_0x3c2735(0x175)),0xa;}catch(_0x1f2f56){return console[_0x3c2735(0x149)](_0x3c2735(0x116)+_0x2ec11d+_0x3c2735(0x1bf)+_0xecac91+':',_0x1f2f56),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a38_0x1356e0(0x18a)]=new CoinToPayStatusService();function a38_0x3909(){const _0x1c8773=['1684638QeSyCX','\x20status\x20unchanged\x20(','getTime','remitterIban','\x20days\x20without\x20payment\x20confirmation','\x20skipped,\x20','cointopay_status_check_error','status','1620832XasaYe','Gateway\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20USDT','Automatically\x20expired\x20after\x20','1040619SbdFEx','\x20\x20\x20Amount:\x20','gateway','created','\x20\x20\x20📝\x20Context:','payment.failed','🛑\x20[SHUTDOWN]\x20Cleared\x20','auto_expire','payment.pending','application/json','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','Payment\x20not\x20found','-day\x20timeout','\x20days','\x20updated\x20successfully','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','🪙\x20[DEBUG]\x20Creating\x20','\x20status:\x20','9778934fdIpRe','\x20not\x20found,\x20clearing\x20timers','🪙\x20[GLOBAL]\x20Found\x20','get','startPeriodicStatusCheck','\x20\x20\x20-\x20Gateway:\x20','⏰\x20[HOURLY]\x20Payment\x20','🔄\x20[CHECK]\x20Updating\x20payment\x20','SINGLE','\x20payment\x20','\x20timers\x20for\x20payment\x20','toLowerCase','sendShopWebhook','⏰\x20[EXPIRY]\x20Payment\x20','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','\x20status\x20from\x20','getGatewayCommission','logWhiteDomainError','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','paymentId','🧹\x20[CHECK]\x20Payment\x20','createdAt','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','../config/database','\x20(after\x20','expired','\x20\x20\x20📍\x20Source:\x20','1\x20minute','message','301446aSwjdv','5\x20minutes','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','currentPayments','gatewayOrderId','\x20pending\x20CoinToPay\x20payments','__importDefault','⏰\x20[GLOBAL]\x20Found\x20','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','includes','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','findMany','Unknown\x20error','telegramBotService','type','PENDING','\x20checked,\x20','currencyService','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','create','ms)','./loggerService','CoinToPayStatusService','currency','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','loggerService','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20',',\x20stopping\x20individual\x20checks','EXPIRED','sendPaymentStatusNotification','toFixed','\x20updated:\x20currentPayments=','payment','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','paymentTimers','PAID','size','globalCheckInterval','webhookLog','delay',',\x20using\x20default\x20commission\x2010%','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','length','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20is\x20older\x20than\x20',',\x20currentPayments=','\x20in\x20','commission','\x20->\x20','coinToPay2Service','webhookUrl','\x20commission:\x20','📈\x20[COINTOPAY]\x20Payment\x20','iban','\x20marked\x20as\x20paid\x20at:\x20','__esModule','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','webhookEvents','customerName','\x20status\x20is\x20','push','catch','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','status_check','findUnique','gatewaySettings','\x20\x20\x20-\x20GatewayPaymentId:\x20','payment.success','checkSinglePayment','amount','../types/gateway','\x20individual\x20payment\x20timers','amountUSDT','update','error','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','20RxEXMd','GLOBAL_CHECK_INTERVAL_MS','entries','shop','checkPaymentStatus','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','coinToPayService','failed','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','clearPaymentTimers','paymentLink','Payment\x20older\x20than\x20','bankDetails','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','🪙\x20[TIMER]\x20Individual\x20check\x20#','📊\x20[HOURLY]\x20Payment\x20','\x20commission\x20for\x20shop\x20','forEach','18314sdKVTQ','\x20\x20\x20-\x20gatewayPaymentId:\x20','./currencyService','stringify','gatewayPaymentId',',\x20status=','\x20\x20\x20-\x20Status:\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20days\x20(created\x20before\x20','logShopWebhookSent','✅\x20[TIMER]\x20Individual\x20check\x20#','log','🔍\x20[CHECK]\x20Checking\x20','now','default','\x20(age:\x20','\x20\x20\x20📝\x20Details:','\x20status\x20changed\x20to\x20','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','cointopay','has','checkAllPendingPayments','FAILED',',\x20using\x20default\x2010%','\x20for\x20payment\x20','✅\x20[COINTOPAY]\x20Payment\x20link\x20','transactionId','❌\x20[CHECK]\x20Payment\x20','\x20\x20\x20📊\x20Status:\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','logCoinToPayStatus','3015490QpwTjp','unknown','\x20\x20\x20❌\x20Error:\x20','💰\x20[CHECK]\x20Payment\x20',',\x20clearing\x20individual\x20timers','7IzPCds','webhook_send','📊\x20[CHECK]\x20Payment\x20','parse','timers','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','toISOString','coinToPayStatusService','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','\x20\x20\x20Gateway\x20','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','\x20\x20\x20📅\x20Time:\x20','convertToUSDT','✅\x20[EXPIRY]\x20Payment\x20','TesSoft\x20Payment\x20System/1.0','Failed\x20to\x20mark\x20payment\x20as\x20expired','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20to\x20','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','✅\x20[CHECK]\x20Payment\x20','checkSinglePaymentById','confirmedOn','delete','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20to\x20clear','./gateways/coinToPayService','CoinToPay2Service','stack','EXPIRY_DAYS','schedulePaymentChecks','description','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','paymentDetails','\x20is\x20too\x20new\x20(','4VLkCsA','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','POST','adminNotes','\x20in\x20shop\x20','map','paidAt','orderId','\x20has\x20no\x20gatewayPaymentId','\x20is\x20valid\x20for\x20checking,\x20proceeding...','⚠️\x20[CHECK]\x20Payment\x20','logCoinToPayError','shopId','⏰\x20[GLOBAL]\x20Payment\x20','\x20days,\x20marking\x20as\x20EXPIRED','checkExpiredPayments','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20expired\x20CoinToPay\x20payments','Webhook\x20event\x20','sendPaymentNotification','floor','\x20with\x20status\x20','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20',',\x20gateway\x20','./gateways/coinToPay2Service','\x20found:','settings',':\x20type=','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','Failed\x20to\x20send\x20shop\x20webhook:','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','\x20completed\x20for\x20payment\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','\x20current\x20status:\x20','45hgwWjE','stopPeriodicStatusCheck','✅\x20[HOURLY]\x20Payment\x20'];a38_0x3909=function(){return _0x1c8773;};return a38_0x3909();}