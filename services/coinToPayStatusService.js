'use strict';const a57_0x320e34=a57_0x33d4;(function(_0x9ba69,_0x18f570){const _0x595319=a57_0x33d4,_0x3501ed=_0x9ba69();while(!![]){try{const _0x2add23=parseInt(_0x595319(0x1e7))/0x1*(parseInt(_0x595319(0x12a))/0x2)+parseInt(_0x595319(0x1b9))/0x3+-parseInt(_0x595319(0x1cd))/0x4+parseInt(_0x595319(0x1a7))/0x5*(-parseInt(_0x595319(0x10c))/0x6)+parseInt(_0x595319(0x1b8))/0x7+parseInt(_0x595319(0x165))/0x8*(parseInt(_0x595319(0x212))/0x9)+parseInt(_0x595319(0x1a6))/0xa*(-parseInt(_0x595319(0x128))/0xb);if(_0x2add23===_0x18f570)break;else _0x3501ed['push'](_0x3501ed['shift']());}catch(_0x486722){_0x3501ed['push'](_0x3501ed['shift']());}}}(a57_0x370d,0x3fd85));var __importDefault=this&&this[a57_0x320e34(0x137)]||function(_0x36340d){const _0x2f24d9=a57_0x320e34;return _0x36340d&&_0x36340d[_0x2f24d9(0x209)]?_0x36340d:{'default':_0x36340d};};Object[a57_0x320e34(0x197)](exports,a57_0x320e34(0x209),{'value':!![]}),exports[a57_0x320e34(0x1de)]=exports[a57_0x320e34(0x20b)]=void 0x0;const crypto_1=__importDefault(require(a57_0x320e34(0x155))),coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a57_0x320e34(0x145)),gateway_1=require(a57_0x320e34(0x214)),database_1=__importDefault(require(a57_0x320e34(0x1bb))),telegramBotService_1=require(a57_0x320e34(0x201)),loggerService_1=require(a57_0x320e34(0x1f9)),currencyService_1=require(a57_0x320e34(0x156));class CoinToPayStatusService{constructor(){const _0xf88e5e=a57_0x320e34;this['globalCheckInterval']=null,this[_0xf88e5e(0x13a)]=0x3c*0x3c*0x3e8,this[_0xf88e5e(0x12c)]=0x5,this[_0xf88e5e(0x199)]=new Map(),this[_0xf88e5e(0x174)]=new coinToPayService_1['CoinToPayService'](),this[_0xf88e5e(0x16e)]=new coinToPay2Service_1[(_0xf88e5e(0x20f))](),console[_0xf88e5e(0x1fc)]('ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a57_0x320e34(0x10b)](_0x3e2c4f,_0x49842a){const _0x4ac92d=a57_0x320e34;console['log'](_0x4ac92d(0x19e)),console['log'](_0x4ac92d(0x1fd)+_0x3e2c4f),console[_0x4ac92d(0x1fc)]('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x49842a),this[_0x4ac92d(0x1d4)](_0x3e2c4f);const _0x4fe75b=[],_0x78fbad=new Date(),_0x3b1eb2=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x4ac92d(0x1ee)},{'delay':0x5*0x3c*0x3e8,'description':_0x4ac92d(0x1c1)},{'delay':0x5*0x3c*0x3e8,'description':_0x4ac92d(0x1c1)}];console[_0x4ac92d(0x1fc)](_0x4ac92d(0x1dc)+_0x3b1eb2['length']+'\x20initial\x20timers\x20for\x20payment\x20'+_0x3e2c4f);let _0x1dd880=0x0;_0x3b1eb2[_0x4ac92d(0x19a)]((_0x3dfd2e,_0x4da72a)=>{const _0x3deb20=_0x4ac92d;_0x1dd880+=_0x3dfd2e[_0x3deb20(0x191)];const _0x130093=setTimeout(async()=>{const _0x23c829=_0x3deb20;console[_0x23c829(0x1fc)](_0x23c829(0x1f8)+(_0x4da72a+0x1)+_0x23c829(0x1ec)+_0x3e2c4f+_0x23c829(0x178)+_0x3dfd2e[_0x23c829(0x1cc)]+')');try{await this[_0x23c829(0x163)](_0x3e2c4f),console[_0x23c829(0x1fc)](_0x23c829(0x1f0)+(_0x4da72a+0x1)+_0x23c829(0x167)+_0x3e2c4f);}catch(_0x2c6c25){console['error'](_0x23c829(0x16f)+(_0x4da72a+0x1)+'\x20for\x20payment\x20'+_0x3e2c4f+':',_0x2c6c25),this['logCoinToPayError'](_0x3e2c4f,_0x49842a,_0x2c6c25,_0x23c829(0x1d3),{'checkNumber':_0x4da72a+0x1,'scheduledAfter':_0x3dfd2e[_0x23c829(0x1cc)],'isIndividualCheck':!![]});}},_0x1dd880);_0x4fe75b['push'](_0x130093),console[_0x3deb20(0x1fc)](_0x3deb20(0x1af)+(_0x4da72a+0x1)+_0x3deb20(0x1a5)+_0x3e2c4f+_0x3deb20(0x206)+_0x1dd880/0x3e8+_0x3deb20(0x146)+_0x3dfd2e[_0x3deb20(0x1cc)]+')');});const _0x3fa9c5=setInterval(async()=>{const _0x47ec89=_0x4ac92d;console['log'](_0x47ec89(0x1c9)+_0x3e2c4f);try{const _0x46d3a6=await database_1[_0x47ec89(0x14a)]['payment'][_0x47ec89(0x1b2)]({'where':{'id':_0x3e2c4f},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x46d3a6){console['log']('‚ùå\x20[HOURLY]\x20Payment\x20'+_0x3e2c4f+_0x47ec89(0x130)),this[_0x47ec89(0x1d4)](_0x3e2c4f);return;}console[_0x47ec89(0x1fc)](_0x47ec89(0x121)+_0x3e2c4f+'\x20current\x20status:\x20'+_0x46d3a6['status']);if(_0x46d3a6[_0x47ec89(0x126)]!==_0x47ec89(0x18e)){console[_0x47ec89(0x1fc)](_0x47ec89(0x180)+_0x3e2c4f+_0x47ec89(0x1b6)+_0x46d3a6['status']+',\x20stopping\x20individual\x20checks'),this[_0x47ec89(0x1d4)](_0x3e2c4f);return;}const _0x34570a=Math[_0x47ec89(0x1a1)]((Date['now']()-_0x46d3a6[_0x47ec89(0x190)][_0x47ec89(0x192)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x34570a>=this[_0x47ec89(0x12c)]){console[_0x47ec89(0x1fc)]('‚è∞\x20[HOURLY]\x20Payment\x20'+_0x3e2c4f+'\x20is\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x47ec89(0x13e)),this['clearPaymentTimers'](_0x3e2c4f);return;}await this[_0x47ec89(0x163)](_0x3e2c4f),console[_0x47ec89(0x1fc)](_0x47ec89(0x103)+_0x3e2c4f);}catch(_0x118bc7){console[_0x47ec89(0x14b)](_0x47ec89(0x1c6)+_0x3e2c4f+':',_0x118bc7),this[_0x47ec89(0x10e)](_0x3e2c4f,_0x49842a,_0x118bc7,_0x47ec89(0x1d3),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x4fe75b['push'](_0x3fa9c5),this['paymentTimers']['set'](_0x3e2c4f,{'timers':_0x4fe75b,'paymentId':_0x3e2c4f,'gatewayPaymentId':_0x49842a,'createdAt':_0x78fbad}),console[_0x4ac92d(0x1fc)](_0x4ac92d(0x185)+_0x3b1eb2[_0x4ac92d(0x18d)]+_0x4ac92d(0x176)+_0x3e2c4f),console[_0x4ac92d(0x1fc)]('üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this['paymentTimers']['size']),this[_0x4ac92d(0x20a)](_0x3e2c4f,_0x49842a,_0x4ac92d(0x18e),_0x4ac92d(0x18e),_0x4ac92d(0x1d3),{'action':_0x4ac92d(0x1d7),'scheduledChecks':_0x3b1eb2['length'],'firstCheckIn':_0x3b1eb2[0x0]['delay']/0x3e8,'totalTimers':this['paymentTimers']['size']});}[a57_0x320e34(0x1d4)](_0x232523){const _0x54457c=a57_0x320e34,_0x44511d=this['paymentTimers'][_0x54457c(0x1c8)](_0x232523);_0x44511d?(console[_0x54457c(0x1fc)](_0x54457c(0x16b)+_0x44511d[_0x54457c(0x1cb)]['length']+_0x54457c(0x182)+_0x232523),_0x44511d[_0x54457c(0x1cb)][_0x54457c(0x19a)]((_0x231b3c,_0x202df4)=>{const _0xb5c2dc=_0x54457c;_0x231b3c&&(clearTimeout(_0x231b3c),clearInterval(_0x231b3c),console['log'](_0xb5c2dc(0x186)+(_0x202df4+0x1)+_0xb5c2dc(0x1a5)+_0x232523));}),this[_0x54457c(0x199)][_0x54457c(0x127)](_0x232523),console[_0x54457c(0x1fc)](_0x54457c(0x114)+_0x232523+'.\x20Remaining\x20active\x20timers:\x20'+this['paymentTimers'][_0x54457c(0x152)])):console[_0x54457c(0x1fc)](_0x54457c(0x10f)+_0x232523+'\x20to\x20clear');}async['checkSinglePaymentById'](_0x4519ea){const _0x3672fd=a57_0x320e34;console['log'](_0x3672fd(0x1e6)+_0x4519ea);const _0x2e2fdb=await database_1[_0x3672fd(0x14a)]['payment'][_0x3672fd(0x1b2)]({'where':{'id':_0x4519ea},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2e2fdb){console[_0x3672fd(0x1fc)](_0x3672fd(0x104)+_0x4519ea+'\x20not\x20found\x20in\x20database');return;}console['log']('üìä\x20[CHECK]\x20Payment\x20'+_0x4519ea+_0x3672fd(0x143)),console[_0x3672fd(0x1fc)]('\x20\x20\x20-\x20Gateway:\x20'+_0x2e2fdb[_0x3672fd(0x142)]),console[_0x3672fd(0x1fc)]('\x20\x20\x20-\x20Status:\x20'+_0x2e2fdb[_0x3672fd(0x126)]),console['log']('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x2e2fdb[_0x3672fd(0x1d8)]),console[_0x3672fd(0x1fc)](_0x3672fd(0x11b)+_0x2e2fdb[_0x3672fd(0x112)]+'\x20'+_0x2e2fdb['currency']),console['log'](_0x3672fd(0x125)+_0x2e2fdb[_0x3672fd(0x140)]);if(_0x2e2fdb[_0x3672fd(0x142)]!==_0x3672fd(0x1e5)&&_0x2e2fdb[_0x3672fd(0x142)]!=='cointopay2'){console[_0x3672fd(0x1fc)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x4519ea+_0x3672fd(0x134)+_0x2e2fdb[_0x3672fd(0x142)]+')');return;}if(_0x2e2fdb['status']!=='PENDING'){console[_0x3672fd(0x1fc)](_0x3672fd(0x135)+_0x4519ea+_0x3672fd(0x1b6)+_0x2e2fdb[_0x3672fd(0x126)]+_0x3672fd(0x1c3)),this['clearPaymentTimers'](_0x4519ea);return;}if(!_0x2e2fdb[_0x3672fd(0x1d8)]){console[_0x3672fd(0x1fc)](_0x3672fd(0x135)+_0x4519ea+_0x3672fd(0x195));return;}console[_0x3672fd(0x1fc)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x4519ea+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this['checkSinglePayment'](_0x2e2fdb);}[a57_0x320e34(0x20a)](_0x47775e,_0x1762da,_0x194ca3,_0x2aed3c,_0x578c5b,_0x89d537){const _0x51528d=a57_0x320e34,_0x22958a={'type':_0x51528d(0x183),'paymentId':_0x47775e,'gatewayPaymentId':_0x1762da,'oldStatus':_0x194ca3,'newStatus':_0x2aed3c,'source':_0x578c5b,'timestamp':new Date()['toISOString'](),'details':_0x89d537||{}};loggerService_1[_0x51528d(0x1e2)][_0x51528d(0x20a)](_0x22958a),console['log'](_0x51528d(0x10a)+_0x47775e+'\x20('+_0x1762da+')'),console[_0x51528d(0x1fc)](_0x51528d(0x1f2)+_0x194ca3+_0x51528d(0x166)+_0x2aed3c),console['log'](_0x51528d(0x1c5)+_0x578c5b),console[_0x51528d(0x1fc)](_0x51528d(0x138)+_0x22958a[_0x51528d(0x1f7)]),_0x89d537&&console['log'](_0x51528d(0x175),_0x89d537);}[a57_0x320e34(0x10e)](_0x1bc4dc,_0x3b2c52,_0x2ba421,_0x4935a2,_0x45ccbc){const _0x26187a=a57_0x320e34,_0x5d7036={'type':_0x26187a(0x188),'paymentId':_0x1bc4dc,'gatewayPaymentId':_0x3b2c52,'error':_0x2ba421 instanceof Error?{'message':_0x2ba421['message'],'stack':_0x2ba421[_0x26187a(0x17b)]}:_0x2ba421,'source':_0x4935a2,'timestamp':new Date()['toISOString'](),'context':_0x45ccbc||{}};loggerService_1['loggerService']['logCoinToPayError'](_0x5d7036),console[_0x26187a(0x14b)](_0x26187a(0x14d)+_0x1bc4dc+'\x20('+_0x3b2c52+')'),console['error'](_0x26187a(0x1a3)+(_0x2ba421 instanceof Error?_0x2ba421[_0x26187a(0x153)]:_0x2ba421)),console[_0x26187a(0x14b)](_0x26187a(0x1c5)+_0x4935a2),console[_0x26187a(0x14b)](_0x26187a(0x138)+_0x5d7036[_0x26187a(0x1f7)]),_0x45ccbc&&console[_0x26187a(0x14b)](_0x26187a(0x19b),_0x45ccbc);}[a57_0x320e34(0x149)](){const _0x4b7ceb=a57_0x320e34;console[_0x4b7ceb(0x1fc)]('ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0x4b7ceb(0x1e0)]()[_0x4b7ceb(0x1a9)](_0x81ce75=>{const _0x445fea=_0x4b7ceb;console[_0x445fea(0x14b)]('‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x81ce75);}),this[_0x4b7ceb(0x1f3)]=setInterval(async()=>{const _0x3b73dd=_0x4b7ceb;try{console['log'](_0x3b73dd(0x173)),await this['checkAllPendingPayments'](),console['log'](_0x3b73dd(0x1c0));}catch(_0x24915d){console[_0x3b73dd(0x14b)](_0x3b73dd(0x187),_0x24915d);}},this[_0x4b7ceb(0x13a)]),console[_0x4b7ceb(0x1fc)](_0x4b7ceb(0x12e));}[a57_0x320e34(0x113)](){const _0x4aed88=a57_0x320e34;console[_0x4aed88(0x1fc)](_0x4aed88(0x1c4));this[_0x4aed88(0x1f3)]&&(clearInterval(this['globalCheckInterval']),this[_0x4aed88(0x1f3)]=null,console[_0x4aed88(0x1fc)]('üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x43a268=this[_0x4aed88(0x199)][_0x4aed88(0x152)];for(const [_0x350eb6]of this[_0x4aed88(0x199)]){this[_0x4aed88(0x1d4)](_0x350eb6);}console['log']('üõë\x20[SHUTDOWN]\x20Cleared\x20'+_0x43a268+_0x4aed88(0x1dd));}async[a57_0x320e34(0x1e0)](){const _0x1c1ada=a57_0x320e34;try{console[_0x1c1ada(0x1fc)](_0x1c1ada(0x161));const _0x361752=await database_1[_0x1c1ada(0x14a)][_0x1c1ada(0x218)][_0x1c1ada(0x11f)]({'where':{'gateway':{'in':[_0x1c1ada(0x1e5),_0x1c1ada(0x1ba)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x1c1ada(0x1fc)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x361752[_0x1c1ada(0x18d)]+'\x20pending\x20CoinToPay\x20payments');if(_0x361752['length']===0x0){console[_0x1c1ada(0x1fc)]('ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x327b79=await this['checkExpiredPayments'](_0x361752);console['log'](_0x1c1ada(0x119)+_0x327b79[_0x1c1ada(0x18d)]+'\x20expired\x20CoinToPay\x20payments');let _0x9118c8=0x0,_0x46e40b=0x0;for(const _0x5d1b10 of _0x361752){try{if(_0x327b79[_0x1c1ada(0x19c)](_0x5d1b10['id'])){console[_0x1c1ada(0x1fc)](_0x1c1ada(0x219)+_0x5d1b10['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x46e40b++;continue;}if(this[_0x1c1ada(0x199)]['has'](_0x5d1b10['id'])){console[_0x1c1ada(0x1fc)](_0x1c1ada(0x219)+_0x5d1b10['id']+_0x1c1ada(0x162)),_0x46e40b++;continue;}const _0x204e94=(Date[_0x1c1ada(0x164)]()-_0x5d1b10[_0x1c1ada(0x190)][_0x1c1ada(0x192)]())/(0x3e8*0x3c*0x3c);if(_0x204e94<0x1){console[_0x1c1ada(0x1fc)](_0x1c1ada(0x219)+_0x5d1b10['id']+_0x1c1ada(0x1e3)+_0x204e94['toFixed'](0x1)+_0x1c1ada(0x205)),_0x46e40b++;continue;}console['log'](_0x1c1ada(0x1d2)+_0x5d1b10['id']+_0x1c1ada(0x1e8)+_0x204e94['toFixed'](0x1)+'h)'),await this[_0x1c1ada(0x1b0)](_0x5d1b10),_0x9118c8++,await new Promise(_0x23698d=>setTimeout(_0x23698d,0x7d0));}catch(_0x20ce32){console['error'](_0x1c1ada(0x1bc)+_0x5d1b10['id']+':',_0x20ce32),this[_0x1c1ada(0x10e)](_0x5d1b10['id'],_0x5d1b10[_0x1c1ada(0x1d8)]||_0x1c1ada(0x20d),_0x20ce32,_0x1c1ada(0x1d3),{'isGlobalCheck':!![],'paymentAmount':_0x5d1b10[_0x1c1ada(0x112)],'paymentCurrency':_0x5d1b10['currency'],'shopId':_0x5d1b10[_0x1c1ada(0x140)],'createdAt':_0x5d1b10[_0x1c1ada(0x190)]}),loggerService_1[_0x1c1ada(0x1e2)][_0x1c1ada(0x1d6)](_0x1c1ada(0x1e5),_0x1c1ada(0x1b1)+_0x5d1b10[_0x1c1ada(0x1d8)],_0x20ce32);}}console['log'](_0x1c1ada(0x122)+_0x9118c8+'\x20checked,\x20'+_0x46e40b+_0x1c1ada(0x14c)+_0x327b79[_0x1c1ada(0x18d)]+_0x1c1ada(0x108));}catch(_0x3b856f){console[_0x1c1ada(0x14b)](_0x1c1ada(0x18f),_0x3b856f);}}async[a57_0x320e34(0x1f4)](_0x2bf139){const _0x2c68b3=a57_0x320e34,_0x146536=[],_0x47788e=new Date();_0x47788e['setDate'](_0x47788e[_0x2c68b3(0x1b5)]()-this['EXPIRY_DAYS']),console[_0x2c68b3(0x1fc)](_0x2c68b3(0x1ad)+this[_0x2c68b3(0x12c)]+_0x2c68b3(0x18b)+_0x47788e[_0x2c68b3(0x17f)]()+')');for(const _0x290bf5 of _0x2bf139){if(_0x290bf5[_0x2c68b3(0x190)]<_0x47788e){console['log'](_0x2c68b3(0x1ce)+_0x290bf5['id']+_0x2c68b3(0x1da)+this[_0x2c68b3(0x12c)]+_0x2c68b3(0x129));try{this[_0x2c68b3(0x20a)](_0x290bf5['id'],_0x290bf5['gatewayPaymentId']||_0x2c68b3(0x20d),_0x2c68b3(0x18e),'EXPIRED',_0x2c68b3(0x18c),{'reason':_0x2c68b3(0x13d)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x290bf5['createdAt'],'daysSinceCreation':Math[_0x2c68b3(0x1a1)]((Date[_0x2c68b3(0x164)]()-_0x290bf5[_0x2c68b3(0x190)][_0x2c68b3(0x192)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x290bf5[_0x2c68b3(0x112)],'paymentCurrency':_0x290bf5[_0x2c68b3(0x1f5)],'shopId':_0x290bf5[_0x2c68b3(0x140)]}),await database_1[_0x2c68b3(0x14a)][_0x2c68b3(0x218)][_0x2c68b3(0x1e9)]({'where':{'id':_0x290bf5['id']},'data':{'status':'EXPIRED','updatedAt':new Date()}}),await database_1['default'][_0x2c68b3(0x15f)][_0x2c68b3(0x194)]({'data':{'paymentId':_0x290bf5['id'],'shopId':_0x290bf5[_0x2c68b3(0x140)],'event':_0x2c68b3(0x21c),'statusCode':0xc8,'responseBody':JSON[_0x2c68b3(0x158)]({'reason':_0x2c68b3(0x13d)+this['EXPIRY_DAYS']+_0x2c68b3(0x215),'createdAt':_0x290bf5['createdAt'],'expiredAt':new Date()[_0x2c68b3(0x17f)](),'daysSinceCreation':Math[_0x2c68b3(0x1a1)]((Date['now']()-_0x290bf5[_0x2c68b3(0x190)][_0x2c68b3(0x192)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x2c68b3(0x17c)](_0x290bf5,_0x2c68b3(0x1ac)),await this['sendPaymentStatusNotification'](_0x290bf5,'EXPIRED'),this[_0x2c68b3(0x1d4)](_0x290bf5['id']),_0x146536[_0x2c68b3(0x1f6)](_0x290bf5['id']),console[_0x2c68b3(0x1fc)](_0x2c68b3(0x144)+_0x290bf5['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x2c68b3(0x12c)]+'-day\x20timeout');}catch(_0xf347ab){console[_0x2c68b3(0x14b)]('‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x290bf5['id']+':',_0xf347ab),this['logCoinToPayError'](_0x290bf5['id'],_0x290bf5[_0x2c68b3(0x1d8)]||_0x2c68b3(0x20d),_0xf347ab,_0x2c68b3(0x18c),{'reason':_0x2c68b3(0x132),'createdAt':_0x290bf5[_0x2c68b3(0x190)],'daysSinceCreation':Math['floor']((Date[_0x2c68b3(0x164)]()-_0x290bf5[_0x2c68b3(0x190)][_0x2c68b3(0x192)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x146536;}async[a57_0x320e34(0x1b0)](_0x2c8da5){const _0x2fb406=a57_0x320e34;if(!_0x2c8da5[_0x2fb406(0x1d8)]){console[_0x2fb406(0x1fc)](_0x2fb406(0x135)+_0x2c8da5['id']+_0x2fb406(0x1b7));return;}console['log'](_0x2fb406(0x1ea)+_0x2c8da5[_0x2fb406(0x142)]+'\x20payment\x20'+_0x2c8da5['id']+'\x20('+_0x2c8da5['gatewayPaymentId']+')');try{let _0x4bd58d;_0x2c8da5['gateway']===_0x2fb406(0x1ba)?(_0x4bd58d=await this[_0x2fb406(0x16e)][_0x2fb406(0x115)](_0x2c8da5[_0x2fb406(0x1d8)]),console[_0x2fb406(0x1fc)](_0x2fb406(0x12b)+_0x2c8da5['id']+'\x20status:\x20'+_0x4bd58d[_0x2fb406(0x126)])):(_0x4bd58d=await this[_0x2fb406(0x174)][_0x2fb406(0x115)](_0x2c8da5[_0x2fb406(0x1d8)]),console[_0x2fb406(0x1fc)](_0x2fb406(0x1aa)+_0x2c8da5['id']+_0x2fb406(0x1bd)+_0x4bd58d[_0x2fb406(0x126)]));_0x4bd58d['paymentDetails']&&console[_0x2fb406(0x1fc)](_0x2fb406(0x13b)+_0x2c8da5['id']+_0x2fb406(0x124),{'iban':_0x4bd58d[_0x2fb406(0x1bf)][_0x2fb406(0x1c7)]||_0x2fb406(0x154),'transactionId':_0x4bd58d[_0x2fb406(0x1bf)]['transactionId'],'createdOn':_0x4bd58d['paymentDetails']['createdOn'],'confirmedOn':_0x4bd58d['paymentDetails'][_0x2fb406(0x102)]||_0x2fb406(0x1b3)});if(_0x4bd58d[_0x2fb406(0x126)]!==_0x2c8da5[_0x2fb406(0x126)]){console[_0x2fb406(0x1fc)](_0x2fb406(0x18a)+_0x2c8da5['id']+_0x2fb406(0x170)+_0x2c8da5['status']+_0x2fb406(0x196)+_0x4bd58d[_0x2fb406(0x126)]),this[_0x2fb406(0x20a)](_0x2c8da5['id'],_0x2c8da5['gatewayPaymentId'],_0x2c8da5[_0x2fb406(0x126)],_0x4bd58d['status'],_0x2fb406(0x1d3),{'paymentDetails':_0x4bd58d['paymentDetails'],'amount':_0x4bd58d[_0x2fb406(0x112)],'currency':_0x4bd58d[_0x2fb406(0x1f5)],'shopId':_0x2c8da5['shopId'],'checkTimestamp':new Date()[_0x2fb406(0x17f)]()});const _0x7f10f3={'status':_0x4bd58d[_0x2fb406(0x126)],'updatedAt':new Date()};if(_0x4bd58d[_0x2fb406(0x126)]===_0x2fb406(0x106)&&_0x2c8da5['status']!==_0x2fb406(0x106)){_0x7f10f3['paidAt']=new Date();if(!_0x2c8da5[_0x2fb406(0x12f)]){const _0x564c5d=await currencyService_1['currencyService'][_0x2fb406(0x147)](_0x2c8da5['amount'],_0x2c8da5[_0x2fb406(0x1f5)]);_0x7f10f3[_0x2fb406(0x12f)]=_0x564c5d;const _0x31d8c7=await this['getGatewayCommission'](_0x2c8da5[_0x2fb406(0x140)],_0x2c8da5[_0x2fb406(0x142)]),_0x193e2b=_0x564c5d*(0x1-_0x31d8c7/0x64);_0x7f10f3[_0x2fb406(0x21b)]=_0x193e2b,_0x7f10f3[_0x2fb406(0x20e)]=_0x31d8c7,console[_0x2fb406(0x1fc)](_0x2fb406(0x141)+_0x2c8da5['id']+_0x2fb406(0x14f)),console['log'](_0x2fb406(0x1a8)+_0x2c8da5[_0x2fb406(0x112)]+'\x20'+_0x2c8da5[_0x2fb406(0x1f5)]+'\x20->\x20'+_0x564c5d[_0x2fb406(0x111)](0x6)+_0x2fb406(0x15a)),console[_0x2fb406(0x1fc)](_0x2fb406(0x210)+_0x2c8da5[_0x2fb406(0x142)]+_0x2fb406(0x1fa)+_0x31d8c7+'%'),console[_0x2fb406(0x1fc)](_0x2fb406(0x202)+_0x193e2b[_0x2fb406(0x111)](0x6)+'\x20USDT');}console[_0x2fb406(0x1fc)](_0x2fb406(0x141)+_0x2c8da5['id']+_0x2fb406(0x1d1)+_0x7f10f3[_0x2fb406(0x14e)][_0x2fb406(0x17f)]());}if(_0x4bd58d[_0x2fb406(0x1bf)]){const _0x2ef245=_0x4bd58d[_0x2fb406(0x1bf)];_0x2ef245['iban']&&(_0x7f10f3[_0x2fb406(0x17d)]=_0x2ef245['iban'],console[_0x2fb406(0x1fc)](_0x2fb406(0x172)+_0x2ef245[_0x2fb406(0x1c7)])),_0x2ef245[_0x2fb406(0x1ff)]&&console[_0x2fb406(0x1fc)](_0x2fb406(0x193)+_0x2ef245['bankDetails']),_0x2ef245[_0x2fb406(0x17e)]&&console[_0x2fb406(0x1fc)](_0x2fb406(0x11c)+_0x2ef245[_0x2fb406(0x17e)]),_0x2ef245['confirmedOn']&&console[_0x2fb406(0x1fc)](_0x2fb406(0x1df)+_0x2ef245[_0x2fb406(0x102)]);}await database_1[_0x2fb406(0x14a)][_0x2fb406(0x218)][_0x2fb406(0x1e9)]({'where':{'id':_0x2c8da5['id']},'data':_0x7f10f3});if(_0x4bd58d[_0x2fb406(0x126)]==='PAID'&&_0x2c8da5[_0x2fb406(0x126)]!==_0x2fb406(0x106)){console[_0x2fb406(0x1fc)](_0x2fb406(0x150)+_0x2c8da5['id']+_0x2fb406(0x133));const _0x23880b=await database_1[_0x2fb406(0x14a)][_0x2fb406(0x218)][_0x2fb406(0x1b2)]({'where':{'id':_0x2c8da5['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x23880b?.['paymentLinkId']&&_0x23880b['paymentLink'])try{const _0x560ae7=_0x23880b[_0x2fb406(0x136)];console[_0x2fb406(0x1fc)]('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x560ae7['id']+_0x2fb406(0x107)+_0x560ae7[_0x2fb406(0x216)]+_0x2fb406(0x1e1)+_0x560ae7[_0x2fb406(0x17a)]+_0x2fb406(0x1e4)+_0x560ae7[_0x2fb406(0x126)]);const _0x4fe944=_0x560ae7[_0x2fb406(0x17a)]+0x1,_0x413d52=_0x560ae7['type']==='SINGLE'?_0x2fb406(0x120):_0x560ae7[_0x2fb406(0x126)];await database_1[_0x2fb406(0x14a)][_0x2fb406(0x136)]['update']({'where':{'id':_0x560ae7['id']},'data':{'currentPayments':_0x4fe944,'status':_0x413d52,'updatedAt':new Date()}}),console[_0x2fb406(0x1fc)](_0x2fb406(0x157)+_0x560ae7['id']+_0x2fb406(0x11e)+_0x560ae7['currentPayments']+_0x2fb406(0x166)+_0x4fe944+_0x2fb406(0x1e4)+_0x560ae7[_0x2fb406(0x126)]+_0x2fb406(0x166)+_0x413d52);}catch(_0x3068b4){console[_0x2fb406(0x14b)]('‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x3068b4);}else console[_0x2fb406(0x1fc)](_0x2fb406(0x150)+_0x2c8da5['id']+_0x2fb406(0x1a2));}await database_1[_0x2fb406(0x14a)][_0x2fb406(0x15f)]['create']({'data':{'paymentId':_0x2c8da5['id'],'shopId':_0x2c8da5[_0x2fb406(0x140)],'event':_0x2fb406(0x19d)+_0x4bd58d[_0x2fb406(0x126)][_0x2fb406(0x189)](),'statusCode':0xc8,'responseBody':JSON[_0x2fb406(0x158)]({'oldStatus':_0x2c8da5[_0x2fb406(0x126)],'newStatus':_0x4bd58d[_0x2fb406(0x126)],'paymentDetails':_0x4bd58d[_0x2fb406(0x1bf)],'checkedAt':new Date()[_0x2fb406(0x17f)]()})}}),await this[_0x2fb406(0x17c)](_0x2c8da5,_0x4bd58d['status']),await this['sendPaymentStatusNotification'](_0x2c8da5,_0x4bd58d[_0x2fb406(0x126)]),_0x4bd58d[_0x2fb406(0x126)]!==_0x2fb406(0x18e)&&(console[_0x2fb406(0x1fc)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x2c8da5['id']+'\x20status\x20changed\x20to\x20'+_0x4bd58d[_0x2fb406(0x126)]+_0x2fb406(0x211)),this[_0x2fb406(0x1d4)](_0x2c8da5['id'])),console[_0x2fb406(0x1fc)](_0x2fb406(0x117)+_0x2c8da5['id']+_0x2fb406(0x1fe));}else console[_0x2fb406(0x1fc)](_0x2fb406(0x13b)+_0x2c8da5['id']+_0x2fb406(0x198)+_0x4bd58d[_0x2fb406(0x126)]+')'),this[_0x2fb406(0x20a)](_0x2c8da5['id'],_0x2c8da5['gatewayPaymentId'],_0x2c8da5[_0x2fb406(0x126)],_0x4bd58d[_0x2fb406(0x126)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x4bd58d[_0x2fb406(0x1bf)],'amount':_0x4bd58d[_0x2fb406(0x112)],'currency':_0x4bd58d[_0x2fb406(0x1f5)],'shopId':_0x2c8da5[_0x2fb406(0x140)],'checkTimestamp':new Date()[_0x2fb406(0x17f)]()});}catch(_0x1fdfe9){console[_0x2fb406(0x14b)]('‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x2c8da5['id']+':',_0x1fdfe9),this[_0x2fb406(0x10e)](_0x2c8da5['id'],_0x2c8da5[_0x2fb406(0x1d8)],_0x1fdfe9,_0x2fb406(0x1d3),{'paymentAmount':_0x2c8da5[_0x2fb406(0x112)],'paymentCurrency':_0x2c8da5['currency'],'shopId':_0x2c8da5[_0x2fb406(0x140)],'createdAt':_0x2c8da5['createdAt']}),await database_1[_0x2fb406(0x14a)][_0x2fb406(0x15f)][_0x2fb406(0x194)]({'data':{'paymentId':_0x2c8da5['id'],'shopId':_0x2c8da5[_0x2fb406(0x140)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x2fb406(0x158)]({'error':_0x1fdfe9 instanceof Error?_0x1fdfe9[_0x2fb406(0x153)]:_0x2fb406(0x200),'gatewayPaymentId':_0x2c8da5['gatewayPaymentId'],'checkedAt':new Date()[_0x2fb406(0x17f)]()})}});}}async['sendShopWebhook'](_0x3be162,_0x3febda){const _0xee73e5=a57_0x320e34,_0x29c847=Date[_0xee73e5(0x164)]();try{const _0x33e49b=_0x3be162[_0xee73e5(0x10d)],_0x1fcbfc=_0x33e49b['settings'];if(!_0x1fcbfc?.[_0xee73e5(0x139)]){console[_0xee73e5(0x1fc)](_0xee73e5(0x1b4)+_0x33e49b['id']);return;}const _0x114724=_0x3febda==='PAID'?_0xee73e5(0x1a4):_0x3febda===_0xee73e5(0x13c)?_0xee73e5(0x13f):_0x3febda===_0xee73e5(0x1ac)?_0xee73e5(0x13f):'payment.pending';if(!_0x1fcbfc[_0xee73e5(0x1ae)]?.[_0xee73e5(0x19c)](_0x114724)){console[_0xee73e5(0x1fc)](_0xee73e5(0x118)+_0x114724+_0xee73e5(0x123)+_0x33e49b['id']);return;}const _0x4ff70c=(0x0,gateway_1[_0xee73e5(0x207)])(_0x3be162[_0xee73e5(0x142)])||_0x3be162['gateway'],_0x3e0e0a={'event':_0x114724,'payment':{'id':_0x3be162['id'],'order_id':_0x3be162[_0xee73e5(0x160)],'gateway_order_id':_0x3be162[_0xee73e5(0x20c)],'gateway':_0x4ff70c,'amount':_0x3be162[_0xee73e5(0x112)],'currency':_0x3be162[_0xee73e5(0x1f5)],'status':_0x3febda['toLowerCase'](),'customer_email':_0x3be162[_0xee73e5(0x109)],'customer_name':_0x3be162[_0xee73e5(0x15c)],'created_at':_0x3be162[_0xee73e5(0x190)],'updated_at':new Date()}},_0x4a9af6=JSON['stringify'](_0x3e0e0a),_0x2d2242=crypto_1[_0xee73e5(0x14a)][_0xee73e5(0x16c)](_0xee73e5(0x1f1),_0x3be162['shop'][_0xee73e5(0x148)])['update'](_0x4a9af6)[_0xee73e5(0x105)](_0xee73e5(0x208)),_0x3cf05b=await fetch(_0x1fcbfc[_0xee73e5(0x139)],{'method':'POST','headers':{'Content-Type':_0xee73e5(0x1a0),'User-Agent':'Payment\x20System/1.0','X-Webhook-Signature':_0x2d2242},'body':_0x4a9af6}),_0x1c5477=Date[_0xee73e5(0x164)]()-_0x29c847,_0x74266a=_0x3cf05b['ok']?_0xee73e5(0x21a):await _0x3cf05b[_0xee73e5(0x1be)]();loggerService_1[_0xee73e5(0x1e2)][_0xee73e5(0x1ab)](_0x3be162['shopId'],_0x1fcbfc['webhookUrl'],_0x114724,_0x3cf05b[_0xee73e5(0x126)],_0x1c5477,_0x3e0e0a),console['log'](_0xee73e5(0x1ed)+_0x1fcbfc[_0xee73e5(0x139)]+_0xee73e5(0x1eb)+_0x3cf05b['status']+'\x20('+_0x1c5477+_0xee73e5(0x1d9));}catch(_0x1bcb6d){console[_0xee73e5(0x14b)](_0xee73e5(0x12d),_0x1bcb6d),loggerService_1[_0xee73e5(0x1e2)][_0xee73e5(0x1c2)](_0x3be162[_0xee73e5(0x140)],_0x3be162[_0xee73e5(0x10d)]?.['settings']?.['webhookUrl']||'unknown',_0xee73e5(0x110),_0x1bcb6d,{});}}async[a57_0x320e34(0x179)](_0x1f0fc6,_0x31c4fc){const _0x1d65bf=a57_0x320e34;try{const _0x40ca07={'PENDING':_0x1d65bf(0x181),'PAID':_0x1d65bf(0x168),'FAILED':_0x1d65bf(0x19f),'EXPIRED':_0x1d65bf(0x11d)},_0x38707b=_0x40ca07[_0x31c4fc];if(!_0x38707b||_0x38707b==='created')return;await telegramBotService_1[_0x1d65bf(0x203)][_0x1d65bf(0x184)](_0x1f0fc6[_0x1d65bf(0x140)],_0x1f0fc6,_0x38707b);}catch(_0x35b861){console[_0x1d65bf(0x14b)](_0x1d65bf(0x16d),_0x35b861);}}async[a57_0x320e34(0x171)](_0xee0a3b){const _0x434716=a57_0x320e34;console[_0x434716(0x1fc)](_0x434716(0x213)+_0xee0a3b);const _0xd52101=await database_1['default'][_0x434716(0x218)]['findUnique']({'where':{'id':_0xee0a3b},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xd52101)throw new Error(_0x434716(0x1fb));if(_0xd52101[_0x434716(0x142)]!==_0x434716(0x1e5)&&_0xd52101[_0x434716(0x142)]!=='cointopay2')throw new Error(_0x434716(0x15e));console[_0x434716(0x1fc)]('‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0xd52101[_0x434716(0x142)]+_0x434716(0x1db)+_0xee0a3b),await this[_0x434716(0x1b0)](_0xd52101),console[_0x434716(0x1fc)](_0x434716(0x1ca)+_0xee0a3b);}[a57_0x320e34(0x204)](){const _0x5a841f=a57_0x320e34,_0xef90eb=this[_0x5a841f(0x1f3)]?this[_0x5a841f(0x13a)]:undefined,_0x3e30de=Array[_0x5a841f(0x11a)](this[_0x5a841f(0x199)][_0x5a841f(0x16a)]())[_0x5a841f(0x169)](_0x9140ac=>({'paymentId':_0x9140ac[_0x5a841f(0x15d)],'gatewayPaymentId':_0x9140ac['gatewayPaymentId'],'createdAt':_0x9140ac[_0x5a841f(0x190)],'timersCount':_0x9140ac['timers'][_0x5a841f(0x18d)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x5a841f(0x13a)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x5a841f(0x199)]['size'],'nextGlobalCheckIn':_0xef90eb,'paymentTimersDetails':_0x3e30de};}[a57_0x320e34(0x1d0)](_0x2a1eff){const _0x117179=a57_0x320e34,_0x502b7d=this[_0x117179(0x199)][_0x117179(0x1c8)](_0x2a1eff);if(_0x502b7d)return{'hasTimers':!![],'timersCount':_0x502b7d['timers']['length'],'createdAt':_0x502b7d[_0x117179(0x190)],'gatewayPaymentId':_0x502b7d[_0x117179(0x1d8)]};return{'hasTimers':![]};}async[a57_0x320e34(0x1d5)](_0x45374c,_0x25ed6d){const _0x3d85ac=a57_0x320e34;try{const _0x53d398=await database_1[_0x3d85ac(0x14a)][_0x3d85ac(0x10d)][_0x3d85ac(0x1b2)]({'where':{'id':_0x45374c},'select':{'gatewaySettings':!![]}});if(!_0x53d398?.[_0x3d85ac(0x1cf)])return console[_0x3d85ac(0x1fc)](_0x3d85ac(0x1ef)+_0x45374c+_0x3d85ac(0x15b)),0xa;const _0x5cf920=JSON[_0x3d85ac(0x177)](_0x53d398['gatewaySettings']);for(const [_0x3771ee,_0x873e11]of Object[_0x3d85ac(0x151)](_0x5cf920)){if(_0x3771ee[_0x3d85ac(0x189)]()===_0x25ed6d['toLowerCase']()){const _0x3b02c8=_0x873e11['commission']||0xa;return console[_0x3d85ac(0x1fc)](_0x3d85ac(0x116)+_0x25ed6d+_0x3d85ac(0x131)+_0x45374c+':\x20'+_0x3b02c8+'%'),_0x3b02c8;}}return console[_0x3d85ac(0x1fc)](_0x3d85ac(0x217)+_0x25ed6d+'\x20in\x20shop\x20'+_0x45374c+',\x20using\x20default\x2010%'),0xa;}catch(_0x2e981c){return console['error']('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x45374c+_0x3d85ac(0x159)+_0x25ed6d+':',_0x2e981c),0xa;}}}function a57_0x370d(){const _0x2af756=['logCoinToPayStatus','CoinToPayStatusService','gatewayOrderId','unknown','gatewayCommissionRate','CoinToPay2Service','\x20\x20\x20Gateway\x20',',\x20clearing\x20individual\x20timers','9MmfdQU','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','../types/gateway','\x20days','type','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','payment','‚è∞\x20[GLOBAL]\x20Payment\x20','Success','amountAfterGatewayCommissionUSDT','cointopay_auto_expired','confirmedOn','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','‚ùå\x20[CHECK]\x20Payment\x20','digest','PAID',':\x20type=','\x20expired','customerEmail','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','schedulePaymentChecks','1338bLjGue','shop','logCoinToPayError','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','webhook_send','toFixed','amount','stopPeriodicStatusCheck','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','checkPaymentStatus','Gateway\x20','‚úÖ\x20[CHECK]\x20Payment\x20','Webhook\x20event\x20','‚è∞\x20[GLOBAL]\x20Found\x20','from','\x20\x20\x20-\x20Amount:\x20','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','expired','\x20updated:\x20currentPayments=','findMany','COMPLETED','üìä\x20[HOURLY]\x20Payment\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20not\x20enabled\x20for\x20shop\x20','\x20details:','\x20\x20\x20-\x20ShopId:\x20','status','delete','187eTxClf','\x20days,\x20marking\x20as\x20EXPIRED','22PjqFga','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','EXPIRY_DAYS','Failed\x20to\x20send\x20shop\x20webhook:','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','amountUSDT','\x20not\x20found,\x20clearing\x20timers','\x20commission\x20for\x20shop\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','paymentLink','__importDefault','\x20\x20\x20üìÖ\x20Time:\x20','webhookUrl','GLOBAL_CHECK_INTERVAL_MS','üìä\x20[CHECK]\x20Payment\x20','FAILED','Payment\x20older\x20than\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','payment.failed','shopId','üí∞\x20[CHECK]\x20Payment\x20','gateway','\x20found:','‚úÖ\x20[EXPIRY]\x20Payment\x20','./gateways/coinToPay2Service','\x20seconds\x20(','convertToUSDT','secretKey','startPeriodicStatusCheck','default','error','\x20skipped,\x20','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','paidAt','\x20amounts\x20calculated:','üìà\x20[COINTOPAY]\x20Payment\x20','entries','size','message','not\x20found','crypto','./currencyService','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','stringify',',\x20gateway\x20','\x20USDT',',\x20using\x20default\x20commission\x2010%','customerName','paymentId','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','webhookLog','orderId','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','checkSinglePaymentById','now','2466328valHAI','\x20->\x20','\x20completed\x20for\x20payment\x20','paid','map','values','üßπ\x20[DEBUG]\x20Clearing\x20','createHmac','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','coinToPay2Service','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20status\x20from\x20','checkPaymentById','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','coinToPayService','\x20\x20\x20üìù\x20Details:','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','parse','\x20(after\x20','sendPaymentStatusNotification','currentPayments','stack','sendShopWebhook','remitterIban','transactionId','toISOString','‚úÖ\x20[HOURLY]\x20Payment\x20','created','\x20timers\x20for\x20payment\x20','COINTOPAY_STATUS_CHANGE','sendPaymentNotification','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','COINTOPAY_ERROR','toLowerCase','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','\x20days\x20(created\x20before\x20','auto_expire','length','PENDING','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','createdAt','delay','getTime','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','create','\x20has\x20no\x20gatewayPaymentId','\x20to\x20','defineProperty','\x20status\x20unchanged\x20(','paymentTimers','forEach','\x20\x20\x20üìù\x20Context:','includes','cointopay_status_check_','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','failed','application/json','floor','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20\x20\x20‚ùå\x20Error:\x20','payment.success','\x20for\x20payment\x20','221920enEBsW','6815Mftkos','\x20\x20\x20Amount:\x20','catch','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','logShopWebhookSent','EXPIRED','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','webhookEvents','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','checkSinglePayment','/status/','findUnique','not\x20confirmed','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','getDate','\x20status\x20is\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','2297484gXQHAD','1369257XefHpt','cointopay2','../config/database','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','\x20status:\x20','text','paymentDetails','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','5\x20minutes','logShopWebhookError',',\x20stopping\x20individual\x20checks','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20\x20\x20üìç\x20Source:\x20','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','iban','get','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','timers','description','1423204PmUkbK','‚è∞\x20[EXPIRY]\x20Payment\x20','gatewaySettings','getPaymentTimerInfo','\x20marked\x20as\x20paid\x20at:\x20','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','status_check','clearPaymentTimers','getGatewayCommission','logWhiteDomainError','schedule_created','gatewayPaymentId','ms)','\x20is\x20older\x20than\x20','\x20payment\x20','ü™ô\x20[DEBUG]\x20Creating\x20','\x20individual\x20payment\x20timers','coinToPayStatusService','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','checkAllPendingPayments',',\x20currentPayments=','loggerService','\x20is\x20too\x20new\x20(',',\x20status=','cointopay','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','18691fCOQDw','\x20(age:\x20','update','üîç\x20[CHECK]\x20Checking\x20','\x20with\x20status\x20','\x20triggered\x20for\x20payment\x20','Shop\x20webhook\x20sent\x20to\x20','2\x20minutes','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','sha256','\x20\x20\x20üìä\x20Status:\x20','globalCheckInterval','checkExpiredPayments','currency','push','timestamp','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','./loggerService','\x20commission:\x20','Payment\x20not\x20found','log','\x20\x20\x20-\x20paymentId:\x20','\x20updated\x20successfully','bankDetails','Unknown\x20error','./telegramBotService','\x20\x20\x20Amount\x20after\x20commission:\x20','telegramBotService','getServiceStats','h),\x20skipping\x20global\x20check','\x20in\x20','getGatewayIdByName','hex','__esModule'];a57_0x370d=function(){return _0x2af756;};return a57_0x370d();}function a57_0x33d4(_0x445b73,_0xc9d86c){_0x445b73=_0x445b73-0x102;const _0x370d42=a57_0x370d();let _0x33d4b2=_0x370d42[_0x445b73];return _0x33d4b2;}exports[a57_0x320e34(0x20b)]=CoinToPayStatusService,exports[a57_0x320e34(0x1de)]=new CoinToPayStatusService();