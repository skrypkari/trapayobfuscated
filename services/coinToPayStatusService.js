'use strict';const a48_0x145bd0=a48_0x4332;function a48_0x4332(_0x5e43f0,_0x4491a2){_0x5e43f0=_0x5e43f0-0x160;const _0x18e076=a48_0x18e0();let _0x433285=_0x18e076[_0x5e43f0];return _0x433285;}(function(_0x2192a8,_0x570ca8){const _0x1d2691=a48_0x4332,_0x182823=_0x2192a8();while(!![]){try{const _0x1499eb=-parseInt(_0x1d2691(0x217))/0x1*(parseInt(_0x1d2691(0x1ba))/0x2)+-parseInt(_0x1d2691(0x1df))/0x3+parseInt(_0x1d2691(0x182))/0x4+parseInt(_0x1d2691(0x1ec))/0x5+-parseInt(_0x1d2691(0x16f))/0x6*(parseInt(_0x1d2691(0x163))/0x7)+parseInt(_0x1d2691(0x188))/0x8+parseInt(_0x1d2691(0x248))/0x9;if(_0x1499eb===_0x570ca8)break;else _0x182823['push'](_0x182823['shift']());}catch(_0x5b9ff8){_0x182823['push'](_0x182823['shift']());}}}(a48_0x18e0,0xf0867));var __importDefault=this&&this[a48_0x145bd0(0x1d5)]||function(_0x3c7d95){const _0x597cba=a48_0x145bd0;return _0x3c7d95&&_0x3c7d95[_0x597cba(0x170)]?_0x3c7d95:{'default':_0x3c7d95};};function a48_0x18e0(){const _0x5918ea=['\x20is\x20older\x20than\x20','\x20timers\x20for\x20payment\x20','iban','shop','checkSinglePayment','\x20has\x20no\x20gatewayPaymentId','cointopay','logShopWebhookSent','length','âŒ\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','__importDefault','payment.success',',\x20using\x20default\x2010%','FAILED',',\x20gateway\x20','Payment\x20not\x20found','auto_expire','ðŸ›‘\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20completed\x20for\x20payment\x20','values','2865189cPtXkD','amountUSDT','ðŸ”\x20[CHECK]\x20Checking\x20','âŒ\x20[CHECK]\x20Payment\x20','GLOBAL_CHECK_INTERVAL_MS','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','ðŸ’°\x20[CHECK]\x20Payment\x20','\x20\x20\x20ðŸ“\x20Context:','âœ…\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','failed',':\x20type=','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','paymentLink','4826855iIpmfe','./currencyService','findUnique','ðŸ“Š\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20updated\x20successfully','size','âœ…\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','paymentId','toLowerCase','\x20\x20\x20âŒ\x20Error:\x20','ðŸª™\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','âŒ\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','Shop\x20webhook\x20sent\x20to\x20','forEach','\x20current\x20status:\x20','checkSinglePaymentById','\x20status\x20changed\x20to\x20','currencyService','\x20\x20\x20-\x20ShopId:\x20','delay','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','telegramBotService','\x20status\x20is\x20','ðŸª™\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','âŒ\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','currency','timers','logCoinToPayStatus','\x20skipped,\x20',',\x20clearing\x20individual\x20timers','\x20not\x20found\x20in\x20database','\x20amounts\x20calculated:','./loggerService','âœ…\x20[HOURLY]\x20Payment\x20','loggerService','stopPeriodicStatusCheck','\x20USDT','catch',',\x20using\x20default\x20commission\x2010%','description','\x20payment\x20','checkAllPendingPayments','createdAt','11KEjKrV','Failed\x20to\x20send\x20shop\x20webhook:','gatewayPaymentId','globalCheckInterval','ðŸ§¹\x20[DEBUG]\x20Cleared\x20timer\x20#','\x20->\x20','âœ…\x20[CHECK]\x20Payment\x20','status','text','findMany','\x20\x20\x20-\x20Gateway:\x20','-day\x20timeout','message','not\x20confirmed','../types/gateway','Payment\x20System/1.0','timestamp',',\x20stopping\x20individual\x20checks','\x20initial\x20timers\x20for\x20payment\x20','\x20is\x20too\x20new\x20(','getPaymentTimerInfo','payment.pending','webhookLog','log','bankDetails','\x20is\x20valid\x20for\x20checking,\x20proceeding...','EXPIRY_DAYS','âœ…\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','paymentDetails','payment','update','orderId','\x20status\x20from\x20','./gateways/coinToPayService','\x20with\x20status\x20','customerEmail','parse','ðŸ“Š\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','ðŸª™\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','âŒ\x20[HOURLY]\x20Payment\x20','\x20status\x20unchanged\x20(','ðŸª™\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','getTime','âŒ\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','now','gatewaySettings','Payment\x20older\x20than\x20','\x20seconds\x20(','EXPIRED','6920613tKjYtk','not\x20found','schedulePaymentChecks','get','âŒ\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','ðŸª™\x20[TIMER]\x20Individual\x20check\x20#','\x20\x20\x20-\x20Status:\x20','COINTOPAY_STATUS_CHANGE','coinToPayStatusService','\x20days\x20(created\x20before\x20','includes','SINGLE','POST','toISOString','Webhook\x20event\x20','2\x20minutes','checkExpiredPayments','cointopay2','clearPaymentTimers','ðŸª™\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','coinToPayService','\x20pending\x20CoinToPay\x20payments','â°\x20[GLOBAL]\x20Found\x20','âŒ\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20expired','ðŸ“Š\x20[CHECK]\x20Payment\x20','entries','\x20checked,\x20','create','ðŸ“ˆ\x20[COINTOPAY]\x20Payment\x20','webhookEvents','amount','status_check','ðŸ“Š\x20[CHECK]\x20CoinToPay2\x20payment\x20','âš ï¸\x20[CHECK]\x20Payment\x20','ðŸ†”\x20[CHECK]\x20Transaction\x20ID:\x20','paymentTimers','getDate','PAID','7zwKmPx','COINTOPAY_ERROR','getGatewayIdByName','\x20not\x20found,\x20clearing\x20timers','payment.failed','â°\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','floor','âœ…\x20[EXPIRY]\x20Payment\x20','\x20in\x20shop\x20','cointopay_status_check_','âœ…\x20[DEBUG]\x20Successfully\x20scheduled\x20','type','7464594phpFlr','__esModule','\x20\x20\x20Amount:\x20','gatewayOrderId','âŒ\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20marked\x20as\x20paid\x20at:\x20','ðŸª™\x20[ERROR]\x20CoinToPay\x20Error:\x20','ðŸ”\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','remitterIban','\x20updated:\x20currentPayments=','\x20(after\x20','commission','shopId','defineProperty','default','Gateway\x20','createdOn','stack','\x20\x20\x20-\x20gatewayPaymentId:\x20','898312OfBXIY','paidAt','\x20status:\x20','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','ðŸ›‘\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','COMPLETED','15405920JeHwNA','\x20found:','\x20\x20\x20-\x20Amount:\x20','âœ…\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20\x20\x20ðŸ“…\x20Time:\x20','gatewayCommissionRate','\x20\x20\x20-\x20paymentId:\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','sendPaymentStatusNotification','getGatewayCommission','gateway','âŒ\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','ðŸ›‘\x20[SHUTDOWN]\x20Cleared\x20','\x20\x20\x20ðŸ“\x20Details:',',\x20currentPayments=','\x20to\x20','created','webhook_send','amountAfterGatewayCommissionUSDT','\x20for\x20payment\x20','unknown','ðŸª™\x20[GLOBAL]\x20Found\x20','confirmedOn','logShopWebhookError','cointopay_auto_expired','â°\x20[GLOBAL]\x20Payment\x20','âœ…\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','PENDING','âœ…\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20commission:\x20','push','toFixed','ðŸ”\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','webhookUrl','setDate','\x20\x20\x20ðŸ“\x20Source:\x20','customerName','\x20to\x20clear','checkPaymentStatus','stringify','transactionId','\x20has\x20no\x20gatewayPaymentId,\x20skipping','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','\x20days,\x20marking\x20as\x20EXPIRED','ðŸª™\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','âœ…\x20[COINTOPAY]\x20Payment\x20link\x20','CoinToPay2Service','CoinToPayStatusService','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','127326hkHEek','delete','h),\x20skipping\x20global\x20check','.\x20Remaining\x20active\x20timers:\x20','ðŸª™\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','âŒ\x20[TIMER]\x20Failed\x20individual\x20check\x20#','paid','startPeriodicStatusCheck','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','error','\x20details:','\x20\x20\x20-\x20GatewayPaymentId:\x20','currentPayments','logCoinToPayError','coinToPay2Service','\x20in\x20','\x20days'];a48_0x18e0=function(){return _0x5918ea;};return a48_0x18e0();}Object[a48_0x145bd0(0x17c)](exports,a48_0x145bd0(0x170),{'value':!![]}),exports[a48_0x145bd0(0x250)]=exports[a48_0x145bd0(0x1b8)]=void 0x0;const coinToPayService_1=require(a48_0x145bd0(0x238)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a48_0x145bd0(0x225)),database_1=__importDefault(require('../config/database')),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a48_0x145bd0(0x20c)),currencyService_1=require(a48_0x145bd0(0x1ed));class CoinToPayStatusService{constructor(){const _0x196919=a48_0x145bd0;this[_0x196919(0x21a)]=null,this[_0x196919(0x1e3)]=0x3c*0x3c*0x3e8,this[_0x196919(0x231)]=0x5,this[_0x196919(0x160)]=new Map(),this[_0x196919(0x25c)]=new coinToPayService_1['CoinToPayService'](),this['coinToPay2Service']=new coinToPay2Service_1[(_0x196919(0x1b7))](),console[_0x196919(0x22e)](_0x196919(0x1be));}[a48_0x145bd0(0x24a)](_0x4d7c99,_0x21da9c){const _0x3ab60a=a48_0x145bd0;console[_0x3ab60a(0x22e)](_0x3ab60a(0x203)),console[_0x3ab60a(0x22e)](_0x3ab60a(0x18e)+_0x4d7c99),console[_0x3ab60a(0x22e)](_0x3ab60a(0x181)+_0x21da9c),this[_0x3ab60a(0x25a)](_0x4d7c99);const _0x2d2f4b=[],_0x425726=new Date(),_0x3eeeab=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x3ab60a(0x257)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console['log']('ðŸª™\x20[DEBUG]\x20Creating\x20'+_0x3eeeab[_0x3ab60a(0x1d3)]+_0x3ab60a(0x229)+_0x4d7c99);let _0x272f50=0x0;_0x3eeeab[_0x3ab60a(0x1f9)]((_0x1d8475,_0x222641)=>{const _0x21fd37=_0x3ab60a;_0x272f50+=_0x1d8475[_0x21fd37(0x1ff)];const _0x31a2c7=setTimeout(async()=>{const _0x37ee70=_0x21fd37;console[_0x37ee70(0x22e)](_0x37ee70(0x24d)+(_0x222641+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x4d7c99+_0x37ee70(0x179)+_0x1d8475['description']+')');try{await this[_0x37ee70(0x1fb)](_0x4d7c99),console[_0x37ee70(0x22e)]('âœ…\x20[TIMER]\x20Individual\x20check\x20#'+(_0x222641+0x1)+_0x37ee70(0x1dd)+_0x4d7c99);}catch(_0x32f8dd){console['error'](_0x37ee70(0x1bf)+(_0x222641+0x1)+_0x37ee70(0x19b)+_0x4d7c99+':',_0x32f8dd),this[_0x37ee70(0x1c7)](_0x4d7c99,_0x21da9c,_0x32f8dd,_0x37ee70(0x268),{'checkNumber':_0x222641+0x1,'scheduledAfter':_0x1d8475[_0x37ee70(0x213)],'isIndividualCheck':!![]});}},_0x272f50);_0x2d2f4b[_0x21fd37(0x1a6)](_0x31a2c7),console[_0x21fd37(0x22e)]('â°\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x222641+0x1)+_0x21fd37(0x19b)+_0x4d7c99+_0x21fd37(0x1c9)+_0x272f50/0x3e8+_0x21fd37(0x246)+_0x1d8475['description']+')');});const _0x1cbc2d=setInterval(async()=>{const _0x516f0f=_0x3ab60a;console[_0x516f0f(0x22e)](_0x516f0f(0x1b5)+_0x4d7c99);try{const _0x108f8d=await database_1[_0x516f0f(0x17d)][_0x516f0f(0x234)][_0x516f0f(0x1ee)]({'where':{'id':_0x4d7c99},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x108f8d){console[_0x516f0f(0x22e)](_0x516f0f(0x23e)+_0x4d7c99+_0x516f0f(0x166)),this[_0x516f0f(0x25a)](_0x4d7c99);return;}console['log']('ðŸ“Š\x20[HOURLY]\x20Payment\x20'+_0x4d7c99+_0x516f0f(0x1fa)+_0x108f8d[_0x516f0f(0x21e)]);if(_0x108f8d['status']!=='PENDING'){console['log'](_0x516f0f(0x20d)+_0x4d7c99+_0x516f0f(0x202)+_0x108f8d[_0x516f0f(0x21e)]+_0x516f0f(0x228)),this[_0x516f0f(0x25a)](_0x4d7c99);return;}const _0x53f975=Math[_0x516f0f(0x169)]((Date[_0x516f0f(0x243)]()-_0x108f8d['createdAt'][_0x516f0f(0x241)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x53f975>=this[_0x516f0f(0x231)]){console[_0x516f0f(0x22e)]('â°\x20[HOURLY]\x20Payment\x20'+_0x4d7c99+_0x516f0f(0x1cb)+this[_0x516f0f(0x231)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x516f0f(0x25a)](_0x4d7c99);return;}await this['checkSinglePaymentById'](_0x4d7c99),console['log'](_0x516f0f(0x1a2)+_0x4d7c99);}catch(_0x2e5b5b){console[_0x516f0f(0x1c3)](_0x516f0f(0x1d4)+_0x4d7c99+':',_0x2e5b5b),this[_0x516f0f(0x1c7)](_0x4d7c99,_0x21da9c,_0x2e5b5b,_0x516f0f(0x268),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x2d2f4b[_0x3ab60a(0x1a6)](_0x1cbc2d),this[_0x3ab60a(0x160)]['set'](_0x4d7c99,{'timers':_0x2d2f4b,'paymentId':_0x4d7c99,'gatewayPaymentId':_0x21da9c,'createdAt':_0x425726}),console[_0x3ab60a(0x22e)](_0x3ab60a(0x16d)+_0x3eeeab[_0x3ab60a(0x1d3)]+_0x3ab60a(0x18f)+_0x4d7c99),console[_0x3ab60a(0x22e)](_0x3ab60a(0x23c)+this[_0x3ab60a(0x160)]['size']),this[_0x3ab60a(0x207)](_0x4d7c99,_0x21da9c,_0x3ab60a(0x1a3),_0x3ab60a(0x1a3),_0x3ab60a(0x268),{'action':'schedule_created','scheduledChecks':_0x3eeeab[_0x3ab60a(0x1d3)],'firstCheckIn':_0x3eeeab[0x0][_0x3ab60a(0x1ff)]/0x3e8,'totalTimers':this['paymentTimers'][_0x3ab60a(0x1f1)]});}[a48_0x145bd0(0x25a)](_0x27cbe8){const _0x2dcdd1=a48_0x145bd0,_0x5b2e7b=this['paymentTimers']['get'](_0x27cbe8);_0x5b2e7b?(console[_0x2dcdd1(0x22e)]('ðŸ§¹\x20[DEBUG]\x20Clearing\x20'+_0x5b2e7b[_0x2dcdd1(0x206)][_0x2dcdd1(0x1d3)]+_0x2dcdd1(0x1cc)+_0x27cbe8),_0x5b2e7b['timers'][_0x2dcdd1(0x1f9)]((_0xb398d0,_0x21996b)=>{const _0x256550=_0x2dcdd1;_0xb398d0&&(clearTimeout(_0xb398d0),clearInterval(_0xb398d0),console['log'](_0x256550(0x21b)+(_0x21996b+0x1)+_0x256550(0x19b)+_0x27cbe8));}),this[_0x2dcdd1(0x160)][_0x2dcdd1(0x1bb)](_0x27cbe8),console['log'](_0x2dcdd1(0x18b)+_0x27cbe8+_0x2dcdd1(0x1bd)+this['paymentTimers'][_0x2dcdd1(0x1f1)])):console['log']('âš ï¸\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x27cbe8+_0x2dcdd1(0x1ad));}async[a48_0x145bd0(0x1fb)](_0x137315){const _0x53d772=a48_0x145bd0;console[_0x53d772(0x22e)](_0x53d772(0x176)+_0x137315);const _0x4f76eb=await database_1[_0x53d772(0x17d)][_0x53d772(0x234)][_0x53d772(0x1ee)]({'where':{'id':_0x137315},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4f76eb){console[_0x53d772(0x22e)](_0x53d772(0x1e2)+_0x137315+_0x53d772(0x20a));return;}console[_0x53d772(0x22e)](_0x53d772(0x261)+_0x137315+_0x53d772(0x189)),console['log'](_0x53d772(0x221)+_0x4f76eb[_0x53d772(0x192)]),console[_0x53d772(0x22e)](_0x53d772(0x24e)+_0x4f76eb[_0x53d772(0x21e)]),console['log'](_0x53d772(0x1c5)+_0x4f76eb[_0x53d772(0x219)]),console[_0x53d772(0x22e)](_0x53d772(0x18a)+_0x4f76eb['amount']+'\x20'+_0x4f76eb[_0x53d772(0x205)]),console['log'](_0x53d772(0x1fe)+_0x4f76eb[_0x53d772(0x17b)]);if(_0x4f76eb[_0x53d772(0x192)]!==_0x53d772(0x1d1)&&_0x4f76eb[_0x53d772(0x192)]!=='cointopay2'){console[_0x53d772(0x22e)](_0x53d772(0x26a)+_0x137315+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x4f76eb[_0x53d772(0x192)]+')');return;}if(_0x4f76eb[_0x53d772(0x21e)]!==_0x53d772(0x1a3)){console[_0x53d772(0x22e)]('âš ï¸\x20[CHECK]\x20Payment\x20'+_0x137315+'\x20status\x20is\x20'+_0x4f76eb['status']+_0x53d772(0x228)),this['clearPaymentTimers'](_0x137315);return;}if(!_0x4f76eb[_0x53d772(0x219)]){console[_0x53d772(0x22e)]('âš ï¸\x20[CHECK]\x20Payment\x20'+_0x137315+_0x53d772(0x1d0));return;}console['log']('âœ…\x20[CHECK]\x20Payment\x20'+_0x137315+_0x53d772(0x230)),await this[_0x53d772(0x1cf)](_0x4f76eb);}[a48_0x145bd0(0x207)](_0x4b3e13,_0x29b3c9,_0x37a8fe,_0x3beba6,_0x574c31,_0x15ffac){const _0xf4b68d=a48_0x145bd0,_0x408c93={'type':_0xf4b68d(0x24f),'paymentId':_0x4b3e13,'gatewayPaymentId':_0x29b3c9,'oldStatus':_0x37a8fe,'newStatus':_0x3beba6,'source':_0x574c31,'timestamp':new Date()[_0xf4b68d(0x255)](),'details':_0x15ffac||{}};loggerService_1[_0xf4b68d(0x20e)][_0xf4b68d(0x207)](_0x408c93),console[_0xf4b68d(0x22e)]('ðŸª™\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x4b3e13+'\x20('+_0x29b3c9+')'),console[_0xf4b68d(0x22e)]('\x20\x20\x20ðŸ“Š\x20Status:\x20'+_0x37a8fe+_0xf4b68d(0x21c)+_0x3beba6),console[_0xf4b68d(0x22e)](_0xf4b68d(0x1ab)+_0x574c31),console[_0xf4b68d(0x22e)]('\x20\x20\x20ðŸ“…\x20Time:\x20'+_0x408c93[_0xf4b68d(0x227)]),_0x15ffac&&console[_0xf4b68d(0x22e)](_0xf4b68d(0x195),_0x15ffac);}[a48_0x145bd0(0x1c7)](_0x237180,_0x5e451c,_0x223823,_0x2a869b,_0x286065){const _0x404509=a48_0x145bd0,_0x2f2e7a={'type':_0x404509(0x164),'paymentId':_0x237180,'gatewayPaymentId':_0x5e451c,'error':_0x223823 instanceof Error?{'message':_0x223823[_0x404509(0x223)],'stack':_0x223823[_0x404509(0x180)]}:_0x223823,'source':_0x2a869b,'timestamp':new Date()['toISOString'](),'context':_0x286065||{}};loggerService_1[_0x404509(0x20e)][_0x404509(0x1c7)](_0x2f2e7a),console[_0x404509(0x1c3)](_0x404509(0x175)+_0x237180+'\x20('+_0x5e451c+')'),console[_0x404509(0x1c3)](_0x404509(0x1f5)+(_0x223823 instanceof Error?_0x223823['message']:_0x223823)),console[_0x404509(0x1c3)](_0x404509(0x1ab)+_0x2a869b),console[_0x404509(0x1c3)](_0x404509(0x18c)+_0x2f2e7a[_0x404509(0x227)]),_0x286065&&console[_0x404509(0x1c3)](_0x404509(0x1e6),_0x286065);}[a48_0x145bd0(0x1c1)](){const _0x56ca3d=a48_0x145bd0;console[_0x56ca3d(0x22e)](_0x56ca3d(0x23d)),this[_0x56ca3d(0x215)]()[_0x56ca3d(0x211)](_0x1f5b87=>{const _0x2edcf2=_0x56ca3d;console[_0x2edcf2(0x1c3)](_0x2edcf2(0x242),_0x1f5b87);}),this[_0x56ca3d(0x21a)]=setInterval(async()=>{const _0x44aab1=_0x56ca3d;try{console[_0x44aab1(0x22e)](_0x44aab1(0x25b)),await this['checkAllPendingPayments'](),console['log'](_0x44aab1(0x1e7));}catch(_0x3f5d72){console[_0x44aab1(0x1c3)](_0x44aab1(0x204),_0x3f5d72);}},this[_0x56ca3d(0x1e3)]),console[_0x56ca3d(0x22e)](_0x56ca3d(0x1a4));}[a48_0x145bd0(0x20f)](){const _0x48aff7=a48_0x145bd0;console[_0x48aff7(0x22e)](_0x48aff7(0x1dc));this[_0x48aff7(0x21a)]&&(clearInterval(this['globalCheckInterval']),this[_0x48aff7(0x21a)]=null,console['log'](_0x48aff7(0x186)));const _0x55db47=this[_0x48aff7(0x160)][_0x48aff7(0x1f1)];for(const [_0x18e187]of this[_0x48aff7(0x160)]){this[_0x48aff7(0x25a)](_0x18e187);}console[_0x48aff7(0x22e)](_0x48aff7(0x194)+_0x55db47+'\x20individual\x20payment\x20timers');}async[a48_0x145bd0(0x215)](){const _0x166219=a48_0x145bd0;try{console[_0x166219(0x22e)](_0x166219(0x1f6));const _0x5e72fd=await database_1['default'][_0x166219(0x234)][_0x166219(0x220)]({'where':{'gateway':{'in':[_0x166219(0x1d1),_0x166219(0x259)]},'status':_0x166219(0x1a3),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x166219(0x22e)](_0x166219(0x19d)+_0x5e72fd[_0x166219(0x1d3)]+_0x166219(0x25d));if(_0x5e72fd[_0x166219(0x1d3)]===0x0){console[_0x166219(0x22e)](_0x166219(0x240));return;}const _0x5bb55b=await this['checkExpiredPayments'](_0x5e72fd);console['log'](_0x166219(0x25e)+_0x5bb55b[_0x166219(0x1d3)]+'\x20expired\x20CoinToPay\x20payments');let _0x46bcb3=0x0,_0x52a450=0x0;for(const _0x21b73a of _0x5e72fd){try{if(_0x5bb55b[_0x166219(0x252)](_0x21b73a['id'])){console['log'](_0x166219(0x1a1)+_0x21b73a['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x52a450++;continue;}if(this[_0x166219(0x160)]['has'](_0x21b73a['id'])){console[_0x166219(0x22e)](_0x166219(0x1a1)+_0x21b73a['id']+_0x166219(0x1c2)),_0x52a450++;continue;}const _0x3d6f6a=(Date[_0x166219(0x243)]()-_0x21b73a['createdAt']['getTime']())/(0x3e8*0x3c*0x3c);if(_0x3d6f6a<0x1){console[_0x166219(0x22e)]('â°\x20[GLOBAL]\x20Payment\x20'+_0x21b73a['id']+_0x166219(0x22a)+_0x3d6f6a['toFixed'](0x1)+_0x166219(0x1bc)),_0x52a450++;continue;}console[_0x166219(0x22e)](_0x166219(0x1a8)+_0x21b73a['id']+'\x20(age:\x20'+_0x3d6f6a[_0x166219(0x1a7)](0x1)+'h)'),await this[_0x166219(0x1cf)](_0x21b73a),_0x46bcb3++,await new Promise(_0x3a29c7=>setTimeout(_0x3a29c7,0x7d0));}catch(_0x3ff571){console[_0x166219(0x1c3)](_0x166219(0x193)+_0x21b73a['id']+':',_0x3ff571),this[_0x166219(0x1c7)](_0x21b73a['id'],_0x21b73a[_0x166219(0x219)]||'unknown',_0x3ff571,_0x166219(0x268),{'isGlobalCheck':!![],'paymentAmount':_0x21b73a[_0x166219(0x267)],'paymentCurrency':_0x21b73a[_0x166219(0x205)],'shopId':_0x21b73a[_0x166219(0x17b)],'createdAt':_0x21b73a[_0x166219(0x216)]}),loggerService_1[_0x166219(0x20e)]['logWhiteDomainError'](_0x166219(0x1d1),'/status/'+_0x21b73a[_0x166219(0x219)],_0x3ff571);}}console[_0x166219(0x22e)](_0x166219(0x1f2)+_0x46bcb3+_0x166219(0x263)+_0x52a450+_0x166219(0x208)+_0x5bb55b[_0x166219(0x1d3)]+_0x166219(0x260));}catch(_0x3766b5){console['error'](_0x166219(0x173),_0x3766b5);}}async[a48_0x145bd0(0x258)](_0x5b6d5b){const _0x37874e=a48_0x145bd0,_0x509a49=[],_0x5c8e37=new Date();_0x5c8e37[_0x37874e(0x1aa)](_0x5c8e37[_0x37874e(0x161)]()-this['EXPIRY_DAYS']),console[_0x37874e(0x22e)](_0x37874e(0x168)+this[_0x37874e(0x231)]+_0x37874e(0x251)+_0x5c8e37[_0x37874e(0x255)]()+')');for(const _0x4843f4 of _0x5b6d5b){if(_0x4843f4['createdAt']<_0x5c8e37){console['log']('â°\x20[EXPIRY]\x20Payment\x20'+_0x4843f4['id']+_0x37874e(0x1cb)+this[_0x37874e(0x231)]+_0x37874e(0x1b4));try{this[_0x37874e(0x207)](_0x4843f4['id'],_0x4843f4['gatewayPaymentId']||_0x37874e(0x19c),_0x37874e(0x1a3),_0x37874e(0x247),_0x37874e(0x1db),{'reason':_0x37874e(0x245)+this[_0x37874e(0x231)]+_0x37874e(0x1ca),'createdAt':_0x4843f4[_0x37874e(0x216)],'daysSinceCreation':Math[_0x37874e(0x169)]((Date['now']()-_0x4843f4[_0x37874e(0x216)][_0x37874e(0x241)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x4843f4[_0x37874e(0x267)],'paymentCurrency':_0x4843f4[_0x37874e(0x205)],'shopId':_0x4843f4[_0x37874e(0x17b)]}),await database_1[_0x37874e(0x17d)][_0x37874e(0x234)][_0x37874e(0x235)]({'where':{'id':_0x4843f4['id']},'data':{'status':'EXPIRED','updatedAt':new Date()}}),await database_1[_0x37874e(0x17d)][_0x37874e(0x22d)][_0x37874e(0x264)]({'data':{'paymentId':_0x4843f4['id'],'shopId':_0x4843f4[_0x37874e(0x17b)],'event':_0x37874e(0x1a0),'statusCode':0xc8,'responseBody':JSON[_0x37874e(0x1af)]({'reason':_0x37874e(0x245)+this[_0x37874e(0x231)]+_0x37874e(0x1ca),'createdAt':_0x4843f4[_0x37874e(0x216)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x37874e(0x169)]((Date[_0x37874e(0x243)]()-_0x4843f4[_0x37874e(0x216)][_0x37874e(0x241)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x4843f4,_0x37874e(0x247)),await this[_0x37874e(0x190)](_0x4843f4,'EXPIRED'),this[_0x37874e(0x25a)](_0x4843f4['id']),_0x509a49[_0x37874e(0x1a6)](_0x4843f4['id']),console[_0x37874e(0x22e)](_0x37874e(0x16a)+_0x4843f4['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x37874e(0x231)]+_0x37874e(0x222));}catch(_0x3a6792){console[_0x37874e(0x1c3)](_0x37874e(0x25f)+_0x4843f4['id']+':',_0x3a6792),this['logCoinToPayError'](_0x4843f4['id'],_0x4843f4[_0x37874e(0x219)]||_0x37874e(0x19c),_0x3a6792,_0x37874e(0x1db),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x4843f4[_0x37874e(0x216)],'daysSinceCreation':Math['floor']((Date[_0x37874e(0x243)]()-_0x4843f4[_0x37874e(0x216)][_0x37874e(0x241)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x509a49;}async[a48_0x145bd0(0x1cf)](_0x4d2fc9){const _0x486605=a48_0x145bd0;if(!_0x4d2fc9[_0x486605(0x219)]){console[_0x486605(0x22e)]('âš ï¸\x20[CHECK]\x20Payment\x20'+_0x4d2fc9['id']+_0x486605(0x1b1));return;}console[_0x486605(0x22e)](_0x486605(0x1e1)+_0x4d2fc9['gateway']+_0x486605(0x214)+_0x4d2fc9['id']+'\x20('+_0x4d2fc9[_0x486605(0x219)]+')');try{let _0x296c28;_0x4d2fc9[_0x486605(0x192)]===_0x486605(0x259)?(_0x296c28=await this[_0x486605(0x1c8)]['checkPaymentStatus'](_0x4d2fc9[_0x486605(0x219)]),console['log'](_0x486605(0x269)+_0x4d2fc9['id']+_0x486605(0x184)+_0x296c28['status'])):(_0x296c28=await this[_0x486605(0x25c)][_0x486605(0x1ae)](_0x4d2fc9[_0x486605(0x219)]),console[_0x486605(0x22e)](_0x486605(0x1ef)+_0x4d2fc9['id']+_0x486605(0x184)+_0x296c28[_0x486605(0x21e)]));_0x296c28[_0x486605(0x233)]&&console[_0x486605(0x22e)](_0x486605(0x261)+_0x4d2fc9['id']+_0x486605(0x1c4),{'iban':_0x296c28[_0x486605(0x233)]['iban']||_0x486605(0x249),'transactionId':_0x296c28[_0x486605(0x233)]['transactionId'],'createdOn':_0x296c28[_0x486605(0x233)][_0x486605(0x17f)],'confirmedOn':_0x296c28['paymentDetails']['confirmedOn']||_0x486605(0x224)});if(_0x296c28[_0x486605(0x21e)]!==_0x4d2fc9['status']){console[_0x486605(0x22e)]('ðŸ”„\x20[CHECK]\x20Updating\x20payment\x20'+_0x4d2fc9['id']+_0x486605(0x237)+_0x4d2fc9['status']+_0x486605(0x197)+_0x296c28[_0x486605(0x21e)]),this[_0x486605(0x207)](_0x4d2fc9['id'],_0x4d2fc9[_0x486605(0x219)],_0x4d2fc9['status'],_0x296c28[_0x486605(0x21e)],_0x486605(0x268),{'paymentDetails':_0x296c28['paymentDetails'],'amount':_0x296c28[_0x486605(0x267)],'currency':_0x296c28[_0x486605(0x205)],'shopId':_0x4d2fc9[_0x486605(0x17b)],'checkTimestamp':new Date()[_0x486605(0x255)]()});const _0x4aa3eb={'status':_0x296c28[_0x486605(0x21e)],'updatedAt':new Date()};if(_0x296c28[_0x486605(0x21e)]===_0x486605(0x162)&&_0x4d2fc9['status']!==_0x486605(0x162)){_0x4aa3eb['paidAt']=new Date();if(!_0x4d2fc9[_0x486605(0x1e0)]){const _0x549234=await currencyService_1[_0x486605(0x1fd)]['convertToUSDT'](_0x4d2fc9[_0x486605(0x267)],_0x4d2fc9[_0x486605(0x205)]);_0x4aa3eb[_0x486605(0x1e0)]=_0x549234;const _0x43f399=await this[_0x486605(0x191)](_0x4d2fc9[_0x486605(0x17b)],_0x4d2fc9['gateway']),_0x4f5751=_0x549234*(0x1-_0x43f399/0x64);_0x4aa3eb[_0x486605(0x19a)]=_0x4f5751,_0x4aa3eb[_0x486605(0x18d)]=_0x43f399,console[_0x486605(0x22e)](_0x486605(0x1e5)+_0x4d2fc9['id']+_0x486605(0x20b)),console['log'](_0x486605(0x171)+_0x4d2fc9[_0x486605(0x267)]+'\x20'+_0x4d2fc9[_0x486605(0x205)]+_0x486605(0x21c)+_0x549234[_0x486605(0x1a7)](0x6)+'\x20USDT'),console[_0x486605(0x22e)]('\x20\x20\x20Gateway\x20'+_0x4d2fc9[_0x486605(0x192)]+_0x486605(0x1a5)+_0x43f399+'%'),console[_0x486605(0x22e)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x4f5751[_0x486605(0x1a7)](0x6)+_0x486605(0x210));}console[_0x486605(0x22e)]('ðŸ’°\x20[CHECK]\x20Payment\x20'+_0x4d2fc9['id']+_0x486605(0x174)+_0x4aa3eb[_0x486605(0x183)]['toISOString']());}if(_0x296c28[_0x486605(0x233)]){const _0x2231cd=_0x296c28[_0x486605(0x233)];_0x2231cd['iban']&&(_0x4aa3eb[_0x486605(0x177)]=_0x2231cd[_0x486605(0x1cd)],console[_0x486605(0x22e)]('ðŸ¦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x2231cd[_0x486605(0x1cd)])),_0x2231cd[_0x486605(0x22f)]&&console[_0x486605(0x22e)]('ðŸ¦\x20[CHECK]\x20Bank\x20details\x20provided:\x20'+_0x2231cd[_0x486605(0x22f)]),_0x2231cd['transactionId']&&console['log'](_0x486605(0x26b)+_0x2231cd[_0x486605(0x1b0)]),_0x2231cd[_0x486605(0x19e)]&&console['log']('âœ…\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x2231cd[_0x486605(0x19e)]);}await database_1[_0x486605(0x17d)][_0x486605(0x234)]['update']({'where':{'id':_0x4d2fc9['id']},'data':_0x4aa3eb});if(_0x296c28[_0x486605(0x21e)]===_0x486605(0x162)&&_0x4d2fc9['status']!==_0x486605(0x162)){console[_0x486605(0x22e)]('ðŸ“ˆ\x20[COINTOPAY]\x20Payment\x20'+_0x4d2fc9['id']+_0x486605(0x1b3));const _0x47f94d=await database_1['default'][_0x486605(0x234)][_0x486605(0x1ee)]({'where':{'id':_0x4d2fc9['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x47f94d?.['paymentLinkId']&&_0x47f94d[_0x486605(0x1eb)])try{const _0x5ebc82=_0x47f94d[_0x486605(0x1eb)];console['log']('ðŸ“ˆ\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x5ebc82['id']+_0x486605(0x1e9)+_0x5ebc82[_0x486605(0x16e)]+_0x486605(0x196)+_0x5ebc82[_0x486605(0x1c6)]+',\x20status='+_0x5ebc82[_0x486605(0x21e)]);const _0x4e422e=_0x5ebc82[_0x486605(0x1c6)]+0x1,_0x10e655=_0x5ebc82['type']===_0x486605(0x253)?_0x486605(0x187):_0x5ebc82[_0x486605(0x21e)];await database_1[_0x486605(0x17d)][_0x486605(0x1eb)]['update']({'where':{'id':_0x5ebc82['id']},'data':{'currentPayments':_0x4e422e,'status':_0x10e655,'updatedAt':new Date()}}),console[_0x486605(0x22e)](_0x486605(0x1b6)+_0x5ebc82['id']+_0x486605(0x178)+_0x5ebc82[_0x486605(0x1c6)]+_0x486605(0x21c)+_0x4e422e+',\x20status='+_0x5ebc82['status']+_0x486605(0x21c)+_0x10e655);}catch(_0x2921a7){console[_0x486605(0x1c3)](_0x486605(0x24c),_0x2921a7);}else console[_0x486605(0x22e)](_0x486605(0x265)+_0x4d2fc9['id']+_0x486605(0x185));}await database_1[_0x486605(0x17d)]['webhookLog'][_0x486605(0x264)]({'data':{'paymentId':_0x4d2fc9['id'],'shopId':_0x4d2fc9[_0x486605(0x17b)],'event':_0x486605(0x16c)+_0x296c28[_0x486605(0x21e)][_0x486605(0x1f4)](),'statusCode':0xc8,'responseBody':JSON[_0x486605(0x1af)]({'oldStatus':_0x4d2fc9['status'],'newStatus':_0x296c28[_0x486605(0x21e)],'paymentDetails':_0x296c28[_0x486605(0x233)],'checkedAt':new Date()['toISOString']()})}}),await this['sendShopWebhook'](_0x4d2fc9,_0x296c28[_0x486605(0x21e)]),await this[_0x486605(0x190)](_0x4d2fc9,_0x296c28[_0x486605(0x21e)]),_0x296c28[_0x486605(0x21e)]!=='PENDING'&&(console[_0x486605(0x22e)]('ðŸ§¹\x20[CHECK]\x20Payment\x20'+_0x4d2fc9['id']+_0x486605(0x1fc)+_0x296c28[_0x486605(0x21e)]+_0x486605(0x209)),this[_0x486605(0x25a)](_0x4d2fc9['id'])),console[_0x486605(0x22e)](_0x486605(0x21d)+_0x4d2fc9['id']+_0x486605(0x1f0));}else console[_0x486605(0x22e)](_0x486605(0x261)+_0x4d2fc9['id']+_0x486605(0x23f)+_0x296c28[_0x486605(0x21e)]+')'),this['logCoinToPayStatus'](_0x4d2fc9['id'],_0x4d2fc9[_0x486605(0x219)],_0x4d2fc9[_0x486605(0x21e)],_0x296c28[_0x486605(0x21e)],_0x486605(0x268),{'statusUnchanged':!![],'paymentDetails':_0x296c28['paymentDetails'],'amount':_0x296c28['amount'],'currency':_0x296c28[_0x486605(0x205)],'shopId':_0x4d2fc9[_0x486605(0x17b)],'checkTimestamp':new Date()[_0x486605(0x255)]()});}catch(_0x1be38e){console[_0x486605(0x1c3)](_0x486605(0x1f7)+_0x4d2fc9['id']+':',_0x1be38e),this[_0x486605(0x1c7)](_0x4d2fc9['id'],_0x4d2fc9[_0x486605(0x219)],_0x1be38e,_0x486605(0x268),{'paymentAmount':_0x4d2fc9[_0x486605(0x267)],'paymentCurrency':_0x4d2fc9['currency'],'shopId':_0x4d2fc9['shopId'],'createdAt':_0x4d2fc9['createdAt']}),await database_1['default']['webhookLog']['create']({'data':{'paymentId':_0x4d2fc9['id'],'shopId':_0x4d2fc9['shopId'],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x1be38e instanceof Error?_0x1be38e[_0x486605(0x223)]:'Unknown\x20error','gatewayPaymentId':_0x4d2fc9[_0x486605(0x219)],'checkedAt':new Date()[_0x486605(0x255)]()})}});}}async['sendShopWebhook'](_0xa49427,_0x5ae598){const _0x4a9c9d=a48_0x145bd0,_0x3825b3=Date[_0x4a9c9d(0x243)]();try{const _0x42eae3=_0xa49427[_0x4a9c9d(0x1ce)],_0x4b09cc=_0x42eae3['settings'];if(!_0x4b09cc?.[_0x4a9c9d(0x1a9)]){console[_0x4a9c9d(0x22e)](_0x4a9c9d(0x200)+_0x42eae3['id']);return;}const _0x2b9153=_0x5ae598===_0x4a9c9d(0x162)?_0x4a9c9d(0x1d6):_0x5ae598===_0x4a9c9d(0x1d8)?_0x4a9c9d(0x167):_0x5ae598===_0x4a9c9d(0x247)?'payment.failed':_0x4a9c9d(0x22c);if(!_0x4b09cc[_0x4a9c9d(0x266)]?.['includes'](_0x2b9153)){console['log'](_0x4a9c9d(0x256)+_0x2b9153+'\x20not\x20enabled\x20for\x20shop\x20'+_0x42eae3['id']);return;}const _0x423269=(0x0,gateway_1[_0x4a9c9d(0x165)])(_0xa49427['gateway'])||_0xa49427['gateway'],_0x38596a={'event':_0x2b9153,'payment':{'id':_0xa49427['id'],'order_id':_0xa49427[_0x4a9c9d(0x236)],'gateway_order_id':_0xa49427[_0x4a9c9d(0x172)],'gateway':_0x423269,'amount':_0xa49427[_0x4a9c9d(0x267)],'currency':_0xa49427[_0x4a9c9d(0x205)],'status':_0x5ae598[_0x4a9c9d(0x1f4)](),'customer_email':_0xa49427[_0x4a9c9d(0x23a)],'customer_name':_0xa49427[_0x4a9c9d(0x1ac)],'created_at':_0xa49427['createdAt'],'updated_at':new Date()}},_0x3a48cc=await fetch(_0x4b09cc[_0x4a9c9d(0x1a9)],{'method':_0x4a9c9d(0x254),'headers':{'Content-Type':'application/json','User-Agent':_0x4a9c9d(0x226)},'body':JSON[_0x4a9c9d(0x1af)](_0x38596a)}),_0x44ecaf=Date[_0x4a9c9d(0x243)]()-_0x3825b3,_0x358a51=_0x3a48cc['ok']?'Success':await _0x3a48cc[_0x4a9c9d(0x21f)]();loggerService_1[_0x4a9c9d(0x20e)][_0x4a9c9d(0x1d2)](_0xa49427['shopId'],_0x4b09cc[_0x4a9c9d(0x1a9)],_0x2b9153,_0x3a48cc[_0x4a9c9d(0x21e)],_0x44ecaf,_0x38596a),console[_0x4a9c9d(0x22e)](_0x4a9c9d(0x1f8)+_0x4b09cc[_0x4a9c9d(0x1a9)]+_0x4a9c9d(0x239)+_0x3a48cc[_0x4a9c9d(0x21e)]+'\x20('+_0x44ecaf+'ms)');}catch(_0x489a4b){console[_0x4a9c9d(0x1c3)](_0x4a9c9d(0x218),_0x489a4b),loggerService_1['loggerService'][_0x4a9c9d(0x19f)](_0xa49427[_0x4a9c9d(0x17b)],_0xa49427['shop']?.['settings']?.[_0x4a9c9d(0x1a9)]||'unknown',_0x4a9c9d(0x199),_0x489a4b,{});}}async[a48_0x145bd0(0x190)](_0x482ecd,_0x133c26){const _0x364b04=a48_0x145bd0;try{const _0x1432f4={'PENDING':_0x364b04(0x198),'PAID':_0x364b04(0x1c0),'FAILED':_0x364b04(0x1e8),'EXPIRED':'expired'},_0x3d82a0=_0x1432f4[_0x133c26];if(!_0x3d82a0||_0x3d82a0===_0x364b04(0x198))return;await telegramBotService_1[_0x364b04(0x201)]['sendPaymentNotification'](_0x482ecd[_0x364b04(0x17b)],_0x482ecd,_0x3d82a0);}catch(_0x51763a){console['error'](_0x364b04(0x1ea),_0x51763a);}}async['checkPaymentById'](_0x3eec64){const _0x3170aa=a48_0x145bd0;console[_0x3170aa(0x22e)]('ðŸ”\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x3eec64);const _0x35c24e=await database_1[_0x3170aa(0x17d)][_0x3170aa(0x234)]['findUnique']({'where':{'id':_0x3eec64},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x35c24e)throw new Error(_0x3170aa(0x1da));if(_0x35c24e[_0x3170aa(0x192)]!==_0x3170aa(0x1d1)&&_0x35c24e[_0x3170aa(0x192)]!==_0x3170aa(0x259))throw new Error(_0x3170aa(0x1b2));console['log']('âœ…\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x35c24e[_0x3170aa(0x192)]+'\x20payment\x20'+_0x3eec64),await this['checkSinglePayment'](_0x35c24e),console[_0x3170aa(0x22e)](_0x3170aa(0x232)+_0x3eec64);}['getServiceStats'](){const _0x43d688=a48_0x145bd0,_0x2106d9=this[_0x43d688(0x21a)]?this[_0x43d688(0x1e3)]:undefined,_0x47e124=Array['from'](this[_0x43d688(0x160)][_0x43d688(0x1de)]())['map'](_0x1828a2=>({'paymentId':_0x1828a2[_0x43d688(0x1f3)],'gatewayPaymentId':_0x1828a2[_0x43d688(0x219)],'createdAt':_0x1828a2[_0x43d688(0x216)],'timersCount':_0x1828a2[_0x43d688(0x206)][_0x43d688(0x1d3)]}));return{'isActive':!!this[_0x43d688(0x21a)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this[_0x43d688(0x231)],'activeIndividualTimers':this[_0x43d688(0x160)][_0x43d688(0x1f1)],'nextGlobalCheckIn':_0x2106d9,'paymentTimersDetails':_0x47e124};}[a48_0x145bd0(0x22b)](_0x45ac2c){const _0x3a53b6=a48_0x145bd0,_0x5483d9=this[_0x3a53b6(0x160)][_0x3a53b6(0x24b)](_0x45ac2c);if(_0x5483d9)return{'hasTimers':!![],'timersCount':_0x5483d9['timers'][_0x3a53b6(0x1d3)],'createdAt':_0x5483d9[_0x3a53b6(0x216)],'gatewayPaymentId':_0x5483d9[_0x3a53b6(0x219)]};return{'hasTimers':![]};}async[a48_0x145bd0(0x191)](_0x29ba9a,_0x591cc9){const _0x272e93=a48_0x145bd0;try{const _0x5deba7=await database_1['default'][_0x272e93(0x1ce)][_0x272e93(0x1ee)]({'where':{'id':_0x29ba9a},'select':{'gatewaySettings':!![]}});if(!_0x5deba7?.['gatewaySettings'])return console[_0x272e93(0x22e)](_0x272e93(0x1e4)+_0x29ba9a+_0x272e93(0x212)),0xa;const _0x27f7f2=JSON[_0x272e93(0x23b)](_0x5deba7[_0x272e93(0x244)]);for(const [_0x2f8c9c,_0x5424b9]of Object[_0x272e93(0x262)](_0x27f7f2)){if(_0x2f8c9c[_0x272e93(0x1f4)]()===_0x591cc9[_0x272e93(0x1f4)]()){const _0x27a4d0=_0x5424b9[_0x272e93(0x17a)]||0xa;return console[_0x272e93(0x22e)](_0x272e93(0x17e)+_0x591cc9+'\x20commission\x20for\x20shop\x20'+_0x29ba9a+':\x20'+_0x27a4d0+'%'),_0x27a4d0;}}return console[_0x272e93(0x22e)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x591cc9+_0x272e93(0x16b)+_0x29ba9a+_0x272e93(0x1d7)),0xa;}catch(_0x3495da){return console[_0x272e93(0x1c3)](_0x272e93(0x1b9)+_0x29ba9a+_0x272e93(0x1d9)+_0x591cc9+':',_0x3495da),0xa;}}}exports[a48_0x145bd0(0x1b8)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();