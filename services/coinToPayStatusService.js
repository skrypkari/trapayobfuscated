'use strict';const a37_0x3682ca=a37_0x3925;(function(_0x3f6754,_0x26b467){const _0x1aac5d=a37_0x3925,_0x44b6f9=_0x3f6754();while(!![]){try{const _0x43bf83=parseInt(_0x1aac5d(0x281))/0x1+-parseInt(_0x1aac5d(0x18b))/0x2*(-parseInt(_0x1aac5d(0x212))/0x3)+-parseInt(_0x1aac5d(0x1b6))/0x4*(-parseInt(_0x1aac5d(0x190))/0x5)+parseInt(_0x1aac5d(0x22d))/0x6+-parseInt(_0x1aac5d(0x1fa))/0x7*(-parseInt(_0x1aac5d(0x237))/0x8)+parseInt(_0x1aac5d(0x1c3))/0x9+parseInt(_0x1aac5d(0x193))/0xa*(-parseInt(_0x1aac5d(0x1df))/0xb);if(_0x43bf83===_0x26b467)break;else _0x44b6f9['push'](_0x44b6f9['shift']());}catch(_0x2d6440){_0x44b6f9['push'](_0x44b6f9['shift']());}}}(a37_0x4719,0xea339));function a37_0x4719(){const _0x58dc1d=['includes','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','EXPIRY_DAYS','paymentTimers','schedulePaymentChecks','telegramBotService','Success','\x20updated:\x20currentPayments=','/status/','webhookLog','3835349OblQXk','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','__importDefault','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','üìä\x20[HOURLY]\x20Payment\x20','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','5\x20minutes','\x20individual\x20payment\x20timers','./loggerService','‚úÖ\x20[CHECK]\x20Payment\x20','shopId','\x20payment\x20','settings','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','-day\x20timeout','stringify','coinToPayStatusService','expired','\x20status:\x20','sendPaymentNotification','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','gateway','44895pqYdfr','gatewayOrderId','\x20\x20\x20üìù\x20Details:','üßπ\x20[DEBUG]\x20Clearing\x20','message','CoinToPayService','log','status','currentPayments','CoinToPayStatusService','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','logShopWebhookError','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','map','GLOBAL_CHECK_INTERVAL_MS','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','PAID','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20',':\x20type=','cointopay_auto_expired','Payment\x20older\x20than\x20','\x20not\x20found\x20in\x20database','\x20initial\x20timers\x20for\x20payment\x20','length',',\x20status=','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','183480odyICK','checkPaymentStatus','createdOn','has','create','\x20found:','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','\x20to\x20clear','Payment\x20not\x20found','checkSinglePaymentById','24AuOIqf','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','customerName','startPeriodicStatusCheck','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','sendPaymentStatusNotification','\x20is\x20too\x20new\x20(','./gateways/coinToPayService','\x20completed\x20for\x20payment\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','clearPaymentTimers','size','\x20expired','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','error','\x20seconds\x20(','\x20\x20\x20-\x20Gateway:\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','gatewayPaymentId','\x20marked\x20as\x20paid\x20at:\x20','\x20timers\x20for\x20payment\x20','\x20current\x20status:\x20','iban','paymentId','unknown','\x20\x20\x20üìä\x20Status:\x20','Shop\x20webhook\x20sent\x20to\x20','paymentLink','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','checkPaymentById','\x20\x20\x20üìç\x20Source:\x20','paymentLinkId','logCoinToPayError','EXPIRED','sendShopWebhook','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20triggered\x20for\x20payment\x20','\x20with\x20status\x20','paid','schedule_created','\x20updated\x20successfully','shop','set','checkSinglePayment','payment.failed','from','timestamp','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20expired\x20CoinToPay\x20payments','transactionId','toISOString','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','get','auto_expire','‚è∞\x20[EXPIRY]\x20Payment\x20','CoinToPay2Service','createdAt','payment','created','‚è∞\x20[GLOBAL]\x20Payment\x20','toFixed','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','__esModule','bankDetails','ü™ô\x20[DEBUG]\x20Creating\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','payment.pending','\x20\x20\x20-\x20Amount:\x20','.\x20Remaining\x20active\x20timers:\x20','application/json','1554498VhEQoa','./gateways/coinToPay2Service','../types/gateway','‚ùå\x20[CHECK]\x20Payment\x20','push','Automatically\x20expired\x20after\x20','type','coinToPay2Service','\x20(after\x20','findMany','findUnique','delay','‚úÖ\x20[HOURLY]\x20Payment\x20','ms)','\x20checked,\x20','confirmedOn','status_check','254cUbebz',',\x20clearing\x20individual\x20timers','amount','\x20not\x20enabled\x20for\x20shop\x20','COINTOPAY_ERROR','8468505ZDaAvY','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','getGatewayIdByName','80NBTxkJ','checkExpiredPayments','\x20\x20\x20-\x20paymentId:\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','h),\x20skipping\x20global\x20check','\x20days,\x20marking\x20as\x20EXPIRED','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','üõë\x20[SHUTDOWN]\x20Cleared\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','\x20status\x20from\x20','logCoinToPayStatus','now','catch','default','not\x20confirmed','toLowerCase','\x20status\x20is\x20',',\x20stopping\x20individual\x20checks','currency','getServiceStats','Bank\x20Details:\x20','loggerService','./telegramBotService','cointopay_status_check_error','üìä\x20[CHECK]\x20Payment\x20','text','‚è∞\x20[GLOBAL]\x20Found\x20','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','cointopay','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','getDate','üìà\x20[COINTOPAY]\x20Payment\x20','POST','4eFpSaj','cointopay2','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','description','\x20has\x20no\x20gatewayPaymentId','‚è∞\x20[HOURLY]\x20Payment\x20','timers','\x20to\x20','üí∞\x20[CHECK]\x20Payment\x20','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','values','16825122GcNfDr','\x20days\x20without\x20payment\x20confirmation','logShopWebhookSent','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','logWhiteDomainError','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','delete','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','remitterIban','\x20has\x20no\x20gatewayPaymentId,\x20skipping','globalCheckInterval','\x20->\x20','1\x20minute','checkAllPendingPayments','\x20details:','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20\x20\x20‚ùå\x20Error:\x20','forEach','Webhook\x20event\x20','adminNotes','cointopay_status_check_','\x20\x20\x20-\x20ShopId:\x20','Failed\x20to\x20send\x20shop\x20webhook:','\x20in\x20','paymentDetails','\x20is\x20older\x20than\x20','COMPLETED','10633183JvORSx','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','webhookUrl','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','orderId','\x20not\x20found,\x20clearing\x20timers','\x20status\x20unchanged\x20(','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20for\x20payment\x20','getTime','PENDING','update','not\x20found','üîç\x20[CHECK]\x20Checking\x20','floor','üßπ\x20[CHECK]\x20Payment\x20','stack'];a37_0x4719=function(){return _0x58dc1d;};return a37_0x4719();}function a37_0x3925(_0x2136ec,_0x2ce5a3){const _0x471983=a37_0x4719();return a37_0x3925=function(_0x39259e,_0x18ddb4){_0x39259e=_0x39259e-0x18a;let _0x24a1d3=_0x471983[_0x39259e];return _0x24a1d3;},a37_0x3925(_0x2136ec,_0x2ce5a3);}var __importDefault=this&&this[a37_0x3682ca(0x1fc)]||function(_0x51dddc){return _0x51dddc&&_0x51dddc['__esModule']?_0x51dddc:{'default':_0x51dddc};};Object['defineProperty'](exports,a37_0x3682ca(0x279),{'value':!![]}),exports[a37_0x3682ca(0x20c)]=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require(a37_0x3682ca(0x23e)),coinToPay2Service_1=require(a37_0x3682ca(0x282)),gateway_1=require(a37_0x3682ca(0x283)),database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a37_0x3682ca(0x1aa)),loggerService_1=require(a37_0x3682ca(0x204));class CoinToPayStatusService{constructor(){const _0x1b15ed=a37_0x3682ca;this['globalCheckInterval']=null,this[_0x1b15ed(0x221)]=0x3c*0x3c*0x3e8,this[_0x1b15ed(0x1f2)]=0x5,this['paymentTimers']=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x1b15ed(0x217))](),this[_0x1b15ed(0x288)]=new coinToPay2Service_1[(_0x1b15ed(0x272))](),console[_0x1b15ed(0x218)](_0x1b15ed(0x21f));}[a37_0x3682ca(0x1f4)](_0x1502c4,_0x4cc4c8){const _0x2191f6=a37_0x3682ca;console[_0x2191f6(0x218)](_0x2191f6(0x1c8)),console[_0x2191f6(0x218)](_0x2191f6(0x195)+_0x1502c4),console[_0x2191f6(0x218)]('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x4cc4c8),this[_0x2191f6(0x241)](_0x1502c4);const _0x3786b8=[],_0x4cddbe=new Date(),_0x639196=[{'delay':0x1*0x3c*0x3e8,'description':_0x2191f6(0x1d0)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x2191f6(0x202)},{'delay':0x5*0x3c*0x3e8,'description':_0x2191f6(0x202)}];console[_0x2191f6(0x218)](_0x2191f6(0x27b)+_0x639196[_0x2191f6(0x22a)]+_0x2191f6(0x229)+_0x1502c4);let _0x5d0874=0x0;_0x639196['forEach']((_0x1bde58,_0x2e2e39)=>{const _0xa02979=_0x2191f6;_0x5d0874+=_0x1bde58['delay'];const _0x5ba69c=setTimeout(async()=>{const _0x44c938=a37_0x3925;console[_0x44c938(0x218)](_0x44c938(0x197)+(_0x2e2e39+0x1)+_0x44c938(0x25d)+_0x1502c4+_0x44c938(0x289)+_0x1bde58[_0x44c938(0x1b9)]+')');try{await this[_0x44c938(0x236)](_0x1502c4),console[_0x44c938(0x218)](_0x44c938(0x27c)+(_0x2e2e39+0x1)+_0x44c938(0x23f)+_0x1502c4);}catch(_0x27fc9f){console[_0x44c938(0x246)](_0x44c938(0x26d)+(_0x2e2e39+0x1)+'\x20for\x20payment\x20'+_0x1502c4+':',_0x27fc9f),this['logCoinToPayError'](_0x1502c4,_0x4cc4c8,_0x27fc9f,_0x44c938(0x18a),{'checkNumber':_0x2e2e39+0x1,'scheduledAfter':_0x1bde58[_0x44c938(0x1b9)],'isIndividualCheck':!![]});}},_0x5d0874);_0x3786b8['push'](_0x5ba69c),console[_0xa02979(0x218)]('‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x2e2e39+0x1)+_0xa02979(0x1e7)+_0x1502c4+_0xa02979(0x1db)+_0x5d0874/0x3e8+_0xa02979(0x247)+_0x1bde58['description']+')');});const _0x3f5d1b=setInterval(async()=>{const _0x1e4321=_0x2191f6;console[_0x1e4321(0x218)](_0x1e4321(0x26e)+_0x1502c4);try{const _0x422794=await database_1[_0x1e4321(0x1a1)]['payment'][_0x1e4321(0x28b)]({'where':{'id':_0x1502c4},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x422794){console[_0x1e4321(0x218)]('‚ùå\x20[HOURLY]\x20Payment\x20'+_0x1502c4+_0x1e4321(0x1e4)),this[_0x1e4321(0x241)](_0x1502c4);return;}console[_0x1e4321(0x218)](_0x1e4321(0x1ff)+_0x1502c4+_0x1e4321(0x24e)+_0x422794[_0x1e4321(0x219)]);if(_0x422794[_0x1e4321(0x219)]!==_0x1e4321(0x1e9)){console[_0x1e4321(0x218)](_0x1e4321(0x28d)+_0x1502c4+_0x1e4321(0x1a4)+_0x422794[_0x1e4321(0x219)]+_0x1e4321(0x1a5)),this[_0x1e4321(0x241)](_0x1502c4);return;}const _0x44d4ef=Math[_0x1e4321(0x1ed)]((Date[_0x1e4321(0x19f)]()-_0x422794[_0x1e4321(0x273)][_0x1e4321(0x1e8)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x44d4ef>=this[_0x1e4321(0x1f2)]){console[_0x1e4321(0x218)](_0x1e4321(0x1bb)+_0x1502c4+_0x1e4321(0x1dd)+this[_0x1e4321(0x1f2)]+_0x1e4321(0x240)),this[_0x1e4321(0x241)](_0x1502c4);return;}await this['checkSinglePaymentById'](_0x1502c4),console[_0x1e4321(0x218)]('‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x1502c4);}catch(_0x586b33){console[_0x1e4321(0x246)](_0x1e4321(0x201)+_0x1502c4+':',_0x586b33),this[_0x1e4321(0x259)](_0x1502c4,_0x4cc4c8,_0x586b33,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x3786b8[_0x2191f6(0x285)](_0x3f5d1b),this[_0x2191f6(0x1f3)][_0x2191f6(0x263)](_0x1502c4,{'timers':_0x3786b8,'paymentId':_0x1502c4,'gatewayPaymentId':_0x4cc4c8,'createdAt':_0x4cddbe}),console[_0x2191f6(0x218)](_0x2191f6(0x21c)+_0x639196['length']+_0x2191f6(0x1b8)+_0x1502c4),console[_0x2191f6(0x218)](_0x2191f6(0x1bf)+this['paymentTimers'][_0x2191f6(0x242)]),this[_0x2191f6(0x19e)](_0x1502c4,_0x4cc4c8,_0x2191f6(0x1e9),_0x2191f6(0x1e9),_0x2191f6(0x18a),{'action':_0x2191f6(0x260),'scheduledChecks':_0x639196[_0x2191f6(0x22a)],'firstCheckIn':_0x639196[0x0][_0x2191f6(0x28c)]/0x3e8,'totalTimers':this[_0x2191f6(0x1f3)][_0x2191f6(0x242)]});}[a37_0x3682ca(0x241)](_0x120072){const _0x41eaf8=a37_0x3682ca,_0x5f2b35=this[_0x41eaf8(0x1f3)]['get'](_0x120072);_0x5f2b35?(console[_0x41eaf8(0x218)](_0x41eaf8(0x215)+_0x5f2b35['timers'][_0x41eaf8(0x22a)]+_0x41eaf8(0x24d)+_0x120072),_0x5f2b35['timers'][_0x41eaf8(0x1d5)]((_0x28a48a,_0x50e54c)=>{const _0x297e29=_0x41eaf8;_0x28a48a&&(clearTimeout(_0x28a48a),clearInterval(_0x28a48a),console['log'](_0x297e29(0x233)+(_0x50e54c+0x1)+_0x297e29(0x1e7)+_0x120072));}),this['paymentTimers'][_0x41eaf8(0x1ca)](_0x120072),console['log'](_0x41eaf8(0x1d3)+_0x120072+_0x41eaf8(0x27f)+this[_0x41eaf8(0x1f3)]['size'])):console[_0x41eaf8(0x218)](_0x41eaf8(0x255)+_0x120072+_0x41eaf8(0x234));}async[a37_0x3682ca(0x236)](_0x259a6c){const _0x4b6a33=a37_0x3682ca;console[_0x4b6a33(0x218)](_0x4b6a33(0x278)+_0x259a6c);const _0x4d150d=await database_1[_0x4b6a33(0x1a1)][_0x4b6a33(0x274)]['findUnique']({'where':{'id':_0x259a6c},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4d150d){console['log'](_0x4b6a33(0x284)+_0x259a6c+_0x4b6a33(0x228));return;}console[_0x4b6a33(0x218)](_0x4b6a33(0x1ac)+_0x259a6c+_0x4b6a33(0x232)),console[_0x4b6a33(0x218)](_0x4b6a33(0x248)+_0x4d150d['gateway']),console[_0x4b6a33(0x218)]('\x20\x20\x20-\x20Status:\x20'+_0x4d150d['status']),console['log'](_0x4b6a33(0x1b2)+_0x4d150d[_0x4b6a33(0x24b)]),console[_0x4b6a33(0x218)](_0x4b6a33(0x27e)+_0x4d150d[_0x4b6a33(0x18d)]+'\x20'+_0x4d150d['currency']),console['log'](_0x4b6a33(0x1d9)+_0x4d150d['shopId']);if(_0x4d150d[_0x4b6a33(0x211)]!==_0x4b6a33(0x1b0)&&_0x4d150d['gateway']!==_0x4b6a33(0x1b7)){console['log'](_0x4b6a33(0x1e0)+_0x259a6c+_0x4b6a33(0x245)+_0x4d150d[_0x4b6a33(0x211)]+')');return;}if(_0x4d150d[_0x4b6a33(0x219)]!=='PENDING'){console[_0x4b6a33(0x218)](_0x4b6a33(0x1e0)+_0x259a6c+'\x20status\x20is\x20'+_0x4d150d[_0x4b6a33(0x219)]+',\x20stopping\x20individual\x20checks'),this['clearPaymentTimers'](_0x259a6c);return;}if(!_0x4d150d['gatewayPaymentId']){console[_0x4b6a33(0x218)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x259a6c+_0x4b6a33(0x1ba));return;}console[_0x4b6a33(0x218)](_0x4b6a33(0x205)+_0x259a6c+_0x4b6a33(0x269)),await this[_0x4b6a33(0x264)](_0x4d150d);}[a37_0x3682ca(0x19e)](_0x5914fd,_0x4d0f10,_0x3009d4,_0x752c75,_0x57bd8a,_0x281552){const _0x4de93e=a37_0x3682ca,_0x243776={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x5914fd,'gatewayPaymentId':_0x4d0f10,'oldStatus':_0x3009d4,'newStatus':_0x752c75,'source':_0x57bd8a,'timestamp':new Date()[_0x4de93e(0x26c)](),'details':_0x281552||{}};loggerService_1['loggerService'][_0x4de93e(0x19e)](_0x243776),console[_0x4de93e(0x218)](_0x4de93e(0x24a)+_0x5914fd+'\x20('+_0x4d0f10+')'),console[_0x4de93e(0x218)](_0x4de93e(0x252)+_0x3009d4+_0x4de93e(0x1cf)+_0x752c75),console['log'](_0x4de93e(0x257)+_0x57bd8a),console[_0x4de93e(0x218)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x243776[_0x4de93e(0x267)]),_0x281552&&console['log'](_0x4de93e(0x214),_0x281552);}['logCoinToPayError'](_0x79932b,_0x2346b4,_0xc42f97,_0x217d04,_0x5eef0c){const _0x210db0=a37_0x3682ca,_0x4a0b2={'type':_0x210db0(0x18f),'paymentId':_0x79932b,'gatewayPaymentId':_0x2346b4,'error':_0xc42f97 instanceof Error?{'message':_0xc42f97[_0x210db0(0x216)],'stack':_0xc42f97[_0x210db0(0x1ef)]}:_0xc42f97,'source':_0x217d04,'timestamp':new Date()[_0x210db0(0x26c)](),'context':_0x5eef0c||{}};loggerService_1[_0x210db0(0x1a9)][_0x210db0(0x259)](_0x4a0b2),console[_0x210db0(0x246)](_0x210db0(0x238)+_0x79932b+'\x20('+_0x2346b4+')'),console['error'](_0x210db0(0x1d4)+(_0xc42f97 instanceof Error?_0xc42f97[_0x210db0(0x216)]:_0xc42f97)),console[_0x210db0(0x246)](_0x210db0(0x257)+_0x217d04),console['error']('\x20\x20\x20üìÖ\x20Time:\x20'+_0x4a0b2[_0x210db0(0x267)]),_0x5eef0c&&console[_0x210db0(0x246)]('\x20\x20\x20üìù\x20Context:',_0x5eef0c);}[a37_0x3682ca(0x23a)](){const _0x32afe3=a37_0x3682ca;console[_0x32afe3(0x218)]('ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this['checkAllPendingPayments']()[_0x32afe3(0x1a0)](_0x57dd94=>{const _0x2d90eb=_0x32afe3;console['error'](_0x2d90eb(0x191),_0x57dd94);}),this[_0x32afe3(0x1ce)]=setInterval(async()=>{const _0x3f1a21=_0x32afe3;try{console['log'](_0x3f1a21(0x209)),await this[_0x3f1a21(0x1d1)](),console['log']('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x3f8721){console[_0x3f1a21(0x246)](_0x3f1a21(0x1c6),_0x3f8721);}},this[_0x32afe3(0x221)]),console['log'](_0x32afe3(0x222));}['stopPeriodicStatusCheck'](){const _0x4bc6f1=a37_0x3682ca;console['log']('üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0x4bc6f1(0x1ce)]&&(clearInterval(this[_0x4bc6f1(0x1ce)]),this['globalCheckInterval']=null,console[_0x4bc6f1(0x218)](_0x4bc6f1(0x1c9)));const _0x1a153=this['paymentTimers']['size'];for(const [_0x4f6586]of this[_0x4bc6f1(0x1f3)]){this[_0x4bc6f1(0x241)](_0x4f6586);}console[_0x4bc6f1(0x218)](_0x4bc6f1(0x19b)+_0x1a153+_0x4bc6f1(0x203));}async[a37_0x3682ca(0x1d1)](){const _0x55411b=a37_0x3682ca;try{console[_0x55411b(0x218)](_0x55411b(0x1fe));const _0x1d3e72=await database_1[_0x55411b(0x1a1)][_0x55411b(0x274)][_0x55411b(0x28a)]({'where':{'gateway':{'in':[_0x55411b(0x1b0),'cointopay2']},'status':_0x55411b(0x1e9),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x55411b(0x218)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x1d3e72[_0x55411b(0x22a)]+'\x20pending\x20CoinToPay\x20payments');if(_0x1d3e72[_0x55411b(0x22a)]===0x0){console[_0x55411b(0x218)](_0x55411b(0x1c1));return;}const _0x1c6fc5=await this[_0x55411b(0x194)](_0x1d3e72);console['log'](_0x55411b(0x1ae)+_0x1c6fc5[_0x55411b(0x22a)]+_0x55411b(0x26a));let _0x531746=0x0,_0x42ea8d=0x0;for(const _0x597787 of _0x1d3e72){try{if(_0x1c6fc5['includes'](_0x597787['id'])){console['log'](_0x55411b(0x276)+_0x597787['id']+_0x55411b(0x19c)),_0x42ea8d++;continue;}if(this[_0x55411b(0x1f3)][_0x55411b(0x230)](_0x597787['id'])){console[_0x55411b(0x218)](_0x55411b(0x276)+_0x597787['id']+_0x55411b(0x1e2)),_0x42ea8d++;continue;}const _0x3e6d90=(Date['now']()-_0x597787['createdAt'][_0x55411b(0x1e8)]())/(0x3e8*0x3c*0x3c);if(_0x3e6d90<0x1){console[_0x55411b(0x218)](_0x55411b(0x276)+_0x597787['id']+_0x55411b(0x23d)+_0x3e6d90[_0x55411b(0x277)](0x1)+_0x55411b(0x198)),_0x42ea8d++;continue;}console['log'](_0x55411b(0x1cb)+_0x597787['id']+'\x20(age:\x20'+_0x3e6d90[_0x55411b(0x277)](0x1)+'h)'),await this[_0x55411b(0x264)](_0x597787),_0x531746++,await new Promise(_0x404db3=>setTimeout(_0x404db3,0x7d0));}catch(_0x59d1b9){console['error'](_0x55411b(0x1fd)+_0x597787['id']+':',_0x59d1b9),this[_0x55411b(0x259)](_0x597787['id'],_0x597787[_0x55411b(0x24b)]||'unknown',_0x59d1b9,_0x55411b(0x18a),{'isGlobalCheck':!![],'paymentAmount':_0x597787[_0x55411b(0x18d)],'paymentCurrency':_0x597787[_0x55411b(0x1a6)],'shopId':_0x597787[_0x55411b(0x206)],'createdAt':_0x597787['createdAt']}),loggerService_1[_0x55411b(0x1a9)][_0x55411b(0x1c7)](_0x55411b(0x1b0),_0x55411b(0x1f8)+_0x597787[_0x55411b(0x24b)],_0x59d1b9);}}console['log'](_0x55411b(0x244)+_0x531746+_0x55411b(0x28f)+_0x42ea8d+'\x20skipped,\x20'+_0x1c6fc5['length']+_0x55411b(0x243));}catch(_0x10baae){console[_0x55411b(0x246)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x10baae);}}async[a37_0x3682ca(0x194)](_0x41e178){const _0x5efa7f=a37_0x3682ca,_0xfb7d0c=[],_0x5a61d4=new Date();_0x5a61d4['setDate'](_0x5a61d4[_0x5efa7f(0x1b3)]()-this['EXPIRY_DAYS']),console[_0x5efa7f(0x218)]('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x5efa7f(0x1f2)]+'\x20days\x20(created\x20before\x20'+_0x5a61d4[_0x5efa7f(0x26c)]()+')');for(const _0x2ad677 of _0x41e178){if(_0x2ad677[_0x5efa7f(0x273)]<_0x5a61d4){console['log'](_0x5efa7f(0x271)+_0x2ad677['id']+'\x20is\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x5efa7f(0x199));try{this[_0x5efa7f(0x19e)](_0x2ad677['id'],_0x2ad677[_0x5efa7f(0x24b)]||_0x5efa7f(0x251),_0x5efa7f(0x1e9),_0x5efa7f(0x25a),_0x5efa7f(0x270),{'reason':_0x5efa7f(0x227)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x2ad677[_0x5efa7f(0x273)],'daysSinceCreation':Math[_0x5efa7f(0x1ed)]((Date['now']()-_0x2ad677[_0x5efa7f(0x273)][_0x5efa7f(0x1e8)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x2ad677[_0x5efa7f(0x18d)],'paymentCurrency':_0x2ad677[_0x5efa7f(0x1a6)],'shopId':_0x2ad677[_0x5efa7f(0x206)]}),await database_1[_0x5efa7f(0x1a1)][_0x5efa7f(0x274)][_0x5efa7f(0x1ea)]({'where':{'id':_0x2ad677['id']},'data':{'status':_0x5efa7f(0x25a),'updatedAt':new Date(),'adminNotes':_0x5efa7f(0x286)+this[_0x5efa7f(0x1f2)]+_0x5efa7f(0x1c4)}}),await database_1[_0x5efa7f(0x1a1)][_0x5efa7f(0x1f9)]['create']({'data':{'paymentId':_0x2ad677['id'],'shopId':_0x2ad677[_0x5efa7f(0x206)],'event':_0x5efa7f(0x226),'statusCode':0xc8,'responseBody':JSON[_0x5efa7f(0x20b)]({'reason':_0x5efa7f(0x227)+this[_0x5efa7f(0x1f2)]+'\x20days','createdAt':_0x2ad677[_0x5efa7f(0x273)],'expiredAt':new Date()[_0x5efa7f(0x26c)](),'daysSinceCreation':Math[_0x5efa7f(0x1ed)]((Date[_0x5efa7f(0x19f)]()-_0x2ad677[_0x5efa7f(0x273)][_0x5efa7f(0x1e8)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x2ad677,'EXPIRED'),await this[_0x5efa7f(0x23c)](_0x2ad677,_0x5efa7f(0x25a)),this[_0x5efa7f(0x241)](_0x2ad677['id']),_0xfb7d0c[_0x5efa7f(0x285)](_0x2ad677['id']),console[_0x5efa7f(0x218)]('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x2ad677['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x5efa7f(0x1f2)]+_0x5efa7f(0x20a));}catch(_0x1aacd9){console[_0x5efa7f(0x246)](_0x5efa7f(0x21d)+_0x2ad677['id']+':',_0x1aacd9),this['logCoinToPayError'](_0x2ad677['id'],_0x2ad677[_0x5efa7f(0x24b)]||_0x5efa7f(0x251),_0x1aacd9,_0x5efa7f(0x270),{'reason':_0x5efa7f(0x25c),'createdAt':_0x2ad677[_0x5efa7f(0x273)],'daysSinceCreation':Math[_0x5efa7f(0x1ed)]((Date['now']()-_0x2ad677['createdAt'][_0x5efa7f(0x1e8)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0xfb7d0c;}async['checkSinglePayment'](_0x2a0c46){const _0x4fdb43=a37_0x3682ca;if(!_0x2a0c46['gatewayPaymentId']){console[_0x4fdb43(0x218)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x2a0c46['id']+_0x4fdb43(0x1cd));return;}console[_0x4fdb43(0x218)](_0x4fdb43(0x1ec)+_0x2a0c46[_0x4fdb43(0x211)]+_0x4fdb43(0x207)+_0x2a0c46['id']+'\x20('+_0x2a0c46[_0x4fdb43(0x24b)]+')');try{let _0x364ab7;_0x2a0c46['gateway']===_0x4fdb43(0x1b7)?(_0x364ab7=await this[_0x4fdb43(0x288)][_0x4fdb43(0x22e)](_0x2a0c46[_0x4fdb43(0x24b)]),console[_0x4fdb43(0x218)](_0x4fdb43(0x23b)+_0x2a0c46['id']+'\x20status:\x20'+_0x364ab7[_0x4fdb43(0x219)])):(_0x364ab7=await this['coinToPayService'][_0x4fdb43(0x22e)](_0x2a0c46['gatewayPaymentId']),console[_0x4fdb43(0x218)]('üìä\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x2a0c46['id']+_0x4fdb43(0x20e)+_0x364ab7[_0x4fdb43(0x219)]));_0x364ab7[_0x4fdb43(0x1dc)]&&console[_0x4fdb43(0x218)](_0x4fdb43(0x1ac)+_0x2a0c46['id']+_0x4fdb43(0x1d2),{'iban':_0x364ab7['paymentDetails'][_0x4fdb43(0x24f)]||_0x4fdb43(0x1eb),'transactionId':_0x364ab7[_0x4fdb43(0x1dc)]['transactionId'],'createdOn':_0x364ab7[_0x4fdb43(0x1dc)][_0x4fdb43(0x22f)],'confirmedOn':_0x364ab7[_0x4fdb43(0x1dc)][_0x4fdb43(0x290)]||_0x4fdb43(0x1a2)});if(_0x364ab7[_0x4fdb43(0x219)]!==_0x2a0c46['status']){console[_0x4fdb43(0x218)](_0x4fdb43(0x1c0)+_0x2a0c46['id']+_0x4fdb43(0x19d)+_0x2a0c46[_0x4fdb43(0x219)]+_0x4fdb43(0x1bd)+_0x364ab7[_0x4fdb43(0x219)]),this[_0x4fdb43(0x19e)](_0x2a0c46['id'],_0x2a0c46['gatewayPaymentId'],_0x2a0c46[_0x4fdb43(0x219)],_0x364ab7[_0x4fdb43(0x219)],_0x4fdb43(0x18a),{'paymentDetails':_0x364ab7[_0x4fdb43(0x1dc)],'amount':_0x364ab7[_0x4fdb43(0x18d)],'currency':_0x364ab7[_0x4fdb43(0x1a6)],'shopId':_0x2a0c46['shopId'],'checkTimestamp':new Date()[_0x4fdb43(0x26c)]()});const _0x3a65ee={'status':_0x364ab7[_0x4fdb43(0x219)],'updatedAt':new Date()};_0x364ab7['status']==='PAID'&&_0x2a0c46[_0x4fdb43(0x219)]!==_0x4fdb43(0x223)&&(_0x3a65ee['paidAt']=new Date(),console['log'](_0x4fdb43(0x1be)+_0x2a0c46['id']+_0x4fdb43(0x24c)+_0x3a65ee['paidAt'][_0x4fdb43(0x26c)]()));if(_0x364ab7[_0x4fdb43(0x1dc)]){const _0x3143fe=_0x364ab7[_0x4fdb43(0x1dc)];_0x3143fe[_0x4fdb43(0x24f)]&&(_0x3a65ee[_0x4fdb43(0x1cc)]=_0x3143fe['iban'],console['log'](_0x4fdb43(0x22c)+_0x3143fe[_0x4fdb43(0x24f)]));if(_0x3143fe[_0x4fdb43(0x27a)]){const _0xdfa5c=_0x2a0c46[_0x4fdb43(0x1d7)]||'',_0x15916d=_0x4fdb43(0x1a8)+_0x3143fe[_0x4fdb43(0x27a)];_0x3a65ee[_0x4fdb43(0x1d7)]=_0xdfa5c?_0xdfa5c+'\x0a\x0a'+_0x15916d:_0x15916d,console[_0x4fdb43(0x218)]('üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0x3143fe['transactionId']&&console[_0x4fdb43(0x218)](_0x4fdb43(0x1af)+_0x3143fe[_0x4fdb43(0x26b)]),_0x3143fe['confirmedOn']&&console[_0x4fdb43(0x218)](_0x4fdb43(0x224)+_0x3143fe[_0x4fdb43(0x290)]);}await database_1[_0x4fdb43(0x1a1)][_0x4fdb43(0x274)]['update']({'where':{'id':_0x2a0c46['id']},'data':_0x3a65ee});if(_0x364ab7[_0x4fdb43(0x219)]==='PAID'&&_0x2a0c46[_0x4fdb43(0x219)]!==_0x4fdb43(0x223)){console[_0x4fdb43(0x218)](_0x4fdb43(0x1b4)+_0x2a0c46['id']+_0x4fdb43(0x249));const _0x2a044b=await database_1[_0x4fdb43(0x1a1)][_0x4fdb43(0x274)][_0x4fdb43(0x28b)]({'where':{'id':_0x2a0c46['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x2a044b?.[_0x4fdb43(0x258)]&&_0x2a044b['paymentLink'])try{const _0x17a647=_0x2a044b[_0x4fdb43(0x254)];console[_0x4fdb43(0x218)](_0x4fdb43(0x1f1)+_0x17a647['id']+_0x4fdb43(0x225)+_0x17a647[_0x4fdb43(0x287)]+',\x20currentPayments='+_0x17a647[_0x4fdb43(0x21a)]+',\x20status='+_0x17a647[_0x4fdb43(0x219)]);const _0x19726b=_0x17a647[_0x4fdb43(0x21a)]+0x1,_0x58f65c=_0x17a647[_0x4fdb43(0x287)]==='SINGLE'?_0x4fdb43(0x1de):_0x17a647[_0x4fdb43(0x219)];await database_1[_0x4fdb43(0x1a1)][_0x4fdb43(0x254)][_0x4fdb43(0x1ea)]({'where':{'id':_0x17a647['id']},'data':{'currentPayments':_0x19726b,'status':_0x58f65c,'updatedAt':new Date()}}),console[_0x4fdb43(0x218)](_0x4fdb43(0x210)+_0x17a647['id']+_0x4fdb43(0x1f7)+_0x17a647[_0x4fdb43(0x21a)]+_0x4fdb43(0x1cf)+_0x19726b+_0x4fdb43(0x22b)+_0x17a647['status']+'\x20->\x20'+_0x58f65c);}catch(_0x6b5ce7){console[_0x4fdb43(0x246)](_0x4fdb43(0x1fb),_0x6b5ce7);}else console[_0x4fdb43(0x218)](_0x4fdb43(0x1b4)+_0x2a0c46['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x4fdb43(0x1a1)][_0x4fdb43(0x1f9)][_0x4fdb43(0x231)]({'data':{'paymentId':_0x2a0c46['id'],'shopId':_0x2a0c46[_0x4fdb43(0x206)],'event':_0x4fdb43(0x1d8)+_0x364ab7['status'][_0x4fdb43(0x1a3)](),'statusCode':0xc8,'responseBody':JSON[_0x4fdb43(0x20b)]({'oldStatus':_0x2a0c46[_0x4fdb43(0x219)],'newStatus':_0x364ab7[_0x4fdb43(0x219)],'paymentDetails':_0x364ab7[_0x4fdb43(0x1dc)],'checkedAt':new Date()[_0x4fdb43(0x26c)]()})}}),await this[_0x4fdb43(0x25b)](_0x2a0c46,_0x364ab7[_0x4fdb43(0x219)]),await this[_0x4fdb43(0x23c)](_0x2a0c46,_0x364ab7[_0x4fdb43(0x219)]),_0x364ab7[_0x4fdb43(0x219)]!==_0x4fdb43(0x1e9)&&(console[_0x4fdb43(0x218)](_0x4fdb43(0x1ee)+_0x2a0c46['id']+'\x20status\x20changed\x20to\x20'+_0x364ab7[_0x4fdb43(0x219)]+_0x4fdb43(0x18c)),this['clearPaymentTimers'](_0x2a0c46['id'])),console['log'](_0x4fdb43(0x205)+_0x2a0c46['id']+_0x4fdb43(0x261));}else console[_0x4fdb43(0x218)](_0x4fdb43(0x1ac)+_0x2a0c46['id']+_0x4fdb43(0x1e5)+_0x364ab7[_0x4fdb43(0x219)]+')'),this[_0x4fdb43(0x19e)](_0x2a0c46['id'],_0x2a0c46['gatewayPaymentId'],_0x2a0c46[_0x4fdb43(0x219)],_0x364ab7[_0x4fdb43(0x219)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x364ab7['paymentDetails'],'amount':_0x364ab7[_0x4fdb43(0x18d)],'currency':_0x364ab7['currency'],'shopId':_0x2a0c46[_0x4fdb43(0x206)],'checkTimestamp':new Date()[_0x4fdb43(0x26c)]()});}catch(_0x3ba3ea){console['error'](_0x4fdb43(0x1b1)+_0x2a0c46['id']+':',_0x3ba3ea),this['logCoinToPayError'](_0x2a0c46['id'],_0x2a0c46[_0x4fdb43(0x24b)],_0x3ba3ea,'status_check',{'paymentAmount':_0x2a0c46[_0x4fdb43(0x18d)],'paymentCurrency':_0x2a0c46[_0x4fdb43(0x1a6)],'shopId':_0x2a0c46[_0x4fdb43(0x206)],'createdAt':_0x2a0c46[_0x4fdb43(0x273)]}),await database_1['default'][_0x4fdb43(0x1f9)][_0x4fdb43(0x231)]({'data':{'paymentId':_0x2a0c46['id'],'shopId':_0x2a0c46[_0x4fdb43(0x206)],'event':_0x4fdb43(0x1ab),'statusCode':0x1f4,'responseBody':JSON[_0x4fdb43(0x20b)]({'error':_0x3ba3ea instanceof Error?_0x3ba3ea[_0x4fdb43(0x216)]:'Unknown\x20error','gatewayPaymentId':_0x2a0c46[_0x4fdb43(0x24b)],'checkedAt':new Date()[_0x4fdb43(0x26c)]()})}});}}async[a37_0x3682ca(0x25b)](_0x48a1aa,_0x4afcb7){const _0xa3e8a6=a37_0x3682ca,_0x5818a4=Date['now']();try{const _0x518dee=_0x48a1aa[_0xa3e8a6(0x262)],_0x2d0edd=_0x518dee[_0xa3e8a6(0x208)];if(!_0x2d0edd?.[_0xa3e8a6(0x1e1)]){console['log'](_0xa3e8a6(0x19a)+_0x518dee['id']);return;}const _0x4a6a2c=_0x4afcb7===_0xa3e8a6(0x223)?'payment.success':_0x4afcb7==='FAILED'?_0xa3e8a6(0x265):_0x4afcb7===_0xa3e8a6(0x25a)?'payment.failed':_0xa3e8a6(0x27d);if(!_0x2d0edd['webhookEvents']?.[_0xa3e8a6(0x1f0)](_0x4a6a2c)){console[_0xa3e8a6(0x218)](_0xa3e8a6(0x1d6)+_0x4a6a2c+_0xa3e8a6(0x18e)+_0x518dee['id']);return;}const _0x332280=(0x0,gateway_1[_0xa3e8a6(0x192)])(_0x48a1aa[_0xa3e8a6(0x211)])||_0x48a1aa['gateway'],_0x5aad63={'event':_0x4a6a2c,'payment':{'id':_0x48a1aa['id'],'order_id':_0x48a1aa[_0xa3e8a6(0x1e3)],'gateway_order_id':_0x48a1aa[_0xa3e8a6(0x213)],'gateway':_0x332280,'amount':_0x48a1aa[_0xa3e8a6(0x18d)],'currency':_0x48a1aa[_0xa3e8a6(0x1a6)],'status':_0x4afcb7['toLowerCase'](),'customer_email':_0x48a1aa['customerEmail'],'customer_name':_0x48a1aa[_0xa3e8a6(0x239)],'created_at':_0x48a1aa[_0xa3e8a6(0x273)],'updated_at':new Date()}},_0x10a4f3=await fetch(_0x2d0edd[_0xa3e8a6(0x1e1)],{'method':_0xa3e8a6(0x1b5),'headers':{'Content-Type':_0xa3e8a6(0x280),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x5aad63)}),_0x5dce3c=Date[_0xa3e8a6(0x19f)]()-_0x5818a4,_0x349429=_0x10a4f3['ok']?_0xa3e8a6(0x1f6):await _0x10a4f3[_0xa3e8a6(0x1ad)]();loggerService_1[_0xa3e8a6(0x1a9)][_0xa3e8a6(0x1c5)](_0x48a1aa['shopId'],_0x2d0edd['webhookUrl'],_0x4a6a2c,_0x10a4f3[_0xa3e8a6(0x219)],_0x5dce3c,_0x5aad63),console['log'](_0xa3e8a6(0x253)+_0x2d0edd[_0xa3e8a6(0x1e1)]+_0xa3e8a6(0x25e)+_0x10a4f3[_0xa3e8a6(0x219)]+'\x20('+_0x5dce3c+_0xa3e8a6(0x28e));}catch(_0xdd53b8){console[_0xa3e8a6(0x246)](_0xa3e8a6(0x1da),_0xdd53b8),loggerService_1['loggerService'][_0xa3e8a6(0x21e)](_0x48a1aa[_0xa3e8a6(0x206)],_0x48a1aa[_0xa3e8a6(0x262)]?.[_0xa3e8a6(0x208)]?.[_0xa3e8a6(0x1e1)]||_0xa3e8a6(0x251),'webhook_send',_0xdd53b8,{});}}async[a37_0x3682ca(0x23c)](_0x49eae5,_0x42caad){const _0x236d4f=a37_0x3682ca;try{const _0x37a08e={'PENDING':'created','PAID':_0x236d4f(0x25f),'FAILED':'failed','EXPIRED':_0x236d4f(0x20d)},_0x21f6e2=_0x37a08e[_0x42caad];if(!_0x21f6e2||_0x21f6e2===_0x236d4f(0x275))return;await telegramBotService_1[_0x236d4f(0x1f5)][_0x236d4f(0x20f)](_0x49eae5[_0x236d4f(0x206)],_0x49eae5,_0x21f6e2);}catch(_0x173e97){console[_0x236d4f(0x246)](_0x236d4f(0x268),_0x173e97);}}async[a37_0x3682ca(0x256)](_0x56e16f){const _0x30f67e=a37_0x3682ca;console[_0x30f67e(0x218)]('üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x56e16f);const _0x4ce903=await database_1[_0x30f67e(0x1a1)][_0x30f67e(0x274)][_0x30f67e(0x28b)]({'where':{'id':_0x56e16f},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4ce903)throw new Error(_0x30f67e(0x235));if(_0x4ce903['gateway']!==_0x30f67e(0x1b0)&&_0x4ce903[_0x30f67e(0x211)]!==_0x30f67e(0x1b7))throw new Error(_0x30f67e(0x196));console[_0x30f67e(0x218)](_0x30f67e(0x1e6)+_0x4ce903[_0x30f67e(0x211)]+_0x30f67e(0x207)+_0x56e16f),await this[_0x30f67e(0x264)](_0x4ce903),console[_0x30f67e(0x218)](_0x30f67e(0x200)+_0x56e16f);}[a37_0x3682ca(0x1a7)](){const _0x59134b=a37_0x3682ca,_0x4d0b32=this[_0x59134b(0x1ce)]?this[_0x59134b(0x221)]:undefined,_0x30b9cb=Array[_0x59134b(0x266)](this[_0x59134b(0x1f3)][_0x59134b(0x1c2)]())[_0x59134b(0x220)](_0x44f7d2=>({'paymentId':_0x44f7d2[_0x59134b(0x250)],'gatewayPaymentId':_0x44f7d2[_0x59134b(0x24b)],'createdAt':_0x44f7d2[_0x59134b(0x273)],'timersCount':_0x44f7d2[_0x59134b(0x1bc)][_0x59134b(0x22a)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x59134b(0x221)]/(0x3e8*0x3c),'expiryDays':this[_0x59134b(0x1f2)],'activeIndividualTimers':this[_0x59134b(0x1f3)][_0x59134b(0x242)],'nextGlobalCheckIn':_0x4d0b32,'paymentTimersDetails':_0x30b9cb};}['getPaymentTimerInfo'](_0x46bf80){const _0x331eee=a37_0x3682ca,_0x4be42e=this[_0x331eee(0x1f3)][_0x331eee(0x26f)](_0x46bf80);if(_0x4be42e)return{'hasTimers':!![],'timersCount':_0x4be42e[_0x331eee(0x1bc)][_0x331eee(0x22a)],'createdAt':_0x4be42e[_0x331eee(0x273)],'gatewayPaymentId':_0x4be42e[_0x331eee(0x24b)]};return{'hasTimers':![]};}}exports[a37_0x3682ca(0x21b)]=CoinToPayStatusService,exports[a37_0x3682ca(0x20c)]=new CoinToPayStatusService();