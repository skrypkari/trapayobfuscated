'use strict';const a38_0xd904ab=a38_0x1c8b;function a38_0x1c8b(_0x50dd97,_0x351822){const _0x206828=a38_0x2068();return a38_0x1c8b=function(_0x1c8bab,_0x58167c){_0x1c8bab=_0x1c8bab-0x1dd;let _0x1f786d=_0x206828[_0x1c8bab];return _0x1f786d;},a38_0x1c8b(_0x50dd97,_0x351822);}(function(_0x49d2b9,_0xfa2172){const _0x97d6e3=a38_0x1c8b,_0x55f921=_0x49d2b9();while(!![]){try{const _0x26d207=-parseInt(_0x97d6e3(0x2a6))/0x1*(parseInt(_0x97d6e3(0x1f6))/0x2)+parseInt(_0x97d6e3(0x236))/0x3*(parseInt(_0x97d6e3(0x215))/0x4)+parseInt(_0x97d6e3(0x2de))/0x5+parseInt(_0x97d6e3(0x226))/0x6+parseInt(_0x97d6e3(0x25d))/0x7*(-parseInt(_0x97d6e3(0x200))/0x8)+parseInt(_0x97d6e3(0x1f2))/0x9*(-parseInt(_0x97d6e3(0x1e5))/0xa)+parseInt(_0x97d6e3(0x2bd))/0xb;if(_0x26d207===_0xfa2172)break;else _0x55f921['push'](_0x55f921['shift']());}catch(_0x44ab86){_0x55f921['push'](_0x55f921['shift']());}}}(a38_0x2068,0x6942e));var __importDefault=this&&this[a38_0xd904ab(0x2d7)]||function(_0x408bc9){return _0x408bc9&&_0x408bc9['__esModule']?_0x408bc9:{'default':_0x408bc9};};Object['defineProperty'](exports,a38_0xd904ab(0x2da),{'value':!![]}),exports['coinToPayStatusService']=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a38_0xd904ab(0x29b)),gateway_1=require(a38_0xd904ab(0x281)),database_1=__importDefault(require(a38_0xd904ab(0x27c))),telegramBotService_1=require(a38_0xd904ab(0x224)),loggerService_1=require(a38_0xd904ab(0x201)),currencyService_1=require(a38_0xd904ab(0x2d4));function a38_0x2068(){const _0x431939=['orderId','floor','checkPaymentStatus','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','\x20to\x20','./gateways/coinToPay2Service','createdAt',':\x20type=','\x20\x20\x20📝\x20Details:','✅\x20[TIMER]\x20Individual\x20check\x20#','\x20timers\x20for\x20payment\x20','update','⚠️\x20[CHECK]\x20Payment\x20','not\x20confirmed','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','now','2JsidOQ',',\x20stopping\x20individual\x20checks','COMPLETED','gatewaySettings','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','get','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','CoinToPayStatusService','2\x20minutes','TesSoft\x20Payment\x20System/1.0','EXPIRY_DAYS','\x20\x20\x20-\x20ShopId:\x20','customerEmail','getPaymentTimerInfo','error','\x20days,\x20marking\x20as\x20EXPIRED','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','paidAt','Shop\x20webhook\x20sent\x20to\x20','FAILED','coinToPay2Service','6548047sNLEUw','🛑\x20[SHUTDOWN]\x20Cleared\x20','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20skipped,\x20','\x20\x20\x20-\x20Amount:\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','\x20\x20\x20❌\x20Error:\x20','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','❌\x20[HOURLY]\x20Payment\x20','parse','status_check','/status/','📊\x20[CHECK]\x20Payment\x20','logShopWebhookError','🧹\x20[CHECK]\x20Payment\x20','size','\x20days','\x20USDT','forEach','stringify','schedulePaymentChecks','\x20status\x20from\x20','./currencyService','stopPeriodicStatusCheck',',\x20status=','__importDefault','\x20\x20\x20-\x20Status:\x20','📈\x20[COINTOPAY]\x20Payment\x20','__esModule','Failed\x20to\x20send\x20shop\x20webhook:','cointopay_auto_expired','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','188365TUXjOm','\x20amounts\x20calculated:','unknown','description','amountUSDT','push','values','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','checkAllPendingPayments','\x20checked,\x20',',\x20gateway\x20','\x20\x20\x20📊\x20Status:\x20','📊\x20[HOURLY]\x20Payment\x20','Payment\x20not\x20found','getTime','length','clearPaymentTimers','findMany','5230mHTIUU','⏰\x20[GLOBAL]\x20Payment\x20','currency','\x20not\x20enabled\x20for\x20shop\x20','cointopay_status_check_','paymentDetails','❌\x20[CHECK]\x20Payment\x20','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20to\x20clear','🔍\x20[CHECK]\x20Checking\x20','findUnique','1\x20minute','2529XbgfAx','created','cointopay2','delete','47284NBcrjY','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','Bank\x20Details:\x20','-day\x20timeout',',\x20clearing\x20individual\x20timers','paid','Unknown\x20error','✅\x20[COINTOPAY]\x20Payment\x20link\x20','has',',\x20currentPayments=','40tSsgsx','./loggerService','\x20status:\x20','currencyService','⏰\x20[EXPIRY]\x20Payment\x20','\x20is\x20older\x20than\x20','auto_expire','default','setDate','failed','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','coinToPayService','includes','Gateway\x20','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','✅\x20[HOURLY]\x20Payment\x20','application/json','createdOn','\x20individual\x20payment\x20timers','shopId','paymentTimers','8084QrVfMK','status','not\x20found','paymentLink','create','amount','\x20not\x20found,\x20clearing\x20timers','getDate','\x20(after\x20','cointopay','bankDetails','⏰\x20[HOURLY]\x20Payment\x20','payment.pending','\x20\x20\x20-\x20paymentId:\x20','\x20commission:\x20','./telegramBotService','\x20\x20\x20Amount:\x20','724794VHIcSP','🪙\x20[TIMER]\x20Individual\x20check\x20#','gatewayOrderId','text','shop',',\x20using\x20default\x20commission\x2010%','\x20expired\x20CoinToPay\x20payments','🧹\x20[DEBUG]\x20Clearing\x20','\x20days\x20(created\x20before\x20','\x20\x20\x20📍\x20Source:\x20','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','GLOBAL_CHECK_INTERVAL_MS','\x20status\x20changed\x20to\x20','\x20is\x20too\x20new\x20(','\x20->\x20','iban','159pkjDUU','payment','payment.failed','checkSinglePaymentById','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','SINGLE','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','loggerService','\x20marked\x20as\x20paid\x20at:\x20','webhookUrl','\x20\x20\x20Amount\x20after\x20commission:\x20','\x20for\x20payment\x20','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','type','🔄\x20[CHECK]\x20Updating\x20payment\x20','\x20status\x20is\x20','toLowerCase','\x20pending\x20CoinToPay\x20payments','toISOString','\x20in\x20','timers','\x20days\x20without\x20payment\x20confirmation','\x20details:','toFixed','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20has\x20no\x20gatewayPaymentId','💰\x20[CHECK]\x20Payment\x20','startPeriodicStatusCheck','commission','logCoinToPayError','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20commission\x20for\x20shop\x20','convertToUSDT','gatewayPaymentId','COINTOPAY_STATUS_CHANGE','\x20has\x20no\x20gatewayPaymentId,\x20skipping','customerName','329651sMiRQT','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','Success','sendShopWebhook','globalCheckInterval','✅\x20[EXPIRY]\x20Payment\x20','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','remitterIban','confirmedOn','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','message','settings','currentPayments','\x20payment\x20','\x20not\x20found\x20in\x20database','checkPaymentById','\x20triggered\x20for\x20payment\x20','🪙\x20[GLOBAL]\x20Found\x20','paymentLinkId','timestamp','gateway','CoinToPay2Service','delay','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','log','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20with\x20status\x20','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20\x20\x20📅\x20Time:\x20','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','../config/database','PAID','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20current\x20status:\x20','../types/gateway','schedule_created','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','logCoinToPayStatus','getGatewayCommission','catch','webhookLog','\x20updated:\x20currentPayments=','sendPaymentStatusNotification','.\x20Remaining\x20active\x20timers:\x20','EXPIRED','checkSinglePayment','\x20expired','\x20\x20\x20-\x20Gateway:\x20','transactionId','⏰\x20[GLOBAL]\x20Found\x20','coinToPayStatusService','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','PENDING','telegramBotService','Payment\x20older\x20than\x20'];a38_0x2068=function(){return _0x431939;};return a38_0x2068();}class CoinToPayStatusService{constructor(){const _0x345330=a38_0xd904ab;this[_0x345330(0x261)]=null,this[_0x345330(0x231)]=0x3c*0x3c*0x3e8,this[_0x345330(0x2b2)]=0x5,this['paymentTimers']=new Map(),this[_0x345330(0x20b)]=new coinToPayService_1['CoinToPayService'](),this[_0x345330(0x2bc)]=new coinToPay2Service_1[(_0x345330(0x273))](),console[_0x345330(0x276)]('🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a38_0xd904ab(0x2d2)](_0x348df6,_0x2d0b84){const _0x718708=a38_0xd904ab;console[_0x718708(0x276)](_0x718708(0x267)),console[_0x718708(0x276)](_0x718708(0x222)+_0x348df6),console[_0x718708(0x276)]('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x2d0b84),this['clearPaymentTimers'](_0x348df6);const _0x188366=[],_0x34eef1=new Date(),_0x574e6f=[{'delay':0x1*0x3c*0x3e8,'description':_0x718708(0x1f1)},{'delay':0x2*0x3c*0x3e8,'description':_0x718708(0x2b0)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console[_0x718708(0x276)]('🪙\x20[DEBUG]\x20Creating\x20'+_0x574e6f['length']+'\x20initial\x20timers\x20for\x20payment\x20'+_0x348df6);let _0x541821=0x0;_0x574e6f[_0x718708(0x2d0)]((_0x336b10,_0x2935e6)=>{const _0x3c0cec=_0x718708;_0x541821+=_0x336b10[_0x3c0cec(0x274)];const _0x2a9618=setTimeout(async()=>{const _0x580169=_0x3c0cec;console[_0x580169(0x276)](_0x580169(0x227)+(_0x2935e6+0x1)+_0x580169(0x26e)+_0x348df6+_0x580169(0x21d)+_0x336b10[_0x580169(0x2e1)]+')');try{await this[_0x580169(0x239)](_0x348df6),console[_0x580169(0x276)](_0x580169(0x29f)+(_0x2935e6+0x1)+'\x20completed\x20for\x20payment\x20'+_0x348df6);}catch(_0x2ad7f8){console[_0x580169(0x2b6)]('❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x2935e6+0x1)+_0x580169(0x241)+_0x348df6+':',_0x2ad7f8),this[_0x580169(0x254)](_0x348df6,_0x2d0b84,_0x2ad7f8,_0x580169(0x2c8),{'checkNumber':_0x2935e6+0x1,'scheduledAfter':_0x336b10[_0x580169(0x2e1)],'isIndividualCheck':!![]});}},_0x541821);_0x188366[_0x3c0cec(0x2e3)](_0x2a9618),console[_0x3c0cec(0x276)](_0x3c0cec(0x24e)+(_0x2935e6+0x1)+_0x3c0cec(0x241)+_0x348df6+_0x3c0cec(0x249)+_0x541821/0x3e8+'\x20seconds\x20('+_0x336b10['description']+')');});const _0x2a24d0=setInterval(async()=>{const _0x5852f9=_0x718708;console[_0x5852f9(0x276)](_0x5852f9(0x263)+_0x348df6);try{const _0x153337=await database_1[_0x5852f9(0x207)][_0x5852f9(0x237)][_0x5852f9(0x1f0)]({'where':{'id':_0x348df6},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x153337){console['log'](_0x5852f9(0x2c6)+_0x348df6+_0x5852f9(0x21b)),this['clearPaymentTimers'](_0x348df6);return;}console[_0x5852f9(0x276)](_0x5852f9(0x1df)+_0x348df6+_0x5852f9(0x280)+_0x153337[_0x5852f9(0x216)]);if(_0x153337['status']!==_0x5852f9(0x293)){console[_0x5852f9(0x276)](_0x5852f9(0x20f)+_0x348df6+'\x20status\x20is\x20'+_0x153337[_0x5852f9(0x216)]+_0x5852f9(0x2a7)),this[_0x5852f9(0x1e3)](_0x348df6);return;}const _0x315d78=Math['floor']((Date[_0x5852f9(0x2a5)]()-_0x153337[_0x5852f9(0x29c)][_0x5852f9(0x1e1)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x315d78>=this[_0x5852f9(0x2b2)]){console[_0x5852f9(0x276)](_0x5852f9(0x220)+_0x348df6+_0x5852f9(0x205)+this[_0x5852f9(0x2b2)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x5852f9(0x1e3)](_0x348df6);return;}await this[_0x5852f9(0x239)](_0x348df6),console['log']('✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x348df6);}catch(_0x508836){console['error']('❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x348df6+':',_0x508836),this[_0x5852f9(0x254)](_0x348df6,_0x2d0b84,_0x508836,_0x5852f9(0x2c8),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x188366[_0x718708(0x2e3)](_0x2a24d0),this[_0x718708(0x214)]['set'](_0x348df6,{'timers':_0x188366,'paymentId':_0x348df6,'gatewayPaymentId':_0x2d0b84,'createdAt':_0x34eef1}),console[_0x718708(0x276)](_0x718708(0x1f7)+_0x574e6f[_0x718708(0x1e2)]+_0x718708(0x292)+_0x348df6),console[_0x718708(0x276)](_0x718708(0x2ac)+this[_0x718708(0x214)]['size']),this['logCoinToPayStatus'](_0x348df6,_0x2d0b84,_0x718708(0x293),_0x718708(0x293),_0x718708(0x2c8),{'action':_0x718708(0x282),'scheduledChecks':_0x574e6f[_0x718708(0x1e2)],'firstCheckIn':_0x574e6f[0x0]['delay']/0x3e8,'totalTimers':this[_0x718708(0x214)][_0x718708(0x2cd)]});}[a38_0xd904ab(0x1e3)](_0x223eab){const _0x403945=a38_0xd904ab,_0x4a1cb0=this[_0x403945(0x214)][_0x403945(0x2ab)](_0x223eab);_0x4a1cb0?(console[_0x403945(0x276)](_0x403945(0x22d)+_0x4a1cb0[_0x403945(0x24a)]['length']+_0x403945(0x2a0)+_0x223eab),_0x4a1cb0[_0x403945(0x24a)]['forEach']((_0x4eab55,_0x21ef5c)=>{const _0x3a3426=_0x403945;_0x4eab55&&(clearTimeout(_0x4eab55),clearInterval(_0x4eab55),console['log'](_0x3a3426(0x20a)+(_0x21ef5c+0x1)+_0x3a3426(0x241)+_0x223eab));}),this[_0x403945(0x214)][_0x403945(0x1f5)](_0x223eab),console[_0x403945(0x276)]('✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x223eab+_0x403945(0x28a)+this['paymentTimers'][_0x403945(0x2cd)])):console[_0x403945(0x276)](_0x403945(0x2bf)+_0x223eab+_0x403945(0x1ee));}async[a38_0xd904ab(0x239)](_0xb3dcf9){const _0x111340=a38_0xd904ab;console[_0x111340(0x276)]('🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0xb3dcf9);const _0x5e9064=await database_1[_0x111340(0x207)][_0x111340(0x237)][_0x111340(0x1f0)]({'where':{'id':_0xb3dcf9},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x5e9064){console[_0x111340(0x276)](_0x111340(0x1eb)+_0xb3dcf9+_0x111340(0x26c));return;}console[_0x111340(0x276)]('📊\x20[CHECK]\x20Payment\x20'+_0xb3dcf9+'\x20found:'),console[_0x111340(0x276)](_0x111340(0x28e)+_0x5e9064[_0x111340(0x272)]),console[_0x111340(0x276)](_0x111340(0x2d8)+_0x5e9064['status']),console['log'](_0x111340(0x256)+_0x5e9064['gatewayPaymentId']),console['log'](_0x111340(0x2c1)+_0x5e9064['amount']+'\x20'+_0x5e9064[_0x111340(0x1e7)]),console['log'](_0x111340(0x2b3)+_0x5e9064[_0x111340(0x213)]);if(_0x5e9064[_0x111340(0x272)]!==_0x111340(0x21e)&&_0x5e9064[_0x111340(0x272)]!==_0x111340(0x1f4)){console['log'](_0x111340(0x2a2)+_0xb3dcf9+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x5e9064[_0x111340(0x272)]+')');return;}if(_0x5e9064[_0x111340(0x216)]!==_0x111340(0x293)){console[_0x111340(0x276)](_0x111340(0x2a2)+_0xb3dcf9+_0x111340(0x245)+_0x5e9064[_0x111340(0x216)]+_0x111340(0x2a7)),this[_0x111340(0x1e3)](_0xb3dcf9);return;}if(!_0x5e9064[_0x111340(0x259)]){console[_0x111340(0x276)]('⚠️\x20[CHECK]\x20Payment\x20'+_0xb3dcf9+_0x111340(0x250));return;}console[_0x111340(0x276)]('✅\x20[CHECK]\x20Payment\x20'+_0xb3dcf9+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this['checkSinglePayment'](_0x5e9064);}['logCoinToPayStatus'](_0x42b4ab,_0x39eb57,_0x761230,_0xbe1f77,_0x5b51f8,_0x33a313){const _0x310c01=a38_0xd904ab,_0x233867={'type':_0x310c01(0x25a),'paymentId':_0x42b4ab,'gatewayPaymentId':_0x39eb57,'oldStatus':_0x761230,'newStatus':_0xbe1f77,'source':_0x5b51f8,'timestamp':new Date()['toISOString'](),'details':_0x33a313||{}};loggerService_1[_0x310c01(0x23d)]['logCoinToPayStatus'](_0x233867),console[_0x310c01(0x276)]('🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x42b4ab+'\x20('+_0x39eb57+')'),console[_0x310c01(0x276)](_0x310c01(0x1de)+_0x761230+_0x310c01(0x234)+_0xbe1f77),console[_0x310c01(0x276)]('\x20\x20\x20📍\x20Source:\x20'+_0x5b51f8),console['log'](_0x310c01(0x27a)+_0x233867['timestamp']),_0x33a313&&console[_0x310c01(0x276)](_0x310c01(0x29e),_0x33a313);}[a38_0xd904ab(0x254)](_0x34e660,_0x50ccb2,_0xacdbc5,_0x3897f2,_0x5364d6){const _0xb53b58=a38_0xd904ab,_0x2d3e8b={'type':'COINTOPAY_ERROR','paymentId':_0x34e660,'gatewayPaymentId':_0x50ccb2,'error':_0xacdbc5 instanceof Error?{'message':_0xacdbc5[_0xb53b58(0x268)],'stack':_0xacdbc5['stack']}:_0xacdbc5,'source':_0x3897f2,'timestamp':new Date()[_0xb53b58(0x248)](),'context':_0x5364d6||{}};loggerService_1[_0xb53b58(0x23d)][_0xb53b58(0x254)](_0x2d3e8b),console[_0xb53b58(0x2b6)]('🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x34e660+'\x20('+_0x50ccb2+')'),console['error'](_0xb53b58(0x2c4)+(_0xacdbc5 instanceof Error?_0xacdbc5['message']:_0xacdbc5)),console['error'](_0xb53b58(0x22f)+_0x3897f2),console['error'](_0xb53b58(0x27a)+_0x2d3e8b[_0xb53b58(0x271)]),_0x5364d6&&console['error']('\x20\x20\x20📝\x20Context:',_0x5364d6);}[a38_0xd904ab(0x252)](){const _0x54e7f5=a38_0xd904ab;console[_0x54e7f5(0x276)](_0x54e7f5(0x27e)),this[_0x54e7f5(0x2e6)]()[_0x54e7f5(0x286)](_0x3941a7=>{console['error']('❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x3941a7);}),this[_0x54e7f5(0x261)]=setInterval(async()=>{const _0x3a084e=_0x54e7f5;try{console[_0x3a084e(0x276)]('🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this['checkAllPendingPayments'](),console['log']('✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x23b9e1){console[_0x3a084e(0x2b6)](_0x3a084e(0x2aa),_0x23b9e1);}},this[_0x54e7f5(0x231)]),console[_0x54e7f5(0x276)](_0x54e7f5(0x1ec));}[a38_0xd904ab(0x2d5)](){const _0x4e2410=a38_0xd904ab;console[_0x4e2410(0x276)](_0x4e2410(0x283));this[_0x4e2410(0x261)]&&(clearInterval(this[_0x4e2410(0x261)]),this[_0x4e2410(0x261)]=null,console[_0x4e2410(0x276)](_0x4e2410(0x266)));const _0x3c0caa=this[_0x4e2410(0x214)]['size'];for(const [_0x581a9a]of this[_0x4e2410(0x214)]){this[_0x4e2410(0x1e3)](_0x581a9a);}console['log'](_0x4e2410(0x2be)+_0x3c0caa+_0x4e2410(0x212));}async[a38_0xd904ab(0x2e6)](){const _0x3c77f0=a38_0xd904ab;try{console[_0x3c77f0(0x276)](_0x3c77f0(0x242));const _0x469de0=await database_1[_0x3c77f0(0x207)][_0x3c77f0(0x237)][_0x3c77f0(0x1e4)]({'where':{'gateway':{'in':['cointopay',_0x3c77f0(0x1f4)]},'status':_0x3c77f0(0x293),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x3c77f0(0x276)](_0x3c77f0(0x26f)+_0x469de0[_0x3c77f0(0x1e2)]+_0x3c77f0(0x247));if(_0x469de0[_0x3c77f0(0x1e2)]===0x0){console['log'](_0x3c77f0(0x20e));return;}const _0x461fba=await this['checkExpiredPayments'](_0x469de0);console[_0x3c77f0(0x276)](_0x3c77f0(0x290)+_0x461fba['length']+_0x3c77f0(0x22c));let _0x1fdb2f=0x0,_0x2a3e7b=0x0;for(const _0x5bf238 of _0x469de0){try{if(_0x461fba[_0x3c77f0(0x20c)](_0x5bf238['id'])){console['log'](_0x3c77f0(0x1e6)+_0x5bf238['id']+_0x3c77f0(0x2e5)),_0x2a3e7b++;continue;}if(this[_0x3c77f0(0x214)][_0x3c77f0(0x1fe)](_0x5bf238['id'])){console[_0x3c77f0(0x276)](_0x3c77f0(0x1e6)+_0x5bf238['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x2a3e7b++;continue;}const _0x558b34=(Date[_0x3c77f0(0x2a5)]()-_0x5bf238[_0x3c77f0(0x29c)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x558b34<0x1){console[_0x3c77f0(0x276)](_0x3c77f0(0x1e6)+_0x5bf238['id']+_0x3c77f0(0x233)+_0x558b34[_0x3c77f0(0x24d)](0x1)+'h),\x20skipping\x20global\x20check'),_0x2a3e7b++;continue;}console[_0x3c77f0(0x276)](_0x3c77f0(0x24f)+_0x5bf238['id']+'\x20(age:\x20'+_0x558b34[_0x3c77f0(0x24d)](0x1)+'h)'),await this['checkSinglePayment'](_0x5bf238),_0x1fdb2f++,await new Promise(_0x48a211=>setTimeout(_0x48a211,0x7d0));}catch(_0x1631f0){console[_0x3c77f0(0x2b6)](_0x3c77f0(0x23c)+_0x5bf238['id']+':',_0x1631f0),this[_0x3c77f0(0x254)](_0x5bf238['id'],_0x5bf238['gatewayPaymentId']||_0x3c77f0(0x2e0),_0x1631f0,_0x3c77f0(0x2c8),{'isGlobalCheck':!![],'paymentAmount':_0x5bf238[_0x3c77f0(0x21a)],'paymentCurrency':_0x5bf238[_0x3c77f0(0x1e7)],'shopId':_0x5bf238[_0x3c77f0(0x213)],'createdAt':_0x5bf238[_0x3c77f0(0x29c)]}),loggerService_1[_0x3c77f0(0x23d)]['logWhiteDomainError'](_0x3c77f0(0x21e),_0x3c77f0(0x2c9)+_0x5bf238[_0x3c77f0(0x259)],_0x1631f0);}}console['log']('✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x1fdb2f+_0x3c77f0(0x2e7)+_0x2a3e7b+_0x3c77f0(0x2c0)+_0x461fba[_0x3c77f0(0x1e2)]+_0x3c77f0(0x28d));}catch(_0x42b513){console[_0x3c77f0(0x2b6)]('❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x42b513);}}async['checkExpiredPayments'](_0x29cb61){const _0x9f9a97=a38_0xd904ab,_0x45caf4=[],_0x227588=new Date();_0x227588[_0x9f9a97(0x208)](_0x227588[_0x9f9a97(0x21c)]()-this['EXPIRY_DAYS']),console['log'](_0x9f9a97(0x27f)+this[_0x9f9a97(0x2b2)]+_0x9f9a97(0x22e)+_0x227588[_0x9f9a97(0x248)]()+')');for(const _0x1f8056 of _0x29cb61){if(_0x1f8056[_0x9f9a97(0x29c)]<_0x227588){console[_0x9f9a97(0x276)](_0x9f9a97(0x204)+_0x1f8056['id']+_0x9f9a97(0x205)+this['EXPIRY_DAYS']+_0x9f9a97(0x2b7));try{this[_0x9f9a97(0x284)](_0x1f8056['id'],_0x1f8056[_0x9f9a97(0x259)]||_0x9f9a97(0x2e0),'PENDING',_0x9f9a97(0x28b),_0x9f9a97(0x206),{'reason':_0x9f9a97(0x295)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x1f8056[_0x9f9a97(0x29c)],'daysSinceCreation':Math[_0x9f9a97(0x297)]((Date['now']()-_0x1f8056[_0x9f9a97(0x29c)][_0x9f9a97(0x1e1)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x1f8056[_0x9f9a97(0x21a)],'paymentCurrency':_0x1f8056[_0x9f9a97(0x1e7)],'shopId':_0x1f8056['shopId']}),await database_1[_0x9f9a97(0x207)][_0x9f9a97(0x237)][_0x9f9a97(0x2a1)]({'where':{'id':_0x1f8056['id']},'data':{'status':_0x9f9a97(0x28b),'updatedAt':new Date(),'adminNotes':'Automatically\x20expired\x20after\x20'+this[_0x9f9a97(0x2b2)]+_0x9f9a97(0x24b)}}),await database_1[_0x9f9a97(0x207)][_0x9f9a97(0x287)]['create']({'data':{'paymentId':_0x1f8056['id'],'shopId':_0x1f8056[_0x9f9a97(0x213)],'event':_0x9f9a97(0x2dc),'statusCode':0xc8,'responseBody':JSON[_0x9f9a97(0x2d1)]({'reason':_0x9f9a97(0x295)+this[_0x9f9a97(0x2b2)]+_0x9f9a97(0x2ce),'createdAt':_0x1f8056[_0x9f9a97(0x29c)],'expiredAt':new Date()[_0x9f9a97(0x248)](),'daysSinceCreation':Math['floor']((Date['now']()-_0x1f8056[_0x9f9a97(0x29c)][_0x9f9a97(0x1e1)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x9f9a97(0x260)](_0x1f8056,_0x9f9a97(0x28b)),await this[_0x9f9a97(0x289)](_0x1f8056,'EXPIRED'),this['clearPaymentTimers'](_0x1f8056['id']),_0x45caf4[_0x9f9a97(0x2e3)](_0x1f8056['id']),console[_0x9f9a97(0x276)](_0x9f9a97(0x262)+_0x1f8056['id']+_0x9f9a97(0x2ae)+this[_0x9f9a97(0x2b2)]+_0x9f9a97(0x1f9));}catch(_0x52e438){console['error'](_0x9f9a97(0x23a)+_0x1f8056['id']+':',_0x52e438),this[_0x9f9a97(0x254)](_0x1f8056['id'],_0x1f8056[_0x9f9a97(0x259)]||'unknown',_0x52e438,'auto_expire',{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x1f8056['createdAt'],'daysSinceCreation':Math['floor']((Date[_0x9f9a97(0x2a5)]()-_0x1f8056[_0x9f9a97(0x29c)][_0x9f9a97(0x1e1)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x45caf4;}async[a38_0xd904ab(0x28c)](_0x4d15c4){const _0x11675d=a38_0xd904ab;if(!_0x4d15c4[_0x11675d(0x259)]){console['log'](_0x11675d(0x2a2)+_0x4d15c4['id']+_0x11675d(0x25b));return;}console[_0x11675d(0x276)](_0x11675d(0x1ef)+_0x4d15c4[_0x11675d(0x272)]+_0x11675d(0x26b)+_0x4d15c4['id']+'\x20('+_0x4d15c4[_0x11675d(0x259)]+')');try{let _0x5468bc;_0x4d15c4['gateway']==='cointopay2'?(_0x5468bc=await this[_0x11675d(0x2bc)][_0x11675d(0x298)](_0x4d15c4[_0x11675d(0x259)]),console[_0x11675d(0x276)](_0x11675d(0x25e)+_0x4d15c4['id']+'\x20status:\x20'+_0x5468bc[_0x11675d(0x216)])):(_0x5468bc=await this[_0x11675d(0x20b)]['checkPaymentStatus'](_0x4d15c4[_0x11675d(0x259)]),console[_0x11675d(0x276)](_0x11675d(0x279)+_0x4d15c4['id']+_0x11675d(0x202)+_0x5468bc[_0x11675d(0x216)]));_0x5468bc['paymentDetails']&&console[_0x11675d(0x276)]('📊\x20[CHECK]\x20Payment\x20'+_0x4d15c4['id']+_0x11675d(0x24c),{'iban':_0x5468bc['paymentDetails'][_0x11675d(0x235)]||_0x11675d(0x217),'transactionId':_0x5468bc[_0x11675d(0x1ea)][_0x11675d(0x28f)],'createdOn':_0x5468bc[_0x11675d(0x1ea)][_0x11675d(0x211)],'confirmedOn':_0x5468bc[_0x11675d(0x1ea)][_0x11675d(0x265)]||_0x11675d(0x2a3)});if(_0x5468bc['status']!==_0x4d15c4['status']){console[_0x11675d(0x276)](_0x11675d(0x244)+_0x4d15c4['id']+_0x11675d(0x2d3)+_0x4d15c4[_0x11675d(0x216)]+_0x11675d(0x29a)+_0x5468bc[_0x11675d(0x216)]),this[_0x11675d(0x284)](_0x4d15c4['id'],_0x4d15c4[_0x11675d(0x259)],_0x4d15c4[_0x11675d(0x216)],_0x5468bc[_0x11675d(0x216)],_0x11675d(0x2c8),{'paymentDetails':_0x5468bc[_0x11675d(0x1ea)],'amount':_0x5468bc[_0x11675d(0x21a)],'currency':_0x5468bc[_0x11675d(0x1e7)],'shopId':_0x4d15c4[_0x11675d(0x213)],'checkTimestamp':new Date()[_0x11675d(0x248)]()});const _0x16fc37={'status':_0x5468bc[_0x11675d(0x216)],'updatedAt':new Date()};if(_0x5468bc['status']===_0x11675d(0x27d)&&_0x4d15c4[_0x11675d(0x216)]!==_0x11675d(0x27d)){_0x16fc37['paidAt']=new Date();if(!_0x4d15c4[_0x11675d(0x2e2)]){const _0x14a1cf=await currencyService_1[_0x11675d(0x203)][_0x11675d(0x258)](_0x4d15c4[_0x11675d(0x21a)],_0x4d15c4['currency']);_0x16fc37[_0x11675d(0x2e2)]=_0x14a1cf;const _0x4e62ab=await this[_0x11675d(0x285)](_0x4d15c4[_0x11675d(0x213)],_0x4d15c4[_0x11675d(0x272)]),_0x117ab3=_0x14a1cf*(0x1-_0x4e62ab/0x64);_0x16fc37['amountAfterGatewayCommissionUSDT']=_0x117ab3,console[_0x11675d(0x276)](_0x11675d(0x251)+_0x4d15c4['id']+_0x11675d(0x2df)),console['log'](_0x11675d(0x225)+_0x4d15c4[_0x11675d(0x21a)]+'\x20'+_0x4d15c4[_0x11675d(0x1e7)]+_0x11675d(0x234)+_0x14a1cf[_0x11675d(0x24d)](0x6)+_0x11675d(0x2cf)),console['log']('\x20\x20\x20Gateway\x20'+_0x4d15c4[_0x11675d(0x272)]+_0x11675d(0x223)+_0x4e62ab+'%'),console[_0x11675d(0x276)](_0x11675d(0x240)+_0x117ab3['toFixed'](0x6)+_0x11675d(0x2cf));}console[_0x11675d(0x276)](_0x11675d(0x251)+_0x4d15c4['id']+_0x11675d(0x23e)+_0x16fc37[_0x11675d(0x2b9)]['toISOString']());}if(_0x5468bc[_0x11675d(0x1ea)]){const _0x38e63b=_0x5468bc['paymentDetails'];_0x38e63b[_0x11675d(0x235)]&&(_0x16fc37[_0x11675d(0x264)]=_0x38e63b[_0x11675d(0x235)],console[_0x11675d(0x276)](_0x11675d(0x299)+_0x38e63b['iban']));if(_0x38e63b[_0x11675d(0x21f)]){const _0xb36b9a=_0x4d15c4['adminNotes']||'',_0x3fc76d=_0x11675d(0x1f8)+_0x38e63b['bankDetails'];_0x16fc37['adminNotes']=_0xb36b9a?_0xb36b9a+'\x0a\x0a'+_0x3fc76d:_0x3fc76d,console['log'](_0x11675d(0x2b8));}_0x38e63b[_0x11675d(0x28f)]&&console[_0x11675d(0x276)](_0x11675d(0x275)+_0x38e63b[_0x11675d(0x28f)]),_0x38e63b[_0x11675d(0x265)]&&console['log']('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x38e63b[_0x11675d(0x265)]);}await database_1[_0x11675d(0x207)][_0x11675d(0x237)][_0x11675d(0x2a1)]({'where':{'id':_0x4d15c4['id']},'data':_0x16fc37});if(_0x5468bc[_0x11675d(0x216)]===_0x11675d(0x27d)&&_0x4d15c4[_0x11675d(0x216)]!==_0x11675d(0x27d)){console[_0x11675d(0x276)](_0x11675d(0x2d9)+_0x4d15c4['id']+_0x11675d(0x2c2));const _0x266042=await database_1[_0x11675d(0x207)][_0x11675d(0x237)][_0x11675d(0x1f0)]({'where':{'id':_0x4d15c4['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x266042?.[_0x11675d(0x270)]&&_0x266042[_0x11675d(0x218)])try{const _0x4e3008=_0x266042['paymentLink'];console[_0x11675d(0x276)](_0x11675d(0x2c5)+_0x4e3008['id']+_0x11675d(0x29d)+_0x4e3008['type']+_0x11675d(0x1ff)+_0x4e3008[_0x11675d(0x26a)]+_0x11675d(0x2d6)+_0x4e3008[_0x11675d(0x216)]);const _0x3c93fe=_0x4e3008[_0x11675d(0x26a)]+0x1,_0x305d11=_0x4e3008[_0x11675d(0x243)]===_0x11675d(0x23b)?_0x11675d(0x2a8):_0x4e3008[_0x11675d(0x216)];await database_1[_0x11675d(0x207)][_0x11675d(0x218)]['update']({'where':{'id':_0x4e3008['id']},'data':{'currentPayments':_0x3c93fe,'status':_0x305d11,'updatedAt':new Date()}}),console[_0x11675d(0x276)](_0x11675d(0x1fd)+_0x4e3008['id']+_0x11675d(0x288)+_0x4e3008['currentPayments']+'\x20->\x20'+_0x3c93fe+_0x11675d(0x2d6)+_0x4e3008['status']+_0x11675d(0x234)+_0x305d11);}catch(_0x1bf17a){console[_0x11675d(0x2b6)](_0x11675d(0x2c3),_0x1bf17a);}else console[_0x11675d(0x276)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x4d15c4['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x11675d(0x207)][_0x11675d(0x287)][_0x11675d(0x219)]({'data':{'paymentId':_0x4d15c4['id'],'shopId':_0x4d15c4[_0x11675d(0x213)],'event':_0x11675d(0x1e9)+_0x5468bc[_0x11675d(0x216)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x11675d(0x2d1)]({'oldStatus':_0x4d15c4[_0x11675d(0x216)],'newStatus':_0x5468bc[_0x11675d(0x216)],'paymentDetails':_0x5468bc['paymentDetails'],'checkedAt':new Date()['toISOString']()})}}),await this[_0x11675d(0x260)](_0x4d15c4,_0x5468bc[_0x11675d(0x216)]),await this[_0x11675d(0x289)](_0x4d15c4,_0x5468bc['status']),_0x5468bc[_0x11675d(0x216)]!==_0x11675d(0x293)&&(console[_0x11675d(0x276)](_0x11675d(0x2cc)+_0x4d15c4['id']+_0x11675d(0x232)+_0x5468bc[_0x11675d(0x216)]+_0x11675d(0x1fa)),this[_0x11675d(0x1e3)](_0x4d15c4['id'])),console[_0x11675d(0x276)]('✅\x20[CHECK]\x20Payment\x20'+_0x4d15c4['id']+'\x20updated\x20successfully');}else console[_0x11675d(0x276)](_0x11675d(0x2ca)+_0x4d15c4['id']+'\x20status\x20unchanged\x20('+_0x5468bc['status']+')'),this[_0x11675d(0x284)](_0x4d15c4['id'],_0x4d15c4[_0x11675d(0x259)],_0x4d15c4['status'],_0x5468bc[_0x11675d(0x216)],_0x11675d(0x2c8),{'statusUnchanged':!![],'paymentDetails':_0x5468bc[_0x11675d(0x1ea)],'amount':_0x5468bc[_0x11675d(0x21a)],'currency':_0x5468bc[_0x11675d(0x1e7)],'shopId':_0x4d15c4[_0x11675d(0x213)],'checkTimestamp':new Date()[_0x11675d(0x248)]()});}catch(_0xb4a817){console[_0x11675d(0x2b6)]('❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x4d15c4['id']+':',_0xb4a817),this['logCoinToPayError'](_0x4d15c4['id'],_0x4d15c4[_0x11675d(0x259)],_0xb4a817,_0x11675d(0x2c8),{'paymentAmount':_0x4d15c4['amount'],'paymentCurrency':_0x4d15c4[_0x11675d(0x1e7)],'shopId':_0x4d15c4[_0x11675d(0x213)],'createdAt':_0x4d15c4['createdAt']}),await database_1[_0x11675d(0x207)]['webhookLog']['create']({'data':{'paymentId':_0x4d15c4['id'],'shopId':_0x4d15c4[_0x11675d(0x213)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x11675d(0x2d1)]({'error':_0xb4a817 instanceof Error?_0xb4a817['message']:_0x11675d(0x1fc),'gatewayPaymentId':_0x4d15c4[_0x11675d(0x259)],'checkedAt':new Date()[_0x11675d(0x248)]()})}});}}async[a38_0xd904ab(0x260)](_0x4667c0,_0x22f87e){const _0x4f0b20=a38_0xd904ab,_0x1a9c4d=Date[_0x4f0b20(0x2a5)]();try{const _0x48dea1=_0x4667c0[_0x4f0b20(0x22a)],_0x278fc3=_0x48dea1[_0x4f0b20(0x269)];if(!_0x278fc3?.[_0x4f0b20(0x23f)]){console['log'](_0x4f0b20(0x255)+_0x48dea1['id']);return;}const _0x183950=_0x22f87e===_0x4f0b20(0x27d)?'payment.success':_0x22f87e===_0x4f0b20(0x2bb)?_0x4f0b20(0x238):_0x22f87e===_0x4f0b20(0x28b)?_0x4f0b20(0x238):_0x4f0b20(0x221);if(!_0x278fc3['webhookEvents']?.[_0x4f0b20(0x20c)](_0x183950)){console[_0x4f0b20(0x276)]('Webhook\x20event\x20'+_0x183950+_0x4f0b20(0x1e8)+_0x48dea1['id']);return;}const _0x14ce82=(0x0,gateway_1['getGatewayIdByName'])(_0x4667c0['gateway'])||_0x4667c0[_0x4f0b20(0x272)],_0x39b1d4={'event':_0x183950,'payment':{'id':_0x4667c0['id'],'order_id':_0x4667c0[_0x4f0b20(0x296)],'gateway_order_id':_0x4667c0[_0x4f0b20(0x228)],'gateway':_0x14ce82,'amount':_0x4667c0[_0x4f0b20(0x21a)],'currency':_0x4667c0['currency'],'status':_0x22f87e[_0x4f0b20(0x246)](),'customer_email':_0x4667c0[_0x4f0b20(0x2b4)],'customer_name':_0x4667c0[_0x4f0b20(0x25c)],'created_at':_0x4667c0['createdAt'],'updated_at':new Date()}},_0x18979c=await fetch(_0x278fc3['webhookUrl'],{'method':'POST','headers':{'Content-Type':_0x4f0b20(0x210),'User-Agent':_0x4f0b20(0x2b1)},'body':JSON[_0x4f0b20(0x2d1)](_0x39b1d4)}),_0x25a129=Date[_0x4f0b20(0x2a5)]()-_0x1a9c4d,_0x46537e=_0x18979c['ok']?_0x4f0b20(0x25f):await _0x18979c[_0x4f0b20(0x229)]();loggerService_1[_0x4f0b20(0x23d)]['logShopWebhookSent'](_0x4667c0['shopId'],_0x278fc3['webhookUrl'],_0x183950,_0x18979c['status'],_0x25a129,_0x39b1d4),console[_0x4f0b20(0x276)](_0x4f0b20(0x2ba)+_0x278fc3[_0x4f0b20(0x23f)]+_0x4f0b20(0x278)+_0x18979c[_0x4f0b20(0x216)]+'\x20('+_0x25a129+'ms)');}catch(_0xe34616){console[_0x4f0b20(0x2b6)](_0x4f0b20(0x2db),_0xe34616),loggerService_1['loggerService'][_0x4f0b20(0x2cb)](_0x4667c0[_0x4f0b20(0x213)],_0x4667c0[_0x4f0b20(0x22a)]?.[_0x4f0b20(0x269)]?.[_0x4f0b20(0x23f)]||_0x4f0b20(0x2e0),'webhook_send',_0xe34616,{});}}async['sendPaymentStatusNotification'](_0x299103,_0x11b0d0){const _0xaa94c8=a38_0xd904ab;try{const _0x5674f4={'PENDING':_0xaa94c8(0x1f3),'PAID':_0xaa94c8(0x1fb),'FAILED':_0xaa94c8(0x209),'EXPIRED':'expired'},_0xee3a60=_0x5674f4[_0x11b0d0];if(!_0xee3a60||_0xee3a60==='created')return;await telegramBotService_1[_0xaa94c8(0x294)]['sendPaymentNotification'](_0x299103[_0xaa94c8(0x213)],_0x299103,_0xee3a60);}catch(_0x17a5a9){console[_0xaa94c8(0x2b6)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x17a5a9);}}async[a38_0xd904ab(0x26d)](_0x585477){const _0x3c452b=a38_0xd904ab;console[_0x3c452b(0x276)](_0x3c452b(0x1ed)+_0x585477);const _0x7a2eef=await database_1[_0x3c452b(0x207)][_0x3c452b(0x237)][_0x3c452b(0x1f0)]({'where':{'id':_0x585477},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x7a2eef)throw new Error(_0x3c452b(0x1e0));if(_0x7a2eef[_0x3c452b(0x272)]!==_0x3c452b(0x21e)&&_0x7a2eef[_0x3c452b(0x272)]!==_0x3c452b(0x1f4))throw new Error(_0x3c452b(0x277));console['log'](_0x3c452b(0x2ad)+_0x7a2eef[_0x3c452b(0x272)]+_0x3c452b(0x26b)+_0x585477),await this[_0x3c452b(0x28c)](_0x7a2eef),console['log'](_0x3c452b(0x230)+_0x585477);}['getServiceStats'](){const _0x44bfe9=a38_0xd904ab,_0x4a4e4c=this['globalCheckInterval']?this[_0x44bfe9(0x231)]:undefined,_0x36ad1d=Array['from'](this[_0x44bfe9(0x214)][_0x44bfe9(0x2e4)]())['map'](_0x3d5435=>({'paymentId':_0x3d5435['paymentId'],'gatewayPaymentId':_0x3d5435[_0x44bfe9(0x259)],'createdAt':_0x3d5435['createdAt'],'timersCount':_0x3d5435[_0x44bfe9(0x24a)][_0x44bfe9(0x1e2)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x44bfe9(0x231)]/(0x3e8*0x3c),'expiryDays':this[_0x44bfe9(0x2b2)],'activeIndividualTimers':this[_0x44bfe9(0x214)]['size'],'nextGlobalCheckIn':_0x4a4e4c,'paymentTimersDetails':_0x36ad1d};}[a38_0xd904ab(0x2b5)](_0x2d6447){const _0x22759f=a38_0xd904ab,_0x47540d=this['paymentTimers'][_0x22759f(0x2ab)](_0x2d6447);if(_0x47540d)return{'hasTimers':!![],'timersCount':_0x47540d[_0x22759f(0x24a)][_0x22759f(0x1e2)],'createdAt':_0x47540d[_0x22759f(0x29c)],'gatewayPaymentId':_0x47540d['gatewayPaymentId']};return{'hasTimers':![]};}async[a38_0xd904ab(0x285)](_0x3aa0f3,_0x25edfc){const _0x391d92=a38_0xd904ab;try{const _0x40fa3d=await database_1[_0x391d92(0x207)][_0x391d92(0x22a)][_0x391d92(0x1f0)]({'where':{'id':_0x3aa0f3},'select':{'gatewaySettings':!![]}});if(!_0x40fa3d?.[_0x391d92(0x2a9)])return console[_0x391d92(0x276)](_0x391d92(0x2dd)+_0x3aa0f3+_0x391d92(0x22b)),0xa;const _0x1cef05=JSON[_0x391d92(0x2c7)](_0x40fa3d[_0x391d92(0x2a9)]);for(const [_0x52e71d,_0x22d360]of Object['entries'](_0x1cef05)){if(_0x52e71d[_0x391d92(0x246)]()===_0x25edfc[_0x391d92(0x246)]()){const _0xadf1ae=_0x22d360[_0x391d92(0x253)]||0xa;return console[_0x391d92(0x276)](_0x391d92(0x20d)+_0x25edfc+_0x391d92(0x257)+_0x3aa0f3+':\x20'+_0xadf1ae+'%'),_0xadf1ae;}}return console[_0x391d92(0x276)](_0x391d92(0x2a4)+_0x25edfc+'\x20in\x20shop\x20'+_0x3aa0f3+',\x20using\x20default\x2010%'),0xa;}catch(_0x390e12){return console[_0x391d92(0x2b6)](_0x391d92(0x27b)+_0x3aa0f3+_0x391d92(0x1dd)+_0x25edfc+':',_0x390e12),0xa;}}}exports[a38_0xd904ab(0x2af)]=CoinToPayStatusService,exports[a38_0xd904ab(0x291)]=new CoinToPayStatusService();