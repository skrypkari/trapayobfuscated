'use strict';const a48_0xd1d2c0=a48_0x138b;(function(_0x11ae11,_0x3f4aff){const _0x4a9164=a48_0x138b,_0x344916=_0x11ae11();while(!![]){try{const _0x2aeea3=-parseInt(_0x4a9164(0x15a))/0x1*(-parseInt(_0x4a9164(0x16e))/0x2)+-parseInt(_0x4a9164(0x144))/0x3+parseInt(_0x4a9164(0xfb))/0x4+parseInt(_0x4a9164(0x167))/0x5*(-parseInt(_0x4a9164(0x160))/0x6)+-parseInt(_0x4a9164(0x12b))/0x7*(-parseInt(_0x4a9164(0x148))/0x8)+parseInt(_0x4a9164(0x1b6))/0x9+-parseInt(_0x4a9164(0x15b))/0xa*(parseInt(_0x4a9164(0x11c))/0xb);if(_0x2aeea3===_0x3f4aff)break;else _0x344916['push'](_0x344916['shift']());}catch(_0x24892e){_0x344916['push'](_0x344916['shift']());}}}(a48_0x41cb,0x9da9f));var __importDefault=this&&this['__importDefault']||function(_0x128596){const _0x1da2b0=a48_0x138b;return _0x128596&&_0x128596[_0x1da2b0(0xf7)]?_0x128596:{'default':_0x128596};};Object[a48_0xd1d2c0(0x1cb)](exports,a48_0xd1d2c0(0xf7),{'value':!![]}),exports[a48_0xd1d2c0(0xe1)]=exports[a48_0xd1d2c0(0x19e)]=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a48_0xd1d2c0(0xe7)),gateway_1=require(a48_0xd1d2c0(0x146)),database_1=__importDefault(require(a48_0xd1d2c0(0x14f))),telegramBotService_1=require(a48_0xd1d2c0(0x111)),loggerService_1=require(a48_0xd1d2c0(0x164)),currencyService_1=require(a48_0xd1d2c0(0x150));class CoinToPayStatusService{constructor(){const _0x509db0=a48_0xd1d2c0;this[_0x509db0(0x141)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x509db0(0xd1)]=0x5,this['paymentTimers']=new Map(),this[_0x509db0(0xf5)]=new coinToPayService_1['CoinToPayService'](),this[_0x509db0(0x17e)]=new coinToPay2Service_1[(_0x509db0(0x1aa))](),console[_0x509db0(0x156)]('ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a48_0xd1d2c0(0x136)](_0x56ad98,_0x113d15){const _0x5d7470=a48_0xd1d2c0;console[_0x5d7470(0x156)]('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console['log'](_0x5d7470(0x154)+_0x56ad98),console[_0x5d7470(0x156)]('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x113d15),this['clearPaymentTimers'](_0x56ad98);const _0x3d1006=[],_0x1bc1b8=new Date(),_0x2dd397=[{'delay':0x1*0x3c*0x3e8,'description':_0x5d7470(0xd2)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x5d7470(0x16a)},{'delay':0x5*0x3c*0x3e8,'description':_0x5d7470(0x16a)}];console[_0x5d7470(0x156)]('ü™ô\x20[DEBUG]\x20Creating\x20'+_0x2dd397['length']+_0x5d7470(0x109)+_0x56ad98);let _0xfe702=0x0;_0x2dd397[_0x5d7470(0x16b)]((_0x5aa850,_0x111de4)=>{const _0x5e0200=_0x5d7470;_0xfe702+=_0x5aa850[_0x5e0200(0x12e)];const _0x1e7121=setTimeout(async()=>{const _0x59671e=_0x5e0200;console[_0x59671e(0x156)](_0x59671e(0x1b1)+(_0x111de4+0x1)+_0x59671e(0x1d3)+_0x56ad98+_0x59671e(0xe8)+_0x5aa850[_0x59671e(0x1ac)]+')');try{await this[_0x59671e(0x18c)](_0x56ad98),console[_0x59671e(0x156)](_0x59671e(0x100)+(_0x111de4+0x1)+'\x20completed\x20for\x20payment\x20'+_0x56ad98);}catch(_0x1f9189){console[_0x59671e(0x132)](_0x59671e(0x186)+(_0x111de4+0x1)+_0x59671e(0xe0)+_0x56ad98+':',_0x1f9189),this[_0x59671e(0x1d1)](_0x56ad98,_0x113d15,_0x1f9189,'status_check',{'checkNumber':_0x111de4+0x1,'scheduledAfter':_0x5aa850[_0x59671e(0x1ac)],'isIndividualCheck':!![]});}},_0xfe702);_0x3d1006[_0x5e0200(0x128)](_0x1e7121),console[_0x5e0200(0x156)](_0x5e0200(0x194)+(_0x111de4+0x1)+_0x5e0200(0xe0)+_0x56ad98+_0x5e0200(0x14c)+_0xfe702/0x3e8+'\x20seconds\x20('+_0x5aa850['description']+')');});const _0x5d15cb=setInterval(async()=>{const _0x4b3fe6=_0x5d7470;console[_0x4b3fe6(0x156)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x56ad98);try{const _0x1ec18c=await database_1[_0x4b3fe6(0x1d2)][_0x4b3fe6(0x1cf)][_0x4b3fe6(0xff)]({'where':{'id':_0x56ad98},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x1ec18c){console[_0x4b3fe6(0x156)](_0x4b3fe6(0xf1)+_0x56ad98+_0x4b3fe6(0x11a)),this[_0x4b3fe6(0xe5)](_0x56ad98);return;}console[_0x4b3fe6(0x156)](_0x4b3fe6(0x102)+_0x56ad98+_0x4b3fe6(0x127)+_0x1ec18c[_0x4b3fe6(0x140)]);if(_0x1ec18c[_0x4b3fe6(0x140)]!==_0x4b3fe6(0x1c1)){console[_0x4b3fe6(0x156)]('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x56ad98+_0x4b3fe6(0x1d7)+_0x1ec18c['status']+_0x4b3fe6(0x1bb)),this[_0x4b3fe6(0xe5)](_0x56ad98);return;}const _0x462fbe=Math[_0x4b3fe6(0x182)]((Date[_0x4b3fe6(0x106)]()-_0x1ec18c['createdAt'][_0x4b3fe6(0x17f)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x462fbe>=this[_0x4b3fe6(0xd1)]){console[_0x4b3fe6(0x156)](_0x4b3fe6(0x12f)+_0x56ad98+'\x20is\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x4b3fe6(0xd7)),this[_0x4b3fe6(0xe5)](_0x56ad98);return;}await this[_0x4b3fe6(0x18c)](_0x56ad98),console[_0x4b3fe6(0x156)](_0x4b3fe6(0xfd)+_0x56ad98);}catch(_0x18b94b){console[_0x4b3fe6(0x132)](_0x4b3fe6(0x17b)+_0x56ad98+':',_0x18b94b),this['logCoinToPayError'](_0x56ad98,_0x113d15,_0x18b94b,_0x4b3fe6(0x17c),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x3d1006[_0x5d7470(0x128)](_0x5d15cb),this[_0x5d7470(0x1a6)][_0x5d7470(0x159)](_0x56ad98,{'timers':_0x3d1006,'paymentId':_0x56ad98,'gatewayPaymentId':_0x113d15,'createdAt':_0x1bc1b8}),console[_0x5d7470(0x156)]('‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20'+_0x2dd397[_0x5d7470(0x1c0)]+_0x5d7470(0xcc)+_0x56ad98),console[_0x5d7470(0x156)](_0x5d7470(0xed)+this['paymentTimers'][_0x5d7470(0x1af)]),this['logCoinToPayStatus'](_0x56ad98,_0x113d15,_0x5d7470(0x1c1),_0x5d7470(0x1c1),_0x5d7470(0x17c),{'action':_0x5d7470(0x103),'scheduledChecks':_0x2dd397[_0x5d7470(0x1c0)],'firstCheckIn':_0x2dd397[0x0][_0x5d7470(0x12e)]/0x3e8,'totalTimers':this[_0x5d7470(0x1a6)][_0x5d7470(0x1af)]});}[a48_0xd1d2c0(0xe5)](_0x20aec9){const _0x258086=a48_0xd1d2c0,_0x440a6b=this[_0x258086(0x1a6)][_0x258086(0xcb)](_0x20aec9);_0x440a6b?(console['log']('üßπ\x20[DEBUG]\x20Clearing\x20'+_0x440a6b[_0x258086(0x10f)][_0x258086(0x1c0)]+_0x258086(0xd4)+_0x20aec9),_0x440a6b['timers'][_0x258086(0x16b)]((_0x2077ae,_0x16815f)=>{const _0x33c5c3=_0x258086;_0x2077ae&&(clearTimeout(_0x2077ae),clearInterval(_0x2077ae),console[_0x33c5c3(0x156)](_0x33c5c3(0xe4)+(_0x16815f+0x1)+'\x20for\x20payment\x20'+_0x20aec9));}),this[_0x258086(0x1a6)][_0x258086(0x10e)](_0x20aec9),console[_0x258086(0x156)]('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x20aec9+_0x258086(0x114)+this['paymentTimers'][_0x258086(0x1af)])):console[_0x258086(0x156)](_0x258086(0x198)+_0x20aec9+_0x258086(0x14b));}async[a48_0xd1d2c0(0x18c)](_0x71cc4){const _0x370b64=a48_0xd1d2c0;console[_0x370b64(0x156)](_0x370b64(0x101)+_0x71cc4);const _0x10dbf8=await database_1[_0x370b64(0x1d2)]['payment']['findUnique']({'where':{'id':_0x71cc4},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x10dbf8){console['log'](_0x370b64(0x1d4)+_0x71cc4+_0x370b64(0x1c9));return;}console[_0x370b64(0x156)](_0x370b64(0x15e)+_0x71cc4+_0x370b64(0xcf)),console[_0x370b64(0x156)](_0x370b64(0x124)+_0x10dbf8[_0x370b64(0x1b7)]),console[_0x370b64(0x156)](_0x370b64(0x155)+_0x10dbf8['status']),console[_0x370b64(0x156)](_0x370b64(0xdc)+_0x10dbf8[_0x370b64(0xd8)]),console[_0x370b64(0x156)](_0x370b64(0x121)+_0x10dbf8[_0x370b64(0x145)]+'\x20'+_0x10dbf8['currency']),console[_0x370b64(0x156)](_0x370b64(0x1ad)+_0x10dbf8['shopId']);if(_0x10dbf8[_0x370b64(0x1b7)]!=='cointopay'&&_0x10dbf8[_0x370b64(0x1b7)]!==_0x370b64(0x17d)){console[_0x370b64(0x156)](_0x370b64(0xfc)+_0x71cc4+_0x370b64(0x113)+_0x10dbf8[_0x370b64(0x1b7)]+')');return;}if(_0x10dbf8[_0x370b64(0x140)]!==_0x370b64(0x1c1)){console[_0x370b64(0x156)](_0x370b64(0xfc)+_0x71cc4+_0x370b64(0x1d7)+_0x10dbf8[_0x370b64(0x140)]+_0x370b64(0x1bb)),this[_0x370b64(0xe5)](_0x71cc4);return;}if(!_0x10dbf8[_0x370b64(0xd8)]){console[_0x370b64(0x156)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x71cc4+_0x370b64(0x13e));return;}console['log'](_0x370b64(0x143)+_0x71cc4+_0x370b64(0x108)),await this[_0x370b64(0xf8)](_0x10dbf8);}['logCoinToPayStatus'](_0x53482d,_0xaf2b43,_0x5a68d9,_0x50a950,_0x25641d,_0x4c0823){const _0x48dab0=a48_0xd1d2c0,_0x4c0828={'type':_0x48dab0(0x1d5),'paymentId':_0x53482d,'gatewayPaymentId':_0xaf2b43,'oldStatus':_0x5a68d9,'newStatus':_0x50a950,'source':_0x25641d,'timestamp':new Date()['toISOString'](),'details':_0x4c0823||{}};loggerService_1[_0x48dab0(0x1cc)][_0x48dab0(0xfa)](_0x4c0828),console[_0x48dab0(0x156)](_0x48dab0(0xdf)+_0x53482d+'\x20('+_0xaf2b43+')'),console[_0x48dab0(0x156)]('\x20\x20\x20üìä\x20Status:\x20'+_0x5a68d9+_0x48dab0(0x177)+_0x50a950),console['log'](_0x48dab0(0xd6)+_0x25641d),console[_0x48dab0(0x156)](_0x48dab0(0xcd)+_0x4c0828[_0x48dab0(0x1c6)]),_0x4c0823&&console[_0x48dab0(0x156)](_0x48dab0(0xd3),_0x4c0823);}[a48_0xd1d2c0(0x1d1)](_0x377e01,_0x1df3aa,_0x2730ec,_0x560ff8,_0x27a240){const _0x5e0a4b=a48_0xd1d2c0,_0x509aa1={'type':_0x5e0a4b(0x13b),'paymentId':_0x377e01,'gatewayPaymentId':_0x1df3aa,'error':_0x2730ec instanceof Error?{'message':_0x2730ec[_0x5e0a4b(0x1c8)],'stack':_0x2730ec[_0x5e0a4b(0x175)]}:_0x2730ec,'source':_0x560ff8,'timestamp':new Date()[_0x5e0a4b(0x197)](),'context':_0x27a240||{}};loggerService_1[_0x5e0a4b(0x1cc)]['logCoinToPayError'](_0x509aa1),console[_0x5e0a4b(0x132)](_0x5e0a4b(0x18b)+_0x377e01+'\x20('+_0x1df3aa+')'),console[_0x5e0a4b(0x132)](_0x5e0a4b(0x1b5)+(_0x2730ec instanceof Error?_0x2730ec['message']:_0x2730ec)),console[_0x5e0a4b(0x132)]('\x20\x20\x20üìç\x20Source:\x20'+_0x560ff8),console[_0x5e0a4b(0x132)](_0x5e0a4b(0xcd)+_0x509aa1[_0x5e0a4b(0x1c6)]),_0x27a240&&console[_0x5e0a4b(0x132)](_0x5e0a4b(0x14e),_0x27a240);}[a48_0xd1d2c0(0x1a3)](){const _0x498798=a48_0xd1d2c0;console[_0x498798(0x156)](_0x498798(0xf6)),this['checkAllPendingPayments']()[_0x498798(0x16f)](_0x188af2=>{const _0x54e303=_0x498798;console[_0x54e303(0x132)](_0x54e303(0xfe),_0x188af2);}),this[_0x498798(0x141)]=setInterval(async()=>{const _0x274537=_0x498798;try{console[_0x274537(0x156)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x274537(0xda)](),console[_0x274537(0x156)](_0x274537(0x169));}catch(_0xe80cee){console[_0x274537(0x132)](_0x274537(0x1be),_0xe80cee);}},this[_0x498798(0x13f)]),console[_0x498798(0x156)](_0x498798(0x163));}[a48_0xd1d2c0(0x142)](){const _0x5215c8=a48_0xd1d2c0;console[_0x5215c8(0x156)]('üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0x5215c8(0x141)]&&(clearInterval(this[_0x5215c8(0x141)]),this[_0x5215c8(0x141)]=null,console[_0x5215c8(0x156)](_0x5215c8(0x117)));const _0x236220=this[_0x5215c8(0x1a6)][_0x5215c8(0x1af)];for(const [_0x54e361]of this[_0x5215c8(0x1a6)]){this[_0x5215c8(0xe5)](_0x54e361);}console[_0x5215c8(0x156)](_0x5215c8(0x1a7)+_0x236220+_0x5215c8(0x116));}async['checkAllPendingPayments'](){const _0x78c19=a48_0xd1d2c0;try{console[_0x78c19(0x156)](_0x78c19(0x162));const _0x46c712=await database_1['default'][_0x78c19(0x1cf)]['findMany']({'where':{'gateway':{'in':[_0x78c19(0x18a),_0x78c19(0x17d)]},'status':_0x78c19(0x1c1),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x78c19(0x156)](_0x78c19(0x1a9)+_0x46c712['length']+_0x78c19(0x190));if(_0x46c712[_0x78c19(0x1c0)]===0x0){console[_0x78c19(0x156)]('ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0xe1d26a=await this[_0x78c19(0xc9)](_0x46c712);console[_0x78c19(0x156)](_0x78c19(0x147)+_0xe1d26a['length']+_0x78c19(0x1d6));let _0x1a4322=0x0,_0x3bb1c8=0x0;for(const _0x1976ec of _0x46c712){try{if(_0xe1d26a[_0x78c19(0x165)](_0x1976ec['id'])){console[_0x78c19(0x156)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x1976ec['id']+_0x78c19(0x173)),_0x3bb1c8++;continue;}if(this[_0x78c19(0x1a6)][_0x78c19(0x1ce)](_0x1976ec['id'])){console[_0x78c19(0x156)](_0x78c19(0x181)+_0x1976ec['id']+_0x78c19(0x10a)),_0x3bb1c8++;continue;}const _0x4e0adb=(Date[_0x78c19(0x106)]()-_0x1976ec['createdAt'][_0x78c19(0x17f)]())/(0x3e8*0x3c*0x3c);if(_0x4e0adb<0x1){console[_0x78c19(0x156)](_0x78c19(0x181)+_0x1976ec['id']+_0x78c19(0xf3)+_0x4e0adb['toFixed'](0x1)+_0x78c19(0x1b8)),_0x3bb1c8++;continue;}console[_0x78c19(0x156)](_0x78c19(0x115)+_0x1976ec['id']+_0x78c19(0x168)+_0x4e0adb[_0x78c19(0x1a2)](0x1)+'h)'),await this[_0x78c19(0xf8)](_0x1976ec),_0x1a4322++,await new Promise(_0x48bda0=>setTimeout(_0x48bda0,0x7d0));}catch(_0x4e33fa){console['error']('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x1976ec['id']+':',_0x4e33fa),this[_0x78c19(0x1d1)](_0x1976ec['id'],_0x1976ec[_0x78c19(0xd8)]||_0x78c19(0x112),_0x4e33fa,_0x78c19(0x17c),{'isGlobalCheck':!![],'paymentAmount':_0x1976ec[_0x78c19(0x145)],'paymentCurrency':_0x1976ec['currency'],'shopId':_0x1976ec[_0x78c19(0x13c)],'createdAt':_0x1976ec[_0x78c19(0x1ae)]}),loggerService_1[_0x78c19(0x1cc)]['logWhiteDomainError'](_0x78c19(0x18a),_0x78c19(0x1b3)+_0x1976ec[_0x78c19(0xd8)],_0x4e33fa);}}console[_0x78c19(0x156)](_0x78c19(0xe3)+_0x1a4322+_0x78c19(0x195)+_0x3bb1c8+_0x78c19(0x107)+_0xe1d26a[_0x78c19(0x1c0)]+'\x20expired');}catch(_0x512e30){console[_0x78c19(0x132)](_0x78c19(0x1bf),_0x512e30);}}async[a48_0xd1d2c0(0xc9)](_0x22ddda){const _0x24d725=a48_0xd1d2c0,_0x5232a0=[],_0x16ebcb=new Date();_0x16ebcb[_0x24d725(0xdb)](_0x16ebcb['getDate']()-this[_0x24d725(0xd1)]),console[_0x24d725(0x156)]('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x24d725(0xd1)]+_0x24d725(0x1bc)+_0x16ebcb[_0x24d725(0x197)]()+')');for(const _0x9e6418 of _0x22ddda){if(_0x9e6418[_0x24d725(0x1ae)]<_0x16ebcb){console['log'](_0x24d725(0x105)+_0x9e6418['id']+_0x24d725(0x187)+this[_0x24d725(0xd1)]+_0x24d725(0x1b0));try{this['logCoinToPayStatus'](_0x9e6418['id'],_0x9e6418[_0x24d725(0xd8)]||_0x24d725(0x112),_0x24d725(0x1c1),_0x24d725(0xef),_0x24d725(0x1c5),{'reason':_0x24d725(0x189)+this[_0x24d725(0xd1)]+_0x24d725(0xe9),'createdAt':_0x9e6418[_0x24d725(0x1ae)],'daysSinceCreation':Math[_0x24d725(0x182)]((Date[_0x24d725(0x106)]()-_0x9e6418[_0x24d725(0x1ae)][_0x24d725(0x17f)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x9e6418[_0x24d725(0x145)],'paymentCurrency':_0x9e6418['currency'],'shopId':_0x9e6418[_0x24d725(0x13c)]}),await database_1[_0x24d725(0x1d2)][_0x24d725(0x1cf)][_0x24d725(0x134)]({'where':{'id':_0x9e6418['id']},'data':{'status':_0x24d725(0xef),'updatedAt':new Date()}}),await database_1[_0x24d725(0x1d2)][_0x24d725(0xf0)][_0x24d725(0x122)]({'data':{'paymentId':_0x9e6418['id'],'shopId':_0x9e6418[_0x24d725(0x13c)],'event':_0x24d725(0x149),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':'Payment\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x24d725(0xe9),'createdAt':_0x9e6418[_0x24d725(0x1ae)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x24d725(0x182)]((Date[_0x24d725(0x106)]()-_0x9e6418['createdAt'][_0x24d725(0x17f)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x9e6418,_0x24d725(0xef)),await this[_0x24d725(0xc7)](_0x9e6418,'EXPIRED'),this[_0x24d725(0xe5)](_0x9e6418['id']),_0x5232a0['push'](_0x9e6418['id']),console['log'](_0x24d725(0x13d)+_0x9e6418['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x24d725(0xd1)]+_0x24d725(0x172));}catch(_0x2a03f6){console[_0x24d725(0x132)](_0x24d725(0xdd)+_0x9e6418['id']+':',_0x2a03f6),this[_0x24d725(0x1d1)](_0x9e6418['id'],_0x9e6418['gatewayPaymentId']||_0x24d725(0x112),_0x2a03f6,_0x24d725(0x1c5),{'reason':_0x24d725(0xc8),'createdAt':_0x9e6418[_0x24d725(0x1ae)],'daysSinceCreation':Math[_0x24d725(0x182)]((Date[_0x24d725(0x106)]()-_0x9e6418[_0x24d725(0x1ae)][_0x24d725(0x17f)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x5232a0;}async[a48_0xd1d2c0(0xf8)](_0x5d77ac){const _0x2cfa6d=a48_0xd1d2c0;if(!_0x5d77ac[_0x2cfa6d(0xd8)]){console[_0x2cfa6d(0x156)](_0x2cfa6d(0xfc)+_0x5d77ac['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x2cfa6d(0x156)]('üîç\x20[CHECK]\x20Checking\x20'+_0x5d77ac[_0x2cfa6d(0x1b7)]+_0x2cfa6d(0x157)+_0x5d77ac['id']+'\x20('+_0x5d77ac['gatewayPaymentId']+')');try{let _0x42df3e;_0x5d77ac[_0x2cfa6d(0x1b7)]===_0x2cfa6d(0x17d)?(_0x42df3e=await this[_0x2cfa6d(0x17e)][_0x2cfa6d(0x179)](_0x5d77ac['gatewayPaymentId']),console['log'](_0x2cfa6d(0x18f)+_0x5d77ac['id']+_0x2cfa6d(0x12d)+_0x42df3e[_0x2cfa6d(0x140)])):(_0x42df3e=await this[_0x2cfa6d(0xf5)][_0x2cfa6d(0x179)](_0x5d77ac['gatewayPaymentId']),console[_0x2cfa6d(0x156)](_0x2cfa6d(0xf2)+_0x5d77ac['id']+_0x2cfa6d(0x12d)+_0x42df3e[_0x2cfa6d(0x140)]));_0x42df3e[_0x2cfa6d(0x110)]&&console['log'](_0x2cfa6d(0x15e)+_0x5d77ac['id']+'\x20details:',{'iban':_0x42df3e['paymentDetails'][_0x2cfa6d(0x130)]||_0x2cfa6d(0x1ab),'transactionId':_0x42df3e[_0x2cfa6d(0x110)][_0x2cfa6d(0xce)],'createdOn':_0x42df3e['paymentDetails'][_0x2cfa6d(0xf4)],'confirmedOn':_0x42df3e[_0x2cfa6d(0x110)][_0x2cfa6d(0x19a)]||_0x2cfa6d(0x19f)});if(_0x42df3e[_0x2cfa6d(0x140)]!==_0x5d77ac['status']){console[_0x2cfa6d(0x156)]('üîÑ\x20[CHECK]\x20Updating\x20payment\x20'+_0x5d77ac['id']+_0x2cfa6d(0x11e)+_0x5d77ac['status']+_0x2cfa6d(0x19b)+_0x42df3e[_0x2cfa6d(0x140)]),this[_0x2cfa6d(0xfa)](_0x5d77ac['id'],_0x5d77ac[_0x2cfa6d(0xd8)],_0x5d77ac[_0x2cfa6d(0x140)],_0x42df3e['status'],_0x2cfa6d(0x17c),{'paymentDetails':_0x42df3e[_0x2cfa6d(0x110)],'amount':_0x42df3e['amount'],'currency':_0x42df3e[_0x2cfa6d(0x123)],'shopId':_0x5d77ac[_0x2cfa6d(0x13c)],'checkTimestamp':new Date()[_0x2cfa6d(0x197)]()});const _0x15c7f1={'status':_0x42df3e[_0x2cfa6d(0x140)],'updatedAt':new Date()};if(_0x42df3e[_0x2cfa6d(0x140)]===_0x2cfa6d(0x120)&&_0x5d77ac['status']!==_0x2cfa6d(0x120)){_0x15c7f1[_0x2cfa6d(0x153)]=new Date();if(!_0x5d77ac[_0x2cfa6d(0x193)]){const _0x30bb37=await currencyService_1['currencyService']['convertToUSDT'](_0x5d77ac['amount'],_0x5d77ac['currency']);_0x15c7f1['amountUSDT']=_0x30bb37;const _0x1117f8=await this[_0x2cfa6d(0x135)](_0x5d77ac[_0x2cfa6d(0x13c)],_0x5d77ac['gateway']),_0x19cdf2=_0x30bb37*(0x1-_0x1117f8/0x64);_0x15c7f1[_0x2cfa6d(0x17a)]=_0x19cdf2,_0x15c7f1['gatewayCommissionRate']=_0x1117f8,console['log']('üí∞\x20[CHECK]\x20Payment\x20'+_0x5d77ac['id']+_0x2cfa6d(0x11f)),console[_0x2cfa6d(0x156)](_0x2cfa6d(0x139)+_0x5d77ac[_0x2cfa6d(0x145)]+'\x20'+_0x5d77ac['currency']+'\x20->\x20'+_0x30bb37['toFixed'](0x6)+'\x20USDT'),console['log']('\x20\x20\x20Gateway\x20'+_0x5d77ac[_0x2cfa6d(0x1b7)]+_0x2cfa6d(0xea)+_0x1117f8+'%'),console[_0x2cfa6d(0x156)](_0x2cfa6d(0x1ca)+_0x19cdf2[_0x2cfa6d(0x1a2)](0x6)+_0x2cfa6d(0xd9));}console[_0x2cfa6d(0x156)](_0x2cfa6d(0x1ba)+_0x5d77ac['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x15c7f1['paidAt'][_0x2cfa6d(0x197)]());}if(_0x42df3e[_0x2cfa6d(0x110)]){const _0x3fa09a=_0x42df3e[_0x2cfa6d(0x110)];_0x3fa09a[_0x2cfa6d(0x130)]&&(_0x15c7f1[_0x2cfa6d(0x161)]=_0x3fa09a[_0x2cfa6d(0x130)],console[_0x2cfa6d(0x156)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x3fa09a[_0x2cfa6d(0x130)])),_0x3fa09a[_0x2cfa6d(0x16c)]&&console[_0x2cfa6d(0x156)](_0x2cfa6d(0x185)+_0x3fa09a[_0x2cfa6d(0x16c)]),_0x3fa09a[_0x2cfa6d(0xce)]&&console[_0x2cfa6d(0x156)](_0x2cfa6d(0x184)+_0x3fa09a[_0x2cfa6d(0xce)]),_0x3fa09a[_0x2cfa6d(0x19a)]&&console['log'](_0x2cfa6d(0x152)+_0x3fa09a[_0x2cfa6d(0x19a)]);}await database_1[_0x2cfa6d(0x1d2)]['payment'][_0x2cfa6d(0x134)]({'where':{'id':_0x5d77ac['id']},'data':_0x15c7f1});if(_0x42df3e['status']===_0x2cfa6d(0x120)&&_0x5d77ac[_0x2cfa6d(0x140)]!==_0x2cfa6d(0x120)){console['log'](_0x2cfa6d(0x138)+_0x5d77ac['id']+_0x2cfa6d(0x1a0));const _0x4aab1f=await database_1[_0x2cfa6d(0x1d2)][_0x2cfa6d(0x1cf)][_0x2cfa6d(0xff)]({'where':{'id':_0x5d77ac['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x4aab1f?.[_0x2cfa6d(0xeb)]&&_0x4aab1f[_0x2cfa6d(0x1a5)])try{const _0x34ca90=_0x4aab1f[_0x2cfa6d(0x1a5)];console[_0x2cfa6d(0x156)](_0x2cfa6d(0x12c)+_0x34ca90['id']+_0x2cfa6d(0x10b)+_0x34ca90[_0x2cfa6d(0x151)]+_0x2cfa6d(0x18e)+_0x34ca90[_0x2cfa6d(0x10c)]+_0x2cfa6d(0xf9)+_0x34ca90[_0x2cfa6d(0x140)]);const _0x4374d8=_0x34ca90[_0x2cfa6d(0x10c)]+0x1,_0x1cd611=_0x34ca90['type']==='SINGLE'?_0x2cfa6d(0x14d):_0x34ca90[_0x2cfa6d(0x140)];await database_1[_0x2cfa6d(0x1d2)][_0x2cfa6d(0x1a5)][_0x2cfa6d(0x134)]({'where':{'id':_0x34ca90['id']},'data':{'currentPayments':_0x4374d8,'status':_0x1cd611,'updatedAt':new Date()}}),console['log'](_0x2cfa6d(0x15f)+_0x34ca90['id']+_0x2cfa6d(0x104)+_0x34ca90[_0x2cfa6d(0x10c)]+_0x2cfa6d(0x177)+_0x4374d8+_0x2cfa6d(0xf9)+_0x34ca90[_0x2cfa6d(0x140)]+_0x2cfa6d(0x177)+_0x1cd611);}catch(_0x44b2b8){console[_0x2cfa6d(0x132)](_0x2cfa6d(0x12a),_0x44b2b8);}else console[_0x2cfa6d(0x156)](_0x2cfa6d(0x138)+_0x5d77ac['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1['default']['webhookLog'][_0x2cfa6d(0x122)]({'data':{'paymentId':_0x5d77ac['id'],'shopId':_0x5d77ac[_0x2cfa6d(0x13c)],'event':'cointopay_status_check_'+_0x42df3e[_0x2cfa6d(0x140)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x2cfa6d(0x19c)]({'oldStatus':_0x5d77ac[_0x2cfa6d(0x140)],'newStatus':_0x42df3e['status'],'paymentDetails':_0x42df3e[_0x2cfa6d(0x110)],'checkedAt':new Date()[_0x2cfa6d(0x197)]()})}}),await this[_0x2cfa6d(0x19d)](_0x5d77ac,_0x42df3e[_0x2cfa6d(0x140)]),await this[_0x2cfa6d(0xc7)](_0x5d77ac,_0x42df3e[_0x2cfa6d(0x140)]),_0x42df3e[_0x2cfa6d(0x140)]!==_0x2cfa6d(0x1c1)&&(console['log'](_0x2cfa6d(0xca)+_0x5d77ac['id']+'\x20status\x20changed\x20to\x20'+_0x42df3e[_0x2cfa6d(0x140)]+',\x20clearing\x20individual\x20timers'),this[_0x2cfa6d(0xe5)](_0x5d77ac['id'])),console['log']('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x5d77ac['id']+_0x2cfa6d(0x131));}else console[_0x2cfa6d(0x156)](_0x2cfa6d(0x15e)+_0x5d77ac['id']+_0x2cfa6d(0x1b9)+_0x42df3e['status']+')'),this[_0x2cfa6d(0xfa)](_0x5d77ac['id'],_0x5d77ac[_0x2cfa6d(0xd8)],_0x5d77ac[_0x2cfa6d(0x140)],_0x42df3e['status'],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x42df3e[_0x2cfa6d(0x110)],'amount':_0x42df3e[_0x2cfa6d(0x145)],'currency':_0x42df3e[_0x2cfa6d(0x123)],'shopId':_0x5d77ac[_0x2cfa6d(0x13c)],'checkTimestamp':new Date()[_0x2cfa6d(0x197)]()});}catch(_0x476bad){console[_0x2cfa6d(0x132)](_0x2cfa6d(0xd0)+_0x5d77ac['id']+':',_0x476bad),this['logCoinToPayError'](_0x5d77ac['id'],_0x5d77ac[_0x2cfa6d(0xd8)],_0x476bad,'status_check',{'paymentAmount':_0x5d77ac[_0x2cfa6d(0x145)],'paymentCurrency':_0x5d77ac[_0x2cfa6d(0x123)],'shopId':_0x5d77ac[_0x2cfa6d(0x13c)],'createdAt':_0x5d77ac['createdAt']}),await database_1[_0x2cfa6d(0x1d2)][_0x2cfa6d(0xf0)]['create']({'data':{'paymentId':_0x5d77ac['id'],'shopId':_0x5d77ac[_0x2cfa6d(0x13c)],'event':_0x2cfa6d(0x166),'statusCode':0x1f4,'responseBody':JSON[_0x2cfa6d(0x19c)]({'error':_0x476bad instanceof Error?_0x476bad[_0x2cfa6d(0x1c8)]:'Unknown\x20error','gatewayPaymentId':_0x5d77ac['gatewayPaymentId'],'checkedAt':new Date()['toISOString']()})}});}}async[a48_0xd1d2c0(0x19d)](_0x577175,_0x448322){const _0x2f824e=a48_0xd1d2c0,_0x3fd0d7=Date['now']();try{const _0x93feaa=_0x577175[_0x2f824e(0x191)],_0x7dc033=_0x93feaa[_0x2f824e(0x1bd)];if(!_0x7dc033?.[_0x2f824e(0x1c2)]){console[_0x2f824e(0x156)](_0x2f824e(0x16d)+_0x93feaa['id']);return;}const _0x1c05db=_0x448322===_0x2f824e(0x120)?'payment.success':_0x448322===_0x2f824e(0xe2)?_0x2f824e(0x1a4):_0x448322===_0x2f824e(0xef)?_0x2f824e(0x1a4):_0x2f824e(0x196);if(!_0x7dc033[_0x2f824e(0x18d)]?.['includes'](_0x1c05db)){console['log'](_0x2f824e(0x170)+_0x1c05db+'\x20not\x20enabled\x20for\x20shop\x20'+_0x93feaa['id']);return;}const _0x513930=(0x0,gateway_1['getGatewayIdByName'])(_0x577175['gateway'])||_0x577175['gateway'],_0x5b68db={'event':_0x1c05db,'payment':{'id':_0x577175['id'],'order_id':_0x577175[_0x2f824e(0x1b2)],'gateway_order_id':_0x577175['gatewayOrderId'],'gateway':_0x513930,'amount':_0x577175['amount'],'currency':_0x577175[_0x2f824e(0x123)],'status':_0x448322[_0x2f824e(0x176)](),'customer_email':_0x577175[_0x2f824e(0x178)],'customer_name':_0x577175[_0x2f824e(0x1d0)],'created_at':_0x577175[_0x2f824e(0x1ae)],'updated_at':new Date()}},_0x5eea3e=await fetch(_0x7dc033[_0x2f824e(0x1c2)],{'method':_0x2f824e(0x188),'headers':{'Content-Type':_0x2f824e(0xec),'User-Agent':_0x2f824e(0x10d)},'body':JSON[_0x2f824e(0x19c)](_0x5b68db)}),_0x4fa5bd=Date['now']()-_0x3fd0d7,_0x4691ba=_0x5eea3e['ok']?_0x2f824e(0x1c4):await _0x5eea3e[_0x2f824e(0x1c7)]();loggerService_1[_0x2f824e(0x1cc)][_0x2f824e(0x1c3)](_0x577175[_0x2f824e(0x13c)],_0x7dc033[_0x2f824e(0x1c2)],_0x1c05db,_0x5eea3e[_0x2f824e(0x140)],_0x4fa5bd,_0x5b68db),console[_0x2f824e(0x156)](_0x2f824e(0x174)+_0x7dc033['webhookUrl']+_0x2f824e(0x171)+_0x5eea3e[_0x2f824e(0x140)]+'\x20('+_0x4fa5bd+'ms)');}catch(_0xa5b8d4){console[_0x2f824e(0x132)](_0x2f824e(0x14a),_0xa5b8d4),loggerService_1[_0x2f824e(0x1cc)][_0x2f824e(0x1cd)](_0x577175[_0x2f824e(0x13c)],_0x577175[_0x2f824e(0x191)]?.[_0x2f824e(0x1bd)]?.['webhookUrl']||_0x2f824e(0x112),_0x2f824e(0x125),_0xa5b8d4,{});}}async[a48_0xd1d2c0(0xc7)](_0x3b539b,_0x44228b){const _0x288865=a48_0xd1d2c0;try{const _0x3e9085={'PENDING':'created','PAID':_0x288865(0xee),'FAILED':_0x288865(0x158),'EXPIRED':'expired'},_0xeae797=_0x3e9085[_0x44228b];if(!_0xeae797||_0xeae797===_0x288865(0xe6))return;await telegramBotService_1[_0x288865(0x137)]['sendPaymentNotification'](_0x3b539b[_0x288865(0x13c)],_0x3b539b,_0xeae797);}catch(_0x35410f){console[_0x288865(0x132)](_0x288865(0x119),_0x35410f);}}async[a48_0xd1d2c0(0x118)](_0x46388){const _0x3277cd=a48_0xd1d2c0;console[_0x3277cd(0x156)](_0x3277cd(0x15c)+_0x46388);const _0x109a8d=await database_1['default'][_0x3277cd(0x1cf)][_0x3277cd(0xff)]({'where':{'id':_0x46388},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x109a8d)throw new Error(_0x3277cd(0x13a));if(_0x109a8d[_0x3277cd(0x1b7)]!=='cointopay'&&_0x109a8d[_0x3277cd(0x1b7)]!==_0x3277cd(0x17d))throw new Error(_0x3277cd(0x126));console['log'](_0x3277cd(0x192)+_0x109a8d[_0x3277cd(0x1b7)]+_0x3277cd(0x157)+_0x46388),await this[_0x3277cd(0xf8)](_0x109a8d),console['log'](_0x3277cd(0xd5)+_0x46388);}[a48_0xd1d2c0(0x15d)](){const _0x373e36=a48_0xd1d2c0,_0x40a6ca=this['globalCheckInterval']?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x19b12d=Array[_0x373e36(0x1a1)](this[_0x373e36(0x1a6)]['values']())['map'](_0x4a8dcb=>({'paymentId':_0x4a8dcb[_0x373e36(0x199)],'gatewayPaymentId':_0x4a8dcb[_0x373e36(0xd8)],'createdAt':_0x4a8dcb[_0x373e36(0x1ae)],'timersCount':_0x4a8dcb[_0x373e36(0x10f)][_0x373e36(0x1c0)]}));return{'isActive':!!this[_0x373e36(0x141)],'globalCheckIntervalMinutes':this[_0x373e36(0x13f)]/(0x3e8*0x3c),'expiryDays':this[_0x373e36(0xd1)],'activeIndividualTimers':this[_0x373e36(0x1a6)][_0x373e36(0x1af)],'nextGlobalCheckIn':_0x40a6ca,'paymentTimersDetails':_0x19b12d};}[a48_0xd1d2c0(0x180)](_0x15cbf1){const _0x53612d=a48_0xd1d2c0,_0x255916=this[_0x53612d(0x1a6)][_0x53612d(0xcb)](_0x15cbf1);if(_0x255916)return{'hasTimers':!![],'timersCount':_0x255916['timers'][_0x53612d(0x1c0)],'createdAt':_0x255916['createdAt'],'gatewayPaymentId':_0x255916[_0x53612d(0xd8)]};return{'hasTimers':![]};}async[a48_0xd1d2c0(0x135)](_0x204251,_0x41ccd5){const _0x4d7562=a48_0xd1d2c0;try{const _0x3e802c=await database_1['default']['shop'][_0x4d7562(0xff)]({'where':{'id':_0x204251},'select':{'gatewaySettings':!![]}});if(!_0x3e802c?.[_0x4d7562(0x1a8)])return console[_0x4d7562(0x156)](_0x4d7562(0x11d)+_0x204251+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x2ca9e2=JSON[_0x4d7562(0x11b)](_0x3e802c['gatewaySettings']);for(const [_0x23d61e,_0x4fb4e3]of Object[_0x4d7562(0x133)](_0x2ca9e2)){if(_0x23d61e[_0x4d7562(0x176)]()===_0x41ccd5[_0x4d7562(0x176)]()){const _0x568492=_0x4fb4e3['commission']||0xa;return console[_0x4d7562(0x156)](_0x4d7562(0x129)+_0x41ccd5+'\x20commission\x20for\x20shop\x20'+_0x204251+':\x20'+_0x568492+'%'),_0x568492;}}return console[_0x4d7562(0x156)](_0x4d7562(0xde)+_0x41ccd5+_0x4d7562(0x1b4)+_0x204251+',\x20using\x20default\x2010%'),0xa;}catch(_0x4bb65d){return console['error'](_0x4d7562(0x183)+_0x204251+',\x20gateway\x20'+_0x41ccd5+':',_0x4bb65d),0xa;}}}function a48_0x138b(_0x11a0be,_0x390774){_0x11a0be=_0x11a0be-0xc7;const _0x41cb94=a48_0x41cb();let _0x138b17=_0x41cb94[_0x11a0be];return _0x138b17;}function a48_0x41cb(){const _0x5e78c1=['toLowerCase','\x20->\x20','customerEmail','checkPaymentStatus','amountAfterGatewayCommissionUSDT','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','status_check','cointopay2','coinToPay2Service','getTime','getPaymentTimerInfo','‚è∞\x20[GLOBAL]\x20Payment\x20','floor','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20is\x20older\x20than\x20','POST','Payment\x20older\x20than\x20','cointopay','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','checkSinglePaymentById','webhookEvents',',\x20currentPayments=','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20pending\x20CoinToPay\x20payments','shop','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','amountUSDT','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20checked,\x20','payment.pending','toISOString','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','paymentId','confirmedOn','\x20to\x20','stringify','sendShopWebhook','CoinToPayStatusService','not\x20confirmed','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','from','toFixed','startPeriodicStatusCheck','payment.failed','paymentLink','paymentTimers','üõë\x20[SHUTDOWN]\x20Cleared\x20','gatewaySettings','ü™ô\x20[GLOBAL]\x20Found\x20','CoinToPay2Service','not\x20found','description','\x20\x20\x20-\x20ShopId:\x20','createdAt','size','\x20days,\x20marking\x20as\x20EXPIRED','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','orderId','/status/','\x20in\x20shop\x20','\x20\x20\x20‚ùå\x20Error:\x20','6054966XfPkqG','gateway','h),\x20skipping\x20global\x20check','\x20status\x20unchanged\x20(','üí∞\x20[CHECK]\x20Payment\x20',',\x20stopping\x20individual\x20checks','\x20days\x20(created\x20before\x20','settings','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','length','PENDING','webhookUrl','logShopWebhookSent','Success','auto_expire','timestamp','text','message','\x20not\x20found\x20in\x20database','\x20\x20\x20Amount\x20after\x20commission:\x20','defineProperty','loggerService','logShopWebhookError','has','payment','customerName','logCoinToPayError','default','\x20triggered\x20for\x20payment\x20','‚ùå\x20[CHECK]\x20Payment\x20','COINTOPAY_STATUS_CHANGE','\x20expired\x20CoinToPay\x20payments','\x20status\x20is\x20','sendPaymentStatusNotification','Failed\x20to\x20mark\x20payment\x20as\x20expired','checkExpiredPayments','üßπ\x20[CHECK]\x20Payment\x20','get','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','\x20\x20\x20üìÖ\x20Time:\x20','transactionId','\x20found:','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','EXPIRY_DAYS','1\x20minute','\x20\x20\x20üìù\x20Details:','\x20timers\x20for\x20payment\x20','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','\x20\x20\x20üìç\x20Source:\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','gatewayPaymentId','\x20USDT','checkAllPendingPayments','setDate','\x20\x20\x20-\x20GatewayPaymentId:\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','\x20for\x20payment\x20','coinToPayStatusService','FAILED','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','clearPaymentTimers','created','./gateways/coinToPay2Service','\x20(after\x20','\x20days','\x20commission:\x20','paymentLinkId','application/json','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','paid','EXPIRED','webhookLog','‚ùå\x20[HOURLY]\x20Payment\x20','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20is\x20too\x20new\x20(','createdOn','coinToPayService','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','__esModule','checkSinglePayment',',\x20status=','logCoinToPayStatus','4247264dtJGeV','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','findUnique','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','üìä\x20[HOURLY]\x20Payment\x20','schedule_created','\x20updated:\x20currentPayments=','‚è∞\x20[EXPIRY]\x20Payment\x20','now','\x20skipped,\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20initial\x20timers\x20for\x20payment\x20','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check',':\x20type=','currentPayments','Payment\x20System/1.0','delete','timers','paymentDetails','./telegramBotService','unknown','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','.\x20Remaining\x20active\x20timers:\x20','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20individual\x20payment\x20timers','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','checkPaymentById','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','\x20not\x20found,\x20clearing\x20timers','parse','145398JzspIz','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','\x20status\x20from\x20','\x20amounts\x20calculated:','PAID','\x20\x20\x20-\x20Amount:\x20','create','currency','\x20\x20\x20-\x20Gateway:\x20','webhook_send','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20current\x20status:\x20','push','Gateway\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','1069859doJQIG','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','\x20status:\x20','delay','‚è∞\x20[HOURLY]\x20Payment\x20','iban','\x20updated\x20successfully','error','entries','update','getGatewayCommission','schedulePaymentChecks','telegramBotService','üìà\x20[COINTOPAY]\x20Payment\x20','\x20\x20\x20Amount:\x20','Payment\x20not\x20found','COINTOPAY_ERROR','shopId','‚úÖ\x20[EXPIRY]\x20Payment\x20','\x20has\x20no\x20gatewayPaymentId','GLOBAL_CHECK_INTERVAL_MS','status','globalCheckInterval','stopPeriodicStatusCheck','‚úÖ\x20[CHECK]\x20Payment\x20','710634pGUhrP','amount','../types/gateway','‚è∞\x20[GLOBAL]\x20Found\x20','16LPFynO','cointopay_auto_expired','Failed\x20to\x20send\x20shop\x20webhook:','\x20to\x20clear','\x20in\x20','COMPLETED','\x20\x20\x20üìù\x20Context:','../config/database','./currencyService','type','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','paidAt','\x20\x20\x20-\x20paymentId:\x20','\x20\x20\x20-\x20Status:\x20','log','\x20payment\x20','failed','set','1090891FxOGIJ','1510msURNe','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','getServiceStats','üìä\x20[CHECK]\x20Payment\x20','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','1515408LCANiz','remitterIban','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','./loggerService','includes','cointopay_status_check_error','5VMQPfX','\x20(age:\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','5\x20minutes','forEach','bankDetails','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','2nYomSj','catch','Webhook\x20event\x20','\x20with\x20status\x20','-day\x20timeout','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','Shop\x20webhook\x20sent\x20to\x20','stack'];a48_0x41cb=function(){return _0x5e78c1;};return a48_0x41cb();}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a48_0xd1d2c0(0xe1)]=new CoinToPayStatusService();