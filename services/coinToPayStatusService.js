'use strict';const a38_0x49d353=a38_0x3845;function a38_0x3845(_0x479026,_0x55342d){const _0x421697=a38_0x4216();return a38_0x3845=function(_0x3845f0,_0x39eb73){_0x3845f0=_0x3845f0-0x1d7;let _0x46b64e=_0x421697[_0x3845f0];return _0x46b64e;},a38_0x3845(_0x479026,_0x55342d);}(function(_0x2326cd,_0xa28e24){const _0x3e82d8=a38_0x3845,_0x4212e4=_0x2326cd();while(!![]){try{const _0x2a0453=-parseInt(_0x3e82d8(0x2b6))/0x1+parseInt(_0x3e82d8(0x1f0))/0x2+-parseInt(_0x3e82d8(0x2ae))/0x3+-parseInt(_0x3e82d8(0x1ec))/0x4*(parseInt(_0x3e82d8(0x293))/0x5)+parseInt(_0x3e82d8(0x2a2))/0x6*(-parseInt(_0x3e82d8(0x265))/0x7)+-parseInt(_0x3e82d8(0x22b))/0x8*(parseInt(_0x3e82d8(0x2b7))/0x9)+-parseInt(_0x3e82d8(0x2dc))/0xa*(-parseInt(_0x3e82d8(0x218))/0xb);if(_0x2a0453===_0xa28e24)break;else _0x4212e4['push'](_0x4212e4['shift']());}catch(_0x26ef50){_0x4212e4['push'](_0x4212e4['shift']());}}}(a38_0x4216,0xd9f3c));function a38_0x4216(){const _0x3ccdcf=['\x20updated\x20successfully','length','\x20individual\x20payment\x20timers',',\x20using\x20default\x2010%','error','\x20for\x20payment\x20','log',',\x20clearing\x20individual\x20timers','Webhook\x20event\x20','includes','create','30238769afECcZ','payment.success','checkExpiredPayments','push','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','iban','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20is\x20valid\x20for\x20checking,\x20proceeding...','5\x20minutes','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20days\x20without\x20payment\x20confirmation','webhookUrl','‚è∞\x20[GLOBAL]\x20Payment\x20','update','\x20\x20\x20-\x20paymentId:\x20','\x20to\x20clear','Failed\x20to\x20mark\x20payment\x20as\x20expired','floor','\x20\x20\x20-\x20Amount:\x20','21304ZWKxHx','\x20commission:\x20','../types/gateway','not\x20confirmed','FAILED','logCoinToPayStatus','\x20not\x20enabled\x20for\x20shop\x20','timestamp','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','coinToPay2Service','PENDING','forEach','auto_expire','\x20checked,\x20','checkPaymentById','\x20status\x20unchanged\x20(','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','checkPaymentStatus','\x20(age:\x20','\x20current\x20status:\x20','\x20expired\x20CoinToPay\x20payments','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','cointopay','\x20seconds\x20(','\x20status:\x20','getGatewayIdByName','EXPIRY_DAYS','\x20\x20\x20üìä\x20Status:\x20',',\x20status=','ü™ô\x20[DEBUG]\x20Creating\x20','parse','‚úÖ\x20[EXPIRY]\x20Payment\x20','size','description','üßπ\x20[DEBUG]\x20Clearing\x20','payment','\x20triggered\x20for\x20payment\x20','findMany','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','paymentLink','paymentTimers','currencyService','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','globalCheckInterval','getDate','checkSinglePayment','payment.failed','timers','gatewayOrderId','‚ùå\x20[HOURLY]\x20Payment\x20','unknown','createdOn','status','cointopay_status_check_error','values','logShopWebhookSent','\x20\x20\x20-\x20ShopId:\x20','transactionId','959hXyCtH','customerName','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','delete','./gateways/coinToPayService','gatewaySettings','checkSinglePaymentById','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','checkAllPendingPayments','Success','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20\x20\x20üìÖ\x20Time:\x20','paymentId','gateway','shopId','delay','sendPaymentStatusNotification','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20days\x20(created\x20before\x20','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','Bank\x20Details:\x20','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','getPaymentTimerInfo','\x20\x20\x20Gateway\x20','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','convertToUSDT','toLowerCase','\x20not\x20found,\x20clearing\x20timers','PAID','catch',',\x20using\x20default\x20commission\x2010%','Payment\x20not\x20found','\x20\x20\x20‚ùå\x20Error:\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','Automatically\x20expired\x20after\x20','\x20pending\x20CoinToPay\x20payments','\x20details:','\x20amounts\x20calculated:','sendPaymentNotification','getGatewayCommission','set','has','\x20found:','sendShopWebhook','\x20->\x20','1270nXWBSO','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','\x20status\x20is\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','‚úÖ\x20[HOURLY]\x20Payment\x20',',\x20gateway\x20','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','stack','gatewayPaymentId','.\x20Remaining\x20active\x20timers:\x20','status_check','map','\x20skipped,\x20','confirmedOn','paymentDetails','68574tzxgtO','SINGLE','created','COINTOPAY_ERROR','adminNotes','üîç\x20[CHECK]\x20Checking\x20','defineProperty','logCoinToPayError','createdAt','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','\x20not\x20found\x20in\x20database','‚è∞\x20[HOURLY]\x20Payment\x20','532929dZZxdT','bankDetails','amount','GLOBAL_CHECK_INTERVAL_MS',':\x20type=','settings','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20in\x20shop\x20','1480922zTRLrM','4293zaCJRB','__importDefault','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','\x20\x20\x20-\x20Status:\x20','get','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20is\x20older\x20than\x20','\x20timers\x20for\x20payment\x20','Failed\x20to\x20send\x20shop\x20webhook:','TesSoft\x20Payment\x20System/1.0','paymentLinkId','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','webhookLog','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','shop','./currencyService','\x20with\x20status\x20','\x20\x20\x20üìç\x20Source:\x20',',\x20currentPayments=','\x20in\x20','not\x20found','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','getTime','loggerService','currentPayments','customerEmail','CoinToPayStatusService','\x20(after\x20','now','toFixed','failed','\x20USDT','amountUSDT','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','toISOString','20RqviHK','message','üí∞\x20[CHECK]\x20Payment\x20','EXPIRED','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','../config/database','\x20has\x20no\x20gatewayPaymentId','type','schedule_created','POST','üìä\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20\x20\x20-\x20Gateway:\x20','orderId','ms)',',\x20stopping\x20individual\x20checks','amountAfterGatewayCommissionUSDT','\x20is\x20too\x20new\x20(','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','telegramBotService','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','\x20status\x20changed\x20to\x20','\x20\x20\x20üìù\x20Details:','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','__esModule','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','2584zJjvKs','cointopay2','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','COMPLETED','106894DokdGC','\x20commission\x20for\x20shop\x20','Payment\x20older\x20than\x20','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','paid','ü™ô\x20[GLOBAL]\x20Found\x20','\x20days','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','schedulePaymentChecks','‚è∞\x20[GLOBAL]\x20Found\x20','\x20payment\x20','stringify','findUnique','\x20completed\x20for\x20payment\x20','1\x20minute','currency','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','clearPaymentTimers','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','‚úÖ\x20[CHECK]\x20Payment\x20','from','COINTOPAY_STATUS_CHANGE','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','h),\x20skipping\x20global\x20check','default','üõë\x20[SHUTDOWN]\x20Cleared\x20','\x20initial\x20timers\x20for\x20payment\x20','-day\x20timeout'];a38_0x4216=function(){return _0x3ccdcf;};return a38_0x4216();}var __importDefault=this&&this[a38_0x49d353(0x2b8)]||function(_0x171e98){const _0x4be3d5=a38_0x49d353;return _0x171e98&&_0x171e98[_0x4be3d5(0x1e9)]?_0x171e98:{'default':_0x171e98};};Object[a38_0x49d353(0x2a8)](exports,a38_0x49d353(0x1e9),{'value':!![]}),exports['coinToPayStatusService']=exports[a38_0x49d353(0x2d3)]=void 0x0;const coinToPayService_1=require(a38_0x49d353(0x26a)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a38_0x49d353(0x22d)),database_1=__importDefault(require(a38_0x49d353(0x2e1))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require('./loggerService'),currencyService_1=require(a38_0x49d353(0x2c8));class CoinToPayStatusService{constructor(){const _0x33306d=a38_0x49d353;this[_0x33306d(0x256)]=null,this[_0x33306d(0x2b1)]=0x3c*0x3c*0x3e8,this[_0x33306d(0x245)]=0x5,this['paymentTimers']=new Map(),this['coinToPayService']=new coinToPayService_1['CoinToPayService'](),this['coinToPay2Service']=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x33306d(0x213)]('ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a38_0x49d353(0x1f9)](_0x5f3734,_0x2bb15c){const _0x2d6616=a38_0x49d353;console[_0x2d6616(0x213)](_0x2d6616(0x1eb)),console['log'](_0x2d6616(0x226)+_0x5f3734),console['log']('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x2bb15c),this['clearPaymentTimers'](_0x5f3734);const _0x31571f=[],_0x2713af=new Date(),_0x4b2a2f=[{'delay':0x1*0x3c*0x3e8,'description':_0x2d6616(0x1ff)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x2d6616(0x220)}];console['log'](_0x2d6616(0x248)+_0x4b2a2f[_0x2d6616(0x20e)]+_0x2d6616(0x20b)+_0x5f3734);let _0x1c84d0=0x0;_0x4b2a2f[_0x2d6616(0x236)]((_0x2fb095,_0x3d05c6)=>{const _0x2d8282=_0x2d6616;_0x1c84d0+=_0x2fb095[_0x2d8282(0x275)];const _0x21bdf6=setTimeout(async()=>{const _0x1fbb3b=_0x2d8282;console[_0x1fbb3b(0x213)](_0x1fbb3b(0x1e3)+(_0x3d05c6+0x1)+_0x1fbb3b(0x24f)+_0x5f3734+_0x1fbb3b(0x2d4)+_0x2fb095['description']+')');try{await this[_0x1fbb3b(0x26c)](_0x5f3734),console[_0x1fbb3b(0x213)](_0x1fbb3b(0x1f8)+(_0x3d05c6+0x1)+_0x1fbb3b(0x1fe)+_0x5f3734);}catch(_0x34a731){console[_0x1fbb3b(0x211)](_0x1fbb3b(0x255)+(_0x3d05c6+0x1)+_0x1fbb3b(0x212)+_0x5f3734+':',_0x34a731),this[_0x1fbb3b(0x2a9)](_0x5f3734,_0x2bb15c,_0x34a731,_0x1fbb3b(0x29d),{'checkNumber':_0x3d05c6+0x1,'scheduledAfter':_0x2fb095[_0x1fbb3b(0x24c)],'isIndividualCheck':!![]});}},_0x1c84d0);_0x31571f[_0x2d8282(0x21b)](_0x21bdf6),console[_0x2d8282(0x213)](_0x2d8282(0x240)+(_0x3d05c6+0x1)+'\x20for\x20payment\x20'+_0x5f3734+_0x2d8282(0x2cc)+_0x1c84d0/0x3e8+_0x2d8282(0x242)+_0x2fb095[_0x2d8282(0x24c)]+')');});const _0x5a6a5a=setInterval(async()=>{const _0x3c03ff=_0x2d6616;console['log']('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x5f3734);try{const _0x3b5972=await database_1[_0x3c03ff(0x209)][_0x3c03ff(0x24e)]['findUnique']({'where':{'id':_0x5f3734},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x3b5972){console[_0x3c03ff(0x213)](_0x3c03ff(0x25c)+_0x5f3734+_0x3c03ff(0x281)),this[_0x3c03ff(0x202)](_0x5f3734);return;}console[_0x3c03ff(0x213)]('üìä\x20[HOURLY]\x20Payment\x20'+_0x5f3734+_0x3c03ff(0x23e)+_0x3b5972[_0x3c03ff(0x25f)]);if(_0x3b5972['status']!==_0x3c03ff(0x235)){console[_0x3c03ff(0x213)](_0x3c03ff(0x297)+_0x5f3734+'\x20status\x20is\x20'+_0x3b5972[_0x3c03ff(0x25f)]+_0x3c03ff(0x1e0)),this[_0x3c03ff(0x202)](_0x5f3734);return;}const _0x2d3c60=Math[_0x3c03ff(0x229)]((Date[_0x3c03ff(0x2d5)]()-_0x3b5972['createdAt'][_0x3c03ff(0x2cf)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x2d3c60>=this[_0x3c03ff(0x245)]){console['log'](_0x3c03ff(0x2ad)+_0x5f3734+_0x3c03ff(0x2bd)+this[_0x3c03ff(0x245)]+_0x3c03ff(0x2bc)),this['clearPaymentTimers'](_0x5f3734);return;}await this[_0x3c03ff(0x26c)](_0x5f3734),console['log'](_0x3c03ff(0x23b)+_0x5f3734);}catch(_0x210118){console[_0x3c03ff(0x211)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x5f3734+':',_0x210118),this['logCoinToPayError'](_0x5f3734,_0x2bb15c,_0x210118,_0x3c03ff(0x29d),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x31571f[_0x2d6616(0x21b)](_0x5a6a5a),this[_0x2d6616(0x253)][_0x2d6616(0x28e)](_0x5f3734,{'timers':_0x31571f,'paymentId':_0x5f3734,'gatewayPaymentId':_0x2bb15c,'createdAt':_0x2713af}),console[_0x2d6616(0x213)](_0x2d6616(0x294)+_0x4b2a2f[_0x2d6616(0x20e)]+_0x2d6616(0x296)+_0x5f3734),console[_0x2d6616(0x213)](_0x2d6616(0x27e)+this['paymentTimers']['size']),this[_0x2d6616(0x230)](_0x5f3734,_0x2bb15c,_0x2d6616(0x235),_0x2d6616(0x235),_0x2d6616(0x29d),{'action':_0x2d6616(0x1d9),'scheduledChecks':_0x4b2a2f[_0x2d6616(0x20e)],'firstCheckIn':_0x4b2a2f[0x0]['delay']/0x3e8,'totalTimers':this[_0x2d6616(0x253)][_0x2d6616(0x24b)]});}[a38_0x49d353(0x202)](_0x5ae113){const _0x7f37bf=a38_0x49d353,_0x58b2fd=this[_0x7f37bf(0x253)][_0x7f37bf(0x2bb)](_0x5ae113);_0x58b2fd?(console['log'](_0x7f37bf(0x24d)+_0x58b2fd[_0x7f37bf(0x25a)][_0x7f37bf(0x20e)]+_0x7f37bf(0x2be)+_0x5ae113),_0x58b2fd['timers'][_0x7f37bf(0x236)]((_0x2f185a,_0x2e0661)=>{const _0x5d5d0e=_0x7f37bf;_0x2f185a&&(clearTimeout(_0x2f185a),clearInterval(_0x2f185a),console[_0x5d5d0e(0x213)]('üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x2e0661+0x1)+_0x5d5d0e(0x212)+_0x5ae113));}),this[_0x7f37bf(0x253)][_0x7f37bf(0x269)](_0x5ae113),console[_0x7f37bf(0x213)]('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x5ae113+_0x7f37bf(0x29c)+this[_0x7f37bf(0x253)]['size'])):console[_0x7f37bf(0x213)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x5ae113+_0x7f37bf(0x227));}async[a38_0x49d353(0x26c)](_0x8c6acd){const _0x2b815b=a38_0x49d353;console[_0x2b815b(0x213)]('üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x8c6acd);const _0x375c69=await database_1[_0x2b815b(0x209)]['payment'][_0x2b815b(0x1fd)]({'where':{'id':_0x8c6acd},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x375c69){console[_0x2b815b(0x213)]('‚ùå\x20[CHECK]\x20Payment\x20'+_0x8c6acd+_0x2b815b(0x2ac));return;}console[_0x2b815b(0x213)](_0x2b815b(0x1db)+_0x8c6acd+_0x2b815b(0x290)),console['log'](_0x2b815b(0x1dd)+_0x375c69[_0x2b815b(0x273)]),console[_0x2b815b(0x213)](_0x2b815b(0x2ba)+_0x375c69[_0x2b815b(0x25f)]),console[_0x2b815b(0x213)](_0x2b815b(0x1dc)+_0x375c69['gatewayPaymentId']),console['log'](_0x2b815b(0x22a)+_0x375c69[_0x2b815b(0x2b0)]+'\x20'+_0x375c69[_0x2b815b(0x200)]),console['log'](_0x2b815b(0x263)+_0x375c69[_0x2b815b(0x274)]);if(_0x375c69[_0x2b815b(0x273)]!==_0x2b815b(0x241)&&_0x375c69['gateway']!==_0x2b815b(0x1ed)){console['log']('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x8c6acd+_0x2b815b(0x233)+_0x375c69['gateway']+')');return;}if(_0x375c69[_0x2b815b(0x25f)]!==_0x2b815b(0x235)){console[_0x2b815b(0x213)](_0x2b815b(0x251)+_0x8c6acd+_0x2b815b(0x295)+_0x375c69[_0x2b815b(0x25f)]+_0x2b815b(0x1e0)),this['clearPaymentTimers'](_0x8c6acd);return;}if(!_0x375c69[_0x2b815b(0x29b)]){console[_0x2b815b(0x213)](_0x2b815b(0x251)+_0x8c6acd+_0x2b815b(0x1d7));return;}console[_0x2b815b(0x213)](_0x2b815b(0x204)+_0x8c6acd+_0x2b815b(0x21f)),await this[_0x2b815b(0x258)](_0x375c69);}[a38_0x49d353(0x230)](_0x1b2c18,_0x42546f,_0x45f7cb,_0x336378,_0x442937,_0x1a03bc){const _0x1effaf=a38_0x49d353,_0x5ec55e={'type':_0x1effaf(0x206),'paymentId':_0x1b2c18,'gatewayPaymentId':_0x42546f,'oldStatus':_0x45f7cb,'newStatus':_0x336378,'source':_0x442937,'timestamp':new Date()[_0x1effaf(0x2db)](),'details':_0x1a03bc||{}};loggerService_1[_0x1effaf(0x2d0)]['logCoinToPayStatus'](_0x5ec55e),console[_0x1effaf(0x213)](_0x1effaf(0x2b9)+_0x1b2c18+'\x20('+_0x42546f+')'),console['log'](_0x1effaf(0x246)+_0x45f7cb+_0x1effaf(0x292)+_0x336378),console[_0x1effaf(0x213)](_0x1effaf(0x2ca)+_0x442937),console[_0x1effaf(0x213)](_0x1effaf(0x271)+_0x5ec55e[_0x1effaf(0x232)]),_0x1a03bc&&console[_0x1effaf(0x213)](_0x1effaf(0x1e7),_0x1a03bc);}[a38_0x49d353(0x2a9)](_0x3ae966,_0x5cf778,_0x1a86b6,_0xaca792,_0x463924){const _0xee064d=a38_0x49d353,_0x75d27e={'type':_0xee064d(0x2a5),'paymentId':_0x3ae966,'gatewayPaymentId':_0x5cf778,'error':_0x1a86b6 instanceof Error?{'message':_0x1a86b6[_0xee064d(0x2dd)],'stack':_0x1a86b6[_0xee064d(0x29a)]}:_0x1a86b6,'source':_0xaca792,'timestamp':new Date()[_0xee064d(0x2db)](),'context':_0x463924||{}};loggerService_1['loggerService'][_0xee064d(0x2a9)](_0x75d27e),console[_0xee064d(0x211)](_0xee064d(0x268)+_0x3ae966+'\x20('+_0x5cf778+')'),console[_0xee064d(0x211)](_0xee064d(0x286)+(_0x1a86b6 instanceof Error?_0x1a86b6[_0xee064d(0x2dd)]:_0x1a86b6)),console['error']('\x20\x20\x20üìç\x20Source:\x20'+_0xaca792),console['error'](_0xee064d(0x271)+_0x75d27e[_0xee064d(0x232)]),_0x463924&&console[_0xee064d(0x211)]('\x20\x20\x20üìù\x20Context:',_0x463924);}['startPeriodicStatusCheck'](){const _0x35accf=a38_0x49d353;console[_0x35accf(0x213)](_0x35accf(0x21e)),this[_0x35accf(0x26e)]()[_0x35accf(0x283)](_0x325cdd=>{const _0x24bdc8=_0x35accf;console[_0x24bdc8(0x211)]('‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x325cdd);}),this['globalCheckInterval']=setInterval(async()=>{const _0x4d41f2=_0x35accf;try{console['log'](_0x4d41f2(0x2b4)),await this['checkAllPendingPayments'](),console[_0x4d41f2(0x213)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x913442){console[_0x4d41f2(0x211)](_0x4d41f2(0x2c5),_0x913442);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x35accf(0x213)](_0x35accf(0x277));}['stopPeriodicStatusCheck'](){const _0x3562b8=a38_0x49d353;console[_0x3562b8(0x213)](_0x3562b8(0x1ee));this[_0x3562b8(0x256)]&&(clearInterval(this[_0x3562b8(0x256)]),this['globalCheckInterval']=null,console[_0x3562b8(0x213)]('üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x395a4f=this['paymentTimers']['size'];for(const [_0x46581c]of this[_0x3562b8(0x253)]){this[_0x3562b8(0x202)](_0x46581c);}console['log'](_0x3562b8(0x20a)+_0x395a4f+_0x3562b8(0x20f));}async['checkAllPendingPayments'](){const _0x43b3b0=a38_0x49d353;try{console['log']('ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0xc078fc=await database_1[_0x43b3b0(0x209)][_0x43b3b0(0x24e)][_0x43b3b0(0x250)]({'where':{'gateway':{'in':[_0x43b3b0(0x241),_0x43b3b0(0x1ed)]},'status':_0x43b3b0(0x235),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x43b3b0(0x213)](_0x43b3b0(0x1f5)+_0xc078fc[_0x43b3b0(0x20e)]+_0x43b3b0(0x289));if(_0xc078fc['length']===0x0){console['log'](_0x43b3b0(0x221));return;}const _0x5b20c4=await this[_0x43b3b0(0x21a)](_0xc078fc);console[_0x43b3b0(0x213)](_0x43b3b0(0x1fa)+_0x5b20c4[_0x43b3b0(0x20e)]+_0x43b3b0(0x23f));let _0x13bf1=0x0,_0x2a2573=0x0;for(const _0x2bd13d of _0xc078fc){try{if(_0x5b20c4[_0x43b3b0(0x216)](_0x2bd13d['id'])){console['log'](_0x43b3b0(0x224)+_0x2bd13d['id']+_0x43b3b0(0x201)),_0x2a2573++;continue;}if(this[_0x43b3b0(0x253)][_0x43b3b0(0x28f)](_0x2bd13d['id'])){console[_0x43b3b0(0x213)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x2bd13d['id']+_0x43b3b0(0x21c)),_0x2a2573++;continue;}const _0x42fc3c=(Date['now']()-_0x2bd13d[_0x43b3b0(0x2aa)][_0x43b3b0(0x2cf)]())/(0x3e8*0x3c*0x3c);if(_0x42fc3c<0x1){console[_0x43b3b0(0x213)](_0x43b3b0(0x224)+_0x2bd13d['id']+_0x43b3b0(0x1e2)+_0x42fc3c['toFixed'](0x1)+_0x43b3b0(0x208)),_0x2a2573++;continue;}console[_0x43b3b0(0x213)](_0x43b3b0(0x270)+_0x2bd13d['id']+_0x43b3b0(0x23d)+_0x42fc3c[_0x43b3b0(0x2d6)](0x1)+'h)'),await this[_0x43b3b0(0x258)](_0x2bd13d),_0x13bf1++,await new Promise(_0x3c11e1=>setTimeout(_0x3c11e1,0x7d0));}catch(_0xb67689){console['error'](_0x43b3b0(0x1e5)+_0x2bd13d['id']+':',_0xb67689),this['logCoinToPayError'](_0x2bd13d['id'],_0x2bd13d[_0x43b3b0(0x29b)]||'unknown',_0xb67689,_0x43b3b0(0x29d),{'isGlobalCheck':!![],'paymentAmount':_0x2bd13d[_0x43b3b0(0x2b0)],'paymentCurrency':_0x2bd13d[_0x43b3b0(0x200)],'shopId':_0x2bd13d[_0x43b3b0(0x274)],'createdAt':_0x2bd13d[_0x43b3b0(0x2aa)]}),loggerService_1['loggerService']['logWhiteDomainError'](_0x43b3b0(0x241),'/status/'+_0x2bd13d[_0x43b3b0(0x29b)],_0xb67689);}}console['log'](_0x43b3b0(0x2c2)+_0x13bf1+_0x43b3b0(0x238)+_0x2a2573+_0x43b3b0(0x29f)+_0x5b20c4[_0x43b3b0(0x20e)]+'\x20expired');}catch(_0x2fad08){console[_0x43b3b0(0x211)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x2fad08);}}async['checkExpiredPayments'](_0x39b8fc){const _0x23f73e=a38_0x49d353,_0x3ddc19=[],_0xb65d9=new Date();_0xb65d9['setDate'](_0xb65d9[_0x23f73e(0x257)]()-this[_0x23f73e(0x245)]),console[_0x23f73e(0x213)](_0x23f73e(0x1f7)+this[_0x23f73e(0x245)]+_0x23f73e(0x278)+_0xb65d9[_0x23f73e(0x2db)]()+')');for(const _0x29a412 of _0x39b8fc){if(_0x29a412['createdAt']<_0xb65d9){console['log']('‚è∞\x20[EXPIRY]\x20Payment\x20'+_0x29a412['id']+_0x23f73e(0x2bd)+this[_0x23f73e(0x245)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this[_0x23f73e(0x230)](_0x29a412['id'],_0x29a412['gatewayPaymentId']||_0x23f73e(0x25d),_0x23f73e(0x235),'EXPIRED',_0x23f73e(0x237),{'reason':_0x23f73e(0x1f2)+this[_0x23f73e(0x245)]+_0x23f73e(0x1f6),'createdAt':_0x29a412[_0x23f73e(0x2aa)],'daysSinceCreation':Math[_0x23f73e(0x229)]((Date[_0x23f73e(0x2d5)]()-_0x29a412[_0x23f73e(0x2aa)][_0x23f73e(0x2cf)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x29a412['amount'],'paymentCurrency':_0x29a412[_0x23f73e(0x200)],'shopId':_0x29a412[_0x23f73e(0x274)]}),await database_1[_0x23f73e(0x209)][_0x23f73e(0x24e)][_0x23f73e(0x225)]({'where':{'id':_0x29a412['id']},'data':{'status':_0x23f73e(0x2df),'updatedAt':new Date(),'adminNotes':_0x23f73e(0x288)+this[_0x23f73e(0x245)]+_0x23f73e(0x222)}}),await database_1[_0x23f73e(0x209)]['webhookLog'][_0x23f73e(0x217)]({'data':{'paymentId':_0x29a412['id'],'shopId':_0x29a412[_0x23f73e(0x274)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x23f73e(0x1fc)]({'reason':'Payment\x20older\x20than\x20'+this[_0x23f73e(0x245)]+'\x20days','createdAt':_0x29a412[_0x23f73e(0x2aa)],'expiredAt':new Date()[_0x23f73e(0x2db)](),'daysSinceCreation':Math['floor']((Date['now']()-_0x29a412[_0x23f73e(0x2aa)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x23f73e(0x291)](_0x29a412,_0x23f73e(0x2df)),await this[_0x23f73e(0x276)](_0x29a412,_0x23f73e(0x2df)),this[_0x23f73e(0x202)](_0x29a412['id']),_0x3ddc19['push'](_0x29a412['id']),console[_0x23f73e(0x213)](_0x23f73e(0x24a)+_0x29a412['id']+_0x23f73e(0x267)+this[_0x23f73e(0x245)]+_0x23f73e(0x20c));}catch(_0x511fe3){console['error']('‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x29a412['id']+':',_0x511fe3),this[_0x23f73e(0x2a9)](_0x29a412['id'],_0x29a412[_0x23f73e(0x29b)]||_0x23f73e(0x25d),_0x511fe3,'auto_expire',{'reason':_0x23f73e(0x228),'createdAt':_0x29a412[_0x23f73e(0x2aa)],'daysSinceCreation':Math[_0x23f73e(0x229)]((Date[_0x23f73e(0x2d5)]()-_0x29a412[_0x23f73e(0x2aa)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x3ddc19;}async[a38_0x49d353(0x258)](_0x452130){const _0x251249=a38_0x49d353;if(!_0x452130[_0x251249(0x29b)]){console['log'](_0x251249(0x251)+_0x452130['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x251249(0x213)](_0x251249(0x2a7)+_0x452130[_0x251249(0x273)]+_0x251249(0x1fb)+_0x452130['id']+'\x20('+_0x452130[_0x251249(0x29b)]+')');try{let _0x568472;_0x452130[_0x251249(0x273)]==='cointopay2'?(_0x568472=await this[_0x251249(0x234)][_0x251249(0x23c)](_0x452130[_0x251249(0x29b)]),console[_0x251249(0x213)](_0x251249(0x1f3)+_0x452130['id']+_0x251249(0x243)+_0x568472[_0x251249(0x25f)])):(_0x568472=await this['coinToPayService'][_0x251249(0x23c)](_0x452130[_0x251249(0x29b)]),console[_0x251249(0x213)](_0x251249(0x2c6)+_0x452130['id']+_0x251249(0x243)+_0x568472['status']));_0x568472[_0x251249(0x2a1)]&&console[_0x251249(0x213)](_0x251249(0x1db)+_0x452130['id']+_0x251249(0x28a),{'iban':_0x568472[_0x251249(0x2a1)][_0x251249(0x21d)]||_0x251249(0x2cd),'transactionId':_0x568472[_0x251249(0x2a1)][_0x251249(0x264)],'createdOn':_0x568472[_0x251249(0x2a1)][_0x251249(0x25e)],'confirmedOn':_0x568472[_0x251249(0x2a1)][_0x251249(0x2a0)]||_0x251249(0x22e)});if(_0x568472[_0x251249(0x25f)]!==_0x452130[_0x251249(0x25f)]){console[_0x251249(0x213)](_0x251249(0x299)+_0x452130['id']+'\x20status\x20from\x20'+_0x452130[_0x251249(0x25f)]+'\x20to\x20'+_0x568472[_0x251249(0x25f)]),this[_0x251249(0x230)](_0x452130['id'],_0x452130[_0x251249(0x29b)],_0x452130[_0x251249(0x25f)],_0x568472[_0x251249(0x25f)],_0x251249(0x29d),{'paymentDetails':_0x568472[_0x251249(0x2a1)],'amount':_0x568472[_0x251249(0x2b0)],'currency':_0x568472[_0x251249(0x200)],'shopId':_0x452130['shopId'],'checkTimestamp':new Date()[_0x251249(0x2db)]()});const _0x4af242={'status':_0x568472[_0x251249(0x25f)],'updatedAt':new Date()};if(_0x568472['status']===_0x251249(0x282)&&_0x452130[_0x251249(0x25f)]!=='PAID'){_0x4af242['paidAt']=new Date();if(!_0x452130[_0x251249(0x2d9)]){const _0x547804=await currencyService_1[_0x251249(0x254)][_0x251249(0x27f)](_0x452130['amount'],_0x452130[_0x251249(0x200)]);_0x4af242[_0x251249(0x2d9)]=_0x547804;const _0x243770=await this[_0x251249(0x28d)](_0x452130[_0x251249(0x274)],_0x452130[_0x251249(0x273)]),_0x6166a2=_0x547804*(0x1-_0x243770/0x64);_0x4af242[_0x251249(0x1e1)]=_0x6166a2,console[_0x251249(0x213)](_0x251249(0x2de)+_0x452130['id']+_0x251249(0x28b)),console['log']('\x20\x20\x20Amount:\x20'+_0x452130[_0x251249(0x2b0)]+'\x20'+_0x452130['currency']+'\x20->\x20'+_0x547804[_0x251249(0x2d6)](0x6)+_0x251249(0x2d8)),console[_0x251249(0x213)](_0x251249(0x27d)+_0x452130[_0x251249(0x273)]+_0x251249(0x22c)+_0x243770+'%'),console[_0x251249(0x213)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x6166a2[_0x251249(0x2d6)](0x6)+'\x20USDT');}console[_0x251249(0x213)](_0x251249(0x2de)+_0x452130['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x4af242['paidAt'][_0x251249(0x2db)]());}if(_0x568472[_0x251249(0x2a1)]){const _0x34986e=_0x568472[_0x251249(0x2a1)];_0x34986e[_0x251249(0x21d)]&&(_0x4af242['remitterIban']=_0x34986e[_0x251249(0x21d)],console[_0x251249(0x213)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x34986e[_0x251249(0x21d)]));if(_0x34986e[_0x251249(0x2af)]){const _0x54968e=_0x452130[_0x251249(0x2a6)]||'',_0x4ad255=_0x251249(0x27a)+_0x34986e[_0x251249(0x2af)];_0x4af242[_0x251249(0x2a6)]=_0x54968e?_0x54968e+'\x0a\x0a'+_0x4ad255:_0x4ad255,console[_0x251249(0x213)]('üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0x34986e[_0x251249(0x264)]&&console[_0x251249(0x213)](_0x251249(0x279)+_0x34986e['transactionId']),_0x34986e[_0x251249(0x2a0)]&&console[_0x251249(0x213)]('‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x34986e['confirmedOn']);}await database_1['default'][_0x251249(0x24e)][_0x251249(0x225)]({'where':{'id':_0x452130['id']},'data':_0x4af242});if(_0x568472[_0x251249(0x25f)]===_0x251249(0x282)&&_0x452130[_0x251249(0x25f)]!=='PAID'){console['log']('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x452130['id']+_0x251249(0x1ea));const _0x1c0e79=await database_1[_0x251249(0x209)][_0x251249(0x24e)][_0x251249(0x1fd)]({'where':{'id':_0x452130['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x1c0e79?.[_0x251249(0x2c1)]&&_0x1c0e79[_0x251249(0x252)])try{const _0x2b687d=_0x1c0e79[_0x251249(0x252)];console['log']('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x2b687d['id']+_0x251249(0x2b2)+_0x2b687d['type']+_0x251249(0x2cb)+_0x2b687d['currentPayments']+_0x251249(0x247)+_0x2b687d['status']);const _0x403303=_0x2b687d[_0x251249(0x2d1)]+0x1,_0x5f22b4=_0x2b687d[_0x251249(0x1d8)]===_0x251249(0x2a3)?_0x251249(0x1ef):_0x2b687d['status'];await database_1[_0x251249(0x209)][_0x251249(0x252)][_0x251249(0x225)]({'where':{'id':_0x2b687d['id']},'data':{'currentPayments':_0x403303,'status':_0x5f22b4,'updatedAt':new Date()}}),console[_0x251249(0x213)](_0x251249(0x1e8)+_0x2b687d['id']+'\x20updated:\x20currentPayments='+_0x2b687d['currentPayments']+_0x251249(0x292)+_0x403303+_0x251249(0x247)+_0x2b687d[_0x251249(0x25f)]+_0x251249(0x292)+_0x5f22b4);}catch(_0x3a3b6e){console['error'](_0x251249(0x203),_0x3a3b6e);}else console[_0x251249(0x213)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x452130['id']+_0x251249(0x26d));}await database_1[_0x251249(0x209)][_0x251249(0x2c3)]['create']({'data':{'paymentId':_0x452130['id'],'shopId':_0x452130[_0x251249(0x274)],'event':'cointopay_status_check_'+_0x568472[_0x251249(0x25f)][_0x251249(0x280)](),'statusCode':0xc8,'responseBody':JSON[_0x251249(0x1fc)]({'oldStatus':_0x452130['status'],'newStatus':_0x568472[_0x251249(0x25f)],'paymentDetails':_0x568472[_0x251249(0x2a1)],'checkedAt':new Date()[_0x251249(0x2db)]()})}}),await this[_0x251249(0x291)](_0x452130,_0x568472[_0x251249(0x25f)]),await this['sendPaymentStatusNotification'](_0x452130,_0x568472[_0x251249(0x25f)]),_0x568472[_0x251249(0x25f)]!==_0x251249(0x235)&&(console[_0x251249(0x213)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x452130['id']+_0x251249(0x1e6)+_0x568472[_0x251249(0x25f)]+_0x251249(0x214)),this['clearPaymentTimers'](_0x452130['id'])),console[_0x251249(0x213)](_0x251249(0x204)+_0x452130['id']+_0x251249(0x20d));}else console[_0x251249(0x213)](_0x251249(0x1db)+_0x452130['id']+_0x251249(0x23a)+_0x568472[_0x251249(0x25f)]+')'),this[_0x251249(0x230)](_0x452130['id'],_0x452130['gatewayPaymentId'],_0x452130[_0x251249(0x25f)],_0x568472[_0x251249(0x25f)],_0x251249(0x29d),{'statusUnchanged':!![],'paymentDetails':_0x568472[_0x251249(0x2a1)],'amount':_0x568472['amount'],'currency':_0x568472[_0x251249(0x200)],'shopId':_0x452130[_0x251249(0x274)],'checkTimestamp':new Date()[_0x251249(0x2db)]()});}catch(_0x2d653b){console[_0x251249(0x211)](_0x251249(0x2c4)+_0x452130['id']+':',_0x2d653b),this[_0x251249(0x2a9)](_0x452130['id'],_0x452130[_0x251249(0x29b)],_0x2d653b,_0x251249(0x29d),{'paymentAmount':_0x452130[_0x251249(0x2b0)],'paymentCurrency':_0x452130['currency'],'shopId':_0x452130['shopId'],'createdAt':_0x452130[_0x251249(0x2aa)]}),await database_1[_0x251249(0x209)][_0x251249(0x2c3)][_0x251249(0x217)]({'data':{'paymentId':_0x452130['id'],'shopId':_0x452130[_0x251249(0x274)],'event':_0x251249(0x260),'statusCode':0x1f4,'responseBody':JSON[_0x251249(0x1fc)]({'error':_0x2d653b instanceof Error?_0x2d653b[_0x251249(0x2dd)]:'Unknown\x20error','gatewayPaymentId':_0x452130[_0x251249(0x29b)],'checkedAt':new Date()[_0x251249(0x2db)]()})}});}}async[a38_0x49d353(0x291)](_0x4d9f86,_0x52b737){const _0x2165b7=a38_0x49d353,_0x1aca29=Date[_0x2165b7(0x2d5)]();try{const _0x520504=_0x4d9f86[_0x2165b7(0x2c7)],_0x3ca3df=_0x520504[_0x2165b7(0x2b3)];if(!_0x3ca3df?.[_0x2165b7(0x223)]){console['log'](_0x2165b7(0x2e0)+_0x520504['id']);return;}const _0x58958f=_0x52b737===_0x2165b7(0x282)?_0x2165b7(0x219):_0x52b737===_0x2165b7(0x22f)?_0x2165b7(0x259):_0x52b737===_0x2165b7(0x2df)?_0x2165b7(0x259):'payment.pending';if(!_0x3ca3df['webhookEvents']?.[_0x2165b7(0x216)](_0x58958f)){console['log'](_0x2165b7(0x215)+_0x58958f+_0x2165b7(0x231)+_0x520504['id']);return;}const _0x26cb6f=(0x0,gateway_1[_0x2165b7(0x244)])(_0x4d9f86['gateway'])||_0x4d9f86[_0x2165b7(0x273)],_0x3a3e58={'event':_0x58958f,'payment':{'id':_0x4d9f86['id'],'order_id':_0x4d9f86[_0x2165b7(0x1de)],'gateway_order_id':_0x4d9f86[_0x2165b7(0x25b)],'gateway':_0x26cb6f,'amount':_0x4d9f86[_0x2165b7(0x2b0)],'currency':_0x4d9f86[_0x2165b7(0x200)],'status':_0x52b737[_0x2165b7(0x280)](),'customer_email':_0x4d9f86[_0x2165b7(0x2d2)],'customer_name':_0x4d9f86[_0x2165b7(0x266)],'created_at':_0x4d9f86[_0x2165b7(0x2aa)],'updated_at':new Date()}},_0x97c1ef=await fetch(_0x3ca3df[_0x2165b7(0x223)],{'method':_0x2165b7(0x1da),'headers':{'Content-Type':'application/json','User-Agent':_0x2165b7(0x2c0)},'body':JSON[_0x2165b7(0x1fc)](_0x3a3e58)}),_0x50ad30=Date['now']()-_0x1aca29,_0xd273de=_0x97c1ef['ok']?_0x2165b7(0x26f):await _0x97c1ef['text']();loggerService_1[_0x2165b7(0x2d0)][_0x2165b7(0x262)](_0x4d9f86['shopId'],_0x3ca3df[_0x2165b7(0x223)],_0x58958f,_0x97c1ef[_0x2165b7(0x25f)],_0x50ad30,_0x3a3e58),console['log']('Shop\x20webhook\x20sent\x20to\x20'+_0x3ca3df['webhookUrl']+_0x2165b7(0x2c9)+_0x97c1ef[_0x2165b7(0x25f)]+'\x20('+_0x50ad30+_0x2165b7(0x1df));}catch(_0x3b64a9){console['error'](_0x2165b7(0x2bf),_0x3b64a9),loggerService_1[_0x2165b7(0x2d0)]['logShopWebhookError'](_0x4d9f86['shopId'],_0x4d9f86['shop']?.['settings']?.['webhookUrl']||_0x2165b7(0x25d),'webhook_send',_0x3b64a9,{});}}async['sendPaymentStatusNotification'](_0x411df9,_0x5d1c88){const _0x21a473=a38_0x49d353;try{const _0x26f005={'PENDING':'created','PAID':_0x21a473(0x1f4),'FAILED':_0x21a473(0x2d7),'EXPIRED':'expired'},_0x323bbf=_0x26f005[_0x5d1c88];if(!_0x323bbf||_0x323bbf===_0x21a473(0x2a4))return;await telegramBotService_1[_0x21a473(0x1e4)][_0x21a473(0x28c)](_0x411df9[_0x21a473(0x274)],_0x411df9,_0x323bbf);}catch(_0x4636f6){console[_0x21a473(0x211)](_0x21a473(0x287),_0x4636f6);}}async[a38_0x49d353(0x239)](_0x44630c){const _0x5da877=a38_0x49d353;console[_0x5da877(0x213)]('üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x44630c);const _0x22adb3=await database_1[_0x5da877(0x209)][_0x5da877(0x24e)][_0x5da877(0x1fd)]({'where':{'id':_0x44630c},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x22adb3)throw new Error(_0x5da877(0x285));if(_0x22adb3[_0x5da877(0x273)]!=='cointopay'&&_0x22adb3[_0x5da877(0x273)]!==_0x5da877(0x1ed))throw new Error(_0x5da877(0x2da));console[_0x5da877(0x213)](_0x5da877(0x2ce)+_0x22adb3[_0x5da877(0x273)]+_0x5da877(0x1fb)+_0x44630c),await this[_0x5da877(0x258)](_0x22adb3),console[_0x5da877(0x213)](_0x5da877(0x27b)+_0x44630c);}['getServiceStats'](){const _0x24e501=a38_0x49d353,_0x2b37d3=this[_0x24e501(0x256)]?this[_0x24e501(0x2b1)]:undefined,_0x5ab94e=Array[_0x24e501(0x205)](this[_0x24e501(0x253)][_0x24e501(0x261)]())[_0x24e501(0x29e)](_0x264e40=>({'paymentId':_0x264e40[_0x24e501(0x272)],'gatewayPaymentId':_0x264e40['gatewayPaymentId'],'createdAt':_0x264e40['createdAt'],'timersCount':_0x264e40[_0x24e501(0x25a)][_0x24e501(0x20e)]}));return{'isActive':!!this[_0x24e501(0x256)],'globalCheckIntervalMinutes':this[_0x24e501(0x2b1)]/(0x3e8*0x3c),'expiryDays':this[_0x24e501(0x245)],'activeIndividualTimers':this[_0x24e501(0x253)][_0x24e501(0x24b)],'nextGlobalCheckIn':_0x2b37d3,'paymentTimersDetails':_0x5ab94e};}[a38_0x49d353(0x27c)](_0x556dc9){const _0x2d050a=a38_0x49d353,_0x29fd2e=this[_0x2d050a(0x253)][_0x2d050a(0x2bb)](_0x556dc9);if(_0x29fd2e)return{'hasTimers':!![],'timersCount':_0x29fd2e['timers']['length'],'createdAt':_0x29fd2e['createdAt'],'gatewayPaymentId':_0x29fd2e[_0x2d050a(0x29b)]};return{'hasTimers':![]};}async[a38_0x49d353(0x28d)](_0x47ca99,_0xdcf50b){const _0x3688c6=a38_0x49d353;try{const _0x53b8ce=await database_1['default'][_0x3688c6(0x2c7)][_0x3688c6(0x1fd)]({'where':{'id':_0x47ca99},'select':{'gatewaySettings':!![]}});if(!_0x53b8ce?.['gatewaySettings'])return console[_0x3688c6(0x213)](_0x3688c6(0x207)+_0x47ca99+_0x3688c6(0x284)),0xa;const _0x28f38f=JSON[_0x3688c6(0x249)](_0x53b8ce[_0x3688c6(0x26b)]);for(const [_0x201a52,_0x114f4a]of Object['entries'](_0x28f38f)){if(_0x201a52[_0x3688c6(0x280)]()===_0xdcf50b[_0x3688c6(0x280)]()){const _0x47bda3=_0x114f4a['commission']||0xa;return console['log']('Gateway\x20'+_0xdcf50b+_0x3688c6(0x1f1)+_0x47ca99+':\x20'+_0x47bda3+'%'),_0x47bda3;}}return console[_0x3688c6(0x213)](_0x3688c6(0x2ab)+_0xdcf50b+_0x3688c6(0x2b5)+_0x47ca99+_0x3688c6(0x210)),0xa;}catch(_0x4e589c){return console[_0x3688c6(0x211)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x47ca99+_0x3688c6(0x298)+_0xdcf50b+':',_0x4e589c),0xa;}}}exports[a38_0x49d353(0x2d3)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();