'use strict';const a42_0x2d7a59=a42_0x1580;function a42_0x4ab3(){const _0x5b0b90=['48395EmjTTT','‚è∞\x20[GLOBAL]\x20Found\x20','settings','findUnique','5\x20minutes','map',',\x20clearing\x20individual\x20timers','delay','stopPeriodicStatusCheck','log','getGatewayIdByName','has','bankDetails','logShopWebhookSent','EXPIRED','size','create','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','üõë\x20[SHUTDOWN]\x20Cleared\x20','Bank\x20Details:\x20','stack','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','ü™ô\x20[GLOBAL]\x20Found\x20','COINTOPAY_ERROR','\x20updated:\x20currentPayments=','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','‚è∞\x20[EXPIRY]\x20Payment\x20','getPaymentTimerInfo','üìä\x20[HOURLY]\x20Payment\x20','checkPaymentById','\x20updated\x20successfully','paymentLinkId','startPeriodicStatusCheck','PAID','amountAfterGatewayCommissionUSDT','loggerService','setDate','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','floor','paymentTimers','getTime','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','üßπ\x20[CHECK]\x20Payment\x20','\x20current\x20status:\x20','application/json','\x20expired','cointopay_status_check_error',':\x20type=','../config/database','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','\x20days\x20(created\x20before\x20','sendPaymentStatusNotification','customerName','\x20marked\x20as\x20paid\x20at:\x20','length','paidAt','75846ogQmKb','payment.failed','üìä\x20[CHECK]\x20Payment\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','createdAt','18663gLSWRb','\x20days,\x20marking\x20as\x20EXPIRED','auto_expire','\x20\x20\x20üìÖ\x20Time:\x20','../types/gateway','Gateway\x20','not\x20confirmed','\x20\x20\x20-\x20paymentId:\x20','11173088PHkTvF','Failed\x20to\x20send\x20shop\x20webhook:','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','checkPaymentStatus','ü™ô\x20[DEBUG]\x20Creating\x20','gateway','payment.success','Payment\x20not\x20found','checkSinglePayment','status_check','\x20days','üîç\x20[CHECK]\x20Checking\x20','paymentLink','\x20not\x20enabled\x20for\x20shop\x20','POST','transactionId','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','checkExpiredPayments','‚ùå\x20[CHECK]\x20Payment\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','toFixed',',\x20status=','logShopWebhookError','update','\x20\x20\x20üìù\x20Details:','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','./telegramBotService','\x20completed\x20for\x20payment\x20','now','parse','remitterIban','cointopay_auto_expired','sendShopWebhook','404MiYpAC','./currencyService','Payment\x20System/1.0','Automatically\x20expired\x20after\x20','\x20checked,\x20','checkSinglePaymentById','type','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','cointopay_status_check_','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','schedule_created','not\x20found','14640426wHhClS',',\x20currentPayments=','\x20status\x20changed\x20to\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','set','getDate','./gateways/coinToPayService','‚úÖ\x20[EXPIRY]\x20Payment\x20','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','CoinToPay2Service','shopId','telegramBotService','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','expired','findMany','Webhook\x20event\x20','98ZNPDtm','33743940oahafw','gatewayPaymentId','coinToPayStatusService','\x20\x20\x20-\x20Amount:\x20','getServiceStats','globalCheckInterval','toLowerCase','\x20status:\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','ms)','forEach','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','confirmedOn','\x20(age:\x20','gatewayCommissionRate','SINGLE','\x20->\x20','paid','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20\x20\x20‚ùå\x20Error:\x20','\x20commission\x20for\x20shop\x20','stringify','üí∞\x20[CHECK]\x20Payment\x20','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20not\x20found,\x20clearing\x20timers','\x20to\x20clear','adminNotes','logCoinToPayError','\x20\x20\x20-\x20ShopId:\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...',',\x20gateway\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','orderId','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','Shop\x20webhook\x20sent\x20to\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','push','\x20commission:\x20','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','webhookLog','clearPaymentTimers','__esModule',',\x20stopping\x20individual\x20checks','iban','customerEmail','252NOAxVM','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','webhookUrl','\x20skipped,\x20','paymentDetails','\x20status\x20from\x20','currentPayments','CoinToPayStatusService','failed','timers','\x20amounts\x20calculated:','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','logCoinToPayStatus','getGatewayCommission','‚úÖ\x20[CHECK]\x20Payment\x20','cointopay','\x20USDT','\x20seconds\x20(','coinToPayService','values','text','\x20status\x20is\x20','message','cointopay2','CoinToPayService','from','gatewaySettings','get','shop','\x20for\x20payment\x20','\x20in\x20','unknown','checkAllPendingPayments','\x20is\x20too\x20new\x20(','\x20is\x20older\x20than\x20','\x20days\x20without\x20payment\x20confirmation','PENDING','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','defineProperty','.\x20Remaining\x20active\x20timers:\x20','\x20initial\x20timers\x20for\x20payment\x20','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','default','-day\x20timeout','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','toISOString','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20\x20\x20Gateway\x20','üìà\x20[COINTOPAY]\x20Payment\x20','timestamp','payment','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','üßπ\x20[DEBUG]\x20Clearing\x20','amount','‚úÖ\x20[HOURLY]\x20Payment\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','status','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','Success','\x20found:','Payment\x20older\x20than\x20','delete','\x20triggered\x20for\x20payment\x20','webhookEvents','amountUSDT','coinToPay2Service','\x20to\x20','created','\x20individual\x20payment\x20timers','\x20payment\x20','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','commission','GLOBAL_CHECK_INTERVAL_MS','createdOn','currency','logWhiteDomainError','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','./loggerService','585228fJebBb','EXPIRY_DAYS','error','\x20\x20\x20-\x20Status:\x20'];a42_0x4ab3=function(){return _0x5b0b90;};return a42_0x4ab3();}(function(_0x35ca2f,_0x21cdd6){const _0x1cf7c6=a42_0x1580,_0x35481b=_0x35ca2f();while(!![]){try{const _0x2b2324=parseInt(_0x1cf7c6(0x16d))/0x1*(parseInt(_0x1cf7c6(0x1b2))/0x2)+-parseInt(_0x1cf7c6(0x125))/0x3+-parseInt(_0x1cf7c6(0x196))/0x4*(-parseInt(_0x1cf7c6(0x129))/0x5)+parseInt(_0x1cf7c6(0x166))/0x6*(-parseInt(_0x1cf7c6(0xd2))/0x7)+parseInt(_0x1cf7c6(0x175))/0x8+parseInt(_0x1cf7c6(0x1a2))/0x9+-parseInt(_0x1cf7c6(0x1b3))/0xa;if(_0x2b2324===_0x21cdd6)break;else _0x35481b['push'](_0x35481b['shift']());}catch(_0x31de30){_0x35481b['push'](_0x35481b['shift']());}}}(a42_0x4ab3,0xd97f6));var __importDefault=this&&this['__importDefault']||function(_0x56ad2e){return _0x56ad2e&&_0x56ad2e['__esModule']?_0x56ad2e:{'default':_0x56ad2e};};Object[a42_0x2d7a59(0xfa)](exports,a42_0x2d7a59(0xce),{'value':!![]}),exports[a42_0x2d7a59(0x1b5)]=exports[a42_0x2d7a59(0xd9)]=void 0x0;const coinToPayService_1=require(a42_0x2d7a59(0x1a8)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a42_0x2d7a59(0x171)),database_1=__importDefault(require(a42_0x2d7a59(0x15d))),telegramBotService_1=require(a42_0x2d7a59(0x18f)),loggerService_1=require(a42_0x2d7a59(0x124)),currencyService_1=require(a42_0x2d7a59(0x197));function a42_0x1580(_0x12b7aa,_0x228637){const _0x4ab356=a42_0x4ab3();return a42_0x1580=function(_0x158011,_0x298b2c){_0x158011=_0x158011-0xc4;let _0x4b9d4b=_0x4ab356[_0x158011];return _0x4b9d4b;},a42_0x1580(_0x12b7aa,_0x228637);}class CoinToPayStatusService{constructor(){const _0x514e6d=a42_0x2d7a59;this[_0x514e6d(0x1b8)]=null,this[_0x514e6d(0x11f)]=0x3c*0x3c*0x3e8,this[_0x514e6d(0x126)]=0x5,this[_0x514e6d(0x154)]=new Map(),this[_0x514e6d(0xe6)]=new coinToPayService_1[(_0x514e6d(0xec))](),this[_0x514e6d(0x118)]=new coinToPay2Service_1[(_0x514e6d(0x1ab))](),console['log'](_0x514e6d(0x13a));}['schedulePaymentChecks'](_0x560a97,_0xf1c3c5){const _0x26067b=a42_0x2d7a59;console[_0x26067b(0x132)](_0x26067b(0x1c9)),console[_0x26067b(0x132)](_0x26067b(0x174)+_0x560a97),console[_0x26067b(0x132)](_0x26067b(0x15f)+_0xf1c3c5),this[_0x26067b(0xcd)](_0x560a97);const _0x4d07a7=[],_0x6dd901=new Date(),_0x2c4d19=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x26067b(0x12d)},{'delay':0x5*0x3c*0x3e8,'description':_0x26067b(0x12d)}];console[_0x26067b(0x132)](_0x26067b(0x179)+_0x2c4d19[_0x26067b(0x164)]+_0x26067b(0xfc)+_0x560a97);let _0xd1e559=0x0;_0x2c4d19[_0x26067b(0x1be)]((_0x1f7515,_0x17c4da)=>{const _0x1f4463=_0x26067b;_0xd1e559+=_0x1f7515[_0x1f4463(0x130)];const _0x8e157b=setTimeout(async()=>{const _0x4b85b9=_0x1f4463;console[_0x4b85b9(0x132)](_0x4b85b9(0x123)+(_0x17c4da+0x1)+_0x4b85b9(0x115)+_0x560a97+'\x20(after\x20'+_0x1f7515['description']+')');try{await this[_0x4b85b9(0x19b)](_0x560a97),console[_0x4b85b9(0x132)](_0x4b85b9(0x1ae)+(_0x17c4da+0x1)+_0x4b85b9(0x190)+_0x560a97);}catch(_0xc9c412){console[_0x4b85b9(0x127)](_0x4b85b9(0xd3)+(_0x17c4da+0x1)+_0x4b85b9(0xf1)+_0x560a97+':',_0xc9c412),this[_0x4b85b9(0x1d6)](_0x560a97,_0xf1c3c5,_0xc9c412,'status_check',{'checkNumber':_0x17c4da+0x1,'scheduledAfter':_0x1f7515['description'],'isIndividualCheck':!![]});}},_0xd1e559);_0x4d07a7[_0x1f4463(0xc9)](_0x8e157b),console['log'](_0x1f4463(0x1bf)+(_0x17c4da+0x1)+'\x20for\x20payment\x20'+_0x560a97+_0x1f4463(0xf2)+_0xd1e559/0x3e8+_0x1f4463(0xe5)+_0x1f7515['description']+')');});const _0xf21906=setInterval(async()=>{const _0x59a5af=_0x26067b;console[_0x59a5af(0x132)](_0x59a5af(0x10f)+_0x560a97);try{const _0x3e8759=await database_1['default'][_0x59a5af(0x107)][_0x59a5af(0x12c)]({'where':{'id':_0x560a97},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x3e8759){console[_0x59a5af(0x132)]('‚ùå\x20[HOURLY]\x20Payment\x20'+_0x560a97+_0x59a5af(0x1d3)),this[_0x59a5af(0xcd)](_0x560a97);return;}console[_0x59a5af(0x132)](_0x59a5af(0x145)+_0x560a97+_0x59a5af(0x158)+_0x3e8759[_0x59a5af(0x10d)]);if(_0x3e8759[_0x59a5af(0x10d)]!==_0x59a5af(0xf8)){console[_0x59a5af(0x132)](_0x59a5af(0x10b)+_0x560a97+_0x59a5af(0xe9)+_0x3e8759[_0x59a5af(0x10d)]+',\x20stopping\x20individual\x20checks'),this[_0x59a5af(0xcd)](_0x560a97);return;}const _0x3719ab=Math[_0x59a5af(0x153)]((Date[_0x59a5af(0x191)]()-_0x3e8759[_0x59a5af(0x16c)][_0x59a5af(0x155)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x3719ab>=this[_0x59a5af(0x126)]){console[_0x59a5af(0x132)]('‚è∞\x20[HOURLY]\x20Payment\x20'+_0x560a97+'\x20is\x20older\x20than\x20'+this[_0x59a5af(0x126)]+_0x59a5af(0xfe)),this['clearPaymentTimers'](_0x560a97);return;}await this[_0x59a5af(0x19b)](_0x560a97),console[_0x59a5af(0x132)](_0x59a5af(0x151)+_0x560a97);}catch(_0x5c1466){console[_0x59a5af(0x127)](_0x59a5af(0x14f)+_0x560a97+':',_0x5c1466),this['logCoinToPayError'](_0x560a97,_0xf1c3c5,_0x5c1466,_0x59a5af(0x17e),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x4d07a7['push'](_0xf21906),this[_0x26067b(0x154)][_0x26067b(0x1a6)](_0x560a97,{'timers':_0x4d07a7,'paymentId':_0x560a97,'gatewayPaymentId':_0xf1c3c5,'createdAt':_0x6dd901}),console[_0x26067b(0x132)](_0x26067b(0x1bc)+_0x2c4d19[_0x26067b(0x164)]+_0x26067b(0xc4)+_0x560a97),console[_0x26067b(0x132)](_0x26067b(0x19d)+this[_0x26067b(0x154)][_0x26067b(0x138)]),this[_0x26067b(0xe0)](_0x560a97,_0xf1c3c5,_0x26067b(0xf8),_0x26067b(0xf8),_0x26067b(0x17e),{'action':_0x26067b(0x1a0),'scheduledChecks':_0x2c4d19[_0x26067b(0x164)],'firstCheckIn':_0x2c4d19[0x0]['delay']/0x3e8,'totalTimers':this[_0x26067b(0x154)][_0x26067b(0x138)]});}[a42_0x2d7a59(0xcd)](_0x3124cf){const _0x511e4c=a42_0x2d7a59,_0x100411=this[_0x511e4c(0x154)][_0x511e4c(0xef)](_0x3124cf);_0x100411?(console[_0x511e4c(0x132)](_0x511e4c(0x109)+_0x100411[_0x511e4c(0xdb)]['length']+'\x20timers\x20for\x20payment\x20'+_0x3124cf),_0x100411[_0x511e4c(0xdb)]['forEach']((_0x20d6b4,_0x550d5f)=>{const _0x51a0ba=_0x511e4c;_0x20d6b4&&(clearTimeout(_0x20d6b4),clearInterval(_0x20d6b4),console[_0x51a0ba(0x132)](_0x51a0ba(0x188)+(_0x550d5f+0x1)+_0x51a0ba(0xf1)+_0x3124cf));}),this[_0x511e4c(0x154)][_0x511e4c(0x114)](_0x3124cf),console[_0x511e4c(0x132)](_0x511e4c(0x1c8)+_0x3124cf+_0x511e4c(0xfb)+this[_0x511e4c(0x154)][_0x511e4c(0x138)])):console[_0x511e4c(0x132)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x3124cf+_0x511e4c(0x1d4));}async[a42_0x2d7a59(0x19b)](_0x46ce03){const _0x3621a0=a42_0x2d7a59;console[_0x3621a0(0x132)](_0x3621a0(0x110)+_0x46ce03);const _0x581f92=await database_1[_0x3621a0(0xff)][_0x3621a0(0x107)][_0x3621a0(0x12c)]({'where':{'id':_0x46ce03},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x581f92){console[_0x3621a0(0x132)](_0x3621a0(0x187)+_0x46ce03+'\x20not\x20found\x20in\x20database');return;}console[_0x3621a0(0x132)](_0x3621a0(0x168)+_0x46ce03+_0x3621a0(0x112)),console['log']('\x20\x20\x20-\x20Gateway:\x20'+_0x581f92[_0x3621a0(0x17a)]),console['log'](_0x3621a0(0x128)+_0x581f92[_0x3621a0(0x10d)]),console[_0x3621a0(0x132)](_0x3621a0(0x150)+_0x581f92[_0x3621a0(0x1b4)]),console[_0x3621a0(0x132)](_0x3621a0(0x1b6)+_0x581f92[_0x3621a0(0x10a)]+'\x20'+_0x581f92[_0x3621a0(0x121)]),console['log'](_0x3621a0(0x1d7)+_0x581f92['shopId']);if(_0x581f92[_0x3621a0(0x17a)]!==_0x3621a0(0xe3)&&_0x581f92[_0x3621a0(0x17a)]!==_0x3621a0(0xeb)){console['log'](_0x3621a0(0x152)+_0x46ce03+_0x3621a0(0x177)+_0x581f92['gateway']+')');return;}if(_0x581f92[_0x3621a0(0x10d)]!==_0x3621a0(0xf8)){console[_0x3621a0(0x132)](_0x3621a0(0x152)+_0x46ce03+_0x3621a0(0xe9)+_0x581f92[_0x3621a0(0x10d)]+_0x3621a0(0xcf)),this[_0x3621a0(0xcd)](_0x46ce03);return;}if(!_0x581f92['gatewayPaymentId']){console[_0x3621a0(0x132)](_0x3621a0(0x152)+_0x46ce03+'\x20has\x20no\x20gatewayPaymentId');return;}console[_0x3621a0(0x132)](_0x3621a0(0xe2)+_0x46ce03+_0x3621a0(0x1d8)),await this['checkSinglePayment'](_0x581f92);}[a42_0x2d7a59(0xe0)](_0x46ce2a,_0x5302a7,_0x56c919,_0x7f01c6,_0x3102f9,_0x1140b5){const _0x2e5e35=a42_0x2d7a59,_0x3b4510={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x46ce2a,'gatewayPaymentId':_0x5302a7,'oldStatus':_0x56c919,'newStatus':_0x7f01c6,'source':_0x3102f9,'timestamp':new Date()[_0x2e5e35(0x102)](),'details':_0x1140b5||{}};loggerService_1['loggerService'][_0x2e5e35(0xe0)](_0x3b4510),console[_0x2e5e35(0x132)](_0x2e5e35(0x1c1)+_0x46ce2a+'\x20('+_0x5302a7+')'),console[_0x2e5e35(0x132)]('\x20\x20\x20üìä\x20Status:\x20'+_0x56c919+_0x2e5e35(0x1c6)+_0x7f01c6),console['log']('\x20\x20\x20üìç\x20Source:\x20'+_0x3102f9),console[_0x2e5e35(0x132)](_0x2e5e35(0x170)+_0x3b4510[_0x2e5e35(0x106)]),_0x1140b5&&console['log'](_0x2e5e35(0x18d),_0x1140b5);}[a42_0x2d7a59(0x1d6)](_0xf1586b,_0x6c3b9a,_0x18f5ab,_0x3faab4,_0x1fc273){const _0xf6a76a=a42_0x2d7a59,_0x336355={'type':_0xf6a76a(0x140),'paymentId':_0xf1586b,'gatewayPaymentId':_0x6c3b9a,'error':_0x18f5ab instanceof Error?{'message':_0x18f5ab['message'],'stack':_0x18f5ab[_0xf6a76a(0x13d)]}:_0x18f5ab,'source':_0x3faab4,'timestamp':new Date()[_0xf6a76a(0x102)](),'context':_0x1fc273||{}};loggerService_1[_0xf6a76a(0x14c)][_0xf6a76a(0x1d6)](_0x336355),console[_0xf6a76a(0x127)](_0xf6a76a(0xfd)+_0xf1586b+'\x20('+_0x6c3b9a+')'),console[_0xf6a76a(0x127)](_0xf6a76a(0x1cc)+(_0x18f5ab instanceof Error?_0x18f5ab[_0xf6a76a(0xea)]:_0x18f5ab)),console[_0xf6a76a(0x127)]('\x20\x20\x20üìç\x20Source:\x20'+_0x3faab4),console[_0xf6a76a(0x127)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x336355['timestamp']),_0x1fc273&&console['error']('\x20\x20\x20üìù\x20Context:',_0x1fc273);}[a42_0x2d7a59(0x149)](){const _0x553a21=a42_0x2d7a59;console[_0x553a21(0x132)](_0x553a21(0x185)),this[_0x553a21(0xf4)]()['catch'](_0x223892=>{const _0x34606d=_0x553a21;console['error'](_0x34606d(0xdf),_0x223892);}),this[_0x553a21(0x1b8)]=setInterval(async()=>{const _0x2a75c2=_0x553a21;try{console[_0x2a75c2(0x132)](_0x2a75c2(0x11d)),await this['checkAllPendingPayments'](),console['log'](_0x2a75c2(0x1a5));}catch(_0x1843b0){console[_0x2a75c2(0x127)]('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x1843b0);}},this[_0x553a21(0x11f)]),console[_0x553a21(0x132)]('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a42_0x2d7a59(0x131)](){const _0x268eab=a42_0x2d7a59;console[_0x268eab(0x132)](_0x268eab(0x101));this[_0x268eab(0x1b8)]&&(clearInterval(this['globalCheckInterval']),this['globalCheckInterval']=null,console['log'](_0x268eab(0x1d2)));const _0x100894=this[_0x268eab(0x154)][_0x268eab(0x138)];for(const [_0x16a4cf]of this[_0x268eab(0x154)]){this[_0x268eab(0xcd)](_0x16a4cf);}console['log'](_0x268eab(0x13b)+_0x100894+_0x268eab(0x11b));}async[a42_0x2d7a59(0xf4)](){const _0x5b54d0=a42_0x2d7a59;try{console[_0x5b54d0(0x132)](_0x5b54d0(0x103));const _0x4a6b49=await database_1['default'][_0x5b54d0(0x107)][_0x5b54d0(0x1b0)]({'where':{'gateway':{'in':[_0x5b54d0(0xe3),_0x5b54d0(0xeb)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x5b54d0(0x132)](_0x5b54d0(0x13f)+_0x4a6b49[_0x5b54d0(0x164)]+'\x20pending\x20CoinToPay\x20payments');if(_0x4a6b49[_0x5b54d0(0x164)]===0x0){console[_0x5b54d0(0x132)]('ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x145f31=await this[_0x5b54d0(0x186)](_0x4a6b49);console[_0x5b54d0(0x132)](_0x5b54d0(0x12a)+_0x145f31[_0x5b54d0(0x164)]+'\x20expired\x20CoinToPay\x20payments');let _0x6efd52=0x0,_0x2387f7=0x0;for(const _0x2871a2 of _0x4a6b49){try{if(_0x145f31['includes'](_0x2871a2['id'])){console[_0x5b54d0(0x132)](_0x5b54d0(0xc8)+_0x2871a2['id']+_0x5b54d0(0x1c0)),_0x2387f7++;continue;}if(this[_0x5b54d0(0x154)][_0x5b54d0(0x134)](_0x2871a2['id'])){console['log'](_0x5b54d0(0xc8)+_0x2871a2['id']+_0x5b54d0(0x142)),_0x2387f7++;continue;}const _0x186013=(Date[_0x5b54d0(0x191)]()-_0x2871a2['createdAt'][_0x5b54d0(0x155)]())/(0x3e8*0x3c*0x3c);if(_0x186013<0x1){console[_0x5b54d0(0x132)](_0x5b54d0(0xc8)+_0x2871a2['id']+_0x5b54d0(0xf5)+_0x186013['toFixed'](0x1)+'h),\x20skipping\x20global\x20check'),_0x2387f7++;continue;}console[_0x5b54d0(0x132)](_0x5b54d0(0x156)+_0x2871a2['id']+_0x5b54d0(0x1c3)+_0x186013['toFixed'](0x1)+'h)'),await this[_0x5b54d0(0x17d)](_0x2871a2),_0x6efd52++,await new Promise(_0x479876=>setTimeout(_0x479876,0x7d0));}catch(_0x26c505){console[_0x5b54d0(0x127)](_0x5b54d0(0x169)+_0x2871a2['id']+':',_0x26c505),this['logCoinToPayError'](_0x2871a2['id'],_0x2871a2[_0x5b54d0(0x1b4)]||_0x5b54d0(0xf3),_0x26c505,_0x5b54d0(0x17e),{'isGlobalCheck':!![],'paymentAmount':_0x2871a2['amount'],'paymentCurrency':_0x2871a2[_0x5b54d0(0x121)],'shopId':_0x2871a2['shopId'],'createdAt':_0x2871a2[_0x5b54d0(0x16c)]}),loggerService_1['loggerService'][_0x5b54d0(0x122)](_0x5b54d0(0xe3),'/status/'+_0x2871a2[_0x5b54d0(0x1b4)],_0x26c505);}}console[_0x5b54d0(0x132)](_0x5b54d0(0x1bb)+_0x6efd52+_0x5b54d0(0x19a)+_0x2387f7+_0x5b54d0(0xd5)+_0x145f31[_0x5b54d0(0x164)]+_0x5b54d0(0x15a));}catch(_0x493a2d){console[_0x5b54d0(0x127)](_0x5b54d0(0x18e),_0x493a2d);}}async['checkExpiredPayments'](_0x4267a8){const _0x23456d=a42_0x2d7a59,_0x47b511=[],_0x182c86=new Date();_0x182c86[_0x23456d(0x14d)](_0x182c86[_0x23456d(0x1a7)]()-this['EXPIRY_DAYS']),console['log']('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x23456d(0x126)]+_0x23456d(0x160)+_0x182c86[_0x23456d(0x102)]()+')');for(const _0x486882 of _0x4267a8){if(_0x486882[_0x23456d(0x16c)]<_0x182c86){console[_0x23456d(0x132)](_0x23456d(0x143)+_0x486882['id']+_0x23456d(0xf6)+this[_0x23456d(0x126)]+_0x23456d(0x16e));try{this[_0x23456d(0xe0)](_0x486882['id'],_0x486882['gatewayPaymentId']||'unknown',_0x23456d(0xf8),_0x23456d(0x137),_0x23456d(0x16f),{'reason':_0x23456d(0x113)+this[_0x23456d(0x126)]+_0x23456d(0x17f),'createdAt':_0x486882[_0x23456d(0x16c)],'daysSinceCreation':Math['floor']((Date['now']()-_0x486882[_0x23456d(0x16c)][_0x23456d(0x155)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x486882[_0x23456d(0x10a)],'paymentCurrency':_0x486882[_0x23456d(0x121)],'shopId':_0x486882[_0x23456d(0x1ac)]}),await database_1[_0x23456d(0xff)][_0x23456d(0x107)][_0x23456d(0x18c)]({'where':{'id':_0x486882['id']},'data':{'status':_0x23456d(0x137),'updatedAt':new Date(),'adminNotes':_0x23456d(0x199)+this['EXPIRY_DAYS']+_0x23456d(0xf7)}}),await database_1[_0x23456d(0xff)]['webhookLog'][_0x23456d(0x139)]({'data':{'paymentId':_0x486882['id'],'shopId':_0x486882[_0x23456d(0x1ac)],'event':_0x23456d(0x194),'statusCode':0xc8,'responseBody':JSON[_0x23456d(0x1ce)]({'reason':_0x23456d(0x113)+this['EXPIRY_DAYS']+_0x23456d(0x17f),'createdAt':_0x486882[_0x23456d(0x16c)],'expiredAt':new Date()[_0x23456d(0x102)](),'daysSinceCreation':Math['floor']((Date[_0x23456d(0x191)]()-_0x486882['createdAt'][_0x23456d(0x155)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x23456d(0x195)](_0x486882,'EXPIRED'),await this[_0x23456d(0x161)](_0x486882,_0x23456d(0x137)),this['clearPaymentTimers'](_0x486882['id']),_0x47b511[_0x23456d(0xc9)](_0x486882['id']),console[_0x23456d(0x132)](_0x23456d(0x1a9)+_0x486882['id']+_0x23456d(0x10c)+this[_0x23456d(0x126)]+_0x23456d(0x100));}catch(_0x4085c0){console[_0x23456d(0x127)]('‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x486882['id']+':',_0x4085c0),this[_0x23456d(0x1d6)](_0x486882['id'],_0x486882[_0x23456d(0x1b4)]||_0x23456d(0xf3),_0x4085c0,_0x23456d(0x16f),{'reason':_0x23456d(0x1d1),'createdAt':_0x486882[_0x23456d(0x16c)],'daysSinceCreation':Math[_0x23456d(0x153)]((Date['now']()-_0x486882[_0x23456d(0x16c)][_0x23456d(0x155)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x47b511;}async[a42_0x2d7a59(0x17d)](_0x5d2695){const _0xafbcb6=a42_0x2d7a59;if(!_0x5d2695[_0xafbcb6(0x1b4)]){console[_0xafbcb6(0x132)](_0xafbcb6(0x152)+_0x5d2695['id']+_0xafbcb6(0x16a));return;}console[_0xafbcb6(0x132)](_0xafbcb6(0x180)+_0x5d2695['gateway']+_0xafbcb6(0x11c)+_0x5d2695['id']+'\x20('+_0x5d2695[_0xafbcb6(0x1b4)]+')');try{let _0x19ada2;_0x5d2695[_0xafbcb6(0x17a)]===_0xafbcb6(0xeb)?(_0x19ada2=await this['coinToPay2Service'][_0xafbcb6(0x178)](_0x5d2695[_0xafbcb6(0x1b4)]),console['log'](_0xafbcb6(0x10e)+_0x5d2695['id']+_0xafbcb6(0x1ba)+_0x19ada2[_0xafbcb6(0x10d)])):(_0x19ada2=await this[_0xafbcb6(0xe6)][_0xafbcb6(0x178)](_0x5d2695['gatewayPaymentId']),console[_0xafbcb6(0x132)](_0xafbcb6(0x1d0)+_0x5d2695['id']+'\x20status:\x20'+_0x19ada2['status']));_0x19ada2[_0xafbcb6(0xd6)]&&console[_0xafbcb6(0x132)](_0xafbcb6(0x168)+_0x5d2695['id']+'\x20details:',{'iban':_0x19ada2[_0xafbcb6(0xd6)][_0xafbcb6(0xd0)]||_0xafbcb6(0x1a1),'transactionId':_0x19ada2['paymentDetails'][_0xafbcb6(0x184)],'createdOn':_0x19ada2[_0xafbcb6(0xd6)][_0xafbcb6(0x120)],'confirmedOn':_0x19ada2['paymentDetails'][_0xafbcb6(0x1c2)]||_0xafbcb6(0x173)});if(_0x19ada2[_0xafbcb6(0x10d)]!==_0x5d2695[_0xafbcb6(0x10d)]){console[_0xafbcb6(0x132)](_0xafbcb6(0xc6)+_0x5d2695['id']+_0xafbcb6(0xd7)+_0x5d2695[_0xafbcb6(0x10d)]+_0xafbcb6(0x119)+_0x19ada2[_0xafbcb6(0x10d)]),this['logCoinToPayStatus'](_0x5d2695['id'],_0x5d2695[_0xafbcb6(0x1b4)],_0x5d2695[_0xafbcb6(0x10d)],_0x19ada2[_0xafbcb6(0x10d)],_0xafbcb6(0x17e),{'paymentDetails':_0x19ada2[_0xafbcb6(0xd6)],'amount':_0x19ada2[_0xafbcb6(0x10a)],'currency':_0x19ada2[_0xafbcb6(0x121)],'shopId':_0x5d2695['shopId'],'checkTimestamp':new Date()[_0xafbcb6(0x102)]()});const _0x1896f8={'status':_0x19ada2[_0xafbcb6(0x10d)],'updatedAt':new Date()};if(_0x19ada2[_0xafbcb6(0x10d)]==='PAID'&&_0x5d2695[_0xafbcb6(0x10d)]!==_0xafbcb6(0x14a)){_0x1896f8[_0xafbcb6(0x165)]=new Date();if(!_0x5d2695[_0xafbcb6(0x117)]){const _0xc0fa86=await currencyService_1['currencyService']['convertToUSDT'](_0x5d2695['amount'],_0x5d2695[_0xafbcb6(0x121)]);_0x1896f8['amountUSDT']=_0xc0fa86;const _0x47698b=await this[_0xafbcb6(0xe1)](_0x5d2695[_0xafbcb6(0x1ac)],_0x5d2695[_0xafbcb6(0x17a)]),_0x29f3c7=_0xc0fa86*(0x1-_0x47698b/0x64);_0x1896f8[_0xafbcb6(0x14b)]=_0x29f3c7,_0x1896f8[_0xafbcb6(0x1c4)]=_0x47698b,console['log'](_0xafbcb6(0x1cf)+_0x5d2695['id']+_0xafbcb6(0xdc)),console[_0xafbcb6(0x132)]('\x20\x20\x20Amount:\x20'+_0x5d2695[_0xafbcb6(0x10a)]+'\x20'+_0x5d2695[_0xafbcb6(0x121)]+_0xafbcb6(0x1c6)+_0xc0fa86[_0xafbcb6(0x189)](0x6)+_0xafbcb6(0xe4)),console[_0xafbcb6(0x132)](_0xafbcb6(0x104)+_0x5d2695['gateway']+_0xafbcb6(0xca)+_0x47698b+'%'),console['log']('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x29f3c7[_0xafbcb6(0x189)](0x6)+_0xafbcb6(0xe4));}console[_0xafbcb6(0x132)](_0xafbcb6(0x1cf)+_0x5d2695['id']+_0xafbcb6(0x163)+_0x1896f8[_0xafbcb6(0x165)][_0xafbcb6(0x102)]());}if(_0x19ada2[_0xafbcb6(0xd6)]){const _0x2bc499=_0x19ada2[_0xafbcb6(0xd6)];_0x2bc499[_0xafbcb6(0xd0)]&&(_0x1896f8[_0xafbcb6(0x193)]=_0x2bc499['iban'],console[_0xafbcb6(0x132)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x2bc499[_0xafbcb6(0xd0)]));if(_0x2bc499[_0xafbcb6(0x135)]){const _0x2ddd30=_0x5d2695[_0xafbcb6(0x1d5)]||'',_0x370ea4=_0xafbcb6(0x13c)+_0x2bc499[_0xafbcb6(0x135)];_0x1896f8[_0xafbcb6(0x1d5)]=_0x2ddd30?_0x2ddd30+'\x0a\x0a'+_0x370ea4:_0x370ea4,console[_0xafbcb6(0x132)](_0xafbcb6(0x1ca));}_0x2bc499['transactionId']&&console['log'](_0xafbcb6(0x1aa)+_0x2bc499['transactionId']),_0x2bc499[_0xafbcb6(0x1c2)]&&console['log'](_0xafbcb6(0xde)+_0x2bc499['confirmedOn']);}await database_1[_0xafbcb6(0xff)][_0xafbcb6(0x107)][_0xafbcb6(0x18c)]({'where':{'id':_0x5d2695['id']},'data':_0x1896f8});if(_0x19ada2[_0xafbcb6(0x10d)]===_0xafbcb6(0x14a)&&_0x5d2695[_0xafbcb6(0x10d)]!=='PAID'){console[_0xafbcb6(0x132)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x5d2695['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x7ff1ad=await database_1[_0xafbcb6(0xff)][_0xafbcb6(0x107)]['findUnique']({'where':{'id':_0x5d2695['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x7ff1ad?.[_0xafbcb6(0x148)]&&_0x7ff1ad[_0xafbcb6(0x181)])try{const _0x47f99c=_0x7ff1ad['paymentLink'];console[_0xafbcb6(0x132)]('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x47f99c['id']+_0xafbcb6(0x15c)+_0x47f99c[_0xafbcb6(0x19c)]+_0xafbcb6(0x1a3)+_0x47f99c['currentPayments']+_0xafbcb6(0x18a)+_0x47f99c[_0xafbcb6(0x10d)]);const _0x21690c=_0x47f99c[_0xafbcb6(0xd8)]+0x1,_0x3334bd=_0x47f99c[_0xafbcb6(0x19c)]===_0xafbcb6(0x1c5)?'COMPLETED':_0x47f99c[_0xafbcb6(0x10d)];await database_1[_0xafbcb6(0xff)][_0xafbcb6(0x181)]['update']({'where':{'id':_0x47f99c['id']},'data':{'currentPayments':_0x21690c,'status':_0x3334bd,'updatedAt':new Date()}}),console[_0xafbcb6(0x132)]('‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x47f99c['id']+_0xafbcb6(0x141)+_0x47f99c[_0xafbcb6(0xd8)]+_0xafbcb6(0x1c6)+_0x21690c+_0xafbcb6(0x18a)+_0x47f99c[_0xafbcb6(0x10d)]+_0xafbcb6(0x1c6)+_0x3334bd);}catch(_0x35b933){console[_0xafbcb6(0x127)](_0xafbcb6(0x108),_0x35b933);}else console[_0xafbcb6(0x132)](_0xafbcb6(0x105)+_0x5d2695['id']+_0xafbcb6(0x19f));}await database_1[_0xafbcb6(0xff)][_0xafbcb6(0xcc)][_0xafbcb6(0x139)]({'data':{'paymentId':_0x5d2695['id'],'shopId':_0x5d2695[_0xafbcb6(0x1ac)],'event':_0xafbcb6(0x19e)+_0x19ada2[_0xafbcb6(0x10d)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x5d2695[_0xafbcb6(0x10d)],'newStatus':_0x19ada2['status'],'paymentDetails':_0x19ada2['paymentDetails'],'checkedAt':new Date()['toISOString']()})}}),await this['sendShopWebhook'](_0x5d2695,_0x19ada2['status']),await this[_0xafbcb6(0x161)](_0x5d2695,_0x19ada2[_0xafbcb6(0x10d)]),_0x19ada2[_0xafbcb6(0x10d)]!==_0xafbcb6(0xf8)&&(console[_0xafbcb6(0x132)](_0xafbcb6(0x157)+_0x5d2695['id']+_0xafbcb6(0x1a4)+_0x19ada2[_0xafbcb6(0x10d)]+_0xafbcb6(0x12f)),this[_0xafbcb6(0xcd)](_0x5d2695['id'])),console[_0xafbcb6(0x132)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x5d2695['id']+_0xafbcb6(0x147));}else console[_0xafbcb6(0x132)](_0xafbcb6(0x168)+_0x5d2695['id']+'\x20status\x20unchanged\x20('+_0x19ada2[_0xafbcb6(0x10d)]+')'),this[_0xafbcb6(0xe0)](_0x5d2695['id'],_0x5d2695[_0xafbcb6(0x1b4)],_0x5d2695[_0xafbcb6(0x10d)],_0x19ada2[_0xafbcb6(0x10d)],_0xafbcb6(0x17e),{'statusUnchanged':!![],'paymentDetails':_0x19ada2[_0xafbcb6(0xd6)],'amount':_0x19ada2[_0xafbcb6(0x10a)],'currency':_0x19ada2[_0xafbcb6(0x121)],'shopId':_0x5d2695['shopId'],'checkTimestamp':new Date()['toISOString']()});}catch(_0x1c6314){console[_0xafbcb6(0x127)](_0xafbcb6(0xdd)+_0x5d2695['id']+':',_0x1c6314),this[_0xafbcb6(0x1d6)](_0x5d2695['id'],_0x5d2695[_0xafbcb6(0x1b4)],_0x1c6314,_0xafbcb6(0x17e),{'paymentAmount':_0x5d2695[_0xafbcb6(0x10a)],'paymentCurrency':_0x5d2695[_0xafbcb6(0x121)],'shopId':_0x5d2695[_0xafbcb6(0x1ac)],'createdAt':_0x5d2695['createdAt']}),await database_1[_0xafbcb6(0xff)][_0xafbcb6(0xcc)][_0xafbcb6(0x139)]({'data':{'paymentId':_0x5d2695['id'],'shopId':_0x5d2695[_0xafbcb6(0x1ac)],'event':_0xafbcb6(0x15b),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x1c6314 instanceof Error?_0x1c6314[_0xafbcb6(0xea)]:'Unknown\x20error','gatewayPaymentId':_0x5d2695[_0xafbcb6(0x1b4)],'checkedAt':new Date()[_0xafbcb6(0x102)]()})}});}}async[a42_0x2d7a59(0x195)](_0x1aaedf,_0xf85905){const _0x1175d2=a42_0x2d7a59,_0x9aff50=Date[_0x1175d2(0x191)]();try{const _0x2221c3=_0x1aaedf[_0x1175d2(0xf0)],_0x4e6823=_0x2221c3[_0x1175d2(0x12b)];if(!_0x4e6823?.[_0x1175d2(0xd4)]){console['log']('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x2221c3['id']);return;}const _0x484414=_0xf85905===_0x1175d2(0x14a)?_0x1175d2(0x17b):_0xf85905==='FAILED'?'payment.failed':_0xf85905==='EXPIRED'?_0x1175d2(0x167):'payment.pending';if(!_0x4e6823[_0x1175d2(0x116)]?.['includes'](_0x484414)){console[_0x1175d2(0x132)](_0x1175d2(0x1b1)+_0x484414+_0x1175d2(0x182)+_0x2221c3['id']);return;}const _0x92aaff=(0x0,gateway_1[_0x1175d2(0x133)])(_0x1aaedf[_0x1175d2(0x17a)])||_0x1aaedf[_0x1175d2(0x17a)],_0x5c632b={'event':_0x484414,'payment':{'id':_0x1aaedf['id'],'order_id':_0x1aaedf[_0x1175d2(0xc5)],'gateway_order_id':_0x1aaedf['gatewayOrderId'],'gateway':_0x92aaff,'amount':_0x1aaedf[_0x1175d2(0x10a)],'currency':_0x1aaedf[_0x1175d2(0x121)],'status':_0xf85905[_0x1175d2(0x1b9)](),'customer_email':_0x1aaedf[_0x1175d2(0xd1)],'customer_name':_0x1aaedf[_0x1175d2(0x162)],'created_at':_0x1aaedf[_0x1175d2(0x16c)],'updated_at':new Date()}},_0x380b1c=await fetch(_0x4e6823[_0x1175d2(0xd4)],{'method':_0x1175d2(0x183),'headers':{'Content-Type':_0x1175d2(0x159),'User-Agent':_0x1175d2(0x198)},'body':JSON[_0x1175d2(0x1ce)](_0x5c632b)}),_0x17dc4f=Date['now']()-_0x9aff50,_0x4501b7=_0x380b1c['ok']?_0x1175d2(0x111):await _0x380b1c[_0x1175d2(0xe8)]();loggerService_1[_0x1175d2(0x14c)][_0x1175d2(0x136)](_0x1aaedf[_0x1175d2(0x1ac)],_0x4e6823['webhookUrl'],_0x484414,_0x380b1c[_0x1175d2(0x10d)],_0x17dc4f,_0x5c632b),console['log'](_0x1175d2(0xc7)+_0x4e6823[_0x1175d2(0xd4)]+'\x20with\x20status\x20'+_0x380b1c[_0x1175d2(0x10d)]+'\x20('+_0x17dc4f+_0x1175d2(0x1bd));}catch(_0x3c53ed){console['error'](_0x1175d2(0x176),_0x3c53ed),loggerService_1[_0x1175d2(0x14c)][_0x1175d2(0x18b)](_0x1aaedf[_0x1175d2(0x1ac)],_0x1aaedf[_0x1175d2(0xf0)]?.[_0x1175d2(0x12b)]?.[_0x1175d2(0xd4)]||'unknown','webhook_send',_0x3c53ed,{});}}async['sendPaymentStatusNotification'](_0x3cb99e,_0x58af0d){const _0x16c0df=a42_0x2d7a59;try{const _0x5396ad={'PENDING':_0x16c0df(0x11a),'PAID':_0x16c0df(0x1c7),'FAILED':_0x16c0df(0xda),'EXPIRED':_0x16c0df(0x1af)},_0x23832f=_0x5396ad[_0x58af0d];if(!_0x23832f||_0x23832f===_0x16c0df(0x11a))return;await telegramBotService_1[_0x16c0df(0x1ad)]['sendPaymentNotification'](_0x3cb99e[_0x16c0df(0x1ac)],_0x3cb99e,_0x23832f);}catch(_0x470ea4){console[_0x16c0df(0x127)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x470ea4);}}async[a42_0x2d7a59(0x146)](_0x31e23c){const _0x1997b2=a42_0x2d7a59;console['log'](_0x1997b2(0x1cb)+_0x31e23c);const _0x583580=await database_1[_0x1997b2(0xff)][_0x1997b2(0x107)][_0x1997b2(0x12c)]({'where':{'id':_0x31e23c},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x583580)throw new Error(_0x1997b2(0x17c));if(_0x583580[_0x1997b2(0x17a)]!==_0x1997b2(0xe3)&&_0x583580[_0x1997b2(0x17a)]!==_0x1997b2(0xeb))throw new Error(_0x1997b2(0x14e));console[_0x1997b2(0x132)](_0x1997b2(0xcb)+_0x583580[_0x1997b2(0x17a)]+_0x1997b2(0x11c)+_0x31e23c),await this[_0x1997b2(0x17d)](_0x583580),console[_0x1997b2(0x132)](_0x1997b2(0x16b)+_0x31e23c);}[a42_0x2d7a59(0x1b7)](){const _0x59cfb5=a42_0x2d7a59,_0x3f3bfe=this[_0x59cfb5(0x1b8)]?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x1a1f40=Array[_0x59cfb5(0xed)](this[_0x59cfb5(0x154)][_0x59cfb5(0xe7)]())[_0x59cfb5(0x12e)](_0x42025d=>({'paymentId':_0x42025d['paymentId'],'gatewayPaymentId':_0x42025d[_0x59cfb5(0x1b4)],'createdAt':_0x42025d[_0x59cfb5(0x16c)],'timersCount':_0x42025d[_0x59cfb5(0xdb)]['length']}));return{'isActive':!!this[_0x59cfb5(0x1b8)],'globalCheckIntervalMinutes':this[_0x59cfb5(0x11f)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x59cfb5(0x154)][_0x59cfb5(0x138)],'nextGlobalCheckIn':_0x3f3bfe,'paymentTimersDetails':_0x1a1f40};}[a42_0x2d7a59(0x144)](_0x4529aa){const _0x339735=a42_0x2d7a59,_0x55869a=this['paymentTimers'][_0x339735(0xef)](_0x4529aa);if(_0x55869a)return{'hasTimers':!![],'timersCount':_0x55869a[_0x339735(0xdb)]['length'],'createdAt':_0x55869a[_0x339735(0x16c)],'gatewayPaymentId':_0x55869a[_0x339735(0x1b4)]};return{'hasTimers':![]};}async[a42_0x2d7a59(0xe1)](_0x2a213b,_0x4c35e3){const _0x64c592=a42_0x2d7a59;try{const _0x52dd46=await database_1[_0x64c592(0xff)][_0x64c592(0xf0)]['findUnique']({'where':{'id':_0x2a213b},'select':{'gatewaySettings':!![]}});if(!_0x52dd46?.[_0x64c592(0xee)])return console[_0x64c592(0x132)](_0x64c592(0x15e)+_0x2a213b+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x47c1c1=JSON[_0x64c592(0x192)](_0x52dd46[_0x64c592(0xee)]);for(const [_0x58e30d,_0x38568e]of Object['entries'](_0x47c1c1)){if(_0x58e30d[_0x64c592(0x1b9)]()===_0x4c35e3[_0x64c592(0x1b9)]()){const _0x363c7c=_0x38568e[_0x64c592(0x11e)]||0xa;return console[_0x64c592(0x132)](_0x64c592(0x172)+_0x4c35e3+_0x64c592(0x1cd)+_0x2a213b+':\x20'+_0x363c7c+'%'),_0x363c7c;}}return console['log'](_0x64c592(0xf9)+_0x4c35e3+'\x20in\x20shop\x20'+_0x2a213b+',\x20using\x20default\x2010%'),0xa;}catch(_0x47bbf1){return console['error'](_0x64c592(0x13e)+_0x2a213b+_0x64c592(0x1d9)+_0x4c35e3+':',_0x47bbf1),0xa;}}}exports[a42_0x2d7a59(0xd9)]=CoinToPayStatusService,exports[a42_0x2d7a59(0x1b5)]=new CoinToPayStatusService();