'use strict';const a38_0x33d316=a38_0x3e01;(function(_0x587a21,_0x2841e3){const _0x14666f=a38_0x3e01,_0x49e89b=_0x587a21();while(!![]){try{const _0x376f97=parseInt(_0x14666f(0x1da))/0x1*(parseInt(_0x14666f(0x1a1))/0x2)+-parseInt(_0x14666f(0x144))/0x3+parseInt(_0x14666f(0x15b))/0x4*(parseInt(_0x14666f(0x1a5))/0x5)+-parseInt(_0x14666f(0x198))/0x6+parseInt(_0x14666f(0x132))/0x7+parseInt(_0x14666f(0x18e))/0x8+-parseInt(_0x14666f(0x126))/0x9;if(_0x376f97===_0x2841e3)break;else _0x49e89b['push'](_0x49e89b['shift']());}catch(_0x27e65d){_0x49e89b['push'](_0x49e89b['shift']());}}}(a38_0x1abc,0x7a778));var __importDefault=this&&this['__importDefault']||function(_0x2920bc){const _0x19fa38=a38_0x3e01;return _0x2920bc&&_0x2920bc[_0x19fa38(0x1ec)]?_0x2920bc:{'default':_0x2920bc};};Object['defineProperty'](exports,a38_0x33d316(0x1ec),{'value':!![]}),exports[a38_0x33d316(0x137)]=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require(a38_0x33d316(0x131)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a38_0x33d316(0x11e)),database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a38_0x33d316(0x169)),loggerService_1=require(a38_0x33d316(0x1b7)),currencyService_1=require(a38_0x33d316(0x120));class CoinToPayStatusService{constructor(){const _0x481de=a38_0x33d316;this['globalCheckInterval']=null,this[_0x481de(0x107)]=0x3c*0x3c*0x3e8,this[_0x481de(0x1a3)]=0x5,this['paymentTimers']=new Map(),this[_0x481de(0x165)]=new coinToPayService_1[(_0x481de(0x11c))](),this['coinToPay2Service']=new coinToPay2Service_1[(_0x481de(0x17d))](),console[_0x481de(0x1c7)](_0x481de(0x1b8));}[a38_0x33d316(0x1a8)](_0x5de30f,_0x9ea2a9){const _0xcc503e=a38_0x33d316;console[_0xcc503e(0x1c7)]('🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0xcc503e(0x1c7)]('\x20\x20\x20-\x20paymentId:\x20'+_0x5de30f),console[_0xcc503e(0x1c7)]('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x9ea2a9),this[_0xcc503e(0x1c2)](_0x5de30f);const _0x594c3e=[],_0x45c9a0=new Date(),_0x216a0c=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0xcc503e(0x106)}];console[_0xcc503e(0x1c7)](_0xcc503e(0x14e)+_0x216a0c[_0xcc503e(0x16a)]+_0xcc503e(0x170)+_0x5de30f);let _0x45a419=0x0;_0x216a0c[_0xcc503e(0x108)]((_0x4b3956,_0x49a1d9)=>{const _0x28eac3=_0xcc503e;_0x45a419+=_0x4b3956[_0x28eac3(0x206)];const _0x42ece4=setTimeout(async()=>{const _0x40fcf4=_0x28eac3;console[_0x40fcf4(0x1c7)](_0x40fcf4(0x15d)+(_0x49a1d9+0x1)+_0x40fcf4(0x1e4)+_0x5de30f+'\x20(after\x20'+_0x4b3956[_0x40fcf4(0x1ff)]+')');try{await this['checkSinglePaymentById'](_0x5de30f),console[_0x40fcf4(0x1c7)](_0x40fcf4(0x15f)+(_0x49a1d9+0x1)+_0x40fcf4(0x127)+_0x5de30f);}catch(_0x513d57){console[_0x40fcf4(0x1f2)](_0x40fcf4(0x141)+(_0x49a1d9+0x1)+'\x20for\x20payment\x20'+_0x5de30f+':',_0x513d57),this[_0x40fcf4(0x197)](_0x5de30f,_0x9ea2a9,_0x513d57,_0x40fcf4(0x1ca),{'checkNumber':_0x49a1d9+0x1,'scheduledAfter':_0x4b3956[_0x40fcf4(0x1ff)],'isIndividualCheck':!![]});}},_0x45a419);_0x594c3e[_0x28eac3(0x12b)](_0x42ece4),console['log']('⏰\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x49a1d9+0x1)+'\x20for\x20payment\x20'+_0x5de30f+'\x20in\x20'+_0x45a419/0x3e8+_0x28eac3(0x128)+_0x4b3956[_0x28eac3(0x1ff)]+')');});const _0x5ed07f=setInterval(async()=>{const _0x486fdb=_0xcc503e;console[_0x486fdb(0x1c7)](_0x486fdb(0x119)+_0x5de30f);try{const _0xbf9d9f=await database_1[_0x486fdb(0x157)][_0x486fdb(0x202)][_0x486fdb(0x193)]({'where':{'id':_0x5de30f},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0xbf9d9f){console[_0x486fdb(0x1c7)]('❌\x20[HOURLY]\x20Payment\x20'+_0x5de30f+_0x486fdb(0x134)),this[_0x486fdb(0x1c2)](_0x5de30f);return;}console['log'](_0x486fdb(0x190)+_0x5de30f+'\x20current\x20status:\x20'+_0xbf9d9f[_0x486fdb(0x1cf)]);if(_0xbf9d9f[_0x486fdb(0x1cf)]!==_0x486fdb(0x1cb)){console[_0x486fdb(0x1c7)](_0x486fdb(0x1e7)+_0x5de30f+_0x486fdb(0x1ce)+_0xbf9d9f[_0x486fdb(0x1cf)]+_0x486fdb(0x1b1)),this[_0x486fdb(0x1c2)](_0x5de30f);return;}const _0x3c685a=Math[_0x486fdb(0x16b)]((Date[_0x486fdb(0x200)]()-_0xbf9d9f[_0x486fdb(0x179)][_0x486fdb(0x1d4)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x3c685a>=this[_0x486fdb(0x1a3)]){console[_0x486fdb(0x1c7)](_0x486fdb(0x183)+_0x5de30f+_0x486fdb(0x14f)+this[_0x486fdb(0x1a3)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x486fdb(0x1c2)](_0x5de30f);return;}await this[_0x486fdb(0x147)](_0x5de30f),console[_0x486fdb(0x1c7)](_0x486fdb(0x113)+_0x5de30f);}catch(_0x50eb1c){console['error'](_0x486fdb(0x1ea)+_0x5de30f+':',_0x50eb1c),this['logCoinToPayError'](_0x5de30f,_0x9ea2a9,_0x50eb1c,_0x486fdb(0x1ca),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x594c3e[_0xcc503e(0x12b)](_0x5ed07f),this[_0xcc503e(0x196)][_0xcc503e(0x149)](_0x5de30f,{'timers':_0x594c3e,'paymentId':_0x5de30f,'gatewayPaymentId':_0x9ea2a9,'createdAt':_0x45c9a0}),console[_0xcc503e(0x1c7)](_0xcc503e(0x1f8)+_0x216a0c[_0xcc503e(0x16a)]+_0xcc503e(0x1e9)+_0x5de30f),console[_0xcc503e(0x1c7)](_0xcc503e(0x175)+this[_0xcc503e(0x196)][_0xcc503e(0x166)]),this['logCoinToPayStatus'](_0x5de30f,_0x9ea2a9,'PENDING',_0xcc503e(0x1cb),_0xcc503e(0x1ca),{'action':_0xcc503e(0x1bc),'scheduledChecks':_0x216a0c[_0xcc503e(0x16a)],'firstCheckIn':_0x216a0c[0x0]['delay']/0x3e8,'totalTimers':this['paymentTimers'][_0xcc503e(0x166)]});}['clearPaymentTimers'](_0x13e78f){const _0x1a1276=a38_0x33d316,_0x2358a7=this[_0x1a1276(0x196)]['get'](_0x13e78f);_0x2358a7?(console[_0x1a1276(0x1c7)](_0x1a1276(0x1c6)+_0x2358a7[_0x1a1276(0x187)][_0x1a1276(0x16a)]+_0x1a1276(0x1ae)+_0x13e78f),_0x2358a7[_0x1a1276(0x187)]['forEach']((_0x8c1fb0,_0x42b664)=>{const _0x3efd54=_0x1a1276;_0x8c1fb0&&(clearTimeout(_0x8c1fb0),clearInterval(_0x8c1fb0),console['log'](_0x3efd54(0x1ee)+(_0x42b664+0x1)+'\x20for\x20payment\x20'+_0x13e78f));}),this[_0x1a1276(0x196)][_0x1a1276(0x1fe)](_0x13e78f),console['log'](_0x1a1276(0x135)+_0x13e78f+'.\x20Remaining\x20active\x20timers:\x20'+this[_0x1a1276(0x196)][_0x1a1276(0x166)])):console[_0x1a1276(0x1c7)]('⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x13e78f+_0x1a1276(0x1b6));}async[a38_0x33d316(0x147)](_0x4e0d70){const _0x112972=a38_0x33d316;console['log'](_0x112972(0x16f)+_0x4e0d70);const _0x9bcbc2=await database_1['default'][_0x112972(0x202)][_0x112972(0x193)]({'where':{'id':_0x4e0d70},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x9bcbc2){console[_0x112972(0x1c7)](_0x112972(0x1d1)+_0x4e0d70+_0x112972(0x177));return;}console['log']('📊\x20[CHECK]\x20Payment\x20'+_0x4e0d70+_0x112972(0x117)),console[_0x112972(0x1c7)](_0x112972(0x1a6)+_0x9bcbc2[_0x112972(0x1d2)]),console[_0x112972(0x1c7)](_0x112972(0x192)+_0x9bcbc2[_0x112972(0x1cf)]),console[_0x112972(0x1c7)](_0x112972(0x1eb)+_0x9bcbc2[_0x112972(0x1b2)]),console[_0x112972(0x1c7)](_0x112972(0x1b5)+_0x9bcbc2['amount']+'\x20'+_0x9bcbc2[_0x112972(0x13d)]),console[_0x112972(0x1c7)](_0x112972(0x1fd)+_0x9bcbc2['shopId']);if(_0x9bcbc2[_0x112972(0x1d2)]!=='cointopay'&&_0x9bcbc2[_0x112972(0x1d2)]!==_0x112972(0x167)){console['log'](_0x112972(0x112)+_0x4e0d70+_0x112972(0x1b3)+_0x9bcbc2[_0x112972(0x1d2)]+')');return;}if(_0x9bcbc2[_0x112972(0x1cf)]!==_0x112972(0x1cb)){console['log'](_0x112972(0x112)+_0x4e0d70+_0x112972(0x1ce)+_0x9bcbc2[_0x112972(0x1cf)]+_0x112972(0x1b1)),this[_0x112972(0x1c2)](_0x4e0d70);return;}if(!_0x9bcbc2[_0x112972(0x1b2)]){console[_0x112972(0x1c7)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x4e0d70+'\x20has\x20no\x20gatewayPaymentId');return;}console[_0x112972(0x1c7)](_0x112972(0x18d)+_0x4e0d70+_0x112972(0x185)),await this[_0x112972(0x1d0)](_0x9bcbc2);}[a38_0x33d316(0x13f)](_0x3bc3af,_0x3f642,_0x5d67b9,_0x304434,_0xe81a05,_0x55f229){const _0x25e82b=a38_0x33d316,_0x35d11b={'type':_0x25e82b(0x1f4),'paymentId':_0x3bc3af,'gatewayPaymentId':_0x3f642,'oldStatus':_0x5d67b9,'newStatus':_0x304434,'source':_0xe81a05,'timestamp':new Date()[_0x25e82b(0x1f1)](),'details':_0x55f229||{}};loggerService_1[_0x25e82b(0x188)][_0x25e82b(0x13f)](_0x35d11b),console[_0x25e82b(0x1c7)](_0x25e82b(0x14d)+_0x3bc3af+'\x20('+_0x3f642+')'),console[_0x25e82b(0x1c7)](_0x25e82b(0x17f)+_0x5d67b9+_0x25e82b(0x171)+_0x304434),console[_0x25e82b(0x1c7)](_0x25e82b(0x11f)+_0xe81a05),console['log']('\x20\x20\x20📅\x20Time:\x20'+_0x35d11b[_0x25e82b(0x1e0)]),_0x55f229&&console[_0x25e82b(0x1c7)](_0x25e82b(0x186),_0x55f229);}[a38_0x33d316(0x197)](_0x3bd041,_0x4e45d9,_0x4824b1,_0x7c5d94,_0x1e0dda){const _0x47889b=a38_0x33d316,_0xaea50f={'type':'COINTOPAY_ERROR','paymentId':_0x3bd041,'gatewayPaymentId':_0x4e45d9,'error':_0x4824b1 instanceof Error?{'message':_0x4824b1[_0x47889b(0x17e)],'stack':_0x4824b1[_0x47889b(0x1c0)]}:_0x4824b1,'source':_0x7c5d94,'timestamp':new Date()[_0x47889b(0x1f1)](),'context':_0x1e0dda||{}};loggerService_1[_0x47889b(0x188)][_0x47889b(0x197)](_0xaea50f),console['error']('🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x3bd041+'\x20('+_0x4e45d9+')'),console['error'](_0x47889b(0x19b)+(_0x4824b1 instanceof Error?_0x4824b1['message']:_0x4824b1)),console[_0x47889b(0x1f2)]('\x20\x20\x20📍\x20Source:\x20'+_0x7c5d94),console['error'](_0x47889b(0x1cd)+_0xaea50f['timestamp']),_0x1e0dda&&console[_0x47889b(0x1f2)]('\x20\x20\x20📝\x20Context:',_0x1e0dda);}[a38_0x33d316(0x159)](){const _0x2b271e=a38_0x33d316;console[_0x2b271e(0x1c7)](_0x2b271e(0x10d)),this[_0x2b271e(0x15c)]()[_0x2b271e(0x1dc)](_0x27c4bf=>{const _0x447ce9=_0x2b271e;console[_0x447ce9(0x1f2)](_0x447ce9(0x142),_0x27c4bf);}),this[_0x2b271e(0x174)]=setInterval(async()=>{const _0x79240f=_0x2b271e;try{console['log'](_0x79240f(0xff)),await this[_0x79240f(0x15c)](),console[_0x79240f(0x1c7)](_0x79240f(0x16e));}catch(_0x20f59d){console[_0x79240f(0x1f2)](_0x79240f(0x155),_0x20f59d);}},this[_0x2b271e(0x107)]),console[_0x2b271e(0x1c7)](_0x2b271e(0x1ac));}[a38_0x33d316(0x12c)](){const _0x1d80d0=a38_0x33d316;console[_0x1d80d0(0x1c7)](_0x1d80d0(0x16d));this[_0x1d80d0(0x174)]&&(clearInterval(this['globalCheckInterval']),this['globalCheckInterval']=null,console[_0x1d80d0(0x1c7)](_0x1d80d0(0x10f)));const _0x3d28a6=this[_0x1d80d0(0x196)]['size'];for(const [_0x38540b]of this[_0x1d80d0(0x196)]){this[_0x1d80d0(0x1c2)](_0x38540b);}console[_0x1d80d0(0x1c7)](_0x1d80d0(0x1cc)+_0x3d28a6+_0x1d80d0(0x13e));}async['checkAllPendingPayments'](){const _0xa11a2a=a38_0x33d316;try{console['log'](_0xa11a2a(0x114));const _0x17357f=await database_1['default']['payment'][_0xa11a2a(0x1a2)]({'where':{'gateway':{'in':[_0xa11a2a(0x209),_0xa11a2a(0x167)]},'status':_0xa11a2a(0x1cb),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0xa11a2a(0x1f7)+_0x17357f[_0xa11a2a(0x16a)]+_0xa11a2a(0x1af));if(_0x17357f[_0xa11a2a(0x16a)]===0x0){console[_0xa11a2a(0x1c7)](_0xa11a2a(0x122));return;}const _0x52ee2d=await this[_0xa11a2a(0x17b)](_0x17357f);console[_0xa11a2a(0x1c7)](_0xa11a2a(0x1b0)+_0x52ee2d[_0xa11a2a(0x16a)]+'\x20expired\x20CoinToPay\x20payments');let _0xe0f37b=0x0,_0x17f791=0x0;for(const _0x39d6f9 of _0x17357f){try{if(_0x52ee2d[_0xa11a2a(0x1f5)](_0x39d6f9['id'])){console[_0xa11a2a(0x1c7)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x39d6f9['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x17f791++;continue;}if(this['paymentTimers'][_0xa11a2a(0x176)](_0x39d6f9['id'])){console[_0xa11a2a(0x1c7)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x39d6f9['id']+_0xa11a2a(0x1df)),_0x17f791++;continue;}const _0x31a99e=(Date[_0xa11a2a(0x200)]()-_0x39d6f9[_0xa11a2a(0x179)][_0xa11a2a(0x1d4)]())/(0x3e8*0x3c*0x3c);if(_0x31a99e<0x1){console[_0xa11a2a(0x1c7)](_0xa11a2a(0x1d6)+_0x39d6f9['id']+_0xa11a2a(0x111)+_0x31a99e[_0xa11a2a(0x168)](0x1)+'h),\x20skipping\x20global\x20check'),_0x17f791++;continue;}console[_0xa11a2a(0x1c7)](_0xa11a2a(0x1c9)+_0x39d6f9['id']+_0xa11a2a(0x1e1)+_0x31a99e[_0xa11a2a(0x168)](0x1)+'h)'),await this['checkSinglePayment'](_0x39d6f9),_0xe0f37b++,await new Promise(_0xa05824=>setTimeout(_0xa05824,0x7d0));}catch(_0x56ae64){console[_0xa11a2a(0x1f2)](_0xa11a2a(0x148)+_0x39d6f9['id']+':',_0x56ae64),this[_0xa11a2a(0x197)](_0x39d6f9['id'],_0x39d6f9[_0xa11a2a(0x1b2)]||_0xa11a2a(0x153),_0x56ae64,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x39d6f9[_0xa11a2a(0x1ef)],'paymentCurrency':_0x39d6f9[_0xa11a2a(0x13d)],'shopId':_0x39d6f9['shopId'],'createdAt':_0x39d6f9[_0xa11a2a(0x179)]}),loggerService_1[_0xa11a2a(0x188)][_0xa11a2a(0x1d8)](_0xa11a2a(0x209),_0xa11a2a(0x104)+_0x39d6f9[_0xa11a2a(0x1b2)],_0x56ae64);}}console[_0xa11a2a(0x1c7)](_0xa11a2a(0x19f)+_0xe0f37b+_0xa11a2a(0x1a4)+_0x17f791+_0xa11a2a(0x19a)+_0x52ee2d[_0xa11a2a(0x16a)]+'\x20expired');}catch(_0x18768e){console[_0xa11a2a(0x1f2)](_0xa11a2a(0x17c),_0x18768e);}}async[a38_0x33d316(0x17b)](_0x10710f){const _0x45e405=a38_0x33d316,_0x1e78d1=[],_0x479974=new Date();_0x479974[_0x45e405(0x100)](_0x479974[_0x45e405(0x1d9)]()-this[_0x45e405(0x1a3)]),console[_0x45e405(0x1c7)](_0x45e405(0x12d)+this[_0x45e405(0x1a3)]+_0x45e405(0x1a7)+_0x479974[_0x45e405(0x1f1)]()+')');for(const _0x3cba78 of _0x10710f){if(_0x3cba78['createdAt']<_0x479974){console['log'](_0x45e405(0x182)+_0x3cba78['id']+_0x45e405(0x14f)+this['EXPIRY_DAYS']+_0x45e405(0x14b));try{this[_0x45e405(0x13f)](_0x3cba78['id'],_0x3cba78[_0x45e405(0x1b2)]||_0x45e405(0x153),_0x45e405(0x1cb),'EXPIRED',_0x45e405(0x1dd),{'reason':_0x45e405(0x10a)+this[_0x45e405(0x1a3)]+_0x45e405(0x1d3),'createdAt':_0x3cba78[_0x45e405(0x179)],'daysSinceCreation':Math[_0x45e405(0x16b)]((Date['now']()-_0x3cba78[_0x45e405(0x179)][_0x45e405(0x1d4)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x3cba78[_0x45e405(0x1ef)],'paymentCurrency':_0x3cba78['currency'],'shopId':_0x3cba78[_0x45e405(0x158)]}),await database_1[_0x45e405(0x157)][_0x45e405(0x202)][_0x45e405(0x154)]({'where':{'id':_0x3cba78['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':_0x45e405(0x138)+this[_0x45e405(0x1a3)]+_0x45e405(0x205)}}),await database_1[_0x45e405(0x157)][_0x45e405(0x14c)][_0x45e405(0x156)]({'data':{'paymentId':_0x3cba78['id'],'shopId':_0x3cba78[_0x45e405(0x158)],'event':_0x45e405(0x102),'statusCode':0xc8,'responseBody':JSON[_0x45e405(0x1c8)]({'reason':_0x45e405(0x10a)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x3cba78[_0x45e405(0x179)],'expiredAt':new Date()[_0x45e405(0x1f1)](),'daysSinceCreation':Math[_0x45e405(0x16b)]((Date[_0x45e405(0x200)]()-_0x3cba78[_0x45e405(0x179)][_0x45e405(0x1d4)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x45e405(0x11b)](_0x3cba78,_0x45e405(0x1e8)),await this['sendPaymentStatusNotification'](_0x3cba78,_0x45e405(0x1e8)),this[_0x45e405(0x1c2)](_0x3cba78['id']),_0x1e78d1[_0x45e405(0x12b)](_0x3cba78['id']),console[_0x45e405(0x1c7)]('✅\x20[EXPIRY]\x20Payment\x20'+_0x3cba78['id']+_0x45e405(0x16c)+this[_0x45e405(0x1a3)]+_0x45e405(0x129));}catch(_0x4f80ff){console[_0x45e405(0x1f2)]('❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x3cba78['id']+':',_0x4f80ff),this[_0x45e405(0x197)](_0x3cba78['id'],_0x3cba78['gatewayPaymentId']||'unknown',_0x4f80ff,'auto_expire',{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x3cba78['createdAt'],'daysSinceCreation':Math['floor']((Date[_0x45e405(0x200)]()-_0x3cba78[_0x45e405(0x179)][_0x45e405(0x1d4)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x1e78d1;}async[a38_0x33d316(0x1d0)](_0x1b016b){const _0x5d44c4=a38_0x33d316;if(!_0x1b016b['gatewayPaymentId']){console[_0x5d44c4(0x1c7)](_0x5d44c4(0x112)+_0x1b016b['id']+_0x5d44c4(0x1e2));return;}console['log'](_0x5d44c4(0x194)+_0x1b016b[_0x5d44c4(0x1d2)]+_0x5d44c4(0x14a)+_0x1b016b['id']+'\x20('+_0x1b016b[_0x5d44c4(0x1b2)]+')');try{let _0x56697a;_0x1b016b[_0x5d44c4(0x1d2)]===_0x5d44c4(0x167)?(_0x56697a=await this[_0x5d44c4(0x1c5)][_0x5d44c4(0x1ed)](_0x1b016b[_0x5d44c4(0x1b2)]),console[_0x5d44c4(0x1c7)]('📊\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x1b016b['id']+_0x5d44c4(0x140)+_0x56697a[_0x5d44c4(0x1cf)])):(_0x56697a=await this[_0x5d44c4(0x165)][_0x5d44c4(0x1ed)](_0x1b016b[_0x5d44c4(0x1b2)]),console[_0x5d44c4(0x1c7)](_0x5d44c4(0x1be)+_0x1b016b['id']+_0x5d44c4(0x140)+_0x56697a[_0x5d44c4(0x1cf)]));_0x56697a['paymentDetails']&&console['log'](_0x5d44c4(0x13b)+_0x1b016b['id']+_0x5d44c4(0x195),{'iban':_0x56697a[_0x5d44c4(0x130)][_0x5d44c4(0x203)]||_0x5d44c4(0x19d),'transactionId':_0x56697a[_0x5d44c4(0x130)]['transactionId'],'createdOn':_0x56697a[_0x5d44c4(0x130)][_0x5d44c4(0x133)],'confirmedOn':_0x56697a['paymentDetails']['confirmedOn']||_0x5d44c4(0x1d7)});if(_0x56697a[_0x5d44c4(0x1cf)]!==_0x1b016b[_0x5d44c4(0x1cf)]){console[_0x5d44c4(0x1c7)](_0x5d44c4(0x13c)+_0x1b016b['id']+'\x20status\x20from\x20'+_0x1b016b[_0x5d44c4(0x1cf)]+_0x5d44c4(0x123)+_0x56697a[_0x5d44c4(0x1cf)]),this[_0x5d44c4(0x13f)](_0x1b016b['id'],_0x1b016b[_0x5d44c4(0x1b2)],_0x1b016b[_0x5d44c4(0x1cf)],_0x56697a[_0x5d44c4(0x1cf)],'status_check',{'paymentDetails':_0x56697a[_0x5d44c4(0x130)],'amount':_0x56697a[_0x5d44c4(0x1ef)],'currency':_0x56697a[_0x5d44c4(0x13d)],'shopId':_0x1b016b[_0x5d44c4(0x158)],'checkTimestamp':new Date()[_0x5d44c4(0x1f1)]()});const _0x380b2c={'status':_0x56697a[_0x5d44c4(0x1cf)],'updatedAt':new Date()};if(_0x56697a[_0x5d44c4(0x1cf)]===_0x5d44c4(0x105)&&_0x1b016b[_0x5d44c4(0x1cf)]!==_0x5d44c4(0x105)){_0x380b2c[_0x5d44c4(0x18a)]=new Date();if(!_0x1b016b[_0x5d44c4(0x163)]){const _0x5c1304=await currencyService_1['currencyService']['convertToUSDT'](_0x1b016b[_0x5d44c4(0x1ef)],_0x1b016b['currency']);_0x380b2c[_0x5d44c4(0x163)]=_0x5c1304;const _0x4d16d4=await this[_0x5d44c4(0x152)](_0x1b016b['shopId'],_0x1b016b[_0x5d44c4(0x1d2)]),_0x10d2b1=_0x5c1304*(0x1-_0x4d16d4/0x64);_0x380b2c[_0x5d44c4(0x110)]=_0x10d2b1,console[_0x5d44c4(0x1c7)](_0x5d44c4(0x1b4)+_0x1b016b['id']+'\x20amounts\x20calculated:'),console[_0x5d44c4(0x1c7)]('\x20\x20\x20Amount:\x20'+_0x1b016b['amount']+'\x20'+_0x1b016b[_0x5d44c4(0x13d)]+_0x5d44c4(0x171)+_0x5c1304[_0x5d44c4(0x168)](0x6)+_0x5d44c4(0x12f)),console[_0x5d44c4(0x1c7)](_0x5d44c4(0x143)+_0x1b016b[_0x5d44c4(0x1d2)]+'\x20commission:\x20'+_0x4d16d4+'%'),console['log'](_0x5d44c4(0x19e)+_0x10d2b1[_0x5d44c4(0x168)](0x6)+_0x5d44c4(0x12f));}console[_0x5d44c4(0x1c7)](_0x5d44c4(0x1b4)+_0x1b016b['id']+_0x5d44c4(0x208)+_0x380b2c[_0x5d44c4(0x18a)]['toISOString']());}if(_0x56697a['paymentDetails']){const _0x1a98fe=_0x56697a[_0x5d44c4(0x130)];_0x1a98fe[_0x5d44c4(0x203)]&&(_0x380b2c[_0x5d44c4(0x160)]=_0x1a98fe['iban'],console[_0x5d44c4(0x1c7)](_0x5d44c4(0x109)+_0x1a98fe[_0x5d44c4(0x203)]));if(_0x1a98fe['bankDetails']){const _0x5eb953=_0x1b016b[_0x5d44c4(0x1f9)]||'',_0xe39132=_0x5d44c4(0x1a9)+_0x1a98fe[_0x5d44c4(0x1b9)];_0x380b2c[_0x5d44c4(0x1f9)]=_0x5eb953?_0x5eb953+'\x0a\x0a'+_0xe39132:_0xe39132,console['log'](_0x5d44c4(0x103));}_0x1a98fe[_0x5d44c4(0x162)]&&console[_0x5d44c4(0x1c7)](_0x5d44c4(0x146)+_0x1a98fe[_0x5d44c4(0x162)]),_0x1a98fe[_0x5d44c4(0x180)]&&console['log'](_0x5d44c4(0x15a)+_0x1a98fe[_0x5d44c4(0x180)]);}await database_1[_0x5d44c4(0x157)]['payment'][_0x5d44c4(0x154)]({'where':{'id':_0x1b016b['id']},'data':_0x380b2c});if(_0x56697a[_0x5d44c4(0x1cf)]==='PAID'&&_0x1b016b['status']!==_0x5d44c4(0x105)){console[_0x5d44c4(0x1c7)](_0x5d44c4(0x150)+_0x1b016b['id']+_0x5d44c4(0x1f0));const _0x7c10c9=await database_1['default'][_0x5d44c4(0x202)][_0x5d44c4(0x193)]({'where':{'id':_0x1b016b['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x7c10c9?.['paymentLinkId']&&_0x7c10c9[_0x5d44c4(0x10b)])try{const _0x5887a9=_0x7c10c9[_0x5d44c4(0x10b)];console[_0x5d44c4(0x1c7)]('📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x5887a9['id']+_0x5d44c4(0x10e)+_0x5887a9[_0x5d44c4(0x1f3)]+_0x5d44c4(0x17a)+_0x5887a9[_0x5d44c4(0x161)]+',\x20status='+_0x5887a9[_0x5d44c4(0x1cf)]);const _0x2e5287=_0x5887a9[_0x5d44c4(0x161)]+0x1,_0x28d9c5=_0x5887a9[_0x5d44c4(0x1f3)]===_0x5d44c4(0x1e5)?_0x5d44c4(0x124):_0x5887a9[_0x5d44c4(0x1cf)];await database_1[_0x5d44c4(0x157)]['paymentLink'][_0x5d44c4(0x154)]({'where':{'id':_0x5887a9['id']},'data':{'currentPayments':_0x2e5287,'status':_0x28d9c5,'updatedAt':new Date()}}),console['log']('✅\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x5887a9['id']+_0x5d44c4(0x1c3)+_0x5887a9[_0x5d44c4(0x161)]+'\x20->\x20'+_0x2e5287+',\x20status='+_0x5887a9['status']+_0x5d44c4(0x171)+_0x28d9c5);}catch(_0x134314){console[_0x5d44c4(0x1f2)]('❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x134314);}else console[_0x5d44c4(0x1c7)](_0x5d44c4(0x150)+_0x1b016b['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1['default'][_0x5d44c4(0x14c)][_0x5d44c4(0x156)]({'data':{'paymentId':_0x1b016b['id'],'shopId':_0x1b016b['shopId'],'event':_0x5d44c4(0x1ab)+_0x56697a[_0x5d44c4(0x1cf)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x5d44c4(0x1c8)]({'oldStatus':_0x1b016b[_0x5d44c4(0x1cf)],'newStatus':_0x56697a[_0x5d44c4(0x1cf)],'paymentDetails':_0x56697a['paymentDetails'],'checkedAt':new Date()[_0x5d44c4(0x1f1)]()})}}),await this[_0x5d44c4(0x11b)](_0x1b016b,_0x56697a[_0x5d44c4(0x1cf)]),await this['sendPaymentStatusNotification'](_0x1b016b,_0x56697a[_0x5d44c4(0x1cf)]),_0x56697a[_0x5d44c4(0x1cf)]!=='PENDING'&&(console['log'](_0x5d44c4(0x12e)+_0x1b016b['id']+'\x20status\x20changed\x20to\x20'+_0x56697a['status']+_0x5d44c4(0x11a)),this[_0x5d44c4(0x1c2)](_0x1b016b['id'])),console[_0x5d44c4(0x1c7)](_0x5d44c4(0x18d)+_0x1b016b['id']+_0x5d44c4(0x1c1));}else console[_0x5d44c4(0x1c7)](_0x5d44c4(0x13b)+_0x1b016b['id']+_0x5d44c4(0x13a)+_0x56697a[_0x5d44c4(0x1cf)]+')'),this[_0x5d44c4(0x13f)](_0x1b016b['id'],_0x1b016b['gatewayPaymentId'],_0x1b016b[_0x5d44c4(0x1cf)],_0x56697a['status'],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x56697a[_0x5d44c4(0x130)],'amount':_0x56697a[_0x5d44c4(0x1ef)],'currency':_0x56697a[_0x5d44c4(0x13d)],'shopId':_0x1b016b[_0x5d44c4(0x158)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x1e0cdb){console['error'](_0x5d44c4(0x18b)+_0x1b016b['id']+':',_0x1e0cdb),this[_0x5d44c4(0x197)](_0x1b016b['id'],_0x1b016b[_0x5d44c4(0x1b2)],_0x1e0cdb,'status_check',{'paymentAmount':_0x1b016b[_0x5d44c4(0x1ef)],'paymentCurrency':_0x1b016b[_0x5d44c4(0x13d)],'shopId':_0x1b016b[_0x5d44c4(0x158)],'createdAt':_0x1b016b[_0x5d44c4(0x179)]}),await database_1[_0x5d44c4(0x157)][_0x5d44c4(0x14c)][_0x5d44c4(0x156)]({'data':{'paymentId':_0x1b016b['id'],'shopId':_0x1b016b[_0x5d44c4(0x158)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x5d44c4(0x1c8)]({'error':_0x1e0cdb instanceof Error?_0x1e0cdb[_0x5d44c4(0x17e)]:_0x5d44c4(0x172),'gatewayPaymentId':_0x1b016b[_0x5d44c4(0x1b2)],'checkedAt':new Date()[_0x5d44c4(0x1f1)]()})}});}}async[a38_0x33d316(0x11b)](_0x88acf7,_0x13fdc0){const _0x25e4eb=a38_0x33d316,_0x6666f0=Date[_0x25e4eb(0x200)]();try{const _0x2d8377=_0x88acf7[_0x25e4eb(0x18c)],_0x1c554f=_0x2d8377['settings'];if(!_0x1c554f?.[_0x25e4eb(0x1c4)]){console['log']('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x2d8377['id']);return;}const _0x41ea86=_0x13fdc0===_0x25e4eb(0x105)?_0x25e4eb(0x181):_0x13fdc0==='FAILED'?_0x25e4eb(0x173):_0x13fdc0===_0x25e4eb(0x1e8)?_0x25e4eb(0x173):_0x25e4eb(0x139);if(!_0x1c554f[_0x25e4eb(0x1fa)]?.['includes'](_0x41ea86)){console[_0x25e4eb(0x1c7)](_0x25e4eb(0x201)+_0x41ea86+_0x25e4eb(0x184)+_0x2d8377['id']);return;}const _0x93b31d=(0x0,gateway_1[_0x25e4eb(0x178)])(_0x88acf7[_0x25e4eb(0x1d2)])||_0x88acf7[_0x25e4eb(0x1d2)],_0x28ac27={'event':_0x41ea86,'payment':{'id':_0x88acf7['id'],'order_id':_0x88acf7[_0x25e4eb(0x207)],'gateway_order_id':_0x88acf7['gatewayOrderId'],'gateway':_0x93b31d,'amount':_0x88acf7[_0x25e4eb(0x1ef)],'currency':_0x88acf7[_0x25e4eb(0x13d)],'status':_0x13fdc0[_0x25e4eb(0x121)](),'customer_email':_0x88acf7['customerEmail'],'customer_name':_0x88acf7[_0x25e4eb(0x15e)],'created_at':_0x88acf7[_0x25e4eb(0x179)],'updated_at':new Date()}},_0x13da4b=await fetch(_0x1c554f['webhookUrl'],{'method':_0x25e4eb(0x18f),'headers':{'Content-Type':_0x25e4eb(0x116),'User-Agent':_0x25e4eb(0x151)},'body':JSON[_0x25e4eb(0x1c8)](_0x28ac27)}),_0x4909c6=Date[_0x25e4eb(0x200)]()-_0x6666f0,_0x3ed0c3=_0x13da4b['ok']?_0x25e4eb(0x118):await _0x13da4b[_0x25e4eb(0x10c)]();loggerService_1[_0x25e4eb(0x188)][_0x25e4eb(0x115)](_0x88acf7[_0x25e4eb(0x158)],_0x1c554f[_0x25e4eb(0x1c4)],_0x41ea86,_0x13da4b['status'],_0x4909c6,_0x28ac27),console['log']('Shop\x20webhook\x20sent\x20to\x20'+_0x1c554f['webhookUrl']+_0x25e4eb(0x1bb)+_0x13da4b[_0x25e4eb(0x1cf)]+'\x20('+_0x4909c6+_0x25e4eb(0xfe));}catch(_0xcbf7d9){console[_0x25e4eb(0x1f2)](_0x25e4eb(0x1de),_0xcbf7d9),loggerService_1['loggerService']['logShopWebhookError'](_0x88acf7[_0x25e4eb(0x158)],_0x88acf7[_0x25e4eb(0x18c)]?.['settings']?.['webhookUrl']||_0x25e4eb(0x153),_0x25e4eb(0x1ba),_0xcbf7d9,{});}}async[a38_0x33d316(0x164)](_0x3c31a2,_0x203f45){const _0x3f07e0=a38_0x33d316;try{const _0x99539c={'PENDING':_0x3f07e0(0x1d5),'PAID':_0x3f07e0(0x136),'FAILED':'failed','EXPIRED':'expired'},_0x14f5a7=_0x99539c[_0x203f45];if(!_0x14f5a7||_0x14f5a7==='created')return;await telegramBotService_1['telegramBotService'][_0x3f07e0(0x101)](_0x3c31a2[_0x3f07e0(0x158)],_0x3c31a2,_0x14f5a7);}catch(_0x4f7455){console[_0x3f07e0(0x1f2)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x4f7455);}}async['checkPaymentById'](_0x29839d){const _0x3a7900=a38_0x33d316;console[_0x3a7900(0x1c7)](_0x3a7900(0x189)+_0x29839d);const _0x39496e=await database_1[_0x3a7900(0x157)]['payment'][_0x3a7900(0x193)]({'where':{'id':_0x29839d},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x39496e)throw new Error(_0x3a7900(0x1aa));if(_0x39496e[_0x3a7900(0x1d2)]!==_0x3a7900(0x209)&&_0x39496e[_0x3a7900(0x1d2)]!==_0x3a7900(0x167))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console[_0x3a7900(0x1c7)](_0x3a7900(0x199)+_0x39496e[_0x3a7900(0x1d2)]+_0x3a7900(0x14a)+_0x29839d),await this[_0x3a7900(0x1d0)](_0x39496e),console['log'](_0x3a7900(0x204)+_0x29839d);}[a38_0x33d316(0x125)](){const _0x3b1aee=a38_0x33d316,_0x3273d9=this['globalCheckInterval']?this[_0x3b1aee(0x107)]:undefined,_0x75bca0=Array['from'](this[_0x3b1aee(0x196)][_0x3b1aee(0x145)]())[_0x3b1aee(0x1bf)](_0x13cda8=>({'paymentId':_0x13cda8[_0x3b1aee(0x1e6)],'gatewayPaymentId':_0x13cda8['gatewayPaymentId'],'createdAt':_0x13cda8['createdAt'],'timersCount':_0x13cda8[_0x3b1aee(0x187)][_0x3b1aee(0x16a)]}));return{'isActive':!!this[_0x3b1aee(0x174)],'globalCheckIntervalMinutes':this[_0x3b1aee(0x107)]/(0x3e8*0x3c),'expiryDays':this[_0x3b1aee(0x1a3)],'activeIndividualTimers':this['paymentTimers']['size'],'nextGlobalCheckIn':_0x3273d9,'paymentTimersDetails':_0x75bca0};}[a38_0x33d316(0x1fb)](_0x3e40f2){const _0x549fd0=a38_0x33d316,_0x18b640=this[_0x549fd0(0x196)][_0x549fd0(0x11d)](_0x3e40f2);if(_0x18b640)return{'hasTimers':!![],'timersCount':_0x18b640[_0x549fd0(0x187)]['length'],'createdAt':_0x18b640[_0x549fd0(0x179)],'gatewayPaymentId':_0x18b640['gatewayPaymentId']};return{'hasTimers':![]};}async['getGatewayCommission'](_0x1757c9,_0x9504b3){const _0x5d4e86=a38_0x33d316;try{const _0x1c598b=await database_1['default']['shop'][_0x5d4e86(0x193)]({'where':{'id':_0x1757c9},'select':{'gatewaySettings':!![]}});if(!_0x1c598b?.[_0x5d4e86(0x12a)])return console[_0x5d4e86(0x1c7)](_0x5d4e86(0x1bd)+_0x1757c9+_0x5d4e86(0x1db)),0xa;const _0x8fdb43=JSON[_0x5d4e86(0x191)](_0x1c598b[_0x5d4e86(0x12a)]);for(const [_0x48b81f,_0x88d3fe]of Object['entries'](_0x8fdb43)){if(_0x48b81f[_0x5d4e86(0x121)]()===_0x9504b3[_0x5d4e86(0x121)]()){const _0xfbb2e=_0x88d3fe[_0x5d4e86(0x1a0)]||0xa;return console[_0x5d4e86(0x1c7)](_0x5d4e86(0x1ad)+_0x9504b3+'\x20commission\x20for\x20shop\x20'+_0x1757c9+':\x20'+_0xfbb2e+'%'),_0xfbb2e;}}return console[_0x5d4e86(0x1c7)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x9504b3+_0x5d4e86(0x1e3)+_0x1757c9+_0x5d4e86(0x19c)),0xa;}catch(_0x2739ab){return console[_0x5d4e86(0x1f2)](_0x5d4e86(0x1f6)+_0x1757c9+',\x20gateway\x20'+_0x9504b3+':',_0x2739ab),0xa;}}}function a38_0x1abc(){const _0x4fe55f=['globalCheckInterval','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','has','\x20not\x20found\x20in\x20database','getGatewayIdByName','createdAt',',\x20currentPayments=','checkExpiredPayments','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','CoinToPay2Service','message','\x20\x20\x20📊\x20Status:\x20','confirmedOn','payment.success','⏰\x20[EXPIRY]\x20Payment\x20','⏰\x20[HOURLY]\x20Payment\x20','\x20not\x20enabled\x20for\x20shop\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20\x20\x20📝\x20Details:','timers','loggerService','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','paidAt','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','shop','✅\x20[CHECK]\x20Payment\x20','6975064uVJRXP','POST','📊\x20[HOURLY]\x20Payment\x20','parse','\x20\x20\x20-\x20Status:\x20','findUnique','🔍\x20[CHECK]\x20Checking\x20','\x20details:','paymentTimers','logCoinToPayError','609672aefVkv','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20skipped,\x20','\x20\x20\x20❌\x20Error:\x20',',\x20using\x20default\x2010%','not\x20found','\x20\x20\x20Amount\x20after\x20commission:\x20','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','commission','1477890mNChDc','findMany','EXPIRY_DAYS','\x20checked,\x20','1148585gVuDdq','\x20\x20\x20-\x20Gateway:\x20','\x20days\x20(created\x20before\x20','schedulePaymentChecks','Bank\x20Details:\x20','Payment\x20not\x20found','cointopay_status_check_','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','Gateway\x20','\x20timers\x20for\x20payment\x20','\x20pending\x20CoinToPay\x20payments','⏰\x20[GLOBAL]\x20Found\x20',',\x20stopping\x20individual\x20checks','gatewayPaymentId','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','💰\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20Amount:\x20','\x20to\x20clear','./loggerService','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','bankDetails','webhook_send','\x20with\x20status\x20','schedule_created','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','map','stack','\x20updated\x20successfully','clearPaymentTimers','\x20updated:\x20currentPayments=','webhookUrl','coinToPay2Service','🧹\x20[DEBUG]\x20Clearing\x20','log','stringify','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','status_check','PENDING','🛑\x20[SHUTDOWN]\x20Cleared\x20','\x20\x20\x20📅\x20Time:\x20','\x20status\x20is\x20','status','checkSinglePayment','❌\x20[CHECK]\x20Payment\x20','gateway','\x20days','getTime','created','⏰\x20[GLOBAL]\x20Payment\x20','not\x20confirmed','logWhiteDomainError','getDate','1KxFDxA',',\x20using\x20default\x20commission\x2010%','catch','auto_expire','Failed\x20to\x20send\x20shop\x20webhook:','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','timestamp','\x20(age:\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','\x20in\x20shop\x20','\x20triggered\x20for\x20payment\x20','SINGLE','paymentId','✅\x20[HOURLY]\x20Payment\x20','EXPIRED','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','__esModule','checkPaymentStatus','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','amount','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','toISOString','error','type','COINTOPAY_STATUS_CHANGE','includes','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','🪙\x20[GLOBAL]\x20Found\x20','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','adminNotes','webhookEvents','getPaymentTimerInfo','CoinToPayStatusService','\x20\x20\x20-\x20ShopId:\x20','delete','description','now','Webhook\x20event\x20','payment','iban','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','\x20days\x20without\x20payment\x20confirmation','delay','orderId','\x20marked\x20as\x20paid\x20at:\x20','cointopay','ms)','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','setDate','sendPaymentNotification','cointopay_auto_expired','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','/status/','PAID','5\x20minutes','GLOBAL_CHECK_INTERVAL_MS','forEach','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','Payment\x20older\x20than\x20','paymentLink','text','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)',':\x20type=','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','amountAfterGatewayCommissionUSDT','\x20is\x20too\x20new\x20(','⚠️\x20[CHECK]\x20Payment\x20','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','logShopWebhookSent','application/json','\x20found:','Success','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20',',\x20clearing\x20individual\x20timers','sendShopWebhook','CoinToPayService','get','../types/gateway','\x20\x20\x20📍\x20Source:\x20','./currencyService','toLowerCase','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20to\x20','COMPLETED','getServiceStats','11172753lYGifM','\x20completed\x20for\x20payment\x20','\x20seconds\x20(','-day\x20timeout','gatewaySettings','push','stopPeriodicStatusCheck','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','🧹\x20[CHECK]\x20Payment\x20','\x20USDT','paymentDetails','./gateways/coinToPayService','3490424rBHKGY','createdOn','\x20not\x20found,\x20clearing\x20timers','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','paid','coinToPayStatusService','Automatically\x20expired\x20after\x20','payment.pending','\x20status\x20unchanged\x20(','📊\x20[CHECK]\x20Payment\x20','🔄\x20[CHECK]\x20Updating\x20payment\x20','currency','\x20individual\x20payment\x20timers','logCoinToPayStatus','\x20status:\x20','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','\x20\x20\x20Gateway\x20','2172723ryWxFE','values','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','checkSinglePaymentById','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','set','\x20payment\x20','\x20days,\x20marking\x20as\x20EXPIRED','webhookLog','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','🪙\x20[DEBUG]\x20Creating\x20','\x20is\x20older\x20than\x20','📈\x20[COINTOPAY]\x20Payment\x20','TesSoft\x20Payment\x20System/1.0','getGatewayCommission','unknown','update','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','create','default','shopId','startPeriodicStatusCheck','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','8kvdDEa','checkAllPendingPayments','🪙\x20[TIMER]\x20Individual\x20check\x20#','customerName','✅\x20[TIMER]\x20Individual\x20check\x20#','remitterIban','currentPayments','transactionId','amountUSDT','sendPaymentStatusNotification','coinToPayService','size','cointopay2','toFixed','./telegramBotService','length','floor','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20initial\x20timers\x20for\x20payment\x20','\x20->\x20','Unknown\x20error','payment.failed'];a38_0x1abc=function(){return _0x4fe55f;};return a38_0x1abc();}function a38_0x3e01(_0x25bcf4,_0x205145){const _0x1abc15=a38_0x1abc();return a38_0x3e01=function(_0x3e0139,_0x4eadc5){_0x3e0139=_0x3e0139-0xfe;let _0x575f38=_0x1abc15[_0x3e0139];return _0x575f38;},a38_0x3e01(_0x25bcf4,_0x205145);}exports[a38_0x33d316(0x1fc)]=CoinToPayStatusService,exports[a38_0x33d316(0x137)]=new CoinToPayStatusService();